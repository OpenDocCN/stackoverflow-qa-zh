# StackOverflow 问答 000273000-000273999

# python - 使用 Python 和 SOAPpy 生成 WSDL

> ID：273002
> 
> 赞同：14
> 
> 时间：2008-11-07T18:05:08.643
> 
> 标签：python, soap, wsdl, soappy, zsi

首先，我承认我是 Web 服务的新手，虽然我熟悉 HTML 和基本的 Web 内容。我使用 Python 创建了一个快速而简单的 Web 服务，它调用 MySQL 数据库中的存储过程，它只返回一个 BIGINT 值。我想在 Web 服务中返回这个值，并且我想生成一个可以提供给我们的 Web 开发人员的 WSDL。我可能会补充一点，存储过程只返回一个值。

这是一些示例代码：

```
#!/usr/bin/python

import SOAPpy
import MySQLdb

def getNEXTVAL():
    cursor = db.cursor()
    cursor.execute( "CALL my_stored_procedure()" )  # Returns a number
    result=cursor.fetchall()

    for record in result:
        return record[0]

db=MySQLdb.connect(host="localhost", user="myuser", passwd="********", db="testing")
server = SOAPpy.SOAPServer(("10.1.22.29", 8080))
server.registerFunction(getNEXTVAL)
server.serve_forever() 
```

我想生成一个可以提供给网络人员的 WSDL，我想知道是否可以让 SOAPpy 为我生成一个。这可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-10T03:25:11.960

当我去年尝试编写 Python Web 服务时，我最终使用了[ZSI-2.0](http://pywebsvcs.sourceforge.net/)（类似于 SOAPpy 的继承者）和[其 web 上提供的一篇论文](http://pywebsvcs.sourceforge.net/holger.pdf)。

基本上，我手动编写了我的 WSDL 文件，然后使用 ZSI 东西为我的客户端和服务器代码生成存根。我不会将这种体验描述为令人愉快的，但该应用程序确实有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T04:34:26.520

> 我想生成一个可以提供给网络人员的 WSDL，...

你可以试试[soaplib](http://soaplib.github.com/soaplib/2_0/)。它具有按需生成 WSDL。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-01T02:59:53.657

抱歉几天前的问题。现在我可以成功调用服务器了。提供了一个演示：

```
def test_soappy():
    """test for SOAPpy.SOAPServer
    """
    #okay
    # it's good for SOAPpy.SOAPServer.
    # in a method,it can have morn than 2 ws server.
    server = SOAPProxy("http://localhost:8081/")
    print server.sum(1,2)
    print server.div(10,2) 
```

# excel - 将数据从 Word 无缝移动到 Access

> ID：273005
> 
> 赞同：2
> 
> 时间：2008-11-07T18:05:25.867
> 
> 标签：excel, ms-access, formatting, ms-word, newline

我正在尝试将结构化文档（即主要是一些元数据和一张大表的文档）迁移到数据库。当我尝试将表格数据从 Word 移动到 Excel 时，我的主要痛点是在 Word 的单元格中处理 CRLF。有什么解决办法吗？现在，因为我将从 Word 转移到 Access：

1.  当我尝试使用包含 CRLF 的字符串填充字段时，默认行为是什么？
2.  让 Access 尊重“富文本”的最便宜的方法是什么？（主要是粗体字和重划线）

肿瘤坏死因子

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T18:28:08.503

1.  它应该像输入任何其他两个字符一样输入这两个字符。
2.  HTML 是一个很好的解决方案。

要获得更详细的答案，我们可能应该知道您是*如何*进行此“迁移”的。

# sql - 如何将日期时间列转换为 DD/MM/YYYY 格式的 nvarchar？

> ID：273009
> 
> 赞同：19
> 
> 时间：2008-11-07T18:06:31.637
> 
> 标签：sql, sql-server

我需要在表格中选择一个日期时间列。但是，我希望 select 语句将日期时间作为 nvarchar 返回，格式为 DD/MM/YYYY。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-07T18:09:31.193

这是转换文档：

> [https://docs.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql](https://docs.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql)

通过它，看起来你想要样式 103：

```
SELECT CONVERT(nvarchar(10), getdate(), 103) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T18:08:42.927

这应该会有所帮助。它包含所有（或大多数）不同的日期格式

[http://wiki.lessthandot.com/index.php/Formatting_Dates](http://wiki.lessthandot.com/index.php/Formatting_Dates)

如果可能的话，我认为你最好在客户端处理字符串转换。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-01-11T15:40:42.420

在您的情况下，您可以转换多种格式的日期：

```
CONVERT(NVARCHAR(10), YOUR_DATE_TIME, 103) => 15/09/2016
CONVERT(NVARCHAR(10), YOUR_DATE_TIME, 3) => 15/09/16 
```

句法：

```
CONVERT('TheDataTypeYouWant', 'TheDateToConvert', 'TheCodeForFormating' * ) 
```

代码是一个整数，这里 3 是第三个格式化选项（没有世纪），如果你想要世纪，只需将代码更改为 103。

查看更多信息：[http ://www.w3schools.com/sql/func_convert.asp](http://www.w3schools.com/sql/func_convert.asp)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T18:10:00.553

```
select CONVERT (NVARCHAR, GETDATE(), 103) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T18:09:28.277

```
select convert(nvarchar(10), datefield, 103) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T18:10:44.267

在 BOL 中查找转换。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T18:11:27.807

使用带有 103 选项的[转换。](http://msdn.microsoft.com/en-us/library/aa226054.aspx)

# asp.net - 通过 Visual Studio Professional 2008 连接到 AdventureWorks 数据库 (SQL Server 2005 Express)

> ID：273027
> 
> 赞同：1
> 
> 时间：2008-11-07T18:11:37.757
> 
> 标签：asp.net, sql-server, visual-studio-2008

我正在***学习*O'REILLY 的 ASP.NET 3.5**以使用 Visual Studio 2008 SP1 编写一些 ASP.NET 3.5 代码。我已经到了需要使用 SqlDataSource 控件配置数据源的地方。即使我有 SQL Server Express 2005， 我还是选择了**Microsoft SQL Server (SqlClient) - 这似乎是唯一合乎逻辑的选择。**

我进入“**添加连接**”窗口并成功添加了**服务器名称**，然后使用**Select 或输入****AdventureWorks**的数据库名称。当我单击测试连接时，我得到**测试连接成功**消息框。

不幸的是，当我单击确定时，我收到以下错误消息：

```
Could not load file or assembly 'Microsoft.SqlServer.Management.Sdk.Sfc, Version=10.0.0.0, Culture=neutral,
PublicKey Token=89845dcd8080cc91' or one of its dependecies.  The system cannot find
the file specified. 
```

在他这一点上，我不知所措，到处寻找与我的问题类似的东西，它涉及 Visual Studio 或 SQL Server 的其他版本。

我真的很感激这方面的任何帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-08T15:24:21.510

你可以研究[这个](http://social.msdn.microsoft.com/forums/es-ES/Offtopic/thread/70a5cb26-6b20-43a0-8cef-a0c5716a3e1c/)食谱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-15T09:23:00.463

我有完全相同的问题。

按照[此线程中的建议](http://social.msdn.microsoft.com/forums/es-ES/Offtopic/thread/70a5cb26-6b20-43a0-8cef-a0c5716a3e1c/)，我访问了“ [Microsoft SQL Server 2008 Feature Pack，August 2008](http://www.microsoft.com/downloads/details.aspx?FamilyId=C6C3E9EF-BA29-4A43-8D69-A2BED18FE73C&displaylang=en#filelist) ” - 并下载（并安装）了“Microsoft SQL Server 2005 向后兼容性组件”。这没有帮助。

然后我还下载并安装了以下组件：SharedManagementObjects.msi、sqlncli.msi、SQLSysClrTypes.msi。

现在它对我有用。

我正在使用 SQL Server 2008 Express 和 Visual Web Developer 2008 Express Edition。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T07:26:34.537

您可能需要重新安装 SQL 2005 Express 的副本。但请务必在安装程序中安装所有客户端开发人员包。

# java - 如何将声音文件中的（短）样本转换为字节数组

> ID：273029
> 
> 赞同：3
> 
> 时间：2008-11-07T18:11:47.633
> 
> 标签：java

在从短数组转换为字节数组时，我在网上找到了以下解决方案，但不太了解所涉及的逻辑。

```
//buffer is an array of bytes, bytes[]
buffer[position] = (byte)(sample & 0xff);
buffer[position+1] = (byte)((sample >> 8) & 0xff); 
```

有人可以告诉我为什么将 0xff (256) 与短样本相加吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T18:19:37.057

这段代码可能来自 C 代码（或者是由一个不像 Erickson 那样解析 Java 的 C 程序员编写的）。这是因为在 Java 中，从具有更多信息的类型到具有较少信息的类型的强制转换将丢弃高阶位，因此在这两种情况下都不需要 & 0xff。

短片有 16 位，两个字节。所以它需要在字节数组中占用两个槽，因为如果我们只是将一个短转换成一个字节，一个字节就会丢失。

所以，你拥有的代码

```
1110001100001111 sample
0000000011111111 0xff
0000000000001111 sample & 0xff => first byte` 
```

然后，置换样本以获得第二个字节

```
0000000011100011 sample >> 8
0000000011111111 0xff
0000000011100011 (sample >> 8 ) & 0xff => second byte 
```

正如下面的埃里克森所示，这可能会写得更好（希望它很快就会出现在上面）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T19:29:52.250

其他答案有一些很好的信息，但不幸的是，它们都提出了关于强制转换为字节的错误想法。

在您的原始代码中，这两种情况下`& 0xFF`都是不必要的。

缩小类型会丢弃不适合较窄类型的高阶位。实际上，`& 0xFF`实际上首先将 short 提升为 an`int`并清除最高有效 24 位，然后将其切碎并由强制转换填充到一个字节中。有关详细信息，请参阅[Java 语言规范第 5.1.3 节](http://java.sun.com/docs/books/jls/third_edition/html/conversions.html#25363)。

```
buffer[position] = (byte) sample;
buffer[position+1] = (byte) (sample >>> 8); 
```

另外，请注意我使用零扩展的右移，而不是符号扩展。在这种情况下，由于您立即将移位的结果转换为一个字节，所以没关系。但是，一般来说，运算符会给出不同的结果，您应该慎重选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T18:19:57.647

它确保没有溢出；具体来说，第一行是取“sample”的 LSByte 并屏蔽掉你的高 8 位，只给你 0-255 范围内的值；第二行是获取“样本”的 MSByte（通过执行右移）并做同样的事情。第二行不应该是必要的，因为右移 8 应该去掉 8 个最低有效位，但它确实使代码更加对称。

我认为这是因为由于 sample 是一个短（2 个字节），因此 256-6553 范围内的任何值都会被字节转换解释为 255。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-31T04:41:29.243

```
buffer[position] = (byte)(sample & 0xff);
buffer[position+1] = (byte)((sample >> 8) & 0xff); 
```

一定是 ：

```
buffer[position] = (byte)((sample >> 8) & 0xff);
buffer[position+1] = (byte)(sample & 0xff); 
```

# data-access-layer - 在 BLL 对象中编写一堆 2 个线性函数只是为了重新路由到 DAL 是否值得？

> ID：273038
> 
> 赞同：2
> 
> 时间：2008-11-07T18:13:18.037
> 
> 标签：data-access-layer, bll

这对我来说似乎很愚蠢。我没有得到什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T18:40:25.703

我遇到过这样的情况，我的应用程序调用业务层来选择值列表。然后业务层调用 Dal 进行数据访问。在很多情况下，业务层方法没有明显的原因进行传递，但它确实为将来添加业务逻辑、数据处理等留下了空间。它还有助于保持您的应用程序解耦，这将使测试变得更加容易。

所以，我说保留一行，但是如果您的插入、更新等仍然是一两行，您需要重新考虑您在哪里进行验证和业务级数据处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T18:19:22.937

如果您的 BLL 从不进行验证或实现任何业务逻辑并且始终保持 2 行，那么是的，这很愚蠢。但是，如果您这样做，您可能错过了拥有业务逻辑层的意义，并且您可能一直在 UI 中进行验证，或者在 UI 或 DAL 中添加业务逻辑。很少有应用程序不需要验证并且没有业务逻辑。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T18:38:28.657

尽管 Rob 和 Bullines 通常认为这样做的需要指向更深层次的问题是正确的，但在某些合理的情况下，直接进入数据访问层是非常有意义的。编写一个无脑的方法（或更糟糕的是，整个对象模型）来包装数据访问层是任何程序员所能做的最没用的事情，所以不要这样做。如果有正当理由，您可以对不通过业务逻辑层感到满意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T18:18:58.133

业务逻辑应该在您的 BLL 中。如果您最终在 BLL 中使用“2 个线性函数”，您是否不小心将该业务逻辑放入您的 DAL 或 UI 中？

# iphone - 有没有一种快速的方法来构建和安装到 iPhone（从 Xcode）而不启动应用程序？

> ID：273039
> 
> 赞同：5
> 
> 时间：2008-11-07T18:13:45.447
> 
> 标签：iphone, xcode

在 Xcode 中，我可以使用`CMD`-`R`运行（或`CMD`-`Y`调试），我的应用程序将编译、安装在手机上并启动。（我已经准备好我的手机和 Xcode，所以这部分可以按预期工作。）

我想做***的***是输入 CMD-<something else> 并让我的程序在手机上编译和安装，但*不是*启动。

我意识到我可以`CMD`-`B`构建，然后通过一些 rigamarole 进行部署，但我希望你们中的一个聪明人可以告诉我懒人的所有这一切的捷径。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T18:29:01.343

嘿 Olie，我没有尝试过这个，因为我目前没有要部署的 iPhone，但是这个 /should/ 工作：

您可以在当前项目目录中创建一个运行 xcodebuild 的脚本，并为其提供安装目标。假设您要在某个时候进行调试，请使用 Debug 配置，否则使用 release。然后将脚本绑定到 Xcode 首选项中的某个命令键，您应该就可以了。要使用调试启动 xcodebuild，您可以执行以下操作：

```
xcodebuild install -configuration Debug 
```

如果您的项目中有多个目标，您还必须将其指定给 xcodebuild：

```
xcodebuild install -target iPhoneApp -configuration Debug 
```

您还可以在您的项目中创建特定于该场景的配置并将其传递给 xcodebuild，您应该能够使用您最喜欢的支持语言（即 AppleScript、python、ruby 等）编写此脚本。

高温高压

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-13T03:54:08.200

我有同样的问题。

我最终使用了 XCode Organizer。选择您当前的设备。摘要选项卡。"+" Applications..然后选择你刚刚构建的那个（在/build/[debug|release]-iphoneos/.app下

这很容易安装。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T18:20:29.660

您是否考虑过使用[Automator](http://en.wikipedia.org/wiki/Automator)？这是一篇[很好的](http://developer.apple.com/tools/xcode/automatorforxcode.html)文章，介绍了如何自动化 XCode 来构建以及什么不是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-09T12:33:56.207

**要构建**（“man xcodebuild”下记录的确切标志，安装 xcode 的命令行工具）：

```
xcodebuild build -sdk iphoneos6.0*工作区/项目、目标、配置和/或方案标志*
```

**要安装**（[从 gi​​thub 获取，](https://github.com/cowboygneox/fruitstrap)然后简单地制作并运行）：

```
path/to/fruitstrap --id device *-uuid-to-install-on* --bundle *path/to/ios.app*
```

# python - 使用 GDB 调试 Python 内存

> ID：273043
> 
> 赞同：4
> 
> 时间：2008-11-07T18:13:58.440
> 
> 标签：python, linux, debugging, openssl

我们有一个使用 OpenSSL 的 Python 绑定的 Linux 应用程序，我怀疑它会导致随机崩溃。有时，我们会看到它崩溃并显示以下消息：

> Python 致命错误：已跟踪 GC 对象

这似乎是库的编程错误，或者是内存损坏的症状。有没有办法知道它执行的最后一行 Python 源代码，给定一个核心文件？或者如果它附加在 GDB 中？我意识到这可能都是编译后的字节码，但我希望有人可能已经处理过这个问题。目前它在跟踪模块处于活动状态的情况下运行，我们希望它会再次发生，但这可能需要很长时间。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T18:36:04.900

是的，你可以做这样的事情：

```
(gdb) print PyRun_SimpleString("import traceback; traceback.print_stack()")
  File "<string>", line 1, in <module>
  File "/var/tmp/foo.py", line 2, in <module>
    i**2
  File "<string>", line 1, in <module>
$1 = 0 
```

也应该可以使用`pystack`python [gdbinit](http://svn.python.org/view/python/trunk/Misc/gdbinit?view=auto)文件中定义的命令，但它对我不起作用。如果你想研究它，[这里](http://wiki.python.org/moin/DebuggingWithGdb)会讨论它。

此外，如果您怀疑内存问题，值得注意的是[`valgrind`](http://valgrind.org/)，如果您准备重新编译它，您可以与 python 一起使用。此处描述了该过程[。](http://svn.python.org/projects/python/trunk/Misc/README.valgrind)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T18:20:16.663

如果你有 mac 或 sun box ，你可以使用[dtrace](http://en.wikipedia.org/wiki/DTrace)和一个用 dtrace 编译的 python 版本来确定应用程序当时在做什么。注意：在 10.5 中，python 是使用 dtrace 预编译的，这非常好用。

如果这对您不可用，那么您可以[导入 gc](http://www.python.org/doc/2.5.2/lib/module-gc.html)并启用调试，然后您可以将其输出到日志文件中。

要专门回答有关使用 GDB 调试的问题，您可能需要阅读python wiki 上的“[使用 GDB 调试”。](http://wiki.python.org/moin/DebuggingWithGdb)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T18:59:10.970

如果您使用 CDLL 在 python 中包装 C 库，并且这是 64 位 linux，则很有可能您的 CDLL 包装器配置错误。CDLL 在所有平台上默认为 int 返回类型（在 64 位系统上应该是 long long），并且只希望您传入正确的参数。在这种情况下，您可能需要验证 CDLL 包装器...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:03:15.267

除了以上所有之外，还可以通过[trace 模块](http://www.python.org/doc/2.5.2/lib/module-trace.html)快速实现一个 adhoc 跟踪器。

# .net - 如何确定给定月份的最后一个工作日？

> ID：273048
> 
> 赞同：19
> 
> 时间：2008-11-07T18:16:49.183
> 
> 标签：.net

如何在 .NET 中计算每月的最后一个工作日？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-07T18:54:27.173

我会在周一到周五的工作日这样做：

```
var holidays = new List<DateTime>{/* list of observed holidays */};
DateTime lastBusinessDay = new DateTime();
var i = DateTime.DaysInMonth(year, month);
while (i > 0)
{
  var dtCurrent = new DateTime(year, month, i);
  if(dtCurrent.DayOfWeek < DayOfWeek.Saturday && dtCurrent.DayOfWeek > DayOfWeek.Sunday && 
   !holidays.Contains(dtCurrent))
    {
      lastBusinessDay = dtCurrent;
      i = 0;
    }
    else
    {
      i = i - 1;
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-07T18:31:06.253

假设工作日是周一到周五（这不考虑假期），这个函数应该返回正确的答案：

```
Function GetLastBusinessDay(ByVal Year As Integer, ByVal Month As Integer) As DateTime
    Dim LastOfMonth As DateTime
    Dim LastBusinessDay As DateTime

    LastOfMonth = New DateTime(Year, Month, DateTime.DaysInMonth(Year, Month))

    If LastOfMonth.DayOfWeek = DayOfWeek.Sunday Then 
        LastBusinessDay = LastOfMonth.AddDays(-2)
    ElseIf LastOfMonth.DayOfWeek = DayOfWeek.Saturday Then
        LastBusinessDay = LastOfMonth.AddDays(-1)
    Else
        LastBusinessDay = LastOfMonth
    End If

    Return LastBusinessDay

End Function 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-10T10:32:36.390

我可以想到这个简单的 C# 代码，它为您提供当月的最后一个工作日。这只需要周六或周日为假期。应手动处理特定国家/地区的当地节假日。

```
private DateTime GetLastBusinessDayOfCurrentMonth()
{
    var lastDayOfCurrentMonth = new DateTime(DateTime.Now.Year, DateTime.Now.Month,  DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month));

    if(lastDayOfCurrentMonth.DayOfWeek == DayOfWeek.Sunday)
        lastDayOfCurrentMonth = lastDayOfCurrentMonth.AddDays(-2);
    else if(lastDayOfCurrentMonth.DayOfWeek == DayOfWeek.Saturday)
        lastDayOfCurrentMonth = lastDayOfCurrentMonth.AddDays(-1);

    return lastDayOfCurrentMonth;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-07T18:21:00.453

首先，获取该月的最后一天。然后继续递减，直到你过了月初，或者达到了一个确认为“工作日”的日期。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-07T18:28:36.990

通用，伪代码：

```
Day day = getLastDayOfMonth
int days = getDaysInMonth
for i = days to 0
  if day is weekday
    if day is not holiday
      return day
    end if
  end if
  day = prevDay
  days--
end for

throw exception because no business day was found in the month 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-10-14T19:01:06.997

使用 LINQ：

```
 public static DateTime GetLastBussinessDayCurrentMonth(DateTime[] holidays)
   {
        DateTime todayDateTime = DateTime.Today;

        return
            Enumerable.Range(1, DateTime.DaysInMonth(todayDateTime.Year, todayDateTime.Month))
                .Select(day => new DateTime(todayDateTime.Year, todayDateTime.Month, day))
                .Where(
                    dt =>
                    dt.DayOfWeek != DayOfWeek.Sunday && dt.DayOfWeek != DayOfWeek.Saturday
                    && (holidays == null || !holidays.Any(h => h.Equals(dt))))
                .Max(d => d.Date);
   } 
```

## 解释

创建一个整数列表，其中包含月份中可用的所有日期

```
 Enumerable.Range(1, DateTime.DaysInMonth(todayDateTime.Year, todayDateTime.Month)) 
```

仅过滤不属于周末和不属于节假日的日子

```
 .Where(
                dt =>
                dt.DayOfWeek != DayOfWeek.Sunday && dt.DayOfWeek != DayOfWeek.Saturday
                && (holidays == null || !holidays.Any(h => h.Equals(dt)))) 
```

使用过滤的日期创建新的日期时间

```
 .Select(day => new DateTime(todayDateTime.Year, todayDateTime.Month, day))

            .Max(d => d.Date); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-16T20:15:01.267

我想出了一个额外的方法，可以用来获取最近的前一个或当前工作日，然后可以用来获取本月的最后一个工作日 - 如果您正在调整周末假期，这也考虑在内：

```
public static DateTime LastBusinessDayInMonth(int year, int month, bool adjustForWeekend = true)
{
    var lastDay = DateTime.DaysInMonth(year, month);
    return PreviousOrCurrentBusinessDay(new DateTime(year, month, lastDay), adjustForWeekend);
}

public static DateTime PreviousOrCurrentBusinessDay(DateTime? beforeOrOnDate = null, bool adjustForWeekend = true)
{
    var fromDate = beforeOrOnDate ?? DateTime.Today;
    var year = fromDate.Year;
    var month = fromDate.Month;
    var day = fromDate.Day;
    var holidays = UsHolidays(fromDate.Year, true).ToList(); // defined below
    var dtCurrent = new DateTime(year, month, day);

    while (!(dtCurrent.DayOfWeek < DayOfWeek.Saturday && dtCurrent.DayOfWeek > DayOfWeek.Sunday && !holidays.Contains(dtCurrent)))
    {
        dtCurrent = dtCurrent.AddDays(-1);
    }
    return dtCurrent;
} 
```

我还在我的计算中使用了美国假期，这是我从查看这篇文章中开发的以下代码中获得的：http: [//geekswithblogs.net/wpeck/archive/2011/12/27/us-holiday-list-in- c.aspx](http://geekswithblogs.net/wpeck/archive/2011/12/27/us-holiday-list-in-c.aspx)

代码可以在这里看到：

```
public static IEnumerable<DateTime> UsHolidays(int year, bool adjustForWeekend)
{
    return new List<DateTime>()
    {
        NewYears(year, adjustForWeekend),
        MlkDay(year),
        PresidentsDay(year),
        GoodFriday(year),
        MemorialDay(year),
        IndependenceDay(year, adjustForWeekend),
        LaborDay(year),
        Thanksgiving(year),
        Christmas(year, adjustForWeekend),
    };
}

public static DateTime NewYears(int year, bool adjustForWeekend)
{
    //NEW YEARS 
    return adjustForWeekend ? AdjustForWeekendHoliday(new DateTime(year, 1, 1).Date) : new DateTime(year, 1, 1).Date;
}

public static DateTime MemorialDay(int year)
{
    //MEMORIAL DAY  -- last monday in May 
    var memorialDay = new DateTime(year, 5, 31);
    var dayOfWeek = memorialDay.DayOfWeek;
    while (dayOfWeek != DayOfWeek.Monday)
    {
        memorialDay = memorialDay.AddDays(-1);
        dayOfWeek = memorialDay.DayOfWeek;
    }
    return memorialDay.Date;
}

public static DateTime IndependenceDay(int year, bool adjustForWeekend)
{
    //INDEPENCENCE DAY 
    return adjustForWeekend ? AdjustForWeekendHoliday(new DateTime(year, 7, 4).Date) : new DateTime(year, 7, 4).Date;
}

public static DateTime LaborDay(int year)
{
    //LABOR DAY -- 1st Monday in September 
    var laborDay = new DateTime(year, 9, 1);
    var dayOfWeek = laborDay.DayOfWeek;
    while (dayOfWeek != DayOfWeek.Monday)
    {
        laborDay = laborDay.AddDays(1);
        dayOfWeek = laborDay.DayOfWeek;
    }
    return laborDay.Date;
}

public static DateTime Thanksgiving(int year)
{
    //THANKSGIVING DAY - 4th Thursday in November 
    var thanksgiving = (from day in Enumerable.Range(1, 30)
                        where new DateTime(year, 11, day).DayOfWeek == DayOfWeek.Thursday
                        select day).ElementAt(3);
    var thanksgivingDay = new DateTime(year, 11, thanksgiving);
    return thanksgivingDay.Date;
}

public static DateTime Christmas(int year, bool adjustForWeekend)
{
    return adjustForWeekend ? AdjustForWeekendHoliday(new DateTime(year, 12, 25).Date) : new DateTime(year, 12, 25).Date;
}

public static DateTime MlkDay(int year)
{
    //Martin Luther King Day -- third monday in January
    var MLKDay = new DateTime(year, 1, 21);
    var dayOfWeek = MLKDay.DayOfWeek;
    while (dayOfWeek != DayOfWeek.Monday)
    {
        MLKDay = MLKDay.AddDays(-1);
        dayOfWeek = MLKDay.DayOfWeek;
    }
    return MLKDay.Date;
}

public static DateTime PresidentsDay(int year)
{
    //President's Day -- third monday in February
    var presDay = new DateTime(year, 2, 21);
    var dayOfWeek = presDay.DayOfWeek;
    while (dayOfWeek != DayOfWeek.Monday)
    {
        presDay = presDay.AddDays(-1);
        dayOfWeek = presDay.DayOfWeek;
    }
    return presDay.Date;
}

public static DateTime EasterSunday(int year)
{
    var g = year % 19;
    var c = year / 100;
    var h = (c - c / 4 - (8 * c + 13) / 25 + 19 * g + 15) % 30;
    var i = h - h / 28 * (1 - h / 28 * (29 / (h + 1)) * ((21 - g) / 11));

    var day = i - ((year + year / 4 + i + 2 - c + c / 4) % 7) + 28;
    var month = 3;

    if (day > 31)
    {
        month++;
        day -= 31;
    }

    return new DateTime(year, month, day);
}

public static DateTime GoodFriday(int year)
{
    return EasterSunday(year).AddDays(-2);
}

public static DateTime AdjustForWeekendHoliday(DateTime holiday)
{
    if (holiday.DayOfWeek == DayOfWeek.Saturday)
    {
        return holiday.AddDays(-1);
    }
    return holiday.DayOfWeek == DayOfWeek.Sunday ? holiday.AddDays(1) : holiday;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T18:49:46.213

```
Function GetLastDay(ByVal month As Int32, ByVal year As Int32) As Date
        Dim D As New Date(year, month, Date.DaysInMonth(year, month))
        For i As Integer = 0 To Date.DaysInMonth(year, month)
            Select Case D.AddDays(-i).DayOfWeek
                Case DayOfWeek.Saturday, DayOfWeek.Sunday 'Not a weekday
                Case Else  'Is a weekday.  Flag as first weekday found
                    Return D.AddDays(-i)
                    'you can add other code here which could also do a check for holidays or ther stuff since you have a proper date value to look at in the loop
            End Select
        Next
End Function 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2015-12-12T03:25:07.077

以下是如何在 C# 中找到一个月的最后一天：

```
DateTime today = DateTime.Today;
DateTime endOfMonth = new DateTime(today.Year,
                                   today.Month,
                                   DateTime.DaysInMonth(today.Year,
                                   today.Month)); 
```

[来源](http://geekprogrammers.com/question/how-can-i-find-the-last-day-of-the-month-in-c/)

# javascript - element.cloneNode(true)（深度克隆）的效率如何？

> ID：273054
> 
> 赞同：5
> 
> 时间：2008-11-07T18:18:13.377
> 
> 标签：javascript, xml, clonenode

我正在 XML DOM 对象中构建 HTML 代码，以用作使用 XSL 模板的 div 元素的 innerHTML 的内容。传统上，我们创建一个新的 XML DOM 文档，并将输入参数添加为 XML 元素，以便通过 javascript 进行转换。这一切都非常耗时，因为我们基本上是从另一个代表我们当前帐户的 XML 文档中手动挑选数据并将数据复制到临时 XML DOM 文档中。

我想做的是克隆帐户文档的相关节点（即客户信息）并将其用作转换的基础。我不想直接使用帐户文档，因为我希望能够添加特定于转换的输入，而无需更改帐户对象。

对于通常包含 2000 多个元素的文档中通常少于 200 个元素的所需节点，使用 .cloneNode(true) 的效率如何？目标平台是 IE6，没有外部工具（即 ActiveX）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-08T10:52:16.663

CloneNode 非常高效，但这样做会消耗更多内存。

要考虑的另一种方法是使用模板对象和处理器，将附加/更改的数据作为参数传递给处理器，并将原本克隆为输入元素的元素传递给处理器。不过，这种方法需要相当重要的 XSL 模块。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T18:56:12.223

IE 在某些事情上会失败。

例如，当您将副本添加到 DOM 时，将不会检查选中的单选框/复选框。

例子：

[http://webbugtrack.blogspot.com/2008/03/bug-199-cant-clone-form-element-in-ie.html](http://webbugtrack.blogspot.com/2008/03/bug-199-cant-clone-form-element-in-ie.html)

[http://webbugtrack.blogspot.com/2007/08/bug-242-setattribute-doesnt-always-work.html](http://webbugtrack.blogspot.com/2007/08/bug-242-setattribute-doesnt-always-work.html)

要查看 IE 实际返回的内容，请尝试在其中一个页面的地址栏中将 url 替换为此，然后按 enter。

```
javascript:'<xmp>'+window.document.body.outerHTML+'</xmp>'; 
```

如果您对结果感到满意，那就太好了！但我认为您最终会对 IE 返回的结果不满意（在 DOM 中，以及这个“字符串”值等价物。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T23:05:28.320

如果您不需要表单元素，cloneNode 是一个真正可靠的工具......

- 在插入 ajax-data 时，效率令人难以置信......

然而，尤其是 IE 有名称属性问题的历史，如果您插入数据，解决其中任何一个问题都是不方便的......

- 我不太了解您的 XSL(T) 使用方式，对我来说，这听起来像是将加油站用作（不是！-）将 1960 WV 更改为 2008 斯柯达的方便场所......

通常他们有一些共同的技术，虽然它的使用方式不同，计算机化在某种程度上只是一个小问题，主要问题几乎是**任何**其他方式！o]

您是否需要表单元素？-)

# java - 测试 Web 服务使用者

> ID：273060
> 
> 赞同：2
> 
> 时间：2008-11-07T18:19:54.763
> 
> 标签：java, python, web-services, testing, integration-testing

以下是我发现的一些用于测试 Web 服务使用者的工具：

[http://www.soapui.org/](http://www.soapui.org/) [https://wsunit.dev.java.net/](https://wsunit.dev.java.net/)

还有其他人吗？我更喜欢用 Java 或 Python 编写的测试框架。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T21:23:27.793

我通过一个 Maven 插件使用了 soapui。它可以创建 junit-linke 报告以像单元测试一样运行和分析。这可以很容易地集成到连续构建中，也可以免费分发soapui。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-09T19:20:43.670

我用过[Web Service Studio](http://www.codeplex.com/WebserviceStudio)。

> **Web Service Studio**是一个交互式调用 Web 方法的工具。用户可以提供一个 WSDL 端点。单击“获取”按钮后，该工具将获取 WSDL，从 WSDL 生成 .NET 代理并显示可用方法列表。用户可以选择任何方法并提供所需的输入参数。单击 Invoke 时，SOAP 请求被发送到服务器并解析响应以显示返回值。
> 
> 该工具旨在让 Web 服务实现者无需编写客户端代码即可测试其 Web 服务。这也可用于访问已知 WSDL 端点的其他 Web 服务。

Eclipse 中的**Web 服务资源管理器也是**[Web 工具平台](http://www.eclipse.org/webtools/)的一部分。

> 通过 UDDI 和 WSIL，其他应用程序可以发现 WSDL 文档并与之绑定以执行事务或执行其他业务流程。Web Services Explorer 允许您探索、导入和测试 WSDL 文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T18:36:57.193

Grinder 是您的 Java 和 Python 盟友，可处理大多数 Web 服务（SOAP/REST/CORBA/RMI/JMS/EJB）等。

[http://grinder.sourceforge.net/](http://grinder.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T16:36:36.760

您确实需要更具体：您想在您的 WS-consumer 中测试什么？那它叫正确的WS？这看起来有点毫无意义 - WS 是一个完美的地方，可以模拟任何可能被调用的东西 - 没有任何东西被调用。

为了测试消费者，否则您将编写一个模拟原始的 Web 服务，对吗？我假设通过线路的通信协议不是客户端域 - 例如它是生成的。因此，WS-consumer 的客户看到的唯一东西就是接口。并且没有什么可以在界面中测试的。

可能是我完全误解了你的问题 - 如果我理解了，请澄清。到时候我会修改答案。

# iphone - iPhone SDK - UIWebView 上面有一个灰色框

> ID：273067
> 
> 赞同：4
> 
> 时间：2008-11-07T18:22:03.417
> 
> 标签：iphone, cocoa-touch

有时，我的 UIWebView 在部分或全部内容上会有一个灰色框。我无法弄清楚为什么会发生这种情况。对于某些内容，它会定期发生。

谢谢！

- 更新 -

当 webview 不能立即在屏幕上查看时，它似乎会发生 - 即我有一个滚动视图，并且 webview 位于折叠下方。

--更新#2--

当我将内容放在首屏时，它大部分时间都加载得很好。仍然存在灰色框仍然出现的情况。奇怪的是，如果我双击它，它会很好地完成加载内容。离奇的

--更新#3--

好的，所以看起来如果我的 uiwebview 的高度大于 1000px，则在 1000px 以下的其余内容上会出现一个灰色框。双击显示实际内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T09:47:19.893

所有 UIView 的大小限制为 1024x1024 像素。这在 UIView 文档的概述部分的末尾进行了说明。

如果您的 Web 视图必须包含超过 1024 像素的内容，则必须将其从父滚动视图中取出并让它自己管理滚动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-31T14:11:15.997

在 UIWebView 中轻推 UIScrollView 它为我解决了这个问题：

```
[UIScrollView *webScroller= [[webView subviews] lastObject];    
[webScroller setContentOffset:CGPointMake(0,1) animated:NO];
[webScroller setContentOffset:CGPointMake(0,0) animated:NO]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T18:49:19.447

我也一直在处理这个故障，并在苹果打开了一个错误报告。我会在上面发表评论，但我还没有 50 个代表。

对于遇到此故障的任何其他人，请向他们发送报告，我包括一个完整的项目来演示它，以及我正在开发的另一个应用程序的一些屏幕截图。显然，他们收到的关于某个主题的错误报告越多，他们就越有可能解决这个问题。

[https://bugreport.apple.com/](https://bugreport.apple.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T11:00:27.520

我有同样的问题。我在一个大的 TableViewCell (>1024px) 中放置了一个 UIWebView，当我滚动到单元格的底部时，会出现这个灰色框。

但是，如果我放一个 UILabel （也有 > 1024px 的大尺寸），就没有灰框了。所以我认为这与 UIView 的最大高度无关（顺便说一句，我找不到关于这个所谓的 1024 最大高度的任何信息）。我认为这更像是一个 UIWebView 问题。

我的解决方案是在出现灰色框时重新加载 webview 的内容。实际上，我只是要加载一个 HTMLString，所以我再次调用 [webview loadHTMLstring:]，灰色框消失了。

希望这会有所帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-06T09:17:31.390

我发现了一个非常有趣的帖子，它为我解决了这个问题： [链接 ttp://pinchzoom.com/blog/items/view/1386/one-of-the-problems-with-the-uikit-at-the -moment-is-an-issue-embedding-a-uiwebview-within-a-table](http://pinchzoom.com/blog/items/view/1386/one-of-the-problems-with-the-uikit-at-the-moment-is-an-issue-embedding-a-uiwebview-within-a-table)

希望有帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-25T16:55:19.017

我使用了 stringByEvaluatingJavaScriptFromString 加上移动 UIWebView 原点。设计概述：我在上面有一组控件（本例中为 UIImage）（我的意思是 frame.origin.y）UIWebView。所以，布局是：

```
UIView
  UIScrollView
    UIImageView
    UIWebView 
```

由于 UIWebView 不支持在这种层次结构中滚动，我将其重新排列为：

```
UIView
  UIScrollView
    UIImageView
  UIWebView 
```

我的视图控制器是 UIWebViewDelegate 和 UIScrollViewDelegate 的代表。然后，

```
- (void)viewDidLoad
{
  // set delegates
  self.scrollView.delegate = self;
  self.webView.delegate = self;

  // store original UIWebView position in ivar
  webViewPosY = self.webView.frame.origin.y;

  // load html into UIWebView
  [self.webView loadHTMLString:someHTML baseURL:nil];
}

- (void)webViewDidFinishLoad:(UIWebView *)webView
{
  // get UIWebView size and store in ivar
  webSize = [self.webView sizeThatFits:CGSizeMake(1.0,1.0)];

  // set proper content height for UIScrollView
  CGSize contentSize = self.scrollView.contentSize;
  contentSize.height = webViewPosY + webSize.height;
  self.scrollView.contentSize = contentSize; 

  // set UIWebView's frame height same as UIScrollView has
  CGRect wf = self.webView.frame;
  wf.size.height = self.scrollView.frame.size.height;
  self.webView.frame = wf;
}

// scrolling logic:
// 1\.  if origin of UIWebView > 0 then move UIWebView itself
// 2\.  if origin of UIWebView == 0 then scroll with javascript
// 3\.  if origin is 0 and whole html is scrolled then move UIWebView again(this happens to support scroll "bouncing", or if you have some views below UIWebView
- (void)scrollViewDidScroll:(UIScrollView *)scrollView
{
  CGFloat scrollPosY = self.scrollView.contentOffset.y;

  // (1) and (2) ifs
  // how much to move UIWebView
  CGFloat scrollOriginY = (scrollPosY >= webViewPosY) ? webViewPosY : scrollPosY;
  // how much to scroll via JS
  CGFloat scrollJSY = scrollPosY - scrollOriginY;

  // (3) if
  if ( scrollPosY > (webSize.height - scrollViewSize.height + webViewPosY ) )
    scrollOriginY += scrollPosY - (webSize.height - scrollViewSize.height + webViewPosY);

  // scroll with JS
  [self.webView stringByEvaluatingJavaScriptFromString:[NSString stringWithFormat:@"document.body.scrollTop = %f;", scrollJSY]];

  // move UIWebView itself
  CGRect wf = self.webView.frame;
  wf.origin.y = webViewPosY - scrollOriginY;
  self.webView.frame = wf;
} 
```

这对我来说很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-05T23:03:56.703

我在动态调整 UIWebView 大小时遇到​​了同样的问题。这对我有用：

```
#define LAYER_FOR(ui)                        [(ui) layer]
#define FRAME_FOR(ui)                        [LAYER_FOR((ui)) frame]
#define SET_FRAME_FOR(ui, frame)             [LAYER_FOR((ui)) setFrame: (frame)]

+ (void) setHeightTo: (CGFloat *) height_ptr forView: (UIView *) a_view {
  CGFloat height = *height_ptr;

  CGRect existing_frame = [[a_view layer] frame];
  existing_frame.size.height = height;

  // need to reassign the same frame !?
  NSLog(@"setting text view: %@ to height: %f", a_view, (float) height);
  SET_FRAME_FOR(a_view, existing_frame);
}

+ (void) resizeWebView: (UIWebView *) webView {
  NSString *js = @"                                                                                               \
    var __html_element = document.getElementsByTagName('html')[0];                                                \
    var __height_string = document.defaultView.getComputedStyle(__html_element, null).getPropertyValue('height'); \
    __height_string.replace('px', ''); \
  ";

  NSString *heightString = [webView stringByEvaluatingJavaScriptFromString: js];
  float height = [heightString floatValue];

  if (height != UI_VIEW_HEIGHT(webView)) {
    [self setHeightTo: &height forView: webView];

    // resize scrollView inside webview to the same height
    UIScrollView *webScroller = [[webView subviews] lastObject];
    [self setHeightTo: &height forView: webScroller];
  }
} 
```

我从 webview 的委托 'webViewDidFinishLoad:' 方法中调用了这段代码。

基本上，诀窍是在 webview 中调整 webScroller 的大小。

感谢Padraig 建议轻推webview 的子视图（滚动视图）。

# c# - 在 C# Windows 应用程序中存储静态用户数据

> ID：273081
> 
> 赞同：3
> 
> 时间：2008-11-07T18:26:14.220
> 
> 标签：c#, singleton, global-variables

我有一个应用程序需要在启动应用程序时点击 ActiveDirectory 以获取用户权限/角色，并在整个过程中持续存在。

我不想在每个表单上都点击 AD 来重新检查用户的权限，所以我希望用户的角色以及登录用户的其他数据在应用程序中的任何表单上都可以全局使用，这样我就可以正确必要时隐藏功能、按钮等。

就像是：

```
if (UserProperties.Role == Roles.Admin)
{
    btnDelete.Visible = false;
} 
```

在 Windows 应用程序中存储静态用户数据的最佳做法是什么？单例或全局变量等解决方案可能有效，但我试图避免这些。

传递给每个表单的构造函数的用户对象是否同样糟糕？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T19:22:40.843

使用[WindowsPrincipal](http://msdn.microsoft.com/en-us/library/system.security.principal.windowsprincipal.aspx)、[GenericPrincipal](http://msdn.microsoft.com/en-us/library/system.security.principal.genericprincipal.aspx)或您的自定义主体设置[Thread.CurrentPrincipal 。](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentprincipal.aspx)然后，您可以调用[IsInRole](http://msdn.microsoft.com/en-us/library/system.security.principal.iprincipal.isinrole.aspx)：

```
if (Thread.CurrentPrincipal.IsInRole(Roles.Admin)) {
   btnDelete.Visible = false;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T18:31:26.143

也许我的判断因我频繁使用 javascript 而蒙上阴影，但我认为如果你有一些**意味着**全局的东西，那么使用全局变量是可以的。

当您在全球范围内公开不应该的事情时，全球范围就很糟糕。如果在语义上对于数据的预期用途是正确的，则全局是可以的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T18:30:53.913

您可以在 Windows 应用程序中使用来自 asp.net 的配置文件提供程序。看看[@http://fredrik.nsquared2.com/viewpost.aspx?PostID=244&showfeedback=true](http://fredrik.nsquared2.com/viewpost.aspx?PostID=244&showfeedback=true)

希望它有所帮助，布鲁诺·菲格雷多 [http://www.brunofigueiredo.com](http://www.brunofigueiredo.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:29:42.327

如果您想将数据范围限定为应用程序实例（或 AppDomain），则静态数据（或单例）似乎很好。

但是，鉴于您实际上是在谈论缓存用户的安全凭证，您可能需要仔细考虑安全漏洞。例如，如果用户让应用程序运行几天会发生什么？他们可能正在使用他们几天前的凭据而不是他们最新的凭据执行操作。根据您要保护的内容，您最好按需检查凭据，或者至少定期使缓存的凭据过期。

# windows-mobile - GPRS 信息 - 手机

> ID：273086
> 
> 赞同：0
> 
> 时间：2008-11-07T18:27:29.363
> 
> 标签：windows-mobile, gprs

我的规格几乎是世界上最差的。存在并用于工作的应用程序。我的目标是重新创建这个应用程序并让它工作。

这是一个*非常*简单的工具，它只在屏幕上显示以下信息：

*   ARFCN - 绝对射频频道编号
*   LAC - 小区的位置区域代码（在 PLMN 中唯一）
*   RAC - 小区的路由区域标识符代码（在 PLMN 中唯一）
*   MNC / MCC - 移动网络代码/移动国家代码
*   NCellInfo1-6 - ?
*   接收质量 -
*   跳频 -
*   最后注册的网络
*   TMSI - ?
*   定期位置更新值
*   乐队
*   正在使用的频道
*   RSSI 1 - 接收信号强度指示
*   最后通话释放原因

我希望我可以通过 OpenNETCF 的网络信息获得其中的一些信息，可能是某处的一些 P/Invokes 或（最坏的情况）某种我需要为设备（及其利基设备）找到的自定义 SDK我希望不是这样）。

但是，希望利用 Stackoverflow 的强大功能，我想知道是否有人能够指出我正确的方向以从设备上获取这些数据。任何人都知道专门提供此类信息的任何库吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:06:53.080

OpenNETCF 的 NetworkInformation 命名空间无济于事——它是 NDIS 和 WZC 的包装器，对电话来说用处不大。与此相关的是[Telephony API (TAPI)](http://msdn.microsoft.com/en-us/library/aa450239.aspx)，尽管我怀疑 TAPI 是否会提供所有这些信息（自从我与 TAPI 战斗以来已经有一段时间了）。

我的猜测是您将能够通过 TAPI 获取一些信息，但其中很多信息可能是通过无线电供应商提供的专有 API 检索到的，并且没有关于该 API 的信息（来自无线电供应商或设备OEM）你可能不走运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T22:23:17.750

我不能说出所有这些信息，但大部分信息可以从 RIL（无线电接口层）获得。

[http://msdn.microsoft.com/en-us/library/aa920475.aspx](http://msdn.microsoft.com/en-us/library/aa920475.aspx)

我不确定您是否能够使用 C# 访问 RIL 层，因为您必须提供 C 函数回调。

您从 RIL_GetCellTowerInfo 函数获得的信号塔信息和您从 RIL_GetSignalQuality 函数获得的信号质量信息。浏览 MSDN 文档以获取您想要获取的信息。

# sql - 与 SQL Server 兼容的数据库迁移的良好框架是什么？

> ID：273102
> 
> 赞同：0
> 
> 时间：2008-11-07T18:33:17.090
> 
> 标签：sql, sql-server, schema, migration, revision

我被 ActiveRecords 宠坏了。因此，我正在寻找可以应用于 SQL Server 的迁移系统，并且可以作为 Java 应用程序或 Win32 可执行文件执行。（当然欢迎进一步兼容其他数据库和主机操作系统。）

真正的愿望是拥有一个清晰的带有回滚的模式更改应用程序，理想情况下是比 SQL 更好的东西，这样它就可以与数据库系统无关。

我发现基于 Java 的替代方案的障碍是缺乏对 Microsoft JDBC 的干净支持。

期待任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T11:36:36.337

查看 Ben Sheirmans 关于该主题的出色帖子：

[http://flux88.com/blog/net-database-migration-tool-roundup/](http://flux88.com/blog/net-database-migration-tool-roundup/)

我尝试了 Tarantino，它工作正常，但你仍然被锁定在 sql server 的 sql 脚本中。

/安德斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-28T22:43:34.913

试试螨虫。我写了它并且已经成功使用了很多年。

[https://github.com/soitgoes/mite](https://github.com/soitgoes/mite)

如果您打开“自动生成更改脚本”，那么 Sql Management Studio 将生成您可以保存到 mite 文件中的 sql。无需再编写迁移，只需让 Management Studio 为您完成！然后，如果您需要定制一些东西来更改数据，您可以简单地在 sql 中执行此操作并将其保存到迁移中。

![在此处输入图像描述](https://i.stack.imgur.com/yP7rD.jpg)

让我知道你的想法。

# vb.net - 如何抑制 VS2005 (VB.Net) 中特定功能的编译器警告

> ID：273103
> 
> 赞同：6
> 
> 时间：2008-11-07T18:33:21.520
> 
> 标签：vb.net, visual-studio-2005, compiler-construction

我有一个从基类继承并实现以下内容的类...

```
 Public Function CompareTo(ByVal obj As Object) As Integer Implements System.IComparable.CompareTo 
```

现在它继承的基类也实现了这个 System.IComparable.CompareTo 所以我收到以下编译器警告：

*警告：“System.IComparable.CompareTo”已由基类实现。重新实现假定的功能。*

我对此很好，所以我的问题是如何仅针对此功能抑制此警告（即不是所有此类警告）。

**说明：**

*   这是MSDN 上的错误[链接。](http://msdn.microsoft.com/en-us/library/dwwt4s94(VS.80).aspx)
*   我已经尝试过阴影和覆盖，但都没有消除警告。
*   警告不在方法本身上（除非省略阴影或覆盖），而是专门在“实现 System.IComparable.CompareTo”上。
*   我不想压制所有这种类型的警告（如果它们突然出现），只是这个。

**解决方案：**
我希望使用 System.Diagnostics.CodeAnalysis.SuppressMessage 属性或 C# 的 #pragma 之类的属性，但看起来无法抑制单行的警告。不过，有一种方法可以关闭此项目的此消息，而无需关闭*所有*警告。

我手动编辑了 .vbproj 文件，并将 42015 包含在节点中以进行调试和发布编译。不理想，但比总是在 IDE 中看到警告要好。

如果有人有更好的解决方案，请添加它，我很乐意尝试标记答案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-02-24T09:28:13.087

仅在基类中使用“实现”：

基类中的签名：

```
Public Overridable Function CompareTo(ByVal obj As Object) As Integer Implements System.IComparable.CompareTo 
```

继承类中的签名：

```
Public Overrides Function CompareTo(ByVal obj As Object) As Integer 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T14:18:31.443

您可以使用抑制警告来抑制一个警告。有关如何操作的[更多信息](http://msdn.microsoft.com/en-us/library/ms182069(VS.80).aspx)，请参见此处。您还可以使用[SuppressMessage 属性](http://msdn.microsoft.com/en-us/library/ms182068(VS.80).aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-13T17:04:53.437

如果您无权访问基类，因此无法将方法设为 Overrideable，则可以将其添加`<NoWarn>42015</NoWarn>`到项目文件中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-07T18:36:47.613

在项目的属性上，转到构建选项卡并使用抑制警告文本框。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-07T18:41:20.007

将关键字 Shadows 添加到函数定义中。

```
Public Shadows Function CompareTo(ByVal obj As Object) As Integer Implements System.IComparable.CompareTo 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-07T18:43:11.440

而不是压制警告，你不应该修复它吗？假设基础是可覆盖的，

```
Public Overrides Function CompareTo(ByVal obj As Object) As Integer Implements System.IComparable.CompareTo 
```

如果没有，那就遮蔽它，

```
Public Shadows Function CompareTo(ByVal obj As Object) As Integer Implements System.IComparable.CompareTo 
```

（我认为这是正确的，我是一名 C# 程序员。如果不是，请发表评论，我会更新。）

# google-docs - 谷歌文档大量下载

> ID：273119
> 
> 赞同：3
> 
> 时间：2008-11-07T18:37:25.630
> 
> 标签：google-docs

这些天来，我将大部分开发笔记和文档保存在 Google Docs 中。有时间我想下载所有东西。这怎么可能在 Mac 和 Linux 计算机上，而不是单独做每一个？谷歌曾经有能力下载所有的电子表格。但是，我再也找不到这个功能了。

我想要 Open Office 或 HTML 格式的文档。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T23:04:46.097

如果您在浏览器中安装 google gears：http: [//gears.google.com/](http://gears.google.com/)

您可以使用谷歌文档中的内置离线功能

如果您真的想卷起袖子，请使用 gdata API

[http://code.google.com/p/gdatacopier/](http://code.google.com/p/gdatacopier/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-19T21:24:09.400

我调查了乔的回答。gdatacopier 是一个批量下载文档的有用工具。这是我用来从命名文件夹下载所有电子表格的一个示例。

```
gdoc-cp.py -e csv -g 电子表格 -o /tmp -u me@gmail.com -p 密码 -f "MyFolder"

```

文档中有几个示例。一个限制是它似乎不适用于托管域。所有电子邮件地址必须是 foo@gmail.com。

批量上传似乎也很可行。让这个例子工作是直截了当的。

[http://www.webmonkey.com/tutorial/Create_Automated_Backups_in_Google_Docs_Using_the_GData_API](http://www.webmonkey.com/tutorial/Create_Automated_Backups_in_Google_Docs_Using_the_GData_API)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-21T16:22:15.730

GDocBackup [http://gs.fhtino.it/gdocbackup](http://gs.fhtino.it/gdocbackup)
C#，开源，在 Win + Net 和 Linux + Mono 上运行（未在 Mac + Mono 上测试，抱歉）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-01T19:06:26.720

[您可以使用Google Drive API](http://developers.google.com/drive)轻松完成此操作。我有一篇[博客文章](http://wescpy.blogspot.com/2016/07/exporting-google-sheet--as-csv.html)，其中包含一个简短的 Python 脚本，可将 Google Sheet 导出为 CSV。您可以举这个例子，并进行以下更改以使其适合您：

1.  **源**MIMEtype 从 Sheets 到 Docs - 对于所有 G Suite/Google Apps ( *import* ) MIMEtypes，请参阅[此页面](http://developers.google.com/drive/v3/web/mime-types)
2.  **目标**MIMEtype 从 CSV 更改为*您想要支持的任何内容*（包括 Open Office 和 HTML）——对于所有*导出*MIMEtype，请参阅[此页面](http://developers.google.com/drive/v3/web/manage-downloads#downloading_google_documents)

如果您更喜欢使用 Python 以外的其他东西，请将该示例用作伪代码，然后以[Google APIs Client Libraries](http://developers.google.com/discovery/libraries)支持的任何语言创建您的解决方案。其他语言的示例代码也可以在[此页面](http://developers.google.com/drive/v3/web/manage-downloads)上找到。

完成后，将其粘贴在一些 cron 作业中以定期运行它，而无需考虑它——您可能必须为导出的文件名添加时间戳以防止覆盖。希望这可以帮助！

# asp.net - HttpContext 如何通过请求-响应进行维护

> ID：273126
> 
> 赞同：1
> 
> 时间：2008-11-07T18:39:06.813
> 
> 标签：asp.net, httpcontext

我想知道如何维护 HttpContext ，因为 Web 的请求-响应性质本质上是无状态的。

HttpContext 对象的标识符是否作为 __EVENTTarget / __EVENTARGUMENTS 隐藏字段的一部分发送，以便 HttpRuntime 类可以通过从请求 (HttpWorkerRequest) 中读取此部分来创建 HttpContext 类？我不认为

请让我知道，因为我试图填补我对 http 管道的理解中的一些漏洞，但我找不到任何有关此的信息。

我理解类似 HttpContext.Current.Session["myKey"] = Value;

只是工作，但如果我必须用不同的语言（比如 perl）做类似的事情，我将不得不使用相同的隐藏字段，不是吗？

谢谢-维努

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T19:04:52.410

为每个请求重新创建 HttpContext。但是，HttpSession 跨请求存储在服务器上。基本上，HttpSession 是一个 Dictionary<string, Dictionary<string, object>>。初始键，即会话 ID，由 cookie 或查询字符串参数（如果使用无 cookie 会话）提供。如果您使用 Fiddler，您将看到 ASP.NET_SessionId cookie，其中包含该用户会话的密钥。

在代码中：

```
class HttpSessionState {
   private static readonly Sessions = 
     new Dictionary<string, Dictionary<string, object>>();

   public object this(string key) {
      get {
         return GetCurrentUserSession()[key]
      }
      set {
         GetCurrentUserSession()[key] = value;
      }
   }

   private Dictionary<string, object> GetCurrentUserSession() {
      var id = GetCurrentUserSessionId[]
      var d = Sessions[id];
      if (d == null) {
         d = new Dictionary<string, object>();
         Sessions[id] = d;
      }
      return d;
   }

   private string GetCurrentUserSessionId() {
      return HttpContext.Current.Request.Cookies["ASP.NET_SessionId"].Value;
   }
} 
```

真正的实现还处理会话超时、放弃和无 cookie 会话——但基本思想是相同的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T18:47:08.140

我认为您的问题没有一个答案，因为我不认为 HttpContext 保护伞下的所有内容都以相同的方式工作。在您选择的示例中，会话状态，键和值都存储在服务器端。它知道如何将未来的请求连接到该会话状态的方法是使用其中包含（完全不同的）密钥的 cookie。当浏览器发出另一个请求时，它会随请求一起发送此 cookie，服务器使用它来确定要映射到哪个会话。一旦它弄清楚了，你就可以再次访问你的字典，跨越响应。

因此，要在 perl 中执行此操作，您需要手动创建一个 cookie 并在其中存储一个唯一键，将这些唯一键映射到会话状态字典的服务器端，并且几乎可以执行我上面描述的操作。

# asp.net - 多个域，IIS 6 上的相同 Web 应用程序

> ID：273136
> 
> 赞同：5
> 
> 时间：2008-11-07T18:41:04.487
> 
> 标签：asp.net, iis

在 IIS 6 上，是否可以有多个域名指向同一个 Web 应用程序，并根据域名有条件地从 Web 应用程序内提供 CSS？

我需要在同一个 Web 应用程序上托管数百个不同的“皮肤”，皮肤依赖于域名，我真的不想启动大量的 Web 应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T19:06:50.440

+1 to rhinof 添加多个身份，但创建 HttpModule 有点过头了。您可以通过检查 Request.Headers["HOST"] 的内容来简单地切换母版页中标记的 URL

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T18:57:15.093

1) 在网站选项卡的高级属性页面中添加所需的域名作为网站标识符。

2) 将 .css 扩展名映射到 aspnet_isapi.dll

3）编写一个httpmodule，它将根据域名重新编写.css请求的url

4) 通过 web.config 启用你的模块

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T18:57:32.267

如果使用主题，则可以更改主题，从而根据 Request.ServerVariables["Url"] 中域的值更改 Page.PreInit 中的 css 等（注意，可能有更好的服务器变量来获取域名，查找）。

如果您不使用主题，则可以通过检查相同的服务器变量以编程方式换出 css 文件。

MasterPages 将成为您的朋友。

希望这能把你推向正确的方向。这是可能的，也是常见的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T19:04:15.950

如果您要在网站上拥有不同的核心内容，那么我建议您输入一个全局标识符来跟踪用户所在的网站，并将您的数据放在某个数据库中，以供参考该标识符。如果每个实例都是唯一的，这是迄今为止扩展应用程序的最简单方法。

你可以把它放到一个类中，并有一个共同的模式来确定东西应该映射到哪里。我建议，一旦您知道要缓存它的映射，然后您就可以做您想做的事情，而不会出现一千个应用程序或数据库调用的延迟。

您还需要在任何常规数据库调用中添加此参数，以便您仅获得正在托管的域的结果。我对此有一些经验，所以如果您想查看一些特定的编码示例，请留下一些评论。

您可以将此技术应用于任何文件、CSS 样式表或对象以供参考。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T19:23:12.030

是的，这应该很容易做到。我会采用使用 IIS 中的主机标头将域名映射到您的应用程序的方法。然后，正如 Martin 所说，在您的应用程序中询问 Request.Headers["HOST"] 以切换样式表。

# c# - 仅用于数字的正则表达式

> ID：273141
> 
> 赞同：376
> 
> 时间：2008-11-07T18:42:49.553
> 
> 标签：c#, regex

我根本没有使用过正则表达式，所以我很难排除故障。我希望正则表达式仅在包含的字符串都是数字时才匹配；但是对于下面的两个示例，它匹配包含所有数字加上等号的字符串，例如“1234 = 4321”。我确信有办法改变这种行为，但正如我所说，我从来没有真正用过正则表达式。

```
string compare = "1234=4321";
Regex regex = new Regex(@"[\d]");

if (regex.IsMatch(compare))
{ 
    //true
}

regex = new Regex("[0-9]");

if (regex.IsMatch(compare))
{ 
    //true
} 
```

万一这很重要，我使用的是 C# 和 .NET2.0。

* * *

## 回答 #1

> 赞同：579
> 
> 时间：2008-11-07T18:44:27.833

使用开始和结束锚点。

```
Regex regex = new Regex(@"^\d$"); 
```

`"^\d+$"`如果您需要匹配多个数字，请使用。

* * *

注意`"\d"`将匹配`[0-9]`和其他数字字符一样的东方阿拉伯数字`٠١٢٣٤٥٦٧٨٩`。用于`"^[0-9]+$"`将匹配限制为仅阿拉伯数字 0 - 9。

* * *

如果您需要包含除数字以外的任何数字表示形式（例如初学者的十进制值），请参阅[@tchrist](https://stackoverflow.com/users/471272/tchrist)的[使用正则表达式解析数字的综合指南](https://stackoverflow.com/a/4247184/1288)。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2008-11-07T18:46:37.593

您的正则表达式将匹配任何包含数字的内容，您想使用锚点来匹配整个字符串，然后匹配一个或多个数字：

```
regex = new Regex("^[0-9]+$"); 
```

将`^`锚定字符串的开头，`$`将锚定字符串的结尾，并且`+`将匹配其前面的一个或多个（在本例中为数字）。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2011-04-19T13:21:27.857

如果您需要容忍小数点和千位标记

```
var regex = new Regex(@"^-?[0-9][0-9,\.]+$"); 
```

如果数字可以变为负数，您将需要一个“-”。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-07T18:45:33.540

它是匹配的，因为它正在寻找“匹配”而不是完整字符串的匹配。您可以通过更改正则表达式来专门查找字符串的开头和结尾来解决此问题。

```
^\d+$ 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2014-01-21T19:31:33.463

也许我的方法会对你有所帮助。

```
 public static bool IsNumber(string s)
    {
        return s.All(char.IsDigit);
    } 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2014-03-01T08:47:14.687

这适用于整数和十进制数。如果数字有逗号千位分隔符，则不匹配，

```
"^-?\\d*(\\.\\d+)?$" 
```

一些与此匹配的字符串：

```
894
923.21
76876876
.32
-894
-923.21
-76876876
-.32 
```

一些没有的字符串：

```
hello
9bye
hello9bye
888,323
5,434.3
-8,336.09
87078. 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2014-05-22T05:20:17.180

如果您需要检查所有数字是否都是数字（0-9），

```
^[0-9]+$ 
```

火柴

```
1425
0142
0
1 
```

并且不匹配

```
154a25
1234=3254 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2014-04-04T09:16:01.727

抱歉，格式很丑。对于任意位数：

```
[0-9]* 
```

对于一位或多位数字：

```
[0-9]+ 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-11-07T18:47:30.370

^\d+$，英文为“字符串开头”、“1位或多位”、“字符串结尾”。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2015-11-28T20:23:42.390

这是我的工作：

```
^(-?[1-9]+\\d*([.]\\d+)?)$|^(-?0[.]\\d*[1-9]+)$|^0$ 
```

还有一些测试

阳性测试：

```
string []goodNumbers={"3","-3","0","0.0","1.0","0.1","0.0001","-555","94549870965"}; 
```

阴性测试：

```
string []badNums={"a",""," ","-","001","-00.2","000.5",".3","3."," -1","--1","-.1","-0"}; 
```

不仅检查了 C#，还检查了 Java、Javascript 和 PHP

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2016-07-06T10:42:00.867

使用开始和结束锚点。

```
 Regex regex = new Regex(@"^\d$"); 
```

`"^\d+$"`如果您需要匹配多个数字，请使用。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2016-09-12T08:51:34.117

虽然上述解决方案都不符合我的目的，但这对我有用。

```
var pattern = @"^(-?[1-9]+\d*([.]\d+)?)$|^(-?0[.]\d*[1-9]+)$|^0$|^0.0$";
return Regex.Match(value, pattern, RegexOptions.IgnoreCase).Success; 
```

有效值示例：

```
"3",
"-3",
"0",
"0.0",
"1.0",
"0.7",
"690.7",
"0.0001",
"-555",
"945465464654" 
```

无效值示例：

```
"a",
"",
" ",
".",
"-",
"001",
"00.2",
"000.5",
".3",
"3.",
" -1",
"--1",
"-.1",
"-0",
"00099",
"099" 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2012-04-28T21:38:10.493

另一种方式：如果您喜欢匹配波斯语或阿拉伯语等国际数字，则可以使用以下表达式：

```
Regex = new Regex(@"^[\p{N}]+$"); 
```

要匹配文字句点字符，请使用：

```
Regex = new Regex(@"^[\p{N}\.]+$"); 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2016-02-22T04:11:02.767

整数和浮点数的正则表达式：

```
^[+-]?\d*\.\d+$|^[+-]?\d+(\.\d*)?$ 
```

数字可以以句点开头（不带前导数字），数字可以以句点结尾（不带尾随数字）。上面的正则表达式会将两者都识别为正确的数字。

一种 。（句点）本身没有任何数字不是正确的数字。这就是为什么我们需要两个正则表达式部分（用“|”分隔）。

希望这可以帮助。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2016-09-01T08:10:59.600

我认为这是最简单的一种，它接受欧洲和美国的数字书写方式，例如 USA 10,555.12 European 10.555,12 而且这个不允许多个逗号或点一个接一个，例如 10..22 或 10,.22除此之外，像 .55 或 ,55 这样的数字也会通过。这可能很方便。

```
^([,|.]?[0-9])+$ 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-11-03T09:50:59.710

如果您只想从字符串中提取数字，则模式 "\d+" 应该会有所帮助。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-11-12T05:01:30.940

```
 console.log(/^(0|[1-9][0-9]*)$/.test(3000)) // true 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-06-12T04:57:05.507

以下正则表达式仅接受英语和阿拉伯语（波斯语）语言中的数字（也是浮点数）（就像 Windows 计算器一样）：

```
^((([0\u0660\u06F0]|([1-9\u0661-\u0669\u06F1-\u06F9][0\u0660\u06F0]*?)+)(\.)[0-9\u0660-\u0669\u06F0-\u06F9]+)|(([0\u0660\u06F0]?|([1-9\u0661-\u0669\u06F1-\u06F9][0\u0660\u06F0]*?)+))|\b)$ 
```

上面的正则表达式接受以下模式：

```
11
1.2
0.3
۱۲
۱.۳
۰.۲
۲.۷ 
```

上面的正则表达式不接受以下模式：

```
3.
.3
0..3
.۱۲ 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-09-02T13:47:28.940

检查字符串是 uint、ulong 还是仅包含数字 one .(dot) 和 digits Sample 输入

```
Regex rx = new Regex(@"^([1-9]\d*(\.)\d*|0?(\.)\d*[1-9]\d*|[1-9]\d*)$");
string text = "12.0";
var result = rx.IsMatch(text);
Console.WriteLine(result); 
```

样品

```
123 => True
123.1 => True
0.123 => True
.123 => True
0.2 => True
3452.434.43=> False
2342f43.34 => False
svasad.324 => False
3215.afa => False 
```

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2015-05-01T22:56:14.187

正则表达式 regex = 新正则表达式 ("^[0-9]{1,4}=[0-9]{1,4]$")

# macos - 如何将 LC_LOAD_DYLIB 命令插入 Mach-O 二进制文件 (OSX)

> ID：273142
> 
> 赞同：10
> 
> 时间：2008-11-07T18:42:56.727
> 
> 标签：macos, dylib, mach-o, dyld, otool

我正在寻找用一些代码修补一块废弃软件。

该软件是基于碳的，所以我不能使用 InputManager（至少，我认为我不能）。我的想法是添加对 mach-o 标头的 dylib 引用，并在调用初始化例程时启动一个新线程。

我已经使用 hexeditor 添加适当的加载命令 (LC_LOAD_DYLIB) 来处理 mach-o 标头。

otool 报告了我希望看到的内容，因此我相当有信心该文件的格式正确。

```
加载命令 63
          命令 LC_LOAD_DYLIB
      cmdsize 60
         名称 @executable_path/libAltInput.dylib（偏移量 24）
   时间戳 1183743291 Fri Jul 6 19:34:51 2007
      当前版本 0.0.0
兼容版本 0.0.0

```

但是，启动二进制文件会给我以下错误

```
dyld：外部重定位长度错误

```

我能猜到这意味着我需要修改 LC_ SYMTAB 或 LC_ DYNSYMTAB 部分......

有人有想法么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T19:03:38.497

我不完全确定您要完成什么，但最简单的方法可能是在启动后将线程注入到 mach 任务中。可以在此处找到有关执行此操作（以及执行此操作的代码）的重要信息来源：[http](http://rentzsch.com/mach_inject/) ://rentzsch.com/mach_inject/ 。

您应该注意的一些警告：

1.  获取任务的 mach 端口所需的 mach task_for_pid() 调用现在已获得特权，并且需要授权才能调用。这样做的原因是不言而喻的，但如果你打算发布带有注入代码的东西，你应该意识到这一点。
2.  您的代码将在与原始应用程序相同的进程空间中运行，但在单独的线程上。因此，您将拥有对应用程序的完全访问权限，但是，如果它不是线程感知的，则在使用和操作来自注入代码之外的数据时要非常小心。显然，所有多线程问题都会在这里被放大，因为原始代码从未意识到您的添加。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-02T07:04:58.920

不涉及修补二进制文件的最简单的解决方案是简单地使用 DYLD_INSERT_LIBRARIES 环境变量，然后运行您的应用程序。

```
set DYLD_INSERT_LIBRARIES to /my/path/libAltInput.dylib 
```

我假设动态链接器报告错误的原因是因为 Mach-O 文件格式中的许多字段包含指定为从文件开头偏移的地址，因此添加另一个加载命令会使每个地址无效。例如，请参阅[Mac OS X ABI Mach-O 文件格式参考](http://developer.apple.com/Mac/library/documentation/DeveloperTools/Conceptual/MachORuntime/Reference/reference.html#//apple_ref/c/tag/symtab_command)`symoff`中的和`stroff`条目。

# debugging - 是否可以“反编译”Windows .exe？或者至少查看大会？

> ID：273145
> 
> 赞同：284
> 
> 时间：2008-11-07T18:44:47.240
> 
> 标签：debugging, winapi, assembly, decompiling

我的一个朋友从 Facebook 下载了一些恶意软件，我很想知道它在不感染自己的情况下做了什么。我知道您不能真正反编译 .exe，但我至少可以在 Assembly 中查看它或附加调试器吗？

编辑说它不是 .NET 可执行文件，没有 CLI 标头。

* * *

## 回答 #1

> 赞同：537
> 
> 时间：2008-11-07T19:11:48.153

使用**调试器**，您可以交互式地逐步执行程序集。
使用**反汇编**程序，您可以更详细地查看程序汇编。
使用**反编译器**，您可以将程序转回部分源代码，假设您知道它是用什么编写的（您可以使用[PEiD](http://www.aldeid.com/wiki/PEiD)等免费工具找到它- 如果程序被打包，您必须先解压缩它或[Detect-it-Easy](http://ntinfo.biz/index.html)如果你在任何地方都找不到 PEiD。DIE 目前在[github](https://github.com/horsicq/Detect-It-Easy)上有一个强大的开发者社区）。

### 调试器：

*   [OllyDbg](http://www.ollydbg.de/)，免费，一个优秀的 32 位调试器，您可以找到许多用户制作的插件和脚本，使其更加有用。
*   [WinDbg](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools)，免费的，Microsoft 提供的功能强大的调试器。WinDbg 对于查看 Windows 内部结构特别有用，因为它比其他调试器更了解数据结构。
*   [SoftICE](https://reverseengineering.stackexchange.com/q/1445) , SICE 给朋友。商业和开发于 2006 年停止。SoftICE 是一种在操作系统下运行的核心工具（并在调用时停止整个系统）。许多专业人士仍在使用 SoftICE，尽管可能很难获得并且可能无法在某些硬件（或软件 - 即它无法在 Vista 或 NVIDIA gfx 卡上运行）上运行。

### 反汇编程序：

*   [IDA Pro](http://www.hex-rays.com/idapro/)（商业）- 顶级反汇编器/调试器。大多数专业人士使用，如恶意软件分析师等。虽然成本相当高（有[**免费版本**](https://www.hex-rays.com/products/ida/support/download_freeware.shtml)，但非常有限）
*   [W32Dasm](http://www.softpedia.com/get/Programming/Debuggers-Decompilers-Dissasemblers/WDASM.shtml)（免费） - 有点过时，但可以完成工作。我相信 W32Dasm 这些天是废弃软件，并且有许多用户创建的黑客来添加一些非常有用的功能。您必须四处寻找最佳版本。

### 反编译器：

*   Visual Basic: [VB Decompiler](http://www.vb-decompiler.org/)，商业的，产生一些可识别的字节码。
*   Delphi：[DeDe](http://www.softpedia.com/get/Programming/Debuggers-Decompilers-Dissasemblers/DeDe.shtml)，免费，生成高质量的源代码。
*   C: [HexRays](https://www.hex-rays.com/products/decompiler/)，商业的，同一家公司的 IDA Pro 插件。产生了很好的效果，但要花一大笔钱，而且不会卖给任何人（至少我听说）。
*   .NET(C#)：[dotPeek](http://www.jetbrains.com/decompiler/)，免费，将 .NET 1.0-4.5 程序集反编译为 C#。支持 .dll、.exe、.zip、.vsix、.nupkg 和 .winmd 文件。

无论您在做什么，都可能派上用场的一些相关工具是资源编辑器，例如[ResourceHacker](http://angusj.com/resourcehacker/)（免费）和一个好的十六进制编辑器，例如[Hex Workshop](http://www.bpsoft.com/)（商业）。

**此外，如果您正在进行恶意软件分析（或使用 SICE）**，我衷心建议您在虚拟机（即[VMware Workstation](http://www.vmware.com/products/ws/) ）中运行所有内容。在 SICE 的情况下，它将保护您的实际系统免受 BSOD 的影响，在恶意软件的情况下，它将保护您的实际系统免受目标程序的攻击。[您可以在此处](http://www.zeltser.com/vmware-malware-analysis/)阅读有关使用 VMware 进行恶意软件分析的信息。

就个人而言，我使用 Olly、WinDbg 和 W32Dasm 以及一些较小的实用工具。

另外，请记住，反汇编甚至调试*其他人的*软件通常至少违反 EULA :)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-11-07T21:12:47.220

psoul 对您的问题的出色回答，所以我不会复制他的出色工作，但我觉得这有助于解释为什么这是一个完全有效但又非常愚蠢的问题。毕竟，这是一个学习的地方，对吧？

现代计算机程序是通过一系列转换产生的，从输入人类可读的文本指令体（称为“源代码”）到计算机可读的指令体（也称为“二进制”或“机器”）结束代码”）。

计算机运行一组机器代码指令的方式最终非常简单。处理器可以执行的每个操作（例如，从内存中读取、添加两个值）都由数字代码表示。如果我告诉你数字 1 表示尖叫，数字 2 表示咯咯笑，然后举起带有 1 或 2 的卡片，希望你相应地尖叫或咯咯笑，我将使用与计算机基本相同的系统操作。

二进制文件只是一组这些代码（通常称为“操作码”）和操作码作用的信息（“参数”）。

现在，汇编语言是一种计算机语言，其中语言中的每个命令字恰好代表处理器上的一个操作码。汇编语言命令和处理器操作码之间存在直接的 1:1 转换。这就是 x386 处理器的编码程序集不同于 ARM 处理器的编码程序集的原因。

反汇编就是这样：程序读取二进制文件（机器代码），用等效的汇编语言命令替换操作码，并将结果作为文本文件输出。理解这一点很重要；如果您的计算机可以读取二进制文件，那么您也可以读取二进制文件，无论是手动使用您手中的操作码表（ick）还是通过反汇编程序。

反汇编程序有一些新技巧，但重要的是要了解反汇编程序最终是一种搜索和替换机制。这就是为什么任何禁止它的 EULA 最终都会吹出热空气。不能既允许计算机读取程序数据，又禁止计算机读取程序数据。

（不要误会我的意思，有人尝试这样做。它们在歌曲文件上与 DRM 一样有效。）

但是，反汇编方法有一些警告。变量名不存在；你的CPU不存在这样的事情。库调用令人困惑，通常需要反汇编进一步的二进制文件。在最好的条件下，汇编很难阅读。

大多数专业程序员都不能坐下来阅读汇编语言而不感到头疼。对于业余爱好者来说，这不会发生。

无论如何，这是一个有点掩饰的解释，但我希望它有所帮助。每个人都可以随时纠正我的任何错误陈述；有一阵子了。;)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-07T20:18:18.097

好消息。IDA Pro 现在对其旧版本实际上是免费的： [http ://www.hex-rays.com/idapro/idadownfreeware.htm](http://www.hex-rays.com/idapro/idadownfreeware.htm)

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-07T18:50:29.257

任何体面的调试器都可以做到这一点。试试[OllyDbg](http://www.ollydbg.de/)。（编辑：它有一个很棒的反汇编程序，甚至可以将参数解码为 WinAPI 调用！）

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-09-15T21:49:48.510

[`x64dbg`](http://x64dbg.com/#start)是一个很好的开源调试器，被积极维护。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-07T18:59:16.087

如果您只是想弄清楚恶意软件的作用，那么在免费工具[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx "进程监视器")之类的工具下运行它可能会容易得多，该工具会在它尝试访问文件系统、注册表、端口等时报告...

此外，使用免费的[VMWare 服务器](http://www.vmware.com/products/server/)之类的虚拟机对此类工作非常有帮助。您可以制作一个“干净”的图像，然后在每次运行恶意软件时返回该图像。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2019-11-07T22:58:30.773

我想说，在 2019 年（2022 年更是如此），Ghidra ( [https://ghidra-sre.org/](https://ghidra-sre.org/) ) 值得一试。它是开源的（免费的），并具有惊人的代码分析能力，包括能够反编译回相当可读的 C 代码。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-11-07T18:49:58.243

当然，看看[IDA Pro](http://www.hex-rays.com/idapro/)。他们提供了一个评估版本，所以你可以尝试一下。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-07T18:49:17.823

您可能会在汇编中查看它的一些信息，但我认为最简单的方法是启动虚拟机并查看它的作用。确保你没有公开的股票或类似的东西可以跳过；）

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-08T00:26:46.377

[Boomerang](http://boomerang.sourceforge.net/)也可能值得一试。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-07-06T13:41:39.637

我不敢相信没有人对[Immunity Debugger](http://debugger.immunityinc.com/)只字未提。

Immunity Debugger 是一个强大的工具，用于编写漏洞利用、分析恶意软件和反向工程二进制文件。它最初基于 Ollydbg 1.0 源代码，但修复了名称解析错误。它有一个支持良好的**Python API**，易于扩展，因此您可以编写 Python 脚本来帮助您进行分析。

另外，Corelan 团队的 Peter 写了一个很好的工具，叫做[mona.py](http://redmine.corelan.be/projects/mona)，顺便说一句，这是一个优秀的工具。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-07T18:50:45.073

您需要的是一种称为“反汇编程序”的软件。

快速谷歌产生这个：[链接](https://win32program-disassembler.en.softonic.com/download)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-07T21:12:36.240

如果您想在不感染计算机的情况下运行该程序以查看它的作用，请使用[VMWare](http://vmware.com)或 Microsoft VPC 之类的虚拟机，或者可以对程序进行沙盒处理的程序，例如[SandboxIE](http://www.sandboxie.com)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-16T04:40:23.687

如果您没有时间，请将恶意软件提交到 cwsandbox：

[http://www.cwsandbox.org/](http://www.cwsandbox.org/)

[http://jon.oberheide.org/blog/2008/01/15/detecting-and-evading-cwsandbox/](http://jon.oberheide.org/blog/2008/01/15/detecting-and-evading-cwsandbox/)

高温高压

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2018-01-23T03:58:29.560

你可以使用dotPeek，非常适合反编译exe文件。这是免费的。

[https://www.jetbrains.com/decompiler/](https://www.jetbrains.com/decompiler/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-08-25T11:25:38.173

[探索者套件](http://www.ntcore.com/exsuite.php)可以做你想做的事。

# c++ - CMFCToolTipCtrl 或 CTooltipManager 示例？

> ID：273148
> 
> 赞同：4
> 
> 时间：2008-11-07T18:45:24.663
> 
> 标签：c++, visual-studio, mfc, controls, mfc-feature-pack

有没有人尝试过使用这些新的 VS2008 MFC 类呢？我似乎在任何地方都找不到任何例子。甚至 VS2008 示例 (1) 也没有提及这些类。（他们使用 CToolTip。）

*（1）更新：我的错误。我已经下载了[非 SP1 样本](http://www.microsoft.com/downloads/details.aspx?FamilyId=01AE159F-08CD-495B-8BF4-A48CC395AD7B&displaylang=en)。我看到[SP1 示例](http://www.microsoft.com/downloads/details.aspx?FamilyID=9761bb57-f066-4b70-9318-3965c5e68aad&DisplayLang=en)具有专门针对 2008 Feature Pack 的示例，包括答案中提到的 DlgToolTips 和 ToolTipDemo 项目。不幸的是，它们不涉及 doc/view 或 CTooltipManager。*

具体来说，我试图在标准 MFC 视图/文档应用程序中显示工具提示，其中有两个并排视图，其父级为 CSplitterWnd。我在 SP1 之前就有了这个工作，我认为这是尝试新的 Feature Pack 工具提示类的好时机。

有没有办法让这些事情在不覆盖 PreTranslateMessage() 和手动调用 RelayEvent() 的情况下工作？（我不认为我在 MFC 中看到过像工具提示这样设计糟糕的东西。）

它看起来不像仅仅调用 CTooltipManager::CreateToolTip() 然后 AddTool() 在创建的提示上那么简单。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T19:41:29.653

如果你还没有看过，这里有一个非常简短的[例子](http://msdn.microsoft.com/en-us/library/bb983852.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T00:08:12.517

您是否查看过 DlgToolTips 和 ToolTipDemo 示例应用程序？这些都使用继承的类`CMFCToolTipCtrl`。DlgToolTips 包含从 调用`RelayEvent`的代码`PreTranslateMessage`，但 ToolTipDemo 不包含。

# c# - .NET：将 .doc 转换为 .htm 会产生时髦的字符

> ID：273151
> 
> 赞同：1
> 
> 时间：2008-11-07T18:45:51.153
> 
> 标签：c#, encoding

我使用 MS Word 自动化将 .doc 保存到 .htm。如果 .doc 文件中有项目符号字符，它们会很好地保存到 .htm，但是当我尝试将 .htm 文件读入字符串时（因此我可以随后将其发送到数据库以作为字符串进行最终存储，而不是blob），项目符号会根据用于加载到字符串中的编码转换为问号或其他字符。

我正在使用它来阅读文本：

```
string html = File.ReadAllText(myFileSpec); 
```

我也尝试过使用 StreamReader，但得到了相同的结果（可能是 File.ReadAllText 在内部使用的）。

我还尝试在 File.ReadAllText 的第二个重载中指定每种类型的编码：

```
string html = File.ReadAllText(originalFile, Encoding.ASCII); 
```

我已经尝试了 Encoding 类型的所有可用枚举。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T20:37:34.187

在我的系统上（使用美国英语），Word 将 *.htm 文件保存在 Windows-1252 代码页中。如果您的系统使用该代码页，那么这就是您应该阅读的内容。

```
string html = File.ReadAllText(originalFile, Encoding.GetEncoding(1252)); 
```

不过，无论您使用视图，结果也可能会为您创建问号，因此请务必检查并检查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T18:51:16.070

您是否尝试以二进制模式打开文件。如果您以测试模式打开，我认为它会切碎 unicode 字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T19:54:31.123

`.doc`Word转换的问题不是将项目符号变成问号（并且它与等等`.html`没有任何关系）？`File.ReadAllText``StreamReader`

即当它到达`File.ReadAllText`它的时候已经是一个问号。

当我在 Word 2003 中将一个简单的 Word 列表转换为 HTML 时，我得到

```
 <ul style='margin-top:0cm' type=disc> 
     <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'>
       <span lang=EN-GB style='mso-ansi-language:EN-GB'>Test 1</span>
     </li> 
     <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list 36.0pt'>
       <span lang=EN-GB style='mso-ansi-language:EN-GB'>Test 2</span>
     </li> 
 </ul> 
```

它很丑，但它不包含任何可能成为问号的东西

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:59:56.853

这些字符在 HTML 文件中是什么样的？该文件的编码声明是什么（在元标记“Content-Type”中）？理想情况下，这些字符应转换为实体或 UTF-8 字符。
回答这些问题可能会引导您找到解决方案... :-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T21:06:57.560

好吧，显然我在第一句话中撒了谎。我以为我已经尝试了所有编码，但我没有尝试过：

```
data = File.ReadAllText(tempFile, Encoding.Default); 
```

您会认为在不指定编码的情况下，此方法的重载可以正常工作，期望默认编码是，嗯，Encoding.Default。但是，它实际上默认使用 Encoding.UTF8。希望这对其他人有帮助。

# windows-server-2003 - 如何确定 Windows 服务器上的端口是否打开？

> ID：273159
> 
> 赞同：505
> 
> 时间：2008-11-07T18:48:41.630
> 
> 标签：windows-server-2003, port, ping

我正在尝试在服务器上的备用端口下安装站点，但该端口可能被防火墙关闭。有没有办法在特定端口上 ping 出或进入，以查看它是否打开？

* * *

## 回答 #1

> 赞同：778
> 
> 时间：2008-11-07T18:55:40.463

假设它是您尝试使用的 TCP（而不是 UDP）端口：

1.  在服务器本身上，用于`netstat -an`检查哪些端口正在侦听。

2.  从外部，只需使用`telnet host port`（或`telnet host:port`在 Unix 系统上）查看连接是否被拒绝、接受或超时。

在后一个测试中，一般来说：

*   *连接被拒绝*意味着该端口上没有运行任何东西
*   *接受*意味着该端口上正在运行某些东西
*   *超时*意味着防火墙正在阻止访问

在 Windows 7 或 Windows Vista 上，默认选项“telnet”不被识别为内部或外部命令、可运行程序或批处理文件。要解决此问题，只需启用它：单击 *开始** →**控制面板**→*程序*→打开或关闭*Windows 功能*。在列表中，向下滚动并选择*Telnet 客户端*，然后单击`OK`。

* * *

## 回答 #2

> 赞同：208
> 
> 时间：2013-04-11T15:27:02.707

在 Windows 上，您可以使用

```
netstat -na | find "your_port" 
```

缩小结果范围。您还可以过滤`LISTENING`、`ESTABLISHED`等`TCP`。请注意，它区分大小写。

* * *

## 回答 #3

> 赞同：116
> 
> 时间：2016-02-25T10:09:27.053

如果您是从外部检查，而不是从服务器本身检查，并且您不想安装 telnet（因为它没有随 Windows 的最新版本提供）或任何其他软件，那么您有本机 PowerShell：

```
Test-NetConnection -Port 800 -ComputerName 192.168.0.1 -InformationLevel Detailed 
```

（不幸的是，这只适用于 PowerShell 4.0 或更高版本。要检查您的 PowerShell 版本，请键入`$PSVersionTable`。）

PS：请注意，这些天在 twittersphere 上有一些声明暗示可以通过提及 PowerShell Core 中的“Test-Connection”或快捷方式“tnc”来改进此答案。请参阅[https://twitter.com/david_obrien/status/1214082339203993600](https://twitter.com/david_obrien/status/1214082339203993600)并帮助我编辑此答案以改进它！

* * *

（如果您的 PSVersion < 4.0，那么您就不走运了。检查此表：

[![在此处输入图像描述](https://i.stack.imgur.com/tNjlt.jpg)](https://i.stack.imgur.com/tNjlt.jpg)

即使您可以通过安装[Windows Management Framework 4.0](https://www.microsoft.com/en-us/download/details.aspx?id=40855)来升级您的 PowerShell 版本，但它对我来说没有用，**Test-NetConnection** cmdlet 仍然不可用）。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2014-03-06T12:30:46.580

我确实喜欢这样：

```
netstat -an | find "8080" 
```

从远程登录

```
telnet 192.168.100.132 8080 
```

只需确保该计算机上的防火墙已关闭。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2014-05-29T04:48:00.663

在 Windows 机器上，您可以使用Microsoft 的[PortQry](http://www.microsoft.com/en-us/download/details.aspx?id=17148)使用以下命令检查应用程序是否已经在侦听特定端口：

```
portqry -n 11.22.33.44 -p tcp -e 80 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2011-01-11T14:31:02.433

如果`telnet`不可用，请下载[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)。它是一个非常出色的 Telnet、SSH 等客户端，并且在许多情况下都非常有用，而不仅仅是这个，尤其是在您管理服务器时。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2014-06-23T06:11:38.587

如果您想查看 Windows 服务器上所有已使用和正在侦听的端口，请使用此选项：

```
netstat -an |find /i "listening" 
```

查看所有打开的、正在监听的、已建立的端口：

```
netstat -a 
```

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-11-07T18:54:44.630

你想要一个工具来做这件事吗？[在http://www.canyouseeme.org/](http://www.canyouseeme.org/)上有一个网站。否则，您需要其他服务器给您回电以查看端口是否打开...

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-05-03T14:59:26.500

在 Windows Server 上，您可以使用

```
netstat -an | where{$_.Contains("Yourport")} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-12-12T08:21:38.767

[Sysinternals 的PsPing](https://docs.microsoft.com/en-us/sysinternals/downloads/psping)也非常好。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-09-07T10:59:46.617

另一种选择是[tcping](http://www.elifulkerson.com/projects/tcping.php)。

例如：

`tcping host port`

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-07-02T15:38:42.143

这对我有用：

*   打开命令提示符
*   类型`telnet`
*   Microsoft Telnet>open <主机名或 IP 地址><空格><端口>

它将确认端口是否打开。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-06-07T20:23:33.150

我发现的另一个实用程序既好又小，是[PortQry Command Line Port Scanner version 2.0](https://www.microsoft.com/en-us/download/details.aspx?id=17148)。

你可以 ping 一个服务器和一个端口，它会告诉你端口的状态。有一个命令行实用程序和一个 UI。

# asp.net - FormsAuthenticationTicket 上的 Version 属性的目的/含义是什么？

> ID：273165
> 
> 赞同：19
> 
> 时间：2008-11-07T18:50:05.123
> 
> 标签：asp.net, security, forms-authentication

FormsAuthenticationTicket 上的 Version 属性的目的/含义是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T19:17:19.700

只需存储票证版本号，通过该值即可了解票证的结构。它为 asp.net 1.1 存储 1，为 asp.net 2.0 存储 2。也许将来微软会在票证中添加一些额外的字段，那么版本号将是 3.0。其他软件可以使用此编号来区分票证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T19:15:04.150

尽管默认版本号在ASP.NET 2.0 中确实[从 1更改为 2，但](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.version(VS.71).aspx)[文档](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationticket.version.aspx)对这一点的启发并不大。

Reflector 也没有发现任何有趣的用途，除了让它在更新时保持活力。我的猜测是它是为了“未来使用”。

# php - 如何在 PHP 中动态调用类方法？

> ID：273169
> 
> 赞同：58
> 
> 时间：2008-11-07T18:50:50.550
> 
> 标签：php, callback

如何在 PHP 中动态调用类方法？类方法不是静态的。看起来

```
call_user_func(...) 
```

仅适用于静态函数？

谢谢。

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-11-07T18:53:18.797

它适用于两种方式 - 您需要使用正确的语法

```
//  Non static call
call_user_func( array( $obj, 'method' ) );

//  Static calls
call_user_func( array( 'ClassName', 'method' ) );
call_user_func( 'ClassName::method' ); // (As of PHP 5.2.3) 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-11-07T22:59:13.183

选项1

```
// invoke an instance method
$instance = new Instance();
$instanceMethod = 'bar';
$instance->$instanceMethod();

// invoke a static method
$class = 'NameOfTheClass';
$staticMethod = 'blah';
$class::$staticMethod(); 
```

选项 2

```
// invoke an instance method
$instance = new Instance();
call_user_func( array( $instance, 'method' ) );

// invoke a static method
$class = 'NameOfTheClass';
call_user_func( array( $class, 'nameOfStaticMethod' ) );
call_user_func( 'NameOfTheClass::nameOfStaticMethod' ); // (As of PHP 5.2.3) 
```

选项 1 比选项 2 快，因此请尝试使用它们，除非您不知道要传递给该方法的参数数量。

* * *

编辑：以前的编辑器在清理我的答案方面做得很好，但删除了与 call_user_func 不同的 call_user_func_array 的提及。

PHP有

```
mixed call_user_func ( callable $callback [, mixed $parameter [, mixed $... ]] ) 
```

[http://php.net/manual/en/function.call-user-func.php](http://php.net/manual/en/function.call-user-func.php)

和

```
mixed call_user_func_array ( callable $callback , array $param_arr ) 
```

[http://php.net/manual/en/function.call-user-func-array.php](http://php.net/manual/en/function.call-user-func-array.php)

使用 call_user_func_array 比使用上面列出的任一选项慢几个数量级。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-07T18:54:57.717

你的意思是这样吗？

```
<?php

class A {
    function test() {
        print 'test';
    }
}

$function = 'test';

// method 1
A::$function();

// method 2
$a = new A;    
$a->$function();

?> 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-07-17T12:35:36.410

从 PHP7 开始，您使用类似数组的方式：

```
// Static call only
[TestClass::class, $methodName](...$args);

// Dynamic call, static or non-static doesn't matter
$instance = new TestClass;
[$instance, $methodName](...$args); 
```

只需将类名替换为`TestClass`，方法名替换为`$methodName`，方法参数替换为`...$args`。请注意，在后一种情况下，方法是静态还是非静态都没有关系；PHP 会自动调用它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T18:53:04.493

```
call_user_func(array($object, 'methodName')); 
```

有关更多详细信息，请参阅[php 回调文档。](http://www.php.net/manual/en/language.pseudo-types.php#language.types.callback)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-10T02:27:22.420

编辑：我刚刚弄清楚你想问什么......嗯......无论如何都会留下我的评论。如果你愿意，你可以用变量替换类和方法的名称......（但你疯了） - nick

* * *

要从类中调用函数，您可以使用以下两种方法之一...

您可以创建类的实例，然后调用它。例如：

```
$bla = new Blahh_class();
$bla->do_something(); 
```

或者......您可以静态调用该函数......即没有类的实例。例如：

```
Blahh_class::do_something() 
```

当然你需要声明你的函数是静态的：

```
class Blahh_class {   
    public static function do_something(){
        echo 'I am doing something';
    }
} 
```

如果一个类没有被定义为静态的，那么你必须创建一个对象的实例..（所以对象需要一个构造函数）例如：

```
class Blahh_class {
    $some_value;

    public function __construct($data) {
        $this->$some_value = $data;
    }

    public function do_something() {
         echo $this->some_value;
    }
} 
```

要记住的重要一点是静态类函数不能使用`$this`，因为没有类的实例。（这是他们走得更快的原因之一。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-03T05:12:43.383

这可能是有用的替代品

```
class ReferenceContainer {

    function __construct(CallbackContainer $callbackContainer) {

        //Alternatively you can have no parameters in this constructor and create a new instance of CallbackContainer and invoke the callback in the same manner        
        //var_dump($this->callbackContainer);
        $data = 'This is how you parse a class by reference';
        $callbackContainer->myCallback($data);

    }

}

class CallbackContainer {

    function __construct() {}

    function myCallback($data) {

        echo $data."\n";

    }

}

$callbackContainer = new CallbackContainer();
$doItContainer = new ReferenceContainer($callbackContainer); 
```

# visual-studio-2008 - Visual Studio 2008 测试视图面板未显示所有测试

> ID：273174
> 
> 赞同：7
> 
> 时间：2008-11-07T18:52:39.640
> 
> 标签：visual-studio-2008, unit-testing, mstest

我有一组 6 个 MSTest 测试程序集。当我打开测试视图窗口并按项目分组时，我所有的项目都会显示出来，保存一个。我似乎无法让 Visual Studio 理解这个项目是一个单元测试程序集。

Resharper 的单元测试运行器可以毫无问题地识别这第六个程序集。所以从这个角度来看，组装是好的。

Visual Studio 2008 如何确定程序集是单元测试程序集？

我比较了 csproj 文件，没有发现任何异常。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-07T19:10:13.287

在 Visual Studio 中创建“测试”项目时，以下元素将添加到 csproj xml 的第一个 PropertyGroup 元素中：

```
 <ProjectTypeGuids>{3AC096D0-A1C2-E12C-1390-A8335801FDAB};
{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids> 
```

如果您手动创建了测试程序集，例如通过创建新的类库并添加对 Microsoft.VisualStudio.QualityTools.UnitTestFramework 的引用，则此元素将不会出现在您的 csproj 文件中，并且 Visual Studio 将忽略其中的所有测试。

添加元素，一切都会好起来的。

# tinymce - Opera 和 TinyMCE 的问题

> ID：273181
> 
> 赞同：1
> 
> 时间：2008-11-07T18:54:26.517
> 
> 标签：tinymce, wysiwyg, opera

我在 Opera 中遇到了一些关于[TinyMCE的一般问题。](http://tinymce.moxiecode.com/)其中一些包括：

*   保存按钮产生错误
*   当提交包含整个表单的弹出窗口时，包括 TinyMCE，没有任何内容发布到弹出窗口（删除 TinyMCE 后它工作正常）

有没有其他人遇到过这些错误和/或有没有人有解决方案使 TinyMCE 与 Opera 更兼容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-16T23:24:52.557

TinyMCE 不是唯一的网页富文本编辑器。您甚至可以尝试使用[您的意思的编辑器](http://www.wymeditor.org)或一些基于 Flash 的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-25T13:39:24.893

我推荐[CKEditor](http://www.ckeditor.com)，它就像 Opera 上的魅力一样，而且非常可配置且功能强大。我在使用迄今为止最新的 Opera（v12.15）时也遇到了一些关于 TinyMCE 的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-06-27T17:37:02.030

这取决于您使用的 Opera Mini 版本。支持的版本是 v.50 及更高版本。TinyMCE 支持 Opera Mini 52.3.21517 及以上版本。您可以在此处获取 Opera mini 移动浏览器的 50 版本 [https://press.opera.com/2019/02/19/opera-for-android-hits-version-50/](https://press.opera.com/2019/02/19/opera-for-android-hits-version-50/)

# .net - UPS Worldship 集成和 .net

> ID：273190
> 
> 赞同：2
> 
> 时间：2008-11-07T18:55:49.587
> 
> 标签：.net, ups-worldship

是否有任何适用于 .net 的 UPS WorldShip 集成 APIS 或库？我的任务是将我们的 Sample Order 应用程序（一个 VB.Net/SQL Server 应用程序）与 UPS 集成，并让它为自动导入功能编写 .xml 文件，尽管序列化已经让我踏上了第一步——但其中一些国际海关选项等更高级的运输选项完全没有文件记录。

您是如何启动和运行 UPS 集成的？你有任何第三方帮助吗？有没有更好的位置来存放我刚刚丢失的文档？

**编辑**：我要做的是根据我的数据库中的订单数据创建新的货件，然后使用从 UPS 收到的货件的跟踪号更新这些订单。订单具有指定的运输方式，即 2nd Day Air、Ground 或 International。大约 50% 的订单是国际订单。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T18:58:39.583

在这里查看：
[http ://www.ups.com/content/us/en/bussol/offering/technology/alliances/technology_tools.html](http://www.ups.com/content/us/en/bussol/offering/technology/alliances/technology_tools.html)

查看底部的 NexxStatus 和 ShipRush 产品。希望在这些人之间你能找到一些东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-28T06:04:00.580

shiprush SDK 对于制作运输标签非常有用。它提供 UPS、邮政和联邦快递。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-02T18:28:40.313

似乎第 3 方库很好，但技术上不需要。

这是您真正需要的：

1.  UPS 帐户
2.  UPS 帐号
3.  UPS 访问密钥

然后下载他们的开发工具包：查看文件夹：Rating PACKAGE\PACKAGE Web Services\Code Samples\Rate\Dot Net\RateWSSample\RateWSSample

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:17:37.703

我发现 Ryan LaNeve 的小型[dotnetshipping](https://github.com/rlaneve/dotNETShipping)库有助于开始使用 UPS 集成。

当然，这更适合使用他们的费率和服务选择服务，而不是 WorldShip。不过可能值得一看……

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T19:42:21.553

您对 UPS 集成有什么特别的尝试？获取运费？获取跟踪信息？如果您有具体问题，请发帖，也许我可以提供帮助。

[http://www.ups.com/e_comm_access/gettools_index?loc=en_US](http://www.ups.com/e_comm_access/gettools_index?loc=en_US)

下载文档。有一个带有 XML 集成的 zip 文件，其中包含您需要的所有字段。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-28T17:32:03.923

我们发现 InterShipper 有一个非常容易与 FEDEx、UPS、USPS、DHL 集成的工具。它全部基于 RESTfull API。响应是一个简单的 XML。它返回主要运营商的费率、标签和计费信息。

[http://www.intershipper.com/](http://www.intershipper.com/)

这只是一个建议。

# python - 如何安全地创建嵌套目录？

> ID：273192
> 
> 赞同：5105
> 
> 时间：2008-11-07T18:56:45.670
> 
> 标签：python, exception, path, directory, operating-system

检查要写入文件的目录是否存在，如果不存在，使用 Python 创建目录的最优雅方法是什么？这是我尝试过的：

```
import os

file_path = "/my/directory/filename.txt"
directory = os.path.dirname(file_path)

try:
    os.stat(directory)
except:
    os.mkdir(directory)

f = file(filename) 
```

不知何故，我错过了`os.path.exists`（感谢 kanja、Blair 和 Douglas）。这就是我现在所拥有的：

```
def ensure_dir(file_path):
    directory = os.path.dirname(file_path)
    if not os.path.exists(directory):
        os.makedirs(directory) 
```

是否有一个标志`open()`，可以自动发生这种情况？

* * *

## 回答 #1

> 赞同：6415
> 
> 时间：2008-11-07T19:06:07.663

在 Python ≥ 3.5 上，使用[`pathlib.Path.mkdir`](https://docs.python.org/library/pathlib.html#pathlib.Path.mkdir)：

```
from pathlib import Path
Path("/my/directory").mkdir(parents=True, exist_ok=True) 
```

对于旧版本的 Python，我看到两个质量很好的答案，每个都有一个小缺陷，所以我会给出我的看法：

尝试[`os.path.exists`](https://docs.python.org/library/os.path.html#os.path.exists)，并考虑[`os.makedirs`](https://docs.python.org/library/os.html#os.makedirs)创作。

```
import os
if not os.path.exists(directory):
    os.makedirs(directory) 
```

正如评论和其他地方所指出的，存在竞争条件——如果目录是在`os.path.exists`和`os.makedirs`调用之间创建的，`os.makedirs`则将失败并带有`OSError`. 不幸的是，一揽子捕获`OSError`和继续并不是万无一失的，因为它会忽略由于其他因素导致的目录创建失败，例如权限不足、磁盘已满等。

一种选择是捕获`OSError`并检查嵌入的错误代码（请参阅[Is there a cross-platform way of getting information from Python's OSError](https://stackoverflow.com/questions/273698/is-there-a-cross-platform-way-of-getting-information-from-pythons-oserror)）：

```
import os, errno

try:
    os.makedirs(directory)
except OSError as e:
    if e.errno != errno.EEXIST:
        raise 
```

或者，可能有第二个`os.path.exists`，但假设另一个在第一次检查之后创建了目录，然后在第二次检查之前将其删除——我们仍然可能被愚弄。

根据应用程序的不同，并发操作的危险可能大于或小于文件权限等其他因素带来的危险。在选择实现之前，开发人员必须更多地了解正在开发的特定应用程序及其预期环境。

[`FileExistsError`](https://docs.python.org/3.3/library/exceptions.html?#FileExistsError)现代版本的 Python 通过暴露（在 3.3+ 中）对这段代码进行了相当多的改进......

```
try:
    os.makedirs("path/to/directory")
except FileExistsError:
    # directory already exists
    pass 
```

...并通过允许[调用](https://docs.python.org/3.2/library/os.html#os.makedirs)[关键字参数`os.makedirs``exist_ok`](https://docs.python.org/3.2/library/os.html#os.makedirs)（在 3.2+ 中）。

```
os.makedirs("path/to/directory", exist_ok=True)  # succeeds even if directory exists. 
```

* * *

## 回答 #2

> 赞同：1428
> 
> 时间：2013-01-16T17:31:19.700

## Python 3.5+：

```
import pathlib
pathlib.Path('/my/directory').mkdir(parents=True, exist_ok=True) 
```

[`pathlib.Path.mkdir`](https://docs.python.org/library/pathlib.html#pathlib.Path.mkdir)如上所述，递归地创建目录，如果目录已经存在，则不会引发异常。如果您不需要或不希望创建父母，请跳过该`parents`参数。

## Python 3.2+：

**使用`pathlib`：**

如果可以，请安装`pathlib`名为[`pathlib2`](https://pypi.python.org/pypi/pathlib2/). 不要安装名为[`pathlib`](https://pypi.python.org/pypi/pathlib/). 接下来，参考上面的 Python 3.5+ 部分，同样使用它。

如果使用 Python 3.4，即使它带有`pathlib`，它也缺少有用的`exist_ok`选项。向后移植旨在提供一种更新和更好的实现，`mkdir`其中包括这个缺失的选项。

**使用`os`：**

```
import os
os.makedirs(path, exist_ok=True) 
```

[`os.makedirs`](https://docs.python.org/library/os.html#os.makedirs)如上所述，递归地创建目录，如果目录已经存在，则不会引发异常。仅当使用 Python 3.2+ 时它才具有可选`exist_ok`参数，默认值为`False`. 此参数在 Python 2.x 到 2.7 中不存在。因此，不需要像 Python 2.7 那样手动处理异常。

## Python 2.7+：

**使用`pathlib`：**

如果可以，请安装`pathlib`名为[`pathlib2`](https://pypi.python.org/pypi/pathlib2/). 不要安装名为[`pathlib`](https://pypi.python.org/pypi/pathlib/). 接下来，参考上面的 Python 3.5+ 部分，同样使用它。

**使用`os`：**

```
import os
try: 
    os.makedirs(path)
except OSError:
    if not os.path.isdir(path):
        raise 
```

虽然一个简单的解决方案可能首先使用[`os.path.isdir`](https://docs.python.org/2/library/os.path.html#os.path.isdir "os.path.isdir")后跟[`os.makedirs`](https://docs.python.org/2/library/os.html#os.makedirs "os.makedirs")，但上面的解决方案颠倒了这两个操作的顺序。这样做，它可以防止与创建目录的重复尝试有关的常见竞争条件，并且还可以消除目录中的文件歧义。

请注意，捕获异常并使用`errno`的用处有限`OSError: [Errno 17] File exists`，因为 ie`errno.EEXIST`会同时针对文件和目录引发。简单地检查目录是否存在更可靠。

## 选择：

[`mkpath`](https://docs.python.org/distutils/apiref.html#distutils.dir_util.mkpath)创建嵌套目录，如果目录已经存在，则不执行任何操作。这适用于 Python 2 和 3。

```
import distutils.dir_util
distutils.dir_util.mkpath(path) 
```

根据[Bug 10948](http://bugs.python.org/issue10948)，此替代方案的一个严重限制是它对于给定路径的每个 python 进程仅工作一次。换句话说，如果你使用它来创建一个目录，然后从 Python 内部或外部删除该目录，然后`mkpath`再次使用它来重新创建相同的目录，`mkpath`将只是默默地使用其先前创建目录的无效缓存信息，并且不会实际上再次制作目录。相反，`os.makedirs`不依赖任何此类缓存。对于某些应用程序，此限制可能没问题。

* * *

关于目录的*模式*，如果你关心它，请参考文档。

* * *

## 回答 #3

> 赞同：643
> 
> 时间：2011-02-17T17:17:25.517

使用 try except 和来自 errno 模块的正确错误代码摆脱了竞争条件并且是跨平台的：

```
import os
import errno

def make_sure_path_exists(path):
    try:
        os.makedirs(path)
    except OSError as exception:
        if exception.errno != errno.EEXIST:
            raise 
```

换句话说，我们尝试创建目录，但如果它们已经存在，我们将忽略错误。另一方面，报告任何其他错误。例如，如果您事先创建 dir 'a' 并从中删除所有权限，您将收到一个`OSError`引发`errno.EACCES`(Permission denied, error 13)。

* * *

## 回答 #4

> 赞同：123
> 
> 时间：2016-12-14T16:06:09.100

从 Python 3.5 开始，[`pathlib.Path.mkdir`](https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir)有一个`exist_ok`标志：

```
from pathlib import Path
path = Path('/my/directory/filename.txt')
path.parent.mkdir(parents=True, exist_ok=True) 
# path.parent ~ os.path.dirname(path) 
```

这会递归地创建目录，如果目录已经存在，则不会引发异常。

（就像从 python 3.2 开始[`os.makedirs`](https://docs.python.org/3/library/os.html?highlight=makedirs#os.makedirs)的标志一样）`exist_ok``os.makedirs(path, exist_ok=True)`

* * *

注意：当我发布这个答案时，没有提到其他答案`exist_ok`......

* * *

## 回答 #5

> 赞同：122
> 
> 时间：2009-01-14T17:57:32.920

我个人建议您使用`os.path.isdir()`to test 而不是`os.path.exists()`.

```
>>> os.path.exists('/tmp/dirname')
True
>>> os.path.exists('/tmp/dirname/filename.etc')
True
>>> os.path.isdir('/tmp/dirname/filename.etc')
False
>>> os.path.isdir('/tmp/fakedirname')
False 
```

如果你有：

```
>>> dir = raw_input(":: ") 
```

还有一个愚蠢的用户输入：

```
:: /tmp/dirname/filename.etc 
```

...`filename.etc`如果`os.makedirs()`您使用`os.path.exists()`.

* * *

## 回答 #6

> 赞同：97
> 
> 时间：2008-11-07T19:01:25.677

检查[`os.makedirs`](https://docs.python.org/3/library/os.html#os.makedirs)：（确保完整路径存在。）
要处理目录可能存在的事实，请 catch `OSError`。（如果`exist_ok`是`False`（默认值），`OSError`如果目标目录已经存在，则会引发 an。）

```
import os
try:
    os.makedirs('./path/to/somewhere')
except OSError:
    pass 
```

* * *

## 回答 #7

> 赞同：63
> 
> 时间：2008-11-07T19:00:01.717

试试这个[`os.path.exists`](https://docs.python.org/2/library/os.path.html#os.path.exists "os.path.exists")功能

```
if not os.path.exists(dir):
    os.mkdir(dir) 
```

* * *

## 回答 #8

> 赞同：57
> 
> 时间：2015-01-22T23:49:18.630

# 关于这种情况的具体情况的见解

您在特定路径中提供特定文件，然后从文件路径中提取目录。然后在确保您拥有该目录之后，您尝试打开一个文件进行读取。要评论此代码：

> ```
> filename = "/my/directory/filename.txt"
> dir = os.path.dirname(filename) 
> ```

我们希望避免覆盖内置函数`dir`. 此外，`filepath`或者可能`fullfilepath`是一个更好的语义名称，`filename`这样写得更好：

```
import os
filepath = '/my/directory/filename.txt'
directory = os.path.dirname(filepath) 
```

你的最终目标是打开这个文件，你最初声明，写，但你基本上是这样接近这个目标（基于你的代码），它打开文件进行**阅读**：

> ```
> if not os.path.exists(directory):
>     os.makedirs(directory)
> f = file(filename) 
> ```

## 假设开放阅读

你为什么要为一个你希望在那里并且能够读取的文件创建一个目录？

只需尝试打开文件。

```
with open(filepath) as my_file:
    do_stuff(my_file) 
```

如果目录或文件不存在，您将获得一个`IOError`带有相关错误号的：`errno.ENOENT`无论您的平台如何，都将指向正确的错误号。如果你愿意，你可以抓住它，例如：

```
import errno
try:
    with open(filepath) as my_file:
        do_stuff(my_file)
except IOError as error:
    if error.errno == errno.ENOENT:
        print 'ignoring error because directory or file is not there'
    else:
        raise 
```

## 假设我们开始写作

这*可能*就是你想要的。

在这种情况下，我们可能不会面临任何竞争条件。所以就照原样做，但请注意，要写入，您需要使用`w`模式打开（或`a`附加）。使用上下文管理器打开文件也是 Python 的最佳实践。

```
import os
if not os.path.exists(directory):
    os.makedirs(directory)
with open(filepath, 'w') as my_file:
    do_stuff(my_file) 
```

但是，假设我们有几个 Python 进程试图将它们的所有数据放到同一个目录中。然后我们可能会争用目录的创建。在这种情况下，最好将`makedirs`调用包装在 try-except 块中。

```
import os
import errno
if not os.path.exists(directory):
    try:
        os.makedirs(directory)
    except OSError as error:
        if error.errno != errno.EEXIST:
            raise
with open(filepath, 'w') as my_file:
    do_stuff(my_file) 
```

* * *

## 回答 #9

> 赞同：41
> 
> 时间：2008-11-07T21:23:03.333

我已经把以下内容。不过，这也不是万无一失的。

```
import os

dirname = 'create/me'

try:
    os.makedirs(dirname)
except OSError:
    if os.path.exists(dirname):
        # We are nearly safe
        pass
    else:
        # There was an error on creation, so make sure we know about it
        raise 
```

现在正如我所说，这并不是万无一失的，因为我们有可能无法创建目录，并且在此期间有另一个进程创建它。

* * *

## 回答 #10

> 赞同：33
> 
> 时间：2015-01-22T23:45:59.470

> **检查目录是否存在并在必要时创建它？**

对此的直接答案是，假设您不希望其他用户或进程弄乱您的目录的简单情况：

```
if not os.path.exists(d):
    os.makedirs(d) 
```

**或者**，如果使目录受制于竞争条件（即，如果在检查路径存在之后，可能已经有其他东西），请执行以下操作：

```
import errno
try:
    os.makedirs(d)
except OSError as exception:
    if exception.errno != errno.EEXIST:
        raise 
```

但也许更好的方法是通过使用临时目录来回避资源争用问题[`tempfile`](https://docs.python.org/library/tempfile.html#tempfile.mkdtemp "临时文件.mkdtemp")：

```
import tempfile

d = tempfile.mkdtemp() 
```

以下是在线文档中的要点：

> ```
> mkdtemp(suffix='', prefix='tmp', dir=None)
>     User-callable function to create and return a unique temporary
>     directory.  The return value is the pathname of the directory.
> 
>     The directory is readable, writable, and searchable only by the
>     creating user.
> 
>     Caller is responsible for deleting the directory when done with it. 
> ```

## Python 3.5 中的新功能：`pathlib.Path`使用`exist_ok`

有一个新`Path`对象（从 3.4 开始）有很多方法可以用于路径 - 其中之一是`mkdir`.

（对于上下文，我正在使用脚本跟踪我的每周代表。以下是脚本中代码的相关部分，可以让我避免每天针对相同的数据多次访问 Stack Overflow。）

首先是相关的进口：

```
from pathlib import Path
import tempfile 
```

我们现在不必处理`os.path.join`- 只需将路径部分加入`/`：

```
directory = Path(tempfile.gettempdir()) / 'sodata' 
```

然后我幂等地确保目录存在 -`exist_ok`参数显示在 Python 3.5 中：

```
directory.mkdir(exist_ok=True) 
```

[这是文档](https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir)的相关部分：

> 如果`exist_ok`为真，`FileExistsError`异常将被忽略（与命令的行为相同`POSIX mkdir -p`），但前提是最后一个路径组件不是现有的非目录文件。

这是脚本的更多内容 - 就我而言，我不受竞争条件的影响，我只有一个进程希望目录（或包含的文件）在那里，并且我没有任何尝试删除的内容目录。

```
todays_file = directory / str(datetime.datetime.utcnow().date())
if todays_file.exists():
    logger.info("todays_file exists: " + str(todays_file))
    df = pd.read_json(str(todays_file)) 
```

`Path``str`在其他期望`str`路径的 API 可以使用它们之前，必须强制对象。

也许应该更新 Pandas 以接受抽象基类的实例，`os.PathLike`.

* * *

## 回答 #11

> 赞同：26
> 
> 时间：2015-03-11T20:50:01.437

在 Python 3.4 中，您还可以使用[全新的`pathlib`模块](https://docs.python.org/3/library/pathlib.html)：

```
from pathlib import Path
path = Path("/my/directory/filename.txt")
try:
    if not path.parent.exists():
        path.parent.mkdir(parents=True)
except OSError:
    # handle error; you can also catch specific errors like
    # FileExistsError and so on. 
```

* * *

## 回答 #12

> 赞同：25
> 
> 时间：2016-03-29T15:50:53.783

对于单线解决方案，您可以使用[`IPython.utils.path.ensure_dir_exists()`](https://github.com/ipython/ipython/blob/b70b3f21749ca969088fdb54edcc36bb8a2267b9/IPython/utils/path.py#L423-L438)：

```
from IPython.utils.path import ensure_dir_exists
ensure_dir_exists(dir) 
```

从[文档](https://ipython.org/ipython-doc/3/api/generated/IPython.utils.path.html#IPython.utils.path.ensure_dir_exists)中：*确保目录存在。如果它不存在，请尝试创建它并在另一个进程正在执行相同操作时防止出现竞争条件。*

IPython 是一个扩展包，不是标准库的一部分。

* * *

## 回答 #13

> 赞同：21
> 
> 时间：2017-01-03T22:33:47.480

在**Python3**中，`os.makedirs`支持设置`exist_ok`。默认设置是`False`，这意味着`OSError`如果目标目录已经存在，将引发 an 。通过设置`exist_ok`为`True`, `OSError`(目录存在) 将被忽略并且不会创建目录。

```
os.makedirs(path,exist_ok=True) 
```

在**Python2**中，`os.makedirs`不支持设置`exist_ok`。您可以在[heikki-toivonen 的回答](https://stackoverflow.com/a/5032238/3109254)中使用该方法：

```
import os
import errno

def make_sure_path_exists(path):
    try:
        os.makedirs(path)
    except OSError as exception:
        if exception.errno != errno.EEXIST:
            raise 
```

* * *

## 回答 #14

> 赞同：19
> 
> 时间：2014-07-14T15:29:07.270

相关的[Python 文档](https://docs.python.org/2/library/os.html#files-and-directories)建议使用[EAFP 编码风格（Easier to Ask for Forgiveness than Permission）](https://docs.python.org/2/library/os.html#files-and-directories)。这意味着代码

```
try:
    os.makedirs(path)
except OSError as exception:
    if exception.errno != errno.EEXIST:
        raise
    else:
        print "\nBE CAREFUL! Directory %s already exists." % path 
```

比替代品更好

```
if not os.path.exists(path):
    os.makedirs(path)
else:
    print "\nBE CAREFUL! Directory %s already exists." % path 
```

文档表明这一点正是因为这个问题中讨论的竞争条件。此外，正如其他人在这里提到的那样，查询一次而不是两次操作系统具有性能优势。最后，在某些情况下（当开发人员知道应用程序正在运行的环境时）提出的论点可能支持第二个代码，只能在程序设置了私有环境的特殊情况下被提倡。本身（以及同一程序的其他实例）。

即使在这种情况下，这也是一种不好的做法，并且可能导致长时间无用的调试。例如，我们为目录设置权限这一事实不应该给我们留下印象权限是为我们的目的而适当设置的。可以使用其他权限安装父目录。一般来说，一个程序应该总是正确地工作，程序员不应该期望一个特定的环境。

* * *

## 回答 #15

> 赞同：16
> 
> 时间：2017-12-16T04:16:07.307

在我对在 Python 中使用目录时遇到的一些失败和错误感到困惑之后，我发现了这个 Q/A。我正在使用 Python 3（Arch Linux x86_64 系统上的 Anaconda 虚拟环境中的 v.3.5）。

考虑这个目录结构：

```
└── output/         ## dir
   ├── corpus       ## file
   ├── corpus2/     ## dir
   └── subdir/      ## dir 
```

这是我的实验/笔记，提供了说明：

```
# ----------------------------------------------------------------------------
# [1] https://stackoverflow.com/questions/273192/how-can-i-create-a-directory-if-it-does-not-exist

import pathlib

""" Notes:
        1\.  Include a trailing slash at the end of the directory path
            ("Method 1," below).
        2\.  If a subdirectory in your intended path matches an existing file
            with same name, you will get the following error:
            "NotADirectoryError: [Errno 20] Not a directory:" ...
"""
# Uncomment and try each of these "out_dir" paths, singly:

# ----------------------------------------------------------------------------
# METHOD 1:
# Re-running does not overwrite existing directories and files; no errors.

# out_dir = 'output/corpus3'                ## no error but no dir created (missing tailing /)
# out_dir = 'output/corpus3/'               ## works
# out_dir = 'output/corpus3/doc1'           ## no error but no dir created (missing tailing /)
# out_dir = 'output/corpus3/doc1/'          ## works
# out_dir = 'output/corpus3/doc1/doc.txt'   ## no error but no file created (os.makedirs creates dir, not files!  ;-)
# out_dir = 'output/corpus2/tfidf/'         ## fails with "Errno 20" (existing file named "corpus2")
# out_dir = 'output/corpus3/tfidf/'         ## works
# out_dir = 'output/corpus3/a/b/c/d/'       ## works

# [2] https://docs.python.org/3/library/os.html#os.makedirs

# Uncomment these to run "Method 1":

#directory = os.path.dirname(out_dir)
#os.makedirs(directory, mode=0o777, exist_ok=True)

# ----------------------------------------------------------------------------
# METHOD 2:
# Re-running does not overwrite existing directories and files; no errors.

# out_dir = 'output/corpus3'                ## works
# out_dir = 'output/corpus3/'               ## works
# out_dir = 'output/corpus3/doc1'           ## works
# out_dir = 'output/corpus3/doc1/'          ## works
# out_dir = 'output/corpus3/doc1/doc.txt'   ## no error but creates a .../doc.txt./ dir
# out_dir = 'output/corpus2/tfidf/'         ## fails with "Errno 20" (existing file named "corpus2")
# out_dir = 'output/corpus3/tfidf/'         ## works
# out_dir = 'output/corpus3/a/b/c/d/'       ## works

# Uncomment these to run "Method 2":

#import os, errno
#try:
#       os.makedirs(out_dir)
#except OSError as e:
#       if e.errno != errno.EEXIST:
#               raise
# ---------------------------------------------------------------------------- 
```

结论：在我看来，“方法2”更健壮。

[1][如何安全地创建嵌套目录？](https://stackoverflow.com/questions/273192/how-can-i-create-a-directory-if-it-does-not-exist)

[2] [https://docs.python.org/3/library/os.html#os.makedirs](https://docs.python.org/3/library/os.html#os.makedirs)

* * *

## 回答 #16

> 赞同：14
> 
> 时间：2016-09-13T21:44:56.923

您可以使用[`mkpath`](https://docs.python.org/2/distutils/apiref.html#distutils.dir_util.mkpath)

```
# Create a directory and any missing ancestor directories. 
# If the directory already exists, do nothing.

from distutils.dir_util import mkpath
mkpath("test") 
```

请注意，它也会创建祖先目录。

它适用于 Python 2 和 3。

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2017-02-09T03:56:05.167

我使用`os.path.exists()`,[这](http://pastebin.com/vnVk2rY5)是一个 Python 3 脚本，可用于检查目录是否存在，如果不存在则创建一个，如果存在则删除它（如果需要）。

它提示用户输入目录并且可以很容易地修改。

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2018-09-11T18:23:57.367

`mkdir`如果在支持带有`-p`选项的命令的机器上运行，为什么不使用子进程模块 ？适用于 python 2.7 和 python 3.6

```
from subprocess import call
call(['mkdir', '-p', 'path1/path2/path3']) 
```

应该在大多数系统上做到这一点。

在可移植性无关紧要的情况下（例如，使用 docker），解决方案是干净的 2 行。您也不必添加逻辑来检查目录是否存在。最后，重新运行是安全的，没有任何副作用

如果您需要错误处理：

```
from subprocess import check_call
try:
    check_call(['mkdir', '-p', 'path1/path2/path3'])
except:
    handle... 
```

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2019-05-19T00:32:23.273

您必须在创建目录之前设置完整路径：

```
import os,sys,inspect
import pathlib

currentdir = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))
your_folder = currentdir + "/" + "your_folder"

if not os.path.exists(your_folder):
   pathlib.Path(your_folder).mkdir(parents=True, exist_ok=True) 
```

这对我有用，希望它也对你有用

* * *

## 回答 #20

> 赞同：11
> 
> 时间：2021-08-17T17:24:05.227

如果您将文件写入变量路径，您可以在文件路径上使用它来确保创​​建父目录。

```
from pathlib import Path

path_to_file = Path("zero/or/more/directories/file.ext")
parent_directory_of_file = path_to_file.parent
parent_directory_of_file.mkdir(parents=True, exist_ok=True) 
```

即使`path_to_file`是`file.ext`（零目录深）也可以工作。

请参阅[pathlib.PurePath.parent](https://docs.python.org/3/library/pathlib.html#pathlib.PurePath.parent)和[pathlib.Path.mkdir](https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir)。

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2016-02-08T04:08:06.240

我看到[Heikki Toivonen](https://stackoverflow.com/a/5032238/3051142)和[ABB](https://stackoverflow.com/a/14364249)的回答并想到了这种变化。

```
import os
import errno

def make_sure_path_exists(path):
    try:
        os.makedirs(path)
    except OSError as exception:
        if exception.errno != errno.EEXIST or not os.path.isdir(path):
            raise 
```

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2018-04-16T07:30:10.890

使用此命令检查并创建目录

```
 if not os.path.isdir(test_img_dir):
     os.mkdir(test_img_dir) 
```

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2018-04-28T16:00:40.573

`create_dir()`在程序/项目的入口点调用该函数。

```
import os

def create_dir(directory):
    if not os.path.exists(directory):
        print('Creating Directory '+directory)
        os.makedirs(directory)

create_dir('Project directory') 
```

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2016-06-08T12:52:46.870

您可以`os.listdir`为此使用：

```
import os
if 'dirName' in os.listdir('parentFolderPath')
    print('Directory Exists') 
```

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2016-12-03T16:00:13.347

如果您考虑以下情况：

```
os.path.isdir('/tmp/dirname') 
```

表示存在目录（路径）并且是目录。所以对我来说，这种方式可以满足我的需要。所以我可以确保它是文件夹（不是文件）并且存在。

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2020-10-22T03:32:43.977

这可能不能完全回答这个问题。但我猜你的真正意图是创建一个文件及其父目录，因为它的内容全部在 1 个命令中。

您可以通过`fastcore`对 pathlib 的扩展来做到这一点：`path.mk_write(data)`

```
from fastcore.utils import Path
Path('/dir/to/file.txt').mk_write('Hello World') 
```

[在fastcore 文档](https://fastcore.fast.ai/xtras.html#Path.mk_write)中查看更多信息

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2017-07-05T23:15:27.847

```
import os
if os.path.isfile(filename):
    print "file exists"
else:
    "Your code here" 
```

> 您的代码在这里使用 (touch) 命令

这将检查文件是否存在，如果不存在，它将创建它。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2022-02-08T06:11:08.027

**在 python 中执行此操作的最佳方法**

```
#Devil
import os
directory = "./out_dir/subdir1/subdir2"
if not os.path.exists(directory):
    os.makedirs(directory) 
```

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2020-09-10T03:39:26.787

在 Linux 下你可以创建嵌套目录

```
 dir1/dir2/... 
```

在一行中：

```
import os
os.system("mkdir -p {0}".format('dir1/dir2/dir3')) 
```

# .net - xsl:template match 找不到匹配项

> ID：273199
> 
> 赞同：11
> 
> 时间：2008-11-07T18:58:25.510
> 
> 标签：.net, xml, xslt

我正在尝试使用 .NET XslCompiledTransform 将一些 Xaml 转换为 HTML，并且在让 xslt 匹配 Xaml 标记时遇到了困难。例如，使用此 Xaml 输入：

```
<FlowDocument PagePadding="5,0,5,0" AllowDrop="True" NumberSubstitution.CultureSource="User" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation">
  <Paragraph>a</Paragraph>
</FlowDocument> 
```

而这个 xslt：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl"
>

  <xsl:output method="html" indent="yes"/>

  <xsl:template match="/">
    <html>
      <body>
        <xsl:apply-templates />
      </body>
    </html>
  </xsl:template>

  <xsl:template match="FlowDocument">
    <xsl:apply-templates />
  </xsl:template>

  <xsl:template match="Paragraph" >
    <p>
      <xsl:apply-templates />
    </p>
  </xsl:template> 
```

我得到这个输出：

```
<html>
    <body>
  a
</body>
</html> 
```

而不是预期的：

```
<html>
   <body>
      <p>a</p>
   </body>
</html> 
```

这可能是名称空间的问题吗？这是我第一次尝试 xsl 转换，所以我很茫然。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-07T19:14:22.670

是的，这是命名空间的问题。输入文档中的所有元素都在命名空间中`http://schemas.microsoft.com/winfx/2006/xaml/presentation`。您的模板正在尝试匹配默认命名空间中的元素，但没有找到任何元素。

您需要在转换中声明此命名空间，为其分配一个前缀，然后在旨在匹配该命名空间中的元素的任何模式中使用该前缀。所以你的 XSLT 应该是这样的：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:msxsl="urn:schemas-microsoft-com:xslt" 
    xmlns:p="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    exclude-result-prefixes="msxsl"/>

<xsl:output method="html" indent="yes"/>

<xsl:template match="/">
  <html>
    <body>
      <xsl:apply-templates />
    </body>
  </html>
</xsl:template>

<xsl:template match="p:FlowDocument">
  <xsl:apply-templates />
</xsl:template>

<xsl:template match="p:Paragraph" >
  <p>
    <xsl:apply-templates />
  </p>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T19:25:23.740

当我从您的源文档中删除它时，它会起作用：

```
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
```

我不相信你的最后两个模板完全匹配。（您可以通过在 FlowDocument 模板中放置类似包装 <div> 的内容来进行测试。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-08T15:17:21.270

试着改变

“xsl：模板匹配='/'”

在你的 xsl 文件中标记

“xsl：模板匹配='*'”

这应该会给你想要的输出。

# .net - WPF 树视图绑定

> ID：273200
> 
> 赞同：0
> 
> 时间：2008-11-07T18:58:35.993
> 
> 标签：.net, wpf, linq, entity-framework, data-binding

我有一个带有 Parent 和 Children 属性的类。

[ADO.NET 实体框架分层页面类 http://img148.imageshack.us/img148/6802/edmxxe8.gif](http://img148.imageshack.us/img148/6802/edmxxe8.gif)

我想在 WPF 树视图中显示这个层次结构。

这是我的 XAML ......

```
<TreeView Margin="12" Name="TreeViewPages" ItemsSource="{Binding}">
    <TreeView.Resources>
        <HierarchicalDataTemplate DataType="{x:Type Page}" ItemsSource="{Binding Children}">
            <TextBlock Text="{Binding Path=ShortTitle}" />
        </HierarchicalDataTemplate>
    </TreeView.Resources>
</TreeView> 
```

还有我的VB代码...

```
Dim db 作为新的 PageEntities
Dim t = From p In db.Page.Include("Children") _
        p.Parent 什么都不是 _
        选择 p
TreeViewPages.ItemsSource = t

```

但我得到一棵树，里面有一个非模板项目：

```
页面管理器.Page

```

我需要做什么才能使它正常工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T19:14:35.150

您需要在 XAML 文件中定义到 Page 类的 xmlns 映射，并在 Type 声明中使用它。您没有收到编译错误的原因是 Page 类已在 WPF 中定义。

因此，如果您的 Page 类是在 Zack 命名空间中定义的，则在 TreeViewBinding 程序集中，您需要将以下声明添加到父容器（很可能是 Window）：

```
xmlns:local="clr-namespace:Zack;assembly=TreeViewBinding" 
```

然后将您的 DataTemplate 修改为以下内容：

```
<HierarchicalDataTemplate DataType="{x:Type local:Page}" ItemsSource="{Binding Children}"> 
```

我将针对您的原始问题澄清我的帖子。

# python - 使用 SQL 或其他变通方法访问存储过程的第二个结果集？Python\pyodbc

> ID：273203
> 
> 赞同：13
> 
> 时间：2008-11-07T18:58:47.633
> 
> 标签：python, sql, pyodbc

我正在使用 python\pyodbc 并希望访问存储过程的第二个结果集。据我所知，pyodbc 不支持多个结果集。此外，我无法修改存储过程。是否有任何选项可以使用 SQL 或其他解决方法访问第二个结果集？也许创建第二个存储过程，它只返回第一个结果集的第二个结果集？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-24T08:31:21.097

不需要任何花哨的东西。只需使用[光标的`nextset()`方法](https://github.com/mkleehammer/pyodbc/wiki/Cursor#nextset)：

```
 import pyodbc

db = pyodbc.connect ("")
q = db.cursor ()
q.execute ("""
SELECT TOP 5 * FROM INFORMATION_SCHEMA.TABLES
SELECT TOP 10 * FROM INFORMATION_SCHEMA.COLUMNS
""")
tables = q.fetchall ()
q.nextset ()
columns = q.fetchall ()

assert len (tables) == 5
assert len (columns) == 10 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T19:43:29.553

[这里](http://www.sommarskog.se/share_data.html)有几种可能的方法。如果结果集都相同，您也许可以使用 INSERT...EXEC 方法。否则 OPENQUERY 可能会起作用。

# c++ - 内存泄漏可以吗？

> ID：273209
> 
> 赞同：238
> 
> 时间：2008-11-07T19:01:52.867
> 
> 标签：c++, c, memory-leaks

在您的 C 或 C++ 应用程序中存在[内存泄漏](http://en.wikipedia.org/wiki/Memory_leak)是否可以接受？

如果您分配一些内存并使用它直到应用程序中的最后一行代码（例如，全局对象的析构函数）怎么办？只要内存消耗不随时间增长，是否可以相信操作系统在应用程序终止时（在 Windows、Mac 和 Linux 上）为您释放内存？如果内存被连续使用直到被操作系统释放，你甚至会认为这是一个真正的内存泄漏。

如果第三方库将这种情况强加给您怎么办？是否会拒绝使用该第三方库，无论它有多么出色？

我只看到一个实际的缺点，那就是这些良性泄漏会在内存泄漏检测工具中显示为误报。

* * *

## 回答 #1

> 赞同：337
> 
> 时间：2008-11-07T19:20:25.530

不。

作为专业人士，我们不应该问自己的问题是：“这样做可以吗？” 而是“是否有*充分*的理由这样做？” 并且“寻找内存泄漏是一种痛苦”并不是一个好的理由。

我喜欢让事情变得简单。简单的规则是我的程序不应该有内存泄漏。

这也让我的生活变得简单。如果我检测到内存泄漏，我会消除它，而不是通过一些复杂的决策树结构来确定它是否是“可接受的”内存泄漏。

它类似于编译器警告——警告对我的特定应用程序是否致命？也许不吧。

但这最终是一个专业纪律的问题。容忍编译器警告和容忍内存泄漏是一个坏习惯，最终会在后面咬我。

把事情推到一个极端，外科医生将一些手术设备留在病人体内是可以接受的吗？

尽管可能会出现移除该设备的成本/风险超过将其留在其中的成本/风险的情况，并且可能存在无害的情况，如果我在 SurgeonOverflow.com 上看到此问题并看到除“不”之外的任何答案，这将严重破坏我对医学界的信心。

——</p>

如果第三方图书馆将这种情况强加于我，我会严重怀疑该图书馆的整体质量。就好像我试驾了一辆车，在一个杯架上发现了几个松动的垫圈和螺母——这本身可能没什么大不了的，但它表现出对质量的承诺不足，所以我会考虑替代品。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2008-11-07T19:06:51.423

我不认为这是内存泄漏，除非“使用”的内存量不断增长。拥有一些未释放的内存虽然并不理想，但也不是什么大问题，除非所需的内存量不断增长。

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2008-11-08T06:02:47.120

首先让我们的定义正确。内存*泄漏*是当内存被动态分配时，例如使用`malloc()`，并且所有对内存的引用都会丢失而没有相应的空闲。一个简单的方法是这样的：

```
#define BLK ((size_t)1024)
while(1){
    void * vp = malloc(BLK);
} 
```

请注意，每次 while(1) 循环时，都会分配 1024 (+overhead) 字节，并将新地址分配给 vp; 没有剩余的指向前一个 malloc 块的指针。这个程序保证在堆用完之前一直运行，并且没有办法恢复任何 malloc 的内存。内存从堆中“泄漏”出来，再也见不到了。

不过，你所描述的听起来像

```
int main(){
    void * vp = malloc(LOTS);
    // Go do something useful
    return 0;
} 
```

您分配内存，使用它直到程序终止。这*不是*内存泄漏；它不会损害程序，并且在程序终止时会自动清除所有内存。

通常，您应该避免内存泄漏。首先，因为就像你的高度和机库的燃料一样，已经泄漏且无法恢复的内存是无用的；其次，在开始时正确编码而不是泄漏内存比后来发现内存泄漏要容易得多。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2008-11-07T19:05:12.267

理论上没有，实际上*取决于*.

这实际上取决于程序正在处理多少数据，程序运行的频率以及它是否持续运行。

如果我有一个读取少量数据的快速程序进行计算并退出，则永远不会注意到小的内存泄漏。因为程序运行时间不长，只使用少量内存，所以泄漏会很小，当程序存在时会被释放。

另一方面，如果我有一个程序可以处理数百万条记录并运行很长时间，那么如果有足够的时间，一个小的内存泄漏可能会导致机器停机。

至于有泄漏的第三方库，如果它们引起问题，要么修复库，要么找到更好的替代方案。如果它不会引起问题，那真的很重要吗？

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-11-10T01:05:26.207

很多人的印象似乎是，一旦释放内存，它就会立即返回操作系统并可供其他程序使用。

这不是真的。操作系统通常以 4KiB 页面管理内存。`malloc`和其他类型的内存管理从操作系统获取页面并在他们认为合适的时候对它们进行子管理。假设您的程序稍后会分配更多内存，则很可能`free()`不会*将页面返回给操作系统。*

我并不是说`free()`永远不会将内存返回给操作系统。它可能会发生，尤其是当您释放大量内存时。但不能保证。

**重要的事实：**如果您不释放不再需要的内存，则可以保证进一步的 malloc 会消耗*更多的*内存。但是如果你先释放，malloc 可能会重新使用释放的内存。

这在实践中意味着什么？这意味着如果您知道您的程序从现在开始不再需要任何内存（例如，它处于清理阶段），那么释放内存就不是那么重要了。但是，如果程序稍后可能会分配更多内存，则应避免内存泄漏——尤其是可能重复发生的内存泄漏。

另请参阅[此评论](https://stackoverflow.com/questions/231089/freeing-in-an-atexit#242317)以获取有关为什么在终止前释放内存不好的更多详细信息。

评论者似乎不明白调用`free()`不会自动允许其他程序使用释放的内存。但这就是这个答案的全部意义！

所以，为了说服人们，我将展示一个 free() 没有什么好处的例子。为了使数学易于理解，我将假设操作系统管理 4000 字节页面中的内存。

假设您分配了一万个 100 字节的块（为简单起见，我将忽略管理这些分配所需的额外内存）。这会消耗 1MB 或 250 页。如果您随后随机释放 9000 个这些块，那么您只剩下 1000 个块 - 但它们分散在各处。据统计，大约有 5 个页面是空的。其他 245 个将每个都至少有一个分配的块。这相当于 980KB 的内存，操作系统不可能回收 - 即使您现在只分配了 100KB！

另一方面，您现在可以 malloc() 再增加 9000 个块，而不会增加程序占用的内存量。

即使在*技术上*`free()`可以将内存返回给操作系统，它也可能不会这样做。需要在快速运行和节省内存之间取得平衡。此外，一个已经分配了大量内存然后释放它的程序很可能会再次这样做。Web 服务器需要在一个又一个请求后处理请求 - 保持一些“松弛”内存可用是有意义的，这样您就不需要一直向操作系统询问内存。*`free()`*

 ** * *

## 回答 #6

> 赞同：27
> 
> 时间：2008-11-07T19:08:27.877

在应用程序运行后清理操作系统在概念上没有任何问题。

这实际上取决于应用程序及其运行方式。必须注意需要运行数周的应用程序中持续发生的泄漏，但是一个无需太高内存需求即可计算结果的小工具应该不是问题。

许多脚本语言不垃圾收集循环引用是有原因的……对于它们的使用模式，这不是一个实际的问题，因此与浪费的内存一样浪费资源。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-11-08T18:55:16.733

我相信答案是否定的，绝不允许内存泄漏，而且我有一些我没有看到明确说明的原因。这里有很好的技术答案，但我认为真正的答案取决于更多的社会/人类原因。

（首先，请注意，正如其他人所提到的，真正的泄漏是指您的程序在任何时候都丢失了它已分配的内存资源的跟踪。在 C 中，当您`malloc()`指向一个指针并让该指针离开范围而没有执行`free()`第一的。）

**您在这里决定的重要症结是习惯。**当您使用使用指针的语言进行编码时，您将*大量*使用指针。指针很危险；它们是将各种严重问题添加到代码中的最简单方法。

当你编写代码时，有时你会忙得不可开交，有时你会感到疲倦、生气或担心。在那些有点分心的时候，你在自动驾驶仪上编码更多。**自动驾驶效果不会区分一次性代码和大型项目中的模块。在那些时候，你建立的习惯最终会出现在你的代码库中。**

所以不，永远不要允许内存泄漏，因为即使你是路上唯一的汽车，你仍然应该在改变车道时检查你的盲点。**在你活跃的大脑分心的时候，良好的习惯可以让你免于灾难性的失误。**

除了“习惯”问题之外，指针是复杂的，并且通常需要大量的脑力来进行心理跟踪。在使用指针时，最好不要“搅浑水”，尤其是当您不熟悉编程时。

还有更多的社交方面。通过正确使用`malloc()`and `free()`，任何查看您的代码的人都会感到放心；你正在管理你的资源。但是，如果您不这样做，他们会立即怀疑存在问题。

**也许你已经知道在这种情况下内存泄漏不会伤害任何东西，但是当你的代码的每个维护者阅读那段代码时，他也必须在脑海中解决这个问题。**通过使用`free()`，您甚至无需考虑问题。

最后，编程是用一种明确的语言编写一个过程的心智模型，以便人和计算机可以完美地理解所述过程。**良好编程实践的一个重要部分是永远不要引入不必要的歧义。**

智能编程既灵活又通用。糟糕的编程是模棱两可的。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2010-06-28T06:11:39.970

我将给出一个不受欢迎但实用的答案，即**释放内存总是错误的，除非这样做会减少程序的内存使用量**。例如，一个程序进行单个分配或一系列分配来加载它将在其整个生命周期中使用的数据集，不需要释放任何东西。在具有非常动态内存需求的大型程序的更常见情况下（想想网络浏览器），您显然应该尽快释放不再使用的内存（例如关闭选项卡/文档/等） ，但是当用户选择点击“退出”时，没有理由释放任何东西，这样做实际上是对用户体验有害的。

为什么？释放内存需要触摸内存。即使您的系统的 malloc 实现碰巧没有在分配的内存块附近存储元数据，您也可能会遍历递归结构以找到您需要释放的所有指针。

现在，假设您的程序处理了大量数据，但有一段时间没有触及其中的大部分数据（同样，Web 浏览器就是一个很好的例子）。如果用户正在运行大量应用程序，则该数据的很大一部分可能已交换到磁盘。如果你只是 exit(0) 或从 main 返回，它会立即退出。很棒的用户体验。如果您不小心尝试释放所有内容，您可能会花费 5 秒或更长时间将所有数据交换回，然后立即将其丢弃。浪费用户的时间。浪费笔记本电脑的电池寿命。浪费硬盘的磨损。

这不仅仅是理论上的。每当我发现自己加载了太多应用程序并且磁盘开始抖动时，我什至不会考虑单击“退出”。我尽可能快地到达终端并输入 killall -9 ...因为我知道“退出”只会让情况变得更糟。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-11-07T19:15:27.740

我认为在你的情况下，答案可能是没关系。但是您绝对需要证明内存泄漏是一个有意识的决定。您不希望维护程序员出现，将您的代码放入函数中，然后调用它一百万次。因此，如果您决定泄漏是可以的，您需要将其记录下来（用大写字母），以供将来可能需要处理该程序的任何人使用。

如果这是第三方库，您可能会被困。但绝对记录发生这种泄漏。

但基本上，如果内存泄漏是一个已知数量，如 512 KB 缓冲区或其他东西，那么这不是问题。如果内存泄漏一直在增长，就像每次调用库时一样，你的内存增加了 512KB 并且没有被释放，那么你可能会遇到问题。如果您记录它并控制调用执行的次数，它可能是易于管理的。但是，您确实需要文档，因为虽然 512 并不多，但超过一百万次调用的 512 却很多。

您还需要检查您的操作系统文档。如果这是嵌入式设备，则可能存在操作系统不会从退出的程序中释放所有内存。我不确定，也许这不是真的。但值得研究。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2008-11-07T19:07:13.823

我敢肯定，有人会想出一个理由说“是”，但不会是我。我不会说不，而是说这不应该是一个是/否的问题。有一些方法可以管理或控制内存泄漏，许多系统都有这些方法。

离开地球的设备上有 NASA 系统为此计划。系统会每隔一段时间自动重启一次，这样内存泄漏就不会对整个操作造成致命的影响。只是一个遏制的例子。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-11-07T19:13:32.937

如果您分配内存并使用它直到程序的最后一行，那不是泄漏。如果您分配内存并忘记它，即使内存量没有增长，这也是一个问题。已分配但未使用的内存可能会导致其他程序运行速度变慢或根本不运行。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-11-07T20:41:16.457

一方面，我可以数出我在一段时间内看到的“良性”泄漏的数量。

所以答案是非常合格的yes。

一个例子。如果您有一个需要缓冲区来存储循环队列或双端队列的单例资源，但不知道缓冲区需要多大，并且无法承担锁定或每个读取器的开销，那么分配一个指数倍增的缓冲区但是不释放旧的将泄漏每个队列/双端队列的有限内存量。这样做的好处是它们极大地加速了每次访问，并且可以通过永远不会冒着争用锁的风险来改变多处理器解决方案的渐近性。

我已经看到这种方法对于具有非常明确固定计数的事物（例如每 CPU 工作窃取双端队列）非常有用，并且在用于保存`/proc/self/maps`Hans Boehm 的 C 的保守垃圾收集器中的单例状态的缓冲区中的程度要小得多/C++，用于检测根集等。

虽然从技术上讲是泄漏，但这两种情况的大小都是有限的，并且在可增长的循环工作窃取双端队列的情况下，有*巨大*的性能提升，以换取队列的内存使用量增加 2 倍。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2008-11-07T20:44:41.350

如果您在程序开始时分配了一堆堆，并且在退出时没有释放它，那么这本身就不是内存泄漏。内存泄漏是指您的程序在一段代码上循环，并且该代码分配了堆，然后“丢失轨道”而不释放它。

事实上，没有必要在退出之前调用 free() 或 delete。当进程退出时，它的所有内存都被操作系统回收（POSIX 肯定是这种情况。在其他操作系统上——尤其是嵌入式操作系统——YMMV）。

我在退出时不释放内存的唯一警告是，如果你重构你的程序，例如，它变成一个等待输入的服务，不管你的程序做什么，然后循环等待另一个服务调用，那么您编码的内容*可能*会变成内存泄漏。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-11-07T19:33:04.257

在这种问题中，上下文就是一切。就我个人而言，我无法忍受泄漏，并且在我的代码中，如果它们突然出现，我会竭尽全力修复它们，但修复泄漏并不总是值得的，而且当人们有时按小时付费时告诉他们修复他们代码中的漏洞不值得我花钱。让我给你举个例子：

我正在对一个项目进行分类，做一些性能工作并修复了很多错误。在我追踪并完全理解的应用程序初始化期间存在泄漏。正确地修复它需要一天左右的时间来重构一段原本可以正常工作的代码。我本可以做一些骇人听闻的事情（比如将值填充到一个全局变量中并在某个我知道它不再用于释放的地方抓住它），但这只会给下一个不得不接触代码的人带来更多的困惑。

就个人而言，我一开始不会那样编写代码，但我们大多数人并不总是在设计良好的原始代码库上工作，有时你必须务实地看待这些事情。我修复 150 字节泄漏所花费的时间可以用来进行算法改进，从而减少数兆字节的内存。

最终，我认为对于一个使用大约 1 g ram 并在专用机器上运行的应用程序泄漏 150 字节是不值得修复的，所以我写了一条评论说它被泄露了，需要更改什么才能修复它，以及为什么当时不值得。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-11-07T19:13:31.237

这是特定领域的问题，几乎不值得回答。用你那该死的脑袋。

*   航天飞机操作系统：不，不允许内存泄漏
*   快速开发概念验证代码：修复所有这些内存泄漏是浪费时间。

并且有一系列中间情况。

延迟产品发布以修复除了最严重的内存泄漏之外的所有问题的机会成本（$$$）通常会使任何“马虎或不专业”的感觉相形见绌。你的老板付钱给你是为了让他赚钱，而不是为了得到一种温暖、模糊的感觉。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-11-07T19:15:09.190

您必须首先意识到感知到的内存泄漏和实际的内存泄漏之间存在很大差异。分析工具经常会报告许多红鲱鱼，并将某些东西标记为已泄漏（内存或资源，如句柄等），而实际上并没有。这通常是由于分析工具的架构造成的。例如，某些分析工具会将运行时对象报告为内存泄漏，因为它永远不会看到这些对象被释放。但是释放发生在运行时的关闭代码中，分析工具可能无法看到。

话虽如此，有时您仍然会遇到很难找到或很难修复的实际内存泄漏。所以现在问题变成了将它们留在代码中是否可以？

理想的答案是“不，永远不会”。更务实的答案可能是“不，几乎从不”。在现实生活中，您通常只有有限的资源和时间来解决以及无穷无尽的任务列表。当其中一项任务是消除内存泄漏时，收益递减法则经常发挥作用。你可以在一周内消除应用程序中 98% 的内存泄漏，但剩下的 2% 可能需要几个月的时间。在某些情况下，由于应用程序的架构，如果不对代码进行重大重构，甚至可能无法消除某些泄漏。您必须权衡消除剩余 2% 的成本和收益。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-01-12T03:23:01.987

虽然大多数答案都集中在真正的内存泄漏上（这从来都不好，因为它们是编码草率的标志），这部分问题对我来说似乎更有趣：

> 如果您分配一些内存并使用它直到应用程序中的最后一行代码（例如，全局对象的解构器）怎么办？只要内存消耗不随时间增长，是否可以相信操作系统在应用程序终止时（在 Windows、Mac 和 Linux 上）为您释放内存？如果内存被连续使用直到被操作系统释放，你甚至会认为这是一个真正的内存泄漏。

如果使用了关联的内存，则无法在程序结束之前释放它。免费是由程序退出还是由操作系统完成并不重要。只要对此进行了记录，这样更改就不会引入真正的内存泄漏，并且只要图片中不涉及 C++ 析构函数或 C 清理函数。未关闭的文件可能会通过泄漏的`FILE`对象暴露出来，但缺少 fclose() 也可能导致缓冲区不被刷新。

因此，回到最初的情况，恕我直言，它本身完全没问题，以至于 Valgrind，最强大的检漏仪之一，只会在请求时处理此类泄漏。在 Valgrind 上，当你覆盖一个指针而不事先释放它时，它被认为是内存泄漏，因为它更有可能再次发生并导致堆无休止地增长。

然后，没有仍然可以访问的 nfreed 内存块。可以确保在出口处释放所有人，但这本身就是浪费时间。关键是他们*之前*是否可以被释放。在任何情况下，降低内存消耗都是有用的。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-11-07T19:15:33.387

我同意 vfilby - 这取决于。在 Windows 中，我们将内存泄漏视为相对严重的错误。但是，它在很大程度上取决于组件。

例如，对于很少运行且运行时间有限的组件，内存泄漏并不是很严重。这些组件运行，完成它们的工作，然后退出。当他们退出时，他们的所有内存都会被隐式释放。

但是，服务或其他长期运行的组件（如 shell）中的内存泄漏非常严重。原因是这些错误会随着时间的推移“窃取”内存。恢复这种情况的唯一方法是重新启动组件。大多数人不知道如何重新启动服务或 shell——所以如果他们的系统性能受到影响，他们只会重新启动。

因此，如果您有泄漏 - 以两种方式评估其影响

1.  为了您的软件和您的用户体验。
2.  对系统（和用户）而言，节约使用系统资源。
3.  修复对维护和可靠性的影响。
4.  在其他地方引起回归的可能性。

福特克

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-11-07T20:32:54.620

即使您确定您的“已知”内存泄漏不会造成严重破坏，也不要这样做。充其量，它会为您在不同的时间和地点犯下类似且可能更严重的错误铺平道路。

对我来说，问这个问题就像在问“我可以在凌晨 3 点在没有人的情况下闯红灯吗？”。可以肯定的是，它在那个时候可能不会造成任何麻烦，但它会为您在高峰时间做同样的事情提供一个杠杆！

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-11-16T07:36:03.757

不，您不应该有操作系统会为您清理的泄漏。原因（据我所知，上面的答案中没有提到）是你永远不知道**你的 main() 什么时候会被重新用作另一个程序中的函数/模块**。如果您的 main() 成为其他人软件中经常调用的函数 - 该软件将出现内存泄漏，随着时间的推移会占用内存。

基辅

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2016-04-11T09:55:26.940

我很惊讶地看到这么多关于内存泄漏实际上是什么的错误定义。没有一个具体的定义，关于它是否是坏事的讨论将无从谈起。

正如一些评论者正确指出的那样，只有当进程分配的内存超出范围以至于进程不再能够引用或删除它时，才会发生内存泄漏。

占用越来越多内存的进程不一定会泄漏。只要它能够引用和取消分配该内存，它就会保持在进程的显式控制之下并且没有泄漏。该过程可能设计得很糟糕，尤其是在内存有限的系统环境中，但这与泄漏不同。相反，即使泄漏的内存量很小，失去范围（例如 32 字节缓冲区）仍然是泄漏。如果您认为这无关紧要，请等到有人在您的库调用中封装一个算法并调用它 10,000 次。

我认为没有任何理由允许您自己的代码泄漏，无论多么小。现代编程语言（如 C 和 C++）竭尽全力帮助程序员防止此类泄漏，而且很少有理由不采用良好的编程技术（尤其是在与特定语言设施结合使用时）来防止泄漏。

对于现有或第三方代码，您对质量的控制或进行更改的能力可能受到高度限制，根据泄漏的严重程度，您可能被迫接受或采取缓解措施，例如定期重新启动流程以减少泄漏的影响。

可能无法更改或替换现有（泄漏）代码，因此您可能必须接受它。但是，这与声明没关系是不一样的。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2010-09-18T20:04:21.487

我想如果您正在编写一个旨在泄漏内存的程序（即测试内存泄漏对系统性能的影响），那很好。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-11-07T19:07:00.783

如果它是故意的并且它不是问题，除非它有大量内存，否则它真的不是泄漏，或者可能会增长到大量内存。在程序的生命周期内不清理全局分配是相当普遍的。如果泄漏发生在服务器或长时间运行的应用程序中，并且随着时间的推移而增长，那么它就是一个问题。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-11-07T19:07:51.530

我想你已经回答了你自己的问题。最大的缺点是它们如何干扰内存泄漏检测工具，但我认为这个缺点对于某些类型的应用程序来说是一个巨大的缺点。

我使用应该坚如磐石的遗留服务器应用程序，但它们存在泄漏，并且全局变量确实妨碍了内存检测工具。这是一件大事。

在贾里德·戴蒙德 (Jared Diamond) 的《崩溃》一书中，作者想知道那个砍倒复活节岛上最后一棵树的人在想什么，他需要这棵树才能建造一艘独木舟下岛。我想知道多年前将第一个全局变量添加到我们的代码库中的那一天。那是它应该被抓住的那一天。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-11-07T19:08:55.070

我看到了与所有这样的场景问题相同的问题：当程序发生变化时会发生什么，突然间那个小内存泄漏被调用了一千万次，而你的程序的结尾在不同的地方，所以这很重要吗？如果它在库中，则向库维护者记录错误，不要将泄漏放入您自己的代码中。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2008-11-07T19:12:19.070

我会回答不。

理论上，如果你留下一团糟，操作系统会在你之后清理（现在这很粗鲁，但由于计算机没有感觉，这可能是可以接受的）。但是您无法预测程序运行时可能发生的所有情况。因此（除非您能够对某些行为进行正式证明），从专业角度来看，创建内存泄漏是不负责任和草率的。

如果第三方组件泄漏内存，这是一个非常强烈的反对使用它的论据，不仅因为迫在眉睫的影响，还因为它表明程序员工作马虎并且这也可能影响其他指标。现在，在考虑遗留系统时，这很困难（考虑 Web 浏览组件：据我所知，它们*都会*泄漏内存），但这应该是常态。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2008-11-07T19:20:07.137

从历史上看，在某些边缘情况下，它在某些操作系统上确实很重要。这些边缘情况可能在未来存在。

举个例子，在 Sun 3 时代的 SunOS 上，如果一个进程使用 exec（或者更传统的 fork 然后 exec），那么后续的新进程将继承与父进程相同的内存占用，并且无法收缩. 如果父进程分配了 1/2 gig 的内存并且在调用 exec 之前没有释放它，则子进程将开始使用相同的 1/2 gig（即使它没有被分配）。SunTools（他们的默认窗口系统）最好地展示了这种行为，它是一个内存猪。它产生的每个应用程序都是通过 fork/exec 创建的，并继承了 SunTools 的足迹，迅速填满了交换空间。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-11-07T22:22:18.407

这已经被讨论[得令人作呕](https://stackoverflow.com/questions/233258/is-there-an-acceptable-limit-for-memory-leaks)。底线是内存泄漏是一个错误，必须修复。如果第三方库泄漏内存，人们会想知道它还有什么问题，不是吗？如果您正在制造汽车，您会使用偶尔漏油的发动机吗？毕竟，引擎是别人制造的，所以这不是你的错，你也修不了，对吧？

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2008-11-07T22:24:15.207

通常，独立应用程序中的内存泄漏不是致命的，因为它会在程序退出时被清除。

对于设计为不会退出的服务器程序，您会怎么做？

如果您是那种不会设计和实现正确分配和释放资源的代码的程序员，那么我不希望与您或您的代码有任何关系。如果您不想清理泄漏的内存，那么您的锁呢？你也让他们在那里闲逛吗？您是否在各个目录中留下了一些临时文件？

泄漏内存并让程序清理它？不，绝对不是。这是一个坏习惯，会导致错误、错误和更多错误。

**自己打扫干净。哟妈妈不再在这里工作了。**

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2008-11-11T19:27:17.027

作为一般规则，如果您感到无法避免的内存泄漏，那么您需要更加认真地考虑对象所有权。

但是对于您的问题，我的回答是*在生产代码中，是的。在开发过程中，没有*. 这可能看起来倒退，但这是我的推理：

在您描述的情况下，内存一直保留到程序结束，不释放它是完全可以的。一旦您的进程退出，操作系统无论如何都会清理。事实上，它可能会让用户体验更好：在我开发的一款游戏中，程序员认为在退出之前释放所有内存会更干净，导致程序关闭最多需要半分钟！一个刚刚调用 exit() 的快速更改反而使该进程立即消失，并将用户放回他想要的桌面。

但是，您对调试工具的看法是正确的：它们会出错，并且所有误报都可能使查找真正的内存泄漏变得很痛苦。因此，请始终编写释放内存的调试代码，并在发布时禁用它。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2013-08-07T13:38:51.197

> 我只看到一个实际的缺点，那就是这些良性泄漏会在内存泄漏检测工具中显示为误报。

如果我理解正确，您不会显式释放内存（可以释放内存，因为您仍然有一个指针）并依赖操作系统在进程终止期间释放它。虽然这对于简单的程序来说似乎没问题，但考虑一下您的代码被移动到库中并成为某个 24/7 运行的常驻守护进程的一部分的情况。假设这个守护进程每次需要使用您的代码做一些有用的事情时都会产生一个线程，并说它每小时产生数千个线程。在这种情况下，您将得到*真正的*内存泄漏。

不幸的是，这种情况在现实生活中并非不可能，一致的内存管理技术可能会让您的生活更轻松。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2017-08-05T10:53:21.483

是的，内存泄漏可能是两害相权取其轻。虽然正确性很重要，但在执行完全内存释放时，系统的性能或稳定性可能会受到影响，并且释放内存和销毁对象所花费的风险和时间可能不如仅仅退出进程。

一般来说，留下内存通常是不可接受的。很难理解您的代码将在其中运行的所有范围，在某些情况下，它可能导致泄漏成为灾难性的。

> 如果您分配一些内存并使用它直到应用程序中的最后一行代码（例如，全局对象的析构函数）怎么办？

在这种情况下，您的代码可能会被移植到更大的项目中。这可能意味着您的对象的生命周期太长（它持续整个程序，而不仅仅是需要它的实例），或者如果全局被创建和销毁，它会泄漏。

> 当您的应用程序终止时，是否可以信任操作系统为您释放内存？

当一个短暂的程序创建大型`C++`集合（例如`std::map`）时，每个对象至少有 2 个分配。遍历此集合以销毁对象需要 CPU 的实时时间，并且让对象泄漏并由操作系统整理，具有性能优势。计数器，是否有一些资源没有被操作系统整理（例如共享内存），并且不破坏代码中的所有对象会带来一些风险，即某些人持有这些未释放的资源。

> 如果第三方库将这种情况强加给您怎么办？

`close`首先，我会为释放资源的函数提出一个错误。关于它是否可以接受的问题是基于库提供的优势（成本、性能、可靠性）是否比使用其他库或自己编写更好。

一般来说，除非可以重新初始化库，否则我可能不会担心。

## 报告泄漏内存的可接受时间。

1.  关闭期间的服务。这里需要在时间性能和正确性之间进行权衡。
2.  无法摧毁的破碎物体。我已经能够检测到失败的对象（例如，由于捕获了异常），当我尝试销毁对象时，结果是挂起（保持锁定）。
3.  内存检查器误报。

## 关闭期间的服务

如果操作系统即将关闭，所有资源都会被清理。不执行正常进程关闭的优点是用户在关闭时可以获得更快的性能。

## 破碎的物体

在我的过去，我们发现了一个对象（并为该团队提出了一个缺陷），如果它们在某些点崩溃，它们就会损坏，该对象中的所有后续功能都会导致挂起。

虽然忽略内存泄漏是不好的做法，但关闭我们的进程、泄漏对象及其内存比导致挂起更有效率。

## 泄漏检查器误报

一些泄漏检查器通过检测对象来工作，其行为方式与全局对象相同。他们有时会错过另一个全局对象有一个有效的析构函数，在他们完成后调用它会释放内存。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2008-11-07T19:29:46.617

我完全同意 JohnMcG 的观点，并且只想补充一点，我自己在及时发现真正的、潜在的严重内存泄漏方面遇到了问题，只是因为已经接受了良性的内存泄漏。当这些随着时间的推移变得如此之多时，在良性疾病的洪流中发现严重的疾病变得越来越困难。

所以至少为了你的程序员同行（也为了你自己的未来），请尝试尽快淘汰他们。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2008-11-07T23:54:36.753

看起来您对“内存泄漏”的定义是“我自己不清理的内存”。所有现代操作系统都会在程序退出时释放它。但是，由于这是一个 C++ 问题，您可以简单地将有问题的内存包装在适当的内存中，`std::auto_ptr`当它超出范围时将调用 delete。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2008-11-12T15:48:24.143

这实际上取决于创建内存泄漏的对象的使用情况。如果您在使用该对象的应用程序的生命周期中多次创建该对象，那么使用这种方式是不好的。因为会有太多的内存泄漏。另一方面，如果我们有一个对象实例而不消耗内存并且仅少量泄漏，那么这不是问题。

当应用程序运行时泄漏增加时，内存泄漏是一个问题。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2008-11-19T12:22:53.363

当应用程序关闭时，可以说最好不要释放内存。

理论上，操作系统应该释放应用程序使用的资源，但总有一些资源是这个规则的例外。所以要小心。

退出应用程序的好处：

1.  操作系统会释放一个块而不是许多小块。这意味着关机要快得多。特别是在 Windows 上，它的内存管理速度很慢。

刚退出的坏处实际上有两点：

1.  很容易忘记释放操作系统不跟踪的资源，或者操作系统可能会在释放时稍等片刻。一个例子是 TCP 套接字。
2.  内存跟踪软件会将退出时未释放的*所有内容*报告为泄漏。

因此，您可能希望有两种关闭模式，一种对最终用户来说快速而肮脏，另一种对开发人员来说缓慢而彻底。只要确保测试两者:)

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2010-05-01T19:28:35.177

我在高中上过一门 C 课，老师说当你 malloc 时一定要释放。

但是当我参加另一门课程大学时，教授说不为只运行一秒钟的小程序免费是可以的。所以我想它不会伤害你的程序，但释放强大、健康的代码是一种很好的做法。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2018-05-24T01:35:56.857

这里有一些很好的答案。为了向这个问题添加另一个观点，我将解决**内存泄漏**不仅可以接受而且**是可取**的情况：在 Windows 驱动程序环境中，开发人员提供了一组由操作系统在需要时运行的回调。其中一个回调是“关闭”回调，它在系统关闭/重新启动之前运行。与标准情况不同，不仅不需要释放内存（系统将立即关闭），甚至不鼓励 - 尽可能快地关闭并防止内存管理的开销。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-11-16T07:08:03.063

只要您的内存利用率不随时间增加，这取决于。如果您在服务器软件中进行大量复杂的同步，例如启动阻塞系统调用的后台线程，那么完全关闭可能太复杂而无法证明是合理的。在这种情况下，替代方案可能是：

1.  您的库在进程退出之前不会清理其内存。
2.  您编写了额外的 500 行代码，并向您的类添加了另一个互斥锁和条件变量，以便它可以从您的测试中干净地关闭 - 但此代码从未在生产中使用，服务器只会因崩溃而终止。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2009-01-07T06:58:21.220

仅在一种情况下：由于不可恢复的错误，程序将自行射击。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2009-01-07T07:21:23.107

最佳实践是始终释放您分配的内容，尤其是在编写旨在在系统的整个正常运行时间内运行的内容时，即使在退出之前进行清理时也是如此。

这是一个非常简单的规则.. 以没有泄漏为目的的编程使得新的泄漏很容易被发现。你会卖给别人一辆你知道它每次熄火都会在地上溅出汽油的汽车吗？:)

清理函数中的一些 if () free() 调用很便宜，为什么不使用它们呢？

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2009-02-27T05:43:47.660

如果您一直使用它直到`main()`.

事实上，在进程关闭时释放对象绝对是您可以做的*最糟糕*的事情......操作系统必须在*您创建的每个页面*中重新分页。关闭文件句柄，数据库连接，当然，但释放内存只是愚蠢的。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2009-02-27T06:00:24.140

如果您的代码有任何内存泄漏，甚至是已知的“可接受的”泄漏，那么您将有一段恼人的时间使用任何内存泄漏工具来查找您的“真实”泄漏。就像留下“可接受的”编译器警告会使查找新的“真实”警告变得更加困难。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2009-03-23T01:48:21.923

不，它们不好，但是我已经实现了一些分配器、内存转储器和泄漏检测器，并且发现作为一种实用的事情，允许将这样的分配标记为**“就泄漏报告令人担忧”** ...

这有助于使泄漏报告更有用......并且不会被“程序退出未释放的静态范围内的动态分配”所挤满

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2009-08-14T00:43:30.890

可能会令人毛骨悚然：如果您的应用程序在 UNIX 上运行并且可能变成僵尸怎么办？在这种情况下，内存不会被操作系统回收。所以我说你真的应该在程序退出之前取消分配内存。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2009-11-01T11:53:53.343

在程序的最后一行省略释放内存是完全可以接受的，因为释放它不会对任何事情产生影响，因为程序不再需要内存。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2010-03-07T19:13:34.670

我相信如果您有一个程序可以运行几秒钟然后退出并且仅供个人使用，那是可以的。程序结束后，任何内存泄漏都会被清除。

当您有一个运行时间很长的程序并且用户依赖它时，问题就来了。此外，让程序中存在内存泄漏也是一种不好的编码习惯，尤其是在工作中，如果有一天它们可能将该代码变成其他东西。

总而言之，消除内存泄漏更好。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2010-06-29T20:05:43.970

前段时间我会说是的，在你的程序中允许一些内存泄漏有时是可以接受的（它仍处于快速原型设计中），但现在已经取得了 5 或 6 倍的经验，即使跟踪最小的泄漏也会显示一些非常严重的问题功能错误。当数据实体的生命周期不为人所知时，程序中就会发生泄漏，这表明缺乏分析。所以总而言之，了解程序中发生了什么总是一个好主意。

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2010-07-27T12:07:51.563

考虑一下应用程序后来被另一个应用程序使用的情况，有可能在单独的窗口中打开其中的几个或一个接一个地做某事。如果它不是运行一个进程，而是作为一个库运行，那么调用程序会泄漏内存，因为你认为你冷跳过了内存清理。

使用某种自动为您执行此操作的智能指针（例如来自 Boost 库的 scoped_ptr）

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2011-01-26T15:05:23.697

规则很简单：如果你用完一些内存就清理它。有时即使我们稍后需要一些实例，但我们注意到我们大量使用内存，因此它会由于交换到磁盘而影响性能，我们可以将数据存储到磁盘中的文件并在重新加载它们之后，有时这种技术会优化你的程序.

# sharepoint - 在 SharePoint 表上创建视图是否不好？

> ID：273211
> 
> 赞同：3
> 
> 时间：2008-11-07T19:02:40.993
> 
> 标签：sharepoint

我只使用 sharepoint 三个月，但从一开始我就被告知 SharePoint 内容数据库不受限制，因为 MS 可以随时更改架构。推荐的路线是使用对象模型，在大多数情况下，我有点理解这一点。

现在我需要加入一些列表，以呈现按某些特定字段分组的内容。而不是遍历每个列表，我更愿意将我们自己的位于同一数据库服务器上的数据库链接到 WSS 内容数据库，并在表上创建一个视图。这个视图应该在我们的数据库中，以便我们不会更改 WSS 内容数据库上的任何内容。

我是否正在走向永恒的诅咒？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T19:08:09.143

是的，你是。Microsoft*非常*清楚，对 SharePoint 表的任何修改都会使您无法支持。

[不建议直接修改 SharePoint 数据库或其数据，因为它会使环境处于不受支持的状态。](http://msdn.microsoft.com/en-us/library/bb861829.aspx)

现在，在您自己的数据库上创建一个查询 SharePoint 数据库的链接是不可靠的。就个人而言，我会做以下两件事之一：

*   如果这是一个关键任务应用程序，请通过 MSFT 支持运行它。
*   如果还有其他问题，只需确保您的视图在查询期间没有锁定数据库。

更好的策略可能是迭代列表并将其同步到您自己的表中，这样您就可以进行任何类型的数据挖掘 - 如果您不介意同步例程所需的延迟时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T03:39:44.197

SharePoint 在很大程度上依赖于底层数据库的全部“所有权”。从 SharePoint 数据库读取的另一个进程之类的小事情可能会以意想不到的方式减慢 SharePoint 的操作。

由于 SharePoint 通常不会以“实时”方式更新，因此创建一个查询共享点列表并将数据添加到您自己的应用程序中的表的过程应该足够了。

将爬网安排在活动较少的时段内，这样的解决方案不会对 SharePoint 造成意外减速的风险。

[在SPQuery](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spquery.aspx)上开始搜索查询 SharePoint 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T02:04:07.513

查看 SLAM，SharePoint 列表关联管理器。它使您可以轻松地将 SharePoint 数据推送到 SQL，包括复杂的连接（一对一、一对多、多对多）。它使数据保持实时同步。

[http://slam.codeplex.com](http://slam.codeplex.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T23:03:36.047

好吧，如果您需要执行的连接非常简单，那么在 SharePoint Designer 中定义[链接数据源可能对您有用](http://office.microsoft.com/en-us/sharepointdesigner/HA101154041033.aspx)

# java - Hibernate3、PostgreSQL 8.3 和 Java 5 的“没有合适的驱动程序”问题

> ID：273217
> 
> 赞同：1
> 
> 时间：2008-11-07T19:04:09.773
> 
> 标签：java, hibernate, postgresql

有谁知道这里发生了什么：

我在 Mac OS X 上针对 PostgreSQL 8.3（通过 fink 安装）数据库运行 hibernate 3.2.6。当我使用 Java 6 和 JDBC 4 驱动程序（postgresql-8.3-603.jdbc4）时，设置工作正常。但是，我需要这些东西才能使用 Java 5 和（因此）JDBC 3（postgresql-8.3-603.jdbc3）。当我更改类路径中的 jar 并切换到 Java 5（我在 eclipse 中执行此操作）时，出现以下错误：

```
Exception in thread "main" org.hibernate.exception.JDBCConnectionException: Cannot open connection
    at org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:74)
<Rows clipped for readability>
Caused by: java.sql.SQLException: No suitable driver
    at java.sql.DriverManager.getConnection(DriverManager.java:545)
    at java.sql.DriverManager.getConnection(DriverManager.java:140)
    at org.hibernate.connection.DriverManagerConnectionProvider.getConnection(DriverManagerConnectionProvider.java:110)
    at org.hibernate.jdbc.ConnectionManager.openConnection(ConnectionManager.java:423) 
```

这里有什么问题？我看不到。这是我的休眠配置：

```
<hibernate-configuration>

    <session-factory>
        <property name="connection.url">jdbc:postgresql:test</property>
        <property name="connection.username">postgres</property>
        <property name="connection.password">p</property>
        <property name="connection.pool_size">1</property>
        <property name="dialect">org.hibernate.dialect.PostgreSQLDialect</property>
        <property name="current_session_context_class">thread</property>
        <property name="show_sql">true</property>
        <mapping resource="com/mydomain/MyClass.hbm.xml"/>
    </session-factory>
</hibernate-configuration> 
```

**编辑：**连接 URL 的更长、更常用的形式：*jdbc:postgresql://localhost/test*具有完全相同的行为。

驱动程序 jar 肯定在类路径中，我也没有设法使用这个直接 JDBC 测试代码得到任何错误：

```
public static void main(String[] args) throws Exception {
  Class.forName("org.postgresql.Driver");  
  Connection con=DriverManager.getConnection("jdbc:postgresql://localhost/test","postgres", "p");
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T21:04:14.977

我没有看到您在 Hibernate 配置中指定驱动程序类。尝试添加以下内容：

```
<hibernate-configuration>
    <session-factory>
        .
        .
        <property name="connection.driver_class">org.postgresql.Driver</property>
        .
    </session-factory>
</hibernate-configuration> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T19:45:03.733

您是否注意到连接 url 不完整

```
<property name="connection.url">jdbc:postgresql:test</property> 
```

与

```
<property name="connection.url">jdbc:postgresql://localhost/test</property> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T20:19:47.327

您说“使用 Java 5 和（因此）JDBC 3 (postgresql-8.3-603.jdbc3)”。也许这是一个错误的假设。

[下载页面](http://jdbc.postgresql.org/download.html)让我感到困惑。这似乎意味着对于 Java 1.5，您需要 JDBC3，但这并不是 100% 清楚的。我不确定为什么 JDBC4 驱动程序不能与 Java 1.5 一起使用（我们在 Java 1.5 中使用 DB2 JDBC4 驱动程序）。

您是否尝试过使用 Java 1.5 的 JDBC4 驱动程序？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-27T02:09:47.433

JDBC4 的新特性之一是通过服务提供者机制自动加载。通过在 jar 文件中包含 META-INF/services/java.sql.Driver 文件，不再需要执行 Class.forName("")。这仅适用于 1.6 JVM。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-15T10:11:27.987

我使用servlet遇到了同样的问题“找不到合适的驱动程序”，注册驱动程序的解决方案是：

```
Class driverClass = Class.forName("org.postgresql.Driver");
DriverManager.registerDriver((Driver) driverClass.newInstance()); 
```

在这里找到解决方案：

[http://www.java2s.com/Tutorial/Java/0340__Database/DriverManagergetDriversenumeratealltheloadedJDBCdrivers.htm](http://www.java2s.com/Tutorial/Java/0340__Database/DriverManagergetDriversenumeratealltheloadedJDBCdrivers.htm)

[http://codingexplorer.wordpress.com/2009/09/06/%E2%80%9Cno-suitable-driver%E2%80%9D-for-postgresql/](http://codingexplorer.wordpress.com/2009/09/06/%E2%80%9Cno-suitable-driver%E2%80%9D-for-postgresql/)

# data-structures - 什么是 RDF 三元组？

> ID：273218
> 
> 赞同：68
> 
> 时间：2008-11-07T19:04:13.580
> 
> 标签：data-structures, rdf, xml-namespaces, n-triples

通俗地说，什么是 RDF 三元组？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-07-13T22:29:55.137

我认为这个问题需要分成两部分——什么是三元组，是什么让“RDF 三元组”如此特别？

首先，正如这里的大多数其他评论者已经指出的那样，三元组是“主语/谓语/宾语”形式的语句 - 即将一个对象（主语）链接到另一个对象（对象）或文字的语句，通过谓词。我们都熟悉三元组：三元组是二元关系的最小不可约表示。简而言之：电子表格是三元组的集合，例如，如果电子表格中的一列具有标题“Paul”，一行具有标题“has Sister”，并且单元格中的值为“Lisa”。这里有一个三元组：Paul（主语）有 Sister（谓语）Lisa（字面/宾语）。

RDF 三元组的特别之处在于，三元组的每个部分都有一个与之关联的 URI，因此日常声明“Mike Smith 知道 John Doe”在 RDF 中可能表示为：

```
uri://people#MikeSmith12 http://xmlns.com/foaf/0.1/knows uri://people#JohnDoe45 
```

与电子表格的类比是，通过为 URI 的每个部分提供一个唯一地址，您可以为电子表格中的单元格提供其整个地址空间......所以原则上您可以粘贴每个单元格（如果以 RDF 三元组表示）将电子表格放入不同服务器上的不同文档中，并通过单个查询重新构建电子表格。

编辑： 官方文档的[这一部分](https://www.w3.org/TR/2014/NOTE-rdf11-primer-20140624/#section-triple)解决了原始问题。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-11-07T19:13:11.800

RDF 三元组是将一个对象与另一个对象关联起来的语句。例如：

```
"gcc" "Compiles" "c" .
"gcc" "compiles" "Java" . 
"gcc" "compiles" "fortran" .
"gcc" "has a website at" <http://gcc.gnu.org/> .
"gcc" "has a mailing list at" <mailto:gcc-help@gcc.gnu.org> .
"c" "is a" "programming language" .
"c" "is documented in" <http://www.amazon.com/Programming-Language-Prentice-Hall-Software/dp/0131103628/ref=pd_bbs_sr_1?ie=UTF8&s=books&qid=1226085111&sr=8-1> . 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-07T19:08:09.423

> RDF 文件应该向下解析为三元组列表。
> 
> 三元组由主语、谓语和宾语组成。但这些实际上是什么意思？
> 
> 主题就是主题。它标识了三元组正在描述的对象。
> 
> 谓词定义了我们要为其赋值的对象中的数据片段。
> 
> 对象是实际值。

来自：[http ://www.robertprice.co.uk/robblog/archive/2004/10/What_Is_An_RDF_Triple_.shtml](http://www.robertprice.co.uk/robblog/archive/2004/10/What_Is_An_RDF_Triple_.shtml)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-07T20:44:44.687

关于 Adam N 的回答。我相信 OP[曾问过关于社交网络数据的先前问题](https://stackoverflow.com/questions/272911/what-is-the-best-way-to-organize-user-generated-content-in-a-social-network#273053)，所以虽然答案很好，但我将就“原始原始”问题进行澄清。（因为我觉得有责任）。

```
    约翰 | 是朋友| 詹姆士
    詹姆斯 | 是朋友| 吉尔
    吉尔 | 喜欢 | 单板滑雪
    单板滑雪 | 是一个| 运动

```

使用这样的三元组，您可以拥有一个非常灵活的数据结构。

看看[朋友的朋友（FOAF）](http://www.foaf-project.org/)也许是一个更好的例子。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-06-17T18:57:36.273

RDF 是一种语言，即用于编码和解码信息（某些上下文中的数据）的符号、句法和语义系统。

在 RDF 中，一个观察单元（数据）由一个句子表示，该句子由三个部分组成：主语、谓语、宾语。基本上，这是自然语言语音的基本结构。

用于表示参与由 RDF 表示的实体关系的实体（事物）的符号是 IRI（包括 HTTP URI）。RDF 句子的每个主语和谓语（以及可选的宾语）组件都由 IRI 表示。

句法（语法）是抽象的（意味着它可以用各种符号表示），以主语、谓语和宾语排列顺序的形式出现。

语义（最常被忽略的部分）与 RDF 语句中的主语、谓语和宾语角色的含义有关。

当您使用 HTTP URI 来表示 RDF 语句主题、谓词和（可选）对象时，您最终会得到构成 Web 的结构化数据（实体关系类型的集合）——就像您今天在万维网上一样。

当 RDF 语句中的谓词（特别是）语义是机器和人类都可以理解的时，您将拥有一个实体关系类型的网络，它提供强大的信息编码，这是知识（推理和推理）的基础。

以下是简单 RDF 语句的示例：

```
{
    <#this>             a  schema:WebPage                          .
    <#this>  schema:about  dbpedia:Resource_Description_Framework  .
    <#this>  skos:related  <https://stackoverflow.com/questions/30742747/convert-a-statement-with-adjective-in-rdf-triple/30836089#30836089>   . 
} 
```

我使用大括号将示例括起来，以便这篇文章变成一个基于 RDF 的实时链接数据演示，由相关 HTTP URI 和`#`基于片段标识符（索引）提供。

本文中嵌入的 RDF 语句的结果，由 nanotation 提供（在任何接受文本的地方嵌入 RDF 语句）：

1.  [基本实体描述页面](http://linkeddata.uriburner.com/about/html/https://stackoverflow.com/questions/273218/whats-an-rdf-triple/30900130)——每个语句都由一个超链接标识，该超链接解析为它的描述（主语、谓语、宾语部分）
2.  [Deeper Faceted Browsing Page](http://linkeddata.uriburner.com/c/9DA56OB6) -- 通过构成数据网络或链接数据网络的超链接跟随您的鼻子进行更深入的探索和发现的替代视图。
3.  [嵌入语句的描述](http://linkeddata.uriburner.com/c/9BI56JYX)——关于特定的 RDF 语句。

这是从这篇文章中嵌入的三元组生成的可视化（使用我们的[结构化数据嗅探器浏览器扩展](http://osds.openlinksw.com)，使用 RDF-Turtle 表示法： [![在此处输入图像描述](https://i.stack.imgur.com/FWNjv.png)](https://i.stack.imgur.com/FWNjv.png)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-03T09:45:42.050

请注意，它可能会变得更复杂一些。RDF 三元组也可以被认为是主题或对象，所以你可以有类似的东西： Bart -> said -> (三元组 -> 可以是 -> 对象)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-03-06T02:37:46.050

我将不得不部分同意 A Pa，即使他被否决了。

背景：我是一名语言学家，拥有该学科的博士学位，我从事计算语言学方面的工作。

“......一个由三部分组成的句子：主语，谓语，宾语。基本上，这是自然语言语音的基本结构”（A Pa 引用 Kingsley Uyi Idehen 的回答）的说法是完全错误的。不仅 Kingsley 这么说，我还从许多 RDF 三元组的拥护者那里听到过。

错误的原因有很多，例如：谓词（在英语中，可以说，在许多其他自然语言中）由动词（或类似动词的事物）+宾语（可能还有其他补语）组成。英语的句法结构绝对不是Subj-Pred-Obj。

此外，并非所有英语中的自然语言句子都有宾语。特别是不及物动词，根据定义不带宾语。天气动词（除其他外）甚至不带“真实”主语（“下雨”的“它”没有参考）。另一方面，像“give”这样的双及物动词同时接受直接宾语和间接宾语。然后有像“put”这样的动词除了直接宾语之外还带有方位词，或者“tell”带有宾语和从句。更不用说附加词了，比如时间状语和方式状语。

是的，当然您可以将嵌入的子句表示为嵌入的三元组（在某种程度上，您可以将任何语句表示为三元组，我希望您已经明确表示，您不能），但我认为您不能在 RDF 中做（至少我从未见过它做过，而且似乎需要四倍）是同时拥有一个对象和一个嵌入的子句。同样，直接和间接宾语或附属语。

因此，无论 RDF 三元组的动机是什么，我希望倡导者不要再假装存在语言动机，或者三元组在任何方面都类似于自然语言语法。因为他们没有。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-07T19:12:47.510

自从我使用 RDF 以来已经有一段时间了，但它就在这里：D

三元组是主语、谓语和宾语。

主题是唯一标识某物的 URI。例如，您的 openid 唯一标识您。

客体定义了主体和客体的关系。

谓词是主语的一些属性。例如一个名字。

鉴于此，三元组形成一个图 S->P。给定更多的三元组，图形会增长。例如，您可以将同一个人标识为一组三元组的主语，然后您可以通过该唯一主语连接所有谓词。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-07T19:33:34.053

RDF Triple 是一个实际的表达式，它定义了一种表示对象之间关系的方式。三元组包含三个部分：主语、谓语和宾语（通常以相同的顺序编写）。谓词涉及主语和宾语。

主语----谓语--->宾语

更多有用的信息可以在以下位置找到：

[http://www.w3.org/TR/rdf-concepts/](http://www.w3.org/TR/rdf-concepts/)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-08-31T06:52:36.027

可以将三元组视为一种陈述关于资源的单一“事实”的句子。首先要了解 RDF Triple，您应该知道 RDF 中的每一件事都是根据 URI`http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#dfn-URI-reference`或空白节点定义的`http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#dfn-blank-node`。

RDF 三元组由三个部分组成：- 1) 主语 2) 谓词 3) 宾语 例如：- Pranay hasCar Ferrari 这里主语是 Pranay，hasCar 是谓词，而 Ferrari 是宾语。这都是用 RDF-URI 定义的。欲了解更多信息，您可以访问：- [http://www.w3.org/TR/owl-ref/](http://www.w3.org/TR/owl-ref/)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-10-18T20:22:22.797

一个**简单的答案**可以是 RDF 三元组是**使用 RDF 数据模型**的一些知识的**表示**。该模型基于以主**-谓-宾**表达式的形式对资源（特别是 Web 资源 URI）**进行陈述的想法。**RDF 也是**Web 上数据交换**的标准模型。即使底层模式不同，RDF 也具有**促进数据合并的特性，并且它特别****支持模式**随时间的演变，而无需更改所有数据使用者。我推荐这篇文章来了解如何：[https ://www.w3.org/DesignIssues/RDF-XML.html](https://www.w3.org/DesignIssues/RDF-XML.html)

 ******* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-11-29T01:24:20.957

作为一名开发人员，我已经挣扎了一段时间，直到我终于理解了 RDF 及其相关内容，主要是因为我一直通过代码而不是通过数据来看待这个世界。

鉴于这是发布在 StackOverflow 上的，这里是 Java 类比，它最终让我点击：RDF 三元组是数据，就像类的方法/参数是编码一样。

所以：

*   带有包名的类是 Subject
*   这个类的一个方法是 Predicate
*   方法上的参数是对象，它们本身由类表示
*   上下文是导入语句，以避免编写类的完整规范名称

这个类比有点不成立的唯一一点是谓词也有命名空间，而方法没有。但是，当使用 Predicate 时，作为 Subject 和 Object 的类实例之间创建的整体关系反映了调用方法来做某事的想法。

基本上，RDF 之于数据就像 OO 之于编码。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-03-02T09:33:36.957

**三重举例说明**

有一张将用户和问题联系起来的表格。

```
表直流：创建者
-------------------------
| 问题 | 用户 |
-------------------------
| 45 | 485527 |
| 44 | 485527 |
| 40 | 485528 |

```

这在概念上可以用三个[RDF 三元组](https://www.w3.org/TR/rdf-concepts/#section-Concepts)来表达，例如...

```
<question:45> <dc:creator> <user:485527>
<question:44> <dc:creator> <user:485527>
<question:40> <dc:creator> <user:485528> 
```

...以便将每一行转换为`triple`将用户与问题相关联的行。每个三元组的一般形式可以描述为：

`<Subject> <Predicate> <Object>`

RDF 的一个特点是，您可以（或必须）使用[URIs](https://www.rfc-editor.org/rfc/rfc3986) / [IRIs](https://www.rfc-editor.org/rfc/rfc3987)来识别[实体](https://www.w3.org/TR/rdf-schema/#ch_classes)和[关系](https://www.w3.org/TR/rdf-schema/#ch_properties)。[在这里](https://www.w3.org/TR/rdf-concepts/#section-triples)找到更多。这使得每个人都可以[重用已经存在的关系（谓词）并](http://lov.okfn.org/dataset/lov/)[在 www](https://www.w3.org/standards/semanticweb/data)中发布关于任意实体的语句。

将 SO 答案与其创建者相关的示例：

```
<https://stackoverflow.com/a/49066324/1485527>   
<http://purl.org/dc/terms/creator> 
<https://stackoverflow.com/users/1485527> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-07T19:43:32.207

见： [http ://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#dfn-rdf-triple](http://www.w3.org/TR/2004/REC-rdf-concepts-20040210/#dfn-rdf-triple)

一个 RDF 三元组包含三个组件：

*   主题，它是一个 RDF URI 引用或一个空白节点
*   谓词，它是一个 RDF URI 引用
*   对象，它是一个 RDF URI 引用、文字或空白节点

其中文字本质上是带有可选语言标签的字符串，空白节点也是字符串。URI、文字和空白节点必须来自成对不相交的集合。

# c - 帮助使用 LD_PRELOAD

> ID：273220
> 
> 赞同：1
> 
> 时间：2008-11-07T19:04:16.327
> 
> 标签：c, linux

我想用 printf 的修改版本创建一个库，然后调用 LD_PRELOAD 所以当我的程序调用 printf 它使用我的版本。有人可以向我解释如何使用 LD_PRELOAD 以及我的代码或库中是否需要做一些特别的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T19:16:59.310

您只需将环境变量设置`LD_PRELOAD`为替换库的完整路径。由于您在该点之后启动的所有程序都将尝试使用此库，因此您可能需要制作一个包装脚本来设置`LD_PRELOAD`然后调用您要运行的程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-19T09:36:34.927

1.  As far as I know first of all the program cannot have changed evective uid or gid (so called suid or guid programs).
2.  It should be used only for specific purposes such as debugging. As far as I recall you may shadow functions in C (in elf?). However both techniques - `LD_PRELOAD` and shadowing should be deal with extream care. I remember discovering bug in shadowing `g_malloc` in gpgme code (or other related to gpg) as the GLib internals changed.

The simple answer is - don't do it. The more complicated - do it if and only if you have to - and usually you don't (unless you write some sort of debugging software).

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-11-07T19:14:29.940

这似乎是个坏主意。为什么不命名您的`printf`其他版本？

# flash - FLASH 保存帧，到图像（tiff、bmp、jpg、gif、png）

> ID：273221
> 
> 赞同：3
> 
> 时间：2008-11-07T19:04:23.503
> 
> 标签：flash, actionscript-3

标题有点解释自己。我正在用 Flash 制作一些“生成”的艺术品。现在我想保存框架而不做截图等等。也许有一天我想保存一批帧。

那里有可以帮助我的 AS3 类/库吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T19:42:37.747

实际上，使用刚刚发布的 Flash 10，您可以保存到高清！对于这种情况，它非常方便。它非常安全，因为它只允许您在用户单击文件对话框中的“保存”后保存文件，您不能随便写文件。此外，已经编写了一些代码，允许您使用 BitmapData 拍摄快照，并压缩为 PNG 或 JPEG。我推荐 PNG，因为它是无损的，这对于您正在创建的艺术品来说非常有用。

以下是一些相关链接：

*   [创建 JPEG 并将其保存到本地硬盘的示例](http://blog.everythingflex.com/2008/10/01/filereferencesave-in-flash-player-10/)
*   [关于加载和保存文件的视频教程](http://flashenabledblog.com/2008/05/19/tutorial-flash-player-10-beta-filereference/)
*   [另一个例子，这次是文本文件](http://sujitreddyg.wordpress.com/2008/11/04/filereference-in-flash-player-10/)
*   [FileReference.save() 的 API 文档](http://livedocs.adobe.com/flex/gumbo/langref/flash/net/FileReference.html#save())

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T19:08:45.630

要将文件保存到硬盘驱动器还是网站？

如果使用硬盘驱动器，除非您愿意使用 Air，否则您可能会遇到困难。由于 Flash 的安全沙箱，您无法将任意文件写入用户硬盘。

如果您绝对必须使用 Flash 而不是 Air 将其保存到用户的硬盘驱动器，您可能必须将位图数据发送到服务器端 PHP（或类似）脚本，然后该脚本将允许用户下载并保存图像在一个或另一个位置。

# sql - 如何使用 GROUP BY 在 SQL Server 中连接字符串？

> ID：273238
> 
> 赞同：441
> 
> 时间：2008-11-07T19:08:00.703
> 
> 标签：sql, sql-server, string-concatenation, sql-server-group-concat

如何得到：

```
id       Name       Value
1          A          4
1          B          8
2          C          9 
```

到

```
id          Column
1          A:4, B:8
2          C:9 
```

* * *

## 回答 #1

> 赞同：608
> 
> 时间：2008-11-07T19:31:35.617

**不需要 CURSOR、WHILE 循环或用户定义的函数**。

只需要对 FOR XML 和 PATH 进行创意。

[注意：此解决方案仅适用于 SQL 2005 及更高版本。原始问题未指定使用的版本。]

```
CREATE TABLE #YourTable ([ID] INT, [Name] CHAR(1), [Value] INT)

INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'A',4)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'B',8)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (2,'C',9)

SELECT 
  [ID],
  STUFF((
    SELECT ', ' + [Name] + ':' + CAST([Value] AS VARCHAR(MAX)) 
    FROM #YourTable 
    WHERE (ID = Results.ID) 
    FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
  ,1,2,'') AS NameValues
FROM #YourTable Results
GROUP BY ID

DROP TABLE #YourTable 
```

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2017-04-27T17:32:28.513

如果是 SQL Server 2017 或 SQL Server Vnext，SQL Azure 你可以使用`string_agg`如下：

```
select id, string_agg(concat(name, ':', [value]), ', ')
from #YourTable 
group by id 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2011-12-06T17:58:00.483

使用 XML 路径不会像您预期的那样完美连接......它将用“&”替换“&” 并且还会弄乱`<" and ">` ......也许还有其他一些事情，不确定......但你可以试试这个

我遇到了一个解决方法......你需要更换：

```
FOR XML PATH('')
) 
```

和：

```
FOR XML PATH(''),TYPE
).value('(./text())[1]','VARCHAR(MAX)') 
```

...或者`NVARCHAR(MAX)`如果那是你使用的。

为什么地狱没有`SQL`连接聚合函数？这是一个皮塔饼。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2011-10-18T10:48:44.620

当我尝试将 Kevin Fairchild 的建议转换为使用包含空格和已编码的特殊 XML 字符 ( `&`, `<`, ) 的字符串时遇到了几个问题。`>`

我的代码的最终版本（不回答原始问题但可能对某人有用）如下所示：

```
CREATE TABLE #YourTable ([ID] INT, [Name] VARCHAR(MAX), [Value] INT)

INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'Oranges & Lemons',4)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'1 < 2',8)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (2,'C',9)

SELECT  [ID],
  STUFF((
    SELECT ', ' + CAST([Name] AS VARCHAR(MAX))
    FROM #YourTable WHERE (ID = Results.ID) 
    FOR XML PATH(''),TYPE 
     /* Use .value to uncomment XML entities e.g. &gt; &lt; etc*/
    ).value('.','VARCHAR(MAX)') 
  ,1,2,'') as NameValues
FROM    #YourTable Results
GROUP BY ID

DROP TABLE #YourTable 
```

它不是使用空格作为分隔符并用逗号替换所有空格，它只是在每个值前面加上一个逗号和空格，然后用于`STUFF`删除前两个字符。

XML 编码是通过使用[TYPE](http://msdn.microsoft.com/en-us/library/ms190025.aspx)指令自动处理的。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2010-06-10T10:31:45.463

使用 Sql Server 2005 及更高版本的另一个选项

```
---- test data
declare @t table (OUTPUTID int, SCHME varchar(10), DESCR varchar(10))
insert @t select 1125439       ,'CKT','Approved'
insert @t select 1125439       ,'RENO','Approved'
insert @t select 1134691       ,'CKT','Approved'
insert @t select 1134691       ,'RENO','Approved'
insert @t select 1134691       ,'pn','Approved'

---- actual query
;with cte(outputid,combined,rn)
as
(
  select outputid, SCHME + ' ('+DESCR+')', rn=ROW_NUMBER() over (PARTITION by outputid order by schme, descr)
  from @t
)
,cte2(outputid,finalstatus,rn)
as
(
select OUTPUTID, convert(varchar(max),combined), 1 from cte where rn=1
union all
select cte2.outputid, convert(varchar(max),cte2.finalstatus+', '+cte.combined), cte2.rn+1
from cte2
inner join cte on cte.OUTPUTID = cte2.outputid and cte.rn=cte2.rn+1
)
select outputid, MAX(finalstatus) from cte2 group by outputid 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-03-19T03:40:12.453

[从http://groupconcat.codeplex.com](http://groupconcat.codeplex.com)安装 SQLCLR 聚合

然后你可以编写这样的代码来得到你要求的结果：

```
CREATE TABLE foo
(
 id INT,
 name CHAR(1),
 Value CHAR(1)
);

INSERT  INTO dbo.foo
    (id, name, Value)
VALUES  (1, 'A', '4'),
        (1, 'B', '8'),
        (2, 'C', '9');

SELECT  id,
    dbo.GROUP_CONCAT(name + ':' + Value) AS [Column]
FROM    dbo.foo
GROUP BY id; 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2017-02-10T21:03:57.740

八年后... Microsoft SQL Server vNext 数据库引擎终于增强了 Transact-SQL 以直接支持分组字符串连接。社区技术预览版 1.0 添加了 STRING_AGG 函数，CTP 1.1 为 STRING_AGG 函数添加了 WITHIN GROUP 子句。

参考：[https ://msdn.microsoft.com/en-us/library/mt775028.aspx](https://msdn.microsoft.com/en-us/library/mt775028.aspx)

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-11-20T04:11:23.167

SQL Server 2005 及更高版本允许您创建自己的[自定义聚合函数](http://msdn.microsoft.com/en-us/library/ms182741.aspx)，包括连接等功能 - 请参阅链接文章底部的示例。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2013-02-01T12:33:50.903

# 一个例子是

在 Oracle 中，您可以使用 LISTAGG 聚合函数。

**原始记录**

```
name   type
------------
name1  type1
name2  type2
name2  type3 
```

**Sql**

```
SELECT name, LISTAGG(type, '; ') WITHIN GROUP(ORDER BY name)
FROM table
GROUP BY name 
```

**导致**

```
name   type
------------
name1  type1
name2  type2; type3 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-05-09T16:12:18.847

这只是对 Kevin Fairchild 帖子的补充（顺便说一句非常聪明）。我会添加它作为评论，但我还没有足够的积分:)

我将这个想法用于我正在处理的视图，但是我正在连接的项目包含空格。所以我稍微修改了代码，不使用空格作为分隔符。

再次感谢凯文的酷解决方法！

```
CREATE TABLE #YourTable ( [ID] INT, [Name] CHAR(1), [Value] INT ) 

INSERT INTO #YourTable ([ID], [Name], [Value]) VALUES (1, 'A', 4) 
INSERT INTO #YourTable ([ID], [Name], [Value]) VALUES (1, 'B', 8) 
INSERT INTO #YourTable ([ID], [Name], [Value]) VALUES (2, 'C', 9) 

SELECT [ID], 
       REPLACE(REPLACE(REPLACE(
                          (SELECT [Name] + ':' + CAST([Value] AS VARCHAR(MAX)) as A 
                           FROM   #YourTable 
                           WHERE  ( ID = Results.ID ) 
                           FOR XML PATH (''))
                        , '</A><A>', ', ')
                ,'<A>','')
        ,'</A>','') AS NameValues 
FROM   #YourTable Results 
GROUP  BY ID 

DROP TABLE #YourTable 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-11-07T19:13:47.010

这种问题在这里经常被问到，解决方案将很大程度上取决于基本要求：

[https://stackoverflow.com/search?q=sql+pivot](https://stackoverflow.com/search?q=sql+pivot)

和

[https://stackoverflow.com/search?q=sql+concatenate](https://stackoverflow.com/search?q=sql+concatenate)

通常，如果没有动态 sql、用户定义的函数或游标，就没有纯 SQL 方法可以做到这一点。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-11-07T19:22:42.077

补充一下凯德所说的，这通常是前端显示的东西，因此应该在那里处理。我知道有时在 SQL 中为文件导出或其他“仅 SQL”解决方案编写 100% 的东西会更容易，但大多数时候这种连接应该在显示层中处理。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-11-07T19:29:26.230

不需要游标... while 循环就足够了。

```
------------------------------
-- Setup
------------------------------

DECLARE @Source TABLE
(
  id int,
  Name varchar(30),
  Value int
)

DECLARE @Target TABLE
(
  id int,
  Result varchar(max) 
)

INSERT INTO @Source(id, Name, Value) SELECT 1, 'A', 4
INSERT INTO @Source(id, Name, Value) SELECT 1, 'B', 8
INSERT INTO @Source(id, Name, Value) SELECT 2, 'C', 9

------------------------------
-- Technique
------------------------------

INSERT INTO @Target (id)
SELECT id
FROM @Source
GROUP BY id

DECLARE @id int, @Result varchar(max)
SET @id = (SELECT MIN(id) FROM @Target)

WHILE @id is not null
BEGIN
  SET @Result = null

  SELECT @Result =
    CASE
      WHEN @Result is null
      THEN ''
      ELSE @Result + ', '
    END + s.Name + ':' + convert(varchar(30),s.Value)
  FROM @Source s
  WHERE id = @id

  UPDATE @Target
  SET Result = @Result
  WHERE id = @id

  SET @id = (SELECT MIN(id) FROM @Target WHERE @id < id)
END

SELECT *
FROM @Target 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-03-30T21:35:42.617

让我们变得非常简单：

```
SELECT stuff(
    (
    select ', ' + x from (SELECT 'xxx' x union select 'yyyy') tb 
    FOR XML PATH('')
    )
, 1, 2, '') 
```

替换这一行：

```
select ', ' + x from (SELECT 'xxx' x union select 'yyyy') tb 
```

与您的查询。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2015-06-23T12:24:10.797

如果 group by 主要包含一项，则可以通过以下方式显着提高性能：

```
SELECT 
  [ID],

CASE WHEN MAX( [Name]) = MIN( [Name]) THEN 
MAX( [Name]) NameValues
ELSE

  STUFF((
    SELECT ', ' + [Name] + ':' + CAST([Value] AS VARCHAR(MAX)) 
    FROM #YourTable 
    WHERE (ID = Results.ID) 
    FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
  ,1,2,'') AS NameValues

END

FROM #YourTable Results
GROUP BY ID 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-03-15T10:29:16.690

没有看到任何交叉应用的答案，也不需要 xml 提取。这是 Kevin Fairchild 所写内容的略有不同的版本。在更复杂的查询中使用它更快更容易：

```
 select T.ID
,MAX(X.cl) NameValues
 from #YourTable T
 CROSS APPLY 
 (select STUFF((
    SELECT ', ' + [Name] + ':' + CAST([Value] AS VARCHAR(MAX))
    FROM #YourTable 
    WHERE (ID = T.ID) 
    FOR XML PATH(''))
  ,1,2,'')  [cl]) X
  GROUP BY T.ID 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2020-11-18T20:52:25.717

使用 Stuff 和 for xml 路径运算符将行连接到字符串：按两列分组 -->

```
CREATE TABLE #YourTable ([ID] INT, [Name] CHAR(1), [Value] INT)

INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'A',4)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'B',8)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (1,'B',5)
INSERT INTO #YourTable ([ID],[Name],[Value]) VALUES (2,'C',9)

-- retrieve each unique id and name columns and concatonate the values into one column
SELECT 
  [ID], 
  STUFF((
    SELECT ', ' + [Name] + ':' + CAST([Value] AS VARCHAR(MAX)) -- CONCATONATES EACH APPLICATION : VALUE SET      
    FROM #YourTable 
    WHERE (ID = Results.ID and Name = results.[name] ) 
    FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
  ,1,2,'') AS NameValues
FROM #YourTable Results
GROUP BY ID

SELECT 
  [ID],[Name] , --these are acting as the group by clause
  STUFF((
    SELECT ', '+  CAST([Value] AS VARCHAR(MAX)) -- CONCATONATES THE VALUES FOR EACH ID NAME COMBINATION 
    FROM #YourTable 
    WHERE (ID = Results.ID and Name = results.[name] ) 
    FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
  ,1,2,'') AS  NameValues
FROM #YourTable Results
GROUP BY ID, name

DROP TABLE #YourTable 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-08-30T11:45:05.787

使用替换函数和 FOR JSON PATH

```
SELECT T3.DEPT, REPLACE(REPLACE(T3.ENAME,'{"ENAME":"',''),'"}','') AS ENAME_LIST
FROM (
 SELECT DEPT, (SELECT ENAME AS [ENAME]
        FROM EMPLOYEE T2
        WHERE T2.DEPT=T1.DEPT
        FOR JSON PATH,WITHOUT_ARRAY_WRAPPER) ENAME
    FROM EMPLOYEE T1
    GROUP BY DEPT) T3 
```

有关示例数据和更多方法，[请单击此处](https://www.devgateways.com/2019/08/concatenate-values-within-each-group-defined-by-sql-server.html)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-01-17T08:20:22.920

如果您启用了 clr，您可以使用来自 GitHub的[Group_Concat库](https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-10-14T04:50:16.280

另一个没有垃圾的例子： ",TYPE).value('(./text())[1]','VARCHAR(MAX)')"

```
WITH t AS (
    SELECT 1 n, 1 g, 1 v
    UNION ALL 
    SELECT 2 n, 1 g, 2 v
    UNION ALL 
    SELECT 3 n, 2 g, 3 v
)
SELECT g
        , STUFF (
                (
                    SELECT ', ' + CAST(v AS VARCHAR(MAX))
                    FROM t sub_t
                    WHERE sub_t.g = main_t.g
                    FOR XML PATH('')
                )
                , 1, 2, ''
        ) cg
FROM t main_t
GROUP BY g 
```

输入输出是

```
*************************   ->  *********************
*   n   *   g   *   v   *       *   g   *   cg      *
*   -   *   -   *   -   *       *   -   *   -       *
*   1   *   1   *   1   *       *   1   *   1, 2    *
*   2   *   1   *   2   *       *   2   *   3       *
*   3   *   2   *   3   *       *********************
************************* 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-03-03T19:30:21.657

我使用了这种可能更容易掌握的方法。获取一个根元素，然后连接以选择具有相同 ID 但不是“官方”名称的任何项目

```
 Declare @IdxList as Table(id int, choices varchar(max),AisName varchar(255))
  Insert into @IdxLIst(id,choices,AisName)
  Select IdxId,''''+Max(Title)+'''',Max(Title) From [dbo].[dta_Alias] 
 where IdxId is not null group by IdxId
  Update @IdxLIst
    set choices=choices +','''+Title+''''
    From @IdxLIst JOIN [dta_Alias] ON id=IdxId And Title <> AisName
    where IdxId is not null
    Select * from @IdxList where choices like '%,%' 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-04-16T17:17:13.210

对于我所有的医疗保健人员：

```
 SELECT
s.NOTE_ID
,STUFF ((
        SELECT
           [note_text] + ' ' 
        FROM
            HNO_NOTE_TEXT s1
        WHERE
            (s1.NOTE_ID = s.NOTE_ID)
        ORDER BY [line] ASC
         FOR XML PATH(''),TYPE).value('(./text())[1]','VARCHAR(MAX)')
         ,
        1,
        2,
        '') AS NOTE_TEXT_CONCATINATED
FROM
    HNO_NOTE_TEXT s
    GROUP BY NOTE_ID 
```

# macos - 有没有类似 Mac OS X 的 Winsplit Revolution 之类的东西？

> ID：273242
> 
> 赞同：18
> 
> 时间：2008-11-07T19:08:28.860
> 
> 标签：macos

有没有类似 Mac OS X 的 Winsplit Revolution 之类的东西？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-11T14:46:42.167

**试试这些**：

*   **[Zoom/2](http://coderage-software.com/zooom/)**（15 美元）自从我安装它以来一直是我的最爱。快速、灵活，并最大限度地减少我需要记住的组合键数量
*   **[Divvy](http://mizage.com/divvy/)**（15 美元）可能很快会取代 Zoom/2。它更接近温斯普利特。您可以在网格上排列窗口、定义自己的网格排列以及定义自己的快捷方式。它还可以最大限度地减少您需要记住的击键组合的数量。奖励：有 Mac 和 Windows 版本，这意味着如果您使用这两个平台，您可以在所有机器上使用相同的窗口管理方法。
*   [Breeze](http://www.autumnapps.com/breeze/)（8 美元）可以轻松实现全屏窗口、左拆分或右拆分。它还允许您保存屏幕状态（通用）和特定应用程序。
*   [Moom](http://manytricks.com/moom/)（5 美元）是较新的条目。它支持键盘快捷键和鼠标快捷键。对于鼠标快捷方式，将光标移动到绿色缩放按钮上会显示不同布局选项的弹出列表：全屏、左/右半部分、上/下半部分或任何角落。
*   [SizeUp](http://irradiatedsoftware.com/sizeup/)（10 美元）模仿了 WinSplit 功能的各个方面，但它依赖于许多需要时间来学习的击键组合。优点是快速移动窗口。缺点是它用掉了很多全局键盘快捷键，而且有很多我都记不住了。
*   [Cinch](http://irradiatedsoftware.com/cinch/)（7 美元）是 SizeUp 制造商的鼠标驱动应用程序。将您的窗口拖动到屏幕边缘的各个热区，窗口将“收紧”到该边缘并调整大小以填满屏幕的一半。类似于 Windows 7 中的内置调整大小功能。
*   [MercuryMover](http://www.heliumfoot.com/mercurymover/)（20 美元）非常强大，并提供细粒度的控制。但是，有很多不同的组合键，总的来说，我发现它不像 WinSplit 那样容易学习或优雅。我几乎立即卸载了它。它给我的印象是强大，但效率低下且笨拙。
*   [另一篇文章中提到的 DIY 方法](http://forums.macrumors.com/showthread.php?t=645660)（免费）是结合一些 applescript 并将它们绑定到 quicksilver 触发器。我没试过这个。但这是一个免费的解决方案。

当我开始使用 Mac 时，我发现弱窗口管理是最难处理的事情之一。

**为什么要超越空间并暴露？**

Winsplit*显着增加*了空间和暴露的功能。直到我真正使用它时，我才理解它的吸引力。在此之前，我认为虚拟桌面（例如空间）就足够了。现在我认为它是必备功能，尤其是在大型显示器和多显示器设置上。

在我运行 3 台显示器的 Windows 机器上，我会按以下顺序排列这些不同应用程序的重要性：

1.  类似 Winsplit 的窗口重新排列
2.  类似空间的虚拟桌面
3.  类暴露应用切换

在我的 MacBook 上，我学会了以另一种方式处理它。

1.  类暴露应用切换
2.  类似 Winsplit 的窗口重新排列
3.  类似空间的虚拟桌面

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-08T22:52:53.853

从 Winsplit 网站上，我或多或少地了解了它的功能；在过去，我实际上曾经将我的窗口管理器 (Waimea) 配置为在 linux 中完全做到这一点。

您可以尝试使用 Quicksilver 来触发一组自定义的 AppleScript；每个 applescript 都会调整当前焦点窗口的大小并将其移动到预定义的位置。

请参阅[此 macosxhints 帖子](http://www.macosxhints.com/article.php?story=20060105082728937)以获取灵感...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-11-04T06:49:38.340

ShiftIt 是一个免费选项。可分配热键以调整屏幕的不同部分（左、右、上、下、左上、右上、左下、右下、全屏和当前大小的中心）

[链接到 GitHub 上的 ShiftIt](https://github.com/fikovnik/ShiftIt)

只需单击屏幕右侧的大下载按钮。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-07-22T06:45:16.703

[Spectacle](http://spectacleapp.com)是一个不错的选择，它免费且开源。并且易于使用键盘快捷键：

Windows 可以移动到屏幕的许多预定义区域：

*   移到左半边⌥⌘←
*   向右移动⌥⌘→
*   移到上半部分⌥⌘↑
*   移到下半部⌥⌘↓
*   移动到左上角⌃⌘←
*   移动到左下角⌃⇧⌘←
*   移动到右上角⌃⌘→
*   移动到右下角——⌃⇧⌘→

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-18T20:41:38.367

StackOverflow 上的另一个问题解决了同样的问题 [https://stackoverflow.com/questions/276760/tiling-window-manager-for-os-x](https://stackoverflow.com/questions/276760/tiling-window-manager-for-os-x)

一个答案提供了一个名为[TwoUP](http://www.irradiatedsoftware.com/twoup/)的应用程序的链接。它是免费的，并且可以在 OSX 上完成工作！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-04T21:12:33.937

感谢东勋的回答，我开发了一个混合解决方案。使用 AppleScript 编辑器，您可以创建脚本来调整当前窗口的大小，如下所示：

```
tell application "System Events"
  set _everyProcess to every process
  repeat with n from 1 to count of _everyProcess
    set _frontMost to frontmost of item n of _everyProcess
    if _frontMost is true then set _frontMostApp to process n
  end repeat

  set _windowOne to window 1 of _frontMostApp
  set position of _windowOne to {5, 0}
  set size of _windowOne to {1150, 735}
end tell 
```

这样的脚本可以在 13" MacBook 上运行。使用保存到 /Users/[YourUserNameHere]/Library/Scripts 的脚本的细微变化，您可以配置 AppleScript 编辑器以在菜单栏中显示自己，它允许您选择要运行的脚本。

使用几个不同的脚本，我只需单击两次即可调整任何窗口的大小和位置。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-06T13:00:26.927

我没有使用过 Winsplit，所以我不知道它的比较，但我开发的一个应用程序 Optimal Layout 提供了非常灵活的窗口平铺，以及从键盘移动和调整大小：

[http://most-advantageous.com/optimal-layout/](http://most-advantageous.com/optimal-layout/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-20T03:48:58.367

看起来 TwoUp 已经死了，但这里有一些其他选项：

*   [Cinch](http://www.irradiatedsoftware.com/cinch/)（7 美元）就像适用于 Mac 的 Aero Snap。
*   [Breeze](http://autumnapps.com/breeze/) ($8) 允许您保存窗口状态并将它们像模板一样恢复到另一个窗口。
*   [Divvy](http://mizage.com/divvy/)（14 美元）在屏幕上显示一个网格，您可以在其中选择框以指示您希望窗口如何填充屏幕。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-27T12:19:03.897

你也应该试试 secondbar。在第二个显示+重新排列选项时为您提供额外的菜单栏。请参阅[此链接](http://mac.softpedia.com/progDownload/SecondBar-Download-63929.html)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-10-21T10:01:06.397

您还可以尝试使用键盘快捷键、屏幕菜单和拖动窗口来调整大小和重新定位的[排列应用程序。](http://www.trifle.pl/Applications/Arrange_page1.html "安排")

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-01-09T02:14:53.860

您甚至可以尝试[SplitScreenapp.com](https://splitscreenapp.com/)。它允许您以多种方式调整 Mac Windows 的大小，包括全拆分、半拆分、拖放等。

* * *

## 回答 #12

> 赞同：-6
> 
> 时间：2008-11-07T19:22:46.740

我对此表示怀疑。在 Spaces 和 Expose 之间，不需要第三方应用程序来帮助管理多个窗口。

# char - 强制 telnet 客户端进入字符模式

> ID：273261
> 
> 赞同：14
> 
> 时间：2008-11-07T19:14:42.793
> 
> 标签：char, default, telnet

我有一个应用程序，我在其中接受来自 telnet 客户端的套接字连接并建立一个简单的键盘驱动字符 GUI。

telnet 客户端，至少在 Linux 上，默认为一次一行的模式，所以我总是必须`^]mode char`手动操作。

浏览相关 RFC 表明，如果我的应用程序只是`IAC DONT LINEMODE (\377\376\042)`在客户端连接后立即发送字符，则应强制客户端进入字符模式。但是，它没有任何区别。

可以完成这项工作的最简单的代码是什么？理想情况下只是一个要发送的字符串。我的应用程序可以吸收客户发回的任何垃圾。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-01T12:28:11.153

有趣的。我有更多的运气发送

```
IAC WILL ECHO IAC WILL SUPPRESS_GO_AHEAD IAC WONT LINEMODE
255  251    1 255  251                 3 255  252       34 
```

IAC WONT LINEMODE 似乎是多余的：没有它，我的 telnet 客户端似乎可以进入正确的状态，但为了完整起见，我将其保留。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-10T21:40:50.377

为了它的价值，我自己解决了。

```
// IAC WONT LINEMODE IAC WILL ECHO

write(s,"\377\375\042\377\373\001",6); 
```

使远程（至少从 Linux 机器上的 Xterm 远程登录）进入正确的状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-05-22T18:15:39.297

凯文的解决方案效果很好：

```
write(s,"\377\375\042\377\373\001",6); 
```

虽然评论略有错误。它应该说“DO LINEMODE”，而不是“WONT LINEMODE”，即：

```
// IAC DO LINEMODE IAC WILL ECHO 
```

（来源：[rfc854](https://www.rfc-editor.org/rfc/rfc854#page-14)）

# ruby - Ruby 中 STDIN 的最佳实践？

> ID：273262
> 
> 赞同：318
> 
> 时间：2008-11-07T19:14:51.623
> 
> 标签：ruby, stdin

我想处理 Ruby 中的命令行输入：

```
> cat input.txt | myprog.rb
> myprog.rb < input.txt
> myprog.rb arg1 arg2 arg3 ... 
```

最好的方法是什么？特别是我想处理空白的标准输入，我希望有一个优雅的解决方案。

```
#!/usr/bin/env ruby

STDIN.read.split("\n").each do |a|
   puts a
end

ARGV.each do |b|
    puts b
end 
```

* * *

## 回答 #1

> 赞同：416
> 
> 时间：2008-11-07T22:29:13.043

以下是我在我的晦涩 Ruby 收藏中发现的一些内容。

因此，在 Ruby 中，Unix 命令的简单无铃声实现`cat`将是：

```
#!/usr/bin/env ruby
puts ARGF.read 
```

[`ARGF`](https://ruby-doc.org/core/ARGF.html)在输入方面是您的朋友；它是一个虚拟文件，从命名文件或从 STDIN 获取所有输入。

```
ARGF.each_with_index do |line, idx|
    print ARGF.filename, ":", idx, ";", line
end

# print all the lines in every file passed via command line that contains login
ARGF.each do |line|
    puts line if line =~ /login/
end 
```

谢天谢地，我们没有在 Ruby 中获得钻石运算符，但我们确实获得`ARGF`了替代品。尽管晦涩难懂，但事实证明它很有用。`-i`考虑这个程序，它在命令行中提到的每个文件中都预先添加了版权标题（感谢另一个 Perlism， ）：

```
#!/usr/bin/env ruby -i

Header = DATA.read

ARGF.each_line do |e|
  puts Header if ARGF.pos - e.length == 0
  puts e
end

__END__
#--
# Copyright (C) 2007 Fancypants, Inc.
#++ 
```

归功于：

*   [https://web.archive.org/web/20080725055721/http://www.oreillynet.com/ruby/blog/2007/04/trivial_scripting_with_ruby.html#comment-565558](https://web.archive.org/web/20080725055721/http://www.oreillynet.com/ruby/blog/2007/04/trivial_scripting_with_ruby.html#comment-565558)
*   [http://blog.nicksieger.com/articles/2007/10/06/obscure-and-ugly-perlisms-in-ruby](http://blog.nicksieger.com/articles/2007/10/06/obscure-and-ugly-perlisms-in-ruby)

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-03-03T03:13:07.673

Ruby 提供了另一种处理 STDIN 的方法：-n 标志。它将您的整个程序视为在 STDIN 上的循环内（包括作为命令行参数传递的文件）。参见例如以下 1 行脚本：

```
#!/usr/bin/env ruby -n

#example.rb

puts "hello: #{$_}" #prepend 'hello:' to each line from STDIN

#these will all work:
# ./example.rb < input.txt
# cat input.txt | ./example.rb
# ./example.rb input.txt 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-11-07T19:51:40.020

我不太确定你需要什么，但我会使用这样的东西：

```
#!/usr/bin/env ruby

until ARGV.empty? do
  puts "From arguments: #{ARGV.shift}"
end

while a = gets
  puts "From stdin: #{a}"
end 
```

请注意，因为 ARGV 数组在 first 之前为空`gets`，Ruby 不会尝试将参数解释为要从中读取的文本文件（从 Perl 继承的行为）。

如果 stdin 为空或没有参数，则不打印任何内容。

几个测试用例：

```
$ cat input.txt | ./myprog.rb
From stdin: line 1
From stdin: line 2

$ ./myprog.rb arg1 arg2 arg3
From arguments: arg1
From arguments: arg2
From arguments: arg3
hi!
From stdin: hi! 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-11-07T20:53:14.127

大概是这样的？

```
#/usr/bin/env ruby

if $stdin.tty?
  ARGV.each do |file|
    puts "do something with this file: #{file}"
  end
else
  $stdin.each_line do |line|
    puts "do something with this line: #{line}"
  end
end 
```

例子：

```
> cat input.txt | ./myprog.rb
do something with this line: this
do something with this line: is
do something with this line: a
do something with this line: test
> ./myprog.rb < input.txt 
do something with this line: this
do something with this line: is
do something with this line: a
do something with this line: test
> ./myprog.rb arg1 arg2 arg3
do something with this file: arg1
do something with this file: arg2
do something with this file: arg3 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-07-09T21:52:58.373

```
while STDIN.gets
  puts $_
end

while ARGF.gets
  puts $_
end 
```

This is inspired by Perl:

```
while(<STDIN>){
  print "$_\n"
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-11-11T12:00:50.837

快速简单：

`STDIN.gets.chomp == 'YES'`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-20T17:15:32.050

我要补充一点，为了`ARGF`与参数一起使用，您需要`ARGV`在调用之前清除`ARGF.each`。这是因为`ARGF`会将其中的任何内容`ARGV`视为文件名并首先从那里读取行。

这是一个示例“三通”实现：

```
File.open(ARGV[0], 'w') do |file|
  ARGV.clear

  ARGF.each do |line|
    puts line
    file.write(line)
  end
end 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-07T21:22:54.840

您也可以使用`STDIN.each_line`, 和`STDIN.each_line.to_a`将其作为数组获取。

例如

```
STDIN.each_line do |line|
  puts line
end 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-31T10:19:40.317

我做这样的事情：

```
all_lines = ""
ARGV.each do |line|
  all_lines << line + "\n"
end
puts all_lines 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-12T13:01:00.520

似乎大多数答案都假设参数是包含要添加到标准输入的内容的文件名。下面的一切都被视为只是参数。如果 STDIN 来自 TTY，则将其忽略。

```
$ cat tstarg.rb

while a=(ARGV.shift or (!STDIN.tty? and STDIN.gets) )
  puts a
end 
```

参数或标准输入可以为空或有数据。

```
$ cat numbers 
1
2
3
4
5
$ ./tstarg.rb a b c < numbers
a
b
c
1
2
3
4
5 
```

# c# - .NET 中的轻量级 HTTP 服务器库

> ID：273273
> 
> 赞同：7
> 
> 时间：2008-11-07T19:16:42.977
> 
> 标签：c#, .net, http

我正在寻找一个在 .NET 中实现 HTTP 服务器的小型快速库

我的一般要求是：

*   支持多个同时连接
*   只需要支持静态内容（无需服务器端处理）
*   仅 HTTP，不需要 HTTPS
*   最好能够从内存中的源中提供页面。我想将它集成到另一个应用程序中，以便能够通过浏览器提供更改数据，但我不想先将其写入磁盘上的文件。例如，只需将 C# 字符串传递给它以用作当前页面内容。
*   最好是开源的，如果需要我可以修改它
*   *绝对*需要免费......这是一个除了我自己的时间之外没有预算的个人项目。我还希望能够发布可以自由使用该库的最终产品（即使这意味着遵守该库的特定 OSS 许可证。

编辑：为了澄清更多，我需要的真的很简单。我需要能够提供基本上 2 个文档，我希望直接从内存中提供这些文档。就是这样。是的，我可以自己写，但我想确保我没有做一些已经可用的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T19:28:32.720

使用[卡西尼](http://www.asp.net/downloads/archived/cassini/)。

免费，开源。

从记忆中服务将需要微不足道的黑客攻击。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T19:31:36.707

那么，您需要多复杂的 HTTP 服务器？.NET 2.0 有[HttpListener 类](http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx)，您可以使用它来[滚动您自己的基本库](http://bartdesmet.net/blogs/bart/archive/2007/02/22/httplistener-for-dummies-a-simple-http-request-reflector.aspx)。由于这是一个个人项目，并且您愿意投入时间，因此您将学习如何与班级合作，这也将带来良好的学习体验。此外，根据 MSDN 文档，它具有异步模式，为每个请求提供自己的线程。

启动并运行该类的基本 HTTP 服务器也不是太困难，您应该只需几百行代码就可以完成它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-10-19T22:10:32.460

看看[皮划艇](https://github.com/kayak/kayak)。

**注意：皮划艇似乎不再被维护 - 尽管它应该如此**

# c# - 以编程方式提取 MS SQL 表列的数据类型以供以后插入

> ID：273275
> 
> 赞同：1
> 
> 时间：2008-11-07T19:16:49.420
> 
> 标签：c#, .net, database

Rails 有一种很棒的方法可以从数据库中查找列名和预期的数据类型，从而减轻了很多编程工作。

我正在尝试在 C#.NET 中构建类似的东西，因为我们有不断变化的大表。我将像这样添加参数：

```
SqlParameter param = new SqlParameter("parametername", *SqlDbType.Int*);
param.Direction = ParameterDirection.Input;
param.Value = 0;
comm.Parameters.Add(param); 
```

注意 SqlDbType。我怎么能得到那个？如果我从 DataSet 中获取 DataColumns，我所能得到的只是 System.string 之类的系统类型。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T19:27:10.790

为什么不让 ADO.NET 自动检测它：

```
SqlParameter param = new SqlParameter("parametername", value); 
```

'当然，你实际上也不需要Direction：

```
comm.Parameters.Add(new SqlParameter("parametername",value)); 
```

我有点喜欢在一条线上做事:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T19:28:45.903

对于我们的项目，我们`INFORMATION_SCHEMA`在构建 SQL 语句之前查询表。如果您将值插入`DATA_TYPE`from中，那应该会给您正确的值。`INFORMATION_SCHEMA.COLUMNS``Enum.Parse`

# wpf - 混合 MFC 和 WPF：模态对话框

> ID：273276
> 
> 赞同：3
> 
> 时间：2008-11-07T19:16:53.133
> 
> 标签：wpf, mfc, c++-cli, modal-dialog

我正在使用 C++/CLI 接口层将 C# WPF 对话框添加到现有的 C++ MFC 应用程序。我有一些工作，除了我的方式有问题。例如：

1.  MFC 应用程序使用 ShowDialog 显示 WPF 对话框。按预期工作。
2.  该 WPF 对话框显示了一个使用 DoModal 的 MFC 对话框。WPF 对话框隐藏在基本 C++ 应用程序后面，除非我手动更改 IsEnabled，否则它不会被禁用。不理想，但它有效。
3.  现在，该 MFC 对话框已关闭。现在由于某种原因，基本 MFC 应用程序已启用，但由于 WPF 对话框尚未关闭，它仍应被禁用。这很糟糕，因为它现在允许用户在 WPF 对话框仍然打开时做一些疯狂的事情。

我有一种感觉，如果我能正确设置父对话框，它会更好。但到目前为止，我还无法将 MFC 对话框的父级设置为 WPF 对话框，反之亦然。而且，我什至不知道这是否能解决问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-16T16:21:56.440

打开 CDialog 时，诀窍是使用 WindowsInteropHelper 获取父 WPF 对话框的 HWND。然后，您可以使用 CWnd::Attach 将该 HWND 包装在 CWnd 类中以传递给 CDialog 的构造函数。

我遇到的问题是我已经构建了 CDialog，但尚未显示。仅当您的目标子窗口已经具有有效句柄时，才能使用各种版本的 SetParent。我必须在我的 CDialog 类中编写一个新函数来设置 m_wndParent，它在最终创建对话框时用作父级。然后一切都很好！

以某种方式从 MFC 对话框创建 WPF 对话框“正常工作”。这是魔法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-08T01:09:43.327

显示 WPF 对话框时，您是否使用[HwndSource 类](http://msdn.microsoft.com/en-gb/library/ms742522.aspx#hosting_a_wpf_page)来包装 WPF 窗口？如果是这样，您可能能够[::SetParent](http://msdn.microsoft.com/en-us/library/ms633541(VS.85).aspx) WPF 窗口以及使用 HwndSource.Handle 属性来设置子子项的父项。

# windows - 窗户温度监视器

> ID：273279
> 
> 赞同：1
> 
> 时间：2008-11-07T19:17:10.450
> 
> 标签：windows, hardware, monitor, temperature

作为客户端应用程序的一部分，我需要有一个报告温度信息（主板、CPU、HDD）的部分。我知道有独立的应用程序，例如 CPUID 的硬件监视器，但同样，这些是独立的，我需要可以与之交互的东西。

有没有这样的应用程序有 API 或开源，所以我可以利用他们的源代码？除了需要在 Windows XP 上运行之外，我还有其他语言首选项。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T19:37:32.560

您可以从 WMI 获得这样的信息。下载[WMICodeCreator](http://www.microsoft.com/downloads/details.aspx?FamilyID=2cc30a64-ea15-4661-8da4-55bbc145c30e&displaylang=en)以查找查询以及您需要编写的代码。请注意，此类硬件查询往往严重依赖硬件或 BIOS 制造商提供的提供商。

# c# - 移动网站设计

> ID：273283
> 
> 赞同：7
> 
> 时间：2008-11-07T19:18:43.100
> 
> 标签：c#, css, mobile

我刚刚使用样式表（即@media print 等）向网站添加了打印功能，并且想知道是否可以使用类似的方法来添加对移动设备的支持。

如果没有，我如何检测移动设备？我的页面是 C# (.aspx)，我想缩小页面以便在移动设备上使用。

对我有什么建议吗？

编辑：我妻子有一台黑莓，所以至少我想启用我们公司的网站。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T19:20:44.607

我不确定 iPhone/iPod Touch 在请求样式表时如何声明自己，但对于大多数人来说，使用

```
<style type="text/css">
    @media handheld
    {
      /* handheld styles */
    }
</style> 
```

应该做的伎俩。它的工作方式与@media print 的工作方式相同（或不这样做）。

有关媒体类型的完整列表，请参见[此处。](http://www.w3.org/TR/CSS2/media.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T19:43:25.297

移动浏览器在支持什么方面是一个真正的大杂烩，它们是否遵循您的样式的“媒体”属性等等。

我想说的目标是[渐进增强](http://www.alistapart.com/articles/progressiveenhancementwithcss)（这是一系列文章之一），并确保如果浏览器只理解纯 HTML，您的内容仍然可以查看并且以正确的顺序 - 例如，您希望您的主要内容出现在之前代码中的侧边栏，因为主要内容更重要。

上面的文章中提到了一个[看起来不错的资源。](http://mobiforge.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T21:58:55.880

如果其他解决方案不起作用，您可能想要使用[WURFL 之类的东西，这是一个相当不错的数据库，它对设备及其用户代理了解很多。](http://wurfl.sourceforge.net/)

请记住减少下载大小:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T19:21:48.757

你会想看看你拥有的用户代理的类型，看看它是否是移动设备。下面的代码就是一个例子：

```
public static bool IsMobile(string userAgent)
{
    userAgent = userAgent.ToLower();

    return userAgent.Contains("iphone") |
         userAgent.Contains("ppc") |
         userAgent.Contains("windows ce") |
         userAgent.Contains("blackberry") |
         userAgent.Contains("opera mini") |
         userAgent.Contains("mobile") |
         userAgent.Contains("palm") |
         userAgent.Contains("portable");
} 
```

这应该在大多数情况下工作！此[链接](http://wurfl.sourceforge.net/)也可以帮助您获得更具体的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-22T21:51:59.590

完成所有这一切的最佳方式是在服务器级别进行。

使用 Web 服务来检查访问者是否是移动设备，并据此提供您的输出。在您的应用程序上使用相同的 URL 并执行相同的业务逻辑 - 只需更改应用程序的视图层。

一个不错的选择是 Wapple Architect (http://wapple.net) - 它允许您在服务器级别使用一些 Web 服务进行这些检查，然后如果它是移动设备，则执行逻辑并添加代码。

绝对值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-03T09:13:38.040

看一下这个！它太酷了！[http://mobstac.com/developer/](http://mobstac.com/developer/)

MobStac API 平台是构建和管理移动网站的最快方式！您可以访问开发人员文档和 API 密钥。

# asp.net - 在没有 DataBind 的情况下向 GridView 添加新行

> ID：273288
> 
> 赞同：5
> 
> 时间：2008-11-07T19:20:38.493
> 
> 标签：asp.net, gridview, data-binding

我有一个 GridView，它允许一直编辑每一列、每一行中的值。用户输入所有更改，单击保存一次，所有更改都已提交。

用户还必须能够单击“新建”按钮，在 GridView 中出现一个新行（是的，它必须显示在实际的 GridView 中），输入他们想要的任何数据，单击“保存”并将所有更改转到数据库.

现在。这是一个让我失望的用户案例：用户到达页面，对几个现有行进行了几处更改，然后需要添加一个新行，在新行中输入数据，单击保存，然后将所有更改转到数据库.

但是，我见过的添加新的空行的唯一方法是重新绑定 GridView，这意味着它们的所有更改都将丢失。这显然不好。

所以，我的问题是：有哪些方法可以在不必重新绑定 GridView 的情况下向 GridView 添加新的、空的、可编辑的行？

我唯一能想到的是，在新按钮的单击事件中，从 GridView 中吸出所有数据（包括用户的潜在编辑），将其保存到 ViewState（或其他），添加新行，重新填充网格。对我来说，这似乎有点 hacky，但它应该允许我在 GridView 上关闭 ViewState。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T19:33:00.387

就在我的脑海里，我能想到两个选择。第一个是缓存您绑定到网格中的原始结果，当您需要添加另一行时，您将数据行添加到您要绑定的数据表，然后将其绑定到网格。如果网格中有更改，则需要更新数据表。完成所有更改并且用户单击保存按钮后，您可以遍历表并使用数据更新数据库。

**它可能看起来像这样**

*页面加载*

*   获取数据库数据并放入表中
*   将表格绑定到网格
*   将表存储在缓存中

*当用户请求新行时*

*   获取缓存的数据对象。
*   更新任何已更改的行
*   添加一个空行绑定到网格

*当用户保存网格时*

*   获取缓存的对象。
*   进行最后一组更新
*   循环遍历行并更新数据库

The other way to do this is by creating the grid dynamically but this will involve far more effort than it's worth given what you have described.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T19:56:13.630

You could dynamically add the new row via javascript, and on the save command look for newly added rows. That is fairly common.

# debugging - 你最喜欢设置断点的虚拟线是什么？

> ID：273297
> 
> 赞同：29
> 
> 时间：2008-11-07T19:24:04.163
> 
> 标签：debugging

我们中很少有人会否认调试器的强大之处，但为了使其更有用，可以使用一些技巧。

例如，在 Python 中，您可以使用***pass***什么都不做，除了留出放置断点的空间并允许您观察 Watch 窗口中的值。

在 C# 中，我曾经使用***GC.Collect()***，但现在我使用***if (false){}***

你最有趣的假人台词是什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-07T19:26:17.873

在 C# 中，您可以使用它：

```
System.Diagnostics.Debugger.Break(); 
```

它将强制一个断点。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2012-11-22T10:54:54.543

在 C# 中，在 Visual Studio 中

```
{} 
```

或者

```
; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-07T19:26:52.303

[调试。断言（真）；](http://msdn.microsoft.com/en-us/library/system.diagnostics.debug.assert.aspx)，它会自动从发布版本中编译出来。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-07T20:05:44.783

```
volatile int e = 9; 
```

易失性意味着编译器不会删除它，因为我没有读取变量。'9' 只是为了使它不为零。零对我的口味来说太常见了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T19:29:48.333

在 gcc/g++ 中：

```
assert("breakpoint"); 
```

因为断言的任何非 0/null 值都被视为真。

甚至

```
__asm__("nop"); 
```

至少我知道会发出一个指令字节以使断点发生。;)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-07T20:37:52.860

我用

```
int x = 0; 
```

当我完成调试时，我总是确保我删除了这一行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-08-13T04:58:36.340

我从来没有写过什么特别要突破的东西，但如果我写了，我会写

```
int moot; 
```

当有一些我不关心但必须提供的必需“输出”参数时，我会使用这个。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-28T04:47:47.413

对于 C/C++ 我使用

```
__asm int 3; 
```

这将在调试器将捕获的代码行处生成断点异常。不过需要注意的是，如果程序没有在调试器中运行，它会因该异常而崩溃。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-07T20:30:29.787

在 VB6 中，我单独使用冒号。 `:`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-08-13T04:57:22.350

在 C++ 中我使用

```
Sleep(0) 
```

有时，或者只是找到一个使用的变量并将其分配给自己：

```
i = i; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-10-13T18:56:36.010

确实，奇怪的是 VS2010 调试器会在断点位于分号之类的空语句上时四处移动断点。不管它看起来如何，在调试版本中，您通常仍然可以在空的 C# 控制块或分号上放置一个断点，它会被正确命中。对此感到恼火一段时间后，我只是创建了这个来代替：

```
public static class Nop { public static void X() { } }; 
```

编辑：要使用它，请将 Nop.X() 放入您的代码中...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-07T20:09:38.363

不是很复杂，但很实用。

```
bool bp;

bp = true; //whereever I need to break. 
```

# c# - CallContext 与 ThreadStatic

> ID：273301
> 
> 赞同：54
> 
> 时间：2008-11-07T19:26:11.400
> 
> 标签：c#, asp.net

CallContext 和 ThreadStatic 有什么区别？

我了解到，在 ASP.NET 环境中，存储在 CallContext 中的数据可以在整个请求中持续存在，直到它结束，而 ThreadStatic 可能会或可能不会工作，因为请求可能会切换线程。我还了解到 HttpContext 是使用 CallContext 在内部存储的。

在常规应用程序中，它们似乎都在同一个线程调用中持续存在。什么时候不是这样？

* * *

**编辑：**在评论中我了解到调用上下文是对线程静态存储的抽象。ASP.NET 框架将数据从一个线程显式移动到下一个线程以处理一个请求。其他想要提供线程敏捷性的框架可以对上下文存储做同样的事情。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-07T19:29:21.143

很多时候，一个请求会始终使用同一个线程，但肯定不会总是如此——ASP.NET 展示了*线程敏捷性*。从 2005 年开始有一篇关于此事的旧[的深入博客文章](http://piers7.blogspot.com/2005/11/threadstatic-callcontext-and_02.html)，但从 .NET 4.5 开始，[情况要好得多](https://blog.stephencleary.com/2013/04/implicit-async-context-asynclocal.html)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-07T19:32:41.760

存储为 ThreadStatic 的项目可用于多个请求。IIS 在请求完成后重用线程来处理后续请求，它甚至可以在处理过程中将请求从一个线程交换到另一个线程。ASP.Net 在每次请求后清除 CallContext。

# sql-server - 有没有办法对 SQL Server 2005 使用 Active Directory 传递安全性并禁止连接类型，例如 ODBC

> ID：273306
> 
> 赞同：2
> 
> 时间：2008-11-07T19:27:18.433
> 
> 标签：sql-server, sql-server-2005, active-directory

我们有一个使用服务帐户和细粒度表的内部应用程序，并且字段控制由应用程序中的权限表控制。

如果我们想在 Active Directory 中使用传递安全性，我们会遇到一个问题，即具有 odbc 访问权限的用户可以修改应用程序中存在的业务规则之外的表。

有没有办法启用直通安全性，但禁用 odbc 访问。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T19:52:18.523

您可以使用存储过程并且只授予存储过程的权限，以确保不会违反基本业务规则（如果它们简单且不变，则可以进入 SP）或至少（如果它们很复杂）或更改，它们在 SP 中效果不佳），所有修改都必须通过存储过程。如果他们与数据库建立 ODBC 连接，他们可以执行存储的过程以进行更改，但如果您授予表或视图的仅选择权限，则他们无法通过例如 Access 链接表来执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T02:02:03.580

您可以使用应用程序角色[http://msdn.microsoft.com/en-us/library/ms190998.aspx](http://msdn.microsoft.com/en-us/library/ms190998.aspx)以允许您阻止修改访问，除非设置了应用程序角色。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-09T17:20:28.407

如果是 SQL 2005 +，则可以使用登录触发器。

*   使用 HOST_NAME 或 APP_NAME 限制谁连接到服务器或应用程序
*   使用 sys.dm_exec_sessions 测试“client_interface_name”

# .net - 我需要一种快速而肮脏的方式来附加到 vb.net 中的文本文件

> ID：273307
> 
> 赞同：3
> 
> 时间：2008-11-07T19:27:28.853
> 
> 标签：.net, vb.net, logging, text-files

我有一个非常小的独立 vb.net 应用程序，可以自动运行。它时不时地遇到我想要记录然后继续处理的错误情况。但是，这对于存储在系统的主日志中来说太小了——我真的只想在文本文件中附加一行。

在.net下将一行文本附加到文件（如果文件不存在则创建文件）的压力最小的方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-07T19:32:51.340

[IO.File.AppendAllText](http://msdn.microsoft.com/en-us/library/ms143356.aspx) (@"Y:\our\File\Name.here", "你的日志信息在这里")

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T19:33:52.193

在 VB.NET 中，[My.Computer.FileSystem.WriteAllText](http://msdn.microsoft.com/en-us/library/27t17sxs(VS.80).aspx)可以解决问题。如果您不喜欢 My 命名空间，[System.IO.File.AppendAllText](http://msdn.microsoft.com/en-us/library/ms143356.aspx)也可以。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T19:33:07.593

这是在 C# 中，但更改为 VB 应该很简单：

```
 void logMessage(string message)
    {
        string logFileName = "log.file";

        File.AppendAllText(logFileName,message);
    } 
```

编辑是因为乔尔的解决方案比我的简单得多 =)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-07T19:37:02.530

```
Private Const LOG_FILE As String = "C:\Your\Log.file"

Private Sub AppendMessageToLog(ByVal message As String)
    If Not File.Exists(LOG_FILE) Then
        File.Create(LOG_FILE)
    End If

    Using writer As StreamWriter = File.AppendText(LOG_FILE)
        writer.WriteLine(message)
    End Using
End Sub 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T19:30:24.010

这篇 MSDN 文章[How to: Write Text to a File](http://msdn.microsoft.com/en-us/library/6ka1wd3w.aspx)应该这样做。

# java - 允许 servlet 和客户端脚本读取同一文件的最佳方法是什么？

> ID：273309
> 
> 赞同：3
> 
> 时间：2008-11-07T19:27:56.077
> 
> 标签：java, web-applications, configuration, servlets, jakarta-ee

我们希望在 Java 验证类（用于完整性检查）和启用 Javascript 的表单 Web 界面（用于可用性）之间共享用户验证配置。在我们的 Web 应用程序中部署这个静态文件的最佳方式是什么，以便它既可用于服务器端代码，又可通过客户端访问的 URL 使用？

到目前为止，我已经考虑将文件放在应用程序根目录中，并在使用它时将验证类指向它，然后将文件放在 WEB-INF/classes 目录中，并以某种方式配置容器来服务它。

有没有其他人配置过这样的 Web 应用程序？你最后做了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T19:40:18.813

是的。将它放在 WEB-INF/classes 中，并让一个 servlet 根据 form-id 之类的东西提供验证配置的相关部分。更好的是，让 servlet 将配置转换为 JSON 对象，然后您可以简单地包含一个脚本标记并开始使用它:)

# c# - 随机化列表

> ID：273313
> 
> 赞同：1027
> 
> 时间：2008-11-07T19:28:18.853
> 
> 标签：c#, generic-list

在 C# 中随机化泛型列表顺序的最佳方法是什么？我在一个列表中有一组有限的 75 个数字，我想分配一个随机顺序，以便为彩票类型的应用程序绘制它们。

* * *

## 回答 #1

> 赞同：1311
> 
> 时间：2009-08-11T20:07:57.797

`(I)List`使用基于[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)的扩展方法随机播放任何内容：

```
private static Random rng = new Random();  

public static void Shuffle<T>(this IList<T> list)  
{  
    int n = list.Count;  
    while (n > 1) {  
        n--;  
        int k = rng.Next(n + 1);  
        T value = list[k];  
        list[k] = list[n];  
        list[n] = value;  
    }  
} 
```

用法：

```
List<Product> products = GetProducts();
products.Shuffle(); 
```

上面的代码使用备受批评的 System.Random 方法来选择交换候选者。它很快，但不像它应该的那样随机。如果您需要在随机播放中获得更好的随机性，请使用 System.Security.Cryptography 中的随机数生成器，如下所示：

```
using System.Security.Cryptography;
...
public static void Shuffle<T>(this IList<T> list)
{
    RNGCryptoServiceProvider provider = new RNGCryptoServiceProvider();
    int n = list.Count;
    while (n > 1)
    {
        byte[] box = new byte[1];
        do provider.GetBytes(box);
        while (!(box[0] < n * (Byte.MaxValue / n)));
        int k = (box[0] % n);
        n--;
        T value = list[k];
        list[k] = list[n];
        list[n] = value;
    }
} 
```

[此博客](https://web.archive.org/web/20150801085341/http://blog.thijssen.ch/2010/02/when-random-is-too-consistent.html)（WayBack Machine）提供了一个简单的比较。

编辑：自从几年前写下这个答案以来，很多人都评论或写信给我，指出我比较中的一个愚蠢的大缺陷。他们当然是对的。如果按照预期的方式使用 System.Random，它没有任何问题。在我上面的第一个示例中，我在 Shuffle 方法中实例化了 rng 变量，如果要重复调用该方法，这会带来麻烦。下面是一个固定的完整示例，基于今天从@weston 收到的关于 SO 的非常有用的评论。

程序.cs：

```
using System;
using System.Collections.Generic;
using System.Threading;

namespace SimpleLottery
{
  class Program
  {
    private static void Main(string[] args)
    {
      var numbers = new List<int>(Enumerable.Range(1, 75));
      numbers.Shuffle();
      Console.WriteLine("The winning numbers are: {0}", string.Join(",  ", numbers.GetRange(0, 5)));
    }
  }

  public static class ThreadSafeRandom
  {
      [ThreadStatic] private static Random Local;

      public static Random ThisThreadsRandom
      {
          get { return Local ?? (Local = new Random(unchecked(Environment.TickCount * 31 + Thread.CurrentThread.ManagedThreadId))); }
      }
  }

  static class MyExtensions
  {
    public static void Shuffle<T>(this IList<T> list)
    {
      int n = list.Count;
      while (n > 1)
      {
        n--;
        int k = ThreadSafeRandom.ThisThreadsRandom.Next(n + 1);
        T value = list[k];
        list[k] = list[n];
        list[n] = value;
      }
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：433
> 
> 时间：2010-11-23T23:34:14.907

如果我们只需要以完全随机的顺序打乱项目（只是为了混合列表中的项目），我更喜欢这个简单而有效的代码，它按 guid 排序项目......

```
var shuffledcards = cards.OrderBy(a => Guid.NewGuid()).ToList(); 
```

* * *

正如人们在评论中指出的那样，GUID 不能保证是随机的，所以我们应该使用真正的随机数生成器：

```
private static Random rng = new Random();
...
var shuffledcards = cards.OrderBy(a => rng.Next()).ToList(); 
```

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2014-03-26T17:41:15.273

我对这里这个简单算法的所有笨重版本感到有点惊讶。Fisher-Yates（或 Knuth shuffle）有点棘手但非常紧凑。为什么很棘手？因为您需要注意您的随机数生成器`r(a,b)`返回的值`b`是包含还是排除。我还编辑了[维基百科的描述](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle#The_modern_algorithm)，这样人们就不会盲目地遵循伪代码并创建难以检测的错误。对于 .Net，`Random.Next(a,b)`返回数字除外`b`so 事不宜迟，以下是它在 C#/.Net 中的实现方式：

```
public static void Shuffle<T>(this IList<T> list, Random rnd)
{
    for(var i=list.Count; i > 0; i--)
        list.Swap(0, rnd.Next(0, i));
}

public static void Swap<T>(this IList<T> list, int i, int j)
{
    var temp = list[i];
    list[i] = list[j];
    list[j] = temp;
} 
```

[试试这个代码](https://dotnetfiddle.net/f7aG0o#)。

* * *

## 回答 #4

> 赞同：81
> 
> 时间：2010-08-11T08:54:59.893

IEnumerable 的扩展方法：

```
public static IEnumerable<T> Randomize<T>(this IEnumerable<T> source)
{
    Random rnd = new Random();
    return source.OrderBy<T, int>((item) => rnd.Next());
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2018-07-31T06:00:34.813

想法是获取具有项目和随机顺序的匿名对象，然后按此顺序重新排序项目并返回值：

```
var result = items.Select(x => new { value = x, order = rnd.Next() })
            .OrderBy(x => x.order).Select(x => x.value).ToList() 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-11-07T21:18:36.337

```
 public static List<T> Randomize<T>(List<T> list)
    {
        List<T> randomizedList = new List<T>();
        Random rnd = new Random();
        while (list.Count > 0)
        {
            int index = rnd.Next(0, list.Count); //pick a random item from the master list
            randomizedList.Add(list[index]); //place it at the end of the randomized list
            list.RemoveAt(index);
        }
        return randomizedList;
    } 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-10-27T08:43:07.820

**编辑** 这`RemoveAt`是我以前版本的一个弱点。该解决方案克服了这一点。

```
public static IEnumerable<T> Shuffle<T>(
        this IEnumerable<T> source,
        Random generator = null)
{
    if (generator == null)
    {
        generator = new Random();
    }

    var elements = source.ToArray();
    for (var i = elements.Length - 1; i >= 0; i--)
    {
        var swapIndex = generator.Next(i + 1);
        yield return elements[swapIndex];
        elements[swapIndex] = elements[i];
    }
} 
```

请注意可选的`Random generator`，如果 的基本框架实现`Random`不是线程安全的或加密强度不足以满足您的需求，您可以将您的实现注入到操作中。

[`Random`可以在此答案中找到适用于线程安全加密强实现的合适实现。](https://stackoverflow.com/a/24648788/659190)

* * *

~~这是一个想法，以（希望）有效的方式扩展 IList。~~

 ~~```
public static IEnumerable<T> Shuffle<T>(this IList<T> list)
{
    var choices = Enumerable.Range(0, list.Count).ToList();
    var rng = new Random();
    for(int n = choices.Count; n > 1; n--)
    {
        int k = rng.Next(n);
        yield return list[choices[k]];
        choices.RemoveAt(k);
    }

    yield return list[choices[0]];
} 
```~~  ~~* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-12-22T01:33:59.693

如果您不介意使用 two `Lists`，那么这可能是最简单的方法，但可能不是最有效或不可预测的方法：

```
List<int> xList = new List<int>() { 1, 2, 3, 4, 5 };
List<int> deck = new List<int>();

foreach (int xInt in xList)
    deck.Insert(random.Next(0, deck.Count + 1), xInt); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-09-19T09:43:39.213

当不希望修改原始文件时，这是我首选的随机播放方法。它是[Fisher-Yates“由内而外”算法](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle#The_.22inside-out.22_algorithm)的一种变体，适用于任何可枚举序列（`source`不需要从一开始就知道的长度）。

```
public static IList<T> NextList<T>(this Random r, IEnumerable<T> source)
{
  var list = new List<T>();
  foreach (var item in source)
  {
    var i = r.Next(list.Count + 1);
    if (i == list.Count)
    {
      list.Add(item);
    }
    else
    {
      var temp = list[i];
      list[i] = item;
      list.Add(temp);
    }
  }
  return list;
} 
```

该算法也可以通过分配一个范围 from `0`to`length - 1`并通过将随机选择的索引与最后一个索引交换来随机耗尽索引来实现，直到所有索引都被恰好选择一次。上面的代码完成了完全相同的事情，但没有额外的分配。这很整洁。

关于`Random`类，它是一个通用的数字生成器（如果我在玩彩票，我会考虑使用不同的东西）。默认情况下，它还依赖于基于时间的种子值。问题的一个小缓解方法是`Random`使用`RNGCryptoServiceProvider`或您可以`RNGCryptoServiceProvider`在与此类似的方法中使用 （见下文）来生成统一选择的随机双浮点值，但运行彩票几乎需要了解随机性和性质随机性来源。

```
var bytes = new byte[8];
_secureRng.GetBytes(bytes);
var v = BitConverter.ToUInt64(bytes, 0);
return (double)v / ((double)ulong.MaxValue + 1); 
```

生成随机双精度数（仅在 0 和 1 之间）的目的是用于缩放到整数解。如果您需要根据随机双精度从列表中选择一些东西，`x`那总是`0 <= x && x < 1`很简单。

```
return list[(int)(x * list.Count)]; 
```

享受！

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-07T19:35:30.087

我通常使用：

```
var list = new List<T> ();
fillList (list);
var randomizedList = new List<T> ();
var rnd = new Random ();
while (list.Count != 0)
{
    var index = rnd.Next (0, list.Count);
    randomizedList.Add (list [index]);
    list.RemoveAt (index);
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-07T19:35:19.960

如果您有一个固定数字 (75)，您可以创建一个包含 75 个元素的数组，然后枚举您的列表，将元素移动到数组中的随机位置。[您可以使用Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Knuth_shuffle "费舍尔-耶茨洗牌")生成列表编号到数组索引的映射。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-08-24T17:48:56.687

您可以使用这个简单的扩展方法来实现

```
public static class IEnumerableExtensions
{

    public static IEnumerable<t> Randomize<t>(this IEnumerable<t> target)
    {
        Random r = new Random();

        return target.OrderBy(x=>(r.Next()));
    }        
} 
```

您可以通过执行以下操作来使用它

```
// use this on any collection that implements IEnumerable!
// List, Array, HashSet, Collection, etc

List<string> myList = new List<string> { "hello", "random", "world", "foo", "bar", "bat", "baz" };

foreach (string s in myList.Randomize())
{
    Console.WriteLine(s);
} 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-09-08T18:27:35.970

只是想建议一个使用`IComparer<T>`and的变体`List.Sort()`：

```
public class RandomIntComparer : IComparer<int>
{
    private readonly Random _random = new Random();

    public int Compare(int x, int y)
    {
        return _random.Next(-1, 2);
    }
} 
```

用法：

```
list.Sort(new RandomIntComparer()); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-05-24T06:29:02.557

我在网上找到了一个有趣的解决方案。

礼貌：[https ://improveandrepeat.com/2018/08/a-simple-way-to-shuffle-your-lists-in-c/](https://improveandrepeat.com/2018/08/a-simple-way-to-shuffle-your-lists-in-c/)

var shuffled = myList.OrderBy(x => Guid.NewGuid()).ToList();

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-10-09T06:35:41.620

可以使用 morelinq 包中的 Shuffle 扩展方法，它适用于 IEnumerables

> 安装包 morelinq

```
using MoreLinq;
...    
var randomized = list.Shuffle(); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-09-08T01:59:38.050

[对已接受答案](https://stackoverflow.com/a/1262619/)的简单修改，返回一个新列表而不是就地工作，并`IEnumerable<T>`像许多其他 Linq 方法一样接受更通用的答案。

```
private static Random rng = new Random();

/// <summary>
/// Returns a new list where the elements are randomly shuffled.
/// Based on the Fisher-Yates shuffle, which has O(n) complexity.
/// </summary>
public static IEnumerable<T> Shuffle<T>(this IEnumerable<T> list) {
    var source = list.ToList();
    int n = source.Count;
    var shuffled = new List<T>(n);
    shuffled.AddRange(source);
    while (n > 1) {
        n--;
        int k = rng.Next(n + 1);
        T value = shuffled[k];
        shuffled[k] = shuffled[n];
        shuffled[n] = value;
    }
    return shuffled;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-07-01T13:32:57.033

```
 List<T> OriginalList = new List<T>();
    List<T> TempList = new List<T>();
    Random random = new Random();
    int length = OriginalList.Count;
    int TempIndex = 0;

    while (length > 0) {
        TempIndex = random.Next(0, length);  // get random value between 0 and original length
        TempList.Add(OriginalList[TempIndex]); // add to temp list
        OriginalList.RemoveAt(TempIndex); // remove from original list
        length = OriginalList.Count;  // get new list <T> length.
    }

    OriginalList = new List<T>();
    OriginalList = TempList; // copy all items from temp list to original list. 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-07-25T13:10:23.517

这是 Fisher-Yates shuffle 的一个实现，它允许指定要返回的元素数量；因此，没有必要在获取所需数量的元素之前先对整个集合进行排序。

交换元素的顺序与默认相反；并从第一个元素继续到最后一个元素，因此检索集合的子集会产生与洗牌整个集合相同的（部分）序列：

```
collection.TakeRandom(5).SequenceEqual(collection.Shuffle().Take(5)); // true 
```

该算法基于 Durstenfeld 的（现代）版本的 Wikipedia 上的[Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle#The_modern_algorithm)。

```
public static IList<T> TakeRandom<T>(this IEnumerable<T> collection, int count, Random random) => shuffle(collection, count, random);
public static IList<T> Shuffle<T>(this IEnumerable<T> collection, Random random) => shuffle(collection, null, random);
private static IList<T> shuffle<T>(IEnumerable<T> collection, int? take, Random random)
{
    var a = collection.ToArray();
    var n = a.Length;
    if (take <= 0 || take > n) throw new ArgumentException("Invalid number of elements to return.");
    var end = take ?? n;
    for (int i = 0; i < end; i++)
    {
        var j = random.Next(i, n);
        (a[i], a[j]) = (a[j], a[i]);
    }

    if (take.HasValue) return new ArraySegment<T>(a, 0, take.Value);
    return a;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-09-17T08:46:32.963

通过使用元组进行交换，您可以使 Fisher-Yates shuffle 更加简洁和富有表现力。

```
private static readonly Random random = new Random();

public static void Shuffle<T>(this IList<T> list)
{
    int n = list.Count;
    while (n > 1)
    {
        n--;
        int k = random.Next(n + 1);
        (list[k], list[n]) = (list[n], list[k]);
    }
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-01-24T21:26:56.207

这是一个高效的 Shuffler，它返回一个混洗值的字节数组。它永远不会洗牌超过需要。它可以从之前停止的地方重新启动。我的实际实现（未显示）是一个 MEF 组件，它允许用户指定替换洗牌器。

```
 public byte[] Shuffle(byte[] array, int start, int count)
    {
        int n = array.Length - start;
        byte[] shuffled = new byte[count];
        for(int i = 0; i < count; i++, start++)
        {
            int k = UniformRandomGenerator.Next(n--) + start;
            shuffled[i] = array[k];
            array[k] = array[start];
            array[start] = shuffled[i];
        }
        return shuffled;
    } 
```

`

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-08-10T21:43:41.720

您的问题是如何**随机化**列表。这表示：

1.  所有独特的组合都应该有可能发生
2.  所有独特的组合都应该以相同的分布出现（AKA 是无偏的）。

为这个问题发布的大量答案不满足上述“随机”的两个要求。

这是遵循 Fisher-Yates shuffle 方法的紧凑、无偏伪随机函数。

```
public static void Shuffle<T>(this IList<T> list, Random rnd)
{
    for (var i = list.Count-1; i > 0; i--)
    {
        var randomIndex = rnd.Next(i + 1); //maxValue (i + 1) is EXCLUSIVE
        list.Swap(i, randomIndex); 
    }
}

public static void Swap<T>(this IList<T> list, int indexA, int indexB)
{
   var temp = list[indexA];
   list[indexA] = list[indexB];
   list[indexB] = temp;
} 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2013-03-28T17:29:12.197

这是执行此操作的线程安全方法：

```
public static class EnumerableExtension
{
    private static Random globalRng = new Random();

    [ThreadStatic]
    private static Random _rng;

    private static Random rng 
    {
        get
        {
            if (_rng == null)
            {
                int seed;
                lock (globalRng)
                {
                    seed = globalRng.Next();
                }
                _rng = new Random(seed);
             }
             return _rng;
         }
    }

    public static IEnumerable<T> Shuffle<T>(this IEnumerable<T> items)
    {
        return items.OrderBy (i => rng.Next());
    }
} 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2014-06-16T18:52:15.177

```
 public Deck(IEnumerable<Card> initialCards) 
    {
    cards = new List<Card>(initialCards);
    public void Shuffle() 
     }
    {
        List<Card> NewCards = new List<Card>();
        while (cards.Count > 0) 
        {
            int CardToMove = random.Next(cards.Count);
            NewCards.Add(cards[CardToMove]);
            cards.RemoveAt(CardToMove);
        }
        cards = NewCards;
    }

public IEnumerable<string> GetCardNames() 

{
    string[] CardNames = new string[cards.Count];
    for (int i = 0; i < cards.Count; i++)
    CardNames[i] = cards[i].Name;
    return CardNames;
}

Deck deck1;
Deck deck2;
Random random = new Random();

public Form1() 
{

InitializeComponent();
ResetDeck(1);
ResetDeck(2);
RedrawDeck(1);
 RedrawDeck(2);

}

 private void ResetDeck(int deckNumber) 
    {
    if (deckNumber == 1) 
{
      int numberOfCards = random.Next(1, 11);
      deck1 = new Deck(new Card[] { });
      for (int i = 0; i < numberOfCards; i++)
           deck1.Add(new Card((Suits)random.Next(4),(Values)random.Next(1, 14)));
       deck1.Sort();
}

   else
    deck2 = new Deck();
 }

private void reset1_Click(object sender, EventArgs e) {
ResetDeck(1);
RedrawDeck(1);

}

private void shuffle1_Click(object sender, EventArgs e) 
{
    deck1.Shuffle();
    RedrawDeck(1);

}

private void moveToDeck1_Click(object sender, EventArgs e) 
{

    if (listBox2.SelectedIndex >= 0)
    if (deck2.Count > 0) {
    deck1.Add(deck2.Deal(listBox2.SelectedIndex));

}

    RedrawDeck(1);
    RedrawDeck(2);

} 
```

* * *

## 回答 #24

> 赞同：-2
> 
> 时间：2020-11-06T07:20:33.720

```
private List<GameObject> ShuffleList(List<GameObject> ActualList) {

    List<GameObject> newList = ActualList;
    List<GameObject> outList = new List<GameObject>();

    int count = newList.Count;

    while (newList.Count > 0) {

        int rando = Random.Range(0, newList.Count);

        outList.Add(newList[rando]);

        newList.RemoveAt(rando);

    }

    return (outList);

} 
```

用法 ：

```
List<GameObject> GetShuffle = ShuffleList(ActualList); 
```

* * *

## 回答 #25

> 赞同：-4
> 
> 时间：2015-04-11T16:24:55.323

肯定是旧帖子，但我只使用 GUID。

```
Items = Items.OrderBy(o => Guid.NewGuid().ToString()).ToList(); 
```

GUID 始终是唯一的，因为每次结果都更改时它会重新生成。

* * *

## 回答 #26

> 赞同：-8
> 
> 时间：2008-11-07T19:36:14.250

解决这类问题的一个非常简单的方法是在列表中使用多个随机元素交换。

在伪代码中，这看起来像这样：

```
do 
    r1 = randomPositionInList()
    r2 = randomPositionInList()
    swap elements at index r1 and index r2 
for a certain number of times 
```

# math - 乳胶数学符号：Vitanyi 在他的等号上放了一个小加号。我怎么做？

> ID：273314
> 
> 赞同：6
> 
> 时间：2008-11-07T19:28:20.257
> 
> 标签：math, latex, symbols

例如，在[http://homepages.cwi.nl/~paulv/papers/algorithmicstatistics.pdf](http://homepages.cwi.nl/~paulv/papers/algorithmicstatistics.pdf)第 5 页底部和第 6 页顶部，他使用了加号/等于号和类似的加号/小于号。我不知道如何制作那个符号，我想引用他的话。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-07T19:48:42.727

尝试`$\stackrel{top}{bottom}$`

你想要这样的东西：

```
$X \stackrel{+}{=} Y$ 
```

这会将加号定位在等号上方。例如，下面的代码：

```
$K(x,y|z) \stackrel{+}{=} K(x|z) \stackrel{+}{<} I(x:y|z)$ 
```

产生以下输出：

![等式包括 + 签名 = 符号](https://i.stack.imgur.com/fbaAX.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T19:45:46.163

[综合 LaTeX 符号列表](http://www.ctan.org/tex-archive/info/symbols/comprehensive/symbols-a4.pdf)（来自[此处](http://www.ctan.org/tex-archive/info/symbols/comprehensive/)）是一个很好的资源，可以从此类问题开始。您也可以联系作者，他可能会使用一些 LaTex 巫术（数学口音等）来使其正常工作。

祝你好运。

PS：是不是 \pm 加减号，不是加号等于？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T19:33:02.633

这是[Latex 数学符号](http://web.ift.uib.no/Fysisk/Teori/KURS/WRK/TeX/symALL.html)列表。我没有从您链接到的 PDF 中看到这两个。你知道他们的意思吗？您也许可以在 Latex 列表中找到等价物。

# .net - 配置管理应用程序块

> ID：273329
> 
> 赞同：1
> 
> 时间：2008-11-07T19:31:02.263
> 
> 标签：.net, configuration-files

任何人都有使用 Microsoft 配置管理应用程序块的经验吗？这是他们网站上的一段较旧的代码，但它似乎可以用作存储/读取 .Net 应用程序配置值的标准方法。它是一个好/坏的工具吗，矫枉过正，在框架的更新版本中可能有什么更好的选择，等等？

提前感谢您的任何回复。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T20:00:19.100

我从来没有觉得受到 .NET 的标准配置功能的限制。使用 appSettings 和 connectionString 部分可以轻松处理简单的配置 -必要时[可加密。](http://msdn.microsoft.com/en-us/library/zhhddkxy.aspx)

对于自定义配置，试试这个：[http](http://haacked.com/archive/2007/03/12/custom-configuration-sections-in-3-easy-steps.aspx) ://haacked.com/archive/2007/03/12/custom-configuration-sections-in-3-easy-steps.aspx 。

如果您需要将配置数据存储在其他地方，请考虑通过实现您自己的 ProtectedConfigurationProvider 来重定向：

*   [http://www.wrox.com/WileyCDA/Section/Redirecting-Configuration-with-a-Custom-Provider.id-291932.html](http://www.wrox.com/WileyCDA/Section/Redirecting-Configuration-with-a-Custom-Provider.id-291932.html)
*   [http://msdn.microsoft.com/en-us/library/wfc2t3az.aspx](http://msdn.microsoft.com/en-us/library/wfc2t3az.aspx)
*   [http://www.blayd.co.uk/article.aspx?pageid=1012#sectionSix](http://www.blayd.co.uk/article.aspx?pageid=1012#sectionSix)

# java - 我应该使用什么组件在 Java 中绘制树状图？

> ID：273333
> 
> 赞同：1
> 
> 时间：2008-11-07T19:31:58.220
> 
> 标签：java, swing, awt, dendrogram

树状图不是常规图。我应该使用 javax.swing.* 库中的任何组件，还是只使用 java.awt.Graphics 绘制它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T19:49:22.430

可能也值得检查：[yWorks](http://www.yworks.com/en/index.html)和[JGraph](http://www.jgraph.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T20:37:40.443

我认为这没有标准组件。除非某些组件供应商已经这样做了，否则您应该采用 Java 2D 方式...

如果您不想做艰苦的工作，也许上述库之一可能会对您有所帮助。否则，GraphViz 擅长制作这种图表，并且有一个[Java API](http://www.loria.fr/~szathmar/off/projects/java/GraphVizAPI/index.php "Java API")（未经测试......）。

另一种可能的方法是使用一些物理来让节点以一种和谐的方式排列自己。这就是[Aharef 的 HTML 图表的](http://www.aharef.info/static/htmlgraph/ "http://www.aharef.info/static/htmlgraph/")工作原理……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T09:53:18.277

[Netbeans 图形 API](http://graph.netbeans.org/)

到目前为止，最简单、最直观的 API。

# iphone - iPhone 和 HTML5 缓存清单

> ID：273350
> 
> 赞同：2
> 
> 时间：2008-11-07T19:35:08.197
> 
> 标签：iphone, iphone-web-app

我正在尝试使用 ASP.NET 构建 iPhone Web 应用程序。该页面为每个访问者动态呈现一次。此时，该页面可以被添加书签，并且该访问者将永远不会再更改。出于这个原因，它应该从那时起在本地缓存，这样即使没有可用的网络连接，如果从书签中引用，应用程序也会运行。无论我尝试什么，手机都会继续从服务器请求页面，强制重新渲染，或者如果手机离线，它会失败。

[Louis Gerbarg](https://stackoverflow.com/users/30506/louis-gerbarg)在[这篇](https://stackoverflow.com/questions/264367/iphone-web-app-cache-persistence)文章中建议我使用 HTML5 缓存清单来完成这项工作，但是遵循[w3.org 文档](http://www.w3.org/TR/offline-webapps/#offline)似乎不适用于 iPhone。有没有人有一个应用程序缓存工作的好例子？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T19:06:30.923

缓存清单文件必须以“text/cache-manifest”mime 类型提供。这是绝对关键的，没有它就行不通。如果您导航到清单文件的 url，它应该会触发下载...

此外，我发现将清单位置作为绝对位置放在标记中，以及清单文件中的所有条目更有效。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T21:54:26.857

我回答了您之前与此相关的问题，但从该问题中不清楚您是否正在尝试缓存动态内容。缓存清单用于获取您希望离线 Web 应用程序运行的静态内容。

我不确定你能做你想做的事。您是否希望该应用程序能够离线运行，或者您只是因为下载速度慢而试图将某些内容固定在缓存中？除非您实际上正在构建一个离线 web 应用程序（用户将其添加为书签或 Spring Board 中的应用程序），否则您的页面可以（并且必须）由浏览器自行决定从本地存储中逐出，无论多么松散您在页面上设置的缓存策略。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T13:09:56.260

您应该使用适用于 iPhone 和 Safari 3.1 的 Safari Javascript Database API。它非常适合本地缓存和数据存储：

[http://developer.apple.com/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/](http://developer.apple.com/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T22:10:03.657

这可能与输出的大小有关。

我不能谈论任何专门为 iphone 调整东西的严肃经验，但是 YUI 团队在这里读到了一篇有趣的文章：http: [//yuiblog.com/blog/2008/02/06/iphone-cacheability/](http://yuiblog.com/blog/2008/02/06/iphone-cacheability/)，这表明 iphone 中可以保存的最大解压缩缓存文件为 25k，并且为了获得最佳缓存，尽可能多的组件应 <25k。

这可能是您的问题的原因，但这只是一个猜测。

# architecture - 当您需要进行延迟加载（并使用 IOC 容器）时，如何避免循环数据访问对象依赖关系？

> ID：273353
> 
> 赞同：3
> 
> 时间：2008-11-07T19:35:32.707
> 
> 标签：architecture, dependency-injection

注意：以下示例是 C#，但此问题不应特定于任何语言。

因此，我正在使用[S# Architecture](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)的变体构建对象域。对于那些不熟悉它的人，为了节省一些阅读时间，这个想法很简单，就是为每个负责加载到/从持久层加载的域对象都有一个数据访问对象接口。可能需要加载/保存给定对象的所有内容都接受该对象的数据访问接口作为依赖项。因此，例如，我们可以有以下内容，其中产品将根据需要延迟加载购买它的客户：

```
public class Product {
  private ICustomerDao _customerDao;
  private Customer _customer;
  public Product(ICustomerDao customerDao) {_customerDao = customerDao;}
  public int ProductId {get; set;}
  public int CustomerId {get; set;}
  public Customer Customer {
        get{
            if(_customer == null) _customer = _customerDao.GetById(CustomerId);
            return _customer;
        }
}
public interface ICustomerDao {
   public Customer GetById(int id);
} 
```

这一切都很好，直到您遇到两个对象需要能够相互加载的情况。例如多对一关系，如上所述，产品需要能够延迟加载其客户，但客户也需要能够获得他的产品列表。

```
public class Customer {
  private IProductDao _productDao;
  private Product[] _products;
  public Customer(IProductDao  productDao) {_productDao = productDao;}
  public int CustomerId {get; set;}
  public Product[] Products {
        get{
            if(_products == null) _products = _productDao. GetAllForCustomer(this);
            return _products;
        }
}

public interface IProductDao {
   public Product[] GetAllForCustomer(Customer customer);
} 
```

我知道这是一个非常普遍的情况，但我在这方面相对较新。我的绊脚石是实现数据访问对象时要做什么。因为 Customer 依赖于 IProductDao，所以 CustomerDao 实现也必须，反之亦然，ProductDao 必须依赖于 ICustomerDao。

```
public class CustomerDao : ICustomerDao {
      private IProductDao _productDao;
      public CustomerDao(IProductDao  productDao) {_productDao = productDao;}
      public Customer GetById(int id) {
          Customer c = new Customer(_customerDao);
          // Query the database and fill out CustomerId
          return c;
      }
 }
public class ProductDao : IProductDao {
      private ICustomerDao _customerDao;
      public ProductDao (ICustomerDao customerDao) {_customerDao = customerDao;}
      public Product[] GetAllForCustomer(Customer customer) {
          // you get the idea
      }
 } 
```

在这里我们遇到了问题。没有 IProductDao 就不能实例化 CustomerDao，反之亦然。我的控制容器（温莎城堡）的反转遇到了循环依赖和阻塞。

我提出了一个临时解决方案，其中涉及延迟加载 DAO 对象本身（我将发布此作为答案），但我不喜欢它。这个问题有哪些久经考验的解决方案？

**编辑：**以上是我实际使用的架构的简化，我不建议有人实际将 DAO 传递给对象。更接近我实际所做的更好的实现类似于 NHibernate 的工作方式，其中实际对象非常简单，上面实际上是继承和覆盖适当字段的代理对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T21:30:44.447

正如其他海报所建议的那样，您可能需要重新考虑您的架构 - 看起来您正在让自己变得艰难。

另请注意：

> 通过将数据访问对象依赖项更改为属性而不是构造函数依赖项，Windsor 将在完全实例化每个对象后自动填充它们。

当心。在执行此操作时，您基本上已经告诉 Windsor 这些依赖项是可选的（与通过构造函数注入的依赖项不同）。这似乎是个坏主意，除非这些依赖**项**确实是可选的。如果 Windsor 无法满足所需的依赖项，您*希望*它呕吐。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T19:44:54.857

延迟加载应该由您的持久层管理，而不是您的存储库。

此外，您的 Customer 和 Product 对象不应该有任何对存储库的引用，这似乎......错了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-08T01:10:53.170

我刚刚发现了一种至少适用于温莎城堡的明显更好的方法。通过将数据访问对象依赖项更改为属性而不是构造函数依赖项，Windsor 将在完全实例化每个对象后自动填充它们。

所以以下工作就好了：

```
public class CustomerDao : ICustomerDao {

    private IProductDao _productDao;

    public IProductDao ProductDao {
        get { return _productDao; }
        set { _productDao = value; }
    }
    public CustomerDao() { }
    public Customer GetById(int id) {
        Customer c = new Customer(_productDao);
        // Query the database and fill out CustomerId
        return c;
    }
}
public class ProductDao : IProductDao {
    private ICustomerDao _customerDao;

    public ProductDao() { }

    public ICustomerDao CustomerDao {
        get { return _customerDao; }
        set { _customerDao = value; }
    }

    public Product[] GetAllForCustomer(Customer customer) {
        return null;
    }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:45:32.217

你根本不应该有这样的循环依赖。这是错误的。

如果您只需要在一段时间内犯错以克服困难，那么请尝试使用服务定位器：一个了解容器并在使用它们而不是在实例化 DAO 类时解决依赖关系的类。

您可能想查看 Oren Eini 在 Rhino.Tools 中的服务定位器实现（它是一个名为 IoC 的静态类）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T19:46:23.747

我的解决方案，让我再次声明，我不是它的忠实拥护者，让每个数据访问对象延迟加载它直接从容器中依赖的 DAO。为简单起见，我将 CustomerDao 和 ProductDao 都继承自 BaseDao 对象，然后按如下方式实现它：

```
public abstract class BaseDao() {
  private ICustomerDao _customerDao;
  protected ICustomerDao _CustomerDao {
    get {
      if(_customerDao == null) _customerDao = IoC.Container.Resolve<ICustomerDao>();
      return _customerDao;
    }
  private IProductDao _productDao;
  protected IProductDao _ProductDao {
    get {
      if(_productDao == null) _productDao = IoC.Container.Resolve< IProductDao  >();
      return _productDao;
    } 
```

}

进而

```
public class CustomerDao : BaseDao, ICustomerDao {
      public Customer GetById(int id) {
          Customer c = new Customer(_CustomerDao);
          // Query the database and fill out CustomerId
          return c;
      }
 }
public class ProductDao : BaseDao, IProductDao {
      public Product[] GetAllForCustomer(Customer customer) {
          // use the base class's _ProductDao to instantiate Products
      }
 } 
```

我不喜欢这个，因为

*   a) 每个 DAO 现在都依赖于容器
*   b) 你不再能从构造函数中分辨出每个 Dao 依赖于谁
*   c) 如果您使用这样的基类，则每个 DAO 至少需要相互隐式依赖，或者您可以将延迟加载移出基类，但必须复制大量代码。
*   d) 单元测试需要创建并预填充Container

# html - HTML中是否允许使用单引号？

> ID：273354
> 
> 赞同：158
> 
> 时间：2008-11-07T19:35:52.613
> 
> 标签：html

我是在 PHP 中使用双引号的老用户，这样我就可以插入变量而不是连接字符串。因此，当我生成 HTML 时，我经常使用单引号来设置标签字段。例如：

```
$html = "<input type='text' name='address' value='$address'>"; 
```

现在这对我来说比任何一个都更具可读性

```
$html = "<input type=\"text\" name=\"address\" value=\"$address\">"; 
```

或者

```
$html = '<input type="text" name="address" values="' . $address . '">' ; 
```

从简短的搜索中，我听说人们说 HTML 字段的单引号不能被每个浏览器识别。因此，我想知道哪些浏览器在识别单引号 HTML 时会遇到问题？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-11-07T19:38:52.077

这类似于[HTML 中的单引号何时变得如此流行？](https://stackoverflow.com/questions/242766/when-did-single-quotes-in-html-become-so-popular). HTML 中属性的单引号是并且总是被[规范](http://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.2)所允许。我认为任何浏览器都不会理解它们。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-11-07T20:52:57.590

正如 PhiLho 所指出的，尽管普遍认为属性值不允许使用单引号，但这种看法是错误的。

[XML 标准](http://www.w3.org/TR/REC-xml/#NT-AttValue)允许在属性值周围使用单引号和双引号。

XHTML 标准并没有说任何改变这一点，但是声明[必须引用属性值](http://www.w3.org/TR/xhtml1/#h-4.4)的相关部分在示例中使用了双引号，这可能导致了这种混淆。这个例子只是指出 XHTML 中的属性值必须满足 XML 中属性值的最低标准，这意味着它们必须被引用（与不关心的普通 HTML 相反），但不限制您使用单个或双引号。

当然，您总是有可能遇到不符合标准的解析器，但是当这种情况发生时，无论如何，所有的赌注都没有了。所以最好只遵守规范所说的。毕竟，这就是我们有规范的原因。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-07T19:41:14.147

> 我听说有人说 HTML 字段的单引号不能被每个浏览器识别

那个人错了。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-07T20:31:02.033

不要相信你在 Internet 上看到的一切......
有趣的是，我刚刚回答了类似于有人声明单引号在 XHTML 中无效......

嗯，我在打字时看上面，看到亚当 N 传播了同样的信念。如果他能支持他的断言，我会收回我写的内容...... AFAIK，XML 是不可知论者，并且接受这两种引用。我什至毫无问题地尝试并验证了一个只有单引号的 XHTML 页面。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-15T10:45:20.177

唯一的问题是数据进入 TEXT INPUT 字段。考虑

```
<input value='it's gonna break'/> 
```

与：

```
<input value="i say - "this is gonna be trouble" "/> 
```

你无法逃避，你必须使用[`htmlspecialchars`](https://www.php.net/manual/en/function.htmlspecialchars.php).

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-04-29T15:36:05.013

当我想在**更新的规范版本中**找到这方面的信息时，我花了很长时间才找到它，这里是：

从

> # HTML
> 
> ## 生活水准 — 最后更新于 2021 年 9 月 17 日
> 
> [...]
> 
> ### 13.1.2.3 属性
> 
> #### **单引号属性值语法**

> 属性名称，后跟零个或多个 ASCII 空格，后跟单个 U+003D 等号字符，后跟零个或多个 ASCII 空格，后跟单个 U+0027 撇号字符 (')，后跟属性值，其中，除了上述对属性值的要求外，不得包含任何文字 U+0027 APOSTROPHE 字符 (')，最后是第二个单个 U+0027 APOSTROPHE 字符 (')。
> 在以下示例中，类型属性使用单引号属性值语法给出：

> ```
> <input type='checkbox'> 
> ```

> 如果使用单引号属性语法的属性后跟另一个属性，则必须有 ASCII 空格分隔两者。

> [https://html.spec.whatwg.org/#attributes-2](https://html.spec.whatwg.org/#attributes-2)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T19:40:08.390

我也倾向于在 HTML 中使用单引号，我从来没有遇到过问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-19T04:12:15.663

我在 HTML 页面中使用了单引号，并在其中嵌入了 JavaScript，它工作正常。在 IE9、Chrome 和 Firefox 中测试 - 似乎工作正常。

```
<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
        <title>Bethanie Inc. data : geographically linked</title>
        <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
        <script src='https://maps.googleapis.com/maps/api/js?v=3.11&sensor=false' type='text/javascript'></script>
        <script type='text/javascript'> 
        // check DOM Ready
        $(document).ready(function() {
            // execute
            (function() {
                /////////////// Addresses ///////////////////
                var locations = new Array();
                var i = 0;
                locations[i++] = 'L,Riversea: Comp Site1 at Riversea,1 Wallace Lane Mosman Park WA 6012'
                locations[i++] = 'L,Wearne: Comp Site2 at Wearne,1 Gibney St Cottesloe WA 6011'
                locations[i++] = 'L,Beachside:Comp Site3 Beachside,629 Two Rocks Rd Yanchep WA 6035'

                /////// Addresses/////////
                var total_locations = i;
                i = 0;
                console.log('About to look up ' + total_locations + ' locations');
                // map options
                var options = {
                    zoom: 10,
                    center: new google.maps.LatLng(-31.982484, 115.789329),//Bethanie  
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    mapTypeControl: true
                };
                // init map
                console.log('Initialise map...');
                var map = new google.maps.Map(document.getElementById('map_canvas'), options);
               // use the Google API to translate addresses to GPS coordinates 
               //(See Limits: https://developers.google.com/maps/documentation/geocoding/#Limits)
                var geocoder = new google.maps.Geocoder();
                if (geocoder) {
                    console.log('Got a new instance of Google Geocoder object');
                    // Call function 'createNextMarker' every second
                    var myVar = window.setInterval(function(){createNextMarker()}, 700);
                    function createNextMarker() {
                        if (i < locations.length) 
                       {
                            var customer = locations[i];
                            var parts = customer.split(','); // split line into parts (fields)
                            var type= parts.splice(0,1);    // type from location line (remove)
                            var name = parts.splice(0,1);    // name from location line(remove)
                            var address =parts.join(',');   // combine remaining parts
                            console.log('Looking up ' + name + ' at address ' + address);
                            geocoder.geocode({ 'address': address }, makeCallback(name, type));
                            i++; // next location in list
                            updateProgressBar(i / total_locations);

                        } else 
                       {
                            console.log('Ready looking up ' + i + ' addresses');
                            window.clearInterval(myVar);
                        }
                    }

                    function makeCallback(name,type) 
                   {
                        var geocodeCallBack = function (results, status) {
                            if (status == google.maps.GeocoderStatus.OK) {
                                var longitude = results[0].geometry.location.lng();
                                var latitude = results[0].geometry.location.lat();
                                console.log('Received result: lat:' + latitude + ' long:' + longitude);
                                var marker = new google.maps.Marker({
                                    position: new google.maps.LatLng(latitude, longitude),
                                    map: map,
                                    title: name + ' : ' + '\r\n' + results[0].formatted_address});// this is display in tool tip/ icon color
                                   if (type=='E')  {marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png')}; 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2015-03-18T13:17:09.710

最近我遇到了谷歌搜索优化的问题。如果有单引号，它似乎不会抓取链接的页面。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-04-24T17:53:34.013

...或者只是使用 heredocs。那么你不需要担心转义除了`END`.

* * *

## 回答 #11

> 赞同：-10
> 
> 时间：2008-11-07T19:56:28.653

单引号适用于 HTML，但它们不能生成有效的 XHTML，如果有人使用仅支持 XHTML 而不支持 HTML 的浏览器，这可能会出现问题。我不相信任何这样的浏览器存在，尽管可能有一些用户代理确实需要严格的 XHTML。

# asp.net - 将纯 HTML 页面转换为 ASP .NET aspx 页面的最佳“过程”？

> ID：273356
> 
> 赞同：1
> 
> 时间：2008-11-07T19:36:17.417
> 
> 标签：asp.net, html, seo

我的网站上有一些页面是纯 HTML 页面，但我想向这些页面添加一些 ASP .NET 类型的功能。我担心的是，如果我简单地将 .html 页面重命名为 .aspx，我会破坏链接，失去 SEO，等等。

我认为如何处理这种情况有一个“最佳实践”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T19:49:43.520

在 aspx 上创建新页面，并从 HTML 页面提供 301 永久重定向。

搜索蜘蛛足够聪明，可以意识到内容已经移动并且不会惩罚您。

谷歌和雅虎都说他们将元刷新解析为 301 重定向，没有延迟，所以只需执行以下操作：

```
<html>
<head>
<title>Moved to new URL: http://example.com/newurl</title>
<meta http-equiv="refresh" content="0; url=http://example.com/newurl" />
<meta name="robots" content="noindex,follow" />
</head>
<body>
<h1>This page has been moved to http://example.com/newurl</h1>
<p>If your browser doesn't redirect you to the new location please <a href="http://example.com/newurl"><b>click here</b></a>, sorry for the hassles!</p>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T19:46:45.053

如果您控制 IIS - 您可以将 .HTML 映射到 ASP.NET 处理程序并按原样运行它们。或者，将它们映射到自定义 HttpHandler 并发送带有更新位置的 301 代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T19:37:55.430

您可以使用 ISAPI 重写将 .html url 重定向到 .aspx url。

这里的想法是将所有现有页面重命名为 .aspx，但将所有传入请求作为永久重定向 (301) 处理到新的 .aspx 页面。这意味着所有到 *.html 的传入链接都将找到正确的 *.aspx 页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T19:51:20.193

所有这些都会奏效，但我认为很大程度上取决于页面的内容、您需要添加到其中的编程数量以及未来的计划。如果他们被搜索引擎重视，

但是，总的来说，我认为您最好的选择是创建新页面并将 html 页面 301 重定向到 .aspx 页面。或者，您可以进行 URL 重写以显示 .aspx 页面，同时保持 URL 不变，但这不是一个非常可扩展的解决方案。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-07T19:41:01.820

如果新的 ASP.NET 功能很小，我建议在您的 HTML 中包含 IFrame，它链接到包含您的微小动态更改的新创建的 ASP.NET 页面。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-07T19:48:52.057

改用 aspx 不应破坏任何 SEO

# opengl - BlendFunc 用于具有变化背景的纹理字体

> ID：273369
> 
> 赞同：1
> 
> 时间：2008-11-07T19:40:09.717
> 
> 标签：opengl, fonts, textures, blending

我正在尝试使用纹理字体，以便可以在我的 openGL 场景中显示文本。但是，我无法找到可行的 glBlendFunc 值。

将放置文本的背景是灰度图像，但在整个执行过程中会发生变化。因为背景发生了变化，所以文本可能位于从黑色到白色的任何颜色之上。

我发现的最佳值是 glBlendFunc(Gl.GL_SRC_COLOR, Gl.GL_ONE_MINUS_SRC_ALPHA)。这将使角色周围的黑框消失，但角色本身会随着背景变白而消失。

请帮忙！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T19:55:11.433

您是否希望文本根据背景颜色反转？黑底白字，白底黑字？我认为您可以通过 blendfunc 实现反转。

或者，您可以使用内置“边框”的字体纹理来帮助将字符与背景分开。想象一下带有平滑 alpha 混合黑色“发光”的白色字体。该字体在几乎所有颜色下看起来都很好。

# sql-server - 真实 vs. 浮点 vs. 金钱

> ID：273371
> 
> 赞同：20
> 
> 时间：2008-11-07T19:40:32.663
> 
> 标签：sql-server, types

为什么当我在 SQL Server 中将 40.54 的值保存到 Real 类型的列时，它返回给我的值更像 40.53999878999 而不是 40.54？我已经看过几次了，但从来没有弄清楚为什么会发生这种情况。有没有其他人遇到过这个问题，如果是这样导致它？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-07T19:42:53.893

看看[每个计算机科学家应该知道的关于浮点运算](http://docs.sun.com/source/806-3568/ncg_goldberg.html)的知识。

计算机中的浮点数不能精确地表示小数。相反，它们代表*二进制*分数。大多数小数没有作为二进制分数的精确表示，因此需要进行一些舍入。当这样一个四舍五入的二进制分数被转换回十进制分数时，你会得到你描述的效果。

为了存储货币值，SQL 数据库通常提供 DECIMAL 类型来存储精确的十进制数字。这种格式对计算机来说处理效率稍低，但当您想要避免小数舍入错误时，它非常有用。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-07T19:42:30.227

浮点数使用二进制分数，它们不完全对应于十进制分数。

对于金钱，最好将美分数存储为整数，或使用十进制数类型。例如，Decimal(8,2) 存储 8 位数字，包括 2 位小数 (xxxxxx.xx)，即精确到分。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-07T19:44:31.410

简而言之，由于几乎相同的原因，三分之一不能精确地用十进制表示。有关详细信息，请查看 David Goldberg 的经典论文“ [What Every Computer Scientist Should Know About Floating-Point Arithmetic](http://docs.sun.com/source/806-3568/ncg_goldberg.html) ”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T20:27:12.087

澄清一下，存储在计算机中的浮点数的行为与此处其他帖子的描述一样，因为如上所述，它以二进制格式存储。这意味着除非它的值（值的尾数和指数分量）是 2 的幂，并且不能精确表示。

另一方面，一些系统以十进制存储小数（例如 SQL Server 十进制和数字数据类型，以及 Oracle 数字数据类型），因此它们的内部表示对于任何 10 的幂的数字都是精确的。但是，不是 10 的幂的数字不能精确表示。

# c# - 如何获取属性的接口/基本类型祖先的所有属性？

> ID：273374
> 
> 赞同：5
> 
> 时间：2008-11-07T19:41:27.140
> 
> 标签：c#, reflection, attributes

所以，如果我有：

```
public class Sedan : Car 
{
    /// ...
}

public class Car : Vehicle, ITurn
{
    [MyCustomAttribute(1)]
    public int TurningRadius { get; set; }
}

public abstract class Vehicle : ITurn
{
    [MyCustomAttribute(2)]
    public int TurningRadius { get; set; }
}

public interface ITurn
{
    [MyCustomAttribute(3)]
    int TurningRadius { get; set; }
} 
```

我可以用什么魔法来做类似的事情：

```
[Test]
public void Should_Use_Magic_To_Get_CustomAttributes_From_Ancestry()
{
    var property = typeof(Sedan).GetProperty("TurningRadius");

    var attributes = SomeMagic(property);

    Assert.AreEqual(attributes.Count, 3);
} 
```

* * *

两个都

```
property.GetCustomAttributes(true); 
```

和

```
Attribute.GetCustomAttributes(property, true); 
```

仅返回 1 个属性。该实例是使用 MyCustomAttribute(1) 构建的实例。这似乎没有按预期工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T19:51:26.513

```
object[] SomeMagic (PropertyInfo property)
{
    return property.GetCustomAttributes(true);
} 
```

更新：

既然我上面的答案不起作用，为什么不尝试这样的事情：

```
public void Should_Use_Magic_To_Get_CustomAttributes_From_Ancestry()
{

    Assert.AreEqual(checkAttributeCount (typeof (Sedan), "TurningRadious"), 3);
}

int checkAttributeCount (Type type, string propertyName)
{
        var attributesCount = 0;

        attributesCount += countAttributes (type, propertyName);
        while (type.BaseType != null)
        {
            type = type.BaseType;
            attributesCount += countAttributes (type, propertyName);
        }

        foreach (var i in type.GetInterfaces ())
            attributesCount += countAttributes (type, propertyName);
        return attributesCount;
}

int countAttributes (Type t, string propertyName)
{
    var property = t.GetProperty (propertyName);
    if (property == null)
        return 0;
    return (property.GetCustomAttributes (false).Length);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T10:50:19.977

这是一个框架问题。GetCustomAttributes 忽略接口属性。请参阅此博客文章的评论[http://hyperthink.net/blog/getcustomattributes-gotcha/#comment-65](http://hyperthink.net/blog/getcustomattributes-gotcha/#comment-65)

# encryption - AES加密，什么是公钥和私钥？

> ID：273396
> 
> 赞同：31
> 
> 时间：2008-11-07T19:46:25.367
> 
> 标签：encryption, aes

在 AES 加密（.net 框架）中，如何使用公钥和私钥？

是不是把公钥和私钥组合成一个全密钥，然后算法用公钥+私钥对数据进行加密？

（下面使用的简化键用于示例目的）

例如公钥 = 12345 私钥 = 67890

所以生成加密结果时使用的密钥是：1234567890

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-11-07T21:33:16.040

正如其他人所说，AES 是一种对称算法（[私钥加密](http://en.wikipedia.org/wiki/Symmetric-key_algorithm)）。这涉及一个**密钥**，它是发送者和接收者之间的共享秘密。一个类比是一个**没有**邮箱的锁定邮箱。任何想留下或阅读信息的人都需要有邮箱的钥匙。

如果你真的想了解 AES 的血腥细节，这里有一部[很棒的卡通片](http://www.moserware.com/2009/09/stick-figure-guide-to-advanced.html)可以引导你一路走好。

[公钥密码术](http://en.wikipedia.org/wiki/Public-key_cryptography)涉及每个涉及的接收者的**两个**相关密钥 - 一个只有接收者知道的秘密的私钥和一个所有发送者都知道的相关公钥。

发件人使用收件人的公钥加密邮件。该消息只能由具有与公钥匹配的私钥的收件人解密。

公钥加密的一个类比是**带有**邮槽的锁定邮箱。邮筒是公开的，可供公众使用。它的位置（街道地址）是公钥。任何知道街道地址的人都可以走到门口并通过插槽发送书面信息。但只有拥有私钥的人才能打开邮箱并阅读邮件。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-07T19:48:35.083

AES 是一种对称算法，因此它没有公钥和私钥——只有一个共享密钥。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-14T15:07:06.040

以最简单的形式：

AES 是一种对称算法，它使用相同的密钥进行加密和解密。因此，任何拥有密钥的人都可以阅读您的消息。

私钥和公钥是针对RSA等非对称算法的，通常人们使用公钥加密，私钥解密（只有HMAC或MAC会使用私钥加密，公钥解密）。公钥是众所周知的，私钥只有你自己知道，所以没有人可以阅读发给你的消息。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-06T09:31:34.580

我不知道 .net 框架具体是如何工作的（这个问题可能应该被标记为 .net），但根据你的问题，它听起来像是实现了公钥/私钥加密，只是使用 AES 作为其对称组件。

进行公钥加密的通常模式是

*   生成对称密钥
*   使用 AES 等对称算法，使用此密钥加密数据。
*   使用 RSA 等非对称算法，使用公钥加密对称密钥。
*   将加密的 sym 密钥与加密数据捆绑在一起

数据本身首选对称算法的原因是非对称算法非常慢。

鉴于他们无法测试安全性（对于一些候选人来说，他们真正拥有的只是没有休息时间），选择 Rijndael 进行 AES 的原因（主要）与性能有关。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T21:34:33.463

公钥与私钥相关联。公钥（[RSA](http://www.cs.bham.ac.uk/~mdr/teaching/modules03/security/public_key.html)）分发给“野生”和任何想要发送加密文件的人（一般来说这里），他们将请求公钥并对其进行编码。任何获得文件访问权限的人都无法读取密文，即使他们拥有公钥。

解码文件需要私钥。只要私钥保持私密，任何人都不会猜测或破解密钥。不可能，也不是不可能。

真正的问题是保持私钥的私密性。大多数破解都是通过[社交黑客](http://www.darkreading.com/security/app-security/showArticle.jhtml?articleID=211201065)完成的。勒索、记录器和中间人公钥转换是比暴力破解密码或密钥更有可能的其他方式。

在你对布朗多的评论中，你问

> 如果两者都可以解密其他人，那么拥有公钥和私钥有什么意义呢？为什么两者不具有相同的密钥？

您所描述的是对称密钥算法，[AES](http://www.truecrypt.org/docs/?s=aes)就是其中之一。使用公钥-私钥的原因是，使用对称密钥算法，您如何通过不安全的网络、邮件、电话或其他不被截获的密钥传递对称密钥。也许加密密钥，但是你如何传递那个密钥？使用公钥-私钥组合，这变得不那么相关了。

> AccessData 营销副总裁乔恩·汉森 (Jon Hansen) 表示：“在大多数情况下，在世界上所有计算机都考虑到暴力破解 256 位密钥所需的所有信息之前，太阳被烧毁的可能性更大。” Corp，位于犹他州林登的公司，开发了支持 DNA 的软件。

# c# - Sharepoint：是否可以在顶部导航菜单中创建子组？

> ID：273400
> 
> 赞同：5
> 
> 时间：2008-11-07T19:48:35.113
> 
> 标签：c#, sharepoint, moss

我需要在顶部导航菜单中创建子组，例如：

家-组--子组

[替代文字 http://img300.imageshack.us/my.php?image=topnavigationmenudr4.png](http://img300.imageshack.us/my.php?image=topnavigationmenudr4.png)

是否可以？我不能超过两个级别！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T20:49:46.393

请参阅 Heather Solomon 的这篇[博](http://www.heathersolomon.com/blog/archive/2007/05/15/SharePoint-Tip--How-to-Activate-the-Drop-Down-Menu.aspx)文。

您需要修改母版页以将**SharePoint:AspMenu标记的****MaximumDynamicDisplayLevels**属性从 1 设置为所需的级别。

 **你会得到这个结果：

[![子站点](https://i.stack.imgur.com/YJlPa.gif)](https://i.stack.imgur.com/YJlPa.gif)
[（来源：[heathersolomon.com](http://www.heathersolomon.com/images/postimages/sampledropnav2levels.gif)）]

# visual-studio - Visual Studio 2008 Object Test Bench 有什么用处吗？

> ID：273406
> 
> 赞同：2
> 
> 时间：2008-11-07T19:49:21.197
> 
> 标签：visual-studio, visual-studio-2008, object-test-bench

Visual Studio 2008 Object Test Bench 有什么用处吗？也许我遗漏了一些东西，但除了即时窗口的华丽版本之外，似乎开发人员实际上不会将它用于任何事情。

*（有多少人一开始就知道它的存在？！）*

如果您想知道，“对象测试台”位于 Visual Studio 2008 中的“查看/其他窗口”下。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:05:00.370

直到你提到它，我才听说过它——谢谢你让我注意到它。

我认为它很有用。如果我想看看“东西”是如何工作的，我通常会将我的代码放到 LINQPad 中，看看通过对结果对象执行 Dump() 得到什么样的结果。唯一的问题是，你必须复制你的整个班级和支持班级，才能得到比琐碎的东西更重要的工作。此外，LINQPad 中没有智能感知。

这看起来可以取代我使用 LINQPad 的功能。快速而肮脏地玩弄物体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T19:53:30.703

IIRC，您可以将它用于负载/压力测试，但我唯一接触它的是在 VS2005 的 Ready To Launch 活动中的快速演示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T20:30:37.493

Object Test Bench 非常适合对代码进行单元测试，而且非常轻量级。它也存在于VS2005中。我更喜欢功能更强大的NUNIT

# arrays - 我的数组中有多少维或得到最后一个

> ID：273410
> 
> 赞同：3
> 
> 时间：2008-11-07T19:49:40.790
> 
> 标签：arrays, asp-classic, vbscript

如何在 Classic ASP (VBScript) 中找出数组中的维数。

我正在传递一个具有多个维度的数组，但我只想看最后一个。在其他语言中似乎很容易。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T20:04:40.667

```
Ubound(MySingleDimensionalArray, 2) ' Number of Array Elements

Ubound(MyMultiDimensionalArray, 1)  ' Number of Columns
Ubound(MyMultiDimensionalArray, 2)  ' Number of Rows 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-27T16:00:19.643

与 feihtthief 的回答类似，因为我认为这是您想要的，而不是指定维度的大小。

```
Function NumDimensions(arr)
    Dim dimensions : dimensions = 0
    On Error Resume Next
    Do While Err.number = 0
        dimensions = dimensions + 1
        UBound arr, dimensions
    Loop
    On Error Goto 0
    NumDimensions = dimensions - 1
End Function 
```

然后这样称呼它：

```
Dim test(9, 5, 4, 3, 9, 1, 3, 5)
NumDimensions(test) 
```

会给你价值8

这有点糟糕，但它会按照你的要求做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T20:40:06.647

```
function ArrayDimensions( theArray )
    dim Result,test
    Result = 0
    if isarray(theArray) then
        on error resume next
            do
                test = -2
                test = ubound(theArray,result+1)
                if test > -2 then result = result + 1
            loop until test=-2
        on error goto 0
    end if
    ArrayDimensions = Result
end function 
```

# nhibernate - NHibernate 和查询优化

> ID：273416
> 
> 赞同：1
> 
> 时间：2008-11-07T19:51:56.450
> 
> 标签：nhibernate

我使用 NHibernate 作为我的 ORM 解决方案，并且需要返回与我的原始对象不同的高度专业化的对象（出于性能原因）。

使用自己的映射文件实际设置第二个对象是否有效，以便我可以设置特殊的连接获取和设置批量大小等等？2个类可以指向同一张表吗？尝试对原始对象进行更新时，这会导致一些奇怪的结果吗？

我应该尝试在运行时为此获取计划设置参数吗？

也许使用存储过程来完成这个？

这个对象结构很复杂，涉及遍历集合的集合，我试图消除原始对象的繁琐。我喜欢选项 1 的声音，因为它似乎最容易配置和启动。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T20:19:07.190

你能举例说明你正在尝试做什么吗？这个问题有很多解决方案。

在不了解更多信息的情况下，我可能会说您正在寻找自定义 ResultTransformers。

您可以在此处查看用于部分对象查询的示例：

[http://ayende.com/Blog/archive/2007/08/26/Partial-Object-Queries-With-NHibernate.aspx](http://ayende.com/Blog/archive/2007/08/26/Partial-Object-Queries-With-NHibernate.aspx)

# asp.net - 当我的服务器没有并且无法安装 ASP.NET AJAX 扩展时，有什么方法可以使用 ASP.NET AJAX？

> ID：273418
> 
> 赞同：2
> 
> 时间：2008-11-07T19:52:36.307
> 
> 标签：asp.net, asp.net-ajax

我有一台安装了 .Net 2.0 sp1 的服务器，但无法在服务器上安装 AJAX 扩展。

无论如何我可以解决这个问题来合并 ASP.NET AJAX 功能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T19:57:07.030

您不需要将 AJAX 扩展安装到服务器的 GAC 中。

您可以从您的应用程序 BIN 文件夹中本地引用 System.Web.Extensions.dll....我已经完成了六次。

将该 DLL 复制到您的项目本地 bin。从您的项目中引用它。请记住在部署时部署 DLL，并且您已设置好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T20:13:16.780

AJAX 调用总是有原型和 jQuery。

尽管 Jonathan Hollands 坚持不懈（以及他对其他所有人的响应投反对票），但这两者对于向服务器进行 Ajax 调用都是完全有效的。

[MS 现在将 jQuery 与 Visual Studio 打包在一起](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx)，因此不存在互操作性问题。

请记住，服务器不知道在客户端创建的控件，您必须采取额外的步骤将任何数据（通过 ajax 调用）持久化到服务器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T19:55:10.980

如果您无法安装 AJAX 扩展，则必须自己管理 AJAX 调用。这绝对是可能的，因为 AJAX 扩展只是包装了 AJAX 的肉。阅读 XMLHttpRequest，你会发现很多例子。

这是一个带有示例的好网站。 [http://www.fiftyfoureleven.com/resources/programming/xmlhttprequest/examples](http://www.fiftyfoureleven.com/resources/programming/xmlhttprequest/examples)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T20:07:50.533

请注意，大多数 AJAX 是在客户端（在浏览器中）用 Javascript 完成的。

虽然有一些服务器端库可以更轻松地响应 AJAX 查询，但在大多数情况下它们是不必要的。任何可以将网页提供给浏览器的服务器技术也可以处理 AJAX 请求。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T20:13:44.313

Microsoft ASP.NET AJAX 不是实现 AJAX 功能的唯一方法。 [jQuery](http://jquery.com/)和[Prototype](http://www.prototypejs.org/)是两个流行的用于 AJAX 的 JavaScript 库，无论服务器平台如何。

如果您 100% 绑定到 Microsoft ASP.NET AJAX，那么您可能需要[下载](http://www.asp.net/ajax/)它并将 DLL 手动安装到您的本地项目中。

# excel - Excel 自动化。需要从范围中选择多个项目

> ID：273425
> 
> 赞同：2
> 
> 时间：2008-11-07T19:55:04.447
> 
> 标签：excel, automation, ole, dsoframer

我有代码可以让我在一个范围内选择一个项目：

```
 COleVariant vItems = cstrAddr;
        hr = AutoWrap(
                            DISPATCH_PROPERTYGET, 
                            &vCell, 
                            irange, 
                            L"Item", 
                            2,
                            COleVariant((short)(1)), 
                            COleVariant((short)(1)));
        if (FAILED(hr)) return hr;

        // Use the dispatch interface to select the cell
        COleVariant result;
        hr = AutoWrap(
                        DISPATCH_METHOD, 
                        &result, 
                        vCell.pdispVal, 
                        L"Select", 
                        0);
        if (FAILED(hr)) return hr; 
```

这工作正常。但是，我需要选择范围内的所有单元格，但我无法找到一种方法来在 Item 属性的“get”调用中指定它。尝试使用 -1,-1... 尝试在 2 个变体中传入一对 bstr，指定以冒号分隔的列范围和行范围；还尝试传入范围规范字符串的单个参数。没有工作。

**更新**：我也试过

```
hr = iRange->Select(vResult); 
```

这确实返回 S_OK，但它不选择范围。通常，我不能直接调用 iRange 结构中的函数；结果是 gpf 或访问冲突——所以我必须使用 autowrap 函数（来驱动 Invoke 调用）。我对这个电话不起作用并不感到惊讶。希望我能得到这个工作......这是这个项目的最后一部分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T20:25:01.843

不熟悉那种代码（在 VB 中，自动化要容易得多） 我认为在您的示例中，您正在使用 Item 属性和 Select 方法从范围中选择一个单元格。正确的？

所以在VB中

```
Dim oRange as Range
Dim oCell as Range

 Set oRange = WorkSheet.Range("A1:A10") '<-- get range
 Set oCell = oRange.Item(1)             '<-- returns first cell in range
 oCell.Select                           '<-- selects first cell 
```

问题是 Item 属性只返回一个单元格 - 您必须将 Select 方法应用于原始范围。

```
Dim oRange as Range

 Set oRange = WorkSheet.Range("A1:A10") '<-- get range
 oRange.Select                          '<-- Selects the range 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T19:20:43.693

I found the answer to this question. This only appears to be a problem when used in the DSOFRAMER sample (Microsoft KB 311765). DSOFramer is a general purpose ActiveX control for embedding MS Office documents. The problem also only happens in a debug build; release builds are fine.

I also found a workaround that works on release or debug build: get any cell in the range (using get_Item), then call select on that item, then select again to de-select it. Once that's done, the select can be called on the range. Apparently, select cannot be called on the range if there is a cell already selected (or perhaps if the selection state is undefined).

# .htaccess - .htaccess 重定向

> ID：273433
> 
> 赞同：1
> 
> 时间：2008-11-07T19:57:13.223
> 
> 标签：.htaccess, redirect, directory, subdomain

我一直在谷歌搜索 .htaccess 重定向信息，但我发现没有什么是我正在寻找的。

基本上，我想要一个解决方案，它将采用站点 example.com 并允许您输入 URL，例如：

```
 123.example.com
 ksdfkjds.example.com
 dsf38jif348.example.com 
```

这会将他们重定向到：

```
 example.com/123
 example.com/ksdfkjds
 example.com/dsf38jif348 
```

所以基本上接受任何子域并自动重定向到具有该子域名称的域根目录上的文件夹。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:05:11.303

尝试这样的事情：

```
# If we're not on http://example.com
RewriteCond %{HTTP_HOST} .+\.example.com

# Add the host to the front of the URL and chain with the next rule
RewriteRule ^(.*)$ ${HOST}$1 [C,QSA]

# Make the host a directory
RewriteRule ^(.*)\.example\.com(.*)$ http://example.com/$1$2 [QSA] 
```

你没有说[http://foo.example.com/bar?moo](http://foo.example.com/bar?moo)应该发生什么- 我已经把它转到[http://example.com/foo/bar?moo](http://example.com/foo/bar?moo) 如果不是，请更改最后一行你想要什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T11:57:17.193

如果你只是想让它们成为入口：

```
RewriteCond %{HTTP_HOST} ^([^.]+)\.example\.com$
RewriteRule ^ http://example.com/%1 [L,R] 
```

否则：

```
RewriteCond %{HTTP_HOST} ^([^.]+)\.example\.com$
RewriteRule ^ /%1%{REQUEST_URI} [L] 
```

# mysql - 你如何调试 MySQL 存储过程？

> ID：273437
> 
> 赞同：141
> 
> 时间：2008-11-07T19:58:12.940
> 
> 标签：mysql, database, debugging, stored-procedures

我目前调试存储过程的过程非常简单。我创建了一个名为“debug”的表，在存储过程运行时在其中插入变量值。这允许我在脚本中的给定点查看任何变量的值，但是有更好的方法来调试 MySQL 存储过程吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2013-03-28T17:08:13.903

`debug_msg`可以调用以下过程来简单地将调试消息输出到控制台：

```
DELIMITER $$

DROP PROCEDURE IF EXISTS `debug_msg`$$
DROP PROCEDURE IF EXISTS `test_procedure`$$

CREATE PROCEDURE debug_msg(enabled INTEGER, msg VARCHAR(255))
BEGIN
  IF enabled THEN
    select concat('** ', msg) AS '** DEBUG:';
  END IF;
END $$

CREATE PROCEDURE test_procedure(arg1 INTEGER, arg2 INTEGER)
BEGIN
  SET @enabled = TRUE;

  call debug_msg(@enabled, 'my first debug message');
  call debug_msg(@enabled, (select concat_ws('','arg1:', arg1)));
  call debug_msg(TRUE, 'This message always shows up');
  call debug_msg(FALSE, 'This message will never show up');
END $$

DELIMITER ; 
```

然后像这样运行测试：

```
CALL test_procedure(1,2) 
```

它将导致以下输出：

```
** DEBUG:
** my first debug message
** DEBUG:
** arg1:1
** DEBUG:
** This message always shows up 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-11-21T18:32:19.280

我做的事情和你很相似。

我通常会包含一个默认为 false 的 DEBUG 参数，我可以在运行时设置为 true。然后将调试语句包装到“If DEBUG”块中。

我还在我的许多工作中使用了一个日志表，以便我可以查看流程和时间安排。我的调试代码也在那里得到输出。我包括调用参数名称、简要说明、受影响的行数（如果适用）、注释字段和时间戳。

好的调试工具是所有 SQL 平台的可悲失败之一。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2013-12-24T05:09:56.027

**如何调试 MySQL 存储过程。**

可怜的人调试器：

1.  创建一个名为 logtable 的表，其中包含两列，`id INT`并且`log VARCHAR(255)`.

2.  使 id 列自动递增。

3.  使用此过程：

    ```
    delimiter //
    DROP PROCEDURE `log_msg`//
    CREATE PROCEDURE `log_msg`(msg VARCHAR(255))
    BEGIN
        insert into logtable select 0, msg;
    END 
    ```

4.  将此代码放在您想要将消息记录到表中的任何位置。

    ```
    call log_msg(concat('myvar is: ', myvar, ' and myvar2 is: ', myvar2)); 
    ```

这是一个很好的快速而肮脏的小记录器，可以弄清楚发生了什么。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2010-03-26T07:27:27.087

是的，有一个专门的工具来处理这种事情[——MySQL Debugger](http://www.mydebugger.com)。
![在此处输入图像描述](https://i.stack.imgur.com/YXN6m.png)

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2010-08-31T08:40:00.387

MySQL中有用于调试存储过程/函数和脚本的[GUI工具。](http://www.devart.com/dbforge/mysql/studio/code-debugger.html)dbForge Studio for MySQL 是一款不错的工具，具有丰富的功能和稳定性。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-02-23T20:42:12.303

mysql 的调试器很好，但不是免费的。这就是我现在使用的：

```
DELIMITER GO$

DROP PROCEDURE IF EXISTS resetLog

GO$

Create Procedure resetLog() 
BEGIN   
    create table if not exists log (ts timestamp default current_timestamp, msg varchar(2048)) engine = myisam; 
    truncate table log;
END; 

GO$

DROP PROCEDURE IF EXISTS doLog 

GO$

Create Procedure doLog(in logMsg nvarchar(2048))
BEGIN  
  insert into log (msg) values(logMsg);
END;

GO$ 
```

存储过程中的用法：

```
call dolog(concat_ws(': ','@simple_term_taxonomy_id',  @simple_term_taxonomy_id)); 
```

存储过程的用法：

```
call resetLog ();
call stored_proc();
select * from log; 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2012-06-21T11:54:08.453

这里介绍了另一种方式

[http://gilfster.blogspot.co.at/2006/03/debugging-stored-procedures-in-mysql.html](http://gilfster.blogspot.co.at/2006/03/debugging-stored-procedures-in-mysql.html)

使用自定义调试 mySql 过程和日志记录表。

您也可以在代码中放置一个简单的选择，然后查看它是否被执行。

```
SELECT 'Message Text' AS `Title`; 
```

我从

[http://forums.mysql.com/read.php?99,78155,78225#msg-78225](http://forums.mysql.com/read.php?99,78155,78225#msg-78225)

也有人在 GitHub 上为自定义调试程序创建了一个模板。

看这里

[http://www.bluegecko.net/mysql/debugging-stored-procedures/](http://www.bluegecko.net/mysql/debugging-stored-procedures/) [https://github.com/CaptTofu/Stored-procedure-debugging-routines](https://github.com/CaptTofu/Stored-procedure-debugging-routines)

这里提到过

[如何在 mysql 的触发器和存储过程中捕获任何异常？](https://stackoverflow.com/questions/6908453/how-to-catch-any-exception-in-triggers-and-store-procedures-for-mysql)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2016-03-07T01:39:12.843

我参加聚会迟到了，但带了更多啤酒：

[http://ocelot.ca/blog/blog/2015/03/02/the-ocelotgui-debugger/](http://ocelot.ca/blog/blog/2015/03/02/the-ocelotgui-debugger/) 和 [https://github.com/ocelot-inc/ocelotgui](https://github.com/ocelot-inc/ocelotgui)

我试过了，看起来很稳定，支持断点和变量检查。

它不是一个完整的套件（只有 4,1 Mb），但对我帮助很大！

它是如何工作的：它与您的 mysql 客户端集成（我使用的是 Ubuntu 14.04），并且在您执行之后：

```
$install
$setup yourFunctionName 
```

它会在您的服务器上安装一个新数据库，用于控制调试过程。所以：

```
$debug yourFunctionName('yourParameter') 
```

将使您有机会一步一步地走您的代码，并“刷新”您的变量，您可以更好地查看代码中发生的事情。

*重要提示：在调试时，也许你会改变（重新创建程序）。重新创建后，在新的 $debug 之前执行：$exit 和 $setup*

这是“插入”和“记录”方法的替代方法。您的代码没有额外的“调试”指令。

截屏：

[![ocelot断点步进](https://i.stack.imgur.com/p5YQq.jpg)](https://i.stack.imgur.com/p5YQq.jpg)

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-11-07T20:24:47.380

我只是简单地将 select 语句放在存储过程的关键区域以检查数据集的当前状态，然后将它们注释掉（--select...）或在生产前将它们删除。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-12-24T13:33:51.430

MySQL Connector/Net 6.6 具有[调试存储过程和函数的功能](https://dev.mysql.com/doc/connector-net/en/connector-net-visual-studio-debugger.html)

> **安装调试器**
> 
> 要启用存储过程调试器：
> 
> *   对于 Connector/Net 6.6：安装 Connector/Net 6.6 并选择 Complete 选项。
> *   对于 Connector/Net 6.7 及更高版本：安装存储过程调试器所属的产品 MySQL for Visual Studio。
> 
> **启动调试器**
> 
> 要启动调试器，请执行以下步骤：
> 
> *   在 Visual Studio 服务器资源管理器中选择一个连接。
> *   展开存储过程文件夹。只有存储过程可以直接调试。要调试用户定义的函数，请创建一个
>     调用该函数的存储过程。
> *   单击存储过程节点，然后右键单击并从上下文菜单中选择调试例程。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-08-07T20:53:10.330

MySql Connector/NET 还包括从 6.6 版开始集成在 Visual Studio 中的存储过程调试器，您可以在此处获取安装程序和源代码：http: [//dev.mysql.com/downloads/connector/net/](http://dev.mysql.com/downloads/connector/net/)

一些文档/截图： [https ://dev.mysql.com/doc/visual-studio/en/visual-studio-debugger.html](https://dev.mysql.com/doc/visual-studio/en/visual-studio-debugger.html)

您可以在此处关注公告：http://forums.mysql.com/read.php?38,561817,561817#msg- [561817](http://forums.mysql.com/read.php?38,561817,561817#msg-561817)

更新：用于 Visual Studio 的 MySql 已从 Connector/NET 拆分为单独的产品，您可以从此处[https://dev.mysql.com/downloads/windows/visualstudio/1.2.html](https://dev.mysql.com/downloads/windows/visualstudio/1.2.html)选择它（包括调试器） （仍然免费和开源）。

免责声明：我是为 MySQL for Visual Studio 产品编写存储过程调试器引擎的开发人员。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-09-22T10:20:00.743

第一个稳定的 MySQL 调试器位于 dbForge Studio for MySQL

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-12-23T17:46:20.130

我曾使用两种不同的工具来调试程序和功能：

1.  dbForge - 许多功能性的 mysql GUI。
2.  MyDebugger - 专门的调试工具...方便的调试工具。[投票 http://tinyurl.com/voteimg](http://tinyurl.com/voteimg)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-10-18T01:35:55.553

MySQL 用户定义变量（在会话中共享）可以用作日志输出：

```
DELIMITER ;;
CREATE PROCEDURE Foo(tableName VARCHAR(128))
BEGIN
  SET @stmt = CONCAT('SELECT * FROM ', tableName);
  PREPARE pStmt FROM @stmt;
  EXECUTE pStmt;
  DEALLOCATE PREPARE pStmt;
  -- uncomment after debugging to cleanup
  -- SET @stmt = null;
END;;
DELIMITER ; 
```

```
call Foo('foo');
select @stmt; 
```

将输出：

```
SELECT * FROM foo 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-03-28T17:51:46.720

蟾蜍mysql。有一个免费版本 [http://www.quest.com/toad-for-mysql/](http://www.quest.com/toad-for-mysql/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-11-10T09:04:12.147

@Brad Parks与[此](https://stackoverflow.com/questions/273437/how-do-you-debug-mysql-stored-procedures#15687954)相对应的答案不确定 MySQL 版本，但我的是 5.6，因此稍作调整即可：

我创建了一个函数`debug_msg`，它是函数（不是过程）并返回文本（无字符限制），然后将该函数调用为 SELECT `debug_msg`(params) AS `my_res_set`，代码如下：

```
CREATE DEFINER=`root`@`localhost` FUNCTION `debug_msg`(`enabled` INT(11), `msg` TEXT) RETURNS text CHARSET latin1
    READS SQL DATA
BEGIN
    IF enabled=1 THEN
    return concat('** DEBUG:', "** ", msg);
    END IF;
END

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `proc_func_call`(
 IN RegionID VARCHAR(20),
 IN RepCurrency INT(11),
 IN MGID INT(11),
 IN VNC VARCHAR(255)
)
BEGIN
    SET @enabled = TRUE;
    SET @mainQuery = "SELECT * FROM Users u";
    SELECT `debug_msg`(@enabled, @mainQuery) AS `debug_msg1`;
    SET @lastQuery = CONCAT(@mainQuery, " WHERE u.age>30);
    SELECT `debug_msg`(@enabled, @lastQuery) AS `debug_msg2`;
END $$
DELIMITER 
```

# c# - 如何忽略asp.net表单中的路由url路由

> ID：273447
> 
> 赞同：23
> 
> 时间：2008-11-07T20:01:32.700
> 
> 标签：c#, asp.net, url-routing, axd, ignoreroute

我正在使用 .NET 3.5 SP1 框架，并且在我的应用程序中实现了 URL 路由。我收到了 javascript 错误：

`Error: ASP.NET Ajax client-side framework failed to load.
Resource interpreted as script but transferred with MIME type text/html.
ReferenceError: Can't find variable: Sys`

我相信这是因为我的路由选择了 microsoft axd 文件并且没有正确发送 javascript。我做了一些研究，发现我可以使用`Routes.IgnoreRoute`，这应该允许我忽略下面的 axd：

```
Routes.IgnoreRoute("{resource}.axd/{*pathInfo}"); 
```

但是，当我将该行添加到我的 Global.asax 时，我收到了这个错误：

`CS1061: 'System.Web.Routing.RouteCollection' does not contain a definition for 'IgnoreRoute' and no extension method 'IgnoreRoute' accepting a first argument of type 'System.Web.Routing.RouteCollection' could be found (are you missing a using directive or an assembly reference?)`

我已经`System.Web.Routing`导入了命名空间，有什么想法吗？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-09T15:47:37.890

您不需要参考 ASP.NET MVC。您可以使用实现 IRouteHandler的[StopRoutingHandler ，如下所示：](http://msdn.microsoft.com/en-us/library/system.web.routing.stoproutinghandler.aspx)

```
routes.Add(new Route("{resource}.axd/{*pathInfo}", new StopRoutingHandler())); 
```

这是 .NET 3.5 SP1 的一部分，不需要 MVC。IgnoreRoutes 方法是一种方便的扩展方法，它是 ASP.NET MVC 的一部分。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-25T13:02:49.377

一个老问题，但如果它仍然可以帮助任何人，这对我有用：

```
routes.Ignore("{resource}.axd/{*pathInfo}"); 
```

“Ignore”方法存在，而在标准 ASP.NET 中“IgnoreRoute”方法似乎不存在（即，不使用 MVC）。这将达到与 Haacked 的代码相同的结果，但稍微干净一些......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-05T22:54:59.567

我想补充一点，您还需要确保您的 IgnoreRoutes 规则的顺序正确，否则您的第一个路由将首先应用，而您的 IgnoreRoute 将...被忽略。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T20:09:21.950

MapRoute 和 IgnoreRoute 是 System.Web.Mvc 中的扩展方法 --- 您是否正确引用了该程序集？

# ios - iPhone：检测自上次屏幕触摸以来的用户不活动/空闲时间

> ID：273450
> 
> 赞同：154
> 
> 时间：2008-11-07T20:02:59.233
> 
> 标签：ios, objective-c, iphone, idle-timer

有没有人实现了一个功能，如果用户在一段时间内没有触摸屏幕，你会采取某种行动？我试图找出最好的方法来做到这一点。

UIApplication 中有这个有点相关的方法：

```
[UIApplication sharedApplication].idleTimerDisabled; 
```

如果你有这样的东西会很好：

```
NSTimeInterval timeElapsed = [UIApplication sharedApplication].idleTimeElapsed; 
```

然后我可以设置一个计时器并定期检查这个值，并在它超过阈值时采取一些措施。

希望这能解释我在寻找什么。有没有人已经解决了这个问题，或者对你将如何做有任何想法？谢谢。

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-11-21T17:20:34.183

这是我一直在寻找的答案：

让您的应用程序委托子类 UIApplication。在实现文件中，重写 sendEvent: 方法，如下所示：

```
- (void)sendEvent:(UIEvent *)event {
    [super sendEvent:event];

    // Only want to reset the timer on a Began touch or an Ended touch, to reduce the number of timer resets.
    NSSet *allTouches = [event allTouches];
    if ([allTouches count] > 0) {
        // allTouches count only ever seems to be 1, so anyObject works here.
        UITouchPhase phase = ((UITouch *)[allTouches anyObject]).phase;
        if (phase == UITouchPhaseBegan || phase == UITouchPhaseEnded)
            [self resetIdleTimer];
    }
}

- (void)resetIdleTimer {
    if (idleTimer) {
        [idleTimer invalidate];
        [idleTimer release];
    }

    idleTimer = [[NSTimer scheduledTimerWithTimeInterval:maxIdleTime target:self selector:@selector(idleTimerExceeded) userInfo:nil repeats:NO] retain];
}

- (void)idleTimerExceeded {
    NSLog(@"idle time exceeded");
} 
```

其中 maxIdleTime 和 idleTimer 是实例变量。

为了让它工作，你还需要修改你的 main.m 来告诉 UIApplicationMain 使用你的委托类（在这个例子中，AppDelegate）作为主体类：

```
int retVal = UIApplicationMain(argc, argv, @"AppDelegate", @"AppDelegate"); 
```

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2011-03-11T06:54:03.587

我有一个空闲计时器解决方案的变体，它不需要子类化 UIApplication。它适用于特定的 UIViewController 子类，因此如果您只有一个视图控制器（如交互式应用程序或游戏可能有）或只想处理特定视图控制器中的空闲超时，它很有用。

每次重置空闲计时器时，它也不会重新创建 NSTimer 对象。如果计时器触发，它只会创建一个新的。

您的代码可以调用`resetIdleTimer`可能需要使空闲计时器无效的任何其他事件（例如重要的加速度计输入）。

```
@interface MainViewController : UIViewController
{
    NSTimer *idleTimer;
}
@end

#define kMaxIdleTimeSeconds 60.0

@implementation MainViewController

#pragma mark -
#pragma mark Handling idle timeout

- (void)resetIdleTimer {
    if (!idleTimer) {
        idleTimer = [[NSTimer scheduledTimerWithTimeInterval:kMaxIdleTimeSeconds
                                                      target:self
                                                    selector:@selector(idleTimerExceeded)
                                                    userInfo:nil
                                                     repeats:NO] retain];
    }
    else {
        if (fabs([idleTimer.fireDate timeIntervalSinceNow]) < kMaxIdleTimeSeconds-1.0) {
            [idleTimer setFireDate:[NSDate dateWithTimeIntervalSinceNow:kMaxIdleTimeSeconds]];
        }
    }
}

- (void)idleTimerExceeded {
    [idleTimer release]; idleTimer = nil;
    [self startScreenSaverOrSomethingInteresting];
    [self resetIdleTimer];
}

- (UIResponder *)nextResponder {
    [self resetIdleTimer];
    return [super nextResponder];
}

- (void)viewDidLoad {
    [super viewDidLoad];
    [self resetIdleTimer];
}

@end 
```

（为简洁起见，排除了内存清理代码。）

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2017-05-12T14:20:05.207

对于 swift v 3.1

不要忘记在 AppDelegate **//@UIApplicationMain中注释这一行**

```
extension NSNotification.Name {
   public static let TimeOutUserInteraction: NSNotification.Name = NSNotification.Name(rawValue: "TimeOutUserInteraction")
}

class InterractionUIApplication: UIApplication {

static let ApplicationDidTimoutNotification = "AppTimout"

// The timeout in seconds for when to fire the idle timer.
let timeoutInSeconds: TimeInterval = 15 * 60

var idleTimer: Timer?

// Listen for any touch. If the screen receives a touch, the timer is reset.
override func sendEvent(_ event: UIEvent) {
    super.sendEvent(event)

    if idleTimer != nil {
        self.resetIdleTimer()
    }

    if let touches = event.allTouches {
        for touch in touches {
            if touch.phase == UITouchPhase.began {
                self.resetIdleTimer()
            }
        }
    }
}

// Resent the timer because there was user interaction.
func resetIdleTimer() {
    if let idleTimer = idleTimer {
        idleTimer.invalidate()
    }

    idleTimer = Timer.scheduledTimer(timeInterval: timeoutInSeconds, target: self, selector: #selector(self.idleTimerExceeded), userInfo: nil, repeats: false)
}

// If the timer reaches the limit as defined in timeoutInSeconds, post this notification.
func idleTimerExceeded() {
    NotificationCenter.default.post(name:Notification.Name.TimeOutUserInteraction, object: nil)
   }
} 
```

> 创建 main.swif 文件并添加它（名称很重要）

```
CommandLine.unsafeArgv.withMemoryRebound(to: UnsafeMutablePointer<Int8>.self, capacity: Int(CommandLine.argc)) {argv in
_ = UIApplicationMain(CommandLine.argc, argv, NSStringFromClass(InterractionUIApplication.self), NSStringFromClass(AppDelegate.self))
} 
```

在任何其他类中观察通知

```
NotificationCenter.default.addObserver(self, selector: #selector(someFuncitonName), name: Notification.Name.TimeOutUserInteraction, object: nil) 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-04-14T16:14:37.950

这个线程很有帮助，我将它封装到一个发送通知的 UIWindow 子类中。我选择通知是为了让它成为真正的松耦合，但你可以很容易地添加一个委托。

这是要点：

[http://gist.github.com/365998](http://gist.github.com/365998)

此外，UIApplication 子类问题的原因是，NIB 设置为创建 2 个 UIApplication 对象，因为它包含应用程序和委托。UIWindow 子类虽然效果很好。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-08-27T01:16:32.053

实际上，子类化的想法很有效。只是不要让你的代表成为`UIApplication`子类。创建另一个继承自`UIApplication`（例如 myApp）的文件。在 IB 中将`fileOwner`对象的类设置为`myApp`并在 myApp.m 中实现上述`sendEvent`方法。在 main.m 中：

```
int retVal = UIApplicationMain(argc,argv,@"myApp.m",@"myApp.m") 
```

等等！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-02-06T08:57:59.993

我刚刚在一个由动作控制的游戏中遇到了这个问题，即禁用了屏幕锁定，但在菜单模式下应该再次启用它。我没有使用计时器，而是将所有调用封装`setIdleTimerDisabled`在一个提供以下方法的小类中：

```
- (void) enableIdleTimerDelayed {
    [self performSelector:@selector (enableIdleTimer) withObject:nil afterDelay:60];
}

- (void) enableIdleTimer {
    [NSObject cancelPreviousPerformRequestsWithTarget:self];
    [[UIApplication sharedApplication] setIdleTimerDisabled:NO];
}

- (void) disableIdleTimer {
    [NSObject cancelPreviousPerformRequestsWithTarget:self];
    [[UIApplication sharedApplication] setIdleTimerDisabled:YES];
} 
```

`disableIdleTimer`停用空闲计时器，`enableIdleTimerDelayed`当进入菜单或任何应该在空闲计时器激活的情况下运行并`enableIdleTimer`从您的 AppDelegate 的`applicationWillResignActive`方法调用以确保您的所有更改都正确重置为系统默认行为时。
写了一篇文章，提供了[iPhone Games 中单例类 IdleTimerManager 空闲定时器处理的代码](http://www.scio.de/en/blog-a-news/scio-development-blog-en/entry/idle-timer-handling-in-iphone-games)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-13T18:32:28.490

这是检测活动的另一种方法：

计时器被添加在 中，因此只有在有活动`UITrackingRunLoopMode`时才能触发。`UITracking`它还有一个很好的优势，即不会为所有触摸事件向您发送垃圾邮件，从而通知您在最后`ACTIVITY_DETECT_TIMER_RESOLUTION`几秒钟内是否有活动。我命名了选择器`keepAlive`，因为它似乎是一个合适的用例。您当然可以根据最近有活动的信息做任何您想做的事情。

```
_touchesTimer = [NSTimer timerWithTimeInterval:ACTIVITY_DETECT_TIMER_RESOLUTION
                                        target:self
                                      selector:@selector(keepAlive)
                                      userInfo:nil
                                       repeats:YES];
[[NSRunLoop mainRunLoop] addTimer:_touchesTimer forMode:UITrackingRunLoopMode]; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-08-03T23:19:44.270

有一种方法可以在整个应用程序范围内执行此应用程序，而无需单个控制器执行任何操作。只需添加一个不会取消触摸的手势识别器。这样，所有的触摸都会被计时器跟踪，而其他触摸和手势根本不会受到影响，因此其他人不必知道它。

```
fileprivate var timer ... //timer logic here

@objc public class CatchAllGesture : UIGestureRecognizer {
    override public func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent) {
        super.touchesBegan(touches, with: event)
    }
    override public func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent) {
        //reset your timer here
        state = .failed
        super.touchesEnded(touches, with: event)
    }
    override public func touchesMoved(_ touches: Set<UITouch>, with event: UIEvent) {
        super.touchesMoved(touches, with: event)
    }
}

@objc extension YOURAPPAppDelegate {

    func addGesture () {
        let aGesture = CatchAllGesture(target: nil, action: nil)
        aGesture.cancelsTouchesInView = false
        self.window.addGestureRecognizer(aGesture)
    }
} 
```

在您的应用程序委托的完成启动方法中，只需调用 addGesture 即可。所有触摸都将通过 CatchAllGesture 的方法进行，而不会妨碍其他人的功能。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-07T21:15:08.340

最终，您需要定义您认为空闲的内容 - 空闲是用户未触摸屏幕的结果还是系统状态（如果没有使用计算资源）？在许多应用程序中，即使用户没有通过触摸屏主动与设备交互，用户也有可能正在做某事。虽然用户可能熟悉设备进入睡眠状态的概念并注意到它将通过屏幕变暗发生，但他们不一定会期望在空闲时发生某些事情 - 你需要小心关于你会做什么。但回到最初的陈述——如果你认为第一种情况是你的定义，那么没有真正简单的方法可以做到这一点。您需要接收每个触摸事件，根据需要在响应者链上传递它，同时注意它的接收时间。这将为您进行空闲计算提供一些基础。如果您认为第二种情况是您的定义，您可以使用 NSPostWhenIdle 通知来尝试在那时执行您的逻辑。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-01-27T12:52:09.393

外面是 2021 年，我想分享我在不扩展 UIApplication 的情况下处理这个问题的方法。我不会描述如何创建计时器并重置它。而是如何捕捉所有事件。所以你的 AppDelegate 从这个开始：

```
@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
    var window: UIWindow? 
```

所以你需要做的就是继承 UIWindow 并覆盖`sendEvent`，如下所示

```
import UIKit

class MyWindow: UIWindow {

    override func sendEvent(_ event: UIEvent){
        super.sendEvent(event)
        NSLog("Application received an event. Do whatever you want")
    }
} 
```

然后用我们的类创建窗口：

```
self.window = MyWindow(frame: UIScreen.main.bounds) 
```

# c# - 我应该使用哪个平台：原生 C++ 或 C#？

> ID：273451
> 
> 赞同：6
> 
> 时间：2008-11-07T20:03:06.503
> 
> 标签：c#, c++, user-interface, mfc

我想开发一个 Windows 应用程序。如果我使用本机 C++ 和 MFC 作为用户界面，那么应用程序将非常快速且小巧。但是使用 MFC 非常复杂。此外，如果我使用 C#，那么应用程序将比本机代码慢，并且它需要 .NET 框架才能运行。但是使用 WinForm 开发 GUI 非常容易。你更倾向哪个？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-07T20:07:27.633

“快”和“慢”是主观的，尤其是对于今天的 PC。我并不是说故意让事情变慢，但是编写托管应用程序的开销*几乎*没有您想象的那么多。JIT 等可以很好地使代码执行得非常快。如果您确实需要，您还可以使用 NGEN 来提高启动速度。

实际上，如果您有时间学习它，您可能想要考虑 WPF 而不是 winform - 这是一个不同的技能组合，但可以让您很好地利用图形硬件等。

此外 - .NET 框架附带新的操作系统安装，并且在它之前的操作系统中仍然很常见。所以对我来说，使用 C#/.NET 开发将是一个相当明确的选择。开发一个*健壮且经过全面测试*的C++ 应用程序（没有泄漏等）的时间（至少对我而言）比使用 C# 的时间要长得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T20:07:44.763

注意不要过早优化；您提到了代码的速度，但对于大多数 Windows 用户界面操作，差异并不明显，因为两种方法的绘图和磁盘访问的主要瓶颈并没有什么不同。

我的建议是您的用户界面使用 C# 和 WPF 或 WinForms。如果您遇到一些减速，请使用分析器来确定在哪里，然后考虑用本机代码替换一些业务逻辑，但前提是有好处。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-07T20:09:52.917

有很多可能的 Windows 应用程序，每个应用程序都有自己的要求。

如果您的应用程序需要快速（而我的工作就是这样），那么原生 C++ 是一个不错的选择。

如果您的应用程序需要很小（也许是为了通过慢速线路进行真正的快速传输），那么请使用任何使它变小的应用程序。

如果您的应用程序可能会被大量下载，您可能希望对 .NET 的更高版本保持警惕，而您的用户可能还没有这些版本。

如果像大多数一样，它在可能使用的系统上足够快且足够小，请使用可以让您开发得最快和最好的东西。

在几乎所有情况下，优化的正确方法是开发人员的努力。使用任何可以最快、最好地完成高质量工作的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T21:53:53.757

首先..（虽然我是一个顽固的 c++ 编码器）我不得不承认 c# 在大多数情况下在速度和大小方面都非常好。在某些情况下，应用程序更小，因为解释的部分已经在目标系统上。（不要在那个上向我发送垃圾邮件，带有 dll 的应用程序比一体式应用程序小。Windows 恰好附带了已经存在的“DLL”。）

至于编码..老实说，我认为没有显着差异。我不会花很多时间输入代码。大部分是在思考一个问题。代码部分非常小。在这里和那里保存几行.. Blahh 这对我来说不是一个论点.. 如果是我会在 APL 工作。学习 STL、MFC 和你所拥有的东西可能与学习 c# 库一样密集。最后他们都是一样的。

C# 确实有一件事要做.. 一个市场。这是最新的“热门”技能，因​​此有市场。工作很容易找到。现在请记住，Java 在几年前是一项“热门”技能，现在汤姆迪克和哈利在他们的简历中都有它。这使得定位自己变得更加困难。

好吧..说了这么多..我喜欢C++ ..当我真的需要时，没有什么比弄脏更糟糕的了。当 MFC 库不做这项工作时，我会看看他们坐在什么上面等等等等。它是一种长期的语言，我相信它仍然处于或接近世界上最常用的语言。是的 c++，是的！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T20:11:49.700

另请注意，大多数 Windows 计算机上已经安装了 .NET，因此不必担心。

此外，除了 .NET 安装之外，.NET 应用程序往往非常小。

对于大多数带有 UI 的应用程序，用户的速度是真正限制时间的因素。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T20:07:44.327

C# 应用程序的启动速度比 MFC 应用程序慢，但是一旦加载应用程序，您可能不会注意到两者之间的速度差异。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T20:09:56.537

没有关于您计划开发的应用程序的信息，我投票支持 WPF。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-07T20:18:36.877

在我看来，这些要求应该可以帮助您决定平台。更重要的是：拥有一个易于维护的应用程序还是必须非常快速和小型的应用程序？

现在可以使用 .NET 和托管代码编写一大类应用程序，这通常有利于长期开发。根据我的经验，.NET 应用程序对于大多数用例来说通常足够快，而且它们更易于创建。Native C++ 仍然有它的用途，但只是为了“更快、更小”，当“足够快和足够小”就足够时，这听起来不足以成为理由。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-07T20:28:46.983

在这一点上，本机代码和托管代码之间的速度争论在很大程度上不是问题。.NET Framework 的每个版本都比以前的版本提高了性能，并且应用程序性能始终是 .NET 开发团队的首要任务。

从 Windows Vista 和 Windows Server 2008 开始，.NET Framework 作为操作系统的一部分安装。它也是 Windows Update 的一部分，因此几乎所有 Windows XP 系统都将安装它。如果在目标机器上安装框架的要求确实是一个很大的问题，那么还有一些编译器基本上会将所需的运行时部分嵌入到您的应用程序中以生成单个 exe，但它们很昂贵（在我看来，不值得付出代价）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-08T02:12:37.960

MFC并不难学，其实很容易。

几乎等于 C#。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-07T20:10:42.713

语言或工具的选择应由项目的功能和性能要求和专业知识决定。如果性能对您来说是一个真正的考虑因素，并且您已经进行了一些分析以更喜欢 C++ 而不是 C#，那么您已经做出了决定。请注意，尽管拥有基于 MFC 的应用程序也不是非常有效。另一方面，.NET 应用程序的开销被夸大了。

性能实际上取决于您编写代码的好坏以及存在的可伸缩性要求。如果您只需要使用一个最大数据库记录为 1K 的客户端，那么我们不应该谈论性能。

如果易于开发和可维护性更重要，那么 C# 肯定是首选。

所以我不确定这个问题是否可以根据您提供的数据作为选项 A 或 B 给出答案。您需要对功能和非功能需求进行分析并做出决定。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-07T20:26:46.033

> 此外，如果我使用 C#，那么应用程序将比本机代码慢，并且它需要 .NET 框架才能运行

MFC 应用程序需要 MFC dll 才能运行（可能还需要 VC 运行时！），因此可能需要安装它们，或者如果它们是静态链接的，则添加到 exe 的大小。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-07T20:28:50.070

> 块引用

.NET 更易于使用。除非您会因为使用它而失去用户或遇到代码迁移问题，否则您可能应该使用 .NET。速度极不可能成为这个问题。大小可能也没有那么重要。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-08T13:05:27.003

你更熟悉哪种技术？

您提供的信息不包括任何有助于决定的信息。是的，MFC 应用程序往往更小（如果您包括运行时大小，从长远来看这不是一个合适的衡量标准）、响应更快且开发成本更高。所以呢？

# c# - 在 C# 中使用 AES 加密

> ID：273452
> 
> 赞同：118
> 
> 时间：2008-11-07T20:03:12.370
> 
> 标签：c#, cryptography, aes, rijndaelmanaged

我似乎找不到使用 AES 128 位加密的干净示例。

有人有一些示例代码吗？

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-11-07T20:15:24.497

如果您只想使用内置的加密提供程序 RijndaelManaged，请查看以下帮助文章（它还有一个简单的代码示例）：

> [http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx)

以防万一您急需样品，这里是抄袭的荣耀：

```
using System;
using System.IO;
using System.Security.Cryptography;

namespace RijndaelManaged_Example
{
    class RijndaelExample
    {
        public static void Main()
        {
            try
            {

                string original = "Here is some data to encrypt!";

                // Create a new instance of the RijndaelManaged 
                // class.  This generates a new key and initialization  
                // vector (IV). 
                using (RijndaelManaged myRijndael = new RijndaelManaged())
                {

                    myRijndael.GenerateKey();
                    myRijndael.GenerateIV();
                    // Encrypt the string to an array of bytes. 
                    byte[] encrypted = EncryptStringToBytes(original, myRijndael.Key, myRijndael.IV);

                    // Decrypt the bytes to a string. 
                    string roundtrip = DecryptStringFromBytes(encrypted, myRijndael.Key, myRijndael.IV);

                    //Display the original data and the decrypted data.
                    Console.WriteLine("Original:   {0}", original);
                    Console.WriteLine("Round Trip: {0}", roundtrip);
                }

            }
            catch (Exception e)
            {
                Console.WriteLine("Error: {0}", e.Message);
            }
        }
        static byte[] EncryptStringToBytes(string plainText, byte[] Key, byte[] IV)
        {
            // Check arguments. 
            if (plainText == null || plainText.Length <= 0)
                throw new ArgumentNullException("plainText");
            if (Key == null || Key.Length <= 0)
                throw new ArgumentNullException("Key");
            if (IV == null || IV.Length <= 0)
                throw new ArgumentNullException("IV");
            byte[] encrypted;
            // Create an RijndaelManaged object 
            // with the specified key and IV. 
            using (RijndaelManaged rijAlg = new RijndaelManaged())
            {
                rijAlg.Key = Key;
                rijAlg.IV = IV;

                // Create a decryptor to perform the stream transform.
                ICryptoTransform encryptor = rijAlg.CreateEncryptor(rijAlg.Key, rijAlg.IV);

                // Create the streams used for encryption. 
                using (MemoryStream msEncrypt = new MemoryStream())
                {
                    using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
                    {
                        using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                        {

                            //Write all data to the stream.
                            swEncrypt.Write(plainText);
                        }
                        encrypted = msEncrypt.ToArray();
                    }
                }
            }

            // Return the encrypted bytes from the memory stream. 
            return encrypted;

        }

        static string DecryptStringFromBytes(byte[] cipherText, byte[] Key, byte[] IV)
        {
            // Check arguments. 
            if (cipherText == null || cipherText.Length <= 0)
                throw new ArgumentNullException("cipherText");
            if (Key == null || Key.Length <= 0)
                throw new ArgumentNullException("Key");
            if (IV == null || IV.Length <= 0)
                throw new ArgumentNullException("IV");

            // Declare the string used to hold 
            // the decrypted text. 
            string plaintext = null;

            // Create an RijndaelManaged object 
            // with the specified key and IV. 
            using (RijndaelManaged rijAlg = new RijndaelManaged())
            {
                rijAlg.Key = Key;
                rijAlg.IV = IV;

                // Create a decrytor to perform the stream transform.
                ICryptoTransform decryptor = rijAlg.CreateDecryptor(rijAlg.Key, rijAlg.IV);

                // Create the streams used for decryption. 
                using (MemoryStream msDecrypt = new MemoryStream(cipherText))
                {
                    using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
                    {
                        using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                        {

                            // Read the decrypted bytes from the decrypting stream 
                            // and place them in a string.
                            plaintext = srDecrypt.ReadToEnd();
                        }
                    }
                }

            }

            return plaintext;

        }
    }
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2013-01-11T21:14:44.587

我最近不得不在我自己的项目中再次遇到这个问题 - 并且想分享我一直在使用的更简单的代码，因为这个问题和一系列答案不断出现在我的搜索中。

我不会讨论关于多久更新一次诸如*Salt*和*Initialization Vector*之类的安全问题——这是一个安全论坛的主题，并且有一些很棒的资源可供查看。这只是`AesManaged`在 C# 中实现的代码块。

```
using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

namespace Your.Namespace.Security {
    public static class Cryptography {
        #region Settings

        private static int _iterations = 2;
        private static int _keySize = 256;

        private static string _hash     = "SHA1";
        private static string _salt     = "aselrias38490a32"; // Random
        private static string _vector   = "8947az34awl34kjq"; // Random

        #endregion

        public static string Encrypt(string value, string password) {
            return Encrypt<AesManaged>(value, password);
        }
        public static string Encrypt<T>(string value, string password) 
                where T : SymmetricAlgorithm, new() {
            byte[] vectorBytes = GetBytes<ASCIIEncoding>(_vector);
            byte[] saltBytes = GetBytes<ASCIIEncoding>(_salt);
            byte[] valueBytes = GetBytes<UTF8Encoding>(value);

            byte[] encrypted;
            using (T cipher = new T()) {
                PasswordDeriveBytes _passwordBytes = 
                    new PasswordDeriveBytes(password, saltBytes, _hash, _iterations);
                byte[] keyBytes = _passwordBytes.GetBytes(_keySize / 8);

                cipher.Mode = CipherMode.CBC;

                using (ICryptoTransform encryptor = cipher.CreateEncryptor(keyBytes, vectorBytes)) {
                    using (MemoryStream to = new MemoryStream()) {
                        using (CryptoStream writer = new CryptoStream(to, encryptor, CryptoStreamMode.Write)) {
                            writer.Write(valueBytes, 0, valueBytes.Length);
                            writer.FlushFinalBlock();
                            encrypted = to.ToArray();
                        }
                    }
                }
                cipher.Clear();
            }
            return Convert.ToBase64String(encrypted);
        }

        public static string Decrypt(string value, string password) {
            return Decrypt<AesManaged>(value, password);
        }
        public static string Decrypt<T>(string value, string password) where T : SymmetricAlgorithm, new() {
            byte[] vectorBytes = GetBytes<ASCIIEncoding>(_vector);
            byte[] saltBytes = GetBytes<ASCIIEncoding>(_salt);
            byte[] valueBytes = Convert.FromBase64String(value);

            byte[] decrypted;
            int decryptedByteCount = 0;

            using (T cipher = new T()) {
                PasswordDeriveBytes _passwordBytes = new PasswordDeriveBytes(password, saltBytes, _hash, _iterations);
                byte[] keyBytes = _passwordBytes.GetBytes(_keySize / 8);

                cipher.Mode = CipherMode.CBC;

                try {
                    using (ICryptoTransform decryptor = cipher.CreateDecryptor(keyBytes, vectorBytes)) {
                        using (MemoryStream from = new MemoryStream(valueBytes)) {
                            using (CryptoStream reader = new CryptoStream(from, decryptor, CryptoStreamMode.Read)) {
                                decrypted = new byte[valueBytes.Length];
                                decryptedByteCount = reader.Read(decrypted, 0, decrypted.Length);
                            }
                        }
                    }
                } catch (Exception ex) {
                    return String.Empty;
                }

                cipher.Clear();
            }
            return Encoding.UTF8.GetString(decrypted, 0, decryptedByteCount);
        }

    }
} 
```

该代码使用起来非常简单。它实际上只需要以下内容：

```
string encrypted = Cryptography.Encrypt(data, "testpass");
string decrypted = Cryptography.Decrypt(encrypted, "testpass"); 
```

默认情况下，实现使用 AesManaged - 但您实际上也可以插入任何其他`SymmetricAlgorithm`. .NET 4.5的可用`SymmetricAlgorithm`继承者列表可在以下位置找到：

[http://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.aspx)

截至本文发布时，当前列表包括：

*   `AesManaged`
*   `RijndaelManaged`
*   `DESCryptoServiceProvider`
*   `RC2CryptoServiceProvider`
*   `TripleDESCryptoServiceProvider`

要`RijndaelManaged`与上面的代码一起使用，例如，您将使用：

```
string encrypted = Cryptography.Encrypt<RijndaelManaged>(dataToEncrypt, password);
string decrypted = Cryptography.Decrypt<RijndaelManaged>(encrypted, password); 
```

我希望这对外面的人有帮助。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-01-08T17:27:58.393

看看这里的样本..

[http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged(v=VS.100).aspx#Y2262](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged(v=VS.100).aspx#Y2262)

MSDN 上的例子没有正常运行（出现错误），因为**Initial Vector(iv)**和Key**没有****初始值**。我添加了 2 行代码，现在可以正常工作。

 ****更多详情见下文：

```
using System.Windows.Forms;
using System;
using System.Text;
using System.IO;
using System.Security.Cryptography;

namespace AES_TESTER
{
   public partial class Form1 : Form
   {
       public Form1()
       {
          InitializeComponent();
       }

       private void Form1_Load(object sender, EventArgs e)
       {
          try
          {

            string original = "Here is some data to encrypt!";
            MessageBox.Show("Original:   " + original);

            // Create a new instance of the RijndaelManaged
            // class.  This generates a new key and initialization 
            // vector (IV).
            using (RijndaelManaged myRijndael = new RijndaelManaged())
            {
                 myRijndael.GenerateKey();
                 myRijndael.GenerateIV();

                // Encrypt the string to an array of bytes.
                byte[] encrypted = EncryptStringToBytes(original, myRijndael.Key, myRijndael.IV);

                StringBuilder s = new StringBuilder();
                foreach (byte item in encrypted)
                {
                   s.Append(item.ToString("X2") + " ");
                }
                MessageBox.Show("Encrypted:   " + s);

                // Decrypt the bytes to a string.
                string decrypted = DecryptStringFromBytes(encrypted, myRijndael.Key, myRijndael.IV);

                //Display the original data and the decrypted data.
                MessageBox.Show("Decrypted:    " + decrypted);
            }

        }
        catch (Exception ex)
        {
            MessageBox.Show("Error: {0}", ex.Message);
        }
    }

    static byte[] EncryptStringToBytes(string plainText, byte[] Key, byte[] IV)
    {
        // Check arguments.
        if (plainText == null || plainText.Length <= 0)
            throw new ArgumentNullException("plainText");
        if (Key == null || Key.Length <= 0)
            throw new ArgumentNullException("Key");
        if (IV == null || IV.Length <= 0)
            throw new ArgumentNullException("Key");
        byte[] encrypted;
        // Create an RijndaelManaged object
        // with the specified key and IV.
        using (RijndaelManaged rijAlg = new RijndaelManaged())
        {
            rijAlg.Key = Key;
            rijAlg.IV = IV;
            rijAlg.Mode = CipherMode.CBC;
            rijAlg.Padding = PaddingMode.Zeros;

            // Create a decrytor to perform the stream transform.
            ICryptoTransform encryptor = rijAlg.CreateEncryptor(rijAlg.Key, rijAlg.IV);

            // Create the streams used for encryption.
            using (MemoryStream msEncrypt = new MemoryStream())
            {
                using (CryptoStream csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))
                {
                    using (StreamWriter swEncrypt = new StreamWriter(csEncrypt))
                    {

                        //Write all data to the stream.
                        swEncrypt.Write(plainText);
                    }
                    encrypted = msEncrypt.ToArray();
                }
            }
        }

        // Return the encrypted bytes from the memory stream.
        return encrypted;

    }

    static string DecryptStringFromBytes(byte[] cipherText, byte[] Key, byte[] IV)
    {
        // Check arguments.
        if (cipherText == null || cipherText.Length <= 0)
            throw new ArgumentNullException("cipherText");
        if (Key == null || Key.Length <= 0)
            throw new ArgumentNullException("Key");
        if (IV == null || IV.Length <= 0)
            throw new ArgumentNullException("Key");

        // Declare the string used to hold
        // the decrypted text.
        string plaintext = null;

        // Create an RijndaelManaged object
        // with the specified key and IV.
        using (RijndaelManaged rijAlg = new RijndaelManaged())
        {
            rijAlg.Key = Key;
            rijAlg.IV = IV;
            rijAlg.Mode = CipherMode.CBC;
            rijAlg.Padding = PaddingMode.Zeros;

            // Create a decrytor to perform the stream transform.
            ICryptoTransform decryptor = rijAlg.CreateDecryptor(rijAlg.Key, rijAlg.IV);

            // Create the streams used for decryption.
            using (MemoryStream msDecrypt = new MemoryStream(cipherText))
            {
                using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
                {
                    using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                    {

                        // Read the decrypted bytes from the decrypting stream
                        // and place them in a string.
                        plaintext = srDecrypt.ReadToEnd();
                    }
                }
            }

        }

        return plaintext;
     }
   }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-07T20:16:10.423

使用 AES 还是实施 AES？要使用 AES，有 System.Security.Cryptography.RijndaelManaged 类。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-07-25T19:22:50.800

```
//Code to encrypt Data :   
 public byte[] encryptdata(byte[] bytearraytoencrypt, string key, string iv)  
         {  
           AesCryptoServiceProvider dataencrypt = new AesCryptoServiceProvider();  
           //Block size : Gets or sets the block size, in bits, of the cryptographic operation.  
           dataencrypt.BlockSize = 128;  
           //KeySize: Gets or sets the size, in bits, of the secret key  
           dataencrypt.KeySize = 128;  
           //Key: Gets or sets the symmetric key that is used for encryption and decryption.  
           dataencrypt.Key = System.Text.Encoding.UTF8.GetBytes(key);  
           //IV : Gets or sets the initialization vector (IV) for the symmetric algorithm  
           dataencrypt.IV = System.Text.Encoding.UTF8.GetBytes(iv);  
           //Padding: Gets or sets the padding mode used in the symmetric algorithm  
           dataencrypt.Padding = PaddingMode.PKCS7;  
           //Mode: Gets or sets the mode for operation of the symmetric algorithm  
           dataencrypt.Mode = CipherMode.CBC;  
           //Creates a symmetric AES encryptor object using the current key and initialization vector (IV).  
           ICryptoTransform crypto1 = dataencrypt.CreateEncryptor(dataencrypt.Key, dataencrypt.IV);  
           //TransformFinalBlock is a special function for transforming the last block or a partial block in the stream.   
           //It returns a new array that contains the remaining transformed bytes. A new array is returned, because the amount of   
           //information returned at the end might be larger than a single block when padding is added.  
           byte[] encrypteddata = crypto1.TransformFinalBlock(bytearraytoencrypt, 0, bytearraytoencrypt.Length);  
           crypto1.Dispose();  
           //return the encrypted data  
           return encrypteddata;  
         }  

//code to decrypt data
    private byte[] decryptdata(byte[] bytearraytodecrypt, string key, string iv)  
     {  

       AesCryptoServiceProvider keydecrypt = new AesCryptoServiceProvider();  
       keydecrypt.BlockSize = 128;  
       keydecrypt.KeySize = 128;  
       keydecrypt.Key = System.Text.Encoding.UTF8.GetBytes(key);  
       keydecrypt.IV = System.Text.Encoding.UTF8.GetBytes(iv);  
       keydecrypt.Padding = PaddingMode.PKCS7;  
       keydecrypt.Mode = CipherMode.CBC;  
       ICryptoTransform crypto1 = keydecrypt.CreateDecryptor(keydecrypt.Key, keydecrypt.IV);  

       byte[] returnbytearray = crypto1.TransformFinalBlock(bytearraytodecrypt, 0, bytearraytodecrypt.Length);  
       crypto1.Dispose();  
       return returnbytearray;  
     } 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-09-01T01:59:59.520

有关除 AES 加密之外执行密钥派生的更完整示例，请参阅[Getting AES encryption to work across Javascript and C#](https://stackoverflow.com/questions/1149611/getting-slowaes-and-rijndaelmanaged-class-in-net-to-play-together)中发布的答案和链接。

**编辑**
附注：[Javascript Cryptography 被认为是有害的。](http://www.matasano.com/articles/javascript-cryptography/)值得一读。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-06-28T12:06:58.583

***[http://www.codeproject.com/Articles/769741/Csharp-AES-bits-Encryption-Library-with-Salt](http://www.codeproject.com/Articles/769741/Csharp-AES-bits-Encryption-Library-with-Salt)***

```
using System.Security.Cryptography;
using System.IO; 
```

```
public byte[] AES_Encrypt(byte[] bytesToBeEncrypted, byte[] passwordBytes)
{
    byte[] encryptedBytes = null;
    byte[] saltBytes = new byte[] { 1, 2, 3, 4, 5, 6, 7, 8 };
    using (MemoryStream ms = new MemoryStream())
    {
        using (RijndaelManaged AES = new RijndaelManaged())
        {
            AES.KeySize = 256;
            AES.BlockSize = 128;
            var key = new Rfc2898DeriveBytes(passwordBytes, saltBytes, 1000);
            AES.Key = key.GetBytes(AES.KeySize / 8);
            AES.IV = key.GetBytes(AES.BlockSize / 8);
            AES.Mode = CipherMode.CBC;
            using (var cs = new CryptoStream(ms, AES.CreateEncryptor(), CryptoStreamMode.Write))
            {
                cs.Write(bytesToBeEncrypted, 0, bytesToBeEncrypted.Length);
                cs.Close();
            }
            encryptedBytes = ms.ToArray();
        }
    }
    return encryptedBytes;
}

public byte[] AES_Decrypt(byte[] bytesToBeDecrypted, byte[] passwordBytes)
{
    byte[] decryptedBytes = null;
    byte[] saltBytes = new byte[] { 1, 2, 3, 4, 5, 6, 7, 8 };
    using (MemoryStream ms = new MemoryStream())
    {
        using (RijndaelManaged AES = new RijndaelManaged())
        {
            AES.KeySize = 256;
            AES.BlockSize = 128;
            var key = new Rfc2898DeriveBytes(passwordBytes, saltBytes, 1000);
            AES.Key = key.GetBytes(AES.KeySize / 8);
            AES.IV = key.GetBytes(AES.BlockSize / 8);
            AES.Mode = CipherMode.CBC;
            using (var cs = new CryptoStream(ms, AES.CreateDecryptor(), CryptoStreamMode.Write))
            {
                cs.Write(bytesToBeDecrypted, 0, bytesToBeDecrypted.Length);
                cs.Close();
            }
            decryptedBytes = ms.ToArray();
        }
    }
    return decryptedBytes;
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-11-13T22:04:06.613

试试这个代码，也许有用。
1.新建C#项目，在Form1中添加如下代码：

```
using System;
using System.Windows.Forms;
using System.Security.Cryptography;

namespace ExampleCrypto
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            string strOriginalData = string.Empty;
            string strEncryptedData = string.Empty;
            string strDecryptedData = string.Empty;

            strOriginalData = "this is original data 1234567890"; // your original data in here
            MessageBox.Show("ORIGINAL DATA:\r\n" + strOriginalData);

            clsCrypto aes = new clsCrypto();
            aes.IV = "this is your IV";     // your IV
            aes.KEY = "this is your KEY";    // your KEY      
            strEncryptedData = aes.Encrypt(strOriginalData, CipherMode.CBC);    // your cipher mode
            MessageBox.Show("ENCRYPTED DATA:\r\n" + strEncryptedData);

            strDecryptedData = aes.Decrypt(strEncryptedData, CipherMode.CBC);
            MessageBox.Show("DECRYPTED DATA:\r\n" + strDecryptedData);
        }

    }
} 
```

2.创建 clsCrypto.cs 并在您的课程中复制粘贴以下代码并运行您的代码。我使用 MD5 生成了初始向量（IV）和 AES 的 KEY。

```
using System;
using System.Security.Cryptography;
using System.Text;
using System.Windows.Forms;
using System.IO;
using System.Runtime.Remoting.Metadata.W3cXsd2001;

namespace ExampleCrypto
{
    public class clsCrypto
    {
        private string _KEY = string.Empty;
        protected internal string KEY
        {
            get
            {
                return _KEY;
            }
            set
            {
                if (!string.IsNullOrEmpty(value))
                {
                    _KEY = value;
                }
            }
        }

        private string _IV = string.Empty;
        protected internal string IV
        {
            get
            {
                return _IV;
            }
            set
            {
                if (!string.IsNullOrEmpty(value))
                {
                    _IV = value;
                }
            }
        }

        private string CalcMD5(string strInput)
        {
            string strOutput = string.Empty;
            if (!string.IsNullOrEmpty(strInput))
            {
                try
                {
                    StringBuilder strHex = new StringBuilder();
                    using (MD5 md5 = MD5.Create())
                    {
                        byte[] bytArText = Encoding.Default.GetBytes(strInput);
                        byte[] bytArHash = md5.ComputeHash(bytArText);
                        for (int i = 0; i < bytArHash.Length; i++)
                        {
                            strHex.Append(bytArHash[i].ToString("X2"));
                        }
                        strOutput = strHex.ToString();
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message);
                }
            }
            return strOutput;
        }

        private byte[] GetBytesFromHexString(string strInput)
        {
            byte[] bytArOutput = new byte[] { };
            if ((!string.IsNullOrEmpty(strInput)) && strInput.Length % 2 == 0)
            {
                SoapHexBinary hexBinary = null;
                try
                {
                    hexBinary = SoapHexBinary.Parse(strInput);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message);
                }
                bytArOutput = hexBinary.Value;
            }
            return bytArOutput;
        }

        private byte[] GenerateIV()
        {
            byte[] bytArOutput = new byte[] { };
            try
            {
                string strIV = CalcMD5(IV);
                bytArOutput = GetBytesFromHexString(strIV);
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            return bytArOutput;
        }

        private byte[] GenerateKey()
        {
            byte[] bytArOutput = new byte[] { };
            try
            {
                string strKey = CalcMD5(KEY);
                bytArOutput = GetBytesFromHexString(strKey);
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            return bytArOutput;
        }

        protected internal string Encrypt(string strInput, CipherMode cipherMode)
        {
            string strOutput = string.Empty;
            if (!string.IsNullOrEmpty(strInput))
            {
                try
                {
                    byte[] bytePlainText = Encoding.Default.GetBytes(strInput);
                    using (RijndaelManaged rijManaged = new RijndaelManaged())
                    {
                        rijManaged.Mode = cipherMode;
                        rijManaged.BlockSize = 128;
                        rijManaged.KeySize = 128;
                        rijManaged.IV = GenerateIV();
                        rijManaged.Key = GenerateKey();
                        rijManaged.Padding = PaddingMode.Zeros;
                        ICryptoTransform icpoTransform = rijManaged.CreateEncryptor(rijManaged.Key, rijManaged.IV);
                        using (MemoryStream memStream = new MemoryStream())
                        {
                            using (CryptoStream cpoStream = new CryptoStream(memStream, icpoTransform, CryptoStreamMode.Write))
                            {
                                cpoStream.Write(bytePlainText, 0, bytePlainText.Length);
                                cpoStream.FlushFinalBlock();
                            }
                            strOutput = Encoding.Default.GetString(memStream.ToArray());
                        }
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message);
                }
            }
            return strOutput;
        }

        protected internal string Decrypt(string strInput, CipherMode cipherMode)
        {
            string strOutput = string.Empty;
            if (!string.IsNullOrEmpty(strInput))
            {
                try
                {
                    byte[] byteCipherText = Encoding.Default.GetBytes(strInput);
                    byte[] byteBuffer = new byte[strInput.Length];
                    using (RijndaelManaged rijManaged = new RijndaelManaged())
                    {
                        rijManaged.Mode = cipherMode;
                        rijManaged.BlockSize = 128;
                        rijManaged.KeySize = 128;
                        rijManaged.IV = GenerateIV();
                        rijManaged.Key = GenerateKey();
                        rijManaged.Padding = PaddingMode.Zeros;
                        ICryptoTransform icpoTransform = rijManaged.CreateDecryptor(rijManaged.Key, rijManaged.IV);
                        using (MemoryStream memStream = new MemoryStream(byteCipherText))
                        {
                            using (CryptoStream cpoStream = new CryptoStream(memStream, icpoTransform, CryptoStreamMode.Read))
                            {
                                cpoStream.Read(byteBuffer, 0, byteBuffer.Length);
                            }
                            strOutput = Encoding.Default.GetString(byteBuffer);
                        }
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message);
                }
            }
            return strOutput;
        }

    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-11-05T13:52:55.327

这是一个简洁的代码，用于理解在 C# 调用 Encrypt 函数中实现的 AES 256 算法`encryptedstring = cryptObj.Encrypt(username, "AGARAMUDHALA", "EZHUTHELLAM", "SHA1", 3, "@1B2c3D4e5F6g7H8", 256);`

```
public class Crypt
{
    public string Encrypt(string passtext, string passPhrase, string saltV, string hashstring, int Iterations, string initVect, int keysize)
    {
        string functionReturnValue = null;
        // Convert strings into byte arrays.
        // Let us assume that strings only contain ASCII codes.
        // If strings include Unicode characters, use Unicode, UTF7, or UTF8
        // encoding.
        byte[] initVectorBytes = null;
        initVectorBytes = Encoding.ASCII.GetBytes(initVect);
        byte[] saltValueBytes = null;
        saltValueBytes = Encoding.ASCII.GetBytes(saltV);

        // Convert our plaintext into a byte array.
        // Let us assume that plaintext contains UTF8-encoded characters.
        byte[] plainTextBytes = null;
        plainTextBytes = Encoding.UTF8.GetBytes(passtext);
        // First, we must create a password, from which the key will be derived.
        // This password will be generated from the specified passphrase and
        // salt value. The password will be created using the specified hash
        // algorithm. Password creation can be done in several iterations.
        PasswordDeriveBytes password = default(PasswordDeriveBytes);
        password = new PasswordDeriveBytes(passPhrase, saltValueBytes, hashstring, Iterations);
        // Use the password to generate pseudo-random bytes for the encryption
        // key. Specify the size of the key in bytes (instead of bits).
        byte[] keyBytes = null;
        keyBytes = password.GetBytes(keysize/8);
        // Create uninitialized Rijndael encryption object.
        RijndaelManaged symmetricKey = default(RijndaelManaged);
        symmetricKey = new RijndaelManaged();

        // It is reasonable to set encryption mode to Cipher Block Chaining
        // (CBC). Use default options for other symmetric key parameters.
        symmetricKey.Mode = CipherMode.CBC;
        // Generate encryptor from the existing key bytes and initialization
        // vector. Key size will be defined based on the number of the key
        // bytes.
        ICryptoTransform encryptor = default(ICryptoTransform);
        encryptor = symmetricKey.CreateEncryptor(keyBytes, initVectorBytes);

        // Define memory stream which will be used to hold encrypted data.
        MemoryStream memoryStream = default(MemoryStream);
        memoryStream = new MemoryStream();

        // Define cryptographic stream (always use Write mode for encryption).
        CryptoStream cryptoStream = default(CryptoStream);
        cryptoStream = new CryptoStream(memoryStream, encryptor, CryptoStreamMode.Write);
        // Start encrypting.
        cryptoStream.Write(plainTextBytes, 0, plainTextBytes.Length);

        // Finish encrypting.
        cryptoStream.FlushFinalBlock();
        // Convert our encrypted data from a memory stream into a byte array.
        byte[] cipherTextBytes = null;
        cipherTextBytes = memoryStream.ToArray();

        // Close both streams.
        memoryStream.Close();
        cryptoStream.Close();

        // Convert encrypted data into a base64-encoded string.
        string cipherText = null;
        cipherText = Convert.ToBase64String(cipherTextBytes);

        functionReturnValue = cipherText;
        return functionReturnValue;
    }
    public string Decrypt(string cipherText, string passPhrase, string saltValue, string hashAlgorithm, int passwordIterations, string initVector, int keySize)
    {
        string functionReturnValue = null;

        // Convert strings defining encryption key characteristics into byte
        // arrays. Let us assume that strings only contain ASCII codes.
        // If strings include Unicode characters, use Unicode, UTF7, or UTF8
        // encoding.

            byte[] initVectorBytes = null;
            initVectorBytes = Encoding.ASCII.GetBytes(initVector);

            byte[] saltValueBytes = null;
            saltValueBytes = Encoding.ASCII.GetBytes(saltValue);

            // Convert our ciphertext into a byte array.
            byte[] cipherTextBytes = null;
            cipherTextBytes = Convert.FromBase64String(cipherText);

            // First, we must create a password, from which the key will be
            // derived. This password will be generated from the specified
            // passphrase and salt value. The password will be created using
            // the specified hash algorithm. Password creation can be done in
            // several iterations.
            PasswordDeriveBytes password = default(PasswordDeriveBytes);
            password = new PasswordDeriveBytes(passPhrase, saltValueBytes, hashAlgorithm, passwordIterations);

            // Use the password to generate pseudo-random bytes for the encryption
            // key. Specify the size of the key in bytes (instead of bits).
            byte[] keyBytes = null;
            keyBytes = password.GetBytes(keySize / 8);

            // Create uninitialized Rijndael encryption object.
            RijndaelManaged symmetricKey = default(RijndaelManaged);
            symmetricKey = new RijndaelManaged();

            // It is reasonable to set encryption mode to Cipher Block Chaining
            // (CBC). Use default options for other symmetric key parameters.
            symmetricKey.Mode = CipherMode.CBC;

            // Generate decryptor from the existing key bytes and initialization
            // vector. Key size will be defined based on the number of the key
            // bytes.
            ICryptoTransform decryptor = default(ICryptoTransform);
            decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes);

            // Define memory stream which will be used to hold encrypted data.
            MemoryStream memoryStream = default(MemoryStream);
            memoryStream = new MemoryStream(cipherTextBytes);

            // Define memory stream which will be used to hold encrypted data.
            CryptoStream cryptoStream = default(CryptoStream);
            cryptoStream = new CryptoStream(memoryStream, decryptor, CryptoStreamMode.Read);

            // Since at this point we don't know what the size of decrypted data
            // will be, allocate the buffer long enough to hold ciphertext;
            // plaintext is never longer than ciphertext.
            byte[] plainTextBytes = null;
            plainTextBytes = new byte[cipherTextBytes.Length + 1];

            // Start decrypting.
            int decryptedByteCount = 0;
            decryptedByteCount = cryptoStream.Read(plainTextBytes, 0, plainTextBytes.Length);

            // Close both streams.
            memoryStream.Close();
            cryptoStream.Close();

            // Convert decrypted data into a string.
            // Let us assume that the original plaintext string was UTF8-encoded.
            string plainText = null;
            plainText = Encoding.UTF8.GetString(plainTextBytes, 0, decryptedByteCount);

            // Return decrypted string.
            functionReturnValue = plainText;

        return functionReturnValue;
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-07-10T03:04:20.340

您可以使用文本框中的密码，如密钥... 使用此代码，您可以加密/解密文本、图片、word 文档、pdf ....

```
 public class Rijndael
{
    private byte[] key;
    private readonly byte[] vector = { 255, 64, 191, 111, 23, 3, 113, 119, 231, 121, 252, 112, 79, 32, 114, 156 };

    ICryptoTransform EnkValue, DekValue;

    public Rijndael(byte[] key)
    {
        this.key = key;
        RijndaelManaged rm = new RijndaelManaged();
        rm.Padding = PaddingMode.PKCS7;
        EnkValue = rm.CreateEncryptor(key, vector);
        DekValue = rm.CreateDecryptor(key, vector);
    }

    public byte[] Encrypt(byte[] byte)
    {

        byte[] enkByte= byte;
        byte[] enkNewByte;
        using (MemoryStream ms = new MemoryStream())
        {
            using (CryptoStream cs = new CryptoStream(ms, EnkValue, CryptoStreamMode.Write))
            {
                cs.Write(enkByte, 0, enkByte.Length);
                cs.FlushFinalBlock();

                ms.Position = 0;
                enkNewByte= new byte[ms.Length];
                ms.Read(enkNewByte, 0, enkNewByte.Length);
            }
        }
        return enkNeyByte;
    }

    public byte[] Dekrypt(byte[] enkByte)
    {
        byte[] dekByte;
        using (MemoryStream ms = new MemoryStream())
        {
            using (CryptoStream cs = new CryptoStream(ms, DekValue, CryptoStreamMode.Write))
            {
                cs.Write(enkByte, 0, enkByte.Length);
                cs.FlushFinalBlock();

                ms.Position = 0;
                dekByte= new byte[ms.Length];
                ms.Read(dekByte, 0, dekByte.Length);
            }
        }
        return dekByte;
    }
} 
```

将密码从文本框转换为字节数组...

```
private byte[] ConvertPasswordToByte(string password)
    {
        byte[] key = new byte[32];
        for (int i = 0; i < passwprd.Length; i++)
        {
            key[i] = Convert.ToByte(passwprd[i]);
        }
        return key;
    } 
```

# wiki - 设计 Wiki、设计注意事项和反馈

> ID：273460
> 
> 赞同：4
> 
> 时间：2008-11-07T20:06:59.773
> 
> 标签：wiki

在设计 wiki 应用程序时，我应该考虑哪些事项？

到目前为止，我有：

1.  修订
2.  解析某种标记文本
3.  跟踪 wiki 中的链接，以及链接到其他页面的页面。
4.  相关 wiki 即 wiki 与其他 wiki 相关。

构建 Wiki 还需要什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-09-14T17:15:55.763

如果有帮助，这里是 Wikipedia 的数据库模式（实际上是 MediaWiki，Wikipedia 背后的引擎）：

[![替代文字](https://i.stack.imgur.com/tUhJW.png)](https://i.stack.imgur.com/tUhJW.png)

[http://upload.wikimedia.org/wikipedia/commons/4/41/Mediawiki-database-schema.png？](http://upload.wikimedia.org/wikipedia/commons/4/41/Mediawiki-database-schema.png?)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T20:31:32.187

在过去的几年里，我对 wiki 进行了大量研究和工作，供我自己使用并为我的各种客户/雇主支持技术团队。

我得出的结论是，wiki 最重要的标准是使其透明，就像[http://c2.com/](http://c2.com/)上的原始 wiki 。贡献应该如此容易，以至于用户永远不会质疑他们是否应该费心去做。编辑器必须易于访问，它应该使用传统的纯文本（NO WYSIWYG !!!）wiki 格式，应该易于添加新页面，应该易于链接到外部页面（其他 wiki 或常规网络） , 它应该有反向链接。模仿原始的wiki，你会没事的。

如果用户曾经以一种或另一种方式质疑他们是否应该因为太痛苦而费心做出贡献，那么 wiki 就会停滞不前并失败。我已经看到它一遍又一遍地发生。WYSIWYG 是一种常见的故障模式，混入大量文件、多媒体等“丰富”内容是另一种，无法备份/恢复是一个大问题。如果您想要“花哨”的内容，请使用托管在“附近”的标准 Web 服务器，wiki 用户可以链接到该服务器。请记住，wiki 是关于交流的，而不是关于漂亮的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T20:17:35.007

看看[TiddlyWiki](http://www.tiddlywiki.com/)。我认为它具有我在任何 wiki 中看到的最佳功能组合。（对于下面的“页面”，请阅读“项目”，因为 TiddlyWiki 是一个单页 wiki。但我认为这些功能也应该适用于有页面的 wiki）：

*   所有“缺失”页面的列表（没有页面的 WikiWords）
*   孤立页面列表（没有链接的页面）
*   大多数格式化是通过编辑 wiki 页面完成的
*   您不能搞砸格式，因为如果您删除自定义格式，则会有默认值
*   您可以标记页面
*   您可以在另一个页面中包含一个页面

还有很多我没有提到的。我认为格式化可能是许多好功能中最好的，因为它很容易编辑，也很难搞砸。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-07T21:52:49.810

经常被忽视：

*   很好的搜索
*   层次结构。我在 Redmine 的 wiki 中最怀念的一件事。

如果您找到了一种实现易于重组的 wiki 的好方法，那也很棒（即重命名页面，或将两个页面合二为一，并且不会破坏无数的 wiki 链接）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T20:10:30.840

用户界面——对用户来说最令人沮丧的事情之一是他们必须学习一个用于 MediaWiki 的用户界面，一个用于 TikiWiki 的用户界面，以及一个用于其他无数 wiki 中的任何一个的用户界面。

wiki 最重要的部分不是技术可行性——它让用户以一种方便有效的方式进行贡献和编辑。您可以拥有世界上技术最强大的 wiki，但如果它不易于使用，那么它作为 wiki 应有的社区工具将毫无用处。

要么复制现有的和熟悉的 wiki 语法（例如 MediaWiki），要么准备投入巨资创建 WYSIWYG 编辑器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-09T09:31:36.277

我不会启动一个新的 wiki 引擎，它具有每个人都拥有的相同功能，那里有很多这样的功能。

我只会在一个提供不同/独特的东西上工作，而不仅仅是一个标准的 wiki。

一些想法包括（也许一些维基已经有了这个）：

*   能够将 wiki 与 VCS 合并，讨论修订/更改并能够进行代码审查（任何提交的内容都会自动为修订创建一个页面），将其链接到提交者和讨论中的任何人并发送他们的电子邮件警报会很好。
*   一个 wiki 的 API，允许 3rd 方应用程序进行 mashup 风格的集成。
*   wiki 风格的多媒体（文本、图像、音频和视频），其中包含指向其他媒体的链接。
*   多语言并排编辑和翻译。
*   一个客户端编辑器/查看器（不是基于网络的），用于更快的响应和真正的所见即所得编辑。
*   ...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-06T03:18:47.607

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-09T06:06:17.160

确保对人们为防止 XSS 所做的所有编辑执行输入验证。没有什么比人们被黑客入侵更能毁掉一个好的维基了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-14T17:26:04.543

每次我试图让非开发人员使用 wiki 时，编写文本的难度一直是最大的障碍。与 StackOverflow 类似的 WYSIWYG 编辑器对我来说似乎是个好主意。它仍然在框中显示标记，因此有动力的用户最终会学会使用它（从而变得更有效率），但它还显示实时预览，以便用户获得关于他们的文本是否正确的即时反馈。

沿着同样的思路，另一个烦恼是每个 wiki 似乎使用略有不同的标记。我猜每个设计师都认为他们可以比以前做得更好。我建议使用 MediaWiki 的语法，或者像 MarkDown 这样的标准语法，以便高级用户可以更轻松地处理事情。

最后，考虑一下您的 wiki 将如何与已经存在的许多其他 wiki 区分开来，以及您的设计将如何影响这一点。

# database - 如何在 Access 中进行计算？

> ID：273461
> 
> 赞同：0
> 
> 时间：2008-11-07T20:07:11.037
> 
> 标签：database, ms-access, formula

在 Microsoft Access 中，我有一个名为 Time Sheet 的表，在此我有 Time sheet no。，服务员没有。、日期和工作时间。我有10个服务员。

我有另一张表，称为服务费分配。在这张桌子上，我有服务费号码，服务员号码。, 周数 和分配金额。

有一个账单表，其中服务费分配是从账单中计算出来的。

我需要计算服务费分配表中的分配金额，但我不知道如何执行此操作。我想在表单中执行此操作。我确实知道如何计算一周的总数。

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T20:26:46.690

我认为公式是：

一周的总配送费/（服务员工作人数 * 一名工人工作的小时数）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T20:55:21.767

我认为您正在寻找 DSum：

```
Answer=DSum("NameOfField","NameOfTable", _
  "SomeDate Between #2008/1/20# And #2008/1/27#") 
```

当然，您可以使用变量：

```
Answer=DSum("NameOfField","NameOfTable","SomeDate Between #"
  & date()-weekday(date())+1 & "# And #" & date()-weekday(date())+7 & "#") 
```

您还可以在控制源中使用 Dsum。

更多信息： http: [//office.microsoft.com/en-us/access/HA012288291033.aspx](http://office.microsoft.com/en-us/access/HA012288291033.aspx)

# asp.net - 我应该支持“mysite.com”和“www.mysite.com”吗？OpenID 问题？

> ID：273469
> 
> 赞同：1
> 
> 时间：2008-11-07T20:09:17.880
> 
> 标签：asp.net, openid

我为 ASP.Net 2.0 Web 应用程序实现了 OpenID 支持，并且在我的本地计算机上一切似乎都运行良好。

我正在使用 DotNetOpenId 库。在我重定向到第三方网站之前，我将原始 OpenID 存储在会话中，以便在用户通过身份验证时使用（我相信标准做法）。

但是，我有`www`在地址栏中输入 URL 时不输入的习惯。当我在实时服务器上测试登录时，我遇到了会话被清除的问题。我的返回网址被硬编码为 www.mysite.com。

`mysite.com`从 切换到是否有可能`www.mysite.com`导致会话切换？

另一个问题是 www.mysite.com 不在 mysite.com 的范围内。

这些问题的标准解决方案是什么。网站应该自动重定向到`www.mysite.com`? 我可以将我的登录页面链接设为包含`www`? 或者这些只是隐藏另一个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T04:36:41.377

解决您提到的领域问题很容易。只需将领域设置为 *.mysite.com 而不仅仅是 mysite.com。如果您使用库中包含的 ASP.NET 控件之一，您只需在控件上设置一个属性来设置领域。如果您以编程方式执行此操作，则在调用 RedirectToProvider() 之前设置 IAuthenticationRequest 对象的属性。

至于会话/cookie 问题与 www 和非 www 主机名之间的跳跃有关，您有两种选择：

1.  与其将原始标识符存储在会话中（出于某些原因这无论如何都是一个坏主意），不如使用 IAuthenticationRequest.AddCallbackArguments(name, value) 方法来存储用户输入的数据，然后使用 IAuthenticationResponse.GetCallbackArgument(name) 来调用用户通过身份验证时的数据。
2.  忘了它。dotnetopenid 库不会自动为您存储此信息是有原因的。定向身份只是一种情况：如果用户键入“yahoo.com”，您可能不想对他们说“欢迎，yahoo.com！” 而是“欢迎，id.yahoo.com/andrewarnott”！要始终如一地获得正确行为的唯一方法是使用 IAuthenticationResponse.FriendlyIdentifierForDisplay 属性来决定向用户显示什么作为他的登录标识符。它提供了更准确的信息，并且比在回调中存储一个值并取回它更容易。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T20:10:56.410

我不知道 OpenID 是如何工作的，但 LiveID 会根据用户和域的组合为您提供一个令牌。我只是将 www 转发到 mysite.com。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T20:44:31.147

cookie 和会话以及其他所有内容在 www.site.com 和 site.com 之间丢失。我没有足够的耐心来彻底阅读所有规格，但[http://www.w3.org/Protocols/rfc2109/rfc2109](http://www.w3.org/Protocols/rfc2109/rfc2109)指出

> A 是 FQDN 字符串，格式为 NB，其中 N 是非空名称字符串，B 格式为 .B'，B' 是 FQDN 字符串。（因此，xycom 域匹配 .y.com 而不是 y.com。）
> 
> 请注意，域匹配不是交换操作：abccom 域匹配 .c.com，但不是相反。

我认为这意味着是的，您确实需要转发到 www。当使用 cookie 和会话时，我总是向我的网站添加域更正代码。

# visual-studio-2005 - VS2005 资源编辑器一直在吃我的#ifdef

> ID：273475
> 
> 赞同：2
> 
> 时间：2008-11-07T20:10:02.230
> 
> 标签：visual-studio-2005, mfc, rc

资源编辑器不断在我的 .rc 中清除这种形式的代码：

```
#ifndef V2
IDB_SPLASHSCREEN        BITMAP                  "res\\xyz v1.bmp"
#else
IDB_SPLASHSCREEN        BITMAP                  "res\\xyz v2.bmp"
#endif 
```

有人知道解决方法吗？更好的方法来完成同样的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T22:12:32.607

Visual Studio 中的 MFC 项目通常包含一个用于用户定义资源的 .rc2 文件。如果将位图资源添加到此文件，Visual Studio 资源编辑器将不会修改它们。

[您可以在此处](http://msdn.microsoft.com/en-us/library/6t3612sk.aspx)阅读有关此内容的更多信息，并且在 StackOverflow 上的[此问题](https://stackoverflow.com/questions/95361/visual-studio-2005-rc-file-includes)的答案中有一些很好的信息。

# visual-studio-2008 - 是否可以使用 vc8 编译带有 SSH 支持的 libCurl？

> ID：273476
> 
> 赞同：-1
> 
> 时间：2008-11-07T20:10:30.157
> 
> 标签：visual-studio-2008, curl, ssh

我正在开发一个应用程序，在 VC++ 2008 中实现，需要通过 libCurl 使用 sftp。为了实现这一点，需要在构建 libCurl 时使用 ssh 支持。问题是，与 mingw makefile 不同，vc8 的 makefile 没有目标配置来构建 SSH 支持。有谁知道需要做什么才能完成这项工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-18T21:19:36.763

您也可以按照 PHP-for-win 的说明进行操作：

[http://wiki.php.net/internals/windows/libs/libcurl](http://wiki.php.net/internals/windows/libs/libcurl)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-18T19:59:59.903

我一直在寻找相同的答案并找到了这个[文件](http://curl.askapache.com/libcurl/c/Using-libcurl-with-SSH-support-in-Visual-Studio-2008.pdf)。

# ruby-on-rails - 扩展 restful_authentication AASM 状态的更好方法

> ID：273484
> 
> 赞同：1
> 
> 时间：2008-11-07T20:11:07.783
> 
> 标签：ruby-on-rails, ruby, authentication, state

我最近不得不在我的一个应用程序中为最新版本的 restful_authentication (github) 扩展 aasm 状态。我删除了“include Authorization::AasmRoles”，从插件中复制了现有的状态和事件，并进行了必要的更改以支持我的帐户模型上的附加“已发布”状态。

有没有人有更清洁的方法来处理这个？即只是覆盖状态事件？我能够按原样使用插件添加新事件，但是我不能只覆盖已经在 restful_auth 中的状态事件，所以我必须删除包含并使用它作为起点自己写出来。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T20:21:38.757

在 AASM 中添加状态包括创建一个新的 State 对象，然后将其添加到 AASM::StateMachine[User].states 数组中，如下所示：

```
def create_state(name, options)
 @states << AASM::SupportingClasses::State.new(name, options) unless @states.include?(name)
end 
```

这里要注意的是，一旦设置状态，它就不允许覆盖状态。如果再次设置同名状态，create_state 方法将忽略它。为了解决这个问题，你可以在你的用户模型中使用这样的东西：

```
# this will remove the state with name :name from the states array 
states = AASM::StateMachine[self].states
states.delete(states.find{ |s| s == :name })
# ... so we can define the state here again
aasm_state :name ... 
```

如果您只是重新定义状态，那么您现在应该没问题。但是如果你想完全移除状态，你也应该取消定义在 aasm_state 方法体中定义的方法。应该可以调用类似的东西：

```
undef_method :name 
```

事件的情况应该相同（只需在代码中使用“事件”而不是“状态”）。理想情况下，使其成为覆盖 AASM 模块中定义的方法的用户模型的类方法。在状态的情况下，它看起来像这样：

```
def aasm_state(name, options={})
  states = AASM::StateMachine[self].states
  states.delete(states.find{ |s| s == name.to_sym })
  super(name, options)
end 
```

警告：我可能不对。此代码未经测试，我只是通过查看 AASM 的源代码才弄清楚的。

# java - java的assert语句可以让你指定消息吗？

> ID：273485
> 
> 赞同：79
> 
> 时间：2008-11-07T20:11:33.833
> 
> 标签：java, assert

似乎在断言失败时让断言显示消息可能很有用。

目前一个`AssertionError`被抛出，你可以为它指定一个自定义消息吗？

您能否展示一个示例机制来执行此操作（除了创建自己的异常类型并抛出它）？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-11-07T20:12:42.333

你当然可以：

```
assert x > 0 : "x must be greater than zero, but x = " + x; 
```

有关更多信息，请参阅[使用断言编程。](https://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-29T17:02:24.747

```
assert (condition) : "some message"; 
```

我建议将条件放在括号中

```
assert (y > x): "y is too small. y = " + y; 
```

想象一下，如果你遇到这样的代码......

```
assert isTrue() ? true : false : "some message"; 
```

不要忘记这与您在 JUnit 中编写的断言无关。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-07T20:14:02.957

它绝对可以：

```
assert importantVar != null : "The important var was null!"; 
```

这会将“重要的变量为空”添加到抛出的异常中。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-07T20:14:32.503

如果你使用

```
assert Expression1 : Expression2 ; 
```

Expression2 用作 AssertionError 的详细消息。

# nhibernate - 如何使用表达式 在NHibernate？

> ID：273487
> 
> 赞同：2
> 
> 时间：2008-11-07T20:12:28.030
> 
> 标签：nhibernate, irepository

我已经阅读了 Rob Conery Crazy Talk 的非常好的博客文章[：减少 ORM 摩擦](http://blog.wekeroad.com/blog/crazy-talk-reducing-orm-friction/)
我如何概括这个接口以便我可以用 NHibernate 实现它？

```
using System;  
using System.Collections;  
using System.Linq;  
using System.Linq.Expressions;   

public interface IRepository<T>   
{  
     IQueryable<T> GetAll();  
     PagedList<T> GetPaged(int pageIndex, int pageSize);  
     IQueryable<T> Find(Expression<Func<T, bool>> expression);  
     void Save(T item);  
     void Delete(T item);  
} 
```

我想`Expression<Func<T, bool>>`在 NHibernate 中使用表达式。有什么线索吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T20:17:13.730

查看 LINQ to NHibernate。凯尔贝利[对它有一个很好的概述](http://codebetter.com/blogs/kyle.baley/archive/2008/04/07/trying-out-linq-for-nhibernate.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T20:16:32.623

您需要遍历表达式树并构建您的标准。

# amazon-ec2 - 有人可以解释云计算提供商使用的“实例小时”的概念吗？

> ID：273489
> 
> 赞同：19
> 
> 时间：2008-11-07T20:12:53.253
> 
> 标签：amazon-ec2, cloud, estimation

我正在查看各种云计算平台的定价，尤其是 Amazon 的 EC2，并且很多报价都是基于一个称为 Instance-Hour 的单位。

我试图了解实例小时的确切定义，以便更好地比较继续托管 Web 应用程序与将其放在云上的成本。

(1) 它是否对应于任何 Windows 性能计数器，以便我可以对我们当前的实现进行基准测试并在他们的定价计算器中使用它？

(2) 多处理器实例如何计入实例小时计算？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-07T20:15:16.980

实例小时只是您可以使用实例的常规时间，无论您是否使用它。亚马逊对不同类型的实例进行了不同的定价，因此您为获得的资源类型付费，而不是您使用了多少资源。

所以... 1\. 不，这只是一个正常的时间。2\. 它没有，它已经计入您为实例 pr 小时支付的价格中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-15T12:49:14.650

另请注意，实例小时数按四舍五入计费（对于 Amazon EC2）。因此，启动一个实例并立即再次将其关闭会产生 1 个实例小时的成本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-05-18T02:30:33.117

如果您计划在一小时内快速启动/停止 AWS EMR 集群，并且您希望避免每次这样做都被收取一小时的费用，那么请使用`--alive`cli 中的参数启动集群，这意味着让它继续运行.

然后快速将步骤添加到同一个集群，而不是： [http ://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/AddingStepstoaJobFlow.html](http://docs.aws.amazon.com/ElasticMapReduce/latest/DeveloperGuide/AddingStepstoaJobFlow.html)

完成后不要忘记停止集群！:)

# testing - 有没有办法在一台机器上安装所有浏览器的所有版本？

> ID：273494
> 
> 赞同：4
> 
> 时间：2008-11-07T20:14:33.283
> 
> 标签：testing, browser, installation

有没有办法在一台机器上安装所有浏览器的所有版本？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T20:17:53.353

我使用虚拟机来做不同的浏览器版本配置。我假设你想测试不同版本的 IE、Firefox 等。

如果您在任何时候自动化您的测试，那么虚拟机也可以方便地存储许多不同的配置以在一台机器上进行测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T20:16:55.243

当然，最好的方法是使用[VirtualBox](http://virtualbox.org)等虚拟化技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T20:20:39.823

我们已经使用它来安装多个版本的 IE 进行测试，它可以追溯到 3.0

[http://tredosoft.com/Multiple_IE](http://tredosoft.com/Multiple_IE)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T20:25:07.833

试试[沙盒](http://www.sandboxie.com/)。比虚拟机处理的工作要少得多。可能会跑得更快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T20:25:53.167

对于一些浏览器，比如 Firefox 或 Opera，只需将原始程序目录复制到别处并升级即可。大多数时候，旧版本应该仍然可以工作。

对于 IE，有几个发行版，[IETester](http://www.my-debugbar.com/wiki/IETester/HomePage "IETest")似乎是一个完整、简单的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T20:26:20.717

[对于 FireFox，您可以在此处](http://portableapps.com/apps/internet/firefox_portable)安装可用的便携式版本

使用 IE，我认为唯一的方法是通过虚拟机。我可以推荐 VirtualBox，对我来说运行顺畅。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T20:17:01.530

你为什么想这么做？

通常，产品不允许并行安装（同一产品的多个版本，当然您可以拥有不同产品的多个版本）。

如果您想进行一些分析或测试，可以选择在单独的虚拟机中进行（查看 VMWare）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T20:30:27.573

我不确定你为什么真的想要这个，但如果你想安装不同版本的 IE，请使用以下工具：

[http://tredosoft.com/Multiple_IE](http://tredosoft.com/Multiple_IE)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-11-07T20:16:24.713

是的。我有 IE8 Beta2、FF3、Chrome Beta 和 Safari 3.1.2 以及适用的开发者插件。

# security - 在合作伙伴公司的 Active Directory 实例之间建立信任关系是否有意义？

> ID：273496
> 
> 赞同：2
> 
> 时间：2008-11-07T20:14:58.057
> 
> 标签：security, active-directory, acl, federated-identity

如果公司经常要求在合作伙伴的活动目录中创建用户，反之亦然，那么在 AD 实例之间建立联合/信任关系是否有意义？如果是这样，应该考虑什么？合作伙伴 AD 中用户的 ACL 是否仍以相同方式工作？这会暴露哪些安全风险？

谢谢！

K A

**更新：**

我了解到，通过让应用程序本身检查用户存储，有一种更好的方法可以做到这一点。最好的方法是将应用程序移动到两个用户存储都信任的域中。我在下面的答案中提供了更多详细信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T19:58:54.980

我一直在研究这个，我找到了一个很好的解决方案。由于两家公司都需要使用同一个系统，因此系统本身只需要验证用户是否存在于任一用户存储中（身份验证），然后在系统级别进行授权。

为两家公司提供访问权限背后的想法是可靠的 - 如果我们一起工作并且没有办法做到这一点，我们需要重新创建公司的所有用户，而无需在连接的用户存储中访问。显然，这将是一团糟和维护的噩梦。

我发现在我的情况下，即使两个 AD 在同一个 WAN 上，也有必要建立一个正式的联盟或信任。值得庆幸的是，我们已经有了一个在两家公司之间都可以信任的域，所以我只需要将合作伙伴使用的应用程序移到这个域中。之后，只需完全限定 DNS 后缀以指示正在使用的 AD。然后，特定于应用程序的 ACL 引用所需的用户存储。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T13:09:32.580

是的，如果您希望两者都能够跨多个域对人员进行身份验证，这是有道理的。您必须将具有您所针对的应用程序的服务器放在您要用于身份验证的每个 AD 实例信任的域中。

# licensing - 选择什么版权许可？

> ID：273507
> 
> 赞同：4
> 
> 时间：2008-11-07T20:17:14.433
> 
> 标签：licensing

为了以所有可能的方式向公众免费提供代码，选择什么版权许可类型。

“麻省理工学院许可证”是最佳选择吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-07T20:18:21.373

将您的代码作为[公共领域](http://en.wikipedia.org/wiki/Public_domain)发布是使其以*所有*可能方式免费的最佳方式。[SQLite](http://sqlite.org)是一个著名的公共领域库（他们有[一个](http://sqlite.org/copyright.html)解释他们的许可证的页面）。

话虽如此，公共领域的代码可以被其他任何人简单地获取，他们可以称其为自己的。这就是为什么存在像 GPL/BSD/MIT/等这样的免费许可证，您可以在其中保留对工作的一些所有权。

就个人而言，我更喜欢 BSD 或 MIT 之类的许可证，因为它们不像 GPL 那样严格。GPL 对代码的用户可以做什么和不能做什么有很多话要说。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-07T20:22:42.127

MIT 许可证非常接近于公共领域，尽管它确实要求人们包含许可证本身，因此它的限制性稍强。你想强迫人们使用你的软件给你的功劳吗？比这更严格的是 LGPL，它是自我传播的。GPL 的限制更为严格，但会使您的软件不太容易在商业代码中使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T21:03:28.830

如果您的目标是使您的代码对世界上的每个人都有用和可用，请选择一个特定的自由许可证，明确赋予人们使用您的工作的权利。具有法律部门的组织喜欢明确的许可证，人们想要在他们的管辖范围内工作的许可证。

尽管 Greg 提到了 SQLite，但他并没有指出他们[在许可证页面上](http://sqlite.org/copyright.html)承认公共领域的问题，以及它如何不能在任何地方都适用于所有人和每次使用。公共领域实际上限制了一些人，所以他们也出售许可证。此外，请查看[CC 许可的知识共享常见问题解答尚未移植到我的司法管辖区（国家/地区）。我能做些什么？](http://wiki.creativecommons.org/FFAQ#CC_licenses_haven.27t_been_ported_to_my_jurisdiction_.28country.29._What_can_I_do.3F)有关许可证的国际问题的更多信息。

如果这对您来说不是一个随意的决定，例如发布以前由一家大公司拥有的庞大代码库，您可能想要找一位真正的知识产权律师，而不是问一堆程序员。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T21:06:38.637

在线查看一些许可证摘要（有关链接，请参阅此[问题](https://stackoverflow.com/questions/23098/why-the-proliferation-of-open-source-licenses)）。只是不要自己写！

# c# - 如何在 C# 控件中创建 activeX 并在 ASP.NET 站点中引用它？

> ID：273508
> 
> 赞同：1
> 
> 时间：2008-11-07T20:17:32.340
> 
> 标签：c#, asp.net, activex

如何在 C# 库项目中创建一个 activeX 控件，然后在另一个 ASP.NET 湿站点项目中引用它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:22:00.850

ActiveX 是用于客户端还是服务器？

如果对于服务器，只需使用对托管程序集的直接引用（不需要 COM）。

作为客户端，坦率地说，我不确定编写 ActiveX 控件是否是个好主意——大多数浏览器不会喜欢它们。对于更复杂的事情，您最好使用 AJAX 和 DHTML，或者 Silverlight / Acrobat / 等。

[更新] 所以你想在客户端使用 ActiveX ......我的下一个想法是“Silverlight 可以访问证书存储吗？” 我什么都找不到，虽然...

分发 ActiveX 控件（对于 IE）通常是将 dll 打包到 cab 中，将其标记为安全的脚本和激活安全。然后，您将 cab 放在 web 服务器上，在 bage 上，您有一个`<object...>...</object>`元素指定 cab 的源（代码库）。

我必须强调，这种方法会非常失败。它不适用于许多浏览器，并且会在*某些时间*在 IE 上运行（取决于用户的安全设置）。我不推荐它。

一个更实用的选择可能是编写一个独立的 .NET exe，通过 ClickOnce 打包（在 VS 中为“发布”）；将 ClickOnce 部署放到网站上，然后导航到应用程序。瞧 - 客户端上的完整 .NET 代码，没有浏览器问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T20:21:07.857

如果您使用 C#/.NET 来构建您的控件并从 ASP.NET 使用它，您将通过将其作为标准 .NET 程序集引用它来获得更好的性能（并减少您的痛苦），完全绕过 ActiveX。希望这可以帮助！

亚当

# php - 你如何实现一个好的亵渎过滤器？

> ID：273516
> 
> 赞同：214
> 
> 时间：2008-11-07T20:19:41.417
> 
> 标签：php, regex, user-input

我们中的许多人需要处理用户输入、搜索查询以及输入文本可能包含亵渎或不良语言的情况。通常这需要被过滤掉。

在哪里可以找到各种语言和方言的脏话列表？

是否有可用于包含良好列表的来源的 API？或者可能是一个 API 简单地说“是的，这是干净的”或“不，这是脏的”，带有一些参数？

有什么好的方法可以抓住试图欺骗系统的人，比如 a$$、azz 或 a55？

如果您提供 PHP 解决方案，则可获得奖励积分。:)

## *编辑：回应说只是避免程序问题的答案：*

我认为当用户可以使用公共图片搜索来查找添加到敏感社区池中的图片时，这种过滤器是有用的。如果他们可以搜索“阴茎”，那么他们可能会得到很多照片，是的。如果我们不想要那个图片，那么阻止这个词作为搜索词是一个很好的看门人，尽管公认不是一个万无一失的方法。首先获取单词列表是真正的问题。

所以我真的指的是一种方法来确定单个令牌是否脏，然后简单地禁止它。我不会费心阻止像完全热闹的“长颈长颈鹿”参考这样的情绪。你在那里无能为力。:)

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2008-11-07T20:21:12.833

[淫秽过滤器：坏主意，还是令人难以置信的相互交流的坏主意？](http://blog.codinghorror.com/obscenity-filters-bad-idea-or-incredibly-intercoursing-bad-idea/)

此外，人们不能忘记[Toontown 的 SpeedChat 的不为人知的历史](http://habitatchronicles.com/2007/03/the-untold-history-of-toontowns-speedchat-or-blockchattm-from-disney-finally-arrives/)，即使使用“安全词白名单”也会导致一个 14 岁的孩子迅速绕过它： *“我想把我的长颈长颈鹿粘在你的蓬松白兔。”*

底线：最终，对于您实施的任何系统，绝对无法替代人工审查（无论是同行还是其他方式）。随意实施一个基本的工具来摆脱路过的，但对于坚定的巨魔，你绝对必须有一个非基于算法的方法。

消除匿名性并引入问责制（Stack Overflow 做得很好）的系统也很有帮助，特别是为了帮助对抗[John Gabriel 的 GIFT](http://www.penny-arcade.com/comic/2004/03/19/)

您还询问了从哪里可以获得亵渎列表以帮助您入门——一个要检查的开源项目是[Dansguardian——](http://dansguardian.org)查看其默认亵渎列表的源代码。您还可以为代理下载一个额外的第三方[短语列表](http://contentfilter.futuragts.com/phraselists/)，这可能对您很有帮助。

**编辑以回应问题编辑：**感谢您澄清您正在尝试做的事情。在这种情况下，如果您只是尝试做一个简单的单词过滤器，有两种方法可以做到。一种是创建一个包含您想要审查的所有禁止短语的单个长正则表达式，然后只用它进行正则表达式查找/替换。像这样的正则表达式：

```
$filterRegex = "(boogers|snot|poop|shucks|argh)" 
```

[并使用preg_match()](http://us.php.net/preg_match)在您的输入字符串上运行它以批发测试命中，

或[preg_replace()](http://us.php.net/preg_replace)将它们清空。

您还可以使用数组而不是单个长正则表达式加载这些函数，并且对于长单词列表，它可能更易于管理。有关如何灵活使用数组的一些很好的示例，请参见[preg_replace() 。](http://us.php.net/preg_replace)

有关其他 PHP 编程示例，请参阅此页面以获取用于单词过滤的更[高级的通用类](http://www.bitrepository.com/advanced-word-filter.html)，其中 * 是来自被审查单词的中心字母，以及[之前的 Stack Overflow 问题](https://stackoverflow.com/questions/24515/bad-words-filter)也有一个 PHP 示例（其中主要有价值的部分是基于 SQL 的过滤词方法——如果你觉得没有必要，可以省略 leet-speak 补偿器）。

您还补充说：“*首先获取单词列表才是真正的问题。* ”——除了一些以前的 Dansgaurdian 链接之外，您可能会发现[这个 458 个单词的方便 .zip](http://urbanoalvarez.es/blog/2008/04/04/bad-words-list/)很有帮助。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2012-11-19T04:27:21.010

虽然我知道这个问题已经相当老了，但这是一个常见的问题......

对脏话过滤器既有原因也有明显的需求（请参阅[此处的 Wikipedia 条目](http://en.wikipedia.org/wiki/Profanity_filter)），但由于非常明显的原因，它们通常不能 100% 准确；**上下文**和**准确性**。

这（完全）取决于你想要达到的目标——在最基本的情况下，你可能试图掩盖“[七个肮脏的词](http://en.wikipedia.org/wiki/Seven_dirty_words)”，然后……有些企业需要过滤最基本的亵渎：基本脏话、网址甚至个人信息等，但其他人需要防止非法帐户命名（Xbox live 就是一个例子）或者更多......

用户生成的内容不仅包含潜在的脏话，还可能包含对以下内容的冒犯性引用：

*   性行为
*   性取向
*   宗教
*   种族
*   ETC...

并且可能会使用多种语言。迄今为止， Shutterstock 已经开发了 10 种语言的[基本脏词列表](https://github.com/shutterstock/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words)，但它仍然是基本的，并且非常面向他们的“标记”需求。网络上还有许多其他列表。

我同意公认的答案，即它不是一门明确的科学，*因为*语言是一个不断发展的*挑战*，但 90% 的捕获率优于 0%。这完全取决于你的目标——你想要达到的目标、你所拥有的支持水平以及消除不同类型的亵渎行为的重要性。

在构建过滤器时，您需要考虑以下元素以及它们与您的项目的关系：

*   单词/短语
*   首字母缩略词（FOAD/LMFAO 等）
*   [误报](http://en.wikipedia.org/wiki/False_positive#Type_I_error)（单词、地点和名称，如“mishit”、“scunthorpe”和“titsworth”）
*   URL（色情网站是一个明显的目标）
*   个人信息（电子邮件、地址、电话等 - 如果适用）
*   语言选择（通常默认为英语）
*   审核（如果有的话，您如何与用户生成的内容进行交互以及您可以用它做什么）

您可以轻松构建一个能够捕获 90% 以上的脏话的脏话过滤器，但您永远不会达到 100%。这是不可能的。越接近 100%，就越难……在过去构建了一个复杂的亵渎引擎，每天处理超过 50 万条实时消息，我提供以下建议：

**基本过滤器将涉及：**

*   建立适用的脏话列表
*   开发处理亵渎派生的方法

**一个中等复杂的文件管理器将涉及，（除了一个基本的过滤器）：**

*   使用复杂模式匹配来处理扩展派生（使用高级正则表达式）
*   处理[Leetspeak](http://en.wikipedia.org/wiki/Leet) (l33t)
*   处理[误报](http://en.wikipedia.org/wiki/False_positive#Type_I_error)

**一个复杂的过滤器将涉及以下一些（除了中等过滤器）：**

*   [白名单](http://en.wikipedia.org/wiki/White_list)和黑名单
*   短语/术语的[朴素贝叶斯推理过滤](http://en.wikipedia.org/wiki/Bayesian_inference)
*   [Soundex](http://en.wikipedia.org/wiki/Soundex)函数（一个词听起来像另一个词）
*   [莱文斯坦距离](http://en.wikipedia.org/wiki/Levenshtein_distance)
*   [词干](http://en.wikipedia.org/wiki/Porter_Stemmer)
*   人工主持人帮助指导过滤引擎通过示例学习或在没有指导的情况下匹配不够准确（自我/持续改进的系统）
*   也许某种形式的人工智能引擎

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-11-07T20:26:00.903

我不知道有什么好的库可以解决这个问题，但无论你做什么，都要确保你在让东西通过的方向上犯了错误。我处理过不允许我使用“mpassell”作为用户名的系统，因为它包含“ass”作为子字符串。这是疏远用户的好方法！

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-11-07T22:27:08.943

亵渎过滤系统永远不会是完美的，即使程序员很自信并且跟上所有裸体的发展

也就是说，任何“淘气词”列表的性能都可能与其他列表一样好，因为潜在的问题是*语言理解*，这对于当前的技术来说非常棘手

因此，唯一实用的解决方案是双重的：

1.  准备好经常更新你的字典
2.  聘请人工编辑来纠正误报（例如“clbuttic”而不是“经典”）和误报（哎呀！错过了一个！）

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-11-07T22:36:23.653

在我的一次工作面试中，面试我的公司 CTO 试用了我用 Java 编写的文字/网页游戏。在整个牛津英语词典的单词列表中，第一个被猜到的单词是什么？

当然是英语中最脏的词。

不知何故，我仍然得到了工作机会，但我随后找到了一个亵渎词列表（[与这个不同](http://www.jivesoftware.com/jivespace/docs/DOC-1906)）并编写了一个快速脚本来生成一个没有所有坏词的新字典（甚至不必查看列表） .

对于您的特定情况，我认为将搜索与真实单词进行比较听起来像是使用这样的单词列表的方式。替代样式/标点符号需要更多的工作，但我怀疑用户会经常使用它来成为一个问题。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-11-07T20:42:39.200

防止冒犯性用户输入的唯一方法是阻止所有用户输入。

如果您坚持允许用户输入并需要审核，那么请加入人工审核员。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-11-07T20:27:24.317

看看[CDYNE 的亵渎过滤器 Web 服务](http://wiki.cdyne.com/wiki/index.php?title=Profanity_Filter)

[测试网址](http://ws.cdyne.com/ProfanityWS/Profanity.asmx)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-04-27T12:55:55.407

注意本地化问题：在一种语言中是脏话，在另一种语言中可能是完全正常的词。

这方面的一个当前示例：ebay 使用字典方法从反馈中过滤“坏词”。如果您尝试输入“这是一个完美的交易”（“das war eine perfekte Transaktion”）的德文翻译，ebay 将拒绝因不良词的反馈。

为什么？因为“was”的德语单词是“war”，而“war”在ebay的“坏词”词典中。

所以要注意本地化问题。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-11-08T01:35:13.167

关于您的“欺骗系统”子问题，您可以在进行搜索之前通过规范化“坏词”列表和用户输入的文本来处理它。例如，使用一系列正则表达式（或**tr**，如果 PHP 有它）将**[z$5]**转换为“s”，将**[4@]**转换为“a”等，然后将规范化的“坏词”列表与规范化的列表进行比较文本。请注意，标准化可能会导致额外的误报，尽管目前我想不出任何实际案例。

更大的挑战是想出一些东西，让人们引用“**笔**比剑更强大”，同时阻止“阴茎”。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2017-03-03T08:22:10.967

我收集了12种语言的2200个坏词：en、ar、cs、da、de、eo、es、fa、fi、fr、hi、hu、it、ja、ko、nl、no、pl、pt、ru、sv , th, tlh, tr, zh。

MySQL 转储、JSON、XML 或 CSV 选项可用。

[https://github.com/turalus/openDB](https://github.com/turalus/openDB)

我建议您将此 SQL 执行到您的数据库中，并在每次用户输入内容时进行检查。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-11-07T20:46:59.007

如果您可以执行 Digg/Stackoverflow 之类的操作，用户可以在其中投票/标记淫秽内容……请这样做。

然后你需要做的就是审查那些“淘气”的用户，如果他们违反了规则就阻止他们。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-10-29T03:22:52.477

我参加聚会有点晚了，但我有一个可能对阅读本文的人有用的解决方案。它在 javascript 而不是 php 中，但这是有正当理由的。

> 完全披露，我写了这个插件......

无论如何。

我采用的方法是允许用户“选择加入”他们的脏话过滤。基本上默认情况下允许亵渎，但如果我的用户不想阅读它，他们不必阅读。这也有助于解决“l33t sp3@k”问题。

这个概念是一个简单的[jquery](/questions/tagged/jquery "显示标记为“jquery”的问题")插件，如果客户端的帐户启用了亵渎过滤，它会被服务器注入。从那里开始，只需几条简单的线条就可以消除脏话。

这是演示页面
[https://chaseflorell.github.io/jQuery.ProfanityFilter/demo/](https://chaseflorell.github.io/jQuery.ProfanityFilter/demo/)

```
<div id="foo">
    ass will fail but password will not
</div>

<script>
    // code:
    $('#foo').profanityFilter({
        customSwears: ['ass']
    });
</script> 
```

**结果**

> *** 会失败，但密码不会

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-04-25T16:47:47.050

也在游戏后期，但做了一些研究并偶然发现了这里。正如其他人所提到的，如果它是自动化的，这几乎几乎是不可能的，但是如果您的设计/需求在某些情况下（但不是所有时间）可能涉及人工交互来检查它是否是亵渎的，那么您可以考虑 ML。 [https://docs.microsoft.com/en-us/azure/cognitive-services/content-moderator/text-moderation-api#profanity](https://docs.microsoft.com/en-us/azure/cognitive-services/content-moderator/text-moderation-api#profanity)是我目前的选择，原因有很多：

*   支持多种本地化
*   他们不断更新数据库，所以我不必跟上最新的俚语或语言（维护问题）
*   当概率很高（即 90% 或更多）时，您可以务实地否认它
*   您可以观察导致标记可能是或可能不是亵渎的类别，并且可以让某人对其进行审查以教导它是否亵渎。

根据我的需要，它是/基于公共友好的商业服务（好的，视频游戏），其他用户可能/将会看到用户名，但设计要求它必须通过亵渎过滤器来拒绝冒犯性的用户名。可悲的是，很可能会发生经典的“clbuttic”问题，因为用户名通常是单个单词（最多 N 个字符），有时是多个单词连接在一起......同样，Microsoft 的认知服务不会将“Assist”标记为文本。 HasProfanity=true 但可能将其中一个类别的概率标记为高。

正如 OP 询问的那样，“a$$”怎么样，这是我通过过滤器时的结果：[![在此处输入图像描述](https://i.stack.imgur.com/dRYeT.png)](https://i.stack.imgur.com/dRYeT.png)如您所见，它已确定它不是亵渎神灵，但它很有可能是，所以标记为推荐审查（人际互动）。

当概率很高时，我可以返回“对不起，那个名字已经被占用了”（即使不是），这样如果我们不想的话，它对反审查人员或其他东西的冒犯性就会降低集成人工审核，或返回“您的用户名已通知直播运营部门，您可以等待您的用户名审核通过或选择其他用户名”。管他呢...

顺便说一句，就我的目的而言，这项服务的成本/价格非常低（用户名多久更改一次？），但同样，对于 OP，设计可能需要更密集的查询，并且可能不适合付费/订阅ML 服务，或者不能进行人工审查/交互。这一切都取决于设计......但如果设计确实符合要求，也许这可以成为 OP 的解决方案。

如果有兴趣，我可以在以后的评论中列出缺点。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-24T20:30:20.737

我同意 HanClinto 在本次讨论中较高的帖子。我通常使用正则表达式来匹配输入文本。这是徒劳的，因为，就像您最初提到的那样，您必须在“阻止”列表中明确说明网络上流行的每种写作技巧形式。

在旁注中，当其他人在争论审查制度的伦理时，我必须同意某种形式在网络上是必要的。有些人只是喜欢张贴粗俗，因为它可以立即冒犯一大群人，并且绝对不需要作者考虑。

谢谢你的想法。

汉克林托规则！

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-08-16T02:33:47.447

一旦你有一个很好的 MYSQL 表，其中包含一些你想要过滤的坏词（我从这个线程中的一个链接开始），你可以做这样的事情：

```
$errors = array();  //Initialize error array (I use this with all my PHP form validations)

$SCREENNAME = mysql_real_escape_string($_POST['SCREENNAME']); //Escape the input data to prevent SQL injection when you query the profanity table.

$ProfanityCheckString = strtoupper($SCREENNAME); //Make the input string uppercase (so that 'BaDwOrD' is the same as 'BADWORD').  All your values in the profanity table will need to be UPPERCASE for this to work.

$ProfanityCheckString = preg_replace('/[_-]/','',$ProfanityCheckString); //I allow alphanumeric, underscores, and dashes...nothing else (I control this with PHP form validation).  Pull out non-alphanumeric characters so 'B-A-D-W-O-R-D' shows up as 'BADWORD'.

$ProfanityCheckString = preg_replace('/1/','I',$ProfanityCheckString); //Replace common numeric representations of letters so '84DW0RD' shows up as 'BADWORD'.

$ProfanityCheckString = preg_replace('/3/','E',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/4/','A',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/5/','S',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/6/','G',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/7/','T',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/8/','B',$ProfanityCheckString);

$ProfanityCheckString = preg_replace('/0/','O',$ProfanityCheckString); //Replace ZERO's with O's (Capital letter o's).

$ProfanityCheckString = preg_replace('/Z/','S',$ProfanityCheckString); //Replace Z's with S's, another common substitution.  Make sure you replace Z's with S's in your profanity database for this to work properly.  Same with all the numbers too--having S3X7 in your database won't work, since this code would render that string as 'SEXY'.  The profanity table should have the "rendered" version of the bad words.

$CheckProfanity = mysql_query("SELECT * FROM DATABASE.TABLE p WHERE p.WORD = '".$ProfanityCheckString."'");
if(mysql_num_rows($CheckProfanity) > 0) {$errors[] = 'Please select another Screen Name.';} //Check your profanity table for the scrubbed input.  You could get real crazy using LIKE and wildcards, but I only want a simple profanity filter.

if (count($errors) > 0) {foreach($errors as $error) {$errorString .= "<span class='PHPError'>$error</span><br /><br />";} echo $errorString;} //Echo any PHP errors that come out of the validation, including any profanity flagging.

//You can also use these lines to troubleshoot.
//echo $ProfanityCheckString;
//echo "<br />";
//echo mysql_error();
//echo "<br />"; 
```

我确信有一种更有效的方法来完成所有这些替换，但我不够聪明，无法弄清楚（这似乎工作正常，尽管效率低下）。

我认为您应该在允许用户注册方面犯错，并根据需要使用人工过滤并添加到您的亵渎表中。尽管这一切都取决于误报（好的词被标记为坏词）与误报（坏词通过）的成本。这应该最终决定您在过滤策略中的激进或保守程度。

如果你想使用通配符，我也会非常小心，因为它们有时会比你想要的更繁重。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-07T20:25:28.860

坦率地说，我会让他们说出“欺骗系统”的话并禁止他们，这就是我。但它也使编程更简单。

我要做的是像这样实现一个正则表达式过滤器：`/[\s]dooby (doo?)[\s]/i`或者这个词在其他词上加上前缀，`/[\s]doob(er|ed|est)[\s]/`. 这些将阻止过滤像 assuaged 这样的词，这是完全有效的，但如果你学习一个新的变体，还需要了解其他变体并更新实际的过滤器。显然这些都是例子，但你必须自己决定如何做。

我不打算打出我知道的所有单词，而不是在我实际上不想知道它们的时候。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-07T20:37:46.777

不。它只会导致问题。我对亵渎过滤器的一次个人经历是我被 IRC 频道踢/禁止的时间，因为我提到我“要过桥去汉考克几个小时”或类似的东西。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-09-30T09:01:18.970

我同意这个主题的徒劳，但如果你必须有一个过滤器，看看宁的[黄杨木](http://github.com/ning/boxwood)：

> Boxwood 是一个 PHP 扩展，用于快速替换一段文本中的多个单词。它支持区分大小写和不区分大小写的匹配。它要求将其操作的文本编码为 UTF-8。

另请参阅此博客文章了解更多详细信息：

*   [PHP中的快速多字符串替换](http://www.sklar.com/blog/archives/122-Fast-Multiple-String-Replacement-in-PHP.html)

> 使用 Boxwood，您可以将搜索词列表设置为任意长度 - 搜索和替换算法不会因为要查找的词列表中的词越多而变慢。它的工作原理是构建所有搜索词的 trie，然后只扫描一次主题文本，遍历 trie 的元素并将它们与文本中的字符进行比较。它支持 US-ASCII 和 UTF-8，区分大小写或不区分大小写，并具有一些以英语为中心的单词边界检查逻辑。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-10-12T02:51:31.847

我总结说，为了创建一个好的亵渎过滤器，我们需要 3 个主要组件，或者至少这是我要做的。它们是：

1.  过滤器：根据黑名单、字典或类似的东西进行验证的后台服务。
2.  不允许匿名帐户
3.  报告滥用

奖金，它将以某种方式奖励那些提供准确滥用报告的人并惩罚违规者，例如暂停他们的帐户。

* * *

## 回答 #20

> 赞同：-8
> 
> 时间：2008-11-07T20:22:31.567

不。

因为：

*   **[克布蒂克](http://www.urbandictionary.com/define.php?term=clbuttic)**
*   亵渎不是 OMG EVIL
*   无法有效定义亵渎
*   大多数人很可能不喜欢被“保护”免受亵渎

编辑：虽然我同意评论者所说的“审查是错误的”，但这不是这个答案的本质。

# python - Python 3.0 和语言演变

> ID：273524
> 
> 赞同：12
> 
> 时间：2008-11-07T20:23:14.700
> 
> 标签：python, programming-languages, python-3.x

Python 3.0 打破了与以前版本的向后兼容性，并将语言分为两条路径（至少暂时如此）。你知道在成熟期经历过如此重要设计阶段的任何其他语言吗？

另外，您认为这就是编程语言应该发展的方式，还是付出的代价太高了？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-07T20:37:22.427

我能想到的唯一尝试进行这种中游更改的语言是 Perl。当然，Python 是通过首先发布来击败 Perl 的。然而，应该注意的是，Perl 的变化比 Python 的要广泛得多，而且可能更难解开。

（Perl 的“有不止一种方法可以做到”的哲学是有代价的。）

有一些例子，比如基于 .NET 的语言版本之间的变化（讽刺的是，考虑到 .NET 的全部重点应该是 API 稳定性和跨平台兼容性）。但是，我几乎不会将这些语言称为“成熟”。它一直更像是一种在旅途中设计、在飞行时建造飞机的方法。

或者，正如我倾向于认为的那样，大多数语言要么来自“有机增长”，要么来自“工程建设”。Perl 是有机增长的完美例子；它最初是一个花哨的文本处理工具 ala awk/sed，后来发展成为一种完整的语言。

另一方面，Python 的工程化程度更高。花点时间浏览他们网站上的大量白皮书，看看对语言语法和实现的每一个微小变化都会引起广泛的争论。

进行这些影响深远的改变的想法对于编程语言来说有些新奇，因为编程语言本身在本质上已经发生了变化。过去，只有当具有新指令集的新处理器问世时，编程方法才会发生变化。早期的语言要么过于低级并与汇编语言（例如 C）相结合，要么在本质上是完全动态的（Forth、Lisp），以至于这种中游变化甚至都不会被考虑在内。

至于这些变化是否是好的，我不确定。然而，我倾向于相信指导 Python 开发的人。迄今为止，语言的变化在很大程度上是向好的方向发展。

我认为在未来的日子里，全局解释器锁将被证明比语法更改更重要。尽管新的多处理器库可能会缓解大部分问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-07T21:25:59.957

坚持近乎绝对的向后兼容性的代价实在是太高了。如果您想了解原因，请花两分钟用 C++ 编程。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-07T20:37:50.100

python 团队一直在努力使缺乏向后兼容性的问题尽可能轻松，以至于创建 2.6 版本的 python 时考虑到了轻松升级过程。升级到 2.6 后，您可以运行一些脚本，这些脚本将毫无问题地转移到 3.0。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-07T21:17:04.030

值得一提的是，向后兼容会产生其自身的成本。在某些情况下，如果需要 100% 的向后兼容性，几乎不可能以理想的方式发展一种语言。Java 的泛型实现（它在编译时擦除类型信息以便向后兼容）是一个很好的例子，说明实现具有 100% 向后兼容性的特性会导致语言特性次优。

松散地说，它可以归结为在一个实现不佳但向后兼容的新特性或一个实现良好但不兼容的新特性之间做出选择。在许多情况下，后者是更好的选择，特别是如果有可以自动翻译不兼容代码的工具。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-07T21:24:29.337

我认为有很多向后兼容性破坏的例子。许多这样做的语言要么很小，要么在此过程中消失了。

这方面的许多例子都涉及重命名语言。

Algol 60 和 Algol 68 是如此不同，以至于 Algol 68 上的会议分裂成派别。Algol 68 派系、Pascal 派系和 PL/I 派系。

Wirth 的 Pascal 变成了 Modula-3。它与 pascal 非常相似——非常相似的语法和语义——但有几个新特性。那真的是没有向后兼容性的 Pascal-2 吗？

Lisp to Scheme 事情涉及重命名。

如果您浏览一下旧的[B 编程语言](http://cm.bell-labs.com/cm/cs/who/dmr/bintro.html)手册，您会发现向 C 的演变看起来是一种渐进式的——不是激进的——但它确实破坏了兼容性。

Fortran 以多种形式存在。我不确定，但我认为用于 VAX/VMS 的 Digital 的 Fortran 90 与古老的 Fortran IV 程序并不完全兼容。

RPG 经历了重大变革——我认为实际上有两种不兼容的语言称为 RPG。

**底线** 我认为*思考*和*学习*是不可避免的。对于学习一种语言的局限性，你有三种反应。

1.  发明一种完全不兼容的新语言。

2.  逐渐改变，直到你被迫发明一种新语言。

3.  以一种可控的、深思熟虑的方式打破兼容性。

我认为＃1和＃2都是懦夫的出路。抓住旧的比试图保存它更容易。保留每一个细微差别的功能（无论多么糟糕）都是一项艰巨的工作，其中一些工作几乎没有价值。

商业企业以“新营销”或“保留现有客户”的名义选择懦弱的做法。这就是为什么商业软件企业不是创新的温床。

我认为**只有**开源项目才能以 Python 社区应对这种变化的方式拥抱创新。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-07T20:27:16.953

C# 和 .NET 框架破坏了 1.0 和 1.1 版本之间以及 1.1 和 2.0 之间的兼容性。运行不同版本的应用程序需要安装多个版本的 .NET 运行时。

至少他们确实包含了一个升级向导，用于将源代码从一个版本升级到下一个版本（它适用于我们的大部分代码）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-07T23:29:44.590

VB6 到 VB.net 不是最大的例子吗？还是你们都认为它们是两种不同的语言？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-07T21:09:55.963

在 Lisp 世界中，这种情况已经发生过几次。当然，语言是如此动态，以至于通常进化只是弃用标准库的一部分并使另一部分成为标准。

此外，Lua 4 到 5 非常重要；但是语言核心是如此之少，以至于即使是广泛的更改也可以在几页中记录下来。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-07T20:28:09.120

Perl 6 现在也在经历这种类型的拆分。Perl 5 程序不会直接在 Perl 6 上运行，但是会有一个翻译器将代码翻译成可以工作的形式（我认为它不能处理 100% 的情况）。

[Perl 6](http://en.wikipedia.org/wiki/Perl_6)甚至在 Wikipedia 上有自己的文章。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-07T20:30:00.460

首先，这是一个关于 Python 将经历的变化的[视频讨论。](http://video.google.com/videoplay?docid=1189446823303316785)第二，变化不好。第三，我欢迎进化并相信这是必要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-08T04:03:43.257

gcc regularly changes how it handles C++ almost every minor release. Of course, this is more a consequence of gcc tightening how they follow the rules, and less of C++ itself changing.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-09T12:38:57.730

新版本的 Ruby 编程语言也会破坏兼容性。

想想可能使用的库：gtk、Qt 等等（它们也有不兼容的版本）。

我认为有时（但不是太频繁）不兼容是必要的，以支持进步。

# java - 用于纠偏和裁剪图像的 Java 图像库

> ID：273530
> 
> 赞同：6
> 
> 时间：2008-11-07T20:25:08.440
> 
> 标签：java, image-processing, crop

是否有人对执行图像自动裁剪和纠偏的 java 库有建议（例如从平板扫描仪检索的图像）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2016-03-27T13:42:57.267

**去偏斜**

看看[Tess4j（Tesseract 的 Java JNA 包装器）](https://github.com/nguyenq/tess4j)。

您可以将[ImageDeskew.getSkewAngle()](http://tess4j.sourceforge.net/docs/docs-2.0/index.html?com/recognition/software/jdeskew/ImageDeskew.html)与[ImageHelper.rotate(BufferedImage image, double angle)](http://tess4j.sourceforge.net/docs/docs-2.0/index.html?net/sourceforge/tess4j/util/ImageHelper.html)结合使用。

[在 tess4j 项目Tesseract1Test.java](https://github.com/nguyenq/tess4j/blob/master/src/test/java/net/sourceforge/tess4j/Tesseract1Test.java#L177)的 test 文件夹上有一个如何使用它的示例

```
public void testDoOCR_SkewedImage() throws Exception {
    logger.info("doOCR on a skewed PNG image");
    File imageFile = new File(this.testResourcesDataPath, "eurotext_deskew.png");
    BufferedImage bi = ImageIO.read(imageFile);
    ImageDeskew id = new ImageDeskew(bi);
    double imageSkewAngle = id.getSkewAngle(); // determine skew angle
    if ((imageSkewAngle > MINIMUM_DESKEW_THRESHOLD || imageSkewAngle < -(MINIMUM_DESKEW_THRESHOLD))) {
        bi = ImageHelper.rotateImage(bi, -imageSkewAngle); // deskew image
    }

    String expResult = "The (quick) [brown] {fox} jumps!\nOver the $43,456.78 <lazy> #90 dog";
    String result = instance.doOCR(bi);
    logger.info(result);
    assertEquals(expResult, result.substring(0, expResult.length()));
} 
```

[![eurotext_deskew.png](https://i.stack.imgur.com/goIQD.png)](https://i.stack.imgur.com/goIQD.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T20:29:25.123

[ImageMagick](http://www.imagemagick.org)可以做到这一点；您可以使用[ImageMagick Java 绑定](http://sourceforge.net/projects/jmagick/)。[自动裁剪](http://www.imagemagick.org/Usage/crop/#trim)运算符可能是您正在寻找的。自动纠偏是一个更难的问题，涉及一些重要的图像处理。我不确定 ImageMagick 是否可以处理。如果您可以使用其他方法计算出倾斜参数，ImageMagick 绝对可以为您取消倾斜。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-10-28T12:46:41.547

我写了一个[笔记](http://anydoby.com/jblog/en/java/1990)，一个非常好的deskewer的简单端口。如果图像中有一些文字，效果最好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T20:31:47.973

[我想有人在Java Advanced Imaging API](http://java.sun.com/javase/technologies/desktop/media/jai/)之上构建了一个库来执行此操作。您可以尝试谷歌搜索“Java Advanced Imaging 纠偏”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-24T13:25:40.823

我编写了一个简单的图像校正应用程序，包括源代码。可在：

[http://www.recognition-software.com/image/deskew/](http://www.recognition-software.com/image/deskew/)

# asp.net - 控制权限的最佳实践？

> ID：273534
> 
> 赞同：3
> 
> 时间：2008-11-07T20:25:41.043
> 
> 标签：asp.net, security, controls, permissions

大家好，我需要一些建议...

我们在数据库中设置了某些权限，以便用户可以对应用程序进行某些级别的控制。禁用、只读和编辑。

我的问题是：是否有比编写安全方法/检查每页以根据允许的权限启用/禁用/隐藏/显示适当控件的更通用/更好的方法来处理应用于页面上表单元素的权限？

任何人都有以不同方式处理此问题的经验吗？

编辑：

我只是考虑了为需要安全性的每一层添加常量然后在用户类中添加一个 IsAuthorized 函数的可能性，该函数将接受控件所在表单中的常量，并返回布尔值以启用/禁用控件，这将确实减少了当/如果我需要修改所有表单的安全性时我必须打的地方的数量。

干杯!

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T23:01:48.480

很抱歉在这里稍微偏离主题，但从我的错误中吸取教训：

有一次我正在开发一个简单的网络应用程序，我认为我应该设置 3 个安全级别：有限只读（公共）、读限制写（用户）、读写（管理员）。用户表具有一定的安全级别，并且一切正常……直到随着项目的发展，我需要更好地控制安全级别。这一切都始于一个用户，该用户需要的不仅仅是在程序的一个区域进行用户控制，而不是完全的管理员控制。

我应该做的是设置一个具有更好控制的可扩展系统，即使我一开始并不需要它。这会为我节省很多时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T21:00:04.203

我认为有比您考虑的更多的可能性。

*   隐藏/可见 - 字段是否可见
*   空白/系统/未更改 - 系统最初是否将该值设置为空白，或设置为某些业务规则提供的值，还是保持原样
*   只读/可编辑 - 用户可以更改值吗
*   必填/留空/可选 - 字段必须不为空，或者假设它是空白的，它可以留空，或者它是可选的并且在任何情况下都可以为空

此外，您还需要考虑做出决定的许多因素

*   角色 - 通常用户有 1 个或多个角色，这些角色可以允许或禁止不同的可能性
*   状态 - 相关对象的状态通常控制哪些字段是可编辑的，无论角色如何
*   对象 - 通常对象本身的值决定什么时候被允许，而不仅仅是它的状态
*   任务 - 您可能会将编辑内容分解为不仅仅是阅读和编辑
*   部分 - 我经常想控制对象或屏幕的整个部分的设置，所有控件都继承这些设置，但如果需要可以单独覆盖它们

执行？首先，确保您对如何处理页面生命周期有清晰的认识。我的通常是这样的。

*   获取他们正在编辑的对象，通常来自会话状态，有时如果他们正在执行“新”操作，您可能需要创建一个存根数据结构供他们使用
*   如果这是第一次加载页面，将选项填充到下拉列表中，这通常是一个通用过程，只完成一次
*   如果这是回发，则通过从控件中读取值来更新正在编辑的对象
*   处理按钮点击等事件
*   运行所有业务编辑，这些应该会改变他们正在编辑的数据结构
*   根据您手头的所有数据更新控件的可见性和可编辑性
*   使用来自正在编辑的对象的数据填充控件，包括验证消息或错误消息

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T22:48:46.387

您可能想检查 django 如何处理[表单](http://docs.djangoproject.com/en/dev/topics/forms/)并[验证](http://docs.djangoproject.com/en/dev/ref/forms/validation/)它们。表单像模型一样被处理，它们有自己的类，因此它们的字段列表、验证规则和显示逻辑不再分散在视图、控制器和助手中。有了这样的结构，隐藏/只读/可编辑逻辑所属的位置就很清楚了。

似乎这样的功能还没有在 Rails 中实现。它不仅可以节省时间，还可以使您的代码保持整洁和结构化。您可以从为表单创建一个基类开始，其中验证与控制器是分开的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-16T17:54:33.703

为了正常工作，我发现访问级别应该按递增顺序排列：NONE、VIEW、REQUIRED、EDIT。

请注意，REQUIRED 不是您可能认为的最高级别，因为 EDIT（填充和取消填充权限）比 REQUIRED（仅填充权限）具有更大的权限。

枚举看起来像这样：

```
/** NO permissions.
 *     Presentation: "hidden"
 *     Database: "no access"
 */
NONE(0),

/** VIEW permissions.
 *     Presentation: "read-only"
 *     Database: "read access"
 */
VIEW(1),

/** VIEW and POPULATE permissions.
 *     Presentation: "required/highlighted"
 *     Database: "non-null"
 */
REQUIRED(2),

/** VIEW, POPULATE, and DEPOPULATE permissions.
 *     Presentation: "editable"
 *     Database: "nullable"
 */
EDIT(3); 
```

从底层（数据库约束）创建要访问的字段映射。然后，此地图在下一层（业务规则 + 用户权限）得到更新（进一步限制）。最后，如果需要，顶层（表示规则）可以进一步限制地图。

重要提示：必须包装地图，以便它只允许在任何后续更新中*减少访问。*试图增加访问权限的更新应该被忽略而不触发任何错误。这是因为它应该像一个投票系统一样决定访问应该是什么样子。本质上，上述访问级别的后续分层可以以任何顺序发生，因为一旦所有层都投票，它将导致每个字段的访问级别低水位标记。

后果：

1) 表示层可以为数据库指定的只读 (VIEW) 字段隐藏一个字段（将访问权限设置为 NONE）。

2) 当业务规则说用户至少没有 VIEW 访问权限时，表示层不能显示字段。

3）如果数据库说它只是“必需的”（不可为空），表示层不能将字段的访问权限移动到“可编辑”（可空）。

注意：应该使表示层（自定义显示标签）通过读取访问映射来呈现字段，而不需要任何“if”语句。

用于设置显示的相同访问映射也可以在提交验证期间使用。可以编写通用验证器来读取任何表单及其访问映射，以确保已遵循所有规则。

（另见线程：[控制对表单字段的访问的最佳实践](https://stackoverflow.com/questions/368904/best-practices-for-controlling-access-to-form-fields/1743719#1743719)）

# asp.net - ASP.NET 2.0 异步用户控件不起作用

> ID：273546
> 
> 赞同：4
> 
> 时间：2008-11-07T20:27:41.617
> 
> 标签：asp.net, user-controls, asynchronous

我试图让用户控件异步工作，但无论我做什么，它都会继续同步工作。作为测试 Web 应用程序，我已将其精简到最低限度。这将是用户控件：

```
<%@ Control Language="C#" %>
<script runat="server">
    SqlConnection m_oConnection;
    SqlCommand    m_oCommand;

    void Page_Load(object sender, EventArgs e)
    {
        Trace.Warn("Page_Load");
        string strDSN = ConfigurationManager.ConnectionStrings["DSN"].ConnectionString + ";async=true";
        string strSQL = "waitfor delay '00:00:10'; select * from MyTable";

        m_oConnection = new SqlConnection(strDSN);
        m_oCommand = new SqlCommand(strSQL, m_oConnection);
        m_oConnection.Open();

        Page.RegisterAsyncTask(new PageAsyncTask(new BeginEventHandler(BeginHandler), new EndEventHandler(EndHandler), new EndEventHandler(TimeoutHandler), null, true));
        Page.ExecuteRegisteredAsyncTasks();
    }

    IAsyncResult BeginHandler(object src, EventArgs e, AsyncCallback cb, object state)
    {
        Trace.Warn("BeginHandler");
        return m_oCommand.BeginExecuteReader(cb, state);
    }

    void EndHandler(IAsyncResult ar)
    {
        Trace.Warn("EndHandler");
        GridView1.DataSource = m_oCommand.EndExecuteReader(ar);
        GridView1.DataBind();
        m_oConnection.Close();
    }

    void TimeoutHandler(IAsyncResult ar)
    {
        Trace.Warn("TimeoutHandler");
    }
</script>
<asp:gridview id="GridView1" runat="server" /> 
```

这将是我托管控件三次的页面：

```
<%@ page language="C#" trace="true" async="true" asynctimeout="60" %>
<%@ register tagprefix="uc" tagname="mycontrol" src="~/MyControl.ascx" %>
<html>
    <body>
        <form id="form1" runat="server">
            <uc:mycontrol id="MyControl1" runat="server" />
            <uc:mycontrol id="MyControl2" runat="server" />
            <uc:mycontrol id="MyControl3" runat="server" />
        </form>
    </body>
</html> 
```

页面显示没有错误，但页面底部的跟踪显示每个控件实例是同步处理的。我究竟做错了什么？我缺少的地方是否有配置设置？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T21:36:06.300

看起来我可以回答我自己的问题。用户控件不应该调用`Page.ExecuteRegisteredAsyncTasks`. 通过这样做，控件正在添加异步任务、运行它并等待它完成。

相反，用户控件的每个实例都应该只调用`Page.RegisterAsyncTask`. 在每个控件实例完成此操作后，页面会自动调用`RegistereAsyncTask`同时运行所有三个已注册的异步任务。

所以这是新的用户控件：

```
<%@ Control Language="C#" %>
<script runat="server">
    SqlConnection m_oConnection;
    SqlCommand    m_oCommand;

    void Page_Load(object sender, EventArgs e)
    {
        Trace.Warn(ID, "Page_Load - " + Thread.CurrentThread.GetHashCode().ToString());
        string strDSN = ConfigurationManager.ConnectionStrings["DSN"].ConnectionString + ";async=true";
        string strSQL = "waitfor delay '00:00:10'; select * from TEProcessedPerDay where Date > dateadd(day, -90, getutcdate()) order by Date asc";

        m_oConnection = new SqlConnection(strDSN);
        m_oCommand = new SqlCommand(strSQL, m_oConnection);
        m_oConnection.Open();

        Page.RegisterAsyncTask(new PageAsyncTask(new BeginEventHandler(BeginHandler), new EndEventHandler(EndHandler), new EndEventHandler(TimeoutHandler), null, true));
    }

    IAsyncResult BeginHandler(object src, EventArgs e, AsyncCallback cb, object state)
    {
        Trace.Warn(ID, "BeginHandler - " + Thread.CurrentThread.GetHashCode().ToString());
        return m_oCommand.BeginExecuteReader(cb, state);
    }

    void EndHandler(IAsyncResult ar)
    {
        Trace.Warn(ID, "EndHandler - " + Thread.CurrentThread.GetHashCode().ToString());
        GridView1.DataSource = m_oCommand.EndExecuteReader(ar);
        GridView1.DataBind();
        m_oConnection.Close();
    }

    void TimeoutHandler(IAsyncResult ar)
    {
        Trace.Warn(ID, "TimeoutHandler - " + Thread.CurrentThread.GetHashCode().ToString());
    }
</script>
<asp:gridview id="GridView1" runat="server" /> 
```

以及创建三个控件实例的未更改页面：

```
<%@ page language="C#" async="true" trace="true" %>
<%@ register tagprefix="uc" tagname="mycontrol" src="~/MyControl.ascx" %>
<html>
    <body>
        <form id="form1" runat="server">
            <uc:mycontrol id="MyControl1" runat="server" />
            <uc:mycontrol id="MyControl2" runat="server" />
            <uc:mycontrol id="MyControl3" runat="server" />
        </form>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-08T08:09:55.957

如果我可以在上面的帖子中添加一点，`ExecuteRegisteredAsyncTassk`除非有令人信服的理由，否则我们不应该显式调用。`OnPrerender`注册异步任务后，ASP.NET 框架将在页面生命周期事件之后立即执行所有这些任务。

`ExecuteRegisteredAsyncTasks`使用可能的示例是；有时您可能需要确保在调用另一个异步任务之前完成了几个异步操作。在这种情况下，使用`ExecuteRegisteredAsyncTasks`.

# asp.net - 来自 ASP.NET MVC 的技巧和面向 ASP.NET WebForms 开发人员的课程

> ID：273555
> 
> 赞同：18
> 
> 时间：2008-11-07T20:30:22.627
> 
> 标签：asp.net, asp.net-mvc

ASP.NET MVC 开发人员可以提出哪些有用的建议来帮助我们 ASP.NET WebForms 开发人员编写更好的代码/Web 应用程序？

我是一名 WebForms 人，但由于围绕 MVC 的所有新炒作，我会重视一些关于可能能够在 Webforms 应用程序中使用的有用提示、技巧和策略的评论。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-08T08:28:11.023

不久前，当我了解新的 MVC 框架时，我想到的是，WebForms 在很多方面都是 MVC 的尝试。标记和代码隐藏包括视图和控制器，您可以编写自己的模型。

这个想法与我从学习 MVC 中获得的重要设计考虑密切相关。其中最重要的是巩固整个系统的核心域，并确保在该域内可重用的级别定义所有常见逻辑。这是您的模型，我喜欢将生活在此级别的逻辑称为域逻辑（我知道我混合了术语）。您的模型应该可以在不同的应用程序中重用（主要的 web/winforms 应用程序、用于实用程序和配置的 winforms 应用程序、后台处理服务、web 服务等）。您的应用程序应该非常特定于它们的用途：它们由表示逻辑（它们的视图）和应用程序逻辑（它们的控制器）组成。任何跨越需要在其他应用程序中使用的界限的东西都可以很容易地归类为领域逻辑，

我希望这是有道理的。

它的要点是，即使您不使用纯 MVC 框架或对象模型或其他任何东西，这种高层次的设计外观也可以产生很好的效果。将通用逻辑隔离在可跨应用程序重用的域层中，您的应用程序更易于编写、扩展和维护。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T22:48:55.740

1.  忘记页面生命周期
2.  没有 ViewState（默认情况下）
3.  没有回发
4.  您需要了解 HTTP 协议基础知识 (GET/POST)。HTML 也是如此（DropDownList 实际上是一个标签）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T05:16:24.203

我建议您先观看 Microsoft 学习网站上的截屏视频：

[ASP.NET MVC 视频](http://www.asp.net/learn/mvc-videos/)

在那里，您将了解 WebForms 回发模型之间的区别，以及 MVC 直接将您的 URL 路由到操作和方法的方式。

第二个主要区别是要记住，在 ASP.NET MVC 中，您不使用执行回发的控件。它可能感觉有点像 Classic ASP，其中代码在服务器端块内的页面上内联，但这是值得的。您将完全控制生成的 HTML，这对于搜索引擎优化之类的东西非常有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-01T08:35:17.023

一些建议

1.  不要使用标准控件。反而要注意jQuery、MooTools。
2.  使用强类型模型
3.  使用像 Spring.NET 这样的 IoC 是一种很好的做法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T21:32:23.080

我也来自 webforms，但从预览 3 开始就一直在学习 asp.net MVC。

我不确定如何将 MVC 中的任何内容带入 Web 表单，它们是两个完全不同的框架。我可能对它太陌生了，无法理解它如何应用于网络表单，但现在看来它们几乎没有共同点。

MVC 的一些优势在于它在您需要如何做事以及将代码放置在何处方面具有严格的结构。它还取消了 runat=server 形式，我相信不会促进任何 asp.net 服务器控件的使用（您需要自己编写所有 HTML）。这几乎就是网络表单的定义。MVC 几乎用它自己的框架取代了网络表单。

如果您曾经使用过 Classic ASP 或 PHP，我会称 ASP.net MVC 为一种更结构化的框架，以供人们使用那些较旧的脚本语言进行操作。它有点像 FuseBox 框架，但更加结构化和进化。

# lamp - 在 LAMP SaaS Web 应用程序中测量和限制带宽使用的最佳方法是什么？

> ID：273558
> 
> 赞同：2
> 
> 时间：2008-11-07T20:30:37.323
> 
> 标签：lamp, bandwidth, saas

我工作的公司正在考虑开发一个基于计划的 LAMP SaaS Web 应用程序。我们希望监控使用情况，因为它涉及外部引用，并且会通过在第三方网站上放置 iframe 或 JavaScript 片段来吸引带宽。我的第一个想法是仅依靠页面印象算法，但由于这确实是一个带宽问题，我想知道监控是否是一种更好的方法。以允许我向第三方网站发送已超过上限的消息的方式进行此监控的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T21:21:32.930

我认为 Web 服务网关将是一个不错的选择。它们中的大多数（IBM、Layer 7、Vordel）都提供节流和合同管理功能。它们将允许您设置访问它们背后的任何东西的阈值。

如果您正在为用户和服务使用授权和身份验证，您可以轻松地配置它们以在使用率过高时发送通知（来自滥用、超过请求的 SLA 或您配置的任何其他内容。

最重要的是，它们将与正在使用您的应用程序/数据的任何事物一起工作，无论是用户、批处理还是服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T02:40:18.483

也许您应该使用云计算服务，它会监控每个客户端的带宽使用情况。它还允许您为每个客户设置上限。

我读过[Mosso.com](http://www.mosso.com)可以做到这一点。

问候

# c - 解码 PRF 文件

> ID：273560
> 
> 赞同：0
> 
> 时间：2008-11-07T20:30:50.677
> 
> 标签：c

有没有办法解码 PICS 规则文件？包含 Windows 操作系统使用的设置和首选项。

该文件由以下人员提供：

Q:F]9y3n5|dp:n4hU)qbs;!&-bzh

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-08T11:48:18.063

PICSRules[规范](http://www.w3.org/TR/REC-PICSRules)定义了 PICS 规则的外观。我不认为你的文件是其中之一。

那是上面的*整个*文件内容吗？

您确定它绝对是 PICS 规则文件吗？有许多使用 .prf 扩展名的文件类型，也许它就是其中之一。

# algorithm - 秘密圣诞老人算法

> ID：273567
> 
> 赞同：26
> 
> 时间：2008-11-07T20:34:27.843
> 
> 标签：algorithm, language-agnostic, graph-theory

每年圣诞节，我们都会为我家的礼物交换画名字。这通常涉及多次重绘，直到没有人拉他们的配偶。所以今年我编写了自己的名字绘图应用程序，它接收一堆名字，一堆不允许的配对，并向每个人发送一封电子邮件，以及他们选择的礼物。

现在，算法是这样工作的（在伪代码中）：

```
function DrawNames(list allPeople, map disallowedPairs) returns map
    // Make a list of potential candidates
    foreach person in allPeople
        person.potentialGiftees = People
        person.potentialGiftees.Remove(person)
        foreach pair in disallowedPairs
            if pair.first = person
               person.Remove(pair.second)

    // Loop through everyone and draw names
    while allPeople.count > 0
        currentPerson = allPeople.findPersonWithLeastPotentialGiftees
        giftee = pickRandomPersonFrom(currentPerson.potentialGiftees)
        matches[currentPerson] = giftee
        allPeople.Remove(currentPerson)
        foreach person in allPeople
            person.RemoveIfExists(giftee)

    return matches 
```

有谁知道更多关于图论的人知道某种在这里会更好地工作的算法吗？就我的目的而言，这是可行的，但我很好奇。

编辑：由于电子邮件不久前发出，我只是希望能学到一些东西，我将把它改写为一个图论问题。我对排除都是配对的特殊情况不感兴趣（比如配偶没有得到对方）。我对有足够的排除项以找到任何解决方案成为困难部分的情况更感兴趣。我上面的算法只是一个简单的贪心算法，我不确定在所有情况下都会成功。

从一个完整的有向图和一个顶点对列表开始。对于每个顶点对，删除从第一个顶点到第二个顶点的边。

目标是得到一个图，其中每个顶点都有一条边进入，一条边离开。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T22:14:23.587

如果允许他们分享礼物，只需制作一个连接两个人的边图，然后使用完美匹配算法。（为（聪明的）算法寻找“路径、树木和花朵”）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-19T21:43:17.770

我自己只是这样做，最后我使用的算法并不能完全模拟绘图名称，但它非常接近。基本上打乱列表，然后将每个人与列表中的下一个人配对。从帽子中抽出名字的唯一区别是，你得到一个循环，而不是可能得到只相互交换礼物的小型小组。如果有什么可能是一个功能。

Python中的实现：

```
import random
from collections import deque
def pairup(people):
    """ Given a list of people, assign each one a secret santa partner
    from the list and return the pairings as a dict. Implemented to always
    create a perfect cycle"""
    random.shuffle(people)
    partners = deque(people)
    partners.rotate()
    return dict(zip(people,partners)) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-07T20:37:28.137

我不会使用不允许的配对，因为这会大大增加问题的复杂性。只需将每个人的姓名和地址输入列表即可。创建列表的副本并继续对其进行改组，直到两个列表中每个位置的地址不匹配。这将确保没有人得到自己或他们的配偶。

作为奖励，如果您想进行这种无记名投票方式，请打印第一个列表中的信封和第二个列表中的姓名。装信封时不要偷看。（或者你可以自动向他们选择的每个人发送电子邮件。）

[在这个线程](https://stackoverflow.com/questions/268682/what-is-the-best-low-tech-protocol-to-simulate-drawing-names-out-of-a-hat-and-e)上有更多解决这个问题的方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-07T20:40:28.800

嗯。我参加了图论课程，但更简单的是随机排列您的列表，将每个连续组配对，然后将任何不允许的元素与另一个交换。由于在任何给定的配对中都没有不允许的人，因此如果您不允许与所选组进行交换，则交换将始终成功。你的算法太复杂了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-10T20:57:13.937

创建一个图，其中每条边都是“礼物性”代表配偶的顶点不会相邻。随机选择一条边（即礼物分配）。删除所有来自送礼者的边和所有去往接收者的边并重复。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-31T06:33:49.003

图论中有一个概念称为[哈密顿电路](http://en.wikipedia.org/wiki/Hamiltonian_path)，它描述了您描述的“目标”。任何发现这一点的人的一个提示是告诉用户使用哪个“种子”来生成图表。这样，如果您必须重新生成图表，您可以。如果您必须添加或删除一个人，“种子”也很有用。在这种情况下，只需选择一个新的“种子”并生成一个新图表，确保告诉参与者哪个“种子”是当前/最新的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-28T15:39:01.687

我刚刚创建了一个可以做到这一点的网络应用程序 - [http://www.secretsantaswap.com/](http://www.secretsantaswap.com/)

我的算法允许子组。它不漂亮，但它有效。

操作如下：
1\. 为所有参与者分配一个唯一标识符，记住他们在哪个子组
2\. 复制并打乱该列表（目标）
3\. 创建每个子组中参与者数量的
数组 4\. 复制数组[3] 用于目标
5\. 创建一个新数组来保存最终匹配
项 6\. 遍历参与者分配不符合以下任何条件的第一个目标：
     A. 参与者 == 目标
     B. 参与者.子组 == 目标.子组C.
     选择目标将导致子组在未来失败（例如，子组 1 必须始终保留至少与子组 1 参与者剩余的参与者一样多的非子组 1 目标）
     D.参与者（n + 1）==目标（n + 1）
如果我们分配目标，我们还将数组从3和4递减

所以，（一点也不）漂亮，但它有效。希望能帮助到你，

丹·卡尔森

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-10-11T12:50:29.397

这是秘密圣诞老人问题的简单java实现。

```
public static void main(String[] args) {
    ArrayList<String> donor = new ArrayList<String>();
    donor.add("Micha");
    donor.add("Christoph");
    donor.add("Benj");
    donor.add("Andi");
    donor.add("Test");
    ArrayList<String> receiver = (ArrayList<String>) donor.clone();

    Collections.shuffle(donor);
    for (int i = 0; i < donor.size(); i++) {
        Collections.shuffle(receiver);
        int target = 0;
        if(receiver.get(target).equals(donor.get(i))){              
            target++;
        }           
        System.out.println(donor.get(i) + " => " + receiver.get(target));
        receiver.remove(receiver.get(target));
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-24T18:00:24.193

Python解决方案在这里。

给定一个 的序列`(person, tags)`，其中标签本身是一个（可能为空的）字符串序列，我的算法建议一个人链，其中每个人给链中的下一个人礼物（最后一个人显然与第一个人配对）。

存在标签以便可以对人进行分组，并且每次从最不加入的组中选择下一个人时，最后选择的人。初始人员由一组空标签选择，因此将从最长的组中选择。

因此，给定一个输入序列：

```
example_sequence= [
    ("person1", ("male", "company1")),
    ("person2", ("female", "company2")),
    ("person3", ("male", "company1")),
    ("husband1", ("male", "company2", "marriage1")),
    ("wife1", ("female", "company1", "marriage1")),
    ("husband2", ("male", "company3", "marriage2")),
    ("wife2", ("female", "company2", "marriage2")),
] 
```

一个建议是：

['person1 [male,company1]', 'person2 [female,company2]', 'person3 [male,company1]', 'wife2 [female,marriage2,company2]', 'husband1 [male,marriage1,company2]', 'husband2 [男,marriage2,company3]', 'wife1 [female,marriage1,company1]']

当然，如果所有人都没有标签（例如一个空元组），那么只有一组可供选择。

并不总是有最佳解决方案（想想 10 名女性和 2 名男性的输入序列，他们的类型是唯一给出的标签），但它尽其所能地做得很好。

Py2/3 兼容。

```
import random, collections

class Statistics(object):
    def __init__(self):
        self.tags = collections.defaultdict(int)

    def account(self, tags):
        for tag in tags:
            self.tags[tag] += 1

    def tags_value(self, tags):
        return sum(1./self.tags[tag] for tag in tags)

    def most_disjoined(self, tags, groups):
        return max(
            groups.items(),
            key=lambda kv: (
                -self.tags_value(kv[0] & tags),
                len(kv[1]),
                self.tags_value(tags - kv[0]) - self.tags_value(kv[0] - tags),
            )
        )

def secret_santa(people_and_their_tags):
    """Secret santa algorithm.

    The lottery function expects a sequence of:
    (name, tags)

    For example:

    [
        ("person1", ("male", "company1")),
        ("person2", ("female", "company2")),
        ("person3", ("male", "company1")),
        ("husband1", ("male", "company2", "marriage1")),
        ("wife1", ("female", "company1", "marriage1")),
        ("husband2", ("male", "company3", "marriage2")),
        ("wife2", ("female", "company2", "marriage2")),
    ]

    husband1 is married to wife1 as seen by the common marriage1 tag
    person1, person3 and wife1 work at the same company.
    …

    The algorithm will try to match people with the least common characteristics
    between them, to maximize entrop— ehm, mingling!

    Have fun."""

    # let's split the persons into groups

    groups = collections.defaultdict(list)
    stats = Statistics()

    for person, tags in people_and_their_tags:
        tags = frozenset(tag.lower() for tag in tags)
        stats.account(tags)
        person= "%s [%s]" % (person, ",".join(tags))
        groups[tags].append(person)

    # shuffle all lists
    for group in groups.values():
        random.shuffle(group)

    output_chain = []
    prev_tags = frozenset()
    while 1:
        next_tags, next_group = stats.most_disjoined(prev_tags, groups)
        output_chain.append(next_group.pop())
        if not next_group:  # it just got empty
            del groups[next_tags]
            if not groups: break
        prev_tags = next_tags

    return output_chain

if __name__ == "__main__":
    example_sequence = [
        ("person1", ("male", "company1")),
        ("person2", ("female", "company2")),
        ("person3", ("male", "company1")),
        ("husband1", ("male", "company2", "marriage1")),
        ("wife1", ("female", "company1", "marriage1")),
        ("husband2", ("male", "company3", "marriage2")),
        ("wife2", ("female", "company2", "marriage2")),
    ]
    print("suggested chain (each person gives present to next person)")
    import pprint
    pprint.pprint(secret_santa(example_sequence)) 
```

# c# - LINQ to SQL 断开来自不同数据上下文的更新对象

> ID：273578
> 
> 赞同：4
> 
> 时间：2008-11-07T20:38:15.560
> 
> 标签：c#, linq-to-sql, timestamp, disconnected

[http://geekswithblogs.net/michelotti/archive/2007/12/17/117791.aspx](http://geekswithblogs.net/michelotti/archive/2007/12/17/117791.aspx)

我正在使用带有 C# 的 ASP.NET，并尝试使用 linq to sql 来更新数据上下文，如上面链接的博客中所示。我按照说明在表中创建了时间戳字段，并使用以下方法：

```
private void updateRecord(TableName updatedRecord)
{
 context db = new context();
 db.TableName.Attach(updatedRecord,true);
 db.SubmitChanges();
} 
```

我的问题是，在尝试在数据上下文中调用 Attach 方法之前，您是否应该将 timeStamp 字段分配给 updatedRecord 中的任何内容？

当我运行此代码时，我得到以下异常：`System.Data.Linq.ChangeConflictException: Row not found or changed.` 在将对象传递给此更新方法之前，我更新了所有字段，包括我正在更新的记录的主键。在调试期间，对象的 TimeStamp 属性显示为 null。我不确定它是否应该这样。

我拥有的每一本书和资源都说这是这样做的方法，但没有一个详细介绍这个 TimeStamp 属性。

我知道这既快速又简单，所以如果有人知道，请告诉我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T21:44:03.897

既然你说你在表中创建了时间戳字段，不知道是不是在后面添加了这个列的情况下，可能是列属性设置不正确。您可能需要检查 DBML 设计器中 TimeStamp 列上的属性。确保：

```
AutoGenerated = true
Auto-Sync = Always
Time Stamp = True
Update Check = Never 
```

服务器数据类型应该是`rowversion NOT NULL`

如果未将其设置为始终自动生成和同步，则不会从插入返回行版本，因为插入完成时您没有更改它。即使这个值是由数据库生成的，DataContext 也需要知道这一点，以便它可以正确处理它。

此外，既然您有一个时间戳列，`UpdateCheck`应该`Never`为所有其他列设置为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T20:44:06.937

如果您有一个时间戳列，那么要更新一条记录（来自一个普通对象）：是的，我希望必须分配它。否则，您将失去使用时间戳进行乐观并发检查的能力。

这个想法是当您获得（断开连接的）对象时获取时间戳的副本，然后当您更新时，您可以使用此列来验证没有其他人编辑过该行。

有两种常见的情况：

1：如果您只执行短暂的操作，请先从数据库中取出记录 - 对对象进行更改，然后简单地 SumbitChanges() [都具有相同的数据上下文]。数据上下文将为您处理并发。

2：如果要断开对象的连接（例如将其传递给客户端应用程序一段时间），则使用序列化之类的方法（LINQ-to-SQL 对象支持 DataContractSerializer（可选；您需要启用它））。因此，在服务器上序列化对象，将其传递给客户端 - 客户端对其副本进行更改并将其传回。服务器对其进行反序列化并使用 Attach() 和 SubmitChanges()。内存中的记录应该仍然具有从数据库中提取时的时间戳，因此我们可以在记录断开连接的所有时间执行乐观并发。

# wcf - WCF 服务从服务器获取 GUIDS 列表，我的合同应该是什么样的？

> ID：273606
> 
> 赞同：2
> 
> 时间：2008-11-07T20:53:39.087
> 
> 标签：wcf

我正在设计一个 WCF 服务，客户端将调用该服务以从服务器获取 GUID 列表。

我应该如何定义我的端点合同？

我应该只返回一个数组吗？

如果是这样，数组是否会被 WCF 序列化？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:58:49.700

如果您要使用面向 SOA 的服务，Guids 将需要设置为字符串。客户将负责将它们变回任何东西。至于 Guid 的列表，它们将作为数组返回。如果您与这样的 Guids 的常规泛型列表对象签订了合同

```
[DataMember] List<Guid> SomeGuidsGoInHere {get;set;} 
```

然后你会得到一组Guids。这可能会导致兼容性问题。你要做的是设置一个这样的字符串列表。

```
[DataMember] List<String> SomeGuidsAsStringsGoInHere {get;set;} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-30T17:06:26.737

在 Visual Studio 中进行开发时，Microsoft 在为将 Guid 作为参数或返回 Guid 的方法生成 WSDL 时提供了一些特殊的魔法；它对 Guid 施加了限制。

您可以只在 WCF 和常规 Web 服务中返回一个 Guid 来满足您的需求。

Guid 简单类型如下：

```
<s:simpleType name="guid">
    <s:restriction base="s:string">
        <s:pattern value="[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}" />
    </s:restriction>
</s:simpleType> 
```

并为将 Guid 作为参数的方法生成 WSDL：

```
<s:element name="GetToken">
  <s:complexType>
    <s:sequence>
      <s:element minOccurs="1" maxOccurs="1" name="objUserGUID" type="s1:guid" />
      <s:element minOccurs="0" maxOccurs="1" name="strPassword" type="s:string" />
    </s:sequence>
  </s:complexType>
</s:element> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T03:48:03.757

If the client app has enough stuff to call web services, why not create the UUIDs locally using a built-in API?

# c# - C# 4.0 反馈

> ID：273610
> 
> 赞同：3
> 
> 时间：2008-11-07T20:55:09.580
> 
> 标签：c#, c#-4.0, feedback

有谁知道在 C# 4.0 上提交反馈的官方方法，以便 Anders 和他的团队能够获得反馈并能够对提交做出回应？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T20:57:12.917

可能是[这里](http://social.msdn.microsoft.com/Forums/en-US/vs2010ctpvbcs/threads/)的论坛，或者（对于错误）[连接](https://connect.microsoft.com/VisualStudio/Feedback)（他们为 .NET 4.0 CTP 和 VS2010 CTP 添加了选项）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T20:59:23.597

你有没有遇到过 MSDN 上的 VS10 CTP 反馈论坛：

[http://social.msdn.microsoft.com/Forums/en-US/category/vs2010ctp/](http://social.msdn.microsoft.com/Forums/en-US/category/vs2010ctp/)

以及具体的 C# 和 VB 论坛： [http ://social.msdn.microsoft.com/Forums/en-US/vs2010ctpvbcs/threads/](http://social.msdn.microsoft.com/Forums/en-US/vs2010ctpvbcs/threads/)

# python - python - 在循环结束时检查是否需要再次运行

> ID：273612
> 
> 赞同：2
> 
> 时间：2008-11-07T20:55:33.107
> 
> 标签：python, loops

这是一个非常基本的问题，但我无法想到第二个。我如何设置一个循环，每次内部函数运行时询问是否再次执行。所以它运行它然后说类似的东西；

“再次循环？y/n”

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T20:58:56.610

```
while True:
    func()
    answer = raw_input( "Loop again? " )
    if answer != 'y':
        break 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-07T20:59:57.497

```
keepLooping = True
while keepLooping:
  # do stuff here

  # Prompt the user to continue
  q = raw_input("Keep looping? [yn]: ")
  if not q.startswith("y"):
    keepLooping = False 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-07T21:22:20.010

有两种常用的方法，都已经提到过，它们相当于：

```
while True:
    do_stuff() # and eventually...
    break; # break out of the loop 
```

或者

```
x = True
while x:
    do_stuff() # and eventually...
    x = False # set x to False to break the loop 
```

两者都将正常工作。从“声音设计”的角度来看，最好使用第二种方法，因为 1)`break`在某些语言的嵌套作用域中可能有违反直觉的行为；2）第一种方法与“while”的预期用途相反；3）你的例程应该总是有一个单一的出口点

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T15:12:09.837

```
While raw_input("loop again? y/n ") != 'n':
    do_stuff() 
```

# c# - 何时以及为什么应该实现 IComponent、IContainer 和 ISite？

> ID：273615
> 
> 赞同：28
> 
> 时间：2008-11-07T20:57:13.103
> 
> 标签：c#, .net, system.componentmodel

我一直想知道 IComponent、IContainer 和 ISite 是干什么用的。我已经阅读了文档，但它非常模糊（或者我想得太难了）。我知道如果我创建一个类作为组件，它可以在 Visual Studio 设计器中使用。但我真的很想更广泛地了解：组件/容器模式完成了什么，它能让我的生活更轻松吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-07T21:40:32.890

他们正在为 Windows 窗体设计器进行管道设计。您很少需要自己实现它们，只需从 Component 派生您的组件类。当您想实现自己的设计器时，开始担心它们。这样做的记录更少。

# mysql - MySQL - 从表的 id 字段中没有对应项的数字列表中选择

> ID：273623
> 
> 赞同：37
> 
> 时间：2008-11-07T21:00:39.103
> 
> 标签：mysql, set, temp, database-table

我有一个数字列表，比如说 {2,4,5,6,7} 我有一个表格 foos，带有 foos.ID，包括 {1,2,3,4,8,9}

我想拿我的数字列表，并在我的表的 ID 字段中找到那些没有对应项的数字。

实现此目的的一种方法是创建一个表格栏，在 ID 字段中加载 {2,4,5,6,7}。然后，我会做

```
SELECT bar.* FROM bars LEFT JOIN foos ON bars.ID = foos.ID WHERE foos.ID IS NULL

```

但是，我想完成这个无临时表。

有人对它如何发生有任何意见吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-07T21:31:46.373

这是一个很常见的问题：在不创建表的情况下动态生成关系。这个问题的 SQL 解决方案非常尴尬。使用派生表的一个示例：

```
SELECT n.id
FROM
  (SELECT 2 AS id 
   UNION SELECT 3 
   UNION SELECT 4 
   UNION SELECT 5 
   UNION SELECT 6 
   UNION SELECT 7) AS n
  LEFT OUTER JOIN foos USING (id)
WHERE foos.id IS NULL; 
```

但这不能很好地扩展，因为您可能有很多值而不是只有六个。`UNION`构建一个每个值都需要一个长列表可能会变得很烦人。

另一种解决方案是保留一个十位数的通用表格，并重复使用它来实现多种目的。

```
CREATE TABLE num (i int);
INSERT INTO num (i) VALUES (0), (1), (2), (3), (4), (5), (6), (7), (8), (9);

SELECT n.id
FROM 
  (SELECT n1.i + n10.i*10 AS id
   FROM num AS n1 CROSS JOIN num AS n10
   WHERE n1.i + n10.i*10 IN (2, 3, 4, 5, 6, 7)) AS n
  LEFT OUTER JOIN foos USING (id)
WHERE foos.id IS NULL; 
```

我展示了从 0..99 生成值的内部查询，即使在这种情况下这不是必需的。但是您的列表中的值可能大于 10。关键是，使用一张表`num`，您可以生成大量数字，而不必求助于`UNION`每个值一个很长的链。此外，您可以在一处指定所需值的列表，这样更方便和可读。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-07T21:11:54.447

我找不到不使用临时表的精确问题的解决方案，但是使用子选择而不是连接进行查询的另一种方法是：

```
SELECT bars.* FROM bars WHERE bars.ID NOT IN (SELECT ID FROM foos) 
```

就像我最初写的其他海报一样：

```
SELECT * FROM foos WHERE foos.ID NOT IN (2, 4, 5, 6, 7) 
```

但后来我意识到这与你想要的相反。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-04T23:36:47.840

如果您使用 PHP，您可以在不创建任何临时表的情况下完成这项工作。

```
SELECT ID FROM foos WHERE foos.ID IN (2, 4, 5, 6, 7) 
```

您可以使用 PHP 的 array_diff() 函数将其转换为所需的结果。如果您的列表 (2,4,5,6,7) 位于名为 $list 的数组中，并且上述查询的结果位于数组 $result 中，则

```
$no_counterparts = array_diff($list, $result); 
```

...将返回列表中的所有数字，而数据库表中没有对应的数字。虽然此解决方案不会在查询中执行整个操作，但您需要在 PHP 中进行的后处理对于获得您想要的结果来说是最少的，并且避免创建临时表可能是值得的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-21T14:02:30.567

我有一个类似的问题。我有一个范围，其中自动递增的主键有一些缺失值，所以首先我发现有多少： `select count(*) from node where nid > 1962`. 将此数字与最高值进行比较，我发现该数字丢失了。然后我运行了这个查询： `select n2.nid from node n1 right join node n2 on n1.nid = (n2.nid - 1) where n1.nid is null and n2.nid > 1962` 这将找到非连续丢失记录的数量。它不会显示连续的，我不完全确定如何做到这一点，除了更改 ON 子句以允许更大的纬度（这将使 JOIN 表更大）。无论如何，这给了我在总共 7 个缺失的结果中的 5 个结果，另外两个保证与至少五个中的一个相邻。如果您丢失了更大的数字，您可能需要一些其他方法来查找剩余的丢失。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T21:30:41.490

Alnitak 的（和你的）解决方案应该可以工作，我无法处理只能在 SQL 语言中工作的任何其他事情。

但是问题来了——你如何传递值列表？在调用代码中处理这个不是更好吗 - 即请求 ID 并在 colling 代码中比较它，这可能是一种更适合这种操作的语言。

# c# - 从图像创建 1bpp 掩码

> ID：273624
> 
> 赞同：1
> 
> 时间：2008-11-07T21:00:56.700
> 
> 标签：c#, graphics, gdi+, drawing, gdi

如何在 C# 中使用 GDI 从图像中创建每像素 1 位的掩码？我试图从中创建蒙版的图像保存在 System.Drawing.Graphics 对象中。

我见过在循环中使用 Get/SetPixel 的例子，它们太慢了。我感兴趣的方法是只使用 BitBlits，就像[这样](http://www.vbaccelerator.com/home/VB/Tips/Mask_Images/article.asp)。我只是无法让它在 C# 中工作，非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T21:24:58.507

尝试这个：

```
using System.Drawing;
using System.Drawing.Imaging;
using System.Runtime.InteropServices; 
```

...

```
 public static Bitmap BitmapTo1Bpp(Bitmap img) {
      int w = img.Width;
      int h = img.Height;
      Bitmap bmp = new Bitmap(w, h, PixelFormat.Format1bppIndexed);
      BitmapData data = bmp.LockBits(new Rectangle(0, 0, w, h), ImageLockMode.ReadWrite, PixelFormat.Format1bppIndexed);
      for (int y = 0; y < h; y++) {
        byte[] scan = new byte[(w + 7) / 8];
        for (int x = 0; x < w; x++) {
          Color c = img.GetPixel(x, y);
          if (c.GetBrightness() >= 0.5) scan[x / 8] |= (byte)(0x80 >> (x % 8));
        }
        Marshal.Copy(scan, 0, (IntPtr)((int)data.Scan0 + data.Stride * y), scan.Length);
      }
      bmp.UnlockBits(data);
      return bmp;
    } 
```

GetPixel() 很慢，你可以用一个不安全的字节来加速它*。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-15T12:22:04.570

In the Win32 C API the process to create a mono mask is simple.

*   Create an uninitialzied 1bpp bitmap as big as the source bitmap.
*   Select it into a DC.
*   Select the source bitmap into a DC.
*   SetBkColor on the destination DC to match the mask color of the source bitmap.
*   BitBlt the source onto the destination using SRC_COPY.

For bonus points its then usually desirable to blit the mask back onto the source bitmap (using SRC_AND) to zero out the mask color there.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-09T13:56:05.153

你是说LockBits吗？[Bob Powell在此处](https://web.archive.org/web/20141229164101/http://bobpowell.net/lockingbits.aspx)对 LockBits 进行了概述；这应该提供对 RGB 值的访问，以执行您需要的操作。您可能还想查看 ColorMatrix，[就像这样](http://www.java2s.com/Code/CSharp/2D-Graphics/UseColorMatrixtograytheimage.htm)。

# c++ - 如果我使用显式构造函数，是否需要将关键字放在 .h 和 .cpp 文件中？

> ID：273630
> 
> 赞同：18
> 
> 时间：2008-11-07T21:03:09.160
> 
> 标签：c++, explicit-constructor

其实我的问题都在标题中。
无论如何：
我有一个类，我使用显式构造函数：
.h

```
class MyClass
{
  public:
    explicit MyClass(const string& s): query(s) {}
  private:
   string query;
} 
```

是否必须在 implementation(.cpp) 文件中放置**显式关键字？**

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-07T21:03:56.413

不它不是。该`explicit`关键字只允许在标题中使用。我的 gcc 说：

```
test.cpp:6: error: only declarations of constructors can be 'explicit' 
```

对于以下代码：

```
class foo {
public:
    explicit foo(int);
};

explicit foo::foo(int) {} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-08T00:50:50.823

关于后续问题（你真的应该作为一个单独的问题提交），初始化列表与构造函数的实现（它的函数体）一起，它可能在头文件或 cpp 文件中。

# vb.net - 强制多线程 VB.NET 类在单个窗体上显示结果

> ID：273639
> 
> 赞同：0
> 
> 时间：2008-11-07T21:06:41.307
> 
> 标签：vb.net, winforms, multithreading, single-instance

我有一个 Windows 窗体应用程序，它使用共享类来容纳应用程序的所有常见对象。设置类有一组定期做事的对象，然后有一些有趣的事情，他们需要提醒主窗体并让它更新。

我目前正在通过对象上的事件来执行此操作，并且在创建每个对象时，我添加一个 EventHandler 以将事件映射回表单。但是，我遇到了一些麻烦，这表明这些请求并不总是最终出现在我的表单的主副本上。例如，我的表单有一个通知托盘图标，但是当表单捕获和事件并尝试显示气泡时，没有出现气泡。但是，如果我修改该代码以使图标可见（尽管它已经可见），然后显示气泡，则会出现第二个图标并正确显示气泡。

有没有人遇到过这个？有没有一种方法可以强制我的所有事件被表单的单个实例捕获，或者是否有完全不同的方法来处理这个？如有必要，我可以发布代码示例，但我认为这是一个常见的线程问题。

**更多信息：**我目前在表单的事件处理程序中使用 Me.InvokeRequired，在这种情况下它总是返回 FALSE。此外，当我从该表单中使其可见时创建的第二个托盘图标没有上下文菜单，而“真实”图标有 - 这是否提示任何人？

我要拔头发了！这不可能那么难！

**解决方案**：感谢 nobugz 提供的线索，它引导我找到我现在正在使用的代码（它工作得很好，虽然我不禁想到有更好的方法来做到这一点）。我向名为“IsPrimary”的表单添加了一个私有布尔变量，并将以下代码添加到表单构造函数中：

```
 Public Sub New()
        If My.Application.OpenForms(0).Equals(Me) Then
            Me.IsFirstForm = True
        End If
    End Sub 
```

一旦设置了这个变量并且构造函数完成，它直接进入事件处理程序，我以这种方式处理它（CAVEAT：由于我正在寻找的表单是应用程序的主要表单，My.Application.OpenForms( 0) 得到我需要的东西。如果我正在寻找非启动表单的第一个实例，我必须遍历直到找到它）：

```
 Public Sub EventHandler()
        If Not IsFirstForm Then
            Dim f As Form1 = My.Application.OpenForms(0)
            f.EventHandler()
            Me.Close()
        ElseIf InvokeRequired Then
            Me.Invoke(New HandlerDelegate(AddressOf EventHandler))
        Else
            ' Do your event handling code '
        End If
    End Sub 
```

首先，它检查它是否在正确的表单上运行——如果不是，则调用正确的表单。然后它检查线程是否正确，如果不正确则调用 UI 线程。然后它运行事件代码。我不喜欢这可能是三个电话，但我想不出另一种方法来做到这一点。它似乎工作得很好，虽然它有点麻烦。如果有人有更好的方法，我很想听听！

再次感谢所有的帮助——这让我发疯了！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T21:13:08.530

我认为这也是一个线程问题。您在事件处理程序中使用 Control.Invoke() 吗？.NET 通常会在您调试应用程序时捕获违规行为，但在某些情况下它不能。NotifyIcon 就是其中之一，没有用于检查线程亲和性的窗口句柄。

OP更改问题后编辑：

一个经典的 VB.NET 陷阱是通过类型名称来引用 Form 实例。像 Form1.NotifyIcon1.Something。当您使用线程时，这不会按预期工作。它将创建Form1 类的*新实例，而不是使用现有实例。*该实例是不可见的（从未调用过 Show()），并且由于它在不泵送消息循环的线程上运行，因此它作为门钉死了。看到第二个图标出现是一个死的赠品。当您知道您正在从线程中使用它时，获取 InvokeRequired = False 也是如此。

您必须使用对现有表单实例的引用。如果这很难实现（您通常将“Me”作为参数传递给类构造函数），您可以使用 Application.OpenForms：

```
 Dim main As Form1 = CType(Application.OpenForms(0), Form1)
  if (main.InvokeRequired)
    ' etc... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T21:13:20.077

使用 Control.InvokeRequired 确定您是否在正确的线程上，如果不是，则使用 Control.Invoke。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T21:14:27.937

您应该查看 Form 上的 Invoke 方法的文档。它将允许您使更新表单的代码在拥有该表单的线程上运行（它必须这样做，Windows 表单不是线程安全的）。类似于 Private Delegate Sub UpdateStatusDelegate(ByVal newStatus as String)

public sub UpdateStatus(ByVal newStatus as String) If Me.InvokeRequired Then Dim d As New UpdateStatusDelegate(AddressOf UpdateStatus) Me.Invoke(d,new Object() {newStatus}) Else '更新表单状态 End If

如果您提供一些示例代码，我很乐意提供一个更量身定制的示例。

在 OP 说他们正在使用 InvokeRequired 之后进行编辑。

在调用 InvokeRequired 之前，请检查表单句柄是否已创建，我相信有一个 HandleCreated 属性。如果控件当前没有句柄，则 InvokeRequired 总是返回 false，这意味着代码不是线程安全的，即使您已经做了正确的事情来做到这一点。当您发现时更新您的问题。一些示例代码也会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-02T23:05:23.110

在 c# 中它看起来像这样：

```
private EventHandler StatusHandler = new EventHandler(eventHandlerCode)
void eventHandlerCode(object sender, EventArgs e)
    {
        if (this.InvokeRequired)
        {
            this.Invoke(StatusHandler, sender, e);
        }
        else
        {
          //do work
        }
    } 
```

# java - 这种检测心跳的方法是否线程安全且一致？

> ID：273641
> 
> 赞同：3
> 
> 时间：2008-11-07T21:07:24.847
> 
> 标签：java, multithreading, concurrency

这个问题已经在两篇博[文](http://dow.ngra.de/2008/10/28/what-do-we-really-know-about-non-blocking-concurrency-in-java/)（[http://dow.ngra.de/2008/10/27/when-systemcurrenttimemillis-is-too-slow/，http://dow.ngra.de/2008/10](http://dow.ngra.de/2008/10/27/when-systemcurrenttimemillis-is-too-slow/) [/28/what-do-we-really-know-about-non-blocking-concurrency-in-java/](http://dow.ngra.de/2008/10/28/what-do-we-really-know-about-non-blocking-concurrency-in-java/)），但我还没有听到明确的答案。如果我们有一个线程这样做：

```
public class HeartBeatThread extends Thread {
  public static int counter = 0;
  public static volatile int cacheFlush = 0;

  public HeartBeatThread() {
    setDaemon(true);
  }

  static {
    new HeartBeatThread().start();
  }

  public void run() {   
    while (true) {     
      try {
        Thread.sleep(500);
      } catch (InterruptedException e) {
        throw new RuntimeException(e);
      }

      counter++;
      cacheFlush++;
    }
  }
} 
```

以及许多运行以下命令的客户端：

```
if (counter == HeartBeatThread.counter) return;
counter = HeartBeatThread.cacheFlush; 
```

它是线程安全的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T21:33:06.527

在java内存模型中？不，你不行。

我已经看到许多尝试像这种非常“软同花”的方法，但如果没有明确的围栏，你肯定是在玩火。

中的“发生在”语义

[http://java.sun.com/docs/books/jls/third_edition/html/memory.html#17.7](http://java.sun.com/docs/books/jls/third_edition/html/memory.html#17.7)

在 17.4.2 结束时开始将纯线程间操作称为“操作”。这引起了很多混乱，因为在此之前它们区分了线程间和线程内的操作。因此，操作计数器的线程内操作不会通过发生之前的关系在易失性操作之间显式同步。您有两个关于同步的推理线程，一个管理本地一致性，并受到别名分析等所有漂亮技巧的影响，以进行混洗操作。另一个是关于全局一致性，只为线程间操作定义。

一种用于线程内逻辑，表示在线程内读取和写入一致地重新排序，另一种用于线程间逻辑，表示诸如易失性读/写之类的事情，并且同步开始/结束被适当地隔离。

问题是非易失性写入的可见性未定义，因为它是线程内操作，因此未包含在规范中。它运行的处理器应该能够在您串行执行这些语句时看到它，但它用于线程间目的的顺序化可能是未定义的。

现在，这是否会影响您的现实完全是另一回事。

在 x86 和 x86-64 平台上运行 java 时？从技术上讲，您处于模糊的领域，但实际上 x86 对读取和写入提供了非常强大的保证，包括访问 cacheflush 的读取/写入的总顺序以及两次写入和两次读取的本地排序应该启用此代码正确执行，前提是它可以通过编译器不受干扰。这假设编译器不会介入并尝试使用标准允许的自由来对您的操作重新排序，因为两个线程内操作之间可证明缺乏别名。

如果你移动到一个释放语义较弱的内存，比如 ia64？然后你自己回来了。

然而，编译器可以完全善意地在任何平台上用 java 破解这个程序。它现在起作用是标准的当前实现的产物，而不是标准的产物。

顺便说一句，在 CLR 中，运行时模型更强大，并且这种技巧是合法的，因为来自每个线程的单独写入具有有序的可见性，因此请小心尝试从那里翻译任何示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T21:27:34.477

嗯，我不这么认为。

第一个 if 语句：

```
if (counter == HeartBeatThread.counter) 
    return; 
```

不访问任何 volatile 字段并且不同步。因此，您可能会永远读取过时的数据，而永远无法访问 volatile 字段。

引用第二篇博客文章中的一条评论：“线程 A 在写入 volatile 字段 f 时可见的任何内容在线程 B 读取 f 时都将变为可见。” 但在您的情况下，B（客户端）从不读取 f（=cacheFlush）。因此，对 HeartBeatThread.counter 的更改不必对客户端可见。

# web-services - 使用 WS 网关和 LDAP 向 Web 服务提供 AAA 的最优雅、最有效的方法是什么？

> ID：273652
> 
> 赞同：3
> 
> 时间：2008-11-07T21:12:56.020
> 
> 标签：web-services, security, gateway, sts-securitytokenservice, aaa-security-protocol

我正在寻找向 Web 服务提供授权、身份验证和审计的最佳方式。我将使用部署到 DMZ 的 Web 服务网关设备，并且将有一个 LDAP 实例作为防火墙后面的用户存储。应该如何建造？

干杯

K A

**更新** 正如在下面的答案中指出的那样，LDAP 不是审计的理想选择。我们现在正在考虑调用我们的 CRM 系统来实现此功能，因为我们可以审核客户的使用情况。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T22:16:17.657

身份验证是相当标准的。尝试验证用户名和密码时，首先绑定为具有查看所有用户权限的用户，然后在相应字段（可能是“uid”）中搜索具有提供的用户名的条目。找到条目后，获取其 DN 并尝试使用提供的密码绑定为该条目。

授权通常使用“动态组”处理，在每个用户对象中都有一个多值属性，说明用户拥有什么权限，或者使用“静态组”处理，其中您拥有类似于“groupOfNames”的类对象并坚持将所有成员的 DN 放入“member”属性中。

随心所欲地进行审计。LDAP 可能不是保存审计数据的最佳方式。如果您愿意，可以将其保存在数据库中，或者只使用 syslog。

# java - 来自 Java 的 Reporting Services WS - 获取 (401) 未经授权

> ID：273658
> 
> 赞同：2
> 
> 时间：2008-11-07T21:15:42.550
> 
> 标签：java, web-services, reporting-services, unauthorized

我们正在编写一个 Web 应用程序，它试图通过调用 Reporting Services SOAP API 来替换所有 ReportManager 功能。

我们开始使用 SSRS 2008 并让我们的 Java 代码正常工作。从那以后，我们不得不降级到 SSRS 2005，现在我们在连接到服务器以获取可用报告列表时遇到问题。

我们进行以下调用：

目录 = _reportingService.listChildren(_reportCredentials.getFolder(), false);

返回异常 - (401)Unauthorized

_reportCredentials 仅保存来自属性文件的信息（例如要使用的文件夹、用户名和密码等）。_reportService 定义为：

私有 ReportingService2005Soap _reportingService；

...

_reportingServiceLocator = new ReportingService2005Locator(); _reportingServiceLocator.setReportingService2005SoapEndpointAddress(soapURL);

尝试 {

_reportingService = _reportingServiceLocator.getReportingService2005Soap();

} catch (Exception e) { throw new ReportServicesException("Could not retrieve SOAP Reporting Service."); }

我还可以作为我们在代码中连接的用户/密码连接到 ReportManager。

我能找到的所有“文档”都只是似乎不适用于 Java 代码的 .NET 代码。有没有人遇到过这样的问题，或者知道使用这些服务的 Java 开发人员的好资源？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T19:31:00.717

我们将问题追溯到在 Windows Server 2008 上安装 SSRS 2005。按照此处的步骤操作：[http ://www.omegaprojex.com/index.php/2008/10/10/ssrs-2005-on-windows-server- 2008/](http://www.omegaprojex.com/index.php/2008/10/10/ssrs-2005-on-windows-server-2008/)解决了我们的问题。

# asp.net - 设计分布式（在许多服务器上）错误日志记录功能，WCF 还是？

> ID：273660
> 
> 赞同：0
> 
> 时间：2008-11-07T21:16:20.227
> 
> 标签：asp.net, wcf, error-logging

我正在设计一个错误记录功能，以便我们的服务器（每个 donig 不同的东西）可以有一个中央数据存储来记录错误。

让各种应用程序使用 WCF 服务写入错误日志文件是个好主意，还是一个坏主意？

他们*可以*通过 ADO.NET 对数据库进行操作，我认为这是更简单的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T21:24:04.843

我会说只需登录到您的本地数据存储。优点是：

1.  速度 - 将您选择的错误报告转储到现有数据连接非常快。
2.  可追溯性——如果您的服务出现错误怎么办？您失去了在所有服务器上追踪错误的能力。
3.  简单 - 如果您更改错误服务的端点，您必须更新使用错误服务的所有其他应用程序。
4.  报告 - 当您可以轻松地在应用程序本地的数据存储中找到它们时，您是否真的想在一个地方搜索来自数十/数百个应用程序的错误报告？

当然，这些观点中的任何一个都可以从另一面来看，这些只是我的观点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T21:26:33.917

看看syslog怎么样？它正是为此目的而制作的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T12:19:10.400

我们正在研究一种类似的方法，除了审计日志和错误处理。

查看通过 netTcp 使用 WCF，还查看使用事件日志，但这似乎需要高信任设置，并且可能存在性能问题。

不相信 ZombieSheep 的反对意见：

1.  通过现有的 WCF 连接转储您选择的错误报告非常快。严重地。另外，您可以异步/排队。对我来说不是关键因素。

2.  您登录到中央服务和本地服务。当错误服务重新上线时，您将轮询您的机器以查找自上一个时间戳以来的事件。问题解决了。

3.  使用 dns 别名，并且不要更改路径 - 无论如何 IMO 都应该使用这种方式进行内部寻址。

4.  如果您在一台机器上有多个应用程序怎么办？如果您想查看跨多个应用程序的错误发生时间怎么办？

# java - 用 ant 构建：动态构建选项？

> ID：273662
> 
> 赞同：1
> 
> 时间：2008-11-07T21:17:34.873
> 
> 标签：java, ant, build-process

由于多个开发人员在同一个 Tomcat 应用程序上工作，我想告诉应用程序根据当前用户和修订控制客户端/视图安装到不同的路径。

因此，如果 Bob 正在构建，应用程序应该安装在 Bob 的测试环境中，可能是 /bob1 或类似的东西。Bob 可能有几个与他一起工作的修订控制客户端/视图/工作空间，因此他可以拥有 /bob1、/bob2、/bob3 等。

安装位置在 build.properties 文件中指定。有没有办法避免检查该文件并为每个特定用户和修订控制视图更改它？

“ant install”可以接受参数或配置为考虑安装目标的环境变量吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-17T02:50:37.233

我通常使用已经给出的默认属性答案的变体：

```
<property file="local.properties" />
<property file="default.properties" /> 
```

我先读取本地属性文件，然后读取默认值。用户不会编辑默认的（然后不小心签入），他们只需在 local.properties 中定义他们想要覆盖的属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-09T04:58:20.540

您可以从命令行覆盖 ant 属性。

```
ant -Dinstall.location=/bob1 install 
```

有关更多信息，请参阅[运行 Ant](http://ant.apache.org/manual/running.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-17T18:16:30.153

这个答案已经很晚了，但我只是想把它放在可能需要它的人身上。答案与您问题的第二部分有关。““ant install”能否接受参数或配置为考虑安装目标的环境变量？

1.  在构建文件中定义环境病毒：

    ```
    <property environment="env" /> 
    ```

2.  引用 env 变量并使用它来指示路径。这是在我的构建文件中的类路径定义中完成的。它说从 weblogic lib 目录中包含一个名为 api.jar 的 jar。只要为它定义了相关的环境病毒，您就可以访问任何其他路径。例如，如果您为它们发送了环境变量，您可以访问程序文件、文档、Java Home 等。这里为weblogic安装目录定义的环境变量是BEA_HOME

    ```
    <fileset dir="${env.BEA_HOME}/wlserver_10.0/server/lib">
        <include name="api.jar" />
    </fileset> 
    ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-09T10:05:50.327

在命令行中使用 -D 选项定义属性很好，但如果经常有很多属性会变得乏味。为了抵制将 ant 调用包装在 bash 脚本中的冲动，通常的做法是导入属性文件。

在您放置的主构建文件中：

```
<property file="default.properties" /> 
```

然后您有一个名为 default.properties.sample 的文件，其中包含示例配置。这正在被检查到版本控制中。开发人员检查 default.properties.sample，将其复制到 default.properties 并根据需要进行编辑。

您应该为 default.samples 设置一个忽略默认标志，以防止它被意外签入（svn:ignore with subversion）。

# project-management - 获得管理层对流程的认可

> ID：273663
> 
> 赞同：0
> 
> 时间：2008-11-07T21:17:35.043
> 
> 标签：project-management, scrum, executives

就软件开发而言，我工作的公司历来很少有流程。目前我们并没有真正遵循任何特定的方法。问题当然是它使得计划、成功发布一个体面的版本甚至吸引优秀的软件开发人员变得困难。

我想我或许能够说服他们进行某种 Scrum 流程。然而，关键是获得管理层/所有者的支持。我认为在任何时间段内锁定特定功能的想法都会吓跑他们。

有没有人对我如何提出我的案子有任何建议？

到目前为止，我计划：

1.  介绍 Scrum 的工作原理。我如何看待它与我们目前拥有的人一起工作以及它将如何使业务受益。
2.  要求为特定的人提供培训，这样我们就不会“随手编造”
3.  设定一个实施日期，有一些计划和松散的结局，我可能不得不捆绑起来以重新开始一个过程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T22:04:39.287

如果您的项目类似于标准/典型的 IT 项目，那么您的项目很可能失败、有缺陷、成本过高、没有满足客户（内部或外部）的需求，或者开发时间过长.

如果您要倡导一个流程，则需要表明您不会因为有结构而失去灵活性。

向决策者提出的要点：

*   拥有类似 Scrum 的流程将提高管理层触手可及的信息量，并使他们能够更快地做出决策。考虑您有一个为期 6 个月的项目的场景。好吧，没有流程，你怎么知道在发布之前完成了多少工作？使用燃尽图，您可以以可见的方式跟踪剩余的时间。如果你把它与 TDD 结合起来，你定义了 100 个测试用例，他们可以看到 50% 的测试用例可以继续工作，但是从燃尽率来看，只有足够的时间来做 25%（记住经理喜欢它）很简单，所以这不是项目的*完美*状态，**但**它很*容易理解*，比他们以前的更好）。 ***.eg 他们会感觉更有控制力，因为项目有更好的可见性。***
*   拥有流程可以让您提高质量，从长远来看，这将导致更少的错误、更少的错误时间、更多的知识转移（如果您的明星开发人员被公共汽车撞到会发生什么），所有这些都意味着公司将获得开发人员专注于更好的产品，而不是不断修复错误。 ***例如，这将为他们省钱***
*   首先将实施一小部分更改。这将是一个概念证明，并且在需要时安全且易于退出。 ***例如，这表明您正在减轻感知风险***。而且您需要减轻*感知*风险，因为这是他们将关注的重点。 **也就是说**，您甚至需要在提出建议*之前*收集一些数据。为什么？好问题：您需要基线有两个原因：

    1.  你会想知道这些变化有多大帮助。所以你可以提出更多的改变。
    2.  在进行概念验证时，您可能会让经理抱怨问题。您将需要*证据*表明在混乱的过程自由环境中出现问题是常态，这并不是状态的**恶化**，也许是轻微的改善。 *您可以押注在无流程环境中出现问题。你可以打赌，概念验证过程的变化将受到指责。所以要做好准备。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T22:38:19.357

以我的经验，在试行一次后，就设计方法或实践推销管理会更容易。我会挑选一个小项目，如果可能的话，通常是面向内部的，并要求“试点”你的新 Scrum 流程。一般来说，让人们接受试点要容易得多，因为他们只需要在有限的基础上做出承诺。

随着您的新 scrumified 试点项目的推进，请务必记录（便利贴、记事本、Word doc 等）scrum 如何使您的项目比以前的（缺乏）方法或多或少成功。在这里要非常诚实，并尽可能以真实的方式量化事物。

项目完成后，整理您的笔记并使用已完成的项目作为证据向管理层展示您的发现。使用调查结果，例如：

*   “产品积压为用户提供了功能集 X 上的真实进展感”
*   “猪/鸡会议风格通过控制会议每周节省 X 人/小时”
*   “冲刺允许开发人员更紧密地合作，并减少 X% 的错误代码”

一般来说，如果你能把领导者带到一个他们可以得出美元和美分结论的地方，他们就会选择一种新的产品或方法。此外，这也很重要，如果您发现它们在试点期间没有发挥作用，请准备好放弃您最初的流程想法。

祝你好运和快乐的生产力！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T03:59:58.003

您可以将 Scrum 作为“不输”的主张进行销售。看看当你使用 Scrum 时会发生什么：

1.  所有开发工作始终集中在最高优先级的任务上。
2.  进度是 100% 开放的，并且每天检查。
3.  用户/客户可以在每次迭代结束时检查进度。
4.  自动处理换班要求。

我见过的对 Scrum 唯一合理的反对意见是，实际上不可能预测一个项目的成本或需要多长时间。这是因为 Scrum 承认每个人都会随着项目的开始而学习，并且需求会发生变化。瀑布假装能够做到这一点，但我们都知道它的效果如何。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T21:19:37.520

运行[Joel 测试](http://www.joelonsoftware.com/articles/fog0000000043.html)以确定您需要做多少工作。如果您在估计发布日期时遇到问题，请查看[基于证据的日程安排](http://www.joelonsoftware.com/items/2007/10/26.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T21:42:51.233

提供某种论证，说明 Scrum 将如何解决关键决策者过去经历的痛点。如果您还可以提供证明这一点的证据，则加分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T21:51:05.333

请记住，您也可能没有流程，因为管理层不知道也不关心它。如果您的经理对流程不感兴趣或不了解，也可以通过让所有程序员（或至少团队领导）同意并告诉新员工“这就是事情的完成方式”来启动这样的流程。当然，如果您这样做，则有必要选择一个与您的经理要求兼容的流程（例如，如果您的经理要求每天更新里程碑，请不要选择前两周没有编码的流程） .

仅当您与经理讨论并且他们的基本反应是“没关系，只要您继续编写代码”时，这才真正合适。如果您将流程作为重新分配已完成工作顺序的一种手段，而不是作为添加新工作的一种手段，那么您更有可能在这种方法中取得成功。

# awk - 最佳 awk 命令

> ID：273664
> 
> 赞同：4
> 
> 时间：2008-11-07T21:18:03.967
> 
> 标签：awk

我发现 AWK 真的很有用。这是我放在一起来操作数据的一个衬里。

```
ls | awk '{ print "awk " "'"'"'"  " {print $1,$2,$3} " "'"'"'"  " " $1 ".old_ext > " $1    ".new_ext"  }' > file.csh 
```

我使用此 AWK 制作了一个脚本文件，该文件将重命名一些文件并仅打印出选择性列。有谁知道更好的方法来做到这一点？你最擅长的 AWK 1 班轮或巧妙的操作是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T21:54:26.390

[AWK 书中](https://archive.org/details/pdfy-MgN0H1joIoDVoIC7)有很多很好的例子。[它们曾经是从Kernighan 的网页](http://cm.bell-labs.com/cm/cs/who/bwk/awkcode.txt)（现在是 404）收集下载的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-09T14:37:24.637

[你可以在这里](http://www.catonmat.net/blog/awk-one-liners-explained-part-three/)找到几个不错的单衬里。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-08T15:53:06.037

我用这个：

```
df -m | awk '{p+=$3}; END {print p}' 
```

总计跨文件系统的系统上使用的所有磁盘空间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-11T14:53:13.217

许多年前，我在 awk 中写了一个尾部脚本：

```
#!/usr/bin/awk -f
BEGIN {
  lines=10
}

{
  high = NR % lines + 1
  a[high] = $0
}

END {
  for (i = 0; i < lines; i++) {
    n = (i + high) % lines + 1
    if (n in a) {
      print a[n]
    }
  }
} 
```

我知道这很愚蠢，但这就是 awk 对你所做的。玩它很有趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T21:20:40.433

Henry Spencer 在 awk 上写了一个相当不错的 nroff 实现。他称之为“awf”。他还声称，如果 Larry Wall 知道 awk 有多么强大，他就不需要发明 perl。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T21:43:27.643

这是我过去经常使用的几个 awk……请注意，您可以使用 $1、$2 等来获取所需的列。因此，对于操作一堆文件，例如，这是一个愚蠢的命令，您可以使用它来代替 mv ...

```
ls -1 *.mp3 | awk '{printf("mv %s newDir/%s\n",$1,$1)}' | /bin/sh 
```

或者，如果您正在查看一组流程，也许...

```
ps -ef | grep -v username | awk '{printf("kill -9 %s\n",$2)}' | /bin/sh 
```

相当微不足道，但你可以看到这会给你带来很多好处。=) 我以前做的大部分事情你都可以用 xargs 来做，但是嘿，谁需要它们新奇的命令？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-08T08:56:56.613

我经常使用这个脚本来编辑 PATH 和类似路径的环境变量。用法：

```
export PATH=$(clnpath /new/bin:/other/bin:$PATH /old/bin:/other/old/bin) 
```

此命令在 PATH 前面添加 /new/bin 和 /other/bin，从 PATH 中删除 /old/bin 和 /other/old/bin（如果存在 - 如果不存在则没有错误），并删除路径上的重复目录条目。

```
:   "@(#)$Id: clnpath.sh,v 1.6 1999/06/08 23:34:07 jleffler Exp $"
#
#   Print minimal version of $PATH, possibly removing some items

case $# in
0)  chop=""; path=${PATH:?};;
1)  chop=""; path=$1;;
2)  chop=$2; path=$1;;
*)  echo "Usage: `basename $0 .sh` [$PATH [remove:list]]" >&2
    exit 1;;
esac

# Beware of the quotes in the assignment to chop!
echo "$path" |
${AWK:-awk} -F: '#
BEGIN       {       # Sort out which path components to omit
                    chop="'"$chop"'";
                    if (chop != "") nr = split(chop, remove); else nr = 0;
                    for (i = 1; i <= nr; i++)
                            omit[remove[i]] = 1;
            }
{
    for (i = 1; i <= NF; i++)
    {
            x=$i;
            if (x == "") x = ".";
            if (omit[x] == 0 && path[x]++ == 0)
            {
                    output = output pad x;
                    pad = ":";
            }
    }
    print output;
}' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-20T23:16:52.817

计算 httpd 使用的内存

```
ps -ylC httpd | awk '/[0-9]/ {SUM += $8} END {print SUM/1024}' 
```

或通过替换 httpd 的任何其他进程。除以 1024 得到以 MB 为单位的输出。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-13T10:20:31.060

我设法为 UNIX 构建了一个 DOS 树命令模拟器（ find + awk ）：

```
find . -type d -print 2>/dev/null|awk '{for (i=1;i< NF;i++)printf("%"length($i)"s","|");gsub(/[^\/]*\//,"--",$0);print $NF}'  FS='/' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-02T08:45:59.287

在两个图案之间打印线条：

```
awk '/END/{flag=0}flag;/START/{flag=1}' inputFile 
```

详解： http: [//nixtip.wordpress.com/2010/10/12/print-lines-between-two-patterns-the-awk-way/](http://nixtip.wordpress.com/2010/10/12/print-lines-between-two-patterns-the-awk-way/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-07-22T21:37:34.017

几个最喜欢的，基本上彼此无关。阅读为 2 个不同的、不相关的建议。

## 轻松识别列号

：

对于那些经常使用 awk 的人，就像我在工作中进行日志分析一样，我经常发现自己需要找出文件的列号是什么。因此，如果我正在分析 Apache 访问文件（可以在[此处](http://www.monitorware.com/en/logsamples/apache.php)找到一些示例），我会针对该文件运行以下脚本：

```
NR == 1 {
        for (i = 1 ; i <= NF ; i++)
                {
                print i "\t" $i
                }
        }
NR > 1  {
        exit
        } 
```

我通常称它为“cn.awk”，表示“列”数字。有创意吧？无论如何，输出看起来像：

```
1   64.242.88.10
2   -
3   -
4   [07/Mar/2004:16:05:49
5   -0800]
6   "GET
7   /twiki/bin/edit/Main/Double_bounce_sender?topicparent=Main.ConfigurationVariables
8   HTTP/1.1"
9   401
10  12846 
```

很容易分辨出什么是什么。我通常在我的服务器上给它起别名，并且到处都有。

* * *

## 按名称引用字段

现在，假设您的文件有一个标题行，并且您宁愿使用这些名称而不是字段编号。这允许您这样做：

```
NR == 1 {
    for (i = 1 ; i <= NF ; i++)
        {
        field[$i] = i
        }
    } 
```

现在，假设我有这个标题行......

`metric,time,val,location,http_status,http_request`

...我想总结一下`val`。我可以通过名称来引用它，而不是引用 $3：

```
NR > 1  {
    SUM += $field["val"]
    } 
```

主要好处是使脚本更具可读性。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-08-05T20:07:28.103

打印字段是大多数 AWK 教程中首先提到的内容之一。

```
awk '{print $1,$3}' file 
```

鲜为人知但同样有用的是排除字段，这也是可能的：

```
awk '{$1=$3=""}1' file 
```

# mysql - 我们使用 JDBC+XMLRPC+Tomcat+MySQL 来执行潜在的大型 MySQL 查询。有什么更好的方法？

> ID：273668
> 
> 赞同：2
> 
> 时间：2008-11-07T21:18:46.290
> 
> 标签：mysql, stored-procedures, tomcat, jdbc, xml-rpc

我正在开发一个基于 Java 的项目，该项目有一个需要连接到远程服务器上的 MySQL 数据库的客户端程序。执行如下：

使用 JDBC 编写要执行的 SQL 查询，然后使用 Apache Tomcat 作为 servlet 托管，并通过 XML-RPC 进行访问。客户端代码使用 XML-RPC 远程执行这些基于 JDBC 的功能。这允许我们保持我们的 MySQL 数据库不公开，限制使用预定义函数，并允许 Tomcat 管理数据库事务（有人告诉我这比让 MySQL 单独做要好，但我真的不这样做'不明白为什么）。然而，这种方法需要大量的样板代码，并且 Tomcat 是我们服务器上的一个巨大的内存猪。

我正在寻找一种更好的方法来做到这一点。我正在考虑的一种方法是使 MySQL 数据库可公开访问，将基于 JDBC 的代码重写为存储过程，并将公共使用仅限于这些过程。我看到的问题是，将所有 JDBC 代码转换为存储过程将是困难且耗时的。我也不太熟悉 MySQL 的权限。是否可以授予对在表上执行选择语句的存储过程的访问权限，但也可以拒绝在同一张表上的任意选择语句？

欢迎任何其他想法，以及对存储过程解决方案的想法和/或建议。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-07T21:41:29.143

MySQL 5.0.3+ 确实具有您可以设置的执行权限（无需设置选择权限），这应该允许您获得您想要的功能。

但是，请注意这个带有 JDBC 的[mysql 错误报告](http://bugs.mysql.com/bug.php?id=21292)（以及许多其他驱动程序）。

> 使用 JDBC 调用 [procedure] 时，我得到“java.sql.SQLException：驱动程序需要声明过程以包含 '\nbegin' 或 '\n' 来跟随参数声明，或者 mysql.proc 上的 SELECT 权限来解析列类型。”

解决方法是：

> 请参阅 /J 5.0.3 中的“noAccessToProcedureBodies”，了解一种有点骇人听闻的、不符合 JDBC 的解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T21:44:06.237

我相信您可以在没有太多样板的情况下实施您的解决方案，尤其是。使用类似 Spring 的远程处理。另外，Tomcat 吃了多少内存？我坦率地相信，如果它只是按照您所描述的那样做，它可以在不到 128mb 的时间内工作（保守猜测）。

您的替代方案是解决问题的“正确的书本”方式。我说建立一个原型，看看它是如何工作的。您可能遇到的主要问题是：

*   MySQL 在这方面有一些重要的问题
*   MySQL 的存储过程支持过于原始，迫使你做很多工作
*   其他一些奇怪的打嗝

我可能是那些 MySQL 的仇恨者之一，所以情况可能比我想象的要好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T01:37:51.897

你可以在你的服务器中升级内存，甚至花费几天的开发时间，所以如果你从练习中得到的只是这些，就不要编写任何代码。另外，内存是在tomcat内部使用的，并不代表tomcat自己在使用。内存可能会被数据或代码中的技术缺陷耗尽。

如果您尝试了额外的 RAM 并且它正在被吃掉，那么这听起来像是一个编码问题，所以我建议使用分析器或记录数据来尝试找出根本原因，然后再进行任何更改。如果原因是大型数据集，那么直接使用数据库只会延迟不可避免的情况，相反，您需要查看分页、汇总、客户端缓存或重新设计客户端以减少昂贵查询的使用。使用分析器，或简单地查看代码库，也会告诉您是否创建了太多对象（尤其是字符串或 XML 节点）或内存泄漏。

可以通过创造性地重构来避免样板代码，并且避免重复是有好处的。目前尚不清楚您可能已经拥有多少结构，但只需做一些工作，就可以轻松集中样板 JDBC 调用。没有根本原因应该重复 JDBC 代码，也许您可​​以告诉我们重复的代码是什么？

最后，我敢说有很多充分的理由在您的数据库上放置一个 Web 层。灵活性（部署）、兼容性、控制（通过 SQL）和安全性都是保留 Web 层的好理由。

# safari - 在 iPhone 上隐藏 Safari 用户界面组件

> ID：273671
> 
> 赞同：21
> 
> 时间：2008-11-07T21:19:32.607
> 
> 标签：safari, iphone, iphone-web-app, iphone-standalone-web-app

试图隐藏书签为主屏幕图标的 Web 应用程序的 Safari UI 组件。我正在使用这个元标记

```
<meta name="apple-mobile-web-app-capable" content="yes" /> 
```

如[iPhone 开发中心](https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html#//apple_ref/doc/uid/TP40002051-CH3-SW2)所指定，但从主屏幕图标启动时地址栏和工具栏仍然存在。我需要做些什么不同的事情？有人有例子吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-07-20T02:29:48.523

```
window.top.scrollTo(0, 1); 
```

适用于 iPhone，但不适用于 iPad。我已经成功地通过使用

```
<meta name="apple-mobile-web-app-capable" content="yes" /> 
```

并从主屏幕链接启动。我也在使用

```
<meta name="viewport" 
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
```

如果我忽略视口属性，我还没有尝试查看浏览器组件是否仍然隐藏。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-07T21:27:55.007

它是从主屏幕启动的吗？链接页面上的文档没有提到，但我发现了这个@[配置 Web 应用程序](https://developer.apple.com/webapps/docs/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/chapter_8_section_1.html#//apple_ref/doc/uid/TP40002051-CH3-SW3)：

> 例如，您可以为 Web 应用程序指定一个图标，用于在添加到主屏幕时表示它，如“为 Web Clip 指定网页图标”中所述。**当您的 Web 应用程序从主屏幕启动时，****您还可以最小化 iPhone 上的 Safari 用户界面**，如“更改状态栏外观”和“隐藏 Safari 用户界面组件”中所述。这些都是可选设置，添加到您的 Web 内容时会被其他平台忽略

 *** * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-01-04T21:58:30.953

你有没有尝试添加...

```
<meta name="apple-touch-fullscreen" content="yes" /> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-10-19T22:27:35.887

据我所知，iOS 仅在您实际添加应用程序时才关注标志。如果支持 apple-mobile-web-app-capable 的东西一开始不起作用，请尝试从主屏幕删除您的应用程序，然后重新添加它。

我进行了一些实验并发现：

*   标头中元标记的位置似乎无关紧要（我认为可能！）

*   添加应用程序并正确删除地址栏后，如果您随后从网页中删除元标记，iOS 将继续删除工具栏。

*   即使重新启动设备后，它仍然“记住”是否删除工具栏。我发现重置此行为的唯一方法是删除并重新添加应用程序。

希望有帮助！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-15T23:25:09.217

我知道这已经很老了，但是我在寻找解决方案时遇到了这个问题。我还可以通过添加以下内容来解决此问题：

```
window.top.scrollTo(0, 1); 
```

到body的onload方法。希望它可以帮助其他遇到此问题的人。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-05-16T22:07:40.953

iOS 浏览器考虑了一个名为“minimal-ui”的新指令（至少在我测试的 iPhone 上）。工具栏是隐藏的，直到用户点击顶部的状态栏。非常适合单页应用程序！

这是我使用的片段：

`<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-30T08:58:21.180

尝试这个

```
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width; user-scalable=0;">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon.png"> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-12T08:47:44.470

[http://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html#//apple_ref/doc/uid/TP40002051-CH3-SW2](http://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html#//apple_ref/doc/uid/TP40002051-CH3-SW2)

它适用于 iOS 4.0。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-08T16:30:49.803

那确实应该按预期运行，我过去使用它没有任何困难。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-03-07T12:20:14.510

```
<meta name="apple-mobile-web-app-capable" content="yes" /> 
```

适用于 iOS6 + 移动 Safari 浏览器，但仅当您在网站上包含元标记后将该页面添加到主屏幕时。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-12T16:47:33.130

```
<meta name="apple-mobile-web-app-capable" content="yes" /> 
```

这将在以下情况下起作用：

1.  该标签在应用添加到主屏幕时存在。
2.  该应用程序从主屏幕启动。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-30T07:17:58.707

以上所有元标记和window.scrollTo，对我来说在ipad上不起作用，我在书签旁边找到了一个Safari上的按钮，您可以在其中获得一个名为“添加到主屏幕”的选项，它会创建一个新的磁贴图标，您可以启动您的Web 应用程序就像一个原生应用程序，并且没有地址栏。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-20T21:59:31.767

从 iOS 7.1 开始，您可以使用`minimal-ui`

```
<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui"> 
```

# c# - 在 C# 中打印现有的 PDF（或其他文件）

> ID：273675
> 
> 赞同：25
> 
> 时间：2008-11-07T21:21:38.437
> 
> 标签：c#, printing

从我正在构建的应用程序中，我需要打印现有的 PDF（由另一个应用程序创建）。如何在 C# 中执行此操作并提供一种机制，以便用户可以选择不同的打印机或其他属性。

我查看了 PrintDialog 但不确定它正在尝试打印什么文件，如果有的话，b/c 输出始终是空白页。也许我只是在那里遗漏了一些东西。

我是否需要使用“iTextSharp”（如其他地方建议的那样）？这对我来说似乎很奇怪，因为我可以“将文件发送到打印机”我只是事先没有任何好的对话框来设置打印机等，而且我真的不想从头开始编写打印对话框但似乎我通过搜索找到的很多例子就是这样做的。

任何建议、示例或示例代码都会很棒！

此外，如果 PDF 是问题，则可以由其他应用程序以差异格式（如位图或 png）创建文件，如果这会使事情变得更容易。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-07T21:40:35.933

显示一个带有组合框的小对话框，该组合框的 Items 设置为返回的字符串集合`PrinterSettings.InstalledPrinters`。

如果您可以要求在机器上安装[GSView](http://pages.cs.wisc.edu/~ghost/gsview/gsprint.htm)，则可以静默打印 PDF。它有点慢和迂回，但至少你不必弹出 Acrobat。

这是我用来打印从 UPS Web 服务返回的一些 PDF 的一些代码：

```
 private void PrintFormPdfData(byte[] formPdfData)
    {
        string tempFile;

        tempFile = Path.GetTempFileName();

        using (FileStream fs = new FileStream(tempFile, FileMode.Create))
        {
            fs.Write(formPdfData, 0, formPdfData.Length);
            fs.Flush();
        }

        try
        {
            string gsArguments;
            string gsLocation;
            ProcessStartInfo gsProcessInfo;
            Process gsProcess;

            gsArguments = string.Format("-grey -noquery -printer \"HP LaserJet 5M\" \"{0}\"", tempFile);
            gsLocation = @"C:\Program Files\Ghostgum\gsview\gsprint.exe";

            gsProcessInfo = new ProcessStartInfo();
            gsProcessInfo.WindowStyle = ProcessWindowStyle.Hidden;
            gsProcessInfo.FileName = gsLocation;
            gsProcessInfo.Arguments = gsArguments;

            gsProcess = Process.Start(gsProcessInfo);
            gsProcess.WaitForExit();
        }
        finally
        {
            File.Delete(tempFile);
        }
    } 
```

如您所见，它将 PDF 数据作为字节数组，将其写入临时文件，然后启动 gsprint.exe 以静默方式将文件打印到指定的打印机（“HP Laserjet 5M”）。您可以用用户在对话框中选择的任何内容替换打印机名称。

打印 PNG 或 GIF 会容易得多——只需扩展 PrintDocument 类并使用 Windows 窗体提供的正常打印对话框。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T22:18:01.100

虽然这是 VB，但您可以轻松翻译它。顺便说一下Adobe没有弹出，它只打印pdf然后消失。

```
''' <summary>
''' Start Adobe Process to print document
''' </summary>
''' <param name="p"></param>
''' <remarks></remarks>
Private Function printDoc(ByVal p As PrintObj) As PrintObj
    Dim myProcess As New Process()
    Dim myProcessStartInfo As New ProcessStartInfo(adobePath)
    Dim errMsg As String = String.Empty
    Dim outFile As String = String.Empty
    myProcessStartInfo.UseShellExecute = False
    myProcessStartInfo.RedirectStandardOutput = True
    myProcessStartInfo.RedirectStandardError = True

    Try

        If canIprintFile(p.sourceFolder & p.sourceFileName) Then
            isAdobeRunning(p)'Make sure Adobe is not running; wait till it's done
            Try
                myProcessStartInfo.Arguments = " /t " & """" & p.sourceFolder & p.sourceFileName & """" & " " & """" & p.destination & """"
                myProcess.StartInfo = myProcessStartInfo
                myProcess.Start()
                myProcess.CloseMainWindow()
                isAdobeRunning(p)
                myProcess.Dispose()
            Catch ex As Exception
            End Try
            p.result = "OK"
        Else
            p.result = "The file that the Document Printer is tryng to print is missing."
            sendMailNotification("The file that the Document Printer is tryng to print" & vbCrLf & _
            "is missing. The file in question is: " & vbCrLf & _
            p.sourceFolder & p.sourceFileName, p)
        End If
    Catch ex As Exception
        p.result = ex.Message
        sendMailNotification(ex.Message, p)
    Finally
        myProcess.Dispose()
    End Try
    Return p
End Function 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T21:31:28.760

您将需要 Acrobat 或其他可以打印 PDF 的应用程序。从那里您 P/Invoke 到[ShellExecute](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx)以打印文档。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-04T16:50:14.347

您还可以使用 PDFsharp - 它是一个用于创建和操作 PDF 的开源库。 [http://www.pdfsharp.net/](http://www.pdfsharp.net/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-21T04:09:17.483

我正在为我的项目做同样的事情，它对我有用

看看能不能帮到你...

```
Process p = new Process();
p.EnableRaisingEvents = true; //Important line of code
p.StartInfo = new ProcessStartInfo()
{
    CreateNoWindow = true,
    Verb = "print",
    FileName = file,
    Arguments = "/d:"+printDialog1.PrinterSettings.PrinterName
};   
try
{
    p.Start();
} 
catch 
{ 
    /* your fallback code */ 
} 
```

您还可以使用不同的窗口选项

PRINT 命令以获得所需的输出...[参考链接](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/print.mspx?mfr=true)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-27T21:58:34.693

在对这项任务进行大量研究和谷歌搜索之后，Microsoft 发布了一个很棒的 KB，可以在不需要任何其他应用程序的情况下打印 pdf。无需调用 adobe 或 ghostprint。它可以在不将文件保存到磁盘的情况下进行打印，这让生活变得非常轻松。

[http://support2.microsoft.com/?kbid=322091](http://support2.microsoft.com/?kbid=322091)

# windows-vista - Vista 业务登录和 RDP 问题

> ID：273676
> 
> 赞同：1
> 
> 时间：2008-11-07T21:22:03.177
> 
> 标签：windows-vista, rdp

在工作中，我在一台豪华的新 PC 上运行 Vista Business，除了两个问题外，它运行良好。按照烦人的顺序，但不重要：

1.  当我重新启动机器时，会出现 Windows Splash 要求我按 Ctrl + ALT + DELETE 以便我可以登录。提示我选择我的用户帐户需要三到五分钟和几个按键。之后，一切都像魅力一样运作。

2.  作为我在公司职责的一部分，我负责轮流开展紧急工作，并在下班时间部署补丁。我得到了一台装有 XPSP2 的旧笔记本电脑（现在下载 3 个），我用它来浏览办公室的桌面，目的是为了 RDP。如果我通过常规方式在域中连接，则可以进行 RDP。但是，如果我使用现有的宽带 VPN 连接，我将无法访问。我能够访问其他服务器、运行各种操作系统（包括 Vista）的桌面。

所以嗯，有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T22:28:02.547

您是否通过组策略在计算机上启用了远程访问？

如果没有，您可能必须进入控制面板\系统和维护\系统并选择远程设置（从左侧菜单中）。

这将向您显示远程桌面的选项，包括不允许连接、允许来自任何版本的远程桌面的连接以及允许来自运行具有网络级别身份验证的远程桌面的计算机的连接（这可能是您在VPN）。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T21:57:10.533

至于 2 - 这发生在一些专有 VPN 软件（即 Cisco）上。我的解决方案是在虚拟 PC（不需要其正常的 LAN 功能）中执行我的工作职责，并在物理机中执行我的其他网络/互联网任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T21:58:53.197

我在工作中有一台 Vista，并使用我的家用 PC 进行支持工作。我没有遇到您的问题 1，所以我无法提供任何建议。对于您的第二个问题，您是否尝试过 IP 地址而不是机器名称？我们有时会遇到办公网络中的 dns 解析不准确的情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T15:22:19.297

我必须将此归结为“我的笔记本电脑有些奇怪”，因为我能够下载 RoyalTS 并很好地连接到机器。我允许远程连接，禁用防火墙，McAffee 消失，其他人可以访问该机器。

上面获得的建议对于您的典型 rdp 连接非常有用

# c - 使用 '__progname' 而不是 argv[0]

> ID：273691
> 
> 赞同：18
> 
> 时间：2008-11-07T21:27:39.907
> 
> 标签：c, unix

在我工作的 C/Unix 环境中，我看到一些开发人员使用`__progname`而不是`argv[0]`用于使用消息。这有什么好处吗？`__progname`和有什么区别`argv[0]`。它是便携式的吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-07T21:31:04.253

`__progname`不是标准的，因此不便携，更喜欢`argv[0]`. 我想`__progname`可以查找一个字符串资源来获取不依赖于您运行它的文件名的名称。但是`argv[0]`会给你他们*实际*运行它的名称，我会发现它更有用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-07T21:32:23.720

Using`__progname`允许您更改`argv[]`数组的内容，同时仍保持程序名称。一些常用工具，例如在处理参数时进行`getopt()`修改`argv[]`。

为了可移植性，您可以在程序启动时`strcopy argv[0]`放入自己的缓冲区。`progname`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-08T22:37:44.583

我看到 argv[0] 至少有两个潜在问题。

首先，如果 execve() 调用者邪恶或粗心， argv[0] 或 argv 本身可能为 NULL。调用 execve("foobar", NULL, NULL) 通常是一种简单而有趣的方法来证明一个过于自信的程序员他的代码不是 sig11-proof。

还必须注意的是，argv 不会在 main() 之外定义，而 __progname 通常被定义为一个全局变量，您可以在您的 usage() 函数中甚至在调用 main() 之前使用（如非标准 GCC 构造函数） .

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-06-08T21:43:11.077

为此还有一个 GNU 扩展，因此可以从 main() 外部访问程序调用名称，而无需手动保存。但是，手动操作可能会更好。从而使其可移植，而不是依赖于 GNU 扩展。不过，我在这里提供了可用文档的摘录。

从[在线 GNU C 库手册](http://www.gnu.org/s/libc/manual/html_node/Error-Messages.html#Error-Messages "glibc 手册")（今天访问）：

“许多不从终端读取输入的程序被设计为在任何系统调用失败时退出。按照惯例，此类程序的错误消息应以程序名称开头，无目录。您可以在变量中找到该名称`program_invocation_short_name`; 完整的文件名存储在变量`program_invocation_name`中。

*   变量：char * **program_invocation_name** 该变量的值是用于调用在当前进程中运行的程序的名称。它与 相同`argv[0]`。请注意，这不一定是有用的文件名；通常它不包含目录名称。

*   变量：char * **program_invocation_short_name** 该变量的值是用于调用在当前进程中运行的程序的名称，删除了目录名称。（也就是说，它与`program_invocation_name`减去最后一个斜线之前的所有内容相同，如果有的话。）

库初始化代码在调用 main 之前设置这两个变量。

**可移植性注意：**这两个变量是 GNU 扩展。如果您希望您的程序使用非 GNU 库，您必须将值保存`argv[0]`在 main 中，然后自己去除目录名称。我们添加了这些扩展，以便编写独立的错误报告子例程，这些子例程不需要主程序的明确合作。”

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-07T21:34:59.393

这是一个 BSD 主义，绝对不能移植。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-01-14T15:31:57.657

__progname 只是 argv[0]，此处其他回复中的示例显示了使用它的弱点。虽然也不是可移植的，但我在 /proc/self/exe（Linux、Android）上使用 readlink，并读取 /proc/self/exefile（QNX）的内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T21:39:20.413

例如，如果您的程序使用符号链接运行，则 argv[0] 将包含该链接的名称。

我猜 __progname 将包含实际程序文件的名称。

在任何情况下，argv[0] 都是由 C 标准定义的。__progname 不是。

# git - 命名 git 分支的常用做法有哪些示例？

> ID：273695
> 
> 赞同：1261
> 
> 时间：2008-11-07T21:29:05.677
> 
> 标签：git, naming-conventions, branch

几个月来，我一直在使用本地 git 存储库与我小组的 CVS 存储库进行交互。我已经制作了几乎神经质的分支，谢天谢地，其中大部分已经合并回我的树干。但是命名开始成为一个问题。如果我有一个任务很容易用一个简单的标签命名，但我分三个阶段完成，每个阶段都包括自己的分支和合并情况，那么我可以每次都重复分支名称，但这会使历史有点混乱。如果我的名称更具体，每个阶段都有单独的描述，那么分支名称开始变得冗长而笨拙。

我确实在这里学习了查看旧线程，我可以开始使用名称中的 / 来命名分支，即主题/任务或类似的东西。我可能会开始这样做，看看它是否有助于更好地组织事情。

命名 git 分支的最佳实践是什么？

编辑：实际上没有人建议任何命名约定。当我完成它们时，我会删除它们。由于管理层不断调整我的优先级，我碰巧有几个。:) 作为一个示例，为什么我可能需要在一个任务上使用多个分支，假设我需要将任务中的第一个离散里程碑提交到组的 CVS 存储库。那时，由于我与 CVS 的交互不完善，我将执行该提交，然后终止该分支。（如果我尝试在那时继续使用相同的分支，我已经看到了与 CVS 交互的太多奇怪之处。）

* * *

## 回答 #1

> 赞同：1043
> 
> 时间：2011-05-19T23:25:29.053

以下是我使用的一些分支命名约定及其原因

**分支命名约定**

1.  在分支名称的开头使用分组标记（单词）。
2.  以对您的工作流程有意义的方式定义和使用短线索标记来区分分支。
3.  使用斜杠分隔分支名称的各个部分。
4.  不要使用裸数字作为前导部分。
5.  避免长寿命分支的长描述性名称。

**组令牌**

在分支名称前使用“分组”标记。

```
group1/foo
group2/foo
group1/bar
group2/bar
group3/bar
group1/baz 
```

这些组可以根据您的工作流程命名。我喜欢用短名词来形容我的。继续阅读以获得更清晰的信息。

**定义明确的短标记**

选择短标记，这样它们就不会给您的每个分支名称添加太多噪音。我使用这些：

```
wip       Works in progress; stuff I know won't be finished soon
feat      Feature I'm adding or expanding
bug       Bug fix or experiment
junk      Throwaway branch created to experiment 
```

这些标记中的每一个都可用于告诉您每个分支属于工作流的哪一部分。

听起来您有多个分支用于不同的更改周期。我不知道你的周期是什么，但让我们假设它们是“新的”、“测试的”和“验证的”。您可以使用这些标签的缩写版本命名您的分支，始终以相同的方式拼写，以将它们分组并提醒您所处的阶段。

```
new/frabnotz
new/foo
new/bar
test/foo
test/frabnotz
ver/foo 
```

您可以快速判断哪些分支已经到达每个不同的阶段，并且可以使用 Git 的模式匹配选项轻松地将它们组合在一起。

```
$ git branch --list "test/*"
test/foo
test/frabnotz

$ git branch --list "*/foo"
new/foo
test/foo
ver/foo

$ gitk --branches="*/foo" 
```

**使用斜线分隔部分**

您可以在分支名称中使用您喜欢的大多数分隔符，但我发现斜杠是最灵活的。您可能更喜欢使用破折号或圆点。但是斜杠允许您在向/从远程推送或获取时进行一些分支重命名。

```
$ git push origin 'refs/heads/feature/*:refs/heads/phord/feat/*'
$ git push origin 'refs/heads/bug/*:refs/heads/review/bugfix/*' 
```

对我来说，斜杠也更适合我的 shell 中的制表符扩展（命令完成）。按照我的配置方式，我可以通过键入部件的第一个字符并按 TAB 键来搜索具有不同子部件的分支。Zsh 然后给我一个与我输入的令牌部分匹配的分支列表。这适用于前面的令牌以及嵌入的令牌。

```
$ git checkout new<TAB>
Menu:  new/frabnotz   new/foo   new/bar

$ git checkout foo<TAB>
Menu:  new/foo   test/foo   ver/foo 
```

（Zshell 对于命令完成是非常可配置的，我也可以将它配置为以相同的方式处理破折号、下划线或点。但我选择不这样做。）

它还允许您在许多 git 命令中搜索分支，如下所示：

```
git branch --list "feature/*"
git log --graph --oneline --decorate --branches="feature/*" 
gitk --branches="feature/*" 
```

警告：正如斯利普在评论中指出的那样，斜线可能会导致问题。因为分支是作为路径实现的，所以不能有一个名为“foo”的分支和另一个名为“foo/bar”的分支。这可能会让新用户感到困惑。

**不要使用裸数字**

不要使用裸数字（或十六进制数字）作为分支命名方案的一部分。在引用名称的制表符扩展中，git 可能会确定数字是 sha-1 的一部分，而不是分支名称。例如，我的问题跟踪器使用十进制数字命名错误。我将我的相关分支命名为 CRnnnnn 而不仅仅是 nnnnn 以避免混淆。

```
$ git checkout CR15032<TAB>
Menu:   fix/CR15032    test/CR15032 
```

如果我尝试仅扩展 15032，git 将不确定我是否要搜索 SHA-1 或分支名称，并且我的选择会受到一定限制。

**避免长描述性名称**

当您查看分支列表时，长分支名称会非常有用。但是在查看装饰的单行日志时，它可能会妨碍，因为分支名称会占用大部分单行并缩写日志的可见部分。

另一方面，如果您不习惯手动重写它们，那么长分支名称在“合并提交”中会更有帮助。默认的合并提交消息是`Merge branch 'branch-name'`. 您可能会发现将合并消息显示为`Merge branch 'fix/CR15032/crash-when-unformatted-disk-inserted'`而不是仅显示`Merge branch 'fix/CR15032'`.

* * *

## 回答 #2

> 赞同：358
> 
> 时间：2010-11-23T16:58:18.537

[Vincent Driessen的一个成功的 Git 分支模型](http://nvie.com/posts/a-successful-git-branching-model/)有很好的建议。下面是一张图片。如果此分支模型对您有吸引力，请考虑[对 git 进行流扩展](https://github.com/nvie/gitflow/tree/master)。其他人[评论了流量](http://jeffkreeftmeijer.com/2010/why-arent-you-using-git-flow/)

Driessen 的模型包括

*   主分支，仅用于发布。典型名称`master`。

*   该分支的“开发”分支。这是用于大多数主线工作的一种。俗称`develop`。

*   开发分支的多个功能分支。名称基于功能的名称。这些将被合并回开发，而不是主分支或发布分支。

*   发布分支来保存候选版本，只有错误修复，没有新功能。典型名称`rc1.1`。

修补程序是来自 master 的更改的短期分支，将在不涉及开发分支的情况下进入 master。

[![在此处输入图像描述](https://i.stack.imgur.com/tjJCt.png)](https://i.stack.imgur.com/tjJCt.png)

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2013-10-10T15:58:08.257

我混合并匹配了我见过的不同方案，并基于我正在使用的工具。
所以我完成的分支名称将是：

> 名称/功能/问题跟踪编号/简短描述

这将转化为：

> 迈克/博客/RSSI-12/logo-fix

这些部分由正斜杠分隔，因为它们在 SourceTree 中被解释为文件夹以便于组织。我们使用 Jira 进行问题跟踪，因此包含该编号可以更轻松地在系统中查找。在尝试提交拉取请求时，在尝试在 Github 中查找该问题时，包括该编号也使其可搜索。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2008-11-07T21:51:16.410

我个人的偏好是在完成主题分支后删除分支名称。

我没有尝试使用分支名称来解释分支的含义，而是在该分支的第一次提交中以“Branch：”开始提交消息的主题行，并在消息正文中包含进一步的解释，如果主题没有给我足够的空间。

我使用的分支名称纯粹是在处理主题分支时引用它的句柄。一旦主题分支的工作结束，我会去掉分支名称，有时会标记提交以供以后参考。

这也使得输出`git branch`更有用：它只列出长期存在的分支和活动的主题分支，而不是所有分支。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-11-11T06:24:54.640

Why does it take three branches/merges for every task? Can you explain more about that?

If you use a bug tracking system you can use the bug number as part of the branch name. This will keep the branch names unique, and you can prefix them with a short and descriptive word or two to keep them human readable, like `"ResizeWindow-43523"`. It also helps make things easier when you go to clean up branches, since you can look up the associated bug. This is how I usually name my branches.

Since these branches are eventually getting merged back into master, you should be safe deleting them after you merge. Unless you're merging with `--squash`, the entire history of the branch will still exist should you ever need it.

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2014-06-14T19:41:52.877

请注意，如[提交 e703d7](https://github.com/git/git/commit/e703d7118c68bb5b1f850dae4060609a88500b18)或[提交 b6c2a0d](https://github.com/git/git/commit/b6c2a0d45d4165dfd326bd7a28e66d9cedb8ae84) （2014 年 3 月）中所示，现在是 Git 2.0 的一部分，您会发现另一种命名约定（可以应用于分支）。

> “当你需要使用空格时，使用破折号”是一种奇怪的说法，你不能使用空格。
> 因为命令行描述更常见的是使用虚线多词，所以您甚至不想在这些地方使用空格。

分支名称不能有空格（请参阅“分支名称中[哪些字符是非法的？](https://stackoverflow.com/a/3651867/6309) ”和[`git check-ref-format`手册页](http://git-scm.com/docs/git-check-ref-format)）。

因此，对于将由多词表达式表示的每个分支名称，使用“ `-`”（破折号）作为分隔符是一个好主意。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-01-27T21:31:55.277

按照[farktronix 的建议](https://stackoverflow.com/a/280157/5411817)，我们一直在 mercurial 中使用类似的 Jira 票号，我计划继续将它们用于 git 分支。但我认为票号本身可能就足够独特了。虽然如 farktronix 所指出的那样，在分支名称中包含一个描述性词可能会有所帮助，但如果您经常在分支之间切换，您可能需要更少的输入。然后，如果您需要知道分支名称，如果您不知道，请在 Jira 中查找票证中的关联关键字。此外，您应该在每条评论中包含票号。

如果您的分支代表一个版本，似乎通用约定是使用 xxx（例如：“1.0.0”）格式作为分支名称和 vx.xx（例如“v1.0.0”）作为标签名称（以避免冲突） . 另请参阅：[is-there-an-standard-naming-convention-for-git-tags](https://stackoverflow.com/questions/2006265/is-there-an-standard-naming-convention-for-git-tags)

# python - 是否有从 Python 的 OSError 获取信息的跨平台方式？

> ID：273698
> 
> 赞同：44
> 
> 时间：2008-11-07T21:30:18.607
> 
> 标签：python, exception, cross-platform

例如，在一个简单的目录创建操作中，我可以像这样创建一个 OSError：

(Ubuntu Linux)

```
>>> import os
>>> os.mkdir('foo')
>>> os.mkdir('foo')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
OSError: [Errno 17] File exists: 'foo' 
```

现在我可以像这样捕获该错误：

```
>>> import os
>>> os.mkdir('foo')
>>> try:
...     os.mkdir('foo')
... except OSError, e:
...     print e.args
... 
(17, 'File exists') 
```

有没有一种跨平台的方式可以让我知道 17 或“文件存在”总是意味着同一件事，以便我可以根据情况采取不同的行动？

（这是[在另一个问题中](https://stackoverflow.com/questions/273192/python-best-way-to-create-directory-if-it-doesnt-exist-for-file-write)出现的。）

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-11-07T22:39:59.947

错误的`errno`属性在所有平台上都应该相同。您将`WindowsError`在 Windows 上遇到异常，但由于这是 OSError 的子类，相同的“ `except OSError:`”块将捕获它。Windows 确实有自己的错误代码，这些代码可以作为 访问`.winerror`，但该`.errno`属性应该仍然存在，并且可以跨平台方式使用。

可以在`errno`模块中找到各种错误代码的符号名称。例如，

```
import os, errno
try:
    os.mkdir('test')
except OSError, e:
    if e.errno == errno.EEXIST:
        # Do something 
```

您还可以使用`errno.errorcode`. 那是：

```
>>> errno.errorcode[17]
'EEXIST' 
```

# java - SWT 图像拼接或平铺/马赛克

> ID：273711
> 
> 赞同：3
> 
> 时间：2008-11-07T21:34:03.763
> 
> 标签：java, eclipse, swt, eclipse-pde

我有一个 Eclipse RCP 应用程序，它可以显示很多（10k+）的小图像，就像电影胶片一样。对于每个图像，我使用的是 SWT`Image`对象。这会使用过多的内存和资源。我正在寻找一种更有效的方法。我想通过创建一个`ImageData`具有适当总连接宽度（具有恒定高度）的对象并使用`setPixel()`其余像素来获取所有这些图像并连接它们。但是，`Palette`在`ImageData`构造函数中使用的我无法弄清楚。

我还搜索了 SWT 平铺或马赛克功能以从一组图像中创建一个图像，但一无所获。

有什么想法可以有效地并排显示数千张小图像吗？请注意，图像一旦显示，就不会被操纵，因此这是一次性费用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T18:07:28.443

您可以直接在新（大）图像的 GC（图形上下文）上绘制。拥有一个大图像应该比数千个小图像使用更少的资源（SWT 中的每个图像都保留一些 OS 图形对象句柄）

你可以尝试的是这样的：

```
 final List<Image> images;
        final Image bigImage = new Image(Display.getCurrent(), combinedWidth, height);
        final GC gc = new GC(bigImage);
        //loop thru all the images while increasing x as necessary:
        int x = 0;
        int y = 0;
        for (Image curImage : images) {
            gc.drawImage(curImage, x, y);
            x += curImage.getBounds().width;
        }
        //very important to dispose GC!!!
                    gc.dispose();
        //now you can use bigImage 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T16:45:20.107

大概不是每张图像在任何时候都在屏幕上可见？也许更好的解决方案是仅在图像变得（或即将变得）可见时加载图像，当它们从屏幕上滚出时处理它们。显然，您希望在当前视口的任一侧保留一些内存，以便为用户进行平滑过渡。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:52:42.743

我以前使用 Java 应用程序创建照片马赛克，发现使用 Java 成像 (JAI) 库和 SWT 很难实现足够的性能和内存使用。尽管我们使用的图像几乎没有您提到的那么多，但一种方法是依赖 java 之外的实用程序。特别是，您可以使用 ImageMagick 命令行实用程序将您的马赛克拼接在一起，并从磁盘加载完成的内存。如果你想花哨的话，还有一个 ImageMagick 的 C++ API，它在内存方面非常高效。

# perl - 如何在 Perl 中编写一个简单的 HTTP 代理？

> ID：273718
> 
> 赞同：1
> 
> 时间：2008-11-07T21:37:13.100
> 
> 标签：perl, http, proxy, daemon

我不想使用 HTTP::Proxy 包，因为我想转储几个请求。我的一个班轮看起来像这样，但在尝试传递标题时中断：

```
perl -MData::Dumper -MHTTP::Daemon -MHTTP::Status -MLWP::UserAgent -e 'my $ua = LWP::UserAgent->new;my $d=new HTTP::Daemon(LocalPort=>1999);print "Please contact me at: <", $d->url, ">\n";while (my $c = $d->accept) {while (my $r = $c->get_request) {if ($r->method eq 'GET' and $r->url->path eq "/uploader") {$c->send_response("whatever.");print Dumper($r);}else{$response=$ua->request($r->method,"http://localhost:1996".$r->uri,$r->headers,$r->content);$c->send_response($response);}}}' 
```

格式化，即：

```
#perl -e '
use Data::Dumper;
use HTTP::Daemon;
use HTTP::Status;
use LWP::UserAgent;
my $ua = LWP::UserAgent->new;
my $d=new HTTP::Daemon(LocalPort=>1999);
print "Please contact me at: < ", $d->url, " >\n";
while (my $c = $d->accept) {
  while (my $r = $c->get_request) {
    if ($r->method eq 'GET' and $r->url->path eq "/uploaded") {
      $c->send_response("whatever.");
      print Dumper($r);
    } else { 
      $response = $ua -> request(
        $r->method, 
        "http://localhost:1996" . $r->uri, 
        $r->headers, 
        $r->content);
      $c->send_response($response);
    }
  }
}#' 
```

所以我不能只传递请求，因为我需要更改主机，而且我不能只传递似乎的标头......所以我应该怎么做才能保持简短。

那么任何人都可以使它成为更好的单线吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T21:50:36.287

哦，拍摄，我用这个修复了它：

```
#perl -e '
use Data::Dumper;
use HTTP::Daemon;
use HTTP::Status;
use LWP::UserAgent;
my $ua = LWP::UserAgent->new;
my $d=new HTTP::Daemon(LocalPort=>1999);
print "Please contact me at: < ", $d->url, " >\n";
while (my $c = $d->accept) {
  while (my $r = $c->get_request) {
    if ($r->method eq "GET" and $r->url->path eq "/uploaded") {
      $c->send_response("whatever.");
      print Dumper($r);
    } else { 
      $response = $ua -> request( HTTP::Request->new(
        $r->method, 
        "http://localhost:1996" . $r->uri, 
        $r->headers, 
        $r->content));
      $c->send_response($response);
    }
  }
}#' 
```

注意是的`HTTP::Request->new`......所以它可以工作，它有点慢。但没关系

# c++ - 单例析构函数

> ID：273720
> 
> 赞同：27
> 
> 时间：2008-11-07T21:37:42.257
> 
> 标签：c++, memory-management, singleton

不使用实例/引用计数器的单例对象是否应该被视为 C++ 中的内存泄漏？

如果没有计数器在计数为零时要求显式删除单例实例，那么如何删除对象？应用程序终止时是否由操作系统清理？如果那个 Singleton 在堆上分配了内存怎么办？

简而言之，我是否必须调用 Singelton 的析构函数，还是可以依靠它在应用程序终止时进行清理？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-08T10:50:20.660

通常，“这取决于”。在任何名副其实的操作系统中，当您的进程退出时，进程内本地使用的所有内存和其他资源都将被释放。您根本不需要担心这一点。

但是，如果您的单例在其自己的进程之外分配生命周期的资源（可能是文件、命名互斥体或类似的东西），那么您确实需要考虑适当的清理。

RAII 将在这里为您提供帮助。如果你有这样的场景：

```
class Tempfile
{
Tempfile() {}; // creates a temporary file 
virtual ~Tempfile(); // close AND DELETE the temporary file 
};

Tempfile &singleton()
{
  static Tempfile t;
  return t;
} 
```

...那么您可以放心，无论您的应用程序退出，您的临时文件都会被关闭并删除。[但是，这不是线程安全的，对象删除的顺序可能不是您期望或要求的。](https://stackoverflow.com/questions/246564/what-is-the-lifetime-of-a-static-variable-in-a-c-function#246594)

但是，如果你的单例是这样实现的

```
Tempfile &singleton()
{
  static Tempfile *t = NULL;
  if (t == NULL)
    t = new Tempfile(); 
  return *t;
} 
```

......那么你有不同的情况。您的临时文件使用的内存将被回收，但不会删除该文件，因为不会调用析构函数。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-07T21:47:00.163

您可以依靠它被操作系统清理。

也就是说，如果您使用带有终结器而不是析构器的垃圾收集语言，您可能希望有一个优雅的关闭过程，可以直接干净地关闭您的单例，以便它们可以释放任何关键资源，以防使用不会的系统资源只需结束应用程序即可正确清理。这是因为终结器在大多数语言中都是在“尽力而为”的基础上运行的。另一方面，很少有资源需要这种可靠性。无论如何，文件句柄、内存等都干净地返回到操作系统。

如果您在像 c++ 这样的语言中使用延迟分配的单例（即使用三重检查锁习语），使用真正的析构函数而不是终结器，那么您不能依赖于在程序关闭期间调用它的析构函数。如果您使用的是单个静态实例，则析构函数将在 main 完成后运行。

无论如何，当进程结束时，所有内存都会返回给操作系统。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-07T22:07:32.087

您应该明确清理所有对象。永远不要依赖操作系统为您清理。

我通常使用单例的地方是封装对文件、硬件资源等的控制。如果我没有正确清理该连接 - 我很容易泄漏系统资源。应用程序下次运行时，如果资源仍被先前的操作锁定，它可能会失败。另一个问题可能是，如果它仍然存在于单例实例所拥有的缓冲区中，则可能不会发生任何终结（例如将缓冲区写入磁盘）。

这不是内存泄漏问题 - 问题更多的是您可能会泄漏资源，而不是内存，而这些资源可能不容易恢复。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-07T22:21:40.903

每种语言和环境都会有所不同，但我同意@Aaron Fisher 的观点，即在整个过程中往往存在单身人士。

在 C++ 的示例中，使用典型的单例习语：

```
Singleton &get_singleton()
{
   static Singleton singleton;
   return singleton;
} 
```

Singleton 实例将在第一次调用该函数时构造，并且同一实例将在程序关闭时的全局静态析构函数阶段调用它的析构函数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-07T21:48:10.053

任何类型的分配，除了共享内存中的分配，都会在进程终止时由操作系统自动清理。因此，您不必显式调用单例析构函数。换句话说，*没有泄漏*...

此外，像 Meyers 的 Singleton 这样的典型单例实现不仅在第一次调用的初始化期间是线程安全的，而且还保证在应用程序退出（调用析构函数）时优雅地终止。

无论如何，如果应用程序被发送一个 unix 信号（即：**SIGTERM**或**SIGHUP**），默认行为是终止进程而不调用静态分配对象（单例）的析构函数。为了克服这些信号的这个问题，可以处理一个调用出口的处理程序，或者处理出口是这样的处理程序——`signal(SIGTERM,exit);`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-08T14:47:54.953

你是如何创建对象的？

如果您使用的是全局变量或静态变量，则将调用析构函数，假设程序正常退出。

例如，程序

```
#include <iostream>

class Test
{
    const char *msg;

public:

    Test(const char *msg)
    : msg(msg)
    {}

    ~Test()
    {
        std::cout << "In destructor: " << msg << std::endl;
    }
};

Test globalTest("GlobalTest");

int main(int, char *argv[])
{
    static Test staticTest("StaticTest");

    return 0;
} 
```

打印出来

```
In destructor: StaticTest 
In destructor: GlobalTest 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-08T15:06:29.910

在应用程序终止之前显式释放全局内存分配是一种民间传说。我想我们大多数人这样做是出于习惯，因为我们觉得“忘记”一个结构有点糟糕。在 C 世界中，任何分配都必须在某处重新分配是对称定律。如果 C++ 程序员了解并实践 RAII，他们的想法会有所不同。

在 AmigaOS 等过去的好日子里，确实存在内存泄漏。当您忘记释放内存时，它将永远无法再次访问，直到系统重置。

这些天我不知道有任何自尊的桌面操作系统会允许内存泄漏从应用程序的虚拟地址空间中蔓延出来。当没有大量内存簿记时，您的里程可能会因嵌入式设备而异。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-07T21:45:55.173

[单例](http://en.wikipedia.org/wiki/Singleton_pattern)将是您的对象的一个​​实例。这就是它不需要计数器的原因。如果它会在您的应用程序的长度内存在，那么默认的析构函数就可以了。在任何情况下，内存都将在进程结束时由操作系统回收。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-07T21:49:00.597

取决于您对泄漏的定义。在我的书中，未绑定的内存增加是一个泄漏，单例不是未绑定的。如果您不提供引用计数，则您故意使实例保持活动状态。不是事故，不是泄漏。

你的单例包装器的析构函数应该删除实例，它不是自动的。如果它只是分配内存而没有操作系统资源，那就没有意义了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-12-21T04:00:54.293

在像 C++ 这样没有垃圾收集的语言中，最好的做法是在终止之前进行清理。您可以使用析构函数朋友类来做到这一点。

```
class Singleton{
...
   friend class Singleton_Cleanup;
};
class Singleton_Cleanup{
public:
    ~Singleton_Cleanup(){
         delete Singleton::ptr;
     }
}; 
```

在启动程序时创建清理类，然后在退出析构函数时将调用清理单例。这可能比让它进入操作系统更冗长，但它遵循 RAII 原则，并且根据您的单例对象中分配的资源，这可能是必要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-07T21:44:06.237

由您的进程分配且未释放（删除）的任何堆内存都将由操作系统回收。如果您使用的是最常见的单例实现，它使用静态变量，那么这也会在您的应用程序终止时被清除。

*这并不意味着您应该绕过新指针并且永远不要清理它们。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-09-21T16:31:40.817

我遇到了这样的问题，我认为即使主线程首先退出并带走静态对象，它也应该可以工作。而不是这个：

```
Singleton &get_singleton() {
   static Singleton singleton;
   return singleton;
} 
```

我在想

```
Singleton &get_singleton() {
   static std::shared_ptr<Singleton> singleton = std::make_shared<Singleton>();
   static thread_local std::shared_ptr<Singleton> local = singleton;
   return *local;
} 
```

因此，当主线程退出并带走`singleton`它时，每个线程仍然有自己的线程`local` `shared_ptr`来保持其`Singleton`存活。

# java - 我应该将 html 和 java 文件放在 Apache Wicket 的同一个包（文件夹）中吗？

> ID：273721
> 
> 赞同：4
> 
> 时间：2008-11-07T21:37:45.970
> 
> 标签：java, wicket

我想知道是否有一个示例，其中 html 文件和 java 文件位于不同的文件夹中。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-07T22:15:15.677

我不建议使用单独的页面目录，除非您对资源流的工作方式非常熟悉，而我不是。

我见过的绝大多数检票口项目都将类和 html 文件保存在源目录中。我尝试自己将它们分开，但后来发现获取其他资源（例如图像等）很麻烦。所以，我最终把这些资源放在了包目录中——最后我在几个不同的地方都有资源，这比把所有东西都放在包目录中要混乱得多。

也就是说，这是我用来将我的 html 模板放在单独的文件夹中的代码。它应该被添加到您的应用程序类中的 Init() 中。

```
IResourceSettings resourceSettings = getResourceSettings();
resourceSettings.addResourceFolder("pages"); //the full path to your folder, relative to the context root
resourceSettings.setResourceStreamLocator((IResourceStreamLocator) new PathStripperLocator()); 
```

[https://cwiki.apache.org/confluence/display/WICKET/Control+where+HTML+files+are+loaded+from](https://cwiki.apache.org/confluence/display/WICKET/Control+where+HTML+files+are+loaded+from)对此有教程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-28T22:40:26.830

我使用 Maven（正如上面的用户指出的那样）并且通常将我所有的 .html 页面放入`src/main/resources/same/package/name/as/corresponding/java/file`

我发现这很好用，因为我的设计人员可以从资源文件夹中检出基本包，并且他们不会被所有 .java 文件弄糊涂（更重要的是，他们不会意外更改它们！）

如果您有兴趣，我[会在邮件列表中发帖。](http://www.nabble.com/-OT--Making-it-easy-for-Designers-in-my-Wicket-project-td12595352.html#a12908330)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-10T16:45:06.177

我不喜欢将 HTML 文件放在`src/main/resources`文件夹中。我认为处理此问题并在版本控制和项目中获得清晰分离的最简单方法是使用perilandmishap 链接[的 Wicket 文章](https://cwiki.apache.org/WICKET/control-where-html-files-are-loaded-from.html)中的最后一个设置：

```
<project>
[...]
 <build>
   <resources>
     <resource>
       <filtering>false</filtering>
       <directory>src/main/html</directory>
     </resource>
   </resources>
[...]
 </build>
[...]
</project> 
```

因此，现在您的所有 HTML 文件都将位于新的、单独的 HTML 文件夹中，但仍与您的 Java 类合并。请记住，您仍然会在 HTML 文件夹中使用包命名方案，即`src/main/html/com/your/package`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T10:50:20.503

我为我的 java 和 html wicket 源文件使用单独的文件夹，但是我的 ant 构建过程然后将 html 复制到我的 web 应用程序的 classes 文件夹，这样我就避免了必须设置 wicket 资源设置的问题。

我的基本 build.properties 有

```
 web.root            = ${project.home}/web
web.java.dir            = ${web.root}/java
web.html.dir            = ${web.root}/html

war.root            = ${project.home}/war
web.inf.dir         = ${war.root}/WEB-INF
war.lib.dir         = ${web.inf.dir}/lib
war.classes.dir         = ${web.inf.dir}/classes

wicket.version          = 1.3.5
wicket.jar          = ${war.lib.dir}/wicket-${wicket.version}.jar
wicket-extend.jar       = ${war.lib.dir}/wicket-extensions-${wicket.version}.jar
wicket-spring.jar       = ${war.lib.dir}/wicket-spring-${wicket.version}.jar 
```

和 compile / assemble ant 目标看起来像

```
<target name="compile-web">
    <path id="wicket.build.classpath">
        <filelist>
            <file name="${wicket.jar}"/>
            <file name="${wicket-extend.jar}"/>
            <file name="${wicket-spring.jar}"/>
            <file name="${externaljars.path}/spring/2.5.6/spring.jar"/>
        </filelist>
    </path>

    <javac destdir="${war.classes.dir}" classpathref="wicket.build.classpath" 
        debug="on" srcdir="${web.java.dir}">
        <include name="**/*.java"/>
    </javac>
</target>

<target name="assemble-war" depends="compile-web">
    <copy todir="${war.classes.dir}" overwrite="true">
        <fileset dir="${web.html.dir}"/>
    </copy>
    <delete file="${dist.dir}/validationservice.war"/>
    <war destfile="${dist.dir}/validationservice.war" webxml="${web.inf.dir}/web.xml" basedir="${war.dir}">
    </war>
</target> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T15:37:52.917

这是使用 Maven 管理项目的一个非常好的领域。由于 Maven 在类路径中包含两个位置，因此您可以在逻辑上将 Java 源文件和 HTML 文件分开，并且仍然让它们保持相同的包结构。Java 代码进入 src/main/java，HTML 进入 src/main/resources。在构建或运行代码时，这两个位置都会添加到类路径中。

如果 Maven 不适合您，那么这个想法可能适用于您使用的任何环境。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-12T07:24:37.883

我会将 Java 和 HTML 文件放在同一个文件夹中。这将使选择与 Java 类对应的 HTML 文件更加舒适。将组件 HTML 文件视为一种 UI 描述，否则将使用 Java（如 Swing）编写。

# google-maps - 获取已添加到 Google 地图的 GMarker？

> ID：273726
> 
> 赞同：0
> 
> 时间：2008-11-07T21:39:53.220
> 
> 标签：google-maps

有没有办法获取已添加到地图的所有 GMarker 的列表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T22:37:00.187

我认为 API 中没有一种方法可以返回已添加到地图的 GMarkers 或叠加层列表。在将它们添加到地图时，您必须通过将它们添加到列表来自己跟踪它们。

GMap2 提供了可能有用的[addoverlay removeoverlay 和 clearoverlays事件。](http://code.google.com/apis/maps/documentation/reference.html#GMap2.Events)

# asp.net - 如何在 ASP.NET 中跨多个子域共享会话？

> ID：273732
> 
> 赞同：17
> 
> 时间：2008-11-07T21:41:38.223
> 
> 标签：asp.net, iis, session

我有一个应用程序，在使用该应用程序的过程中，用户可能会点击

```
virginia.usa.com 
```

到

```
newyork.usa.com 
```

由于我不想每次用户从一个子域跨越到另一个子域时都创建一个新会话，所以在多个子域之间共享会话信息的好方法是什么？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2010-01-18T20:08:19.270

您使用 ASP.NET 和 IIS 对此进行了标记，因此我假设这是您的环境。确保你的 web.config 中有这个：

```
<httpCookies domain=".usa.com"/> 
```

如果您的 2 个子域映射到同一个应用程序，那么您就完成了。但是，如果它们是不同的应用程序，您将需要做一些额外的工作，例如使用基于 SQL Server 的会话存储（并破解存储过程以确保所有应用程序共享相同的会话数据）或使用 HttpModule 来拦截应用程序名称，因为即使使用共享 cookie 和相同的机器密钥，2 个应用程序仍将使用 2 个不同的存储来存储它们的会话数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T21:55:21.690

跟踪您自己的会话并使用具有适当域设置的 cookie，即。`.usa.com`.

或者，如果您使用的是 PHP，我相信有一个设置可以更改它使用的会话 cookie 的默认域设置，这也可能很有用。

您正在寻找的设置是：

```
session.use_cookies = 1
session.use_only_cookies = 1
session.cookie_domain = .usa.com 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-05-22T00:35:34.040

我最近经历了这一点，并学到了艰难的方法。本地主机实际上被认为是一个 TLD。Cookie 域至少需要一个二级域 - test.com。如果您希望 cookie 适用于域及其所有子域，请以“。”作为前缀。- .test.com。

在本地运行/调试时，设置 localhost 的域会失败，即使域设置正确也会失败，因为 Visual Studio 默认使用 localhost。

可以在项目属性中更改此默认本地主机，以便项目实际在 cookie 域 test.com 上运行。本质上，如果浏览器中的地址匹配，你就可以让它工作。

我的问题记录在此：[Setting ServiceStack Cookie Domain in Web.Config Causes Session Id to Change on Every Request](https://stackoverflow.com/questions/23620622/setting-servicestack-cookie-domain-in-web-config-causes-session-id-to-change-on)

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T21:51:46.783

如果您使用的是 PHP，一个技巧是制作一个小包含脚本（或两个）来执行以下操作：

1 序列化您的 $_SESSION 数组 2 将该字符串作为隐藏输入传递，使用 POST 以单独的形式将您指向这些按钮的所有链接。3 还包括一个布尔隐藏输入，让您的脚本知道它是否需要使用当前会话或反序列化 $_POST['session'] 4 在您的站点上部署它，在适当的地方调用

如果实际上有一种认可的方式来转移会话，我不会这样做。我希望您至少考虑过使用 cookie。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-10T20:32:36.187

如果您有多个子域指向同一个 IIS 应用程序（这正是我现在的情况，使用通配符 DNS，然后在接收端进行子域“嗅探”），马特的回答绝对是正确的选择。

但是，我想添加一些我经历过的事情，以防有人发现这对他们不起作用。单独设置 httpCookies 行并不适合我，我必须在我的 web.config 文件中添加一个 machineKey 条目：

machineKey 解密密钥="12...D1" 验证密钥="D7..8B"

特别奇怪，因为我*不在*网络农场设置中（除非 AWS/EC2 有效地这样做）。一旦我这样做了，它就像一个冠军。

# shell - 使用 wget 递归获取包含任意文件的目录

> ID：273743
> 
> 赞同：637
> 
> 时间：2008-11-07T21:44:26.753
> 
> 标签：shell, wget

我有一个 Web 目录，用于存储一些配置文件。我想使用 wget 将这些文件拉下来并保持它们当前的结构。例如，远程目录如下所示：

```
http://mysite.com/configs/.vim/ 
```

.vim 包含多个文件和目录。我想使用 wget 在客户端上复制它。似乎无法找到正确的 wget 标志组合来完成这项工作。有任何想法吗？

* * *

## 回答 #1

> 赞同：1103
> 
> 时间：2008-11-07T21:55:41.253

您必须将`-np`/`--no-parent`选项传递给`wget`（当然，除了`-r`/ `--recursive`），否则它将按照我网站上目录索引中的链接指向父目录。所以命令看起来像这样：

```
wget --recursive --no-parent http://example.com/configs/.vim/ 
```

为避免下载自动生成的`index.html`文件，请使用`-R`/`--reject`选项：

```
wget -r -np -R "index.html*" http://example.com/configs/.vim/ 
```

* * *

## 回答 #2

> 赞同：137
> 
> 时间：2011-03-17T06:17:28.490

递归下载目录，拒绝 index.html* 文件并下载没有主机名、父目录和整个目录结构：

```
wget -r -nH --cut-dirs=2 --no-parent --reject="index.html*" http://mysite.com/dir1/dir2/data 
```

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2012-11-22T20:36:10.597

对于其他有类似问题的人。Wget 跟随`robots.txt`它可能不允许您抓取该站点。不用担心，您可以将其关闭：

```
wget -e robots=off http://www.example.com/ 
```

[http://www.gnu.org/software/wget/manual/html_node/Robot-Exclusion.html](http://www.gnu.org/software/wget/manual/html_node/Robot-Exclusion.html)

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2014-02-24T09:21:09.710

您应该使用 -m （镜像）标志，因为它注意不要弄乱时间戳并无限期地递归。

```
wget -m http://example.com/configs/.vim/ 
```

如果您在此线程中添加其他人提到的要点，它将是：

```
wget -m -e robots=off --no-parent http://example.com/configs/.vim/ 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2013-02-15T12:26:50.090

这是完整的 wget 命令，可用于从服务器目录下载文件（忽略`robots.txt`）：

```
wget -e robots=off --cut-dirs=3 --user-agent=Mozilla/5.0 --reject="index.html*" --no-parent --recursive --relative --level=1 --no-directories http://www.example.com/archive/example/5.3.0/ 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-05-16T12:39:45.143

如果`--no-parent`没有帮助，您可以使用`--include`选项。

目录结构：

```
http://<host>/downloads/good
http://<host>/downloads/bad 
```

你想下载`downloads/good`但不是`downloads/bad`目录：

```
wget --include downloads/good --mirror --execute robots=off --no-host-directories --cut-dirs=1 --reject="index.html*" --continue http://<host>/downloads/good 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-11-07T21:49:42.263

```
wget -r http://mysite.com/configs/.vim/ 
```

为我工作。

也许您有一个干扰它的 .wgetrc ？

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-10-21T03:32:19.333

要使用用户名和密码递归地获取目录，请使用以下命令：

```
wget -r --user=(put username here) --password='(put password here)' --no-parent http://example.com/ 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-10-18T23:31:27.997

此版本递归下载，不创建父目录。

```
wgetod() {
    NSLASH="$(echo "$1" | perl -pe 's|.*://[^/]+(.*?)/?$|\1|' | grep -o / | wc -l)"
    NCUT=$((NSLASH > 0 ? NSLASH-1 : 0))
    wget -r -nH --user-agent=Mozilla/5.0 --cut-dirs=$NCUT --no-parent --reject="index.html*" "$1"
} 
```

用法：

1.  添加`~/.bashrc`或粘贴到终端
2.  `wgetod "http://example.com/x/"`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-03-02T06:32:58.937

您只需要两个标志，一个`"-r"`用于递归和`"--no-parent"`（或`-np`），以便不进入`'.'`and `".."` 。像这样：

`wget -r --no-parent http://example.com/configs/.vim/`

就是这样。它将下载到以下本地树中：`./example.com/configs/.vim`. 但是，如果您不想要前两个目录，请使用`--cut-dirs=2`前面回复中建议的附加标志：

`wget -r --no-parent --cut-dirs=2 http://example.com/configs/.vim/`

它只会将您的文件树下载到`./.vim/`

事实上，我正是从[wget 手册](https://www.gnu.org/software/wget/manual/wget.html#Directory_002dBased-Limits)中得到了这个答案的第一行，他们在第 4.3 节的末尾有一个非常干净的例子。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2019-09-07T15:07:53.640

在处理递归下载时，以下选项似乎是完美的组合：

wget -nd -np -P /dest/dir --recursive [http://url/dir1/dir2](http://url/dir1/dir2)

为方便起见，手册页中的相关片段：

```
 -nd
   --no-directories
       Do not create a hierarchy of directories when retrieving recursively.  With this option turned on, all files will get saved to the current directory, without clobbering (if a name shows up more than once, the
       filenames will get extensions .n).

   -np
   --no-parent
       Do not ever ascend to the parent directory when retrieving recursively.  This is a useful option, since it guarantees that only the files below a certain hierarchy will be downloaded. 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-12-24T19:56:34.683

首先，感谢所有发布答案的人。这是我递归下载网站的“终极” wget 脚本：

```
wget --recursive ${comment# self-explanatory} \
  --no-parent ${comment# will not crawl links in folders above the base of the URL} \
  --convert-links ${comment# convert links with the domain name to relative and uncrawled to absolute} \
  --random-wait --wait 3 --no-http-keep-alive ${comment# do not get banned} \
  --no-host-directories ${comment# do not create folders with the domain name} \
  --execute robots=off --user-agent=Mozilla/5.0 ${comment# I AM A HUMAN!!!} \
  --level=inf  --accept '*' ${comment# do not limit to 5 levels or common file formats} \
  --reject="index.html*" ${comment# use this option if you need an exact mirror} \
  --cut-dirs=0 ${comment# replace 0 with the number of folders in the path, 0 for the whole domain} \
$URL 
```

之后，可能需要从 URL中[剥离查询参数](https://superuser.com/questions/61025/how-can-i-make-wget-rename-downloaded-files-to-not-include-the-query-string)`main.css?crc=12324567`并运行本地服务器（例如，通过`python3 -m http.server`在您刚刚 wget'ed 的目录中）来运行 JS。请注意，该`--convert-links`选项仅在完全爬网完成后才会生效。

此外，如果您想建立一个可能很快会关闭的网站，您应该[联系 ArchiveTeam](https://www.archiveteam.org/index.php?title=ArchiveBot)并要求他们将您的网站添加到他们的 ArchiveBot 队列中。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-02-28T05:42:25.843

Wget 1.18 可能会更好，例如，我被 1.12 版本的错误咬住了...

```
wget --recursive (...) 
```

...仅检索 index.html 而不是所有文件。

解决方法是注意一些 301 重定向并尝试新位置 - 给定新 URL，wget 获取目录中的所有文件。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-06-25T22:01:11.460

递归 wget 忽略机器人（用于网站）

```
wget -e robots=off -r -np --page-requisites --convert-links 'http://example.com/folder/' 
```

-e robots=off 导致它忽略该域的 robots.txt

-r 使其递归

-np = 没有父母，所以它不跟随到父文件夹的链接

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-09-02T05:20:20.590

听起来您正在尝试获取文件的镜像。虽然`wget`有一些有趣的 FTP 和 SFTP 用途，但一个简单的镜像应该可以工作。只需几个注意事项即可确保您能够正确下载文件。

## 尊重`robots.txt`

确保如果您的 、 或 目录中有文件，`/robots.txt`它不会阻止爬网。如果是这样，您需要使用命令中的以下选项通过添加来指示忽略它：`public_html``www``configs``wget``wget`

```
wget -e robots=off 'http://your-site.com/configs/.vim/' 
```

## 将远程链接转换为本地文件。

此外，`wget`必须**指示**将链接转换为下载的文件。如果您已正确完成上述所有操作，那么您应该没问题。我发现获取所有文件的最简单方法是使用`mirror`命令，前提是在非公共目录后面没有隐藏任何内容。

### 试试这个：

```
wget -mpEk 'http://your-site.com/configs/.vim/'

# If robots.txt is present:

wget -mpEk robots=off 'http://your-site.com/configs/.vim/'

# Good practice to only deal with the highest level directory you specify (instead of downloading all of `mysite.com` you're just mirroring from `.vim`

wget -mpEk robots=off --no-parent 'http://your-site.com/configs/.vim/' 
```

首选使用`-m`代替，`-r`因为它没有最大递归深度并且它会下载所有资产。Mirror 非常擅长确定站点的完整深度，但是如果您有许多外部链接，您最终可能会下载的不仅仅是您的站点，这就是我们使用`-p -E -k`. 制作页面的所有先决条件文件和保留的目录结构应该是输出。`-k`将链接转换为本地文件。由于您应该设置一个链接，因此您应该在 config 文件夹中添加一个文件`/.vim`.

镜像模式也适用于设置为的目录结构`ftp://`。

### 一般经验法则：

根据您正在做镜像的站点的一侧，您正在向服务器发送许多调用。为了防止您被列入黑名单或被切断，请使用该`wait`选项来限制您的下载。

```
wget -mpEk --no-parent robots=off --random-wait 'http://your-site.com/configs/.vim/' 
```

但是，如果您只是下载`../config/.vim/`文件，则不必担心它会忽略父目录并下载单个文件。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-11-07T21:50:44.320

您应该只需添加 -r 就可以做到这一点

```
wget -r http://stackoverflow.com/ 
```

# c# - 如何从 .NET 执行 SSIS 包？

> ID：273751
> 
> 赞同：91
> 
> 时间：2008-11-07T21:48:37.600
> 
> 标签：c#, .net, sql-server, vb.net, ssis

我有一个 SSIS 包，最终我也想传递参数，这些参数将来自 .NET 应用程序（VB 或 C#），所以我很好奇是否有人知道如何执行此操作，或者更好的是提供有用提示的网站关于如何去做。

所以基本上我想从.NET执行一个SSIS包，传递它可以在其中使用的SSIS包参数。

例如，SSIS 包将使用平面文件导入 SQL 数据库，但文件的路径和名称可能是从 .Net 应用程序传递的参数。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-12-17T07:40:21.133

以下是如何从代码中设置包中的变量 -

```
using Microsoft.SqlServer.Dts.Runtime;

private void Execute_Package()
    {           
        string pkgLocation = @"c:\test.dtsx";

        Package pkg;
        Application app;
        DTSExecResult pkgResults;
        Variables vars;

        app = new Application();
        pkg = app.LoadPackage(pkgLocation, null);

        vars = pkg.Variables;
        vars["A_Variable"].Value = "Some value";               

        pkgResults = pkg.Execute(null, vars, null, null, null);

        if (pkgResults == DTSExecResult.Success)
            Console.WriteLine("Package ran successfully");
        else
            Console.WriteLine("Package failed");
    } 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2015-02-19T09:57:03.923

这是使用 SQL Server 2012 引入的 SSDB 目录的方法...

```
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Data.SqlClient;

using Microsoft.SqlServer.Management.IntegrationServices;

public List<string> ExecutePackage(string folder, string project, string package)
{
    // Connection to the database server where the packages are located
    SqlConnection ssisConnection = new SqlConnection(@"Data Source=.\SQL2012;Initial Catalog=master;Integrated Security=SSPI;");

    // SSIS server object with connection
    IntegrationServices ssisServer = new IntegrationServices(ssisConnection);

    // The reference to the package which you want to execute
    PackageInfo ssisPackage = ssisServer.Catalogs["SSISDB"].Folders[folder].Projects[project].Packages[package];

    // Add a parameter collection for 'system' parameters (ObjectType = 50), package parameters (ObjectType = 30) and project parameters (ObjectType = 20)
    Collection<PackageInfo.ExecutionValueParameterSet> executionParameter = new Collection<PackageInfo.ExecutionValueParameterSet>();

    // Add execution parameter (value) to override the default asynchronized execution. If you leave this out the package is executed asynchronized
    executionParameter.Add(new PackageInfo.ExecutionValueParameterSet { ObjectType = 50, ParameterName = "SYNCHRONIZED", ParameterValue = 1 });

    // Add execution parameter (value) to override the default logging level (0=None, 1=Basic, 2=Performance, 3=Verbose)
    executionParameter.Add(new PackageInfo.ExecutionValueParameterSet { ObjectType = 50, ParameterName = "LOGGING_LEVEL", ParameterValue = 3 });

    // Add a project parameter (value) to fill a project parameter
    executionParameter.Add(new PackageInfo.ExecutionValueParameterSet { ObjectType = 20, ParameterName = "MyProjectParameter", ParameterValue = "some value" });

    // Add a project package (value) to fill a package parameter
    executionParameter.Add(new PackageInfo.ExecutionValueParameterSet { ObjectType = 30, ParameterName = "MyPackageParameter", ParameterValue = "some value" });

    // Get the identifier of the execution to get the log
    long executionIdentifier = ssisPackage.Execute(false, null, executionParameter);

    // Loop through the log and do something with it like adding to a list
    var messages = new List<string>();
    foreach (OperationMessage message in ssisServer.Catalogs["SSISDB"].Executions[executionIdentifier].Messages)
    {
        messages.Add(message.MessageType + ": " + message.Message);
    }

    return messages;
} 
```

该代码是对[http://social.technet.microsoft.com/wiki/contents/articles/21978.execute-ssis-2012-package-with-parameters-via-net.aspx?CommentPosted=true#commentmessage的轻微改编](http://social.technet.microsoft.com/wiki/contents/articles/21978.execute-ssis-2012-package-with-parameters-via-net.aspx?CommentPosted=true#commentmessage)

[在http://domwritescode.com/2014/05/15/project-deployment-model-changes/](http://domwritescode.com/2014/05/15/project-deployment-model-changes/)也有类似的文章

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-09-24T08:57:16.147

要添加到@Craig Schwarze 的答案，

以下是一些相关的 MSDN 链接：

[以编程方式加载和运行本地包：](http://msdn.microsoft.com/en-us/library/ms136090.aspx)

[以编程方式加载和运行远程包](http://msdn.microsoft.com/en-us/library/ms403355.aspx)

从正在运行的包中捕获事件：

```
using System;
using Microsoft.SqlServer.Dts.Runtime;

namespace RunFromClientAppWithEventsCS
{
  class MyEventListener : DefaultEvents
  {
    public override bool OnError(DtsObject source, int errorCode, string subComponent, 
      string description, string helpFile, int helpContext, string idofInterfaceWithError)
    {
      // Add application-specific diagnostics here.
      Console.WriteLine("Error in {0}/{1} : {2}", source, subComponent, description);
      return false;
    }
  }
  class Program
  {
    static void Main(string[] args)
    {
      string pkgLocation;
      Package pkg;
      Application app;
      DTSExecResult pkgResults;

      MyEventListener eventListener = new MyEventListener();

      pkgLocation =
        @"C:\Program Files\Microsoft SQL Server\100\Samples\Integration Services" +
        @"\Package Samples\CalculatedColumns Sample\CalculatedColumns\CalculatedColumns.dtsx";
      app = new Application();
      pkg = app.LoadPackage(pkgLocation, eventListener);
      pkgResults = pkg.Execute(null, null, eventListener, null, null);

      Console.WriteLine(pkgResults.ToString());
      Console.ReadKey();
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-03-22T06:16:53.807

所以还有另一种方法可以让你从任何语言中启动它。我认为最好的方法是，您可以创建一个批处理文件，该文件将调用您的 .dtsx 包。

接下来，您可以从任何语言调用批处理文件。与在 Windows 平台中一样，您可以从任何地方运行批处理文件，我认为这将是最通用的方法。没有代码依赖。

下面是一个博客以获取更多详细信息。

[https://www.mssqltips.com/sqlservertutorial/218/command-line-tool-to-execute-ssis-packages/](https://www.mssqltips.com/sqlservertutorial/218/command-line-tool-to-execute-ssis-packages/)

快乐编码.. :)

谢谢，阿扬

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-10-30T05:51:38.743

如果你在 SSIS 中有一些变量，你可以使用这个函数。

```
 Package pkg;

    Microsoft.SqlServer.Dts.Runtime.Application app;
    DTSExecResult pkgResults;
    Variables vars;

    app = new Microsoft.SqlServer.Dts.Runtime.Application();
    pkg = app.LoadPackage(" Location of your SSIS package", null);

    vars = pkg.Variables;

    // your variables
    vars["somevariable1"].Value = "yourvariable1";
    vars["somevariable2"].Value = "yourvariable2";

    pkgResults = pkg.Execute(null, vars, null, null, null);

    if (pkgResults == DTSExecResult.Success)
    {
        Console.WriteLine("Package ran successfully");
    }
    else
    {

        Console.WriteLine("Package failed");
    } 
```

# sql - 学习 SQL。从哪里开始？

> ID：273777
> 
> 赞同：27
> 
> 时间：2008-11-07T21:55:57.587
> 
> 标签：sql

我想开始学习sql？我应该从哪里开始？我正在寻找以下具体答案： 平台 - Windows/Linux RDBMS - MSSQL/ Oracle/ MySQL 书籍 - 与一些真实世界案例研究（不是无聊的作者/书籍关系）在线资源 - 教程/真实世界项目

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-07T22:14:53.650

1) 基本了解什么是数据库（谷歌、维基百科）

2) 了解 RDBMS 是什么（关系数据库管理系统）

3) 了解什么是“正常形式”。

4) 阅读一本易于阅读的“入门”书。我推荐这本书：

[Ben Forta 的 MySQL 速成课程，Sams 出版 ISBN：0-672-32712-0](http://books.google.co.in/books?id=VgnHFWtxHo4C&lpg=PR2&dq=ISBN%3A%200-672-32712-0&pg=PR2#v=onepage&q&f=false)

5) 下载 + 安装 MySQL 并通读文档。它带有一个帮助文件，应该可以帮助你。使用任何你必须阅读基本示例并学习的书。理想情况下，无论您拥有什么书，都将通过非常清晰和明确的示例引导您了解这些概念。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-07T22:06:18.470

[http://www.w3schools.com/sql/default.asp](http://www.w3schools.com/sql/default.asp) 他们的教程是一个很好的开始。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-07T22:04:35.307

检查这个站点：[SQLZoo](http://sqlzoo.net/)，它是一个非常好的交互式教程，非常好，你可以通过练习你的查询来学习......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-07T22:01:31.693

首先了解一般的关系数据库和关系理论（以及它所基于的集合论），然后 SQL 将更容易理解。[CJ Date](http://en.wikipedia.org/wiki/Christopher_J._Date#Works)的经典数据库书籍很难被击败

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-07T22:55:17.263

对于 Microsoft SQL Server 2005，

*   您可以免费下载[SQL Server 2005 Express Edition](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx) 版本。

*   [使用这些SQL Server 数据库架构](http://www.microsoft.com/sqlserver/2005/en/us/express-starter-schemas.aspx)了解数据库架构

*   [SQL 基础知识入门](http://msdn.microsoft.com/en-us/library/bb264565.aspx)

*   为自己设置一个[Bloglines](http://www.bloglines.com)帐户并订阅您遇到的感兴趣的 SQL Server 提要。如果您想开始，我可以在评论中添加一些建议。

*   如果您想深入了解 SQL Server 如何与不同类型的应用程序协作使用，那么[示例和入门工具包](http://www.microsoft.com/sqlserver/2005/en/us/express-samples-starter-kits.aspx)看起来将是一个很好的起点。请记住，对于每个示例应用程序，您还需要一个免费的 Visual Studio IDE。详情在页面上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T22:02:34.483

[SQL Fundamentals](http://www.informit.com/store/product.aspx?isbn=0137126026)是我读过的最好的 SQL 书籍。它提供了 Oracle 和 MS Access 中的示例，面向初学者。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T23:20:30.460

乔·塞尔科（ [Joe Celko](http://www.amazon.com/s/ref=nb_ss_gw_0_6?url=search-alias%3Daps&field-keywords=joe+celko&x=0&y=0&sprefix=Joe+ce) ）的书——尤其是[在集合中思考](https://rads.stackoverflow.com/amzn/click/com/0123741378)

# javascript - 是否存在允许正则表达式的 JavaScript 的 String.indexOf() 版本？

> ID：273789
> 
> 赞同：250
> 
> 时间：2008-11-07T22:03:34.343
> 
> 标签：javascript, regex, indexof

在 javascript 中，是否存在等效于 String.indexOf() 的方法，它采用正则表达式而不是第一个参数的字符串，同时仍然允许第二个参数？

我需要做类似的事情

```
str.indexOf(/[abc]/ , i); 
```

和

```
str.lastIndexOf(/[abc]/ , i); 
```

虽然 String.search() 将正则表达式作为参数，但它不允许我指定第二个参数！

编辑：
事实证明这比我最初想象的要难，所以我编写了一个小测试函数来测试所有提供的解决方案......它假设 regexIndexOf 和 regexLastIndexOf 已添加到 String 对象。

```
function test (str) {
    var i = str.length +2;
    while (i--) {
        if (str.indexOf('a',i) != str.regexIndexOf(/a/,i)) 
            alert (['failed regexIndexOf ' , str,i , str.indexOf('a',i) , str.regexIndexOf(/a/,i)]) ;
        if (str.lastIndexOf('a',i) != str.regexLastIndexOf(/a/,i) ) 
            alert (['failed regexLastIndexOf ' , str,i,str.lastIndexOf('a',i) , str.regexLastIndexOf(/a/,i)]) ;
    }
} 
```

我正在测试如下，以确保至少对于一个字符正则表达式，结果与我们使用 indexOf 相同

//在xes中寻找a
test('xxx');
测试（'axx'）；
测试（'xax'）；
测试（'xxa'）；
测试（'轴'）；
测试（'xaa'）；
测试（'aax'）；
测试（'aaa'）；

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2008-11-07T22:11:48.880

`String`构造函数的实例有一个接受 RegExp 并返回第一个匹配项的索引的[`.search()`方法。](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search)

要从特定位置开始搜索（伪造 的第二个参数`.indexOf()`），您可以`slice`关闭第一个`i`字符：

```
str.slice(i).search(/re/) 
```

但这将获得较短字符串中的索引（在第一部分被切掉之后），因此您需要将切掉的部分 ( `i`) 的长度添加到返回的索引中（如果不是 ）`-1`。这将为您提供原始字符串中的索引：

```
function regexIndexOf(text, re, i) {
    var indexInSuffix = text.slice(i).search(re);
    return indexInSuffix < 0 ? indexInSuffix : indexInSuffix + i;
} 
```

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2008-11-08T00:33:07.833

结合已经提到的一些方法（ indexOf 显然相当简单），我认为这些函数可以解决问题：

```
function regexIndexOf(string, regex, startpos) {
    var indexOf = string.substring(startpos || 0).search(regex);
    return (indexOf >= 0) ? (indexOf + (startpos || 0)) : indexOf;
}

function regexLastIndexOf(string, regex, startpos) {
    regex = (regex.global) ? regex : new RegExp(regex.source, "g" + (regex.ignoreCase ? "i" : "") + (regex.multiLine ? "m" : ""));
    if(typeof (startpos) == "undefined") {
        startpos = string.length;
    } else if(startpos < 0) {
        startpos = 0;
    }
    var stringToWorkWith = string.substring(0, startpos + 1);
    var lastIndexOf = -1;
    var nextStop = 0;
    while((result = regex.exec(stringToWorkWith)) != null) {
        lastIndexOf = result.index;
        regex.lastIndex = ++nextStop;
    }
    return lastIndexOf;
} 
```

* * *

更新：经过编辑`regexLastIndexOf()`，现在似乎在模仿`lastIndexOf()`。请让我知道它是否仍然失败以及在什么情况下。

* * *

更新：通过本页评论中的所有测试，以及我自己的测试。当然，这并不意味着它是防弹的。任何反馈表示赞赏。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2014-01-29T01:13:23.570

我有一个简短的版本给你。这对我来说很有效！

```
var match      = str.match(/[abc]/gi);
var firstIndex = str.indexOf(match[0]);
var lastIndex  = str.lastIndexOf(match[match.length-1]); 
```

如果你想要一个原型版本：

```
String.prototype.indexOfRegex = function(regex){
  var match = this.match(regex);
  return match ? this.indexOf(match[0]) : -1;
}

String.prototype.lastIndexOfRegex = function(regex){
  var match = this.match(regex);
  return match ? this.lastIndexOf(match[match.length-1]) : -1;
} 
```

**编辑**：如果你想添加对 fromIndex 的支持

```
String.prototype.indexOfRegex = function(regex, fromIndex){
  var str = fromIndex ? this.substring(fromIndex) : this;
  var match = str.match(regex);
  return match ? str.indexOf(match[0]) + fromIndex : -1;
}

String.prototype.lastIndexOfRegex = function(regex, fromIndex){
  var str = fromIndex ? this.substring(0, fromIndex) : this;
  var match = str.match(regex);
  return match ? str.lastIndexOf(match[match.length-1]) : -1;
} 
```

要使用它，就这么简单：

```
var firstIndex = str.indexOfRegex(/[abc]/gi);
var lastIndex  = str.lastIndexOfRegex(/[abc]/gi); 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2015-07-12T22:05:07.270

采用：

```
str.search(regex) 
```

请参阅此处的文档[。](http://www.w3schools.com/jsref/jsref_search.asp)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-07T22:07:09.203

你可以使用 substr。

```
str.substr(i).match(/[abc]/); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-07T22:48:54.250

基于 BaileyP 的回答。主要区别在于，`-1`如果模式无法匹配，这些方法将返回。

**编辑：**感谢 Jason Bunting 的回答，我有了一个想法。为什么不修改`.lastIndex`正则表达式的属性？尽管这仅适用于具有全局标志 ( `/g`) 的模式。

**编辑：**更新以通过测试用例。

```
String.prototype.regexIndexOf = function(re, startPos) {
    startPos = startPos || 0;

    if (!re.global) {
        var flags = "g" + (re.multiline?"m":"") + (re.ignoreCase?"i":"");
        re = new RegExp(re.source, flags);
    }

    re.lastIndex = startPos;
    var match = re.exec(this);

    if (match) return match.index;
    else return -1;
}

String.prototype.regexLastIndexOf = function(re, startPos) {
    startPos = startPos === undefined ? this.length : startPos;

    if (!re.global) {
        var flags = "g" + (re.multiline?"m":"") + (re.ignoreCase?"i":"");
        re = new RegExp(re.source, flags);
    }

    var lastSuccess = -1;
    for (var pos = 0; pos <= startPos; pos++) {
        re.lastIndex = pos;

        var match = re.exec(this);
        if (!match) break;

        pos = match.index;
        if (pos <= startPos) lastSuccess = pos;
    }

    return lastSuccess;
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-08T15:52:44.277

`RexExp`实例已经有一个[lastIndex](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/RegExp/lastIndex)属性（如果它们是全局的），所以我正在做的是复制正则表达式，稍微修改它以适应我们的目的，`exec`在字符串上添加它并查看`lastIndex`. 这将不可避免地比在字符串上循环更快。（你有足够的例子来说明如何把它放到字符串原型上，对吧？）

```
function reIndexOf(reIn, str, startIndex) {
    var re = new RegExp(reIn.source, 'g' + (reIn.ignoreCase ? 'i' : '') + (reIn.multiLine ? 'm' : ''));
    re.lastIndex = startIndex || 0;
    var res = re.exec(str);
    if(!res) return -1;
    return re.lastIndex - res[0].length;
};

function reLastIndexOf(reIn, str, startIndex) {
    var src = /\$$/.test(reIn.source) && !/\\\$$/.test(reIn.source) ? reIn.source : reIn.source + '(?![\\S\\s]*' + reIn.source + ')';
    var re = new RegExp(src, 'g' + (reIn.ignoreCase ? 'i' : '') + (reIn.multiLine ? 'm' : ''));
    re.lastIndex = startIndex || 0;
    var res = re.exec(str);
    if(!res) return -1;
    return re.lastIndex - res[0].length;
};

reIndexOf(/[abc]/, "tommy can eat");  // Returns 6
reIndexOf(/[abc]/, "tommy can eat", 8);  // Returns 11
reLastIndexOf(/[abc]/, "tommy can eat"); // Returns 11 
```

您还可以将函数原型化到 RegExp 对象上：

```
RegExp.prototype.indexOf = function(str, startIndex) {
    var re = new RegExp(this.source, 'g' + (this.ignoreCase ? 'i' : '') + (this.multiLine ? 'm' : ''));
    re.lastIndex = startIndex || 0;
    var res = re.exec(str);
    if(!res) return -1;
    return re.lastIndex - res[0].length;
};

RegExp.prototype.lastIndexOf = function(str, startIndex) {
    var src = /\$$/.test(this.source) && !/\\\$$/.test(this.source) ? this.source : this.source + '(?![\\S\\s]*' + this.source + ')';
    var re = new RegExp(src, 'g' + (this.ignoreCase ? 'i' : '') + (this.multiLine ? 'm' : ''));
    re.lastIndex = startIndex || 0;
    var res = re.exec(str);
    if(!res) return -1;
    return re.lastIndex - res[0].length;
};

/[abc]/.indexOf("tommy can eat");  // Returns 6
/[abc]/.indexOf("tommy can eat", 8);  // Returns 11
/[abc]/.lastIndexOf("tommy can eat"); // Returns 11 
```

快速解释我如何修改`RegExp`: 因为`indexOf`我只需要确保设置了全局标志。因为`lastIndexOf`我使用负前瞻来查找最后一次出现，除非`RegExp`已经在字符串的末尾匹配。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-07T22:23:59.793

它本身不是，但您当然可以添加此功能

```
<script type="text/javascript">

String.prototype.regexIndexOf = function( pattern, startIndex )
{
    startIndex = startIndex || 0;
    var searchResult = this.substr( startIndex ).search( pattern );
    return ( -1 === searchResult ) ? -1 : searchResult + startIndex;
}

String.prototype.regexLastIndexOf = function( pattern, startIndex )
{
    startIndex = startIndex === undefined ? this.length : startIndex;
    var searchResult = this.substr( 0, startIndex ).reverse().regexIndexOf( pattern, 0 );
    return ( -1 === searchResult ) ? -1 : this.length - ++searchResult;
}

String.prototype.reverse = function()
{
    return this.split('').reverse().join('');
}

// Indexes 0123456789
var str = 'caabbccdda';

alert( [
        str.regexIndexOf( /[cd]/, 4 )
    ,   str.regexLastIndexOf( /[cd]/, 4 )
    ,   str.regexIndexOf( /[yz]/, 4 )
    ,   str.regexLastIndexOf( /[yz]/, 4 )
    ,   str.lastIndexOf( 'd', 4 )
    ,   str.regexLastIndexOf( /d/, 4 )
    ,   str.lastIndexOf( 'd' )
    ,   str.regexLastIndexOf( /d/ )
    ]
);

</script> 
```

我没有完全测试这些方法，但它们似乎到目前为止有效。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-09-01T15:11:01.120

我`regexIndexOf`还需要一个数组的函数，所以我自己编写了一个。但是我怀疑它是否经过优化，但我想它应该可以正常工作。

```
Array.prototype.regexIndexOf = function (regex, startpos = 0) {
    len = this.length;
    for(x = startpos; x < len; x++){
        if(typeof this[x] != 'undefined' && (''+this[x]).match(regex)){
            return x;
        }
    }
    return -1;
}

arr = [];
arr.push(null);
arr.push(NaN);
arr[3] = 7;
arr.push('asdf');
arr.push('qwer');
arr.push(9);
arr.push('...');
console.log(arr);
arr.regexIndexOf(/\d/, 4); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-08T12:46:43.217

在所有提议的解决方案以一种或另一种方式失败后，（编辑：在我写这个之后，一些被更新以通过测试）我找到了[Array.indexOf](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Objects:String:indexOf)和[A​​rray.lastIndexOf的 mozilla 实现](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference:Objects:String:lastIndexOf)

我用它们来实现我的 String.prototype.regexIndexOf 和 String.prototype.regexLastIndexOf 版本，如下所示：

```
String.prototype.regexIndexOf = function(elt /*, from*/)
  {
    var arr = this.split('');
    var len = arr.length;

    var from = Number(arguments[1]) || 0;
    from = (from < 0) ? Math.ceil(from) : Math.floor(from);
    if (from < 0)
      from += len;

    for (; from < len; from++) {
      if (from in arr && elt.exec(arr[from]) ) 
        return from;
    }
    return -1;
};

String.prototype.regexLastIndexOf = function(elt /*, from*/)
  {
    var arr = this.split('');
    var len = arr.length;

    var from = Number(arguments[1]);
    if (isNaN(from)) {
      from = len - 1;
    } else {
      from = (from < 0) ? Math.ceil(from) : Math.floor(from);
      if (from < 0)
        from += len;
      else if (from >= len)
        from = len - 1;
    }

    for (; from > -1; from--) {
      if (from in arr && elt.exec(arr[from]) )
        return from;
    }
    return -1;
  }; 
```

他们似乎通过了我在问题中提供的测试功能。

显然，它们只有在正则表达式匹配一个字符时才有效，但这对于我的目的来说已经足够了，因为我会将它用于（ [abc] ， \s ， \W ， \D ）

如果有人提供适用于任何正则表达式的更好/更快/更清洁/更通用的实现，我将继续关注这个问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-15T07:07:11.470

在某些简单的情况下，您可以使用 split 来简化向后搜索。

```
function regexlast(string,re){
  var tokens=string.split(re);
  return (tokens.length>1)?(string.length-tokens[tokens.length-1].length):null;
} 
```

这有几个严重的问题：

1.  重叠的比赛不会出现
2.  返回的索引是匹配的结尾而不是开头（如果您的正则表达式是常量，则很好）

但从好的方面来说，它的代码更少。对于不能重叠的恒定长度正则表达式（例如`/\s\w/`用于查找单词边界），这已经足够了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-04-20T02:19:38.947

对于稀疏匹配的数据，使用 string.search 是跨浏览器最快的。它在每次迭代时将字符串重新切片为：

```
function lastIndexOfSearch(string, regex, index) {
  if(index === 0 || index)
     string = string.slice(0, Math.max(0,index));
  var idx;
  var offset = -1;
  while ((idx = string.search(regex)) !== -1) {
    offset += idx + 1;
    string = string.slice(idx + 1);
  }
  return offset;
} 
```

对于密集数据，我做了这个。与执行方法相比，它很复杂，但对于密集数据，它比我尝试过的所有其他方法快 2-10 倍，比公认的解决方案快约 100 倍。要点是：

1.  它在一次传入的正则表达式上调用 exec 以验证是否存在匹配或提前退出。我使用 (?= 在类似的方法中执行此操作，但在 IE 上使用 exec 检查速度要快得多。
2.  它以 '(r) 的格式构造并缓存修改后的正则表达式。*(?!.* ?r)'
3.  执行新的正则表达式并返回该 exec 或第一个 exec 的结果；

    ```
    function lastIndexOfGroupSimple(string, regex, index) {
        if (index === 0 || index) string = string.slice(0, Math.max(0, index + 1));
        regex.lastIndex = 0;
        var lastRegex, index
        flags = 'g' + (regex.multiline ? 'm' : '') + (regex.ignoreCase ? 'i' : ''),
        key = regex.source + '$' + flags,
        match = regex.exec(string);
        if (!match) return -1;
        if (lastIndexOfGroupSimple.cache === undefined) lastIndexOfGroupSimple.cache = {};
        lastRegex = lastIndexOfGroupSimple.cache[key];
        if (!lastRegex)
            lastIndexOfGroupSimple.cache[key] = lastRegex = new RegExp('.*(' + regex.source + ')(?!.*?' + regex.source + ')', flags);
        index = match.index;
        lastRegex.lastIndex = match.index;
        return (match = lastRegex.exec(string)) ? lastRegex.lastIndex - match[1].length : index;
    }; 
    ```

[jsPerf 方法](http://jsperf.com/lastindexof-regex/6)

我不明白测试的目的。需要正则表达式的情况无法与对 indexOf 的调用进行比较，我认为这是首先制作该方法的重点。为了让测试通过，使用 'xxx+(?!x)' 比调整正则表达式的迭代方式更有意义。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-06-11T22:47:19.867

Jason Bunting 的最后一个索引不起作用。我的不是最佳的，但它有效。

```
//Jason Bunting's
String.prototype.regexIndexOf = function(regex, startpos) {
var indexOf = this.substring(startpos || 0).search(regex);
return (indexOf >= 0) ? (indexOf + (startpos || 0)) : indexOf;
}

String.prototype.regexLastIndexOf = function(regex, startpos) {
var lastIndex = -1;
var index = this.regexIndexOf( regex );
startpos = startpos === undefined ? this.length : startpos;

while ( index >= 0 && index < startpos )
{
    lastIndex = index;
    index = this.regexIndexOf( regex, index + 1 );
}
return lastIndex;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-08-26T16:33:20.807

仍然没有执行请求任务的本机方法。

这是我正在使用的代码。它模仿[String.prototype.indexOf](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf)和[String.prototype.lastIndexOf](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/lastIndexOf)方法的行为，但除了表示要搜索的值的字符串之外，它们还接受 RegExp 作为搜索参数。

是的，答案很长，因为它试图尽可能接近当前标准，当然还包含合理数量的[JSDOC](http://usejsdoc.org/)注释。然而，一旦缩小，代码只有 2.27k，一旦压缩传输，它只有 1023 字节。

这添加到的 2 个方法`String.prototype`（在可用的情况下使用[Object.defineProperty](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)）是：

1.  `searchOf`
2.  `searchLastOf`

它通过了 OP 发布的所有测试，此外，我在日常使用中对例程进行了非常彻底的测试，并试图确保它们在多个环境中工作，但总是欢迎反馈/问题。

```
/*jslint maxlen:80, browser:true */

/*
 * Properties used by searchOf and searchLastOf implementation.
 */

/*property
    MAX_SAFE_INTEGER, abs, add, apply, call, configurable, defineProperty,
    enumerable, exec, floor, global, hasOwnProperty, ignoreCase, index,
    lastIndex, lastIndexOf, length, max, min, multiline, pow, prototype,
    remove, replace, searchLastOf, searchOf, source, toString, value, writable
*/

/*
 * Properties used in the testing of searchOf and searchLastOf implimentation.
 */

/*property
    appendChild, createTextNode, getElementById, indexOf, lastIndexOf, length,
    searchLastOf, searchOf, unshift
*/

(function () {
    'use strict';

    var MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || Math.pow(2, 53) - 1,
        getNativeFlags = new RegExp('\\/([a-z]*)$', 'i'),
        clipDups = new RegExp('([\\s\\S])(?=[\\s\\S]*\\1)', 'g'),
        pToString = Object.prototype.toString,
        pHasOwn = Object.prototype.hasOwnProperty,
        stringTagRegExp;

    /**
     * Defines a new property directly on an object, or modifies an existing
     * property on an object, and returns the object.
     *
     * @private
     * @function
     * @param {Object} object
     * @param {string} property
     * @param {Object} descriptor
     * @returns {Object}
     * @see https://goo.gl/CZnEqg
     */
    function $defineProperty(object, property, descriptor) {
        if (Object.defineProperty) {
            Object.defineProperty(object, property, descriptor);
        } else {
            object[property] = descriptor.value;
        }

        return object;
    }

    /**
     * Returns true if the operands are strictly equal with no type conversion.
     *
     * @private
     * @function
     * @param {*} a
     * @param {*} b
     * @returns {boolean}
     * @see http://www.ecma-international.org/ecma-262/5.1/#sec-11.9.4
     */
    function $strictEqual(a, b) {
        return a === b;
    }

    /**
     * Returns true if the operand inputArg is undefined.
     *
     * @private
     * @function
     * @param {*} inputArg
     * @returns {boolean}
     */
    function $isUndefined(inputArg) {
        return $strictEqual(typeof inputArg, 'undefined');
    }

    /**
     * Provides a string representation of the supplied object in the form
     * "[object type]", where type is the object type.
     *
     * @private
     * @function
     * @param {*} inputArg The object for which a class string represntation
     *                     is required.
     * @returns {string} A string value of the form "[object type]".
     * @see http://www.ecma-international.org/ecma-262/5.1/#sec-15.2.4.2
     */
    function $toStringTag(inputArg) {
        var val;
        if (inputArg === null) {
            val = '[object Null]';
        } else if ($isUndefined(inputArg)) {
            val = '[object Undefined]';
        } else {
            val = pToString.call(inputArg);
        }

        return val;
    }

    /**
     * The string tag representation of a RegExp object.
     *
     * @private
     * @type {string}
     */
    stringTagRegExp = $toStringTag(getNativeFlags);

    /**
     * Returns true if the operand inputArg is a RegExp.
     *
     * @private
     * @function
     * @param {*} inputArg
     * @returns {boolean}
     */
    function $isRegExp(inputArg) {
        return $toStringTag(inputArg) === stringTagRegExp &&
                pHasOwn.call(inputArg, 'ignoreCase') &&
                typeof inputArg.ignoreCase === 'boolean' &&
                pHasOwn.call(inputArg, 'global') &&
                typeof inputArg.global === 'boolean' &&
                pHasOwn.call(inputArg, 'multiline') &&
                typeof inputArg.multiline === 'boolean' &&
                pHasOwn.call(inputArg, 'source') &&
                typeof inputArg.source === 'string';
    }

    /**
     * The abstract operation throws an error if its argument is a value that
     * cannot be converted to an Object, otherwise returns the argument.
     *
     * @private
     * @function
     * @param {*} inputArg The object to be tested.
     * @throws {TypeError} If inputArg is null or undefined.
     * @returns {*} The inputArg if coercible.
     * @see https://goo.gl/5GcmVq
     */
    function $requireObjectCoercible(inputArg) {
        var errStr;

        if (inputArg === null || $isUndefined(inputArg)) {
            errStr = 'Cannot convert argument to object: ' + inputArg;
            throw new TypeError(errStr);
        }

        return inputArg;
    }

    /**
     * The abstract operation converts its argument to a value of type string
     *
     * @private
     * @function
     * @param {*} inputArg
     * @returns {string}
     * @see https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tostring
     */
    function $toString(inputArg) {
        var type,
            val;

        if (inputArg === null) {
            val = 'null';
        } else {
            type = typeof inputArg;
            if (type === 'string') {
                val = inputArg;
            } else if (type === 'undefined') {
                val = type;
            } else {
                if (type === 'symbol') {
                    throw new TypeError('Cannot convert symbol to string');
                }

                val = String(inputArg);
            }
        }

        return val;
    }

    /**
     * Returns a string only if the arguments is coercible otherwise throws an
     * error.
     *
     * @private
     * @function
     * @param {*} inputArg
     * @throws {TypeError} If inputArg is null or undefined.
     * @returns {string}
     */
    function $onlyCoercibleToString(inputArg) {
        return $toString($requireObjectCoercible(inputArg));
    }

    /**
     * The function evaluates the passed value and converts it to an integer.
     *
     * @private
     * @function
     * @param {*} inputArg The object to be converted to an integer.
     * @returns {number} If the target value is NaN, null or undefined, 0 is
     *                   returned. If the target value is false, 0 is returned
     *                   and if true, 1 is returned.
     * @see http://www.ecma-international.org/ecma-262/5.1/#sec-9.4
     */
    function $toInteger(inputArg) {
        var number = +inputArg,
            val = 0;

        if ($strictEqual(number, number)) {
            if (!number || number === Infinity || number === -Infinity) {
                val = number;
            } else {
                val = (number > 0 || -1) * Math.floor(Math.abs(number));
            }
        }

        return val;
    }

    /**
     * Copies a regex object. Allows adding and removing native flags while
     * copying the regex.
     *
     * @private
     * @function
     * @param {RegExp} regex Regex to copy.
     * @param {Object} [options] Allows specifying native flags to add or
     *                           remove while copying the regex.
     * @returns {RegExp} Copy of the provided regex, possibly with modified
     *                   flags.
     */
    function $copyRegExp(regex, options) {
        var flags,
            opts,
            rx;

        if (options !== null && typeof options === 'object') {
            opts = options;
        } else {
            opts = {};
        }

        // Get native flags in use
        flags = getNativeFlags.exec($toString(regex))[1];
        flags = $onlyCoercibleToString(flags);
        if (opts.add) {
            flags += opts.add;
            flags = flags.replace(clipDups, '');
        }

        if (opts.remove) {
            // Would need to escape `options.remove` if this was public
            rx = new RegExp('[' + opts.remove + ']+', 'g');
            flags = flags.replace(rx, '');
        }

        return new RegExp(regex.source, flags);
    }

    /**
     * The abstract operation ToLength converts its argument to an integer
     * suitable for use as the length of an array-like object.
     *
     * @private
     * @function
     * @param {*} inputArg The object to be converted to a length.
     * @returns {number} If len <= +0 then +0 else if len is +INFINITY then
     *                   2^53-1 else min(len, 2^53-1).
     * @see https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
     */
    function $toLength(inputArg) {
        return Math.min(Math.max($toInteger(inputArg), 0), MAX_SAFE_INTEGER);
    }

    /**
     * Copies a regex object so that it is suitable for use with searchOf and
     * searchLastOf methods.
     *
     * @private
     * @function
     * @param {RegExp} regex Regex to copy.
     * @returns {RegExp}
     */
    function $toSearchRegExp(regex) {
        return $copyRegExp(regex, {
            add: 'g',
            remove: 'y'
        });
    }

    /**
     * Returns true if the operand inputArg is a member of one of the types
     * Undefined, Null, Boolean, Number, Symbol, or String.
     *
     * @private
     * @function
     * @param {*} inputArg
     * @returns {boolean}
     * @see https://goo.gl/W68ywJ
     * @see https://goo.gl/ev7881
     */
    function $isPrimitive(inputArg) {
        var type = typeof inputArg;

        return type === 'undefined' ||
                inputArg === null ||
                type === 'boolean' ||
                type === 'string' ||
                type === 'number' ||
                type === 'symbol';
    }

    /**
     * The abstract operation converts its argument to a value of type Object
     * but fixes some environment bugs.
     *
     * @private
     * @function
     * @param {*} inputArg The argument to be converted to an object.
     * @throws {TypeError} If inputArg is not coercible to an object.
     * @returns {Object} Value of inputArg as type Object.
     * @see http://www.ecma-international.org/ecma-262/5.1/#sec-9.9
     */
    function $toObject(inputArg) {
        var object;

        if ($isPrimitive($requireObjectCoercible(inputArg))) {
            object = Object(inputArg);
        } else {
            object = inputArg;
        }

        return object;
    }

    /**
     * Converts a single argument that is an array-like object or list (eg.
     * arguments, NodeList, DOMTokenList (used by classList), NamedNodeMap
     * (used by attributes property)) into a new Array() and returns it.
     * This is a partial implementation of the ES6 Array.from
     *
     * @private
     * @function
     * @param {Object} arrayLike
     * @returns {Array}
     */
    function $toArray(arrayLike) {
        var object = $toObject(arrayLike),
            length = $toLength(object.length),
            array = [],
            index = 0;

        array.length = length;
        while (index < length) {
            array[index] = object[index];
            index += 1;
        }

        return array;
    }

    if (!String.prototype.searchOf) {
        /**
         * This method returns the index within the calling String object of
         * the first occurrence of the specified value, starting the search at
         * fromIndex. Returns -1 if the value is not found.
         *
         * @function
         * @this {string}
         * @param {RegExp|string} regex A regular expression object or a String.
         *                              Anything else is implicitly converted to
         *                              a String.
         * @param {Number} [fromIndex] The location within the calling string
         *                             to start the search from. It can be any
         *                             integer. The default value is 0\. If
         *                             fromIndex < 0 the entire string is
         *                             searched (same as passing 0). If
         *                             fromIndex >= str.length, the method will
         *                             return -1 unless searchValue is an empty
         *                             string in which case str.length is
         *                             returned.
         * @returns {Number} If successful, returns the index of the first
         *                   match of the regular expression inside the
         *                   string. Otherwise, it returns -1.
         */
        $defineProperty(String.prototype, 'searchOf', {
            enumerable: false,
            configurable: true,
            writable: true,
            value: function (regex) {
                var str = $onlyCoercibleToString(this),
                    args = $toArray(arguments),
                    result = -1,
                    fromIndex,
                    match,
                    rx;

                if (!$isRegExp(regex)) {
                    return String.prototype.indexOf.apply(str, args);
                }

                if ($toLength(args.length) > 1) {
                    fromIndex = +args[1];
                    if (fromIndex < 0) {
                        fromIndex = 0;
                    }
                } else {
                    fromIndex = 0;
                }

                if (fromIndex >= $toLength(str.length)) {
                    return result;
                }

                rx = $toSearchRegExp(regex);
                rx.lastIndex = fromIndex;
                match = rx.exec(str);
                if (match) {
                    result = +match.index;
                }

                return result;
            }
        });
    }

    if (!String.prototype.searchLastOf) {
        /**
         * This method returns the index within the calling String object of
         * the last occurrence of the specified value, or -1 if not found.
         * The calling string is searched backward, starting at fromIndex.
         *
         * @function
         * @this {string}
         * @param {RegExp|string} regex A regular expression object or a String.
         *                              Anything else is implicitly converted to
         *                              a String.
         * @param {Number} [fromIndex] Optional. The location within the
         *                             calling string to start the search at,
         *                             indexed from left to right. It can be
         *                             any integer. The default value is
         *                             str.length. If it is negative, it is
         *                             treated as 0\. If fromIndex > str.length,
         *                             fromIndex is treated as str.length.
         * @returns {Number} If successful, returns the index of the first
         *                   match of the regular expression inside the
         *                   string. Otherwise, it returns -1.
         */
        $defineProperty(String.prototype, 'searchLastOf', {
            enumerable: false,
            configurable: true,
            writable: true,
            value: function (regex) {
                var str = $onlyCoercibleToString(this),
                    args = $toArray(arguments),
                    result = -1,
                    fromIndex,
                    length,
                    match,
                    pos,
                    rx;

                if (!$isRegExp(regex)) {
                    return String.prototype.lastIndexOf.apply(str, args);
                }

                length = $toLength(str.length);
                if (!$strictEqual(args[1], args[1])) {
                    fromIndex = length;
                } else {
                    if ($toLength(args.length) > 1) {
                        fromIndex = $toInteger(args[1]);
                    } else {
                        fromIndex = length - 1;
                    }
                }

                if (fromIndex >= 0) {
                    fromIndex = Math.min(fromIndex, length - 1);
                } else {
                    fromIndex = length - Math.abs(fromIndex);
                }

                pos = 0;
                rx = $toSearchRegExp(regex);
                while (pos <= fromIndex) {
                    rx.lastIndex = pos;
                    match = rx.exec(str);
                    if (!match) {
                        break;
                    }

                    pos = +match.index;
                    if (pos <= fromIndex) {
                        result = pos;
                    }

                    pos += 1;
                }

                return result;
            }
        });
    }
}());

(function () {
    'use strict';

    /*
     * testing as follow to make sure that at least for one character regexp,
     * the result is the same as if we used indexOf
     */

    var pre = document.getElementById('out');

    function log(result) {
        pre.appendChild(document.createTextNode(result + '\n'));
    }

    function test(str) {
        var i = str.length + 2,
            r,
            a,
            b;

        while (i) {
            a = str.indexOf('a', i);
            b = str.searchOf(/a/, i);
            r = ['Failed', 'searchOf', str, i, a, b];
            if (a === b) {
                r[0] = 'Passed';
            }

            log(r);
            a = str.lastIndexOf('a', i);
            b = str.searchLastOf(/a/, i);
            r = ['Failed', 'searchLastOf', str, i, a, b];
            if (a === b) {
                r[0] = 'Passed';
            }

            log(r);
            i -= 1;
        }
    }

    /*
     * Look for the a among the xes
     */

    test('xxx');
    test('axx');
    test('xax');
    test('xxa');
    test('axa');
    test('xaa');
    test('aax');
    test('aaa');
}());
```

```
<pre id="out"></pre>
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-06-04T21:10:24.670

如果您正在使用 RegExp 寻找一个非常简单的 lastIndex 查找，并且不在乎它是否模仿 lastIndexOf 到最后一个细节，这可能会引起您的注意。

我只是反转字符串，并从长度中减去第一个出现索引 - 1。它恰好通过了我的测试，但我认为长字符串可能会出现性能问题。

```
interface String {
  reverse(): string;
  lastIndex(regex: RegExp): number;
}

String.prototype.reverse = function(this: string) {
  return this.split("")
    .reverse()
    .join("");
};

String.prototype.lastIndex = function(this: string, regex: RegExp) {
  const exec = regex.exec(this.reverse());
  return exec === null ? -1 : this.length - 1 - exec.index;
}; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-07-16T09:05:49.360

我使用 `String.prototype.match(regex)`它返回一个字符串数组，其中包含字符串中给定的所有找到的匹配项`regex`（更多信息[请参见此处](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match)）：

```
function getLastIndex(text, regex, limit = text.length) {
  const matches = text.match(regex);

  // no matches found
  if (!matches) {
    return -1;
  }

  // matches found but first index greater than limit
  if (text.indexOf(matches[0] + matches[0].length) > limit) {
    return -1;
  }

  // reduce index until smaller than limit
  let i = matches.length - 1;
  let index = text.lastIndexOf(matches[i]);
  while (index > limit && i >= 0) {
    i--;
    index = text.lastIndexOf(matches[i]);
  }
  return index > limit ? -1 : index;
}

// expect -1 as first index === 14
console.log(getLastIndex('First Sentence. Last Sentence. Unfinished', /\. /g, 10));

// expect 29
console.log(getLastIndex('First Sentence. Last Sentence. Unfinished', /\. /g));
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-08-31T19:00:52.333

```
var mystring = "abc ab a";
var re  = new RegExp("ab"); // any regex here

if ( re.exec(mystring) != null ){ 
   alert("matches"); // true in this case
} 
```

使用标准正则表达式：

```
var re  = new RegExp("^ab");  // At front
var re  = new RegExp("ab$");  // At end
var re  = new RegExp("ab(c|d)");  // abc or abd 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-06-29T14:46:01.380

对于比发布的大多数其他答案更简洁的解决方案，您可能希望使用该`String.prototype.replace`函数将在每个检测到的模式上运行一个函数。例如：

```
let firstIndex = -1;
"the 1st numb3r".replace(/\d/,(p,i) => { firstIndex = i; });
// firstIndex === 4 
```

这对于“最后一个索引”的情况特别有用：

```
let lastIndex = -1;
"the l4st numb3r".replace(/\d/g,(p,i) => { lastIndex = i; });
// lastIndex === 13 
```

在这里，重要的是包含“g”修饰符，以便评估所有出现的情况。`-1`如果找不到正则表达式，这些版本也会导致。

最后，这里是包含起始索引的更通用的函数：

```
function indexOfRegex(str,regex,start = 0) {
    regex = regex.global ? regex : new RegExp(regex.source,regex.flags + "g");
    let index = -1;
    str.replace(regex,function() {
        const pos = arguments[arguments.length - 2];
        if(index < 0 && pos >= start)
            index = pos;
    });
    return index;
}

function lastIndexOfRegex(str,regex,start = str.length - 1) {
    regex = regex.global ? regex : new RegExp(regex.source,regex.flags + "g");
    let index = -1;
    str.replace(regex,function() {
        const pos = arguments[arguments.length - 2];
        if(pos <= start)
            index = pos;
    });
    return index;
} 
```

这些函数特别避免在开始索引处拆分字符串，我认为这在 Unicode 时代是有风险的。它们不会修改常见 Javascript 类的原型（尽管您可以自己自由地这样做）。它们接受更多的 RegExp 标志，例如“u”或“s”以及将来可能添加的任何标志。而且我发现对回调函数的推理比 for/while 循环更容易。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-09-08T23:23:07.137

```
let regExp; // your RegExp here
arr.map(x => !!x.toString().match(regExp)).indexOf(true)
```

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-11-07T23:10:30.493

好吧，因为您只是想匹配一个*character*的位置，所以正则表达式可能是矫枉过正。

我想你想要的只是“找到这些字符中的第一个”，而不是找到这些字符中的第一个。

这当然是一个简单的答案，但是你的问题是做什么的，尽管没有正则表达式部分（因为你没有明确为什么它必须是一个正则表达式）

```
function mIndexOf( str , chars, offset )
{
   var first  = -1; 
   for( var i = 0; i < chars.length;  i++ )
   {
      var p = str.indexOf( chars[i] , offset ); 
      if( p < first || first === -1 )
      {
           first = p;
      }
   }
   return first; 
}
String.prototype.mIndexOf = function( chars, offset )
{
   return mIndexOf( this, chars, offset ); # I'm really averse to monkey patching.  
};
mIndexOf( "hello world", ['a','o','w'], 0 );
>> 4 
mIndexOf( "hello world", ['a'], 0 );
>> -1 
mIndexOf( "hello world", ['a','o','w'], 4 );
>> 4
mIndexOf( "hello world", ['a','o','w'], 5 );
>> 6
mIndexOf( "hello world", ['a','o','w'], 7 );
>> -1 
mIndexOf( "hello world", ['a','o','w','d'], 7 );
>> 10
mIndexOf( "hello world", ['a','o','w','d'], 10 );
>> 10
mIndexOf( "hello world", ['a','o','w','d'], 11 );
>> -1 
```

# sql - MySQL：如何以编程方式确定外键关系？

> ID：273794
> 
> 赞同：14
> 
> 时间：2008-11-07T22:04:44.793
> 
> 标签：sql, mysql, c, foreign-keys

类似于[这个问题](https://stackoverflow.com/questions/85978/query-a-tables-foreign-key-relationships)，但对于 MySQL....

如何以编程方式确定 MySQL 中的外键引用（假设 InnoDB）？我几乎可以得到它们：

```
SHOW TABLE STATUS WHERE Name = 'MyTableName'; 
```

...但是，唉，似乎包含其中一些信息的评论栏被截断了，所以我不能依赖它。一定有别的办法...

我会对 C API 调用、SQL 语句以及任何东西感到满意——我只需要能够始终如一地工作的东西。

注意：我也考虑过解析“SHOW CREATE TABLE MyTableName”语句的结果，但我真的希望有更简单的东西。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-07T22:51:23.980

您可以查询两个表来获取此信息：[`INFORMATION_SCHEMA.TABLE_CONSTRAINTS`](http://dev.mysql.com/doc/refman/5.1/en/table-constraints-table.html)和[`INFORMATION_SCHEMA.KEY_COLUMN_USAGE`](http://dev.mysql.com/doc/refman/5.1/en/key-column-usage-table.html).

这是来自上面链接的后一页评论的查询，它演示了如何获取您寻求的信息。

```
SELECT CONCAT( table_name, '.', column_name, ' -> ', 
  referenced_table_name, '.', referenced_column_name ) AS list_of_fks 
FROM INFORMATION_SCHEMA.key_column_usage 
WHERE referenced_table_schema = 'test' 
  AND referenced_table_name IS NOT NULL 
ORDER BY table_name, column_name; 
```

使用您的架构名称而不是`test`上面的 ' '。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-08-08T08:36:06.200

在这里，您对@bill 解决方案有一些改进：

```
SELECT CONSTRAINT_SCHEMA AS db,
       CONCAT (
           TABLE_NAME,
           '.',
           COLUMN_NAME,
           ' -> ',
           REFERENCED_TABLE_NAME,
           '.',
           REFERENCED_COLUMN_NAME
       ) AS relationship 
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_NAME = 'your_table_name'
ORDER BY CONSTRAINT_SCHEMA,
         TABLE_NAME,
         COLUMN_NAME; 
```

在这种情况下，我通过与“your_table_name”字段的关系进行过滤，并查看关系来自哪个数据库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T22:12:46.163

尝试`INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-02-24T18:07:34.897

根据 Bill Karwin 的回答，我使用这个解决方案来获取我需要的所有信息，包括 on_delete 和 on_update 规则：

```
SELECT kcu.referenced_table_schema, kcu.constraint_name, kcu.table_name, kcu.column_name, kcu.referenced_table_name, kcu.referenced_column_name, 
       rc.update_rule, rc.delete_rule 
FROM INFORMATION_SCHEMA.key_column_usage kcu
JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc on kcu.constraint_name = rc.constraint_name
WHERE kcu.referenced_table_schema = 'db_name' 
AND kcu.referenced_table_name IS NOT NULL 
ORDER BY kcu.table_name, kcu.column_name 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-05-31T11:59:20.460

```
SELECT TABLE_NAME,
       COLUMN_NAME,
       CONSTRAINT_NAME,
       REFERENCED_TABLE_NAME,
       REFERENCED_COLUMN_NAME 
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_NAME = 'table_name'
      AND TABLE_SCHEMA = 'table_schema'; 
```

# wpf - 如何在 WPF 控件中运行 Google 地球

> ID：273795
> 
> 赞同：4
> 
> 时间：2008-11-07T22:05:06.367
> 
> 标签：wpf, winforms, com, google-earth

我正在尝试在 WPF 中运行 Google 地球，但我不知道如何。基本上我已经设法在 Windows 窗体内的 Windows 窗体控件中运行 Google 地球，一切正常。

尝试在 WPF 中做同样的事情，好吧，给出一个奇怪的结果，一个小的谷歌地球屏幕放置在表单中的任何位置，而不是在我创建的用户控件内，现在有办法让这个谷歌地球控件增长或缩小，当我增大或缩小 WPF 表单时。

任何帮助将不胜感激，我的意思是任何帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-07T22:07:34.490

如果您的 Windows 窗体控件已经完全按照您的需要工作，您可以始终使用 WindowsFormsHost 将该控件放在您的 WPF 窗体上。这可能是最容易做的事情......或者你已经在做的事情不起作用？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-24T03:17:49.463

我还编写了一个应用程序，将 Google 地球放置在 WinForms WebBrowserControl 中，该控件基于 Google 托管的或多或少的官方示例。它工作得很好。我努力在 WPF WebBrowserControl 中重新创建相同的应用程序。我的经验证实了 WPF WebBrowserControl 更难使用的普遍共识，因为它提供的控制较少。（例如，使用 WinForms WebBrowserControl，您可以使用属性删除滚动条并消除启动时的 IE 安全问题，但使用 WPF WebBrowserControl，您必须在加载的 HTML 文件中使用 kludges 才能获得相同的效果。）如果您关注Google GE 插件 WinForms 示例中，您必须将 JavaScript 回调函数移动到一个单独的类中，因为 WPF 窗口不能是 . JavaScript 和 C# 之间的 Net-COM 互操作。也许您描述的其他工件是由于您如何解决后一个限制。在找到这个解决方案之前，我很想将 WinForms WebBrowser 控件放在 WPF 窗口中，但其他人已经发布了这样做的令人不快的副作用。

# asp.net - 如何跟踪 ASP.NET 安全异常

> ID：273803
> 
> 赞同：2
> 
> 时间：2008-11-07T22:08:58.433
> 
> 标签：asp.net, security, debugging, hosting

我怎样才能弄清楚究竟是什么导致了以下错误？该页面与其他页面相同，但由于某种原因，只有此页面出现此错误。它也只发生在具有中等信任级别的 ISP (GoDaddy) 上，我无法设置断点并尝试捕获它。

```
Server Error in '/' Application.
Security Exception
Description: The application attempted to perform an operation not allowed by the security policy.  To grant this application the required permission please contact your system administrator or change the application's trust level in the configuration file.

Exception Details: System.Security.SecurityException: Request for the permission of type 'System.Security.Permissions.EnvironmentPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' failed. 
```

源错误：

```
An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below. 
```

```
堆栈跟踪：

    [SecurityException：请求'System.Security.Permissions.EnvironmentPermission，mscorlib，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089'类型的权限失败。]
       System.Security.CodeAccessSecurityEngine.Check(对象需求, StackCrawlMark& stackMark, Boolean isPermSet) +0
       System.Security.CodeAccessPermission.Demand() +59
       System.IO.Path.GetTempPath() +54
       hh.a(Int32 A_0, 布尔 A_1, 布尔 A_2) +20
       jg.b(c A_0, UInt64 A_1) +234
       ei.b(c A_0, UInt64 A_1) +18
       jg.a(c A_0, UInt64 A_1, 布尔 A_2) +61

```

```
Version Information: Microsoft .NET Framework Version:2.0.50727.1433; ASP.NET Version:2.0.50727.1433 
```

如果您遇到此问题或只是知道我如何修复或跟踪它，请添加您的答案。ISP 要求中等信任级别。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-03T13:21:00.857

您是否尝试过使用 IIS 的本地实例并将信任级别设置为中等？这将帮助您更快地调试和尝试一些东西。

(And is a good habit to get into anyway. You want to test in an environment as close to production as possible. And the VS web server definitely has a few important differences that can get you if you don't test in IIS too.)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T22:33:05.763

我不相信 GoDaddy 支持完全信任 - 尽管最近可能发生了变化。该错误是由[System.IO.Path.GetTempPath](http://msdn.microsoft.com/en-us/library/system.io.path.gettemppath.aspx)调用引起的，它需要[EnvironmentPermission](http://msdn.microsoft.com/en-us/library/system.security.permissions.environmentpermission.aspx)。

之前的调用堆栈被混淆了，所以我猜它来自组件供应商。检查更新或修复以获取他们的部分信任，或替换它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-09T10:25:29.503

Setting breakpoints in obfuscated, non-debug assemblies are hard. It will likely lead you nowhere.

Find out why the obfuscated component is trying to access the temp path.

# asp.net - 使用 .Net 2.0 向导控件设计模块化 Web 向导

> ID：273806
> 
> 赞同：3
> 
> 时间：2008-11-07T22:10:41.287
> 
> 标签：asp.net, refactoring, controls, wizard

我们有大约 10 个基本上做同样事情的应用程序，全部使用 .Net 2.0 的 Wizard Control 编写。他们遵循的流程非常简单：

```
1\. User selects option from a drop downs.
2\. Next page has more options more narrowed.
3\. User sees confirmation page.
4\. Report is generated. 
```

其中一些应用程序具有可选页面，例如允许用户为报告上传自定义图像并允许用户选择特定的数据行。

我正在尝试合并这些应用程序，但我不确定我是否以正确的方式处理这个问题。我的第一个倾向是在 SQL 中创建配置表来驱动出现的菜单。因此，例如，可能有一个带有`WizardId`、`Name`、`Theme`等的表，还有一个步骤表，以及另一个将所有内容链接在一起的表。

有没有更简单的方法来解决我刚刚错过的问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-10T02:30:28.140

我们最近一直在考虑这个问题，我提出了两个看起来都有效的选项，只是用途不同。与您所描述的类似，一种方法是创建以下内容：

*   保存向导信息的表
*   列出每个向导中要问的问题类型的表格
*   保存用户为每个问题输入的数据的表格

这是非常灵活的，但问题是您必须动态生成收集信息所需的所有控件（文本框、下拉菜单、收音机、文件上传等）并存储如何在数据库中显示该控件。

我们在最近的项目中尝试的另一种方法是将用户控件与每个向导或向导步骤类型相关联。它不是模块化的，但是您可以对控件的排列方式和数据收集方式进行大量控制。

我认为这两种方法在不同的情况下都很有用。使用数据库驱动的方法可以让您轻松生成新问题和向导，但缺乏我们想要的新应用程序的用户友好方法。

# wpf - 在 WPF 窗口中禁用除一个子控件之外的所有子控件

> ID：273809
> 
> 赞同：17
> 
> 时间：2008-11-07T22:11:36.230
> 
> 标签：wpf, xaml, controls, code-behind

我的窗口上有一堆控件。其中之一是在后台线程上执行繁琐任务的刷新按钮。

当用户单击刷新按钮时，我将光标置于等待（沙漏）状态并禁用整个窗口 -- `Me.IsEnabled = False`。

我想通过让用户单击取消按钮来支持取消刷新操作，但是当整个窗口被禁用时，我无法做到这一点。

除了一个一个地禁用每个控件（取消按钮除外）然后在用户单击取消时一个个地重新启用它们之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-07T22:33:48.680

您可以将所有控件放在一个面板中（Grid、StackPanel 等），而将取消按钮留在另一个面板中。然后设置另一个面板的 IsEnabled 属性。

在实践中，这可能会引入不止一个额外的面板。

例如，如果您有一个 StackPanel 按钮，您可以添加一个额外的 StackPanel：

```
<StackPanel Orientation="Horizontal">
    <StackPanel x:Name="controlContainer" Orientation="Horizontal">
        <!-- Other Buttons Here -->
    </StackPanel>
    <Button Content="Cancel" />
</StackPanel> 
```

然后，您将执行以下操作来禁用除取消按钮之外的所有内容：

```
controlContainer.IsEnabled = false; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-07T22:00:59.477

我还希望用户能够取消加载。我找到了一个可爱的解决方案。

```
foreach (Control ctrl in this.Controls)
    ctrl.Enabled = false;

CancelButton.Enabled = true; 
```

这也允许选择和移动主窗口，`this.Enabled = false;` 这与完全锁定窗口不同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T22:30:33.477

您可以将每个控件的 IsEnabled 属性数据绑定到您的自定义布尔依赖项属性，该属性会在您的应用程序处于锁定状态时发出信号。只是不要绑定取消按钮。

正如 Donnelle 提到的，您可以使用转换器设置多重绑定。这里有几个例子你可以参考。 [WPF MultiBinding 与转换器](http://www.stackenbloggen.de/PermaLink,guid,ce63f9a5-ccaa-4777-bf3d-d54e69eadec9.aspx) [实现参数化 MultiBinding 示例](http://msdn.microsoft.com/en-us/library/ms771336.aspx)

# visual-studio - MbUnit 如何与 VS 2008 配合使用

> ID：273817
> 
> 赞同：2
> 
> 时间：2008-11-07T22:15:00.887
> 
> 标签：visual-studio, visual-studio-2008, tdd, mbunit, gallio

我设置了 MbUnit 并一直在尝试使用 MbUnit GUI 让它与 VS 2008 一起工作，但每次我运行测试时它都会关闭并且我得到这个程序需要关闭错误。

我在 Gallio 上遇到了类似的问题，每次运行测试时都会出现 runner 异常。

我是否需要像 testDriven.Net 这样的 VS 插件才能使其正常工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-10T03:01:14.793

同样在这里。TestDriven.Net 确实让事情变得简单而流畅。右键单击一个测试并运行它... MBUnit 与该插件完美集成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T22:19:39.087

You don't need TestDriven.Net but it sure helps.

When you say you use the MBUnit GUI "but every time I run a test it closes..." do you mean that MBUnit closes or VS2008? If is MBUnit, then perhaps there is something wrong with your installation. If it is VS2008, then something is fishy since MBunit shouldn't cause VS2008 to crash.

I've used (though I've stopped and now use NUnit) MBUnit with TestDriven.Net and VS2005 with great success.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T06:39:59.840

我推荐 testdriven.net 作为免费工具，而 ReSharper 作为运行 MbUnit 测试的更好工具。

Gallio 测试运行不应该那样让你崩溃，某处有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T07:03:10.637

我正在使用 Visual Studio 2008、ReSharper 4.1 和最新版本的 Gallio 的组合。有了它，它工作得很好。

# asp.net - 编码混乱 - ASP.net、WCF、Linq-SQL

> ID：273819
> 
> 赞同：1
> 
> 时间：2008-11-07T22:15:29.623
> 
> 标签：asp.net, linq, wcf

自从 1 周以来，我一直在努力完成这个项目，并且一直被一个上帝知道我错过的问题所困扰。我们有一个 sql server 数据库，它有 2 个表（这里关注）。

```
Table 1 (id,langCode,englishText,translatedTextInUnicode{nvarchar(MAX)})
Table 2 (id,langCode,englishText,translatedTextInUtf-8{nvarchar(MAX)}) 
```

应用程序是分层应用程序，例如 db -> linq-sql ->wcf -> ASP.net 3.5

我尝试了很多事情，比如使用`<meta>`标签，使用`<globalization>`标签，`web.config`但无济于事。真的很难在一般情况下显示 utf 字符，并且在 aspx 页面上与手风琴控件一起使用时。我得到的只是垃圾文本。

需要一些帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-08T11:41:20.510

[除了通常链接到 Joel 关于每个软件开发人员绝对、肯定必须了解 Unicode 和字符集（没有借口！）的绝对最小值](http://joelonsoftware.com/articles/Unicode.html)的开创性文章之外，我只能强烈建议**在整个数据库中使用相同的编码**。

# c++ - 为什么使用 CruiseControl.NET 构建失败，但使用相同的设置手动构建良好？

> ID：273836
> 
> 赞同：3
> 
> 时间：2008-11-07T22:27:28.943
> 
> 标签：c++, dll, cruisecontrol.net

我有一个构建良好的项目如果我手动构建它但它在 CC.NET 中失败。

CC.NET 上出现的错误基本上与导入失败有关，因为找不到文件；其中一个项目（C++ dll）尝试导入由另一个项目构建的 dll。Dll 应该在正确的位置，因为项目之间存在依赖关系 - 确实，当我手动构建时一切正常（请注意，当我说手动时，我从源代码存储库中获取所有内容，然后从 VS2005 调用 Rebuild 来模拟 CC.NET自动化）。

当通过 CC.NET 自动构建时，似乎忽略了依赖项。

我正在 Release MinDependency 模式下构建。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T21:07:20.047

您可以更改 CC 以使用 msbuild 而不是 devenv 吗？这对我来说似乎是最佳解决方案，因为这意味着在两种情况下构建都是相同的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T20:40:34.530

经过长时间的调查 - 我在当前阶段对此的理解是，问题与我使用 devenv 通过 CruiseControl.NET 构建但当我手动构建时 VisualStudio 使用 msbuild 的事实有关。

基本上这会导致依赖项被忽略（因为我没有使用 devenv 复制一些 msbuild 命令 arg）。

我认为在 C++ 项目之间设置依赖关系这一事实在某种程度上也很重要，因为我已经能够在其他场合使用 CC.NET 正确构建 .NET 项目和 C++ 项目之间的依赖关系。

为了弄清楚究竟是什么产生了这种不同的行为，我必须遵循[这条线索](https://stackoverflow.com/questions/280559/how-to-get-cmd-line-build-command-for-vs-solution)。

我想听听其他人对此的看法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T22:29:32.120

尝试从命令行构建它，看看会发生什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-08T20:40:23.790

我的猜测是，配置服务的用户与实际运行它时具有不同的权限和/或环境变量。如果您在同一个物理盒子上，并且它与 Visual Studio 编译得很好，并且您还在 CruiseControl（而不是 MSBuild）中使用 Visual Studio，那么几乎可以肯定它是用户。但是，如果您在 CruiseControl 中使用 MSBuild，则 MSBuild (2.0) 编译 C++ sln 和 Visual Studio 编译它时会有很大的不同。如果您必须在 C++ 解决方案上使用 MSBuild，请尝试 v3.5，它对 C++ 解决方案有更多支持。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T22:30:15.897

我想知道 CC.Net 是否正在使用不同的环境变量进行构建，从而没有将必要的库目录正确添加到路径中。

CC.Net 构建日志中是否有任何特定的错误消息说明特定 DLL 导入失败的原因？找不到文件？权限？查看详细的 CC.Net 构建日志以了解故障，并查看它与普通命令行构建的不同之处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T20:44:59.183

如果我在 IDE 中打开并编译我的解决方案，我会遇到这样的情况，但如果我从命令行（msbuild 或 devenv）运行则会失败。在每种情况下，问题都是由于参考错误 - 可能来自本地盒子和构建服务器之间不匹配的路径。您会看到它在 IDE 中正确编译，因为 VisualStudio 在打开解决方案时会尝试自动解析损坏的路径。当它这样做时，它不会告诉你它，通常不会改变你的解决方案和项目文件（这是你所希望的。）

尝试在文本编辑器中打开您的解决方案文件和/或项目文件，并确保所有相对路径都有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T14:53:34.020

正如亚历克斯所说，我认为您的问题是 CC.NET 服务作为本地用户帐户运行。不幸的是，一些 C++ 环境变量是每个用户的，不会被转移到默认的构建环境中。**在我的情况下，它是在Tools -> Options -> Projects and Solutions -> VC++ Directories**中定义的 lib 和 include 文件。同样的问题显然会导致其他问题，并在[本文](http://confluence.public.thoughtworks.org/display/CCNET/The+Server+Service+Application)中称为黄色块。

我的解决方案是在专门用于构建的构建机器上创建一个新用户（*BuildUser ）。*关键是然后以*BuildUser*身份登录并设置环境。最后，我将 CC.NET 服务更改为以 BuildUser 身份登录*并*重新启动它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-29T07:28:42.017

（重新发布，因为我最初的帖子似乎失败了）

VC2003 似乎在依赖和输入库之间存在不一致。

一个例子：

*   项目A-> A.lib
*   项目B-> B.exe
    *   在 Properties-->Linker-->Additional Input Libraries 中，指定了 A.lib。
    *   在 Project Dependencies 中，ProjectA 未选中（为什么它不是自动的对我来说仍然是个谜）

清理ProjectB时，A.lib不会被删除，ProjectB编译时也不会重建。因此，构建似乎在您的本地计算机上成功。

CC.NET 从头开始​​，构建失败，因为首先找不到 A.lib。

# html - 您如何处理带有标记的文本翻译？

> ID：273847
> 
> 赞同：37
> 
> 时间：2008-11-07T22:31:38.763
> 
> 标签：html, internationalization, translation, gettext

我正在为我们的网络应用程序开发多语言支持。我们在[gettext](http://en.wikipedia.org/wiki/Gettext)库周围使用[Django 的助手。](http://docs.djangoproject.com/en/dev/topics/i18n/)一切都出乎意料地简单，除了如何处理包含重要 HTML 标记的句子的问题。这是一个简单的例子：

```
Please <a href="/login/">log in</a> to continue. 
```

以下是我能想到的方法：

1.  更改链接以包含整个句子。不管在这种情况下改变是否是一个好主意，这个解决方案的问题是，当两者在理想情况下独立时，UI 变得依赖于 i18n 的需求。

2.  将上面的整个字符串标记为翻译（包括格式）。然后，翻译字符串也将直接包含 HTML。问题在于更改 HTML 格式需要更改所有翻译。

3.  紧密耦合多个翻译，然后使用字符串插值来组合它们。例如，短语“请 %s 继续”和“登录”可以分别标记为翻译，然后合并。“登录”被本地化，然后包装在 HREF 中，然后插入到翻译的短语中，这使 %s 保持在翻译中以标记链接应该去哪里。这种方法使代码复杂化并破坏了翻译字符串的独立性。

还有其他选择吗？其他人是如何解决这个问题的？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-21T17:58:57.147

解决方案 2 就是您想要的。将整个句子发送给他们，并嵌入 HTML 标记。

原因：

1.  主要的翻译工具 Trados 可以保护标记免受翻译人员无意中的破坏。
2.  Trados 还可以自动翻译它之前看到的文本，即使标签的内容发生了变化（但标签的数量和它们在句子中的位置是一样的）。最起码，译者会给你一个很好的折扣。
3.  样式是特定于语言环境的。在某些情况下，粗体在中文或日文中是不合适的，例如，斜体在东亚语言中不太常用。译者应该有保留或删除样式的自由。
4.  词序是特定于语言的。如果将上面的句子分割成片段，它可能适用于英语和法语，但在中文或日语中，当你连接时，单词顺序会不正确。出于这个原因，最好的做法是外化整个句子，而不是句子片段。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-07T23:51:27.993

2、带有潜在的扭曲。

您当然可以本地化整个字符串，例如：

```
loginLink=Please <a href="/login">log in</a> to continue 
```

但是，根据您的工具和本地化团队，他们可能更喜欢您执行以下操作：

```
// tokens in this string add html links
loginLink=Please {0}log in{1} to continue 
```

那将是我的首选方法。如果您有忽略某些字符的本地化工具，您可以使用不同的替换模式。例如

```
loginLink=Please %startlink%log in%endlink% to continue 
```

然后在您的 jsp、servlet 或等效语言中为您使用的任何语言执行替换...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-07T22:54:04.723

免责声明：我本人在软件国际化方面没有经验。

1.  我认为这在任何情况下都不好——只是引入了太多的耦合……</li>
2.  只要您在需要翻译的部分中保持稀疏格式，就可以了。让翻译者有可能赋予特殊词以重要性（通过使它们成为链接或可能使用`<strong />`强调听起来是个好主意。但是，那些带有 (X)HTML 的翻译可能无法在其他任何地方轻松使用。
3.  这对我来说听起来像是不必要的工作……</li>

如果是我，我想我会采用第二种方法，但我会将 URI 放入格式化参数中，这样就可以更改它而无需更改所有这些翻译。

```
Please <a href="%s">log in</a> to continue. 
```

您应该记住，如果您采用这种方法，您可能需要教您的翻译人员有关 (X)HTML 的基本知识，这样他们就不会搞砸您的标记，并且他们知道从他们编写的文本中可以期待什么. 无论如何，这种额外的知识可能会导致更好的语义标记，因为如上所述，可以使用 (X)HTML 翻译和注释文本以反映本地写作风格。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-12T13:18:23.900

无论您做什么，都将整个句子保留为一个字符串。您需要理解整个句子才能正确翻译。

并非所有单词都应该翻译成所有语言：例如，在挪威语中，一个不使用“please”（我们*可以*说“vær så snill”字面意思是“be so kind”，但用作命令时听起来太有力了）所以正确挪威语应该是：

*   “Logg inn for å fortsette”点亮：“登录以继续”或
*   “Fortsett ved å logge inn”点亮：“继续登录”等。

您必须允许完全更改顺序，例如在虚构的演示语言中：

*   “Für kontinuer Loggen bitte ins”（如果是真的）点亮：“要继续登录，请登录”

某些语言甚至可能对（大部分）这句话也只有一个词......

我会推荐解决方案 1 或者可能是“请 %{startlink}login%{endlink} 继续”，这样翻译者可以将整个句子变成一个链接，如果这样更自然，并且可以完全重组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-09T21:48:47.803

有趣的问题，我很快就会遇到这个问题。我想我会选择 2，没有任何棘手的东西。HTML 标记很简单，url 不会很快移动，如果有任何更改，将在 django.po 中创建一个新条目，因此我们有机会查看翻译（例如：脚本应该在之后检查空翻译`makemessages`） .

所以，在模板中：

```
{% load i18n %}
{% trans 'hello <a href="/">world</a>' %} 
```

...然后，在`python manage.py makemessages`我进入 django.po 之后

```
#: templates/out.html:3
msgid "hello <a href=\"/\">world</a>"
msgstr "" 
```

我把它改成我的需要

```
#: templates/out.html:3
msgid "hello <a href=\"/\">world</a>"
msgstr "bonjour <a href=\"/\">monde</a>" 
```

...在我会遇到的简单而常见的情况下，它不值得再麻烦了。这里的其他解决方案似乎很聪明，但我不认为标记问题的解决方案是更多标记。另外，我想避免模板中出现太多令人困惑的东西。

我猜你的模板应该会在一段时间后相当稳定，但我不知道你还期待什么其他麻烦。如果内容一次又一次地变化，那么该内容的位置可能不在模板内，而是在模型内。

[编辑：我刚刚在文档](http://docs.djangoproject.com/en/dev/topics/i18n/?)中检查了它，如果你需要翻译中的变量，有`blocktrans`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-08T21:17:20.957

1.  没有意义，您将如何翻译“登录”？
2.  我认为许多翻译人员没有 HTML 经验（普通的非 HTML 翻译人员会更便宜）
3.  我会选择选项 3，或者使用“请 %slog in%s 继续”并将 %s 替换为部分链接。

# c# - 在 C# 3.0 中，是否有任何类可以帮助我生成静态 html？

> ID：273848
> 
> 赞同：5
> 
> 时间：2008-11-07T22:32:04.690
> 
> 标签：c#, html

我正在开发一个 HTML 表单设计器，它需要生成静态 HTML 并将其展示给用户。我一直在写这样的丑陋代码：

```
public string GetCheckboxHtml()
{
    return ("&lt;input type="checkbox" name="somename" /&gt;");
} 
```

是不是有一组强类型类来描述 html 元素并允许我编写这样的代码：

```
var checkbox = new HtmlCheckbox(attributes);
return checkbox.Html(); 
```

我只是想不出正确的命名空间来查找这个或在 Google 中使用的正确搜索词。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-07T22:41:38.633

好吧，如果您下载[ASP.NET MVC](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=MVC&referringTitle=Home) DLL（您可以在*任何*类型的项目中使用它......包括控制台应用程序）.​​.....那么您可以使用它们拥有的许多 HTML 帮助程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T22:39:14.537

一种选择是使用[XElement](http://msdn.microsoft.com/en-us/library/system.xml.linq.xelement.aspx) [功能构造](http://msdn.microsoft.com/en-us/library/bb387019.aspx)。有关示例日历生成器，请参阅[此博客文章。](http://jacobcarpenter.wordpress.com/2008/04/16/pc1-a-solution/)

在您的情况下，您的 Html 可以通过以下方式生成：

```
var input = new XElement("input",
    new XAttribute("type", "checkbox"),
    new XAttribute("name", "somename"));

return input.ToString(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-07T22:40:14.127

您可以使用 System.Web.UI.HtmlControls 命名空间中的类。然后您可以使用 RenderControl 生成 html 内容。

```
HtmlInputCheckBox box = new HtmlInputCheckBox();

StringBuilder sb = new StringBuilder();
using(StringWriter sw = new StringWriter(sb))
using(HtmlTextWriter htw = new HtmlTextWriter(sw))
{
    box.RenderControl(htw);
}
string html = sb.ToString(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T22:50:39.707

HtmlTextWriter 包含诸如“WriteStartTag”和“WriteEndTag”之类的好东西，可以用来相当容易地创建格式正确的 HTML。

您基本上将标记名和属性传递给 HtmlTextWriter，它会生成正确的 HTML，并使用 WriteEndTag 正确关闭它。

您还可以使用预先编写的 HTMLControls 将此代码包装到强类型类中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T23:26:57.387

还可以考虑使用 System.Xml。通过使用它，您几乎可以保证您的 HTML 与 XHTML 兼容。

# bignum - 如何处理庞大的数字？

> ID：273854
> 
> 赞同：1
> 
> 时间：2008-11-07T22:34:43.187
> 
> 标签：bignum

> **可能重复：**
> [大数类的最有效实现](https://stackoverflow.com/questions/26094/most-efficient-implementation-of-a-large-number-class)

假设我需要计算 2^150000。显然，这个数字将超过 int、float 或 double 的大小。如何创建允许正常数学函数但超出基本数字类型的数据类型？

如果这是“取决于您使用哪种语言”的交易。我会说 C#。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T22:37:14.273

看

[大数类的最有效实现](https://stackoverflow.com/questions/26094/most-efficient-implementation-of-a-large-number-class)

对于一些线索。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T22:44:31.547

如果 C# 不是一成不变的，并且您想要开箱即用的东西，那么有几种选择。我最了解的是[Python](http://www.python.org/)，但我认为像 Scheme 和 Ruby 这样的语言也支持大数字。

蟒蛇：`2**150000`。大约 1 秒后打印结果。

如果您想要免费的数学软件，请查看 Maxima 或 Sage。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-30T00:17:30.060

您也可以考虑使用 Frink，这是一种具有处理测量单位的本机能力的语言。它可以毫无困难地计算 2^150000，处理分数（例如 1/3+2/5 --> 11/15），计算 3 米 + 2 英寸 --> 3.0508 m，并且是一门完整的编程语言。

Frink - 版权所有 2000-2008 Alan Eliasen，eliasen@mindspring.com [http://futureboy.us/frinkdocs/](http://futureboy.us/frinkdocs/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T22:38:16.253

几种语言已经内置了对任意大数的支持。例如，您可以使用 Mathematica。我在 Mathematica 中尝试了您的示例，结果有 45,155 位。`bc`我在 Unix 机器上尝试了同样的例子。bc 支持扩展精度，但不支持扩展；它轰炸了这个例子。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T22:50:13.577

Lisp 是你的朋友。默认大整数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T22:51:09.113

我发现使用没有任意大数字的语言非常令人沮丧：能够对大多数数字使用加法等普通运算符似乎很荒谬，但仅仅因为它的大小而不得不切换到 BigInt 实例上的方法调用。

一大堆语言都有更完整的数字塔，并在需要时无缝强制；例如，Allegro Common Lisp 在 1 毫秒内评估并打印 (expt 2 150000) 的所有 45,155 位数字。

```
cl-user(2): (time (expt 2 150000))
; cpu time (non-gc) 0 msec user, 0 msec system
; cpu time (gc)     0 msec user, 0 msec system
; cpu time (total)  0 msec user, 0 msec system
; real time  1 msec
; space allocation:
;  2 cons cells, 18,784 other bytes, 0 static bytes 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-08T01:35:09.297

C 中有一个产品叫做 calc，它是一个任意精度的计算器。我在担任研究人员时使用过一次，发现它使用起来相当简单......

[http://sourceforge.net/projects/calc/](http://sourceforge.net/projects/calc/)

它可以针对困难或长时间的计算进行编程，并且可以接受来自命令行的参数。在交互模式下，它一次接受一个命令，并显示答案。

通常，这些命令只是简单的表达式，例如：

```
 3 * (4 + 1) 
```

和 calc 将打印：

```
 15 
```

Calc 执行算术运算符 +、-、/、* 以及 ^（取幂）、%（模数）和 //（整数除法）。

例如：

```
 3 * 19 ^ 43 - 1 
```

将产生：

```
 29075426613099201338473141505176993450849249622191102976 
```

Calc 值可能非常大。例如：

```
 2 ^ 23209 - 1 
```

将打印：

```
 402874115778988778181873329071 ... loads of digits ... 3779264511 
```

希望这可以帮助...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-07T22:42:04.030

我不知道 C#，但我知道 Ruby 编程语言有 BigDemical 类，它似乎允许无限大小的数字。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-09T00:40:28.487

Python 有一个 bignum 库。如果您需要用另一种语言实现 bignum 库，您至少可以使用 Python 库作为验证您的工作的参考。请注意，如果您不知道自己在寻找什么，bignums 有一些实现陷阱不会立即显而易见。

# ssl - Windows 2000 Server/IIS Classic ASP 页面的临时 SSL？

> ID：273867
> 
> 赞同：0
> 
> 时间：2008-11-07T22:39:25.237
> 
> 标签：ssl, certificate, iis-5, windows-server-2000

我必须在 Windows 2000 服务器 IIS5 上的经典 ASP 应用程序上设置临时 SSL 安全性。我需要做什么来激活 SSL？我暂时无法获得官方证书，所以我想我必须自己制作。

脚步？我是否需要访问路由器或任何东西，或者我可以通过 IIS 做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-08T08:35:37.967

Microsoft 有一篇[知识库文章](http://support.microsoft.com/kb/299525)来解释该过程，假设您正在运行（或可以激活）证书服务。如果您没有证书服务，您可以使用 OpenSSL 生成服务器证书，并将其用作步骤 2（您需要先生成自签名 CA 证书）。但是，也应该可以通过使用自签名证书跳过使用 OpenSSL 的第 1 步和第 2 步。

# c++ - boost::scoped_array 中 &p[0] 与 p.get() 的性能影响

> ID：273869
> 
> 赞同：1
> 
> 时间：2008-11-07T22:39:46.297
> 
> 标签：c++, performance, boost

该主题通常说明了一切。基本上是这样的情况：

```
boost::scoped_array<int> p(new int[10]); 
```

在做：`&p[0]`和之间的性能上有什么明显的区别`p.get()`吗？

我问是因为我更喜欢第一个，它有一个更自然的指针，如语法。事实上，它使您可以用本机指针或数组替换 p 而不必更改任何其他内容。

我猜因为 get 是一个单行“ `return ptr;`”，编译器将内联它，我希望它足够聪明，能够以`operator[]`这样一种方式内联，即它能够不取消引用然后立即引用。

有人知道吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T22:48:25.890

唯一知道的方法就是实际测量它！

但是，如果您有 boost:scoped_array 的来源，您可以查看代码并查看它的作用。我确信它非常相似。

```
T * scoped_array::get() const // never throws
{
    return ptr;
}

T & scoped_array::operator[](std::ptrdiff_t i) const // never throws
{
    BOOST_ASSERT(ptr != 0);
    BOOST_ASSERT(i >= 0);
    return ptr[i];
} 
```

编写两个版本的代码（一个使用 get()，另一个使用 operator[]）。在打开优化的情况下编译为汇编。看看你的编译器是否真的设法优化掉 ptr+0。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T23:07:29.457

好的，我已经按照 Martin York 的建议进行了一些基本测试。

似乎 g++ (4.3.2) 在这方面实际上相当不错。在 -O2 和 -O3 优化级别，它为`&p[0]`和输出略有不同但功能相同的程序集`p.get()`。

正如预期的那样，在 -Os 处，它采用了复杂性最低的路径并发出对`operator[]`. 需要注意的一点是，该`&p[0]`版本确实会导致 g++ 发出`operator[]`主体的副本，但它从未使用过，因此如果您从不使用`operator[]`其他方式，则会出现轻微的代码膨胀：

测试的代码是这样的（`#if`0和1）：

```
#include <boost/scoped_array.hpp>
#include <cstdio>

int main() {
    boost::scoped_array<int> p(new int[10]);
#if 1
    printf("%p\n", &p[0]);
#else
    printf("%p\n", p.get());
#endif
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T02:24:37.060

这是您只是出于学术兴趣而提出的问题，还是您正在编写的一些当前代码？

通常，人们建议代码清晰比速度更重要，因此除非您确定这会有所作为，否则您应该选择更清晰且与您的代码库匹配的选项。FWIW，我个人认为 get() 更清晰。

# fogbugz - FogBugz 中的时间表报告？

> ID：273876
> 
> 赞同：10
> 
> 时间：2008-11-07T22:40:47.793
> 
> 标签：fogbugz, fogbugz-on-demand

目前，在 FogBugz 中创建一周或一个月的时间表报告是一个很大的 PITA……也许有人知道为您准备的插件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-08-11T15:20:22.260

这个问题有点老了，所以我假设您使用的是 FB6，但如果您现在使用 FB7 来执行此操作：[ClarkKent](http://www.fogcreek.com/FogBugz/Plugins/plugin.aspx?ixPlugin=10)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T17:28:40.480

如果您在自己的服务器上托管了 FogBugz，则可以手动查询数据库并以这种方式获取时间表结果。如果它由 FogBugz 托管，那么您可以下载数据库，执行相同的查询，或者使用 API 获取所有时间条目。为此已经存在一些程序，其中之一是 TimeSprite，但它不是免费的。

# parsing - J2ME 属性

> ID：273889
> 
> 赞同：2
> 
> 时间：2008-11-07T22:43:21.190
> 
> 标签：parsing, java-me, properties

J2ME 缺少 java.util.Properties 类。尽管可以将应用程序设置放在 JAD 文件中，但对于许多属性不建议这样做。（因为，一些平台限制了 JAD 文件的大小。）我想在我的 jar 文件中放入一个配置文件并解析它。而且我不想使用 XML，因为它会超出我的情况。

问题是，是否有一个已经存在的 J2ME 库可以解析属性文件或类似的东西，例如 INI 文件。或者你会推荐另一种方法来解决最初的问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-08T01:31:22.940

最好的解决方案可能取决于生成属性文件的内容。

如果您有其他非 JavaME 项目使用相同的属性文件，请坚持使用它们，并编写或查找解析器。（[Google Code 上有一个来自 GoBible 的简单版本](http://code.google.com/p/gobible/source/browse/trunk/GoBibleCore/src/GoBible.java?r=110#706)）

但是，您可能会发现将配置保存在您编译的 Configuration.java 文件中并包含在 jar 中一样容易`static final String myproperty="myvalue";`，因为您不需要任何特殊代码来定位、打开、读取和解析它们。

但是，您确实会限制您对它们的称呼，因为您不能再使用常见的点分隔命名空间习语。

# ms-access - 在表格中引用

> ID：273898
> 
> 赞同：1
> 
> 时间：2008-11-07T22:46:29.030
> 
> 标签：ms-access, reference

我在 microsoft access 中有两种形式，一种称为 Bill，另一种称为 Payment。它们在两种形式中都具有总金额作为字段。我正在尝试将账单总额引用到付款总额。

我在支付总额控制源中试过：=Forms!Bill![Total Amount]

但这似乎不起作用。在设计视图中显示“#Name？” 在文本框中。

你会怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T23:09:57.000

任何一种形式都是子形式吗？如果是这样，则需要引用子窗体控件或父属性：

```
Me.Parent.[Total order]
Me.[Subform Control name Here].form.[Total order] 
```

请注意，子表单控件名称并不总是与包含的表单相同。

编辑：要么省略我，要么在控件中使用 Form!FormName。

EDIT2：请注意，引用表单、子表单和控件的常用方法是使用 bang (!) 或点 (.)。括号和引号很少使用。这可以在 Microsoft Access MVP 站点 ( [http://www.mvps.org/access/forms/frm0031.htm](http://www.mvps.org/access/forms/frm0031.htm) ) 和 Microsoft 自己的站点 ( [http://support.microsoft.com/kb/209099](http://support.microsoft.com/kb/209099) ) 中看到，正如诺克斯所说。

如果没有，您是否尝试过表达式生成器？这将有助于确保您拥有正确的姓名。

顺便说一句，最好避免在字段和控件的名称中使用空格，这将为您节省大量工作。最好重命名控件，使它们的名称与其包含的字段不同，例如 txtOrderTotal。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-08T00:01:31.203

Remou 的答案仅适用于代码 - 但是看起来您正在定义文本框的控制源，所以试试这个：

```
=Forms("Bill")![Total order] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-10T12:04:16.610

我最喜欢的解决方案是始终返回记录集并计算相应的总数，因为您并不***总是确定***表单级别的总数是否正确更新（出于任何原因，可能总是有待处理的控件/记录集更新）。然后您就可以使用 DSUM 和相关功能了！

示例：

```
dsum(Forms("Bill").recordsource, "unitPrice*lineQuantity") 
```

当然，您可以有更复杂的解决方案，例如定义一个临时记录集来获取每张发票的总金额。

```
Dim rs as DAO.recordset, _
    myBillNumber as variant, _
    myBillAmount as variant

set rs = currentDb.openRecordset(_ 
    "SELECT billNumber, sum(unitPrice*lineQuantity) as totalPrice FROM " & _
    Forms("Bill").recordset.name " GROUP BY billNumber")

myBillNumber = rs.fields(0)
myBillAmount = rs.fields(1) 
```

它可能看起来很复杂，但一旦你习惯了它，你就会毫不犹豫地使用它，而且你永远不会遇到现在面临的那种问题。

# java - 为什么 Vista 上的 Java 报告它在 XP 上？

> ID：273899
> 
> 赞同：5
> 
> 时间：2008-11-07T22:47:19.200
> 
> 标签：java, windows-vista

我偶然发现了一些真正令人费解的事情`System.getProperty("os.name")`。根据[有关此事的 Java 错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6220825)和[Java 5 发行说明](http://java.sun.com/j2se/1.5.0/ReleaseNotes.html#150_10)（搜索“os.name”），Java 中有一个错误，早期“longhorn”版本的 Vista 应该在 v5 版本 10 中修复。

然而，在我的 Vista SP1 机器上——同时使用 v5 版本 15 和 v6 版本 6——`System.getProperty("os.name")`返回“Windows XP”。进一步`System.getProperty("os.version")`返回“5.1”。不过，我无法通过 Google 找到与此问题相关的任何内容。这让我想知道我的 Vista 设置是否有些奇怪。我尝试从测试 C 程序调用 GetVersionEx() API 函数，它返回主要版本 6，次要版本 0（正如我对 Vista 安装所期望的那样）。

有没有其他人遇到过这个问题，知道修复或对我如何在不使用 JNI 的情况下解决它有任何建议？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-08T08:47:56.880

可能是 Java 在 XP 兼容模式下运行。在这种情况下，Vista 会伪造 Windows 版本号，让 Java 相信它运行在 XP 上。检查可执行文件的兼容性选项卡。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T23:21:42.470

Windows 2000 的实际 Windows 版本号是 5.0。Windows XP 是 5.1。Vista 应该是 6.0，所以您的测试程序运行正常。在我看来，Java 肯定是搞错了。

您可能必须依靠 JNI 才能获得正确答案。我假设您已经问过自己为什么需要根据您使用的是 XP 还是 Vista 来改变程序的行为。

# c++ - c++ integer->std::string 转换。简单的功能？

> ID：273908
> 
> 赞同：76
> 
> 时间：2008-11-07T22:52:08.003
> 
> 标签：c++, integer, stdstring

问题：我有一个整数；这个整数需要转换为 stl::string 类型。

过去，我曾经`stringstream`做过转换，这有点麻烦。我知道 C 方法是做 a `sprintf`，但我更愿意做一个类型安全（er）的 C++ 方法。

有一个更好的方法吗？

这是我过去使用的字符串流方法：

```
std::string intToString(int i)
{
    std::stringstream ss;
    std::string s;
    ss << i;
    s = ss.str();

    return s;
} 
```

当然，这可以重写为：

```
template<class T>
std::string t_to_string(T i)
{
    std::stringstream ss;
    std::string s;
    ss << i;
    s = ss.str();

    return s;
} 
```

但是，我认为这是一个相当“重量级”的实现。

Zan 注意到调用非常好，但是：

```
std::string s = t_to_string(my_integer); 
```

无论如何，更好的方式是......很好。

> ### 有关的：
> 
> [替代 itoa() 将整数转换为字符串 C++？](https://stackoverflow.com/questions/228005/alternative-to-itoa-for-converting-integer-to-string-c)

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2011-12-02T20:12:40.227

现在在 c++11 我们有

```
#include <string>
string s = std::to_string(123); 
```

参考链接：[http ://en.cppreference.com/w/cpp/string/basic_string/to_string](http://en.cppreference.com/w/cpp/string/basic_string/to_string)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-11-07T23:14:53.713

如前所述，我建议使用 boost lexical_cast。它不仅有一个相当不错的语法：

```
#include <boost/lexical_cast.hpp>
std::string s = boost::lexical_cast<std::string>(i); 
```

它还提供了一些安全性：

```
try{
  std::string s = boost::lexical_cast<std::string>(i);
}catch(boost::bad_lexical_cast &){
 ...
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-11-07T22:55:24.130

不是真的，在标准中。一些实现有一个非标准的 itoa() 函数，你可以查看 Boost 的 lexical_cast，但如果你坚持标准，它几乎可以在 stringstream 和 sprintf() 之间进行选择（如果你有的话，可以选择 snprintf()）。

# unix - 如何在 shell 脚本中操作 $PATH 元素？

> ID：273909
> 
> 赞同：32
> 
> 时间：2008-11-07T22:52:14.697
> 
> 标签：unix, shell, idioms, path-variables

有没有一种惯用的方法从类似 PATH 的 shell 变量中删除元素？

那就是我想拿

```
PATH=/home/joe/bin:/usr/local/bin:/usr/bin:/bin:/path/to/app/bin:. 
```

并**删除**或**替换**不破坏变量的`/path/to/app/bin`其余部分。允许我*将*新元素放在任意位置的额外积分。目标可以通过明确定义的字符串来识别，并且可以出现在列表中的任何位置。

我知道我已经看到了这一点，并且可能可以自己拼凑一些东西，但我正在寻找一种好的方法。便携性和标准化是一个优势。

我使用 bash，但也欢迎在您最喜欢的 shell 中使用示例。

* * *

这里的上下文是需要在一个大型科学分析包的多个版本（一个用于分析，另一个用于处理框架）之间方便地切换，该包产生几十个可执行文件，数据存储在文件系统周围，并使用环境变量帮助找到所有这些东西。我想编写一个选择版本的脚本，并且需要能够删除`$PATH`与当前活动版本相关的元素并将它们替换为与新版本相关的相同元素。

* * *

`$PATH`这与重新运行登录脚本等时防止重复元素的问题有关。

* * *

*   以前的类似问题：[如何避免在 csh 中复制路径变量](https://stackoverflow.com/questions/135754/how-to-keep-from-duplicating-path-variable-in-csh)
*   随后的类似问题：[从 Bash 中的 $PATH 变量中删除路径的最优雅的方法是什么？](https://stackoverflow.com/questions/370047/what-is-the-most-elegant-way-to-remove-a-path-from-the-path-variable-in-bash)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-16T15:53:15.810

解决 dmckee 提出的解决方案：

1.  虽然某些版本的 Bash 可能允许在函数名称中使用连字符，但其他版本 (MacOS X) 则不允许。
2.  我认为不需要在函数结束之前立即使用 return。
3.  我认为不需要所有分号。
4.  我不明白为什么您要逐个路径元素导出一个值。将`export`其视为等效于设置（甚至创建）全局变量 - 尽可能避免的事情。
5.  我不确定您希望 ' `replace-path PATH $PATH /usr`' 做什么，但它并没有达到我的预期。

考虑一个开始包含的 PATH 值：

```
.
/Users/jleffler/bin
/usr/local/postgresql/bin
/usr/local/mysql/bin
/Users/jleffler/perl/v5.10.0/bin
/usr/local/bin
/usr/bin
/bin
/sw/bin
/usr/sbin
/sbin 
```

我得到的结果（来自' `replace-path PATH $PATH /usr`'）是：

```
.
/Users/jleffler/bin
/local/postgresql/bin
/local/mysql/bin
/Users/jleffler/perl/v5.10.0/bin
/local/bin
/bin
/bin
/sw/bin
/sbin
/sbin 
```

我本来希望得到我的原始路径，因为 /usr 没有作为（完整的）路径元素出现，而只是作为路径元素的一部分。

这可以`replace-path`通过修改以下`sed`命令之一来解决：

```
export $path=$(echo -n $list | tr ":" "\n" | sed "s:^$removestr\$:$replacestr:" |
               tr "\n" ":" | sed "s|::|:|g") 
```

我用'：'而不是'|' 分隔替换的部分，因为 '|' 可以（理论上）出现在路径组件中，而根据 PATH 的定义，冒号不能。我观察到第二个`sed`可以从 PATH 中间消除当前目录。也就是说，PATH 的合法（尽管不正常）值可能是：

```
PATH=/bin::/usr/local/bin 
```

处理后，当前目录将不再位于 PATH 上。

锚定匹配的类似更改适用于`path-element-by-pattern`：

```
export $target=$(echo -n $list | tr ":" "\n" | grep -m 1 "^$pat\$") 
```

我顺便注意到这`grep -m 1`不是标准的（它是一个 GNU 扩展，在 MacOS X 上也可用）。而且，确实，`-n`选项`echo`也是非标准的；您最好简单地删除通过将换行符从 echo 转换为冒号而添加的尾随冒号。由于 path-element-by-pattern 只使用一次，具有不良副作用（它破坏了任何预先存在的名为 的导出变量`$removestr`），它可以被它的主体合理地替换。这与更自由地使用引号以避免空格或不需要的文件名扩展问题一起导致：

```
# path_tools.bash
#
# A set of tools for manipulating ":" separated lists like the
# canonical $PATH variable.
#
# /bin/sh compatibility can probably be regained by replacing $( )
# style command expansion with ` ` style
###############################################################################
# Usage:
#
# To remove a path:
#    replace_path         PATH $PATH /exact/path/to/remove
#    replace_path_pattern PATH $PATH <grep pattern for target path>
#
# To replace a path:
#    replace_path         PATH $PATH /exact/path/to/remove /replacement/path
#    replace_path_pattern PATH $PATH <target pattern> /replacement/path
#
###############################################################################

# Remove or replace an element of $1
#
#   $1 name of the shell variable to set (e.g. PATH)
#   $2 a ":" delimited list to work from (e.g. $PATH)
#   $3 the precise string to be removed/replaced
#   $4 the replacement string (use "" for removal)
function replace_path () {
    path=$1
    list=$2
    remove=$3
    replace=$4        # Allowed to be empty or unset

    export $path=$(echo "$list" | tr ":" "\n" | sed "s:^$remove\$:$replace:" |
                   tr "\n" ":" | sed 's|:$||')
}

# Remove or replace an element of $1
#
#   $1 name of the shell variable to set (e.g. PATH)
#   $2 a ":" delimited list to work from (e.g. $PATH)
#   $3 a grep pattern identifying the element to be removed/replaced
#   $4 the replacement string (use "" for removal)
function replace_path_pattern () {
    path=$1
    list=$2
    removepat=$3
    replacestr=$4        # Allowed to be empty or unset

    removestr=$(echo "$list" | tr ":" "\n" | grep -m 1 "^$removepat\$")
    replace_path "$path" "$list" "$removestr" "$replacestr"
} 
```

我有一个 Perl 脚本`echopath`，在调试类似 PATH 的变量的问题时我发现它很有用：

```
#!/usr/bin/perl -w
#
#   "@(#)$Id: echopath.pl,v 1.7 1998/09/15 03:16:36 jleffler Exp $"
#
#   Print the components of a PATH variable one per line.
#   If there are no colons in the arguments, assume that they are
#   the names of environment variables.

@ARGV = $ENV{PATH} unless @ARGV;

foreach $arg (@ARGV)
{
    $var = $arg;
    $var = $ENV{$arg} if $arg =~ /^[A-Za-z_][A-Za-z_0-9]*$/;
    $var = $arg unless $var;
    @lst = split /:/, $var;
    foreach $val (@lst)
    {
            print "$val\n";
    }
} 
```

当我在下面的测试代码上运行修改后的解决方案时：

```
echo
xpath=$PATH
replace_path xpath $xpath /usr
echopath $xpath

echo
xpath=$PATH
replace_path_pattern xpath $xpath /usr/bin /work/bin
echopath xpath

echo
xpath=$PATH
replace_path_pattern xpath $xpath "/usr/.*/bin" /work/bin
echopath xpath 
```

输出是：

```
.
/Users/jleffler/bin
/usr/local/postgresql/bin
/usr/local/mysql/bin
/Users/jleffler/perl/v5.10.0/bin
/usr/local/bin
/usr/bin
/bin
/sw/bin
/usr/sbin
/sbin

.
/Users/jleffler/bin
/usr/local/postgresql/bin
/usr/local/mysql/bin
/Users/jleffler/perl/v5.10.0/bin
/usr/local/bin
/work/bin
/bin
/sw/bin
/usr/sbin
/sbin

.
/Users/jleffler/bin
/work/bin
/usr/local/mysql/bin
/Users/jleffler/perl/v5.10.0/bin
/usr/local/bin
/usr/bin
/bin
/sw/bin
/usr/sbin
/sbin 
```

这对我来说是正确的——至少，对于我对问题所在的定义而言。

我注意到`echopath LD_LIBRARY_PATH`评估`$LD_LIBRARY_PATH`. 如果您的函数能够做到这一点，那就太好了，因此用户可以键入：

```
replace_path PATH /usr/bin /work/bin 
```

这可以通过使用来完成：

```
list=$(eval echo '$'$path) 
```

这导致了代码的此修订：

```
# path_tools.bash
#
# A set of tools for manipulating ":" separated lists like the
# canonical $PATH variable.
#
# /bin/sh compatibility can probably be regained by replacing $( )
# style command expansion with ` ` style
###############################################################################
# Usage:
#
# To remove a path:
#    replace_path         PATH /exact/path/to/remove
#    replace_path_pattern PATH <grep pattern for target path>
#
# To replace a path:
#    replace_path         PATH /exact/path/to/remove /replacement/path
#    replace_path_pattern PATH <target pattern> /replacement/path
#
###############################################################################

# Remove or replace an element of $1
#
#   $1 name of the shell variable to set (e.g. PATH)
#   $2 the precise string to be removed/replaced
#   $3 the replacement string (use "" for removal)
function replace_path () {
    path=$1
    list=$(eval echo '$'$path)
    remove=$2
    replace=$3            # Allowed to be empty or unset

    export $path=$(echo "$list" | tr ":" "\n" | sed "s:^$remove\$:$replace:" |
                   tr "\n" ":" | sed 's|:$||')
}

# Remove or replace an element of $1
#
#   $1 name of the shell variable to set (e.g. PATH)
#   $2 a grep pattern identifying the element to be removed/replaced
#   $3 the replacement string (use "" for removal)
function replace_path_pattern () {
    path=$1
    list=$(eval echo '$'$path)
    removepat=$2
    replacestr=$3            # Allowed to be empty or unset

    removestr=$(echo "$list" | tr ":" "\n" | grep -m 1 "^$removepat\$")
    replace_path "$path" "$removestr" "$replacestr"
} 
```

以下修改后的测试现在也可以使用：

```
echo
xpath=$PATH
replace_path xpath /usr
echopath xpath

echo
xpath=$PATH
replace_path_pattern xpath /usr/bin /work/bin
echopath xpath

echo
xpath=$PATH
replace_path_pattern xpath "/usr/.*/bin" /work/bin
echopath xpath 
```

它产生与以前相同的输出。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-17T02:18:03.340

重新发布我对[在 Bash 中从 $PATH 变量中删除路径的最优雅方法是什么？](https://stackoverflow.com/questions/370047/what-is-the-most-elegant-way-to-remove-a-path-from-the-path-variable-in-bash#370255)：

```
#!/bin/bash
IFS=:
# convert it to an array
t=($PATH)
unset IFS
# perform any array operations to remove elements from the array
t=(${t[@]%%*usr*})
IFS=:
# output the new array
echo "${t[*]}" 
```

或单线：

```
PATH=$(IFS=':';t=($PATH);unset IFS;t=(${t[@]%%*usr*});IFS=':';echo "${t[*]}"); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-07T23:31:30.047

要删除元素，您可以使用 sed：

```
#!/bin/bash
NEW_PATH=$(echo -n $PATH | tr ":" "\n" | sed "/foo/d" | tr "\n" ":")
export PATH=$NEW_PATH 
```

将从路径中删除包含“foo”的路径。

您还可以使用 sed 在给定行之前或之后插入新行。

编辑：您可以通过排序和 uniq 管道删除重复项：

```
echo -n $PATH | tr ":" "\n" | sort | uniq -c | sed -n "/ 1 / s/.*1 \(.*\)/\1/p" | sed "/foo/d" | tr "\n" ":" 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-08T06:18:13.033

[“如何避免在 csh 中复制路径变量](https://stackoverflow.com/questions/135754/how-to-keep-from-duplicating-path-variable-in-csh)”的答案中有几个相关程序。他们更专注于确保没有重复的元素，但我提供的脚本可以用作：

```
export PATH=$(clnpath $head_dirs:$PATH:$tail_dirs $remove_dirs) 
```

假设你在 $head_dirs 中有一个或多个目录，在 $tail_dirs 中有一个或多个目录，在 $remove_dirs 中有一个或多个目录，那么它使用 shell 将头部、当前和尾部部分连接成一个巨大的值，然后删除每个$remove_dirs 从结果中列出的目录（如果它们不存在则不是错误），以及消除路径中任何目录的第二次和后续出现。

这并不涉及将路径组件放置到特定位置（除了在开头或结尾，以及那些只是间接的）。从符号上讲，指定要添加新元素的位置或要替换的元素是很麻烦的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-16T17:54:29.763

请注意 bash 本身可以进行搜索和替换。它可以执行您期望的所有正常的“一次或全部”，区分大小写的选项。

从手册页：

`${parameter/pattern/string}`

该模式被扩展以产生一个模式，就像在路径名扩展中一样。参数被扩展，模式与其值的最长匹配被替换为字符串。如果 Ipattern 以 开头`/`，则所有匹配的模式都将替换为字符串。通常只替换第一场比赛。如果模式以 开头`#`，它必须匹配参数扩展值的开头。如果模式以 开头`%`，则它必须匹配参数扩展值的末尾。如果 string 为 null，则删除 pattern 的匹配项，并且`/`可以省略以下 pattern。如果 parameter 是`@`or `*`，则依次对每个位置参数应用替换操作，展开是结果列表。如果参数是下标的数组变量`@`或者 `*`，替换操作依次应用于数组的每个成员，展开就是结果列表。

您还可以通过将`$IFS`（输入字段分隔符）设置为所需的分隔符来进行字段拆分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-08T18:46:12.993

好的，感谢所有响应者。我已经准备了弗洛林答案的封装版本。第一遍看起来像这样：

```
# path_tools.bash
#
# A set of tools for manipulating ":" separated lists like the
# canonical $PATH variable.
#
# /bin/sh compatibility can probably be regained by replacing $( )
# style command expansion with ` ` style
###############################################################################
# Usage:
#
# To remove a path:
#    replace-path         PATH $PATH /exact/path/to/remove    
#    replace-path-pattern PATH $PATH <grep pattern for target path>    
#
# To replace a path:
#    replace-path         PATH $PATH /exact/path/to/remove /replacement/path   
#    replace-path-pattern PATH $PATH <target pattern> /replacement/path
#    
###############################################################################
# Finds the _first_ list element matching $2
#
#    $1 name of a shell variable to be set
#    $2 name of a variable with a path-like structure
#    $3 a grep pattern to match the desired element of $1
function path-element-by-pattern (){ 
    target=$1;
    list=$2;
    pat=$3;

    export $target=$(echo -n $list | tr ":" "\n" | grep -m 1 $pat);
    return
}

# Removes or replaces an element of $1
#
#   $1 name of the shell variable to set (i.e. PATH) 
#   $2 a ":" delimited list to work from (i.e. $PATH)
#   $2 the precise string to be removed/replaced
#   $3 the replacement string (use "" for removal)
function replace-path () {
    path=$1;
    list=$2;
    removestr=$3;
    replacestr=$4; # Allowed to be ""

    export $path=$(echo -n $list | tr ":" "\n" | sed "s|$removestr|$replacestr|" | tr "\n" ":" | sed "s|::|:|g");
    unset removestr
    return 
}

# Removes or replaces an element of $1
#
#   $1 name of the shell variable to set (i.e. PATH) 
#   $2 a ":" delimited list to work from (i.e. $PATH)
#   $2 a grep pattern identifying the element to be removed/replaced
#   $3 the replacement string (use "" for removal)
function replace-path-pattern () {
    path=$1;
    list=$2;
    removepat=$3; 
    replacestr=$4; # Allowed to be ""

    path-element-by-pattern removestr $list $removepat;
    replace-path $path $list $removestr $replacestr;
} 
```

仍然需要在所有功能中进行错误捕获，并且我可能应该坚持使用重复路径解决方案。

您可以通过`. /include/path/path_tools.bash`在工作脚本中执行 a 并调用`replace-path*`函数来使用它。

* * *

我仍然愿意接受新的和/或更好的答案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-06T22:00:26.967

这很容易使用 awk。

### 代替

```
{
  for(i=1;i<=NF;i++) 
      if($i == REM) 
          if(REP)
              print REP; 
          else
              continue;
      else 
          print $i; 
} 
```

使用它启动它

```
function path_repl {
    echo $PATH | awk -F: -f rem.awk REM="$1" REP="$2" | paste -sd:
}

$ echo $PATH
/bin:/usr/bin:/home/js/usr/bin
$ path_repl /bin /baz
/baz:/usr/bin:/home/js/usr/bin
$ path_repl /bin
/usr/bin:/home/js/usr/bin 
```

### 附加

在给定位置插入。默认情况下，它附加在末尾。

```
{ 
    if(IDX < 1) IDX = NF + IDX + 1
    for(i = 1; i <= NF; i++) {
        if(IDX == i) 
            print REP 
        print $i
    }
    if(IDX == NF + 1)
        print REP
} 
```

使用它启动它

```
function path_app {
    echo $PATH | awk -F: -f app.awk REP="$1" IDX="$2" | paste -sd:
}

$ echo $PATH
/bin:/usr/bin:/home/js/usr/bin
$ path_app /baz 0
/bin:/usr/bin:/home/js/usr/bin:/baz
$ path_app /baz -1
/bin:/usr/bin:/baz:/home/js/usr/bin
$ path_app /baz 1
/baz:/bin:/usr/bin:/home/js/usr/bin 
```

### 删除重复项

这个保留了第一次出现。

```
{ 
    for(i = 1; i <= NF; i++) {
        if(!used[$i]) {
            print $i
            used[$i] = 1
        }
    }
} 
```

像这样开始：

```
echo $PATH | awk -F: -f rem_dup.awk | paste -sd: 
```

### 验证是否所有元素都存在

以下将为文件系统中不存在的所有条目打印一条错误消息，并返回一个非零值。

```
echo -n $PATH | xargs -d: stat -c %n 
```

要简单地检查所有元素是否都是路径并获取返回码，您还可以使用`test`：

```
echo -n $PATH | xargs -d: -n1 test -d 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-29T07:02:09.797

认为

```
echo $PATH
/usr/lib/jvm/java-1.6.0/bin:lib/jvm/java-1.6.0/bin/:/lib/jvm/java-1.6.0/bin/:/usr/lib/qt-3.3/bin:/usr/lib/ccache:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/tvnadeesh/bin 
```

如果要删除 /lib/jvm/java-1.6.0/bin/ ，请执行以下操作

```
export PATH=$(echo $PATH | sed  's/\/lib\/jvm\/java-1.6.0\/bin\/://g') 
```

`sed`将从 /lib/jvm/java-1.6.0/bin/: 获取输入`echo $PATH`并将其替换为空

这样你就可以删除

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-13T17:21:40.107

*   PATH 的顺序不被打乱
*   优雅地处理空路径、路径中的空间等角落情况
*   dir 的部分匹配不会给出误报
*   以适当的方式处理 PATH 头部和尾部的路径。否**：**垃圾等。

假设你有 /foo:/some/path:/some/path/dir1:/some/path/dir2:/bar 并且你想替换 /some/path 然后它正确替换“/some/path”但留下“/ some/path/dir1" 或 "/some/path/dir2"，正如您所期望的那样。

```
function __path_add(){  
    if [ -d "$1" ] ; then  
        local D=":${PATH}:";   
        [ "${D/:$1:/:}" == "$D" ] && PATH="$PATH:$1";  
        PATH="${PATH/#:/}";  
        export PATH="${PATH/%:/}";  
    fi  
}
function __path_remove(){  
    local D=":${PATH}:";  
    [ "${D/:$1:/:}" != "$D" ] && PATH="${D/:$1:/:}";  
    PATH="${PATH/#:/}";  
    export PATH="${PATH/%:/}";  
}  
# Just for the shake of completeness
function __path_replace(){  
    if [ -d "$2" ] ; then  
        local D=":${PATH}:";   
        if [ "${D/:$1:/:}" != "$D" ] ; then
            PATH="${D/:$1:/:$2:}";  
            PATH="${PATH/#:/}";  
            export PATH="${PATH/%:/}";  
        fi
    fi  
} 
```

相关文章 [从 Bash 中的 $PATH 变量中删除路径的最优雅方法是什么？](https://stackoverflow.com/questions/370047/what-is-the-most-elegant-way-to-remove-a-path-from-the-path-variable-in-bash/11926946#11926946)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-05-15T14:10:33.983

这些天我更喜欢使用 ruby​​ 而不是 awk/sed/foo 之类的，所以这是我处理骗子的方法，

```
# add it to the path
PATH=~/bin/:$PATH:~/bin
export PATH=$(ruby -e 'puts ENV["PATH"].split(/:/).uniq.join(":")') 
```

创建一个函数以供重用，

```
mungepath() {
   export PATH=$(ruby -e 'puts ENV["PATH"].split(/:/).uniq.join(":")')
} 
```

ruby one liner中的哈希、数组和字符串:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-08T00:15:15.183

只更改部分字符串的第一件事是 sed 替换。

例如：如果 echo $PATH => "/usr/pkg/bin:/usr/bin:/bin:/usr/pkg/games:/usr/pkg/X11R6/bin" 然后将 "/usr/bin" 更改为“/usr/local/bin”可以这样完成：

## 生成标准输出文件

## 使用“=”字符而不是斜杠（“/”），因为那会很混乱，# PATH 中应该不太可能使用替代引号字符

## 路径分隔符“:”在此处被删除和重新添加，# 可能需要在最后一个路径后多加一个冒号

回声 $PATH | sed '=/usr/bin:=/usr/local/bin:='

此解决方案替换了整个路径元素，因此如果新元素相似，则可能是多余的。

如果新的 PATH'-s 不是动态的，但总是在某个常量集中，您可以将*它们*保存在变量中并根据需要分配：

路径=$TEMP_PATH_1；# 命令 ... ; \n 路径=$TEMP_PATH_2; # 命令等... ;

可能不是你想的那样。bash/unix 上的一些相关命令是：

pushd popd cd ls # 单列可能 l -1A；find grep which # 可以确认该文件是您认为它来自哪里；环境类型

..所有这些以及更多对 PATH 或一般目录都有影响*。*文本更改部分可以通过多种方式完成！

选择的任何解决方案都包含 4 个部分：

1）按原样获取路径 2）解码路径以找到需要更改的部分 3）确定需要哪些更改/集成这些更改 4）验证/最终集成/设置变量

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-09T16:19:45.343

根据[dj_segfault 的回答](https://stackoverflow.com/a/294156/2355587)，我在脚本中执行此操作，这些脚本附加/前置可能多次执行的环境变量：

```
ld_library_path=${ORACLE_HOME}/lib
LD_LIBRARY_PATH=${LD_LIBRARY_PATH//${ld_library_path}?(:)/}
export LD_LIBRARY_PATH=${ld_library_path}${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}} 
```

考虑到 shell 参数扩展的类似文件名扩展的模式匹配和模式列表支持，使用相同的技术来删除、替换或操作 PATH 中的条目是微不足道的。

# xml - Visual Studio 的 wsdl.exe 在我的架构中找不到某些信息。不确定这是否是错误

> ID：273913
> 
> 赞同：0
> 
> 时间：2008-11-07T22:53:45.693
> 
> 标签：xml, visual-studio, wsdl, schema, wsdl.exe

当我使用 wsdl.exe 从我的 wsdl 创建客户端时，它可以完成，但在文件中插入以下注释：

**// CODEGEN：参数“VerificationData”需要使用参数模式无法捕获的附加架构信息。具体属性是“System.Xml.Serialization.XmlArrayItemAttribute”。**

我无法弄清楚 wsdl 中的其他信息应该放在哪里，其相关部分如下所示：

```
<xsd:complexType name="VerificationDataType">
  <xsd:sequence>
    <xsd:element name="Item" type="VerificationItemType" minOccurs="0" maxOccurs="unbounded" />
  </xsd:sequence>
</xsd:complexType>
<xsd:complexType name="VerificationItemType">
  <xsd:simpleContent>
    <xsd:extension base="xsd:string">
        <xsd:attribute name="type" type="xsd:string" use="required" />
    </xsd:extension>
  </xsd:simpleContent>
</xsd:complexType> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-09T05:30:16.017

我无法从您提供的 WSDL 片段中看出，但我想知道您是否需要 Item 元素中使用的类型的命名空间，例如，类似

```
<xsd:element name="Item" type="ns:VerificationItemType" minOccurs="0" maxOccurs="unbounded" /> 
```

其中 ns 是命名空间别名。

当我尝试使用 VisualStudio 2008 附带的 wsdl.exe 重现您的问题时，我收到错误消息

```
 - The datatype 'http://schemas.xmlsoap.org/wsdl/:VerificationItemType' is missing. 
```

添加命名空间会消除该消息。

# mysql - 从 mysql 查询中获取不同的记录

> ID：273916
> 
> 赞同：3
> 
> 时间：2008-11-07T22:54:17.767
> 
> 标签：mysql, join, distinct

在我的应用程序中，有发布者和类别。一个发布者可以属于多个类别。当我进行 mysql 事务时，它将为其所属的每个类别返回相同的发布者记录。这是查询：

```
选择
    grdirect_publisher.name，
    grdirect_publisher.short_description，
    grdirect_publisher.thumb_image，
    grdirect_publisher.url，
    grdirect_category.name 作为猫名
从
    grdirect_publisher
加入
    grdirect_publisher_categories
    在
    grdirect_publisher.id = grdirect_publisher_categories.publisher_id
加入
    grdirect_category
    在
    grdirect_publisher_categories.category_id = grdirect_category.id
```

返回：

```
名称 short_description thumb_image url 猫名
-------------------------------------------------- ----------
Foo Lorem Ipsum... images/pic.png d.com 视频游戏
Foo Lorem Ipsum... images/pic.png d.com 音乐
Bar Blah Blah... images/tic.png e.com 音乐

```

本质上，Foo 应该只在结果中出现一次。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T23:11:50.163

您可以使用`DISTINCT`，但如果结果集中的*任何*列具有不同的值，则会强制复制该行。如果要将列表减少到每行`name`，则必须使用`DISTINCT`并且必须省略`catname`列：

```
SELECT DISTINCT
    grdirect_publisher.name,
    grdirect_publisher.short_description,
    grdirect_publisher.thumb_image,
    grdirect_publisher.url
FROM
. . . 
```

另一个不使用的解决方案`DISTINCT`是 MySQL 的聚合函数`GROUP_CONCAT()`，它允许您在一个组中获取多个值并生成一个逗号分隔的列表：

```
SELECT
    grdirect_publisher.name,
    grdirect_publisher.short_description,
    grdirect_publisher.thumb_image,
    grdirect_publisher.url,
    GROUP_CONCAT(grdirect_category.name) AS catname
. . .
GROUP BY grdirect_publisher.id; 
```

因此，您必须决定您希望结果集如何获得正确的解决方案。

# java - 使用 JDBC 时，Oracle 的 REF CURSOR 在 MySQL 中的等价物是什么？

> ID：273929
> 
> 赞同：3
> 
> 时间：2008-11-07T22:58:44.323
> 
> 标签：java, mysql, oracle, jdbc, ref-cursor

**在 Oracle 中，我可以声明一个引用游标...**

```
TYPE t_spool IS REF CURSOR RETURN spool%ROWTYPE; 
```

**...并使用它来传递游标作为返回值...**

```
FUNCTION end_spool
    RETURN t_spool
    AS
    v_spool t_spool;
    BEGIN
        COMMIT;
        OPEN v_spool FOR
            SELECT
                *
            FROM
                spool
            WHERE
                key = g_spool_key
            ORDER BY
                seq;
        RETURN v_spool;
    END end_spool; 
```

**...然后使用 JDBC 将其捕获为结果集...**

```
private Connection conn;
private CallableStatement stmt;
private OracleResultSet rset;
[...clip...]
stmt = conn.prepareCall("{ ? = call " + call + "}");
stmt.registerOutParameter(1, OracleTypes.CURSOR);
stmt.execute();
rset = (OracleResultSet)stmt.getObject(1); 
```

**MySQL中的等价物是什么？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T02:32:49.403

Mysql 有一个隐式游标，如果您发出选择，您可以神奇地从存储过程返回。

这是一个例子：

```
CREATE PROCEDURE `TEST`()
MODIFIES SQL DATA
BEGIN
  SELECT * FROM test_table;
END; 
```

在你的java代码中：

```
String query = "{CALL TEST()}";
CallableStatement cs = con.prepareCall(query,
    ResultSet.TYPE_SCROLL_INSENSITIVE,
    ResultSet.CONCUR_READ_ONLY);
ResultSet rs = cs.executeQuery(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-08T05:19:36.943

谷歌搜索 MySQL 中的游标，似乎您实际上不能从 Proc 或函数返回游标。此外，我在[MySQL JDBC 手册](http://dev.mysql.com/doc/refman/5.0/en/connector-j-reference-implementation-notes.html)中找到了以下内容：

“MySQL 不支持 SQL 游标，并且 JDBC 驱动程序不模拟它们，因此“setCursorName()”无效。”

总的来说，我相信 Oracle 在这里的实现会破坏 JDBC，并且不会在其他地方（MySQL、MSSQL 等）使用。您应该将结果作为选择语句返回并遍历 JDBC ResultSet，这是使用 JDBC 时的标准（和预期）实践。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-06-01T19:00:03.443

在过程中填写临时表，然后读取临时表... :)

# python - 如何在 Python 中的另一个类中创建一个类的实例

> ID：273937
> 
> 赞同：2
> 
> 时间：2008-11-07T23:03:53.363
> 
> 标签：python, oop, wxpython

我正在尝试学习 Python 和 WxPython。多年来，我一直是一名 SAS 程序员。这些面向对象编程的东西正在慢慢融合，但我对很多概念仍然很模糊。下面是一段代码。我正在尝试使用按钮单击来创建另一个类的实例。具体来说，我的主面板属于一类，当用户单击主面板上的一个菜单项时，我想实例化一个辅助面板。当辅助面板只是一个功能时，我完成了所有这些工作。我似乎无法让 ti 作为一个班级工作。

这是代码

```
import wx

class mainPanel(wx.Frame):
    def __init__(self, parent, id, title):
    wx.Frame.__init__(self, parent, id, 'directEDGAR Supplemental Tools', size=(450, 450))
    wx.Panel(self,-1)
    wx.StaticText(self,-1, "This is where I will describe\n the purpose of these tools",(100,10))

    menubar = wx.MenuBar()
    parser = wx.Menu()
    one =wx.MenuItem(parser,1,'&Extract Tables  with One Heading or Label')
    two =wx.MenuItem(parser,1,'&Extract Tables  with Two Headings or Labels')
    three =wx.MenuItem(parser,1,'&Extract Tables  with Three Headings or Labels')
    four =wx.MenuItem(parser,1,'&Extract Tables  with Four Headings or Labels')
    quit = wx.MenuItem(parser, 2, '&Quit\tCtrl+Q')
    parser.AppendItem(one)
    parser.AppendItem(two)
    parser.AppendItem(three)
    parser.AppendItem(four)
    parser.AppendItem(quit)
    menubar.Append(parser, '&Table Parsers')

    textRip = wx.Menu()
    section =wx.MenuItem(parser,1,'&Extract Text With Section Headings')
    textRip.AppendItem(section)
    menubar.Append(textRip, '&Text Rippers')

    dataHandling = wx.Menu()
    deHydrate =wx.MenuItem(dataHandling,1,'&Extract Data from Tables')
    dataHandling.AppendItem(deHydrate)
    menubar.Append(dataHandling, '&Data Extraction')        

    self.Bind(wx.EVT_MENU, self.OnQuit, id=2) 
```

# 这是我认为我很聪明的地方，通过单击按钮来创建实例

# 的子面板。

```
 self.Bind(wx.EVT_MENU, self.subPanel(None, -1, 'TEST'),id=1)

    self.SetMenuBar(menubar)

    self.Centre()
    self.Show(True)

   def OnQuit(self, event):
    self.Close()

class subPanel(wx.Frame):
    def __init__(self, parent, id, title):
    wx.Frame.__init__(self, parent, id, 'directEDGAR Supplemental Tools', size=(450, 450))
    wx.Panel(self,-1)
    wx.StaticText(self,-1, "This is where I will describe\n the purpose of these tools",(100,10))

    getDirectory = wx.Button(panel, -1, "Get Directory Path", pos=(20,350))
    getDirectory.SetDefault()

    getTerm1 = wx.Button(panel, -1, "Get Search Term", pos=(20,400))
    getTerm1.SetDefault()

    #getDirectory.Bind(wx.EVT_BUTTON, getDirectory.OnClick, getDirectory.button)

    self.Centre()
    self.Show(True)

app = wx.App()
mainPanel(None, -1, '')
app.MainLoop() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T23:34:25.157

我不知道 wxWidgets，但根据我对 Python 的了解，我猜您需要更改：

```
self.Bind(wx.EVT_MENU, self.subPanel(None, -1, 'TEST'),id=1) 
```

到：

```
self.Bind(wx.EVT_MENU, subPanel(None, -1, 'TEST'),id=1) 
```

“subPanel”是一个全局定义的类，而不是“self”的成员（它是一个 mainPanel）。

编辑：啊，“绑定”似乎将一个动作绑定到一个函数，所以你需要给它一个创建另一个类的函数。试试下面的。它仍然不起作用，但至少它现在在子面板创建过程中崩溃了。

```
self.Bind(wx.EVT_MENU, lambda(x): subPanel(None, -1, 'TEST'),id=1) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T01:10:57.273

您应该处理按钮单击事件，并在按钮处理程序中创建面板（就像您已经使用 OnQuit 方法一样）。

我认为以下代码基本上可以满足您的要求-单击按钮/选择菜单项时会创建一个新框架。

```
import wx

class MyFrame(wx.Frame):
    def __init__(self, parent, title="My Frame", num=1):

        self.num = num
        wx.Frame.__init__(self, parent, -1, title)
        panel = wx.Panel(self)

        button = wx.Button(panel, -1, "New Panel")
        button.SetPosition((15, 15))
        self.Bind(wx.EVT_BUTTON, self.OnNewPanel, button)
        self.Bind(wx.EVT_CLOSE, self.OnCloseWindow)

        # Now create a menu
        menubar = wx.MenuBar()
        self.SetMenuBar(menubar)

        # Panel menu
        panel_menu = wx.Menu()

        # The menu item
        menu_newpanel = wx.MenuItem(panel_menu,
                                    wx.NewId(),
                                    "&New Panel",
                                    "Creates a new panel",
                                    wx.ITEM_NORMAL)
        panel_menu.AppendItem(menu_newpanel)

        menubar.Append(panel_menu, "&Panels")
        # Bind the menu event
        self.Bind(wx.EVT_MENU, self.OnNewPanel, menu_newpanel)

    def OnNewPanel(self, event):
        panel = MyFrame(self, "Panel %s" % self.num, self.num+1)
        panel.Show()

    def OnCloseWindow(self, event):
        self.Destroy()

def main():
    application = wx.PySimpleApp()
    frame = MyFrame(None)
    frame.Show()
    application.MainLoop()

if __name__ == "__main__":
    main() 
```

* * *

**编辑**：添加了从菜单中执行此操作的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T01:19:19.813

您的绑定表达式中需要一个事件处理程序

```
self.bind(wx.EVT_MENU, subPanel(None, -1, 'TEST'),id=1) 
```

需要改为：

```
self.bind(wx.EVT_MENU, <event handler>, <id of menu item>) 
```

您的事件处理程序响应事件并实例化子面板：

```
def OnMenuItem(self, evt): #don't forget the evt
    sp = SubPanel(self, wx.ID_ANY, 'TEST')
    #I assume you will add it to a sizer
    #if you aren't... you should
    test_sizer.Add(sp, 1, wx.EXPAND)
    #force the frame to refresh the sizers:
    self.Layout() 
```

或者，您可以在框架中实例化子面板`__init__`并调用`subpanel.Hide()`after 实例化，然后调用 menuitem 事件处理程序并在面板上调用 show`subpanel.Show()`

编辑：这里有一些代码可以满足我的要求：

```
#!usr/bin/env python

import wx

class TestFrame(wx.Frame):
    def __init__(self, parent, *args, **kwargs):
        wx.Frame.__init__(self, parent, *args, **kwargs)
        framesizer = wx.BoxSizer(wx.VERTICAL)
        mainpanel = MainPanel(self, wx.ID_ANY)
        self.subpanel = SubPanel(self, wx.ID_ANY)
        self.subpanel.Hide()
        framesizer.Add(mainpanel, 1, wx.EXPAND)
        framesizer.Add(self.subpanel, 1, wx.EXPAND)
        self.SetSizerAndFit(framesizer)

class MainPanel(wx.Panel):
    def __init__(self, parent, *args, **kwargs):
        wx.Panel.__init__(self, parent, *args, **kwargs)
        panelsizer = wx.BoxSizer(wx.VERTICAL)
        but = wx.Button(self, wx.ID_ANY, "Add")
        self.Bind(wx.EVT_BUTTON, self.OnAdd, but)
        self.panel_shown = False
        panelsizer.Add(but, 0)
        self.SetSizer(panelsizer)

    def OnAdd(self, evt):
        if not self.panel_shown:
            self.GetParent().subpanel.Show()
            self.GetParent().Fit()
            self.GetParent().Layout()
            self.panel_shown = True
        else:
            self.GetParent().subpanel.Hide()
            self.GetParent().Fit()
            self.GetParent().Layout()
            self.panel_shown = False

class SubPanel(wx.Panel):
    def __init__(self, parent, *args, **kwargs):
        wx.Panel.__init__(self, parent, *args, **kwargs)
        spsizer = wx.BoxSizer(wx.VERTICAL)
        text = wx.StaticText(self, wx.ID_ANY, label='I am a subpanel')
        spsizer.Add(text, 1, wx.EXPAND)
        self.SetSizer(spsizer)

if __name__ == '__main__':
    app = wx.App()
    frame = TestFrame(None, wx.ID_ANY, "Test Frame")
    frame.Show()
    app.MainLoop() 
```

# multithreading - 如何从 Delphi 的主线程向 TThread 发送消息？

> ID：273938
> 
> 赞同：9
> 
> 时间：2008-11-07T23:04:21.630
> 
> 标签：multithreading, delphi

我想向线程发送消息并在线程中处理它。我怎么能在德尔福做到这一点？我想`PostMessage`这是要走的路，但到目前为止我看到的例子是在描述另一种方式，即从线程到主线程。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-07T23:08:37.660

我什至不会尝试解释或编写任何代码。看看这个教程。它有点旧，但非常好恕我直言。 [多线程——德尔福之道](http://web.archive.org/web/20120423060358/http://www.eonclash.com/Tutorials/Multithreading/MartinHarvey1.1/ToC.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-08T01:10:57.303

你可以在你的线程中有一个消息循环（可能带有一个隐藏的通知窗口）并向它发送一条 Windows 消息，或者你可以使用更原生（更少的 GUI）的方式来做这件事，例如受保护的队列临界区与线程等待的手动重置事件和发送线程信号相结合。

更通用的解决方案是生产者-消费者队列，在经典实现中使用一对信号量来跟踪消费者和生产者，并使用第三个信号量来互斥地访问队列；但是，网络上提供了更优化的生产者-消费者队列。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-08T05:34:04.370

为什么你需要这样做？我不得不在辅助线程中创建消息循环仅出于一个原因，那是因为该线程使用了 COM 对象。对*OleInitialize()*和*OleUnitialize()*的调用表明您**需要**标准的*GetMessage()*循环。在这种情况下，还需要使用*PostThreadMessage()*将消息发布到该线程，因为正常的阻塞同步调用会干扰消息循环。否则，就不要这样做。

如果您在 Delphi 2007 或 2009，请务必查看[Primož Gabrijelčič](http://otl.17slon.com/)的 OmniThreadLibrary，它应该会让您的工作更轻松。

# c# - 使用 lambda 表达式获取属性名称和类型

> ID：273941
> 
> 赞同：39
> 
> 时间：2008-11-07T23:05:33.563
> 
> 标签：c#, reflection, lambda

我正在尝试编写一个函数，该函数将使用如下语法提取属性的名称和类型：

```
private class SomeClass
{
    Public string Col1;
}

PropertyMapper<Somewhere> propertyMapper = new PropertyMapper<Somewhere>();
propertyMapper.MapProperty(x => x.Col1) 
```

有没有什么方法可以将属性传递给函数，而无需对该语法进行任何重大更改？

我想获取属性名称和属性类型。

所以在下面的例子中我想检索

`Name = "Col1"`和`Type = "System.String"`

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-07T23:20:12.487

这里有足够的使用[表达式](http://msdn.microsoft.com/en-us/library/system.linq.expressions.aspx)获取属性或字段名称的示例来帮助您入门：

```
public static MemberInfo GetMemberInfo<T, U>(Expression<Func<T, U>> expression)
{
    var member = expression.Body as MemberExpression;
    if (member != null)
        return member.Member;

    throw new ArgumentException("Expression is not a member access", "expression");
} 
```

调用代码如下所示：

```
public class Program
{
    public string Name
    {
        get { return "My Program"; }
    }

    static void Main()
    {
        MemberInfo member = ReflectionUtility.GetMemberInfo((Program p) => p.Name);
        Console.WriteLine(member.Name);
    }
} 
```

不过请注意：简单的声明`(Program p) => p.Name`实际上涉及相当多的工作（并且可能需要大量的时间）。考虑缓存结果而不是频繁调用方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-06-22T11:32:11.923

这可以在 C# 6 中轻松完成。要获取属性名称，请使用 nameof 运算符。

```
nameof(User.UserId) 
```

并获取属性类型使用 typeof 运算符。

```
typeof(User.UserId) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-11-05T20:14:35.617

我发现这非常有用。

```
public class PropertyMapper<T>
{
    public virtual PropertyInfo PropertyInfo<U>(Expression<Func<T, U>> expression)
    {
        var member = expression.Body as MemberExpression;
        if (member != null && member.Member is PropertyInfo)
            return member.Member as PropertyInfo;

        throw new ArgumentException("Expression is not a Property", "expression");
    }

    public virtual string PropertyName<U>(Expression<Func<T, U>> expression)
    {
        return PropertyInfo<U>(expression).Name;
    }

    public virtual Type PropertyType<U>(Expression<Func<T, U>> expression)
    {
        return PropertyInfo<U>(expression).PropertyType;
    }
} 
```

我做了这个小班来遵循最初的要求。如果您需要属性的名称，您可以像这样使用它：

```
PropertyMapper<SomeClass> propertyMapper = new PropertyMapper<SomeClass>();
string name = propertyMapper.PropertyName(x => x.Col1); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-04-07T21:08:34.680

我只是想我会把它放在这里以建立以前的方法。

```
public static class Helpers
{
    public static string PropertyName<T>(Expression<Func<T>> expression)
    {
        var member = expression.Body as MemberExpression;
        if (member != null && member.Member is PropertyInfo)
            return member.Member.Name;

        throw new ArgumentException("Expression is not a Property", "expression");
    }
} 
```

然后，您可以按以下方式调用它：

```
Helpers.PropertyName(() => TestModel.TestProperty); 
```

我还应该指出，在 VS 2015 和 C# 6.0 中，您可以简单地使用 nameof。

[https://msdn.microsoft.com/en-us/library/dn986596.aspx](https://msdn.microsoft.com/en-us/library/dn986596.aspx)

# java - 为什么我们需要装饰器设计模式中的装饰器？

> ID：273943
> 
> 赞同：14
> 
> 时间：2008-11-07T23:06:42.920
> 
> 标签：java, design-patterns, decorator

假设我有一个名为 的类`A`，并且我想使用装饰器设计模式。如果我错了，请纠正我，但要让它工作，我们需要创建一个装饰器类，比如说`ADecorator`，它将保存对`A`实例的引用，并且所有其他装饰器将扩展它以添加功能。

我不明白为什么我们必须创建一个装饰器类，而不是使用一个`A`实例？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-08T02:21:46.350

装饰器模式用于动态地（即在运行时）向对象添加功能。通常，当您编写类时，对象的功能会固定。但重要的一点是，对象的功能以对对象客户端透明的方式扩展，因为它实现了与原始对象将责任委托给装饰对象相同的接口。

装饰器模式适用于对象可能具有许多可选功能的场景。如果没有装饰器模式，您将不得不为每个对象选项配置创建不同的类。一个非常有用的例子来自 O'Reilly 的***Head First Design Patterns***一书。它使用了一个听起来像星巴克的咖啡店示例。

因此，您可以使用成本等方法获得基本咖啡。

```
public double cost(){
     return 3.45;
} 
```

然后客户可以添加价格为 0.35 的奶油，因此您现在使用 cost 方法创建一个 CoffeeCream 类：

```
public double cost(){
    return 3.80;
} 
```

然后客户可能想要价格为 0.5 的摩卡，他们可能想要加奶油的摩卡或不加奶油的摩卡。因此，您创建类 CoffeeMochaCream 和 CoffeeMocha。然后一个客户想要双份奶油，所以你创建了一个类 CoffeeCreamCream……等等。你最终得到的是类爆炸。请原谅使用的糟糕示例。有点晚了，我知道这是微不足道的，但它确实表达了这一点。

相反，您可以使用抽象成本方法创建 Item 抽象类：

```
public abstract class Item{
    public abstract double cost();
} 
```

您可以创建一个扩展 Item 的具体 Coffee 类：

```
public class Coffee extends Item{
    public double cost(){
       return 3.45;
    }
} 
```

然后创建一个扩展相同接口并包含一个项目的 CoffeeDecorator。

```
public abstract class CoffeeDecorator extends Item{
     private Item item;
     ...
} 
```

然后你可以为每个选项创建具体的装饰器：

```
public class Mocha extends CoffeeDecorator{

   public double cost(){
     return item.cost() + 0.5;
   }

} 
```

请注意，只要它是一个项目，装饰器就不会关心它包装的是什么类型的对象？它使用 item 对象的 cost() 并简单地添加自己的成本。

```
public class Cream extends CoffeeDecorator{

   public double cost(){
     return item.cost() + 0.35;
   }

} 
```

现在可以使用这几个类进行大量配置：例如

```
 Item drink = new Cream(new Mocha(new Coffee))); //Mocha with cream 
```

或者

```
 Item drink = new Cream(new Mocha(new Cream(new Coffee))));//Mocha with double cream 
```

等等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-08T05:09:06.823

顺便说一句，如果您刚刚开始学习模式，那么 Head First Design Patterns 这本书*非常棒*。它确实使概念易于理解，并确保以易于理解的方式对比和比较相似的模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T00:04:10.450

在某些语言（如 Ruby 或 JavaScript）中，您可以向 A 实例添加新功能。我注意到您的问题被标记为 Java，所以我假设您在问为什么不能在 Java 中执行此操作。原因是Java是静态类型的。A 实例只能具有类 A 定义或继承的方法。因此，如果您想在运行时为 A 实例提供 A 未定义的方法，则必须在不同的类中定义此新方法。

# jakarta-ee - J2EE 错误处理 - 应用程序和用户

> ID：273944
> 
> 赞同：0
> 
> 时间：2008-11-07T23:07:20.687
> 
> 标签：jakarta-ee, error-handling, user-experience

我有一个关于在 J2EE 应用程序中处理错误的问题。我们当前的应用程序被许多用户使用，因此我们得到了很多支持票。这些票证中的大多数与用户相关，但 5-10% 是系统相关的异常、未处理的错误等。

我们在代码中有基本的异常处理检查（需要工作），但根据我的经验，向用户显示一般消息并不能帮助加快故障排除过程。

我正在寻找的是关于良好错误处理设计模式的建议，以便让我们考虑一个场景：

1.  代码有错误
2.  错误已处理
3.  向用户显示带有特定错误代码的非技术错误消息。
4.  非技术支持团队可以使用此错误代码来查看应用程序中发生这种情况的区域（页面、部分、..）以及用户可能一直在做什么（开发团队在客户支持参考指南中预先填充的信息）。
5.  技术支持团队可以在类/JSP 等和触发该异常的代码行中使用代码归零。
6.  我们使用一个日志模块，其中*大多数*（不是全部）Tomcat 标准输出错误都由用户会话记录……到用户将收到的错误代码中，如果它也存在，我们可以包含日志 ID，以便技术团队可以查看也。

基本上，我感兴趣的是减少支持分析-解释-研究周期，让每个部门都能触手可及地访问信息，这可以让他们更快地开始各自的工作：

1.  客户支持可以对此错误代码给出预设解释，或者提供用户可以遵循的替代步骤。
2.  技术团队可以开始对代码行或触发该行的用户正在做什么进行故障排除。

本质上，每个错误代码都会触发每个部门所需的后续步骤，实际上减少了问题的研究阶段并进入解决阶段。

我不确定以上是否是个好主意。对于这种需要的良好“设计模式”，任何建议都将不胜感激。或者如果它甚至是一个很好的途径。

提前致谢。

SP

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T23:36:08.070

听起来您需要花一些时间来解决一些代码分类的支持问题。我的经验是，您几乎总是可以创建导致 50% 以上的支持问题的项目的“前 10 名列表”。完成前 10 个后，重新检查通话记录。数据势在必行。

一个致力于解决支持问题并将它们淘汰出局的程序应该能够相当快地筛选出代码问题。之后，您将面临必须通过培训、经验或通常一些长期工作流程/可用性重构来处理的人/可用性问题。

如果您陷入了您认为需要制定错误代码/条件列表的错误中，那么听起来您的产品还需要再稳定 6 个月。您可能*没有*开发操作系统，并且对于 99% 的开发 IBMesque 错误代码黑皮书的项目来说，这不是要效仿的模型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-08T03:59:22.330

使用 log4j 将所有错误和异常记录到通过电子邮件发送给您信息的记录器。不用担心用户消息；他们只需要知道有一个错误并且它已被记录。

# python - 如何使用 PIL 调整图像大小并保持其纵横比？

> ID：273946
> 
> 赞同：555
> 
> 时间：2008-11-07T23:08:04.197
> 
> 标签：python, image, python-imaging-library, thumbnails

有没有明显的方法可以做到这一点，我错过了？我只是想制作缩略图。

* * *

## 回答 #1

> 赞同：570
> 
> 时间：2008-11-07T23:15:37.973

定义最大尺寸。然后，通过计算调整大小比率`min(maxwidth/width, maxheight/height)`。

合适的尺寸是`oldsize*ratio`。

当然还有一个库方法可以做到这一点：方法`Image.thumbnail`。
以下是[PIL 文档](https://pillow.readthedocs.io/en/stable/reference/Image.html?highlight=thumbnail#PIL.Image.Image.thumbnail)中的（已编辑）示例。

```
import os, sys
import Image

size = 128, 128

for infile in sys.argv[1:]:
    outfile = os.path.splitext(infile)[0] + ".thumbnail"
    if infile != outfile:
        try:
            im = Image.open(infile)
            im.thumbnail(size, Image.ANTIALIAS)
            im.save(outfile, "JPEG")
        except IOError:
            print "cannot create thumbnail for '%s'" % infile 
```

* * *

## 回答 #2

> 赞同：345
> 
> 时间：2009-01-16T19:12:07.400

该脚本将使用 PIL (Python Imaging Library) 将图像 (somepic.jpg) 的大小调整为 300 像素的宽度和与新宽度成比例的高度。它通过确定 300 像素占原始宽度 (img.size[0]) 的百分比，然后将原始高度 (img.size[1]) 乘以该百分比来做到这一点。将“basewidth”更改为任何其他数字以更改图像的默认宽度。

```
from PIL import Image

basewidth = 300
img = Image.open('somepic.jpg')
wpercent = (basewidth/float(img.size[0]))
hsize = int((float(img.size[1])*float(wpercent)))
img = img.resize((basewidth,hsize), Image.ANTIALIAS)
img.save('somepic.jpg') 
```

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2009-06-02T16:03:07.700

我还推荐使用 PIL 的缩略图方法，因为它消除了你所有的比例问题。

不过，一个重要提示是：替换

```
im.thumbnail(size) 
```

和

```
im.thumbnail(size,Image.ANTIALIAS) 
```

默认情况下，PIL 使用 Image.NEAREST 过滤器来调整大小，这会产生良好的性能，但质量很差。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2015-05-14T00:37:06.567

基于@tomvon，我完成了以下使用（选择你的案例）：

a）**调整高度**（*我知道新的宽度，所以我需要新的高度*）

```
new_width  = 680
new_height = new_width * height / width 
```

b）**调整宽度**（*我知道新的高度，所以我需要新的宽度*）

```
new_height = 680
new_width  = new_height * width / height 
```

然后只是：

```
img = img.resize((new_width, new_height), Image.ANTIALIAS) 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-12-13T03:43:00.460

如果您试图保持相同的纵横比，那么您不会将大小调整为原始大小的某个百分比吗？

例如，原始大小的一半

```
half = 0.5
out = im.resize( [int(half * s) for s in im.size] ) 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2016-03-16T13:17:46.763

```
from PIL import Image

img = Image.open('/your image path/image.jpg') # image extension *.png,*.jpg
new_width  = 200
new_height = 300
img = img.resize((new_width, new_height), Image.ANTIALIAS)
img.save('output image name.png') # format may what you want *.png, *jpg, *.gif 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-09-27T10:02:19.773

```
from PIL import Image
from resizeimage import resizeimage

def resize_file(in_file, out_file, size):
    with open(in_file) as fd:
        image = resizeimage.resize_thumbnail(Image.open(fd), size)
    image.save(out_file)
    image.close()

resize_file('foo.tif', 'foo_small.jpg', (256, 256)) 
```

我使用这个库：

```
pip install python-resize-image 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2019-01-14T06:05:49.030

如果您不想/不需要使用 Pillow 打开图像，请使用以下命令：

```
from PIL import Image

new_img_arr = numpy.array(Image.fromarray(img_arr).resize((new_width, new_height), Image.ANTIALIAS)) 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-05-15T10:04:53.283

只是用更现代的包装器更新这个问题 这个库包装了 Pillow（PIL 的一个分支） [https://pypi.org/project/python-resize-image/](https://pypi.org/project/python-resize-image/)

允许你做这样的事情： -

```
from PIL import Image
from resizeimage import resizeimage

fd_img = open('test-image.jpeg', 'r')
img = Image.open(fd_img)
img = resizeimage.resize_width(img, 200)
img.save('test-image-width.jpeg', img.format)
fd_img.close() 
```

在上面的链接中堆放更多示例。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2020-05-02T22:18:07.547

我还将添加一个保持纵横比固定的调整大小版本。在这种情况下，它将根据初始纵横比*asp_rat*调整高度以匹配新图像的宽度，它是**float** (!)。但是，要将宽度调整为高度，您只需在**else**循环中注释一行并取消注释另一行。你会看到，在哪里。

您不需要分号 (;)，我保留它们只是为了提醒自己我经常使用的语言的语法。

```
from PIL import Image

img_path = "filename.png";
img = Image.open(img_path);     # puts our image to the buffer of the PIL.Image object

width, height = img.size;
asp_rat = width/height;

# Enter new width (in pixels)
new_width = 50;

# Enter new height (in pixels)
new_height = 54;

new_rat = new_width/new_height;

if (new_rat == asp_rat):
    img = img.resize((new_width, new_height), Image.ANTIALIAS); 

# adjusts the height to match the width
# NOTE: if you want to adjust the width to the height, instead -> 
# uncomment the second line (new_width) and comment the first one (new_height)
else:
    new_height = round(new_width / asp_rat);
    #new_width = round(new_height * asp_rat);
    img = img.resize((new_width, new_height), Image.ANTIALIAS);

# usage: resize((x,y), resample)
# resample filter -> PIL.Image.BILINEAR, PIL.Image.NEAREST (default), PIL.Image.BICUBIC, etc..
# https://pillow.readthedocs.io/en/3.1.x/reference/Image.html#PIL.Image.Image.resize

# Enter the name under which you would like to save the new image
img.save("outputname.png"); 
```

而且，它完成了。我试图尽可能多地记录它，所以很清楚。

我希望它可能对那里的人有所帮助！

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2019-01-22T18:02:44.320

我试图为幻灯片视频调整一些图像的大小，因此，我不仅想要一个最大尺寸，还想要一个最大宽度*和*一个最大高度（视频帧的大小）。
而且人像视频总是有可能的……
这种`Image.thumbnail`方法很有前途，但我无法将其放大为较小的图像。

因此，在我在这里（或在其他一些地方）找不到明显的方法之后，我编写了这个函数并将其放在这里以供将来使用：

```
from PIL import Image

def get_resized_img(img_path, video_size):
    img = Image.open(img_path)
    width, height = video_size  # these are the MAX dimensions
    video_ratio = width / height
    img_ratio = img.size[0] / img.size[1]
    if video_ratio >= 1:  # the video is wide
        if img_ratio <= video_ratio:  # image is not wide enough
            width_new = int(height * img_ratio)
            size_new = width_new, height
        else:  # image is wider than video
            height_new = int(width / img_ratio)
            size_new = width, height_new
    else:  # the video is tall
        if img_ratio >= video_ratio:  # image is not tall enough
            height_new = int(width / img_ratio)
            size_new = width, height_new
        else:  # image is taller than video
            width_new = int(height * img_ratio)
            size_new = width_new, height
    return img.resize(size_new, resample=Image.LANCZOS) 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-09-18T10:17:54.160

已通过“tomvon”更新了上面的答案

```
from PIL import Image

img = Image.open(image_path)

width, height = img.size[:2]

if height > width:
    baseheight = 64
    hpercent = (baseheight/float(img.size[1]))
    wsize = int((float(img.size[0])*float(hpercent)))
    img = img.resize((wsize, baseheight), Image.ANTIALIAS)
    img.save('resized.jpg')
else:
    basewidth = 64
    wpercent = (basewidth/float(img.size[0]))
    hsize = int((float(img.size[1])*float(wpercent)))
    img = img.resize((basewidth,hsize), Image.ANTIALIAS)
    img.save('resized.jpg') 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-02-18T04:40:04.923

打开你的图像文件

```
from PIL import Image
im = Image.open("image.png") 
```

[使用 PIL Image.resize(size, resample=0) 方法](https://pillow.readthedocs.io/en/3.1.x/reference/Image.html#PIL.Image.Image.resize)，您可以将图像的 (width, height) 替换为大小 2 元组。

这将以原始大小显示您的图像：

```
display(im.resize((int(im.size[0]),int(im.size[1])), 0) ) 
```

这将以 1/2 大小显示您的图像：

```
display(im.resize((int(im.size[0]/2),int(im.size[1]/2)), 0) ) 
```

这将以 1/3 大小显示您的图像：

```
display(im.resize((int(im.size[0]/3),int(im.size[1]/3)), 0) ) 
```

这将以 1/4 大小显示您的图像：

```
display(im.resize((int(im.size[0]/4),int(im.size[1]/4)), 0) ) 
```

等等等等

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2021-01-26T15:40:58.000

如果您的调整大小限制仅在一个维度（宽度或高度）上，您可以将 PIL[`Image.thumbnail`](https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.Image.thumbnail)与。[`sys.maxsize`](https://stackoverflow.com/a/9860611/738017)

例如，如果您想调整图像大小使其高度不超过 100 像素，同时保持纵横比，您可以执行以下操作：

```
import sys
from PIL import Image

image.thumbnail([sys.maxsize, 100], Image.ANTIALIAS) 
```

请记住，这`Image.thumbnail`将在适当位置调整图像大小，这与`Image.resize`返回调整大小的图像而不更改原始图像不同。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-05-31T06:40:10.380

一种保持受限比率并传递最大宽度/高度的简单方法。不是最漂亮的，但可以完成工作并且很容易理解：

```
def resize(img_path, max_px_size, output_folder):
    with Image.open(img_path) as img:
        width_0, height_0 = img.size
        out_f_name = os.path.split(img_path)[-1]
        out_f_path = os.path.join(output_folder, out_f_name)

        if max((width_0, height_0)) <= max_px_size:
            print('writing {} to disk (no change from original)'.format(out_f_path))
            img.save(out_f_path)
            return

        if width_0 > height_0:
            wpercent = max_px_size / float(width_0)
            hsize = int(float(height_0) * float(wpercent))
            img = img.resize((max_px_size, hsize), Image.ANTIALIAS)
            print('writing {} to disk'.format(out_f_path))
            img.save(out_f_path)
            return

        if width_0 < height_0:
            hpercent = max_px_size / float(height_0)
            wsize = int(float(width_0) * float(hpercent))
            img = img.resize((max_px_size, wsize), Image.ANTIALIAS)
            print('writing {} to disk'.format(out_f_path))
            img.save(out_f_path)
            return 
```

这是一个使用此函数运行批量图像大小调整的[python 脚本。](https://gist.github.com/agalea91/12149be6d4f64ba61c7b1d222fce3174)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2013-05-22T10:48:36.163

我丑陋的例子。

函数获取文件，如：“pic[0-9a-z].[extension]”，将它们调整为 120x120，将部分移动到中心并保存到“ico[0-9a-z].[extension]”，适用于纵向和风景：

```
def imageResize(filepath):
    from PIL import Image
    file_dir=os.path.split(filepath)
    img = Image.open(filepath)

    if img.size[0] > img.size[1]:
        aspect = img.size[1]/120
        new_size = (img.size[0]/aspect, 120)
    else:
        aspect = img.size[0]/120
        new_size = (120, img.size[1]/aspect)
    img.resize(new_size).save(file_dir[0]+'/ico'+file_dir[1][3:])
    img = Image.open(file_dir[0]+'/ico'+file_dir[1][3:])

    if img.size[0] > img.size[1]:
        new_img = img.crop( (
            (((img.size[0])-120)/2),
            0,
            120+(((img.size[0])-120)/2),
            120
        ) )
    else:
        new_img = img.crop( (
            0,
            (((img.size[1])-120)/2),
            120,
            120+(((img.size[1])-120)/2)
        ) )

    new_img.save(file_dir[0]+'/ico'+file_dir[1][3:]) 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2019-04-08T19:20:22.873

我以这种方式调整了图像的大小，并且效果很好

```
from io import BytesIO
from django.core.files.uploadedfile import InMemoryUploadedFile
import os, sys
from PIL import Image

def imageResize(image):
    outputIoStream = BytesIO()
    imageTemproaryResized = imageTemproary.resize( (1920,1080), Image.ANTIALIAS) 
    imageTemproaryResized.save(outputIoStream , format='PNG', quality='10') 
    outputIoStream.seek(0)
    uploadedImage = InMemoryUploadedFile(outputIoStream,'ImageField', "%s.jpg" % image.name.split('.')[0], 'image/jpeg', sys.getsizeof(outputIoStream), None)

    ## For upload local folder
    fs = FileSystemStorage()
    filename = fs.save(uploadedImage.name, uploadedImage) 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2021-11-16T13:04:26.640

```
# Importing Image class from PIL module
from PIL import Image

# Opens a image in RGB mode
im = Image.open(r"C:\Users\System-Pc\Desktop\ybear.jpg")

# Size of the image in pixels (size of original image)
# (This is not mandatory)
width, height = im.size

# Setting the points for cropped image
left = 4
top = height / 5
right = 154
bottom = 3 * height / 5

# Cropped image of above dimension
# (It will not change original image)
im1 = im.crop((left, top, right, bottom))
newsize = (300, 300)
im1 = im1.resize(newsize)
# Shows the image in image viewer
im1.show() 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-11-06T18:18:42.753

要使新图像的宽度和高度分别为原始图像的一半，请使用以下代码：

```
 from PIL import Image
  im = Image.open("image.jpg")
  resized_im = im.resize((round(im.size[0]*0.5), round(im.size[1]*0.5)))

  #Save the cropped image
  resized_im.save('resizedimage.jpg') 
```

用固定宽度和比率调整大小：

```
from PIL import Image
new_width = 300
im = Image.open("img/7.jpeg")
concat = int(new_width/float(im.size[0]))
size = int((float(im.size[1])*float(concat)))
resized_im = im.resize((new_width,size), Image.ANTIALIAS)
#Save the cropped image
resized_im.save('resizedimage.jpg') 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-11-04T13:19:20.413

以下脚本创建了所有 JPEG 图像的精美缩略图，并保留了最大分辨率为 128x128 的纵横比。

```
from PIL import Image
img = Image.open("D:\\Pictures\\John.jpg")
img.thumbnail((680,680))
img.save("D:\\Pictures\\John_resize.jpg") 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-09-18T07:32:46.927

对我有用的最简单的方法

```
image = image.resize((image.width*2, image.height*2), Image.ANTIALIAS) 
```

例子

```
from PIL import Image, ImageGrab
image = ImageGrab.grab(bbox=(0,0,400,600)) #take screenshot
image = image.resize((image.width*2, image.height*2), Image.ANTIALIAS)
image.save('Screen.png') 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-15T07:00:10.450

```
######get resize coordinate after resize the image using this function#####
def scale_img_pixel(points,original_dim,resize_dim):
        multi_list = [points]
        new_point_list = []
        multi_list_point = []
        for point in multi_list:
            multi_list_point.append([point[0],point[1]])
            multi_list_point.append([point[2],point[3]])
        for lsingle_point in multi_list_point:
            x1 = int((lsingle_point[0] * (resize_dim[0] / original_dim[0])))
            y1 = int((lsingle_point[1] * (resize_dim[1] / original_dim[1])))
            new_point_list.append(x1)
            new_point_list.append(y1)

        return new_point_list

    points = [774,265,909,409]
    original_dim = (1237,1036)
    resize_dim = (640,480)
    result = scale_img_pixel(points,original_dim,resize_dim)
    print("result: ", result) 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2020-08-03T05:48:56.263

```
import cv2
from skimage import data 
import matplotlib.pyplot as plt
from skimage.util import img_as_ubyte
from skimage import io
filename='abc.png'
image=plt.imread(filename)
im=cv2.imread('abc.png')
print(im.shape)
im.resize(300,300)
print(im.shape)
plt.imshow(image) 
```

# c# - 获取属性时如何忽略继承链？

> ID：273949
> 
> 赞同：1
> 
> 时间：2008-11-07T23:09:27.953
> 
> 标签：c#, reflection, attributes

出于某种原因，我没有得到这个。（下面的示例模型）如果我写：

```
var property = typeof(sedan).GetProperty("TurningRadius");
Attribute.GetCustomAttributes(property,typeof(MyAttribute), false) 
```

尽管表明我不想搜索继承链，但调用将返回 MyAttribute(2)。有谁知道我可以编写什么代码以便调用

```
MagicAttributeSearcher(typeof(Sedan).GetProperty("TurningRadius")) 
```

调用时不返回任何内容

```
MagicAttributeSearcher(typeof(Vehicle).GetProperty("TurningRadius")) 
```

返回 MyAttribute(1)？

* * *

示例模型：

```
public class Sedan : Car
{
    // ...
}

public class Car : Vehicle
{
    [MyAttribute(2)]
    public override int TurningRadius { get; set; }
}

public abstract class Vehicle
{
    [MyAttribute(1)]
    public virtual int TurningRadius { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-09T18:26:19.833

好的，鉴于额外的信息 - 我相信问题在于`GetProperty`继承变化。

如果您将呼叫更改`GetProperty`为：

```
PropertyInfo prop = type.GetProperty("TurningRadius",
    BindingFlags.Instance | BindingFlags.Public | BindingFlags.DeclaredOnly); 
```

`prop`如果该属性未被覆盖，则 then将为 null。例如：

```
static bool MagicAttributeSearcher(Type type)
{
    PropertyInfo prop = type.GetProperty("TurningRadius", BindingFlags.Instance | 
                                         BindingFlags.Public | BindingFlags.DeclaredOnly);

    if (prop == null)
    {
        return false;
    }
    var attr = Attribute.GetCustomAttribute(prop, typeof(MyAttribute), false);
    return attr != null;
} 
```

这返回`true`并且仅在以下情况下：

*   指定的类型覆盖`TurningRadius`属性（或声明一个新的）
*   属性具有`MyAttribute`属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-09T18:25:42.253

我认为问题在于，当您从第一行的 Sedan 对象中获取属性 TurningRadius

```
var property = typeof(sedan).GetProperty("TurningRadius"); 
```

您实际上得到的是在 Car 级别声明的 TurningRadius 属性，因为 Sedan 没有自己的重载。

因此，当您请求它的属性时，即使您请求不在继承链中上升，您也会得到在 car 中定义的属性，因为您要查询的属性是在 Car 中定义的属性。

您应该更改 GetProperty 以添加必要的标志以仅获取声明成员。我相信[DeclaredOnly](http://msdn.microsoft.com/en-us/library/system.reflection.bindingflags.declaredonly.aspx)应该这样做。

编辑：请注意，此更改将使第一行返回 null，因此请注意 NullPointerExceptions。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T23:35:39.663

我认为这就是您所追求的 - 请注意，我必须在 Vehicle 中使 TurningRadius 抽象并在 Car 中被覆盖。可以吗？

```
using System;
using System.Reflection;

public class MyAttribute : Attribute
{
    public MyAttribute(int x) {}
}

public class Sedan : Car
{
    // ...
}

public class Car : Vehicle
{
    public override int TurningRadius { get; set; }
}

public abstract class Vehicle
{
    [MyAttribute(1)]
    public virtual int TurningRadius { get; set; }
}

class Program
{
    static void Main(string[] args)
    {
        MagicAttributeSearcher(typeof(Sedan));
        MagicAttributeSearcher(typeof(Vehicle));
    }

    static void MagicAttributeSearcher(Type type)
    {
        PropertyInfo prop = type.GetProperty("TurningRadius");
        var attr = Attribute.GetCustomAttribute(prop, typeof(MyAttribute), false);
        Console.WriteLine("{0}: {1}", type, attr);
    }
} 
```

输出：

```
Sedan:
Vehicle: MyAttribute 
```

# css - 如何在悬停时更改文本链接而不是图像链接的背景颜色

> ID：273964
> 
> 赞同：8
> 
> 时间：2008-11-07T23:16:59.903
> 
> 标签：css

我有一个这样的 CSS 规则：

```
a:hover { background-color: #fff; } 
```

但这会导致图片链接底部出现不好看的间隙，更糟糕的是，如果我有透明图片，可以通过图片看到链接的背景颜色。

我以前多次偶然发现这个问题，但我总是使用快速而肮脏的方法来解决它，即为图像链接分配一个类：

```
a.imagelink:hover { background-color: transparent; } 
```

今天，当我偶然发现这个问题时，我正在寻找一个更优雅的解决[方案](https://developer.mozilla.org/en/Images%2c_Tables%2c_and_Mysterious_Gaps)。

基本上它建议使用`display: block`，这确实解决了不透明图像的问题。然而，它导致了另一个问题：现在链接和段落一样宽，尽管图像不是。

有没有解决这个问题的好方法，还是我必须再次使用肮脏的方法？

谢谢，

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-08T05:20:39.577

我试图找到一些选择器，它只会获取`<a>`没有`<img>`后代的元素，但找不到任何...关于具有底部间隙的图像，您可以执行以下操作：

```
a img{vertical-align:text-bottom;} 
```

这应该会消除图像后面显示的背景，但可能会影响布局（不过不会太多），所以要小心。

对于透明图像，您应该使用一个类。

我真的希望通过实现父选择器在 CSS3 中解决这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-08T03:23:28.003

我对您所说的“图像链接”感到困惑……这是锚内的“img”标签吗？还是您在 CSS 中设置图像？

如果您在 CSS 中设置图像，那么这里没有问题（因为您已经能够定位它）......所以我必须假设您的意思是：

```
<a ...><img src="..." /></a> 
```

为此，我建议您在图像上指定背景颜色...因此，假设它所在的容器*应该*是白色...

```
a:hover { background: SomeColor }
a:hover img { background-color: #fff; } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T11:14:01.127

我通常会做这样的事情来消除图像下的间隙：

```
img {
  display: block;
  float: left;
} 
```

当然，这并不总是理想的解决方案，但在大多数情况下都可以。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-02T06:13:21.750

这种方式效果更好。

```
a[href$=jpg], a[href$=jpeg], a[href$=jpe], a[href$=png], a[href$=gif] {
    text-decoration: none;
    border: 0 none;
    background-color: transparent;
    } 
```

无需对每个图像应用繁琐的类。详细说明在这里：

[http://perishablepress.com/press/2008/10/14/css-remove-link-underlines-borders-linked-images/](http://perishablepress.com/press/2008/10/14/css-remove-link-underlines-borders-linked-images/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T23:20:27.150

未经测试的想法：

```
a:hover {background-color: #fff;}
img:hover { background-color: transparent;} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-07T23:29:41.517

以下应该有效（未经测试）：

首先你

```
 a:hover { background-color: #fff; } 
```

那么你

```
a:imagelink:hover { background-color: inherit; } 
```

第二个规则将覆盖 <a class="imagelink" etc.> 的第一个规则并保留父级的背景颜色。

我尝试在没有 class="" 的情况下执行此操作，但我找不到与 foo > bar 相反的 CSS 选择器，当它是 foo 的子级时，它会设置 bar 的样式。*当 foo有*一个类 bar 的子对象时，您会想要设置它的样式。你可以用 jQuery 做到这一点，甚至可以做一些更有趣的事情，但这可能不适合作为一种通用技术。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-08T02:24:34.113

您可以使用 display: inline-block 但这并不完全是跨浏览器。IE6及更低版本会有问题。

我假设您在 and 之间有`<a>`空格`<img>`？尝试像这样删除它：

`<a><img /></a>`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-22T22:25:18.413

我今天遇到了这个问题，并使用了另一种解决方案，而不是`display: block`感谢提问者的链接。这意味着我**只能**在图像上保留链接，而不能将其扩展到其容器中。

图像是内联的，因此它们下方有空间用于字母的下部，例如“y，j，g”。这会将图像定位在`baseline`，但如果您不`<a>TEXT HERE</a>`喜欢带有**徽标**的位置，则可以更改它。但是，如果您使用纯色作为背景（例如 in`body`或`div#wrapper`），您仍然需要屏蔽文本行空间并且它很容易。

```
body {
  background-color: #112233; 
}
a:hover {
  background-color: red;
}
a img {
  border-style: none; /* not need for this solution, but removes borders around images which have a link */
  vertical-align: bottom; /* here */
}
a:hover img {
  background-color: #112233; /* MUST match the container background, or you arent masking the hover effect */
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-27T20:54:47.403

我有同样的问题。就我而言，我使用图像作为背景。我做了以下事情，它解决了我的问题：

```
background-image: url(file:"use the same background image or color"); 
```

# php - 在 PHP 中为粘性表单的值转义双引号

> ID：273969
> 
> 赞同：4
> 
> 时间：2008-11-07T23:18:41.493
> 
> 标签：php, validation, forms, filtering

我在制作一个粘性表单时遇到了一些麻烦，如果值有双引号，它会记住在表单提交时输入的内容。问题是 HTML 应该是这样的：

```
<input type="text" name="something" value="Whatever value you entered" /> 
```

但是，如果这句话：“我该怎么做？” 用引号输入，生成的 HTML 类似于：

```
<input type="text" this?="" do="" i="" how="" value="" name="something"/> 
```

我将如何过滤双引号？我已经尝试过打开和关闭魔术引号，我使用了stripslashes 和addslashes，但到目前为止我还没有遇到正确的解决方案。为 PHP 解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-07T23:21:27.523

你想要[htmlentities()](http://www.php.net/htmlentities)。

`<input type="text" value="<?php echo htmlentities($myValue); ?>">`

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-07T23:33:31.853

以上将编码具有 html 实体代码的各种字符。我更喜欢使用：

```
htmlspecialchars($myValue, ENT_QUOTES, 'utf-8'); 
```

这只会编码：

```
'&' (ampersand) becomes '&amp;'
'"' (double quote) becomes '&quot;' when ENT_NOQUOTES is not set.
''' (single quote) becomes '&#039;' only when ENT_QUOTES is set.
'<' (less than) becomes '&lt;'
'>' (greater than) becomes '&gt;' 
```

您还可以在 $myValue 上执行 strip_tags 以删除 html 和 php 标签。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-11T11:12:00.097

这就是我使用的：

```
htmlspecialchars($string, ENT_QUOTES | ENT_SUBSTITUTE | ENT_DISALLOWED | ENT_HTML5, 'UTF-8') 
```

*   `ENT_QUOTES`告诉 PHP 转换单引号和双引号，我觉得这是可取的。
*   `ENT_SUBSTITUTE`并`ENT_DISALLOWED`处理无效的 Unicode。它们非常相似 - 据我了解，第一个替换无效的代码单元序列，即**无效编码的字符或不代表字符的序列**，而第二个替换给定文档类型的无效代码点，即**不是的字符允许指定的文档类型**（如果未明确指定，则为默认值）。[文档](http://www.php.net/manual/en/function.htmlentities.php)对它们过于简洁，这是不受欢迎的。
*   `ENT_HTML5`是我使用的文档类型。您可以使用不同的，但它应该与您的页面文档类型匹配。
*   `UTF-8`是我的文档的编码。我建议，除非您绝对确定您使用的是 PHP 5.4.0，否则您明确指定编码 - 特别是如果您要处理非英文文本。我做一些工作的主机使用 5.2.something，它默认`ISO-8859-1`并产生乱码。

正如**thesmart**所建议的，`htmlspecialchars`仅对保留的 HTML 字符进行编码，同时`htmlentities`转换具有 HTML 表示的所有内容。在大多数情况下，两者都可以胜任。[这](https://stackoverflow.com/questions/46483/htmlentities-vs-htmlspecialchars)是关于该主题的讨论。

还有一件事：最好的做法是禁用魔术引号，因为它们给人一种虚假的安全感，并且在 5.3.0 中已弃用并从 5.4.0 中删除。如果启用它们，则您字段中的每个引用都将在回发时添加一个反斜杠（并且多个回发将添加越来越多的斜杠）。我看到 OP 能够更改设置，但供将来参考：如果您在共享主机上或无法访问`php.ini`，最简单的方法是添加

```
php_flag magic_quotes_gpc Off 
```

到`.htaccess`文件。

# php - 功能重定向的 HTTP 状态

> ID：273970
> 
> 赞同：4
> 
> 时间：2008-11-07T23:19:52.753
> 
> 标签：php, http, post, redirect, http-status-code-302

现在我们已经有了显示 UI 元素的网页，以及只处理表单提交，然后重定向回 UI 页面的网页。他们使用 PHP 的 header() 函数来做到这一点：

```
header("Location: /other_page.php"); 
```

这会导致发送 302 Found 响应；根据 HTTP 1.1 规范，302 用于“请求的资源临时驻留在不同的 URI 下”的情况。[[HTTP 1.1 规范]](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.3)

从功能上讲，这很好，但看起来这不是我们正在做的正确的状态代码。看起来 303（“查看其他”）是这里的适当状态，所以我想知道是否有任何理由不使用它。我们必须更明确地使用 header()，因为我们必须指定状态行而不仅仅是 Location: 字段。想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T23:50:14.253

您可以使用其中任何一种，但用于重定向后发布的正确状态码是 303。

这种混乱有一个历史解释。最初，302 指定浏览器不得更改重定向请求的方法。这使得它不适合重定向后发布，您希望浏览器发出 GET 请求。但是，所有浏览器似乎都误解了规范并总是发出 GET 请求。为了消除歧义，HTTP/1.1 指定了两个新代码：303 和 307。303 实质上指定了 302 的事实上的解释，而 307 指定了 302 的原始规范。因此在实践中 302 和 303 是可以互换的，并且在理论302和307是​​。

如果你*真的*关心兼容性，302 比 303 更安全，因为 HTTP/1.0 代理可能不理解 303，但所有现代浏览器都支持 HTTP/1.1，所以这不是一个真正的问题。我建议使用 303，因为这是最正确的做法。

附带说明；该`Location`字段应该是一个完整的 URL。在实践中这并不重要——浏览器是宽容的——但如果你关心规格，那是正确的做法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-07T23:27:27.340

我自己从未使用过它...正如您的链接中所说：

> 注意：许多 HTTP/1.1 之前的用户代理不理解 303 状态。当与此类客户端的互操作性是一个问题时，可以使用 302 状态代码代替，因为大多数用户代理对 302 响应做出反应，如此处针对 303 所述。

这似乎是我坚持使用 302 的充分理由。

仅供参考[header()](http://www.php.net/header)需要额外的参数，您可以在其中设置状态代码：

`header('Location: /foo.php', true, 303);`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T23:44:54.183

为了扩展 RoBorg 的答案，许多浏览器只能理解许多 HTTP 响应代码中的一小部分。

附注：如果您完全关心搜索引擎的位置，302 可能（据说）会导致问题。

# compiler-construction - 有人能告诉我计算机编程的基本原理吗？

> ID：273978
> 
> 赞同：17
> 
> 时间：2008-11-07T23:21:46.883
> 
> 标签：compiler-construction, machine-language

是什么让一门编程语言的所有单词都能真正发挥作用？我的意思是，实际上发生了什么让计算机知道所有这些词的意思？如果我口头告诉我的计算机做某事，它不会做，因为它不理解。那么这些人类语言写成一种语言究竟是如何真正使计算机做一些合乎需要的活动的呢？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-07T23:44:48.240

这一切都始于 CPU 或处理器。每种处理器类型都有一组定义的能够执行的指令。这些指令对 1 和 0 进行操作，它们反过来代表您希望它们执行的任何操作：数字、字母，甚至是指令本身。

在最低级别，零是由晶体管上存在特定电压（通常接近 0V）确定的，而 1 是存在不同电压（取决于 CPU，例如 5V）

机器指令本身是一组零和一组放置在处理器中称为寄存器的特殊位置，处理器从特定位置获取指令及其操作数并执行操作，将结果放置在另一个位置，然后获取下一条指令，依此类推，直到它用完要执行的指令或被关闭。

一个简单的例子。假设机器指令 001 表示两个数字相加。

然后你编写一个程序，将两个数字相加，通常是这样的：

```
4 + 5 
```

然后将此文本传递给编译器，该编译器将为您将在其上运行程序的处理器生成足够的机器代码（旁注，您可以编译代码以在与当前运行的处理器不同的处理器中运行，这是一个名为交叉编译，它很有用，例如，在嵌入式平台中）。好吧，编译器最终会大致生成，

```
001 00000100 00000101 
```

使用额外的样板机器代码将 001 指令放在下一个指令寄存器（指令指针）中，并将二进制编码的数字放在数据寄存器（或 RAM）中。

从结构化语言生成机器代码的过程相当复杂，并且限制了这些语言最终看起来的正常程度。这就是为什么你不能用英语编写程序的原因，它有太多的歧义，编译器无法生成正确的 0 和 1 序列。

CPU可以执行的指令相当基本和简单，加法、除法、取反、从RAM读取、放入RAM、从寄存器读取等等。

下一个问题是，这些简单的数字指令如何产生我们在计算中看到的所有奇迹（互联网、游戏、电影播放器​​等）？

它基本上归结为创建足够的模型，例如 3D 游戏引擎有一个代表游戏世界的数学模型，并且可以根据它计算游戏对象的位置/碰撞。

这些模型建立在许多这样的小指令之上，这就是高级语言（不是机器代码）真正大放异彩的地方，因为它们提高了抽象级别，然后你可以*更接近你想要实现的模型*，让你轻松推理诸如如何根据从控制器接收到的输入有效地计算士兵将要进入的下一个位置，而不是因为您忙于不忘记 0 而阻止您轻松推理。

从汇编语言（一种与机器代码非常相似的语言，它是第一种编程语言，它是特定于 CPU 的。每条汇编指令都直接转换为机器代码）到 C（可在不同 CPU 之间移植，并且是在比汇编更高的抽象级别：每行 C 代码代表许多机器代码指令）。这对程序员来说是一个巨大的生产力提升，他们不再需要在不同的 CPU 之间移植程序，他们可以更轻松地思考底层模型，从而导致我们看到的软件复杂性持续增加（甚至需求）从 1970 年代到今天。

未决的缺失环节是如何控制如何处理该信息以及如何接收来自外部来源的输入，例如在屏幕上显示图像或将信息写入硬盘驱动器，或在打印机上打印图像，或从键盘。这一切都是通过计算机中存在的其他硬件实现的，这些硬件以类似于 CPU 的方式进行控制，您将数据和指令放置在图形卡或网卡或硬盘驱动器或内存。CPU 具有指令，可以将一些数据或指令放入（或从中读取信息）不同硬件的正确位置。

与我们今天所拥有的存在相关的另一件事是，所有现代计算机都带有称为操作系统的大型程序，这些程序管理所有基本内容，例如与硬件通信和错误处理，例如程序崩溃时会发生什么等。此外，许多现代编程环境都带有**许多**已经编写好的代码（标准库）来处理许多基本任务，例如在屏幕上绘图或读取文件。该库将反过来要求操作系统代表它与硬件对话。

如果这些不可用，编程将是一项非常艰巨且乏味的任务，因为您编写的每个程序都必须再次创建代码以在屏幕上绘制单个字母或从每种特定类型的硬盘读取单个位，例如。

看来我得意忘形了，我希望你能从中理解一些事情:-)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-07T23:27:05.780

计算机编程语言实际上是一种高度抽象的语言，它被转换成计算机实际理解的非常基本的语言。

基本上，计算机真的只理解机器语言，这是一种以二进制（1 和 0）实现的基本语言。在此之上的一个级别是汇编语言，它是一种非常原始的语言，至少是人类可读的。

在高级语言中，我们可能有类似的东西：

```
Person.WalkForward(10 steps) 
```

在机器代码中，它将是：

```
Lift Persons Left Foot Up
Lean Forward
Place Left Foot Down
Lift Right Foot up
Lean Forward 
Place Right Foot Down
etc 
```

现在很明显，没有人愿意编写程序来告诉计算机每一个重复的小事情要做，所以我们有称为编译器的工具。

编译器采用更易于人类理解的高级语言，并将其转换为机器代码，以便计算机可以运行它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-08T01:12:56.660

一本为非工程师讨论计算机的好书是[Charles Petzold 的“代码”](https://rads.stackoverflow.com/amzn/click/com/0735611319)。我不记得它是否完全涵盖了您的问题，但我认为是的。如果你有足够的兴趣走得更远，这是一个不错的选择。

[代码 http://ecx.images-amazon.com/images/I/11MYtZPhJEL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA198_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/11MYtZPhJEL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA198_SH20_OU01_.jpg)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-07T23:23:35.787

在最简单的情况下，称为**编译器**的程序将您编写的编程语言单词转换为计算机可以理解的*机器语言。*编译器了解一种特定的编程语言（C#、Java 等），它对如何向编译器解释你想要它做什么有非常具体的规则。

对这些规则的解释和理解是 Stack Overflow 的主要内容。:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-07T23:26:12.647

编程是你采取一系列步骤来解决某个问题，然后用某种需要某种语法的语言写出来。当您用该语言描述了这些步骤后，您可以使用编译器（根据 Greg 的评论），该编译器将该语言翻译成计算机可以解释的语言。

艺术在于确保你足够好地描述这些步骤:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-08T00:53:29.570

一些人已经提供了从典型编程语言到处理器可以执行的实际机器代码的翻译过程的摘要。

要理解这个过程，对在机器代码级别进行编程的实际感觉有一个具体的感觉会很有帮助。一旦您了解了处理器本身可以做什么，就更容易将高级编程结构理解为它们的缩写。

但不幸的是，为台式计算机编写机器代码并不是很有趣。

作为替代方案，有一个很棒的老游戏，叫做[Corewar](http://en.wikipedia.org/wiki/Corewar)，你可以在其中使用简化的机器语言编写小程序。然后这些程序为了生存而相互竞争。你可以用原始机器语言编写基本程序，然后有一个宏系统，所以你不必重复太多，这是迈向全功能语言的第一步。

另一件简单、有益但低级的事情是编写一个简单的嵌入式控制器，如[Arduino](http://en.wikipedia.org/wiki/Arduino)。有很多像[这样](http://www.ladyada.net/learn/arduino/)的简单介绍可用。您仍将使用编译器，但生成的机器代码更容易理解（如果您愿意的话），因为处理器的功能要简单得多。

这两种方法都是了解数字计算机实际工作方式的好方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-08T01:13:46.503

很简单，计算机编程就是以计算机可以理解的语言向计算机提供一组指令的行为。程序员通常用高级编程语言编写指令，然后这些指令被翻译成计算机可以理解的二进制语言。进行这种翻译的程序称为编译器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-07T23:33:26.203

您可以将编程的工作原理与语言之间的翻译进行比较。假设你和另外两个人在一个荒岛上。你只会说法语。1 号人（我们称他为 Fred）只会说法语和日语。第 2 个人（鲍勃）只会说日语。假设你需要让 Bob 去帮你收集一些柴火。想象在这种情况下，您是程序，而 Bob 是计算机。你用法语对弗雷德说：“你能告诉鲍勃来帮帮我吗？” Fred 翻译成日语并请 Bob 帮助您。在这种情况下，Fred 将是编译器。他将请求翻译成 Bob 可以理解的内容。这就是计算机程序的工作方式。

有一篇很好的[How Stuff Works](http://computer.howstuffworks.com/program1.htm)文章解释了一些事情。

在我参加数字电子课程之前，我个人并不真正了解计算机如何以它们的方式工作。在此之前，我完全了解计算机如何工作的整个想法。在我建立了一个二进制计数器之后，一切都变得有意义了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-06T01:03:37.677

我有两个疯狂的建议。及时回去！

**1\. 获得一个可编程计算器。**

[可编程计算器](http://en.wikipedia.org/wiki/Programmable_calculator)是一个普通的计算器，你可以用它做通常的事情：输入数字，输入操作符号，按下equel键后，你可以在微型显示器上读取结果。此外，可编程计算器可以将短的击键序列存储为程序，以后可以通过单次按键“重播”。假设您将此序列设置为程序（每行一条指令）：

```
(Start)
*
2
+
1
=
(Stop) 
```

现在您有一个自定义操作：按下“程序”键（或您分配给哪个键）它将在没有您进一步帮助的情况下运行序列，并将显示内容乘以 2 并加 1 - 这是一个程序！

稍后您可以尝试更多增强的技术：将临时结果存储到内存中，在结果上进行分支。

优点：

*   计算器是一个熟悉的环境。您已经具备了基础知识。
*   这很简单。你不必学习很多指令和编程技术。
*   现代编程语言离地面很远，而可编程计算器“就在上面”。您将学习基础知识：内存、分支、基本操作。计算机的工作方式非常相似（在机器语言级别上）。
*   您将遇到低级问题：内存、除以零。
*   这非常酷。

缺点：

*   它已经过时了。你必须学习一门现代编程语言，这会有所不同。
*   这很不舒服（嗯，它是专业的：你不能使用舒适的点击播放玩具）。也许你甚至不能保存你的代码。
*   得到一个不是一件容易的事。你可以在 E-Bay 上试试。此外，文档不会有问题，大多数模型在互联网上都有大量的用户群。

[恕我直言， TI-59](http://www.ti59.com/)的最佳选择。

**2\. 在模拟器的帮助下学习 BASIC 语言。**

当您打开具有内置[BASIC 语言](http://en.wikipedia.org/wiki/BASIC_programming_language)解释器的机器时，它已准备好接受您的命令，并在您键入时执行。首先，您可以在命令模式下尝试一些指令，例如：

```
PRINT 5*4 
```

它将在下一行打印“20”，哇。如果你在命令模式下玩够了，你可以将指令整理成程序，然后你可以运行、编辑、增强它。

优点：

*   BASIC 是一种真正的编程语言，专为教育而设计。
*   当您后来遇到一种现代编程语言并发现其中的差异时，您将看到过去 30 年编程技术（例如过程、结构等）的进步。
*   这很酷，特别是如果你得到一个真正的，而不仅仅是一个模拟器。

缺点

*   它已经过时了。从那个年龄到现在已经过去了将近 30 年。
*   旧机器是紧凑的封闭系统。没有文件（以我们今天使用的形式）、文件夹、文件类型，可能会让初学者感到困惑。

我最喜欢的 BASIC 系统是[Commodore 16 (Plus/4)](http://en.wikipedia.org/wiki/Commodore_16)，它与著名的 C64 非常相似。但更舒服。我更喜欢[YAPE](http://yape.homeserver.hu/download.htm)模拟器，它可以保存/加载内存快照或 BASIC 程序到文件。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-08T01:32:03.610

电脑有预设数量的指令；它已经知道该怎么做。计算机程序只是计算机将按顺序执行的指令列表。

早期的程序是直接用机器语言编写的。程序员为了让他们的生活更轻松，开始创建抽象来简化他们需要编写的程序。随着时间的推移，添加了越来越多的抽象，就像洋葱层一样，但归根结底都是同一件事——执行一系列指令。

如果您想在不关注编译器、技术等的情况下学习编程，那么当您开始在[Alice](http://www.alice.org)中创建 3D 场景时，您会很好地了解程序是什么。爱丽丝从卡内基梅隆大学免费。您最终会学习如何编程，而无需尝试学习编程。

但是，如果您想了解更多有关技术细节的信息，最好的办法是查看一些介绍性的 compi-sci 大学教科书。以下[How C Programming Works](http://computer.howstuffworks.com/c.htm/printable)也可能会给您一些答案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-08T00:31:09.163

正如人们已经注意到的那样，有一些预程序（通常是“编译器”）可以将程序中的文字翻译成一种更冗长的“低级”语言，称为“机器代码”。

机器代码由非常简单的指令组成，这些指令已经被底层处理器“理解”（或至少就其意义而言）。例如，一条指令将数据从内存位置复制到处理器的一个特殊部分（称为“累加器”，可以对其进行简单的算术运算）。或者一条将两个插槽的内容相加的指令在蓄能器中。

你看到的复杂的程序（包括高级语言的编译器和解释器）最终都是由这些运行了数百万次的简单指令构建的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-07T23:30:47.630

CPU有一个称为指令指针的寄存器（可以存储数字的东西）。指令指针表示从内存中的哪个地址提取指令。CPU 拉取一条指令，执行它，然后继续下一条指令，除非它执行的指令说要转到其他地方。这些说明相当薄弱。将此号码添加到该号码。把这个号码存在那里。从那里接受下一条指令。一个称为编译器的程序会分析您的程序并将其转换为机器代码（我在这里跳过了几个步骤）。

[SICP](http://mitpress.mit.edu/sicp/full-text/book/book.html)和[TECS](http://www1.idc.ac.il/tecs/)两本书可以让您对这个过程有一个不错的概述。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-11-07T23:24:58.000

基本上，您从简单的事情开始，例如：

```
print("Hello World"); 
```

然后你只需在它上面撒上语法糖和魔法标记，直到它做你想要的！

# excel - 如何将平均值添加到 Excel 中的数据透视表？

> ID：273985
> 
> 赞同：2
> 
> 时间：2008-11-07T23:25:59.310
> 
> 标签：excel, pivot-table

我有客户数量和订单数量的列。如何显示订单的平均数量？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-07T23:28:13.860

再次将订单列拖放到 Pivot 布局上，然后双击以选择汇总方法。

# c - C 头文件中的包含循环

> ID：273995
> 
> 赞同：1
> 
> 时间：2008-11-07T23:30:09.427
> 
> 标签：c, include, header

如何防止 C 中的包含循环？IE。你不应该有 ah #include "bh"，其中 #include 的 "ch" 和 #include 的 "ah"。我正在寻找一种使用某种 C 指令来防止这种情况发生的方法。

我原本以为这会阻止这种情况发生：

内容啊：

```
#ifndef __A_H
#define __A_H

#include "b.h"

#endif // __A_H 
```

bh的内容：

```
#ifndef __B_H
#define __B_H

#include "c.h"

#endif // __B_H 
```

ch的内容：

```
#ifndef __C_H
#define __C_H

#include "a.h"

#endif // __C_H 
```

但这似乎不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-07T23:36:43.017

它确实可以正常工作：文件**被**重复包含，但受#ifdndef/#define/#endif 保护的部分**不**重复，这打破了循环。

使用您的编译器生成预处理输出并自己查看。使用 GNU CC，您需要在 .c[pp] 文件上使用“-E”选项，如下所示：

```
gcc -E $(CFLAGS) -o foo.i foo.cpp 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T23:37:40.080

带有前导下划线的宏是为预处理器/编译器保留的。

尝试将 __*_H 更改为更标准的内容。
我使用 HAVE__*_H。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T23:38:08.410

那应该行得通。它在您的示例中正确编写并且对我来说编译得很好。您是否在实际代码中打错了某些内容，或者您​​确实遇到了其他问题？

但是，您不应该从 __ 开始，因为它是为编译器和/或系统库保留的。为你的守卫尝试一些其他的名字。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T11:30:28.737

除了上述内容之外，如果您正在使用 turbo c 并且正在使用这些源文件进行项目，则不要附加源文件中#included 的头文件。即使这样，如果它不起作用，请尝试它来自命令提示符，因为一些编译器选项一次又一次地给出这些错误。所以如果头文件内容在#ifndef和#endif之间，那么即使你包含这两个文件也不会有问题。所以尝试从项目中删除头文件，将它们保留在同一目录中。bcos 你没有指定环境，我指定了 turbo C，因为我曾经在 turbo C 上遇到过这种情况，头文件#included 在源文件中并附加到项目文件列表中那么就会出现“多重申报问题”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T23:39:44.443

这行得通。

可以肯定的是，我实际上编译了一个 test.c，其中包含 ah 和你的 3 个头文件。

我验证了这适用于 MSVC、Digital Mars 和 GCC 的多个版本。********~~*******