# StackOverflow 问答 000866000-000866999

# python - 使用 BeautifulSoup 查找包含特定文本的 HTML 标签

> ID：866000
> 
> 赞同：72
> 
> 时间：2009-05-14T21:46:12.270
> 
> 标签：python, regex, beautifulsoup, html-content-extraction

我正在尝试获取包含以下文本模式的 HTML 文档中的元素：#\S{11}

```
<h2> this is cool #12345678901 </h2> 
```

因此，前一个将通过使用匹配：

```
soup('h2',text=re.compile(r' #\S{11}')) 
```

结果将是这样的：

```
[u'blahblah #223409823523', u'thisisinteresting #293845023984'] 
```

我能够得到所有匹配的文本（见上一行）。但我希望文本的父元素匹配，所以我可以使用它作为遍历文档树的起点。在这种情况下，我希望所有 h2 元素都返回，而不是文本匹配。

想法？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-05-14T21:53:21.193

```
from BeautifulSoup import BeautifulSoup
import re

html_text = """
<h2>this is cool #12345678901</h2>
<h2>this is nothing</h2>
<h1>foo #126666678901</h1>
<h2>this is interesting #126666678901</h2>
<h2>this is blah #124445678901</h2>
"""

soup = BeautifulSoup(html_text)

for elem in soup(text=re.compile(r' #\S{11}')):
    print elem.parent 
```

印刷：

```
<h2>this is cool #12345678901</h2>
<h2>this is interesting #126666678901</h2>
<h2>this is blah #124445678901</h2> 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-11-12T18:05:50.330

BeautifulSoup 搜索操作在用作标准`BeautifulSoup.NavigableString`时提供 [a list of] 对象，而不是在其他情况下。检查对象以查看提供给您的属性。在这些属性中，由于[BS4 的变化](http://www.crummy.com/software/BeautifulSoup/bs4/doc/#method-names)而受到青睐。`text=``BeautifulSoup.Tag``__dict__``parent``previous`

```
from BeautifulSoup import BeautifulSoup
from pprint import pprint
import re

html_text = """
<h2>this is cool #12345678901</h2>
<h2>this is nothing</h2>
<h2>this is interesting #126666678901</h2>
<h2>this is blah #124445678901</h2>
"""

soup = BeautifulSoup(html_text)

# Even though the OP was not looking for 'cool', it's more understandable to work with item zero.
pattern = re.compile(r'cool')

pprint(soup.find(text=pattern).__dict__)
#>> {'next': u'\n',
#>>  'nextSibling': None,
#>>  'parent': <h2>this is cool #12345678901</h2>,
#>>  'previous': <h2>this is cool #12345678901</h2>,
#>>  'previousSibling': None}

print soup.find('h2')
#>> <h2>this is cool #12345678901</h2>
print soup.find('h2', text=pattern)
#>> this is cool #12345678901
print soup.find('h2', text=pattern).parent
#>> <h2>this is cool #12345678901</h2>
print soup.find('h2', text=pattern) == soup.find('h2')
#>> False
print soup.find('h2', text=pattern) == soup.find('h2').text
#>> True
print soup.find('h2', text=pattern).parent == soup.find('h2')
#>> True 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-01-20T20:17:07.320

使用 bs4 (Beautiful Soup 4)，OP 的尝试完全符合预期：

```
from bs4 import BeautifulSoup
soup = BeautifulSoup("<h2> this is cool #12345678901 </h2>")
soup('h2',text=re.compile(r' #\S{11}')) 
```

返回`[<h2> this is cool #12345678901 </h2>]`。

# javascript - webrick服务器/ ie6在开发模式下截断javascript文件

> ID：866010
> 
> 赞同：0
> 
> 时间：2009-05-14T21:47:34.590
> 
> 标签：javascript, jquery, internet-explorer-6, curl, webrick

我正在使用 webrick 在开发模式下运行我的 rails 应用程序。该页面包含 4-5 个 javascript 文件，这些文件也由同一个 webrick 实例提供服务。

当我在 ie6 上加载页面时，似乎 javascript 文件在前几行之后被截断 - 谁能解释一下？例如，如果页面包含此脚本标签：

```
<script type="text/javascript" src="http://myserver:3200/javascripts/jquery.js"></script> 
```

当页面在 ie6 中加​​载时，它会引发 javascript 语法错误，并且 Visual Web Developer (VWD) 允许我打开加载的 jquery.js 文件，它只显示前 30 行，然后就停止了。

从运行 ie6 的同一台机器上，我尝试使用 curl 加载相同的 jquery.js 文件：

```
% curl --verbose "http://myserver:3200/javascripts/jquery.js"
* About to connect() to myserver port 3200 (#0)
*   Trying xx.xx.xx.xx... connected
* Connected to myserver (xx.xx.xx.xx) port 3200 (#0)
> GET /javascripts/jquery.js HTTP/1.1
> User-Agent: curl/7.16.3 (i686-pc-cygwin) libcurl/7.16.3 OpenSSL/0.9.8j zlib/1.2.3 libssh2/0.15-CVS
> Host: myserver:3200
> Accept: */*
> 
< HTTP/1.1 200 OK
< Connection: close
< Date: Thu, 14 May 2009 21:35:09 GMT
< Content-Length: 
< Last-Modified: Wed, 13 May 2009 20:38:23 GMT
< Content-Type: application/javascript
< 
* Closing connection #0 
```

因此，通过 curl 访问页面时，我没有从服务器返回任何内容。与 wget 相同。

但是，如果我加载页面，甚至是 firefox 或 chrome 中的单个 javascript 文件，它加载完整的东西就好了。所以 webrick 和 ie6 之间存在一些奇怪的交互，与 curl/wget 相同。我尝试的另一项测试：

```
% telnet myserver 3200
GET /javascripts/jquery.js HTTP/1.1
Accept: */*

HTTP/1.1 200 OK
Connection: close
Date: Thu, 14 May 2009 21:43:01 GMT
Content-Length:
Last-Modified: Wed, 13 May 2009 20:38:23 GMT
Content-Type: application/javascript

/*!
 * jQuery JavaScript Library v1.3.2
.... 
```

这有效，返回了完整的文件内容。我不知道为什么它不能在 ie6/curl/wget 中加载。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T21:58:56.747

空`Content-Length`标题可能是罪魁祸首。我会集中精力找出 Webrick 没有返回内容长度的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T22:32:59.583

嗯...“gem install mongrel”，然后重新启动脚本/服务器，突然就可以了。显然这是一个 webrick 问题，通过使用 mongrel 来解决。

# c++ - 有没有办法在 for 循环初始化程序中定义两种不同类型的变量？

> ID：866012
> 
> 赞同：7
> 
> 时间：2009-05-14T21:47:46.337
> 
> 标签：c++, for-loop, scope, initializer, variable-declaration

您可以在 for 循环中定义 2 个相同类型的变量：

```
int main() {
  for (int i = 0, j = 0; i < 10; i += 1, j = 2*i) {
    cout << j << endl;
  }
} 
```

但是定义不同类型的变量是违法的：

```
int main() {
  for (int i = 0, float j = 0.0; i < 10; i += 1, j = 2*i) {
    cout << j << endl;
  }
} 
```

有没有办法做到这一点？（我不需要`i`在循环内使用，只需`j`。）

如果你有完全破解和模糊的解决方案，这对我来说没关系。

在这个人为的例子中，我知道你可以只使用`double`这两个变量。我正在寻找一个普遍的答案。

请不要建议将任何变量移到 for body 之外，这对我来说可能不可用，因为一个迭代器必须在循环之后消失，而 for 语句将包含在我的`foreach`宏中：

```
#define foreach(var, iter, instr) {                  \
    typeof(iter) var##IT = iter;                     \
    typeof(iter)::Element var = *var##IT;            \
    for (; var##_iterIT.is_still_ok(); ++var##IT, var = *var#IT) {  \
      instr;                                         \
    }                                                \
  } 
```

它可以这样使用：

```
foreach(ii, collection, {
  cout << ii;
}). 
```

但我需要这样使用的东西：

```
foreach(ii, collection)
  cout << ii; 
```

请不要引入任何运行时开销（但编译可能会很慢）。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-14T21:51:14.130

> 请不要建议将任何变量移到 for body 之外，因为迭代器必须在循环之后消失，因此可能对我不可用。

你可以这样做：

```
#include <iostream>

int main( int, char *[] ) {
    {
        float j = 0.0;

        for ( int i = 0; i < 10; i += 1, j = 2*i ) {
            std::cout << j << std::endl;
        }
    }

    float j = 2.0; // works

    std::cout << j << std::endl;

    return 0;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-14T21:54:18.397

嗯，很丑。但是你可以使用pair。

```
int main() {
  for (std::pair<int,float> p(0,0.0f); 
       p.first < 10; 
       p.first += 1, p.second = 2*p.first) {
    cout << p.second << endl;
  }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-14T22:52:39.427

这是一个使用 boost 预处理器的版本（这只是为了好玩。对于现实世界的答案，请参阅上面的@kitchen ）：

```
FOR((int i = 0)(int j = 0.0), i < 10, (i += 1, j = 2 * i)) { 

} 
```

第一部分指定了一系列声明：`(a)(b)...`. 后面声明的变量可以引用前面声明的变量。第二和第三部分和往常一样。在第二部分和第三部分出现逗号的地方，可以使用括号来防止它们分隔宏参数。

我知道有两个技巧用于声明变量，这些变量稍后在添加到宏之外的复合语句中可见。第一个使用条件，例如 if：

```
if(int k = 0) ; else COMPOUND_STATEMENT 
```

然后`k`是可见的。自然，它总是必须评估为`false`。所以它不能被我们使用。另一个上下文是这个：

```
for(int k = 0; ...; ...) COMPOUND_STATEMENT 
```

这就是我要在这里使用的。我们必须注意只进行一次迭代`COMPOUND_STATEMENT`。执行增量和条件检查的实际`for`循环必须在最后，因此附加的复合语句属于它。

```
#include <boost/preprocessor.hpp>
#include <iostream>

#define EMIT_DEC_(R,D,DEC) \
    for(DEC; !_k; ) 

#define FOR(DECS, COND, INC) \
    if(bool _k = false) ; else \
      BOOST_PP_SEQ_FOR_EACH(EMIT_DEC_, DECS, DECS) \
        for(_k = true; COND; INC)

int main() {
    FOR((int i = 0)(float j = 0.0f), i < 10, (i += 1, j = 2 * i)) {
        std::cout << j << std::endl;
    }
} 
```

它正在创建一堆`for`语句，每个语句都嵌套在另一个语句中。它扩展为：

```
if(bool _k = false) ; else
  for(int i = 0; !_k; )
    for(float j = 0.0f; !_k; )
      for(_k = true; i < 10; (i += 1, j = 2 * i)) {
        std::cout << j << std::endl;
      } 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-14T21:52:31.630

```
{
  int i = 0;
  float j = 0.0;
  for ( ; i < 10; i += 1, j = 2*i) {
    cout << j << endl;
  }
} 
```

变量在块之后“消失”。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-14T21:52:33.957

这将使迭代器（或在本例中为浮点数）在不再需要时消失：

```
int main() {
  // some code...

  {
    float j = 0.0;
    for (int i = 0; i < 10; i += 1, j = 2*i) {
      cout << j << endl;
    }
  }

  // more code...
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-14T22:20:14.700

如果您在使用宏时遇到问题，有一个标准`do..while`技巧可以完美运行：

```
#define MYFOR(init, test, post, body) \
    do \
    { \
        init \
        for( ; test; post) \
            body \
    } while(0) 
```

按如下方式使用它：

```
MYFOR( int i = 0; float j = 0.0f; , i < 10 , (i += 1, j = 2.0f * i),
    {
         cout << j << endl;
    } ); 
```

它很丑，但它可以满足您的要求：`i`and的范围`j`受`do..while`宏循环的限制，并且它需要一个分号结尾，因此您不会因为将它放在 if/else 的谓词中而被咬陈述。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-20T16:49:54.117

这也很丑陋，但也提供了一些通用方法来在 for 循环中声明具有某些给定名称和类型的多个变量

```
int main() {
  for (struct { int i; float j; } x = { };
       x.i < 10; x.i += 1, x.j = 2 * x.i) {
    cout << x.j << endl;
  }
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-14T22:51:29.993

**编辑**：问题再次改变。现在的问题明确地想要实现一个 foreach 循环。最简单的答案：

```
#include <boost/foreach.hpp>
void( std::vector<int>& v ) {
   BOOST_FOREACH( int & x, v ) {
      x = x*2;
   }
} 
```

**将变量注入代码块**

*这不是一个答案，而是展示一种更通用的将变量注入代码块的技术。似乎 OP 试图定义的宏可能会使用，即使它确实会产生一些开销*

有几个地方可以定义具有不同范围的变量。您可以在任何代码块内定义一个变量，其生命周期将持续到该特定块的末尾。您可以在 for 循环的括号中定义一个变量，范围将是循环块。您还可以在 if 块内定义一个变量，其范围将是 if（包括 else 子句）的范围。

您可以结合上面的这些选项在外部创建变量并将变量注入代码块，而无需创建寿命超过代码块的变量。一个实际的例子是定义一个 foreach 循环（简化为仅适用于 STL 容器。调用语法为：

```
void f( std::vector<int>& container ) 
{
   INTVECTOR_FOREACH( int & x, container )
   {
      x = x*2;
   }
} 
```

使用类似于其他语言中的 foreach 的语义：x 被引用到容器中的每个元素，因此该函数实际上将整数向量中的每个值加倍。

现在简化宏的代码：

```
#define INTVECTOR_FOREACH( variable, container ) \
   for ( std::vector<int>::iterator it = container.begin(); it!=container.end(); ++it ) \
      if ( bool condition=false ) {} else \
         for ( variable = *it; !condition; condition=true ) 
```

为任何容器和类型概括宏需要一些不属于问题上下文的元编程，但它如何工作的想法（我希望）不应该太难理解。

外部*for*迭代容器，在每次迭代中，我们只执行*一次*定义迭代变量（示例代码中的 int & x）。我们需要一个条件来控制内部循环的迭代次数 (1)，并且该条件被注入*if*。我们选择让 if 失败，这样我们就可以确保如果用户在循环之后编写 else 不会得到意外的结果……宏很棘手。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-14T21:54:24.247

> 请不要建议将任何变量移到 for body 之外，因为迭代器必须在循环之后消失，因此可能对我不可用。

您仍然可以这样做，并将整个内容放在花括号中，以使额外的变量超出范围。

```
int main() 
{
  {
    float j = 0.0;
    for (int i = 0; i < 10; i += 1, j = 2*i) 
    {
      cout << j << endl;
    }
  }
  // more code...
} 
```

这种方式`j`会在循环之后立即超出范围。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-14T22:02:22.420

根据您给出的要求，我能想到的最简单的代码是：

```
for ( int i = 0; i < 10; ++i )
{
   float f = i * 2;
   std::cout << f << std::endl;
} 
```

您只使用*f*作为*i*值的两倍。生命周期仅限于循环，并且（至少在您提供的简化问题中）浮动的创建成本很低（与分配一样便宜）。

如果构造真正的*浮点数*（我假设因为 i 不是真正的 int，f 也可能不是浮点数）比重新分配值要昂贵得多，那么封装在一对额外的花括号内的其他解决方案限制范围将是最好的选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-14T22:12:06.827

```
int main() {
  for (int i = 0, float j = 0.0; i < 10; i += 1, j = 2*i) {
    cout << j << endl;
  }
} 
```

也许我很密集，但你为什么还要声明浮动？无论如何，当你离开循环时，你只是“把它扔掉”。对？

```
for(int i=0; i<10; ++i)
    cout << (float)2*i << endl; 
```

**为什么需要j？**

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-14T22:14:35.103

你说 the`i`是你自己的类型，你只需要生成`j`out of `i`，对吧？简单的。将成员函数添加到`i`的类以生成`j`值，并始终使用它。如果需要，您甚至可以创建一个宏来“隐藏”对该成员函数的调用。:-)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-14T21:51:38.217

为什么不直接在 for 循环之外声明和初始化变量呢？您仍然可以像现在一样测试和增加它。

# wcf - 将不相关的合同注入 WCF 的 MEX 提供程序创建的 WSDL

> ID：866027
> 
> 赞同：0
> 
> 时间：2009-05-14T21:50:40.513
> 
> 标签：wcf, web-services, wsdl, metadata, contract

我正在实现一个 WCF 服务（合同 A），该服务最终将调用客户端托管的独立服务（合同 B）。在设计时，当客户端查询我的服务的 WSDL 以构建其代理时，我想包含 Contract B 的 WSDL，以便客户端可以围绕它构建它的服务。不幸的是，我不知道如何将 Contract B 注入到服务发出的 WSDL 中。由于合同是一个接口并且没有 [DataContract] 属性，因此我无法将其添加为已知类型。有没有其他方法可以将合约注入到发出的 WSDL 中？

这是一个例子：

```
[ServiceContract]
public interface IServerService
{
  [OperationContract]
  void GiveTheServerMyServiceUri(string uri);

  [OperationContract]
  void TellAllClientsSomething(string message);
}

// THIS IS THE INTERFACE I WANT TO INCLUDE IN THE WSDL
[ServiceContract]
public interface IClientService
{
  [OperationContract]
  void ReceiveMessageFromServer(string message);
}

public class ServerService : IServerService
{
  private List<string> knownClients;

  public void GiveTheServerMyServiceUri(string uri)
  { 
    knownClients.Add(uri);
  }

  public void TellAllClientsSomething(string message)
  {
    foreach (string clientUri in knownClients)
    {
      // 1\. Create instance of ClientServiceProxy using client's uri
      // 2\. Call proxy.ReceiveMessageFromServer(message)
    }
  }
} 
```

起初，这似乎是一个双工合同的教科书示例。但是，对于这个特定的应用程序，由于各种原因，我需要在客户端和服务器之间进行更多的分离，所以我希望只给客户端一个接口来实现（通过 WSDL），让它托管自己的服务，然后告诉我服务的网址。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T23:03:31.787

我不认为这是有道理的。除非您的服务正在执行其他服务的服务合同，否则不要这样做。

另一方面，您的服务*可以*执行其他服务契约，并成为其他服务的客户端。然后，它可以将调用另一个服务合同委托给该另一个服务。

* * *

我只是试过这个来确定。我创建了一个新的 WCF 服务库项目。这创建了一个实现 IService1 的 Service1，具有两个操作。我修改了 [ServiceContract] 属性以使用特定的命名空间 ( [http://localhost/service1](http://localhost/service1) )。

然后我添加了一个新服务，它为我提供了 Service2，实现了 IService2，只需一个操作 (DoWork)。我更新了 [ServiceContract] 以使用[http://localhost/service2/](http://localhost/service2/)。

然后我更新了 Service1 以实现 IService2 和 IService1，并将 IService2.DoWork 委托给 Service2 服务。我还必须添加一个实现 IService2 的新端点，并且我必须指定一个相对地址，这样两者就不会冲突（因为它们在同一个项目中）。结果如下：

```
using System;

namespace WcfServiceLibrary1
{
    public class Service1 : IService1, IService2
    {
        public string GetData(int value)
        {
            return string.Format("You entered: {0}", value);
        }

        public CompositeType GetDataUsingDataContract(CompositeType composite)
        {
            if (composite.BoolValue)
            {
                composite.StringValue += "Suffix";
            }
            return composite;
        }

        public void DoWork()
        {
            Service2Reference.IService2 svc = null;
            try
            {
                svc = new Service2Reference.Service2Client();
                svc.DoWork();
            }
            finally
            {
                if (svc != null)
                {
                    ((IDisposable)svc).Dispose();
                }
            }
        }
    }
} 
```

# objective-c - 通过 iPhone SDK 获取手机 UUID

> ID：866033
> 
> 赞同：11
> 
> 时间：2009-05-14T21:51:14.007
> 
> 标签：objective-c, iphone, cocoa-touch

SDK 是否提供了获取当前手机 UUID 的 API？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-14T21:52:44.377

```
[[UIDevice currentDevice] uniqueIdentifier] 
```

# java - 如何通过管道将 OutputStream 传递给 StreamingDataHandler？

> ID：866051
> 
> 赞同：8
> 
> 时间：2009-05-14T21:53:42.300
> 
> 标签：java, stream, jax-ws

我在 JAX-WS 中有一个 Java Web 服务，它从另一个方法返回一个 OutputStream。我似乎无法弄清楚如何将 OutputStream 流式传输到返回的 DataHandler 中，而不是创建一个临时文件，写入它，然后将其作为 InputStream 再次打开。这是一个例子：

```
@MTOM
@WebService
class Example {
    @WebMethod
    public @XmlMimeType("application/octet-stream") DataHandler service() {
        // Create a temporary file to write to
        File fTemp = File.createTempFile("my", "tmp");
        OutputStream out = new FileOutputStream(fTemp);

        // Method takes an output stream and writes to it
        writeToOut(out);
        out.close();

        // Create a data source and data handler based on that temporary file
        DataSource ds = new FileDataSource(fTemp);
        DataHandler dh = new DataHandler(ds);
        return dh;
    }
} 
```

主要问题是 writeToOut() 方法可以返回远大于计算机内存的数据。这就是该方法首先使用 MTOM 的原因 - 流式传输数据。我似乎无法理解如何直接从我需要提供给返回的 DataHandler（以及最终接收 StreamingDataHandler 的客户端）的 OutputStream 流式传输数据。

我尝试过使用 PipedInputStream 和 PipedOutputStream，但这些似乎并不是我所需要的，因为在写入 PipedOutputStream 之后需要返回 DataHandler。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T20:28:17.533

我按照 Christian 所说的思路找到了答案（创建一个新线程来执行 writeToOut()）：

```
@MTOM
@WebService
class Example {
    @WebMethod
    public @XmlMimeType("application/octet-stream") DataHandler service() {
        // Create piped output stream, wrap it in a final array so that the
        // OutputStream doesn't need to be finalized before sending to new Thread.
        PipedOutputStream out = new PipedOutputStream();
        InputStream in = new PipedInputStream(out);
        final Object[] args = { out };

        // Create a new thread which writes to out.
        new Thread(
            new Runnable(){
                public void run() {
                    writeToOut(args);
                    ((OutputStream)args[0]).close();
                }
            }
        ).start();

        // Return the InputStream to the client.
        DataSource ds = new ByteArrayDataSource(in, "application/octet-stream");
        DataHandler dh = new DataHandler(ds);
        return dh;
    }
} 
```

由于变量，它有点复杂`final`，但据我所知这是正确的。当线程启动时，它会在它第一次尝试调用时阻塞`out.write()`；同时，输入流返回给客户端，客户端通过读取数据来解除阻塞。（我之前实现此解决方案的问题是我没有正确关闭流，因此遇到了错误。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T23:27:34.257

抱歉，我只为 C# 而不是 java 这样做，但我认为你的方法应该启动一个线程来运行“writeToOut(out);” 平行。您需要创建一个特殊的流并将其传递给新线程，该线程将该流提供给 writeToOut。启动线程后，您将该流对象返回给调用者。

如果您只有一个写入流并随后返回的方法，以及另一个使用流并随后返回的方法，则没有其他方法。

当然，棘手的部分是掌握这样的多线程安全流：如果内部缓冲区太满，它将阻塞每一端。

不知道 Java-pipe-stream 是否适用于此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T22:38:55.060

包装模式？:-)。

自定义 javax.activation.DataSource 实现（只有 4 个方法）能够做到这一点？

```
return new DataHandler(new DataSource() { 
  // implement getOutputStream to return the stream used inside writeToOut() 
  ... 
}); 
```

我没有可用的 IDE 来测试这个，所以我只是在做一个建议。我还需要 writeToOut 一般布局:-)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-11T17:10:30.877

在我的应用程序中，我使用 InputStreamDataSource 实现，它将 InputStream 作为构造函数参数，而不是 FileDataSource 中的 File。到目前为止它有效。

```
public class InputStreamDataSource implements DataSource {

ByteArrayOutputStream buffer = new ByteArrayOutputStream();
private final String name;

public InputStreamDataSource(InputStream inputStream, String name) {
    this.name = name;
    try {
        int nRead;
        byte[] data = new byte[16384];
        while ((nRead = inputStream.read(data, 0, data.length)) != -1) {
            buffer.write(data, 0, nRead);
        }

        buffer.flush();
        inputStream.close();
    } catch (IOException e) {
        e.printStackTrace();
    }

}

@Override
public String getContentType() {
    return new MimetypesFileTypeMap().getContentType(name);
}

@Override
public InputStream getInputStream() throws IOException {
    return new ByteArrayInputStream(buffer.toByteArray());
}

@Override
public String getName() {
    return name;
}

@Override
public OutputStream getOutputStream() throws IOException {
    throw new IOException("Read-only data");
} 
```

}

# macos - 如何以编程方式获取 Mac OS X 保留的快捷键

> ID：866056
> 
> 赞同：5
> 
> 时间：2009-05-14T21:55:41.513
> 
> 标签：macos, macos-carbon

我正在使用一个允许客户自定义分配的快捷键的应用程序。我想做的一件事是警告是否选择了 Mac OS X 已经在使用的快捷键。

我正在尝试使用 CopySymbolicHotKeys，但我不确定我是否正确使用它，因为它列出了保留的命令，即使我没有在“键盘”的“键盘快捷方式”选项卡窗格中看到它和鼠标”系统偏好设置。我希望能够获得那些“保留”以供系统使用的快捷方式，这是要使用的 API 吗？

我在下面包含了我的代码示例，请查看它以提供您可能想到的任何建议。

```
CFArrayRef hotkeyArray = NULL;
OSStatus status = CopySymbolicHotKeys(&hotkeyArray);

if (noErr == status && NULL != hotkeyArray) {

    CFIndex hotKeyCount = CFArrayGetCount(hotkeyArray);

    for (CFIndex i = 0; i < hotKeyCount; i++) {
        CFDictionaryRef hotKeyDict = (CFDictionaryRef) CFArrayGetValueAtIndex(hotkeyArray, i);
        if (hotKeyDict && CFGetTypeID(hotKeyDict) == CFDictionaryGetTypeID()) {
            if (kCFBooleanTrue == (CFBooleanRef) CFDictionaryGetValue(hotKeyDict, kHISymbolicHotKeyEnabled)) {

                SInt32 keyModifiers = 0;

                CFNumberRef cfkeyModifers = (CFNumberRef) CFDictionaryGetValue(hotKeyDict, kHISymbolicHotKeyModifiers);
                CFNumberGetValue(cfkeyModifers, kCFNumberSInt32Type, &keyModifiers);

                bool keyIsCommandOnly = (keyModifiers == (keyModifiers & cmdKey));
                bool keyIsCommandAndOption = (keyModifiers == (keyModifiers & (cmdKey | optionKey)));

                CFNumberRef cfKeyCode = (CFNumberRef) CFDictionaryGetValue(hotKeyDict, kHISymbolicHotKeyCode);

                short keyCode = 0;
                CFNumberGetValue(cfKeyCode, kCFNumberShortType, &keyCode);

                CFStringRef keyString = CFStringCreateWithFormat(kCFAllocatorDefault, NULL, CFSTR("%C"), keyCode);

                const char* commandOnlyStr = "Command";
                const char* commandAndOptionStr = "Command-Option";
                const char* otherStr = "Other Modifier Key";

                char* modifierStr = otherStr;

                if (keyIsCommandOnly) {
                    modifierStr = commandOnlyStr;
                }
                else if (keyIsCommandAndOption) {
                    modifierStr = commandAndOptionStr;
                }

                CFStringRef debugString = CFStringCreateWithFormat(kCFAllocatorDefault, NULL, CFSTR("Mac OS X Reserved Key: %s %@"), modifierStr, keyString);
                CFShow(debugString); // Command-O, Command-W and other apparently non-reserved keys are output
                CFRelease(debugString);
                CFRelease(keyString);
            }
        }
    }
}
CFRelease(hotkeyArray); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2016-09-05T17:05:49.383

我想添加有助于以`~/Library/Preferences/com.apple.symbolichotkeys.plist`Lyndsey Ferguson 所代表的方式读取/写入文件的代码，`CFPreferencesCopyAppValue()`而不是`CFDictionaryGetValueIfPresent()`from `CFPropertyListRef`。关键是要知道哪个符号热键标识符与键盘快捷键首选项窗格中的哪个热键相关。这是带有描述性常量的代码，可以帮助您解决这个问题：

```
/**
 * Apple Symbolic HotKeys Ids
 * To find this symbolic hot keys indices do:
 * 1\. open Terminal
 * 2\. restore defaults in System Preferences > Keyboard > Shortcuts
 * 3\. defaults read com.apple.symbolichotkeys > current.txt
 * 4\. enable/disable given symbolic hot key in System Preferences > Keyboard > Shortcuts
 * 5\. defaults read com.apple.symbolichotkeys | diff -C 5 current.txt -
 * 6\. restore defaults in System Preferences > Keyboard > Shortcuts
 */
enum {
    kSHKMoveFocusToTheMenuBar                   = 7,    // Ctrl, F2
    kSHKMoveFocusToTheDock                      = 8,    // Ctrl, F3
    kSHKMoveFocusToActiveOrNextWindow           = 9,    // Ctrl, F4
    kSHKMoveFocusToTheWindowToolbar             = 10,   // Ctrl, F5
    kSHKMoveFocusToTheFloatingWindow            = 11,   // Ctrl, F6
    kSHKTurnKeyboardAccessOnOrOff               = 12,   // Ctrl, F1
    kSHKChangeTheWayTabMovesFocus               = 13,   // Ctrl, F7
    kSHKTurnZoomOnOrOff                         = 15,   // Opt, Cmd, 8
    kSHKZoomIn                                  = 17,   // Opt, Cmd, =
    kSHKZoomOut                                 = 19,   // Opt, Cmd, -
    kSHKInvertColors                            = 21,   // Ctrl, Opt, Cmd, 8
    kSHKTurnImageSmoothingOnOrOff               = 23,   // Opt, Cmd, Backslash "\"
    kSHKIncreaseContrast                        = 25,   // Ctrl, Opt, Cmd, .
    kSHKDecreaseContrast                        = 26,   // Ctrl, Opt, Cmd, ,
    kSHKMoveFocusToNextWindow                   = 27,   // Cmd, `
    kSHKSavePictureOfScreenAsAFile              = 28,   // Shift, Cmd, 3
    kSHKCopyPictureOfScreenToTheClipboard       = 29,   // Ctrl, Shift, Cmd, 3
    kSHKSavePictureOfSelectedAreaAsAFile        = 30,   // Shift, Cmd, 4
    kSHKCopyPictureOfSelectedAreaToTheClipboard = 31,   // Ctrl, Shift, Cmd, 4
    kSHKMissionControl                          = 32,   // Ctrl, Arrow Up
    kSHKApplicationWindows                      = 33,   // Ctrl, Arrow Down
    kSHKShowDesktop                             = 36,   // F11
    kSHKMoveFocusToTheWindowDrawer              = 51,   // Opt, Cmd, `
    kSHKTurnDockHidingOnOrOff                   = 52,   // Opt, Cmd, D
    kSHKMoveFocusToStatusMenus                  = 57,   // Ctrl, F8
    kSHKTurnVoiceOverOnOrOff                    = 59,   // Cmd, F5
    kSHKSelectThePreviousInputSource            = 60,   // Ctrl, Space bar
    kSHKSelectNextSourceInInputMenu             = 61,   // Ctrl, Opt, Space bar
    kSHKShowDashboard                           = 62,   // F12
    kSHKShowSpotlightSearch                     = 64,   // Cmd, Space bar
    kSHKShowFinderSearchWindow                  = 65,   // Opt, Cmd, Space bar
    kSHKLookUpInDictionary                      = 70,   // Shift, Cmd, E
    kSHKHideAndShowFrontRow                     = 73,   // Cmd, Esc
    kSHKActivateSpaces                          = 75,   // F8
    kSHKMoveLeftASpace                          = 79,   // Ctrl, Arrow Left
    kSHKMoveRightASpace                         = 81,   // Ctrl, Arrow Right
    kSHKShowHelpMenu                            = 98,   // Shift, Cmd, /
    kSHKSwitchToDesktop1                        = 118,  // Ctrl, 1
    kSHKSwitchToDesktop2                        = 119,  // Ctrl, 2
    kSHKSwitchToDesktop3                        = 120,  // Ctrl, 3
    kSHKSwitchToDesktop4                        = 121,  // Ctrl, 4
    kSHKShowLaunchpad                           = 160,  //
    kSHKShowAccessibilityControls               = 162,  // Opt, Cmd, F5
    kSHKShowNotificationCenter                  = 163,  //
    kSHKTurnDoNotDisturbOnOrOff                 = 175,  //
    kSHKTurnFocusFollowingOnOrOff               = 179,  //
};

struct symbolic_hot_keys {
    int shk_id;                 // symbolic hot keys identifier
    int enabled;
    char *type;                 // usually "standard"
    int64_t ASCII_code;             // ASCII code of the character or 65535 (0xFFFF) for non-ASCII characters
    int64_t virtual_key_code;       // virtual key code for the character
    int64_t modifier_keys_flags;    // the sum of modifier key flags: Shift 17 bit, Ctrl 18 bit, Opt 19 bit, Cmd 20 bit
};
typedef struct symbolic_hot_keys symbolic_hot_keys_t;

// simple mapping of modifier flags
enum {
    kMFShift    = kCGEventFlagMaskShift,
    kMFControl  = kCGEventFlagMaskControl,
    kMFOption   = kCGEventFlagMaskAlternate,
    kMFCommand  = kCGEventFlagMaskCommand,
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T19:46:23.173

我不认为这是可能的。

此[链接](https://stackoverflow.com/questions/823705/programatically-get-set-mac-osx-default-system-keyboard-shortcut)也讨论了使用 CopySymbolicHotKeys。但是，该函数会列出键盘快捷键的系统偏好设置中未列出的键盘快捷键。如果有办法区分*实际*保留的密钥和标准密钥，那将是理想的。

最好的答案似乎是解析我在 Apple 的 Carbon 电子邮件讨论列表中找到的实际 plist 文件“com.apple.symbolichotkeys.plist”。但是，此答案假定您知道每个键是什么（我不知道）。

我还找到了一个描述修饰键值的[链接。](http://www.xlr8yourmac.com/tips/remap_function_keys.html)

这是为禁用系统快捷键首选项中的*已知键而发布的代码：*

```
#include <CoreServices/CoreServices.h>

static CFStringRef gApplicationID = CFSTR("com.apple.symbolichotkeys");

static CFStringRef gKeyASHK =       CFSTR("AppleSymbolicHotKeys");
static CFStringRef gKey73 =         CFSTR("73");
static CFStringRef gKeyEnabled =    CFSTR("enabled");

int main(int argc, const char *argv[]) {
    #pragma unused (argc, argv)

    CFPropertyListRef hotkeysCFPropertyListRef = CFPreferencesCopyAppValue(gKeyASHK, gApplicationID);
    if ( !hotkeysCFPropertyListRef ) {
        fprintf(stderr,
                "%s, CFPreferencesCopyAppValue(\"AppleSymbolicHotKeys\", \"com.apple.symbolichotkeys.plist\" returned NULL.\n",
                __PRETTY_FUNCTION__);
        return (-1);
    }
    // make sure it's a dictionary
    if ( CFGetTypeID(hotkeysCFPropertyListRef) != CFDictionaryGetTypeID() ) {
        fprintf(stderr, "%s, CFGetTypeID(hotkeysCFPropertyListRef) != CFDictionaryGetTypeID().\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // get the "73" value from that dictionary
    CFPropertyListRef hotkey73CFPropertyListRef = NULL;
    if ( !CFDictionaryGetValueIfPresent(hotkeysCFPropertyListRef, gKey73, &hotkey73CFPropertyListRef) ) {
        fprintf(stderr, "%s, CFDictionaryGetValueIfPresent(...,\"73\",...) returned FALSE.\n", __PRETTY_FUNCTION__);
        return (-1);
    }
    //CFShow(hotkey73CFPropertyListRef);
    // make sure it's a dictionary
    if ( CFGetTypeID(hotkey73CFPropertyListRef) != CFDictionaryGetTypeID() ) {
        fprintf(stderr, "%s, CFGetTypeID(hotkey73CFPropertyListRef) != CFDictionaryGetTypeID().\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // get the "73" value from that dictionary
    CFPropertyListRef hotkey73EnabledCFPropertyListRef = NULL;
    if ( !CFDictionaryGetValueIfPresent(hotkey73CFPropertyListRef, gKeyEnabled, &hotkey73EnabledCFPropertyListRef) ) {
        fprintf(stderr, "%s, CFDictionaryGetValueIfPresent(...,\"enabled\",...) returned FALSE.\n", __PRETTY_FUNCTION__);
        return (-1);
    }
    //CFShow(hotkey73EnabledCFPropertyListRef);
    // make sure it's a boolean
    if ( CFGetTypeID(hotkey73EnabledCFPropertyListRef) != CFBooleanGetTypeID() ) {
        fprintf(stderr, "%s, CFGetTypeID(hotkey73EnabledCFPropertyListRef) != CFBooleanGetTypeID().\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // get its value
    Boolean value = CFBooleanGetValue(hotkey73EnabledCFPropertyListRef);

    CFBooleanRef hotkey73EnabledCFBooleanRef = value ? kCFBooleanFalse : kCFBooleanTrue;    // note: toggle value

    // create a mutable copy of the hot key 73 dictionary
    CFMutableDictionaryRef newHotkey73CFCFMutableDictionaryRef = CFDictionaryCreateMutableCopy(kCFAllocatorDefault, 0,  hotkey73CFPropertyListRef);
    if ( !newHotkey73CFCFMutableDictionaryRef ) {
        fprintf(stderr, "%s, CFDictionaryCreateMutableCopy(..., hotkey73CFPropertyListRef) returned NULL.\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // set the new value for the "enabled" item
    CFDictionarySetValue(newHotkey73CFCFMutableDictionaryRef, gKeyEnabled, hotkey73EnabledCFBooleanRef);
    //CFShow(newHotkey73CFCFMutableDictionaryRef);

    // create a mutable copy of the hot key dictionary
    CFMutableDictionaryRef newHotkeysCFPropertyListRef = CFDictionaryCreateMutableCopy(kCFAllocatorDefault, 0, hotkeysCFPropertyListRef);
    if ( !newHotkeysCFPropertyListRef ) {
        fprintf(stderr, "%s, CFDictionaryCreateMutableCopy(...,hotkeysCFPropertyListRef) returned NULL.\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // set the new value for the "73" item
    CFDictionarySetValue(newHotkeysCFPropertyListRef, gKey73, newHotkey73CFCFMutableDictionaryRef);
    CFRelease(newHotkey73CFCFMutableDictionaryRef);
    //CFShow(newHotkeysCFPropertyListRef);

    CFPreferencesSetAppValue(gKeyASHK, newHotkeysCFPropertyListRef, gApplicationID);
    if ( !CFPreferencesAppSynchronize(gApplicationID) ) {
        fprintf(stderr, "%s, CFPreferencesAppSynchronize returned false.\n", __PRETTY_FUNCTION__);
        return (-1);
    }

    // note: value is opposite of what we just set (so invert logic)
    printf("%s, /AppleSymbolicHotKeys/73/enabled set to %s.\n", __PRETTY_FUNCTION__, value ? "FALSE" : "TRUE");

    return (0);
} // main 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-18T13:21:26.807

我不知道如何以编程方式执行此操作，但如果可以选择硬编码，您将在此处找到 MacOSX 快捷方式列表：http: [//support.apple.com/kb/HT1343](http://support.apple.com/kb/HT1343)。我会使用正则表达式来吸出组合键，然后以编程方式转换为键符/键码。该页面似乎由 Apple 针对每个 OSX 版本进行更新，因此您应该能够轻松地在每次 OSX 更新时重复该过程。

# sql - oracle 对象和集合

> ID：866060
> 
> 赞同：2
> 
> 时间：2009-05-14T21:57:01.963
> 
> 标签：sql, oracle

只是想知道是否有人真的在 Oracle 中使用对象和集合？这是应该避免的吗？

例如

```
create type t_person as object (
  id integer,
  first_name varchar2(30),
  last_name varchar2(30)
); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T06:50:23.227

如果您认真地从事 PL/SQL 编程，那么您几乎无法离开集合和对象。也就是说，我保持我的数据库表“干净”，即所有列都包含原子值，没有嵌套表等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T22:08:03.717

我敢肯定很多程序员都在使用这样的扩展。就我个人而言，我在使用关系数据库时尽量坚持“合理标准的 SQL”核心，因为经常发生我需要将我的 SQL 代码移植到其他数据库引擎的情况，如果我大肆使用专有扩展端口变得更加困难（而专有扩展通常会增加很少的功能或速度）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:38:50.220

我使用简单的集合 [即 VARCHAR2(4000) 表]，但仅用于“工作”。我实际上并没有创建任何非 Oracle 类型的表。我使用 Oracle 提供的对象（例如 MDSYS.SDO_GEOM）来获取地理信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T05:49:58.800

我避免使用它们是因为对象不能很好地与关系模型配合使用。如果你两者都有，你往往不会得到两者的力量。这就是为什么对象-关系映射对于项目来说如此重要的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T07:10:09.763

是的，我们使用集合作为存储过程的参数。这样就可以在不使用临时表的情况下选择具有特定 id 的所有记录（通常称为*list 中的变量）。*

例如：

```
create or replace type numbertype
as object(nr number(20,10) )
/ 

create or replace type number_table
as table of numbertype
/ 

create or replace 
procedure tableselect(p_numbers in number_table, p_ref_result out sys_refcursor)
is
begin  
   open p_ref_result for    
      select *    
      from employees 
      ,    (select /*+ cardinality(tab 10) */ tab.nr 
            from table(p_numbers) tab) tbnrs       
      where id = tbnrs.nr; 
end; 
/ 
```

您还可以将此技术与多列对象一起使用。

# sql - 条件唯一约束

> ID：866061
> 
> 赞同：102
> 
> 时间：2009-05-14T21:57:06.520
> 
> 标签：sql, sql-server, sql-server-2005

我有一种情况，我需要对一组列强制执行唯一约束，但仅针对列的一个值。

例如，我有一个像 Table(ID, Name, RecordStatus) 这样的表。

RecordStatus 只能有值 1 或 2（活动或已删除），并且我只想在 RecordStatus = 1 时对（ID，RecordStatus）创建唯一约束，因为我不在乎是否有多个删除的记录相同ID。

除了写触发器，我可以这样做吗？

我正在使用 SQL Server 2005。

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2011-03-01T00:37:04.710

看哪，[过滤后的索引](http://technet.microsoft.com/en-us/library/cc280372.aspx)。从文档（强调我的）：

> 过滤索引是一种优化的非聚集索引，特别适用于覆盖从明确定义的数据子集中进行选择的查询。**它使用过滤谓词来索引表中的部分行。**与全表索引相比，设计良好的过滤索引可以提高查询性能，降低索引维护和存储成本。

这是一个将唯一索引与过滤谓词相结合的示例：

```
create **unique** index MyIndex
on MyTable(ID)
**where RecordStatus = 1;**
```

这实质上强制了`ID`when `RecordStatus`is的唯一性`1`。

创建该索引后，违反唯一性将引发错误：

> 消息 2601，级别 14，状态 1，第 13
> 行无法在具有唯一索引“MyIndex”的对象“dbo.MyTable”中插入重复的键行。重复键值为 (9999)。

[注意：过滤索引是在 SQL Server 2008 中引入的。对于 SQL Server 的早期版本，请参阅[此答案](https://stackoverflow.com/a/866100/621962)。]

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-05-14T22:06:04.080

添加这样的检查约束。不同之处在于，如果 Status = 1 且 Count > 0，您将返回 false。

[http://msdn.microsoft.com/en-us/library/ms188258.aspx](http://msdn.microsoft.com/en-us/library/ms188258.aspx)

```
CREATE TABLE CheckConstraint
(
  Id TINYINT,
  Name VARCHAR(50),
  RecordStatus TINYINT
)
GO

CREATE FUNCTION CheckActiveCount(
  @Id INT
) RETURNS INT AS BEGIN

  DECLARE @ret INT;
  SELECT @ret = COUNT(*) FROM CheckConstraint WHERE Id = @Id AND RecordStatus = 1;
  RETURN @ret;

END;
GO

ALTER TABLE CheckConstraint
  ADD CONSTRAINT CheckActiveCountConstraint CHECK (NOT (dbo.CheckActiveCount(Id) > 1 AND RecordStatus = 1));

INSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);
INSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);
INSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);
INSERT INTO CheckConstraint VALUES (1, 'No Problems', 1);

INSERT INTO CheckConstraint VALUES (2, 'Oh no!', 1);
INSERT INTO CheckConstraint VALUES (2, 'Oh no!', 2);
-- Msg 547, Level 16, State 0, Line 14
-- The INSERT statement conflicted with the CHECK constraint "CheckActiveCountConstraint". The conflict occurred in database "TestSchema", table "dbo.CheckConstraint".
INSERT INTO CheckConstraint VALUES (2, 'Oh no!', 1);

SELECT * FROM CheckConstraint;
-- Id   Name         RecordStatus
-- ---- ------------ ------------
-- 1    No Problems  2
-- 1    No Problems  2
-- 1    No Problems  2
-- 1    No Problems  1
-- 2    Oh no!       1
-- 2    Oh no!       2

ALTER TABLE CheckConstraint
  DROP CONSTRAINT CheckActiveCountConstraint;

DROP FUNCTION CheckActiveCount;
DROP TABLE CheckConstraint; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-14T22:01:58.160

您可以将已删除的记录移动到缺少约束的表中，并且可能使用两个表的 UNION 视图来保留单个表的外观。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-14T22:43:29.857

你可以用一种非常hacky的方式来做到这一点......

在您的表上创建一个模式绑定视图。

CREATE VIEW 无论 SELECT * FROM Table WHERE RecordStatus = 1

现在使用您想要的字段在视图上创建一个唯一约束。

但是，关于模式绑定视图的一个注意事项是，如果您更改基础表，则必须重新创建视图。因此有很多陷阱。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T21:59:14.470

因为，您将允许重复，唯一约束将不起作用。您可以为 RecordStatus 列创建一个检查约束，为 INSERT 创建一个存储过程，在插入重复 ID 之前检查现有的活动记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-14T22:48:37.893

如果您不能按照 Bill 的建议使用 NULL 作为 RecordStatus，您可以将他的想法与基于函数的索引结合起来。如果 RecordStatus 不是您要在约束中考虑的值之一（否则为 RecordStatus），则创建一个返回 NULL 的函数，并在其上创建索引。

这样做的好处是您不必在约束中显式检查表中的其他行，这可能会导致性能问题。

我应该说我根本不了解 SQL Server，但我已经在 Oracle 中成功使用了这种方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-02T16:17:56.140

对于那些仍在寻找解决方案的人，我遇到了一个很好的[答案](https://stackoverflow.com/a/43108142/3740284)，类似的问题，我认为这对许多人来说仍然有用。虽然将已删除的记录移动到另一个表可能是一个更好的解决方案，但对于那些不想移动记录的人可以使用链接答案中的想法，如下所示。

*   当记录可用/活动时设置 deleted=0。
*   将行标记为已删除时，设置 deleted=<row_id or some other unique value>。

# c# - NullReferenceException 未处理，对象引用未设置为对象的实例

> ID：866070
> 
> 赞同：3
> 
> 时间：2009-05-14T22:00:24.827
> 
> 标签：c#, exception, reference, null, instance

每当我运行我的程序时，我都会得到： NullReferenceException 未处理，对象引用未设置为对象的实例。

当我启动程序时，我会出现一个名为 MaxScore 的表单，用户在其中输入最高分数并按 OK。在 OK 事件中，我从 MainForm 调用一个方法来更新 MainForm 上的 maxGameCountLabel，并将输入的最大分数值作为参数。

当我按下确定时，我得到 NullReferenceException

```
myGameCountLbl.Text = maxGames.ToString(); 
```

我的 maxGameCountLblUpdate 方法。

这是位于 MainForm 中的 maxGameCountLblUpdate 方法代码：

```
//Update game count label 
public void maxGameCountLblUpdate(decimal maxGames)
{
    maxGames = decimal.ToInt32(maxGames);
    myGameCountLbl.Text = maxGames.ToString();
    compGameCountLbl.Text = maxGames.ToString();
} 
```

这是我在 MaxScore 上的 OK Button 事件：

```
private void okBtn_Click(object sender, EventArgs e)
{
    MainForm.maxGameCountLblUpdate(max);
} 
```

注意，我已经设置

```
public Form1 MainForm { get; set; } 
```

在 MaxScore

我在 MainForm 中创建 MaxScore：

```
 using (MaxScore scoreForm = new MaxScore())
    {
        scoreForm.MainForm = this;
        scoreForm.ShowDialog();
    } 
```

我无法让它工作..我尝试了很多东西..谢谢！

编辑：在 myGameCountLbl.Text = maxGames.ToString(); 添加断点后 myGameCountLbl 似乎出现为空......我很抱歉成为新手......我该如何解决这个问题？maxGames 确实是 1，所以这不是问题

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T22:03:47.703

好吧，如果这是导致问题的行：

```
myGameCountLbl.Text = maxGames.ToString(); 
```

然后要么`myGameCountLbl`为空，要么`maxGames`为。鉴于这`maxGames`是一个小数，这表明它`myGameCountLbl`是空的。

当您对此进行调试并在适当的行上放置断点时会发生什么？那是为了`myGameCountLbl`什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T22:35:48.377

您是否从构造函数中删除了：`InitializeComponent();`？

如果您使用设计器构建表单 UI，Visual Studio 会在后台 (Class.designer.cs) 构建一个方法来初始化控件。如果您在访问 UI 元素之前没有调用`InitializeComponent()`，您将收到 NullReferenceException。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T22:16:51.340

您还可以让 Visual Studio 中断所有异常，或中断所有 NullReferenceException，然后您可以检查发生了什么。

（调试 -> 异常 -> 公共语言运行时异常 ...）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:06:49.133

为什么不在该行中放置一个断点并调试两个对象的当前状态？麦克斯从哪里来？

MainForm.maxGameCountLblUpdate(max);

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-19T14:02:04.030

我知道这是很久以前发布的，但我遇到了同样的问题，这就是我解决它的方法。

如果您查看提供的故障排除提示，第二个建议是：

> 在调用方法之前检查确定对象是否为空。

这实际上是解决方案。使用 IF 语句检查要分配的值是否不为空，例如：

```
if (maxGames!=null){
      myGameCountLbl.Text = maxGames.ToString();
} 
```

这将确保您避免将 null 值分配给 myGameCounLbl

我希望这会有所帮助

# javascript - 获取页面的全部内容？

> ID：866073
> 
> 赞同：5
> 
> 时间：2009-05-14T22:00:53.030
> 
> 标签：javascript, html

那么是否有可能在当前状态下捕获页面的全部内容。例如，如果通过 jquery 与页面交互，我通过插入内容或添加或删除类名来修改文档。是否可以从开始 html 标记到 html 标记以当前形式获取此文档的标记？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-14T22:07:56.213

就像是

```
document.documentElement.innerHTML 
```

这不包括 <html> 开始和结束标签

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-14T22:02:36.367

难道你不能只获取 DOM 中的根对象并调用 innerHTML 来获取它吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-14T22:19:30.707

只需使用 jquery 调用 $('html').html() 来获取页面源。

```
<html>
<head>
    <title>Just a test</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
            $('#showContent').click(function(event){
                event.preventDefault();
                var pageSource = '<html>' + $('html').html() +'</html>';
                alert(pageSource);
            });
    });
    </script>
</head>
<body>
    <a href="#" id="showContent" >show content</a>
</body>
</html> 
```

# cocoa - 调用另一个程序的函数？

> ID：866094
> 
> 赞同：4
> 
> 时间：2009-05-14T22:04:46.920
> 
> 标签：cocoa, macos, scripting

所以我有这个我非常喜欢的程序，它不支持 Applescript。我想自动化一点。现在，我知道我可以使用 applescript 告诉程序告诉菜单告诉子菜单告诉菜单项激活或其他什么，但坦率地说，我不太喜欢 applescript。

当我在 IB 中打开 NIB 文件时，我可以看到正在发送到 FirstResponder 的消息；例如，复制菜单项发送“ `copy:`”。我有什么办法可以直接从另一个程序调用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T23:32:39.520

不，它被称为受保护的内存是有原因的，你知道的。另一个程序与您的应用程序完全隔离。有很多方法可以将代码放入其他应用程序中，但是 (a) 非常不可取 (b) 需要 root 权限，这意味着您的应用程序的其余部分需要坚如磐石，并且 (c) 编写这样的代码是一种黑艺术需要了解操作系统内核接口、虚拟内存管理、ABI、链接器/加载器的内部结构、汇编器编程以及运行您的应用程序的特定处理器的操作参数和其他细节。

确实，AppleEvents 和其他此类 IPC 机制的存在是有原因的。

您的其他选择（老实说，所有这些都有点老套，并且给您确保目标应用程序处于您想要/期望的状态的相当大的负担）访问您正在寻找的数据是：

1.  ApplicationServices 框架中的 Accessibility API，通过它您可以遍历 UI 树以直接从任何需要的地方获取文本，或者可以激活菜单项。但是，您的应用程序的访问权限必须由用户明确授予（尽管这与 UI 脚本的要求大致相同）。
2.  您可以使用 CoreGraphics API（再次在 ApplicationServices 框架内）将键盘事件直接发送到目标应用程序（或仅发送到系统）。这意味着发送四个事件：Command-down、C-down、C-up、Command-up。

这些都不是理想的。老实说，您最好的方法是查看您的需求并找出如何通过以某种方式更改这些需求来最好地解决问题，即不是直接抓取某些东西，而是要求用户提供一些输入等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-05T15:13:40.653

You might be interested in [SIMBL](https://github.com/albertz/simbl) or in [mach_inject](https://github.com/rentzsch/mach_star). SIMBL is a daemon (in my fork based on mach_inject, in the original version based on injection via some ScriptingAdditions hack) which does the injection for you, so you just need to put a bundle with your code into the SIMBL directory and SIMBL will inject it for you into the target application. Or you can do so yourself via mach_inject. Or probably more convenient, mach_inject_framework which injects and runs code which just loads some framework.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T07:07:26.460

我认为吉姆可能有点夸大了。他没有错，但似乎具有误导性。有很多方法可以让 Cocoa 程序在你的控制下执行自己的代码（Carbon 更难）。Accessibility API 非常常用这种方式（如此普遍，我希望它最终会被重新利用）。[Fscript](http://www.fscript.org)可以让您对另一个 Cocoa 程序的内部进行各种访问。虽然输入管理器可能会在某个时候退出现场，但[SIMBL](http://www.culater.net/software/SIMBL/SIMBL.php)今天仍然在那里做这类事情。

无论您是否喜欢 Applescript，Apple 事件都是 Apple 提供的程序间控制的主要方式。您是否仔细检查过 Script Editor 的 Open Library 功能，以确定该程序是否真的支持 Applescript？现在，您可以使用 Leopard 的 Scripting Bridge 完全在 Objective-C 中编写 Apple Events 代码。如果你愿意，我写了一个[教程](http://robnapier.net/blog/scripting-bridge-265)（Apple 仍然没有记录它）。

Cocoa 是逆向工程师的梦想。主持 SIMBL 的人[对这个主题有很好的介绍](http://www.culater.net/wiki/moin.cgi/CocoaReverseEngineering)。[《狼》](http://redshed.net)在这方面也写了不少有用的资料。

吉姆是对的。如果操作不当（有时即使操作正确），其中许多方法都会完全破坏系统的稳定性。我不会在我的生产系统上做很多这样的事情。我需要他们工作。但是你可以让 Mac 应用程序做很多事情，这是 Mac 开发人员培训的一个很好的部分，以了解所有部分的真正工作原理。

# javascript - 在网络上报告体面的印刷

> ID：866097
> 
> 赞同：5
> 
> 时间：2009-05-14T22:05:08.277
> 
> 标签：javascript, html, css, printing, report

作为一名网络系统程序员，我想生成一些报告并能够直接从我的用户浏览器将其发送到打印机，这在客户端，不需要生成 PDF 或类似的东西。

我希望能够：

*   打印用户友好的分页，例如“第 1 页，共 3 页”
*   在每一页的底部打印一些东西，比如“Generated in 2009-02-20”
*   *不*打印网址

这一切可能吗？Javascript？CSS？这里有哪些最佳实践？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-14T22:29:20.840

所有这些事情都是通过浏览器偏好来控制的。如果您希望能够指定，那么您可能应该查看 PDF 而不是 HTML。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T22:34:45.180

你在那里使用浏览器不走运......我认为不可能不在角落打印URL，访问日期/时间等。

但是，第 1 页或第 3 页等通常总是打印在某个地方（我相信 FireFox 的右下角）

打印“Generated in 2009-02-20”很容易，但是在每页的底部打印它会很困难。大多数浏览器 IIRC 会在角落显示访问的日期和时间（尽管不是那种格式，而是一种更易于人类阅读的格式）。

您想在打印中出现但不在正常屏幕视图中的任何内容都需要使用打印样式表显示。

对于您想要的（完全控制打印输出），我建议您生成 PDF。也许如果这是一个内部工具，您也许可以为 Firefox 编写一个插件，该插件可以自动打印您的 pdf，但我对 Firefox 插件的功能不太熟悉，因此您需要进行试验。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T22:54:38.267

肯定缺乏来自不同浏览器的支持，但是 css 有一种称为 print 的媒体类型，要使用它，只需在 css 文件或标签中定义一个部分，如下所示：

```
@media print{
/* normal style declarations
 but you probably want to hide menus 
 and other navigation, also use black on white,  etc.
 */
}
@media screen{
/* your current stylesheet */
} 
```

[这篇 List Apart 文章](http://www.alistapart.com/articles/goingtoprint/)涵盖了基础知识。

这是 wc3 规范[的入口点。](http://www.w3.org/TR/CSS2/media.html#media-types)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:59:18.227

您也许可以使用 SQL 报告服务来生成您的报告。虽然它使用自己的客户端打印控件activex，但效果很好。

# ipc - 回复：共享内存和信号量

> ID：866101
> 
> 赞同：0
> 
> 时间：2009-05-14T22:06:38.320
> 
> 标签：ipc, shared-memory, semaphore, duplex

IPC 机制是使用共享内存和信号量来同步单工（如管道）还是双工（如消息队列）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T22:23:08.297

信号量是这样工作的...... proc a：“资源可用吗？” 信号量 = -2 是的。semaphore++ proc b: "Is the resource..." semaphore = -1 Yes. semaphore++ proc c: "is the resource..." semaphore = 0 No. (什么都没有发生)

此时，proc c 可以排队（取决于您的 api，这可能是一个繁忙的循环，也可能是一个回调，或者您可能只是产生一个等待线程并编写自己的回调）

proc a：“我完成了”信号量--；

proc c 会注意到信号量可用，这可能与我之前提到的类似。

我写出所有这些的原因是我可以说，两者兼而有之。它就像一个消息队列，您可以让线程等待资源（由信号量控制的共享内存），当它们获得资源时触发一些操作，甚至是实际的系统消息。或者你可以忙着等待它完成，这就像管道一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T22:29:34.960

如果我对您的问题的理解是正确的，那就是双工。

使用共享内存，两个进程可以双向通信，而不仅仅是一个作为读取器，一个作为写入器。管道只允许读取或写入，但您可以通过使用两个管道来克服这个问题（尽管消息队列是更好的选择）。

# java - 在测试阶段使用替代的 Maven 配置文件

> ID：866102
> 
> 赞同：3
> 
> 时间：2009-05-14T22:06:42.160
> 
> 标签：java, unit-testing, maven-2, appfuse

我正在尝试从 Appfuse Archetype 开始构建一个应用程序，但我遇到了一些奇怪的问题。有一次，我想使用 hsqldb 进行自动化单元测试和集成测试，使用 mysql db 进行手动测试，这样我可以在需要时轻松操作数据，所以在测试期间自动切换配置文件会很好测试阶段。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-14T22:28:40.607

我不确定这是否正是您所要求的，但您可以执行以下操作来为您的 Maven 项目设置多个过滤器。

```
<filters>
  <filter>/your/path/filter-${env}.properties</filter>
</filters> 
```

这样，您可以使用以下方法设置多个配置文件：

```
<profiles>
  <profile>
    <id>local</id>
    <properties>
      <env>local</env>
    </properties>
  </profile>
  <profile>
    <id>test</id>
    <properties>
      <env>test</env>
    </properties>
  </profile>
</profiles> 
```

然后，您可以使用相关的属性文件运行构建：

```
mvn -P <profile id> 
```

这需要有位于以下位置的属性文件：

```
/your/path/filter-local.properties
/your/path/filter-test.properties 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-23T12:28:57.973

不确定这是否对您有帮助，但您可以在 /src/test/resources 文件夹中指定替代资源文件，仅在运行测试时覆盖 /src/main/resources 中的资源文件。

我在这里定义了一个替代的 placeholders.properties 文件来指定测试阶段要使用的另一个数据库连接。

# asp.net - ASP.NET - IIS 自定义映射扩展 - 如何？

> ID：866104
> 
> 赞同：2
> 
> 时间：2009-05-14T22:07:23.607
> 
> 标签：asp.net

我想知道如何将我在 IIS 6.0 页面上自定义开发的 .ASPX 页面创建/重新路由到完全自定义的没有 .aspx 扩展名的东西，比如 .vato？例如，我希望用户看到的不是我的页面：Default.aspx?ID=123，而是：Default.vato?ID=123。

是什么概念？这是可行的吗？我在哪里可以对这个主题进行更多研究？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:10:27.953

是的，读这个：

[http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/4c840252-fab7-427e-a197-7facb6649106.mspx?mfr=true](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/4c840252-fab7-427e-a197-7facb6649106.mspx?mfr=true)

为您的新扩展创建一个新条目并将其映射到与 .aspx 处理程序相同的可执行文件。

常见的一种是添加通配符。这使您可以拥有完全没有扩展名的 URL。IMO，这是更受欢迎的，因为扩展在互联网上几乎没有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T22:22:23.493

这与其说是 .net 问题，不如说是 IIS 问题。

基本上，IIS 会查看请求的扩展名并做出相应的响应。

有一个所有文件扩展名的列表，以及在请求这些扩展名时应采取的措施。在.net 方面，这些是.aspx、.ascx、asmx 等。这些基本上是ISAPI 过滤器。

取决于您的 IIS 版本。如果您打开 IIS 管理器，选择有问题的网站，转到属性，然后是主目录，然后是配置，在映射下，您将看到所有文件扩展名和将被调用以执行此请求的应用程序。

因此，如果您为 .vato 添加一个条目，并将其指向您的 .net 版本，例如 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll，然后将处理 .vato 文件与 .aspx 文件相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T22:12:50.397

在 IIS (6.0) 中，单击网站页面上的“配置”，您可以在那里添加映射。它必须引用与例如 ASPX 页面相同的 ASP.NET ISAPI DLL。

您还可以添加 * 并将所有请求路由到 HTTP 模块，但这对于 REST 之类的更高级和有用。

# .net - Uri.LocalPath 定义用于处理非本地路径是什么？

> ID：866105
> 
> 赞同：1
> 
> 时间：2009-05-14T22:07:43.763
> 
> 标签：.net, uri

[Uri.LocalPath](http://msdn.microsoft.com/en-us/library/system.uri.localpath.aspx)的文档没有说明如果你给它一个非本地路径会发生什么`http://stackoverflow.com/`。有谁知道提供官方规范的来源，说明它如何处理这个问题？

我想知道它可能有什么样的陷阱和极端情况，所以我不能确定我只是尝试一下就做对了。

（或者，是否有人知道检查 Uri 是否是本地的可靠方法？特别是，它是我可以通过文件系统访问的东西）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:14:51.203

您在不是“文件名”的 Uri 上使用它违反了先决条件。因此，正如我所见，它可以返回任何它喜欢的东西。

要查看 Uri 是否为文件名，请使用[Uri.IsFile](http://msdn.microsoft.com/en-us/library/system.uri.isfile.aspx)

# iis - 使用 IIS NLB 时如何将用户请求保持在同一台服务器上？

> ID：866108
> 
> 赞同：9
> 
> 时间：2009-05-14T22:08:35.117
> 
> 标签：iis, session, nlb

我有两个使用 NLB 运行的 IIS 服务器。不幸的是我不能使用共享会话服务器，所以每个服务器都使用自己的会话。如何确保来自同一用户的所有请求都转发到同一 IIS 服务器？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-14T22:40:01.453

发现这个并决定与他人分享：

使用客户端亲和性功能。启用客户端关联后，网络负载平衡将所有 TCP 连接定向到同一群集主机。这允许在主机内存中维护会话状态。您可以在网络负载平衡管理器的添加/编辑端口规则对话框中启用客户端关联。选择 Single 或 Class C affinity 以确保只有一个集群主机将处理属于同一客户端会话的所有连接。如果在集群主机上运行的服务器应用程序维护连接之间的会话状态（例如服务器 cookie），这一点很重要。有关网络负载平衡关联的详细信息，请参阅网络负载平衡管理单元中的帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T22:20:18.383

我认为您正在寻找的是粘性会话。粘性会话是由您的负载均衡器实现的。您可能需要设置一个可以执行粘性会话的外部负载均衡器（BIG-IP、HAProxy 等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T22:29:40.777

只要您的客户不使用分布式代理系统，您就可以轻松做到这一点：

在 NLB 集群的 protieries 中，选项卡“端口规则”您可以选择“过滤模式”和亲和性：您不能选择“无”，因为您没有中央会话。但是，只要 ip 保持不变，“简单”就会将每个用户重定向到同一台服务器。如果您例如 anticiapte AOL 代理服务器，那么“C 类”可能是一个安全的选择（尽管可能会稍微减少负载平衡），因为同一个 C 类网络连接到同一个服务器。

我猜这很容易由 MS 以一种方式实现，即两个主机都知道哪个 ip 是偶数或奇数，或者 C 类网络的哪个三元组是偶数或奇数，并始终根据 IP 地址以相同的方式分配负载

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:11:12.087

你为什么想做这个？如果是因为会话状态，那么您应该在一个公共位置设置一个数据库或进程外服务器，并让所有节点都引用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T22:15:48.487

我会考虑一个位于任一服务器前面的反向代理，并记住哪些外部用户正在使用哪些服务器。

我知道（通过这种方式使用）[Cherokee](http://www.cherokee-project.com/)支持 IPHash 代理，但我相信还有更多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-14T22:17:22.227

只是为了补充劳埃德的答案，无论如何您都应该避免在负载平衡环境中使用会话。使用 session 的全部目的是避免数据库调用；如果您最终将会话数据存储回数据库，您通常一无所获。

原因是 1\. 您现在必须为每个页面加载（检索和存储）进行 2 次数据库调用，以及 2\. 数据现在必须经过序列化/反序列化边界。大多数情况下，这最终是一项比仅检索您想要开始的数据更昂贵的操作。

现在，你的实际问题。您确实可以选择将会话数据存储在视图状态中。或者，您可以放弃会话而使用 cookie。如果你走这条路，一定要在出去的时候加密，在收到的时候解密。

# php - 关于制作在线表格的离线版本的建议？

> ID：866121
> 
> 赞同：2
> 
> 时间：2009-05-14T22:14:47.413
> 
> 标签：php, xml, web-applications, tinymce

我在一个学区工作，那里的老师在线向校长提交他们的教案。

他们使用我使用 PHP/MySQL 编写的在线表单来执行此操作，它使用 TinyMCE 作为其文本区域。要求的主要功能之一是让教师能够将其不完整的表格保存为草稿以供以后提交。这已实施，但我面临的新问题是并非所有教师都可以在家中访问互联网，因此他们无法在家中制定课程计划。

当然，他们可以从保存在笔记本电脑上的 word 文档或文本文件中剪切和粘贴，但是他们必须一次剪切/粘贴一个文本区域，并且他们对此抱怨。

所以我想尝试的是制作一个看起来像在线表单的离线应用程序，但将表单以 xml 格式保存在他们的计算机上。然后他们可以打开这个文件继续处理它，或者稍后将它上传到在线表格。

我的问题是：由于我的编程经验目前仅限于几种与网络相关的语言（php、javascript、html），我应该使用什么来尝试编写这个离线应用程序？温宾德？Adobe 空气？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T22:20:24.997

我认为你最好的办法是让他们在他们的浏览器上安装[Google Gears](http://gears.google.com/)（默认带有 Google Toolbar iirc），这是离线存储内容的理想选择。然后，一旦他们上线，就可以轻松地将存储的内容同步回您的在线服务器。

可以在[此处](http://code.google.com/apis/gears/)找到 Gears API 文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T22:24:04.067

教师目前如何离线制定课程计划？

例如，如果他们以纯文本形式进行操作，也许您可​​以简单地添加一个文件上传字段。他们会上传他们的文件（他们离线工作），你的网络应用程序会解析它并将它分成适当的部分。

（如果需要富文本，他们可以使用 Word 文档。）

为了帮助进行解析，您可以告诉他们使用部分标题——可能是所有大写的特殊词——或者为他们提供一个示例模板（直接映射到 Web 表单）来开始。

这里的想法是，您可能希望尽量减少教师需要做出的改变。他们已经习惯了他们目前正在做的事情，所以要按照他们目前的习惯来工作。这比让他们改变并做一些新的事情要容易。在他们的计算机上安装新的离线应用程序几乎可以肯定是一个重大障碍。

（当我输入这个答案时，Josh Curren 提交了一个类似的答案。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T22:17:21.773

我会将表单保存到他们可以保存到桌面的文本文件中，然后将其上传并稍后将其读入表单中。您必须为他们提供模板，以便他们输入的所有内容都按正确的顺序排列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:21:02.560

一个简单的选择是构建一个常规的桌面应用程序，他们可以在本地安装并随身携带。在应用程序中有一个上传功能，允许他们在连接到互联网时提交它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T22:26:43.297

另一种选择是使用创建表单的可编辑 PDF，然后 a) 将它们作为一个整体提交给主体，或 b) 在服务器端解析出字段数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T22:48:56.027

如果他们在学校和家里都使用 Internet Explorer，您可以在以 Web 存档格式 *.mht 保存的网页中为他们提供表格。他们在家填写表格并以相同的 *.mht 格式保存。当他们回到学校时，他们打开页面并提交。

这应该可以工作并且可能很容易实现。我在这篇文章中尝试过，但在验证码和 openid 登录之间的某个地方遇到了问题。试试你的表格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-11T17:27:14.293

我实际上已经使用 Adob​​e AIR 来执行此操作。使用 AIR，表单看起来几乎与在线使用的表单相同，甚至使用相同的 TinyMCE 库。而且我不需要学太多东西就可以开始，只需要 AIR javascript API。

我还使用 AIR 编写了一些其他应用程序，我喜欢它。

# configuration - 我可以为一个 hgwebdir 提供的所有 Mercurial 存储库全局设置 allow_push 吗？

> ID：866125
> 
> 赞同：1
> 
> 时间：2009-05-14T22:15:18.783
> 
> 标签：configuration, mercurial

我们公司有大量的项目从 VSS 转到 Subversion，现在我想把它们移到 Mercurial。到目前为止，我已经`hgwebdir.cgi`开始工作了（Windows 上的 Apache）。目前我必须添加`allow_push = *`到每个 repo 的 .hg/hgrc 以推动更改。是否可以在服务器上全局设置此选项，这样如果将来进行更改，我们就不必编辑每个存储库？

我已经尝试过`hgweb.config`，`Mecurial.ini`但无济于事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T13:43:33.937

系统默认全局设置存储在`c:\Mercurial\Mecurial.ini` 此文件和目录下不是由 Mercurial 安装程序创建的，因此您必须手动进行。

这也应该在`hgweb.config`1.3 版本中得到支持。

（感谢 freenode#mercurial 上的 djc）

# c# - 如何根据另一个 ObjectDataSource 设置一个 ObjectDataSource 的返回值

> ID：866127
> 
> 赞同：1
> 
> 时间：2009-05-14T22:15:40.920
> 
> 标签：c#, asp.net, objectdatasource

我有两个 Asp.net ListView 控件绑定到两个不同的 ObjectDataSource 控件。每个 ODS 控件引用“MethodA”和“MethodB”。

我希望“MethodA”调用数据库并返回“MethodA”和“MethodB”的数据。

我总是可以让“MethodB”再次调用数据库，但这不会有效。

我不确定实现这一目标的最佳方法。

```
 [DataObjectMethod(DataObjectMethodType.Select)]
    public List<int> MethodA(int input)
    {
        List<int> a = new List<int>();
        List<string> b = new List<string>();
        ///
        /// Make one call to database
        /// returns: List<int> and List<string>
        /// set 'a' and 'b' values.

        return a;
    }
    [DataObjectMethod(DataObjectMethodType.Select)]
    public List<string> MethodB()
    {
        List<string> b = new List<string>();
        ///
        /// When MethodA is called set 'b'
        ///
        return b;
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T22:36:12.667

我认为这不容易。

您可以删除 ObjectDatasource 并自行滚动它或绕过它。

也许在该类中使用 [ThreadLocal] 静态变量并让 MethodA 将值放入该变量中？MethodB 可以读取它。

还有一个

```
 [ThreadLocal]
  private DataSet m_cachedAtoB=null;

  public static void Reset()
  {
     m_cachedAtoB=null;
  } 
```

从页面的开头调用 Reset() 以便 ASP.NET 回收的每个线程不会为下一个请求留下旧的陈旧数据。我有没有提到这是一个黑客？

更好的解决方案：似乎 MethodB 不带参数。因此，无论 MethodB 查询的是什么，让 MethodA 获取它并将其推送到 HttpCache 中。

我所做的是，我的后端将一个相当大（10 个表）的完整数据集返回给包含所有静态数据的网络服务器。在那里我有一堂课，里面也有你的 MehtodA 和 MehtodB 之类的东西。但他们总是获取数据集。GetDataSet() 查询了 cahce，如果它丢失了，则查询 web 服务并将其放入 cahce。我的每个 MethodA 方法都只是使用 LINQ 从大数据集中获取内容。

当然，这只适用于静态数据......

# sql - 在 sql server 数据库中查找可用空间的最佳方法？

> ID：866139
> 
> 赞同：6
> 
> 时间：2009-05-14T22:17:48.170
> 
> 标签：sql, sql-server, sql-server-2005

我希望能够找出我的数据库文件中还剩下多少空间，这样我就可以知道何时增加空间，这样当应用程序运行困难时它就不会这样做。

我希望能够编写脚本，这样我就可以定期在多个数据库中运行它。

我有 SQL Server 2000 和 SQL Server 2005 数据库，但我希望能够在两者上运行相同的脚本。

我可以使用 Management Studio 在 2005 数据库上手动执行此操作，但不能在 2000 数据库上执行此操作。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-14T22:32:45.293

尝试`sp_spaceused`：

> 显示当前数据库中表、索引视图或Service Broker队列的行数、保留的磁盘空间和使用的磁盘空间，或显示整个数据库保留和使用的磁盘空间。

我相信这存在于 SQL Server 2000 中，但我无法证明这一点。它在 2005 年和 2008 年有效。

`sp_helptext`如果您想将其与某些服务器端逻辑联系起来，您可以使用 来查看它。

**编辑**：在下面扩展我的评论，并感谢[http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=82359](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=82359)的原始贡献者，这是一种按文件分解使用情况的方法：

```
select
      name
    , filename
    , convert(decimal(12,2),round(a.size/128.000,2)) as FileSizeMB
    , convert(decimal(12,2),round(fileproperty(a.name,'SpaceUsed')/128.000,2)) as SpaceUsedMB
    , convert(decimal(12,2),round((a.size-fileproperty(a.name,'SpaceUsed'))/128.000,2)) as FreeSpaceMB
from dbo.sysfiles a 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-03-21T06:12:55.973

运行以下命令以了解您的 SQL Server 2000 中当前有多少可用空间：

```
DECLARE @command VARCHAR(5000)   
DECLARE @DBInfo TABLE   
( ServerName VARCHAR(100),   
DatabaseName VARCHAR(100),   
PhysicalFileName NVARCHAR(520),   
FileSizeMB DECIMAL(10,2),   
SpaceUsedMB DECIMAL(10,2),   
FreeSpaceMB DECIMAL(10,2), 
FreeSpacePct varchar(8) 
) 

SELECT @command = 'Use [' + '?' + '] SELECT   
@@servername as ServerName,   
' + '''' + '?' + '''' + ' AS DatabaseName   , filename 
    , convert(decimal(12,2),round(a.size/128.000,2)) as FileSizeMB 
    , convert(decimal(12,2),round(fileproperty(a.name,'+''''+'SpaceUsed'+''''+')/128.000,2)) as SpaceUsedMB 
    , convert(decimal(12,2),round((a.size-fileproperty(a.name,'+''''+'SpaceUsed'+''''+'))/128.000,2)) as FreeSpaceMB, 
    CAST(100 * (CAST (((a.size/128.0 -CAST(FILEPROPERTY(a.name,' + '''' + 'SpaceUsed' + '''' + ' ) AS int)/128.0)/(a.size/128.0)) AS decimal(4,2))) AS varchar(8)) + ' + '''' + '%' + '''' + ' AS FreeSpacePct 
from dbo.sysfiles a' 

INSERT INTO @DBInfo 
EXEC sp_MSForEachDB @command   

SELECT * from @DBInfo 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-11T12:36:04.690

可以运行 SQL 脚本来手动检查可用空间。但是，当没有足够的空间时，最好创建工作并分配警报以自动通知管理员。

我发现的最好的文章 -[使用自定义空间警报管理数据库数据使用](http://www.sqlservercentral.com/articles/alerts/89885/)（需要 SQLServerCentral 登录）即使是没有太多 DBA 经验的支持人员也可以阅读。

您还可以使用类似的文章[Monitor database file sizes with SQL Server Jobs](http://m.techrepublic.com/blog/datacenter/monitor-database-file-sizes-with-sql-server-jobs/296)。

对于手动检查，我更喜欢**sp_SOS**（可以从 [http://searchsqlserver.techtarget.com/tip/Find-size-of-SQL-Server-tables-and-other-objects-with-stored-procedure](http://searchsqlserver.techtarget.com/tip/Find-size-of-SQL-Server-tables-and-other-objects-with-stored-procedure)下载）

```
EXEC dbo.sp_SOS @OrderBy='T' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-20T18:02:19.507

我编辑了 Michael Petrotta 查询以添加可用空间百分比列。

```
SELECT DISTINCT
    SUBSTRING(volume_mount_point, 1, 1) AS volume_mount_point
    ,total_bytes/1024/1024 AS total_MB
    , available_bytes/1024/1024 AS available_MB
    ,((available_bytes/1024*1024) *100/(total_bytes/1024*1024)) as free_percent
FROM
    sys.master_files AS f
CROSS APPLY
    sys.dm_os_volume_stats(f.database_id, f.file_id); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-14T22:21:53.760

对我来说，sql server 总是自动分配更多空间，直到硬盘驱动器已满，所以只需查询硬盘驱动器上的可用空间。

您必须使用哪些设置来增加数据库的“空间”？

# c# - 是否可以在 C# 中为一个类型编写多个迭代器？

> ID：866140
> 
> 赞同：1
> 
> 时间：2009-05-14T22:18:36.700
> 
> 标签：c#, .net, iterator

所以对于像这样的类型：

```
CoolCollection<T> 
```

你可以有：

```
foreach (T item in coolCollection)
{
    ...
}

foreach (CoolNode node in coolCollection)
{
    ...
} 
```

如果这是不可能的，也许像 foreach2 或其他一些迭代方式。很多时候，我真的想要不止一种迭代类型的方法。

编辑：对不起，如果不清楚。基本上 CoolNode 是一个产生 CoolCollection 的节点。CoolNode 有一个名为 value 的属性来返回 T，但我需要另一个迭代器来仅返回 CoolNodes。

EDIT2：我不能做coolCollection.Something 来迭代，因为CoolNodes 是通过一个名为Next 的属性连接的，比如LinkedList。所以我需要实现2个迭代器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T22:23:55.580

只需`CoolCollection<T>`明确实现`IEnumerable<CoolNode<T>>`以及`IEnumerable<T>`. （我猜是真的`CoolNode<T>`，但如果不是，那就把多余的东西`<T>`拿出来。）

这将让您以两种方式进行迭代，尽管您需要一个演员表。

为此，您需要以下内容：

```
class CoolCollection<T> : ICollection<T>, IEnumerable<CoolNode<T>>
{
    IEnumerator<CoolNode<T>> IEnumerable<CoolNode<T>>.GetEnumerator()
    {
        ///...Do work here...
    }

    IEnumerator<T> GetEnumerator()
    {
        ///...Do work here...
    }
} 
```

使用它就像这样：

```
foreach (T item in coolCollection)
{
    ...
}

foreach (CoolNode<T> node in (IEnumerable<CoolNode<T>>)coolCollection)
{
    ...
} 
```

另一种选择是公开“节点”的属性，因此您可以这样做：

```
foreach(var nodes in coolCollection.Nodes)
{ ... } 
```

要实现这一点，您需要稍微改变一下。您需要创建一个实现枚举器的私有类......类似于：

```
class CoolCollection<T> : ICollection<T>
{
    private List<CoolNode<T>> nodes;

    IEnumerable<CoolNode<T>> Nodes
    {
        get 
        {
             foreach(var node in this.nodes) { yield return node; }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T22:25:44.687

如果我正确理解了这个问题...

您可以像其他一些集合对象一样执行此操作：

例如：

```
foreach (int key in IDictionary.Keys)
{

}

foreach (object value in IDictionary.Values)
{

} 
```

但我认为没有办法完全按照你写的方式去做......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T22:23:53.397

不，你不能那样做。您不能重载默认迭代器。

想象一下，如果您可以重载默认迭代器。

这会做什么？`foreach (object o in foo)`，将没有逻辑方法来选择正确的迭代器。

您可以做的是使用名为 ForEach2 的第二种方法，它以不同的方式遍历您的集合。或者你可以显式地实现一个接口。或者你可以使用 Linq 组合来处理这种东西。

从类设计的角度来看：

```
interface IBar {
   IEnumerator<string> GetEnumerator();
}

class Foo : IBar, IEnumerable<int> {

    // Very bad, risky code. Enumerator implementations, should 
    // line up in your class design. 
    public IEnumerator<int> GetEnumerator()
    {
        yield return 1;
        yield return 2;
        yield return 3;
        yield return 4;
    }

    IEnumerator<string> IBar.GetEnumerator()
    {
        yield return "hello";
    }

    // must be IEnumerable if you want to support foreach 
    public IEnumerable<string> AnotherIterator
    { 
        get {
           yield return "hello2";
        }
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        return this.GetEnumerator(); 
    }

} 
```

EachPair 的 LINQ 扩展

```
struct Pair<T> { 
    public T First;
    public T Second;
}

static class LinqExtension {
    public static IEnumerable<Pair<T>> EachPair<T>(this IEnumerable<T> input) {
        T first = default(T);
        bool gotFirst = false;
        foreach (var item in input)
        {
            if (!gotFirst)
            {
                first = item;
                gotFirst = true;
            }
            else {
                yield return new Pair<T>() { First = first, Second = item };
                gotFirst = false;
            }
        } 
    }
} 
```

测试代码：

```
class Program
{
    static void Main(string[] args)
    {
        var foo = new Foo(); 

        foreach (int number in foo)
        {
            Console.WriteLine(number);
        }

        // LINQ composition - a good trick where you want
        //  another way to iterate through the same data 
        foreach (var pair in foo.EachPair())
        {
            Console.WriteLine("got pair {0} {1}", pair.First, pair.Second);
        }

        // This is a bad and dangerous practice. 
        // All default enumerators should be the same, otherwise
        // people will get confused.
        foreach (string str in (IBar)foo)
        {
            Console.WriteLine(str);
        }

        // Another possible way, which can be used to iterate through
        //   a portion of your collection eg. Dictionary.Keys 
        foreach (string str in foo.AnotherIterator)
        {
            Console.WriteLine(str);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:28:26.973

如果 CoolCollection 实现 IEnumerable 你可以写：

```
foreach (var item in coolCollection)
{
    ...
} 
```

或者如果 T 是 CoolNode

```
foreach (CoolNode node in coolCollection)
{
    ...
} 
```

如果您需要以某种方式将每个项目转换为您的类型，您可以使用 Linq Select 运算符：

```
foreach (CoolNode node in coolCollection.Select(item => ConvertToNode(item))
{
    ...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T22:41:58.017

看一下`iterindex`片段。在您的班级中，键入`iterindex`并点击`[TAB]`。它将帮助您实现“命名迭代器和索引器”模式。

结果可以这样使用：

```
foreach (var e in myTree.DepthFirstView) // supports iteration
{
    if (e == myTree.DepthFirstView[2]) // supports indexing
    {
        // ...
    }
} 
```

（我写了这个片段，但我怀疑它从来没有被很好地利用过。曾经。）

# mysql - MySQL：当存储过程参数名称与表列名称相同时

> ID：866144
> 
> 赞同：11
> 
> 时间：2009-05-14T22:19:07.807
> 
> 标签：mysql, stored-procedures, parameters

假设有一个存储过程 SetCustomerName，它有一个输入参数 Name，并且我有一个带有列 Name 的表客户。所以在我的存储过程中，我想设置客户的名字。如果我写

```
UPDATE customers SET Name = Name;
```

这是不正确的，我看到了另外两种方法：

```
UPDATE customers SET Name = `Name`;
UPDATE customers SET customers.Name = Name;
```

第一个有效，但我没有在文档中找到我可以将参数包装在 ` 字符中。还是我在文档中错过了它（在这种情况下感谢链接）。

还有哪些其他方法，这种情况的标准方法是什么？重命名输入参数对我不利（因为如果您知道我的意思，我有自动对象关系映射）。

**更新：**

所以，有一个关于反引号的链接（[http://dev.mysql.com/doc/refman/5.0/en/identifiers.html](http://dev.mysql.com/doc/refman/5.0/en/identifiers.html)）但是它没有足够深入地解释如何使用它们（如何使用它们与参数和列名称）。

还有一件很奇怪的事情（至少对我来说）：你可以用任何一种方式使用反引号：

```
UPDATE customers SET Name = `Name`;
//or
UPDATE customers SET `Name` = Name;
//or even
UPDATE customers SET `Name` = `Name`;
```

他们都以完全相同的方式工作。

你不觉得这很奇怪吗？这种奇怪的行为是否在某处得到了解释？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-03-30T14:12:49.483

区分参数和列（如果两个名称相同）的最简单方法是在列名中添加表名。

```
UPDATE customers SET customers.Name = Name; 
```

甚至您也可以添加数据库前缀，例如

```
UPDATE yourdb.customers SET yourdb.customers.Name = Name; 
```

通过添加数据库名称，您可以从单个存储过程对多个数据库执行操作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-14T22:25:46.917

我认为你的第一个例子实际上是倒退的。如果您尝试将“名称”列设置为“名称”输入参数，我相信它应该是：

```
UPDATE customers SET `Name` = Name; 
```

对于第二个示例，您可以像在所有其他语句中一样设置表别名：

```
UPDATE customers AS c SET c.Name = Name; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T22:23:02.667

此处记录了在 MySQL 查询语法中使用反引号：

[http://dev.mysql.com/doc/refman/5.0/en/identifiers.html](http://dev.mysql.com/doc/refman/5.0/en/identifiers.html)

所以是的，你的第一个例子（使用反引号）是正确的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:24:02.927

这是您要求的链接： [http](http://dev.mysql.com/doc/refman/5.0/en/identifiers.html) ://dev.mysql.com/doc/refman/5.0/en/identifiers.html 反引号在 MySql 中称为“标识符引号”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-03-01T07:09:30.547

不一定正确，但是一种更好的参数/参数管理的公平方法，以及更容易理解的可读性，尤其是在使用 SQL 时；

```
DROP PROCEDURE IF EXISTS spTerminalDataDailyStatistics; DELIMITER $$
CREATE PROCEDURE spTerminalDataDailyStatistics(
    IN TimeFrom DATETIME, 
    IN DayCount INT(10), 
    IN CustomerID BIGINT(20)
) COMMENT 'Daily Terminal data statistics in a date range' BEGIN
    # Validate argument
    SET @TimeFrom := IF(TimeFrom IS NULL, DATE_FORMAT(NOW(), '%Y-%m-01 00:00:00'), TimeFrom);
    SET @DayCount := IF(DayCount IS NULL, 5, DayCount);
    SET @CustomerID := CustomerID;

    # Determine parameter
    SET @TimeTo = DATE_ADD(DATE_ADD(@TimeFrom, INTERVAL @DayCount DAY), INTERVAL -1 SECOND);

    # Do the job
    SELECT          DATE_FORMAT(TD.TerminalDataTime, '%Y-%m-%d') AS DataPeriod, 
                    COUNT(0) AS DataCount, 
                    MIN(TD.TerminalDataTime) AS Earliest, 
                    MAX(TD.TerminalDataTime) AS Latest
    FROM            pnl_terminaldata AS TD
    WHERE           TD.TerminalDataTime BETWEEN @TimeFrom AND @TimeTo
        AND         (@CustomerID IS NULL OR TD.CustomerID = @CustomerID)
    GROUP BY        DataPeriod
    ORDER BY        DataPeriod ASC;
END $$
DELIMITER ;

CALL spTerminalDataDailyStatistics('2021-12-01', 2, 1801); 
```

# c# - LINQ 或 ADO.net 实体框架 - 学习哪个？

> ID：866147
> 
> 赞同：12
> 
> 时间：2009-05-14T22:19:53.297
> 
> 标签：c#, linq, entity-framework, entity

澄清一下：我正在浏览 Julia Lerman 在实体框架上的 Oreilly 标题，我非常困惑。

我有 Charlie Calvert 的基本 LINQ，但是从我与 Lerman 的书的 10 分钟会话中，可以看出 LINQ 是 LINQ to SQL，它的 DataContext 对象等似乎功能不足......

虽然 Entity Framework 是未来，但它有一个叫做 Entity SQL 的东西，在我看来它看起来与 Transact-SQL 完全一样。现在我的眼睛可能有点生锈了，但问题是：

既然 Entity Framework 是微软支持的主力，那么用它来学习 LINQ to SQL 有什么意义吗？

```
 var numberGroups =
            from n in numbers
            group n by n % 5 into g
            select new { Remainder = g.Key, Numbers = g }; 
```

我是否认为 Entity SQL 和 LINQ 是两种不同的技术而感到困惑，实体 SQL 实际上是否使用 LINQ？

发布我收到的许多回复：

好的，伙计们，我是新手，所以这次我正在编辑我的答案；-) 非常感谢您提供完整、快速和非常有用的答案。问候 MereMortal

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-14T22:23:58.390

LINQ != LINQ-to-SQL

LINQ 是概念，包括一些语言支持。有许多实现 - LINQ-to-SQL 就是其中之一，ADO.NET 数据服务、Entity Framework 的 LINQ-to-Entities、LINQ-to-Objects、LINQ-to-SQL、LINQ-to-Amazon、DbLinq 等也是如此.

您仍然将 LINQ 与实体框架一起使用；事实上，LINQ-to-Entities 是首选，它提供编译时静态检查。Entity SQL 只是另一种用于查询 EDM（实体数据模型）的机制（除了 LINQ-to-Entities）。

ESQL 有用的主要原因有 3 个：

*   当 LINQ-to-Entities 仍在构建中时，它是早期预览版中的*唯一选择*
*   它可以用于一些没有对象模型的场景*，*例如报表服务
*   在*少数*情况下 ESQL 更具表现力

对于其他一切，LINQ 应该是您使用实体框架的工具。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-14T22:22:35.117

LINQ 是语言功能的通用术语，允许在某种数据存储上使用 C# 或 VB.NET 编写查询。有 LINQ to SQL、LINQ to Entities、LINQ to Objects 等。

LINQ to SQL 对物理数据库结构进行了密切建模。它为数据库中的每个表生成一种类型。如果您的数据库发生更改，那么您的 LINQ to SQL 代码将需要更改。

LINQ to Entities 更紧密地模拟了概念数据库设计。它允许您映射到物理数据库，但例如，允许您创建一个包含来自 Person 和 Contacts 表的数据的 Person 实体。这使您的调用者可以考虑数据的*含义*，而不是数据的实现方式。

此外，微软表示，与 LINQ to Entities 的开发相比，LINQ to SQL 的未来开发将受到限制。鉴于灵活性的提高以及 LINQ to SQL 不会获得更多增强的事实，我会选择 LINQ to Entities 和 Entity Framework。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-14T22:25:47.807

正如其他人所说，您可能是指 Linq to SQL vs Entity Framework。

两者都适用于 SQL Server，但只有实体框架适用于其他数据库。此外，LINQ to SQL 或多或少地被贬低了。所以去实体框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T22:23:06.067

Linq 是一种编程结构，可让您查询**对象**

我认为您正在谈论一个 Linq to Sql。

您始终可以使用 linq 查询 EF 对象...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T22:28:19.033

哇哇。那里慢点。

简短答案：实体框架

更长的答案：

LINQ to SQL 和实体框架是数据访问技术。

根据 MS 的说法，Linq 是

> LINQ 是 .NET Framework 的一组扩展，包含语言集成的查询、设置和转换操作。它使用用于查询的本机语言语法扩展了 C# 和 Visual Basic，并提供了类库以利用这些功能。

来自：http: [//msdn.microsoft.com/en-us/netframework/aa904594.aspx](http://msdn.microsoft.com/en-us/netframework/aa904594.aspx)

LINQ to SQL 和 Entity Framework 都有 Linq 提供程序，在查询它们时允许使用这种很棒的语法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-05T18:49:33.250

我在 12 月 2 日和 3 日参加了蒙特利尔的 microsoft TehcDays，他们说他们将在几年内不再支持 LINQ to sql，所以你最好开始学习 LinQ to entity（实体框架）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T04:46:08.190

据我了解，EF 还没有完全准备好迎接黄金时间，而且它不支持今天在 LINQ2SQL 中如此容易工作的许多 LINQ 构造。

如果您可以为您的应用程序提交 SQL Server，我今天说，学习 LINQ2SQL。使用 LINQ 时，您将拥有更多的查询功能。

我敢打赌，当 EF 准备好时，这对您来说会更容易过渡，因为查询语言应该是可转移的。

祝你好运。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-14T22:25:34.530

实体框架具有 LINQ to Entities，因此您也可以对 EF 执行非常相同的查询。我的回答是对 EF 进行更多投资，因为即将推出的 EFv4 似乎很有希望。

# .net-3.5 - WCF 回调通道被过早处理？

> ID：866151
> 
> 赞同：1
> 
> 时间：2009-05-14T22:20:25.433
> 
> 标签：.net-3.5, wcf, callback

我的应用程序使用带有回调通道的 net.tcp WCF 服务。出于某种原因，我无法发送事件回调。这就是我正在做的事情（所有代码服务器端）：

初始化时：

```
OperationContext Context { get; protected set; }
...
Context = OperationContext.Current; 
```

活动现场：

```
var callback = Context.GetCallbackChannel<IServiceCallbackContract>();
callback.SomeMethod(); 
```

这失败了，`SomeMethod()`但有以下例外：`{"Cannot access a disposed object.\r\nObject name: 'System.ServiceModel.Channels.ServiceChannel'."}`

显然，有些东西处理了回调通道，即使客户端仍然能够使用直接（非回调）通道与服务器交谈。这很奇怪。为了发出回调，我应该持有哪个对象？是否有某个线程必须在其中运行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T00:06:56.597

[配置跟踪](http://msdn.microsoft.com/en-us/library/ms733025.aspx)并查看哪些异常导致您的通道出错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T01:00:24.520

我遇到了类似的问题，我的服务会对业务层进行异步调用，然后等待事件在服务上触发。每当事件触发时，回调上下文就会丢失。我还没有深入研究为什么会这样的细节，但我最终实现了一种解决方法，即本质上存储对当前上下文的引用并触发一个单独的线程来调用业务层，一旦完成就触发回调参考我已经存储。

1）创建一个新类，该类将包含我的输入请求和对回调的引用，例如。

```
public struct MyCallbackDetails {
     public MyCallbackDetails(IMyServiceCallback callback, RequestType request) : this() 
         Callback = callback;
         Request = request;
}

public IMyServiceCallback Callback { get; set; }

public RequestType request { get; set; }
} 
```

2）然后我会触发一个单独的线程，传递一个 MyCallbackDetails 对象，而不仅仅是请求：

```
public ResponseType MyServiceMethod(RequestType request) {
    //...Do Some Stuff
    //Create MyCallbackDetails object to store reference to the callback and keep channel open
    MyCallDetails callDetails = new MyCallDetails(OperationContext.Current.GetCallbackChannel<IMyServiceCallback>(), request);
    //Fire off a new thread to call the BL and do some work
    Thread processThread = new Thread(RunCallbackMethod);
    processThread.Start(callDetails);
} 
```

3) 我的 RunCallbackMethod 将进行 BL 调用并以回调响应。

```
void RunCallBackMethod(Object requestDetails)
{
    //Use callbackdetails to make BL calls
    MyCallbackDetails callDetails = (MyCallbackDetails)requestDetails;
    // Make BL call - all code under here is syncrhonous
    ResponseType response = BusinessLayer.BusinessMethod(callDetails.Request);
    //NB: If your responsetype is a business object you will need to convert it to a service object
    callDetails.Callback.SomeMethod(results);
} 
```

注意：是的，我现在已经取消了让我的业务层中的一个事件返回到服务层但是当我为业务层触发一个单独的线程时，它仍然异步运行并且就像我调用 BL 一样直接以异步方式并等待事件通知其完成。

PS：感谢[Rory](http://www.neovolve.com/)的想法和实现这一点的大部分代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T10:28:19.630

您是否尝试直接使用 OperationContext.Current 而不是实例变量 Context？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T22:39:05.303

该问题已作为我的错误解决。回调按设计工作，除了一些是陈旧的，在调用时会抛出异常。由于我没有尝试/捕捉它们，因此整个事件都在那些陈旧的回调中中断:(。

感谢所有试图回答我问题的人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-25T14:49:06.990

我在我的聊天应用程序中遇到了类似的问题。如果我关闭我的应用程序然后尝试再次打开，我`Cannot access a disposed object`在打开频道时会不断收到。

通过应用程序向后追踪，我做了以下事情来找到根本原因。

*   当我在关闭前对服务进行最后一次调用（注销）时，在客户端应用程序中设置一个断点。- 这里没有什么可报告的。
*   远程以注销方式调试服务器上的服务。- 注意到回调不起作用并生成异常，因为通道因某种原因被释放。
*   检查 OperationContract 的属性 - 发现问题！

问题是，如果我错了，WCF 专家会纠正我，OperationContract 是这样的

```
[OperationContract(IsInitiating = false, IsTerminating = true)]
bool RemoveUser(Client user); 
```

设置`IsTerminating = true`意味着在服务处理注销方法之前通道已关闭，因此当它尝试回调时它不能。

在客户端设置`IsTerminating = false`和关闭频道为我解决了问题。

在我的应用程序中，回调甚至不应该发生，但这是一个单独的问题，并且不相关。要点是，如果你有`IsTerminating = True`一个操作，那么确保你没有使用回调。

# iphone - 为什么 iPhone 上没有 NSArrayController？

> ID：866158
> 
> 赞同：14
> 
> 时间：2009-05-14T22:21:54.383
> 
> 标签：iphone, objective-c, cocoa, arrays, nsarraycontroller

为什么 iPhone 上没有 NSArrayController？iPhone 会有 NSArrayController 吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-14T22:59:58.177

> 为什么 iPhone 上没有 NSArrayController？

因为它是应用程序工具包的一部分。iPhone 没有应用程序工具包；它有 UIKit 代替。

此外，它存在于 Mac 上以补充 iPhone 上不存在的 Bindings。

> iPhone 会有 NSArrayController 吗？

问苹果。更好的是，[提交增强请求](https://bugreport.apple.com/ "雷达网")。为 Bindings 提交一个文件，因为没有 NSArrayController 没有它没有多大意义。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T19:25:55.983

虽然它与 NSArrayController 不同，但 NSFetchedResultsController 有许多相同的用途。

当然，我们还不能谈论 NSFetchedResultsController，但我想知道如果你在 Apple 文档中搜索它会发生什么？

刚刚看到我的这个旧答案需要更新：现在可以谈论 NSFetchedResultsController。

# vb.net - 在 vb2005 for 循环中定义多个变量

> ID：866176
> 
> 赞同：1
> 
> 时间：2009-05-14T22:25:41.927
> 
> 标签：vb.net, visual-studio-2005

是否可以以与 jscript 类似的方式在 vb2005 For 循环中定义两个变量？

javascript示例是

```
for(i=0,l=0;i<20;i++){} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:32:03.610

不，VB.Net 中没有等效的语法。for 循环声明只能包含一个变量。

For 循环语法：http: [//msdn.microsoft.com/en-us/library/5z06z1kb.aspx](http://msdn.microsoft.com/en-us/library/5z06z1kb.aspx)

# iphone - 如何在可可触摸的uitableviewcell中使用段落文本

> ID：866188
> 
> 赞同：0
> 
> 时间：2009-05-14T22:28:32.917
> 
> 标签：iphone, cocoa-touch, text, uitableview

我一直在使用 uiLabels 将文本放入表格视图的单元格中。我现在想使用回车返回下一行的段落文本，而不是超出表格单元格的边界。我会通过操作 uiLabel 来做到这一点，还是会像文本视图一样使用不同的控件。

还有任何项目示例可以实现这一点吗？

谢谢，乔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T23:13:18.910

最简单的方法是使用 UILabel 并将 IB 中的行数设置为 > 1，然后将换行符设置为“自动换行”。

另一种方法是使用 UITextView，加载数据并将其设置为“禁用”，因此无法对其进行编辑。

最后，您始终可以使用 UIWebView 路由并使用格式化的 HTML 加载它，完成换行符等。相当繁重，但最灵活。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T22:58:12.377

最简单的方法可能是使用 UILabel。唯一的选择是制作一个直接绘制文本的自定义 UIView 子类，但这会给您带来边际收益。

# design-patterns - 有哪些常见的 3D 游戏模式？

> ID：866197
> 
> 赞同：9
> 
> 时间：2009-05-14T22:29:46.783
> 
> 标签：design-patterns, architecture

开发 3D 游戏时使用的一些更常见的设计模式有哪些？有没有常用的高级架构设计模式？架构中的通用软件模式呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-14T22:57:11.757

*   Composite 用于在每个更新步骤中执行所有操作（例如渲染）（在所有 UI 库中确实很常见）。
*   享元用于在屏幕上绘制许多相同的项目类型（树木/灌木/子弹）
*   许多 UI 库的观察者（同样，不是特定于游戏的）
*   在游戏/菜单/控制台/暂停/等之间转换的状态。状态
*   一些用于创建怪物/NPC 的节拍类游戏中的抽象工厂（一次具有荒谬数量的 AI 角色的游戏 - 即 Left 4 Dead）。
*   A* 等寻路算法中的交换启发式策略
*   编辑> 用于 MMO 等游戏的命令，这些游戏有一个带有可互换按钮的操作栏，您可以单击这些按钮来施放咒语等。

这就是我现在能想到的一切。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T10:32:34.847

我认为没有任何特别针对游戏的软件设计模式。游戏使用与其他所有人相同的语言、库、平台，并且在软件级别面临几乎完全相同的问题。

有一些方法或方法似乎很流行，但它们并没有像经典设计模式那样在代码级别正式化。一个例子是基于组件的参与者，通常甚至不聚合在同一个对象中，而是通过共享 ID，通过信号/插槽类型机制进行通信。另一种是嵌入用于脚本目的的第二种语言，例如 Lua、Python 或 Javascript。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-19T22:02:11.947

我发现[这个 PDF](http://www1.pacific.edu/%7Emdoherty/research/GAMES/game_architecture.pdf)详细介绍了可能的游戏架构。虽然，它可能“让那些更倾向于从面向对象设计方面思考的读者不同意”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T22:46:45.697

状态模式的变化对于建模游戏状态很有用。[Enginuity 系列文章](http://www.gamedev.net/reference/programming/features/enginuity1/)很好地概述了游戏引擎设计的一些低级方面。它不完整，但很好。Guff 框架的设计者[概述了使用状态层次结构](http://www.cin.ufpe.br/~sbgames/proceedings/files/An%20Architecture%20for%20Game%20State%20Management%20based%20on%20State%20Hierarchies.pdf)来处理游戏状态。层次概念很好，尽管他们对游戏状态的看法是有限的（它包含整个游戏循环而不仅仅是状态）。他们还有[一篇关于实时游戏循环](http://guff.tigris.org/docs/SBGames05-en.pdf)的论文。

在实现脚本时，使用支持某种协作多线程的脚本语言**非常有用且功能强大。**Stackless Python 提供了这一点。从 Mono 2.6 开始，您[可以在 C# 中使用 continuations 执行此操作](http://tirania.org/blog/archive/2009/Apr-09.html)，但只能在 Mono 平台（不是 .NET）上执行，因为它需要更改 VM。

2D 和 3D 图形、动画、输入等有常见的解决方案。其中许多由 DirectX、SDL 或类似框架处理。

# iphone - 在 UITextField 中禁用放大镜

> ID：866200
> 
> 赞同：7
> 
> 时间：2009-05-14T22:30:40.183
> 
> 标签：iphone, cocoa-touch, uitextfield

有没有办法阻止用户在 UITextField 中移动光标？我希望它留在字符串的末尾。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-05-16T11:32:32.307

这是一个老问题，但我一直在寻找同一个问题的答案，并找到了解决方案。

阻止用户移动光标实际上非常简单。只需继承 UITextField 并提供以下实现`caretRectForPosition:`

```
- (CGRect)caretRectForPosition:(UITextPosition *)position
{
    return [super caretRectForPosition:self.endOfDocument];
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-01-03T12:39:21.400

**不需要子类**。

你可以使用`UITextFieldDelegate`. 它将禁用放大镜和文本选择。

```
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField {
    textField.userInteractionEnabled = NO;
    return YES;
}

- (void)textFieldDidEndEditing:(UITextField *)textField {
    textField.userInteractionEnabled = YES;
} 
```

注意：这只是一个旁路。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T23:00:33.637

没有办法阻止他们移动光标。但是，您可以通过实施

`– textField:shouldChangeCharactersInRange:replacementString:`

文本字段的委托中的方法。

编辑：您还可以设置`userInteractionEnabled`为`NO`使用户无法点击该字段。手动调用`becomeFirstResponder`以使该字段获得焦点，因为用户无法点击聚焦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-21T01:45:00.413

我建议检查**gestureRecognizers**属性。

您会在数组中找到很多它们，并且可能希望将它们全部删除，或者找到触发要拦截并删除/替换它的事件的那些。

我用它从 UITextField 中删除复制/粘贴和放大镜功能

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-18T11:42:49.873

我没有检查您是否可以禁用放大镜，但推荐的在 UIResponder（以及 UITextField）中选择性地禁用编辑行为的方法是实现`canPerformAction:withSender`.`UIResponder`

请参阅[UIResponder 文档](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/UIResponder/canPerformAction:withSender:)。

也许如果您对 select 和 selectAll 操作返回“NO”，您可以禁用它。

另一种更残酷的方法是拦截任何触摸事件并将光标重置到末尾。

# c++ - 在 C++ Win32 应用程序中，我如何确定私有字节、工作集和虚拟大小

> ID：866202
> 
> 赞同：7
> 
> 时间：2009-05-14T22:31:53.563
> 
> 标签：c++, winapi, memory-management

我正在编写一些用于教育目的的代码，我希望能够从用 C++ 编写的 Windows 控制台程序中打印出这些内存使用值。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-15T17:16:21.413

花了一些时间从这些链接中获得我想要的东西，但它就在这里。（大部分困难是让它在 Mingw32 中工作。）

```
// -*- compile-command:"g++ mem.cpp -lpsapi -g -o mem.exe"; -*-

// Shows the memory: private bytes, working set and virtual size for a process 

#include <windows.h> 
#include <stdio.h>
#include <psapi.h>

// MingW32 doesn't have this struct in psapi.h
typedef struct _PROCESS_MEMORY_COUNTERS_EX {
  DWORD  cb;
  DWORD  PageFaultCount;
  SIZE_T PeakWorkingSetSize;
  SIZE_T WorkingSetSize;
  SIZE_T QuotaPeakPagedPoolUsage;
  SIZE_T QuotaPagedPoolUsage;
  SIZE_T QuotaPeakNonPagedPoolUsage;
  SIZE_T QuotaNonPagedPoolUsage;
  SIZE_T PagefileUsage;
  SIZE_T PeakPagefileUsage;
  SIZE_T PrivateUsage;
}PROCESS_MEMORY_COUNTERS_EX, *PPROCESS_MEMORY_COUNTERS_EX;

void PrintMemoryInfo( DWORD processID )
{
    HANDLE hProcess;
    PROCESS_MEMORY_COUNTERS_EX pmc;

    // Print the process identifier.

    printf( "\nProcess ID: %u\n", processID );

    // Print information about the memory usage of the process.

    hProcess = OpenProcess(  PROCESS_QUERY_INFORMATION |
                                    PROCESS_VM_READ,
                                    FALSE, processID );
    if (NULL == hProcess)
        return;

    if ( GetProcessMemoryInfo( hProcess, (PROCESS_MEMORY_COUNTERS *) &pmc, sizeof(pmc)) )
    {
        printf( "\tWorkingSetSize: %u\n", pmc.WorkingSetSize );
        printf( "\tPrivate Bytes: %u\n", pmc.PrivateUsage );
        printf( "\tPagefile (peak): %u (%u)\n", pmc.PagefileUsage, pmc.PeakPagefileUsage  );

    }

    CloseHandle( hProcess );
}

int main()
{
    DWORD id = GetCurrentProcessId();

    PrintMemoryInfo(id);

    return 0;
} 
```

# python - python在cast\addition之前处理Nonetype

> ID：866208
> 
> 赞同：4
> 
> 时间：2009-05-14T22:33:10.737
> 
> 标签：python, types

我从数据库中提取一行并将字段（大约 15 个）相加以获得总数。但是有些字段值会为 Null，这会导致添加字段时出错 ( `TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'`)

现在，对于每个字段，我获取字段值并将其设置为“x#”，然后检查它是否为无，如果是，则将“x#”设置为 0。

不是很优雅......关于在python中处理这个问题的更好方法有什么建议吗？

抄送

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-14T22:38:11.990

你可以像这样轻松地做到这一点：

```
result = sum(field for field in row if field) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T02:58:39.820

另一个（更好的？）选项是在数据库中执行此操作。您可以使用 COALESCE 更改您的数据库查询以将 NULL 映射到 0。

假设您有一个表，其中包含名为 col1、col2、col3 的整数列，可以接受 NULL。

选项1：

```
SELECT coalesce(col1, 0) as col1, coalesce(col2, 0) as col2, coalesce(col3, 0) as col3
FROM your_table; 
```

然后在 Python 中对返回的行使用 sum()，而不必担心 None 的存在。

选项 2：对数据库中的列求和并在查询中返回总数：

```
SELECT coalesce(col1, 0) + coalesce(col2, 0) + coalesce(col3, 0) as total
FROM your_table; 
```

在 Python 中没什么可做的了。第二个选项的一个优点是您可以在查询中选择不属于总和的其他列（您的表中可能有其他列并且正在执行多个查询以获取表的不同列？）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T08:09:52.363

```
total = 0.0
for f in fields:
  total += f or 0.0 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T23:26:37.817

这是一个笨重的版本。

```
total = (a if a is not None else 0) + (b if b is not None else 0) + ... 
```

这是另一种选择。

```
def ifnull(col,replacement=0):
    return col if col is not None else replacement

total = ifnull(a) + ifnull(b) + ifnull(c) + ... 
```

这是另一种选择。

```
def non_null( *fields ):
    for f in fields:
        if f is not None:
            yield f

total = sum( non_null( a, b, c, d, e, f, g ) ) 
```

# sql - BIT 字段是否比 SQL Server 中的 int 字段快？

> ID：866209
> 
> 赞同：4
> 
> 时间：2009-05-14T22:33:22.093
> 
> 标签：sql, performance, bit

我有一些字段的值将是 1 0 的表。这个表将是非常大的超时。使用位数据类型好还是使用不同类型的性能更好？当然，所有字段都应该被索引。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-14T22:37:30.463

我无法为您提供任何有关性能的统计数据，但是，您应该始终使用最能代表您的数据的类型。如果您想要的只是 1-0，那么绝对应该使用位字段。

您可以为数据库提供的信息越多，就越有可能正确地“猜测”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T22:37:54.563

官方位将是最快的，特别是如果您不允许空值。在实践中它可能并不重要，即使在大量使用时也是如此。但如果值只有 0 或 1，为什么不使用一点呢？听起来是确保该值不会被无效内容（如 2 或 -1）填充的最佳方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T22:51:12.613

据我了解，您仍然需要一个字节来存储一个位列（但您可以在一个字节中存储 8 个位列）。因此，拥有大量（多少？）这些位列可以为您节省一些存储空间。正如 Yishai 所说，它可能不会对性能产生太大影响（尽管有一点会更好地转换为应用程序代码中的布尔值）。

如果您可以 100% 自信地声明此列的两个选项永远不会改变，那么请务必使用该位。但是，如果您能看到将来出现第三个值，那么当那天使用 tinyint 时，生活会变得更轻松一些。

只是一个想法，但我不确定索引在此列上对您有多大好处，除非您看到绝大多数行都在一侧或另一侧。在大约 50/50 的分布中，您实际上可能会比在查询表时看到的保持索引更新所受到的影响更大。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-31T10:59:29.350

这取决于。

如果您想最大化选择的速度，请使用 int（tinyint 以节省空间），因为 where 子句中的 bit 比 int 慢（不是很大，但每毫秒都很重要）。还要使列不为空，这也可以加快速度。下面是实际性能测试的链接，我建议在您自己的数据库上运行它，并通过使用非空值、索引和一次使用多个列来扩展它。在家里，我什至尝试比较使用多个位列与多个 tinyint 列，而 tinyint 列更快（`select count(*) where A=0 and B=0 and C=0`）。我认为 SQL Server (2014) 会通过只使用位掩码进行一次比较来优化，所以它应该快三倍，但事实并非如此。如果您使用索引，则需要超过 5000000 行（在测试中使用）才能注意到任何差异（我没有耐心去做，因为在我的机器上填充数百万行的表会花费很长时间）。

[https://www.mssqltips.com/sqlservertip/4137/sql-server-performance-test-for-bit-data-type-in​​-a-where-clause/](https://www.mssqltips.com/sqlservertip/4137/sql-server-performance-test-for-bit-data-type-in-a-where-clause/)

如果您想节省空间，请使用 bit，因为其中 8 个可以占用 1 个字节，而 8 个 tinyint 将占用 8 个字节。每百万行节省了大约 7 兆字节。

这两种情况之间的差异基本上可以忽略不计，并且由于使用位具有表明该列仅代表一个标志的优势，因此我建议使用位。

# iphone - 成功使用 OS X 和 Vmware 进行 iPhone 开发？

> ID：866211
> 
> 赞同：11
> 
> 时间：2009-05-14T22:34:01.267
> 
> 标签：iphone, macos, development-environment, vmware, virtualization

在尝试使用临时 Mac 为客户开发 iPhone 应用程序但未能成功后，我开始研究 VMware Workstation 来虚拟化 OS X。我想知道人们是否发现了任何问题，或者是否整件事是行不通的。

作为记录，我有一个旧的条纹苹果标志，我从旧的 Apple IIe 上撬下来，贴在我的开发笔记本电脑的盖子上，这样我就符合 OS X EULA 的精神。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T11:39:13.297

我的一些同事在 OSX 上尝试过 VMWare 方法，但大部分都失败了。我知道互联网上有一些 VMWare 映像，但我不建议使用其中任何一个。

同样在布鲁斯看来，OSX86 项目最近取得了一些重大进展。我能够在我放置的旧戴尔上运行 OSX。这东西作为媒体服务器运行良好，直到我错误地下载了补丁，然后它就死了。

正如布鲁斯所说，500 美元或更好的 Mac Mini 将是一项不错的投资，请查看 eBay。在 eBay 上拿东西，工作结束后，您可以在 eBay 上卖回或保留它。如果您的预算真的很紧，您可以寻找 G4 Mac 并在其上进行开发，不支持 iPhone 模拟器。我以每台 80 美元的价格购买了 2 台 G4 Mac，然后以 120 美元的价格卖出了一台。

底线是，如果您考虑进入 iPhone 开发，请在 eBay 上对 Mini 或二手英特尔 Mac 进行少量投资。如果您在开发工作中取得成功，您的投资将获得回报。

祝你好运。

编辑：虽然不支持在 G4/PPC mac 上进行开发，但它是可行的。这是一个链接，概述了如何使其工作。

[http://3by9.com/85/](http://3by9.com/85/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T22:48:02.607

为 EULA 的大量回复做好准备。

从技术上讲，您最好的资源是 OSx86 网站，该网站位于[http://wiki.osx86project.org/](http://wiki.osx86project.org/)。

他们关于虚拟化的页面在这里 [http://wiki.osx86project.org/wiki/index.php/Virtualization](http://wiki.osx86project.org/wiki/index.php/Virtualization)

重要的是，为 Mac 和 iPhone 开发非常相似，如果您认真为您的客户做好开发，您可能至少应该投资一台 mac mini，这比购买操作系统多不到 500 美元本身。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T23:23:48.197

那是来自 IIe 的旧彩虹标志，对吧？顽固分子拥有每台真正的 Mac 随附的白色 Apple 贴纸。*真正*的顽固分子有他们偷偷从侄子的玩具卡车上撕下的白色苹果贴纸。

最便宜的选择可能是对您的硬盘进行分区并安装 hackintosh：

[http://www.wired.com/gadgetlab/2009/05/eight-months-with-a-hackintosh-netbook-conclusion-fantastic/](http://www.wired.com/gadgetlab/2009/05/eight-months-with-a-hackintosh-netbook-conclusion-fantastic/)

但是，如果您每次在 XCode 中构建应用程序都需要很长时间才能在电视上播放情景喜剧，请不要来这里哭泣 :-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-19T18:24:16.217

我有一个朋友使用 OSx86 发行版在他的戴尔笔记本电脑上成功安装了 10.5.7。他有开发者工具和 iPhone 模拟器工作，他可以​​编译他的应用程序。不过，他无法为他的硬件找到 USB 驱动程序，因此他无法在设备上安装他的应用程序。

不过老实说——我认为他花了大约 20 个小时进行设置、寻找驱动程序等……我们都认为他疯了，直到他真正安装了开发工具。在经历所有麻烦之前，我真的会努力尝试使用 Mac Mini。

但是苹果的标志移植……纯属天才。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-16T05:16:17.767

抛开明显的合法性不谈，根据我的经验，OS X 在 VM 中的性能非常差。如果您有耐心，并且碰巧拥有兼容的硬件，则可以在您的 PC 上本地安装 OS X。但是，我不能诚实地推荐这种方法，除非你是一个贪吃的惩罚者，或者想回想起那些安装支持所有硬件的 Linux 的黄金时代，这本身就是一个小小的胜利。

As others have mentioned, if you are serious about iPhone development, you're going to save yourself a lot of hassle by getting yourself a secondhand or refurbished Mac mini.

# ruby-on-rails - Rails 中最好的 Memcache 解决方案

> ID：866214
> 
> 赞同：1
> 
> 时间：2009-05-14T22:35:16.380
> 
> 标签：ruby-on-rails, memcached

环顾网络，我看到了许多在 rails 中使用 memcached 的插件和模式。我正在做一个新项目，想知道最好的解决方案是什么。谷歌出现了很多旧的结果，我不确定这是最新最好的做事方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T22:36:42.757

我们在 cache-money 插件上取得了巨大的成功，它提供了透明的 write-thru 和 read-thru 缓存解决方案。

[http://magicscalingsprinkles.wordpress.com/2008/12/11/introducing-cache-money/](http://magicscalingsprinkles.wordpress.com/2008/12/11/introducing-cache-money/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-22T19:51:15.247

我一直在高负载下使用[Garantia Data 的 Memcached Cloud](http://garantiadata.com/memcached)，它表现良好。他们的仪表板为缓存读/写活动和延迟提供了有用的见解。如果在 Amazon 上运行，Garantia 提供跨 Amazon 东海岸背板的访问，以提高性能并降低传输成本。我发现与他们的服务一起使用的唯一 gem 是 Evan 的[memcached gem](https://github.com/evan/memcached)。Dalli gem 还不是一个选项（2013 年 7 月），因为 Garantia 尚未实现对 Memcached 二进制协议的支持。

# git - 如何一次重新设置多个分支（具有相同的基本提交）？

> ID：866218
> 
> 赞同：70
> 
> 时间：2009-05-14T22:36:12.913
> 
> 标签：git, rebase, git-rebase

我的项目中有一个 master 分支，用于从其他人那里获取更改。从那以后，我通常有几个我目前正在研究的主题分支。

我的问题是：有没有办法让我将新的更改拉入我的主人，然后一次将我所有的主题分支重新定位到那个？

这是这种情况：

```
 D--E topic1
       /
A--B--C master
       \
        F--G topic2 
```

我想用一个命令来完成这个（H来自上游）：

```
               D'--E'主题1
              /
    A--B--C--H 主控
              \
               F'--G'话题2

```

现在，我知道我可以通过将 topic1 和 topic2 重新定位到 master 来实现这一点，我什至可以编写一个脚本来自动执行此操作。但是如果我有几个其他分支，经常创建新分支并删除其他分支，并且我一直收到上游更改怎么办？

这个操作（几个变基），当手工完成时，既累人又容易出错。

有没有更简单的方法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-14T23:19:43.527

我相当确定没有办法自动执行此操作。请记住，“git rebase master”也可以让你回到需要你解决合并冲突的 shell，所以如果你想编写一个脚本来自动化所有这些，你需要考虑到这一点。

不过，您可以相当轻松地跟踪哪些分支需要更新。嗯，对于任何分支，“git rev-list branch..master”如果分支不是最新的 wrt（即仅在其之上提交）master 将产生输出。因此，您需要遍历除 master 之外的所有本地负责人以生成报告（nb "git show-branch" 将大致执行此操作）：

```
git for-each-ref 'refs/heads/*' | \
  while read rev type ref; do
    branch=$(expr "$ref" : 'refs/heads/\(.*\)' )
    revs=$(git rev-list $rev..master)
    if [ -n "$revs" ]; then
      echo $branch needs update
      git diff --summary --shortstat -M -C -C $rev master
    fi
  done 
```

因此，如果您有勇气，可以将“git diff”替换为“git checkout $branch && git rebase master”（或者如果您设置了“git pull --rebase”）。我认为您必须检查是否存在“.git/rebase-apply”目录或检查未合并文件的索引（“git ls-files -u”）以测试我们是否一直在等待做一个合并。

当然，如果没有冲突，那么这很容易......它会产生一些在不容易的时候也能工作的东西，这就是问题所在：p

这并不一定能解决如果你的一个分支基于其他东西会发生什么......这就是为什么我提到使用“git pull --rebase”，因为这将根据分支配置重新设置，而不是盲目地从主. 虽然检测不是基于分支配置......也许最简单的方法是检查每个分支并执行“git pull”并让分支配置处理所有事情，包括是否变基或合并？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-12-14T17:18:37.250

你总是可以像这样写一个 shell 单行：

```
for branch in topic1 topic2 topic3;do git rebase master $branch;done 
```

由于您想要重新设置的主题分支可能会随着时间的推移而改变，这是一个快速的 dir^H^H^Hflexible 解决方案 :-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-09-22T12:47:56.070

我已经把它变成了一个健壮的脚本，在[我的 git-extensions 存储库](https://github.com/inkarkat/git-extensions/blob/master/git-urebaselocalbr)中维护：

```
$ git-urebaselocalbr --help
Rebase all / the last committed N local branches (except for the current branch
and master) to the updated upstream head.
Usage: git-urebaselocalbr [--continue|--skip|--abort] [--branches "<branch1> ..."] [N] [-i|--interactive] [options] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-02-17T15:10:57.450

```
git branch | sed 's/\*/ /g' | xargs -n1 git rebase master 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-12-27T23:07:45.990

如果您想将**所有**本地分支重新定位到 master，您可以尝试以下操作：

```
git branch | cut -c 3- | for branch in $(cat); do git rebase master $branch; done 
```

# javascript - 如何保护站点免受 API 中断的影响？

> ID：866219
> 
> 赞同：3
> 
> 时间：2009-05-14T22:36:20.777
> 
> 标签：javascript, api

看到今天谷歌在网络上中断的影响让我开始思考如何在未来防止这种情况发生。这可能是一个愚蠢的问题，但是有没有一种好的方法来包含外部 API（例如，Google 的 AJAX 库），这样如果 API 不可用，包含页面仍然可以在没有它的情况下继续运行？通常使用托管在外部服务器上的库通常是一个坏主意吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-14T22:42:17.410

使用脚本标签来加载跨域的 JavaScript 文件是不可避免的（如果它出现故障，这将导致超时）。但是，在您的代码中，检查 API 对象是否为 null 以避免错误：

例如，而不是：

```
<script type="text/javascript">
  google.load("maps", "2");
  // Use Maps API
</script> 
```

利用：

```
<script type="text/javascript">
  if(google != null)
  {
    google.load("maps", "2");
    // Use Maps API
  }
  else
  {
    // Fallback
  }
</script> 
```

我认为罕见的中断不值得拒绝外部 API 批发。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T23:37:34.170

您将希望将您的应用程序设计为优雅地降级（正如其他人所说），实际上有一种设计模式可以用于这样做。[代理模式](http://www.primos.com.au/primos/Default.aspx?PageContentID=28&tabid=65)在正确实施时可以用作看门人来检查服务是否可用（在许多其他用途中）并适当地向应用程序返回正确的数据、缓存数据或通知应用程序该服务不可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-14T22:43:13.710

我能给出的最好的一般答案是，***优雅优雅地降级并避免发送错误***。如果服务可能变得不可用，请期待并尽您所能。但我不认为这是可以笼统回答的问题。这取决于您的网站做什么、您使用的外部库/API 等等。

您可以进行某种缓存以仍然提供包含旧数据的页面。如果允许，您可以在自己的服务器上运行 API 引擎。或者你可以只是向用户抛出状态消息。

依赖外部 API 并不是一个坏主意，但主要缺点之一是您几乎无法控制它。如果它消失了？欢迎来到一个大问题。停电？你能做的不多，只能等待。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T22:43:12.523

我认为使用外部库是个好主意，因为它为我节省了带宽（阅读 $$）。但它很容易防止这种 api 中断。在您的服务器上保留一份副本，并在您的 JavaScript 中检查 api 是否已成功加载。如果没有在您的服务器上加载一个。

我在这里考虑 jQuery 和 YUI。在使用地图等实际服务时，其他人对问题的看法是正确的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T22:48:13.090

缓解问题的一种可能性（仅在您的站点是动态生成的情况下才有效）：

设置一个每 10 分钟 / 小时 / 一次运行的 cronjob，具体取决于您的关心程度。让它尝试下载您所包含的外部文件，对您所依赖的每个外部主机进行一次尝试。让它在数据库中设置一个标志，表示每个外部主机当前是否可用。

生成页面时，检查外部主机标志，并打印源属性，如果外部主机启动，则指向外部主机，如果外部主机关闭，则打印本地副本。

对于奖励积分，将从 cronjob 成功下载的文件变为本地副本。然后，当一个确实出现故障时，您的本地副本无论如何都代表来自外部主机的最新版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-14T22:43:03.147

很多时候，您需要通过网络访问第三方库。您需要问自己的问题是您需要多少以及是否可以缓存其中的任何内容。

如果您的正常运行时间需要尽可能接近 100%，那么也许您应该看看您对这些第三方的依赖程度。

如果您所获得的只是每小时一次的天气，那么您可能可以缓存它，以便事情继续进行。如果您向第三方询问仅在该毫秒内有效的数据，那么您可能需要查看错误处理以涵盖它可能不存在的事实。

问题的答案完全取决于您的具体情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-14T22:43:36.907

在您的应用程序中包含一个开关来切换使用 Google 或本地 Web 服务器来为您的 YUI、JQuery 或类似库提供服务当然是相当容易的，这样您就可以切换提供程序。

# objective-c - 在 Obj-C 中过度使用点运算符的替代方法是什么？

> ID：866222
> 
> 赞同：4
> 
> 时间：2009-05-14T22:36:45.457
> 
> 标签：objective-c, design-patterns, oop, coding-style

看看你对这行代码的看法：

```
if ([pickerViewController.picker.bvc.currentResolve.name isEqualToString:message])
  ... 
```

您认为这是过度使用点运算符吗？

如果没有，我可以保持原样。

但如果是这样，首选的选择是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-14T22:49:27.000

这更像是违反[得墨忒耳定律而](http://en.wikipedia.org/wiki/Law_of_Demeter)不是点运算符的问题。做到这一点的“更干净”的方法是为对象提供逻辑来解决这个问题，所以你可以做类似的事情

```
if ([pickerViewController hasPickedName:message]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T22:42:08.877

我不认为过度使用属性符号。如果一个对象有一个属性，就这样访问它；它向读者展示了程序员的意思。

哦，抢占“看起来像一个结构”的旅；如果您无法从代码中的对象中分辨出结构，请重构您的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:14:43.900

只要每次使用点运算符都确实获取了一个属性（即，不是一个主要关注为返回值以外的目的而工作的方法），那么就可以了。事实上，如果您查看 Wil Shipley 的博客，他实际上非常喜欢根据需要将尽可能多的函数调用链接到一行中（他不喜欢过度使用局部变量）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T06:27:38.290

我发现调试这类事情总是比它的价值更麻烦，所以我倾向于为每个属性访问创建中间变量。或者，正如其他人建议的那样，重构它，使其在使用站点上看起来更简单（通过将智能放入方法中）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T12:14:07.240

我同意[查克](https://stackoverflow.com/questions/866222/what-is-the-alternative-to-excessive-use-of-the-dot-operator-in-obj-c/866269#866269)和评论者的观点。您的方法依赖于太多其他对象，但仍然必须以`hasPickedName:`某种方式`pickerViewController`进行操作。`pickerViewController``[picker.bvc.currentResolve.name isEqualToString:message]`

相反，您可以使用 Interface Builder将委托（可能是键入的）放入`hasPickedName:`并`bvc`注入到您的顶级对象中。要真正符合 Demeter，请制作一种快捷方式。`bvc``id<NamePickerDelegate>``currentResolve``nameMatches:``[currentResolve.name isEqualToString:message]`

您应该仔细查看由问题引起的复杂性与每个解决方案将引入的复杂性。如果您判断原始代码比替代代码更简单且更易于维护，请保留它。

# sql-server - SQL Server 2008 功能/优点？

> ID：866223
> 
> 赞同：-1
> 
> 时间：2009-05-14T22:37:14.393
> 
> 标签：sql-server, sql-server-2008

**副本：**

*   [sql 2005 和 2008 之间的已知和“未知”不兼容性？](https://stackoverflow.com/questions/845271/known-and-unknown-incompatibilities-between-sql-2005-and-2008)
*   [SQL Server 2005 与 SQL Server 2008 [关闭]](https://stackoverflow.com/questions/725248/sql-server-2005-vs-sql-server-2008-closed)
*   [MS SQL Server 2008 相对于 MS SQL Server 2005 的优势？](https://stackoverflow.com/questions/198478/advantages-of-ms-sql-server-2008-over-ms-sql-server-2005)

还有很多。

* * *

你好

我已经使用 SQL Server 2000 几年了，但现在可以访问 SQL Server 2008 进行开发。

除了新的管理工作室和智能感知等显而易见的东西之外，SQL Server 2008 的主要特性和优势是什么？

与过时的 SQL 2000 企业管理器和查询分析器应用程序相比，管理工作室的性能普遍共识是什么？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:45:06.373

看看[这个问题](https://stackoverflow.com/questions/198478/advantages-of-ms-sql-server-2008-over-ms-sql-server-2005)。授予标题是为了说明 2008 年相对于 2005 年的优势，我认为功能列表非常全面，将向您展示 2000 年没有提供的所有内容。

SQL Server Management Studio 比企业管理器好很多。这有点不同，因为 SSMS 使用更多的 Visual Studio 界面。但是 SSMS 中还有更多功能可以轻松使用。

# .net - WPF：如何从子项导入资源

> ID：866225
> 
> 赞同：0
> 
> 时间：2009-05-14T22:37:20.307
> 
> 标签：.net, wpf, resources

我想在一些图形数据上定义两个外观相似的视图。一个视图是编辑器，另一个是显示正在转换的数据的查看器。我不确定在两个视图之间共享代码和资源的最佳方式是什么，但我暂时决定制作一个 UserControl 来表示两者之间共有的视觉呈现部分。

将 Styles 和 ControlTemplates 存储为 UserControl 的资源是最有意义的，但是在 XAML 中，我如何在其中一个视图（其中 UserControl 是视图的子级）中使用 UserControl 中定义的样式？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T23:29:00.587

如果您使用类型作为模板键，则无法同时拥有两者。但是，如果您愿意为不同类型的图形视图添加某种键控/枚举机制。

此外，图形数据是否被抽象为对象树，如果是这样，切换 DataTemplates 不是更有意义吗？

# .net - .NET 2.0 DateTime.ToString() 转换为不同的时区

> ID：866236
> 
> 赞同：0
> 
> 时间：2009-05-14T22:40:53.637
> 
> 标签：.net, timezone, utc

DateTime 的 ToString() 方法中是否有将时区转换为 UTC 的格式？

我知道我可以先以编程方式将 DateTime 转换为 UTC，然后调用 ToString，但我有一个用户可以指定格式的 UI，他们可以同时转换为 UTC 吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-27T13:06:14.413

.ToString("u") 将格式化为 UTC 但不转换。下面的代码将以 UTC 格式转换并显示日期和时间：

```
System.TimeZone.CurrentTimeZone.ToUniversalTime(Date.Now).ToString("u") 
```

或者

```
DateTime.Now.ToUniversalTime().ToString("u") 
```

其他格式可以在[这里找到](http://idunno.org/archive/2004/14/01/122.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T22:45:33.000

不是内置的，但您可以创建自己的格式化程序（[google IFormatProvider](http://www.google.com.au/search?sourceid=navclient&hl=en-GB&ie=UTF-8&rlz=1T4GGLJ_en-GBAU318AU318&q=IFormatProvider)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T22:44:28.510

不，您首先必须将 DateTime 转换为所需的时区。

# javascript - 使用 JavaScript 动态创建复选框？

> ID：866239
> 
> 赞同：45
> 
> 时间：2009-05-14T22:42:00.810
> 
> 标签：javascript, html, checkbox

我正在尝试使用以下 HTML/JavaScript 动态创建一个复选框。任何想法为什么它不起作用？

```
<div id="cb"></div>
<script type="text/javascript">
    var cbh = document.getElementById('cb');
    var val = '1';
    var cap = 'Jan';

    var cb = document.createElement('input');
    cb.type = 'checkbox';
    cbh.appendChild(cb);
    cb.name = val;
    cb.value = cap;
    cb.appendChild(document.createTextNode(cap));
</script> 
```

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-05-14T22:44:09.137

您正在尝试将文本节点放在输入元素中。

输入元素为空且不能有子元素。

```
...
var checkbox = document.createElement('input');
checkbox.type = "checkbox";
checkbox.name = "name";
checkbox.value = "value";
checkbox.id = "id";

var label = document.createElement('label')
label.htmlFor = "id";
label.appendChild(document.createTextNode('text for label after checkbox'));

container.appendChild(checkbox);
container.appendChild(label); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T22:45:54.437

最后一行应该是

```
cbh.appendChild(document.createTextNode(cap)); 
```

将文本（标签？）附加到与复选框相同的容器中，而不是复选框本身

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-27T09:37:00.487

您可以创建一个函数：

```
function changeInputType(oldObj, oTyp, nValue) {
  var newObject = document.createElement('input');
  newObject.type = oTyp;
  if(oldObj.size) newObject.size = oldObj.size;
  if(oldObj.value) newObject.value = nValue;
  if(oldObj.name) newObject.name = oldObj.name;
  if(oldObj.id) newObject.id = oldObj.id;
  if(oldObj.className) newObject.className = oldObj.className;
  oldObj.parentNode.replaceChild(newObject,oldObj);
  return newObject;
} 
```

你打一个电话，比如：

```
changeInputType(document.getElementById('DATE_RANGE_VALUE'), 'checkbox', 7); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-04-12T19:48:22.900

```
 /* worked for me  */
     <div id="divid"> </div>
     <script type="text/javascript">
         var hold = document.getElementById("divid");
         var checkbox = document.createElement('input');
         checkbox.type = "checkbox";
         checkbox.name = "chkbox1";
         checkbox.id = "cbid";
         var label = document.createElement('label');
         var tn = document.createTextNode("Not A RoBot");
         label.htmlFor="cbid";
         label.appendChild(tn); 
         hold.appendChild(label);
         hold.appendChild(checkbox);
      </script> 
```

# asp.net - 何时使用 Lucene.NET 更新索引？异步与否？

> ID：866242
> 
> 赞同：3
> 
> 时间：2009-05-14T22:42:34.897
> 
> 标签：asp.net, lucene.net

通常是否足够快以同步进行简单更新？例如，对于一个 ASP.NET Web 应用程序，如果我更改此人的姓名......作为“保存”机制的一部分同步更新索引是否会有任何问题？

或者是让其他异步过程进行索引更新的唯一安全方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T07:59:18.520

我们根据用户正在执行的操作类型进行同步和异步更新。我们以使用异步代码的方式实现了同步索引，只需等待一段时间即可完成。我们只等待 2 秒，这意味着如果需要更长时间，那么用户将看不到更新，但通常用户会看到。

我们以某种方式配置日志记录，以便每当“同步”索引花费的时间比我们等待了解它发生频率的时间长时，我们都会收到通知。我们几乎没有超过 2 秒的限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-01T06:12:30.900

如果您使用的是全文会话，则无需显式更新索引。全文会话负责索引更新的实体。

# jquery - JQuery - 将 onclick 添加到动态生成的 img 标签

> ID：866252
> 
> 赞同：9
> 
> 时间：2009-05-14T22:45:18.900
> 
> 标签：jquery

我正在使用以下代码动态创建几个图像：

```
function refresh_gallery(galleryidentifier, albumid) {
    $.ajax({ type: "POST", url: "/Photos/Thumbnails/" + albumid + "/", data: {}, success: function(msg) {
        try {
            var fotos = eval(msg); $(galleryidentifier).empty(); if (fotos.length == 0) { $(galleryidentifier).html("Press &quot;Add files...&quot; and select files to upload!"); return true; }
            for (var f in fotos) {
                //this image needs the onclick eventhandler
                $(document.createElement("img")).attr({ src: '/images/delete.gif', title: 'Delete ' + fotos[f].Title }).addClass("icon_delete").appendTo(galleryidentifier); ;
                $(document.createElement("img")).attr({ src: fotos[f].ThumbnailPath, title: fotos[f].Title }).addClass("thumbnail").appendTo(galleryidentifier);
            }
            var del_div = $(document.createElement("div")).css({ "padding": "4px" }).appendTo(galleryidentifier);
            var delete_span = $(document.createElement("span")).click(delete_files(albumid)).css({ "cursor": "pointer", "font-size": "12px" }).appendTo(del_div);
            $(document.createElement("img")).attr({ "src": "/Content/images/delete.png" }).appendTo(delete_span);
            $(document.createTextNode("delete all")).appendTo(delete_span);
            return true;
        }
        catch (e) {
            alert(e);
        }
        alert("Refresh error!");
    }, error: function() { alert("Refresh error!"); }
    });
} 
```

图像的生成工作正常，但我想为正在生成的第一个图像添加一个 onclick 事件处理程序（参见代码中的注释）。我该怎么做呢？我对 JQuery 相当陌生。

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-14T22:52:06.480

```
$(document.createElement("img"))
    .attr({ src: '/images/delete.gif', title: 'Delete ' + fotos[f].Title })
    .addClass("icon_delete")
    .appendTo(galleryidentifier)
    .click(function(){
        // Do something
    }) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-14T22:51:40.320

jQuery 有一个叫做 click 的方法，它的参数是一个回调函数。在此示例中，我还将使用（更）简单的速记来创建图像元素：

```
$('<img/>').click(function () {
    // do something
}).attr({
    src: '/images/delete.gif',
    title: 'Delete ' + fotos[f].Title
}).addClass("icon_delete").appendTo(galleryidentifier); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-04-25T09:56:26.293

从 jQuery 1.4 开始，您可以创建一个元素并在创建时向其添加所有属性/事件。

对于图像标签，您可以编写：

```
$('<img/>', {
    src:     '/images/delete.gif',
    title:   'Delete ' + fotos[f].Title,
    'class': 'icon_delete', // in quotes because class is a reserved js word
    click:   function( e ){
        // Everything here happens when you click the image.
    }
}).appendTo(galleryidentifier); 
```

JSBin 中的上述[示例](http://jsbin.com/esicoq)。

这是对文档的[参考。](http://api.jquery.com/jQuery/#entry-examples-1)

为什么它比使用 jQuery 创建图像的其他方法更好：

*   比链接十几种方法要干净得多。
*   允许您发送要创建的具有不同属性的对象。
*   与常规 html“硬编码”元素完美匹配。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T22:49:22.417

[您可以使用click](http://docs.jquery.com/Events/click#fn)函数添加这种类型的事件处理程序，方法与添加 css 类的方式相同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T22:50:07.390

您可以在使用 addClass() 方法创建图像时创建一个类。在其他地方有类似的东西

```
$(document).ready(
  $("img.toBeClicked").click(function() {
    //some code
  };
}; 
```

# asp.net - 如何在 ajax 面板回发中获取动态图像按钮的句柄

> ID：866258
> 
> 赞同：1
> 
> 时间：2009-05-14T22:46:51.640
> 
> 标签：asp.net, ajax, postback, imagebutton

当用户选择列表中的项目时，我将图像按钮写入新行中的表格单元格：

```
ImageButton imgbtnRemove = new ImageButton();
imgbtnRemove.ID = "uxStandardLetterDeleteImage_" + items.letterName;
imgbtnRemove.CommandName = "uxStandardLetterDeleteImage_" + items.letterName;
imgbtnRemove.ImageUrl = items.remove;
imgStatus.AlternateText = "Remove";
tRow.Cells[3].Controls.Add(imgbtnRemove); 
```

单击新的图像按钮时，我似乎无法处理它。我在 Page_PreRender 事件中看到它，我还在每次回发时重新加载表。

```
string returnData = Request.Form.ToString(); 
```

但遍历表单控件图像：

```
if (c is System.Web.UI.WebControls.Button ||
c is System.Web.UI.WebControls.ImageButton) 
```

没有找到它。如果我手动输入一个，我可以找到它：

```
imgbtnRemove.Click += new System.Web.UI.ImageClickEventHandler(this.ButtonClick); 
```

在 Page_Load 中，然后在 click 事件中抓取它：

```
switch (((System.Web.UI.WebControls.ImageButton)sender).CommandName)
... 
```

但是因为有新的行被添加和删除，这在编程上变得相当丑陋。我认为必须有一个优雅的解决方案来从服务器端代码动态创建和检索动态图像按钮。我已经做了很多挖掘，但这个让我难过。

提前致谢...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T22:56:15.363

如果您在页面生命周期的事件处理阶段（例如，在 item selected 事件中）创建动态控件，则该控件将在下一次回发时消失。

为了将动态控件注册到 ViewState，它们必须在事件生命周期的 Init 阶段创建。

此外，您说您正在遍历表单的控件......当您将图像按钮添加到表格的单元格时。您是否递归地降低控件层次结构以查找图像按钮？

# c - 在 C API 中使用可变参数来设置键值对是个好主意吗？

> ID：866260
> 
> 赞同：10
> 
> 时间：2009-05-14T22:47:17.927
> 
> 标签：c, api

我正在编写一个更新结构中许多不同字段的 API。

我可以通过使更新函数可变来帮助添加未来的字段：

```
update(FIELD_NAME1, 10, FIELD_NAME2, 20); 
```

然后`FIELD_NAME3`在不更改任何现有调用的情况下添加：

```
update(FIELD_NAME1, 10, FIELD_NAME2, 20, FIELD_NAME3, 30); 
```

请问智慧之言？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-14T22:50:30.477

一般来说，没有。

Varargs 抛出了很多类型安全性——你可以传递指针、浮点数等，而不是 int，它会毫无问题地编译。滥用可变参数（例如省略参数）可能会由于堆栈损坏或读取无效指针而导致奇怪的崩溃。

例如，以下调用将编译并导致崩溃或其他奇怪的行为：

```
UpdateField(6, "Field1", 7, "Field2", "Foo"); 
```

最初的 6 是期望的参数数量。它将字符串指针“Foo”转换为 int 以放入 Field2，它会尝试读取和解释其他两个不存在的参数，这可能会因取消引用堆栈噪声而导致崩溃。

我相信在 C 中实现 varargs 是一个错误（考虑到今天的环境 - 它可能在 1972 年非常有意义。）实现是你在堆栈上传递一堆值，然后被调用者将遍历堆栈拾取参数，基于关于它对一些初始控制参数的解释。这种类型的实现基本上会让你以一种很难诊断的方式犯错误。C# 的实现，通过方法上的属性传递一个对象数组，只是必须更理智，尽管不能直接映射到 C 语言中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-14T23:22:46.517

我倾向于避免使用可变参数，除非在一种非常有用的特定情况下。变量参数并没有真正提供超出单个函数调用可以完成的所有好处，尤其是在您的情况下。

在可读性方面（除了非常特殊的情况外，这通常是我比原始速度更喜欢的），以下两个选项之间没有真正的区别（我在可变参数版本中添加了一个计数，因为您需要计数或哨兵来检测数据的结尾）：

```
update(2, FIELD_NAME1, 10, FIELD_NAME2, 20);
update(3, FIELD_NAME3, 10, FIELD_NAME4, 20, FIELD_NAME5, 30);
/* ========== */
update(FIELD_NAME1, 10);
update(FIELD_NAME2, 20);
update(FIELD_NAME3, 10);
update(FIELD_NAME4, 20);
update(FIELD_NAME5, 30); 
```

事实上，随着 varargs 版本变长，无论如何您都需要将其拆分，以进行格式化：

```
update(5,
    FIELD_NAME1, 10,
    FIELD_NAME2, 20,
    FIELD_NAME3, 10,
    FIELD_NAME4, 20,
    FIELD_NAME5, 30); 
```

以“每个字段名称一次调用”的方式执行此操作会导致函数本身的代码更简单，并且不会降低调用的可读性。此外，它还允许编译器正确检测它无法对可变参数执行的某些错误，例如不正确的类型或用户提供的计数与实际计数不匹配。

如果你真的*必须*能够调用一个函数来做到这一点，我会选择：

```
void update (char *k1, int v1) {
    ...
}
void update2 (char *k1, int v1, char *k2, int v2) {
    update (k1, v1);
    update (k2, v2);
}
void update3 (char *k1, int v1, char *k2, int v2, char *k3, int v3) {
    update (k1, v1); /* or these two could be a single */
    update (k2, v2); /*   update2 (k1, v1, k2, v2);    */
    update (k3, v3);
}
/* and so on. */ 
```

如果您愿意，您甚至可以将高级函数用作宏，而不会失去类型安全性。

我倾向于使用 varargs 函数的唯一地方是提供相同的功能时`printf()`- 例如，我偶尔不得不编写具有`logPrintf()`提供相同功能等功能的日志库。在我需要使用它的煤面上，我想不出*任何*其他时间（我的意思是，很长:-)。

顺便说一句，如果您决定使用可变参数，我倾向于使用哨兵而不是计数，因为这样可以防止添加字段时出现不匹配。您很容易忘记调整计数并最终得到：

```
update (2, k1, v1, k2, v2, k3, v3); 
```

添加时，这是阴险的，因为它会默默地跳过 k3/v3，或者：

```
update (3, k1, v1, k2, v2); 
```

删除时，这对程序的成功运行几乎肯定是致命的。

有一个哨兵可以防止这种情况（只要你不忘记哨兵，当然）：

```
update (k1, v1, k2, v2, k3, v3, NULL); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-14T22:51:04.937

C 中 varargs 的一个问题是您不知道传递了多少参数，因此您需要将其作为另一个参数：

```
update(2, FIELD_NAME1, 10, FIELD_NAME2, 20);

update(3, FIELD_NAME1, 10, FIELD_NAME2, 20, FIELD_NAME3, 30); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-14T22:57:52.660

为什么没有一个参数，一个数组。更好的是，指向数组的指针。

```
struct field {
  int val;
  char* name;
}; 
```

甚至...

```
union datatype {
  int a;
  char b;
  double c;
  float f;
// etc;
}; 
```

然后

```
struct field {
  datatype val;
  char* name;
};

union (struct* field_name_val_pairs, int len); 
```

好的 2 个参数。我撒了谎，并认为长度参数会很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-14T22:55:16.770

我会仔细研究任何设计用于外部（甚至内部）使用的“更新”功能，它使用相同的功能来更新结构中的许多不同字段。是否有特定原因导致您不能使用离散功能来更新字段？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-06T14:32:27.077

迄今为止给出的避免可变参数的原因都是好的。让我添加另一个尚未给出的，因为它不太重要，但可以遇到。可变参数要求参数在堆栈上传递，从而减慢函数调用。在某些架构上，差异可能是显着的。在 x86 上它不是很重要，因为它缺少寄存器，例如，在 SPARC 上，它可能很重要。最多可以在寄存器上传递 5 个参数，如果您的函数使用的局部变量很少，则不会进行堆栈调整。如果您的函数是叶函数（即不调用另一个函数），则也没有窗口调整。因此，通话费用非常小。使用可变参数，在堆栈上传递参数、堆栈调整和窗口管理的正常顺序是正常的，否则你的函数将不会 无法获取参数。这显着增加了通话成本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-22T06:22:53.230

这里的很多人都建议传递参数#，但是其他人正确地指出，这会导致隐蔽的错误，即字段# 发生变化，但传递给可变参数函数的计数却没有。我通过使用空终止来解决产品中的这个问题：

```
send_info(INFO_NUMBER,
          Some_Field,       23,
          Some_other_Field, "more data",
          NULL); 
```

这样，当复制和粘贴程序员不可避免地复制它时，他们不太可能搞砸。更重要的是，我不太可能把事情搞砸。

回顾最初的问题，你有一个函数必须更新一个包含很多字段的结构，并且结构会增长。将此类数据传递给函数的常用方法（在 Win32 和 MacOS 经典 API 中）是通过传递另一个结构（甚至可以是与您正在更新的结构相同的结构），即：

无效更新（更新结构 *update_info）；

要使用它，您将填充以下字段：

```
UPDATESTRUCTURE my_update = {
    UPDATESTRUCTURE_V1,
    field_1,
    field_2
};
update( &my_update ); 
```

稍后当您添加新字段时，您可以更新 UPDATESTRUCTURE 定义并重新编译。通过输入版本号，您可以支持不使用新字段的旧代码。

该主题的一个变体是为您不想更新的字段设置一个值，例如 KEEP_OLD_VALUE（理想情况下为 0）或 NULL。

```
UPDATESTRUCTURE my_update = {
    field_1,
    NULL,
    field_3
};
update( &my_update); 
```

我没有包含版本，因为我利用了这样一个事实，当我们增加 UPDATESTRUCTURE 中的字段数时，额外的字段将被初始化为 0 或 KEEP_OLD_VALUE。

# git - p4merge 错误 [GIT]

> ID：866262
> 
> 赞同：28
> 
> 时间：2009-05-14T22:48:02.357
> 
> 标签：git, perforce, git-p4, p4merge

我正在尝试将 p4merge 与 git 一起使用，但我得到：

**启动 p4merge 时出错：“path/myFile”是（或指向）无效文件**（这列出了文件的 BASE、LOCAL、REMOTE 和标准版本）。

Git 告诉我冲突，然后它询问我是否要启动配置的合并工具（p4merge），然后我得到上面的错误。

附加说明：任何文件都会发生这种情况！

关于这是什么以及如何解决它的任何线索？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-08-02T02:02:29.823

这对我在 Windows 7 上使用 msysGit 有用：

```
git config --global merge.tool p4merge
git config --global mergetool.p4merge.cmd 'p4merge $BASE $LOCAL $REMOTE $MERGED' 
```

不知道为什么，但引用把事情搞砸了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-15T06:01:22.690

您将[在这里看到](https://stackoverflow.com/questions/861995/is-it-possible-for-git-merge-to-ignore-line-ending-differences/862920#862920)我的 DiffMerge 或 KDiff3 配置。

基于此，我会推荐 p4merge：

```
git config --global merge.tool merge
git config --global mergetool.merge.cmd "merge.sh \"$PWD/$LOCAL\" \"$PWD/$BASE\" \"$PWD/$REMOTE\" \"$PWD/$MERGED\"" 
```

并且`merge.sh`作为包装器（复制到`PATH`环境变量引用的目录中），能够考虑不`BASE`存在的情况。
（当在两个不同的分支中创建文件然后合并时，该文件将没有共同的祖先）

```
#!/bin/sh

# Passing the following parameters to mergetool:
#  local base remote merge_result

alocal=$1
base=$2
remote=$3
result=$4

if [ -f $base ]
then
    p4merge.exe -dl "$base" "$alocal" "$remote" "$result" 
else
    p4merge.exe -dl "$result" "$alocal" "$remote" "$result" 
fi 
```

你可能会注意到：

*   `PWD`在合并的配置中使用
*   使用“ `merge`”作为 merge.tool 名称的名称（因为在`merge.sh`脚本中调用了实际工具，您可以在其中切换任意数量的合并工具）
*   在脚本中使用双引号将`$base`, `$alocal`, `$remote`,括起来`$result`
*   调用工具的条件路径，基于“基础”文件的存在。
*   需要始终将 3 个文件合并为参数（即使“基础”不存在......）

* * *

刚刚对其进行了测试（事实证明，即使您没有安装任何其他 P4 产品，您也只能[下载和安装 p4merge——客户端/可视合并工具部分）。](http://www.perforce.com/perforce/downloads/component.html)

使用上述设置，MSysGit1.6.3，DOS 会话或 Git bash 会话：
它只适用于^(TM)。

* * *

更新**msysgit 1.7.x**

[Benjol](https://stackoverflow.com/users/11410/benjol)在评论中提到：

> **p4merge 现在由 msysgit 本机支持**。
> 
> 这意味着您可以这样做：

```
git config --global merge.tool p4merge
# and I recommend 
git config --global mergetool.keepBackup false 
```

# lua - 静态分析 Lua 代码的潜在错误

> ID：866266
> 
> 赞同：12
> 
> 时间：2009-05-14T22:48:37.050
> 
> 标签：lua, code-analysis, static-analysis

我正在使用一个封闭源代码的应用程序，它加载 Lua 脚本并允许通过修改这些脚本进行一些自定义。不幸的是，如果 Lua 脚本之一出现问题，该应用程序不太擅长生成有用的日志输出（我得到的只是“脚本失败”）。

我意识到动态语言几乎可以抵抗静态代码分析，例如可以分析 C++ 代码的方式。

不过，我希望会有一个工具通过 Lua 脚本运行，例如警告未在特定脚本的上下文中定义的变量。

基本上我正在寻找的是一个用于脚本的工具：

```
local a
print b 
```

会输出：

```
warning: script.lua(1): local 'a' is not used'
warning: script.lua(2): 'b' may not be defined' 
```

对于大多数事情，它只能是真正的警告，但这仍然很有用！这样的工具存在吗？或者可能是具有类似功能的 Lua IDE？

谢谢，克里斯

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-14T23:24:58.367

Lua 的自动静态代码分析通常不是一件容易的事。但是，对于有限的一组实际问题，它是完全可行的。

快速[搜索“lua lint”会](http://www.google.ru/search?q=lua+lint)产生这两个工具：[lua-checker](http://code.google.com/p/lua-checker/)和[Lua lint](http://lua-users.org/wiki/LuaLint)。

但是，您可能希望推出自己的工具以满足您的特定需求。

[Metalua](http://metalua.luaforge.net/)是最强大的静态 Lua 代码分析工具之一。例如，请参阅[metalint](http://github.com/fab13n/metalua/tree/master/src/samples/metalint)，用于全局变量使用分析的工具。

请不要犹豫，在[Metalua 邮件列表](http://lists.luaforge.net/mailman/listinfo/metalua-list)上发布您的问题。那里的人通常非常乐于助人。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-23T05:02:02.357

还有[lua-inspect](http://lua-users.org/wiki/LuaInspect)，它基于已经提到的 metalua。我已将它集成到[ZeroBrane Studio IDE](http://studio.zerobrane.com/)中，它会生成与您期望的非常相似的输出。有关详细信息，请参阅此 SO 答案：[https](https://stackoverflow.com/a/11789348/1442917) ://stackoverflow.com/a/11789348/1442917 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-18T12:59:20.267

要检查全局变量，请参阅[此 lua-l 张贴](http://lua-users.org/lists/lua-l/2006-05/msg00306.html)。检查当地人更难。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T23:04:30.943

您需要为 lua 找到一个解析器（应该作为开源提供）并使用它将脚本解析为适当的 AST 树。使用该树和一个简单的变量可见性跟踪器来找出变量何时定义或未定义。

通常范围规则很简单：

*   从顶部 AST 节点和一个空范围开始
*   item 查看该节点的子语句。每个变量声明都应该添加到当前范围内。
*   如果新范围正在启动（例如通过 { 运算符），则创建一个新的变量范围，继承当前范围中的变量）。
*   当范围结束时（例如通过 } ）删除当前子变量范围并返回到父级。
*   仔细迭代。

这将为您提供在 AST 中可见的变量。您可以使用此信息，如果您还检查表达式 AST 节点（变量的读/写），您可以找到您的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-04-04T16:38:00.380

我刚开始使用[`luacheck`](https://github.com/mpeterv/luacheck)，非常棒！

第一个版本是从 2015 年开始的。

# python - 如何构建多个提交按钮 django 表单？

> ID：866272
> 
> 赞同：178
> 
> 时间：2009-05-14T22:50:25.907
> 
> 标签：python, django, button, django-forms, submit

我有一个表单输入电子邮件和两个提交按钮来订阅和取消订阅时事通讯：

```
<form action="" method="post">
{{ form_newsletter }}
<input type="submit" name="newsletter_sub" value="Subscribe" />
<input type="submit" name="newsletter_unsub" value="Unsubscribe" />
</form> 
```

我也有班级形式：

```
class NewsletterForm(forms.ModelForm):
    class Meta:
        model = Newsletter
        fields = ('email',) 
```

我必须编写自己的 clean_email 方法，并且我需要知道表单是通过哪个按钮提交的。但是提交按钮的值不在`self.cleaned_data`字典中。否则我可以得到按钮的值吗？

* * *

## 回答 #1

> 赞同：263
> 
> 时间：2010-01-06T04:50:40.527

例如：

```
if 'newsletter_sub' in request.POST:
    # do subscribe
elif 'newsletter_unsub' in request.POST:
    # do unsubscribe 
```

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2009-05-14T23:03:30.370

您可以在验证前使用`self.data`in`clean_email`方法访问 POST 数据。它应该包含一个名为`newsletter_sub`或`newsletter_unsub`取决于按下哪个按钮的键。

```
# in the context of a django.forms form

def clean(self):
    if 'newsletter_sub' in self.data:
        # do subscribe
    elif 'newsletter_unsub' in self.data:
        # do unsubscribe 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2013-06-03T07:09:47.670

你也可以这样做，

```
 <form method='POST'>
    {{form1.as_p}}
    <button type="submit" name="btnform1">Save Changes</button>
    </form>
    <form method='POST'>
    {{form2.as_p}}
    <button type="submit" name="btnform2">Save Changes</button>
    </form> 
```

***代码***

```
if request.method=='POST' and 'btnform1' in request.POST:
    do something...
if request.method=='POST' and 'btnform2' in request.POST:
    do something... 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-03-29T03:42:16.650

同一个视图的一个网址！像这样！

网址.py

```
url(r'^$', views.landing.as_view(), name = 'landing'), 
```

视图.py

```
class landing(View):
        template_name = '/home.html'
        form_class1 = forms.pynamehere1
        form_class2 = forms.pynamehere2
            def get(self, request):
                form1 = self.form_class1(None)
                form2 = self.form_class2(None)
                return render(request, self.template_name, { 'register':form1, 'login':form2,})

             def post(self, request):
                 if request.method=='POST' and 'htmlsubmitbutton1' in request.POST:
                        ## do what ever you want to do for first function ####
                 if request.method=='POST' and 'htmlsubmitbutton2' in request.POST:
                         ## do what ever you want to do for second function ####
                        ## return def post###  
                 return render(request, self.template_name, {'form':form,}) 
```

```
/home.html
    <!-- #### form 1 #### -->
    <form action="" method="POST" >
      {% csrf_token %}
      {{ register.as_p }}
    <button type="submit" name="htmlsubmitbutton1">Login</button>
    </form>
    <!--#### form 2 #### -->
    <form action="" method="POST" >
      {% csrf_token %}
      {{ login.as_p }}
    <button type="submit" name="htmlsubmitbutton2">Login</button>
    </form> 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-05-06T22:00:44.473

现在这是一个老问题，但我遇到了同样的问题并找到了一个适合我的解决方案：我写了 MultiRedirectMixin。

```
from django.http import HttpResponseRedirect

class MultiRedirectMixin(object):
    """
    A mixin that supports submit-specific success redirection.
     Either specify one success_url, or provide dict with names of 
     submit actions given in template as keys
     Example: 
       In template:
         <input type="submit" name="create_new" value="Create"/>
         <input type="submit" name="delete" value="Delete"/>
       View:
         MyMultiSubmitView(MultiRedirectMixin, forms.FormView):
             success_urls = {"create_new": reverse_lazy('create'),
                               "delete": reverse_lazy('delete')}
    """
    success_urls = {}  

    def form_valid(self, form):
        """ Form is valid: Pick the url and redirect.
        """

        for name in self.success_urls:
            if name in form.data:
                self.success_url = self.success_urls[name]
                break

        return HttpResponseRedirect(self.get_success_url())

    def get_success_url(self):
        """
        Returns the supplied success URL.
        """
        if self.success_url:
            # Forcing possible reverse_lazy evaluation
            url = force_text(self.success_url)
        else:
            raise ImproperlyConfigured(
                _("No URL to redirect to. Provide a success_url."))
        return url 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-08-02T11:07:43.437

我知道这是旧的，但至少可以说，有些答案很简短，而且它们没有解决表单不是 django 表单的常见情况。

这个解决方案的灵感来自[这篇博文](https://simpleit.rocks/python/django/having-multiple-submit-buttons-for-same-form-in-django/)。它依赖于使用从 django.views.generic.edit.FormMixin 派生的视图类，例如 CreateView、UpdateView 或 DeleteView。这些提供了*get_success_url方法，该方法在**请求*中公开按钮名称

 ***html**

```
<html>
    <body>
        <form method="post">
            <div>
                <label> <input type="radio" name="select-type" value="A">Type A</label>
            </div>
            <div>
                <label> <input type="radio" name="select-type" value="B">Type B</label>
            </div>
            <div>
                <input type="submit" value="Use selected">
            </div>
            <div>
                <input type="submit" name="no-selection" value="None of the above">
            </div>
        </form>
    </body>
</html> 
```

**视图.py**

```
from django.views.generic import UpdateView

class GetType(UpdateView):
    def get(self, request):
        return render(request, 'get_type.html', {})

    def post(self, request):
        button = self.get_success_url()
        print(button)

    def get_success_url(self):
        if 'no-selection' in self.request.POST:
            return 'none selected'
        return '' 
```

# .net - 与 LINQ-SQL 设计器失去 FK 关系

> ID：866278
> 
> 赞同：0
> 
> 时间：2009-05-14T22:51:30.210
> 
> 标签：.net, linq-to-sql

我的数据库中有三个表（实际上不止这些），它们是：

```
Users
-----------
ID (PK)   
Name

Sites
-----------
ID (PK)  
SiteName

Users_Sites
-----------
ID (PK)  
UserID (FK to Users.ID)  
SiteID (FK to Sites.ID) 
```

并且我对 Users_Sites 表中的 UserID 和 SiteID 有唯一约束。都是非常标准的东西。

我的问题是，当将这些表拖到 LINQ-SQL 设计器中时，我可以看到 Sites 和 Users_Sites 表之间的关系，但看不到 Users 和 Users_Sites 表之间的关系。我尝试在 SQL 企业管理器中创建一个等效图表，它验证了这些关系确实存在。

LINQ-SQL 设计器是否存在已知问题，或者我应该做些什么特别的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T23:22:30.977

嘿 mdresser，我知道这听起来可能很愚蠢，但是您尝试过重新启动 Visual Studio 吗？

我已经多次遇到这种情况，而且它总是 Visual Studio 2008 有点精神。

每次重新启动它都会修复它。

只需确保您的关系实际上在数据库中，并确保您在拖入之前已在服务器资源管理器中刷新了您的连接。

最后，在添加表之前进行构建有时会有所帮助......

我知道这听起来很随机，但请告诉我

干杯

# jquery - Jquery在DIV中多次加载

> ID：866284
> 
> 赞同：11
> 
> 时间：2009-05-14T22:53:56.867
> 
> 标签：jquery, html, load

这是我的代码：

```
$('#right').load('textes.html #nicolas');
$('#right').load('textes.html #antoine'); 
```

问题是`div`antoine的内容覆盖了右边的div nicolas加载的内容`div`

```
div #right : load div nicolas from file textes.html = ok
div #right : load div antoine from file textes.html = overwrite content = No! 
```

我想将 antoine 添加到 nicolas。这是添加 nicolas 然后添加 antoine 所以`#right`将是 nicolas + antoine

我试图将内容放入 var 中，但没有成功。

任何的想法 ？

* * *

最重要的是......我想在`<hr>`每次加载之间添加一条规则

* * *

也许是这样的，但这不起作用。

```
$('#right').load('textes.shtml #nicolas').append('<hr>').load('textes.shtml #antoine'); return false; 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-15T18:14:18.747

也许我遗漏了一些东西，但似乎你们都错过了这样一个事实，即这是一个 ajax 调用，并且您是在程序上调用函数，而不是作为基于成功 ajax 响应的回调函数。

此外，如果您做的事情比将一些 (X)HTML 加载到元素中更复杂，您可能应该使用更强大的 jQuery ajax 方法之一（即 get() 或 post() 或 ajax()）。

假设您将在响应中获得 (X)HTML：

```
// Only ONE ajax call and very simply parsing... 
$.get('textes.html', {}, function(data) {
    var $response = $('<div />').html(data);
    var $nicolas = $response.find('#nicolas')
    var $antoine = $response.find('#antoine');
    $('#right').append($nicolas).append($antoine);
},'html'); 
```

真的就这么简单。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-14T22:57:22.443

为什么不在一次调用中同时加载它们：

```
$('#right').load('textes.html #nicolas,#antoine'); 
```

**编辑**
受正义的启发，我想到了以下内容：

```
var $page = $('<div />').load('textes.html #nicolas,#antoine');
var $nicolas = $page.find('#nicolas');
var $antoine = $page.find('#antoine');
$('#right')
 .html($nicolas)
 .append('<hr/>')
 .append($antoine); 
```

这将只对服务器进行一次（或两次，取决于 Firefox 的感觉）调用。从而节省带宽。但它也让您在如何插入元素以及以何种顺序插入元素方面拥有更多自由。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T17:55:20.413

这是解决方案的完整源代码。

我在 JSBin.com 上托管了一个工作示例：http://jsbin.com/ulodu [（](http://jsbin.com/ulodu)可通过[http://jsbin.com/ulodu/edit](http://jsbin.com/ulodu/edit)编辑）

```
<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
<title>Sandbox</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<script>
$(function(){
  $.get(
    'http://jsbin.com/oyuho',
    function(response){
      /* 
        Wrap the response in a <div /> so that we can use
        find() instead of filter(). Also remove <script> tags.
        This is essentially what $.load() does.
      */  
      var responseWrapper = $('<div />').append(response.replace(/<script(.|\s)*?\/script>/g, ""))
      $('#content')
        .append(responseWrapper.find('#nicolas'))
        .append('<hr />')
        .append(responseWrapper.find('#antoine'));
    }
  );
});
</script>
</head>
<body>
  <div id="content"></div>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T22:58:24.453

```
var nicolas = $('<div />').load('textes.html #nicolas');
var antoine = $('<div />').load('textes.html #antoine');
$('#right')
    .append(nicolas.children())
    .append('<hr />')
    .append(antoine.children())
; 
```

或者，Pim Jager 的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T22:59:24.450

请参阅[appendTo](http://docs.jquery.com/Manipulation/appendTo#selector)函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T19:29:03.217

我得到了它与 KyleFarris 真正简单的答案一起工作

我什至把它简化了一点，它工作得很好

谢谢大家，这是最终代码：

```
<script>
$.get('textes.shtml', {}, function(data) {
    var $response = $('<div />').html(data);
    $('#right')
    .append($response.find('#nicolas'))
    .append('<hr />')
    .append($response.find('#antoine'));
},'html');
</script> 
```

# c# - 记录到自定义事件日志（C# 应用程序，但使用 win32 API）

> ID：866290
> 
> 赞同：0
> 
> 时间：2009-05-14T22:56:57.810
> 
> 标签：c#, pinvoke, event-log

由于 .NET EventLog 类的限制，我有一些使用 PInvoke 记录到应用程序日志的代码。该代码可以正常工作。

但是现在，我想登录到自定义事件日志。因此，我尝试将 RegisterEventSource 的第二个参数更改为“companyX”（我的自定义日志）。它*正确地写入“companyX”*（而不是应用程序日志），但它*也将（单个日志条目的）源字段设置*为“companyX”，这不是我想要的。

那么如何将代码修改为：

*   使用新的自定义事件日志（“companyX”），但也
*   使用正确的源值（“MyApp”）

目前，它要么正确写入应用程序日志（使用正确的 Source 值“MyApp”），要么写入自定义（“companyX”）事件日志，并使用**不正确**的Source 值（而不是“MyApp”，它将 Source 值设置为“companyX”，即自定义日志的名称）。

编辑：请注意，“companyX”日志已经创建（在 WIX 安装程序代码中）。

这是我的代码：

```
private void WriteEntryToLog(string msg, LogEventType entryType)
{
    // ApplicationName = "MyApp"
    // The code as-is is writing to the Application log. Changing the 2nd param of
    // the function below to "companyX" allows me to write to my "companyX" event log,
    // but also changes the Source value of each entry append to that log to "companyX" rather than "MyApp"
    IntPtr eventSrcHandle = NativeMethods.RegisterEventSource(null, Resources.ApplicationName);

    try
    {
        uint tokenInfoSize = 0;
        IntPtr userTokenPtr = WindowsIdentity.GetCurrent().Token;
        const UInt16 typeError = 1, typeWarning = 2, typeInformation = 4;

        //using this first call, get the length required to hold the token information in the tokenInfoSize parameter
        bool bresult = NativeMethods.GetTokenInformation(userTokenPtr, NativeMethods.TOKEN_INFORMATION_CLASS.TokenUser, IntPtr.Zero, tokenInfoSize, out tokenInfoSize);
        if (bresult) throw new Win32Exception(Marshal.GetLastWin32Error());

        IntPtr userTokenInfo = Marshal.AllocHGlobal((int)tokenInfoSize);
        try
        {
            //get the user token now with the pointer allocated to the right size
            bresult = NativeMethods.GetTokenInformation(userTokenPtr, NativeMethods.TOKEN_INFORMATION_CLASS.TokenUser, userTokenInfo, tokenInfoSize, out tokenInfoSize);
            if (!bresult) throw new Win32Exception(Marshal.GetLastWin32Error());

            UInt16 type = typeError;
            switch (entryType)
            {
                case LogEventType.Error:
                    type = typeError; 
                    break;
                case LogEventType.Warning:
                    type = typeWarning; 
                    break;
                case LogEventType.Information:
                    type = typeInformation; 
                    break;
                    default: 
                        type = typeInformation; 
                        break;
            }

            NativeMethods.TOKEN_USER tokUser = (NativeMethods.TOKEN_USER)Marshal.PtrToStructure(userTokenInfo, typeof(NativeMethods.TOKEN_USER));

            string[] message = new string[1];
            message[0] = msg;
            bresult = NativeMethods.ReportEvent(eventSrcHandle, type, 0, 0, tokUser.User.Sid, 1, 0, message, new byte());
            if (!bresult) throw new Win32Exception(Marshal.GetLastWin32Error());
        }
        finally
        {
            Marshal.FreeHGlobal(userTokenInfo);
        }
    }
    finally
    {
        NativeMethods.DeregisterEventSource(eventSrcHandle);
    } 
```

}

哦，这不是这里问题的重复： [ASP.NET 错误的事件日志源属性的自定义值，](https://stackoverflow.com/questions/499645/custom-value-for-the-event-log-source-property-for-asp-net-errors) 因为我必须为此使用 PInvoke。=)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T03:32:11.503

您必须创建一个名为 MyApp 的源并将其映射到您的日志“CompanyX”。

本文详细介绍了使用 .Net Framework BCL 创建事件源。

[http://msdn.microsoft.com/en-us/library/5zbwd3s3.aspx](http://msdn.microsoft.com/en-us/library/5zbwd3s3.aspx)

此更改需要对注册表进行更新访问。

# selenium - 接受 xxx.1.2.3.4.theservice.com 并解析为 IP 1.2.3.4 的服务

> ID：866292
> 
> 赞同：0
> 
> 时间：2009-05-14T22:57:12.257
> 
> 标签：selenium, dns

有谁知道那里的免费服务需要 xxx.1.2.3.4.theservice.com 并解析为 IP 1.2.3.4？

我需要这个，以便我可以启动 ec2 框并将我的 selenium 测试脚本指向它们。我只会使用 IP，但我需要子域才能工作。还是有其他方法可以实现相同的目标？我不想弄乱我的测试计算机上的主机文件。

更具体地说，我需要一个 dns 条目 X，以便 music.X 和 www.X 和 mail.X 都解析到我的 IP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-28T20:06:55.447

听起来您需要做的是设置自己的内部 DNS 服务器。

您可以创建您想要的任何域，并且您指向该服务器的任何系统都将使用您创建的条目。

# wcf - ChannelFactory.Close VS IClientChannel.Close

> ID：866302
> 
> 赞同：33
> 
> 时间：2009-05-14T22:59:28.710
> 
> 标签：wcf, channelfactory

考虑以下代码，它是许多 ChannelFactory 示例的典型代码：

```
WSHttpBinding myBinding = new WSHttpBinding();
EndpointAddress myEndpoint = new EndpointAddress(
   ConfigurationSettings.AppSettings["HelloWorldServiceURL"]);  

ChannelFactory<IHelloWorldService> myChannelFactory = 
   new ChannelFactory<IHelloWorldService>(myBinding, myEndpoint);

IHelloWorldService proxy = myChannelFactory.CreateChannel();
((IClientChannel)proxy).Open();
HelloWorldDataContract dc = proxy.SayHello();
((IClientChannel)proxy).Close(); 
```

请注意，调用 proxy.Open() 时，通道的状态和 ChannelFactory 的状态都变为“已打开”。当调用 proxy.Close() 时，通道的状态变为“关闭”，但 ChannelFactory 的状态保持为“打开”。

是否也应该关闭 ChannelFactory？我似乎在很多例子中都没有看到这一点。此外，如果可能，请解释打开通道与打开通道工厂之间的区别。

此外，我知道[IDisposable 问题](https://stackoverflow.com/questions/573872/what-is-the-best-workaround-for-the-wcf-client-using-block-issue)，所以为了这个问题，它可能可以被忽略，除非它对答案有直接影响。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-02-15T17:14:48.630

我发现主要答案不准确，所以我在这里回复。

显然，微软已经把频道、工厂和客户**搞得一团糟。**文档也没有帮助，因为它们似乎只是为了掩盖混乱，所以我不得不求助于测试。

由于非缓存通道的性能问题，[v3.5](http://blogs.msdn.com/b/wenlong/archive/2007/10/27/performance-improvement-of-wcf-client-proxy-creation-and-best-practices.aspx)中的实现进行了更改以解决这些问题并添加了缓存，但这只会使问题复杂化。

关键是 channel in实际上与使用创建通道时使用`ChannelFactory`的通道没有什么不同。都是同一个锅。不信？尝试：`IClientChannel``ChannelFactory.CreateChannel()`

```
ChannelFactory<IService> factory = new ChannelFactory<IService>();
// ...
IService service = factory.CreateChannel();
factory.Close();
service.DoIt() // Throws object disposed exception 
```

所以实际上，在内部它都是同一个渠道。我个人已经开始处理通道工厂而不是客户端通道，并且没有遇到任何问题。我也尝试在循环中创建 100000 个客户端通道，并且只关闭`ChannelFactory`.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-14T23:21:37.267

如您所知，ChannelFactory 根据配置创建客户端通道。您可能希望从现有工厂创建多个客户端通道（与锁定的端点相同）。如果您已经使用工厂创建通道，没有理由不关闭它。

但是，你为什么要让它保持开放呢？这是[一篇关于 WCF 客户端的有趣文章，](http://msdn.microsoft.com/en-us/library/ms733912.aspx)它说：

> 检查 System.ServiceModel.ICommunicationObject.State 属性的值是一种竞争条件，不建议确定是重用还是关闭通道。

与其重用通道，您可能只想使用通道工厂创建一个新通道。[更多关于客户端架构的信息在这里](http://msdn.microsoft.com/en-us/library/ms729718.aspx)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-09-14T19:53:06.120

另一种选择是使用静态 CreateChannel 方法： [msdn.microsoft.com/en-us/library/aa344556.aspx](http://msdn.microsoft.com/en-us/library/aa344556.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-10-25T08:25:57.670

答案已经在这里，但它分布在几个评论和答案中，并不完全清楚，因此我的答案是。

> 是否应该关闭 ChannelFactory 以及 Channel？

不，如果你想从每个 ChannelFactory 创建多个 Channel，你应该处理 ChannelFactory，它会处理它为你创建的所有 Channel。

如果您想为每个（端点、绑定）对创建一个通道，您应该使用[这个静态函数](https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.channelfactory-1.createchannel?redirectedfrom=MSDN&view=netframework-4.7.2#System_ServiceModel_ChannelFactory_1_CreateChannel_System_ServiceModel_Channels_Binding_System_ServiceModel_EndpointAddress_)：（`ChannelFactory<ServiceType>.CreateChannel(binding, endpoint)`这可以避免这个问题，因为它不会创建第二个 IDisposable），并且您应该处理它返回的通道。

处理 channelfactory 和它创建的任何通道都会引发 ObjectDisposed 异常。

# memory - 长期背诵技巧成为该领域的专家？

> ID：866304
> 
> 赞同：1
> 
> 时间：2009-05-14T23:00:31.140
> 
> 标签：memory, mnemonics

我熟悉一些**助记符/记忆** [技巧](http://en.wikipedia.org/wiki/Method_of_Loci)大约一年。

我认为这种技术可以给开发人员带来显着的好处，甚至可以让你成为该领域的专家。

如果你熟悉这个技巧，你就知道**有助记技巧可以长期记忆**。我们经常读很多书，有很多概念你不记得了，因为它们不会经常出现在你的日常编码生活中。因此，您需要在数月和数年后一次又一次地学习它。

框架的情况相同。熟悉框架的语法、有用的代码结构等需要一些时间。但是一段时间后，您会忘记以前框架（或您很少使用的框架 - 但它对您来说非常重要）中的许多概念。

通过使用这种技术，您可以随着时间的推移建立可持续的知识库，该知识库将**可靠地**增长——您可以确信，一段时间后您不会忘记之前学到的概念。

请告诉我你对这个想法有什么看法？您已经熟悉助记符技术，请谈谈您的经验 - 听到它会非常有用和有趣。

**有用的链接：**

[位点法](http://en.wikipedia.org/wiki/Method_of_Loci)

[助记符](http://en.wikipedia.org/wiki/Mnemonic)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-14T23:02:12.323

**我最喜欢的方法：**

[输入谷歌](http://www.google.com)

我是认真的 - 为什么你需要记住它？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-14T23:05:16.683

你不会记住如何成为一名优秀的程序员，就像你不会记住如何成为一名优秀的古典小提琴手一样。你*练习*，*练习*，*练习*。这会让你自然而然地回忆起最重要的结构，正如 Chad 所说，谷歌是为那些不太重要的结构准备的。我从来没有觉得需要使用助记工具或死记硬背来学习编程结构或技术。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-14T23:10:42.893

“该领域的专业知识”与记住函数调用无关。它是关于分解问题并在最短的时间内提供高性能、可维护、可靠的解决方案的能力。

您可以记住 STL 中的每个函数调用，并且仍然是一个完整的新手程序员。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T23:15:48.093

几年前，我读了 Harry Lorrayne 的《记忆之书》，发现其中的技巧对于记住相关事实非常有用。但是，根据我的经验，这些技术可能更有用，即：

*   从长远来看，这种记忆往往不起作用。如果我没有练习记住一个特定的列表或事实主体，我最终会在几天或几周内完全忘记它们。

*   我很难将这些技术应用于分层数据集，比如类库。这使得它们在编程方面的使用变得不那么强大。

*   这些技术对于可以通过语音或单个文本流轻松解释的事物非常有用。但是，我很难将它们应用于更直观的事物，例如数学方程式。

也就是说，我在为谷歌无法替代的东西编码时使用了 Mnumonic 技术。我有时会使用数字记忆技巧来回忆特定的代码行（通过它的行号），而我在代码文件中跳转，或者在文件之间跳转时记住函数名称。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T23:19:29.567

同意其他答案，您可以专注于改进的一些更有用的事情是：

*   解决问题，使用“消除”技术，基本上消除问题区域，一个接一个，直到找到正确的区域
*   快速获取我需要的资源/API/信息 - 使用 Google、SO、CodePlex、Google 代码、Koders.com 代码搜索、谷歌代码搜索、MSDN 等 - 知道哪些信息在哪里足以大大节省时间
*   避免颠簸（在问题上停留太久，没有结果），一旦你在问题上花费了足够的时间，通过向他人提供关于你的问题的“完整”和“相关”信息，你可以帮助他人帮助你

最后，记忆编程理论并没有什么帮助，但是仅仅阅读、听专家和播客、参加会议对“从记忆中获取信息”有很大帮助

高温高压

# html - 使用动画 PNG 图像时避免浏览器不兼容

> ID：866314
> 
> 赞同：1
> 
> 时间：2009-05-14T23:05:03.733
> 
> 标签：html, png, cross-browser

[动画 PNG 图像 (APNG)](http://en.wikipedia.org/wiki/APNG)已经存在了很长一段时间，试图将 GIF 格式的这一功能添加到 PNG 图像中。根据[Wikipedia](http://en.wikipedia.org/wiki/APNG)，Opera (>= 9.5) 和 Firefox (>= 3.0) 支持它们。如果浏览器不支持 APNG 图像，则会显示 APNG 动画中的第一帧，因为它被定义为广泛支持的 PNG 格式的扩展。假设您有一个动画 PNG 想要在您的站点中显示，并且您想要警告您的用户，如果他们的浏览器不支持它。你会怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T23:12:04.123

让第一个图像显示很短的时间，让它成为一个大而丑陋的错误信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T23:15:38.077

如果第一帧不是有用的图像，而动画很重要，那么在您的网站中使用它们可能还为时过早。最好等到更多浏览器支持它。

如果由于某种原因它们很重要并且必须使用，那么我会在第一帧中包含一条错误消息，就像 Adam Jaskiewicz[建议](https://stackoverflow.com/questions/866314/avoiding-browser-incompatibilities-when-using-animated-png-images/866331#866331)的那样，但是，支持 APNG 的用户会在短时间内看到警告。

显然可以检测到支持，如[这篇关于 Ajaxian的文章](http://ajaxian.com/archives/detect-if-the-browser-supports-apng)

# schema - 如何将多个 biztalk 应用程序引用的通用模式组织在同一个组中？

> ID：866319
> 
> 赞同：5
> 
> 时间：2009-05-14T23:07:25.430
> 
> 标签：schema, biztalk

我有一种情况是我需要在两个不同的 BizTalk 应用程序中引用一个架构。

我可以：

将架构放在一个应用程序中，并使其他应用程序具有对它的引用。

或者

将模式放在一个公共应用程序中，所有其他应用程序都引用这个公共应用程序。

但是，在上述两种情况下，如果架构有任何更改，我最终不得不重建/重新部署所有引用该架构的应用程序。有没有更好的组织应用程序的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T13:49:56.243

从 Microsoft [Biztalk 操作指南](http://download.microsoft.com/download/a/a/d/aad035e6-e03b-4bea-ad9a-fa1ff8d10ca0/BTS06R2_OpReadiness.docx)：

> 在单独的应用程序中部署共享工件 - 如果工件将由两个或更多应用程序共享，请将共享工件部署到单独的应用程序中。例如，如果两个应用程序共享一个模式，则将该模式放在一个单独的应用程序中。我们建议这样做，因为 BizTalk 组中只有一个项目可以有一个本地唯一标识符 (LUID)。LUID 由工件名称和可选的其他属性组成。如果您在一个应用程序中包含一个工件，然后从另一个应用程序创建对它的引用，则当您停止包含该工件的应用程序时，引用的应用程序可能无法正常运行。此最佳实践适用于所有工件类型，但文件除外，例如自述文件和脚本，它们作为文件类型的工件添加到应用程序中。这是因为可以在 BizTalk 组中部署多个具有相同名称的文件项目。因此，您可以在两个或多个应用程序中使用具有相同名称的文件。在这种情况下，停止一个应用程序不会影响另一个应用程序。有关添加文件项目的详细信息，请参阅 BizTalk Server 2006 R2 帮助中的“如何将文件添加到应用程序”，网址为[http://go.microsoft.com/fwlink/?LinkId=106818](http://go.microsoft.com/fwlink/?LinkId=106818)。

共享应用程序中的模式真的不应该因为它们被共享而改变，这是一个重大事件。如果您要添加模式或修改现有地图，则无需重新构建旧应用程序。您可能必须回收相关主机实例以使它们刷新它们在内存中的 dll 副本。否则应该是 95% 无忧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T20:55:25.020

我们将通用模式和功能放入单独的应用程序中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T13:37:21.843

我不确定我是否理解你的问题，所以如果我不在基地，请纠正我。

您应该将模式组织为它们自己的程序集，可以独立部署到所有需要它的应用程序。然后它们可以在开发过程中被其他项目引用。部署后，如果对模式进行了更改；只需在服务器上更新模式程序集；将保留应用程序对模式的引用。

希望这可以帮助。

# sql-server - T-SQL 中的变量赋值

> ID：866325
> 
> 赞同：0
> 
> 时间：2009-05-14T23:08:57.407
> 
> 标签：sql-server, tsql

在我的功能结束时，我有以下声明：

```
RETURN @Result 
```

我想做的是这样的：

```
IF (@Result = '')
BEGIN
@Result = 'Unknown'
END

RETURN @Result 
```

以上不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T23:11:44.653

```
SET @Result = 'Unknown' 
```

;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T23:12:24.327

```
IF (@Result = '')
BEGIN
    SELECT @Result = 'Unknown'
END

RETURN @Result 
```

请注意，在 T-SQL 中进行赋值的方式是`SELECT`语句。您也可以使用该`SET`语句，尽管不鼓励这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-14T23:13:00.050

更改此行

```
@Result = 'Unknown' 
```

到

```
set @Result = 'Unknown' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T23:25:34.747

我认为您需要检查@result 是否为NULL，因为NULL 与'' 不同

```
IF (ISNULL(@Result, '') = '')
BEGIN
    SET @Result = 'Unknown'
END

RETURN @Result 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-16T10:46:00.000

如果 (@Result = '')

开始

```
SET @Result = 'Unknown' 
```

结尾

返回@结果

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-31T18:50:39.670

```
SET @Result = 'Unknown' 
```

@Justice：根据微软的说法 - [MSDN](http://msdn.microsoft.com/en-us/library/ms187330.aspx) `SELECT @Result = 'Unknown'`通常不鼓励

# c# - 如何绘制自定义 DataGridViewCell

> ID：866334
> 
> 赞同：2
> 
> 时间：2009-05-14T23:12:30.970
> 
> 标签：c#, winforms

我正在尝试在 DataGridView 中手动绘制单元格。具体来说，我想画一排复选框。通常你可以添加一个DataGridViewCheckBoxColumn，但据我所知，没有DataGridViewCheckBoxRow。（我不能只创建很多 DGVCheckBoxColumns，因为我想要不同行中的不同单元格类型）。

我已经覆盖了 DGV 的 OnCellPainting() 方法。我创建了一个 DGVCheckBoxCell：

```
protected override void OnCellPainting(DataGridViewCellPaintingEventArgs e)
{
   DataGridViewCheckBoxCell cbcell = new DataGridViewCheckBoxCell();
} 
```

我不确定下一步该怎么做。

* * *

更多信息：

我最终试图转置一个datagridview。所以我可能有一个 CheckBoxColumn、一个 ComboBoxColumn、一个 TextBoxColumn 和任何其他类型的列，然后将它们变成行。我不认为我可以制作 DGVRows，所以我认为我将不得不处理单个单元格。

感谢您到目前为止的所有答案...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T23:32:31.093

我唯一能想到的就是自己绘制复选框，这可以完成，但它是一个 PIA。因为一旦你这样做了，你就必须控制所有的绘画以进行悬停/检查/取消检查等......但是，这里有一些代码可以帮助你入门：

```
void dataGridView1_CellPainting(object sender, DataGridViewCellPaintingEventArgs e)
{
    e.Paint(e.ClipBounds, DataGridViewPaintParts.All);
    if (e.RowIndex == 2) //I chose a random number, but this is the row you want with checkboxes
    {
        var rect = this.dataGridView1.GetCellDisplayRectangle(e.ColumnIndex, e.RowIndex, true);
        //The CheckBoxState enum has all different values for different "visual states"
        CheckBoxRenderer.DrawCheckBox(e.Graphics, new Point(rect.X, rect.Y), System.Windows.Forms.VisualStyles.CheckBoxState.CheckedNormal);
        e.Handled = true;
    }
} 
```

祝你好运！！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T23:29:35.593

据我所知，您有两种选择：

1.  创建一个从 DataGridViewCell 派生的特殊 Cell 类型，该类型的行为取决于该单元格的内容。然后，您可以将该 Cell 类型设置为每列的 CellTemplate，DataGridView 将自动构造它的实例以供使用。痛苦，但相对容易理解，做起来也不难——只是乏味。

2.  与 #1 相同，但不是创建一个古怪的 Cell 类型，而是创建一个特殊的 CellTemplate 并覆盖其 Clone 方法。让 Clone 方法自动确定要构造的正确单元格类型并返回，而不是返回模板的原始克隆。这是一个可怕的 hack，除非您无法获得第一种工作方法，否则我不推荐它。

成功使用第二种方法需要了解当前正在构建的行（如果您查看 Reflector 中的 DataGridViewRow.CreateCells，您可以了解它是如何工作的）。知道要构造哪种类型需要了解当前行，而且我不能 100% 确定你能做到这一点。但我怀疑如果你愿意试一试并四处挖掘，这是可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:44:40.783

这里有人问同样的问题：[vbforums.com](http://www.vbforums.com/showthread.php?p=3352360)

> “您需要创建新的 DataGridViewTextBoxCell 对象并将它们分配给该行的 Cells 集合的项目。”

我还没有想出如何做到这一点。
在[这篇文章](http://weblogs.asp.net/kdente/archive/2005/02/20/377119.aspx)中，作者写道这是可能的。

您的场景是数据绑定的吗？

# java - 用Java比较两个Excel文件的最简单方法？

> ID：866346
> 
> 赞同：18
> 
> 时间：2009-05-14T23:16:18.107
> 
> 标签：java, file, binary, compare

我正在为一些生成 Excel 文件（二进制文件）的代码编写 JUnit 测试。我有另一个包含我预期输出的 Excel 文件。将实际文件与预期文件进行比较的最简单方法是什么？

当然我可以自己编写代码，但我想知道在受信任的第三方库（例如 Spring 或 Apache Commons）中是否存在已经这样做的方法。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-09-10T07:21:31.897

你可以考虑使用我的项目[simple-excel](https://github.com/tobyweston/simple-excel/)，它提供了一堆 Hamcrest Matchers 来完成这项工作。

当您执行以下操作时，

```
assertThat(actual, WorkbookMatcher.sameWorkbook(expected)); 
```

例如，你会看到，

```
java.lang.AssertionError:
Expected: entire workbook to be equal
     but: cell at "C14" contained <"bananas"> expected <nothing>,
          cell at "C15" contained <"1,850,000 EUR"> expected <"1,850,000.00 EUR">,
          cell at "D16" contained <nothing> expected <"Tue Sep 04 06:30:00">
    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20) 
```

这样，您就可以从您的自动化测试中运行它，并在开发过程中获得有意义的反馈。

[您可以在我网站上的这篇文章](http://baddotrobot.com/blog/2012/09/14/diff-excel-with-java-and-hamcrest/)中阅读更多相关信息

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-15T07:26:13.873

这是我最终做的事情（由[DBUnit](http://dbunit.sourceforge.net/)完成繁重的工作）：

```
/**
 * Compares the data in the two Excel files represented by the given input
 * streams, closing them on completion
 * 
 * @param expected can't be <code>null</code>
 * @param actual can't be <code>null</code>
 * @throws Exception
 */
private void compareExcelFiles(InputStream expected, InputStream actual)
  throws Exception
{
  try {
    Assertion.assertEquals(new XlsDataSet(expected), new XlsDataSet(actual));
  }
  finally {
    IOUtils.closeQuietly(expected);
    IOUtils.closeQuietly(actual);
  }
} 
```

这将比较两个文件中的数据，没有任何可能不同的不相关元数据产生误报的风险。希望这可以帮助某人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-14T23:51:52.063

使用一些校验和（如 MD5）或仅读取两个文件可以轻松完成简单的文件比较。

然而，正如 James Burgess 所指出的，由于 Excel 文件包含大量元数据，因此这些文件可能永远不会逐字节完全相同。所以你需要另一种比较来进行测试。

我建议以某种方式从 Excel 文件生成“规范”表单，即读取生成的 Excel 文件并将其转换为更简单的格式（CSV 或类似的格式），这只会保留您要检查的信息。然后您可以使用“规范形式”与您的预期结果进行比较（当然也是规范形式）。

[Apache POI](http://poi.apache.org/)可能对读取文件很有用。

顺便说一句：读取整个文件以检查其正确性通常不会被视为单元测试。那是集成测试...

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-08-05T19:07:36.570

我需要做类似的事情，并且已经在我的项目中使用[Apache POI 库](https://poi.apache.org/index.html)来创建 Excel 文件。所以我选择使用包含的[ExcelExtractor](https://poi.apache.org/apidocs/org/apache/poi/ss/extractor/ExcelExtractor.html)接口将两个工作簿导出为文本字符串，并断言这些字符串是相等的。[.xls](https://poi.apache.org/apidocs/org/apache/poi/hssf/extractor/ExcelExtractor.html)的 HSSF 和[.xlsx 的 XSSF 都有](https://poi.apache.org/apidocs/org/apache/poi/xssf/extractor/XSSFExcelExtractor.html)实现。

转储到字符串：

```
XSSFWorkbook xssfWorkbookA = ...;
String workbookA = new XSSFExcelExtractor(xssfWorkbookA).getText(); 
```

ExcelExtractor 有一些选项用于字符串转储中应包含的所有内容。我发现它具有包含工作表名称的有用默认值。此外，它还包括单元格的文本内容。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-05-20T13:15:55.647

我发现最简单的方法是使用 Tika。我这样使用它：

```
private void compareXlsx(File expected, File result) throws IOException, TikaException {
     Tika tika = new Tika();
     String expectedText = tika.parseToString(expected);
     String resultText = tika.parseToString(result);
     assertEquals(expectedText, resultText);
}

<dependency>
    <groupId>org.apache.tika</groupId>
    <artifactId>tika-parsers</artifactId>
    <version>1.13</version>
    <scope>test</scope>
</dependency> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-14T23:26:12.513

您可以使用 javaxdelta 检查这两个文件是否相同。它可以从这里获得：

[http://javaxdelta.sourceforge.net/](http://javaxdelta.sourceforge.net/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-14T23:48:49.963

刚刚发现 commons-io 的[FileUtils](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#contentEquals(java.io.File,%20java.io.File))中有一些东西。感谢其他答案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T02:01:01.127

请查看[该站点](http://www.velocityreviews.com/forums/t123770-re-java-code-for-determining-binary-file-equality.html)以比较二进制文件，[http://www.velocityreviews.com/forums/t123770-re-java-code-for-determining-binary-file-equality.html](http://www.velocityreviews.com/forums/t123770-re-java-code-for-determining-binary-file-equality.html)

老虎

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-04-26T12:05:21.793

您可以使用[Beyond Compare 3](http://www.scootersoftware.com/)，它可以从命令行启动并支持不同的方式来比较 Excel 文件，包括：

*   将 Excel 工作表与数据库表进行比较
*   检查所有文本内容
*   使用一些格式检查文本内容

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-05-31T16:26:16.143

仅测试 Kotlin 中第一张工作表的内容（可以轻松转换为 java）。

```
private fun checkEqualityExcelDocs(doc : XSSFWorkbook, doc1 : XSSFWorkbook) : Boolean{
        val mapOfCellDoc = doc.toList().first().toList().flatMap { row -> row.map { Pair(PivotExcelCreator.IndexInThePivotTable(it.rowIndex,it.columnIndex),it.stringCellValue) }}.toMap()
        val mapOfCellDoc1 = doc1.toList().first().toList().flatMap { row -> row.map { Pair(PivotExcelCreator.IndexInThePivotTable(it.rowIndex,it.columnIndex),it.stringCellValue) }}.toMap()
        if(mapOfCellDoc.size == mapOfCellDoc1.size){
            return mapOfCellDoc.entries.all { mapOfCellDoc1.containsKey(it.key) && mapOfCellDoc[it.key] == mapOfCellDoc1[it.key]}
        }
        return false
    }

data class IndexInThePivotTable(val row: Int, val col: Int) 
```

并在您的代码中添加断言

```
 assertTrue(checkEqualityExcelDocs(expected, actual), "Docs aren't equal!") 
```

如您所见`doc.toList().first()`，将只取第一张文件，如果您需要比较每张纸，请分别更改代码。

另外最好不要考虑“”空字符串单元格，我不需要这个功能（同样，如果需要，只需添加这部分）。

* * *

它也可能是有用的信息

```
//first doc I've got from outputstream such way
val out = ByteArrayOutputStream()
//some method which writes excel to outputstream
val firstDoc = XSSFWorkbook(ByteArrayInputStream(out.toByteArray())) 
```

和文件中的第二个文档进行比较

```
val secondDoc = XSSFWorkbook(Test::class.java.getClassLoader().getResource("yourfile.xlsx").path) 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-05-14T23:18:06.387

也许...比较每个文件的 MD5 摘要？我敢肯定有很多方法可以做到这一点。您可以打开两个文件并比较每个字节。

编辑：James 说明了 XLS 格式在元数据中的差异。也许您应该使用与生成 xls 文件相同的界面来打开它们并比较单元格之间的值？

# javascript - 仅当 http:// 不存在时，正则表达式才匹配 www.example.com

> ID：866347
> 
> 赞同：2
> 
> 时间：2009-05-14T23:17:21.520
> 
> 标签：javascript, regex

我有以下不工作的正则表达式。我想匹配字符串“www.example.com”，但不匹配字符串“ [http://www.example.com](http://www.example.com) ”（或“anythingwww.example.com”）：

```
/\bwww\.\w.\w/ig 
```

这在 JavaScript 中是这样使用的：

```
text = text.replace(/\bwww\.\w.\w/ig, 'http://$&'); 
```

我知道正则表达式的第二部分也不能正常工作，但让我感到困惑的是 http:// 部分。它当前将匹配“ [http://www.example.com](http://www.example.com) ”，从而产生“ [http://htpp://www.example.com](http://htpp://www.example.com) ”的输出。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T23:32:20.173

您是否正在寻找`www.example.com`更大的字符串中的出现？也许您可以更具体地说明您想要精确匹配的内容，但是这样的事情可能对您有用：

```
text = text.replace(/(\s)(www\.\w+\.\w+)/ig, "$1http://$2"); 
```

（匹配单词边界）的问题`\b`是它也匹配`http://`and `www`，因为`/`它不是单词字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T23:24:26.310

这是做你想做的吗？锚点确保文本以 www 开头。但显然这将在其他子域中失败。

```
text = text.replace(/^www\.\w+\.\w+$/ig, "http://$&"); 
```

编辑：感谢 Chris Lutz 的评论修复。我之前确实进行了测试，但是一个奇怪的错误组合（缺少锚点、未转义的点等）使它看起来有效。我应该重申，无论如何这都是脆弱的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-14T23:38:53.530

也许是这样的？

```
text = text.replace(/(^|\s)(www(?:\.\w+){2,})/ig, "$1http://$2"); 
```

这将匹配以下 URL：

*   “ `www.example.com`”->“ `http://www.example.com`”
*   “ `Visit www.example.com`”->“ `Visit http://www.exmaple.com`”
*   “ `Visit www.example.co.uk`”->“ `Visit http://www.example.co.uk`”

但不是：

*   " `http://www.example.com`"
*   " `ftp.example.com`"
*   " `www.com`"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T23:26:20.297

您可以使用*^*指示符（锚点）要求匹配的文本以*www*开头：

```
echo -e "http://www.example.com\nanythingwww.example.com\nwww.example.com" | grep "^www.example.com"
www.example.com 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T23:43:46.793

~~您可以使用否定的lookbehind 断言。就像是 ...~~

 ~~```
(?<!http\:\/\/)(?:www.example.com) 
```~~  ~~# .net - 如何以编程方式删除 WebClient 中的 2 个连接限制

> ID：866350
> 
> 赞同：88
> 
> 时间：2009-05-14T23:18:45.263
> 
> 标签：.net, http, connection, webclient, limit

那些“好”的 RFC 要求每个 RFC 客户端注意每个主机不要使用超过 2 个连接......

微软在 WebClient 中实现了这一点。我知道它可以关闭

应用程序配置：

```
<?xml version="1.0" encoding="utf-8" ?> 
<configuration> 
 <system.net> 
  <connectionManagement> 
   <add address="*" maxconnection="100" /> 
  </connectionManagement> 
 </system.net> 
</configuration> 
```

（可在[http://social.msdn.microsoft.com/forums/en-US/netfxnetcom/thread/1f863f20-09f9-49a5-8eee-17a89b591007](http://social.msdn.microsoft.com/forums/en-US/netfxnetcom/thread/1f863f20-09f9-49a5-8eee-17a89b591007)上找到）

但是我怎样才能以编程方式做到这一点？

根据 [http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultconnectionlimit.aspx](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultconnectionlimit.aspx)

“更改 DefaultConnectionLimit 属性对现有 ServicePoint 对象没有影响；它仅影响更改后初始化的 ServicePoint 对象。如果此属性的值尚未直接或通过配置设置，则该值默认为常量 DefaultPersistentConnectionLimit。”

我希望最好在实例化 WebClient 时配置限制，但是在我的程序开始时以编程方式删除这个可悲的限制也可以。

我访问的服务器不是互联网上的常规网络服务器，而是在我的控制下和本地局域网中。我想做 API 调用，但我不使用网络服务或远程处理

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2010-08-31T02:50:26.913

对于那些感兴趣的人：

`System.Net.ServicePointManager.DefaultConnectionLimit = x`（其中 x 是您想要的连接数）

无需额外参考

只需确保在创建服务点之前调用它，如上文所述。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-08-13T01:31:44.397

借助这里和其他地方的一些技巧，我设法通过覆盖我正在使用的 WebClient 类在我的应用程序中解决了这个问题：

```
class AwesomeWebClient : WebClient {
    protected override WebRequest GetWebRequest(Uri address) {
        HttpWebRequest req = (HttpWebRequest)base.GetWebRequest(address);
        req.ServicePoint.ConnectionLimit = 10;
        return (WebRequest)req;
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-01-12T21:14:41.810

此解决方案允许您随时更改连接*限制*：

```
private static void ConfigureServicePoint(Uri uri)
{
    var servicePoint = ServicePointManager.FindServicePoint(uri);

    // Increase the number of TCP connections from the default (2)
    servicePoint.ConnectionLimit = 40;
} 
```

任何人第一次调用此[FindServicePoint](https://msdn.microsoft.com/en-us/library/c5f0atwd.aspx)时，都会创建一个[ServicePoint](https://msdn.microsoft.com/en-us/library/system.net.servicepoint.aspx)实例并创建一个[WeakReference](https://msdn.microsoft.com/en-us/library/system.weakreference.aspx)以在[ServicePointManager](https://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.aspx)中保持它。对同一 Uri 的管理器的后续请求返回相同的实例。如果之后没有使用连接，GC 会清理它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-14T23:40:47.470

如果您发现 WebClient 正在使用 ServicePoint 对象，则可以更改其连接限制。HttpWebRequest 对象有一个访问器来检索构造它们要使用的访问器，因此您可以这样做。如果幸运的话，您的所有请求最终可能会共享同一个 ServicePoint，因此您只需执行一次。

我不知道任何改变限制的全局方法。如果您在执行过程中足够早地更改了 DefaultConnectionLimit，那么您可能会没事的。

或者，您可以忍受连接限制，因为无论如何大多数服务器软件都会限制您。:)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-26T23:39:10.537

我们在 App.Config 中有关于上述配置的情况

为了使其在 CONSOLE 应用程序中有效，我们添加了 System.Configuration 引用 dll。没有参考，以上是无用的。

# session - 当 gridview 设置为显示会话数组列表“数组”中的值时，将显示以下错误“对象必须实现 IConvertible。” 在c#中

> ID：866351
> 
> 赞同：0
> 
> 时间：2009-05-14T23:19:24.777
> 
> 标签：session, gridview

当用户选择“添加到购物车”时，该行项目的 itemID 被添加到 arraylist，然后存储在会话中。

在购物车页面中，我得到了一个 gridview，它从 item db where session["array"]=itemID 读取名称、价格

购物车页面加载时显示错误。

我想要做的就是获取用户在arraylist 中选择的项目列表，并将它们填充到购物车页面的gridview 中。

公共部分类 Drama_k ： System.Web.UI.Page { ArrayList 数组；

```
protected void Page_Load(object sender, EventArgs e)
{
    if (Session["array"] == null)
    {
        array = new ArrayList();
        Session.Add("array", array);
    }
    else
        array = Session["array"] as ArrayList;
    GridView1.DataSource = array;
    GridView1.DataBind(); //Edit 2           
}

protected void GridView2_RowCommand(object sender, GridViewCommandEventArgs e)
{
    if (e.CommandName == "AddToCart")
    {
        int index = Convert.ToInt32(e.CommandArgument);
        array.Add(GridView2.DataKeys[index].Value.ToString());
    }
} 
```

}

购物车页面只有sql语句所在的gridview

选择 [ItemID]、[Name]、[RelDate]、[Price]、[Status] FROM [item_k] WHERE ([ItemID] = @ItemID)

([ItemID] = @ItemID) 的值为 Session("array")

这里似乎有什么问题？

提前致谢。

//编辑 2

```
ArrayList tmpArrayList = new ArrayList(); 
tmpArrayList = (ArrayList)Session["array"]; 
string itemIDs = string.Empty; 
foreach (object itemID in tmpArrayList) 
{ 
   itemIDs += itemID.ToString() + ','; 
} 
itemIDs = itemIDs.Substring(0, itemIDs.Length - 1); 
```

itemID 现在保存值“3,16”

我将查询字符串放在查询构建器窗口中，当我运行网站时出现此错误。

```
"Invalid column name ' + itemIDs + '. " 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T02:36:32.430

看起来您正在尝试将 ArrayList 作为参数分配给您的查询，这是不可能的。您必须组装一个包含 ArrayList 内容的逗号分隔列表的字符串，并使用它来构建查询，而不是将其作为参数传递。请注意，这也需要更改查询字符串，使用 WHERE...IN 而不是 WHERE...=。

```
string itemIDs = string.Empty;
foreach (int itemID in array)
{
    itemIDs += itemID.ToString() + ',';
}
itemIDs = itemIDs.Substring(0, itemIDs.Length - 1);  // remove last comma

string query = "SELECT [ItemID], [Name], [RelDate], [Price], [Status] FROM [item_k] WHERE [ItemID] IN (" + itemIDs + ")" 
```

# c# - Winforms MVP 网格事件问题

> ID：866358
> 
> 赞同：2
> 
> 时间：2009-05-14T23:21:59.683
> 
> 标签：c#, .net, winforms, model-view-controller, mvp

我正在尝试为 WINFORMS 实现 MVP 模式。它是一个简单的按钮和网格，单击按钮时，网格将加载，用户可以将值填充到网格中。

对于我的按钮单击事件，我有这样的事情：

_presenter.LoadGrid();

这是简单明了的。

我的问题是，关于网格...我计划触发一个行单击事件...用于启用/禁用网格的特定列/行等的后续输入字段。

我知道演示者不应该包含任何 GUI 元素，并且 View(form) 不应该真正包含逻辑？

因此，要触发 GridRowClick 事件，我需要根据业务规则 (Logic) 操作网格 (GUI)。我在让演示者处理该点击事件或表单的逻辑之间迷失了？

如果演示者要处理单击事件，那不包括 gui 组件吗？如果视图要处理点击事件，字段名等都是业务驱动的（逻辑），根据业务层返回的数据表动态绑定。

任何建议将不胜感激。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T01:48:14.357

MVP 有（至少）两种变体。

*   被动视图模式
*   监督控制器模式

顾名思义，被动视图将 UI 视为用户和应用程序之间或多或少的被动界面。它将尽可能多的可测试代码移至演示者，让视图仅处理最基本的 UI 更新。

监督控制器通过让视图处理数据同步来赋予视图更多的责任。这通常通过数据绑定来完成。

在任何一种情况下，事件处理都是通过委托给演示者方法来完成的：

```
EventHandler()
{
    presenter.HandleEvent();
} 
```

如果处理事件需要对表单进行更改，则将需要更新的内容公开为属性：

```
public string PropertyThatNeedsToBeUpdated
{
    get
    {
        return Control.Property;
    }
    set
    {
        Control.Property = value;
    }
} 
```

对于被动视图，网格是一个障碍。它们的复杂性使得捕获所有可能的事件变得很麻烦。使用监督控制器，网格更容易，因为您将数据同步留给数据绑定控件。

您必须判断哪个更适合您的情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T00:04:06.340

关键是将所有业务逻辑放入可测试的演示者中。

视图应该调用演示者来执行业务逻辑，传递所需的信息（例如，与单击的行关联的数据）。

演示者然后执行业务逻辑并更新数据。

根据您需要进行的更改类型，这可能就是您需要做的所有事情，因为现有的数据绑定可能足以自动更新视图。如果这还不够，演示者可以对视图进行一次或多次调用（当然是通过其接口）以进行所需的更改。

正如您所说，您的目标应该是尽量减少视图中重要代码的数量，特别是视图中不应包含任何业务逻辑。

**编辑：**

关于 MVP 和其他演示模式的一些很好的一般信息：[http ://martinfowler.com/eaaDev/uiArchs.html](http://martinfowler.com/eaaDev/uiArchs.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-11T15:41:06.670

您可能想查看来自 Polymorphic Podcast 的视频系列的第 4 部分。他使用监督控制器模式并展示了一种处理数据网格的技术。整个系列对我来说实际上是一个很好的介绍。

[http://polymorphicpodcast.com/shows/mv-patterns/](http://polymorphicpodcast.com/shows/mv-patterns/)

# c++ - Lua、C++ 和穷人的子类化

> ID：866362
> 
> 赞同：11
> 
> 时间：2009-05-14T23:23:03.847
> 
> 标签：c++, oop, lua

我是[Bitfighter](http://bitfighter.org)的首席开发人员，我们正在使用 Lua 和 C++ 的混合体，使用 Lunar（Luna 的一种变体，可[在此处](http://lua-users.org/wiki/CppBindingWithLunar)获得）将它们绑定在一起。

我知道这个环境对面向对象和继承没有很好的支持，但我想找到一些方法来至少部分解决这些限制。

这是我所拥有的：

**C++ 类结构**

```
    游戏物品
       |---- 摇滚
       |---- 石头
       |---- 洛基石

    机器人

```

Robot 实现了一个名为*getFiringSolution(GameItem item)的方法，该方法查看**item*的位置和速度，并返回机器人需要开火才能击中*item*的角度。

```
-- This is in Lua
angle = robot:getFiringSolution(rock)
if(angle != nil) then
    robot:fire(angle)
end 
```

所以我的问题是我想将*rock* 、 stone或*rockyStones传递给**getFiringSolution*方法，但我不知道该怎么做。

 **这仅适用于岩石：

```
// C++ code
S32 Robot::getFiringSolution(lua_State *L) 
{
   Rock *target = Lunar<Rock>::check(L, 1);
   return returnFloat(L, getFireAngle(target));    // returnFloat() is my func
} 
```

理想情况下，我想做的是这样的：

```
// This is C++, doesn't work
S32 Robot::getFiringSolution(lua_State *L) 
{
   GameItem *target = Lunar<GameItem>::check(L, 1);
   return returnFloat(L, getFireAngle(target));    
} 
```

这个潜在的解决方案不起作用，因为 Lunar 的检查函数希望堆栈上的对象具有与为 GameItem 定义的类名匹配的类名。（对于您在 Lunar 注册的每种对象类型，您都需要以字符串的形式提供一个名称，Lunar 使用该名称来确保对象的类型正确。）

我会接受这样的事情，我必须检查每个可能的子类：

```
// Also C++, also doesn't work
S32 Robot::getFiringSolution(lua_State *L) 
{
   GameItem *target = Lunar<Rock>::check(L, 1);
   if(!target)
       target = Lunar<Stone>::check(L, 1);
   if(!target)
       target = Lunar<RockyStone>::check(L, 1);

   return returnFloat(L, getFireAngle(target));    
} 
```

这个解决方案的问题是，如果堆栈上的项目类型不正确，检查函数会生成错误，并且我相信会从堆栈中删除感兴趣的对象，所以我只有一次尝试抓取它。

我想我需要从堆栈中获取指向 Rock/Stone/RockyStone 对象的指针，弄清楚它是什么类型，然后在使用它之前将其转换为正确的东西。

Lunar 进行类型检查的关键位是：

```
// from Lunar.h
// get userdata from Lua stack and return pointer to T object
static T *check(lua_State *L, int narg) {
  userdataType *ud =
    static_cast<userdataType*>(luaL_checkudata(L, narg, T::className));
  if(!ud) luaL_typerror(L, narg, T::className);
  return ud->pT;  // pointer to T object
} 
```

如果我这样称呼它：

```
GameItem *target = Lunar<Rock>::check(L, 1); 
```

然后 luaL_checkudata() 检查堆栈上的项目是否是 Rock。如果是这样，一切都很好，它返回一个指向我的 Rock 对象的指针，该指针被传递回 getFiringSolution() 方法。如果堆栈上有一个非 Rock 项目，则强制转换返回 null，并调用 luaL_typerror()，这会将应用程序发送到 lala 土地（错误处理会打印诊断信息并以极端偏见终止机器人）。

关于如何推进这一点的任何想法？

非常感谢！！

**我想出的最佳解决方案......丑陋，但有效**

根据以下建议，我想出了这个：

```
template <class T>
T *checkItem(lua_State *L)
{
   luaL_getmetatable(L, T::className);
   if(lua_rawequal(L, -1, -2))         // Lua object on stack is of class <T>
   {
      lua_pop(L, 2);                   // Remove both metatables
      return Lunar<T>::check(L, 1);    // Return our object
   }
   else                                // Object on stack is something else
   {
      lua_pop(L, 1);    // Remove <T>'s metatable, leave the other in place 
                        // for further comparison
      return NULL;
   }
} 
```

然后，后来...

```
S32 Robot::getFiringSolution(lua_State *L)
{
   GameItem *target;

   lua_getmetatable(L, 1);    // Get metatable for first item on the stack

   target = checkItem<Rock>(L);

   if(!target)
      target = checkItem<Stone>(L);

   if(!target)
      target = checkItem<RockyStone>(L);

   if(!target)    // Ultimately failed to figure out what this object is.
   {
      lua_pop(L, 1);                      // Clean up
      luaL_typerror(L, 1, "GameItem");    // Raise an error
      return returnNil(L);                // Return nil, but I don't think this 
                                          // statement will ever get run
   }

   return returnFloat(L, getFireAngle(target));    
} 
```

我可能可以对此进行进一步的优化...我真的很想弄清楚如何将其折叠成一个循环，因为实际上，我将处理三个以上的类，而这个过程是有点麻烦。

**对上述解决方案略有改进**

C++：

```
GameItem *LuaObject::getItem(lua_State *L, S32 index, U32 type)
{
  switch(type)
  {
    case RockType:
        return Lunar<Rock>::check(L, index);
    case StoneType:
        return Lunar<Stone>::check(L, index);
    case RockyStoneType:
        return Lunar<RockyStone>::check(L, index);
    default:
        displayError();
   }
} 
```

然后，后来...

```
S32 Robot::getFiringSolution(lua_State *L)
{
   S32 type = getInteger(L, 1);                 // My fn to pop int from stack
   GameItem *target = getItem(L, 2, type);

   return returnFloat(L, getFireAngle(target)); // My fn to push float to stack  
} 
```

Lua 辅助函数，作为一个单独的文件包含，以避免用户需要手动将其添加到他们的代码中：

```
function getFiringSolution( item )
  type = item:getClassID()      -- Returns an integer id unique to each class
  if( type == nil ) then
     return nil
   end
  return bot:getFiringSolution( type, item )
end 
```

用户从 Lua 以这种方式调用：

```
 angle = getFiringSolution( item ) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T00:14:55.890

我认为您正在尝试在错误的地方执行方法调度。（这个问题是*所有*这些使 Lua 与 C 或 C++ 交互的“自动化”方式存在困难的症状：对于每一种方式，幕后都有一些魔力，而且如何让它工作并不总是显而易见的。我不明白为什么更多的人不只是使用 Lua 的 C API。）

我查看了 Lunar 网页，在我看来，好像您需要`methods`在类型上创建一个表`T`，然后调用该`Luna<T>::Register`方法。[网上](http://lua-users.org/wiki/SimplerCppBinding)有一个简单的例子。如果我正确阅读了代码，那么您问题中的任何胶水代码实际上都不是使用 Lunar 做事的推荐方式。（我还假设您可以将这些方法完全实现为 C++ 调用。）

这一切都很狡猾，因为 Lunar 上的文档很薄。一个明智的选择是自己完成所有工作，只需将每个 C++ 类型与包含其方法的 Lua 表相关联。然后你让 Lua`__index`元方法查询该表，并且 Bob 是你的叔叔。Lunar 正在做一些*接近*这些的事情，但它已经充分地装饰了 C++ 模板，而我不知道如何使它工作。

模板的东西非常聪明。您可能需要花时间深入了解它的工作原理，或者重新考虑是否以及如何使用它。

**总结**：对每个类，做一个显式的方法表，并使用 Lunar`Register`方法注册每个类。或者自己滚动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:01:31.180

您应该告诉我们在您的代码中究竟有什么不起作用。我想这`Lunar<Rock>::check(L, 1)`对所有非摇滚乐队来说都是失败的。我对么？

如果您指定使用哪个版本的 Lunar 也很好（指向它的链接会很棒）。

如果是[这个](http://lua-users.org/wiki/CppBindingWithLunar)，那么类类型存储在 Lua 对象元表中（可以说这个元表*就是*类型）。

看起来检查对象是否是 Rock 而无需修补 Lunar 的最简单方法是调用`luaL_getmetatable(L, Rock::className)`获取类元表并将其与第一个参数的 lua_getmetatable(L, 1) 进行比较（注意第一个函数名称中的 lua **L**）。这有点骇人听闻，但应该可以。

如果您对 Lunar 进行修补没问题，一种可能的方法是向元表添加一些`__lunarClassName`字段并存储`T::name`在那里。然后提供`lunar_typename()`C++ 函数（在 Lunar 模板类之外——因为我们不需要`T`那里），然后从它返回`__lunarClassName`参数元表的该字段的值。（不要忘记检查对象是否具有元表以及元表是否具有此类字段。）您可以通过调用`lunar_typename()`then 来检查 Lua 对象类型。

个人经验的一点建议：你向 Lua 推送的业务逻辑越多越好。除非您受到严重的性能限制，否则您可能应该考虑将所有层次结构移至 Lua ——您的生活会变得更加简单。

如果我可以进一步帮助你，请说出来。

**更新：**您更新帖子的解决方案看起来是正确的。

要在 C 中进行基于元表的分派，您可以使用，例如，将类型的整[`lua_topointer()`](http://www.lua.org/manual/5.1/manual.html#lua_topointer)数值映射`luaL_getmetatable()`到知道如何处理该类型的函数对象/指针。

但是，我再次建议将这部分移至 Lua。例如：导出特定类型的函数`getFiringSolutionForRock()`，`getFiringSolutionForStone()`以及`getFiringSolutionForRockyStone()`从 C++ 到 Lua。在 Lua 中，通过 metatable 存储方法表：

```
dispatch =
{
  [Rock] = Robot.getFiringSolutionForRock;
  [Stone] = Robot.getFiringSolutionForStone;
  [RockyStone] = Robot.getFiringSolutionForRockyStone;
} 
```

如果我是对的，下一行应该调用正确的机器人对象专用方法。

```
dispatch[getmetatable(rock)](robot, rock) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T00:29:02.533

我建议您在纯 lua 中定义一个面向对象的系统，然后为 API 的该方面编写一个到 C++ 的自定义绑定。

Lua 非常适合原型 OO 实现，其中表用于模拟类，其中一个条目有一个名为 new 的函数，当调用该函数时，它会返回一个具有相同“类型”的适当表。

但是，在 C++ 中，创建一个具有 .invoke 方法的 LuaClass，接受一个 C 字符串（即一个以 null 结尾的 const char 数组）来指定您要调用的成员函数的名称，具体取决于您要如何调用处理可变参数，有这个 .invoke 方法的多个模板版本，用于零、一、二、... .

对于 Lua，我建议创建两个 .invoke 方法，一个需要 std::vector，另一个需要 std::map，但我会留给你。:)

在我上一个 Lua/C++ 项目中，我只使用了以空结尾的 C 字符串数组，需要 lua 将字符串转换为适当的值。

享受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-09T13:28:32.517

我面临着完全相同的需求，这就是我想出的。（我不得不对 Lunar 标题做一些小改动）

首先，我为所有将包含 Lua 方法的类添加了一个全局“接口”。我知道这可能看起来不如“原始”方式灵活，但在我看来它更清晰，我确实需要它来执行动态转换。

```
class LuaInterface
{
  public:
    virtual const char* getClassName() const=0;
}; 
```

是的，它只包含一个纯虚方法，显然会在派生类中返回静态的“className”属性。这样，您可以拥有多态性，同时保留模板化的月球类所需的这个静态名称成员。

为了让我的生活更轻松，我还添加了一些定义：

```
#define LuaClass(T) private: friend class Lunar<T>; static const char className[]; static Lunar<T>::RegType methods[]; public: const char* getClassName() const { return className; } 
```

所以你基本上只需要声明一个这样的类：

```
class MyLuaClass: public LuaInterface
{
   LuaClass(MyLuaClass)
   public:
   MyLuaMethod(lua_State* L);
}; 
```

这里没什么特别的。

我还需要一个“单身人士”（哎呀，我知道：它并不一定是单身人士，只要做你想做的事就行）

```
class LuaAdapter
{
  //SINGLETON part : irrelevant
  public:

  const lua_State* getState() const { return _state; }
  lua_State* getState() { return _state; }

  template <class T>
  void registerClass(const std::string &name) 
  { 
    Lunar<T>::Register(_state); 
    _registeredClasses.push_back(name);
  }

  void registerFunction(const std::string &name, lua_CFunction f)
  {
    lua_register(_state, name.c_str(), f);
    _registeredFunctions.push_back(name);
  }

  bool loadScriptFromFile(const std::string &script);
  bool loadScript(const std::string &script);

  const StringList& getRegisteredClasses() const { return _registeredClasses; }
  const StringList& getRegisteredFunctions() const { return _registeredFunctions; }

  LuaInterface* getStackObject() const;

  private:

  lua_State*        _state;
  StringList        _registeredClasses;
  StringList        _registeredFunctions;

}; 
```

现在，只看 registerClass 方法：我们将它的名称存储在 StringList 中（只是一个字符串列表）

现在，想法是实现一个代理来注册我们的类：

```
template<class _Type>
class RegisterLuaClassProxy
{
  public:
  RegisterLuaClassProxy(const std::string &name)
  {
     LuaAdapter::instance()->registerClass<_Type>(name);
  }

  ~RegisterLuaClassProxy()
  {
  }
}; 
```

我们需要为每个 LuaInterface 类构建每个代理的一个实例。即：在 MyClass.cpp 中，在标准的“Lunar”方法声明之后：

```
RegisterLuaClass(MyClass) 
```

再次，有几个定义：

```
#define RegisterLuaClassWithName(T, name) const char T::className[] = name; RegisterLuaClassProxy<T> T ## _Proxy(name);
#define RegisterLuaClass(T) RegisterLuaClassWithName(T, #T) 
```

对“函数”方法/代理执行相同的操作。

现在 Lunar 标头有一些小的变化：

从类中删除“userdataType”结构，并在类外定义一个结构：

```
typedef struct { LuaInterface *pT; } userdataType; 
```

（请注意，您还需要在 Lunar 类中添加一些 static_cast）

好吧。现在我们有了执行操作所需的所有结构，我已经根据您的代码在 LuaAdapter 的 getStackObject() 方法中定义了它。

```
LuaInterface* LuaAdapter::getStackObject() const
{
lua_getmetatable(_state, 1);
for(StringList::const_iterator it = _registeredClasses.begin(); it != _registeredClasses.end(); ++it)
{
    // CHECK ITEM
    luaL_getmetatable(_state, it->c_str());
    if(lua_rawequal(_state, -1, -2)) // Lua object on stack is of class <T>
    {
        lua_pop(_state, 2); // Remove both metatables
        userdataType *ud = static_cast<userdataType*>(luaL_checkudata(_state, 1, it->c_str()));
        if(!ud) luaL_typerror(_state, 1, it->c_str());
        return ud->pT;
    }
    else // Object on stack is something else
    {
        // Remove <T>'s metatable, leave the other in place for further comparison
        lua_pop(_state, 1);
    }
}
return NULL;
} 
```

这是诀窍：由于返回的指针指向一个抽象类，您可以安全地使用 dynamic_cast<> 。并添加一些“中间”抽象类，带有很好的虚拟方法，例如：

```
int fire(lua_State *L)
{
GameItem *item = dynamic_cast<GameItem*>(LuaAdapter::instance()->getStackObject());
if( item!= NULL)
{
        item->fire();
}   
return 0;
} 
```

... 我希望这个能帮上忙。不要犹豫，纠正我/添加东西/反馈。

干杯:)

# php - 如何将我的 init 函数中的代码集中在所有控制器中？

> ID：866367
> 
> 赞同：2
> 
> 时间：2009-05-14T23:25:00.113
> 
> 标签：php, zend-framework

```
public function init(){
        $this->view->user = Zend_Auth::getInstance()->getIdentity();
        $this->view->siteName = Zend_Registry::get('config')->site->name;
        $this->view->menu = $this->_helper->generateMenu(Zend_Auth::getInstance()->getIdentity());
        $this->view->slogan = Zend_Registry::get('config')->site->slogan;
    } 
```

这是我所有模块中所有控制器中的初始化文件，有没有可以放置此代码的地方，以便它执行每个请求，而不管模块/控制器是否被调用？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T00:21:06.203

我宁愿建议你通过扩展 Zend_Controller_Plugin_Abstract 来编写一个插件，这是它的目的。

通过这种方式，您无需在控制器中的任何地方执行任何操作。然后您可以使用注册表访问您的数据...

```
class My_Controller_Plugin_Acl extends Zend_Controller_Plugin_Abstract
{
    protected $_auth = null;

    protected $_acl = null;

    public function __construct (Zend_Auth $auth, Zend_Acl $acl)
    {
        $this->_auth = $auth;
        $this->_acl = $acl;
    }

    public function preDispatch(Zend_Controller_Request_Abstract $request)
    {
         //some code
    }
} 
```

然后在你的 bootstrap.php

```
$this->_front->registerPlugin(new My_Controller_Plugin_Layout()); 
```

[http://framework.zend.com/manual/en/zend.controller.plugins.html](http://framework.zend.com/manual/en/zend.controller.plugins.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T05:35:44.263

要跨控制器共享代码，请创建一个主要用于解决您遇到的问题的 Action Helper。

它们可以“按需”运行：

```
$myHelper = $this->_helper->MyHelper;
$myHelper->someFunction(); 
```

并且还有一组钩子，调度过程会自动调用。要使用钩子，您需要向代理注册操作助手：

```
$helper = new App_Controller_Action_Helper();
Zend_Controller_Action_HelperBroker::addHelper($helper); 
```

可用的钩子是：

*   `init()`
*   `preDispatch()`
*   `postDispatch()`

有关更多信息，可以在[http://framework.zend.com/manual/en/zend.controller.actionhelpers.html](http://framework.zend.com/manual/en/zend.controller.actionhelpers.html)找到手册页，我已经写了几篇关于它们的文章：http: [//akrabat.com /2008/10/31/using-action-helpers-in-zend-framework/](http://akrabat.com/2008/10/31/using-action-helpers-in-zend-framework/)和[http://akrabat.com/2008/11/05/hooks-in-action-helpers/](http://akrabat.com/2008/11/05/hooks-in-action-helpers/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T00:11:45.853

你可以扩展 Zend_Controller_Action：

```
public class My_Controller_Action extends Zend_Controller_Action
{
    public function init()
    {
        $this->view->user = Zend_Auth::getInstance()->getIdentity();
        $this->view->siteName = Zend_Registry::get('config')->site->name;
        $this->view->menu = $this->_helper->generateMenu(Zend_Auth::getInstance()->getIdentity());
        $this->view->slogan = Zend_Registry::get('config')->site->slogan;
    }

} 
```

然后您只需更改控制器以扩展 My_Controller_Action 而不是 Zend_Controller_Action。请记住，如果您需要向控制器的 init 方法添加额外的代码，您还必须调用 parent::init()：

```
public class FooController extends My_Controller_Action
{
    public function init()
    {
        parent::init();

        // Do something.
    }

    public function IndexAction()
    {
        // ...
    }
} 
```

# css - 恢复浏览器窗口时侧边菜单重叠

> ID：866368
> 
> 赞同：0
> 
> 时间：2009-05-14T23:25:30.817
> 
> 标签：css, menu

检查[我的网站](http://www.the650company.com)，并查看 Divisions 左侧菜单。当您最大化您的浏览器时没有问题，但是当您将其恢复到屏幕的一半时，左侧菜单会与右侧重叠。

这是 CSS[代码](http://www.the650company.com/style.css)。有人能帮我吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T23:33:42.277

这是因为您的“部门” div 是绝对定位的。

您可以删除“位置：绝对”并将“分区”div 的宽度增加到 300 像素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T18:06:16.323

一个非常直接、简单和快速修复的解决方案是使用 CSS ：

```
#content {style.css (line 17)
  left:-270px;
  margin:0 auto;
  padding:30px 10px 0 550px;
  position:relative;
  width:780px;
} 
```

我在我的 Firebug 中试过这个，效果很好。希望它能满足你的需要:)

下次只需使用 css 浮动：将侧边菜单和内容 div 放在一个包装器中，
浮动：左用于菜单，并为包装器提供固定宽度，并居中对齐。您还可以使导航菜单从左侧“退出”，负向左定位。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:37:12.177

您的左侧菜单绝对定位，这就是当窗口大小太窄时**它会与其他内容重叠的原因。**但是这个问题的解决方案非常棘手，实际上取决于您想要实现的目标。

**百分比**
一种可能的解决方案是以百分比设置`width`“分区”和“内容”div。这样它们就永远不会重叠。但这取决于您是否可以负担得起“内容” div 的动态宽度。

**重新定位**
如果您的内容必须是固定宽度...您首先必须决定当窗口太窄（甚至可能比内容宽度更窄）时您希望您的内容/菜单如何显示...然后从那里开始工作。

**正文元素宽度**
设置最小窗口内容（如`<body>`）宽度。通过使用：

*   文档开头的透明图像**`<img src="t.gif" width="1250">`**
*   将 body 的最小宽度 css 设置为**`min-width: 1250px;`**1250px 宽，因为内容位于中心位置，所以它必须在左侧和右侧具有相等的空间（右侧是无用的空白空间，只允许内容左侧的非重叠空间）

最后一个实际上是最简单且有效的。对于较小的屏幕尺寸，它只会让它有点宽，但你的内容宽度（包括左侧的菜单）已经超过了 1030 像素......

# c# - 合并树节点

> ID：866380
> 
> 赞同：4
> 
> 时间：2009-05-14T23:28:11.120
> 
> 标签：c#, algorithm

有谁知道将通过以下方式合并树节点的算法？

```
treeA
   \ child a
          \node(abc)
   \ child b
          \node(xyz)                   

         + 

treeB
   \ child a              
          \node(qrs)
   \ child b
          \node(xyz)
               \node(pdq)
   \ child c
          \node(pdq)

         = // do merge

treeMerged     
   \ child a
          \node(abc) 
          \node(qrs)
   \ child b
          \node(xyz)
               \node(pdq)
   \ child c
          \node(pdq) 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-28T20:03:10.827

好吧，一旦我真正花时间考虑它，结果证明解决方案比我预期的要简单得多。（我已经发布了下面代码的关键部分）

```
 private TreeNode DoMerge(TreeNode source, TreeNode target) {
        if (source == null || target == null) return null;

        foreach (TreeNode n in source.Nodes) {
            // see if there is a match in target
            var match = FindNode(n, target.Nodes); // match paths
            if (match == null) { // no match was found so add n to the target
                target.Nodes.Add(n);
            } else { 
                // a match was found so add the children of match 
                DoMerge(n, match);
            }

        }
        return target;

    } 
```

仍然想知道是否有人有更好的解决方案？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T00:16:20.897

好吧，我承认，当我第一次开始搞砸这个时，我认为这不会太难，所以我想我会尝试使用 LINQ 来做。结果很疯狂，但它确实有效。我确信有更优雅和高效的算法，但它就在这里！

首先，我在 TreeNodeCollection 类上有一个 ToEnumerable 扩展方法：

```
 public static class TreeNodeCollectionExtensions
    {
        public static IEnumerable<TreeNode> ToEnumerable(this TreeNodeCollection nodes)
        {
            foreach (TreeNode node in nodes)
            {
                yield return node;
            }
        }
    } 
```

然后，我实现了一个自定义比较器：

公共类 TreeNodeComparer ： IEqualityComparer {

```
public bool Equals(TreeNode x, TreeNode y)
{
    return x.Text == y.Text;
}

public int GetHashCode(TreeNode obj)
{
    return obj.Text.GetHashCode();
} 
```

}

最后，疯狂：

```
private TreeView MergeTreeViews(TreeView tv1, TreeView tv2)
{
    var result = new TreeView();
    foreach (TreeNode node in tv2.Nodes)
    {
        result.Nodes.Add(node.Clone() as TreeNode);
    }

    foreach (TreeNode node in tv1.Nodes)
    {
        var nodeOnOtherSide = result.Nodes.ToEnumerable()
            .SingleOrDefault(tr => tr.Text == node.Text);
        if (nodeOnOtherSide == null)
        {
            TreeNode clone = node.Clone() as TreeNode;
            result.Nodes.Add(clone);

        }
        else
        {

            var n = node.Nodes.ToEnumerable()
                     .Where(t => !(nodeOnOtherSide.Nodes.ToEnumerable()
                     .Contains(t, new TreeNodeComparer())));

            foreach (TreeNode subNode in n)
            {
                TreeNode clone = subNode.Clone() as TreeNode;
                nodeOnOtherSide.Nodes.Add(clone);
            }
        }
    }

    return result;
} 
```

我编码的方式是它返回第三个“合并”树视图。您可以更改代码，使其将第三个树视图作为参数，以便您可以传入您可能已经拥有的树视图。

同样，我确信有更好的方法可以做到这一点，但它应该有效。

我还要指出一件事，这只适用于两层深的 TreeView。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-21T22:02:43.007

我想出了这个递归示例，在 C# 中完美运行（我自己一直在使用它），请注意，您需要找到一种将 TreeNode.Nodes 转换为数组的方法：

```
public static TreeNode[] mergeTrees(TreeNode[] target, TreeNode[] source)
        {
            if (source == null || source.Length == 0)
            {
                return target;
            }
            if (target == null || target.Length == 0)
            {
                return source;
            }
            bool found;
            foreach (TreeNode s in source)
            {
                found = false;
                foreach (TreeNode t in target)
                {
                    if (s.Text.CompareTo(t.Text) == 0)
                    {
                        found = true;
                        TreeNode[] updatedNodes = mergeTrees(Util.treeView2Array(t.Nodes), Util.treeView2Array(s.Nodes));
                        t.Nodes.Clear();
                        t.Nodes.AddRange(updatedNodes);
                        break;
                    }
                }
                if (!found)
                {
                    TreeNode[] newNodes = new TreeNode[target.Length + 1];
                    Array.Copy(target, newNodes, target.Length);
                    newNodes[target.Length] = s;
                    target = newNodes;
                }
            }
            return target;
        } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-03-13T16:59:51.077

如果您使用 Node.Name 属性来设置项目的实际路径，那么合并有点简单。

首先，像这样创建一个 TreeNodeCollection 扩展（这需要为 TreeNodeCollection 提供一个区分大小写的 Find() 方法，以确保唯一路径也可以按大小写唯一）：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace TreeViewApp
{
    public static class TreeNodeCollectionExtensions
    {
        public static TreeNode[] FindExact(this TreeNodeCollection coll, string keytofind)
        {
            TreeNode[] retval;

            if (String.IsNullOrWhiteSpace(keytofind) || coll == null)
            {
                retval = new TreeNode[0];
            }
            else
            {
                TreeNode[] badfinds = coll.Find(keytofind, true);

                List<TreeNode> goodfinds = new List<TreeNode>();
                foreach (TreeNode bad in badfinds)
                {
                    if (bad.Name == keytofind)
                        goodfinds.Add(bad);
                }
                retval = goodfinds.ToArray();

            }
            return retval;
        }
    }
} 
```

其次，用您的 Source 节点
填充树视图... 第三，用您的 Target 节点填充树视图...
第四，创建一个空的树视图。

然后，就这么简单：

```
 private void btn_Merge_Click(object sender, EventArgs e)
    {
        //first merge
        foreach (TreeNode sourceNode in this.treeview_Source.Nodes)
        {
            FindOrAdd(sourceNode, ref this.treeview_Merged);
        }

        //second merge
        foreach (TreeNode targetNode in this.treeview_Target.Nodes)
        {
            FindOrAdd(targetNode, ref this.treeview_Merged);
        }
    }

    private void FindOrAdd(TreeNode FindMe, ref TreeView InHere)
    {
        TreeNode[] found = InHere.Nodes.FindExact(FindMe.Name);
        //if the node is not found, add it at the proper location.
        if (found.Length == 0)
        {
            if (FindMe.Parent != null)
            {
                TreeNode[] foundParent = InHere.Nodes.FindExact(FindMe.Parent.Name);
                if (foundParent.Length == 0)
                    InHere.Nodes.Add((TreeNode)FindMe.Clone());
                else
                    foundParent[0].Nodes.Add((TreeNode)FindMe.Clone());
            }
            else
                InHere.Nodes.Add((TreeNode)FindMe.Clone());
        }
        else
        {
            //if the item was found, check all children.
            foreach (TreeNode child in FindMe.Nodes)
                FindOrAdd(child, ref InHere);
        }
    } 
```

再一次，这个解决方案只有在你有唯一路径的情况下才有效......通过扩展，它还考虑了案例级别的唯一性。

我在这里发布这个是为了帮助那些像我一样不得不连续几天寻找解决方案但没有成功并且不得不建立自己的解决方案的人。

# javascript - 为什么 gzipped html 文件显示没有 JS 和 CSS？

> ID：866383
> 
> 赞同：1
> 
> 时间：2009-05-14T23:29:28.527
> 
> 标签：javascript, html, css, compression, gzip

我有一个以 gzip 格式保存的 html 文件。浏览器显示 html 文件，但没有 javascript 和 CSS。同一目录中的非压缩 html 文件可以正确显示。此外，我从压缩的 html 文件中保存了源代码，它正确地重新打开，并应用了 JS 和 CSS。

显示不允许它获取 JS 和 CSS 的压缩 html 有什么不同？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T00:46:11.777

基本问题是您不能只在浏览器需要 CSS 的地方提供 gzip 文件。就其本身而言，这与返回 JPEG 或火腿三明治一样不起作用。

当内容被动态压缩时，响应会有所不同——响应说“我是文本/css，但是碰巧用 gzip 编码进行传输”。浏览器可以弄清楚这一点。

如果您在本地提供 gzip 压缩文件，一些 Web 服务器（如 Apache）也会为您做这种事情。但我想你的服务器不是。

为什么它适用于 HTML？嗯，我不知道，也许您的浏览器实际上在这种特殊情况下设法弄清楚？

您最终想要做的是使用 Content-Type: text/css 和 Content-Encoding: gzip 提供响应以使其正确识别。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-16T18:36:07.997

如果您在自己的服务器（如 XAMPP）上使用 Localhost，
那么您需要配置 .htaccess 文件以发送正确的
标头，表明文件可能已被 gzip 压缩。

尝试将此添加到您的主 .htaccess 文件中：

```
AddEncoding x-gzip .gz
AddType text/html .gz 
```

并确保您的 gzip 压缩
文件以**.gz**扩展名结尾。

另外，总是在服务器上运行它.. :)

# javascript - 这个 JavaScript 函数如何创建 GUID？

> ID：866385
> 
> 赞同：2
> 
> 时间：2009-05-14T23:30:47.650
> 
> 标签：javascript, guid

我遇到了这个 JavaScript 函数，但我不太明白它在做什么，尤其是在使用 0xF 时。

0xF 究竟做了什么。对我来说，它看起来像是一个空的蚕食。

```
function()
{
    var g = "";
    for(var i = 0; i < 32; i++)
        g += Math.floor(Math.random() * 0xF).toString(0xF)
    return g;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-14T23:34:26.613

`0xF`== 15\. 它只是十六进制表示法。

但是，该片段实际上并没有创建 GUID，它只是将一堆随机整数串在一起。无法在 JavaScript 中创建 GUID，因为生成 GUID 需要 VM 无法访问的参数（网络地址等）。

* * *

另请参阅我对这个问题的回答：[如何在 Javascript 中创建 GUID？](https://stackoverflow.com/questions/105034/how-to-create-a-guid-in-javascript)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T23:34:15.850

0xF 是十六进制表示法

编辑：

看起来它正在选择一个随机字符 0-9 AF 32 次

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T23:35:27.453

它所做的只是创建随机数并将它们转换为十六进制。

我只是做了一点调查。. . 它取一个随机数，将其乘以 15 (0xF == 15)，然后将其转换为 hex 。. . toString 参数采用基数。这与说 0xF.toString(10) 相同。这会将 0xF 转换为十进制并返回“15”。

# c# - SSRS2000 WebService 上的 .Render() 在 SSRS2008 上被什么替换了？

> ID：866390
> 
> 赞同：6
> 
> 时间：2009-05-14T23:33:23.777
> 
> 标签：c#, reporting-services, reportingservices-2005, ssrs-2008

我们最近将我们的一台 SSRS2005 服务器升级到 SSRS2008，并发现我们所有使用报告服务 Web 服务生成报告的应用程序都不再工作。

第一个问题是 Web 服务本身在 ReportService.asmx 中不再可用，并且已被替换为：ReportService2005.asmx。

我们将 Web 引用更改为新位置，现在我们收到消息，即 .Render() 方法不是 ReportService2005.asmx 的一部分。以下代码实现在 SSRS2008 中被替换为什么？

```
report = rpt.Render(ReportPath + ReportName, this.Format.ToString(), null, devInfo.ToString(), parameters, null, null, out encoding, out mimetype, out parametersUsed, out warnings, out streamids); 
```

**编辑**
在做了更多的研究之后，事实证明 ReportService.asmx 是 SQL 2000 Reporting Services 的一部分，现在已经从 SQL 2008 Reporting Services 中弃用了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T23:43:11.880

这里有几篇关于从 SSRS 2005 迁移到 SSRS 2008 的文章

*   [升级报告](http://technet.microsoft.com/en-us/library/ms143674.aspx)
*   [Reporting Services 向后兼容性](http://technet.microsoft.com/en-us/library/ms143251.aspx)
*   [报表服务器 Web 服务端点](http://technet.microsoft.com/en-us/library/ms155398.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-21T16:53:15.060

`ReportService.asmx`已弃用。它已被替换为：

*   `ReportService2005.asmx`-*管理端点*
*   `ReportExecution2005.asmx`-*执行端点*

还有一个 SharePoint 代理端点。这是一篇列举 2008 年[报表服务器 Web 服务端点](http://technet.microsoft.com/en-us/library/ms155398.aspx)的文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T18:15:19.117

正如您所指出的，由于 ReportService.asmx 已被删除，您应该使用 ReportExecution2005.asmx，然后根据代码中的要求更改报告参数。

# python - django模型类__init__中的keyerror

> ID：866399
> 
> 赞同：1
> 
> 时间：2009-05-14T23:35:13.927
> 
> 标签：python, django, django-models

这是我写的一个 Django 模型类。当我从 Django 调用时，这个类会得到一个 keyerror `get_object_or_404`（我认为 keyerror 是由于`__init__`get 函数没有传递给 kwargs 而引发的，参数都是位置的）。`get_object_or_404`有趣的是，当我从控制台调用时，它不会出错。

我想知道为什么，如果下面的代码是构造这个类的正确方法（即，使用**init**填充链接字段）。

```
class Link(models.Model)

    event_type = models.IntegerField(choices=EVENT_TYPES)
    user = models.ForeignKey(User)
    created_on = models.DateTimeField(auto_now_add = True)
    link = models.CharField(max_length=30)
    isActive = models.BooleanField(default=True)

    def _generate_link(self):
        prelink = str(self.user.id)+str(self.event_type)+str(self.created_on)
        m = md5.new()
        m.update(prelink)
        return m.hexdigest()

    def __init__(self, *args, **kwargs):
        self.user = kwargs['user'].pop()
        self.event_type = kwargs['event_type'].pop()
        self.link = self._generate_link()
        super(Link,self).__init__(*args,**kwargs) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-14T23:58:34.480

```
self.user = kwargs['user'].pop()
self.event_type = kwargs['event_type'].pop() 
```

您正在尝试从字典中检索条目，然后调用它的 pop 方法。如果要从字典中删除并返回对象，请调用`dict.pop()`：

```
self.user = kwargs.pop('user') 
```

当然，这将失败，因为`KeyError`when `"user"`is not present in `kwargs`。您需要提供一个默认值来弹出：

```
self.user = kwargs.pop('user', None) 
```

这意味着“如果`"user"`在字典中，删除并返回它。否则，返回`None`”。

关于其他两行：

```
self.link = self._generate_link()
super(Link,self).__init__(*args,**kwargs) 
```

`super().__init__()`可能会设置`link`为`None`. 我会将线条颠倒过来，如下所示：

```
super(Link,self).__init__(*args,**kwargs)
self.link = self._generate_link() 
```

您可能想在设置链接之前添加一个测试，以查看它是否已经存在 ( `if self.link is not None: ...`)。这样，您传递给构造函数的链接就不会被覆盖。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T01:31:40.917

没有理由`__init__`为 Django 模型类编写自己的。我想没有它你会快乐很多。

几乎任何你认为你想做的事情`__init__`都可以在`save`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T06:29:39.563

我认为你根本不需要`__init__`这里。

实例化类时，您总是在计算链接的值。这意味着您忽略数据库中存储的任何内容。既然是这种情况，为什么还要为模型字段烦恼呢？您最好将链接设为属性，而 getter 使用来自`_generate_link`.

```
@property
def link(self): 
    .... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T01:35:20.677

> 想知道为什么，以及下面的代码是否是`__init__`构造此类的正确方法（即，用于填充链接字段）。

我曾经在尝试超载时遇到一些问题`__init__` 在邮件列表中我得到了这个答案

> 最好不要用自己的 `__init__`. 更好的选择是使用自定义方法挂钩`post_init`信号，并在该方法中执行您的`process()`和 `make_thumbnail()`调用。

在您的情况下， post_init-signal 应该可以解决问题，并且根本不需要实施`__init__`。你可以这样写：

```
class Link(models.Model)
    event_type = models.IntegerField(choices=EVENT_TYPES)
    user = models.ForeignKey(User)
    created_on = models.DateTimeField(auto_now_add = True)
    link = models.CharField(max_length=30)
    isActive = models.BooleanField(default=True)

    def create_link(self):
        prelink = str(self.user.id)+str(self.event_type)+str(self.created_on)
        m = md5.new()
        m.update(prelink)
        return m.hexdigest()

def post_link_init(sender, **kwargs):
    kwargs['instance'].create_link()
post_init.connect(post_link_init, sender=Link)

>>> link = Link(event_type=1, user=aUser, created_on=datetime.now(), link='foo', isActive=True) 
```

提供关键字`unique`for`link = models.CharField(max_length=30, unique=True)`也可能会有所帮助。如果未提供，get_object_or_404 可能会在链接字段中的相同值存在多次的情况下不起作用。

django-docs 中的[信号](http://docs.djangoproject.com/en/dev/topics/signals/)和[唯一性](http://docs.djangoproject.com/en/dev/ref/models/fields/#unique)

# ms-access - 如何将 SubSonic 与 MS Access 数据库一起使用

> ID：866401
> 
> 赞同：7
> 
> 时间：2009-05-14T23:36:28.917
> 
> 标签：ms-access

是否可以将亚音速与 MS 访问 MDB 文件一起使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T00:46:11.637

从事情的外观来看，没有。 [http://forums.subsonicproject.com/forums/t/2968.aspx](http://forums.subsonicproject.com/forums/t/2968.aspx)看起来像创建了一个“离线测试版”，但看看那里的线程，看起来事情遇到了问题。Access 真的是另一种动物（它是一个假数据库，看在上帝的份上），所以任何愿意编写像 Subsonic 这样的 DAL 的人都会瞄准真正的交易，比如 Oracle、MySQL 和 MS SQL。为什么您至少不使用[MS SQL Server 的 Express Edition 之一](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx)？走这条路，你肯定会获得更多的里程、可扩展性和兼容的工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-02-15T11:00:41.397

有可能，DataProvider 就在这里

[https://github.com/subsonic/SubSonic-2.0/blob/master/SubSonic/DataProviders/AccessDataProvider.cs](https://github.com/subsonic/SubSonic-2.0/blob/master/SubSonic/DataProviders/AccessDataProvider.cs)

连同亚音速的完整项目。

# math - 有人可以解释数学归纳法（证明递归方法）

> ID：866407
> 
> 赞同：8
> 
> 时间：2009-05-14T23:38:09.990
> 
> 标签：math, recursion

有人可以解释数学归纳法来证明递归方法吗？我是一名计算机科学专业的新生，我还没有学过微积分（我已经通过了 Trig）。我有点理解，但是当被要求为递归方法写出归纳证明时我遇到了麻烦。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T00:18:09.767

下面是一个例子的解释：

假设您有以下要证明的公式：

```
sum(i | i <- [1, n]) = n * (n + 1) / 2 
```

该公式为 和 之间的所有整数之和提供了一个封闭`1`形式`n`。

我们将从证明 的简单基本情况的公式开始`n = 1`。在这种情况下，公式两边都归约为`1`。这反过来意味着该公式适用于`n = 1`。

接下来，我们将证明如果公式对值`n`成立，那么它对`n`(or `n + 1`) 的下一个值成立。换句话说，如果以下情况为真：

```
sum(i | i <- [1, n]) = n * (n + 1) / 2 
```

那么以下也是正确的：

```
sum(i | i <- [1, n + 1]) = (n + 1) * (n + 2) / 2 
```

为此，让我们从最后一个公式的第一面开始：

```
s1 = sum(i | i <- [1, n + 1]) = sum(i | i <- [1, n]) + (n + 1) 
```

也就是说， 和 之间的所有整数之`1`和`n + 1`等于 和 之间的整数之`1`和`n`，加上最后一项`n + 1`。

由于我们的证明是基于公式对 成立的`n`，所以我们可以写成：

```
s1 = n * (n + 1) / 2 + (n + 1) = (n + 1) * (n + 2) / 2 = s2 
```

如您所见，我们已经到达了我们试图证明的公式的第二面，这意味着该公式确实成立。

这完成了归纳证明，但它实际上意味着什么？

1.  该公式对 n = 0 是正确的。
2.  如果公式对 是正确的`n`，那么它对 是正确的`n + 1`。

从 1 和 2，我们可以说：如果公式对于 n = 0 是正确的，那么它对于 是正确的`0 + 1 = 1`。既然我们证明了 的情况`n = 0`，那么 的情况`n = 1`确实是正确的。

我们可以再次重复上述过程。大小写`n = 1`正确，则大小写`n = 2`正确。这种推理可以无限地进行。该公式对于 n >= 1 的所有整数值都是正确的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-15T06:41:08.023

感应！=计算！

我可以让 N 个人喝 10*N 杯啤酒。

基本情况：1人

我可以让一个人喝 10 杯啤酒

归纳步骤，给定 p(n) 证明 p(n + 1)

我可以喝 10 * i 杯啤酒让我喝醉，如果我添加另一个人，我可以再喝 10 杯啤酒让他喝醉。因此，我可以让 i + 1 个人喝 10 * (i + 1) 杯啤酒。

p(1) -> p(i + 1) -> p(i + 2) ... p(inf)

离散数学很容易！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:52:15.430

首先，您需要一个基本案例。然后，您需要一个适用于某个步骤 n 的归纳步骤。在你的归纳步骤中，你需要一个归纳假设。该假设是您需要做出的假设。最后，使用该假设来证明步骤 n+1

# ms-access - 访问 - 数据提供者未初始化？

> ID：866411
> 
> 赞同：0
> 
> 时间：2009-05-14T23:38:58.880
> 
> 标签：ms-access, vba

我使用 Access 2003 开发了 SQL Server 数据库的前端。因为系统打算使用不同的 Schema 对表数据进行分区，所以 Access 项目不起作用。因此，相反，我被迫接管连接管理以进行访问 - 我维护一个全局连接对象，并将记录集分配给表单而不是记录源。

这会导致一个问题 - 任何时候有人尝试使用与记录集交互的内置 Access 功能时，该操作都不起作用，并且会显示一个对话框，显示“无法初始化数据提供程序”。我已经进行了一些研究，但无法找到相关的原因，但我怀疑这是由于 Access 期望表单具有适当的记录源属性，并且不能真正与分配的记录集一起使用。

任何人都可以对此有所了解吗？有没有办法使用自我管理的记录集，并利用内置功能？谁能确认这是一个访问错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-19T21:59:00.270

经过一番玩耍，我找到了部分解决方案。我使用的是客户端游标，但保持记录集连接。通过断开记录集，数据提供者消息消失了。当然，这引入了其他问题，但那是另一个故事……当然，我仍然不明白为什么这样做会有所作为……还有其他人吗？

# c - 串口通信问题（C 代码）

> ID：866417
> 
> 赞同：2
> 
> 时间：2009-05-14T23:41:10.730
> 
> 标签：c, winapi, serial-port

我最近尝试使用蓝牙 USB 加密狗访问串行通信。我使用下面的 C 代码，并不断收到错误 5，即“访问被拒绝”。我是系统管理员（这似乎是论坛上此问题的常见解决方案），没有其他应用程序访问我正在使用的同一端口（也是另一个常见解决方案）。我在 Windows Vista Home Basic 32 位系统上运行。我想知道是否有人对此有解决方案 我的 C 代码是：

```
HANDLE hComm; 
```

hComm = CreateFile(_T("\\.\COM3"), GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);

```
if (hComm == INVALID_HANDLE_VALUE)
    printf("Error number: %ld\n", GetLastError());
else
    printf("success\n"); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T23:48:06.657

我不知道这是否是您的问题，但我怀疑您需要转义路径中的反斜杠，如下所示：`"\\\\.\\COM3"`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:01:56.313

看起来你必须再次逃避你的反斜杠。您还可以使用对象查看器（例如 WinObj ( [http://technet.microsoft.com/en-us/sysinternals/bb896657.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896657.aspx) )）验证您的目标 COM 端口是否存在于您的系统中，尽管我不这样做不知道 WinObj 是否在 Vista 上运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T23:58:16.510

根据我的经验，不需要反斜杠

```
hComm = CreateFile( _T("COM3"), GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T13:42:17.933

感谢您的提示，但事实证明蓝牙密码设置不正确，因此拒绝访问串行端口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-26T23:57:42.130

只需在您的代码中用 \.\COM# 替换您的 COM#，

```
 hComm = CreateFile("\\\\.\\COM15",

              GENERIC_READ | GENERIC_WRITE,
              0,
              0,
              OPEN_EXISTING,
              0,
              0); 
```

# python - 在 Django 中，如何更改 User 类以使用不同的数据库表？

> ID：866418
> 
> 赞同：1
> 
> 时间：2009-05-14T23:41:46.843
> 
> 标签：python, django, django-models, monkeypatching

我们正在与现有应用程序一起运行 django - 并与 - 共享数据库。我们想使用现有的“用户”表（不是 Django 自己的）来存储用户信息。

看起来可以在用户定义的 Meta 类中更改 Django 使用的表的名称。

但我们不希望改变 Django 核心本身。

所以我们认为我们可以像这样子类化核心 auth.User 类：

```
class OurUser(User) :
    objects = UserManager()
    class Meta:
        db_table = u'our_user_table' 
```

这里的目的不是向自定义的 User 类添加任何额外的字段。但只是为了使用替代表。

但是，这失败了（可能是因为 ORM 假设 our_user_table 应该有一个外键引用原始 User 表，但它没有）。

那么，这是做我们想做的事的明智方式吗？我是否错过了一些将类映射到表格的更简单方法？或者，如果没有，可以使它起作用吗？

更新 ：

我想我可以通过在 local_settings.py 中“猴子修补”用户的 _meta 来做出我想要的改变

```
User._meta.db_table = 'our_user_table' 
```

谁能想到如果我这样做会发生什么不好的事情？（特别是在相当典型的 Django / Pinax 应用程序的上下文中？）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-14T23:50:16.950

[您可能会发现将旧表设置为替代身份验证源](http://docs.djangoproject.com/en/dev/topics/auth/#other-authentication-sources)并回避所有这些问题很有用。

另一种选择是[将用户子类化](http://docs.djangoproject.com/en/dev/topics/auth/#storing-additional-information-about-users)并让子类指向您的用户模型。覆盖保存功能以确保保留旧功能所需的一切都在那里。

我自己都没有做过这些，但希望它们是有用的指针。

**更新** 在这种情况下，我所说的替代身份验证的意思是一个小的 python 脚本，上面写着“是的，这是一个有效的用户名/密码”——然后它在标准 Django 表中创建一个模型实例，从遗留表复制字段和将新用户返回给调用者。

如果您需要保持两个表同步，您可以决定让您的替代身份验证永远不要创建标准 django 用户，只需说“是的，这是一个有效的密码和用户名”

# iphone - UIWebView 中的 iPhone 键盘不会消失

> ID：866419
> 
> 赞同：3
> 
> 时间：2009-05-14T23:42:30.417
> 
> 标签：iphone, html, dom, uiwebview

我有一个加载 HTML 表单的 UIWebView。

当我选择一个文本字段时，键盘会出现。

当我键入并点击“Go”时，表单被提交并加载下一页，但键盘并没有消失，它停留在屏幕上。

摆脱键盘的唯一方法是按下键盘上的“完成”按钮或按下表单中的 HTML 提交按钮。

点击Go按钮后是否可以使键盘消失？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T14:52:36.420

您需要在表单提交时让活动输入退出焦点。最简单的方法是调用`.blur()`表单`onsubmit`事件处理程序中的所有输入

```
<form onsubmit="document.getElementById('myInput').blur();">
    <input type="text" id="myInput"/>
</form> 
```

# .htaccess - htaccess URL重写速度优化

> ID：866421
> 
> 赞同：0
> 
> 时间：2009-05-14T23:43:25.843
> 
> 标签：.htaccess, mod-rewrite, url-rewriting

我的服务器支持告诉我我的 htaccess URL 重写导致开销。我主要对“更好”的 URL 使用 URL 重写（例如 example.com/?foo=bar 将是 example.com/foo/bar 左右）。一般来说，在优化 htaccess RewriteEngine 时要记住哪些提示和技巧？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-29T10:36:33.127

将尽可能多的 .htaccess 指令（包括 mod_rewrite 规则）移动到 httpd 配置 (httpd.conf) 中 - 这仅在服务器重新启动时读取一次，而不是在每个请求、每个目录时读取。除此之外，除非你有过多的重写规则，或者一个非常复杂的单独规则，否则没有什么大不了的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:46:47.577

由于 mod_rewrite 使用的是正则表达式，我认为你宁愿优化你的正则表达式！

# visual-studio - 如何在 Visual Studio 2008 项目属性中使用环境变量？

> ID：866423
> 
> 赞同：2
> 
> 时间：2009-05-14T23:44:23.377
> 
> 标签：visual-studio

例如，是否可以在 Program Files 中设置应用程序文件夹的输出路径？

%ProgramFiles%\MyCompany\MyApp\ 不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T00:02:42.973

[微软在这里](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=368148)引用：

> 不幸的是，这是设计使然。我们不支持在 UI 中使用环境变量，但是您可以在记事本中手动编辑文件并在尝试 $(varname) 时指定变量名称。但是，此解决方法将不允许您对项目属性中的属性进行编辑。

因此将项目文件中的 OutputPath 属性更改为：

```
<OutputPath>$(ProgramFiles)\MyCompany\MyApp\</OutputPath> 
```

会起作用，但它所做的一切（正如您在 Visual Studio 中再次打开项目并查看项目属性时所看到的那样）是包含从解决方案目录到输出目录的相对路径。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-14T23:48:56.907

在 Visual Basic 2005 中，应用程序文件夹定义为**my.Application.Info.DirectoryPath**

这将带您到当前正在运行的程序的应用程序文件夹

否则作为变量保存的文件夹，例如我的文档；桌面; 临时；程序文件

位于**my.Computer .FileSystem .SpecialDirectories**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T00:05:11.470

您真的要构建到您的 Program Files 目录吗？您应该创建一个部署项目。然后，您可以使用 [ProgramFiles] 以及许多其他宏将您的应用程序部署到您想要的任何位置。

# .net - 如何在 COM 对象中实现 Dispose

> ID：866440
> 
> 赞同：0
> 
> 时间：2009-05-14T23:51:37.383
> 
> 标签：.net, com, interop

我用非托管 C++ 编写了一个 COM 组件，为客户提供对我们数据库的访问。从非托管语言中使用它时，当对象超出范围时，数据库连接会被正确清理。我最近尝试从 VB.NET 使用它，发现 COM 对象没有被破坏。**对System.Runtime.InteropServices.Marshal.ReleaseComObject**的分散调用解决了这个问题，但我想找到一个更简单且异常安全的解决方案，因为这个 COM 对象是为客户使用而设计的。

看来正确的解决方案是让托管对象实现**IDisposeable**以便可以**使用 using**语句，当不再需要对象时自动调用**Dispose 。**

如何为我的对象子集实现 IDisposeable？一些需要处理的对象不是可共同创建的，而是由其他函数返回的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T23:58:10.393

疯狂就是这样。您最好将 COM 对象包装在实现 IDisposable（如果您愿意）的类型安全的 .Net 包装器中，或者使用 .Net 垃圾收集的常规方法来清理它们自己。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-27T14:28:36.570

您可以按照 1800 INFORMATION 的建议使用 .NET 包装器，然后记住始终将它们与您所说的 using 语句一起使用：

```
using( var connection = GetDisposableConnection() )
{
    //do stuff
} 
```

如果这不起作用，因为没有正确释放某些东西，您可以在关闭时插入这些行：

```
GC.Collect();
GC.WaitForPendingFinalizers();
GC.Collect(); 
```

# c# - 投影仪控制/显示 C#

> ID：866444
> 
> 赞同：1
> 
> 时间：2009-05-14T23:51:52.373
> 
> 标签：c#, projector

我进行了一些搜索，但找不到与我正在寻找的东西相似的东西。我很想知道如何使用 C# 在二级/三级显示器或投影仪上显示不同的内容。基本上，我想要实现的是在一个特定屏幕（主显示器）上具有某种形式的演示者视图（lá Powerpoint），并在辅助屏幕或投影仪上输出。我从来没有真正尝试过开发具有多个显示输出的东西，因此任何指导都可能必须处于相当明显的水平。

如果有人能指出我如何在 C# 中处理这类事情的正确方向，那将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T00:51:42.200

只是为了扩展 Keven 的答案（我 +1 了）， Screen.AllScreens 数组为您提供了一组 Screen 对象。Screen 对象有一个名为 IsPrimary 的属性，您可以使用它来确定哪个是主屏幕，哪个是辅助屏幕（duh），它还有一个名为 WorkingArea 的属性，它是一个矩形，可以返回所有的坐标第二个屏幕。很酷的一点是，即使我们说辅助屏幕配置在主屏幕的左侧，WorkingArea.X 将是一个负数，您可以在那里放置表单或其他任何东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T00:47:38.963

您可以使用该`System.Windows.Forms.Screen.AllScreens`属性访问 Windows 知道的所有监视器的列表。如果您希望使用用户尚未配置的显示器，那将变得更加困难——您可能需要使用 DirectX 初始化和访问显示适配器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T00:50:35.337

您需要与之交互的主要类之一是[Screen](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.aspx)（它位于 WinForms 命名空间中）。通常，所有屏幕都被视为一组工作区域，您可以使用屏幕类来获取每个屏幕的属性。

你可以得到所有这样的屏幕......

```
Screen [] screens = Screen.AllScreens; 
```

[这](http://www.codeproject.com/KB/cs/multi-monitor_in_c_.aspx)是一篇关于在 C# 中进行多监视器编程的简短文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-12-02T13:49:01.120

还要记住在要在辅助屏幕上显示的窗口上将属性“StartPosition”设置为“Manual”，否则它将始终显示在主屏幕上。

# mysql - 按年份分组数据——返回 0 表示没有结果

> ID：866462
> 
> 赞同：1
> 
> 时间：2009-05-15T00:01:44.627
> 
> 标签：mysql

我当前的 MySQL 查询：

```
SELECT MAX( s.con_grade ) AS max, YEAR( u.sent_date ) AS year
FROM pdb_usersectionmap u
LEFT JOIN pdb_sections s ON u.section_id = s.id
WHERE u.user_id =21
AND YEAR( u.sent_date ) > '2004-01-01'
GROUP BY YEAR( u.sent_date )
ORDER BY u.sent_date ASC 
```

（年份和user_id在PHP中是动态生成的）

我正在尝试显示过去 5 年的结果。在某些情况下，用户可能没有当年的 MAX。例如，*该*用户只有最近 3 年的条目（但没有之前的年份）：

```
max     year
5     2007
6.05    2008
7     2009 
```

我的问题：如果我告诉 MySQL 查找特定年份的条目，如果没有找到条目，MySQL 是否有办法返回该年份的“0”？

理想情况下，我希望输出是（会节省很多时间）：

```
year    max
2005      0
2006       0
2007      5
2008       6.05
2009       7 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T00:31:22.653

这样做的一种正确方法是有一个年份表，对其进行外部连接，并按该表中的年份列分组，类似这样（未测试）

```
SELECT MAX( s.con_grade ) AS max, YEAR( u.sent_date ) AS year
FROM pdb_usersectionmap u
LEFT JOIN pdb_sections s ON u.section_id = s.id
RIGHT JOIN years y ON year = y.year_id
WHERE u.user_id =21
AND y.year_id > 2004
GROUP BY y.year_id
ORDER BY u.sent_date ASC 
```

年份表当然可以即时生成，也可以通过对另一个表的“不同”子查询生成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T00:10:25.217

```
isnull(<field>, <value>) 
```

让我给你举个例子。

```
SELECT ISNULL(MAX(s.con_grade),0) AS [max]
      ,YEAR( u.sent_date ) AS [year]
  FROM pdb_usersectionmap u,
      ,pdb_sections s
 WHERE u.section_id = s.id
   AND u.user_id = 21
   AND YEAR(u.sent_date) > '2004-01-01'
 ORDER
    BY u.sent_date 
```

我出于懒惰而隐含地加入了该连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T00:13:23.697

尝试偷偷摸摸，以确保每个是的至少有一个记录：

```
UNION SELECT '0', '2006'
UNION SELECT '0', '2007'
etc.. 
```

我仍然会尝试将此逻辑移动到您的 PHP 应用程序中。

# sql - 按 IN 值列表排序

> ID：866465
> 
> 赞同：206
> 
> 时间：2009-05-15T00:02:22.520
> 
> 标签：sql, postgresql, sql-order-by, sql-in

我在 PostgreSQL 8.3 中有一个简单的 SQL 查询，它获取了一堆注释。我为子句中的构造提供了一个*排序*的值列表：`IN``WHERE`

```
SELECT * FROM comments WHERE (comments.id IN (1,3,2,4)); 
```

这会以任意顺序返回评论，在我看来，这些评论恰好是`1,2,3,4`.

我希望生成的行像`IN`构造中的列表一样排序：`(1,3,2,4)`。
如何做到这一点？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-05-15T08:32:50.907

You can do it quite easily with (introduced in PostgreSQL 8.2) VALUES (), ().

Syntax will be like this:

```
select c.*
from comments c
join (
  values
    (1,1),
    (3,2),
    (2,3),
    (4,4)
) as x (id, ordering) on c.id = x.id
order by x.ordering 
```

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2016-02-17T12:37:41.177

In Postgres **9.4** or later, this is ***simplest and fastest***:

```
SELECT c.*
FROM   comments c
JOIN   unnest('{1,3,2,4}'::int[]) WITH ORDINALITY t(id, ord) USING (id)
ORDER  BY t.ord; 
```

*   [**`WITH ORDINALITY`**](https://www.postgresql.org/docs/current/functions-srf.html) was introduced with in Postgres 9.4.

*   No need for a subquery, we can use the set-returning function like a table directly. (A.k.a. "table-function".)

*   A string literal to hand in the array instead of an [ARRAY constructor](https://www.postgresql.org/docs/current/sql-expressions.html#SQL-SYNTAX-ARRAY-CONSTRUCTORS) may be easier to implement with some clients.

*   For convenience (optionally), copy the column name we are joining to (`id` in the example), so we can join with a short `USING` clause to only get a single instance of the join column in the result.

*   Works with ***any*** input type. If your key column is of type `text`, provide something like `'{foo,bar,baz}'::text[]`.

Detailed explanation:

*   [PostgreSQL unnest() with element number](https://stackoverflow.com/questions/8760419/postgresql-unnest-with-element-number/8767450#8767450)

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2012-01-15T21:19:27.730

Just because it is so difficult to find and it has to be spread: [in mySQL this can be done much simpler](http://dev.mysql.com/doc/refman/5.0/en/select.html), but I don't know if it works in other SQL.

```
SELECT * FROM `comments`
WHERE `comments`.`id` IN ('12','5','3','17')
ORDER BY FIELD(`comments`.`id`,'12','5','3','17') 
```

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2015-04-13T06:17:12.643

With [Postgres 9.4](http://www.postgresql.org/docs/current/static/queries-table-expressions.html#QUERIES-TABLEFUNCTIONS) this can be done a bit shorter:

```
select c.*
from comments c
join (
  select *
  from unnest(array[43,47,42]) with ordinality
) as x (id, ordering) on c.id = x.id
order by x.ordering; 
```

Or a bit more compact without a derived table:

```
select c.*
from comments c
  join unnest(array[43,47,42]) with ordinality as x (id, ordering) 
    on c.id = x.id
order by x.ordering 
```

Removing the need to manually assign/maintain a position to each value.

With [Postgres 9.6](https://www.postgresql.org/docs/current/static/functions-array.html#ARRAY-FUNCTIONS-TABLE) this can be done using `array_position()`:

```
with x (id_list) as (
  values (array[42,48,43])
)
select c.*
from comments c, x
where id = any (x.id_list)
order by array_position(x.id_list, c.id); 
```

The CTE is used so that the list of values only needs to be specified once. If that is not important this can also be written as:

```
select c.*
from comments c
where id in (42,48,43)
order by array_position(array[42,48,43], c.id); 
```

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2012-02-28T02:51:52.280

I think this way is better :

```
SELECT * FROM "comments" WHERE ("comments"."id" IN (1,3,2,4))
    ORDER BY  id=1 DESC, id=3 DESC, id=2 DESC, id=4 DESC 
```

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2013-01-13T14:49:13.020

Another way to do it in Postgres would be to use the `idx` function.

```
SELECT *
FROM comments
ORDER BY idx(array[1,3,2,4], comments.id) 
```

Don't forget to create the `idx` function first, as described here: [http://wiki.postgresql.org/wiki/Array_Index](http://wiki.postgresql.org/wiki/Array_Index)

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2013-03-26T11:48:54.753

In Postgresql:

```
select *
from comments
where id in (1,3,2,4)
order by position(id::text in '1,3,2,4') 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-15T00:22:03.923

在对此进行更多研究时，我发现了这个解决方案：

```
SELECT * FROM "comments" WHERE ("comments"."id" IN (1,3,2,4)) 
ORDER BY CASE "comments"."id"
WHEN 1 THEN 1
WHEN 3 THEN 2
WHEN 2 THEN 3
WHEN 4 THEN 4
END 
```

然而，这似乎相当冗长，并且可能在大型数据集上存在性能问题。任何人都可以对这些问题发表评论吗？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-15T00:29:59.320

为此，我认为您可能应该有一个额外的“ORDER”表，它定义了 ID 到订单的映射（有效地按照您对自己问题的回答），然后您可以将其用作您选择的附加列然后你可以排序。

通过这种方式，您可以在数据库中明确描述您想要的顺序，它应该在哪里。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-15T01:17:37.363

sans SEQUENCE, works only on 8.4:

```
select * from comments c
join 
(
    select id, row_number() over() as id_sorter  
    from (select unnest(ARRAY[1,3,2,4]) as id) as y
) x on x.id = c.id
order by x.id_sorter 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-15T00:35:21.803

```
SELECT * FROM "comments" JOIN (
  SELECT 1 as "id",1 as "order" UNION ALL 
  SELECT 3,2 UNION ALL SELECT 2,3 UNION ALL SELECT 4,4
) j ON "comments"."id" = j."id" ORDER BY j.ORDER 
```

或者如果你更喜欢邪恶而不是善良：

```
SELECT * FROM "comments" WHERE ("comments"."id" IN (1,3,2,4))
ORDER BY POSITION(','+"comments"."id"+',' IN ',1,3,2,4,') 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-15T00:54:16.217

```
create sequence serial start 1;

select * from comments c
join (select unnest(ARRAY[1,3,2,4]) as id, nextval('serial') as id_sorter) x
on x.id = c.id
order by x.id_sorter;

drop sequence serial; 
```

[编辑]

unnest is not yet built-in in 8.3, but you can create one yourself(the beauty of any*):

```
create function unnest(anyarray) returns setof anyelement
language sql as
$$
    select $1[i] from generate_series(array_lower($1,1),array_upper($1,1)) i;
$$; 
```

that function can work in any type:

```
select unnest(array['John','Paul','George','Ringo']) as beatle
select unnest(array[1,3,2,4]) as id 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-15T00:59:11.167

And here's another solution that works and uses a constant table ([http://www.postgresql.org/docs/8.3/interactive/sql-values.html](http://www.postgresql.org/docs/8.3/interactive/sql-values.html)):

```
SELECT * FROM comments AS c,
(VALUES (1,1),(3,2),(2,3),(4,4) ) AS t (ord_id,ord)
WHERE (c.id IN (1,3,2,4)) AND (c.id = t.ord_id)
ORDER BY ord 
```

But again I'm not sure that this is performant.

I've got a bunch of answers now. Can I get some voting and comments so I know which is the winner!

Thanks All :-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-05T15:45:22.643

Slight improvement over the version that uses a sequence I think:

```
CREATE OR REPLACE FUNCTION in_sort(anyarray, out id anyelement, out ordinal int)
LANGUAGE SQL AS
$$
    SELECT $1[i], i FROM generate_series(array_lower($1,1),array_upper($1,1)) i;
$$;

SELECT 
    * 
FROM 
    comments c
    INNER JOIN (SELECT * FROM in_sort(ARRAY[1,3,2,4])) AS in_sort
        USING (id)
ORDER BY in_sort.ordinal; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-06-06T11:08:15.890

```
select * from comments where comments.id in 
(select unnest(ids) from bbs where id=19795) 
order by array_position((select ids from bbs where id=19795),comments.id) 
```

here, [bbs] is the main table that has a field called ids, and, ids is the array that store the comments.id .

passed in postgresql 9.6

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-07-11T21:15:53.200

Lets get a visual impression about what was already said. For example you have a table with some tasks:

```
SELECT a.id,a.status,a.description FROM minicloud_tasks as a ORDER BY random();

 id |   status   |   description    
----+------------+------------------
  4 | processing | work on postgres
  6 | deleted    | need some rest
  3 | pending    | garden party
  5 | completed  | work on html 
```

And you want to order the list of tasks by its status. The status is a list of string values:

```
(processing, pending,  completed, deleted) 
```

The trick is to give each status value an interger and order the list numerical:

```
SELECT a.id,a.status,a.description FROM minicloud_tasks AS a
  JOIN (
    VALUES ('processing', 1), ('pending', 2), ('completed', 3), ('deleted', 4)
  ) AS b (status, id) ON (a.status = b.status)
  ORDER BY b.id ASC; 
```

Which leads to:

```
 id |   status   |   description    
----+------------+------------------
  4 | processing | work on postgres
  3 | pending    | garden party
  5 | completed  | work on html
  6 | deleted    | need some rest 
```

Credit @user80168

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2009-05-15T00:31:30.237

我同意所有其他说“不要那样做”或“SQL 不擅长那样”的海报。如果您想按评论的某些方面进行排序，则将另一个整数列添加到您的一个表中以保存您的排序标准并按该值排序。例如“ORDER BY comments.sort DESC” 如果你想每次都以不同的顺序对它们进行排序，那么……在这种情况下，SQL 不适合你。

# dedicated-hosting - 如何将软件从媒体安装到远程服务器？

> ID：866468
> 
> 赞同：0
> 
> 时间：2009-05-15T00:03:14.390
> 
> 标签：dedicated-hosting

我将租用虚拟或专用服务器（可能是 Amazon EC2 或来自 SoftLayer）。我想知道将软件从 CD 安装到远程服务器的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T00:04:51.673

将其转换为 ISO 并将 ISO 上传到服务器，然后将其挂载在那里。

# linq - linq to sql group 通过有

> ID：866471
> 
> 赞同：0
> 
> 时间：2009-05-15T00:04:06.247
> 
> 标签：linq, linq-to-sql

谁能告诉我如何使用 linq to sql 编写查询来搜索在特定州至少有 1 个场地的郊区

地点

```
SuburbID
SuburbName
StateName 
```

场地

```
VenueID
VenueName
SuburbName
StateName 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T00:21:19.603

```
var locations = from loc 
                in dataContext.Locations 
                where loc.Venues.Count > 1 
                select loc 
```

编辑：最终答案：

如果您在 Location/Venue 之间设置了外键：

```
string stateName = "New York";  

var locations = from loc 
                in dataContext.Locations 
                where loc.Venues.Count > 1 && loc.StateName == stateName 
                select loc; 
```

* * *

如果没有外键关系：

```
string stateName = "New York";

var locations = (from v 
                 in dataContext.Venues 
                 where v.StateName == stateName 
                 select (from l 
                         in dataContext.Locations 
                         where l.SuburbName == v.SuburbName && l.StateName == v.Statename              
                         select l
                        ).Single()).Distinct(); 
```

* * *

不过，真的，你应该修理你的桌子。Venue 表应该有一个郊区ID，而不是“StateName”和“SuburbName”——保留两者是多余的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T14:05:48.407

这里有几个简单的答案：

```
var suburbNames = dataContext.Venues
  .Where(v => v.StateName == specificState)
  .GroupBy(v => v.SuburbName)
  .Select(g => g.Key)

           //

var locations = dataContext.Location
  .Where(loc => loc.StateName == specificState)
  .Where(loc => loc.Venues.Any()) 
```

使用该 Venues 属性：您可以通过在 linq to sql 设计器中添加关系来获得它 - 即使外键不存在/未在数据库中强制执行。

# javascript - JavaScript 初学者：在 JavaScript 中使用 JSON 和对象

> ID：866482
> 
> 赞同：8
> 
> 时间：2009-05-15T00:07:47.327
> 
> 标签：javascript, json

我有一些 JSON 像这个“产品”一样返回到浏览器：

```
{ "Title": "School Bag", "Image": "/images/school-bag.jpg" } 
```

我希望这个数据是一个“产品”对象，这样我就可以使用原型方法`toHTMLImage()`，比如返回产品的 HTML 图像表示：

```
function Product() { }
Product.prototype.toHTMLImage = function() { //Returns something like <img src="<Image>" alt="<Title>" /> } 
```

如何将我的 JSON 结果转换为`Product`对象以便我可以使用`toHTMLImage`？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-15T00:14:23.227

很简单，如果我明白了，

```
var json = { "Title": "School Bag", "Image": "/images/school-bag.jpg" }
function Product(json) {
    this.img = document.createElement('img');
    this.img.alt = json.Title;
    this.img.src = json.Image;

    this.toHTMLImage = function() {
        return this.img;
    }
}

var obj = new Product(json); // this is your object =D 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T00:11:08.710

也许这个页面会有用：http: [//www.json.org/js.html](https://web.archive.org/web/20161104150452/http://www.json.org:80/js.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T00:12:19.580

```
var stuff = { "Title": "School Bag", "Image": "/images/school-bag.jpg" }
var newstuff = new Product();
for(i in stuff) newstuff.i = stuff[i]; 
```

不确定这是否可行，但试一试：

```
var stuff = { "Title": "School Bag", "Image": "/images/school-bag.jpg" }
stuff.prototype = Product; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-29T08:26:26.170

将 JSON 转换为可以 `window.JSON.parse(jsonText)`在 Mozilla 中使用的对象（检查 Chrome 和 Opera，我不知道它是如何工作的。）

在 Internet Explorer 中，您可以使用`(new Function("return " + jsonText))()`，但您应该检查 JSON 中是否存在无效符号，请在 google 上搜索。

# sql - 如何抑制从 SQL Server 中的另一个存储过程调用的存储过程的 SELECT 输出？

> ID：866484
> 
> 赞同：65
> 
> 时间：2009-05-15T00:08:07.157
> 
> 标签：sql, sql-server, tsql

我不是在谈论做“SET NOCOUNT OFF”。但是我有一个存储过程，我用它来将一些数据插入到一些表中。此过程创建一个 xml 响应字符串，让我举个例子：

```
CREATE PROCEDURE [dbo].[insertSomeData] (@myParam int) AS
DECLARE @reply varchar(2048)

... Do a bunch of inserts/updates...

SET @reply = '<xml><big /><outputs /></xml>'
SELECT @reply
GO 
```

所以我整理了一个多次使用这个SP的脚本，xml“输出”变得太多了（它已经让我的盒子崩溃了）。

有没有办法抑制或重定向从此存储过程生成的输出？我不认为修改这个存储过程是一种选择。

谢谢。

* * *

我想我应该澄清一下。上面的这个 SP 由我编写的 T-SQL 更新脚本调用，通过企业工作室管理器等运行。

它也不是我写过的最优雅的 SQL（一些伪 sql）：

```
WHILE unprocessedRecordsLeft
  BEGIN
    SELECT top 1 record from updateTable where Processed = 0
    EXEC insertSomeData @param = record_From_UpdateTable
  END 
```

因此，假设 UpdateTable 中有大约 50k 条记录。该 SP 被调用 50k 次，将 50k xml 字符串写入输出窗口。它并没有让 sql server 停止，只是我的客户端应用程序（sql server management studio）。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2014-08-15T00:02:06.160

您正在寻找的答案可以在Josh Burke的[类似 SO 问题中找到：](https://stackoverflow.com/a/571684/550975)

```
-- Assume this table matches the output of your procedure
DECLARE @tmpNewValue TABLE ([Id] int, [Name] varchar(50))

INSERT INTO @tmpNewValue 
  EXEC [ProcedureB]

-- SELECT [Id], [Name] FROM @tmpNewValue 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-05-15T16:01:07.817

我想我找到*了*解决办法。

所以我现在可以在我的 SQL 脚本中做的是这样的（sql-psuedo 代码）：

```
create table #tmp(xmlReply varchar(2048))
while not_done
  begin
    select top 1 record from updateTable where processed = 0
    insert into #tmp exec insertSomeData @param=record
  end
drop table #tmp 
```

现在，如果有更有效的方法来做到这一点。SQL Server 是否有类似于 /dev/null 的内容？一个空表还是什么？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-04-15T14:12:43.063

回答问题“如何抑制存储过程输出？” 真的取决于你想要完成什么。所以我想贡献我遇到的东西：

我需要抑制存储过程 (USP) 输出，因为我只想要输出中的行数 (@@ROWCOUNT)。我所做的，这可能不适用于每个人，因为我的查询已经是动态 sql，所以我在相关的 USP 中添加了一个名为 @silentExecution 的参数。这是我默认为零 (0) 的位参数。

接下来，如果 @silentExecution 设置为一 (1)，我会将表内容插入到临时表中，这会抑制输出，然后毫无问题地执行 @@ROWCOUNT。

美国药典示例：

```
CREATE PROCEDURE usp_SilentExecutionProc
    @silentExecution bit = 0
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @strSQL VARCHAR(MAX);

    SET @strSQL = '';

    SET @strSQL = 'SELECT TOP 10 * ';

    IF @silentExecution = 1
         SET @strSQL = @strSQL + 'INTO #tmpDevNull ';

    SET @strSQL = @strSQL +     
    'FROM dbo.SomeTable ';

    EXEC(@strSQL);
END
GO
```

然后你可以像这样执行整个事情：

```
EXEC dbo.usp_SilentExecutionProc @silentExecution = 1;
SELECT @@ROWCOUNT; 
```

这样做的目的是如果您需要 USP 能够在其他用途​​或案例中返回结果集，但仍仅将其用于行。

只是想分享我的解决方案。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-01-09T06:15:57.987

我最近在编写迁移脚本时遇到了类似的问题，由于问题以不同的方式解决，我想记录一下。通过运行一个简单的 while 循环 3000 次并调用一个过程，我几乎杀死了我的 SSMS 客户端。

```
DECLARE @counter INT
SET @counter = 10
WHILE @counter > 0 
BEGIN 
    -- call a procedure which returns some resultset
    SELECT  @counter-- (simulating the effect of stored proc returning some resultset)
    SET @counter = @counter - 1
END 
```

脚本结果是使用 SSMS 执行的，查询窗口上的默认选项设置为显示“结果到网格”[Ctrl+d 快捷方式]。

**简单的解决方案：** 尝试将结果设置为文件以避免在 SSMS 客户端上构建和绘制网格。[CTRL+SHIFT+F 将查询结果设置为文件的快捷键]。

此问题与：[stackoverflow 查询有关](https://stackoverflow.com/questions/4659019/out-of-memory-exception-in-sql-2008)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-15T01:45:16.393

伙计，这真的是一个计算机做你告诉它做的事情，而不是你*想让*它做的事情。

如果您不希望它返回结果，则不要*要求*它返回结果。将该存储过程重构为两个：

```
CREATE PROCEDURE [dbo].[insertSomeData] (@myParam int) AS
BEGIN
DECLARE @reply varchar(2048)

--... Do a bunch of inserts/updates...

EXEC SelectOutput
END
GO

CREATE PROCEDURE SelectOutput AS
BEGIN
SET @reply = '<xml><big /><outputs /></xml>'
SELECT @reply
END 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-15T07:48:10.123

您从哪个客户端调用存储过程？假设它来自 C#，你可以这样称呼它：

```
var com = myConnection.CreateCommand();
com.CommandText = "exec insertSomeData 1";
var read = com.ExecuteReader(); 
```

这还不会从服务器检索结果；您必须为此调用 Read() ：

```
read.Read();
var myBigString = read[0].ToString(); 
```

因此，如果您不调用 Read，XML 将不会离开 Sql Server。您甚至可以使用 ExecuteNonQuery 调用该过程：

```
var com = myConnection.CreateCommand();
com.CommandText = "exec insertSomeData 1";
com.ExecuteNonQuery(); 
```

在这里，客户甚至不会询问选择的结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T00:52:52.757

您可以创建一个执行此操作的 SQL CLR 存储过程。应该很容易。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T00:27:35.190

我不知道 SQL Server 是否有抑制输出的选项（我认为没有），但 SQL 查询分析器有一个“放弃结果”选项（在结果选项卡下）。

你是通过 isql 运行的吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T01:40:42.317

你说你的服务器崩溃了。是什么导致使用此 SQL 或 SQL Server 本身（假设 SQL Server）输出的应用程序崩溃。

如果您使用 .Net Framework 应用程序调用存储过程，请查看 SQLCommand.ExecuteNonQuery。这只是执行存储过程，不返回任何结果。如果问题出在 SQL Server 级别，那么您将不得不做一些不同的事情（即更改存储过程）。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-11-27T10:50:41.973

曾经尝试过`SET NOCOUNT ON;`作为一种选择吗？

# delphi - Vista 上的 BDE 初始化失败（错误 $2501）

> ID：866485
> 
> 赞同：8
> 
> 时间：2009-05-15T00:10:00.897
> 
> 标签：delphi, windows-vista, bde

我有一个用 Delphi 2007 编写的小型数据快照服务器，可以访问 BDE。它在 Windows 2000 和 XP 上运行良好，但在 Vista 上时不时地（实际上相当频繁地）我收到错误消息：

> 尝试初始化 Borland 数据库引擎时出错（错误 $2501）

关闭使用 BDE 的所有内容可修复错误（尽管有时您需要“结束处理”datasnap 服务器以关闭它）。

随着越来越多的客户为他们的“服务器”运行 Vista，这变得相当烦人。有没有人有什么建议？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T00:54:58.290

您没有提到您是否尝试过调整虚拟内存设置。BDE 错误 2501 是“虚拟内存不足”错误。一些可能有帮助的文章：

*   [BDE Sharedmem 修复](http://www.mail-archive.com/delphi@delphi.org.nz/msg00157.html)（旧）
*   [特定内存遍历要检查/修复的事情](http://www.shiprush.com/product_documentation/omnirush/BDE_Discussion.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-06-03T18:57:03.910

Andy 到 www.torry.net 的答案链接是大约 30 美元的软件包，该软件包“声称”可以修复 BDE 错误。我会对此发表评论，但我没有声誉积分。（...但其他人可以...）该链接不起作用，但如果您搜索“BDE 设置”，您可能会找到它。我找不到任何证据或评论表明它有效。下载未签名的 exe 需要您自担风险...（我会通过）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-12-19T10:47:57.027

**错误的解决方法是增加 BDE 可用的共享内存。**

[![在此处输入图像描述](https://i.stack.imgur.com/QWOw5.jpg)](https://i.stack.imgur.com/QWOw5.jpg)

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2014-02-19T10:22:57.653

我已经为 x64 系统上的每台 PC 找到了完整的解决方案。

BDE 设置 x64 v.3.15

[http://www.torry.net/news.php?id=262](http://www.torry.net/news.php?id=262)

# c# - 如何在运行时检索已加载程序集的信息？(c#, .NET)

> ID：866487
> 
> 赞同：1
> 
> 时间：2009-05-15T00:10:28.727
> 
> 标签：c#, .net, assemblies

在 .NET c# 3.5 中，我有一个控制台应用程序 (A)，它引用了几个程序集（X、Y、Z）。

如何在运行时获取已加载程序集的版本信息？

我可以像这样使用反射来获取当前正在执行的程序集的信息

```
System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString() 
```

但不是加载的程序集。谢谢你的帮助！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T00:14:09.403

您可以从[AppDomain](http://msdn.microsoft.com/en-us/library/system.appdomain.getassemblies.aspx) ...

```
var la = AppDomain.CurrentDomain.GetAssemblies(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T05:33:58.357

JP 的答案将为您提供 AppDomain 中的所有程序集。如果您只想要当前程序集直接引用的程序集，则可以使用：

```
var names = Assembly.GetExecutingAssembly().GetReferencedAssemblies(); 
```

这将为您提供名称，包括版本信息。

# streaming - 在网站上流式传输音频的最佳方式是什么

> ID：866488
> 
> 赞同：1
> 
> 时间：2009-05-15T00:10:31.970
> 
> 标签：streaming, stream

我正在更新一个广播电台的网站，他们希望能够在该网站上播放以前播放的体育比赛。大多数游戏时长为 2 - 3 小时，因此文件非常大。提供这些游戏以便用户无需下载文件即可收听它们的最佳方式是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T00:15:36.653

我相信使用 flash 会是最好的，你不必依赖任何特殊的客户端软件，你可以为它构建一个 flash 小程序，

我相信他们的 Flash 播放器从他们的服务器读取并缓冲文件

这里的网站使用 Flash [Deadworkers.com流式传输播客](http://deadworkers.com/network/?cat=7)

# asp.net-mvc - 我可以在 ASP.NET MVC 中使用 [CompressFilter] 而不破坏甜甜圈缓存吗

> ID：866489
> 
> 赞同：12
> 
> 时间：2009-05-15T00:10:58.053
> 
> 标签：asp.net-mvc, caching, donut-caching

我正在尝试让 [ [CompressFilter](http://www.thegrubbsian.com/?p=202) ] 使用甜甜圈缓存并遇到问题。

发生的事情是整个页面被缓存，而不仅仅是甜甜圈。`CompressFilter`我正在使用的来源如下。我将其从[原始源](http://www.thegrubbsian.com/?p=202)更改为使用`OnResultExecuted`，而不是`OnActionExecuting()`因为我需要访问结果的类型以避免缓存某些 ActionResult 子类。

查看实际的 MVC v1 源代码，`OutputCacheAttribute`它看起来也正在使用`OnResultExecuted()`，但我不认为这个事实直接导致了冲突。

我对替换缓存的工作原理知之甚少，无法完全理解它为什么会这样。我认为值得注意的是，这最终不会导致任何损坏的显示。它的行为就像没有甜甜圈一样！

看起来我将不得不使用某种 IIs“插件”来处理缓存，我真的很想避免这样做，但看起来我也需要甜甜圈缓存。

我现在实际上更感兴趣的是知道它为什么会产生这种效果，但如果可能的话，一个解决方案也会很棒。

```
public class CompressFilter : ActionFilterAttribute
{
    public override void OnResultExecuted(ResultExecutedContext filterContext)
    {
        HttpRequestBase request = filterContext.HttpContext.Request;

        // dont encode images!
        if (filterContext.Result is ImageResult)
        {
            return;
        }

        string acceptEncoding = request.Headers["Accept-Encoding"];

        if (string.IsNullOrEmpty(acceptEncoding)) return;

        acceptEncoding = acceptEncoding.ToUpperInvariant();

        HttpResponseBase response = filterContext.HttpContext.Response;

        if (acceptEncoding.Contains("GZIP"))
        {
            response.AppendHeader("Content-encoding", "gzip");
            response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);
        }
        else if (acceptEncoding.Contains("DEFLATE"))
        {
            response.AppendHeader("Content-encoding", "deflate");
            response.Filter = new DeflateStream(response.Filter, CompressionMode.Compress);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-10-13T16:27:25.590

这是 CompressFilter 类的错误实现。

请阅读：[Finding Preferred Accept Encoding in C#](http://www.singular.co.nz/blog/archive/2008/07/06/finding-preferred-accept-encoding-header-in-csharp.aspx)

我已经编写了我自己的，它将根据上面的文章遵守 AcceptEncoding::

```
public class CompressFilter : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        HttpRequestBase request = filterContext.HttpContext.Request;

        string[] supported = new string[] { "gzip", "deflate" };

        IEnumerable<string> preferredOrder = new AcceptList(request.Headers["Accept-Encoding"], supported);

        string preferred = preferredOrder.FirstOrDefault();

        HttpResponseBase response = filterContext.HttpContext.Response;

        switch (preferred)
        {
            case "gzip":
                response.AppendHeader("Content-Encoding", "gzip");
                response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);
                break;

            case "deflate":
                response.AppendHeader("Content-Encoding", "deflate");
                response.Filter = new DeflateStream(response.Filter, CompressionMode.Compress);
                break;

            case "identity":
            default:
                break;
        }
    }
}

public class AcceptList : IEnumerable<string>
{
    Regex parser = new Regex(@"(?<name>[^;,\r\n]+)(?:;q=(?<value>[\d.]+))?", RegexOptions.Compiled);

    IEnumerable<string> encodings;

    public AcceptList(string acceptHeaderValue, IEnumerable<string> supportedEncodings)
    {
        List<KeyValuePair<string, float>> accepts = new List<KeyValuePair<string, float>>();

        if (!string.IsNullOrEmpty(acceptHeaderValue))
        {
            MatchCollection matches = parser.Matches(acceptHeaderValue);

            var values = from Match v in matches
                         where v.Success
                         select new
                         {
                             Name = v.Groups["name"].Value,
                             Value = v.Groups["value"].Value
                         };

            foreach (var value in values)
            {
                if (value.Name == "*")
                {
                    foreach (string encoding in supportedEncodings)
                    {
                        if (!accepts.Where(a => a.Key.ToUpperInvariant() == encoding.ToUpperInvariant()).Any())
                        {
                            accepts.Add(new KeyValuePair<string, float>(encoding, 1.0f));
                        }
                    }

                    continue;
                }

                float desired = 1.0f;
                if (!string.IsNullOrEmpty(value.Value))
                {
                    float.TryParse(value.Value, out desired);
                }

                if (desired == 0.0f)
                {
                    continue;
                }

                accepts.Add(new KeyValuePair<string, float>(value.Name, desired));
            }
        }

        this.encodings = from a in accepts
                         where supportedEncodings.Where(se => se.ToUpperInvariant() == a.Key.ToUpperInvariant()).Any() || a.Key.ToUpperInvariant() == "IDENTITY"
                         orderby a.Value descending
                         select a.Key;
    }

    IEnumerator<string> IEnumerable<string>.GetEnumerator()
    {
        return this.encodings.GetEnumerator();
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return ((IEnumerable)this.encodings).GetEnumerator();
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-12T19:58:22.943

我重写了 OnResultExecuting 方法。这是在呈现 ActionResult 之前调用的。在检查客户端是否接受压缩之前，我会检查我尝试呈现的 Result 的类型。如果它不是 ViewResult，我不会应用任何形式的压缩。

为此，您的操作必须显式调用 View() 或 PartialView()。

这是 CompressOutputAttrtibute 的样子：

```
public class CompressOutputAttribute : ActionFilterAttribute
{
    public override void OnResultExecuting(ResultExecutingContext filterContext) 
    {
        var result = filterContext.Result;
        if (!(result is ViewResult))
            return;

        HttpRequestBase request = filterContext.HttpContext.Request;
        string acceptEncoding = request.Headers["Accept-Encoding"];
        if (string.IsNullOrEmpty(acceptEncoding))
            return;

        acceptEncoding = acceptEncoding.ToUpperInvariant();

        HttpResponseBase response = filterContext.HttpContext.Response;
        if (acceptEncoding.Contains("GZIP"))
        {        
            // we want to use gzip 1st
            response.AppendHeader("Content-encoding", "gzip");
            //Add DeflateStream to the pipeline in order to compress response on the fly 
            response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);
        }
        else if (acceptEncoding.Contains("DEFLATE"))
        {
            //If client accepts deflate, we'll always return compressed content 
            response.AppendHeader("Content-encoding", "deflate");
            //Add DeflateStream to the pipeline in order to compress response on the fly 
            response.Filter = new DeflateStream(response.Filter, CompressionMode.Compress);
        }
    }
} 
```

控制器内部：

```
[CompressOutput]
public class ArticleController : Controller

    public PartialViewResult MostPopular()
    {
        var viewModel = ArticleMostPopularViewModel();
        viewModel.Articles = CmsService.GetMostPopularArticles();
        return PartialView(viewModel);
    }

    public ViewResult Show(int id)
    {
        var viewModel = ArticleShowViewModel();
        viewModel.Article = CmsService.GetArticle(id);
        return View(viewModel);
    }
} 
```

# iphone - 创建一个新的 UIWebView 是多么昂贵

> ID：866497
> 
> 赞同：2
> 
> 时间：2009-05-15T00:13:08.500
> 
> 标签：iphone, uiwebview

有人告诉我，创建和保留 UIWebView 大且昂贵（内存和计算）。这是真的？它们有多贵？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T01:14:25.093

这取决于您在其中加载的内容。

Instruments 应用程序的[内存和 CPU 监视器](http://blog.zincroe.com/2009/04/how-to-check-iphone-texture-memory-usage-with-instruments/)将让您测试并找出答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-14T20:46:20.860

就个人而言，我在我的应用程序中使用了一个 UIWebView（使用单例模式），并在每次显示时更改其内容。

我认为这会占用大量内存，但与分配一些 UIImages 相比，它真的没什么（据 Instruments 告诉我）。

# asp.net - 在共享主机中部署 Asp.net Web 应用程序时的安全异常以及需要考虑的事项

> ID：866515
> 
> 赞同：1
> 
> 时间：2009-05-15T00:20:48.967
> 
> 标签：asp.net, .net-2.0, iis-6, shared-hosting

我希望在共享主机中部署一个 ASP.net Web 应用程序。

我收到安全异常，

> System.Security.SecurityException：请求“System.Security.Permissions.FileIOPermission，mscorlib，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089”类型的权限失败。

计划在共享主机中部署时可以注意的任何修复帮助和任何其他常见问题将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T00:32:08.347

许多托管服务提供商会提供一个控制面板，您可以使用它修改读/写权限。试一试。

其他常见问题：

1.  大多数只允许您的应用在[Medium Trust](http://msdn.microsoft.com/en-us/library/ms998341.aspx)中运行。这可能是您的安全问题的原因。
2.  没有远程 TCP 访问（出于安全原因）您的数据库（意味着您必须在 .NET 应用程序中编写脚本或“安装”例程来创建表、关系、约束等）
3.  大多数情况下，您的应用程序与其他共享应用程序一起放入应用程序池中，因此当这些应用程序爆炸时，您的应用程序会成为附带损害。确保您请求将您的应用程序放置在其自己的应用程序池中，以使其与其他应用程序的故障隔离。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:31:27.490

这是一篇关于在 ASP.NET 应用程序中处理较低信任度的[好文章。](http://msdn.microsoft.com/en-us/library/ms998341.aspx)

# php - 变换数组

> ID：866522
> 
> 赞同：0
> 
> 时间：2009-05-15T00:22:10.477
> 
> 标签：php, arrays

我如何得到这个数组：

```
Array
(
    [0] => Array
        (
            [max] => 5
            [year] => 2007
        )

    [1] => Array
        (
            [max] => 6.05
            [year] => 2008
        )

    [2] => Array
        (
            [max] => 7
            [year] => 2009
        )

) 
```

变成这种格式：

```
[year] => [max] 
```

（为我的无知感到羞耻……那些日子之一）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T00:27:12.960

```
$result = array();
foreach($array as $v) {
    $result[$v['year']] = $v['max'];
} 
```

你去吧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:25:15.210

您需要遍历当前数组并将数据放入新数组中。

```
$result = array();
foreach($currenArray as $x) 
{
    $result[$x['year']] = $x['max'];
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T00:26:21.870

简单的方法？

```
$dest = array();
foreach ($src as $k => $v) {
  $dest[$v['year']] = $v['max'];
} 
```

# ruby-on-rails - 如何使用新树最好地从根元素向下复制/克隆整个嵌套集

> ID：866528
> 
> 赞同：1
> 
> 时间：2009-05-15T00:25:47.923
> 
> 标签：ruby-on-rails, ruby, nested-sets

我在我的 Rails 应用程序中使用“acts_as_nested_set”。（扩展了很棒的嵌套集插件）。我试图找出最好的方法来编写一个函数/方法来克隆一个元素及其整个嵌套集，以便每个元素都得到一个克隆，但关系结构模仿原始元素，只是使用新元素。

使用嵌套集，您可以获得`parent_id, lft, and rgt`位置列...而不仅仅是`position_id`.

我应该从每组的底部（没有孩子的节点）开始，然后通过父母一直克隆到新的根吗？

这似乎是已经完成的事情，或者已经有一种方法可以为嵌套集执行此操作，但我找不到任何可以指导我的东西。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-29T19:07:59.877

我用acts-as-tree做了这样的事情。我迭代了集合集并克隆了每个项目。我将源项目和克隆项目保存在哈希中，其中源是键，克隆是目标。然后我使用散列和父引用来解析和重新映射关系。

这是一个有助于传达要点的片段。

clone 方法只是简单地实例化一个没有 id 的新副本。descendants 方法返回一个完整的后代列表，而不仅仅是直接的后代。

```
def clone_branch()
  h = {self => self.clone} #we start at the root

  ordered = self.descendants #preserved order with acts_as_sortable

  #clone subitems
  ordered.each do |item|
    h[item] = item.clone
  end

  #resolve relations
  ordered.each do |item|
    cloned = h[item]
    item_parent = h[item.parent]
    item_parent.children << cloned if item_parent
  end

  h[self]
end 
```

# iphone - 在 iphone 的键盘顶部添加一个文本框和一个按钮

> ID：866532
> 
> 赞同：2
> 
> 时间：2009-05-15T00:28:20.477
> 
> 标签：iphone, iphone-softkeyboard

我想在它旁边添加一个文本框和一个按钮。它们将位于窗口的底部。然后，当我触摸文本框（输入内容）时，键盘将出现，整行（带有文本框和按钮）向上滚动，键盘将位于它们的正下方。你能告诉我我该怎么做吗？

有没有示例程序？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T08:06:15.743

马特加拉格尔在他的博客上发布了这个：

[滑动 UITextFields 以避开键盘](http://cocoawithlove.com/2008/10/sliding-uitextfields-around-to-avoid.html)

这是您想要的逐步示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T01:36:26.070

在 XCode 文档**iPhone 应用程序编程指南**中有一个关于“移动位于键盘下方的内容”的部分，其中讨论了在键盘即将显示时接收键盘通知。那里有代码向您展示如何获取键盘大小（取决于方向）。我不会在这里重复。

您可以使用相同的技术来获取`UIKeyboardWillShowNotification`通知并获取键盘最终位置的高度。这为您提供了视图需要去的地方的底部边缘，有效地将其放在键盘上方。因此，只需将您的文本框和按钮放在视图中即可。当你收到通知时，告诉你的视图它需要去哪里（键盘高度+容器视图的高度），你就完成了。您还需要捕捉`UIKeyboardWillHideNotification`以将视图移回原来的位置，因此请跟踪原始容器视图位置。

它非常简单，而且看起来不错，尤其是如果您使用漂亮的 UIView 动画效果并将时间设置得恰到好处。

# sql-server-2008 - 为什么我无法安装 SQL Server SP1 (KB968369)？

> ID：866534
> 
> 赞同：1
> 
> 时间：2009-05-15T00:28:44.173
> 
> 标签：sql-server-2008, installation, windows-server-2008

我有一台 Windows Server 2008 x64 机器。我有“Microsoft SQL Server 2008 Service Pack 1 (KB968368)”作为 Windows Update 提供的“可选”更新。我选择安装它，我的电脑安装了一段时间，我重新启动，并且该更新再次可用。为什么我的电脑没有安装？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T00:34:14.067

不确定，但我遇到了同样的问题。您是否曾经在 SQL Server 2008 安装程序中进行过“版本升级”？许多进行此类升级的用户都报告了更新包的问题。对我来说，它不是一个关键任务系统，所以我只是卸载了整个 shebang，然后重新安装。

[Microsoft Connect](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=431591)的其他解决方法。当它与 Visual Studio 安装在同一台机器上时，这些人会遇到问题。

FWIW，我发现 SQL Server 2008 的整个安装体验非常糟糕。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T00:30:43.780

我想我以前也遇到过同样的问题。我四处搜索，发现这是一个已知问题我的解决方案是检查“不通知此更新”之类的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-19T19:52:48.853

您的事件日志中有任何错误吗？

我发现我无法使用 windows update 安装它，我必须手动下载它并第一次安装它。我对 SQL 2005 sp2 也有这个问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-19T20:36:00.263

我解决了。我删除了注册表中的 PendingFileRenameOperation 键（首先备份了该注册表分支），运行安装，重新启动，它现在在我的已安装更新列表中。

# regex - 正则表达式：匹配 x 次或 y 次

> ID：866538
> 
> 赞同：30
> 
> 时间：2009-05-15T00:29:46.620
> 
> 标签：regex

假设我需要匹配一个模式，如果它连续出现 3 或 6 次。我能得到的最接近的是 \d{3,6} ，但这并不能完全满足我的需要。

'123' 应该匹配
'123456' 应该匹配
'1234' 不应该匹配

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-15T00:33:24.707

```
^(\d{3}|\d{6})$ 
```

你必须有某种终结符，否则`\d{3}`会匹配 1234。这就是我把 ^ 和 $ 放在上面的原因。一种替代方法是使用环视：

```
(?<!\d)(\d{3}|\d{6})(?!\d) 
```

确保它的前面或后面没有数字（在这种情况下）。[前瞻和后瞻零宽度断言](http://www.regular-expressions.info/lookaround.html)中的更多内容。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-15T00:34:11.040

怎么样：

```
(\d\d\d){1,2} 
```

尽管您还需要取决于您的 RE 引擎的两端的防护装置，例如：

```
[^\d](\d\d\d){1,2}[^\d] 
```

或者：

```
^(\d\d\d){1,2}$ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-07-08T06:02:33.107

对于这种情况，我们可以摆脱这种狡猾的方法：

## 清洁实施

```
/(\d{3}){1,2}/
/(?:\d{3}){1,2}/ 
```

### 如何？！

这是有效的，因为我们正在寻找在这种情况下连续的三的倍数。

**注意**：没有理由在这种情况下捕获组，因此我将`?:`非捕获组标志添加到捕获组。

这与`paxdiablo`实现类似，但更简洁。

## 匹配十六进制

我正在做类似的事情来匹配基本的十六进制颜色，因为它们的长度可能是 3 或 6。这让我可以保持我的十六进制颜色检查器的匹配干燥，即：

```
/^0x(?:[\da-f]{3}){1,2}$/i 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T00:36:15.887

第一个匹配 3, 6 但也匹配 9, 12, 15, .... 第二个看起来不错。这里还有一个转折：

```
\d{3}\d{3}? 
```

# crystal-reports - Crystal Reports 文本截断了详细信息部分的最后一行

> ID：866540
> 
> 赞同：2
> 
> 时间：2009-05-15T00:30:11.440
> 
> 标签：crystal-reports

我有一个 Crystal Report 11 文件，它是一封信。第一个详细信息部分包含一个大文本框，其中包含打印日期、地址块和称呼行。每隔一段时间，文本框的最后一行就会被剪掉，这样称呼就不会被看到。这是非常不一致的，有时，我在我的系统中为一个人运行报告并且文本被截断，但是如果我在几个小时后为同一个人运行报告，而没有更改地址或姓名的值我的数据库，然后这封信看起来不错。

我增加了文本框高度和详细信息部分高度，但问题仍然间歇性出现。这种情况发生在其他人身上吗，或者有人知道是什么原因造成的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-06T10:28:19.783

通常，如果您在“格式字段/文本”设置的公共选项卡中选中“可以增长”选项，这应该可以工作。选中该选项后，您设置的高度无关紧要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-01-11T18:37:20.967

这是一个难题，您必须从 3 个不同的方面进行攻击：

1.  软件热修复
2.  默认打印机
3.  表单创作

**软件热修复：** 您需要下载包含热修复 20 的 CRRuntime。此热修复解决了制作 PDF 时的截断问题。您可以在[http://downloads.businessobjects.com/akdlm/crnetruntime/clickonce/CRRuntime_64bit_13_0_20.msi找到它](http://downloads.businessobjects.com/akdlm/crnetruntime/clickonce/CRRuntime_64bit_13_0_20.msi)

**默认打印机：** 创建报表时使用的打印机必须与呈现报表时的打印机匹配。在我们的服务器上，除了 Microsoft XPS Document Writer 之外，没有安装任何打印机。确保在编写报告时选择它作为默认打印机。

**表单创作：**将数据库字段添加到报表时，不要将其从字段资源管理器拖到设计图面上。首先在设计图面上插入一个文本对象。定位并调整大小后，将数据库字段拖到文本对象上。无论出于何种原因，当数据库字段被文本对象包围时，它会更好地换行。

# sql - 组合多个 SQL 查询

> ID：866548
> 
> 赞同：0
> 
> 时间：2009-05-15T00:32:58.530
> 
> 标签：sql, database

我想进行查询以列出比普通猫更长时间才能出售的猫？我有五张桌子：

Animal、Sale、AnimalOrderItem、AnimalOrder 和 SaleAnimal

> 动物表：AnimalID、Name、Category（猫、狗、鱼）
> 
> SaleAnimal 表：SaleID、AnimalID、SalePrice
> 
> 销售表：SaleID、日期、employeeID、CustomerID
> 
> AnimalOrderItem 表：OrderID、AnimalID、成本
> 
> AnimalOrder：OrderID、OrderDate、ReceivingDate、SupplierID、ShippingCost、EmployeeID

还有其他表我认为它们对查询没有影响。

我想到了以下...进行查询以计算所有前的销售天数：

```
[SaleDate]-[ReceiveDate] AS DaysToSell
Have the INNER JOIN built:
Sale INNER JOIN ((AnimalOrder INNER JOIN (Animal INNER JOIN AnimalOrderItem
ON Animal.AnimalID = AnimalOrderItem.AnimalID) ON AnimalOrder.
OrderID = AnimalOrderItem.OrderID) INNER JOIN SaleAnimal ON Animal.
AnimalID = SaleAnimal.AnimalID) ON Sale.SaleID = SaleAnimal.SaleID 
```

根据上述查询创建另一个查询

```
SELECT AnimalID, Name, Category, DaysToSell
WHERE Category="Cat" AND DaysToSell>
(SELECT Avg(DaysToSell)
FROM the earlier query
WHERE Category="Cat"
ORDER BY DaysToSell DESC; 
```

运行查询后，我收到错误消息

> ORA-00921: SQL 命令意外结束

有什么建议么！请

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T08:01:13.510

查询可以与子查询结合使用。例如，

```
select *
from (
    select * 
    from mytable
) subquery 
```

将此模式应用于您的问题似乎相当简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T00:35:35.077

我没有看到与 select avg 匹配的右括号

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T00:37:00.083

好的，我想出了这个：

```
 SELECT AnimalID, Name, Category,
           [SaleDate]-[ReceiveDate] AS DaysToSell
    FROM   Sale INNER JOIN ((AnimalOrder INNER JOIN (Animal INNER JOIN AnimalOrderItem ON Animal.AnimalID = AnimalOrderItem.AnimalID) ON AnimalOrder.OrderID = AnimalOrderItem.OrderID)
           INNER JOIN SaleAnimal ON Animal.AnimalID = SaleAnimal.AnimalID) ON Sale.SaleID = SaleAnimal.SaleID
    WHERE  Category = "Cat"
    AND    ([SaleDate]-[ReceiveDate]) > (SELECT AVG([SaleDate]-[ReceiveDate])
                                         FROM   Sale INNER JOIN ((AnimalOrder INNER JOIN (Animal INNER JOIN AnimalOrderItem ON Animal.AnimalID = AnimalOrderItem.AnimalID) ON AnimalOrder.OrderID = AnimalOrderItem.OrderID)
                                         INNER JOIN SaleAnimal ON Animal.AnimalID =SaleAnimal.AnimalID) ON Sale.SaleID = SaleAnimal.SaleID
                                         WHERE Category = "Cat")
    ORDER BY ([SaleDate]-[ReceiveDate]) DESC; 
```

# visual-studio - 如何阻止 Internet Explorer 创建新实例？

> ID：866559
> 
> 赞同：1
> 
> 时间：2009-05-15T00:39:42.523
> 
> 标签：visual-studio, web-services, internet-explorer

是否有一种方法可以阻止 IE 每次遇到弹出窗口时创建一个新实例？我正在同时调试两个 Silverlight 应用程序。第一个使用第二个创建新的弹出窗口。调试在 FireFox 中运行良好，因为它不会创建单独的进程。但是 IE 创建了新实例，当然 Visual Studio 并没有附加到 IE 的新实例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T01:37:29.470

哪个版本的IE？如果您使用的是 7+，您可以将弹出设置更改为“在新选项卡中打开”而不是新窗口吗？（工具 -> 选项 -> 选项卡设置）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T01:55:34.543

据我所知，当您在 IE 中打开一个新窗口时（使用 Javascript 或选择“文件 > 新窗口”），它不应该*启动*一个新进程。只有当您再次实际运行可执行文件（例如，从 Windows 资源管理器）时，才会启动一个新进程。

由于 MSIE 与 Windows 资源管理器密切相关，我想知道它是否以某种方式与 Windows 资源管理器设置之一相关联。尝试转到任何资源管理器窗口，选择工具 > 选项，选择“查看”选项卡，并确保未选中“在单独的进程中启动文件夹窗口”，可能就是这样。

另一种可能性是在 MSIE 中，工具 > 选项，选择“高级”选项卡，选中“重用 Windows 启动快捷方式”，尽管我怀疑是这样。

# html - html表格语法验证

> ID：866560
> 
> 赞同：0
> 
> 时间：2009-05-15T00:40:40.587
> 
> 标签：html, validation, html-table

这应该是一件容易的事。

我有一张这样的桌子：

```
<table>
<tr>
<td></td><td></td><td></td><td></td>
</tr>
<tr>
<td></td>
</tr>
</table> 
```

我的 firefox 3 验证器说这是可接受的代码。这对我来说似乎是错误的，是否有任何可能的问题使表格行像这样不均匀？它也适用于 IE7。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T00:43:27.790

如果您想使用不均匀数量的行/列，则~~需要~~使用[rowspan 和/或 colspan 属性](http://www.w3schools.com/tags/att_td_colspan.asp)来指示这一点。例如：

```
<table>
<tr><td></td><td></td><td></td></tr>
<tr><td colspan="3"></td></tr>
</table> 
```

正如 guffa 在下面纠正我的那样， colspan 在技术上不是必需的，但明确说明您的意图永远不会受到伤害。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T00:43:51.657

您应该使用“rowspan”或“colspan”属性

```
<table>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="3"></td>
  </tr>
</table> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T00:56:37.350

表格行不需要具有相同数量的单元格。表格中的列数由具有最多单元格的行确定。

您的第二个表格行将只有三个空白单元格（与空单元格不同）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T00:45:51.450

好吧，那里没有语法错误，我真的不明白为什么你应该对这样的表持怀疑态度，只要你使用`colspan`td-element 的属性：

```
<table>
<tr>
<td></td><td></td><td></td><td></td>
</tr>
<tr>
<td colspan="3"></td>
</tr>
</table> 
```

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T00:54:16.280

从结构的角度来看，该代码很好。它是有效的 XHTML。比较一下：

```
<orders>
   <order id='2009/1'>
     <item id='1'/><item id='2'><item id='3'/>
   </order>
   <order id='2009/2'>
     <item id='33'/>
   </order>
</orders> 
```

不过它可能看起来很奇怪，因此建议使用 colspan。这样，您可以获得单个 TD 来填充行，而不是其上方 TD 的宽度。

# ruby-on-rails - 在 Ruby/Rails 中使用 ssl_requirement 和 restful_authentication 时遇到问题

> ID：866576
> 
> 赞同：1
> 
> 时间：2009-05-15T00:48:19.180
> 
> 标签：ruby-on-rails, ssl, ruby-on-rails-plugins, restful-authentication

我正在尝试将 ssl 要求插件与 restful 身份验证插件一起使用，但我有一个问题，我无法找到答案。

当允许用户从非 SSL 操作/页面登录时，我是否应该在会话的创建操作上要求 SSL 以提高安全性，或者这是否过大？

如果是这样，我如何让创建操作从非 SSL 工作到 SSL？它抛出一个 ActionController::MethodNotAllowed 异常，说明“只允许发布和删除请求”。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-16T17:38:58.547

我在这里做同样的事情。我认为您应该设置要在会话创建中使用的 SSL 要求，因为那是您处理服务器敏感信息的时刻。

# linux - Samba 错误：“功能不正确”

> ID：866580
> 
> 赞同：1
> 
> 时间：2009-05-15T00:51:27.800
> 
> 标签：linux, windows-xp, redhat, samba

我一直在 Redhat 机器上设置 samba 共享，并且能够从本地计算机连接到它。但是，在 XP 机器上，我只能成功连接到共享的根目录（例如“\machine”）。连接到实际的共享文件夹（例如“\machine\share”）会产生错误。

完整的错误信息是：

> \machine\share 不可访问。您可能无权使用此网络资源。请联系此服务器的管理员以了解您是否具有访问权限。
> 
> 功能不正确。

查看 Windows 端的属性，我看到列出的“所有人”、“root (Unix Group\root)”和“root (Unix User\root”) 没有权限。

我正在使用共享身份验证，并且我为来宾帐户指定的用户对共享文件夹具有读/写访问权限。

有没有人遇到过类似的问题？提前感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:53:01.603

看起来 windows 机器正在缓存身份验证信息，并且随着 samba 服务器的身份验证模式的更改而没有更新它。这意味着一旦我无法连接到 samba 服务器（由于服务器端的设置错误），即使服务器设置得到纠正，连接也会继续失败。重新启动XP机器解决了这个问题。

# iphone - Iphone Object C - 数据、对象和数组

> ID：866581
> 
> 赞同：0
> 
> 时间：2009-05-15T00:51:28.080
> 
> 标签：iphone, objective-c, cocoa, arrays, object

所以我是一个 Flash 人，我正在尝试将以下代码转换为对象 C：

```
 var slot:Object = new Object();
    slot.id         = i;
    slot.xPos       = 25*i;
    slot.yPos       = 25*i;
    slot.isEmpty    = False;
// push object to array
    arrGrid.push(slot); 
```

稍后我可以像这样覆盖：

```
arrGrid[0].isEmpty = True; 
```

我似乎找不到在对象 C 中创建通用对象的参考。有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T01:16:54.557

好吧，假设您在可可中使用 iphone 或 mac 做某事，您可以简单地继承 NSObject（objective-c 中的基类）。

你需要一个 .h 和 .m 所以对于你的例子它会是这样的：（请注意，我使用 slotId 而不是 id 因为 id 是objective-c中的关键字）

插槽.h

```
// Slot.h 
@interface Slot : NSObject {
  NSInteger slotId;
  float xPos;
  float yPos;
  BOOL empty;
}

@property NSInteger slotId;
@property float xPos;
@property float yPos;
@property BOOL empty;

@end

// Slot.m
#import "Slot.h"

@implementation Slot

@synthesize slotId;
@synthesize xPos;
@synthesize yPos;
@synthesize empty;

@end 
```

这定义了一个简单的 Slot 对象，它具有 4 个属性，可以使用点符号来访问，例如：

```
s = [[Slot alloc] init];
s.empty = YES;
s.xPos = 1.0;
s.yPos = 1.0; 
```

根据您处理的数据类型，您使用的数据类型以及定义属性的方式等有很多变化。

如果您想将插槽对象添加到数组中，一个简单的示例：

```
// create an array and add a slot object
NSMutableArray *arr = [NSMutableArray array];
Slot *slot = [[Slot alloc] init];
[arr addObject:slot];

// set the slot to empty
[[arr objectAtIndex:0] setEmpty:YES]; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T02:18:44.050

如果您只使用此 Object 实例来存储命名值，则可以使用 NSMutableDictionary 的实例，尽管您需要使用 NSNumber 实例包装整数值：

```
NSMutableDictionary * obj = [NSMutableDictionary dictionary];
[obj setObject: [NSNumber numberWithInt: i] forKey: @"id"];
[obj setObject: [NSNumber numberWithInt: i*25] forKey: @"xPos"];
[obj setObject: [NSNumber numberWithInt: i*25] forKey: @"yPos"];
[obj setObject: [NSNumber numberWithBool: NO] forKey: @"isEmpty"]; 
```

然后您将这些添加到使用`[NSMutableArray array]`或类似方法分配的 NSMutableArray 中：

```
[array addObject: obj]; 
```

要从字典中获取整数/布尔值，您需要执行以下操作：

```
int i = [[obj objectForKey: @"id"] intValue];
BOOL isEmpty = [[obj objectForKey: @"isEmpty"] boolValue]; 
```

# jquery - 用户单击链接（元素）时如何取消导航？

> ID：866583
> 
> 赞同：51
> 
> 时间：2009-05-15T00:51:45.693
> 
> 标签：jquery

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-15T00:52:45.770

如果你有这样的 HTML：

```
<a href="no_javascript.html" id="mylink">Do Something</a> 
```

你会用 jQuery 做这样的事情：

```
$(document).ready(function() {
    $('#mylink').click(function() {
        doSomethingCool();
        return false; // cancel the event
    });
}); 
```

您所要做的就是使用 Javascript 取消单击事件，以防止发生默认操作。因此，当有人单击启用了 Javascript 的链接时，`doSomethingCool();`将调用该链接并取消单击事件（因此`return false;`）并阻止浏览器转到指定的页面。但是，如果他们禁用了 Javascript，则可以`no_javascript.html`直接使用。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2011-06-08T20:41:57.390

使用 Google Chrome 浏览器时，这些都不适合我。

以下是确实有效的方法（使用 jQuery）：

```
$(document).ready(function() {
    $('#mylink').click(function(event) {
        doSomethingCool();
        event.preventDefault(); // cancel the event
    });
}); 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-05-15T06:16:43.697

为什么是 jQuery？

HTML：

```
<a href="no_javascript.html" onclick="return doSmth()">Link</a> 
```

...和javascript代码：

```
function doSmth(){
  // your code here
  return false
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-01-03T21:01:45.900

我会做的是：

一种。对于 href 属性，`javascript:void();`将被设置

湾。对于 onclick 事件，将提供一个处理 click 事件的函数，该函数将返回 false。

例如：

```
<script type="text/javascript">
   function myfunction()
   {
      //do something
      return false;
   }
   </script>

   <a href="javascript:void();" onclick="myfunction()">Link</a> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-12-21T00:57:26.850

```
<a href="http://www.google.com" class="ignore-click">Test</a> 
```

**使用 jQuery：**

```
<script>
    $(".ignore-click").click(function(){
        return false;
    })
</script> 
```

**使用 JavaScript**

```
<script>
        for (var i = 0; i < document.getElementsByClassName("ignore-click").length; i++) {
            document.getElementsByClassName("ignore-click")[i].addEventListener('click', function (event) {
                event.preventDefault();
                return false;
            });
        }
</script> 
```

您将类分配给`.ignore-click`您喜欢的尽可能多的元素，并且单击这些元素将被忽略

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-12-29T03:15:10.773

至少对于 IE，只需放在`this.event.returnValue = false;`方法的末尾即可。

例如：

```
function onClickFunction()
 {
  someMethod();
  this.event.returnValue = false;
 } 
```

我有一个复杂的方法来解决这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-22T19:29:23.960

我使用`document.location.replace`导航，但是当我想取消导航时，`return false`（在与 相同的功能中`document.location.replace`）不会取消导航。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-02-10T10:24:41.127

最好的方法应该是这样。

```
<a href="javascript:undefined"></a> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-07-06T17:01:37.773

我刚用

```
<a href="https://ryanhigdon.com" onClick={ event => {
  event.preventDefault()
}}>Take me away</a> 
```

在我的用例中，我想在导航之前执行一些操作。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2016-10-14T08:24:31.563

很简单，使用 rel="nofollow" 属性

```
 <a href="signin.php" rel="nofollow">sign in</a> 
```

# java - 如何过滤 OSGi 服务可见性？

> ID：866584
> 
> 赞同：3
> 
> 时间：2009-05-15T00:51:48.703
> 
> 标签：java, configuration, osgi, whiteboard

OSGi 采用面向服务的体系结构：捆绑注册服务对象，其他捆绑使用。服务发布和绑定由框架管理。这将服务提供者与服务用户完全分离（除了需要就服务接口达成一致）。

有没有办法限制（通过配置）哪些服务对哪些捆绑可见？

例如，如果我有一个 HttpService，那么所有想要这样做的包都可以将 servlet 安装到其中。我想让选择性捆绑包看不到 HttpService 。

额外积分：除了过滤服务注册之外，还可以修改注册属性。因此，即使捆绑包注册了 Servlet `alias=/admin`，我也可以将其更改为`alias=/somethingelse`供 Pax Web Extender Whiteboard 使用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-07T19:42:38.480

即将发布的 OSGi 规范 R4.2 定义了一个名为 Find Hook 的组件，该组件允许：
“检查返回的服务引用集并可选择缩小返回的服务集”

请参阅
[http://www.osgi.org/download/r4-v4.2-core-draft-20090310.pdf](http://www.osgi.org/download/r4-v4.2-core-draft-20090310.pdf)第 12.5 节

请注意，R4.2 还不是最终版本，但我仍然相信主要的 OSGi 实现（Felix 和 Equinox）已经在其主干中包含了此附加功能的代码

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T16:27:59.500

> 有没有办法限制（通过配置）哪些服务对哪些捆绑可见？

如您所知，可以过滤服务属性，尽管这可能无法提供您所要求的那种控制：服务对框架中部署的其他包仍然可见。

在 SpringSource 的 dm 服务器（一个开源、模块化、基于 OSGi 的 Java 应用程序服务器）中，应用程序可以在部署时进行*Scoped 。*这允许您部署多个应用程序（在单独的范围内），这些应用程序可能包括不一致版本的依赖包，同时仍然允许共享公共包（通过将它们部署在范围之外 - 在所谓的全局范围内）。

如果一个范围内的应用程序/捆绑包注册了一个 OSGi 服务，则它仅对同一范围内的捆绑包可用。（服务也是“范围”的。）

这并不神奇：服务器封装了 OSGi 服务接口并使用“幕后”的服务属性来执行即时所需的过滤。

我认为这会给你你正在寻找的那种分离。

有关 dm Server 的信息（不要与 Spring DM 混淆），请访问[SpringSource.org dmServer 页面](http://www.springsource.org/dmserver "dm 服务器")。

史蒂夫鲍威尔
*SpringSource；dm 服务器开发*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T13:25:38.393

我没有尝试过，但似乎它可以帮助你......

在 OSGi R4 组件规范中描述了“配置管理服务”，从 5 分钟的检查来看，它似乎能够动态地改变服务。

最终，我认为这将取决于您根据一些商定的配置值来控制对服务的访问

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T13:14:07.330

> 有没有办法限制（通过配置）哪些服务对哪些捆绑可见？

使用服务属性无法做到这一点。您可以定义自己的服务属性，指定哪些包**应该**使用您正在导出的服务，但是没有办法阻止其他包也使用它。

> 额外积分：除了过滤服务注册之外，还可以>修改注册属性。因此，即使捆绑包使用 >alias=/admin 注册了一个 Servlet，我也可以将其更改为 alias=/somethingelse 以供 Pax Web >Extender Whiteboard 使用。

嗯......这是一个艰难的。您可以定义自己的 Servlet 接口“MyServlet”并使用该接口导出您的 Servlet。然后，另一个包可以使用这些 MyServlet 并将它们重新导出为具有修改的服务属性的 Servlet。

除此之外……不知道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-07T15:05:34.283

> For extra credits: In addition to just filtering service registrations, the ability to modify registration properties. So that even if a bundle registers a Servlet with alias=/admin, I can change that to alias=/somethingelse for consumption by Pax Web Extender Whiteboard.

using [iPOJO](http://felix.apache.org/site/apache-felix-ipojo.html) you can change properties of the exposed services pretty simple. It has bunch of other features, which could be interessting to someone using OSGi a lot.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-11T22:45:20.317

如果您想限制服务的可见性，最好的办法是启用 OSGi 安全性。它旨在限制哪些服务、包和其他东西对哪些捆绑包可见。例如，您可以只为您签名的捆绑包提供特定服务（或使用各种其他标准）。

另一个选项，已经提到过，它使用 4.2 服务挂钩，它允许一种“自己动手”的安全机制。

第二个问题，更改属性（例如注册服务的端点），您可以通过注册服务时返回的 ServiceRegistration 来执行此操作。可以通过成为 ManagedService 来触发更改，并使用 ConfigurationAdmin 自行配置。

# php - 数组合并/替换

> ID：866589
> 
> 赞同：7
> 
> 时间：2009-05-15T00:53:32.087
> 
> 标签：php, arrays

我有两个数组：

```
Array
(
    [2005] => 0
    [2006] => 0
    [2007] => 0
    [2008] => 0
    [2009] => 0
)

Array
(
    [2007] => 5
    [2008] => 6.05
    [2009] => 7
) 
```

我想合并这两个数组，如果第二个数组中存在一个值，它会覆盖第一个数组的值。所以结果数组将是：

```
Array
(
    [2005] => 0
    [2006] => 0
    [2007] => 5
    [2008] => 6.05
    [2009] => 7
) 
```

谢谢你的帮助。

更新：这是我最好的尝试，但非常不成功：

```
 $final = '';
    foreach ($years as $k => $v){
        if (in_array($k,$values)){
            $final .= $values[$k] . '|';
        }else{
            $final .= $k[$v] . '|';
        }

    }

    echo "final = $final"; 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-05-15T01:04:30.827

正如我最近了解到的那样，PHP 有一个[数组联合运算符](http://php.net/manual/en/language.operators.array.php)可以做到这一点：

```
$result = $a + $b; 
```

其中 $a 是具有您想要优先的值的数组。（所以在你的例子中，这意味着第二个数组是“ `$a`”。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-04-05T02:55:51.363

就这么简单：

`$new_array = array_replace(array_1,array_2)`;

[php手册页](http://php.net/manual/en/function.array-replace.php)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T01:11:18.767

不能就这么简单吗：

```
$new_array = array_unique(array_merge($ar1,$ar2)); 
```

也许我错过了什么或者我疯了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T00:59:42.010

我对内部数组进行了一些更改，感谢您的代码在第一步给出了一个想法:)

```
function combine($a1, $a2) {
    foreach($a2 as $k => $v) {
        if(is_array($v)) {
            if(!isset($a1[$k]))
                $a1[$k] = null;

            $a1[$k] = combine($a1[$k], $v);
        } else {
            $a1[$k] = $v;
        }
    }
    return $a1;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T00:57:33.980

我对 PHP 不太熟悉，但类似：

```
foreach ($array2 as $i => $value) {
  $array1[$i] = $value;
} 
```

# jquery - 2 个 JQuery-ajax 是否可以同时为同一页面工作？

> ID：866593
> 
> 赞同：0
> 
> 时间：2009-05-15T00:54:57.730
> 
> 标签：jquery, ajax

我试图同时运行 2 个 JQuery-ajax，但似乎总是在第 2 个 JQuery-ajax 之前完成第一个 JQuery-ajax。只是徘徊，2个JQuery-ajax可以同时为同一个页面工作吗？

例如：

我创建了一个页面，允许用户将一批记录插入数据库，并且在同一页面上它有一个表来显示数据库中的所有数据。

我使用 setInterval 调用一个函数，并每 5 秒使用 JQuery-ajax 检索数据。检索到的数据将显示在屏幕上，这意味着这些数据将在屏幕上每 5 秒更新一次。

当我按下同一页面中的进程按钮以使用 JQuery-ajax 将一批记录插入数据库时​​（完成该过程可能需要 2 分钟）。此时，屏幕将只能在插入过程完成后更新屏幕上的显示数据，即使我设置了 setInterval 以每 5 秒使用 JQuery-ajax 检索数据。

有谁知道这里出了什么问题？或者我可以提交2个JQuery-ajax并同时完成他们的任务吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T00:59:39.763

> Ajax 中的 A 代表异步。所以实际上，几乎按照定义，您应该能够同时运行多个请求。[（逻辑通量）](http://forums.digitalpoint.com/showthread.php?t=163826)

[这是一篇博客](http://blogger.forgottenskies.com/?p=173)文章，对这个问题进行了一些讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T01:46:48.277

浏览器每个服务器限制有[两个 http 连接](http://www.openajax.org/runtime/wiki/The_Two_HTTP_Connection_Limit_Issue)，这可以在 Firefox 中的 about:config 中更改，也可以在 Windows 注册表中更改（不确定在哪里）

在您的情况下，数据库服务器可能正在阻止读取请求，因为正在进行锁定表的写入事务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-03-14T09:45:01.813

我有同样的问题，但使用 JavaScript。我有两个异步 $.ajax() 实例运行一次，但第一个实例在 "success: window.location = "www.google.pl";

如果第一个实例完成，它会尝试重定向到新位置。但二审仍然有效。

这就是这个错误的原因。

# selenium - 使用 selenium.getAttribute() 从某个 id 的元素中提取属性的正确格式是什么？

> ID：866595
> 
> 赞同：1
> 
> 时间：2009-05-15T00:55:25.357
> 
> 标签：selenium

我尝试使用 selenium.getAttribute(someXPath) 跟踪适当的语法来提取属性，虽然我遇到了很多示例，但似乎没有任何效果。据我所知，标准的 xpath 语法，例如：

```
//*[@id='someID'] 
```

不起作用。从某个 id 的元素中提取属性的正确格式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T03:10:18.577

所以看起来这种格式几乎是正确的。正确的字符串是

```
//*[@id="someId"]@someAttribute 
```

另一种解决方案是使用

```
"someId@someAttribute" 
```

这实际上是“更好”的，因为前者会为 IE 生成错误。

此外，似乎当一个元素根本不包含任何属性时，错误消息是“attributeValue is null”而不是正常的“找不到元素/属性”。

# ruby-on-rails - Rails：attachment_fu 插件，将上传的 PDF 转换为图片

> ID：866606
> 
> 赞同：1
> 
> 时间：2009-05-15T01:00:22.600
> 
> 标签：ruby-on-rails, pdf, attachment-fu

哟，

我已经在我的服务器上设置了 attachment_fu，它工作得很好。然而，我的目标是能够上传 PDF 并将它们转换为图像（然后使用所有预先构建的 attachment_fu 选项，如 resize 和 thumb 生成所需的图像）。当前发生的情况是 PDF 上传并保留为 PDF，而图像则经历了所有调整大小等动作。

如何获得我想要的功能？有没有一种简单的方法可以使用我已经拥有的工具来执行此操作，或者我应该手动调用 RMagick 来进行初始转换？如果是这样，我该怎么做，然后将文件传递给 attachment_fu 进行处理？

谢谢，--Matchu

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-19T15:58:02.053

对于最古老的未回答的 Rails 问题：[https](https://stackoverflow.com/a/69804/156561) ://stackoverflow.com/a/69804/156561 ，他的回答可能非常相似，可以让您使用 Attachment_fu，我相信您现在已经迁移了。

# javascript - 如何强制 IE 重新加载 javascript？

> ID：866619
> 
> 赞同：44
> 
> 时间：2009-05-15T01:08:53.813
> 
> 标签：javascript, internet-explorer, internet-explorer-8

我在 Vista 上使用 IE 8，每次更改 javascript 文件然后开始调试时，我必须按 Ctrl+F5 让它重新加载我的 javascript。有没有办法让它在我开始调试时自动重新加载 javascript，但在浏览网络时不会失去性能提升？

是的，我知道你可能不喜欢 IE，但请记住，问题不是“什么是最好的浏览器？”。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-05-15T01:12:17.627

在 URL 的末尾添加一个字符串以中断缓存。我通常这样做（使用 PHP）：

```
<script src="/my/js/file.js?<?=time()?>"></script> 
```

这样每次我在处理它时它都会重新加载，然后在它投入生产时将其取下。实际上，我将其抽象了一点，但想法保持不变。

如果您查看本网站的来源，他们会以类似的方式在 URL 末尾附加修订号，以便在他们更新 javascript 文件时强制我们进行更改。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-05-15T01:22:31.173

Paolo 的总体思路（即有效地更改请求 uri 的某些部分）是您最好的选择。但是，我建议使用更静态的值，例如在更改脚本文件时更新的版本号，以便您仍然可以获得缓存的性能提升。

所以要么是这样的：

```
<script src="/my/js/file.js?version=2.1.3" ></script> 
```

或许

```
<script src="/my/js/file.2.1.3.js" ></script> 
```

我更喜欢第一个选项，因为这意味着您可以维护一个文件，而不必不断地重命名它（例如，在源代码管理中保持一致的版本历史记录）。当然，任何一个（正如我所描述的那样）都会涉及每次更新您的包含语句，因此您可能想要提出一种动态的方式来执行此操作，例如每次部署时用动态替换固定值（使用 Ant 或其他）。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-15T01:13:30.743

当您使用网页或 javascript 文件时，您希望每次更改时都重新加载它。您可以更改 IE 8 中的设置，使浏览器永远不会缓存。

按照这个简单的步骤。

1.  选择工具-> Internet 选项。
2.  在常规选项卡中，单击浏览历史记录部分中的设置按钮。
3.  单击“每次访问网页”单选按钮。
4.  单击确定按钮。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-01-05T17:39:08.093

如果您只想在您的浏览器上执行此操作（也就是不强制您的用户执行此操作），那么我不会将您的代码设置为不使用缓存。正如 José 所说，存在性能损失。

而且我不会完全关闭 IE 上的缓存，因为您访问的每个网站都会失去性能提升。您可以告诉 IE 始终从服务器刷新特定站点或浏览会话：

1.  打开 IE 开发者工具
2.  从菜单中选择缓存
3.  单击以选中“始终从服务器刷新”

或者，对于那里的键盘快捷键爱好者（比如我自己）..

*   F12、Alt+C、向下箭头、Alt+R。

**注意事项**：话虽如此...请记住，无论何时您以与在生产中查看站点不同的方式进行开发/测试，您都会冒着得到混合结果的风险。一个很好的例子就是这个缓存问题。我们发现了一个问题，即 IE 正在缓存我们的 Ajax 调用，而不是从 GET 方法更新结果。如果我们在 IE 中禁用缓存，我们将永远不会在开发中看到这个问题，并且会像这样将它部署到生产环境中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-09-12T08:19:30.027

如果您在 IE11 中，您可以使用 IE 开发人员工具告诉 IE 始终从服务器刷新特定浏览会话。

*   使用 F12 键打开 IE 开发者工具
*   转到网络选项卡
*   单击“始终从服务器刷新”按钮

[![按钮总是从服务器刷新](https://i.stack.imgur.com/bqReP.png)](https://i.stack.imgur.com/bqReP.png)

（对不起法国捕获）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T01:16:25.947

在 javascript 中，我认为这是不可能的，因为现代浏览器对 javascripts[的安全性有一个政策](http://www.devarticles.com/c/a/JavaScript/JavaScript-Security/)。清除缓存是一个非常违规的行为。

您可以尝试添加

```
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
```

在你的标题中，但你会有性能损失。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-13T15:43:34.540

这应该可以解决 ASP.NET 的问题。该概念与 PHP 示例中所示的概念相同。由于每次加载脚本时 URL 都不同，因此代理的浏览器都不应缓存文件。我习惯于将我的 JavaScript 代码放入单独的文件中，并在 Visual Studio 上浪费了大量时间，直到我意识到它不会重新加载 JavaScript 文件。

```
<script src="Scripts/main.js?version=<% =DateTime.Now.Ticks.ToString()%>" type="text/javascript"></script>

```

完整示例：

```
<%@ 页面标题="主页" 语言="C#" MasterPageFile="~/Site.master" AutoEventWireup="true"
    CodeBehind="Default.aspx.cs" Inherits="WebApplication1._Default" %>

<asp:Content ID="HeaderContent" runat="server" ContentPlaceHolderID="HeadContent">

   <script src="Scripts/jquery-1.4.1-vsdoc.js" type="text/javascript"></script>  
   <script src="Scripts/main.js?version=<% =DateTime.Now.Ticks.ToString()%>" type="text/javascript"></script>
    <script type="text/javascript">

        $(文档).ready(函数 () {
                                我的初始化（）；
                          });

    </脚本>
</asp:内容>

```

显然，这个解决方案应该只在开发阶段使用，并且应该在发布网站之前删除。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-17T21:27:40.873

在 URL 的末尾添加 js 文件的修改日期。使用 PHP，它看起来像这样：

```
echo '<script type="text/javascript" src="js/something.js?' . filemtime('js/something.js') . '"></script>'; 
```

每次更新脚本时都会重新加载脚本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-06-25T00:02:39.413

如果您正在运行 ASP.Net，请查看 ASP.Net 4.5 中提供的捆绑和缩小模块。

[http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification](http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification)

您可以声明一个指向您的 javascript 文件的“捆绑包”。每次您的文件更改时，它都会生成一个新的查询字符串后缀……但仅在文件更改时才会这样做。这使得部署更新变得非常简单，因为您甚至不必考虑使用新版本号更新您的标签。

它还可以将多个 .js 文件捆绑到一个文件中，并在一个步骤中将它们缩小。同上 css。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-09T12:42:28.983

为了消除在开发网站时在 IE 选项卡中反复按 F5 的需要，请使用[ReloadIt](http://reloadit.codeplex.com)。

![在此处输入图像描述](https://i.stack.imgur.com/0wMh9.png)

对于 IE 中显示的每个网页，您可以配置一个文件名、一个目录或一组。如果这些配置路径中的任何一个发生任何更改，ReloadIt 会刷新 IE 选项卡。一个简单的工具。它只是工作。

这将重新加载所有内容，而不仅仅是 javascript。

# objective-c - 如何在 Xcode 中正确布局独立的系统服务？

> ID：866621
> 
> 赞同：2
> 
> 时间：2009-05-15T01:09:36.087
> 
> 标签：objective-c, xcode, macos, cocoa

我最近开始对为 OS X 编写一些系统服务感兴趣，但由于我没有应用程序来宣传下面的服务，所以我必须求助于编写独立的系统服务。Apple 关于系统服务的文档虽然简陋，但它关于独立服务的文档并不存在。

到目前为止，我拥有的是一个从 bundle 包构建的 Xcode 项目，它有两个源`HashifyService.h`和`HashifyService.m`. 这是我的测试代码：

```
- (void) doServiceWork:(NSPasteboard *)pboard
            userData:(NSString *)userData
                 error:(NSString **)error {
  NSLog(@"Actually in the service now");
  NSString *pboardString;
  NSArray *types;

  NSLog(@"do test magic service! (pboard: %@, types: %@)", pboard, [pboard types]);

  NSString* outputString = @"It Worked";
  types = [NSArray arrayWithObject:NSStringPboardType];
  [pboard declareTypes:types owner:nil];
  [pboard setString:outputString forType:NSStringPboardType];
  [outputString release];
  return;
} 
```

这是`NSServices`我的条目`Info.plist`：

```
<dict>
<key>NSMenuItem</key>
<dict>
    <key>Menu item title</key>
    <string>HashifyTest</string>
</dict>
<key>NSMessage</key>
<string>doServiceWork</string>
<key>NSPortName</key>
<string>HashifyService</string>
<key>NSReturnTypes</key>
<array>
    <string>NSStringPboardType</string>
</array>
<key>NSSendTypes</key>
<array>
    <string>NSStringPboardType</string>
</array>
</dict> 
```

然后我构建服务包并将其放置在`~/Library/Services/`适当检测到的位置，然后我可以选择使用该服务。但是，在激活服务后，会发生错误并记录到控制台：

```
..../Hashify.service/Contents/MacOS/Hashify: cannot execute binary file 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T02:03:08.643

你需要一个`main()`函数。那应该使用注册服务`NSRegisterServicesProvider()`并进入运行循环。那是在[文档](http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/SysServices/Articles/providing.html)中。

# c - C 定时器回调

> ID：866622
> 
> 赞同：6
> 
> 时间：2009-05-15T01:10:27.973
> 
> 标签：c, windows, unix, timer, posix

对 UNIX 和 Windows 上的 C 语言中类似于 JavaScript setTimeout 的东西感兴趣。

基本上，我想要：

```
start_timer(&function_pointer, int time_in_secs) 
```

或尽可能接近。

此外，类似于 setInterval 的东西会很好（它每 n 秒调用一次回调），但这可以使用 setTimeout 实现:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T02:01:49.130

在 Win32 中使用[TimerProc](http://msdn.microsoft.com/en-us/library/ms644907(VS.85).aspx)作为回调的[SetTimer 。](http://msdn.microsoft.com/en-us/library/ms644906(VS.85).aspx)

```
/* calls TimerProc once every 60000 milliseconds */
SetTimer(NULL, 1, 60000, TimerProc); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-15T03:50:42.940

您可能想尝试使用 POSIX 间隔计时器 timer_create 和 timer_settime，因为它允许您直接指定回调函数而不使用信号。要让计时器只过期一次（而不是继续重复）：

> [timer_settime](http://linux.die.net/man/3/timer_settime)：定时器的重载值应设置为 value 的 it_interval 成员指定的值。当定时器配备非零 it_interval 时，将指定一个周期性（或重复性）定时器。

以下是有关使用这些计时器的大量文档，其中包含来自 kernel.org 上的 Linux 程序员手册的一个很好的示例：

[timer_create - 创建一个 POSIX 每个进程的计时器](http://www.kernel.org/doc/man-pages/online/pages/man2/timer_create.2.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T01:13:09.590

对于 UNIX `man setitimer`，.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T01:24:16.723

关于 alarm() 和 setitimer() 的一些信息可以在[这里](http://www.gnu.org/software/hello/manual/libc/Setting-an-Alarm.html)找到。请注意，upcall 函数是一个信号处理程序，因此它受制于与信号处理程序相关的所有限制和限制，如此处详细描述[的](http://www.cs.utah.edu/dept/old/texinfo/glibc-manual-0.02/library_21.html)。

如第一个链接所述，alarm() 是基于 POSIX 的，而 setitimer() 不是（尽管它更灵活）。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-15T01:19:07.140

试试油嘴滑舌。如果您需要可移植的代码，那么您很可能无法编写比它们更可移植的东西；）

[http://library.gnome.org/devel/glib/2.20/glib-The-Main-Event-Loop.html#g-timeout-add](http://library.gnome.org/devel/glib/2.20/glib-The-Main-Event-Loop.html#g-timeout-add)

# windows - 如何测试批处理文件中的当前驱动器号？

> ID：866623
> 
> 赞同：19
> 
> 时间：2009-05-15T01:11:04.120
> 
> 标签：windows, batch-file

我正在尝试编写一个批处理文件，该文件获取运行批处理文件的驱动器号，并将其用作 IF 语句。如果字母是 M: 例如，它将跳转到标签 :mSection。

这甚至可能吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-15T01:16:55.820

您可以使用 %~d0 获取驱动器号。像这样的东西：

```
IF "%~d0"=="M:" CALL :mSection 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-12-13T14:00:15.880

> 您可以使用`%~d0 to`获取驱动器号...

当 .bat 在不同的驱动器上时（在 PATH 中的某个位置），它不起作用。

我建议：

```
echo %cd:0,2% 
```

# php - PHP 读取最快的序列化数据格式

> ID：866629
> 
> 赞同：3
> 
> 时间：2009-05-15T01:13:51.040
> 
> 标签：php, serialization

我有一个 PHP 前端和一个 C++ 后端，我需要能够将名称组发送到前端。PHP 读取哪种序列化格式最有效/最快？

示例数据

```
group1:
  name1 3923
  name2 9879
  name3 8944
group2:
  name5 9823
group3: 
  name9 9822
  name1 4894 
```

PHP 读取速度最快的是什么？

*   XML
*   JSON
*   YAML
*   协议缓冲区
*   逗号/空格分隔我们自己的系统
*   还要别的吗？其他？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T01:17:58.937

PHP 自己的序列化格式可能是最快的。[`unserialize()`](http://php.net/manual/en/function.unserialize.php)是 PHP 用来将此数据转换回其自身类型的函数。[这篇文章](http://objectmix.com/php/362009-specification-serialize.html#post1335166)有各种链接到其他语言的 PHP 序列化格式的实现，我相信你可以轻松地转换其中之一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T02:01:47.243

我在大型文本文件上使用了 PHP 的 serialize() 和 unserialize()，它的表现很糟糕（那是几年前的事了——也许现在更好了）。无论如何，我设计了一个小技巧来克服这个问题，它只涉及从您直接导出到文本文件中的数据生成 PHP 数组声明，例如：

```
<?php
$groups = array('groups' => array( array('jeff' => 2343,
                                         'tom'  => 8477),
                                   array('baal' => 2873,
                                         'scorpio'  => 3210),
                                   array('jeff' => 2343,
                                         'tom'  => 8477)
                                 )
                            )
               );
?> 
```

...然后通过简单地调用来反序列化它：

```
include 'groups.php';//makes $groups available 
```

那时工作得很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T01:15:17.197

JSON 会很容易使用[`json_decode`](http://www.php.net/json_decode). 我不确定速度，但除非您计划在系统之间传输数兆字节的数据，否则与您使用哪个数据无关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T03:59:43.980

正如 Paolo 指出的那样，您可以使用非常快的 json_decode。在 C++ 后端，这些是您的一些选项（直接取自[json.org](http://json.org)网站）：

C++：

*   [小JSON](http://blog.beef.de/2008/01/04/tinyjson/)。
*   [jsoncpp](http://sourceforge.net/projects/jsoncpp/)。
*   [动物园库](http://zoolib.cvs.sourceforge.net/zoolib/zoolib/src_other/misc/ZUtil_JSON.cpp)。
*   [乔拉](http://morongo.homelinux.net/jaula/)。
*   [约斯特](http://ddsbench.svn.sourceforge.net/viewvc/ddsbench/trunk/jost/)。
*   [JSON 精神](http://www.codeproject.com/cpp/JSON_Spirit.asp)。
*   [卡君](http://cajun-jsonapi.sourceforge.net/)。

# asp.net-mvc - 我如何在 ASP.NET MVC 中“甜甜圈缓存”而不是日期

> ID：866634
> 
> 赞同：5
> 
> 时间：2009-05-15T01:16:07.570
> 
> 标签：asp.net-mvc, donut-caching

我见过的所有甜甜圈缓存的例子都是这样的：

```
 <%= Html.Substitute( c => DateTime.Now.ToString() )%> 
```

如果我只想要日期，那很好，但还有其他选择吗？

我知道有一个代表“MvcSubstitutionCallback”，其签名如下：

```
 public delegate string MvcSubstitutionCallback(HttpContextBase httpContext); 
```

但是`RenderAction`并`RenderPartial`返回 void 所以我不能只从委托方法中返回它们。我怎样才能有效地使用这个回调来处理更复杂的情况。

我在[这里](http://www.haacked.com/archive/2009/05/12/donut-hole-caching.aspx)和[这里查看](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)了 Phil Haacked 的两篇文章，但似乎都没有完全符合我的要求。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:03:33.423

“甜甜圈缓存”意味着使用 Response.WriteSubstitution 方法。如果您查看 MVC 源代码，您会看到 System.Web.Mvc.Html.RenderPartialExtensions.RenderPartial 方法正在使用 Response.Output（HtmlHelper.cs，第 277 行 - 'RenderPartialInternal' 方法中的最后一行） - 所以您需要创建自己的用于处理更复杂情况的 html 助手。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-20T11:39:54.150

请注意，虽然这在 Mvc 1.0 中确实有效，但在 Mvc 2.0 中不再有效。见这里：[http ://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-14T21:43:07.237

这是针对 ASP.NET MVC 3 更新的文章：

[http://dotnetslackers.com/articles/aspnet/Cache-Exploration-in-ASP-NET-MVC-3-Part-1.aspx](http://dotnetslackers.com/articles/aspnet/Cache-Exploration-in-ASP-NET-MVC-3-Part-1.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-07T23:53:14.780

本文可能会有所帮助：[http](http://www.asp.net/Learn/mvc/tutorial-19-cs.aspx) ://www.asp.net/Learn/mvc/tutorial-19-cs.aspx （在 ASP.NET MVC 中将动态内容添加到缓存页面）

# c - 从 C 调用用 VB6 制作的 DLL

> ID：866644
> 
> 赞同：0
> 
> 时间：2009-05-15T01:17:59.750
> 
> 标签：c, dll, vb6

好的，这个问题与我努力解决的最后一个问题相反......我觉得我非常接近得到它，但它只是不起作用。之前，我试图用 C 编译一个 DLL，然后从 VB 调用它，但我意识到这并不是我真正想要的（我希望程序用 C 编写，同时使用 VB 前端，而不是前端是程序并使用 DLL 的功能）。

所以现在，我正在用 VB 编译一个 DLL 并尝试从 C .exe 调用它。

“但是等等，你不能用 VB 编译 DLL！” [实际上](http://windowsdevcenter.com/pub/a/windows/2005/04/26/create_dll.html?page=1)，我截获了 VB6.EXE 对链接器的调用，并为我希望它导出的函数添加了一个定义文件，这是最好的部分——如果我将 dll 复制到 system32，我可以从另一个 VB 程序调用这些函数它工作正常。唯一的问题是，我似乎无法从 C 中加载它。嗯，我可以，我得到了句柄，我得到了函数的地址，只是程序失败了。

这是我导出的虚拟函数：

```
Public Function PopupMessage(ByVal rawr As Integer) As Integer
    Msgbox "HERE BE " & rawr & " DRAGON(S)."
    PopupMessage = 4
End Function 
```

我可以从另一个 VB6 程序中这样调用它：

```
Public Declare Function PopupMessage Lib "vbdll" _
    (ByVal howmanydragons As Integer) As Integer

Private Sub Command1_Click()
    If IsNumeric(Text1.Text) Then
        Text2.Text = PopupMessage(Text1.Text)
    End If 
End Sub 
```

并且，从 C：

```
int main(){
  typedef short int (*vbfun)(short int); //VB6 "Integer" is 16 bits
  vbfun popup_message;
  HANDLE dllhnd;
  dllhnd = LoadLibrary("vbdll.dll");
  if(dllhnd>(void*)HINSTANCE_ERROR){
    popup_message = (vbfun)GetProcAddress(dllhnd, "PopupMessage");
    printf("%d", popup_message(3));
  }
  return 0;
} 
```

当我调试时，我发现我遇到了访问冲突，这在过去意味着我在 VB 函数中忘记了 ByVal，并且它正在传递对 5 或其他东西的引用。但是我在这里看不到任何问题...我从 DLL 中获得了与从 dumpbin 获得的偏移量相匹配的 ProcAddress，我可以从 VB 中调用它，但是 C 调用者遇到了访问冲突...

有任何想法吗？有人看到我忽略的东西吗？我意识到我正在做一些非常晦涩且几乎闻所未闻的事情，而不仅仅是学习如何用 C 设计前端，但现在我决心修复它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T08:01:47.687

只需使用免费插件[vbAdvance](http://vb.mvps.org/tools/vbAdvance/)。它允许您创建可从 C（而不是 COM DLL）调用的标准 DLL。

它还使您可以访问许多其他高级构建功能和许多 IDE 便利功能。创建控制台应用程序，在您的 DLL 中创建 DllMain 入口点，为 XP 样式创建 XP Manifest 编译器，支持终端服务器等。

[（没有冒犯，但你在这里重新发明轮子，而不是开辟新天地！我也在这个答案](https://stackoverflow.com/questions/664370/your-favorite-visual-basic-6-tools-and-tips/802259#802259)上链接到 vbAdvance 。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-18T14:17:46.723

在运行时中使用任何函数之前，您必须在导出的函数中**手动**初始化 VB6 运行时。查看[Compact In-Process Multi-threading](http://www.pscode.com/vb/scripts/ShowCode.asp?txtCodeId=36373&lngWId=1)示例，该`ThreadEntry`函数显示了如何执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T01:25:24.130

您必须通过 COM 接口调用它，不是吗？ [更像这样的东西](http://faculty.cascadia.edu/mpanitz/COM_Tutorial/COMClientInC.html)。

# wpf - 如何更改文本框样式数据触发器中的文本框样式？

> ID：866647
> 
> 赞同：1
> 
> 时间：2009-05-15T01:19:27.920
> 
> 标签：wpf, textbox, styles

我为我的文本框控件创建了默认样式，但我希望能够在运行时更改样式。

我有一个要绑定的属性，它会通知 UI 数据是否是强制性的，并且我希望能够将文本框的样式更改为另一种在文本框下方显示红线的样式。我不能在我创建的标准文本框样式中使用它，因为每个文本框的属性都不同，即 IsEmailMandatory、isNameMandatory。

我尝试为我拥有的每个文本框绑定文本框样式的数据触发器，但我收到一条消息，告诉我无法更改样式中的样式。那么我该怎么做呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T11:44:44.237

您无需更改触发器中的整个样式，只需更改模板即可。

实现类似功能的另一种方法是使用附加属性。假设 IsEmailMandatory、isNameMandatory 属性位于 DataContext 而不是控件本身，您可以将所需的值绑定到附加属性，然后以默认样式触发该属性。

# c++ - 通过 Visual Studio 使用 Boost 构建没有选择正确的 VS 版本或静态链接库

> ID：866648
> 
> 赞同：0
> 
> 时间：2009-05-15T01:19:50.447
> 
> 标签：c++, visual-studio-2005, boost

```
#include <boost/regex.hpp>

int main(void)
{
    return 0;
} 
```

错误 2 致命错误 LNK1104：无法打开文件“libboost_regex-vc90-mt-gd-1_38.lib”

这不是路径问题。我故意没有构建那个 .lib，并且想要链接到 mt-sgd-1_38.lib 文件，但我不知道我需要设置什么才能让 boost 的自动命名选择 mt-sgd 而不是 mt -gd。

另外，我不确定它是如何检测到使用 vc90 的，但我正在尝试使用 VS 2005（即 vc80）进行构建。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:30:30.583

我相信 flag ('s') 表示静态链接；即：静态链接 c 运行时库。这将是您的应用程序的项目设置。

此外，对于 v80/v90 问题，当我将 v90 编译器与平台 SDK 的某些部分一起安装时，我也遇到过类似的情况。如果您在链接器对象名称中获得 v90，那么您实际上是在使用 v90 编译器构建的（这在 2005 IDE 中是可能的，具体取决于路径设置和安装的内容）。应该不是问题，只要一切都匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-29T15:00:19.477

尝试将 BOOST_LIB_DIAGNOSTIC 添加到预处理器中，我以前使用它来解决诸如此类的问题，但是我通常遇到相反的问题。它尝试静态，我想要动态，我上次通过添加 BOOST_THREAD_USE_DLL 解决了这个问题，必须有其他等价物 - 我假设您只需将 THREAD 替换为您正在使用的库的名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-24T15:42:57.077

对我有用的是在构建时使用此选项：runtime-link=static，如

```
.\b2 runtime-link=static 
```

# jquery - 如何在提交表单之前等待 ajax 验证完成？

> ID：866654
> 
> 赞同：5
> 
> 时间：2009-05-15T01:27:16.717
> 
> 标签：jquery, ajax, validation

在 validateUsername 函数有机会在服务器端完成用户名检查之前提交表单的问题。

如何仅在 validateUsername 函数完成后提交表单？希望这很清楚...

```
form.submit(function(){
    if (validateUsername() & validateEmail() & validatePassword()) {
        return true;
    } else {
        return false;
    }
});         

function validateUsername(){            
    usernameInfo.addClass("sign_up_drill");
    usernameInfo.text("checking...");
    var b = username.val();
    var filter = /^[a-zA-Z0-9_]+$/;     
    $.post("../username_check.php",{su_username:username.val()},function(data) {
        if (data=='yes') {
            username.addClass("error");
            usernameInfo.text("sorry, that one's taken");
            usernameInfo.addClass("error");
            return false;           
        } else if (!filter.test(b)) {
            username.addClass("error");
            usernameInfo.text("no funny characters please");
            usernameInfo.addClass("error");
            return false;   
        } else {
            username.removeClass("error");
            usernameInfo.text("ok");
            usernameInfo.removeClass("error");      
            return true;    
        }
    });             
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T01:40:42.330

Olafur 答案的更详细版本 - 进行了 AJAX 调用，函数无需等待即可返回。

在您提交表单之前，回调不会完成。

您应该做的是让按钮/触发器调用 AJAX 验证，并且回调应该提交表单而不是返回 true。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T02:40:05.013

[jQuery 表单验证插件](http://docs.jquery.com/Plugins/Validation)会为您解决这个问题——我强烈推荐它。

一些示例代码：

```
$("#myform").validate({
  rules: {
    email: {
      required: true,
      email: true
    },
    username: {
      required: true,
      remote: {
        url: "../username_check.php",
        type: "post",
        }
      }
    }
  }
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-14T11:40:24.340

在 jQuery 中有相同的解决方案。我需要在某些 JavaScript 期间检查用户是否存在于我的应用程序中。这是代码：

```
var pars = "username="+ username;
var some = $.ajax({url: 'AjaxUserNameExist.php',
  type: 'GET',
  data: pars,
  async: false
}).responseText;

if(some=="1") //this is value Got from PHP
{
  alert("We cannot Go");
  return false;
}

if(some=="0")
{
  alert("We can Go");
  return true;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-18T18:20:22.130

我最近处理了一个类似的问题。在某些情况下，在输入字段上按 enter 可能会使表单提交。我尝试以多种方式解决此问题，然后更改了所需的规范，以便在设备上按 Enter 键或 Go，将允许提交表单。我的解决方案在当时对我来说是有意义的。

```
var form_submit = false;

function validateInput () {

    var field_value = $('#username').val();

    $.post('validation.php', {'input': field_value }, function (d) {
        if (d.valid) {

            form_submit = true;
            $('form').submit();

        } else {

            //error message or whatever

        }
    }, 'json');

}

$('form').submit( function () {

    if ( form_submit ) {
        return true; 
    } else {
        validateInput();
        return false;
    }

}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T01:37:45.803

您不能在 AJAX 调用中返回。我建议你阅读jQuery FAQ 的[这一部分](http://docs.jquery.com/Frequently_Asked_Questions#How_do_I_get_and_use_the_server_response_from_an_AJAX_request.3F)。特别是关于回调的部分。（最后一个代码片段）

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-15T02:01:54.340

我建议有

1）表单中的隐藏字段。
2) 在调用任何发出 AJAX 请求的函数之前，将其值设置为 0。
3）当每个函数验证成功时增加值。
4）设置一些秒数（即完成所有AJAX请求所需的时间/超时时间+几秒）在检查此隐藏字段的值之前等待。检查该值是否为 3（如果有 3 个 AJAX 调用进行验证），然后让它提交。

我想，当控件失去焦点时进行验证会更好。仅当所有控件都通过验证时才启用提交按钮。

抱歉，我对 JQuery 不太熟悉，但如果我使用纯 javascript，我会这样做。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2010-04-30T06:15:57.440

你为什么不`$('#yourFormId').submit();`从你的 ajax 后端收到结果后才使用？

# mfc - 获取按钮焦点 - MFC

> ID：866657
> 
> 赞同：0
> 
> 时间：2009-05-15T01:28:29.927
> 
> 标签：mfc, button, dialog, focus

我有一个 VC++ MFC 对话框应用程序，在我的 OnTimer 函数中，我只是想确定我的对话框中的哪个按钮当前具有焦点。

这是我想要完成的一些伪代码......

```
CDialog::OnTimer()
{
     CButton *btn = GetButtonOnFocus(); 
     int btnID = btn->GetDlgCtrlID();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T01:50:44.787

我没有尝试过，但这应该有效：

```
CWnd * pFocus = GetFocus();
int btnID = 0;
if (pFocus != NULL && pDialog->IsChild(pFocus))
    btnID = pFocus->GetDlgCtrlID(); 
```

这不会将结果限制为仅按钮 - 为此，您需要使用 GetClassName 并与“按钮”进行比较。

# objective-c - 核心动画锚点被忽略？

> ID：866661
> 
> 赞同：4
> 
> 时间：2009-05-15T01:31:27.050
> 
> 标签：objective-c, cocoa, macos, core-animation

这段代码：（self 是 NSView 的子类）

```
 rotate = [CABasicAnimation animationWithKeyPath:@"transform.rotation.z"];

    rotate.duration = 5;

    rotate.toValue = [NSNumber numberWithFloat:(2*pi)];

    rotate.repeatCount = INFINITY;

    rotate.removedOnCompletion = NO;
    rotate.fillMode = kCAFillModeForwards;

    NSLog(NSStringFromPoint(CGToNSPoint([self layer].anchorPoint)));

    [self layer].anchorPoint = CGPointMake(0.5, 0.5);

    NSLog(NSStringFromPoint(CGToNSPoint([self layer].anchorPoint)));

    [[self layer] addAnimation:rotate forKey:@"constantRotation"]; 
```

应该围绕它的中心旋转我的层。我已将锚点设置为 (0.5, 0.5)，但视图仍围绕其原点旋转。怎么会出现这种情况。我用谷歌搜索无济于事，所以我确定这可能是我错过的一些非常简单的事情......

NSLog 似乎报告了正确的值。第一个报告 (0, 0) 和第二个 (0.5, 0.5)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-07T04:20:19.503

默认anchorPoint默认为0.5，0.5，所以不应该设置。您可能已定位图层的内容，使其看起来好像原点确实位于锚点处。

# c++ - 如何以模块化方式组织源代码

> ID：866664
> 
> 赞同：0
> 
> 时间：2009-05-15T01:32:34.067
> 
> 标签：c++, project-organization

我目前正在从事一个范围非常大的项目，但是对于 C++ 来说相对较新并且来自 Java 背景，我不确定最好的方法。

我想要一个类似于以下的目录结构：

```
+ Root
- main.cpp
    + Engine
        + Core
        - foo.cpp
        - foo.h
        + Utilities
        - bar.cpp
        - bar.h
        + Sound
        + Input
        + Collision Detection
        + Particle System 
```

目前，我在 Engine 目录中有大量 .ccp/.h 文件。当我将它们移动到相应的文件夹并尝试将它们绑定在一起时，我只会得到与未定义类相关的编译错误页面。一些善良的灵魂可以帮助新手指出正确的方向吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T02:11:10.183

您几乎可以肯定在包含包含文件时遇到问题。您需要为要从中引入 .h 文件的目录添加编译命令 -I 标志。

您的几个目录名称中有空格，因此请注意正确引用目录名称。或者，甚至更好，因为这通常是一个主要的痛苦，改变，例如，将“碰撞检测”更改为“碰撞检测”或“碰撞检测”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-10T09:45:36.250

如果您使用 makefile 编译项目，我建议您切换到[CMake](http://www.cmake.org/)，这将简化您构建目标模块化结构的方式。CMake 关键字“include_directories”是您需要的关键字。

# c++ - 在 C++ 中切换堆栈

> ID：866672
> 
> 赞同：7
> 
> 时间：2009-05-15T01:38:17.640
> 
> 标签：c++, winapi, multiplestacks

我有一些用C语言编写的16位旧代码，使用Borland C++在多个堆栈之间切换，使用longjmps。它通过执行 malloc 创建一个新堆栈，然后使用 inline Assembler 将 SS 和 SP 寄存器设置为 malloc 区域地址的段和偏移量。我想将它转换为 Win32，看起来这两条指令应该被一个设置 ESP 的指令替换。这两条指令被 CLI/STI 对包围，但在 Win32 中，它们提供“特权指令”，所以我现在将它们删掉了。当谈到 Windows 时，我是一个真正的无辜者，所以，我的第一个测试用例成功了，我感到相当惊讶！所以，我相当模糊的问题是在这里问专家我正在做的事情是否a）太危险而无法继续，或者b）如果我添加一些代码会起作用，采取某些预防措施等？如果是后者，应该添加什么，我在哪里可以找到它？我是否需要担心任何其他寄存器，例如 SS、EBX 等？我在用**没有**优化...感谢人们可以给我的任何提示。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T01:46:20.057

由于操作环境的差异，删除 CLI/STI 仍然有效。

在 16 位 DOS 上，可能会发生中断，并且该中断最初会在同一个堆栈上运行。如果你在操作过程中被打断，中断可能会崩溃，因为你只更新了 ss 而不是 sp。

在 Windows 和任何其他现代环境中，每个用户模式线程都有自己的堆栈。如果您的线程由于某种原因被中断，它的堆栈和上下文将被安全地保留 - 您不必担心在您的线程和堆栈上运行的其他东西。在这种情况下，cli/sti 将保护您免受操作系统已经保护的东西。

正如 Greg 所提到的，在 Windows 上像这样交换堆栈的安全、受支持的方法是 CreateFiber/SwitchToFiber。这确实有改变整个上下文的副作用，所以它不像只是切换堆栈。

这确实提出了您想要做什么的问题。很多时候，切换堆栈是为了获得有限的堆栈空间，在 16 位 DOS 上是 64k。在 Windows 上，您有 1 MB 堆栈，您可以分配更大的堆栈。你为什么要切换堆栈？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-15T01:42:20.393

到目前为止，最安全的方法是将代码移植到官方 Win32 多道程序结构，例如线程或光纤。[Fibers](http://msdn.microsoft.com/en-us/library/ms682661(VS.85).aspx)提供了一个非常轻量级的多堆栈范例，听起来它可能适合您的应用程序。

[为什么 Win32 甚至还有纤程](http://blogs.msdn.com/larryosterman/archive/2005/01/05/347314.aspx)？文章也很有趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T01:54:03.250

我在用户模式下完成了这个，它似乎没有问题。您不需要 cli/sti，这些说明只是防止代码中的中断，从您告诉我们的有限信息来看，这应该是不必要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T06:01:53.093

看看Bert Hubert 的[Mtasker](http://ds9a.nl/mtasker/)。它执行简单的协作多任务处理，您可能很容易使用它来移植您的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T06:19:45.670

不要忘记跳跃堆栈会占用任何参数或堆栈驻留变量。

# java - 带有调试接口问题的Java插件开发

> ID：866677
> 
> 赞同：2
> 
> 时间：2009-05-15T01:42:38.817
> 
> 标签：java, macos, eclipse-plugin, jdi

您好，我正在尝试开发一个使用 Java 调试接口的 Eclipse 插件（在 Eclipse 中），但出现以下错误：

> 访问限制：由于所需库 /System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/classes.jar 的限制，无法访问类型 VirtualMachine

在非插件开发项目中使用调试接口似乎工作正常。我认为这与插件依赖项有关，但我不确定如何修复它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T03:16:55.360

可以通过更改 Eclipse IDE 中的设置来删除此错误消息。使用以下任何路径打开如下所示的对话框。

```
* Windows -> Preferences -> Java
  -> Compiler -> Errors/Warnings
* (Project) Properties -> Java Compiler -> Errors/Warnings 
```

在对话框的“已弃用和受限制的 API”部分下找到“禁止引用（访问规则）”选项。此选项决定如何处理在 Eclipse 中定义的访问规则。默认情况下，它设置为“错误”，这会导致 Eclipse 抱怨对任何受限类的引用。选择任何其他选项（警告或忽略）将删除这些错误消息。

来源： http: [//lkamal.blogspot.com/2008/09/eclipse-access-restriction-on-library.html](http://lkamal.blogspot.com/2008/09/eclipse-access-restriction-on-library.html)

# c# - 在 WPF 中打印多页

> ID：866678
> 
> 赞同：3
> 
> 时间：2009-05-15T01:42:49.673
> 
> 标签：c#, .net, wpf, printing

我必须打印我的表格，但只输入一页很大，所以我需要打印 2 页，我的知识贫乏让我知道如何打印一页，但热如何打印多页。您对我如何在多页中打印有什么建议吗，我们将不胜感激。

谢谢。

好作品

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T01:52:44.877

您需要重写[DocumentPaginator](http://msdn.microsoft.com/en-us/library/system.windows.documents.documentpaginator.aspx)类。

这篇[博文](http://www.switchonthecode.com/tutorials/wpf-printing-part-2-pagination)帮助我让它发挥作用。

我所做的是创建一个`UserControl`显示一个页面（任何页面）的数据价值。

然后在`GetPage`我创建的覆盖中`UserControl`（将要渲染的页码传递给它），然后测量和排列它（使用`PageSize`from `DocumentPaginator`），并将其作为 a 返回`DocumentPage`（通过将其传递给 的构造函数`DocumentPage`）。

然后您需要覆盖`PageCount`and `PageSize`，以便在`PageSize`更新时`PageCount`更改 。

# c++ - 使用 OpenGL / GLUT 如何检测是否同时按住两个键？

> ID：866679
> 
> 赞同：12
> 
> 时间：2009-05-15T01:43:07.350
> 
> 标签：c++, keyboard, glut

使用 OpenGL / GLUT 如何检测是否同时按住两个键，例如“a”和“j”？

（这个程序需要用 OSX GCC、Windows GCC、Windows VS2005 编译，所以请不要依赖操作系统。）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-15T02:05:49.510

尝试以下操作：

1.  用于`glutIgnoreKeyRepeat`仅获取物理 keydown/keyup 事件
2.  用于`glutKeyboardFunc`注册监听 keydown 事件的回调。
3.  用于`glutKeyboardUpFunc`注册监听 keyup 事件的回调。
4.  创建一个`bool keystates[256]`数组来存储键盘按键的状态。
5.  通过 keydown 回调接收事件时，设置`keystates[key] = true`.
6.  通过 keyup 回调接收事件时，设置`keystates[key] = false`.
7.  在你的运行循环中，测试 if `(keystates['a'] || keystates['A']) && (keystates['j'] || keystates['J'])`。

朝那个方向看。虽然我没有测试过，但它应该可以工作。您可能还需要`glutSpecialFunc`并`glutSpecialUpFunc`接收“特殊”键的消息。

另外，请注意 GLUT 真的是老东西了，还有更好的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-04T19:41:08.213

如果您的意思是更简单且与过剩无关的输入函数，则通过“更好的选择”，然后使用 GetAsyncKeyState 函数...

[MSDN - GetAsyncKeyState 函数](http://msdn.microsoft.com/en-us/library/windows/desktop/ms646293%28v=vs.85%29.aspx)

# postfix-mta - 我想连接电子邮件和应用程序的接收

> ID：866684
> 
> 赞同：1
> 
> 时间：2009-05-15T01:45:40.277
> 
> 标签：postfix-mta

如果在 XXXX@YYYY.ZZZ 上发送一封电子邮件，我想将电子邮件的内容放入数据库，但如何实现呢？我使用 MTA 的后缀。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T01:59:05.017

如果你一定要，编写一个程序来处理输入（比如 /usr/bin/your_program）并将其放在 /etc/aliases 中：

```
intended-local-address: "|/usr/bin/your_program" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-16T08:53:47.117

我用过[fetchmail](http://catb.org/esr/fetchmail/fetchmail-man.html)。如果配置正确，它可以对远程 IMAP 服务器进行**阻塞**调用（它会一直挂起，直到收到邮件，这太酷了，没有主动轮询！）。它处理多种邮件协议。它将带有标题的电子邮件放入您选择的程序中（我使用了 python，它是内置的邮件解析库）。

我必须说我为这个解决方案感到自豪，因为它相对容易设置并且最终非常有效。

还有几件事值得注意：

1.  连接超时或最终重置（数小时后，有时数周后）。我怀疑 IMAP 服务器正在重新启动。
2.  不要尝试自己解析电子邮件。在调试了第 5 种发送邮件正文的方式后我放弃了，然后使用了现有的库。
3.  投票结束后，在你再次投票之前做一个*sleep 5*或其他事情。我的邮件程序曾经与另一个邮件程序陷入无限循环，而 sleep 5 救了我。

# visual-c++ - VC++中的内存分配

> ID：866688
> 
> 赞同：3
> 
> 时间：2009-05-15T01:48:21.330
> 
> 标签：visual-c++, memory-management

我正在使用 VC++ 2005 我重载了 new 和 delete 运算符。一切皆好。

我的问题与一些神奇的 VC++ 正在添加到内存分配有关。

当我使用 C++ 调用时：

```
data = new _T [size]; 
```

全局内存分配的返回（例如）是 071f2ea0 但数据设置为 071f2ea4

当重载 delete [] 被调用时，会传入 071f2ea0 地址。

另一个注意事项是使用以下内容时：

```
data = new _T; 
```

从全局内存分配返回的两个数据是相同的。

我很确定微软在内存分配的头部添加了一些东西来用于簿记。我的问题是，有人知道微软使用的规则吗？

我想将“数据”的值传递给一些内存测试例程，所以我需要从全局分配调用中返回原始内存引用。

我可以假设 4 字节是一个索引，但我想确定一下。我可以很容易地成为一个标志加上偏移量，或者计数或索引到其他表中，或者只是与 CPU 的缓存行对齐。我需要确定一下。我无法找到任何参考来概述细节。

我还认为在我的其他一次运行中，偏移量是 6 个字节而不是 4 个

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T01:58:58.870

这 4 个字节很可能包含分配中的对象总数，因此 delete [] 将能够遍历数组中调用其析构函数的所有对象。

要取回原始地址，您可以保留一个以地址 / 16 为关键字的查找表，其中存储了基地址和长度。这将使您能够找到原始分配。但是，您需要确保您的分配+4 不会跨越 16 字节边界。

编辑：我继续编写了一个测试程序，该程序通过 new 使用析构函数创建 50 个对象，并调用 delete []。析构函数只是调用 printf，所以它不会被优化掉。

```
#include <stdio.h>

class MySimpleClass
{
    public:
    ~MySimpleClass() {printf("Hi\n");}
};

int main()
{
    MySimpleClass* arr = new MySimpleClass[50];
    delete [] arr;

    return 0;
} 
```

部分拆卸如下，清理后更清晰。如您所见，VC++ 将数组计数存储在最初的 4 个字节中。

```
; Allocation
mov ecx, 36h ; Size of allocation
call    scratch!operator new
test    rax,rax ; Don't write 4 bytes if NULL.
je      scratch!main+0x25
mov     dword ptr [rax],32h ; Store 50 in first 4 bytes
add     rax,4 ; Increment pointer by 4

; Free
lea     rdi,[rax-4] ; Grab previous 4 bytes of allocation
mov     ebx,dword ptr [rdi] ; Store in loop counter
jmp     StartLoop ; Jump to beginning of loop
Loop:
lea     rcx,[scratch!`string' (00000000`ffe11170)] ; 1st param to printf
call    qword ptr [scratch!_imp_printf; Destructor
StartLoop:
sub     ebx,1 ; Decrement loop counter
jns     Loop ; Loop while not negative 
```

这种簿记不同于 malloc 或 HeapAlloc 所做的簿记。那些分配器不关心对象和数组。他们只看到总大小的内存块。VC++ 不能向堆管理器查询分配的总大小，因为这意味着堆管理器必须按照您请求的大小来分配块。堆管理器不应该有这个限制——如果你要求为 20 个 12 字节的对象分配 240 个字节，它应该可以自由地返回一个它立即可用的 256 字节块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T04:18:15.777

4 个字节的偏移量用于元素的数量。当调用 delete[] 时，有必要知道元素的确切数量，以便能够为所需数量的对象调用析构函数。

由于内存分配器可能返回了比存储所有对象所需的更大的块，因此知道元素数量的唯一可靠方法是将其存储在块的开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T04:32:02.763

当然，内存分配确实需要一些与实际内存一起存储的簿记信息。

除此之外，堆分配的块也将被“装饰”一些神奇的值，用于轻松检测缓冲区溢出、双重删除……查看[这个 CodeGuru 站点](http://www.codeguru.com/cpp/w-p/win32/tutorials/article.php/c9535)以获取更多信息。如果你想知道最后的堆调试，看一下[msdn 文档](http://msdn.microsoft.com/en-us/library/974tc9t1(vs.71).aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T14:21:34.607

最终答案是：

当您执行一个`malloc`（在幕后使用新用途）时，分配的内存比系统管理内存所需的多。这个调试信息不​​是我感兴趣的。我感兴趣的是在`malloc`C++ 数组分配上使用 return 之间的区别。

我能够确定的是，有时 C++ 会添加/使用 4 个额外的字节来保持正在分配的对象的计数。扭曲的是这 4 个字节仅在分配的对象需要被破坏时才添加。

所以给出：

```
void* _cdecl operator new(size_t size)
{
    void *ptr = malloc(size);
    return(ptr); 
} 
```

对于以下情况：

```
object * data = new object [size] 
```

数据将是 ptr 加上 4 个字节（假设对象需要析构函数）

尽管：

```
char *data = new char [size] 
```

data 将等于 ptr 因为不需要析构函数。

同样，我对`malloc`用于管理内存的内存跟踪添加不感兴趣。

# c# - 不要在选择某些项目时关闭 ContextMenuStrip

> ID：866689
> 
> 赞同：14
> 
> 时间：2009-05-15T01:48:54.823
> 
> 标签：c#, .net, user-interface, contextmenustrip

选择/检查某些项目后是否可以打开 ContextMenuStrip？

我计划使用一个简单的 ContextMenuStrip 来设置过滤器（这样我可以在菜单中或作为右键单击选项使用相同的过滤器）。

菜单列出了许多项目，我希望用户能够使用基本的检查功能来选择项目。选择完成后，用户可以单击激活过滤器选项或单击菜单外部以激活或取消过滤器。

在选择/单击事件中，菜单通常会关闭。是否可以在单击事件时保持菜单打开？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2012-05-18T22:59:54.220

如果未来的程序员想知道如何做到这一点，这就是我想出来的。如果单击任何项​​目，这将不会关闭上下文菜单。创建上下文菜单条关闭事件并设置 if 语句以在关闭原因为 itemclicked 时取消关闭事件。

```
private void contextMenuStrip_Closing(object sender, ToolStripDropDownClosingEventArgs e)
{
    if (e.CloseReason == ToolStripDropDownCloseReason.ItemClicked)
        e.Cancel = true;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-24T02:42:33.133

闭幕式

设置 e.Cancel = true 使菜单保持打开状态

唯一的问题是事件不会告诉你点击了什么，所以你必须自己跟踪。在要保持菜单打开的项目的 Click 事件中设置某种标志。然后在 Closing 事件中检查标志并适当地设置 e.Cancel 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-09T10:28:27.470

要防止在单击项目时关闭上下文菜单，请执行以下操作。

在 ContextMenuItems 的 mousedown 事件上，将标志设置为 false，然后在上下文菜单的关闭事件中将其设置回 true。

例子：

```
Private blnClose As Boolean = True

Private Sub MoveUpToolStripMenuItem_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles MoveUpToolStripMenuItem.MouseDown

     blnClose = False

End Sub

Private Sub ContextMenuStrip1_Closing(ByVal sender As Object, ByVal e As System.Windows.Forms.ToolStripDropDownClosingEventArgs) Handles ContextMenuStrip1.Closing

     e.Cancel = Not blnClose
     blnClose = True

End Sub 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-07-29T13:15:29.270

我发现奇怪的是`ContextMenuStrip.Closing`事件在事件发生**之前**`ToolStripMenuItem.Click`触发。解决方案是在您拥有的地方使用`ContextMenuStrip.ItemClicked`事件`e.ClickedItem`，然后检查它是否是单击时不会关闭的项目之一`ContextMenuStrip`，并设置适当的标志。然后`ContextMenuStrip.Closing`你可以设置`e.Cancel = true;`是否也设置了标志。不过不要忘记重置标志。

```
bool isRunAtStartupClicked;
private void ContextMenuStrip_ItemClicked(object sender, ToolStripItemClickedEventArgs e)
{   
    if (e.ClickedItem == trayIcon.ContextMenuStrip.Items["miRunAtStartup"])
    {   
        isRunAtStartupClicked = true;
    }
}

private void ContextMenuStrip_Closing(object sender, ToolStripDropDownClosingEventArgs e)
{   
    if (e.CloseReason == ToolStripDropDownCloseReason.ItemClicked)
    {   
        if (isRunAtStartupClicked)
        {   
            isRunAtStartupClicked = false;
            e.Cancel = true;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T15:48:57.347

我认为 ContextMenuStrip 中没有此属性。

我们在应用程序中使用的解决方法是在 ContextMenuStrip 的单击事件上进行一些处理，然后如果我们希望上下文菜单保持打开状态，我们只需再次调用 ContextMenuStrip.Show。

如果 ContextMenuStrip 只有一个级别，这将很有效。如果有子菜单和子子菜单，那么您将不得不重新选择在单击之前打开的菜单，我不确定如何做到这一点......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-17T08:00:31.280

OnClosing，做： e.Cancel = e.CloseReason != ToolStripDropDownCloseReason.CloseCalled; 然后当你决定关闭时，调用 Close()。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-02-07T23:59:58.770

这是我的方法；它没有闪烁，而且 - 我认为 - 更灵活一些。

如果您有一组 ToolStripMenuItems 想用作切换按钮（选项开/关），试试这个：

（这`ctxWildCards`只是我的`ContextMenuStrip`，用于根据文件类型选择过滤器 - 用于搜索或 FileDialogs）

这是在 Visual Basic 中（显然！;），因此您可以通过编程方式或使用“Handles...”子句添加处理程序。

```
 Private Sub OnOffToolStripMenuItem_MouseDown(sender As System.Object, e As System.Windows.Forms.MouseEventArgs) 

    Dim t = TryCast(sender, ToolStripMenuItem)
    If Not t Is Nothing Then
        'Since you may have more On/off-Items, check to see if the Owner is the ContextMenuStrip 
        If t.Owner Is ctxWildCards Then
           ' The ContextMenuStrip will stay open on Right-click, i.e. the user can check and close by clicking 'normally'
            ctxWildCards.AutoClose = (e.Button = Windows.Forms.MouseButtons.Left)
        End If
        'Just me using a custom image for checked items.
        t.Checked = Not t.Checked
        t.Image = If(t.Checked, rdoImage, Nothing)
    End If
  End Sub

 ' On leaving ToolStripMenuItems of the ContextMenuStrip, allow it to AutoClose
  Private Sub OnOffToolStripMenuItem_MouseLeave(sender As System.Object, e As System.EventArgs)
  ctxWildCards.AutoClose = True
End Sub 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-09-30T20:08:22.393

我发现在不闪烁的情况下执行此操作的最佳方法是对 DropDown 菜单中的每个按钮使用 MouseDown 和 MouseLeave 事件。

例子：

```
Private Sub ToolStripMenuItem2_Mousedown(sender As Object, e As EventArgs) Handles ToolStripMenuItem2.MouseDown
        ΥπηρεσίεςToolStripMenuItem.DropDown.AutoClose = False
End Sub

Private Sub ToolStripMenuItem2_MouseLeave(sender As Object, e As EventArgs) Handles ToolStripMenuItem2.MouseLeave
        ΥπηρεσίεςToolStripMenuItem.DropDown.AutoClose = True
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-01-28T22:08:37.727

我发现这对我的目的很有用。

```
Private Sub CM_Closing(sender As Object, e As ToolStripDropDownClosingEventArgs) Handles CM.Closing
    If e.CloseReason = ToolStripDropDownCloseReason.ItemClicked Then
        Dim ItemClicked As String = CM.GetItemAt(New Point(Cursor.Position.X - CM.Left, Cursor.Position.Y - CM.Top)).Name
        If ItemClicked = "CMHeader" Then
            e.Cancel = True
        End If
    End If
End Sub 
```

您可以使用`ItemClicked`来读取标签或其他一些属性。

我只想要一个简单的项目，让用户清楚地知道上下文菜单将影响哪个项目。

# php - 这是调用 RSS 构建函数的正确位置吗？

> ID：866690
> 
> 赞同：-2
> 
> 时间：2009-05-15T01:50:09.080
> 
> 标签：php, mysql, html, rss, function

这是调用构建 RSS 的函数的正确位置吗？它适用于 reddit 类型的网站。

```
function save() {
    /*
            Here we do either a create or
            update operation depending
            on the value of the id field.
            Zero means create, non-zero
            update
    */

        if(!get_magic_quotes_gpc())
        {
            $this->title = addslashes($this->title);
            $this->description = addslashes($this->description);
        }

        try
        {
            $db = parent::getConnection();
            if($this->id == 0 )
            {
                $query = 'insert into articles (modified, username, url, title, description, points )';
                $query .= " values ('$this->getModified()', '$this->username', '$this->url', '$this->title', '$this->description', $this->points)";
                createRSS(); //**** rss function****
            }
            else if($this->id != 0)
            {
                $query = "update articles set modified = NOW()".", username = '$this->username', url = '$this->url', title = '".$this->title."', description = '".$this->description."', points = $this->points, ranking = $this->ranking where id = $this->id";
            }

            $lastid = parent::execSql2($query);

            if($this->id == 0 )
                $this->id = $lastid;

        }
        catch(Exception $e){
            throw $e;
        }
    } 
```

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T02:28:26.477

可能不是。有时您可能希望在不更新 RSS 提要的情况下保存文章对象——例如，您可能会在某个时候导入文章存档。因此，任何负责调用 save() 的东西都应该在之后立即调用 createRSS() 本身。

例如

```
function createArticle($title, ...) {
  $article->setTitle($title);
  ...
  $article->save();
  createRSS();
} 
```

# c - 如果您向 GetWindowLongPtr 访问的 DialogBox 类添加额外的数据空间，您是否应该添加 DLGWINDOWEXTRA 来访问这个额外的空间？

> ID：866692
> 
> 赞同：0
> 
> 时间：2009-05-15T01:51:48.140
> 
> 标签：c, winapi

创建与 DialogBox 一起使用的窗口类时，您需要在结构成员中为“系统为每个对话框所需的额外字节数”指定`DLGWINDOWEXTRA`一个`cbWndExtra`值`WNDCLASS`。如果您将自己的额外数据空间添加到要使用 访问的 DialogBox 类，`GetWindowLongPtr()`您是否应该添加`DLGWINDOWEXTRA`偏移量以访问您的额外空间？

（我承认我认为我知道答案，这样代码就不会被破坏。但是，我想确保我的理由与集体智慧相符。）

Dialogs 与它们自己的类（而不是默认类）一起使用的主要原因是允许每个 Dialog 类有自己的图标。两个单独的额外数据项也附加到每个窗口。

```
...     
wndclass.cbWndExtra  = DLGWINDOWEXTRA + EXTRASPACE;
wndclass.lpfnWndProc = (WNDPROC) DefDlgProc;
wndclass.hIcon = LoadIcon(hInstance, "ICON_MAIN");
wndclass.lpszClassName = WND_CLASS_VLIST_POPUP;
wndclass.hIconSm = LoadImage(hInstance,
                                 "ICON_MAIN",
                                 IMAGE_ICON,
                                 16,
                                 16,
                                 LR_DEFAULTCOLOR);
... 
```

实际上，问题是正确访问我想在系统所需的对话数据之外添加的其他用户数据：

```
GetWindowLongPtr(hWnd, 0 + DLGWINDOWEXTRA + SOMETHING_IN_EXTRASPACE); 
```

或者

```
GetWindowLongPtr(hWnd, 0 + SOMETHING_IN_EXTRASPACE); 
```

?

**注意：** David L Morris 的后期编辑 May-15-2009：*删除了不正确的内容`GWLP_USERDATA`并替换为 0*。`GWLP_USERDATA`调用中使用的原始问题`GetWindowLongPtr()`是接受的答案提到的原因`GWLP_USERDATA`。上面的例子最初是这样写的：

```
GetWindowLongPtr(hWnd, GWLP_USERDATA + DLGWINDOWEXTRA + SOMETHING_IN_EXTRASPACE); 
```

和

```
GetWindowLongPtr(hWnd, GWLP_USERDATA + SOMETHING_IN_EXTRASPACE); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T03:17:08.217

实际上......我认为你犯了一个错误。at 的值`GWLP_USERDATA`和分配的空间`cbWndExtra`是两个独立的东西......

该`GWLP_USERDATA`值是 Windows 为*每个*窗口分配的空间的一部分。窗口类需要一个指针大小的存储空间是很常见的，以至于 Windows 只将它与所有其他预定义的“窗口字”一起包含在窗口的基本成本中。查看`nIndex`参数的文档[`GetWindowLongPtr()`](http://msdn.microsoft.com/en-us/library/ms633585.aspx)：

> 指定要检索的值的从零开始的偏移量。有效值的范围是零到额外窗口内存的字节数减去整数的大小。

因此，`GetWindowLongPtr(hWnd, 0)`检索为`sizeof(LONG_PTR)`响应分配的第一个字节`cbWndExtra`， `GetWindowLongPtr(hWnd, sizeof(LONG_PTR))`为您提供下一个指针大小的数据，依此类推。顾名思义，`nIndex`它就像一个字节数组的索引（尽管它总是返回一个指针大小的值）。现在看一下分配给预定义窗口数据常量的索引值：它们都是负数，包括`GWLP_USERDATA`！实际上，`GetWindowLongPtr()`开始索引到窗口数据的中间，所有窗口共有的数据位于 0 索引“之前”，任何窗口类特定数据位于它之后。

对话框窗口建立在为普通窗口提供的基线支持之上。由于它们需要比普通窗口更多的数据，因此您需要`DLGWINDOWEXTRA`在`cbWndExtra`. 与任何其他此类数据一样，它是通过传递给`GetWindowLongPtr()`.

因此，当您要求

```
GetWindowLongPtr(hWnd, GWLP_USERDATA + DLGWINDOWEXTRA + 0); 
```

...您实际上是在 index 处获取数据`-21 + 30 + 0 = 9`：对话框管理器自己数据中某处的值。不是你想要的！

现在您应该意识到，当访问通过`cbWndExtra = DLGWINDOWEXTRA + extra`您分配的数据时，只需将您的请求偏移`DLGWINDOWEXTRA`. 所以：

```
GetWindowLongPtr(hWnd, DLGWINDOWEXTRA + 0); 
```

...将为您提供额外数据的第一个元素。*仅*当您希望获取或设置与每个窗口关联的始终分配的用户数据的一个指针时才`GWLP_USERDATA`应使用。

 *# c - 使用 GCC 在共享库中启用调试符号

> ID：866695
> 
> 赞同：16
> 
> 时间：2009-05-15T01:52:50.087
> 
> 标签：c, gcc, compilation, shared-libraries, debug-symbols

我正在创建一个共享库，`gcc`并怀疑共享库可能存在一些内存泄漏。要调试，我需要在创建共享库时启用调试符号。

要构建，我正在使用`gcc -g ...`（`-g`用于启用调试信息）

但是`*.so`无论. `-g`_ `-g`此外，我没有从`VALGRIND`.

谁能指出我的错误？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-15T01:57:34.973

您需要使用`-g`所有步骤（编译源文件和链接）。

# xml - XML 属性中的哪些字符无效（除非已编码）？

> ID：866706
> 
> 赞同：52
> 
> 时间：2009-05-15T02:00:19.820
> 
> 标签：xml, xml-serialization

我不敢相信我无法轻松找到这些信息，所以：

1) 哪些字符不能在没有实体编码的情况下合并到 XML 属性中？

显然，您需要对引号进行编码。`<`和怎么样`>`？还有什么？

2) 官方名单到底在哪里？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-05-15T03:45:25.637

[这是属性值中允许的内容](http://www.w3.org/TR/xml/#NT-AttValue)的定义。

```
'"' ([^<&"] | Reference)* '"'  |  "'" ([^<&'] | Reference)* "'" 
```

所以，你不能：

*   打开/关闭属性值的相同字符（*要么* `'`要么`"`）
*   一个裸 & 符号（`&`必须是`&amp;`）
*   一个左尖括号（`<`必须是`&lt;`）

您也不应该在 XML 文档的任何地方使用任何完全不合法的[字符](http://www.w3.org/TR/xml/#NT-Char)（例如表单提要等）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T02:17:24.817

根据 (2)[当前建议](http://www.w3.org/TR/2006/REC-xml11-20060816/)，特别是关于[字符数据和标记](http://www.w3.org/TR/2006/REC-xml11-20060816/#syntax)，它们是 (1) 和号 (&)、左尖括号 (<)、右尖括号 (>) 以及单引号 (') 和双引号-引用 （”）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T02:06:51.147

参见[“Extensible Markup Language (XML) 1.0 (Third Edition)”](http://www.w3.org/TR/2004/REC-xml-20040204/)中的[2.2 字符](http://www.w3.org/TR/2004/REC-xml-20040204/#charsets)。

请注意，至少对于 .NET，如果您使用 XML API 来处理 XML，那么您不必担心这一点。这就是不将 XML 视为文本的原因。

# sql - 简单数据库的 Access 与 SqlServer

> ID：866711
> 
> 赞同：4
> 
> 时间：2009-05-15T02:02:37.567
> 
> 标签：sql, sql-server, ms-access

我目前正在开发一个非常简单的数据库，用于跟踪人员及其持有的公司认证。该数据库需要将证明书存储为 PDF 文件。我被要求在 MS Access 中开发它，但我认为在 SQLServer 中构建它并使用 Windows Forms 构建界面会更好。此应用程序需要可从共享驱动器等公共位置访问。

我的问题是，像我想的那样在 SQLServer 中执行此操作会更好，还是我已经满了，而我的老板是对的？还是我们都错了？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T04:14:50.200

*我经常使用的 Access 的一个很好*的替代品是[SQL Server Compact](http://www.microsoft.com/sqlserver/2008/en/us/compact.aspx) (SqlCe)。这是与 SQL Server Express/Standard/etc 完全不同的产品。它是像 Access 一样的进程内数据库，它不作为单独的进程或服务运行。

*   这是免费的
*   完整的 ACID 支持
    *   支持多连接
    *   全面的交易支持
    *   参照完整性（包括级联更新和删除）
    *   锁定
*   T-SQL 语法和 SQL Server 数据类型（与 SQL Server 相同的 API）
*   占用空间小 (~2 MB)
*   易于部署（支持 ClickOnce、MSI、XCopy 等）
*   数据库包含在一个文件中，您可以四处移动
*   支持 ADO.NET、LINQ to SQL、LINQ to Entities。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T02:12:46.200

在不了解应用程序规模的情况下，这是一个极其困难的问题。在我看来，我不会用 33.5 英尺长的杆子接触 Access。

访问的好处：

1.  无需专用机器
2.  便携性没有问题

SQL Server 的优势

1.  更好的 SQL 合规性
2.  更好的管理控制

您打算将 PDF 文件存储在数据库中吗？如果是这样，为什么？

我选择 SQL Server。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T02:09:32.107

基于 SQL Server 构建的应用程序将比基于 MS Access 构建的应用程序更强大并支持更多用户。

建立在 MS Access 上的应用程序可以更容易调试，因为缺少服务器，缺乏重要的多用户支持，并且整个数据库位于磁盘上的单个文件中，可以轻松复制。

鉴于此，几乎在所有情况下，我都会选择 SQL Server 而不是 MS Access。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T02:46:26.370

啊，帮世界一个忙并使用 SQL 服务器。Express 版本是免费的，并且功能强大，足以满足您的要求。如果您愿意，您甚至可以继续在 Access 中进行表单/报告/UI 设计，它可以非常轻松且透明地连接到 SQL Server。

SQL 优于访问的优点：并发性、可扩展性、可靠性，更少的未来开发人员试图追捕你并杀死你。

如果我可以避免它，我几乎永远不会对数据库使用访问权限，因为 SQL Express 已经存在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T12:35:23.367

如果我是你，我会按照其他人所说的并使用 SQL Express：

[http://www.microsoft.com/express/sql/default.aspx](http://www.microsoft.com/express/sql/default.aspx)

您可以免费获得真正的 SQL 环境的所有好处！您甚至可以使用 SQL Management Studio 以及利用 Reporting Services（如果您下载了高级包）。下载链接如下：

[http://www.microsoft.com/express/sql/download/](http://www.microsoft.com/express/sql/download/)

哪个版本的 SQL Server 2008 Express 适合您？SQL Server 2008 Express 提供以下 3 个版本（每个版本都可从安装向导中获得）：

管理和管理 SQL Server 2008 Express。它还可以管理由任何版本的 SQL Server 2008（包括 Workgroup、Web、Standard 和 Enterprise）创建的 SQL Server 数据库引擎的多个实例。

注意：此单独下载专为以前安装过 SQL Server 2008 Express（仅限运行时）的客户设计。如果您是首次下载 SQL Server Express 和 SSMSE，请从安装向导下载带有工具的 SQL Server 2008 Express。

对我来说，Access 真的是一个业余爱好者工具，或者是目前还没有被淘汰的非常基本的本地项目。我肯定会考虑使用 SQL Express，而且如果您将来超越 4 GB 数据库的障碍，它会使升级变得容易得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-09T18:50:03.763

使用您最擅长的技能 - Access 非常适合各种项目，如果您知道自己在做什么，它可以很好地扩展。相反，一个糟糕的程序员可能会在 Win Forms 和 SQL Server 中开发一个应用程序并产生一个性能很差的怪物。

我个人会使用 SQL Express 和 Win Forms 或 ASP.Net 前端，因为经验表明，随着时间的推移，这些小项目可以轻松开发成比最初计划更大的应用程序，并且构建在 SQL Server 上的结构良好的数据库可以扩展如果需要，更容易为更多用户提供服务。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-15T02:12:17.170

不了解环境很难说。可能所有用户都拥有 Access，但没有桌面拥有 .NET Framework（尽管这很难相信）。也许他们所有的应用程序都在 Access 上，而这就是那里的所有开发人员和用户所知道的。

考虑到所有这些废话，您应该使用[SQL Server Express 2008](http://www.microsoft.com/express/sql/download/)和[Visual Studio 2008 Express](http://www.microsoft.com/express/default.aspx)。希望我不会让你被解雇。:)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-05-15T02:12:14.127

如果应用程序是，如您所说，一个非常简单的数据库，这正是访问的目的，创建简单的数据库。您可以在同一环境中编写数据库和应用程序表单，用户无需安装任何东西。

但要小心同时访问您的应用程序。如果您选择访问解决方案，多个用户将无法同时使用该应用程序。如果您希望发生这种情况，您将需要将数据库和应用程序分开。这并不意味着数据库必须是 SQL 服务器，如果您不需要更复杂引擎的功能，您仍然可以使用 Access 作为您的数据库。

编辑：只需阅读您计划拥有 10 个用户和少于 1000 条记录的评论。忘记 SQL Server，你会浪费你的钱。无论您决定选择简单的全访问解决方案，还是选择具有远程存储的分布式 Web 应用程序或桌面应用程序，Access 的功能都比您需要的强大数百倍。即使对于访问的“玩具式”引擎，您也没有使用其中的 1%。

# c++ - gcc 3.3.3 支持预编译头文件？

> ID：866718
> 
> 赞同：0
> 
> 时间：2009-05-15T02:06:07.543
> 
> 标签：c++, linux, gcc

gcc 3.3.3 是否支持预编译头文件？

如果是，在带有 gcc 3.3.3 的 Linux 上生成和使用预编译头文件的语法是什么。我们在 Windows 和 Linux 上交叉编译我们的项目，在 Windows 上我们预编译 stdafx.h，我正在研究如何设置它，以便它也可以在 Linux 上预编译。

我知道[gcc doc](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)，我正在寻找实际的解决方案。

在 gcc 3.3.3 我得到这个：

```
> gcc stdafx.h
gcc: compilation of header file requested 
```

最后，如果它有效，生成文件的名称是什么？

**编辑**：gcc 3.3.3 似乎不支持预编译的头文件，而在较新的 gcc 上，生成的文件以 .gch 扩展名命名。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T02:28:56.490

我不知道 gcc 从哪个版本支持它，但是对于如何使用它们，只需阅读[gcc 文档](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)即可。

无论如何，gcc 3.3.3 也很老了。也许您有机会升级到更新的 4.X 版本？那应该支持重新编译的头文件。

也许你可以试试最新的 3.X GCC (GCC 3.4.6)。我假设 ABI 中断是从 3.X 到 4.X，所以 3.4 可能是兼容的。我认为这可能值得检查。

来自[http://gcc.gnu.org/gcc-3.4/changes.html](http://gcc.gnu.org/gcc-3.4/changes.html)

> 现在支持C/Objective-C/C++预编译头文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T02:22:39.377

我不完全确定 GCC 3.3 是否支持它，但预编译头文件实际上与生成对象没有什么不同，至少在 GCC 4.x 中是这样：

```
gcc $CFLAGS header.h 
```

它会在 .h 文件旁边生成一个新的预编译头文件，并在它为`#include`d 时自动使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T09:42:27.150

我不记得 gcc 3.3.3 是否支持它。输出文件为 {filename.ext}.gch

# objective-c - 为什么我会收到错误消息？

> ID：866719
> 
> 赞同：0
> 
> 时间：2009-05-15T02:06:32.457
> 
> 标签：objective-c, cocoa, initwithstyle

为什么我会收到这些错误？ [替代文字 http://img39.imageshack.us/img39/2203/help.tif](http://img39.imageshack.us/img39/2203/help.tif)

它说：

> 错误：在不是结构或联合的情况下请求成员“jokeTableView”

这意味着什么？以及为什么会破裂。我尝试阅读有关[initWithStyle](http://developer.apple.com/iphone/library/documentation/uikit/reference/UITableViewController_Class/Reference/Reference.html#//apple_ref/occ/instm/UITableViewController/initWithStyle:)的内容，但我可以赶上它

这是我的 .h 文件：

```
#import <UIKit/UIKit.h>

 @interface TableViewController : UITableViewController {

NSMutableArray *jokes;
IBOutlet UITableView *jokeTableView; 

 } 

 @property (nonatomic, retain) NSMutableArray *jokes;

 @end 
```

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T02:13:05.997

您的对象 (TableViewController) 没有名为 jokeTableView 的属性。

为了使用特殊的点运算符访问jokeTableView，它需要是一个属性。否则，您必须使用符合 Key-Value-Coding 的方法或直接使用 -> 运算符来访问它（或者仅将其用作 ivar 并且不引用 self）：

```
jokeTableView.delegate = self; 
```

或者

```
self->jokeTableView.delegate = self; 
```

或者

```
[self jokeTableView].delegate = self; 
```

或者

```
@property (retain) UITableView *jokeTableView;
// later...
self.jokeTableView.delegate = self; 
```

但是，还要注意，您在初始化程序中设置了一个插座，这将不起作用。您必须在 -[TableViewController awakeFromNib] 方法中设置它，因为当实际调用初始化程序时 self->jokeTableView 将为 nil（这在将对象序列化到 nib 文件之前发生在 IB 中）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:14:11.183

由于您在初始化时执行此操作，因此出口应该为 NULL，因此此初始化不应该做任何事情。这应该最早在 awakeFromNib 时间完成。

# gcc - 如何在构建目标之外生成 gcc 调试符号？

> ID：866721
> 
> 赞同：195
> 
> 时间：2009-05-15T02:06:52.893
> 
> 标签：gcc, debugging, pdb-files

我知道我可以使用 -g 选项生成调试符号。但是，该符号嵌入在目标文件中。gcc 可以在结果可执行文件/库之外生成调试符号吗？就像 windows VC++ 编译器的 .pdb 文件一样。

* * *

## 回答 #1

> 赞同：203
> 
> 时间：2009-05-15T02:13:02.817

您需要使用*objcopy*来[分隔调试信息](http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/4/html/Debugging_with_gdb/separate-debug-files.html)：

```
objcopy --only-keep-debug "${tostripfile}" "${debugdir}/${debugfile}"
strip --strip-debug --strip-unneeded "${tostripfile}"
objcopy --add-gnu-debuglink="${debugdir}/${debugfile}" "${tostripfile}" 
```

我使用下面的 bash 脚本将调试信息分离到 .debug 目录中扩展名为 .debug 的文件中。这样，我可以将库和可执行文件 tar 放在一个 tar 文件中，将 .debug 目录放在另一个文件中。如果我想稍后添加调试信息，我只需提取调试 tar 文件，瞧，我有符号调试信息。

这是 bash 脚本：

```
#!/bin/bash

scriptdir=`dirname ${0}`
scriptdir=`(cd ${scriptdir}; pwd)`
scriptname=`basename ${0}`

set -e

function errorexit()
{
  errorcode=${1}
  shift
  echo $@
  exit ${errorcode}
}

function usage()
{
  echo "USAGE ${scriptname} <tostrip>"
}

tostripdir=`dirname "$1"`
tostripfile=`basename "$1"`

if [ -z ${tostripfile} ] ; then
  usage
  errorexit 0 "tostrip must be specified"
fi

cd "${tostripdir}"

debugdir=.debug
debugfile="${tostripfile}.debug"

if [ ! -d "${debugdir}" ] ; then
  echo "creating dir ${tostripdir}/${debugdir}"
  mkdir -p "${debugdir}"
fi
echo "stripping ${tostripfile}, putting debug info into ${debugfile}"
objcopy --only-keep-debug "${tostripfile}" "${debugdir}/${debugfile}"
strip --strip-debug --strip-unneeded "${tostripfile}"
objcopy --add-gnu-debuglink="${debugdir}/${debugfile}" "${tostripfile}"
chmod -x "${debugdir}/${debugfile}" 
```

* * *

## 回答 #2

> 赞同：137
> 
> 时间：2013-08-28T11:57:56.387

**使用调试信息编译：**

```
gcc -g -o main main.c 
```

**分离调试信息：**

```
objcopy --only-keep-debug main main.debug 
```

或者

```
cp main main.debug
strip --only-keep-debug main.debug 
```

**从源文件中去除调试信息：**

```
objcopy --strip-debug main 
```

或者

```
strip --strip-debug --strip-unneeded main 
```

**通过 debuglink 模式调试：**

```
objcopy --add-gnu-debuglink main.debug main
gdb main 
```

**您还可以分别使用 exec 文件和符号文件：**

```
gdb -s main.debug -e main 
```

或者

```
gdb
(gdb) exec-file main
(gdb) symbol-file main.debug 
```

**详情：**

```
(gdb) help exec-file
(gdb) help symbol-file 
```

参考：
[https ://sourceware.org/gdb/onlinedocs/gdb/Files.html#Files](https://sourceware.org/gdb/onlinedocs/gdb/Files.html#Files) [https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html](https://sourceware.org/gdb/onlinedocs/gdb/Separate-Debug-Files.html)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-12-27T20:25:14.767

注意：使用高优化级别（-O3、-O4）编译的程序不能为优化变量、内联函数和展开循环生成许多调试符号，无论符号是嵌入（-g）还是提取（objcopy）到一个'.debug' 文件。

替代方法是

1.  将版本控制（VCS、git、svn）数据嵌入程序中，用于编译器优化的可执行文件（-O3、-O4）。
2.  构建可执行文件的第二个非优化版本。

第一个选项提供了一种在以后通过完整的调试和符号重建生产代码的方法。能够在没有优化的情况下重新构建原始生产代码对调试有很大帮助。（注意：这假设测试是使用程序的优化版本完成的）。

您的构建系统可以创建一个加载了编译日期、提交和其他 VCS 详细信息的 .c 文件。这是一个“make + git”示例：

```
program: program.o version.o 

program.o: program.cpp program.h 

build_version.o: build_version.c    

build_version.c: 
    @echo "const char *build1=\"VCS: Commit: $(shell git log -1 --pretty=%H)\";" > "$@"
    @echo "const char *build2=\"VCS: Date: $(shell git log -1 --pretty=%cd)\";" >> "$@"
    @echo "const char *build3=\"VCS: Author: $(shell git log -1 --pretty="%an %ae")\";" >> "$@"
    @echo "const char *build4=\"VCS: Branch: $(shell git symbolic-ref HEAD)\";" >> "$@"
    # TODO: Add compiler options and other build details

.TEMPORARY: build_version.c 
```

程序编译后，您可以使用以下命令找到代码的原始“提交”：`strings -a my_program | grep VCS`

```
VCS: PROGRAM_NAME=my_program
VCS: Commit=190aa9cace3b12e2b58b692f068d4f5cf22b0145
VCS: BRANCH=refs/heads/PRJ123_feature_desc
VCS: AUTHOR=Joe Developer  joe.developer@somewhere.com
VCS: COMMIT_DATE=2013-12-19 
```

剩下的就是检查原始代码，重新编译而不进行优化，然后开始调试。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-15T02:17:18.967

查看[strip](http://sourceware.org/binutils/docs/binutils/strip.html)命令的“--only-keep-debug”选项。

从链接：

> 目的是将此选项与 --add-gnu-debuglink 结合使用以创建两部分可执行文件。一个是剥离的二进制文件，它将在 RAM 和分发中占用更少的空间，第二个是调试信息文件，仅在需要调试能力时才需要。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2019-11-02T23:36:57.537

到目前为止没有答案提到`eu-strip --strip-debug -f <out.debug> <input>`。

*   这是由`elfutils`包提供的。
*   结果将是该`<input>`文件已被剥离了调试符号，这些符号现在都在`<out.debug>`.

# sql - T-SQL 流程设计和执行计划（UDF 参数嗅探？）

> ID：866722
> 
> 赞同：1
> 
> 时间：2009-05-15T02:08:53.263
> 
> 标签：sql, sql-server, sql-server-2005, sql-execution-plan, parameter-sniffing

在 SQL Server 2005 上，我有一个复杂的多级分配过程，如下所示（伪 SQL）：

```
FOR EACH @LVL_NUM < @MAX_LVL:
INSERT INTO ALLOCS
SELECT 'OUT', *
FROM BALANCES(@LVL_NUM)
INNER JOIN ALLOCN_SUMRY(@LVL_NUM)

INSERT INTO ALLOCS
SELECT 'IN', *
FROM BALANCES(@LVL_NUM)
INNER JOIN ALLOCNS(@LVL_NUM)
INNER JOIN ALLOCN_SUMRY(@LVL_NUM) 
```

Where`ALLOCS`以直接分配为种子，然后`BALANCES(@LVL_NUM)`基于`ALLOCS`at `@LVL_NUM`（可能是一些直接分配加上前一级别的一些 IN 分配），并且`ALOCNS(@LVL_NUM)`基于`BALANCES(@LVL_NUM)`并且`ALOCN_SUMRY(@LVL_NUM)`仅基于`ALOCNS(@LVL_NUM)`- 有很多配置表，这些配置表指示驱动程序将分配赶出去。

这被简化了，但实际上循环中有四五对这样的对，因为有多种逻辑无法一起处理（有些情况可以一起处理）。

其基本逻辑是在特定成本中心/产品线/等（即）中获取总金额，然后根据其在特定成本中心/产品线/等中的份额（即百分比份额）将`BALANCES`其分配给另一个成本中心/产品线/等。`ALLOCNS / ALLOCN_SUMRY`公制。

在记录`OUT`保存`IN`和`SUMRY`.`ALLOCN`是一个加号！）。（现有的系统是一个怪物 C/C++/MFC/ODBC 程序，它将所有数据读入海量数组和其他数据结构中，编写得非常糟糕。）

问题似乎是，当在循环中运行时，我似乎遇到了执行计划问题，因为随着`ALLOCS`表格开始发生变化（并且一切都在变化，因为级别有不同的成本中心，所以配置被用来驱动`ALLOCNS`正在改变）。我认为我最多有 99 个级别，但最低级别从 2、4、6 开始。似乎`@LVL_NUM = 6`在 UDF 之外单独运行表现良好，但 UDF 表现不佳 - 可能是因为 UDF 有缓存计划或整体计划已经很糟糕了，因为在`ALLOCS`前面的步骤中添加了`@LVL_NUM IN (2, 4)`。

在开发早期，我设法在 30 分钟内完成了 30 个关卡，但现在我无法在 2 小时内完成前 3 个关卡。

我正在考虑在另一个 SP 中运行这两个插入并将其称为 WITH RECOMPILE，但很好奇这个 RECOMPILE 是否正确级联到 TVF UDF？任何其他建议也将不胜感激。

真实代码：

```
/****** Object:  UserDefinedFunction [MISProcess].[udf_MR_BALANCES_STAT_UNI]    Script Date: 05/14/2009 22:16:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [MISProcess].[udf_MR_BALANCES_STAT_UNI] (
     @DATA_DT_ID int
    ,@LVL_NUM int
    )
RETURNS TABLE
--    WITH SCHEMABINDING
AS 
RETURN
    (
     SELECT AB.YYMM_ID
           ,AB.BUS_UNIT_ID
           ,AB.BUS_UNIT_PROD_LINE_CD
--                   ,AB.ALOCN_SRC_CD
           ,AB.ALOCN_SRC_PROD_LINE_CD
           ,CASE WHEN ORIG_ALSRC.ALOCN_TYPE_CD = 'C'
                      AND ORIG_ALSRC.RETN_IND = 'Y' THEN AB.ORIG_ALOCN_SRC_CD
                 ELSE AB.BUS_UNIT_ID
            END AS ORIG_ALOCN_SRC_CD
           ,CASE WHEN BUPALSRC.COLLAPSE_IND = 'Y'
                 THEN BUPLNTM.ALOCN_LINE_ITEM_NUM
                 ELSE AB.LINE_ITEM_NUM
            END AS ALOCN_LINE_ITEM_NUM
           ,SUM(BUPLNTM.ALOCN_SIGN_IND * AB.ANULZD_ACTL_BAL) AS ANULZD_ACTL_BAL
     FROM   MISWork.vwMR_BALANCES AS AB
     INNER JOIN MISProcess.LKP_BUPLNTM AS BUPLNTM
            ON BUPLNTM.DATA_DT_ID = @DATA_DT_ID
               AND BUPLNTM.LINE_ITEM_NUM = AB.LINE_ITEM_NUM
               AND BUPLNTM.ALOCN_LINE_ITEM_NUM <> 0
     INNER JOIN [MISProcess].[udf_MR_ALSRC](@DATA_DT_ID, @LVL_NUM) AS BUPALSRC
            ON BUPALSRC.ALOCN_SRC_CD = AB.BUS_UNIT_ID
     INNER JOIN [MISProcess].LKP_BUPALSRC AS ORIG_ALSRC
            ON ORIG_ALSRC.DATA_DT_ID = @DATA_DT_ID
               AND ORIG_ALSRC.ALOCN_SRC_CD = AB.ORIG_ALOCN_SRC_CD
     GROUP BY AB.YYMM_ID
           ,AB.BUS_UNIT_ID
           ,AB.BUS_UNIT_PROD_LINE_CD
--                   ,AB.ALOCN_SRC_CD
           ,AB.ALOCN_SRC_PROD_LINE_CD
           ,CASE WHEN ORIG_ALSRC.ALOCN_TYPE_CD = 'C'
                      AND ORIG_ALSRC.RETN_IND = 'Y' THEN AB.ORIG_ALOCN_SRC_CD
                 ELSE AB.BUS_UNIT_ID
            END
           ,CASE WHEN BUPALSRC.COLLAPSE_IND = 'Y'
                 THEN BUPLNTM.ALOCN_LINE_ITEM_NUM
                 ELSE AB.LINE_ITEM_NUM
            END
    )

/****** Object:  UserDefinedFunction [MISProcess].[udf_MR_ALOCNS_STAT_UNI]    Script Date: 05/14/2009 22:16:16 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [MISProcess].[udf_MR_ALOCNS_STAT_UNI] (
     @DATA_DT_ID int
    ,@LVL_NUM int
    )
RETURNS TABLE
--    WITH SCHEMABINDING
AS 
RETURN
    (
     SELECT BALANCES.YYMM_ID
           ,BS.ALOCN_SRC_CD AS BUS_UNIT_ID
           ,BS.PROD_LINE_CD AS BUS_UNIT_PROD_LINE_CD
           ,BALANCES.BUS_UNIT_ID AS ALOCN_SRC_CD
           ,BALANCES.BUS_UNIT_PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
           ,BALANCES.ORIG_ALOCN_SRC_CD
           ,BALANCES.ALOCN_LINE_ITEM_NUM
           ,SUM(BS.ACCT_STATS_CNT) AS ACCT_STATS_CNT
     FROM   [MISProcess].[udf_MR_BALANCES_STAT_UNI](@DATA_DT_ID, @LVL_NUM) AS BALANCES
     INNER JOIN [MISProcess].[udf_MR_ALSRC](@DATA_DT_ID, @LVL_NUM) AS BUPALSRC
            ON BUPALSRC.ALOCN_SRC_CD = BALANCES.BUS_UNIT_ID
     INNER JOIN MISProcess.LKP_PRODLINE AS PRODLINE
            ON PRODLINE.DATA_DT_ID = @DATA_DT_ID
               AND PRODLINE.PROD_LINE_CD = BALANCES.BUS_UNIT_PROD_LINE_CD
     INNER JOIN PUASFIN.FocusResults.BS AS BS
            ON BS.YYMM_ID = BALANCES.YYMM_ID
               AND BS.ALOCN_BASE_CD = BUPALSRC.ALOCN_BASE_CD
               AND BS.ALOCN_SRC_CD <> BALANCES.BUS_UNIT_ID
               AND (
                    PRODLINE.GENRC_PROD_LINE_IND = 'Y'
                    OR BS.PROD_LINE_CD = BALANCES.BUS_UNIT_PROD_LINE_CD
                   )
     INNER JOIN [MISProcess].[udf_MR_ALSRC](@DATA_DT_ID, 0) AS DEST_BUP_ALSRC
            ON DEST_BUP_ALSRC.ALOCN_SRC_CD = BS.ALOCN_SRC_CD
               AND DEST_BUP_ALSRC.ALOCN_LVL_NUM > @LVL_NUM
     LEFT JOIN [MISProcess].[udf_MR_BLOCK_STD_COST_PCT](@DATA_DT_ID) AS BLOCK_STD_COST_PCT
            ON BLOCK_STD_COST_PCT.FROM_ALOCN_SRC_CD = BALANCES.BUS_UNIT_ID
     LEFT JOIN [MISProcess].[udf_MR_BLOCK_NOT](@DATA_DT_ID) AS BLOCK_NOT
            ON BLOCK_NOT.ALOCN_SRC_CD = BALANCES.BUS_UNIT_ID
     LEFT JOIN [MISProcess].[udf_MR_BLOCK](@DATA_DT_ID) AS BLOCK
            ON BLOCK_NOT.ALOCN_SRC_CD IS NULL
               AND BLOCK.FROM_ALOCN_SRC_CD = BALANCES.BUS_UNIT_ID
               AND (
                    BLOCK.FROM_PROD_LINE_CD IS NULL
                    OR BLOCK.FROM_PROD_LINE_CD = BALANCES.BUS_UNIT_PROD_LINE_CD
                   )
     LEFT JOIN [MISProcess].[udf_MR_BLOCK_ALOCN_PAIRS](@DATA_DT_ID, @LVL_NUM)
            AS BLOCK_ALOCN_PAIRS
            ON BLOCK_NOT.ALOCN_SRC_CD IS NOT NULL
               AND BLOCK_ALOCN_PAIRS.FROM_ALOCN_SRC_CD = BALANCES.BUS_UNIT_ID
               AND BLOCK_ALOCN_PAIRS.TO_ALOCN_SRC_CD = BS.ALOCN_SRC_CD
     WHERE  BLOCK_ALOCN_PAIRS.TO_ALOCN_SRC_CD IS NULL
            AND BLOCK_STD_COST_PCT.FROM_ALOCN_SRC_CD IS NULL
            AND (
                 BLOCK.TO_ALOCN_SRC_CD IS NULL
                 OR BLOCK.TO_ALOCN_SRC_CD = BS.ALOCN_SRC_CD
                )
            AND (
                 BLOCK.TO_PROD_LINE_CD IS NULL
                 OR BLOCK.TO_PROD_LINE_CD = BS.PROD_LINE_CD
                )
            AND (
                 BLOCK.YEAR_NUM IS NULL
                 OR BLOCK.YEAR_NUM = BALANCES.YYMM_ID / 10000
                )
            AND (
                 BLOCK.MTH_NUM IS NULL
                 OR BLOCK.MTH_NUM = (BALANCES.YYMM_ID / 100) % 100
                )
            AND (
                 BLOCK.TO_DIV_NUM IS NULL
                 OR BLOCK.TO_DIV_NUM = DEST_BUP_ALSRC.DIV_NUM
                )
            AND (
                 BLOCK.TO_GRP_NUM IS NULL
                 OR BLOCK.TO_GRP_NUM = DEST_BUP_ALSRC.DIV_GRP
                )
            AND (
                 BLOCK.TO_REGN_GRP_NM IS NULL
                 OR BLOCK.TO_REGN_GRP_NM = DEST_BUP_ALSRC.REGN_GRP_NM
                )
            AND (
                 BLOCK.TO_REGN_NM IS NULL
                 OR BLOCK.TO_REGN_NM = DEST_BUP_ALSRC.REGN_NM
                )
            AND (
                 BLOCK.TO_ARENA_NM IS NULL
                 OR BLOCK.TO_ARENA_NM = DEST_BUP_ALSRC.ARENA_NM
                )
            AND (
                 BLOCK.TO_SUB_REGN_NM IS NULL
                 OR BLOCK.TO_SUB_REGN_NM = DEST_BUP_ALSRC.SUB_REGN_NM
                )
            AND (
                 BLOCK.TO_SUB_ARENA_NM IS NULL
                 OR BLOCK.TO_SUB_ARENA_NM = DEST_BUP_ALSRC.SUB_ARENA_NM
                )
     GROUP BY BALANCES.YYMM_ID
           ,BS.ALOCN_SRC_CD
           ,BS.PROD_LINE_CD
           ,BALANCES.BUS_UNIT_ID
           ,BALANCES.BUS_UNIT_PROD_LINE_CD
           ,BALANCES.ORIG_ALOCN_SRC_CD
           ,BALANCES.ALOCN_LINE_ITEM_NUM
    )

/****** Object:  UserDefinedFunction [MISProcess].[udf_MR_ALOCN_SUMRY_STAT_UNI]    Script Date: 05/14/2009 22:16:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [MISProcess].[udf_MR_ALOCN_SUMRY_STAT_UNI] (
     @DATA_DT_ID int
    ,@LVL_NUM int
    )
RETURNS TABLE
--    WITH SCHEMABINDING
AS 
RETURN
    (
     SELECT YYMM_ID
           ,ALOCN_SRC_CD
           ,ALOCN_SRC_PROD_LINE_CD
           ,ORIG_ALOCN_SRC_CD
           ,ALOCN_LINE_ITEM_NUM
           ,SUM(ACCT_STATS_CNT) AS ACCT_STATS_CNT
     FROM   [MISProcess].[udf_MR_ALOCNS_STAT_UNI](@DATA_DT_ID, @LVL_NUM) AS ALOCNS
     GROUP BY YYMM_ID
           ,ALOCN_SRC_CD
           ,ALOCN_SRC_PROD_LINE_CD
           ,ORIG_ALOCN_SRC_CD
           ,ALOCN_LINE_ITEM_NUM
    ) 
```

这是我的测试批次，最终将在单个 SP 中运行整个过程。您可以从注释掉的部分看到我也一直在使用临时表和表变量：

```
USE PCAPFIN

DECLARE @DATA_DT_ID_use AS int
DECLARE @MinLevel AS int
DECLARE @MaxLevel AS int
DECLARE @TestEveryLevel AS bit
DECLARE @TestFinal AS bit

SET @DATA_DT_ID_use = 20090331
SET @MinLevel = 6
SET @MaxLevel = 6
SET @TestEveryLevel = 0
SET @TestFinal = 1

--DECLARE @BALANCES TABLE (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,BUS_UNIT_ID varchar(6) NOT NULL
--    ,BUS_UNIT_PROD_LINE_CD varchar(4) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ANULZD_ACTL_BAL money
--    )
--
--DECLARE @ALOCNS TABLE (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,BUS_UNIT_ID varchar(6) NOT NULL
--    ,BUS_UNIT_PROD_LINE_CD varchar(4) NOT NULL
--    ,ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ACCT_STATS_CNT money
--    )
--
--DECLARE @ALOCN_SUMRY TABLE (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ACCT_STATS_CNT money
--    )

--IF OBJECT_ID('tempdb..#BALANCES') IS NOT NULL 
--    DROP TABLE #BALANCES
--
--CREATE TABLE #BALANCES (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,BUS_UNIT_ID varchar(6) NOT NULL
--    ,BUS_UNIT_PROD_LINE_CD varchar(4) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ANULZD_ACTL_BAL money
--    ,CONSTRAINT [PK_BALANCES] PRIMARY KEY CLUSTERED ([METHOD_TXT] ASC, [YYMM_ID] ASC, [BUS_UNIT_ID] ASC, [BUS_UNIT_PROD_LINE_CD] ASC, [ALOCN_SRC_PROD_LINE_CD] ASC, [ORIG_ALOCN_SRC_CD] ASC, [ALOCN_LINE_ITEM_NUM] ASC)
--        WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF,
--              IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON,
--              ALLOW_PAGE_LOCKS = ON)
--    )
--
--IF OBJECT_ID('tempdb..#ALOCN_SUMRY') IS NOT NULL 
--    DROP TABLE #ALOCNS
--
--CREATE TABLE #ALOCNS (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,BUS_UNIT_ID varchar(6) NOT NULL
--    ,BUS_UNIT_PROD_LINE_CD varchar(4) NOT NULL
--    ,ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ACCT_STATS_CNT money
--    ,CONSTRAINT [PK_ALOCNS] PRIMARY KEY CLUSTERED ([METHOD_TXT] ASC, YYMM_ID ASC, BUS_UNIT_ID ASC, BUS_UNIT_PROD_LINE_CD ASC, ALOCN_SRC_CD ASC, ALOCN_SRC_PROD_LINE_CD ASC, ORIG_ALOCN_SRC_CD ASC, ALOCN_LINE_ITEM_NUM ASC)
--        WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF,
--              IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON,
--              ALLOW_PAGE_LOCKS = ON)
--    )
--
--IF OBJECT_ID('tempdb..#ALOCN_SUMRY') IS NOT NULL 
--    DROP TABLE #ALOCN_SUMRY
--CREATE TABLE #ALOCN_SUMRY (
--     METHOD_TXT varchar(12) NOT NULL
--    ,YYMM_ID int NOT NULL
--    ,ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_SRC_PROD_LINE_CD varchar(4) NOT NULL
--    ,ORIG_ALOCN_SRC_CD varchar(6) NOT NULL
--    ,ALOCN_LINE_ITEM_NUM int NOT NULL
--    ,ACCT_STATS_CNT money
--    ,CONSTRAINT [PK_ALOCN_SUMRY] PRIMARY KEY CLUSTERED ([METHOD_TXT] ASC, YYMM_ID ASC, ALOCN_SRC_CD ASC, ALOCN_SRC_PROD_LINE_CD ASC, ORIG_ALOCN_SRC_CD ASC, ALOCN_LINE_ITEM_NUM ASC)
--        WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF,
--              IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON,
--              ALLOW_PAGE_LOCKS = ON)
--    )

SET @MinLevel = (
                 SELECT MIN(BUPALSRC.ALOCN_LVL_NUM)
                 FROM   MISProcess.LKP_BUPALSRC AS BUPALSRC
                 WHERE  BUPALSRC.DATA_DT_ID = @DATA_DT_ID_use
                        AND BUPALSRC.ALOCN_LVL_NUM >= @MinLevel
                )

DECLARE @Restart AS bit
IF @MinLevel > (
                SELECT  MIN(BUPALSRC.ALOCN_LVL_NUM)
                FROM    MISProcess.LKP_BUPALSRC AS BUPALSRC
                WHERE   BUPALSRC.DATA_DT_ID = @DATA_DT_ID_use
               ) 
    SET @Restart = 0
ELSE 
    SET @Restart = 1

DECLARE @subset_criteria AS varchar(max)

SET NOCOUNT ON

IF @Restart = 1 
    BEGIN
        RAISERROR ('Restarting process', 10, 1) WITH NOWAIT
--        TRUNCATE TABLE MISWork.AB
        DELETE FROM MISWork.AB

        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD
                ,ORIG_ALOCN_SRC_CD
                ,LINE_ITEM_NUM
                ,BAL_ORIGTN_IND
                ,ANULZD_ACTL_BAL
                ,ACCT_STATS_CNT
                ,LVL_NUM
                ,METHOD_TXT
                )
                SELECT  YYMM_ID
                       ,ALOCN_SRC_CD AS BUS_UNIT_ID
                       ,PROD_LINE_CD AS BUS_UNIT_PROD_LINE_CD
                       ,ALOCN_SRC_CD
                       ,PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
                       ,ALOCN_SRC_CD AS ORIG_ALOCN_SRC_CD
                       ,LINE_ITEM_NUM
                       ,'D' AS BAL_ORIGTN_IND
                       ,FIN_ALOCN_AMT AS ANULZD_ACTL_BAL
                       ,0.0 AS ACCT_STATS_CNT
                       ,0 AS LVL_NUM
                       ,'D-INIT' AS METHOD_TXT
    --        FROM    MISProcess.FIN_FTP
                FROM    PUASFIN.FocusResults.BUPALLGE
    END
ELSE 
    BEGIN
        DELETE  FROM MISWork.AB
        WHERE   LVL_NUM >= @MinLevel
    END

DECLARE @LVL_NUM AS int
SET @LVL_NUM = @MinLevel
WHILE @LVL_NUM <= @MaxLevel
    BEGIN
        DECLARE @LevelStart AS varchar(50)
        SET @LevelStart = 'Level:' + CONVERT(varchar, @LVL_NUM)
        RAISERROR (@LevelStart, 10, 1) WITH NOWAIT

        RAISERROR ('STD_COST_PCT allocations - No D - B records', 10, 1) WITH NOWAIT
        -- STD_COST_PCT allocations - No D - B records
        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD
                ,ORIG_ALOCN_SRC_CD
                ,LINE_ITEM_NUM
                ,BAL_ORIGTN_IND
                ,ANULZD_ACTL_BAL
                ,ACCT_STATS_CNT
                ,LVL_NUM
                ,METHOD_TXT
                )
                SELECT  ALOCNS.YYMM_ID
                       ,ALOCNS.BUS_UNIT_ID
                       ,ALOCNS.BUS_UNIT_PROD_LINE_CD
                       ,ALOCNS.BUS_UNIT_ID AS ALOCN_SRC_CD
                       ,ALOCNS.BUS_UNIT_PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
                       ,ALOCNS.BUS_UNIT_ID AS ORIG_ALOCN_SRC_CD
                       ,ALOCNS.LINE_ITEM_NUM
                       ,'B' AS BAL_ORIGTN_IND
                       ,-1.0 * ROUND(ALOCNS.ANULZD_ACTL_BAL, 2) AS ANULZD_ACTL_BAL
                       ,ROUND(ALOCNS.ACCT_STATS_CNT, 2) AS ACCT_STATS_CNT
                       ,@LVL_NUM AS LVL_NUM
                       ,'NO-D-B' AS METHOD_TXT
                FROM    [MISProcess].[udf_MR_ALOCNS_STD_COST_PCT_NO_D](@DATA_DT_ID_use, @LVL_NUM)
                        AS ALOCNS

        RAISERROR ('STD_COST_PCT allocations - No D - A records', 10, 1) WITH NOWAIT
        -- STD_COST_PCT allocations - No D - A records
        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD
                ,ORIG_ALOCN_SRC_CD
                ,LINE_ITEM_NUM
                ,BAL_ORIGTN_IND
                ,ANULZD_ACTL_BAL
                ,ACCT_STATS_CNT
                ,LVL_NUM
                ,METHOD_TXT
                )
                SELECT  ALOCNS.YYMM_ID
                       ,BLOCK.TO_ALOCN_SRC_CD AS BUS_UNIT_ID
                       ,ALOCNS.ALOCN_SRC_PROD_LINE_CD AS BUS_UNIT_PROD_LINE_CD
                       ,ALOCNS.ALOCN_SRC_CD
                       ,ALOCNS.BUS_UNIT_PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
                       ,ALOCNS.ORIG_ALOCN_SRC_CD
                       ,ALOCNS.LINE_ITEM_NUM
                       ,'A' AS BAL_ORIGTN_IND
                       ,ROUND(ALOCNS.ANULZD_ACTL_BAL, 2) AS ANULZD_ACTL_BAL
                       ,ROUND(ALOCNS.ACCT_STATS_CNT, 2) AS ACCT_STATS_CNT
                       ,@LVL_NUM AS LVL_NUM
                       ,'NO-D-A' AS METHOD_TXT
                FROM    [MISProcess].[udf_MR_ALOCNS_STD_COST_PCT_NO_D](@DATA_DT_ID_use, @LVL_NUM)
                        AS ALOCNS
                INNER JOIN MISProcess.LKP_BLOCK AS BLOCK
                        -- TODO: Can this be moved into the udf above?
                            ON BLOCK.DATA_DT_ID = @DATA_DT_ID_use
                               AND BLOCK.FROM_ALOCN_SRC_CD = ALOCNS.BUS_UNIT_ID

        RAISERROR ('STD_COST_PCT allocations - B records', 10, 1) WITH NOWAIT

        -- STD_COST_PCT allocations - B records
        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD
                ,ORIG_ALOCN_SRC_CD
                ,LINE_ITEM_NUM
                ,BAL_ORIGTN_IND
                ,ANULZD_ACTL_BAL
                ,ACCT_STATS_CNT
                ,LVL_NUM
                ,METHOD_TXT
                )
                SELECT  ALOCNS.YYMM_ID
                       ,ALOCNS.BUS_UNIT_ID
                       ,ALOCNS.BUS_UNIT_PROD_LINE_CD
                       ,ALOCNS.ALOCN_SRC_CD
                       ,ALOCNS.BUS_UNIT_PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
                       ,ALOCNS.ORIG_ALOCN_SRC_CD
                       ,ALOCNS.LINE_ITEM_NUM
                       ,'B' AS BAL_ORIGTN_IND
                       ,-1.0 * ROUND(ALOCNS.ANULZD_ACTL_BAL * RATIOS.RATIO, 2) AS ANULZD_ACTL_BAL
                       ,ROUND(ALOCNS.ACCT_STATS_CNT, 2) AS ACCT_STATS_CNT
                       ,@LVL_NUM AS LVL_NUM
                       ,'STD-B' AS METHOD_TXT
                FROM    [MISProcess].[udf_MR_ALOCNS_STD_COST_PCT](@DATA_DT_ID_use, @LVL_NUM)
                        AS ALOCNS
                INNER JOIN [MISProcess].[udf_MR_RATIOS_STD_COST_PCT](@DATA_DT_ID_use, @LVL_NUM)
                        AS RATIOS
                        ON RATIOS.YYMM_ID = ALOCNS.YYMM_ID
                           AND RATIOS.BUS_UNIT_ID = ALOCNS.BUS_UNIT_ID
                           AND RATIOS.LINE_ITEM_NUM = ALOCNS.LINE_ITEM_NUM

        RAISERROR ('STD_COST_PCT allocations - A records', 10, 1) WITH NOWAIT

        -- STD_COST_PCT allocations - A records
        ;
        WITH    CORRECTED_ALOCNS
                  AS (
                      SELECT    ALOCNS.YYMM_ID
                               ,ALOCNS.BUS_UNIT_ID
                               ,ALOCNS.BUS_UNIT_PROD_LINE_CD
                               ,ALOCNS.ALOCN_SRC_CD
                               ,ALOCNS.ALOCN_SRC_PROD_LINE_CD
                               ,ALOCNS.ORIG_ALOCN_SRC_CD
                               ,ALOCNS.LINE_ITEM_NUM
                               ,ALOCNS.ANULZD_ACTL_BAL * RATIOS.RATIO AS ANULZD_ACTL_BAL
                               ,CASE WHEN RATIOS.RATIO <> 1.0
                                     THEN RATIOS.RATIO
                                     ELSE ALOCNS.ACCT_STATS_CNT
                                END AS ACCT_STATS_CNT
                      FROM      [MISProcess].[udf_MR_CORR_ALOCNS_STD_COST_PCT](@DATA_DT_ID_use, @LVL_NUM)
                                AS ALOCNS
                      INNER JOIN [MISProcess].[udf_MR_RATIOS_STD_COST_PCT](@DATA_DT_ID_use, @LVL_NUM)
                                AS RATIOS
                                ON RATIOS.YYMM_ID = ALOCNS.YYMM_ID
                                   AND RATIOS.BUS_UNIT_ID = ALOCNS.ALOCN_SRC_CD
                                   AND RATIOS.LINE_ITEM_NUM = ALOCNS.LINE_ITEM_NUM
                     ),
                ROUNDED_ALOCNS
                  AS (
                      SELECT    YYMM_ID
                               ,BUS_UNIT_ID
                               ,BUS_UNIT_PROD_LINE_CD
                               ,ALOCN_SRC_CD
                               ,ALOCN_SRC_PROD_LINE_CD
                               ,ORIG_ALOCN_SRC_CD
                               ,LINE_ITEM_NUM
                               ,CASE WHEN ABS(ANULZD_ACTL_BAL) < 0.05 THEN 0.0
                                     WHEN ABS(ANULZD_ACTL_BAL) > 0.05
                                          AND ABS(ANULZD_ACTL_BAL) < 0.10
                                     THEN 0.10 * SIGN(ANULZD_ACTL_BAL)
                                     ELSE ANULZD_ACTL_BAL
                                END AS ANULZD_ACTL_BAL
                               ,ACCT_STATS_CNT
                      FROM      CORRECTED_ALOCNS
                     )
            INSERT  INTO MISWork.AB (
                     YYMM_ID
                    ,BUS_UNIT_ID
                    ,BUS_UNIT_PROD_LINE_CD
                    ,ALOCN_SRC_CD
                    ,ALOCN_SRC_PROD_LINE_CD
                    ,ORIG_ALOCN_SRC_CD
                    ,LINE_ITEM_NUM
                    ,BAL_ORIGTN_IND
                    ,ANULZD_ACTL_BAL
                    ,ACCT_STATS_CNT
                    ,LVL_NUM
                    ,METHOD_TXT
                    )
                    SELECT  YYMM_ID
                           ,BUS_UNIT_ID
                           ,BUS_UNIT_PROD_LINE_CD
                           ,ALOCN_SRC_CD
                           ,ALOCN_SRC_PROD_LINE_CD
                           ,ORIG_ALOCN_SRC_CD
                           ,LINE_ITEM_NUM
                           ,'A' AS BAL_ORIGTN_IND
                           ,ROUND(ANULZD_ACTL_BAL, 2) AS ANULZD_ACTL_BAL
                           ,ROUND(ACCT_STATS_CNT, 2) AS ACCT_STATS_CNT
                           ,@LVL_NUM AS LVL_NUM
                           ,'STD-A' AS METHOD_TXT
                    FROM    ROUNDED_ALOCNS
                    WHERE   ANULZD_ACTL_BAL <> 0.0
                            OR ACCT_STATS_CNT <> 0.0

        RAISERROR ('COLLAPSE, BLOCK 100 ALOCN_PCT - B records', 10, 1) WITH NOWAIT

        -- COLLAPSE, BLOCK 100% ALOCN_PCT - B records
        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD
                ,ORIG_ALOCN_SRC_CD
                ,LINE_ITEM_NUM
                ,BAL_ORIGTN_IND
                ,ANULZD_ACTL_BAL
                ,ACCT_STATS_CNT
                ,LVL_NUM
                ,METHOD_TXT
                )
                SELECT  BALANCES.YYMM_ID
                       ,BALANCES.BUS_UNIT_ID
                       ,BALANCES.BUS_UNIT_PROD_LINE_CD
                       ,BALANCES.BUS_UNIT_ID AS ALOCN_SRC_CD
                       ,BALANCES.BUS_UNIT_PROD_LINE_CD AS ALOCN_SRC_PROD_LINE_CD
                       ,BALANCES.ORIG_ALOCN_SRC_CD
                       ,BALANCES.ALOCN_LINE_ITEM_NUM AS LINE_ITEM_NUM
                       ,'B' AS BAL_ORIGTN_IND
                       ,-1.0 * BALANCES.ANULZD_ACTL_BAL
                       ,ALOCN_SUMRY.ACCT_STATS_CNT
                       ,@LVL_NUM AS LVL_NUM
                       ,'BLOCK-100' AS METHOD_TXT
                FROM    [MISProcess].[udf_MR_BALANCES_BLOCK_100_PCT](@DATA_DT_ID_use, @LVL_NUM)
                        AS BALANCES
                INNER JOIN [MISProcess].[udf_MR_ALOCN_SUMRY_BLOCK_100_PCT](@DATA_DT_ID_use, @LVL_NUM)
                        AS ALOCN_SUMRY
                        ON ALOCN_SUMRY.YYMM_ID = BALANCES.YYMM_ID
                           AND ALOCN_SUMRY.BUS_UNIT_ID = BALANCES.BUS_UNIT_ID
                           AND ALOCN_SUMRY.BUS_UNIT_PROD_LINE_CD = BALANCES.BUS_UNIT_PROD_LINE_CD
                           AND ALOCN_SUMRY.ALOCN_SRC_CD = BALANCES.ALOCN_SRC_CD
                           AND ALOCN_SUMRY.ALOCN_SRC_PROD_LINE_CD = BALANCES.ALOCN_SRC_PROD_LINE_CD
                           AND ALOCN_SUMRY.ORIG_ALOCN_SRC_CD = BALANCES.ORIG_ALOCN_SRC_CD

        RAISERROR ('COLLAPSE, BLOCK 100 ALOCN_PCT - A records', 10, 1) WITH NOWAIT

        -- COLLAPSE, BLOCK 100% ALOCN_PCT - A records
        INSERT  INTO MISWork.AB (
                 YYMM_ID
                ,BUS_UNIT_ID
                ,BUS_UNIT_PROD_LINE_CD
                ,ALOCN_SRC_CD
                ,ALOCN_SRC_PROD_LINE_CD 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:28:03.427

是的，重新编译应该扩展到 TV UDFS。

但是，我会使用参数掩码而不是 RECOMPILE。

1.  使用这样的查询，编译会很昂贵
2.  当 UDF 未嵌套时，参数掩码也将应用。TV UDF 没有这样的计划：它们是调用查询的一部分，因为它们是非嵌套的。

您可以将一些 UDF 调用分解为临时表，然后加入临时表吗？我敢打赌，当 UDF 未嵌套时，查询太复杂而无法有效运行。优化者可能需要一周的时间才能找到包含如此复杂事物的理想计划。使用临时表（不是表变量），我想你会得到可观的改进。

我自己在一些更大的查询中使用了这种技术（为金融工具生成定价树）

你 150,000 行的事实被我认为的绝对复杂性所掩盖。

**编辑**：

TVF 不需要参数屏蔽，因为它们只是宏。您可以从字面上用 CTE 或派生表替换它。

在这里查看我的答案：[查询计划优化器是否适用于连接/过滤的表值函数](https://stackoverflow.com/questions/311026/does-query-plan-optimizer-works-well-with-joined-filtered-table-valued-functions/311163#311163) 和[Tony Rogerson on Views](http://sqlblogcasts.com/blogs/tonyrogerson/archive/2008/01/03/views-they-offer-no-optimisation-benefits-they-are-simply-inline-macros-use-sparingly.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T02:50:34.050

使用表值函数（尤其是多语句表值函数）要注意的一件事是生成的表，就像表变量一样，没有列统计信息和索引。

我倾向于谨慎使用 TVF。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T03:11:18.150

你能发布实际的 T-SQL 而不是伪 SQL 吗？您所描述的听起来像是随着@LVL_NUM 的增加而对越来越大的结果集进行表扫描，并且可能 RECOMPILE 在那里无济于事。但是，基于伪SQL，除了伪猜测之外真的很难给出任何东西......

# c# - C# INotifyPropertyChanged 动态创建对象的属性？

> ID：866725
> 
> 赞同：2
> 
> 时间：2009-05-15T02:10:15.257
> 
> 标签：c#, linq, reflection, dynamic

（更新）ICustomTypeDescriptor 适用于我的 Windows 窗体应用程序，但不适用于 Silverlight；不支持。不过，我会继续研究这个想法，看看我能到达哪里。（/更新）

我有，说几个开关面板（对于那些喜欢类比的人）。这些开关面板中的每一个都具有名称（字符串）可以处于开或关状态（布尔）的开关。开关面板和开关是具有 INotify 接口的对象。

使用开关名称，我在集合上创建了所有可能的开关名称的列表，并创建了一个具有所有这些名称作为属性的动态类。

```
SwitchPanel1 (Switches( Switch1 ("Main",On) , Switch2("Slave",Off)))
SwitchPanel2 (Switches( Switch1 ("Bilge",On) , Switch2("Main",Off))) 
```

产生一个集合

```
(Main,Bilge,Slave) 
```

并生成具有以下属性的动态类：

```
SwitchPanel : (SwitchPanel)
Main : (Switch)
Bilge : (Switch)
Slave: (Switch) 
```

这个想法是，如果开关面板有一个带有属性名称的开关，它将被放置在该属性上。所以使用一点 linq

```
propeties["Main"].SetValue(newSwitchType,SwitchPanel.Switches.FirstOrDefault(sw => sw.Name == "Main")); 
```

我想将这个新的动态类转换为 INotfyPropertyChanged 并捕获这些新属性的实际更改，因此如果开关更改状态，动态对象将报告它。

为什么？它需要显示在列表视图中，并且我正在使用的列表视图通过提供属性名称而不是绑定路径来绑定。

它还尝试通过将对象强制转换为 INotifyPropertyChanged 来捕获 INotify 事件。这意味着它会在事情发生变化时进行排序和/或分组。

如果您知道更好的方法来做到这一点，请告诉我。请。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T06:11:32.367

您可能不需要动态类。您可以通过`ICustomTypeDescriptor`/实现运行时绑定属性`GetProperties()`，创建您自己`PropertyDescriptor`的返回命名开关的实现。目前尚不清楚什么首先知道更改，但您可以使用`INotifyPropertyChanged`或旧的特定于属性的更改事件，再次绑定到每个属性（因此每个都`PropertyDescriptor`附加到，例如，命名开关中的事件。

不是微不足道的，但也不是不可能的。

# c++ - 查找唯一字符串的内存高效方法

> ID：866730
> 
> 赞同：1
> 
> 时间：2009-05-15T02:13:01.427
> 
> 标签：c++, algorithm, string, data-structures

我有一个如下所示的数据集：

```
000 100 200 300 010 020 030 001 002 003     
001 101 201 301 011 021 031 000 002 003    
002 102 202 302 012 022 032 001 000 003    
003 103 203 303 013 023 033 001 002 000    
010 110 210 310 000 020 030 011 012 013     
020 120 220 320 010 000 030 021 022 023     
030 130 230 330 010 020 000 031 032 033     
033 133 233 333 013 023 003 031 032 030     
100 000 200 300 110 120 130 101 102 103     
133 033 233 333 113 123 103 131 132 130     
200 100 000 300 210 220 230 201 202 203     
233 133 033 333 213 223 203 231 232 230     
300 100 200 000 310 320 330 301 302 303     
303 103 203 003 313 323 333 301 302 300     
313 113 213 013 303 323 333 311 312 310     
330 130 230 030 310 320 300 331 332 333    
331 131 231 031 311 321 301 330 332 333    
332 132 232 032 312 322 302 331 330 333    
333 133 233 033 313 323 303 331 332 330 
```

我打算做的是从中生成唯一字符串列表，产生：

```
000
001
002
003                      
010
011
012
013
020
021
022
023
030
031
032
033
100
101
102
103
110
113
120
123
130
131
132
133
200
201
202
203
210
213
220
223
230
231
232
233
300
301
302
303
310
311
312
313
320
321
322                      
323
330
331      
332      
333 
```

我必须生成的代码就是这个。但它非常消耗内存。因为实际上字符串的长度 > 36 并且文件中有超过 3500 万行。每行具有> 36 * 3的列/条目数。有没有一种内存有效的方法来做到这一点？

```
#include <iostream>
#include <vector>
#include <fstream>
#include <sstream>
#include <map>
using namespace std;

int main  ( int arg_count, char *arg_vec[] ) {
    if (arg_count !=2 ) {
        cerr << "expected one argument" << endl;
        return EXIT_FAILURE;      
    }

    string line;
    ifstream myfile (arg_vec[1]);

     map <string,int> Tags;    

    if (myfile.is_open())
    {
        while (getline(myfile,line) )
        {
            stringstream ss(line);    
            string Elem;

            while (ss >> Elem) {      

                Tags[Elem] = 1;           

            }

        }
        myfile.close();  
    }
    else { cout << "Unable to open file";} 

   for (map <string,int>::iterator iter = Tags.begin(); iter !=
           Tags.end();iter++) {      
       cout << (*iter).first << endl; 
   }

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T02:30:22.213

这在一定程度上取决于数据集的特征。在更糟糕的情况下，所有字符串都是唯一的，您将需要 O(n) 内存来记录您的所见集，或者需要 O(n^2) 时间来重新扫描每个单词的整个文件。但是，可以进行一些改进。

首先，如果您的数据集仅包含 3 位整数，那么 1000 个布尔值的简单数组将比地图更节省内存。

如果您使用的是一般数据，那么另一种好方法是对集合进行排序，因此相同字符串的副本最终相邻，然后只需删除相邻的单词。有一些经过深入研究的算法可以[对太大而无法放入内存的数据集进行排序](http://en.wikipedia.org/wiki/External_sorting)。当集合中的大部分单词是唯一的时，这是最有效的，因此在内存中保存一组看到的单词非常昂贵。

顺便说一句，这可以通过 shell 管道轻松实现，因为 GNU sort 为您执行外部排序：

```
tr " " "\n" < testdata | LC_ALL=C sort | uniq 
```

将 LC_ALL=C 传递给排序会禁用语言环境处理和多字节字符集支持，这可以显着提高速度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T02:22:10.610

**O(1) 内存 [ram]：**

如果您根本不想使用内存（除了几个临时变量），您可以一次读取 1 个条目，如果输出文件中不存在该条目，则将其添加到输出文件中。不过，这会在时间上变慢，因为您必须一次从输出文件中读取 1 个条目。

不过，您可以按字母顺序将条目插入到输出文件中，然后您将能够通过对插入的每个条目的二进制搜索，在 O(logn) 时间内查看该条目是否已经存在。要实际插入，您需要重新创建 O(nlogn) 的文件。您对每个输入字符串执行 n 次，因此总体而言该算法将在 O(n^2logn) 中运行（其中包括查找插入位置 + 插入的查找）并使用 O(1) RAM 内存。

由于您的输出文件已经按字母顺序排列，尽管未来的查找也只能通过二进制搜索 O(logn)。

您还可以通过在文件中的条目之间留出过多的空间来最小化文件的重新创建阶段。算法完成后，您可以对文件进行真空处理。这会将其降低到 O(nlogn)。

* * *

**另一种减少内存的方法：**

如果您的字符串共享公共前缀很常见，那么您可以使用[trie](http://en.wikipedia.org/wiki/Trie)并且可能总体上使用更少的内存，因为您提到您的字符串 > 长度 36。但这仍然会使用大量内存。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T02:27:27.103

好吧，std::set 可能比 std::map 稍微快一点并且使用更少的内存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T03:55:11.963

考虑到大量条目，符号序列中似乎会有合理数量的重叠。您可以使用每个序列的每个位置的条目作为节点来构建树。假设您有一个条目 12345 和 12346，那么序列中的前四个条目重叠，因此可以存储在具有 6 个节点的树中。

您可以遍历树以查看给定符号是否包含在给定位置，如果没有，您将添加它。当您到达给定字符串的末尾时，您只需将该节点标记为终止字符串节点。复制唯一条目将是深度优先遍历树的问题，从根节点到每个终止符的路径代表一个唯一条目。

如果你对数据集进行分区，比如分成 X 千行块并聚合树，这将是一个很好的 map-reduce 工作。

您正在查看 10^36 的节点空间，因此如果数据是完全随机的，您正在查看大量可能的节点。如果有大量重叠且唯一条目数量较少，您可能会发现您使用较少

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T07:22:06.473

我建议的解决方案是使用内存映射文件来访问数据并使用基数排序来对列表进行排序。如果字符串长度相同，这很简单。如果字符串的长度不同，请使用基数排序使用前 n 个字符进行快速预排序，然后使用最合适的任何方法对未排序的子列表进行排序。对于非常短的子列表，一个简单的冒泡排序就可以了。对于较长的列表，请使用快速排序或使用带有提供比较运算符的自定义类的 STL 集。

使用内存映射和基数排序，内存需求和性能将是最佳的。您所需要的只是映射空间（~文件大小）和一个 32 位值表，每个字符串一个值来保存基数排序的链表。

您还可以通过使用更紧凑的字符串编码来节省内存并加快排序速度。一个简单的编码将使用每个字符 2 位，使用值 1,2 和 3 表示三个字母，使用 0 表示字符串的结束。或者更高效，使用 base 3 编码，打包成整数并在前面编码字符串的长度。假设您有字符 c1、c2、C3、c4，编码将产生整数 c1*3^3 + c2*3^2 + c3*3^1 + c4*3^0。这假设您为每个字符分配一个从 0 到 2 的值。通过使用这种编码，如果要排序的字符串数量很大，您将节省内存并优化排序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-14T11:18:36.407

You can look at the excellent library [Judy arrays](http://judy.sourceforge.net/). A compact trie based, very fast and memory efficient data structure witch scale to billons strings. Better than any search-tree. You can use the JudySL functions to your purpose. You can use it similar to your program, but it is much faster and more memory efficient.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T02:22:43.290

您可能只需为它编写一个就地排序。不过，您仍然必须将文件加载到内存中，因为使用 IO 进行就地排序效率不高。每次比较都必须阅读和写作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-15T02:31:55.220

`std::set`会更好，但你应该看看散列集。这些在当前的 C++ 标准库中不可用（尽管它应该在 C++0x 中），但一些编译器有实现。Visual C++ 有[stdext::hash_set](http://msdn.microsoft.com/en-us/library/1t4xas78(VS.80).aspx)和 boost 对此有一些东西，请参阅[Boost Multi-index Containers Library](http://www.boost.org/doc/libs/1_39_0/libs/multi_index/doc/index.html)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-15T06:15:47.973

尝试将 STXXL 作为大型数据集的外部 stl。

# c++ - 监控 windows mobile 上的存储空间

> ID：866733
> 
> 赞同：0
> 
> 时间：2009-05-15T02:13:13.470
> 
> 标签：c++, windows-mobile, storage

在本机（c++）Windows 移动应用程序中。有一些方法可以通知内存`WM_HIBERNATE`不足和低功耗`RequestPowerNotifications()`。

当存储空间不足时，有什么方法可以通知？还是应用程序必须定期轮询`GetDiskFreeSpaceEx()`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T12:17:57.760

不，没有存储空间的系统通知。

# css - IE7 CSS Float导致打印时内容溢出

> ID：866735
> 
> 赞同：2
> 
> 时间：2009-05-15T02:14:51.937
> 
> 标签：css, internet-explorer-7, printing

尝试在 IE7（或 IE8 兼容模式）下打印以下网页时，某些内容（底部两个问题）被截断。您可以在打印预览中查看问题。

[http://www.testdesigner.com/tests/print.jsp?testId=4097](http://www.testdesigner.com/tests/print.jsp?testId=4097)

删除以下 css 块中的浮点数`printTestTwoColumns.css`将解决问题，但也会删除双列格式。

```
.question {
    float: left;
    width: 44%;
    padding: 0;
    margin-right: 0;
} 
```

需要注意的是，上面 URL 中的 HTML 是动态生成的，所有类型的内容都存在问题，包括纯文本（无图像）。内容总是溢出页面。

没有将标记更改为基于表格的布局，有没有人有可能的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-19T02:40:05.633

尝试添加一个打印样式表，该样式表使用更简单的布局，专为在纸上进行窄幅打印而设计。你可能根本不需要任何花车。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T10:09:12.610

即使您声明 padding:0，使用 FLOAT IE 也会添加额外的 10PX 填充。

尝试添加 display:inline 即

```
.question { float: left; width: 44%; padding: 0; margin-right: 0; display:inline } 
```

希望这可以帮助。

# python - 创建一个新的终端/shell窗口来简单地显示文本

> ID：866737
> 
> 赞同：1
> 
> 时间：2009-05-15T02:16:21.480
> 
> 标签：python, shell

我想通过管道 [edit: real-time text] 将几个子进程（有时是链接的，有时是并行的）的输出传送到不是活动 python shell 的单个终端/tty 窗口（无论是 IDE、命令行还是使用 tkinter 运行脚本）。IPython 不是一个选项。我需要标准安装附带的东西。更喜欢与操作系统无关的解决方案，但需要在 XP/Vista 上工作。

如果您愿意，我会发布我已经尝试过的内容，但这很尴尬。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T03:01:20.813

Unix 中一个好的解决方案是命名管道。我知道您询问过 Windows，但 Windows 中可能有类似的方法，或者这可能对其他人有帮助。

在 1 号航站楼：

```
mkfifo /tmp/display_data
myapp >> /tmp/display_data 
```

在终端 2（bash）上：

```
tail -f /tmp/display_data 
```

**编辑**：*将终端 2 命令更改为使用“tail -f”而不是无限循环。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T02:27:00.380

您说“管道”，所以我假设您正在处理子流程的文本输出。一个简单的解决方案可能是将输出写入文件？

例如在子流程中：

1.  重定向输出`%TEMP%\output.txt`
2.  退出时，复制`output.txt`到您的主进程正在监视的目录。

在主要过程中：

1.  每秒检查目录中的新文件。
2.  找到文件后，处理并删除它们。

您可以在输出文件名中对子进程名称进行编码，以便知道如何处理它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T09:40:15.680

您可以创建一个生产者-客户系统，将线路插入到一个套接字上（这里没什么特别的）。客户将是一个多线程套接字服务器，侦听连接并将所有行放入**[Queue](http://docs.python.org/library/queue.html)**中。在单独的线程中，它将从队列中获取项目并将其打印在控制台上。该程序可以从 cmd 控制台或 eclipse 控制台作为外部工具运行，没有太多麻烦。

从您的角度来看，它应该是实时的。作为奖励，您可以将生产者和客户放在不同的盒子上。生产者甚至可以形成一个网络。

可以在[此处](http://docs.python.org/library/socket.html#example)找到一些使用 python 进行套接字编程的示例。[在此处](http://ilab.cs.byu.edu/python/socket/echoserver.html)查找tcp echoserver 示例，并[在此处](http://floppsie.comp.glam.ac.uk/Glamorgan/gaius/wireless/5.html)查找 tcp "hello world" 套接字客户端。

还有一个 Windows 扩展，可以使用命名管道。

在 linux 上（可能是 cygwin？）你可以*tail -f named-fifo*。

祝你好运！

# .net - 我可以使用 ODBC 获取插入行的主键吗？

> ID：866743
> 
> 赞同：1
> 
> 时间：2009-05-15T02:21:59.627
> 
> 标签：.net, sql, odbc

在 .NET 中使用 ODBC 对象时，检索插入行的主键的最佳方法是什么？

例如（VB）：

```
Dim command As OdbcCommand = gOdbcConn.CreateCommand()
command.CommandText("INSERT INTO auhinode (node_key, node_desc) VALUES (0, 'New Node')")
...
Dim result As Integer = command.ExecuteNonQuery() 
```

[我在这里](https://stackoverflow.com/questions/345865/getting-primary-key-after-an-insert-in-asp-net-visual-basic)看到了其他一些建议，但我想知道是否有特定于 ODBC 对象的解决方案？

**编辑：**我们使用 ODBC 的原因是因为我们支持 3 种不同的数据库 - SQL Server、Oracle、Informix。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T05:58:29.747

您不会找到一种适用于所有 3 db 引擎的方法。它们每个都有不同的方法来获取您刚刚插入的行的 ID。

选择范围身份（）；在 sql 服务器中。

在 oracle 中，您需要使用序列并自己将值插入表中。

[Informix](https://stackoverflow.com/questions/246983/informix-how-to-get-an-id-of-the-last-inserted-record)

因此，在您的代码中，您将不得不知道当前配置了哪个数据库以使用所需的代码。

另一种选择是让存储过程执行插入，获取 ID 并返回给您。然后您不需要对代码进行任何更改，代码调用一个返回 ID 的存储过程，但是每个数据库引擎都有不同版本的存储过程，每个都具有相同的名称，并将它们包含在您的脚本中创建您的数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T02:49:31.433

假设数据库是一个 SQLServer 数据库，你所要做的就是：

```
 SELECT SCOPE_IDENTITY(); 
```

另外，不要使用：

```
 SELECT @@IDENTITY; 
```

这是邪恶的。好的，这并不是真正的邪恶，但如果您有触发器或其他任何会在您的数据库中插入另一条记录的东西，它可能不会返回您正在寻找的 ID。

# iphone - 制作 iPhone 应用程序时从 xcodebuild 中设置配置文件

> ID：866761
> 
> 赞同：44
> 
> 时间：2009-05-15T02:34:23.637
> 
> 标签：iphone, xcode, xcodebuild, provisioning

我`xcodebuild`用来从命令行编译我的 iPhone 应用程序。有没有办法传递某种选项来设置配置文件？一般来说，关于 xcodebuild 的信息似乎并不多。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-07-24T23:58:47.927

实际上，您应该可以将其添加到 XCode 命令行设置中。

xcodebuild [无论您有什么其他选项] PROVISIONING_PROFILE="[您的个人资料唯一 ID ]"

命令行中的构建设置应该覆盖所有内容，因此这应该胜过项目或目标中定义的任何内容。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-03-31T09:52:09.310

我的解决方案并不优雅，但它确实完成了这项工作，让我自动化构建服务器上的所有内容：

```
#!/bin/bash

TARGET="Your App"
CONFIGURATION="Release"
SDK="iphoneos"
PROFILE_PATH="/Users/jkp/Desktop/foo.mobileprovision"
IDENTITY="iPhone Distribution: Your Company Ltd"
KEYCHAIN="/Users/jkp/Desktop/keychain"
PASSWORD="foobar"

open "${PROFILE_PATH}"
sleep 5
osascript -e "tell application \"Xcode\" to quit"
security unlock-keychain -p ${PASSWORD} ${KEYCHAIN}
xcodebuild \
  -target "${TARGET}" \
  -configuration ${CONFIGURATION} \
  -sdk iphoneos \
  CODE_SIGN_IDENTITY="${IDENTITY}" \    
  OTHER_CODE_SIGN_FLAGS="--keychain ${KEYCHAIN}" 
```

这里的关键是我不需要先安装配置文件。实际上，我还有另一个脚本，它使用 mechanize 在每次构建之前下载配置文件的最新副本，这意味着我们可以远程更新配置文件（例如添加新设备），并让我们的 CI 服务器接收这些更改，而无需任何额外工作。

**注意：**我已经找到了一种安装或更新配置文件的方法，而根本不需要涉及 Xcode - 更干净！请参阅[此处](https://vworkdev.tumblr.com/post/160876198/add-hoc-iphone-distribution-and-ci-pt-2)了解完整详情。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-09-16T20:29:24.013

供应配置文件必须由 UUID 提供，在我的情况下，供应配置文件已签入源代码控制系统，因此由开发人员/构建服务器/CI 系统与代码一起签出。在源代码树中，配置文件具有人类可读的名称，例如 MyApp.mobileprovison，并且位于名为“ProvisioningProfiles”的目录中。要创建 xcode 存档，必须重命名配置文件并将其复制到 ~/Library/MobileDevice/Provisioning Profiles 目录，然后 xcodebuild 才能识别它们。这是可以在 CI 构建脚本中使用的代码片段。

```
# The keychain needs to be unlocked for signing, which requires the keychain
# password. This is stored in a file in the build account only accessible to
# the build account user
if [ ! -f $HOME/.pass ] ; then
    echo "no keychain password file available"
    exit 1
fi

case `stat -L -f "%p" $HOME/.pass`
in
    *400) ;;
    *)
        echo "keychain password file permissions are not restrictive enough"
        echo "chmod 400 $HOME/.pass"
        exit 1
        ;;
esac

#
# unlock the keychain, automatically lock keychain on script exit
#
security unlock-keychain -p `cat $HOME/.pass` $HOME/Library/Keychains/login.keychain
trap "security lock-keychain $HOME/Library/Keychains/login.keychain" EXIT

#
# Extract the profile UUID from the checked in Provisioning Profile.
#
uuid=`/usr/libexec/plistbuddy -c Print:UUID /dev/stdin <<< \
        \`security cms -D -i ProvisioningProfiles/MyApp.mobileprovision\``

#
# Copy the profile to the location XCode expects to find it and start the build,
# specifying which profile and signing identity to use for the archived app
#
cp -f ProvisioningProfiles/MyApp.mobileprovision \
        "$HOME/Library/MobileDevice/Provisioning Profiles/$uuid.mobileprovision"
xcodebuild -workspace MyApp.xcworkspace -scheme MyScheme \
        -archivePath build/MyApp.xcarchive archive \
        PROVISIONING_PROFILE="$uuid" CODE_SIGN_IDENTITY="iOS Distribution" 
```

必须解锁钥匙串，并且必须允许“/usr/bin/codesign”工具访问与签名身份相关的私钥才能正常工作 - 使用了以下参考 [https://stackoverflow.com/a/21327591/ 2351246](https://stackoverflow.com/a/21327591/2351246)和[Add codesign to private key ACL without Keychain](https://stackoverflow.com/q/4764499/2351246)分别用于解锁和添加钥匙串访问权限。

如果随后要使用 xcodebuild 将存档导出到 IPA，则必须考虑以下问题（[xcodebuild 不会从 .app 复制文件](https://stackoverflow.com/q/23682083/2351246)）。需要再次提供配置文件。创建 IPA 的脚本片段是

```
profileName=`/usr/libexec/plistbuddy -c Print:Name /dev/stdin <<< \
        \`security cms -D -i ProvisioningProfiles/MyApp.mobileprovision\``

xcodebuild \
        -exportArchive \
        -exportFormat IPA \
        -archivePath build/MyApp.xcarchive \
        -exportPath $IPADIR/MyApp.ipa \
        -exportProvisioningProfile "$profileName" 
```

运行此命令时，必须解锁钥匙串。

更新

在 OSX Mavericks (v10.9.5) 和 OSX Yosemite 上，我们开始看到代码签名错误：

```
Codesign check fails : ...../MyApp.app: resource envelope is obsolete 
```

在此处查看此帖子以了解原因[xcodebuild - codesign -vvvv 说“资源信封已过时”](https://stackoverflow.com/q/26008449/2351246)

要实施 Apple 支持在引用的帖子中建议的更改，请运行以下命令：

```
 sudo perl -pi.bak -e 's/--verify"./--verify", "--no-strict",/ if /codesign.*origApp/;' `xcrun -sdk iphoneos -f PackageApplication` 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-08T23:06:36.067

我意识到这可能有点偏离 OP 主题，但是在搜索如何让 Xcode 构建在 Jenkins 上运行时，首先会出现这个问题。在此处发布一些其他信息以供后代使用。和积分。如果你觉得这很有用，请给分:)

无论如何，最近几次在这个上进行了几轮。发现这个：

[http://code-dojo.blogspot.co.uk/2012/09/fix-ios-code-signing-issue-when-using.html](http://code-dojo.blogspot.co.uk/2012/09/fix-ios-code-signing-issue-when-using.html)

似乎工作。确保：

1.  首先将 Xcode 构建设置为普通 OSX 用户；让它从那里构建您的可分发，通过 Xcode 修复任何配置文件问题；

2.  作为普通 OSX 用户，使用 xcodebuild 进行命令行构建；

3.  然后按照上面帖子中的说明操作，将所有 iOS 证书从 Login Keychain 复制到 System 并复制`~/Library/MobileDevice/Provisioning Profiles`到 Jenkins 用户的`~jenkins/Library/MobileDevice/Provisioning Profiles`文件夹中。

下一个 Jenkins 构建，使用上面步骤 2 中的命令，应该可以完美运行。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-15T07:59:34.167

[文档](http://developer.apple.com/DOCUMENTATION/Darwin/Reference/ManPages/man1/xcodebuild.1.html)

从文档看来，您无法设置配置文件，但您可以指定目标：

[-目标目标名称]

因此，如果您为每个配置文件创建一个目标，您可以从命令行中选择正确的目标。

这基本上可以完成您的要求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-04-12T15:49:00.880

您可以创建 ExportOption.plist 文件，在其中设置所有参数，例如：compileBitcode、teamID、证书和配置文件。

然后转到终端中的项目文件夹并使用命令创建存档，例如：

```
xcodebuild -quiet -workspace <ProjectName>.xcworkspace -scheme <ProjectScheme> -sdk iphoneos -configuration Release -destination generic/platform=iOS clean archive -archivePath <PathForArchive>/<ProjectName>.xcarchive 
```

接下来将 ExportOption.plist 放入当前文件夹 (PathForArchive) 并运行：

```
xcodebuild -quiet -exportArchive -archivePath <ProjectName>.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath <PathForExport> 
```

您将在文件夹中有一个 .ipa，其中设置来自 ExportOptions.plist

[ExportOption.plist 示例](https://i.stack.imgur.com/MqEho.jpg)

# performance - SET 与 SELECT - 有什么区别？

> ID：866767
> 
> 赞同：42
> 
> 时间：2009-05-15T02:37:48.497
> 
> 标签：performance, tsql, functional-programming

有人可以确定T-SQL之间`SET`和`SELECT`T-SQL中的功能/性能差异（如果有的话）吗？在什么情况下我应该选择其中之一？

* * *

**更新：**
感谢所有回复的人。正如一些人所指出的，[Narayana Vyas Kondreddi的](http://vyaskn.tripod.com/)[这篇](http://vyaskn.tripod.com/differences_between_set_and_select.htm)文章有很多很好的信息。阅读文章后，我还仔细阅读了网络，发现[了](http://ryanfarley.com/blog/archive/2004/03/01/390.aspx)[Ryan Farley](http://ryanfarley.com/default.aspx)的精简版，其中提供了亮点，并认为我会分享它们：

1.  SET 是变量赋值的 ANSI 标准，而 SELECT 不是。
2.  SET 一次只能赋值一个变量，SELECT 一次可以进行多个赋值。
3.  如果从查询分配，SET 只能分配一个标量值。如果查询返回多个值/行，则 SET 将引发错误。SELECT 会将其中一个值分配给变量并隐藏返回多个值的事实（因此您可能永远不知道为什么其他地方出了问题 - 有乐趣解决那个问题）
4.  当从查询中分配时，如果没有返回值，则 SET 将分配 NULL，其中 SELECT 根本不会进行分配（因此变量不会从其先前的值更改）
5.  至于速度差异 - SET 和 SELECT 之间没有直接差异。然而，SELECT 在一次拍摄中完成多项任务的能力确实使它比 SET 具有轻微的速度优势。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-15T02:42:18.627

SET 是为变量赋值的 ANSI 标准方法，而 SELECT 不是。但是您可以使用 SELECT 一次将值分配给多个变量。SET 允许您一次仅将数据分配给一个变量。因此，在性能方面，SELECT 将成为赢家。

有关更多详细信息和示例，请参阅：[将值分配给变量时 SET 和 SELECT 之间的区别](http://vyaskn.tripod.com/differences_between_set_and_select.htm)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-15T02:45:45.997

SQL Server：您必须使用 SELECT 的一种情况是在分配 @@ERROR 和 @@ROWCOUNT 时，因为它们必须在同一语句中设置（否则它们会被重置）：

```
SELECT @error = @@ERROR, @rowcount = @@ROWCOUNT 
```

（SET 一次只能使用一个值）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-15T02:44:49.870

*Set*是为变量赋值的**ANSI 标准。**

***将值分配给多个变量**时可以使用*Select*。*

 *有关更多详细信息，请阅读[Narayana Vyas的这篇详细文章](http://vyaskn.tripod.com/differences_between_set_and_select.htm)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T02:43:57.780

设置和选择都为变量赋值。使用 select 可以为多个变量赋值

就像是

选择@var1=1,@var2=2

在哪里使用 set 你必须使用单独的 set 语句（它是一种分配值的 ANSI 方式），即

设置@var1=1

设置@var2=2

我希望这有帮助

干杯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-18T19:55:17.697

常见问题，固定答案：

[http://sqlblog.com/blogs/alexander_kuznetsov/archive/2009/01/25/defensive-database-programming-set-vs-select.aspx](http://sqlblog.com/blogs/alexander_kuznetsov/archive/2009/01/25/defensive-database-programming-set-vs-select.aspx)

# android - 如何调用安卓联系人列表？

> ID：866769
> 
> 赞同：131
> 
> 时间：2009-05-15T02:39:36.120
> 
> 标签：android, contacts

我正在制作一个 Android 应用程序，需要调用手机的联系人列表。我需要调用联系人列表功能，选择一个联系人，然后使用联系人的姓名返回我的应用程序。这是我在互联网上获得的代码，但它不起作用。

```
import android.app.ListActivity;
import android.content.Intent;
import android.database.Cursor;
import android.os.Bundle;
import android.provider.Contacts.People;
import android.view.View;
import android.widget.ListAdapter;
import android.widget.ListView;
import android.widget.SimpleCursorAdapter;
import android.widget.TextView;

public class Contacts extends ListActivity {

    private ListAdapter mAdapter;
    public TextView pbContact;
    public static String PBCONTACT;
    public static final int ACTIVITY_EDIT=1;
    private static final int ACTIVITY_CREATE=0;

    // Called when the activity is first created. 
    @Override
    public void onCreate(Bundle icicle) {
        super.onCreate(icicle);
        Cursor C = getContentResolver().query(People.CONTENT_URI, null, null, null, null);
        startManagingCursor(C);

        String[] columns = new String[] {People.NAME};
        int[] names = new int[] {R.id.row_entry};

        mAdapter = new SimpleCursorAdapter(this, R.layout.mycontacts, C, columns, names);
        setListAdapter(mAdapter);
    } // end onCreate()
    // Called when contact is pressed
    @Override
    protected void onListItemClick(ListView l, View v, int position, long id) {
        super.onListItemClick(l, v, position, id);

        Cursor C = (Cursor) mAdapter.getItem(position);
        PBCONTACT = C.getString(C.getColumnIndex(People.NAME));

        // RHS 05/06
        //pbContact = (TextView) findViewById(R.id.myContact);
        //pbContact.setText(new StringBuilder().append("b"));

        Intent i = new Intent(this, NoteEdit.class);
        startActivityForResult(i, ACTIVITY_CREATE);
    }
} 
```

* * *

## 回答 #1

> 赞同：251
> 
> 时间：2009-05-15T09:59:25.347

我不能 100% 确定您的示例代码应该做什么，但以下代码段应该可以帮助您“调用联系人列表功能，选择一个联系人，然后使用联系人的姓名返回 [您的] 应用程序”。

此过程分为三个步骤。

# 1\. 权限

将读取联系人数据的权限添加到您的应用程序清单。

```
<uses-permission android:name="android.permission.READ_CONTACTS"/> 
```

# 2\. 调用联系人选择器

在您的 Activity 中，创建一个 Intent，要求系统从 Contacts URI 中的项目中查找可以执行 PICK 操作的 Activity。

```
Intent intent = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI); 
```

调用`startActivityForResult`，传入这个 Intent （和一个请求代码整数，`PICK_CONTACT`在这个例子中）。这将导致 Android 启动在 上注册支持的 Activity `ACTION_PICK`，`People.CONTENT_URI`然后在进行选择（或取消）时返回此 Activity。

```
startActivityForResult(intent, PICK_CONTACT); 
```

# 3\. 聆听结果

同样在您的活动中，覆盖该`onActivityResult`方法以侦听您在步骤 2 中启动的“选择联系人”活动的返回。您应该检查返回的请求代码是否与您期望的值匹配，并且结果代码是`RESULT_OK`.

*您可以通过调用data* Intent 参数`getData()`来获取所选联系人的 URI 。要获取所选联系人的姓名，您需要使用该 URI 创建一个新查询并从返回的光标中提取姓名。

 *```
@Override
public void onActivityResult(int reqCode, int resultCode, Intent data) {
  super.onActivityResult(reqCode, resultCode, data);

  switch (reqCode) {
    case (PICK_CONTACT) :
      if (resultCode == Activity.RESULT_OK) {
        Uri contactData = data.getData();
        Cursor c =  getContentResolver().query(contactData, null, null, null, null);
        if (c.moveToFirst()) {
          String name = c.getString(c.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME));
          // TODO Whatever you want to do with the selected contact name.
        }
      }
      break;
  }
} 
```

^(完整源代码：[tutorials-android.blogspot.com（如何调用android联系人列表）](http://tutorials-android.blogspot.com/2011/11/how-to-call-android-contacts-list.html)。)

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2010-11-11T13:12:17.300

我为 Android 2.2 Froyo 版本这样做：基本上使用 eclipse 创建一个类，如： public class SomePickContactName extends Activity

然后插入此代码。请记住添加在我的代码版本中引用的私有类变量和 CONSTANTS：

```
protected void onCreate(Bundle savedInstanceState) 
{
  super.onCreate(savedInstanceState);       
  Intent intentContact = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI); 
  startActivityForResult(intentContact, PICK_CONTACT);
}//onCreate

public void onActivityResult(int requestCode, int resultCode, Intent intent) 
{

  if (requestCode == PICK_CONTACT)
  {         
    getContactInfo(intent);         
    // Your class variables now have the data, so do something with it. 
  }
}//onActivityResult

protected void getContactInfo(Intent intent)
{

   Cursor cursor =  managedQuery(intent.getData(), null, null, null, null);      
   while (cursor.moveToNext()) 
   {           
       String contactId = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts._ID));
       name = cursor.getString(cursor.getColumnIndexOrThrow(ContactsContract.Contacts.DISPLAY_NAME)); 

       String hasPhone = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts.HAS_PHONE_NUMBER));

       if ( hasPhone.equalsIgnoreCase("1"))
           hasPhone = "true";
       else
           hasPhone = "false" ;

       if (Boolean.parseBoolean(hasPhone)) 
       {
        Cursor phones = getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null,ContactsContract.CommonDataKinds.Phone.CONTACT_ID +" = "+ contactId,null, null);
        while (phones.moveToNext()) 
        {
          phoneNumber = phones.getString(phones.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));
        }
        phones.close();
       }

       // Find Email Addresses
       Cursor emails = getContentResolver().query(ContactsContract.CommonDataKinds.Email.CONTENT_URI,null,ContactsContract.CommonDataKinds.Email.CONTACT_ID + " = " + contactId,null, null);
       while (emails.moveToNext()) 
       {
        emailAddress = emails.getString(emails.getColumnIndex(ContactsContract.CommonDataKinds.Email.DATA));
       }
       emails.close();

    Cursor address = getContentResolver().query(
                ContactsContract.CommonDataKinds.StructuredPostal.CONTENT_URI,
                null,
                ContactsContract.CommonDataKinds.StructuredPostal.CONTACT_ID + " = " + contactId,
                null, null);
    while (address.moveToNext()) 
    { 
      // These are all private class variables, don't forget to create them.
      poBox      = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.POBOX));
      street     = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.STREET));
      city       = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.CITY));
      state      = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.REGION));
      postalCode = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.POSTCODE));
      country    = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.COUNTRY));
      type       = address.getString(address.getColumnIndex(ContactsContract.CommonDataKinds.StructuredPostal.TYPE));
    }  //address.moveToNext()   
  }  //while (cursor.moveToNext())        
   cursor.close();
}//getContactInfo 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-04-26T17:15:05.043

寻找使用 ContactsContract API 的 API 5 级解决方案，您可以使用以下代码稍微修改上面的代码：

```
 Intent intent = new Intent(Intent.ACTION_PICK);
  intent.setType(ContactsContract.Contacts.CONTENT_TYPE);
  startActivityForResult(intent, PICK_CONTACT); 
```

然后在 onActivityResult 中使用列名：

```
 ContactsContract.Contacts.DISPLAY_NAME 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-08-26T06:00:35.053

这是获取联系的代码片段：

```
package com.contact;

import android.app.Activity;
import android.content.ContentResolver;
import android.content.Intent;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.TextView;

public class GetContactDemoActivity extends Activity implements OnClickListener {

private Button btn = null;
private TextView txt = null;

@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);

    btn = (Button) findViewById(R.id.button1);
    txt = (TextView) findViewById(R.id.textView1);

    btn.setOnClickListener(this);
}

@Override
public void onClick(View arg0) {
    if (arg0 == btn) {
        try {
            Intent intent = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
            startActivityForResult(intent, 1);
        } catch (Exception e) {
            e.printStackTrace();
            Log.e("Error in intent : ", e.toString());
        }
    }
}

@Override
public void onActivityResult(int reqCode, int resultCode, Intent data) {
    super.onActivityResult(reqCode, resultCode, data);

    try {
        if (resultCode == Activity.RESULT_OK) {
            Uri contactData = data.getData();
            Cursor cur = managedQuery(contactData, null, null, null, null);
            ContentResolver contect_resolver = getContentResolver();

            if (cur.moveToFirst()) {
                String id = cur.getString(cur.getColumnIndexOrThrow(ContactsContract.Contacts._ID));
                String name = "";
                String no = "";

                Cursor phoneCur = contect_resolver.query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null,
                        ContactsContract.CommonDataKinds.Phone.CONTACT_ID + " = ?", new String[] { id }, null);

                if (phoneCur.moveToFirst()) {
                    name = phoneCur.getString(phoneCur.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME));
                    no = phoneCur.getString(phoneCur.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));
                }

                Log.e("Phone no & name :***: ", name + " : " + no);
                txt.append(name + " : " + no + "\n");

                id = null;
                name = null;
                no = null;
                phoneCur = null;
            }
            contect_resolver = null;
            cur = null;
            //                      populateContacts();
        }
    } catch (IllegalArgumentException e) {
        e.printStackTrace();
        Log.e("IllegalArgumentException :: ", e.toString());
    } catch (Exception e) {
        e.printStackTrace();
        Log.e("Error :: ", e.toString());
    }
} 
```

}

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-09-01T11:41:31.657

```
 Cursor phones = getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null,null,null, null);
        while (phones.moveToNext())
        {
        String Name=phones.getString(phones.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME)
        String Number=phones.getString(phones.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));

        } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-07-12T07:04:40.990

```
public void onActivityResult(int requestCode, int resultCode, Intent intent) 
{
  if (requestCode == PICK_CONTACT && intent != null) //here check whether intent is null R not
  {  
  }
} 
```

因为不选择任何联系人，它会给出一个例外。所以最好检查一下这种情况。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-03-03T10:55:28.320

完整的代码如下

```
 package com.testingContect;

    import android.app.Activity;
    import android.content.Intent;
    import android.database.Cursor;
    import android.net.Uri;
    import android.os.Bundle;
    import android.provider.ContactsContract;
    import android.provider.Contacts.People;
    import android.view.View;
    import android.view.View.OnClickListener;
    import android.widget.Button;
    import android.widget.EditText;
    import android.widget.Toast;

    public class testingContect extends Activity implements OnClickListener{
    /** Called when the activity is first created. */

    EditText ed;
    Button bt;
    int PICK_CONTACT;
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        bt=(Button)findViewById(R.id.button1);
        ed =(EditText)findViewById(R.id.editText1);
        ed.setOnClickListener(this);
        bt.setOnClickListener(this);

    }

    @Override
    public void onClick(View v) {

        switch(v.getId())
        {
        case R.id.button1:

            break;
        case R.id.editText1:
             Intent intent = new Intent(Intent.ACTION_PICK);
              intent.setType(ContactsContract.Contacts.CONTENT_TYPE);
              startActivityForResult(intent, PICK_CONTACT);

            break;

        }

    }
    public void onActivityResult(int requestCode, int resultCode, Intent intent) 
    {

      if (requestCode == PICK_CONTACT)
      {         
          Cursor cursor =  managedQuery(intent.getData(), null, null, null, null);
          cursor.moveToNext();
          String contactId = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts._ID));
           String  name = cursor.getString(cursor.getColumnIndexOrThrow(ContactsContract.Contacts.DISPLAY_NAME)); 

          Toast.makeText(this, "Contect LIST  =  "+name, Toast.LENGTH_LONG).show(); 
      }
    }//onActivityResult
}//class ends 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-11-26T04:10:26.953

令我惊讶的是，您不需要用户权限 CONTACT_READ 即可读取姓名和一些基本信息（联系人是否已加星标，上次通话时间是什么时候）。但是，您确实需要获得权限才能阅读联系人的详细信息，例如电话号码。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-05-12T06:50:18.093

使用 android 联系人列表时要小心。

上述方法中的读取联系人列表适用于除 HTC One 和 Sony Xperia 之外的大多数 Android 设备。**它浪费了我六周**的时间试图找出问题所在！

在线提供的大多数教程几乎相似 - 首先阅读“所有”联系人，然后显示`Listview`在`ArrayAdapter`. 这不是内存有效的解决方案。与其先在其他网站上寻找解决方案，不如访问 developer.android.com。如果 developer.android.com 上没有任何解决方案，您应该寻找其他地方。

解决方案是使用`CursorAdapter`而不是`ArrayAdapter`检索联系人列表。使用`ArrayAdapter`可以在大多数设备上使用，但效率不高。滚动`CursorAdapter`时，在运行时仅检索联系人列表的一部分。`ListView`

```
public void onActivityCreated(Bundle savedInstanceState) {
    super.onActivityCreated(savedInstanceState);
    ...
    // Gets the ListView from the View list of the parent activity
    mContactsList =
        (ListView) getActivity().findViewById(R.layout.contact_list_view);
    // Gets a CursorAdapter
    mCursorAdapter = new SimpleCursorAdapter(
            getActivity(),
            R.layout.contact_list_item,
            null,
            FROM_COLUMNS, TO_IDS,
            0);
    // Sets the adapter for the ListView
    mContactsList.setAdapter(mCursorAdapter);
} 
```

检索联系人列表：[检索联系人列表](https://developer.android.com/training/contacts-provider/retrieve-names.html)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-24T06:52:58.710

嗨，我有一个代码可以通过共享首选项将联系人保存在您的数据库中，这是我的代码

```
public class Main22Activity extends AppCompatActivity {
    EditText nameInput,phoneInput;
    TextView LargeText;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main22);
        nameInput = (EditText) findViewById(R.id.nameInput);
        phoneInput = (EditText) findViewById(R.id.phoneInput);

        LargeText = (TextView) findViewById(R.id.textView2);
    }

    public void saveInfo (View view){
        SharedPreferences sharedPref = getSharedPreferences("nameInfo" , Context.MODE_PRIVATE);
        SharedPreferences.Editor editor= sharedPref.edit();
        editor.putString("name", nameInput.getText().toString());
        editor.putString("phone", phoneInput.getText().toString());
        editor.apply();
        Toast.makeText(this, "Saved", Toast.LENGTH_LONG).show();
    }

    public void displayData(View view){
        SharedPreferences sharedPref = getSharedPreferences("nameInfo" , Context.MODE_PRIVATE);
        String name = sharedPref.getString("name", "");
        String ph = sharedPref.getString ("phone","");
        LargeText.setText(name + " " + ph);
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-06-22T09:35:27.847

> 我正在使用这种方法来阅读联系人

```
public static List<ContactItem> readPhoneContacts(Context context) {
        List<ContactItem> contactItems = new ArrayList<ContactItem>();
        try {
            Cursor cursor = context.getContentResolver().query(ContactsContract.Contacts.CONTENT_URI, null,
                    null, null, "upper("+ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME + ") ASC");

            /*context.getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI,
                    null,
                    ContactsContract.CommonDataKinds.Phone.CONTACT_ID+ " = ?",
                    new String[] { id },
                    ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME+" ASC");*/

            Integer contactsCount = cursor.getCount(); // get how many contacts you have in your contacts list
            if (contactsCount > 0) {
                while (cursor.moveToNext()) {

                    String id = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts._ID));
                    String contactName = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME));
                    if (Integer.parseInt(cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts.HAS_PHONE_NUMBER))) > 0) {
                        ContactItem contactItem = new ContactItem();
                        contactItem.setContactName(contactName);
                        //the below cursor will give you details for multiple contacts
                        Cursor pCursor = context.getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null,
                                ContactsContract.CommonDataKinds.Phone.CONTACT_ID + " = ?",
                                new String[]{id}, null);
                        // continue till this cursor reaches to all phone numbers which are associated with a contact in the contact list
                        while (pCursor.moveToNext()) {
                            int phoneType = pCursor.getInt(pCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.TYPE));
                            //String isStarred      = pCur.getString(pCur.getColumnIndex(ContactsContract.CommonDataKinds.Phone.STARRED));
                            String phoneNo = pCursor.getString(pCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));
                            //you will get all phone numbers according to it's type as below switch case.
                            //Logs.e will print the phone number along with the name in DDMS. you can use these details where ever you want.
                            switch (phoneType) {
                                case Phone.TYPE_MOBILE:
                                    contactItem.setContactNumberMobile(phoneNo);
                                    Log.e(contactName + ": TYPE_MOBILE", " " + phoneNo);
                                    break;
                                case ContactsContract.CommonDataKinds.Phone.TYPE_HOME:
                                    contactItem.setContactNumberMobile(phoneNo);
                                    Log.e(contactName + ": TYPE_HOME", " " + phoneNo);
                                    break;
                                case ContactsContract.CommonDataKinds.Phone.TYPE_WORK:
                                    contactItem.setContactNumberMobile(phoneNo);
                                    Log.e(contactName + ": TYPE_WORK", " " + phoneNo);
                                    break;
                                case ContactsContract.CommonDataKinds.Phone.TYPE_WORK_MOBILE:
                                    contactItem.setContactNumberMobile(phoneNo);
                                    Log.e(contactName + ": TYPE_WORK_MOBILE", " " + phoneNo);
                                    break;
                                case Phone.TYPE_OTHER:
                                    contactItem.setContactNumberMobile(phoneNo);
                                    Log.e(contactName + ": TYPE_OTHER", " " + phoneNo);
                                    break;
                                default:
                                    break;
                            }
                        }
                        contactItem.setSelectedAddress(getContactPostalAddress(pCursor));
                        pCursor.close();
                        contactItems.add(contactItem);
                    }

                }
                cursor.close();
            }
        } catch (Exception ex) {
            ex.printStackTrace();
        }

        return contactItems;
    }//loadContacts 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-27T07:16:39.623

我使用@Colin MacKenzie - III 提供的[代码。](https://stackoverflow.com/a/4154729/2481444)非常感谢！

对于正在寻找替代“已弃用”managedQuery 的人：

第一，假设使用 v4 支持库：

```
import android.support.v4.app.LoaderManager;
import android.support.v4.content.CursorLoader;
import android.support.v4.content.Loader; 
```

第二：

```
your_(activity)_class implements LoaderManager.LoaderCallbacks<Cursor> 
```

第三，

```
// temporarily store the 'data.getData()' from onActivityResult
private Uri tmp_url; 
```

4、覆盖回调：

```
@Override
public Loader<Cursor> onCreateLoader(int id, Bundle args) {
    // create the loader here!
    CursorLoader cursorLoader = new CursorLoader(this, tmp_url, null, null, null, null);
    return cursorLoader;
}

@Override
public void onLoadFinished(Loader<Cursor> loader, Cursor cursor) {
    getContactInfo(cursor); // here it is!
}

@Override
public void onLoaderReset(Loader<Cursor> loader) {
} 
```

第五：

```
public void initLoader(Uri data){
    // will be used in onCreateLoader callback
    this.tmp_url = data;
    // 'this' is an Activity instance, implementing those callbacks
    this.getSupportLoaderManager().initLoader(0, null, this);
} 
```

6、[上面的代码](https://stackoverflow.com/a/4154729/2481444)，只是我把签名参数从 Intent 改成了 Cursor：

```
protected void getContactInfo(Cursor cursor)
{

   // Cursor cursor =  managedQuery(intent.getData(), null, null, null, null);      
   while (cursor.moveToNext()) 
   {
        // same above ...
   } 
```

7、调用initLoader：

```
@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    if (PICK_CONTACT == requestCode) {
        this.initLoader(data.getData(), this);
    }
} 
```

8、不要忘记这段代码

```
 Intent intentContact = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
    this.act.startActivityForResult(intentContact, PICK_CONTACT); 
```

参考：

[Android 基础知识：正确加载数据](http://code.tutsplus.com/tutorials/android-sdk_loading-data_cursorloader--mobile-5673)

[在 Activity 中初始化 Loader](https://stackoverflow.com/questions/9918397/initializing-a-loader-in-an-activity)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-02-10T11:38:28.003

```
-> Add a permission to read contacts data to your application manifest.

<uses-permission android:name="android.permission.READ_CONTACTS"/>

-> Use Intent.Action_Pick in your Activity like below

Intent contactPickerIntent = new Intent(Intent.ACTION_PICK,
                ContactsContract.CommonDataKinds.Phone.CONTENT_URI);
        startActivityForResult(contactPickerIntent, RESULT_PICK_CONTACT);

-> Then Override the onActivityResult()

 @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
        // check whether the result is ok
        if (resultCode == RESULT_OK) {
            // Check for the request code, we might be usign multiple startActivityForReslut
            switch (requestCode) {
            case RESULT_PICK_CONTACT:
               Cursor cursor = null;
        try {
            String phoneNo = null ;
            String name = null;           
            Uri uri = data.getData();            
            cursor = getContentResolver().query(uri, null, null, null, null);
            cursor.moveToFirst();           
            int  phoneIndex =cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER);
            phoneNo = cursor.getString(phoneIndex); 

            textView2.setText(phoneNo);
        } catch (Exception e) {
            e.printStackTrace();
        }
                break;
            }
        } else {
            Log.e("MainActivity", "Failed to pick contact");
        }
    }

This will work check it out 
```

# ajax - Jquery模棱两可的ajax错误

> ID：866771
> 
> 赞同：3
> 
> 时间：2009-05-15T02:40:06.977
> 
> 标签：ajax, jquery

这是我的 ajax 调用的核心。

```
function ajax(path, requestData, successCallBack, errorCallBack) {
    return $.ajax({
        error: function(xhr, textStatus, errorThrown) 
            ç(xhr, textStatus, errorThrown);
        },
        success: function(json){ 
            successCallBack(json);
        }
    });
} 
```

当正在进行 ajax 调用并且用户单击页面上的链接时，将调用我的 errorCallBack。导航离开的用户会导致 ajax 调用被终止。当服务器出现错误时，我的 errorCallBack 回调也会被调用。

有没有办法区分这两者？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-08-08T07:25:02.180

@colbeerhey 的回答很好，但您可以更进一步。您仍然需要知道服务器是否实际上无法访问。[我在这里](https://stackoverflow.com/questions/6977870/in-a-ajax-callback-how-do-i-distinguish-an-unreachable-server-from-a-user-navi)问了这个问题，但完整的答案是：

```
var running = true;
$(window).bind('beforeunload', function() { running = false; });

$.ajax({
    /* ajax options omitted */
    error: function (xmlHttpRequest, textStatus, errorThrown) {
         var serverNotReached = xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0;
         if(serverNotReached && !running) 
              return;  // it's not really an error, user clicked away
         else if (serverNotReached)
              // The server is down!  You didn't get any response at all.
         else
              // Do normal error handling
}); 
```

请记住，onbeforeunload 只是一个事实上的标准（IE FF，Webkit 都处理它），所以如果你关心更晦涩的浏览器，这将打破。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T02:51:13.783

我正在处理的事情也遇到了同样的问题...“已取消”的 $.ajax 请求（用户导航离开/点击停止）xhr.status == 0 而不是 200/404/etc...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-13T00:21:15.620

这是我用来实现 gnarf 和 nickf 答案的技术：

当用户通过刷新、单击链接或更改浏览器中的 URL 离开页面时，jQuery 会引发错误事件。您可以通过为 ajax 调用实现错误处理程序并检查 xmlHttpRequest 对象来检测这些类型的错误：

```
$.ajax({
    /* ajax options omitted */
    error: function (xmlHttpRequest, textStatus, errorThrown) {
         if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) 
              return;  // it's not really an error
         else
              // Do normal error handling
}); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-15T02:43:03.243

检查 xhr 对象的属性。它应该在某处包含 HTTP 响应代码。

# python - 我可以根据我对文档的分析在将文档转换为文本之前在 BeautifulSoup 中对文档进行分段吗？

> ID：866772
> 
> 赞同：0
> 
> 时间：2009-05-15T02:40:42.763
> 
> 标签：python, beautifulsoup

我有一些要转换为文本的 html 文件。我玩过 BeautifulSoup 并在理解如何使用说明以及可以提交 html 和取回文本方面取得了一些进展。

但是，我的文件有很多使用表格结构格式化的文本。例如，我可能有一段文本位于一组表标签中的 td 标签中

```
<table>
<td> here is some really useful information and there might be other markup tags but
     this information is really textual in my eyes-I want to preserve it
 </td>
</table> 
```

然后是“经典表格”，表格主体中有数据。

我希望能够将算法应用于表格并设置一些规则来确定表格是否在我将文档转换为文本之前被撕掉。

我已经弄清楚如何获取我的表格的特征 - 例如获取每个表格中的列数：

```
numbCols=[]
for table in soup.findAll('table'):
    rows=[]
    for row in table.findAll('tr'):
        columns=0
        for column in row.findAll('td'):
            columns+=1
        rows.append(columns)
    numbCols.append(rows) 
```

所以我可以对 numbCols 进行操作，并使用列表中每个项目的 len 和列表中每个项目的值来分析我的表的特征并确定我想要保留或丢弃的那些。

我没有看到将这些信息与 BeautifulSoup 一起使用来获取文本的优雅方式。我想我想要得到的是假设我分析 numbCols 并决定我想排除表 2、4、6 和 9 的特定文档中的十个表。所以 html 文档的部分包括除那些之外的所有内容表。我怎么能这样分割我的汤？

我想出的解决方案是首先使用 finditer 确定每个打开和关闭表标签的位置并获取跨度，然后使用 numbCols 压缩跨度。然后我可以使用这个列表将我的字符串片段剪断并连接在一起。完成后，我可以使用 BeautifulSoup 将 html 转换为文本。

我确信我应该能够在 BeautifulSoup 中完成所有这些工作。任何对现有示例的建议或链接都​​会很棒。我应该提一下，我的源文件可能很大，而且我要处理数千个文件。

没有答案，但我越来越近了

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-16T05:00:33.917

伙计，我喜欢这个东西假设在一个天真的情况下，我想删除所有列长度大于 3 的行的所有表我的答案是

```
for table in soup.findAll('table'):
    rows=[]
    for row in table.findAll('tr'):
        columns=0
        for column in row.findAll('td'):
            columns+=1
            rows.append(columns)
        if max(rows)>3:
          table.delete() 
```

您可以在该循环中的任何级别执行您想要的任何处理，只需要识别测试并获取正确的实例进行测试。

# c++ - “向量”中的这段代码是什么意思？(C++)

> ID：866776
> 
> 赞同：1
> 
> 时间：2009-05-15T02:44:33.240
> 
> 标签：c++, vector, iterator, assertions

我创建了一个程序，它使用vector.h #include和迭代器等......但是当我运行程序时，在某些情况下（我仍在试图弄清楚那些会是什么）我得到一个断言将我引至 vector.h 的第 98 行时出错。我去了vector.h的第98行并得到了这个：

```
 #if _HAS_ITERATOR_DEBUGGING
        if (this->_Mycont == 0
            || _Myptr < ((_Myvec *)this->_Mycont)->_Myfirst
            || ((_Myvec *)this->_Mycont)->_Mylast <= _Myptr)
            {
            _DEBUG_ERROR("vector iterator not dereferencable");
            _SCL_SECURE_OUT_OF_RANGE;
            } 
```

有人可以告诉我这意味着什么以及我的程序中是什么导致了这个断言吗？

注意：记录在案的第 98 行是开始于 "_DEBUG_ERROR("vect..."

注意：这是我认为触发错误的程序中的代码，不过我不完全确定。

代码：

```
for(aI = antiviral_data.begin(); aI < antiviral_data.end();)
    {
        for(vI = viral_data.begin(); vI < viral_data.end();)
        {
            if((*aI)->x == (*vI)->x && (*aI)->y == (*vI)->y)
            {
                vI = viral_data.erase(vI);
                aI = antiviral_data.erase(aI);
            }
            else
            {
                vI++;
            }
        }
        if((*aI)->x >= maxx || (*aI)->x < 0 || (*aI)->y >= maxy || (*aI)->y < 0)
        {
            aI = antiviral_data.erase(aI);
        }
        else
        {
            aI++;
        }
    } 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T02:47:20.813

运行时检测到您正在取消引用 begin() 之前或 end() 之后的迭代器。

想象一下，如果您 `antiviral_data`在第 7 行删除向量中的最后一项：

```
aI = antiviral_data.erase(aI); 
```

`aI`设置为`antiviral_data.end()`, 当你在第 14 行取消引用它时：

```
if((*aI)->x >= maxx ... 
```

在第 5 行：

```
if((*aI)->x == (*vI)->x 
```

您正在取消引用越界迭代器。

修复方法是`aI != antiviral_data.end()`在擦除调用之后检查，以确保在继续使用它之前没有碰到向量的末尾。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T03:03:01.667

你真的想看看 STL 算法，`remove_if`而不是手动做这些事情。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-15T03:22:32.867

一个小的一般性评论：在检查迭代器时`end()`，不要使用“ `<`”，而只能使用“ `!=`”。因此，代码的第一行应如下所示：

```
for(aI = antiviral_data.begin(); aI != antiviral_data.end();)
{
  for(vI = viral_data.begin(); vI != viral_data.end();)
  {
    ... 
```

但是，正如 Josh 已经指出的那样，您的特定错误在第 7 行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T04:07:24.727

除了接受的答案之外，并详细说明 slavy13 的答案 -
（**编辑**- 正如 Josh 所提到的，与这个问题*没有*直接关系 - 我把它留在这里供参考）。

代码（但不是此代码）有时假定您可以从向量中删除元素并继续迭代。这是一个错误的假设——一旦你从向量中删除了一个元素，被删除元素之后的所有其他迭代器都将失效——你不能再假设它们是正确的，如果你继续使用它们，“坏事”就会发生。

这样做的原因是因为向量实际上以数组形式存储信息。当一个元素被删除时，所有后续元素都被向下复制一个单元格。迭代器不会相应地更新。

强烈建议在尝试执行此类操作时查阅 STL 文档，因为完全有可能此类代码会意外地在 STL 的某个实现上运行，但在其他实现上会失败。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-15T03:37:14.907

擦除向量中的元素会使所有迭代器无效。

# php - php，strtolower和mb_strtolower有什么区别？

> ID：866778
> 
> 赞同：15
> 
> 时间：2009-05-15T02:45:32.770
> 
> 标签：php, string, email

`strtolower`在 PHP 中，和 和有什么区别`mb_strtolower`？

如果我想将提交的电子邮件地址转换为小写，我应该使用哪一个？有没有这样的邮件：Name@Domain-Test.com

如果有这样的电子邮件，我是否仍将提交的电子邮件地址转换为小写？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2015-02-24T16:45:32.837

strtolower(); 不适用于波兰字符

```
<?php strtolower("mĄkA"); ?> 
```

> 将返回：mĄka;

最好的解决方案 - 使用 mb_strtolower()

```
<?php mb_strtolower("mĄkA",'UTF-8'); ?> 
```

> 将返回：mąka

请参阅PHP 手册中的[strtolower()](http://php.net/strtolower)和[mb_strtolower()](http://php.net/manual/en/function.mb-strtolower.php)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T02:49:50.887

> strtolower 和 mb_strtolower 有什么不同？

mb_* 函数适用于多字节字符串。手册说：

> 与 strtolower() 相比，“字母”由 Unicode 字符属性确定。因此，此函数的行为不受语言环境设置的影响，它可以转换任何具有“字母”属性的字符，例如 A-umlaut (Ä)。

-

> 有没有这样的电子邮件：Name@Domain-Test.com

是的，我想可能会有这样的电子邮件地址。我发现一般来说，电子邮件地址是不区分大小写的，所以我不会费心改变他们的大小写。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T02:47:42.593

mb_ 函数也适用于[多字节](http://us.php.net/manual/en/intro.mbstring.php)（unicode）字符串。电子邮件地址不应该区分大小写 - 没有太多理由将它们转换为小写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-12-22T09:35:52.670

如果你在一个 unicode 字符串上使用这个函数而不告诉 PHP 它是 unicode，那么你会损坏你的字符串。特别是，在 2 字节 UTF-8 字符中常见的带有波浪号的大写“A”被转换为带有波浪号的小写“a”。

`mb_strtolower()`非常慢，如果您有数据库连接，您可能希望使用它将字符串转换为小写。甚至`latin1/9 (iso-8859-1/15)`和其他编码都是可能的。

# sql - 协助 SQL 查询 - 无法绑定多部分标识符

> ID：866798
> 
> 赞同：2
> 
> 时间：2009-05-15T02:56:08.187
> 
> 标签：sql, sql-server

我正在尝试在同一个查询中进行子选择和内部联接，但收效甚微。

查询如下所示，并返回错误

> 无法绑定多部分标识符“Company.LocalityId”。

```
UPDATE Company
SET
    Company.BusinessRegionId = b.Id
FROM 
(
    SELECT
        Id
      FROM
        BusinessRegion
      WHERE
        tag = 'Australia/New South Wales'
) b
INNER JOIN Locality l ON 
    Company.LocalityId = l.Id
where 
    l.StateOrProvinceAbbreviation = 'NSW' 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T03:04:51.037

您的 BusinessRegion 和 Locality 表根本没有真正加入该查询，对吗？你可以做这样的事情吗？

```
UPDATE Company
SET BusinessRegionId = (
    SELECT TOP 1 Id
    FROM BusinessRegion
    WHERE Tag = 'Australia/New South Wales')
FROM Locality l
WHERE l.Id = LocalityId AND l.StateOrProvinceAbbreviation = 'NSW' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T03:12:32.487

这是查询的变体：

```
UPDATE 
   c
SET
    c.BusinessRegionId = 
    (
      SELECT TOP 1
        Id
      FROM
        BusinessRegion
      WHERE
        tag = 'Australia/New South Wales'
    )
FROM 
   Company c
   INNER JOIN Locality l ON c.LocalityId = l.Id
WHERE
    l.StateOrProvinceAbbreviation = 'NSW' 
```

# f# - 将字节转换为 F# 中的枚举实例

> ID：866803
> 
> 赞同：14
> 
> 时间：2009-05-15T02:59:43.920
> 
> 标签：f#, enums

让我们在 C# 中考虑以下枚举

```
public enum ScrollMode : byte
{
      None = 0,
      Left = 1,
      Right = 2,
      Up = 3,
      Down = 4
} 
```

F# 代码接收一个字节并且必须返回我尝试过的枚举实例

```
let mode = 1uy
let x = (ScrollMode)mode 
```

（当然，在实际应用程序中，我不会设置“模式”，它是作为网络数据的一部分接收的）。

上面的例子没有编译，有什么建议吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-15T05:40:58.963

对于基础类型为“int”的枚举，“enum”函数将进行转换，但对于非 int 枚举，您需要“LanguagePrimitives.EnumOfValue”，例如：

```
// define an enumerated type with an sbyte implementation
type EnumType =
  | Zero = 0y
  | Ten  = 10y

// examples to convert to and from
let x = sbyte EnumType.Zero
let y : EnumType = LanguagePrimitives.EnumOfValue 10y 
```

（此处列出了 EnumOfValue

[http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.LanguagePrimitives.html](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.LanguagePrimitives.html)

（现在[http://msdn.microsoft.com/en-us/library/ee340276(VS.100).aspx](http://msdn.microsoft.com/en-us/library/ee340276(VS.100).aspx)）

而枚举在这里列出

[http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/FSharp.Core/Microsoft.FSharp.Core.Operators.html)

（现在[http://msdn.microsoft.com/en-us/library/ee353754(VS.100).aspx](http://msdn.microsoft.com/en-us/library/ee353754(VS.100).aspx)））

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-04T19:01:49.660

让 x : ScrollMode = 枚举模式

# linq-to-sql - 一页请求中的最大“工作单元”？

> ID：866804
> 
> 赞同：1
> 
> 时间：2009-05-15T03:01:09.360
> 
> 标签：linq-to-sql, domain-driven-design, datacontext

它不是一个是吗？我有一种方法可以从不同的存储库中获取五个列表。每个调用都会打开和关闭一个新的 Datacontext。可以这样做还是应该将所有内容都包装在一个数据上下文中。在这种情况下，使用相同的数据上下文并不简单，但恐怕在一个页面请求中打开和关闭大量数据上下文并不好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T06:12:33.443

这是一篇关于这个主题的文章......

[Linq to SQL DataContext 生命周期管理](http://www.west-wind.com/weblog/posts/246222.aspx)

他建议每个请求一个，我已经在一些应用程序中实现了该模式，它对我来说效果很好。

他在文章中谈到了一点......他的快速而肮脏的版本引用了 System.Web 并做了这样的事情：

```
 private TDataContext _DataContext;

    public TDataContext DataContext
    {
        get
        {
            if (_DataContext == null)
            {

                if (HttpContext.Current != null)
                {
                    if (HttpContext.Current.Items[DataContextKey] == null)
                    {
                        HttpContext.Current.Items[DataContextKey] = new TDataContext();
                    }

                    _DataContext = (TDataContext)HttpContext.Current.Items[DataContextKey];
                }
                else
                {
                    _DataContext = new TDataContext();
                }
            }

            return _DataContext;
        }
    } 
```

但随后他建议您采取下一步，摆脱对 System.Web 的引用并使用依赖注入并创建您自己的 IContainer，它可以根据您是否在单元测试、Web 应用程序等中运行来确定数据上下文的生命周期.

例子：

```
public class YourRepository
{

    public YourRepository(IContainer<DataContext> container)
    {

    }

} 
```

然后替换`HttpContext.Current.Items[DataContextKey]`为`_Container[DataContextKey]`

希望这可以帮助...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-20T03:01:08.083

我在每个请求的工作单元上使用并构建了一个管理工作单元生命周期的 IHttpModule，根据请求创建它并在之后处理它。当前工作单元存储在 HttpContext.Current.Items 中（隐藏在 Local.Data 中）。

# .net - 在 NUnit 中动态创建测试

> ID：866816
> 
> 赞同：38
> 
> 时间：2009-05-15T03:07:41.467
> 
> 标签：.net, unit-testing, nunit

使用 Nunit，我希望能够编写一个测试夹具，它将读取特定目录中的所有文件名并为每个文件创建一个测试。

我可以很容易地编写一种测试方法来扫描目录并执行所有测试，但是当我运行 NUnit 时，我希望能够单独查看每个测试。

这甚至可能吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-17T22:21:04.607

我找到了适合我目的的方法

有一个测试用例，并像这样用 TestCaseSource 属性标记它

```
[Test, TestCaseSource("GetTestCases")]
public void TestFile(string filename)
{
    //do test
} 
```

然后编写GetTestCases读取目录下的所有文件名

```
private static string[] GetTestCases()
{
    return GetAllFilesInCurrentDirectory();
} 
```

然后，当我启动 NUnit 时，我会得到一个要运行的测试列表（在 TestFile 下列出）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T03:18:14.517

尝试[数据驱动的测试用例](http://code.google.com/p/nunit-extension-datadriven/)NUnit 扩展。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T05:06:00.090

如果**您不**打算随着时间的推移将文件添加到该目录并且有一组文件名作为通用测试的输入传递，请尝试使用[RowTest NUnit 扩展](http://www.andreas-schlapsi.com/projects/rowtest-extension-for-nunit/)（std distrib post v2.4.7 的一部分）-您'将能够查看每个测试用例 - 在 GUI 中单独输入组合，分组在单个节点下。

如果**您**要将文件添加到该目录，我会编写一个 NUnit TestCase，它循环遍历在运行时获得的文件列表，并使用每个文件路径调用通用测试方法。使用[收集参数](http://www.industriallogic.com/xp/refactoring/accumulationToCollection.html)收集失败的测试文件名 - 在您断言的最后。您将无法单独查看每个测试用例，但您将拥有可读的简单测试代码。

```
Assert.AreEqual(listOfFailedFiles.Length, 0, PrettyPrint(listOfFailedFiles)) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-17T22:26:06.777

我知道这有点晦涩难懂，但我过去曾使用过一个脚本为我生成代码，然后我可以将其作为单独的测试用例执行。

# windows - Visual Studio 忘记窗口设置并弄得一团糟

> ID：866820
> 
> 赞同：66
> 
> 时间：2009-05-15T03:11:48.463
> 
> 标签：windows, visual-studio, dock

我在打开 Visual Studio 时遇到了这个问题，内部窗口分散在各处。它们都没有停靠；一些应该可见的变得不可见，反之亦然。然后我必须花费很长时间把窗户放回我喜欢的地方。

它似乎只发生在某些解决方案中，并且最近才出现。

对于我的生活，我无法解决这个问题。有没有其他人经历过这个？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-05-15T04:17:37.570

听起来 Visual Studio 在往返之间保留您的设置以及可能是您的 Visual Studio 设置配置文件通常存在问题。

我推荐的解决方案是首先重置所有设置，其次根据您的个人喜好自定义内容，最后备份这些自定义设置。这个想法是这个设置备份文件可以在以后用于自动快速设置恢复到您满意的点。以下步骤显示了如何执行此操作，并希望能够解决最令人困惑的 Visual Studio 设置问题：

1.  关闭 Visual Studio 的所有实例。

2.  转到开始 > 程序 > Visual Studio 200X > Visual Studio 工具 > 并选择“Visual Studio 200X 命令提示符”

3.  运行不太知名的“devenv.exe /ResetUserData”命令。使用此命令，您将丢失所有 Visual Studio 环境设置和自定义。因此，/ResetUserData 开关不受官方支持，Microsoft 也没有宣传它（当您在命令提示符中键入 devenv.exe /? 时，您获得的 devenv.exe 帮助中没有描述该开关）。重要的是，等待生成的 devenv.exe 进程从任务管理器甚至更好的进程资源管理器中消失。

4.  当进程从任务管理器或进程资源管理器中消失时，运行“devenv.exe /ResetSettings”，这将恢复 IDE 的默认设置并最终启动 Visual Studio 的单个实例。

5.  现在在 Visual Studio 中，选择“工具”菜单底部附近的“导入和导出设置...”以启动导入和导出设置向导。

6.  选择“重置所有设置”单选按钮和下一步>选择“不，只是重置设置，覆盖我当前的设置”和下一步>选择您的个人“设置集合”首选项，我会在此处选择 Visual C# 开发设置（注意：您选择的这里对键盘快捷键等有影响，但您始终可以重复此过程直到满意）并单击完成。

7.  当您收到“您的设置已成功重置为 XXXXXX 开发设置”的消息时。单击关闭，然后花一些时间向 Visual Studio 添加任何个人自定义项，例如打开您始终想要打开的窗口、自定义工具栏和添加任何工具栏按钮等。

8.  当您完成个人定制并对设置完全满意后，再次转到工具 > '导入和导出设置...'

9.  选择“导出选定的环境设置”单选按钮并下一步 > 勾选“所有设置”和下一步 > 选择文件名和目录，然后单击完成以将当前设置的备份存储在 .vssettings 文件中。

10.  将来如果事情再次陷入困境，请返回工具>“导入和导出设置...”，这次选择“导入选定的环境设置”单选按钮，然后选择“否，只需导入新设置，覆盖我当前的设置”然后 Next > 从列表中选择您的 .vssettings 文件的名称（通常在 My Settings 文件夹下）或 Browse.. 到您保存文件的位置，然后 Next > 勾选“All Settings”并单击 Finish。

11.  重要的是，关闭 Visual Studio 的单个实例。您打开的任何未来实例都应保留最新的自定义设置。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-09-09T21:52:57.997

Visual Studio 经常单调地破坏它的设置（从 Visual C++ 时代开始，我就一直受此困扰，而且它在 VS2013 中仍然是一个问题）。

通常这似乎完全是随机的，但在崩溃之后很有可能。

如果 Visual Studio 没有完全关闭，它也会丢失对设置的任何更改 - 出于某种原因，而不是在您确定对话框时保存设置，VS 似乎等到它退出后再写回您的更改，所以在更改之后选项我总是退出并重新启动以确保更改已刷新到磁盘。同样，您永远不应更改运行 2 个或更多 VS 实例的选项，因为最后一个退出将覆盖设置。

特别是，有一个很容易重现的情况：如果您同时启动两个或更多副本（我的意思是如果您启动两个或更多副本，因此它们都在同时初始化），它们似乎会打架在设置文件上，它会损坏或重置为默认值。

我发现的最好的两种解决方法是：

*   切勿一次启动多个实例。如果您需要同时运行多个实例，请等待第一个实例完成加载其解决方案，然后再开始启动下一个实例。

*   始终使用`Tools > Import and Export Settings`将您的设置保存到备份文件中，以便每次从损坏中恢复只需几秒钟。

另一个较小但仍然相当烦人的习惯是，如果 VS 在退出时被最小化（例如通过关闭），它会破坏其窗口位置信息，并且下次运行它时，它将被最大化。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-15T16:32:59.770

当我的文档文件夹存储在映射驱动器上时，我遇到了类似的问题。如果我在映射驱动器之前打开 VS，VS 会像第一次打开它一样。我通过将环境设置存储在本地磁盘上解决了这个问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-04-13T08:43:17.927

我也遇到了这个问题（似乎在 Windows 更新后触发），无论我做什么，我都会得到一些虚假的窗口布局。上述建议也没有奏效。但幸运的是：[为什么 VS 2008 IDE 不记得我的偏好？](https://stackoverflow.com/questions/1097070/why-doesnt-vs-2008-ide-remember-my-preferences)删除：

```
%APPDATA%\Application Data\Microsoft\VisualStudio\9.0\windows.prf 
```

工作。

TP

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-12T07:59:44.327

实际上我找出了罪魁祸首：以前的 VS 崩溃了。

如果我的一个 Visual Studio 实例由于某种原因崩溃 - 下次我启动 VS 时，我会得到一批奇怪的设置。行为取决于各种因素，例如我当时是否打开了其他 VS 实例。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-01-17T00:05:45.133

我尝试了 Peter McG 的解决方案，但仍然没有帮助。最终对我有用的是删除我的 VS 解决方案用户选项 (.sou)。与我的解决方案位于同一目录中。

唯一不好的是您必须重做所有设置。这包括我的异常更改。没有太大的改变，但如果你有很多定制，那可能会很痛苦。该文件中一定有什么东西把所有东西都弄乱了，但是删除整个文件既快速又容易。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T04:09:08.887

您打开哪个解决方案无关紧要，因为这些设置不是特定于解决方案的。但我想知道您是否安装了 Visual Studio 2005 和 2008？如果是这样，打开 2005 年创建的解决方案将打开 VS 2005，打开 2008 解决方案将打开 VS 2008。即使您没有安装它，您也可能拥有 VS 2005。例如，InfoPath 2007 安装一个 VS 2005 shell。

首先，我会将窗口放置在您想要的位置，然后执行工具 -> 导出设置并仅包含窗口布局。这样你至少有一些你可以恢复的东西。

然后我会检查工具 -> 选项 -> 导入导出设置并记下“自动将我的设置保存到此文件”路径的设置位置。密切关注该文件。您是否有任何可能无意中覆盖它的同步软件？它是否指向一个不存在的位置？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-09-16T13:39:20.597

我的问题类似，但结果是应用程序崩溃。问题是这个值

在 HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\11.0\MainWindow 中。它被设置为“0 1000 -280 -100 3”可能是因为有多个屏幕和移动 UI 很多。

删除此值允许应用程序成功重新启动。它在启动时重新创建。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-27T20:44:03.787

我面临着类似的问题。而且它也是最近才开始的，比如在过去 30 天内。我记得在此期间唯一改变的是更新 Resharper 4.5。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-14T14:06:25.387

我经历过类似的事情。在我的情况下，文本编辑器的颜色（例如 c# 编辑器）正在变得混乱。我尝试并为我工作的唯一解决方案是更改颜色主题，然后再回到我想要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-01-01T18:15:57.073

在我的情况下，不是窗口布局被破坏，而是 Intellisense 提供代码完成和弹出帮助。在过去的十年中从未遇到过这个问题，现在它每天至少发生 3 次。Win8.1、Visual Studio 2013、ReSharper 8 和现在的 ReSharper 9（希望升级能够修复它）。

我现在经常不得不

*   关闭解决方案，
*   工具/导入-导出设置/重置所有设置
*   关闭 Visual Studio
*   打开 Visual Studio 导入我保存的设置
*   重新打开解决方案并继续工作

然后我可以在很长一段时间内再次正常工作，直到出现问题......让我在调试时说堆栈溢出。那时我只知道我的设置被搞砸了，我的 Intellisense 又死了。

我开始怀疑这是否与最新的 Visual Studio 更新有关。里面有一些我从不使用的东西，比如广告垃圾和 Office 开发集成。MS Office 有其自身的问题，例如任何其他应用程序（如 Quicken）都无法将 Office 64 位视为已安装的电子邮件程序。或者它可能与想要超越和“扩展”智能感知功能的 ReSharper 发生冲突。

无论哪种方式，我确信它是同一问题的不同表现形式：Visual Studio 设置在正常使用过程中会横向变化。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-04-15T20:34:07.993

我刚刚在 VS 2012 中遇到了这个问题，重置窗口布局什么也没做。

我推断

%APPDATA%\Application Data\Microsoft\VisualStudio\9.0\windows.prf

到

%appdata%\Microsoft\VisualStudio\11.0\Windows.index

...删除它并恢复营业！

*   确保首先关闭所有 VS 实例！

# http - 为什么在 HTTP 响应中应该同时使用 no-cache 和 no-store？

> ID：866822
> 
> 赞同：136
> 
> 时间：2009-05-15T03:12:19.913
> 
> 标签：http, caching, no-cache

我被告知要防止用户信息泄漏，仅响应“无缓存”是不够的。“无商店”也是必要的。

```
Cache-Control: no-cache, no-store 
```

阅读此规范[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)后，我仍然不太清楚为什么。

我目前的理解是它仅适用于中间缓存服务器。即使响应“无缓存”，中间缓存服务器仍然可以将内容保存到非易失性存储中。中间缓存服务器将决定是否将保存的内容用于后续请求。但是，如果响应中包含“no-store”，则中间缓存服务器不应该存储内容。因此，它更安全。

我们需要“无缓存”和“无存储”还有其他原因吗？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2012-06-27T15:13:16.833

我必须澄清这`no-cache`并不意味着*不缓存*。实际上，这意味着在每次请求中使用您可能拥有的任何缓存响应之前“与服务器重新验证”。

`must-revalidate`另一方面，仅当资源被认为是陈旧的时才需要重新验证。

如果服务器说资源仍然有效，那么缓存可以用它的表示来响应，从而减轻服务器重新发送整个资源的需要。

`no-store`实际上是完整的*不缓存*指令，旨在防止以任何形式的缓存存储表示。

我随便说，但请在 RFC 2616 HTTP 规范中注意这一点：

> 历史缓冲区可以存储这些响应作为其正常操作的一部分

但这在较新的 RFC 7234 HTTP 规范中被省略，可能是为了变得`no-store`更强大，请参阅：

[https://www.rfc-editor.org/rfc/rfc7234#section-5.2.1.5](https://www.rfc-editor.org/rfc/rfc7234#section-5.2.1.5)

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-05-15T03:35:48.280

在某些情况下，IE6 仍然会缓存文件，即使`Cache-Control: no-cache`在响应标头中也是如此。

[W3C`no-cache`](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.1)状态：

> 如果 no-cache 指令未指定字段名称，则缓存不得使用响应来满足后续请求，而无需与源服务器成功重新验证。

在我的应用程序中，如果您访问了带有`no-cache`标题的页面，然后注销然后在浏览器中回击，IE6 仍会从缓存中获取该页面（无需向服务器发送新/验证请求）。添加`no-store`标题阻止了它这样做。但如果你相信 W3C 的话，实际上没有办法控制这种行为：

> 历史缓冲区可以存储这些响应作为其正常操作的一部分。

浏览器历史记录和普通 HTTP 缓存之间的一般差异在[规范的特定小节](http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.13)中描述。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-15T03:53:01.483

从[HTTP 1.1 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.2)：

> **无商店**：
> 
> **无商店**的目的**指令是为了防止无意中释放或保留敏感信息（例如，在备份磁带上）。no-store 指令适用于整个消息，并且可以在响应或请求中发送。如果在请求中发送，缓存不得存储此请求的任何部分或对它的任何响应。如果在响应中发送，缓存不得存储此响应或引发它的请求的任何部分。该指令适用于非共享和共享缓存。在这种情况下，“不得存储”意味着缓存不得有意将信息存储在非易失性存储中，并且必须尽最大努力在转发信息后尽快从易失性存储中删除信息。即使该指令与响应相关联，用户可能会在缓存系统之外显式存储这样的响应（例如，使用“另存为”对话框）。历史缓冲区可以存储这些响应作为其正常操作的一部分。该指令的目的是满足某些用户和服务作者的既定要求，他们担心通过对缓存数据结构的意外访问而意外释放信息。虽然在某些情况下使用该指令可能会改善隐私，但我们警告说，它绝不是确保隐私的可靠或充分机制。特别是，恶意或受损的缓存可能无法识别或遵守此指令，并且通信网络可能容易受到窃听。历史缓冲区可以存储这些响应作为其正常操作的一部分。该指令的目的是满足某些用户和服务作者的既定要求，他们担心通过对缓存数据结构的意外访问而意外释放信息。虽然在某些情况下使用该指令可能会改善隐私，但我们警告说，它绝不是确保隐私的可靠或充分机制。特别是，恶意或受损的缓存可能无法识别或遵守此指令，并且通信网络可能容易受到窃听。历史缓冲区可以存储这些响应作为其正常操作的一部分。该指令的目的是满足某些用户和服务作者的既定要求，他们担心通过对缓存数据结构的意外访问而意外释放信息。虽然在某些情况下使用该指令可能会改善隐私，但我们警告说，它绝不是确保隐私的可靠或充分机制。特别是，恶意或受损的缓存可能无法识别或遵守此指令，并且通信网络可能容易受到窃听。虽然在某些情况下使用该指令可能会改善隐私，但我们警告说，它绝不是确保隐私的可靠或充分机制。特别是，恶意或受损的缓存可能无法识别或遵守此指令，并且通信网络可能容易受到窃听。虽然在某些情况下使用该指令可能会改善隐私，但我们警告说，它绝不是确保隐私的可靠或充分机制。特别是，恶意或受损的缓存可能无法识别或遵守此指令，并且通信网络可能容易受到窃听。**

 *** * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-05-15T05:20:48.777

`no-store`在正常情况下应该没有必要，并且会损害速度和可用性。它适用于 HTTP 响应包含非常敏感的信息，因此根本不应该将其写入磁盘缓存，无论对用户产生的负面影响如何。

这个怎么运作：

*   通常，即使浏览器等用户代理确定不应缓存响应，由于用户代理内部的原因，它仍可能将其存储到磁盘缓存中。此版本可用于“查看源代码”、“返回”、“页面信息”等功能，其中用户不一定再次请求该页面，但浏览器不会将其视为新页面视图并且提供用户当前正在查看的相同版本是有意义的。

*   使用`no-store`将阻止该响应被存储，但这可能会影响浏览器提供“查看源代码”、“返回”、“页面信息”等的能力，而无需向服务器发出新的、单独的请求，这是不可取的。换句话说，用户可能会尝试查看源代码，如果浏览器没有将其保存在内存中，他们要么会被告知这是不可能的，要么会导致对服务器的新请求。因此，`no-store`仅当这些功能无法正常或快速运行的受阻用户体验被确保内容不存储在缓存中的重要性超过时才应使用。

> 我目前的理解是它仅适用于中间缓存服务器。即使响应“无缓存”，中间缓存服务器仍然可以将内容保存到非易失性存储中。

这是不正确的。与 HTTP 1.1 兼容的中间缓存服务器将遵循`no-cache`和`must-revalidate`指令，确保内容不被缓存。使用这些指令将确保响应不会被任何中间缓存缓存，并且所有后续请求都将发送回源服务器。

如果中间缓存服务器不支持 HTTP 1.1，那么您将需要使用`Pragma: no-cache`并希望获得最好的结果。请注意，如果它不支持 HTTP 1.1，那么`no-store`无论如何都无关紧要。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-05-15T09:50:41.187

如果您想阻止所有缓存（例如，使用后退按钮时强制重新加载），您需要：

*   IE 无缓存

*   Firefox 没有商店

这里有我的相关信息：

[http://blog.httpwatch.com/2008/10/15/two-important-differences-between-firefox-and-ie-caching/](http://blog.httpwatch.com/2008/10/15/two-important-differences-between-firefox-and-ie-caching/)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-01-03T15:24:26.140

如果缓存系统正确实现了无存储，那么您就不需要无缓存。但并非所有人都这样做。此外，一些浏览器实现了 no-cache ，就像它是 no-store 一样。因此，虽然不是严格要求，但将两者都包括在内可能是最安全的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-10-28T11:30:37.520

对于 chrome，no-cache 用于在重新访问时重新加载页面，但如果您返回历史记录（后退按钮），它仍然会缓存它。要重新加载页面以返回历史记录，请使用 no-store。IE 需要重新验证才能在所有场合下工作。

所以只是为了确保避免我一直使用的所有错误和误解

```
Cache-Control: no-store, no-cache, must-revalidate 
```

如果我想确保它重新加载。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-06-24T13:07:01.673

请注意，从版本 5 到 8 的 Internet Explorer 在尝试下载通过 https 提供的文件和服务器发送`Cache-Control: no-cache`或`Pragma: no-cache`标头时会引发错误。

请参阅[http://support.microsoft.com/kb/812935/en-us](http://support.microsoft.com/kb/812935/en-us)

使用`Cache-Control: no-store`and`Pragma: private`似乎是最接近仍然有效的东西。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-15T04:55:39.757

最初我们在多年前使用 no-cache 并且确实在某些浏览器上遇到了一些陈旧内容的问题......不幸的是，不记得具体细节。

从那以后，我们决定只使用无商店。从那以后，任何浏览器或中介都没有回头或遇到过任何过时内容的问题。

这个空间肯定是由实现的现实与碰巧在各种 RFC 中编写的内容所主导。尤其是许多代理人倾向于认为通过用自己的政策取代他们应该遵循的政策，他们在“提高绩效”方面做得更好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-08-02T10:16:25.733

更糟糕的是，在某些情况下，no-cache 不能使用，但 no-store 可以：

[http://faindu.wordpress.com/2008/04/18/ie7-ssl-xml-flex-error-2032-stream-error/](http://faindu.wordpress.com/2008/04/18/ie7-ssl-xml-flex-error-2032-stream-error/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-01T17:22:40.067

为了回答这个问题，这里有两个参与者，客户端（请求）和服务器（响应）。

**客户：**

客户端只能使用一种缓存方法进行请求。有不同的方法，如果没有指定，将使用`default`.

*   **默认**：检查浏览器缓存：
    1.  如果缓存并且“新鲜”：从缓存中返回。
    2.  如果缓存，陈旧，但仍然“有效”：从缓存返回，并安排一次获取以更新缓存（供下次使用）。
    3.  如果缓存和陈旧：获取条件、缓存并返回。
    4.  如果未缓存：获取、缓存并返回。
*   **no-store**：获取并返回。
*   **reload**：获取、缓存和返回。（*默认-4*）
*   **no-cache**：检查浏览器缓存：
    1.  如果缓存：带条件获取、缓存并返回。（*默认-3*）
    2.  如果未缓存：获取、缓存并返回。（*默认-4*）
*   **force-cache**：检查浏览器缓存：
    1.  如果缓存：无论是否过时都返回它。
    2.  如果不缓存：获取、缓存并返回。（*默认-4*）
*   **only-if-cached**：检查浏览器缓存：
    1.  如果缓存：无论是否过时都返回它。
    2.  如果没有缓存：抛出网络错误。

笔记：

*   仍然“有效”意味着电流`age`在`stale-while-revalidate`生命周期内。它需要“重新验证”，但仍然可以退货。
*   这里的“Fetch”，为简单起见，是“non-conditional network fetch”的缩写。
*   “带条件获取”意味着使用诸如 的标头进行获取 `If-Modified-Since`，或者`ETag`服务器可以使用`304: (Not Modified)`.

[https://fetch.spec.whatwg.org/#concept-request-cache-mode](https://fetch.spec.whatwg.org/#concept-request-cache-mode)

**服务器:** :

现在我们了解了客户端可以做什么，服务器响应就更有意义了。查看`Cache-Control`标头，如果服务器返回：

*   **no-store**：告诉客户端根本不使用缓存
*   **no-cache**：告诉客户端它应该执行条件请求并忽略新鲜度
*   **max-age**：告诉客户端缓存“新鲜”多长时间
*   **stale-while-revalidate**：告诉客户端缓存“有效”多长时间
*   **不可变**：永远缓存

* * *

现在我们可以把它们放在一起。这意味着唯一的可能性是：

*   非条件网络获取
*   条件网络获取
*   返回过时的缓存
*   返回陈旧但有效的缓存
*   返回新的缓存
*   返回任何缓存

客户端或服务器的任何组合都可以指定要使用的方法或方法集。如果服务器返回`no-store`，则无论客户端请求类型如何，它都不会命中缓存。如果客户端请求是`no-store`，则无论服务器返回什么，它都不会缓存。如果客户端没有指定请求类型，服务器将使用`Cache-Control`.

服务器返回两者是没有意义的`no-cache`，`no-store`因为它**`no-store`会覆盖所有内容**。是的，您可能已经同时看到了两者，并且在损坏的浏览器实现之外它是无用的。尽管如此，`no-store`自 1999 年以来一直是规范的一部分：[https ://datatracker.ietf.org/doc/html/rfc2616#section-14.9.2](https://datatracker.ietf.org/doc/html/rfc2616#section-14.9.2)

在实际使用中，如果您的服务器支持`304: Not Modified`，并且您想使用客户端缓存作为提高速度的一种方式，但仍想强制网络获取，请使用`no-cache`. 如果不支持`304`，并且想要强制网络获取，请使用`no-store`. 如果您有时可以使用缓存，请使用新鲜度和重新验证标头。

实际上，如果您在客户端上混在一起`no-cache`，`no-store`几乎不会发生任何变化。然后，只发送几个标头，浏览器将处理不同的内部响应。`no-cache`如果您使用然后忘记使用它，则可能会出现问题。`no-cache`告诉它将响应存储在缓存中，以后没有它的请求可能会触发内部缓存。

有时您可能希望根据上下文在同一资源上混合方法。例如，您可能希望`reload`在服务工作者和后台同步上使用，但`default`用于网页本身。这是您可以根据自己的喜好操作用户代理（浏览器）缓存的地方。请记住，服务器通常对缓存的工作方式拥有最终决定权。

* * *

澄清一些可能的未来混淆。*客户端*可以使用请求*头*`Cache-Control`，告诉服务器在响应时不要使用自己的缓存系统。这与浏览器/服务器动态无关，更多关于服务器/数据库动态。

 *技术上也`no-store`意味着不得存储到任何非易失性存储（磁盘）并尽快从易失性存储（内存）中释放它。实际上，这意味着根本不使用缓存。该命令实际上是双向的。客户端请求`no-store`不应写入磁盘或数据库，并且是暂时的。

* * *

TL;DR：`no-store`覆盖`no-cache`. 两者都设置是没有用的，除非我们谈论的是不支持的或不支持的 HTTP/1.0 浏览器`no-store`（也许是 IE11？）。用于`no-cache`支持`304`。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-01-23T10:43:06.363

OWASP 对此进行了讨论：

> **缓存控制指令：no-cache 和 no-store 之间有什么区别？**
> 
> 响应中的 no-cache 指令指示该响应不得用于服务后续请求，即缓存不得显示在标头中设置了该指令的响应，但必须让服务器为请求提供服务。no-cache 指令可以包含一些字段名称；在这种情况下，响应可以从缓存中显示，除了指定的应该从服务器提供的字段名称。no-store 指令适用于整个消息，并指示缓存不得存储响应的任何部分或请求它的任何请求。
> 
> **我对这些指令完全安全吗？**
> 
> 不可以。但通常，除了 Expires: 0 （或足够回溯的 GMT 日期，例如 UNIX 纪元）之外，还要同时使用 Cache-Control: no-cache, no-store 和 Pragma: no-cache。即使设置了上述缓存控制指令，非 html 内容类型（如 pdf、word 文档、excel 电子表格等）也经常被缓存（尽管这因版本和额外使用 must-revalidate、pre-check=0、post-check 而异=0、max-age=0 和 s-maxage=0 在实践中有时至少会导致在某些情况下由于浏览器怪癖和 HTTP 实现而在浏览器关闭时删除文件）。此外，“自动完成”功能允许浏览器缓存用户在表单的输入字段中键入的任何内容。要检查这一点，表单标签或单独的输入标签应包含 'Autocomplete="Off" ' 属性。然而，

来源[在这里](https://www.owasp.org/index.php/OWASP_Application_Security_FAQ#What.27s_the_difference_between_the_cache-control_directives:_no-cache.2C_and_no-store.3F)。

# nhibernate - Sql 2008 Filestream with NHibernate

> ID：866824
> 
> 赞同：3
> 
> 时间：2009-05-15T03:13:52.793
> 
> 标签：nhibernate, fluent-nhibernate, filestream, varbinary

I am attempting to use Filestream in sql server 2008 to store user uploaded images.

My problem is that NHibernate will not error, but it also will not save the data into the database. No record is created.

The Image class below is a custom class (not to be confused with System.Drawing.Image)

```
public class ImageMap : ClassMap<Image>
{
    public ImageMap()
    {
        WithTable("Images");

        Id(x => x.ImageId).GeneratedBy.GuidComb().WithUnsavedValue(Guid.Empty);

        Map(x => x.ImageData);
        Map(x => x.Extension);

        References(x => x.Owner, "UserId");
    }
} 
```

My method to save looks like this:

```
public void Save(Image image)
    {
        ISession session = GetSession();

        session.SaveOrUpdate(image);
    } 
```

Maybe I'm saving wrong, maybe my mapping is off. ImageData is a varbinary(max) field in the database.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T15:41:48.413

The answer to this was simple. I deleted my override to the save method and it fixed itself. Our baseclass already had the save method defined and my override was just plain wrong.

```
public void Save(T entity)
    {
        using (ISession session = GetSession())
        using (ITransaction tx = session.BeginTransaction())
        {
            session.SaveOrUpdate(entity);
            tx.Commit();
        }
    } 
```

# ruby - 为什么 return 关键字会在我的“if 块”中引起问题？

> ID：866826
> 
> 赞同：5
> 
> 时间：2009-05-15T03:15:27.423
> 
> 标签：ruby

以下代码工作正常：

```
person = {:a=>:A, :b=>:B, :c=>:C}
berson = {:a=>:A1, :b=>:B1, :c=>:C1}

kerson = person.merge(berson) do | key, oldv, newv |
if key == :a
  oldv
elsif key == :b
  newv
else
  key
end
end

puts kerson.inspect 
```

但是如果我`return`在“if 块”中添加，我会得到一个错误：

```
person = {:a=>:A, :b=>:B, :c=>:C}
berson = {:a=>:A1, :b=>:B1, :c=>:C1}

kerson = person.merge(berson) do | key, oldv, newv |
if key == :a
  return oldv
elsif key == :b
  return newv
else
  return key
end
end

puts kerson.inspect 
```

上述代码的错误是：

```
unexpected return (LocalJumpError) 
```

谁能解释一下？我认为`return`可以在已经假设返回值的任何地方都可以选择使用。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-15T04:20:07.300

错误的原因是块实际上并没有它们自己的返回范围——从块的返回等同于从周围的方法返回。这里的环绕方法是什么？没有——它在顶层，所以它等同于做`ruby -e "return"`，这会给你同样的错误。如果将其粘贴在方法中，它将使该方法返回执行的 if 子句的第一个分支的值。

# php - 有没有办法使用php检查电子邮件是否存在？

> ID：866828
> 
> 赞同：0
> 
> 时间：2009-05-15T03:17:07.980
> 
> 标签：php, email, spam

我最近收到越来越多的垃圾邮件。我已经使用正则表达式验证了我的电子邮件，所有的电子邮件都必须是这样的：xxx@xxxx.xxx

但我现在的问题是，有很多垃圾邮件发送者，输入 hsdjsdhgf@gmail.com，iluvhahahahah@yahoo.com，这些电子邮件不存在，因为我试图向他们发送电子邮件。

如何避免那些电子邮件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T03:19:20.393

你找错树了。阻止垃圾邮件的更好方法是通过其他方式从表单中过滤掉它们。如果您不是像[reCAPTCHA](http://recaptcha.net/)这样的 CAPTCHA 的粉丝，您应该研究一下所谓的[“蜜罐”](http://www.rustylime.com/show_article.php?id=676)。本质上，使用“电子邮件”等通用名称向表单添加一个额外的字段，并使用 CSS 将其隐藏。对于禁用样式浏览的任何人，将其标记为“留空”。如果该字段中有一个值，它很可能是一个机器人，所以扔掉提交。瞧。它们非常适用于垃圾邮件发送者并不真正关心的普通中型网站。看看[这个相关的问题](https://stackoverflow.com/questions/111576/when-the-bots-attack)。

综合考虑，我喜欢蜜罐，因为它通常足以阻止 99% 的垃圾邮件，同时又不会让普通用户不得不做任何事情。这个很重要。

快速回答您最初的问题：验证电子邮件有效的唯一方法是实际向该地址发送一封电子邮件，看看它是否被退回。然而，这通常不值得麻烦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T03:35:37.360

如果他们正在注册时事通讯或您将多次通过电子邮件发送给他们的东西，我想向他们发送确认电子邮件，他们必须单击链接以验证它是真实的电子邮件。如果几天后他们不确认，那么您知道可以删除它。如果他们确实确认了，那么您就知道这是一个真实的人。当您第一次向他们发送电子邮件时，您仍然会收到退回邮件，但它会消除重复发生的退回邮件。

我也喜欢验证码，或者如果您想要更简单的内容，请让他们输入您网站标题的第一个字母（或其他在页面上始终保持不变的单词），它适用于中小型网站，但主要是有效的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T03:51:51.690

**简短的回答：**

使用验证码。

**长答案：**

好吧，您可以进行 MX 查找，在其中找到负责为其给定域发送电子邮件的服务器，然后查询邮件服务器以查看地址是否有效。在理想情况下，这将是验证电子邮件地址的理想方式。

不幸的是，作为一种反垃圾邮件措施，如今大多数邮件服务器都会以全部肯定或全部否定来响应此类查询。

这给我们留下了一个非常实用的解决方案：验证码。

# svn - Subversion（使用 VisualSVN/Tortoise）拒绝下拉新文件

> ID：866835
> 
> 赞同：8
> 
> 时间：2009-05-15T03:19:31.190
> 
> 标签：svn, visualsvn, tortoisesvn

最近开始出现一个问题，其中一些添加到 subversion 存储库的新文件在执行更新后不会被拉到其他客户端。

如果我用 Tortoise 浏览存储库，我可以看到该文件。然后我可以右键单击它并选择“更新到修订版”，这会将文件拉到客户端。不幸的是，这是非常耗时的，因为无法提取文件夹中的所有文件——即我必须为每个文件单独执行此操作。

奇怪的是，它不会出现在所有文件中，也不会出现在所有客户端机器上。我已尝试完全删除工作文件夹并将其全部拉下，但问题仍然存在。

我正在使用最新版本的 Tortoise 和 VisualSVN。

其他人见过这样的东西吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-15T10:02:13.640

~~Tortoise~~ SVN 1.6.1中的[已知错误](http://groups.google.com/group/tortoisesvn-dev/browse_thread/thread/b3f6f04feac7f8e0)：如果您添加一个空文件夹，您的工作副本中的文件夹深度将被限制为“空”。您可以通过使用“更新到修订...”对话框更新一次并选择“完全递归”作为深度来解决此问题。

这已在 1.6.2 中修复。

**编辑**：请注意 TortoiseSVN 使用 SVN 客户端库，这是错误所在。命令行客户端也有同样的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T03:26:40.533

我唯一能想到的可能是它与 1.5 到 1.6 的过渡有关？确保每个人都有一个基于 1.6 版本的 tortoiseSVN，然后再试一次。

此外，您提出问题的方式听起来像是在使用 SVN 分发文件而不是并发。如果是这种情况，请考虑使用 Unison 之类的工具而不是 SVN。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-16T10:47:01.070

我只是碰巧有同样的问题。这是一个解决方案：

```
svn update `svn ls` 
```

是的，我知道这个问题离现在还很远，但它在网络搜索中仍然很高。

# mutex - 单词“mutex”的复数形式

> ID：866837
> 
> 赞同：51
> 
> 时间：2009-05-15T03:20:25.993
> 
> 标签：mutex

*portmanteau mutex*的正确复数形式是什么。它是*互斥锁*还是*互斥*锁？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-05-15T04:25:26.553

从纯语言学的角度来看，正确的用法是*互斥体，因为**互斥体*这个词的起源不是拉丁语。如果*mutices*进入常规用法，规范主义者会痛苦地哀号。

-ices用法（例如*index*和*vertex的复数**形式*）正在失宠。*例如，索引*和*顶点*都是正确的用法。

 **** * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-05-15T03:28:20.980

让他们的常见用法决定...

[谷歌战斗](http://www.googlefight.com/index.php?lang=en_US&word1=mutexes&word2=mutices)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-05-15T03:27:36.740

互斥体。这实际上是正确的——绝大多数人（根据我的经验，当然）称它们为互斥体，而不是互斥体，并且英语是一种由使用定义的语言。:)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-05-15T03:41:58.047

每个人都知道正确答案是***Mutii***。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-15T03:23:01.790

由于*mutex*是“mutual exclude”的缩写，我只能想象“mutual excludes”会变成*mutexes*。*静音*会令人困惑。最好是明确的。

作为旁注：它不是一个portmanteau，或者它将是一个*mutsion*。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-15T03:53:08.207

没有*正式*的正确形式，因为“mutex”没有获得足够广泛的流通以进入任何主要的英语词典。因此，最正确的术语是人们最常使用的术语。而且我认为谷歌点击是（相对）使用频率的一个很好的指标，正如[great_lama 所指出的那样](https://stackoverflow.com/questions/866837/plural-form-of-word-mutex/866851#866851)。

其他以*-ex*或*-ix*结尾的英语名词：

*   词缀
*   附件
*   顶尖
*   附录
*   宫颈
*   回旋曲
*   复杂的
*   皮质
*   耶稣受难像
*   双工
*   螺旋
*   野山羊
*   指数
*   中缀
*   乳胶
*   矩阵
*   凤凰
*   字首
*   后缀
*   反射
*   混音
*   后缀
*   顶点
*   涡流

还有更多不常见的词。如果您在字典中查找这些，您会发现它们中的大多数都将*两个*复数显示为可接受的。有几个只有*-exes* / *-ixes*形式，但很少或没有（取决于您使用的字典）只有*-ices*形式。

总之，我相信*mutex是**mutex*的正确复数形式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T03:26:22.110

两者任一。我都见过（尽管互斥锁更为常见）。

Mutex 不在我所知道的任何真正的字典中，因此没有“官方答案”。

不过，索引可以复数为索引或索引，因此互斥体可以效仿是有道理的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T03:34:44.647

由于单词[*apex*](http://dictionary.reference.com/browse/apex)可以复数为*apexes*或*apices*，我想说你可以发音为*mutexes*或*mutices*。什么适合你。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T03:35:20.310

我认为歇斯底里的葡萄干（在这种情况下，“互斥锁”是一个混合词）在解决此类问题时不应给予太大的重视。也许考虑相似的词及其用法会更有用；反射 -> 反射例如。

或者，使用最简单的选择：英语中的大多数复数形式使用 -s/-es（取决于最后一个字母是否是元音）；在这种情况下-es。

我想我看不出有任何理由使用这种替代方法，除非是为了向拉丁语致敬，拉丁语曾经被认为是所有语言中最高贵的。:)

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-05-15T11:56:51.383

也许它像羊？单数和复数？

# compiler-optimization - 在什么情况下编译器可以改变程序语句的执行顺序？

> ID：866840
> 
> 赞同：3
> 
> 时间：2009-05-15T03:23:18.497
> 
> 标签：compiler-optimization

如果这[不是一个真正的问题](https://stackoverflow.com/questions/865871/will-30-goto-10-always-go-to-10-closed)，请随时关闭；）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T03:30:59.477

不仅编译器可以重新排序执行（主要是为了优化），大多数现代处理器也这样做。阅读有关执行重新排序和[内存屏障](http://en.wikipedia.org/wiki/Memory_barrier#Out-of-order_execution_versus_compiler_reordering_optimizations)的更多信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-15T04:21:59.400

编译器可以在认为适合优化目的时更改语句的执行顺序，并且此类更改不会改变代码的可观察行为。

一个非常简单的例子——

```
int func (int value)
{
    int result = value*2;
    if (value > 10)
    {
       return result;
    }
    else
    {
       return 0;
    }
} 
```

一个天真的编译器可以完全按照所示的顺序为此生成代码。首先计算“结果”并仅在原始值大于 10 时返回它（如果不是，“结果”将被忽略 - 不必要地计算）。

但是，一个理智的编译器会看到，只有在“value”大于 10 时才需要计算“result”，因此可以轻松地将计算“value*2”移动到第一个大括号内，并且只有在“value”时才这样做实际上大于 10（不用说，编译器在优化时并没有*真正*查看 C 代码 - 它在较低级别工作）。

这只是一个简单的例子。可以创建更复杂的示例。很有可能一个 C 函数最终看起来几乎不像它的编译形式的 C 表示，具有足够积极的优化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T05:40:26.063

许多编译器使用称为“公共子表达式消除”的东西。例如，如果您有以下代码：

```
for(int i=0; i<100; i++) {
    x += y * i * 15;
} 
```

编译器会注意到 y * 15 是*不变*的（它的值不会改变）。所以它将计算 y * 15，将结果保存在寄存器中并将循环语句更改为“x += r0 * i”。这是一个人为的例子，但是在使用数组索引或任何其他基本 + 偏移类型的情况时，您经常会看到这样的表达式。

# c - 我怎样才能得到最好的准确结果？

> ID：866849
> 
> 赞同：0
> 
> 时间：2009-05-15T03:27:22.717
> 
> 标签：c

鉴于：

```
unsigned int a, b, c, d; 
```

我想：

```
d = a * b / c; 
```

和（a *b）可能溢出；(b/c) 也可能等于 0 并给出较低的准确度。

也许转换为 64 位可以让事情正常工作，但我想知道在 d 中获得最准确结果的最佳方法。

有什么好的解决办法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T03:38:04.000

我会：

*   转换为 64 位，如果这适用于您的 a、b 和 c 范围。
*   [使用像GMP](http://gmplib.org/)这样的无限精度库
*   如果您发现这些结果可以接受，则转换为`float`或并返回。`double`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T03:43:13.317

为了获得最佳准确度/精度，您需要在除法之前进行乘法运算。正如您所暗示的那样，您将希望使用位数是 int 两倍的东西：

```
int64_t d = (int64_t) a * (int64_t) b;
d /= c; 
```

您不需要两个演员表，但可以说它们使它更清晰一些。

请注意，如果 c 足够小，则 d 仍然可以大于 int。这对你来说可能是也可能不是问题。如果您确定不是，则可以在最后转换为 int 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T03:41:21.683

使用 float 或 double，在浮点运算中，**允许除以零**，结果将是正无穷或负无穷

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T03:41:58.763

您始终可以对 a * b 上的溢出进行显式检查：

```
long long e = (long long) a * (long long) b;
if (e <= INT_MAX) {
    d = e / c;
} else {
    d = a * (b / c);
} 
```

当然，这只适用于非负 a、b、c。如果它们可能是负数，您还必须检查 INT_MIN。

[更新] 您还可以检查 a 和 b 中的哪一个更大，从而在除以 c 时损失更少的精度：

```
if (a >= b) {
    d = a / c * b;
} else {
    d = a * (b / c);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T03:46:43.247

对于您所说的问题，我会这样做`d = (long long)a * b / c;`

`float`当您只需要更多位时，没有意义。无需重新声明或强制转换所有内容。铸造`a`足以在表达中促进`b`和`c`扩大规模。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T03:39:36.790

为什么不使用`float`or `double`？A `float`（在英特尔芯片上）是一个 32 位浮点数，所以您不一定需要 64 位来进行操作？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-02T12:36:14.367

我会按照以下方式做一些事情：

```
if(c){
    d = (long long)a * b;
    d /= c;
}
else{
    // some error code because div by 0 is not allowed
} 
```

# cakephp - CakePHP - 如何在主页上授予公共授权

> ID：866852
> 
> 赞同：0
> 
> 时间：2009-05-15T03:28:41.947
> 
> 标签：cakephp

我设置了基本的身份验证/授权设置，但现在的一个问题是，每次我尝试访问[http://localhost:1234/](http://localhost:1234/)时，都需要用户登录。

如何/在哪里制作 Auth->authorize("index") 在主页上？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T12:13:06.243

在控制器的**beforeFilter()中**

添加以下代码

```
> $this->Auth->allow('actionname'); 
```

假设如果我想允许在不登录的情况下添加/注册用户，那么我会在 users_controller.php 文件的**beforeFilter()**函数中这样做。

```
> $this->Auth->allow('add'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T03:46:24.103

在 app_controller.php 的 beforeFilter() 内部：

```
 $this->Auth->authorize("display"); 
```

解决了这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-05T21:12:07.200

对于 cakephp 1.3，你现在必须这样做：

```
var $components = array(
   'Auth' => array(
   'authorize' => 'controller',
   'allowedActions' => array('index','**display**');
   )
); 
```

请记住，您还可以配置路由器：

```
Router::connect('/facebook', array('controller' => 'pages', 'action' => '**display**', 'facebook')); 
```

# c# - 如何解决此错误，“尝试反序列化参数时出错”

> ID：866854
> 
> 赞同：24
> 
> 时间：2009-05-15T03:30:21.677
> 
> 标签：c#, web-services, sharepoint

我有一个 Web 服务在一个环境中运行良好，但在另一个环境中却不行。

Web 服务从 SharePoint 获取文档元数据，它在我无法调试但通过日志记录的服务器上运行，我确认该方法成功进入和退出。

错误的原因可能是什么？

错误信息是，

```
The formatter threw an exception while trying to deserialize the message: 

There was an error while trying to deserialize parameter http://CompanyName.com.au/ProjectName:GetDocumentMetaDataResponse. 

The InnerException message was 'Error in line 1 position 388\. 'Element' 'CustomFields' from namespace 'http://CompanyName.com.au/ProjectName' is not expected. 

Expecting element 'Id'.'.  Please see InnerException for more details. 
```

InnerException 是

System.ServiceModel.Dispatcher.NetDispatcherFaultException 被捕获 Message="格式化程序在尝试反序列化消息时抛出异常：尝试反序列化参数[http://CompanyName.com.au/ProjectName:GetDocumentMetaDataResponse](http://CompanyName.com.au/ProjectName:GetDocumentMetaDataResponse)时出错。

InnerException 消息是

```
'Error in line 1 position 388\. 
'Element' 'CustomFields' 
from namespace 'http://CompanyName.com.au/ProjectName' is not expected. 
Expecting element 'Id'.'.  Please see InnerException for more details."

  Source="mscorlib"
  Action="http://schemas.microsoft.com/net/2005/12/windowscommunicationfoundation/dispatcher/fault"
  StackTrace:
    Server stack trace: 
       at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameterPart(XmlDictionaryReader reader, PartInfo part, Boolean isRequest)
       at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameter(XmlDictionaryReader reader, PartInfo part, Boolean isRequest)
       at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameters(XmlDictionaryReader reader, PartInfo[] parts, Object[] parameters, Boolean isRequest)
       at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeBody(XmlDictionaryReader reader, MessageVersion version, String action, MessageDescription messageDescription, Object[] parameters, Boolean isRequest)
       at System.ServiceModel.Dispatcher.OperationFormatter.DeserializeBodyContents(Message message, Object[] parameters, Boolean isRequest)
       at System.ServiceModel.Dispatcher.OperationFormatter.DeserializeReply(Message message, Object[] parameters)
       at System.ServiceModel.Dispatcher.ProxyOperationRuntime.AfterReply(ProxyRpc& rpc)
       at System.ServiceModel.Channels.ServiceChannel.HandleReply(ProxyOperationRuntime operation, ProxyRpc& rpc)
       at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs, TimeSpan timeout)
       at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs)
       at System.ServiceModel.Channels.ServiceChannelProxy.InvokeService(IMethodCallMessage methodCall, ProxyOperationRuntime operation)
       at System.ServiceModel.Channels.ServiceChannelProxy.Invoke(IMessage message)
    Exception rethrown at [0]: 
       at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)
       at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData& msgData, Int32 type)
       at CompanyName.ProjectName.External.Sharepoint.WebServiceProxies.SharepointProjectNameSiteService.ProjectNameSiteSoap.GetDocumentMetaData(GetDocumentMetaDataRequest request)
       at CompanyName.ProjectName.External.Sharepoint.WebServiceProxies.SharepointProjectNameSiteService.ProjectNameSiteSoapClient.CompanyName.ProjectName.External.Sharepoint.WebServiceProxies.SharepointProjectNameSiteService.ProjectNameSiteSoap.GetDocumentMetaData(GetDocumentMetaDataRequest request) in D:\Source\TFSRoot\ProjectName\trunk\CodeBase\External\CompanyName.ProjectName.External.Sharepoint.WebServiceProxies\Service References\SharepointProjectNameSiteService\Reference.cs:line 2141
       at CompanyName.ProjectName.External.Sharepoint.WebServiceProxies.SharepointProjectNameSiteService.ProjectNameSiteSoapClient.GetDocumentMetaData(ListSummaryDto listSummary, FileCriteriaDto criteria, List`1 customFields) in D:\Source\TFSRoot\ProjectName\trunk\CodeBase\External\CompanyName.ProjectName.External.Sharepoint.WebServiceProxies\Service References\SharepointProjectNameSiteService\Reference.cs:line 2150
       at CompanyName.ProjectName.Services.Shared.SharepointAdapter.GetDocumentMetaData(ListSummaryDto listSummary, FileCriteriaDto criteria, List`1 customFields) in D:\Source\TFSRoot\ProjectName\trunk\CodeBase\Services\CompanyName.ProjectName.Services\Shared\SharepointAdapter.cs:line 260
       at CompanyName.ProjectName.Services.Project.ProjectDocumentService.SetSharepointDocumentData(List`1 sourceDocuments) in D:\Source\TFSRoot\ProjectName\trunk\CodeBase\Services\CompanyName.ProjectName.Services\Project\ProjectDocumentService.cs:line 1963
       at CompanyName.ProjectName.Services.Project.ProjectDocumentService.GetProjectConversionDocumentsImplementation(Int32 projectId) in D:\Source\TFSRoot\ProjectName\trunk\CodeBase\Services\CompanyName.ProjectName.Services\Project\ProjectDocumentService.cs:line 3212
  InnerException: System.Runtime.Serialization.SerializationException
       Message="Error in line 1 position 388\. 'Element' 'CustomFields' from namespace 'http://CompanyName.com.au/ProjectName' is not expected. Expecting element 'Id'."
       Source="System.Runtime.Serialization"
       StackTrace:
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.ThrowRequiredMemberMissingException(XmlReaderDelegator xmlReader, Int32 memberIndex, Int32 requiredIndex, XmlDictionaryString[] memberNames)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.GetMemberIndexWithRequiredMembers(XmlReaderDelegator xmlReader, XmlDictionaryString[] memberNames, XmlDictionaryString[] memberNamespaces, Int32 memberIndex, Int32 requiredIndex, ExtensionDataObject extensionData)
            at ReadFileMetaDataDtoFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString[] , XmlDictionaryString[] )
            at System.Runtime.Serialization.ClassDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, DataContract& dataContract)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Int32 id, RuntimeTypeHandle declaredTypeHandle, String name, String ns)
            at ReadArrayOfFileMetaDataDtoFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString , XmlDictionaryString , CollectionDataContract )
            at System.Runtime.Serialization.CollectionDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, DataContract& dataContract)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Int32 id, RuntimeTypeHandle declaredTypeHandle, String name, String ns)
            at ReadMetaDataSearchResultsDtoFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString[] , XmlDictionaryString[] )
            at System.Runtime.Serialization.ClassDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, DataContract& dataContract)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Int32 id, RuntimeTypeHandle declaredTypeHandle, String name, String ns)
            at ReadGetDocumentMetaDataResponseBodyFromXml(XmlReaderDelegator , XmlObjectSerializerReadContext , XmlDictionaryString[] , XmlDictionaryString[] )
            at System.Runtime.Serialization.ClassDataContract.ReadXmlValue(XmlReaderDelegator xmlReader, XmlObjectSerializerReadContext context)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.ReadDataContractValue(DataContract dataContract, XmlReaderDelegator reader)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator reader, String name, String ns, DataContract& dataContract)
            at System.Runtime.Serialization.XmlObjectSerializerReadContext.InternalDeserialize(XmlReaderDelegator xmlReader, Type declaredType, DataContract dataContract, String name, String ns)
            at System.Runtime.Serialization.DataContractSerializer.InternalReadObject(XmlReaderDelegator xmlReader, Boolean verifyObjectName)
            at System.Runtime.Serialization.XmlObjectSerializer.ReadObjectHandleExceptions(XmlReaderDelegator reader, Boolean verifyObjectName)
            at System.Runtime.Serialization.DataContractSerializer.ReadObject(XmlDictionaryReader reader, Boolean verifyObjectName)
            at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.DeserializeParameterPart(XmlDictionaryReader reader, PartInfo part, Boolean isRequest)
       InnerException: 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T03:36:55.470

您确定您的 Web 服务已正确部署到不工作的环境中。看起来类型已经过时了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-12-22T05:56:12.770

发生这种情况是因为 Web 服务依赖于使用 XmlSerializer 将 wsdl 转换为 XML，而 XML 不支持混合模式属性，如下所示：

```
public string strThing { get; private set; } 
```

请参阅：http: [//msdn.microsoft.com/en-us/library/ms978420.aspx](http://msdn.microsoft.com/en-us/library/ms978420.aspx)

更多信息：[http ://www.geekscrapbook.com/2010/03/06/serializing-data-with-system-runtime-serialization-datacontractserializer/](http://www.geekscrapbook.com/2010/03/06/serializing-data-with-system-runtime-serialization-datacontractserializer/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-15T03:41:21.230

我对此有一个解决方案，但不确定为什么这会因一个环境与另一个环境不同 - 尽管两个环境之间的一个很大区别是 WSS svc pack 1 安装在发生错误的环境中。

为了解决这个问题，我从这个链接中得到了一个很好的线索 - [http://silverlight.net/forums/t/22787.aspx](http://silverlight.net/forums/t/22787.aspx)即“请检查您的服务的 Xml 架构”和“架构中的序列按字母顺序排序"

查看生成的 wsdl，我注意到对于导致错误的序列化类，该类的属性在 wsdl 中不可见。

类的定义对于大多数属性都有私有设置器，但对于 CustomFields 属性没有，即..

```
[Serializable]
public class FileMetaDataDto
{
    .
    . a constructor...   etc and several other properties edited for brevity
    . 

    public int Id { get; private set; }
    public string Version { get; private set; }
    public List<MetaDataValueDto> CustomFields { get; set; }

} 
```

从 setter 中删除 private 并重新部署服务，然后再次查看 wsdl，这些属性现在可见，并且修复了原始错误。

所以更新前的wsdl是

```
- <s:complexType name="ArrayOfFileMetaDataDto">
- <s:sequence>
  <s:element minOccurs="0" maxOccurs="unbounded" name="FileMetaDataDto" nillable="true" type="tns:FileMetaDataDto" /> 
  </s:sequence>
  </s:complexType>
- <s:complexType name="FileMetaDataDto">
- <s:sequence>
  <s:element minOccurs="0" maxOccurs="1" name="CustomFields" type="tns:ArrayOfMetaDataValueDto" /> 
  </s:sequence>
  </s:complexType> 
```

更新后的wsdl是

```
- <s:complexType name="ArrayOfFileMetaDataDto">
- <s:sequence>
  <s:element minOccurs="0" maxOccurs="unbounded" name="FileMetaDataDto" nillable="true" type="tns:FileMetaDataDto" /> 
  </s:sequence>
  </s:complexType>
- <s:complexType name="FileMetaDataDto">
- <s:sequence>
  <s:element minOccurs="1" maxOccurs="1" name="Id" type="s:int" /> 
  <s:element minOccurs="0" maxOccurs="1" name="Name" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="Title" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="ContentType" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="Icon" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="ModifiedBy" type="s:string" /> 
  <s:element minOccurs="1" maxOccurs="1" name="ModifiedDateTime" type="s:dateTime" /> 
  <s:element minOccurs="1" maxOccurs="1" name="FileSizeBytes" type="s:int" /> 
  <s:element minOccurs="0" maxOccurs="1" name="Url" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="RelativeFolderPath" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="DisplayVersion" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="Version" type="s:string" /> 
  <s:element minOccurs="0" maxOccurs="1" name="CustomFields" type="tns:ArrayOfMetaDataValueDto" /> 
  <s:element minOccurs="0" maxOccurs="1" name="CheckoutBy" type="s:string" /> 
  </s:sequence>
  </s:complexType> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T03:38:17.837

你有这个命名空间设置吗？您必须确保此命名空间与消息命名空间相匹配。如果您可以使用 xml 输入和可能有帮助的数据对象更新您的问题。

```
[DataContract(Namespace = "http://CompanyName.com.au/ProjectName")]
public class CustomFields
{
  // ...
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-27T06:48:44.823

确保您返回的表具有架构。如果没有，则创建一个默认模式（即在该表中添加一列）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-10-22T09:31:51.750

就我而言；我的 WCF 服务函数正在使用`List<byte> Types`参数，我在客户端收到此异常。然后我将其更改为`byte[] Types`，更新了服务参考并解决了问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-18T16:15:09.300

我找到了实际的解决方案...从客户端调用您的服务时出现问题..检查以下事项。

1.  确保正确放置所有 [datacontract]、[datamember] 属性，即确保 WCF 没有错误

2.  WCF 客户端（web.config 或任何窗口应用程序配置）确保配置条目正确指向正确的条目.. 绑定信息、服务的 url..etc..etc

然后上面的问题： tempuri 问题已解决.. 它与命名空间无关.. 虽然您确定您使用默认值，

希望它可以节省您的时间！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-24T16:03:22.870

在我们的例子中，问题是我们更改了默认的**根命名空间**名称。

![项目配置屏幕](https://i.stack.imgur.com/o7778.png)

这是项目配置屏幕

我们最终决定回到原来的名字，问题就解决了。

问题实际上是 Root 命名空间中的点。有两个点（**Name.Child.Child**）它不起作用。但是有一个（**Name.ChidChild**）可以工作。

# unit-testing - 如何使用 Selenium 测试模态对话框？

> ID：866856
> 
> 赞同：8
> 
> 时间：2009-05-15T03:31:51.737
> 
> 标签：unit-testing, selenium, selenium-ide

我开始使用[Selenium IDE](http://seleniumhq.org/)并尝试测试一个充满模式对话框 ( `window.showModalDialog`) 的 web 应用程序。

记录测试似乎有效（除了弹出对话框时日志中没有任何内容），但它们无法正常播放。该脚本实际上打开了窗口（由单击按钮触发），但随后只是无限期地等待。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-01T07:58:29.130

我一直在使用 Selenium IDE 来测试 jQuery modals 已经有一段时间了，我从来没有遇到过任何问题。以下是我为确保测试在播放时正确执行而做的事情：

*   以尽可能低的速度执行脚本
*   当模式打开时，我使用 waitForElementPresent 命令来验证页面上是否存在至少一个组成元素；论点是，如果一个元素正确加载，则可以安全地假设所有元素以及模态窗口都正确加载。

希望这可以帮助。如果您需要进一步的帮助，您可以与我分享代码以及 IDE 向您抛出的执行错误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T03:54:23.650

从[Selenium FAQ](http://wiki.openqa.org/display/SEL/Selenium+Core+FAQ#SeleniumCoreFAQ-Ican%27tinteractwithapopupdialog.Myteststopsinitstracks!)中，Selenium 显然适用于某些类型的对话框，但不适用于其他类型：

> 我无法与弹出对话框交互。我的测试停止了！
> 
> 您可以，但前提是对话框是警报或确认对话框。其他特殊对话框无法被 javascript 关闭，因此目前无法与之交互。其中包括“保存文件”、“记住此密码”(Firefox) 和模式 (IE) 对话框。当它们出现时，Selenium 只能绝望地绞着手。
> 
> 要解决此问题，您可以使用解决方法（如果存在）；否则你可能不得不从你的自动化语料库中排除测试。对于 Firefox 中的“保存文件”对话框，可以在通过 RC 运行时指定自定义模板，该模板将始终导致文件下载到指定位置，而无需询问用户（参见 [http://forums.openqa.org /thread.jspa?messageID=31350](http://forums.openqa.org/thread.jspa?messageID=31350)）。在您选择记住它之后，“记住此密码”对话框不应再次出现。目前，对于 IE 模式对话框，没有什么可以做的。

我似乎记得有人使用[AutoHotKey](http://www.autohotkey.com/)脚本解决了这个问题，该脚本关闭了对话框。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T21:55:46.300

模态窗口被黑了:) [http://seleniumdeal.blogspot.com/2009/01/handling-modal-window-with-selenium.html](http://seleniumdeal.blogspot.com/2009/01/handling-modal-window-with-selenium.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-26T14:40:32.777

这就是我在 Selenium IDE 中处理弹出警报的方式

右键单击元素（在这种情况下是您的弹出窗口），您可以选择一些命令。还有一个显示所有可用命令，这可能会有所帮助。您应该使用 AssertElementPreset，我猜在这种情况下最好的定位器是 CSS。所以你可以选择 AssertElementPresent。

或者

您可以在 Selenium IDE 上使用两个命令

```
selectWindow | null
verifyElementPresent | css=div.content 
```

希望这可以帮助！

# c# - 帮助字节移位

> ID：866859
> 
> 赞同：2
> 
> 时间：2009-05-15T03:33:45.413
> 
> 标签：c#, perl, byte-shifting

我需要对文本文件进行字节移位。我对 perl 一无所知，但我在 perl 中找到了一段完美的代码，称为[moz-byteshift.pl](http://www.alain.knaff.lu/howto/MozillaCustomization/moz-byteshift.pl)（[文档](http://www.alain.knaff.lu/howto/MozillaCustomization/locked.html)）。这正是我想做的，但我需要在 C# 中完成。

下面是 perl 文件的源代码：

```
#!/usr/bin/perl

# To perform a byteshift of 7
#   To decode: moz-byteshift.pl -s -7 <infile >outfile
#   To encode: moz-byteshift.pl -s  7 <infile >outfile

# To perform a byteshift of 13
#   To decode: moz-byteshift.pl -s -13 <infile >outfile
#   To encode: moz-byteshift.pl -s  13 <infile >outfile

use encoding 'latin1';
use strict;
use Getopt::Std;

use vars qw/$opt_s/;

getopts("s:");
if(!defined $opt_s) {
  die "Missing shift\n";
}

my $buffer;
while(1) {
  binmode(STDIN, ":raw");
  my $n=sysread STDIN, $buffer, 1;
  if($n == 0) {
    last;
  }
  my $byte = unpack("c", $buffer);
  $byte += 512 + $opt_s;
  $buffer = pack("c", $byte);
  binmode(STDOUT, ":raw");
  syswrite STDOUT, $buffer, 1;
} 
```

如果有人至少可以解释 perl 脚本是如何工作的，那就太好了。C# 中等效的示例代码会更好。=)

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T04:05:28.317

没什么好说的。它一次读取一个文件，将每个字节的值调整为任意值（通过 -s 标志指定），然后写出调整后的字节。它是文本文件的 ROT-13 加密的二进制等价物。

其余的细节是特定于 Perl 如何做这些事情的。getopts() 是一个处理命令行开关的函数（来自 Getopt::Std 模块）。binmode() 将文件句柄置于原始模式以绕过 Perl 通常在 I/O 期间执行的任何魔法。sysread() 和 syswrite() 函数用于低级流访问。pack() 和 unpack() 函数用于读写二进制数据；Perl 不做原生类型。

在 C 中重新实现这将是微不足道的。我建议这样做（并在需要时从 C# 绑定到它）而不是直接移植到 C#。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T13:29:50.473

代码的作用是：从标准输入一个一个地读取每个字节（在将其切换到原始模式后，不会发生转换）。解包获取刚刚读取的字符的字节值，因此“0”读取变为 0x30。选择 latin1 编码以使这种转换是一致的（例如，参见[http://www.cs.tut.fi/~jkorpela/latin9.html](http://www.cs.tut.fi/~jkorpela/latin9.html)）。

然后使用 -s 选项在命令行中指定的值与 512 一起添加到此字节以模拟模运算。这样，-s 0、-s 256 等是等效的。我不确定为什么需要这样做，因为我会假设下面的包已经解决了这个问题，但我认为他们一定有充分的理由把它放在那里。

然后，将原始字节写入标准输入。

当您在包含字符 012345 的文件上运行它时会发生以下情况（我将数据放在**DATA**部分中）：

```
E:\Test> byteshift.pl -s 1 | xxd
0000000: 3132 3334 3536 0b                        123456. 
```

每个字节值加一。

```
E:\Test> byteshift.pl -s 257 | xxd
0000000: 3132 3334 3536 0b                        123456. 
```

请记住 257 % 256 = 1。即：

```
$byte += $opt_s;
$byte %= 256; 
```

相当于代码中使用的单步。

很久以后：好的，我不知道 C#，但这是我能够使用在线文档拼凑而成的。知道 C# 的人应该解决这个问题：

```
using System;
using System.IO;

class BinaryRW {
    static void Main(string[] args) {
        BinaryWriter binWriter = new BinaryWriter(
                Console.OpenStandardOutput()
                );
        BinaryReader binReader = new BinaryReader(
                Console.OpenStandardInput()
                );

        int delta;

        if ( args.Length < 1 
                || ! int.TryParse( args[0], out delta ) )
        {
            Console.WriteLine(
                    "Provide a non-negative delta on the command line"
                    );
        } 
        else {       
            try  {
                while ( true ) {
                    int bin = binReader.ReadByte();
                    byte bout = (byte) ( ( bin + delta ) % 256 );
                    binWriter.Write( bout );
                }
            }

            catch(EndOfStreamException) { }

            catch(ObjectDisposedException) { }

            catch(IOException e) {
                Console.WriteLine( e );        
            }

            finally {
                binWriter.Close();
                binReader.Close();

            }
        }
    }
}

E:\Test> xxd bin
0000000: 3031 3233 3435 0d0a 0d0a                 012345....

E:\Test> b 0 < bin | xxd
0000000: 3031 3233 3435 0d0a 0d0a                 012345....

E:\Test> b 32 < bin | xxd
0000000: 5051 5253 5455 2d2a 2d2a                 PQRSTU-*-*

E:\Test> b 257 < bin | xxd
0000000: 3132 3334 3536 0e0b 0e0b                 123456.... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T13:36:20.520

从其他答案来看，C# 中的等价物看起来像这样：

```
using(Stream sIn = new FileStream(inPath))
{
  using(Stream sOut = new FileStream(outPath))
  {
    int b = sIn.ReadByte();
    while(b >= 0)
    {
      b = (byte)b+1; // or some other value
      sOut.WriteByte((byte)b);
      b = sIn.ReadByte();
    }
    sOut.Close();
  }
  sIn.Close();
} 
```

# mysql - MySQL 与 PDO

> ID：866860
> 
> 赞同：16
> 
> 时间：2009-05-15T03:33:52.137
> 
> 标签：mysql, pdo

我对 PHP 相当陌生，并且使用标准 MySQL 数据库调用构建了一个中型网站。但是，我最近了解了 PDO，我希望从社区中了解是否值得从 MySQL 切换到 PDO。为了安全起见，我一直在使用`mysql_real_escape_string`.

关于该站点的信息：
我正在使用`INSERT`和`SELECT`调用的混合。调用返回的数据`SELECT`量不大（使用返回的记录不超过30条`LIMIT`）。也不会有很多`INSERT`s。该网站目前尚未上线，因此现在进行更改很容易。

在您的专业意见中，值得我花时间将站点从 MySQL 切换到 PDO 吗？还是和 MySQL 一样好？或者换句话说，如果有的话，现在切换到 PDO 的原因是什么？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-15T03:36:48.980

与 mysql_* 函数相比，PDO 具有以下优点：

*   它是跨数据库的，这意味着它对于不同的关系数据库是相同的接口。
*   它有助于防止 SQL 注入。
*   它更干净（使用面向对象的方法）。

以前有人问过这个问题，你可能想看看答案：

*   [从 mysql 迁移到 mysqli 或 pdo？](https://stackoverflow.com/questions/770782/moving-from-mysql-to-mysqli-or-pdo)
*   [mysqli 或 PDO - 有什么优点和缺点？](https://stackoverflow.com/questions/13569/mysqli-or-pdo-what-are-the-pros-and-cons)

如果您正在开始一个新项目，我强烈建议您使用 PDO 或更高级别的库/ORM。如果您已经编写了很多没有它的代码，那可能不值得。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-01T21:54:54.077

PDO 具有上面链接的页面中列出的优点：数据库抽象（即您的代码可以在各种类型的 DB 中移植），如果您使用其准备好的语句功能，它可以为您处理许多常见的安全问题，并且它以 Class 实例的形式返回结果（它本身可以通过鼓励面向对象的方法来极大地改进您的代码）等等，等等。

但是，最好的方法是让您查看 ORM 库，例如 Doctrine。考虑到您的项目规模，这似乎有点矫枉过正，但坦率地说，开始学习最佳实践永远不会太早。Zend 框架的主要开发人员提供的关于如何构建防弹、可维护的数据库驱动应用程序 的*精彩概述可以在*[http://mtadata.s3.amazonaws.com/webcasts/20090724-playdoh.wmv观看](http://mtadata.s3.amazonaws.com/webcasts/20090724-playdoh.wmv)

# c# - Is there a way to count the number of seconds since bootup?

> ID：866867
> 
> 赞同：2
> 
> 时间：2009-05-15T03:36:17.593
> 
> 标签：c#, .net, seconds

Is there a way to count the number of seconds(ticks?) since bootup even if a user change the time on computer?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T03:39:46.897

[`System.Environment.TickCount`](http://msdn.microsoft.com/en-us/library/system.environment.tickcount.aspx) is what you want. It gets the number of milliseconds since the system was started.

# objective-c - cropImage:to:andScaleTo: 和 StraightenAndScaleImage() 的现有实现？

> ID：866875
> 
> 赞同：0
> 
> 时间：2009-05-15T03:38:59.550
> 
> 标签：objective-c, uiimagepickercontroller, scale, crop

我正在编写代码来使用 UIImagePickerController。Corey 之前在 SO 上发布了一些与裁剪和缩放相关的[不错的示例代码。](https://stackoverflow.com/questions/724092/uiimagepickercontroller-editing-allowed-locks-uiimage-to-max-size-of-320x320/740535#740535)但是，它没有cropImage:to:andScaleTo: 的实现，也没有straightenAndScaleImage()。

以下是它们的使用方式：

```
newImage =  [self cropImage:originalImage to:croppingRect andScaleTo:scaledImageSize];
...
UIImage *rotatedImage = straightenAndScaleImage([editInfo objectForKey:UIImagePickerControllerOriginalImage], scaleSize); 
```

由于我确定有人必须使用与 Corey 的示例代码非常相似的东西，因此可能存在这两个函数的现有实现。有人愿意分享吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T07:48:30.857

如果您检查链接到的帖子，您会看到苹果开发论坛的链接，我在其中获得了一些代码，这是您询问的方法。注意：我可能对数据类型进行了一些更改，但我不太记得了。如果需要，您可以轻松进行调整。

```
- (UIImage *)cropImage:(UIImage *)image to:(CGRect)cropRect andScaleTo:(CGSize)size {
UIGraphicsBeginImageContext(size);
CGContextRef context = UIGraphicsGetCurrentContext();
CGImageRef subImage = CGImageCreateWithImageInRect([image CGImage], cropRect);
CGRect myRect = CGRectMake(0.0f, 0.0f, size.width, size.height);
CGContextScaleCTM(context, 1.0f, -1.0f);
CGContextTranslateCTM(context, 0.0f, -size.height);
CGContextDrawImage(context, myRect, subImage);
UIImage* croppedImage = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();
CGImageRelease(subImage);
return croppedImage; 
```

}

```
UIImage *straightenAndScaleImage(UIImage *image, int maxDimension) {

CGImageRef img = [image CGImage];
CGFloat width = CGImageGetWidth(img);
CGFloat height = CGImageGetHeight(img);
CGRect bounds = CGRectMake(0, 0, width, height);
CGSize size = bounds.size;
if (width > maxDimension || height > maxDimension) {
    CGFloat ratio = width/height;
    if (ratio > 1.0f) {
        size.width = maxDimension;
        size.height = size.width / ratio;
    }
    else {
        size.height = maxDimension;
        size.width = size.height * ratio;
    }
} 

CGFloat scale = size.width/width;
CGAffineTransform transform = orientationTransformForImage(image, &size);
UIGraphicsBeginImageContext(size);
CGContextRef context = UIGraphicsGetCurrentContext();
// Flip 
UIImageOrientation orientation = [image imageOrientation];
if (orientation == UIImageOrientationRight || orientation == UIImageOrientationLeft) {

    CGContextScaleCTM(context, -scale, scale);
    CGContextTranslateCTM(context, -height, 0);
}else {
    CGContextScaleCTM(context, scale, -scale);
    CGContextTranslateCTM(context, 0, -height);
}
CGContextConcatCTM(context, transform);
CGContextDrawImage(context, bounds, img);
UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();
return newImage; 
```

}

# html - 可访问的 HTML 表单输入类型 - “提交”与“图像”

> ID：866887
> 
> 赞同：7
> 
> 时间：2009-05-15T03:43:09.603
> 
> 标签：html, css, forms

无论我使用“图像”而不是“提交”作为表单提交按钮的类型属性，屏幕阅读器用户（或任何用户）是否有任何真正的区别？

例如：

```
<input type="submit" value="Submit!" /> 
```

对比

```
<input type="image" src="myButtonImage.jpg" value="Submit!" alt="Submit!" /> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T03:46:03.543

不，它们本质上是一样的。

请参阅：[使用“按钮”和图像进行提交](http://www.10sharpdesign.com/accessibility/forms/6-button-submit.html)。只要确保始终给图像提交替代文本。

# c# - 如何从本机 C .dll 导出结构定义以在 C# 中使用

> ID：866891
> 
> 赞同：4
> 
> 时间：2009-05-15T03:44:13.300
> 
> 标签：c#, .net, c, interop, clr

我知道如何在 .dll 中外部方法，我如何外部结构？

我想创建一个 C 方法，例如

```
extern __declspec(dllexport) myStructure getStruct(); 
```

myStructure 类似于

```
typedef struct
{
   int A;
   int B;
   char C;
} myStructure; 
```

如何在不首先在 C# 中定义相同的确切结构的情况下从一段 C# 代码调用 getStruct()？我想保留 myStructure 的集中声明，这样我只需在一个地方进行代码更改。

非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T04:01:09.403

换一种方式怎么办？[在 T4 中用 C#](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)定义结构，然后在每个项目中交叉生成新格式：

**IE。基数.tt**

// 结构的 C# 定义

**在 C# 项目中的 gencsharp.tt 中** 包含 "base.tt" ...输出 C#

**在 CPP 项目中的 gencplusplus.tt 中** 包含“base.tt” ...使用 C# 生成 cpp .h 文件

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T05:28:20.897

我已经用 C# 完成了一些 P/Invoke，并且我总是必须在 C# 中定义与定义的 Win32 结构相对应的结构。运行时使用结构定义将数据从非托管封送到托管。Preet 的回答可能是最好的。

# ms-access - 我可以使用 .NET 将 ACCDB 文件转换为 MDB

> ID：866903
> 
> 赞同：2
> 
> 时间：2009-05-15T03:48:40.323
> 
> 标签：ms-access

有没有办法使用 .NET 库或 COM 对象将 ACCDB Access 数据库转换为 MDB？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T21:00:10.983

我会有不同的看法。有没有办法让 SQL 服务器同时导出 ACCDB 格式和 MDB 格式？他们的导出例程中必须有一个选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-22T00:50:56.330

另一种方法是，如果您可以访问 2007，您可以导出到以前的版本，即 2002-2003，这会生成一个 mdb。

它不是程序化的，但总比没有好:)

# database - 避免数据库表中的重复地址

> ID：866906
> 
> 赞同：5
> 
> 时间：2009-05-15T03:50:46.170
> 
> 标签：database, database-design

在将街道地址仅存储在表格中一次时，我试图避免重新发明轮子。唯一性约束在某些常见情况下不起作用：

```
100 W 5th Ave
100 West 5th Ave
100 W 5th

200 N 6th Ave Suite 405
200 N 6th Ave  #405 
```

我可以实现一些业务逻辑或触发器以在插入之前对所有字段进行规范化，并在表中的多个字段中使用唯一性约束，但是很容易错过某些与街道地址一样多的情况。

最好是每个地址的通用标识符，可能基于 GPS 坐标。在存储新地址之前，请查看其 GUID 并查看 GUID 是否已存在于地址表中。

像 Mapquest、Postal Serice、FedEx 或美国政府这样的组织可能拥有这样的系统。

有没有人找到一个很好的解决方案？

这是我现在的地址表（由 JPA 生成）：

```
CREATE TABLE address
(
  id bigint NOT NULL,
  "number" character varying(255),
  dir character varying(255),
  street character varying(255),
  "type" character varying(255),
  trailingdir character varying(255),
  unit character varying(255),
  city character varying(255),
  state character varying(255),
  zip integer,
  zip4 integer,
  CONSTRAINT address_pkey PRIMARY KEY (id)
) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T04:13:47.877

在谷歌地图中查找地址并使用他们使用的拼写。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T04:48:34.143

您需要对语法等正则表达式的支持。你可以想出某种自动机函数来解析令牌并尝试匹配它们，然后将它们扩展或收缩成缩写。我会研究 glob() 之类的函数，这些函数支持 *? 等在 unix 上作为快速脏修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T19:43:51.353

我不是在寻找地址验证或规范化，尽管地址验证是个好主意。我需要每个街道地址的唯一标识符以避免重复记录。

看起来地理编码可以提供解决方案。通过地理编码，输入可以是街道地址，输出将是经纬度坐标，其精度足以解析特定建筑物。

街道地址不明确的问题比我想象的要严重。这是来自地理编码的维基百科页面：

“......马萨诸塞州波士顿有 100 多条华盛顿街道，因为几个城市在没有更改街道名称的情况下被吞并。”

关于地理编码的维基百科页面有一个资源列表（许多是免费的）来执行地理编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-16T15:33:05.703

我选择了[USC WebGIS](https://webgis.usc.edu)服务，因为它们的 Web 服务界面很好，而且很容易注册。

但是，出于多种原因，地理编码不适合作为街道地址的唯一键。例如，地理编码无法区分公寓大楼或公寓楼中的不同单元。

I decided to use the parsed address from the geocoding result and put unique constraints on the street number, street name, unit, city, state, and zip. It's not perfect, but it works for what I'm doing.

# c# - 在 C# 中使用 Monads 的令人信服的场景是什么

> ID：866912
> 
> 赞同：21
> 
> 时间：2009-05-15T03:53:28.300
> 
> 标签：c#, .net, monads

让我先声明一下，我对 Monad 的理解还很幼稚。我在这里阅读了有关 Monads 的各种主题，并对这个概念进行了几个小时的研究。我对这个词几乎感觉不舒服，但我认为可以肯定地说我*通常*理解 Monad 是/做什么。

我是一名 C# 开发人员，希望改进我的工作方式。在我的 Monaducation 中进一步帮助我的是在 C# 中看到 Monad 的真实世界应用程序（即通过 linq SelectMany() 或类似的方法），这显然是对 oldskool C# 中解决同类问题的其他方法的改进。

有人见过这样的野兽吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-15T05:25:55.987

这是一个这样的场景：您想要创建一个解析库（嵌入式 DSL 的一个很好的示例），并且您发现最好的解析器库是单子解析器组合器库。因此，您编写它利用 LINQ 语法糖来编写与您正在解析的语言的语法具有相同结构的 C# 代码，并且您将获得用于动态语义分析和错误恢复的出色编程模型的好处. 有关说明，请参阅[此博客](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!136.entry)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-24T21:18:48.827

求毕达哥拉斯三元组：

```
 var r = from a in Enumerable.Range(1, 25)
          from b in Enumerable.Range(a, 25-a)
          from c in Enumerable.Range(b, 25-b)
          where a*a + b*b == c*c
          select new [] { a, b, c }; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T05:22:20.707

这是一种这样的场景：您想编写在不占用线程的情况下进行顺序异步调用（例如 IO）的代码，但您不想编写异步编程模型（BeginFoo/EndFoo）强迫您陷入的无望的意大利面条纠结. 因此，您可以使用 monad 和 LINQ 糖并编写看起来直线但它在整个过程中释放/切换线程的代码。有关简短说明，请参阅[此博客](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!208.entry)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-16T00:47:54.587

查看[http://memoirsofaprogrammer.blogspot.com](http://memoirsofaprogrammer.blogspot.com)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-10-24T22:20:26.950

`null`一个示例是使用 Maybe monad简化检查，如[本文](http://devtalk.net/csharp/chained-null-checks-and-the-maybe-monad/)所示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T09:35:19.477

LINQ 用于 StackOverflow 上的许多解决方案（并且经常在问题中提出要求）。查看带有[LINQ](https://stackoverflow.com/questions/tagged/linq)标记的问题，您将看到实际使用情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-15T14:58:47.860

使用 monad 进行编程是声明性的，它从高层次描述你想要什么，而不是如何生成它的低层次细节。

请参阅[第 9 频道 Brian Beckman 的 state-monad 演讲](http://channel9.msdn.com/shows/Going+Deep/Brian-Beckman-The-Zen-of-Expressing-State-The-State-Monad/)结尾处的[练习](http://channel9.msdn.com/shows/Going+Deep/Brian-Beckman-The-Zen-of-Stateless-State-The-State-Monad-Part-2/)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-25T17:09:37.980

[我最近写](http://bugsquash.blogspot.com/2011/04/refactoring-to-monadic-c.html)了一篇关于将典型的命令式现实世界 C# 代码（[NuGet](http://nuget.org/)中的函数）重构为函数式、单子样式（更具体地说，使用*Maybe monad*）的博客。我尽我最大的努力一步一步来，解释背后的理性步骤，所以我认为它有助于理解 monads 是如何有用的。

# php - 设计类时正确使用“构造”

> ID：866919
> 
> 赞同：1
> 
> 时间：2009-05-15T03:56:46.623
> 
> 标签：php, oop

我是面向对象编程的新手，我为 PHP 应用程序编写了一些我的第一个类。

在一些更简单的类中，我声明了一个`function __construct()`，并在该函数内部调用某些类方法。在某些情况下，我发现自己在我的应用程序中实例化了该类，并且不需要对结果对象做任何事情，因为该类`__construct()`调用了方法，它们完成了它们的工作，让我与该类无关。

这对我来说感觉不对。我有一个从未做过任何事情的新对象似乎很愚蠢。

再次，我要强调这只是我的一些更简单的类的情况。在更复杂的情况下，我确实通过对象和外部使用类方法`__construct()`。

我是否需要重新考虑我编码事物的方式，或者我还好吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T04:06:28.970

好吧，构造函数用于创建一个类的新实例，并对该类进行任何必要的设置。如果您只是创建课程并离开它，那似乎有点浪费。例如，为什么不使用类中的静态函数作为组织工具并调用它们（或调用它们的函数），而不是构造一个您永远不会使用的新实例？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T10:53:05.263

> 这对我来说感觉不对。我有一个从未做过任何事情的新对象似乎很愚蠢。

是的，这应该引发一个危险信号。

一般来说，你不应该让构造函数有任何副作用；它们用于初始化对象的状态 - 而不是其他任何东西。当然，这条规则也有例外，但总的来说，这是一个很好的指导方针。您还应该避免在构造函数中进行任何繁重的计算。将其移至方法。

[副作用](http://en.wikipedia.org/wiki/Side_effect_%28computer_science%29)有很多——全局变量或静态（类）变量的变化；输出到环境（例如调用`print()`，`header()`或`exit()`）；调用数据库或其他外部服务，甚至更改其他对象的状态。

A side effect free function is also called a "pure" function - as opposed to a *procedure*, which is a function that has side effects. It's a good practise to explicitly separate pure functions from procedures (and perhaps even label them as such).

# c# - 静态扩展方法

> ID：866921
> 
> 赞同：177
> 
> 时间：2009-05-15T03:57:03.720
> 
> 标签：c#, extension-methods

有什么方法可以将静态扩展方法添加到类中。

具体来说，我想重载`Boolean.Parse`以允许`int`参数。

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2009-05-15T04:04:26.527

简而言之，不，你不能。

长答案，扩展方法只是语法糖。IE：

如果您对字符串有扩展方法，可以说：

```
public static string SomeStringExtension(this string s)
{
   //whatever..
} 
```

当你调用它时：

```
myString.SomeStringExtension(); 
```

编译器只是把它变成：

```
ExtensionClass.SomeStringExtension(myString); 
```

如您所见，静态方法无法做到这一点。

我突然想到另一件事：能够在现有类上添加静态方法的真正*意义是什么？*您可以拥有自己的帮助程序类来做同样的事情，那么能够这样做的真正好处是什么：

```
Bool.Parse(..) 
```

对比

```
Helper.ParseBool(..); 
```

并没有真正带来太多的桌子......

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2009-05-15T04:42:20.460

> 具体来说，我想重载`Boolean.Parse`以允许 int 参数。

int 的扩展会起作用吗？

```
public static bool ToBoolean(this int source){
    // do it
    // return it
} 
```

然后你可以这样称呼它：

```
int x = 1;

bool y = x.ToBoolean(); 
```

* * *

## 回答 #3

> 赞同：-15
> 
> 时间：2009-05-15T04:04:29.630

不，但你可以有类似的东西：

```
bool b;
b = b.YourExtensionMethod(); 
```

# validation - 使用 Prism 进行 Silverlight 3 验证

> ID：866934
> 
> 赞同：1
> 
> 时间：2009-05-15T04:04:36.883
> 
> 标签：validation, silverlight-3.0, prism

我正在使用 Prism 开发 SL3 应用程序。我需要支持验证（字段级别（在绑定属性的设置器上）和保存之前（表单级别）），包括验证摘要，在按下保存按钮时显示。

但是我可以在谷歌上搜索到的示例要么是 SL3，其中包含大量代码背后的代码（非常不酷且非 Prismy），要么与 WPF 相关。

有谁知道我可以研究的带有一些实际验证的参考应用程序？

干杯，阿里

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-19T06:37:22.837

目前还没有来自 Microsoft 的，但我明天会将这个传递给 PRISM 团队，看看我们是否可以在 PRISM 的下一个版本中获得一个基本的表单验证示例。

话虽如此，您可以为每个表单放置一个验证器，该验证器基本上验证每个字段（语义和/或语法验证）并且应该全部通过，将返回真/假状态。

我通常这样做的一种方法是将“CanSave”方法附加到我的命令中，即：

```
SaveOrderCommand = new DelegateCommand<object>(this.Save, this.CanSave);

private bool CanSave(object arg)
{
     return this.errors.Count == 0 && this.Quantity > 0;
} 
```

然后在**this.CanSave**中，然后我将基本验证放在此代码库中，或者我根据上下文调用一堆其他验证器 - 有些将在所有模块之间共享（即 IsEmailValid 将是我放置在我的基础设施中的一个验证器模块作为单例并传入我的字符串，结果是真/假）。一旦它们都通过，请确保 CanSave 返回 true。如果失败，CanSave 将返回 False。

现在，如果它们失败了，并且您想向用户发出友好的提醒，它失败了，您可以在此处使用多种技术。我通常在验证时将所述控件标记为“失败”..（我写了自己的想法，所以你可以在这里使用哪些工具包 - [http://www.codeplex.com/SilverlightValidator](http://www.codeplex.com/SilverlightValidator)不是坏的一个）。

现在，我通常喜欢通过不仅突出显示所述控件（红色框、图标等）而且更详细地向用户解释它们的要求 - 因此自定义方法是我的解决方案已经选择了。

归根结底，您将不得不做一些繁重的工作来验证您的特定表单 - 但要寻找在有意义的地方重用验证器的方法（电子邮件、SSN 等很容易重新 -采用）。

HTH？

**Scott Barnes - 富平台产品经理 - Microsoft。**

# java - 如何设计一种将字符串与基本字符串相关联的防弹方法？

> ID：866937
> 
> 赞同：1
> 
> 时间：2009-05-15T04:05:49.907
> 
> 标签：java, algorithm

我的服务与管理帐户的服务器通信。

*   每个**帐户**对每月执行的**操作**数量都有上限。
*   我想通过创建通过方案相关的新帐户来规避此上限。

这是它应该如何工作的：

1.  用户通过**MyService**创建一个帐户“ *denzel* ” 。
***   **反过来，**MyService将帐户创建代理到****3rdPartyServer*******   用户“ *denzel* ”检查他的信用，**MyService**返回 45 美元（每个用户帐户的默认上限）。*   用户“ *denzel ”通过***MyService**购买了额外的 45 美元。**MyService**在**3rdPartyServer**中秘密创建（在后台）帐户*A ，但管理“* *denzel* ”和“ *A* ”之间的关系。*****   用户“ *denzel* ”检查他的信用，**MyService**返回 90 美元********

 ******管理关系的一种愚蠢方法是将计数附加到原始用户 ID。例如“ *denzel1* ”、“ *denzel2* ”等。这不起作用我们不想阻止其他用户选择*denzel1* ”或该系列中的其他人。

有没有人遇到过这个问题并有解决方案分享？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T04:11:29.550

使用[参考表](http://en.wikipedia.org/wiki/Reference_table)来管理真实用户和生成用户之间的映射。这样您就可以检查您是否已经生成了具有给定名称的帐户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T04:17:42.250

为什么在**3rdPartyServer**自动创建的账户需要基于原用户的登录？您不妨随机生成它们，然后在“内部”无缝地管理它们，这样用户甚至不需要知道它们。正如[George 所说](https://stackoverflow.com/questions/866937/how-to-design-a-bulletproof-method-of-relating-a-string-to-base-string/866948#866948)，使用一个参考表，该表允许您交叉引用系统用户及其所有生成的别名。

# asp.net - ASP.NET CheckBox 使用 javascript 禁用回发

> ID：866942
> 
> 赞同：1
> 
> 时间：2009-05-15T04:07:42.853
> 
> 标签：asp.net, javascript

我正在尝试连接 CheckBox 以在选中/未选中时处理事件。如果用户启用了 JavaScript，则使用它，否则使用回发。

这是我的代码：

```
<asp:CheckBox ID="ApplicationInProcessCheckBox" runat="server" 
    Text="Application In Process" AutoPostBack="true" 
    oncheckedchanged="ApplicationInProcessCheckBox_CheckedChanged"
    onclick="return false;" /> 
```

javascript onclick 事件中的 return false 禁用回发。但是，它也不会让复选框选中或取消选中。（我有更多代码要添加到 javascript 事件中......我只想让这个概念首先发挥作用）。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:41:47.450

我认为我们不能在没有启用 Javascript 的情况下回发单击复选框。

# mysql - MySQL vs SQLite + UNIQUE 索引

> ID：866943
> 
> 赞同：1
> 
> 时间：2009-05-15T04:08:45.173
> 
> 标签：mysql, database, sqlite

由于与这个问题无关的原因，我需要为我的一些项目运行几个 SQLite 数据库而不是更常见的 MySQL，我想知道 SQLite 在**磁盘 I/O 的速度和性能方面与 MySQL 相比如何（数据库将托管在 USB 2.0 笔式驱动器中**）。

[我已经阅读了http://www.sqlite.org/speed.html](http://www.sqlite.org/speed.html)上的数据库速度比较页面，我必须说我对 SQLite 的性能感到惊讶，但由于这些基准有点旧，我正在寻找更新的基准测试（SQLite 3 vs MySQL 5），**我主要关心的是磁盘性能，而不是 CPU/RAM**。

另外，由于我对 SQLite 没有太多经验，我也很好奇它是否有任何类似于 InnoDB MySQL 引擎中的 TRIGGER（更新、删除）事件的东西。我也找不到任何方法来声明一个字段像 MySQL 一样是唯一的，只有 PRIMARY KEY - 有什么我遗漏的吗？

作为最后一个问题，我想知道是否存在一个好的（最好是免费或开源的）SQLite 数据库管理器。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T04:22:19.183

里面有几个问题：

1.  就磁盘 I/O 限制而言，我不认为数据库引擎会有很大的不同。可能有一些小事情，但我认为这主要是数据库是否可以按照您的应用程序想要的速度读取/写入数据。由于您将在 MySQL 或 SQLite 中使用相同数量的数据，因此我认为它不会有太大变化。
2.  SQLite 确实支持触发器：[CREATE TRIGGER 语法](http://sqlite.org/lang_createtrigger.html)
3.  SQLite 确实支持 UNIQUE 约束：[列约束定义语法](http://sqlite.org/syntaxdiagrams.html#column-constraint)。
4.  为了管理我的 SQLite 数据库，我使用 Firefox Add-on [SQLite Manager](https://addons.mozilla.org/en-US/firefox/addon/5817)。挺好的，能做我想做的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-17T00:50:28.303

> 就磁盘 I/O 限制而言，我不认为数据库引擎会有很大的不同。

在 Mysql/myISAM 中，数据是 UNORDERED 存储的，因此 RANGE 读取 PRIMARY KEY 理论上需要发出几个 HDD SEEK 操作。

在 Mysql/InnoDB 中，数据按 PRIMARY KEY 排序，因此 RANGE 读取 PRIMARY KEY 将使用一次 DISK SEEK 操作（理论上）完成。

总结一下：myISAM - 数据无序地写入 HDD。如果 pri 键不是 AUTO INCREMENT 唯一字段，则读取慢 PRI-KEY 范围。

InnoDB - data ordered, bad for flash drives (as data needs to be re-ordered after insert = additional writes). Very fast for PRI KEY range reads, slow for writes.

InnoDB is not suitable for flash memory. As seeks are very fast (so you won't get too much benefit from reordering the data), and additional writes needed to maintain the order are damaging to flash memory.

myISAM / innoDB makes a huge difference for conventional and flash drives (i don't know what about SQLite), but i'd rather use mysql/myisam.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-05T11:47:44.873

I actually prefer using SQLiteSpy [http://www.portablefreeware.com/?id=1165](http://www.portablefreeware.com/?id=1165) as my SQLite interface. It supports things like REGEXP which can come in handy.

# emacs - Emacs Lisp 语法高亮

> ID：866945
> 
> 赞同：5
> 
> 时间：2009-05-15T04:09:45.687
> 
> 标签：emacs, syntax-highlighting, elisp, syntax-rules

我想为 Emacs 编写一个语法高亮扩展，但我在谷歌上搜索“emacs 语法高亮教程”的变体都失败了。如何开始学习如何编写 Emacs 荧光笔？有什么好的资源来学习如何做这些事情？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-15T04:15:28.387

你找错地方了。查看“[字体锁定模式](http://www.gnu.org/software/emacs/manual/html_node/emacs/Font-Lock.html)”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-15T06:23:59.170

有[一个相关的问题](https://stackoverflow.com/questions/756666/match-regular-expression-as-keyword-in-define-generic-mode/756927)，关于如何使用语法高亮定义主要模式`'define-generic-mode`。问题的重点是弄清楚如何使语法突出显示工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T06:48:19.957

不幸的是，您正在搜索错误的术语，“语法突出显示”不是 emacs 词汇表 :)。您应该搜索过类似“写 emacs 模式”的内容。

已经有一个问题：“[如何为新语言编写 emacs 模式](https://stackoverflow.com/questions/91201/how-to-write-an-emacs-mode-for-a-new-language)”，并提供了一些很好的指导。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-18T15:21:15.363

如果您有兴趣编写自己的突出显示，[另一个问题](https://stackoverflow.com/questions/875543/how-can-i-color-certain-things-in-emacs/)涵盖了这一点，并且可能对您有价值。它包括以下代码片段：

```
(defun django-highlight-comments ()
  (interactive "p")
  (highlight-regexp "{%.*?%}" 'hi-orange))
(add-hook 'html-mode-hook 'django-highlight-comments) 
```

代码由[Ashutosh Mehra](https://stackoverflow.com/users/73653/ashutosh-mehra)的[回答](https://stackoverflow.com/questions/875543/how-can-i-color-certain-things-in-emacs/875628#875628)提供。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-19T08:26:21.763

[http://a-kat.com/Emacs_Major_Modes.html](http://a-kat.com/Emacs_Major_Modes.html)

# curl - 向服务器发送请求时，如何查看 curl 生成的请求标头？

> ID：866946
> 
> 赞同：552
> 
> 时间：2009-05-15T04:10:50.160
> 
> 标签：curl

我想在`curl`向服务器发送请求时查看请求标头。我该如何检查？

* * *

## 回答 #1

> 赞同：569
> 
> 时间：2010-06-25T20:21:36.987

我认为`curl --verbose/-v`是最简单的。它将吐出请求标头（以'>'为前缀的行），而无需写入文件：

```
$ curl -v -I -H "Testing: Test header so you see this works" http://stackoverflow.com/
* About to connect() to stackoverflow.com port 80 (#0)
*   Trying 69.59.196.211... connected
* Connected to stackoverflow.com (69.59.196.211) port 80 (#0)
> HEAD / HTTP/1.1
> User-Agent: curl/7.16.3 (i686-pc-cygwin) libcurl/7.16.3 OpenSSL/0.9.8h zlib/1.2.3 libssh2/0.15-CVS
> Host: stackoverflow.com
> Accept: */*
> Testing: Test header so you see this works
>
< HTTP/1.0 200 OK
... 
```

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2010-12-10T06:18:32.457

该问题未指定命名的命令行命令`curl`是指还是整个 cURL 库。

以下使用 cURL 库的 PHP 代码使用第一个参数作为 HTTP 方法（例如“GET”、“POST”、“OPTIONS”），第二个参数作为 URL。

```
<?php
$ch = curl_init();
$f = tmpfile(); # will be automatically removed after fclose()
curl_setopt_array($ch, array(
    CURLOPT_CUSTOMREQUEST  => $argv[1],
    CURLOPT_URL            => $argv[2], 
    CURLOPT_RETURNTRANSFER => 1,
    CURLOPT_FOLLOWLOCATION => 0,
    CURLOPT_VERBOSE        => 1,
    CURLOPT_HEADER         => 0,
    CURLOPT_CONNECTTIMEOUT => 5,
    CURLOPT_TIMEOUT        => 30,
    CURLOPT_STDERR         => $f,
));
$response = curl_exec($ch);
fseek($f, 0);
echo fread($f, 32*1024); # output up to 32 KB cURL verbose log
fclose($f);
curl_close($ch);
echo $response; 
```

示例用法：

```
php curl-test.php OPTIONS https://google.com 
```

请注意，结果与以下命令行几乎相同

```
curl -v -s -o - -X OPTIONS https://google.com 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2009-05-15T04:14:04.693

[curl](https://curl.haxx.se/)`--trace-ascii`选项将显示请求标头，以及响应标头和响应正文。

例如，命令

```
curl --trace-ascii curl.trace http://www.google.com/ 
```

生成一个`curl.trace`如下开头的文件：

```
== Info: About to connect() to www.google.com port 80 (#0)
== Info:   Trying 209.85.229.104... == Info: connected
== Info: Connected to www.google.com (209.85.229.104) port 80 (#0)
=> Send header, 145 bytes (0x91)
0000: GET / HTTP/1.1
0010: User-Agent: curl/7.16.3 (powerpc-apple-darwin9.0) libcurl/7.16.3
0050:  OpenSSL/0.9.7l zlib/1.2.3
006c: Host: www.google.com
0082: Accept: */*
008f: 
```

它还得到了一个被记录的响应（准确地说是 302 响应，但无关紧要）。

* * *

如果您只想保存*响应*标头，请使用以下`--dump-header`选项：

```
curl -D file url
curl --dump-header file url 
```

如果您需要有关可用选项的更多信息，请使用`curl --help | less`（它会产生几百行输出，但会提到很多选项）。或者查找[手册页](https://curl.haxx.se/docs/manpage.html)，其中有更多关于选项含义的解释。

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2010-01-26T10:54:49.983

我设法查看传出标头（使用 php 卷曲）的唯一方法是使用以下选项：

```
curl_setopt($ch, CURLOPT_HEADER, 1);
curl_setopt($ch, CURLINFO_HEADER_OUT, true); 
```

获取调试信息：

```
$data = curl_exec($ch);
var_dump($data);
var_dump(curl_getinfo($ch)); 
```

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2009-05-15T08:47:06.440

curl [--trace-ascii](http://curl.se/docs/manpage.html#--trace-ascii) {filename} 或使用单个破折号代替文件名将其发送到标准输出：

```
curl --trace-ascii - {URL} 
```

如果您使用的是 libcurl，则为[CURLOPT_DEBUGFUNCTION](http://curl.se/libcurl/c/CURLOPT_DEBUGFUNCTION.html)

这向您展示了*curl*发送和接收的所有内容，以及一些额外的信息。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2016-04-26T21:16:17.040

我在这里尝试了答案，发现最有用和最简单的答案尚未列为答案，但它是：

```
curl -v https://example.com/path 
```

这会打印出**REQUEST**标头以及**RESPONSE**标头以及其他有用的信息，例如 SSL 证书以及是否重用了现有的 TCP 连接。当然，该`-v`标志可以与其他标志结合使用，例如跟随重定向和提示进行 HTTP 身份验证：

```
curl -vL --user my_username https://example.com/path 
```

希望这可以帮助。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2019-01-16T20:49:48.453

像下面这样的命令将显示三个部分：请求标头、响应标头和数据（由 CRLF 分隔）。它避免了 curl 添加的技术信息和语法噪音。

```
curl -vs www.stackoverflow.com 2>&1 | sed '/^* /d; /bytes data]$/d; s/> //; s/< //' 
```

该命令将产生以下输出：

```
GET / HTTP/1.1
Host: www.stackoverflow.com
User-Agent: curl/7.54.0
Accept: */*

HTTP/1.1 301 Moved Permanently
Content-Type: text/html; charset=UTF-8
Location: https://stackoverflow.com/
Content-Length: 149
Accept-Ranges: bytes
Date: Wed, 16 Jan 2019 20:28:56 GMT
Via: 1.1 varnish
Connection: keep-alive
X-Served-By: cache-bma1622-BMA
X-Cache: MISS
X-Cache-Hits: 0
X-Timer: S1547670537.588756,VS0,VE105
Vary: Fastly-SSL
X-DNS-Prefetch-Control: off
Set-Cookie: prov=e4b211f7-ae13-dad3-9720-167742a5dff8; domain=.stackoverflow.com; expires=Fri, 01-Jan-2055 00:00:00 GMT; path=/; HttpOnly

<head><title>Document Moved</title></head>
<body><h1>Object Moved</h1>This document may be found <a HREF="https://stackoverflow.com/">here</a></body> 
```

描述：

*   `-vs`- 添加标题 (-v) 但删除进度条 (-s)
*   `2>&1`- 将标准输出和标准错误合并为单个标准输出
*   `sed`- 使用以下命令编辑 curl 生成的响应
*   `/^* /d`- 删除以“*”开头的行（技术信息）
*   `/bytes data]$/d`- 删除以“字节数据]”结尾的行（技术信息）
*   `s/> //`- 删除'>'前缀
*   `s/< //`- 删除'<'前缀

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2017-12-07T12:17:12.853

我知道这有点晚了，但我最喜欢这样做的方法是`netcat`，因为你得到了`curl`发送的确切信息；这可能与无法正确显示非 ASCII 字符的`--trace`or`--trace-ascii`选项不同（它们仅显示为点或需要解码）。

您可以通过在第一种类型中打开两个终端窗口来轻松完成此操作：

```
nc -l localhost 12345 
```

这将在本地计算机的端口 12345 上打开一个侦听进程。

在第二个终端窗口中输入您的 curl 命令，例如：

```
curl --form 'foo=bar' localhost:12345 
```

在第一个终端窗口中，您将**准确**看到 curl 在请求中发送的内容。

现在当然`nc`不会发送任何响应（除非您自己输入），因此您需要中断 curl 命令（control-c）并为每个测试重复该过程。

但是，这对于简单地调试您的请求是一个有用的选项，因为您不会在任何地方涉及往返，或者在某处产生虚假的迭代请求，直到您做对为止；一旦您对命令感到满意，只需将其重定向到有效的 URL 即可。

您也可以对任何 cURL 库执行相同的操作，只需编辑您的请求以指向本地`nc`侦听器，直到您满意为止。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-08-08T12:41:44.473

将标头转储到一个文件中，将响应的有效负载转储到另一个文件中

```
curl -k -v -u user:pass  "url" --trace-ascii headers.txt >> response.txt 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-09-02T13:24:51.167

```
curl -s -v -o/dev/null -H "Testheader: test" http://www.example.com
```

`-I`如果您想发送 HEAD 请求而不是 GET 请求，您也可以使用选项。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-10-14T12:11:31.080

这是我在 php 中的 http 客户端，用于使用包含的 cookie 进行发布查询：

```
function http_login_client($url, $params = "", $cookies_send = "" ){

    // Vars
    $cookies = array();
    $headers = getallheaders();

    // Perform a http post request to $ur1 using $params
    $ch = curl_init($url);
    $options = array(   CURLOPT_POST => 1,
                        CURLINFO_HEADER_OUT => true,
                        CURLOPT_POSTFIELDS => $params,
                        CURLOPT_RETURNTRANSFER => 1,
                        CURLOPT_HEADER => 1,
                        CURLOPT_COOKIE => $cookies_send,
                        CURLOPT_USERAGENT => $headers['User-Agent']
                    );

    curl_setopt_array($ch, $options);

    $response = curl_exec($ch); 
```

/// 调试信息 echo $response; var_dump (curl_getinfo($ch)); ///

```
 // Parse response and read cookies
    preg_match_all('/^Set-Cookie: (.*?)=(.*?);/m', $response, $matches);

    // Build an array with cookies
    foreach( $matches[1] as $index => $cookie )
        $cookies[$cookie] = $matches[2][$index];

    return $cookies;
} // end http_login_client 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-02-23T15:38:46.793

You can see it by using `-iv`

```
$> curl  -ivH "apikey:ad9ff3d36888957" --form  "file=@/home/mar/workspace/images/8.jpg" --form "language=eng" --form "isOverlayRequired=true" https://api.ocr.space/Parse/Image 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-16T09:24:23.970

您可以使用[wireshark](http://www.wireshark.org/download.html)或[tcpdump](http://www.tcpdump.org/tcpdump_man.html)来查看任何网络流量（也可以使用 http）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-03-15T16:19:01.783

[向https://http-tools.appspot.com/reflect-http-request/some-unique-id](https://http-tools.appspot.com/reflect-http-request/some-unique-id)发出示例请求，并通过其相应的查找器 url [https](https://http-tools.appspot.com/reflect-http-request-finder/some-unique-id)检查该请求包含的内容（请求标头、请求正文、请求参数）[://http-tools.appspot.com/reflect-http-request-finder/some-unique-id](https://http-tools.appspot.com/reflect-http-request-finder/some-unique-id)。您可以使用任何字符串代替`some-unique-id`，请查看[https://http-tools.appspot.com](https://http-tools.appspot.com)了解更多详细信息。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-24T10:32:53.347

您可以使用“-”作为文件名将标头直接转储到标准输出 - 例如，查看标头和内容，并遵循重定向，所有这些都在一个输出中：

```
curl -L -D - -s [url] 
```

# .net - Javascript 图像更改导致嵌入的用户控件闪烁

> ID：866955
> 
> 赞同：0
> 
> 时间：2009-05-15T04:16:13.223
> 
> 标签：.net, javascript, user-controls, flicker

我在 IE 中显示了一个 html 页面。它有一些由 JavaScript 中带有鼠标悬停/鼠标退出事件的图像组成的按钮，以及一堆嵌入式 .Net 用户控件。

当 mouseover/mouseout 事件触发时，我将图像 src 更改为其他内容（简单的翻转效果）。问题是用户控件经常（但不总是）在发生这种情况时闪烁。

需要明确的是，图像不会闪烁，页面的其余部分也不会闪烁，只是嵌入的控件。这个页面是本地的，不是来自服务器或任何东西。

那么，有什么想法吗？

更多信息：我注意到突出显示文本也可以...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T10:16:21.750

如果您没有预加载图像，您可能会看到这种问题。

要预加载图像，只需添加一个带有所需 url 的特殊 div。

```
<div id="preload">
  <img src="/path/to/my/image.png" alt="">
  <img src="/img2.gif" alt="">
</div> 
```

在你的 CSS 中：

```
#preload { display:none; } 
```

而已 ！

# clojure - Clojure 编程在 Kindle 上的表现如何？

> ID：866963
> 
> 赞同：3
> 
> 时间：2009-05-15T04:19:59.767
> 
> 标签：clojure, kindle

[编程 Clojure](http://www.pragprog.com/titles/shcloj/programming-clojure)目前仅以电子形式提供。我看到它在 Kindle 上以 .mobi 格式提供。我的问题是，这效果如何？我知道一些编程书籍可能会丢失 Kindle 上代码的格式。有没有人试过这个？这个版本好用吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T14:52:37.913

我的 Kindle 2 上现在有 3 本书来自 Pragmatic 的家伙，它们渲染得非常好。

虽然我升级到 Kindle DX 纯粹是为了原生 PDF 阅读功能。我真的等不及了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T04:48:09.387

最重要的是他们在 Prag 书中使用了相当多的颜色。Kindle 当然不能处理这个问题。但如果你购买电子书格式，你会得到 PDF、.mobi 和另一种我忘记了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-22T17:39:32.730

我决定冒险一试。我购买了测试版的电子书。这样做可以让我下载所有 3 个变体（pdf、epub 和 mobi）。我没有 Kindle（还没有——它在邮件中），但我确实在 Windows 上的 Mobipocket 阅读器中加载了 mobi 版本。代码似乎都被正确格式化了，这让我很担心。插图看起来都完好无损。我看过格式不正确的编程书籍，但这似乎不是其中之一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T04:24:34.310

我有一个 iRex Iliad 并在上面使用 pdf（主要来自 apress）并且完全没有问题......

# c++ - Qt：如何设置主窗口的初始位置？

> ID：866970
> 
> 赞同：20
> 
> 时间：2009-05-15T04:23:42.267
> 
> 标签：c++, windows, qt

我认为通常的窗口管理器确定桌面上 QMainWindow 位置的初始位置。我想自己设置初始位置。这是如何在 Windows 上使用 Qt 完成的？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-15T13:33:19.873

在构建 MainWindow 期间，您可以使用[restoreGeometry()](http://qt-project.org/doc/qt-5/qwidget.html#restoreGeometry)恢复窗口几何形状，并使用[restoreState()](http://qt-project.org/doc/qt-5/qmainwindow.html#restoreState)恢复停靠元素的状态...

```
 QSettings settings("yourcompany", "yourapp");

    restoreGeometry(settings.value("geometry").toByteArray());
    restoreState(settings.value("state").toByteArray(),YOUR_UI_VERSION); 
```

然后，如果您覆盖[closeEvent()](http://qt-project.org/doc/qt-5/qwidget.html#closeEvent)，您可以按如下方式保存状态：

```
 QSettings settings("yourcompany", "yourapp");

    settings.setValue("geometry", saveGeometry());
    settings.setValue("state", saveState(YOUR_UI_VERSION)); 
```

YOUR_UI_VERSION 是一个常量，当您的 UI 发生显着变化时您应该递增，以防止尝试恢复无效状态。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T04:29:07.933

我相信您正在寻找[setGeometry](https://doc.qt.io/qt-5/qlayoutitem.html#setGeometry)。

# edi - EDI X12 文档 - 文档

> ID：866974
> 
> 赞同：8
> 
> 时间：2009-05-15T04:28:04.347
> 
> 标签：edi, x12

我在哪里可以找到有关 X12 文档的文档以及示例。我对 810 和 812 感兴趣，但也想在附加文件上添加书签信息。

有没有一本涵盖这些文件的好书？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T04:36:09.180

周围有一点。首先要看的是[X12.org](http://www.x12.org)。

这看起来像一个相当不错的[在线课程](http://www.courses.vcu.edu/INFO465-gs/ansi_x_12.htm)。

EDI 文档并不是特别难处理，它们只是字符串。困难在于标准中有很多自由度，因此您需要与每个交易伙伴准确协商您将支持哪些字段代码等。

另一个要寻找的神奇词是[EDIFACT](http://en.wikipedia.org/wiki/EDIFACT)，它是[国际](http://www.unece.org/trade/untdid/welcome.htm)标准d。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-15T06:44:56.520

您必须购买官方文档（来自 DISA），但是对于像 810 这样的常见 X12 事务，网上有很多实施指南，其中包含最常用的事务子集。

# c# - 如何从 ASP.NET 中的请求中获取 IP 地址？

> ID：866980
> 
> 赞同：26
> 
> 时间：2009-05-15T04:31:29.207
> 
> 标签：c#, asp.net, ip-address

我一直试图弄清楚这一点，但在向 asp.net 中适用于所有服务器的页面发出请求时，找不到可靠的方法来获取客户端 IP 地址。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-15T04:37:50.300

一种方法是使用 Request 对象：

```
protected void Page_Load(object sender, EventArgs e)
{
    lbl1.Text = Request.UserHostAddress;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-07-02T20:59:49.990

```
 IpAddress=HttpContext.Current.Request.UserHostAddress; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-15T04:36:29.100

```
Request.ServerVariables["REMOTE_ADDR"] 
```

要访问 C# 上的索引或属性，您应该使用 [ ] 而不是 ( )

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-02-11T11:12:39.300

如果客户端和服务器之间有代理。可以使用**HTTP_X_FORWARDED_FOR标头。**

```
var ips = HttpContext.Current.Request.ServerVariables["HTTP_X_FORWARDED_FOR"];
var clientIp = "";
if (!string.IsNullOrEmpty(ips))
{
    string[] addresses = ips.Split(',');
    if (addresses.Length != 0)
    {
        clientIp = addresses[0];
    }
}
else
{
    clientIp = HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"];
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-09-24T06:22:38.927

您可以将 HttpContext 与以下属性一起使用：

```
var _request1 = HttpContext.Current.Request.UserHostAddress;
        string requestedDomain = HttpContext.Current.Request.ServerVariables["HTTP_HOST"];
        string requestScheme = HttpContext.Current.Request.Url.Scheme;
        string requestQueryString = HttpContext.Current.Request.ServerVariables["QUERY_STRING"];
        string requestUrl = HttpContext.Current.Request.ServerVariables["URL"]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-01T07:49:23.320

```
System.Web.HttpContext.Current.Request.UserHostAddress; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-07-16T16:33:58.063

试试这个代码：

```
var IpAddress = Request.Headers["Referer"][0]; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-01T09:31:48.373

使用此代码：

```
public static string GetIpAddress()
    {
        return HttpContext.Current != null ? HttpContext.Current.Request.UserHostAddress : "";
    } 
```

# php - 使用javascript循环使用php动态创建的控件

> ID：866987
> 
> 赞同：1
> 
> 时间：2009-05-15T04:34:16.580
> 
> 标签：php, javascript

好的，这种情况有点奇怪，但无论如何。此 PHP 代码生成几个单选按钮：

```
 for($i = 0; $i<count($questionList); $i++)
    {
        echo $questionList[$i]->__get(QuestionId).'-'.$questionList[$i]->__get(QuestionText).'<br />';

        $answerList = $questionList[$i]->GetAnswers();

        for($j = 0; $j<count($answerList); $j++)
        {
            echo '<br /><input type=\'radio\' name=\'group'.$i.'\' id=\'radioButtonAnswer'.$answerList[$j]->__get(AnswerId).'\' value=\''.$answerList[$j]->__get(AnswerId).'\' >'.
            $answerList[$j]->__get(AnswerText).'</input>';
        }
        echo '<br /><br />';
    } 
```

好的，这很好，在创建复选框后，我正在尝试运行一些代码来获取所有单选按钮但它不起作用，所以我尝试了几次只获得一个单选按钮，它只得到它第一次。

```
function Validate()
{

    var i = 1;

    do
    {
        document.writeln(document.getElementById('radioButtonAnswer2') == null);

        i ++;
    }while(i < 10);

    document.writeln('out of loop');

    return false;
} 
```

所以我肯定知道'radioButtonAnswer2'存在并且它不应该为空。但这就是我单击提交按钮时得到的结果：

假 真 真 真 真 真 真 真 真 循环外

第一次不为空，但在那之后，它是。有什么想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T04:39:42.103

您可以使用`document.getElementsByName("group")`来获取所有单选按钮。

这个循环工作正常。问题在于 document.writeln()，它替换了页面中的 html，因此 DOM 元素消失了。这是使用警报的更新版本。

```
function Validate(){  
  var radioGroup = document.getElementsByName("group");
  var results = "";
  for(i = 0, len = radioGroup.length; i < len; i++){
    currentRadio = radioGroup[i];
    results += "\n" + currentRadio.id + " is ";
    results += (currentRadio.checked ? "checked" : "not checked");
  }
  results += "\n..out of loop...";
  alert(results);     
  return false;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T04:57:52.810

这可能是因为您生成的 HTML 无效。您也不应该显式调用该`__get()`函数，但这很可能是一个不相关的问题。

就像是：

```
<input type="radio" ...>Label Text</input> 
```

不是定义单选按钮的正确方法。

试试这个代码：

```
for($j = 0; $j<count($answerList); $j++)
{
        echo '<br /><input type="radio" name="group'.$i.'" id="radioButtonAnswer'.$answerList[$j]->AnswerId.'" value="'.$answerList[$j]->AnswerId.'" />';
        echo '<label for="radioButtonAnswer'.$answerList[$j]->AnswerId.'">'.$answerList[$j]->AnswerText.'</label>';
} 
```

* * *

**编辑添加：**啊，现在我明白了。你正在使用`document.writeln()`. 该函数会覆盖页面的内容。

所以第一次进入循环时，元素确实存在，并且它执行了一个`document.writeln()`调用，将“true”写入页面。**这会覆盖之前页面上的所有内容**（您没有注意到页面加载时如何，它**只有**javascript 的输出吗？）。下一次循环时，它会再次尝试查找单选按钮，但它已被删除并替换为 javascript 输出。现在它已经不存在了。

# macos - Fish Interactive Shell 完整路径

> ID：866989
> 
> 赞同：37
> 
> 时间：2009-05-15T04:34:32.727
> 
> 标签：macos, unix, path, fish

Fish Interactive shell 中是否有办法显示完整路径。目前，当我导航到一个目录时，我得到以下 shell。

```
millermj@Dodore ~/o/workspace 
```

但我宁愿看到

```
millermj@Dodore ~/o-town/workspace 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2016-05-20T03:47:58.220

使用新的 fishshell (v2.3)，您可以执行`set -U fish_prompt_pwd_dir_length 0`. 它将使用完整路径。我也使用[dartfish](https://github.com/amir20/dartfish)作为我的主题。请参见下面的示例：

[![在此处输入图像描述](https://i.stack.imgur.com/St8jW.png)](https://i.stack.imgur.com/St8jW.png)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-04-05T18:31:05.840

这是我的版本`prompt_pwd`，应该显示您正在寻找的内容：

```
function prompt_pwd --description 'Print the current working directory, NOT shortened to fit the prompt'
    if test "$PWD" != "$HOME"
        printf "%s" (echo $PWD|sed -e 's|/private||' -e "s|^$HOME|~|")
    else
        echo '~'
    end

end 
```

像往常一样，这将显示主目录的波浪号，但删除了`sed`当您深入几个目录时仅从每个目录中提取第一个字母的命令。

编辑`prompt_pwd`使用`funced`. 它将允许您以交互方式更改功能。从命令行输入`funced prompt_pwd`。根据您的喜好显示提示后，使用`funcsave prompt_pwd`使该行为在以后的会话中持续存在。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-10-31T20:14:09.753

我个人不喜欢触摸共享/默认值。Fish 具有出色的功能设计，因此请利用它。

使用内容创建`~/.config/fish/functions/prompt_long_pwd.fish`：

```
function prompt_long_pwd --description 'Print the current working directory'
        echo $PWD | sed -e "s|^$HOME|~|" -e 's|^/private||'
end 
```

然后只需编辑您`~/.config/fish/functions/fish_prompt.fish`使用的`prompt_long_pwd`. 这是我使用的自定义提示：

**~/.config/fish/config.fish**：

```
set -g __fish_git_prompt_show_informative_status 1
set -g __fish_git_prompt_hide_untrackedfiles 1

set -g __fish_git_prompt_color_branch magenta bold
set -g __fish_git_prompt_showupstream "informative"
set -g __fish_git_prompt_char_upstream_ahead "↑"
set -g __fish_git_prompt_char_upstream_behind "↓"
set -g __fish_git_prompt_char_upstream_prefix ""

set -g __fish_git_prompt_char_stagedstate "●"
set -g __fish_git_prompt_char_dirtystate "✚"
set -g __fish_git_prompt_char_untrackedfiles "…"
set -g __fish_git_prompt_char_conflictedstate "✖"
set -g __fish_git_prompt_char_cleanstate "✔"

set -g __fish_git_prompt_color_dirtystate blue
set -g __fish_git_prompt_color_stagedstate yellow
set -g __fish_git_prompt_color_invalidstate red
set -g __fish_git_prompt_color_untrackedfiles $fish_color_normal
set -g __fish_git_prompt_color_cleanstate green bold 
```

**~/.config/fish/functions/fish_prompt.fish**

```
function fish_prompt --description 'Write out the prompt'

    set -l last_status $status

    if not set -q __fish_prompt_normal
        set -g __fish_prompt_normal (set_color normal)
    end

    # PWD
    set_color $fish_color_cwd
    echo -n (prompt_long_pwd)
    set_color normal

    printf '%s ' (__fish_git_prompt)

    if not test $last_status -eq 0
    set_color $fish_color_error
    end

    echo -n '$ '

end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-10-14T05:20:53.290

创建`~/.config/fish/functions/prompt_long_pwd.fish`：

```
function prompt_long_pwd --description 'Print the full working directory'
        echo $PWD
end 
```

在`~/.config/fish/functions/fish_prompt.fish`更改`(prompt_pwd) (set_color normal)`为`(prompt_long_pwd) (set_color normal)`.

`(prompt_pwd)`用目录的第一个字母替换目录名称，我有时也觉得这很烦人。你也可以大概修改原来的命令`prompt_pwd`，我没试过。

此答案是从较早的[答案](https://stackoverflow.com/a/26682711/14142051)修改的，并显示完整目录，同时保留默认提示的其他部分。关键变化在于 中的表达式`~/.config/fish/functions/prompt_long_pwd.fish`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-12-10T02:32:49.497

只是想如果你偶然发现这个并且你的鱼没有响应`fish_prompt_pwd_dir_length`变量尝试升级 omf，然后更新你正在使用的 omf 主题，我会提醒大家。然后做一些选择不同主题的组合，重新打开外壳，然后再次选择不同的主题。这对我有用。祝你好运！

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-06-08T04:47:54.513

`prompt_pwd`功能决定要显示的功能。你应该能够编写自己的版本来获得你想要的。

# struts2 - struts2：将变量值分配给复选框的问题

> ID：866996
> 
> 赞同：0
> 
> 时间：2009-05-15T04:40:05.020
> 
> 标签：struts2

我正在研究struts2。在我的 jsp 页面中，我想将字符串变量的值分配给一个复选框（当它被用户选中时）。我尝试了很多次，例如-

```
<% String code = "decompose"; %> 
```

1)
`<tr><td>
<s:checkbox name="codeCkBox" fieldValue="%{‘code’}" onclick="submit()"/> </td></tr>`

2)
`<tr><td>
<s:checkbox name="codeCkBox" value="%{‘code’}" onclick="submit()"/>
</td></tr>`

3)
`<tr><td>
<s:set name="setCkBoxValue" value="%{‘code’}"/>
<s:checkbox name="codeCkBox" fieldValue="# setCkBoxValue" onclick="submit()"/>
</td></tr>`

但是每次当我尝试通过复选框名称获取此值时，它都会返回变量名称，即“代码”。寻找解决方案。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T04:45:12.933

你试过做`${code}`而不是`${'code'}`吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-09T01:31:01.213

你包括你的struts指令吗？我问是因为它只显示“代码”，这可能意味着它忽略了支柱

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-21T12:48:14.440

```
<tr><td> <s:checkbox name="codeCkBox" value="%{#code}"
 onclick="submit()"/> </td></tr> 
```

试试上面的代码。由于代码是 JSP 变量，因此应该在其名称前使用 # 而不是引号来访问它。希望这可以帮助

# gwt - 现有 Java EE 应用程序中的 GWT 集成

> ID：866998
> 
> 赞同：3
> 
> 时间：2009-05-15T04:41:50.710
> 
> 标签：gwt, jakarta-ee, gwt-rpc

我是 GWT 的新手。我在 1.6.4 版中开发了一个 GWT 应用程序，它运行良好。现在我想在现有的 Java EE 应用程序中与该项目集成。我不知道怎么继续。

在这个现有的 Java EE 应用程序中，在哪里复制 GWT 源代码？我也在 GWT 中使用 RPC。

任何人都可以提供帮助吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T05:36:51.267

GWT 只是一组 javascript 和 HTML 文件，因此最基本的集成形式就是将它们放在与您的网页相同的位置的文件夹中。

从那里迈出的一步是将 gwt 编译器集成到您的构建过程中。如果您使用 Netbeans，有一个名为 GWT4NB 的好插件将为您处理所有这些过程，因此当您构建项目的 WAR 时，它也会构建项目的 GWT 部分。Eclipse 可能会有类似的东西。您也可以使用 maven 或 ant 手动完成所有这些操作。

你会告诉编译器你希望它把生成的文件放在哪里，同样，它和你放置你的 WAR 项目的网页的位置相同。无论您将文件放在哪里，它的 RPC 端仍然可以正常工作。*****************~~*