# StackOverflow 问答 000140000-000140999

# bugzilla - 如何更改 Bugzilla 中的状态标签

> ID：140000
> 
> 赞同：6
> 
> 时间：2008-09-26T14:51:22.757
> 
> 标签：bugzilla

我不想更改状态字段的工作方式我只想将标签更改为旧系统使用的状态。（旧系统由电子表格和纸张组成：P
我们使用的是 3.0

```
* 未确认 --> 初步
* 新 --> 设计审查
* 已分配 --> STR1
* 已解决 --> STR2
*重新打开
* 已验证 --> BMR
* 关闭 --> TCG

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T15:19:12.050

如果您以管理员身份登录 bugzilla 系统，您会在底部看到一个显示“字段值”的链接，单击该链接，在下一页您将看到“解决方案”，然后点击您的解决方案想改变，

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:49:53.520

我认为这可以通过修改这里的模板来完成：

[http://www.bugzilla.org/docs/2.22/html/cust-templates.html](http://www.bugzilla.org/docs/2.22/html/cust-templates.html)

具体来说： **global/variables.none.tmpl**

# vbscript - VBScript：如何利用从函数返回的字典对象？

> ID：140002
> 
> 赞同：10
> 
> 时间：2008-09-26T14:51:57.417
> 
> 标签：vbscript

我正在尝试从函数返回字典。我相信该功能可以正常工作，但我不确定如何使用返回的字典。

这是我的功能的相关部分：

```
Function GetSomeStuff()
  '
  ' Get a recordset...
  '

  Dim stuff
  Set stuff = CreateObject("Scripting.Dictionary")
  rs.MoveFirst
  Do Until rs.EOF
    stuff.Add rs.Fields("FieldA").Value, rs.Fields("FieldB").Value
    rs.MoveNext
  Loop

  GetSomeStuff = stuff
End Function 
```

如何调用此函数并使用返回的字典？

编辑：我试过这个：

```
Dim someStuff
someStuff = GetSomeStuff 
```

和

```
Dim someStuff
Set someStuff = GetSomeStuff 
```

当我尝试访问 someStuff 时，出现错误：

```
Microsoft VBScript runtime error: Object required: 'GetSomeStuff' 
```

编辑2：在函数中尝试这个：

```
Set GetSomeStuff = stuff 
```

导致此错误：

```
Microsoft VBScript runtime error: Wrong number of arguments or invalid property assignment. 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-26T15:18:29.117

我不太确定你的问题是什么，所以我做了一些实验。

看来您只是错过了为对象分配引用`set`，即使是返回值也必须使用：

```
Function GetSomeStuff
  Dim stuff
  Set stuff = CreateObject("Scripting.Dictionary")
    stuff.Add "A", "Anaconda"
    stuff.Add "B", "Boa"
    stuff.Add "C", "Cobra"

  Set GetSomeStuff = stuff
End Function

Set d = GetSomeStuff
Wscript.Echo d.Item("A")
Wscript.Echo d.Exists("B")
items = d.Items
For i = 0 To UBound(items)
  Wscript.Echo items(i)
Next 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T15:14:43.977

你试过
`set GetSomeStuff = stuff`
在函数的最后一行做吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:02:22.370

你有没有尝试过：

```
Dim returnedStuff
Set returnedStuff = GetSomeStuff() 
```

然后“For Each”遍历字典？这里有一个使用字典的例子（尽管是 VB6，但它的要点是一样的！[）](http://www.kamath.com/tutorials/tut009_dictionary.asp)。

# unix - 检查 Unix 脚本的 ftp 返回码

> ID：140012
> 
> 赞同：3
> 
> 时间：2008-09-26T14:53:58.083
> 
> 标签：unix, ftp, scripting, return

我目前正在创建一个通宵作业，该作业调用一个 Unix 脚本，该脚本又使用`ftp`. 我想检查所有可能的返回码。的手册页`ftp`没有列出返回码。有谁知道在哪里可以找到清单？有这方面经验的人吗？我们还有其他脚本在日志中对某些返回字符串进行 grep，并在出错时发送电子邮件。然而，他们经常错过意料之外的代码。然后我将原因放入日志和电子邮件中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T15:03:41.680

在我遇到的大多数实现中，该`ftp`命令不会返回零以外的任何值。

处理日志中的三位数代码要好得多 - 如果您要发送二进制文件，您可以检查发送的字节是否正确。

三位数代码称为“系列代码”，可以在[此处找到列表](http://www.ftpplanet.com/ftpresources/ftp_codes.htm)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-14T18:27:57.353

我编写了一个脚本，一次只传输一个文件，并在该脚本中用于`grep`检查`226 Transfer complete`消息。如果找到，则`grep`返回 0。

```
ftp -niv < "$2"_ftp.tmp | grep "^226 " 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-28T01:30:04.660

安装[ncftp](http://www.ncftp.com/)包。它带有[ncftpget](http://www.ncftp.com/ncftp/doc/ncftpget.html)和[ncftpput](http://www.ncftp.com/ncftp/doc/ncftpput.html)，它们都将尝试上传/下载单个文件，如果出现问题，则返回描述性错误代码。[请参阅手册页](http://linux.die.net/man/1/ncftpput)的“诊断”部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T15:57:47.010

我认为如果出现问题，运行 ftp 并检查 ftp 的退出代码会更容易。

我做了这个像下面的例子：

```
# ...
ftp -i -n $HOST 2>&1 1> $FTPLOG << EOF
quote USER $USER
quote PASS $PASSWD
cd $RFOLDER
binary
put $FOLDER/$FILE.sql.Z $FILE.sql.Z
bye
EOF

# Check the ftp util exit code (0 is ok, every else means an error occurred!)
EXITFTP=$?
if test $EXITFTP -ne 0; then echo "$D ERROR FTP" >> $LOG; exit 3; fi
if (grep "^Not connected." $FTPLOG); then echo "$D ERROR FTP CONNECT" >> $LOG; fi 
if (grep "No such file" $FTPLOG); then echo "$D ERROR FTP NO SUCH FILE" >> $LOG; fi 
if (grep "access denied" $FTPLOG ); then echo "$D ERROR FTP ACCESS DENIED" >> $LOG; fi
if (grep "^Please login" $FTPLOG ); then echo "$D ERROR FTP LOGIN" >> $LOG; fi 
```

**编辑：**为了捕捉错误，我 grep ftp 命令的输出。但这确实不是最好的解决方案。

我不知道您对 Perl、Python 或 Ruby 等脚本语言有多熟悉。它们都有一个可供您使用的 FTP 模块。这使您能够在每个命令之后检查错误。这是 Perl 中的一个示例：

```
#!/usr/bin/perl -w
use Net::FTP;
$ftp = Net::FTP->new("example.net") or die "Cannot connect to example.net: $@";
$ftp->login("username", "password") or die "Cannot login ", $ftp->message;
$ftp->cwd("/pub") or die "Cannot change working directory ", $ftp->message;
$ftp->binary;
$ftp->put("foo.bar") or die "Failed to upload ", $ftp->message;
$ftp->quit; 
```

要使此逻辑正常工作，用户还需要从 ftp 命令重定向 STDERR，如下所示

```
ftp -i -n $HOST >$FTPLOG 2>&1 << EOF 
```

下面的命令将始终分配 0（成功），因为 ftp 命令不会返回成功或失败。所以用户不应该依赖它

```
EXITFTP=$? 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:03:19.420

蹩脚的答案我知道，但是如何获取 ftp 源并自己查看

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-23T10:34:07.460

我喜欢 Anurag 的解决方案，对于字节传输问题，我使用 grep -v "bytes" 扩展了命令

IE

grep "^530" ftp_out2.txt | grep -v "字节"

- 而不是 530，您可以像 Anurag 那样使用所有错误代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-03T19:18:51.903

这是我最终选择的。感谢所有的帮助。所有的答案都帮助我朝着正确的方向前进。检查结果和日志可能有点矫枉过正，但它应该涵盖所有基础。

```
echo "open ftp_ip
pwd
binary    
lcd /out
cd /in
mput datafile.csv
quit"|ftp -iv > ftpreturn.log

ftpresult=$?

bytesindatafile=`wc -c datafile.csv | cut -d " " -f 1`    
bytestransferred=`grep -e '^[0-9]* bytes sent' ftpreturn.log | cut -d " " -f 1`    
ftptransfercomplete=`grep -e '226 ' ftpreturn.log | cut -d " " -f 1`

echo "-- FTP result code: $ftpresult" >> ftpreturn.log
echo "-- bytes in datafile: $bytesindatafile bytes" >> ftpreturn.log
echo "-- bytes transferred: $bytestransferred bytes sent" >> ftpreturn.log

if [ "$ftpresult" != "0" ] || [ "$bytestransferred" != "$bytesindatafile" ] || ["$ftptransfercomplete" != "226" ]    
then    
  echo "-- *abend* FTP Error occurred" >> ftpreturn.log    
  mailx -s 'FTP error' `cat email.lst` < ftpreturn.log
else    
  echo "-- file sent via ftp successfully" >> ftpreturn.log    
fi 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T23:06:39.113

你说你想把文件 FTP 到那里，但你没有说普通的 BSD FTP 客户端是否是你想把它送到那里的唯一方法。BSD FTP 不会为需要所有解析的错误条件提供返回代码，但是如果您或您的管理员将安装它们，则可以使用一系列其他 Unix 程序通过 FTP 传输文件。我将为您提供一些通过 FTP 传输文件的方法示例，同时仍然使用少量代码捕获所有错误情况。

FTPUSER 是您的 ftp 用户登录名

FTPPASS 是您的 ftp 密码

FILE 是您要上传的没有任何路径信息的本地文件（例如 file1.txt，而不是 /whatever/file1.txt 或whatever/file1.txt

FTPHOST 是您要通过 FTP 连接到的远程计算机

REMOTEDIR 是您要上传到的远程计算机上的位置的绝对路径

以下是示例：

curl --user $FTPUSER:$FTPPASS -T $FILE ftp://$FTPHOST/%2f$REMOTEDIR

ftp-upload --host $FTPHOST --user $FTPUSER --password $FTPPASS --as $REMOTEDIR/$FILE $FILE

tnftp -u ftp://$FTPUSER:$FTPPASS@$FTPHOST/%2f$REMOTEDIR/$FILE $FILE

wput $FILE ftp://$FTPUSER:$FTPPASS@$FTPHOST/%2f$REMOTEDIR/$FILE

如果出现任何问题，所有这些程序都将返回一个非零退出代码，以及指示失败的文本。您可以对此进行测试，然后根据需要对输出进行任何操作、记录、发送电子邮件等。

但请注意以下事项：

1.  URL 中使用“%2f”表示以下路径是远程计算机上的绝对路径。但是，如果您的 FTP 服务器对您进行 chroot，您将无法绕过它。

2.  对于上面使用实际 URL ( [ftp://etc](ftp://etc) ) 并嵌入用户和密码的服务器的命令，如果用户名和密码包含特殊字符，则必须是 URL 编码的。

3.  在某些情况下，一旦您熟悉了每个程序的语法，您就可以灵活地将远程目录设为绝对目录，将本地文件设为纯文件名。您可能只需要添加一个本地目录环境变量或对所有内容进行硬编码。

4.  如果你真的，绝对必须使用常规的 FTP 客户端，你可以测试失败的一种方法是在你的脚本中，首先包括一个 PUT 文件的命令，然后是另一个执行相同文件的 GET 的命令，在不同的情况下返回它姓名。FTP 退出后，只需在您的 shell 脚本中测试下载的文件是否存在，或者甚至将其与原始文件进行校验，以确保它正确传输。是的，这很臭，但在我看来，拥有易于阅读的代码比对每种可能的错误情况进行大量解析要好。BSD FTP 并不是那么好。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-26T15:03:02.570

为什么不将命令的所有输出存储到日志文件中，然后检查命令的返回码，如果不为 0，则将日志文件发送到电子邮件中？

# python - 编写用于从表中选择行的领域特定语言

> ID：140026
> 
> 赞同：5
> 
> 时间：2008-09-26T14:56:05.303
> 
> 标签：python, database, algorithm, dsl

我正在编写一个我希望由许多不同的人运行的服务器，而不是我将直接接触的所有人。服务器将在集群中相互通信。服务器的部分功能涉及从可能非常大的表中选择一小部分行。选择哪些行的确切选择需要一些调整，重要的是运行集群的人（例如，我自己）可以更新选择标准，而无需让每个服务器管理员都部署新版本的服务器.

简单地用 Python 编写函数并不是一个真正的选择，因为没有人会想要安装一个在运行时下载和执行任意 Python 代码的服务器。

我需要的是关于实现领域特定语言以实现这一目标的最简单方法的建议。该语言需要能够进行简单的表达式评估，以及查询表索引和遍历返回的行。易于编写和阅读该语言是次要的，易于实现它。我也不想写一个完整的查询优化器，所以明确指定要查询的索引是理想的。

必须针对此进行编译的接口在功能上与 App Engine 数据存储区导出的功能相似：您可以查询表上任何索引的顺序范围（例如，小于、大于、范围和相等查询） ，然后通过任何布尔表达式过滤返回的行。您还可以将多个独立的结果集连接在一起。

我意识到这个问题听起来很像我在问 SQL。但是，我不想要求支持此数据的数据存储是关系数据库，并且我不希望自己尝试重新实现 SQL 的开销。我还只处理一个具有已知模式的表。最后，不需要任何连接。更简单的东西会更可取。

编辑：扩展描述以消除一些误解。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T22:14:14.890

构建由 Python 解释的 DSL。

步骤 1\. 构建运行时类和对象。这些类将所有游标循环和 SQL 语句以及所有算法处理都隐藏在它们的方法中。您将大量使用[命令](http://exciton.cs.rice.edu/javaresources/DesignPatterns/command.htm)和[策略](http://exciton.cs.rice.edu/javaresources/DesignPatterns/StrategyPattern.htm)设计模式来构建这些类。大多数东西都是命令，选项和选择是插件策略。看看 Apache Ant 的[Task](http://ant.apache.org/manual/develop.html) API 的设计——这是一个很好的例子。

步骤 2\. 验证这个对象系统是否确实有效。确保设计简单而完整。您的测试将构造 Command 和 Strategy 对象，然后执行顶级 Command 对象。命令对象将完成这项工作。

至此，您基本上完成了。您的运行时只是从上述域创建的对象的配置。[这并不像听起来那么容易。定义一组可以实例化的类，然后“相互交流”以完成应用程序的工作，需要小心谨慎。]

请注意，您将拥有的只是声明。程序有什么问题？当您开始编写带有过程元素的 DSL 时，您会发现需要越来越多的功能，直到您使用不同的语法编写 Python。不好。

此外，程序语言解释器很难编写。执行状态和引用范围很难管理。

您可以使用本机 Python ——而不必担心“走出沙箱”。实际上，这就是您将如何对所有内容进行单元测试，使用一个简短的 Python 脚本来创建您的对象。Python 将成为 DSL。

[“但是等等”，你说，“如果我简单地使用 Python 作为 DSL，人们可以执行任意事情。” 取决于 PYTHONPATH 和 sys.path 上的内容。查看[站点](http://docs.python.org/lib/module-site.html)模块以了解控制可用内容的方法。]

声明式 DSL 是最简单的。这完全是一种表现形式的练习。只设置一些变量的值的 Python 块很好。这就是 Django 使用的。

您可以使用[ConfigParser](http://docs.python.org/lib/module-ConfigParser.html)作为一种语言来表示对象的运行时配置。

您可以使用[JSON](http://pypi.python.org/pypi/python-json/)或[YAML](http://pyyaml.org/)作为一种语言来表示对象的运行时配置。现成的解析器是完全可用的。

您也可以使用 XML。设计和解析更难，但效果很好。人们喜欢它。这就是 Ant 和 Maven（以及许多其他工具）使用声明性语法来描述过程的方式。我不推荐它，因为它是一个罗嗦的脖子痛。我建议简单地使用 Python。

或者，您可以深入研究并发明自己的语法并编写自己的解析器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:35:16.627

我想我们在这里需要更多信息。让我知道以下任何内容是否基于不正确的假设。

首先，正如您自己指出的那样，已经存在一种用于从任意表中选择行的 DSL——它被称为“SQL”。由于您不想重新发明 SQL，我假设您只需要从具有固定格式的单个表中进行查询。

如果是这种情况，您可能不需要实现 DSL（尽管这肯定是一种方法）；如果您习惯于面向对象，那么创建过滤器对象可能会更容易。

更具体地说，一个“过滤器”集合，它将包含一个或多个 SelectionCriterion 对象。您可以实现这些以从一个或多个表示选择类型（Range、LessThan、ExactMatch、Like 等）的基类继承。一旦这些基类到位，您就可以创建适用于该列的特定于列的继承版本. 最后，根据您要支持的查询的复杂性，您需要实现某种连接胶水来处理各种条件之间的 AND 和 OR 和 NOT 链接。

如果您愿意，可以创建一个简单的 GUI 来加载集合；如果您没有其他想法，我会将 Excel 中的过滤视为一个模型。

最后，将这个 Collection 的内容转换为相应的 SQL，并将其传递给数据库应该很简单。

但是：如果您追求的是简单性，并且您的用户理解 SQL，您可以简单地要求他们输入 WHERE 子句的内容，然后以编程方式构建查询的其余部分。从安全角度来看，如果您的代码可以控制所选列和 FROM 子句，并且您的数据库权限设置正确，并且您对来自用户的字符串进行了一些健全性检查，这将是一个相对安全的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:46:31.187

“实现领域特定语言”

“没有人会想要安装一个在运行时下载和执行任意 Python 代码的服务器”

我想要一个 DSL，但我不希望 Python 成为那个 DSL。好的。你将如何执行这个 DSL？如果不是 Python，什么运行时*是可以接受的？*

如果我有一个恰好嵌入 Python 解释器的 C 程序怎么办？这可以接受吗？

而且——如果 Python 不是一个可接受的运行时——为什么它有一个 Python 标记？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:02:56.707

为什么不创建一种在“编译”时生成 SQL 或数据存储所需的任何查询语言的语言？

您将基本上在持久层上创建一个抽象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T15:07:03.933

你提到了 Python。为什么不使用 Python？如果有人可以在你的 DSL 中“输入”一个表达式，他们就可以输入 Python。

您需要一些关于表达式结构的规则，但这比实现新的东西要容易得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:29:21.667

你说没有人会想要安装一个在运行时下载和执行任意代码的服务器。然而，这正是你的 DSL 将要做的（最终），所以可能没有太大的区别。除非你对数据做一些非常具体的事情，否则我认为 DSL 不会给你买那么多东西，它会让已经精通 SQL 的用户感到沮丧。不要低估你将要承担的任务的规模。

但是，要回答您的问题，您需要为您的语言提出一个语法，解析文本并遍历树，发出代码或调用您编写的 API（这就是为什么我评论说您是仍然需要发布一些代码）。

有很多关于数学表达式语法的教育文本，你可以在网上参考，这是相当直接的。您可能有一个解析器生成器工具，如 ANTLR 或 Yacc，可用于帮助您生成解析器（或使用 Lisp/Scheme 之类的语言并将两者结合起来）。想出一个合理的 SQL 语法并不容易。但是谷歌'BNF SQL'，看看你想出了什么。

祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T15:39:40.877

听起来确实像 SQL，但如果您想保持简单，也许值得尝试使用 SQLite？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T21:05:15.197

听起来您想创建语法而不是 DSL。我会研究[ANTLR](http://antlr.org/)它将允许您创建一个特定的解析器，它将解释文本并转换为特定的命令。ANTLR 为 Python、SQL、Java、C++、C、C# 等提供库。

此外，这里是一个用 C# 创建的 ANTLR[计算引擎](http://www.codeproject.com/KB/recipes/sota_expression_evaluator.aspx)的好例子

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-16T03:56:11.537

上下文无关语法通常具有树状结构，功能程序也具有树状结构。我并不声称以下内容可以解决您的所有问题，但如果您确定不想使用类似`SQLite3`.

```
from functools import partial
def select_keys(keys, from_):
    return ({k : fun(v, row) for k, (v, fun) in keys.items()}
            for row in from_)

def select_where(from_, where):
    return (row for row in from_
            if where(row))

def default_keys_transform(keys, transform=lambda v, row: row[v]):
    return {k : (k, transform) for k in keys}

def select(keys=None, from_=None, where=None):
    """
    SELECT v1 AS k1, 2*v2 AS k2 FROM table WHERE v1 = a AND v2 >= b OR v3 = c

    translates to 

    select(dict(k1=(v1, lambda v1, r: r[v1]), k2=(v2, lambda v2, r: 2*r[v2])
        , from_=table
        , where= lambda r : r[v1] = a and r[v2] >= b or r[v3] = c)
    """
    assert from_ is not None
    idfunc = lambda k, t : t
    select_k = idfunc if keys is None  else select_keys
    if isinstance(keys, list):
        keys = default_keys_transform(keys)
    idfunc = lambda t, w : t
    select_w = idfunc if where is None else select_where
    return select_k(keys, select_w(from_, where)) 
```

你如何确保你没有给用户执行任意代码的能力。这个框架承认所有可能的功能。好吧，为了安全起见，您可以在其上设置一个包装器，以公开可接受的函数对象的固定列表。

```
ALLOWED_FUNCS = [ operator.mul, operator.add, ...] # List of allowed funcs

def select_secure(keys=None, from_=None, where=None):
    if keys is not None and isinstance(keys, dict):
       for v, fun keys.values:
           assert fun in ALLOWED_FUNCS
    if where is not None:
       assert_composition_of_allowed_funcs(where, ALLOWED_FUNCS)
    return select(keys=keys, from_=from_, where=where) 
```

怎么写`assert_composition_of_allowed_funcs`。在 python 中很难做到这一点，但在 lisp 中很容易。让我们假设 where 是一个要以嘴唇形式评估的函数列表，例如格式 ie`where=(operator.add, (operator.getitem, row, v1), 2)`或`where=(operator.mul, (operator.add, (opreator.getitem, row, v2), 2), 3)`。

这样就可以编写一个`apply_lisp`函数，确保 where 函数仅由 ALLOWED_FUNCS 或诸如 float、int、str 之类的常量组成。

```
def apply_lisp(where, rowsym, rowval, ALLOWED_FUNCS):
    assert where[0] in ALLOWED_FUNCS
    return apply(where[0],
          [ (apply_lisp(w, rowsym, rowval, ALLOWED_FUNCS)
            if isinstance(w, tuple)
            else rowval if w is rowsym
            else w if isinstance(w, (float, int, str))
            else None ) for w in where[1:] ]) 
```

除此之外，您还需要检查确切的类型，因为您不希望您的类型被覆盖。所以不要用`isinstance`，用`type in (float, int, str)`。哦，男孩，我们遇到了：

> Greenspun 的第十条编程规则：任何足够复杂的 C 或 Fortran 程序都包含一个临时的、非正式指定的、充满 bug 的慢速实现，它是 Common Lisp 的一半。

# java - Java VM EXCEPTION_ACCESS_VIOLATION 的可能原因？

> ID：140030
> 
> 赞同：38
> 
> 时间：2008-09-26T14:56:36.940
> 
> 标签：java, null, jvm, crash, swt

当 Java VM 因 EXCEPTION_ACCESS_VIOLATION 崩溃并生成 hs_err_pidXXX.log 文件时，这表明了什么？错误本身基本上是一个空指针异常。它总是由 JVM 中的错误引起的，还是有其他原因，例如硬件故障或软件冲突？

编辑：有一个本机组件，这是 win32 上的 SWT 应用程序。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T15:19:46.493

大多数情况下，这是 VM 中的错误。但它可能是由任何本机代码（例如 JNI 调用）引起的。

hs_err_pidXXX.log 文件应包含有关问题发生位置的一些信息。

您还可以检查文件内的“堆”部分。许多 VM 错误是由垃圾收集引起的（尤其是在较旧的 VM 中）。本部分应向您显示崩溃时垃圾是否正在运行。此部分还显示，如果堆的某些部分被填充（百分比数字）。

与其他情况相比，VM 在内存不足的情况下也更有可能崩溃。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-11-13T15:48:55.673

找到答案了！

我遇到了同样的错误，并注意到提供 pid 日志文件内容的其他人正在运行 64 位 Windows。就像我。在最后的日志文件中，它包含 PATH 语句。在那里我可以看到 C:\Windows\SysWOW64 被错误地列在前面：%SystemRoot%\system32。一旦我纠正它，异常就消失了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:44:19.020

您应该做的第一件事是将 JVM 升级到最新版本。

你能重复一下这个问题吗？或者它似乎是随机发生的？我们最近遇到了一个问题，即我们的 JVM 在各处随机崩溃。原来是硬件问题。我们将驱动器放在新服务器中，它完全消失了。

最重要的是，JVM 不应该崩溃，正如上面的海报所提到的，如果你没有做任何 JNI，那么我的直觉是你有硬件问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-27T03:45:19.587

如果您知道要查找的内容，问题的原因将记录在 hs_err* 文件中。看一看，如果仍然不清楚，请考虑发布堆栈跟踪的前 5 或 10 行和其他相关信息（不要发布整个内容，那里有大量信息无济于事 -但你必须弄清楚哪 1%*是*重要的 :-) )

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T04:46:14.893

您是否使用浏览器小部件并在浏览器小部件中执行 javascript？如果是这样，那么某些版本的 SWT 中存在导致 JVM 在本机代码和各种 Windows 库中崩溃的错误。

两个例子（我打开的）是[bug 217306](https://bugs.eclipse.org/bugs/show_bug.cgi?id=217306)和[bug 127960](https://bugs.eclipse.org/bugs/show_bug.cgi?id=127960)。然而，这两个错误报告并不是 JVM 在 SWT 中崩溃的唯一错误报告。

如果您没有使用浏览器小部件，那么这些建议对您没有帮助。在这种情况下，您可以搜索[导致 JVM 崩溃的 SWT 错误](https://bugs.eclipse.org/bugs/buglist.cgi?quicksearch=swt+jvm+crash)列表。如果这些都不是您的问题，那么我强烈建议您使用 SWT 打开错误报告。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-24T22:06:23.680

我已经使用了很长时间并且非常可靠的 JNLP 应用程序也有同样的问题。我从 Windows 7 升级到 Windows 10 后立即出现问题。根据我的调查，这很可能是 Win 10 中的一个错误。

以下不是解决方案，而是一个丑陋的解决方法。在 jre/bin 目录下，有**javaws.exe**。如果我*右键单击* **/Properties/Compatibility**并勾选**Run this program as an administrator**，JNLP 应用程序开始工作。

请注意，这种方法可能会导致安全问题，并且只有在您没有其他选择并且 100% 知道您在做什么时才使用它。

# c++ - boost::shared_ptr 标准容器

> ID：140033
> 
> 赞同：6
> 
> 时间：2008-09-26T14:57:41.977
> 
> 标签：c++, smart-pointers, std, stdmap

假设我有一个类 foo，并希望使用 std::map 来存储一些 boost::shared_ptrs，例如：

```
class foo;

typedef boost::shared_ptr<foo> foo_sp;
typeded std::map<int, foo_sp> foo_sp_map;

foo_sp_map m; 
```

如果我向地图添加了一个新的 foo_sp 但使用的键已经存在，是否会删除现有条目？例如：

```
foo_sp_map m;

void func1()
{
    foo_sp p(new foo);
    m[0] = p;
}

void func2()
{
    foo_sp p2(new foo);
    m[0] = p2;
} 
```

原来的指针（p）被p2替换后会被释放吗？我很确定它会是，但我认为值得询问/分享。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T15:00:20.190

首先，你的问题标题是 boost::auto_ptr，但实际上你的意思是 boost::shared_ptr

是的，原始指针将被释放（如果没有进一步的共享引用）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:09:36.657

这取决于您的 ... 部分中发生的情况

您的容器类包含*foo_sp*实例的副本，当您执行最初在该位置`m[0] = p2;`的副本`p`超出范围时。那时*如果没有其他 foo_sp 引用*它，它将被删除。

如果第二行中声明的副本`foo_sp p(new foo);`仍然存在，则不会释放内存。一旦所有对它的引用都被删除，该条目将被删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:05:34.140

由于stackoverflow不允许我发表评论，我只会回答。：/

我没有看到“p”超出范围，所以它指向的对象*不会*被释放。“p”仍将指向它。

# c# - 循环遍历 ResourceManager 中的所有资源 - C#

> ID：140043
> 
> 赞同：18
> 
> 时间：2008-09-26T14:58:37.107
> 
> 标签：c#, resources

如何循环进入资源管理器中的所有资源？

即：foreach(ResourceManager 中的字符串资源) //对资源做一些事情。

谢谢

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-26T15:01:55.320

使用资源管理器。[GetResourceSet](http://msdn.microsoft.com/en-us/library/system.resources.resourcemanager.getresourceset.aspx) () 获取给定文化的所有资源的列表。返回的 ResourceSet 实现了 IEnumerable（可以使用 foreach）。

* * *

`IEnumerable`要回答 Nico 的问题：您可以通过将其转换为泛型来计算 an 的元素`IEnumerable<object>`并使用[`Enumerable.Count<T>()`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.count.aspx)扩展方法，这是 C# 3.5 中的新方法：

```
using System.Linq;

...

var resourceSet = resourceManager.GetResourceSet(..);
var count = resSet.Cast<object>().Count(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:33:11.093

我想知道您为什么要遍历所有资源。

无论如何，`ResourceManager`需要实例化给它一个`Type`或基本名称来查找资源。然后，如果您想获取给定 `ResourceManager 的所有资源，您将能够检索给定的`ResourceSet`但是`CultureInfo`

# c# - RightNow CRM XML API - 任何熟悉它的人？

> ID：140044
> 
> 赞同：1
> 
> 时间：2008-09-26T14:59:11.940
> 
> 标签：c#, asp.net, xml, vb.net, rightnow-crm

我需要在 vb.net 或 c# 中创建一个用户控件来搜索 RightNow CRM 数据库。我有关于他们的 XML API 的文档，但我不确定如何发布到他们的解析器，然后捕获返回数据并将其显示在页面上。

任何示例代码将不胜感激！

API 链接：http: [//community.rightnow.com/customer/documentation/integration/82_crm_integration.pdf](http://community.rightnow.com/customer/documentation/integration/82_crm_integration.pdf)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T12:38:24.437

我不知道 RightNow CRM，但根据文档，您可以使用 HTTP post 发送 XML 请求。在 .NET 中执行此操作的最简单方法是使用 WebClient 类。或者，您可能想查看 HttpWebRequest/HttpWebResponse 类。下面是一些使用 WebClient 的示例代码：

```
using System.Net;
using System.Text;
using System;

namespace RightNowSample
{
    class Program
    {
        static void Main(string[] args)
        {
            string serviceUrl = "http://<your_domain>/cgi-bin/<your_interface>.cfg/php/xml_api/parse.php";
            WebClient webClient = new WebClient();
            string requestXml = 
@"<connector>
<function name=""ans_get"">
<parameter name=""args"" type=""pair"">
<pair name=""id"" type=""integer"">33</pair>
<pair name=""sub_tbl"" type='pair'>
<pair name=""tbl_id"" type=""integer"">164</pair>
</pair>
</parameter>
</function>
</connector>";

            string secString = "";
            string postData = string.Format("xml_doc={0}, sec_string={1}", requestXml, secString);
            byte[] postDataBytes = Encoding.UTF8.GetBytes(postData);

            byte[] responseDataBytes = webClient.UploadData(serviceUrl, "POST", postDataBytes);
            string responseData = Encoding.UTF8.GetString(responseDataBytes);

            Console.WriteLine(responseData);
        }
    }
} 
```

我无法访问 RightNow CRM，因此无法对此进行测试，但它可以作为您的起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-07-15T04:35:32.040

这将立即创建一个联系人

```
 class Program
{
    private RightNowSyncPortClient _Service;
    public Program()
    {
        _Service = new RightNowSyncPortClient();
        _Service.ClientCredentials.UserName.UserName = "Rightnow UID";
        _Service.ClientCredentials.UserName.Password = "Right now password";
    }
    private Contact Contactinfo()
    {
        Contact newContact = new Contact();
        PersonName personName = new PersonName();
        personName.First = "conatctname";
        personName.Last = "conatctlastname";
        newContact.Name = personName;
        Email[] emailArray = new Email[1];
        emailArray[0] = new Email();
        emailArray[0].action = ActionEnum.add;
        emailArray[0].actionSpecified = true;
        emailArray[0].Address = "mail@mail.com";
        NamedID addressType = new NamedID();
        ID addressTypeID = new ID();
        addressTypeID.id = 1;
        addressType.ID = addressTypeID;
        addressType.ID.idSpecified = true;
        emailArray[0].AddressType = addressType;
        emailArray[0].Invalid = false;
        emailArray[0].InvalidSpecified = true;
        newContact.Emails = emailArray;
        return newContact;
    }
    public long CreateContact()
    {
        Contact newContact = Contactinfo();
        //Set the application ID in the client info header
        ClientInfoHeader clientInfoHeader = new ClientInfoHeader();
        clientInfoHeader.AppID = ".NET Getting Started";
        //Set the create processing options, allow external events and rules to execute
        CreateProcessingOptions createProcessingOptions = new CreateProcessingOptions();
        createProcessingOptions.SuppressExternalEvents = false;
        createProcessingOptions.SuppressRules = false;
        RNObject[] createObjects = new RNObject[] { newContact };
        //Invoke the create operation on the RightNow server
        RNObject[] createResults = _Service.Create(clientInfoHeader, createObjects, createProcessingOptions);

        //We only created a single contact, this will be at index 0 of the results
        newContact = createResults[0] as Contact;
        return newContact.ID.id;
    }

    static void Main(string[] args)
    {
        Program RBSP = new Program();
        try
        {
            long newContactID = RBSP.CreateContact();
            System.Console.WriteLine("New Contact Created with ID: " + newContactID);
        }
        catch (FaultException ex)
        {
            Console.WriteLine(ex.Code);
            Console.WriteLine(ex.Message);
        }

        System.Console.Read();

    }
} 
```

# embedded - AVR 或 PIC 开始编程微控制器？

> ID：140049
> 
> 赞同：37
> 
> 时间：2008-09-26T15:00:20.660
> 
> 标签：embedded, microcontroller

我应该从哪个家庭开始学习？（从未在微控制器上做过任何编程）

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-02T20:53:00.293

今天，AVR 和 PIC 可能是爱好者中最常见的微控制器。两者都有非常广泛的设备变体，并且都可以用来实现类似的结果。

对于初学者，由于各种原因，我建议使用 AVR：

*   AVR 系列（小型、大型）连贯且易于理解。该架构功能强大且现代，特别适用于 C 编译器。AVR 当然也可以在汇编中编程。

*   由于其 C 友好的架构，有高质量的 C 编译器可用，包括商业的和免费的。无处不在的 GCC 被移植到 AVR 并称为[avr-gcc](http://www.avrfreaks.net/wiki/index.php/Documentation:AVR_GCC)。

*   开始时，您真正需要的只是一些基本组件、AVR 芯片本身和[面包板](http://en.wikipedia.org/wiki/Breadboard)。甚至 PC 和 AVR 之间的编程电缆也基本上可以免费构建（所谓的 wiggler）。但是，有几种商业开发套件可供使用，最著名的是 Atmel 自己的[STK500](http://www.atmel.com/dyn/Products/tools_card.asp?tool_id=2735)。商业开发套件是更昂贵的入门方式，但实际上不需要任何有关电子学的先验知识。一些开发套件包含例如[LCD 显示器](http://www.olimex.com/dev/avr-mt128.html)，因此很容易完成有趣的事情。

*   它有一个丰富的[爱好者社区](http://www.avrfreaks.net/)。

PIC以其独特的架构而臭名昭著。许多人为此喜欢 PIC，有些人讨厌它。AVR 更直接，似乎不会引起那么多极端和极端的意见。

AVR 和 PIC 都用于许多严肃的商业应用。但是，它们当然不是唯一的选择。我个人最喜欢的用于业余爱好和商业工作的微控制器是 Silicon Laboratories 的 C8051 系列，最著名的是 C8051 [F530](https://www.silabs.com/products/mcu/automotive/Pages/C8051F52xA-53xA.aspx)。C8051 系列有一个出色的免费 C 编译器和汇编器，称为[SDCC](http://sdcc.sourceforge.net/)。

摘要：有很多选择，但请不要让您不知所措。只需选择一个并开始学习它。一旦你决定开始，微控制器真的非常容易掌握！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T15:03:07.797

我的老板在没有经验的情况下在一周内学会了使用 AVR 的基础知识。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-22T01:14:59.250

我会推荐AVR。它已远远超过 PIC，成为一般爱好者项目的首选微控制器平台。最值得注意的是，考虑 Arduino（和其他 *duino）平台，它以易于接口和流行的外形提供高端 AVR。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-12T15:27:33.907

我做过一些 PIC 编程——主要是因为我喜欢这个芯片只有一两美元的想法。然而，对于初学者来说，仅仅根据价格做出决定是过早的优化。

用汇编程序编程是一种体验。您基本上必须先了解 100 个概念，然后才能使 LED 闪烁。（看门狗定时器、复位引脚、8 位计数器/溢出、延迟循环、十六进制、二进制、位掩码、中断、中断服务请求、IO 端口等）这一切都非常有教育意义 - 如此接近的感觉很棒到机器上——但是能够用 C 编写一些东西会隐藏一些这种复杂性，这样你就可以专注于结果。出于这个原因，我会说选择 AVR。（而且我相信价格现在更接近图片。）

另外：如果您有兴趣完成工作（并且不介意花费约 30 美元），请查看[arduino](http://en.wikipedia.org/wiki/Arduino)。一个在我当地的电子商店卖它们的人说他正在向艺术学生出售大量它们。（它使用 Processing 项目中的 IDE，并使用 avr-gcc 编译代码。）

更新：修正了 Arduino 运行解释代码的注释。还更新了大约 Arduino 价格。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-13T21:21:02.230

我非常喜欢 AVR 而不是 PIC，我觉得它的架构有点乱。这可能只有我一个人，如果你能用高级语言编写它不会给你带来麻烦，很可能是 C 的（某种方言）。

由于您是微控制器的新手，我认为性能不会成为问题，因此我会寻找开发工具的可用性：原型板、IDE 和仿真/调试工具。我个人非常喜欢 AVR Studio（Atmel 的免费开发环境）。

Jason 提到了 TI 的 MSP430，它确实是一款出色的控制器，尤其是在功耗极低的应用中。但我不会向新手推荐它，因为配置有点麻烦。（我记得振荡器的描述在用户手册中涵盖了 20 多页。）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-14T01:47:04.243

一些人评论了 PIC micro 的奇怪（和 C 不友好）架构。较小的 PIC 确实如此，但 16 位芯片（PIC24F、dsPIC30 等）具有非常清晰的架构，可以很好地与 C 配合使用。

PIC24F 系列能够动态地将引脚分配给功能（定时器、A/D、串行 I/O），使其更易于设计。用于调试和开发的 MPLAB 环境非常好。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-10-26T05:44:12.397

我不明白 arduino 有什么大不了的，它会破坏你了解实际情况的机会。我经常用 AVR 和 PIC 编程，基本上没有太大区别，我看不出有什么大惊小怪的。然而，对于初学者来说，远离 arduino 可能很简单，但这就是陷阱，它没有给你硬件架构的概念，也不知道幕后发生了什么，初学者需要学习成为一名有效的程序员的东西。当我还是一个初学者时，我从一个 ATmega32 开始，一个 20 美元的 USBasp 程序员、AVR Studio（免费）和 AVRDude（WinAVR 附带），并遵循 AVR Freaks 中的介绍教程。这就是你所需要的，完成！！！

PS 如果你想真正学习如何编程微控制器并有时间为你的微控制器学习汇编程序，那么你的 C 程序员将是开始使用 arduino 的人的 20 倍。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-26T15:04:52.130

我投票给 PIC 以支持各种可用的设备。但我必须说，当我开始使用 PIC 时，它们几乎什么都不是。也许现在情况发生了变化。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-10T19:36:00.733

我投票支持 TI 的[MSP430](http://focus.ti.com/mcu/docs/mcuprodoverview.tsp?sectionId=95&tabId=140&familyId=342)系列。我已经广泛使用了 PIC（还有一点 Atmel 芯片），到目前为止，对我来说最重要的是一个好的调试 IDE。TI 在这方面做得很好，他们的 C++ 编译器工作得非常好。您可以以不到 100 美元的价格购买评估板，包括 IDE + USB 调试器。PIC 具有更好、更多样化的硬件外设，但 MPLAB 是一个废话，唯一的 PIC 的 C++ IDE 是 IAR 的一个，它相当昂贵。（超过 2000 美元）

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-05-01T21:54:24.493

我/我们选择 PIC 主要是因为同样的价格有更多的外围硬件。更重要的是，您甚至找不到可比的 AVR。我确实选择了其中一个旧的免费版本（从 PIC18 开始，迁移到 dspic33）

IDE 是免费的，（C）编译器在学生版中是免费的（第一个月后禁用优化）。入门级程序员也相当便宜。如果您有大量的中断、计数器和计时器，那么您可能根本不需要优化。直接来自 Microchip 的程序员是 30 美元。

请注意，上述关于 AVR 更适合 HLL 开发的评论有些过时，除非您真的选择像 PIC12 和 16 这样的传统架构。

一种典型的做法是用 C 编写更现代的 PIC18（8 位）和 16 位架构（24F、30F 和 dspic33，它们基于相同的主内核）。16 位甚至使用 GCC。现在也有基于 MIPS 的 32 位处理器，但它们在音频/视频处理领域与 ARM 的竞争更大。奇怪的是，现代的往往比旧的便宜。可能它们是在具有更高产量的更现代的工艺中生产的。

另一个注意事项：与此同时，Microchip/PIC 收购了 Atmel/AVR，但我认为在最初几年不会对产品线产生太大影响。

我真的很期待今年夏天发布的支持 60MIPs 以太网的 16 位比特币（afaik streetprice 略高于 10 欧元）

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-27T22:07:49.983

我对微控制器的第一次体验是使用[OOPic-R](http://www.oopic.com/)。它让我可以进行简单的机器人实验，而不必过多担心代码。面向对象的编程流程使一切工作快速且易于编程。

最近，我尝试了另一种 PIC，非常便宜的[PICAXE](http://www.rev-ed.co.uk/picaxe/)。包含的编程接口是轻而易举的工作。此外，要物理连接 PICAXE，您只需要一个 RS-232 端口对其进行编程和芯片上的两个引脚（无需进行电平转换）。我已经将 PICAXE 嵌入到非常小的容器中（提供 SMD 和 DIP 芯片），并且效果很好。

我没有在组装中编程微控制器的经验。如果你想尝试一下，AVR 可能更合适，因为它的用户社区更大。

据我所知，使用 ATMEL 的工具对 AVR 进行编程的最便宜的方法是 ATMEL AVR ISP mkII，价格为 35 美元。你可以花 10-15 美元找到第三方程序员。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-12-03T08:47:20.423

如果你只是想知道什么是 MCU 编程，从 Arduino 开始是个好主意。它很便宜，具有对新手友好的 IDE（基于处理编程语言，其语法与 C 相似）。

但这并没有回答您的问题，因为尽管 Arduino 是基于 AVR 的，但您不会觉得现代 IDE 背后有 AVR MCU。:)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-04-06T16:14:16.840

当我刚刚开始时，我在 PIC 方面取得了更大的成功。我试图从 Arduino 获得一个简单的入门套件，但如果不花费超过 100-200 美元的镍和一起调暗设置，就无法获得一个好的基本套件。大约 40 美元从 PIC 购买了一个很棒的小型入门套件，它拥有一切：IDE、编程器、带有用于演示和教程的内置电路的入门板。一次购买。此外，PIC 环境很容易设置和工作。我在一个小时内玩了它。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-06-11T00:26:40.767

我会根据 C 交叉编译器的可用性做出选择。在过去，这将使 AVR 成为选择。我不知道现在是什么状态。

我已经用汇编程序编写了一个 PIC，但这并不好玩。C 在很多方面都更好。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-04T21:27:49.843

[http://www.arduino.cc/](http://www.arduino.cc/)

高温高压

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-05-03T13:33:03.807

AVR 的最佳功能之一是 www.avrfreaks.net 论坛中的社区。你会得到一群经验丰富的电子工程师，他们愿意帮助新手上路。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-07-30T15:40:37.147

我会说我发现 8051 微控制器是最简单的，Atmel 已经提出了具有如此多内置功能的微控制器……但人们仍然更喜欢使用 AVR……我的手会选择 8051 系列（如果觉得舒服）否则 AVR 的...

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-04-19T21:51:25.960

我喜欢 AVR。它易于编程和可用资源。很少有像 arduino 这样的社区可以使用它。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-05-18T13:58:38.180

关于 AVR 优越性的更多讨论，在另一个 Stack Overflow 上： [http ://embeddedgurus.com/stack-overflow/2009/04/pic-stack-overflow/](http://embeddedgurus.com/stack-overflow/2009/04/pic-stack-overflow/)

> 8 位 PIC 的流行让我感到困惑。它的架构很糟糕——有限的调用堆栈只是第一个可怕的东西。再加上对分页和存储的需求以及单个中断向量，您将面临编程模型的噩梦。如果这是 8 位设备的标准，那将是一回事——但事实并非如此。AVR 架构让 PIC 大吃一惊，而 HC05 / HC08 也领先于 PIC。考虑到选择，我认为我什至会在 PIC 上选择 8051。我没有看到任何成本优势、封装优势（Atmel 刚刚发布了 SOT23-6 AVR，它本质上是与其最大设备兼容的指令集）或外围设备优势。简而言之，我不明白！顺便，

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2008-09-26T15:08:40.357

我从摩托罗拉 M68HC11 开始，它很简单。我认为您将获得与任何 8 位控制器相同的体验。

# .net - 使用 InstallUtil 并静默设置 Windows 服务登录用户名/密码

> ID：140054
> 
> 赞同：51
> 
> 时间：2008-09-26T15:01:19.160
> 
> 标签：.net, windows-services, installation, windows-installer

我需要使用 InstallUtil 安装 C# windows 服务。我需要设置服务登录凭据（用户名和密码）。所有这些都需要默默地完成。

有没有办法做这样的事情：

```
installutil.exe myservice.exe /customarg1=username /customarg2=password 
```

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-05-19T08:54:30.247

比上面的帖子更简单且安装程序中没有额外代码的方法是使用以下内容：

> installUtil.exe /username=domain\username /password=password /unattended C:\My.exe

只要确保您使用的帐户是有效的。如果没有，您将收到“帐户名称和安全 ID 之间的映射未完成”异常

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-26T15:36:15.783

向我的同事（布鲁斯·埃迪）致敬。他找到了一种我们可以进行此命令行调用的方法：

```
installutil.exe /user=uname /password=pw myservice.exe 
```

它是通过覆盖安装程序类中的 OnBeforeInstall 来完成的：

```
namespace Test
{
    [RunInstaller(true)]
    public class TestInstaller : Installer
    {
        private ServiceInstaller serviceInstaller;
        private ServiceProcessInstaller serviceProcessInstaller;

        public OregonDatabaseWinServiceInstaller()
        {
            serviceInstaller = new ServiceInstaller();
            serviceInstaller.StartType = System.ServiceProcess.ServiceStartMode.Automatic;
            serviceInstaller.ServiceName = "Test";
            serviceInstaller.DisplayName = "Test Service";
            serviceInstaller.Description = "Test";
            serviceInstaller.StartType = ServiceStartMode.Automatic;
            Installers.Add(serviceInstaller);

            serviceProcessInstaller = new ServiceProcessInstaller();
            serviceProcessInstaller.Account = ServiceAccount.User; 
            Installers.Add(serviceProcessInstaller);
        }

        public string GetContextParameter(string key)
        {
            string sValue = "";
            try
            {
                sValue = this.Context.Parameters[key].ToString();
            }
            catch
            {
                sValue = "";
            }
            return sValue;
        }

        // Override the 'OnBeforeInstall' method.
        protected override void OnBeforeInstall(IDictionary savedState)
        {
            base.OnBeforeInstall(savedState);

            string username = GetContextParameter("user").Trim();
            string password = GetContextParameter("password").Trim();

            if (username != "")
                serviceProcessInstaller.Username = username;
            if (password != "")
                serviceProcessInstaller.Password = password;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-07-02T12:22:30.620

`InstallUtil.exe`设置 StartupType=Manual

如果要自动启动服务，请使用：

`sc config MyServiceName start= auto`

（注意'='后面必须有一个空格）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:05:58.757

不， installutil 不支持。

当然，如果您编写了安装程序；通过[自定义操作](http://arcanecode.wordpress.com/2007/05/23/windows-services-in-c-adding-the-installer-part-3/)，您将能够将其用作 MSI 的一部分或通过 installutil。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-10-23T14:31:37.910

**您还可以使用ServiceProcessInstaller::Account = ServiceAccount.User**强制您的服务以用户身份运行 ；

在服务安装过程中将出现一个询问“[域\]用户，密码”的弹出窗口。

```
public class MyServiceInstaller : Installer
{
    /// Public Constructor for WindowsServiceInstaller
    public MyServiceInstaller()
    {
        ServiceProcessInstaller serviceProcessInstaller = new ServiceProcessInstaller();
        ServiceInstaller serviceInstaller = new ServiceInstaller();

        //# Service Account Information
        serviceProcessInstaller.Account = ServiceAccount.User; // and not LocalSystem;
     .... 
```

# java - Java：处理大数据量的建议。（第二部分）

> ID：140056
> 
> 赞同：4
> 
> 时间：2008-09-26T15:01:30.047
> 
> 标签：java, performance, data-access

好的。所以我有大量的二进制数据（比如 10GB）分布在一堆不同长度的文件（比如 5000 个）上。

我正在编写一个 Java 应用程序来处理这些数据，并且我希望为数据访问制定一个好的设计。通常会发生这样的事情：

*   一种或另一种方式，在处理过程中将读取所有数据。
*   每个文件（通常）是按顺序读取的，一次只需要几千字节。但是，通常需要同时拥有每个文件的前几千字节，或者*同时拥有每个文件*的中间几千字节，等等。
*   有时应用程序需要随机访问一两个字节。

目前我正在使用 RandomAccessFile 类来读取字节缓冲区（和 ByteBuffers）。我的最终目标是将数据访问封装到某个类中，这样它就很快了，我再也不用担心它了。基本功能是我将要求它从指定文件中读取数据帧，并且考虑到上述考虑，我希望最小化 I/O 操作。

典型访问示例：

*   给我所有文件的前 10 KB！
*   给我文件 F 的字节 0 到 999，然后给我字节 1 到 1000，然后给我 2 到 1001，等等，等等……
*   给我从某个字节开始的文件 F 中的一兆字节数据！

有什么好的设计建议吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T15:10:43.113

使用 Java NIO 和 MappedByteBuffers，并将您的文件视为字节数组列表。然后，让操作系统担心缓存、读取、刷新等细节。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T18:39:17.857

@将要

相当不错的结果。读取大二进制文件快速比较：

*   测试 1 - 使用 RandomAccessFile 进行基本顺序读取。 **2656 毫秒**

*   测试 2 - 带缓冲的基本顺序读取。 **47 毫秒**

*   测试 3 - 使用 MappedByteBuffers 和进一步帧缓冲优化的基本顺序读取。 **16 毫秒**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T15:08:04.773

哇。您基本上是从头开始实现数据库。是否有可能将数据导入实际的 RDBMS 并仅使用 SQL？

如果你自己做，你最终会想要实现某种缓存机制，所以你需要的数据来自 RAM，如果它在那里，你正在读取和写入较低层的文件。

当然，这也需要大量复杂的事务逻辑来确保您的数据保持一致。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:23:21.047

我打算建议你跟进[Eric 的数据库理念](https://stackoverflow.com/questions/140056/java-advice-on-handling-large-data-volumes-part-deux#140099)，学习数据库如何管理它们的缓冲区——有效地实现它们自己的虚拟内存管理。

但是当我想得更多时，我得出的结论是，大多数操作系统在实现文件系统缓存方面已经比在 Java 中没有低级访问可能做得更好。

不过，您可能会考虑从数据库缓冲区管理中吸取的一个教训。数据库使用对查询计划的理解来优化管理策略。

在关系数据库中，通常最好从缓存中逐出最近使用的块。例如，在连接中包含子记录的“年轻”块将不会被再次查看，而包含其父记录的块仍在使用中，即使它是“旧”的。

另一方面，操作系统文件缓存经过优化以重用最近使用的数据（并提前读取最近使用的数据）。如果您的应用程序不符合该模式，则可能值得自己管理缓存。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T03:43:17.237

您可能想看看一个名为[jdbm](http://jdbm.sourceforge.net/)的开源简单对象数据库——它开发了很多此类东西，包括 ACID 功能。

我已经为该项目做出了许多贡献，如果没有别的，看看我们如何解决您可能正在处理的许多相同问题，这将是值得审查的源代码。

现在，如果您的数据文件不在您的控制之下（即您正在解析由其他人生成的文本文件等），那么 jdbm 使用的页面结构化存储类型可能不适合您 - 但如果所有这些文件是您正在创建和使用的文件，可能值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:11:12.847

@埃里克

但是我的查询将比我用 SQL 做的任何事情都要简单得多。数据库访问不会比读取二进制数据更昂贵吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T15:11:46.637

这是为了回答关于最小化 I/O 流量的部分。在 Java 方面，您真正能做的就是将您的阅读器包装在 BufferedReaders 中。除此之外，您的操作系统将处理其他优化，例如将最近读取的数据保存在页面缓存中，并对文件进行预读以加快顺序读取。在 Java 中进行额外的缓冲是没有意义的（尽管您仍然需要一个字节缓冲区来将数据返回给客户端）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-27T03:51:12.677

前几天我有人向我推荐了 hadoop ( [http://hadoop.apache.org](http://hadoop.apache.org) )。看起来它可能很不错，并且可能具有一定的市场吸引力。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-28T03:06:04.633

我会退后一步，问自己为什么使用文件作为记录系统，以及使用数据库能给你带来什么好处。数据库当然使您能够构建数据。鉴于 SQL 标准，从长远来看，它可能更易于维护。

另一方面，您的文件数据可能无法在数据库的约束下如此轻松地构建。世界上最大的搜索公司 :) 不使用数据库进行业务处理。见[这里](http://research.google.com/archive/bigtable.html)和[这里](http://labs.google.com/papers/mapreduce.html)。

# c++ - 何时使用动态库与静态库

> ID：140061
> 
> 赞同：473
> 
> 时间：2008-09-26T15:02:01.607
> 
> 标签：c++, dll, shared-libraries, static-linking, dynamic-linking

在 C++ 中创建类库时，您可以在动态 ( `.dll`, `.so`) 和静态 ( `.lib`, `.a`) 库之间进行选择。它们之间有什么区别，什么时候适合使用？

* * *

## 回答 #1

> 赞同：331
> 
> 时间：2008-09-26T15:08:14.663

静态库会增加二进制文件中代码的大小。它们总是被加载，并且您编译的任何版本的代码都是将运行的代码版本。

动态库是单独存储和版本化的。**如果**更新被认为与原始版本二进制兼容，那么加载的动态库版本可能不是您的代码随附的原始版本。

此外，动态库不一定要加载——它们通常在第一次调用时加载——并且可以在使用相同库的组件之间共享（多个数据加载，一个代码加载）。

大多数时候，动态库被认为是更好的方法，但最初它们有一个重大缺陷（谷歌 DLL 地狱），最近的 Windows 操作系统（尤其是 Windows XP）几乎消除了这个缺陷。

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2008-09-26T16:09:22.630

其他人已经充分解释了什么是静态库，但我想指出使用静态库的一些注意事项，至少在 Windows 上是这样：

*   **单例：**如果某些东西需要是全局/静态和唯一的，那么在将其放入静态库时要非常小心。如果多个 DLL 链接到该静态库，它们将各自获得自己的单例副本。但是，如果您的应用程序是没有自定义 DLL 的单个 EXE，则这可能不是问题。

*   **未引用的代码删除：**当您链接到静态库时，只有您的 DLL/EXE 引用的静态库部分才会链接到您的 DLL/EXE。

    例如，如果`mylib.lib`contains `a.obj`and`b.obj`并且您的 DLL/EXE 仅引用来自 的函数或变量`a.obj`，`b.obj`则链接器将丢弃整个 。如果`b.obj`包含全局/静态对象，它们的构造函数和析构函数将不会被执行。如果这些构造函数/析构函数有副作用，你可能会对它们的缺席感到失望。

    同样，如果静态库包含特殊入口点，您可能需要注意它们是否实际包含在内。嵌入式编程（好吧，不是 Windows）中的一个示例是标记为位于特定地址的中断处理程序。您还需要将中断处理程序标记为入口点，以确保它不会被丢弃。

    这样做的另一个后果是静态库可能包含由于未解析的引用而完全不可用的目标文件，但在您从这些目标文件中引用函数或变量之前，它不会导致链接器错误。这可能会在编写库后很久才发生。

*   **调试符号：**您可能希望每个静态库都有一个单独的 PDB，或者您可能希望将调试符号放置在目标文件中，以便将它们滚动到 DLL/EXE 的 PDB 中。Visual C++ 文档解释[了必要的选项](http://msdn.microsoft.com/en-us/library/958x11bc.aspx)。

*   **RTTI：**`type_info`如果将单个静态库链接到多个 DLL，则可能最终会为同一个类创建多个对象。如果您的程序假定这`type_info`是“单例”数据并使用`&typeid()`or `type_info::before()`，您可能会得到不希望的和令人惊讶的结果。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2008-09-26T15:13:25.197

lib 是捆绑在应用程序可执行文件中的代码单元。

dll 是可执行代码的独立单元。只有在调用该代码时才会在进程中加载​​它。一个 dll 可以被多个应用程序使用并在多个进程中加载​​，同时在硬盘驱动器上仍然只有一份代码副本。

**Dll 优点**：可用于在多个产品之间重用/共享代码；按需加载进程内存，不需要时可以卸载；可以独立于程序的其余部分进行升级。

**dll 缺点**：dll 加载和代码变基对性能的影响；版本控制问题（“dll 地狱”）

**Lib 优点**：没有性能影响，因为代码总是在进程中加载​​并且不会重新定位；没有版本问题。

**Lib cons**：可执行文件/进程“膨胀” - 所有代码都在您的可执行文件中，并在进程启动时加载；不重复使用/共享 - 每个产品都有自己的代码副本。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2014-08-08T17:44:31.583

C++ 程序分两个阶段构建

1.  编译 - 生成目标代码 (.obj)
2.  链接 - 生成可执行代码（.exe 或 .dll）

静态库 (.lib) 只是一组 .obj 文件，因此不是一个完整的程序。它还没有经历构建程序的第二（链接）阶段。另一方面，Dll 类似于 exe，因此是完整的程序。

如果您构建一个静态库，它还没有被链接，因此您的静态库的使用者将不得不使用您使用的相同编译器（如果您使用 g++，他们将不得不使用 g++）。

相反，如果您构建了一个 dll（并且[正确](http://www.codeproject.com/Articles/28969/HowTo-Export-C-classes-from-a-DLL)构建了它），那么您构建了一个所有消费者都可以使用的完整程序，无论他们使用的是哪个编译器。但是，如果需要交叉编译器兼容性，则从 dll 导出时有几个限制。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2009-10-16T19:19:25.687

除了静态库与动态库的技术含义（静态文件将所有内容捆绑在一个大二进制文件中与动态库允许在多个不同的可执行文件之间共享代码）之外，还有*法律含义*。

例如，如果您使用 LGPL 许可代码并且静态链接到 LGPL 库（并因此创建一个大二进制文件），您的代码将自动成为开源（[自由和自由）](http://oreilly.com/openbook/freedom/) LGPL 代码。如果您链接到共享对象，那么您只需要 LGPL 对 LGPL 库本身所做的改进/错误修复。

例如，如果您决定如何编译移动应用程序，这将成为一个更为重要的问题（在 Android 中，您可以选择静态与动态，而在 iOS 中则没有 - 它始终是静态的）。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-12-14T12:38:34.283

* * *

## 创建静态库

```
$$:~/static [32]> cat foo.c
#include<stdio.h>
void foo()
{
printf("\nhello world\n");
}
$$:~/static [33]> cat foo.h
#ifndef _H_FOO_H
#define _H_FOO_H

void foo();

#endif
$$:~/static [34]> cat foo2.c
#include<stdio.h>
void foo2()
{
printf("\nworld\n");
}
$$:~/static [35]> cat foo2.h
#ifndef _H_FOO2_H
#define _H_FOO2_H

void foo2();

#endif
$$:~/static [36]> cat hello.c
#include<foo.h>
#include<foo2.h>
void main()
{
foo();
foo2();
}
$$:~/static [37]> cat makefile
hello: hello.o libtest.a
        cc -o hello hello.o -L. -ltest
hello.o: hello.c
        cc -c hello.c -I`pwd`
libtest.a:foo.o foo2.o
        ar cr libtest.a foo.o foo2.o
foo.o:foo.c
        cc -c foo.c
foo2.o:foo.c
        cc -c foo2.c
clean:
        rm -f foo.o foo2.o libtest.a hello.o

$$:~/static [38]> 
```

* * *

## 创建动态库

```
$$:~/dynamic [44]> cat foo.c
#include<stdio.h>
void foo()
{
printf("\nhello world\n");
}
$$:~/dynamic [45]> cat foo.h
#ifndef _H_FOO_H
#define _H_FOO_H

void foo();

#endif
$$:~/dynamic [46]> cat foo2.c
#include<stdio.h>
void foo2()
{
printf("\nworld\n");
}
$$:~/dynamic [47]> cat foo2.h
#ifndef _H_FOO2_H
#define _H_FOO2_H

void foo2();

#endif
$$:~/dynamic [48]> cat hello.c
#include<foo.h>
#include<foo2.h>
void main()
{
foo();
foo2();
}
$$:~/dynamic [49]> cat makefile
hello:hello.o libtest.sl
        cc -o hello hello.o -L`pwd` -ltest
hello.o:
        cc -c -b hello.c -I`pwd`
libtest.sl:foo.o foo2.o
        cc -G -b -o libtest.sl foo.o foo2.o
foo.o:foo.c
        cc -c -b foo.c
foo2.o:foo.c
        cc -c -b foo2.c
clean:
        rm -f libtest.sl foo.o foo

2.o hello.o
$$:~/dynamic [50]> 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-09-26T15:05:56.073

静态库被编译到客户端中。.lib 在编译时使用，库的内容成为消费可执行文件的一部分。

动态库在运行时加载，而不是编译到客户端可执行文件中。动态库更加灵活，因为多个客户端可执行文件可以加载 DLL 并利用其功能。这也将客户端代码的整体大小和可维护性保持在最低限度。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2008-09-26T15:20:25.213

您应该仔细考虑随时间的变化、版本控制、稳定性、兼容性等。

如果有两个应用程序使用共享代码，您是否要强制这些应用程序一起更改，以防它们需要相互兼容？然后使用dll。所有的 exe 都将使用相同的代码。

或者您是否想将它们彼此隔离，以便您可以更改其中一个并确信您没有破坏另一个。然后使用静态库。

DLL 地狱是您可能应该使用静态库，但您使用的是 dll，并且并非所有 exe 都兼容它。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-09-26T15:08:20.047

静态库必须链接到最终的可执行文件；它成为可执行文件的一部分，并随处可见。每次执行可执行文件时都会加载一个动态库，并作为 DLL 文件与可执行文件分开。

当您希望能够更改库提供的功能而不必重新链接可执行文件（只需替换 DLL 文件，而不必替换可执行文件）时，您将使用 DLL。

只要您没有理由使用动态库，您就会使用静态库。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-05-11T22:44:13.697

Ulrich Drepper 关于“[如何编写共享库](http://people.redhat.com/drepper/dsohowto.pdf)”的论文也是很好的资源，详细介绍了如何最好地利用共享库，或者他所说的“动态共享对象”(DSO)。它更多地关注[ELF](http://en.wikipedia.org/wiki/Executable_and_Linkable_Format)二进制格式的共享库，但一些讨论也适用于 Windows DLL。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-26T16:17:27.477

有关该主题的精彩讨论，请阅读Sun的[这篇文章。](http://sunsite.uakom.sk/sunworldonline/swol-02-1996/swol-02-perf.html)

它涉及所有好处，包括能够插入插入库。更多关于设置的细节可以在[这篇文章](http://www.itworld.com/UIR000929interposers)中找到。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-26T16:01:58.250

确实，您（在大型项目中）所做的权衡是在初始加载时间，库将在某个时间或另一个时间链接，必须做出的决定是链接是否需要足够长的时间以使编译器需要咬紧牙关提前做，或者动态链接器可以在加载时做。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-26T15:05:21.693

如果您的库将在多个可执行文件之间共享，则将其动态化以减小可执行文件的大小通常是有意义的。否则，一定要把它变成静态的。

使用 dll 有几个缺点。加载和卸载它有额外的开销。还有一个额外的依赖。如果您更改 dll 以使其与您的可执行文件不兼容，它们将停止工作。另一方面，如果您更改静态库，则使用旧版本编译的可执行文件不会受到影响。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-26T15:11:12.833

如果库是静态的，那么在链接时代码将与您的可执行文件链接。这使您的可执行文件更大（比您走动态路线时）。

如果库是动态的，那么在链接时对所需方法的引用将内置到您的可执行文件中。这意味着您必须交付可执行文件和动态库。您还应该考虑对库中代码的共享访问是否安全，是否是首选加载地址等。

如果您可以使用静态库，请使用静态库。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-10-02T08:22:10.640

我们在项目中使用了很多 DLL (> 100)。这些 DLL 相互依赖，因此我们选择了动态链接的设置。但是它有以下缺点：

*   启动缓慢（> 10 秒）
*   DLL 必须进行版本控制，因为 Windows 会根据名称的唯一性加载模块。否则自己编写的组件会得到错误的 DLL 版本（即已经加载的那个，而不是它自己的分布式集）
*   优化器只能在 DLL 边界内进行优化。例如，优化器尝试将经常使用的数据和代码并排放置，但这不适用于跨 DLL 边界

也许更好的设置是将**所有内容都**设为静态库（因此您只有一个可执行文件）。这仅在没有代码重复发生时才有效。一个测试似乎支持这个假设，但我找不到官方的 MSDN 报价。因此，例如使用以下命令制作 1 个 exe：

*   exe 使用 shared_lib1、shared_lib2
*   shared_lib1 使用 shared_lib2
*   shared_lib2

shared_lib2 的代码和变量应该只出现在最终合并的可执行文件中一次。有人可以支持这个问题吗？

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-26T15:08:22.357

静态库是包含库的目标代码的档案，当链接到应用程序时，该代码被编译成可执行文件。共享库的不同之处在于它们不会编译到可执行文件中。相反，动态链接器搜索一些目录以查找它需要的库，然后将其加载到内存中。多个可执行文件可以同时使用同一个共享库，从而减少内存使用和可执行文件大小。但是，还有更多文件要与可执行文件一起分发。您需要确保将库安装到链接器可以找到它的使用系统上，静态链接消除了这个问题，但会导致更大的可执行文件。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-26T15:16:56.500

如果您在嵌入式项目或专用平台上工作，静态库是唯一的出路，那么很多时候将它们编译到您的应用程序中也不会那么麻烦。还拥有包含所有内容的项目和生成文件会使生活更快乐。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-10-02T08:34:05.067

我会给出一个一般的经验法则，如果你有一个大型代码库，所有代码库都构建在较低级别的库（例如 Utils 或 Gui 框架）之上，你希望将其划分为更易于管理的库，然后将它们设为静态库。动态库并没有真正为你买任何东西，而且惊喜也更少——例如，只有一个单例实例。

如果您有一个与代码库的其余部分完全分离的库（例如第三方库），请考虑将其设为 dll。如果库是 LGPL，由于许可条件，您可能仍需要使用 dll。

# svn - Subversion 存储库应该在哪里？

> ID：140090
> 
> 赞同：11
> 
> 时间：2008-09-26T15:06:55.730
> 
> 标签：svn, version-control

它应该在开发服务器还是 Subversion 服务器上？

我想这可以扩展到任何客户端-服务器版本控制系统。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T15:09:10.967

物理存储库应位于可定期备份的稳定系统上。

通常，开发服务器不符合此描述...将 apache 服务器放在开发服务器上并将文件远程托管在稳定的备份文件服务器上可能是可以接受的（尽管这样做存在许多陷阱方法）如果您无法获得额外的服务器资源。如果您有一个积极的备份系统来保护您的代码，那么将它托管在开发服务器上可能会很好......

请记住，开发服务器很容易发生配置更改、被吹走或以其他方式被弄脏，这可能会在关键时刻取消您的 repo。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:10:41.633

我喜欢将我的服务器保存在自己的服务器上，只是因为在我看来，它是组织中最重要的服务器之一，并且将其保存在自己的服务器上有助于管理员进行备份和其他维护活动。而且由于服务器*非常*重要，您不希望其他开发人员以任何可能意外损害它的方式对其进行处理。

此外，如果您有一群开发人员和一个活动的持续集成服务器正在运行，您实际上可能会大幅增加 CPU，而您要做的最后一件事就是有任何阻碍您提交代码更改的事情

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T15:15:32.510

除了其他人提到的开发服务器经常被破坏之外，还有一个性能参数。如果有人在开发服务器上进行一些开发或测试，您不希望这会减慢 SVN 服务器的检出或同步速度。此外，如果您决定在同一台服务器上运行诸如持续集成之类的东西，您不希望所有的单元测试都让该服务器上的常规开发/测试操作陷入困境。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T15:09:15.193

我将我的开发服务器保存在开发服务器上，该服务器还运行 Trac、托管项目 JavaDocs 的自动更新副本的 Apache 和 CI 构建平台。一个项目必须具有相当大的规模才能需要专用的 Subversion 服务器。

但是，请记住，将您的 Subversion 存储库备份到另一个位置的另一台计算机上是非常重要的 - 您的存储库是您最宝贵的资产！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:12:01.753

根据定义，开发箱会被扔掉并摔倒。它带有领土！

您真的希望这种情况发生在您的源代码存储库中吗？...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T15:20:47.943

在我的公司，我们将它放在提供冗余存储的专用机器上。我想在我们的文化中，我们非常重视源代码以及创建源代码所需的时间和精力。我们从来没有安装任何可能因为配置变得无法管理而损坏或擦干净的测试机器。

哎呀。我们还将缺陷跟踪保持在同一个盒子上，但出于同样的原因。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T15:26:54.917

我们为我们的存储库使用干净、空白的石板。具体来说，我们使用[Slicehost](http://www.slicehost.com/)作为我们的主存储库。

我们从 256MB 切片开始，后来升级到 512MB。Slicehost 很棒，因为你知道你有一个完全干净的服务器，并且可以自己构建你需要的东西。

[Slicehosts 的文章](http://articles.slicehost.com/)是一流的。

我们的 repo 服务器如下所示：

*   [Ubuntu 哈迪苍鹭](http://articles.slicehost.com/ubuntu-hardy)
*   [颠覆](http://articles.slicehost.com/tags/subversion)
*   [阿帕奇](http://articles.slicehost.com/tags/apache)
*   [Ruby on Rails](http://articles.slicehost.com/2008/4/30/ubuntu-hardy-ruby-on-rails)
*   [仓库](http://warehouseapp.com)
*   [乘客](http://articles.slicehost.com/2008/5/1/ubuntu-hardy-mod_rails-installation)通过 Apache 为仓库服务
*   通过 Slicehost 进行每日和每周备份

就是这样。开销不大。

编辑：不要试图在这里出售 Slicehost，所以如果这不符合犹太教规，请告诉我！

再次编辑：James 提出了一个很好的观点，即在第三方服务器上托管专有代码。在选择主机来做这样的事情时，当然应该格外小心。不幸的是，许多公司根本没有资源在内部构建和管理服务器，这是我们在为代码选择主机之前发现自己的地方。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-05-18T06:54:11.663

最好将存储库保存在稳定的服务器上，以便在需要时可靠地进行备份。

# model-view-controller - MVC-ARS 是否比经典 MVC 更可取以防止过载？

> ID：140098
> 
> 赞同：3
> 
> 时间：2008-09-26T15:07:59.330
> 
> 标签：model-view-controller, design-patterns

流行的设计模式 MVC（模型/视图/控制器）有一个扩展的表亲 MVC-ARS（动作/表示/状态）。添加的组件都存在于数据库层中，虽然不是模型的一部分，但它们被它调用。详情如下：

1.  状态，就像在状态机中一样。这遵循经典的状态机模式。存在与导致继续或停止条件以及可能状态更改的事件匹配的当前状态。

2.  行动，就像所有信息技术系统的目标一样，对数据采取行动。这意味着我们的事务，即数据库中数据的 CRUD（创建/读取/更新/删除）。这可能已被状态机阻止。

3.  表示，例如我们发回的将成为模型的数据。数据模型和 MVC 模型可能非常不同，例如关系与 XML 层次结构。如果它是明确的和被理解的，那没有错。这就是代表。

这个扩展不是通过分离状态控制、事务控制和数据快照来防止模型或控制器的过载吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-16T11:10:24.367

永远不要低估开发人员将您认为已实施的任何保护措施都混为一谈的能力。虽然这些增加的分离可以提供额外的保护，但它们是否更容易开发？它们是否使分离易于理解和使用？如果没有，开发人员不太可能将它们纳入他们的实践。

开发人员倾向于朝着阻力最小的方向努力。

# c# - 如何从 WCF REST 方法返回自定义 HTTP 状态代码？

> ID：140104
> 
> 赞同：89
> 
> 时间：2008-09-26T15:08:27.287
> 
> 标签：c#, .net, wcf, rest

如果 WCF REST 调用中出现问题，例如未找到请求的资源，我如何在 OperationContract 方法中使用 HTTP 响应代码（例如，将其设置为 HTTP 404 之类的内容）？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-09-26T15:16:29.730

有一个[`WebOperationContext`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.weboperationcontext.aspx)你可以访问的，它有一个[`OutgoingResponse`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.weboperationcontext.outgoingresponse.aspx)类型的属性，[`OutgoingWebResponseContext`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.outgoingwebresponsecontext.aspx)它有一个[`StatusCode`](http://msdn.microsoft.com/en-us/library/system.servicemodel.web.outgoingwebresponsecontext.statuscode.aspx)可以设置的属性。

```
WebOperationContext ctx = WebOperationContext.Current;
ctx.OutgoingResponse.StatusCode = System.Net.HttpStatusCode.OK; 
```

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2010-11-24T11:44:27.813

如果您需要返回原因正文，请查看[WebFaultException](http://msdn.microsoft.com/en-us/library/dd989924.aspx)

例如

```
throw new WebFaultException<string>("Bar wasn't Foo'd", HttpStatusCode.BadRequest ); 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-26T16:54:10.323

**对于 404， WebOperationContext.Current.OutgoingResponse**上有一个名为**SetStatusAsNotFound(string message)**的内置方法，该方法将状态代码设置为 404，并通过一次调用设置状态描述。

请注意，还有**SetStatusAsCreated(Uri location)**将通过一次调用将状态代码设置为 201 和位置标头。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-05-24T09:16:43.020

You can also return a statuscode and reason body with [WebOperationContext](https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.web.weboperationcontext?view=netframework-4.7.2)'s [StatusCode](https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.web.outgoingwebresponsecontext.statuscode?view=netframework-4.7.2) and [StatusDescription](https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.web.outgoingwebresponsecontext.statusdescription?view=netframework-4.7.2):

```
WebOperationContext context = WebOperationContext.Current;
context.OutgoingResponse.StatusCode = HttpStatusCode.OK;
context.OutgoingResponse.StatusDescription = "Your Message"; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-18T15:51:31.663

如果您希望在标头中查看状态描述，REST 方法应确保从 Catch() 部分返回 null，如下所示：

```
catch (ArgumentException ex)
{
    WebOperationContext.Current.OutgoingResponse.StatusCode = HttpStatusCode.InternalServerError;
    WebOperationContext.Current.OutgoingResponse.StatusDescription = ex.Message;
    return null;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-17T07:53:52.063

```
WebOperationContext.Current.OutgoingResponse.StatusCode = HttpStatusCode.Unauthorized;
throw new WebException("令牌码不正确", new InvalidTokenException()); 
```

参考：[https ://social.msdn.microsoft.com/Forums/en-US/f6671de3-34ce-4b70-9a77-39ecf5d1b9c3/weboperationcontext-http-statuses-and-exceptions?forum=wcf](https://social.msdn.microsoft.com/Forums/en-US/f6671de3-34ce-4b70-9a77-39ecf5d1b9c3/weboperationcontext-http-statuses-and-exceptions?forum=wcf)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-04T16:17:05.630

对于 WCF 数据服务，这对我不起作用。相反，您可以在数据服务的情况下使用 DataServiceException。发现以下帖子很有用。 [http://social.msdn.microsoft.com/Forums/en/adodotnetdataservices/thread/f0cbab98-fcd7-4248-af81-5f74b019d8de](http://social.msdn.microsoft.com/Forums/en/adodotnetdataservices/thread/f0cbab98-fcd7-4248-af81-5f74b019d8de)

# java - 在 Windows 中发送任意信号？

> ID：140111
> 
> 赞同：35
> 
> 时间：2008-09-26T15:09:23.727
> 
> 标签：java, windows, utilities

Linux 支持使用 -Command 向进程发送任意 Posix 信号，例如`SIGINT`或。虽然并且只是以友好或不那么友好的方式结束进程的无聊旧方法，但旨在触发核心转储。这可用于触发正在运行的 Java VM 打印出线程转储，包括所有正在运行的线程的堆栈跟踪——太棒了！打印调试信息后，Java VM 将继续执行之前的操作；事实上，线程转储只是发生在另一个具有最高优先级的衍生线程中。（您可以使用 自己尝试一下。）`SIGTERM``kill``SIGINT``SIGTERM``SIGQUIT``kill -3 <VM-PID>`

`Signal`请注意，您还可以使用 -package 中的（不支持！）和`SignalHandler`类来注册自己的信号处理程序`sun.misc`，因此您可以从中获得各种乐趣。

*但是，我还没有找到向 Windows 进程发送信号的方法。*信号由某些用户输入创建：例如，在两个平台上`Ctrl-C`触发。`SIGINT`但似乎没有任何实用程序可以手动向 Windows 上正在运行但非交互式进程发送信号。显而易见的解决方案是使用 Cygwin`kill`可执行文件，但是虽然它可以使用适当的 Windows API 结束 Windows 进程，但我无法使用它发送`SIGBREAK`（相当于 Windows 的`SIGQUIT`）；事实上，我认为它能够发送到 Windows 进程的唯一信号是`SIGTERM`.

因此，长话短说并重复标题：如何向 Windows 中的进程发送任意信号？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T15:58:44.030

如果您想要显式/以编程方式杀死任何类型的另一个程序/进程，那么在 SysInternals 的 pstools 中有一个名为“pskill”的小工具，其行为就像 Unixen“kill”一样。

如果您想要其他内容，请继续阅读（尽管我可能对以下某些细节有误 - 自从我上次仅使用 WinAPI 和 Charles Petzold 的优秀书籍“Programming for Windows”作为指南用 C 语言开发 Windows 程序以来，已经有好多年了）。

在 Windows 上，您没有适当的“信号”，WinMain 和 WinProc 从操作系统接收的功能是简单的*消息*。例如，当您单击窗口的“X”按钮时，Windows 会向该窗口的处理程序发送消息 WM_CLOSE。当窗口被删除但程序仍在运行时，它会发送 WM_DESTROY。当它即将退出主消息处理循环时，WinMain（不是 WinProc）收到 WM_QUIT。您的程序应该按预期响应所有这些 - 您实际上可以通过在收到 WM_CLOSE 时不做它应该做的事情来开发一个“不可关闭”的应用程序。

当用户从 Windows 任务管理器中选择任务并单击“结束任务”时，操作系统将发送 WM_CLOSE（另一个我不记得了）。但是，如果您使用“结束进程”，该进程会直接被终止，不会发送任何消息（来源：[The Old New Thing](http://blogs.msdn.com/b/oldnewthing/archive/2004/07/22/191123.aspx)

我记得有一种方法可以获取另一个进程窗口的 HWND，一旦你知道另一个进程可以通过函数 PostMessage 和 DispatchMessage 向该窗口发送消息。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-26T15:20:44.277

Windows 不是 POSIX。它没有信号。控制台程序获得的唯一“信号”是调用`SetConsoleCtrlHandler`，在这种情况下，可以通知用户已按下 Ctrl+C、Ctrl+Break、关闭控制台窗口、注销或关闭系统。

其他一切都使用 IPC 完成，通常使用窗口消息或 RPC。查看 Sun 的文档，看看是否有办法在 Windows JRE 上执行您所要求的操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T15:29:24.630

在 Windows 中，一切都围绕着 Win32 消息。我不相信有一个命令行工具可以做到这一点，但在 C++ 中，您可以使用[FindWindow](http://msdn.microsoft.com/en-us/library/ms633499.aspx)将任意消息发送到另一个 Windows 程序。例如：

```
#define WM_MYMSG  ( WM_USER+0x100 )
HWND h = ::FindWindow(NULL,_T("Win32App"));
if (h) {
    ::PostMessage(h, WM_MYMSG, 0, 0);
} 
```

这也可以使用 com interop 在 C# 中完成。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-10-02T05:45:18.553

SIGINT 和其他信号可以通过[windows-kill](https://github.com/alirdn/windows-kill/releases)发送到程序，通过语法`windows-kill -SIGINT PID`，`PID`可以通过微软的[pslist](https://download.sysinternals.com/files/PSTools.zip)获得。

关于捕获 SIGINT，如果您的程序使用 Python，那么您可以像在[此解决方案](https://stackoverflow.com/a/31464349/941531)中那样实现 SIGINT 处理/捕获。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:14:33.573

您还可以使用 jconsole 查看所有正在运行的线程的堆栈跟踪。这将适用于 Windows 和任何其他支持 Java 的操作系统。jconsole 还有很多其他不错的特性，内存图，cpu 图等。

它没有回答您最初的问题，但希望可以让您获得相同的结果。

如果您不熟悉 jconsole，请查看[使用 JConsole](http://java.sun.com/javase/6/docs/technotes/guides/management/jconsole.html)文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:15:25.413

我只是想知道现在 Microsoft 拥有的[SysInternals的](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx)[PsTools](http://technet.microsoft.com/en-us/sysinternals/default.aspx)是否会对您有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-15T16:29:21.407

Ruby 以某种方式能够（至少模拟）Windows 上的 SIGINT SIGKILL 等，并捕获这些消息。可能想检查一下。

在 Windows 中，ruby 如何“向该进程发送信号 SIGINT”实际上是`TerminateProcess`在该 PID 上调用或等效。

还有一种用于“捕获 ctrl+c”的 Windows 等效方法，我想这就是它在那里所说的。

# java - 使用 https 协议使用 Webservice

> ID：140113
> 
> 赞同：1
> 
> 时间：2008-09-26T15:09:42.413
> 
> 标签：java, web-services, https

我想从 Java 客户端通过 https 使用 Web 服务。为了做到这一点，我需要采取哪些步骤？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T15:14:45.693

实际上，与通过 HTTP 使用 Web 服务应该没有太大区别。最重要的是调用 Web 服务的进程必须信任服务器的 SSL 证书。如果证书是从知名的证书颁发机构购买的，这通常不是问题。否则，客户端将希望信任根证书或与服务器的完全限定主机名关联的证书。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T18:11:33.113

您可能需要使用[keytool](http://http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/keytool.html)命令来信任服务器的 SSL 证书。我通常发现有必要运行这样的东西：

```
keytool -importcert -v -trustcacerts -alias ServerName -file server_cert_file.crt -keystore client_keystore_file 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:26:59.707

布莱尔说得对。同样，使用 SoapUI 尝试一下，它是一个 Web 服务测试客户端。这是一个开源实用程序：因此您有机会了解事情是如何在幕后工作的。

# c# - 在 C# 中读取隐藏共享

> ID：140115
> 
> 赞同：7
> 
> 时间：2008-09-26T15:09:49.623
> 
> 标签：c#, impersonation, fileshare

所以我有一个小型 C# 应用程序，它需要定期检查网络上多台机器上的目录内容。我以为我可以将 \hostname\C$ 读取为目录路径，但是对于普通的 Directory 类，似乎没有办法对其他服务器进行身份验证，因此您可以访问隐藏共享。我确信有一种简单的方法可以做到这一点，但我忽略了这一点，但目前我有点难过。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T15:13:25.603

来自[http://bytes.com/forum/thread689145.html](http://bytes.com/forum/thread689145.html)：

> 所有进程都在登录用户帐户的上下文中运行。如果您想在另一台计算机上打开文件，您的应用程序必须在有权在该计算机上打开文件的用户的上下文中运行。您可以使用模拟来做到这一点。

最简单的方法似乎是赋予当前用户在其他机器上的适当权限。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:43:48.090

要使用运行该进程的用户无权访问的共享进行身份验证（管理共享通常是这种情况），请尝试运行 net use 命令：

```
net use SERVERNAME\IPC$ /user:USERNAME PASSWORD 
```

尝试在实际尝试访问共享的代码之前在单独的进程中运行它，例如：

```
ProcessStartInfo psi = new ProcessStartInfo(
    "net", "use " + SERVERNAME + @"\IPC$ /user:" + USERNAME + " " + PASSWORD);
Process p = new Process();
p.StartInfo = psi;
p.Start();
p.WaitForExit();
p.Close();
// The code to access the share follows... 
```

如果不适合为运行进程的用户帐户授予共享权限，例如对于最终用户应用程序需要访问用户自己不应直接访问的共享上的数据的安全模型，这将很有用.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:16:39.933

您是否正在寻找一种在运行时设置当前用户的方法？

如果没有，只要运行该进程的用户有权访问这些机器，这将对您有用：

```
DirectoryInfo di = new DirectoryInfo(@"\\machineName\c$\temp");

FileInfo[] files = di.GetFiles();

foreach (FileInfo f in files)
{
    Debug.WriteLine(f.Name);
} 
```

# winapi - 驱动器上剩余的可用空间 - WinAPI - Windows CE

> ID：140117
> 
> 赞同：2
> 
> 时间：2008-09-26T15:10:32.913
> 
> 标签：winapi, pinvoke, windows-ce, diskspace

我忘记了 WinAPI 调用来找出特定驱动器上剩余多少空间，而 pinvoke.net 并没有给我任何爱。顺便说一句，它是一个紧凑的框架，所以我认为 coredll.dll。

有更好记忆的人可以慢跑我的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T15:16:41.697

[GetDiskFreeSpaceEx](http://www.pinvoke.net/default.aspx/kernel32/GetDiskFreeSpaceEx.html)。链接到 pinvoke.net 的桌面页面；只需替换`kernel32`为`coredll`.

不幸`System.IO.DriveInfo`的是，紧凑框架上不存在。它不太适合 Windows CE 的 Unix 风格的单根树。

# java - 从 Java 客户端调用 Web 服务

> ID：140127
> 
> 赞同：1
> 
> 时间：2008-09-26T15:12:17.417
> 
> 标签：java, web-services, containers

我有一个在 Tomcat 中运行的简单 Web 应用程序。我需要从此 Web 应用程序调用 Web 服务，但我不知道该怎么做。根据您使用的是托管环境还是非托管环境，似乎有两种方法：

JNDI 服务查找（托管）

和

JAX-RPC ServiceFactory（非托管）

...那么我应该使用哪种技术？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T15:41:18.830

You don't have to necessarily use those techniques. Assuming you're using Axis as the web services engine and ant as the build tool([http://ws.apache.org/axis/java/user-guide.html](http://ws.apache.org/axis/java/user-guide.html)), you need to do the following

1) generate the proxy/stub for invoking the web services. This will give you an entry point into calling the webservices
2) provide configuration info for the client -- a .wsdd file
3) know where the WSDL for your webservices is.

BR,
~a

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-26T15:23:45.440

如果它是一个网络服务，为什么不使用 apache 的[httpclient](http://hc.apache.org/httpclient-3.x/)呢？

# java - 使用Java将十六进制转储的字符串表示形式转换为字节数组？

> ID：140131
> 
> 赞同：417
> 
> 时间：2008-09-26T15:12:45.573
> 
> 标签：java, byte, hex, dump

我正在寻找一种将表示十六进制值的长字符串（来自转储）转换为字节数组的方法。

我不能比在[这里发布相同问题](http://www.experts-exchange.com/Programming/Programming_Languages/Java/Q_21062554.html)的人更好地表达它。

但为了保持原创，我会用我自己的方式表达它：假设我有一个字符串`"00A0BF"`，我想将其解释为

```
byte[] {0x00,0xA0,0xBf} 
```

我该怎么办？

我是一名 Java 新手，最终使用`BigInteger`并注意前导十六进制零。但我认为它很丑，我确信我错过了一些简单的东西。

* * *

## 回答 #1

> 赞同：698
> 
> 时间：2008-09-26T17:38:37.017

更新 (2021) - **Java 17**现在包括[`java.util.HexFormat`](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/HexFormat.html)（仅用了 25 年）：

`HexFormat.of().parseHex(s)`

* * *

对于旧版本的 Java：

这是我认为比迄今为止发布的任何解决方案都更好的解决方案：

```
/* s must be an even-length string. */
public static byte[] hexStringToByteArray(String s) {
    int len = s.length();
    byte[] data = new byte[len / 2];
    for (int i = 0; i < len; i += 2) {
        data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4)
                             + Character.digit(s.charAt(i+1), 16));
    }
    return data;
} 
```

改进的原因：

*   使用前导零（与 BigInteger 不同）和负字节值（与 Byte.parseByte 不同）是安全的

*   不将 String 转换为 a `char[]`，或为每个字节创建 StringBuilder 和 String 对象。

*   没有可能不可用的库依赖项

`assert`如果不知道参数是否安全，请随意添加参数检查或异常。

* * *

## 回答 #2

> 赞同：343
> 
> 时间：2011-05-09T21:53:32.977

**单线：**

```
import javax.xml.bind.DatatypeConverter;

public static String toHexString(byte[] array) {
    return DatatypeConverter.printHexBinary(array);
}

public static byte[] toByteArray(String s) {
    return DatatypeConverter.parseHexBinary(s);
} 
```

**警告**：

*   在 Java 9 Jigsaw 中，这不再是（默认） java.se 根集的一部分，因此除非您指定 --add-modules java.se.ee ，否则它将导致 ClassNotFoundException （感谢 @ `eckes`）
*   在 Android 上不可用（感谢`Fabian`您注意到这一点），但如果您的系统由于某种原因缺少源代码，您可以[获取源代码。](https://stackoverflow.com/a/11139098/173677)`javax.xml`感谢@`Bert Regelink`提取源代码。

* * *

## 回答 #3

> 赞同：100
> 
> 时间：2008-09-26T15:15:19.517

commons-codec 中的 Hex 类应该为你做这件事。

[http://commons.apache.org/codec/](http://commons.apache.org/codec/)

```
import org.apache.commons.codec.binary.Hex;
...
byte[] decoded = Hex.decodeHex("00A0BF");
// 0x00 0xA0 0xBF 
```

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2013-03-27T10:18:56.813

您现在可以使用[BaseEncoding](https://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/io/BaseEncoding.html)来`guava`完成此操作。

```
BaseEncoding.base16().decode(string); 
```

要反转它，请使用

```
BaseEncoding.base16().encode(bytes); 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2008-09-26T16:37:40.143

实际上，我认为 BigInteger 的解决方案非常好：

```
new BigInteger("00A0BF", 16).toByteArray(); 
```

编辑：如海报所述**，前导零不安全。**

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2012-06-21T13:19:35.963

> **单线：**
> 
> ```
> import javax.xml.bind.DatatypeConverter;
> 
> public static String toHexString(byte[] array) {
>     return DatatypeConverter.printHexBinary(array);
> }
> 
> public static byte[] toByteArray(String s) {
>     return DatatypeConverter.parseHexBinary(s);
> } 
> ```

对于那些对[FractalizeR的](https://stackoverflow.com/users/173677/fractalizer)**One-liners**背后的实际代码感兴趣的人（我需要它，因为 javax.xml.bind 不适用于 Android（默认情况下）），这来自[com.sun.xml.internal.bind。数据类型转换器Impl.java](http://www.docjar.com/html/api/com/sun/xml/internal/bind/DatatypeConverterImpl.java.html)：

```
public byte[] parseHexBinary(String s) {
    final int len = s.length();

    // "111" is not a valid hex encoding.
    if( len%2 != 0 )
        throw new IllegalArgumentException("hexBinary needs to be even-length: "+s);

    byte[] out = new byte[len/2];

    for( int i=0; i<len; i+=2 ) {
        int h = hexToBin(s.charAt(i  ));
        int l = hexToBin(s.charAt(i+1));
        if( h==-1 || l==-1 )
            throw new IllegalArgumentException("contains illegal character for hexBinary: "+s);

        out[i/2] = (byte)(h*16+l);
    }

    return out;
}

private static int hexToBin( char ch ) {
    if( '0'<=ch && ch<='9' )    return ch-'0';
    if( 'A'<=ch && ch<='F' )    return ch-'A'+10;
    if( 'a'<=ch && ch<='f' )    return ch-'a'+10;
    return -1;
}

private static final char[] hexCode = "0123456789ABCDEF".toCharArray();

public String printHexBinary(byte[] data) {
    StringBuilder r = new StringBuilder(data.length*2);
    for ( byte b : data) {
        r.append(hexCode[(b >> 4) & 0xF]);
        r.append(hexCode[(b & 0xF)]);
    }
    return r.toString();
} 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2011-01-03T17:06:24.137

提供了在和`HexBinaryAdapter`之间编组和解组的能力。`String``byte[]`

```
import javax.xml.bind.annotation.adapters.HexBinaryAdapter;

public byte[] hexToBytes(String hexString) {
     HexBinaryAdapter adapter = new HexBinaryAdapter();
     byte[] bytes = adapter.unmarshal(hexString);
     return bytes;
} 
```

这只是我输入的一个示例......我实际上只是按原样使用它，不需要单独使用它的方法。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-09-26T16:06:58.220

这是一种实际有效的方法（基于之前的几个半正确答案）：

```
private static byte[] fromHexString(final String encoded) {
    if ((encoded.length() % 2) != 0)
        throw new IllegalArgumentException("Input string must contain an even number of characters");

    final byte result[] = new byte[encoded.length()/2];
    final char enc[] = encoded.toCharArray();
    for (int i = 0; i < enc.length; i += 2) {
        StringBuilder curr = new StringBuilder(2);
        curr.append(enc[i]).append(enc[i + 1]);
        result[i/2] = (byte) Integer.parseInt(curr.toString(), 16);
    }
    return result;
} 
```

我能看到的唯一可能的问题是输入字符串是否非常长；调用 toCharArray() 会复制字符串的内部数组。

编辑：哦，顺便说一下，字节是用 Java 签名的，所以你的输入字符串转换为 [0, -96, -65] 而不是 [0, 160, 191]。但你可能已经知道了。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2015-11-04T13:25:02.183

在 android 中，如果你使用的是 hex，你可以试试[okio](https://github.com/square/okio)。

简单用法：

```
byte[] bytes = ByteString.decodeHex("c000060000").toByteArray(); 
```

结果将是

```
[-64, 0, 6, 0, 0] 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-11-09T19:12:03.733

`BigInteger()`java.math 中的方法非常慢且不可推荐。

`Integer.parseInt(HEXString, 16)`

可能会导致某些字符出现问题而不转换为数字/整数

一个很好的工作方法：

```
Integer.decode("0xXX") .byteValue() 
```

功能：

```
public static byte[] HexStringToByteArray(String s) {
    byte data[] = new byte[s.length()/2];
    for(int i=0;i < s.length();i+=2) {
        data[i/2] = (Integer.decode("0x"+s.charAt(i)+s.charAt(i+1))).byteValue();
    }
    return data;
} 
```

玩得开心，祝你好运

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-26T15:23:21.977

编辑：正如@mmyers 所指出的，此方法不适用于包含与设置了高位（“80”-“FF”）的字节相对应的子字符串的输入。解释位于[Bug ID: 6259307 Byte.parseByte not working as aded in SDK Documentation](https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6259307)。

```
public static final byte[] fromHexString(final String s) {
    byte[] arr = new byte[s.length()/2];
    for ( int start = 0; start < s.length(); start += 2 )
    {
        String thisByte = s.substring(start, start+2);
        arr[start/2] = Byte.parseByte(thisByte, 16);
    }
    return arr;
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-10-11T04:16:05.383

值得一提的是，这是另一个支持奇数长度字符串的版本，无需使用字符串连接。

```
public static byte[] hexStringToByteArray(String input) {
    int len = input.length();

    if (len == 0) {
        return new byte[] {};
    }

    byte[] data;
    int startIdx;
    if (len % 2 != 0) {
        data = new byte[(len / 2) + 1];
        data[0] = (byte) Character.digit(input.charAt(0), 16);
        startIdx = 1;
    } else {
        data = new byte[len / 2];
        startIdx = 0;
    }

    for (int i = startIdx; i < len; i += 2) {
        data[(i + 1) / 2] = (byte) ((Character.digit(input.charAt(i), 16) << 4)
                + Character.digit(input.charAt(i+1), 16));
    }
    return data;
} 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-08-04T17:39:40.330

我喜欢 Character.digit 解决方案，但这是我解决它的方法

```
public byte[] hex2ByteArray( String hexString ) {
    String hexVal = "0123456789ABCDEF";
    byte[] out = new byte[hexString.length() / 2];

    int n = hexString.length();

    for( int i = 0; i < n; i += 2 ) {
        //make a bit representation in an int of the hex value 
        int hn = hexVal.indexOf( hexString.charAt( i ) );
        int ln = hexVal.indexOf( hexString.charAt( i + 1 ) );

        //now just shift the high order nibble and add them together
        out[i/2] = (byte)( ( hn << 4 ) | ln );
    }

    return out;
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-26T15:18:41.690

我一直使用类似的方法

```
public static final byte[] fromHexString(final String s) {
    String[] v = s.split(" ");
    byte[] arr = new byte[v.length];
    int i = 0;
    for(String val: v) {
        arr[i++] =  Integer.decode("0x" + val).byteValue();

    }
    return arr;
} 
```

此方法根据空格分隔的十六进制值进行拆分，但不难使其根据任何其他标准拆分字符串，例如分成两个字符的分组。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-11-08T19:27:24.230

Bert Regelink 提供的代码根本不起作用。尝试以下操作：

```
import javax.xml.bind.DatatypeConverter;
import java.io.*;

public class Test
{  
    @Test
    public void testObjectStreams( ) throws IOException, ClassNotFoundException
    {     
            ByteArrayOutputStream baos = new ByteArrayOutputStream();
            ObjectOutputStream oos = new ObjectOutputStream(baos);

            String stringTest = "TEST";
            oos.writeObject( stringTest );

            oos.close();
            baos.close();

            byte[] bytes = baos.toByteArray();
            String hexString = DatatypeConverter.printHexBinary( bytes);
            byte[] reconvertedBytes = DatatypeConverter.parseHexBinary(hexString);

            assertArrayEquals( bytes, reconvertedBytes );

            ByteArrayInputStream bais = new ByteArrayInputStream(reconvertedBytes);
            ObjectInputStream ois = new ObjectInputStream(bais);

            String readString = (String) ois.readObject();

            assertEquals( stringTest, readString);
        }
    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-03-24T18:02:18.563

我发现 Kernel Panic 的解决方案对我最有用，但如果十六进制字符串是奇数，就会遇到问题。以这种方式解决它：

```
boolean isOdd(int value)
{
    return (value & 0x01) !=0;
}

private int hexToByte(byte[] out, int value)
{
    String hexVal = "0123456789ABCDEF"; 
    String hexValL = "0123456789abcdef";
    String st = Integer.toHexString(value);
    int len = st.length();
    if (isOdd(len))
        {
        len+=1; // need length to be an even number.
        st = ("0" + st);  // make it an even number of chars
        }
    out[0]=(byte)(len/2);
    for (int i =0;i<len;i+=2)
    {
        int hh = hexVal.indexOf(st.charAt(i));
            if (hh == -1)  hh = hexValL.indexOf(st.charAt(i));
        int lh = hexVal.indexOf(st.charAt(i+1));
            if (lh == -1)  lh = hexValL.indexOf(st.charAt(i+1));
        out[(i/2)+1] = (byte)((hh << 4)|lh);
    }
    return (len/2)+1;
} 
```

我将一些十六进制数添加到数组中，因此我将引用传递给我正在使用的数组，以及我需要转换的 int 并返回下一个十六进制数的相对位置。所以最终的字节数组有 [0] 个十六进制对，[1...] 个十六进制对，然后是对的数量......

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-05-16T14:43:47.743

根据 op 投票解决方案，以下应该更有效：

```
 public static byte [] hexStringToByteArray (final String s) {
    if (s == null || (s.length () % 2) == 1)
      throw new IllegalArgumentException ();
    final char [] chars = s.toCharArray ();
    final int len = chars.length;
    final byte [] data = new byte [len / 2];
    for (int i = 0; i < len; i += 2) {
      data[i / 2] = (byte) ((Character.digit (chars[i], 16) << 4) + Character.digit (chars[i + 1], 16));
    }
    return data;
  } 
```

因为：到 char 数组的初始转换省去了 charAt 中的长度检查

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-04-16T09:18:54.200

如果您偏爱 Java 8 流作为您的编码风格，那么这可以仅使用 JDK 原语来实现。

```
String hex = "0001027f80fdfeff";

byte[] converted = IntStream.range(0, hex.length() / 2)
    .map(i -> Character.digit(hex.charAt(i * 2), 16) << 4 | Character.digit(hex.charAt((i * 2) + 1), 16))
    .collect(ByteArrayOutputStream::new,
             ByteArrayOutputStream::write,
             (s1, s2) -> s1.write(s2.toByteArray(), 0, s2.size()))
    .toByteArray(); 
```

`, 0, s2.size()`如果您不介意捕获 ，可以省略收集器连接函数中的参数`IOException`。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-03-15T15:46:07.950

```
public static byte[] hex2ba(String sHex) throws Hex2baException {
    if (1==sHex.length()%2) {
        throw(new Hex2baException("Hex string need even number of chars"));
    }

    byte[] ba = new byte[sHex.length()/2];
    for (int i=0;i<sHex.length()/2;i++) {
        ba[i] = (Integer.decode(
                "0x"+sHex.substring(i*2, (i+1)*2))).byteValue();
    }
    return ba;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-05-05T07:57:34.123

我的正式解决方案：

```
/**
 * Decodes a hexadecimally encoded binary string.
 * <p>
 * Note that this function does <em>NOT</em> convert a hexadecimal number to a
 * binary number.
 *
 * @param hex Hexadecimal representation of data.
 * @return The byte[] representation of the given data.
 * @throws NumberFormatException If the hexadecimal input string is of odd
 * length or invalid hexadecimal string.
 */
public static byte[] hex2bin(String hex) throws NumberFormatException {
    if (hex.length() % 2 > 0) {
        throw new NumberFormatException("Hexadecimal input string must have an even length.");
    }
    byte[] r = new byte[hex.length() / 2];
    for (int i = hex.length(); i > 0;) {
        r[i / 2 - 1] = (byte) (digit(hex.charAt(--i)) | (digit(hex.charAt(--i)) << 4));
    }
    return r;
}

private static int digit(char ch) {
    int r = Character.digit(ch, 16);
    if (r < 0) {
        throw new NumberFormatException("Invalid hexadecimal string: " + ch);
    }
    return r;
} 
```

类似于[PHP hex2bin() 函数](http://php.net/manual/en/function.hex2bin.php)，但采用 Java 风格。

**例子：**

```
String data = new String(hex2bin("6578616d706c65206865782064617461"));
// data value: "example hex data" 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-08-25T09:03:04.343

聚会迟到了，但我已将 DaveL 的上述答案合并到一个具有相反动作的类中——以防万一它有帮助。

```
public final class HexString {
    private static final char[] digits = "0123456789ABCDEF".toCharArray();

    private HexString() {}

    public static final String fromBytes(final byte[] bytes) {
        final StringBuilder buf = new StringBuilder();
        for (int i = 0; i < bytes.length; i++) {
            buf.append(HexString.digits[(bytes[i] >> 4) & 0x0f]);
            buf.append(HexString.digits[bytes[i] & 0x0f]);
        }
        return buf.toString();
    }

    public static final byte[] toByteArray(final String hexString) {
        if ((hexString.length() % 2) != 0) {
            throw new IllegalArgumentException("Input string must contain an even number of characters");
        }
        final int len = hexString.length();
        final byte[] data = new byte[len / 2];
        for (int i = 0; i < len; i += 2) {
            data[i / 2] = (byte) ((Character.digit(hexString.charAt(i), 16) << 4)
                    + Character.digit(hexString.charAt(i + 1), 16));
        }
        return data;
    }
} 
```

和 JUnit 测试类：

```
public class TestHexString {

    @Test
    public void test() {
        String[] tests = {"0FA1056D73", "", "00", "0123456789ABCDEF", "FFFFFFFF"};

        for (int i = 0; i < tests.length; i++) {
            String in = tests[i];
            byte[] bytes = HexString.toByteArray(in);
            String out = HexString.fromBytes(bytes);
            System.out.println(in); //DEBUG
            System.out.println(out); //DEBUG
            Assert.assertEquals(in, out);

        }

    }

} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-09-25T15:11:03.960

我知道这是一个非常古老的线程，但仍然想增加我的一分钱。

如果我真的需要将一个简单的十六进制字符串编码为二进制转换器，我想按如下方式进行。

```
public static byte[] hexToBinary(String s){

  /*
   * skipped any input validation code
   */

  byte[] data = new byte[s.length()/2];

  for( int i=0, j=0; 
       i<s.length() && j<data.length; 
       i+=2, j++)
  {
     data[j] = (byte)Integer.parseInt(s.substring(i, i+2), 16);
  }

  return data;
} 
```

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2008-09-26T15:21:54.570

我想会为你做的。我将它从一个类似的函数拼凑在一起，该函数将数据作为字符串返回：

```
private static byte[] decode(String encoded) {
    byte result[] = new byte[encoded/2];
    char enc[] = encoded.toUpperCase().toCharArray();
    StringBuffer curr;
    for (int i = 0; i < enc.length; i += 2) {
        curr = new StringBuffer("");
        curr.append(String.valueOf(enc[i]));
        curr.append(String.valueOf(enc[i + 1]));
        result[i] = (byte) Integer.parseInt(curr.toString(), 16);
    }
    return result;
} 
```

* * *

## 回答 #24

> 赞同：-2
> 
> 时间：2014-12-06T00:41:23.150

对我来说，这是解决方案，HEX="FF01" 然后拆分为 FF(255) 和 01(01)

```
private static byte[] BytesEncode(String encoded) {
    //System.out.println(encoded.length());
    byte result[] = new byte[encoded.length() / 2];
    char enc[] = encoded.toUpperCase().toCharArray();
    String curr = "";
    for (int i = 0; i < encoded.length(); i=i+2) {
        curr = encoded.substring(i,i+2);
        System.out.println(curr);
        if(i==0){
            result[i]=((byte) Integer.parseInt(curr, 16));
        }else{
            result[i/2]=((byte) Integer.parseInt(curr, 16));
        }

    }
    return result;
} 
```

# javascript - 当弹出窗口关闭时，我将如何引发事件（jQuery 或 vanilla Javascript）？

> ID：140133
> 
> 赞同：12
> 
> 时间：2008-09-26T15:13:02.937
> 
> 标签：javascript, jquery

我想在弹出窗口关闭时引发事件，或者最好在关闭之前引发事件。我将弹出窗口对象存储为一个对象，但我不知道有任何方法可以绑定到关闭事件或窗口关闭之前的事件。

```
var popupWindow = window.open("/popup.aspx", "popupWindow", "height=550,width=780"); 
```

有什么方法可以使用 jQuery 订阅 close 事件，或者只是原始的 javascript？我正在使用 jQuery 并且不能添加另一个库，所以如果它不能在 jQuery 中完成，我将不得不以某种方式滚动我自己的事件系统，以便它可以在所有浏览器上工作。

**更新：**
我尝试在 jQuery 中使用 unload 事件，由于某种原因，当我的弹出窗口打开而不是关闭时，该事件就会引发。如果我使用 Firebug 设置断点来延迟订阅 unload 事件，则 unload 事件按预期方式工作，但无论出于何种原因，当允许 javascript 自然执行时，它就无法正常工作。

```
var popupWindow = window.open("/popup.aspx", "popupWindow", "height=550,width=780");
$(popupWindow.window).unload(function() { alert('hello'); }); 
```

有人知道为什么在加载窗口时会引发 unload 事件吗？

另一个问题是，我注意到 jQuery 的“卸载”事件不会像我通常那样订阅窗口：

```
popupWindow.onunload = function(){alert('hello')}; 
```

每次引发事件时，它似乎都会取消订阅该事件。这应该发生吗？如果不是因为 jQuery 中的这个错误（或功能？），那么在加载时引发事件就很好了，因为我可以检查`popupWindow.closed`事件内部的属性以确保窗口真的关闭了。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-02-04T12:22:26.673

我创建了一个观察者来检查窗口是否已关闭：

```
var w = window.open("http://www.google.com", "_blank", 'top=442,width=480,height=460,resizable=yes', true);
var watchClose = setInterval(function() {
    if (w.closed) {
     clearTimeout(watchClose);
     //Do something here...
    }
 }, 200); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-03-04T18:18:34.077

我尝试了观察者方法，但在 IE6 中使用它时遇到了“权限被拒绝”问题。发生这种情况是因为在关闭窗口的事件周围无法完全访问关闭的属性......但幸运的是，通过 try { } catch 构造它可以工作：o）

```
var w = window.open("http://www.google.com", "_blank", 'top=442,width=480,height=460,resizable=yes', true);

var watchClose = setInterval(function() {
    try {
        if (w.closed) {
            clearTimeout(watchClose);
            //Do something here...
        }
    } catch (e) {}
}, 200); 
```

谢谢马格纳斯

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-07T15:31:20.840

我想我知道发生了什么：

当您使用`window.open`它时，它会打开一个位置为“about:blank”的新窗口，然后将其更改为您在函数调用中提供的 url。

因此，unload 事件在从“about:blank”更改为正确的 url 之前绑定，并在更改发生时触发。

我让它与 JQuery 一起工作：

```
$(function(){
    var win = window.open('http://url-at-same-domain.com','Test', 'width=600,height=500');
    $(win).unload(function(){
        if(this.location == 'about:blank')
        {
            $(this).unload(function(){
                // do something here
            });
        }
    });
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T15:41:48.313

unload 事件的 jQuery 代码示例

`$(window).unload( function () { alert("Bye now!"); } );`

从[jQuery 卸载文档](http://docs.jquery.com/Events/unload#fn)

编辑：

我到处玩，无法让父窗口能够设置卸载。我可以让它工作的唯一方法是让脚本出现在弹出窗口 html 中。弹出窗口还需要加载 jQuery。我没有任何依据，但我相信卸载正在被触发，因为基本上弹出窗口正在从父窗口的范围内卸载。只是一个猜测。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:22:56.657

您必须让 onBeforeUnload 事件调用一个方法来通知您的处理程序。

请参阅此页面以获取演示。

[http://www.4guysfromrolla.com/demos/OnBeforeUnloadDemo1.htm](http://www.4guysfromrolla.com/demos/OnBeforeUnloadDemo1.htm)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:22:19.250

使用[window.onUnload](http://developer.mozilla.org/en/DOM/window.onunload)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T15:46:49.767

根据我之前的经验，我必须提到与之前提到的 onunload 相关的一个小问题：

Opera 9.0.x-9.2.x 仅在用户离开页面时运行 window.onUnload。如果用户关闭窗口，则该事件将永远不会触发。我怀疑这样做是为了解决自动重新加载弹出窗口问题（弹出窗口可以在页面关闭时重新打开）。

这很可能一直持续到 Opera 9.5.x。其他浏览器也可能实现这一点，但我不相信 IE 或 Firefox 会这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-22T10:46:30.313

从我检查的内容来看，jQuery unload 只是本机函数的包装器。我可能是错的，因为我没有挖得那么深。

这个例子对我有用。

```
$(document).ready(function(){
    $(window).unload( function (){
        alert('preget');
        $.get(
            '/some.php',
            { request: 'some' }
        );
        alert('postget');
    });
}); 
```

请记住，某些[浏览器会在卸载时阻止 window.open 请求，例如 IE](http://msdn.microsoft.com/en-us/library/ms536973(VS.85).aspx)。

# c# - 在 Umbraco CMS 中创建自定义错误页面

> ID：140137
> 
> 赞同：8
> 
> 时间：2008-09-26T15:13:59.283
> 
> 标签：c#, asp.net, content-management-system, umbraco

我正在使用 Umbraco 作为 CMS 的客户站点上工作。我需要创建一个自定义 404 错误页面。我已经尝试在 IIS 配置中执行此操作，但 umbraco 会覆盖它。

有谁知道如何在 Umbraco 中创建自定义 404 错误页面？有没有办法为运行时错误创建自定义错误页面？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T15:19:12.627

用您要显示的页面的 id`/config/umbracoSettings.config`修改`<error404>1</error404>`“ *1 ”。*

```
<errors>
   <error404>1</error404> 
</errors> 
```

其他方法可以在[Not found handlers中找到](http://our.umbraco.org/wiki/how-tos/how-to-implement-your-own-404-handler "Umbraco 未找到处理程序")

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-06-04T12:36:58.377

如其他海报所述，按照指示修改错误部分（如果需要，包括文化。）此外，在 Web 配置中添加以下内容以启用将错误传递到 umbraco：

在 /config/umbracoSettings.config 中（文件本身解释了它的用法）：

```
<errors>
  <!-- the id of the page that should be shown if the page is not found -->
  <!--        <errorPage culture="default">1</errorPage>-->
  <!--        <errorPage culture="en-US">200</errorPage>-->
  <error404>2664</error404>
</errors> 
```

在 /web.config

```
<system.webServer>
  <!-- Some other existing stuff -->
  <httpErrors existingResponse="PassThrough" />
</system.webServer> 
```

（注意：这是 .NET 4）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-07-15T07:19:41.803

umbraco 还支持文化相关的错误页面，以防您使用多语言网站...

配置稍有变化。代替

```
<errors>
  <error404>1050</error404>
</errors> 
```

你现在要写

```
<errors>
  <errorPage culture="default">1</errorPage>-->
  <errorPage culture="en-US">200</errorPage>-->
</errors> 
```

干杯，/德克

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-01T09:34:51.773

首先在您的 umbraco 安装中创建一个错误页面（和模板）。让我们说error.aspx。发布它。然后编辑**config/umbracoSettings.config**。

```
Under <errors> section
    <error404>1111</error404> 
```

其中**1111**是error.aspx 页面的**umbraco 节点 ID**

**将鼠标悬停在内容**部分的错误节点上可以找到节点 ID 。它通常是一个 4 位数字。

然后编辑**web.config**：

```
 In <appSettings> section
    change <customErrors mode as show below:
<customErrors mode="RemoteOnly" defaultRedirect="~/Error.aspx"/> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-26T10:58:18.580

目前`umbracoSettings.conf`必须通过以下方式进行配置才能使其以多语言方式工作：

```
 <errors>
        <!-- the id of the page that should be shown if the page is not found -->
        <!--        <errorPage culture="default">1</errorPage>-->
        <!--        <errorPage culture="en-US">200</errorPage>-->
        <error404>
            <errorPage culture="default">1</errorPage>
            <errorPage culture="ru-RU">1</errorPage>
            <errorPage culture="en-US">2</errorPage>
        </error404>
    </errors> 
```

请注意`error404`元素周围的`errorPage`元素，以及省略这个小而重要的细节的注释......

# windows - 删除 Windows 性能计数器类别

> ID：140149
> 
> 赞同：25
> 
> 时间：2008-09-26T15:15:26.537
> 
> 标签：windows, performancecounter

我有一个自定义性能计数器类别。Visual Studio Server Explorer 拒绝删除它，声称它“未注册或系统类别”。如果没有以编程方式进行，我该如何删除该类别？有我可以删除的注册表项吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-26T15:22:36.267

据我所知，除了以编程方式（它们旨在供应用程序在安装过程中创建和删除）之外，**没有其他方法可以安全地删除它们，但从**[PowerShell](http://Microsoft.com/PowerShell)命令行控制台执行此操作很简单。只需运行以下命令：

```
[Diagnostics.PerformanceCounterCategory]::Delete( "Your Category Name" ) 
```

**但是：（编辑）**

您*可以*删除已创建的注册表项，这将使类别消失。

对于名为“Inventory”的类别，您可以在 ... 处删除整个键，`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Inventory`虽然*我不愿意打赌这会清除所有内容*，但它**会使**该类别消失。（如果您在运行 Delete() 方法时运行[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)，您可以看到许多其他活动正在发生，并且似乎没有进行任何其他*更改*）。

重要的是要注意，**正如我最初所说**：当您从 Visual Studio 收到该错误时，可能是它已被删除，您需要在 VS 中刷新视图。在我的测试中，我必须重新启动应用程序才能让它们真正获得可用类别的干净列表。

您可以检查 PowerShell 中的完整类别列表以查看它是否已列出：

```
[Diagnostics.PerformanceCounterCategory]::GetCategories() | Format-Table -auto 
```

但是如果你检查它们，然后删除注册表项......它们仍然会出现，直到你重新启动 PowerShell（如果你启动另一个实例，你可以在那里运行相同的查询，它不会显示已删除的项目，但在第一个中重新运行 GetCategories 将继续显示它。

顺便说一句，如果您想对模式使用 -like 或对完整的正则表达式使用 -match，则可以过滤该列表：

```
[Diagnostics.PerformanceCounterCategory]::GetCategories() | Where {$_.CategoryName -like "*network*" } | Format-Table -auto
[Diagnostics.PerformanceCounterCategory]::GetCategories() | Where {$_.CategoryName -match "^SQL.*Stat.*" } | Format-Table -auto 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-19T11:44:49.460

您也可以使用 LinqPad，因为这不涉及任何类型的安装 - [http://www.linqpad.net/](http://www.linqpad.net/)。

将以下代码作为“C# 语句”运行：

`System.Diagnostics.PerformanceCounterCategory.Delete("Name of category to delete");`

我会运行它两次，第一次进行实际删除，第二次得到一条错误消息以确认删除成功。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-11-28T06:44:39.207

我知道这个问题如果老了，但我找到了一种非编程方式来解决这个问题：http: [//msdn.microsoft.com/en-us/library/windows/desktop/aa372130%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa372130%28v=vs.85%29.aspx)

在命令提示符下使用 unlodctr，您可能还需要使用 lodctr /q 来查询您的类别。

或者通过修改注册表项（不要删除它）来做这件事：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\009 [http://msdn.microsoft.com/en-us/library/windows /desktop/aa373172%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa373172%28v=vs.85%29.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:30:56.390

您可以使用 microsoft 资源工具包工具禁用它 - 从安装它

[http://download.microsoft.com/download/win2000platform/exctrlst/1.00.0.1/nt5/en-us/exctrlst_setup.exe](http://download.microsoft.com/download/win2000platform/exctrlst/1.00.0.1/nt5/en-us/exctrlst_setup.exe)

或手动从注册表中禁用它（未尝试过）描述here

[http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/regentry/94214.mspx?mfr=true](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/regentry/94214.mspx?mfr=true)

# oracle - 如何从 Oracle PL/SQL 访问 Subversion？

> ID：140153
> 
> 赞同：9
> 
> 时间：2008-09-26T15:16:28.840
> 
> 标签：oracle, svn, plsql

对于政府机构，我们构建了一个使用 PHP 和 Oracle 开发的发布管理系统。此应用程序的数据存储在数据库表中，并使用 PL/SQL 包和过程进行处理。

发布管理过程广泛基于来自 Subversion 存储库的元数据。我们通过内部 Oracle JVM 从 PL/SQL 访问存储库，以在驻留 Oracle 实例的 unix 服务器上执行 svn 命令。svn 命令的结果以 XML 格式接收并在 PL/SQL 处理之前进行解析。对于频繁重复使用，以这种方式访问​​ Subversion 的性能不是很好。

目前，我们所做的是在 Subversion 存储库中的每次提交时将 Subversion 元数据存储在数据库表中（通过 Subversion 挂钩）。我们提取每个 Subversion 事务的日志信息并将其保存在一些 oracle 表中。然后我们就可以通过正常的 SQL 查询获得 Subversion 元数据。

有没有更好的方法从 PL/SQL 访问 Subversion？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:23:36.127

如果您使用 Oracle 的 Java JVM，您可以尝试使用[SVNKit](http://svnkit.com/)从 Java 本地与 SVN 服务器通信，而不是向操作系统发送命令来执行命令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:35:35.910

我认为基本流程是有道理的。我建议进行实验以查看性能瓶颈的确切位置，然后从那里获取。例如，它是否从 PL/SQL 跨越到 Oracle JVM？执行 svn 命令是 JVM 脱壳吗？是svn往返吗？是解析XML吗？

例如，假设它是 svn 往返。也许你可以在 oracle 机器上有一个进程来缓存来自 svn 服务器的答案，以便有时可以避免往返？也许svn往返可能是异步的？

但是，就像我说的，你需要知道瓶颈在哪里。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T22:49:11.377

我也在寻找一个 API 来整合 Subversion 和 Oracle。我需要能够将 Oracle PL/SQL 对象（过程、包）提取到 Subversion 中，然后一旦对对象进行了更改，它就应该应用于 Oracle 数据库中的那些对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-25T10:51:40.943

另一种解决方案是使用介于 ORACLE 和 SVN 之间并将 PL/SQL 与源同步的软件。

这是可以由 cron 启动的这些程序之一： [https](https://sourceforge.net/projects/dbcode-svn-sync/) ://sourceforge.net/projects/dbcode-svn-sync/ 。

# c# - 加载 DataSet 时什么触发了 ConstraintException？

> ID：140161
> 
> 赞同：36
> 
> 时间：2008-09-26T15:18:13.160
> 
> 标签：c#, .net, dataset

如何找出违反约束的列和值？异常消息根本没有帮助：

> 无法启用约束。一行或多行包含违反非空、唯一或外键约束的值。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T16:59:42.183

像许多人一样，我有自己的标准数据访问组件，其中包括返回 DataSet 的方法。当然，如果抛出 ConstraintException，DataSet 不会返回给调用者，因此调用者无法检查行错误。

我所做的是在此类方法中捕获并重新抛出 ConstraintException，记录行错误详细信息，如下例所示（使用 Log4Net 进行记录）：

```
...
try
{
    adapter.Fill(dataTable); // or dataSet
}
catch (ConstraintException)
{
    LogErrors(dataTable);
    throw;
}
...

private static void LogErrors(DataSet dataSet)
{
    foreach (DataTable dataTable in dataSet.Tables)
    {
        LogErrors(dataTable);
    }
}

private static void LogErrors(DataTable dataTable)
{
    if (!dataTable.HasErrors) return;
    StringBuilder sb = new StringBuilder();
    sb.AppendFormat(
        CultureInfo.CurrentCulture,
        "ConstraintException while  filling {0}",
        dataTable.TableName);
    DataRow[] errorRows = dataTable.GetErrors();
    for (int i = 0; (i < MAX_ERRORS_TO_LOG) && (i < errorRows.Length); i++)
    {
        sb.AppendLine();
        sb.Append(errorRows[i].RowError);
    }
    _logger.Error(sb.ToString());
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-26T15:27:01.437

您可以检查一个名为 RowError 的属性。

见[http://dotnetdebug.ne​​t/2006/07/16/constraintexception-a-helpful-tip/](http://dotnetdebug.net/2006/07/16/constraintexception-a-helpful-tip/)

编辑添加此链接显示行的迭代以查看哪些有错误。

[http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.adonet/topic58812.aspx](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.adonet/topic58812.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T13:00:58.483

当您使用强类型数据集并使用可视化设计器 (xsd)：访问*tbl.Rows[0].RowError*信息时，您需要创建**Fill**方法。

您**不能使用 Get**方法，因为 DataTable 是在生成的代码中实例化的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-05-11T16:07:55.783

对于希望通过片段获取有关 ConstraintException 的更多详细信息的谷歌用户：

```
try
{
    ds.EnforceConstraints = true;
}
catch (ConstraintException ex)
{
    string details = string.Join("",
        ds.Tables.Cast<DataTable>()
            .Where(t => t.HasErrors)
            .SelectMany(t => t.GetErrors())
            .Take(50)
            .Select(r => "\n - " + r.Table.TableName + "[" + string.Join(", ", r.Table.PrimaryKey.Select(c => r[c])) + "]: " + r.RowError));
    throw new ConstraintException(ex.Message + details);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T13:05:14.077

[我在这里](https://stackoverflow.com/questions/37936/handling-xsd-dataset-constraintexceptions#37951)添加了一些我发现在调试 ConstraintException 事件时有用的代码

希望这可以帮助。

# jakarta-ee - Apache Geronimo 的 jndi 默认上下文中的 java.lang.String - 如何？

> ID：140162
> 
> 赞同：4
> 
> 时间：2008-09-26T15:18:23.110
> 
> 标签：jakarta-ee, jndi, geronimo, websphere-ce

在 servlet 中，我执行以下操作：

```
 Context context = new InitialContext();
  value = (String) context.lookup("java:comp/env/propertyName"); 
```

在 Apache Geronimo 实例 (WAS CE 2.1) 上，如何将值与键*propertyName*关联？

在 Websphere AS 6 中，我可以在管理控制台的“名称空间绑定”页面下为 JNDI 查找配置这些属性，但对于我来说，我无法在网络上的社区版中执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T14:55:38.337

`<env-entry>`一种可能性是使用一个或多个标签将属性添加到您的 web.xml 文件（在 WEB-INF 目录中） 。例如，如下所示：

```
<env-entry>
   <description>My string property</descriptor>
   <env-entry-name>propertyName</env-entry-name>
   <env-entry-type>java.lang.String</env-entry-type>
   <env-entry-value>Your string goes here</env-entry-value>
</env-entry> 
```

每个 env-entry 标记声明一个新的环境变量，然后您可以从`java:comp/env`上下文中访问它。

添加必要`env-entry`的 's 后，您可以使用类似于您已经发布的代码来访问这些值。请注意，我没有安装 Geronimo，所以我不知道是否需要进行任何其他配置才能使其正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-16T12:48:51.560

可以将您的属性放在一个文件中，并使文件的名称和位置成为 web.xml 中 URL 类型的资源引用。资源的值在 geronimo-web.xml 中设置。

您的 web.xml 将包含以下条目：

```
<resource-ref>
    <res-ref-name>configFileName</res-ref-name>
    <res-type>java.net.URL</res-type>
</resource-ref> 
```

在 geronimo-web.xml 中定义 configFileName 的值

```
<name:resource-ref>
    <name:ref-name>configFileName</name:ref-name>
    <name:url>file:///etc/myConfigFile</name:url>
</name:resource-ref> 
```

在java中，您有以下代码来查找值：

```
initialContext = new InitialContext();
URL url = (URL) initialContext.lookup("java:comp/env/configFileName");
String configFileName = url.getPath(); 
```

然后你必须打开文件并读取其中的任何值。

所有这一切的结果是您在文件系统上的文件中拥有属性。如果您重新部署应用程序，它不会被覆盖。

# python - 正则表达式，但用于在匹配中写入

> ID：140182
> 
> 赞同：1
> 
> 时间：2008-09-26T15:22:06.160
> 
> 标签：python, regex

在使用正则表达式时，我们通常（如果不总是）使用它们来提取某种信息。我需要的是用其他值替换匹配值......

现在我正在做这个...

```
def getExpandedText(pattern, text, replaceValue):
    """
        One liner... really ugly but it's only used in here.
    """

    return text.replace(text[text.find(re.findall(pattern, text)[0]):], replaceValue) + \
            text[text.find(re.findall(pattern, text)[0]) + len(replaceValue):] 
```

所以如果我做某事

```
>>> getExpandedText("aaa(...)bbb", "hola aaaiiibbb como estas?", "ooo")
'hola aaaooobbb como estas?' 
```

它将 (...) 更改为 'ooo'。

你们知道是否使用 python 正则表达式可以做到这一点吗？

非常感谢你们！！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T15:26:22.907

```
sub (replacement, string[, count = 0]) 
```

[sub](https://docs.python.org/howto/regex.html#search-and-replace)返回通过替换替换替换字符串中最左边的非重叠出现的 RE 获得的字符串。如果未找到该模式，则字符串原封不动地返回。

```
 p = re.compile( '(blue|white|red)')
    >>> p.sub( 'colour', 'blue socks and red shoes')
    'colour socks and colour shoes'
    >>> p.sub( 'colour', 'blue socks and red shoes', count=1)
    'colour socks and red shoes' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:27:48.207

你想使用[re.sub](https://docs.python.org/2/library/re.html#re.sub)：

```
>>> import re
>>> re.sub(r'aaa...bbb', 'aaaooobbb', "hola aaaiiibbb como estas?")
'hola aaaooobbb como estas?' 
```

要重用模式中的可变部分，请`\g<n>`在替换字符串中使用以访问第 n`()`组：

```
>>> re.sub( "(svcOrdNbr +)..", "\g<1>XX", "svcOrdNbr               IASZ0080")
'svcOrdNbr               XXSZ0080' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T15:26:18.973

当然。请参阅编译正则表达式的 'sub' 和 'subn' 方法，或 're.sub' 和 're.subn' 函数。您可以使用您提供的字符串参数使其替换匹配项，或者您可以传递一个可调用的（例如函数），该调用将被调用以提供替换。见[https://docs.python.org/library/re.html](https://docs.python.org/library/re.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T17:23:44.650

如果您想继续使用您提到的语法（替换匹配值而不是替换不匹配的部分），并且考虑到您只有一组，您可以使用下面的代码。

```
def getExpandedText(pattern, text, replaceValue):
    m = re.search(pattern, text)
    expandedText = text[:m.start(1)] + replaceValue + text[m.end(1):]
    return expandedText 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T21:48:26.013

```
def getExpandedText(pattern,text,*group):
    r""" Searches for pattern in the text and replaces
    all captures with the values in group.

    Tag renaming:
    >>> html = '<div> abc <span id="x"> def </span> ghi </div>'
    >>> getExpandedText(r'</?(span\b)[^>]*>', html, 'div')
    '<div> abc <div id="x"> def </div> ghi </div>'

    Nested groups, capture-references:
    >>> getExpandedText(r'A(.*?Z(.*?))B', "abAcdZefBgh", r'<\2>')
    'abA<ef>Bgh'
    """
    pattern = re.compile(pattern)
    ret = []
    last = 0
    for m in pattern.finditer(text):
        for i in xrange(0,len(m.groups())):
            start,end = m.span(i+1)

            # nested or skipped group
            if start < last or group[i] is None:
                continue

            # text between the previous and current match
            if last < start:
                ret.append(text[last:start])

            last = end
            ret.append(m.expand(group[i]))

    ret.append(text[last:])
    return ''.join(ret) 
```

**编辑：**允许替换字符串中的捕获引用。

# c++ - 让 C 回调调用 C++ 成员函数的最佳方法？

> ID：140204
> 
> 赞同：4
> 
> 时间：2008-09-26T15:25:41.860
> 
> 标签：c++, function, struct, callback

给定一个典型的类：

```
结构随便
{
    无效 Doit();
};

不管w;

```

让基于 C void* 的回调（例如 pthread_create() 或信号处理程序）调用成员函数的最佳方法是什么？

```
pthread_t pid；

pthread_create(&pid, 0, ... &w.Doit() ... );

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T15:30:00.587

大多数 C 回调允许指定一个参数，例如

```
int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
                   void *(*start_routine)(void*), void *arg); 
```

所以你可以有

```
void myclass_doit(void* x)
{
  MyClass* c = reinterpret_cast<MyClass*>(x);
  c->doit();
}

pthread_create(..., &myclass_doit, (void*)(&obj)); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T19:51:32.487

最简洁的解决方案是在所有代码共享的头文件中定义：

```
模板 <typename T, void (T::*M)()>
无效*重击（
    无效* p)
{
    T* pt = static_cast<T*>(p);

    (pt->*M)();

    返回0；
}

```

您可能想要定义 4 个版本：一个是 thunk 返回 void 和 void 的版本`*`，一个是每个成员函数返回 void 和 void的版本`*`。这样编译器可以根据情况匹配最好的编译器（事实上，如果一切都不匹配，它会抱怨。）

然后，每次遇到这些情况之一时，您只需输入：

pthread_create(&pid, 0, &thunk<Whatever, &Whatever::doit>, &w);

只要方法是从类的代码中引用的，这甚至可以在方法是私有的时起作用。（如果不是，我想知道为什么代码引用了私有方法。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T15:30:48.807

使用这样的 C 函数包装器：

```
struct Whatever
{
    void Doit();
};

extern "C" static int DoItcallback (void * arg)
{
  Whatever * w = (Whatever *) arg;
  w->DoIt();
  return something;
} 
```

仅当您可以以某种方式将指针传递给类时才有效。大多数回调机制都允许这样做。

Afaik 这是唯一的方法。如果没有大量黑客攻击，您不能直接从 C 调用方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T15:34:58.517

成员函数是私有的吗？如果没有，请使用标准成语：

```
void* pthread_foo_caller(void* arg) {
    Foo* foo = static_cast<Foo*>(arg);
    foo->bar();
    return NULL;
} 
```

如果成员函数是私有的，您可以在类中声明一个静态方法，该方法采用“this”指针并调用适当的方法。例如：

```
class Foo {
 public:
  static pthread_foo_caller(void* arg);
  ...
};

void* Foo::pthread_foo_caller(void* arg) {
    Foo* foo = static_cast<Foo*>(arg);
    foo->private_bar();
    return NULL;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:10:31.037

您应该注意的一件事是，如果您编写这样的代码：

```
try {
    CallIntoCFunctionThatCallsMeBack((void *)this, fCallTheDoItFunction);
} catch (MyException &err)
{
   stderr << "badness.";
}

void fCallTheDoItFunction(void *cookie)
{
    MyClass* c = reinterpret_cast<MyClass*>(cookie);
    if (c->IsInvalid())
        throw MyException;
    c->DoIt();
} 
```

根据您的编译器，您可能会遇到一些严重的问题。事实证明，在一些编译器中，在优化时，他们在 try/catch 块中看到一个 C 调用，并高兴地惊呼：“我正在调用一个 C 函数，因为它是老式的 C，所以不能抛出！Calloo-catch ! 我将删除 try/catch 的所有痕迹，因为它永远无法到达。

愚蠢的编译器。

不要调用 C 来回叫你并期望能够赶上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T15:29:31.790

成员函数必须是静态的。非静态有一个隐含的“this”参数。将指针作为 void* 传递给您的任何实例，以便静态成员可以访问该实例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T16:21:14.927

这是一个简单的方法，不要忘记正确管理“MemberFunction”对象的生命周期。

```
#include 

class MyClass
{
public:
    void DoStuff()
    {
        printf("Doing Stuff!");
    }
};

struct MemberFunction
{
    virtual ~MemberFunction(){}
    virtual void Invoke() = 0;
};

void InvokeMember(void *ptr)
{
    static_cast(ptr)->Invoke();
}

template 
struct MemberFunctionOnT : MemberFunction
{
    typedef void (T::*function_t)();
public:
    MemberFunctionOnT(T* obj, function_t fun)
    {
        m_obj = obj;
        m_fun = fun;
    }

    void Invoke()
    {
        (m_obj->*m_fun)();
    }
private:
    T *m_obj;
    function_t m_fun;
};

template 

MemberFunction* NewMemberFunction(T *obj, void (T::*fun)())
{ 
    return new MemberFunctionOnT(obj, fun); 
}

//simulate a C-style function offering callback functionality.
void i_will_call_you_later(void (*fun)(void*), void *arg)
{
    fun(arg);
}

int main()
{
    //Sample usage.
    MyClass foo;

    MemberFunction *arg = NewMemberFunction(&foo, &MyClass::DoStuff);
    i_will_call_you_later(&InvokeMember, arg);
    return 0;
}
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T15:30:11.070

看到这个[链接](http://www.newty.de/fpt/callback.html#member)

基本上，这不是直接可能的，因为：“指向非静态成员的指针与普通 C 函数指针不同，因为它们需要传递类对象的 this 指针。因此，普通函数指针和 [pointers to] 非静态成员函数具有不同且不兼容的签名"

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T15:33:13.293

虽然我没有在 C 中使用过它，但为了进行回调，我强烈建议您查看[libsigc++](http://libsigc.sourceforge.net/)。这正是我在执行 C++ 回调时多次需要的。

# sql - 在 SQL 查询中组合拆分日期范围

> ID：140205
> 
> 赞同：4
> 
> 时间：2008-09-26T15:25:46.150
> 
> 标签：sql, database, ms-access, database-design

我正在处理一个需要根据日期范围组合一些数据行的查询。这些行在所有数据值中都重复，但日期范围被拆分。例如，表数据可能看起来像

```
StudentID   StartDate   EndDate     Field1  Field2
1           9/3/2007    10/20/2007  3       True
1           10/21/2007  6/12/2008   3       True
2           10/10/2007  3/20/2008   4       False
3           9/3/2007    11/3/2007   8       True
3           12/15/2007  6/12/2008   8       True 
```

查询的结果应该组合了拆分日期范围。查询应结合仅间隔一天的日期范围。如果间隔超过一天，则不应合并行。没有拆分日期范围的行应该保持不变。结果看起来像

```
StudentID   StartDate   EndDate     Field1  Field2
1           9/3/2007    6/12/2008   3       True
2           10/10/2007  3/20/2008   4       False
3           9/3/2007    11/3/2007   8       True
3           12/15/2007  6/12/2008   8       True 
```

这个查询的 SELECT 语句是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T16:38:16.943

以下代码应该可以工作。我做了一些假设如下：日期范围没有重叠，任何字段中都没有 NULL 值，并且给定行的开始日期总是小于结束日期。如果您的数据不符合这些标准，则需要调整此方法，但它应该为您指明正确的方向。

您可以使用子查询而不是视图，但这可能很麻烦，因此我使用视图使代码更清晰。

```
CREATE VIEW dbo.StudentStartDates
AS
    SELECT
        S.StudentID,
        S.StartDate,
        S.Field1,
        S.Field2
    FROM
        dbo.Students S
    LEFT OUTER JOIN dbo.Students PREV ON
        PREV.StudentID = S.StudentID AND
        PREV.Field1 = S.Field1 AND
        PREV.Field2 = S.Field2 AND
        PREV.EndDate = DATEADD(dy, -1, S.StartDate)
    WHERE PREV.StudentID IS NULL
GO

CREATE VIEW dbo.StudentEndDates
AS
    SELECT
        S.StudentID,
        S.EndDate,
        S.Field1,
        S.Field2
    FROM
        dbo.Students S
    LEFT OUTER JOIN dbo.Students NEXT ON
        NEXT.StudentID = S.StudentID AND
        NEXT.Field1 = S.Field1 AND
        NEXT.Field2 = S.Field2 AND
        NEXT.StartDate = DATEADD(dy, 1, S.EndDate)
    WHERE NEXT.StudentID IS NULL
GO

SELECT
    SD.StudentID,
    SD.StartDate,
    ED.EndDate,
    SD.Field1,
    SD.Field2
FROM
    dbo.StudentStartDates SD
INNER JOIN dbo.StudentEndDates ED ON
    ED.StudentID = SD.StudentID AND
    ED.Field1 = SD.Field1 AND
    ED.Field2 = SD.Field2 AND
    ED.EndDate > SD.StartDate AND
    NOT EXISTS (SELECT * FROM dbo.StudentEndDates ED2 WHERE ED2.StudentID = SD.StudentID AND ED2.Field1 = SD.Field1 AND ED2.Field2 = SD.Field2 AND ED2.EndDate < ED.EndDate AND ED2.EndDate > SD.StartDate)
GO 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:28:25.350

根据我的经验，我必须在后处理中组合范围（不是在 SQL 中，而是在我的脚本中）。我不确定 SQL 是否可以做到这一点，特别是因为您永远无法确切知道在任何特定情况下需要链接多少个日期范围。如果可以做到这一点，我也很想知道。

**编辑：**我的回答是假设每个学生有多个日期范围，而不仅仅是开始和结束。如果您只有一个没有间隔的日期范围，那么其他提到的解决方案就是要走的路。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:28:58.483

```
SELECT StudentID, MIN(startdate) AS startdate, MAX(enddate), field1, field2
FROM tablex
GROUP BY StudentID, field1, field2 
```

假设这不是学生时间范围之间的差距，那将产生结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:28:59.093

```
select StudentID, min(StartDate) StartDate, max(EndDate) EndDate, Field1, Field2 
  from table
 group by StudentID, Field1, Field2 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T16:06:41.093

如果 min()/max() 解决方案不够好（例如，如果日期不连续并且您想分别对单独的日期范围进行分组），我想知道使用 Oracle 的 START WITH 和 CONNECT BY 子句是否可行。当然，这不适用于每个数据库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T16:19:38.753

编辑：为 Access 制作另一组 SQL。我测试了所有这些，但是是一块一块地测试，因为我不知道如何在 Access 中一次制作多个语句。由于我也不知道如何做评论，你可以在下面的 SQL 版本中看到评论。

```
select 
studentid, min(startdate) as Starter, max(enddate) as Ender, field1, field2, 
max(startDate) - Min(endDate)  as MaxGap 
into tempIDs
from student 
group by studentid, field1, field2 ;  

delete from tempIDs where MaxGap > 1;

UPDATE student INNER JOIN TempIDs ON Student.studentID = TempIDS.StudentID
SET Student.StartDate = [TempIDs].[Starter],
 Student.EndDate = [TempIDs].[Ender]; 
```

我认为就是这样，在 SQL Server 中 - 我没有在 Access 中这样做。我还没有针对诸如重叠多个记录等奇特的条件对其进行测试，但这应该可以帮助您入门。它更新所有重复的、小间隔的记录，在数据库中留下额外的记录。MSDN 有一个关于消除重复的页面：http: [//support.microsoft.com/kb/139444](http://support.microsoft.com/kb/139444)

```
select 
studentid, min(startdate) as StartDate, max(enddate) as EndDate, field1, field2, 
datediff(dd, Min(endDate),max(startDate)) as MaxGap 
into #tempIDs
from #student 
group by studentid, field1, field2    

-- Update the relevant records.  Keeps two copies of the massaged record 
-- - extra will need to be deleted.

update #student 
set startdate = #TempIDS.startdate, enddate = #tempIDS.EndDate
from #tempIDS 
where #student.studentid = #TempIDs.StudentID and MaxGap < 2 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T19:31:45.843

您是否考虑过非平等加入？看起来像这样：

```
SELECT A.StudentID, A.StartDate, A.EndDate, A.Field1, A.Field2
FROM tblEnrollment AS A LEFT JOIN tblEnrollment AS B ON (A.StudentID = B.StudentID) 
   AND (A.EndDate=B.StartDate-1)
WHERE B.StudentID Is Null; 
```

这给您的是所有没有相应记录的记录，该记录从第一条记录的结束日期之后的第二天开始。

[警告：请注意，您只能在 SQL 视图中的 Access 查询设计器中编辑非等连接 - 切换到设计视图可能会导致连接丢失（尽管如果您确实切换 Access 会告诉您问题，如果您立即切换回 SQL 视图，您不会丢失它）]

如果您然后将其与以下内容联合：

```
SELECT A.StudentID, A.StartDate, B.EndDate, A.Field1, A.Field2
FROM tblEnrollment AS A INNER JOIN tblEnrollment AS B ON (A.StudentID = B.StudentID) 
   AND (A.EndDate= B.StartDate-1) 
```

它应该给你你需要的东西，假设一次不超过两个连续的记录。如果你有两个以上的连续记录，我不确定你会怎么做（它可能涉及查看 StartDate-1 与 EndDate 相比），但这可能会让你朝着正确的方向开始。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T19:56:31.897

Tom H. 在接受的答案中提供的替代最终查询是

```
SELECT
    SD.StudentID,
    SD.StartDate,
    MIN(ED.EndDate),
    SD.Field1,
    SD.Field2
FROM
    dbo.StudentStartDates SD
INNER JOIN dbo.StudentEndDates ED ON
    ED.StudentID = SD.StudentID AND
    ED.Field1 = SD.Field1 AND
    ED.Field2 = SD.Field2 AND
    ED.EndDate > SD.StartDate
GROUP BY
    SD.StudentID, SD.Field1, SD.Field2, SD.StartDate 
```

这也适用于所有测试数据。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-20T22:12:47.330

下面是一个使用 SQL Server 2005/2008 语法的测试数据示例。

```
DECLARE @Data TABLE(
    CalendarDate datetime )

INSERT INTO @Data( CalendarDate )
-- range start
SELECT '1 Jan 2010'
UNION ALL SELECT '2 Jan 2010'
UNION ALL SELECT '3 Jan 2010'
-- range start
UNION ALL SELECT '5 Jan 2010'
-- range start
UNION ALL SELECT '7 Jan 2010'
UNION ALL SELECT '8 Jan 2010'
UNION ALL SELECT '9 Jan 2010'
UNION ALL SELECT '10 Jan 2010'

SELECT DateGroup, Min( CalendarDate ) AS StartDate, Max( CalendarDate ) AS EndDate
FROM(   SELECT NextDay.CalendarDate, 
            DateDiff( d, RangeStart.CalendarDate, NextDay.CalendarDate ) - ROW_NUMBER() OVER( ORDER BY NextDay.CalendarDate ) AS DateGroup
        FROM( SELECT Min( CalendarDate ) AS CalendarDate
                FROM @data ) AS RangeStart
            JOIN @data AS NextDay
                ON NextDay.CalendarDate >= RangeStart.CalendarDate ) A
GROUP BY DateGroup 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-29T12:36:17.953

这是 SQL（语言）中的一个经典问题，例如 Joe Celko 的著作“Smarties 的 SQL”（第 23 章，区域、运行、间隙、序列和系列）和他的最新著作“集合中的思考”（第 15 章）。

虽然在运行时使用怪物查询修复数据很“有趣”，但对我来说，这是可以更好地离线和程序修复的情况之一（我个人会使用 Excel 电子表格中的公式来完成）。

重要的是设置有效的数据库约束，以防止重复出现重叠时段。同样，用 SQL 编写序列约束是一个经典：参见 Snodgrass ( [http://www.cs.arizona.edu/people/rts/tdbbook.pdf](http://www.cs.arizona.edu/people/rts/tdbbook.pdf) )。MS Access 用户提示：您需要使用 CHECK 约束。

# debugging - 你如何使用 gdb 来调试你的代码？

> ID：140217
> 
> 赞同：12
> 
> 时间：2008-09-26T15:27:39.500
> 
> 标签：debugging, gdb

作为开发人员，您如何使用 gdb 来跟踪代码中的错误？你用什么技巧让你的生活更轻松？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T16:10:08.667

一些提示：

*   使用图形前端（kdbg 非常好，ddd 至少比命令行 gdb 好，kdevelop 有一个不错的 gdb 前端但有一些 bgs，nemiver 看起来也不错，但仍在工作中）
*   确保所有重要部分都有调试符号和源代码（您自己的代码和一些系统库）
    *   在 RedHat 上，您可以安装 -debuginfo 包以使符号和源代码神奇地出现在调试器中 - 非常酷，因为您可以查看 libc 函数调用等。
    *   在 Debian/Ubuntu 上，您可以安装 -dbg 包来获取符号；不过，为系统包安装适当的源文件似乎很困难
*   我倾向于在不应该到达的地方或我想研究的地方（某种重量级断点）添加 assert() 和 abort() 调用
*   理想情况下，assert() 或 abort() 调用应该包含在某些方法或宏中，仅在 Debug 版本中启用它们，或者更好的是仅在设置了某个 env var 时才启用它们
*   为 SIGSEGV 和 SIGABRT 安装信号处理程序；我个人在安装处理程序之前检查是否设置了某个环境变量；在处理程序中，我执行一个硬编码的外部命令，该命令通常位于 ~/.local/bin/; 然后该命令可能会启动 kdbg 并将其附加到崩溃的应用程序。瞧，当您的应用程序出现问题时，调试器就会弹出。
*   如果您使用单元测试，您可以类似地在测试用例失败时附加一个调试器，然后检查应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-07T00:48:20.623

gdb 的一个特别有用的特性是它能够检查崩溃程序的最终状态。

要检查故障转储（或更常用的核心文件），请按如下方式启动 gdb：

`gdb <program-name> <core-file>`

例如：

`gdb a.out core`

在核心文件上运行此命令后，gdb 将告诉您程序如何终止并显示程序中发生错误的位置：

```
Program terminated with signal 11, Segmentation fault.
#0  0x08048364 in foo () at foo.c:4
4         *x = 100; 
```

在上面的示例中，您可以看到程序在尝试为指针分配值时因分段错误而终止。通过在 gdb 的提示符下键入`backtrace`（或`bt`或`where`），您可以查看程序的完整回溯：

```
(gdb) backtrace
#0  0x08048364 in foo () at foo.c:4
#1  0x0804837f in main () at foo.c:9 
```

此时，您知道在尝试`main()`为. 很多时候，这提供了足够的信息来让您修复错误。`foo()``foo()``*x`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T15:41:19.047

In general you find something that isn't how it should be, and work backwards until you understand why.

The most obvious is the most useful: Setting a breakpoint on a function or line number and walking through the code line by line.

Another handy tip is to have show functions for all your structures/objects even if they are never used in your program, because you can run these functions from within gdb:

```
gdb> p show_my_struct(struct)

My custom display of Foo:
   ... 
```

Watchpoints can be really handy too, but may slow down your program a lot. These break the flow when the value of a variable or address changes.:

```
gdb> watch foo
Watchpoint4: foo
gdb> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T19:03:27.133

您也可以使用[Geany](http://www.geany.org)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-07T01:36:57.560

我做了很多并行程序开发，所以我发现在 python/ruby 中使用一个简单的包装器，它允许我将 gdb 附加到所有节点上的所有进程并与我通信非常有帮助（我没有如果有人知道，找到一种更好的方法，而不是劫持线程，虽然......）

我不确定OP的经验如何，所以：

GDB 文档非常好，而且包罗万象。第一章很好地介绍了所有基础知识。

[http://www.gnu.org/software/gdb/documentation/](http://www.gnu.org/software/gdb/documentation/)

虽然不是 gdb，但它们是相关的：我个人发现分解复杂的行以帮助确定哪些语句出错会有所帮助。

此外，Valgrind（[http://valgrind.org/](http://valgrind.org/)）对于解决缓冲区溢出等问题非常好/有用（我没有运气使用 gdb 来做这件事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T12:03:34.070

基本但非常有用 - 使用带有选项 -tui的[文本 gui 。](http://davis.lbl.gov/Manuals/GDB/gdb_21.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T21:56:32.503

使用 ddd，一个 gdb 的可视化前端。它使您只需单击几下鼠标即可轻松完成操作，并可视化代码的工作方式，此外，在调试器控制台中，您还有一个交互式 gdb。

# search - 可重用代码/类存储库

> ID：140224
> 
> 赞同：2
> 
> 时间：2008-09-26T15:28:31.620
> 
> 标签：search, development-environment, repository, code-reuse

我有几个包含函数、类和模板的模块，我将它们保存在一个名为（哈哈！）“重用”的目录中。我对内容了如指掌，所以找到一个特定的类或一段代码不需要太长时间，但它的大小正在缓慢增长，我需要一些合理的方法来存储它们以便于搜索和检索。

我该怎么做？

* * *

一个相关的问题可以在这里找到：[全文搜索源代码](https://stackoverflow.com/questions/90300/in-house-full-text-search-engine-for-source-code-and-sql-scripts)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T15:33:26.837

*   ****按使用区域**（网络、安全、文本处理等）对源进行**分组；**最好的**目录**，以便于浏览。**
***   **通过在源文档中添加**关键字来****标记**函数。使用适当的注释标记系统（如 javadoc）并创建某种可索引的文档。*****   **通过在您的来源上使用某种全文搜索（grep -r，google desktop）进行搜索**。********

 ***** * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:34:26.800

通常，我根据文件的一般用途对文件进行分组。

例如：重用\数据库重用\图形重用\数学重用\等...

然后，您可以对您的组进行分组

重用\图形\2D 重用\图形\3D

高温高压

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T15:34:48.907

取决于系统，但是当可重用的数量可能达到某个阈值时，我倾向于尝试将其逻辑块转换为“真实”库，就像你从 3rd 方使用的一样（带有文档等）和将它们放入各自的库路径中，以便它们真正可重用。

如果您不介意在某些 OSS 许可下将它们分发出去，您甚至可以将它们放入与您正在使用的任何环境等效的 CPAN/PyPI/PEAR 中。这增加了更多的可重用性。

我想重要的部分仍然是您将代码捆绑到真正的库中。然后检索部分应该更容易，因为大部分是自动的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:33:39.470

您可以在目录中划分所有类。

问题的语言是什么？因为.Net 你可以有一个像 DLL 一样的库，用命名空间划分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T15:34:07.347

1.  按功能将功能/类/模板分组到模块/目录中。假装你会将它们作为开源库发布；考虑您希望如何组织其他人的代码。最终，它将是别人的代码：一两年前的你。
2.  使用文档系统。Doxygen 将为您生成一个方便的 HTML 代码浏览器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T15:38:26.760

前段时间就这个问题展开了讨论。代码的标准文件夹化有利于可读性和组织性，但是当您只想抓取内容时，另一种方法是以某种方式使用标记（例如通过将标记添加到文件名或其他元数据）。标签可以很好地代替文件夹，因为您可以快速挖掘特定或一般的东西，而使用文件夹，您需要在树中挖掘才能获得特定的东西。

标签：O(n)。文件夹：O(n^2)

也许。:P

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T22:45:54.467

根据语言进行文件夹化（细分为功能），带有标签，在 VCS 的目录中，带有 Doxygen/Perldoc/*Pod/*-extracted 文档。您将拥有一个易于 grepp 的可重用模块/文档存档，可立即移植到您的工作中。/

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-08T15:11:28.777

[这个](https://stackoverflow.com/questions/237946/how-do-i-index-and-make-available-reusable-code)问题涵盖了很多相同的领域，我会以有利于它的方式结束这个问题。

# project-management - 哪些问题跟踪器支持子工单，它们在弥合项目经理和开发人员之间的差距方面做得如何？

> ID：140236
> 
> 赞同：22
> 
> 时间：2008-09-26T15:30:47.467
> 
> 标签：project-management, bug-tracking

我希望在问题跟踪软件中看到一个似乎并不常见的功能，那就是能够将工单（错误、功能请求等）划分为子任务并查看它们以分层方式，可能带有某种进度条样式的特定票及其子票的进度报告。

我的想法是，这对开发人员和项目经理都有用：项目经理喜欢对正在发生的事情有一个相当广泛的概述，而开发人员需要深入了解细节，并且经常需要将任务划分为子任务-任务。如果有人将两个问题放入一张票中，这也会派上用场。

有谁知道这样做的问题跟踪器？到目前为止，我看过的那些（Trac、FogzBugz 和 Basecamp）都有一个扁平的工单组织，所以它们要么对开发人员有用，要么对项目经理有用，但对两者都没有。[Assembla](http://www.assembla.com/)确实允许一张票有子票（和多个父票），但它在这个特定功能上的可用性方面做得不是很好。

如果有这样的问题跟踪器，是否有人将它用于开发人员和项目经理，如果有，您使用它取得了多大的成功？或者，是否有更好的方法可供两类用户使用？

（**更新：**这*不是*一个主观的“你最喜欢的错误跟踪软件是什么”问题。我问的是针对特定目的具有特定功能的错误跟踪器，所以请不要发布你最喜欢的错误跟踪器，如果它不这样做我所要求的。唯一可以说是主观因素是它对于这个特定目的的效果如何。）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T15:31:54.030

[JIRA](http://www.atlassian.com/software/jira/)

![子任务](https://i.stack.imgur.com/J8my8.png)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-12-02T15:14:12.993

您需要 Fogbugz 的第 7 版。这支持多层次的层次结构并在[树视图](http://fogbugz.stackexchange.com/questions/4374/case-hierarchy-parent-cases-and-subcases/4375#4375)中显示它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T15:33:27.210

JIRA 能够将任务分解为任意子任务，就像您追求的那样。它也超级闪亮，所以项目经理类型应该喜欢它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T15:38:27.103

[这里](https://stackoverflow.com/questions/12328/what-bug-tracking-software-do-you-use)有一个关于错误跟踪器的冗长讨论。

我喜欢螳螂，我自己。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T15:42:50.697

螳螂确实有问题之间的关系，比如父母、孩子、相关等。

它不完全具有树视图，但当您查看问题时，它会在列表中显示相关/父/子问题。

尝试过 trac 和 Mantis，这是我个人的最爱

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-28T21:19:34.863

好吧，我们已经使用[TestTrack](http://www.seapine.com/ttpro.html)多年了，它支持项目之间的分层链接。然而，它的项目管理 UI 没什么好写的。

似乎您正在寻找更像 @Task 的东西*，*[您](http://www.attask.com/overview/features)可以在其中使用类似于 Microsoft Project 的系统创建项目计划，未来的任务取决于以前的任务等。UI 非常漂亮，但是当您到达时错误跟踪器你几乎回到了“美化电子表格”模式 - 我不觉得这是真正由程序员设计或为程序员设计的。*不过，如果您真的*需要这个，可能值得一看。

恕我直言，向您的跟踪系统添加层次结构的问题在于，添加问题时自然不会具有层次结构；QA 中的某个人发现了回归，或者用户从现场打来电话，并创建了一个问题。在至少对问题的根本原因进行*一些*研究之前，问题是独立的，而且很有可能，*除非*它被确定为依赖于某个更大的项目......可能已经存在某种项目管理系统。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-05-09T18:07:31.520

redmine 和 chiliproject 支持子任务，无需任何额外的插件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-27T13:07:01.030

基于其他答案之一，我查看了[Jira](http://www.atlassian.com/software/jira/)，它是我正在寻找的部分方式，并且似乎工作得相当好，尽管它不像我希望的那样光滑. 但是，它只允许专业版和企业版中的子任务；此功能默认禁用；而且您只会获得一个级别的子任务。默认报告还在平面视图中同时列出顶级任务和子任务，因此如果您只想查看顶级任务，则必须专门创建自定义报告。

当我有机会时，我打算研究的另一个功能是 Mantis，它显然具有类似的功能。一旦我尝试过，我会在这里更新。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T15:37:35.343

Rally 支持开发和项目管理视图

[http://www.rallydev.com/](http://www.rallydev.com/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T15:43:24.160

[Tele-Support HelpDesk](http://www.resource-dynamics.com)有一个非常好且易于使用的错误跟踪系统，该系统还具有将其公开给支持部门以将客户链接到问题并在问题完成时通知客户的好处。我每天都生活在其中，并且发现工作流程非常高效。管理层总是知道当前正在进行什么，刚刚修复了什么，以及哪些问题很热门（甚至需要多长时间才能修复）。

它有一个非常好的可定制的优先级系统。每个问题都可以有一个类别和分配给它的产品，单击按钮将被组织到该列表中。有一个快速过滤选项，并且能够进行更精细的过滤。估计完成时间后，它会根据列表中当前可见的内容自动计算总完成时间。

我们的典型工作流程：错误由支持人员/质量检查人员输入系统。管理层审查“新”错误列表并设置他们希望它们完成的优先级。开发人员查看优先级列表并设置估计的工作量级别。管理层审查并调整优先级。开发完成问题。QA 验证已完成的问题，并在成功发布更新后通知客户。

在所有阶段，员工中的任何人都可以查看列表并了解当前状态，甚至可以添加注释或附加其他客户到问题。有用于发布版本的字段，我们使用自定义过滤器/报告来自动生成我们的发布说明。（开放[已知问题](http://www.resource-dynamics.com/sss7.htm)的屏幕截图：这是产品的错误跟踪部分）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T15:49:19.450

[FogBugz](http://www.fogcreek.com/FogBugz/)是由 Joel Spolsky 的公司 FogCreek 制作的问题跟踪器。它不是免费的，但有一个非常好的托管版本。根据我个人的经验，它具有一些出色的功能并且易于使用。它确实比 mantis 或 bugzilla 看起来更好，可用性更好，但它不是开放的，它为更简单的界面做了一些权衡。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-09T05:10:38.527

托托斯。

它甚至在顶部进行项目管理活动。

工作流程，维基，很不错。

www.tutos.org

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-26T08:36:03.590

我在许多组织中都使用过[Mantis](http://www.mantisbt.org/)，尤其是因为子问题功能是我在问题跟踪器中寻找的关键点之一。他们现在在 Mantis 中有 Freemind 导出，但我确信我已经在一个站点上看到过父子图，可能是因为他们安装了 JpGraph。

我还在使用[Axosoft 的](http://www.axosoft.com/)OnTime 系统的免费单用户安装，尽管 UI 有点笨拙，但它具有非常灵活的子问题条目 - 您必须搜索问题而不是能够直接指定给定的问题编号作为关系的目标。OTOH，它允许您在对话框中一次点击配置一堆关系，因此在这种情况下更快。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-04T18:21:45.540

Bugzilla 有依赖错误的概念，这并不完全是您正在寻找的子任务范例，但可以被视为接近。不幸的是，这个界面非常笨拙，就像 Bugzilla 界面的其余部分一样，但它确实完成了工作。

积极的一面是，bug 之间的关系可以表示为图表以及相当容易遍历的树结构，以允许探索相关问题。此外，随着子问题的完成或更改，这些更改会渗透到依赖关系树中，以便那些负责更高级别任务的人很容易得到通知，他们可能一直在等待的事情已经完成。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2012-01-20T20:59:22.170

**JIRA 与 Pivotal Tracker 集成。**

*JIRA*允许门票。它为搜索提供了 JQL 过滤器功能。提供在组之间共享票证的能力。提供工作流程图、历史记录、转换、评论等功能。提供查看报告者、受让人、实施者的能力。对于每张工单，都可以添加评论、附件、附加屏幕截图、链接、克隆、解决问题。JIRA 提供了当前工单状态的非常好的布局。

*Pivotal Tracker*允许敏捷开发项目的“速度”管理。对 PM 和开发人员有用。提供图形、图表。提供将 JIRA 的票证集成到其项目中的能力。提供带有项目的仪表板。提供实时速度图。在每个项目中提供多个视图，包括 Current、Ice Box、My Work。每张 JIRA 票证都可以是 PT 中的“故事”。每个故事都经历了 SDLC 的开始、完成、交付、接受/拒绝和拒绝阶段。每个故事都可以添加任务、评论、附件和上传文件。

**JIRA 工作流程** ![在此处输入图像描述](https://i.stack.imgur.com/tQxBy.png)

**关键跟踪器工作流程**

![在此处输入图像描述](https://i.stack.imgur.com/8V1Kw.jpg)

# .net - 针对 .NET Framework 3.5，使用 .NET 2.0 运行时。注意事项？

> ID：140239
> 
> 赞同：5
> 
> 时间：2008-09-26T15:30:54.783
> 
> 标签：.net, .net-3.5

我正在开发一个针对 .NET 3.5 Framework 的应用程序。应用程序的安装程序在目标机器上安装 .NET **2.0**运行时。到目前为止，我这样做没有任何问题，但我想知道我会遇到什么问题。我*需要*安装**3.5**运行时吗？

我必须将 .NET 运行时安装程序打包到我们的安装中（无网络安装）。运行时安装程序的大小是问题所在。.NET 2.0 运行时安装程序为 23MB（可管理），.NET 3.0 运行时安装程序为 50MB（变大），.NET 3.5 运行时安装程序为 200MB（哎呀！）。那些额外的 170MB 到底是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:35:50.713

这是一个很难回答的问题，因为最终它取决于您使用的 .NET 3.5 功能。如果您正在使用一些新的库，例如 LINQ，那么是的，您需要安装 3.5 运行时。但是，如果您只是使用 3.5 中引入的一些新的语法糖，您可能不会。这样做的原因是 .NET 3.5 与 2.0 CLR 100% 兼容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T15:36:13.070

如果它是一个不使用 asp.net 等的客户端应用程序，您可以使用更小（c. 26MB）的 .Net 客户端配置文件安装 - 更多详细信息，请访问：

[http://blogs.msdn.com/bclteam/archive/2008/05/21/net-framework-client-profile-justin-van-patten.aspx](http://blogs.msdn.com/bclteam/archive/2008/05/21/net-framework-client-profile-justin-van-patten.aspx)

[http://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx](http://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:37:20.133

如果您引用的是 3.5 特定库，例如 System.Core 或 System.Xml.Linq，那么您需要发布 3.5。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T15:45:08.837

3.5 SP1 和 3.5（无 sp）之间的数据集生成的代码部分存在一些差异，这与序列化有关。如果您将安装升级到 3.5SP1，即使在核心功能中，您也可能会遇到问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T12:56:36.357

.NET 3.5 与 .NET 2.0 并非 100% 兼容，而是与 .NET 2.0 SP1 兼容。

但我不知道这是否会给你带来任何问题。据说 .NET 2.0 SP1 更新是为了使扩展方法和自动属性可用（不记得具体细节）。

Scott Hanselman 对此有一篇[很好的博客文章](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)。

至于 .NET 3.5 可部署文件的大小，它是 .NET 2.0、3.0 和 3.5 对于 x86、x64 和其他 64 位架构在一个大文件中。

# javascript - Trace Trees 对 Javascript 性能的改进是否会应用到其他解释语言中？

> ID：140241
> 
> 赞同：7
> 
> 时间：2008-09-26T15:30:58.183
> 
> 标签：javascript, performance, compiler-construction, interpreter

听起来 Mozilla 使用[TraceMonkey](http://weblogs.mozillazine.org/roadmap/archives/2008/08/tracemonkey_javascript_lightsp.html)提高 JavaScript 性能很幸运。另请参阅 Andreas Gal[关于 Trace Trees 的论文](http://www.ics.uci.edu/~franz/Site/pubs-pdf/ICS-TR-06-16.pdf)。

其他解释器/编译器是否可以使用这些改进？如果可以，这是否意味着我们将看到其他解释语言的一系列改进？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-28T07:22:37.980

Andreas Gal 有一个名为[HotPath](http://HotPath.Org/)的研究 JVM ，他的团队中的一些人目前正致力于将基于嵌套跟踪树的 JITting 添加到[Maxine](http://Research.Sun.Com/projects/maxine/)（Sun 用 Ja​​va 编写的新研究 JVM）和 HotSpot。因此，至少它也出现在其他语言的其他虚拟机中。

此外，新的[PyPy](http://PyPy.Org/) JIT 编译器（目前在 Prolog 中作为原型）使用了某种跟踪技术，尽管我不知道这与 Gal/Franz 样式的嵌套跟踪树有多密切相关。

[Rubinius](http://Rubini.us/)的人肯定知道这项工作，并且非常愿意进行实验。如果一些高级编译技术很快出现在那里，我不会感到惊讶。

顺便说一句：有一个用 JavaScript 编写的 Ruby VM，称为[HotRuby](http://HotRuby.Accelart.Jp/)。如果您在 TraceMonkey 上运行它，您将免费获得基于跟踪树的 Ruby :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T18:54:40.813

唯一可能的答案是：**希望！**

# linux - 如何模拟 ext3 文件系统损坏？

> ID：140253
> 
> 赞同：16
> 
> 时间：2008-09-26T15:32:48.303
> 
> 标签：linux, testing, filesystems, fault-tolerance, ext3

我想模拟文件系统损坏，以测试我们的嵌入式系统如何对其做出反应，并最终让它们尽可能优雅地失败。我们使用不同类型的块设备模拟闪存来存储经常修改且不适合存储在 NAND/NOR 中的数据。

因为我非常清楚文件树不同部分中数据的修改频率以及敏感数据的存储位置。我想在特定区域注入错误，而不仅仅是随机注入。

在紧急情况下，我们将`fsck -y`其用作最后的手段，以尝试启动系统并报告处于非常糟糕的状态。我非常想引起错误，这些错误会触发 fsck 尝试修复，以研究对系统恢复能力的影响。

`dd if=/dev/random`对于我的目的来说不够精确，因为它不能轻易地用于注入受控错误。是否有任何其他工具或方法更适合我的需求，还是我必须自己发明？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T16:05:13.077

如果您已经知道要修改什么，dd 可以读取包含您要写入的字节的文件，并告诉它在哪里写入它们。

要弄清楚在哪里写，e2fsprogs 包中的 debugfs 可以帮助你。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-09-14T19:45:02.033

应该可以使用 Linux 文件系统映像模糊器来导致损坏：

*   [来自 e2fsprogs 的 e2fuzz](http://git.kernel.org/cgit/fs/ext2/e2fsprogs.git/tree/misc)
*   [http://people.redhat.com/sgrubb/files/fsfuzzer-0.7.ta​​r.gz](http://people.redhat.com/sgrubb/files/fsfuzzer-0.7.tar.gz)
*   [http://projects.info-pull.com/mokb/fsfuzzer-0.6.tgz](http://projects.info-pull.com/mokb/fsfuzzer-0.6.tgz)
*   [http://www.cccmz.de/~snakebyte/fsfuzzer-0.6-lmh2.tar.bz2](http://www.cccmz.de/~snakebyte/fsfuzzer-0.6-lmh2.tar.bz2)
*   [http://thread.gmane.org/gmane.comp.file-systems.ext4/32167](http://thread.gmane.org/gmane.comp.file-systems.ext4/32167)（使用 zzuf）

[或https://unix.stackexchange.com/a/144200](https://unix.stackexchange.com/a/144200)中描述的一种 Linux 磁盘故障注入技术（例如损坏模式下的 dm-flakey）。

# c# - 有没有办法从 WCF REST 方法返回不同的类型？

> ID：140255
> 
> 赞同：6
> 
> 时间：2008-09-26T15:32:58.317
> 
> 标签：c#, .net, wcf, rest

我正在尝试编写一个符合规范的 Web 服务，它需要不同的响应主体，具体取决于方法是否成功完成。我尝试创建两个不同的 DataContract 类，但是如何返回它们并正确序列化它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:45:34.153

指示您的 WCF Web 服务失败的最佳方法是引发 FaultException。您的服务 web.config 文件中有一些设置允许将整个故障消息作为错误的一部分传递给客户端。

另一种方法可能是从同一个基类或接口继承两个结果。该服务将返回基本类型的实例。然后，您可以使用 KnownType 属性通知客户端可能会返回多种类型。想一想，也许可以使用 Object 作为基本类型，但我还没有尝试过。

如果这些方法中的任何一种都失败，您可以创建一个包含结果和错误属性的自定义结果对象，然后您的客户可以决定采取哪种行动。我不得不对 Silverlight 2 使用这种方法，因为 Beta 2 还没有完全支持故障契约。它不漂亮，我通常不会推荐它，但如果它是唯一有效的方法，或者你认为它是适合你情况的最佳方法......

如果您在使用 ADO.NET 数据服务时遇到问题，我在这方面的经验较少。

以下是有关实施 FaultContracts[的一些信息](http://bloggingabout.net/blogs/jpsmit/archive/2007/03/21/wcf-fault-contracts.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T17:12:34.303

答案是**肯定**的，但它很棘手，而且你在界面上失去了强输入。如果您返回**Stream**，则数据可以是 xml、文本，甚至是二进制图像。对于 DataContract 类，您将使用**DataContractSerializer**序列化数据。

有关更多详细信息，请参阅[BlogSvc](http://codeplex.com/blogsvc)，更具体地说是[**RestAtomPubService.cs** WCF 服务](http://blogsvc.codeplex.com/SourceControl/changeset/22604#Main/Source/Services/AtomPub/RestAtomPubService.cs)。请注意，该源代码还将向您展示如何将不同类型的数据接受到需要内容类型映射器的 WCF 休息方法中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T15:42:59.917

如果您使用的是基于 xml 的绑定，那么我相信没有办法做到这一点。在这种情况下，一个简单的解决方案是在出现故障时只保留部分消息标志，并在需要时将故障信息存储在某处。对于 JSON 绑定，您可以使用返回对象的方法，然后返回两种不同类型的对象。如果我没记错（这很少见），那是可能的，因为如果对象没有序列化属性，JavaScriptSerializer 类会使用反射。

# c# - 在 Windows 服务中捕获“插入外部驱动器”事件

> ID：140287
> 
> 赞同：3
> 
> 时间：2008-09-26T15:36:33.100
> 
> 标签：c#, .net, windows, windows-services, podcast

我正在尝试编写一个超级简单的播客到设备下载服务来运行。我想它会是这样的：

每当插入特定设备（通过 USB）时，它：

*   从设备中删除所有内容
*   检查许多 RSS 播客提要中的所有最新条目
*   将这些下载到设备
*   通知用户何时完成。

我在 Windows 服务方面有过一些经验，但我不确定如何（使用 .NET/C#）捕获“媒体设备/USB 硬盘已插入”事件。有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:38:51.393

最简单的解决方案是定期枚举设备！

CodeProject 在这里有一篇全面的 C# 文章：http: [//www.codeproject.com/KB/system/DriveDetector.aspx](http://www.codeproject.com/KB/system/DriveDetector.aspx)

# python - 在嵌入式 Python 中使用 locale.setlocale 而不会破坏 C 线程中的文件解析

> ID：140295
> 
> 赞同：3
> 
> 时间：2008-09-26T15:38:00.273
> 
> 标签：python, internationalization, locale

我们正在使用第三方中间件产品，它允许我们在嵌入式 Python 解释器中编写代码，并公开一个我们可以调用的 API。其中一些 API 调用允许我们加载各种文件，加载代码是用 C 实现的。文件加载发生在单独的线程中，并在数据可用时回调到 Python。到目前为止，一切都很好。

我们一直在 i14ing (heh) 我们的产品，我们想做的一件事是根据用户的区域设置格式化面向用户的数字输出。因此，从 Python 中，我们这样做：

```
import locale
locale.setLocale( locale.LC_ALL, '' ) 
```

现在，这可行（因为面向用户的数字已针对其区域设置正确格式化）。但是，如果用户的语言环境与默认的 C 语言环境不同，随后加载的任何文件都将返回不正确的数据，这可能是因为所有字符串到浮点数的转换都受到了影响，一直到金属。

我们无法通过实现区域设置感知文件加载来解决此问题，因此我们当前的解决方法是仅在为用户格式化输出时设置区域设置，然后再将其重新设置。也就是说，类似：

```
import locale
currentLocale = locale.getLocale( locale.LC_ALL )
locale.setLocale( locale.LC_ALL, '' )
displayNumbersToTheUser()
locale.setlocale( locale.LC_ALL, currentLocale ) 
```

这似乎有点笨拙，我想知道这是否是为用户格式化区域设置感知输出的常用方法？我的另一个担忧是这显然不是线程安全的，所以如果在更改语言环境时在单独的线程中发生任何文件解析，我们可能仍然会遇到问题。

任何有关最佳实践的信息都值得赞赏 - 我对这类事情没有太多经验。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T02:42:40.407

在多个线程开始运行后设置语言环境可能会产生意想不到的结果。除非我能想出更巧妙的方法，否则我可能只是将文件加载和用户界面拆分为单独的进程，通过管道或文件套接字进行通信。

# asp.net - ASP.NET：无法验证数据

> ID：140303
> 
> 赞同：10
> 
> 时间：2008-09-26T15:39:30.893
> 
> 标签：asp.net, validation, exception, viewstate

ASP.NET 中此异常的原因是什么？显然这是一个视图状态异常，但我无法在引发异常的页面上重现错误（一个简单的两个 TextBox 表单，带有一个按钮和导航链接）。

FWIW，我没有运行网络农场。

## 例外

> 错误消息：无法验证数据。
> 
> 错误来源：System.Web
> 
> 错误目标站点：Byte[] GetDecodedData(Byte[], Byte[], Int32, Int32, Int32 ByRef)

## 发布数据

> *观点：*
> 
> /wEPDwULLTE4NTUyODcyMTFkZF96FHxDUAHIY3NOAMRJYZ+CKsnB
> 
> *事件验证：*
> 
> /wEWBAK+8ZzHAgKOhZRcApDF79ECAoLch4YMeQ2ayv/Gi76znHooiRyBFrWtwyg=

## 异常堆栈跟踪

```
 at System.Web.UI.ViewStateException.ThrowError(Exception inner, String persistedState, String errorPageMessage, Boolean macValidationError)
   at System.Web.UI.ObjectStateFormatter.Deserialize(String inputString)
   at System.Web.UI.ObjectStateFormatter.System.Web.UI.IStateFormatter.Deserialize(String serializedState)
   at System.Web.UI.Util.DeserializeWithAssert(IStateFormatter formatter, String serializedState)
   at System.Web.UI.HiddenFieldPageStatePersister.Load()
   at System.Web.UI.Page.LoadPageStateFromPersistenceMedium()
   at System.Web.UI.Page.LoadAllState()
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest()
   at System.Web.UI.Page.ProcessRequestWithNoAssert(HttpContext context)
   at System.Web.UI.Page.ProcessRequest(HttpContext context)
   at ASP.default_aspx.ProcessRequest(HttpContext context)
   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) 
```

~ 威廉·莱利-兰德

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T16:21:46.500

此错误的最可能原因是在所有视图状态加载之前停止回发（用户点击停止或返回按钮），视图状态将无法验证并抛出错误。

其他潜在原因：

*   从生成视图状态到用户将其发布回服务器（不太可能）之间的应用程序池回收。
*   machineKeys 未同步的网络场（不是您的问题）。

更新：[关于该问题的 Microsoft 文章](http://support.microsoft.com/default.aspx?scid=kb;en-us;555353)。除了上述之外，他们还提出了另外两个潜在的原因：

*   通过防火墙/防病毒软件修改视图状态
*   从一个 aspx 页面发布到另一个页面。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-31T19:08:29.953

在 .NET 3.5 SP1 中，*RenderAllHiddenFieldsAtTopOfForm*属性被添加到 PagesSection 配置中。

**网页配置**

```
<configuration>

    <system.web>

        <pages renderAllHiddenFieldsAtTopOfForm="true"></pages>

    </system.web>

</configuration> 
```

有趣的是，它的默认值为 true。因此，从本质上讲，如果您使用的是 .NET 3.5 SP1，那么 ViewState 会自动呈现在表单顶部（在加载页面的其余部分之前），从而消除您遇到的 ViewState 错误。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-26T17:00:59.870

我遇到了某些特定版本的 Safari 3 的问题。我的解决方案是将 ViewState 移动到表单的顶部（扩展了 Page 类并覆盖了 pre-3.5 SP1 或 .Net 3.5 SP1 及更高版本的 Render 方法默认情况下这样做），并将 ViewState 拆分为几个不同的字段而不是一个怪物文件。*请参阅[ASP.NET 2.0 中的 ViewState 分块 (maxPageStateFieldLength)](http://weblogs.asp.net/lduveau/archive/2007/04/17/viewstate-chunking-in-asp-net-2-0-maxpagestatefieldlength.aspx)*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-08-23T03:31:49.597

这个免费的在线工具：[http](http://aspnetresources.com/tools/machineKey) ://aspnetresources.com/tools/machineKey 在 web.config 文件的 system.web 元素下生成一个 machineKey 元素。这是它生成的示例：

```
<machineKey validationKey="1619AB2FDEE6B943AD5D31DD68B7EBDAB32682A5891481D9403A6A55C4F91A340131CB4F4AD26A686DF5911A6C05CAC89307663656B62BE304EA66605156E9B5" decryptionKey="C9D165260E6A697B2993D45E05BD64386445DE01031B790A60F229F6A2656ECF" validation="SHA1" decryption="AES" /> 
```

* * *

一旦您在 web.config 中看到这一点，错误本身就会突然变得有意义。你得到的错误说

> “确保配置指定相同的验证密钥和验证算法”。

当你看到这个 machineKey 元素时，你会突然明白它在说什么。

* * *

通过在 web.config 中“硬编码”这个值，asp.net 用于序列化和反序列化视图状态的键保持不变，无论服务器场中的哪个服务器选择它。您的加密变得“便携”，因此您的视图状态变得“便携”。

我也只是猜测，如果由于任何原因它“忘记”了它所拥有的密钥，可能是*同一台服务器*（不在场中）有这个问题，因为任何级别的重置都会将其清除。这也许就是您在空闲期后看到此错误并尝试使用“陈旧”页面的原因。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T19:27:36.977

> “在所有视图状态加载之前停止回发”

我以前遇到过这个确切的问题，这就是原因。

最初我们禁用 ViewStateMac 属性（`enableViewStateMac="false"`在`page`指令中）来解决它，但这并不是问题的真正解决方案，并且可能会威胁数据完整性。我们最终通过禁用我们的提交按钮直到页面完全加载来解决它，并通过在某些控件上禁用它来修剪我们的视图状态的大小。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-06-03T04:21:36.377

我在我的网站上找到了这个问题的根源，我终于设法**解决**了它。这不是您问题的直接答案，但我想分享这一点信息。

过去我尝试了所有方法（包括上面 Jeffaxe 提出的解决方案），但没有结果，我不想设置`enableViewStateMac="false"`（如上面 Raelshark 所述）到我的页面，因为这只是隐藏了问题。

是什么导致了我的问题？该问题是由于在我网站的某些页面中使用了**Intelligencia.UrlRewriter （版本 2.0 RC 1 build 6）模块引起的。**我使用了一些 SEO 友好的链接，这导致了 ViewState 验证失败。当我使用“普通”链接（而不是对 SEO 友好的链接）时，问题就消失了！

我多次重现该问题以确保它不是误报（我使用 ASP.NET 3.5）。

我知道你们中的一些人可能没有使用上面的模块，仍然得到这个错误，这意味着原因是别的。至少，分享这种经验可能对某些人有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-02T21:07:54.483

当我在页面上设置了一个没有操作属性的表单标记时出现此错误，然后在代码隐藏中，我将表单的操作属性更改为“Action.aspx”。

在 JavaScript 中，我提交了表单 (theForm.submit();)

我认为在我的情况下这是一个安全问题，并且在页面上已经设置后您无法更改它......？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-01-11T13:52:10.660

不确定这是否会对任何人有所帮助，但我的解决方案是在我的 webconfig 中排除 machineKey 以让我的 cookie 获得通过。

# visual-studio - How to prevent Visual Studio 2008 from expanding excluded folders when opening solution?

> ID：140313
> 
> 赞同：2
> 
> 时间：2008-09-26T15:41:01.683
> 
> 标签：visual-studio

We just migrated to Visual Studio 2008 from 2005\. Now whenever I open our project solution the solution explorer auto expands every directory that is excluded or contains an excluded file.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T15:44:30.367

我不确定它为什么会展开每个排除的项目，但您可以单击解决方案资源管理器顶部的“显示所有文件”图标，这将切换它是否显示隐藏/排除的项目。

# c# - 用户会话到期时如何重定向到页面？

> ID：140329
> 
> 赞同：12
> 
> 时间：2008-09-26T15:44:19.540
> 
> 标签：c#, asp.net

我目前正在开发一个使用 ASP.NET 2.0 框架的 Web 应用程序。当用户会话过期时，我需要重定向到某个页面，比如 SessionExpired.aspx。项目中有很多页面，因此在站点的每个页面中添加代码并不是一个好的解决方案。不过，我有 MasterPages，我认为这可能会有所帮助。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T16:00:26.240

当用户“登录”时，我通常会在母版页上的 Page.Header.Controls 集合中添加一个 HtmlMeta 控件。将其设置为刷新到具有适当超时长度的 SessionExpired.aspx 页面，一切顺利。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T17:27:22.240

您可以在 Session_Start 事件中的 global.asax 中处理此问题。您可以在那里检查请求中的会话 cookie。如果会话 cookie 存在，则会话已过期：

```
 public void Session_OnStart()
    {
        if (HttpContext.Current.Request.Cookies.Contains("ASP.NET_SessionId") != null)
        {
            HttpContext.Current.Response.Redirect("SessionTimeout.aspx")
        }

    } 
```

唉，我还没有找到任何优雅的方法来找出会话 cookie 的名称。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T16:07:31.683

如果我理解正确，“Session_End”会在内部触发并且没有与之关联的 HTTP 上下文：

[http://forums.asp.net/t/1271309.aspx](http://forums.asp.net/t/1271309.aspx)

因此，我认为您不能使用它来重定向用户。我看到其他人建议在 global.ascx 文件中使用“Session_OnStart()”事件：

[http://forums.asp.net/p/1083259/1606991.aspx](http://forums.asp.net/p/1083259/1606991.aspx)

我没有尝试过，但将以下代码放入“global.ascx”可能对您有用：

```
void Session_OnStart() {
    if (Session.IsNewSession == false )
    {
    }
    else 
    {
        Server.Transfer("SessionExpired.aspx", False);
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T17:25:48.173

我们使用Forms Authentication，在Page_Load方法中调用这个方法

```
private bool IsValidSession()
    {
        bool isValidSession = true;
        if (Context.Session != null)
        {
            if (Session.IsNewSession)
            {
                string cookieHeader = Request.Headers["Cookie"];
                if ((null != cookieHeader) && (cookieHeader.IndexOf("ASP.NET_SessionId") >= 0))
                {
                    isValidSession = false;
                    if (User.Identity.IsAuthenticated)
                        FormsAuthentication.SignOut();
                    FormsAuthentication.RedirectToLoginPage();
                }
            }
        }
        return isValidSession;
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T16:04:41.377

另一种方法是告诉浏览器在一定时间后重定向自身（通过javascript）......但这总是可以被用户禁用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T17:06:02.433

当会话过期时，您无法重定向用户，因为没有浏览器请求重定向：

*   如果用户在会话超时（默认为 20 分钟）内访问您的站点，则会话尚未结束，因此您无需重定向他们。
*   如果用户在会话超时后访问您的站点，则会话已经结束。这意味着它们将在新会话的上下文中 - Session_OnEnd 已经为旧会话触发，而您将获得新会话的 Session_OnStart。

因此，除了客户端功能（例如 JavaScript 计时器等）之外，您还需要在 Session_OnStart 中处理重定向 - 但显然您需要将其与重新访问该站点的人区分开来。一种选择是在会话开始时设置会话 cookie（即没有过期的 cookie，因此它只会持续到浏览器关闭），然后在 Session_OnStart 中查找该 cookie - 如果它存在，则它是一个过期的返回用户会话，如果不是，它是一个新用户。

显然，您仍然可以使用 Session_OnEnd 在服务器端进行整理——这只是您无法使用的客户端交互。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T17:06:26.347

您是否在 Session 对象中放置了应该始终存在的东西？换句话说，如果他们登录，您可能会在会话中放入类似 UserID 的内容

```
Session("UserID") = 1234 
```

因此，如果是这种情况，那么您可以在母版页中的代码隐藏中添加一些内容来检查该值。像这样的东西：

```
Dim UserID As Integer = 0
Integer.TryParse(Session("UserID"), UserID)

If UserID = 0 Then
  Response.Redirect("/sessionExpired.aspx")
End If 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-04-27T03:35:58.443

您还可以查看以下链接中提供的解决方案

[在 ASP.NET 中检测会话超时并重定向到登录页面](http://csharpdotnetfreak.blogspot.com/2008/11/detecting-session-timeout-and-redirect.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T16:05:58.800

添加或更新您的 Web.Config 文件以包含以下内容或类似内容：

```
<customErrors defaultRedirect="url" mode="RemoteOnly">
    <error statusCode="408" redirect="~/SessionExpired.aspx"/>
</customErrors> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T18:01:03.937

您是否希望在没有用户干预的情况下重定向下一个请求或立即重定向？如果您希望在没有用户干预的情况下进行重定向，那么您可以在母版页上使用 ClientScript.RegisterStartupScript 来注入一些 javascript，以便在会话到期时重定向您的客户端。

```
 System.Text.StringBuilder sb = new System.Text.StringBuilder();
    String timeoutPage = "SessionExpired.aspx"; // your page here
    int timeoutPeriod = Session.Timeout * 60 * 1000;

    sb.AppendFormat("setTimeout(\"location.href = {0};\",{1});", timeoutPage, timeoutPeriod);
    Page.ClientScript.RegisterStartupScript(this.GetType(), "timeourRedirect", sb.ToString(), true); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-14T20:34:54.247

[来自这里的代码](http://www.eggheadcafe.com/articles/20051228.asp)

```
namespace PAB.WebControls 
```

{ 使用系统；使用 System.ComponentModel；使用 System.Web；使用 System.Web.Security；使用 System.Web.UI；

```
[DefaultProperty("Text"),

    ToolboxData("<{0}:SessionTimeoutControl runat=server></{0}:SessionTimeoutControl>")]

public class SessionTimeoutControl : Control
{
    private string _redirectUrl;

    [Bindable(true),
        Category("Appearance"),
        DefaultValue("")]
    public string RedirectUrl
    {
        get { return _redirectUrl; }

        set { _redirectUrl = value; }
    }

    public override bool Visible
    {
        get { return false; }

    }

    public override bool EnableViewState
    {
        get { return false; }
    }

    protected override void Render(HtmlTextWriter writer)
    {
        if (HttpContext.Current == null)

            writer.Write("[ *** SessionTimeout: " + this.ID + " *** ]");

        base.Render(writer);
    }

    protected override void OnPreRender(EventArgs e)
    {
        base.OnPreRender(e);

        if (this._redirectUrl == null)

            throw new InvalidOperationException("RedirectUrl Property Not Set.");

        if (Context.Session != null)
        {
            if (Context.Session.IsNewSession)
            {
                string sCookieHeader = Page.Request.Headers["Cookie"];

                if ((null != sCookieHeader) && (sCookieHeader.IndexOf("ASP.NET_SessionId") >= 0))
                {
                    if (Page.Request.IsAuthenticated)
                    {
                        FormsAuthentication.SignOut();
                    }

                    Page.Response.Redirect(this._redirectUrl);
                }
            }
        }
    }
} 
```

}

# .net - 实体框架中的可空实体投影

> ID：140331
> 
> 赞同：3
> 
> 时间：2008-09-26T15:44:33.657
> 
> 标签：.net, linq, entity-framework

我有以下 SQL Server 2005 数据库架构：

```
CREATE TABLE Messages (
   MessageID int,
   Subject varchar(500),
   Text varchar(max) NULL,
   UserID NULL
) 
```

“UserID”列 - 可以为空 - 是外键并链接到表

```
CREATE TABLE Users (
   UserID int,
   ...
) 
```

现在我有几个名称为 Message、User 等的 POCO 类，我在以下查询中使用它们：

```
public IList<Message> GetMessages(...) {
  var q = (from m in dataContext.Messages.Include("User")
           where ...
           select m); // could call ToList(), but...

  return (from m in q
          select new Message {
            ID = m.MessageID,
            User = new User {
              ID = m.User.UserID,
              FirstName = m.User.FirstName,
              ...
            }
          }).ToList();
} 
```

现在请注意，我建议实体框架 - 使用 Include("Users") - 加载与消息关联的用户（如果有）。另请注意，我没有在第一个 LINQ 语句之后调用 ToList() 。通过这样做，只有投影列表中的指定列——在本例中为 MessageID、UserID、FirstName——将从数据库中返回。

问题就在这里——一旦实体框架遇到 UserID == NULL 的消息，它就会抛出异常，说它无法转换为 Int32，因为 DB 值为 NULL。

如果我将最后几行更改为

```
return (from m in q
        select new Message {
           ID = m.MessageID,
           User = m.User == null ? null : new User {
              ID = m.User.UserID,
              ...
           }
        }).ToList() 
```

然后抛出运行时 NotSupportedException，告诉它不能创建常量用户类型，并且只支持 int、string、guid 等原语。

除了在第一条语句之后立即实现结果并在之后使用内存中投影之外，任何人都知道如何处理它？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T06:17:37.263

您忘记包含“消息”类的声明，但我怀疑该类中的 UserID 属性未声明为可为空的类型。如果是这种情况，请将其从“int”更改为“int？” （可为空的整数）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:55:39.077

我怀疑你们的关系不是一对一的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T16:05:48.910

既然你做了一个`.Include("Users")`你应该能够遍历对象`User`中的属性`Message`来获取你想要的信息。

# c++ - 如何在 C++ 中读取文件？

> ID：140337
> 
> 赞同：1
> 
> 时间：2008-09-26T15:45:22.970
> 
> 标签：c++, file-io

我在读取文件时遇到了一些问题。我有两个头文件：a 和 b。b 是从 a 派生的，c 是从 b 派生的。现在我想打开一个文本文件。

整个格式是这样的：

> 一个约翰
> 
> 约翰尼
> 
> 123

如果第一个字符是 'a' 并且 'p' 也在那里，则打印第二行，否则打印第一行。

```
#include "c.h"
#include <iostream>
# include <fstream>
using namespace std;
c :: c()
{
    ifstream input;
    input.open ("abc.txt");
    ch = input.get();
    input >> ch;
    if (ch ='A')
        a* z =new a();
    else 
    input.close();
} 
```

谁能给我一些关于如何做到这一点的建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T16:05:15.543

> > 如果第一个字符是 'a' 并且 'p' 也在那里，则打印第二行，否则打印第一行。

您能否根据您拥有的文本文件举例说明该程序的输出应该是什么样的？

不过，我确实注意到一件事：

```
if (ch ='A') 
```

将其更改为：

```
if (ch =='A') 
```

您需要使用两个 = 进行比较。

# c++ - Win32/MFC 从客户端矩形获取窗口矩形

> ID：140347
> 
> 赞同：2
> 
> 时间：2008-09-26T15:47:16.303
> 
> 标签：c++, windows, winapi, mfc

我知道某处有一个函数可以接受客户端矩形，它会为您将其转换为窗口矩形。我只是找不到/记得它！

有谁知道它是什么？

它会做类似的事情：

```
const CRect client(0, 0, 200, 200);
const CRect window = ClientRectToWindowRect(client);
SetWindowPos(...) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T15:51:39.240

你大概在想[`AdjustWindowRectEx()`](http://msdn.microsoft.com/en-us/library/ms632667(VS.85).aspx)。请记住，这是在*创建*窗口时使用的 - 不能保证它会为现有窗口生成一组准确的窗口尺寸；为此，使用[`GetWindowRect()`](http://msdn.microsoft.com/en-us/library/ms633519(VS.85).aspx).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T15:52:12.610

这是你想要的？

客户端到屏幕

[http://msdn.microsoft.com/en-us/library/ms532670(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms532670(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T00:41:32.680

如果要将客户端坐标映射到窗口坐标，请使用**ClientToWindow** API。

如果要将客户端坐标映射到屏幕坐标，请使用**ClientToScreen** API。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-08T19:37:10.443

对于控制重新定位使用：

```
RECT client;
::SetRect(&client, 0, 0, 200, 200);
::MapWindowPoints(hwndControl, ::GetParent(hwndControl), (POINT*)&client, 2);
::SetWindowPos(...) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-04-01T10:02:29.847

这将为您提供客户端坐标中的窗口矩形，因此您可以使用 rect(top,left) 作为偏移量

```
CRect rectFrame;
GetWindowRect(&rectFrame);
ScreenToClient(&rectFrame); 
```

# xml - 使用 XML 模式的优点和缺点是什么？

> ID：140355
> 
> 赞同：5
> 
> 时间：2008-09-26T15:48:46.860
> 
> 标签：xml, xsd

我们将 Microsoft SQL Server 2005 中的 XML 数据类型用于一个项目。团队的一些成员和我认为我们也应该使用 XSD，而其他阵营的成员则认为我们应该保持 XML 临时性而不是将它们视为“类型”。

XML 旨在为许多文本配置文件带来结构和中心性，而这些文本配置文件是维护的噩梦。

我们使用的是 .NET 3.5/C#，并且我们的表是用适当的数据类型设计的。我的论点是，我们已经在思考为什么要打破这种方法，因为它是 XML 的“面向类型”。最初的问题是由于缺少文本文件的类型。不使用“类型”方法会使我们面临同样的问题。

可能是我对 XML 模式的好处的理解不正确。那么使用 XML 模式的优缺点是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:54:58.937

在没有 XSD 的情况下保留 XML 存储库（在我看来）类似于拥有一个所有类型都声明为 VARCHAR(n) 的数据库。你不关心你得到什么样的输入，你只想要输入。

XSD 确保您的 XML 具有您期望的输入类型。它们为您的模型提供结构，正是您正在寻找的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T15:58:42.173

不幸的是，即使是 XSD (W3C) 的作者也明白 XSD 是一种非常糟糕的技术。也就是说，它的意图不一定是坏的。C# 的主要优点之一是它是静态类型的。静态键入您的 XML 文档给它们带来了同样的好处。这里最好的可能是对您的类进行逆向工程，以使用 XML 序列化属性生成 Schema。当您执行此操作时，C# 将为您的 XML 文件创建一个自定义数据读取器，这将显着提高性能。

XML 的最大成本之一是它必须进行字符串解析。您可以对 XML 文件（例如它们的结构）做出的假设越多，您的性能可能就越好。

因此，最终像许多事情一样，它们是否足以需要性能优势来证明开发人员时间的成本是合理的。或者是否有足够强烈的愿望使用静态类型系统来证明编写 XSD 的成本是合理的。

最终，您的项目需求将决定您应该做什么，但静态类型和性能是需要考虑的主要好处。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:04:58.867

好吧，正如其他帖子和问题中所说，XSD 将确保您在 XML 的正确位置使用正确的类型，并且在更改其结构之前必须三思而后行。

但是，如果我可以这么说的话，XSD 确实过于冗长了。有时它真的是一团糟，描述一个复杂的结构，有条件的内容。

希望 XSD 不是验证 XML 的唯一方法，更简单的方法是使用[RelaxNG](http://relaxng.org/)，尤其是它的紧凑语法，它比您想象的 XSD 更具可读性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T15:59:10.253

使用模式的一大优势是它有助于确保项目中的每个人都同意 XML 文档的布局方式。此外，通过使用模式，您可以在 XML 解析器中启用验证，从而更容易判断某些代码何时失败，因为它给出了一些错误的 XML。

不利的一面是，维护模式可能会很痛苦，并且根据您的项目可能不值得付出努力。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T15:59:36.600

如果您没有架构，您最终将自己重新实现所有验证（或根本不验证并在无效输入上崩溃）。XSD 解析器/验证器为您完成所有这些工作，并由其领域的专家进行优化和调试。你为什么要自己重做所有这些工作？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T16:07:44.380

XSD 不是唯一可用的 XML 模式。请改用 http://relaxng.org/。RelaxNG 让您可以用 XML 表达模式，而不是像 XSD 那样需要学习另一种数据“语言”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-15T07:18:18.527

开发 XML 的一个重要原因是它允许以更多方式使用来自更多来源的数据，因为它已成为在任意数量的计算机系统之间交换数据的广泛接受的标准。

# data-protection - 数据保护和 Web 2.0 网站

> ID：140365
> 
> 赞同：4
> 
> 时间：2008-09-26T15:50:03.533
> 
> 标签：data-protection

许多国家现在都有数据保护立法，赋予个人以下权利：

1.  要求组织交出他们持有的有关个人的所有信息，并且
2.  要求销毁有关个人的任何信息

[Facebook 在英国的第二部分遇到了麻烦，](http://www.channel4.com/news/articles/science_technology/facebook%20data%20protection%20row/1060467)因为几乎不可能从 Facebook 删除您的信息。

这是可以理解的。社交媒体网站中的个人数据错综复杂地编织到网站的结构中。用户生成帖子、消息、聊天、与他人的关系、照片、应用程序等，然后其他人将在此内容上添加他们自己的评论/想法。

但是，我不相信仅仅在您的条款和条件中声明您的数据不能被删除符合数据保护立法（至少在英国 - 任何编程律师都想发表评论？）。

我们倾向于通过覆盖用户记录中的关键字段（例如用户名、姓名、电子邮件地址）和覆盖他们发布的内容（例如评论、博客文章）中的关键字段来处理删除用户内容的问题。这意味着您可能会遇到归因于“已删除用户”的讨论帖子，内容为“此帖子已被删除”。

数据保护问题甚至会影响托管等决策（出于数据保护的原因，我们倾向于在英国为许多客户托管应用程序，尽管成本较高）。

作为开发人员，这是我的问题多远？我有一种感觉，责任最终将落在申请的合法所有者（我的客户/雇主）身上，如果他们犯了这个错误，他们会因为我的公司没有给予适当的考虑而追究他们的责任。

我对你的问题是：

1.  您如何处理从数据保护合规性成为问题的社交媒体应用程序中删除内容的问题？
2.  这最终是谁的责任？
3.  我应该放松一下，不那么关心这些问题吗？

编辑：对 2 和 3 已经有了一些很好的答案，但主要问题是什么？您如何处理从与许多其他内容相关联的复杂社交媒体应用程序中删除用户的内容

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T16:04:37.743

声明不能删除数据肯定不符合欧盟数据保护法；我们有权要求删除并要求不共享；基本上我们可以预期数据是

*   公平和合法地处理， - 为特定目的而处理，并且不以任何与这些目的不相容的方式，
*   充分、相关且不过分，
*   准确的，
*   保存时间不超过必要的时间，
*   根据个人的合法权利进行处理，
*   妥善保管，
*   转移到欧洲经济区以外的国家，前提是个人的权利可以得到保障。

因此，当用户关闭他的帐户时不删除可能违反了“保留时间超过必要”的规定。

责任在于数据控制者；收集和处理数据的公司。如果您不参与系统的日常运行，如果您已将其出售给客户并且他们管理系统，那么这是他们的问题。

你应该轻点吗？那是主观的；就个人而言，在英国，我会考虑这些事情；因为隐私很重要，无论任何商业方面。

要解决您关于从社交网络应用程序中删除的问题，这根本不重要。无论应用程序本身如何，都必须删除数据。现在问题出在个人信息上，因此您可能会认为它只是姓名、出生日期等；但是，如果评论泄露了可识别的信息怎么办？这有点像雷区。最安全的选择是简单地用核武器摧毁一切。此外，由于在网络上显示信息意味着它可能/将被转移到欧盟以外，因此您应该在用户注册时获得明确许可，英国信息专员有[指导方针](http://www.ico.gov.uk/upload/documents/library/data_protection/practical_application/collecting_personal_information_from_websites_v1.0.pdf)

*插入标准我不是律师，这不是法律建议免责声明*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T16:13:28.050

Blowdart 的回答很棒，尽管我想知道本质上与不止一个人相关的数据——比如 Facebook 消息或墙上的帖子。甚至是包含多人姓名的 PDF 文件——如果其中一个人要求删除信息怎么办？我想你会被允许保留这些数据。

无论如何，这不是我的答案。我的回答是关于“谁负责”的问题。虽然数据控制者（您的客户）根据法律确实负有责任，但您作为专业顾问可能对他们负有责任。因此，如果他们被起诉，他们可能会因您提供不完整或错误的建议而要求您赔偿。

我建议您让他们了解立法，建议他们找律师（周围有很多擅长信息法的优秀律师），并以书面形式提出。您将为客户提供服务并同时保护自己。

如果您正在托管应用程序，那么位置可能会略有不同 - 根据数据保护法有一个“局”注册，这可能适合这里，但无论如何您可能应该自己采取一些法律建议。

这些都不可能适用于您作为雇员，但它可能适用于您作为供应商的雇主。

# algorithm - 如何以编程方式确定如何将较小的盒子装入较大的包装中？

> ID：140406
> 
> 赞同：49
> 
> 时间：2008-09-26T16:03:10.913
> 
> 标签：algorithm, bin-packing

有谁知道现有的软件或算法来计算运送多件物品的包裹大小？

我在我们的库存数据库中有一堆项目，定义了长度、宽度和高度尺寸。鉴于这些尺寸，我需要计算有多少购买的物品适合预定义的盒子尺寸。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-26T16:07:35.270

这是一个[装箱](http://en.wikipedia.org/wiki/Bin_packing_problem)问题，它是 NP 难的。对于少量的对象和包，您也许可以简单地使用蛮力方法来尝试每一种可能性。除此之外，您还需要使用某种启发式方法。Wikipedia 文章有一些详细信息，以及对您可能想要查看的论文的引用。

当然，另一种选择是从一个非常简单的算法开始（例如简单地“堆叠”物品）并使用它计算一个合理的运输上限，然后如果您的人工包装员可以做得更好，您可以获得微薄的利润。或者假设您的包装不理想，稍微打折您的计算价格。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-09-10T21:18:34.277

关于“3D Bin 包装”的文献非常广泛。[您可以通过跟踪David Pisinger 教授](http://www.diku.dk/hjemmesider/ansatte/pisinger/publications/sort_date.html)的出版物来获得一个很好的概览。他还发布了为数不多的带有源代码的 bin 打包的高质量实现之一：[3dbpp.c](http://www.diku.dk/hjemmesider/ansatte/pisinger/3dbpp.c)

我自己的物流工具包[pyShipping](http://github.com/hudora/pyShipping/blob/master/pyshipping/binpack_simple.py)带有用于仓储应用程序的 3D Bin Packing 实现。它基本上实现了 4D 装箱（3D 尺寸和重量），并在第二个运行时间内获得了典型订单尺寸（几十个包装）的可接受解决方案。它现在在生产（即仓库）中使用了几个月，以确定要使用的运输板条箱的上限。仓库工人通常能够更有效率地打包，但这对我来说没问题。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-07-22T20:06:17.247

Pisinger 是为数不多的发布[工作代码](http://www.diku.dk/~pisinger/codes.html)的学者之一。在他的一篇论文中，他提到了“最小深度”问题。

这是一种实用且[高效](http://www.zahidgurbuz.com/yayinlar/An%20Efficient%20Algorithm%20for%203D%20Rectangular%20Box%20Packing.pdf)的 3D 矩形盒包装算法，可调整封闭盒的高度。

这是[php](https://github.com/mdeboer/php-laff)中的一个实现。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T16:10:09.197

您是想查看有多少单一类型适合特定大小的包装，还是尝试混合类型？

听起来您正在尝试解决[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)。您也许可以找到一些适合您特定要求的算法。只需了解很难找到*有效*的算法，因为问题是 NP 完全的（尽管根据您的具体要求，您可能能够找到有效的近似值，或者您的输入可能足够小以至于没关系） .

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T16:37:21.850

如果要手工包装盒子，那么您可能会考虑编写一个算法，该算法将做一个*合理*的人会做的事情。我建议这样做的原因是，除非您想为每个订单打印出包装说明，否则无论谁在为您打包，都将不得不考虑如何将订购的物品放入已分配给该订单的多个盒子中。命令。

然后，这可能会导致您的人工包装员来到 SO 询问如何以编程方式锻炼如何将 n 个项目打包到 m 个盒子中。:-P（他们也可能会要求*您*这样做，请您提供指示等）。

只要你的算法能做一个理性的人会做的事情，我个人会接受它的运费估计。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-27T16:58:18.140

当存在许多包和/或许多约束时，元启发式方法可以很好地处理现实世界的装箱问题。一种开源 Java 实现是[Drools Planner](http://www.jboss.org/drools/drools-planner)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-27T14:04:02.877

也许这听起来很明显，但记住问题可能是值得的，然后手工完成其中一些。为 NP-hard 中的任意输入和框找到最有效的解决方案，但通过限制问题空间并接受一些低效率，NP 大小可能是合理的，通过记忆，您可能能够带来“常见情况“时间大大减少。

从分层包装的角度考虑问题也可能会有所帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-09-12T09:40:13.500

经过大量搜索，我找到了一个可能对某人有帮助的[GitHub存储库。](https://github.com/davidmchapman/3DContainerPacking)函数`PackingService.Pack()`将要打包的 (s) 列表`Container`和列表`Item`作为参数并返回包含大量信息的结果，包括

“按百分比包装的容器以及已包装和未包装物品的清单”

# version-control - 为什么要避免版本控制系统中的悲观锁定？

> ID：140409
> 
> 赞同：14
> 
> 时间：2008-09-26T16:04:03.110
> 
> 标签：version-control, locking

根据我读过的一些关于版本控制的帖子，似乎人们认为版本控制系统中的悲观锁定是一件坏事。为什么？我知道它会阻止一个开发人员提交更改，而另一个开发人员已签出文件，但那又如何呢？如果你的代码文件太大以至于你经常有不止一个人同时处理它们，我认为你应该重新组织你的代码。将其分解为更小的功能单元。

并发代码更改的集成是一个乏味且容易出错的过程，即使使用良好的版本控制系统提供的工具来简化它也是如此。我认为应该尽可能避免。那么，为什么不鼓励悲观锁定呢？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T16:08:27.873

1.  去玩 Source Safe，让开发人员休假两周。再加上 VSS 管理员不在身边。现在你有一个修复要发布但你不能因为开发人员
2.  如果您正在处理多个功能和/或错误修复。无论您的代码被分解得多么小，您仍然会争用中央文件。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T16:17:18.803

这通常取决于您的项目和团队。悲观锁定很好，因为它很容易理解——一次一个开发人员，不需要合并！

然而，坏事恰恰是——一次只有一个开发者。我现在有一个同事去现场的情况，在他离开之前，他检查了所有内容，以便如果他必须修复任何错误，他可以返回并检查他的所有更改......对他来说很好，对我和基地的其他开发团队来说很糟糕。

如果你可以在你的团队中绕过悲观锁定，那么使用它就很好，真的，人们讨厌它的最大原因是因为它是 Visual SourceSafe 的默认做法。如果您对合并大量更改没有信心，那么您还有另一个使用它的理由 - 如果您曾经使用过乐观锁定 SCM，并进行了合并，您就会知道恢复是多么困难。

如果您可以处理合并，那么乐观锁定是优越的，我会推荐它，但如果您不想使用它，则不必交出您的极客卡。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-26T16:32:59.983

1.  Bob 需要编辑 FooBar.java
2.  约翰已将其签出以进行编辑
3.  Bob 还是编辑了他的本地副本并将其保存为 FooBar.java.bak
4.  当约翰签到时，鲍勃签了
5.  Bob 在其上复制 FooBar.java.bak 并将其签入
6.  约翰开始重新实现他的功能

我已经看到它一次又一次地发生。开发人员这样做是因为这个过程很烦人：

1.  Bob 需要编辑 FooBar.java
2.  约翰已将其签出以进行编辑
3.  鲍勃必须等到约翰完成后才开始玩弄他的拇指

悲观锁定感觉就像业余时间，对不起。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T16:12:27.617

*   您并不总是可以选择将文件分开
    *   配置文件
    *   XML 文件
*   即使是相对较小的文件仍可能包含多个开发人员需要访问的不同部分
    *   图书馆
    *   实用程序
*   合并工具比以往任何时候都更智能
    *   冲突相当罕见
*   减少由于开发人员“意外”签出文件而导致的延迟

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T16:13:15.070

如果开发人员不能处理合并和修复冲突，他应该接受再教育。

即使是小文件也很常见，例如对于 JSP，一个人（Web 开发人员）可能会更改布局代码，而其他人可能会更改 JSP 正在使用的模型的 API。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-04-15T21:29:10.233

关于 Bob 和 John 的案例，像 svn 这样的协作系统并不能像锁定系统一样阻止这种情况。我可以“更新” FooBar.java，它满足 svn 我拥有最新版本，然后在本地删除该文件并用我自己制作的个人副本覆盖它，而不考虑基线版本，然后签入，愉快地销毁另一个人的变化。没有任何系统，无论是否锁定，都可以防止这种情况发生，所以我什至看不到将其带入辩论的意义。

真正的问题是决定你的平衡是什么

合并错误的可能性与人们锁定文件造成的不便

锁定或非锁定系统是“优越”的概念是无稽之谈。

我已经在默认的完全锁定模式下使用了 VSS，有 6 个开发人员，它的工作就像做梦一样。有时，有人会忘记释放锁，我们必须手动寻找或破坏锁并在他们返回时手动合并，但这非常少。我不止一次看到 svn 搞砸了它的自动合并，所以我不太相信它。当两个人以无法自动合并在一起的方式更改同一个文件时，它并不总是标记“冲突”。
相反，我看到人们对 VSS 的锁感到不耐烦，编辑自己的副本，并草率地将它们签入到其他人的代码之上，而我

My point is, this is not a sensible debate to have. The success of either system comes down to how you manage the conflict points when they occur, not whether one system or the other is better.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T16:09:34.987

悲观锁定是（个人经验）协作方式。它有时很容易被良好的团队沟通所取代。只需说“嘿，我将在这几个文件上工作一段时间”。

我曾在 2 到 6 人的团队中工作，没有锁定，我们从来没有遇到过问题，除了一些通常和必要的合并。

我也曾经锁定过一个[Visual SourceSafe](http://en.wikipedia.org/wiki/Microsoft_Visual_SourceSafe)托管项目。恕我直言，这适得其反。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T16:08:01.883

软件开发人员总是乐观主义者——看看他们的估计技能！

在实践中，我们发现冲突很少见，不必担心锁定的好处超过了偶尔解决冲突的步骤。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T17:28:32.907

> 如果你的代码文件太大以至于你经常有不止一个人同时在处理它们

如果是这样的话，是时候让“人类”负责并协调任何变化了。在理想情况下，如果您的项目管理良好，您很少会遇到尝试更改锁定文件的时间，因为有人会协调事情，所以这实际上不会发生。

换句话说，您将知道“Bob”正在对组件 X/Y/Z 进行大量更改，如果您在组件 X 中有错误修复，您将知道在尝试提交更改之前与 Bob 交谈。

正如我所说，这是理想的;）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-28T02:24:34.483

如果可能发生严重冲突，悲观锁定是一个好主意。对于大多数编程，您不会看到任何严重的冲突，因此悲观锁定是毫无意义的。如果您是以下情况，则例外情况：

*   处理无法真正合并的二进制文件 - 艺术资产（模型、纹理等）就是一个很好的例子。
*   与不知道如何合并并且不想学习的非技术用户一起工作（主要是艺术家，但一些技术作家也会对此感到厌烦）。
*   处理由于高度复杂性而无法轻易合并或分解为较小文件的非常大的文件（从未见过这样的情况，但我相信这是可能的）。

除此以外...

# ascii - 如何将 8 位字符转换为 7 位字符？（即 Ü 到 U）

> ID：140422
> 
> 赞同：24
> 
> 时间：2008-09-26T16:05:27.647
> 
> 标签：ascii

我正在寻找伪代码或示例代码，以将更高位的 ascii 字符（例如扩展 ascii 154 的 Ü）转换为 U（即 ascii 85）。

我最初的猜测是，由于只有大约 25 个 ascii 字符类似于 7 位 ascii 字符，因此必须使用翻译数组。

让我知道你是否还能想到别的。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2012-04-05T22:29:30.353

对于 .NET 用户[，CodeProject 中的文章](http://www.codeproject.com/Articles/13503/Stripping-Accents-from-Latin-Characters-A-Foray-in)（感谢[GvS 的提示](https://stackoverflow.com/a/183540/562906)）确实比我迄今为止看到的任何其他文章都更正确地回答了这个问题。

然而，那篇文章中的代码（在解决方案 #1 中）很麻烦。这是一个紧凑的版本：

```
// Based on http://www.codeproject.com/Articles/13503/Stripping-Accents-from-Latin-Characters-A-Foray-in
private static string LatinToAscii(string inString)
{
    var newStringBuilder = new StringBuilder();
    newStringBuilder.Append(inString.Normalize(NormalizationForm.FormKD)
                                    .Where(x => x < 128)
                                    .ToArray());
    return newStringBuilder.ToString();
} 
```

* * *

为了扩展答案，此方法使用[String.Normalize](http://msdn.microsoft.com/en-us/library/ebza6ck1.aspx)：

> 返回一个新字符串，其文本值与此字符串相同，但其二进制表示形式为指定的 Unicode 规范化形式。

特别是在这种情况下，我们使用[NormalizationForm](http://msdn.microsoft.com/en-us/library/system.text.normalizationform.aspx) `FormKD`，在相同的 MSDN 文档中进行了描述：

> FormKD - 表示使用完全兼容性分解对 Unicode 字符串进行规范化。

有关 unicode 规范化形式的更多信息，请参阅[Unicode Annex #15](http://www.unicode.org/reports/tr15/)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-26T16:33:24.367

大多数语言都有用标准 ASCII 替换重音字符的标准方法，但这取决于语言，并且通常涉及用两个 ASCII 字符替换单个重音字符。例如在德语中 ü 变成 ue。因此，如果您想正确处理自然语言，它比您想象的要复杂得多。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-26T16:43:14.123

将 Ü 转换为 U 真的是您想要做的吗？我不知道其他语言，但在德语中 Ü 会变成 Ue，ö 会变成 oe，等等。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T16:08:43.817

我认为你不能。

我通常会这样做：

AccentString = 'ÀÂÄÉÉÈÊ[和所有其他]'
ConvertString = 'AAAEEE[和所有其他]'

在 AccentString 中查找 char 并将其替换为 ConvertString 中的相同索引

高温高压

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-29T09:51:31.030

在代码页 1251 中，字符用 2 个字节编码：一个用于基本字符，一个用于变体。然后，当您以 ASCII 编码时，只保留基本字符。

```
public string RemoveDiacritics(string text)
{

  return System.Text.Encoding.ASCII.GetString(System.Text.Encoding.GetEncoding(1251).GetBytes(text));

} 
```

来自：[http ://www.clt-services.com/blog/post/Enlever-les-accents-dans-une-chaine-(proprement).aspx](http://www.clt-services.com/blog/post/Enlever-les-accents-dans-une-chaine-(proprement).aspx)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-26T16:41:24.707

事实上，正如 unexist 所建议的那样：“iconv”函数的存在可以为您处理所有奇怪的转换，几乎在所有编程语言中都可用，并且有一个特殊选项，它试图用近似值转换目标集中缺少的字符。

使用 iconv 将您的输入 UTF-8 字符串简单地转换为 7 位 ASCII。

否则，您将始终遇到极端情况：使用具有不同字符集的不同代码页的 8 位输入（因此根本无法使用您的转换表），忘记映射最后一个愚蠢的重音字符（您映射了所有严重/重音，但忘记映射捷克语 caron 或北欧 '°') 等。

当然，如果您想将解决方案应用于一个小的特定问题（为您的音乐收藏制作文件系统友好的文件名），则查找数组是可行的方法（对于 128 以上的每个代码编号映射一个数组JeeBee 提出的低于 128 的近似值，或者 viceBerg 提出的源/目标对，具体取决于您选择的语言中已经提供了哪些替换函数），因为它可以快速组合在一起并快速检查缺失的元素。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T16:08:49.480

我想你似乎已经成功了。一个 128 字节长的字节数组，由 char&127 索引，包含与 8 位位字符匹配的 7 位字符。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T16:15:52.147

嗯，为什么不直接用 iconv 改变字符串的编码呢？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T16:24:22.780

这实际上取决于源字符串的性质。如果您知道字符串的编码，并且知道它是 8 位编码（例如 ISO Latin 1 或类似编码），那么一个简单的静态数组就足够了：

```
static const char xlate[256] = { ..., ['é'] = 'e', ..., ['Ü'] = 'U', ... }
...
new_c = xlate[old_c]; 
```

另一方面，如果您有不同的编码，或者如果您使用的是 UTF-8 编码的字符串，您可能会发现[ICU](http://www.icu-project.org/ "Unicode 国际组件")库中的函数非常有用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T16:36:47.917

前 128 个字符没有标准含义。根据用户的语言，它们可以采用不同的解释（代码页）。

例如，请参阅 [葡萄牙语](http://en.wikipedia.org/wiki/Code_page_860) 与 [加拿大法语](http://en.wikipedia.org/wiki/Code_page_863)

除非您知道代码页，否则您的“翻译”有时会出错。

如果您要假设某个代码页（例如原始 IBM 代码页），那么翻译数组将起作用，但对于真正的国际用户来说，这将是很多错误的。

这就是为什么 unicode 比旧的代码页系统更受青睐的原因之一。

严格来说，ASCII 只有 7 位。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-08T16:03:34.417

[CodeProject](http://www.codeproject.com/KB/cs/UnicodeNormalization.aspx)上有一篇文章看起来不错。

使用代码页 1251 的转换也引起了我的兴趣（请参阅其他答案）。

我不喜欢转换表，因为 Unicode 中的字符数很大，你很容易错过。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T16:07:02.107

我想你已经把它钉在了头上。鉴于您的域有限，转换数组或哈希是您的最佳选择。创建任何复杂的东西来尝试自动执行它是没有意义的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T16:13:39.017

查找数组可能是完成此任务的最简单和最快的方法。这是一种可以将 ASCII 转换为 EBCDIC 的方法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-07T17:07:18.907

我使用这个函数来修复一个带有重音符号的变量，以便从 VB6 传递给一个肥皂函数：

```
Function FixAccents(ByVal Valor As String) As String

    Dim x As Long
    Valor = Replace(Valor, Chr$(38), "&#" & 38 & ";")

    For x = 127 To 255
        Valor = Replace(Valor, Chr$(x), "&#" & x & ";")
    Next

    FixAccents = Valor

End Function 
```

在soap函数中我这样做（对于变量文件名）：

```
FileName = HttpContext.Current.Server.HtmlDecode(FileName) 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2010-03-09T05:32:56.227

试试[uni2ascii](http://billposer.org/Software/uni2ascii.html)程序。

# python - 使用 python + ldap 对活动目录进行身份验证

> ID：140439
> 
> 赞同：94
> 
> 时间：2008-09-26T16:08:11.230
> 
> 标签：python, authentication, active-directory, ldap

如何使用 Python + LDAP 对 AD 进行身份验证。我目前正在使用 python-ldap 库，它所产生的只是眼泪。

我什至无法绑定执行一个简单的查询：

```
import sys
import ldap

Server = "ldap://my-ldap-server"
DN, Secret, un = sys.argv[1:4]

Base = "dc=mydomain,dc=co,dc=uk"
Scope = ldap.SCOPE_SUBTREE
Filter = "(&(objectClass=user)(sAMAccountName="+un+"))"
Attrs = ["displayName"]

l = ldap.initialize(Server)
l.protocol_version = 3
print l.simple_bind_s(DN, Secret)

r = l.search(Base, Scope, Filter, Attrs)
Type,user = l.result(r,60)
Name,Attrs = user[0]
if hasattr(Attrs, 'has_key') and Attrs.has_key('displayName'):
  displayName = Attrs['displayName'][0]
  print displayName

sys.exit() 
```

运行它`myusername@mydomain.co.uk password username`会给我两个错误之一：

`Invalid Credentials`- 当我输入错误或故意使用错误的凭据时，它无法进行身份验证。

> ldap.INVALID_CREDENTIALS: {'info': '80090308: LdapErr: DSID-0C090334, comment: AcceptSecurityContext error, data 52e, vece', 'desc': 'Invalid credentials'}

或者

> ldap.OPERATIONS_ERROR: {'info': '00000000: LdapErr: DSID-0C090627, 注释：为了执行此操作，必须在连接上成功绑定。, data 0, vece', 'desc': '操作错误'}

我错过了什么才能正确绑定？

我在 Fedora 和 Windows 上遇到了同样的错误。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-26T16:18:18.320

我失踪了

```
l.set_option(ldap.OPT_REFERRALS, 0) 
```

从一开始。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-09-26T20:23:04.160

如果您愿意使用 pywin32，则可以使用来自 Python 的 Win32 调用。这就是我们在 CherryPy Web 服务器中所做的：

```
import win32security
token = win32security.LogonUser(
    username,
    domain,
    password,
    win32security.LOGON32_LOGON_NETWORK,
    win32security.LOGON32_PROVIDER_DEFAULT)
authenticated = bool(token) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-07-14T16:02:22.150

这对我有用，**l.set_option(ldap.OPT_REFERRALS, 0)**是访问 ActiveDirectory 的关键。此外，我认为您应该添加一个“con.unbind()”以便在完成脚本之前关闭连接。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-08-16T21:32:24.373

这是一些对我有用的简单代码。

```
import ldap  # run 'pip install python-ldap' to install ldap module.
conn = ldap.open("ldaphost.company.com")
conn.simple_bind_s("myuser@company.com", "mypassword") 
```

这是基于[先前的答案](https://stackoverflow.com/a/10743770/487992)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-01T18:46:53.913

如果您安装了 Kerberos 并与 AD 通信，例如安装并运行 Centrify Express，您可能只使用 python-kerberos。例如

```
import kerberos
kerberos.checkPassword('joe','pizza','krbtgt/x.pizza.com','X.PIZZA.COM')` 
```

将返回 True 用户 'joe' 在 Kerberos 领域 X.PIZZA.COM 中有密码 'pizza'。（通常，我认为后者与 AD 域的名称相同）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T14:36:49.713

我看到你对@Johan Buret 的评论，关于 DN 没有解决你的问题，但我也相信这是你应该研究的。

根据您的示例，AD 中默认管理员帐户的 DN 将是：cn=Administrator,cn=Users,dc=mydomain,dc=co,dc=uk - 请尝试一下。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-01-29T08:22:01.843

基于优秀的[ldap3 教程](https://ldap3.readthedocs.io/tutorial_intro.html)：

```
>>> from ldap3 import Server, Connection, ALL, NTLM
>>> server = Server('server_name_or_ip', get_info=ALL)
>>> conn = Connection(server, user="user_name", password="password", auto_bind=True)
>>> conn.extend.standard.who_am_i()
>>> server.info 
```

我在 Python3 中完成了上述操作，但它应该与 Python 2 兼容。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-13T04:11:36.473

我试图添加

> l.set_option(ldap.OPT_REFERRALS, 0)

但不是错误，Python 只是挂起并且不再响应任何内容。也许我构建的搜索查询错误，搜索的 Base 部分是什么？我使用与简单绑定相同的 DN（哦，我必须这样做`l.simple_bind`，而不是`l.simple_bind_s`）：

```
import ldap
local = ldap.initialize("ldap://127.0.0.1")
local.simple_bind("CN=staff,DC=mydomain,DC=com")
#my pc is not actually connected to this domain 
result_id = local.search("CN=staff,DC=mydomain,DC=com", ldap.SCOPE_SUBTREE, "cn=foobar", None)
local.set_option(ldap.OPT_REFERRALS, 0)
result_type, result_data = local.result(result_id, 0) 
```

我正在使用 AD LDS，并且该实例已为当前帐户注册。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-13T10:01:51.073

我有同样的问题，但它是关于密码编码

```
.encode('iso-8859-1') 
```

解决了这个问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T17:14:23.147

使用专有名称登录您的系统。`"CN=Your user,CN=Users,DC=b2t,DC=local"` 它应该适用于任何 LDAP 系统，包括 AD

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-03-30T13:25:44.443

对我来说，从`simple_bind_s()`到`bind()`做的伎俩。

# java - 持续集成服务器

> ID：140453
> 
> 赞同：78
> 
> 时间：2008-09-26T16:11:06.417
> 
> 标签：java, continuous-integration

我的公司正在考虑更换持续集成服务器（我不会说我们现在有哪一个，所以无论如何我不会歪曲你的回复:)）我想知道是否有人有任何建议？最佳用户体验、维护难度等...

我们的代码都是java，我们使用ANT作为构建工具。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-09-26T16:13:45.443

我最近实现了一个[Hudson](http://hudson-ci.org/)服务器。之前使用过 Cruise Control，**我对 Hudson 非常满意，并且对其易于设置和使用印象深刻。** 添加新项目比使用 Cruise Control 容易得多。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-26T16:22:58.683

*编辑：我们现在使用 Hudson。*

不久前，我根据以下要求研究了其中的一些：

*   Java 代码
*   蚂蚁构建
*   Groovy 构建
*   分布式构建
*   单片机触发器集成
*   http 报告
*   smtp 报告

[持续集成特征矩阵](http://confluence.public.thoughtworks.org/display/CC/CI+Feature+Matrix "CI 特征矩阵")是一个很好的起点。

我最终选择了[AnthillPro](http://www.anthillpro.com/html/default.html "AnthillPro")并成功使用它，只是触及了我们可以使用它并希望使用它的表面。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-26T16:13:31.823

当我们查看Jetbrains [TeamCity](http://www.jetbrains.com/teamcity/index.html)时，它看起来真的很棒。它是基于 Java 的，因此您的团队应该很容易扩展，并且可以进行分布式构建等......您可以评估一个免费赠品版本。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-30T14:46:24.730

我也一直在研究这个问题，虽然我最初是在看 CruiseControl，但我听说了关于**[Hudson](http://hudson-ci.org/)**的好消息并决定试一试。我完全被它上手的容易程度（只需下载并运行）所震撼，并且配置是通过 GUI 完成的，因此无需摆弄 XML 配置文件。

几分钟之内，我就完成了我的第一个 Ant 构建。我现在将它作为 Windows 服务运行在服务器上，该服务器在办公室和通过 VPN 都可以 24/7 全天候使用。升级就像下载新的war文件并重新启动一样简单。

对 junit 报告的支持是开箱即用的。安装额外的插件也很容易，我已经为 Trac、Cobertura、FindBugs 和 PMD 添加了插件。代码和测试质量正在提高，因为看到趋势图上升非常令人满意！

我现在用它来管理我的所有测试和生产环境的构建。由于我管理多个 Web 应用程序，这让我有更多时间花在实际编程上。老实说，我不记得没有它我是如何做到的。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-26T16:17:33.173

Atlassian 的[Bamboo](http://www.atlassian.com/software/bamboo/)看起来不错，但我没有任何经验。[看起来与Cruise](http://studios.thoughtworks.com/cruise-continuous-integration)或[TeamCity](http://www.jetbrains.com/teamcity/index.html)的功能相似。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-30T15:04:08.877

和这里的其他人一样，我**真的很**喜欢[哈德森](http://hudson-ci.org/)。

它非常容易安装（它只是一个要部署的 war 文件）、配置和使用。此外，它提供了许多其他系统并不总是可用的功能（构建矩阵、主从、服务器或项目级别的安全性......）

现有[插件](http://hudson.gotdns.com/wiki/display/HUDSON/Plugins)的数量现在非常重要，创建自己的插件并不难......

最后，这个应用程序发展得非常快：我们目前是第 257 个版本，一年以来他们发布了 100 多个版本！

[对于法国人，我在这里](http://linsolas.developpez.com/articles/hudson/)写了一个非常完整的使用 Hudson 的指南。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-01T18:31:38.640

如果您使用的是 Atlassian 员工软件（例如 Jira、Clover 等），Bamboo 就是您的选择。

我们使用了几个月，我可以推荐它。它物有所值。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-06-20T18:23:27.317

**如果您在 Hudson 上没有完全出售，那么一键式试驾应该会改变您的想法。**

点击下方：

[https://hudson.dev.java.net/hudson.jnlp](https://hudson.dev.java.net/hudson.jnlp)

这将通过 Java Web Start 启动 Hudson 以进行试驾。启动后，访问[http://localhost:8080/](http://localhost:8080/)以访问仪表板。您对此 Hudson 所做的任何配置都将存储在 ~/.hudson 中，因此您的数据将在 Hudson 进程重新启动后继续存在。

如果您使用的是相当标准的工具，例如 svn 和 ant/maven - 您应该在 5 分钟内构建并运行。不同的工具，可能需要 20 分钟！

看这里的介绍：

[http://wiki.hudson-ci.org/display/HUDSON/Meet+Hudson](http://wiki.hudson-ci.org/display/HUDSON/Meet+Hudson)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T16:22:31.273

竹子效果很好；如果你有现金，我会推荐。Cruise Control 物有所值；我从来没有能够让它可靠地发现源代码更改已进行并构建，我也无法让它手动构建。界面和配置非常复杂。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-26T16:12:45.850

我们使用[巡航控制](http://cruisecontrol.sourceforge.net/)。它具有我们想要的所有功能，并且非常容易设置。与 ANT 和 SVN 的集成很好。

缺点：每隔一段时间，我们必须重新启动进程或机器，因为它停止为每晚构建发送消息。不知道那是什么，但它只是烦人。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-26T17:38:30.857

与 Java 世界一样，有开源世界和商业世界。

我们已经看到了对各种产品的很好的报道。

Hudson：我不知道有哪一种其他的 Java 服务器产品能像这样容易评估。java -jar hudson.war - 比这更容易吗？您不仅可以在 Windows 上使用它，还可以在所有常用的 Java 平台上使用它。支持 Ant、Maven 和许多其他构建平台。

Hudson 最好的地方在于插件功能。它几乎在不断地开发。你要求一个功能，它不会花很长时间来完成。

我通常不喜欢听起来像个粉丝，但这个应用程序/开发人员/社区确实给我留下了深刻的印象。

BR，
~A

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-09T08:01:05.587

[只是关于持续集成功能矩阵](http://confluence.public.thoughtworks.org/display/CC/CI+Feature+Matrix)的一句话：它不是由 CruiseControl 人员收集的，它是由 DamageControl 项目[在 CodeHaus 上启动](http://docs.codehaus.org/display/DAMAGECONTROL/Continuous+Integration+Server+Feature+Matrix)的，并在 DamageControl 进入休眠状态时移至 CruiseControl wiki。这些信息主要由项目/产品所有者或其粉丝维护。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-22T17:27:40.393

我想我会是第一个提到[Luntbuild](http://sourceforge.net/projects/luntbuild/)的人。除了不太吸引人的名字之外，它还是一个**很棒的**CI 服务器。

*   超级容易设置。
*   用于创建/管理您的项目和用户的 Web UI
*   支持很多版本控制系统（我已经将它与 CVS、SVN 和 StarTeam 一起使用）
*   漂亮的远程 API
*   访问控制的粒度相对较高（因此您可以让客户仅访问他们的构建，而不是访问她客户的构建）
*   还有更多。

查看[现场演示](http://livedemo.pmease.com:8081/luntbuild/luntbuild-login.jsp)。帐户/密码演示/演示

注意：现场演示是几个版本。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-13T18:06:50.027

[我对竹子](http://www.atlassian.com/software/bamboo/)很满意。在确定之前，我查看了许多免费的解决方案。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T16:14:58.887

我们使用巡航控制系统取得了不错的效果。从那以后，我们开始在所有项目中使用 Maven 作为构建工具。随之而来的是搬到哈德逊的 CI，这非常好。如果您认为将来可能会转向 Maven，我会推荐它。我认为 Hudson 甚至可以用来调用 Ant 任务，尽管可能需要一个 Maven 包装器。

[http://hudson-ci.org/](http://hudson-ci.org/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T16:15:45.190

Thoughtworks [Cruise](http://studios.thoughtworks.com/cruise-continuous-integration)是[CruiseControl](http://cruisecontrol.sourceforge.net/)开源项目的商业后代。看起来很不错，有很多功能，分布式构建等。我不知道它的可扩展性是什么。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-26T17:27:04.613

我运行的一个组织 (openqa.org) 曾经使用过几乎所有这些。在简单设置方面，请使用 TeamCity 或 Bamboo。但就整体可靠性而言，您可能想看看 Hudson。我*真的很*喜欢 JetBrains，但我们发现 TeamCity 会在一段时间后进入奇怪的状态，导致我们的构建非常不可靠。太糟糕了，因为我喜欢 IDEA！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-26T18:23:07.847

我们一直在使用[Automated Build Studio](http://www.automatedqa.com/products/abs/)并且对它非常满意。它是一个 Windows 应用程序，因此您被困在 Windows 构建服务器上，但从好的方面来说，它非常易于设置、维护和使用。您可以通过点击从组件构建您的流程，如果没有一个组件满足您的需求，您可以使用脚本。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-02-13T18:52:28.170

在我使用过的少数几个中，[Buildbot](http://buildbot.net/)是最强大和最灵活的。不过，如果这对你很重要的话，它并不是最漂亮的。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-02-25T10:17:33.213

我管理过 Bamboo 和 Hudson，我会推荐 Hudson。

它们都很棒，但是 Hudson 有更好的报告支持，例如在 Hudson 内部发布您的报道报告等要容易得多。

这可能会在不久的将来发生变化，但是尽管 Bamboo 与 JIRA 等的集成以及它的统计数据，但 Hudson 易于使用和第三方支持，无论金额多少都更好（它是免费的，Bamboo 不是） .

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-06-20T18:32:46.267

我们也使用 Hudson，如果不是经济衰退，我们可能会将 Bamboo 和大多数 Atlassian 产品（Bamboo、Crucible、Confluence）与 JIRA 一起使用。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-26T16:49:54.700

我将[Continuum](http://continuum.apache.org)用于我的持续集成服务器。除了我要聘请一位在他上次任务中使用过的开发经理之外，没有其他理由，所以选择至少我们中的一个人有经验似乎是有意义的。

在选择 Continuum 之前，我让一位初级开发人员花了两周时间尝试让 CruiseControl 运行起来。但是，我们首先运行 Continuum 1.0。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-27T19:00:27.390

我们正在使用[Zutubi Pulse](http://www.zutubi.com)，它对我们很有用。ant 非常易于使用，具有许多高级功能。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-08T03:49:59.680

我们使用 StarTeam，在 Hudson 和 CruiseControl.NET 之间，CC.NET 在与 StarTeam 集成时存在一些错误。它似乎无法识别我们在配置文件中定义的工作空间。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-12-04T20:28:17.093

去年在美国的一次会议上，我第一次听说 Cruise Control .net 是在一个 1 小时的演讲中，在我回到平原的路上，我决定为我们公司实施一个小型 POC，并在不到 5 小时内成功完成（包括我本可以完成的所有学习）。

我正在使用它，因为我必须说我对结果非常满意，并且易于操作，有一些缺点（例如，尽管您可以监控多个服务器，但缺乏跨服务器规模的任务分配）我发现了一个错误其中一个实现，因为它是开源的，所以我可以很快修复它（很大的优势）——我在 codeplex 中创建了一个小 [project][1] 来包含我的修复，然后我将它们贡献给社区作为签入.我强烈建议你看看这个平台，如果你能说出你真正需要的，那就太好了。

[1]： http: [//www.codeplex.com/DavidovitzCCE](http://www.codeplex.com/DavidovitzCCE)项目

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-09-10T21:35:44.683

CruiseControl.NET 在 Windows 机器上比原来的基于 Java 的机器更有效。特别是当专用构建服务器尚不可用时。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2010-03-06T21:26:32.653

看看我们的**[Parabuild](http://www.viewtier.com/products/parabuild/index.htm)**。与免费工具相比，它的设置非常容易，维护开销接近于零。它不是免费的，但你得到你所支付的。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2010-10-19T08:30:12.973

为什么不使用托管 CI 服务，那么您就不必担心维护、成本等问题。

MikeCI 是一个[托管 CI 服务](http://www.mikeci.com)，它在 Amazon EC2 中托管您的构建，每月只需 10 美元，这比维护自己的 CI 服务器便宜得多。

搏一搏。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-10-24T14:27:41.477

[考虑fazend.com](http://www.fazend.com)上的免费托管 CI 服务。它支持`ant`.

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2010-12-28T19:45:47.853

您可能还想看看它

[http://www.thoughtworks-studios.com/solutions/deployment-management](http://www.thoughtworks-studios.com/solutions/deployment-management)[链接文本](http://www.thoughtworks-studios.com/solutions/deployment-management)

ThoughtWorks 部署管理解决方案结合了 Twist（敏捷测试）和 Go（发布管理）的强大功能。

*   Twist 直接从业务用户那里获取要测试的需求
    ，然后支持他们的自动化作为随应用程序发展的长期测试。
*   Go 帮助开发和 IT 运营团队对发布流程进行建模，并以 可重复且可靠的方式
    部署软件。

# javascript - 用于“未保存数据”保护的客户端/JS 框架？

> ID：140460
> 
> 赞同：20
> 
> 时间：2008-09-26T16:12:53.760
> 
> 标签：javascript, data-protection

我们有一个典型的 Web 应用程序，它本质上是一个数据输入应用程序，具有许多屏幕，其中一些具有一定程度的复杂性。我们需要提供标准功能，以确保用户在离开或关闭浏览器之前忘记单击“保存”按钮，他们会收到警告并可以取消（但仅在存在未保存或脏数据时）。

我知道我必须做的基础知识——事实上，我确信这些年来我已经完成了这一切（与 onbeforeunload 相关，跟踪页面的“脏”状态等...... ) 但在我再次开始编写此代码之前，是否有人对已经存在的库（免费或其他方式）有一些建议会有所帮助？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-26T16:20:39.093

一块拼图：

```
/**
 * Determines if a form is dirty by comparing the current value of each element
 * with its default value.
 *
 * @param {Form} form the form to be checked.
 * @return {Boolean} <code>true</code> if the form is dirty, <code>false</code>
 *                   otherwise.
 */
function formIsDirty(form)
{
    for (var i = 0; i < form.elements.length; i++)
    {
        var element = form.elements[i];
        var type = element.type;
        if (type == "checkbox" || type == "radio")
        {
            if (element.checked != element.defaultChecked)
            {
                return true;
            }
        }
        else if (type == "hidden" || type == "password" || type == "text" ||
                 type == "textarea")
        {
            if (element.value != element.defaultValue)
            {
                return true;
            }
        }
        else if (type == "select-one" || type == "select-multiple")
        {
            for (var j = 0; j < element.options.length; j++)
            {
                if (element.options[j].selected !=
                    element.options[j].defaultSelected)
                {
                    return true;
                }
            }
        }
    }
    return false;
} 
```

[还有一个](http://developer.mozilla.org/en/DOM/window.onbeforeunload)：

```
window.onbeforeunload = function(e)
{
    e = e || window.event;  
    if (formIsDirty(document.forms["someFormOfInterest"]))
    {
        // For IE and Firefox
        if (e)
        {
            e.returnValue = "You have unsaved changes.";
        }
        // For Safari
        return "You have unsaved changes.";
    }
}; 
```

总结一下，你会得到什么？

```
var confirmExitIfModified = (function()
{
    function formIsDirty(form)
    {
        // ...as above
    }

    return function(form, message)
    {
        window.onbeforeunload = function(e)
        {
            e = e || window.event;
            if (formIsDirty(document.forms[form]))
            {
                // For IE and Firefox
                if (e)
                {
                    e.returnValue = message;
                }
                // For Safari
                return message;
            }
        };
    };
})();

confirmExitIfModified("someForm", "You have unsaved changes."); 
```

您可能还希望将`beforeunload`事件处理程序的注册更改为使用`LIBRARY_OF_CHOICE`的事件注册。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-10T05:37:54.237

如果你使用 jQuery，这里有一个简单的技巧：

```
$('input:text,input:checkbox,input:radio,textarea,select').one('change',function() {
  $('BODY').attr('onbeforeunload',"return 'Leaving this page will cause any unsaved data to be lost.';");
}); 
```

但是请记住，如果您有从该页面重定向的条件，或者您希望允许成功的表单发布，您需要在重定向或提交事件之前执行此操作，如下所示：

```
$('BODY').removeAttr('onbeforeunload'); 
```

...否则你会让自己陷入一个不断询问你提示的循环中。

在我的例子中，我有一个很大的应用程序，我在 Javascript 中执行 location.href 重定向，以及表单发布，然后一些 AJAX 提交然后返回页面中的内联成功响应。在任何这些情况下，我都必须捕获该事件并使用 removeAttr() 调用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-19T16:26:18.247

想稍微扩展一下 Volomike 优秀的 jQuery 代码。

因此，有了这个，我们有一个非常酷和优雅的机制来实现通过在保存之前远离更新的数据来防止意外数据丢失的目标 - 即。更新页面上的字段，然后单击浏览器中的按钮、链接甚至返回按钮，然后单击“保存”按钮。

您唯一需要做的就是向所有控件（尤其是保存按钮）添加一个“noWarn”类标签，这些控件（尤其是保存按钮）会返回网站，保存或不删除任何更新的数据。

如果控件导致页面丢失数据，即。导航到下一页或清除数据 - 您无需执行任何操作，因为脚本会自动显示警告消息。

惊人的！干得好沃洛迈克！

只需将 jQuery 代码如下：

```
$(document).ready(function() {

    //----------------------------------------------------------------------
    // Don't allow us to navigate away from a page on which we're changed
    //  values on any control without a warning message.  Need to class our 
    //  save buttons, links, etc so they can do a save without the message - 
    //  ie. CssClass="noWarn"
    //----------------------------------------------------------------------
    $('input:text,input:checkbox,input:radio,textarea,select').one('change', function() {
        $('BODY').attr('onbeforeunload',
        "return 'Leaving this page will cause any unsaved data to be lost.';");
    });

    $('.noWarn').click(function() { $('BODY').removeAttr('onbeforeunload'); });

}); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-02-08T07:18:19.123

除了 Lance 的回答之外，我刚刚花了一个下午试图让这个片段运行。首先，jquery 1.4 似乎存在绑定更改事件的错误（截至 2010 年 2 月）。jQuery 1.3 还可以。其次，我无法让 jquery 绑定 onbeforeunload/beforeunload（我怀疑我正在使用的 IE7）。我尝试了不同的选择器，（“body”），（window）。我试过'.bind'，'.attr'。恢复到纯 js 工作（我还看到了一些关于这个问题的类似帖子）：

```
$(document).ready(function() {
    $(":input").one("change", function() {
        window.onbeforeunload = function() { return 'You will lose data changes.'; }
    });
    $('.noWarn').click(function() { window.onbeforeunload = null; });
}); 
```

注意我还使用了 ':input' 选择器，而不是枚举所有输入类型。严格来说是矫枉过正，但我​​认为这很酷:-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-31T20:36:57.813

我创建了一个 jQuery[插件](http://kenbrowning.blogspot.com/2010/03/how-to-warn-users-of-unsaved-changes.html)，可用于为 Web 应用程序实现警告未保存更改功能。它支持回发。它还包括一个链接，指向有关如何规范`onbeforeunload`Internet Explorer 事件的行为的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-08T16:14:49.313

我对这个页面上列出的 jQuery 实现做了一点小小的改进。如果您启用了**客户端 ASP.NET 页面验证并在页面上使用，我的实现将处理。**

`onBeforeLeave`它避免了当页面由于验证失败而实际上没有在点击时发布时清除功能的“错误” 。只需`no-warn-validate`在导致验证的按钮/链接上使用该类。它仍然具有可用于具有（例如“另存为草稿”按钮）的`no-warn`控件的类。`CausesValidation=false`这种模式可能可以用于除 ASP.NET 之外的其他验证框架，所以我在这里发布以供参考。

```
 function removeCheck() { window.onbeforeunload = null; }

$(document).ready(function() {
    //-----------------------------------------------------------------------------------------
    // Don't allow navigating away from page if changes to form are made. Save buttons, links,
    // etc, can be given "no-warn" or "no-warn-validate" css class to prevent warning on submit.
    // "no-warn-validate" inputs/links will only remove warning after successful validation
    //-----------------------------------------------------------------------------------------
    $(':input').one('change', function() {
        window.onbeforeunload = function() {
            return 'Leaving this page will cause edits to be lost.';
        }
    });

    $('.no-warn-validate').click(function() {
        if (Page_ClientValidate == null || Page_ClientValidate()) { removeCheck(); }
    });

    $('.no-warn').click(function() { removeCheck() });
}); 
```

# javascript - 使用 javascript 测试多个屏幕

> ID：140462
> 
> 赞同：9
> 
> 时间：2008-09-26T16:13:22.497
> 
> 标签：javascript, html, cross-browser

是否可以判断网站用户是否使用多个显示器？我需要找到弹出窗口的位置，但用户很可能会有多显示器设置。虽然`window.screenX`etc. 会给出浏览器窗口的位置，但它对于多个监视器是无用的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-23T10:25:12.700

这是一个过于复杂的解决方案。我强烈建议重构它——它没有在生产站点上使用，只是作为我自己的快速“概念证明”。

对，警告结束。

我首先假设用户可能没有双显示器设置，但他们可能有一个非常大的显示器，因此无论如何都可以应用相同的功能。

```
var newWindow,
    screenSpaceLeft = window.screenX,
    screenSpaceTop = window.screenY,
    screenSpaceRight = screen.availWidth - (window.screenX + window.outerWidth),
    screenSpaceBottom = screen.availHeight - (window.screenY + window.outerHeight),
    minScreenSpaceSide = 800,
    minScreenSpaceTop = 600,
    screenMargin = 8,

    width = (screen.availWidth / 2.05),
    height = screen.availHeight,
    posX = (screen.availWidth / 2),
    posY = 0;

e.preventDefault();

if (screenSpaceRight > screenSpaceLeft && screenSpaceRight > screenSpaceTop && screenSpaceRight > screenSpaceBottom && screenSpaceRight > minScreenSpaceSide) {
    if (width > screenSpaceRight) {
        width = screenSpaceRight - screenMargin;
    }
    if (posX < (screen.availWidth - screenSpaceRight)) {
        posX = window.screenX + window.outerWidth + screenMargin;
    }
} else if (screenSpaceLeft > screenSpaceRight && screenSpaceLeft > screenSpaceTop && screenSpaceLeft > screenSpaceBottom && screenSpaceLeft > minScreenSpaceSide) {
    if (width > screenSpaceLeft) {
        width = screenSpaceLeft - screenMargin;
    }

    posX = 0;
} else if (screenSpaceTop > screenSpaceRight && screenSpaceTop > screenSpaceLeft && screenSpaceTop > screenSpaceBottom && screenSpaceTop > minScreenSpaceTop) {
    posX = 0;
    posY = 0;
    width = screen.availWidth;
    height = (screen.availHeight / 2.05);
    if (height > screenSpaceTop) {
        height = screenSpaceTop - screenMargin;
    }
} else if (screenSpaceBottom > screenSpaceRight && screenSpaceBottom > screenSpaceLeft && screenSpaceBottom > screenSpaceTop && screenSpaceBottom > minScreenSpaceTop) {
    posX = 0;
    width = screen.availWidth;
    if (window.screenY + window.outerHeight + screenMargin > (screen.availHeight / 2)) {
        posY = window.screenY + window.outerHeight + screenMargin;
    } else {
        posY = (screen.availHeight / 2);
    }
    height = (screen.availHeight / 2.05);
    if (height > screenSpaceBottom) {
        height = screenSpaceBottom - screenMargin;
    }
}

newWindow = window.open(this.href, "_blank", "width=" + width + ",height=" + height + ",location=yes,menubar=no,resizable=yes,scrollbars=yes,status=yes,menubar=yes,top=" + posY + ",left=" + posX); 
```

它检查有多少可用的屏幕空间，如果有可用的最小数量（800 x 600），它会在那里打开窗口。如果没有足够的空间，它会覆盖屏幕右侧的窗口，仅占一半左右。

笔记：

首先，应该改变它以找出最大空间量在哪里，而不是随意搜索左、右、上、下。

其次，我怀疑在某些已经使用 screen.availHeight 的地方，应该使用 screen.height 来代替。宽度也是如此。这是因为在决定用户是否有第二台显示器（或屏幕上有很多空间）时，我们对任务栏的位置并不太感兴趣。

第三，它在 IE < 8 中不起作用。这可以通过在适当的情况下使用 screenLeft 和 screenTop 而不是 screenX/screenY 来轻松纠正。

第四，代码是杂乱无章的，可以让它看起来比它更优雅。我不为此道歉。但是，您不应该在任何地方使用如此糟糕、无法维护的 JS，并且它*需要*被重写。我只是把它放在这里，因为它目前在我的思路中，当我正确地写这个时，我很可能会忘记在这里发布一个好的解决方案，因为它不会发生几个月。

正确的。你去吧。我不承担让你的 javascript 变得可怕、丑陋和完全难以做任何事情的责任。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T16:17:34.593

我不相信现在是可能的；然而，除了 Web 开发之外，js 在桌面小部件中变得越来越流行，这将是请求未来版本的绝佳功能

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T16:19:32.637

我发现这是有人使用过的解决方案......我不明白为什么你不能相信它。

[如果宽度大于 (Height/3) * 4 > (Screen.Width) THEN]

[用户有双显示器]

[万一]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T16:19:34.337

你不能那样做。但是，您可以将弹出窗口定位在父窗口的中心。我认为在您的网站中间显示一个“div”作为对话框是一个更好的主意，因为这个弹出窗口被阻止的机会更小，而且 IMO 也不那么烦人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T16:19:37.147

屏幕的大小呢？多个屏幕通常具有很大的尺寸。只需检查尺寸并确定仅在一个或多个屏幕上是否合理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T16:22:34.643

`screen.width`您可以使用 JavaScript 的( `.availWidth`) 和`screen.height`( )做出有根据的猜测`.availHeight`。

我的想法是假设（！）监视器通常遵循一定的比例，而 .[avail]width 应该在它之外，因为屏幕仅在宽度方面复制，而不是高度复制。

写下这个答案，听起来像是一个严重的黑客攻击。没有什么是我真正依赖的。

# .net - .NET 字符串的最大可能长度是多少？

> ID：140468
> 
> 赞同：260
> 
> 时间：2008-09-26T16:14:34.897
> 
> 标签：.net, string, limits

.NET 中可以创建的最长字符串是多少？据我所知，该课程的文档`String`对这个问题保持沉默，因此权威答案可能需要一些内部知识。64 位系统上的最大值会发生变化吗？

[更多的是出于好奇而不是实际使用-我不打算创建任何使用巨大字符串的代码！]

* * *

## 回答 #1

> 赞同：376
> 
> 时间：2008-09-26T17:18:23.433

理论极限可能是 2,147,483,647，但实际极限远不及此。由于 .NET 程序中没有单个对象可能超过 2GB，并且字符串类型使用 UTF-16（每个字符 2 个字节），因此您可以做的最好的事情是 1,073,741,823，但您不太可能能够分配它在 32 位机器上。

这是[“如果你不得不问，你可能做错了什么”的情况之一。](https://devblogs.microsoft.com/oldnewthing/20070301-00/?p=27803)

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-09-26T17:06:29.373

根据我高度科学和准确的实验，它在我的机器上远远早于 1,000,000,000 个字符。（我仍在运行下面的代码以获得更好的精确定位）。

**更新：** 几个小时后，我放弃了。最终结果：可以超过 100,000,000 个字符，立即给出`System.OutOfMemoryException`1,000,000,000 个字符。

```
using System;
using System.Collections.Generic;

public class MyClass
{
    public static void Main()
    {
        int i = 100000000;
        try
        {
            for (i = i; i <= int.MaxValue; i += 5000)
            {
                string value = new string('x', i);
                //WL(i);
            }
        }
        catch (Exception exc)
        {
            WL(i);
            WL(exc);
        }
        WL(i);
        RL();
    }

    #region Helper methods

    private static void WL(object text, params object[] args)
    {
        Console.WriteLine(text.ToString(), args);   
    }

    private static void RL()
    {
        Console.ReadLine(); 
    }

    private static void Break() 
    {
        System.Diagnostics.Debugger.Break();
    }

    #endregion
} 
```

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-09-26T16:17:54.187

由于 的`Length`属性`System.String`是`Int32`，我猜最大长度为 2,147,483,647 个字符（最大`Int32`大小）。如果它允许更长的时间，您将无法检查长度，因为那会失败。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2014-08-11T15:58:08.437

对于迟到的人来说，我可以看到即时扫描的“你可能不应该这样做”可能会导致有人问他们应该做什么......</p>

[StringBuilder](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder(v=VS.100).aspx)类通常很容易替换。如果您的数据来自文件，请特别考虑其中一个[基于流的类。](http://msdn.microsoft.com/en-us/library/k3352a4t(v=vs.110).aspx)

问题`s += "stuff"`在于它必须分配一个全新的区域来保存数据，然后将所有旧数据以及新内容复制到其中 - 每个循环迭代。因此，将 5 个字节添加到 1,000,000`s += "stuff"`是非常昂贵的。如果你想要的只是写五个字节到最后并继续你的程序，你必须选择一个留下一些增长空间的类：

```
StringBuilder sb = new StringBuilder(5000);
for (; ; )
    {
        sb.Append("stuff");
    } 
```

`StringBuilder`达到上限时会[自动加倍增长。](https://stackoverflow.com/questions/4495855/how-does-the-stringbuilder-decide-how-large-its-capacity-should-be)因此，您将在开始时看到一次增长的痛苦，一次是 5,000 字节，再次是 10,000 字节，再次是 20,000 字节。附加字符串会在每次循环迭代时产生痛苦。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-08-04T07:46:01.277

*我机器上*字符串的最大长度是**1,073,741,791**。

你看，字符串并不像通常认为的那样受整数的限制。

除了内存限制之外，字符串不能超过 2 ^(30) ( **1,073,741,824** ) 个字符，因为 Microsoft CLR（公共语言运行时）施加了 2GB 的限制。比我的电脑允许的多 33 个。

现在，欢迎您自己尝试一下。

在 Visual Studio 中创建一个新的 C# 控制台应用程序，然后在此处复制/粘贴 main 方法：

```
static void Main(string[] args)
{
    Console.WriteLine("String test, by Nicholas John Joseph Taylor");

    Console.WriteLine("\nTheoretically, C# should support a string of int.MaxValue, but we run out of memory before then.");

    Console.WriteLine("\nThis is a quickish test to narrow down results to find the max supported length of a string.");

    Console.WriteLine("\nThe test starts ...now:\n");

    int Length = 0;

    string s = "";

    int Increment = 1000000000; // We know that s string with the length of 1000000000 causes an out of memory exception.

    LoopPoint:

    // Make a string appendage the length of the value of Increment

    StringBuilder StringAppendage = new StringBuilder();

    for (int CharacterPosition = 0; CharacterPosition < Increment; CharacterPosition++)
    {
        StringAppendage.Append("0");

    }

    // Repeatedly append string appendage until an out of memory exception is thrown.

    try
    {
        if (Increment > 0)
            while (Length < int.MaxValue)
            {
                Length += Increment;

                s += StringAppendage.ToString(); // Append string appendage the length of the value of Increment

                Console.WriteLine("s.Length = " + s.Length + " at " + DateTime.Now.ToString("dd/MM/yyyy HH:mm"));

            }

    }
    catch (OutOfMemoryException ex) // Note: Any other exception will crash the program.
    {
        Console.WriteLine("\n" + ex.Message + " at " + DateTime.Now.ToString("dd/MM/yyyy HH:mm") + ".");

        Length -= Increment;

        Increment /= 10;

        Console.WriteLine("After decimation, the value of Increment is " + Increment + ".");

    }
    catch (Exception ex2)
    {
        Console.WriteLine("\n" + ex2.Message + " at " + DateTime.Now.ToString("dd/MM/yyyy HH:mm") + ".");

        Console.WriteLine("Press a key to continue...");

        Console.ReadKey();

    }

    if (Increment > 0)
    {
        goto LoopPoint;

    }

    Console.WriteLine("Test complete.");

    Console.WriteLine("\nThe max length of a string is " + s.Length + ".");

    Console.WriteLine("\nPress any key to continue.");

    Console.ReadKey();

} 
```

我的结果如下：

> 弦乐测试，尼古拉斯·约翰·约瑟夫·泰勒 (Nicholas John Joseph Taylor)
> 
> 从理论上讲，C# 应该支持 int.MaxValue 的字符串，但在此之前我们会耗尽内存。
> 
> 这是一个快速测试，可缩小结果范围以找到字符串的最大支持长度。
> 
> 测试开始......现在：
> 
> s.Length = 1000000000 在 08/05/2019 12:06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 100000000。
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 10000000。s.Length = 1010000000 at 08/05/2019 12:06 s.Length = 1020000000 at 08/05/2019 12:06 s.Length = 1030000000 at 08/05/2019 12 :06 秒长度 = 1040000000 在 08/05/2019 12:06 秒长度 = 1050000000 在 08/05/2019 12:06 秒长度 = 1060000000 在 08/05/2019 12:06 秒长度 = 1070000000 在2019 年 8 月 5 日 12:06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 1000000。 s.Length = 1071000000 at 08/05/2019 12:06 s.Length = 1072000000 at 08/05/2019 12:06 s.Length = 1073000000 at 08/05/2019 12 :06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 100000。 s.Length = 1073100000 at 08/05/2019 12:06 s.Length = 1073200000 at 08/05/2019 12:06 s.Length = 1073300000 at 08/05/2019 12 :06 秒长度 = 1073400000 在 08/05/2019 12:06 秒长度 = 1073500000 在 08/05/2019 12:06 秒长度 = 1073600000 在 08/05/2019 12:06 秒长度 = 1073700000 在2019 年 8 月 5 日 12:06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 10000。 s.Length = 1073710000 at 08/05/2019 12:06 s.Length = 1073720000 at 08/05/2019 12:06 s.Length = 1073730000 at 08/05/2019 12 :06 s.Length = 1073740000 在 08/05/2019 12:06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 1000。s.Length = 1073741000 at 08/05/2019 12:06
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:06。抽取后，Increment 的值为 100。 s.Length = 1073741100 at 08/05/2019 12:06 s.Length = 1073741200 at 08/05/2019 12:06 s.Length = 1073741300 at 08/05/2019 12 :07 秒长度 = 1073741400 在 08/05/2019 12:07 秒长度 = 1073741500 在 08/05/2019 12:07 秒长度 = 1073741600 在 08/05/2019 12:07 秒长度 = 1073741700 在2019 年 8 月 5 日 12:07
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:07。抽取后，Increment 的值为 10。 s.Length = 1073741710 at 08/05/2019 12:07 s.Length = 1073741720 at 08/05/2019 12:07 s.Length = 1073741730 at 08/05/2019 12 :07 秒长度 = 1073741740 在 08/05/2019 12:07 秒长度 = 1073741750 在 08/05/2019 12:07 秒长度 = 1073741760 在 08/05/2019 12:07 秒长度 = 1073741770 在2019 年 8 月 5 日 12:07 秒长度 = 1073741780 2019 年 8 月 5 日 12:07 秒长度 = 1073741790 2019 年 8 月 5 日 12:07
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:07。抽取后，Increment 的值为 1。 s.Length = 1073741791 在 08/05/2019 12:07
> 
> 引发了“System.OutOfMemoryException”类型的异常。在 2019 年 8 月 5 日 12:07。抽取后，Increment 的值为 0。测试完成。
> 
> 字符串的最大长度为 1073741791。
> 
> 按任意键继续。

我机器上字符串的最大长度是 1073741791。

如果人们可以将他们的结果作为评论发布在下面，我将非常感激。

了解人们是否得到相同或不同的结果将会很有趣。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T16:20:14.087

由于`String.Length`是一个整数（即 的别名`Int32`），它的大小仅限于`Int32.MaxValue`unicode 字符。;-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T18:06:09.213

200 兆...此时您的应用程序几乎停止运行，大约有一个 gig 工作集内存，并且操作系统开始表现得好像您需要重新启动一样。

```
static void Main(string[] args)
{
    string s = "hello world";
    for(;;)
    {
        s = s + s.Substring(0, s.Length/10);
        Console.WriteLine(s.Length);
    }
}

12
13
14
15
16
17
18
...
158905664
174796230
192275853
211503438 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-10-13T07:26:27.753

字符串在 RAM 堆中分配动态内存大小。但是字符串地址存储在占用4字节内存的堆栈中。

# c# - C# 中的基本构造函数 - 首先调用哪个？

> ID：140490
> 
> 赞同：134
> 
> 时间：2008-09-26T16:17:42.360
> 
> 标签：c#, .net, asp.net

首先调用哪个 - 基本构造函数或“这里的其他东西”？

```
public class MyExceptionClass : Exception
{
    public MyExceptionClass(string message, string extrainfo) : base(message)
    {
        //other stuff here
    }
} 
```

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2008-09-26T16:27:16.130

基类构造函数在派生类构造函数之前调用，但派生类初始化函数在基类初始化函数之前调用。例如在以下代码中：

```
public class BaseClass {

    private string sentenceOne = null;  // A

    public BaseClass() {
        sentenceOne = "The quick brown fox";  // B
    }
}

public class SubClass : BaseClass {

    private string sentenceTwo = null; // C

    public SubClass() {
        sentenceTwo = "jumps over the lazy dog"; // D
    }
} 
```

执行顺序为：C、A、B、D。

查看这 2 篇 msdn 文章：

*   [为什么初始化程序的运行顺序与构造函数相反？第一部分](http://blogs.msdn.com/ericlippert/archive/2008/02/15/why-do-initializers-run-in-the-opposite-order-as-constructors-part-one.aspx)
*   [为什么初始化程序的运行顺序与构造函数相反？第二部分](http://blogs.msdn.com/ericlippert/archive/2008/02/15/why-do-initializers-run-in-the-opposite-order-as-constructors-part-two.aspx)

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2008-09-26T16:20:13.400

将首先调用基本构造函数。

尝试一下：

```
public class MyBase
{
  public MyBase()
  {
    Console.WriteLine("MyBase");
  }
}

public class MyDerived : MyBase
{
  public MyDerived():base()
  {
    Console.WriteLine("MyDerived");
  }
} 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-09-26T20:43:39.537

不要试图记住它，试着向自己解释必须发生的事情。假设您有一个名为 Animal 的基类和一个名为 Dog 的派生类。派生类向基类添加了一些功能。因此，当执行派生类的构造函数时，基类实例必须可用（以便您可以向其添加新功能）。这就是为什么构造函数是从基类执行到派生类，而析构函数却以相反的方式执行——首先是派生析构函数，然后是基类析构函数。

（这是简化的，但它应该可以帮助您将来回答这个问题，而无需实际记住这一点。）

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-09-26T16:25:23.527

实际上，派生类构造函数是先执行的，但是 C# 编译器会插入对基类构造函数的调用作为派生构造函数的第一条语句。

所以：派生的先执行，但“看起来”基是先执行的。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-26T16:29:05.860

正如其他人所说，首先调用基本构造函数。然而，构造函数并不是真正发生的第一件事。

假设您有这样的课程：

```
class A {}

class B : A {}

class C : B {} 
```

首先，字段初始值设定项将按照派生最多的类到最少派生的类的顺序被调用。`C`所以首先是, then `B`, then的字段初始值设定项`A`。

然后将按相反的顺序调用构造函数： First`A`的构造函数，然后`B`，然后`C`。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-26T16:18:44.323

我会说基地

编辑见：

[http://www.c-sharpcorner.com/UploadFile/rajeshvs/ConsNDestructorsInCS11122005010300AM/ConsNDestructorsInCS.aspx](http://www.c-sharpcorner.com/UploadFile/rajeshvs/ConsNDestructorsInCS11122005010300AM/ConsNDestructorsInCS.aspx)

那里说：

```
using System;
class Base
{

public Base()
{
    Console.WriteLine("BASE 1");
}
public Base(int x)
{
    Console.WriteLine("BASE 2");
}
}

class Derived : Base
{
public Derived():base(10)
{
    Console.WriteLine("DERIVED CLASS");
}
}

class MyClient
{
public static void Main()
{
    Derived d1 = new Derived();
}
} 
```

> 该程序输出
> 
> BASE2
> 
> 派生类

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-12-07T03:11:20.140

首先调用基本构造函数。但是派生类中字段的初始化器首先被调用。

调用顺序是

1.  派生类字段初始化器
2.  基类字段初始化器
3.  基类构造函数
4.  派生类构造函数

（可以把2和3当作一个整体来构造基类。）

取自[*CSharp 语言规范 5.0*](https://www.microsoft.com/en-us/download/details.aspx?id=7029)：

> **10.11.3 构造函数执行**
> 
> 变量初始化器被转换为赋值语句，并且这些赋值语句在基类实例构造函数的调用之前执行。这种排序确保所有实例字段在执行任何有权访问该实例的语句之前由其变量初始化程序初始化。举个例子
> 
> ```
> using System;
> class A
> {
>     public A() {
>         PrintFields();
>     }
>     public virtual void PrintFields() {}
> }
> class B: A
> {
>     int x = 1;
>     int y;
>     public B() {
>         y = -1;
>     }
>     public override void PrintFields() {
>         Console.WriteLine("x = {0}, y = {1}", x, y);
>     }
> } 
> ```
> 
> 当`new B()`用于创建 的实例时`B`，将产生以下输出：
> 
> ```
> x = 1, y = 0 
> ```
> 
> 的值为`x`1，因为变量初始化程序在调用基类实例构造函数之前执行。但是， 的值为`y`0（ an 的默认值），因为直到基类构造函数返回后才会执行`int`对的赋值。`y`将实例变量初始化器和构造器初始化器视为自动插入到构造器主体之前的语句是很有用的。这个例子
> 
> ```
> using System;
> using System.Collections;
> class A
> {
>     int x = 1, y = -1, count;
>     public A() {
>         count = 0;
>     }
>     public A(int n) {
>         count = n;
>     }
> }
> class B: A
> {
>     double sqrt2 = Math.Sqrt(2.0);
>     ArrayList items = new ArrayList(100);
>     int max;
>     public B(): this(100) {
>         items.Add("default");
>     }
>     public B(int n): base(n – 1) {
>         max = n;
>     }
> } 
> ```
> 
> 包含几个变量初始化器；它还包含两种形式的构造函数初始化器（base 和 this）。该示例对应于下面显示的代码，其中每个注释表示一个自动插入的语句（用于自动插入的构造函数调用的语法无效，但仅用于说明机制）。
> 
> ```
> using System.Collections;
> class A
> {
>     int x, y, count;
>     public A() {
>         x = 1;                                // Variable initializer
>         y = -1;                               // Variable initializer
>         object();                         // Invoke object() constructor
>         count = 0;
>     }
>     public A(int n) {
>         x = 1;                                // Variable initializer
>         y = -1;                               // Variable initializer
>         object();                         // Invoke object() constructor
>         count = n;
>     }
> }
> class B: A
> {
>     double sqrt2;
>     ArrayList items;
>     int max;
>     public B(): this(100) {
>         B(100);                               // Invoke B(int) constructor
>         items.Add("default");
>     }
>     public B(int n): base(n – 1) {
>         sqrt2 = Math.Sqrt(2.0);           // Variable initializer
>         items = new ArrayList(100);   // Variable initializer
>         A(n – 1);                         // Invoke A(int) constructor
>         max = n;
>     }
> } 
> ```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-11T23:32:49.550

Eric Lippert 有一篇关于对象初始化相关问题的有趣帖子，其中解释了构造函数和字段初始值设定项排序的原因：

[为什么初始化器作为构造器以相反的顺序运行？第一部分](http://blogs.msdn.com/ericlippert/archive/2008/02/15/why-do-initializers-run-in-the-opposite-order-as-constructors-part-one.aspx)
[为什么初始化器作为构造器以相反的顺序运行？第二部分](http://blogs.msdn.com/ericlippert/archive/2008/02/18/why-do-initializers-run-in-the-opposite-order-as-constructors-part-two.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T16:22:56.280

[http://www.devhood.com/tutorials/tutorial_details.aspx?tutorial_id=777](http://www.devhood.com/tutorials/tutorial_details.aspx?tutorial_id=777)

首先调用基本构造函数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T16:23:49.383

将调用异常构造函数，然后调用您的子类构造函数。

简单的OO原理

看看这里 [http://www.dotnet-news.com/lien.aspx?ID=35151](http://www.dotnet-news.com/lien.aspx?ID=35151)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T16:28:01.603

将首先调用基本构造函数，否则，如果您的“其他东西”必须使用由基本构造函数初始化的成员变量，您将收到编译时错误，因为您的类成员尚未初始化。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T16:28:22.430

在子构造函数中完成任何工作之前调用 base(?)。

这是真的，即使你不使用 :base() （在这种情况下，会调用 0 参数的基本构造函数。）

它的工作方式类似于java，

```
public Child()
{
   super(); // this line is always the first line in a child constructor even if you don't put it there! ***
} 
```

*** 例外：我可以输入 super(1,2,3) 代替。但是，如果我没有明确地调用 super in，则会调用 super()。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T16:35:52.893

构造函数调用自下而上被调用（触发），并自上而下执行。因此，如果您有继承自 A 类的 B 类的 C 类，则当您创建 C 类的实例时，将调用 C 的构造函数，然后调用 B 的指导者，而 B 又调用构造函数A. 现在执行 A 的构造函数，然后执行 B 的构造函数，然后执行 C 的构造函数。

# java - J2ME Hessian 限制的解决方法？

> ID：140510
> 
> 赞同：2
> 
> 时间：2008-09-26T16:21:02.820
> 
> 标签：java, interop, java-me, hessian

Hessian 的官方 J2ME 实现似乎有严重的限制：不支持复杂的对象。
在线文档的任何地方都没有提到这个限制，但是如果你用谷歌搜索“hessian j2me”，你会发现关于这个问题的帖子。虽然谷歌没有找到解决方案。有没有人有这个问题的解决方案？是否有用于 J2ME 的 Hessian 的替代实现？
我想避免从 Hessian 获取字符串，然后做一些 JSON/XML 解析来获取对象......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T19:22:35.107

这有点令人困惑，因为 Hessian 矩阵是混合二阶偏导数的矩阵，而无法处理复数的库确实是个问题。

为什么他们必须重复使用具有其他含义的成熟名称？

# translation - 对于内容驱动型网站的语言翻译，您推荐哪些选项？

> ID：140522
> 
> 赞同：2
> 
> 时间：2008-09-26T16:22:32.910
> 
> 标签：translation, multilingual

请阅读整个问题。我不是在寻找一种管理多语言内容的方法，而是在寻找一种真正获得多语言内容的方法。这通常属于我从事的大多数项目的技术建议，我希望有人能提供一些帮助。我们现在正在与一个客户合作，该客户拥有物理翻译内容的人员，并且每种语言都有单独的域、托管、CMS 等。对于那些想要在国际上开展业务但没有人员的客户，有哪些方法或使用的服务？将其出租给人们是否更便宜，或者动态进行，技术上的缺点是什么？你能提供的任何建议都是有帮助的。我知道这不是严格意义上的编程问题，但我认为它属于技术领域。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T16:25:25.617

我还没有看到适合专业网站内容的动态翻译服务。语言翻译（还）不是机械活动——它需要思考和分析。您的客户最好通过外包翻译（或聘请翻译）获得服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-02T14:37:58.920

通常你需要两个团队：一个正向翻译和一个反向翻译，然后你并行进行（3-4 四个团队会很好） - 然后你检查反向翻译的一致性（希望这是 75-85% )，然后您请一位专家就剩余的 15-25% 给出您的建议。理论上，您可以在 Mechanical Turk 中进行设置。

# c# - 通过行业为 PHP 程序员编写 Windows 桌面应用程序的提示、指南和/或教程

> ID：140529
> 
> 赞同：2
> 
> 时间：2008-09-26T16:23:38.103
> 
> 标签：c#, windows, air, desktop

是的，长标题。在过去 6 年左右的时间里，我一直在为工作和个人项目使用 PHP 编程，但我对桌面应用程序有一个想法（顺便说一下，它使用了一个 web REST api）。

我正在讨论如何解决这个问题 - 我在 Java、C++、Perl 和 Python 方面有一些经验，但从来没有机会或机会编写应用程序并将其分发给其他任何重要的人。

该应用程序将需要与 REST API（使用 OAuth）进行通信，以及访问文件系统，并可能进行一些图像处理（编码/调整大小，但这是一个很好的选择）。我一直在考虑 .NET，但 AIR 也是一种可能性（虽然我真的不希望有一个巨大的运行时，这将是一个系统托盘类型的应用程序）。

我不是在找人来写它，但我可以在正确的方向上轻推。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T16:41:43.287

在语言支持方面，您可以使用 C++、Java、C#、Python 等。实际上，我想说 C++、Java 和 C# 是大多数用户的选择。但请记住，C++ 和 Java 中的 GUI 支持很难学习和使用。如果您计划进行许多大型项目，性能是一个问题（无论是大小还是速度），并且您需要一个简单的安装过程，请使用 C++。如果这些最后的限制不适用（仅项目的大小和数量），请使用 Java。假设您必须花费相当多的初始时间来准备基础架构（库等）。

如果您的计划是更短期的（不是那么多项目，也不是那么大的项目），请使用 C#。它确实是最容易学习、使用和生成有效代码的方法，并且使用 Mono 项目，它不再局限于 MS 平台。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T16:47:13.583

我会推荐[Visual Studio Express](http://www.microsoft.com/express/product/default.aspx)版本。由于您有使用 C 风格语言的经验，请尝试从 Visual C# Express 开始。2008 SP1 版是一个非常强大的IDE，它是完全免费的。使用 Express 版本进行个人或小型开发的唯一缺点是它们没有类设计器并且您不能使用加载项。

请务必以 .NET 2.0 为目标，以覆盖更广泛的受众。如果 Windows XP 作为最低要求没问题，您也可以尝试使用 WPF 的 .NET 3.5，这使得应用程序开发更像是 Web 开发，这可能会帮助您进行用户界面设计，因为您来自 Web 背景。

运行时开销可以忽略不计，因为无论如何大多数人都会有一个正在运行的 .NET 2.0 框架（您不能从 Vista 或更高版本中卸载它，而且 ATI Catalyst 控制面板也带有 .NET 2.0，所以许多普通计算机用户都有它）。我认为它至少是 Windows XP 的推荐 Windows 更新。

注意：也有本地化版本，因此您不一定需要我发布链接的英文版本。

Delphi 也很好，但是原始 Delphi 的免费版本有一些问题，没有免费的 Delphi 版本，也没有 Lazarus 版本，甚至接近 Visual Studio 2008 所提供的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T16:55:48.603

如果您正在学习新知识，请跳过 Windows 窗体并直接转到 WPF。它与在 xhtml 中构建 UI 非常相似，但具有出色的数据绑定和较少的兼容性问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T16:26:54.960

作为一名多年的 Delphi 程序员，你可以用它做任何你想做的事情。

我开始在工作中使用 C#。它也是一种很棒的语言，但对于分布式应用程序而言。.NET 框架仍然阻止我将它用于我的个人应用程序。

在我看来，Delphi 是一个不错的选择。如果你想要一个免费的 IDE，你可以看看 Lazarus/Free Pascal。

使用此选项，您可以构建您的 EXE，仅此而已。将 EXE 发送给客户，它正在工作。计算机上不需要 DLL/框架的东西。

当然，如果您使用数据库或第三方 DLL，则必须随其提供必要的东西。但它比带有所有 vbrunxx.dll 或所有 .NET 语言的 VB 更简单。

这是我的 2c ......我想我会为此而发火的！;-)

高温高压

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-16T15:04:50.870

如果您选择 AIR，您将拥有一个跨平台的解决方案。您还可以利用 Zend Framework 中的一些新 AMF 支持来获得更快、更高效的通信协议。XML 很大，JSON 更小，但 AMF 是二进制的并且压缩得多。AIR 还允许您以两种方式编写应用程序。第一种是传统的 Flash 播放器/Flex 组合，另一种是使用 AIR 提供的 API 编写一堆带有 Javascript 的 HTML 页面。Aptana 为 Eclipse 生成了一个功能免费的 IDE 插件，以便以第二种方式编写 AIR 应用程序。FlashDevelop 是另一个免费的 IDE，它更适合以 flash/flex 方式编写应用程序。如果您是学生，Flexbuilder 也可以免费使用 30 天，而且价格便宜（免费 IIRC）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-01T22:16:10.243

我也会选择德尔福。免费的 Turbo Explorer 非常适合快速项目，或者只是尝试一下（稍后再购买许可证）。如果您想成为免费的长期用户，请直接使用 Lazarus/FPC。

主要原因：单个 .exe 的可能性，与其他库的良好接口。

两者都支持多组套接字库以及与自由和非自由数据库的数据库连接。

.NET 适合企业使用，如果您的企业默认安装它（请记住，XP 附带 .NET 1.x）。对于广大用户来说，说服用户安装运行时是一件很无聊的事情，它不是病毒，而且它不能让你通过他们的监视器来监控他们。

# java - 枚举类型为 Class 时如何使用 Java 反射？

> ID：140537
> 
> 赞同：21
> 
> 时间：2008-09-26T16:26:46.490
> 
> 标签：java, reflection, enums

我正在使用一个枚举，其中常量是一个类。我需要在常量上调用一个方法，但无法引入编译时依赖项，并且枚举在运行时并不总是可用（可选安装的一部分）。因此，我想使用反射。

这很容易，但我之前没有使用枚举的反射。

枚举看起来像这样：

```
public enum PropertyEnum {

  SYSTEM_PROPERTY_ONE("property.one.name", "property.one.value"),

  SYSTEM_PROPERTY_TWO("property.two.name", "property.two.value");

  private String name;  

  private String defaultValue;

  PropertyEnum(String name) {
    this.name = name;
  }

  PropertyEnum(String name, String value) {
    this.name = name;
    this.defaultValue = value;
  } 

  public String getName() {
    return name;
  }

  public String getValue() {
    return System.getProperty(name);
  }

  public String getDefaultValue() {
    return defaultValue;
  }  

} 
```

使用反射调用常量方法的示例是什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-26T16:29:32.973

```
import java.lang.reflect.Method;

class EnumReflection
{

  public static void main(String[] args)
    throws Exception
  {
    Class<?> clz = Class.forName("test.PropertyEnum");
    /* Use method added in Java 1.5\. */
    Object[] consts = clz.getEnumConstants();
    /* Enum constants are in order of declaration. */
    Class<?> sub = consts[0].getClass();
    Method mth = sub.getDeclaredMethod("getDefaultValue");
    String val = (String) mth.invoke(consts[0]);
    /* Prove it worked. */
    System.out.println("getDefaultValue " + 
      val.equals(PropertyEnum.SYSTEM_PROPERTY_ONE.getDefaultValue()));
  }

} 
```

# url - 我应该假设 URL 中的编码字符在什么字符集中？

> ID：140549
> 
> 赞同：26
> 
> 时间：2008-09-26T16:28:20.337
> 
> 标签：url

[RFC 1738](http://www.ietf.org/rfc/rfc1738.txt)指定了 URL 的语法，并提到

> URL 仅使用
> US-ASCII 编码字符集的图形可打印字符编写。US-ASCII中不
> 使用八位字节 80-FF 十六进制，八位字节 00-1F 和 7F 十六进制表示
> 控制字符；这些必须被编码。

但是，它没有说明这些八位位组随后代表什么代码集。

[RFC 2396](http://www.ietf.org/rfc/rfc2396.txt)似乎试图改善这种情况，但是：

> 然而，对于包含非 ASCII 字符的原始字符序列，情况就更加困难了。如果可能有多个 [RFC2277]，传输旨在表示字符序列的八位字节序列的 Internet 协议有望提供某种方式来识别所使用的字符集。但是，目前在通用 URI 语法中没有提供完成此标识的规定。单个 URI 方案可能需要单个字符集、定义默认字符集或提供一种方法来指示所使用的字符集。
> 
> 预计 URI 中字符编码的系统处理将作为本规范的未来修改而开发。

是否有任何明确的方式可以让客户端确定使用哪个字符集来解释编码的八位位组，或者服务器可以确定客户端用来编码的内容？

在我看来，大多数服务器都默认使用 UTF-8，但这似乎是一种事实上的选择，而不是指定的选择。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T16:36:49.960

根据您的报价，URL 是 ASCII。就这样。

URI OTOH，允许更大的字符集；通常是您自己说的UTF-8。

要记住的一点是 URL 是 URI 的子集。因此，真正的问题是，哪些是您在浏览器中编写的？

我猜你可以写一个 URI，浏览器应该尽力转换为一个 URL（这是 HTTP/1.1 支持的，AFAICR）。对于非 ASCII 字符，这意味着十六进制代码，通常编码为 UTF-8。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T18:28:59.567

我相信您正在寻找的规范是[RFC 3987](https://www.rfc-editor.org/rfc/rfc3987)，它描述了 IRI - 国际化资源标识符。

# sql-server - 在 SQL Server 表中存储大量文本的最佳方法是什么？

> ID：140550
> 
> 赞同：50
> 
> 时间：2008-09-26T16:28:22.070
> 
> 标签：sql-server

在 SQL Server 的表中存储大量文本的最佳方法是什么？

varchar(max) 可靠吗？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-26T16:30:43.390

在 SQL 2005 及更高版本中，VARCHAR(MAX) 确实是首选方法。TEXT 类型仍然可用，但主要是为了向后兼容 SQL 2000 及更低版本。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-26T16:31:11.487

我喜欢使用 VARCHAR(MAX)（或者实际上是 NVARCHAR），因为它的工作方式类似于标准 VARCHAR 字段。由于它是介绍，我尽可能使用它而不是 TEXT 字段。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T16:32:28.097

Varchar(max) 仅在 SQL 2005 或更高版本中可用。这将最多存储 2GB 并且可以被视为常规 varchar。在 SQL 2005 之前，使用“文本”类型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T16:31:21.203

在一个 BLOB 中

BLOB 是非常大的可变二进制或字符数据，通常是文档（.txt、.doc）和图片（.jpeg、.gif、.bmp），可以存储在数据库中。在 SQL Server 中，BLOB 可以是 text、ntext 或 image 数据类型，可以使用 text 类型

文本

可变长度非Unicode数据，存储在服务器的代码页中，最大长度为231 - 1（2,147,483,647）个字符。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T16:32:13.480

[根据此处](http://books.google.com/books?id=Ua8h4paLqB8C&pg=PA128&dq=store+a+large+amount+of+text+in+a+table+in+sql+server&ei=4g3dSJHeG4LKigGq4rznDg&sig=ACfU3U21YI3tfNw-0iU5PEpXpKmr2C7t4g)找到的文本， varbinary(max) 是要走的路。您将能够存储大约 2GB 的数据。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T16:49:43.500

将文本拆分为数据库实际可以处理的块。并且，将拆分的文本放在另一个表中。像在原始表格中一样使用表格中`id`的。您可能希望表中的另一列保留适合您最大文本数据类型的文本。`text_chunk``text_chunk_id`

```
CREATE TABLE text_chunk (
     id NUMBER,
     chunk_sequence NUMBER,
     text BIGTEXT) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-01-09T10:24:17.733

根据您的情况，要考虑的设计替代方案是将它们作为 .txt 文件保存到服务器并将文件路径保存到数据库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-11-28T04:11:51.310

用于`nvarchar(max)`将整个聊天对话线程存储在单个记录中。通过插入标记在内容文本中标识每个单独的文本消息（或块）。

例子：

```
{{UserId: Date and time}}<Chat Text>. 
```

在显示时 UI 应该足够智能以理解这些标记并正确显示它。这样，只要未达到大小限制，一条记录就足以进行一次对话。

# language-agnostic - 购买机器进行持续集成 - 关键因素？

> ID：140574
> 
> 赞同：7
> 
> 时间：2008-09-26T16:33:36.427
> 
> 标签：language-agnostic, continuous-integration, automated-tests

我打算向我的（非常小的）公司建议我们购买一台计算机来运行持续集成。如果他们说是，那么实际购买机器的任务可能会落在我身上，所以我的问题是：

我在一台用于为一个非常小的（3 人）php 团队进行持续集成的计算机中寻找什么？

哪些“东西”（内存、处理器等）很重要，哪些不重要？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T16:38:10.907

你真的不需要那么强大的机器。如果您正在运行测试或其他指标，处理能力可能是您最关心的问题，但实际上您可以在旧的 pentium 1 上运行它，它可能会工作。

您的约束将成为您的操作环境。如果您正在运行 LAMP，您希望使用可以很好地处理 LAMP 设置的机器，这几乎是任何相当现代的 *nix 机器。

我在我们放置的旧 Pentium4 工作站上为 .NET 设置了一个持续集成设置，它处理得很好。

如果您在构建中归档代码，要记住的一件事是存储空间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T16:42:00.290

[当我们使用Maven](http://maven.apache.org)、[Continuum](http://continuum.apache.org)和[Clearcase](http://www.ibm.com/software/awdtools/clearcase/)并按小时构建时，存储成为我们的问题。每次构建后都会留下快照视图。

我们有一个足够强大的盒子（Sun Fire V490）并将它用于我们的开发集成环境和[Archiva](http://archiva.apache.org)存储库。所以我们从来没有真正遇到过性能和内存问题。事实上，我们唯一一次遇到 PermGen 内存问题的是构建 Maven 站点目标，这意味着使用 -XX:MaxPermSize=128m。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:41:23.647

根据我的经验，这不一定是强大的机器。您用于开发的任何机器都会非常令人满意。显然，如果您在代码提交上运行单元测试，机器越快，响应就越快。我们的 CI 服务器正在运行 XP SP2、3G 处理器、3G RAM，它现在已经无法满足我们的需求。也就是说，最好在提交后 6 分钟内收到一封电子邮件，让您知道构建是否干净并且所有测试是否通过。对于每晚构建，规格可能会下降更多，因为您可能有更多时间来完成这些工作。硬盘空间（现在 300G 是合理的）非常适合存储报告和构建回归，但如果你有一个 NAS，你可能会在构建工件后推掉它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T16:54:20.447

您今天可以购买的几乎任何新机器都可以处理在不太大的源代码树上进行持续集成的任务。一些要寻找的东西：

*   2-4GB RAM，如果你想并行运行许多测试或者你想运行虚拟机来模拟客户端，则需要更多。
*   多核处理器（或多个处理器）以增加捕获线程错误的机会。
*   “服务器”类机器往往比“桌面”类机器更好地处理 24/7 操作，但两者之间没有明确的界限。
*   RAID1 或 RAID1+0 冗余磁盘是必须的。即使你有备份（无论如何你都应该拥有它们），重建服务器也是一件痛苦的事，而且额外 100 美元的硬盘作为保险更值得。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-16T15:38:23.517

RAM：足以运行您的 CI 工具（[phpUnderControl](http://www.phpundercontrol.org/about.html)？）以及您想要用于构建和测试的任何支持软件。

存储：决定要在机器上保留多少旧版本。以我的经验，保留很多是没有用的，尤其是。如果您的小团队没有很多正式的流程来回滚到旧版本。

CPU：无问题。您可以购买的任何机器都可以使用。

因此，在两者之间，我倾向于使用 RAM 而不是存储空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T16:37:41.750

除非应用程序很大，否则我只会得到一个带有大约 4 GB 内存的双核盒子，可能还有 2 个相当快的 SATA 磁盘设置在 RAID 0 中。500 Gigs 可能吗？

如果您想真正安全地使用它，请在 RAID 0 中为 OS 分区获取两个 70 多个 gig 驱动器，然后在 RAID 5 中为数据获取 3 140+ gig 驱动器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T16:48:34.457

机器性能无关紧要，但请注意可用性，因为一旦您开始使用它并且有一天神奇的烟雾会消失，您需要尽快更换它才能继续工作。定义合理的备份策略，并确保您知道如何在必要时设置新的相同系统。例如，您可以让它从一个可以映像到另一台机器的小分区运行，然后如果数据的主要部分位于 RAID1 上并且至少有一个驱动器正常工作（尽管在其他地方有可用的备份），则可以物理移动数据的主要部分网络上也是如此）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T17:09:38.383

我认为这里很多人都明白的一件事是机器不如 CI 软件重要。唯一重要的是机器是否需要不同的架构。否则，请获得与您的目标环境匹配的机器。如果您正在构建一个服务器应用程序，那么获得 64 位处理器可能是明智之举，因为您的应用程序可能会在 64 位服务器上运行。

我会更关心我为 CI 使用的工具。您需要运行速度快的东西，正如这里的人们所指出的那样，除非您需要它们可用，否则它不应该保留旧版本。如果是这样，我会寻找允许将构建和结果上传到单独服务器的东西。

# java - 企业应用程序和企业应用程序客户端

> ID：140575
> 
> 赞同：0
> 
> 时间：2008-09-26T16:33:41.167
> 
> 标签：java, jpa, ejb

我加入了一家新公司的一个新项目，我们正在尝试使用 JPA 来做一些数据库工作。所以我们有一个带有 EJB 的 Ear，一个 Web 服务，然后有一个真正完成所有工作的应用程序客户端。Webservice，调用EJB，EJB调用客户端做DB工作。因此，在 appclient 中，我想通过注释加载 EntityManager，但它似乎不起作用（em 始终为空）：

```
@Entity
public class Whatever...{
    @PersistenceContext(unitName="pu")
    EntityManager em;

} 
```

所以我在想我需要在 EJB 上加载 EntityManager，但这也不起作用，因为 JPA 似乎没有看到 Entity 类，因为它们在 appclient 而不是 EJB 中。谁能给我一些指导？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-26T17:43:24.057

这是对应用程序客户端的滥用。您的所有数据库处理都应在 EJB 中进行。应用程序客户端的存在似乎没有任何明显的原因。

此链接指向一篇旧文章，但提供了有关应用程序客户端用途的示例（应用程序而非后端服务）。

[应用程序客户端](http://java.sun.com/developer/technicalArticles/J2EE/appclient/)

# c# - 如何检测我的程序是否在 Active Directory 环境中运行？

> ID：140579
> 
> 赞同：9
> 
> 时间：2008-09-26T16:35:07.467
> 
> 标签：c#, active-directory

如何检测我的程序是否在 Active Directory 环境中运行？

我正在使用 C# 和 .Net 2.0

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T16:43:52.017

尝试获取 Environment.UserDomainName 并将其与 Environment.MachineName 进行比较。如果两者相同，则用户可能没有域。如果它们不相同，则用户登录到必须具有目录服务器的域。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T17:44:08.253

此代码将检查计算机本身是否是域的成员

```
using System.DirectoryServices.ActiveDirectory;

bool isDomain = false;

try
{
    Domain.GetComputerDomain();
    isDomain = true;
}
catch (ActiveDirectoryObjectNotFoundException)
{
} 
```

但是，计算机可以在域中，但当前登录的用户可能是本地用户帐户。如果你想检查这个使用`Domain.GetCurrentDomain()`函数

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T16:40:18.360

一种方法可能是查询 LOGONSERVER 环境变量。这将给出您的 AD 控制器的服务器名称...据我所知，如果它当前未登录到域，它将为空白（或与当前工作站匹配？不确定）。

示例用法：

```
string ADServer = Environment.GetEnvironmentVariable("LOGONSERVER"); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T17:31:12.497

来自[http://msdn.microsoft.com/en-us/library/system.directoryservices.directoryentry.path.aspx](http://msdn.microsoft.com/en-us/library/system.directoryservices.directoryentry.path.aspx)

> 要使用 LDAP 绑定到当前域，请使用路径“LDAP://RootDSE”，然后获取默认命名上下文并重新绑定条目。

因此，如果没有域，绑定到“LDAP://RootDSE”应该失败或不返回任何内容。我没有为自己尝试。

```
use System.DirectoryServices; // add reference to system.directoryservices.dll

...

DirectoryEntry ent = new DirectoryEntry("LDAP://RootDSE");
String str = ent.Properties["defaultNamingContext"][0];
DirectoryEntry domain = new DirectoryEntry("LDAP://" + str); 
```

与依赖环境变量（用户可以删除或添加以欺骗程序）相比，这绝对是检查 Active Directory 的一种更简洁的方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T18:52:21.460

我发现了一些有用的东西：

使用 System.Net.NetworkInformation；

IPGlobalProperties.GetIPGlobalProperties().DomainName;

与本地用户和域用户一起使用。

# wcf - 如何从 Silverlight 调用 WCF Web 服务？

> ID：140602
> 
> 赞同：1
> 
> 时间：2008-09-26T16:40:03.650
> 
> 标签：wcf, silverlight

我正在尝试从 Silverlight 应用程序调用 WCF Web 服务（我开发的）。由于某种原因，Silverlight 应用程序不会对服务进行 http soap 调用。我知道这一点是因为我正在使用 Fiddler 嗅探所有 http 流量（而且它不是 localhost 调用）。

这是我在与 WCF 相关的服务器中的配置：

```
<system.serviceModel>
    <behaviors>
        <serviceBehaviors>
            <behavior name="ServiceBehavior">
                <serviceMetadata httpGetEnabled="true"/>
                <serviceDebug includeExceptionDetailInFaults="false"/>
            </behavior>
        </serviceBehaviors>
    </behaviors>
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"/>
    <services>
        <service behaviorConfiguration="ServiceBehavior" name="Service">
            <endpoint address="" binding="basicHttpBinding" contract="Service"/>
            <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange"/>
        </service>
    </services>
</system.serviceModel> 
```

以及 silverlight 应用程序中的 ServiceReferences.ClientConfig 文件（我使用的是 beta 2）：

```
<system.serviceModel>
    <bindings>
        <basicHttpBinding>
            <binding name="BasicHttpBinding_Service" maxBufferSize="65536"
                maxReceivedMessageSize="65536">
                <security mode="None" />
            </binding>
        </basicHttpBinding>
    </bindings>
    <client>
        <endpoint address="http://itlabws2003/Service.svc" binding="basicHttpBinding"
            bindingConfiguration="BasicHttpBinding_Service" contract="Silverlight_organigram.DataService.Service"
            name="BasicHttpBinding_Service" />
    </client>
</system.serviceModel> 
```

这是调用服务的silverlight方法，为了完整性，我粘贴了整个方法，lambda是为了使调用同步，我已经调试过了，在client.GetPersonsAsync（）行之后，Fiddler没有显示任何消息传送到服务器。

```
 public static List<Person> GetPersonsFromDatabase()
    {
        List<Person> persons = new List<Person>();

        ServiceClient client = new ServiceClient();

        ManualResetEvent eventGetPersons = new ManualResetEvent(false);

        client.GetPersonsCompleted += new EventHandler<GetPersonsCompletedEventArgs>(delegate(object sender, GetPersonsCompletedEventArgs e)
            {
                foreach (DTOperson dtoPerson in e.Result)
                {
                    persons.Add(loadFromDto(dtoPerson));
                }
                eventGetPersons.Set();
            });

        client.GetPersonsAsync();
        eventGetPersons.WaitOne();

        return persons;
    } 
```

有人对我如何解决这个问题有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T08:57:25.557

如果 Silverlight 应用程序未托管在公开您要调用的 Web 服务的同一域中，则适用跨域限制。

如果您希望 Silverlight 应用程序托管在 Web 服务之外的另一个域中，您可能希望查看[这篇文章](http://timheuer.com/blog/archive/2008/06/10/silverlight-services-cross-domain-404-not-found.aspx)以帮助您拥有一个跨域定义文件，或者改为编写一个中间“代理”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T16:48:22.413

你不会碰巧从文件系统运行吧？如果您在本地计算机上提供 silverlight 应用程序，而不使用 VS Web 服务器或 IIS，则出于安全原因，您将无法进行 HTTP 调用。同样，如果您从 Web 服务器加载，则无法访问本地资源。

此外，我发现 Nikhil 的 Web 开发助手[http://www.nikhilk.net/ASPNETDevHelperTool.aspx](http://www.nikhilk.net/ASPNETDevHelperTool.aspx)可能比 Fiddler 更有用，因为您也会看到本地流量，尽管看起来这不是您的问题这个案例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:13:29.970

我不能 100% 确定，但如果您在 Vista 或 Server 2008 上运行，您可能会遇到 http.sys 的用户访问控制问题

因此在 Vista 和 Win2k8 服务器中，HttpListener 仅在您运行在高权限帐户下时才会侦听。事实上，根据我的经验，即使您将自己添加到*本地*管理员组，您也可能会遇到这个问题。

在任何情况下，尝试通过右键单击并以管理员身份在 Vista 上启动 Visual Studio。看看能不能解决。如果是这样，你很好，但是......

理想情况下，您应该运行[httpcfg](http://msdn.microsoft.com/en-us/library/aa364478(VS.85).aspx)

比如：httpcfg set urlacl -u [http://itlabws2003](http://itlabws2003) -a D:(A;;GX;;; *yoursid* )

您的 sid = 您正在运行的帐户的安全标识符，您可以在此处找到它：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList

如果您还不知道，或者您可以将自己添加到 BUILTIN\Administators，请找到 sid 并再次通过命令行运行 httpcfg，指定该 sid。

用户访问控制、Vista 和 Http.sys 会导致这一切……如果这确实是您遇到的问题。不确定，但也许值得一试

# jakarta-ee - 有哪些工具可用于衡量企业基于 Web 的系统的“健康状况”？

> ID：140608
> 
> 赞同：2
> 
> 时间：2008-09-26T16:41:25.347
> 
> 标签：jakarta-ee, monitoring, enterprise

我协助维护基于 Web 的企业系统（在 J2EE 中编程，但这是一个更普遍的问题），我想知道：有哪些好的工具可以衡量企业系统的“健康状况”？例如，检查服务器上的内存空间、检查批处理运行状态、在一定时间内处理的记录数等工具？

我不希望将其限制为每个答案一个工具，但是，每个答案多个工具当然是可以接受的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T16:46:34.257

[OpenNMS](https://www.opennms.org/en/opennms/the-platform)是一个不错的监控工具。开箱即用，它可以监控服务器的各个方面，主要是内存、网络使用情况、磁盘空间等。但它是开源的，可以扩展以监控其他事物。

我们用它来监控数以千计的服务。它非常擅长它的工作。

它可能不太适合处理的记录数量，至少我们不会那样使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T16:44:47.537

我们使用[Nagios](http://www.nagios.org/)

我会提供更多细节，但我们的管理员设置了它，所以希望有人可以在评论中提供更多信息。我所知道的是，我们用它来托管几个客户网站，这些网站相当大，流量也很大。它工作得非常好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T13:20:56.917

+1 为 OpenNMS。除了开箱即用的系统级监控之外，它还可以使用 JMX 轻松扩展，因此您的应用程序可以将其内部结构公开为 JMX 属性，OpenNMS 可以监控它们、绘制图表、基于它们发出警报，等等

我们还扩展了 OpenNMS 以在出现问题时发送 SMS 警报。

# openid - 如何解决 OpenID 提供商停机问题？

> ID：140613
> 
> 赞同：10
> 
> 时间：2008-09-26T16:42:48.290
> 
> 标签：openid

OpenID 一切都很好......直到提供者关闭。那时，您可能会被锁定在一切之外（因为您加入了潮流并在任何可能的地方应用了 OpenID）。

*出现这个问题是因为我一生都无法使用**myopenid.com**提供商登录。:-(*

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T16:44:42.843

解决方法是让您的 OpenID 站点接受每个用户帐户的多个 OpenID。规范推荐的东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T16:53:33.117

这就是为什么我使用我的个人网站将 OpenID 服务委托给另一个网站的原因。如果 WordPress.com（我当前选择的提供商）出现故障，我只需将网站中的代码切换为指向不同的提供商。几秒钟后，我就可以恢复运行了。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-16T11:52:32.753

答案很简单。为用户存储电子邮件。拥有自己的登录机制。使 OpenId 可选是对此的直接答案。

不幸的是，有些网站对 OpenId 持封闭态度。

# svn - 如何使用提交后挂钩将提交的文件从 SVN 复制到 Web 目录？

> ID：140614
> 
> 赞同：10
> 
> 时间：2008-09-26T16:43:01.817
> 
> 标签：svn, apache, apache2

我的 Ubuntu 服务器安装了 Apache 和 Subversion。我将此服务器用作临时服务器，纯粹用于测试目的。我使用 Apache 来托管 Web 应用程序，并使用 Subversion 来保存源代码的版本副本。

我目前的工作流程：

*   对文件进行更改
*   将文件提交到 Subversion 存储库
*   通过 SFTP 将新文件上传到 Apache 公共目录
*   在我的网络浏览器中查看更改

如果我的工作流程是这样的，我会更开心：

*   对文件进行更改
*   将文件提交到 Subversion 存储库
*   *在后台，Subversion 将提交文件的副本放入 Apache 公共目录*
*   在我的网络浏览器中查看更改

我几乎没有服务器管理经验，感谢任何帮助或指点。我听说提交后挂钩是我所需要的，并且我可以编写 bash 脚本来执行此操作，但我不确定从哪里开始，并且经过大量的谷歌搜索后并没有真正找到任何东西。

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T16:47:15.160

“官方”答案就在这里。

[我正在我的存储库中管理一个网站。如何使实时站点在每次提交后自动更新？](http://subversion.apache.org/faq.html#website-auto-update)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T16:49:01.740

可以做到，但自动将每个提交推送到生产网站并不总是一个好主意。有时还需要进行其他更改，并且由于新代码在那里而破坏了站点，但数据库架构尚未更新，这令人尴尬。

我倾向于做的是让服务器结帐为 svn 的副本，然后，一旦我准备好必须发生的所有其他事情，我就会对其进行 svn 更新。

但是如果你真的想要，你可以将命令放在提交后触发器中，它会自动为你做所有事情。这可能包括在服务器上运行迁移脚本（如果存在用于此更改的脚本），以处理需要发生的任何非代码更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T21:02:28.353

我认为您应该问自己的*真正的总体问题（当然，您可能已经问过自己）是：“如何在部署代码之前最轻松地测试我的代码？”*

我认为一个好的答案是在你的开发机器上安装 Apache 并以你自己的用户身份运行它，webroot 和/或 cgi 路径位于`/home/richardhenry/src/mywebsite`（或任何你检查你的代码的地方）。

这样，您甚至可以在不提交的情况下测试您的代码。因此，您不会在您的树干上乱扔损坏或无用的提交。一般来说，保持独立的事物独立往往是一个好主意（TM）。

或者，使用 rsync 将 Web 服务器与您的工作目录同步，或者编写一个脚本，将您的文件从开发箱推送到您的登台服务器，并添加一个运行您的脚本（或调用 rsync）的 Makefile 规则。如果您想*真正*花哨，请使用 inotify 或其他一些文件通知监视器来自动运行您的脚本。

# .net - 是否有显示所有属性名称/值的 NAnt 任务？

> ID：140616
> 
> 赞同：12
> 
> 时间：2008-09-26T16:43:25.310
> 
> 标签：.net, ant, build, build-automation, nant

是否有一个 NAnt 任务会回显当前在构建期间设置的所有属性名称和值？可能相当于 Ant [echoproperties](http://ant.apache.org/manual/Tasks/echoproperties.html)任务的东西？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-26T18:36:10.873

试试这个片段：

```
<project>
    <property name="foo" value="bar"/>
    <property name="fiz" value="buz"/>

    <script language="C#" prefix="util" >
        <code>
            <![CDATA[
            public static void ScriptMain(Project project) 
            {
                foreach (DictionaryEntry entry in project.Properties)
                {
                    Console.WriteLine("{0}={1}", entry.Key, entry.Value);
                }
            }
            ]]>
        </code>
    </script>
</project> 
```

您可以保存并使用 nant 运行。

不，没有任务或功能可以为您执行此操作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-07T23:22:26.927

我希望对它们进行排序，所以我扩展了另一个答案。它不是很有效，但它有效：

```
<script language="C#" prefix="util" >
    <references>
        <include name="System.dll" />
    </references>       
    <imports>
        <import namespace="System.Collections.Generic" />
    </imports>      
    <code>
        <![CDATA[
        public static void ScriptMain(Project project) 
        {
            SortedDictionary<string, string> sorted = new SortedDictionary<string, string>();
            foreach (DictionaryEntry entry in project.Properties){
                sorted.Add((string)entry.Key, (string)entry.Value);
            }
            foreach (KeyValuePair<string, string> entry in sorted)
            {
                project.Log(Level.Info, "{0}={1}", entry.Key, entry.Value);
            }
        }
        ]]>
    </code>
</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-11-27T17:04:02.793

我尝试了 Brad C 建议的解决方案，但它们对我不起作用（在 x64 上使用 NAnt 0.92 运行 Windows 7 Profession）。但是，这适用于我的本地配置：

```
<target name="echo-properties" verbose="false" description="Echo property values" inheritall="true">
<script language="C#">
    <code>
    <![CDATA[
        public static void ScriptMain(Project project)
        {
        System.Collections.SortedList sortedByKey = new System.Collections.SortedList();
        foreach(DictionaryEntry de in project.Properties)
        {
            sortedByKey.Add(de.Key, de.Value);
        }

        NAnt.Core.Tasks.EchoTask echo = new NAnt.Core.Tasks.EchoTask();
        echo.Project = project;

        foreach(DictionaryEntry de in sortedByKey)
        {
            if(de.Key.ToString().StartsWith("nant."))
            {
                continue;
            }
            echo.Message = String.Format("{0}: {1}", de.Key,de.Value);
            echo.Execute();
        }
        }
    ]]>
    </code>
</script>
</target> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T17:14:31.227

你无法证明是否定的，但我找不到也没有见过。我传统上滚动我自己的财产回声。

# web-services - 会话变量和 Web 服务

> ID：140627
> 
> 赞同：10
> 
> 时间：2008-09-26T16:44:43.293
> 
> 标签：web-services, session

我刚刚编写了我的第一个 Web 服务，所以让我们假设我的 Web 服务知识不存在。我想尝试从 Web 服务调用 dbClass 函数。但是我需要会话中的一些参数。有什么办法可以让这些从 web 服务调用这些会话变量？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T16:51:08.117

如果您正在使用 ASP.NET Web 服务，并且希望为您维护一个会话环境，则需要使用指示您需要会话的属性来修饰您的 Web 服务方法。

```
[WebMethod(EnableSession = true)]
public void MyWebService()
{
    Foo foo;
    Session["MyObjectName"] = new Foo();
    foo = Session["MyObjectName"] as Foo;
} 
```

完成此操作后，您可以访问类似于 aspx 的会话对象。

地铁。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T16:56:31.597

您应该避免增加服务层添加会话变量的复杂性。正如之前有人指出的那样，将 Web 服务视为孤立的方法，它们从参数列表中获取执行任务所需的所有内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T16:52:32.527

一般来说，Web 服务不应依赖会话数据。把它们想象成普通的方法：参数输入，答案出来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-06T10:59:48.117

如果你需要 Session["username"].ToString(); 与 aspx 后面的其他 C# 页面一样，您只需将 WebService 方法上方的 [WebMethod] 替换为 [WebMethod(EnableSession = true)]

感谢:) 地铁

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T16:48:09.823

也许这会起作用 HttpContext.Current.Session["Name] 否则您可能必须接受一些参数或将它们存储在数据库中

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T16:52:37.253

你的问题有点模糊，但我会尽力回答。

我假设您的会话变量存在于进行 web 服务调用的服务器上，而不是托管 web 服务的服务器上。在这种情况下，您需要将必要的值作为 Web 服务方法的参数传递。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-05-16T15:18:31.423

要在 web 服务中使用会话，我们必须遵循 2 个步骤-

1.  在方法上使用 [WebMethod(EnableSession = true)] 属性。
2.  Session["Name"] =50 (你想保存什么) 请检查以下示例。

```
[WebMethod(EnableSession = true)]  
公共无效保存名称（字符串pname）  
{  
   会话[“名称”] = pname;  

 }  

```

# visual-studio-2008 - VS 数据库项目中缺少“显示所有文件”选项

> ID：140632
> 
> 赞同：3
> 
> 时间：2008-09-26T16:45:54.413
> 
> 标签：visual-studio-2008, database-project

VS 数据库项目在解决方案资源管理器中似乎没有“显示所有文件”选项。有谁知道在VS中打开选项的方法？

解决方案资源管理器上的“显示所有文件”选项实际上做了两件事。选择该选项后，VS 在项目中显示“隐藏/嵌套”文件，并显示项目目录中当前不属于项目的文件。（它用幻影图标显示后者。）

虽然数据库项目在项目中可能没有嵌套或隐藏文件，但我知道没有其他方法可以让解决方案资源管理器在目录中显示不属于项目的文件。

此外，虽然此操作发生在解决方案资源管理器中，但它实际上是一个项目问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2015-12-09T03:48:32.703

这个问题的正确答案是：-

您必须在解决方案资源管理器中选择数据库项目根节点。

在解决方案资源管理器中选择数据库项目根节点以外的任何其他节点将导致“显示所有文件”按钮隐藏。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-26T16:47:44.847

这是设计使然。某些项目类型只是不允许您这样做。您也许可以进入记事本中的 sln 文件并尝试一些东西，但它可能只会搞砸您的解决方案。

# installation - NSIS 获取当前正在运行的安装程序文件的路径

> ID：140640
> 
> 赞同：27
> 
> 时间：2008-09-26T16:47:25.503
> 
> 标签：installation, nsis

是否有 NSIS var 来获取当前运行的安装程序的路径？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-26T16:51:12.827

找到它：$EXEPATH

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2017-05-10T09:12:38.043

有几个有用的变量：

*   `$EXEPATH`- 保存安装程序文件名。
*   `$EXEDIR`- 保存安装程序的完整路径。

所以根据题目

> NSIS 获取当前正在运行的安装程序文件的**路径**

最合适的是`$EXEDIR`。

# oracle - ORA-01031: 选择视图时权限不足

> ID：140643
> 
> 赞同：30
> 
> 时间：2008-09-26T16:47:51.977
> 
> 标签：oracle, view

当我尝试执行包含来自不同模式的表的视图时，会引发 ORA-001031 权限不足。这些表对创建视图的架构具有执行权限。如果我执行视图的 SQL 语句，它就可以工作。我错过了什么？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-26T18:47:15.933

最后我让它工作了。史蒂夫的回答是正确的，但并非适用于所有情况。当从第三个模式执行该视图时，它会失败。为此，您必须添加授权选项：

```
GRANT SELECT ON [TABLE_NAME] TO [READ_USERNAME] WITH GRANT OPTION; 
```

这样，`[READ_USERNAME]`还可以将视图的选择权限授予另一个模式

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-26T16:53:33.290

作为表所有者，您需要向运行 SELECT 语句的用户授予对基础表的 SELECT 访问权限。

```
grant SELECT on TABLE_NAME to READ_USERNAME; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-15T18:27:12.267

问：什么时候需要“授予选项”？

A. 当您从第三个模式执行视图时。

示例：模式 DSDSW 有一个名为 view_name 的视图

```
a) that view selects from a table in another schema  (FDR.balance)
b) a third shema  X_WORK  tries to select  from that view 
```

典型授权：将 dsdw.view_name 上的 select 授权给 dsdw_select_role；将 dsdw_select_role 授予 fdr；

但是：fdr 从 dsdw.view_name 获取 select count(*)；第 1 行出现错误：ORA-01031：权限不足

发放补助金：

```
grant select on fdr.balance to dsdw with grant option; 
```

现在 fdr：从 dsdw.view_name 中选择 count(*)；5行

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-16T22:13:37.053

让我回顾一下。

当您构建包含不同所有者对象的视图时，其他所有者必须向视图的所有者授予“带有授予选项”的权限。因此，视图所有者可以授予其他用户或模式......

示例： User_a 是名为 mine_a 的表的所有者 User_b 是名为 yours_b 的表的所有者

假设 user_b 想要创建一个包含 mine_a 和 yours_b 的视图

为了使视图正常工作，user_a 必须将“将 mine_a 上的选择授予 user_b 与授予选项”

然后 user_b 可以将该视图上的选择授予每个人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T17:07:27.967

如果通过存储过程访问视图，则执行授权不足以访问该视图。您必须明确授予 select 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-05-16T15:45:25.420

如果通过存储过程访问视图，则执行授权不足以访问该视图。您必须明确授予 select 。

只需输入这个

全部公开；

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-20T14:04:38.060

要使用视图，用户必须具有适当的权限，但仅限于视图本身，而不是其底层对象。但是，如果删除了视图底层对象的访问权限，则用户将不再具有访问权限。出现此问题的原因是用户查询视图时使用的安全域是视图定义者的安全域。如果从视图的定义者中撤销对底层对象的权限，则视图将变为无效，并且任何人都无法使用该视图。因此，即使已授予用户访问视图的权限，如果定义者的权限已从视图的底层对象中撤消，则用户可能无法使用该视图。

Oracle 文档 [http://docs.oracle.com/cd/B28359_01/network.111/b28531/authorization.htm#DBSEG98017](http://docs.oracle.com/cd/B28359_01/network.111/b28531/authorization.htm#DBSEG98017)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-09-03T07:26:03.177

您还可以使用架构名称创建视图，例如 **创建或替换视图 schema_name.view_name 为 select..**

# erlang - 我在哪里可以找到 Erlang shell 的文档？

> ID：140648
> 
> 赞同：5
> 
> 时间：2008-09-26T16:48:36.157
> 
> 标签：erlang

[Erlang 文档](http://www.erlang.org/doc/)包含模块的文档。

我在哪里可以找到 Erlang shell 的文档？（我想这不是一个模块。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T16:58:37.847

[文档中的这个页面](http://www.erlang.org/doc/getting_started/seq_prog.html#2.1)似乎是一个起点。尤其是里面的链接。还要检查其中的[第一个链接](http://www.erlang.org/doc/man/shell.html)，以及 shell 的联机帮助页。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T17:00:25.190

我正在使用[Erlang 入门](http://www.erlang.org/download/getting_started-5.4.pdf)，第 1.2.1 章。它与外壳有关，可让您加快使用速度等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-03T11:03:13.687

我认为 Erlang shell 也是一个模块。看看这个：[Erlang shell](http://www.erlang.org/doc/man/shell.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T19:52:24.930

[这](http://carpanta.dc.fi.udc.es/docs/erlang/dbg.html)也可能会有所帮助，以及[this](http://www.ejabberd.im/interconnect-erl-nodes)。

# refactoring - 你应该多久重构一次？

> ID：140677
> 
> 赞同：61
> 
> 时间：2008-09-26T16:59:24.850
> 
> 标签：refactoring

几周前，我与一些同事就重构进行了讨论，我似乎属于少数人，他们认为“尽早重构，经常重构”是一种防止代码变得混乱和不可维护的好方法。许多其他人认为它只属于项目的维护阶段。

如果你有意见，请捍卫它。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-09-26T17:00:42.460

就像你说的：早重构，经常重构。

尽早重构意味着必要的更改仍然在我脑海中浮现。重构通常意味着更改往往更小。

延迟重构只会导致一团糟，这进一步使重构变得更加困难。一旦我注意到乱七八糟的东西就立即清理可以防止它堆积起来并在以后成为问题。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-26T17:01:55.967

我会尽快重构代码（所有测试都通过）。通过这种方式，我可以在它还记忆犹新的时候清理它，并且在其他人看到第一个版本有多丑之前。

在初次签入后，我通常会在每次接触一段代码时进行重构。重构不是你应该单独留出时间的事情。这应该是你边走边做的事情。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-26T17:13:15.580

您戴着两顶帽子编写代码。刚刚得到的*东西工作的*帽子和*我需要理解这个明天的*帽子。显然，第二顶帽子是重构帽子。因此，每当您完成某些工作但（不可避免地）引入了重复代码、长方法、脆弱的错误处理、错误的变量名等气味时，您都会进行重构......

在尝试使某些东西正常工作时进行重构（即戴上两顶帽子）对于重要的任务是不切实际的。但是将重构推迟到下一天/下一周/下一次迭代是非常糟糕的，因为问题的背景会从你的脑海中消失。因此，尽可能频繁地在帽子之间切换，但不要将它们组合在一起。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-09-26T17:01:08.963

我会重构我得到的每一个机会，因为它可以让我把我的代码磨练成最好的。即使在积极开发以防止首先创建不可维护的代码时，我也会这样做。它还经常让我在一个糟糕的设计决策变得无法修复之前纠正它。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-26T17:12:11.933

重构的三个好理由：

*   你最初的设计（也许在一个很小的区域，但仍然是设计）是错误的。这包括您发现常见操作并希望共享代码的位置。
*   您正在迭代设计。
*   代码太糟糕了，需要大修。

不重构的三个充分理由：

*   “这看起来有点乱”。
*   “我不完全同意最后一个人这样做的方式”。
*   “它可能更有效”。（那里的问题是“可能”）。

“凌乱”是有争议的——有一个有效的论点被称为“修复破碎的窗户”或“代码卫生”，这表明如果你让小东西滑动，那么你也会开始让大东西滑动。这很好，记住这是一件好事，但请记住这是一个类比。它不能原谅无休止地分流东西，以寻找最干净的解决方案。

你重构的频率应该取决于好的原因出现的频率，以及你对测试过程保护你免于引入错误的信心。

重构本身从来都不是目标。但是，如果某些东西不起作用，则必须对其进行修复，这在初始开发和维护中都是如此。对于重要的更改，几乎总是重构并干净地合并新概念，而不是用大量垃圾修补一个地方以避免其他地方的任何更改。

对于它的价值，只要我掌握了接口的用途，并且由此产生的更改的范围是可管理的，我认为更改接口并不重要。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-26T17:03:09.833

正如书中所说，你在什么时候重构

*   你添加一些代码......一个新功能
*   当您修复错误/缺陷时
*   当您与多人一起进行代码审查时
*   当您发现自己第三次重复某些内容时.. 3 次打击规则

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-26T20:18:20.487

我试着遵循这个座右铭：让你接触到的所有代码都比以前更好。

当我进行修复或添加功能时，我通常会利用这个机会对受影响的代码进行有限的重构。通常这可以更容易地进行我的预期更改，因此它实际上不需要任何成本。

否则，您应该为重构安排专门的时间，如果因为您总是在灭火（我想知道为什么）而无法做到，那么当您发现进行更改变得比应有的困难得多并且“代码有异味”时，您应该强迫自己进行重构简直无法忍受。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-26T17:03:18.507

很多时候，当我刷新想法时，我的代码开始时非常紧密耦合和混乱。当我开始完善这个想法时，逻辑分离开始变得越来越清晰，我开始重构。这是一个持续的过程，正如每个人都建议的那样，应该“尽早并经常”完成。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T17:09:11.393

我在以下情况下进行重构：

我正在修改代码，我对此感到困惑。如果我需要一段时间才能筛选出来，它需要重构。

我正在创建新代码，并且在我让它“工作”之后。很多时候我会让事情正常工作，当我编码时，我意识到“嘿，我需要重做我所做的 20 行，只需进行一些更改”。那时我重构并继续。

在我看来，唯一应该阻止你这样做的是时间限制。不管你喜不喜欢，有时候你只是没有时间去做。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-26T17:21:49.790

就像国家公园——总是让它比你发现它好一点。

对我来说，这意味着任何时候我打开代码，并且不得不挠头弄清楚发生了什么，我都应该重构一些东西。我的主要目标是提高可读性和理解性。通常它只是为了清楚起见重命名一个变量。有时它是提取方法 -

例如（琐碎），如果我遇到

```
temp = array[i];
array[i] = array[j];
array[j] = temp; 
```

我可能会用 swap(i,j) 方法替换它。

编译器无论如何都会内联它，并且 swap() 从语义上告诉每个人发生了什么。

话虽如此，使用我自己的代码（从头开始），我倾向于为设计进行重构。我经常发现在具体课程中工作更容易。完成并调试后，我将使用旧的提取接口技巧。

我将把它留给同事进行重构以提高可读性，因为我离代码太近而无法注意到这些漏洞。毕竟，我知道我的意思。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-26T17:53:03.503

机会主义地重构！只要*容易*就去做。

如果重构很困难，那么您是在错误的时间（当代码不需要它时）或在代码的错误部分（在其他地方可以获得更好的效率）进行重构。（或者你还不太擅长重构。）

为“维护”保存重构是一种重言式。重构*就是*维护。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-29T20:12:07.780

每次**阅读**任何内容时我都会进行重构，使其**更具可读性**。不是重大重组。但是，如果我对自己说“这`List`包含什么？哦，`Integer`s！” 然后我将其更改为`List<Integer>`. 另外，我经常在IDE中提取方法来放几行代码的好名字。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-26T17:01:47.247

答案总是，但更具体地说：

*   假设您为每个任务分支，然后在每个新分支上，然后再进行 QA。
*   如果您在主干中开发所有内容，那么在每次提交之前。
*   维护旧代码时，将上述内容用于新任务，对于旧代码，请在主要版本上进行重构，以获得额外的 QA。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-26T17:01:24.597

每次遇到需要。至少当您要更改需要重构的一段代码时。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-26T17:36:04.577

我将重构本地化为与我当前任务相关的代码。我尝试预先进行重构。我单独提交这些更改，因为从功能的角度来看，它与实际任务无关。这样代码更干净，修订历史也更干净。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-26T17:50:45.927

“尽早重构，经常重构”是一个富有成效的指导方针。虽然那种假设你真的知道代码。系统越老，重构就越危险，需要更多的考虑。在某些情况下，重构需要管理任务、工作量和时间估计等。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-26T20:54:05.177

不断地，在合理的范围内。您应该始终寻找改进软件的方法，但您必须小心避免为了重构而重构的情况（Refactorbation）。

如果您可以证明重构将使一段代码更快、更易于阅读、更易于维护或更容易或为业务提供一些其他价值，我说去吧！

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-06-23T17:31:39.820

如果您有一个可以安全地进行更改的重构工具，那么您应该**在代码编译时进行**重构，如果它会使代码更清晰。

如果您没有这样的工具，您应该**在测试为绿色时进行**重构，如果它会使代码更清晰。

做些小改动——重命名一个方法，让它的作用更清晰。提取一个类，使一组相关变量明确相关。重构不是要进行大的更改，而是要让事情分分钟变得更干净。重构是在每顿饭后清理你的盘子，而不是等到每个表面都被脏盘子覆盖。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-26T17:02:27.900

绝对只要它看起来权宜之计。如果你不这样做，痛苦就会增加。

自从切换到 Squeak（我现在似乎在每篇文章中都提到）后，我意识到在原型设计期间的许多设计问题都消失了，因为在那种环境下重构真的很容易。老实说，如果你没有一个重构基本上是无痛的环境，我建议你尝试 squeak 只是为了知道它会是什么样子。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-26T21:51:15.833

经常重构通常可以节省时间，或者至少可以节省一些时间。我正在做一个项目，我们在达到某个里程碑后重构了所有代码。这是一个很好的方法，因为如果我们需要删除不再有用的代码，它可以更容易地修补我们需要的任何新东西。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-11-11T07:44:59.527

我们现在正在讨论这个问题。我们或多或少同意“写它让它工作，然后修复它”。但我们在时间角度上存在分歧。我更“立即修复它”，我的同事更“在下一次迭代中修复它”。

一些支持他的引用：

雅虎高级 Javascript 架构师 Douglas Crockford：

> 每 7 个 sprint 重构一次。

肯汤普森（unix 人）：

> 代码本身几乎腐烂，它会被重写。即使什么都没有改变，由于某种原因它也会腐烂。

我希望一旦完成了提交的代码的任务，您可以在 2 个月内返回并认为“是的，我在这里做得很好”。我不相信以后找时间回来修复它是不容易的。从我的角度来看，相信这有点幼稚。

编辑：拼写错误

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-26T17:03:51.347

我认为当你目前正在处理它的一部分时，你应该重构一些东西。意味着如果您必须增强功能 A，那么您应该在之前（和之后？）重构它。如果您不使用此功能做任何事情，那么只要您有其他事情要做，就让它保持原样。

不要重构系统的工作部分，除非你已经不得不改变它。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-26T17:04:55.197

关于这个主题有很多观点，其中一些与特定的方法或开发方法有关。使用 TDD 时，尽早进行重构，正如您所说，重构通常是一种受欢迎的方法。

在其他情况下，您可以根据需要进行重构。例如，当您发现重复代码时。

当采用更传统的方法进行详细的前期设计时，重构的频率可能会降低。但是，我建议不要在项目结束之前进行重构。您不仅可能会引入问题，可能是 UAT 之后的问题，而且重构通常也会变得越来越困难。出于这个原因，经典项目的时间限制导致重构和额外的测试被放弃，当维护开始时，你可能已经创建了一个意大利面条代码怪物。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-26T17:08:08.713

如果它没有损坏，请不要重构它。

我想说重构的时间属于初始编码阶段，您可以随意多次进行重构。一旦它在客户手中，那么它就变成了另一回事。您不想为自己“整理”代码而发现它被运送并破坏了某些东西。

初始交付后重构的时间就是你说你会做的时候。当代码变得有点太臭了，然后有一个包含重构的专用版本，可能还有一些更重要的修复。这样，如果你碰巧弄坏了东西，你知道哪里出了问题，你可以更容易地修复它。如果你一直在重构，你会破坏一些东西，直到它得到 QAd 你才会知道它已经坏了，然后你将很难弄清楚是错误修复/功能代码更改导致了问题，还是某些问题您在很久以前进行的重构。

当代码看起来与以前大致相同时，检查 cbreak 更改会容易得多。重构很多代码结构，你可以让它几乎不可能，所以只有在你认真的时候才重构。像对待任何其他产品代码更改一样对待它，你应该没问题。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-26T17:48:09.257

我认为这篇 Top 100 Wordpress 博客文章可能有一些很好的建议。 [http://blog.accurev.com/2008/09/17/dr-strangecode-or-how-i-learned-to-stop-worrying-and-love-old-code/](http://blog.accurev.com/2008/09/17/dr-strangecode-or-how-i-learned-to-stop-worrying-and-love-old-code/)

# javascript - Firebug - 如何运行多行脚本或创建新的 JavaScript 文件？

> ID：140680
> 
> 赞同：4
> 
> 时间：2008-09-26T17:00:19.263
> 
> 标签：javascript, firefox, firebug

Firebug 中有没有办法启动一个新的脚本文件以应用于页面？基本上我想做的工作就像我通常在 Firebug 控制台上所做的那样，但能够粘贴多行函数等。控制台似乎不适合这样做。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T17:03:03.093

在 FireBug UI 的右下角，您应该会看到一个带有向上箭头的红色方形图标。使用它并将其拉伸到您喜欢的大小。

* * *

[![截屏](https://i.stack.imgur.com/SE7Ai.gif)](https://i.stack.imgur.com/SE7Ai.gif)

[![截屏](https://i.stack.imgur.com/eG63w.gif)](https://i.stack.imgur.com/eG63w.gif)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T17:05:57.033

也许不在 firebug 中，但您可以尝试一些类似于 jQuery 书签的技术。

[书签链接](http://erikandcolleen.com/erik/projects/jquery/bookmarklet/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T17:15:15.577

这个想法怎么样：

假设您的页面已经可以有引用[jQuery](http://jquery.com/)的脚本标签和一个['Script Include' jQuery plugin](http://meta20.net/.include_script_inclusion_jQuery_plugin)，那么在控制台中您可以任意执行以下操作：

$.include(' [http://example.com/scripts/some_script.js](http://example.com/scripts/some_script.js) ');

# multithreading - 哪些高级语言支持多线程？

> ID：140696
> 
> 赞同：16
> 
> 时间：2008-09-26T17:04:07.100
> 
> 标签：multithreading, programming-languages

我想知道哪些语言支持（或不支持）本机多线程，也许会得到一些关于实现的细节。希望我们可以对这个特定功能进行完整的概述。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T17:21:01.367

[Erlang](http://en.wikipedia.org/wiki/Erlang_programming_language "维基百科")内置了对[并发编程](http://www.erlang.org/doc/getting_started/conc_prog.html#3)的支持。

严格来说，Erlang 进程是greenlets。但是语言和虚拟机是从头开始设计的，以支持并发性。该语言具有用于异步进程间消息传递的特定控制结构。

在 Python 中，[greenlet](http://codespeak.net/py/dist/greenlet.html)是一个第三方包，提供轻量级线程和基于通道的消息传递。但它不承担与 Erlang 的比较。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-27T08:12:48.913

我认为比[Haskell更高级的语言列表很短，并且对](http://haskell.org/)[并发和并行性](http://haskell.org/haskellwiki/Applications_and_libraries/Concurrency_and_parallelism)有很好的支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T17:08:12.177

旧版本的 C 和 C++（即 C89、C99、C++98 和 C++03）在核心语言中根本不支持，尽管 POSIX 线程等库可用于普通用户的几乎所有平台今天。

C 和 C++ 的最新版本，C11 和 C++11，确实在语言中内置了线程支持，但它是 C11 的一个可选特性，因此单核嵌入式系统等实现可以选择不支持它，而如果他们愿意，可以支持 C11 的其余部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T17:13:04.287

使用 CPython，必须记住[GIL](http://en.wikipedia.org/wiki/Global_Interpreter_Lock)。总结一下：即使在多处理器机器上，也只使用一个处理器。正如评论所示，有多种方法可以解决这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T12:57:49.550

[Clojure](http://clojure.org/)是一种用于 JVM 的新兴 Lisp 方言，专门设计用于处理并发。

它具有函数式 API、各种不可变数据结构的一些*非常有效的实现和代理系统（有点像 Scala 中的演员和 Erlang 中的进程）。*它甚至具有软件事务内存。

总而言之，Clojure 竭尽全力帮助您编写正确的多线程并发代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T17:22:27.370

Delphi/FreePascal 也支持线程。

我会从其他答案中假设它仅在 Windows 平台上是本机的。

一些在 TThread 对象之上实现更好功能的不错的库：

*   [全线程库](http://code.google.com/p/omnithreadlibrary/)
*   [BMThread](http://www.mitov.com/html/free_downloads.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-28T07:37:46.977

这个问题没有意义：特定实现选择将线程实现为原生线程还是绿色线程与语言无关，这是一个内部实现细节。

有使用本机线程的 Java 实现和使用绿色线程的 Java 实现。
有使用本机线程的 Ruby 实现和使用绿色线程的 Ruby 实现。
有使用本机线程的 Python 实现和使用绿色线程的 Python 实现。
甚至还有使用绿色线程的 POSIX 线程实现，例如旧的 LinuxThreads 库或 GNU pth 库。

并且仅仅因为实现使用本机线程并不意味着这些线程实际上可以并行运行。许多实现使用全局解释器锁来确保一次只能运行一个线程。另一方面，使用绿色线程并不意味着它们不能并行运行：例如，BEAM Erlang VM 可以跨多个 CPU 内核调度其绿色线程（更准确地说是绿色进程），Rubinius 也是如此红宝石虚拟机。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-28T08:09:38.290

Perl 没有有用地支持本机线程。

是的，有一个 Perl 线程模块，是的，它在实现中使用了本机平台线程。问题是，它在一般情况下不是很有用。

当您使用 Perl 线程创建新线程时，它会复制 Perl 解释器的整个状态。这非常慢并且使用大量内存。事实上，它可能比在 Unix 上使用 fork() 慢，因为后者使用写时复制，而 Perl 线程不使用。

* * *

但总的来说，每种语言都有自己的线程模型，有些与其他语言不同。Python（大部分）使用本机平台线程，但有一个大锁，可确保一次只运行一个（Python 代码）。这实际上有一些优点。

这些天线程不是过时而有利于流程吗？（想想谷歌浏览器，IE8）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-28T09:00:10.663

我最近为 Lua 做了一个多线程扩展，叫做[Lua Lanes](http://luaforge.net/projects/lanes/)。它将多线程概念如此自然地融合到语言中，我认为“内置”多线程不会更好。

作为记录，Lua 内置的协作多线程（协程）通常也可以使用。有或没有车道。

Lanes 没有 GIL，每个线程在不同的 Lua 宇宙中运行代码。因此，除非您的 C 库崩溃，否则它不会受到与线程使用相关的问题的影响。事实上，这个概念更像是进程和消息传递，尽管只使用了一个 OS 进程。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T17:08:50.677

我相信官方 squeak VM 不支持本机 (OS) 线程，但 Gemstone 版本支持。

（如果不正确，请随时编辑）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T17:09:06.247

您需要在此上下文中定义“本机”。

Java声称某种内置的多线程，但只是基于粗粒度锁定和一些库支持。目前，它并不比带有 POSIX 线程的 C 更“原生”。下一版本的 C++ (0x) 也将包括一个线程库。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T17:09:37.650

我知道 Java 和 C# 支持多线程，并且下一版本的 C++ 将直接支持它......（计划的实现可作为 boost.org 库的一部分......）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-26T17:10:25.307

[Boost::thread](http://www.boost.org/doc/libs/1_36_0/doc/html/thread.html)很棒，但我不确定你是否可以说它是语言的一部分。这取决于您是否认为 CRT/STL/Boost 是 C++ 的“一部分”，或者是可选的附加库。

（否则实际上没有语言具有本机线程，因为它们都是操作系统的功能）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-26T17:09:52.313

[Perl](http://perldoc.perl.org/threads.html)和[Python](http://docs.python.org/lib/module-thread.html)可以。Ruby 正在研究它，但 Ruby 1.8 中的线程并不是真正的线程。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-01-30T04:58:46.790

最后`Go`是带有自己的 pkg 的多线程`Goroutine`。人们说它是关于`C-language`. 它也易于使用和理解。

# spring-mvc - Glassfish：使用非根上下文部署的 Web 应用程序解释相对于 domain1/docroot 的请求

> ID：140708
> 
> 赞同：6
> 
> 时间：2008-09-26T17:07:49.043
> 
> 标签：spring-mvc, glassfish

webapp 使用 Spring MVC。

```
<bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
    <property name="urlMap">
        <map>
            <entry key="/*" value-ref="defaultHandler"/>
        </map>
    </property>
    <property name="order" value="2"/>
</bean>
<bean name="defaultHandler" class="org.springframework.web.servlet.mvc.UrlFilenameViewController"/>

<bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
    <property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
    <property name="prefix" value="/"/>
    <property name="suffix" value=""/>        
</bean> 
```

所以像这样的请求`http://localhost:8080/application-context-folder/index.jsp` 应该解析到application-context-folder/index.jsp，它们解析到domain1/docroot/application-context-folder。

是设计使然还是我需要更改应用程序或配置中的某些内容？

@Edit：有一个错字，请求的 URL 是`http://localhost:8080/application-context-folder/index.jsp, not http://localhost:8080/index.jsp`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-11-07T13:57:48.027

使用重定向到您的应用程序上下文。在您的域的 docroot 文件夹中放置一个 index.html 文件。文件可能看起来像这样：

```
<html>
<head>
<title>Your application title</title>
<frameset>
<frame src="http://localhost:8080/[application_context]">
</frameset>
</head>
<body>
Redirecting to <a href="http://localhost:8080/[application_context]">Some title</a>...
</body> 
```

# php - 如何确保用户输入的包含国际字符的数据不会损坏？

> ID：140728
> 
> 赞同：19
> 
> 时间：2008-09-26T17:13:02.273
> 
> 标签：php, mysql, internationalization

即使 MySQL 数据库、表和字段的排序规则设置为 utf8_general_ci ，经常会发生诸如*é*之类的字符转换为*Ã©的情况。**页面的Content-Type*中的编码也设置为 UTF8。

我知道 utf8_encode/decode，但我不太确定在哪里以及如何使用它。

我已阅读“[每个软件开发人员绝对、肯定必须了解 Unicode 和字符集（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html) ”文章，但我需要一些 MySQL / PHP 特定的指针。

如何确保用户输入的包含国际字符的数据不会损坏？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T18:01:31.050

在第一次查看[http://www.nicknettleton.com/zine/php/php-utf-8-cheatsheet](http://www.nicknettleton.com/zine/php/php-utf-8-cheatsheet)时，我认为缺少一件重要的事情（也许我忽略了这一点）。根据您的 MySQL 安装和/或配置，您必须设置连接编码，以便 MySQL 知道您在客户端期望什么编码（意味着 MySQL 连接的客户端，应该是您的 PHP 脚本）。您可以通过手动发出

```
SET NAMES utf8 
```

在您发送到 MySQL 服务器的任何其他查询之前查询。

如果您在 PHP 端使用 PDO，则可以设置连接以在每次（重新）连接时自动发出此查询，方法是使用

```
$db=new PDO($dsn, $user, $pass);
$db->setAttribute(PDO::MYSQL_ATTR_INIT_COMMAND, "SET NAMES utf8"); 
```

初始化数据库连接时。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-27T13:13:13.480

排序规则和字符集不是一回事。您的排序规则需要匹配字符集，因此如果您的字符集是 utf-8，则排序规则也应如此。选择错误的排序规则不会混淆您的数据 - 只是让字符串比较/排序工作错误。

也就是说，有几个地方可以在 PHP 中设置字符集设置。如果可能，我建议您始终使用 utf-8。需要指定字符集的地方是：

*   数据库。这可以在数据库、表和字段级别，甚至在每个查询级别上设置。
*   PHP 和数据库之间的连接。
*   HTTP 输出；确保 HTTP 标头`Content-Type`指定 utf-8。您可以在 PHP 和 Apache 中设置默认值，也可以使用 PHP 的[`header`](http://docs.php.net/manual/en/function.header.php)函数。
*   HTTP 输入。通常，表单将以与提供页面相同的字符集提交，但要确保，您应该指定[`accept-charset`](http://reference.sitepoint.com/html/form/accept-charset)属性。还要确保 URL 是 utf-8 编码的，或者避免在 url 中使用非 ascii 字符（以及 GET 参数）。

[`utf8_encode`](http://docs.php.net/manual/en/function.utf8-encode.php)/decode 函数的名字有点奇怪。它们专门在 latin1 (ISO-8859-1) 和 utf-8 之间进行转换。如果您的应用程序中的所有内容都是 utf-8，则您不必过多使用它们。

关于 utf-8 和 PHP，至少有两个陷阱。首先是 PHP 的内置字符串函数期望字符串是单字节的。对于很多操作来说，这无关紧要，但它意味着你不能依赖[`strlen`](http://docs.php.net/manual/en/function.strlen.php)其他功能。[在这个页面上](http://www.phpwact.org/php/i18n/utf-8)有一个很好的限制。通常，这不是什么大问题，但特别是在使用 3 方库时，您需要注意这可能会导致问题。一种选择是使用 mb_string 扩展，它可以选择用 utf-8 感知的替代方案替换所有麻烦的函数。它仍然不是 100% 防弹的解决方案，但它适用于大多数情况。

另一个问题是 PHP 的某些安装仍然[`magic_quotes`](http://docs.php.net/manual/en/info.configuration.php#ini.magic-quotes-runtime)打开了该设置。这个问题与 utf-8 正交，但可能会导致一些头疼。关掉它，为了你自己的理智。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-27T12:37:39.167

你应该做的事情：

*   确保 Apache 输出 UTF-8 内容。在您的 httpd.conf 中执行此操作，或使用 PHP 的`header()`-function 手动执行此操作。
*   确保您的数据库连接是 UTF8。`SET NAMES utf8`成功了。
*   确保所有表都设置为 UTF8。
*   如果您在其中存储国际字符，请确保所有 PHP 和模板文件都被编码为 UTF8。

执行此操作时，您通常不必使用`mb_string`or函数做太多`utf8_encode/decode`事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T18:04:57.157

为了更好的 unicode 正确性，您应该使用 utf8_unicode_ci （尽管文档对差异有点模糊）。您还应该确保正确设置了以下 Mysql 标志 -

*   默认字符集=utf8
*   skip-character-set-client-handshake //重要的是客户端不会强制执行另一种编码

这些可以在 mysql 配置文件（在 [mysqld] 选项卡下）或在运行时通过发送适当的查询来设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T19:30:38.957

不管它是用什么语言编写的，如果您要创建一个允许多种编码的应用程序，请分段处理：

*   识别编码
    *   不知何故，您想找出您正在处理的编码类型，否则，进一步考虑它是毫无意义的。你最终会得到垃圾字符。
*   处理你的字节
    *   认为这些字符串不太像字符的“字符串”，而更像是字节列表
    *   PHP 尤其狡猾。不要让它即时截断您的数据。如果您正在对 UTF-8 字符串进行正则表达式，请确保将其标识为这样
*   液晶显示器
    *   Again, you don't want to truncate data. If you're storing a sentence in English, can you also store a set of Mandarin glyphps? How about Arabic? Which of these is going to require the most space? Account for it.

# sql-server-2005 - 为什么要从 SQL2000 升级到 SQL2005？

> ID：140733
> 
> 赞同：6
> 
> 时间：2008-09-26T17:13:25.237
> 
> 标签：sql-server-2005, sql-server-2000, upgrade

我正在寻找您很高兴您已经从 SQL2000 跳转到 SQL2005 的一个最大原因。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T17:16:48.257

*   递归而不创建临时表。
*   本机异常支持（Try/Catch 而不是 if @Error goto）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T17:19:09.093

因为：

> Microsoft 提醒客户，对 SQL Server 2000 Service Pack 3a (SP3a) 的支持将于 2007 年 7 月 10 日结束。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T17:13:51.290

原生 XML 支持对我们来说很重要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T17:15:26.013

SSIS 支持。吹走 DTS，非常方便。:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T17:47:13.550

1.  SSRS - 对于我的组织来说，一个真正巨大的优势是拥有 SQL Server 2005 附带的免费报告工具。Reporting Services 使我能够在很短的时间内生成漂亮的报告，其中包含我们的经理需要的字段。它有一个内置工具，因此他们可以转换为 excel、pdf 或其他几种格式。这里物超所值。

2.  SSIS - 2005 中的集成服务对于 ETL（导出、转换、加载）功能非常强大。您可以设置自动化流程以按计划运行。

3.  SSAS - 分析服务看起来很有前途。我还没有制作任何数据立方体，因为我想组织一个实际的数据仓库。一旦你有了它，强大的数据挖掘算法就已经内置了。

看看 SQL Server 2005 中包含的这三个工具。如果我必须选择一个作为迁移到 2005 的最大原因，那将是 SSRS。

在这一点上，我建议查看 SQL Server 2008。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T19:16:15.077

异常处理...我们如何在 SQL 2000 上进行管理...？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T17:20:53.050

不（手动）创建临时表的分页是一个基本但巨大的改进。

但是，如果您要直接从数据表中拖放 ASP.NET 应用程序中的一些 GridView，您将在应用程序中进行分页...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T22:56:52.713

[PIVOT](http://geekswithblogs.net/lorint/archive/2006/08/04/87166.aspx). That beautiful little statement has saved me more time then any other SQL Server 2005 enhancement.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T17:24:20.967

CLR 集成

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T17:24:40.857

基于行版本的事务隔离

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T17:26:20.900

我认为最大的一个原因是Vista 不支持SQL 2000。因此，我不得不迁移到 SQL 2005。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T17:28:35.170

我不知道是不是只有我一个人，但 Linq2SQL 不能完全与 SQL 2000 完美配合。通常它应该根据来自模式的键、外键、RI 等的推断自动生成和填充子集合。在2005 年，但我在 2000 年运气不佳。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-26T17:29:20.270

公用表表达式已被证明非常有用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-06T22:54:21.643

Dynamic Management Views for Optimisation and to quickly find out the state of the server.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-26T17:40:52.787

您不能再通过“右键单击”来导出表格。这与其说是一个很好的理由，不如说是一个问题。

# php - 使用 PHP 和 MySQL 缓存调整大小图像的最佳方法

> ID：140734
> 
> 赞同：14
> 
> 时间：2008-09-26T17:13:31.277
> 
> 标签：php, image, caching, resize

使用 PHP 处理图像缓存的最佳实践方法是什么。

文件名当前存储在 MySQL 数据库中，该数据库在上传时重命名为 GUID，以及原始文件名和 alt 标签。

当图像被放入 HTML 页面时，它是使用 '/images/get/200x200/{guid}.jpg 之类的 url 完成的，它被重写为 php 脚本。这允许我的设计人员指定（大致 - 源图像可能更小）文件大小。

然后，php 脚本会创建一个大小为 200x200 的哈希值和 GUID 文件名，如果该文件之前已生成（TMP 目录中存在具有该哈希值的文件），则从应用程序 TMP 目录发送该文件。如果散列文件名不存在，那么它会被创建，写入磁盘并以相同的方式提供，

这是否有效？（它还支持对图像进行水印处理，并且水印设置也存储在哈希中，但这超出了此范围。）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-26T19:17:48.357

我会以不同的方式来做。

问题： 1\. 让 PHP 提供文件的效率低于其应有的效率。2\. PHP 必须在每次请求图像时检查文件是否存在 3\. Apache 在这方面比 PHP 做得更好。

这里有一些解决方案。

您可以`mod_rewrite`在 Apache 上使用。可以使用 mod_rewrite 来测试文件是否存在，如果存在，则改为提供该文件。这完全绕过了 PHP，并使事情变得更快。但是，真正做到这一点的方法是生成一个应该始终存在的特定 URL 模式，如果不存在则重定向到 PHP。

例如：

```
RewriteCond %{REQUEST_URI} ^/images/cached/
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
RewriteRule (.*) /images/generate.php?$1 [L] 
```

因此，如果客户端请求`/images/cached/<something>`并且该文件不存在，Apache 会将请求重定向到`/images/generate.php?/images/cached/<something>`. 这个脚本然后可以生成图像，将其写入缓存，然后将其发送到客户端。将来，除了新图像外，永远不会调用 PHP 脚本。

使用缓存。正如另一位发帖人所说，使用诸如`mod_expires`Last-Modified 标头之类的东西来响应条件 GET 请求。如果客户端不必重新请求图像，页面加载速度将显着加快，服务器上的负载将减少。

对于必须从 PHP 发送图像的情况，您可以使用`mod_xsendfile`更少的开销来完成它。请参阅[Arnold Daniels 关于该问题的出色博客文章](http://blog.adaniels.nl/articles/how-i-php-x-sendfile/)，但请注意他的示例是用于下载的。要内联提供图像，请取出 Content-Disposition 标头（第三个 header() 调用）。

希望这会有所帮助——在我的偏头痛痊愈后会有所帮助。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-12-29T15:02:58.823

Dan Udey 的重写示例中有两个错别字（我无法对此发表评论），应该是：

```
RewriteCond %{REQUEST_URI} ^/images/cached/
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
RewriteRule (.*) /images/generate.php?$1 [L] 
```

问候。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T18:48:14.403

值得添加的一个注意事项是确保您的代码不会生成这些图像的“未经授权”大小。

因此，如果图像 1234 尚不存在，则以下 URL 将创建 200x200 版本的图像。我**强烈**建议您确保请求的 URL 包含您支持的图像尺寸。

```
/images/get/200x200/1234.jpg 
```

恶意的人可以开始请求随机 URL，总是改变图像的高度和宽度。这会导致您的服务器出现一些严重的问题，因为它会坐在那里，基本上受到攻击，生成您不支持的大小的图像。

```
/images/get/0x1/1234.jpg
/images/get/0x2/1234.jpg
...
/images/get/0x9999999/1234.jpg
/images/get/1x1/1234.jpg
...
etc 
```

这是说明这一点的随机代码片段：

```
<?php

    $pathOnDisk = getImageDiskPath($_SERVER['REQUEST_URI']);

    if(file_exists($pathOnDisk)) {
        // send header with image mime type 
        echo file_get_contents($pathOnDisk);
        exit;
    } else {
        $matches = array();
        $ok = preg_match(
            '/\/images\/get\/(\d+)x(\d+)\/(\w+)\.jpg/', 
            $_SERVER['REQUEST_URI'], $matches);

        if(! $ok) {
            // invalid url
            handleInvalidRequest();
        } else {
            list(, $width, $height, $guid) = $matches;

            // you should do this!
            if(isSupportedSize($width, $height)) {
                // size is supported. all good
                // generate the resized image, save it & output it
            } else {
                // invalid size requested!!!
                handleInvalidRequest();
            }
        }
    }

    // snip
    function handleInvalidRequest() {
        // do something w/ invalid request          
        // show a default graphic, log it etc
    }
?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T23:51:23.893

似乎很棒的帖子，但我的问题仍然没有解决。我无法访问我的主机提供商中的 htaccess，所以没有 apache 调整的问题。真的有办法为图像设置 cace-control 标头吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T17:22:09.147

您的方法似乎很合理 - 我要补充一点，应该采取一些机制来检查生成缓存版本的日期是否在原始（源）图像文件的最后修改时间戳之后，如果不重新生成缓存/调整大小的版本. 这将确保如果设计者更改了图像，缓存将得到适当的更新。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T17:29:20.240

这听起来像是一个可靠的方法。下一步可能是超越 PHP/MySQL。

也许，**调整你的标题**：

如果您使用 PHP 发送 MIME 类型，您还可以使用“Keep-alive”和“Cache-control”标头来延长图像在服务器上的寿命并减轻 PHP/MySQL 的一些负载。

此外，还要考虑使用 apache 插件进行缓存。像[mod_expires](http://httpd.apache.org/docs/2.0/mod/mod_expires.html)。

哦，还有一件事，你对你的服务器有多少控制权？我们是否应该将此对话限制*在*PHP/MySQL 上？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T18:34:26.043

**phpThumb**是一个动态生成调整大小的图像/缩略图的框架。它还实现了缓存，而且很容易实现。

调整图像大小的代码是：

```
<img src="/phpThumb.php?src=/path/to/image.jpg&w=200&amp;h=200" alt="thumbnail"/> 
```

将为您提供 200 x 200 的缩略图；

它还支持水印。

看看： http: [//phpthumb.sourceforge.net/](http://phpthumb.sourceforge.net/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T17:01:28.170

我已经设法在 PHP 中简单地使用重定向标头来做到这一点：

```
if (!file_exists($filename)) {  

    // *** Insert code that generates image ***

    // Content type
    header('Content-type: image/jpeg'); 

    // Output
    readfile($filename);    

} else {
    // Redirect
    $host  = $_SERVER['HTTP_HOST'];
    $uri   = rtrim(dirname($_SERVER['PHP_SELF']), '/\\');
    $extra = $filename;
    header("Location: http://$host$uri/$extra");
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-04-04T00:18:37.180

我宁愿在用户登录时在文件名中添加一个随机数，而不是将文件地址保留在数据库中。对于用户 1234，类似这样的内容：image/picture_1234.png?rnd=6534122341

如果用户在会话期间提交了新图片，我只需刷新随机数。

GUID 100% 解决缓存问题。但是，它有点难以跟踪图片文件。使用这种方法，用户有可能在以后登录时再次看到相同的图片。但是，如果您从十亿个数字中生成随机数，则几率很低。

# javascript - 在 BIRT 中，如何从 JavaScript 访问任意数据集？

> ID：140743
> 
> 赞同：2
> 
> 时间：2008-09-26T17:15:42.393
> 
> 标签：javascript, eclipse, reporting, birt

我正在[BIRT](http://www.eclipse.org/birt/phoenix/)中构建我的第一份报告。

很快我遇到了一个问题，我想根据一个表达式显示一些文本或数据，该表达式包含来自两个不同表的数据（不是可以/应该连接的表-（假设示例-从他的记录中获取学生的 ACT 分数）在学生表中，并将其与统计表的 ACT 统计条目进行比较。我很快意识到数据元素必须绑定到数据集（只有其中一个。）

我在 BIRT 邮件列表中发现了一个[类似的问题](http://eclipsezone.net/eclipse/forums/m92006973.html)，它帮助我找到了解决方案——我可以将单个数据元素绑定到不同的数据集，但它仍然可以访问其容器的元素。我可以将参数发送到元素绑定到的数据集（例如我上面提到的示例中的“ACT”）。

然而，最终，我来到了一个需要使用来自三个不同表的数据的地方。我被困在这里，我假设有一种方法可以通过脚本能力来做到这一点，但我还没有在文档中看到一种从数据集中提取数据的方法——到目前为止我处理的一切都是与将报表元素绑定到数据集相关联。

需要明确的是，我已经看到我可以将 JavaScript 函数添加到顶级报告的初始化部分（并从数据元素中的表达式调用它们），但我看不到如何在脚本中查询我的任何数据集——而不是仅与绑定到我的数据元素的数据集交互）。

如何从 BIRT 中的 JavaScript 访问任意（尽管已经定义）数据集？（或者我怎样才能从一个元素访问两个以上的数据集——一个是它绑定的，一个是它的容器绑定的？）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T20:35:42.567

我已经有一段时间没有尝试这样做了。立即想到的答案是您需要将第三个数据集放入表中（可以将可见性设置为 false），并且您需要将表值填充到 GlobalValue。然后您可以通过脚本从数据控件中获取 GlobalValues。

我知道它不漂亮。周末我会看看，看看 2.3 是否添加了任何使这更容易的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-04T15:49:35.400

使用

```
this.getValue()
```

这将返回当前列的绑定值而不是

```
数据集行[“运行”]
```

# .net - 是否可以将 .NET IL 代码编译为机器代码？

> ID：140750
> 
> 赞同：30
> 
> 时间：2008-09-26T17:18:32.840
> 
> 标签：.net, visual-studio, compiler-construction

我想在没有 .NET 框架的情况下分发我的 .NET 程序。是否可以将 .NET 程序编译为机器代码？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T17:23:46.353

是的，您可以使用 Ngen.exe 进行预编译，但这并不能消除 CLR 依赖性。

您还必须发布 IL 程序集，Ngen 的唯一好处是您的应用程序可以在不调用 JIT 的情况下启动，因此您可以获得真正的快速启动时间。

根据 CLR 通过 C#：

> 此外，使用 Ngen 预编译的程序集通常比 JIT 程序集慢，因为 JIT 编译器可以优化目标机器（32 位？64 位？特殊寄存器？等），而 NGEN 只会产生基线编译。

编辑：

关于来自 CLR Via C# 的上述信息存在一些争论，因为有人说您只需要在目标机器上运行 Ngen 作为安装过程的一部分。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-26T17:23:02.250

Remotesoft 有一个： [Salamander .NET Linker](http://www.remotesoft.com/linker/)

我没有任何经验。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T17:25:18.377

有一些第三方工具可以做到这一点，例如

*   [http://www.remotesoft.com/linker/](http://www.remotesoft.com/linker/)
*   [http://www.xenocode.com/](http://www.xenocode.com/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T17:40:26.827

可以做到这一点的另一个（昂贵的专有许可证起价 1599 美元）产品是[Xenocode Postbuild](http://www.xenocode.com/Products/Postbuild/)。不过我自己没用过，它的成本大约是一个非洲小国的国民生产总值……

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-05-01T07:12:01.067

是的，你现在可以！最近微软发布了**.NET Native**，这是一项将您的应用程序与 .NET Native 运行时（他们称之为 MRT）编译成一个二进制文件（实际上是一个可执行文件和一个动态库）的技术。

见链接： http: [//blogs.msdn.com/b/dotnet/archive/2014/04/02/announcing-net-native-preview.aspx](http://blogs.msdn.com/b/dotnet/archive/2014/04/02/announcing-net-native-preview.aspx) [http://blogs.msdn.com/b/dotnet/archive/ 2014/04/24/dotnetnative-performance.aspx](http://blogs.msdn.com/b/dotnet/archive/2014/04/24/dotnetnative-performance.aspx)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-26T18:54:35.213

> 是否可以将 .NET IL 代码编译为机器代码？

是的，但 .NET Framework 会在运行时（默认）或安装时 (ngen) 为您执行此操作。除其他原因外，此 IL -> 机器代码在每台安装机器上单独完成，因此可以针对该特定机器进行优化。

> 我想在没有 .NET 框架的情况下分发我的 .NET 程序。是否可以将 .NET 程序编译为机器代码？

不，出于所有意图和目的，您不能这样做。第 3 方的解决方法可能在某些情况下有效，但到那时我不会再将其视为“托管代码”或“.NET”。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-10T15:35:09.093

编译部分有[IL2CPU](http://www.gocosmos.org/Docs/Dev/IL2CPU/index.EN.aspx)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T17:21:44.407

我不认为这是可能的。您可以进行预装配，但仍然需要框架。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T17:24:21.780

我认为你不应该：这是 JIT 编译器的任务。

但是，您可以使用 ClickOnce 或 Windows Installer 来部署它，这样缺少的框架就不是一个大问题：您可以告诉安装程序下载框架并安装它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T17:47:15.860

如果您只关心部署框架的大小，您可以阅读[此](http://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx).

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-10T17:12:21.357

查看 MONO 项目：带有 --aot 选项的单声道命令。[http://www.mono-project.com/AOT](http://www.mono-project.com/AOT)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T17:44:55.287

我一直认为在没有 CLR 依赖的情况下直接将 c# 编译为机器代码会很酷......

# c++ - 在 Windows 中编程 C 或 C++ 时如何操作 GUID？

> ID：140751
> 
> 赞同：3
> 
> 时间：2008-09-26T17:18:32.933
> 
> 标签：c++, c, winapi, guid

在 C 或 C++ 中进行 Windows 编程时如何操作 GUID？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T17:23:00.050

在 Win32 下，如果您想操作 GUID，您可以使用 UuidXXX() 网络/RPC 函数：

*   UuidCompare()

*   UuidCreate()

*   UuidCreateNil()

*   UuidCreateSequential()

*   UuidEqual()

*   UuidFromString()

*   UuidHash()

*   UuidIsNil()

*   UuidToString()

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-16T19:26:35.607

我使用 boost::uuid : [http://www.boost.org/doc/libs/1_43_0/libs/uuid/index.html](http://www.boost.org/doc/libs/1_43_0/libs/uuid/index.html) 如果我将我的应用程序移植到另一个平台上，它可以保证仍然可以工作。

# java - 在 Python 中寻找类似于 Java 的文件遍历函数

> ID：140758
> 
> 赞同：10
> 
> 时间：2008-09-26T17:20:14.830
> 
> 标签：java, python, file-traversal

在 Java 中，您可以执行`File.listFiles()`和接收目录中的所有文件。然后，您可以轻松地通过目录树进行递归。

在 Python 中是否有类似的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-26T17:30:39.347

就在这里。Python的方式更好。

有三种可能：

**1) 像 File.listFiles() 一样：**

Python 有函数 os.listdir(path)。它的工作方式类似于 Java 方法。

**2) 使用 glob 的路径名模式扩展：**

模块 glob 包含使用类 Unix shell 模式列出文件系统上文件的函数，例如

```
`files = glob.glob('/usr/joe/*.gif')` 
```

`**3）带走的文件遍历：**`

 `Python 的 os.walk 函数真的很棒。

walk 方法返回一个生成函数，该函数递归地列出给定起始路径下的所有目录和文件。

一个例子：

```
`import os
from os.path import join
for root, dirs, files in os.walk('/usr'):
   print "Current directory", root
   print "Sub directories", dirs
   print "Files", files` 
```

`您甚至可以即时从“dirs”中删除目录以避免进入该目录： if "joe" in dirs: dirs.remove("joe") 以避免进入名为“joe”的目录。

listdir 和 walk 记录[在这里](http://docs.python.org/lib/os-file-dir.html)。glob 记录[在这里](http://docs.python.org/lib/module-glob.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-27T08:27:39.207

作为一个长期的 Pythonista，我不得不说 std 库中的路径/文件操作函数是低于标准的：它们不是面向对象的，它们反映了一个过时的 let-wrap-OS-system-functions-without-思维哲学。我衷心推荐“路径”模块作为包装器（如果你必须知道，围绕 os、os.path、glob 和 tempfile）：更好和 OOPy：[http ://pypi.python.org/pypi/path.py /2.2](http://pypi.python.org/pypi/path.py/2.2)

这是带有路径模块的 walk() ：

```
dir = path(os.environ['HOME'])
for f in dir.walk():
    if f.isfile() and f.endswith('~'):
        f.remove() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T17:26:17.377

[在 os 模块 ( docs](http://docs.python.org/lib/os-file-dir.html) )中尝试“listdir()” ：

```
import os
print os.listdir('.') 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T17:24:10.750

直接来自 Python 的参考库

```
>>> import glob
>>> glob.glob('./[0-9].*')
['./1.gif', './2.txt']
>>> glob.glob('*.gif')
['1.gif', 'card.gif']
>>> glob.glob('?.gif')
['1.gif'] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T17:27:59.103

看看[这里](http://docs.python.org/lib/os-file-dir.html)`os.walk()`的例子。有了您可以轻松处理整个目录树。`os.walk()`

上面链接中的一个例子......

```
# Delete everything reachable from the directory named in 'top',
# assuming there are no symbolic links.
# CAUTION:  This is dangerous!  For example, if top == '/', it
# could delete all your disk files.
import os
for root, dirs, files in os.walk(top, topdown=False):
    for name in files:
        os.remove(os.path.join(root, name))
    for name in dirs:
        os.rmdir(os.path.join(root, name)) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T17:31:07.927

如果您还想要子目录，请使用 os.path.walk。

```
步行（顶部，函数，arg）

        带有回调函数的目录树遍历。

        对于以顶部为根的目录树中的每个目录（包括顶部
        本身，但不包括 '.' 和 '..')，调用 func(arg, dirname, fnames)。
        dirname 是目录的名称，fnames 是目录名称的列表
        dirname 中的文件和子目录（不包括“.”和“..”）。功能
        可以就地修改 fnames 列表（例如，通过 del 或 slice 分配），
        并且 walk 只会递归到名称保留在的子目录中
        名称；这可用于实现过滤器，或施加特定的
        参观顺序。没有为 arg 定义或要求任何语义，
        超出该参数始终传递给 func。它可以用于，例如，通过
        文件名模式，或旨在累积的可变对象
        统计数据。为 arg 传递 None 是很常见的。

```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T18:58:52.973

我不建议这样做，`os.path.walk`因为它已在 Python 3.0 中被删除。 `os.walk`无论如何，它更简单，或者至少*我*觉得它更简单。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-27T12:50:45.150

您还可以查看[Unipath](https://github.com/mikeorr/Unipath) ，它是 Python 和`os`模块的面向对象的包装器。`os.path``shutil`

例子：

```
>>> from unipath import Path
>>> p = Path('/Users/kermit')
>>> p.listdir()
Path(u'/Users/kermit/Applications'),
Path(u'/Users/kermit/Desktop'),
Path(u'/Users/kermit/Documents'),
Path(u'/Users/kermit/Downloads'),
... 
```

通过奶酪店安装：

```
$ pip install unipath 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-02-29T17:26:59.153

看到我在 python 中编程了很长时间，我多次使用 os 模块并制作了自己的函数来打印目录中的所有文件。

该函数的代码：

```
import os

def PrintFiles(direc):
    files = os.listdir(direc)
    for x in range(len(files)):
        print("File no. "+str(x+1)+": "+files[x])

PrintFiles(direc) 
```

# java - 我如何知道何时关闭 HTTP 1.1 Keep-Alive 连接？

> ID：140765
> 
> 赞同：8
> 
> 时间：2008-09-26T17:21:46.840
> 
> 标签：java, http, http-headers, network-protocols

我正在用 Java 编写一个 Web 服务器，我希望它支持 HTTP 1.1 Keep-Alive 连接。但是我如何知道客户端何时完成了对给定连接的发送请求？（比如双行尾之类的）。

让我们看看 stackoverflow 如何处理这个非常晦涩的问题——在 Google 上，这些问题的答案都陷入了技术规范和晦涩难懂的语言中。我想要一个非 C 程序员的简单英语答案:)

* * *

我懂了。这证实了我不得不依赖 SocketTimeoutException 的怀疑。但我不确定我是否可以从客户端依赖某些东西来表明它已完成连接——这将允许我在大多数情况下更快地关闭连接——而不是等待超时。谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T17:52:38.607

如果您正在构建您的服务器以满足标准，那么您已经有很多信息可以在这里指导您。

简单来说，*它应该基于使用连接后的时间，而不是请求数据级别。*

HTTP/1.1 文档的[实际考虑部分](http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1.4)为您提供了一些指导：

> “服务器通常会有一些超时值，超过该值它们将不再保持非活动连接。代理服务器可能会将此值设置为更高，因为客户端可能会通过同一服务器建立更多连接。使用持久化连接对客户端或服务器的此超时的长度（或存在）没有要求。”

或者

> “当客户端或服务器希望超时时，它应该在传输连接上发出正常关闭。客户端和服务器都应该不断地观察传输关闭的另一端，并在适当的时候做出响应。如果客户端或服务器没有及时检测到对方的关闭，这可能会导致网络上不必要的资源消耗。”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T18:13:17.077

> 让我们看看 stackoverflow 如何处理这个非常晦涩的问题——在 Google 上，这些问题的答案都陷入了技术规范和晦涩难懂的语言中。

我只是把我[应该什么时候关闭一个 HTTP 1.1 连接？](http://www.google.co.uk/search?q=When+should+I+close+an+HTTP+1.1+connection%3F)进入谷歌，第三次点击是 HTTP 变得非常容易。在目录中，有一个链接指向名为[Persistent Connections 和“Connection: close” Header](http://www.jmarshall.com/easy/http/#http1.1s4)的部分。本节长三段，使用非常简单的语言，并准确地告诉您您想知道的内容。

> 我想要一个非 C 程序员的简单英语答案:)

With all due respect, programming is a technical endeavour where the details matter a great deal. Reading technical documentation is an absolutely essential skill. Relying on "plain English" third-party interpretations of the specifications will only result in you doing a poor job.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T17:33:14.877

您可以随时关闭它。标头表明客户端希望您保持连接打开，但这并不要求服务器遵守。大多数服务器将其打开大约 5-10 秒，有些则根本不注意它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T17:43:25.337

您应该阅读有关 Keep-Alive 功能的 RFC。否则，您最终可能会得到一台无法按预期工作的服务器。

正如@[Stephen] 已经指出的那样，服务器可以随时关闭连接（好吧，不是在请求/响应对的中间）。对客户来说也是如此。任何其他解决方案都将允许服务器或客户端对另一方执行 DoS。

编辑：看看 Connection 标题。客户端（和服务器）可以使用标头请求优雅的连接关闭。例如，`Connection: close`请求内部是一个请求服务器在发送响应后关闭连接。

# c++ - 如何简化此代码（基于 unsigned int 在 min 和 max 之间生成一个随机 int）？

> ID：140786
> 
> 赞同：0
> 
> 时间：2008-09-26T17:24:55.647
> 
> 标签：c++, random

代码是

```
return min + static_cast<int>(static_cast<double>(max - min + 1.0) *
  (number / (UINT_MAX + 1.0))); 
```

number 是 rand_s 得到的随机数。min 和 max 是整数，代表最小值和最大值（包括）。

如果您提供的解决方案不使用 unsigned int 作为数字，还请说明如何使其成为随机数。

请不要使用 rand() 提交解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T17:36:15.823

@[安德鲁·斯坦](https://stackoverflow.com/questions/140786/how-to-simplify-this-code-generates-a-random-int-between-min-and-max-base-on-un#140826)

在 C 中的数值食谱：科学计算的艺术（William H. Press、Brian P. Flannery、Saul A. Teukolsky、William T. Vetterling；纽约：剑桥大学出版社，1992 年（第 2 版，第 277 页）） ，提出以下意见：

> “如果你想生成一个 1 到 10 之间的随机整数，你应该总是使用高位来实现，如
> 
> `j = 1 + (int) (10.0 * (rand() / (RAND_MAX + 1.0)));`
> 
> 从来没有任何类似的东西
> 
> `j = 1 + (rand() % 10);`
> 
> （使用低阶位）。”

从`man 3 rand`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T17:39:20.527

这`static_cast<double>`是多余的，因为“+1.0”无论如何都会导致促销加倍。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T17:29:01.207

[Boost:Random](http://www.boost.org/doc/libs/1_36_0/libs/random/index.html)怎么样

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:11:20.040

您可以使用 unsigned long long 而不是 double 进行算术运算，但前提是 ULONGLONG_MAX >= UINT_MAX*UINT_MAX，这可能是实现定义的。但是，如果您担心这一点，您会担心在 (max - min) 或 RAND_MAX 很大的情况下原始代码中的潜在精度损失。

long long 实际上是否更快可能取决于您平台的硬件浮动有多好。但整数算术可以说本质上比浮点数更简单。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-26T17:32:02.963

就像是

```
min + number % (max - min + 1) 
```

检查最终情况

# c# - 我如何测试另一个安装是否已经在进行中？

> ID：140820
> 
> 赞同：8
> 
> 时间：2008-09-26T17:30:50.187
> 
> 标签：c#, windows, windows-installer

假设我正在尝试在 Windows 上自动安装某些东西，并且我想在尝试安装之前尝试测试是否正在进行另一个安装。我无法控制安装程序，必须在自动化框架中执行此操作。有没有更好的方法来做到这一点，一些 win32 api？，而不是仅仅测试 msiexec 是否正在运行？

[更新 2]

改进了我之前使用的直接访问互斥锁的代码，这更可靠：

```
using System.Threading;

[...]

/// <summary>
/// Wait (up to a timeout) for the MSI installer service to become free.
/// </summary>
/// <returns>
/// Returns true for a successful wait, when the installer service has become free.
/// Returns false when waiting for the installer service has exceeded the timeout.
/// </returns>
public static bool WaitForInstallerServiceToBeFree(TimeSpan maxWaitTime)
{
    // The _MSIExecute mutex is used by the MSI installer service to serialize installations
    // and prevent multiple MSI based installations happening at the same time.
    // For more info: http://msdn.microsoft.com/en-us/library/aa372909(VS.85).aspx
    const string installerServiceMutexName = "Global\\_MSIExecute";

    try
    {
        Mutex MSIExecuteMutex = Mutex.OpenExisting(installerServiceMutexName, 
            System.Security.AccessControl.MutexRights.Synchronize | System.Security.AccessControl.MutexRights.Modify);
        bool waitSuccess = MSIExecuteMutex.WaitOne(maxWaitTime, false);
        MSIExecuteMutex.ReleaseMutex();
        return waitSuccess;
    }
    catch (WaitHandleCannotBeOpenedException)
    {
        // Mutex doesn't exist, do nothing
    }
    catch (ObjectDisposedException)
    {
        // Mutex was disposed between opening it and attempting to wait on it, do nothing
    }
    return true;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T17:40:43.270

请参阅MSDN 上[_MSIExecute Mutex](http://msdn.microsoft.com/en-us/library/aa372909(VS.85).aspx)的描述。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-02-25T21:20:01.813

使用上面的代码，我得到了一个未处理的异常。[我在这篇文章中](https://stackoverflow.com/questions/17070583/releasing-a-mutex)交叉引用了这篇文章

这是我更新的代码：

```
 /// <summary>
/// Wait (up to a timeout) for the MSI installer service to become free.
/// </summary>
/// <returns>
/// Returns true for a successful wait, when the installer service has become free.
/// Returns false when waiting for the installer service has exceeded the timeout.
/// </returns>
public static bool IsMsiExecFree(TimeSpan maxWaitTime)
{
    // The _MSIExecute mutex is used by the MSI installer service to serialize installations
    // and prevent multiple MSI based installations happening at the same time.
    // For more info: http://msdn.microsoft.com/en-us/library/aa372909(VS.85).aspx
    const string installerServiceMutexName = "Global\\_MSIExecute";
    Mutex MSIExecuteMutex = null;
    var isMsiExecFree = false;
    try
    {
            MSIExecuteMutex = Mutex.OpenExisting(installerServiceMutexName,
                            System.Security.AccessControl.MutexRights.Synchronize);
            isMsiExecFree = MSIExecuteMutex.WaitOne(maxWaitTime, false);
    }
        catch (WaitHandleCannotBeOpenedException)
        {
            // Mutex doesn't exist, do nothing
            isMsiExecFree = true;
        }
        catch (ObjectDisposedException)
        {
            // Mutex was disposed between opening it and attempting to wait on it, do nothing
            isMsiExecFree = true;
        }
        finally
        {
            if(MSIExecuteMutex != null && isMsiExecFree)
            MSIExecuteMutex.ReleaseMutex();
        }
    return isMsiExecFree;

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-11-11T14:22:49.483

我一直在研究这个 - 大约一个星期 - 使用你的笔记（谢谢）和其他网站的笔记 - 太多的名字（谢谢大家）。

我偶然发现了一些信息，表明该服务可以产生足够的信息来确定 MSIEXEC 服务是否已经在使用中。服务是“msiserver”——Windows 安装程序——它的信息既是 state 又是 acceptstop。

以下 VBScript 代码对此进行检查：

```
Set objWMIService = GetObject("winmgmts:\\.\root\cimv2")
Check = False
Do While Not Check
   WScript.Sleep 3000
   Set colServices = objWMIService.ExecQuery("Select * From Win32_Service Where Name="'msiserver'")
   For Each objService In colServices
      If (objService.Started And Not objService.AcceptStop)  
         WScript.Echo "Another .MSI is running."
      ElseIf ((objService.Started And objService.AcceptStop) Or Not objService.Started) Then
         WScript.Echo "Ready to install an .MSI application."
         Check = True
      End If
   Next
Loop 
```

# c - 可以使用宏对变量进行只读访问吗？

> ID：140825
> 
> 赞同：2
> 
> 时间：2008-09-26T17:31:27.067
> 
> 标签：c, c-preprocessor

你能定义一个访问普通变量的宏，但是以只读方式（除了将其定义为对函数的调用）吗？例如，以下代码中的 VALUE 宏是否可以定义为使 dostuff() 函数导致编译错误？

```
struct myobj {
  int value;
}

/* This macro does not satisfy the read-only requirement */
#define VALUE(o) (o)->value

/* This macro uses a function, unfortunately */
int getvalue(struct myobj *o) { return o->value; }
#define VALUE(o) getvalue(o)

void dostuff(struct myobj *foo) {
   printf("The value of foo is %d.\n", VALUE(foo)); /* OK */
   VALUE(foo) = 1; /* We want a compile error here */
   foo->value = 1; /* This is ok. */
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T17:44:05.523

好的，我想出了一个：

```
#define VALUE(o) (1 ? (o)->value : 0) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T17:37:44.820

如果变量总是数字，这有效：

```
#define VALUE(x) (x+0) 
```

或在您的示例中，

```
#define VALUE(x) (x->value+0) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-01-31T18:47:25.747

请参阅 C 标准（C99 和 C1x）中的第 6.5.17 节：“逗号运算符不会产生左值。”</p>

```
#define VALUE(x) (0, x) 
```

（不能移植到 C++。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T17:39:43.707

尝试

```
#define VALUE(o) (const int)((o)->value) 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-26T17:54:38.977

这是一个难题还是一项工程任务？如果它是一项工程任务，那么有更好的方法可以在 C 中获得结构的不透明度。在[这篇博客文章中](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2008/07/02/how-to-build-a-managed-unmanaged-library.aspx)，我写了一个足够体面的描述来说明如何在 C 中做到这一点。

# ruby - 有人用过瑞文吗？

> ID：140843
> 
> 赞同：0
> 
> 时间：2008-09-26T17:35:54.950
> 
> 标签：ruby, build-process, build-automation

你觉得这个[构建工具](http://raven.rubyforge.org/)怎么样？我正在考虑从 maven2 迁移到 raven（我的 pom 越来越大），但我想先听听一些意见。

谢谢！

@安德烈：

感谢您的写作，但我实际上是在寻找使用 raven 的真实体验。无论如何，没有人写的事实本身就是一个指标（似乎很少有人使用它）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T07:48:45.220

我没有使用过 Raven 或[Buildr](http://Incubator.Apache.Org/buildr/)，但我听说过后者的好消息。在[Assaf Arkin 的这篇博客文章中](http://Blog.LabNotes.Org/2007/05/03/buildr-or-when-ruby-is-faster-than-java/)，有一个很好的案例研究：一个 5,443 行、52 个文件的 Maven 配置被缩减为 Buildr 的 485 行。而且，尽管每个人都说“Ruby 很慢”，但 Buildr 比 Maven 快 2-6 倍。

此外，与 Raven 不同的是，Buildr 似乎仍在维护：它目前作为 Apache 官方项目处于孵化器阶段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T18:34:44.480

pom 增长是每个人都面临的问题，我猜想，但是 maven 至少得到了维护（2.1。指日可待）而且 raven 项目在我看来已经死了。今年没有更新，邮件列表档案也很小。在我看来，将你的构建过程切换到一个没有生活社区的工具太冒险了。我猜这不是你想要的答案，而是我的 2 美分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:08:18.037

我对乌鸦一无所知。

您应该查看普通的旧[rake](http://www.railsenvy.com/2007/6/11/ruby-on-rails-rake-tutorial)，它可以让您创建非常强大的任务。

我也听说过[sake](http://errtheblog.com/posts/60-sake-bomb)，它就像 rake 任务但在系统范围内，而不是仅在您的一个项目中可用。

它们可能不是专门用于 Java 的，但它们确实击败了普通的旧 bash 或（天堂禁止）批处理脚本。

# sql-server - 没有文件可下载时，如何避免 SSIS FTP 任务失败？

> ID：140850
> 
> 赞同：18
> 
> 时间：2008-09-26T17:36:37.350
> 
> 标签：sql-server, ssis, ftp

我正在使用 SQL Server 2005，并在 SSIS 中创建 ftp 任务。

有时会有文件要ftp过来，有时没有。如果没有文件，我不希望任务或包失败。我已将 ftp 任务的箭头更改为“完成”旁边的箭头，因此包运行。我已将允许的错误数更改为 4（因为有 4 个 ftp 任务，并且 4 个目录中的任何一个可能有也可能没有文件）。

但是，当我从代理中的作业运行包时，它会将作业标记为失败。由于这将每 15 分钟运行一次，因此我不希望在我的工作历史记录中出现一堆红色 x，这将导致我们在问题确实发生时看不到问题。

如何在 ftp 任务中设置属性，以便找不到文件到 ftp 不是失败？我正在使用的操作是“发送文件”。

以下是更多信息：文件位于除 ftp 之外我没有任何访问权限的服务器上。而且，我不提前知道文件名。用户可以随心所欲地称呼他们。所以我不能检查特定的文件，我想，我也不能检查。除非通过使用 ftp 连接和基于该连接的任务。这些文件位于远程服务器上，我想将它们复制到我的服务器上，以便从该远程服务器获取它们。

我可以在脚本任务中使用命令级别的 ftp。也许这就是我需要使用的，而不是 ftp 任务。（我已更改为使用带有参数文件的 ftp 命令行，从脚本任务调用。当没有要获取的文件时，它不会出错。我认为这个解决方案对我有用。我正在创建动态参数文件，这意味着我不需要在纯文本文件中包含连接信息，而是可以存储在我的配置文件中，该文件位于更安全的位置。）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-20T18:08:26.520

检查此[链接](http://sqlblog.com/blogs/rushabh_mehta/archive/2008/04/24/gracefully-handing-task-error-in-ssis-package.aspx)，该链接描述了有关在 SSIS 包中正常处理任务错误的信息。

我遇到了几乎相同的问题，但是在检索文件时。当在 FTP 服务器上找不到文件时，我希望包不会失败。上面的链接停止了错误冒泡并导致包失败；你会认为 FailPackageOnError=false 应该做的事情？:-S

希望这也能为您解决！

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-07-16T07:14:00.050

我了解您已找到问题的答案。这适用于可能偶然发现此问题的其他用户。这是实现这一目标的一种可能方式。`Script Task`可用于查找给定模式（例如`*.txt`）的 FTP 文件夹路径中存在的文件列表。下面的示例显示了如何做到这一点。

**分步过程：**

1.  在 SSIS 包上，创建一个`FTP Connection`命名的**FTP**并创建**5 个**变量，如屏幕截图 # **1**所示。变量`RemotePath`包含 FTP 文件夹路径；`LocalPath`包含文件将下载到的文件夹；`FilePattern`包含文件模式以查找要从 FTP 服务器下载的文件列表；`FileName`将由 填充，`Foreach loop container`但为避免 FTP 任务设计时错误，可以使用**/**填充它，或者`DelayValidation`可以将 FTP 任务上的属性设置为**True**。

2.  在 SSIS 包上，放置一个`Script Task`,`Foreach Loop container`和`FTP Task`，`Foreach Loop container`如屏幕截图 # **2**所示。

3.  `Main()`将 中的方法替换为**脚本任务代码**部分`Script Task`下的代码。Script Task 将使用与给定模式匹配的文件集合填充变量**ListOfFiles 。**此示例将首先使用模式 *.txt，它不会产生任何结果，然后是模式 *.xls，它将匹配 FTP 服务器上的少数文件。

*****   配置`Foreach Loop container`如屏幕截图 # **3**和 # **4**所示。此任务将循环通过变量 **ListOfFiles*。如果没有文件，循环容器内的 FTP 任务将不会执行。如果有文件，则循环容器内的 FTP 任务将针对在 FTP 服务器上找到的文件数执行该任务。

    *   配置`FTP Task`如屏幕截图 # **5**和 # **6**所示。

    *   屏幕截图 # **7显示了在****没有**找到与该模式匹配的文件时执行的示例包`*.txt`。

    *   屏幕截图# **8**显示了执行包`C:\temp\` **之前文件夹的内容。**

    *   屏幕截图# **9**显示了为模式找到匹配文件时的示例包执行`*.xls`。

    *   屏幕截图# **10**显示了 FTP 远程路径的内容`/Practice/Directory_New`。

    *   屏幕截图 # **11**显示了执行包`C:\temp\` **后文件夹的内容。**

    *   屏幕截图# **12**显示了在提供不正确的**远程路径**时包失败。

    *   屏幕截图# **13**显示了与包失败相关的错误消息。**** 

 ****希望有帮助。

**脚本任务代码：**

**可**`SSIS 2008 and above`**用于**.****

 **包含**使用 System.Text.RegularExpressions**`using`的语句；

 **```
public void Main()
{
    Variables varCollection = null;
    ConnectionManager ftpManager = null;
    FtpClientConnection ftpConnection = null;
    string[] fileNames = null;
    string[] folderNames = null;
    System.Collections.ArrayList listOfFiles = null;
    string remotePath = string.Empty;
    string filePattern = string.Empty;
    Regex regexp;
    int counter;

    Dts.VariableDispenser.LockForWrite("User::RemotePath");
    Dts.VariableDispenser.LockForWrite("User::FilePattern");
    Dts.VariableDispenser.LockForWrite("User::ListOfFiles");
    Dts.VariableDispenser.GetVariables(ref varCollection);

    try
    {
        remotePath = varCollection["User::RemotePath"].Value.ToString();
        filePattern = varCollection["User::FilePattern"].Value.ToString();

        ftpManager = Dts.Connections["FTP"];
        ftpConnection = new FtpClientConnection(ftpManager.AcquireConnection(null));
        ftpConnection.Connect();
        ftpConnection.SetWorkingDirectory(remotePath);
        ftpConnection.GetListing(out folderNames, out fileNames);
        ftpConnection.Close();

        listOfFiles = new System.Collections.ArrayList();
        if (fileNames != null)
        {
            regexp = new Regex("^" + filePattern + "$");
            for (counter = 0; counter <= fileNames.GetUpperBound(0); counter++)
            {
                if (regexp.IsMatch(fileNames[counter]))
                {
                    listOfFiles.Add(remotePath + fileNames[counter]);
                }
            }
        }

        varCollection["User::ListOfFiles"].Value = listOfFiles;
    }
    catch (Exception ex)
    {
        Dts.Events.FireError(-1, string.Empty, ex.ToString(), string.Empty, 0);
        Dts.TaskResult = (int) ScriptResults.Failure;
    }
    finally
    {
        varCollection.Unlock();
        ftpConnection = null;
        ftpManager = null;
    }

    Dts.TaskResult = (int)ScriptResults.Success;
} 
```

**VB**代码可用于**`SSIS 2005 and above`**.

包括`Imports`语句**Imports System.Text.RegularExpressions**

```
Public Sub Main()
    Dim varCollection As Variables = Nothing
    Dim ftpManager As ConnectionManager = Nothing
    Dim ftpConnection As FtpClientConnection = Nothing
    Dim fileNames() As String = Nothing
    Dim folderNames() As String = Nothing
    Dim listOfFiles As Collections.ArrayList
    Dim remotePath As String = String.Empty
    Dim filePattern As String = String.Empty
    Dim regexp As Regex
    Dim counter As Integer

    Dts.VariableDispenser.LockForRead("User::RemotePath")
    Dts.VariableDispenser.LockForRead("User::FilePattern")
    Dts.VariableDispenser.LockForWrite("User::ListOfFiles")
    Dts.VariableDispenser.GetVariables(varCollection)

    Try

        remotePath = varCollection("User::RemotePath").Value.ToString()
        filePattern = varCollection("User::FilePattern").Value.ToString()

        ftpManager = Dts.Connections("FTP")
        ftpConnection = New FtpClientConnection(ftpManager.AcquireConnection(Nothing))

        ftpConnection.Connect()
        ftpConnection.SetWorkingDirectory(remotePath)
        ftpConnection.GetListing(folderNames, fileNames)
        ftpConnection.Close()

        listOfFiles = New Collections.ArrayList()
        If fileNames IsNot Nothing Then
            regexp = New Regex("^" & filePattern & "$")
            For counter = 0 To fileNames.GetUpperBound(0)
                If regexp.IsMatch(fileNames(counter)) Then
                    listOfFiles.Add(remotePath & fileNames(counter))
                End If
            Next counter
        End If

        varCollection("User::ListOfFiles").Value = listOfFiles

        Dts.TaskResult = ScriptResults.Success

    Catch ex As Exception
        Dts.Events.FireError(-1, String.Empty, ex.ToString(), String.Empty, 0)
        Dts.TaskResult = ScriptResults.Failure
    Finally
        varCollection.Unlock()
        ftpConnection = Nothing
        ftpManager = Nothing
    End Try

    Dts.TaskResult = ScriptResults.Success
End Sub 
```

**截图#1：**

![1](https://i.stack.imgur.com/Lv78g.png)

**截图#2：**

![2](https://i.stack.imgur.com/Ibx38.png)

**截图#3：**

![3](https://i.stack.imgur.com/QR09z.png)

**截图#4：**

![4](https://i.stack.imgur.com/OsAHp.png)

**截图#5：**

![5](https://i.stack.imgur.com/D4LGu.png)

**截图#6：**

![6](https://i.stack.imgur.com/2veal.png)

**截图#7：**

![7](https://i.stack.imgur.com/GxIGn.png)

**截图#8：**

![8](https://i.stack.imgur.com/wh0dO.png)

**截图#9：**

![9](https://i.stack.imgur.com/8T8JL.png)

**截图#10：**

![10](https://i.stack.imgur.com/dy3tV.png)

**截图 #11：**

![11](https://i.stack.imgur.com/2rjo2.png)

**截图#12：**

![12](https://i.stack.imgur.com/7aabW.png)

**截图#13：**

![13](https://i.stack.imgur.com/jPmGy.png)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-10-16T13:37:48.003

我刚刚遇到了这个问题，在阅读了这里的一些回复之后，并没有真正解决我的问题，而且这里的解决方案在复杂性方面似乎很疯狂。

我的 FTP 任务失败，因为我不允许覆盖文件，假设该作业连续两次启动，第一次就可以了，因为有些文件已传输，但如果本地文件已经存在，则会失败。

我的解决方案很简单：

1.  右键任务——属性
2.  设置 ForceExecutionResult = "成功"

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T23:16:09.013

（我不能接受自己的答案，但这是对我有用的解决方案。）

这可能不是最好的解决方案，但这是可行的。

我使用脚本任务，并有一堆用于 ftp 连接信息、源和目标目录的变量。（因为，我们将更改运行它的服务器，并且在配置包中进行更改会更容易。）

我即时创建了一个文本文件，并将 ftp 命令写入其中：

```
 Dim ftpStream As StreamWriter = ftpFile.CreateText()
    ftpStream.WriteLine(ftpUser)
    ftpStream.WriteLine(ftpPassword)
    ftpStream.WriteLine("prompt off")
    ftpStream.WriteLine("binary")
    ftpStream.WriteLine("cd " & ftpDestDir)
    ftpStream.WriteLine("mput " & ftpSourceDir)
    ftpStream.WriteLine("quit 130")
    ftpStream.Close() 
```

然后，在给它足够的时间真正关闭之后，我启动一个进程来执行 ftp 命令：

```
 ftpParameters = "-s:" & ftpParameterLoc & ftpParameterFile & " " & ftpServer
    proc = System.Diagnostics.Process.Start("ftp", ftpParameters) 
```

然后，在给它一些运行 ftp 进程的时间后，我删除了临时 ftp 文件（其中包含连接信息！）。

如果源目录中不存在文件（变量具有 \\drive\dir\*.* 映射），则没有错误。如果发生其他错误，任务仍然失败，因为它应该。

我是 SSIS 的新手，这可能是一个难题。但它现在有效。我想我要求最好的方法，我当然不会声称就是这样。

正如我所指出的，我无法知道这些文件的名称，或者即使那里根本没有任何文件。如果他们在那里，我想得到他们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T18:22:08.333

我没有给你一个打包的答案，但由于没有其他人发布任何内容......

您应该能够在 ActiveX 脚本任务中设置一个变量，然后使用它来决定是否应该运行 FTP 任务。[这里](http://dichotic.wordpress.com/2006/11/01/ssis-test-for-data-files-existence/)有一个适用于本地路径的示例。希望您可以调整这个概念（或者如果可能，映射 FTP 驱动器并这样做）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-02-15T21:25:38.597

1) 设置 FTP 任务属性 ForceExecutionResult = Success

2) 将此代码添加到 FTP 任务 OnError 事件处理程序。

```
 public void Main()
    {
        // TODO: Add your code here

        int errorCode = (int)Dts.Variables["System::ErrorCode"].Value;

        if (errorCode.ToString().Equals("-1073573501"))
        {
            Dts.Variables["System::Propagate"].Value = false;
        }
        else
        {
            Dts.Variables["System::Propagate"].Value = true;
        }

        Dts.TaskResult = (int)ScriptResults.Success;
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T14:19:39.457

啊哈，好的-感谢您的澄清。由于 FTP 任务无法返回文件夹列表，因此无法像我最初所说的那样使用 ForEach - 仅当您将 X 数量的文件上传到远程源时才有效。

要下载 X 数量的文件，您可以采用两种方式，您可以完全在 .Net 中的脚本任务中完成，或者您可以使用 .Net 脚本任务中的文件名填充 ArrayList，然后在 ArrayList 上使用 ForEach ，将文件名传递给变量并在标准 FTP 任务中下载该变量名。

适合的代码示例：[http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2472491 &SiteID=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2472491&SiteID=1)

因此，在上面，您将获得 FileNames() 并从中填充 ArrayList，然后将 ArrayList 分配给 Dts.Variables 中的 Object 类型变量，然后使用类似以下代码的 ForEach 覆盖该 Object (ArrayList) 变量：[http ://www.sqlservercentral.com/articles/SSIS/64014/](http://www.sqlservercentral.com/articles/SSIS/64014/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T20:38:54.917

将其放入 ForEach 容器中，该容器会遍历要上传的文件。没有文件，没有 FTP，没有失败。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-18T07:28:16.543

另一种方法是使用此[FTP 文件枚举器](http://microsoft-ssis.blogspot.com/2012/01/custom-ssis-component-foreach-ftp-file.html) ![在此处输入图像描述](https://i.stack.imgur.com/5wrCD.jpg)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T14:00:48.223

您可以在失败时重定向到另一个不执行任何操作的任务，即只返回 true 的脚本。

为此，添加新的脚本任务，突出显示您的 FTP 任务，将出现第二个绿色连接器，将其拖到脚本任务，然后双击它。在值下拉列表中选择失败。显然，您需要在此脚本任务中处理真正的故障，才能在作业历史记录中正确显示。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-10T06:39:53.687

您可以使用来自 eaSkills 的免费 SSIS FTP Task++。如果一个或多个文件不存在，它不会抛出错误，它支持通配符，如果需要，您可以选择下载和删除。

这是功能页面的链接： [http ://www.easkills.com/ssis/ftptask](http://www.easkills.com/ssis/ftptask)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-02-20T15:20:13.003

这是另一个对我有用的解决方案，使用内置的东西，因此无需手动重写 FTP 逻辑：

1) 在你的包中创建一个名为 FTP_Error 的变量

2) 单击您的 FTP 任务，然后单击“事件处理程序”选项卡

3) 在页面内单击为“FTP Task/OnError”创建事件处理程序 - 只要 FTP 出现问题，就会触发

4) 从工具箱中，拖入一个脚本任务项目，然后双击打开它

5) 在第一个弹出窗口中，ReadOnlyVariables - 添加 System::ErrorCode, System::ErrorDescription

6) 在第一个弹出窗口中，ReadWriteVariables - 添加您的 User::FTP_Error 变量

7) 编辑脚本

8) 在脚本中设置您的 FTP_Error 变量以保存我们上面的 ReadOnlyVariables：

```
Dts.Variables["FTP_Error"].Value = "ErrorCode:" + Dts.Variables["ErrorCode"].Value.ToString() + ", ErrorDescription=" + Dts.Variables["ErrorDescription"].Value.ToString(); 
```

9) 保存并关闭脚本

10）点击“确定”脚本任务

11) 返回“控制流”选项卡

12) 从 FTP 任务，OnError 转到一个新的脚本任务，并编辑

13) ReadOnlyVariables: User::FTP_Error from before

14）现在，当FTP上没有找到文件时，错误代码是-1073573501（您可以在这里找到错误代码参考列表：http: [//msdn.microsoft.com/en-us/library/ms345164.aspx](http://msdn.microsoft.com/en-us/library/ms345164.aspx) )

15）在你的脚本中，输入逻辑来做你想做的事——如果你发现一个“找不到文件”的代码，那么也许你说任务成功。如果不是，则任务失败。您的正常流程可以按照您的意愿处理：

```
if (Dts.Variables["FTP_Error"].Value.ToString().Contains("-1073573501"))
{
  // file not found - not a problem
  Dts.TaskResult = (int)ScriptResults.Success;
}
else
{
  // some other error - raise alarm!
  Dts.TaskResult = (int)ScriptResults.Failure;
} 
```

从那里你的成功/失败流程将做你想做的事。

# .net - .net 中的嵌套类

> ID：140852
> 
> 赞同：0
> 
> 时间：2008-09-26T17:36:51.360
> 
> 标签：.net

我有一个嵌套类。我想访问其他类中的外部类和嵌套类。如何访问类属性和方法，我的条件是我只想为一个类创建对象请提供代码片段

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T17:49:46.710

在我看来，嵌套类的原因是它只会被其父类使用。如果您需要访问内部类，则应首先使用嵌套类重新访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:44:02.123

[您可以在此处](http://msdn.microsoft.com/en-us/library/ms173120.aspx)了解嵌套类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T17:40:47.607

你的问题不是很清楚。但是，我猜您是 Java 背景。C# 和 VB 的嵌套类的行为与 Java 的嵌套类有很大不同。事实上，它们的行为很像 Java 的静态嵌套类，即它们不属于外部类的实例。因此，内部类的实例不能访问外部类中的非静态字段（至少在没有明确给出实例的情况下不能访问）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T17:41:50.770

虽然我永远不会推荐嵌套的公共类，但这里有一些代码：

```
public class Foo() {
    public Foo() { }

    private Bar m_Bar = new Bar();  

    public Bar TheBar { get { return m_Bar; } }

    public class Bar { ... }
} 
```

# asp.net - 您可以使用 .NET 2.0 使用 ASP.NET MVC 框架制作网站吗？

> ID：140858
> 
> 赞同：1
> 
> 时间：2008-09-26T17:38:23.557
> 
> 标签：asp.net, asp.net-mvc, .net-2.0

是否可以使用 .NET 2.0 使用 ASP.NET MVC 框架创建站点？我仅限于使用 .NET 2.0（我们使用 VS 2008，但我们必须使用 2.0 框架），我真的很想尝试 MVC 框架。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T17:47:35.500

Scott Hanselman 在他的博客中描述了一种使其工作的方法，并提出了一些警告：

[在 ASP.NET 2.0 上部署 ASP.NET MVC](http://www.hanselman.com/blog/DeployingASPNETMVCOnASPNET20.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:07:25.917

可以使用 Visual Studio 2008 来完成，但是会让人头疼……

*   创建 ASP.NET MVC Web 应用程序
*   在项目属性中将项目目标框架设置为 2.0
*   添加对 System.Web.MVC 的引用（单击警告消息）
*   添加您可能需要的任何其他参考（System.Web.Routing、System.Web.Abstractions）再次单击任何警告消息
*   开始编码！
*   并非您尝试的所有操作都会起作用，如果您在部署时看到这样的错误，则意味着 2.0 框架不支持您所做的任何事情......
    *   “找不到类型或命名空间名称'var'（您是否缺少 using 指令或程序集引用？）”
*   [配置 IIS](http://msmvps.com/blogs/omar/archive/2008/06/30/deploy-asp-net-mvc-on-iis-6-solve-404-compression-and-performance-problems.aspx)以支持 MVC 路由和[扩展](http://biasecurities.com/blog/2008/how-to-enable-pretty-urls-with-asp-net-mvc-and-iis6/)
*   将 .NET 3.5 开发框架中的“C:\windows\assembly\GAC_MSIL\System.Core”复制到运行 .NET 2.0 **SP1**的 IIS 服务器的 /bin 文件夹中。

[大部分内容可以在Scott Hanselman 的博客](http://www.hanselman.com/blog/DeployingASPNETMVCOnASPNET20.aspx)上找到更多详细信息

# asp.net - 是否有任何理由不接受数据库引擎优化顾问的建议？

> ID：140869
> 
> 赞同：4
> 
> 时间：2008-09-26T17:39:40.900
> 
> 标签：asp.net, sql-server, performance

我在一个团队中维护一个带有 SQL Server 2005 后端的 .Net Web 应用程序。系统最近在某些地方运行得有点慢，所以在做了所有我们能想到的调优工作（添加索引、清理写得很糟糕的存储过程等）之后，我通过调优顾问运行了一个典型的工作负载 - 并且它吐出大量要创建的附加索引和统计信息。我最初的反应是说“当然，你明白了，SQL Server”，但有什么理由不按照顾问所说的去做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T17:48:54.653

索引有两个问题。

1.  索引占用空间。空间很便宜，所以这通常不是反对索引的有力论据。但是，值得考虑。

2.  索引会减慢某些查询（如插入、更新和删除）。

创建适当的索引是一种平衡行为。如果你没有足够的，你的系统会很慢。如果你有太多，你的系统会很慢。对于执行读取多于写入的系统，您可以添加更多索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:58:25.707

如果您启用了统计信息的自动创建和自动更新（您应该），Sql Server 可以很好地管理统计信息，因此请忽略统计信息建议。获取索引并分析它们以确保您可以处理额外的空间需求，并确保它们不会重复具有相似列的其他索引。您通常可以通过仅添加一两列（注意列的顺序）或添加包含列（覆盖索引）来合并索引。

如果索引位于使用大量 OLAP 的表上，您希望将索引限制为 5-10。对于很少获得插入或更新（每秒少于几次）的表，空间限制应该是唯一的问题。

调优向导建议是一个很好的学习工具。获取索引，返回查询计划并尝试找出提出建议的确切原因。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-27T01:03:01.583

我推荐这个 SQL 脚本；它使用 SQL 2005 的内置性能计数器来建议索引：

```
SELECT
  migs.avg_total_user_cost * (migs.avg_user_impact / 100.0) * (migs.user_seeks + migs.user_scans) AS improvement_measure,
  'CREATE INDEX [missing_index_' + CONVERT (varchar, mig.index_group_handle) + '_' + CONVERT (varchar, mid.index_handle)
  + '_' + LEFT (PARSENAME(mid.statement, 1), 32) + ']'
  + ' ON ' + mid.statement
  + ' (' + ISNULL (mid.equality_columns,'')
    + CASE WHEN mid.equality_columns IS NOT NULL AND mid.inequality_columns IS NOT NULL THEN ',' ELSE '' END
    + ISNULL (mid.inequality_columns, '')
  + ')'
  + ISNULL (' INCLUDE (' + mid.included_columns + ')', '') AS create_index_statement,
  migs.*, mid.database_id, mid.[object_id]
FROM sys.dm_db_missing_index_groups mig
INNER JOIN sys.dm_db_missing_index_group_stats migs ON migs.group_handle = mig.index_group_handle
INNER JOIN sys.dm_db_missing_index_details mid ON mig.index_handle = mid.index_handle
WHERE migs.avg_total_user_cost * (migs.avg_user_impact / 100.0) * (migs.user_seeks + migs.user_scans) > 10
ORDER BY migs.avg_total_user_cost * migs.avg_user_impact * (migs.user_seeks + migs.user_scans) DESC 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-08T22:04:04.157

它在**计算**列上建议了索引。

然后[阻止用户将行插入表中](http://support.microsoft.com/kb/305333)。

所以要小心这样的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T17:58:25.020

我认为这些建议很有帮助，但在我看来，它只会给你一些尝试的东西。您实际上必须进行一些基准测试，看看哪些有帮助，哪些没有。这可能非常耗时，但由于 G Mastros 指出的原因，这可能是值得的。

数据库优化不是一门直截了当的科学，而是针对您的确切情况取得适当平衡的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T20:14:57.173

小心它的 DROP INDEX 建议 - 如果您的跟踪捕获错过了一些计划或罕见的查询，他们可能会在下次运行时受到影响。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-27T01:24:43.623

另请注意，数据库调整将在很大程度上取决于您的使用模式，这可能会在原型设计、开发和生产之间发生很大变化。所以我最好的建议是现在就调整你的心，当你有时间的时候，了解你的改变可能会产生什么影响。以后一定会为您服务的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T17:43:49.160

就像所有的建议一样，对它持保留态度，并用它来得出你自己的结论。

# installation - Windows Installer - 重新启动后恢复升级

> ID：140887
> 
> 赞同：1
> 
> 时间：2008-09-26T17:43:22.107
> 
> 标签：installation, windows-installer, upgrade

我有一个 Windows Installer MSI 软件包，用于安装有时需要重新启动才能升级的驱动程序；驱动程序是通过 WriteRegistryValues 之后的延迟自定义操作安装的。当需要重新启动时，会进行回滚，并告知用户重新启动并再次运行安装。

在 InstallExecuteSequence 中，RemoveExistingProducts 操作位于 InstallValidate 和 InstallInitialize 之间，因此当升级发出需要重新启动的信号时，先前的包已被删除。因此，当需要重新启动时，在回滚和错误消息“重新启动并重新运行”之后，我们的软件不再安装。如果用户重新启动并重复安装，一切正常。

我需要自动重启和恢复安装，所以用户实际上不需要做任何事情（当然除了同意重启。）

写入注册表的 RunOnce 键的命令可以在重新启动后再次运行安装，但我认为将 ForceReboot 设置为驱动程序安装的延迟自定义操作中发生的情况会很棘手。决定在恢复安装中做什么也可能很棘手。

非常欢迎有关最佳实践的建议或潜在问题的提示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T21:10:48.740

在 InstallInitialize 之前或 InstallFinalize 之后的 RemoveExistingProducts 不会将 Action 放入新产品的审核脚本中，因此如您所说，旧产品在升级完成之前被删除。

因此，您可能想尝试将 RemoveExisitngProducts 执行放在 InstallInitialize 和 InstallFinalize 之间，这样它在删除中就在审计脚本部分中，因此它将跟踪、重新启动和恢复。

[在这里](http://msdn.microsoft.com/en-us/library/aa372059.aspx)查看系统重启属性

# asp.net - 弹出IE脚本调试

> ID：140899
> 
> 赞同：2
> 
> 时间：2008-09-26T17:45:02.043
> 
> 标签：asp.net, debugging

为了调试 asp.net web 应用程序，我必须启用 IE 脚本调试。不幸的是，在过去一周左右的时间里，谷歌的分析 javascript 出现了问题。因此，当我浏览具有谷歌分析的网站时，我会收到一个小弹出窗口“发生运行时错误。你想调试吗？”

是的，甚至 stackoverflow 也会受到影响。

这是一个巨大的痛苦。有没有办法让 IE 脚本调试保持启用以保持 .net 调试器快乐，但摆脱弹出窗口？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T17:50:02.700

我建议仅将 IE 用于调试目的，而将[Firefox](http://www.mozilla.com/en-US/firefox/)用于该死的其他一切。你的生活将从中受益。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:49:28.630

调试 ASP.NET 页面不需要脚本调试，仅当您希望逐步检查脚本错误时才需要，您可以在 IE 中禁用此选项，仍然可以正常调试您的服务器代码。不幸的是，它是一个 IE 范围的选项，所以如果它打开它就打开，如果它关闭它就关闭。

但禁用该选项不会阻止您调试您的 asp.net 应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T18:03:26.333

您是否专门在 IE 中调试 javascript 行为？如果没有，请获取[Firefox](http://mozilla.com/firefox)和[Firebug](http://getfirebug.com)。IE 中的 Javascript 调试很痛苦，只有在您尝试修复 IE 特性的情况下才应该使用。如果您只是调试 Web 表单，则不需要在 IE 中启用脚本调试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:17:46.190

您可以编写一些代码来更改注册表中的以下键

*HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\Disable 脚本调试器*

根据您拥有项目的方式，您可能能够将其与实际构建相关联（通过宏），或者如果有任何东西将其放在 Application_Start 事件中的某个位置。

恢复正常可能会更困难一些。您可能会注意 iexplore.exe 进程，当它死掉时，您可以将其恢复。

希望有帮助。

# sql - 像 SQL 一样查询 XML？

> ID：140908
> 
> 赞同：6
> 
> 时间：2008-09-26T17:46:32.333
> 
> 标签：sql, xml, language-agnostic, frameworks

有没有查询 XML SQL 语法的框架，我真的厌倦了遍历节点列表。

* * *

或者这只是一厢情愿（如果不是白痴的话）而且肯定不可能，因为 XML 不是关系数据库？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-26T17:47:07.090

[XQuery](http://www.w3schools.com/xquery/default.asp)和 XPath... 如果需要 SQL 结构，XQuery 更适合您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:47:23.033

.Net Framework 提供 LINQ 来执行此操作，或者您可以使用 .Net System.Data 命名空间从 XML 文件加载数据。

您甚至可以创建在表等之间具有连接的查询。

例如，System.Data.DataTable 提供了一个`ReadXml()`方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T17:47:53.220

您可以尝试使用 LINQ to XML，但它与语言无关。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T23:55:31.510

[XQuery](http://www.w3.org/TR/xquery/)是一种最接近 SQL 的函数式语言。 [XPath](http://www.w3.org/TR/xpath)是一种用于在文档中定位节点的符号，该节点用作 XSLT 和 XQuery 的一部分。

XML 数据库（如[MarkLogic）](http://www.marklogic.com/)用作 XML 数据的 XQuery 引擎，就像关系数据库用作关系数据的 SQL 引擎一样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-01T05:55:44.727

这取决于您要解决的问题。如果 XML 文件非常大，有时必须使用 SAX 解析器之类的东西逐个节点遍历文件，否则您将收到 OutOfMemoryException 或者甚至会耗尽计算机上的虚拟内存。

但是，如果 XML 文件的预期大小相对较小，您可以简单地使用 Linq 之类的东西，也请参阅我的[答案- 在这里我试图解释，如何使用像](https://stackoverflow.com/questions/1088442/what-is-the-purpose-advantage-of-using-yield-return-iterators-in-c/2508429#2508429)**yield return**这样的结构更容易地遍历节点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T23:34:33.183

SQL Server 2005在其本机数据类型上支持[XML DML 。](http://msdn.microsoft.com/en-us/library/ms177454.aspx)`xml`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T20:46:52.647

XQuery 无疑是前进的方向。这就是[eXist](http://exist-db.org/)和[MarkLogic](http://www.marklogic.com/)等 XML 数据库所使用的。

在 Java 世界中，有几种在平面文件上运行 XQuery 的解决方案，最著名的是[Saxon](http://www.saxonica.com/)

对于.NET，没有那么多可用的。Microsoft 确实有一个 XQuery 库，尽管它是从 .NET 2 中提取的，并且从未出现过。 [XQSharp](http://www.xqsharp.com/) 是一个原生的 .NET 替代方案，尽管目前只发布了一个命令行版本。

# c# - 如何在维护相邻列的同时在列表视图中实现排序？

> ID：140918
> 
> 赞同：4
> 
> 时间：2008-09-26T17:47:52.003
> 
> 标签：c#, winforms, listview

我有一个有几列的 ListView。

其中一个包含“名称”，另一个包含“金额”。我想允许用户单击列表视图中的名称列并按字母顺序排序，还允许用户单击“金额”并按数字排序（更高/更低-更低/更高）。

实现这一点的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T17:51:18.547

它已部分实施，但未完全实施。[Microsoft 在http://support.microsoft.com/kb/319401](http://support.microsoft.com/kb/319401)上有关于如何解决此问题的说明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T17:55:10.443

为了解决这个问题，我编写了自己的 ListViewItemComparer，它实现了 IComparer 接口。然后，根据列是数字还是字符串，我进行了适当的比较。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-15T07:54:35.667

[ObjectListView](http://www.codeproject.com/KB/list/objectlistview.aspx)（一个围绕.NET WinForms ListView 的开源包装器）会自动为您完成这项工作。

# ruby-on-rails - 有没有人使用 Ruby/Rails 和 Sales Logix 数据库？

> ID：140922
> 
> 赞同：1
> 
> 时间：2008-09-26T17:48:19.443
> 
> 标签：ruby-on-rails, ruby, database, saleslogix

有没有人使用 Ruby/Rails 和 Sales Logix 数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:20:13.697

[这个页面](http://www.2020software.com/products/Sage_SalesLogix_System_Requirements.asp)说 SalesLogix 在 MS SQL Server 或 Oracle 上运行，两者都可以通过 ActiveRecord 与 Rails 连接。

[这](http://piao-tech.blogspot.com/2008/02/using-activerecord-with-microsoft-sql.html)是一个详细介绍 MS SQL 设置的页面（更可能在其上运行）。

# c# - 在 C# 中规范化换行符

> ID：140926
> 
> 赞同：30
> 
> 时间：2008-09-26T17:48:59.333
> 
> 标签：c#, .net

我有一个可能包含 \r、\n、\r\n、\n\r 或它们的任意组合的数据流。有没有一种简单的方法来规范化数据以使它们都简单地变成 \r\n 对以使显示更加一致？

所以会产生这种翻译表的东西：

```
\r     --> \r\n
\n     --> \r\n
\n\n   --> \r\n\r\n
\n\r   --> \r\n
\r\n   --> \r\n
\r\n\n --> \r\n\r\n 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-26T18:14:56.917

我相信这会满足您的需求：

```
using System.Text.RegularExpressions;
// ...
string normalized = Regex.Replace(originalString, @"\r\n|\n\r|\n|\r", "\r\n"); 
```

我不能 100% 确定确切的语法，而且我没有方便检查的 .Net 编译器。我用 perl 编写了它，并将其转换为（希望是正确的）C#。唯一真正的技巧是首先匹配“\r\n”和“\n\r”。

要将其应用于整个流，只需在输入块上运行。（如果需要，您可以使用流包装器来执行此操作。）

* * *

原来的perl：

```
$str =~ s/\r\n|\n\r|\n|\r/\r\n/g; 
```

测试结果：

```
[bash$] ./test.pl
\r -> \r\n
\n -> \r\n
\n\n -> \r\n\r\n
\n\r -> \r\n
\r\n -> \r\n
\r\n\n -> \r\n\r\n 
```

* * *

更新：现在将 \n\r 转换为 \r\n，尽管我不会称之为标准化。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-26T21:47:59.320

我和 Jamie Zawinski 在 RegEx 上：

“有些人在遇到问题时会想‘我知道，我会使用正则表达式。’现在他们有两个问题”

对于我们这些喜欢可读性的人：

*   第1步

    将 \r\n 替换为 \n

    将 \n\r 替换为 \n （如果你真的想要这个，有些海报似乎不这么认为）

    将 \r 替换为 \n

*   第 2 步将 \n 替换为 Environment.NewLine 或 \r\n 或其他任何内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-01-17T12:13:06.287

规范化休息，使它们都是`\r\n`

```
var normalisedString =
            sourceString
            .Replace("\r\n", "\n")
            .Replace("\n\r", "\n")
            .Replace("\r", "\n")
            .Replace("\n", "\r\n"); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-10-11T03:23:05.463

这是一个两步的过程。
首先，您将`\r`和的所有组合`\n`转换为单个组合，`\r`
然后将所有组合转换`\r`为目标`\r\n`

```
normalized = 
    original.Replace("\r\n", "\r").
             Replace("\n\r", "\r").
             Replace("\n", "\r").
             Replace("\r", "\r\n"); // last step 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T17:53:41.647

正则表达式会有所帮助..可以做大致这样的事情..

(\r\n|\n\n|\n\r|\r|\n) 替换为 \r\n

此正则表达式从发布的表中生成了这些结果（仅测试左侧），因此替换应该正常化。

```
\r   => \r 
\n   => \n 
\n\n => \n\n 
\n\r => \n\r 
\r\n => \r\n 
\r\n => \r\n 
\n   => \n 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T18:02:53.247

你想的太复杂了。忽略每一个\r，把每一个\n变成一个\r\n。

在伪 C# 中：

```
char[] chunk = new char[X];
StringBuffer output = new StringBuffer();

buffer.Read(chunk);
foreach (char c in chunk)
{
   switch (c)
   {
      case '\r' : break; // ignore
      case '\n' : output.Append("\r\n");
      default   : output.Append(c);
   }
 } 
```

**编辑**：单独的 \r 不是行终止符，所以我怀疑你真的想将 \r 扩展到 \r\n。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-11-17T11:13:55.647

这就是问题的答案。给定的解决方案用给定的翻译表替换字符串。它不使用昂贵的正则表达式函数。它也不使用多个替换函数，每个替换函数都通过多次检查等对数据进行循环。

所以搜索直接在 1 for 循环中完成。对于必须增加结果数组容量的次数，Array.Copy 函数中也使用了循环。这就是所有的循环。在某些情况下，更大的页面大小可能更有效。

```
public static string NormalizeNewLine(this string val)
{
    if (string.IsNullOrEmpty(val))
        return val;

    const int page = 6;
    int a = page;
    int j = 0;
    int len = val.Length;
    char[] res = new char[len];

    for (int i = 0; i < len; i++)
    {
        char ch = val[i];

        if (ch == '\r')
        {
            int ni = i + 1;
            if (ni < len && val[ni] == '\n')
            {
                res[j++] = '\r';
                res[j++] = '\n';
                i++;
            }
            else
            {
                if (a == page) //ensure capacity
                {
                    char[] nres = new char[res.Length + page];
                    Array.Copy(res, 0, nres, 0, res.Length);
                    res = nres;
                    a = 0;
                }

                res[j++] = '\r';
                res[j++] = '\n';
                a++;
            }
        }
        else if (ch == '\n')
        {
            int ni = i + 1;
            if (ni < len && val[ni] == '\r')
            {
                res[j++] = '\r';
                res[j++] = '\n';
                i++;
            }
            else
            {
                if (a == page) //ensure capacity
                {
                    char[] nres = new char[res.Length + page];
                    Array.Copy(res, 0, nres, 0, res.Length);
                    res = nres;
                    a = 0;
                }

                res[j++] = '\r';
                res[j++] = '\n';
                a++;
            }
        }
        else
        {
            res[j++] = ch;
        }
    }

    return new string(res, 0, j);
} 
```

即使 '\n\r' 并没有在基本平台上实际使用，翻译表也很吸引我。谁会使用两种类型的换行符来指示 2 个换行符？如果您想知道这一点，那么您需要先看看是否 \n 和 \r 都在同一个文档中单独使用。

# c++ - C ++上的部分类定义？

> ID：140935
> 
> 赞同：40
> 
> 时间：2008-09-26T17:51:06.053
> 
> 标签：c++

任何人都知道是否可以在 C++ 上进行部分类定义？

就像是：

文件1.h：

```

类测试{
    上市：
        int test1();
};

```

文件2.h：

```
类测试{
    上市：
        int test2();
};

```

对我来说，定义多平台类似乎非常有用，这些类在它们之间具有独立于平台的公共功能，因为继承是一种对多平台类没有用处的成本。

我的意思是你永远不会在运行时有两个多平台专业化实例，只有在编译时。继承可能有助于满足您的公共接口需求，但之后它不会在运行时添加任何有用的东西，只会增加成本。

此外，您将不得不使用丑陋的#ifdef 来使用该类，因为您无法从抽象类创建实例：

```
类通用测试 {
    上市：
        int 通用方法（）；
};

```

然后让我们说win32：

```
类win32Test：公共通用测试{
    上市：
        int win32Method();
};

```

有可能：

```
类macTest：公共genericTest {
    上市：
        int macMethod();
};

```

假设 win32Method() 和 macMethod() 都调用 genericMethod()，您将不得不像这样使用该类：

```
#ifdef _WIN32
 genericTest *test = new win32Test();
 #elif MAC
 genericTest *test = new macTest();
 ＃万一

 测试->通用方法（）；

```

现在想了一会儿，继承只对给他们一个 genericMethod() 是有用的，它依赖于特定于平台的方法，但是你有调用两个构造函数的代价。你也有丑陋的#ifdef 散落在代码周围。

这就是为什么我在寻找部分课程。我可以在编译时定义特定平台相关的部分结束，当然，在这个愚蠢的例子中，我仍然需要在 genericMethod() 中使用丑陋的#ifdef，但还有另一种方法可以避免这种情况。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-26T17:52:50.150

这在 C++ 中是不可能的，它会给你一个关于重新定义已经定义的类的错误。如果您想共享行为，请考虑继承。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-26T17:52:34.380

尝试继承

具体来说

```
class AllPlatforms {
public:
    int common();
}; 
```

进而

```
class PlatformA : public AllPlatforms {
public:
    int specific();
}; 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-29T18:33:03.850

您不能在 C++ 中部分定义类。

这是一种获得“多态性，其中只有一个子类”效果的方法，无需开销，并且最少需要#define 或代码重复。它被称为模拟动态绑定：

```
template <typename T>
class genericTest {
public:
    void genericMethod() {
        // do some generic things
        std::cout << "Could be any platform, I don't know" << std::endl;
        // base class can call a method in the child with static_cast
        (static_cast<T*>(this))->doClassDependentThing();
    }
};

#ifdef _WIN32
    typedef Win32Test Test;
#elif MAC
    typedef MacTest Test;
#endif 
```

然后在其他一些标题中关闭：

```
class Win32Test : public genericTest<Win32Test> {
public:
    void win32Method() {
        // windows-specific stuff:
        std::cout << "I'm in windows" << std::endl;
        // we can call a method in the base class
        genericMethod();
        // more windows-specific stuff...
    }
    void doClassDependentThing() {
        std::cout << "Yep, definitely in windows" << std::endl;
    }
}; 
```

和

```
class MacTest : public genericTest<MacTest> {
public:
    void macMethod() {
        // mac-specific stuff:
        std::cout << "I'm in MacOS" << std::endl;
        // we can call a method in the base class
        genericMethod();
        // more mac-specific stuff...
    }
    void doClassDependentThing() {
        std::cout << "Yep, definitely in MacOS" << std::endl;
    }
}; 
```

这在编译时为您提供了适当的多态性。genericTest 可以以非虚拟方式调用 doClassDependentThing，从而为其提供平台版本（几乎类似于虚拟方法），并且当 win32Method 调用 genericMethod 时，它当然会获得基类版本。

这不会产生与虚拟调用相关的开销——您获得的性能与您键入两个没有共享代码的大类相同。它可能会在 con(de)struction 时创建非虚拟调用开销，但如果 genericTest 的 con(de)structor 是内联的，你应该没问题，而且在任何情况下，开销并不比具有由调用的 genericInit 方法差两个平台。

客户端代码只是创建 Test 的实例，并且可以在它们上调用 genericTest 或平台正确版本中的方法。为了帮助不关心平台并且不想意外使用特定于平台的调用的代码中的类型安全，您还可以执行以下操作：

```
#ifdef _WIN32
    typedef genericTest<Win32Test> BaseTest;
#elif MAC
    typedef genericTest<MacTest> BaseTest;
#endif 
```

使用 BaseTest 时必须小心谨慎，但不会比 C++ 中的基类更谨慎。例如，不要用判断错误的传递值来分割它。并且不要直接实例化它，因为如果你这样做并调用一个最终尝试“假虚拟”调用的方法，你就有麻烦了。后者可以通过确保所有 genericTest 的构造函数都受到保护来强制执行。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-26T18:19:07.420

或者你可以试试 PIMPL

通用头文件：

```
class Test
{
public:
    ...
    void common();
    ...
private:
    class TestImpl;
    TestImpl* m_customImpl;
}; 
```

然后创建执行特定于平台的自定义实现的 cpp 文件。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-26T19:39:43.997

```
#include will work as that is preprocessor stuff.

class Foo
{
#include "FooFile_Private.h"
}

////////

FooFile_Private.h:

private:
  void DoSg(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T18:20:45.140

这个怎么样：

```
class WindowsFuncs { public: int f(); int winf(); };
class MacFuncs { public: int f(); int macf(); }

class Funcs
#ifdef Windows 
    : public WindowsFuncs
#else
    : public MacFuncs
#endif
{
public:
    Funcs();
    int g();
}; 
```

Now`Funcs`是一个在编译时已知的类，因此抽象基类或其他任何东西都不会引起开销。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T17:54:05.560

正如所写，这是不可能的。

您可能想查看名称空间。您可以将函数添加到另一个文件中的命名空间。类的问题是每个 .cpp 都需要查看类的完整布局。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T17:55:33.140

没有。

但是，您可能想查找一种称为“策略类”的技术。基本上，你制作微课（它们本身没有用），然后在稍后将它们粘合在一起。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T17:55:48.163

正如 Jamie 所说，要么使用继承，要么使用 #ifdef 使不同的部分在不同的平台上编译。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-26T17:56:15.917

由于标头只是以文本形式插入，因此其中一个可以省略“class Test {”和“}”并在另一个中间被#included。

我实际上已经在生产代码中看到了这一点，尽管 Delphi 不是 C++。它特别让我恼火，因为它破坏了 IDE 的代码导航功能。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T18:04:51.043

> 对我来说，定义多平台类似乎非常有用，这些类在它们之间具有独立于平台的通用功能。

除非开发人员几十年来一直在这样做，但没有这个“功能”。

我相信部分的创建是因为微软几十年来也有生成代码并将其交给开发人员开发和维护的坏习惯。

生成的代码通常是维护的噩梦。当您需要提升 MFC 版本时，整个 MFC 生成的框架有哪些习惯？或者在升级 Visual Studio 时如何将所有代码移植到 *.designer.cs 文件中？

大多数其他平台更依赖于生成**配置文件**，而不是用户/开发人员可以修改。那些，词汇量比较有限，不容易与不相关的代码混在一起。如果认为有必要，配置文件甚至可以作为资源文件插入到二进制文件中。

我从未见过在继承或配置资源文件不会做得更好的地方使用“部分”。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-01-28T17:16:13.883

肮脏但实用的方法是使用#include预处理器：

测试.h：

```
#ifndef TEST_H
#define TEST_H

class Test
{
public:
    Test(void);
    virtual ~Test(void);

#include "Test_Partial_Win32.h"
#include "Test_Partial_OSX.h"

};

#endif // !TEST_H 
```

Test_Partial_OSX.h：

```
// This file should be included in Test.h only.

#ifdef MAC
    public:
        int macMethod();
#endif // MAC 
```

Test_Partial_WIN32.h：

```
// This file should be included in Test.h only.

#ifdef _WIN32
    public:
        int win32Method();
#endif // _WIN32 
```

测试.cpp：

```
// Implement common member function of class Test in this file.

#include "stdafx.h"
#include "Test.h"

Test::Test(void)
{
}

Test::~Test(void)
{
} 
```

Test_Partial_OSX.cpp：

```
// Implement OSX platform specific function of class Test in this file.

#include "stdafx.h"
#include "Test.h"

#ifdef MAC
int Test::macMethod()
{
    return 0;
}
#endif // MAC 
```

Test_Partial_WIN32.cpp：

```
// Implement WIN32 platform specific function of class Test in this file.

#include "stdafx.h"
#include "Test.h"

#ifdef _WIN32
int Test::win32Method()
{
    return 0;
}
#endif // _WIN32 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-08-22T11:33:01.930

假设我有：

MyClass_Part1.hpp、MyClass_Part2.hpp 和 MyClass_Part3.hpp

**理论上**，有人可以开发一个 GUI 工具来读取上面所有这些 hpp 文件并创建以下 hpp 文件：

我的类.hpp

```
class MyClass
{
   #include <MyClass_Part1.hpp>
   #include <MyClass_Part2.hpp>
   #include <MyClass_Part3.hpp>
}; 
```

**理论上**，用户可以告诉 GUI 工具每个输入 hpp 文件在哪里以及在哪里创建输出 hpp 文件。

当然，**理论上**开发人员可以对 GUI 工具进行编程，以处理任意数量的 hpp 文件（不一定只有 3 个），其前缀可以是任意字符串（不一定只有“MyClass”）。

只是不要忘记`#include <MyClass.hpp>`在您的项目中使用“MyClass”类。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-01-11T14:46:26.673

正如所写，这是不可能的，在某些情况下它实际上很烦人。

ISO 有一个官方建议，考虑到嵌入式软件，特别是为了避免继承和 pimpl 模式带来的 RAM 开销（这两种方法都需要为每个对象添加一个额外的指针）：

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0309r0.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0309r0.pdf)

不幸的是，该提议被拒绝了。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T17:55:33.653

两次声明类体可能会产生类型重定义错误。如果您正在寻找解决方法。我建议#ifdef'ing，或者使用[抽象基类](http://en.wikipedia.org/wiki/Abstract_base_class)来隐藏平台特定的细节。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T18:08:40.113

*您可以使用模板专业化*和*部分专业化*获得部分类之类的东西。在您投入太多时间之前，请检查您的编译器对这些的支持。像 MSC++ 6.0 这样的旧编译器不支持部分特化。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-02-08T14:56:51.967

> 这在 C++ 中是不可能的，它会给你一个关于重新定义已经定义的类的错误。如果您想共享行为，请考虑继承。

我同意这一点。部分类是一种奇怪的结构，之后很难维护。很难定位每个成员声明在哪个部分类上，并且很难避免重新定义甚至重新实现特性。

你想扩展std::vector，你必须继承它。这是因为几个原因。首先，您更改了类的责任和（正确地？）它的类不变量。其次，从安全的角度来看，应该避免这种情况。考虑一个处理用户身份验证的类......

```
partial class UserAuthentication {
  private string user;
  private string password;
  public bool signon(string usr, string pwd);
}

partial class UserAuthentication {
  private string getPassword() { return password; }
} 
```

还可以说很多其他的原因...

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-03-08T10:33:16.213

让平台无关和平台相关的类/函数成为彼此的朋友类/函数。:)

并且它们单独的名称标识符允许对实例化进行更好的控制，因此耦合更松散。部分完全破坏了 OO 的封装基础，而必要的友元声明几乎没有放松它，足以促进诸如平台特定方面与领域特定平台独立方面之类的关注点的多范式分离。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-01-12T02:06:06.190

我一直在我的渲染引擎中做类似的事情。我有一个模板化的 IResource 接口类，从中继承了各种资源（为简洁起见）：

```
template <typename TResource, typename TParams, typename TKey>
class IResource
{
public:
    virtual TKey GetKey() const = 0;
protected:
    static shared_ptr<TResource> Create(const TParams& params)
    {
        return ResourceManager::GetInstance().Load(params);
    }
    virtual Status Initialize(const TParams& params, const TKey key, shared_ptr<Viewer> pViewer) = 0;
}; 
```

静态函数回调一个模板化的`Create`ResourceManager 类，该类负责加载、卸载和存储它使用唯一键管理的资源类型的实例，确保从存储中简单地检索重复调用，而不是作为单独的资源重新加载。

```
template <typename TResource, typename TParams, typename TKey>
class TResourceManager
{
    sptr<TResource> Load(const TParams& params) { ... }
}; 
```

具体资源类利用 CRTP 从 IResource 继承。专门针对每种资源类型的 ResourceManager 被声明为这些类的朋友，以便 ResourceManager 的`Load`函数可以调用具体资源的`Initialize`函数。一个这样的资源是纹理类，它进一步使用 pImpl 习惯用法来隐藏其私有：

```
class Texture2D : public IResource<Texture2D , Params::Texture2D , Key::Texture2D >
{
    typedef TResourceManager<Texture2D , Params::Texture2D , Key::Texture2D > ResourceManager;
    friend class ResourceManager;

public:
    virtual Key::Texture2D GetKey() const override final;
    void GetWidth() const;
private:
    virtual Status Initialize(const Params::Texture2D & params, const Key::Texture2D key, shared_ptr<Texture2D > pTexture) override final;

    struct Impl;
    unique_ptr<Impl> m;
}; 
```

我们的纹理类的大部分实现是平台无关的（例如，`GetWidth`如果它只返回一个存储在 Impl 中的 int 的函数）。但是，根据我们所针对的图形 API（例如 Direct3D11 与 OpenGL 4.3），某些实现细节可能会有所不同。一种解决方案可能是从 IResource 继承一个中间 Texture2D 类，该类定义所有纹理的扩展公共接口，然后从中继承 D3DTexture2D 和 OGLTexture2D 类。此解决方案的第一个问题是它要求您的 API 用户不断注意他们所针对的图形 API（他们可以调用`Create`两个子类）。这可以通过限制`Create`到中间 Texture2D 类来解决，该类可能使用`#ifdef`切换以创建 D3D 或 OGL 子对象。但是这个解决方案仍然存在第二个问题，即平台无关的代码将在两个孩子之间重复，从而导致额外的维护工作。您可以尝试通过将独立于平台的代码移动到中间类来解决这个问题，但是如果某些成员数据同时被特定于平台的代码和独立于平台的代码使用，会发生什么情况呢？D3D/OGL 子代将无法访问中介 Impl 中的这些数据成员，因此您必须将它们移出 Impl 并移入标头，以及它们携带的任何依赖项，从而暴露任何包含您的标头的人所有他们不需要知道的废话。

API 应该易于使用正确且难以使用错误。易于使用权利的一部分是限制用户只接触他们应该使用的 API 部分。该解决方案使其容易被错误使用并增加了维护开销。用户应该只关心他们在一个地方定位的图形 API，而不是他们使用您的 API 的任何地方，并且他们不应该暴露于您的内部依赖项。这种情况需要部分类，但它们在 C++ 中不可用。因此，您可以简单地在单独的头文件中定义 Impl 结构，一个用于 D3D，一个用于 OGL，然后放一个`#ifdef`在 Texture2D.cpp 文件的顶部切换，并通用定义公共接口的其余部分。这样，公共接口可以访问它需要的私有数据，唯一重复的代码是数据成员声明（构造仍然可以在创建 Impl 的 Texture2D 构造函数中完成），您的私有依赖项保持私有，而用户不需要除了在暴露的 API 表面中使用有限的调用集之外，必须关心任何事情：

```
// D3DTexture2DImpl.h
#include "Texture2D.h"
struct Texture2D::Impl
{
    /* insert D3D-specific stuff here */
};

// OGLTexture2DImpl.h
#include "Texture2D.h"
struct  Texture2D::Impl
{
    /* insert OGL-specific stuff here */
};

// Texture2D.cpp
#include "Texture2D.h"

#ifdef USING_D3D
#include "D3DTexture2DImpl.h"
#else
#include "OGLTexture2DImpl.h"
#endif

Key::Texture2D Texture2D::GetKey() const
{
    return m->key;
}
// etc... 
```

# c# - 有没有人使用 C# 和 Sales Logix 数据库？

> ID：140936
> 
> 赞同：-3
> 
> 时间：2008-09-26T17:51:14.397
> 
> 标签：c#, .net, database, saleslogix

有没有人使用 C# 和 Sales Logix 数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-19T05:22:51.353

是的。我使用 C# 中的 datagridviews 重写了一个历史选项卡，它比原来的 Best/Sage 内置选项卡版本更好更快。这是一个 .NET 插件，我使用 Ryan Farley 的说明让它在 SLX 6.x 中工作。在 SLX 7.x 中，您可以原生使用 C# 和 VB.NET 来构建插件组件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T18:22:34.637

是的。我有。

（不是今天关于 SOB 最有趣的答案，但这就是问题所问的......）

# c# - 有没有办法公开强类型资源文件（而不是内部文件）？

> ID：140937
> 
> 赞同：22
> 
> 时间：2008-09-26T17:51:15.957
> 
> 标签：c#, asp.net, .net-2.0, resources, strong-typing

这是我想做的：

我想创建一个包含我的资源文件（即 UI 标签等）的库项目。然后我想在我的 UI 和我的测试中使用资源库。（即，我从多个项目中引用的资源基本上有一个共同的地方。）

不幸的是，由于 StronglyTypedResourceBuilder（生成资源代码的 .Net 类）默认情况下将资源文件设置为内​​部文件，因此我无法在不跳转的情况下从另一个项目（即我的 UI 或测试）引用库中的强类型资源通过箍（即，类似于[此处](http://www.codeproject.com/KB/dotnet/Localization.aspx)描述的内容，或编写公共包装类/函数）。

不幸的是，这两种解决方案都消除了我保持强类型引用的能力。

有没有人找到一种直接的方法来创建可以从多个项目中引用的强类型 .Net 资源？

我宁愿避免使用构建事件来完成此操作（即，将所有“内部”实例替换为“公共”，但这基本上是我的后备计划，如果我找不到答案..

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-26T18:11:00.513

不确定您使用的是哪个版本的 Visual Studio，因此我将为任一版本设置步骤：

VS 2008 - 当您在设计视图中打开 resx 文件时，在顶部添加资源和删除资源旁边有一个选项，称为访问修饰符，它是一个下拉列表，您可以在其中将生成的代码从内部更改为公共。

VS 2005 - 你没有像 VS 2008 那样生成代码的选项。这是一个添加的功能，因为这个令人头疼。虽然有解决办法。[您可以使用像此工具](http://altinoren.com/CommentView,guid,5b69e6d6-86b0-4717-889a-94db78ff04b2.aspx)这样的第三方生成器，也可以使用 AssemblyInfo.cs 中的[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性来添加可以访问资源库内部类的项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T17:53:59.120

Visual Studio 2008 允许您选择生成的资源类应该是内部的还是公共的。还有[ResXFileCodeGeneratorEx](http://www.codeproject.com/KB/dotnet/ResXFileCodeGeneratorEx.aspx)，它应该为 Visual Studio 2005 做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T17:57:02.293

在数据集设计器和可见的属性窗口中，有一个“修改器”属性。对于您的数据集，它可能是内部的。

我不知道是否有将所有新数据集默认为公开的设置。

# memory - 使用 VB6 查询更快的目录遍历：缓存和 Ram 问题？

> ID：140948
> 
> 赞同：1
> 
> 时间：2008-09-26T17:53:09.543
> 
> 标签：memory, recursion, vb6

下面是一个相当简单的函数，它计算机器上有多少文件。调用“C:\”，运行大约需要 5 秒。除非我有一段时间没有运行它或者首先运行一个 ram-clearing 程序，在这种情况下它需要 60 秒或更长时间。我不会认为它可能是缓存，因为我每次都在进行新的扫描（即启动程序的新实例，因为它所做的只是这次扫描），但也许它与内存分配有关？关于如何每次都进行快速运行的任何想法，或者为什么不能完成？其他程序（例如 SpaceMonger）设法在 10 秒内获得文件总数，即使我清除我的内存或在运行之间等待很长时间。所以，肯定有办法做到这一点，但不一定在 VB 中。

```
Private Function countFiles(Name As String) As Long
    On Error GoTo ErrorHandler
    DoEvents
    Const CurMthd = "countFiles"
          Dim retval As Long
13        Dim FindData As win.WIN32_FIND_DATA
14        Dim SearchPath As String
15        Dim FileName As String
17        Dim SearchHandle As Long
          If Right(Name, 1) <> "\" Then Name = Name & "\"
19        SearchPath = Name & "*.*"
20        SearchHandle = win.FindFirstFile(SearchPath, FindData)
          Do
              DoEvents
'             g_Cancel = True
              If g_Cancel Then
                countFiles = retval
                Exit Function
            End If
22            If SearchHandle = win.INVALID_HANDLE_VALUE Or SearchHandle =     ERROR_NO_MORE_FILES Then Exit Do
23            FileName = dsMain.RetainedStrFromPtrA(VarPtr(FindData.cFileName(0)))
24            If AscW(FileName) <> 46 Then
                    If (FindData.dwFileAttributes And win.FILE_ATTRIBUTE_DIRECTORY)     Then
                        retval = retval + countFiles(Name & FileName)
                    Else
                        retval = retval + 1
                    End If
28            End If
29        Loop Until win.FindNextFile(SearchHandle, FindData) = 0
    win.FindClose SearchHandle
    countFiles = retval
    Exit Function
ErrorHandler:
    Debug.Print "Oops: " & Erl & ":" & Err.Description
    Resume Next
End Function 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T18:22:16.540

操作系统本身缓存从磁盘读取的数据。这完全在您的程序之外，您实际上无法控制它。因此，当您运行“内存清除”程序时，它会清除这些缓存。这就是为什么那些“内​​存清除”程序通常完全没用的原因——正如您所看到的，通过清空缓存会使您的程序运行速度变慢。

# .net - 从 .NET 应用程序中抓取和移动应用程序窗口？

> ID：140993
> 
> 赞同：7
> 
> 时间：2008-09-26T17:58:23.680
> 
> 标签：.net, window-handles

.NET 应用程序是否可以获取当前打开的所有窗口句柄，并移动/调整这些窗口的大小？

我很确定它可以使用 P/Invoke，但我想知道是否有一些用于此功能的托管代码包装器。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T18:05:51.790

是的，可以使用 Windows API。

这篇文章有关于如何从活动进程中获取所有窗口句柄的信息：[http ://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=35545](http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=35545)

```
using System;
using System.Diagnostics;

class Program
{
    static void Main()
    {
       Process[] procs = Process.GetProcesses();
       IntPtr hWnd;
       foreach(Process proc in procs)
       {
          if ((hWnd = proc.MainWindowHandle) != IntPtr.Zero)
          {
             Console.WriteLine("{0} : {1}", proc.ProcessName, hWnd);
          }
       }         
    }
 } 
```

然后您可以使用 Windows API 移动窗口：http: [//www.devasp.net/net/articles/display/689.html](http://www.devasp.net/net/articles/display/689.html)

```
[DllImport("User32.dll", ExactSpelling = true, CharSet = System.Runtime.InteropServices.CharSet.Auto)]
        private static extern bool MoveWindow(IntPtr hWnd, int x, int y, int cx, int cy, bool repaint);

...

MoveWindow((IntPtr)handle, (trackBar1.Value*80), 20 , (trackBar1.Value*80)-800, 120, true); 
```

以下是 MoveWindow 函数的参数：

> 为了移动窗口，我们使用 MoveWindow 函数，该函数根据屏幕坐标获取窗口句柄、顶角的坐标以及所需的窗口宽度和高度。MoveWindow 函数定义为：
> 
> MoveWindow(HWND hWnd, int nX, int nY, int nWidth, int nHeight, BOOL bRepaint);
> 
> bRepaint 标志确定是否应使客户区无效，从而导致发送 WM_PAINT 消息，从而允许客户区被重新绘制。顺便说一句，可以使用类似于 GetClientRect(GetDesktopWindow(), &rcDesktop) 的调用来获取屏幕坐标，其中 rcDesktop 是 RECT 类型的变量，通过引用传递。

（[http://windows-programming.suite101.com/article.cfm/client_area_size_with_movewindow](http://windows-programming.suite101.com/article.cfm/client_area_size_with_movewindow)）

# wpf - 如何通过数据绑定设置 WPF 超链接的文本？

> ID：140996
> 
> 赞同：133
> 
> 时间：2008-09-26T17:58:32.133
> 
> 标签：wpf, data-binding, hyperlink

在 WPF 中，我想创建一个导航到对象详细信息的超链接，并且我希望超链接的文本是对象的名称。现在，我有这个：

```
<TextBlock><Hyperlink Command="local:MyCommands.ViewDetails" CommandParameter="{Binding}">Object Name</Hyperlink></TextBlock> 
```

但我希望“对象名称”绑定到对象的实际名称。我想做这样的事情：

```
<TextBlock><Hyperlink Command="local:MyCommands.ViewDetails" CommandParameter="{Binding}" Text="{Binding Path=Name}"/></TextBlock> 
```

但是，Hyperlink 类没有适合数据绑定的文本或内容属性（即依赖属性）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2008-09-26T18:00:57.463

它看起来很奇怪，但它确实有效。我们在我们的应用程序中的大约 20 个不同的地方执行此操作。如果您将文本放入其“内容”中，则`Hyperlink`隐式构造 a ，但在 .NET 3.5中不会让您绑定到它，因此您必须显式使用 a 。`<Run/>``<Run/>``TextBlock`

```
<TextBlock>
    <Hyperlink Command="local:MyCommands.ViewDetails" CommandParameter="{Binding}">
        <TextBlock Text="{Binding Path=Name}"/>
    </Hyperlink>
</TextBlock> 
```

* * *

**更新**：请注意，从 .NET 4.0 开始，现在可以绑定[Run.Text 属性：](http://msdn.microsoft.com/en-us/library/system.windows.documents.run.text.aspx?PHPSESSID=o1fb21liejulfgrptbmi9dec92)

```
<Run Text="{Binding Path=Name}" /> 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-11-26T04:49:43.170

这在“页面”中对我有用。

```
<TextBlock>
    <Hyperlink NavigateUri="{Binding Path}">
        <TextBlock Text="{Binding Path=Path}" />
    </Hyperlink>
</TextBlock> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-07-04T19:46:35.157

在 Windows 应用商店应用程序（和 Windows Phone 8.1 RT 应用程序）上面的例子不起作用，使用 HyperlinkBut​​ton 并像往常一样绑定 Content 和 NavigateUri 属性。********``****