# StackOverflow 问答 000129000-000129999

# php - 使用 PHP 和 GD 生成的图像被切断

> ID：129013
> 
> 赞同：2
> 
> 时间：2008-09-24T18:42:40.603
> 
> 标签：php, gd

这仅发生在实时服务器上。在多重开发服务器上，图像正在按预期创建。

直播：红帽

```
$ php --version
PHP 5.2.6 (cli) (built: May 16 2008 21:56:34) 
Copyright (c) 1997-2008 The PHP Group
Zend Engine v2.2.0, Copyright (c) 1998-2008 Zend Technologies 
```

GD 支持 => 启用 GD 版本 => 捆绑（2.0.34 兼容）

开发：Ubuntu 8

```
$ php --version
PHP 5.2.4-2ubuntu5.3 with Suhosin-Patch 0.9.6.2 (cli) (built: Jul 23 2008 06:44:49) 
Copyright (c) 1997-2007 The PHP Group
Zend Engine v2.2.0, Copyright (c) 1998-2007 Zend Technologies 
```

GD 支持 => 启用 GD 版本 => 2.0 或更高版本

```
<?php
$image = imagecreatetruecolor($width, $height);

// Colors in RGB
$white = imagecolorallocate($image, 255, 255, 255);
$black = imagecolorallocate($image, 0, 0, 0); 

imagefilledrectangle($image, 0, 0, $width, $height, $white);

imagettftext($image, $fontSize, 0, 0, 50, $black, $font, $text);
imagegif($image, $file_path);
?> 
```

在一个完美的世界中，我希望实时服务器和开发服务器运行相同的发行版，但实时服务器必须是 Red Hat。

我的问题是，有没有人知道使用 GD 的捆绑版本会导致图像的最右侧部分被切断的具体差异？

编辑：我没有内存不足。日志文件中没有生成错误。就 php 而言，图像正在正确生成。这就是为什么我认为捆绑版本是 GD 特有的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T18:46:02.827

也许你的内存不足或类似的东西？您是否仔细检查了所有日志文件等？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T20:44:02.087

Does it depend on the image ?

Recently I discovered a strange bug/feature in PHP & GD.

When trying to resize and edit JPEGs that had an all white background (c. 3MB), it would fail. It DID work with other images that were larger (c. 4MB), and more complicated backgrounds.

I worked out that when GD opened the images to edit, the white back ground images grew by a greater ratio than the more complex images. This ratio for some images caused PHP/GD to fail and cut of images halfway.

William

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:47:36.800

它是 100% 一致的并且总是在同一个地方吗？如果不是，则可能是资源问题——执行脚本的时间或内存限制。尝试调整 php.ini 设置，重新启动 Web 服务器，进行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T08:40:56.467

可能不是图像被截断。可能是文本被截断。

```
imagettftext($image, $fontSize, 0, 0, 50, $black, $font, $text); 
```

TTF 字体有开销和填充。尝试更大的画布，看看是否得到相同的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T21:28:25.787

你有没有$width输出的值，看看它是否正确？

# visual-studio - 您真正想为 Visual Studio 2005/2008 安装什么插件

> ID：129015
> 
> 赞同：4
> 
> 时间：2008-09-24T18:42:45.457
> 
> 标签：visual-studio, visual-studio-2008, plugins, visual-studio-2005

在一个辉煌的世界里，你希望在 VS2005/2008 中有一个插件来做什么？

请每个帖子一个答案，并使用投票来同意/不同意想法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T18:44:30.087

TestDriven.NET 的免费和开源版本

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T00:01:07.160

一个自动关闭我不使用的功能的插件，以便 IDE 占用更少的内存和 CPU。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T18:51:01.257

VSWindowManager 的更新版本：http: [//www.codeplex.com/VSWindowManager](http://www.codeplex.com/VSWindowManager)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T00:09:37.717

类似 SQL 提示的东西。我真的不知道 Management Studio 2008 是否有这样的东西，但这会很棒。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-16T21:32:10.310

支持多个版本控制系统的版本控制。Git、Mercurial、Darks、Subversion 等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T18:51:15.653

1.  可以在 IDE 中按照 Lutz 的 Reflector 进行反汇编。
2.  即席类图（即，不创建 .cd 文件）。
3.  改进的 T-SQL 设计器。
4.  不受支持的语言的简单代码着色，例如十年前的随机千行 .bat，您的经理刚刚说破坏了构建并分配给您立即调试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T00:06:05.650

我在 JetBrains 的 Resharper 中使用过的最有用的插件。

它提供重构支持、改进的智能感知、代码生成、帮助和清理。它还为 NUnit 和后台代码分析提供了一个集成的测试运行程序，以确定语法错误等，而无需重新编译。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T19:07:10.297

不知道这是否可能，但我有时希望能够在评论中使用图像作为图表。在处理进行几何计算（我经常这样做）的代码时，图表可以说的比文字多得多。

也许您可以在评论中输入图像的路径并拥有一个插件来找到此类路径，加载图像并将它们与代码内联显示（或者当您将鼠标悬停时弹出？）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T19:14:49.280

Team System 的代码审查功能（评论部分代码，将其分配给其他人查看等），而实际上不需要 Team System。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-16T21:15:43.640

在 Visual Studio 中嵌入 vim。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-24T18:49:10.353

Visual Studio 2008：一个对经典 ASP VBScript 语法进行颜色编码的插件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-05T10:30:12.040

This will sound basic, but an incremental search plugin like in Opera to quickly navigate my code.
When pressing a hotkey (in Opera it's `Ctrl`+`1`) and then starting to type the word you're looking for marks the words it matches and the screen scrolls to the first word it matches. I hate switching to my mouse just for scrolling to the method I'm looking for. Also, the dropdown for all my methods is not an alternative, I'm looking for speed.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T19:12:19.300

这可能是一个无法回答的问题，但我希望能够以编程方式访问其用于创建类图的绘图代码。最后我看那是不可用的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-16T21:12:07.800

我喜欢一个插件，它可以拼写检查资源文件和大字符串（可能是任何带有空格的东西——应该摆脱真正属于代码一部分的字符串文字）和注释。如果它真的很聪明，它会给我分解驼峰式的东西以找到拼写错误的方法/类的选项。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-30T23:36:28.967

我真的可以使用一个插件来锁定文件进行编辑（有点像 Dreamweaver 的签入/签出功能，但更基本）。我意识到这与源代码控制的概念背道而驰，但有时会有一些微小的杂散应用程序和文件不在源代码控制中，您想对其进行编辑，但没有编辑覆盖的风险。

理论上应该不难构建。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-02-16T21:14:20.727

一个像 Eclipse 的 CVS 处理一样健壮的 CVS 插件会很好。那里有一些插件，但它们都不像 Eclipse 中的那样好用。

# .net - System.Windows.Forms 是否有非静态消息框？

> ID：129019
> 
> 赞同：1
> 
> 时间：2008-09-24T18:43:13.787
> 
> 标签：.net, winforms

我想要一些我可以使用的东西，如下所示

```
var msg = new NonStaticMessageBox();
if(msg.Show("MyMessage", "MyCaption", MessageBoxButtons.OkCancel) == DialogResult.Ok)
 {....} 
```

但特别是非静态的（我需要传递对它的引用）有谁知道这样的对象是否/在哪里存在？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T18:45:03.407

.net 框架中不存在这样的对象。你需要自己动手。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T11:09:14.447

看着评论。封装是你的答案:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T11:12:07.433

为什么需要传递它的引用？你可以只使用 MessageBox.Show 就可以了？如果你真的需要它，你可以制作自己的 MessageBox 类，例如：

```
public class MessageBox
{
    private Form _messageForm = null;

    public void Show(string title,...) {...}
} 
```

或者你可以继承 MessageBox 类并实现你自己的实例成员......但是我认为这没有任何意义......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T11:21:37.240

请记住，归根结底，SWFMessageBox.Show() 方法基本上都是核心 Win32 MessageBox() API 调用的包装器。（通过 Reflector 运行 mscorlib；您将在名为 ShowCore 的私有方法中看到“真实”代码。）

没有规定（据我所知）在 Win32 中缓存被调用的 MessageBox，因此在 .NET 中没有办法这样做。

我确实有自己使用的自定义 MessageBox 类——尽管我这样做不是为了缓存它（在我在 WinForms 中的使用场景中，相同的 MB 很少使用两次），而是为了提供更详细的错误消息和信息——标题、描述、将消息复制到剪贴板的能力（通常是通知用户未处理异常的工具），然后是按钮。

你的旅费可能会改变。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T11:52:52.953

您可能想查看SQL Server 附带的[ExceptionMessageBox类。](http://msdn.microsoft.com/en-us/library/ms166340(SQL.90).aspx)它在一个独立的程序集中，但我不确定您是否可以在没有 SQL Server 的情况下重新分发它 - 您可能需要检查这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T14:08:20.630

你说

> “这显然是对我的问题的简化。”

但是，如果没有有关意图的更多信息，您的问题并未揭示我们可以解决的问题。

鉴于任何形式都可以通过调用 ShowDialog 和返回 DialogResult 的形式以模态方式显示。我在这里没有看到问题。您可以将任何您喜欢的参数传递给它，根据需要定义内容，然后调用：

```
MyFactory.GetMyCustomDialogWithInterfacesOrSomesuch myDialog = new ...
myDialog.ShowDialog() == DialogResult.Ok; 
```

因为您处理的是表单而不是 MessageBox，所以它不是静态的，所以这不是问题。

# c# - .NET 整数与 Int16？

> ID：129023
> 
> 赞同：52
> 
> 时间：2008-09-24T18:44:51.393
> 
> 标签：c#, .net, vb.net, variables, types

我有一个可疑的编码实践。

当我需要遍历计数限制低于的项目的小列表时，我`32000`使用*i*变量类型而不是. 我这样做是因为我认为使用.`Int16`*`Integer``Int16``Integer`*

 *我错了吗？`Int16`使用 an和 an之间没有有效的性能差异`Integer`吗？我应该停止使用`Int16`并坚持`Integer`我所有的计数/迭代需求吗？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-24T20:38:03.307

在按索引循环遍历数组或集合时，您几乎应该**总是**使用`Int32`or （并且，不，使用or`Int64`不会获得信任）。`UInt32``UInt64`

它效率较低的最明显原因是在 BCL 中找到的所有数组和集合索引都使用s，因此在尝试使用s 作为索引的代码中*总是*`Int32`会发生隐式转换。*`Int16`*

 *不太明显的原因（以及数组`Int32`作为索引的原因）是 CIL 规范规定所有操作堆栈值**都是** `Int32`or `Int64`。每次将值加载或存储到任何其他整数类型（`Byte`、`SByte`、`UInt16`、`Int16`、`UInt32`或`UInt64`）时，都会涉及到隐式转换操作。无符号类型对加载没有惩罚，但对于存储值，这相当于截断和可能的溢出检查。对于有符号类型，*每个*加载符号扩展，每个存储符号折叠（并且可能进行溢出检查）。

这对你伤害最大的地方是循环本身，而不是数组访问。例如，采取这个看似无辜的循环：

```
for (short i = 0; i < 32000; i++) {
    ...
} 
```

看起来不错，对吧？没有！您基本上可以忽略初始化 ( `short i = 0`)，因为它只发生一次，但比较 ( `i<32000`) 和递增 ( `i++`) 部分发生了 32000 次。这是机器级别的一些伪代码：

```
 Int16 i = 0;
LOOP:
  Int32 temp0 = Convert_I16_To_I32(i); // !!!
  if (temp0 >= 32000) goto END;
  ...
  Int32 temp1 = Convert_I16_To_I32(i); // !!!
  Int32 temp2 = temp1 + 1;
  i = Convert_I32_To_I16(temp2); // !!!
  goto LOOP;
END: 
```

那里有**3**次转换，运行**32000**次。`Int32`只需使用or就可以完全避免它们`Int64`。

*更新：正如我在评论中所说，我现在实际上已经写了一篇关于这个主题的博客文章，[.NET Integral Data Types And You](http://alexjlyman.blogspot.com/2009/03/net-integral-data-types-and-you.html)*

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-25T03:36:40.383

根据以下参考，*运行时*优化了**Int32**的性能，并推荐它们用于计数器和其他频繁访问的操作。

出自本书：**MCTS 自定进度培训套件（考试 70-536）：Microsoft® .NE​​T Framework 2.0 — 应用程序开发基础**

第 1 章：“框架基础”
第 1 课：“使用值类型”

> 最佳实践：使用内置类型优化性能
> 
> **运行时优化了 32 位整数类型（Int32 和 UInt32）的性能，因此将这些类型用于计数器和其他经常访问的整数变量。**
> 
> 对于浮点运算，Double 是最有效的类型，因为这些运算是由硬件优化的。

此外，同一节中的表 1-1 列出了每种类型的推荐用途。与此讨论相关：

*   Int16 - 互操作和其他专门用途
*   Int32 - 整数和计数器
*   Int64 - 大整数

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-24T18:47:54.727

Int16 实际上可能效率*较低*，因为用于字访问的 x86 指令比用于 dword 访问的指令占用更多空间。这将取决于 JIT 的作用。但无论如何，在迭代中用作变量时几乎肯定不会*更有效。*

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-24T18:46:54.527

反之亦然。

32（或 64）位整数比 int16 更快。通常，本机数据类型是最快的一种。

如果你想让你的数据结构尽可能精简，Int16 就很好。这可以节省空间并可以提高性能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T18:49:50.837

在现代硬件上，任何性能差异都将是如此微小，以至于无论出于何种目的和目的，它都不会产生任何影响。尝试编写几个测试工具并运行它们几百次，取平均循环完成时间，你就会明白我的意思了。

如果您的资源非常有限——嵌入式系统的堆栈很小，专为慢速网络（例如 GPRS 等）设计的有线协议等，从存储的角度来看，这可能是有意义的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T18:47:57.237

永远不要假设效率。

什么是更有效或不是更有效将因编译器和平台而异。除非您实际对此进行了测试，否则无法判断是 int16 还是 int 更有效。

除非您遇到使用 int16 修复的经过验证的性能问题，否则我会坚持使用 int。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T18:51:17.837

在 32 位机器上使用 Int32（或在 64 位机器上使用 Int64）以获得最快的性能。如果您**真的**关心它占用的空间，请使用较小的整数类型（尽管可能会更慢）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T03:37:56.627

这里的其他都是正确的，如果你需要它来满足极端的存储要求，或者为了对业务对象字段进行其他级别*的*强制（你应该当然，在这种情况下仍然有适当的级别验证）。

通常，在出现性能问题之前不要担心效率。在这种情况下，分析它。如果在分析时猜测和检查两种方式对您的帮助不够，请检查 IL 代码。

不过是个好问题。您正在了解更多关于编译器如何完成它的事情。如果您想学习更有效地编程，学习 IL 的基础知识以及 C#/VB 编译器如何工作将是一个好主意。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T18:48:02.760

我无法想象 Int16 与 int 相比有任何显着的性能提升。

您在变量声明中保存了一些位。

当规格发生变化时，绝对不值得麻烦，无论您计算什么现在都*可以*超过 32767，并且您发现当您的应用程序开始抛出异常时......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T18:53:46.130

使用小于 Int32 的数据类型没有显着的性能提升，事实上，我在某处读到，由于内存分配，使用 Int32 会比 Int16 更快

# ruby-on-rails - 规范/集成响应的最佳位置？

> ID：129026
> 
> 赞同：-1
> 
> 时间：2008-09-24T18:45:22.610
> 
> 标签：ruby-on-rails, ruby, rspec

我有一些集成点，我想测试各种响应 - 你认为我应该将这些工件存储在我的 rails 应用程序的 spec/ 目录中的什么位置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T23:37:15.107

在过去，我为其他与测试/规范相关的文件创建了一个 test/resources 或 spec/resources 目录。这似乎清楚地表明它是某种仅用于测试的其他文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T20:43:02.733

你可以只创建一个规范/夹具目录并将它们粘贴在那里。

# java - 寻找 Java GUI 组件/语法高亮的想法

> ID：129034
> 
> 赞同：5
> 
> 时间：2008-09-24T18:46:43.480
> 
> 标签：java, xml, user-interface, syntax-highlighting, xquery

我不致力于任何特定的 GUI takeit 或任何东西 - 只需要基于 Java。我想在可编辑的文本区域内进行简单的语法突出显示（ XML 和 XQuery ）。

到目前为止，我唯一的候选人是 Swing 的 JTextPane，因为它支持似乎支持文本样式，但我不知道如何在这种情况下实现它。

如果一个特定的工具包有这样的开箱即用的东西，那就太棒了，但如果需要的话，我愿意手动做这件事。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T18:52:27.897

JSyntaxPane 处理 XML 并且可以扩展

[http://code.google.com/p/jsyntaxpane/wiki/Using](http://code.google.com/p/jsyntaxpane/wiki/Using)

或者，应该可以提取 NetBeans 编辑器，但这可能需要更多的工作......

[编辑] 顺便说一句，我从[这里](http://saveabend.blogspot.com/2008/06/jsyntaxpane-is-born.html)得到了 XML 信息……谷歌代码页上似乎没有提到它……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:53:46.520

Jide 软件有一个[Syntax Highligher](http://www.jidesoft.com/products/editor.htm)组件。它仍处于测试阶段，但我认为它应该是 XML。我自己没有使用它，所以我不知道它会如何做你想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:53:58.080

为什么不查看 Ostermiller 的语法荧光笔。

这是一个[简单的代码编辑器演示](http://ostermiller.org/syntax/editor.html)

它仍然使用 JTextPane。

# unit-testing - 具有文件系统依赖性的单元测试代码

> ID：129036
> 
> 赞同：150
> 
> 时间：2008-09-24T18:46:56.943
> 
> 标签：unit-testing, dependency-injection, dependencies

我正在编写一个组件，给定一个 ZIP 文件，它需要：

1.  解压缩文件。
2.  在解压缩的文件中查找特定的 dll。
3.  通过反射加载该 dll 并在其上调用方法。

我想对这个组件进行单元测试。

我很想编写直接处理文件系统的代码：

```
void DoIt()
{
   Zip.Unzip(theZipFile, "C:\\foo\\Unzipped");
   System.IO.File myDll = File.Open("C:\\foo\\Unzipped\\SuperSecret.bar");
   myDll.InvokeSomeSpecialMethod();
} 
```

但是人们经常说，“不要编写依赖文件系统、数据库、网络等的单元测试。”

如果我以对单元测试友好的方式编写它，我想它看起来像这样：

```
void DoIt(IZipper zipper, IFileSystem fileSystem, IDllRunner runner)
{
   string path = zipper.Unzip(theZipFile);
   IFakeFile file = fileSystem.Open(path);
   runner.Run(file);
} 
```

耶！现在它可以测试了；我可以将测试替身（模拟）输入 DoIt 方法。但代价是什么？我现在必须定义 3 个新接口才能使其可测试。我到底在测试什么？我正在测试我的 DoIt 函数是否与其依赖项正确交互。它不会测试 zip 文件是否已正确解压缩等。

感觉我不再在测试功能了。感觉就像我只是在测试课堂互动。

**我的问题是**：对依赖于文件系统的东西进行单元测试的正确方法是什么？

*编辑*我正在使用 .NET，但这个概念也可以应用 Java 或本机代码。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-11-02T07:15:03.490

> 耶！现在它可以测试了；我可以将测试替身（模拟）输入 DoIt 方法。但代价是什么？我现在必须定义 3 个新接口才能使其可测试。我到底在测试什么？我正在测试我的 DoIt 函数是否与其依赖项正确交互。它不会测试 zip 文件是否已正确解压缩等。

你已经击中了它的头。你要测试的是你的方法的逻辑，不一定是一个真正的文件是否可以被寻址。您不需要测试（在此单元测试中）文件是否正确解压缩，您的方法认为这是理所当然的。接口本身很有价值，因为它们提供了可以编程的抽象，而不是隐式或显式地依赖于一个具体的实现。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2014-04-17T04:52:55.300

您的问题暴露了刚刚进入它的开发人员测试中最困难的部分之一：

**“我到底要测试什么？”**

您的示例不是很有趣，因为它只是将一些 API 调用粘合在一起，因此如果您要为其编写单元测试，您最终只会断言调用了该方法。像这样的测试将您的实现细节与测试紧密结合在一起。这很糟糕，因为现在每次更改方法的实现细节时都必须更改测试，因为更改实现细节会破坏您的测试！

**进行糟糕的测试实际上比根本没有测试更糟糕。**

在您的示例中：

```
void DoIt(IZipper zipper, IFileSystem fileSystem, IDllRunner runner)
{
   string path = zipper.Unzip(theZipFile);
   IFakeFile file = fileSystem.Open(path);
   runner.Run(file);
} 
```

虽然您可以传入模拟，但测试方法中没有逻辑。如果您要为此尝试进行单元测试，它可能看起来像这样：

```
// Assuming that zipper, fileSystem, and runner are mocks
void testDoIt()
{
  // mock behavior of the mock objects
  when(zipper.Unzip(any(File.class)).thenReturn("some path");
  when(fileSystem.Open("some path")).thenReturn(mock(IFakeFile.class));

  // run the test
  someObject.DoIt(zipper, fileSystem, runner);

  // verify things were called
  verify(zipper).Unzip(any(File.class));
  verify(fileSystem).Open("some path"));
  verify(runner).Run(file);
} 
```

恭喜，您基本上将`DoIt()`方法的实现细节复制粘贴到测试中。快乐维护。

**当您编写测试时，您想测试*WHAT*而不是*HOW*。** 有关更多信息，请参阅[黑盒测试](http://en.wikipedia.org/wiki/Black_box_testing)。

**WHAT**是您的方法的名称（或者至少应该是）。**HOW**是你方法中的所有小实现细节。好的测试可以让你在不破坏**WHAT**的情况下更换**HOW**。

 **这样想，问问自己：

**“如果我更改此方法的实施细节（不更改公共合同）会破坏我的测试吗？”**

如果答案是肯定的，那么您正在测试**HOW**而不是**WHAT**。

为了回答您关于使用文件系统依赖项测试代码的具体问题，假设您对文件进行了一些更有趣的事情，并且您想将 a 的 Base64 编码内容保存`byte[]`到文件中。您可以为此使用流来测试您的代码是否正确，而无需检查它是**如何执行的。**一个例子可能是这样的（在 Java 中）：

```
interface StreamFactory {
    OutputStream outStream();
    InputStream inStream();
}

class Base64FileWriter {
    public void write(byte[] contents, StreamFactory streamFactory) {
        OutputStream outputStream = streamFactory.outStream();
        outputStream.write(Base64.encodeBase64(contents));
    }
}

@Test
public void save_shouldBase64EncodeContents() {
    OutputStream outputStream = new ByteArrayOutputStream();
    StreamFactory streamFactory = mock(StreamFactory.class);
    when(streamFactory.outStream()).thenReturn(outputStream);

    // Run the method under test
    Base64FileWriter fileWriter = new Base64FileWriter();
    fileWriter.write("Man".getBytes(), streamFactory);

    // Assert we saved the base64 encoded contents
    assertThat(outputStream.toString()).isEqualTo("TWFu");
} 
```

测试使用 a但在应用程序中（使用依赖注入），真正的`ByteArrayOutputStream`StreamFactory（可能称为 FileStreamFactory）`FileOutputStream`将从.`outputStream()``File`

这里方法的有趣之`write`处在于它以 Base64 编码的形式写入内容，这就是我们测试的内容。对于您的`DoIt()`方法，这将更适合使用[集成测试进行测试](http://en.wikipedia.org/wiki/Integration_testing)。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2008-09-24T19:09:31.710

这真的没有什么问题，只是你称它为单元测试还是集成测试的问题。你只需要确保如果你确实与文件系统交互，没有意外的副作用。具体来说，请确保您自行清理——删除您创建的任何临时文件——并且您不会意外覆盖与您正在使用的临时文件具有相同文件名的现有文件。始终使用相对路径而不是绝对路径。

`chdir()`在运行测试之前进入一个临时目录也是一个好主意，然后再`chdir()`返回。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-24T18:51:59.833

我不愿用仅用于促进单元测试的类型和概念来污染我的代码。当然，如果它使设计更简洁更好，那就更好了，但我认为通常情况并非如此。

我对此的看法是，您的单元测试会尽其所能，但可能不是 100% 的覆盖率。事实上，它可能只有 10%。关键是，你的单元测试应该很快并且没有外部依赖。他们可能会测试诸如“当您为此参数传入 null 时，此方法会引发 ArgumentNullException”之类的案例。

然后，我将添加可以具有外部依赖关系的集成测试（也是自动化的，并且可能使用相同的单元测试框架）并测试诸如此类的端到端场景。

在测量代码覆盖率时，我会同时测量单元测试和集成测试。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-24T18:57:31.693

打文件系统没有错，只需将其视为集成测试而不是单元测试。我会用相对路径交换硬编码路径，并创建一个 TestData 子文件夹来包含单元测试的 zip。

如果您的集成测试运行时间过长，请将它们分开，这样它们就不会像您的快速单元测试那样频繁地运行。

我同意，有时我认为基于交互的测试会导致过多的耦合，并且通常最终无法提供足够的价值。您真的想在这里测试解压缩文件，而不仅仅是验证您正在调用正确的方法。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-24T18:49:49.010

一种方法是编写 unzip 方法来获取 InputStreams。然后单元测试可以使用 ByteArrayInputStream 从字节数组构造这样的 InputStream。该字节数组的内容可以是单元测试代码中的常量。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T19:00:37.317

这似乎更像是一种集成测试，因为您依赖于理论上可能会改变的特定细节（文件系统）。

我会将处理操作系统的代码抽象为它自己的模块（类、程序集、jar 等等）。在您的情况下，您希望加载特定的 DLL（如果找到），因此创建一个 IDllLoader 接口和 DllLoader 类。让您的应用程序使用该接口从 DllLoader 获取 DLL 并进行测试……毕竟您不负责解压缩代码吗？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-24T18:50:32.927

假设“文件系统交互”在框架本身中得到了很好的测试，创建你的方法来处理流，并测试它。打开 FileStream 并将其传递给方法可以忽略不计，因为 FileStream.Open 已由框架创建者进行了很好的测试。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T18:52:05.573

您不应该测试类交互和函数调用。相反，您应该考虑集成测试。测试所需的结果，而不是文件加载操作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-16T13:52:56.387

正如其他人所说，第一个作为集成测试很好。第二个只测试函数应该实际做的事情，这是单元测试应该做的所有事情。

如图所示，第二个示例看起来有点毫无意义，但它确实让您有机会测试函数如何响应任何步骤中的错误。您在示例中没有任何错误检查，但在您可能拥有的真实系统中，依赖注入将让您测试对任何错误的所有响应。那么成本将是值得的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-16T14:00:49.523

对于单元测试，我建议您在项目中包含测试文件（EAR 文件或等效文件），然后在单元测试中使用相对路径，即“../testdata/testfile”。

只要您的项目正确导出/导入，您的单元测试就应该可以工作。

# bash - 我可以在变量中指定重定向和管道吗？

> ID：129043
> 
> 赞同：4
> 
> 时间：2008-09-24T18:47:47.050
> 
> 标签：bash

我有一个 bash 脚本，它为当前目录创建一个 Subversion 补丁文件。`-z`如果作为脚本的参数给出，我想修改它以压缩生成的文件。

这是相关部分：

```
zipped=''
zipcommand='>'

if [ "$1" = "-z" ]
then
   zipped='zipped '
   filename="${filename}.zip"
   zipcommand='| zip >'
fi

echo "Creating ${zipped}patch file $filename..."

svn diff $zipcommand $filename 
```

这不起作用，因为它将or`|`作为参数传递给.`>``$zipcommand``svn`

我可以轻松解决这个问题，但问题是当它们包含在变量中时是否可以使用这些类型的运算符。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T18:59:16.960

我会做这样的事情（使用 bash -c 或 eval）：

```
zipped=''
zipcommand='>'

if [ "$1" = "-z" ]
then
   zipped='zipped '
   filename="${filename}.zip"
   zipcommand='| zip -@'
fi

echo "Creating ${zipped}patch file $filename..."

eval "svn diff $zipcommand $filename"
# this also works: 
# bash -c "svn diff $zipcommand $filename" 
```

这似乎可行，但我的 zip 版本（Mac OS X）要求我更改行：

```
zipcommand='| zip -@' 
```

到

```
zipcommand='| zip - - >' 
```

编辑：合并@DanielBungert 使用 eval 的建议

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T19:01:13.743

eval 是您正在寻找的。

```
# eval 'printf "foo\nbar" | grep bar'
bar 
```

小心使用引号字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T09:09:47.790

或者您应该尝试`zsh`允许定义全局别名的 shell，例如：

```
alias -g L='| less'
alias -g S='| sort'
alias -g U='| uniq -c' 
```

然后使用这个命令（对于那些从后面看的人来说有点神秘;-)）

```
./somecommand.sh S U L 
```

高温高压

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-30T03:28:54.117

在处理压缩的进程替换或命名文件上打开一个新的文件句柄。然后将输出重定向`svn diff`到该文件句柄。

```
if [ "$1" = "-z" ]; then
    zipped='zipped '
    filename=$filename.zip
    exec 3> >(zip > "$filename")
else
    exec 3> "$filename"
fi

echo "Creating ${zipped}patch file $filename"
svn diff >&3 
```

# sql - 禁用并稍后启用 Oracle 中的所有表索引

> ID：129046
> 
> 赞同：20
> 
> 时间：2008-09-24T18:48:01.777
> 
> 标签：sql, oracle, sql-loader

我将如何禁用并稍后启用 Oracle 中给定模式/数据库中的所有索引？

注意：这是为了让 sqlldr 运行得更快。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-08-19T20:40:36.493

如果没有文件，这会使索引无法使用：

```
DECLARE
  CURSOR  usr_idxs IS select * from user_indexes;
  cur_idx  usr_idxs% ROWTYPE;
  v_sql  VARCHAR2(1024);

BEGIN
  OPEN usr_idxs;
  LOOP
    FETCH usr_idxs INTO cur_idx;
    EXIT WHEN NOT usr_idxs%FOUND;

    v_sql:= 'ALTER INDEX ' || cur_idx.index_name || ' UNUSABLE';
    EXECUTE IMMEDIATE v_sql;
  END LOOP;
  CLOSE usr_idxs;
END; 
```

重建将是相似的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-25T22:32:05.537

将 3 个答案组合在一起：（因为 select 语句不执行 DDL）

```
set pagesize 0

alter session set skip_unusable_indexes = true;
spool c:\temp\disable_indexes.sql
select 'alter index ' || u.index_name || ' unusable;' from user_indexes u;
spool off
@c:\temp\disable_indexes.sql 
```

做进口...

```
select 'alter index ' || u.index_name || 
' rebuild online;' from user_indexes u; 
```

请注意，这假定导入将在同一个 (sqlplus) 会话中发生。
如果您调用“imp”，它将在单独的会话中运行，因此您需要使用“ALTER SYSTEM”而不是“ALTER SESSION”（并记住将参数放回您找到它的方式。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T19:03:44.750

从这里： http: [//forums.oracle.com/forums/thread.jspa?messageID=2354075](http://forums.oracle.com/forums/thread.jspa?messageID=2354075)

`alter session set skip_unusable_indexes = true;`

`alter index your_index unusable;`

做进口...

`alter index your_index rebuild [online];`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T19:13:06.320

您可以在 Oracle 中禁用约束，但不能禁用索引。有一个命令可以使索引不可用，但无论如何您都必须重建索引，所以我可能只是编写一个脚本来删除和重建索引。您可以使用 user_indexes 和 user_ind_columns 来获取模式的所有索引或使用 dbms_metadata：

```
select dbms_metadata.get_ddl('INDEX', u.index_name) from user_indexes u; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T20:47:32.333

如果您使用的是非并行直接路径加载，则考虑并基准测试根本不删除索引，特别是如果索引仅覆盖少数列。Oracle 有一种机制可以有效维护直接路径负载上的索引。

否则，我还建议使索引不可用而不是删除它们。意外不重新创建索引的可能性较小。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-31T14:54:12.287

如果您使用的是 Oracle 11g，您可能还想查看[dbms_index_utl](http://www.psoug.org/reference/dbms_index_utl.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T19:27:13.273

结合两个答案：

首先创建sql，使所有索引不可用：

```
alter session set skip_unusable_indexes = true;
select 'alter index ' || u.index_name || ' unusable;' from user_indexes u; 
```

做进口...

```
select 'alter index ' || u.index_name || ' rebuild online;' from user_indexes u; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-16T15:12:04.893

您应该尝试 sqlldr 的 SKIP_INDEX_MAINTENANCE 参数。

# c# - 从 compact .net 1.0 中查找处理器类型

> ID：129052
> 
> 赞同：0
> 
> 时间：2008-09-24T18:48:42.260
> 
> 标签：c#, windows-mobile, compact-framework

我的应用程序针对 Compact .Net 1.0 框架。应用程序必须检查并下载网站上可用的任何更新。我正在考虑以 CAB 文件的形式提供更新。由于 CAB 文件是特定于处理器类型的，因此我想根据处理器类型下载 CAB 文件。获取处理器类型（ARM/SH/MIPS/等）的 API 是什么？

谢谢，
Kishore A

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T20:18:10.110

托管库中没有直接可用的东西。您需要使用[P/Invoke](http://en.wikipedia.org/wiki/P/invoke)调用本机`Coredll.dll`并使用名为[GetSystemInfo](http://msdn.microsoft.com/en-us/library/ms960847.aspx)的方法。

**pinvoke.net**是使用 P/Invokes 进行移动和桌面开发的绝佳资源。与您相关的条目是： [http ://www.pinvoke.net/default.aspx/coredll.GetSystemInfo](http://www.pinvoke.net/default.aspx/coredll.GetSystemInfo)

调用此方法将返回一个[SYSTEM_INFO](http://msdn.microsoft.com/en-us/library/ms942639.aspx)结构，其中包含有关处理器架构的信息。

如果这条路线看起来工作量太大，您可以随时查看来自 OpenNETCF 的名为 Smart Device Framework 的商业包：http: [//opennetcf.com/Products/SmartDeviceFramework/tabid/65/Default.aspx](http://opennetcf.com/Products/SmartDeviceFramework/tabid/65/Default.aspx)

在 SDF 中，您会感兴趣`OpenNETCF.WindowsCE.DeviceManagement.SystemInformation`——它将返回与 P/Invoke 相同的基本信息，但在一个很好的托管包装器中。

# google-api - Google 的 javascript API 如何绕过 AJAX 中的跨域安全性

> ID：129053
> 
> 赞同：12
> 
> 时间：2008-09-24T18:48:49.123
> 
> 标签：google-api, google-api-js-client, google-ajax-api

当 Google 的 API 在您的网站上时，它如何向 Google 发出跨域请求？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T18:54:22.790

他们通过将脚本标签动态注入文档头部来绕过它。通过此注入向下发送的 javascript 中有一个回调函数，它告诉页面中运行的脚本它已加载和有效负载（数据）。

然后脚本可以删除动态注入的脚本标签并继续。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-02T02:27:34.003

接受的答案是错误的。本是正确的。[下面是使用Google API JavaScript Client](https://code.google.com/p/google-api-javascript-client/)拉出页面的实际 iframe 节点。

```
<iframe name="oauth2relay678" id="oauth2relay678" 
        src="https://accounts.google.com/o/oauth2/postmessageRelay?
             parent=https%3A%2F%2Fwww.example.com.au#rpctoken=12345&amp;forcesecure=1" 
             style="width: 1px; height: 1px; position: absolute; left: -100px;">
</iframe> 
```

它是如何工作的基本总结在这里：[http](http://ternarylabs.com/2011/03/27/secure-cross-domain-iframe-communication/) ://ternarylabs.com/2011/03/27/secure-cross-domain-iframe-communication/ 。在现代浏览器上，他们使用 HTML postMessage 来实现通信，而在旧浏览器上，他们使用简洁的多 iframe-urlhash-read+write-combination hack。Ternary Labs 制作了一个[库](https://github.com/ternarylabs/porthole/)，可以将所有 hacky 的东西抽象出来，基本上可以在所有浏览器上为您提供 postMessage。

有一天，我会在这个库的基础上构建来简化跨域 REST API...

编辑：那一天已经到来，XDomain 就在这里 - [https://github.com/jpillora/xdomain](https://github.com/jpillora/xdomain)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T18:51:33.873

AFAIK 他们使用 IFRAME。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-19T17:47:54.587

看起来谷歌使用 <img> 标签显示地图我猜他们使用 JavaScrit 库来计算 src url 需要的所有坐标和其他参数，然后将 <img> 标签（以及一百万个其他标签）插入到你的 DOM。

完整的地图由几个窗格组成，如下面的 HTML：

<img src="https://mts1.google.com/vt/lyrs=m@248102691&hl=en&src=app&x=32741&s=&y=21991&z=16&scale=1.100000023841858&s=Galile" class="css-3d-layer" 风格="位置：绝对；左侧：573 像素；顶部：266 像素；宽度：128 像素；高度：128 像素；边框：0 像素；填充：0 像素；边距：0 像素；">

（您可以将此 HTML 粘贴到您自己的网页中以查看结果）

所以谷歌地图不使用 AJAX 或任何东西来获取它的地图，只是简单的图像，即时创建。因此，无需担心跨域问题...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T03:22:43.693

另一种可能性是使用[这里](http://www.sitepen.com/blog/2008/07/22/windowname-transport/)`window.name`为 dojo 框架描述的传输

# .net - .Net 2.0 的可靠 HTTP 库

> ID：129071
> 
> 赞同：5
> 
> 时间：2008-09-24T18:51:12.470
> 
> 标签：.net, http, timeout

.Net 的 HTTP 实现是……有问题的。除了符合 HTTP/1.0 的一些问题之外，现在困扰我的是`HttpWebResponse.GetResponse()`ReadTimeout**和**Timeout 设置为 5000 块大约 20 秒后失败（问题是它应该在 5 秒后失败，但实际上需要 20 秒）。

我需要一个具有更好协议一致性和超时控制的库。知道吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T11:49:14.927

根据[Microsoft](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/8e554674-8e4e-4e29-bb77-b9c2b287ed50)的说法，可能会挂起的可能是 DNS 解析，这可能需要长达 15 秒。

解决方案 - 自己进行 DNS 解析 (Dns.BeginGetHostByName)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T19:00:12.730

[Chilkat](http://www.chilkatsoft.com/HttpDotNet.asp)有一个 HTTP 组件。我从未使用过它，但我对它们的其他一些组件印象深刻。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:27:33.393

请参阅 HttpWebRequest.BeginGetResponse() 方法。不完全是您所要求的，您已经有几天没有收到任何其他回复了，值得一提。

# java - 是否可以将 Rails 应用程序编译为 Java VM JAR 文件？

> ID：129072
> 
> 赞同：12
> 
> 时间：2008-09-24T18:51:12.893
> 
> 标签：java, ruby-on-rails, ruby, jruby

本质上，我唯一可以部署到我的部署机器的是一个 JAR 文件。我无法安装 JRuby，也无法安装 Glassfish 或 Tomcat。

是否可以将 Rails 应用程序（包括 Rails，当然是供应商的）打包到 JAR 文件中，这样我就可以做到

```
c:\my_server> java rails_app.jar 
```

并让它在 JVM 中运行 WEBRick 或 Mongrel？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T19:25:58.503

一年前我写了一篇关于如何将你的 ruby​​ 源代码与 jruby 以及你想要的所有其他内容嵌入到一个 jar 文件中的文章，然后使用“java -jar myapp.jar”运行它。

我猜它需要一些工作才能使其启动轨道，但它不应该太难。借助他们 wiki 上的免费 jruby 文档，我想您可以使用这种技术相当轻松地运行 jetty+war。

文章在这里： [http ://blog.kesor.net/2007/08/14/jruby-in-a-jar/](http://blog.kesor.net/2007/08/14/jruby-in-a-jar/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T18:56:10.400

我建议您检查 Jetty。[Embedding Jetty](http://docs.codehaus.org/display/JETTY/Embedding+Jetty)的过程非常简单，应该可以从当前的 jar 文件中为其提供 servlet。不过，我没有使用过 Ruby/Rails，所以我不确定那里是否有任何并发​​症。

通常是否可以将所有 rails 模板/模型嵌入到 war 文件中的 jar 中以在 Tomcat 上部署？如果是这样，那么您应该能够让嵌入式 Jetty 从您的单个 jar 中拉出它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T02:32:07.043

它可能有点过时，但 JRuby 的贡献者之一 Nick Sieger不久前[写过有关莺的文章。](http://blog.nicksieger.com/articles/2007/09/04/warbler-a-little-birdie-to-introduce-your-rails-app-to-java)

[Warbler](http://caldersphere.rubyforge.org/warbler/)是将 Rails 应用程序打包到 .war 文件中。现在我不是 Java 大佬，所以我不确定你的 .jar 限制来自哪里。war 文件类似于 jars，但它们适用于整个网站或其他东西。

最坏的情况，我很确定[JRuby wiki](http://wiki.jruby.org/wiki/Main_Page)有一些关于打包 Rails 应用程序以在 Java 架构上运行的状态。了解这方面的信息符合他们的最大利益。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T19:10:53.500

我不认为你可以在 JVM 中运行 Mongrel。尝试在没有 Tomcat 或 Jetty 的情况下运行任何类型的网络服务器可能比它的价值要麻烦得多。[jsight](https://stackoverflow.com/questions/129072/is-it-possible-to-compile-a-rails-app-to-a-java-vm-jar-file#129109)的答案看起来对这个问题很有帮助。如果你能做到这一点，这里是 JRuby 网站上关于[在 Tomcat 中运行 JRuby on Rails](http://wiki.jruby.org/wiki/Jruby_on_Rails_on_Tomcat)的页面。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T20:14:17.077

您可能想尝试在 JRuby 邮件列表/论坛（[http://xircles.codehaus.org/lists/user@jruby.codehaus.org](http://xircles.codehaus.org/lists/user@jruby.codehaus.org)）上提出这个问题。

另一个有人会做同样事情的地方是 glassfish 邮件列表

你可能想做的另一件事是捆绑winstone可嵌入servlet容器和jruby和rails，并使用jarjar创建一个大jar。您也许可以构建一个 ant 构建文件来构建这样一个 BIG jar，其中还包含您的 rails 应用程序。使用这种方法的一个项目是 hudson ( [https://hudson.dev.java.net/](https://hudson.dev.java.net/) )——你可能会得到一些关于如何去做的信息。

BR，
~A

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-07T02:29:56.573

我今天刚看到这个博客，我打算试一试，如果有其他人告诉我

[http://matthewkwilliams.com/index.php/2010/03/02/rails-jruby-in-a-jar/](http://matthewkwilliams.com/index.php/2010/03/02/rails-jruby-in-a-jar/)

# visual-studio - 实施“产品开发工作流程（过程）”的最佳模式/解决方案是什么？

> ID：129073
> 
> 赞同：1
> 
> 时间：2008-09-24T18:51:15.560
> 
> 标签：visual-studio, vsx, extensibility, devtools

展示：

目前，产品开发是在 Visual Studio 中使用 .Net 技术完成的，因此使用同一组工具很重要。除了开发人员之外，其他角色正在使用电子表格、文档和图表工具、photoshop 来完成他们的工作。

未来：

我们希望为产品开发构建工作流（具有角色的顺序流程、操作项队列、将信息从一个角色传递到另一个角色、批准等）。软件产品将永远处于增强阶段，更有理由建立这个流程。

典型的用户是设计人员、业务分析师、内容创建者、开发人员、代码审查人员、测试人员。

假设需要开发一个新网页。这将是，

1.  由分析人员在工具中考虑，将以某种格式输入信息
2.  设计师将使用拖放来构建页面外观，将其传递给
3.  内容创建者，将内容（帮助文本、超链接、纯文本等）添加到页面
4.  开发人员将检查他的队列以开始围绕此页面构建逻辑并使其正常运行。

我正在考虑将 Visual Studio 隔离 shell 用作工具框架，主要是因为它的 IDE 功能等来构建它。有没有人处理过类似的要求？关于如何在 VS Shell 范式中解决这个问题的任何模式/解决方案/想法？

更新：开发人员和测试人员已经在使用 Visual Studio Team System，但 TFS 中没有为他们（以及分析师、设计师等）定制的工作流程。此外，Visual Studio 不适合想要做以下事情的非开发用户 - 定义导航流程、设计页面元素等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:53:03.480

听起来与[Microsoft Visual Studio Team System](http://msdn.microsoft.com/en-us/vsts2008/default.aspx)完全一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-20T17:48:00.120

我认为这个产品有市场，因为我找不到任何接近的东西。有不同的工具和产品，但没有统一的 IDE 体验可用，需要我们自己构建。

VS 隔离外壳 2010 是可以构建它的起点和平台。需要几个月甚至几年。然而， [**TFS ALM 应用程序生命周期管理**](http://www.microsoft.com/ApplicationPlatform/en/us/default.aspx)与这个想法有几个功能重叠，虽然不是全部，因为它没有根据您的自定义工作流提供自定义体验。

陪审团出局了，需要弄清楚。

# sql - NOT IN 子句中的 NULL 值

> ID：129077
> 
> 赞同：278
> 
> 时间：2008-09-24T18:51:32.237
> 
> 标签：sql, sql-server, tsql, null, notin

当我为我认为相同的查询一个使用`not in` `where`约束而另一个使用`left join`. 约束中的表`not in`有一个空值（错误数据），导致该查询返回 0 条记录。我有点理解为什么，但我可以使用一些帮助来完全掌握这个概念。

简单地说，为什么查询 A 返回结果而 B 没有？

```
A: select 'true' where 3 in (1, 2, 3, null)
B: select 'true' where 3 not in (1, 2, null) 
```

这是在 SQL Server 2005 上。我还发现调用`set ansi_nulls off`会导致 B 返回结果。

* * *

## 回答 #1

> 赞同：307
> 
> 时间：2008-09-24T19:01:50.323

查询 A 与以下内容相同：

```
select 'true' where 3 = 1 or 3 = 2 or 3 = 3 or 3 = null 
```

既然`3 = 3`是真的，你就会得到一个结果。

查询 B 与以下内容相同：

```
select 'true' where 3 <> 1 and 3 <> 2 and 3 <> null 
```

何时`ansi_nulls`打开，`3 <> null`为 UNKNOWN，因此谓词计算结果为 UNKNOWN，并且您不会得到任何行。

何时`ansi_nulls`关闭，`3 <> null`则为真，因此谓词评估为真，并且您得到一行。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-09-25T09:54:41.723

每当您使用 NULL 时，您实际上是在处理三值逻辑。

您的第一个查询返回结果，因为 WHERE 子句的计算结果为：

```
 3 = 1 or 3 = 2 or 3 = 3 or 3 = null
which is:
    FALSE or FALSE or TRUE or UNKNOWN
which evaluates to 
    TRUE 
```

第二个：

```
 3 <> 1 and 3 <> 2 and 3 <> null
which evaluates to:
    TRUE and TRUE and UNKNOWN
which evaluates to:
    UNKNOWN 
```

UNKNOWN 与 FALSE 不同，您可以通过调用以下方法轻松测试它：

```
select 'true' where 3 <> null
select 'true' where not (3 <> null) 
```

这两个查询都不会给你任何结果

如果 UNKNOWN 与 FALSE 相同，则假设第一个查询会给您 FALSE，第二个查询必须评估为 TRUE，因为它与 NOT(FALSE) 相同。
事实并非如此。

[在 SqlServerCentral 上有一篇关于这个主题](http://www.sqlservercentral.com/articles/Advanced+Querying/fourrulesfornulls/1915/)的非常好的文章。

NULL 和三值逻辑的整个问题起初可能有点令人困惑，但为了在 TSQL 中编写正确的查询，理解这一点很重要

我推荐的另一篇文章是[SQL Aggregate Functions 和 NULL](http://www.sqlservercentral.com/articles/Advanced+Querying/gotchasqlaggregatefunctionsandnull/1947/)。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-09-24T19:01:34.177

## `NOT IN`与未知值比较时返回 0 条记录

由于`NULL`是未知数，因此在可能值列表中`NOT IN`包含 a`NULL`或`NULL`s 的查询将始终返回`0`记录，因为无法确定该`NULL`值不是正在测试的值。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-24T18:53:18.503

与 null 比较是未定义的，除非您使用 IS NULL。

因此，当比较 3 和 NULL（查询 A）时，它返回 undefined。

即 SELECT 'true' where 3 in (1,2,null) 和 SELECT 'true' where 3 not in (1,2,null)

将产生相同的结果，因为 NOT (UNDEFINED) 仍然未定义，但不是 TRUE

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-09-23T08:39:28.697

在撰写本文时，这个问题的标题是

> SQL NOT IN 约束和 NULL 值

从问题的文本看来，问题出现在 SQL DML`SELECT`查询中，而不是 SQL DDL`CONSTRAINT`中。

但是，特别是考虑到标题的措辞，我想指出，这里的某些陈述可能具有误导性，类似于（释义）

> 当谓词评估为 UNKNOWN 时，您不会得到任何行。

尽管 SQL DML 就是这种情况，但在考虑约束时，效果是不同的。

考虑这个非常简单的表，其中两个约束直接取自问题中的谓词（并在@Brannon 的出色回答中得到解决）：

```
DECLARE @T TABLE 
(
 true CHAR(4) DEFAULT 'true' NOT NULL, 
 CHECK ( 3 IN (1, 2, 3, NULL )), 
 CHECK ( 3 NOT IN (1, 2, NULL ))
);

INSERT INTO @T VALUES ('true');

SELECT COUNT(*) AS tally FROM @T; 
```

根据@Brannon 的回答，第一个约束（使用`IN`）评估为 TRUE，第二个约束（使用`NOT IN`）评估为 UNKNOWN。**但是**，插入成功！因此，在这种情况下，说“你没有得到任何行”是不完全正确的，因为我们确实插入了一行。

就 SQL-92 标准而言，上述效果确实是正确的。比较和对比 SQL-92 规范中的以下部分

> **7.6 where子句**
> 
> 的结果是 T 中搜索条件结果为真的那些行的表。
> 
> **4.10 完整性约束**
> 
> 当且仅当指定的搜索条件对于表的任何行都不为假时，才满足表检查约束。

换句话说：

`WHERE`在 SQL DML 中，当计算结果为 UNKNOWN时，会从结果中删除行，因为它**不满足**条件“为真”。

在 SQL DDL（即约束）中，当行评估为 UNKNOWN 时，不会从结果中删除行，因为它 **确实**满足条件“不为假”。

尽管 SQL DML 和 SQL DDL 中的效果可能看起来相互矛盾，但有实际理由通过允许它们满足约束来赋予 UNKNOWN 结果“怀疑的好处”（更准确地说，允许它们不会不满足约束） ：如果没有这种行为，每个约束都必须明确处理空值，从语言设计的角度来看，这将是非常不令人满意的（更不用说，对编码人员来说是一种痛苦！）

ps 如果您发现遵循“未知不会不满足约束”之类的逻辑就像我要编写它一样具有挑战性，那么考虑您可以通过避免 SQL DDL 中的可空列和 SQL 中的任何内容来简单地免除所有这些产生空值的 DML（例如外连接）！

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-24T18:58:15.730

在 A 中，针对集合中的每个成员测试 3 是否相等，产生 (FALSE、FALSE、TRUE、UNKNOWN)。由于元素之一为 TRUE，因此条件为 TRUE。（也有可能这里发生了一些短路，所以它实际上在达到第一个 TRUE 时就停止了，并且从不计算 3=NULL。）

在 B 中，我认为它正在将条件评估为 NOT（3 in (1,2,null)）。测试 3 对集合的相等性产生 (FALSE, FALSE, UNKNOWN)，它被聚合到 UNKNOWN。NOT (UNKNOWN) 产生 UNKNOWN。所以总的来说，条件的真相是未知的，最后基本上被视为 FALSE。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-09-27T15:00:47.613

可以从这里的答案中得出结论，这些答案`NOT IN (subquery)`没有正确处理空值，应该避免使用`NOT EXISTS`. 然而，这样的结论可能为时过早。在以下场景中，归功于 Chris Date（数据库编程和设计，第 2 卷第 9 期，1989 年 9 月），它`NOT IN`正确处理空值并返回正确结果，而不是`NOT EXISTS`.

考虑一个表格`sp`来表示供应商 ( `sno`)，这些供应商 ( ) 已知供应`pno`数量 ( ) 的零件 ( `qty`)。该表当前包含以下值：

```
 VALUES ('S1', 'P1', NULL), 
             ('S2', 'P1', 200),
             ('S3', 'P1', 1000) 
```

请注意，数量是可以为空的，即能够记录供应商已知供应零件的事实，即使它不知道数量是多少。

任务是找到已知供应零件编号为“P1”但数量不是 1000 的供应商。

以下`NOT IN`仅用于正确识别供应商“S2”：

```
WITH sp AS 
     ( SELECT * 
         FROM ( VALUES ( 'S1', 'P1', NULL ), 
                       ( 'S2', 'P1', 200 ),
                       ( 'S3', 'P1', 1000 ) )
              AS T ( sno, pno, qty )
     )
SELECT DISTINCT spx.sno
  FROM sp spx
 WHERE spx.pno = 'P1'
       AND 1000 NOT IN (
                        SELECT spy.qty
                          FROM sp spy
                         WHERE spy.sno = spx.sno
                               AND spy.pno = 'P1'
                       ); 
```

但是，以下查询使用相同的一般结构，`NOT EXISTS`但在结果中包含但错误地包含供应商“S1”（即数量为空）：

```
WITH sp AS 
     ( SELECT * 
         FROM ( VALUES ( 'S1', 'P1', NULL ), 
                       ( 'S2', 'P1', 200 ),
                       ( 'S3', 'P1', 1000 ) )
              AS T ( sno, pno, qty )
     )
SELECT DISTINCT spx.sno
  FROM sp spx
 WHERE spx.pno = 'P1'
       AND NOT EXISTS (
                       SELECT *
                         FROM sp spy
                        WHERE spy.sno = spx.sno
                              AND spy.pno = 'P1'
                              AND spy.qty = 1000
                      ); 
```

所以`NOT EXISTS`不是它可能出现的银弹！

当然，问题的根源是空值的存在，因此“真正的”解决方案是消除这些空值。

这可以使用两个表来实现（以及其他可能的设计）：

*   `sp`已知供应零件的供应商
*   `spq`已知供应已知数量的零件的供应商

注意应该有一个外键约束，其中`spq`references `sp`。

然后可以使用“减号”关系运算符（作为`EXCEPT`标准 SQL 中的关键字）获得结果，例如

```
WITH sp AS 
     ( SELECT * 
         FROM ( VALUES ( 'S1', 'P1' ), 
                       ( 'S2', 'P1' ),
                       ( 'S3', 'P1' ) )
              AS T ( sno, pno )
     ),
     spq AS 
     ( SELECT * 
         FROM ( VALUES ( 'S2', 'P1', 200 ),
                       ( 'S3', 'P1', 1000 ) )
              AS T ( sno, pno, qty )
     )
SELECT sno
  FROM spq
 WHERE pno = 'P1'
EXCEPT 
SELECT sno
  FROM spq
 WHERE pno = 'P1'
       AND qty = 1000; 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-24T19:08:44.380

Null 表示没有数据，即它是未知的，不是什么都没有的数据值。具有编程背景的人很容易混淆这一点，因为在 C 类型语言中，使用指针时 null 确实什么都不是。

因此，在第一种情况下，3 确实在 (1,2,3,null) 的集合中，因此返回 true

但是，在第二个中，您可以将其减少到

*选择“真”，其中 3 不在（空）*

所以什么都没有返回，因为解析器对你正在比较它的集合一无所知——它不是一个空集合，而是一个未知集合。使用 (1, 2, null) 并没有帮助，因为 (1,2) 集显然是错误的，但随后您将与未知数相矛盾，这是未知数。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-10-31T22:06:22.550

如果您想使用 NOT IN 过滤包含 NULL 的子查询，只需检查 not null

```
SELECT blah FROM t WHERE blah NOT IN
        (SELECT someotherBlah FROM t2 WHERE someotherBlah IS NOT NULL ) 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-11-28T08:44:08.423

SQL 对真值使用三值逻辑。`IN`查询产生预期的结果：

```
SELECT * FROM (VALUES (1), (2)) AS tbl(col) WHERE col IN (NULL, 1)
-- returns first row 
```

***但添加 a`NOT`不会反转结果：***

```
SELECT * FROM (VALUES (1), (2)) AS tbl(col) WHERE NOT col IN (NULL, 1)
-- returns zero rows 
```

这是因为上述查询等价于以下内容：

```
SELECT * FROM (VALUES (1), (2)) AS tbl(col) WHERE NOT (col = NULL OR col = 1) 
```

以下是评估 where 子句的方式：

```
| col | col = NULL⁽¹⁾  | col = 1 | col = NULL OR col = 1 | NOT (col = NULL OR col = 1) |
|-----|----------------|---------|-----------------------|-----------------------------|
| 1   | UNKNOWN        | TRUE    | TRUE                  | FALSE                       |
| 2   | UNKNOWN        | FALSE   | UNKNOWN⁽²⁾            | UNKNOWN⁽³⁾                  | 
```

请注意：

1.  涉及`NULL`收益率的比较`UNKNOWN`
2.  没有任何操作数且至少有一个操作数为yield ( [ref](https://en.wikipedia.org/wiki/Null_(SQL)#Comparisons_with_NULL_and_the_three-valued_logic_(3VL)) )的`OR`表达式`TRUE``UNKNOWN``UNKNOWN`
3.  收益`NOT`率( [ref](https://en.wikipedia.org/wiki/Null_(SQL)#Comparisons_with_NULL_and_the_three-valued_logic_(3VL)) ) _`UNKNOWN``UNKNOWN`

您可以将上面的示例扩展到两个以上的值（例如 NULL、1 和 2），但结果将是相同的：如果其中一个值是，`NULL`则没有行将匹配。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-23T10:02:13.837

这是给男孩的：

```
select party_code 
from abc as a
where party_code not in (select party_code 
                         from xyz 
                         where party_code = a.party_code); 
```

无论 ansi 设置如何，这都有效

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T22:47:33.403

这也可能有助于了解加入、存在和 [http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx之间的逻辑差异](http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx)

# sql-server - Sql Server 2000 - 如何找出当前正在运行的存储过程？

> ID：129086
> 
> 赞同：6
> 
> 时间：2008-09-24T18:52:46.570
> 
> 标签：sql-server

我想知道当前正在运行哪些存储过程来诊断一些性能问题。我怎样才能知道呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T21:41:32.203

用于分析锁和死锁的非常有用的脚本：http: [//www.sommarskog.se/sqlutil/aba_lockinfo.html](http://www.sommarskog.se/sqlutil/aba_lockinfo.html)

它显示过程或触发器和当前语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T18:56:47.747

您可以使用 SQL Profiler 找出答案。

编辑：如果您可以停止正在运行的应用程序，则可以启动 SQL Profiler，运行该应用程序并查看正在运行的内容，包括存储过程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T18:58:40.690

我认为您可以执行 sp_who2 来获取连接列表，但是您需要通过 SQL Profiler 在特定连接上运行跟踪以查看它正在执行什么。我认为这不适用于已经在运行的查询。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T19:08:44.020

[DBCC INPUTBUFFER](http://msdn.microsoft.com/en-us/library/ms187730.aspx)将向您显示 spid 上输入的前 255 个字符（您可以使用 sp_who2 来确定您感兴趣的 spid）。要查看整个命令，您可以使用[::fn_get_sql()](http://msdn.microsoft.com/en-us/library/ms189451.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T18:59:35.493

使用 Enterprise Manager，您可以打开管理树部分，然后选择 Current Activity -> Process Info。双击进程 ID 将显示该进程正在运行的内容。如果它是一个存储过程，它不会显示参数。为此，最好使用 Brian Kim 的使用 SQL Profiler 的建议。

# powershell - Powershell 的 Copy-Item 的 -container 参数是什么意思？

> ID：129088
> 
> 赞同：45
> 
> 时间：2008-09-24T18:53:15.710
> 
> 标签：powershell, copy-item

我正在为 MS PowerShell 编写脚本。该脚本使用该`Copy-Item`命令。此命令的可选参数之一是“ `-container`”。该参数的文档指出，指定此参数“在复制操作期间保留容器对象”。

这一切都很好，因为我将是最后一个在复制操作期间想要未保存的容器对象的人。但说真的，这个论点有什么用呢？特别是在我将磁盘目录树从一个地方复制到另一个地方的情况下，这对`Copy-Item`命令的行为有什么影响？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2014-02-15T14:13:29.373

我也发现文档帮助不大。我做了一些测试，以了解该`-Container`参数在`-Recurse`复制文件和文件夹时是如何工作的。

请注意，这`-Container`意味着`-Container: $true`.

这是我用于示例的文件结构：

```
#    X:.
#    ├───destination
#    └───source
#        │   source.1.txt
#        │   source.2.txt
#        │
#        └───source.1
#                source.1.1.txt 
```

*   对于所有示例，当前位置 (pwd) 是`X:\`.
*   我使用了 PowerShell 4.0。

* * *

1）仅复制源文件夹（空文件夹）：

```
Copy-Item -Path source -Destination .\destination
Copy-Item -Path source -Destination .\destination -Container
#    X:.
#    ├───destination
#    │   └───source
#    └───source (...) 
```

*以下给出了错误：*

```
Copy-Item -Path source -Destination .\destination -Container: $false
# Exception: Container cannot be copied to another container. 
#            The -Recurse or -Container parameter is not specified. 
```

2）复制整个文件夹结构的文件：

```
Copy-Item -Path source -Destination .\destination -Recurse
Copy-Item -Path source -Destination .\destination -Recurse -Container
#    X:.
#    ├───destination
#    │   └───source
#    │       │   source.1.txt
#    │       │   source.2.txt
#    │       │
#    │       └───source.1
#    │               source.1.1.txt
#    └───source (...) 
```

3）将所有后代（文件和文件夹）复制到一个文件夹中：

```
Copy-Item -Path source -Destination .\destination -Recurse -Container: $false
#    X:.
#    ├───destination
#    │   │   source.1.1.txt
#    │   │   source.1.txt
#    │   │   source.2.txt
#    │   │
#    │   └───source.1
#    └───source (...) 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-24T19:38:18.163

文档所讨论的容器是文件夹结构。如果您正在执行递归复制并希望保留文件夹结构，则可以使用 -container 开关。（注意：默认情况下 -container 开关设置为 true，所以你真的不需要指定它。如果你想关闭它，你可以使用`-container: $false`。）

这有一个问题......如果您列出目录并将其通过管道传输到 Copy-Item，它将不会保留文件夹结构。如果要保留文件夹结构，则必须指定 -path 属性和 -recurse 开关。

# c# - 从 .Net CF 1.0 中查找操作系统类型

> ID：129094
> 
> 赞同：1
> 
> 时间：2008-09-24T18:53:55.693
> 
> 标签：c#, windows-mobile, compact-framework

获取操作系统类型的 API 是什么？Windows CE 还是 Windows 移动？

```
Environment.OSVersion 
```

只是给出了CE版本。如果设备上安装了“Windows Mobile”，它不会提供信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:22:45.603

请参阅有关平台检测的这些博客文章：

*   [平台检测一](https://blogs.msdn.com/netcfteam/archive/2006/09/15/756755.aspx)
*   [平台检测二](http://blogs.msdn.com/netcfteam/archive/2006/09/22/766343.aspx)

# language-agnostic - 什么时候应该使用 Debug.Assert()？

> ID：129120
> 
> 赞同：241
> 
> 时间：2008-09-24T18:57:38.493
> 
> 标签：language-agnostic, exception, testing, assertions, defensive-programming

我已经做了大约一年的专业软件工程师，毕业于 CS 学位。我知道 C++ 和 C 中的断言有一段时间了，但直到最近才知道它们存在于 C# 和 .NET 中。

我们的生产代码不包含任何断言，我的问题是......

我应该开始在我们的生产代码中使用断言吗？如果是这样，什么时候使用最合适？这样做会更有意义吗

```
Debug.Assert(val != null); 
```

或者

```
if ( val == null )
    throw new exception(); 
```

* * *

## 回答 #1

> 赞同：256
> 
> 时间：2008-09-24T19:47:21.260

在[调试 Microsoft .NET 2.0 应用程序](https://rads.stackoverflow.com/amzn/click/com/0735622027)中，John Robbins 有一个关于断言的大节。他的主要观点是：

1.  自由地断言。你永远不能有太多的断言。
2.  断言不能代替异常。例外涵盖了您的代码要求的内容；断言涵盖了它假设的东西。
3.  一个写得很好的断言不仅可以告诉你发生了什么和发生在哪里（比如一个例外），还可以告诉你为什么。
4.  异常消息通常很隐晦，需要您通过代码向后工作以重新创建导致错误的上下文。断言可以保留程序在错误发生时的状态。
5.  断言兼作文档，告诉其他开发人员您的代码所依赖的隐含假设。
6.  断言失败时出现的对话框允许您将调试器附加到进程，因此您可以在堆栈周围戳，就好像您在那里放置了一个断点一样。

PS：如果您喜欢 Code Complete，我建议您继续阅读本书。我买它是为了了解如何使用 WinDBG 和转储文件，但前半部分包含了一些技巧，可以帮助避免首先出现错误。

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2008-09-24T18:59:41.780

将`Debug.Assert()`代码中您希望进行健全性检查以确保不变量的任何位置放置。当您编译发布版本（即，没有*`DEBUG`*编译器常量）时，对 的调用`Debug.Assert()`将被删除，因此它们不会影响性能。

在调用`Debug.Assert()`. 断言只是确保在您仍在开发时一切都按预期进行。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2011-02-17T15:48:58.867

FWIW ...我发现我的公共方法倾向于使用该`if () { throw; }`模式来确保正确调用该方法。我的私人方法倾向于使用`Debug.Assert()`.

这个想法是，使用我的私有方法，我是受控制的，所以如果我开始使用不正确的参数调用我自己的私有方法之一，那么我在某处打破了我自己的假设——我不应该得到进入那个状态。在生产中，理想情况下，这些私有断言应该是不必要的工作，因为我应该保持我的内部状态有效和一致。与提供给公共方法的参数相比，任何人都可以在运行时调用它：我仍然需要通过抛出异常来强制执行参数约束。

此外，如果某些东西在运行时不起作用（网络错误、数据访问错误、从第三方服务检索到的错误数据等），我的私有方法仍然会引发异常。我的断言只是为了确保我没有打破我自己对对象状态的内部假设。

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2008-09-24T19:12:30.750

从[代码完成](http://cc2e.com/)

> ## 8 防御性编程
> 
> ### 8.2 断言
> 
> 断言是在开发过程中使用的代码（通常是例程或宏），它允许程序在运行时检查自身。当断言为真时，这意味着一切都按预期运行。当它为假时，这意味着它在代码中检测到意外错误。例如，如果系统假设客户信息文件的记录永远不会超过 50,000 条，则程序可能包含记录数小于或等于 50,000 条的断言。只要记录数小于或等于 50,000，断言就会保持沉默。但是，如果它遇到超过 50,000 条记录，它会大声“断言”程序中存在错误。
> 
> 断言在大型复杂程序和高可靠性程序中特别有用。它们使程序员能够更快地清除不匹配的接口假设、修改代码时出现的错误等等。
> 
> 一个断言通常需要两个参数：一个布尔表达式，描述假设为真，如果不是，则显示消息。
> 
> （……）
> 
> 通常，您不希望用户在生产代码中看到断言消息；断言主要用于开发和维护期间。断言通常在开发时编译到代码中，并从代码中编译出来用于生产。在开发过程中，断言会清除矛盾的假设、意外情况、传递给例程的错误值等等。在生产过程中，它们是从代码中编译出来的，因此断言不会降低系统性能。

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2008-09-24T19:01:33.570

使用断言检查开发人员假设和异常检查环境假设。

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2008-09-24T19:06:36.630

如果我是你，我会这样做：

```
Debug.Assert(val != null);
if ( val == null )
    throw new exception(); 
```

或避免重复条件检查

```
if ( val == null )
{
    Debug.Assert(false,"breakpoint if val== null");
    throw new exception();
} 
```

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2008-09-24T19:02:10.777

如果您希望在您的生产代码中使用 Asserts（即发布版本），您可以使用 Trace.Assert 而不是 Debug.Assert。

这当然会增加您的生产可执行文件的开销。

此外，如果您的应用程序在用户界面模式下运行，则默认情况下会显示“断言”对话框，这可能会让您的用户感到有些不安。

您可以通过删除 DefaultTraceListener 来覆盖此行为：查看 MSDN 中 Trace.Listeners 的文档。

总之，

*   大量使用 Debug.Assert 来帮助捕获 Debug 构建中的错误。

*   如果您在用户界面模式下使用 Trace.Assert，您可能希望删除 DefaultTraceListener 以避免让用户感到不安。

*   如果您正在测试的条件是您的应用程序无法处理的情况，您最好抛出异常，以确保执行不会继续。请注意，用户可以选择忽略断言。

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2008-09-24T19:04:35.357

断言用于捕获程序员（您的）错误，而不是用户错误。仅当用户不可能触发断言时才应使用它们。例如，如果您正在编写 API，则不应使用断言来检查 API 用户可以调用的任何方法中的参数是否不为空。但它可以用于不作为 API 的一部分公开的私有方法中，以断言您的代码在不应该传递空参数时永远不会传递。

当我不确定时，我通常更喜欢异常而不是断言。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2014-10-16T15:00:18.160

**简而言之**

`Asserts`用于保护和检查按合同设计的约束，即确保代码、对象、变量和参数的状态在预期设计***的边界和限制内运行。***

*   `Asserts`应该仅用于调试和非生产版本。在发布版本中，编译器通常会忽略断言。
*   `Asserts`可以检查系统控制的错误/意外情况
*   `Asserts`不是用于第一线验证用户输入或业务规则的机制
*   `Asserts`不应用于检测*意外*的环境条件（超出代码的控制范围），例如内存不足、网络故障、数据库故障等。虽然很少见，但这些情况是可以预料的（并且您的应用程序代码无法修复诸如硬件故障或资源耗尽）。通常，异常会被抛出——您的应用程序可以采取纠正措施（例如重试数据库或网络操作，尝试释放缓存的内存），或者如果无法处理异常则优雅地中止。
*   一个失败的断言对你的系统来说应该是致命的——也就是说，与异常不同，不要试图捕捉或处理失败`Asserts`——你的代码在意想不到的领域运行。堆栈跟踪和故障转储可用于确定出了什么问题。

断言有很大的好处：

*   帮助查找缺少的用户输入验证，或更高级别代码中的上游错误。
*   代码库中的断言清楚地将代码中的假设传达给读者
*   断言将在运行时在`Debug`构建中进行检查。
*   一旦代码经过详尽的测试，将代码重新构建为 Release 将消除验证假设的性能开销（但如果需要，以后的 Debug 构建将始终恢复检查）。

**... 更多详情**

`Debug.Assert`表示在程序控制范围内由代码块的其余部分假定的关于状态的条件。这可以包括提供的参数的状态、类实例成员的状态，或者方法调用的返回在其约定/设计范围内。通常，断言应该使用所有必要的信息（堆栈跟踪、崩溃转储等）使线程/进程/程序崩溃，因为它们表明存在未设计用于的错误或未考虑的条件（即不要尝试捕获或处理断言失败），一个可能的例外是断言本身可能比错误造成更大的损害（例如，当飞机进入潜艇时，空中交通管制员不想要 YSOD，尽管是否应该部署调试版本是没有实际意义的生产 ...）

你应该什么时候使用`Asserts?`

*   在系统、库 API 或服务中，假设对函数或类状态的输入是有效的（例如，当已经对系统表示层中的用户输入进行验证时，业务和数据tier 类通常假定已经对输入进行了空值检查、范围检查、字符串长度检查等）。
*   常见`Assert`检查包括无效假设将导致空对象取消引用、零除数、数字或日期算术溢出以及一般带外/不是为行为而设计的（例如，如果使用 32 位 int 来模拟人类的年龄，谨慎`Assert`的做法是，年龄实际上在 0 到 125 左右之间——-100 和 10^10 的值不是为之设计的）。

**.Net 代码契约**
在 .Net 堆栈中，[代码契约](http://research.microsoft.com/en-us/projects/contracts/)可以作为.Net 协议[的补充或替代](https://stackoverflow.com/q/20603510/314291)使用`Debug.Assert`。代码契约可以进一步形式化状态检查，并且可以帮助在编译时（或之后不久，如果在 IDE 中作为背景检查运行）检测违反假设的情况。

可用的合同设计 (DBC) 检查包括：

*   `Contract.Requires`- 约定的先决条件
*   `Contract.Ensures`- 签约后置条件
*   `Invariant`- 表达关于对象在其生命周期中所有时间点的状态的假设。
*   `Contract.Assumes`- 当调用非契约修饰方法时，安抚静态检查器。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2008-09-24T19:27:26.393

在我的书中几乎从来没有。在绝大多数情况下，如果您想检查一切是否正常，则如果不正常则抛出。

我不喜欢的是它使调试版本在功能上与发布版本不同。如果调试断言失败但该功能在发布中有效，那么这有什么意义呢？如果断言者早已离开公司并且没有人知道那部分代码，那就更好了。然后你必须打发一些时间来探索这个问题，看看它是否真的是一个问题。如果这是一个问题，那么为什么不是首先扔的人？

对我来说，这表明通过使用 Debug.Asserts 您将问题推迟到其他人，自己处理问题。如果某些事情应该是这种情况，而事实并非如此，那么就抛出。

我想可能存在性能关键场景，您希望优化您的断言并且它们在那里很有用，但是我还没有遇到这样的场景。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-24T20:04:43.263

根据[IDesign 标准](http://www.idesign.net/idesign/DesktopDefault.aspx)，您应该

> 断言每一个假设。平均而言，每五行是一个断言。

```
using System.Diagnostics;

object GetObject()
{...}

object someObject = GetObject();
Debug.Assert(someObject != null); 
```

作为免责声明，我应该提一下，我发现实施此 IRL 并不实用。但这是他们的标准。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-09-24T19:03:56.823

仅在您希望为发布版本删除检查的情况下使用断言。请记住，如果您不在调试模式下编译，您的断言将不会触发。

鉴于您的 check-for-null 示例，如果这是在仅限内部的 API 中，我可能会使用断言。如果它在公共 API 中，我肯定会使用显式检查并抛出。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-12-29T22:43:55.950

所有断言都应该是可以优化为的代码：

```
Debug.Assert(true); 
```

因为它正在检查您已经假设为真的事情。例如：

```
public static void ConsumeEnumeration<T>(this IEnumerable<T> source)
{
  if(source != null)
    using(var en = source.GetEnumerator())
      RunThroughEnumerator(en);
}
public static T GetFirstAndConsume<T>(this IEnumerable<T> source)
{
  if(source == null)
    throw new ArgumentNullException("source");
  using(var en = source.GetEnumerator())
  {
    if(!en.MoveNext())
      throw new InvalidOperationException("Empty sequence");
    T ret = en.Current;
    RunThroughEnumerator(en);
    return ret;
  }
}
private static void RunThroughEnumerator<T>(IEnumerator<T> en)
{
  Debug.Assert(en != null);
  while(en.MoveNext());
} 
```

在上面，有三种不同的方法来处理空参数。第一个接受它是允许的（它什么也不做）。第二个抛出异常以供调用代码处理（或不处理，导致错误消息）。第三个假设它不可能发生，并断言它是这样的。

在第一种情况下，没有问题。

在第二种情况下，调用代码有问题——它不应该`GetFirstAndConsume`用 null 调用，所以它会返回一个异常。

在第三种情况下，此代码存在问题，因为在调用它之前应该已经检查`en != null`过它，因此它不是一个错误。或者换句话说，它应该是理论上可以优化到的代码`Debug.Assert(true)`，sicne`en != null`应该总是`true`！

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-12-21T04:55:12.267

我想我会再添加四个案例，其中 Debug.Assert 可能是正确的选择。

**1）**我在这里没有看到的是**Asserts 在自动化测试期间可以提供的额外概念覆盖**。举个简单的例子：

当作者修改了一些更高级别的调用者时，作者认为他们已经扩展了代码的范围以处理其他场景，理想情况下（！）他们将编写单元测试来覆盖这个新条件。然后可能是完全集成的代码似乎可以正常工作。

然而，实际上已经引入了一个细微的缺陷，但在测试结果中没有发现。在这种情况下，被调用者变得不确定，只是*碰巧*提供了预期的结果。或者它可能产生了一个未被注意到的舍入错误。或者导致在其他地方同样抵消的错误。或者不仅授予请求的访问权限，还授予不应授予的其他权限。等等。

此时，被调用方中包含的 Debug.Assert() 语句与单元测试驱动的新案例（或边缘案例）相结合，可以在测试期间提供宝贵的通知，即原作者的假设已失效，代码不应无需额外审查即可发布。带有单元测试的断言是完美的合作伙伴。

**2）**此外，**一些测试编写起来很简单，但考虑到初始假设，成本高且不必要**。例如：

如果一个对象只能从某个安全入口点访问，是否应该从每个对象方法对网络权限数据库进行额外查询以确保调用者具有权限？肯定不是。也许理想的解决方案包括缓存或其他一些功能扩展，但设计不需要它。当对象已附加到不安全的入口点时，Debug.Assert() 将立即显示。

**3)**接下来，在某些情况下，您的**产品在发布模式下部署时可能对其全部或部分操作没有有用的诊断交互**。例如：

假设它是一个嵌入式实时设备。当遇到格式错误的数据包时抛出异常并重新启动会适得其反。相反，设备可能会受益于尽力而为的操作，甚至会在其输出中呈现噪声。在发布模式下部署时，它也可能没有人机界面、日志记录设备，甚至根本无法被人类物理访问，并且最好通过评估相同的输出来提供对错误的感知。在这种情况下，自由断言和彻底的预发布测试比异常更有价值。

**4）**最后，**一些测试是不必要的，只是因为被调用者被认为是非常可靠的**。在大多数情况下，可重用的代码越多，就越努力使其可靠。因此，对于来自调用者的意外参数，异常是常见的，但对于来自被调用者的意外结果，断言是常见的。例如：

如果核心`String.Find`操作声明在未找到搜索条件时将返回 a `-1`，则您可以安全地执行一项操作而不是三项操作。但是，如果它真的返回了`-2`，您可能没有合理的行动方案。将更简单的计算替换为单独测试一个`-1`值的计算是没有帮助的，并且在大多数发布环境中使用测试乱扔代码以确保核心库按预期运行是不合理的。在这种情况下，断言是理想的。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2015-11-18T16:04:30.763

摘自[The Pragmatic Programmer：从熟练工到大师](https://rads.stackoverflow.com/amzn/click/com/020161622X)

> **打开断言**
> 
> 编写编译器和语言环境的人发布了关于断言的常见误解。它是这样的：
> 
> 断言给代码增加了一些开销。因为它们会检查不应该发生的事情，所以它们只会被代码中的错误触发。一旦代码经过测试和交付，就不再需要它们，应该关闭它们以使代码运行得更快。断言是一种调试工具。
> 
> 这里有两个明显错误的假设。首先，他们假设测试发现了所有的错误。实际上，对于任何复杂的程序，您都不太可能测试您的代码将通过的排列的一小部分（请参阅无情测试）。
> 
> 其次，乐观主义者忘记了你的程序运行在一个危险的世界中。在测试期间，老鼠可能不会啃通讯线，玩游戏的人不会耗尽内存，日志文件也不会填满硬盘。当您的程序在生产环境中运行时，这些事情可能会发生。您的第一道防线是检查任何可能的错误，第二道防线是使用断言来尝试检测您遗漏的那些。
> 
> **将程序交付到生产环境时关闭断言就像在没有网络的情况下穿越高线，因为您曾经在实践中穿越过**。有巨大的价值，但很难获得人寿保险。
> 
> **即使你确实有性能问题，也只关闭那些真正打击你的断言**。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-24T19:09:30.603

您应该始终使用第二种方法（抛出异常）。

此外，如果您正在生产中（并且有发布版本），最好抛出异常（并让应用程序在最坏的情况下崩溃）而不是使用无效值并可能破坏您客户的数据（这可能会花费数千美元）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-24T19:03:40.913

您应该使用 Debug.Assert 来测试程序中的逻辑错误。编译器只能通知您语法错误。所以你应该明确地使用 Assert 语句来测试逻辑错误。比如说测试一个销售汽车的程序，只有蓝色的宝马才能获得 15% 的折扣。编译器无法告诉您您的程序在执行此操作时是否在逻辑上正确，但断言语句可以。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-07-31T12:24:50.470

我在这里阅读了答案，我认为我应该添加一个重要的区别。有两种非常不同的使用断言的方式。一个是作为“这不应该真的发生，所以如果它确实让我知道所以我可以决定做什么”的临时开发人员快捷方式，有点像条件断点，用于您的程序能够继续的情况。另一种方法是在代码中对有效程序状态进行假设。

在第一种情况下，断言甚至不需要在最终代码中。您应该`Debug.Assert`在开发期间使用，如果/不再需要，您可以删除它们。如果您想留下它们或忘记删除它们也没问题，因为它们不会在发布编译中产生任何影响。

但在第二种情况下，断言是代码的一部分。他们，好吧，断言，你的假设是真实的，并且记录它们。在这种情况下，您真的想将它们留在代码中。如果程序处于无效状态，则不应允许其继续。如果您无法承受性能损失，您就不会使用 C#。一方面，如果发生这种情况，能够附加调试器可能会很有用。另一方面，您不希望堆栈跟踪出现在您的用户身上，也许更重要的是您不希望他们能够忽略它。此外，如果它在服务中，它将始终被忽略。因此，在生产中，正确的行为是抛出异常，并使用程序的正常异常处理，这可能会向用户显示一条好消息并记录详细信息。

`Trace.Assert`有完美的方法来实现这一点。它不会在生产中被删除，并且可以使用 app.config 配置不同的侦听器。因此，对于开发，默认处理程序很好，对于生产，您可以创建一个简单的 TraceListener，如下所示，它会引发异常并在生产配置文件中激活它。

```
using System.Diagnostics;

public class ExceptionTraceListener : DefaultTraceListener
{
    [DebuggerStepThrough]
    public override void Fail(string message, string detailMessage)
    {
        throw new AssertException(message);
    }
}

public class AssertException : Exception
{
    public AssertException(string message) : base(message) { }
} 
```

在生产配置文件中：

```
<system.diagnostics>
  <trace>
    <listeners>
      <remove name="Default"/>
      <add name="ExceptionListener" type="Namespace.ExceptionTraceListener,AssemblyName"/>
    </listeners>
  </trace>
 </system.diagnostics> 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-09-24T19:00:12.497

我不知道它在 C# 和 .NET 中的情况如何，但在 C 中 assert() 仅在使用 -DDEBUG 编译时才有效 - 如果没有使用 -DDEBUG 编译，最终用户将永远不会看到 assert()。它仅供开发人员使用。我经常使用它，有时更容易跟踪错误。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-09-24T19:00:58.703

我不会在生产代码中使用它们。抛出异常，捕获并记录。

在 asp.net 中也需要小心，因为断言可能会出现在控制台上并冻结请求。

# nhibernate - 如何查看 nHibernate 生成的 SQL？

> ID：129133
> 
> 赞同：43
> 
> 时间：2008-09-24T18:59:17.553
> 
> 标签：nhibernate

如何查看 nHibernate 生成的 SQL？1.2版

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-24T20:38:28.580

你可以在你的 app.config/web.config 文件中加入这样的东西：

在 configSections 节点中：

```
<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net"/> 
```

在配置节点中：

```
<log4net>
  <appender name="NHibernateFileLog" type="log4net.Appender.FileAppender">
    <file value="logs/nhibernate.txt" />
    <appendToFile value="false" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%d{HH:mm:ss.fff} [%t] %-5p %c - %m%n"  />
    </layout>
  </appender>
  <logger name="NHibernate.SQL" additivity="false">
    <level value="DEBUG"/>
    <appender-ref ref="NHibernateFileLog"/>
  </logger>
</log4net> 
```

别忘了打电话

```
log4net.Config.XmlConfigurator.Configure(); 
```

在你的应用程序启动时，或者把

```
[assembly: log4net.Config.XmlConfigurator(Watch=true)] 
```

在 assemblyinfo.cs

在配置设置中，将“show_sql”属性设置为 true。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2016-04-20T02:54:28.033

我知道我有点晚了，但这可以解决问题，而且它是独立于工具/数据库/框架的。而不是那些有效的选项，我使用[NH Interceptors](http://nhibernate.info/doc/nhibernate-reference/events.html)。

首先，实现一个扩展**NHibernate.EmptyInterceptor**并实现**NHibernate.IInterceptor**的类：

```
using NHibernate;

namespace WebApplication2.Infrastructure
{
    public class SQLDebugOutput : EmptyInterceptor, IInterceptor
    {
        public override NHibernate.SqlCommand.SqlString
           OnPrepareStatement(NHibernate.SqlCommand.SqlString sql)
        {
            System.Diagnostics.Debug.WriteLine("NH: " + sql);

            return base.OnPrepareStatement(sql);
        }
    }
} 
```

然后，只需在您打开会话时传递一个实例。请务必仅在 DEBUG 中执行此操作：

```
public static void OpenSession() {

#if DEBUG
    HttpContext.Current.Items[SessionKey] = _sessionFactory.OpenSession(new SQLDebugOutput());

#else
    HttpContext.Current.Items[SessionKey] = _sessionFactory.OpenSession();

#endif
} 
```

就是这样。

从现在开始，你的 sql 命令像这样......

```
 var totalPostsCount = Database.Session.Query<Post>().Count();

 var currentPostPage = Database.Session.Query<Post>()
        .OrderByDescending(c => c.CreatedAt)
        .Skip((page - 1) * PostsPerPage)
        .Take(PostsPerPage)
        .ToList(); 
```

.. 直接显示在您的输出窗口中：

> NH：从帖子 post0_ 中选择 cast(count(*) as INT) as col_0_0_
> 
> NH：选择post0_.Id 作为Id3_，post0_.user_id 作为user2_3_，post0_.Title 作为Title3_，post0_.Slug 作为Slug3_，post0_.Content 作为Content3_，post0_.created_at 作为created6_3_，post0_.updated_at 作为updated7_3_，post0_.deleted_at 作为deleted8_3_从帖子 post0_ order by post0_.created_at desc 限制？抵消 ？

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-24T19:02:03.070

在配置设置中，将“show_sql”属性设置为 true。这将导致 SQL 在 NHibernate 的日志文件中输出，由 log4net 提供。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T19:00:03.107

使用 sql 服务器分析器。

编辑（1 年后）：正如@Toran Billups 下面所述，NHibernate 分析器 Ayende 写的非常酷。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-10-12T15:03:45.583

您也可以尝试[NHibernate Profiler](http://nhprof.com/)（如果没有别的，可以试用 30 天）。这个工具是最好的恕我直言。

这不仅会显示生成的 SQL，还会显示警告/建议/等

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T19:04:37.183

NHibernate 日志记录有一个很好的参考：[How to configure Log4Net for use with NHibernate](http://www.nhforge.org/blogs/nhibernate/archive/2008/09/06/how-to-configure-log4net-for-use-with-nhibernate.aspx)。它包括有关记录所有 NHibernate 生成的 SQL 语句的信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-12T15:01:55.540

[Nhibernate Profiler](http://nhprof.com/)是一个选项，如果你必须做一些严肃的事情。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-07-31T18:01:17.080

如果您使用的是 SQL Server（不是 Express），则可以尝试 SQL Server Profiler。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-17T23:39:46.237

或者，如果您想显示特定查询的 SQL，请使用以下方法（稍微改变了[Ricardo Peres建议](https://about.me/rjperes)[的](https://weblogs.asp.net/ricardoperes/getting-the-sql-from-a-linq-query-in-nhibernate)版本）：

```
private String NHibernateSql(IQueryable queryable)
{
  var prov = queryable.Provider as DefaultQueryProvider;
  var session = prov.Session as ISession;

  var sessionImpl = session.GetSessionImplementation();
  var factory = sessionImpl.Factory;
  var nhLinqExpression = new NhLinqExpression(queryable.Expression, factory);
  var translatorFactory = new NHibernate.Hql.Ast.ANTLR.ASTQueryTranslatorFactory();
  var translator = translatorFactory.CreateQueryTranslators(nhLinqExpression, null, false, sessionImpl.EnabledFilters, factory).First();
  var sql = translator.SQLString;

  var parameters = nhLinqExpression.ParameterValuesByName;
  if ( (parameters?.Count ?? 0) > 0)
  {
    sql += "\r\n\r\n-- Parameters:\r\n";
    foreach (var par in parameters)
    {
      sql += "-- " + par.Key.ToString() + " - " + par.Value.ToString() + "\r\n";
    }
  }

  return sql;
} 
```

并传递给它一个`NHibernate`查询，即

```
var query = from a in session.Query<MyRecord>()
  where a.Id == "123456" 
  orderby a.Name
  select a;

var sql = NHibernateSql(query); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-01-05T12:53:45.627

您只要求查看；但是这个答案解释了如何将它记录到文件中。登录后，您可以在任何文本编辑器中查看它。

最新版本的 NHibernate 支持通过代码启用日志记录。以下是演示这一点的示例代码。请阅读评论以更好地理解。

```
Configuration configuration = new Configuration();

configuration.SetProperty(NHibernate.Cfg.Environment.Dialect, ......);
//Set other configuration.SetProperty as per need
configuration.SetProperty(NHibernate.Cfg.Environment.ShowSql, "true"); //Enable ShowSql
configuration.SetProperty(NHibernate.Cfg.Environment.FormatSql, "true"); //Enable FormatSql to make the log readable; optional.

configuration.AddMapping(......);
configuration.BuildMappings();

ISessionFactory sessionFactory = configuration.BuildSessionFactory();

//ISessionFactory is setup so far. Now, configure logging.
Hierarchy hierarchy = (Hierarchy)LogManager.GetRepository(Assembly.GetEntryAssembly());
hierarchy.Root.RemoveAllAppenders();

FileAppender fileAppender = new FileAppender();
fileAppender.Name = "NHFileAppender";
fileAppender.File = logFilePath;
fileAppender.AppendToFile = true;
fileAppender.LockingModel = new FileAppender.MinimalLock();
fileAppender.Layout = new PatternLayout("%d{yyyy-MM-dd HH:mm:ss}:%m%n%n");
fileAppender.ActivateOptions();

Logger logger = hierarchy.GetLogger("NHibernate.SQL") as Logger;
logger.Additivity = false;
logger.Level = Level.Debug;
logger.AddAppender(fileAppender);

hierarchy.Configured = true; 
```

您可以根据自己的需要`FileAppender`进一步玩。`Logger`有关更多详细信息，请参阅[此](https://stackoverflow.com/a/54182578/5779732)答案和[此](https://nhibernate.info/doc/howto/various/configure-log4net-for-use-with-nhibernate)资源。这与 XML 配置解释相同；但同样适用于代码。

# python - Python 中的通用异常处理是“正确的方式”

> ID：129144
> 
> 赞同：32
> 
> 时间：2008-09-24T19:00:47.767
> 
> 标签：python, exception, readability

有时我发现自己处于想要执行几个顺序命令的情况，例如：

```
try:
    foo(a, b)
except Exception, e:
    baz(e)
try:
    bar(c, d)
except Exception, e:
    baz(e)
... 
```

当只需要忽略异常时，也会出现同样的模式。

这感觉是多余的，过多的语法导致阅读代码时难以理解。

在 C 语言中，我可以使用宏轻松解决此类问题，但不幸的是，这不能在直接 python 中完成。

问题：遇到这种模式时，如何最好地减少代码占用并提高代码可读性？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-24T19:05:58.007

如果您有 python 2.5 或更高版本，则可以使用该[`with`语句：](https://www.python.org/dev/peps/pep-0343/)

```
from __future__ import with_statement
import contextlib

@contextlib.contextmanager
def handler():
    try:
        yield
    except Exception, e:
        baz(e) 
```

您的示例现在变为：

```
with handler():
    foo(a, b)
with handler():
    bar(c, d) 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T13:31:32.513

如果在特定函数引发异常时*始终是您想要的行为，则可以使用装饰器：*

```
def handle_exception(handler):
    def decorate(func):
        def call_function(*args, **kwargs):
            try:
                func(*args, **kwargs)
            except Exception, e:
                handler(e)
        return call_function
    return decorate

def baz(e):
    print(e)

@handle_exception(baz)
def foo(a, b):
    return a + b

@handle_exception(baz)
def bar(c, d):
    return c.index(d) 
```

用法：

```
>>> foo(1, '2')
unsupported operand type(s) for +: 'int' and 'str'
>>> bar('steve', 'cheese')
substring not found 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T19:04:59.803

如果它们是简单的单行命令，您可以将它们包装在`lambda`s 中：

```
for cmd in [
    (lambda: foo (a, b)),
    (lambda: bar (c, d)),
]:
    try:
        cmd ()
    except StandardError, e:
        baz (e) 
```

您可以将整个事情包装在一个函数中，所以它看起来像这样：

```
ignore_errors (baz, [
    (lambda: foo (a, b)),
    (lambda: bar (c, d)),
]) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T19:05:17.227

我发现最好的方法是定义一个这样的函数：

```
def handle_exception(function, reaction, *args, **kwargs):
    try:
        result = function(*args, **kwargs)
    except Exception, e:
        result = reaction(e)
    return result 
```

但这在实践中感觉或看起来不正确：

```
handle_exception(foo, baz, a, b)
handle_exception(bar, baz, c, d) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T20:15:09.993

你可以试试这样的。这有点像 C 宏。

```
class TryOrBaz( object ):
    def __init__( self, that ):
        self.that= that
    def __call__( self, *args ):
        try:
            return self.that( *args )
        except Exception, e:
            baz( e )

TryOrBaz( foo )( a, b )
TryOrBaz( bar )( c, d ) 
```

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-09-24T19:05:48.800

在您的具体情况下，您可以这样做：

```
try:
    foo(a, b)
    bar(c, d)
except Exception, e:
    baz(e) 
```

或者，您可以在上面的一步中捕获异常：

```
try:
    foo_bar() # This function can throw at several places
except Exception, e:
    baz(e) 
```

# jquery - IE6中的jQuery JSONP问题

> ID：129157
> 
> 赞同：4
> 
> 时间：2008-09-24T19:02:33.833
> 
> 标签：jquery, ajax, internet-explorer-6, jsonp

使用 IE6 从不同域中的服务器检索 JSONP 响应时遇到问题。

当我使用 JSONP 对与网页相同域中的服务器进行相同的 AJAX 调用时，所有浏览器（包括 IE6）都运行良好。但是，当我使用 JSONP 在域 (XSS) 之间进行调用时，Internet Explorer 6 会锁定。具体来说，CPU 达到 100% 并且永远不会达到“成功”回调。我在域之间取得成功的唯一一次是响应非常短（通常小于 150 字节）。响应的长度似乎很重要。

我正在使用 jQuery 1.2.6。我试过 $.getJSON() 方法和 $.ajax(dataType: "jsonp") 方法没有成功。这在 FF3 和 IE7 中运行良好。我找不到其他有类似问题的人。我认为 IE6 中的 jQuery 完全支持这种类型的功能。

非常感谢任何帮助，

安德鲁

* * *

**这是进行 AJAX 调用的 html 页面的代码**。制作此文件（和 jquery 库）的本地副本并使用 IE6 试一试。对我来说，它总是会导致 CPU 在没有响应的情况下出现峰值。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untitled Page</title>
    <script type="text/javascript" src="Scripts/jquery-1.2.6.min.js"></script>
    <script type="text/javascript" src="http://devhubplus/portal/search.js"></script>
</head>
<body>
<a href="javascript:test1(500, 'wikiResults');">Test</a>
<div id="wikiResults" style="margin-top: 35px;"></div>

<script type="text/javascript">
    function test1(count, targetId)
    {
        var dataSourceUrl = "http://code.katzenbach.com/Default.aspx?callback=?";
        $.getJSON(dataSourceUrl, {c: count, test: "true", nt: new Date().getTime()}, function(results) {
                var response = new String();
                response += "<div>";
                for(i in results)
                {
                    response += results[i];
                    response += " ";

                }
                response += "</div>";
                $("#" + targetId).html(response);
        });
    }

</script>
</body>
</html> 
```

这是响应中返回的 JSON。根据 JSLint，它是有效的 JSON（一旦删除了围绕它的方法调用）。实际结果会有所不同，但这似乎是导致失败的最简单示例。服务器是一个 ASP.Net 应用程序，返回类型为“application/json”的响应。我尝试将响应类型更改为“application/javascript”和“application/x-javascript”，但没有任何影响。我真的很感激帮助。

```
jsonp1222350625589(["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"

,"19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"

,"39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58"

,"59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78"

,"79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98"

,"99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115"

,"116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132"

,"133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149"

,"150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166"

,"167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183"

,"184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200"

,"201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217"

,"218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234"

,"235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251"

,"252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268"

,"269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285"

,"286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302"

,"303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319"

,"320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336"

,"337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353"

,"354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370"

,"371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387"

,"388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404"

,"405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421"

,"422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438"

,"439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455"

,"456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472"

,"473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489"

,"490","491","492","493","494","495","496","497","498","499"]) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T10:40:13.837

你不会那么喜欢这个响应，但我确信它在你的服务器端。

原因如下：

我已经重新创建了您的场景，当我使用您的 JSONP 响应程序运行时，IE6 挂起，正如您所解释的那样。

但是，当我将 JSONP 响应程序更改为我自己的代码（与您在上面给出的输出完全相同）时，它可以正常工作（在所有浏览器中，尤其是在 IE6 中）。

这是我一起嘲笑的例子：

[http://jsbin.com/udako](http://jsbin.com/udako)（编辑[http://jsbin.com/udako/edit](http://jsbin.com/udako/edit)）

回调正在点击[http://jsbin.com/rs.php?callback=](http://jsbin.com/rs.php?callback=)？

小提示 - 我最初怀疑字符串长度：我读过 IE 中的字符串的最大长度为 ~1Mb，这就是您所击中的（我不是 100% 确定这是否准确），但我将串联更改为数组推送 - 无论如何通常更快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T04:58:21.803

可能完全不相关，但我刚刚发现在 IE6 中，当代码从 onclick 事件处理程序启动时，JSONP 回调可能永远不会执行。

此问题的解决方法是通过 HREF 而不是单击事件附加代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T07:48:59.357

您是否在[jslint](http://www.jslint.com)进行 json 验证？如果您有 ur 并包含完整的 jquery 库，我可以为您调试它或发布 json，我可以尝试重新创建问题。仅从给出的信息很难判断。我之前看到过一些奇怪的事情，json 中键的实际名称在 ie6 上中断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T18:04:46.530

您是否尝试过 mime-type: application/x-javascript？

# tomcat - 如何避免为 tomcat 的 server.xml 数据源的资源定义明文存储密码？

> ID：129160
> 
> 赞同：41
> 
> 时间：2008-09-24T19:03:16.343
> 
> 标签：tomcat, jdbc, configuration

在tomcat的资源定义`server.xml`看起来像这样......

```
<Resource
    name="jdbc/tox"
    scope="Shareable"
    type="javax.sql.DataSource"
    url="jdbc:oracle:thin:@yourDBserver.yourCompany.com:1521:yourDBsid"
    driverClassName="oracle.jdbc.pool.OracleDataSource"
    username="tox"
    password="toxbaby"
    maxIdle="3"
    maxActive="10"
    removeAbandoned="true"
    removeAbandonedTimeout="60"
    testOnBorrow="true"
    validationQuery="select * from dual"
    logAbandoned="true"
    debug="99"/> 
```

密码是明文的。如何避免这种情况？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-12-10T11:28:55.523

如前所述，加密密码只是将问题转移到其他地方。

无论如何，这很简单。只需为您的密钥等编写一个包含静态字段的类，以及加密、解密密码的静态方法。使用此类在 Tomcat 的配置文件（`server.xml`或...）中加密您的密码。`yourapp.xml`

并且要在 Tomcat 中“即时”解密密码，扩展 DBCP`BasicDataSourceFactory`并在您的资源中使用这个工厂。

它看起来像：

```
 <Resource
        name="jdbc/myDataSource"
        auth="Container"
        type="javax.sql.DataSource"
        username="user"
        password="encryptedpassword"
        driverClassName="driverClass"
        factory="mypackage.MyCustomBasicDataSourceFactory"
        url="jdbc:blabla://..."/> 
```

对于定制工厂：

```
package mypackage;

....

public class MyCustomBasicDataSourceFactory extends org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory {

@Override
public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable environment) throws Exception {
    Object o = super.getObjectInstance(obj, name, nameCtx, environment);
    if (o != null) {
        BasicDataSource ds = (BasicDataSource) o;
        if (ds.getPassword() != null && ds.getPassword().length() > 0) {
            String pwd = MyPasswordUtilClass.unscramblePassword(ds.getPassword());
            ds.setPassword(pwd);
        }
        return ds;
    } else {
        return null;
    }
} 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-06-15T23:39:43.827

Tomcat 有专门解决您的问题[的密码常见问题解答。](https://cwiki.apache.org/confluence/display/TOMCAT/Password)简而言之：保持密码清晰并正确锁定您的服务器。

该页面还提供了一些关于如何使用隐匿安全性来通过审核员检查表的建议。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-09-02T18:44:58.280

正如@Ryan 提到的，请在实施此解决方案之前阅读 Tomcat 的[Tomcat 密码常见问题解答。](https://cwiki.apache.org/confluence/display/TOMCAT/Password)您只是增加了默默无闻而不是安全性。

@Jerome Delattre 的答案适用于简单的 JDBC 数据源，但不适用于作为数据源构造的一部分连接的更复杂的数据源（例如 oracle.jdbc.xa.client.OracleXADataSource）。

这是在调用现有工厂之前修改密码的替代方法。下面是一个用于基本数据源的工厂和一个用于 Atomikos JTA 兼容 XA 数据源的工厂示例。

基本示例：

```
public class MyEncryptedPasswordFactory extends BasicDataSourceFactory {

    @Override
    public Object getObjectInstance(Object obj, Name name, Context context, Hashtable<?, ?> environment)
            throws Exception {
        if (obj instanceof Reference) {
            Reference ref = (Reference) obj;
            DecryptPasswordUtil.replacePasswordWithDecrypted(ref, "password");
            return super.getObjectInstance(obj, name, context, environment);
        } else {
            throw new IllegalArgumentException(
                    "Expecting javax.naming.Reference as object type not " + obj.getClass().getName());
        }
    }
} 
```

Atomikos 示例：

```
public class MyEncryptedAtomikosPasswordFactory extends EnhancedTomcatAtomikosBeanFactory {
    @Override
    public Object getObjectInstance(Object obj, Name name, Context context, Hashtable<?, ?> environment)
            throws NamingException {
        if (obj instanceof Reference) {
            Reference ref = (Reference) obj;
            DecryptPasswordUtil.replacePasswordWithDecrypted(ref, "xaProperties.password");
            return super.getObjectInstance(obj, name, context, environment);
        } else {
            throw new IllegalArgumentException(
                    "Expecting javax.naming.Reference as object type not " + obj.getClass().getName());
        }
    }
} 
```

更新参考中的密码值：

```
public class DecryptPasswordUtil {

    public static void replacePasswordWithDecrypted(Reference reference, String passwordKey) {
        if(reference == null) {
            throw new IllegalArgumentException("Reference object must not be null");
        }

        // Search for password addr and replace with decrypted
        for (int i = 0; i < reference.size(); i++) {
            RefAddr addr = reference.get(i);
            if (passwordKey.equals(addr.getType())) {
                if (addr.getContent() == null) {
                    throw new IllegalArgumentException("Password must not be null for key " + passwordKey);
                }
                String decrypted = yourDecryptionMethod(addr.getContent().toString());
                reference.remove(i);
                reference.add(i, new StringRefAddr(passwordKey, decrypted));
                break;
            }
        }
    }
} 
```

一旦包含这些类的 .jar 文件位于 Tomcat 的类路径中，您就可以更新 server.xml 以使用它们。

```
<Resource factory="com.mycompany.MyEncryptedPasswordFactory" username="user" password="encryptedPassword" ...other options... />

<Resource factory="com.mycompany.MyEncryptedAtomikosPasswordFactory" type="com.atomikos.jdbc.AtomikosDataSourceBean" xaProperties.user="user" xaProperties.password="encryptedPassword" ...other options... /> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T15:49:07.280

Tomcat 需要知道如何连接到数据库，所以它需要访问明文密码。如果密码是加密的，Tomcat 需要知道如何解密它，所以你只是将问题转移到其他地方。

真正的问题是：`server.xml`除了Tomcat，谁可以访问？一个解决方案是只授予 root 用户读取权限`server.xml`，要求 Tomcat 以 root 权限启动：如果恶意用户获得系统的 root 权限，丢失数据库密码可能是一个小问题。

否则，您应该在每次启动时手动输入密码，但这很少是可行的选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-01-10T03:30:58.997

经过4个小时的工作，搜索问题和答案我得到了解决方案。根据@Jerome Delattre 的回答，这里是完整的代码（带有 JNDI 数据源配置）。

上下文.xml

```
<Resource
    name="jdbc/myDataSource"
    auth="Container"
    type="javax.sql.DataSource"
    username="user"
    password="encryptedpassword"
    driverClassName="driverClass"
    factory="mypackage.MyCustomBasicDataSourceFactory"
    url="jdbc:blabla://..."/> 
```

自定义数据源工厂：

```
package mypackage;

public class MyCustomBasicDataSourceFactory extends org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory {
    @Override
    public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable environment) throws Exception {
        Object o = super.getObjectInstance(obj, name, nameCtx, environment);
        if (o != null) {
            BasicDataSource ds = (BasicDataSource) o;
            if (ds.getPassword() != null && ds.getPassword().length() > 0) {
                String pwd = MyPasswordUtilClass.unscramblePassword(ds.getPassword());
                ds.setPassword(pwd);
            }
            return ds;
        } else {
            return null;
        }
    }
} 
```

数据源bean：

```
@Bean
public DataSource dataSource() {
    DataSource ds = null;
    JndiTemplate jndi = new JndiTemplate();
    try {
        ds = jndi.lookup("java:comp/env/jdbc/myDataSource", DataSource.class);
    } catch (NamingException e) {
        log.error("NamingException for java:comp/env/jdbc/myDataSource", e);
    }
    return ds;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-05-04T04:16:52.763

**笔记：**

您可以使用**WinDPAPI**加密和解密数据

```
public class MyDataSourceFactory extends DataSourceFactory{

private static WinDPAPI winDPAPI;

protected static final String DATA_SOURCE_FACTORY_PROP_PASSWORD = "password";

@Override
public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable environment) throws Exception{

    Reference ref = (Reference) obj;
    for (int i = 0; i < ref.size(); i++) {
        RefAddr ra = ref.get(i);
        if (ra.getType().equals(DATA_SOURCE_FACTORY_PROP_PASSWORD)) {

            if (ra.getContent() != null && ra.getContent().toString().length() > 0) {
                String pwd = getUnprotectedData(ra.getContent().toString());
                ref.remove(i);
                ref.add(i, new StringRefAddr(DATA_SOURCE_FACTORY_PROP_PASSWORD, pwd));
            }

            break;
        }
    }

    return super.getObjectInstance(obj, name, nameCtx, environment);
  }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-07-22T15:27:35.760

**问题**：正如所指出的，在将解密密钥存储在下一个文件中的同时加密 context.xml 中的凭据实际上只是解决了问题。由于访问 context.xml 的用户还需要访问解密密钥，因此如果应用程序或操作系统用户受到威胁，所有凭据仍然会受到威胁。

**解决方案**：唯一可以增加安全性的解决方案是从整个设置中完全删除解密密钥。这可以通过要求某人在启动时在您的应用程序中键入密码来实现，然后使用该密码来解密所有凭据。

**进一步推迟解决方案**：在大多数情况下，此类密码可能需要许多管理员和/或开发人员知道。通过使用允许共享密码的密码共享解决方案（例如 1Password），安全性将推迟到每个管理员/开发人员用于解锁其个人密码保险库的个人主密码。

**解决方案/讽刺的可能降级**：使用此设置，最坏的情况是有人将他们的主密码简单地保存在附在监视器上的便签上。这是否比将解密密钥放在加密值旁边的文件中更安全可能应该是一个单独的 SO 问题，或者可能是未来的研究。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2016-09-03T00:23:18.513

前面已经说过，如果您仍然想避免使用纯文本密码，您可以使用散列算法，例如 SHA-256 或（最好）SHA-512。创建密码时，获取哈希值并存储它而不是密码。当用户登录时，对密码进行哈希处理并查看它是否与存储的哈希密码匹配。散列算法将一个字符串（或数字）从一个小字符串（或数字）空间转换为一个更大的空间，这种方式的反转成本很高。

* * *

## 回答 #9

> 赞同：-9
> 
> 时间：2008-09-24T19:19:46.647

我们使用 C# 的 SHA1CryptoServiceProvider

```
print(SHA1CryptoServiceProvider sHA1Hasher = new SHA1CryptoServiceProvider();
        ASCIIEncoding enc = new ASCIIEncoding();

        byte[] arrbytHashValue = sHA1Hasher.ComputeHash(enc.GetBytes(clearTextPW));
        string HashData = System.BitConverter.ToString(arrbytHashValue);
        HashData = HashData.Replace("-", "");
        if (HashData == databaseHashedPassWO)
        {
            return true;
        }
        else
        {
            return false;
        }); 
```

)

# c# - 将 FileStream 中的数据读入通用 Stream

> ID：129171
> 
> 赞同：5
> 
> 时间：2008-09-24T19:04:37.883
> 
> 标签：c#, stream

将一个流读入另一个流的最有效方法是什么？在这种情况下，我试图将 Filestream 中的数据读入通用流。我知道我可以执行以下操作：
1\. 逐行读取并将数据写入流
2\. 读取字节块并写入流
3\. 等等

我只是想找到最有效的方法。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T19:10:13.940

Stephen Toub 在他的 MSDN .NET 问题专栏中讨论了流[管道](http://msdn.microsoft.com/en-us/magazine/cc163290.aspx)。在文章中，他描述了从一个输入流复制到另一个流的 CopyStream() 方法。这听起来与您尝试做的非常相似。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T20:56:52.483

我汇总了一种快速扩展方法（仅适用于 VS 2008 w/3.5）：

```
public static class StreamCopier
{
   private const long DefaultStreamChunkSize = 0x1000;

   public static void CopyTo(this Stream from, Stream to)
   {
      if (!from.CanRead || !to.CanWrite)
      {
         return;
      }

      var buffer = from.CanSeek
         ? new byte[from.Length]
         : new byte[DefaultStreamChunkSize];
      int read;

      while ((read = from.Read(buffer, 0, buffer.Length)) > 0)
      {
        to.Write(buffer, 0, read);
      }
   }
} 
```

它可以这样使用：

```
 using (var input = File.OpenRead(@"C:\wrnpc12.txt"))
 using (var output = File.OpenWrite(@"C:\wrnpc12.bak"))
 {
    input.CopyTo(output);
 } 
```

您还可以稍微交换逻辑并编写一个`CopyFrom()`方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:07:13.587

读取字节缓冲区然后写入它是最快的。像这样的方法`ReadLine()`需要寻找行分隔符，这比仅仅填充缓冲区需要更多的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:11:06.463

我假设通用流是指任何其他类型的流，例如内存流等。

如果是这样，最有效的方法是读取字节块并将它们写入接收流。块大小可以是 512 字节。

# java - int[] 数组和 int 数组[] 的区别

> ID：129178
> 
> 赞同：256
> 
> 时间：2008-09-24T19:06:12.623
> 
> 标签：java, arrays

最近一直在思考定义数组的两种方式的区别：

1.  `int[] array`
2.  `int array[]`

有区别吗？

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2008-09-24T19:08:05.550

它们在语义上是相同的。添加语法只是为了`int array[]`帮助 C 程序员习惯 java。

`int[] array`更可取，而且更少混乱。

* * *

## 回答 #2

> 赞同：187
> 
> 时间：2008-09-24T19:12:35.650

如果您碰巧在同一个声明中声明了多个变量，则存在细微差别：

```
int[] a, b;  // Both a and b are arrays of type int
int c[], d;  // WARNING: c is an array, but d is just a regular int 
```

请注意，这是一种糟糕的编码风格，尽管编译器几乎肯定会在您尝试使用`d`.

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2009-02-25T19:59:44.937

没有区别。

我更喜欢的`type[] name`格式很明显，变量是一个数组（少环顾四周以找出它是什么）。

编辑：

哦等等有区别（我忘记了，因为我一次从不声明多个变量）：

```
int[] foo, bar; // both are arrays
int foo[], bar; // foo is an array, bar is an int. 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2010-10-02T14:16:28.367

不，这些都是一样的。然而

```
byte[] rowvector, colvector, matrix[]; 
```

相当于：

```
byte rowvector[], colvector[], matrix[][]; 
```

取自[Java 规范](http://java.sun.com/docs/books/jls/third_edition/html/arrays.html)。这意味着

```
int a[],b;
int[] a,b; 
```

是不同的。我不会推荐这些多重声明中的任何一个。最容易阅读的（可能）是：

```
int[] a;
int[] b; 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2011-09-22T21:50:33.450

从[Java 语言规范的第 10.2 节](http://java.sun.com/docs/books/jls/third_edition/html/arrays.html#10.2)：

> [] 可以作为类型的一部分出现在声明的开头，或者作为特定变量的声明符的一部分，或者两者兼而有之，如下例所示：
> 
> ```
>  byte[] rowvector, colvector, matrix[]; 
> ```
> 
> 这个声明等价于：
> 
> ```
> byte rowvector[], colvector[], matrix[][]; 
> ```

就我个人而言，我见过的几乎*所有Java 代码都使用第一种形式，通过将有关变量的所有类型信息保存在一个地方，这更有意义。*老实说，我希望第二种形式被禁止……但这就是生活……

幸运的是，我认为我*从未见过*这个（有效的）代码：

```
String[] rectangular[] = new String[10][10]; 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2008-09-24T19:10:48.930

这两个命令是一回事。

您可以使用语法来声明多个对象：

```
int[] arrayOne, arrayTwo; //both arrays

int arrayOne[], intOne; //one array one int 
```

见：http: [//java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html](http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html)

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-01-18T10:30:50.930

**没有不同。**

引用[孙](http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html)：

> 可以作为类型的`[]`一部分出现在声明的开头，或者作为特定变量的声明符的一部分，或者两者兼而有之，如下例所示：`byte[] rowvector, colvector, matrix[];`
> 
> 这个声明等价于： `byte rowvector[], colvector[], matrix[][];`

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-01-18T10:29:06.407

两者没有任何区别；两者都声明了一个 s 数组`int`。但是，前者是首选，因为它将类型信息都保存在一个地方。后者只是为了 C/C++ 程序员转向 Java 的利益才真正得到支持。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-02-25T20:00:57.070

没有真正的区别；然而，

```
double[] items = new double[10]; 
```

是首选，因为它清楚地表明该类型是一个数组。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2011-09-22T21:48:21.853

`C`它是一种替代形式，它是从java 所基于的中借来的。

出于好奇，在 java中定义有效方法的方法有以下*三种：*`main`

*   `public static void main(String[] args)`
*   `public static void main(String args[])`
*   `public static void main(String... args)`

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2011-09-22T21:48:59.950

两者同样有效。但是不鼓励使用这种`int puzzle[]`形式，`int[] puzzle`根据[编码约定](http://www.oracle.com/technetwork/java/codeconvtoc-136057.html)，最好使用这种形式。另请参阅官方[Java 数组教程](http://download.oracle.com/javase/tutorial/java/nutsandbolts/arrays.html)：

> 同样，您可以声明其他类型的数组：
> 
> ```
> byte[] anArrayOfBytes;
> short[] anArrayOfShorts;
> long[] anArrayOfLongs;
> float[] anArrayOfFloats;
> double[] anArrayOfDoubles;
> boolean[] anArrayOfBooleans;
> char[] anArrayOfChars;
> String[] anArrayOfStrings; 
> ```
> 
> 您还可以在数组名称之后放置方括号：
> 
> ```
> float anArrayOfFloats[]; // this form is discouraged 
> ```
> 
> 然而，惯例不鼓励这种形式；括号标识数组类型，并应与类型名称一起出现。

注意最后一段。

我建议阅读官方的 Sun/Oracle 教程，而不是一些第 3 方的教程。否则，您将冒着学习不良做法的风险。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-24T19:09:33.677

没有区别，但 Sun 建议将其放在[此处解释的类型旁边](https://java.sun.com/docs/books/tutorial/java/nutsandbolts/arrays.html)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-10-02T14:13:33.290

最首选的选项是`int[] a`- 因为`int[]`是类型，并且`a`是名称。（您的第二个选项与此相同，但空间错位）

从功能上讲，它们之间没有区别。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-10-02T14:14:31.853

[Java 语言规范](http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html)说：

```
The [] may appear as part of the type at the beginning of the declaration,
or as part of the declarator for a particular variable, or both, as in this
example:

byte[] rowvector, colvector, matrix[];

This declaration is equivalent to:

byte rowvector[], colvector[], matrix[][]; 
```

**因此它们将产生完全相同的字节码。**

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-24T19:08:05.690

在 Java 中，这些只是说同一件事的不同语法方法。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-24T19:08:18.420

他们是一样的。一个比另一个更具可读性（对某些人来说）。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-24T19:08:55.143

它们是完全等价的。 `int [] array`是首选风格。 `int array[]`仅作为等效的 C 兼容样式提供。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-10-02T14:18:11.793

两种声明风格在功能上没有区别。两者都声明了 int 数组。

但是`int[] a` 将类型信息保持在一起并且更详细，所以我更喜欢它。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2010-10-02T14:18:46.430

两者具有相同的含义。但是，这些变体的存在也允许这样做：

```
int[] a, b[]; 
```

这与以下内容相同：

```
int[] a;
int[][] b; 
```

然而，这是一种可怕的编码风格，永远不应该这样做。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-10-24T10:07:18.310

它们是相同的，但这些语句之间有一个重要的区别：

```
// 1.
int regular, array[];
// 2.
int[] regular, array; 
```

1\. 正则只是一个 int，而 2\. 正则和数组都是 int 的数组。

因此，您的第二个陈述是首选，因为它更清楚。[根据Oracle 上的本教程](http://download.oracle.com/javase/tutorial/java/nutsandbolts/arrays.html)也不鼓励使用第一种形式。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-01-25T15:21:19.803

如前所述，没有太大区别（如果每行只声明一个变量）。

请注意，[SonarQube](https://www.sonarqube.org)将您的第二种情况视为轻微的*代码异味：*

> **数组指示符“[]”应该在类型上，而不是变量上 (squid:S1197)**
> 
> 数组指示符应始终位于类型上，以获得更好的代码可读性。否则，开发人员必须同时查看类型和变量名才能知道变量是否为数组。
> 
> *不合规代码示例*
> 
> ```
> int matrix[][];   // Noncompliant
> int[] matrix[];   // Noncompliant 
> ```
> 
> *合规解决方案*
> 
> ```
> int[][] matrix;   // Compliant 
> ```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-10-24T10:03:55.847

是的，完全一样。就个人而言，我更喜欢

```
int[] integers; 
```

因为它使任何阅读您的代码的人都立即明白整数是一个 int 数组，而不是

```
int integers[]; 
```

这并不那么明显，特别是如果您在一行中有多个声明。但同样，它们是等价的，所以这取决于个人喜好。

查看[这个关于 Java 数组的页面，](http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html)了解更深入的示例。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-01-04T07:43:34.080

在声明单个数组引用时，它们之间没有太大区别。所以以下两个声明是相同的。

```
int a[];  // comfortable to programmers who migrated from C/C++
int[] a;  // standard java notation 
```

在声明多个数组引用时，我们可以发现它们之间的区别。以下两个陈述意思相同。实际上，由程序员决定跟随哪个。但建议使用标准的 java 表示法。

```
int a[],b[],c[]; // three array references
int[] a,b,c;  // three array references 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-10-24T10:03:57.713

两者都可以。我建议选择一个并坚持下去。（我做第二个）

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-10-24T11:50:38.067

虽然`int integers[]`解决方案源于 C 语言（因此可以被认为是“正常”方法），但许多人发现`int[] integers`它更合乎逻辑，因为它不允许在一个声明中创建不同类型的变量（即 int 和数组）（而不是C 风格的声明）。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-05-10T05:57:00.063

是的，有区别。

int[] a = 新的 int[100]; // 'a' 本身不是数组，数组作为地址存储在内存中的其他位置，而 'a' 只保存该地址

int b[] = 新的 int[100]; // 在创建像 cleary 这样的数组时，显示 'b' 是一个数组，它是整数类型。

# java - 在 Java 中格式化时间戳

> ID：129181
> 
> 赞同：28
> 
> 时间：2008-09-24T19:06:50.297
> 
> 标签：java, date

有没有办法将 UTC 时间格式化为我在 java 中想要的任意字符串格式？基本上我正在考虑让某个类获取时间戳，然后我通过它是一个字符串，告诉它我希望它如何格式化，它会为我返回格式化的字符串。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-24T19:08:48.467

java.text.SimpleDateFormat 类以区域设置敏感的方式提供日期格式和解析。

[SimpleDateFormat](http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html)的 javadoc 标头是详细信息的良好来源。还有一个带有示例用法的[Java 教程。](https://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-24T19:13:11.903

[DateFormat](http://java.sun.com/j2se/1.4.2/docs/api/java/text/DateFormat.html)类或[SimpleDateFormat](http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html)应该能让你到达那里。例如，[http://www.epochconverter.com/](http://www.epochconverter.com/)列出了以下示例，以使用 Java 将纪元时间转换为人类可读的时间戳：

```
String date = new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm:ss").format(new java.util.Date (epoch*1000)); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T19:15:17.437

日期实例不足以满足某些用途。

请改用[Joda Time](http://joda-time.sourceforge.net/)。

Joda time 与 Hibernate 和其他数据库集成。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T01:38:23.287

需要注意的一个问题是 SimpleDateFormat 不是线程安全的。不要将它放在静态字段中并从多个线程同时使用它。

# java - 获取 Spring 应用程序上下文

> ID：129207
> 
> 赞同：232
> 
> 时间：2008-09-24T19:10:01.130
> 
> 标签：java, spring, configuration

有没有办法在 Spring 应用程序中静态/全局请求 ApplicationContext 的副本？

假设主类启动并初始化应用程序上下文，它是否需要通过调用堆栈将其传递给任何需要它的类，或者有没有办法让一个类请求先前创建的上下文？（我认为必须是单身人士？）

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2008-09-24T21:08:40.613

如果需要访问容器的对象是容器中的一个bean，只需实现[BeanFactoryAware](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-aware-beanfactoryaware)或[ApplicationContextAware](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/context/ApplicationContextAware.html)接口即可。

如果容器外部的对象需要访问容器，我使用了[标准的 GoF 单例模式](http://en.wikipedia.org/wiki/Singleton_pattern#Java)作为 spring 容器。这样，您的应用程序中只有一个单例，其余的都是容器中的单例 bean。

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2012-05-14T11:31:02.027

您可以实施`ApplicationContextAware`或仅使用`@Autowired`：

```
public class SpringBean {
  @Autowired
  private ApplicationContext appContext;
} 
```

`SpringBean`将被`ApplicationContext`注入，在其中实例化这个 bean。例如，如果您的 Web 应用程序具有非常标准的上下文层次结构：

```
main application context <- (child) MVC context 
```

并且`SpringBean`在主上下文中声明，它将注入主上下文；否则，如果它在 MVC 上下文中声明，它将注入 MVC 上下文。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-09-24T19:33:07.770

这是一个不错的方法（不是我的，原始参考在这里： [http ://sujitpal.blogspot.com/2007/03/accessing-spring-beans-from-legacy-code.html](http://sujitpal.blogspot.com/2007/03/accessing-spring-beans-from-legacy-code.html)

我已经使用了这种方法，并且效果很好。基本上，它是一个简单的 bean，它持有对应用程序上下文的（静态）引用。通过在 spring 配置中引用它，它被初始化。

看看原文，很清楚。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-27T21:43:30.993

我相信你可以使用[SingletonBeanFactoryLocator](http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/beans/factory/access/SingletonBeanFactoryLocator.html)。beanRefFactory.xml 文件将保存实际的 applicationContext，它会像这样：

```
<bean id="mainContext" class="org.springframework.context.support.ClassPathXmlApplicationContext">
     <constructor-arg>
        <list>
            <value>../applicationContext.xml</value>
        </list>
     </constructor-arg>
 </bean> 
```

从应用程序上下文中获取 bean 的代码如下所示：

```
BeanFactoryLocator bfl = SingletonBeanFactoryLocator.getInstance();
BeanFactoryReference bf = bfl.useBeanFactory("mainContext");
SomeService someService = (SomeService) bf.getFactory().getBean("someService"); 
```

Spring 团队不鼓励使用这个类和 yadayada，但它在我使用它的地方很适合我。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-27T08:28:19.843

在您实施任何其他建议之前，请先问自己这些问题......

*   为什么我要获取 ApplicationContext？
*   我是否有效地将 ApplicationContext 用作服务定位器？
*   我可以完全避免访问 ApplicationContext 吗？

这些问题的答案在某些类型的应用程序（例如 Web 应用程序）中比在其他应用程序中更容易，但无论如何都值得一问。

访问 ApplicationContext 确实违反了整个依赖注入原则，但有时您没有太多选择。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-04-21T08:16:24.027

```
SpringApplicationContext.java

import org.springframework.beans.BeansException;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;

/**
 * Wrapper to always return a reference to the Spring Application 
Context from
 * within non-Spring enabled beans. Unlike Spring MVC's 
WebApplicationContextUtils
 * we do not need a reference to the Servlet context for this. All we need is
 * for this bean to be initialized during application startup.
 */
public class SpringApplicationContext implements 
ApplicationContextAware {

  private static ApplicationContext CONTEXT;

  /**
   * This method is called from within the ApplicationContext once it is 
   * done starting up, it will stick a reference to itself into this bean.
  * @param context a reference to the ApplicationContext.
  */
  public void setApplicationContext(ApplicationContext context) throws BeansException {
    CONTEXT = context;
  }

  /**
   * This is about the same as context.getBean("beanName"), except it has its
   * own static handle to the Spring context, so calling this method statically
   * will give access to the beans by name in the Spring application context.
   * As in the context.getBean("beanName") call, the caller must cast to the
   * appropriate target class. If the bean does not exist, then a Runtime error
   * will be thrown.
   * @param beanName the name of the bean to get.
   * @return an Object reference to the named bean.
   */
  public static Object getBean(String beanName) {
    return CONTEXT.getBean(beanName);
  }
} 
```

来源：[http ://sujitpal.blogspot.de/2007/03/accessing-spring-beans-from-legacy-code.html](http://sujitpal.blogspot.de/2007/03/accessing-spring-beans-from-legacy-code.html)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-30T14:54:14.817

如果您使用 web 应用程序，还有另一种方法可以访问应用程序上下文，而无需使用单例，即使用 servletfilter 和 ThreadLocal。在过滤器中，您可以使用 WebApplicationContextUtils 访问应用程序上下文，并将应用程序上下文或所需的 bean 存储在 TheadLocal 中。

注意：如果您忘记取消设置 ThreadLocal，在尝试取消部署应用程序时会遇到麻烦！因此，您应该设置它并立即开始尝试在 finally 部分中取消设置 ThreadLocal。

当然，这仍然使用一个单例：ThreadLocal。但实际的豆子不再需要了。甚至可以是请求范围的，如果您在一个应用程序中有多个 WAR，并且 EAR 中有库，则此解决方案也可以工作。不过，您可能会认为使用 ThreadLocal 与使用普通单例一样糟糕。;-)

也许 Spring 已经提供了类似的解决方案？我没有找到，但我不确定。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-24T19:36:37.980

看看[ContextSingletonBeanFactoryLocator](http://static.springsource.org/spring/docs/current/javadoc-api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html)。它提供静态访问器来获取 Spring 的上下文，假设它们已经以某种方式注册。

它并不漂亮，而且比你想要的更复杂，但它确实有效。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-10-17T08:52:18.920

在 Spring 应用程序中有很多方法可以获取应用程序上下文。这些在下面给出：

1.  **通过 ApplicationContextAware**：

    ```
    import org.springframework.beans.BeansException;
    import org.springframework.context.ApplicationContext;
    import org.springframework.context.ApplicationContextAware;

    public class AppContextProvider implements ApplicationContextAware {

    private ApplicationContext applicationContext;

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }
    } 
    ```

这里`setApplicationContext(ApplicationContext applicationContext)`方法你会得到 applicationContext

> **应用上下文感知**：
> 
> 由任何希望通知它运行的 ApplicationContext 的对象实现的接口。例如，当对象需要访问一组协作 bean 时，实现此接口是有意义的。

2.  **通过自动连线**：

    ```
    @Autowired
    private ApplicationContext applicationContext; 
    ```

这里`@Autowired`的关键字将提供 applicationContext。自动接线有一些问题。它会在单元测试期间产生问题。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-02-20T11:52:18.257

请注意，通过将来自 current`ApplicationContext`或`ApplicationContext`自身的任何状态存储在静态变量中 - 例如使用单例模式 - 如果您使用 Spring-test，您的测试将变得不稳定且不可预测。这是因为 Spring-test 在同一个 JVM 中缓存和重用应用程序上下文。例如：

1.  测试 A 运行，它带有注释`@ContextConfiguration({"classpath:foo.xml"})`。
2.  测试 B 运行并带有注释`@ContextConfiguration({"classpath:foo.xml", "classpath:bar.xml})`
3.  测试 C 运行，它带有注释`@ContextConfiguration({"classpath:foo.xml"})`

当测试 A 运行时，`ApplicationContext`会创建一个，并且任何实现`ApplicationContextAware`或自动装配`ApplicationContext`的 bean 都可能写入静态变量。

当测试 B 运行时，同样的事情发生了，静态变量现在指向测试 B`ApplicationContext`

当测试 C 运行时，*不会创建任何 bean，*因为来自测试 A的`TestContext`（以及这里的）被重新使用。`ApplicationContext`现在你有一个静态变量指向另一个`ApplicationContext`，而不是当前为你的测试保存 bean 的那个。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-12-20T20:48:34.653

不确定这会有多大用处，但您也可以在初始化应用程序时获取上下文。即使在`@Autowire`.

```
@SpringBootApplication
public class Application extends SpringBootServletInitializer {
    private static ApplicationContext context;

    // I believe this only runs during an embedded Tomcat with `mvn spring-boot:run`. 
    // I don't believe it runs when deploying to Tomcat on AWS.
    public static void main(String[] args) {
        context = SpringApplication.run(Application.class, args);
        DataSource dataSource = context.getBean(javax.sql.DataSource.class);
        Logger.getLogger("Application").info("DATASOURCE = " + dataSource); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-03-06T05:14:06.523

在 Spring bean 中进行自动装配，如下所示：@Autowired private ApplicationContext appContext;

您将应用程序上下文对象。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-03-07T00:44:27.287

我使用一种简单、标准化的方式来允许外部访问我自己的任何单例 Spring Bean。用这个方法，我继续让Spring实例化Bean。这就是我所做的：

1.  定义一个与封闭类相同类型的私有静态变量。
2.  `this`在每个类的构造函数中将该变量设置为。如果该类没有构造函数，则添加一个默认构造函数来设置变量。
3.  定义一个返回单例变量的公共静态 getter 方法。

这是一个例子：

```
@Component
public class MyBean {
    ...

    private static MyBean singleton = null;

    public MyBean() {
        ...
        singleton = this;
    }

    ...

    public void someMethod() {
        ...
    }

    ...

    public static MyBean get() {
        return singleton;
    }
} 
```

然后，我可以通过以下方式在代码中的任何位置调用`someMethod`单例 bean：

```
MyBean.get().someMethod(); 
```

如果你已经继承了你的子类`ApplicationContext`，你可以直接向它添加这个机制。否则，您可以子类化它只是为了做到这一点，或者将此机制添加到任何可以访问 的 bean，`ApplicationContext`然后使用它`ApplicationContext`从任何地方访问 。重要的是，正是这种机制让您进入 Spring 环境。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-12-05T07:44:13.703

请注意；下面的代码将创建新的应用程序上下文，而不是使用已经加载的上下文。

```
private static final ApplicationContext context = 
               new ClassPathXmlApplicationContext("beans.xml"); 
```

另请注意，它`beans.xml`应该是`src/main/resources`战争手段的一部分，它是`WEB_INF/classes`其中的一部分，因为真正的应用程序将通过`applicationContext.xml`在`Web.xml`.

```
<context-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>META-INF/spring/applicationContext.xml</param-value>
</context-param> 
```

在构造函数中[很难](https://stackoverflow.com/questions/4802877/right-path-to-applicationcontext-xml-using-classpathxmlapplicationcontext)提及`applicationContext.xml`路径。将无法找到该文件。`ClassPathXmlApplicationContext``ClassPathXmlApplicationContext("META-INF/spring/applicationContext.xml")`

所以最好通过注解来使用已有的applicationContext。

```
@Component
public class OperatorRequestHandlerFactory {

    public static ApplicationContext context;

    @Autowired
    public void setApplicationContext(ApplicationContext applicationContext) {
        context = applicationContext;
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-03-29T08:39:24.570

**方法一：**你可以通过实现ApplicationContextAware接口来注入ApplicationContext。参考[链接](https://self-learning-java-tutorial.blogspot.com/2019/09/spring-boot-inject-applicationcontext.html)。

```
@Component
public class ApplicationContextProvider implements ApplicationContextAware {

    private ApplicationContext applicationContext;

    public ApplicationContext getApplicationContext() {
        return applicationContext;
    }

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }
} 
```

**方法 2：**在任何 spring 托管 bean 中自动装配应用程序上下文。

```
@Component
public class SpringBean {
  @Autowired
  private ApplicationContext appContext;
} 
```

参考[链接](https://self-learning-java-tutorial.blogspot.com/2020/03/spring-boot-get-reference-of.html)。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-06-28T00:20:38.433

我知道这个问题已经得到解答，但我想分享我为检索 Spring 上下文所做的 Kotlin 代码。

我不是专家，所以我愿意接受批评、评论和建议：

[https://gist.github.com/edpichler/9e22309a86b97dbd4cb1ffe011aa69dd](https://gist.github.com/edpichler/9e22309a86b97dbd4cb1ffe011aa69dd)

```
package com.company.web.spring

import com.company.jpa.spring.MyBusinessAppConfig
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.context.ApplicationContext
import org.springframework.context.annotation.AnnotationConfigApplicationContext
import org.springframework.context.annotation.ComponentScan
import org.springframework.context.annotation.Configuration
import org.springframework.context.annotation.Import
import org.springframework.stereotype.Component
import org.springframework.web.context.ContextLoader
import org.springframework.web.context.WebApplicationContext
import org.springframework.web.context.support.WebApplicationContextUtils
import javax.servlet.http.HttpServlet

@Configuration
@Import(value = [MyBusinessAppConfig::class])
@ComponentScan(basePackageClasses  = [SpringUtils::class])
open class WebAppConfig {
}

/**
 *
 * Singleton object to create (only if necessary), return and reuse a Spring Application Context.
 *
 * When you instantiates a class by yourself, spring context does not autowire its properties, but you can wire by yourself.
 * This class helps to find a context or create a new one, so you can wire properties inside objects that are not
 * created by Spring (e.g.: Servlets, usually created by the web server).
 *
 * Sometimes a SpringContext is created inside jUnit tests, or in the application server, or just manually. Independent
 * where it was created, I recommend you to configure your spring configuration to scan this SpringUtils package, so the 'springAppContext'
 * property will be used and autowired at the SpringUtils object the start of your spring context, and you will have just one instance of spring context public available.
 *
 *Ps: Even if your spring configuration doesn't include the SpringUtils @Component, it will works tto, but it will create a second Spring Context o your application.
 */
@Component
object SpringUtils {

        var springAppContext: ApplicationContext? = null
    @Autowired
    set(value) {
        field = value
    }

    /**
     * Tries to find and reuse the Application Spring Context. If none found, creates one and save for reuse.
     * @return returns a Spring Context.
     */
    fun ctx(): ApplicationContext {
        if (springAppContext!= null) {
            println("achou")
            return springAppContext as ApplicationContext;
        }

        //springcontext not autowired. Trying to find on the thread...
        val webContext = ContextLoader.getCurrentWebApplicationContext()
        if (webContext != null) {
            springAppContext = webContext;
            println("achou no servidor")
            return springAppContext as WebApplicationContext;
        }

        println("nao achou, vai criar")
        //None spring context found. Start creating a new one...
        val applicationContext = AnnotationConfigApplicationContext ( WebAppConfig::class.java )

        //saving the context for reusing next time
        springAppContext = applicationContext
        return applicationContext
    }

    /**
     * @return a Spring context of the WebApplication.
     * @param createNewWhenNotFound when true, creates a new Spring Context to return, when no one found in the ServletContext.
     * @param httpServlet the @WebServlet.
     */
    fun ctx(httpServlet: HttpServlet, createNewWhenNotFound: Boolean): ApplicationContext {
        try {
            val webContext = WebApplicationContextUtils.findWebApplicationContext(httpServlet.servletContext)
            if (webContext != null) {
                return webContext
            }
            if (createNewWhenNotFound) {
                //creates a new one
                return ctx()
            } else {
                throw NullPointerException("Cannot found a Spring Application Context.");
            }
        }catch (er: IllegalStateException){
            if (createNewWhenNotFound) {
                //creates a new one
                return ctx()
            }
            throw er;
        }
    }
} 
```

现在，一个 spring 上下文是公开可用的，能够独立于上下文（junit 测试、bean、手动实例化的类）调用相同的方法，就像在这个 Java Servlet 上一样：

```
@WebServlet(name = "MyWebHook", value = "/WebHook")
public class MyWebServlet extends HttpServlet {

    private MyBean byBean
            = SpringUtils.INSTANCE.ctx(this, true).getBean(MyBean.class);

    public MyWebServlet() {

    }
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2020-07-07T14:36:13.550

如果您的类不是 RestController 或 Configuration Class，即使在添加 @Autowire 之后，applicationContext 对象仍为 null。尝试使用以下创建新类，它工作正常：

```
@Component
public class SpringContext implements ApplicationContextAware{

   private static ApplicationContext applicationContext;

   @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws 
     BeansException {
    this.applicationContext=applicationContext;
   }
 } 
```

然后，您可以根据需要在同一类中实现 getter 方法，例如通过以下方式获取已实现的类引用：

```
 applicationContext.getBean(String serviceName,Interface.Class) 
```

# self-reference - 最佳实践：网站上的自引用脚本

> ID：129208
> 
> 赞同：2
> 
> 时间：2008-09-24T19:10:07.013
> 
> 标签：self-reference

在一位更有经验的开发人员的建议下，我总是将需要用户输入（表单处理、数据库管理等）的网页编码为自引用页面。对于 PHP 页面，我将表单的操作设置为预定义变量的`'PHP_SELF'`元素`$_SERVER`，并根据我传递给页面逻辑的参数确定要执行的代码块。

我喜欢所有代码都包含在一个文件中，而不是分散到各个结果页面。我发现的一个问题是我的统计分析程序无法区分页面的第一个视图和后续视图（例如，当表单提交时）。很久以前，当我使用 CGI 或 CF 创建页面时，我将用户引导到不同的结果页面，该页面非常简洁地显示了表单实际使用了多少次。

Web 开发中这些类型的页面的最佳实践是什么？使用（或不使用）自引用页面还有其他更令人信服的理由吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T19:25:42.623

我会争辩说，正如您所说，自引用页面没有遵循适当的关注点分离。你在同一个页面上做两件不同的事情，更清晰的逻辑分离会让你在两个不同的页面上做这些事情。

[MVC（模型视图控制器， http](http://en.wikipedia.org/wiki/Model-view-controller) ://en.wikipedia.org/wiki/Model-view-controller）框架强调了这种做法，例如 Ruby on Rails、Django 和 ASP.NET MVC（我不知道）我不知道任何 PHP 的，尽管我确信有一些）。

这也是 RESTful (REpresentational State Transfer) 实践的一个基本特征，其中每个 URL 代表一个资源和要对该资源执行的单个操作。另一方面，自引用页面的每个 URL/页面将有“2”个操作，例如“新建”（用于填写表单）和“创建”（实际创建对象）。

为网站实践 MVC 和 RESTful ( [http://en.wikipedia.org/wiki/RESTful](http://en.wikipedia.org/wiki/RESTful) ) 实践通常会产生更简洁的代码和更好的关注点分离。这很重要的原因是它使测试更容易（我所说的测试是指单元和功能测试，而不是“在我的浏览器上尝试页面”测试）。

统计数据的混乱是一个例子，说明不分离你的关注点会导致意想不到的复杂性。有些人可能会通过尝试检测请求的引用者来解决此问题，并查看它是否是同一页面。这些实际上只是解决症状的代码绷带，而不是解决问题。如果您在网站的不同页面中保留不同的“操作”，您可以将这些页面集中在他们的一项工作上，并确保他们做得很好，而不是用各种条件和额外的复杂性来混乱代码，如果完全避免的话1 页只有 1 个作业。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T19:33:32.790

表单处理的单一文件方法背后的最有力论据是它更容易维护。

请允许我扮演魔鬼的拥护者：如果您最初的两个文件方法有效且可衡量，为什么要更改它——特别是如果更改它会迫使您想出解决方法来衡量表单提交？

另一方面，如果您处理的事情比我想象的简单的联系表单提交（例如）更复杂，那么您可能应该[学习如何记录您的操作](http://pear.php.net/package/Log)，而不是依赖于网络统计数据包.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:35:30.040

在我要求某人填写表格（由文件中的脚本生成）的情况下，我喜欢回发到同一个脚本，以便我可以将错误检查放在顶部，然后重新生成如果发现任何错误，请填写表格。这使我可以编写一次表单生成并重新使用它，直到输入可以接受（即“请更正以红色显示的字段”等）。

一旦输入通过了所有健全性检查，您就可以从同一个脚本发出结果页面，或者调用另一个脚本，这取决于哪个更适合您的情况。但我个人认为您描述的自引用脚本没有问题。

That said, I **always** call on generic code and libraries to do the form generation and error checking, so even this "shared" form generation code ends up being fairly compact and simple.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:18:05.853

一种可能的选择是设置指向同一 URL 的 mod_rewrite 别名。例如：

```
RewriteEngine on
RewriteRule ^form$ form.php [QSA]
RewriteRule ^form/submit$ form.php [QSA] 
```

这将允许您在将代码维护在同一文件中的同时跟踪请求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:20:04.010

您可以使用单独的页面，并且只让结果页面包含表单页面。

# vxworks - 使用 kill 发送信号的任务会被抢占吗？

> ID：129211
> 
> 赞同：0
> 
> 时间：2008-09-24T19:10:26.327
> 
> 标签：vxworks

我们在 VxWorks 中有以下代码：

```
 sig_hdr () { ... }
task_low_priority() {
    ...
    // Install signal handler for SIGUSR1
    signal(SIGUSR1, sig_hdr);
    ...
}
task_high_priority() {
    ...
    kill(pid, SIGUSR1); //pid is the ID of task_low_priority
    ...
} 
```

高优先级任务向低优先级任务发送信号（通过 kill）。高优先级任务会被抢占，低优先级任务会立即执行，还是会延迟信号直到低优先级任务开始运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T19:14:46.907

发送信号不是阻塞操作。信号处理程序仅在其注册的任务具有处理器时才会执行。

在这种特殊情况下，信号处理将被推迟到低优先级任务执行。

这意味着如果带有处理程序的任务没有运行，信号处理可能会无限期地延迟。

这对内核操作有效。在实时进程中，信号处理有点不同，RTP 中的**第一个可用**任务将执行信号处理程序。

# .net - 使用 SNMP 和 .NET 的网络自动发现

> ID：129222
> 
> 赞同：7
> 
> 时间：2008-09-24T19:12:30.690
> 
> 标签：.net, networking, snmp

是否有任何库（第三方很好）可以帮助使用 SNMP 和 .NET 进行网络自动发现？

如果没有，你有没有自己推出过？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-23T09:59:50.687

作为#SNMP 的作者，我可以确认它支持基本的自动发现功能。只需简单地调用 Manager.Discover。还有一个讨论线程供您参考。

[http://www.codeplex.com/sharpsnmplib/Thread/View.aspx?ThreadId=32902](http://www.codeplex.com/sharpsnmplib/Thread/View.aspx?ThreadId=32902)

问候，

-莱克斯

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T15:55:34.777

我最近遇到了[Sharp SNMP Suite](http://sharpsnmplib.codeplex.com)，我认为它可以满足您的要求。我说“想想”，因为我自己还没有真正使用过它！我刚刚开始第一次为即将进行的项目研究 SNMP。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T21:20:51.473

*   HP OpenView 使用 SNMP 进行网络发现。可能值得研究他们是如何做到的
*   另一个建议是制定您的网关并通过 SNMP 获取它所连接的路由器

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-25T04:13:04.980

这是一个有点老的话题，但可能对某些人仍然有用。我曾经使用Oidview的[SNMP ，他们也有试用版。](http://www.oidview.com/mibbrowser.html)

# ruby-on-rails - 在 Ruby on Rails 中，线程、并发和分叉进程的当前状况是什么？

> ID：129226
> 
> 赞同：7
> 
> 时间：2008-09-24T19:12:52.373
> 
> 标签：ruby-on-rails, ruby, concurrency

Ruby on Rails 不能很好地处理多线程请求响应，或者至少 ActiveRecord 不能。

在创建需要很长时间才能完成的 shell 命令的 Web 应用程序时，同时只有一个请求-响应处于活动状态的概念可能会很麻烦。

我想谈谈你对这类设置的一些看法？Rails 可能不适合某些应用程序吗？

此外，关于 Ruby on Rails 中的并发性，目前的状况是什么？什么是最佳实践。有没有针对缺点的解决方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T19:29:19.230

Rails 目前不处理单个 MRI (Matz Ruby Interpreter) Ruby 进程中的并发请求。每个请求本质上都用一个巨大的互斥体包装。为使即将推出的 Rails 2.2 线程安全而做了大量工作，但在 Ruby 1.8x 下运行时，您不会从中获得很多好处。我无法评论 Ruby 1.9 是否会有所不同，因为我对它不是很熟悉，但我可能没有想到。

在这方面看起来非常有前途的一个领域是使用 JRuby 运行 Rails，因为 JVM 通常被认为擅长多线程。Sun Microsystems 的[Arun Gupta](http://weblogs.java.net/blog/arungupta/)最近在 RailsConf Europe 上给出了一些[有趣的性能数据。](http://weblogs.java.net/blog/arungupta/archive/2008/09/rails_conf_euro_5.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T13:43:23.483

Matz 的 Ruby 1.8 使用[绿色线程](http://en.wikipedia.org/wiki/Green_threads)，而 Matz 的 Ruby 1.9 将使用原生 O/S 线程。Ruby 1.8 的其他实现，例如 JRuby 和 IronRuby，使用本机 O/S 线程。YARV 是 Yet Another Ruby VM 的缩写，它也使用本机 O/S 线程，但具有全局解释器锁，以确保在任何给定时间只有一个 Ruby 线程正在执行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T05:31:55.277

[Neverblock](http://www.espace.com.eg/neverblock/)允许在不修改您编写程序的方式的情况下实现非阻塞功能。这确实是一个令人兴奋的项目，并且被反向移植到 Ruby 1.8.x 上（它依赖于 Ruby 1.9 的纤维）。它与 PostgreSQL 和 MySQL 一起工作以执行非阻塞查询。基准[很](http://www.espace.com.eg/neverblock/benchmarks)疯狂...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T13:02:49.213

如果您在 shell 上运行的内容对于页面的呈现不是必需的（例如，您只是触发维护任务或其他内容），您应该将它们作为后台进程启动。看看八哥和工作。

如果这不适用于您的情况，您必须确保应用服务器的多个实例运行。传统上人们会启动多个 Mongrel 实例。但现在我想说的是，到目前为止，最简单的方法是使用[Phusion Passenger](http://www.modrails.com/)。它是一个 Apache 模块，可让您轻松指定要运行的应用服务器的实例数（最小和最大）。其余的由乘客完成。如果我没记错的话，它不会做愚蠢的循环调度请求。我认为这是由可用性决定的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T04:15:36.663

Ruby 1.9 正在添加轻量级 Fiber：

[http://www.infoq.com/news/2007/08/ruby-1-9-fibers](http://www.infoq.com/news/2007/08/ruby-1-9-fibers)

# sql - 多对多表查询

> ID：129248
> 
> 赞同：2
> 
> 时间：2008-09-24T19:16:16.577
> 
> 标签：sql, join

我有一个多对多索引表，我想对其进行包含/排除类型查询。

fid 实际上是一个整数索引，但这里以字母表示以便于理解。这是一个示例表：

药片

```
eid | fid
----+----
1   | A
1   | B
1   | C
2   | B
2   | C
3   | A
3   | C
4   | A
4   | B
5   | B 
```

这是我想要的一些示例查询。

1.  哪些 eid 有 FID B，而不是 A？（回答开斋节 2 和 5）
2.  哪些 eid 有 FID C 而不是 A？（回答开斋节 2）

我似乎无法弄清楚可以执行此操作的查询。

我试过这样的自我加入：

```
select * 
from t as t1 
join t as t2 
where t1.eid=t2.eid 
  and t1.fid!=t2.fid 
  and t1.fid=B and t2.fid!=A 
```

那是行不通的，因为它仍然会返回 eid=1 和 fid=C 的行。

我清楚我想要什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T19:18:56.010

使用[集合减法](http://msdn.microsoft.com/en-us/library/ms188055.aspx)

> ```
> Select eid from t where fid = 'B' 
> EXCEPT
> select eid from t where fid = 'A' 
> ```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T19:25:34.853

这是一个查询 1 的示例（2 的工作方式大致相同）

```
select t1.eid
  from t t1
 where t1.fid  = 'B'
   and not exists
       (select 1
          from t t2
         where t2.eid = t1.eid
           and t2.fid  = 'A') 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:23:18.947

您可以使用子选择

选择 eid from t where fid = 'C' and eid not in (select eid from t where fid = 'A')

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:28:24.503

如 Nigel 和 Mike 所述，[MySQL 5.0支持 where exists/where not exists。](http://dev.mysql.com/doc/refman/5.0/en/exists-and-not-exists-subqueries.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:03:50.597

具有可能比使用 EXISTS 更快的直接连接的版本：

```
选择 t1.eid
从#test t1
        左连接 (
            选择开斋节
            来自#test t2
            其中fid ='A'
            按开斋节分组
        ) t2 上 t2.eid = t1.eid
其中 t1.fid = 'B'
        并且 t2.eid 为空

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T20:30:17.990

不使用子查询应该可以做到这一点：

```
SELECT DISTINCT t1.eid
FROM table1 AS t1
  LEFT JOIN table1 AS t2 ON (t1.eid = t2.eid AND t2.fid = 'A')
WHERE t2.eid IS NULL
  AND t1.fid = 'B'; 
```

要进行第二个示例搜索，只需将值“B”更改为“C”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T21:05:17.437

查看 MINUS 运算符。它像 UNION 一样工作，除了它减去 UNION 添加的位置。先前带有“EXCEPT”一词的答案可能是同一事物的不同关键字。

这是一个未经测试的答案：

```
select eid 
from t
where fid = 'A'
minus
select eid
from t
where fid = 'B' 
```

# emacs - C、C++ 和 JAVA 的 Emacs 中的 Eclipse 样式函数完成？

> ID：129257
> 
> 赞同：26
> 
> 时间：2008-09-24T19:18:24.293
> 
> 标签：emacs, autocomplete, intellisense

如何在 Emacs 中为 C、C++ 和 JAVA 获取 Eclipse 风格的函数完成？我喜欢 Emacs 文本编辑器的强大功能，但缺少“智能感知”功能让我不得不使用 Eclipse。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-24T21:31:50.103

`M-/`是基于当前缓冲区内容的快速而肮脏的自动完成。它不会为您提供 Eclipse 中的所有功能，但功能却出奇的强大。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T20:07:25.533

我只能作为一个没有太多使用 Eclipse 的人来回答你的问题。但！如果对您在 emacs 缓冲区中键入或查看的*所有内容进行了非常好的快速启发式分析，并且您可以**智能*完成所有这些内容，而不仅仅是在代码中？

```
Mx 加载库完成
Mx 全局设置键 C-RET 完成 RET

```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-03T16:07:33.430

当我做java开发时，我曾经使用过：

[Emacs 的 Java 开发环境 (JDEE)](http://jdee.sourceforge.net/)

当您显式调用 jdee 提供的函数时，JDEE 将提供方法名称补全。它在 jdee 模式下具有此功能的键盘绑定。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-04T08:57:47.750

[CEDET](http://cedet.sf.net)包为 C/C++ 和 Java（以及一些其他语言）提供了补全。要进行初始自定义，您可以使用[我](https://github.com/alexott/emacs-configs/tree/master)用于处理 C++ 项目的配置

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-22T20:16:49.853

现在，我正在为 Emacs使用[自动完成功能。](http://www.emacswiki.org/emacs/AutoComplete)作为当前的 Visual Studio 和前 Eclipse 用户，我可以说它可以很好地与这两个应用程序相媲美。它仍然不如 Microsoft 的 IntelliSense for C#，但有人会说 C++ 是出了名的难以解析。

它利用了（我相信）来自[Cedet的](http://cedet.sourceforge.net/)[Semantic](http://cedet.sourceforge.net/semantic.shtml)包的强大功能，与[Smart Complete](http://cedet.sourceforge.net/intellisense.shtml)相比，我发现它使用起来感觉更好。完成了C++成员、局部变量等，很不错。但是，它归结为无法完成重载方法（它只显示一次没有参数的函数，但我相信这是 Cedet 的限制），以及其他各种事情。不过未来可能会有所改善！

顺便说一句，我在这里可能是错的，但我认为您需要为班级成员完成设置一个 EDE 项目（就像您通常使用 Semantic 一样）。我只在有一个 EDE 项目时使用过它，所以我认为这是真的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T19:39:47.707

搜索我发现的网络[http://www.emacswiki.org/cgi-bin/wiki/EmacsTags#toc7](http://www.emacswiki.org/cgi-bin/wiki/EmacsTags#toc7)`complete-tab`在 etags 中描述。它是`M-Tab`默认绑定的。此绑定可能对您来说是个问题

此外，etags 有一些限制，这可能会惹恼你......

该链接还指出 CEDET 具有更好的符号完成支持。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T19:28:52.273

您是否尝试过 Eclipse 的 emacs 插件？

[http://people.csail.mit.edu/adonovan/hacks/eclipse-emacs.html](http://people.csail.mit.edu/adonovan/hacks/eclipse-emacs.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-14T14:09:07.217

[auto-complete-clang](https://github.com/brianjcj/auto-complete-clang)是你想要的。使用实际的 C++ 编译器进行补全不会出错。

它唯一的问题是无法知道要传递给编译器的内容`-I`和标志。`-D`有一些 emacs 包可以让你声明项目，然后你可以使用它。

就个人而言，我将 CMake 用于所有 C 和 C++ 工作，因此我编写了一些[CMake 代码](https://github.com/atilaneves/cmake_modules/tree/master/emacs)以通过目录局部变量将该信息传递给 emacs。它可以工作，但我正在考虑编写一个从 emacs 调用 cmake 的包，这样可以减少入侵。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-01T15:16:24.583

我在 CEDET 之上编写了一个特定于 C++ 的包，它可能会提供您想要的东西。它提供了一个类似 Eclipse 的函数参数提示。函数参数提示和完成都支持重载函数。包位于此处：

[https://github.com/abo-abo/function-args](https://github.com/abo-abo/function-args)

请务必查看漂亮的屏幕截图：

[https://raw.github.com/abo-abo/function-args/master/doc/screenshot-1.png](https://raw.github.com/abo-abo/function-args/master/doc/screenshot-1.png)

# asp.net - 如何制作一个框架来快速构建相似但不同的站点？

> ID：129261
> 
> 赞同：2
> 
> 时间：2008-09-24T19:19:01.360
> 
> 标签：asp.net, asp.net-mvc, wcsf

我需要使用 ASP.NET 2.0 构建许多非常相似但不完全相同的站点。

我正在尝试找到快速轻松地生成这些站点的最佳方法。

这些站点将用于收集有关用户的信息，并且每个站点将有多个步骤。

这些站点都将收集类似的信息，但某些站点可能需要比其他站点更少或更多的信息。此外，某些表单字段将需要根据站点从不同的数据库表中填充。

我想使用 Microsoft 模式和实践解决方案，但我不确定是否有适合这种情况的解决方案。

我目前的想法是，我会将尽可能多的业务逻辑放入一个外部程序集中，然后为每个站点的每个步骤编写一个自定义 Web 用户控件。我将在母版页的面板控件中包含这些用户控件。

我不喜欢这个解决方案，因为每个站点几乎都会复制其他站点的代码。

我该如何改进这个设计？

主要障碍是站点相似，但差异很大。

谢谢！

亚历克斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T19:23:31.910

您可以创建处理所有常见功能的基类，然后让您的站点特定控件从它们各自的基类继承，然后实现它们的特定实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T19:56:16.713

我们一直面临这个问题。我们所做的是拥有一个我们所有站点都使用的公共库，并将共享功能隐藏在该库的类或实用程序模块中。然后，每个站点都可以按原样使用这些对象或实用程序功能，或者扩展公共类。请记住，这些共享类可以包含所有类型的内容，包括您可以继承和扩展的页面和用户控件的代码隐藏。

不过，决定应用程序中的内容和公共库中的内容是我们业务中最困难的事情之一。把它放在公共库中，你就失去了灵活性；把它放在应用程序中，你就有可能需要维护重复的代码。

如果您有一个相当复杂的数据库设置，那么可能值得您花时间提出一个框架，用于在 XML 中指定您的 db 架构并让您的应用程序强制执行该架构并基于该定义构建您需要的任何其他 SQL 基础架构（例如实用程序视图、存储过程等）。我们这样做了，它极大地提高了生产力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T20:13:21.337

你看过 Monorail (www.castleproject.org)，这是一个 themvc 模式的实现，类似于带有一些漂亮视图引擎的 Ruby on rails，我更喜欢 Nvelocity。从城堡项目中，您也可以使用 ActiveRecord 的 n 实现，让生活变得真正美好。如果你在这条路上，还可以看看 coln ramsay 的截屏视频。

老实说，所有的 ms 解决方案都非常胖，castleproject 的另一个优点是它是完全开源的，因此您可以从他们的代码中学习负载

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T23:39:18.840

使用像 DotNetNuke 或 mojoportal 这样的应用程序框架怎么样？它们都提供了灵活性，使您能够非常快速地开发具有通用功能的网站。让您开发自定义模块，您需要的功能可能会有所不同。还可以购买数以千计的其他模块，这些模块提供了出色的功能。

然而，我们选择使用 WCSF 并对其进行了增强。
上面提到的所有项目都是开源的，并且有一些很好的代码示例可供学习。

我知道这可能是一个迟到的答案，但我希望它有所帮助

# postgresql - 级联删除一次

> ID：129265
> 
> 赞同：261
> 
> 时间：2008-09-24T19:19:19.580
> 
> 标签：postgresql

我有一个 Postgresql 数据库，我想做一些级联删除。但是，未使用 ON DELETE CASCADE 规则设置表。有什么方法可以执行删除并告诉 Postgresql 将其级联一次？相当于

```
DELETE FROM some_table CASCADE; 
```

[这个较老问题](https://stackoverflow.com/questions/45611/cascading-deletes-in-postgresql)的答案看起来似乎不存在这样的解决方案，但我想我会明确地问这个问题以确保。

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2008-09-24T19:25:08.413

不，只需为要级联的表编写删除语句即可。

```
DELETE FROM some_child_table WHERE some_fk_field IN (SELECT some_id FROM some_Table);
DELETE FROM some_table; 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-09-11T07:25:03.780

**如果你真的想要** `DELETE FROM some_table CASCADE;`这意味着“*从表中删除所有行`some_table`*”，你可以使用`TRUNCATE`而不是`DELETE`并且`CASCADE`总是被支持。但是，如果要使用带有`where`子句的选择性删除，`TRUNCATE`是不够的。

**USE WITH CARE** - 这将**删除所有**具有外键约束的表的所有行以及`some_table`对这些表有约束的所有表，等等。

Postgres 支持`CASCADE`TRUNCATE[命令](https://www.postgresql.org/docs/current/sql-truncate.html)：

```
TRUNCATE some_table CASCADE; 
```

方便的是，这是事务性的（即可以回滚），尽管它没有与其他并发事务完全隔离，并且还有其他一些注意事项。阅读文档了解详细信息。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2013-09-30T20:50:11.460

我编写了一个（递归）函数来根据其主键删除任何行。我写这个是因为我不想将我的约束创建为“删除级联”。我希望能够删除复杂的数据集（作为 DBA），但不允许我的程序员在不考虑所有影响的情况下进行级联删除。我仍在测试此功能，因此其中可能存在错误-但如果您的数据库具有多列主键（因此是外键），请不要尝试。此外，所有键都必须能够以字符串形式表示，但可以以没有该限制的方式编写。无论如何，我非常谨慎地使用此功能，我太看重我的数据以启用对所有内容的级联约束。基本上这个函数是在模式、表名和主值（以字符串形式）中传递的，它将首先在该表上查找任何外键并确保数据不存在——如果存在，它会在找到的数据上递归调用自己。它使用已标记为删除的数据数组来防止无限循环。请测试一下，让我知道它是如何为你工作的。注意：有点慢。我这样称呼它： `select delete_cascade('public','my_table','1');`

```
create or replace function delete_cascade(p_schema varchar, p_table varchar, p_key varchar, p_recursion varchar[] default null)
 returns integer as $$
declare
    rx record;
    rd record;
    v_sql varchar;
    v_recursion_key varchar;
    recnum integer;
    v_primary_key varchar;
    v_rows integer;
begin
    recnum := 0;
    select ccu.column_name into v_primary_key
        from
        information_schema.table_constraints  tc
        join information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name and ccu.constraint_schema=tc.constraint_schema
        and tc.constraint_type='PRIMARY KEY'
        and tc.table_name=p_table
        and tc.table_schema=p_schema;

    for rx in (
        select kcu.table_name as foreign_table_name, 
        kcu.column_name as foreign_column_name, 
        kcu.table_schema foreign_table_schema,
        kcu2.column_name as foreign_table_primary_key
        from information_schema.constraint_column_usage ccu
        join information_schema.table_constraints tc on tc.constraint_name=ccu.constraint_name and tc.constraint_catalog=ccu.constraint_catalog and ccu.constraint_schema=ccu.constraint_schema 
        join information_schema.key_column_usage kcu on kcu.constraint_name=ccu.constraint_name and kcu.constraint_catalog=ccu.constraint_catalog and kcu.constraint_schema=ccu.constraint_schema
        join information_schema.table_constraints tc2 on tc2.table_name=kcu.table_name and tc2.table_schema=kcu.table_schema
        join information_schema.key_column_usage kcu2 on kcu2.constraint_name=tc2.constraint_name and kcu2.constraint_catalog=tc2.constraint_catalog and kcu2.constraint_schema=tc2.constraint_schema
        where ccu.table_name=p_table  and ccu.table_schema=p_schema
        and TC.CONSTRAINT_TYPE='FOREIGN KEY'
        and tc2.constraint_type='PRIMARY KEY'
)
    loop
        v_sql := 'select '||rx.foreign_table_primary_key||' as key from '||rx.foreign_table_schema||'.'||rx.foreign_table_name||'
            where '||rx.foreign_column_name||'='||quote_literal(p_key)||' for update';
        --raise notice '%',v_sql;
        --found a foreign key, now find the primary keys for any data that exists in any of those tables.
        for rd in execute v_sql
        loop
            v_recursion_key=rx.foreign_table_schema||'.'||rx.foreign_table_name||'.'||rx.foreign_column_name||'='||rd.key;
            if (v_recursion_key = any (p_recursion)) then
                --raise notice 'Avoiding infinite loop';
            else
                --raise notice 'Recursing to %,%',rx.foreign_table_name, rd.key;
                recnum:= recnum +delete_cascade(rx.foreign_table_schema::varchar, rx.foreign_table_name::varchar, rd.key::varchar, p_recursion||v_recursion_key);
            end if;
        end loop;
    end loop;
    begin
    --actually delete original record.
    v_sql := 'delete from '||p_schema||'.'||p_table||' where '||v_primary_key||'='||quote_literal(p_key);
    execute v_sql;
    get diagnostics v_rows= row_count;
    --raise notice 'Deleting %.% %=%',p_schema,p_table,v_primary_key,p_key;
    recnum:= recnum +v_rows;
    exception when others then recnum=0;
    end;

    return recnum;
end;
$$
language PLPGSQL; 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-10-02T00:43:04.663

如果我理解正确，您应该能够通过删除外键约束、添加一个新约束（将级联）、执行您的操作并重新创建限制性外键约束来做您想做的事情。

例如：

```
testing=# create table a (id integer primary key);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "a_pkey" for table "a"
CREATE TABLE
testing=# create table b (id integer references a);
CREATE TABLE

-- put some data in the table
testing=# insert into a values(1);
INSERT 0 1
testing=# insert into a values(2);
INSERT 0 1
testing=# insert into b values(2);
INSERT 0 1
testing=# insert into b values(1);
INSERT 0 1

-- restricting works
testing=# delete from a where id=1;
ERROR:  update or delete on table "a" violates foreign key constraint "b_id_fkey" on table "b"
DETAIL:  Key (id)=(1) is still referenced from table "b".

-- find the name of the constraint
testing=# \d b;
       Table "public.b"
 Column |  Type   | Modifiers 
--------+---------+-----------
 id     | integer | 
Foreign-key constraints:
    "b_id_fkey" FOREIGN KEY (id) REFERENCES a(id)

-- drop the constraint
testing=# alter table b drop constraint b_a_id_fkey;
ALTER TABLE

-- create a cascading one
testing=# alter table b add FOREIGN KEY (id) references a(id) on delete cascade; 
ALTER TABLE

testing=# delete from a where id=1;
DELETE 1
testing=# select * from a;
 id 
----
  2
(1 row)

testing=# select * from b;
 id 
----
  2
(1 row)

-- it works, do your stuff.
-- [stuff]

-- recreate the previous state
testing=# \d b;
       Table "public.b"
 Column |  Type   | Modifiers 
--------+---------+-----------
 id     | integer | 
Foreign-key constraints:
    "b_id_fkey" FOREIGN KEY (id) REFERENCES a(id) ON DELETE CASCADE

testing=# alter table b drop constraint b_id_fkey;
ALTER TABLE
testing=# alter table b add FOREIGN KEY (id) references a(id) on delete restrict; 
ALTER TABLE 
```

当然，为了你的心理健康，你应该把这样的东西抽象成一个程序。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2017-07-20T08:45:24.597

我无法评论 Palehorse 的答案，所以我添加了自己的答案。Palehorse 的逻辑没问题，但大数据集的效率可能会很差。

```
DELETE FROM some_child_table sct 
 WHERE exists (SELECT FROM some_Table st 
                WHERE sct.some_fk_fiel=st.some_id);

DELETE FROM some_table; 
```

如果您在列上有索引并且数据集大于几条记录，则速度会更快。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2019-12-09T05:39:34.483

是的，正如其他人所说，没有方便的'DELETE FROM my_table ... CASCADE'（或等效）。要删除非级联外键保护的子记录及其引用的祖先，您的选项包括：

*   明确地执行所有删除，一次一个查询，从子表开始（尽管如果你有循环引用，这不会飞）；或者
*   在单个（可能是大量的）查询中显式执行所有删除；或者
*   假设您的非级联外键约束被创建为“ON DELETE NO ACTION DEFERRABLE”，则在单个事务中显式执行所有删除；或者
*   暂时删除图中的“无操作”和“限制”外键约束，将它们重新创建为 CASCADE，删除有问题的祖先，再次删除外键约束，最后按原样重新创建它们（从而暂时削弱您的数据）；或者
*   可能同样有趣的东西。

我认为，故意规避外键约束并不方便；但我确实理解为什么在特定情况下你想这样做。如果这是您经常做的事情，并且如果您愿意在任何地方都蔑视 DBA 的智慧，那么您可能希望通过一个过程来自动化它。

几个月前，我来到这里寻找“CASCADE DELETE just once”问题的答案（最初是在十多年前提出的！）。我从 Joe Love 的巧妙解决方案（以及 Thomas CG de Vilhena 的变体）中获得了一些成果，但最终我的用例有特殊要求（例如处理表内循环引用），这迫使我采取了不同的方法。这种方法最终变成了[recursively_delete](https://github.com/trlorenz/PG-recursively_delete) (PG 10.10)。

我在生产中使用 recursively_delete 已经有一段时间了，现在，终于（谨慎地）有足够的信心将它提供给可能会在这里寻找想法的其他人。与 Joe Love 的解决方案一样，它允许您删除整个数据图，就好像您的数据库中的所有外键约束都暂时设置为 CASCADE，但它提供了一些附加功能：

*   提供删除目标及其依赖图的 ASCII 预览。
*   使用递归 CTE 在单个查询中执行删除。
*   处理循环依赖、表内和表间。
*   处理复合键。
*   跳过“设置默认值”和“设置空值”约束。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-05-11T14:17:24.680

您可以使用它来自动执行此操作，您可以使用定义外键约束`ON DELETE CASCADE`。
我引用了[外键约束手册](http://www.postgresql.org/docs/current/interactive/ddl-constraints.html#DDL-CONSTRAINTS-FK)：

> `CASCADE`指定当引用的行被删除时，引用它的行也应该被自动删除。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-06-13T16:49:17.973

我接受了 Joe Love 的回答，并使用`IN`带有子选择的运算符重写了它，而不是`=`使函数更快（根据 Hubbitus 的建议）：

```
create or replace function delete_cascade(p_schema varchar, p_table varchar, p_keys varchar, p_subquery varchar default null, p_foreign_keys varchar[] default array[]::varchar[])
 returns integer as $$
declare

    rx record;
    rd record;
    v_sql varchar;
    v_subquery varchar;
    v_primary_key varchar;
    v_foreign_key varchar;
    v_rows integer;
    recnum integer;

begin

    recnum := 0;
    select ccu.column_name into v_primary_key
        from
        information_schema.table_constraints  tc
        join information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name and ccu.constraint_schema=tc.constraint_schema
        and tc.constraint_type='PRIMARY KEY'
        and tc.table_name=p_table
        and tc.table_schema=p_schema;

    for rx in (
        select kcu.table_name as foreign_table_name, 
        kcu.column_name as foreign_column_name, 
        kcu.table_schema foreign_table_schema,
        kcu2.column_name as foreign_table_primary_key
        from information_schema.constraint_column_usage ccu
        join information_schema.table_constraints tc on tc.constraint_name=ccu.constraint_name and tc.constraint_catalog=ccu.constraint_catalog and ccu.constraint_schema=ccu.constraint_schema 
        join information_schema.key_column_usage kcu on kcu.constraint_name=ccu.constraint_name and kcu.constraint_catalog=ccu.constraint_catalog and kcu.constraint_schema=ccu.constraint_schema
        join information_schema.table_constraints tc2 on tc2.table_name=kcu.table_name and tc2.table_schema=kcu.table_schema
        join information_schema.key_column_usage kcu2 on kcu2.constraint_name=tc2.constraint_name and kcu2.constraint_catalog=tc2.constraint_catalog and kcu2.constraint_schema=tc2.constraint_schema
        where ccu.table_name=p_table  and ccu.table_schema=p_schema
        and TC.CONSTRAINT_TYPE='FOREIGN KEY'
        and tc2.constraint_type='PRIMARY KEY'
)
    loop
        v_foreign_key := rx.foreign_table_schema||'.'||rx.foreign_table_name||'.'||rx.foreign_column_name;
        v_subquery := 'select "'||rx.foreign_table_primary_key||'" as key from '||rx.foreign_table_schema||'."'||rx.foreign_table_name||'"
             where "'||rx.foreign_column_name||'"in('||coalesce(p_keys, p_subquery)||') for update';
        if p_foreign_keys @> ARRAY[v_foreign_key] then
            --raise notice 'circular recursion detected';
        else
            p_foreign_keys := array_append(p_foreign_keys, v_foreign_key);
            recnum:= recnum + delete_cascade(rx.foreign_table_schema, rx.foreign_table_name, null, v_subquery, p_foreign_keys);
            p_foreign_keys := array_remove(p_foreign_keys, v_foreign_key);
        end if;
    end loop;

    begin
        if (coalesce(p_keys, p_subquery) <> '') then
            v_sql := 'delete from '||p_schema||'."'||p_table||'" where "'||v_primary_key||'"in('||coalesce(p_keys, p_subquery)||')';
            --raise notice '%',v_sql;
            execute v_sql;
            get diagnostics v_rows = row_count;
            recnum := recnum + v_rows;
        end if;
        exception when others then recnum=0;
    end;

    return recnum;

end;
$$
language PLPGSQL; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T19:49:55.380

带有级联选项的删除仅适用于定义了外键的表。如果您执行删除，并且它说您不能，因为它会违反外键约束，级联将导致它删除有问题的行。

如果要以这种方式删除关联的行，则需要先定义外键。另外，请记住，除非您明确指示它开始事务，或者您更改默认值，否则它将执行自动提交，这可能非常耗时。

# java - 为什么接口中没有静态方法，但静态字段和内部类可以？[Java8 之前]

> ID：129267
> 
> 赞同：92
> 
> 时间：2008-09-24T19:19:27.520
> 
> 标签：java, interface, jls

这里有一些关于为什么不能在接口中定义静态方法的问题，但它们都没有解决基本的不一致性：为什么可以在接口中定义静态字段和静态内部类型，但不能定义静态方法？

静态内部类型可能不是一个公平的比较，因为这只是生成新类的语法糖，但为什么是字段而不是方法呢？

反对接口中的静态方法的一个论点是它破坏了 JVM 使用的虚拟表解析策略，但这不应该同样适用于静态字段，即编译器可以内联它吗？

一致性是我想要的，Java 应该在接口中不支持任何形式的静态，或者它应该是一致的并允许它们。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-14T18:20:17.090

已经提出了在 Java 7 的接口中允许静态方法的[官方提案。该提案是在](http://docs.google.com/Doc?docid=dfkwr6vq%5F30dtg2z9d8&hl=en)[Project Coin](http://blogs.oracle.com/darcy/entry/project_coin)下提出的。

我个人的看法是，这是一个好主意。实现上没有技术难度，是一件非常合乎逻辑、合理的事情。我希望 Project Coin 中有几个提案*永远不会*成为 Java 语言的一部分，但这是一个可以清理大量 API 的提案。例如，该类具有用于操作任何实现的[`Collections`静态方法；](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#sort(java.util.List))`List`这些可以包含在`List`界面中。

* * *

*更新：*在[Java Posse Podcast #234 中，](http://javaposse.com/index.php?post_id=442910) Joe D'arcy 简要地提到了该提案，称它“复杂”并且可能不会在 Project Coin 中实现。

* * *

*更新：*虽然他们没有进入 Java 7 的 Project Coin，但 Java 8 确实支持[接口中的静态函数。](http://hg.openjdk.java.net/lambda/lambda/langtools/rev/67030038d40b)

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-25T20:11:09.650

我将使用我的宠物理论，即在这种情况下缺乏一致性是方便而不是设计或必要性的问题，因为我没有听到任何令人信服的论据表明它是这两者中的任何一个.

存在静态字段 (a) 因为它们在 JDK 1.0 中就存在，并且在 JDK 1.0 中做出了许多狡猾的决定，并且 (b) 接口中的静态最终字段是 Java 在当时最接近常量的东西。

允许使用接口中的静态内部类，因为那是纯粹的语法糖——内部类实际上与父类没有任何关系。

所以静态方法是不允许的，因为没有令人信服的理由这样做；一致性不足以改变现状。

当然，这可以在未来的 JLS 版本中被允许，而不会破坏任何东西。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-24T20:58:35.287

在接口中声明静态方法是没有意义的。它们不能通过正常调用 MyInterface.staticMethod() 来执行。（编辑：由于最后一句话让一些人感到困惑，调用 MyClass.staticMethod() 精确地执行了 MyClass 上的 staticMethod 的实现，如果 MyClass 是一个接口则不存在！）如果你通过指定实现类来调用它们 MyImplementor.staticMethod()那么你必须知道实际的类，所以接口是否包含它是无关紧要的。

更重要的是，静态方法永远不会被覆盖，如果你尝试这样做：

```
MyInterface var = new MyImplementingClass();
var.staticMethod(); 
```

static 的规则说必须执行在声明的 var 类型中定义的方法。因为这是一个接口，所以这是不可能的。

当然，您始终可以从方法中删除 static 关键字。一切都会好起来的。如果从实例方法调用它，您可能必须禁止显示一些警告。

要回答下面的一些评论，您无法执行“result=MyInterface.staticMethod()”的原因是它必须执行 MyInterface 中定义的方法版本。但是在 MyInterface 中不能定义一个版本，因为它是一个接口。它没有定义的代码。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T21:31:43.863

接口的目的是在不提供实现的情况下定义契约。因此，您不能拥有静态方法，因为它们必须在接口中已经有一个实现，因为您不能覆盖静态方法。至于字段，只`final fields`允许静态，本质上是常量（在 1.5+ 中，您还可以在接口中使用枚举）。常量用于帮助定义没有幻数的接口。

顺便说一句，不需要为`static final`接口中的字段显式指定修饰符，因为只允许静态最终字段。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-04-11T21:33:50.400

这是一个旧线程，但这对所有人来说都是非常重要的问题。因为我今天才注意到这一点，所以我试图以更简洁的方式解释它：

接口的主要目的是提供一些无法实现的东西，所以如果他们提供

> 允许使用静态方法

*然后您可以使用interfaceName.staticMethodName()*调用该方法，但这是未实现的方法并且不包含任何内容。所以允许静态方法是没有用的。因此他们根本不提供这个。

> 允许使用静态字段

因为字段是不可实现的，所以可实现的意思是你不能在字段中执行任何逻辑操作，你可以在字段上进行操作。因此，您不会改变字段的行为，这就是允许它们的原因。

> 允许内部类

内部类是允许的，因为在编译后创建了内部类的不同类文件，比如**InterfaceName$InnerClassName.class**，所以基本上你是在不同的实体中提供实现，而不是在接口中。因此提供了内部类中的实现。

我希望这会有所帮助。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T21:12:35.797

在 Java 5 之前，静态字段的常见用法是：

```
interface HtmlConstants {
    static String OPEN = "<";
    static String SLASH_OPEN = "</";
    static String CLOSE = ">";
    static String SLASH_CLOSE = " />";
    static String HTML = "html";
    static String BODY = "body";
    ...
}

public class HtmlBuilder implements HtmlConstants { // implements ?!?
    public String buildHtml() {
       StringBuffer sb = new StringBuffer();
       sb.append(OPEN).append(HTML).append(CLOSE);
       sb.append(OPEN).append(BODY).append(CLOSE);
       ...
       sb.append(SLASH_OPEN).append(BODY).append(CLOSE);
       sb.append(SLASH_OPEN).append(HTML).append(CLOSE);
       return sb.toString();
    }
} 
```

这意味着*HtmlBuilder*不必限定每个常量，因此它可以使用*OPEN*而不是*HtmlConstants.OPEN*

***以这种方式使用工具最终会令人困惑。***

现在有了 Java 5，我们有了*import static*语法来达到同样的效果：

```
private final class HtmlConstants {
    ...
    private HtmlConstants() { /* empty */ }
}

import static HtmlConstants.*;
public class HtmlBuilder { // no longer uses implements
    ...
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-28T19:43:21.740

实际上，有时有人可以从静态方法中受益。它们可以用作实现接口的类的工厂方法。例如，这就是我们现在在 openjdk 中有 Collection 接口和 Collections 类的原因。所以总是有一些解决方法——为另一个类提供一个私有构造函数，它将作为静态方法的“命名空间”。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-05-13T12:01:54.940

没有真正的理由在接口中没有静态方法，除了：Java 语言设计者不希望这样。从技术角度来看，允许它们是有意义的。毕竟抽象类也可以拥有它们。我假设但没有测试它，您可以在接口具有静态方法的情况下“手工制作”字节代码，并且它应该可以毫无问题地调用该方法和/或像往常一样使用接口。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-19T17:02:43.147

我经常想知道为什么要使用静态方法？它们确实有其用途，但包/命名空间级别的方法可能会涵盖 80 种静态方法的用途。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T19:25:51.030

两个主要原因浮现在脑海：

1.  Java 中的静态方法不能被子类覆盖，这对方法来说比静态字段更重要。在实践中，我什至从不想覆盖子类中的字段，但我一直都在覆盖方法。因此，拥有静态方法会阻止实现接口的类提供它自己的该方法的实现，这在很大程度上违背了使用接口的目的。

2.  接口不应该有代码；这就是抽象类的用途。接口的全部意义在于让您谈论可能不相关的对象，这些对象碰巧都有一组特定的方法。实际上，提供这些方法的实现超出了接口的预期范围。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T17:30:52.330

静态方法绑定到一个类。在 Java 中，接口在技术上不是一个类，它是一个类型，但不是一个类（因此，关键字 implements，接口不扩展 Object）。因为接口不是类，所以它们不能有静态方法，因为没有要附加的实际类。

您可以调用InterfaceName.class 来获取接口对应的Class Object，但Class 类明确表示它代表Java 应用程序中的类和接口。但是，接口本身不被视为一个类，因此您不能附加静态方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T19:26:04.493

只能在接口中声明静态最终字段（很像方法，即使您不包含“public”关键字也是公共的，静态字段在有或没有关键字的情况下都是“final”）。

这些只是值，在编译时无论在何处使用它们都会被逐字复制，因此您永远不会在运行时真正“调用”静态字段。拥有静态方法不会具有相同的语义，因为它会涉及调用没有实现的接口，这是 Java 不允许的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T04:39:23.630

原因是接口中定义的所有方法都是抽象的，无论您是否显式声明该修饰符。抽象静态方法不是修饰符的允许组合，因为静态方法不能被覆盖。

至于为什么接口允许静态字段。我有一种感觉，应该被视为“功能”。我能想到的唯一可能性是将接口的实现感兴趣的常量分组。

我同意一致性会是一种更好的方法。接口中不允许有静态成员。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-06-17T09:37:12.267

我相信可以在不创建对象的情况下访问静态方法，并且接口不允许创建对象，以限制程序员直接使用接口方法而不是使用其实现的类。但是如果你在一个接口中定义了一个静态方法，你可以直接访问它而不需要它的实现。因此，接口中不允许使用静态方法。我不认为一致性应该是一个问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-10-10T11:20:54.507

Java 1.8 接口静态方法仅对接口方法可见，如果我们从 InterfaceExample 类中删除 methodSta1() 方法，我们将无法将它用于 InterfaceExample 对象。然而，像其他静态方法一样，我们可以使用类名来使用接口静态方法。例如，一个有效的语句将是：exp1.methodSta1();

所以看了下面的例子我们可以说：1）Java接口静态方法是接口的一部分，我们不能将它用于实现类对象。

2) Java 接口静态方法有利于提供实用方法，例如空值检查、集合排序、日志等。

3）Java接口静态方法通过不允许实现类（InterfaceExample）覆盖它们来帮助我们提供安全性。

4）我们不能为Object类方法定义接口静态方法，我们会得到编译器错误“这个静态方法不能从Object隐藏实例方法”。这是因为它在 java 中是不允许的，因为 Object 是所有类的基类，我们不能拥有一个类级别的静态方法和另一个具有相同签名的实例方法。

5）我们可以使用java接口的静态方法去除Collections等实用类，并将其所有的静态方法移到对应的接口中，方便查找和使用。

```
public class InterfaceExample implements exp1 {

    @Override
    public void method() {
        System.out.println("From method()");
    }

    public static void main(String[] args) {
        new InterfaceExample().method2();
        InterfaceExample.methodSta2();      //  <---------------------------    would not compile
        // methodSta1();                        //  <---------------------------    would not compile
        exp1.methodSta1();
    }

    static void methodSta2() {          //          <-- it compile successfully but it can't be overridden in child classes
        System.out.println("========= InterfaceExample :: from methodSta2() ======");
    }
}

interface exp1 {

    void method();
    //protected void method1();         //          <--      error
    //private void method2();           //          <--      error
    //static void methodSta1();         //          <--      error it require body in java 1.8

    static void methodSta1() {          //          <-- it compile successfully but it can't be overridden in child classes
        System.out.println("========= exp1:: from methodSta1() ======");
    }

    static void methodSta2() {          //          <-- it compile successfully but it can't be overridden in child classes
        System.out.println("========= exp1:: from methodSta2() ======");
    }

    default void method2() { System.out.println("---  exp1:: from method2() ---");}
    //synchronized default void method3() { System.out.println("---");}             // <-- Illegal modifier for the interface method method3; only public, abstract, default, static 
                                                                                // and strictfp are permitted
    //final default void method3() { System.out.println("---");} //             <--      error
} 
```

# c# - 您如何确定给定的类型（System.Type）是否继承自特定的基类（在 .Net 中）？

> ID：129277
> 
> 赞同：25
> 
> 时间：2008-09-24T19:21:39.747
> 
> 标签：c#, .net, reflection, inheritance

这可能是一个简单的答案，我只是遗漏了一些东西，但是这里......如果我有一个类型，（即，一个实际的 System.Type......不是一个实例）我如何判断是否它继承自另一个特定的基本类型？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-24T19:24:59.177

使用[System.Type](http://msdn.microsoft.com/en-us/library/system.type_members.aspx)类的[IsSubclassOf](http://msdn.microsoft.com/en-us/library/system.type.issubclassof.aspx)方法。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-30T17:26:30.453

`Type.IsSubTypeOf()`在and之间需要澄清的一件事`Type.IsAssignableFrom()`：

*   `IsSubType()``true`仅当给定类型派生自指定类型时才会返回。`false`如果给定类型**是**指定类型，它将返回 。

*   `IsAssignableFrom()``true`如果给定类型是指定类型或派生自指定类型，则将返回。

因此，如果您使用这些来比较`BaseClass`and `DerivedClass`（继承自`BaseClass`），那么：

```
BaseClassInstance.GetType.IsSubTypeOf(GetType(BaseClass)) = FALSE
BaseClassInstance.GetType.IsAssignableFrom(GetType(BaseClass)) = TRUE

DerivedClassInstance.GetType.IsSubTypeOf(GetType(BaseClass)) = TRUE
DerivedClassInstance.GetType.IsAssignableFrom(GetType(BaseClass)) = TRUE 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-24T19:24:05.357

编辑：请注意，如果您要查找的基本类型是接口，则上述解决方案将失败。以下解决方案适用于任何类型的继承，无论是类还是接口。

```
// Returns true if "type" inherits from "baseType"
public static bool Inherits(Type type, Type baseType) {
    return baseType.IsAssignableFrom(type)
} 
```

[（半） MSDN](http://msdn.microsoft.com/en-us/library/system.type.isassignablefrom.aspx)文章的有用摘录：

如果 [参数] 和当前 Type 表示相同的类型，或者如果当前 Type 在 [参数] 的继承层次结构中，或者如果当前 Type 是 [参数] 实现的接口，或者如果 [the argument] 是泛型类型参数，当前 Type 表示 [the argument] 的约束之一。如果这些条件都不为真，或者 [参数] 为空引用（在 Visual Basic 中为 Nothing），则为 false。

# model-view-controller - MVC模型设计/继承

> ID：129283
> 
> 赞同：1
> 
> 时间：2008-09-24T19:22:17.687
> 
> 标签：model-view-controller, oop, class, inheritance, model

原谅这个模糊的标题，我不知道如何描述它。

如果您有一个通用模型“存档”，您如何根据用户选择的“类型”显示不同的视图/表单？

例如，用户创建一个新的“存档”，然后选择视频、书籍、音频等。从那里他们根据存档类型获得不同的形式。

还是将它们分成不同的模型会更好——视频、书籍、音频？

或者模型可以继承（如视频扩展存档）。我想这是基本的 OOP / 类，但不知道如何在这里应用它。

欢迎来自任何 MVC 框架的示例！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T19:23:59.570

您的模型 Video、Book 和 Audio 可以从 Archive 继承。

每个模型都会有一个控制器。

[http://yourserver/Books/Edit/11](http://yourserver/Books/Edit/11)

在创建相应的模型之前，您必须让您的用户选择他们想要的存档类型。

编辑（回应评论）

在 ASP.NET MVC 中，您的模型将是一个类。

```
public class Video : Archive
{  
    public int Id {get;set}
    public string Name {get;set;}     
    ...
} 
```

您还将拥有一个控制器

```
public class VideoController : Controller
{
    public object Edit(int id)
    {
        Video myVideo = GetVideo(id);
        return View("Edit", myVideo);
    }
     ...
} 
```

例如，您将在 Views 目录中有一个视图，该页面包含

```
public class Edit : View<Video>
{
    ...
} 
```

所以如果你有一个 URL，你可以调用它

[http://localhost/视频/编辑/11](http://localhost/Video/Edit/11)

这一切都是从记忆中完成的，因此可能会有一些错误，但带回家的信息是您在模型中指定了继承。模型只是一个类。在您的情况下，您想从存档继承。完成后，模型将正常传递。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T19:31:42.903

在任何 MVC 框架中实际显示不同的视图应该很容易。例如，在 Microsoft ASP.NET MVC 中，您不会只从控制器返回视图，如下所示：

```
return View(); 
```

但实际上会将视图的名称作为参数声明：

```
return View("VideoArchive"); 
```

然后将显示来自 Views/Archive/VideoArchive.aspx 的视图

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T19:40:59.607

似乎您不想让类型从存档继承。“总是倾向于封装/包含而不是继承”。

为什么不创建一个名为 Archive 的类并给它一个类型属性。该类型可以使用继承来专门用于音频、视频等。

看起来您会根据其他一些标准专门化存档。“FileSystemArchivce”、“XMLArchive”、“SQLArchive”和类型不会改变。但是我的敏捷主义者说，一开始这可能不是必需的，你以后总是可以重构设计......

就控制器而言，通过封装视图中每种类型的表示差异，您可能会获得最大的收益。所以只有视图会根据类型而变化。每个类型的语义和规则很可能是相同的，并且您不需要为每种类型设置单独的控制器。每种类型的视图都不同，因为它具有不同的属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T05:28:29.803

[单一职责原则](http://www.objectmentor.com/resources/articles/srp.pdf)( PDF) 指出：

> 改变班级的理由不应该不止一个。

您的 Archive 类通过处理多种不同类型的档案违反了这一原则。例如，如果您需要更新视频存档，那么您也在修改处理书籍和音频存档的类。

处理此问题的适当方法是为每种不同类型的存档创建单独的类。这些类型应该实现一个公共接口（或继承一个公共基类），以便它们可以被只关心档案而不是特定档案类型的代码互换（多态）处理。

一旦你有了那个类层次结构，你只需要一个控制器和每个模型类的视图。

对于加分点，单一职责原则甚至可以证明使用工厂方法或抽象工厂来创建模型、视图和控制器对象（而不是内联新建它们）是合理的。毕竟，创建对象和使用该对象是不同的职责，可能出于不同的原因需要对其进行更改。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:31:36.040

在我看来，支持 MVC 的一个坚实点是，如果所有用户需要不同的视图，您可能不需要自定义模型（或控制器 - 您只想要一个）。仅当存储（持久性）架构要求需要时，才会出现多个模型。如果您需要多个模型，某些功能（如数据访问对象 (DAO)）可能会在控制器和模型之间显示为另一层。

查看[Apache Struts](http://struts.apache.org/)项目中的示例。正如*Struts for Newbies*中所述，“要很好地使用 Struts，重要的是要很好地掌握基础知识。从复习[关键技术入门](http://struts.apache.org/primer.html)书开始，并研究任何不熟悉的主题。”

有关其他资源，请参阅[Web 层应用程序框架设计](http://java.sun.com/blueprints/guidelines/designing_enterprise_applications_2e/web-tier/web-tier5.html)（Sun J2EE 蓝图）

# c# - 可以在 C# 中动态添加属性吗？

> ID：129285
> 
> 赞同：149
> 
> 时间：2008-09-24T19:22:20.867
> 
> 标签：c#, .net, attributes

是否可以在运行时添加属性或在运行时更改属性的值？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-24T19:35:44.017

这实际上取决于您要完成的工作。

[System.ComponentModel.TypeDescriptor](http://msdn.microsoft.com/en-us/library/system.componentmodel.typedescriptor.aspx)东西可用于向类型、属性和对象实例添加属性，但它的限制是您也必须使用它来检索这些属性。如果您正在编写使用这些属性的代码，并且您可以生活在这些限制内，那么我肯定会建议您这样做。

据我所知，PropertyGrid 控件和 Visual Studio 设计图面是 BCL 中唯一消耗 TypeDescriptor 内容的东西。事实上，这就是他们真正需要做的大约一半事情的方式。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2008-09-24T19:31:42.857

属性是静态元数据。程序集、模块、类型、成员、参数和返回值不是 C# 中的第一类对象（例如，`System.Type`类只是类型的反映表示）。您可以获取类型的属性实例并更改属性（如果它们是可写的），但这不会影响属性，因为它应用于类型。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-24T19:31:10.737

你不能。一种解决方法可能是在运行时生成派生类并添加属性，尽管这可能有点矫枉过正。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-24T19:37:38.287

好吧，只是为了与众不同，我发现一篇文章引用了使用 Reflection.Emit 来做到这一点。

这是链接： http: [//www.codeproject.com/KB/cs/dotnetattributes.aspx](http://www.codeproject.com/KB/cs/dotnetattributes.aspx)，您还需要查看文章底部的一些评论，因为讨论了可能的方法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T19:28:22.990

不，这不对。

属性是元数据，并以二进制形式存储在已编译的程序集中（这也是您只能在其中使用简单类型的原因）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T19:27:18.517

我不相信。即使我错了，您最好的希望是将它们添加到整个类型中，而不是类型的*实例*。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T19:31:50.080

如果您需要能够动态添加的东西，c# 属性不是办法。研究将数据存储在 xml 中。我最近做了一个项目，我开始使用属性，但最终转向使用 xml 的序列化。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-24T19:32:12.903

为什么需要？属性为反射提供了额外的信息，但如果您从外部知道您想要哪些属性，则不需要它们。

您可以在数据库或资源文件中相对轻松地在外部存储元数据。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-09-08T13:35:49.457

就像 Deczaloth 在下面的评论中提到的那样，我认为元数据在编译时是固定的。我通过创建一个动态对象来实现它，在该对象中我覆盖 GetType() 或使用 GetCustomType() 并编写我自己的类型。使用它，您可以...

我非常努力地使用 System.ComponentModel.TypeDescriptor 没有成功。这并不意味着它不能工作，但我想看看代码。

在对应部分，我想更改一些属性值。为此，我做了 2 个可以正常工作的功能。

```
 // ************************************************************************
        public static void SetObjectPropertyDescription(this Type typeOfObject, string propertyName,  string description)
        {
            PropertyDescriptor pd = TypeDescriptor.GetProperties(typeOfObject)[propertyName];
            var att = pd.Attributes[typeof(DescriptionAttribute)] as DescriptionAttribute;
            if (att != null)
            {
                var fieldDescription = att.GetType().GetField("description", BindingFlags.NonPublic | BindingFlags.Instance);
                if (fieldDescription != null)
                {
                    fieldDescription.SetValue(att, description);
                }
            }
        }

        // ************************************************************************
        public static void SetPropertyAttributReadOnly(this Type typeOfObject, string propertyName, bool isReadOnly)
        {
            PropertyDescriptor pd = TypeDescriptor.GetProperties(typeOfObject)[propertyName];
            var att = pd.Attributes[typeof(ReadOnlyAttribute)] as ReadOnlyAttribute;
            if (att != null)
            {
                var fieldDescription = att.GetType().GetField("isReadOnly", BindingFlags.NonPublic | BindingFlags.Instance);
                if (fieldDescription != null)
                {
                    fieldDescription.SetValue(att, isReadOnly);
                }
            }
        } 
```

* * *

## 回答 #10

> 赞同：-9
> 
> 时间：2008-09-24T19:45:34.760

在 Java 中，我曾经通过使用映射和实现我自己的键值编码来解决这个问题。

[http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/KeyValueCoding.html](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/KeyValueCoding.html)

# linux - 连接外接显示器时自动调整 X11 显示器的大小

> ID：129297
> 
> 赞同：4
> 
> 时间：2008-09-24T19:24:52.657
> 
> 标签：linux, ubuntu, x11, xrandr

我有一台运行 Ubuntu 的笔记本电脑，当我在办公室时，我连接了一个外接显示器。通常这需要我运行`xrandr --auto`以便笔记本电脑重新调整显示器大小以匹配外接显示器。如果这可以自动完成，或者在连接显示器时触发，那就太好了，但是`xrandr --auto`当笔记本电脑从挂起/休眠状态唤醒时实际运行就足够了。

我创建了一个`/etc/pm/sleep.d/00xrandr.sh`包含该行的脚本

```
xrandr --auto 
```

但这失败了，因为脚本无权访问 X 显示。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:36:10.630

我猜问题是脚本以 root 身份运行，无法访问您的 xauth 数据。根据您的设置，这样的事情可能会起作用：

```
xauth merge /home/your_username/.Xauthority
export DISPLAY=:0.0
xrandr --auto 
```

如果需要，您可以使用更聪明的方法来找出需要从哪个用户提取 xauth 数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T19:58:38.503

您是否尝试过正确设置脚本中的 DISPLAY 变量并使用 xhost + localhost 授予其他用户对您的 DISPLAY 的访问权限？不知道这是否有帮助，但值得一试。

# .net - 忽略导出到 Excel 的 RDLC 子报表

> ID：129301
> 
> 赞同：1
> 
> 时间：2008-09-24T19:25:33.043
> 
> 标签：.net, rdlc

我有一个 RDLC 报告，它有一个表格，调用一个子报告 N 次。这在控制查看器和导出为 PDF 时完美运行。然而，当我导出到 Excel 时，出现以下错误：

> 表格/矩阵单元格中的子报表将被忽略。

有谁知道为什么这只发生在 Excel 导出中？有没有解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T03:31:47.373

请参阅下面的 MSDN 论坛链接...看起来这在 2000/2005 中不受支持，但似乎也有一些 kludgey 解决方法（嵌套列表）。Microsoft 版主声称 Reporting Services 2008 将导出所有内容。

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1520229&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1520229&SiteID=1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-30T11:28:01.343

从 rdlc 中删除表格控件并将您的主报表数据放入矩阵控件并将您的子报表放在下面的 maix 控件中。运行您的报告并再次导出。它将解决。

# .net - How to write the content of one stream into another stream in .net?

> ID：129305
> 
> 赞同：41
> 
> 时间：2008-09-24T19:25:54.057
> 
> 标签：.net, stream

I often run into the problem that I have one stream full of data and want to write everything of it into another stream.

All code-examples out there use a buffer in form of a byte-array.

Is there a more elegant way to this?

If not, what's the ideal size of the buffer. Which factors make up this value?

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-10-22T17:31:42.373

In .NET 4.0 we finally got a [`Stream.CopyTo`](http://msdn.microsoft.com/en-us/library/system.io.stream.copyto(v=vs.110).aspx) method! Yay!

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-24T19:28:11.383

Regarding the ideal buffer size:

"When using the Read method, it is more efficient to use a buffer that is the same size as the internal buffer of the stream, where the internal buffer is set to your desired block size, and to always read less than the block size. If the size of the internal buffer was unspecified when the stream was constructed, its default size is 4 kilobytes (4096 bytes)."

Any stream-reading process will use Read(char buffer[], int index, count), which is the method this quote refers to.

[http://msdn.microsoft.com/en-us/library/9kstw824.aspx](http://msdn.microsoft.com/en-us/library/9kstw824.aspx) (Under "Remarks").

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T19:32:10.703

I'm not sure if you can directly pipe one stream to another in .NET, but here's a method to do it with an intermediate byte buffer. The size of the buffer is arbitrary. The most efficient size will depend mostly on how much data you're transferring.

```
static void CopyStream(Stream input, Stream output){
    byte[] buffer = new byte[0x1000];
    int read;
    while ((read = input.Read(buffer, 0, buffer.Length)) > 0) 
        output.Write(buffer, 0, read);
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-05-19T16:34:17.133

BufferedStream.CopyTo(Stream)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T19:28:28.373

[Read data in FileStream into a generic Stream](https://stackoverflow.com/questions/129171/read-data-in-filestream-into-a-generic-stream)

will probably have some directions to go in

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T11:22:09.333

I'm not aware of a more elegant way, than using a buffer.

But the size of a buffer can make a difference. Remember the issues about Vista's File Copy? It's reason was (basically) changing the buffer size. The changes are explained in [this blogpost](http://blogs.technet.com/markrussinovich/archive/2008/02/04/2826167.aspx). You can learn the main factors from that post. However, this only applies for file copying. In applications probably you do a lot of memory copies, so in that case, the 4KB could be the best buffer size, [as recommended by the .NET documentation](http://msdn.microsoft.com/en-us/library/9kstw824.aspx).

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-24T23:12:42.923

As some people have suggested, `CopyTo` and `CopyToAsync` should do the job. Here is an example of a TCP server that listens for external connections on port `30303` and pipes them with local port `8085` (written in .NET 5). Most streams should work the same, just pay attention if they are bi-directional or single-direction.

```
using System.Net;
using System.Net.Sockets;
using System.Threading.Tasks;

namespace ConsoleApp1
{
    class Program
    {
        static async Task Main(string[] args)
        {
            var externalConnectionListener = new TcpListener(IPAddress.Any, 30303);
            externalConnectionListener.Start();

            while (true)
            {
                var externalConnection = await externalConnectionListener.AcceptTcpClientAsync().ConfigureAwait(false);

                _ = Task.Factory.StartNew(async () =>
                  {
                      using NetworkStream externalConnectionStream = externalConnection.GetStream();
                      using TcpClient internalConnection = new TcpClient("127.0.0.1", 8085);
                      using NetworkStream internalConnectionStream = internalConnection.GetStream();

                      await Task.WhenAny(
                                externalConnectionStream.CopyToAsync(internalConnectionStream),
                                internalConnectionStream.CopyToAsync(externalConnectionStream)).ConfigureAwait(false);

                  });

            }
        }
    }
} 
```

# internet-explorer - 用于浏览器兼容性测试的opera、IE、firefox、chrome、safari 等浏览器功能/插件有哪些？

> ID：129310
> 
> 赞同：2
> 
> 时间：2008-09-24T19:26:41.233
> 
> 标签：internet-explorer, firefox, safari, google-chrome, opera

我使用适用于 Firefox的[Nightly Tester Tools和适用于 IE 的](https://addons.mozilla.org/en-US/firefox/addon/6543)[Fiddler](http://fiddlertool.com/fiddler/)。你用什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T14:22:49.370

Firefox 的 Web 开发工具栏、IE 的 Visual Studio JIT 调试器和 Chrome 的资源检查器。由于上述工具，我们不使用 Opera 进行调试，但我们确实查看了我们的东西以确保它在 Opera 中看起来正确，以确保安全。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T19:50:11.830

一个很好的问题。我以前从来没有考虑过。我们使用大量自定义配置浏览器测试我们的网站。这是不同开发人员的浏览器。不均匀的是程序。

我们只有 2 个插件遇到的问题：Adblock 和 FlashBlock

我也会测试 NoScript。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T13:01:33.110

Opera 有 Dragonfly（工具 → 高级 → 开发工具）。

我喜欢将[鼠标悬停在 DOM 检查](http://slayeroffice.com/?c=/content/tools/modi.html)器上——它简单、快速且跨浏览器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T14:08:24.943

在歌剧中

> 视图 > 样式

所有这些不同的小选择（例如大纲、类和 ID 等）对于确定 DIV 和 SPAN 的浮动和边框约束、元素的类和 ID 名称以及切换回调整代码有很大帮助快多了。

`CTRL+SHIFT+ALT+U`将当前页面加载到 W3C 验证器的快捷方式（在 v9 中）也很漂亮。

# windows - Windows (Vista)：在程序快捷方式上设置进程优先级

> ID：129312
> 
> 赞同：4
> 
> 时间：2008-09-24T19:26:55.473
> 
> 标签：windows, performance, itunes

有没有办法用快捷方式启动程序，设置该程序的进程优先级？

iTunes 正在拖我的系统到它的膝盖，但是当我将进程优先级设置为“低”时，不知何故，就像魔术一样，Windows 恢复到正常的响应自我:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T19:28:19.543

你每天学习新的东西。

我的回答是错误的，但由于它被标记为接受，我正在编辑是正确的。

将您的快捷方式更改为指向：

```
start /BELOWNORMAL iTunes.exe 
```

而不仅仅是 iTunes.exe

# asp.net - 您如何处理 Web 应用程序中的附件？

> ID：129328
> 
> 赞同：3
> 
> 时间：2008-09-24T19:29:01.413
> 
> 标签：asp.net, file

由于缺乏对我最初的[问题](https://stackoverflow.com/questions/124258/how-would-you-allow-users-to-edit-attachments-in-a-web-application)的回应，可能是由于我的措辞不佳。从那时起，我考虑了我最初的问题并决定改写它，希望变得更好！:)

我们为客户创建定制业务软件，并且他们经常希望将附件添加到某些业务实体。例如，他们希望将 Word 文档附加到客户，或将图像附加到工作。我很好奇其他人如何处理以下内容：

*   用户如何附加文件？单附件？批量附件？
*   你如何显示附加的文件？简单的清单？详细清单？
*   杀手问题是，用户如何编辑附加文档？这在网络环境中甚至可能吗？授予用户只能查看附件。
*   是否有一个好的控制库来帮助管理这个过程？

我们当前的开发环境是 ASP.NET 和 C#，但我认为这对于开发工具来说不是一个非常不可知的问题，除非我需要在 Web 环境中工作。

似乎我们总是在与客户和在 Web 环境中处理附件时遇到问题，所以我正在寻找其他程序员在如何最好地与附件交互方面与他们的用户群取得的一些**成功。**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T19:32:36.070

*   从一个文件上传控件（“浏览按钮”）开始，如果他们想在一个批次中附加多个文件，请使用 JavaScript 动态添加更多上传控件。
*   以简单的列表格式（文件名、类型、大小、日期）显示它们，但如果需要，请在其他地方提供完整的详细信息。
*   如果他们想编辑文件，他们必须下载它们，然后重新上传。因此，您需要一种他们可以说“此附件覆盖旧附件”的方式。
*   我不熟悉 C# 和 ASP.NET，所以我不能推荐任何有帮助的库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T19:31:02.860

[http://developer.yahoo.com/yui/uploader/](http://developer.yahoo.com/yui/uploader/)

# sql-server - 乐观与悲观锁定

> ID：129329
> 
> 赞同：779
> 
> 时间：2008-09-24T19:29:05.390
> 
> 标签：sql-server, locking, optimistic-locking, pessimistic-locking

我了解乐观锁定和悲观锁定之间的区别。现在有人可以向我解释我什么时候会使用其中任何一个吗？

这个问题的答案是否会根据我是否使用存储过程来执行查询而改变？

但只是为了检查，乐观的意思是“阅读时不要锁定表格”，悲观的意思是“阅读时锁定表格”。

* * *

## 回答 #1

> 赞同：1056
> 
> 时间：2008-09-24T19:40:58.670

[乐观锁定](http://en.wikipedia.org/wiki/Optimistic_locking)是一种读取记录的策略，记下版本号（执行此操作的其他方法涉及日期、时间戳或校验和/哈希）并在写回记录之前检查版本是否未更改。当您写回记录时，您会过滤版本上的更新以确保它是原子的。（即在您检查版本并将记录写入磁盘之间尚未更新）并一键更新版本。

如果记录是脏的（即与您的不同版本），您将中止事务并且用户可以重新启动它。

此策略最适用于大容量系统和三层架构，您不必为会话维护与数据库的连接。在这种情况下，客户端实际上无法维护数据库锁，因为连接是从池中获取的，并且您可能没有使用从一次访问到下一次访问的相同连接。

[悲观锁定](http://en.wikipedia.org/wiki/Lock_(database))是指您锁定记录以供您独占使用，直到您完成它为止。它比乐观锁定具有更好的完整性，但需要您小心设计应用程序以避免[死锁](http://en.wikipedia.org/wiki/Deadlock)。要使用悲观锁定，您需要直接连接到数据库（通常在[两层客户端服务器](http://en.wikipedia.org/wiki/Client-server)应用程序中就是这种情况）或可以独立于连接使用的外部可用事务 ID。

在后一种情况下，您使用 TxID 打开事务，然后使用该 ID 重新连接。DBMS 维护锁并允许您通过 TxID 选择会话备份。这就是使用两阶段提交协议（例如[XA](http://www.opengroup.org/bookstore/catalog/c193.htm)或[COM+ 事务](http://msdn.microsoft.com/en-us/library/ms687120(VS.85).aspx)）的分布式事务的工作方式。

* * *

## 回答 #2

> 赞同：230
> 
> 时间：2008-09-24T19:37:32.470

当您不期望有很多冲突时，使用乐观锁定。进行正常操作的成本较低，但如果发生冲突，您将支付更高的价格来解决它，因为交易被中止。

当预计会发生冲突时，使用悲观锁定。违反同步的事务被简单地阻止。

要选择适当的锁定机制，您必须估计读取和写入的数量并相应地进行计划。

* * *

## 回答 #3

> 赞同：223
> 
> 时间：2019-11-20T10:23:06.643

处理冲突时，您有两种选择：

*   您可以尝试避免冲突，这就是悲观锁定的作用。
*   或者，您可以允许冲突发生，但您需要在提交事务时检测到它，这就是乐观锁定所做的。

现在，让我们考虑以下丢失更新异常：

[![丢失更新](https://i.stack.imgur.com/vCagm.png)](https://vladmihalcea.com/a-beginners-guide-to-database-locking-and-the-lost-update-phenomena/)

丢失更新异常可能发生在 Read Committed 隔离级别。

在上图中，我们可以看到 Alice 认为她可以从她那里取出 40，`account`但没有意识到 Bob 刚刚更改了账户余额，现在这个账户只剩下 20 了。

## 悲观锁定

悲观锁定通过在帐户上获取共享或读取锁定来实现此目标，因此防止 Bob 更改帐户。

[![丢失更新悲观锁定](https://i.stack.imgur.com/oybRy.png)](https://vladmihalcea.com/optimistic-vs-pessimistic-locking/)

在上图中，Alice 和 Bob 都将在`account`两个用户都读取的表行上获得一个读锁。当使用可重复读取或可序列化时，数据库会在 SQL Server 上获取这些锁。

因为 Alice 和 Bob 都读取了`account`PK 值`1`，所以在一个用户释放读取锁之前，他们都不能更改它。这是因为写操作需要获取写/独占锁，而共享/读锁防止写/独占锁。

只有在 Alice 提交了她的事务并且对该`account`行的读锁被释放后，Bob`UPDATE`才会恢复并应用更改。在 Alice 释放读锁之前，Bob 的 UPDATE 会阻塞。

## 乐观锁定

乐观锁定允许发生冲突，但在应用 Alice 的 UPDATE 时检测到它，因为版本已更改。

[![应用程序级事务](https://i.stack.imgur.com/DEdlF.png)](https://vladmihalcea.com/optimistic-vs-pessimistic-locking/)

这一次，我们有一个额外的`version`专栏。`version`每次执行 UPDATE 或 DELETE 时，该列都会递增，并且它也用于 UPDATE 和 DELETE 语句的 WHERE 子句中。为此，我们需要`version`在执行 UPDATE 或 DELETE 之前发出 SELECT 并读取当前版本，否则，我们将不知道将哪个版本值传递给 WHERE 子句或递增。

## 应用程序级事务

关系数据库系统出现在 70 年代末 80 年代初，当时客户端通常会通过终端连接到大型机。这就是为什么我们仍然看到数据库系统定义诸如 SESSION 设置之类的术语。

现在，在互联网上，我们不再在同一个数据库事务的上下文中执行读写，ACID 已经不够用了。

例如，考虑以下用例：

[![应用程序级事务和乐观锁定](https://i.stack.imgur.com/FCyHh.png)](https://vladmihalcea.com/preventing-lost-updates-in-long-conversations/)

如果没有乐观锁定，即使数据库事务使用 Serializable，也无法捕获此丢失的更新。这是因为读取和写入是在不同的 HTTP 请求中执行的，因此是在不同的数据库事务中执行的。

因此，即使在使用包含用户思考时间的应用程序级事务时，乐观锁定也可以帮助您防止丢失更新。

## 结论

乐观锁定是一种非常有用的技术，即使在使用不太严格的隔离级别（如已提交读）或在后续数据库事务中执行读取和写入时，它也能正常工作。

乐观锁定的缺点是数据访问框架会在捕获 时触发回滚`OptimisticLockException`，因此会丢失我们之前通过当前正在执行的事务所做的所有工作。

争用越多，冲突就越多，中止交易的机会就越大。回滚对数据库系统来说代价高昂，因为它需要恢复所有当前可能涉及表行和索引记录的未决更改。

因此，当冲突频繁发生时，悲观锁定可能更适合，因为它减少了回滚事务的机会。

* * *

## 回答 #4

> 赞同：95
> 
> 时间：2008-09-24T19:34:40.887

乐观假设在您阅读它时没有任何变化。

悲观主义假设某事会因此锁定它。

如果完全读取数据不是必需的，请使用乐观。您可能会得到奇怪的“脏”读 - 但它不太可能导致死锁等。

大多数 Web 应用程序都可以处理脏读——在极少数情况下，数据与下一次重新加载时的数据不完全一致。

对于精确的数据操作（如在许多金融交易中）使用悲观。准确读取数据至关重要，没有未显示的更改 - 额外的锁定开销是值得的。

哦，Microsoft SQL 服务器默认为页面锁定 - 基本上是您正在阅读的行和两边的一些。行锁定更准确但慢得多。通常值得将您的事务设置为已提交读或无锁，以避免在读取时出现死锁。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2013-04-04T08:55:03.687

当悲观锁定将是更好的选择时，我会想到另一种情况。

对于乐观锁定，数据修改的每个参与者都必须同意使用这种锁定。但是如果有人修改数据而不关心版本列，这将破坏乐观锁定的整个想法。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2016-12-08T00:24:55.077

基本上有两个最受欢迎的答案。第[一个](https://dba.stackexchange.com/a/35813/93450)基本上说

> 乐观需要一个三层架构，您不必为会话维护与数据库的连接，而悲观锁定是您锁定记录以供您独占使用，直到您完成它。它比乐观锁定具有更好的完整性，您需要直接连接到数据库。

[另一个答案是](https://dba.stackexchange.com/a/35813/93450)

> 乐观（版本控制）由于没有锁定而更快，但（悲观）锁定在争用高时表现更好，并且最好阻止工作而不是丢弃它并重新开始。

或者

> 当你有罕见的碰撞时，乐观锁定效果最好

[因为它被放在](https://stackoverflow.com/a/129380/6267925)这个页面上。

我创建了我的答案来解释“保持连接”与“低碰撞”的关系。

要了解哪种策略最适合您，请不要考虑数据库的每秒事务数，而要考虑单个事务的持续时间。通常，您打开事务，执行操作并关闭事务。这是 ANSI 考虑的一个简短的经典事务，可以很好地摆脱锁定。但是，您如何实现多个客户同时预订相同房间/座位的订票系统？

您浏览报价，在表格中填写大量可用选项和当前价格。这需要很多时间，选项可能会过时，您开始填写表格并按下“我同意”按钮之间的所有价格都无效，因为您访问的数据没有锁定，并且其他更敏捷的人干扰了更改所有价格，您需要以新价格重新开始。

相反，您可以在阅读它们时锁定所有选项。这是悲观的情景。你明白为什么它很糟糕。您的系统可能会被一个简单地开始预订并吸烟的小丑搞垮。在他完成之前，没有人可以保留任何东西。您的现金流量降至零。这就是为什么在现实中使用乐观保留。那些磨磨蹭蹭的人不得不以更高的价格重新开始预订。

在这种乐观的方法中，您必须记录您读取的所有数据（如在[我的重复读取](https://dba.stackexchange.com/questions/157193)中）并使用您的数据版本到达提交点（我想以您在此报价中显示的价格购买股票，而不是当前价格）。此时，创建了 ANSI 事务，它锁定数据库，检查是否没有任何更改并提交/中止您的操作。IMO，这是对[MVCC](https://en.wikipedia.org/wiki/Multiversion_concurrency_control)的有效模拟，它也与 Optimistic CC 相关联，并且还假设您的事务在中止的情况下重新启动，即您将进行新的预订。这里的交易涉及人类用户的决策。

我远未理解如何手动实现 MVCC，但我认为带有重启选项的长时间运行的事务是理解该主题的关键。如果我在任何地方错了，请纠正我。我的回答是受[Alex Kuznecov 章节](https://www.simple-talk.com/sql/t-sql-programming/developing-modifications-that-survive-concurrency/)的启发。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2017-07-16T07:49:28.670

在大多数情况下，乐观锁定更有效并提供更高的性能。在悲观锁定和乐观锁定之间进行选择时，请考虑以下几点：

*   如果有大量更新并且用户尝试同时更新数据的机会相对较高，则悲观锁定很有用。例如，如果每个操作一次可以更新大量记录（银行可能会在每个月末为每个账户添加利息收入），并且两个应用程序同时运行这样的操作，它们就会发生冲突.

*   悲观锁定也更适合包含经常更新的小表的应用程序。在这些所谓的热点的情况下，冲突的可能性如此之大，以至于乐观锁定浪费了回滚冲突事务的努力。

*   如果发生冲突的可能性非常低，乐观锁定很有用——记录很多但用户相对较少，或者更新很少且主要是读取类型的操作。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-03-27T16:59:50.293

乐观锁定的一个用例是让您的应用程序使用数据库来允许您的一个线程/主机“声明”一项任务。这是一种对我来说经常派上用场的技术。

我能想到的最好的例子是使用数据库实现的任务队列，多个线程同时声明任务。如果任务的状态为'Available'、'Claimed'、'Completed'，则数据库查询可以说类似“Set status='Claimed' where status='Available'。如果多个线程尝试以这种方式更改状态，除了第一个线程之外的所有线程都会因为脏数据而失败。

请注意，这是一个仅涉及乐观锁定的用例。因此，作为说“当您不期望有很多冲突时使用乐观锁定”的替代方法，它也可以用于您期望发生冲突但只希望一个事务成功的地方。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2019-10-30T04:24:06.837

上面已经说了很多关于乐观和悲观锁定的好话。需要考虑的重要一点如下：

在使用乐观锁时，我们需要注意应用程序将如何从这些故障中恢复。

特别是在异步消息驱动架构中，这可能导致消息处理乱序或更新丢失。

需要考虑故障情况。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-08-22T22:52:15.213

在更实际的情况下，更新分布式系统时，数据库中的乐观锁定可能不足以提供分布式系统所有部分所需的一致性。

例如，在 AWS 上构建的应用程序中，通常在 DB（例如 DynamoDB）和存储（例如 S3）中都有数据。如果更新涉及 DynamoDB 和 S3，DynamoDB 中的乐观锁定仍可能使 S3 中的数据不一致。在这种情况下，使用 DynamoDB 中的悲观锁可能更安全，直到 S3 更新完成。事实上，AWS为此提供了一个[锁定库。](https://aws.amazon.com/blogs/database/building-distributed-locks-with-the-dynamodb-lock-client/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-12-28T08:32:49.337

> **乐观锁定和悲观锁定是在数据库中锁定数据的两种模型。**

**乐观锁定**：仅在将更改提交到数据库时才锁定记录。

**悲观锁定**：记录在编辑时被锁定。

***注意***：在这两种数据锁定模型中，锁在更改提交到数据库后被释放。

# apache-flex - 如何为间隙填充练习制作自定义 Flex 组件？

> ID：129330
> 
> 赞同：2
> 
> 时间：2008-09-24T19:29:08.120
> 
> 标签：apache-flex, actionscript-3, air

该组件的目的是测试学生对给定学科的知识 - 在下面的示例中，它将是地理。给学生一段文本，其中缺少单词。他/她必须填写（在这种情况下键入）缺失的单词 - 因此这种测试/练习称为间隙填充。练习中可能有多个句子有多个间隙 - 看起来像这样：

***伦敦是 ____________ 和 _____________ 中最大的市区。作为两千年来的重要定居点，伦敦的历史可以追溯到___________。***

组件必须能够在文本中显示带有“浮动”间隙的文本。这些间隙将具有与 TextInput 控件类似的行为。一旦学生提交答案，该组件将返回输入的单词，然后将这些单词与预期答案进行比较。

组件应该能够显示文本，并且间隙从文本中动态派生所有必需的参数。间隙的位置可以用一个特殊的标记来标记 - 例如#10# - 这将标记文本中间隙的位置和间隙的大小（字符数）。

因此，上面的文本在加载到组件之前可能如下所示：

伦敦是#10# 和#15# 中最大的市区。作为两千年来的重要定居点，伦敦的历史可以追溯到 #8#。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T11:11:02.040

你需要一个支持流布局的容器。它不是标准 Flex 框架的一部分，但您可以在此处（优秀的 FlexLib 的一部分）和此处（独立实现）找到[一些](http://flexlib.googlecode.com/svn/trunk/docs/flexlib/containers/FlowBox.html)工作[实现](http://www.munkiihouse.com/?p=60)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T21:47:58.600

我猜你可以有一个画布，并动态添加标签和文本输入。这里的问题是知道换行符在哪里；我不确定如何从设置的文本轻松计算基于文本的控件的宽度，但它必须是可能的。

我想知道是否有可以为您执行此操作的布局控件，但我只能看到限制性太强的 HBox 和 VBox。创建或查找通用自动换行布局控件会很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-27T03:21:51.280

FlowBox是要走的路。您可以使用 Horizo​​ntalGap 来控制文本和输入间隙之间的间距。

当谈到编码方式时，我有一个 javascript 版本，您可以随意查看。[填空数据的渲染](http://projects.widged.com/exercist/etivities/activities/ajp_activity.html)、[编码](http://projects.widged.com/exercist/etivities/data/ajp_gapfill_json.ajp)。它是[通用学习活动生成器](http://widged.com/wiki/doku.php?id=en:projects:exercist:exercist)宠物项目的一部分。

从那以后，我搬到了 Flex。我[在 Flex 中提供了学习活动的](http://widged.com/labs/flex/gallery/index.php?lastadded=added%20any%20time)示例。您不会找到填空的地方，但您会发现“输入”您的答案足够接近。

全部开源。但是请注意，我在学习 Flex 时写了这篇文章……这是学习各种技术的借口。代码几乎肯定会得到改进。

如果您想出一些漂亮的东西，请考虑为 eduforge 上的[exercist 项目做出贡献](https://eduforge.org/projects/exercist/)

# asp.net-mvc - 如何使用 POST 动词重定向到页面？

> ID：129335
> 
> 赞同：147
> 
> 时间：2008-09-24T19:30:30.223
> 
> 标签：asp.net-mvc, url-redirection

当您`RedirectToAction`在控制器中调用时，它会使用 HTTP GET 自动重定向。如何明确告诉它使用 HTTP POST？

我有一个同时接受 GET 和 POST 请求的操作，我希望能够`RedirectToAction`使用 POST 并向其发送一些值。

像这样：

```
this.RedirectToAction(
    "actionname",
    new RouteValueDictionary(new { someValue = 2, anotherValue = "text" })
); 
```

我希望使用 HTTP POST 而不是 GET 发送`someValue`和值。`anotherValue`有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2009-08-27T19:06:41.280

对于您的特定示例，我会这样做，因为您显然并不关心实际上让浏览器获得重定向（通过接受您已经接受的答案）：

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Index() {
   // obviously these values might come from somewhere non-trivial
   return Index(2, "text");
}

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Index(int someValue, string anotherValue) {
   // would probably do something non-trivial here with the param values
   return View();
} 
```

这很容易工作，并且没有真正发生有趣的事情 - 这使您可以保持第二个确实只接受 HTTP POST 请求的事实（除了在这种情况下，它无论如何都在您的控制之下）并且您不必也可以使用 TempData ，这是您在答案中发布的链接所暗示的。

我很想知道这有什么“错误”，如果有的话。显然，如果您真的想向浏览器发送重定向，这是行不通的，但是您应该问为什么无论如何都要尝试转换它，因为这对我来说似乎很奇怪。

希望有帮助。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-09-24T19:35:02.630

HTTP 不支持使用 POST 重定向到页面。当你重定向到某个地方时，HTTP“位置”标头告诉浏览器去哪里，浏览器对该页面发出 GET 请求。您可能只需要为您的页面编写代码以接受 GET 请求和 POST 请求。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-10-15T10:19:32.913

如果您想在重定向期间在两个操作之间传递数据而不在查询字符串中包含任何数据，请将模型放在 TempData 对象中。

行动

`TempData["datacontainer"] = modelData;`

看法

```
var modelData= TempData["datacontainer"] as ModelDataType; 
```

TempData 是一个非常短暂的实例，您应该只在当前和后续请求期间使用它！由于 TempData 以这种方式工作，您需要确定下一个请求将是什么，并且重定向到另一个视图是您唯一可以保证这一点的时间。

因此，使用 TempData 可靠工作的唯一情况是在重定向时。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-04-27T07:34:46.457

试试这个

```
return Content("<form action='actionname' id='frmTest' method='post'><input type='hidden' name='someValue' value='" + someValue + "' /><input type='hidden' name='anotherValue' value='" + anotherValue + "' /></form><script>document.getElementById('frmTest').submit();</script>"); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-06-14T07:13:49.037

我想扩展 Jason Bunting 的答案

像这样

```
ActionResult action = new SampelController().Index(2, "text");
return action; 
```

Eli 将在这里寻求有关如何使其成为通用变量的想法

可以获得所有类型的控制器

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-11T09:26:04.807

我刚刚遇到了同样的问题。

解决方案是像函数一样调用控制器动作

```
 return await ResendConfirmationEmail(new ResendConfirmationEmailViewModel() { Email = input.Email });

 [HttpPost]
        [AllowAnonymous]
        public async Task<IActionResult> ResendConfirmationEmail(ResendConfirmationEmailViewModel input)
        {
           ...

            return View("ResendConfirmationEmailConfirmed");
        } 
```

# language-agnostic - 如何将参数传递给 IOC 框架中的构造函数

> ID：129345
> 
> 赞同：12
> 
> 时间：2008-09-24T19:32:10.937
> 
> 标签：language-agnostic, inversion-of-control, structuremap

如何将参数传递给 IOC 框架中的构造函数？我想做类似的事情：（试图成为 IOC 框架不可知论者；））

```
object objectToLogFor = xxx;
container.Resolve<ILogging>(objectToLogFor); 

public class MyLogging : ILogging
{
    public MyLogging(object objectToLogFor){}
} 
```

这似乎在 StructureMap 中是不可能的。但我很想看到有人证明我错了。

其他框架是否功能更丰富？还是我以错误的方式使用 IOC 框架？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-21T17:34:38.860

在结构图中，您可以使用 With 方法实现此目的：

```
string objectToLogFor = "PolicyName";
ObjectFactory.With<string>(objectToLogFor).GetInstance<ILogging>(); 
```

请参阅：[http ://codebetter.com/blogs/jeremy.miller/archive/2008/09/25/using-structuremap-2-5-to-inject-your-entity-objects-into-services.aspx](http://codebetter.com/blogs/jeremy.miller/archive/2008/09/25/using-structuremap-2-5-to-inject-your-entity-objects-into-services.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-25T14:17:16.197

对于温莎城堡：

```
var foo = "foo";
var service = this.container.Resolve<TContract>(new { constructorArg1 = foo }); 
```

请注意使用匿名对象来指定构造函数参数。

使用结构图：

```
var foo = "foo";
var service = container.With(foo).GetInstance<TContract>(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T19:40:15.567

这怎么可能与语言无关？这是相关框架的实现细节。

Spring 允许您将 c'tor args 指定为值/引用列表，如果这是您的事情。但是，与属性注入相比，它的可读性不是很高。

有些人对此大发雷霆，坚持认为 c'tor 注入是 java 中唯一的线程安全方法。从技术上讲，它们是正确的，但实际上并不重要。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T20:00:15.300

它不应该是一个非常普遍的需求，但有时它是一个有效的需求。[Ninject](http://ninject.org/)比 StructureMap 更轻量，允许您在从上下文中检索瞬态对象时传递参数。[Spring.NET](http://www.springframework.net/)也是。

大多数时候，在 IoC 容器中声明的对象不是瞬态的，而是通过构造函数/属性/方法接受其他非瞬态对象作为依赖项。

但是，如果您真的不想将容器用作工厂，并且如果您对要解析的对象有足够的控制权，则可以使用属性或方法注入，即使这听起来不那么自然并且在某些方面更具风险。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:35:08.467

是的，其他框架功能更丰富——您需要使用允许构造函数注入的 ioc 框架。Spring 是允许构造函数依赖注入的多语言 ioc 容器的示例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T06:13:44.137

其他 IoC 框架功能更丰富。

即用 Autofac查看[ParameterResolution](http://code.google.com/p/autofac/wiki/ResolveParameters)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-25T14:05:26.847

您也可以轻松地使用 Windsor 做到这一点

# javascript - 使用jQuery从html元素传递参数

> ID：129360
> 
> 赞同：3
> 
> 时间：2008-09-24T19:34:57.327
> 
> 标签：javascript, jquery

我是第一次使用 jQuery，需要一些帮助。我有如下所示的 html：

```
<div id='comment-8' class='comment'>
    <p>Blah blah</p>
    <div class='tools'></div>
</div>

<div id='comment-9' class='comment'>
    <p>Blah blah something else</p>
    <div class='tools'></div>
</div> 
```

我正在尝试使用 jQuery 将跨度添加到单击时调用各种函数的 .tools div。这些函数需要接收父评论的 id（整个 'comment-8' 或只是 '8' 部分），以便我可以显示有关评论的表单或其他信息。

到目前为止，我所拥有的是：

```
<script type='text/javascript'>

    $(function() {
        var actionSpan = $('<span>[Do Something]</span>');
        actionSpan.bind('click', doSomething);

        $('.tools').append(actionSpan);
     });

     function doSomething(commentId) { alert(commentId); }

</script> 
```

我被困在如何填充 doSomething 的 commentId 参数上。也许我应该传递对单击的跨度的引用而不是 id。那可能也很好，但我不确定如何做到这一点。

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T19:48:28.857

事件回调是用事件对象作为第一个参数调用的，你不能以这种方式传递其他东西。这个事件对象有一个`target`属性引用它被调用的元素，而`this`变量是对事件处理程序附加到的元素的引用。因此，您可以执行以下操作：

```
function doSomething(event)
{
    var id = $(event.target).parents(".tools").attr("id");
    id = substring(id.indexOf("-")+1);
    alert(id);
} 
```

...或者：

```
function doSomething(event)
{
    var id = $(this).parents(".tools").attr("id");
    id = substring(id.indexOf("-")+1);
    alert(id);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T19:45:53.853

要从跨度到周围的 div，您可以使用`<tt>parent()</tt>`（如果您知道确切的关系），如下所示：`<tt>$(this).parent().attr('id')</tt>;`或者如果结构可能嵌套更深，您可以使用 parents() 搜索 DOM 树，例如这个：`<tt>$(this).parents('div:eq(0)').attr('id')</tt>`。

为了让我的回答简单，我不再匹配这个类`<tt>"comment"</tt>`，但如果它有助于缩小你正在搜索的 div，你当然可以这样做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:47:26.970

您对传递给绑定事件处理程序的参数没有太多控制权。

也许为您的**doSomething()**定义尝试这样的事情：

```
function doSomething() { 
  var commentId = $(this).parent().attr('id');
  alert(commentId); 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:03:06.277

循环浏览评论可能更容易，并将工具添加到每个评论中。这样你就可以赋予它们各自的功能。我让函数返回一个函数，以便稍后调用它时，它具有可用的正确评论 ID。

其他解决方案（向上导航以查找父项的 ID）可能会更节省内存。

```
<script type='text/javascript'>

$(function() {
  $('.comment').each(function(comment) {
    $('.tools', comment).append(
      $('<span>[Do Something]</span>')
          .click(commentTool(comment.id));
    );
  });
});

function commentTool(commentId) {
  return function() {
    alert('Do cool stuff to ' + commentId);
  }
}

</script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:07:22.257

稍微花点时间让您了解您可以做的一些事情：

```
var tool = $('<span>[Tool]</span>');

var action = function (id) {
    return function () {
        alert('id');
    }
}

$('div.comment').each(function () {
    var id = $(this).attr('id');

    var child = tool.clone();
    child.click(action(id));

    $('.tools', this).append(child);
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T20:07:34.287

函数 bind() 将元素作为参数（在您的情况下为跨度），因此要从中获取所需的 id，您应该执行一些 DOM 遍历，例如：

```
function doSomething(eventObject) { 
    var elComment = eventObject.parentNode.parentNode; //or something like that, 
                                                       //didn't test it
    var commentId= elComment.getAttribute('commentId')
    alert(commentId); 
} 
```

# c# - 在 TabControl 中恢复 SplitterDistance 不一致

> ID：129362
> 
> 赞同：10
> 
> 时间：2008-09-24T19:35:05.003
> 
> 标签：c#, .net, winforms

我正在编写一个 WinForms 应用程序，我的 TabControl 中的一个选项卡有一个 SplitContainer。我将 SplitterDistance 保存在用户的应用程序设置中，但恢复不一致。如果带有拆分器的标签页可见，则恢复工作并且拆分器距离与我离开时一样。如果选择了其他选项卡，则拆分器距离是错误的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-06T14:58:09.143

有一个更简单的解决方案。如果 Panel1 设置为 SplitContainer.FixedPanel 属性中的固定面板，则它的行为都符合预期。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T19:35:22.287

我发现了问题。每个选项卡页在被选中之前不会调整大小以匹配选项卡控件。例如，如果选项卡控件在设计器中为 100 像素宽，并且您在加载期间刚刚将其设置为 500 像素，那么在隐藏的选项卡页面上将拆分器距离设置为 50 将在以下情况下将拆分器距离调整为 250你选择那个标签页。

我通过在我的应用程序设置中记录 SplitContainer 的 SplitterDistance 和 Width 属性来解决这个问题。然后在恢复时，我将 SplitterDistance 设置为recordedSplitterDistance * Width /recordedWidth。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-04-15T02:50:09.430

如前所述，使用 SplitContainer 的控件在被选中之前不会调整大小以匹配选项卡控件。如果您通过在 FixedPanel.None 的情况下以百分比设置 SplitterDistance (storedDistance * fullDistance / 100) 来处理恢复，由于计算的精度，您将看到拆分器在一段时间内移动。

我为这个问题找到了另一种解决方案。我订阅了其中一个事件，例如 Paint 事件。此事件发生在控件调整大小之后，因此 SplitContainer 将具有正确的值。首次恢复后，您应该取消订阅此事件，以便仅恢复一次：

```
private void MainForm_Load(object sender, EventArgs e)
{
    splitContainerControl.Paint += new PaintEventHandler(splitContainerControl_Paint);
}

void splitContainerControl_Paint(object sender, PaintEventArgs e)
{
    splitContainerControl.Paint -= splitContainerControl_Paint;
    // Handle restoration here
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-11T20:05:12.157

为了处理 FixedPanel 和方向的所有情况，应该使用以下内容：

```
 var fullDistance = 
           new Func<SplitContainer, int>(
               c => c.Orientation == 
                  Orientation.Horizontal ? c.Size.Height : c.Size.Width);

        // Store as percentage if FixedPanel.None
        int distanceToStore =
           spl.FixedPanel == FixedPanel.Panel1 ? spl.SplitterDistance :
           spl.FixedPanel == FixedPanel.Panel2 ? fullDistance(spl) - spl.SplitterDistance :
           (int)(((double)spl.SplitterDistance) / ((double)fullDistance(spl))) * 100; 
```

然后在恢复时做同样的事情

```
 // calculate splitter distance with regard to current control size
        int distanceToRestore =
           spl.FixedPanel == FixedPanel.Panel1 ? storedDistance:
           spl.FixedPanel == FixedPanel.Panel2 ? fullDistance(spl) - storedDistance :
           storedDistance * fullDistance(spl) / 100; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-25T15:07:24.343

我有同样的问题。在我的特殊情况下，我使用的是表单，我将其转换为标签页并添加到标签控件中。我找到的解决方案是在 Form_Shown 事件中设置拆分器距离，而不是在加载事件中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-11-07T17:34:22.967

将拆分器距离保存为拆分容器高度的百分比。然后使用当前拆分容器高度恢复拆分器距离百分比。

```
 /// <summary>
  /// Gets or sets the relative size of the top and bottom split window panes.
  /// </summary>
  [Browsable(false)]
  [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
  [UserScopedSetting]
  [DefaultSettingValue(".5")]
  public double SplitterDistancePercent
  {
     get { return (double)toplevelSplitContainer.SplitterDistance / toplevelSplitContainer.Size.Height; }
     set { toplevelSplitContainer.SplitterDistance = (int)((double)toplevelSplitContainer.Size.Height * value); }
  } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-06-07T07:02:58.647

恢复分离器距离也让我很伤心。我发现从表单（或用户控件）加载事件中的用户设置中恢复它们比使用构造函数提供了更好的结果。试图在构造函数中这样做给了我各种奇怪的行为。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-10T09:02:14.103

答案是时间同步。当窗口完成大小更改时，您必须设置 SplitterDistance。然后，您必须标记最终调整大小，然后设置 SplitterDistance。这种情况下没关系

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-07-31T23:31:14.090

在设置 SplitContainer.SplitDistance 之前设置包含 TabPage.Width = TabControl.Width - 8

# .net - 任何人都知道我在哪里可以通过 .net 获得有关 VSS 2005 集成的文档或教程

> ID：129382
> 
> 赞同：0
> 
> 时间：2008-09-24T19:38:03.170
> 
> 标签：.net, api, visual-sourcesafe

我知道我可以将 SourceSafeTypeLib 添加到项目中，并可以在对象浏览器中探索它并找到明显的东西（GetLatest 等），但我正在寻找一些更全面的文档或特定教程，例如“撤消其他用户的结帐”或“确定谁签出了文件。

如果有人知道在哪里可以找到这些材料，如何使用 VSS 执行高级或非显而易见的任务，或者知道如何反汇编 COM api（以便我可以设计自己的 api），我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T00:55:59.990

您可以查看 Microsoft 在 Microsoft.VisualStudio.SourceSafe.Interop 命名空间上的[文档](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.sourcesafe.interop(VS.80).aspx)（我假设这就是您所查看的内容）。我用它创建了一个 VB.NET 实用程序，它可以针对 VSS 2005 数据库获取最新、签出和签入。

快速阅读后发现了 IVSSItem.UndoCheckout 方法和 IVSSCheckouts 类型，它是给定文件的签出集合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-29T04:02:02.473

您还可以查看 MSDN 上的[Visual SourceSafe 自动化](http://msdn.microsoft.com/en-us/library/4d44xhsd(VS.80).aspx)文章。

# c# - .net 代码隐藏页面中的 GetElementsByTagName 功能？

> ID：129388
> 
> 赞同：1
> 
> 时间：2008-09-24T19:39:24.493
> 
> 标签：c#, .net, asp.net

我正在用 C# .NET 编写网页。在 javascript 中有一个名为 GetElementsByTagName 的函数...这对于从 .aspx 页面调用的 javascript 来说非常好。我的问题是，有什么方法可以从我的 C# 代码隐藏中获得这种功能？

--

那些好奇的场景：我使用了一个 asp:repeater 来生成很多按钮，现在我基本上是在尝试制作一个可以点击所有按钮的按钮。我尝试在创建它们时将所有按钮存储在一个列表中，但是在每次回发期间该列表都会被清除，所以我想我可以尝试上述方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T19:49:11.943

尝试这个：

```
foreach (Control ctl in myRepeater.Controls)
{ 
  if (ctl is Button)
  {
    ((Button)ctl).Click();
  }
} 
```

HTH...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T19:41:08.093

FindControl()，或者遍历页面上的控件...

```
For each ctl as Control in Me.Controls
  If ctl.Name = whatYouWant Then
    do stuff
Next 'ctl 
```

--如果你正在创建控件，你应该设置它们的 ID

```
Dim ctl as New Control()
ctl.ID = "blah1" 
```

ETC...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:44:14.123

好吧，您可以使用页面的 FindControl 方法找到控件，但 Repeater 元素的名称由 .net 生成。

顺便说一句，如果您真的想要，您可以将按钮列表存储在页面的 ViewState 中（或者可能是它们的名称列表）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:17:36.990

或我自己的代码的变体，仅更改 ASPX.CS：

```
using System;
using System.Data;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Collections.Generic;

public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(Object sender, EventArgs e)
    {
        #region Fill Repeater1 with some dummy data
        DataTable dt = new DataTable();

        dt.Columns.Add(new DataColumn("column"));

        DataRow dr = null;

        for (Int32 i = 0; i < 10; i++)
        {
            dr = dt.NewRow();

            dr["column"] = "";

            dt.Rows.Add(dr);
        }

        this.Repeater1.DataSource = dt;
        this.Repeater1.DataBind();
        #endregion

        foreach (Button b in this.FindButtonsInRepeater(ref this.Repeater1))
        {
            b.Text = "I was found and changed";
        }
    }

    private List<Button> FindButtonsInRepeater(ref Repeater repeater)
    {
        List<Button> buttonsFound = new List<Button>();

        foreach (RepeaterItem ri in repeater.Controls)
        {
            foreach (Control c in ri.Controls)
            {
                try
                {
                    buttonsFound.Add((Button)c);
                }

                catch (Exception exc)
                {
                }
            }
        }

        return buttonsFound;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:44:54.823

每当您进行任何回发时，都会重新创建*所有*内容，包括您的数据绑定控件。

如果您的列表不见了，按钮控件也不见了。当然，除非您重新创建了它们，在这种情况下，您也应该重新创建列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T19:51:21.907

我不知道你说的全部点击是什么意思。但是以下代码如何为您工作？不知道，没测试过。。。

```
protected void Page_Load(object sender, EventArgs e)
{

    foreach (Control control in GetControlsByType(this, typeof(TextBox)))
    { 
        //Do something?
    }

}
public static System.Collections.Generic.List<Control> GetControlsByType(Control ctrl, Type t)
{
    System.Collections.Generic.List<Control> cntrls = new System.Collections.Generic.List<Control>();

    foreach (Control child in ctrl.Controls)
    {
        if (t == child.GetType())
            cntrls.Add(child);
        cntrls.AddRange(GetControlsByType(child, t));
    }
    return cntrls;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T20:08:07.590

ASPX：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head runat="server">
        <title>Untitled Page</title>
    </head>

    <body>
        <form id="form1" runat="server">
            <asp:Repeater runat="server" ID="Repeater1">
                <ItemTemplate>
                    <asp:Button runat="server" ID="Button1" Text="I was NOT changed" />
                </ItemTemplate>
            </asp:Repeater>
        </form>
    </body>
</html> 
```

ASPX.CS：

```
using System;
using System.Data;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(Object sender, EventArgs e)
    {
        DataTable dt = new DataTable();

        dt.Columns.Add(new DataColumn("column"));

        DataRow dr = null;

        for (Int32 i = 0; i < 10; i++)
        {
            dr = dt.NewRow();

            dr["column"] = "";

            dt.Rows.Add(dr);
        }

        this.Repeater1.DataSource = dt;
        this.Repeater1.DataBind();

        foreach (RepeaterItem ri in this.Repeater1.Controls)
        {
            foreach (Control c in ri.Controls)
            {
                Button b = new Button();

                try
                {
                    b = (Button)c;
                }

                catch (Exception exc)
                {
                }

                b.Text = "I was found and changed";
            }
        }
    }
} 
```

# c# - 如何在 .NET 中对对象进行深层复制？

> ID：129389
> 
> 赞同：653
> 
> 时间：2008-09-24T19:39:39.750
> 
> 标签：c#, .net, serialization, clone

我想要一个真正的深拷贝。在 Java 中，这很容易，但在 C# 中如何做到这一点？

* * *

## 回答 #1

> 赞同：699
> 
> 时间：2008-09-24T19:40:42.930

### 重要的提示

[BinaryFormatter](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view=net-5.0)已被弃用，2023 年 11 月后将不再在 .NET 中可用。请参阅[BinaryFormatter 淘汰策略](https://github.com/dotnet/designs/blob/main/accepted/2020/better-obsoletion/binaryformatter-obsoletion.md)

* * *

我已经看到了几种不同的方法，但我使用了一个通用的实用方法：

```
public static T DeepClone<T>(this T obj)
{
 using (var ms = new MemoryStream())
 {
   var formatter = new BinaryFormatter();
   formatter.Serialize(ms, obj);
   ms.Position = 0;

   return (T) formatter.Deserialize(ms);
 }
} 
```

笔记：

*   你的班级必须被标记`[Serializable]`为这样才能工作。

*   您的源文件必须包含以下代码：

    ```
     using System.Runtime.Serialization.Formatters.Binary;
     using System.IO; 
    ```

* * *

## 回答 #2

> 赞同：394
> 
> 时间：2012-07-03T10:20:18.113

我[写了一个深度对象复制扩展方法](https://github.com/Burtsev-Alexey/net-object-deep-copy)，基于递归**“MemberwiseClone”**。它速度很快（比 BinaryFormatter**快三倍**），并且适用于任何对象。您不需要默认构造函数或可序列化属性。

源代码：

```
using System.Collections.Generic;
using System.Reflection;
using System.ArrayExtensions;

namespace System
{
    public static class ObjectExtensions
    {
        private static readonly MethodInfo CloneMethod = typeof(Object).GetMethod("MemberwiseClone", BindingFlags.NonPublic | BindingFlags.Instance);

        public static bool IsPrimitive(this Type type)
        {
            if (type == typeof(String)) return true;
            return (type.IsValueType & type.IsPrimitive);
        }

        public static Object Copy(this Object originalObject)
        {
            return InternalCopy(originalObject, new Dictionary<Object, Object>(new ReferenceEqualityComparer()));
        }
        private static Object InternalCopy(Object originalObject, IDictionary<Object, Object> visited)
        {
            if (originalObject == null) return null;
            var typeToReflect = originalObject.GetType();
            if (IsPrimitive(typeToReflect)) return originalObject;
            if (visited.ContainsKey(originalObject)) return visited[originalObject];
            if (typeof(Delegate).IsAssignableFrom(typeToReflect)) return null;
            var cloneObject = CloneMethod.Invoke(originalObject, null);
            if (typeToReflect.IsArray)
            {
                var arrayType = typeToReflect.GetElementType();
                if (IsPrimitive(arrayType) == false)
                {
                    Array clonedArray = (Array)cloneObject;
                    clonedArray.ForEach((array, indices) => array.SetValue(InternalCopy(clonedArray.GetValue(indices), visited), indices));
                }

            }
            visited.Add(originalObject, cloneObject);
            CopyFields(originalObject, visited, cloneObject, typeToReflect);
            RecursiveCopyBaseTypePrivateFields(originalObject, visited, cloneObject, typeToReflect);
            return cloneObject;
        }

        private static void RecursiveCopyBaseTypePrivateFields(object originalObject, IDictionary<object, object> visited, object cloneObject, Type typeToReflect)
        {
            if (typeToReflect.BaseType != null)
            {
                RecursiveCopyBaseTypePrivateFields(originalObject, visited, cloneObject, typeToReflect.BaseType);
                CopyFields(originalObject, visited, cloneObject, typeToReflect.BaseType, BindingFlags.Instance | BindingFlags.NonPublic, info => info.IsPrivate);
            }
        }

        private static void CopyFields(object originalObject, IDictionary<object, object> visited, object cloneObject, Type typeToReflect, BindingFlags bindingFlags = BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.FlattenHierarchy, Func<FieldInfo, bool> filter = null)
        {
            foreach (FieldInfo fieldInfo in typeToReflect.GetFields(bindingFlags))
            {
                if (filter != null && filter(fieldInfo) == false) continue;
                if (IsPrimitive(fieldInfo.FieldType)) continue;
                var originalFieldValue = fieldInfo.GetValue(originalObject);
                var clonedFieldValue = InternalCopy(originalFieldValue, visited);
                fieldInfo.SetValue(cloneObject, clonedFieldValue);
            }
        }
        public static T Copy<T>(this T original)
        {
            return (T)Copy((Object)original);
        }
    }

    public class ReferenceEqualityComparer : EqualityComparer<Object>
    {
        public override bool Equals(object x, object y)
        {
            return ReferenceEquals(x, y);
        }
        public override int GetHashCode(object obj)
        {
            if (obj == null) return 0;
            return obj.GetHashCode();
        }
    }

    namespace ArrayExtensions
    {
        public static class ArrayExtensions
        {
            public static void ForEach(this Array array, Action<Array, int[]> action)
            {
                if (array.LongLength == 0) return;
                ArrayTraverse walker = new ArrayTraverse(array);
                do action(array, walker.Position);
                while (walker.Step());
            }
        }

        internal class ArrayTraverse
        {
            public int[] Position;
            private int[] maxLengths;

            public ArrayTraverse(Array array)
            {
                maxLengths = new int[array.Rank];
                for (int i = 0; i < array.Rank; ++i)
                {
                    maxLengths[i] = array.GetLength(i) - 1;
                }
                Position = new int[array.Rank];
            }

            public bool Step()
            {
                for (int i = 0; i < Position.Length; ++i)
                {
                    if (Position[i] < maxLengths[i])
                    {
                        Position[i]++;
                        for (int j = 0; j < i; j++)
                        {
                            Position[j] = 0;
                        }
                        return true;
                    }
                }
                return false;
            }
        }
    }

} 
```

* * *

## 回答 #3

> 赞同：176
> 
> 时间：2009-07-31T16:51:03.040

基于 Kilhoffer 的解决方案...

使用 C# 3.0，您可以创建扩展方法，如下所示：

```
public static class ExtensionMethods
{
    // Deep clone
    public static T DeepClone<T>(this T a)
    {
        using (MemoryStream stream = new MemoryStream())
        {
            BinaryFormatter formatter = new BinaryFormatter();
            formatter.Serialize(stream, a);
            stream.Position = 0;
            return (T) formatter.Deserialize(stream);
        }
    }
} 
```

它使用 DeepClone 方法扩展了任何标记为 [Serializable] 的类

```
MyClass copy = obj.DeepClone(); 
```

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2011-12-30T19:05:02.470

您可以使用**Nested MemberwiseClone 进行深层复制**。它与复制值结构的速度几乎相同，并且比 (a) 反射或 (b) 序列化快一个数量级（如本页其他答案中所述）。

请注意，**如果**您使用**Nested MemberwiseClone 进行深层复制**，则必须为类中的每个嵌套级别手动实现一个 ShallowCopy，以及一个调用所有所述 ShallowCopy 方法的 DeepCopy 来创建一个完整的克隆。这很简单：总共只有几行，请参见下面的演示代码。

这是显示相对性能差异的代码输出（深度嵌套的 MemberwiseCopy 为 4.77 秒，序列化为 39.93 秒）。使用嵌套的 MemberwiseCopy 几乎与复制结构一样快，并且复制结构非常接近 .NET 能够达到的理论最大速度，这可能非常接近 C 或 C++ 中相同事物的速度（但会必须运行一些等效的基准来检查此声明）。

```
 Demo of shallow and deep copy, using classes and MemberwiseClone:
      Create Bob
        Bob.Age=30, Bob.Purchase.Description=Lamborghini
      Clone Bob >> BobsSon
      Adjust BobsSon details
        BobsSon.Age=2, BobsSon.Purchase.Description=Toy car
      Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:
        Bob.Age=30, Bob.Purchase.Description=Lamborghini
      Elapsed time: 00:00:04.7795670,30000000
    Demo of shallow and deep copy, using structs and value copying:
      Create Bob
        Bob.Age=30, Bob.Purchase.Description=Lamborghini
      Clone Bob >> BobsSon
      Adjust BobsSon details:
        BobsSon.Age=2, BobsSon.Purchase.Description=Toy car
      Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:
        Bob.Age=30, Bob.Purchase.Description=Lamborghini
      Elapsed time: 00:00:01.0875454,30000000
    Demo of deep copy, using class and serialize/deserialize:
      Elapsed time: 00:00:39.9339425,30000000 
```

要了解如何使用 MemberwiseCopy 进行深度复制，这里是演示项目：

```
// Nested MemberwiseClone example. 
// Added to demo how to deep copy a reference class.
[Serializable] // Not required if using MemberwiseClone, only used for speed comparison using serialization.
public class Person
{
    public Person(int age, string description)
    {
        this.Age = age;
        this.Purchase.Description = description;
    }
    [Serializable] // Not required if using MemberwiseClone
    public class PurchaseType
    {
        public string Description;
        public PurchaseType ShallowCopy()
        {
            return (PurchaseType)this.MemberwiseClone();
        }
    }
    public PurchaseType Purchase = new PurchaseType();
    public int Age;
    // Add this if using nested MemberwiseClone.
    // This is a class, which is a reference type, so cloning is more difficult.
    public Person ShallowCopy()
    {
        return (Person)this.MemberwiseClone();
    }
    // Add this if using nested MemberwiseClone.
    // This is a class, which is a reference type, so cloning is more difficult.
    public Person DeepCopy()
    {
            // Clone the root ...
        Person other = (Person) this.MemberwiseClone();
            // ... then clone the nested class.
        other.Purchase = this.Purchase.ShallowCopy();
        return other;
    }
}
// Added to demo how to copy a value struct (this is easy - a deep copy happens by default)
public struct PersonStruct
{
    public PersonStruct(int age, string description)
    {
        this.Age = age;
        this.Purchase.Description = description;
    }
    public struct PurchaseType
    {
        public string Description;
    }
    public PurchaseType Purchase;
    public int Age;
    // This is a struct, which is a value type, so everything is a clone by default.
    public PersonStruct ShallowCopy()
    {
        return (PersonStruct)this;
    }
    // This is a struct, which is a value type, so everything is a clone by default.
    public PersonStruct DeepCopy()
    {
        return (PersonStruct)this;
    }
}
// Added only for a speed comparison.
public class MyDeepCopy
{
    public static T DeepCopy<T>(T obj)
    {
        object result = null;
        using (var ms = new MemoryStream())
        {
            var formatter = new BinaryFormatter();
            formatter.Serialize(ms, obj);
            ms.Position = 0;
            result = (T)formatter.Deserialize(ms);
            ms.Close();
        }
        return (T)result;
    }
} 
```

然后，从 main 调用演示：

```
 void MyMain(string[] args)
    {
        {
            Console.Write("Demo of shallow and deep copy, using classes and MemberwiseCopy:\n");
            var Bob = new Person(30, "Lamborghini");
            Console.Write("  Create Bob\n");
            Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
            Console.Write("  Clone Bob >> BobsSon\n");
            var BobsSon = Bob.DeepCopy();
            Console.Write("  Adjust BobsSon details\n");
            BobsSon.Age = 2;
            BobsSon.Purchase.Description = "Toy car";
            Console.Write("    BobsSon.Age={0}, BobsSon.Purchase.Description={1}\n", BobsSon.Age, BobsSon.Purchase.Description);
            Console.Write("  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:\n");
            Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
            Debug.Assert(Bob.Age == 30);
            Debug.Assert(Bob.Purchase.Description == "Lamborghini");
            var sw = new Stopwatch();
            sw.Start();
            int total = 0;
            for (int i = 0; i < 100000; i++)
            {
                var n = Bob.DeepCopy();
                total += n.Age;
            }
            Console.Write("  Elapsed time: {0},{1}\n", sw.Elapsed, total);
        }
        {               
            Console.Write("Demo of shallow and deep copy, using structs:\n");
            var Bob = new PersonStruct(30, "Lamborghini");
            Console.Write("  Create Bob\n");
            Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);
            Console.Write("  Clone Bob >> BobsSon\n");
            var BobsSon = Bob.DeepCopy();
            Console.Write("  Adjust BobsSon details:\n");
            BobsSon.Age = 2;
            BobsSon.Purchase.Description = "Toy car";
            Console.Write("    BobsSon.Age={0}, BobsSon.Purchase.Description={1}\n", BobsSon.Age, BobsSon.Purchase.Description);
            Console.Write("  Proof of deep copy: If BobsSon is a true clone, then adjusting BobsSon details will not affect Bob:\n");
            Console.Write("    Bob.Age={0}, Bob.Purchase.Description={1}\n", Bob.Age, Bob.Purchase.Description);                
            Debug.Assert(Bob.Age == 30);
            Debug.Assert(Bob.Purchase.Description == "Lamborghini");
            var sw = new Stopwatch();
            sw.Start();
            int total = 0;
            for (int i = 0; i < 100000; i++)
            {
                var n = Bob.DeepCopy();
                total += n.Age;
            }
            Console.Write("  Elapsed time: {0},{1}\n", sw.Elapsed, total);
        }
        {
            Console.Write("Demo of deep copy, using class and serialize/deserialize:\n");
            int total = 0;
            var sw = new Stopwatch();
            sw.Start();
            var Bob = new Person(30, "Lamborghini");
            for (int i = 0; i < 100000; i++)
            {
                var BobsSon = MyDeepCopy.DeepCopy<Person>(Bob);
                total += BobsSon.Age;
            }
            Console.Write("  Elapsed time: {0},{1}\n", sw.Elapsed, total);
        }
        Console.ReadKey();
    } 
```

再次注意，**如果**您使用**Nested MemberwiseClone 进行深层复制**，则必须为类中的每个嵌套级别手动实现 ShallowCopy，以及调用所有所述 ShallowCopy 方法的 DeepCopy 来创建完整的克隆。这很简单：总共只有几行代码，请参见上面的演示代码。

请注意，在克隆对象时，“结构”和“类”之间存在很大差异：

*   如果你有一个“结构”，它是一个值类型，所以你可以复制它，内容将被克隆。
*   如果你有一个“类”，它是一个引用类型，所以如果你复制它，你所做的就是复制指向它的指针。要创建真正的克隆，您必须更具创造性，并使用一种方法在内存中创建原始对象的另一个副本。
*   不正确地克隆对象会导致非常难以确定的错误。在生产代码中，我倾向于实现校验和来仔细检查对象是否已正确克隆，并且没有被另一个引用损坏。此校验和可以在发布模式下关闭。
*   我发现这种方法非常有用：通常，您只想克隆对象的一部分，而不是整个对象。对于您修改对象然后将修改后的副本送入队列的任何用例，这也是必不可少的。

**更新**

可能可以使用反射递归遍历对象图以进行深度复制。WCF 使用这种技术来序列化一个对象，包括它的所有子对象。诀窍是使用使其可发现的属性注释所有子对象。但是，您可能会失去一些性能优势。

**更新**

引用独立速度测试（见下面的评论）：

> 我已经使用 Neil 的序列化/反序列化扩展方法、Contango 的 Nested MemberwiseClone、Alex Burtsev 的基于反射的扩展方法和 AutoMapper 进行了自己的速度测试，每个测试 100 万次。序列化-反序列化最慢，耗时 15.7 秒。然后是 AutoMapper，耗时 10.1 秒。更快的是基于反射的方法，耗时 2.4 秒。到目前为止，最快的是 Nested MemberwiseClone，耗时 0.1 秒。归结为性能与向每个类添加代码以克隆它的麻烦。如果性能不是问题，请使用 Alex Burtsev 的方法。——西蒙·图西

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2012-01-03T05:21:13.207

我相信 BinaryFormatter 方法相对较慢（这让我感到惊讶！）。如果某些对象满足 ProtoBuf 的要求，您也许可以对某些对象使用 ProtoBuf .NET。从 ProtoBuf 入门页面 ( [http://code.google.com/p/protobuf-net/wiki/GettingStarted](http://code.google.com/p/protobuf-net/wiki/GettingStarted) )：

**支持类型的注意事项：**

自定义类：

*   被标记为数据合同
*   有一个无参数的构造函数
*   对于 Silverlight：是公开的
*   许多常见的原语等。
*   *一*维数组：T[]
*   列表<T> / IList<T>
*   字典<TKey, TValue> / IDictionary<TKey, TValue>
*   任何实现 IEnumerable<T> 并具有 Add(T) 方法的类型

The code assumes that types will be mutable around the elected members. 因此，不支持自定义结构，因为它们应该是不可变的。

如果您的班级满足这些要求，您可以尝试：

```
public static void deepCopy<T>(ref T object2Copy, ref T objectCopy)
{
    using (var stream = new MemoryStream())
    {
        Serializer.Serialize(stream, object2Copy);
        stream.Position = 0;
        objectCopy = Serializer.Deserialize<T>(stream);
    }
} 
```

这确实非常快......

**编辑：**

这是对此进行修改的工作代码（在 .NET 4.6 上测试）。它使用 System.Xml.Serialization 和 System.IO。无需将类标记为可序列化。

```
public void DeepCopy<T>(ref T object2Copy, ref T objectCopy)
{
    using (var stream = new MemoryStream())
    {
        var serializer = new XS.XmlSerializer(typeof(T));

        serializer.Serialize(stream, object2Copy);
        stream.Position = 0;
        objectCopy = (T)serializer.Deserialize(stream);
    }
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-04-01T03:59:40.033

你可以试试这个

```
 public static object DeepCopy(object obj)
    {
        if (obj == null)
            return null;
        Type type = obj.GetType();

        if (type.IsValueType || type == typeof(string))
        {
            return obj;
        }
        else if (type.IsArray)
        {
            Type elementType = Type.GetType(
                 type.FullName.Replace("[]", string.Empty));
            var array = obj as Array;
            Array copied = Array.CreateInstance(elementType, array.Length);
            for (int i = 0; i < array.Length; i++)
            {
                copied.SetValue(DeepCopy(array.GetValue(i)), i);
            }
            return Convert.ChangeType(copied, obj.GetType());
        }
        else if (type.IsClass)
        {

            object toret = Activator.CreateInstance(obj.GetType());
            FieldInfo[] fields = type.GetFields(BindingFlags.Public |
                        BindingFlags.NonPublic | BindingFlags.Instance);
            foreach (FieldInfo field in fields)
            {
                object fieldValue = field.GetValue(obj);
                if (fieldValue == null)
                    continue;
                field.SetValue(toret, DeepCopy(fieldValue));
            }
            return toret;
        }
        else
            throw new ArgumentException("Unknown type");
    } 
```

感谢 DetoX83关于代码项目的[文章。](http://www.codeproject.com/Articles/38270/Deep-copy-of-objects-in-C)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-04-22T11:23:31.337

最好的方法是：

```
 public interface IDeepClonable<T> where T : class
    {
        T DeepClone();
    }

    public class MyObj : IDeepClonable<MyObj>
    {
        public MyObj Clone()
        {
            var myObj = new MyObj();
            myObj._field1 = _field1;//value type
            myObj._field2 = _field2;//value type
            myObj._field3 = _field3;//value type

            if (_child != null)
            {
                myObj._child = _child.DeepClone(); //reference type .DeepClone() that does the same
            }

            int len = _array.Length;
            myObj._array = new MyObj[len]; // array / collection
            for (int i = 0; i < len; i++)
            {
                myObj._array[i] = _array[i];
            }

            return myObj;
        }

        private bool _field1;
        public bool Field1
        {
            get { return _field1; }
            set { _field1 = value; }
        }

        private int _field2;
        public int Property2
        {
            get { return _field2; }
            set { _field2 = value; }
        }

        private string _field3;
        public string Property3
        {
            get { return _field3; }
            set { _field3 = value; }
        }

        private MyObj _child;
        private MyObj Child
        {
            get { return _child; }
            set { _child = value; }
        }

        private MyObj[] _array = new MyObj[4];
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-01T03:00:40.817

也许你只需要一个浅拷贝，在这种情况下使用`Object.MemberWiseClone()`.

`MemberWiseClone()`文档中有关于深度复制策略的很好的建议：-

[http://msdn.microsoft.com/en-us/library/system.object.memberwiseclone.aspx](http://msdn.microsoft.com/en-us/library/system.object.memberwiseclone.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-04T13:57:26.083

```
 public static object CopyObject(object input)
    {
        if (input != null)
        {
            object result = Activator.CreateInstance(input.GetType());
            foreach (FieldInfo field in input.GetType().GetFields(Consts.AppConsts.FullBindingList))
            {
                if (field.FieldType.GetInterface("IList", false) == null)
                {
                    field.SetValue(result, field.GetValue(input));
                }
                else
                {
                    IList listObject = (IList)field.GetValue(result);
                    if (listObject != null)
                    {
                        foreach (object item in ((IList)field.GetValue(input)))
                        {
                            listObject.Add(CopyObject(item));
                        }
                    }
                }
            }
            return result;
        }
        else
        {
            return null;
        }
    } 
```

这种方式比`BinarySerialization`AND 这不需要`[Serializable]`属性快几倍。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-13T13:50:01.790

MSDN 文档似乎暗示 Clone 应该执行深层复制，但从未明确说明：

ICloneable 接口包含一个成员 Clone，它旨在支持超出 MemberWiseClone 提供的克隆……MemberwiseClone 方法创建一个浅拷贝……</p>

你会发现我的帖子很有帮助。

[http://pragmaticcoding.com/index.php/cloning-objects-in-c/](http://pragmaticcoding.com/index.php/cloning-objects-in-c/)

# windows - 如何将 Active Directory 支持添加到 Windows PE？

> ID：129391
> 
> 赞同：0
> 
> 时间：2008-09-24T19:39:55.303
> 
> 标签：windows, active-directory

我想从不支持“开箱即用”的 Windows PE 2.0 查询 Active Directory。微软似乎暗示这是可能的，但不是通过他们提供的任何工具。你有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:58:37.590

这里好像有说明，作者声称从WinPE查询AD。 [http://www.clientarchitect.com/blog1.php/2008/06/18/windows-pe-2-0-ad-scripting-requirements](http://www.clientarchitect.com/blog1.php/2008/06/18/windows-pe-2-0-ad-scripting-requirements)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-06-05T02:02:41.513

我最近需要使用从 WinPE 到 AD 的连接来检索一些计算机信息，我用 ADSI 测试了上述解决方案和另一个解决方案，但在 ADK 1709 中对我不起作用。

我的最终解决方案是在具有不同凭据的 DC 上使用 WMI，因此只需一行即可获得我需要的一切 :)

(Get-WmiObject -Namespace 'root\directory\ldap' -Query "Select DS_info from DS_computer where DS_cn = $($AccountName)" -ComputerName $Domain -Credential $myADCred).$($Myattribute)

$AccountName : 是我在 AD 中搜索的计算机的名称 $Domain : fqdn 指向您的 DC ex:(xyz.youtdomain.com) 的名称 $MyADCred : 是一个凭证对象，包含用户和密码以及 AD 上的必要权限$myattribute ：是我在 AD 中从计算机中搜索的信息。

有一个很好的部署:)

亚辛

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T19:13:19.683

[从 deployvista.com](http://www.deployvista.com/Repository/WindowsPE20/tabid/73/EntryId/31/DMXModule/399/ctl/EntryDetails/mid/399/language/en-US/Default.aspx)安装ADSI 包解决了我的问题，但你的里程可能会有所不同。

# configuration - 我可以使用 DoxyGen 来记录 ActionScript 代码吗？

> ID：129405
> 
> 赞同：11
> 
> 时间：2008-09-24T19:42:10.290
> 
> 标签：configuration, actionscript, documentation, doxygen

如何配置 DoxyGen 以记录 ActionScript 文件？

我已经在 doxygen 的搜索模式中包含了 *.as 和 *.asi 文件，但是类、函数和变量并没有显示在那里。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-24T20:42:07.977

您应该使用专门支持该语言的文档生成器，而不是 doxygen。对于 ActionScript 2，您有几个选择：

1.  [NaturalDocs](http://www.naturaldocs.org/)（[示例](http://www.naturaldocs.org/example/showstyle.html?Default)）（免费）
2.  [ZenDoc](http://www.zendoc.org)（免费）
3.  [AS2Doc Pro](http://www.as2doc.com/)（[示例](http://www.as2doc.com/examples/xhtml/)）（商业）

如果您使用的是 ActionScript 3，Adobe 包括一个免费的文档生成器及其开源编译器（[Flex SDK](http://www.adobe.com/products/flex/flexdownloads/index.html#sdk)），称为“ [ASDoc](http://livedocs.adobe.com/flex/201/html/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Book_Parts&file=asdoc_127_1.html) ”。如果您使用的是[FlashDevelop](http://www.flashdevelop.org/wikidocs/index.php?title=Features)，[最新的 beta 版](http://www.flashdevelop.org/community/viewtopic.php?f=11&t=3589)具有用于运行 ASDoc 的内置 GUI，因此您不必使用命令行来弄脏您的手。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T14:10:04.710

我已经能够使用 DoxyGen 生成一些文档（我能说什么 - 我喜欢它的特性和功能）通过执行以下操作：

将 *.as 和 *.asi 添加到要输入的文件类型列表中。

选择：

```
OPTIMIZE_OUTPUT_JAVA   = YES
EXTRACT_ALL            = YES
HIDE_UNDOC_MEMBERS     = NO
HIDE_UNDOC_CLASSES     = NO 
```

AS3 中的另一个问题是 package 声明。您需要告诉 DoxyGen 忽略包定义。使用 cond 很容易做到这一点。所以你会改变这一行：

```
package myPackage { 
```

进入

```
/// @cond
package myPackage {
/// @endcond 
```

这将导致 Doxygen 忽略 cond 和 endcond 之间的行。请注意，似乎不需要对 .as 文件底部的右大括号执行相同操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-29T06:40:50.087

您也可以使用 Ortelius。它比 ASDoc 更易于使用，因为它带有一个简单的 GUI，并且更容易被您的代码所原谅。它是免费和开源的，但仅限于 Windows。

[奥特柳斯马腾变种dk](http://ortelius.marten.dk)

# html - 为什么我的图像和它的包含框之间有间隙？

> ID：129406
> 
> 赞同：10
> 
> 时间：2008-09-24T19:42:11.147
> 
> 标签：html, css

当我的浏览器呈现以下测试用例时，图像下方有一个间隙。根据我对 CSS 的理解，蓝色框的底部应该碰到红色框的底部。但事实并非如此。为什么？

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head><title>foo</title></head>
<body>

 <div style="border: solid blue 2px; padding: 0px;">

  <img alt='' style="border: solid red 2px; margin: 0px;"
   src="http://stackoverflow.com/Content/Img/stackoverflow-logo-250.png" />

 </div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-24T20:01:54.737

内联元素垂直对齐基线，而不是包含框的最底部。这是因为文本下方需要少量空间用于下行 - 小写字母“p”等字母的尾部。所以在底部上方不远处有一条假想线，称为基线，内联元素默认与它垂直对齐。

有两种方法可以解决这个问题。您可以指定图像应与底部垂直对齐，也可以将其设置为块元素，在这种情况下，它不再被视为文本的一部分。

除此之外，Internet Explorer 有一个 HTML 解析错误，它不会忽略关闭元素后的尾随空格，因此如果您遇到 Internet Explorer 兼容性问题，则可能需要删除此空格。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T19:43:45.263

因为图像是内联的，所以它位于基线上。尝试

```
vertical-align: bottom; 
```

或者，在 IE 中，有时如果您在图像周围有空格，您会得到它。因此，如果您删除 div 和 img 标签之间的所有空格，则可能会解决它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T19:52:01.827

`line-height: 0;`在父母上`DIV`为我解决了这个问题。据推测，这意味着默认的 line-height 不是 0。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T19:46:56.893

```
display: block 
```

在图像中也可以修复它，但可能会以其他方式破坏它；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:46:50.810

去掉标签前的换行符，让它直接跟在标签后面，中间没有空格。

我不知道为什么，但是对于 Internet Explorer，这是可行的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T21:05:55.020

`font-size:0;`在父 DIV 上是另一种修复它的棘手方法。

# c# - 将异常传递到 ASP.net/C# 中的错误屏幕

> ID：129417
> 
> 赞同：4
> 
> 时间：2008-09-24T19:44:35.340
> 
> 标签：c#, asp.net, error-handling

来自桌面背景，我不确定如何将捕获的异常传递给错误页面，以避免我的用户看到标准异常屏幕。

我的一般问题是如何将异常从页面 X 传递到 ASP.net 中的错误页面？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T19:47:50.043

我建议使用 web.config 中的 customErrors 部分：

```
 <customErrors mode="RemoteOnly" defaultRedirect="/error.html">
      <error statusCode="403" redirect="/accessdenied.html" />
      <error statusCode="404" redirect="/pagenotfound.html" />
   </customErrors> 
```

然后使用[ELMAH](https://code.google.com/archive/p/elmah/)通过电子邮件发送和/或记录错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T19:49:53.437

我使用的模式是将错误记录在 try/catch 块中（使用 log4net），然后执行 response.redirect 到一个简单的错误页面。这假设您不需要显示任何错误详细信息。

如果您需要单独页面上的异常详细信息，您可能需要查看 Server.GetLastError。我在 global.asax 中（在 Application_Error 事件中）使用它来记录未处理的异常并重定向到错误页面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T19:50:18.633

我们很幸运地在 Global.asax Application_Error 事件中捕获了异常，将它们存储在会话中，并重定向到我们的错误页面。或者，您可以对错误消息进行编码并将其传递到查询字符串中的错误页面。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T19:50:47.507

您还可以从

```
Server.GetLastError(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T19:47:57.623

使用 asp.net 中的自定义错误页面，您可以在 web.config中的[customError部分找到它](http://msdn.microsoft.com/en-us/library/h0hfz6fc.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T19:52:22.887

我们在 Global.asax 文件中捕获异常，将其存储在 Session 中，然后将用户重定向到错误页面，在此我们获取 Session 变量的异常并向用户显示 Message 信息。

```
 protected void Application_Error(object sender, EventArgs e)
    {
        Exception ex = Server.GetLastError();
        this.Session[CacheProvider.ToCacheKey(CacheKeys.LastError)] = ex;
    } 
```

我们会在向用户显示之前记录错误消息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T19:46:10.483

我认为您可以使用**global.asax** -- **Application_Exception**处理程序来捕获异常，然后将其存储以显示在错误页面中。

但实际上，您的错误页面不应包含可能导致另一个错误的代码。它应该是简单的“糟糕！出了点问题”页面。

如果您需要有关错误的详细信息，请使用 Windows 的事件查看器或[ELMAH](http://code.google.com/p/elmah/)或使用一些日志记录机制。

# testing - 在开发基于 PC 的应用程序时，哪些用户安装的应用程序会造成最大的麻烦？

> ID：129423
> 
> 赞同：2
> 
> 时间：2008-09-24T19:46:35.880
> 
> 标签：testing, qa

我在基于 Windows 的 PC 应用程序上工作，并且遇到过弹出窗口阻止程序、防病毒和防火墙破坏我的应用程序的问题（一些是带有 ActiveX 的 Web 应用程序，而另一些是 .NET Winforms）

听取我们支持人员的意见，用户安装和使用的其他应用程序已导致我们的应用程序出现问题。您遇到过哪些与您的应用程序不兼容的程序相关的意外问题？哪些是“有问题的”应用程序？（或者您的申请可能是“违规者”之一）

您在测试系统中安装了哪些组件/应用程序以确保不存在兼容性问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T19:48:39.510

我们在使用病毒扫描程序时遇到了很多麻烦，它阻止了本地进程之间的 tcp 连接。

我们花了很多时间，直到我们找到了阻止连接的原因。现在我们将我们的进程放入扫描仪的排除列表中，一切正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T19:49:33.063

IE浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:55:26.217

我在使用 Dell QuickSet 时遇到了一些问题。它是每台戴尔笔记本电脑附带的一个小而愚蠢的实用程序，它负责笔记本电脑键盘上的特殊按键。
显然，它会将其 DLL 加载到系统中的每个进程中。对于我的特定应用程序，它会导致视频驱动程序的用户端崩溃。

有很多应用程序允许自己将 DLL 加载到系统中的每个进程中。谷歌桌面是一个非常流行的例子。
您只需附加调试器即可查看将哪些 dll 加载到进程中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T19:56:00.867

间谍软件和其他恶意软件有时会导致应用程序出现意外问题。我不知道我们遇到过任何具体问题，但我知道检查/清理间谍软件是我们的技术支持人员让用户遇到问题时首先要做的事情之一。

我从来没有遇到过防病毒软件的问题，但我遇到了防火墙（软件和硬件）的问题。一些软件防火墙写得不好，即使关闭也可能导致问题（看着你迈克菲）。一些硬件防火墙/代理也可能导致问题。我相信我们遇到了一个问题，即某人的公司代理正在过滤通过它的数据，其中包括在发现“不良”内容时修改有效负载。有时我们的（二进制）数据会触发它并被修改，使其在到达客户端时无效。

雅虎通也曾经给我们的应用程序带来了一些问题。它使用一些嵌入式 Flash 电影来显示广告，而他们对 Flash 所做的事情在其他环境中破坏了它（我们的 Flash 应用程序在安装 Yahoo Messenger 时会随机失败）。

Real Player 11 beta 还给我们的 Flash 应用程序带来了很多问题（在某些情况下拦截了网络通信并破坏了协议，以及其他问题），尽管我认为他们在最终版本之前解决了这些问题。

为了扩展 Roundcrisis 的评论，我们确实看到了 Vista 中的问题。根据您的应用程序实际执行的操作，对 Vista 操作系统所做的更改可能会导致问题。

我必须对我们的一个 DLL 进行一些重大更改，以使其在 Vista 中正常工作。此外，新的应用程序安全性可能会导致某些类型的操作出现问题。如果您正在寻找需要进行测试的东西，请务必针对 Vista 进行测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T20:03:25.793

视窗维斯塔？即6？我其实不是在开玩笑

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T19:50:26.167

想到的最奇怪的是 Logitech 网络摄像头驱动程序干扰 Cygwin。我安装了一个罗技网络摄像头，我的基于 Eclipse 的 Altera 开发环境停止工作。花了很长时间才弄清楚这个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T20:00:58.700

我们多次遇到 HP 打印机驱动程序（不同型号）的问题？驱动程序在打印时丢失了一些文本。使用相同的文档可以重现效果。大多数情况下，驱动程序的更新可以解决它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T20:10:57.803

Pointsec 在意外部署时无意中导致整个部门中的几乎每台计算机崩溃。彻头彻尾的噩梦。不得不重新成像约。50 台电脑。

# sql - 如何从 SELECT 语句输出进度消息？

> ID：129437
> 
> 赞同：8
> 
> 时间：2008-09-24T19:48:00.743
> 
> 标签：sql, sqlanywhere

我有一个 SQL 脚本，我想在它运行时输出进度消息。让它在 SQL 语句之间输出消息很容易，但是我有一些运行时间很长的 INSERT INTO SELECTs。有没有办法让 select 语句输出消息，例如每 1000 行或每 5 秒？

注意：这适用于 SQL Anywhere，但任何 SQL 方言的答案都可以。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T19:59:34.833

无法检索单个查询的执行状态。主流数据库引擎都没有提供此功能。
此外，如果存在任何进度实现，都会产生可测量的开销，因此，如果查询已经花费了非常长的时间，以至于您想要显示进度，那么通过显示所述进度来导致额外的减速可能不是设计目标。
您可能会发现[这篇关于估计 SQL 执行进度](http://www.cse.iitb.ac.in/dbms/Data/Courses/CS632/2006/Papers/progress-est-surajit04.pdf)的文章很有帮助，尽管它的实际意义有限。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T19:49:53.407

SQL 本身并没有对这种事情的规定。这样做的任何方式都将涉及直接与数据库引擎对话，并且不会是跨数据库的标准。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T19:55:45.327

确实，使用基于集合的操作（这是关系数据库使用的）进行进度的想法并没有太大帮助，至少不像进度条显示的那样（完成百分比与总数）。当优化器弄清楚它需要做什么并真正了解操作的全部成本时，您已经完成了大部分操作。进度显示实际上是用于迭代操作而不是设置操作。

那是在谈论您的一般 SELECT 语句执行。对于作为单独语句的插入，提交者有各种方法可以通过监控语句的消耗率来做到这一点。如果它们是批量插入（select into、insert from 等），那么您确实遇到了与我上面描述的相同的问题。集合操作的批处理方式使得进度条类型的显示有点毫无意义。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T20:12:02.013

我在 SQL Anywhere 引擎开发团队工作，目前没有办法做到这一点。我不能保证任何事情，但我们正在考虑将这种类型的功能添加到未来的版本中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T19:50:45.450

对此当然没有 SQL 标准的解决方案。很抱歉被厄运，但我还没有看到任何东西可以在 Oracle、SQL Server、Sybase 或 MySQL 中做到这一点，所以我不会对 SQLAnywhere 抱太大希望。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T19:55:16.437

我同意 SQL 没有办法直接执行此操作。一种方法可能是一次只插入 TOP 1000，然后打印您的状态消息。然后根据需要继续重复此操作（在某种循环中）。不利的一面是，您需要一种方法来跟踪您的位置。

我应该注意到，这种方法不会像只做一个大 INSERT 那样有效

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T12:13:57.793

这是我要做的（Sybase / SQL Server 语法）：

```
DECLARE @total_rows int

SELECT  @total_rows = count(*) 
FROM    Source_Table

WHILE   @total_rows > (SELECT count(*) FROM Target_Table) 
BEGIN
    SET rowcount 1000 

    print 'inserting 1000 rows' 

    INSERT  Target_Table         
    SELECT  * 
    FROM    Source_Table s
    WHERE   NOT EXISTS( SELECT 1 
                        FROM   Target_Table t
                        WHERE  t.id = s.id )
END

set rowcount 0
print 'done' 
```

或者您可以根据 ID 执行此操作（假设 Id 是一个数字）：

```
DECLARE @min_id   int, 
        @max_id   int, 
        @start_id int, 
        @end_id   int

SELECT  @min_id = min(id) , 
        @max_id = max(id) 
FROM    Source_Table

SELECT  @start_id = @min_id , 
        @end_id   = @min_id + 1000 

WHILE   @end_id <= @max_id 
BEGIN

    print 'inserting id range: ' + convert(varchar,@start_id) + ' to ' + convert(varchar,@end_id) 

    INSERT  Target_Table         
    SELECT  * 
    FROM    Source_Table s
    WHERE   id           BETWEEN @start_id AND @end_id

    SELECT  @start_id = @end_id + 1, 
            @end_id   = @end_id + 1000 
END

set rowcount 0
print 'done' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T01:31:48.307

一种想法可能是让另一个单独的进程计算正在插入的表中的行数，以确定它们中已经存在的百分比。这当然需要你知道最后的总数。如果您不太担心服务器负载，这可能只是没问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T20:16:07.790

您可以通过计时多次运行来模拟用户的效果，然后以平均记录/秒的速度前进进度条。

唯一的其他方法是

1 - 请参阅您的数据库引擎的 API 以查看它是否为此做出任何规定

或者

2 - 将您的 INSERT 分解为许多较小的语句，并随时报告它们。但这将对性能产生重大的负面影响。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T19:52:03.793

如果您使用 Toad 的机会不大，您可以从表中生成一组 INSERT 语句并将其配置为以用户输入频率提交。您可以稍微修改一下您的脚本，然后查看有多少新数据已提交。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-02T01:10:14.067

如果你需要它或者你死了，对于插入、更新、删除，你可以使用一些带有 db 变量的触发逻辑，并且你可以不时地执行 sql 来检索变量数据并向用户显示一些进度。

如果你不想使用它，我可以写一个例子并发送它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-05T21:21:05.040

偶然发现这个旧线程正在寻找其他东西。我不同意我们不希望仅仅因为它是一个集合操作而需要进度信息的想法。如果用户知道等待多长时间，他们通常会容忍甚至长时间的等待。

这是我的建议：

每次运行时，记录插入的行数和总时间，然后在该过程的开头添加一个步骤来查询该日志并计算估计的总时间。如果您的估计基于最后一次运行，您应该能够对事情完成的等待时间提出一个可接受的良好猜测。

# design-patterns - 学习现代模式和实践的好项目是什么？

> ID：129438
> 
> 赞同：6
> 
> 时间：2008-09-24T19:48:12.333
> 
> 标签：design-patterns, project-planning

我正在尝试自学如何使用**现代持久性模式**（OR/M、存储库等）和开发实践（TDD 等）。

因为（对我而言）最好的学习方式是边做边学，我想为自己构建某种演示应用程序。问题是，我不知道要构建什么样的应用程序。我想在博客上写下我的经历，所以我想为社区建立一些有价值的东西，但同时我想避免其他人正在积极做的事情（[网络商务](http://blog.wekeroad.com/mvc-storefront/)、[论坛](http://weblogs.asp.net/stephenwalther/archive/2008/09/05/asp-net-mvc-application-building-forums-1-create-the-perfect-application.aspx)）或已经做过的事情死（博客引擎）。

有没有人对我可以从事的一个好的宠物项目有任何建议，或者在博客上写下我的经历？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T21:10:15.740

有无数的社区服务组织很少或根本没有网络存在。

选择一个服务组织——任何一个——扫盲志愿者、食品储藏室、家居用品捐赠、酗酒者互诫协会——任何一个。基层社区组织从参与中受益最多；他们通常需要更动态的网络存在，但负担不起。

查看他们当前的网站。为他们建造更好的东西。把它捐给他们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T19:55:43.003

我想说一个很好的方法是从您想要学习或构建应用程序的核心框架的示例项目开始。以 Spring 为例，他们有一个很棒的“宠物商店”Web 应用程序，您可以下载它来展示如何以推荐的方式使用框架的许多不同部分。从那里，您可以对其进行扩展：将其签入源代码控制，进行自动化构建，添加您自己的单元测试或测试优先添加，交换您自己的 ORM 层，尝试不同的视图层等。

一旦你让一切都按照你的意愿工作，那么你可以更轻松地分支，甚至可以使用你所学到的东西从头开始创建你自己的应用程序。

我发现从一个好的基础开始（“好的”很重要，因为你想学习最佳实践，而不仅仅是将你的工作建立在一个随机的互联网用户一起破解的东西上）并且建立起来真的很有帮助，而不是仅仅从一个空白项目，尤其是在尝试一次学习一堆新事物时，可能会让人不知所措。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:53:11.183

当然，你可以花 6 个月的时间来选择一个开源项目，然后一点一点地开始被接受并了解贡献系统是如何工作的。

但最好的方法仍然是按照自己的标准开始自己的项目，这可能会失败。您需要尝试、失败并从错误中学习以改进，使用您想要练习的内容。

正如一位法国作家所说：

“一个坐着的天才总是比一个走路的笨蛋走得更远”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T20:07:41.850

一个人们可以提出面向技术的问题并从互联网上的集体专家社区获得回复的网站怎么样？

我认为宠物项目最重要的方面是它必须是你关心的东西，并且会使用你自己。如果您使用它，并且它对您有帮助，那么其他人也会发现它。如果你在做某事是因为有人建议它，那么它就变成了工作。

为了玩 TDD，我最终创建了一个命令行参数解析器。我编写了很多控制台应用程序，这对我来说可以从中受益、感兴趣并且很有趣。那里已经有其他人了，但这对我来说并不是重点。我也打算写博客，但我玩模式和架构的另一个宠物项目是一个“做死”博客平台......以及关于使用您正在创建的博客平台编写博客平台的博客......好吧，这很难。

最后，我的两个项目在这一点上都没有给社区带来太多，但我已经注意到我解决问题的方式所带来的回报。找到一些你可以从中受益的东西，然后再担心对他人的好处。有点自私。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-20T19:31:56.553

这个问题问得好。我觉得这一定是很多开发者的感受。很多时候，我们受到我们在工作中开发的应用程序的限制。可能没有机会实施每一个最伟大和最新的事情。

我也有类似的感受。我所做的是，我说服我的团队学习新事物并分享有关新技术的知识。我已经开始构建自己的某种项目。它的实时使用很少，但我可以玩它。

例如，我在 DAL 使用 EntLib，但明天当我设法学习 LINQ 时，我将用 LINQ 替换 EntLib。可能是 LINQ to Entity。然后我使用普通的 WCF 公开了这些 DAL 方法。然后我学习了如何实现 WebHttpBinding 并使用 JSON 公开我的 WCF 服务。我现在计划学习 MS MVC 和 jQuery 并在那里做一些 ASP.Net/AJAX 的东西。

基本上，您应该以小块的方式一次解决一个问题。如果您有时间和热情，那么这里建议的第一个解决方案似乎是最好的。

祝你好运！！！

# postgresql - postgreSQL - psql \i：如何在给定路径中执行脚本

> ID：129445
> 
> 赞同：79
> 
> 时间：2008-09-24T19:49:48.807
> 
> 标签：postgresql

我是 postgreSQL 的新手，我有一个简单的问题：

我正在尝试创建一个创建数据库的简单脚本，以便以后可以这样调用它：

```
psql -f createDB.sql 
```

我希望脚本调用其他脚本（用于创建表、添加约束、函数等的单独脚本），如下所示：

```
\i script1.sql
\i script2.sql 
```

只要 createDB.sql 在**同一个目录**中，它就可以正常工作。

但是，如果我将 script2 移动到带有 createDB 的目录下的目录，并修改 createDB 使其看起来像这样：

```
\i script1.sql
\i somedir\script2.sql 
```

我收到一个错误：

> psql:createDB.sql:2: somedir: 权限被拒绝

我正在使用 Postgres Plus 8.3 for windows，默认 postgres 用户。

**编辑：**

愚蠢的我，unix斜线解决了这个问题。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-09-24T19:58:52.387

Postgres 在 Linux/Unix 上启动。我怀疑用修复它来反转斜线。

```
\i somedir/script2.sql 
```

如果您需要完全限定某事

```
\i c:/somedir/script2.sql 
```

如果这不能解决问题，我的下一个猜测是您需要转义反斜杠。

```
\i somedir\\script2.sql 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T20:03:23.110

您是否尝试过使用 Unix 风格的斜杠（/ 而不是 \）？

\ 通常是转义字符或命令字符，可能是混淆的根源。我从来没有遇到过这个问题，但我也没有 Windows，所以我无法测试它。

此外，权限可能基于运行 psql 的用户，或者可能基于执行 postmaster 服务的用户，检查两者是否已读取该目录中的该文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-14T16:55:37.187

试试这个，我自己努力这样做

```
\i 'somedir\\script2.sql' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-02-23T07:11:03.930

我确实尝试过这个及其在 Windows 机器上的工作以在特定模式上运行 sql 文件。

> psql -h localhost -p 5432 -U 用户名 -d 数据库名 -v schema=schemaname < e:\Table.sql

# java - JavaScript 或 Java 字符串减法

> ID：129451
> 
> 赞同：0
> 
> 时间：2008-09-24T19:50:24.840
> 
> 标签：java, javascript, regex

如果您使用的是 Java 或 JavaScript，是否有一种好方法可以执行字符串减法之类的操作，以便给定两个字符串：

```
org.company.project.component
org.company.project.component.sub_component 
```

你会得到：

```
sub_component 
```

我知道我可以编写代码来遍历字符串比较字符，但我希望有一种方法可以以一种非常紧凑的方式来完成。

另一个用例是查找字符串之间的差异：

```
org.company.project.component.diff
org.company.project.component.sub_component 
```

我实际上只想删除相同的部分。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T19:54:51.023

*完全*取决于你想要什么。如果您正在寻找一种在一般情况下比较字符串的方法 - 意味着在任意输入之间找到公共子字符串 - 那么您正在寻找更接近 Levenshtein 距离和类似算法的东西。但是，如果您只需要前缀/后缀比较，这应该可以：

```
public static String sub(String a, String b) {
    if (b.startsWith(a)) {
        return b.subString(a.length());
    }

    if (b.endsWith(a)) {
        return b.subString(0, b.length() - a.length());
    }

    return "";
} 
```

...或大致达到这种效果的东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T19:52:10.750

```
String result = "org.company.project.component.sub_component".replace("org.company.project.component","") 
```

应该管用...

编辑：Apache 公共库也很好用

如下所述，StringUtils 类实际上有一个方法： [StringUtils.remove()](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringUtils.html#remove(java.lang.String,%20java.lang.String))

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T01:42:21.503

乍一看，我想到了 RegExp，但添加到问题中，您通过添加到 start-string 来消除这种可能性......

所以你必须制定一个程序，从结果字符串中取出每个相等的字符，如下所示：

```
<script type="text/javascript">
var a = "org.company.project.component.diff";
var b = "org.company.project.component.sub_component";
var i = 0;
while(a.charAt(i) == b.charAt(i)){
  i++;
}
alert(b.substring(i));
</script> 
```

顺便说一句，在任何情况下将 Java 和 javascript 设置为平等没有意义，一种流行的说法可能是：

Java 和 javascript 有四个共同点：j - a - v - a !-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:52:17.770

你不能用空字符串替换第二个字符串中第一个字符串的出现吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:01:39.167

如果您只是想获取最后一个点之后的内容，我发现这种方法在 Javascript 中很容易：

```
var baseString = "org.company.project.component.sub_component";
var splitString = baseString.split(".");
var subString = splitString[splitString.length - 1]; 
```

subString 将包含您要查找的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T08:17:32.257

```
function sub(a, b) {
  return [a, b].join('\x01').match(/^([^\x01]*)[^\x01]*\x01\1(.*)/)[2];
} 
```

尽管这依赖于代码为 1 的字符不会出现在任何这些字符串中。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2016-01-13T00:59:31.603

这是问题的 Javascript 结尾的解决方案：

```
String.prototype.contracat = function(string){
    var thing = this.valueOf();
    for(var i=0; i<string.length;i++){
        thing=thing.replace(string.charAt(i),"");
    }
    return thing
}; 
```

# c# - .NET EventHandlers - 通用与否？

> ID：129453
> 
> 赞同：23
> 
> 时间：2008-09-24T19:50:41.813
> 
> 标签：c#, .net, generics, events

每次我开始深入 C# 项目时，我都会遇到很多真正只需要传递一个项目的事件。我坚持`EventHandler`/`EventArgs`练习，但我喜欢做的是：

```
public delegate void EventHandler<T>(object src, EventArgs<T> args);

public class EventArgs<T>: EventArgs {

  private T item;

  public EventArgs(T item) {
    this.item = item;
  }

  public T Item {
    get { return item; }
  }
} 
```

以后，我可以拥有我的

```
public event EventHandler<Foo> FooChanged;

public event EventHandler<Bar> BarChanged; 
```

然而，.NET 的标准似乎是`EventArgs`为每种类型的事件创建一个新的委托和子类。我的通用方法有问题吗？

* * *

编辑：这篇文章的原因是我刚刚在一个新项目中重新创建了它，并想确保它没问题。实际上，我在发布时正在重新创建它。我发现有一个泛型`EventHandler<TEventArgs>`，所以你不需要创建泛型委托，但你仍然需要泛型`EventArgs<T>`类，因为`TEventArgs: EventArgs`.

* * *

另一个编辑：内置解决方案的一个缺点（对我来说）是额外的冗长：

```
public event EventHandler<EventArgs<Foo>> FooChanged; 
```

对比

```
public event EventHandler<Foo> FooChanged; 
```

但是，客户注册您的活动可能会很痛苦，因为默认情况下会导入 System 命名空间，因此即使使用像 Resharper 这样的花哨工具，他们也必须手动查找您的命名空间......任何人都对此有任何想法?

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-24T20:13:36.127

自 .NET Framework 2.0 起已添加以下形式的委托

```
public delegate void EventHandler<TArgs>(object sender, TArgs args) where TArgs : EventArgs 
```

您的方法更进一步，因为您为带有单个数据项的 EventArgs 提供了开箱即用的实现，但它缺少原始想法的几个属性：

1.  您不能在不更改相关代码的情况下向事件数据添加更多属性。您必须更改委托签名以向事件订阅者提供更多数据。
2.  您的数据对象是通用的，但它也是“匿名的”，在阅读代码时，您必须从用法中破译“项目”属性。它应该根据它提供的数据来命名。
3.  当您具有底层（项目）类型的层次结构时，以这种方式使用泛型您无法创建 EventArgs 的并行层次结构。例如，EventArgs<BaseType> 不是 EventArgs<DerivedType> 的基本类型，即使 BaseType 是 DerivedType 的基本类型。

所以，我认为最好使用通用的 EventHandler<T>，但仍然有自定义的 EventArgs 类，根据数据模型的要求进行组织。使用 Visual Studio 和 ReSharper 等扩展，只需几个命令即可创建这样的新类。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T20:37:38.643

为了使通用事件声明更容易，我为它创建了几个代码片段。要使用它们：

*   复制整个片段。
*   将其粘贴到文本文件中（例如在记事本中）。
*   使用 .snippet 扩展名保存文件。
*   将 .snippet 文件放在适当的代码片段目录中，例如：

**Visual Studio 2008\代码片段\Visual C#\我的代码片段**

这是一个使用具有一个属性的自定义 EventArgs 类：

```
<?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets  xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
  <CodeSnippet Format="1.0.0">
    <Header>
      <Title>Generic event with one type/argument.</Title>
      <Shortcut>ev1Generic</Shortcut>
      <Description>Code snippet for event handler and On method</Description>
      <Author>Ryan Lundy</Author>
      <SnippetTypes>
        <SnippetType>Expansion</SnippetType>
      </SnippetTypes>
    </Header>
    <Snippet>
      <Declarations>
        <Literal>
          <ID>type</ID>
          <ToolTip>Type of the property in the EventArgs subclass.</ToolTip>
          <Default>propertyType</Default>
        </Literal>
        <Literal>
          <ID>argName</ID>
          <ToolTip>Name of the argument in the EventArgs subclass constructor.</ToolTip>
          <Default>propertyName</Default>
        </Literal>
        <Literal>
          <ID>propertyName</ID>
          <ToolTip>Name of the property in the EventArgs subclass.</ToolTip>
          <Default>PropertyName</Default>
        </Literal>
        <Literal>
          <ID>eventName</ID>
          <ToolTip>Name of the event</ToolTip>
          <Default>NameOfEvent</Default>
        </Literal>
      </Declarations>
      <Code Language="CSharp"><![CDATA[public class $eventName$EventArgs : System.EventArgs
      {
        public $eventName$EventArgs($type$ $argName$)
        {
          this.$propertyName$ = $argName$;
        }

        public $type$ $propertyName$ { get; private set; }
      }

      public event EventHandler<$eventName$EventArgs> $eventName$;
            protected virtual void On$eventName$($eventName$EventArgs e)
            {
                var handler = $eventName$;
                if (handler != null)
                    handler(this, e);
            }]]>
      </Code>
      <Imports>
        <Import>
          <Namespace>System</Namespace>
        </Import>
      </Imports>
    </Snippet>
  </CodeSnippet>
</CodeSnippets> 
```

这是一个有两个属性的：

```
<?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets  xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
  <CodeSnippet Format="1.0.0">
    <Header>
      <Title>Generic event with two types/arguments.</Title>
      <Shortcut>ev2Generic</Shortcut>
      <Description>Code snippet for event handler and On method</Description>
      <Author>Ryan Lundy</Author>
      <SnippetTypes>
        <SnippetType>Expansion</SnippetType>
      </SnippetTypes>
    </Header>
    <Snippet>
      <Declarations>
        <Literal>
          <ID>type1</ID>
          <ToolTip>Type of the first property in the EventArgs subclass.</ToolTip>
          <Default>propertyType1</Default>
        </Literal>
        <Literal>
          <ID>arg1Name</ID>
          <ToolTip>Name of the first argument in the EventArgs subclass constructor.</ToolTip>
          <Default>property1Name</Default>
        </Literal>
        <Literal>
          <ID>property1Name</ID>
          <ToolTip>Name of the first property in the EventArgs subclass.</ToolTip>
          <Default>Property1Name</Default>
        </Literal>
        <Literal>
          <ID>type2</ID>
          <ToolTip>Type of the second property in the EventArgs subclass.</ToolTip>
          <Default>propertyType1</Default>
        </Literal>
        <Literal>
          <ID>arg2Name</ID>
          <ToolTip>Name of the second argument in the EventArgs subclass constructor.</ToolTip>
          <Default>property1Name</Default>
        </Literal>
        <Literal>
          <ID>property2Name</ID>
          <ToolTip>Name of the second property in the EventArgs subclass.</ToolTip>
          <Default>Property2Name</Default>
        </Literal>
        <Literal>
          <ID>eventName</ID>
          <ToolTip>Name of the event</ToolTip>
          <Default>NameOfEvent</Default>
        </Literal>
      </Declarations>
      <Code Language="CSharp">
        <![CDATA[public class $eventName$EventArgs : System.EventArgs
      {
        public $eventName$EventArgs($type1$ $arg1Name$, $type2$ $arg2Name$)
        {
          this.$property1Name$ = $arg1Name$;
          this.$property2Name$ = $arg2Name$;
        }

        public $type1$ $property1Name$ { get; private set; }
        public $type2$ $property2Name$ { get; private set; }
      }

      public event EventHandler<$eventName$EventArgs> $eventName$;
            protected virtual void On$eventName$($eventName$EventArgs e)
            {
                var handler = $eventName$;
                if (handler != null)
                    handler(this, e);
            }]]>
      </Code>
      <Imports>
        <Import>
          <Namespace>System</Namespace>
        </Import>
      </Imports>
    </Snippet>
  </CodeSnippet>
</CodeSnippets> 
```

您可以按照该模式使用任意数量的属性创建它们。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-24T19:52:53.680

不，我不认为这是错误的方法。我认为它甚至在 [fantastic] 书[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)中被推荐。我做同样的事情。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T20:00:23.583

这是正确的实现。自从泛型首次可用 (2.0) 以来，它已被添加到 .NET Framework (mscorlib) 中。

有关其用法和实现的更多信息，请参阅 MSDN：http: [//msdn.microsoft.com/en-us/library/db0etb8x.aspx](http://msdn.microsoft.com/en-us/library/db0etb8x.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T20:05:43.323

第一次看到这个小模式时，我使用的是来自 MS Patterns & Practices 组的[Composite UI Application block 。](http://www.microsoft.com/downloads/details.aspx?FamilyId=7B9BA1A7-DD6D-4144-8AC6-DF88223AEE19&displaylang=en)

它不会向我抛出任何危险信号；事实上，它甚至是一种利用泛型遵循[DRY](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)规则的聪明方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T20:00:56.437

从 .NET 2.0 开始

> `EventHandler<T>`

已实施。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T20:10:44.777

[您可以在 MSDN http://msdn.microsoft.com/en-us/library/db0etb8x.aspx](http://msdn.microsoft.com/en-us/library/db0etb8x.aspx)上找到 Generic EventHandler

我一直在广泛使用通用 EventHandler，并且能够防止所谓的“类型（类）爆炸”项目保持更小，更容易导航。

为非通用 EventHandler 委托提供一个新的直观委托是痛苦的，并且与现有类型重叠在我看来，将“*EventHandler”附加到新的委托名称并没有多大帮助

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T19:57:51.593

我确实相信最新版本的 .NET 在其中定义了这样一个事件处理程序。就我而言，这是一个很大的赞许。

/编辑

最初没有得到那里的区别。只要你传回一个继承自 EventArgs 的类，你就是这样，我看不出有什么问题。如果您出于可维护性原因不包装结果，我会担心。我仍然说它对我来说看起来不错。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-12T08:39:53.517

使用通用事件处理程序实例

在 .NET Framework 2.0 之前，为了将自定义信息传递给事件处理程序，必须声明一个新委托以指定派生自 System.EventArgs 类的类。这在 .NET 中不再适用

Framework 2.0，引入了 System.EventHandler<T>) 委托。此通用委托允许从 EventArgs 派生的任何类与事件处理程序一起使用。

# sql - 存储过程中长期运行事务的性能提升

> ID：129494
> 
> 赞同：1
> 
> 时间：2008-09-24T19:58:44.853
> 
> 标签：sql, stored-procedures

我有几个长时间运行的报告类型事务，需要 5-10 分钟。通过使用存储过程，我会看到任何性能提升吗？会很重要吗？

每个查询每晚运行一次。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T20:04:55.227

可能不是。存储过程为您提供了预编译 SQL 的优势。如果你的 SQL 被不频繁地调用，那么这个优势将毫无价值。因此，如果您的 SQL 很昂贵，因为查询本身很昂贵，那么存储过程将不会为您带来任何有意义的性能优势。如果您有非常频繁地调用并且本身执行速度很快的查询，那么值得拥有一个 proc。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T20:12:01.747

很可能不是。存储过程的性能提升（如果有的话（取决于您的用例））在微观中是不明显的——仅在宏观中。

报告类型的查询是聚合大量数据的查询，如果是这种情况，无论执行方法如何，它都会很慢。只有索引和/或其他物理数据更改才能使其更快。

看：

[一般来说，存储过程是否比现代 RDBMS 上的内联语句更有效？](https://stackoverflow.com/questions/59880/are-stored-procedures-more-efficient-in-general-than-inline-statements-on-moder#59932)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T20:20:56.517

简短的回答是：不，存储过程不会提高性能。首先，如果您使用参数化查询，则存储过程和内联 SQL 之间的性能没有差异。原因是所有查询都缓存了执行计划——不仅仅是存储过程。看看[http://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx](http://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx)

如果您没有对内联查询进行参数化，而只是构建查询并将“参数”作为文字插入，那么每个查询与数据库看起来都会不同，并且需要对每个查询进行预编译。因此，在这种情况下，您可以通过在内联 SQL 中使用参数来帮自己一个忙。从安全角度来看，无论如何您都应该这样做，否则您将面临 SQL 注入攻击。

但无论如何，预编译问题在这里是一个红鲱鱼。您正在谈论长时间运行的查询 - 如此长的时间以至于预编译将是微不足道的。所以不幸的是，你不会在这里轻易下车。您的解决方案将是优化查询的实际设计，甚至重新考虑您完成任务的整个方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T20:01:04.363

是的，可以优化存储过程的查询计划，即使它不能，也可以优先于嵌入式 sql

“你会看到任何性能改进吗” - 确定的唯一方法是尝试它

从理论上讲，存储过程会预先解析 sql 并存储查询计划，而不是每次都计算出来，因此应该有一些加速，但是，我怀疑这在 5-10 分钟的过程中会很重要

如果担心速度，最好的办法是查看查询计划，看看是否可以通过不同的查询结构和/或添加索引等来改进它

如果速度不是问题，存储过程提供比内联 sql 更好的封装

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T20:18:37.380

正如其他人所说，您不会从预编译的存储过程中看到太多的性能提升。但是，如果您当前的事务有多个语句，并且数据在服务器之间来回传输，那么将其包装在存储过程中可以消除一些来回，这可能是一个真正的性能杀手。

研究适当的索引，但也要考虑查询本身（或整个过程，如果它由多个步骤组成）可能效率低下的事实。没有看到你的实际代码很难说。

# logging - 如何在 log4net ADONetAppender 中使用存储过程？

> ID：129498
> 
> 赞同：9
> 
> 时间：2008-09-24T19:59:11.887
> 
> 标签：logging, log4net, adonetappender

我正在使用 ADONetAppender 来（尝试）通过存储过程记录数据（以便我可以将逻辑注入到日志记录例程中）。

我的配置设置如下所示。谁能告诉我做错了什么？

```
<appender name="ADONetAppender_SqlServer" type="log4net.Appender.ADONetAppender">
  <bufferSize value="1" />
  <threshold value="ALL"/>
  <param name="ConnectionType" value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
  <param name="ConnectionString" value="<MyConnectionString>" />
  <param name="UseTransactions" value="False" />
  <commandText value="dbo.LogDetail_via_Log4Net" />
  <commandType value="StoredProcedure" />
      <parameter>
         <parameterName value="@AppLogID"/>
         <dbType value="String"/>
         <size value="50" />
         <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%property{LoggingSessionId}" />
         </layout>
      </parameter>
      <parameter>
         <parameterName value="@CreateUser"/>
         <dbType value="String"/>
         <size value="50" />
         <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%property{HttpUser}" />
         </layout>
      </parameter>
      <parameter>
         <parameterName value="@Message"/>
         <dbType value="String"/>
         <size value="8000" />
         <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%message" />
         </layout>
      </parameter>
      <parameter>
         <parameterName value="@LogLevel"/>
         <dbType value="String"/>
         <size value="50"/>
         <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%level" />
         </layout>
      </parameter>
</appender> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-09-24T13:21:56.533

使用“AnsiString”作为 varchar 的 dbType。nvarchar 的“字符串”。

[http://msdn.microsoft.com/en-us/library/system.data.dbtype%28v=VS.90%29.aspx](http://msdn.microsoft.com/en-us/library/system.data.dbtype%28v=VS.90%29.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T21:13:02.723

感谢一位警惕的 DBA，我们已经解决了这个问题。

注意“@Message”参数的大小。log4net 正在猜测如何转换类型并（我认为）将其转换为 nvarchar，即使该列是 varchar。这很重要，因为 nvarchar 的最大大小为 4000，而 varchar 的最大大小为 8000。

DBA 看到了此知识库文章中所述的错误：http: [//support.microsoft.com/kb/827366](http://support.microsoft.com/kb/827366)

我将大小更改为 4000，一切正常。

希望这将帮助其他人避免同样的问题。

干杯!

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-06-24T10:34:58.787

```
</configSections>
<log4net>

    <appender name="AdoNetAppender" type="log4net.Appender.AdoNetAppender">

        <bufferSize value="1"/>

        <connectionType value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.5000.0,Culture=neutral, PublicKeyToken=b77a5c561934e089"/>

        <connectionString value="Data Source=yourservername;initial Catalog=Databasename;User ID=sa;Password=xyz;"/>

        <commandText value="INSERT INTO Log4Net ([Date], [Thread], [Level], [Logger], [Message], 
               [Exception]) VALUES (@log_date, @thread, @log_level, @logger, @message, @exception)"/>

        <parameter>

            <parameterName value="@log_date"/>

            <dbType value="DateTime"/>

            <layout type="log4net.Layout.RawTimeStampLayout"/>

        </parameter>

        <parameter>

            <parameterName value="@thread"/>

            <dbType value="String"/>

            <size value="255"/>

            <layout type="log4net.Layout.PatternLayout">

                <conversionPattern value="%thread ip=%property{ip}"/>

            </layout>

        </parameter>

        <parameter>

            <parameterName value="@log_level"/>

            <dbType value="String"/>

            <size value="50"/>

            <layout type="log4net.Layout.PatternLayout">

                <conversionPattern value="%level"/>

            </layout>

        </parameter>

        <parameter>

            <parameterName value="@logger"/>

            <dbType value="String"/>

            <size value="255"/>

            <layout type="log4net.Layout.PatternLayout">

                <conversionPattern value="%logger"/>

            </layout>

        </parameter>

        <parameter>

            <parameterName value="@message"/>

            <dbType value="String"/>

            <size value="4000"/>

            <layout type="log4net.Layout.PatternLayout">

                <conversionPattern value="%message"/>

            </layout> 
```

# ios - 如何在没有自定义单元格的情况下将文本包装在 UITableViewCell 中

> ID：129502
> 
> 赞同：151
> 
> 时间：2008-09-24T20:00:03.430
> 
> 标签：ios, objective-c, cocoa-touch, uikit, iphone-sdk-2

这是在 iPhone 0S 2.0 上。2.1 的答案也很好，尽管我不知道关于表格的任何差异。

感觉应该可以在不创建自定义单元格的情况下让文本换行，因为默认情况下 a`UITableViewCell`包含 a `UILabel`。我知道如果我创建一个自定义单元格，我可以让它工作，但这不是我想要实现的 - 我想了解为什么我目前的方法不起作用。

我发现标签是按需创建的（因为单元格支持文本和图像访问，所以在必要之前它不会创建数据视图），所以如果我这样做：

```
cell.text = @""; // create the label
UILabel* label = (UILabel*)[[cell.contentView subviews] objectAtIndex:0]; 
```

然后我得到一个有效的标签，但设置`numberOfLines`（和 lineBreakMode）不起作用 - 我仍然得到单行文本。文本中有足够的高度`UILabel`来显示 - 我只是返回一个很大的高度值`heightForRowAtIndexPath`。

* * *

## 回答 #1

> 赞同：278
> 
> 时间：2009-05-25T06:22:39.780

这是一种更简单的方法，它对我有用：

在你的`cellForRowAtIndexPath:`函数里面。第一次创建单元格时：

```
UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
if (cell == nil)
{
    cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
    cell.textLabel.lineBreakMode = UILineBreakModeWordWrap;
    cell.textLabel.numberOfLines = 0;
    cell.textLabel.font = [UIFont fontWithName:@"Helvetica" size:17.0];
} 
```

您会注意到我将标签的行数设置为 0。这使它可以根据需要使用尽可能多的行。

下一部分是指定你的大小`UITableViewCell`，所以在你的`heightForRowAtIndexPath`函数中这样做：

```
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSString *cellText = @"Go get some text for your cell.";
    UIFont *cellFont = [UIFont fontWithName:@"Helvetica" size:17.0];
    CGSize constraintSize = CGSizeMake(280.0f, MAXFLOAT);
    CGSize labelSize = [cellText sizeWithFont:cellFont constrainedToSize:constraintSize lineBreakMode:UILineBreakModeWordWrap];

    return labelSize.height + 20;
} 
```

我在返回的单元格高度上添加了 20，因为我喜欢文本周围的小缓冲区。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-03-06T21:00:32.447

更新了 Tim Rupe 对 iOS7 的回答：

```
UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
if (cell == nil)
{
    cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] ;
    cell.textLabel.lineBreakMode = NSLineBreakByWordWrapping;
    cell.textLabel.numberOfLines = 0;
    cell.textLabel.font = [UIFont fontWithName:@"Helvetica" size:17.0];
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    NSString *cellText = @"Go get some text for your cell.";
    UIFont *cellFont = [UIFont fontWithName:@"Helvetica" size:17.0];

    NSAttributedString *attributedText =
        [[NSAttributedString alloc]
            initWithString:cellText
            attributes:@
            {
                NSFontAttributeName: cellFont
            }];
    CGRect rect = [attributedText boundingRectWithSize:CGSizeMake(tableView.bounds.size.width, CGFLOAT_MAX)
                                               options:NSStringDrawingUsesLineFragmentOrigin
                                               context:nil];
    return rect.size.height + 20;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-02-14T08:31:09.983

当我遇到同样的问题时，一个简短的评论/答案来记录我的经历。尽管使用了代码示例，但表格视图单元格高度正在调整，但单元格内的标签仍未正确调整 - 解决方案是我从自定义 NIB 文件加载单元格，这发生**在**调整单元格高度之后。

我在 NIB 文件中设置了不换行文本，并且标签只有 1 行；NIB 文件设置覆盖了我在代码中调整的设置。

我学到的教训是确保始终牢记对象在每个时间点的状态——它们可能还没有被创建！……有人下线。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-17T10:10:41.503

如果我们只在单元格中添加文本`UITableView`，我们只需要两个代表来工作（不需要添加额外的`UILabels`）

1)`cellForRowAtIndexPath`

2)`heightForRowAtIndexPath`

该解决方案对我有用：-

```
-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath*)indexPath
{ 
    static NSString *CellIdentifier = @"Cell";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];

    if (cell == nil)
    {
        cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
    }

    cell.textLabel.font = [UIFont fontWithName:@"Helvetica" size:16];
    cell.textLabel.lineBreakMode = UILineBreakModeWordWrap;
    cell.textLabel.numberOfLines = 0;

    [cell setSelectionStyle:UITableViewCellSelectionStyleGray]; 
    cell.textLabel.text = [mutArr objectAtIndex:indexPath.section];
    NSLog(@"%@",cell.textLabel.text);

    cell.accessoryView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"arrow.png" ]];

    return cell;

}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{  
    CGSize labelSize = CGSizeMake(200.0, 20.0);

    NSString *strTemp = [mutArr objectAtIndex:indexPath.section];

    if ([strTemp length] > 0)
        labelSize = [strTemp sizeWithFont: [UIFont boldSystemFontOfSize: 14.0] constrainedToSize: CGSizeMake(labelSize.width, 1000) lineBreakMode: UILineBreakModeWordWrap];

    return (labelSize.height + 10);
} 
```

这里的字符串`mutArr`是一个可变数组，我从中获取数据。

**编辑：-**这是我拿的数组。

```
mutArr= [[NSMutableArray alloc] init];

[mutArr addObject:@"HEMAN"];
[mutArr addObject:@"SUPERMAN"];
[mutArr addObject:@"Is SUPERMAN powerful than HEMAN"];
[mutArr addObject:@"Well, if HEMAN is weaker than SUPERMAN, both are friends and we will never get to know who is more powerful than whom because they will never have a fight among them"];
[mutArr addObject:@"Where are BATMAN and SPIDERMAN"]; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-10-12T02:45:11.867

现在 tableviews 可以有自定大小的单元格。如下设置表格视图

`tableView.estimatedRowHeight = 85.0 //use an appropriate estimate tableView.rowHeight = UITableViewAutomaticDimension`

[苹果参考](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/WorkingwithSelf-SizingTableViewCells.html#//apple_ref/doc/uid/TP40010853-CH25-SW1)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-21T09:23:00.987

我使用以下解决方案。

数据在成员中单独提供：

```
-(NSString *)getHeaderData:(int)theSection {
    ...
    return rowText;
} 
```

处理可以很容易地完成`cellForRowAtIndexPath`。定义单元格/定义字体并将这些值分配给结果“单元格”。请注意，`numberoflines`设置为“0”，这意味着需要什么。

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *CellIdentifier = @"Cell";
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];

    UIFont *cellFont = [UIFont fontWithName:@"Verdana" size:12.0];
    cell.textLabel.text= [self getRowData:indexPath.section];
    cell.textLabel.font = cellFont;
    cell.textLabel.numberOfLines=0;
    return cell;
} 
```

在`heightForRowAtIndexPath`中，我计算了包装文本的高度。绑定大小应与单元格的宽度有关。对于 iPad，这应该是 1024。对于 iPhone en iPod 320。

```
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    UIFont *cellFont = [UIFont fontWithName:@"Verdana" size:12.0];
    CGSize boundingSize = CGSizeMake(1024, CGFLOAT_MAX);
    CGSize requiredSize = [[self getRowData:indexPath.section] sizeWithFont:cellFont constrainedToSize:boundingSize lineBreakMode:UILineBreakModeWordWrap];
    return requiredSize.height;    
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-03-24T05:46:42.290

我发现这非常简单直接：

```
[self.tableView setRowHeight:whatEvereight.0f]; 
```

例如：

```
[self.tableView setRowHeight:80.0f]; 
```

**这可能是也可能不是最好的/标准的方法，但它在我的情况下有效。**

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-01-08T05:41:28.147

在 swift 中尝试我的代码。此代码也适用于普通的 UILabel。

```
extension UILabel {
    func lblFunction() {
        //You can pass here all UILabel properties like Font, colour etc....
        numberOfLines = 0
        lineBreakMode = .byWordWrapping//If you want word wraping
        lineBreakMode = .byCharWrapping//If you want character wraping
    }
} 
```

现在像这样简单地调用

```
cell.textLabel.lblFunction()//Replace your label name 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-16T14:41:20.593

我认为这是一个更好、更短的解决方案。只需格式化单元格的`UILabel`( `textLabel`) 以通过指定自动计算高度`sizeToFit`，一切都应该没问题。

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *CellIdentifier = @"Cell";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil)
    {
        cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];
    }

    // Configure the cell...
    cell.textLabel.text = @"Whatever text you want to put here is ok";
    cell.textLabel.lineBreakMode = UILineBreakModeWordWrap;
    cell.textLabel.numberOfLines = 0;
    [cell.textLabel sizeToFit];

    return cell;
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-24T20:27:14.283

我不认为你可以操纵一个`UITableViewCell's`私人基地`UILabel`来做到这一点。您可以自己添加一个新`UILabel`的单元格并使用`numberOfLines`with`sizeToFit`来适当地调整它的大小。就像是：

```
UILabel* label = [[UILabel alloc] initWithFrame:cell.frame];
label.numberOfLines = <...an appriate number of lines...>
label.text = <...your text...>
[label sizeToFit];
[cell addSubview:label];
[label release]; 
```

# python - 如何测试 Python 函数是否引发异常？

> ID：129507
> 
> 赞同：1043
> 
> 时间：2008-09-24T20:00:35.597
> 
> 标签：python, unit-testing, exception

如何编写一个只有在函数没有抛出预期异常时才会失败的单元测试？

* * *

## 回答 #1

> 赞同：875
> 
> 时间：2008-09-24T20:02:29.600

使用unittest 模块中的[`TestCase.assertRaises`](http://docs.python.org/library/unittest.html#unittest.TestCase.assertRaises)（或`TestCase.failUnlessRaises`），例如：

```
import mymod

class MyTestCase(unittest.TestCase):
    def test1(self):
        self.assertRaises(SomeCoolException, mymod.myfunc) 
```

* * *

## 回答 #2

> 赞同：595
> 
> 时间：2010-07-02T15:16:00.697

从 Python 2.7 开始，您可以使用上下文管理器来获取实际抛出的异常对象：

```
import unittest

def broken_function():
    raise Exception('This is broken')

class MyTestCase(unittest.TestCase):
    def test(self):
        with self.assertRaises(Exception) as context:
            broken_function()

        self.assertTrue('This is broken' in context.exception)

if __name__ == '__main__':
    unittest.main() 
```

[http://docs.python.org/dev/library/unittest.html#unittest.TestCase.assertRaises](http://docs.python.org/dev/library/unittest.html#unittest.TestCase.assertRaises)

* * *

在**Python 3.5**中，你必须 wrap `context.exception`in `str`，否则你会得到一个`TypeError`

```
self.assertTrue('This is broken' in str(context.exception)) 
```

* * *

## 回答 #3

> 赞同：448
> 
> 时间：2008-09-24T20:13:08.047

我之前的答案中的代码可以简化为：

```
def test_afunction_throws_exception(self):
    self.assertRaises(ExpectedException, afunction) 
```

如果一个函数接受参数，只需将它们传递给 assertRaises，如下所示：

```
def test_afunction_throws_exception(self):
    self.assertRaises(ExpectedException, afunction, arg1, arg2) 
```

* * *

## 回答 #4

> 赞同：156
> 
> 时间：2015-01-29T19:54:26.993

> **如何测试 Python 函数是否引发异常？**
> 
> 如何编写一个只有在函数没有抛出预期异常时才会失败的测试？

# 简短的回答：

将该`self.assertRaises`方法用作上下文管理器：

```
 def test_1_cannot_add_int_and_str(self):
        with self.assertRaises(TypeError):
            1 + '1' 
```

# 示范

最佳实践方法很容易在 Python shell 中演示。

**`unittest`图书馆_**

在 Python 2.7 或 3 中：

```
import unittest 
```

在 Python 2.6 中，您可以安装 2.7`unittest`库的 backport，称为[unittest2](https://pypi.python.org/pypi/unittest2)，并将其别名为`unittest`：

```
import unittest2 as unittest 
```

# 示例测试

现在，将以下 Python 类型安全测试粘贴到您的 Python shell 中：

```
class MyTestCase(unittest.TestCase):
    def test_1_cannot_add_int_and_str(self):
        with self.assertRaises(TypeError):
            1 + '1'
    def test_2_cannot_add_int_and_str(self):
        import operator
        self.assertRaises(TypeError, operator.add, 1, '1') 
```

测试一`assertRaises`用作上下文管理器，可确保在记录时正确捕获和清理错误。

我们也可以在*没有*上下文管理器的情况下编写它，参见测试二。第一个参数是您希望引发的错误类型，第二个参数是您正在测试的函数，其余参数和关键字参数将传递给该函数。

我认为仅使用上下文管理器就更加简单、易读和可维护。

# 运行测试

要运行测试：

```
unittest.main(exit=False) 
```

在 Python 2.6 中，您可能[需要以下内容](https://stackoverflow.com/a/21262077/541136)：

```
unittest.TextTestRunner().run(unittest.TestLoader().loadTestsFromTestCase(MyTestCase)) 
```

您的终端应输出以下内容：

```
..
----------------------------------------------------------------------
Ran 2 tests in 0.007s

OK
<unittest2.runner.TextTestResult run=2 errors=0 failures=0> 
```

我们看到正如我们所期望的那样，尝试在 a 中添加 a`1`和`'1'`a `TypeError`。

* * *

要获得更详细的输出，请尝试以下操作：

```
unittest.TextTestRunner(verbosity=2).run(unittest.TestLoader().loadTestsFromTestCase(MyTestCase)) 
```

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2008-09-24T20:03:24.497

您的代码应遵循此模式（这是一个 unittest 模块样式测试）：

```
def test_afunction_throws_exception(self):
    try:
        afunction()
    except ExpectedException:
        pass
    except Exception:
       self.fail('unexpected exception raised')
    else:
       self.fail('ExpectedException not raised') 
```

在 Python < 2.7 上，此构造对于检查预期异常中的特定值很有用。unittest 函数`assertRaises`仅检查是否引发了异常。

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2013-02-05T17:04:37.290

来自： http: [//www.lengrand.fr/2011/12/pythonunittest-assertraises-raises-error/](http://www.lengrand.fr/2011/12/pythonunittest-assertraises-raises-error/)

首先，这里是文件 dum_function.py 中对应的（仍然是 dum :p）函数：

```
def square_value(a):
   """
   Returns the square value of a.
   """
   try:
       out = a*a
   except TypeError:
       raise TypeError("Input should be a string:")

   return out 
```

这是要执行的测试（仅插入此测试）：

```
import dum_function as df # import function module
import unittest
class Test(unittest.TestCase):
   """
      The class inherits from unittest
      """
   def setUp(self):
       """
       This method is called before each test
       """
       self.false_int = "A"

   def tearDown(self):
       """
       This method is called after each test
       """
       pass
      #---
         ## TESTS
   def test_square_value(self):
       # assertRaises(excClass, callableObj) prototype
       self.assertRaises(TypeError, df.square_value(self.false_int))

   if __name__ == "__main__":
       unittest.main() 
```

我们现在准备好测试我们的功能了！以下是尝试运行测试时发生的情况：

```
======================================================================
ERROR: test_square_value (__main__.Test)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "test_dum_function.py", line 22, in test_square_value
    self.assertRaises(TypeError, df.square_value(self.false_int))
  File "/home/jlengrand/Desktop/function.py", line 8, in square_value
    raise TypeError("Input should be a string:")
TypeError: Input should be a string:

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (errors=1) 
```

TypeError 被实际引发，并生成测试失败。问题是这正是我们想要的行为：s。

为避免此错误，只需在测试调用中使用 lambda 运行该函数：

```
self.assertRaises(TypeError, lambda: df.square_value(self.false_int)) 
```

最终输出：

```
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK 
```

完美的 ！

……对我来说也很完美！！

非常感谢 Julien Lengrand-Lambert 先生

* * *

这个测试断言实际上返回了一个**误报**。发生这种情况是因为“assertRaises”中的 lambda 是引发类型错误的单元，而**不是**被测试的函数。

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2020-06-08T00:25:06.573

由于我还没有看到任何关于如何使用上下文管理器检查我们是否在接受的列表中遇到特定异常的详细说明，或者其他异常详细信息，我将添加我的（在 python 3.8 上检查）。

例如，如果我只想检查该函数是否正在引发`TypeError`，我会写：

```
with self.assertRaises(TypeError):
    function_raising_some_exception(parameters) 
```

如果我想检查该函数是否提高了`TypeError`or `IndexError`，我会写：

```
with self.assertRaises((TypeError,IndexError)):
    function_raising_some_exception(parameters) 
```

如果我想要更多关于引发的异常的详细信息，我可以在这样的上下文中捕获它：

```
# Here I catch any exception    
with self.assertRaises(Exception) as e:
    function_raising_some_exception(parameters)

# Here I check actual exception type (but I could
# check anything else about that specific exception,
# like it's actual message or values stored in the exception)
self.assertTrue(type(e.exception) in [TypeError,MatrixIsSingular]) 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2014-05-21T10:06:34.170

如果您正在使用`pytest`，您可以使用`pytest.raises(Exception)`：

例子：

```
def test_div_zero():
    with pytest.raises(ZeroDivisionError):
        1/0 
```

结果：

```
pigueiras@pigueiras$ py.test
================= test session starts =================
platform linux2 -- Python 2.6.6 -- py-1.4.20 -- pytest-2.5.2 -- /usr/bin/python
collected 1 items 

tests/test_div_zero.py:6: test_div_zero PASSED 
```

或者您可以构建自己的`contextmanager`以检查是否引发了异常。

```
import contextlib

@contextlib.contextmanager
def raises(exception):
    try:
        yield 
    except exception as e:
        assert True
    else:
        assert False 
```

然后你可以`raises`像这样使用：

```
with raises(Exception):
    print "Hola"  # Calls assert False

with raises(Exception):
    raise Exception  # Calls assert True 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2021-11-01T13:24:23.610

如果您使用的是 Python 3，为了断言异常及其消息，您可以`assertRaises`在上下文管理器中使用并将消息作为`msg`关键字参数传递，如下所示：

```
import unittest

def your_function():
    raise RuntimeError('your exception message')

class YourTestCase(unittest.TestCase):
    def test(self):
        with self.assertRaises(RuntimeError, msg='your exception message'):
            your_function()

if __name__ == '__main__':
    unittest.main() 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-09-25T11:17:18.000

我几乎在所有地方都使用**doctest** [1]，因为我喜欢同时记录和测试我的函数的事实。

看看这段代码：

```
def throw_up(something, gowrong=False):
    """
    >>> throw_up('Fish n Chips')
    Traceback (most recent call last):
    ...
    Exception: Fish n Chips

    >>> throw_up('Fish n Chips', gowrong=True)
    'I feel fine!'
    """
    if gowrong:
        return "I feel fine!"
    raise Exception(something)

if __name__ == '__main__':
    import doctest
    doctest.testmod() 
```

如果你把这个例子放在一个模块中并从命令行运行它，那么两个测试用例都会被评估和检查。

[1] [Python 文档：23.2 doctest -- 测试交互式 Python 示例](http://docs.python.org/lib/module-doctest.html)

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2019-06-12T11:30:44.257

这里有很多答案。代码展示了我们如何创建一个异常，我们如何在我们的方法中使用该异常，最后，您如何在单元测试中验证是否引发了正确的异常。

```
import unittest

class DeviceException(Exception):
    def __init__(self, msg, code):
        self.msg = msg
        self.code = code
    def __str__(self):
        return repr("Error {}: {}".format(self.code, self.msg))

class MyDevice(object):
    def __init__(self):
        self.name = 'DefaultName'

    def setParameter(self, param, value):
        if isinstance(value, str):
            setattr(self, param , value)
        else:
            raise DeviceException('Incorrect type of argument passed. Name expects a string', 100001)

    def getParameter(self, param):
        return getattr(self, param)

class TestMyDevice(unittest.TestCase):

    def setUp(self):
        self.dev1 = MyDevice()

    def tearDown(self):
        del self.dev1

    def test_name(self):
        """ Test for valid input for name parameter """

        self.dev1.setParameter('name', 'MyDevice')
        name = self.dev1.getParameter('name')
        self.assertEqual(name, 'MyDevice')

    def test_invalid_name(self):
        """ Test to check if error is raised if invalid type of input is provided """

        self.assertRaises(DeviceException, self.dev1.setParameter, 'name', 1234)

    def test_exception_message(self):
        """ Test to check if correct exception message and code is raised when incorrect value is passed """

        with self.assertRaises(DeviceException) as cm:
            self.dev1.setParameter('name', 1234)
        self.assertEqual(cm.exception.msg, 'Incorrect type of argument passed. Name expects a string', 'mismatch in expected error message')
        self.assertEqual(cm.exception.code, 100001, 'mismatch in expected error code')

if __name__ == '__main__':
    unittest.main() 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-10-28T00:13:39.267

我刚刚发现[Mock 库](http://www.voidspace.org.uk/python/mock.html)提供了一个 assertRaisesWithMessage() 方法（在其 unittest.TestCase 子类中），它不仅会检查是否引发了预期的异常，还会检查是否引发了预期的消息：

```
from testcase import TestCase

import mymod

class MyTestCase(TestCase):
    def test1(self):
        self.assertRaisesWithMessage(SomeCoolException,
                                     'expected message',
                                     mymod.myfunc) 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-10-21T00:12:46.330

您可以使用 unittest 模块中的 assertRaises

```
import unittest

class TestClass():
  def raises_exception(self):
    raise Exception("test")

class MyTestCase(unittest.TestCase):
  def test_if_method_raises_correct_exception(self):
    test_class = TestClass()
    # note that you dont use () when passing the method to assertRaises
    self.assertRaises(Exception, test_class.raises_exception) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-10-26T15:49:42.447

您可以使用上下文管理器运行错误函数并断言它使用特定消息引发异常`assertRaisesMessage`

```
with self.assertRaisesMessage(SomeException,'Some error message e.g 404 Not Found'):
    faulty_funtion() 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-01-11T17:02:01.267

对于 await/async **aiounittest**有一个稍微不同的模式：

[https://aiounittest.readthedocs.io/en/latest/asynctestcase.html#aiounittest.AsyncTestCase](https://aiounittest.readthedocs.io/en/latest/asynctestcase.html#aiounittest.AsyncTestCase)

```
async def test_await_async_fail(self):
    with self.assertRaises(Exception) as e:
        await async_one() 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-05-02T20:16:07.583

如果在此类中将 stock_id 设置为 Integer 会引发错误，则会引发 TypeError，如果发生这种情况，测试将通过，否则失败

```
def set_string(prop, value):
   if not isinstance(value, str):
      raise TypeError("i told you i take strings only ")
   return value

class BuyVolume(ndb.Model):
    stock_id = ndb.StringProperty(validator=set_string)

from pytest import raises
buy_volume_instance: BuyVolume = BuyVolume()
with raises(TypeError):
  buy_volume_instance.stock_id = 25 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-02-05T11:13:35.583

最好使用 unittest 进行单元测试，但如果您想要快速修复，我们可以捕获异常，将其分配给变量，并查看该变量是否是该异常类的实例。

让我们假设我们的错误函数抛出一个 ValueError。

```
 try:
      bad_function()
    except ValueError as e:
      assert isinstance(e, ValueError) 
```

* * *

## 回答 #18

> 赞同：-5
> 
> 时间：2019-10-03T19:02:27.997

虽然所有答案都很好，但我正在寻找一种方法来测试函数是否引发异常，而无需依赖单元测试框架并且不必编写测试类。

我最终写了以下内容：

```
def assert_error(e, x):
    try:
        e(x)
    except:
        return
    raise AssertionError()

def failing_function(x):
    raise ValueError()

def dummy_function(x):
    return x

if __name__=="__main__":
    assert_error(failing_function, 0)
    assert_error(dummy_function, 0) 
```

它在正确的行上失败了：

```
Traceback (most recent call last):
  File "assert_error.py", line 16, in <module>
    assert_error(dummy_function, 0)
  File "assert_error.py", line 6, in assert_error
    raise AssertionError()
AssertionError 
```

# ruby-on-rails - 在 Rails 中动态重新加载路由是不是一个坏主意？

> ID：129510
> 
> 赞同：7
> 
> 时间：2008-09-24T20:00:52.320
> 
> 标签：ruby-on-rails, ruby

我有一个正在编写的应用程序，允许管理员为页面、类别等添加别名，我想根据别名使用不同的控制器/操作（不重定向，我发现render 并没有真正调用方法。我只是渲染模板）。我尝试了一条捕获所有路线，但我并不热衷于引发和捕获每次都会抛出的 DoubleRender 异常。

我提出的解决方案是在服务器启动时动态生成路由，并在创建/更新/销毁别名时使用别名模型中的回调来重新加载路由。这是我的 routes.rb 中的代码：

```
Alias.find(:all).each do |alias_to_add|
    map.connect alias_to_add.name, 
            :controller => alias_to_add.page_type.controller, 
            :action => alias_to_add.page_type.action,
            :navigation_node_id => alias_to_add.navigation_node.id
end 
```

我在 Alias 模型中使用回调，如下所示：

```
after_save :rebuild_routes
after_destroy :rebuild_routes

def rebuild_routes
    ActionController::Routing::Routes.reload!
end 
```

这是否违反 Rails 最佳实践？有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-11-18T09:01:23.160

本，

我发现您已经使用的方法是最好的。使用 Rails 3，您必须稍微更改代码，以：

```
MyNewApplication::Application.reload_routes! 
```

就这样。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T03:24:56.683

## 快速解决方案

在 routes.rb 的底部有一条包罗万象的路线。在将您路由到的操作中实现您想要的任何别名查找逻辑。

在我的实现中，我有一个将定义的 URL 映射到控制器、操作和参数哈希的表。我只是将它们从数据库中取出，然后调用适当的操作，然后尝试为该操作呈现默认模板。如果该操作已经渲染了某些东西，则会引发一个 DoubleRenderError，我会捕获并忽略它。

您可以将此技术扩展到您想要的任何复杂程度，尽管随着它变得越来越复杂，通过调整您的路由或 Rails 默认路由逻辑而不是通过自己重新实现所有路由逻辑来实现它更有意义。

如果您没有找到别名，您可以在您认为合适的时候抛出 404 或 500 错误。

## **要记住的事情：**

**缓存：**不知道你的 URL 先验可以使页面缓存成为绝对的熊。请记住，它基于提供的 URI 进行缓存，而不是在`url_for (:action_you_actually_executed`) 上。这意味着如果您使用别名

```
/foo_action/bar_method 
```

到

```
/some-wonderful-alias 
```

您将在缓存目录中获得 some-wonderful-alias.html。并且当您尝试扫描 foo 的栏时，除非您明确指定它，否则您不会扫描该文件。

**容错：**检查以确保某人不会意外地在现有路由上出现别名。您可以通过将所有别名强制到一个“目录”中来轻松做到这一点，该目录已知否则不可路由（在这种情况下，别名在文本上是唯一的足以确保它们永远不会发生冲突），但这不是最理想的我能想到的一些应用程序的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T14:43:05.120

首先，正如其他人所建议的，在 routes.rb 的底部创建一个包罗万象的路线：

```
map.connect ':name', :controller => 'aliases', :action => 'show' 
```

然后，在 AliasesController 中，您可以使用 render_component 来呈现别名操作：

```
class AliasesController < ApplicationController
  def show
    if alias = Alias.find_by_name(params[:name])
      render_component(:controller => alias.page_type.controller, 
                        :action => alias.page_type.action,
                        :navigation_node_id => alias.navigation_node.id)
    else
      render :file => "#{RAILS_ROOT}/public/404.html", :status => :not_found
    end
  end
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T00:18:18.393

我不确定我是否完全理解这个问题，但你可以`method_missing`在你的控制器中使用，然后查找别名，可能是这样的：

```
class MyController
  def method_missing(sym, *args)
    aliased = Alias.find_by_action_name(sym)
    # sanity check here in case no alias

    self.send( aliased.real_action_name )
    # sanity check here in case the real action calls a different render explicitly
    render :action => aliased.real_action_name
  end

  def normal_action
    @thing = Things.find(params[:id])
  end
end 
```

如果你想优化它，你可以把 a`define_method`放在`method_missing`, 所以它只会在第一次调用时“丢失”，从那时起它就是一个正常的方法。

# asp.net-mvc - 溢出（即查询字符串）RouteData 从控制器返回到视图中

> ID：129523
> 
> 赞同：0
> 
> 时间：2008-09-24T20:02:42.237
> 
> 标签：asp.net-mvc

任何人都明白为什么以下不起作用？

我想要做的是在视图上形成新链接时将当前路由数据以及我通过匿名对象添加的任何内容复制到新路由数据中。

例如，如果我将参数“page”作为非路由路径（即，如果存在查询字符串，它会溢出路由路径并将其注入方法参数），例如

```
public ActionResult ChangePage(int? page)  { } 
```

并且我希望视图在使用帮助程序构建链接时知道更新的页面。我认为最好的方法是使用以下方法：

```
public ActionResult ChangePage(int? page)
{
     if(page.HasValue)
        RouteData.Values.Add("Page", page);
      ViewData.Model = GetData(page.HasValue ? page.Value : 1);
} 
```

然后在视图标记中，我可以使用此重载呈现我的下一个、预览、排序、显示更多（任何相关链接）：

```
 public static class Helpers
{
    public static string ActionLinkFromRouteData(this HtmlHelper helper,  string linkText, string actionName, object values)
    {
        RouteValueDictionary routeValueDictionary = new RouteValueDictionary();

        foreach(var routeValue in helper.ViewContext.RouteData.Values)
        {
            if(routeValue.Key != "controller" && routeValue.Key != "action")
            {
                routeValueDictionary[routeValue.Key] = routeValue;
            }
        }

        foreach(var prop in GetProperties(values))
        {
            routeValueDictionary[prop.Name] = prop.Value;
        }

        return helper.ActionLink(linkText, actionName, routeValueDictionary;

    }

   private static IEnumerable<PropertyValue> GetProperties(object o)
   {
    if (o != null) {
        PropertyDescriptorCollection props = TypeDescriptor.GetProperties(o);
        foreach (PropertyDescriptor prop in props) {
            object val = prop.GetValue(o);
            if (val != null) {
                yield return new PropertyValue { Name = prop.Name, Value = val };
            }
        }
    }
   }

    private sealed class PropertyValue 
    {
        public string Name { get; set; }
        public object Value { get; set; }
    }
} 
```

我发布代码只是为了说明这一点。这不起作用，感觉不对……指针？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T23:12:51.873

将页面信息传递给 ViewData？

`PagedResultsInfo`（或其他东西）听起来像是你也可以写的一门课……我们可以。

# open-source - 为开源工具捐款

> ID：129537
> 
> 赞同：6
> 
> 时间：2008-09-24T20:04:51.420
> 
> 标签：open-source, donations

我在日常开发中使用了几个开源工具——它们为我节省了很多钱。

在没有任何时间为这些项目捐款的情况下，我决定每年向一个项目捐款一次。

如果你要捐赠 100 美元，哪个项目会得到你的投票？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T20:09:48.727

您应该阅读 Jeff关于向开源项目捐赠 5000 美元以及开源项目是否真的可以从捐赠中受益的[帖子。](http://www.codinghorror.com/blog/archives/001158.html)基本上，项目协调员说这笔钱被搁置了三个月而没有动过，因为他们找不到合适的用途。

无论如何，我发现对我影响最大的开源项目是大型项目——Linux、Firefox、GNU、SVN 等。我认为对 OSS 来说最好的事情是传播信息、提高采用率、意识和参与者。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T20:11:08.737

你使用的最小的项目给你带来最大的利益，可能最需要并且最值得你花钱。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-10T09:14:03.677

我几乎每天都在办公室使用[维基百科。](http://en.wikipedia.org/)它确实为我节省了很多时间。虽然它不是一个“常规”工具（框架/可执行文件），但我真的认为它是一个公平的候选者。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-23T07:01:47.223

捐赠给一个人的项目，而不是像 Mozilla 基金会这样更大的项目，这可能是 100 美元的更好用途。这将直接鼓励他从事该产品的工作，并给他一种良好的感觉，即人们使用他的软件并对此表示感谢。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T20:05:24.150

今年我的投票是投给 TortoiseSVN。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T20:13:38.093

[http://www.vim.org/](http://www.vim.org/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T20:07:35.253

您选择的 JavaScript 框架。处理所有跨浏览器特性是一场噩梦，框架开发人员通过处理这些问题为 Web 开发人员节省了大量时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T20:10:36.510

我会分摊这 100 美元（如果那是您的捐赠预算）并捐赠给不同的项目。如果你是公司，不妨加个0。:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T20:19:53.943

[我认为Doxygen](http://www.doxygen.nl/ "多氧")值得捐赠！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T20:20:59.870

另一个强有力的竞争者是 PuTTY

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-23T06:17:53.273

[valgrind](http://valgrind.org/)是一个非常有用的检查配置文件的工具，并且维护得很好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-04-18T09:16:31.587

您可以通过向 jQuery 基金会捐款来支持 jQuery、jQuery UI、jQuery Mobile、QUnit 和更多项目的开发：http: [//jquery.org/donate/](http://jquery.org/donate/)

# .net - 有人知道 Inno Setup 的可靠 .NET Framework 2.0 安装程序脚本吗？

> ID：129542
> 
> 赞同：2
> 
> 时间：2008-09-24T20:05:37.830
> 
> 标签：.net, windows, .net-2.0, installation, inno-setup

我一天中的大部分时间都在搜索、编写并最终废弃一个可以与我的 Inno Setup 安装脚本一起使用的脚本，该脚本将在需要时下载并安装适当的 .NET 2.0 框架。

肯定有很多例子，但它们：

1.  如果需要，我想安装 Internet Explorer，我不敢以自动化的方式安装

2.  仅处理 x86 .NET 发行版，不支持 x64 和 IA64

3.  不要在需要时安装适当的语言包——这是一个棘手的问题（当我看到针对不同的 x86/x64/语言组合有不同的语言包时，我认输了）

4.  不要处理获取 .NET 2.0 SP1（也许 Windows 更新会在安装 2.0 后处理？）

这似乎是一个常见的问题，一定*有人*已经解决了。不过，我发现的只是 20 篇不同的帖子，它们都指向相同的两三个代码片段。

欢迎洞察:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T20:20:32.057

[用于 InnoSetup 的 .NET Framework 1.1/2.0/3.5 安装程序](http://www.codeproject.com/KB/install/dotnetfx_innosetup_instal.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:52:17.650

我最近一直在研究这个问题，但没有与您相同的要求。我还没有看到一个脚本可以执行您想要的操作，但您是否考虑过检查是否安装了 .NET 2.0，如果没有，则提示他们下载它。您可以在默认浏览器中打开一个 URL，并让用户在安装框架后再次尝试安装。

从用户的角度来看，这不是一个理想的情况，但我认为按照您的计划，您将不得不编写一些复杂的东西来处理不同的语言限制，以使其正常工作。

只是我的2美分。

# c# - 在 C# 中处理非验证 SSL 证书的最佳方法是什么

> ID：129544
> 
> 赞同：4
> 
> 时间：2008-09-24T20:06:01.217
> 
> 标签：c#, http, ssl

我正在使用以下代码来确保所有证书都通过，即使是无效的，但我想知道是否有更好的方法，因为这个事件被全局调用，我只希望证书通过某个 HTTP 调用而不是任何其他异步发生的。

```
// This delegate makes sure that non-validating SSL certificates are passed
ServicePointManager.ServerCertificateValidationCallback = delegate(object certsender, X509Certificate cert, X509Chain chain, System.Net.Security.SslPolicyErrors error)
{
   return true;
}; 
```

上面的代码只是忽略证书上的任何非验证的示例。我遇到的问题是它是一个**全球性**事件。我看不到事件发生在哪个会话中。我可能有几个 http 请求通过，我想询问用户对**每个请求**的操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T20:59:12.493

好吧，您实际上可以费心检查其中一些参数。;) 例如，如果你有一个自签名证书，那么只让[error == SslPolicyErrors.RemoteCertificateChainError](https://docs.microsoft.com/en-us/dotnet/api/system.net.security.sslpolicyerrors)通过。您还可以检查证书本身的颁发者、名称等，以提高安全性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T14:23:14.760

`certsender`论据呢？它是否包含任何合理的信息，以便您可以知道回调发生的连接是什么？我检查了.NET API，但它没有说明参数应该包含什么......

# project-management - 您的 QA/测试人员团队为让您开心的开发团队（作为开发人员）说了什么或做了什么

> ID：129551
> 
> 赞同：2
> 
> 时间：2008-09-24T20:06:21.557
> 
> 标签：project-management

关于如何改善团队之间的沟通有很多问题。开始的一种方法是确定一个团队实际做了哪些其他团队真正重视的事情，并做更多的事情。

例如。我们的 QA 团队为我们提供了一个虚拟机：

*   安装和配置我们基于服务器的商业软件的最新版本（并非易事，因为现场安装至少需要 2 天）
*   已配置系统的数据库备份，包括示例数据
*   一个自动安装和配置的应用程序，主要工作。（有 12 个所需组件的安装包，可以节省大量时间）

虽然我们仍然在自己的桌面上进行大部分测试，但这使我们能够拥有一个可以在本地运行的相对干净的环境。

您的 QA 团队最近为您做了什么？相反，你为你的 QA 团队做了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T20:08:19.633

“它不那么糟糕了。”

这真的让我很开心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T20:12:28.783

我的一个好朋友曾经在我们的 QA 部门工作，他用 AutoIt 编写了一堆令人惊叹的脚本。对我来说，它们就像金子一样，他会发现问题，给我写脚本，通过电子邮件将可执行文件发给我，我就有办法快速重现问题。他的脚本帮助我找到了几个月来一直（未成功）尝试追踪的内存泄漏。

自动化测试是一件好事。哦 - 他后来被提升为软件工程师，现在在我的团队工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T21:18:35.377

我很惊讶没有人说“我的 QA 团队在我的代码到达客户之前发现了一个重要的错误”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T21:20:20.087

“它坠毁了！” - 我们正在寻找几个月的错误被复制了。

# c# - Sql server 真实数据类型，什么是 C# 等价物？

> ID：129560
> 
> 赞同：51
> 
> 时间：2008-09-24T20:07:17.437
> 
> 标签：c#, sql-server

什么是C#相当于sql server 2005 real type？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-24T20:09:41.283

这是单曲

有关 SQL Server 到 .Net DataTypes 的更多信息，请参见[此处](http://msdn.microsoft.com/en-us/library/ms131092.aspx)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-03-04T18:35:46.243

Single 不是正确答案，因为它会舍入小数部分。例如 2.0799999 将转换为 2.08。如果没有关于舍入的限制，那么它应该是好的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-03-04T21:42:24.680

Double 可用作 SQL Server 的 Real 数据类型的 .NET 等效数据类型

Double 得到精确的值，没有舍入

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-03-02T19:52:27.083

答案是单身。如果您使用 double 并且您的 SQL 字段是 real 类型，则会出错。我自己测试并确认了这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-29T20:54:01.297

在我的项目中（acces -> firebird 和 ms sql -> c#）是真正定义为单精度浮点数......所以我使用了浮点数，一切都很好

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-06-26T11:57:31.527

它的等价物是**Single**。Single 是 -3.40E +38 到 3.40E +38 范围内的浮点数。

[这是来自 MSDN 的最新版本，描述了所有 SqlDbType 和 C# 等效项](https://msdn.microsoft.com/EN-US/library/wf35eysz(v=VS.100,d=hv.2).aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-01-11T19:04:12.270

答案是`Single` *或* `float`。（取决于风格。）这就像`String`和`string`[来源：ReSharper 代码建议“使用类型关键字”在使用`Single`. 它建议使用`float`.

# asp.net - 分析 SQL Server 和/或 ASP.NET

> ID：129605
> 
> 赞同：4
> 
> 时间：2008-09-24T20:12:30.153
> 
> 标签：asp.net, sql-server, database, profiling

如何分析一些从 ASP.NET 应用程序运行的查询？由于数据库的原因，我工作的一些软件运行速度非常慢（我认为）。这些表有索引，但它仍然拖累，因为它正在处理大量数据。我如何配置文件以查看我可以在哪里进行一些小的改进，从而有望带来更大的速度改进？

编辑：我想补充一点，网络服务器喜欢在这些长查询期间超时。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T20:34:23.473

Sql Server 有一些出色的工具可以帮助您解决这种情况。这些工具内置于 Management Studio（以前称为 Enterprise Manager + Query Analyzer）中。

使用 SQL Profiler 向您展示来自 Web 应用程序的实际查询。

复制每个问题查询（占用大量 CPU 时间或 IO 的查询）。使用“显示实际执行计划”运行查询。希望您会看到一些明显缺失的索引。

您还可以运行调优向导（按钮就在“显示实际执行计划”旁边。它将运行查询并提出建议。

通常，如果您已经有索引并且查询仍然运行缓慢，您将需要以不同的方式重新编写查询。

将所有查询保存在存储过程中会使这项工作*变得*更加容易。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T20:15:24.220

要分析 SQL Server，请使用[SQL Profiler](http://msdn.microsoft.com/en-us/library/ms181091.aspx)。

您可以使用Red Gate 的[ANTS Profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)来分析您的代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T21:46:51.770

另一个与 ASP.NET 配合得很好的 .NET 分析器是[dotTrace](http://www.jetbrains.com/profiler/)。我亲自使用过它，并在我的代码中发现了很多瓶颈。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T21:00:44.360

我相信您有分析查询所需的答案。但是，这是性能调优中最简单的部分。一旦您知道是查询而不是网络或应用程序，您如何找到并解决问题？

性能调优是一件复杂的事情。但是有一些地方可以先看看。你说你要返回大量数据？您返回的数据是否超出了您的需要？你真的只返回你需要的列和记录吗？使用 select * 返回 100 列可能比返回您实际使用的 5 列慢得多。

您的索引和统计数据是最新的吗？如果您有一段时间没有这样做，请查看如何在 BOL 中更新统计信息和重新索引。您对所有连接字段都有索引吗？where 子句中的字段怎么样。

你用过游标吗？你用过子查询吗？union 怎么样——如果你用的话可以改成 union all 吗？

您的查询是否可搜索（如果不熟悉该术语，请使用 Google 搜索。）

当您可以使用 group by 时，您使用 distinct 吗？

你拿锁了吗？

还有很多其他的东西要看这些只是一个起点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T01:31:47.297

如果有我想要调整的特定查询或存储过程，我发现在查询之前打开统计信息非常有用：

```
SET STATISTICS TIME ON
SET STATISTICS IO ON 
```

在查询分析器中打开统计信息时，统计信息将显示在结果窗格的消息选项卡中。

IO 统计数据对我特别有用，因为它让我知道我是否需要索引。如果我从 IO 统计信息中看到高读取计数，我可能会尝试向受影响的表添加不同的索引。当我尝试索引时，我再次运行查询以查看读取计数是否下降。经过几次迭代后，我通常可以为所涉及的表找到最佳索引。

以下是这些统计命令的 MSDN 链接：

[设置统计时间](http://msdn.microsoft.com/en-us/library/ms190287.aspx)

[设置统计 IO](http://msdn.microsoft.com/en-us/library/ms184361.aspx)

# perl - Perl 中的 my 和 local 有什么区别？

> ID：129607
> 
> 赞同：69
> 
> 时间：2008-09-24T20:12:59.373
> 
> 标签：perl, scoping

我看到它们都用在我试图调试的这个脚本中，而文献只是不清楚。有人可以为我揭开这个神秘面纱吗？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-09-24T20:26:41.323

简短的回答是`my`在词法范围内`local`将变量标记为私有，在动态范围内将变量标记为私有。

更容易理解`my`，因为这会创建通常意义上的局部变量。创建了一个新变量，它只能在封闭的词法块内访问，通常用花括号标记。花括号规则有一些例外，例如：

```
foreach my $x (@foo) { print "$x\n"; } 
```

但这只是 Perl 做你的意思。通常你有这样的事情：

```
sub Foo {
   my $x = shift;

   print "$x\n";
} 
```

在这种情况下，`$x`它是子例程私有的，并且它的范围由花括号括起来。需要注意的是，与 相比`local`，变量的范围`my`是根据您在文件中写入的代码定义的。这是一种编译时现象。

要理解`local`，您需要考虑程序运行时的调用堆栈。当一个变量是`local`时，它会从该语句对堆栈上低于该语句的所有内容执行的点重新定义`local`，直到您将堆栈返回到包含`local`.

起初这可能会令人困惑，因此请考虑以下示例。

```
sub foo { print "$x\n"; }
sub bar { local $x; $x = 2; foo(); }

$x = 1;
foo(); # prints '1'
bar(); # prints '2' because $x was localed in bar
foo(); # prints '1' again because local from foo is no longer in effect 
```

当`foo`第一次被调用时，它看到的全局值为`$x`1。当`bar`被调用并`local $x`运行时，它重新定义`$x`了堆栈上的全局。现在当`foo`从 调用时`bar`，它会看到 2 的新值`$x`。到目前为止，这并不是很特别，因为如果没有调用 to 也会发生同样的事情`local`。神奇的是，当`bar`返回时，我们退出由创建的动态作用域，`local $x`而前一个全局`$x`变量又回到作用域。所以对于 的最终调用`foo`，`$x`是 1。

您几乎总是想使用`my`，因为它为您提供了您正在寻找的局部变量。千载难逢`local`，做酷事真是得心应手。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-24T20:24:08.863

动态范围。这是一个简洁的概念。许多人不使用它，也不理解它。

基本上可以认为`my`是创建一个变量并将其锚定到一个 {} 块，AKA 范围。

```
my $foo if (true); # $foo lives and dies within the if statement. 
```

所以`my`变量是你习惯的。而使用动态作用域 $var 可以在任何地方声明并在任何地方使用。因此，`local`您基本上暂停使用该全局变量，并使用“局部值”来处理它。因此`local`为临时变量创建了一个临时范围。

```
$var = 4;
print $var, "\n";
&hello;
print $var, "\n";

# subroutines
sub hello {
     local $var = 10;
     print $var, "\n";
     &gogo; # calling subroutine gogo
     print $var, "\n";
}
sub gogo {
     $var ++;
} 
```

这应该打印：

```
4
10
11
4 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-24T22:58:10.507

引用[*学习 Perl*](http://oreilly.com/catalog/lperl3/chapter/ch04.html)：

> 但是 local 的名字是错误的，或者至少是误导性的。我们的朋友 Chip Salzenberg 说，如果他有机会乘坐时光机回到 1986 年并给拉里一条建议，他会告诉拉里用“save”这个名字来称呼本地人。 [14] 那是因为 local 实际上会将给定的全局变量的值保存起来，所以它稍后会自动恢复到全局变量。（没错：这些所谓的“局部”变量实际上是全局变量！）这种保存和恢复机制与我们现在已经见过两次的机制相同，分别在 foreach 循环的控制变量和 @_子程序参数数组。

因此，`local`保存全局变量的当前值，然后将其设置为某种形式的空值。您经常会看到它用于吞食整个文件，而不是仅引导一行：

```
my $file_content;
{
    local $/;
    open IN, "foo.txt";
    $file_content = <IN>;
} 
```

调用`local $/`将输入记录分隔符（Perl 停止读取“行”处的值）设置为空值，导致宇宙飞船操作员读取整个文件，因此它永远不会碰到输入记录分隔符。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-25T23:25:27.733

我不敢相信没有人与 Mark Jason Dominus 关于此事的详尽论文有联系：

*   **[应对范围界定](http://perl.plover.com/FAQs/Namespaces.html)**

*   然后，如果你想知道到底什么`local`是好的，
    **[七种有用的用途`local`](http://perl.plover.com/local.html)**

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-24T20:21:35.623

[http://perldoc.perl.org/perlsub.html#Private-Variables-via-my()](http://perldoc.perl.org/perlsub.html#Private-Variables-via-my())

> 与本地运算符创建的动态变量不同，使用 my 声明的词法变量对外界完全隐藏，包括任何调用的子程序。如果它是从自身或其他地方调用的同一个子例程，则这是正确的——每个调用都有自己的副本。

[http://perldoc.perl.org/perlsub.html#Temporary-Values-via-local()](http://perldoc.perl.org/perlsub.html#Temporary-Values-via-local())

> local 将其列出的变量修改为对封闭块、eval 或 do FILE 以及从该块中调用的任何子例程的“本地”。本地只是为全局（意味着包）变量提供临时值。它不会创建局部变量。这称为动态范围。词法作用域是用 my 完成的，它更像 C 的自动声明。

我认为这一点都不清楚，除了说“本地到封闭块”之外，它的意思是在退出块时恢复原始值。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-24T20:14:02.117

好吧，谷歌真的很适合你：[http ://www.perlmonks.org/?node_id=94007](http://www.perlmonks.org/?node_id=94007)

从链接：

> 快速总结：'my' 创建一个新变量，'local' 临时修改变量的值。
> 
> 即，“本地”*临时更改变量的值*，但仅 在它存在*的范围内。*

通常使用我的，它更快并且不会做任何奇怪的事情。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-24T20:18:10.017

来自`man perlsub`：

*与本地运算符创建的动态变量不同，使用 my 声明的词法变量对外界完全隐藏，包括任何调用的子程序。*

因此，过度简化`my`会使您的变量仅在声明的地方可见。`local`使其在调用堆栈中也可见。您通常会想要使用`my`而不是`local`.

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-25T02:00:13.330

你的困惑是可以理解的。词法作用域相当容易理解，但动态作用域是一个不寻常的概念。名称使情况变得更糟，`my`并且`local`由于历史原因有些不准确（或至少不直观）。

`my`声明一个词法变量——从声明点到封闭块（或文件）结束都是可见的。它完全独立于程序其余部分中具有相同名称的任何其他变量。它是该块私有的。

`local`另一方面，声明对全局变量值的临时更改。更改在封闭范围的末尾结束，但变量——是全局的——在程序的任何地方都是可见的。

根据经验，使用`my`来声明您自己的变量并`local`控制更改 Perl 内置变量的影响。

如需更详尽的描述，请参阅 Mark Jason Dominus 的文章[Coping with Scopeping](http://perl.plover.com/FAQs/Namespaces.html)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-25T18:52:22.490

local 是一种较老的本地化方法，从 Perl 只有动态作用域的时代开始。词法作用域对程序员来说更自然，在许多情况下也更安全。我的变量属于声明它们的范围（块、包或文件）。

相反，局部变量实际上属于全局命名空间。如果你用 local 来引用变量 $x，你实际上是在引用 $main::x，它是一个全局变量。与它的名字所暗示的相反，所有 local 所做的只是将一个新值推送到 $main::x 的值堆栈中，直到该块结束，此时旧值将被恢复。这本身就是一个有用的功能，但由于多种原因，它不是一个拥有局部变量的好方法（想想当你有线程时会发生什么！想想当你调用一个真正想要使用全局变量的例程时会发生什么？你已经本地化了！）。然而，在 Perl 5 之前的糟糕日子里，这是让变量看起来像局部变量的唯一方法。我们仍然坚持使用它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T20:18:36.240

“我的”变量仅在当前代码块中可见。“本地”变量在以前可见的地方也可见。例如，如果你说“我的 $x;” 并调用一个子函数，它看不到那个变量 $x。但如果你说“本地 $/;” （以清除记录分隔符的值）然后您更改从文件读取的方式在您调用的任何函数中工作。

在实践中，您几乎总是想要“我的”，而不是“本地的”。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-04-10T05:44:22.113

查看以下代码及其输出以了解差异。

```
our $name = "Abhishek";

sub sub1
{
    print "\nName = $name\n";
    local $name = "Abhijeet";

    &sub2;
    &sub3;
}

sub sub2
{
    print "\nName = $name\n";
}

sub sub3
{
    my $name = "Abhinav";
    print "\nName = $name\n";
}

&sub1; 
```

输出是：

```
Name = Abhishek

Name = Abhijeet

Name = Abhinav 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T16:01:16.710

dinomite 使用 local 重新定义记录分隔符的示例是我在许多 perl 编程中遇到的唯一一次。我生活在一个利基 perl 环境 [安全编程] 中，但根据我的经验，它确实是一个很少使用的范围。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-08-06T08:12:41.570

```
&s;

sub s()
{
    local $s="5";
    &b;
    print $s;
}

sub b()
{
    $s++;
} 
```

上面的脚本打印 6。

但是，如果我们将 local 更改为 my ，它将打印 5。

这就是区别。简单的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-09-17T14:47:37.797

我认为最容易记住它的方法就是这样。MY 创建一个新变量。LOCAL 临时更改现有变量的值。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-14T11:50:39.917

仅当您在子例程中调用了子例程时，它才会有所不同，例如：

```
sub foo { 
    print "$x\n"; 
}
sub bar { my $x; $x = 2; foo(); }

bar(); 
```

它不打印任何内容，因为`$x`受到`{}`bar 的限制，并且对调用的子例程不可见，例如：

```
sub foo { print "$x\n"; }

sub bar { local $x; $x = 2; foo(); }

bar(); 
```

它将打印 2，因为局部变量对被调用的子例程可见。

# visual-studio - 无法访问 http:// :8080

> ID：129618
> 
> 赞同：2
> 
> 时间：2008-09-24T20:14:05.953
> 
> 标签：visual-studio, visual-studio-2008, iis, tfs

我已经安装了 TFS 2008，但我似乎无法访问服务器。当我尝试在 Visual Studio 中连接到它时，我不能。如果我在远程 PC 上通过浏览器尝试，我会得到一个无法显示的通用页面。在服务器上，我得到一个 403。IIS 中没有任何内容，并且该服务作为网络服务运行。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T20:42:51.797

尝试：

[http://localhost:8080/Services/V1.0/ServerStatus.asmx](http://localhost:8080/Services/V1.0/ServerStatus.asmx)。这将告诉您 TFS 是否已启动并正在运行。如果您得到任何其他内容，则需要查看 IIS 问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T07:02:47.423

我写了一篇关于诊断这些类型的 TFS 连接的博客文章。

[http://blogs.msdn.com/granth/archive/2008/06/26/troubleshooting-connections-to-tfs.aspx](http://blogs.msdn.com/granth/archive/2008/06/26/troubleshooting-connections-to-tfs.aspx)

我要做的第一件事是确认它适用于已知良好的配置——通常是我的工作站。

如果它工作正常并且服务器似乎正在运行，接下来我要做的就是要求用户使用 Internet Explorer 调用 CheckAuthentication Web 服务。

此 URL 为：[http://TFSSERVER:8080/services/v1.0/ServerStatus.asmx?op=CheckAuthentication](http://TFSSERVER:8080/services/v1.0/ServerStatus.asmx?op=CheckAuthentication)

通过做这个检查，我做了四件事：

1.  从图片中消除 Team Explorer
2.  从图中消除 .NET 网络堆栈
3.  确保 Windows 身份验证正常工作（这就是我说 IE 的原因）
4.  确保正确设置代理设置

在我见过的大多数情况下，TFS 连接问题是因为代理设置已更改或不正确。因为 .NET 和 Visual Studio 使用 Internet Explorer 中的代理设置，所以正确设置它们很重要。

在极少数情况下，它超出了这个范围。那是我开始研究以下内容的时候：

*   你能解析服务器名称吗？
*   你可以使用IP地址连接吗？
*   是否有 HOSTS 文件条目？（参见：c:\windows\system32\drivers\etc\hosts）
*   你能ping通服务器吗？
*   你能telnet到8080端口吗？
*   用户真的有访问权限吗？运行 TfsSecurity.exe /server:servername /im n:DOMAIN\User 以检查他们的组成员身份
*   您最近是否更改了域密码？在某些情况下，他们需要注销工作站并重新登录以获取新的安全令牌。
*   计算机的域证书是否有效？更新证书：gpupdate /force

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-10T18:00:59.617

原来我电脑上的时间和日期与 tfs 服务器上的时间和日期“不够接近”。更改了我的系统时钟设置，问题就消失了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:29:59.347

如果你直接向服务器发送一个简单的 HTTP 请求会发生什么？

即：telnet 8080 [enter] GET / HTTP/1.1[enter] [enter] [enter]

这可能会暗示 IIS 是否实际上在提供任何服务。如果你可以在服务器上做到这一点，那么从另一台机器上呢？如果结果不同，一个很好的猜测是某处存在一些安全/防火墙问题。HTH 一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T02:27:09.283

我经历了类似问题的所有事情。

我登录到我的 tfs 服务器并直接连接到那里。

我还使用了一段时间前从 Microsoft 下载的 TFS 管理工具，并确保我在所有正确的组和项目中。

然后我带着问题回到客户端 PC，再次尝试了 services/1.0/serverstatus.asmx?op=CheckAuthentication Url，这次成功了。

在我的电脑恢复完整服务之后。

所以我没有确切的答案，但我会仔细阅读格兰特霍利迪在他的回答中提出的清单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-10T06:13:38.480

将此添加到未来用户的案例中，因为我在服务器 2016 上遇到了这个问题......

如果您的防火墙仅允许域和专用网络，它可能无法在客户端上运行。如果服务器网络设置为公共，请确保您授予公共权限...

您可能面临的错误： `ERR_CONNECTION_TIMED_OUT` 对于 `http://fserver:8080/tfs`

# programming-languages - 什么是声明式编程？

> ID：129628
> 
> 赞同：193
> 
> 时间：2008-09-24T20:15:26.857
> 
> 标签：programming-languages, declarative, glossary

我一直听到这个词在几种不同的情况下被反复提及。它是什么？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2008-09-24T20:17:03.980

声明式编程是当您以这样一种方式编写代码时，它描述了您想要做什么，而不是您想要如何做。由编译器决定如何操作。

声明性编程语言的示例是 SQL 和 Prolog。

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2008-09-28T03:35:13.317

其他答案已经很好地解释了声明式编程是什么，所以我将提供一些示例说明为什么它可能有用。

# 上下文独立

声明式程序是*上下文无关的*。因为他们只声明最终目标是什么，而不是达到该目标的中间步骤，所以相同的程序可以在不同的上下文中使用。*这对于命令式程序*很难做到，因为它们通常依赖于上下文（例如隐藏状态）。

举`yacc`个例子。它是一个解析器生成器。compiler 编译器，用于描述语言语法的外部声明性 DSL，以便可以从描述中自动生成该语言的解析器。由于它的上下文独立性，你可以用这样的语法做很多不同的事情：

*   为该语法生成​​一个 C 解析器（的原始用例`yacc`）
*   为该语法生成​​ C++ 解析器
*   为该语法生成​​一个 Java 解析器（使用 Jay）
*   为该语法生成​​ C# 解析器（使用 GPPG）
*   为该语法生成​​一个 Ruby 解析器（使用 Racc）
*   为该语法生成​​树可视化（使用 GraphViz）
*   只需对 yacc 源文件本身做一些漂亮的打印、花哨的格式和语法高亮，并将其作为您的语言的语法规范包含在您的参考手册中

还有很多 …

# 优化

因为你没有规定计算机要采取哪些步骤和顺序，它可以更自由地重新排列你的程序，甚至可以并行执行一些任务。一个很好的例子是 SQL 数据库的查询计划器和查询优化器。大多数 SQL 数据库允许您显示它们*实际*执行的查询与您*要求*它们执行的查询。通常，这些查询看起来*什么都没有*互相喜欢。查询计划器会考虑您甚至做梦都想不到的事情：例如磁盘盘片的旋转延迟，或者针对完全不同的用户的一些完全不同的应用程序刚刚执行了类似的查询和您所在的表这一事实加入并且你努力避免加载已经在内存中。

这里有一个有趣的权衡：与命令式语言相比，机器必须更加努力地弄清楚*如何*做某事，但是当它*确实*弄清楚时，它有更多的自由和更多的优化信息阶段。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-07-20T21:49:06.167

松散地：

**声明式编程倾向于：-**

*   一组声明或声明性语句，每个都有意义（通常在问题域中）并且可以独立和孤立地理解。

**命令式编程倾向于：-**

*   命令序列，每个命令执行一些动作；但这在问题域中可能有意义，也可能没有意义。

因此，命令式风格可以帮助读者理解系统实际在做什么的机制，但可能无法深入了解它打算解决的问题。另一方面，声明式风格有助于读者理解问题域和系统为解决问题而采取的方法，但在力学问题上的信息量较少。

真正的程序（即使是用偏爱光谱末端的语言编写的程序，例如 ProLog 或 C）往往在不同的点上都有不同程度的两种风格，以满足作品的不同复杂性和交流需求。一种风格并不优于另一种风格；它们只是用于不同的目的，并且与生活中的许多事情一样，适度是关键。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2014-07-14T23:45:12.050

**这是一个例子。**

在 CSS（用于设置 HTML 页面的样式）中，如果您希望图像元素的高度为 100 像素，宽度为 100 像素，您只需“声明”这就是您想要的，如下所示：

```
#myImageId {
height: 100px;
width: 100px;
} 
```

您可以将 CSS 视为一种声明性“样式表”语言。

读取和*解释*这个 CSS 的浏览器引擎可以随意使图像看起来这么高和这么宽，但是它想要的。不同的浏览器引擎（例如，IE 的引擎，Chrome 的引擎）会以不同的方式实现这个任务。

当然，它们独特的实现不是用声明性语言编写的，而是用像汇编、C、C++、Java、JavaScript 或 Python 这样的过程语言编写的。该代码是一系列逐步执行的步骤（可能包括函数调用）。它可能会做一些事情，比如插入像素值，并在屏幕上渲染。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-12-03T05:48:19.247

我很抱歉，但我必须不同意许多其他答案。我想停止这种对声明式编程定义的混乱误解。

**定义**

[子表达式的引用透明性 (RT) 是声明式编程表达式的*唯一必需*](https://stackoverflow.com/questions/602444/what-is-functional-declarative-and-imperative-programming/8357604#8357604)属性，因为它是唯一不与命令式编程共享的属性。

声明式编程的其他引用属性源自此 RT。请点击上面的超链接查看详细说明。

**电子表格示例**

两个答案提到了电子表格编程。在电子表格编程（又名公式）不访问可变*全局*状态的情况下，它是声明式编程。这是因为可变单元格值是（整个程序）的整体输入*和*输出*。*`main()`执行每个公式后，新值不会写入单元格，因此它们在声明性程序的生命周期内不可变（执行电子表格中的所有公式）。因此，相对于彼此，公式将这些可变单元格视为不可变的。允许 RT 函数访问*不可变*的全局状态（以及[可变*的局部*状态](https://stackoverflow.com/a/8346779)）。

因此，当程序终止时（作为 的输出`main()`）改变单元格中的值的能力不会使它们在规则的上下文中成为可变的存储值。关键区别是在执行每个电子表格公式后单元格值不会更新，因此执行公式的顺序无关紧要。执行完所有声明性公式后，单元格值会更新。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-24T20:21:46.497

声明式编程就是一幅画，而命令式编程是画那幅画的指令。

如果您是在“告诉它它是什么”，而不是描述计算机到达您想要的地方应该采取的步骤，那么您就是在以声明性风格写作。

当您使用 XML 标记数据时，您使用的是声明式编程，因为您在说“这是一个人，那是一个生日，那边是一个街道地址”。

声明式和命令式编程结合以获得更大效果的一些示例：

*   Windows Presentation Foundation 使用声明性 XML 语法来描述用户界面的外观，以及控件和基础数据结构之间的关系（绑定）。

*   结构化配置文件使用声明性语法（就像“key=value”对一样简单）来识别字符串或数据值的含义。

*   HTML 使用标签标记文本，这些标签描述了每段文本相对于整个文档的作用。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-08-06T21:43:26.800

声明式编程是使用声明进行编程，即声明性语句。陈述句有许多区别于祈使句的特性。特别是，声明是：

*   可交换的（可以重新排序）
*   联想（可以重新组合）
*   幂等（可以重复而不改变含义）
*   单调的（声明不减去信息）

相关的一点是，这些都是结构属性并且与主题正交。声明式不是关于*“什么与如何”*。*我们可以像声明“what”*一样轻松声明（表示和约束）*“how* ” 。**声明式是关于结构，而不是内容。**声明式编程对我们如何抽象和重构代码以及如何将其模块化为子程序有重大影响，但对领域模型影响不大。

 ***通常，我们可以通过添加上下文从命令式转换为声明式。例如来自“向左转。（……等待它……）向右转。” 到“鲍勃将在 11:01 在 Foo 和 Bar 的交叉口左转。Bob 将在 11:06 在 Bar 和 Baz 的交叉口右转。” 请注意，在后一种情况下，句子是幂等和可交换的，而在前一种情况下，重新排列或重复句子会严重改变程序的含义。

关于*单调*，声明可以添加减少*可能性的**约束*。但是约束仍然增加了信息（更准确地说，约束就是信息）。如果我们需要随时间变化的声明，通常使用明确的时间语义对此进行建模——例如从“球是平的”到“球在时间 T 是平的”。如果我们有两个相互矛盾的声明，我们就会有一个不一致的声明系统，尽管这可以通过引入*软*约束（优先级、概率等）或利用超一致性逻辑来解决。

 *** * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-24T21:57:30.323

向计算机描述你想要什么，而不是如何做某事。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-24T22:47:15.947

想象一个excel页面。使用填充公式的列来计算您的纳税申报表。

所有的逻辑都是在单元格中声明的，计算的顺序是由公式本身决定的，而不是程序上的。

这就是声明式编程的全部内容。您声明问题空间和解决方案，而不是程序的流程。

Prolog 是我使用的唯一声明性语言。它需要一种不同的思维方式，但如果只是让您接触典型的过程编程语言以外的东西，那么学习它是件好事。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2012-07-06T18:08:38.550

自从 2011 年 12 月我提供了这个问题[的答案](https://stackoverflow.com/a/8365840/615784)以来，我已经完善了对声明式编程的理解。以下是我目前的理解。

我的理解（研究）的详细版本在**[此链接](http://copute.com/docs/Event.html#Declarative_Programming)**中进行了详细说明，您应该阅读它以深入了解我将在下面提供的摘要。

命令式编程是存储和读取可变状态的地方，因此程序指令的排序和/或重复可以改变程序的行为（语义）（甚至导致错误，即意外行为）。

在最幼稚和极端的意义上（我在之前的回答中断言），声明式编程（DP）正在避免所有存储的可变状态，因此程序指令的排序和/或重复**不能**改变程序的行为（语义） .

然而，这样一个极端的定义在现实世界中并不是很有用，因为几乎每个程序都涉及存储的可变状态。[电子表格示例](https://stackoverflow.com/a/8365840/615784)符合 DP的这种极端定义，因为在存储新状态之前，整个程序代码都使用输入状态的一个静态副本运行到完成。然后，如果任何状态发生变化，则重复此操作。但是大多数现实世界的程序不能局限于这种状态变化的单一模型。

DP 的一个更有用的定义是编程指令的排序和/或重复不会改变任何不透明的语义。换句话说，语义上不会发生隐藏的随机变化——程序指令顺序和/或重复的任何变化只会导致程序行为的预期和透明的变化。

下一步将讨论哪些编程模型或范式有助于 DP，但这不是这里的问题。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-24T20:20:23.303

这是一种基于描述某事应该做什么或应该做什么而不是描述*它*应该*如何工作的编程方法。*

换句话说，你不需要编写由表达式组成的算法，你只是按照你想要的方式进行布局。两个很好的例子是 HTML 和 WPF。

这篇维基百科文章是一个很好的概述：[http ://en.wikipedia.org/wiki/Declarative_programming](http://en.wikipedia.org/wiki/Declarative_programming)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-03-13T10:14:02.260

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-07-20T20:49:20.357

声明式编程是“使用符合开发人员心理模型而不是机器操作模型的语言进行编程的行为”。

解析结构化数据的问题很好地说明了声明式编程和命令式编程之间的区别。

命令式程序将使用相互递归的函数来使用输入并生成数据。声明性程序将表达定义数据结构的语法，以便随后对其进行解析。

这两种方法之间的区别在于，声明性程序创建了一种新语言，该语言比其宿主语言更接近于问题的心理模型。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-05-01T08:12:54.233

听起来可能很奇怪，但我会将 Excel（或任何电子表格）添加到声明性系统列表中。[这里](http://www.oaltd.co.uk/ProExcelDev/ProXLCh01.htm)给出了一个很好的例子。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-29T11:39:16.060

我会解释为 DP 是一种表达方式

*   一个*目标表达式*，我们正在寻找的条件。有一个，也许还是很多？
*   一些已知的事实
*   扩展已知事实的规则

...并且有一个扣除引擎通常使用*统一*算法来找到目标。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-24T22:40:52.233

据我所知，它开始被用来描述像 Prolog 这样的编程系统，因为 prolog（据说）是关于以抽象的方式声明事物。

它的意义越来越小，因为它具有上述用户给出的定义。应该清楚的是，Haskell 的声明式编程与 HTML 的声明式编程之间存在鸿沟。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2008-09-24T20:39:03.007

声明式编程的其他几个例子：

*   用于数据绑定的 ASP.Net 标记。例如，它只是说“用这个源填充这个网格”，并将它留给系统如何发生。
*   Linq 表达式

声明式编程很好，因为它可以帮助[您简化代码的心智模型](http://www.fallingcanbedeadly.com/posts/beyond-loops)，并且因为它最终可能更具可扩展性。

例如，假设您有一个函数对数组或列表中的每个元素执行某些操作。传统代码如下所示：

```
foreach (object item in MyList)
{
   DoSomething(item);
} 
```

没什么大不了的。但是，如果您使用更具声明性的语法并将 DoSomething() 定义为 Action 会怎样？然后你可以这样说：

```
MyList.ForEach(DoSometing); 
```

当然，这更简洁。但我敢肯定，除了在这里和那里保存两行代码之外，您还有更多的顾虑。以性能为例。旧的方式，处理必须按顺序进行。如果 .ForEach() 方法有办法让您发出信号，表明它可以自动并行处理处理怎么办？现在突然之间，您以一种非常安全的方式使您的代码成为多线程的，并且只更改了一行代码。而且，事实上，.Net 有一个[扩展程序](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)可以让您做到这一点。

*   *如果您点击该链接，它会将您带到我朋友的博客文章。整篇文章有点长，但您可以向下滚动到标题为*“问题”的标题_并在那里拿起它没问题。*

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2014-06-30T10:37:25.317

这取决于您如何提交文本的答案。总体而言，您可以从某个角度查看程序，但这取决于您查看问题的角度。我将帮助您开始该程序：Dim Bus, Car, Time, Height As Integr

同样，这取决于问题的总体情况。由于程序的原因，您可能不得不缩短它。希望这会有所帮助，如果没有，则需要反馈。谢谢你。

# c# - 如何创建 C# 登录处理程序

> ID：129629
> 
> 赞同：2
> 
> 时间：2008-09-24T20:15:27.683
> 
> 标签：c#, .net, asp.net, security, web-applications

我将如何在 C# 中创建 Web 应用程序登录处理程序？

在 Java 中，我将使用 JSP 将用户名和密码发布到 servlet，然后委托给 POJO - 用于数据库查找和验证。如果验证失败，则 servlet 转发到 login.jsp 以进行另一次尝试，如果成功则转发到安全资源。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T20:16:51.360

查看[**表单身份验证**](https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ff647070(v=pandp.10))。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T20:26:39.667

主要是术语问题。让我把你的 Java 翻译成 ASP.NET MVC：

> 在 ASP.NET MVC 中，我将使用 HTML 视图将用户名和密码发布到控制器操作，然后委托给 POCO - 用于数据库查找和验证。如果验证失败，控制器将呈现登录视图以进行另一次尝试，如果成功则转发到安全资源。

并且，对于 WebForms：

> 在 ASP.NET WebForms 中，我将使用 LoginControl 将用户名和密码回发到 Login.aspx 代码隐藏，然后委托给 POCO - 用于数据库查找和验证。如果验证失败，Login.aspx 页面将再次显示以进行另一次尝试，如果成功则重定向到安全资源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T20:30:11.780

Visual Studio 中的 .NET 网站管理工具非常适合初学者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:20:18.590

在 asp.net 网络表单模型中，每个页面都回发给自己。创建一个与单击按钮相关联的函数以进行数据库查找和验证。

这是 VB.net 中的一个示例，可以使用 vb 到 c# 转换器轻松转换为 c#：

[http://www.sitepoint.com/article/securing-passwords-database/](http://www.sitepoint.com/article/securing-passwords-database/)

# c# - 如何播放声音文件

> ID：129642
> 
> 赞同：7
> 
> 时间：2008-09-24T20:17:18.020
> 
> 标签：c#, audio, mp3

使用 C#，我如何播放（暂停、转发...）声音文件（mp3、ogg）？该文件可能在硬盘上，也可能在互联网上。

是否有任何图书馆或类可以减轻我的工作？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T20:27:51.037

如果你不介意在你的项目中包含**Microsoft.VisualBasic.dll**，你可以这样做：

```
var audio = new Microsoft.VisualBasic.Devices.Audio();
audio.Play("some file path"); 
```

如果你想做更复杂的事情，我知道的最简单的方法是使用**Windows Media Player API**。您添加 DLL，然后使用它。API 有点笨拙，但确实有效；我用它来制作我自己的围绕 Windows Media Player 的音乐播放器包装器以供个人使用。以下是一些帮助您入门的有用链接：

[使用 ASP .NET 2.0 构建网站以导航您的音乐库](http://blogs.msdn.com/coding4fun/archive/2006/10/31/913360.aspx)

[Windows 媒体对象模型](http://msdn.microsoft.com/en-us/library/bb249259.aspx)

[让音乐播放！](http://blogs.msdn.com/vbteam/archive/2007/10/30/let-the-music-play-matt-gertz.aspx)

**编辑：**

自从我写了这个，我找到了一个更简单的方法，如果你不介意在你的代码中包含 WPF 类。WPF（.NET 3.0 及更高版本）有一个[MediaPlayer](http://msdn.microsoft.com/en-us/library/system.windows.media.mediaplayer.aspx)类，它是 Windows Media Player 的包装器。这意味着您不必编写自己的包装器，这很好，因为正如我上面提到的，WMP API 相当笨重且难以使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T20:31:17.427

我会推荐[BASS 库](http://un4seen.com/)。它可以播放基于文件的音乐文件和流媒体内容。还有一个 .NET 包装器可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-12T12:12:44.930

[Alvas.Audio](http://alvas.net)具有具有以下可能性的[RecordPlayer类：](http://alvas.net/alvas.audio,samples.aspx#sample1)

```
 public static void TestRecordPlayer()
        {
            RecordPlayer rp = new RecordPlayer();
            rp.PropertyChanged += new PropertyChangedEventHandler(rp_PropertyChanged);
            rp.Open(new Mp3Reader(File.OpenRead("in.mp3")));
            rp.Play();
            rp.Forward(1000);
            rp.Pause();
        }

        static void rp_PropertyChanged(object sender, PropertyChangedEventArgs e)
        {
            switch (e.PropertyName)
            {
                case RecordPlayer.StateProperty:
                    RecordPlayer rp = ((RecordPlayer)sender);
                    if (rp.State == DeviceState.Stopped)
                    {
                        rp.Close();
                    }
                    break;
            }
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:36:38.117

有一个媒体播放器控件——基本上是媒体播放器使用的。你可以把它放在你的程序中，并且有一个 API 可以用来控制它。我认为这是最好的快速解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:20:15.737

使用[PlaySound API 调用](http://www.codeproject.com/KB/audio-video/PlaySounds1.aspx)

# c# - C# + Castle ActiveRecord：HasAndBelongsToMany 和集合

> ID：129650
> 
> 赞同：3
> 
> 时间：2008-09-24T20:17:55.803
> 
> 标签：c#, .net, nhibernate, hql, castle-activerecord

假设我在帖子和标签之间有多对多关系（使用 ActiveRecord 属性 HasAndBelongsToMany）（更改域名对象名称以保护无辜者），我想要一个类似的方法

```
FindAllPostByTags(IList<Tag> 标签)
```

返回参数中包含所有（不仅仅是部分）标签的所有帖子。我可以通过 NHibernate Expressions 或 HQL 来实现这一点吗？我搜索了 HQL 文档，但找不到任何适合我需要的东西。我希望我只是错过了一些明显的东西！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T10:41:41.527

你也可以只使用一个`IN`语句

```
DetachedCriteria query = DetachedCriteria.For<Post>();
query.CreateCriteria("Post").Add(Expression.In("TagName",  string.Join(",",tags.ToArray()) ); 
```

我还没有编译，所以它可能有错误

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T22:33:23.670

我现在没有安装 Castle 的系统，所以我没有测试或编译它，但下面的代码应该可以满足您的需求。

```
Junction c = Expression.Conjunction();
foreach(Tag t in tags)
    c = c.Add( Expression.Eq("Tag", t);

return sess.CreateCriteria(typeof(Post)).Add(c).List(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-06T14:53:03.273

我只是遇到了同样的问题并尝试阅读 HQL 文档，但是 NHibernate 中似乎没有实现某些功能（例如，带有关键字）

我最终得到了这种解决方案：

```
选择 p
发件人
加入 p.Tags tag1
加入 p.Tags tag2
在哪里
    标签1.Id = 1
    tag2.Id = 2

```

意思是，使用 join 为每个标签动态构建 HQL，然后在 WHERE 子句中进行选择。这对我有用。我尝试使用 DetachedCriteria 做同样的事情，但在尝试多次加入表格时遇到了麻烦。

# html - 如何防止 DIV 扩展以占用所有可用宽度？

> ID：129651
> 
> 赞同：24
> 
> 时间：2008-09-24T20:18:09.563
> 
> 标签：html, css

在下面的 HTML 中，我希望图像周围的框架紧贴 - 不要拉伸并占用父容器中的所有可用宽度。我知道有几种方法可以做到这一点（包括可怕的事情，比如手动将其宽度设置为特定数量的像素），但*正确*的方法是什么？

**编辑：**一个答案建议我关闭“显示：块” - 但这会导致渲染在我测试过的每个浏览器中看起来格式不正确。有没有办法使用“显示：块”获得漂亮的渲染离开？

**编辑：**如果我将“float:left”添加到相框并将“clear:both”添加到 P 标签，它看起来很棒。但我并不总是希望这些帧向左浮动。有没有更直接的方法来完成“浮动”正在做的事情？

```
.pictureframe {
  display: block;
  margin: 5px;
  padding: 5px;
  border: solid brown 2px;
  background-color: #ffeecc;
}
#foo {
  border: solid blue 2px;
  float: left;
}
img {
  display: block;
}
```

```
<div id="foo">
  <span class="pictureframe">
       <img alt=''
        src="http://stackoverflow.com/favicon.ico" />
  </span>
  <p>
    Why is the beige rectangle so wide?
  </p>
</div>
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-24T20:23:27.150

*正确*的方法是使用：

```
.pictureframe {
    display: inline-block;
} 
```

**编辑：**浮动元素也产生相同的效果，这是因为浮动元素使用相同的[缩小以适应](http://www.w3.org/TR/CSS21/visudet.html#shrink-to-fit-float)算法来确定宽度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T20:20:16.017

米色矩形非常宽，因为您有 display: block 在跨度上，将内联元素变成块元素。块元素应该占据所有可用宽度，而内联元素则不会。尝试从 css 中删除 display: 块。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T21:02:05.137

将“float:left”添加到 span.pictureFrame 选择器可以解决问题，因为“float:left”就是这样做的 :) 除了将元素浮动到左侧将使其仅占用其内容所需的空间之外。任何随后的块元素（例如“p”）都将围绕“浮动”元素浮动。如果您“清除”“p”的浮动，它将遵循正常的文档流，从而低于 span.pictureFrame。实际上，您需要“clear:left”，因为该元素已被“float:left”-ed。要获得更正式的解释，您可以查看 CSS 规范，尽管它超出了大多数人的理解范围。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T20:46:23.070

是 `display:inline-block`的，是你的朋友。也看看：`display:-moz-inline-block`和`display:-moz-inline-box`。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-24T20:35:11.083

我能够跨浏览器可靠地制作相框的唯一方法是动态设置宽度。下面是一个使用 jQuery 的例子：

```
$(window).load(function(){
  $('img').wrap('<div class="pictureFrame"></div>');
  $('div.pictureFrame').each(function(i) {
    $(this).width($('*:first', this).width());
  });
}); 
```

即使您不提前知道图像尺寸，这也会起作用，因为它会等待图像加载（注意我们之前使用的是 $(window).load 而不是更常见的 $(document).ready）添加相框。这有点难看，但它有效。

这是此示例的图片框架 CSS：

```
.pictureFrame {
  background-color:#FFFFFF;
  border:1px solid #CCCCCC;
  line-height:0;
  padding:5px;
} 
```

我很想看到一个可靠的、跨浏览器的、纯 CSS 的解决方案来解决这个问题。这个解决方案是我在试图让它只使用 CSS 和 HTML 时遇到很多挫折后为过去的项目提出的。

# php - 如何使用 PHP 清理用户输入？

> ID：129677
> 
> 赞同：1222
> 
> 时间：2008-09-24T20:20:39.650
> 
> 标签：php, security, xss, sql-injection, user-input

是否有一个包罗万象的功能可以很好地清理用户输入以进行 SQL 注入和 XSS 攻击，同时仍然允许某些类型的 HTML 标记？

* * *

## 回答 #1

> 赞同：1254
> 
> 时间：2008-09-24T22:30:37.000

用户输入可以被过滤是一个常见的误解。PHP 甚至有一个（现已弃用）“功能”，称为[magic-quotes](https://www.php.net/manual/en/security.magicquotes.php)，它建立在这个想法之上。这是胡说八道。忘记过滤（或清洁，或任何人们所说的）。

为了避免问题，您应该做的事情非常简单：每当您将一段数据嵌入到外部代码中时，您必须根据该代码的格式规则来处理它。但是您必须了解，此类规则可能过于复杂，无法尝试手动遵循它们。例如，在 SQL 中，字符串、数字和标识符的规则都是不同的。为方便起见，在大多数情况下，此类嵌入都有专用工具。例如，当您需要在 SQL 查询中使用 PHP 变量时，您必须使用准备好的语句，这将负责所有正确的格式/处理。

另一个例子是 HTML：如果你在 HTML 标记中嵌入字符串，你必须用[`htmlspecialchars`](http://php.net/manual/function.htmlspecialchars.php). 这意味着每个单独的`echo`or`print`语句都应该使用`htmlspecialchars`.

第三个示例可能是 shell 命令：如果您要将字符串（例如参数）嵌入到外部命令中，并使用 调用它们[`exec`](http://php.net/manual/function.exec.php)，那么您必须使用[`escapeshellcmd`](http://php.net/manual/function.escapeshellcmd.php)and [`escapeshellarg`](http://php.net/manual/function.escapeshellarg.php)。

此外，一个非常引人注目的例子是 JSON。规则如此繁多和复杂，以至于您永远无法手动遵循它们。这就是为什么您永远不应该手动创建 JSON 字符串，而始终使用专用函数[`json_encode()`](https://www.php.net/json_encode)来正确格式化每一位数据。

等等等等 ...

您需要主动过滤数据的*唯一*情况是您接受预格式化的输入。例如，如果您让您的用户发布您计划在网站上显示的 HTML 标记。但是，您应该明智地不惜一切代价避免这种情况，因为无论您过滤它的效果如何，它始终是一个潜在的安全漏洞。

* * *

## 回答 #2

> 赞同：234
> 
> 时间：2008-10-09T06:28:05.950

不要试图通过清理输入数据来防止 SQL 注入。

相反，**不要在创建 SQL 代码时使用数据**。使用使用绑定变量的预处理语句（即在模板查询中使用参数）。这是保证免受 SQL 注入的唯一方法。

有关防止 SQL 注入的更多信息，请参阅我的网站[http://bobby-tables.com/](http://bobby-tables.com/)。

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2008-09-24T20:24:03.793

不，你不能在没有任何上下文的情况下过滤数据。有时您希望将 SQL 查询作为输入，有时您希望将 HTML 作为输入。

您需要过滤白名单上的输入——确保数据符合您期望的某些规范。然后，您需要在使用它之前对其进行转义，具体取决于您使用它的上下文。

为 SQL 转义数据的过程 - 以防止 SQL 注入 - 与为 (X)HTML 转义数据以防止 XSS 的过程非常不同。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2008-09-24T23:12:57.570

PHP 现在有了新的不错的功能，例如，现在有一个内置类型[`filter_input`](https://www.php.net/manual/en/function.filter-input.php)，可以让您从寻找“终极电子邮件正则表达式”中解放出来`FILTER_VALIDATE_EMAIL`

* * *

我自己的过滤器类（使用 JavaScript 突出显示错误字段）可以通过 ajax 请求或普通表单发布来启动。（见下面的例子） <? /** * 猪肉表单验证器。通过正则表达式验证字段并对其进行清理。使用 PHP filter_var 内置函数和额外的正则表达式 * @package pig */

```
/**
 *  Pork.FormValidator
 *  Validates arrays or properties by setting up simple arrays. 
 *  Note that some of the regexes are for dutch input!
 *  Example:
 * 
 *  $validations = array('name' => 'anything','email' => 'email','alias' => 'anything','pwd'=>'anything','gsm' => 'phone','birthdate' => 'date');
 *  $required = array('name', 'email', 'alias', 'pwd');
 *  $sanitize = array('alias');
 *
 *  $validator = new FormValidator($validations, $required, $sanitize);
 *                  
 *  if($validator->validate($_POST))
 *  {
 *      $_POST = $validator->sanitize($_POST);
 *      // now do your saving, $_POST has been sanitized.
 *      die($validator->getScript()."<script type='text/javascript'>alert('saved changes');</script>");
 *  }
 *  else
 *  {
 *      die($validator->getScript());
 *  }   
 *  
 * To validate just one element:
 * $validated = new FormValidator()->validate('blah@bla.', 'email');
 * 
 * To sanitize just one element:
 * $sanitized = new FormValidator()->sanitize('<b>blah</b>', 'string');
 * 
 * @package pork
 * @author SchizoDuckie
 * @copyright SchizoDuckie 2008
 * @version 1.0
 * @access public
 */
class FormValidator
{
    public static $regexes = Array(
            'date' => "^[0-9]{1,2}[-/][0-9]{1,2}[-/][0-9]{4}\$",
            'amount' => "^[-]?[0-9]+\$",
            'number' => "^[-]?[0-9,]+\$",
            'alfanum' => "^[0-9a-zA-Z ,.-_\\s\?\!]+\$",
            'not_empty' => "[a-z0-9A-Z]+",
            'words' => "^[A-Za-z]+[A-Za-z \\s]*\$",
            'phone' => "^[0-9]{10,11}\$",
            'zipcode' => "^[1-9][0-9]{3}[a-zA-Z]{2}\$",
            'plate' => "^([0-9a-zA-Z]{2}[-]){2}[0-9a-zA-Z]{2}\$",
            'price' => "^[0-9.,]*(([.,][-])|([.,][0-9]{2}))?\$",
            '2digitopt' => "^\d+(\,\d{2})?\$",
            '2digitforce' => "^\d+\,\d\d\$",
            'anything' => "^[\d\D]{1,}\$"
    );
    private $validations, $sanatations, $mandatories, $errors, $corrects, $fields;

    public function __construct($validations=array(), $mandatories = array(), $sanatations = array())
    {
        $this->validations = $validations;
        $this->sanitations = $sanitations;
        $this->mandatories = $mandatories;
        $this->errors = array();
        $this->corrects = array();
    }

    /**
     * Validates an array of items (if needed) and returns true or false
     *
     */
    public function validate($items)
    {
        $this->fields = $items;
        $havefailures = false;
        foreach($items as $key=>$val)
        {
            if((strlen($val) == 0 || array_search($key, $this->validations) === false) && array_search($key, $this->mandatories) === false) 
            {
                $this->corrects[] = $key;
                continue;
            }
            $result = self::validateItem($val, $this->validations[$key]);
            if($result === false) {
                $havefailures = true;
                $this->addError($key, $this->validations[$key]);
            }
            else
            {
                $this->corrects[] = $key;
            }
        }

        return(!$havefailures);
    }

    /**
     *
     *  Adds unvalidated class to thos elements that are not validated. Removes them from classes that are.
     */
    public function getScript() {
        if(!empty($this->errors))
        {
            $errors = array();
            foreach($this->errors as $key=>$val) { $errors[] = "'INPUT[name={$key}]'"; }

            $output = '$$('.implode(',', $errors).').addClass("unvalidated");'; 
            $output .= "new FormValidator().showMessage();";
        }
        if(!empty($this->corrects))
        {
            $corrects = array();
            foreach($this->corrects as $key) { $corrects[] = "'INPUT[name={$key}]'"; }
            $output .= '$$('.implode(',', $corrects).').removeClass("unvalidated");';   
        }
        $output = "<script type='text/javascript'>{$output} </script>";
        return($output);
    }

    /**
     *
     * Sanitizes an array of items according to the $this->sanitations
     * sanitations will be standard of type string, but can also be specified.
     * For ease of use, this syntax is accepted:
     * $sanitations = array('fieldname', 'otherfieldname'=>'float');
     */
    public function sanitize($items)
    {
        foreach($items as $key=>$val)
        {
            if(array_search($key, $this->sanitations) === false && !array_key_exists($key, $this->sanitations)) continue;
            $items[$key] = self::sanitizeItem($val, $this->validations[$key]);
        }
        return($items);
    }

    /**
     *
     * Adds an error to the errors array.
     */ 
    private function addError($field, $type='string')
    {
        $this->errors[$field] = $type;
    }

    /**
     *
     * Sanitize a single var according to $type.
     * Allows for static calling to allow simple sanitization
     */
    public static function sanitizeItem($var, $type)
    {
        $flags = NULL;
        switch($type)
        {
            case 'url':
                $filter = FILTER_SANITIZE_URL;
            break;
            case 'int':
                $filter = FILTER_SANITIZE_NUMBER_INT;
            break;
            case 'float':
                $filter = FILTER_SANITIZE_NUMBER_FLOAT;
                $flags = FILTER_FLAG_ALLOW_FRACTION | FILTER_FLAG_ALLOW_THOUSAND;
            break;
            case 'email':
                $var = substr($var, 0, 254);
                $filter = FILTER_SANITIZE_EMAIL;
            break;
            case 'string':
            default:
                $filter = FILTER_SANITIZE_STRING;
                $flags = FILTER_FLAG_NO_ENCODE_QUOTES;
            break;

        }
        $output = filter_var($var, $filter, $flags);        
        return($output);
    }

    /** 
     *
     * Validates a single var according to $type.
     * Allows for static calling to allow simple validation.
     *
     */
    public static function validateItem($var, $type)
    {
        if(array_key_exists($type, self::$regexes))
        {
            $returnval =  filter_var($var, FILTER_VALIDATE_REGEXP, array("options"=> array("regexp"=>'!'.self::$regexes[$type].'!i'))) !== false;
            return($returnval);
        }
        $filter = false;
        switch($type)
        {
            case 'email':
                $var = substr($var, 0, 254);
                $filter = FILTER_VALIDATE_EMAIL;    
            break;
            case 'int':
                $filter = FILTER_VALIDATE_INT;
            break;
            case 'boolean':
                $filter = FILTER_VALIDATE_BOOLEAN;
            break;
            case 'ip':
                $filter = FILTER_VALIDATE_IP;
            break;
            case 'url':
                $filter = FILTER_VALIDATE_URL;
            break;
        }
        return ($filter === false) ? false : filter_var($var, $filter) !== false ? true : false;
    }       

} 
```

当然，请记住，您还需要根据您使用的数据库类型进行 sql 查询转义（例如，mysql_real_escape_string() 对于 sql server 是无用的）。您可能希望在适当的应用程序层（如 ORM）自动处理此问题。另外，如上所述：要输出到 html，请使用其他 php 专用函数，例如 htmlspecialchars ;)

为了真正允许带有类似剥离类和/或标签的 HTML 输入，取决于专用的 xss 验证包之一。不要编写自己的正则表达式来解析 HTML！

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2008-09-24T20:30:01.890

不，那里没有。

首先，SQL 注入是一个输入过滤问题，而 XSS 是一个输出转义问题——因此您甚至不会在代码生命周期中同时执行这两个操作。

基本经验法则

*   对于 SQL 查询，绑定参数（与 PDO 一样）或对查询变量使用驱动程序原生转义函数（例如[`mysql_real_escape_string()`](https://www.php.net/manual/en/function.mysql-real-escape-string.php)）
*   用于[`strip_tags()`](https://www.php.net/manual/en/function.strip-tags.php)过滤掉不需要的 HTML
*   使用此处的第二个和第三个参数转义所有其他输出[`htmlspecialchars()`](https://www.php.net/manual/en/function.htmlspecialchars.php)并注意。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2008-09-24T20:29:16.447

要解决 XSS 问题，请查看[HTML Purifier](http://www.htmlpurifier.org)。它是相当可配置的，并且有不错的记录。

至于 SQL 注入攻击，请确保检查用户输入，然后通过 mysql_real_escape_string() 运行它。但是，该函数不会击败所有注入攻击，因此在将数据转储到查询字符串之前检查数据很重要。

更好的解决方案是使用准备好的语句。[PDO 库](http://www.php.net/pdo)和mysqli 扩展支持这些。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2012-10-15T08:40:08.863

PHP 5.2 引入了该[`filter_var`](http://php.net/manual/en/function.filter-var.php)功能。

它支持大量的`SANITIZE`过滤`VALIDATE`器。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2018-02-25T06:11:55.767

> ## 使用 PHP 清理用户输入的方法：

*   ### 使用现代版本的 MySQL 和 PHP。

*   ### 明确设置字符集：

    *   ```
        $mysqli->set_charset("utf8");
        ```

        ^([手动的](http://php.net/manual/en/mysqli.set-charset.php))
    *   ```
        $pdo = new PDO('mysql:host=localhost;dbname=testdb;charset=UTF8', $user, $password);
        ```

        ^([手动的](http://php.net/manual/en/pdo.construct.php))
    *   ```
        $pdo->exec("设置名称 utf8");
        ```

        ^([手动的](http://php.net/manual/en/pdo.exec.php))
    *   ```
        $pdo = 新的 PDO(
        "mysql:host=$host;dbname=$db", $user, $pass,
        大批（
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::MYSQL_ATTR_INIT_COMMAND => "设置名称 utf8"
        )
        );
        ```

        ^([手动的](http://php.net/manual/en/ref.pdo-mysql.php))
    *   ```
        mysql_set_charset('utf8')
        ```

        ^([在 PHP 5.5.0 中弃用，在 PHP 7.0.0 中删除]。)
*   ### 使用安全字符集：

    *   选择 utf8、latin1、ascii..，不要使用易受攻击的字符集 big5、cp932、gb2312、gbk、sjis。
*   ### 使用空间化函数：

    *   [MySQLi 准备好的语句：](http://php.net/manual/en/mysqli.prepare.php)

        ```
        $stmt = $mysqli->prepare('SELECT * FROM test WHERE name = ? LIMIT 1'); 
        $param = "' OR 1=1 /*"; 
        $stmt->bind_param('s', $param); 
        $stmt->执行（）；
        ```

    *   [PDO::quote()](http://php.net/manual/en/class.pdo.php) - 在输入字符串周围放置引号（如果需要）并转义输入字符串中的特殊字符，使用适合底层驱动程序的引用样式：

        ```
        $pdo = new PDO('mysql:host=localhost;dbname=testdb;charset=UTF8', $user, $password); 显式设置字符集
        $pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, false); 禁用模拟准备好的语句以防止回退到模拟 MySQL 无法本地准备的语句（以防止注入）
         $var = $pdo->quote("' OR 1=1 /*"); 不仅转义文字，还引用它（在单引号 ' 字符中）
        $stmt = $pdo->query("SELECT * FROM test WHERE name = $var LIMIT 1");

        ```

    *   [PDO Prepared Statements](http://php.net/manual/en/pdo.prepare.php) : vs MySQLi Prepared statements 支持更多的数据库驱动程序和命名参数：

        ```
        $pdo = new PDO('mysql:host=localhost;dbname=testdb;charset=UTF8', $user, $password); 显式设置字符集
        $pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, false); 禁用模拟准备好的语句以防止回退到模拟 MySQL 无法本地准备的语句（以防止注入）
        $stmt = $pdo->prepare('SELECT * FROM test WHERE name = ? LIMIT 1');
        $stmt->execute(["' OR 1=1 /*"]);
        ```

    *   [~~mysql_real_escape_string~~](http://php.net/manual/en/function.mysql-real-escape-string.php) ^([在 PHP 5.5.0 中弃用，在 PHP 7.0.0 中删除]。)
    *   [mysqli_real_escape_string](http://php.net/manual/en/mysqli.real-escape-string.php)转义字符串中的特殊字符以用于 SQL 语句，同时考虑连接的当前字符集。但是推荐使用Prepared Statements，因为它们不是简单的转义字符串，一条语句会拿出一个完整的查询执行计划，包括它会使用哪些表和索引，这是一种优化的方式。
    *   在查询中的变量周围使用单引号 (' ')。
*   ### 检查变量是否包含您所期望的：

    *   如果您期望一个整数，请使用：

        ```
        ctype_digit — 检查数字字符；
        $value = (int) $value; 
        $value = intval($value); 
        $var = filter_var('0755', FILTER_VALIDATE_INT, $options);
        ```

    *   对于字符串使用：

        ```
        is_string() — 查找变量的类型是否为字符串
        ```

        使用[过滤器函数](http://php.net/manual/en/ref.filter.php)filter_var() — 用指定的过滤器过滤变量：

        ```
        $email = filter_var($email, FILTER_SANITIZE_EMAIL); 
        $newstr = filter_var($str, FILTER_SANITIZE_STRING);
        ```

        [更多预定义过滤器](https://secure.php.net/manual/en/filter.filters.sanitize.php)

    *   [filter_input()](http://php.net/manual/en/function.filter-input.php) — 按名称获取特定的外部变量并可选择过滤它：

        ```
        $search_html = filter_input(INPUT_GET, '搜索', FILTER_SANITIZE_SPECIAL_CHARS);
        ```

    *   [preg_match()](http://php.net/manual/en/function.preg-match.php) — 执行正则表达式匹配；

    *   编写您自己的验证函数。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2010-03-08T23:14:13.360

在您拥有类似页面`/mypage?id=53`并且在 WHERE 子句中使用 id 的特定情况下，可以提供帮助的一个技巧是确保 id 绝对是整数，如下所示：

```
if (isset($_GET['id'])) {
  $id = $_GET['id'];
  settype($id, 'integer');
  $result = mysql_query("SELECT * FROM mytable WHERE id = '$id'");
  # now use the result
} 
```

但当然，这只消除了一种特定的攻击，所以请阅读所有其他答案。（是的，我知道上面的代码不是很好，但它显示了具体的防御。）

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2017-12-17T18:47:15.663

没有包罗万象的功能，因为需要解决多个问题。

1.  **SQL 注入**- 今天，一般来说，每个 PHP 项目都应该[通过 PHP 数据对象 (PDO) 使用准备好的语句](http://php.net/manual/en/pdo.prepared-statements.php)作为最佳实践，*以防止错误引用以及针对注入的全功能解决方案*。它也是访问数据库的最灵活、最安全的方式。

查看[*（唯一正确的）PDO 教程*](https://phpdelusions.net/pdo)，了解您需要了解的有关 PDO 的几乎所有内容。（衷心感谢顶级 SO 贡献者 @YourCommonSense 提供有关该主题的大量资源。）

2.  **XSS - 在...途中清理数据**

*   [HTML Purifier](http://htmlpurifier.org/)已经存在了很长时间，并且仍在积极更新中。您可以使用它来清理恶意输入，同时仍然允许大量且可配置的标签白名单。与许多所见即所得的编辑器配合得很好，但对于某些用例来说可能很重。

*   在其他情况下，我们根本不想接受 HTML/Javascript，我发现这个简单的函数很有用（并且已经通过了针对 XSS 的多次审核）：

    ```
    /* Prevent XSS input */
    function sanitizeXSS () {
        $_GET   = filter_input_array(INPUT_GET, FILTER_SANITIZE_STRING);
        $_POST  = filter_input_array(INPUT_POST, FILTER_SANITIZE_STRING);
        $_REQUEST = (array)$_POST + (array)$_GET + (array)$_REQUEST;
    } 
    ```

3.  **XSS - 在出路时对数据进行清理...**除非您保证在将数据添加到数据库之前已对其进行了正确清理，否则您需要在将其显示给用户之前对其进行清理，我们可以利用这些有用的 PHP 函数：

*   当您调用`echo`或`print`显示用户提供的值时，请使用[`htmlspecialchars`](http://php.net/manual/function.htmlspecialchars.php)除非数据经过适当的安全清理并允许显示 HTML。
*   [`json_encode`](http://php.net/manual/en/function.json-encode.php)是一种将用户提供的值从 PHP 提供到 Javascript 的安全方法

5.  **您是使用[`exec()`](http://php.net/manual/en/function.exec.php)or[`system()`](http://php.net/manual/en/function.system.php)函数调用外部 shell 命令，还是调用[`backtick`](http://php.net/manual/en/language.operators.execution.php)操作员？**如果是这样，除了 SQL 注入和 XSS 之外，您可能还有一个额外的问题需要解决，即*用户在您的服务器上运行恶意命令*。[`escapeshellcmd`](http://php.net/manual/en/function.escapeshellcmd.php)如果您想转义整个命令或[`escapeshellarg`](http://php.net/manual/en/function.escapeshellarg.php)转义单个参数，则需要使用。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2012-07-16T10:44:30.570

您在这里描述的是两个不同的问题：

1.  清理/过滤用户输入数据。
2.  转义输出。

1) 应始终假定用户输入是错误的。

使用准备好的语句，或/和过滤 mysql_real_escape_string 绝对是必须的。PHP 还内置了 filter_input，这是一个很好的起点。

2）这是一个很大的话题，它取决于输出数据的上下文。对于 HTML，有一些解决方案，例如 htmlpurifier。作为一个经验法则，总是逃避你输出的任何东西。

这两个问题都太大了，无法在一篇文章中讨论，但是有很多文章会更详细地介绍：

[方法 PHP 输出](http://shiflett.org/articles)

[更安全的 PHP 输出](https://www.lazycat.org/php-output-escaping.html)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2015-05-27T15:36:31.290

如果你使用 PostgreSQL，PHP 的输入可以用`pg_escape_literal()`

```
$username = pg_escape_literal($_POST['username']); 
```

从[文档](https://php.net/manual/es/function.pg-escape-literal.php)中：

> `pg_escape_literal()`转义用于查询 PostgreSQL 数据库的文字。它返回 PostgreSQL 格式的转义文字。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-07-17T17:13:12.227

避免在清理输入和转义数据时出错的最简单方法是使用 PHP 框架，如[Symfony](http://symfony.com/)、[Nette](http://nette.org/en/)等或该框架的一部分（模板引擎、数据库层、ORM）。

[像Twig](http://twig.sensiolabs.org/)或 Latte 这样的模板引擎默认情况下会进行输出转义 - 如果您根据上下文（网页的 HTML 或 Javascript 部分）正确转义了输出，则不必手动解决。

框架会自动清理输入，你不应该直接使用 $_POST、$_GET 或 $_SESSION 变量，而是通过路由、会话处理等机制。

对于数据库（模型）层，有像 Doctrine 这样的 ORM 框架或像 Nette Database 这样的 PDO 包装器。

你可以在这里阅读更多关于它的信息——[什么是软件框架？](https://stackoverflow.com/questions/2964140/what-is-a-framework-what-does-it-do-why-do-we-need-a-framework)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2014-11-17T21:59:15.863

只是想在输出转义的主题上添加它，如果您使用 php DOMDocument 来制作您的 html 输出，它将在正确的上下文中自动转义。属性 (value="") 和 <span> 的内部文本不相等。为了安全防范 XSS，请阅读： [OWASP XSS Prevention Cheat Sheet](https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-02-19T12:12:38.520

# 你永远不会清理输入。

# 你总是清理输出。

您应用到数据以使其安全地包含在 SQL 语句中的转换与您申请包含在 HTML 中的转换完全不同于您申请包含在 Javascript 中的转换与您申请包含在 LDIF 中的转换完全不同是与您申请包含在 CSS 中的完全不同 与您申请包含在电子邮件中的完全不同......

无论如何[验证输入](http://symcbean.blogspot.co.uk/2017/07/validate-input-escape-output.html)- 决定您是否应该接受它以进行进一步处理或告诉用户它是不可接受的。但是在数据即将离开 PHP 领域之前，不要对数据的表示进行任何更改。

很久以前，有人试图发明一种万能的机制来转义数据，我们最终得到了“ [magic_quotes](http://php.net/manual/en/security.magicquotes.php) ”，它不能正确地转义所有输出目标的数据，并导致不同的安装需要不同的代码才能工作。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-24T20:26:36.220

有过滤器扩展（[howto-link](http://devolio.com/blog/archives/413-Data-Filtering-Using-PHPs-Filter-Functions-Part-one.html)、[manual](http://php.net/filter)），它适用于所有 GPC 变量。不过，这不是一件万能的事情，您仍然必须使用它。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2021-07-06T11:13:28.847

使用此修剪空白并删除不可打印的字符

```
$data = trim(preg_replace('/[[:^print:]]/', '', $data)); 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2018-08-21T19:31:01.420

永远不要相信用户数据。

```
function clean_input($data) {
  $data = trim($data);
  $data = stripslashes($data);
  $data = htmlspecialchars($data);
  return $data;
} 
```

该`trim()`函数从字符串的两侧删除空格和其他预定义字符。

该`stripslashes()`函数删除反斜杠

该`htmlspecialchars()`函数将一些预定义的字符转换为 HTML 实体。

预定义的字符是：

```
& (ampersand) becomes &amp;
" (double quote) becomes &quot;
' (single quote) becomes &#039;
< (less than) becomes &lt;
> (greater than) becomes &gt; 
```

# unit-testing - 在单元测试中重复代码是否更容易容忍？

> ID：129693
> 
> 赞同：127
> 
> 时间：2008-09-24T20:22:10.693
> 
> 标签：unit-testing, dry, code-duplication

前段时间我破坏了几个单元测试，当我经历并重构它们以使它们更加[干燥](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)时——每个测试的意图不再清晰。似乎测试的可读性和可维护性之间存在权衡。如果我在单元测试中留下重复的代码，它们更具可读性，但是如果我更改[SUT](http://en.wikipedia.org/wiki/System_Under_Test)，我将不得不追踪并更改重复代码的每个副本。

你同意这种权衡存在吗？如果是这样，你更喜欢你的测试是可读的还是可维护的？

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2008-09-24T20:25:01.700

可读性对于测试来说更为重要。如果测试失败，您希望问题显而易见。开发人员不必费力地通过大量因素分解的测试代码来确定究竟是什么失败了。您不希望您的测试代码变得如此复杂以至于您需要编写单元测试测试。

然而，消除重复通常是一件好事，只要它不会掩盖任何东西，并且消除测试中的重复可能会导致更好的 API。只要确保你没有超过收益递减点。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-09-27T14:26:56.707

与其他代码一样，重复代码在单元测试代码中是一种气味。如果您在测试中有重复的代码，那么重构实现代码就会变得更加困难，因为您要更新的测试数量不成比例。测试应该帮助您自信地重构，而不是成为阻碍您在被测代码上工作的巨大负担。

如果重复是在夹具设置中，请考虑更多地使用该`setUp`方法或提供更多（或更灵活）的[创建方法](http://xunitpatterns.com/Creation%20Method.html)。

如果重复出现在操作 SUT 的代码中，那么问问自己为什么多个所谓的“单元”测试正在执行完全相同的功能。

如果重复在断言中，那么也许您需要一些[自定义断言](http://xunitpatterns.com/Custom%20Assertion.html)。例如，如果多个测试有一系列断言，例如：

```
assertEqual('Joe', person.getFirstName())
assertEqual('Bloggs', person.getLastName())
assertEqual(23, person.getAge()) 
```

那么也许你需要一个`assertPersonEqual`方法，这样你就可以编写`assertPersonEqual(Person('Joe', 'Bloggs', 23), person)`. （或者也许您只需要在 上重载相等运算符`Person`。）

正如您所提到的，测试代码的可读性很重要。尤其重要的是，测试的*意图*要明确。我发现如果许多测试看起来大体相同，（例如，四分之三的行相同或几乎相同），如果不仔细阅读和比较它们，就很难发现和识别显着差异。所以我发现重构以消除重复*有助于*提高可读性，因为每个测试方法的每一行都与测试的目的直接相关。这比直接相关的行和只是样板的行的随机组合对读者更有帮助。

也就是说，有时测试是在执行相似但仍然显着不同的复杂情况，并且很难找到减少重复的好方法。使用常识：如果你觉得测试是可读的并且他们的意图很清楚，并且你对在重构测试调用的代码时可能需要更新超过理论上最少数量的测试感到满意，那么接受不完美并移动去做更有成效的事情。当灵感来袭时，您可以随时回来重构测试！

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2008-09-24T21:17:11.980

实现代码和测试是不同的动物，因式分解规则适用于它们不同。

重复的代码或结构始终是实现代码中的一种气味。当您开始在实现中使用样板时，您需要修改您的抽象。

另一方面，测试代码必须保持一定程度的重复。测试代码中的重复实现了两个目标：

*   保持测试解耦。过度的测试耦合可能会导致很难更改单个失败的测试，因为合同已经更改，需要更新。
*   保持独立的测试有意义。当单个测试失败时，必须相当直接地找出它正在测试的确切内容。

我倾向于忽略测试代码中的琐碎重复，只要每个测试方法都短于大约 20 行。我喜欢设置-运行-验证的节奏在测试方法中很明显。

当重复出现在测试的“验证”部分时，定义自定义断言方法通常是有益的。当然，这些方法仍然必须测试一个可以在方法名称中明确识别的关系：`assertPegFitsInHole`-> 好，`assertPegIsGood`-> 坏。

当测试方法变得冗长且重复时，我有时会发现定义采用一些参数的填空测试模板很有用。然后实际的测试方法被简化为对具有适当参数的模板方法的调用。

至于编程和测试中的很多事情，并没有一个明确的答案。你需要培养一种品味，而最好的方法就是犯错误。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-24T20:30:07.977

我同意。权衡是存在的，但在不同的地方是不同的。

我更有可能重构重复的代码来设置状态。但不太可能重构实际执行代码的测试部分。也就是说，如果执行代码总是需要几行代码，那么我可能会认为这是一种味道并重构被测的实际代码。这将提高代码和测试的可读性和可维护性。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-24T21:17:47.313

您可以使用几种不同风格的[测试实用方法](http://xunitpatterns.com/Test%20Utility%20Method.html)来减少重复。

与生产代码相比，我更能容忍测试代码中的重复，但有时我对此感到沮丧。当你改变一个类的设计并且你必须返回并调整 10 种不同的测试方法，它们都执行相同的设置步骤时，这是令人沮丧的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-28T03:48:28.853

Jay Fields 创造了“DSL 应该是 DAMP，而不是 DRY”的短语，其中*DAMP*表示*描述性和有意义的短语*。我认为这同样适用于测试。显然，过多的重复是不好的。但不惜一切代价消除重复甚至更糟。测试应该作为意图揭示规范。例如，如果您从几个不同的角度指定相同的特征，那么会出现一定数量的重复。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-25T00:03:29.163

“重构它们以使它们更干燥——每个测试的意图不再清晰”

听起来您在进行重构时遇到了麻烦。我只是在猜测，但如果结果不太清楚，这是否意味着您还有更多工作要做，以便您拥有相当清晰的相当优雅的测试？

这就是为什么测试是 UnitTest 的子类的原因——因此您可以设计出正确、易于验证和清晰的良好测试套件。

在过去，我们有使用不同编程语言的测试工具。设计令人愉快、易于使用的测试很难（或不可能）。

无论你使用什么语言——Python、Java、C#——你都拥有全部的力量——所以好好使用那种语言。您可以获得清晰且不太冗余的漂亮测试代码。没有取舍。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-25T00:11:02.717

我喜欢 rspec 因为这个：

它有两件事可以帮助 -

*   用于测试常见行为的共享示例组。
    您可以定义一组测试，然后在您的实际测试中“包含”该设置。

*   嵌套上下文。
    您基本上可以为测试的特定子集使用“设置”和“拆卸”方法，而不仅仅是班级中的每个人。

.NET/Java/其他测试框架越早采用这些方法越好（或者你可以使用 IronRuby 或 JRuby 来编写你的测试，我个人认为这是更好的选择）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-05-02T22:16:56.767

我觉得测试代码需要类似于通常应用于生产代码的工程级别。当然可以有支持可读性的论据，我同意这很重要。

In my experience, however, I find that well-factored tests are easier to read and understand. If there's 5 tests that each look the same except for one variable that's changed and the assertion at the end, it can be very difficult to find what that single differing item is. Similarly, if it is factored so that only the variable that's changing is visible and the assertion, then it's easy to figure out what the test is doing immediately.

Finding the right level of abstraction when testing can be difficult and I feel it is worth doing.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T20:26:47.483

我认为更多重复和可读的代码之间没有关系。我认为你的测试代码应该和你的其他代码一样好。如果做得好，非重复代码比重复代码更具可读性。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T20:29:04.843

理想情况下，单元测试在编写后不应该有太大变化，所以我倾向于可读性。

使单元测试尽可能离散也有助于使测试专注于它们所针对的特定功能。

话虽如此，我确实倾向于尝试并重用我一遍又一遍地使用的某些代码，例如在一组测试中完全相同的设置代码。

# java - Java：将大量数据序列化为单个文件

> ID：129695
> 
> 赞同：5
> 
> 时间：2008-09-24T20:22:20.473
> 
> 标签：java, serialization

我需要将大量小对象的数据（大约 2gigs）序列化到一个文件中，以便稍后由另一个 Java 进程处理。性能有点重要。任何人都可以提出一个好的方法来实现这一目标吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T20:26:33.240

你看过谷歌的[协议缓冲区](http://code.google.com/p/protobuf/)吗？听起来像是一个用例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T20:46:16.907

我不知道为什么 Java 序列化被否决，这是一个完全可行的机制。

从原帖看不清楚，但是堆里的所有2G数据是同时的吗？还是你在倾倒其他东西？

开箱即用，序列化不是“完美”的解决方案，但如果您在对象上实现 Externalizable，序列化可以正常工作。序列化的大笔开销是弄清楚要写什么以及如何写。通过实施 Externalizable，您可以摆脱这些决策，从而大大提高性能并节省空间。

虽然 I/O 是写入大量数据的主要成本，但转换数据的附带成本也可能非常昂贵。例如，您不想将所有数字都转换为文本然后再转换回来，最好尽可能以更原生的格式存储它们。ObjectStream 具有在 Java 中读取/写入本机类型的方法。

如果您的所有数据都设计为加载到单个结构中，那么您可以在实现 Externalizable 之后简单地执行 ObjectOutputStream.writeObject(yourBigDatastructure)。

但是，您也可以遍历您的结构并在各个对象上调用 writeObject。

无论哪种方式，您都将需要一些“objectToFile”例程，也许是几个。这就是 Externalizable 所提供的有效的方式，以及一个框架来遍历你的结构。

当然，另一个问题是版本控制等。但是由于您自己实现了所有序列化例程，因此您也可以完全控制它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T20:27:57.980

你试过java序列化吗？[您可以使用ObjectOutputStream](http://java.sun.com/j2se/1.5.0/docs/api/java/io/ObjectOutputStream.html)将它们写出来，然后使用[ObjectInputStream](http://java.sun.com/j2se/1.5.0/docs/api/java/io/ObjectInputStream.html)将它们读回。当然，课程必须是[`Serializable`](http://java.sun.com/j2se/1.5.0/docs/api/java/io/Serializable.html). 这将是一种省力的解决方案，并且由于对象以二进制形式存储，因此它既紧凑又快速。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:33:29.653

我立即想到的一种最简单的方法是使用 NIO 的内存映射缓冲区（java.nio.MappedByteBuffer）。使用与一个对象的大小相对应的单个缓冲区（大约），并在必要时将它们刷新/附加到输出文件。内存映射缓冲区*非常*有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:35:22.487

协议缓冲区：有意义。这是他们维基的摘录：[http ://code.google.com/apis/protocolbuffers/docs/javatutorial.html](http://code.google.com/apis/protocolbuffers/docs/javatutorial.html)

获得更快的速度

默认情况下，protocol buffer 编译器尝试通过使用反射来生成更小的文件来实现大多数功能（例如解析和序列化）。但是，编译器也可以为您的消息类型生成显式优化的代码，通常提供一个数量级的性能提升，但也会使代码大小加倍。如果分析显示您的应用程序在协议缓冲区库中花费了大量时间，您应该尝试更改优化模式。只需将以下行添加到您的 .proto 文件中：

选项 optimize_for = 速度；

重新运行协议编译器，它将生成极快的解析、序列化和其他代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T02:58:22.457

我开发了 JOAFIP 作为数据库替代品。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-31T10:53:11.830

[Apache Avro](http://avro.apache.org)也可能有用。它被设计为独立于语言并具有[流行语言的](https://ccp.cloudera.com/display/CDHDOC/Avro+Usage)绑定。

看看这个。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-24T20:29:02.220

您可能应该考虑一个数据库解决方案——所有数据库所做的都是优化它们的信息，如果您使用 Hibernate，您将保持对象模型不变，甚至不需要考虑您的数据库（我相信这就是为什么它被称为 hibernate，只是存储您的数据，然后将其恢复）

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-24T20:45:25.207

如果性能非常重要，那么您需要自己编写。您应该使用紧凑的二进制格式。因为对于 2 GB，磁盘 I/O 操作非常重要。如果您使用任何人类可读的格式，例如 XML 或其他脚本，您可以将数据的大小调整为 2 倍或更多。

根据数据，如果您以低压缩率动态压缩数据，则可以加快速度。

Java 序列化完全不行，因为在读取 Java 时会检查每个对象是否是对现有对象的引用。

# php - 在 PHP 中解析快速信息集文档？

> ID：129731
> 
> 赞同：2
> 
> 时间：2008-09-24T20:26:27.033
> 
> 标签：php, xml, fastinfoset

是否有允许 PHP 解码[application/fastinfoset](http://java.sun.com/developer/technicalArticles/xml/fastinfoset/)二进制 XML 的库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T07:39:43.140

据我所知，没有 PHP 库可以做到这一点。你能通过创建一个解码/转换 FI 并从 PHP 调用它的小型 java 程序来解决这个问题吗？

我知道这是一个不太理想的解决方案，但这似乎是一个未知领域。

[https://fi.dev.java.net/how-to-use.html](https://fi.dev.java.net/how-to-use.html)有一些关于如何处理 FI 的 java 示例。

至于桥接PHP和Java；

[http://sourceforge.net/projects/php-java-bridge](http://sourceforge.net/projects/php-java-bridge)应该很好（虽然，当我尝试时，网站已关闭），

[http://www.php.net/manual/en/book.java.php](http://www.php.net/manual/en/book.java.php)也有一些关于集成 Java 和 PHP 的信息。

或者，您可以使用 webservice 或消息传递在 PHP 和 Java 之间进行通信。（这可能很明显。）

# perl - perl中有什么好的收集模块吗？

> ID：129740
> 
> 赞同：2
> 
> 时间：2008-09-24T20:26:43.600
> 
> 标签：perl, collections

有人可以在 perl 中推荐一个可以用来存储对象集合的好模块吗？

或者 ARRAY 是否足以满足大多数需求？

**更新：** 我正在寻找一个集合类，因为我希望能够执行诸如计算每个元素的集合级别属性之类的操作。

由于我需要执行许多这样的操作，我不妨编写一个可以由单个对象扩展的类。这个类显然适用于数组（或者可能是散列）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T20:36:24.107

有用于更复杂结构的集合模块，但在 Perl 中，将 Arrays 用于数组、堆栈和列表是一种常见的风格。Perl 内置了将数组用作堆栈或列表的函数：push/pop、shift/unshift、splice（在中间插入或删除）和用于迭代的 foreach 形式。

Perl 还有一个映射，称为哈希映射，它相当于 Python 中的字典 - 允许您在单个键和单个值之间建立关联。

Perl 开发人员经常组合这两种数据结构来构建他们需要的东西——需要多个值吗？将数组引用存储在哈希表（Map）的值部分。树可以用类似的方式构建——如果你需要唯一的键，使用多层次的哈希图，或者如果你不使用嵌套数组引用。

Perl 中的这两种原始集合类型没有面向对象的 api，但它们仍然是集合。

如果您查看 CPAN，您可能会发现提供其他面向对象数据结构的模块，这实际上取决于您的需要。除了 List、Stack 或 Map 之外，您还需要特定的数据结构吗？如果您询问特定的数据结构，您可能会得到更精确的答案（例如特定模块）。

忘了提一下，如果您正在寻找跨多种语言的小型代码示例，[那么 PLEAC](http://pleac.sourceforge.net/)（Programming Language Examples Alike Cookbook）是一个不错的资源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T01:31:37.687

我会赞同 Michael Carman 的评论：当您的意思是散列或关联数组时，请不要使用术语“Hashmap”或“map”。尤其是当 Perl 有 map 函数时；这只会让事情变得混乱。

话虽如此，Kyle Burton 的回应基本上是合理的：散列或数组，或者由两者混合组成的复杂结构通常就足够了。Perl 了解 OO，但不强制执行；一个松散定义的数据结构可能足以满足您的需要。

如果做不到这一点，请更准确地定义“计算每个元素的集合级别属性”的含义。请记住，Perl 有诸如 map 和 grep 之类的关键字，它们可以让您进行函数式编程，例如

```
my $record = get_complex_structure();
# $record = {
#    'widgets' => {
#        name => 'ACME Widgets',
#        skus => [ 'WIDG01', 'WIDG02', 'WIDG03' ],
#        sales => {
#            WIDG01 => { num => 25, value => 105.24 },
#            WIDG02 => { num => 10, value => 80.02 },
#            WIDG03 => { num => 8,  value => 205.80 },
#        },
#    },
#    ### and so on for 'grommets', 'nuts', 'bolts' etc.
# }

my @standouts =
    map { $_->[0] }
    sort {
        $b->[2] <=> $a->[2] 
     || $b->[1] <=> $a->[1]
     || $record->{$a->[0]}->{name} cmp $record->{$b->[0]}->{name}
    }
    map {
        my ($num, $value);
        for my $sku (@{$record->{$_}{skus}}) {
            $num   += $record->{$_}{sales}{$sku}{num};
            $value += $record->{$_}{sales}{$sku}{value};
        }
        [ $_, $num, $value ];
    }
    keys %$record; 
```

从后往前阅读，这个特殊的[施瓦茨变换](http://en.wikipedia.org/wiki/Schwartzian_transform)做了三件事：

3) 它需要一个 $record 的密钥，遍历在这个任意结构中定义的 SKU，并计算出交易的总数和总价值。它返回一个匿名数组，其中包含密钥、交易数量和总值。

2) 下一个块接受一些arrayrefs 并对它们进行排序 a) 首先通过比较总值，以数字方式按降序排列；b) 如果值相等，则通过比较交易数量，按数字降序排列；c) 如果失败，则按与该订单关联的名称进行 asciibetically 排序。

1) 最后，我们从排序后的数据结构中取出 $record 的键，并将其返回。

很可能你不需要设置一个单独的类来做你想做的事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T20:32:52.773

我通常会使用@array 或 %hash。

您正在寻找那些没有提供的功能？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T20:31:48.267

根据您需要如何访问对象来决定。如果将它们推入数组，索引，弹出/移出它们，则使用数组。否则，通过某个键将它们散列或将它们组织成满足您需要的对象树。对象哈希是 Perl 中一种非常简单、强大且高度优化的处理方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T20:33:13.647

由于 Perl 数组可以很容易地附加、调整大小、排序等，因此它们足以满足大多数“收集”需求。如果您需要更高级的东西，通常可以使用哈希。*在你真正需要*它之前，我不会建议你去寻找一个收集模块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T20:29:46.243

我会坚持使用数组或哈希。

```
 @names = ('Paul','Michael','Jessica','Megan'); 
```

和

```
my %petsounds = ("cat" => "meow",
             "dog" => "woof",
             "snake" => "hiss"); 
```

[来源](http://en.wikibooks.org/wiki/Programming:Perl_Hash_Variables)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T20:35:43.623

数组或散列都可以存储对象的集合。如果您想以某些方式与班级合作，班级可能会更好，但您必须先告诉我们这些方式是什么，然后我们才能提出任何好的建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T20:52:27.953

这取决于很多；有[稀疏矩阵](http://search.cpan.org/~kesinger/Math-MatrixSparse-0.01/MatrixSparse.pm)模块、某些形式的[持久性](http://search.cpan.org/~jprit/ObjStore-1.59/lib/ObjStore.pod)、一种[新的 OO 样式](http://search.cpan.org/~drolsky/Moose-0.58/lib/Moose.pm)等大多数人只是 man [perldata](http://perldoc.perl.org/perldata.html)、[perllol](http://perldoc.perl.org/perllol.html)、[perldsc](http://perldoc.perl.org/perldsc.html)来回答他们关于数据结构的具体问题。

# java - 启用了 jmxremote 的 JBoss 4.2.2 上的 JBossWS 中的 NPE

> ID：129746
> 
> 赞同：3
> 
> 时间：2008-09-24T20:27:36.017
> 
> 标签：java, jboss, jmx, jconsole, jbossws

我正在尝试设置 JBoss 4.2.2 和 JConsole 进行远程监控。根据我在网上找到的许多操作方法，您需要通过在 run.conf 中设置以下选项来启用 jmxremote。（我意识到其他两个选项禁用身份验证）

```
JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port=11099"
JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.authenticate=false"
JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.ssl=false" 
```

这导致以下异常：

```
13:06:56,418 INFO [TomcatDeployer] performDeployInternal :: deploy, ctxPath=/services, warUrl=.../tmp/deploy/tmp34585xxxxxxxxx.ear-contents/mDate-Services-exp.war/
13:06:57,706 WARN [AbstractServerConfig] getWebServicePort :: Unable to calculate 'WebServicePort', using default '8080'
13:06:57,711 WARN [AbstractServerConfig] getWebServicePort :: Unable to calculate 'WebServicePort', using default '8080'
13:06:58,070 WARN [AbstractServerConfig] getWebServicePort :: Unable to calculate 'WebServicePort', using default '8080'
13:06:58,071 WARN [AbstractServerConfig] getWebServicePort :: Unable to calculate 'WebServicePort', using default '8080'
13:06:58,138 ERROR [MainDeployer] start :: Could not start deployment: file:/opt/jboss-4.2.2.GA/server/default/tmp/deploy/tmp34585xxxxxxxxx.ear-contents/xxxxx-Services.war
java.lang.NullPointerException
at org.jboss.wsf.stack.jbws.WSDLFilePublisher.getPublishLocation(WSDLFilePublisher.java:303)
at org.jboss.wsf.stack.jbws.WSDLFilePublisher.publishWsdlFiles(WSDLFilePublisher.java:103)
at org.jboss.wsf.stack.jbws.PublishContractDeploymentAspect.create(PublishContractDeploymentAspect.java:52)
at org.jboss.wsf.framework.deployment.DeploymentAspectManagerImpl.deploy(DeploymentAspectManagerImpl.java:115)
at org.jboss.wsf.container.jboss42.ArchiveDeployerHook.deploy(ArchiveDeployerHook.java:97) 
... 
```

我的应用程序使用 JWS，根据这个错误：

[https://jira.jboss.org/jira/browse/JBWS-1943](https://jira.jboss.org/jira/browse/JBWS-1943)

建议这种解决方法：

```
JAVA_OPTS="$JAVA_OPTS -Djavax.management.builder.initial=org.jboss.system.server.jmx.MBeanServerBuilderImpl"
JAVA_OPTS="$JAVA_OPTS -Djboss.platform.mbeanserver"
JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote" 
```

（[https://developer.jboss.org/wiki/JBossWS-FAQ#jive_content_id_How_to_use_JDK_JMX_JConsole_with_JBossWS](https://developer.jboss.org/wiki/JBossWS-FAQ#jive_content_id_How_to_use_JDK_JMX_JConsole_with_JBossWS)）

我已经尝试过，但是然后在尝试在我的耳朵中部署一个 sar 文件时抛出以下异常，该文件仅包含为我的应用程序需要的几个计划作业实现 Schedulable 的类：

```
Caused by: java.lang.NullPointerException
at EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap.hash(ConcurrentReaderHashMap.java:298)
at EDU.oswego.cs.dl.util.concurrent.ConcurrentReaderHashMap.get(ConcurrentReaderHashMap.java:410)
at org.jboss.mx.server.registry.BasicMBeanRegistry.getMBeanMap(BasicMBeanRegistry.java:959)
at org.jboss.mx.server.registry.BasicMBeanRegistry.contains(BasicMBeanRegistry.java:577) 
```

关于从这里去哪里有什么建议吗？

编辑：

我还尝试了以下变体：

```
JAVA_OPTS="$JAVA_OPTS -DmbipropertyFile=../server/default/conf/mbi.properties  -DpropertyFile=../server/default/conf/mdate.properties -Dwicket.configuration=DEVELOPMENT"
JAVA_OPTS="$JAVA_OPTS -Djavax.management.builder.initial=org.jboss.system.server.jmx.MBeanServerBuilderImpl"
JAVA_OPTS="$JAVA_OPTS -Djboss.platform.mbeanserver"
JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote" 
```

我正在使用 JDK 1.6.0_01-b06

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T20:47:49.213

老实说，我从未尝试过这种远程处理方法。但是，如果您的客户端机器和服务器碰巧都是 linux 机器或类似的带有 SSH 的 *nixes，那么您可以`ssh -XCA`到服务器并在服务器*上启动 JConsole，*并通过 X 端口转发在您的客户端机器上显示 GUI。在本地运行到您要监视的服务器 JVM 的 JConsole连接*应该*没有任何问题。

我个人认为这是一个绝妙的技巧，但我意识到它并不能*真正*解决让 JConsole 通过 JWS 远程连接的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-07T15:47:37.377

我要做的第一件事是删除 JBoss /default 下的 /tmp 和 /work 目录并重新部署 WAR。如果没有，我会升级 JDK 以使用更新的 1.6 版本。1.6.0_01 已经很老了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T16:57:52.453

我不确定您尝试使用 WS 访问 mbean 服务器是否有特定原因，但是使用 JConsole 您可以直接访问远程 JVM。为此，请使用“service:jmx:rmi:///jndi/rmi://<remote-machine>:<port>/jmxrmi”（其中 <remote-machine> 是您尝试连接的任何机器，<port > 是 11099) 作为远程进程。

我已经使用它连接到任何公开 mbean 服务器（JBoss、ActiveMQ 等）的 1.6 JVM。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T18:13:40.643

有类似的问题，但使用 JBoss Seam：看看[JBSEAM-4029](https://jira.jboss.org/jira/browse/JBSEAM-4029)。作为解决方法之一，它建议覆盖运行到 NPE 中的类 - 在 Seam 的情况下是`JBossClusterMonitor`.

我敢打赌 JWS 代码会遇到完全相同的问题，即最终`MBeanServerFactory.findMBeanServer(null)`会在某个时间点调用。堆栈跟踪应显示执行此操作的确切类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T18:00:30.820

我不知道这是否相关，但 JBoss 倾向于重定向到自身。如果你连接到一个主机，比如 jboss.localdomain:3873，想要连接到一个 ejb，JBoss 可能会查找它自己的主机名并重定向到它从那里获得的地址。如果你有一个公共主机名，它可能会找到它（比如 jboss.publicdomain.com），并告诉客户端重新连接到 jboss.publicdomain.com:1099。根据您的 DNS，这可能是也可能不是您的客户端可访问的地址。

这个问题有多种变化，作为奖励，有时最初的“连接检查”有效，因此客户端应用程序部署，但稍后连接失败。

# .net - How to begin WPF development?

> ID：129772
> 
> 赞同：40
> 
> 时间：2008-09-24T20:30:54.213
> 
> 标签：.net, wpf, .net-3.5

I've been using Winforms since .NET 1.1 and I want to start learning WPF.

I'm looking for some good resources for a beginner in WPF. What should I read, what tools do I need, and what are the best practices I should follow?

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-24T20:46:27.500

Please have a look at [this StackOverflow post](https://stackoverflow.com/questions/9591/what-wpf-books-would-you-recommend#9919), which has a list of book recommendations.

In terms of best practices, get familiar with the [M-V-VM pattern](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx). It seems to have gained the most traction in WPF-land.

Check out [this post](https://stackoverflow.com/questions/38642/what-tools-do-you-use-for-wpf-development) for what tools you can use for WPF development.

The [MSDN Forum](http://social.msdn.microsoft.com/forums/en-US/wpf/threads/) is a great place for resources, as is the MSDN help files on WPF.

My personal recommendation is for you to forget everything you have learnt about WinForms. WPF is a totally different model, and once I finally dropped my "I did it this way in WinForms, but that way doesn't work in WPF" I had one of those "lightbulb" moments.

Hope this helps!

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-25T18:49:25.213

The learning curve is high, but there are a lot of really good resources out there. And, the MSDN documentation and SDK samples (as some have already mentioned) are really good.

One thing that will help you though, is just to acknowledge the learning curve up front, and to not get discouraged when it doesn't make sense. There really are a lot of concepts to 'grok' before you can do some even basic things.

The WPF books already mentioned are all valuable in their own way. My personal experience was that I got a copy of *WPF Unleashed* first and tried reading it to no avail. It wasn't until I picked up Charles Petzold's *Application = Code + Markup* and read through some of that ... before I could even begin to understand *WPF Unleashed*. However, my brain needs detail before concepts actually sink in ...

Tim Sneath has an excellent list of WPF bloggers that I have found valuable to get hooked into the WPF community: [WPF Bloggers](http://blogs.msdn.com/tims/articles/475132.aspx "WPF Bloggers")

A *few* blogs on my must read list:

*   [Rob Relyea](http://blogs.windowsclient.net/rob_relyea/default.aspx "Rob Relyea")
*   [Dr. WPF](http://www.drwpf.com/blog/Home/tabid/36/BlogId/1/Default.aspx "Dr. WPF")
*   [Josh Smith](http://joshsmithonwpf.wordpress.com/ "Josh Smith")
*   [Robby Ingebretsen](http://blog.nerdplusart.com/ "Robby Ingebretsen")
*   [Kevin Moore](http://work.j832.com/ "Kevin Moore")
*   [Charles Petzold](http://www.charlespetzold.com/ "Charles Petzold")
*   [Pavan Podila](http://blog.pixelingene.com/ "Pavan Podila")

Another thing I would do is get Dr. WPF's snippet library (located [here](http://www.drwpf.com/Blog/Default.aspx?tabid=36&EntryID=22 "Dr. WPF's Snippets")). This is an extremely good way to learn some of the basic plumbing type concepts like Dependency Properties, Routed Events, and Routed Commands.

Finally, I would get a copy of Blend (v2.5 is still in beta and free) and use that to generate xaml and then dive into that generated xaml to understand what you did in Blend, maps to the WPF API.

Hope this helps. Good luck.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T20:46:55.970

1 Start understanding the XAML and control heirarchies - UI markup and the new terms and features around it. KaXaml is a great tool to learn XAML, It is free to download [http://www.kaxaml.com/](http://www.kaxaml.com/)

2 Since you have already got a long .NET experience, go directly to the SDK Samples and start running in it and see what is happeing, play with XAML. [http://msdn.microsoft.com/en-us/library/ms771449.aspx](http://msdn.microsoft.com/en-us/library/ms771449.aspx)

3 If you are looking for Blog resources here is my best suggestion

*   Josh Smith - [http://joshsmithonwpf.wordpress.com/](http://joshsmithonwpf.wordpress.com/)
*   Dr. WPF - [http://www.drwpf.com/blog/](http://www.drwpf.com/blog/)

**But selecting a simple UI scenario which you already implemented or saw somewhere and try implementing it in WPF** - That is probably the best approach to learn a new technology.

***And please dont get afraid of MVVM , those things will come handy later once you got familiar with WPF platform and XAML.***

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T20:33:52.100

I'd recommend the book [Windows Presentation Foundation Unleashed](https://rads.stackoverflow.com/amzn/click/com/0672328917) by Adam Nathan

Then I'd recommend you write an application. Like every other dev environment, there are no perfect guidelines. You have to find the ones that make the most sense for your circumstance. The only way to do that is to just start coding.

As for tools, Visual Studio 2008 [Express] is your best bet. Or you might be able to limp along with XamlPad.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-24T20:34:50.583

Adam Nathan's - WPF Unleashed, book is very good.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-24T21:29:40.767

I would also highly recommend using Blend together with VS 2008\. Blend is great for creating animations.

The [Blend 2.5 Preview](http://www.microsoft.com/downloads/details.aspx?FamilyID=32a3e916-e681-4955-bc9f-cfba49273c7c&displaylang=en) can be freely downloaded.

I like the [Designer WPF Blog](http://www.designerwpf.com/), which has some good tutorials on how to do WPF stuff in Blend.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-30T18:09:02.137

Although already listed above, I wanted to reiterate one point.

[Kaxaml](http://www.kaxaml.com) is bar none, the best loose xaml editor out there. It has a snippet library, IntelliSense, split view, a xaml scrubber (pretty print), and more.

I only wish we could hook up some assemblies (that you could reference from the xaml) ...

Robby Ingebretsen, you rock.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-12-29T07:18:49.483

I would humbly also suggest taking a look at my blog, [2,000 Things You Should Know About WPF](http://wpf.2000things.com/), where I post a single piece of information on WPF each day. The blog starts with first principles and gradually works into more advanced topics, so it's a good place to start, as a beginner.

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-02-22T23:33:33.287

Mastering WPF (and silverlight, and basically any vector based XAML .net rich UI framework) requires more than understanding the new development concepts (and there are many). Its not enough to fully understand dependency properties, attached properties, templates, data binding, styles, MVVM, the layout mechanism, visual states and parts, effects, routed events... To really know your way around, you need to understand some basic concepts in graphics (such as vector graphics, raster graphics, rendering, layered graphics techniques, animation, pixel shaders, gradients, geometries, paths, brushes, transformation matrices, etc). In addition to that, you need to learn and understand M-V-VM which is not just a new design pattern - its a whole new programming paradigm. So there is a lot to learn... and the problem is that no matter which starting point you pick, you always feel that something is missing.

I tried several books as a starting point and many of them got me quite confused. Then I found "Illustrated WPF" by Daniel M. Solis and this one did the trick for me. He explains concepts from the world of graphics in a way that is clear to developers, and then teaches all the new concepts of XAML based UI while lightly touching each topic and diving into specific topics through a demo. Simply by following the tutorials, you find that you have learned a lot, and more importantly, removed the fear factor.

Once you master that, you can move on to "WPF Unleashed" by Adam Nathan and dive deeper. This one gives you a much more In-Depth view of the concepts that are unique to WPF, which I believe you have a much better chance of understanding once you have seen each feature at least once. They somehow all complete eachother and only make sense together.

You will still have tons to learn after that, but at this point you can develop rich applications and learn new topics as you go...

Enjoy :-)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T20:33:54.957

Visual Studio 2008 (there's a free Express version). That's all the tools you need.

Then try some How-to videos. Here's a good start: [http://windowsclient.net/learn/videos_wpf.aspx](http://windowsclient.net/learn/videos_wpf.aspx)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T20:45:46.953

Microsoft actually has a decent introduction on MSDN: [http://msdn.microsoft.com/en-us/library/aa970268.aspx](http://msdn.microsoft.com/en-us/library/aa970268.aspx)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-24T07:19:39.227

[Teach Yourself WPF in 24 Hours http://ecx.images-amazon.com/images/I/41ZM9hbeGoL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/41ZM9hbeGoL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg)

[http://Teach Yourself WPF in 24 Hours](https://rads.stackoverflow.com/amzn/click/com/0672329859)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-02-17T09:14:50.373

One resource I found that really helped me was from jfo's coding: [http://blogs.msdn.com/jfoscoding/articles/765135.aspx](http://blogs.msdn.com/jfoscoding/articles/765135.aspx)

The document is entitled "WPF for those who know WinForms", which is exactly the position I was in last year!

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-07-03T04:32:56.230

*   Microsoft has a college concept and documentation is .net focused;
*   focus must remain to the basic language; [arrays,classes,...];
    which means by not going into .net structures(others built in way of doing);
*   xaml must be forgotten, and interface build by code;
*   having your personal coding structured and learned, try researching [if] still into xaml and .net structures;
*   computers are now a social realm propaganda, and internet for new devices;
    building cool desktop applications are led by memes;
*   making a blog would be the though left out of the focus, there is also windows store now;

# .net - NHibernate：映射到字段或属性？

> ID：129773
> 
> 赞同：12
> 
> 时间：2008-09-24T20:31:09.127
> 
> 标签：.net, nhibernate

创建映射文件时，是否将属性映射到字段或属性：

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="Foo" namespace="Foo.Bar" >
  <class name="Foo" table="FOOS" batch-size="100">
    [...]
    <property name="FooProperty1" access="field.camelcase" column="FOO_1" type="string" length="50" />
    <property name="FooProperty2" column="FOO_2" type="string" length="50" />
    [...]
  </class>
</hibernate-mapping> 
```

当然，请解释原因:)

通常，我映射到属性，但映射到字段可以在属性的 getter/setter 中放置一些“逻辑”。

映射到字段是否“不好”？有最佳做法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T20:36:20.987

我映射到属性。如果我觉得有必要，我会将 SETTER 映射到一个字段。（通常通过“access=field.camelcase”之类的东西）。

这让我有漂亮的查询，例如“来自 FirstName = 'John' 的人”而不是像“来自 FirstName/_firstName 的人”之类的东西，并且在为我的实体补水时也避免了 setter 逻辑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T03:26:43.270

如果您需要对进出持久存储的数据进行一些时髦的处理，属性也很有用。通常应该避免这种情况，但一些罕见的业务案例或遗留支持有时会要求这样做。

（请记住，如果您在使用 getter 时以某种方式转换数据，NHibernate 将（默认情况下）使用 getter 的返回并在 Session 刷新/关闭时将其保存回数据库。确保这就是你想要的。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T20:35:01.473

我映射到属性，我还没有遇到我会映射到字段的情况......当我有我的需要时，我会增加我的 BO 设计。我认为它允许更好的架构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T21:54:01.253

我映射到属性，因为我使用自动属性。

除了集合（比如`set`s。那些我映射到字段 ( `access="field.camelcase-underscore"`) 因为我没有公开它们的公共属性，而是方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T06:49:23.543

**空对象**

[如果您的类正在实现空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)，则映射到字段可能很有用 。因为在映射到属性时无法（轻松）执行此操作。您最终不得不在数据库中存储假对象。

**高品质**

如果您使用字段访问方法，我不确定使用 HQL 查询是否必须更改属性名称。即如果你有`<property name="FirstName" access="field.camelcase" />` 我认为你仍然可以写`"From Person where FirstName = :name";`，因为它仍然会使用属性名称。

可以在[此处](http://forum.hibernate.org/viewtopic.php?t=980694&postdays=0&postorder=asc&start=15)找到有关字段策略和 Null 对象的进一步讨论。

**表现**

关于[John Chapman 博客](http://jaychapman.blogspot.com/2007/11/nhibernate-access-performance.html)上的字段与属性的性能 看起来中小型结果集的性能没有太大问题。

总而言之，每种方法都有某些可能有用的特权，具体取决于场景（字段访问允许只读 getter，不需要 setter，当您的 poco 不需要任何特殊内容并且似乎是事实上的方法时，属性访问有效。等等）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T16:36:35.363

我倾向于同意上面的答案。通常，映射到几乎所有内容的属性，然后映射到集合设置器的字段。
您想要映射到字段的唯一其他地方是当您有一些东西时：

```
public class AuditableEntity
{
   /*...*/
   DateTime creationDate = DateTime.Now;
   /*...*/
   public DateTime CreationDate { get { return creationDate; } }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-03T20:13:48.547

我直接映射到字段，这允许我使用属性设置器来跟踪属性的脏状态。

# c# - 如何通过 C# 代码在 Sql Agent (Sql Server 2005) 中安排作业？

> ID：129808
> 
> 赞同：2
> 
> 时间：2008-09-24T20:36:35.090
> 
> 标签：c#, sql-server-2005, scheduled-tasks

您好我想通过 C# 代码在 Sql Server 2005 代理中安排一个现有作业...即当有人单击 asp.net 网页上的按钮时。

我怎样才能做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T20:52:13.523

看看这里： [SMO 工作类](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.agent.job.aspx)

[SQL Server 管理对象 (SMO) 类库](http://msdn.microsoft.com/en-us/library/cc285859.aspx)允许您在SQL Server 中以编程方式执行几乎所有操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T21:03:23.887

查看：

[http://msdn.microsoft.com/en-us/library/ms186273(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms186273(SQL.90).aspx)

涵盖 SMO 和 T-SQL 方法。

# math - 任意旋转中两条抛物线相交的代码或公式

> ID：129815
> 
> 赞同：5
> 
> 时间：2008-09-24T20:37:37.067
> 
> 标签：math, graphics, geometry, planerotation

我正在研究一个几何问题，该问题需要在任何旋转中找到两个抛物线弧的交点。我能够通过旋转平面以将弧与轴对齐来对直线和抛物线进行交叉，但两条抛物线不能同时与轴对齐。我正在推导公式，但我想知道是否有可用的资源。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T20:51:03.400

我首先定义没有旋转的 2D 抛物线方程：

```
 x(t) = ax² + bx + c
  y(t) = t; 
```

您现在可以通过构建旋转矩阵来应用旋转：

```
 s = sin(angle)
  c = cos(angle)

  matrix = | c -s |
           | s  c | 
```

应用该矩阵，您将得到旋转的参数方程：

```
x' (t) = x(t) * c - s*t;
y' (t) = x(t) * s + c*t; 
```

这将为您提供抛物线弧的两个方程（用于 x 和 y）。

对两个旋转的弧都这样做并减去它们。这给了你一个这样的等式：

```
 xa'(t) = rotated equation of arc1 in x
  ya'(t) = rotated equation of arc1 in y.
  xb'(t) = rotated equation of arc2 in x
  yb'(t) = rotated equation of arc2 in y.
  t1 = parametric value of arc1
  t2 = parametric value of arc2

  0 = xa'(t1) - xb'(t2)
  0 = ya'(t1) - yb'(t2) 
```

这些方程中的每一个都只是一个 2 阶多项式。这些都很容易解决。

要找到交点，请求解上述方程（例如，找到根）。

每个轴最多可以有两个根。在 x 和 y 上相等的任何根都是曲线之间的交点。

现在很容易获得位置：只需将根代入参数方程，即可直接获得 x 和 y。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-02T02:40:53.910

不幸的是，一般答案需要求解四阶多项式。如果我们变换坐标，使两条抛物线之一为标准形式 y=x^2，那么第二条抛物线满足 (ax+by)^2+cx+dy+e==0。要找到交叉点，请同时解决这两个问题。代入 y=x^2 我们看到结果是一个四阶多项式：(ax+bx^2)^2+cx+dx^2+e==0。因此，Nils 解决方案将不起作用（他的错误：每个变量分别是每个变量的二阶多项式，但它们一起不是）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-26T06:51:42.613

如果您手头有 CAS，这很容易。

请参阅 Mathematica 中的解决方案。

选择一条抛物线并更改坐标，使其方程变为 y(x)=ax^2（普通形式）。

另一条抛物线将具有一般形式：

```
A x^2 + B x y + CC y^2 + DD x + EE y + F == 0 

where B^2-4 A C ==0 (so it's a parabola) 
```

让我们解决一个数字案例：

```
p = {a -> 1, A -> 1, B -> 2, CC -> 1, DD -> 1, EE -> -1, F -> 1};
p1 = {ToRules@N@Reduce[
       (A x^2 + B x y + CC y^2 + DD x + EE y +F /. {y -> a x^2 } /. p) == 0, x]} 
```

{{x -> -2.11769}, {x -> -0.641445}, {x -> 0.379567- 0.76948 I}, {x -> 0.379567+ 0.76948 I}}

让我们绘制它：

```
Show[{
  Plot[a x^2 /. p, {x, -10, 10}, PlotRange -> {{-10, 10}, {-5, 5}}], 
  ContourPlot[(A x^2 + B x y + CC y^2 + DD x + EE y + F /. p) == 
    0, {x, -10, 10}, {y, -10, 10}],
  Graphics[{
    PointSize[Large], Pink, Point[{x, x^2} /. p /. p1[[1]]],
    PointSize[Large], Pink, Point[{x, x^2} /. p /. p1[[2]]]
    }]}] 
```

![在此处输入图像描述](https://i.stack.imgur.com/WhTZJ.png)

一般解决方案包括计算以下的根：

```
4 A F + 4 A DD x + (4 A^2 + 4 a A EE) x^2 + 4 a A B x^3 + a^2 B^2 x^4 == 0 
```

这在任何 CAS 中都很容易完成。

# keyboard - 远程登录退格键错误

> ID：129826
> 
> 赞同：4
> 
> 时间：2008-09-24T20:39:40.153
> 
> 标签：keyboard, solaris, telnet, xterm

当我远程登录到我们的工作太阳站时，我的退格键不起作用。我使用以下临时解决方法：

$ stty 擦除 ^H

这行得通，但每次我远程登录时，我都必须重新输入。如何设置它以在我的 .cshrc 文件中正常工作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T20:40:33.987

您可以将 stty erase ^H 放入 .cshrc 文件中。这将解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T22:01:35.353

登录到 Solaris 系统时，^H 将是默认的擦除键。我假设您友好的管理员将其更改为 ^？在您的 shell 的配置文件中的某个位置（使用 stty -a 查看）。一个可能的原因是使 Solaris 的行为更像该站点上的其他系统。因此，您可能需要考虑更改 telnet 客户端的行为（发送 ^? 而不是 ^H）。

附带说明 - telnet 以明文形式发送所有信息，包括您的用户名和密码。SSH 加密所有通信，完成 telnet 所做的一切等等。它现在很常见，即使在相当新的 Solaris 版本上也是如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T21:17:51.730

实际上，我之前遇到过多个级别的问题。X 窗口有时将 DEL 映射到 Backspace，反之亦然。有时通过另一台机器登录到一台机器也会这样做。

以下是如何解决这个问题的全面介绍：http: [//www.ibb.net/~anne/keyboard.html](http://www.ibb.net/~anne/keyboard.html)

# podcast - 通过过滤器滑动播客

> ID：129828
> 
> 赞同：0
> 
> 时间：2008-09-24T20:40:07.780
> 
> 标签：podcast

我的工作场所通过强制我们通过代理来过滤我们的互联网流量，不幸的是，IT Conversations 和 Libsyn 等网站被阻止了。但是，如果 mp3 文件来自不在代理黑名单上的站点，则它们通常不会被过滤。

那么是否有一个网站可以让我给它一个 URL，然后在该 URL 下载 MP3 并将其发送到我的方式，从而绕过代理？

或者，我还有其他简单的方法可以从工作中获取这些播客的 mp3 文件吗？

编辑和更新：由于我几次被否决，也许我应该解释/证明我的情况。我是在政府机构工作的承包商，我们使用一些商业过滤软件，这些软件非常激进和过分热心。我的老板对我在工作中收听播客很好，对我绕过代理过滤也很好，并且不想处理与让 IT 部门破例相关的重要繁文缛节（毕竟是政府）对于 IT Conversations 或 Java Posse 等。所以我觉得这对程序员来说是一个重要且相关的问题。

不幸的是，所有绕过网络过滤器的代理网站也都被屏蔽了，所以我可能不得不提前在家里下载我喜欢的播客，然后将它们投入工作。如果可以告诉我一个鲜为人知的服务，我可以尝试它可能不会被阻止，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T13:35:20.617

可以 SSH 出去吗？SSH 隧道是您的朋友！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T19:44:04.360

为什么不在家订阅并将您最喜欢的播客复制到您的 mp3 播放器或 USB 驱动器中，然后每天带着它与您一起工作，晚上回家？然后你就可以听了，你不会绕过你的客户网络。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T20:50:36.723

还有许多其他 Development/Dotnet/Technology 播客，请尝试其中[之一](https://stackoverflow.com/questions/1644/what-good-technology-podcasts-are-out-there)。对于被阻止的站点，请尝试匿名代理站点，那里有很多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T20:51:45.660

由于这是与工作相关的材料，我建议您提出请求，不要阻止相关网站。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-05T18:04:08.687

我最终编写了一个非常愚蠢和简单的 cgi 脚本并将其托管在我的 Web 服务器上，并在我的工作计算机上使用脚本来获取它。这是 CGI 脚本：

```
#!/usr/local/bin/python

import cgitb; cgitb.enable()
import cgi
from urllib2 import urlopen

def tohex(data):
    return "".join(hex(ord(char))[2:].rjust(2,"0") for char in data)

def fromhex(encoded):
    data = ""
    while encoded:
        data += chr(int(encoded[:2], 16))
        encoded = encoded[2:]
    return data

if __name__=="__main__":
    print("Content-type: text/plain")
    print("")
    url = fromhex( cgi.FieldStorage()["target"].value )
    contents = urlopen(url).read()
    for i in range(len(contents)/40+1):
        print( tohex(contents[40*i:40*i+40]) ) 
```

这是用于下载播客的客户端脚本：

```
#!/usr/bin/env python2.6
import os
from sys import argv
from urllib2 import build_opener, ProxyHandler

if os.fork():
   exit()

def tohex(data):
   return "".join(hex(ord(char))[2:].rjust(2,"0") for char in data)

def fromhex(encoded):
   data = ""
   while encoded:
       data += chr(int(encoded[:2], 16))
       encoded = encoded[2:]
   return data

if __name__=="__main__":
   if len(argv) < 2:
       print("usage: %s URL [FILENAME]" % argv[0])
       quit()

   os.chdir("/home/courtwright/mp3s")
   url = "http://example.com/cgi-bin/hex.py?target=%s" % tohex(argv[1])
   fname = argv[2] if len(argv)>2 else argv[1].split("/")[-1]
   with open(fname, "wb") as dest:
       for line in build_opener(ProxyHandler({"http":"proxy.example.com:8080"})).open(url):
           dest.write( fromhex(line.strip()) )
           dest.flush() 
```

# .net - SharePoint 中的表单

> ID：129829
> 
> 赞同：4
> 
> 时间：2008-09-24T20:40:22.647
> 
> 标签：.net, sharepoint, forms, infopath

如果我想在 SharePoint 上放置表单，使用 InfoPath 或在 C# 中构建自定义 Web 部件更容易吗？我应该考虑其他选择吗？

每个选项的要求和障碍是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T20:53:35.190

使用 InfoPath 构建表单绝对是在 SharePoint 中发布表单的最简单方法。请注意，它有很多限制，您可能会发现自己试图放置一些有问题的逻辑或需要额外的功能。

使用 C# 进行编程需要 C# 知识（当然）和 SharePoint 的 API 知识。此外，一旦完成，生成的 DLL 必须由 SharePoint 发布和信任，这需要系统管理员的干预。这可能并不总是对您可用，并且在您下次尝试升级 SharePoint 时可能会出现问题。

最后，我建议尝试通过使用 SharePoint 的内置功能来完成大部分工作（包括表单）。如果您深入研究一下，您会发现您实际上可以通过自定义列表的视图、排列字段的顺序、添加您自己的列（和站点列）等来构建复杂的应用程序。这种方法是纯粹的 SharePoint。不需要额外的知识（和人员）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T21:06:54.017

实际上，您不需要太多的 SharePoint API 知识即可创建自定义 Web 表单。这是一个非常直接的过程；我手边没有任何链接，但应该有不少“hello world”示例可以帮助您入门。SharePoint Web 部件的棘手部分是如何最好地调试和部署它们。

我认识一些顾问，他们在他们的笔记本电脑上本地运行一整套虚拟服务器，以便他们可以使用所有东西。这不是我的选择。我的小组使用 System.Web.UI.WebControls.WebParts.WebPart，因此我们可以在部署到我们的开发环境之前进行本地测试。请注意，如果您走这条路，则无法在本地进行完全测试，因为您将丢失一些 SharePoint 元素，例如样式表和系统提供的 Web 部件。至于部署，我们仍在研究细节。您可以手动执行此操作，但它不适用于锁定的生产环境。一种审查方法是“特征”；它看起来很有希望作为单个安装程序应用新的增强功能，尽管我不确定您如何处理它的错误修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T20:53:17.607

您能否更具体地了解表单和共享点版本？

这取决于您的 Sharepoint 版本：如果您有 2003，如果您想使用 InfoPath，它也必须安装在客户端上。在 SharePoint 2007 上，我**认为**它不是必需的。

如果它是一个没有业务规则的大型表单，InfoPath 可以是要走的路 -> 所见即所得，并且易于部署。

如果您的表单涉及更多业务规则，则 _layouts 中的 Web 部件或页面可以“更简单”且更易于维护。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T20:59:01.260

Infopath 擅长快速构建表单并将它们扔到 Sharepoint 上。我希望它比构建自定义 C# 应用程序快 1000 倍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-10T14:24:17.177

这可能取决于您的想法

例如，1\. 如果您试图将控制权交给最终用户以便自己自定义表单，您可以选择 Infopath。

Infopath 非常容易理解、开发。为了使用 infopath，您必须学习 Infopath、Infopath Form Services 和 Sharepoint api 来整合 Dotnet (C#) 和 Sharepoint。

# sql-server - 如何查询当前 SQL Server 数据库实例的名称？

> ID：129861
> 
> 赞同：35
> 
> 时间：2008-09-24T20:46:13.193
> 
> 标签：sql-server, tsql

这有点像“鸡或蛋”类型的查询，但有人能想出一个可以返回执行查询的当前数据库实例名称的查询吗？当我说我理解这个悖论时请相信我：如果您已经连接到执行查询，为什么还需要知道数据库实例的名称？在多数据库环境中进行审计。

我查看了联机丛书中的所有@@ 全局变量。" `SELECT @@servername`" 很接近，但我想要数据库实例的名称而不是服务器的名称。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-24T20:48:59.990

```
SELECT DB_NAME() 
```

返回数据库名称。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2015-05-22T09:38:01.870

```
SELECT
 @@servername AS 'Server Name' -- The database server's machine name
,@@servicename AS 'Instance Name' -- e.g.: MSSQLSERVER
,DB_NAME() AS 'Database Name'
,HOST_NAME() AS 'Host Name' -- The database client's machine name 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T20:51:35.630

您可以使用**DB_NAME()**：

```
SELECT DB_NAME() 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T21:23:24.010

我不确定你到底在问什么。当您为审计需要编写此过程时，我猜您是在问当存储过程存在于另一个数据库中时如何获取当前数据库名称。例如

```
USE DATABASE1
GO
CREATE PROC spGetContext AS
SELECT DB_NAME()
GO
USE DATABASE2
GO
EXEC DATABASE1..spGetContext
/* RETURNS 'DATABASE1' not 'DATABASE2' */ 
```

这是正确的行为，但并不总是您想要的。为了解决这个问题，您需要在主数据库中创建 SP 并将该过程标记为系统过程。执行此操作的方法在 SQL Server 版本之间有所不同，但这里是 SQL Server 2005 的方法（可以在 2000 中使用该`master.dbo.sp_MS_upd_sysobj_category`函数执行此操作）。

```
USE MASTER
/* You must begin function name with sp_ */
CREATE FUNCTION sp_GetContext
AS
SELECT DB_NAME()
GO
EXEC sys.sp_MS_marksystemobject sp_GetContext

USE DATABASE2
/* Note - no need to reference master when calling SP */
EXEC sp_GetContext
/* RETURNS 'DATABASE2' */ 
```

希望这就是你要找的

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T20:49:10.050

```
SELECT DB_NAME() AS DatabaseName 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-07-22T09:24:09.010

**只需使用：**

```
select @@servicename 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T20:50:55.570

您应该能够使用：

```
SELECT SERVERPROPERTY ('InstanceName') 
```

# optimization - 如何编写通用的 memoize 函数？

> ID：129877
> 
> 赞同：11
> 
> 时间：2008-09-24T20:48:41.457
> 
> 标签：optimization, recursion, lua, closures, memoization

我正在编写一个函数来查找[三角形数](http://projecteuler.net/index.php?section=problems&id=12)，而编写它的自然方法是递归：

```
function triangle (x)
   if x == 0 then return 0 end
   return x+triangle(x-1)
end 
```

但是尝试计算前 100,000 个三角形数会在一段时间后因堆栈溢出而失败。这是[memoize](http://perl.plover.com/Memoize/)的理想函数，但我想要一个能够记住我传递给它的任何函数的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-06T02:17:23.290

Mathematica 有一种特别巧妙的方式来做记忆，依赖于哈希和函数调用使用相同的语法这一事实：

```
triangle[0] = 0;
triangle[x_] := triangle[x] = x + triangle[x-1] 
```

就是这样。它之所以有效，是因为模式匹配函数调用的规则是，它总是在更一般的定义之前使用更具体的定义。

当然，正如已经指出的那样，这个例子有一个封闭形式的解决方案：`triangle[x_] := x*(x+1)/2`. 斐波那契数是添加记忆如何显着加速的经典示例：

```
fib[0] = 1;
fib[1] = 1;
fib[n_] := fib[n] = fib[n-1] + fib[n-2] 
```

虽然这也有一个封闭形式的等价物，尽管更混乱： http: [//mathworld.wolfram.com/FibonacciNumber.html](http://mathworld.wolfram.com/FibonacciNumber.html)

我不同意那个建议这不适合记忆的人，因为你可以“只使用一个循环”。记忆的要点是任何重复的函数调用都是 O(1) 时间。这比 O(n) 好很多。事实上，您甚至可以编造一个场景，其中 memoized 的实现比封闭形式的实现具有更好的性能！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T20:56:50.580

您还为原始问题提出了错误的问题；）

对于这种情况，这是一种更好的方法：

三角形(n) = n * (n - 1) / 2

此外，假设公式没有这样一个简洁的解决方案，记忆仍然是一个糟糕的方法。在这种情况下，您最好只编写一个简单的循环。请参阅[此答案](https://stackoverflow.com/questions/129877/how-do-i-write-a-generic-memoize-function#130006)以进行更全面的讨论。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T20:15:21.837

我敢打赌，这样的事情应该适用于 Lua 中的变量参数列表：

```
local function varg_tostring(...)
    local s = select(1, ...)
    for n = 2, select('#', ...) do
        s = s..","..select(n,...)
    end
    return s
end

local function memoize(f)
    local cache = {}
    return function (...)
        local al = varg_tostring(...)
        if cache[al] then
            return cache[al]
        else
            local y = f(...)
            cache[al] = y
            return y
        end
    end
end 
```

您可能还可以使用带有 __tostring 的元表做一些聪明的事情，以便可以使用 tostring() 转换参数列表。哦，可能性。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-11-20T20:13:31.507

在 C# 3.0 - 对于递归函数，您可以执行以下操作：

```
public static class Helpers
{
    public static Func<A, R> Memoize<A, R>(this Func<A, Func<A,R>,  R> f)
    {
        var map = new Dictionary<A, R>();
        Func<A, R> self = null;
        self = (a) =>
        {
            R value;
            if (map.TryGetValue(a, out value))
                return value;
            value = f(a, self);
            map.Add(a, value);
            return value;
        };
        return self;
    }        
} 
```

然后你可以创建一个这样的记忆斐波那契函数：

```
var memoized_fib = Helpers.Memoize<int, int>((n,fib) => n > 1 ? fib(n - 1) + fib(n - 2) : n);
Console.WriteLine(memoized_fib(40)); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T20:54:17.637

在 Scala 中（未经测试）：

```
def memoize[A, B](f: (A)=>B) = {
  var cache = Map[A, B]()

  { x: A =>
    if (cache contains x) cache(x) else {
      val back = f(x)
      cache += (x -> back)

      back
    }
  }
} 
```

请注意，这仅适用于 arity 1 的函数，但通过 currying 您可以使其工作。更微妙的问题是`memoize(f) != memoize(f)`对于任何函数`f`。解决此问题的一种非常偷偷摸摸的方法如下：

```
val correctMem = memoize(memoize _) 
```

我认为这不会编译，但它确实说明了这个想法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-24T21:10:04.917

**更新**：评论者指出，记忆是优化递归的好方法。诚然，我以前没有考虑过这一点，因为我通常使用一种语言 (C#)，在这种语言中，通用的记忆化并不是那么容易构建的。牢记那粒盐，拿下面的帖子。

我认为[Luke 可能对这个问题有最合适的解决方案](https://stackoverflow.com/questions/129877/how-do-i-write-a-generic-memoize-function#129924)，但记忆化通常不是任何堆栈溢出问题的解决方案。

堆栈溢出通常是由于递归超出平台可以处理的深度引起的。语言有时支持“[尾递归](http://en.wikipedia.org/wiki/Tail_recursion)”，它重用当前调用的上下文，而不是为递归调用创建新的上下文。但是很多主流语言/平台不支持这一点。例如，C# 没有对尾递归的固有支持。.NET JITter 的 64 位版本可以将其用作 IL 级别的优化，如果您需要支持 32 位平台，这几乎是无用的。

如果您的语言不支持尾递归，那么避免堆栈溢出的最佳选择是转换为显式循环（不太优雅，但有时​​是必要的），或者找到一个非迭代算法，例如为这个问题提供的 Luke。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T20:49:08.303

```
function memoize (f)
   local cache = {}
   return function (x)
             if cache[x] then
                return cache[x]
             else
                local y = f(x)
                cache[x] = y
                return y
             end
          end
end

triangle = memoize(triangle); 
```

请注意，为避免堆栈溢出，三角形仍需要播种。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-09-06T19:36:36.857

这是无需将参数转换为字符串即可工作的东西。唯一需要注意的是它无法处理 nil 参数。但是公认的解决方案无法区分 value`nil`和 string `"nil"`，所以这可能没问题。

```
local function m(f)
  local t = { }
  local function mf(x, ...) -- memoized f
    assert(x ~= nil, 'nil passed to memoized function')
    if select('#', ...) > 0 then
      t[x] = t[x] or m(function(...) return f(x, ...) end)
      return t[x](...)
    else
      t[x] = t[x] or f(x)
      assert(t[x] ~= nil, 'memoized function returns nil')
      return t[x]
    end
  end
  return mf
end 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-04-20T22:07:37.087

我受到这个问题的启发，在 Lua 中实现（又一个）灵活的 memoize 功能。

[https://github.com/kikito/memoize.lua](https://github.com/kikito/memoize.lua)

主要优点：

*   接受可变数量的参数
*   不使用 tostring；相反，它以树结构组织缓存，使用参数对其进行遍历。
*   适用于返回[多个值](http://www.lua.org/pil/5.1.html)的函数。

在此处粘贴代码作为参考：

```
local globalCache = {}

local function getFromCache(cache, args)
  local node = cache
  for i=1, #args do
    if not node.children then return {} end
    node = node.children[args[i]]
    if not node then return {} end
  end
  return node.results
end

local function insertInCache(cache, args, results)
  local arg
  local node = cache
  for i=1, #args do
    arg = args[i]
    node.children = node.children or {}
    node.children[arg] = node.children[arg] or {}
    node = node.children[arg]
  end
  node.results = results
end

-- public function

local function memoize(f)
  globalCache[f] = { results = {} }
  return function (...)
    local results = getFromCache( globalCache[f], {...} )

    if #results == 0 then
      results = { f(...) }
      insertInCache(globalCache[f], {...}, results)
    end

    return unpack(results)
  end
end

return memoize 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T20:53:01.493

这是一个通用的 C# 3.0 实现，如果有帮助的话：

```
public static class Memoization
{
    public static Func<T, TResult> Memoize<T, TResult>(this Func<T, TResult> function)
    {
        var cache = new Dictionary<T, TResult>();
        var nullCache = default(TResult);
        var isNullCacheSet = false;
        return  parameter =>
                {
                    TResult value;

                    if (parameter == null && isNullCacheSet)
                    {
                        return nullCache;
                    }

                    if (parameter == null)
                    {
                        nullCache = function(parameter);
                        isNullCacheSet = true;
                        return nullCache;
                    }

                    if (cache.TryGetValue(parameter, out value))
                    {
                        return value;
                    }

                    value = function(parameter);
                    cache.Add(parameter, value);
                    return value;
                };
    }
} 
```

（引自[法国博客文章](http://codingly.com/2008/05/02/optimisation-des-invocations-dynamiques-de-methodes-en-c/)）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-27T22:31:58.270

在以不同语言发布备忘录的情况下，我想用一个不改变语言的 C++ 示例来回复@onebyone.livejournal.com。

首先，单个 arg 函数的记忆器：

```
template <class Result, class Arg, class ResultStore = std::map<Arg, Result> >
class memoizer1{
public:
    template <class F>
    const Result& operator()(F f, const Arg& a){
        typename ResultStore::const_iterator it = memo_.find(a);
        if(it == memo_.end()) {
            it = memo_.insert(make_pair(a, f(a))).first;
        }
        return it->second;
    }
private:
    ResultStore memo_;
}; 
```

只需创建一个 memoizer 实例，将您的函数和参数提供给它。只要确保不要在两个不同的函数之间共享相同的备忘录（但您可以在同一函数的不同实现之间共享它）。

接下来，一个驱动函数和一个实现。只有驱动函数需要 public int fib(int); // 驱动程序 int fib_(int); // 执行

实施的：

```
int fib_(int n){
    ++total_ops;
    if(n == 0 || n == 1) 
        return 1;
    else
        return fib(n-1) + fib(n-2);
} 
```

和司机，记住

```
int fib(int n) {
    static memoizer1<int,int> memo;
    return memo(fib_, n);
} 
```

永久链接在 codepad.org 上[显示输出。](http://codepad.org/4zddwKft)测量调用次数以验证正确性。（在此处插入单元测试...）

这只会记住一个输入函数。概括多个参数或不同的参数作为练习留给读者。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-04T20:26:01.700

在 Perl 中，通用记忆很容易获得。Memoize 模块是 perl 核心的一部分，非常可靠、灵活且易于使用。

它的手册页中的示例：

```
# This is the documentation for Memoize 1.01
use Memoize;
memoize('slow_function');
slow_function(arguments);    # Is faster than it was before 
```

您可以在运行时添加、删除和自定义函数的记忆*！*您可以为自定义纪念品计算提供回调。

Memoize.pm 甚至具有使 memento 缓存持久化的功能，因此无需在每次调用程序时重新填充！

这是文档： http: [//perldoc.perl.org/5.8.8/Memoize.html](http://perldoc.perl.org/5.8.8/Memoize.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-26T18:50:05.457

扩展这个想法，还可以使用两个输入参数来记忆函数：

```
function memoize2 (f)
   local cache = {}
   return function (x, y)
             if cache[x..','..y] then
                return cache[x..','..y]
             else
                local z = f(x,y)
                cache[x..','..y] = z
                return z
             end
          end
end 
```

请注意，参数顺序在缓存算法中很重要，因此如果参数顺序在要记忆的函数中无关紧要，则通过在检查缓存之前对参数进行排序来增加缓存命中的几率。

但重要的是要注意，某些功能无法以有利可图的方式进行记忆。我写了**memoize2**来看看是否可以加快寻找最大公约数的递归[欧几里得算法。](http://en.wikipedia.org/wiki/Euclidean_algorithm)

```
function gcd (a, b) 
   if b == 0 then return a end
   return gcd(b, a%b)
end 
```

事实证明，**gcd**对记忆的反应并不好。它所做的计算比缓存算法便宜得多。对于大量数据，它会很快终止。一段时间后，缓存变得非常大。该算法可能尽可能快。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-12-06T04:42:46.383

递归不是必需的。第 n 个三角形数是 n(n-1)/2，所以...

```
public int triangle(final int n){
   return n * (n - 1) / 2;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-06T01:45:43.673

请不要递归这个。要么使用 x*(x+1)/2 公式，要么简单地迭代值并随时记忆。

```
int[] memo = new int[n+1];
int sum = 0;
for(int i = 0; i <= n; ++i)
{
  sum+=i;
  memo[i] = sum;
}
return memo[n]; 
```

# testing - 符合规范的简单验收测试

> ID：129884
> 
> 赞同：7
> 
> 时间：2008-09-24T20:50:15.960
> 
> 标签：testing, automated-tests, specifications, acceptance-testing

我正在寻找一种工具/框架来进行自动验收测试。创建新测试的界面应该非常简单，以至于非程序员（客户、老板）将能够添加将自动测试的规范。

它应该是从命令行执行测试的某种方式，包括在自动构建中运行测试。

我更喜欢 Java 和开源，但我的问题不受这种限制。

你有什么可以推荐的，请解释为什么你的工具/框架是世界上最好的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T20:53:43.440

[http://fitnesse.org/](http://fitnesse.org/)似乎满足您想要的所有资格。这是我成功使用的一种。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-04-05T04:15:24.793

我认为其中几个选项非常好，您应该测试它们以查看哪些适合您的团队：

*   [黄瓜](http://cukes.info/)（红宝石）
*   [健身](http://fitnesse.org/)
*   [机器人框架](http://robotframework.org)（Python/Java）
*   [为 Java 行事](http://jbehave.org/)
*   [规范流](http://www.specflow.org/)(.net)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T09:38:28.637

我找到了一个名为[Concordion](http://www.concordion.org/)的框架，可以满足我的需求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-16T21:42:01.380

Another framework you may want to look at is [Robot Framework](http://robotframework.org). To see how test cases look like, take a look at the [Quick Start Guide](http://robotframework.googlecode.com/svn/trunk/doc/quickstart/quickstart.html#test-cases).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T12:27:12.213

您所要求的似乎是一个非常明确的系统，具有非常特定的输入集和系统内置或为您的系统开发的高度自动化。

[HP Quick Test Pro](http://en.wikipedia.org/wiki/QuickTest_Professional)等商业应用程序不够技术性，需要额外的框架，例如[Sonnet](http://www.sonata-software.com/html/sonnettest-mang-test.htm)的框架，这是朝着正确方向迈出的一步，但既不是开源的也不是基于 Java 的。

即使有一个框架，以自动化的方式进行这项工作也是相当多的工作。我希望您考虑开发框架所需的时间与手动运行这些测试并验证您是否充分利用了时间的时间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-25T17:01:31.607

[黄瓜](http://github.com/aslakhellesoy/cucumber)怎么样：

```
Feature: Acceptance testing framework

  Scenario: an example speaks volumes
    Given a text example
    When it is read
    Then the simplicity will be appreciated 
```

您需要开发人员与老板讨论每一行的真正含义并实施步骤定义来驱动它：

```
Given /^a text example$/ do
  file.open("example.txt", "w") { |file| file.write "text example" }
end

When /^it is read$/ do
  SystemUnderTest.read("example.txt")
end

Then /^the simplicity will be appreciated$/ do
  SystemUnderTest.simplicity.should be_appreciated
end 
```

# objective-c - 传递 NSMutableArray 对象

> ID：129890
> 
> 赞同：2
> 
> 时间：2008-09-24T20:51:06.600
> 
> 标签：objective-c

我相信，我在指针领域迷路了。我有这个（代码语法可能有点不对劲，我不是在看上面有这个代码的机器......但是所有相关的细节都是正确的）：

```
NSMutableArray *tmp = [[NSMutableArray alloc] init]; 
```

我他们把它传给另一个班级的例行公事

```
- (BOOL)myRoutine: (NSMutableArray *)inArray
{
    // Adds items to the array -- if I break at the end of this function, the inArray variable has a count of 10
} 
```

但是当代码返回调用例程时，[tmp count] 为 0。

我一定错过了一些非常简单但非常基本的东西，但对于我的生活，我看不到它。谁能指出我做错了什么？

编辑： www.stray-bits.com 询问我是否保留了对它的引用，我说“也许......我们试过这个：NSMutableArray *tmp = [[[NSMutableArray alloc] init] retain]; 不确定是否是你的意思，或者如果我做对了。

EDIT2：迈克麦克马斯特和安迪——那么你们可能是对的。我这里没有代码（它在同事的机器上，他们已经离开了一天），但是为了用值填充数组，我们正在按照使用解码器（？）对象的方式做一些事情。

这个函数的目的是从 iPhone 打开一个文件，将该文件读入一个数组（它是我们在之前的程序运行中保存的一个对象数组）。那个“解码器”有一种方法可以将数据放入数组中。

伙计，我已经完全杀死了这个。真心希望大家能关注，谢谢指教。我们将更仔细地研究它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T21:40:10.600

在这种情况下，您不需要调用保留。[[NSMutableArray alloc] init] 创建保留计数为 1 的对象，因此在您明确释放它之前它不会被释放。

看到更多代码会很好。我认为到目前为止您发布的错误数量并不多..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:54:17.540

我同意迈克的观点 - 根据您发布的代码，它看起来是正确的。除了发布用于调用函数并将项目添加到数组中的代码之外，您还可以尝试检查函数末尾的指针的内存地址（当它具有所有对象时），以及一旦它返回（当它没有对象时）。我不确定为什么会有所不同，但是这些项目也应该保留在数组中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T22:23:57.750

您需要向我们展示更多有关如何将对象添加到数组中的信息，以便我们真正提供帮助。

我见过很多人写这样的代码：

```
NSMutableArray *array = [[NSMutableArray alloc] initWithCapacity:0];

array = [foo bar]; 
```

这样做的人认为它“创建然后设置”一个可变数组，但这根本不是它所做的。相反，它创建一个可变数组，将其分配给名为 的变量`array`，然后将*另一个*可变数组分配给该变量。

因此，请确保您不会混淆它所引用的对象的变量。对象不是变量，它是*通过*变量进行交互的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T20:53:38.013

NSMutableArray 保留添加到其中的对象，但您是否保留了数组本身？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T05:59:44.723

您发布的代码应该可以工作。您必须在解码器功能中做一些有趣的事情。

您不应保留该数组。它会自动保留在 init 中。如果你保留它，你会泄漏内存。如果您只是从目标 c 开始，请花时间阅读“Cocoa 内存管理编程指南简介”。它会让你头疼不已。

你为什么要写这么多代码来从文件中读取数组？它已经被框架支持：

> + arrayWithContentsOfFile：
> 
> 返回从指定文件的内容初始化的数组。指定的文件可以是完整路径名或相对路径名；它命名的文件必须包含数组的字符串表示形式，例如由 writeToFile:atomically: 方法生成的。

所以你可以这样做：

```
NSMuatableArray *myArray = [NSMutableArray arrayWithContentsOfFile:@"path/to/my/file"]; 
```

这是一个方便的方法，所以对象会自动释放。如果您想保留它，请务必保留它。

# javascript - Javascript 和会话变量

> ID：129898
> 
> 赞同：3
> 
> 时间：2008-09-24T20:52:27.377
> 
> 标签：javascript, session

我有一个在其中存储事件的数据库和一个带有日历对象的页面。在渲染日期时，它会查看月份事件，如果与当前日期匹配，它会创建一个链接按钮来表示日历上当天的事件并将其添加到该单元格。我向链接按钮添加了一些 javascript，以将 window.location 更改为页面以查看在查询字符串中传递 EventID 的事件详细信息（我尝试设置新创建的链接按钮的 postbackurl，但它不会导致回发......不走运）。我需要设置一个会话变量，即。Session("EditMode") = "Edit" 那么新页面会知道它是获取现有事件信息而不是准备创建新事件吗？有什么建议么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T21:05:41.650

您的会话变量由服务器控制，JS 运行客户端，因此无法直接修改变量。

您需要使用 POST 或 GET 和隐藏的 iframe 或 XMLHTTPRequest() 调用来发出服务器请求以将数据从 JS 发送到服务器，然后让您的服务器端代码处理变量。

添加另一个查询字符串变量，该页面可用于触发现有与新的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T20:54:13.940

添加另一个查询字符串变量，该页面可用于触发现有与新的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-18T05:32:31.977

如果你使用类似 Struts2 的东西，你可以在你的 jsp 中有一个隐藏变量

```
<s:hidden id="EditModeId" value="%{#session.EditMode}"/> 
```

并且在 javascript 中简单地访问这个变量

```
alert(document.getElementById('EditModeId').value); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T23:40:37.267

您肯定需要向目标页面添加一个变量。但我认为你正在做一个弹出场景，所以你应该能够创建一个 JavaScript 函数 OpenWindow() 并在用户单击链接时将其关闭。

```
<script>
function OpenWindow(eventId, editMode)
{
    var window = window.open("popup.aspx?eventId=" + eventId + "&editMode=" + editMode);
}
</script> 
```

在服务器端，您需要构建对 OpenWindow 函数的调用。例如：

```
onclick="OpenWindow(eventId=" + row["eventId"].ToString() + "&editMode=" + editMode.ToString() + ");" 
```

因此，换句话说，准备好服务器端的所有内容以设置您的 javascript 以将所有变量发布到新页面。希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-01T10:56:46.673

```
var page1 = document.getElementById("textbox").value; 
sessionStorage.setItem("page1content", page1); 
```

在其他页面中将此值用作会话变量

```
document.getElementById("textbox2").value=sessionStorage.getItem("page1content"); 
```

# c - 将数据添加到闪存中的段如何会破坏程序的时序？

> ID：129911
> 
> 赞同：4
> 
> 时间：2008-09-24T20:54:20.537
> 
> 标签：c, performance, embedded, real-time

我有一个实时嵌入式应用程序，主要周期以 10KHz 运行。它在配置为从闪存启动的 TI TMS320C 上运行。我最近在一个源文件中添加了一个初始化数组，突然之间时间被搞砸了（以一种太复杂的方式无法很好地解释——本质上串行端口写入不再按时完成。）

这件事让我感到困惑：

*   我***什至没有访问新数据***，只是声明了一个初始化数组。
*   它取决于大小 - 仅当数组大于 40 个字时才会出现问题。
*   我知道我没有溢出链接图中的任何数据段。
*   没有数据缓存，因此不是由于破坏了缓存一致性。

关于如何简单地增加闪存中 .cinit 段的大小会影响代码的时序的任何想法？

附加信息：
我认为代码可能已经移动，但它与数据分离良好。我通过内存映射验证了所有代码段在错误之前和之后都具有相同的地址。我还验证了没有一个段是完整的 - 地图中唯一更改的地址是 .cinit 部分中的少数。该部分包含用于初始化 ram 中的变量的数据值（如我的数组）。在 main() 被调用后，它不应该被访问。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:05:45.580

我的怀疑将指向您的数据/代码与底层媒体/内存之间的对齐方式发生变化。添加到您的数据中会更改堆中的内存位置（取决于内存模型），并且可能会将您的代码放在闪存设备上的“页面”边界上，从而导致以前不存在的延迟。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T22:31:17.623

也许新的静态分配数组将现有数据推送到较慢的内存区域，导致对该数据的访问变慢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:42:35.597

如果数组是其地址空间块中的最后一个东西，问题是否会再次出现？如果没有，请查看您的地图，尝试移动数组声明，以便将放置在它之后的东西一个一个地打乱到它之前。通过这种方式，您可以查明相关对象并开始找出移动它会导致延迟的原因。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T09:17:09.037

我会冒着风险声称您在这里没有性能问题，而是某种内存损坏，表现为性能问题。将数组添加到可执行文件中以更改内存图片。所以我的猜测是你的内存损坏大部分是无害的（即覆盖未使用的内存部分）并将你的内存移动超过 40 个字节会导致内​​存损坏造成更大的问题。哪一个是真正的问题

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T16:22:28.637

经过一天多的时间盯着痕迹和生成的程序集，我想我明白了。根本原因问题原来是一个设计问题，只有在启动串行端口写入的 ISR 与更高优先级的 ISR 冲突时才会导致故障。时间恰好计算出来，只需要在一个循环中添加一些额外的指令就可以导致两个中断发生冲突。

所以问题就变成了：在闪存中存储而不是访问额外的数据如何导致额外的指令被执行？

答案似乎与 Frosty 和 Frederico 的建议有关，但并不完全相同。新数组确实移动了一些现有变量，但不会跨越页面边界或移动到较慢的区域（在此板上，所有区域的访问时间应该相同）。但是它确实改变了一些经常访问的结构的偏移量，这导致优化器发出稍微不同的指令序列来访问它们。一种数据对齐可能会导致一个周期的流水线停顿，而另一种则不会。这几条指令改变了足够的时间，足以暴露潜在的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T21:10:40.623

初始化是否会覆盖另一段相邻的代码？是否有任何使用数组的结构或变量，现在更大并且可能导致堆栈溢出？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T21:19:08.060

也可能是银行或页面冲突。也许您有两个经常被调用的例程（中断处理程序等），它们位于同一页面，现在被分成两页。

# python - 让 Python 使用 ActiveTcl 库

> ID：129912
> 
> 赞同：1
> 
> 时间：2008-09-24T20:54:21.223
> 
> 标签：python, activetcl

有什么方法可以让 Python 使用我的 ActiveTcl 安装，而不必将 ActiveTcl 库复制到 Python/tcl 目录中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T21:48:23.903

不熟悉 ActiveTcl，但一般来说，当标准库中已经存在该名称时，如何获取要加载的包/模块：

```
import sys
dir_name="/usr/lib/mydir"
sys.path.insert(0,dir_name) 
```

将 dir_name 的值替换为包含您的包/模块的目录的路径，并在导入任何内容之前运行上述代码。这通常是通过“sitecustomize.py”文件完成的，因此它会在解释器启动后立即生效，因此您无需担心导入顺序。

# java - 我需要更改 Netbeans 中的哪些属性才能在 OS X 菜单栏和停靠栏中设置我的 java swing 应用程序的名称？我找到了 info.plist，但是在这里更改多个键中的 @PROJECTNAMEASIDENTIFIEER@ 没有效果。 问问题 ablarg 问问题 2008-09-24T20:55:10.410 630 次 This question shows research effort; it is useful and clear 2 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 我需要更改 Netbeans 中的哪些属性才能在 OS X 菜单栏和停靠栏中设置我的 java swing 应用程序的名称？我找到了 info.plist，但是在这里更改多个键中的 @PROJECTNAMEASIDENTIFIEER@ 没有效果。 谢谢，讨厌netbeans。 查看： nbproject/project.properties nbproject/project.xml 在 project.xml 中查找名称元素... 但是...为什么不直接选择主项目并右键单击并重命名？ javamacosnetbeansmenubar 4 3 回答 3 This answer is useful 2 答案取决于您如何运行您的应用程序。如果从命令行运行它，请在 JVM 参数中使用“-Xdock:name=appname”。请参阅 Dan Dyer 链接的文章中的“更多修改菜单栏”部分。 但是，如果您正在制作一个捆绑的、可双击的应用程序，您只需要在应用程序的 Info.plist 中设置标准的 CFBundle 相关键（有关更多详细信息，请参阅有关 Info.plist 键的文档）。 于 2009-06-11T05:44:10.170 回答 This answer is useful 2 查看： nbproject/project.properties nbproject/project.xml 在 project.xml 中查找名称元素... 但是...为什么不直接选择主项目并右键单击并重命名？ 于 2008-09-24T20:57:57.517 回答 This answer is useful 0 这不是特定于 NetBeans 的，但本文提供了一些有用的技巧来调整您的 Swing 应用程序以使其适合 OS X。 于 2008-09-24T21:04:10.110 回答 Related 1 xml - jsTree更改XML填充jsTree中子项的图标 1 android - GoogleMap 类对象抛出 Nullpointer 异常 1 windows - 我可以通过 \\192.xx.xx.xx 等路径访问我的 ftp 服务器吗？ 4 language-agnostic - 为什么在 IEEE754 标准中除以零会导致无限值？ 0 xml - 如何在同一个 xml 文件中获取 xml 参数值？ 1 php - Drupal simplenews 成功消息不显示 0 android - 如何克服android中撇号strings.xml中的错误？ 3 java - 警报对话框不显示在 strings.xml 中定义的 HTML 2 android - 使第一个 EditText 光标可见 1 iphone - 如何在状态栏下方显示下载进度 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：129915
> 
> 赞同：2
> 
> 时间：
> 
> 标签：java, macos, netbeans, menubar

我需要更改 Netbeans 中的哪些属性才能在 OS X 菜单栏和停靠栏中设置我的 java swing 应用程序的名称？我找到了 info.plist，但是在这里更改多个键中的 @PROJECTNAMEASIDENTIFIEER@ 没有效果。

谢谢，讨厌netbeans。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-11T05:44:10.170

答案取决于您如何运行您的应用程序。如果从命令行运行它，请在 JVM 参数中使用“-Xdock:name=appname”。请参阅 Dan Dyer 链接的文章中的“更多修改菜单栏”部分。

但是，如果您正在制作一个捆绑的、可双击的应用程序，您只需要在应用程序的 Info.plist 中设置标准的 CFBundle 相关键（有关更多详细信息，请参阅[有关 Info.plist 键的文档](http://developer.apple.com/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/PListKeys.html)）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T20:57:57.517

查看：

```
nbproject/project.properties

nbproject/project.xml 
```

在 project.xml 中查找名称元素...

但是...为什么不直接选择主项目并右键单击并重命名？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T21:04:10.110

这不是特定于 NetBeans 的，但[本文](http://java.sun.com/developer/technicalArticles/JavaLP/JavaToMac/)提供了一些有用的技巧来调整您的 Swing 应用程序以使其适合 OS X。

# c# - 从 C# 应用程序使用自定义 URL 启动 Web 浏览器的最佳方法是什么？

> ID：129917
> 
> 赞同：1
> 
> 时间：2008-09-24T20:55:49.007
> 
> 标签：c#, .net, browser

众所周知，使用 System.Diagnostics.Process.Start 是从 C# 应用程序启动 url 的方式：

System.Diagnostics.Process.Start(" [http://www.mywebsite.com](http://www.mywebsite.com) ");

但是，如果此 url 无效，则应用程序似乎无法知道调用失败或原因。有没有更好的方法来启动网络浏览器？如果没有，我最好的 url 验证选择是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T21:01:58.133

尝试如下方法。

```
try
{
    var url = new Uri("http://www.example.com/");

    Process.Start(url.AbsoluteUri);
}
catch (UriFormatException)
{
    // URL is not parsable
} 
```

这并不能确保资源存在，但可以确保 URL 格式正确。您可能还想检查该方案是否匹配 http 或 https。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T20:57:12.637

如果您需要验证 URL 是否存在，您唯一能做的就是提前创建一个自定义请求并验证它是否有效。不过，我仍然会使用 Process.Start 来打开实际页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T11:50:25.263

检查**Uri.IsWellFormedUriString**静态方法。它比捕获异常便宜。

# c++ - 使用目录中的文件名填充数据库

> ID：129919
> 
> 赞同：0
> 
> 时间：2008-09-24T20:56:03.840
> 
> 标签：c++, sql, c++builder

我有一个应用程序，它表现为文件夹中所有图片的幻灯片。它是用 Borland 的 C++ Builder (9) 编写的。它目前使用一些借用的代码将文件名放入列表框并将列表框项目保存为文本文件。

我想更新它，以便将文件名存储在适当的数据库中，以便我可以包含额外的字段并使用它执行适当的 SQL 操作。

所以基本上，如果我看到一些“示例”代码做同样的事情，我就能解决这个问题。

因此，如果有人知道执行此操作的任何代码，我将不胜感激。它需要能够对某些文件类型执行此操作……而不仅仅是所有文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:12:41.413

您基本上需要编写一个带有 TDataSet 参数的递归函数。

（我无法编译我的代码，所以你“按原样”得到它）

```
void AddFiles(AnsiString path, TDataSet *DataSet)
{
TSearchRec sr;
int f;
    f = FindFirst(path+"\\*.*", faAnyFile, sr);
    while( !f )
    {
        if(sr.Attr & faDirectory)
        {
            if(sr.Name != "."   &&   sr.Name != "..")
            {
                path.sprintf("%s%s%s", path, "\\", sr.Name);
                AddFiles(path, DataSet);
            }
        }
        else
        {
            DataSet->Append();
            DataSet->FieldByName("Name")->Value = sr.Name;
            /* other fields ... */
            DataSet->Post();
        }
        f = FindNext(sr);
    }
    FindClose(sr);
} 
```

# firefox - 你如何签署你的 Firefox 扩展？

> ID：129920
> 
> 赞同：16
> 
> 时间：2008-09-24T20:56:05.930
> 
> 标签：firefox, build-automation, certificate, code-signing

我已经为 Firefox 开发了几个扩展，但我很生气，很难让扩展签名。当扩展程序未签名时，它会在安装时显示“作者未验证”，对我来说这看起来是错误的。

我有一个简单的构建脚本，可以从源代码构建我的 .xpi 文件，并且我有 PKZip 的许可副本（根据许多教程，它需要构建 Firefox 所需的签名 xpi 文件），但我还没有找到一种获得实际有效的免费/廉价证书的方法或一组可以解决问题的说明。

由于我的扩展是免费的，我不想花 400 美元购买商业证书，但我不介意花 50 美元左右来完成它。我同时拥有 Linux 和 Windows 机器，尽管我的构建脚本当前使用的是 Windows 并且使用起来最方便。

你是怎么解决这个问题的？在构建扩展时，我需要做什么来自动安全地签署我的扩展？

编辑：我很欣赏谷歌的点击，但他们提供的步骤在如何真正获得有效的证书方面还不够完整。我得到的感觉让我想起了这个经典：

![替代文字](https://i.stack.imgur.com/PIgLC.gif "然后奇迹出现了……")

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T01:44:56.000

避免使用 GoDaddy 代码签名证书，因为必要的中间 CA 证书默认不在 Firefox 中。C=US,ST=Arizona,L=Scottsdale,O=GoDaddy.com\,Inc.,OU= [http://certificates.godaddy.com/repository,CN=Go](http://certificates.godaddy.com/repository,CN=Go) Daddy Secure Certification Authority,SERIALNUMBER=07969287'

如果您使用它签名，您的用户将收到签名错误。

例如

```
无法验证签名。-260
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T21:05:46.627

我在谷歌上发现的是：[http](http://www.mercille.org/snippets/xpiSigning.php) ://www.mercille.org/snippets/xpiSigning.php其中指出：

> 如果您不想要商业证书或买不起， [Ascertia](http://www.ascertia.com/)可以为您提供免费证书，但将其转换为代码签名证书需要一些额外的工作，我在 [另一页](http://www.mercille.org/snippets/xpiSigningFreeCA.php)上有详细说明。

我不能说我已经尝试过了。在[http://developer.mozilla.org/en/Signing_a_XPI](http://developer.mozilla.org/en/Signing_a_XPI)上它说：

> 最便宜的普遍支持（Mozilla、Java、Microsoft）证书似乎是 Comodo Instant-SSL 产品。您可以从 Unizeto Certum 为开源开发人员获取免费证书，但他们的根证书仅存在于 Mozilla Firefox 和 Opera（不是 Java 或 Microsoft）中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T11:42:27.273

我已经使用 comodo 证书来签署 XPI。这是当时最便宜的选择。

~~我写了几篇关于[XPI 格式](http://o-regan.org/2007/04/11/firefox-xpi-internal-structure/)的文章和一个使用 java 命令行工具进行[签名的方法。](http://o-regan.org/2007/04/23/extension-signing-with-xpisigner/)~~

~~我的工具[XPISigner](http://o-regan.org/xpisigner-secure-your-firefox-extensions/download-xpisigner/)大大简化了这个过程，并且可以集成到构建系统中。~~

我已删除该工具，因为它不再适用于 FF4 或更高版本。如果有人想修复，可以在[http://code.google.com/p/xpisigner/](http://code.google.com/p/xpisigner/)上找到源代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T21:58:22.337

是的，不幸的是，XPI 签名非常重要。我建议搜索/发布到 mozilla 新闻组（dev-extensions、项目所有者@mozdev、irc.mozilla.org），并尝试与让它工作的人取得联系。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T14:31:53.857

Tucows 以每年 75 美元的价格出售 Comodo 代码签名证书，据我所知，这是最便宜的（[https://author.tucows.com/](https://author.tucows.com/)，“代码签名证书”部分）。这对我来说仍然是太多的钱，所以我没有尝试它是如何工作的。不是我可以尝试，据我所知，您需要成为注册组织才能购买 Comodo 证书。

至于 Ascertia，获得证书很容易（[http://www.ascertia.com/onlineCA/Issuer/CerIssue.aspx](http://www.ascertia.com/onlineCA/Issuer/CerIssue.aspx)） - 但这样的证书与自行颁发的证书一样毫无价值，因为您需要导入他们的证书根证书在看到效果之前。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-12-30T14:58:27.307

如果您有一个开源项目，您可以从 Unizeto 获得免费的代码签名证书。

[此处](https://stackoverflow.com/a/18959881/217357)详细描述了获取证书本身的步骤。

获得证书后，请执行以下操作：

*   从您的浏览器中获取私钥（例如，从您的钥匙串中将其下载为 .p12 - 不要设置密码）并将其转换为 PEM 格式`openssl pkcs12 -in key.p12 -nodes -out private.key -nocerts`
*   打开您从 Unicert 下载的 .pem 文件，在其下方添加您的私钥，并将`Public Key of Certum Level III CA`from [here](https://www.certum.eu/certum/cert,expertise_root_certificates.xml#CLIIICA)添加到私钥下方，如下所示：

    `-----BEGIN CERTIFICATE----- [your certificate from Certum] -----END CERTIFICATE----- -----BEGIN RSA PRIVATE KEY----- [the private key you just converted from the .p12 file from your keychain] -----END RSA PRIVATE KEY----- -----BEGIN CERTIFICATE----- [the Certum Level III CA public key you just downloaded] -----END CERTIFICATE-----`

*   将此文件另存为`cert_with_key_and_ca.pem`
*   安装[xpisign.py](https://github.com/nmaier/xpisign.py) _`pip install https://github.com/nmaier/xpisign.py/zipball/master`
*   跑`xpisign -k cert_with_key_and_ca.pem unsigned.xpi signed.xpi`
*   将其拖放到 Firefox 中，您应该会在扩展名旁边出现*（作者未验证）*`signed.xpi`消息之前看到作者姓名。

 *# model-view-controller - 什么是 MVC（模型视图控制器）？

> ID：129921
> 
> 赞同：27
> 
> 时间：2008-09-24T20:56:06.167
> 
> 标签：model-view-controller, design-patterns, glossary

我最近听说过 MVC（模型视图控制器）这个词被大量的嗡嗡声所折腾，但它到底是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-24T20:58:43.023

您可能想看看 Martin Fowler 在[Martin Fowlers 网站上](http://martinfowler.com/eaaDev/uiArchs.html)对 MVC、MVP 和 UI 架构的一般看法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T21:01:47.133

我喜欢Martin Fowler 的[这篇文章](http://www.martinfowler.com/eaaDev/uiArchs.html)。你会看到 MVC 实际上或多或少已经死了，严格来说，在它原来的富 UI 编程领域。View 和 Controller 之间的区别不适用于大多数现代 UI 工具包。

这个词最近似乎在网络编程界找到了新的生命。我不确定这是否是真正的 MVC，或者只是将名称重新用于一些密切相关但略有不同的想法。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T20:59:02.163

MVC 是一种最初在 smalltalk 早期开创的设计模式。

这个概念是模型将代表您的应用程序状态和逻辑，控制器将处理“视图”之间的 IO。

视图是模型中状态的表示。例如，您的模型可能是一个电子表格文档，并且您可能有一个将其表示为电子表格的视图和一个将其表示为数据透视表的视图。

现代 MVC 已经被虚假的 MVC 网络垃圾污染了，所以我会让其他人回答这个问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-04-17T03:37:45.380

这是对 MVC 的简单描述：http: [//www.devcodenote.com/2015/04/mvc-model-view-controller.html](http://www.devcodenote.com/2015/04/mvc-model-view-controller.html)

一个片段：

Definition : It is a design pattern which separates an application into multiple layers of functionality.

The layers:

Model Represents data. It acts as an interface between the database and the application (as a data object). It will handle validations, associations, transactions etc.

Controller It gathers and processes data. Handles code which does data selection and data messaging.

View Displays output to the users.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T21:02:21.440

正如您问题上的标签所述，它是一种设计模式。但这可能对你没有帮助。基本上它是一种将代码组织成逻辑分组的方法，这些分组保持各个部分分开并且易于修改。

简化：模型=数据结构/业务逻辑视图=输出层（即HTML代码）控制器=消息传输层

因此，当人们谈论 MVC 时，他们所谈论的是将那里的代码划分为这些逻辑组，以保持其干净和结构化，并希望是松散耦合的。通过遵循这种设计模式，您应该能够构建可以将 View 完全更改为其他内容的应用程序，而无需触摸您的控制器或模型（即从 HTML 切换到 RSS）。

那里有大量的教程，只需在谷歌上搜索它，我相信您至少会找到一个用与您一起点击的术语来解释它的教程。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-04-05T12:35:17.897

MVC 设计模式：

4 个部分 = 用户、视图、控制器、模型。

用户： - 看到视图并使用控制器。

模型： - 保存数据并更新有新数据/状态的模型。

查看： - 显示模型拥有的数据。

控制器： - 从用户那里获取或设置信息的请求，然后与视图或模型通信，分别。- 它通过视图“获取”。- 它通过模型“设置”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T20:57:37.800

到目前为止，维基百科似乎描述得最好：

[http://en.wikipedia.org/wiki/Model-view-controller](http://en.wikipedia.org/wiki/Model-view-controller)

模型-视图-控制器 (MVC) 是一种用于软件工程的架构模式。该模式的成功使用将业务逻辑与用户界面考虑隔离开来，从而使应用程序更容易修改应用程序的视觉外观或底层业务规则，而不会影响另一个。在 MVC 中，模型表示应用程序的信息（数据）和用于操作数据的业务规则；视图对应于用户界面的元素，例如文本、复选框项目等；控制器管理涉及与用户操作模型通信的细节，例如击键和鼠标移动

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T21:11:13.603

MVC 或模型-视图-控制器用户界面范式首先由 Xerox PARC 的 Trygve Reenskaug 描述。1981 年 8 月首次出现在 Byte 杂志第 6 卷第 8 期。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T20:58:29.873

这篇关于 Oreilly 的[什么是 MVC](http://web.archive.org/web/20131109224547/http://www.oreillynet.com/onlamp/blog/2007/06/what_is_mvc.html)博客文章已经涵盖了您。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-10-07T12:04:47.213

MVC 是一种将表示与用户交互分开的软件架构模式。通常，模型由应用程序数据和与之交互的函数组成，而视图将这些数据呈现给用户；控制器在两者之​​间进行调解。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-24T21:10:41.887

这是一种将应用程序（模型）的底层功能与其与用户交互的方式（视图）分离的方法。控制器协调模型和视图如何相互通信。

虽然目前风靡一时，但重要的是要记住，阻止模型本身能够准确地确定其数据如何呈现给用户可能被视为消极的事情。最明显的例子是 HTML。HTML 的初衷是通过控制器（浏览器）将模型（HTML）与视图（呈现的网页）明确分离。这种最初的意图遭到了如此强烈的反对，以至于如果浏览器没有将页面像素渲染为设计者想要的完美视图，就会受到批评。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-09-24T21:00:49.150

MVC 是一种将用户界面元素划分为 3 个不同概念的方法。模型是接口操作的数据。视图是元素在视觉上（或者可能是听觉上？）的表示方式。控制器是对数据进行操作的逻辑。

例如，如果您想在 UI 中操作一些文本。一个简单的字符串可以表示数据。视图可以是文本字段。控制器是转换来自用户的输入（例如字符或鼠标输入）并对底层数据模型进行更改的逻辑。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-09-24T21:08:27.930

就像许多人已经说过的那样，MVC 是一种设计模式。我现在正在教我的一位同事，并以这种方式进行了解释：

**模型**- 数据访问层。这可以是直接数据访问、Web 服务等

**视图**- 应用程序的表示层。

**控制器**- 这是您的应用程序的业务逻辑。

这种模式增强了测试驱动的开发。

# .net - 在 .net 网站中生成文本文件的最佳方法是什么？

> ID：129927
> 
> 赞同：3
> 
> 时间：2008-09-24T20:57:15.803
> 
> 标签：.net, vb.net, download, text-files

我的 vb.net Web 应用程序中有一个页面，需要将一堆数据放入文本文件中，然后将其呈现给用户以供下载。在.net web 服务器上构建这样一个文本文件的最佳/最有效的方法是什么？

编辑：回答下面的问题，这将是一次下载然后丢弃的文件。

更新：我将 John Rudy 和 DavidK 的建议结合在一起，效果很好。谢谢大家！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T21:01:48.210

使用 StringBuilder 创建文件的文本，然后使用 Content-Disposition 将其发送给用户。

示例在这里找到： [http ://www.eggheadcafe.com/community/aspnet/17/76432/use-the-contentdispositi.aspx](http://www.eggheadcafe.com/community/aspnet/17/76432/use-the-contentdispositi.aspx)

```
private void Button1_Click(object sender, System.EventArgs e)
{
        StringBuilder output = new StringBuilder;
        //populate output with the string content
        String fileName = "textfile.txt";

        Response.ContentType = "application/octet-stream";
        Response.AddHeader("Content-Disposition", "attachment; filename=" + fileName);
        Response.WriteFile(output.ToString());

} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T21:03:00.017

根本不构建它，使用 HttpHandler 并将文本文件直接提供到输出流中：

[http://digitalcolony.com/labels/HttpHandler.aspx](http://digitalcolony.com/labels/HttpHandler.aspx)

中途的代码块就是一个很好的例子，你可以自己调整：

```
public void ProcessRequest(HttpContext context)
{
   response = context.Response;
   response.ContentType = "text/xml";       
   using (TextWriter textWriter = new StreamWriter(response.OutputStream, System.Text.Encoding.UTF8))
   {
       XmlTextWriter writer = new XmlTextWriter(textWriter);
       writer.Formatting = Formatting.Indented;
       writer.WriteStartDocument();
       writer.WriteStartElement("urlset");
       writer.WriteAttributeString("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance");
       writer.WriteAttributeString("xsi:schemaLocation", "http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd");
       writer.WriteAttributeString("xmlns", "http://www.sitemaps.org/schemas/sitemap/0.9");

       // Add Home Page
       writer.WriteStartElement("url");
       writer.WriteElementString("loc", "http://example.com");
       writer.WriteElementString("changefreq", "daily");
       writer.WriteEndElement(); // url

       // Add code Loop here for page nodes
       /*
       {
           writer.WriteStartElement("url");
           writer.WriteElementString("loc", url);
           writer.WriteElementString("changefreq", "monthly");
           writer.WriteEndElement(); // url
       }
       */
       writer.WriteEndElement(); // urlset
   }                      
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T21:08:38.647

正如被遗忘的分号所提到的，答案将取决于您是否需要重复下载或一次性使用。

无论哪种方式，关键是设置输出的内容类型以确保显示下载窗口。直接文本输出的问题是浏览器会尝试在自己的窗口中显示数据。

设置内容类型的核心方法类似于以下内容，假设 text 是输出字符串，filename 是您希望将文件保存（本地）为的默认名称。

```
HttpResponse response = HttpContext.Current.Response;
response.Clear();
response.ContentType = "application/octet-stream";
response.Charset = "";
response.AddHeader("Content-Disposition", String.Format("attachment; filename=\"{0}\"", filename));
response.Flush();
response.Write(text);
response.End(); 
```

这将提示用户下载。

现在，如果您需要将文件直接保存在您的 Web 服务器上，这将变得更加棘手——但并非如此。在那里，您想使用 System.IO 中的类将文本写入文本文件。确保您写入的路径可由网络服务、IUSR_MachineName 和 ASPNET Windows 用户写入。否则，同样的交易——使用内容类型和标题来确保下载。

除非您需要，否则我建议不要从字面上保存文件——即使那样，直接在服务器上执行此操作的技术也可能不是正确的想法。（例如，如果您需要访问控制来下载所述文件怎么办？现在您必须在您的应用程序根目录之外执行此操作，这可能会也可能不会，具体取决于您的托管环境。）

因此，不知道您是处于一次性模式还是文件必须真正保存模式，也不知道安全隐患（如果您真的需要服务器端保存，您可能需要自己解决），这就是我能给你的最好的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T21:03:32.293

请记住，它不需要成为服务器端的“文件”。是客户端将其转换为文件。

# visual-studio - 可以从 Visual Studio Team Studio 中的编码 WebTest 创建独立的 .EXE

> ID：129932
> 
> 赞同：3
> 
> 时间：2008-09-24T20:58:24.180
> 
> 标签：visual-studio, exe, webtest

我正在运行 VS Team Studio 2008。我创建了一个网络测试，我想用它来监控公司网站。它与站点交互并进行一些往返处理。我想创建一个可以远程运行的独立 EXE 文件。我尝试将其转换为 VB 代码和 C# 代码，然后将其编译为 EXE。但是，在运行它时，不会产生从主机到网络服务器的流量。有没有人成功地尝试过这样做？

我在VB中试过这个。

```
 Option Strict Off
  Option Explicit On

  Imports Microsoft.VisualStudio.TestTools.WebTesting
  Imports Microsoft.VisualStudio.TestTools.WebTesting.Rules
  Imports System
  Imports System.Collections.Generic
  Imports System.Text

  Public Module RunMonitor
    Sub Main()
        Dim S As Monitor.MonitorCoded = New Monitor.MonitorCoded()
        S.Run()
    End Sub
  End Module
  Namespace TheMonitor
    Public Class MonitorCoded
        Inherits ThreadedWebTest
        Public Sub New()
            MyBase.New()
            Me.PreAuthenticate = True
        End Sub

   Public Overrides Sub Run()
    'WebRequest code is here'
     End Sub
    End Class
  End Namespace 
```

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-12T19:30:08.050

Daniel，我在 Microsoft.VisualStudio.TestTools.WebTesting 命名空间中创建了大部分类，我可以向您保证，没有 Visual Studio 或 MSTest.exe 就无法运行编码的 Web 测试。编码的 web 测试基本上将 WebTestRequests 交还给 web 测试引擎，它们不会自己启动 web 测试引擎。

我们并没有试图阻止您描述的用例，但这并不是设计目标。

乔什

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T00:47:50.913

你可以调用 MSTest.exe 吗？如果您的测试是使用 VisualStudio 创建的，它会使用 MSTest 来执行它。

如果您没有使用 VisualStudio 创建 webTest，您能否提供更多细节？

# perl - Perl 中的“0 但为真”是什么意思？

> ID：129945
> 
> 赞同：61
> 
> 时间：2008-09-24T21:00:46.497
> 
> 标签：perl, integer, boolean

有人能解释一下 Perl 中字符串“0 but true”的确切含义吗？据我了解，它在整数比较中等于零，但在用作布尔值时评估为真。它是否正确？这是语言的正常行为，还是在解释器中被视为特殊情况的特殊字符串？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-24T21:06:27.763

这是语言的正常行为。引用手册[`perlsyn`](https://perldoc.perl.org/perlsyn.html#Truth-and-Falsehood)页：

> 在布尔上下文中，数字`0`、字符串`'0'`和`""`、空列表`()`和`undef` 都是假的。所有其他值都为真。取反一个真值`!`或`not`返回一个特殊的假值。当评估为字符串时，它被视为`""`，但作为数字，它被视为`0`。

因此，需要有一种方法可以`0`从期望返回`0`（成功的）返回值的系统调用中返回，并留下一种通过实际返回错误值来指示失败情况的方法。`"0 but true"`服务于这个目的。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2011-03-15T21:16:15.573

因为它在 Perl 核心中被硬编码为将其视为数字。这是使 Perl 的约定和`ioctl`的约定一起发挥作用的 hack；来自`perldoc -f ioctl`：

> `ioctl`(and )的返回值`fcntl`如下：
> 
> ```
> if OS returns:      then Perl returns:
> 
>     -1              undefined value
>      0              string "0 but true"
> anything else       that number 
> ```
> 
> 因此 Perl 在成功时返回 true，在失败时返回 false，但您仍然可以轻松确定操作系统返回的实际值：
> 
> ```
> $retval = ioctl(...) || -1;
> printf "System returned %d\n", $retval; 
> ```
> 
> 特殊字符串`"0 but true"`免于`-w`对不正确的数字转换的投诉。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-09-24T21:13:02.037

除了其他人所说的之外，`"0 but true"`它的特殊情况是它不会在数字上下文中发出警告：

```
$ perl -wle 'print "0 but true" + 3'
3
$ perl -wle 'print "0 but crazy" + 3'
Argument "0 but crazy" isn't numeric in addition (+) at -e line 1.
3 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2011-03-15T21:47:45.570

该值`0 but true`是 Perl 中的一种特殊情况。尽管在你的凡人眼中，它看起来不像一个数字，但明智且众所周知的 Perl 明白它确实是一个数字。

这与当 Perl 子例程返回 0 值时，假定例程失败或返回错误值有关。

想象一下，我有一个返回两个数字之和的子程序：

```
die "You can only add two numbers\n" if (not add(3, -2));
die "You can only add two numbers\n" if (not add("cow", "dog"));
die "You can only add two numbers\n" if (not add(3, -3)); 
```

第一条语句不会死，因为子例程将返回一个`1`. 那挺好的。第二条语句将终止，因为子例程无法将*cow*添加到*dog*。

还有，第三个说法？

嗯，我可以`3`补充`-3`。我刚刚得到`0`，但是即使`add`子例程有效，我的程序也会死掉！

为了解决这个问题，Perl 认为`0 but true`是一个数字。如果我的*add*子例程不仅返回*0*，而且返回*0 而是 true*，我的第三条语句将起作用。

但是*0 but true*是数字零吗？试试这些：

```
my $value = "0 but true";
print qq(Add 1,000,000 to it: ) . (1_000_000 + $value) . "\n";
print "Multiply it by 1,000,000: " . 1_000_000 * $value . "\n"; 
```

是的，它是零！

[index](http://perldoc.perl.org/functions/index.html)子例程是 Perl 的一个非常古老的部分，在 0 概念之前就存在，但*true*就在附近。假设返回位于字符串中的子字符串的位置：

```
index("barfoo", "foo");   #This returns 3
index("barfoo", "bar");   #This returns 0
index("barfoo", "fu");    #This returns ...uh... 
```

最后一条语句返回一个`-1`. 这意味着如果我这样做：

```
if ($position = index($string, $substring)) {
   print "It worked!\n";
}
else {
   print "If failed!\n";
} 
```

正如我通常使用标准函数所做的那样，它不起作用。如果我像在第二个语句中那样使用“barfoo”和“bar”，则该`else`子句将执行，但如果我在第三个语句中使用“barfoo”和“fu”，则该`if`子句将执行。不是我想要的。

但是，如果子例程为第二个语句和第三个语句`index`返回*0 但为 true*`undef` ，则my `if`/`else`子句将起作用。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2008-09-24T21:56:35.910

您可能还会看到 Perl 代码中使用的字符串[“0E0”](http://www.google.com/codesearch?q=0E0)，它的含义相同，其中 0E0 仅表示用指数表示法编写的 0。然而，由于 Perl 只认为 "0"、'' 或 undef 为假，它在布尔上下文中计算为真。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-03-15T21:36:41.823

它在 Perl 的源代码中被硬编码，特别是在[numeric.c 的 Perl_grok_number_flags 中](http://cpansearch.perl.org/src/EHERMAN/perl-5.27.1/numeric.c)。

阅读该代码后，我发现字符串“infinity”（不区分大小写）也通过了looks_like_number 测试。我不知道。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-24T21:04:10.623

在整数上下文中，它的计算结果为 0（字符串开头的数字部分）并且为零。在标量上下文中，它是一个非空值，所以它是真的。

*   `if (int("0 but true")) { print "zero"; }`

    （无输出）

*   `if ("0 but true") { print "true"; }`

    （打印为真）

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-24T21:39:11.287

**在 Perl（和其他与 C 相关的语言）中，**0表示 false。**在大多数情况下，这是一种合理的行为。其他语言（例如 Lua）将**0**视为 true 并提供另一个标记（通常为**nil**或**false**）来表示非 true 值。**

 **Perl 方法不能很好地工作的一种情况是，当您想要返回一个数字，或者如果函数由于某种原因失败，则返回一个 false 值。例如，如果您编写一个从文件中读取一行并返回该行字符数的函数。该函数的常见用法可能类似于：

```
while($c = characters_in_line($file)){
    ...
}; 
```

请注意，如果特定行上的字符数为 0，则**while**循环将在文件末尾之前结束。因此**characters_in_line**函数应该将 0 个字符特例并返回**'0 but true'**代替。这样，该函数将在**while**循环中按预期工作，但如果将其用作数字，也会返回正确答案。

请注意，这不是语言的内置部分。相反，它利用了 Perl 将字符串解释为数字的能力。所以有时会使用其他的刺来代替。 **例如， DBI**使用**"0E0"**。在数字上下文中评估时，它们返回**0**，但在布尔上下文中返回**false**。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-03-15T21:06:30.780

虚假的东西：

*   `""`.
*   `"0"`.
*   那些串起来的东西。

`"0 but true"`不是其中之一，所以它不是假的。

此外，Perl 返回`"0 but true"`期望数字的位置，以表明函数成功，即使它返回零。[sysseek](http://perldoc.perl.org/functions/sysseek.html)就是这种功能的一个例子。由于该值预计将用作数字，因此 Perl 被编码为将其视为数字。因此，当它用作数字时不会发出警告，并`looks_like_number("0 but true")`返回 true。

其他“真零”可以在[http://www.perlmonks.org/?node_id=464548](http://www.perlmonks.org/?node_id=464548)找到。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-25T07:16:07.143

“0 但为真”的另一个例子：

DBI 模块使用“0E0”作为不影响任何记录的 UPDATE 或 DELETE 查询的返回值。它在布尔上下文中计算为 true（表示查询已正确执行），在数字上下文中计算为 0，表示查询没有更改任何记录。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-28T11:24:13.267

我刚刚发现了字符串“0 but true”实际上内置在解释器中的证据，就像这里的一些人已经回答过的那样：

```
$ strings /usr/lib/perl5/5.10.0/linux/CORE/libperl.so | grep -i true
Perl_sv_true
%-p did not return a true value
0 but true
0 but true 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-24T21:05:40.480

当您要编写一个返回整数值、*false*或**undef**的函数时（即对于错误情况），您必须注意值为零。返回它是假的，不应指示错误情况，因此返回“0 但真”使函数返回值为真，同时在对其进行数学运算时仍将值传回零。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-24T21:18:35.300

"0 but true" 和其他字符串一样，但由于 perl 的语法，它可以提供有用的目的，即从函数返回整数零而不结果为 "false"（在 perl 眼中）。

并且字符串不必是“0 但为真”。“0 但假”在布尔意义上仍然是“真”。

考虑：

```
if(x)

for x:        yields:
1             -> true
0             -> false
-1            -> true
"true"        -> true
"false"       -> true
"0 but true"  -> true
int("0 but true") ->false 
```

所有这一切的结果是您可以拥有：

```
sub find_x() 
```

并让此代码能够打印“0”作为其输出：

```
if($x = find_x)
{
   print int($x) . "\n";
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-06-07T16:02:23.900

字符串 ``0 but true'' 仍然是一个特例：

```
for arg in "'0 but true'" "1.0*('0 but true')" \
           "1.0*('0 but false')" 0 1 "''" "0.0" \
           "'false'" "'Ja'" "'Nein'" "'Oui'" \
           "'Non'" "'Yes'" "'No'" ;do
    printf "%-32s: %s\n" "$arg" "$(
        perl -we '
            my $ans=eval $ARGV[0];
            $ans=~s/^(Non?|Nein)$//;
            if ($ans) {
                printf "true:  |%s|\n",$ans
            } else {
                printf "false: |%s|", $ans
          };' "$arg"
        )"
    done 
```

给出以下内容：（注意“警告”！）

```
'0 but true'                    : true:  |0 but true|
1.0*('0 but true')              : false: |0|
Argument "0 but false" isn't numeric in multiplication (*) at (eval 1) line 1.
1.0*('0 but false')             : false: |0|
0                               : false: |0|
1                               : true:  |1|
''                              : false: ||
0.0                             : false: |0|
'false'                         : true:  |false|
'Ja'                            : true:  |Ja|
'Nein'                          : false: ||
'Oui'                           : true:  |Oui|
'Non'                           : false: ||
'Yes'                           : true:  |Yes|
'No'                            : false: || 
```

...并且不要忘记 RTFM！

```
man -P'less +"/0 but [a-z]*"' perlfunc

       ... "fcntl".  Like "ioctl", it maps a 0 return from the system call
           into "0 but true" in Perl.  This string is true in boolean
           context and 0 in numeric context.  It is also exempt from the
           normal -w warnings on improper numeric conversions. ... 
```

# linux - 保持多台 Linux 服务器同步的最佳方式是什么？

> ID：129958
> 
> 赞同：2
> 
> 时间：2008-09-24T21:02:06.527
> 
> 标签：linux, rsync

我在相当广阔的区域内有几个不同的位置，每个位置都有一个存储公司数据的 Linux 服务器。这些数据每天在每个不同的位置以不同的方式变化。我需要一种方法来使这些数据保持最新并在所有这些位置之间同步。

例如：

在一个位置，有人将一组图像放在他们的本地服务器上。在另一个位置，其他人将一组文档放在他们的本地服务器上。第三个位置将少量图像和文档添加到他们的服务器。在另外两个位置，根本没有对其本地服务器进行任何更改。到第二天早上，我需要所有五个地点的服务器来保存所有这些图像和文档。

我的第一直觉是使用 rsync 和 cron 作业在夜间（凌晨 1 点到 6 点左右）进行同步，此时我们所在位置的带宽都没有被使用。在我看来，最好让一台服务器成为“中央”服务器，首先从其他服务器中提取所有文件。然后它将这些更改推送回每个远程服务器？还是有另一种更好的方法来执行此功能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:28:57.027

我这样做的方式（在 Debian/Ubuntu 盒子上）：

*   用于`dpkg --get-selections`获取已安装的软件包
*   用于`dpkg --set-selections`从创建的列表中安装这些包
*   使用源代码控制解决方案来管理配置文件。我以集中方式使用 git，但 subversion 也可以很容易地使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:16:40.623

如果 rsync 对您来说不是最佳解决方案，另一种选择是[Unison](http://www.cis.upenn.edu/~bcpierce/unison/)。Unison 在 Windows 下工作，当双方都发生变化时，它具有一些处理功能（不一定需要选择一台服务器作为主要服务器，正如您所建议的那样）。

根据任务的复杂程度，任何一个都可能有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T21:12:38.777

AFAIK，**rsync 是您的最佳选择**，它支持部分文件更新以及各种其他功能。一旦设置它是非常可靠的。您甚至可以使用带时间戳的日志文件设置 cron，以跟踪每次运行中更新的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T00:10:34.093

您可以（理论上）做的一件事是使用 Python 或其他东西和 inotify 内核功能（`pyinotify`例如，通过包）创建一个脚本。

您可以运行脚本，该脚本注册以接收某些树上的事件。然后，您的脚本可以监视目录，然后随着每个服务器的变化而更新所有其他服务器。

例如，如果有人上传`spreadsheet.doc`到服务器，脚本会立即看到；如果文档在 5 分钟内没有被修改或删除，脚本可以将其复制到其他服务器（例如通过 rsync）

这样的系统理论上可以实现一种从一台机器到另一台机器的有限“文件系统复制”。有点好主意，但您可能必须自己编写代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T21:16:42.637

我不知道这有多实用，但源代码控制系统可能在这里工作。在白天的某个时间点（也许每个小时？），一个 cron 作业运行一次提交，而一夜之间，每台机器运行一次结帐。当需要运行结帐时，您可能会遇到长时间提交未完成的问题，并且基本上可以通过 rsync 完成相同的事情。

我想我在想的是中央服务器会使您的同步操作更容易 - 冲突可以在中央处理一次，然后推送到其他机器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T00:03:46.557

rsync 将是您的最佳选择。但是您需要仔细考虑如何解决不同站点上相同数据更新之间的冲突。如果站点 1 更新了“customers.doc”并且站点 2 对同一文件进行了不同的更新，您将如何解决它？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T00:15:14.627

我必须同意 Matt McMinn 的观点，特别是因为它是公司数据，所以我会使用源代码控制，并且根据变化的速度，更频繁地运行它。

我认为中央票据交换所是个好主意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-22T07:59:04.370

取决于以下 * 需要同步多少台服务器/计算机？** 如果使用 rsync 的服务器太多，就会出现问题 ** 您要么使用线程并同时同步到多个服务器，要么一个接一个地同步到多个服务器。因此，在后一种情况下，您正在查看源机器上的高负载或服务器（集群中）在给定时间点上的不一致数据

*   需要同步的文件夹大小以及更改频率

    *   如果数据很大，那么 rsync 将需要时间。
*   文件数

    *   如果文件数量很大，特别是如果它们是小文件，rsync 将再次花费大量时间

所以一切都取决于场景是否使用 rsync , NFS , 版本控制

*   如果服务器较少且数据量很小，那么每小时运行一次 rysnc 是有意义的。如果数据偶尔发生变化，您还可以将内容打包到 RPM 中

有了所提供的信息，IMO 版本控制将最适合您。

如果两个人上传同名的不同文件，rsync/scp 可能会出现问题。多个位置的 NFS 需要完美架构

为什么不拥有一个/多个存储库，而每个存储库都只是提交到这些存储库。您需要做的就是保持存储库同步。如果数据量很大并且更新频繁，那么您的存储库服务器将需要大量的 RAM 和良好的 I/O 子系统

# java - 如何将 JTS-Geometry 转换为 AWT-Shape？

> ID：129968
> 
> 赞同：4
> 
> 时间：2008-09-24T21:03:32.577
> 
> 标签：java, geometry, awt, shape, jts

是否可以将a `com.vividsolutions.jts.geom.Geometry`（或其子类）转换为实现的类`java.awt.Shape`？我可以使用哪个库或方法来实现该目标？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-06-10T09:29:10.977

还可以查看JTS 库提供的[ShapeWriter 。](http://tsusiatsoftware.net/jts/javadoc/index.html?com/vividsolutions/jts/awt/ShapeWriter.html)我使用以下代码将 jts 几何对象转换为 awt 形状。

```
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Shape;

import javax.swing.JFrame;
import javax.swing.JPanel;

import com.vividsolutions.jts.awt.ShapeWriter;
import com.vividsolutions.jts.geom.Coordinate;
import com.vividsolutions.jts.geom.GeometryFactory;
import com.vividsolutions.jts.geom.LineString;
import com.vividsolutions.jts.geom.Polygon;

public class Paint extends JPanel{
    public void paint(Graphics g) {

        Coordinate[] coords  = new Coordinate[] {new Coordinate(400, 0),  new Coordinate(200, 200),  new Coordinate(400, 400), new Coordinate(600, 200), new Coordinate(400, 0) };
        Polygon polygon = new GeometryFactory().createPolygon(coords);

        LineString ls = new GeometryFactory().createLineString(new Coordinate[] {new Coordinate(20, 20),  new Coordinate(200, 20)});

        ShapeWriter sw = new ShapeWriter();
        Shape polyShape = sw.toShape(polygon);
        Shape linShape = sw.toShape(ls);

        ((Graphics2D) g).draw(polyShape);
        ((Graphics2D) g).draw(linShape);

    }
    public static void main(String[] args) {
        JFrame f = new JFrame();
        f.getContentPane().add(new Paint());
        f.setSize(700, 700);
        f.setVisible(true);
    }
} 
```

编辑：结果看起来像这张图片![awt中jts几何对象的可视化](https://i.stack.imgur.com/YIDD6.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:08:24.047

根据：

[http://lists.jump-project.org/pipermail/jts-devel/2007-May/001954.html](http://lists.jump-project.org/pipermail/jts-devel/2007-May/001954.html)

有一堂课：

```
com.vividsolutions.jump.workbench.ui.renderer.java2D.Java2DConverter 
```

哪个可以做到？

# wpf - 将图像转换为 XAML？

> ID：129972
> 
> 赞同：11
> 
> 时间：2008-09-24T21:04:30.123
> 
> 标签：wpf, silverlight, xaml, expression-blend

有谁知道将简单的 gif 转换为 xaml 的任何方法？EG 一个可以查看图像并根据 gif / jpg / 位图创建椭圆、矩形和路径的工具？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-26T01:47:17.563

[Inkscape](http://inkscape.org)可以跟踪位图，并且可以直接保存到 XAML。而且，它恰好是免费的。我用它来追踪很多位图，它对我来说非常有效。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T21:10:17.833

Illustrator 有一个跟踪工具可以做到这一点

一个更便宜的选择可能是

[http://vectormagic.com](http://vectormagic.com)

它将导出一个您应该能够转换为 xaml 的 svg

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T22:02:13.433

[Vector Magic](http://vectormagic.com)和[ViewerSVG](http://www.wpf-graphics.com/ViewerSvg.aspx)的组合对我来说产生了最好的质量结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-08T21:06:36.973

使用此在线转换器，您可以将图像转换为 SVG 格式。然后下载转换后的文件并在文本文件编辑器中打开它，然后您可以轻松复制路径数据

[image.online-转换](http://image.online-convert.com/convert-to-svg)

# c# - 如何从 C# 调用 Java 代码？

> ID：129989
> 
> 赞同：25
> 
> 时间：2008-09-24T21:07:00.990
> 
> 标签：c#, java

我们开发了一个 Java 应用程序，并希望从 C# 客户端使用这个应用程序。该应用程序依赖于 Spring、Log4j、...

什么是最有效的机制 - 从 Java 代码制作 DLL，... - 来实现这一点？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-24T21:08:16.387

[IKVM！](http://www.ikvm.net/)

真是太棒了。唯一的问题是它确实为项目增加了大约 30MB。log4net 和 Spring .NET 也可用，但如果使用现有代码，请使用 ikvm 路线。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-10-31T18:29:04.327

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程间桥梁。它建立在 JNI 和 PInvoke 之上。无需 C/C++ 代码。我希望它会帮助你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-01-14T05:40:25.123

There are so many options,

1.  sockets

2.  web services

3.  Message bus

4.  Use a/any database! (sorry if sound silly)

Here's a discussion which may be handy: [https://gridwizard.wordpress.com/2015/01/14/java-and-dotnet-interop](https://gridwizard.wordpress.com/2015/01/14/java-and-dotnet-interop)

Really depends on what you're building!

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T21:13:19.463

或者，您可以在两者之间编写一个 webservice/xmlrpc 层。

我似乎记得有一个名为 Grassshopper 的工具可以将你的 .Net 代码编译成 JVM 字节码。

我也听说过有关 IKVM 的好消息

# firefox - Firefox 扩展的初始框架？

> ID：129993
> 
> 赞同：9
> 
> 时间：2008-09-24T21:08:06.107
> 
> 标签：firefox, firefox-addon, scaffolding

我似乎总是很难开始一个新的 Firefox 扩展。谁能推荐一个好的扩展骨架、脚手架或代码生成器？理想情况下，遵循 FF 扩展的所有最佳实践？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T21:10:33.510

这个很好用：[https ://addons.mozilla.org/en-US/developers/tools/builder](https://addons.mozilla.org/en-US/developers/tools/builder)

当然，谷歌搜索“firefox 扩展生成器”是我找到它的地方；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:12:29.543

查找这个 Eclipse 插件：

[SPKet](http://spket.com)

它会照顾骨骼和其他 50 件东西，你会喜欢的。************