# StackOverflow 问答 000479000-000479999

# php - PHP 对象的动态命名

> ID：479005
> 
> 赞同：3
> 
> 时间：2009-01-26T06:54:45.197
> 
> 标签：php

如何为 php 对象动态分配名称？

例如，我如何将一个对象分配给一个 var，它是我用来创建对象的 db 行的 id。

例如

```
$<idnum>= new object(); 
```

其中 idnum 是我的数据库中的 id。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-26T07:03:50.810

您可以使用双美元符号创建一个具有另一个值的名称的变量，例如：

```
$idnum = "myVar";

$$idnum = new object(); // This is equivalent to $myVar = new object(); 
```

但是请确保如果您真的需要这样做，如果您没有足够的照顾或滥用使用此“功能”，您的代码可能会变得非常混乱......

我认为您可以更好地使用数组或哈希表，而不是用动态创建的变量污染全局命名空间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T07:03:30.063

这个小片段对我有用

```
$num=500;
${"id$num"} = 1234;
echo $id500; 
```

基本上只需使用大括号将变量名括起来并在前面加上 $;

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T07:03:49.063

你可以这样做：

```
${"test123"} = "hello";
echo $test123; //will echo "hello"

$foo = "mystring";
${$foo} = "a value";
echo $mystring; //will echo "a value"; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T07:05:02.353

[http://us2.php.net/language.variables.variable](http://us2.php.net/language.variables.variable)

# c# - 来自控制台项目的 WPF 窗口？

> ID：479014
> 
> 赞同：16
> 
> 时间：2009-01-26T07:04:48.000
> 
> 标签：c#, wpf, console

我最近开始了一个 C# 项目（VS 2008）作为一个“控制台”项目，我在其中编写了一些库、测试程序等。现在我想添加几个 WPF 窗口，但看起来控制台项目不会让我这样做。我来自 Java，所以这有点奇怪。如何添加 WPF 表单（我将从“主”类中实例化自己？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-03T14:24:29.483

恐怕接受的答案并不完全正确，只需在您的 mainmethod 之前添加 [STAThread] 属性并引用正确的库（如 System.Windows），您就可以添加 wpf 窗口了。

编辑：@JamesWilkins 在评论中为我提供了这个有用的链接：[http ://code-phix.blogspot.be/2013/11/creating-wpf-project-from-scratch.html](http://code-phix.blogspot.be/2013/11/creating-wpf-project-from-scratch.html)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2015-10-30T17:30:26.623

我有同样的问题，正在寻找类似的答案。我到处都找到了信息，所以我把我找到的东西放在一个地方。我还需要一种隐藏和显示控制台窗口的方法，所以我发现这很有效（对于 VS 2013+）：

1.  创建一个新的控制台项目（请务必选择您需要使用的 .NET 框架版本 - 我需要自己使用 .Net 4.0）。确保有以下参考资料：

    *   演示框架
    *   演示核心
    *   视窗基地
    *   系统.xaml
2.  在解决方案资源管理器中右键单击项目，选择“属性”，然后将项目输出类型更改为 Windows 应用程序。这可以防止控制台窗口在启动时显示（如果需要，请跳过此步骤）。

3.  虽然控制控制台窗口不是添加 WPF 窗口所必需的，但它可能很有用。如果你不需要这个，跳到#4。在控制台的“程序”类中，添加这个以控制窗口：

    ```
    public class Program
    {
      [DllImport("kernel32.dll", SetLastError = true)]
      static extern bool AllocConsole(); // Create console window

      [DllImport("kernel32.dll")]
      static extern IntPtr GetConsoleWindow(); // Get console window handle

      [DllImport("user32.dll")]
      static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

      const int SW_HIDE = 0;
      const int SW_SHOW = 5; 
    ```

    这允许创建、隐藏和显示控制台窗口。我创建了这些方法来做到这一点：

    ```
     static void ShowConsole()
      {
          var handle = GetConsoleWindow();
          if (handle == IntPtr.Zero)
              AllocConsole();
          else
              ShowWindow(handle, SW_SHOW);
      }

      static void HideConsole()
      {
          var handle = GetConsoleWindow();
          if (handle != null)
              ShowWindow(handle, SW_HIDE);
      } 
    ```

    这些大多是不言自明的，但是如果项目处于窗口模式，则`GetConsoleWindow();`返回`null`，所以这里我们测试句柄是否为空（在这种情况下为零），如果是，则需要创建一个控制台窗口（仅一次）。在这之后，`GetConsoleWindow();`总会返回一个句柄来使用。

4.  如另一个答案所述，您*需要*在控制台方法之前添加`[STAThread]`一行。`Main`这是必需的，因为 WPF 需要在[单线程单元](https://msdn.microsoft.com/en-us/library/windows/desktop/ms680112(v=vs.85).aspx)环境中运行。

    ```
     [STAThread]
      static void Main(string[] args)
      {
      } 
    ```

5.  **添加窗口：**为此，只需将用户控件添加到您的项目并将其命名为“MainWindow”（或任何您喜欢的名称）。只需右键单击解决方案资源管理器中的项目节点并选择`Add->User Control...`. 打开后面的 MainWindow.xaml.cs 代码并更改`MainWindow : UserControl`为`MainWindow : Window`. 接下来，打开 MainWindow.xaml 文件并将第一个标记更改`<UserControl`为`<Window`（并确保结束标记也被重命名，如果使用 Visual Studio，这应该是自动的）。关闭所有“MainWindow”编辑器选项卡并重新打开（只是为了确定，可能没有必要）。您应该看到 MainWindow.xaml 现在在设计窗格中显示一个窗口。

6.  **显示 WPF 窗口：**为此，我们需要启动窗口消息循环，这非常简单。首先，我创建了一些属性来存储对象。把这个放在`Program`课堂上的某个地方。

    ```
    public static Application WinApp { get; private set; }
    public static Window MainWindow { get; private set; } 
    ```

    接下来我们必须通过创建一个`System.Windows.Application`对象来创建消息循环，然后将其传递给主窗口。我创建了这个方法来执行这个任务：

    ```
    static void InitializeWindows()
    {
        WinApp = new Application();
        WinApp.Run(MainWindow = new MainWindow()); // note: blocking call
    } 
    ```

    就是这样！要对此进行测试，请在主窗口中放置一些内容并执行以下操作：

    ```
    [STAThread]
    static void Main(string[] args)
    {
        ShowConsole(); // Show the console window (for Win App projects)
        Console.WriteLine("Opening window...");
        InitializeWindows(); // opens the WPF window and waits here
        Console.WriteLine("Exiting main...");
    } 
    ```

希望这有助于节省某人的时间，干杯！;)

提示：在我的情况下，我发现调用`InitializeWindows()`一个新线程很有帮助；但是，这意味着您必须在创建对象的同一线程中创建 UI 对象（以及其他内容）`Application`。为了与新线程通信，我只是使用`Dispatcher`类 ( `WinApp.Dispatcher.BeginInvoke()`) 在 WPF 线程上下文中运行请求。

对于 Windows 8/10：如果您正在调试并且在输出窗口中看不到任何文本，请查看此处：[https ://stackoverflow.com/a/49145317/1236397](https://stackoverflow.com/a/49145317/1236397)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T07:28:05.660

您应该将您的库代码移动到其他一些“类库”项目并从您的控制台项目中使用它。您的 WPF 窗口应该在另一个“WPF 应用程序”项目中，该项目也将引用您的“类库”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T09:04:53.063

感谢 aku 和 Dmitriy，我创建了另一个项目 (WPF)，它将引用我的基于控制台的代码。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-26T07:22:41.380

你确定你需要控制台项目吗？您可以创建“WPF 应用程序”项目并添加对库的引用等。如果尝试从控制台应用程序显示 WPF 窗口，由于控制台和 WPF 应用程序之间的线程模型不同，您将生成异常。

# c# - TabControl 底部的选项卡

> ID：479016
> 
> 赞同：16
> 
> 时间：2009-01-26T07:06:42.990
> 
> 标签：c#, winforms

如何让选项卡控件将选项卡放置在控件的底部而不是顶部

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-26T07:13:55.953

打开属性窗口转到属性**对齐**并将其设置为**底部**

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-04-22T02:21:47.460

6年后的今天

```
<TabControl TabStripPlacement="Bottom"/> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T09:25:31.447

如果您想以编程方式设置制表符对齐，请查看[msdn](http://msdn.microsoft.com/en-us/library/system.windows.forms.tabcontrol.alignment(VS.80).aspx)

```
 // Positions tabs on the bottom of tabControl1
    this.tabControl1.Alignment = System.Windows.Forms.TabAlignment.Bottom; 
```

# gcc - gcc，将一些警告更改为错误

> ID：479017
> 
> 赞同：0
> 
> 时间：2009-01-26T07:07:11.443
> 
> 标签：gcc

我有一个线程，但不幸的是没有一个建议对我[有用 使一个 gcc 警告出错？](https://stackoverflow.com/questions/475407/make-one-gcc-warning-an-error)

在我的makefile中我指定-Werror=uninitialized，没有错误发生。我将其更改为 -Wuninitialized 并且我看到了我的警告， -Wno-uninitialized 使其按预期消失，但为什么 -Werror=uninitialized 不起作用？

在我写的代码中也有人建议

```
#pragma GCC diagnostic error "-Wuninitialized" 
```

那也行不通。为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T08:12:59.563

你应该使用 -Werror

此选项没有参数（它是一个开/关开关）

但删除所有警告是一种很好的做法，因此 -Werror 强制执行这种良好做法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T07:11:11.373

你用的是什么版本的 gcc？该版本是否支持`-Werror=uninitialized`命令行选项？

# winforms - BindingSource.Filter 排除值 - 如何？

> ID：479033
> 
> 赞同：0
> 
> 时间：2009-01-26T07:22:00.290
> 
> 标签：winforms, c#-2.0, bindingsource

我的 BindingSource 绑定到一组对象（不使用 ADO.NET），我想过滤它并排除一些值，但不确定我是否正在使用它，因为我期望的结果集不会回来。我在想这样的事情，但它不起作用：

```
MyBindingSource.Filter = "State = 'NY' AND State = 'MA' AND State = 'CO'"; 
```

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T07:54:23.690

你用过AND。

如果你想让你的过滤器工作，你想要这个：

```
MyBindingSource.Filter = "State = 'NY' OR State = 'MA' OR State = 'CO'"; 
```

布尔值不可能同时处于两种状态。（至少在我工作的逻辑领域......）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T07:36:17.407

我从未在 WPF 世界之外尝试过，但您可以查看 ListCollectionView（用于 IList）/BindingListCollectionView（用于 IBindingList）。它应该引发必要的事件，您可以在没有基础列表的情况下使用过滤器。

# asp.net - ASP.NET Forms auth - 获取用户数据

> ID：479040
> 
> 赞同：2
> 
> 时间：2009-01-26T07:31:28.867
> 
> 标签：asp.net, webforms, forms-authentication

我在一个非常小的 ASP.NET Web 应用程序（Web 窗体）上使用表单身份验证，我想在其中将有关用户的其他信息存储在单独的数据库表中。

然后将其链接回`aspnet_User`表，我正在计算要链接到的最佳列是该`UserId`列。问题是当用户登录时我无法弄清楚如何获取这条数据。甚至可能吗？

另外，我如何获得电子邮件地址？

* * *

在有人指出之前，我知道 ProfileProvider 但存储的详细信息需要每年重新提交（这是体育俱乐部的注册申请）并存储所有以前的数据。所以 ProfileProvider 并不是真的适用（除非我错了，它可以用来将它存储在*历史上*？）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T07:41:59.830

这是获取用户标识的方法

```
MembershipUser myObject = Membership.GetUser();
string UserID = myObject.ProviderUserKey.ToString();
string Email = myObject.Email; 
```

# design-patterns - 有谁知道黑板模式的成功实施？

> ID：479042
> 
> 赞同：21
> 
> 时间：2009-01-26T07:32:56.337
> 
> 标签：design-patterns, blackboard

多年来我一直对[Blackboard 模式](http://en.wikipedia.org/wiki/Blackboard_system)感兴趣（尤其是在我学习 AI 的时候），但是我仍然无法在学术界之外找到一个很好的实现，尽管它似乎对当前的模式非常有用在软件开发的趋势中，我想不出任何围绕该模式构建的大框架。

这里有人知道与此模式相关的成功或失败故事吗？

**注：**其他链接

*   外部链接 1
*   外部链接 2

**编辑：**现在我想知道该模式是否可以用作可混搭生态系统的模式或类似的东西

**编辑：**在调查了更多之后，我发现了一篇有趣的[论文](http://www.hillside.net/plop/2008/papers/PLoP2008_09_Ortega-Arjona+Fernandez.pdf)，它提出像维基百科这样的东西是黑板，但它取决于人类作为代理。这只是让我意识到 StackOverflow 几乎是一个 Blackboard 系统，我们作为代理，分享我们关于板上未确定问题的专业知识......无论如何它是一些值得思考的食物。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-26T07:51:35.147

黑板模式适用于协作应用程序。除此之外，我倾向于认为这真的不是一个好主意。

黑板最终倾向于成为一大袋共享状态，创建各种有趣的访问模式。现代语言和技术都试图尽可能地封装和控制状态管理，而黑板则恰恰相反。

我发现它在算法中使用的时间通常是一个迹象，表明对要解决的问题没有正确的前期理解。所以“为了安全起见”，你为太多的演员提供了太多的状态。

我已经从两个应用程序中删除了这种模式，并用代表*实际*功能和数据需求的良好、可靠的界面取而代之，两次都取得了成功；）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-01-14T07:54:52.470

我的观点是，当你有一组受约束的数据时，黑板模式会很好地工作，几个参与者可以并行处理，并且数据集应该在哪里进行细化和重新细化。它允许演员完全独立地编写，具有非常简单的界面，并且全部异步运行。

我们的系统就是一个很好的候选者。

我们的视觉系统有一些基本数据（图像），我们有许多算法可以从这些数据中产生新的数据。我们经常看到一种算法可以很好地利用其他算法产生的信息，但是我们共享这些信息的方式非常糟糕，因为通过 oo 系统中的消息进行的正常参数会很快使列表变得很大以进行处理。还有一个问题是，我们在过程后期发现的一些信息可以改进早期的猜测，但这样做需要更多的参数流水线。

不幸的是，这样的重构需要比我们目前拥有的更多的资源:(

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-26T09:30:25.180

看看元组空间及其实现。它从未产生过重大影响，但仍然是构建分布式应用程序的一种有趣方法。

*   [Jini](https://river.apache.org)（现在的阿帕奇河）
*   [千兆空间](http://www.gigaspaces.com/)
*   [闪电战项目](http://www.dancres.org/blitz/)（截至 2017-04-06 链接已失效）
*   [TSpaces](http://eagle.almaden.ibm.com/cs/TSpaces/papers/ComputerNetworks.pdf)（原始项目链接已失效，改为报告 PDF）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T09:41:20.820

这在 C4I 系统中很常见，其中许多更新状态的参与者是人，但有些是软件代理。

我还看到了 SCADA 系统中使用的元组空间，但通常不这样称呼，也没有过多强调软件代理方面。（虽然通常有一个简单的规则系统连接到监控空间）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-02-23T13:26:46.737

Blackboard-Pattern 的一个稍微修改版本的示例由 Mojang 在 Minecraft 中实现。

像僵尸一样的实体，绵羊代表黑板。每个 PathfinderGoal 都是一个正在修改实体状态的知识源。

对于羊：如果高草在实体面前。// executeCheck -> 实体消耗草并增加羊毛的生长计数器 // executeAction

它稍作修改，因为实体可以访问所谓的 PathfinderGoalSelector，它是控制器。这个控制器有一个刻度方法（Minecraft 是基于刻度的 20 Ticks/s - 相当于循环方法）。主线程循环遍历每个实体，调用实体的tick方法。实体本身将其委托给 PathfinderGoalSelector。

# python - 有没有一种字符串方法可以在 python 中将首字母缩写词大写？

> ID：479043
> 
> 赞同：1
> 
> 时间：2009-01-26T07:33:44.650
> 
> 标签：python, string, acronym, capitalize

这很好：

```
import string
string.capwords("proper name")

Out: 'Proper Name' 
```

这不太好：

```
string.capwords("I.R.S")

Out: 'I.r.s' 
```

是否没有字符串方法来做 capwords 以适应首字母缩略词？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T08:08:40.417

这可能有效：

```
import re

def _callback(match):
    """ This is a simple callback function for the regular expression which is 
        in charge of doing the actual capitalization. It is designed to only 
        capitalize words which aren't fully uppercased (like acronyms).
    """
    word = match.group(0)
    if word == word.upper():
        return word
    else:
        return word.capitalize()

def capwords(data):
    """ This function converts `data` into a capitalized version of itself. This 
        function accomidates acronyms.
    """
    return re.sub("[\w\'\-\_]+", _callback, data) 
```

这是一个测试：

```
print capwords("This is an IRS test.")    # Produces: "This Is An IRS Test."
print capwords("This is an I.R.S. test.") # Produces: "This Is An I.R.S. Test." 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T07:36:00.857

不，标准库中没有这种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T07:37:13.943

即使有这样的功能，当被要求处理“IRS”时它会做什么？甚至美国国税局都称自己为“国税局”，没有点。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-26T08:38:23.477

我只是使用了一个列表理解： [ ".".join( [ string.capwords(l) for l in entry.split(".") ] ) for entry in original_list ]

# java - 为什么 Java 在终端服务器下无法在 Firefox3 中使用 Verdana 字体？（访问控制异常）

> ID：479049
> 
> 赞同：0
> 
> 时间：2009-01-26T07:39:07.387
> 
> 标签：java, firefox, applet

以下 GUI 代码适用于我们客户使用的 99.99% 的操作系统环境：

```
jStatusDescription = new JTextArea();  
jStatusDescription.setFont(new Font("Verdana", Font.PLAIN, 12));   
jStatusDescription.setText("test"); <-- crashes 
```

但是，现在有 2 个不同的客户同时使用终端服务器和 firefox 3，即使在 ADMIN 登录并启动 firefox 时，上面的代码也会在 Java Plug-in 1.6.0_11 中出现此异常。

> java.security.AccessControlException：访问被拒绝（java.io.FilePermission C:\WINDOWS\Fonts\verdana.TTF 读取）

任何想法如何调查/解决这个问题？

PS：请注意 IE7 对他们来说可以正常工作

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:13:18.447

当在瘦客户端的某些配置上运行时，读取所有当前版本的 Java SE 6 的物理字体时出现问题。我没有尝试过，但我想你可以将字体文件复制到 JRE 的字体目录中（假设这些是在系统/Windows 目录之前检查的）。您也许可以将 TTF 文件的 reda 权限放入`lib/security/java.policy`文件中（不记得它是如何组织的）。希望很快会有 6 更新中的修复（我不知道，也不能承诺任何事情）。

明显的错误[CR 6785424](http://bugs.sun.com/view_bug.do?bug_id=6785424)和[变更集](http://hg.openjdk.java.net/jdk7/2d/jdk/rev/eaeaacda1c56)。

（在此处包括所有适当的免责声明...）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T07:44:24.993

将字体文件复制到适用于我的 JRE 的字体目录中。

环境：Windows 2003 std ed x86 SP2，终端服务开启。

# unit-of-work - 工作单元问题

> ID：479051
> 
> 赞同：2
> 
> 时间：2009-01-26T07:40:06.557
> 
> 标签：unit-of-work

在以下场景中我应该如何使用工作单元模式：

我正在编写一个 winforms 应用程序。我有一个屏幕，用户可以在其中编辑单个订单。在这个屏幕上，用户可以打开另一个表格来选择送货公司。用户还可以在选择之前在此子表单中添加/编辑现有的送货公司。

如何使用工作单元模式来实现这个场景？目前我有一个订单输入屏幕的工作单元。我的第一个想法是在这个工作单元中也包含子表单。问题是，送货公司的更改应该在子表单中保持不变。但是当我持久化对快递公司的更改时，这也会持久化订单中的更改。

我应该为交付公司的任何编辑创建第二个工作单元吗？在这种情况下，如何使该工作单元中的更改在第一个工作单元中可见？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T07:46:52.440

根据您的描述，听起来好像您真的在这里有两个工作单元。第一个是“Order Entry”，第二个是“Edit Delivery Company”。每个工作单元都有某种基础类型的会话或事务。要从子表单与订单条目进行通信，您必须将公司对象从子表单的会话中分离出来，然后将其重新附加到父表单。如何实际实现这取决于您使用的数据访问层，但一种简单的方法是传递公司的 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-03-07T16:51:07.477

> 目前我有一个订单输入屏幕的工作单元。问题是，送货公司的更改应该在子表单中保持不变。
> 
> 如何使用工作单元模式来实现这个场景？

1.  `OrderEditForm`并且`DeliveryCompanyCollectionEditForm`应该共享同`DeliveryCompanyRepository`一个工作单元。

2.  `DeliveryCompanyRepository`应该从数据库中返回公司+在工作单元中添加的公司。

这样，一个新的交付公司对象应该可以在`OrderEditForm`没有持久更改的情况下使用。

> 我应该为交付公司的任何编辑创建第二个工作单元吗？在这种情况下，如何使该工作单元中的更改在第一个工作单元中可见？

并行使用的两个或多个工作单元在数据同步中需要特别注意。当一个工作单元提交时，一些调解器通常会更新所有其他工作单元，如另一个答案中所述。

# wpf - WPF 等效于 Application.AddMessageFilter（Windows 窗体）

> ID：479057
> 
> 赞同：9
> 
> 时间：2009-01-26T07:43:54.553
> 
> 标签：wpf, windows, winapi, interop

我`Application.AddMessageFilter()`在我的`WinForms`应用程序中使用（使用非托管代码时）。

现在我正在切换`WPF`并找不到此功能。

请告知在哪里可以找到或实施。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2018-03-01T09:50:10.527

在 WPF 中，您可以使用`ComponentDispatcher.ThreadFilterMessage`事件。

```
ComponentDispatcher.ThreadFilterMessage += ComponentDispatcher_ThreadFilterMessage;
private void ComponentDispatcher_ThreadFilterMessage(ref MSG msg, ref bool handled)
{
     if (msg.message == 513)//MOUSE_LEFTBUTTON_DOWN
     {
         //todo
     }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-08-18T07:48:33.210

如果要监视窗口消息，可以使用 HwndSource.AddHook 方法。下面的例子展示了如何使用 Hwnd.AddHook 方法。如果要监视应用程序范围的消息，可以尝试使用 ComponentDispatcher 类。

```
private void Button_Click(object sender, RoutedEventArgs e)
{
    Window wnd = new Window();
    wnd.Loaded += delegate
    {
        HwndSource source = (HwndSource)PresentationSource.FromDependencyObject(wnd);
        source.AddHook(WindowProc);
    };
    wnd.Show();
}
private static IntPtr WindowProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
{
} 
```

# javascript - snap.com 快照违反相同来源政策？

> ID：479058
> 
> 赞同：0
> 
> 时间：2009-01-26T07:44:48.700
> 
> 标签：javascript, ajax, cross-domain

我正在尝试编写一些 Javascript 来显示基于对不同域上服务器的 HTTP GET 请求的数据。根据我的阅读，由于 SOP（同源政策），这变得很棘手。

我很好奇 snap.com “快照”（网页预览）是如何工作的。这是一个示例页面： http: [//premshree.livejournal.com/66129.html](http://premshree.livejournal.com/66129.html)

有人可以解释这是怎么可能的吗？要启用 snap.com 的“快照”，您只需在标题中添加一些 Javascrpt。示例网页似乎违反了 SOP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:21:51.207

“快照”JavaScript 托管在 snap.com 上，因此它可以访问 snap.com 的所有内容，即页面预览，因为它实际上遵守同源策略。但是，它不能对 livejournal.com 上的任何页面进行任何调用。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T19:00:04.067

按照 Ian 的回答，您可以使用 JSONP 让 AJAX 跨越 SOP 提出的域障碍。什么是 JSONP？它是我们都知道和喜爱的同一个 JSON 对象，但它被一个函数包裹着：JSON：

```
`{
  prop1: "a",
  prop2: 7
}`
```

`JSONP：`

```
``myfunction(
{
  prop1: "a",
  prop2: 7
});`` 
```

``如您所见，JSON 对象作为参数传递给`myfunction`函数。因此，如果您要使用简单标签链接到托管在不同域上的脚本资源`script`，并且该资源返回 JSONP 数据，那么您可以简单地定义一个`myfunction`接受 JSON 对象的函数，然后对其进行处理。JQuery 使用[getJSON](http://docs.jquery.com/Getjson)方法支持 JSONP Ajax 调用。`script`jQuery 插入一个指向您尝试从中获取数据的 URL 的标记，而不是进行 AJAX 调用。当脚本加载时，你的回调函数就会被执行，瞧！- 你有 JSON 数据！该技术有 3 个先决条件。

1.  您尝试从中请求数据的服务返回 JSON（默认情况下或使用参数请求）。
2.  该服务通过允许您指定用于包装 JSON 数据的回调函数来支持 JSONP。
3.  您足够信任这个外部资源，以允许他们的代码在您的站点上执行。

# memory-management - 使用道场后如何清理？

> ID：479059
> 
> 赞同：3
> 
> 时间：2009-01-26T07:45:32.147
> 
> 标签：memory-management, memory-leaks, garbage-collection, dojo

我使用 dojo 编写了一个应用程序，它在其生命周期内分配了大量数据。有没有办法可以确保完成后所有内存都已释放？

有没有`dojo.data.destroyAllStores()`可以与`<body onunload>`标签一起使用的方法？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-20T14:36:44.003

您正在考虑使用“onunload”，所以我认为您想在用户离开页面时释放内存。

Javascript 对象不会从一个页面共享到另一个页面，离开 HTML 页面可能会导致您的浏览器清除相关的内存（您的浏览器具有 javascript GC）。

**除非您**通过连接 DOM 和 javascript 对象（不会被 DOM 和 JS GC 清除的循环引用）来创建内存泄漏。但这是另一个问题。

[有关DOM/JS 内存泄漏的](http://msdn.microsoft.com/en-us/library/bb250448%28VS.85%29.aspx)更多详细信息。

# .net - WPF 翻译转换

> ID：479070
> 
> 赞同：2
> 
> 时间：2009-01-26T07:52:58.497
> 
> 标签：.net, wpf, 3d, transform

将平移变换应用于 WPF 网格几何 3D 后，如何获得新的边界？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T10:31:51.717

我发现了什么：

Rect3D newRec3D = modelVisual3D.Transform.TransformBounds(modelVisual3D.Geometry.Bounds);

如果您有更好的方法，请发布。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-02T23:09:53.547

由于您只是应用平移，因此您可以将该平移应用到几何体的边界，因此您的解决方案是正确的。这是一个刚性变换，因此网格的每个部分都将保持其与网格的所有其他部分的相对位置。

事实上，旋转、缩放甚至倾斜变换也是如此。如果您使网格变形，您只需重新计算边界。

# visual-studio - 将项目子文件夹中的文件放入输出目录

> ID：479074
> 
> 赞同：2
> 
> 时间：2009-01-26T07:55:31.423
> 
> 标签：visual-studio, projects-and-solutions, directory

我想在 C# 项目中创建一个文件夹来包含一些配置文件。但是，我不希望将这些文件复制到`bin\Release\MyFolder`. 我宁愿让他们`bin\Release`直接复制到。我认为这可能通过拥有一个“虚拟”文件夹（如解决方案文件夹）来实现，但我不知道该怎么做。

有没有办法在 Visual Studio 2008 (C#) 项目中创建虚拟文件夹？或者更好的是，如何指定（文本）文件输出应定向到主输出文件夹？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T08:12:16.680

使用 Post-build 事件复制文件。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-26T08:03:20.393

在解决方案视图（**View|Solution Explorer**）中，右键单击一个项目并选择**Add -> New Filter**。输入过滤器的名称（看起来像项目中的文件夹），然后您可以通过右键单击并选择**Add -> Existing Item**将现有文件添加到过滤器。

# c++ - trim 不是标准 c/c++ 库的一部分吗？

> ID：479080
> 
> 赞同：18
> 
> 时间：2009-01-26T08:03:31.237
> 
> 标签：c++, trim, standard-library

是我还是 c 或 c++ 库中没有标准的修剪函数？有没有任何单一的功能可以作为修剪？如果没有，谁能告诉我为什么 trim 不是标准库的一部分？（我知道修剪正在增强）

我的修剪代码是

```
std::string trim(const std::string &str)
{
    size_t s = str.find_first_not_of(" \n\r\t");
    size_t e = str.find_last_not_of (" \n\r\t");

    if(( string::npos == s) || ( string::npos == e))
        return "";
    else
        return str.substr(s, e-s+1);
} 
```

测试： cout << trim(" \n\r\r\n \r\n 文本在这里\nwith return \n\r\r\n \r\n "); -edit- 我主要想知道为什么它不在标准库中，BobbyShaftoe 的答案很棒。[trim 不是标准 c/c++ 库的一部分吗？](https://stackoverflow.com/questions/479080/trim-is-not-part-of-the-standard-c-c-library#479091)

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-26T08:13:04.120

不，您必须自己编写或使用其他库，如 Boost 等。

在 C++ 中，你可以这样做：

```
#include <string>

const std::string whiteSpaces( " \f\n\r\t\v" );

void trimRight( std::string& str,
      const std::string& trimChars = whiteSpaces )
{
   std::string::size_type pos = str.find_last_not_of( trimChars );
   str.erase( pos + 1 );    
}

void trimLeft( std::string& str,
      const std::string& trimChars = whiteSpaces )
{
   std::string::size_type pos = str.find_first_not_of( trimChars );
   str.erase( 0, pos );
}

void trim( std::string& str, const std::string& trimChars = whiteSpaces )
{
   trimRight( str, trimChars );
   trimLeft( str, trimChars );
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-26T09:41:57.327

trim() 不在标准库中的原因是，当制定最后一个标准时，他们必须在形式化当前行为（不添加任何新内容，只是稳定已经存在的内容）和添加新功能之间取得平衡。一般来说，他们宁愿不添加功能，除非 1) 否则不可能，或 2) 使用第三方库存在重大缺陷。做太多的改变会

*   破坏与现有代码的兼容性（可能已经定义了自己的 trim()
*   为编译器编写者添加更多工作（他们已经有大量工作要做）
*   使语言更复杂的学习和使用。

使用 trim()，没有重大的互操作性问题。只要您的第三方 trim() 实现接受一个字符串并返回一个字符串，我们并不关心它的定义位置。所以在标准库中并不是真的*需要。*它可以很容易地由其他库提供。

相比之下，字符串类或向量之类的东西是标准库必须提供的类，因为如果您使用自定义字符串类，则只有该库中的字符串操作才能工作。使用标准库字符串，第三方库可以针对这个通用字符串定义，每个人都赢了。

[当最后一个标准出来时，Herb Sutter在这里](http://www.gotw.ca/publications/mill01.htm)写了一篇文章很好地描述了这一点

当然，有一个 trim() 函数会很好，但是他们有更大的鱼要炸。他们必须首先标准化所有基础知识。我不认为 C++0x 会添加修剪功能，但它会添加许多其他便利实用程序，这些实用程序在 98 年被认为是“不必要的”或过于专业化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T13:03:54.343

正如其他人所说，委员会正忙于（许多）其他问题。 [Boost](http://www.boost.org)填补了一些空白，例如 string_algo 库的[修剪函数](http://www.boost.org/doc/libs/1_37_0/doc/html/string_algo/usage.html#id3677329)：

```
string testTrim(" \n\r\r\n \r\n text here\nwith return \n\r\r\n \r\n ");
trim(testTrim);
cout << testTrim; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T08:29:55.583

我对 C++ 了解不多，但[请查看此](https://stackoverflow.com/questions/352055/best-algorithm-to-strip-leading-and-trailing-spaces-in-c#412684 "看一下这个")内容以了解如何在 C 中完成此操作。（在我的辩护中：您确实在标题中说**C /C++ :-)**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T09:15:23.213

在过去，使用***scanf()***，一个空格可以匹配任意数量的空白字符。

这就是我们使用***fgets()***后跟***sscanf()***的原因。防止将换行符匹配为该空格的一部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-25T16:20:45.310

我认为主要原因是`' '`空白的定义相当狭窄。例如，我也想`L' '`被`L' '`一个`trim()`函数删除；然而，只有*语言环境*库有这样的洞察力。

相同的理由适用于常用的方法`to_upper`和`to_lower`方法——有些人（尤其是在土耳其）不同意`c &= ~0x20;`通常用于 ASCII 的典型映射。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T09:29:16.310

您可以使用 VC++。CString 类有一个修剪功能。:D

# c# - 我受限于 C# 和 ASP 吗？

> ID：479081
> 
> 赞同：0
> 
> 时间：2009-01-26T08:06:35.850
> 
> 标签：c#, asp.net

目前，我有基本的 C++ 和 PHP 技能。但是，我想切换到 C# 和 ASP（用于 Web 部件）。为什么 ？你会问。因为我有机会很容易地将 C#（包括 OOP-ed）学习到相当高级的水平。而且因为我读到 ASP 与 C# 非常相似，所以我正在考虑学习它。

那么，有很多东西不能用 C# 完成？什么样的东西？对于 ASP，同样的问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T08:15:27.907

C#（以及相关联的 .NET）的限制：

*   不是真正的系统级语言 - 通常不适合编写驱动程序等。（话虽如此，有一些有趣的项目，如[Cosmos](http://www.gocosmos.org/index.en.aspx)。）
*   对 Windows 以外的平台的有限支持。[Mono](http://mono-project.org)做得很好，但它仍然无法与 .NET 本身相提并论（与在多个平台上同时发布的 Java 相比）。
*   作为非托管语言运行的唯一选项是第三方选项 - ngen 将“预 JIT”您的代码，但它仍在 .NET 框架下运行。真正的 C# 被设计为在 VM 中运行，具有垃圾收集功能。
*   有些人不喜欢缺乏确定性破坏，这意味着 C++ RAII 技术不起作用。（相反，您依赖 GC 进行内存管理和`IDisposable`非内存资源的接口。该`using`语句使这更容易，但它不是一个完美的解决方案。）
*   该语言在某种程度上是微软的心血来潮。如果 MS 决定放弃它，我认为它不会有任何进展，并且很快就会失去对新开发的支持。话虽如此，我预计 MS 不会很快放弃它。
*   在 C# 4 出来之前，它对后期绑定的支持并不多。您可以通过反思来做到这一点，但这有点痛苦。即使使用 C# 4，它仍然是一种基本的静态语言，但在真正有用的地方具有动态工作方式。
*   目前对不变性的支持不多。特别是，C# 3 引入了一些新特性（自动属性、集合初始值设定项、对象初始值设定项），这使得编写可变类型变得更加容易——但没有对应的功能可用于不可变类型。C# 4 中的命名参数和可选参数应该在这方面有所帮助，但欢迎提供更多支持。C# 3 使函数式编码变得更容易，但这确实需要不变性。
*   对于桌面应用程序开发，您基本上可以在 WinForms 和 WPF（Windows Presentation Foundation）之间进行选择。后者是更新且设计更好的 IMO，但在这两种情况下，您可能会看到托管应用程序和编写良好的 Win32 应用程序之间的“敏捷性”略有不同。在启动时尤其如此，当框架正在加载并且大量 UI 代码正在被 JIT 等时。我个人认为这不是一个很大的障碍，但是......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T08:24:52.583

除了其他受访者所说的之外，另一个考虑因素是托管 .NET 应用程序通常比托管 PHP 应用程序更昂贵，因为各种 MS 许可证成本。这对您来说可能是也可能不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T08:17:48.680

好吧，您必须区分 ASP（现在称为 Classic ASP）和 ASP.NET（我想您可以将新版本称为 ASP，但这有点令人困惑）。现在。ASP.NET 是一种技术，您可以使用任何 .NET 语言（如 VB.NET 或 C#）编写 Web 应用程序。我不会说您可以在 C# 中做很多其他语言*无法做到的事情。*它是图灵完备的。

我认为学习 C# 是个好主意，因为它是一种非常流行的语言，了解另一种语言不会伤害你。当然，您必须意识到您还将学习独立于 C# 的 .NET Framework。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T15:40:41.673

.Net 在企业市场中不断发展，但 C# 仍然是一种静态的、类型安全的、基于编译的语言。尽管 MS 正在转向动态语言（如 Iron Ruby），但未来公共语言运行时（.Net 的核心）将成为动态语言运行时的类型安全包装器，但目前开发范式完全不同.

既然您提到了 ASP.Net，那么将来您将面临两个选择：ASP.Net Web Forms，它是经典平台，以及 ASP.Net MVC，一个基于模型-视图-控制器的平台，更接近于Ruby On Rails 是结构化的。

# mysql - MySqlDump 备份大数据库有问题吗？

> ID：479085
> 
> 赞同：0
> 
> 时间：2009-01-26T08:09:43.067
> 
> 标签：mysql

可以使用 MySql Dump 备份的 MySQL 数据库的大小是否有任何限制

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T08:21:05.540

我看到的唯一限制是文件系统支持的实际文件大小。

我已经使用 mysqldump 成功备份了几 GB 的数据。或者您说的是数百 GB 甚至 TB？

请记住，mysqldump 生成的转储文件可能比您的实际数据大，具体取决于您拥有多少索引。

# c - 在每个整数输入后刷新 c 输入流

> ID：479099
> 
> 赞同：2
> 
> 时间：2009-01-26T08:19:46.947
> 
> 标签：c

我必须让用户输入数字/百分比对。代码如下：

```
while(choice != 0)
{
  printf("enter number");
  fgets(line, sizeof(line), stdin);//sizeof(line) is 6
  sscanf(line, "%d\n", choice);
  if(choice > 0)
  {
    printf("enter percentage\n");
    fgets(percent_line, sizeof(percent_line), stdin);//sizeof(percent_line) = 7
    sscanf(percent_line, "%f", &percentage);
    //add to an array holding numbers vs percentages
  }
} 
```

这样做的问题是，如果我在第 5 行输入一个长度超过 6（或 5）的字符串，剩余的字符串将进入第 10 行扫描的内容，并且如果我在第 7 行输入更长的字符串（或 6 个字符） 10，剩余的输入进入第 5 行的输入。我想销毁任何剩余的输入。我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T08:41:51.830

这不一定是最好的解决方案，但另一种方法可能是使用`fscanf()`：

```
while(choice != 0)
{
  printf("enter number");
  fscanf(stdin, "%d", &choice);
  if(choice > 0)
  {
    printf("enter percentage\n");
    fscanf(stdin, "%f", &percentage);
    //add to an array holding numbers vs percentages
  }
} 
```

这样，您就不需要临时`line`和`percent_line`缓冲区。该`fscanf()`函数将自动继续读取输入，直到它得到它正在寻找的内容 - 这意味着如果您只是在“输入数字”提示符下按 Enter，该`fscanf()`函数将不会返回并且将继续读取输入，直到您输入一个数字。另外，上面没有实现错误处理，我把它作为练习留给读者来解决当你输入*不是*数字的东西时发生的问题。

（请注意，我也更改`choice`为`&choice`，我认为您首先打算这样做。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T08:48:11.647

您可以检查是否存在- 如果没有，请在循环中使用`\n`直到找到，然后继续以下输入。`line``fgetc()``\n`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T10:54:30.440

我认为后者做得很好。我不介意有人输入“acbgrt”而不是数字，我只是想让程序正常运行。它将简单地将字符串垃圾转换为0，然后退出循环。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-09T07:51:26.077

发生这种情况的原因如下： fgets 最多读取并且**仅**小于第二个参数中指定的值。在您的情况下，您要求它读入一个可以容纳超过 6 个值的数组，因此它将 5 个值读入该数组。剩下的任何东西都会留在缓冲区中以供稍后读取 - 然后您在第 10 行读取。

在丢弃值方面，没有真正的方法可以“刷新”输入缓冲区，或者只是清除其内容。尝试以下操作以清除输入缓冲区：

```
while (getc(stdin) != EOF);
clearerr(stdin); 
```

希望这可以帮助。

# java - 当equals()基于多个独立字段时的hashCode()方法

> ID：479105
> 
> 赞同：11
> 
> 时间：2009-01-26T08:22:29.640
> 
> 标签：java, equals, hashcode

我有一个类，其相等性基于 2 个字段，因此如果其中一个字段相等，则此类型的对象被视为相等。如何为这样的 equals() 编写 hashCode() 函数，以便在 equals 返回 true 时保留 hashCode 的一般合同？

```
public class MyClass {
  int id;
  String name;

  public boolean equals(Object o) {
    if (!(o instanceof MyClass))
      return false;
    MyClass other = (MyClass) o;
    if (other.id == this.id || other.name == this.name)
      return true;
    return false;
  }
} 
```

我如何为这个类编写一个 hashCode() 函数？我想避免像这样返回一个常量的微不足道的情况：

```
public int hashCode() {
  return 1;
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-26T08:33:12.487

我认为不存在重要的哈希码。此外，您`equals()`违反了[API 中所述](http://java.sun.com/javase/6/docs/api/java/lang/Object.html#equals(java.lang.Object))的一般合同——它**不是传递性**的：

`(1,2)`等于`(1,3)`

`(4,3)`等于`(1,3)`

但`(4,3)`不**等于**`(1,2)`。_

* * *

为了完整起见，我向您展示[Skeet](https://stackoverflow.com/questions/479105/hashcode-method-when-equals-is-based-on-multiple-independent-fields#479128) - [Niko](https://stackoverflow.com/questions/479105/hashcode-method-when-equals-is-based-on-multiple-independent-fields#479163)证明 =)

*声明*：**哈希码必须是平凡的常量函数。**

*证明*：设`(a,b)`和`(c,d)`是两个具有不同哈希码的对象，即`h(a,b) ≠ h(c,d)`。考虑对象`(a,d)`。根据 OP 的定义，`(a,d)`等于`(a,b)`，并且`(a,d)`等于`(c,d)`。从[哈希码合约](http://java.sun.com/javase/6/docs/api/java/lang/Object.html#hashCode())可以看出`h(a,d) = h(a,b) = h(c,d)`；一个矛盾。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T08:56:09.570

好的，在您的场景中，暂时忽略 API 要求，没有非常量哈希函数

想象一下有一个哈希函数，它有不同的值

(a,b), (a,c), b!=c, 然后 hash(a,b) != hash(a,c)，尽管 (a,b) = (a,c)。

类似地，(b,a) 和 (c,a) 必须发出相同的 hashCode。

让我们称我们的散列函数为 h。我们发现：

h(x,y) = h(x,w) = h(v,w) 对于所有 x,y,v,w。

因此，唯一能做你想做的事情的 hashFunction 是常量。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-26T08:39:25.360

我很确定 Zach 是对的——没有重要的哈希码可以做到这一点。

伪证明：

考虑任意两个不相等的值，X=(id1, name1) 和 Y=(id2, name2)。

现在考虑 Z=(id2,name1)。这等于 X 和 Y，因此必须具有与 X 和 Y 相同的哈希码。因此 X 和 Y 必须具有相同的哈希码 - 这意味着*所有*值必须具有相同的哈希码。

你陷入一个奇怪的境地是有原因的——你打破了equals的传递性。X.equals(Z) 和 Z.equals(Y)*应该*意味着 X.equals(Y) - 但事实并非如此。您对平等的定义不适合正常的平等合同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T08:39:53.253

我认为你不能。原因是，你的`equals()`方法不是传递的。

传递性意味着对于三个非零 x, y, z, if `x.equals(y)`, `y.equals(z)`, then `x.equals(z)`。在您的示例中，对象,`x={id: 1, name: "ha"}`具有此属性。然而，是。每个方法都应该有这个属性，请参阅 Java API 文档。`y={id: 1, name: "foo"}``z={id: 2, name: "bar"}``(x.equals(y) and y.equals(z))``x.equals(z)``false``equals()`

回到散列函数：每个函数产生一个由 定义的等价`f(x)==f(y)`。这意味着如果您对函数值的比较感兴趣并希望它返回 true if `x==y`（并且可能在其他情况下），您将收到传递关系，这意味着您必须至少考虑对象等价的传递闭包. 在您的情况下，传递闭包是微不足道的关系（一切都等于任何东西）。这意味着您无法通过任何功能区分不同的对象。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T10:26:22.227

您是否有意将平等定义为 id 相等或名称相等时。“OR”不应该是“AND”吗？

如果您的意思是“AND”，那么您的哈希码应该使用与 equals() 相同或更少（但永远不要使用 equals 未使用的字段）字段计算。

如果您的意思是“或”，那么您的 hashgcode 不应在其哈希码计算中包含 id 或 name，这实际上没有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T09:10:59.837

编辑：我没有仔细阅读这个问题。

--

我将使用 commons-lang jar。

XOR 成员 hashCode 应该可以工作。因为他们应该正确实现 hashCode() 和 equals()。

但是，如果您不保护您的 hashCode，您的代码可能会出错。一旦它被散列，它不应该被改变。应该防止它发生。

```
public hashCode(){
   return new AssertionError();
} 
```

或者

```
 public class MyClass {
   final int id;
   final String name;
   // constructor
 } 
```

或者

```
public class MyClass {
   private int id;
   private String name;
   boolean hashed=false;
   public void setId(int value){
     if(hashed)throw new IllegalStateException();
     this.id=value;
   }
   public void setName(String value){
     if(hashed)throw new IllegalStateException();
     this.name=value;
   }
   // your equals() here
   public hashCode(){
     hashed=true;
     return new HashCodeBuilder().append(id).append(name).toHashCode();
   }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T09:18:06.687

重新阅读问题后。

当其中一个被更新时，您可以自动完成另一个字段。

--

编辑：我的代码可能比我的英语更好。

```
void setName(String value){
  this.id=Lookup.IDbyName(value);
}
void setID(String value){
  this.name=Lookup.NamebyId(value);
} 
```

编辑2：

除非您同时设置了 id 和名称，否则问题上的代码可能会出错，因为它将始终返回 true。

如果您真的想要一个执行部分等于的方法，请创建自己的名为“partialEquals()”的 API。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-26T08:24:45.610

最简单的方法是对每个字段的哈希码进行异或。这在某些情况下有轻微的丑陋（例如，在 X,Y 坐标中，当您翻转 X 和 Y 时，它会导致具有相同哈希值的潜在不良情况），但总体上非常有效。如果需要，可以根据需要进行调整以减少碰撞以提高效率。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-26T08:37:33.367

这个怎么样

```
public override int GetHashCode()
{
    return (id.ToString() + name.ToString()).GetHashCode();
} 
```

该函数应始终返回“有效”哈希...

编辑：刚刚注意到你使用“或”而不是“和”：P 我怀疑这个问题有什么好的解决方案......

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-01-26T08:25:23.893

怎么样

```
public override int GetHashCode()
{
    return id.GetHashCode() ^ name.GetHashCode();
} 
```

# java - 表明 Java 能力的问题

> ID：479112
> 
> 赞同：0
> 
> 时间：2009-01-26T08:26:51.517
> 
> 标签：java

作为Java的初学者，我想知道我在哪里学习（正确），我在哪里学习不正确，以及接下来应该学习什么。我发现通过遇到无法立即解决的问题，我学得最好，我需要做一些研究/学习以找出最佳解决方案，然后再解决下一个问题。然后我不时地重复旧问题，直到它们进入我的长期记忆。

Stack Overflow 上的问题在这方面很有用，但是它们没有按难度排序，其中许多是关于某些功能的特定实现的。

请回答这个问题的问题（和合适的答案），这对任何试图提高 Java 知识和经验的人都有用。我确信已经发布的许多 Stack Overflow 问题都是合适的答案，在这种情况下，只需回复问题和原始问题的链接即可。还包括难度级别：低、中、高（可能还包括低中和中高）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T08:35:47.723

购买一本 Effective Java 并从头到尾阅读。

定期阅读。

专注于诸如equals、hashcode、compareto方法之类的东西。

彻底了解 collections api。

我意识到这并不能直接回答您的问题，但是（恕我直言）这是合理的建议！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T08:40:17.637

我不知道您是多少初学者以及您还知道哪些其他语言，但是在我看来，如果您真的不了解 java.util 包，那么您就有麻烦了。所以我的问题是这样的：

1.  LinkedList、ArrayList、Vector 和数组之间的主要区别是什么？
2.  什么时候使用 ArrayList，什么时候使用 Set？
3.  HashMap 和 TreeMap 有什么区别，你什么时候使用它们？

答案：

1.  数组不能增长，基本的构建块也是如此。如果您正在编写自己的数据结构并且您确实需要恒定因子内存或 CPU 性能提升，那么它们可能会很有用。ArrayList 和 Vector 本质上是相同的，只是 Vector 是同步的。使用 ArrayList 几乎总是会更好，如果您想要同步，请在更高的级别上考虑它。ArrayList 就像一个数组，只是它具有能够增长的好处，并且可以将其设为 Generic 以提供额外的类型安全性。LinkedList 是一种专门的数据结构，您不会经常使用，但对队列等很有用。
2.  当您不想要重复元素但排序不重要时，您将使用 Set 。当排序很重要并且想要重复元素时，您将使用 ArrayList。如果您关心排序和重复，那么 LinkedHashSet 是一个选项。
3.  TreeMap 是有序的，但 O(ln n) 访问速度稍慢。HashMap 是无序的，但通常稍微快一些。TreeMap 需要比较或元素是 Comparable。HashMap 可能是您的默认选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T10:08:37.553

看看这个：[JavaBlackBelt](http://www.javablackbelt.com/)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T08:38:13.133

哦，我也喜欢：

想象一下，如果你把它放在一个类中：

```
public int hashCode() {
  return 1;
} 
```

**问题：**

1.  这合法吗？
2.  将这些对象放在 Map 中的效果是什么？那张地图能用吗？
3.  它将如何影响性能？

**答案：**

1.  是的，它不违反 equals/hashCode 合约，该合约规定如果两个对象相等，它们必须返回相同的 hashCode();
2.  地图将起作用；
3.  性能将是 O(n) 并且 Map 将像一个昂贵的 List 一样运行，因为所有内容都将存储在同一个存储桶中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T09:39:02.650

**下面的程序打印什么？**

```
public class ReferencesArePassByValue
{
    public static void doSomething(Integer i)
    {
        i = new Integer(5);
    }

    public static void main(String[] args)
    {
        Integer value = new Integer(42);
        doSomething(value);
        System.out.println(value);      
    }
} 
```

**答案：42。**

**原因：**在 Java 中，引用是按值传递的。

`new Integer(42)`对存储的引用的副本`value`被传递到`doSomething`方法中。在该`doSomething`方法中，存储在其中的引用的副本`i`被丢弃，并将新的对象引用`new Integer(5)`分配给`i`。请注意，这里仅丢弃了参考的*副本。*该方法只接收到引用的副本，因此它不会影响`main`方法中的原始引用。

`value`因此，对方法中的变量没有影响`main`。变量保持对的`value`引用`new Integer(42)`，因此程序的输出是`42`。

在这个话题上似乎有相当多的误解。这**不是**通过引用传递。事实上，Java 中的所有内容，无论是原语还是引用，都是按值而不是按引用传递给方法的。

相关问题和链接：

*   [Java：如何通过引用传递字节 []？](https://stackoverflow.com/questions/333151/java-how-to-pass-byte-by-reference)
*   [Java 是按值传递，该死！](http://javadude.com/articles/passbyvalue.htm)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-26T08:35:35.337

我喜欢：

这会返回什么？

```
private int foo() {
  try {
    return 1;
  } catch (Exception e) {
    return 2;
  } finally {
    return 3;
  }
} 
```

答案：3

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T11:13:48.140

通过：Ethan Nicholas 的博客 [http://weblogs.java.net/blog/enicholas/archive/2006/05/understanding_w.html](http://weblogs.java.net/blog/enicholas/archive/2006/05/understanding_w.html)

前段时间，我正在面试高级 Java 工程师职位的候选人。在我问的许多问题中，“**关于弱引用你能告诉我什么？** ”我没想到会有关于这个主题的详细技术论文。我可能会对“嗯......他们与垃圾收集有关吗？”感到满意。相反，我惊讶地发现，在二十多位工程师中，他们都至少有五年的 Java 经验和良好的资格，其中只有两个人甚至知道弱引用的存在，而这两个人中只有一个人有真正有用的知识关于他们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T10:57:29.717

字符串比较，取自 javabeginner.com：

```
public class StringComparsion {

        public static void main(String[] args) {
            String name1 = "Bob";
            String name2 = new String("Bob");
            String name3 = "Bob";
            // 1st case
            if (name1 == name2) {
                System.out.println("The strings are equal.");
            } else {
                System.out.println("The strings are unequal.");
            }
            // 2nd case
            if (name1 == name3) {
                System.out.println("The strings are equal.");
            } else {
                System.out.println("The strings are unequal.");
            }
        }
    } 
```

**答：** 第一个比较不相等，第二个比较相等（只创建了一个静态字符串“Bob”，name1 和 name3 都指向它）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T11:06:51.320

**您对 Java 中的已检查异常有何看法？有什么优点和缺点？**

我认为能够回答这样的问题表明你不仅仅是一个代码猴子——你也有能力看到更大的图景。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T11:24:04.857

要正确学习编程语言，您需要编写代码。很多代码。

我建议您从 Java 中的 Project Euler ( [http://projecteuler.net/index.php?section=problems](http://projecteuler.net/index.php?section=problems) ) 中尽可能多地解决问题 - 每个困难的问题只需要从[http获得的 Java 知识://java.sun.com/docs/books/tutorial/](http://java.sun.com/docs/books/tutorial/)。

这使您对核心语言有深入的了解。然后你可以开始挖掘你还需要什么——数据库访问（JDBC）、GUI（Swing）、网络东西（servlets/jsp）或者你有什么，加上所有“嘿，这很奇怪”的东西。

玩得开心 - 总是有更多的东西要学:)

# .net - 如何判断文件是否已通过 .NET 更改？

> ID：479114
> 
> 赞同：1
> 
> 时间：2009-01-26T08:29:06.613
> 
> 标签：.net, file, io

我正在寻找一种通过.NET 确定特定文件何时发生更改的方法。（我最终想要的是在文件发生更改后立即复制文件的功能。）如何做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T08:30:16.660

您可以使用 FileSystemWatcher 对象。这会引发指定监视文件夹中文件更改的事件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T09:13:15.823

```
class Program
    {
        static void Main(string[] args)
        {
            FileSystemWatcher fsw = new FileSystemWatcher(@"c:\temp");
            fsw.Changed += new FileSystemEventHandler(fsw_Changed);
            fsw.Deleted += new FileSystemEventHandler(fsw_Deleted);
            fsw.Renamed += new RenamedEventHandler(fsw_Renamed);
            fsw.Created += new FileSystemEventHandler(fsw_Created);
            fsw.EnableRaisingEvents = true;
            Console.ReadLine();
        }

        static void fsw_Created(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("{0} was created", e.FullPath);
        }

        static void fsw_Renamed(object sender, RenamedEventArgs e)
        {
            Console.WriteLine("{0} was Renamed", e.FullPath);
        }

        static void fsw_Deleted(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("{0} was Deleted", e.FullPath);
        }

        static void fsw_Changed(object sender, FileSystemEventArgs e)
        {
            Console.WriteLine("{0} was Changed", e.FullPath);
        }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T08:36:41.780

Microsoft Windows 及其最终祖先 MS-DOS 在其文件上始终具有一个属性，该属性指示自上次清除该属性以来该文件是否已更改，有点像“脏标志”。过去，备份程序使用它来查找需要增量备份的文件，然后在制作该文件的副本时将其清除。

您可以使用 File.GetAttributes 获取文件的属性，并使用 File.SetAttributes 清除该“存档”属性。下次打开该文件进行写入时，将再次设置该存档标志。

复制已更改的文件时要小心，因为这些文件可能仍处于打开状态。您可能希望通过在复制时以独占方式打开它们进行读取来避免并发问题，如果失败，您知道该文件仍然可以写入。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T09:35:59.490

对于所有回复，使用 FileSystemWatcher，您如何处理您的应用程序未运行的时间？例如，用户重启了盒子，修改了你感兴趣的文件，然后启动了你的应用程序？

请务必仔细阅读有关[FileSystemWatcher 类](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)的文档，特别是有关事件和缓冲区大小的部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-13T22:00:04.047

您可能会遇到 FileSystemWatcher 的问题（没有获取事件、太多事件等）。此代码将其包装起来并解决了其中的许多问题：http: [//precisionsoftware.blogspot.com/2009/05/filesystemwatcher-done -right.html](http://precisionsoftware.blogspot.com/2009/05/filesystemwatcher-done-right.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-15T10:21:28.443

您必须记下要检查的文件的修改日期。一段时间后，您可以检查文件是否稍后被修改。如果文件被修改为不同的日期和时间，您可以制作副本。

# php - 计算已过去一天的百分比

> ID：479125
> 
> 赞同：7
> 
> 时间：2009-01-26T08:38:18.217
> 
> 标签：php, datetime, date, time

有点奇怪的问题，但希望有人可以提供帮助。

本质上，如果时间是下午 12 点，则经过的百分比是 50%，早上 6 点是 25%，下午 16 点是 75%。

给定当前时间，您如何计算已经过去的天数？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T08:45:07.767

假设您可以获得一天中的当前时间，那么计算一天中经过的百分比将非常容易。

```
percentage = (hours / 24 + minutes / (60 * 24)) * 100 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T08:42:20.097

24 小时是 100% 所以 24/currentTime = 结果 100 / 结果 = % ;)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T08:48:58.900

gettimeofday(true) 返回自午夜以来经过的秒数作为浮点数（我认为），所以你想要：`gettimeofday(true)/(60*60*24)`. 乘以 100 得到百分比。

**编辑：**实际上， gettimeofday 返回自纪元开始以来经过的秒数，因此您需要减去午夜：

```
$midnight = strtotime('00:00');
$epochseconds = gettimeofday(true);
$timeofdayseconds = $epochseconds - $midnight;
$timepercent = $timeofdayseconds/(60*60*24)*100; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-05-27T16:24:34.597

由于许多原因，包括与现实生活日历的关系，接受的答案让我感到困扰。就个人而言，我可能会这样做：

```
<?php
$start = strtotime("today");
$end = strtotime("tomorrow");
$now = time();
$secondstoday = $end - $start;
$secondselapsed = $now - $start;
$percentage = ($secondselapsed / $secondstoday ) * 100;

printf('%.2f%% of the day has passed (%d out of %d seconds)', $percentage, $secondselapsed, $secondstoday); 
```

结果：

```
72.22% of the day has passed (62402 out of 86400 seconds) 
```

`"today"`然后，您可以通过创建一个函数并将范围更改为其他内容来进一步扩展它`"tomorrow"`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T08:43:54.183

我不知道 php，但有什么方法可以获取当前日期女巫我猜：P 你能从中提取小时数或分钟数，你希望它有多精确？，当前小时数/24 * 100：P 当前分钟数/ 1440 * 100

# winforms - Model-View-Presenter 模式中的缓慢操作

> ID：479135
> 
> 赞同：3
> 
> 时间：2009-01-26T08:42:21.160
> 
> 标签：winforms, model-view-controller, user-interface, swt, mvp

您如何处理 Model-View-Presenter（或 MVC 或 MV-VM 或您正在使用的任何变体）中的缓慢操作？

当您在 WinForms 或 SWT/JFace 或您正在使用的任何桌面框架中操作缓慢时，您必须在后台线程上运行它以避免完全锁定应用程序。你在哪里处理这个？

我可以看到几个解决方案，但我对其中任何一个都不完全满意：

1.  让视图调用始终在后台线程上调用演示者。这意味着视图必须处理来自演示者的所有调用可能来自后台线程。

2.  让视图在主线程上调用演示者。演示者在执行慢速操作时必须回调视图，以便它可以在后台运行。

你平常都做什么？

**编辑：**我刚刚看到这篇文章： http: [//www.codeproject.com/KB/threads/ThreadedExecuter.aspx](http://www.codeproject.com/KB/threads/ThreadedExecuter.aspx)。它基本上是2的实现。有没有人尝试过这样的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-10-15T05:27:41.310

您可以使用服务器端到客户端框架（如 GWT）中使用的相同异步回调方法，只需编写一个服务女巫来实现您的操作，而不是在标准方法返回中返回您的结果，而是使用回调接口作为方法的参数

例子 ：

```
class ServiceX {
     void doFoo(x arg , y arg2 , callback arg3){
          //do in your thread 
          arg3.success("with return variables you need")

          // or
          arg3.failed("with exception for example");

     }

}

interface Callback {
     void success(args...);
     void failed(args ...);
}

in your view :

// do 
ServiceX bar = // get your service

bar.doFoo(a1,a2,new CallBack(){
    void succes(args ...){
    }

    void failed(args ...){
    }
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T17:02:23.600

视图可以从主线程调用演示者。演示者然后在工作线程中启动操作。并且视图（例如使用计时器）从主线程轮询演示者，以防止回调到视图中。问候，坦伯格

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-10T17:17:45.123

我对 tamberg 使用了一种非常相似的方法（即使用工作线程进行处理）。

主要区别在于与视图和表示模型的交互，它包含视图直接绑定到的额外状态，用于以下行为：

*   输入禁用
*   进度更新（使用 BackgroundWorker 相当简单）
*   完成通知

通过将额外的状态放在演示模型而不是视图中，我可以交换视图（或者更常见的情况是，有两个视图指向同一个演示者）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-16T14:09:48.070

我已经使用[aop](/questions/tagged/aop "显示标记为“aop”的问题")来处理这个问题。所有对视图方法的调用都会被拦截并同步到 UI 线程。`IView`我们配置了我们的 AOP 框架（spring.net）来为从我们的基本接口继承的所有接口执行此操作。在演示者上，我们使用属性来指示这个运行缓慢的操作应该在后台运行。Presenter 方法看起来像这样：

```
// ...
[RunInBackground]
public void TakeSomeTimeToRetrieveSomeItems
{
  var items = _svc.GetSomeItemsFromTheWeb();
  _view.ShowItems(items); // synced to UI automatically; blocks in presenter
} 
```

在视图中，我们不需要做任何特别的事情：

```
// ...
public void ShowItems(IList<Item> items)
{
  itemBindingSource.DataSource = items;
} 
```

如果您不熟悉 AOP，使用 AOP 并非易事，但在这种特殊情况下，它为我们节省了 UI 中的大量基础架构代码，现在我们几乎可以零努力地开发响应式 UI。

# oop - 何时使用接口而不是抽象类，反之亦然？

> ID：479142
> 
> 赞同：488
> 
> 时间：2009-01-26T08:47:38.607
> 
> 标签：oop, inheritance, interface, abstract-class

这可能是一个通用的 OOP 问题。我想根据它们的用法在接口和抽象类之间进行通用比较。

***什么时候需要使用接口，什么时候需要使用抽象类***？

* * *

## 回答 #1

> 赞同：492
> 
> 时间：2009-01-26T09:01:27.080

我为此写了一篇文章：

[抽象类和接口](http://www.devfields.com/abstract-classes-and-interfaces/ "抽象类和接口")

总结：

当我们谈论抽象类时，我们是在定义对象类型的特征；指定***对象是什么***。

当我们谈论一个接口并定义我们承诺提供的功能时，我们谈论的是建立一个关于***对象可以做什么的契约。***

* * *

## 回答 #2

> 赞同：480
> 
> 时间：2009-01-26T08:52:47.923

抽象类可以具有共享状态或功能。接口只是提供状态或功能的承诺。一个好的抽象类将减少必须重写的代码量，因为它的功能或状态可以共享。接口没有定义要共享的信息

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2009-01-26T10:12:37.060

就个人而言，我几乎从不需要编写抽象类。

大多数时候我看到抽象类被（误用），这是因为抽象类的作者正在使用“模板方法”模式。

“模板方法”的问题在于它几乎总是在某种程度上是可重入的——“派生”类不仅知道它正在实现的基类的“抽象”方法，还知道基类的公共方法，即使大多数时候它不需要调用它们。

（过度简化）示例：

```
abstract class QuickSorter
{
    public void Sort(object[] items)
    {
        // implementation code that somewhere along the way calls:
        bool less = compare(x,y);
        // ... more implementation code
    }
    abstract bool compare(object lhs, object rhs);
} 
```

所以在这里，这个类的作者编写了一个通用算法，并打算让人们通过提供他们自己的“钩子”来“专门化”它——在这种情况下，是一个“比较”方法。

所以预期的用法是这样的：

```
class NameSorter : QuickSorter
{
    public bool compare(object lhs, object rhs)
    {
        // etc.
    }
} 
```

问题在于您将两个概念过度耦合在一起：

1.  比较两个项目的一种方式（应该先去哪个项目）
2.  一种排序项目的方法（即快速排序与合并排序等）

在上面的代码中，理论上，“比较”方法的作者可以*重新*调用超类“排序”方法......即使在实践中他们永远不想或不需要这样做。

您为这种不必要的耦合付出的代价是很难更改超类，而且在大多数 OO 语言中，无法在运行时更改它。

另一种方法是改用“策略”设计模式：

```
interface IComparator
{
    bool compare(object lhs, object rhs);
}

class QuickSorter
{
    private readonly IComparator comparator;
    public QuickSorter(IComparator comparator)
    {
        this.comparator = comparator;
    }

    public void Sort(object[] items)
    {
        // usual code but call comparator.Compare();
    }
}

class NameComparator : IComparator
{
    bool compare(object lhs, object rhs)
    {
        // same code as before;
    }
} 
```

所以现在请注意：我们所拥有的只是接口，以及这些接口的具体实现。实际上，您真的不需要任何其他东西来进行高级 OO 设计。

为了“隐藏”我们已经通过使用“QuickSort”类和“NameComparator”实现“名称排序”的事实，我们可能仍然在某处编写工厂方法：

```
ISorter CreateNameSorter()
{
    return new QuickSorter(new NameComparator());
} 
```

*只要*你有一个抽象类，你就可以这样做......即使在基类和派生类之间存在自然的可重入关系时，通常将它们显式化也是值得的。

最后一个想法：我们上面所做的只是通过使用“QuickSort”函数和“NameComparison”函数“组合”一个“NameSorting”函数......在函数式编程语言中，这种编程风格变得更加自然，用更少的代码。

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2015-11-27T19:04:48.497

如果您将 java 视为 OOP 语言，

“***接口不提供方法实现***”在 Java 8 启动时不再有效。现在java在接口中为默认方法提供了实现。

简单来说，我想使用

***接口：***通过多个不相关的对象来实现一个契约。它提供了“ **HAS A** ”能力。

***抽象类：***在多个相关对象之间实现相同或不同的行为。它建立了“ **IS A** ”关系。

Oracle[网站](https://docs.oracle.com/javase/tutorial/java/IandI/abstract.html)`interface`提供了与`abstract`类之间的关键区别。

*在以下情况下考虑使用抽象类*：

1.  您希望在几个密切相关的类之间共享代码。
2.  您希望扩展抽象类的类具有许多公共方法或字段，或者需要公共以外的访问修饰符（例如受保护和私有）。
3.  您要声明非静态或非最终字段。

*在以下情况下考虑使用接口*：

1.  您希望不相关的类会实现您的接口。例如，许多不相关的对象可以实现`Serializable`接口。
2.  您想指定特定数据类型的行为，但不关心谁实现了它的行为。
3.  您想利用类型的多重继承。

例子：

抽象类（**IS A**关系）

[Reader](https://docs.oracle.com/javase/8/docs/api/java/io/Reader.html)是一个抽象类。

[BufferedReader](https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html)是一个`Reader`

[FileReader](https://docs.oracle.com/javase/8/docs/api/java/io/FileReader.html)是一个`Reader`

`FileReader`并`BufferedReader`用于共同目的：读取数据，它们通过`Reader`类关联。

接口（**有**能力）

[可序列化](https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html)是一个接口。

假设您的应用程序中有两个类，它们正在实现`Serializable`接口

`Employee implements Serializable`

`Game implements Serializable`

在这里，您无法通过 和 之间的接口建立任何关系，`Serializable`这意味着不同的目的。两者都能够序列化状态并且比较到此结束。`Employee``Game`

看看这些帖子：

[我应该如何解释接口和抽象类之间的区别？](https://stackoverflow.com/questions/18777989/how-should-i-have-explained-the-difference-between-an-interface-and-an-abstract/34978606#34978606)

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2010-12-07T18:11:17.563

我的两分钱：

接口基本上定义了一个契约，任何实现类都必须遵守（实现接口成员）。它不包含任何代码。

另一方面，抽象类可以包含代码，并且可能存在一些标记为抽象的方法，继承类必须实现这些方法。

我使用抽象类的罕见情况是，当我有一些默认功能时，继承类可能不会对覆盖某些特殊类的抽象基类感兴趣。

示例（一个非常基本的示例！）：考虑一个名为 Customer 的基类，它具有抽象方法，如，`CalculatePayment()`以及`CalculateRewardPoints()`一些非抽象方法`GetName()`，如`SavePaymentDetails()`

专门的类喜欢`RegularCustomer` and`GoldCustomer`将从`Customer`基类继承并实现自己的`CalculatePayment()`and`CalculateRewardPoints()`方法逻辑，但重用`GetName()`and`SavePaymentDetails()`方法。

您可以向抽象类（即非抽象方法）添加更多功能，而不会影响使用旧版本的子类。而向接口添加方法会影响所有实现它的类，因为它们现在需要实现新添加的接口成员。

具有所有抽象成员的抽象类类似于接口。

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2009-07-12T11:49:24.917

好的，我自己刚刚“摸索”了这个 - 这是外行的术语（如果我错了，请随时纠正我） - 我知道这个话题太老了，但有一天其他人可能会偶然发现它......

抽象类允许您创建蓝图，并允许您另外构建（实现）您希望其所有后代拥有的属性和方法。

另一方面，接口只允许您声明您希望具有给定名称的属性和/或方法存在于实现它的所有类中 - 但不指定您应该如何实现它。此外，一个类可以实现许多接口，但只能扩展一个抽象类。接口更像是一种高级架构工具（如果您开始掌握设计模式，它会变得更加清晰） - 抽象在两个阵营中都有立足点，并且也可以执行一些肮脏的工作。

为什么要使用一个而不是另一个？前者允许对后代进行更*具体*的定义，后者允许更大的*多态性*。最后一点对最终用户/编码人员很重要，他们可以利用这些信息以各种组合/形状实现 API **（接口）**以满足他们的需求。

我认为这对我来说是“灯泡”时刻 - 少从作者的角度考虑接口，而更多地从链中稍后向项目添加实现或*扩展*API 的任何编码人员的角度考虑接口。

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2009-01-26T10:41:12.790

什么时候做一件非常简单的事情，如果你心里清楚这个概念。

抽象类可以派生，而接口可以实现。两者之间有一些区别。当您派生一个抽象类时，派生类和基类之间的关系是“是”关系。例如，Dog 是 Animal，Sheep 是 Animal，这意味着 Derived 类从基类继承了一些属性。

而对于接口的实现，关系是“可以”。例如，狗可以是间谍狗。狗可以是马戏团的狗。狗可以是赛狗。这意味着您实施某些方法来获取某些东西。

我希望我很清楚。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2013-03-28T16:13:14.383

1.如果您正在创建为不相关的类提供通用功能的东西，请使用接口。

2.如果您要为层次结构中密切相关的对象创建一些东西，请使用抽象类。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2018-10-16T00:19:53.297

**何时更喜欢抽象类而不是接口？**

1.  如果计划在程序/项目的整个生命周期中更新基类，最好允许基类是抽象类
2.  如果尝试为层次结构中密切相关的对象构建主干，则使用抽象类非常有益

**何时更喜欢接口而不是抽象类？**

1.  如果不处理大量分层类型的框架，接口将是一个不错的选择
2.  因为抽象类不支持多重继承（钻石问题），接口可以节省一天

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-02-12T19:19:33.280

我写了一篇关于何时使用抽象类以及何时使用接口的文章。除了“一个 IS-A ... 和一个 CAN-DO ...”之外，它们之间还有很多区别。对我来说，这些都是固定答案。我提到了一些何时使用它们中的任何一个的原因。希望能帮助到你。

[http://codeofdoom.com/wordpress/2009/02/12/learn-this-when-to-use-an-abstract-class-and-an-interface/](http://codeofdoom.com/wordpress/2009/02/12/learn-this-when-to-use-an-abstract-class-and-an-interface/)

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-12-13T08:36:08.410

类只能从一个基类继承，因此如果您想使用抽象类为一组类提供多态性，它们必须都继承自该类。抽象类也可以提供已经实现的成员。因此，您可以确保与抽象类具有一定数量的相同功能，但不能与接口相同。

这里有一些建议可以帮助您决定是使用接口还是抽象类来为组件提供多态性。

*   如果您预期创建组件的多个版本，请创建一个抽象类。抽象类提供了一种简单易行的方式来对组件进行版本控制。通过更新基类，所有继承类都会随着更改而自动更新。另一方面，接口一旦以这种方式创建就无法更改。如果需要新版本的接口，则必须创建一个全新的接口。
*   如果您正在创建的功能对各种不同的对象都很有用，请使用接口。抽象类应该主要用于密切相关的对象，而接口最适合为不相关的类提供通用功能。
*   如果您正在设计小而简洁的功能，请使用接口。如果您正在设计大型功能单元，请使用抽象类。
*   如果您想在组件的所有实现中提供通用的、已实现的功能，请使用抽象类。抽象类允许您部分实现您的类，而接口不包含任何成员的实现。

复制自：http:
[//msdn.microsoft.com/en-us/library/scsyfw1d%28v=vs.71%29.aspx](http://msdn.microsoft.com/en-us/library/scsyfw1d%28v=vs.71%29.aspx)

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2017-06-13T22:58:12.060

我认为最简洁的表达方式如下：

共享属性 => 抽象类。
共享功能 => 界面。

并且说得不那么简洁......

**抽象类示例：**

```
public abstract class BaseAnimal
{
    public int NumberOfLegs { get; set; }

    protected BaseAnimal(int numberOfLegs)
    {
        NumberOfLegs = numberOfLegs;
    }
}

public class Dog : BaseAnimal
{
    public Dog() : base(4) { }
}

public class Human : BaseAnimal 
{
    public Human() : base(2) { }
} 
```

因为动物有一个共享属性——在这种情况下是腿的数量——所以创建一个包含这个共享属性的抽象类是有意义的。这也允许我们编写对该属性进行操作的通用代码。例如：

```
public static int CountAllLegs(List<BaseAnimal> animals)
{
    int legCount = 0;
    foreach (BaseAnimal animal in animals)
    {
        legCount += animal.NumberOfLegs;
    }
    return legCount;
} 
```

**接口示例：**

```
public interface IMakeSound
{
    void MakeSound();
}

public class Car : IMakeSound
{
    public void MakeSound() => Console.WriteLine("Vroom!");
}

public class Vuvuzela : IMakeSound
{
    public void MakeSound() => Console.WriteLine("VZZZZZZZZZZZZZ!");        
} 
```

请注意，Vuvuzelas 和 Cars 是完全不同的东西，但它们有共同的功能：发出声音。因此，接口在这里是有意义的。此外，它将允许程序员在一个通用接口下将发出声音的东西组合在一起——`IMakeSound`在这种情况下。使用这种设计，您可以编写以下代码：

```
List<IMakeSound> soundMakers = new List<ImakeSound>();
soundMakers.Add(new Car());
soundMakers.Add(new Vuvuzela());
soundMakers.Add(new Car());
soundMakers.Add(new Vuvuzela());
soundMakers.Add(new Vuvuzela());

foreach (IMakeSound soundMaker in soundMakers)
{
    soundMaker.MakeSound();
} 
```

你能说出那会输出什么吗？

最后，您可以将两者结合起来。

**组合示例：**

```
public interface IMakeSound
{
    void MakeSound();
}

public abstract class BaseAnimal : IMakeSound
{
    public int NumberOfLegs { get; set; }

    protected BaseAnimal(int numberOfLegs)
    {
        NumberOfLegs = numberOfLegs;
    }

    public abstract void MakeSound();
}

public class Cat : BaseAnimal
{
    public Cat() : base(4) { }

    public override void MakeSound() => Console.WriteLine("Meow!");
}

public class Human : BaseAnimal 
{
    public Human() : base(2) { }

    public override void MakeSound() => Console.WriteLine("Hello, world!");
} 
```

在这里，我们要求所有`BaseAnimal`的 s 发出声音，但我们还不知道它的实现。在这种情况下，我们可以抽象接口实现并将其实现委托给它的子类。

最后一点，还记得在抽象类示例中我们如何能够对不同对象的共享属性进行操作，而在接口示例中我们如何能够调用不同对象的共享功能？在最后一个例子中，我们可以两者都做。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-04-21T07:11:02.040

如果这些陈述中的任何一个适用于您的情况，请考虑使用**抽象类：**

1.  您希望在几个密切相关的类之间共享代码。
2.  您希望扩展抽象类的类具有许多公共方法或字段，或者需要公共以外的访问修饰符（例如受保护和私有）。
3.  您要声明非静态或非最终字段。这使您能够定义可以访问和修改它们所属对象的状态的方法。

* * *

如果这些陈述中的任何一个适用于您的情况，请考虑使用**接口：**

1.  您希望不相关的类会实现您的接口。例如，接口 Comparable 和 Cloneable 由许多不相关的类实现。
2.  您想指定特定数据类型的行为，但不关心谁实现了它的行为。
3.  您想利用多重继承。

[来源](https://dzone.com/articles/when-to-use-abstract-class-and-intreface)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-26T08:48:46.293

如果您想提供一些基本实现，请使用抽象类。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-26T08:55:12.333

答案因语言而异。例如，在 Java 中，一个类可以实现（继承）多个接口，但只能从一个抽象类继承。所以接口给你更多的灵活性。但这在 C++ 中是不正确的。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-06-03T02:41:43.737

对我来说，在很多情况下我会使用接口。但在某些情况下，我更喜欢抽象类。

OO 中的类通常是指实现。当我想将一些实现细节强加给孩子时，我会使用抽象类，否则我会使用接口。

当然，抽象类不仅在强制实现方面有用，而且在许多相关类之间共享某些特定细节方面也很有用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-26T08:52:18.737

在java中，您可以从一个（抽象）类继承以“提供”功能，并且您可以实现许多接口以“确保”功能

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-26T08:53:30.713

这可能是一个非常困难的电话......

我可以给出一个指针：一个对象可以实现许多接口，而一个对象只能继承一个基类（在像 c# 这样的现代 OO 语言中，我知道 C++ 具有多重继承——但这不是令人不悦吗？）

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-26T08:56:55.140

*纯粹*在继承的基础上，你会使用一个抽象，你明确定义后代、抽象关系（即动物->猫）和/或需要继承虚拟或非公共属性，尤其是共享状态（接口不支持）。

你应该尽可能地尝试组合（通过依赖注入）而不是继承，并注意接口作为契约支持单元测试、关注点分离和（语言变化）多重继承，而 Abstracts 不能。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-26T11:00:47.323

接口比抽象类表现更好的一个有趣的地方是当您需要向一组（相关或不相关）对象添加额外功能时。如果你不能给他们一个基本的抽象类（例如，他们是`sealed`或已经有一个父类），你可以给他们一个虚拟（空）接口，然后简单地为那个接口编写扩展方法。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-08-10T13:04:52.073

简短的回答：**抽象**类允许您创建子类可以实现或覆盖的功能。**接口**只允许您定义功能，而不是实现它。虽然一个类只能扩展一个抽象类，但它可以利用多个接口。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-01-26T08:54:14.503

抽象类可以有实现。

接口没有实现，它只是定义了一种契约。

也可能存在一些与语言相关的差异：例如 C# 没有多重继承，但可以在一个类中实现多个接口。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-05-09T19:08:52.350

基本的经验法则是：**“名词”使用抽象**类，**“动词”使用接口**

例如：`car`是一个抽象类`drive`，我们可以把它变成一个接口。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-11-12T11:04:47.607

如果我们有一个对所有派生类都相同的实现，那么最好在接口上使用抽象类。当我们有一个接口时，我们可以将我们的实现移动到任何实现接口的类。在抽象类中，它避免了代码重复并共享所有派生类的实现。这些接口允许开发有助于更好测试的松散耦合系统。

# .net - DLL、内存映射、基地址、内存使用和 .NET？

> ID：479146
> 
> 赞同：10
> 
> 时间：2009-01-26T08:48:56.823
> 
> 标签：.net, memory, dll, base-address

在我开始真正的问题之前，让我先说一下我可能会在这里弄错一些细节。如果是这样，请在这些问题上逮捕我，甚至不要回答我的问题。

我的问题基本上是关于 DLL 和 .NET。我们有一个使用大量内存的应用程序，我们正试图弄清楚如何正确测量这一点，尤其是当问题主要发生在客户的计算机上时。

让我印象深刻的一件事是，我们有一些相当大的 .NET 程序集，其中包含生成的 ORM 代码。

如果我使用具有唯一基地址的非托管 (Win32) DLL，同一台机器上的多个同时进程会将 DLL 加载到物理内存中，然后将其映射到所有应用程序的虚拟内存中。因此，该 DLL 将使用一次物理内存。

问题是 .NET 程序集会发生什么。这个 DLL 包含 IL，虽然它的这一部分可能在应用程序之间共享，但是由这个 IL 产生的 JITted 代码呢？是共享的吗？如果不是，我如何衡量以找出这实际上是否导致了问题？（是的，我知道，它会有所贡献，但在它成为最大的问题之前，我不会花太多时间在这上面）。

另外，我知道我们没有查看解决方案中所有 .NET 程序集的基地址，.NET 程序集是否有必要这样做？如果是这样，是否有一些关于如何确定这些地址的指南？

对此领域的任何见解都将受到欢迎，即使事实证明这不是一个大问题，甚至根本不是问题。

* * *

**编辑**：刚刚发现这个问题：[.NET 程序集和 DLL rebase](https://stackoverflow.com/questions/352519/-net-assemblies-and-dll-rebasing)部分回答了我的问题，但我仍然想知道 JITted 代码是如何影响所有这些的。

从该问题及其接受的答案看来，JITted 代码放置在堆上，这意味着每个进程将加载共享的二进制程序集映像，并在其自己的内存空间内生成代码的私有 JITted 副本。

我们有什么方法可以衡量这个吗？如果这会产生大量代码，我们将不得不更多地查看生成的代码以确定是否需要对其进行调整。

* * *

**编辑**：在这里添加了一个较短的问题列表：

1.  确保 .NET 程序集的基地址是唯一的且不重叠以避免重新设置主要用于将 IL 代码从 JITting 中提取出来的 dll 是否有任何意义？
2.  如何测量 JITted 代码使用了多少内存来确定这是否真的是一个问题？

[@Brian Rasmussen](https://stackoverflow.com/users/38206/brian-rasmussen) [在此处](https://stackoverflow.com/questions/479146/dlls-memory-mapping-base-address-memory-usage-and-net#479209)的回答表明，正如我所料，JITting 将生成 JITted 代码的每个进程的副本，但是重新设置程序集实际上会对减少内存使用产生影响。我将不得不深入研究他提到的 WinDbg+SoS 工具，我已经在我的列表中列出了一段时间，但现在我怀疑我不能再推迟了 :)

* * *

**编辑**：我在这个主题上找到了一些链接：

*   [重新设置所有库程序集](http://vanryswyckjan.blogspot.com/2005/11/rebase-all-your-library-assemblies.html)
*   [MSDN：重新定位 Win32 DLL：整个故事](http://msdn.microsoft.com/en-us/library/ms810432.aspx)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T09:23:44.523

**这是针对问题 1)**

jit 代码被放置在一个特殊的堆上。`!eeheap`您可以使用WinDbg + SoS 中的命令检查此堆。因此，每个进程都将拥有自己的 jitted 代码副本。该命令还将显示代码堆的总大小。

如果您想了解有关从 WinDbg 获取此信息的更多详细信息，请告诉我。

**这是问题2）**

根据*Expert .NET 2.0 IL Assembly*一书，纯 IL PE 文件的`.reloc`一部分仅包含一个用于 CLR 启动存根的修复条目。因此，在变基期间托管 DLL 所需的修复量是相当有限的。

但是，如果您列出任何给定的托管进程，您会注意到 Microsoft 已重新设置其托管 DLL 的大部分（或全部）基础。是否应将其视为变基的原因取决于您。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T09:34:50.413

我不确定以下信息对于较新版本的 .NET 和/或 Windows 版本有多准确。自 .NET 早期以来，MS 可能已经解决了一些 DLL 加载/共享问题。但我相信以下大部分内容仍然适用。

使用 .NET 程序集，进程之间（以及终端服务器会话之间）页面共享的许多好处消失了，因为 JIT 需要动态编写本机代码 - 没有图像文件来备份本机代码。因此，每个进程都有自己的、单独的内存页面用于 jitted 代码。

这类似于由于 DLL 的基础不正确而导致的问题 - 如果操作系统在加载标准 Win32 DLL 时需要对其执行修复，则无法共享已修复部分的内存页面。

然而，即使无法共享 jitted 代码，重新定位 .NET DLL 也有好处，因为仍然会为元数据（和 IL）加载 DLL - 如果不需要修复，则可以共享这些内容。

使用 ngen 可以帮助与 .NET 程序集共享内存页面。但这也带来了一系列问题。

有关详细信息，请参阅 Jason Zander 的这篇旧博客文章：

[http://blogs.msdn.com/jasonz/archive/2003/09/24/53574.aspx](http://blogs.msdn.com/jasonz/archive/2003/09/24/53574.aspx)

Larry Osterman 有一篇关于 DLL 页面共享和修复效果的不错的博客文章：

[http://blogs.msdn.com/larryosterman/archive/2004/07/06/174516.aspx](http://blogs.msdn.com/larryosterman/archive/2004/07/06/174516.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T09:08:39.093

我认为您对共享程序集和 dll 以及进程内存空间感到困惑。

.NET 和标准 Win32 DLL 在使用它们的不同进程之间共享代码。在 .NET 的情况下，这仅适用于具有相同版本签名的 DLL，因此同一 dll 的两个不同版本可以同时加载到内存中。

问题是您似乎*期望库调用分配的内存也可以共享*，**这永远不会（几乎）发生**。当你的库中的一个函数分配内存时，我猜这对于 ORM DLL 发生了很多，该内存是在调用进程的内存空间内分配的，每个进程都有唯一的数据实例。

所以是的，实际上 DLL**代码**被加载一次并在调用者之间共享，但代码指令（以及因此分配）单独发生在调用进程空间中。

**编辑：** 好的，让我们看看 JIT 如何与 .NET 程序集一起工作。

当我们谈论 JITing 代码时，过程相对简单。在内部有一个称为虚拟方法表的结构，它基本上包含将在调用期间调用的虚拟地址。在 .NET 中，JIT 的工作原理基本上是编辑该表，以便每个调用都重定向到 JIT 编译器。这样，每当我们调用一个方法时，JIT 都会介入并将代码编译为实际的机器指令（因此称为 Just In Time），一旦完成，JIT 就会返回 VMT 并替换调用的旧条目**他**指向生成的低级代码。这样，所有后续调用都将重定向到编译后的代码（所以我们只编译一次）。所以不是每次都调用 JIT，所有后续调用都将重定向到相同的编译代码。对于 DLL，该过程可能是相同的（尽管我不能完全向您保证它是相同的）。

# c++ - 阅读网页

> ID：479148
> 
> 赞同：0
> 
> 时间：2009-01-26T08:49:01.770
> 
> 标签：c++

我想知道是否有人知道如何从 C++ 中读取网页中的文本。

在您第一次使用常规方式连接到互联网后，

您输入字符串，例如“ [http://www.bbc.co.uk](http://www.bbc.co.uk) ”，C++ 程序会读取信息：

“BBC 网站这是 BBC 网站……”

来自网络。

我是否必须编写一个向调制解调器发送大量数据和从调制解调器发送大量数据的程序才能做到这一点，还是有更简单的方法来做到这一点？Windows 中是否有某种命令行程序可以为您完成这一切？无论哪种方式，如果您对网络上的任何教程有任何提示，那就太好了。

我想知道，因为我认为编写可以从互联网上读取信息、跟踪链接等的应用程序会很有趣，我可能会想到一个利用这一点的好游戏。

感谢。

保罗。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T09:18:36.623

我会在 C/C++ 中推荐用于 http 的 lib cURL，但这仍然忽略了解析 html 以呈现来自标签的实际文本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T09:11:21.460

你可以很容易地用 boost 做到这一点。检查[阿西奥](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html)。

[Http 客户端示例](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio/example/http/client/async_client.cpp)（从 Internet 下载并显示 .txt 文件）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T08:54:33.177

您可以使用*`wget`*来获取页面，但您仍然需要解析输出。

您不需要向调制解调器发送数据。您需要做的就是通过套接字连接到网络服务器并从那里检索数据。查找有关套接字编程和 http 协议的文献。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T09:03:10.617

不是直接来自 C++，但有可用的资源：有[Lynx](http://lynx.isc.org/)文本浏览器。

# silverlight - silverlight2 应用程序中的模糊字体

> ID：479167
> 
> 赞同：5
> 
> 时间：2009-01-26T09:00:42.697
> 
> 标签：silverlight, fonts

我做了我的第一个 Silverlight 2 应用程序，令人烦恼的是文本字体看起来模糊或参差不齐。

你可以在这里看到它：

[替代文字 http://img516.imageshack.us/img516/1444/blurryfonthp3.png](http://img516.imageshack.us/img516/1444/blurryfonthp3.png)

这是 SL 的“功能”还是我做错了什么？

我知道 SL2 使用了一些花哨的技术来使应用程序独立于设备，但这种字体是不可接受的（我正在使用带有 Aero 的 Vista ）。

额外的问题：SL2 中是否有任何参考业务应用程序？

最好的祝福，

托马斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-02T20:06:31.230

我*肯定会*说它看起来很模糊——就像你在 OSX 或 Linux 上查看它一样。我也同意这是不可接受的——当然，与 WPF 一起，字体渲染也很糟糕。现在，虽然 Microsoft 一直承诺为 .NET 4 版本修复此问题，但事实上，我们中的许多人今天需要运送/出售东西，这导致了以下选择：

*   您可以忽略常识并按*原样*发布软件- 使字体更大以及您拥有什么。只要您的客户购买，有什么问题？（虽然不是我的选择）
*   如果您正在使用 Silverlight，您可以等到将来的某个版本修复此问题（对于 WPF 也是如此）。祝你好运。看看 WPF 已经存在了多久，每个人都知道这个问题，猜猜看 - 它还没有被修复。
*   如果您正在使用 WPF，您*可以获得*完美的字体渲染——这种算法甚至比 Vista 所做的稍微好一点（让我们面对现实，它几乎是完美的）。WinForms 也是如此。理想 ClearType 的算法是明智地使用亚像素渲染、抗锯齿和使用字体提示（如果可用）的混合体。我已经做到了这一点，甚至在为 SIMD 等优化它时玩得很开心。不过，这*是*对您时间的重大投资。
*   像素字体。我自己没有尝试过，但它应该可以工作。
*   预渲染位图。哦，是的，如果您想杀死速度，请继续。话虽如此，如果您知道您正在利用硬件加速，我认为这是[可以接受的。](http://www.codeproject.com/KB/cs/mdxconsole.aspx)

我想我想说的是：WPF/WinForms 有*一个*解决方案（是的，WinForms`ClearTypeGridFit`也不是最好的算法），但Silverlight*没有解决方案。*然而。我希望有人能证明我错了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T09:06:35.603

抗锯齿只是 Silverlight 的一个功能；不会说它看起来很模糊，我很喜欢它。

参考方面，我认为我没有见过完整的应用程序示例，但是如果您使用 IPropertyNotifyChanged / ObservableCollection 查看 Model-View-ViewModel 并浏览[Jesse Liberty](http://jesseliberty.com/)和[Shawn Wildermuth](http://wildermuth.com/)的博客，他们有很多有关数据传输和多页应用程序的信息 - 您需要做一个“商业应用程序”

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T09:06:52.390

WPF 和 Silverlight 上的 ClearType 字体渲染实现就是这样设计的。文本动画流畅，但看起来模糊。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-05T17:16:40.940

我会用完另一个答案槽，因为这里有很多话要说。

我希望我能提供这些资源的链接 :) 我的意思是，那里没有这样的东西，而且我怀疑这样做的人是否会提供他们如何实现它的源代码。这主要是因为所需的大量工作令人难以置信。

这就是我的做法。首先，我找到了理想的（或几乎）类似 ClearType 的算法——它专门为我工作（没有提示，请注意，但考虑到性能成本，我不会被打扰）。然后，我将它连接到 .NET 中，这样我至少可以用文本渲染位图（我有一个[Silverlight 测试页面](http://nesteruk.org/blog/post/ClearType-in-Silverlight.aspx)，可以显示它的实际效果）。因此，我将算法微调到可以使用它来代替例如标签的程度。我的应用充满了标签，所以我做了这些。（您可以想象，文本框可能要复杂得多）。就是这样。

正如您从链接中看到的，在 Silverlight 中也可能获得良好的 ClearType 样式文本。我只花了 2 天时间连接一个 Web 服务来呈现文本，而且速度相当慢，但我认为对于标签之类的东西，没有理由不能完成这样的事情——尤其是缓存和其他诡计。

# c# - 使用 TcpClient 调用 TCP SoapService

> ID：479171
> 
> 赞同：0
> 
> 时间：2009-01-26T09:02:13.380
> 
> 标签：c#, web-services, soap, tcp

我有一个演示肥皂服务，它回应了请求

```
 public class EchoWebService : SoapService
    {
        [SoapMethod("Echo")]
        public string Echo(string request)
        {
            Console.WriteLine("Request: {0}", request);
            return DateTime.Now + Environment.NewLine + request;
        }
    } 
```

服务使用 TCP 托管，

```
Uri to = new Uri("soap.tcp://localhost:5696");
EndpointReference EPR = new EndpointReference(to);
SoapReceivers.Add(EPR, new EchoWebService()); 
```

我可以通过编写自己的 TCP SoapClient 来调用服务，

```
Uri to = new Uri("soap.tcp://localhost:5696");
EndpointReference EPR = new EndpointReference(to);
mysoapclient client1 = new mysoapclient(EPR);
Console.WriteLine(client1.GetResponse("Hello World"));

class mysoapclient : SoapClient
{
        public mysoapclient(EndpointReference endpoint) : base(endpoint) { }
        public string GetResponse(string request)
        {

            return base.SendRequestResponse("Echo",
              request).GetBodyObject(typeof(string)).ToString();
        }
} 
```

有没有办法使用 TcpClient 调用服务？我想通过 TCP 发送原始 xml 以调用服务并从网络流中读取响应。我尝试使用以下代码和 xml，但它似乎不起作用。

```
TcpClient client = new TcpClient("localhost", 5696);
byte[] request = Encoding.UTF8.GetBytes(xml);
NetworkStream stream = client.GetStream();
stream.Write(request, 0, request.Length);
byte[] response = new byte[client.ReceiveBufferSize];
client.GetStream().Read(response, 0, client.ReceiveBufferSize);
Console.WriteLine(Encoding.UTF8.GetString(response));

<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <Echo xmlns="http://tempuri.org/">
      <request>Hello World</request>
    </Echo>
  </soap:Body>
</soap:Envelope> 
```

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T09:36:15.653

您需要将所有二进制标头填充到`SOAP/TCP`.

请参阅[SUN 的 SOAP/TCP 参考](http://java.sun.com/webservices/reference/apis-docs/soap-tcp-v1.0.pdf)。

作为提示，您可以运行`tcpdump`或`wireshark`，记录您的`SOAP`会话并查看您需要填写的确切内容。

要记录环回流量，请使用`tcpdump`将其捕获到文件中，然后使用以下命令打开文件`wireshark`

# linux - Linux 新手：Linux vs POSIX 手册

> ID：479173
> 
> 赞同：5
> 
> 时间：2009-01-26T09:02:40.290
> 
> 标签：linux, posix

```
$ apropos mkfifo
mkfifo (1)           - make FIFOs (named pipes)
mkfifo (1posix)      - make FIFO special files
mkfifo (3)           - make a FIFO special file (a named pipe)
mkfifo (3posix)      - make a FIFO special file
mkfifoat (3)         - make a FIFO (named pipe) relative to a directory file ... 
```

所以我有 Linux 程序员手册和 POSIX 程序员手册的手册页。我应该更喜欢哪个，为什么？（我正在编写一个 Linux 应用程序，没有计划移植它 AIX、BSD 等）

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T09:06:35.540

基本上，Linux 手册是来自其作者的命令/API 的文档；POSIX 手册来自 POSIX 标准。通常，“正常”的更短更简洁，但要处理具体的实现；POSIX 更长更详细（请参阅 参考资料`man 3p read`），但仅说明标准中的内容。

最好的办法是两者都看。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-20T14:08:40.463

> 没有计划将其移植到 AIX、BSD 等。

著名的遗言 :-) 这可能会在您的简历变得太长之前迅速改变。

为了回答这个问题，Linux 文档项目曾经询问 Opengroup（负责发布 POSIX 标准）是否可以使用官方标准中的措辞。该请求被批准用于当时的第 7 期（约 2011 年）。

非 POSIX 限定的手册页通常会描述更多不同的选项。不过，寻求编写可移植程序的开发人员应该参考 POSIX 手册页。 [这是网络上的 POSIX 标准（第 7 期）](http://pubs.opengroup.org/onlinepubs/9699919799/)。

# java - JDK中的数据结构，在什么场景下使用哪一种？

> ID：479176
> 
> 赞同：3
> 
> 时间：2009-01-26T09:03:05.733
> 
> 标签：java, data-structures

是否存在诸如 TreeMap、SortedMap、HashSet 等数据结构的备忘单，以及在什么情况下使用哪一个。有没有好文章推荐

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T09:08:49.327

[集合教程](http://java.sun.com/docs/books/tutorial/collections/TOC.html)是一个很好的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T09:16:11.357

读一[本好书](https://rads.stackoverflow.com/amzn/click/com/0201775786)！数据结构是抽象的，不受 Java 约束。也许这个[网站](http://nist.gov/dads/)也值得一看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T09:26:14.393

浏览 wikipedia 的[数据结构列表](http://en.wikipedia.org/wiki/List_of_data_structures)将了解一般结构的使用方式，以及 JDK 有什么或没有什么是重要的（例如有链接的哈希集但没有公开树映射的树类型，并拥有一组不错的并发数据结构）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T09:38:17.207

您将[在此处找到一个小的](http://www.surfscranton.com/Architecture/JavaCollections.htm)[**“Java 集合备忘单”**](http://www.surfscranton.com/Architecture/JavaCollections.htm)。

[Sun Collections 概述](http://java.sun.com/javase/6/docs/technotes/guides/collections/overview.html)仍然是最完整的快速参考。

# wpf - 谁对 WPF 依赖属性有最好的比喻？

> ID：479180
> 
> 赞同：2
> 
> 时间：2009-01-26T09:05:02.347
> 
> 标签：wpf, dependency-properties

我正在阅读 C# 2008 中的 WPF 食谱：

[http://www.apress.com/book/view/9781430210849](http://www.apress.com/book/view/9781430210849)

从第三个配方开始，他们假设您知道依赖属性是如何工作的。

因此，经过一番谷歌搜索后，我通常理解这些是对象的属性，当它们放置在另一个对象中时“适应上下文”以适应宿主对象。我还“了解到”“你永远不会真正知道这些属性的价值是什么，因为它们取决于它们的上下文。”

但是本书中描述的大部分内容仍然让我不知道在构建应用程序时如何使用它们。

对于刚开始使用它们并想知道他们何时以及如何使用它们的人来说，谁有一个很好的依赖属性的隐喻或示例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T09:58:58.023

依赖属性就像普通属性一样，只是它们有一些 WPF 使用的特殊“钩子”。

一件特别的事情是，有时如果您不设置属性值，它将从放置它的控件接收其值（因此，如果您为按钮设置字体，则按钮内的文本块将使用此字体，除非您指定文本块的不同字体），我认为这是所有“永远不知道值”废话的来源。

如果您正在编写 WPF 控件，您可能应该使用依赖属性，因为您可以指定更改是否应自动导致控件重新呈现自身（以及更多），并且您可以将它们用于数据绑定。

如果您正在编写从 Freezable 派生的类（直接或间接），则仅使用依赖属性将为您节省一些工作。

如果您正在编写一个不是 WPF 特定的类，那么可能没有理由使用依赖属性。

# java - 如何限制 JTextArea 最大行数和列数？

> ID：479182
> 
> 赞同：6
> 
> 时间：2009-01-26T09:05:23.997
> 
> 标签：java, text, limit, lines, jtextarea

我在 JScrollPane 中使用 JTextArea

我想限制可能的最大行数和每行中的最大字符数。

我需要字符串与屏幕上的完全一样，每一行都以 '\n' 结尾（如果后面有另一行），用户将只能在每行中插入 X 行和 Y 字符。

我试图限制行，但由于换行，我不确切知道我有多少行，换行是在屏幕上可视地开始新行（因为 JTextArea 的宽度）但在字符串中该组件实际上是同一行，没有'\n'来表示新行。我不知道如何在输入时限制每行中的最大字符数。

有2个阶段：

1.  字符串的输入 - 保持用户将无法在每行中输入超过 X 行和 Y 字符。（即使换行只是视觉上的或用户输入了'/n'）
2.  将字符串插入 DB- 单击“确定”后将字符串转换为每行将以“/n”结尾的字符串，即使用户没有键入它并且该行仅在视觉上被换行。

如果我将计算行中的字符并在行尾插入'/n'，则几乎没有问题，这就是我决定分两个阶段进行的原因。在第一阶段，用户正在打字，我宁愿只在视觉上限制它并强制换行或类似的东西。只有在第二阶段，当我保存字符串时，我才会添加“/n”，即使用户没有在行尾键入它！

**有人有想法吗？**

* * *

我知道我将不得不使用 DocumentFilter 或 StyledDocument。

这是仅将行限制为 3 的示例代码：（但不将行中的字符限制为 19）

```
private JTextArea textArea ;
textArea  = new JTextArea(3,19);
textArea  .setLineWrap(true);
textArea .setDocument(new LimitedStyledDocument(3));
JScrollPane scrollPane  = new JScrollPane(textArea

public class LimitedStyledDocument extends DefaultStyledDocument

    /** Field maxCharacters */
    int maxLines;

    public LimitedStyledDocument(int maxLines) {
        maxCharacters = maxLines;
    }

public void insertString(int offs, String str, AttributeSet attribute) throws BadLocationException {
    Element root = this.getDefaultRootElement();
    int lineCount = getLineCount(str);

    if (lineCount + root.getElementCount() <= maxLines){
        super.insertString(offs, str, attribute);
    }
    else {
        Toolkit.getDefaultToolkit().beep();
    }
}

 /**
 * get Line Count
 * 
 * @param str
 * @return the count of '\n' in the String
 */
private int getLineCount(String str){
    String tempStr = new String(str);
    int index;
    int lineCount = 0;

    while (tempStr.length() > 0){
        index = tempStr.indexOf("\n");
        if(index != -1){
        lineCount++;
            tempStr = tempStr.substring(index+1);
        }
    else{
        break;
        }
    }
    return lineCount;
   }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-18T03:09:58.790

这是我的版本，基于尼克霍尔特的版本。

只是为了记录，这将在原型中使用，并且没有经过太多测试（如果有的话）。

```
public class LimitedLinesDocument extends DefaultStyledDocument {
    private static final long serialVersionUID = 1L;

    private static final String EOL = "\n";

    private final int maxLines;
    private final int maxChars;

    public LimitedLinesDocument(int maxLines, int maxChars) {
        this.maxLines = maxLines;
        this.maxChars = maxChars;
    }

    @Override
    public void insertString(int offs, String str, AttributeSet attribute) throws BadLocationException {
        boolean ok = true;

        String currentText = getText(0, getLength());

        // check max lines
        if (str.contains(EOL)) {
            if (occurs(currentText, EOL) >= maxLines - 1) {
                ok = false;
            }
        } else {
            // check max chars
            String[] lines = currentText.split("\n");
            int lineBeginPos = 0;
            for (int lineNum = 0; lineNum < lines.length; lineNum++) {
                int lineLength = lines[lineNum].length();
                int lineEndPos = lineBeginPos + lineLength;

                System.out.println(lineBeginPos + "    " + lineEndPos + "    " + lineLength + "    " + offs);

                if (lineBeginPos <= offs && offs <= lineEndPos) {
                    System.out.println("Found line");
                    if (lineLength + 1 > maxChars) {
                        ok = false;
                        break;
                    }
                }
                lineBeginPos = lineEndPos;
                lineBeginPos++; // for \n
            }
        }

        if (ok)
            super.insertString(offs, str, attribute);
    }

    public int occurs(String str, String subStr) {
        int occurrences = 0;
        int fromIndex = 0;

        while (fromIndex > -1) {
            fromIndex = str.indexOf(subStr, occurrences == 0 ? fromIndex : fromIndex + subStr.length());
            if (fromIndex > -1) {
                occurrences++;
            }
        }

        return occurrences;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-30T09:55:23.277

以下对我有用：

```
public class LimitedLinesDocument extends DefaultStyledDocument 
{    
  private static final String EOL = "\n";

  private int maxLines;

  public LimitedLinesDocument(int maxLines) 
  {    
    this.maxLines = maxLines;
  }

  public void insertString(int offs, String str, AttributeSet attribute) throws BadLocationException 
  {        
    if (!EOL.equals(str) || StringUtils.occurs(getText(0, getLength()), EOL) < maxLines - 1) 
    {    
      super.insertString(offs, str, attribute);
    }
  }
} 
```

其中`StringUtils.occurs`方法如下：

```
public static int occurs(String str, String subStr) 
{    
  int occurrences = 0;
  int fromIndex = 0;

  while (fromIndex > -1) 
  {    
    fromIndex = str.indexOf(subStr, occurrences == 0 ? fromIndex : fromIndex + subStr.length());
    if (fromIndex > -1) 
    {    
      occurrences++;
    }
  }

  return occurrences;
} 
```

# c - 如何在 C 中实现函数重载？

> ID：479207
> 
> 赞同：277
> 
> 时间：2009-01-26T09:20:35.823
> 
> 标签：c, overloading

有没有办法在 C 中实现函数重载？我正在寻找要重载的简单函数，例如

```
foo (int a)  
foo (char b)  
foo (float c , int d) 
```

我认为没有直接的方法；如果有的话，我正在寻找解决方法。

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2014-07-29T23:04:48.273

**是的！**

自从提出这个问题以来，由于在 C11 中添加了关键字，标准 C（无扩展）有效地*获得了*对函数重载（不是运算符）的支持。`_Generic`（从 4.9 版开始在 GCC 中支持）

（重载并不是问题中显示的真正“内置”的方式，但实现这样的工作非常容易。）

`_Generic``sizeof`是与和同族的编译时运算符`_Alignof`。它在标准部分 6.5.1.1 中进行了描述。它接受两个主要参数：一个表达式（不会在运行时计算）和一个看起来有点像`switch`块的类型/表达式关联列表。`_Generic`获取表达式的整体类型，然后对其进行“切换”以在列表中为其类型选择最终结果表达式：

```
_Generic(1, float: 2.0,
            char *: "2",
            int: 2,
            default: get_two_object()); 
```

上述表达式的计算结果为`2`- 控制表达式的类型是`int`，因此它选择与关联的表达式`int`作为值。在运行时没有任何内容。（该`default`子句是可选的：如果您将其关闭并且类型不匹配，则会导致编译错误。）

这对函数重载有用的方式是它可以由 C 预处理器插入，并根据传递给控制宏的参数类型选择结果表达式。因此（来自 C 标准的示例）：

```
#define cbrt(X) _Generic((X),                \
                         long double: cbrtl, \
                         default: cbrt,      \
                         float: cbrtf        \
                         )(X) 
```

这个宏实现了一个重载`cbrt`操作，通过将参数的类型分派给宏，选择适当的实现函数，然后将原始宏参数传递给该函数。

因此，要实现您的原始示例，我们可以这样做：

```
foo_int (int a)  
foo_char (char b)  
foo_float_int (float c , int d)

#define foo(_1, ...) _Generic((_1),                                  \
                              int: foo_int,                          \
                              char: foo_char,                        \
                              float: _Generic((FIRST(__VA_ARGS__,)), \
                                     int: foo_float_int))(_1, __VA_ARGS__)
#define FIRST(A, ...) A 
```

在这种情况下，我们可以`default:`为第三种情况使用关联，但这并没有说明如何将原理扩展到多个参数。最终结果是您可以`foo(...)`在代码中使用而不必担心（很多 [1]）其参数的类型。

* * *

对于更复杂的情况，例如函数重载大量参数或变化数量，您可以使用实用宏来自动生成静态调度结构：

```
void print_ii(int a, int b) { printf("int, int\n"); }
void print_di(double a, int b) { printf("double, int\n"); }
void print_iii(int a, int b, int c) { printf("int, int, int\n"); }
void print_default(void) { printf("unknown arguments\n"); }

#define print(...) OVERLOAD(print, (__VA_ARGS__), \
    (print_ii, (int, int)), \
    (print_di, (double, int)), \
    (print_iii, (int, int, int)) \
)

#define OVERLOAD_ARG_TYPES (int, double)
#define OVERLOAD_FUNCTIONS (print)
#include "activate-overloads.h"

int main(void) {
    print(44, 47);   // prints "int, int"
    print(4.4, 47);  // prints "double, int"
    print(1, 2, 3);  // prints "int, int, int"
    print("");       // prints "unknown arguments"
} 
```

（[在此处实现](https://stackoverflow.com/a/25715458/1366431)）因此，通过一些努力，您可以减少样板文件的数量，使其看起来非常像具有对重载的本机支持的语言。

顺便说一句，在 C99[中已经可以](https://stackoverflow.com/a/22624852/1366431)重载参数的*数量*（而不是类型）。

* * *

[1] 请注意，C 评估类型的方式可能会让您感到困惑。`foo_int`例如，如果您尝试将字符文字传递给它，这将选择，如果您希望重载支持字符串文字，则[需要稍微弄乱一下。](https://stackoverflow.com/q/18857056/1366431)不过总体来说还是很酷的。

* * *

## 回答 #2

> 赞同：140
> 
> 时间：2009-01-26T09:24:41.883

有几种可能：

1.  printf 样式函数（类型作为参数）
2.  opengl 风格的函数（输入函数名）
3.  c++ 的 c 子集（如果您可以使用 c++ 编译器）

* * *

## 回答 #3

> 赞同：85
> 
> 时间：2009-01-26T09:52:11.813

如前所述，C 不支持您所说的重载。解决该问题的常用习惯用法是使函数接受[标记的 union](http://en.wikipedia.org/wiki/Tagged_union)。这是由一个`struct`参数实现的，其中它`struct`本身由某种类型的指示符组成，例如`enum`a 和 a`union`的不同类型的值。例子：

```
#include <stdio.h>

typedef enum {
    T_INT,
    T_FLOAT,
    T_CHAR,
} my_type;

typedef struct {
    my_type type;
    union {
        int a; 
        float b; 
        char c;
    } my_union;
} my_struct;

void set_overload (my_struct *whatever) 
{
    switch (whatever->type) 
    {
        case T_INT:
            whatever->my_union.a = 1;
            break;
        case T_FLOAT:
            whatever->my_union.b = 2.0;
            break;
        case T_CHAR:
            whatever->my_union.c = '3';
    }
}

void printf_overload (my_struct *whatever) {
    switch (whatever->type) 
    {
        case T_INT:
            printf("%d\n", whatever->my_union.a);
            break;
        case T_FLOAT:
            printf("%f\n", whatever->my_union.b);
            break;
        case T_CHAR:
            printf("%c\n", whatever->my_union.c);
            break;
    }

}

int main (int argc, char* argv[])
{
    my_struct s;

    s.type=T_INT;
    set_overload(&s);
    printf_overload(&s);

    s.type=T_FLOAT;
    set_overload(&s);
    printf_overload(&s);

    s.type=T_CHAR;
    set_overload(&s);
    printf_overload(&s); 
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2015-07-26T18:20:41.937

这是我发现的在 C 中演示函数重载的最清晰、最简洁的示例：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int addi(int a, int b) {
    return a + b;
}

char *adds(char *a, char *b) {
    char *res = malloc(strlen(a) + strlen(b) + 1);
    strcpy(res, a);
    strcat(res, b);
    return res;
}

#define add(a, b) _Generic(a, int: addi, char*: adds)(a, b)

int main(void) {
    int a = 1, b = 2;
    printf("%d\n", add(a, b)); // 3

    char *c = "hello ", *d = "world";
    printf("%s\n", add(c, d)); // hello world

    return 0;
} 
```

[https://gist.github.com/barosl/e0af4a92b2b8cabd05a7](https://gist.github.com/barosl/e0af4a92b2b8cabd05a7)

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2010-06-14T21:12:34.580

如果您的编译器是 gcc 并且您不介意每次添加新的重载时都进行手动更新，您可以做一些宏魔术并在调用者方面获得您想要的结果，那么编写起来就不那么好......但它是可能的

查看 __builtin_types_compatible_p，然后使用它来定义一个执行类似操作的宏

```
#define foo(a) \
((__builtin_types_compatible_p(int, a)?foo(a):(__builtin_types_compatible_p(float, a)?foo(a):) 
```

但是是的，讨厌，只是不要

**编辑：** C1X 将获得对它们看起来像这样的类型泛型表达式的支持：

```
#define cbrt(X) _Generic((X), long double: cbrtl, \
                              default: cbrt, \
                              float: cbrtf)(X) 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-01-26T10:25:46.177

以下方法类似于*a2800276*，但添加了一些 C99 宏魔术：

```
// we need `size_t`
#include <stddef.h>

// argument types to accept
enum sum_arg_types { SUM_LONG, SUM_ULONG, SUM_DOUBLE };

// a structure to hold an argument
struct sum_arg
{
    enum sum_arg_types type;
    union
    {
        long as_long;
        unsigned long as_ulong;
        double as_double;
    } value;
};

// determine an array's size
#define count(ARRAY) ((sizeof (ARRAY))/(sizeof *(ARRAY)))

// this is how our function will be called
#define sum(...) _sum(count(sum_args(__VA_ARGS__)), sum_args(__VA_ARGS__))

// create an array of `struct sum_arg`
#define sum_args(...) ((struct sum_arg []){ __VA_ARGS__ })

// create initializers for the arguments
#define sum_long(VALUE) { SUM_LONG, { .as_long = (VALUE) } }
#define sum_ulong(VALUE) { SUM_ULONG, { .as_ulong = (VALUE) } }
#define sum_double(VALUE) { SUM_DOUBLE, { .as_double = (VALUE) } }

// our polymorphic function
long double _sum(size_t count, struct sum_arg * args)
{
    long double value = 0;

    for(size_t i = 0; i < count; ++i)
    {
        switch(args[i].type)
        {
            case SUM_LONG:
            value += args[i].value.as_long;
            break;

            case SUM_ULONG:
            value += args[i].value.as_ulong;
            break;

            case SUM_DOUBLE:
            value += args[i].value.as_double;
            break;
        }
    }

    return value;
}

// let's see if it works

#include <stdio.h>

int main()
{
    unsigned long foo = -1;
    long double value = sum(sum_long(42), sum_ulong(foo), sum_double(1e10));
    printf("%Le\n", value);
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2012-10-22T11:22:33.310

是的，有点。

举个例子：

```
void printA(int a){
printf("Hello world from printA : %d\n",a);
}

void printB(const char *buff){
printf("Hello world from printB : %s\n",buff);
}

#define Max_ITEMS() 6, 5, 4, 3, 2, 1, 0 
#define __VA_ARG_N(_1, _2, _3, _4, _5, _6, N, ...) N
#define _Num_ARGS_(...) __VA_ARG_N(__VA_ARGS__) 
#define NUM_ARGS(...) (_Num_ARGS_(_0, ## __VA_ARGS__, Max_ITEMS()) - 1) 
#define CHECK_ARGS_MAX_LIMIT(t) if(NUM_ARGS(args)>t)
#define CHECK_ARGS_MIN_LIMIT(t) if(NUM_ARGS(args) 
#define print(x , args ...) \
CHECK_ARGS_MIN_LIMIT(1) printf("error");fflush(stdout); \
CHECK_ARGS_MAX_LIMIT(4) printf("error");fflush(stdout); \
({ \
if (__builtin_types_compatible_p (typeof (x), int)) \
printA(x, ##args); \
else \
printB (x,##args); \
})

int main(int argc, char** argv) {
    int a=0;
    print(a);
    print("hello");
    return (EXIT_SUCCESS);
} 
```

它将从 printA 和 printB 输出 0 和 hello ..。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2013-09-18T18:50:03.737

这可能根本没有帮助，但是如果您使用的是 clang，您可以使用可重载属性 - 即使编译为 C 也可以使用

[http://clang.llvm.org/docs/AttributeReference.html#overloadable](http://clang.llvm.org/docs/AttributeReference.html#overloadable)

标题

```
extern void DecodeImageNow(CGImageRef image, CGContextRef usingContext) __attribute__((overloadable));
extern void DecodeImageNow(CGImageRef image) __attribute__((overloadable)); 
```

执行

```
void __attribute__((overloadable)) DecodeImageNow(CGImageRef image, CGContextRef usingContext { ... }
void __attribute__((overloadable)) DecodeImageNow(CGImageRef image) { ... } 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-01-26T09:25:26.500

从你的意思来说——不，你不能。

您可以声明一个`va_arg`函数，如

`void my_func(char* format, ...);`

，但是您需要在第一个参数中传递有关变量数量及其类型的某种信息——就像这样`printf()`做。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-01-26T09:30:41.827

通常，表示类型的疣会附加或附加到名称之前。在某些情况下，您可以摆脱宏，但这取决于您要做什么。C中没有多态性，只有强制。

简单的通用操作可以用宏来完成：

```
#define max(x,y) ((x)>(y)?(x):(y)) 
```

如果您的编译器支持[typeof](http://gcc.gnu.org/onlinedocs/gcc/Typeof.html)，则可以在宏中放入更复杂的操作。然后，您可以使用符号 foo(x) 来支持不同类型的相同操作，但不能改变不同重载之间的行为。如果您想要实际功能而不是宏，您可以将类型粘贴到名称并使用第二次粘贴来访问它（我没有尝试过）。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-09-14T15:13:48.470

[Leushenko 的回答](https://stackoverflow.com/a/25026358/1312382)真的很酷——仅仅是：该`foo`示例无法使用 GCC 编译，它在 处失败`foo(7)`，在`FIRST`宏和实际函数调用 (`(_1, __VA_ARGS__)`中出现问题，剩余逗号。此外，如果我们想提供额外的重载，我们就会遇到麻烦，例如`foo(double)`。

所以我决定进一步详细说明答案，包括允许 void 重载（`foo(void)`- 这造成了相当多的麻烦......）。

现在的想法是：在不同的宏中定义多个泛型，然后根据参数的数量选择正确的泛型！

基于[这个答案](https://stackoverflow.com/a/2124385/1312382)，参数的数量很容易：

```
#define foo(...) SELECT(__VA_ARGS__)(__VA_ARGS__)

#define SELECT(...) CONCAT(SELECT_, NARG(__VA_ARGS__))(__VA_ARGS__)
#define CONCAT(X, Y) CONCAT_(X, Y)
#define CONCAT_(X, Y) X ## Y 
```

很好，我们解决了一个`SELECT_1`或`SELECT_2`（或更多参数，如果你想要/需要它们），所以我们只需要适当的定义：

```
#define SELECT_0() foo_void
#define SELECT_1(_1) _Generic ((_1),    \
        int: foo_int,                   \
        char: foo_char,                 \
        double: foo_double              \
)
#define SELECT_2(_1, _2) _Generic((_1), \
        double: _Generic((_2),          \
                int: foo_double_int     \
        )                               \
) 
```

好的，我已经添加了 void 重载——然而，这个实际上并没有被 C 标准所涵盖，它不允许空的可变参数，即我们*依赖编译器扩展*！

一开始，一个空的宏调用 ( `foo()`) 仍然会产生一个标记，但是是一个空的。因此，即使在空宏调用时，计数宏实际上也会返回 1 而不是 0。如果我们在`__VA_ARGS__` *conditionally*之后放置逗号，我们可以“轻松”地消除这个问题，具体取决于列表是否为空：

```
#define NARG(...) ARG4_(__VA_ARGS__ COMMA(__VA_ARGS__) 4, 3, 2, 1, 0) 
```

这*看起来*很简单，但`COMMA`宏是一个相当沉重的宏；幸运的是，该主题已经在[J​​ens Gustedt 的博客中介绍过](https://gustedt.wordpress.com/2010/06/08/detect-empty-macro-arguments/)（感谢 Jens）。基本技巧是，如果没有括号，函数宏不会被扩展，为了进一步解释，请查看 Jens 的博客......我们只需根据需要修改宏（我将使用较短的名称并且为了简洁而减少争论）。

```
#define ARGN(...) ARGN_(__VA_ARGS__)
#define ARGN_(_0, _1, _2, _3, N, ...) N
#define HAS_COMMA(...) ARGN(__VA_ARGS__, 1, 1, 1, 0)

#define SET_COMMA(...) ,

#define COMMA(...) SELECT_COMMA             \
(                                           \
        HAS_COMMA(__VA_ARGS__),             \
        HAS_COMMA(__VA_ARGS__ ()),          \
        HAS_COMMA(SET_COMMA __VA_ARGS__),   \
        HAS_COMMA(SET_COMMA __VA_ARGS__ ()) \
)

#define SELECT_COMMA(_0, _1, _2, _3) SELECT_COMMA_(_0, _1, _2, _3)
#define SELECT_COMMA_(_0, _1, _2, _3) COMMA_ ## _0 ## _1 ## _2 ## _3

#define COMMA_0000 ,
#define COMMA_0001
#define COMMA_0010 ,
// ... (all others with comma)
#define COMMA_1111 , 
```

现在我们很好...

一个块中的完整代码：

```
/*
 * demo.c
 *
 *  Created on: 2017-09-14
 *      Author: sboehler
 */

#include <stdio.h>

void foo_void(void)
{
    puts("void");
}
void foo_int(int c)
{
    printf("int: %d\n", c);
}
void foo_char(char c)
{
    printf("char: %c\n", c);
}
void foo_double(double c)
{
    printf("double: %.2f\n", c);
}
void foo_double_int(double c, int d)
{
    printf("double: %.2f, int: %d\n", c, d);
}

#define foo(...) SELECT(__VA_ARGS__)(__VA_ARGS__)

#define SELECT(...) CONCAT(SELECT_, NARG(__VA_ARGS__))(__VA_ARGS__)
#define CONCAT(X, Y) CONCAT_(X, Y)
#define CONCAT_(X, Y) X ## Y

#define SELECT_0() foo_void
#define SELECT_1(_1) _Generic ((_1), \
        int: foo_int,                \
        char: foo_char,              \
        double: foo_double           \
)
#define SELECT_2(_1, _2) _Generic((_1), \
        double: _Generic((_2),          \
                int: foo_double_int     \
        )                               \
)

#define ARGN(...) ARGN_(__VA_ARGS__)
#define ARGN_(_0, _1, _2, N, ...) N

#define NARG(...) ARGN(__VA_ARGS__ COMMA(__VA_ARGS__) 3, 2, 1, 0)
#define HAS_COMMA(...) ARGN(__VA_ARGS__, 1, 1, 0)

#define SET_COMMA(...) ,

#define COMMA(...) SELECT_COMMA             \
(                                           \
        HAS_COMMA(__VA_ARGS__),             \
        HAS_COMMA(__VA_ARGS__ ()),          \
        HAS_COMMA(SET_COMMA __VA_ARGS__),   \
        HAS_COMMA(SET_COMMA __VA_ARGS__ ()) \
)

#define SELECT_COMMA(_0, _1, _2, _3) SELECT_COMMA_(_0, _1, _2, _3)
#define SELECT_COMMA_(_0, _1, _2, _3) COMMA_ ## _0 ## _1 ## _2 ## _3

#define COMMA_0000 ,
#define COMMA_0001
#define COMMA_0010 ,
#define COMMA_0011 ,
#define COMMA_0100 ,
#define COMMA_0101 ,
#define COMMA_0110 ,
#define COMMA_0111 ,
#define COMMA_1000 ,
#define COMMA_1001 ,
#define COMMA_1010 ,
#define COMMA_1011 ,
#define COMMA_1100 ,
#define COMMA_1101 ,
#define COMMA_1110 ,
#define COMMA_1111 ,

int main(int argc, char** argv)
{
    foo();
    foo(7);
    foo(10.12);
    foo(12.10, 7);
    foo((char)'s');

    return 0;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-26T09:24:47.143

难道你不能只使用 C++ 而不使用除此之外的所有其他 C++ 功能吗？

如果仍然不只是严格的 C，那么我会推荐[可变参数函数](http://en.wikipedia.org/wiki/Varargs#Variadic_functions_in_C.2C_Objective-C.2C_C.2B.2B.2C_and_D)。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-01-26T10:45:51.190

尝试声明这些函数，就`extern "C++"`好像你的编译器支持这个一样， http: [//msdn.microsoft.com/en-us/library/s6y4zxec (VS.80).aspx](http://msdn.microsoft.com/en-us/library/s6y4zxec(VS.80).aspx)

* * *

## 回答 #14

> 赞同：-6
> 
> 时间：2016-03-09T04:50:31.300

# 我希望下面的代码能帮助你理解函数重载

```
#include <stdio.h>
#include<stdarg.h>

int fun(int a, ...);
int main(int argc, char *argv[]){
   fun(1,10);
   fun(2,"cquestionbank");
   return 0;
}
int fun(int a, ...){
  va_list vl;
  va_start(vl,a);

  if(a==1)
      printf("%d",va_arg(vl,int));
   else
      printf("\n%s",va_arg(vl,char *));
} 
```

# delphi - 如何优雅地退出在 Delphi 中执行代码的 MDI 表单

> ID：479208
> 
> 赞同：0
> 
> 时间：2009-01-26T09:23:02.653
> 
> 标签：delphi, error-handling, mdi

我有一个用 Delphi 2007 编写的 MDI 应用程序。

如果用户在执行代码时退出其中的表单，则会导致异常，因为代码正在尝试更新组件或使用已随表单释放的对象。

无论如何我可以判断代码是否在退出事件中执行，或者是否有处理这种情况的标准方法？

**更新更多信息**

异常通常发生在以下情况。

子 mdi 表单上的一个按钮被按下，这将激活表单中的一个功能，该功能将进入数据库并检索数据，然后它将重新格式化并将其显示在表单上的可视组件中（可用 TListView ）。

如果代码需要很长时间执行（例如，如果有很多数据要处理），用户将失去兴趣并单击关闭按钮（代码的速度正在努力避免这种情况）。

即使它所属的表单已被释放，函数内部的代码仍在执行（代码位于表单的私有部分），现在当它尝试更新它们不再存在的可视组件时（因为它们被释放了表单），它会引发异常。

发生这种情况时，子表单中的代码可以在循环中使用，循环记录并相应地更新列表视图，循环包含看起来像这样的代码

```
inc(i);
if (i mod 25) = 0 then
begin
    StatusPnl.Caption := 'Loading ' + intToStr(i) + ', Please wait';
    application.ProcessMessages;
end; 
```

**其他代码示例**

fromClose 事件看起来像这样

```
//Snip
if (Not (Owner = nil)) then
with (Owner as  IMainForm)do
begin
    //Snip
    DoFormFree(Self,Self.Name);
end
else
//Snip 
```

DoFormFree 是主 mdi 父窗体中的一个函数，看起来像这样

```
//Snip
(G_FormList.Objects[x] as TBaseForm).Release;
G_FormList.Objects[i] := nil;
G_FormList.Delete(i);
//Snip 
```

由于各种原因，所有表单都存储在一个列表中，并且所有子表单都扩展了 TBaseForm 类。

理想情况下，我想要一种方法来判断表单中的代码是否正在执行，并防止用户关闭表单，或者在代码完成之前隐藏它，因为在某些情况下，它可能会生成报告并更新为状态面板发生异常，在这种情况下，报告将不完整。

因为所有表单都是 TbaseFrom 的子类，所以某种全局方式这样做是理想的，所以我可以将代码添加到基本表单并让它适用于所有下降的表单。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T09:30:45.587

您提供的信息不足，但想到的最简单的解决方案是在 OnCloseQuery 处理程序中测试代码是否正在执行，如果是，请将 CanClose 设置为 False。

或者，您可以通过创建表单和后台代码都知道的中间对象来将代码与 MDI 表单分离。你让它有一个对表单的引用，当表单关闭时它会被重置。通过此中间对象路由对表单的所有访问，您可以防止异常。

**编辑：**您需要提供有关在释放 MDI 表单后如何执行尝试访问 MDI 表单的代码的信息。有一些方法可以执行工作代码，例如：

*   在形式或另一个对象的方法中
*   在 OnTimer 事件处理程序中
*   在 Application 对象的 OnIdle 处理程序中
*   在后台线程中

请注意，在第一种情况下，只有在您自己在代码中执行此操作或调用 Application.ProcessMessages 时才能释放表单。如果没有有关您的代码外观的更多信息，没有人可以为您的问题提供具体答案。

**编辑2：**根据您添加的信息，有问题的代码似乎总是在表单的方法中执行。这很容易通过创建一个布尔成员来捕获，该成员在执行开始时设置为 True，在执行完成时设置为 False。现在您只需在基类中为 OnCloseQuery 添加一个处理程序，如果成员（例如 fExecuting）为 True，则将 CanClose 设置为 False。您可以静默禁止关闭，或显示信息框。我只是在状态栏中显示进度表或显示某些内容，以免使用模式信息框过多地打扰用户。

我肯定会做的是允许用户取消长时间运行的过程。因此，您还可以显示一个消息框，询问用户是否要取消操作并关闭。您仍然需要跳过关闭表单，但可以存储关闭请求，并在执行结束后处理它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T09:30:06.443

每个表单都有一个 OnCloseQuery 事件。

```
procedure TForm1.FormCloseQuery(Sender: TObject; var CanClose: Boolean); 
```

您可以通过将 CanClose 设置为 False 来使用它来推迟关闭。

您需要决定是否要在处理完成之前处理关闭。或者您可能要求用户再次关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T11:24:39.553

以 MDI 形式引入私有字段，例如。**F加工**

在数据库调用代码中做：

```
FProcessing := true;
try
  i := 0;  
  if (i mod 25) = 0 then
  begin
    // do your code 
    Application.ProcessMessages; 
  end;
finally
  FProcessing := false; 
end; 
```

在**MDIForm.FormCloseQuery()**做

```
procedure TMDIForm.FormCloseQuery(Sender: TObject; var CanClose: Boolean);
begin
  if FProcesing then 
    CanClose := False;  
   // or you can ask user to stop fetching db data
end; 
```

您还应该检查整个应用程序终止。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T12:00:21.320

我创建了一个对象，它可以在不使用线程的情况下为您执行过程或方法。它使用一个计时器，但只公开一个简单的单行调用。它还支持 RTTI，因此您只需单击按钮即可：

ExecuteMethodProc( MyCode ) 或 ExecuteMethodName( 'MyCode' );

问候，布赖恩

```
// Method execution
//-----------------------------------------------------------------------------

type
  TArtMethodExecuter = class( TObject )
    constructor Create;
    destructor  Destroy; override;
  PRIVATE

    FMethod           : TProcedureOfObject;
    FTimer            : TTimer;
    FBusy             : boolean;
    FFreeAfterExecute : boolean;
    FHandleExceptions : boolean;

    procedure DoOnTimer( Sender : TObject );
    procedure SetBusy( AState : boolean );

  PUBLIC
    procedure ExecuteMethodProc(
                AMethod       : TProcedureOfObject;
                AWait         : boolean = False );

    procedure ExecuteMethodName(
                AMethodObject : TObject;
          const AMethodName   : string;
                AWait         : boolean = False );

    property  FreeAfterExecute : boolean
                read FFreeAFterExecute
                write FFreeAfterExecute;

    property  HandleExceptions : boolean
                read FHandleExceptions
                write FHandleExceptions;

    property  Busy : boolean
                read FBusy;

  end;

procedure ExecuteMethodName(
            AMethodObject : TObject;
     const  AMethodName    : string;
            AHandleExceptions : boolean = True );
// Executes this method of this object in the context of the application.
// Returns immediately, with the method executing shortly.

procedure ExecuteMethodProc(
            AMethodProc : TProcedureOfObject;
            AHandleExceptions : boolean = True );
// Executes this method of this object in the context of the application.
// Returns immediately, with the method executing shortly.

function  IsExecutingMethod : boolean;
// Returns TRUE if we are already executing a method.

// End method execution
//-----------------------------------------------------------------------------

// Method execution
//-----------------------------------------------------------------------------

{ TArtMethodExecuter }

var
  iMethodsExecutingCount : integer = 0;

const
  wm_ExecuteMethod = wm_User;

constructor TArtMethodExecuter.Create;
begin
  Inherited;
end;

destructor TArtMethodExecuter.Destroy;
begin
  FreeAndNil( FTimer );
  Inherited;
end;

procedure TArtMethodExecuter.DoOnTimer( Sender : TObject );

  procedure RunMethod;
  begin
    try
      FMethod
    except
      on E:Exception do
        ArtShowMessage( E.Message );
    end
  end;

begin
  FreeAndNil(FTimer);
  try
    If Assigned( FMethod ) then
      RunMethod
     else
      Raise EArtLibrary.Create(
        'Cannot execute method - no method defined.' );
  finally
    SetBusy( False );
    If FFreeAfterExecute then
      Free;
  end;
end;

procedure TArtMethodExecuter.SetBusy(AState: boolean);
begin
  FBusy := AState;

  If AState then
    Inc( iMethodsExecutingCount )
   else
    If iMethodsExecutingCount > 0 then
      Dec( iMethodsExecutingCount )
end;

procedure TArtMethodExecuter.ExecuteMethodProc(
          AMethod       : TProcedureOfObject;
          AWait         : boolean = False );
begin
  SetBusy( True );
  FMethod         := AMethod;
  FTimer          := TTimer.Create( nil );
  FTimer.OnTimer  := DoOnTimer;
  FTimer.Interval := 1;
  If AWait then
    While FBusy do
      begin
      Sleep( 100 );
      Application.ProcessMessages;
      end;
end;

procedure TArtMethodExecuter.ExecuteMethodName(AMethodObject: TObject;
  const AMethodName: string; AWait: boolean);
var
  RunMethod : TMethod;
begin
  RunMethod.code := AMethodObject.MethodAddress( AMethodName );
  If not Assigned( RunMethod.Code ) then
    Raise EArtLibrary.CreateFmt(
      'Cannot find method name "%s". Check that it is defined and published.', [AMethodName] );

  RunMethod.Data := AMethodObject;
  If not Assigned( RunMethod.Data ) then
    Raise EArtLibrary.CreateFmt(
      'Method object associated with method name "%s" is not defined.', [AMethodName] );

  ExecuteMethodProc(
    TProcedureOfObject( RunMethod ),
    AWait );
end;

procedure ExecuteMethodName(
            AMethodObject : TObject;
      const AMethodName   : string;
            AHandleExceptions : boolean = True );
// Executes this method of this object in the context of the application.
// Returns immediately, with the method executing shortly.
var
  ME : TArtMethodExecuter;
begin
  If IsExecutingMethod then
    If AHandleExceptions then
      begin
      ArtShowMessage( 'A method is already executing.' );
      Exit;
      end
     else
      Raise EArtLibrary.Create( 'A method is already executing.' );

  ME := TArtMethodExecuter.Create;
  ME.FreeAfterExecute := True;
  ME.HandleExceptions := AHandleExceptions;
  ME.ExecuteMethodName( AMethodObject, AMethodName );
end;

procedure ExecuteMethodProc(
            AMethodProc : TProcedureOfObject;
            AHandleExceptions : boolean = True );
// Executes this method of this object in the context of the application.
// Returns immediately, with the method executing shortly.
var
  ME : TArtMethodExecuter;
begin
  If IsExecutingMethod then
    If AHandleExceptions then
      begin
      ArtShowMessage( 'A method is already executing.' );
      Exit;
      end
     else
      Raise EArtLibrary.Create( 'A method is already executing.' );

  ME := TArtMethodExecuter.Create;
  ME.FreeAfterExecute := True;
  ME.HandleExceptions := AHandleExceptions;
  ME.ExecuteMethodProc( AMethodProc );
end;

function  IsExecutingMethod : boolean;
// Returns TRUE if we are already executing a method.
begin
  Result := iMethodsExecutingCount > 0;
end;

// End Method execution
//----------------------------------------------------------------------------- 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T19:42:44.587

如果用户因为操作时间太长而想放弃，他们为什么不让他们呢？稍微修改您的代码以检查（在 application.process 消息是一个好地方之前）“想要退出”变量，当它为真时，从循环中退出，释放您的对象并取消。然后将其包装在 dmajkic 之前建议的内容中。

# sqlite - 如何压缩小字符串

> ID：479218
> 
> 赞同：11
> 
> 时间：2009-01-26T09:26:59.743
> 
> 标签：sqlite, compression

我有一个包含大量 URL 的 sqlite 数据库，它占用了大量的磁盘空间，访问它会导致许多磁盘搜索并且速度很慢。平均 URL 路径长度为 97 字节（主机名重复很多，所以我将它们移动到外键表中）。有什么好的压缩方法吗？大多数压缩算法适用于大文档，而不是平均小于 100 字节的“文档”，但即使减少 20% 也会非常有用。任何可以工作的压缩算法？不一定是标准的。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T09:39:42.197

使用压缩算法，但使用共享字典。

在我使用 LZC/LZW 算法之前，我已经做过类似的事情，就像 Unix compress 命令所使用的那样。

使用短字符串获得良好压缩的技巧是使用由您正在压缩的 URL 的标准样本组成的字典。

你应该很容易得到 20%。

编辑：LZC 是 LZW 的变体。您只需要 LZW，因为您只需要一个静态字典。LZC 添加了对在字典/表满时重置的支持。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-01T11:27:53.680

我已经尝试过使用以下策略。它使用的是共享字典，但使用 python 的 zlib 的方式不会让您访问字典本身。

首先，通过运行一堆训练字符串来初始化一个预训练的压缩器和解压缩器。丢弃输出字符串。

然后，使用经过训练的压缩器的副本来压缩每个小字符串，并使用解压器的副本来解压它们。

这是我的python代码（为丑陋的测试道歉）：

```
 import zlib
    class Trained_short_string_compressor(object):
        def __init__(self,
                     training_set, 
                     bits = -zlib.MAX_WBITS,
                     compression = zlib.Z_DEFAULT_COMPRESSION,
                     scheme = zlib.DEFLATED):
            # Use a negative number of bits, so the checksum is not included.
            compressor = zlib.compressobj(compression,scheme,bits)
            decompressor = zlib.decompressobj(bits)
            junk_offset = 0
            for line in training_set:
                junk_offset += len(line)
                # run the training line through the compressor and decompressor
                junk_offset -= len(decompressor.decompress(compressor.compress(line)))

            # use Z_SYNC_FLUSH. A full flush seems to detrain the compressor, and 
            # not flushing wastes space.
            junk_offset -= len(decompressor.decompress(compressor.flush(zlib.Z_SYNC_FLUSH)))

            self.junk_offset = junk_offset
            self.compressor = compressor
            self.decompressor = decompressor

        def compress(self,s):
            compressor = self.compressor.copy()
            return compressor.compress(s)+compressor.flush()

        def decompress(self,s):
            decompressor = self.decompressor.copy()
            return (decompressor.decompress(s)+decompressor.flush())[self.junk_offset:] 
```

测试它，我在一堆 10,000 个短（50 -> 300 个字符）的 unicode 字符串上节省了 30% 以上。压缩和解压缩它们也需要大约 6 秒（相比之下，使用简单的 zlib 压缩/解压缩大约需要 2 秒）。另一方面，简单的 zlib 压缩节省了大约 5%，而不是 30%。

```
def test_compress_small_strings():
    lines =[l for l in gzip.open(fname)]
    compressor=Trained_short_string_compressor(lines[:500])

    import time
    t = time.time()
    s = 0.0
    sc = 0.
    for i in range(10000):
        line = lines[1000+i] # use an offset, so you don't cheat and compress the training set
        cl = compressor.compress(line)
        ucl = compressor.decompress(cl)
        s += len(line)
        sc+=len(cl)
        assert line == ucl

    print 'compressed',i,'small strings in',time.time()-t,'with a ratio of',s0/s
    print 'now, compare it ot a naive compression '
    t = time.time()
    for i in range(10000):
        line = lines[1000+i]
        cr = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION,zlib.DEFLATED,-zlib.MAX_WBITS)
        cl=cr.compress(line)+cr.flush()
        ucl = zlib.decompress(cl,-zlib.MAX_WBITS)
        sc += len(cl)
        assert line == ucl

    print 'naive zlib compressed',i,'small strings in',time.time()-t, 'with a ratio of ',sc/s 
```

Note, it's not persistent if you delete it. If you wanted persistence, you would have to remember the training set.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T09:46:21.217

您是否考虑过使用*静态* [霍夫曼编码](http://en.wikipedia.org/wiki/Huffman_coding)？

您可以使用现有的 URL 正文根据其频率计算 URL 中出现的所有字节的 Huffmann 代码。然后，您可以存储该组代码一次，并使用它对所有 URL 进行编码。我认为它应该提供不错的压缩。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T09:55:25.130

### 您的 URL 的格式是什么？

如果任何 URL 共享一个或多个域，并且您拥有大约 20 亿个域名就足够了，您可以为域名创建一个池。如果您有共享的相对路径，您可以将它们汇集到其中。

对于数据库中的每个 URL，将每个 URL 分成三个部分。方案和域，例如[http://mydomain.com](http://mydomain.com)真实 url /my/path/ 然后其余的 mypage.html?id=4 （如果您有查询字符串参数）

这样，您应该将每个域和相对路径的开销减少到大约 8 个字节。如果您想查找 URL 的某些部分，那应该会更好、更快。

### 注意：只有“http”方案字符串本身是 4 个字节，您将在每个域条目上保存除此之外的任何内容。如果每个 URL 都以“ [http://www](http://www) ”开头。您将保存“://www.” 每次 7 个字节。

对如何拆分和构造 URL 进行一些实验，我敢打赌这是你会发现你的压缩。现在，剩下的不是公共域或相对路径的字符串，你能用它做什么？

### 压缩 URL

通用压缩这种方法源自算术编码。信息论之父香农在 60 年代写了一篇关于此的论文。我从事压缩工作已有一段时间了，而我一直发现的一件事是，通用压缩永远无法解决实际问题。

您很幸运，因为 URL 具有结构，并且您应该利用该结构来更好地存储 URL。

如果您想应用压缩算法（我认为应该更改主题以反映 URL 压缩，因为它是特定于域的），您必须检查数据的熵。因为它会告诉你一些关于存储产量的信息。URL 是 ASCII 字符，任何不在 ASCII 范围 0x20-0x7E 内的字符都不会出现，并且不会区分大小写，您只需要 63 个不同的状态。!"#%&'()*+,-./0123456789:;<=>?@abcdefghijklmnopqrstuvwxyz{|}~ 包括空格。

您可以创建剩余字符的频率表并执行算术编码。您知道您最多需要 6 位，这意味着对于您的 URL 数据库中的每个字符，您现在正在浪费 2 位，如果您只是将内容转移到位并使用查找表，您将得到您的20% 压缩。就这样;)

由于数据非常具体，因此仅使用通用方法进行压缩并不是一个好主意。最好将信息结构化并将其拆分为可以更有效地存储的数据片段。您对领域有很多了解，使用这些知识来压缩您的数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T11:10:07.617

**抽象的：**

大型搜索引擎和网络蜘蛛的一个常见问题是如何处理大量遇到的 URL。传统的搜索引擎和网络蜘蛛使用硬盘来存储 URL，无需任何压缩。这会导致性能下降和更多的空间需求。本文描述了一种简单的 URL 压缩算法，可实现高效的压缩和解压缩。压缩算法基于增量编码方案来提取共享公共前缀的 URL 和 AVL 树以获得有效的搜索速度。我们的结果表明，实现了 50% 的尺寸减小。1.

-- Kasom Koht-arsa 计算机工程系。

**[资源](http://anres.cpe.ku.ac.th/pub/url-compression-ncsec.pdf)**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T10:04:32.397

那是 97 个字节，还是 97 个 8 位 ASCII 字符，还是 97 个 16 位 Unicode 字符？

假设您的所有 URL 都是[http://www.w3.org/Addressing/URL/url-spec.txt](http://www.w3.org/Addressing/URL/url-spec.txt)的合法 URL ，那么您应该只有 ASCII 字符。

如果 97 个 16 位 Unicode 字符简单地存储每个字符的低字节将自动为您节省 50%。

如果是 97 个 8 位字符，请注意您只需要 7 位。您可以一次简单地将 7 位传递到您的比特流中，并将该比特流存储到您的数据库中；使用一些较旧的 7 位传输协议；或者想出您自己的临时方法，将每 8 个字符的位存储在前 7 个字符的高位中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T11:04:02.933

如何使用 URL 表？

您通常只进行“范围扫描”或唯一 ID 查找吗？

如果你不做类似的事情`WHERE url like "/xxxx/question/%"`。您可以在 varchar() 上使用散列索引而不是 b 树索引来减少磁盘查找次数。

# php - 拒绝没有启用 javascript 的浏览器使用我的 php 网站

> ID：479223
> 
> 赞同：1
> 
> 时间：2009-01-26T09:30:37.863
> 
> 标签：php, javascript, dojo

我用 PHP 编写了一个相当小的 Web 应用程序，并打算使用 DOJO 使其“花哨”，并且很可能在客户端处理一些验证（也会有服务器端验证）。

我想让 JavaScript 成为我的网站的一项要求，因此，如果用户的浏览器禁用了 JavaScript，或者不支持 JavaScript，他们应该根本无法使用该网站，并收到一条消息通知他们这个要求。

我见过其他网站这样做，但我不知道如何执行它。
例如，尝试在此处使用 username=user 和 password=user
[http://demo.actitime.com/login.do?username=user登录](http://demo.actitime.com/login.do?username=user)

然后我希望在每一页上都发生同样的事情。

任何帮助表示赞赏。

奥奇索

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-26T09:35:44.030

我不认为这是一个明智的做法。

只需在网站上多花点力气，这样没有 javascript 的用户也可以访问该网站。不要忘记他们是您的客户。他们可能有充分的理由禁用 javascript。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T09:59:09.817

你知道，这一年是 2009 年，而不是 1997 年。这些黑客属于过去，死了，被埋葬了，就像他们曾经的污秽一样。

至于一个有用的答案：阅读[优雅](http://en.wikipedia.org/wiki/Graceful_degradation) [退化](http://webtips.dan.info/graceful.html)。

至于您的回答：CSS 可以完成您使用 DOJO 所做的事情，而无需 Javascript（至少，您提到的事情）。如果未启用 javascript，它将需要往返服务器，仅此而已。我不知道您所说的“逻辑”是什么意思，但是使用 PHP 和可能的模板系统比使用 javascript 更好地完成该术语的规范意义。

没有往返的输入验证很好，但如果我没有 javascript 或不能使用它，服务器验证比 no-frickin-site 更好。

是的，它真的那么糟糕。

编辑：[Sponsz 上校](https://stackoverflow.com/users/11651)指出了[另一个关于优雅降级的有用链接](http://www.alistapart.com/articles/understandingprogressiveenhancement)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T09:40:40.963

对此唯一适当的回应是：“你为什么要这样做？”

确实，更好的方法是先尝试使其工作，然后再添加花哨的 javascript 位。这样，禁用了 javascript 的用户仍然可以使用它，即使它的功能有限。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-26T09:34:42.037

有两件事浮现在脑海：

*   使用`<noscript>`标签作为内容；和
*   对于该网站和类似的功能，不是有一个提交按钮，而是有一个带有 onclick 处理程序的普通按钮：

    <input type="button" onclick="documents.forms[0].submit();" 值="提交">

未启用 Javascript 无法提交。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-04T01:40:59.547

一些高级用户默认禁用 JavaScript，并在每个网站的基础上启用它。我只是警告他们需要 JavaScript 才能走得更远。用于向没有 JS 或禁用 JS 的浏览器显示文本：

```
<noscript>
    <p style="color: Red;">Warning: JavaScript is required to display anything after you login. Please enable JavaScript or use a different browser</p>
</noscript> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T10:37:56.870

只需在您的页面中放置一个脚本，通过使用 Ajax 将数据重定向或提交到启用该变量的页面，在访问您的站点的浏览器中启用会话变量。在下一次单击 y 中，会话没有会话变量，您将其重定向到另一个页面，该页面请求启用 JavaScript 的浏览器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-18T20:30:10.977

The best reason I can think of is to stop people accessing and using forms without java scripted based browsers so hiding from the Counters.

For example if someone decides to spam, even with capcha and hides their isp by not enabling javascript, (alot of counters rely on it), then I think it would be a good idea to ban all non javascript browsers on a website.

In fact I think I will.

Good idea 'occhiso'.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T09:54:32.900

一个原因是我想要一个选项卡式界面——它允许以不同的方式完成相同的任务。“每个选项卡”使用了很多相同的逻辑，所以我不想将它分成单独的页面。

使用 dojo，我可以很容易地实现这一点，方法是将所有内容都放在同一页面上的单独 div 中，然后 dojo 将每个 div 放在它自己的选项卡中。如果没有 JavaScript，您将一次看到所有选项卡（div）。

有一些像这样的小问题，我认为把它作为一个要求，它总是表现得很好，而且那些没有 JavaScript 的人会错过，记住这绝不是一个关键任务站点！

此外，这意味着我可以强制执行输入验证，而无需用户重新加载页面。

真的有那么糟糕吗？

# bash - 如何测试给定路径是否是挂载点

> ID：479226
> 
> 赞同：36
> 
> 时间：2009-01-26T09:33:51.897
> 
> 标签：bash, unix, shell

假设您想测试 /mnt/disk 是否是 shell 脚本中的挂载点。你怎么做到这一点？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-01-27T13:55:40.463

我发现在我的 Fedora 7 上有一个 mountpoint 命令。

从人挂载点：

```
NAME
       mountpoint - see if a directory is a mountpoint

SYNOPSIS
       /bin/mountpoint [-q] [-d] /path/to/directory
       /bin/mountpoint -x /dev/device 
```

显然它带有 sysvinit 包，我不知道这个命令是否在其他系统上可用。

```
[root@myhost~]# rpm -qf $(which mountpoint)
sysvinit-2.86-17 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-28T05:29:04.497

不依赖`mount`, `/etc/mtab`,`/proc/mounts`等：

```
if [ `stat -c%d "$dir"` != `stat -c%d "$dir/.."` ]; then
    echo "$dir is mounted"
else
    echo "$dir is not mounted"
fi 
```

When`$dir`是一个挂载点，它的设备号与其父目录不同。

到目前为止列出的替代方案的好处是您不必解析任何内容，并且如果`dir=/some//path/../with///extra/components`.

缺点是它没有标记`/`为挂载点。好吧，这对于特殊情况来说很容易，但仍然如此。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T12:19:51.577

使用 GNU 查找

```
find <directory> -maxdepth 0 -printf "%D" 
```

将给出目录的设备号。如果目录与其父目录不同，则您有一个挂载点。

添加 /。如果您希望将指向不同文件系统的符号链接计为挂载点（您总是希望它用于父级），则添加到目录名称上。

缺点：使用 GNU 发现移植性较差

优点：报告未记录在 /etc/mtab 中的挂载点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T09:39:09.250

```
if mount | cut -d ' ' -f 3 | grep '^/mnt/disk$' > /dev/null ; then
   ...
fi 
```

编辑：使用 Bombe 的想法来使用 cut。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T17:23:48.780

```
df $path_in_question | grep " $path_in_question$" 
```

这将`$?`在完成时设置。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-13T03:43:34.947

不幸的是，如果您使用自动挂载，mountpoint 和 stat 都会产生*MOUNTING*您正在测试的目录的副作用。或者至少它在 Debian 上使用 auto cifs 到 WD MyBookLive 网络磁盘对我有用。我最终得到了一个更复杂的 /proc/mounts 变体，因为每个*潜在*的挂载都已经在 /proc/mounts 中，即使它没有实际挂载！

```
cut -d ' ' -f 1 < /proc/mounts | grep -q '^//disk/Public$' && umount /tmp/cifs/disk/Public 
```

```
在哪里
   'disk' 是 /etc/hosts 中服务器（网络磁盘）的名称。
   '//disk/Public' 是 cifs 共享名
   '/tmp/cifs' 是我的自动挂载位置（我有 /tmp 作为 RAM 磁盘并且 / 是只读的）
   “/tmp/cifs/disk”是服务器（称为“disk”）运行时创建的普通目录。
   '/tmp/cifs/disk/Public' 是我的 'Public' 共享的挂载点。

```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-26T09:38:53.167

```
for mountedPath in `mount | cut -d ' ' -f 3`; do
    if [ "${mountedPath}" == "${wantedPath}" ]; then
        exit 0
    fi
done
exit 1 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T15:30:44.733

这是一个带有“df -P”的变体，它应该是可移植的：

```
mat@owiowi:/tmp$ f(){ df -P  | awk '{ if($6 == "'$1'")print   }' ; }
mat@owiowi:/tmp$ f /
/dev/mapper/lvm0-vol1  20642428  17141492   2452360      88% /
mat@owiowi:/tmp$ f /mnt
mat@owiowi:/tmp$ f /mnt/media
/dev/mapper/lvm0-media  41954040  34509868   7444172      83% /mnt/media 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-02-26T18:08:29.400

```
mount | awk '$3 == "/pa/th" {print $1}' 
```

如果不是挂载点则为空^^

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-05-13T02:56:19.987

**stat --printf '%m'**显示给定文件或目录的挂载点。

**realpath**将相对路径转换为直接路径。

比较两者的结果将告诉您目录是否是挂载点。 **stat**非常便携。 **realpath**不那么重要，但仅当您想检查相对路径时才需要它。

我不确定安装点的便携**性**如何。

```
if [ "$(stat --printf '%m' "${DIR}")" = "$(realpath "${DIR}")" ]; then
    echo "This directory is a mount point."
else
    echo "This is not a mount point."
fi 
```

没有**realpath**：

```
if [  "${DIR}" = "$(stat --printf '%m' "${DIR}")" ]; then
    echo "This directory is a mount point."
else
    echo "This is not a mount point."
fi 
```

# nunit - 使用 NUnit 和 SVN 配置巡航控制

> ID：479227
> 
> 赞同：1
> 
> 时间：2009-01-26T09:34:36.950
> 
> 标签：nunit, cruisecontrol.net

我正在尝试使用 Nunit 配置 Cruise Control 以进行报告。但我无法完成这项任务。任何人都可以请帮助我如何配置 ccnet.config 文件以进行配置，以及一些简单的分步教程来解释它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T09:47:18.640

您是否使用 MSBuild 或 NAnt 的构建脚本？

我这样做：

*   我有一个构建脚本（msbuild），其中有一个运行我的 NUnit 单元测试的任务这个任务在我的构建脚本中看起来像这样（简化）：

```
<Target Name="rununittests">
    <NUnit Assemblies="$(outputdir)\MyTests.dll"
           OutputXmlFile = "$(artifactdir)\MyTests.Results.xml"/>
</Target> 
```

*   在我的巡航控制项目中，我将此任务称为：

```
 <msbuild>
      <executable>c:\....\msbuild.exe</executable>
      <projectFile>c:\...\mybuildscript</projectFile>
      <targets>rununittests</targets>
      <logger>c:\...\rodemeyer.msbuildtoccnet.dll</logger>
 </msbuild> 
```

RodeMeyer 记录器是我在 CC.NET 网页某处找到的记录器。

*   在我的 CC.NET 项目配置结束时，我确保输出 XML 被合并：

    ```
    <publishers>
    <merge>
       <files>
         <file>...\*.results.xml</file>
       </files>
    </merge>

    <xmllogger/>
    </publishers> 
    ```

# security - 最好的分布式蛮力对策是什么？

> ID：479233
> 
> 赞同：156
> 
> 时间：2009-01-26T09:37:29.067
> 
> 标签：security, authentication, brute-force

首先，一点背景知识：我正在为 CodeIgniter 实现一个 auth+auth 系统，这已经不是什么秘密了，到目前为止我赢了（可以这么说）。但是我遇到了一个非常重要的挑战（大多数身份验证库完全错过的挑战，但我坚持要正确处理它）：如何智能地处理**大规模、分布式、可变用户名暴力攻击**。

我知道所有常用的技巧：

1.  **限制每个 IP/主机的失败尝试次数并拒绝违规者访问（例如 Fail2Ban） -**[由于僵尸网络变得更加智能](http://www.christopher-kunz.de/archives/205-Distributed-and-coordinated-SSH-bruteforce-attacks.html)，这不再有效
2.  将上述内容与**已知的“坏”IP/主机**（例如 DenyHosts）的黑名单相结合——这依赖于僵尸网络落入第一名，[而他们越来越不这样做](http://www.christopher-kunz.de/archives/205-Distributed-and-coordinated-SSH-bruteforce-attacks.html)
3.  **IP/主机白名单**与传统身份验证相结合（遗憾的是，对于动态 IP 用户和大多数网站的高流失率无用）
4.  在 N 分钟/小时内设置**站点范围**内的失败尝试次数限制，并在此之后限制（暂停）所有登录尝试数分钟/小时（问题是 DoS 攻击您成为僵尸网络的小游戏）
5.  没有登录/密码选项的所有用户的强制性**数字签名**（公钥证书）或 RSA 硬件令牌（毫无疑问，这是一个坚如磐石的解决方案，但仅适用于封闭的专用服务）
6.  强制**执行的超强密码方案**（例如 >25 个带有符号的无意义字符 - 再次，对于普通用户来说太不切实际了）
7.  最后，**验证码**（在大多数情况下都可以工作，但对用户来说很烦人，而且对[坚定、足智多谋的攻击者](http://www.slideshare.net/valicac/captcha)[几乎毫无用处](http://caca.zoy.org/wiki/PWNtcha)）

现在，这些只是理论上可行的想法。有*很多*垃圾想法使网站大开（例如，微不足道的 DoS 攻击）。我想要的是更好的东西。更好的是，我的意思是：

*   它必须对 DoS 和蛮力攻击是安全的（+），并且不引入任何可能允许稍微狡猾的机器人继续在雷达下运行的新漏洞

*   它必须是自动化的。如果它需要人工操作员来验证每个登录或监控可疑活动，那么它在现实世界中是行不通的

*   它必须适用于主流 Web 使用（即非程序员可以执行的高流失率、高容量和开放注册）

*   它不能将用户体验阻碍到临时用户会感到恼火或沮丧（并可能放弃该网站）的程度

*   它不能涉及小猫，除非它们*真的是非常安全*的小猫

(+)*所谓“安全”，我的意思是至少与偏执的用户保密密码的能力一样安全*

所以 - 让我们听听吧！*你会怎么做*？你知道我没有提到的最佳实践吗（哦，请说你知道）？我承认我确实有自己的想法（结合 3 和 4 的想法），但在让自己尴尬之前，我会让真正的专家发言；-)

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-01-27T07:17:56.303

将原始帖子中的方法 3 和 4 组合成一种“模糊”或动态白名单，然后——这就是诀窍——*不阻止非白名单 IP，只是将它们限制在地狱和回来*。

> 请注意，此措施*仅*用于阻止这种非常特定类型的攻击。当然，在实践中，它可以与其他最佳实践方法结合使用来进行身份验证：固定用户名限制、每个 IP 限制、代码强制强密码策略、不受限制的 cookie 登录、在保存之前对所有密码等效项进行哈希处理，从不使用安全问题等

**关于攻击场景的假设**

如果攻击者针对可变用户名，我们的用户名限制不会触发。如果攻击者正在使用僵尸网络或访问较大的 IP 范围，我们的 IP 节流将无能为力。如果攻击者预先抓取了我们的用户列表（通常可能在开放注册 Web 服务上），我们就无法根据“未找到用户”错误的数量检测到正在进行的攻击。如果我们在系统范围内实施限制性（所有用户名、所有 IP）限制，任何此类攻击都会在攻击期间加上限制期间对我们的整个站点进行 DoS。

所以我们需要做点别的。

**对策第一部分：白名单**

我们可以相当肯定的是，攻击者无法检测和动态欺骗我们数千名用户的 IP 地址（+）。这使得*白名单*变得可行。换句话说：对于每个用户，我们存储用户之前（最近）登录的（散列的）IP 列表。

因此，我们的白名单方案将起到锁定“前门”的作用，用户必须从他公认的“好”IP 之一连接才能登录。对这个“前门”进行暴力攻击几乎是不可能的（+）。

(+) 除非攻击者“拥有”服务器、我们所有用户的盒子或连接本身——在这种情况下，我们不再有“身份验证”问题，我们有一个真正的特许经营规模的拉动-plug FUBAR 情况

**对策之二：全系统限制*无法识别的IP***

为了使开放注册 Web 服务的白名单工作，用户经常切换计算机和/或从动态 IP 地址连接，我们需要为从无法识别的 IP 连接的用户打开“猫门”。诀窍是设计那个门，让僵尸网络卡住，让合法用户*尽可能少地*受到打扰。

在我的方案中，这是通过对未经批准的 IP 设置*非常*严格的最大登录尝试失败次数来实现的，例如 3 小时（根据服务类型，使用更短或更长的时间段可能更明智），并且使该限制**全局化**，即。适用于所有用户帐户。

使用这种方法，即使是缓慢的（尝试之间 1-2 分钟）蛮力也会被检测到并快速有效地阻止。当然，一个*非常慢*的蛮力仍然可能被忽视，但是太慢的速度会破坏蛮力攻击的目的。

我希望通过这种节流机制实现的是，如果达到最大限制，我们的“猫门”会关闭一段时间，但我们的前门仍然对通过常规方式连接的合法用户开放：

*   通过从他们认可的 IP 之一连接
*   或者通过使用持久登录 cookie（从任何地方）

在攻击期间会受到影响的唯一合法用户 - 即。在激活限制时 - 将是没有持久登录 cookie 的用户，他们从未知位置或使用动态 IP 登录。这些用户将无法登录，直到限制消失（这可能需要一段时间，如果攻击者在限制的情况下保持他的僵尸网络运行）。

为了让这一小部分用户能够挤过原本密封的猫门，即使机器人仍在敲门，我会使用带有验证码的“备份”登录表单。因此，当您显示“对不起，但您目前无法从该 IP 地址登录”消息时，请包含一个链接，上面写着“**安全备份登录 - 仅限人类（*机器人：不撒谎*）** ”。开个玩笑，当他们单击该链接时，给他们一个 reCAPTCHA 身份验证的登录表单，绕过站点范围的限制。这样，如果他们是人类并且知道正确的登录名+密码（并且能够读取验证码），他们将**永远不会**被拒绝服务，即使他们是从未知主机连接并且不使用自动登录 cookie。

哦，只是澄清一下：由于我确实认为 CAPTCHA 通常是邪恶的，因此“备份”登录选项**只会***在节流处于活动状态时*出现。

不可否认，像这样的持续攻击仍然会构成 DoS 攻击的一种形式，但是在所描述的系统到位后，它只会影响我怀疑的一小部分用户，即不使用“记住我” cookie 并且碰巧在攻击发生时登录并且没有从他们的任何常用 IP 登录并且无法读取验证码。只有那些可以对所有这些标准说不的人——特别是机器人和*真正不幸*的残疾人——才会在机器人攻击期间被拒之门外。

> ***编辑：**实际上，我想了一种方法，让即使是受到验证码挑战的用户在“锁定”期间也能通过：代替或作为备份验证码登录的补充，为用户提供一次性使用的选项，用户特定的锁定代码发送到他的电子邮件，然后他可以使用它来绕过限制。这肯定超过了我的“烦恼”阈值，但由于它仅用作一小部分用户的**最后手段**，而且它仍然比被锁定在您的帐户之外更好，所以它是可以接受的。*

（另外，请注意，如果攻击比我在此处描述的讨厌的分布式版本更复杂，则**不会**发生这种情况。如果攻击仅来自几个 IP 或仅攻击几个用户名，它将在更早的时候被挫败，并且***没有***站点范围的后果）

* * *

所以，这就是我将在我的 auth 库中实施的对策，一旦我确信它是合理的并且我没有错过一个更简单的解决方案。事实是，有很多微妙的方法可以在安全方面做错事，而且我不会做出错误的假设或无可救药的错误逻辑。因此，请高度赞赏任何和所有反馈、批评和改进、细微之处等。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-28T01:04:32.110

几个简单的步骤：

将某些常用用户名列入黑名单，并将其用作蜜罐。管理员、访客等...不要让任何人使用这些名称创建帐户，因此，如果有人确实尝试将其登录，您就会知道这是某人在做他们不应该做的事情。

确保在网站上拥有真正权力的任何人都拥有安全密码。要求管理员/版主使用更长的密码，混合字母、数字和符号。拒绝普通用户的简单密码并给出解释。

您可以做的最简单的事情之一是告诉人们何时有人尝试登录他们的帐户，如果不是他们，则给他们一个链接以报告事件。他们登录时的一条简单消息，例如“有人试图在星期三凌晨 4:20 登录您的帐户等等等等。如果这不是您，请单击此处。” 它使您可以保留一些有关攻击的统计信息。如果您发现欺诈性访问突然增加，您可以加强监控和安全措施。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-26T15:44:27.313

如果我正确理解暴力攻击的 MO，那么会不断尝试一个或多个用户名。

有两个我认为我还没有在这里看到的建议：

*   我一直认为标准做法是在每个用户每次错误登录后有一个短暂的延迟（一秒左右）。这可以阻止蛮力，但我不知道一秒钟的延迟会阻止字典攻击多长时间。（10,000 个单词的字典 == 10,000 秒 == 大约 3 小时。嗯。不够好。）
*   而不是整个站点的减速，为什么不使用用户名限制。每次错误尝试都会使油门变得越来越苛刻（我猜是有限制的，所以真正的用户仍然可以登录）

**编辑**：回应对用户名限制的评论：这是一个特定于用户名的限制，不考虑攻击的来源。

如果用户名受到限制，那么即使是协调的用户名攻击（多 IP、每个 IP 单一猜测、相同的用户名）也会被捕获。即使攻击者在超时期间可以自由尝试另一个用户/通行证，个人用户名也受到限制。

从攻击者的角度来看，在超时期间，您可能能够第一次猜测 100 个密码，并迅速发现每个帐户的一个错误密码。您可能只能对同一时间段进行 50 秒的猜测。

从用户帐户的角度来看，破解密码仍然需要相同的平均猜测次数，即使猜测来自多个来源。

对于攻击者来说，破解 100 个帐户的努力与破解 1 个帐户的努力相同，但由于您不是在整个站点范围内进行限制，因此您可以非常快速地提高限制。

额外改进：

*   检测猜测多个帐户的 IP - 408 请求超时
*   检测猜测同一帐户的 IP - 在大量（例如 100 次）猜测后出现 408 请求超时。

UI 想法（可能不适合这种情况），这也可能对上述内容进行细化：

*   如果您可以控制密码设置，那么向用户[展示他们的密码强度会](http://en.blog.wordpress.com/2007/06/07/how-strong-is-your-password/)鼓励他们选择更好的密码。
*   如果您可以控制登录*页面*，在对单个用户名进行少量（例如 10 次）猜测后，提供验证码。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-27T00:15:20.933

身份验证的三个因素：

1.  用户**知道**某事（即密码）
2.  用户**有**东西（例如，钥匙扣）
3.  用户**是**某物（即视网膜扫描）

通常，网站只执行策略#1。甚至大多数银行也只执行策略 1。相反，它们依赖于“知道其他东西”的方法来进行双因素身份验证。（即：用户知道他们的密码和他们母亲的娘家姓。）如果可以的话，添加第二个身份验证因素的方法并不太难。

如果您可以生成大约 256 个随机字符，您可以将其构建在 16×16 的表格中，然后要求用户在单元格 A-14 的表格中为您提供值。当用户注册或更改密码时，给他们表格并告诉他们打印并保存。

这种方法的困难在于，当用户忘记密码时，你不能只提供标准的“回答这个问题并输入新密码”，因为这也容易受到暴力破解。此外，您无法重置它并通过电子邮件向他们发送新的电子邮件，因为他们的电子邮件也可能被泄露。（参见：Makeuseof.com 和他们被盗的域名。）

另一个想法（涉及小猫）是 BOA 所说的 SiteKey（我相信他们为这个名字注册了商标）。简而言之，您让用户在注册时上传一张图片，当他们尝试登录时，请他们从 8 或 15 个（或更多）随机图片中挑选他们的图片。因此，如果用户上传了他们小猫的照片，理论上只有他们知道在所有其他小猫（或鲜花或其他任何东西）中哪张照片是他们的。这种方法唯一真正的漏洞是中间人攻击。

另一个想法（虽然没有小猫）是跟踪用户访问系统的 IP，并要求他们在从他们拥有的地址登录时执行额外的身份验证（验证码、选择小猫、从该表中选择密钥）之前没有。此外，与 GMail 类似，允许用户查看他们最近登录的位置。

编辑，新想法：

另一种验证登录尝试的方法是检查用户是否来自您的登录页面。您无法检查推荐人，因为它们很容易被伪造。您需要在用户查看登录页面时在 _SESSION var 中设置一个密钥，然后在提交登录信息时检查以确保该密钥存在。如果 bot 没有从登录页面提交，它将无法登录。您还可以通过在过程中使用 javascript 来促进这一点，或者通过使用它来设置 cookie，或者在表单加载后向表单添加一些信息。或者，您可以将表单分成两个不同的提交（即，用户输入他们的用户名，提交，然后在新页面上输入他们的密码并再次提交。）

在这种情况下，关键是最重要的方面。生成它们的常用方法是用户数据、他们的 IP 和提交时间的某种组合。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-07-19T11:21:08.533

我之前在[如何限制 PHP 中的用户登录尝试中](https://stackoverflow.com/questions/2090910/how-can-i-throttle-user-login-attempts-in-php)回答了一个非常相似的问题。我将在这里重申建议的解决方案，因为我相信你们中的许多人会发现查看一些实际代码很有用。请记住，由于现在 CAPTCHA busters 中使用的算法越来越准确，因此使用 CAPTCHA 可能不是最佳解决方案：

**您不能简单地通过将限制链接到单个 IP 或用户名来防止 DoS 攻击。见鬼，你甚至不能用这种方法真正阻止快速登录尝试。**

***为什么？*** *因为为了绕过您的限制尝试，攻击可以跨越多个 IP 和用户帐户。*

我在其他地方看到过，理想情况下，您应该跟踪整个站点的所有失败登录尝试，并将它们与时间戳相关联，也许：

```
CREATE TABLE failed_logins(
    id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(16) NOT NULL,
    ip_address INT(11) UNSIGNED NOT NULL,
    attempted DATETIME NOT NULL
) engine=InnoDB charset=UTF8; 
```

根据给定时间内登录失败的*总数*确定某些延迟。您应该基于从您的`failed_logins`表格中提取的统计数据，因为它会根据用户数量以及他们中有多少人可以回忆（和输入）他们的密码而*随时间变化。*

* * *

```
10 failed attempts = 1 second
20 failed attempts = 2 seconds
30 failed attempts = reCaptcha 
```

* * *

查询每次失败登录尝试的表，以查找给定时间段内失败的登录次数，例如 15 分钟：

* * *

```
SELECT COUNT(1) AS failed FROM failed_logins WHERE attempted > DATE_SUB(NOW(), INTERVAL 15 minute); 
```

* * *

如果在给定时间段内的尝试次数超过您的限制，则强制限制或强制所有用户使用验证码（即 reCaptcha），直到在给定时间段内的失败尝试次数小于阈值。

```
// array of throttling
$throttle = array(10 => 1, 20 => 2, 30 => 'recaptcha');

// assume query result of $sql is stored in $row
$sql = 'SELECT MAX(attempted) AS attempted FROM failed_logins';
$latest_attempt = (int) date('U', strtotime($row['attempted']));
// get the number of failed attempts
$sql = 'SELECT COUNT(1) AS failed FROM failed_logins WHERE attempted > DATE_SUB(NOW(), INTERVAL 15 minute)';
// assume the number of failed attempts was stored in $failed_attempts
krsort($throttle);
foreach ($throttle as $attempts => $delay) {
    if ($failed_attempts > $attempts) {
        // we need to throttle based on delay
        if (is_numeric($delay)) {
            $remaining_delay = time() - $latest_attempt - $delay;
            // output remaining delay
            echo 'You must wait ' . $remaining_delay . ' seconds before your next login attempt';
        } else {
            // code to display recaptcha on login form goes here
        }
        break;
    }
} 
```

在某个阈值下使用 reCaptcha 可以确保*最大限度地减少*来自多个方面的攻击，并且正常的站点用户不会因为合法的失败登录尝试而经历明显的延迟。我不能保证预防，因为它已经扩展到验证码可以被破坏。有替代解决方案，也许是“命名这种动物”的变体，它可以很好地替代。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-28T22:40:02.603

我不得不问你是否对这个问题进行了成本效益分析；听起来您正试图保护自己免受攻击者的攻击，该攻击者拥有足够的网络存在来猜测多个密码，每个 IP 可能发送 3-5 个请求（因为您已经解除了 IP 限制）。这种攻击需要多少（大约）成本？它是否比您要保护的帐户的价值更昂贵？有多少庞大的僵尸网络想要你拥有的东西？

答案可能是否定的——但如果是的话，我希望你能从某种安全专家那里得到帮助；编程技能（和 StackOverflow 分数）与安全知识的相关性并不强。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-28T22:14:23.170

将 Jens 的方案总结为伪状态转换图/规则库：

1.  用户 + 密码 -> 输入
2.  用户 + !password -> 拒绝
3.  用户 + known_IP(user) -> 前门，`// never throttle`
4.  用户 + 未知 IP（用户）-> catflap
5.  (#denied > n) 通过 catflaps(site) -> 节流 catflaps(site)`// slow the bots`
6.  catflap + 油门 + 密码 + 验证码 -> 输入`// humans still welcome`
7.  catflap + 油门 + 密码 + !captcha -> 拒绝`// a correct guess from a bot`

观察：

*   切勿节流前门。Elbonian 州警察在你家里有你的电脑，但无法审讯你。蛮力是您计算机上一种可行的方法。
*   如果您提供“忘记密码？” 链接，然后您的电子邮件帐户将成为攻击面的一部分。

这些观察涵盖了与您试图反击的攻击不同类型的攻击。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-26T10:04:21.757

看起来您正试图防御[缓慢的分布式蛮力](http://bsdly.blogspot.com/2008/12/low-intensity-distributed-bruteforce.html)。您对此无能为力。我们使用的是 PKI，没有密码登录。它会有所帮助，但如果您的客户每隔一段时间就有机会使用工作站，那么这不是很适用。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-07-29T05:33:09.667

免责声明：我在一家双因素公司工作，但我不是来阻止它的。这里有一些观察。

Cookie 可以通过 XSS 和浏览器漏洞窃取。用户通常会更改浏览器或清除其 cookie。

源 IP 地址同时是动态可变的和可欺骗的。

验证码很有用，但不能验证特定的人。

多种方法可以组合成功，但好的口味当然是为了。

密码复杂性很好，任何基于密码的东西都严重依赖于具有足够熵的密码。恕我直言，写在安全物理位置的强密码比内存中的弱密码更好。人们知道如何评估纸质文件的安全性比知道如何计算他们的狗名中的有效熵要好得多，因为它们将狗名用作三个不同网站的密码。考虑让用户能够打印出包含一次性使用密码的大页面或小页面。

诸如“你的高中吉祥物是什么”之类的安全问题大多是“你知道的东西”的另一种糟糕的形式，其中大多数在公共领域很容易被猜到或直接出现。

正如您所指出的，限制失败的登录尝试是在防止暴力攻击和易于 DoSing 帐户之间进行权衡。激进的锁定策略可能反映了对密码熵缺乏信心。

无论如何，我个人并不认为在网站上强制密码过期有什么好处。攻击者一旦获得您的密码，他就可以更改密码并尽可能轻松地遵守该策略。也许一个好处是，如果攻击者更改帐户密码，用户可能会更快注意到。如果在攻击者获得访问权限之前以某种方式通知用户，那就更好了。在这方面，诸如“自上次登录以来的 N 次失败尝试”之类的消息很有用。

最好的安全性来自第二个身份验证因素，它相对于第一个身份验证是带外的。就像您说的那样，“您拥有的东西”中的硬件令牌很棒，但是许多（不是全部）具有与其分发相关的实际管理开销。我不知道任何适合网站的生物识别“你是什么”解决方案。一些双因素解决方案与 openid 提供程序一起使用，一些具有 PHP/Perl/Python SDK。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-26T10:37:30.897

1.  在输入正常密码之前要求一次性密码怎么样？这会很明显有人在他们有很多机会猜测主密码之前就在攻击？

2.  保持登录失败的全局计数/比率 - 这是攻击的指标 - 在攻击期间对登录失败更严格，例如更快地禁止 IP。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-10T15:59:56.780

我的最高建议是简单地确保**让用户了解**他们的帐户的错误登录尝试 - 如果向用户提供有人实际上试图进入他们的帐户的证据，他们可能会更加认真地对待他们的密码强度.

实际上，我发现有人入侵了我兄弟的 myspace 帐户，因为他们试图进入我为他设置的 gmail 帐户并使用“通过电子邮件重置我的密码”功能......进入了我的收件箱。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-27T01:17:42.787

我不相信有一个完美的答案，但我倾向于在感应到攻击时试图混淆机器人的基础上接近它。

我的脑海中浮现：

切换到备用登录屏幕。它有多个确实出现的用户名和密码空白，但只有一个在正确的位置。字段名称是*随机*的——会话密钥与登录屏幕一起发送，然后服务器可以找出哪些字段是什么。成功或失败都会被丢弃，因此您无法尝试重放攻击——如果您拒绝密码，他们将获得一个新的会话 ID。

任何在错误字段中提交数据的表单都被假定为来自机器人——登录失败、期间以及该 IP 被限制。确保随机字段名称永远不会与合法字段名称匹配，这样就不会误导使用记住密码的东西的人。

接下来，另一种验证码怎么样：您有一系列不会对人类造成问题的问题。但是，它们*不是*随机的。当攻击开始时，每个人都会收到问题 #1。一个小时后，问题#1 被丢弃，不再使用，每个人都得到问题#2，依此类推。

由于问题的一次性性质，攻击者无法探测下载数据库以放入他的机器人中。他必须在一小时内向他的僵尸网络发送新指令，才能有能力做任何事情。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-05T22:25:37.127

由于有几个人将 CAPTCHA 作为后备人工机制，我添加了一个较早的 StackOverflow 问题和关于 CAPTCHA 有效性的线程。

[reCaptcha 是否被破解/被黑/OCR'd/被击败/被破坏？](https://stackoverflow.com/questions/448963/has-recaptcha-been-cracked-hacked-ocrd-defeated-broken)

使用 CAPTCHA 不会限制您的限制和其他建议的改进，但我认为将 CAPTCHA 作为后备的答案的数量应该考虑那些希望破坏安全性的人可用的基于人的方法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-27T04:11:08.673

您还可以根据用户密码的强度进行节流。

当用户注册或更改他们的密码时，您会计算他们密码的强度等级，比如 1 到 10 之间。

诸如“密码”之类的得分为 1，而“c6eqapRepe7et*Awr@ch”可能得分为 9 或 10，得分越高，启动节流所需的时间就越长。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-01-12T07:55:28.560

当我问这个问题时，我通常听到的第一个答案是更改端口，但忘记这一点，只需禁用 IPv4。如果您只允许来自 IPv6 网络的客户端，您将不再祈祷简单的网络扫描，攻击者将求助于 DNS 查找。不要在与你的 Apache(AAAA)/Sendmail(MX->AAAA)/你给每个人 (AAAA) 的地址相同的地址上运行。确保您的区域不能被 xferd，等待您允许任何人下载您的区域？

如果机器人发现你的服务器设置了新的主机名，只需在你的主机名前加上一些乱码，然后更改你的地址。保留旧名称，甚至设置 **honeypot 名称以使僵尸网络超时。

** 测试您的反向（PTR）记录（在 ip6.arpa 下），看看它们是否可以用于在有记录的 /4 上归零，而在没有记录的 /4 上。IE 通常 ip6.arpa 将在一个地址中有大约 32 个“.”，但尝试丢失最后几个可能会避开具有记录的网络块与其他没有记录的网络块。如果您更进一步，则可以跳过大部分地址空间。

在最坏的情况下，用户将不得不设置 IPv6 隧道，这不像他们必须通过 VPN 进入 DMZ 那样远……尽管有人想知道为什么这不是第一个选择。

Kerberos 也很酷，但恕我直言，LDAP 很糟糕（NISPlus 在技术上有什么问题？我读过 Sun 决定用户想要 LDAP，因此他们放弃了 NIS+）。Kerberos 在没有 LDAP 或 NIS 的情况下也能正常工作，只需逐个主机管理用户。使用 Kerberos 为您提供了一个易于使用（即使不是自动化的）PKI。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-11-23T23:52:53.130

这里有点晚了，但我在想，假设一个困难的情况 - 攻击者使用大量随机 IP、随机用户名和随机密码，从 10,000 个最受欢迎的列表中选择。

你可以做的一件事，特别是如果系统似乎受到攻击，因为系统上有很多错误的密码尝试，特别是如果密码是低熵的，那就是问一个次要问题，比如你父母的名字是什么，例如. 如果攻击者尝试使用密码“password1”攻击一百万个帐户，他们很有可能会得到很多，但他们获得正确名称的几率会大大降低成功率。

# python - 如何在 python 中模拟偏向模具？

> ID：479236
> 
> 赞同：12
> 
> 时间：2009-01-26T09:37:47.520
> 
> 标签：python, numpy, probability

我想模拟 N 面偏压芯片？

```
def roll(N,bias):
     '''this function rolls N dimensional die with biasing provided'''
     # do something
     return result

>> N=6
>> bias=( 0.20,0.20,0.15,0.15,0.14,0.16,)
>> roll(N,bias)
   2 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-26T10:09:03.027

这里有点数学。

普通骰子将以相等的概率给每个数字 1-6，即`1/6`。这被称为[均匀分布](https://en.wikipedia.org/wiki/Uniform_distribution_(continuous))（它的离散版本，而不是连续版本）。这意味着如果`X`是一个描述单个角色结果的随机变量，那么`X~U[1,6]`- 意思`X`是平均分配给掷骰子的所有可能结果，从 1 到 6。

这等于选择一个数字，`[0,1)`同时将其分为 6 个部分：`[0,1/6)`、`[1/6,2/6)`、`[2/6,3/6)`、`[3/6,4/6)`、`[4/6,5/6)`、`[5/6,1)`。

您正在请求不同的分布，这是有偏见的。实现这一点的最简单方法是`[0,1)`根据您想要的偏差将部分分为 6 个部分。因此，在您的情况下，您需要将其分为以下几类： `[0,0.2)`, `[0.2,0.4)`, `[0.4,0.55)`, `0.55,0.7)`, `[0.7,0.84)`, `[0.84,1)`。

如果您查看[wikipedia entry](https://en.wikipedia.org/wiki/Uniform_distribution_(continuous))，您会发现在这种情况下，累积概率函数将不是由 6 个等长部分组成，而是由 6 个长度不同的部分组成，具体取决于您给它们的*偏差。*质量分布也是如此。

回到问题，根据您使用的语言，将其翻译回您的骰子。在 Python 中，这是一个非常粗略但有效的示例：

```
import random
sampleMassDist = (0.2, 0.1, 0.15, 0.15, 0.25, 0.15)
# assume sum of bias is 1
def roll(massDist):
    randRoll = random.random() # in [0,1]
    sum = 0
    result = 1
    for mass in massDist:
        sum += mass
        if randRoll < sum:
            return result
        result+=1

print(roll(sampleMassDist)) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-26T09:47:21.293

更多语言不可知，但您可以使用查找表。

使用 0-1 范围内的随机数并在表中查找该值：

```
0.00 - 0.20   1
0.20 - 0.40   2
0.40 - 0.55   3
0.55 - 0.70   4
0.70 - 0.84   5
0.84 - 1.00   6 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-26T10:14:49.537

```
import random

def roll(sides, bias_list):
    assert len(bias_list) == sides
    number = random.uniform(0, sum(bias_list))
    current = 0
    for i, bias in enumerate(bias_list):
        current += bias
        if number <= current:
            return i + 1 
```

偏差将成比例。

```
>>> print roll(6, (0.20, 0.20, 0.15, 0.15, 0.14, 0.16))
6
>>> print roll(6, (0.20, 0.20, 0.15, 0.15, 0.14, 0.16))
2 
```

也可以使用整数（更好）：

```
>>> print roll(6, (10, 1, 1, 1, 1, 1))
5
>>> print roll(6, (10, 1, 1, 1, 1, 1))
1
>>> print roll(6, (10, 1, 1, 1, 1, 1))
1
>>> print roll(6, (10, 5, 5, 10, 4, 8))
2
>>> print roll(6, (1,) * 6)
4 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-03-27T15:14:50.400

[`np.random.choice`](https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html)在这里没有给出答案有点令人惊讶。

```
from numpy import random 
def roll(N,bias):
    '''this function rolls N dimensional die with biasing provided'''
    return random.choice(np.range(N),p=bias) 
```

*p 选项给出“与a*中的每个条目相关联的概率”，其中*a*`np.range(N)`代表我们。*“如果没有给出样本，则假设在a*中的所有条目上均匀分布。”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T14:29:01.677

对于具有不同概率的随机对象，请参阅[Walker 的别名方法的配方。](http://code.activestate.com/recipes/576564)
例如，字符串 ABC 或 D 的概率为 .1 .2 .3 .4 --

```
abcd = dict( A=1, D=4, C=3, B=2 )
  # keys can be any immutables: 2d points, colors, atoms ...
wrand = Walkerrandom( abcd.values(), abcd.keys() )
wrand.random()  # each call -> "A" "B" "C" or "D"
                # fast: 1 randint(), 1 uniform(), table lookup 
```

干杯
——丹尼斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-22T09:14:39.427

只是为了提出一种更有效（和 pythonic3）的解决方案，可以使用[bisect](http://docs.python.org/3.3/library/bisect.html#module-bisect)在累积值的向量中进行搜索——此外，可以预先计算和存储这些值，希望随后对该函数的调用将引用相同的“偏差”（遵循问题用语）。

```
from bisect import bisect
from itertools import accumulate
from random import uniform

def pick( amplitudes ):
    if pick.amplitudes != amplitudes:
        pick.dist = list( accumulate( amplitudes ) )
        pick.amplitudes = amplitudes
    return bisect( pick.dist, uniform( 0, pick.dist[ -1 ] ) )
pick.amplitudes = None 
```

在没有 Python 3 累积的情况下，可以编写一个简单的循环来计算累积和。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-10T15:22:48.963

```
from random import random
biases = [0.0,0.3,0.5,0.99]
coins = [1 if random()<bias else 0 for bias in biases] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-07-16T14:21:33.113

我为字典创建了一个代码，给出了一个事件和相应的概率，它返回了相应的键，即那个概率的事件。

```
import random

def WeightedDie(Probabilities):   

    high_p = 0   
    rand = random.uniform(0,1)

    for j,i in Probabilities.items():
        high_p = high_p + i
        if rand< high_p:
            return j 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-09-11T08:13:13.460

我们也可以使用`numpy`'s`multinomial`分布

```
import numpy as np

bias = [0.10,0.10,0.15,0.15,0.14,0.16,0.05,0.06,0.04,0.05]   # a 10-sided biased die
np.where(np.random.multinomial(1, bias, size=1)[0]==1)[0][0]+1 # just 1 roll
# 4 
```

如果您想多次滚动有偏差的骰子（具有给定的`bias`概率）`n`，请使用以下函数

```
def roll(probs, ntimes):   # roll a len(probs) sided biased die with bias probs for ntimes
   return np.apply_along_axis(lambda x: x.tolist().index(1)+1, 1, 
                       np.random.multinomial(1, bias,  size=10)).tolist()

roll(probs=bias, ntimes=10)    # 10 rolls
# [5, 6, 8, 4, 8, 3, 1, 5, 8, 6] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-26T04:48:56.793

对于 python 3.6 及更高版本，您可以使用已经是 stdlib 一部分的随机选择（）方法。要在您的示例中模拟模具，等效代码将是：-

```
import random

def roll(N, bias_list):
   return random.choices(list(range(N)), weights=bias_list, k=1)[-1] 
```

# .net - 建模具有共同事物的实体：超类型/子类型？

> ID：479244
> 
> 赞同：0
> 
> 时间：2009-01-26T09:39:12.993
> 
> 标签：.net, database, database-design, orm, model

我将使用 LLBLGen 来生成模型，但是我不想只使用它所拥有的任何内置继承工具来解决我的设计问题。无论 OR/M 工具如何，我都希望模型有意义。

所以，我有几种不同类型的实体，它们可以有地址，每个实体都可以有多个地址（主要地址、邮寄地址等）。

选项 1，使用超类型/子类型（如果您知道此类方案的确切名称，那将很有帮助）

> 表：EntityType [EntityTypeID, EntityTypeName]（例如，Company=1，Employee=2，AnotherEntity=3）
> 
> 实体：[EntityID，EntityTypeID，OriginID]：EntityTypeID=>EntityType
> 
> 公司：[公司 ID、公司名称、...]
> 
> 员工：[员工ID，名字，...]
> 
> AddressType：[AddressTypeID, AddressTypeName]（例如，Primary=1，Mailing=2 等）
> 
> 地址：[AddressID, AddressTypeID, EntityID, StreetAddress1, ...] : AddressTypeID=>AddressType, EntityID=>Entity

这样做的方式是，在创建任何 Company 或 Employee 之前，必须创建一个 Entity 记录并正确填写 EntityType。然后创建 Company 或 Employee 并将 Entity.OriginID 设置为 Company 或 Employee 的 ID。现在，地址记录将属于实体记录，这些记录将“绑定”到具体实体查看 EntityTypeID 和 OriginID。

我有点担心这需要的所有连接。更重要的是，我有点担心这在我的 ORM 工具 (LLBLGen) 中会很笨拙。

选项 2，这是对选项 1 的一种看法。我认为可能更糟，但包括它是一样的：

> 表：
> 
> EntityType：[EntityTypeID, EntityTypeName]（比如，Company=1，Employee=2，AnotherEntity=3）
> 
> 实体：[EntityID，EntityTypeID]：EntityTypeID=>EntityType
> 
> 公司：[CompanyID, EntityID, CompanyName, ...] : EntityID=>Entity
> 
> 员工：[EmployeeID，EntityID，FirstName，...]：EntityID=>Entity
> 
> AddressType：[AddressTypeID, AddressTypeName]（例如，Primary=1，Mailing=2 等）
> 
> 地址：[AddressID, AddressTypeID, EntityID, StreetAddress1, ...] AddressTypeID =>AddressType, EntityID=>Entity

这将类似于选项 1，因为对于公司或员工，将首先创建实体记录，并适当地设置实体类型。然后，将创建 Company 或 Employee 记录，并且先前创建的 Entity 记录的 EntityID 将设置在 Company 或 Employee 记录本身上。该地址将与实体本身相关联。然而，这似乎很奇怪，因为这会将地址记录视为公司和员工记录，即它们持有一个实体ID，但该引用意味着与公司和员工表中实体ID 引用的不同。

这似乎有点糟糕。它与第一个问题几乎相同，但我认为它也使模式不那么直观。

在这两种情况下，您都需要使用一些 Unique 约束，例如在 Company 表中（EntityID 在 Company 表中应该是唯一的）。但是，您需要执行一些其他程序检查以防止公司和员工记录指向相同的实体记录。我不知道像 LLBLGen 这样的工具是否可以通过智能地处理 EntityTypeID 值来对选项 1 执行任何“魔术”。

因此，选项 3 很简单：

> 表：
> 
> 公司：[公司 ID、公司名称、...]
> 
> 员工 [EmployeeID, FirstName, ...]
> 
> AddressType：[AddressTypeID, AddressTypeName]（例如，Primary=1，Mailing=2 等）
> 
> CompanyAddress: [CompanyAddressID, AddressTypeID, CompanyID, StreetAddress1, ...] : AddressTypeID=>AddressType, CompanyID=>Company
> 
> EmployeeAddress: [EmployeeAddressID, AddressTypeID, EmployeeID, StreetAddress1, ...] : AddressTypeID=>AddressType, EmployeeID=>Employee

这使得连接更容易处理。但是，我不认为这真的可行。我有很多实体。我不仅有很多实体，而且我有很多可以有地址的实体。另外，这个“地址”只是一个例子，我还有很多其他类似于地址的东西。我不认为为每个人创建一个表格会在开发方面进行扩展。另外，我确信我可以让我的 ORM 让我使用代码将所有不同的地址视为相同的基本“地址”类型，但是，我不想依赖 ORM 可以做的技巧。

那么，这种超类型/子类型的东西是个好主意吗（我怀疑不是）？如果是，是否有更好的方法来解决它。如果没有，有什么更好的选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T10:00:18.833

这个问题有点啰嗦。您可能应该尝试将其精简为基本必需品。我比您使用的工具（在 ORM 空间中）更熟悉 JPA，但 JPA 有这个概念，它被称为映射超类（继承策略）。这是完全有效的，值得考虑。

在一个系统中，我设计了许多实体（公司、个人、合伙企业、信托等），它们有共同的实体（例如法定名称）和相关的实体（例如地址、联系方式），因此很自然地有一个共同的 Party 超类型，即有点类似于你要去的地方。

是的，您确实有一个类型列（在超类型中）。在 JPA 术语中，这称为鉴别器列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T14:14:25.607

该主题已在网络上广泛讨论。查找“泛化专业化数据建模”或“泛化专业化数据库设计”。

在您的情况下，公司和员工都是具有地址的专业实体。

在其他情况下，卡车和汽车可能是专用车辆。在另一种情况下，学生和校友可能是专业的社区成员。

我可以在这里总结一下，但你最好了解来源。

# eclipse-rcp - Eclipse RCP：创建需要 2 个不同版本插件的产品时出现问题

> ID：479254
> 
> 赞同：2
> 
> 时间：2009-01-26T09:41:13.067
> 
> 标签：eclipse-rcp

出于与外部产品兼容的原因，我需要构建一个 RCP 应用程序，该应用程序必须包含 2 个版本的插件。该插件是 org.apache.lucene，目前在 eclipse 3.4 中是 1.9.1。我需要版本 1.4.103 才能与其他应用程序兼容。我应该说我的 RCP 应用程序最初是使用 eclipse 3.2 开发的，升级到 3.4 后出现了这个问题。

在开发和测试期间，我的应用程序运行正常。我必须在运行配置中手动添加 1.4.103 插件，否则运行正常。

现在我处于构建产品阶段，找不到在产品向导的配置选项卡中添加 2 个版本的 Lucene 插件的方法。运行时出现错误，表示缺少 Lucene 的 1.4.103 版本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T10:16:54.430

考虑一下，在 OSGi 中，包没有包之间直接依赖的概念。
相反，每个包列出了它希望其他包通过“Import-Package”和“Import-Service”标头注册的服务和包。

另一方面，捆绑包列出了它计划通过“Export-Package”和“Export-Service”导出的服务和包。因此，bundle 实现之间没有硬依赖。只要某些捆绑包提供了您导入的包，您的捆绑包就会很高兴。

作为说明，WTP（Web 工具平台）[具有重复的 javax.wsdl 插件](http://www.nabble.com/Duplicated-javax.wsdl-plugin-td17231303.html)：

* * *

现在您应该确保您已经使用子菜单“PDE 工具”（右键单击您的项目）转换了您的 3.2 插件项目。

然后您可以[为您的 rcp 应用程序定义一个产品](http://www.vogella.de/articles/RichClientPlatform/article.html)，在其中您将为运行时定义一个配置（[**目标**](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.pde.doc.user/guide/tools/file_wizards/new_product_config.htm)），而不是一个开发目标。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-02T00:46:36.537

我在处理捆绑 BIRT 的产品时深入研究了这个问题，因此继承了对 javax.wsdl 的 2 个不同版本的要求。看了很多wiki页面、bugzilla条目等，发现是PDE（Plug-in Development Environment）构建过程中的问题。该问题现在已在 Eclipse 3.5 中得到纠正。bugzilla 条目位于[https://bugs.eclipse.org/bugs/show_bug.cgi?id=265438](https://bugs.eclipse.org/bugs/show_bug.cgi?id=265438)。

基本上，Eclipse 本身允许您指定两个版本并正确解决所有问题。但是，PDE Build（使用相同的产品文件）仅提取最新版本的插件。我们对当前 Eclipse 3.4 基础的解决方案是强制将附加插件复制到目标的 plugins 文件夹中。这暂时解决了我们的问题，我们将在未来迁移到 Eclipse 3.5 RCP 基础以获取上述错误修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T18:16:54.277

用另一个名字从源代码编译这个插件怎么样？或者为较新的插件功能编写一个包装器？

# wpf - 从 WPF 中的 TextBox 继承

> ID：479265
> 
> 赞同：0
> 
> 时间：2009-01-26T09:49:43.097
> 
> 标签：wpf, inheritance, textbox

我正在尝试创建一个名为**NumericTextBox**的新 WPF 控件。

它直接继承自**TextBox**。

我添加了一个名为**NumericValue**的新 DependecyProperty ，它可用于绑定数字属性。

现在，我想覆盖**TextProperty**的行为，以便它只能作为**ReadOnly**访问。

是否有可能重新定义其行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T10:59:30.697

我不知道，必须使用单独的 DependencyProperty.RegisterReadOnly() 方法将只读 DependencyProperties 定义为这样，在定义属性后不能将其更改为只读。您只能覆盖元数据：回调、默认值等。

# xml - Xml 可以用结束元素压缩吗？

> ID：479269
> 
> 赞同：5
> 
> 时间：2009-01-26T09:54:36.490
> 
> 标签：xml, compression

有什么理由让 XML 像这样：

```
<person>    
    <firstname>Joe</firstname>    
    <lastname>Plumber</lastname>
</person> 
```

不能像这样压缩客户端/服务器传输。

```
<person>    
    <firstname>Joe</>    
    <lastname>Plumber</>
</> 
```

它会更小 - 解析速度会稍微快一些。

假设没有边缘条件意味着这不起作用 - 是否有任何库可以做这样的事情？

事实证明，这对谷歌来说是一件很难的事情：

> 您的搜索 - `</>`- 没有匹配任何文件。
> 
> 建议：
> 
> 尝试不同的关键字。

**编辑：似乎对我的要求感到困惑。我说的是我自己的压缩形式。我完全清楚，就目前而言，这不是 XML。服务器和客户端必须“参与计划”。这对于元素名称很长的模式特别有用，因为这些元素名称占用的带宽将减半。**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T10:07:39.753

如果您编写了执行此操作的压缩例程，那么是的，您可以压缩流并在另一端恢复它。

没有这样做的原因是：

*   已经存在更好的与 XML 无关的压缩方案（在压缩率方面，可能在 CPU 和空间方面 - 某个 7 N UTF-8 文档将获得 14% 的压缩，但需要至少 2 N 字节的空间来解压缩，而不是大多数解压缩算法所需的恒定空间。
*   已经存在更好的 XML 感知压缩方案（google 'binary xml'）。对于模式感知压缩，基于 ASN.1 的方案比将用于指示元素类型的大小减少一半要好得多。
*   解压器必须解析非标准 XML 并保留它遇到的打开标签堆栈。因此，除非您将其插入而不是解析器，否则解析成本会增加一倍。如果您确实插入它而不是解析器，那么您正在混合不同的层，这可能会在某些时候引起混淆

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T09:55:53.913

这不是有效的 XML。必须命名结束标签。否则它可能容易出错，坦率地说，我认为它的可读性会降低。

关于您关于这是为了节省几个字节而违反 XML 标准的非标准违规行为的说明，这是一个非常糟糕的主意，原因如下：

1.  它是非标准的，可能必须在很远的将来得到支持；
2.  标准的存在是有原因的。标准和约定具有很大的影响力，并且“自定义 XML”与象牙塔图形设计师一起排在第一位，他们迫使程序员编写自定义按钮替换，因为标准的不能做任何奇怪、美妙和令人困惑的行为。
3.  Gzip 压缩既简单又有效，而且不会违反标准。如果您看到 gzip 八位字节流，则不会将其误认为是 XML。你所拥有的速记方案的真正问题是它仍然在顶部，所以一些糟糕的毫无戒心的解析器可能会错误地认为它是有效的，并用一个不同的、误导性的错误来轰炸；
4.  信息论：压缩通过消除信息的冗余来工作。如果您手动执行此操作，它会使 gzip 压缩不再有效，因为重新预置了相同数量的信息；
5.  将文档与此方案相互转换会产生很大的开销。它不能用标准的 XML 解析器完成，因此您必须有效地编写自己的 XML 解析器和理解此方案的输出器（实际上可以使用解析器完成转换为这种格式；将其取回更困难），这是很多工作（还有很多错误）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T09:58:46.887

如果您需要更好的压缩和更容易的解析，您可以尝试使用 XML 属性：

```
<person firstname="Joe" lastname="Plumber" /> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-26T10:11:11.073

正如您所说，这不是 XML，那么为什么还要让它看起来像 XML？您已经失去了使用任何 XML 解析器或工具的能力。我要么

*   使用 XML，并在线压缩它，因为您会发现比使用自己的方案节省更多
*   使用另一种更紧凑的格式，如[YAML](http://www.yaml.org/)或[JSON](http://json.org/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-26T10:09:23.213

如果数据大小有任何问题，那么 XML 不适合您。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-27T16:13:45.210

> 有什么理由吗

从哲学上考虑你的问题，SGML*确实*允许`</>`关闭标签。关于允许将其纳入 XML 标准的争论。拒绝它的原因是省略结束标记中的名称有时会导致 XML 的可读性降低。所以，这是一个“原因”。

很难超越现有的文本压缩率，但是您的“压缩”方案的一个优点是 XML 在网络上仍然是*人类可读*的。另一个优点是，如果您必须手动输入 XML（例如用于测试），则不必关闭结束标记会带来（次要）便利。也就是说，它比标准 XML更易于*人类编写。*我说“次要”，因为大多数编辑器都会为您完成字符串完成（例如，vim 中的 ^n 和 ^p）。

**去除关闭标签**：最简单的是使用这样的东西：（`s_</[a-zA-Z0-9_$]+>_</>_`这不是正确的 QName 正则表达式，但你明白了）。

**要将它们添加回来**：您需要一个特殊的解析器，因为 SAX 和其他 XML 解析器无法识别这一点（因为它不是“XML”）。但是（最简单的）解析只需要识别打开标签名称和关闭标签名称。

```
have a stack.
scan the XML, and output it, as-is.
if you recognize an open tag, push its name.
if you recognize close tag, pop to get its name, and
  insert that in the output (you can do this even when there is a proper close tag). 
```

顺便说一句（作为对上述评论的回应），这是有效的，因为在 XML 中，关闭标签只能对应于最近的打开标签。与嵌套括号相同。

但是，我认为您是对的，肯定有人已经这样做了。也许检查 Python 或 Perl 存储库？

编辑：您可以进一步省略 trailing `</>`，因此您的示例变为（当解析器看到 EOF 时，它会为堆栈上剩余的任何内容添加关闭标签）：

```
<person>    
    <firstname>Joe</>    
    <lastname>Plumber 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-26T19:40:55.917

您所描述的是[SGML](http://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language)，它用于`</>`结束最近的前一个非空标签。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-26T10:05:50.290

即使这是可能的，它也只需要更长的时间来解析，因为现在解析器必须找出正在关闭的内容，并且必须继续检查这是否正确。

如果您想要压缩，XML 是高度可压缩的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-26T10:04:56.530

您可能有兴趣了解[SGML 中的不同标签格式](http://www.is-thought.co.uk/book/sgml-9.htm)。例如，以下可能是有效的 SGML：

```
<p/This paragraph contains a <em/bold/ word./ 
```

幸运的是，XML 的设计者选择省略这一疯狂的特殊章节。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-26T09:57:21.973

抱歉，不在[规范](http://www.w3.org/TR/REC-xml/)中。如果你有一个大的 XML 文件，你最好通过 zip、gzip 等进行压缩。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-26T10:05:20.243

您是否有任何理由不使用 YAML 或 JSON？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-26T10:06:16.887

是的，xml 是一种重格式。但它有一定的优势。

如果您认为 xml 对于您的使用来说过于繁重，请查看 JSON。它重量轻，但功能比 xml 少。

如果您想要非常小的文件，请使用二进制格式;-)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-26T11:05:50.543

如果不使用 gzip 或类似的东西，我只需在发送之前和在接收端使用 xml 之前用更短的标记名替换每个标记。因此你会得到这样的东西：

```
<a>
    <b>Joe</b>
    <c>Plumber</c>
</a> 
```

使得使用任何标准解析器来遍历所有节点并相应地替换 nodeNames 变得非常容易。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-26T19:29:13.100

不要为 XML 的文本优化和降低读/写性能/简单性而烦恼。使用 deflate 压缩来压缩客户端和服务器之间的有效负载。我做了一些测试，压缩一个普通的 10k XML 文件会产生一个 2.5k 的 blub。删除所有端点结束标记名称会将原始文件大小降低到 9k，但一旦放气，它又是 2.5k。这是一个很好的例子，说明基于字典的压缩是在端点之间压缩有效负载的简单方法。"" 和 "" 将（几乎）在压缩数据中使用相同的空间。

唯一的例外是如果文件/数据非常小，那么可压缩性较差。

# jquery - jQuery中的嵌套手风琴菜单

> ID：479270
> 
> 赞同：11
> 
> 时间：2009-01-26T09:55:18.797
> 
> 标签：jquery, jquery-ui, accordion

我有一个使用一组嵌套手风琴实现的菜单，`1`and `2`，每个都有元素，`a`and `b`。

我想实现以下逻辑：

*   当我点击时`1a`，我会得到`1a`两个子菜单的数据`2a`，`2b`

*   当我点击 时`2a`，`2b`我会分别得到每个的数据。

**问题**

期望的结果：

*   我只想显示`nth-most`最后一次单击的子元素，折叠所有其他元素。
*   在初始化时，只有`1a`并且`1b`应该是可见的。

当前结果：

*   单击`1b`，然后单击`2b`，`1b`仍然完全可见。

### JavaScript 代码

```
$(document).ready(function() {
    $("#acc1").accordion({
        active:".ui-accordion-left",
        alwaysOpen: false,
        autoheight: false,
        header: 'a.acc1',
        clearStyle: true
    });
    $("#acc2").accordion({
        alwaysOpen: false,
        autoheight: false,
        header: 'a.acc2',
        clearStyle: true
    });
}); 
```

HTML：

```
<ul id="acc1" class="ui-accordion-container">
    <li>
        <div class="ui-accordion-left"></div>
        <a class="ui-accordion-link acc1">1a
            <span class="ui-accordion-right"></span>
        </a>
        <div>
            data of 1a<br/>
            data of 1a<br/>
            data of 1a<br/>
        </div>
        <div>
            <ul class="ui-accordion-container" id="acc2">
                <li>
                    <div class="ui-accordion-left"></div>
                    <a class="ui-accordion-link acc2">2a
                        <span class="ui-accordion-right"></span>
                    </a>
                    <div>
                        data of 2a<br/>
                        data of 2a<br/>
                        data of 2a<br/>
                    </div>
                </li>
                <li>
                    <div class="ui-accordion-left"></div>
                    <a class="ui-accordion-link acc2">2b
                        <span class="ui-accordion-right"></span>
                    </a>
                    <div>
                        data of 2b<br/>
                        data of 2b<br/>
                        data of 2b<br/>
                    </div>
                </li>
            </ul>
        </div>
    </li>
    <li>
        <div class="ui-accordion-left"></div>
        <a class="ui-accordion-link acc1">1b
            <span class="ui-accordion-right"></span>
        </a>
        <div>
            data of 1b<br />
            data of 1b<br />
            dta of 1b <br />
        </div>
    </li>
</ul> 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-05T20:40:36.080

只需对 HTML 中元素的顺序进行一些更改，即可获得所需的行为。现在开始时只有 1a 和 1b 是开放的。同样，当您现在单击 1b 时，它将关闭 1a，这也将隐藏任何打开的 2a/2b 部分。

```
 $(document).ready(function() {
        $("#acc1").accordion({
            active:".ui-accordion-left",
            alwaysOpen: false,
            autoheight: false,
            header: 'a.acc1',
            clearStyle: true
        });
        $("#acc2").accordion({
            active:".ui-accordion-left",
            alwaysOpen: false,
            autoheight: false,
            header: 'a.acc2',
            clearStyle: true
        });
    });

    <ul id="acc1" class="ui-accordion-container">
        <li>
            <div class="ui-accordion-left">
            </div>
            <a class="ui-accordion-link acc1">1a
                <span class="ui-accordion-right"></span>
            </a>
            <div>
                data of 1a<br/>
                data of 1a<br/>
                data of 1a<br/>
                <ul class="ui-accordion-container" id="acc2">
                    <li>
                        <div class="ui-accordion-left">
                        </div>
                        <a class="ui-accordion-link acc2">2a
                            <span class="ui-accordion-right"></span>
                        </a>
                        <div>
                            data of 2a<br/>
                            data of 2a<br/>
                            data of 2a<br/>
                        </div>
                    </li>
                    <li>
                        <div class="ui-accordion-left">
                        </div>
                        <a class="ui-accordion-link acc2">2b
                        <span class="ui-accordion-right"></span></a>
                        <div>
                            data of 2b<br/>
                            data of 2b<br/>
                            data of 2b<br/>
                        </div>
                    </li>
                </ul>
            </div>
        </li>
        <li>
            <div class="ui-accordion-left"></div>
            <a class="ui-accordion-link acc1">1b
            <span class="ui-accordion-right"></span></a>
            <div>
                data of 1b<br />
                data of 1b<br />
                dta of 1b <br />
            </div>
        </li>
    </ul>
</body> 
```

# wpf - WPF 布局：自动换行不起作用

> ID：479274
> 
> 赞同：1
> 
> 时间：2009-01-26T09:57:54.143
> 
> 标签：wpf, layout, textblock

即使我指定了自动换行，为什么我的 TextBlock 中的文本会向右延伸到画布之外？

```
<Window x:Class="WpfApplication6.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" SizeToContent="WidthAndHeight">
    <DockPanel>
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
            <Button Content="111"/>
            <Button Content="222"/>
            <Button Content="333"/>
            <Button Content="444"/>
            <Button Content="555"/>
        </StackPanel>
        <StackPanel DockPanel.Dock="Left">
            <Button Content="One"/>
            <Button Content="Two"/>
            <Button Content="Three"/>
            <Button Content="Four"/>
            <Button Content="Five"/>
        </StackPanel>
        <Canvas Background="tan">
            <TextBlock TextWrapping="Wrap">This is the content in this area here</TextBlock>
        </Canvas>
    </DockPanel>
</Window> 
```

**解决方案：谢谢，史蒂夫，做到了，我也添加了一个 ScrollViewer，很好：**

```
<DockPanel>
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
        <Button Content="111"/>
        <Button Content="222"/>
        <Button Content="333"/>
        <Button Content="444"/>
        <Button Content="555"/>
    </StackPanel>
    <StackPanel DockPanel.Dock="Left">
        <Button Content="One" Click="Button_Click" />
        <Button Content="Two"/>
        <Button Content="Three"/>
        <Button Content="Four"/>
        <Button Content="Five"/>
    </StackPanel>
    <Grid Background="tan">
        <ScrollViewer>
            <TextBlock Name="mainArea" Padding="10" TextWrapping="Wrap">This is the content in this area here</TextBlock>
        </ScrollViewer>
    </Grid>
</DockPanel> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T10:34:02.603

它在 Canvas 内，因此没有设置任何宽度。如果您不需要画布，请将其更改为 Grid（自动调整大小），TextBlock 将正确换行。

# linux - 如何在 linux shell 上找出给定路径的可用磁盘空间？

> ID：479276
> 
> 赞同：19
> 
> 时间：2009-01-26T09:58:20.053
> 
> 标签：linux, sysadmin, diskspace, linux-disk-free

1）我在某个目录中 2）我想知道那里还有多少可用空间

有没有一个简单的命令可以做到这一点？我不想查看 fstab 或其他任何东西，必须在脑海中映射设备和挂载点以确定我还剩下多少可用空间。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-26T09:59:38.693

尝试`df -h`

更好的是：`df -h .`或`df -h path-to-file`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-26T10:38:15.230

其他人讨论的“df”命令只是等式的一半。知道文件系统有可用空间并不意味着用户可以访问该空间。

您还可以使用以下命令：

```
df -k . 
```

找出当前文件系统上的可用空间。'df' 足够聪明，可以为你走树并报告它。如果要检查配额（见下文），则可以处理 df 的输出以查找文件系统以检查配额。

可能没有空闲的 inode (df -i $PWD)，可能有为超级用户保留的块（默认情况下，在 ext2/3/4 上，总数的 5% 是为 root 保留的）。我相信 df 显示了包括保留块在内的可用空间，因此您看到的数字实际上高于非 root 用户可用的数字。

用户可能有配额限制。由于存储成本如此之低，配额限制如今已不太常见，但也值得使用配额命令进行检查。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-26T10:13:23.457

我将使用以下内容与所有不同`df(1)`的及其输出更兼容：

```
df . | awk '$3 ~ /[0-9]+/ { print $4 }' 
```

`tail(1)`由于正则表达式匹配，无需使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T10:06:23.283

```
df -Ph $PWD | tail -1 | awk '{ print $3}' 
```

# c# - 鼠标滚轮事件 (C#)

> ID：479284
> 
> 赞同：28
> 
> 时间：2009-01-26T10:03:06.707
> 
> 标签：c#, winforms, mousewheel

我无法在主窗体中获取鼠标滚轮事件。

作为一个演示，我想出了一个简单的例子：

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();

        this.panel1.MouseWheel += new MouseEventHandler(panel1_MouseWheel);
        this.panel1.MouseMove += new MouseEventHandler(panel1_MouseWheel);

        Form2 f2 = new Form2();
        f2.Show(this);
    }

    private void panel1_MouseWheel(object sender, MouseEventArgs e)
    {
        if(e.Delta != 0)
        Console.Out.WriteLine(e.Delta);
    }
}

public partial class Form2 : Form
{
    public Form2()
    {
        InitializeComponent();

        this.MouseMove += new MouseEventHandler(Form2_MouseMove);
        this.MouseWheel += new MouseEventHandler(Form2_MouseMove);
    }

    private void Form2_MouseMove(object sender, MouseEventArgs e)
    {
        if(e.Delta != 0)
            Console.Out.WriteLine(e.Delta);
    }
} 
```

我在 Form2 中得到鼠标滚轮事件，但在 Form1 中没有任何想法？

干杯，

詹姆士

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2012-04-04T07:42:30.597

我怀疑当面板没有焦点时，只有鼠标悬停在面板上时，OP 想要获取滚动事件。

此处解释了一种完成此行为的方法：

[http://social.msdn.microsoft.com/forums/en-US/winforms/thread/eb922ed2-1036-41ca-bd15-49daed7b637c/](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/eb922ed2-1036-41ca-bd15-49daed7b637c/)

和这里：

[http://social.msdn.microsoft.com/forums/en-US/winforms/thread/6bfb9287-986d-4c60-bbcc-23486e239384/](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/6bfb9287-986d-4c60-bbcc-23486e239384/)

取自链接论坛的代码片段之一：

```
using System;
using System.ComponentModel;
using System.Drawing;
using System.Windows.Forms;
using System.Runtime.InteropServices;

namespace WindowsApplication1 {
  public partial class Form1 : Form, IMessageFilter {
    public Form1() {
      InitializeComponent();
      Application.AddMessageFilter(this);
    }

    public bool PreFilterMessage(ref Message m) {
      if (m.Msg == 0x20a) {
        // WM_MOUSEWHEEL, find the control at screen position m.LParam
        Point pos = new Point(m.LParam.ToInt32() & 0xffff, m.LParam.ToInt32() >> 16);
        IntPtr hWnd = WindowFromPoint(pos);
        if (hWnd != IntPtr.Zero && hWnd != m.HWnd && Control.FromHandle(hWnd) != null) {
          SendMessage(hWnd, m.Msg, m.WParam, m.LParam);
          return true;
        }
      }
      return false;
    }

    // P/Invoke declarations
    [DllImport("user32.dll")]
    private static extern IntPtr WindowFromPoint(Point pt);
    [DllImport("user32.dll")]
    private static extern IntPtr SendMessage(IntPtr hWnd, int msg, IntPtr wp, IntPtr lp);
  }
} 
```

这段代码基本上会拦截所有 wm_mousewheel 事件并将它们重定向到鼠标当前悬停的控件。面板不再需要获得焦点来接收滚轮事件。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-26T10:31:42.047

您的问题源于 form1 有焦点，而不是 panel1。...这当然意味着将触发 form1 的事件，而不是 panel1 的事件。

我重新创建了您的场景，并对 Form1 中的构造函数进行了以下更改，并验证它触发了滚轮事件。

```
public Form1()
{
        InitializeComponent(); 

        /*  --- Old code that don't work ---
            this.panel1.MouseWheel += new MouseEventHandler(panel1_MouseWheel);
            this.panel1.MouseMove += new MouseEventHandler(panel1_MouseWheel);
        */

        this.MouseWheel += new MouseEventHandler(panel1_MouseWheel);
        this.MouseMove += new MouseEventHandler(panel1_MouseWheel);

        Form2 f2 = new Form2();
        f2.Show(this);
    }
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-05T07:13:31.420

添加另一个面板事件，`MouseEnter`并在其回调函数中获取输入焦点：

```
void MouseEnterEvent()
{
   this.Panel.Focus();
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-06-05T18:09:39.843

感谢@nitrogenycs 的回答，我编写了一个简单的通用类来轻松解决这个问题：

```
using System;
using System.Windows.Forms;
using System.Runtime.InteropServices;
using System.Drawing;

namespace MyNamespace
{
  public class MouseWheelManagedForm : Form, IMessageFilter
  {
    private bool managed;

    public MouseWheelManagedForm () : this (true) {
   }

    public MouseWheelManagedForm (bool start) {
      managed = false;
      if (start)
        ManagedMouseWheelStart();
    }

    protected override void Dispose (bool disposing) {
      if (disposing)
        ManagedMouseWheelStop();
      base.Dispose(disposing);
    }

    /************************************
     * IMessageFilter implementation
     * *********************************/
    private const int WM_MOUSEWHEEL = 0x20a;
    // P/Invoke declarations
    [DllImport("user32.dll")]
    private static extern IntPtr WindowFromPoint (Point pt);
    [DllImport("user32.dll")]
    private static extern IntPtr SendMessage (IntPtr hWnd, int msg, IntPtr wp, IntPtr lp);

    private bool IsChild (Control ctrl) {
      Control loopCtrl = ctrl;

      while (loopCtrl != null && loopCtrl != this)
        loopCtrl = loopCtrl.Parent;

      return (loopCtrl == this);
    }

    public bool PreFilterMessage (ref Message m) {
      if (m.Msg == WM_MOUSEWHEEL) {
        //Ensure the message was sent to a child of the current form
        if (IsChild(Control.FromHandle(m.HWnd))) {
          // Find the control at screen position m.LParam
          Point pos = new Point(m.LParam.ToInt32() & 0xffff, m.LParam.ToInt32() >> 16);

          //Ensure control under the mouse is valid and is not the target control
          //otherwise we'd be trap in a loop.
          IntPtr hWnd = WindowFromPoint(pos);
          if (hWnd != IntPtr.Zero && hWnd != m.HWnd && Control.FromHandle(hWnd) != null) {
            SendMessage(hWnd, m.Msg, m.WParam, m.LParam);
            return true;
          }
        }
      }
      return false;
    }

    /****************************************
     * MouseWheelManagedForm specific methods
     * **************************************/
    public void ManagedMouseWheelStart () {
      if (!managed) {
        managed = true;
        Application.AddMessageFilter(this);
      }
    }

    public void ManagedMouseWheelStop () {
      if (managed) {
        managed = false;
        Application.RemoveMessageFilter(this);
      }
    }

  }
} 
```

从那里，您只需要从此类继承您的 Form 而不是 Form 对于您需要“管理” MouseWheel 的每个表单：

```
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Windows.Forms;

namespace MyApp
{
  public partial class MyForm : MyNamespace.MouseWheelManagedForm
  {
    public MyForm ()
    {
      InitializeComponent();
    }

  }
} 
```

希望这会帮助别人（比我）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T10:13:45.843

也许这对你有用？

```
public partial class Form1 : Form {
    public Form1() {
        InitializeComponent();
        Form2 f2 = new Form2();
        f2.MouseWheel += new MouseEventHandler(panel1_MouseWheel);
        f2.MouseMove += new MouseEventHandler(panel1_MouseWheel);
        f2.Show(this);
    }

    private void panel1_MouseWheel(object sender, MouseEventArgs e)
    {
        if(e.Delta != 0) Console.Out.WriteLine(e.Delta);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T10:31:56.930

面板本身不能拥有焦点，只有放置在面板内的项目才能拥有焦点。只有在其中放置了某些东西并且该东西具有焦点时，面板才会收到 MouseWheel 事件。只需将鼠标悬停在面板上并移动鼠标滚轮即可将事件发送到表单，而不是面板。

这是您的两个示例之间的区别。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2017-08-14T20:22:27.003

```
this.MouseWheel += pictureBox1_MouseWheel; //tanımlama
void pictureBox1_MouseWheel(object sender, MouseEventArgs e)
            {
                if (Convert.ToString(e.Delta) == "120")
                {
                    //yukarı
                }
                else if (Convert.ToString(e.Delta) == "-120")
                {
                    //aşağı
                }
            } 
```

# log4j - 我在哪里可以找到 log4j 服务器？

> ID：479293
> 
> 赞同：5
> 
> 时间：2009-01-26T10:05:33.160
> 
> 标签：log4j

我想将不同的 log4j 日志集中到服务器上。我在哪里可以找到一个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T11:26:34.253

只是我的两分钱，

1) 我建议不要将 JDBC appender 用于生产环境，因为当缓冲区开始填满时，它可能会导致一些性能问题。

2) 我认为更好的方法是使用可以通过 ssh 等远程监控日志文件的应用程序。有一些关于，抱歉记不住他们的名字。

请记住，log4j 是高性能的，但它是同步的，因此如果您决定将日志事件发布到服务器，请考虑延迟/瞬态网络问题等。

卡尔

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T20:31:40.037

试试**[logFaces](http://www.moonlit-software.com "日志脸")**，它是一个建立在 Apache 日志服务之上的日志服务器、聚合器和查看器。

**披露**：我是该产品的作者。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-04T13:16:58.060

如果在 Windows 上运行，我建议使用 SyslogAppender 并获取 syslog 守护程序的开源实现。Unix/Linux/etc 自带对 Syslog 的原生支持。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T10:10:03.400

Log4j 可以定向到任何输出流，包括连接到另一台计算机的 Socket。您仍然需要编写一个小型应用程序来接收 log4j 数据并将其写入日志文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T12:33:39.320

My two cents ...

Are you looking for a gui application (e.g. for debugging)?

*   Try [http://logging.apache.org/chainsaw/index.html](http://logging.apache.org/chainsaw/index.html)

Are you looking for a centralized archive (e.g. for production system administration)?

*   You could use the jdbc appender and store all you log on a db.

Are you looking for library (e.g. for some integration purpose)?

*   Try [http://logging.apache.org/log4j/companions/receivers/index.html](http://logging.apache.org/log4j/companions/receivers/index.html) (only log4j 2.0, I never used it)

LLP, Andrea

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T10:13:19.977

是的，使用 socketappender 登录到远程主机，但我不敢相信还没有一个高效的接收器可以用来代替编写它。

谢谢

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-29T09:19:53.767

您可以尝试[Splunk](http://www.splunk.com) (www.splunk.com)。免费版可以让您每天最多记录和索引 500MG。我们部署了一台服务器，并且 log4net（log4j 的 .net 版本）和 NLog 都从多台机器记录到它。您还可以使用 splunk 来监视各种机器上的其他日志，这样您就可以在应用程序开始抛出错误之前快速识别出哪些更改。

# c# - 从 c# 检测操作系统语言

> ID：479300
> 
> 赞同：15
> 
> 时间：2009-01-26T10:09:15.400
> 
> 标签：c#, operating-system

有没有办法从 ac# 类中检测操作系统的语言？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2011-06-09T13:31:45.663

不幸的是，之前的答案并非 100% 正确。

是正在运行的线程的`CurrentCulture`文化信息，它用于需要知道当前文化但不显示任何内容的操作。`CurrentUICulture`用于格式化显示，例如正确显示`DateTime`. 因为您可能会更改当前线程，`Culture`或者`UICulture`如果您想知道操作系统`CultureInfo`实际上是什么，请使用`CultureInfo.InstalledUICulture`.

此外，还有一个关于这个主题的问题（比这个问题更新）有一个详细的答案：

[在 c# 中获取操作系统语言](https://stackoverflow.com/questions/5710127/get-operating-system-language-in-c)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T10:18:45.300

通过`System.Globalization.CultureInfo`课程，您可以确定您想要什么。

有了`CultureInfo.CurrentCulture`系统设定的文化，有了`CultureInfo.CurrentUICulture`用户设定的文化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-09-16T19:09:33.700

`"System.Globalization.CultureInfo.CurrentUICulture.DisplayName"`. 这正是你想要的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T10:19:32.430

您的意思是机器是否配置（例如）英语、法语或日语？

查看 CultureInfo 类 - 特别是 CurrentCulture，它是从操作系统当前区域设置初始化的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-11-07T02:06:59.957

意味着如果系统区域设置在Region和Language上，可以使用Win32 API函数GetSystemDefaultLCID。签名如下：

```
[DllImport("kernel32.dll")]
static extern uint GetSystemDefaultLCID(); 
```

GetSystemDefaultLCID 函数返回 LCID。它可以从下表映射语言字符串。 [Microsoft 分配的区域设置 ID](http://msdn.microsoft.com/en-us/goglobal/bb964664.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-06-28T19:49:24.463

上面的所有答案似乎只能让您了解安装操作系统的文化（充其量）。我遇到了一个问题，我需要在 Windows 中使用实际的显示语言。即用户安装了默认的 en-US Windows 安装，但随后添加了德语 (de-DE) 的语言包并将其设置为他们的显示语言。

为此，我使用了[System.Windows.Input.InputLanguageManager.Current.CurrentInputLanguage](https://msdn.microsoft.com/en-us/library/system.windows.input.inputlanguagemanager.currentinputlanguage(v=vs.110).aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T10:20:32.037

System.Threading.Thread.CurrentThread.CurrentCulture

# sql-server - SQL Server 全局唯一标识符

> ID：479308
> 
> 赞同：4
> 
> 时间：2009-01-26T10:13:28.353
> 
> 标签：sql-server, sql-server-2005

何时或为什么需要使用全局唯一标识符而不是传统的身份列？请帮我理解

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T10:17:27.970

一个原因是**复制和可伸缩性**：当存在多个不协调的写入器时，它们——根据定义——没有通信通道来`int`为主键创建唯一的 s。GUID 不需要通信就可以是唯一的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T10:22:04.703

除了其他答案提到的复制元素......

当您需要创建唯一值但无权访问主数据库或不想先写出数据时。对于同步系统尤其如此。例如，一个销售人员工具，它允许未连接的销售人员创建数据并在以后将其写入数据库。

对于身份，您必须先将一行写入数据库，然后才能确定唯一键是什么。使用 GUID，您可以在数据库外部的代码中生成 GUID，而根本不需要数据库可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T10:17:39.767

GUID 通常用于需要复制的情况，以避免来自不同位置的冲突主键的复杂性。

如果我在不使用复制的系统上工作，我通常会避免使用 GUID 的复杂性和开销。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T10:24:11.267

有（至少）两种情况下 Guid 真的很有用。

1.  通过复制或任何类型的多站点设置，数据库将被合并，Guid 使其变得更加容易。在这种情况下也可以使用 Int 键，但 Guid 更容易并且会出现更少的问题。
2.  在插入之前生成密钥客户端而不需要往返数据库可能非常有用。

# c++ - 减少C++编译时间的产品？

> ID：479312
> 
> 赞同：4
> 
> 时间：2009-01-26T10:14:37.027
> 
> 标签：c++, compile-time

是否有任何产品可以减少 c++ 构建时间？可以与msvc一起使用吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-26T10:22:45.543

如果它必须是一个产品，请查看[Xoreax IncrediBuild](http://www.xoreax.com/)，它将构建分发到网络上的机器。

除此之外：

*   坚固的构建机器。适合的 RAM，使用快速的单独磁盘。
*   拆分成单独的项目（DLL、库）。它们也可以并行构建（使用双四核/核，并且很容易被磁盘瓶颈）
*   标头的智能使用，包括预编译的标头。这并不容易，而且通常还有其他利益相关者。 [PIMPL](http://en.wikipedia.org/wiki/Opaque_pointer)也有帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-26T10:25:24.477

使用[预编译头文件](http://msdn.microsoft.com/en-us/library/9d87zb00(VS.71).aspx)可能会减少您的编译时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T17:03:54.873

看看[MPCL](http://todobits.es/mpcl.html)。

这是一个适用于 Microsoft Visual C++ 2005 和 Visual C++2008 的插件，它可以最大限度地利用 CPU，从而最大限度地减少项目的编译时间。

它并行编译同一项目的几个 .c / .cpp 文件以实现它。当您拥有双核/四核/多核处理器时，这特别有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T10:31:04.230

您是否考虑过共享构建服务器？MSVC 将在终端服务器中运行，您可以将 CPU、RAM 和快速磁盘的成本分摊给开发团队。作为附带的好处，此终端服务器还可以容纳版本控制系统，因此结帐速度很快。

# java - 按下 Enter 后 JTable 值在另一个单元格中“跳转”

> ID：479317
> 
> 赞同：0
> 
> 时间：2009-01-26T10:16:57.753
> 
> 标签：java, swing, jtable

我正在使用 Java。我创建了一个 JTable，并且使表格的单元格可编辑。我的问题是，当我选择一个单元格并在其中写入一个值，然后单击 Enter 时，我输入的值不会留在我输入它的单元格中，而是跳转到表中某个位置的另一个单元格中。该值保持不变，但在其上是我输入的单元格。

我将表格的单元格表示为 Cell 类的实例。

默认情况下会发生一些事情，我不知道要更改什么才能使单元格的值保留在单元格中，尽管我在网上浏览了一些关于 JTables 的资料。你知道问题可能是什么，我应该在哪里查看代码以修复它？先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T10:28:45.220

看起来您的模型索引在某处被混淆了。

如果您使用的是 RowSorter，那么 JTable.getSelectedRow 将返回正在查看的行的索引，而不是模型中的行。您可以使用 RowSorter.convertRowIndexToModel() 来获取正确的索引。

仔细检查您的 JTableModel.setValueAt() 方法以确保单元格索引是您已编辑的单元格索引，并且您将新值存储在正确的位置。

# c# - 在私有类成员中正确使用关键字“this”是什么？

> ID：479322
> 
> 赞同：4
> 
> 时间：2009-01-26T10:19:00.557
> 
> 标签：c#, .net

何时应在 C# 类定义中使用关键字“this”？

在课堂内使用“this.Method()”形式是否标准？还是只使用“Method()”？我都看过，通常选择第二个，但我想了解更多关于这个主题的信息。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-26T10:22:01.440

大多数时候是多余的，可以省略；一些例外：

*   调用链式构造函数：`Foo() : this("bar") {}`
*   消除局部参数/变量和字段之间的歧义：`this.foo = foo;`等
*   在当前实例上调用**扩展**方法：（`this.SomeMethod();`定义为`public static SomeMethod(this Foo foo) {...}`）
*   将对当前实例的引用传递给外部方法：`Helper.DoSomething(this);`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T10:31:51.250

*这*主要用于在名称不明确时显式使用类成员，如下例所示：

```
public class FooBar
{
    private string Foo;
    private string Bar;

    public void DoWhatever(string Foo, string Bar)
    {
        // use *this* to indicate your class members
        this.Foo = Foo;
        this.Bar = Bar;
    }

    public void DoSomethingElse()
    {
        // Not ambiguity, no need to use *this* to indicate class members
        Debug.WriteLine(Foo + Bar);
    }
} 
```

除此之外，有些人更喜欢在内部方法调用前加上前缀（`this.Method()´），因为它更明显地表明您没有调用任何外部方法，但我认为这并不重要。

它绝对不会影响生成的程序或多或少的效率。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T10:23:04.903

当您所指的内容变得模棱两可时，我使用“this”，它具有与类变量/方法具有相同/相似名称的局部变量。

但这真的是个人喜好的事情，只是使用你觉得最好的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T10:21:24.813

总是……只有我的 2 美分

# .net - 删除以前版本的 .NET 框架是否安全？

> ID：479323
> 
> 赞同：9
> 
> 时间：2009-01-26T10:19:22.990
> 
> 标签：.net, .net-framework-version

我刚刚安装了 3.5 .NET Framework，在进行一些清理时，我注意到我安装了很多旧版本（1.1、1.1 Hotfix(xxx)、2.0、2.0 服务包等）。我想知道我是否可以安全地处理所有这些，或者如果我运行较低版本的 .net 应用程序，这些都是需要的。

提前致谢。

[这是安装 3.5 后安全卸载 .NET Framework 2.0 和 1.0](https://stackoverflow.com/questions/385893/safe-to-uninstall-net-framework-2-0-and-1-0-after-installing-3-5)的副本吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T10:23:03.763

使用此特定框架的应用程序需要一个框架。因此，如果您正在使用 2.0 或 1.0 应用程序（或将来），请不要卸载它们 - 否则：您可以像鸟一样自由地这样做:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T10:21:24.627

不，使用旧框架制作的应用程序仍需要安装它们。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T10:25:29.313

您仍然需要旧版本才能运行旧的 .net 应用程序。

此外，版本 3.0 和 3.5 实际上只是对 2.0 的扩展，因此要使 3.5 本身正常工作，您仍然需要安装 2.0。

通常只是不建议删除它们中的任何一个。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-26T10:36:31.693

恕我直言，您可以删除 .NET 1.0/1.1 - 我自己删除了它，没有看到任何应用程序需要它。

您不能删除 .NET 2.0，因为 3.0/3.5 只是扩展了 2.0 的功能 - 它的最大部分仍然包含在 2.0 中

# c# - 如何从具有参数的单个存储过程中返回多个表中的多个记录？

> ID：479328
> 
> 赞同：0
> 
> 时间：2009-01-26T10:20:49.807
> 
> 标签：c#, ado.net

假设我的存储过程是：

```
IF EXISTS (SELECT * FROM sysobjects WHERE type = 'P' AND name = 'sp_QB_descriptionwise_select')
    BEGIN
        DROP  Procedure  sp_QB_descriptionwise_select
    END
GO
CREATE Procedure sp_QB_descriptionwise_select
    (
        @description nvarchar(max)
    )
AS

declare @type int
SELECT     Question.questionid, Question.question, Question.answer, Question.typeOfQuestion, QuestionBank.description
FROM         QuestionBank INNER JOIN
                      Question ON QuestionBank.questionid = Question.questionid
WHERE     (QuestionBank.description = @description)

SELECT     @type = Question.typeOfQuestion
FROM         QuestionBank INNER JOIN
                      Question ON QuestionBank.questionid = Question.questionid
WHERE     (QuestionBank.description = @description)

if @type=1
begin
SELECT     OptionQuestion.option1, OptionQuestion.option2, OptionQuestion.option3, OptionQuestion.option4
FROM         OptionQuestion INNER JOIN
                      Question ON OptionQuestion.questionid = Question.questionid
end
GO 
```

我怎样才能以什么方式存储记录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T10:58:52.147

使用`IDataReader`/ `ExecuteReader`，您应该能够使用：

```
 using (IDataReader reader = cmd.ExecuteReader())
    {
        do
        {
            while (reader.Read())
            {
                /* row */
            }
        } while (reader.NextResult()); /* grid */
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T17:27:36.170

DataSetCommand.selectCommand 接受参数为 sqlcommand.commandText，sqlConnction 在这种情况下如何传递参数？？？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T11:03:22.200

使用 DataSetAdapter.Fill() 方法调用您的存储过程。它将使用所有结果表填充您的数据集。如果您使用类型化数据集，请确保设置表映射（填充 DataSetAdapter.TableMappings 集合）。详情可在 MSDN 上找到

# c# - 如何绑定列表 到 DataGridView 控件？

> ID：479329
> 
> 赞同：88
> 
> 时间：2009-01-26T10:21:02.677
> 
> 标签：c#, binding, datagridview

我有一个简单的`List<string>`，我希望它显示在一个`DataGridView`列中。
如果列表将包含更复杂的对象，只需将列表建立为其`DataSource`属性的值。

但是当这样做时：

```
myDataGridView.DataSource = myStringList; 
```

我得到一个名为的列`Length`，并显示字符串的长度。

如何在列中显示列表中的实际字符串值？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2010-07-12T04:34:29.800

试试这个：

```
IList<String> list_string= new List<String>();
DataGridView.DataSource = list_string.Select(x => new { Value = x }).ToList();
dgvSelectedNode.Show(); 
```

我希望这有帮助。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-01-26T11:01:38.973

那是因为 DataGridView 查找包含对象的属性。对于字符串，只有一个属性 - 长度。所以，你需要一个这样的字符串的包装器

```
public class StringValue
{
    public StringValue(string s)
    {
        _value = s;
    }
    public string Value { get { return _value; } set { _value = value; } }
    string _value;
} 
```

然后将`List<StringValue>`对象绑定到您的网格。有用

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-11-15T23:47:25.277

只要您绑定到任何实现 IEnumerable<string> 的东西，以下内容就应该有效。它将列直接绑定到字符串本身，而不是绑定到该字符串对象的属性路径。

```
<sdk:DataGridTextColumn Binding="{Binding}" /> 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-07-07T05:32:11.653

您还可以使用 linq 和匿名类型以更少的代码实现相同的结果，如此[处](http://web.archive.org/web/20100623020947/http://mokosh.co.uk/post/2009/07/06/binding-list-of-strings-not-as-easy-as-it-seems/)所述。

更新：博客已关闭，这是内容：

(..) 表中显示的值表示字符串的长度而不是字符串值 (!) 这可能看起来很奇怪，但这就是绑定机制默认的工作方式——给定一个对象，它将尝试绑定到该对象的第一个属性对象（它可以找到的第一个属性）。当传递一个实例时，它绑定到的 String 类的属性是 String.Length，因为没有其他属性可以提供实际的字符串本身。

这意味着要获得正确的绑定，我们需要一个包装器对象，它将字符串的实际值作为属性公开：

```
public class StringWrapper
    {
     string stringValue;
     public string StringValue { get { return stringValue; } set { stringValue = value; } }

     public StringWrapper(string s)
     {
     StringValue = s;
     }
  }   

   List<StringWrapper> testData = new List<StringWrapper>();

   // add data to the list / convert list of strings to list of string wrappers

  Table1.SetDataBinding(testdata); 
```

虽然此解决方案按预期工作，但它需要相当多的代码行（主要是将字符串列表转换为字符串包装器列表）。

我们可以通过使用 LINQ 和匿名类型来改进这个解决方案——我们将使用 LINQ 查询来创建一个新的字符串包装器列表（在我们的例子中，字符串包装器将是一个匿名类型）。

```
 var values = from data in testData select new { Value = data };

 Table1.SetDataBinding(values.ToList()); 
```

我们要做的最后一个更改是将 LINQ 代码移动到扩展方法：

```
public static class StringExtensions
  {
     public static IEnumerable CreateStringWrapperForBinding(this IEnumerable<string> strings)
     {
     var values = from data in strings
     select new { Value = data };

     return values.ToList();
     } 
```

这样我们就可以通过在任何字符串集合上调用单个方法来重用代码：

```
Table1.SetDataBinding(testData.CreateStringWrapperForBinding()); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-03-03T15:08:15.700

这是常见问题，另一种方法是使用 DataTable 对象

```
DataTable dt = new DataTable();
dt.Columns.Add("column name");

dt.Rows.Add(new object[] { "Item 1" });
dt.Rows.Add(new object[] { "Item 2" });
dt.Rows.Add(new object[] { "Item 3" }); 
```

这个问题在这里详细描述：[http ://www.psworld.pl/Programming/BindingListOfString](http://www.psworld.pl/Programming/BindingListOfString)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-08-08T13:23:31.510

通过 LINQ 分配非常大的列表时，您可能会遇到性能问题。以下解决方案适用于大型列表且无需子类化字符串：

将 DataGridView（此处为“视图”）设置为虚拟模式，创建您需要的列并覆盖/注册事件 CellValueNeeded

```
private void View_CellValueNeeded(object sender, DataGridViewCellValueEventArgs e)
{
    // Optionally: check for column index if you got more columns
    e.Value = View.Rows[e.RowIndex].DataBoundItem.ToString();
} 
```

那么您可以简单地将您的列表分配给 DataGridView：

```
List<String> MyList = ...
View.DataSource = MyList; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-11-09T20:35:44.283

试试这个 ：

```
//i have a 
List<string> g_list = new List<string>();

//i put manually the values... (for this example)
g_list.Add("aaa");
g_list.Add("bbb");
g_list.Add("ccc");

//for each string add a row in dataGridView and put the l_str value...
foreach (string l_str in g_list)
{
    dataGridView1.Rows.Add(l_str);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-03-30T18:39:26.270

另一种方法是使用一个新的辅助函数，该函数将从 List 中获取值并在 DataGridView 中更新，如下所示：

```
 private void DisplayStringListInDataGrid(List<string> passedList, ref DataGridView gridToUpdate, string newColumnHeader)
    {
        DataTable gridData = new DataTable();
        gridData.Columns.Add(newColumnHeader);

        foreach (string listItem in passedList)
        {
            gridData.Rows.Add(listItem);
        }

        BindingSource gridDataBinder = new BindingSource();
        gridDataBinder.DataSource = gridData;
        dgDataBeingProcessed.DataSource = gridDataBinder;
    } 
```

然后我们可以通过以下方式调用这个函数：

```
 DisplayStringListInDataGrid(<nameOfListWithStrings>, ref <nameOfDataGridViewToDisplay>, <nameToBeGivenForTheNewColumn>); 
```

# c++ - 如何获取窗口标题按钮的大小和位置（最小化、恢复、关闭）

> ID：479332
> 
> 赞同：7
> 
> 时间：2009-01-26T10:21:27.620
> 
> 标签：c++, winapi, mfc, windows-vista, uxtheme

是否有 API 调用来确定窗口标题按钮的大小和位置？我正在尝试将 vista 样式的标题按钮绘制到所有者绘制的窗口上。我正在处理 c/c++/mfc。

编辑：有没有人有一个代码示例来绘制关闭按钮？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T11:42:51.887

我找到了在 vista 中获取按钮位置所需的功能：[WM_GETTITLEBARINFOEX](https://docs.microsoft.com/en-us/windows/desktop/menurc/wm-gettitlebarinfoex)

此链接还显示了使所有间距正确所需的系统指标（但遗憾的是它不是完整的对话框图片）。这在 Vista 中非常有效，并且主要在 XP 中（在 XP 中，按钮之间的间隙有点过大）。

[![来自 http://shellrevealed.com/photos/blog_images/images/4538/original.aspx](https://i.stack.imgur.com/TR01p.png)](https://i.stack.imgur.com/TR01p.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T10:28:40.850

[GetSystemMetrics](http://msdn.microsoft.com/en-us/library/ms724385.aspx)提供所有这些信息。要在窗口装饰中绘制，请使用[GetWindowDC](http://msdn.microsoft.com/en-us/library/ms534830(VS.85).aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-15T07:19:40.723

以下代码改编自我在[http://www.catch22.net/content/snippets](http://www.catch22.net/content/snippets)找到的“全局标题栏挂钩”示例。我修改了示例以使其对 MFC 友好。它返回最左侧标题栏按钮的 X 坐标，但可以轻松修改它以查找任何按钮的位置。

```
#define B_EDGE 2

int CMyWindow::CalcRightEdge()
{
 if(GetStyle() & WS_THICKFRAME)
  return GetSystemMetrics(SM_CXSIZEFRAME);
 else
  return GetSystemMetrics(SM_CXFIXEDFRAME);
}

int CMyWindow::findNewButtonPosition()
{
 int   nButSize  = 0;
 DWORD dwStyle   = GetStyle();
 DWORD dwExStyle = GetExStyle();

 if(dwExStyle & WS_EX_TOOLWINDOW)
 {
  int nSysButSize = GetSystemMetrics(SM_CXSMSIZE) - B_EDGE;

  if(GetStyle() & WS_SYSMENU) 
   nButSize += nSysButSize + B_EDGE;

  return nButSize + CalcRightEdge();
 }
 else
 {
  int nSysButSize = GetSystemMetrics(SM_CXSIZE) - B_EDGE;

 // Window has Close [X] button. This button has a 2-pixel
 // border on either size
  if(dwStyle & WS_SYSMENU) 
   nButSize += nSysButSize + B_EDGE;

 // If either of the minimize or maximize buttons are shown,
 // Then both will appear (but may be disabled)
 // This button pair has a 2 pixel border on the left
  if(dwStyle & (WS_MINIMIZEBOX | WS_MAXIMIZEBOX) )
   nButSize += B_EDGE + nSysButSize * 2;

 // A window can have a question-mark button, but only
 // if it doesn't have any min/max buttons
  else if(dwExStyle & WS_EX_CONTEXTHELP)
   nButSize += B_EDGE + nSysButSize;

 // Now calculate the size of the border...aggghh!
  return nButSize + CalcRightEdge();
 }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T10:29:39.180

[GetSystemMetrics](http://msdn.microsoft.com/en-us/library/ms724385.aspx)函数应该可以帮助您确定大小（SM_CYSIZE 和 SM_CXSIZE 参数）。

**编辑**

我不确定您是否可以使用此功能找到位置，但您可能会查看[emule 源代码](http://www.emule-project.net/home/perl/general.cgi?l=13&rm=download)，他们已设法将按钮添加到窗口标题。

# svn - 错误 MSB1009：从CruiseControl 运行时项目文件不存在

> ID：479337
> 
> 赞同：2
> 
> 时间：2009-01-26T10:22:49.927
> 
> 标签：svn, nunit, cruisecontrol.net

以下是我的 ccnet.config 文件，从 ccnet 网页运行此文件时，出现错误 MSB1009：项目文件不存在。任何想法我做错了什么

```
 <project>
      <name>ITR Test</name>
      <webURL>http://localhost/ccnet/</webURL>

      <triggers>
        <intervalTrigger name="continuous" seconds="30" initialSeconds="30"/>
      </triggers>

      <modificationDelaySeconds>2</modificationDelaySeconds>

      <sourcecontrol type="svn">
        <executable>c:\program files\subversion\bin\svn.exe</executable>
        <trunkUrl>svn://ka/le/TestReports</trunkUrl>
        <workingDirectory>
          C:\source\TestReports\ITRTests\ITRTests\ITRTests
        </workingDirectory>
        <username></username>
        <password></password>
      </sourcecontrol>

      <tasks>
        <!-- Use MsBuild to build the .Net solution-->
        <msbuild>
          <executable>C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe</executable>
          <workingDirectory>
            C:\source\TestReports\ITRTests\ITRTests\
          </workingDirectory>
          <projectFile>ITRTests.sln</projectFile>
          <targets>RunAutomationTests</targets>
          <timeout>15</timeout>
        </msbuild>

        <!-- Use NUnit for unit testing-->
        <nunit path="C:\Program Files\NUnit 2.4.8\bin\nunit-console.exe">
          <assemblies>
            <!--Path to Visual Studio project executable-->
            <assembly>
              C:\source\TestReports\ITRTests\ITRTests\ITRTests\bin\Debug\ITRTests.dll
            </assembly>
          </assemblies>
        </nunit>

        <!-- Email notification to users -->
        <email from="xxx@example.com" mailhost="hostname" mailport="25" includeDetails="TRUE"
             mailhostUsername="username" mailhostPassword="password" useSSL="FALSE" >
          <users>
            <!-- <user name="LeadDeveloper" group="buildmaster" address="mailto:aaa@aaa.com /> -->
            <!-- <user name="Developer1" group="developers" address="mailto:bbb@bbb.com /> -->
          </users>
          <groups>
            <!-- <group name="buildmaster" notification="always" /> -->
            <!-- <group name="developers" notification="change" /> -->
          </groups>
        </email>

      </tasks>

      <publishers>
        <merge>
          <files>
            <file>C:\source\TestReports\ITRTests\ITRTests\ITRTests\bin\Debug\TestResult.xml</file>
          </files>
        </merge>
        <xmllogger/>
      </publishers>

    </project>
  </cruisecontrol> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T15:22:34.730

您的源代码控制块似乎将代码放在“C:\source\TestReports\IRTTests\IRTTests\IRTTests”中（注意“IRTTests”的三个级别），但 msbuild 任务的工作目录为“C:\source\TestReports \IRTTests\IRTTests\"（只有两个级别的 'IRTTests'）

# asp.net - 网格视图中的不同图像

> ID：479341
> 
> 赞同：1
> 
> 时间：2009-01-26T10:23:35.730
> 
> 标签：asp.net, sql, gridview, image

我有一个与 ASP.NET 中的 gridviews 相关的问题

我有一个网格视图，我从 SQL 数据库中提取信息，它显示用户名和当前状态 IE；

*   用户名 | 地位
*   用户1 | 登出
*   用户2 | 登录
*   用户3 | 休假

所以这一切都很方便，但是我想做的是显示状态文本，我想显示一个不同颜色的“子弹型”图像。红色、绿色、橙色、蓝色 - 用于不同的状态。

我是否需要以某种方式将这些图像放入数据库，或者我可以使用某种 IF 语句来说明，如果状态为“1 - 登录”然后显示“green.png”？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T10:33:26.957

尝试设置相应的CSS Class，然后设置CSS使用合适的Background Image。我认为你不能使用 BoundField，但你必须使用这样的 TemplateField：

```
<asp:TemplateField>
    <ItemTemplate>
        <div class="StateBar State<%#eval("State") %>">&nbsp;</div>
    </ItemTemplate>
</asp:TemplateField> 
```

然后有一个这样的CSS：

```
.StateBar{
display:block;
width:10px;
height:10px;
}

.StateLoggedOut{
background-image:url(/images/...);
} 
```

提示：尝试使状态字段不带“”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T10:33:27.597

你有两种方法来实现这一点：

1 - 修改您的查询，使图像 url 直接出现在列中 2 - 在网格结构上进行图像选择。

无论哪种方式，您都必须创建一个包含图像的模板列。

你需要帮助吗？

# python - 如何在 python 中构建递归函数？

> ID：479343
> 
> 赞同：41
> 
> 时间：2009-01-26T10:24:54.010
> 
> 标签：python, recursion

如何在 python 中构建递归函数？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-01-26T10:28:57.120

我想知道您是否指的是“递归”。这是计算[阶乘函数](http://en.wikipedia.org/wiki/Factorial)的递归函数的简单示例：

```
def factorial(n):
    if n == 0:
        return 1
    else:
        return n * factorial(n - 1) 
```

递归算法的两个关键要素是：

*   终止条件：`n == 0`
*   函数每次以较小的数字调用自身的缩减步骤：`factorial(n - 1)`

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-26T19:25:42.373

Python 中的递归与其他语言中的递归一样工作，递归构造是根据自身定义的：

例如，递归类可以是二叉树（或任何树）：

```
class tree():
    def __init__(self):
        '''Initialise the tree'''
        self.Data = None
        self.Count = 0
        self.LeftSubtree = None
        self.RightSubtree = None

    def Insert(self, data):
        '''Add an item of data to the tree'''
        if self.Data == None:
            self.Data = data
            self.Count += 1
        elif data < self.Data:
            if self.LeftSubtree == None:
                # tree is a recurive class definition
                self.LeftSubtree = tree()
            # Insert is a recursive function
            self.LeftSubtree.Insert(data)
        elif data == self.Data:
            self.Count += 1
        elif data > self.Data:
            if self.RightSubtree == None:
                self.RightSubtree = tree()
            self.RightSubtree.Insert(data)

if __name__ == '__main__':
    T = tree()
    # The root node
    T.Insert('b')
    # Will be put into the left subtree
    T.Insert('a')
    # Will be put into the right subtree
    T.Insert('c') 
```

如前所述，递归结构必须具有终止条件。在这个类中，它并不那么明显，因为它只在添加新元素时才会递归，并且只会额外执行一次。

另外值得注意的是，python 默认情况下对可用的递归深度有限制，以避免占用计算机的所有内存。在我的计算机上这是 1000。我不知道这是否会根据硬件等而改变。要查看您的：

```
import sys
sys.getrecursionlimit() 
```

并设置它：

```
import sys #(if you haven't already)
sys.setrecursionlimit() 
```

编辑：我不能保证我的二叉树是有史以来最有效的设计。如果有人可以改进它，我很高兴听到如何

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T10:35:04.520

假设您要构建： u(n+1)=f(u(n)) with u(0)=u0

一种解决方案是定义一个简单的递归函数：

```
u0 = ...

def f(x):
  ...

def u(n):
  if n==0: return u0
  return f(u(n-1)) 
```

不幸的是，如果你想计算 u 的高值，你会遇到堆栈溢出错误。

另一个解决方案是一个简单的循环：

```
def u(n):
  ux = u0
  for i in xrange(n):
    ux=f(ux)
  return ux 
```

但是，如果您想要多个 u 值用于不同的 n 值，则这是次优的。您可以将所有值缓存在一个数组中，但您可能会遇到内存不足错误。您可能想改用生成器：

```
def u(n):
  ux = u0
  for i in xrange(n):
    ux=f(ux)
  yield ux

for val in u(1000):
  print val 
```

还有很多其他选择，但我想这些是主要的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T17:07:15.447

递归函数示例：

```
def recursive(string, num):
    print "#%s - %s" % (string, num)
    recursive(string, num+1) 
```

运行它：

```
recursive("Hello world", 0) 
```

# c# - 如何将较小的表与 .NET 实体一起放置在域和数据库中

> ID：479351
> 
> 赞同：0
> 
> 时间：2009-01-26T10:28:55.187
> 
> 标签：c#, database, entity-framework

我有一个重要的对象，它有很多属性。现在很少有属性可以有多个值，例如考虑一个具有一个或多个生产者的通道对象（现在我们的客户认为可能只有少数生产者，例如 1 或 2 ）。几乎 7 个属性存在相同的问题。

现在我有两个解决方案；

> 1.  在设计中将它们作为链接对象嵌入并在数据库中创建单独的表，从而将它们实现为实体（考虑到每个生产者都是唯一的）。但是这个解决方案意味着这个表将依赖于另外 8 个表才能具有这种能力。
>     
>     
> 2.  将它们作为链接/引用对象嵌入域中，但不要为它们创建单独的表，而是将它们存储为 CSV 格式并让 DAL 执行访问/检索逻辑。因此节省了 DB 端和 DAL 端的空间和关系。但也有 OOP 的力量。

尽管第二个解决方案似乎看起来很笨拙且有效，但它具有设计限制和松散的灵活性，但客户再次坚持认为他们只需要自由文本属性。

为了进一步解释这个问题，结构可能是这样的

```
Channel
  Name, (free text)
  Vanue, (free Text)
 .......
  Producer1, Producer2...... (each producer is just a name)
  OpeningDay1,OpeningDay2,..... (each entry is just time slot) 
```

ETC

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T10:46:00.630

我认为你可以结合这两种方法来给出一个好的整体结果。为 Producer 等创建单独的表，然后使用域对象从这些表中读取一次值并缓存结果。这样你就可以

1) 维护数据库中的引用完整性，利用数据库备份等，2) 消除跨 8 个表连接以返回单个实体的性能损失 3) 减少对单独的持久性方法、CSV 文件等的依赖。

这种方法在参考数据表中很常见，这些值通常是小的、“缓慢变化”的表，可以安全地缓存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T18:39:16.197

如何创建与也知道其类型的实体的单一关系。即生产者或条目等。

# svn - 从 SVN 存储库更新时，是否也可以更新另一个存储库？

> ID：479353
> 
> 赞同：1
> 
> 时间：2009-01-26T10:29:21.940
> 
> 标签：svn, tortoisesvn

**问题：**我经常需要更新两个或多个存储库：一个用于我正在处理的项目，一个或多个库。有没有办法“链接”更新，以便每次我更新*项目 X*时，*库 Y*也会更新？

我知道，这是一个不寻常的问题，因为我猜这样的事情将成为构建过程的一部分，但由于这些事情现在在我的工作场所，这是不可能的（还）。

我将 SVN 1.5 与 TortoiseSVN 一起使用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T10:31:48.160

听起来你应该可以使用[svn:externals](http://svnbook.red-bean.com/en/1.0/ch07s03.html)来完成。本质上它所做的是将外部（单独的）svn-repository 中的“链接”到工作副本中的目录中。

Tortoise 对 externals 有很好的支持，允许您选择是否将 externals 作为 WC-export 的一部分导出。[您可以在http://justaddwater.dk/](http://justaddwater.dk/2007/10/23/setting-up-subversion-externals-with-tortoisesvn/)找到 TortoiseSVN 和外部的快速介绍。它可能有点过时，但它应该让你开始。[乌龟 svn 指南](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-howto-common-projects.html#tsvn-howto-common-externals)也提供了一些指导。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T10:31:40.877

查看[SVN Externals Definition](http://svnbook.red-bean.com/en/1.0/ch07s03.html)应该做你想做的事。

# iphone - 由于未捕获的异常，iPhone 应用程序终止

> ID：479355
> 
> 赞同：1
> 
> 时间：2009-01-26T10:29:55.653
> 
> 标签：iphone, objective-c, cocos2d-iphone

嗨，我正在使用 cocos2d 开发一个 iphone 应用程序。它显示了这个消息。

```
2009-01-26 16:17:40.603 Find The Nuts[449:20b] *** -[NSCFArray onTimer:]: unrecognized selector sent to instance 0x59be030
2009-01-26 16:17:40.605 Find The Nuts[449:20b] *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '*** -[NSCFArray onTimer:]: unrecognized selector sent to instance 0x59be030' 
```

这里的 onTimer 是一个倒计时方法。它的解决方案是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T11:13:16.923

由于某种原因，您的 onTimer 方法被发送到 NSArray 的实例。您可能不小心将它发送到 NSArray 的真实实例，或者您真正尝试将其发送到的对象在计时器实际触发时已被释放（也就是不再可访问）。

我会尝试进行一些内存调试，以确定您的计时器目标是否在不适当的时间被释放。如果一切正常，请确认您确实将计时器目标设置为正确的对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-15T03:22:48.070

The unrecognized selector error is most likely because you are passing the wrong text for the @selector parameter. Selector names MUST include ':' attributes whenever there is a parameter in the signature. So, if you have a timer method

```
-(void) onTimer:(NSTimer*)timer { ... } 
```

The selecter you pass to `scheduledTimerWithTimeInterval` must be:

```
@selector(onTimer:)   // note the ':' at the end of the name! 
```

The full call to NSTimer, would then look something like:

```
[NSTimer scheduledTimerWithTimeInterval:1 
                                 target:self 
                               selector:@selector(OnTimer:) // note the ':'
                               userInfo:nil
                                repeats:NO]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T10:54:10.813

听起来您没有为计时器提供有效的方法来在倒计时完成时调用。您需要将方法选择器和目标都设置为有效对象。见下面的例子：

```
[NSTimer scheduledTimerWithTimeInterval: 1.0 target:self selector:@selector(onTimer) userInfo:nil repeats:YES];

- (void)onTimer {
     NSLog(@"hello!"];
} 
```

也许目标在它返回之前就被释放了？

您也可以尝试添加以下断点，这些断点将在发生异常时捕获。

objc_exception_throw 和 -[NSException raise]。在 iPhone 上，我认为所有异常都通过 objc_exception_throw 传播，但如果您的目标是 Mac OS X Tiger 或更早版本，您应该在两者上设置断点。

[在http://www.cocoadev.com/index.pl?DebuggingTechniques](http://www.cocoadev.com/index.pl?DebuggingTechniques)有更多的调试技术。

托尼

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T06:21:35.640

为什么在 NSArray 对象上调用 onTimer 方法？根据您的描述，我相信 onTimer 有这个定义

```
-(void)onTimer:(NSTimer *)aTimer 
```

在这种情况下，onTimer 是您的视图控制器（或您创建的另一个类）的方法，但不是数组的方法。你是如何调用定时器的？启动将调用此方法的计时器的正确方法是

```
[NSTimer scheduledTimerWithTimeInterval: 1.0 target:self selector:@selector(onTimer:) userInfo:nil repeats:YES]; 
```

发生此错误的原因是您没有正确调用计时器，或者您正在使用某些已被释放的对象。

# svn - Can I move an existing Subversion repository into a new parent repository (and retain the history)?

> ID：479361
> 
> 赞同：30
> 
> 时间：2009-01-26T10:31:49.423
> 
> 标签：svn

Currently I have a root-level repository set up for each project, like so:

```
Project1
Project2
Project3
Project5
Project5 
```

I'd like to reorganise this so that rather than a repository for each individual project, I just have one for each logical grouping, and then the projects would just be folders within those 'group repositories', e.g:

```
WebSites
    Project1
    Project2
DesktopApps
    Project3
Libraries
    Project4
    Project5 
```

Is this at all possible while retaining the history of the existing repositories? I've looked around quite a bit but all I can find is stuff on moving folders about within the same repository, and moving folders out of a repository into a new repository.

It's only for personal stuff anyway, so it's not the end of the world if it's just a straight 'no' - but it would be nice to know so I'm not just banging my head against a wall :)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-26T10:40:02.420

You should be able to dump it, then reload it to a subdirectory of a new repository:

> svnadmin dump [http://oldrepo/](http://oldrepo/) > mydump
> 
> svnadmin load --parent-dir my/new/folder [http://newrepo/](http://newrepo/) < mydump

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-26T10:51:48.697

[svnbook: Migrating Repository Data Elsewhere](http://svnbook.red-bean.com/nightly/en/svn.reposadmin.maint.html#svn.reposadmin.maint.migrate)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T10:40:29.297

You can use [tailor](http://progetti.arstecnica.it/tailor/) to import the revisions into the new repository. It checks out the code from the old repository one revision after another and commits it to the new repository.

This can also be used to convert the history of one type of version control system to another.

An tailor project file would look like this:

```
[DEFAULT]
root-directory = /var/tmp/tailor
verbose = true

[myproject]
source = svn:oldrepo
target = svn:newrepo
start-revision = INITIAL

[svn:oldrepo]
repository = svn://oldhost.example.com/svnroot
module = trunk
subdir = repo-in

[svn:newrepo]
repository = svn://newhost.example.com/some/path
module = trunk
subdir = repo-out 
```

If this file is called `settings.cfg`, this will copy `/trunk` of the old repository revison by revison to the new location:

```
tailor --configfile=settings.cfg myproject 
```

The target repository needs to already exist and probably should have an empty `trunk` subdirectory.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-02-20T09:54:12.123

Since the accepted answer is incomplete and hasn't been corrected, here's how you actually do it.

(1) Your source repo is a single-project repo, with top-level dir `foo`. Go to your old server and create a dump file:

```
[old-server]$ svnadmin dump /path/to/old-repo > foo.dump 
```

(2) Your target repo already contains two projects, with top-level dirs `bar` and `baz`, and is at `http://new-server/svn`. Now create an additonal `foo` top level:

```
[client]$ svn ls http://new-server/svn/
bar/
baz/
[client]$ svn mkdir -m "Adding new foo project" http://new-server/svn/foo
[client]$ svn ls http://new-server/svn/
bar/
baz/
foo/ 
```

(3) On your new server, the repo is at `/path/to/new-repo` (which is what `http://new-server/svn/` maps to). Note that the `svn mkdir` above didn't actually create a new directory in `/path/to/new-repo`; it just changed the database. Go to the new server and

```
[new-server]$ svnadmin load /path/to/new-repo --parent-dir foo < foo.dump 
```

Done, with complete history. You can now check out `foo` as:

```
[client]$ svn co http://new-server/svn/foo foo 
```

If this is the first time you've done an `svnadmin`, you may find that you get file permission errors (`txn-current-lock`/etc) if, for example, the repo is owned by `apache`, and you're not in the `apache` group. The easiest fix is to add yourself to the `apache` group.

# c# - Main() 中的代码可访问或不可访问取决于打开另一个表单

> ID：479368
> 
> 赞同：0
> 
> 时间：2009-01-26T10:34:13.493
> 
> 标签：c#, pocketpc

我有一些袖珍电脑应用程序，我遇到了一个严重的问题，描述如下：[https](https://stackoverflow.com/questions/472598) ://stackoverflow.com/questions/472598 。在寻找解决方案时，我在 Main() 中尝试了一些实际上非常愚蠢的代码：

```
[MTAThread]
        static void Main()
        {
            Application.Run(new Tasks());
            Application.Exit();
        } 
```

并在退出时设置断点。如果我只是运行应用程序然后关闭窗口，就会到达断点。如果我运行应用程序然后打开另一个窗口：

```
private void questButton_Click(object sender, EventArgs e)
        {
            QuestionnairesWindow questWindow = new QuestionnairesWindow();
            questWindow.Show();
            this.Hide();
} 
```

然后从它返回到初始窗口：

```
private void backButton_Click(object sender, EventArgs e)
        {
            Tasks tasksWindow = new Tasks();
            tasksWindow.Show();
            this.Close();
        } 
```

并以与第一次相同的方式关闭第一个， Apllication.exit() 代码永远不会到达，我的印象是应用程序并没有真正关闭（我无法再次打开它）。对不起，如果描述很复杂

编辑：问题是 - 任何想法为什么它的行为不同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T10:41:21.700

`new Tasks()`in`Main()`不是同一个对象`Tasks tasksWindow = new Tasks();`

你有 2 个任务对象，所以关闭第二个，第一个仍然存在并且永远不会消失。您需要传递给`QuestionnairesWindow` current 的引用`Tasks`。

您可以使用其他`QuestionnairesWindow`构造函数来做到这一点：

```
private Tasks tasks;

public QuestionnairesWindow(Tasks t)
{
  this.tasks = t;
} 
```

使用：

```
new QuestionnairesWindow(this).Show(); // where this = current `Tasks` created in `Main` 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T10:40:57.283

这条线似乎是问题所在：

```
Tasks tasksWindow = new Tasks(); 
```

如果我正确理解了您的代码，那么在您的 backButton_Click 中，您正在创建任务表单的一个**新**实例，而不是显示您最初隐藏的那个。这意味着应用程序永远不会终止，因为仍然有一个窗口打开，但被隐藏了。

您可能想要做的是将 Tasks 表单引用传递给 QuestionnairesWindow 表单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T10:42:03.710

您遇到的问题是，在 backButton_Click 中，您正在创建任务窗口的**新**实例。原来的“任务”窗口仍在运行，只是被隐藏了。我怀疑您需要将对原始任务表单的引用传递到 QuestionnairesWindow 以便它可以选择再次显示它。

您需要在 QuestionnairesWindow 上添加一个公共/内部方法，您可以在其中设置哪些 Tasks 表单导致 QuestionnairesWindow 打开。**在调用 this.Hide() 之前，您可以使用this**引用在 questButton_Click 中调用此方法。此引用将存储在 QuestionnairesWindow 内的私有变量中。

然后在 backButton_Click 中，您使用这个私有变量来调用 .Show() 方法来显示父窗体。

# c++ - C++ cout 十六进制值？

> ID：479373
> 
> 赞同：174
> 
> 时间：2009-01-26T10:37:48.163
> 
> 标签：c++, hex, cout

我想要做：

```
int a = 255; 
cout << a; 
```

并让它在输出中显示 FF，我该怎么做？

* * *

## 回答 #1

> 赞同：238
> 
> 时间：2009-01-26T10:39:42.187

利用：

```
#include <iostream>

...

std::cout << std::hex << a; 
```

还有[许多其他选项可以控制输出数字的确切格式](http://en.cppreference.com/w/cpp/io/manip)，例如前导零和大写/小写。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-01-26T10:52:58.337

`std::hex`由 包含在`<ios>`其中定义`<iostream>`。但是要使用`std::setprecision/std::setw/std::setfill`/etc 之类的东西，您必须包含`<iomanip>`.

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-03-05T07:36:13.190

要操纵流以十六进制打印，请使用`hex`操纵器：

```
cout << hex << a; 
```

默认情况下，十六进制字符以小写形式输出。要将其更改为大写，请使用`uppercase`操纵器：

```
cout << hex << uppercase << a; 
```

要稍后将输出更改回小写，请使用`nouppercase`操纵器：

```
cout << nouppercase << b; 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2015-01-17T20:01:54.993

如果你想打印一个十六进制数字，然后恢复为十进制，你可以使用这个：

```
std::cout << std::hex << num << std::dec << std::endl; 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2019-02-01T18:44:15.003

`std::hex`为您提供十六进制格式，但它是一个有状态的选项，这意味着您需要保存和恢复状态，否则它将影响所有未来的输出。

天真地切换回`std::dec`只有在以前有标志的情况下才有用，情况可能并非如此，尤其是在您编写库时。

```
#include <iostream>
#include <ios>

...

std::ios_base::fmtflags f( cout.flags() );  // save flags state
std::cout << std::hex << a;
cout.flags( f );  // restore flags state 
```

这结合了 Greg Hewgill 的回答和来自[另一个问题](https://stackoverflow.com/a/2273352/461834)的信息。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-03-05T07:40:11.370

我知道这不是 OP 所要求的，但我仍然认为值得指出如何使用 printf 来做到这一点。我几乎总是更喜欢使用它而不是 std::cout （即使没有以前的 C 背景）。

```
printf("%.2X", a); 
```

“2”定义精度，“X”或“x”定义大小写。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2012-04-22T16:35:05.480

您也可以使用不同种类的标志和面具。请参阅[http://www.cplusplus.com/reference/iostream/ios_base/setf/](http://www.cplusplus.com/reference/iostream/ios_base/setf/)了解更多信息。

```
#include <iostream>
using namespace std;

int main()
{
    int num = 255;
    cout.setf(ios::hex, ios::basefield);
    cout << "Hex: " << num << endl;

    cout.unsetf(ios::hex);
    cout << "Original format: " << num << endl;

    return 0;
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2020-04-06T13:18:33.850

使用`std::uppercase`和`std::hex`格式化整数变量`a`以十六进制格式显示。

```
#include <iostream>
int main() {
   int a = 255;

   // Formatting Integer
   std::cout << std::uppercase << std::hex << a << std::endl; // Output: FF
   std::cout << std::showbase  << std::hex << a << std::endl; // Output: 0XFF
   std::cout << std::nouppercase << std::showbase  << std::hex << a << std::endl; // Output: 0xff

   return 0;
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-09-24T14:02:11.880

**C++20`std::format`**

在我看来，这是现在最干净的方法，因为它不会污染`std::cout`状态`std::hex`：

主文件

```
#include <format>
#include <string>

int main() {
    std::cout << std::format("{:x} {:#x} {}\n", 16, 17, 18);
} 
```

预期输出：

```
10 0x11 18 
```

尚未在 GCC 10.0.1、Ubuntu 20.04 上实现。

但是成为 C++20 的很棒的库，一旦安装后应该是一样的：

```
git clone https://github.com/fmtlib/fmt
cd fmt
git checkout 061e364b25b5e5ca7cf50dd25282892922375ddc
mkdir build
cmake ..
sudo make install 
```

main2.cpp

```
#include <fmt/core.h>
#include <iostream>

int main() {
    std::cout << fmt::format("{:x} {:#x} {}\n", 16, 17, 18);
} 
```

编译并运行：

```
g++ -ggdb3 -O0 -std=c++11 -Wall -Wextra -pedantic -o main2.out main2.cpp -lfmt
./main2.out 
```

记录在：

*   [https://en.cppreference.com/w/cpp/utility/format/format](https://en.cppreference.com/w/cpp/utility/format/format)
*   [https://en.cppreference.com/w/cpp/utility/format/formatter#Standard_format_specification](https://en.cppreference.com/w/cpp/utility/format/formatter#Standard_format_specification)

更多信息：[std::string 格式，如 sprintf](https://stackoverflow.com/questions/2342162/stdstring-formatting-like-sprintf/57286312#57286312)

**Pre-C++20：干净地打印并恢复`std::cout`到以前的状态**

主文件

```
#include <iostream>
#include <string>

int main() {
    std::ios oldState(nullptr);
    oldState.copyfmt(std::cout);
    std::cout << std::hex;
    std::cout << 16 << std::endl;
    std::cout.copyfmt(oldState);
    std::cout << 17 << std::endl;
} 
```

编译并运行：

```
g++ -ggdb3 -O0 -std=c++11 -Wall -Wextra -pedantic -o main.out main.cpp
./main.out 
```

输出：

```
10
17 
```

更多细节：[操作后恢复 std::cout 的状态](https://stackoverflow.com/questions/2273330/restore-the-state-of-stdcout-after-manipulating-it/30968371#30968371)

在 GCC 10.0.1、Ubuntu 20.04 上测试。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-12-22T14:10:26.147

你好吗！

```
#include <iostream>
#include <iomanip>

unsigned char arr[] = {4, 85, 250, 206};
for (const auto & elem : arr) {
    std::cout << std::setfill('0') 
              << std::setw(2) 
              << std::uppercase 
              << std::hex 
              << (0xFF & elem) 
              << " ";
} 
```

# .net - WPF .NET 每分钟触发一个事件的最佳方式

> ID：479376
> 
> 赞同：30
> 
> 时间：2009-01-26T10:38:38.037
> 
> 标签：.net, wpf, timer

我有一个应用程序需要每分钟检查一次数据库表。该表按一天中的时间编制索引，因此应用程序需要每分钟运行一次此检查。

这样做的最好方法是什么？我可以创建一个后台工作线程，但如果我在每次检查后将其设置为休眠 60 秒，我最终会因为调用检查的开销而错过一分钟。

我是否记得我检查的那一刻，然后检查，每 15 秒说一次，如果该分钟发生了变化，然后执行检查。

还是我应该使用其他方法？

我正在使用 WPF、VS2008 和 VB.NET

TIA,

西蒙

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-26T10:49:43.943

[DispatcherTimer](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchertimer.aspx)是您所追求的 - 只需设置所需的间隔，然后将方法附加到 Tick 事件 - 就可以了。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-01-26T10:56:25.617

正如 MrTelly 所说，DispatcherTimer 就是这样做的方法。它与 Dispatcher 队列紧密集成，并确保您的回调在正确的线程上。下面是一些关于这个类的好文章。下面是一些示例代码，详细说明了一个基本示例：

```
//  DispatcherTimer setup
DispatcherTimer dispatcherTimer = new System.Windows.Threading.DispatcherTimer();
dispatcherTimer.Tick += new EventHandler(dispatcherTimer_Tick);
dispatcherTimer.Interval = new TimeSpan(0,0,1);
dispatcherTimer.Start();

private void dispatcherTimer_Tick(object sender, EventArgs e)
{
    // Updating the Label which displays the current second
    lblSeconds.Content = DateTime.Now.Second;

    // Forcing the CommandManager to raise the RequerySuggested event
    CommandManager.InvalidateRequerySuggested();
} 
```

[Timer 与 DispatcherTimer](http://code.dortikum.net/2008/08/06/timer-vs-dispatchertimer-in-wpf/)

[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchertimer.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T10:50:10.887

不确定 WPF，但在 WinForms 中，有一个 Timer 控件。如果没有，一种方法是以下循环：

*   检查我们是否已经过了最后一分钟
*   如果没有，请睡一小会儿再检查
*   做东西
*   检查当前时间
*   节省一分钟
*   睡眠 60000 毫秒 - 当前时间（秒和毫秒部分） - 一些值

# c++ - c ++ cout自动大小写字符串？

> ID：479384
> 
> 赞同：0
> 
> 时间：2009-01-26T10:42:36.627
> 
> 标签：c++, cout, capitalization

是否可以做类似 cout << "my string"; 我的字符串大写了吗？据我所知，没有办法做到这一点？我需要把它包装在一个函数上

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T10:45:55.903

是的，您可以扩展 std:streambuf 请参阅此示例：[http ://www.java2s.com/Tutorial/Cpp/0240__File-Stream/Extendsstdstreambuftocreateoutputbuffer.htm](http://www.java2s.com/Tutorial/Cpp/0240__File-Stream/Extendsstdstreambuftocreateoutputbuffer.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T12:57:01.970

使用 Boost [string_algo](http://www.boost.org/doc/libs/1_37_0/doc/html/string_algo/usage.html#id3677164)库：

```
string myStr("my string");
to_upper(myStr);
cout << myStr; 
```

# xml - Microsoft.Reporting.* 与 XML/XSLT

> ID：479390
> 
> 赞同：6
> 
> 时间：2009-01-26T10:47:35.213
> 
> 标签：xml, xslt, reporting-services, reporting

我想向 .NET 应用程序添加报告功能。我的数据源只是应用程序的数据模型，即可能从任何东西（不一定来自数据库）生成或加载的一堆对象。

最初的计划是从这些对象生成报告数据 XML 文件，然后使用 XSLT 将其转换为 XHTML 报告文件。然后可以使用浏览器控件在应用程序中显示报告。

但是，我注意到存在 Microsoft.Reporting.* 命名空间，并且根据我的尝试，其中的类和控件似乎也可以处理我的报告。改用这个会是个好主意吗？与 XML/XSLT 方法相比，它会节省工作量吗？我可能会遇到 Microsoft Reporting 框架的哪些限制（如果有）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T11:30:06.093

有几件事需要考虑。

1) Reporting Services 是 Sql Server 的一部分，所以如果你走这条路，你可能会遇到额外的许可证问题。

2) Reporting Services 可以提供网页，或者在 WinForms 中使用完整的分页、排序、子报告、总计等 - 这在 XSL 中真的很难。它也可以很好地与打印机配合使用。

3) 报告服务带有一个所见即所得的编辑器来构建报告。它无论如何都不完美，但比手工制作要容易得多。

4) 使用 XSL 创建 XHTML 可能会影响性能。XSL 适用于整个 XML Dom，如果您正在处理多页报告，那可能是一个大文档。我希望 Reporting Services 能够更快地工作。

5) Reporting Services 可以利用整个 .Net，因此您可以免费获得许多其他功能。

考虑到所有这些，使用 Reporting Services 将节省您的时间，除非您的报告要求非常简单。虽然它不那么有趣。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-28T14:03:09.217

同意 MrTelly 的大部分评论，但有以下例外和补充：

*   除非你对你的 XSLT 很傻，而且你的报告数据是巨大的（100+ MB——我说的是提供报告的数据而不是源数据），否则性能不太可能是重要的问题。我们已经构建了一个 XML/XSLT 报告系统，它采用 .NET 数据集并将它们动态转换为报告，并且使用正确编写的 XSLT，性能主要是亚秒级（对于大型数据集，它可能更长，但对于 Web 应用程序来说并不可怕） .

*   使用 XML/XSLT 解决方案的报表布局本质上是不受限制的，使用 Reporting Services，您只能使用 RDL（Microsoft 的报表定义语言）中的结构。如果您需要比标准报告结构更复杂的东西，Reporting Services 将令人沮丧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T05:03:25.920

[Data Dynamics Reports](http://www.datadynamics.com/Products/DDRPT/Default.aspx)和[ActiveReports](http://www.datadynamics.com/Products/ProductOverview.aspx?Product=ARNET3)（以及其他第三方 .NET 工具）也可以直接从对象报告，并具有对开发人员友好的许可政策。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-16T14:12:50.820

似乎您也可以从您的对象生成 xml，然后也可以从该 XMl 创建您的本机 ReportViewer 报告

使用 ReportViewer 从 XML 文档构建报告

[http://www.c-sharpcorner.com/UploadFile/mahesh/XmlReports04182007115639AM/XmlReports.aspx](http://www.c-sharpcorner.com/UploadFile/mahesh/XmlReports04182007115639AM/XmlReports.aspx)

# flickr - 来自 flickr api 的自定义图像大小？

> ID：479395
> 
> 赞同：4
> 
> 时间：2009-01-26T10:51:23.583
> 
> 标签：flickr

有没有办法从自定义宽度/高度的 flickr api 获取图像？我发现只有标准函数`flickr.photos.getSizes`，但这个函数只返回预定义的大小。谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-26T11:11:27.927

据我所知，flickr 无法为您调整照片大小（默认选项除外） 根据您正在构建的系统，有几个选项：

*   使用 flickr 提供的尺寸之一... ;-)
*   如果您使用 HTML：通过设置图像的宽度和高度在浏览器中调整图像大小（确保在 IE 中启用正确的设置以获得最大的观看乐趣：[http ://code.flickr.com/blog/2008 /11/12/on-ui-quality-the-little-things-client-side-image-resizing/](http://code.flickr.com/blog/2008/11/12/on-ui-quality-the-little-things-client-side-image-resizing/) )
*   如果您使用闪存调整图像大小应该不是一个大问题
*   如果您有 php 或 java（或任何其他语言）后端，您可以使用它来缩放图像。

另外：检查[http://www.flickr.com/groups/api](http://www.flickr.com/groups/api)和[http://tech.groups.yahoo.com/group/yws-flickr/](http://tech.groups.yahoo.com/group/yws-flickr/)

# html - 通过 post 操作的 HtmlInputFile

> ID：479398
> 
> 赞同：0
> 
> 时间：2009-01-26T10:52:03.207
> 
> 标签：html

我有一个有 3 个控件的网页：

1.  使用 post 命令形成表格。
2.  在表单中，我有一个名为“myFile”的输入文件控件。
3.  一个按钮

上传过程工作得很好，直到我尝试发布表单并以另一种形式处理上传。

**Request["myFile"]**和**request.Params["myFile"]**什么也没给我

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T11:06:48.060

这是您需要的 Request.Files 集合 - 在 .NET Framework 文档中查找：

```
Request.Files["myFile"] 
```

还要确保您的上传表单的 enctype 属性设置正确 - 如果表单包含文件输入，它应该是“multipart/form-data”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-03T12:03:02.637

也许这会有所帮助

```
 <input type="file" size="50" id="ipFile" runat="server"/> 
```

`runat="server"`使您可以访问`HtmlInputFile`结构

# asp.net - 一个缓存用于各种应用程序？

> ID：479400
> 
> 赞同：1
> 
> 时间：2009-01-26T10:52:39.600
> 
> 标签：asp.net, sql-server, caching

我有两个应用程序 - 一个是 asp.net 网站，另一个是 Windows 服务。

这两个应用程序都引用了我的业务层（库项目），它本身正在引用我的数据访问层（库项目），它本身使用企业库数据应用程序块来接收来自 sql server 2005 数据库的数据。

目前我在我的 BL 中使用 System.Web.Caching.Cache 对象来缓存我的一些对象：

```
public static System.Web.Caching.Cache Cache
    {
        get
        {
            if(cache == null)
            {
                if (System.Web.HttpContext.Current != null)
                {
                    //asp.net
                    cache = System.Web.HttpContext.Current.Cache;
                }
                else
                {
                    //windows service
                    cache = System.Web.HttpRuntime.Cache;
                }
            }
            return cache;
        }
    } 
```

因为这两个应用程序都是自己运行的——它们都在自己使用一个单独的缓存对象——这实际上是问题所在：

如果我更改 asp.net 网站中的对象并将其保存到数据库。此缓存键的对象已从缓存中删除 - asp.net 应用程序的缓存！没关系。

但是windows服务的缓存变得陈旧了！

反之亦然

两个应用程序是否有可能使用相同的缓存？两个应用程序一个缓存？

我想到的唯一选择是我将不得不使用 SqlDependency

> [Sql Server 2005 基于通知的缓存失效](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/caching/SQLInvalidation.aspx)

还有其他方法吗？

编辑：我刚刚找到[http://www.codeplex.com/SharedCache](http://www.codeplex.com/SharedCache)。我会试一试。因为在 2009 年中期之前，velocity 将处于候选发布状态。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T08:40:17.107

您应该仔细看看微软新的免费分布式缓存“Velocity”。

这是我关于这个主题的播客： [http ://www.hanselman.com/blog/HanselminutesPodcast116DistributedCachingWithMicrosoftsVelocity.aspx](http://www.hanselman.com/blog/HanselminutesPodcast116DistributedCachingWithMicrosoftsVelocity.aspx)

以下是 MSDN 上的详细信息：http: [//msdn.microsoft.com/en-us/data/cc655792.aspx](http://msdn.microsoft.com/en-us/data/cc655792.aspx)

这是下载和示例：[http ://code.msdn.microsoft.com/velocity](http://code.msdn.microsoft.com/velocity)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T13:01:37.563

我认为您需要的是像 memcached 这样的分布式缓存系统。但还有更多，只需快速谷歌一下，您就会找到您要找的东西。

[http://www.google.com/search?q=distributed+caching](http://www.google.com/search?q=distributed+caching)

问候，

约臣

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:55:27.933

缓存仅适用于每个应用程序域。显然，您不能在 Web 应用程序和 Web 服务之间共享相同的缓存。所以..你必须通过各种方式同步 2 个缓存。将缓存依赖对象添加到缓存中，一旦数据发生更改，这将使缓存项无效并将对象重新加载到缓存中。您可以使用轮询或 QN（更好的性能）作为缓存依赖机制。

# sql - SQL Server 和索引

> ID：479403
> 
> 赞同：1
> 
> 时间：2009-01-26T10:54:15.400
> 
> 标签：sql, sql-server

将索引添加到属于外键关系的列是否有益？我有两列将被频繁查询并且已经有外键但不确定我是否应该索引它们，或者外键是否在幕后创建索引？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T10:59:52.583

SQL Server 不会在后台创建索引，因此建议在所有外键字段上创建索引以提高查找性能。

详细信息和其他好处：[http ://technet.microsoft.com/en-us/library/ms175464.aspx](http://technet.microsoft.com/en-us/library/ms175464.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T11:05:46.313

如果您经常查询它，最好为您的 FK 列添加索引。

在您的情况下，如果您创建一个跨越 2 列的复合索引可能会更好。但是，这只是可取的（复合索引），如果您经常执行对这 2 列进行过滤/排序的查询。如果您认为复合索引是合适的，那么您应该注意在这些列上放置索引的顺序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T11:11:26.037

强烈建议为您的 FK 字段创建索引 - 这几乎肯定会提高性能。请注意，对于选择，插入可能会更慢，因为索引本身也必须更新。

Sql Server 有时会“即时”创建一个 FK 索引，但它只在查询的生命周期内存在 - 您可以查看 Sql 执行计划以查看是否发生这种情况。无论哪种方式，在 FK 字段的控制下创建自己的索引都是可行的方法。

# java - 用 JRC 替换子报表的数据库连接

> ID：479405
> 
> 赞同：1
> 
> 时间：2009-01-26T10:55:28.817
> 
> 标签：java, crystal-reports

由于我使用的是较新版本的 JRC，数据库连接信息的替换不再起作用。我不知道为什么。这段代码适用于去年秋天的 JRC 版本（不幸的是我没有发布号）：

```
ReportClientDocument doc = new ReportClientDocument();
doc.open("report.rpt");

IDatabase db = null; // get sub report database

// we'll overwrite the database connection information within
// the chosen report.
Map<String, String> bag = new HashMap<String, String>();
bag.put("Connection URL", "jdbc:oracle:thin:@LOCALHOST:1521:DATABASENAME");
bag.put("Server Type", "JDBC (JNDI)");
bag.put("Database DLL", "crdb_jdbc.dll");
bag.put("Database Class Name", "oracle.jdbc.driver.OracleDriver");

for (Object table : db.getTables()) {
  updateTable(dhb, dc, (ITable)table, bag);
} 
```

...

```
private void updateTable(DatabaseController dc, ITable table, 
    Map<String, String> bag) throws ReportSDKException {

  ITable t = (ITable)table.clone(true);

  LOGGER.debug(t.getName());
  LOGGER.debug("1: " + t.getConnectionInfo().getAttributes());

  IConnectionInfo connInfo = t.getConnectionInfo();
  connInfo.setUserName("UserX");
  connInfo.setPassword("xxxxx");
  connInfo.setAttributes(new PropertyBag(bag));
  // LOGGER.debug("ConnInfo Kind: " + connInfo.getKind());
  t.setConnectionInfo(connInfo);
  // t.setName(((ITable)table).getName());
  t.setQualifiedName("UserX" + "." + table.getName());
  dc.setTableLocation(table, t);

  LOGGER.debug("2: " + t.getConnectionInfo().getAttributes());

} 
```

我收到此错误：'Fehler bei der Suche nach JNDI-Namen (UserY)'。这意味着 JRC 无法找到给定的 JNDI 名称。

有谁知道这些 JRC 版本之间的一些变化？有人知道解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T13:17:17.530

经过长时间的调试会话后，我发现了问题和解决方法。

```
// incomplete code example

for(Object table : db.getTables()) {

  ITable t = (ITable)((ITable)table).clone(true);
  System.out.println(t.getName());

  // modifying t, bag is an existing instance of class PropertyBag
  t.getConnectionInfo().setAttributes(bag);

  // dc is an existing instance of DatabaseController
  dc.setTableLocation((ITable)table, t)

} 
```

`db.getTables()`包含 3 个表 A、B 和 C。如果我们运行上面的代码，则会将`System.out`A、A、B 打印到控制台。

如果我们要发表评论`dc.setTableLocation((ITable)table, t)`。将打印 A、B、C。我假设这`dc.setTableLocation((ITable)table, t)`会在内部修改表列表。

我们正在使用以下解决方法：

```
// incomplete code example

// WORKAROUND CODE
Map<ITable, ITable> oldNewMap = new HashMap<ITable, ITable>();

for(Object table : db.getTables()) {

  ITable t = (ITable)((ITable)table).clone(true);
  System.out.println(t.getName());

  // modifying t, bag is an existing instance of class PropertyBag
  t.getConnectionInfo().setAttributes(bag);

  // WORKAROUND CODE
  oldNewMap.put((ITable)table, t);

}

// WORKAROUND CODE
for (Entry<ITable, ITable> e : oldNewMap.entrySet()) {
  dc.setTableLocation(e.getKey(), e.getValue());
} 
```

我希望有人会通过这种解决方法节省时间和金钱。;-) 我也将它发布到官方论坛。

[论坛：Java 开发 - 水晶报表](https://forums.sdn.sap.com/thread.jspa?threadID=1214278)

# sql - 执行语句还是运行脚本？

> ID：479408
> 
> 赞同：27
> 
> 时间：2009-01-26T10:58:09.917
> 
> 标签：sql, database, oracle, oracle-sqldeveloper

在 Oracle SQL Developer 中输入 SQL 语句时，我注意到我有两个选择。我可以“运行语句”或“运行脚本”。SQL Maestro 中似乎也有类似的选择，尽管名称为“执行查询”和“作为脚本执行”。

两者之间究竟有什么区别？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-26T11:10:41.703

`Run Statement`将为您提供可排序表中所有结果的列表。它也只会运行光标下的语句（或突出显示）。当您运行该语句时，系统将提示您输入绑定变量（任何带有 : 的占位符）。

例如

```
select * from customers where customer_id = :id 
```

将提示输入 id 的值

`Run Script`将执行工作表中的所有语句，并给出结果的文本读数。它不会提示您输入绑定变量的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T11:09:18.710

我认为“执行语句”-意味着如果您想获得结果（结果集）“运行脚本”-是您需要执行但不需要结果的东西，例如安装数据库转储或升级脚本以向表中添加列等等

# sql-server - AWE 能否在 Windows XP 32 位的 SQL Server 2005 开发版上使用 >4GB RAM

> ID：479409
> 
> 赞同：3
> 
> 时间：2009-01-26T10:58:16.907
> 
> 标签：sql-server, sql-server-2005, windows-xp, awe

在 Windows XP pro（32 位）上使用 SQL Server 2005 开发人员版我注意到启用 AWE（高级窗口扩展）的复选框已启用。我有一个 Opteron 工作站，我可以轻松升级到 8GB 或更多，尽管在开发环境中移除 32 位 Windows XP Pro 是不切实际的。据我所知，在 32 位模式下运行的 Opteron 的 MMU 应该支持 36 位物理地址空间，就像 32 位 Xeon 一样。

减少 SQL Server 的内存占用可以让我给 Analysis Services 更多的空间。

*   有谁知道 Windows XP 上的 AWE 是否支持超过 4GB 的可用于 SQL Server 的 RAM（在具有 MMU 支持的 CPU 上）？

*   或者，是否有人知道哪些数据字典视图可能会告诉我有关 AWE 缓冲区使用情况的信息，以便我可以尝试它并获得某种关于它是否使用额外内存的明确视图？

**编辑：**对于那些不熟悉它的人，AWE 是一种允许您控制虚拟物理地址映射和分页进出进程的 4GB 虚拟地址空间的任意物理内存的工具。32 位 Xeons（和其他一些处理器）上的 MMU 实际上将支持超过 4GB 的物理 RAM，尽管单个进程地址空间一次只能看到 4GB。据我所知，Opteron 上的 MMU 在 32 位代码上也有这种能力。

SQL Server 支持使用 AWE 访问超过 2GB 或 3GB 的物理 RAM，其进程地址空间允许在 32 位机器上。它通过显式管理映射、交换物理内存进出虚拟地址空间来做到这一点。某些版本的 Windows，尤其是 Windows 2003 和 Windows 2000 Advanced Server，将支持以这种方式使用的超过 4GB 的内存，并为此提供 API。

**问题是：**如果我有一台为此提供硬件支持的机器，Windows XP 32 位是否允许我以这种方式使用超过 4GB 的 RAM？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-26T11:22:43.020

Windows XP（32 位）[不支持](http://www.microsoft.com/whdc/system/platform/server/PAE/PAEmem.mspx)PAE（即 36 位物理地址）；它仅支持 4GB 的 RAM。您需要 Windows 2003（企业或数据中心）来获得 PAE 支持。由于您的操作系统无法使用 PAE，因此您的应用程序无法使用 AWE。

您*可以*使用 /3GB 开关运行它，从而为 SQL Server 提供更多喘息的空间。

就个人而言，我会升级到 64 位版本的 Windows，可能是 Windows 7 x64。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T11:10:32.780

除非操作系统支持超过 32 位内存寻址空间，否则任何应用程序都不会支持它。您需要升级到 64 位操作系统以允许 SQL 服务器利用额外的 RAM。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T11:17:05.090

在 32 位操作系统中，您不能为用户进程提供超过 2Gb 的地址空间。实际上，您可以选择使用应用了 /3Gb 开关的 Windows Server 2003 在 3Gb 用户地址空间中运行进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-22T01:51:16.267

WinXP 32 位可以使用超过 4GB 的内存，但它需要启用 PAE 和更高的内存支持。

这是您可以在该主题上找到的一篇此类帖子。 [http://www.overclock.net/t/596932/guide-make-32-bit-os-support-128gb-of-ram](http://www.overclock.net/t/596932/guide-make-32-bit-os-support-128gb-of-ram)

启用大于 4GB 的操作系统支持后，您可以启用 AWE 并授予 SQL 访问额外内存的权限。

操作系统限制纯粹是由于许可，实际上并不是物理限制。Windows Server 变体说明了这一点，因为它们的 Server Datacenter 版本能够在 x86 中使用 64GB。SQL Server 对于 32 位应用程序来说是不寻常的，因为它实际上可以利用额外的内存，而大多数其他 32 位进程限制为 2GB/3GB。

# c# - 带有用户友好字符串的枚举 ToString

> ID：479410
> 
> 赞同：341
> 
> 时间：2009-01-26T10:58:39.433
> 
> 标签：c#, enums, tostring

我的枚举包含以下值：

```
private enum PublishStatusses{
    NotCompleted,
    Completed,
    Error
}; 
```

不过，我希望能够以用户友好的方式输出这些值。
我不需要能够再次从字符串变为值。

* * *

## 回答 #1

> 赞同：412
> 
> 时间：2009-01-26T11:01:07.900

我使用[`Description`](http://msdn.microsoft.com/en-us/library/system.componentmodel.descriptionattribute.aspx)System.ComponentModel 命名空间中的属性。简单地装饰枚举：

```
private enum PublishStatusValue
{
    [Description("Not Completed")]
    NotCompleted,
    Completed,
    Error
}; 
```

然后使用此代码检索它：

```
public static string GetDescription<T>(this T enumerationValue)
    where T : struct
{
    Type type = enumerationValue.GetType();
    if (!type.IsEnum)
    {
        throw new ArgumentException("EnumerationValue must be of Enum type", "enumerationValue");
    }

    //Tries to find a DescriptionAttribute for a potential friendly name
    //for the enum
    MemberInfo[] memberInfo = type.GetMember(enumerationValue.ToString());
    if (memberInfo != null && memberInfo.Length > 0)
    {
        object[] attrs = memberInfo[0].GetCustomAttributes(typeof(DescriptionAttribute), false);

        if (attrs != null && attrs.Length > 0)
        {
            //Pull out the description value
            return ((DescriptionAttribute)attrs[0]).Description;
        }
    }
    //If we have no description attribute, just return the ToString of the enum
    return enumerationValue.ToString();
} 
```

* * *

## 回答 #2

> 赞同：404
> 
> 时间：2009-01-26T11:15:25.623

我用扩展方法做到这一点：

```
public enum ErrorLevel
{
  None,
  Low,
  High,
  SoylentGreen
}

public static class ErrorLevelExtensions
{
  public static string ToFriendlyString(this ErrorLevel me)
  {
    switch(me)
    {
      case ErrorLevel.None:
        return "Everything is OK";
      case ErrorLevel.Low:
        return "SNAFU, if you know what I mean.";
      case ErrorLevel.High:
        return "Reaching TARFU levels";
      case ErrorLevel.SoylentGreen:
        return "ITS PEOPLE!!!!";
      default:
        return "Get your damn dirty hands off me you FILTHY APE!";
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2009-01-26T11:11:32.340

也许我遗漏了一些东西，但是 Enum.GetName 有什么问题？

```
public string GetName(PublishStatusses value)
{
    return Enum.GetName(typeof(PublishStatusses), value)
} 
```

编辑：对于用户友好的字符串，您需要通过 .resource 来完成国际化/本地化，并且可以说使用基于枚举键的固定键比使用装饰器属性更好。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2013-04-18T00:09:07.503

我创建了一个反向扩展方法来将描述转换回枚举值：

```
public static T ToEnumValue<T>(this string enumerationDescription) where T : struct
{
    var type = typeof(T);

    if (!type.IsEnum)
        throw new ArgumentException("ToEnumValue<T>(): Must be of enum type", "T");

    foreach (object val in System.Enum.GetValues(type))
        if (val.GetDescription<T>() == enumerationDescription)
            return (T)val;

    throw new ArgumentException("ToEnumValue<T>(): Invalid description for enum " + type.Name, "enumerationDescription");
} 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-01-26T11:03:20.827

这里最简单的解决方案是使用自定义扩展方法（至少在 .NET 3.5 中 - 您可以将其转换为早期框架版本的静态辅助方法）。

```
public static string ToCustomString(this PublishStatusses value)
{
    switch(value)
    {
        // Return string depending on value.
    }
    return null;
} 
```

我在这里假设您想要返回的不是枚举值的实际名称（您可以通过简单地调用 ToString 来获得）。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-01-26T11:03:01.170

另一篇文章是Java。您不能将方法放在 C# 中的枚举中。

做这样的事情：

```
PublishStatusses status = ...
String s = status.ToString(); 
```

如果你想为你的枚举值使用不同的显示值，你可以使用属性和反射。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-07-28T19:04:14.973

其他一些避免类/引用类型的更原始的选项：

*   数组法
*   嵌套结构方法

**数组法**

```
private struct PublishStatusses
{
    public static string[] Desc = {
        "Not Completed",
        "Completed",
        "Error"
    };

    public enum Id
    {
        NotCompleted = 0,
        Completed,
        Error
    };
} 
```

用法

```
string desc = PublishStatusses.Desc[(int)PublishStatusses.Id.Completed]; 
```

**嵌套结构方法**

```
private struct PublishStatusses
{
    public struct NotCompleted
    {
        public const int Id = 0;
        public const string Desc = "Not Completed";
    }

    public struct Completed
    {
        public const int Id = 1;
        public const string Desc = "Completed";
    }

    public struct Error
    {
        public const int Id = 2;
        public const string Desc = "Error";
    }            
} 
```

用法

```
int id = PublishStatusses.NotCompleted.Id;
string desc = PublishStatusses.NotCompleted.Desc; 
```

* * *

**更新 (03/09/2018)**

扩展方法和上述第一种技术的混合体。

我更喜欢将枚举定义在它们“属于”的位置（最接近它们的来源，而不是在一些通用的全局命名空间中）。

```
namespace ViewModels
{
    public class RecordVM
    {
        //public enum Enum { Minutes, Hours }
        public struct Enum
        {
            public enum Id { Minutes, Hours }
            public static string[] Name = { "Minute(s)", "Hour(s)" };
        }
    }
} 
```

扩展方法似乎适用于公共区域，枚举的“本地化”定义现在使扩展方法更加冗长。

```
namespace Common
{
    public static class EnumExtensions
    {
        public static string Name(this RecordVM.Enum.Id id)
        {
            return RecordVM.Enum.Name[(int)id];
        }
    }   
} 
```

枚举及其扩展方法的使用示例。

```
namespace Views
{
    public class RecordView 
    {
        private RecordDataFieldList<string, string> _fieldUnit;

        public RecordView()
        {
            _fieldUnit.List = new IdValueList<string, string>
            {            
                new ListItem<string>((int)RecordVM.Enum.Id.Minutes, RecordVM.Enum.Id.Minutes.Name()),
                new ListItem<string>((int)RecordVM.Enum.Id.Hours, RecordVM.Enum.Id.Hours.Name())
            };
        }

        private void Update()
        {    
            RecordVM.Enum.Id eId = DetermineUnit();

            _fieldUnit.Input.Text = _fieldUnit.List.SetSelected((int)eId).Value;
        }
    }
} 
```

* * *

**注意：**我实际上决定消除`Enum`包装器（和`Name`数组），因为名称字符串最好来自资源（即配置文件或数据库）而不是硬编码，并且因为我最终将扩展方法放在`ViewModels`命名空间（只是在不同的“CommonVM.cs”文件中）。再加上整个`.Id`事情变得分散注意力和麻烦。

```
namespace ViewModels
{
    public class RecordVM
    {
        public enum Enum { Minutes, Hours }
        //public struct Enum
        //{
        //    public enum Id { Minutes, Hours }
        //    public static string[] Name = { "Minute(s)", "Hour(s)" };
        //}
    }
} 
```

**通用VM.cs**

```
//namespace Common
namespace ViewModels
{
    public static class EnumExtensions
    {
        public static string Name(this RecordVM.Enum id)
        {
            //return RecordVM.Enum.Name[(int)id];
            switch (id)
            {
                case RecordVM.Enum.Minutes: return "Minute(s)";                    
                case RecordVM.Enum.Hours: return "Hour(s)";
                default: return null;
            }
        }
    }   
} 
```

枚举及其扩展方法的使用示例。

```
namespace Views
{
    public class RecordView 
    {
        private RecordDataFieldList<string, string> _fieldUnit

        public RecordView()
        {
            _fieldUnit.List = new IdValueList<string, string>
            {            
                new ListItem<string>((int)RecordVM.Enum.Id.Minutes, RecordVM.Enum.Id.Minutes.Name()),
                new ListItem<string>((int)RecordVM.Enum.Id.Hours, RecordVM.Enum.Id.Hours.Name())
            };
        }

        private void Update()
        {    
            RecordVM.Enum eId = DetermineUnit();

            _fieldUnit.Input.Text = _fieldUnit.List.SetSelected((int)eId).Value;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-02-03T21:26:04.943

最简单的方法就是将此扩展类包含到您的项目中，它将与项目中的任何枚举一起使用：

```
public static class EnumExtensions
{
    public static string ToFriendlyString(this Enum code)
    {
        return Enum.GetName(code.GetType(), code);
    }
} 
```

用法：

```
enum ExampleEnum
{
    Demo = 0,
    Test = 1, 
    Live = 2
} 
```

...

```
ExampleEnum ee = ExampleEnum.Live;
Console.WriteLine(ee.ToFriendlyString()); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-11-25T16:00:33.273

您可以将[Humanizer](https://github.com/Humanizr/Humanizer)包与[Humanize Enums](https://github.com/Humanizr/Humanizer#humanize-enums)可能性结合使用。一个例子：

```
enum PublishStatusses
{
    [Description("Custom description")]
    NotCompleted,
    AlmostCompleted,
    Error
}; 
```

那么您可以`Humanize`直接在枚举上使用扩展方法：

```
var st1 = PublishStatusses.NotCompleted;
var str1 = st1.Humanize(); // will result in Custom description

var st2 = PublishStatusses.AlmostCompleted;
var str2 = st2.Humanize(); // will result in Almost completed (calculated automaticaly) 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-02-23T14:41:12.027

```
public enum MyEnum
{
    [Description("Option One")]
    Option_One
}

public static string ToDescriptionString(this Enum This)
{
    Type type = This.GetType();

    string name = Enum.GetName(type, This);

    MemberInfo member = type.GetMembers()
        .Where(w => w.Name == name)
        .FirstOrDefault();

    DescriptionAttribute attribute = member != null
        ? member.GetCustomAttributes(true)
            .Where(w => w.GetType() == typeof(DescriptionAttribute))
            .FirstOrDefault() as DescriptionAttribute
        : null;

    return attribute != null ? attribute.Description : name;
} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-04-30T20:51:35.573

关于 Ray Booysen，代码中有一个错误：[Enum ToString with user friendly strings](https://stackoverflow.com/questions/479410/enum-tostring/479417#479417)

您需要考虑枚举值的多个属性。

```
public static string GetDescription<T>(this object enumerationValue)
            where T : struct
    {
        Type type = enumerationValue.GetType();
        if (!type.IsEnum)
        {
            throw new ArgumentException("EnumerationValue must be of Enum type", "enumerationValue");
        }

        //Tries to find a DescriptionAttribute for a potential friendly name
        //for the enum
        MemberInfo[] memberInfo = type.GetMember(enumerationValue.ToString());
        if (memberInfo != null && memberInfo.Length > 0)
        {
            object[] attrs = memberInfo[0].GetCustomAttributes(typeof(DescriptionAttribute), false);

            if (attrs != null && attrs.Length > 0 && attrs.Where(t => t.GetType() == typeof(DescriptionAttribute)).FirstOrDefault() != null)
            {
                //Pull out the description value
                return ((DescriptionAttribute)attrs.Where(t=>t.GetType() == typeof(DescriptionAttribute)).FirstOrDefault()).Description;
            }
        }
        //If we have no description attribute, just return the ToString of the enum
        return enumerationValue.ToString(); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-01-11T19:27:21.873

而不是使用枚举使用静态类。

代替

```
private enum PublishStatuses{
    NotCompleted,
    Completed,
    Error
}; 
```

和

```
private static class PublishStatuses{
    public static readonly string NotCompleted = "Not Completed";
    public static readonly string Completed = "Completed";
    public static readonly string Error = "Error";
}; 
```

它将像这样使用

```
PublishStatuses.NotCompleted; // "Not Completed" 
```

使用顶级“扩展方法”解决方案的问题：

私有枚举通常在另一个类中使用。扩展方法解决方案在那里无效，因为它必须在它自己的类中。这个解决方案可以是私有的并嵌入到另一个类中。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-10-26T16:29:13.517

上述建议的干净摘要与示例：

```
namespace EnumExtensions {

using System;
using System.Reflection;

public class TextAttribute : Attribute {
   public string Text;
   public TextAttribute( string text ) {
      Text = text;
   }//ctor
}// class TextAttribute

public static class EnumExtender {

public static string ToText( this Enum enumeration ) {

   MemberInfo[] memberInfo = enumeration.GetType().GetMember( enumeration.ToString() );

   if ( memberInfo != null && memberInfo.Length > 0 ) {

      object[] attributes = memberInfo[ 0 ].GetCustomAttributes( typeof(TextAttribute),  false );

      if ( attributes != null && attributes.Length > 0 ) {
         return ( (TextAttribute)attributes[ 0 ] ).Text;
      }

   }//if

   return enumeration.ToString();

}//ToText

}//class EnumExtender

}//namespace 
```

用法：

```
using System;
using EnumExtensions;

class Program {

public enum Appearance {

  [Text( "left-handed" ) ]
  Left,

  [Text( "right-handed" ) ]
  Right,

}//enum

static void Main( string[] args ) {

   var appearance = Appearance.Left;
   Console.WriteLine( appearance.ToText() );

}//Main

}//class 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-01-31T13:03:24.253

根据此文档：[https ://docs.microsoft.com/pt-br/dotnet/api/system.enum.tostring?view=netframework-4.8](https://docs.microsoft.com/pt-br/dotnet/api/system.enum.tostring?view=netframework-4.8)

可以使用如下格式将枚举数转换为字符串：

```
public enum Example
{
    Example1,
    Example2
}

Console.WriteLine(Example.Example1.ToString("g"));

//Outputs: "Example1" 
```

您可以在此链接中查看所有可能的格式：[https ://docs.microsoft.com/pt-br/dotnet/api/system.string?view=netframework-4.8](https://docs.microsoft.com/pt-br/dotnet/api/system.string?view=netframework-4.8)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-02-08T11:55:10.080

我碰巧是 VB.NET 的粉丝，所以这是我的版本，将 DescriptionAttribute 方法与扩展方法相结合。一、结果：

```
Imports System.ComponentModel ' For <Description>

Module Module1
  ''' <summary>
  ''' An Enum type with three values and descriptions
  ''' </summary>
  Public Enum EnumType
    <Description("One")>
    V1 = 1

    ' This one has no description
    V2 = 2

    <Description("Three")>
    V3 = 3
  End Enum

  Sub Main()
    ' Description method is an extension in EnumExtensions
    For Each v As EnumType In [Enum].GetValues(GetType(EnumType))
      Console.WriteLine("Enum {0} has value {1} and description {2}",
        v,
        CInt(v),
        v.Description
      )
    Next
    ' Output:
    ' Enum V1 has value 1 and description One
    ' Enum V2 has value 2 and description V2
    ' Enum V3 has value 3 and description Three
  End Sub
End Module 
```

基本内容：一个名为 EnumType 的枚举，具有三个值 V1、V2 和 V3。“魔术”发生在 Sub Main() 中的 Console.WriteLine 调用中，其中最后一个参数是简单的`v.Description`. 这将为 V1 返回“一”，为 V2 返回“V2”，为 V3 返回“三”。这个描述方法实际上是一个扩展方法，定义在另一个名为 EnumExtensions 的模块中：

```
Option Strict On
Option Explicit On
Option Infer Off

Imports System.Runtime.CompilerServices
Imports System.Reflection
Imports System.ComponentModel

Module EnumExtensions
  Private _Descriptions As New Dictionary(Of String, String)

  ''' <summary>
  ''' This extension method adds a Description method
  ''' to all enum members. The result of the method is the
  ''' value of the Description attribute if present, else
  ''' the normal ToString() representation of the enum value.
  ''' </summary>
  <Extension>
  Public Function Description(e As [Enum]) As String
    ' Get the type of the enum
    Dim enumType As Type = e.GetType()
    ' Get the name of the enum value
    Dim name As String = e.ToString()

    ' Construct a full name for this enum value
    Dim fullName As String = enumType.FullName + "." + name

    ' See if we have looked it up earlier
    Dim enumDescription As String = Nothing
    If _Descriptions.TryGetValue(fullName, enumDescription) Then
      ' Yes we have - return previous value
      Return enumDescription
    End If

    ' Find the value of the Description attribute on this enum value
    Dim members As MemberInfo() = enumType.GetMember(name)
    If members IsNot Nothing AndAlso members.Length > 0 Then
      Dim descriptions() As Object = members(0).GetCustomAttributes(GetType(DescriptionAttribute), False)
      If descriptions IsNot Nothing AndAlso descriptions.Length > 0 Then
        ' Set name to description found
        name = DirectCast(descriptions(0), DescriptionAttribute).Description
      End If
    End If

    ' Save the name in the dictionary:
    _Descriptions.Add(fullName, name)

    ' Return the name
    Return name
  End Function
End Module 
```

因为使用查找描述属性`Reflection`很慢，所以查找也缓存在一个 private`Dictionary`中，按需填充。

（对于 VB.NET 解决方案感到抱歉 - 将其转换为 C# 应该相对简单，而且我的 C# 在扩展等新主题上生锈了）

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-11-19T10:05:42.633

更简洁的总结：

```
using System;
using System.Reflection;

public class TextAttribute : Attribute
{
    public string Text;
    public TextAttribute(string text)
    {
        Text = text;
    }
}  

public static class EnumExtender
{
    public static string ToText(this Enum enumeration)
    {
        var memberInfo = enumeration.GetType().GetMember(enumeration.ToString());
        if (memberInfo.Length <= 0) return enumeration.ToString();

        var attributes = memberInfo[0].GetCustomAttributes(typeof(TextAttribute), false);
        return attributes.Length > 0 ? ((TextAttribute)attributes[0]).Text : enumeration.ToString();
    }
} 
```

与下划线描述的用法相同。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2019-07-29T07:54:28.807

使用[Enum.GetName](https://docs.microsoft.com/en-us/dotnet/api/system.enum.getname?view=netcore-2.2)

从上面的链接...

```
using System;

public class GetNameTest {
    enum Colors { Red, Green, Blue, Yellow };
    enum Styles { Plaid, Striped, Tartan, Corduroy };

    public static void Main() {

        Console.WriteLine("The 4th value of the Colors Enum is {0}", Enum.GetName(typeof(Colors), 3));
        Console.WriteLine("The 4th value of the Styles Enum is {0}", Enum.GetName(typeof(Styles), 3));
    }
}
// The example displays the following output:
//       The 4th value of the Colors Enum is Yellow
//       The 4th value of the Styles Enum is Corduroy 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-01-10T10:10:10.137

如果您只想在单词之间添加一个空格，它就像

```
string res = Regex.Replace(PublishStatusses.NotCompleted, "[A-Z]", " $0").Trim(); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-11-12T03:23:49.580

这是对 Ray Booysen 代码的更新，它使用通用的 GetCustomAttributes 方法和 LINQ 使事情变得更整洁。

```
 /// <summary>
    /// Gets the value of the <see cref="T:System.ComponentModel.DescriptionAttribute"/> on an struct, including enums.  
    /// </summary>
    /// <typeparam name="T">The type of the struct.</typeparam>
    /// <param name="enumerationValue">A value of type <see cref="T:System.Enum"/></param>
    /// <returns>If the struct has a Description attribute, this method returns the description.  Otherwise it just calls ToString() on the struct.</returns>
    /// <remarks>Based on http://stackoverflow.com/questions/479410/enum-tostring/479417#479417, but useful for any struct.</remarks>
    public static string GetDescription<T>(this T enumerationValue) where T : struct
    {
        return enumerationValue.GetType().GetMember(enumerationValue.ToString())
                .SelectMany(mi => mi.GetCustomAttributes<DescriptionAttribute>(false),
                    (mi, ca) => ca.Description)
                .FirstOrDefault() ?? enumerationValue.ToString();
    } 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-07-26T19:46:15.550

我迟到了 7 年 :-) 但我确信这个话题经常被访问。
所以我想在咖啡里加一点糖：

那么“F”格式字符串说明符呢？

```
PublishStatusses[] ps = Enum.GetValues<PublishStatusses>();
ps.ToList().ForEach(c => Console.Write($"{c:F} ")); 
```

不需要任何显式的函数调用。

事实上，甚至不需要任何格式说明符。如果对字符串进行变量赋值，ToString() 会起作用：

```
string foo = PublishStatusses.Error.ToString(); // or ToString("F") 
```

如果要在 CamelCase 字符串的单词之间插入空格，则可以使用正则表达式：

```
Regex.Replace(foo, "(\\B[A-Z])", " $1") 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-11-27T13:29:39.767

对于标志枚举，包括。

```
 public static string Description(this Enum value)
    {
        Type type = value.GetType();

        List<string> res = new List<string>();
        var arrValue = value.ToString().Split(',').Select(v=>v.Trim());
        foreach (string strValue in arrValue)
        {
            MemberInfo[] memberInfo = type.GetMember(strValue);
            if (memberInfo != null && memberInfo.Length > 0)
            {
                object[] attrs = memberInfo[0].GetCustomAttributes(typeof(DescriptionAttribute), false);

                if (attrs != null && attrs.Length > 0 && attrs.Where(t => t.GetType() == typeof(DescriptionAttribute)).FirstOrDefault() != null)
                {
                    res.Add(((DescriptionAttribute)attrs.Where(t => t.GetType() == typeof(DescriptionAttribute)).FirstOrDefault()).Description);
                }
                else
                    res.Add(strValue);
            }
            else
                res.Add(strValue);
        }

        return res.Aggregate((s,v)=>s+", "+v);
    } 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2020-01-21T19:27:13.793

我使用一个泛型类来存储枚举/描述对和一个嵌套的帮助类来获取描述。

*枚举*：_

```
enum Status { Success, Fail, Pending } 
```

泛型类：

**注意：**由于泛型类不能受*枚举*约束，因此我使用*struct*进行约束，并在构造函数中检查*枚举*。

```
public class EnumX<T> where T : struct
{
    public T Code { get; set; }
    public string Description { get; set; }

    public EnumX(T code, string desc)
    {
        if (!typeof(T).IsEnum) throw new NotImplementedException();

        Code = code;
        Description = desc;
    }

    public class Helper
    {
        private List<EnumX<T>> codes;

        public Helper(List<EnumX<T>> codes)
        {
            this.codes = codes;
        }

        public string GetDescription(T code)
        {
            EnumX<T> e = codes.Where(c => c.Code.Equals(code)).FirstOrDefault();
            return e is null ? "Undefined" : e.Description;
        }
    }
} 
```

用法：

```
EnumX<Status>.Helper StatusCodes = new EnumX<Status>.Helper(new List<EnumX<Status>>()
        {
            new EnumX<Status>(Status.Success,"Operation was successful"),
            new EnumX<Status>(Status.Fail,"Operation failed"),
            new EnumX<Status>(Status.Pending,"Operation not complete. Please wait...")
        });

        Console.WriteLine(StatusCodes.GetDescription(Status.Pending)); 
```

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2016-10-31T18:26:34.103

我认为解决您的问题的最佳（也是最简单）的方法是为您的枚举编写一个扩展方法：

```
public static string GetUserFriendlyString(this PublishStatusses status)
    {

    } 
```

* * *

## 回答 #24

> 赞同：-3
> 
> 时间：2009-01-26T11:01:17.493

如果您想要完全可定制的东西，请在此处试用我的解决方案：

[http://www.kevinwilliampang.com/post/Mapping-Enums-To-Strings-and-Strings-to-Enums-in-NET.aspx](http://www.kevinwilliampang.com/post/Mapping-Enums-To-Strings-and-Strings-to-Enums-in-NET.aspx)

基本上，这篇文章概述了如何将描述属性附加到每个枚举，并提供了一种从枚举映射到描述的通用方法。

# visual-studio - 当我在 VS 2005 中构建项目时，为什么我的项目的 GUID 之一会发生变化？

> ID：479425
> 
> 赞同：6
> 
> 时间：2009-01-26T11:03:21.420
> 
> 标签：visual-studio, visual-studio-2005, guid, solution

对于我的两个 VS 2005 C++ 项目，VS 希望在我构建项目时写入 .sln 文件。我有许多其他 VS 2005 C++ 项目，但情况并非如此。这是一个问题，因为我们将 ClearCase 源代码控制与我们的 VS 2005 安装集成在一起，当我们尝试通过批处理文件运行通宵构建时，构建暂停，因为显示了 ClearCase 签出对话框。

查看 .sln 文件中 VS 的变化，它是项目行上的第二个 GUID。

建造前：

```
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "InterCommClientB", "InterCommClientB.vcproj", "{A2AF232A-7F27-4340-81D5-8ABFD10994D2}" 
```

建成后：

```
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "InterCommClientB", "InterCommClientB.vcproj", "{67BE85B7-3234-484E-88FB-4F0E42096583}" 
```

感激地收到任何帮助。我是 VS 2005 的新手，因为我们最近才从 VC++ 6.0 迁移，所以如果我遗漏了一些明显的东西，我深表歉意。

我们正在运行安装了 SP1 的 VS 2005 专业版。

问候，

格雷格。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-08-11T10:11:51.297

我有类似的问题。从旧版本的 VS（如 6 或 2003）转换项目时，VS 2010 似乎没有将项目 GUID 添加到 .vcxproj 文件中。因此，当您打开包含此类项目的解决方案时，VS 将为此类项目重新创建 GUID，并将更改 .sln 文件但不会更改 .vcxproj 文件。因此，再次打开此类解决方案时，情况将相同，并且 .sln 文件可能会再次更改。

看到这个：[http ://connect.microsoft.com/VisualStudio/feedback/details/586258/missing-projectguid-in-vcxproj-files](http://connect.microsoft.com/VisualStudio/feedback/details/586258/missing-projectguid-in-vcxproj-files)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T11:11:22.263

我在这里猜测，但似乎对 InterCommClientB 项目（项目，而不是项目中的文件）进行了一些更改。发生这种情况时，sln 会更新，在这种情况下只有项目 GUID。

解决此问题的最佳猜测是手动构建解决方案，然后签入更改。这样 sln 文件不会在构建时更改。

我的第二个最佳猜测是您已经在计算机上进行了此更改并且工作正常，但是您没有在进行夜间构建的 pc 上获得最新版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T21:08:16.480

这可能完全不存在 - 但有时 Visual Studio 在修改解决方案文件时以及在 Visual Studio 中打开解决方案时无法签入解决方案文件。尝试关闭 Visual Studio，然后才提交解决方案文件。

如果不是这样，则可能有其他机构导致解决方案文件需要更改其使用的 GUID。在一个例子中，我使用的是 National Instruments 的 .NET 工具，他们有一个许可方案，每当我进行重建时，它们都会触发这种操作（修改无关文件，因为不是很好的理由）。

请仔细查看构建的输出（在日志或输出窗口中） - 您可能会在那里找到更多线索！

# c++ - Boost.Spirit 的单元测试

> ID：479431
> 
> 赞同：3
> 
> 时间：2009-01-26T11:06:09.620
> 
> 标签：c++, unit-testing, boost, boost-spirit, boost-test

我是 Boost.Spirit 和 Boost.Test 的新手，我想知道您如何验证语法的正确性。下面是我目前如何做的简化版本，我很确定有更好的方法：

每个测试用例都有一对包含要解析的文本和用分号分隔的预期结果的两个字符串。

解析函数执行实际解析并返回一个应该等于预期结果的字符串。

```
 std::string parse(std::string const & line) {
  std::string name;
  int hours;

  rule<> top_rule = ... ; // rule assignes values to 'name' and 'hours'

  parse_info<> info = parse(line.c_str(), top_rule);

  if(info.full) {
    std::stringstream sstr;
    sstr << name << ";" << hours;

    return sstr.str();
  }

  return "parser failed.";
}

BOOST_AUTO_TEST_SUITE( TestSuite )

BOOST_AUTO_TEST_CASE( TestCase ) {
  BOOST_CHECK_EQUAL(parse("Tom worked for 10 hours."), "Tom;10");
}

BOOST_AUTO_TEST_SUITE_END() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T16:25:12.333

一般来说，你的方法对我来说似乎很好。我可能会将测试类分组为具有描述性名称的函数，例如 TestInvalidGrammar、TestErrorHandling、TestNestedGrammar 等，并从主函数调用这些函数。

我相信您已经阅读了文档，但如果有帮助，请查看[示例。](http://www.boost.org/doc/libs/1_37_0/libs/test/doc/html/utf/user-guide/test-organization/manual-nullary-test-case.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-09T14:02:27.150

在这里你可以看到他们（boost spirit作者）如何测试他们自己的解析器：[http](http://svn.boost.org/svn/boost/trunk/libs/spirit/test/qi/grammar.cpp) ://svn.boost.org/svn/boost/trunk/libs/spirit/test/qi/grammar.cpp 。对于 qi 的每个部分，您可以在此处找到 C++ 文件：http: [//svn.boost.org/svn/boost/trunk/libs/spirit/test/qi/](http://svn.boost.org/svn/boost/trunk/libs/spirit/test/qi/)。

# c# - 检索 Windows 体验评级

> ID：479435
> 
> 赞同：10
> 
> 时间：2009-01-26T11:07:12.613
> 
> 标签：c#, rating

我正在寻找在 C# 中检索机器的 Windows 体验评级。如果可能的话，我还想检索每个组件（图形、RAM 等）的数字。

这可能吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T11:46:28.977

每次用户通过控制面板计算 Windows 体验评级时，系统都会在`%Windows%\Performance\WinSAT\DataStore\`

您需要查找最新的文件（它们首先以最重要的日期命名，因此查找最新的文件很简单）。

这些文件是 xml 文件，很容易用 XmlReader 或其他 xml 解析器解析。

您感兴趣的部分是`WinSAT\WinSPR`并且包含单个部分中的所有分数。例如

```
<WinSAT>
    <WinSPR>
        <SystemScore>3.7</SystemScore> 
        <MemoryScore>5.9</MemoryScore> 
        <CpuScore>5.2</CpuScore> 
        <CPUSubAggScore>5.1</CPUSubAggScore> 
        <VideoEncodeScore>5.3</VideoEncodeScore> 
        <GraphicsScore>3.9</GraphicsScore> 
        <GamingScore>3.7</GamingScore> 
        <DiskScore>5.2</DiskScore> 
    </WinSPR>
... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-03-27T09:13:49.763

与 LINQ 相同：

```
var dirName = Environment.ExpandEnvironmentVariables(@"%WinDir%\Performance\WinSAT\DataStore\");
var dirInfo = new DirectoryInfo(dirName);
var file = dirInfo.EnumerateFileSystemInfos("*Formal.Assessment*.xml")
    .OrderByDescending(fi => fi.LastWriteTime)
    .FirstOrDefault();

if (file == null)
    throw new FileNotFoundException("WEI assessment xml not found");

var doc = XDocument.Load(file.FullName);

Console.WriteLine("Processor: " + doc.Descendants("CpuScore").First().Value);
Console.WriteLine("Memory (RAM): " + doc.Descendants("MemoryScore").First().Value);
Console.WriteLine("Graphics: " + doc.Descendants("GraphicsScore").First().Value);
Console.WriteLine("Gaming graphics: " + doc.Descendants("GamingScore").First().Value);
Console.WriteLine("Primary hard disk: " + doc.Descendants("DiskScore").First().Value);
Console.WriteLine("Base score: " + doc.Descendants("SystemScore").First().Value); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T11:10:32.920

[这](http://www.dreamincode.net/code/snippet1456.htm)是 VB.NET 的一个片段。转换为 C#（使用[this](http://www.developerfusion.com/tools/convert/vb-to-csharp/)，我还没有实际测试过代码，虽然它看起来很好）。

```
/// <summary>
/// Gets the base score of a computer running Windows Vista or higher.
/// </summary>
/// <returns>The String Representation of Score, or False.</returns>
/// <remarks></remarks>
public string GetBaseScore()
{
    // Check if the computer has a \WinSAT dir.
    if (System.IO.Directory.Exists("C:\\Windows\\Performance\\WinSAT\\DataStore"))
    { 
        // Our method to get the most recently updated score.
        // Because the program makes a new XML file on every update of the score,
        // we need to calculate the most recent, just incase the owner has upgraded.
        System.IO.DirectoryInfo Dir = new System.IO.DirectoryInfo("C:\\Windows\\Performance\\WinSAT\\DataStore");
        System.IO.FileInfo[] fileDir = null;
        System.IO.FileInfo fileMostRecent = default(IO.FileInfo);
        System.DateTime LastAccessTime = default(System.DateTime);
        string LastAccessPath = string.Empty;
        fileDir = Dir.GetFiles;

        // Loop through the files in the \WinSAT dir to find the newest one.
        foreach (var fileMostRecent in fileDir)
        {
            if (fileMostRecent.LastAccessTime >= LastAccessTime)
            {
                LastAccessTime = fileMostRecent.LastAccessTime;
                LastAccessPath = fileMostRecent.FullName;
            }
        }

        // Create an XmlTextReader instance.
        System.Xml.XmlTextReader xmlReadScore = new System.Xml.XmlTextReader(LastAccessPath);

        // Disable whitespace handling so we don't read over them
        xmlReadScore.WhitespaceHandling = System.Xml.WhitespaceHandling.None;

        // We need to get to the 25th tag, "WinSPR".
        for (int i = 0; i <= 26; i++)
        {
            xmlReadScore.Read();
        }

        // Create a string variable, so we can clean up without any mishaps.
        string SystemScore = xmlReadScore.ReadElementString("SystemScore");

        // Clean up.
        xmlReadScore.Close();

        return SystemScore;
    }

    // Unsuccessful.
    return false;
} 
```

我想它只会返回总体评分，但希望它至少能让你开始。可能只需要更改文件名/参数即可获得单独的评级。

# .net - 实现具有一些要求的纯 xaml 工作流

> ID：479445
> 
> 赞同：1
> 
> 时间：2009-01-26T11:11:23.493
> 
> 标签：.net, xaml, workflow-foundation

我目前负责开发一种在我们的应用程序中使用 WF 的方法，并且我有一套需要遵循的要求。

*   我需要能够纯粹在文本上定义工作流，以便我可以存储和检索它以执行。
*   在工作流执行期间，需要在活动之间传递数据对象，以便它们可以对其执行操作。
*   活动由外部类定义，活动需要访问定义它们的类的实例，以便它们可以调用其方法。

我一直在研究 WF，我想出了一些解决方案，但我不确定它们是否是最好的。

我最大的问题之一是为活动提供定义它们的类的实例。有没有办法为工作流运行时提供一个活动工厂或类似的东西？另一个问题来自使用纯 XAML 工作流定义。我需要能够将 DataObject 传递给第一个活动，以便它可以在工作流中使用。

我很难解释这个问题，我希望它足够清楚。

任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:30:41.597

关于向运行时提供在 XOML 工作流上下文中使用的外部活动，请查看将 TypeProvider 服务添加到运行时：

```
TypeProvider provider = new TypeProvider(runtime);
provider.AddAssembly(assembly);
runtime.AddService(provider); 
```

此外，请查看定义具有属于您的 DataObject 类型的 DependencyProperty 的根活动。将基于 XOML 的工作流设为该基本类型的根活动。然后，您应该能够将您的对象作为参数传递到基于 XOML 的工作流中，而不会出现任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T18:16:29.190

我不太确定我完全理解你想要做什么，但你可能想看看一个自定义加载器：

[http://msdn.microsoft.com/en-us/magazine/cc507645.aspx](http://msdn.microsoft.com/en-us/magazine/cc507645.aspx)

[http://www.masteringbiztalk.com/blogs/jon/CommentView,guid,ffd20921-fb8b-42a2-98d1-8c8e1582a3fa.aspx](http://www.masteringbiztalk.com/blogs/jon/CommentView,guid,ffd20921-fb8b-42a2-98d1-8c8e1582a3fa.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T15:57:58.330

我一直在看，`TypeProvider`但似乎我只能为活动添加新的位置。然而，运行时将继续自己实例化活动。我希望能够实例化它们，这样我就可以将一些参数传递给构造函数。

我几乎按照您描述的方式解决了 DataObject 问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T18:58:58.997

我认为这`WorkflowLoaderService`是我正在寻找的课程。

那应该这样做。谢谢。

# com - 在 windows 2003 服务器中查找计算 MD5/SHA1 哈希的“本机”dll

> ID：479449
> 
> 赞同：2
> 
> 时间：2009-01-26T11:11:44.367
> 
> 标签：com, windows-server-2003

有谁知道 Windows（2003 服务器）中是否存在我可以调用来计算字符串的 MD5/SHA1 哈希的 dll？

我已经用 C# 编写了一个 .dll 来执行此操作，但由于公司对我们服务器的规定，我不允许使用它。

/奥斯加尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T11:19:33.680

如果您确实安装了 .NET 2.0（我认为您确实安装了），那么是的，有一个。

它可以通过 COM 分别作为`System.Security.Cryptography.MD5CryptoServiceProvider`和访问`System.Security.Cryptography.HMACSHA1`。

在 C# 中实现它是没有用的，因为 C# 依赖于 .NET，而 .NET 已经为您实现了它。

PS 如果您的系统上没有 .NET 或者您出于某种原因不愿使用 .NET/COM，则有使用[Microsoft Crypto API的](http://msdn.microsoft.com/en-us/library/aa380256(VS.85).aspx)[示例](http://www.codeproject.com/KB/security/cryptest.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T14:51:39.353

你试过[openSSL](http://www.openssl.org/docs/crypto/md5.html)吗？

（例如，Windows 有预编译的 libeay32.dll 和 libssl32.dll 文件，但我不确定描述每个文件中可用的 DLL 函数的文档在哪里）

# php - 用需要相互引用的记录填充两个表的最佳方法是什么？

> ID：479455
> 
> 赞同：1
> 
> 时间：2009-01-26T11:19:23.930
> 
> 标签：php, mysql, reference, referential-integrity

在两个表中填充记录的最佳方法是什么，每个表都需要引用另一个表的主键？

我的想法是在它们之间有一个“链接”表，一旦两者都写入数据库或通过以下复杂的命令系列填充

```
Insert1
get identity1
Insert2 
get identity2
update 1 
```

在连接到 mySQL 数据库并保持完整性的同时，您将如何在 PHP 中执行此操作？

您是否需要使用事务，如果需要，您将如何进行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T11:34:58.597

我能问一下为什么这些表需要相互引用吗？如果是直接 1:1，那么我建议将外键放在其中一张表中。查找同样简单。并且您的外键可以正确执行。否则你会遇到一个鸡/蛋场景，其中两个表都需要相互引用。但需要先创建一个。这意味着在某个时刻，您的数据库将处于不一致状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T12:26:59.020

If you really must do it , then definitely use transactions - to avoid orphan records

```
mysql_query("START TRANSACTION");
if(!mysql_query($query1))
{   $errmsg=mysql_error();
    mysql_query("ROLLBACK");
}
else
{  $id1=mysql_insert_id();
   $query2="insert into.....$id1...");
   if(!mysql_query($query2))
   {   $errmsg=mysql_error();
       mysql_query("ROLLBACK");
   }
   $id2=mysql_insert_id();
   if(!mysql_query("update tabel1 set my_key=$id2 where key=$id1"))
   {   $errmsg=mysql_error();
       mysql_query("ROLLBACK");
   }

}
mysql_query("COMMIT"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T19:52:26.250

您需要使用事务。如果您使用 InnoDb 存储引擎（但不适用于 MyIsam），MySql 在较新的版本中支持此功能。

# java - 选择：从经典 ASP 迁移到 .NET 或迁移到开源平台

> ID：479461
> 
> 赞同：0
> 
> 时间：2009-01-26T11:24:35.183
> 
> 标签：java, asp.net, asp-classic, migration

我的组织手头上有很多遗留的 ASP 软件。

由于我们认为微软已经表现出对其旧产品明显缺乏支持，我们需要弄清楚下一步要迁移到什么。

如果我们从 Classic ASP 迁移到 ASP.NET，感觉就像是“完全重写”的“迁移”。由于可能是这种情况，我们正在考虑转向免费（如啤酒和语音）平台。我特别认为我们的投资（我的意思是在编程工作上）最好花在一个可以让我们进化的平台上，而不是强迫我们每 4 / 5 年丢弃一行代码。这是我们一直用来倡导走向“免费”平台的主要论据。

目前，我们正在考虑将 Java 与 JRuby 或 Groovy 等动态语言混合使用。

我的问题是：什么是好的迁移选择？我们的恐惧是没有根据的吗？我们（可以想象）是否需要在 4 或 5 年后重写大部分代码库？对于迁移到 .NET 或免费平台，您有什么论据？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T13:40:17.093

我们最近将一个重要的 ASP 项目迁移到 ASP.NET，并且绝对有可能进行不会完全重写的迁移，保留大部分原始代码（尽管我们受益于一些架构良好的代码，它们之间有很好的分离）从一开始就包含业务逻辑和表示层）。

我们研究了两种可能的迁移途径：

1.  彻底重写为“适当的”ASP.NET 应用程序，充分利用内置控件并将所有业务和数据访问层转换为类等——即我们处理新的 ASP.NET 项目的方式。

2.  更基本的语法迁移，获取 ASP 页面并将它们更改为 ASP.NET，而无需对结构或逻辑进行过多的前期更改。然后在此基础上继续开发站点，更好地利用 ASP.NET 控件、单独的类等来实现新的和修订的功能。

由于进度压力，我们采用了第二条路线，使我们能够尽早进行转换，然后将更长远的眼光视为未来发展的一部分。

在此基础上，对于初始迁移，我们能够重用大部分现有代码，尽管随着我们的前进，这些代码正在逐渐被替换。假设一个“平均”页面有 50-200 行 HTML 和 50-500 行 VBScript 代码（作为单独的函数，没有混合到 HTML 意大利面条式中），我们发现每个页面大约需要一个小时才能迁移它们包括将所有 ADO 数据访问更改为新的 ADO.NET 数据访问层。一些简单的页面只需要几分钟——一些更复杂的页面需要一整天——但一个页面大约需要一个小时是数百个页面的总数字，其中更改数据访问的时间占了很大一部分工作量.

如果我们今天要重做迁移，我们将使用 ASP.NET MVC 而不是 Web 表单，因为它更好地映射到原始页面的编写方式——尽管我无法评论迁移到 MVC 是否会花费或多或少的时间。

这不一定与您是否要迁移到免费平台或更改语言有任何关系——您可能有其他原因想要这样做。（我们的客户端是基于 Windows 的，所以迁移到 ASP.NET，除了开发时间，没有额外的成本。）但是，我可以说，无需完全重写就可以将大量的 ASP 站点迁移到 ASP.NET - 这同样可能以最少的工作从早期版本的 ASP.NET 迁移到更新的版本。显然，我们选择的路线是保留代码的一些 ASP 感觉而不是选择完全重新开发，可能并不适合所有人 - 但它确实为您提供了一个低影响的 ASP.NET 入口点，然后允许您在此基础上进行构建在充分利用现有代码库和技能的同时，打好基础。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T16:16:55.717

选择取决于您的公司是否有能力支持您选择的任何内容。

你会自己支持代码吗？如果是这样，你现在的技能基础是什么？

如果您目前正在享受 ASP，那么 ASP.NET（代码重写或不重写）似乎是第一个尝试的想法，即使您没有意识到，通过到目前为止使用 ASP，您可能已经获得了大量的知识维护 IIS，以及大量基于 Microsoft 的服务和服务器，您可以在 ASP.NET 开发、部署和支持中重用或至少轻松适应这些服务和服务器。

JAVA，RUBY，无论你选择什么，任何技术的美/实用/功能/可用性/耐用性都取决于其维护背后的人。

你应该提出的问题是：

1.  最好针对您的团队
2.  谁将开发、计划管理由此产生的应用程序/服务？
3.  你是红宝石人吗？如果没有，你想成为吗？
4.  你是 JAVA 人吗？和上面一样
5.  你是....？

..等等..

不要因为这里和那里的成本或免费与非免费而分散自己的注意力。

当技术对项目背后的人来说是未知/新的时，支持的工时可能比大多数打包软件解决方案昂贵得多，然后它们将为您提供支持。

这对于您必须为 IDE/服务器/等支付更多费用的开发环境也是如此，但归根结底，您需要通过的学习曲线较少，并在您的专业水平上提供支持。

此外：就像@annakata 所说，你有很多机会/项目来实现“像啤酒一样免费”ASP.NET 功能.. 单声道与否..

示例：如果您喜欢这种东西，可以使用 Apache 设置 ASP.NET 服务。

通过你知道的和想知道的来选择你想采用的技术，而不是你认为最新和最伟大的技术，特别是如果你甚至开始考虑重建代码集的全部原因是由于缺乏Microsoft 对 ASP 的支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T11:32:50.317

你知道[单声道](http://www.mono-project.com/Main_Page)存在吗？

我想你会发现一种语言的寿命并不像你想象的那么重要，因为一个应用程序的主要版本的寿命很可能比大多数语言的寿命短。公平地说，.NET 2.0 -> 3.0 是一个很小的转变，而不是“倾倒每一行代码”的练习。如果您甚至想升档，这还不是必需的。

我认为可以为您可能考虑的任何给定平台提供强有力的案例，我会考虑其他因素，例如您的程序员的舒适度/技能/熟悉度、社区支持、扩展和适合目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T12:00:13.413

我认为您无法摆脱每 4 到 5 年迁移一次的痛苦，因为该行业处于不断变化之中，工具、平台和语言也在不断发展以最大限度地提高效率。不能保证 Groovy/Ruby/C# 不会改变以采用下一个大趋势。

就我个人而言，我不会为了 100% 的未来证明而失眠。如果这是目标，那么您不妨使用汇编，即使那样也不能保证它会保持不变。

只需考虑以下 1) 你们知道什么？如果他们是 vb 人，那么迁移到 VB.NET 是有意义的 2) 你对工具有什么预算？3）你想移动的平台是否有你需要的东西？我记得一段时间后惊讶地发现 Powerbuilder 对正则表达式的支持（或缺乏） 4）平台周围有社区吗？

# c# - 如何使用 TcpChannel 配置对远程服务器的并发请求限制

> ID：479464
> 
> 赞同：4
> 
> 时间：2009-01-26T11:25:41.640
> 
> 标签：c#, .net, remoting

我有一个带有底层 TcpChannel 的标准远程处理服务器：

```
 IDictionary props = new Hashtable();
    props["port"] = portnumber;
    TcpChannel channel = new TcpChannel(props, null, provider);

    ChannelServices.RegisterChannel(channel, false);
    string url = string.Format("AgentHost", portnumber);
    RemotingConfiguration.RegisterWellKnownServiceType(
        typeof(RemotingAgentHostEndPoint),
        url,
        WellKnownObjectMode.SingleCall); 
```

它工作正常，但在 200 个并行调用时，客户端收到“无法建立连接，因为目标机器主动拒绝它 127.0.0.1:33333”异常。

我找不到任何地方可以超越这个限制——你们有线索吗？

亲切的问候卡斯滕赫斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T12:40:15.860

Windows has a limit for maximum number of concurrent half-opened tcp connections. This limit vary in different versions and configurations, but it is here. Google for tcpip.sys troubles for example - you will find various configuration options to override this.

# html - 我可以在 Visual Studio 中重新格式化 HTML 而不删除空行吗？

> ID：479465
> 
> 赞同：4
> 
> 时间：2009-01-26T11:26:11.157
> 
> 标签：html, visual-studio, formatting

Visual Studio 中的 HTML 格式效果很好——尤其是考虑到您可以选择一个选择并对其进行格式化。您可以只选择一个标签或块，右键单击并执行“格式选择”。您还可以重新格式化整个文档。

然而，我喜欢在我的文档中使用大量空白来保持内容井井有条，并且重新格式化 HTML 会压缩（删除！）这个空白。

是否有任何用于格式化 HTML 的插件或外部工具可以使垂直空间保持不变？

**编辑：奖励积分：如果有人安装了 2010，他们可以检查它是否已经具有此功能？**如果它没有此功能，我想提交功能请求。幸运的是，新编辑器的可扩展性更强，但我不知道这是否会扩展到这样的自定义。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-11-15T02:21:46.920

Visual Studio 2012 在格式化 HTML 时保留空换行符。我遇到了这个 SO 帖子，因为我正在寻找删除空行的选项！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T12:18:24.623

如果文档中的空格有一些系统逻辑（例如，每个表格标记前后的换行符），那么您可能能够在应用格式时获得所需的行为。

从以下位置查看选项对话框：工具 -> 选项 -> 文本编辑器 -> HTML -> 格式 -> “标签特定选项”

这几乎可以让您将每种标签的格式自定义到合理的分钟级别。在您的特定情况下，“换行符”选项可能有用或至少相关。

您可能还想尝试自定义 HTML 格式化程序，例如[HTML Tidy](http://tidy.sourceforge.net/ "HTML 整洁")。许多强大的编辑器，如 Notepad++ 和 UltraEdit，都内置了用于格式化的 HTML Tidy 模块。不过，就我个人而言，我发现 Visual Studio 的格式化功能足以满足大多数要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-12T18:06:20.577

简短的回答是否定的，2008 将始终按照其设置的方式重新格式化它。您必须配置标签特定选项中的设置以匹配您希望 HTML 显示的方式。

它可以在标签前后最多保留两个空格，但不幸的是，没有办法维护空格或注释格式（它只识别相同的开始 + 结束标签）

如果您遇到与您的编码风格相匹配的问题，我的问题[可能会有所帮助](https://stackoverflow.com/questions/639057/visual-studio-2008-html-formatting-does-it-ever-work/639090)

# sql - 如何在 MySQL 中生成一系列每小时平均值？

> ID：479466
> 
> 赞同：11
> 
> 时间：2009-01-26T11:26:26.100
> 
> 标签：sql, mysql

我的表中有十分钟间隔的数据：

```
2009-01-26 00:00:00      12
2009-01-26 00:10:00      1.1
2009-01-26 00:20:00      11
2009-01-26 00:30:00      0
2009-01-26 00:40:00      5
2009-01-26 00:50:00      3.4
2009-01-26 01:00:00      7
2009-01-26 01:10:00      7
2009-01-26 01:20:00      7.2
2009-01-26 01:30:00      3
2009-01-26 01:40:00      25
2009-01-26 01:50:00      4
2009-01-26 02:00:00      3
2009-01-26 02:10:00      4
etc. 
```

是否可以为 MySQL 制定单个 SQL 查询，它将在每小时内返回一系列平均值？

在这种情况下，它应该返回：

```
5.42
8.87
etc. 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-26T11:38:44.330

目前尚不清楚您是否希望在几天内汇总平均值。

如果您想要 26 日午夜与 27 日午夜的不同平均值，请修改 Mabwi 的查询：

```
SELECT AVG( value ) , thetime
FROM hourly_averages
GROUP BY DATE( thetime ), HOUR( thetime ) 
```

注意子句`DATE()`中的附加内容。`GROUP BY`没有这个，查询将把所有数据从`00:00`到平均在一起，`00:59`而不考虑它发生的日期。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T11:33:49.207

这应该有效：

```
SELECT AVG( value ) , thetime
FROM hourly_averages
GROUP BY HOUR( thetime ) 
```

这是结果

```
AVG(value)          thetime
5.4166666865349     2009-01-26 00:00:00
8.8666666348775     2009-01-26 01:00:00
3.5                 2009-01-26 02:00:00 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-06-19T08:26:23.907

考虑到日期在数据库中具有字符串表示这一事实，还有另一种可能性：

You can use `SUBSTRING(thetime, 1, [len])`, extracting the common part of your group. For the example with hourly averages you have the SQL query

```
SELECT SUBSTRING(thetime, 1, 13) AS hours, AVG(value) FROM hourly_averages GROUP BY hours 
```

By the `len` parameter you can specify the aggregated time interval considering the MySQL date format `yyyy-MM-dd HH:mm:ss[.SS...]`:

*   `len = 4`: group by years
*   `len = 7`: group by months
*   `len = 10`: group by days
*   `len = 13`: group by hours
*   `len = 16`: group by minutes
*   `len = 19`: group by seconds

We encountered a better performance of this method over using date and time function, especially when used in JOINs in MySQL 5.7\. However in MySQL 8 at least for grouping both ways seem to take approximately the same time.

# projects - 你会创建什么公共服务项目

> ID：479468
> 
> 赞同：0
> 
> 时间：2009-01-26T11:28:23.180
> 
> 标签：projects

如果你有

*   4 软件开发人员
*   任何开源软件
*   服务器硬件
*   用于托管的互联网连接
*   100人天在哪做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:41:39.077

一个类似于 Rent-a-Coder 的网站怎么样，但非营利组织可以为公共服务项目招募志愿者或低成本开发人员（即，让您的问题在同等情况下的下一个人更容易）。鉴于当前的经济困难，可能会有很多失业的开发商和很多陷入困境的非营利组织（以及对这些非营利组织提供的各种帮助的大量需求）。让我们把它们放在一起。

添加像 StackOverflow 这样的积分系统，这样您就可以通过帮助非营利组织的 Web 应用程序或其他方式来赚取积分。然后去获得一些企业赞助，这样你就可以在 Amazon.com 或类似的网站上将你的积分转化为积分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T11:35:13.243

有什么可以代替[diebold](http://en.wikipedia.org/wiki/Premier_Election_Solutions#Security_issues)软件的吗？

永远的毁灭公爵？:P

# php - 安装 WAMP 服务器后，Visual Studio 的本地主机不显示。你如何让它发挥作用？

> ID：479469
> 
> 赞同：1
> 
> 时间：2009-01-26T11:29:36.250
> 
> 标签：php, visual-studio-2008, wamp

我首先在我的系统上安装了 WAMP 服务器。它使用[http://localhost](http://localhost)在 www 目录中显示我的文件。

但后来我安装了 Visual Studio 2008。它也使用[http://localhost/](http://localhost/) 但它没有显示出来。我该怎么办？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T11:47:55.370

我假设你的意思是 IIS？当您启动应用程序时，Cassini（“调试”网络服务器中的构建）使用高端口。无论哪种方式，您都需要配置 WAMP 或 IIS 以侦听端口 80 以外的端口，然后您可以在[http://localhost/](http://localhost/)上访问一个，在[http://localhost:MYPORT/](http://localhost:MYPORT/)上访问一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T16:48:24.173

VS 使用自己的开发服务器，通常 VS 以调试模式启动自己的服务器，并且没有通用的服务器可执行文件。由于 VS 需要在调试模式下启动它自己的服务器来测试 .NET 驱动的应用程序，它无法显示您的 WAMP 应用程序，因为它通常在其他端口上运行。此外，您不能在 VS 下运行 PHP 应用程序。

尝试查看浏览器在应用程序 URL 处为您带来的服务器连接。

# syntax - crontab 是否有类似 lint 的程序？

> ID：479472
> 
> 赞同：10
> 
> 时间：2009-01-26T11:30:03.440
> 
> 标签：syntax, cron, sysadmin, lint

crontab 有类似 lint 的东西吗？我想知道我已经整理好我所有的空间和星星，而无需等待某些东西不起作用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2014-11-06T09:20:21.840

有一个用于 crons 的 Python linter。查看[`chkcrontab`项目](https://pypi.org/project/chkcrontab/)

您可以通过以下方式安装它`pip`：

```
pip3 install chkcrontab 
```

示例用法：

```
chkcrontab /etc/cron.d/power-schedule
Checking correctness of /etc/cron.d/power-schedule
E: 15: 0 12 * foo * * root echo hi
e:     FIELD_VALUE_ERROR: foo is not valid for field "month" (foo)
e:     INVALID_USER: Invalid username "*"
E: There were 2 errors and 0 warnings. 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-10-04T10:50:55.977

我发现[CronWTF](http://cronwtf.github.com/)在编写 crontab 时非常有用 - 它将你的星星和命令转换成更人性化的东西，从而更容易阅读奇怪的 cron 作业。

更好的是，因为它都是 javascript，你可以在本地运行它，而且没有人需要知道你的顶级 sekrit cron 作业。

如果您编写 ruby​​ 代码，另一种选择是使用[when](http://github.com/javan/whenever "javan 在 master 的任何时候 - GitHub") gem - 您使用一个示例 ruby​​ 文件调用`schedule.rb`来解析，并像这样生成 crontab：

```
every 10.minutes do
  command "/usr/bin/my_great_command" 
end 
```

会给你一个 crontab 条目

```
0,10,20,30,40,50 * * * * /usr/bin/my_great_command 
```

而这个在这里：

```
every 2.days, :at => '4:30am' do
  command "/usr/bin/my_great_command" 
end 
```

会给你：

```
30 4 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31 * * /usr/bin/my_great_command 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T12:31:36.843

我认为您不需要 crontab 的 lint。有 5 个字段用空格隔开，然后是一个空格，然后是要运行的命令，它的参数结束行。

此外，至少在 Ubuntu 上，crontab 不会让您保存 bum 文件。我只是尝试了一些东西，但它对所有的东西都嗤之以鼻。我想这意味着 crontab 是它自己的 'lint for cron'。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-05-29T21:20:52.357

我不确定这是否是您正在寻找的那种东西，但它通过向您确切显示您将计划设置为的内容，使编写 crontab 变得非常容易：

[https://crontab.guru/](https://crontab.guru/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T11:48:07.087

它可能有点偏离，但一种简单的方法是使用图形 crontab 编辑器（如 kcron 或 gcrontab）加载它。如果您需要在脚本中调用它，[这个问题](https://stackoverflow.com/questions/235504/validating-crontab-entries-w-php)是关于如何在 php.ini 中调用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-09T13:57:54.227

如果您无法访问 python 和 pip 来使用，您可以尝试使用[Wicked Cool Shell Scripts, 2nd Edition](https://nostarch.com/wcss2/)命名`48-verifycron`的shell 脚本
`chkcrontab`

# ruby-on-rails - 如何检查控制器操作是否已经重定向？

> ID：479475
> 
> 赞同：0
> 
> 时间：2009-01-26T11:31:22.893
> 
> 标签：ruby-on-rails, ruby, redirect, controller

好的，通常情况下，我的应用程序中有一个控制器操作，它被 before_filter 保护免受未经授权的访问。唯一的是，如果另一个条件为真，我需要重定向此操作：

```
class Payment < ApplicationController
  before_filter login_required

  def new
    redirect_to some_other_path if @order.is_free?
    @payment = Payment.new
  end
end 
```

在我的测试中，我检查以确保该操作受到正确保护，但是，@order.is_free 语句也是如此。在这种情况下，我收到以下错误：

```
`render_with_no_layout': Can only render or redirect once per action 
```

有没有办法检查以确保我没有重定向或覆盖现有的重定向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T12:56:38.010

我假设如果用户未登录，则 login_required 方法会执行重定向。在这种情况下：

调用重定向后，您的 before 过滤器应返回 false。这将防止调用新操作。如果您在 before_filter 中调用 render 或 redirect，则更高版本的 rails 会自动执行此操作，因此您可能使用的是旧版本。

此外，您应该在新处理程序中调用重定向后返回，除非您希望始终创建一个新的 Payment 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T03:07:30.960

你的类应该是 PaymentController，而不是 Payment。这样做的原因是控制器类和模型类不会冲突。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T11:50:48.937

我不认为您的前置过滤器是导致双重渲染错误的原因。看看这个例子：

```
class PostsController < ApplicationController
  before_filter :perform_a_redirect, :except => [:wtf]

  def index
    redirect_to 'http://google.com'
  end

  def wtf
    render :text => 'wtf'
  end

  private

  def perform_a_redirect
    redirect_to :action => 'wtf'
  end
end 
```

访问 /posts 时，我被重定向到 /posts/wtf。没有双重渲染错误。假设您的“login_required”方法仅重定向/呈现一次，我怀疑您在此处发布的代码不是问题，而是其他原因导致了这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T17:25:30.680

前置过滤器是一个红鲱鱼。当`@order_is_free?`代码既设置重定向又落入新的渲染时。重定向语句不控制方法的流程。在重定向后添加 return 语句，或者您甚至可以返回重定向，如`return(redirect_to :action => :show, :id => @order, :controller => :free_orders)`

# asp.net - 为什么你认为微软没有在 .net 中实现 asp-classic 作为另一种语言

> ID：479476
> 
> 赞同：2
> 
> 时间：2009-01-26T11:32:14.013
> 
> 标签：asp.net, asp-classic, frameworks, migration

几天前我有这个想法，为什么不在.net中实现asp-classic作为另一种语言......

它会帮助很多人迁移到新平台......

我的意思是有 IronRuby、IronPython 等...

对我来说这听起来是个好主意……但是，拜托，我不是天才，他们没有这样做一定是有原因的……

我只是对它很好奇...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T11:36:48.560

因为微软已经放弃了他们 API 的向后兼容性。我猜他们认为将维护成本用于新开发是一项更好的投资。

有时我同意，有时我不同意他们的新观点……

现在，您不认为只是我将我的想法投射到微软这里，您有一些参考资料：

*   [乔尔的一篇关于它的文章](http://www.joelonsoftware.com/articles/APIWar.html)

> 第一个重大胜利是使 Visual Basic.NET 不能向后兼容 VB 6.0。这实际上是记忆中的第一次，当您购买 Microsoft 产品的升级时，您的旧数据（即您用 VB6 编写的代码）无法完美无声地导入。这是 Microsoft 升级第一次不尊重用户使用以前版本的产品所做的工作。
> 
> ...
> 
> 凭借这一重大胜利，MSDN 杂志营接手了。突然之间改变事情就可以了。IIS 6.0 推出了一个不同的线程模型，它破坏了一些旧的应用程序。我震惊地发现我们的 Windows Server 2003 客户在运行 FogBugz 时遇到了问题。然后 .NET 1.1 不能完全向后兼容 1.0。既然猫已经从袋子里出来了，操作系统团队就振作起来，决定不向 Windows API 添加功能，而是完全替换它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T11:39:58.460

主要是因为 asp-classis 不是一种语言。它是一个非常小的 COM 对象框架。

用于 ASP 的内置语言是 VBScript 和 Javascript。我不明白为什么有人会想要使用“VBScript.NET”，而“JScript.NET”确实存在，尽管它有点像狗晚餐。

如果你愿意，你可以用 VB.NET 制作一个 ASPX 页面，可以用 ASPEsq 方式编写代码。

# visualization - 了解其他人的代码

> ID：479479
> 
> 赞同：8
> 
> 时间：2009-01-26T11:33:41.250
> 
> 标签：visualization, legacy, legacy-code

我偶尔会很不幸地不得不对非常陈旧、**没有**记录和设计~~不佳~~ ~~的~~代码**进行修改。**

 **~~**进行简单的更改通常需要很长时间，因为现有代码的结构并不多，而且我真的必须阅读大量代码才能了解事情的发展方向。

我认为在这种情况下会有很大帮助的是一种工具，它可以让人们可视化代码的概述，然后甚至可以深入了解更多细节。我怀疑这样的工具很难做到正确，因为它试图找到几乎没有或没有的结构。

我想这不是一个真正的问题，而是一个沉思。我应该把它变成一个问题 -**其他人如何帮助他们了解其他人的代码，好的和坏的？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T11:44:23.180

嗯，这是一个很难的，这么多说这么少时间......

1）如果你可以运行代码，它会让生活变得更加轻松，断点（尤其是条件断点）是你的朋友。

2）纯粹主义者的方法是为已知功能编写一些单元测试，然后重构以改进代码和理解，然后重新测试。如果事情破裂，那么创建更多的单元测试 - 重复直到无聊/旧/移动到新项目

3) ReSharper 擅长显示事物在哪里被使用，例如什么在调用一个方法，它是静态的，但是一个好的开始，它有助于重构。

4) 许多 .net 事件被编码为公开的，在最好的情况下调试事件可能会很痛苦。将它们重新编码为私有并使用带有添加/删除的属性。然后，您可以使用断点来查看正在侦听的事件。

顺便说一句 - 我正在玩 .Net 空间，并且希望有一个工具来帮助做这种事情，比如 Joel 有没有人知道一个好的动态代码审查工具？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T12:19:20.863

过去，我被要求拥有一些 NASTY 代码的所有权——工作和“游戏”。

我接手代码的大多数业余爱好者只是在某种程度上改进了代码，以便在几次迭代中完成他们需要的工作。库 A 调用 B、调用回 A、调用 C、调用 B 等等总是乱七八糟的。很多时候他们会使用线程而不是关键部分。

我发现获取代码句柄的最佳/唯一方法是从操作系统入口点 [main()] 开始并构建我自己的调用堆栈图来显示调用树。您实际上并不需要在一开始就构建一棵完整的树。只需跟踪您在每个阶段正在处理的部分，您就会对能够运行它的事情有足够的把握。

最重要的是，使用你能找到的最大的一片死树和一支笔。将所有内容都摆在您面前，这样您就不必在屏幕或页面上来回跳转，让生活变得如此简单。

编辑：有很多关于编码标准的讨论......他们只会让糟糕的代码看起来与好的代码一致（并且通常更难发现）。编码标准并不总是使维护代码更容易。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T11:55:59.490

我定期这样做。并开发了一些工具和技巧。

*   尝试获得一般概述（对象图或其他）。
*   记录你的发现。
*   测试你的假设（特别是对于模糊的代码）。

这样做的问题是，在大多数公司中，您都会因结果而受到赞赏。这就是为什么一些程序员快速编写糟糕的代码并转移到不同的项目的原因。所以你只剩下垃圾了，你的老板将你缓慢的进步与快速而肮脏的家伙进行比较。（幸运的是，我现在的雇主不同）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T11:40:31.330

我一般使用组件使用的各种关键方式的 UML 序列图。我不知道有什么工具可以自动生成它们，但许多 UML 工具（例如 BoUML 和 EA Sparx）可以从源代码创建类/操作，从而节省一些输入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T12:36:08.987

关于这种情况的权威文本是 Michael Feathers 的《有效处理遗留代码》。正如[S. Lott](https://stackoverflow.com/users/10661/s-lott)所说，进行一些单元测试来确定遗留代码的行为。一旦你有了这些，你就可以开始重构了。Object Mentor 网站上[似乎](http://www.objectmentor.com/resources/articles/WorkingEffectivelyWithLegacyCode.pdf)有一个示例章节。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T11:43:45.223

有关通过单元测试掌握旧版应用程序的建议，请参阅[单元测试旧版 ASP.NET Webforms 应用](https://stackoverflow.com/questions/342693/unit-testing-legacy-web-apps)程序。

有很多类似的问题和答案。这是搜索[https://stackoverflow.com/search?q=unit+test+legacy](https://stackoverflow.com/search?q=unit+test+legacy)

关键是，如果您正在为遗产编写单元测试，那么了解遗产可能是最容易的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T11:44:10.683

我没有很好的工具来自动审查记录不佳/执行的代码，导致一个令人困惑/设计糟糕的程序通常会转化为一个不太有用的模型。这并不令人兴奋或立即获得回报，但我已经获得了最好的结果，我选择了一个位置并逐行跟踪程序执行，记录并添加注释，并在适用的情况下进行重构。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-26T12:02:21.940

在许多情况下，一个好的 IDE（EMACS 或 Eclipse）会有所帮助。同样在 UNIX 平台上，有一些用于交叉引用（etags、ctags）或检查（lint）或 gcc 的工具打开了许多警告选项。

首先，在尝试理解一个函数/方法之前，我会对其进行一些重构以适应您的编码约定（空格、大括号、缩进），如果它们似乎是错误的，则删除大部分注释。

然后我会重构和注释你理解的部分，并尝试在整个源代码树中查找/grep 这些部分并在那里重构它们。

随着时间的推移，你会得到一个更好的代码，你喜欢使用它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-26T23:35:02.807

我个人做了很多图表的绘制，并弄清楚结构的骨骼。

一时的流行（而且可能是完全正确的）让我编写单元测试来测试我的断言，并为我对系统所做的更改建立一个安全网。

一旦我对系统的功能感到满意，我会尝试以最合理的方式修复错误，并希望我的安全网接近完成。

然而，这只是我。;)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-26T23:50:42.120

我实际上一直在使用 ReSharper 的重构功能来帮助我处理我最近继承的一堆项目。因此，为了找出另一个程序员的结构非常糟糕、未记录的代码，我实际上是从重构它开始的。

清理代码、正确重命名方法、类和命名空间，提取方法都是结构性变化，可以阐明一段代码应该做什么。重构您不“知道”的代码可能听起来违反直觉，但请相信我，ReSharper 确实允许您这样做。以红鲱鱼死代码问题为例。您会在类中看到一个方法，或者可能是一个奇怪命名的变量。您可以从尝试查找用法开始，或者进行文本搜索，但 ReSharper 实际上会检测死代码并将其着色为灰色。一旦你打开一个文件，你就会看到灰色的和带有滚动条标志的文件，这在过去会让人困惑。

还有许多其他技巧，可能还有许多其他工具可以做类似的事情，但我是一个 ReSharper 瘾君子。

干杯。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-26T23:57:47.863

从用户的角度深入了解软件。通过研究用户界面并与之交互，可以了解很多关于底层结构的信息。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-27T00:43:37.490

*   打印输出
*   白板
*   大量的记事本
*   很多星巴克

能够在可怜的东西上乱涂乱画对我来说是最有用的方法。通常我会在尝试制作基本的代码结构图时出现很多“嗯，这很有趣……”，最终结果证明它们比图本身更有用。自动化工具可能比我认为的更有帮助，但找到这些有趣的部分的价值超过了快速生成图表的价值。

对于图表，我主要寻找数据的去向。它从哪里进来，它在哪里结束，以及它在途中经历了什么。一般来说，数据所发生的事情似乎会给整体布局留下一个很好的印象，如果我要重写的话，还有一些骨头要回来。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-31T21:09:14.450

当我处理遗留代码时，我不会试图理解整个系统。这将导致复杂性超载和随后的大脑爆炸。

相反，我采用系统的一个单一功能，并尝试从头到尾完全理解它是如何工作的。我通常会调试代码，从 UI 代码中我可以找到特定功能的点开始（因为这通常是我最初能够找到的唯一内容）。然后我将在 GUI 中执行一些操作，并在代码中一直向下钻取到数据库中，然后再备份。这通常会导致对系统的至少一个特征有一个完整的理解，有时也会让我们深入了解系统的其他部分。

一旦我了解了正在调用哪些函数以及涉及哪些存储过程、表和视图，然后我会搜索代码以找出应用程序的哪些其他部分依赖于这些相同的函数/过程。这就是我如何确定我将要进行的更改是否会破坏系统中的其他任何内容。

有时尝试绘制数据库和/或代码结构图也很有用，但有时它太糟糕或太复杂了，最好忽略整个系统，只关注你需要的部分改变。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-26T13:19:55.327

我的大问题是我（目前）有非常大的系统需要在相当短的时间内理解（我在这一点上同情合同开发人员）并且没有很多这样做的经验（以前有幸成为从头开始设计。）

我使用的一种方法是尝试理解变量、方法、类等命名的含义。这很有用，因为它（希望越来越多）嵌入了原子级别的一系列思想的高级视图。

我这样说是因为通常开发人员会有意义地命名他们的元素（用他们认为是什么）并提供对其预期功能的洞察力。诚然，这是有缺陷的，如果开发人员对其程序的理解有缺陷，则术语或（通常情况下，恕我直言）试图听起来很聪明。有多少开发人员第一次看到关键字或类名，然后才在字典中查找该术语？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-16T20:29:38.320

我强烈推荐[BOUML](http://bouml.free.fr/)。它是一个免费的 UML 建模工具，它：

*   速度极快（有史以来最快的 UML 工具，查看[基准测试](http://bouml.free.fr/benchmark.html)），
*   具有坚如磐石的 C++ 导入支持，
*   具有强大的 SVG 导出支持，这一点很重要，因为以矢量格式查看大图（在 Firefox 等中可以快速缩放）非常方便（您可以在“鸟瞰”视图和类详细视图之间快速切换），
*   功能齐全，开发密集（看看[开发历史](http://bouml.free.fr/historic.html)，很难相信有这么快的进步是可能的）。

所以：将您的代码导入 BOUML 并在那里查看，或导出到 SVG 并在 Firefox 中查看。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-26T11:48:28.303

这完全取决于您的公司正在使用的标准和编码规则。

如果每个人的代码风格不同，那么很难维护其他程序员的代码等等，如果你决定使用什么标准有一些规则，一切都会好起来的:) 注意：你不必做很多规则，因为人们应该有可能以他们喜欢的风格进行编码，否则你会感到非常惊讶。

# .net - Linq - 当子记录查询由不同的函数收集时求和子字段值

> ID：479481
> 
> 赞同：0
> 
> 时间：2009-01-26T11:33:54.930
> 
> 标签：.net, linq, iqueryable

我有订单 - 物品表。所以我想在某个网格上显示所有订单信息，包括像 total_items 这样的列

有一种预先的工作方式。像这样：

```
TotalQuantity = 
  (from i in _db.ProposaItems 
   where i.ProposaID == p.ProposaID select i)
  .Sum(q => q.Quantity) 
```

但这不是我想要的方式。我想使用 2 个功能：

功能一：

```
//BizNet.SqlRepository.Data.ProposalItem        
public IQueryable<ProposaItem> GetItems(Guid ProposaID)
{
  return from i in _db.ProposaItems
         where i.ProposaID == ProposaID
         select i;
} 
```

功能2。

```
public void GetProposas()
{
  var x = from p in _db.Proposas
          let t= GetItems(p.ProposaID)
                 .Sum(q => q.Quantity)
          select new 
          {
            ID = p.ProposaID,
            TotalQuantity = t
          };
} 
```

对我来说，它看起来很简单。但在一线

```
x.Count(); 
```

结果是异常。

```
"Member access 'Int16 Quantity' of 'BizNet.SqlRepository.Data.ProposaItem' not legal on type 'System.Linq.IQueryable`1[BizNet.SqlRepository.Data.ProposaItem]."

"   at System.Data.Linq.SqlClient.SqlMember.set_Expression(SqlExpression value)\r\n   at System.Data.Linq.SqlClient.SqlFactory.Member(SqlExpression expr, MemberInfo member)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.AccessMember(SqlMember m, SqlExpression expo)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitMember(SqlMember m)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitUnaryOperator(SqlUnary uo)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSimpleExpression(SqlSimpleExpression simple)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitUnaryOperator(SqlUnary uo)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSelect(SqlSelect select)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.VisitSequence(SqlSelect sel)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.VisitScalarSubSelect(SqlSubSelect ss)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.VisitSubSelect(SqlSubSelect ss)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSubSelect(SqlSubSelect ss)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitNew(SqlNew sox)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitExpression(SqlExpression expr)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSelect(SqlSelect select)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitAlias(SqlAlias a)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.VisitSource(SqlSource source)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSelect(SqlSelect select)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitAlias(SqlAlias a)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.VisitSource(SqlSource source)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitSelect(SqlSelect select)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Visitor.VisitIncludeScope(SqlIncludeScope scope)\r\n   at System.Data.Linq.SqlClient.SqlVisitor.Visit(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlBinder.Bind(SqlNode node)\r\n   at System.Data.Linq.SqlClient.SqlProvider.BuildQuery(ResultShape resultShape, Type resultType, SqlNode node, ReadOnlyCollection`1 parentParameters, SqlNodeAnnotations annotations)\r\n   at System.Data.Linq.SqlClient.SqlProvider.BuildQuery(Expression query, SqlNodeAnnotations annotations)\r\n   at System.Data.Linq.SqlClient.SqlProvider.System.Data.Linq.Provider.IProvider.Execute(Expression query)\r\n   at System.Data.Linq.DataQuery`1.System.Linq.IQueryProvider.Execute[S](Expression expression)\r\n   at System.Linq.Queryable.Count[TSource](IQueryable`1 source)" 
```

对此有一些解释吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:11:29.820

`GetItems`我认为您不能在 LINQ to SQL 查询中调用未映射的函数（例如）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T03:05:32.090

GetItems 函数在 linqtoSql 查询中应该没问题，因为它本身返回一个 IQueryable。如果这是一个问题，您很可能会得到一个“不支持”的异常，而不是您得到的异常。

但看起来您真正想要的是所有产品 ID 的列表及其相关数量的总和。如果是这样，那么我认为您应该考虑使用 linq 组。据我所知，您可以像这样在单个查询中编写您要执行的操作：

```
var x = from p in _db.ProposaItems
         group p by p.ProposaID into g
         select new
         {
           ID = g.Key,
           TotalQuantity = g.Sum(c => c.Quantity)
         }; 
```

# ads - “广告服务器”如何工作？

> ID：479487
> 
> 赞同：12
> 
> 时间：2009-01-26T11:36:51.493
> 
> 标签：ads, advertisement-server

我正在寻找有关广告服务器的一些信息。

1.  实施细节
    *   跟踪代码生成
    *   用户数据收集
    *   投放广告以响应点击
2.  适用标准
3.  参考资料（请提供链接或搜索团队进行搜索）
    *   图书
    *   白皮书
4.  .NET 中的实现（开源）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-01T15:57:59.227

查看[IAB（互动广告局）](http://www.iab.net/about_the_iab)

他们对广告横幅格式等一些普遍认可的事物有规范。他们似乎主要处理业务问题，而不是技术/实施细节。

最简单的实现是简单地指向来自另一台服务器的图像。该服务器将识别广告在哪个站点上显示（来自“Referer”标头，或者来自与图像请求一起传递的 id 或令牌）。然后返回图像并记录浏览量。如果查看者点击广告，一个也指向广告服务器的链接将记录一次“点击”，然后将请求转发给广告商。

数据库可能看起来像这样（非常简单，仅作为示例）：

```
    页面
    +---------+----------------+
    | page_id | 姓名 |
    +---------+----------------+
    | 1 | mycoolsite.com |
    +---------+----------------+

    广告
    +-----------------+------+------------ ------------------+
    |advertisement_id | 图像名称 | 目标网址 |
    +-----------------+------+------------ ------------------+
    | 1 | 横幅1_468.png | http://new-amazing-product.com |
    +-----------------+------+------------ ------------------+

    活动
    +---------------+--------+--------+---- ----+
    | page_id | 广告ID | 意见 | 点击 |
    +---------------+--------+--------+---- ----+
    | 1 | 1 | 0 | 0 |
    +---------------+--------+--------+---- ----+

```

在将显示添加的页面中，您将其放入 html 中：

```
<iframe src="http://your-ad-server.com/ads/image?site=1" /> 
```

当用户查看页面时，对图像的请求将转到广告服务器。广告服务器会查找请求，选择要显示的广告（这里有许多专有算法），记录请求，最后返回响应。

```
    活动
    +---------------+--------+--------+---- ----+
    | page_id | 广告ID | 意见 | 点击 |
    +---------------+--------+--------+---- ----+
    | 1 | 1 | * 1 * | 0 |
    +---------------+--------+--------+---- ----+

```

响应可能包含以下内容（从数据库中检索）：

```
<a href="http://your-ad-server.com/ads/click?id=1">
  <img src="http://your-ad-server.com/ads/banner1_468.png" />
</a> 
```

现在图像已加载并显示在页面上。如果用户决定点击它，请求会再次发送到记录点击的广告服务器，并最终将请求重定向到正在做广告的页面。

```
    获取 /ads/click?id=1

    301 永久搬家
    地点：http://mycoolsite.com

```

```
    活动
    +---------------+--------+--------+---- ----+
    | page_id | 广告ID | 意见 | 点击 |
    +---------------+--------+--------+---- ----+
    | 1 | 1 | 1 | * 1 * |
    +---------------+--------+--------+---- ----+

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T11:48:34.950

我在这样的公司工作，恐怕这种专有信息被认为是极其敏感的。AFAIK 没有公共标准，可用的大部分文档仅用于用户实施。

那里可能有一些白皮书，可能来自学术界，但谷歌可能已经仁慈地发表了一些东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T16:04:49.773

实际上有一些非常具体的指南来衡量展示次数、点击次数、转化次数、富媒体事件等。这些指南可以在以下网址找到：[http ://www.iab.net/iab_products_and_industry_services/508676/guidelines](http://www.iab.net/iab_products_and_industry_services/508676/guidelines)

如果您遵守这些准则，您可以请求 IAB 批准您的广告服务器。一旦获得批准，广告商和发布商应该信任通过您的报告生成的数字。

# asp.net - 将 ASP.NET Web 表单博客框架集成到 ASP.NET MVC

> ID：479488
> 
> 赞同：2
> 
> 时间：2009-01-26T11:37:29.840
> 
> 标签：asp.net, asp.net-mvc

有没有办法在 ASP.NET MVC 应用程序中使用类似 BlogEngine.NET（在 ASP.NET Web 表单模型上开发的博客框架）之类的东西？我想要一些我可以简单地访问[http://rooturl/blog](http://rooturl/blog)并让它启动 BlogEngine.NET 站点的东西。我假设 ASP.NET MVC 框架将拦截此调用并尝试将其路由到“BlogController”的索引函数。有什么办法可以解决这个问题还是不是问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T11:55:18.570

Scott Hanselman 不久前写到：

> [插件混合：ASP.NET WebForms 和 ASP.MVC 以及 ASP.NET 动态数据并排](http://www.hanselman.com/blog/PlugInHybridsASPNETWebFormsAndASPMVCAndASPNETDynamicDataSideBySide.aspx)

但是，如果我没记错的话，如果您没有与 /blog 匹配的控制器，那么引擎将默认将请求发送到您的 /blog 文件夹，然后您就走了，最重要的是，正如 Scott 指出的那样：

> 为什么 ASP.NET MVC 不抓取请求？两个原因。首先，RouteCollection 上有一个名为 RouteExistingFiles 的选项。它默认设置为 false，这会导致 ASP.NET MVC 在磁盘上存在文件时自动跳过路由。

但是，他继续指出，您可以在路由定义的顶部添加以下内容：

```
routes.IgnoreRoute("blog/{*pathInfo}"); 
```

然后将忽略对 /blog/ 的所有请求

# php - 我可以在 curl 连接上发出多个请求吗？

> ID：479490
> 
> 赞同：1
> 
> 时间：2009-01-26T11:38:20.727
> 
> 标签：php, curl

在 PHP (v5) 中，有没有办法在打开的 curl 连接上发出多个请求？

我注意到我的最大瓶颈是连接本身的超时/拆除（我正在发出许多快速完成的小数据请求），所以我希望能够做一些类似 open

初始化卷曲连接，

设置 url/params，执行请求，获取结果 设置 url/params，执行请求，获取结果

关闭卷曲

我只是不知道这是否可能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T11:41:45.383

可能这些[`curl_multi_*`](http://php.net/manual/en/function.curl-multi-init.php)功能就是您正在寻找的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T11:45:48.557

您应该可以通过添加`Keep-alive`标题来做到这一点：

```
$headers  = array
(
    "Keep-alive: 300",
    "Connection: keep-alive",
    // ... other headers...
);

curl_setopt($this->curl_handle, CURLOPT_HTTPHEADER, $headers); 
```

# asp-classic - 是否可以在 asp-classic 中发布动态包含？

> ID：479492
> 
> 赞同：8
> 
> 时间：2009-01-26T11:38:46.763
> 
> 标签：asp-classic, include, template-engine

我的意思是，像 php'h 包括...

就像是

```
my_file_to_be_included = "include_me.asp"

-->

```

就我目前所见，有几种选择，但每一种都有一些缺点......

我想弄清楚的是如何制作一个灵活的模板系统......而不必将整个东西静态地包含在一个带有loooooong case语句的文件中......

这里有几个链接

[使用 FileSysmemObject 的解决方案，只允许您包含静态页面](http://www.asp101.com/articles/michael/dynamicincludes/default.asp)

[同上](http://www.motobit.com/tips/detpg_DynInc/)

[还有一个](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?lngWId=4&txtCodeId=6391)

[adobe 中的相同内容](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_15180)

[这种方法使用 Server.Execute](http://www.4guysfromrolla.com/webtech/080199-1.3.shtml)

但它有一些我想避免的缺点......似乎（还没有尝试过）Server.Execute 代码在另一个上下文中运行，所以你不能用它来加载你计划在来电代码...讨厌...

[一样](http://www.aspin.com/func/content?tree=aspin/tutorial/scriptin/serversi&id=5551910)

[我觉得这个是一样的](http://www.4guysfromrolla.com/webtech/022504-1.shtml)

[这看起来很有希望！](http://www.codeproject.com/KB/asp/ASP_Dynamic_Include.aspx)

我不确定（还不能测试它），但似乎这个 dinamycally 将页面处理到一个 SSDI 组件......

任何想法？？？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T11:55:21.237

不，您不能进行动态包含，期间。

你最好的方法是 server.execute 并通过 Session 变量传递它需要的任何状态：-

```
Session("callParams") = BuildMyParams() 'Creates some sort of string
Server.Execute(my_file_to_be_included)
Session.Contents.Remove("callParams") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-19T17:25:20.573

改进版（v2.0）：

```
<%
' **** Dynamic ASP include v.2.0

function fixInclude(content)
   out=""   
   if instr(content,"#include ")>0 then
        response.write "Error: include directive not permitted!"
        response.end
   end if     
   content=replace(content,"<"&"%=","<"&"%response.write ")   
   pos1=instr(content,"<%")
   pos2=instr(content,"%"& ">")
   if pos1>0 then
      before= mid(content,1,pos1-1)
      before=replace(before,"""","""""")
      before=replace(before,vbcrlf,""""&vbcrlf&"response.write vbcrlf&""")
      before=vbcrlf & "response.write """ & before & """" &vbcrlf
      middle= mid(content,pos1+2,(pos2-pos1-2))
      after=mid(content,pos2+2,len(content))
      out=before & middle & fixInclude(after)
   else
      content=replace(content,"""","""""")
      content=replace(content,vbcrlf,""""&vbcrlf&"response.write vbcrlf&""")
      out=vbcrlf & "response.write """ & content &""""
   end if
   fixInclude=out
end function

Function getMappedFileAsString(byVal strFilename)
  Dim fso,td
  Set fso = Server.CreateObject("Scripting.FilesystemObject")
  Set ts = fso.OpenTextFile(Server.MapPath(strFilename), 1)
  getMappedFileAsString = ts.ReadAll
  ts.close  
  Set ts = nothing
  Set fso = Nothing
End Function

execute (fixInclude(getMappedFileAsString("included.asp")))
%> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T19:38:50.440

当然你可以做[真正的经典 asp 动态包含](http://www.aspmessageboard.com/showthread.php?t=229532&highlight=dynamic+includes "真正的经典asp动态包括")。我前段时间写了这篇文章，它以一种全新的方式为我打开了 Classic ASP。它会完全按照您的要求做，即使人们似乎认为这是不可能的！

有什么问题就告诉我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T11:57:31.747

我对经典的 ASP 有点生疏，但我很确定您可以使用该`Server.Execute`方法读取另一个 asp 页面，然后继续执行调用页面。15Seconds 有一些关于它的[基本](http://www.15seconds.com/Issue/010220.htm)知识 - 它让我回到了......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-07T18:22:29.980

就像一个附加说明。我在使用动态包含的页面顶部收到了奇怪的 ASCII 字符，所以我发现使用 ADODB.Stream 对象来读取包含文件消除了这个问题。

所以我更新的 getMappedFileAsString 函数代码如下

```
Function getMappedFileAsString(byVal strFilename)
  Dim fso
  Set fso = CreateObject("ADODB.Stream")

  fso.CharSet = "utf-8"
  fso.Open
  fso.LoadFromFile(Server.MapPath(strFilename))

  getMappedFileAsString = fso.ReadText()

  'Response.write(getMappedFileAsString)
  'Response.End

  Set fso = Nothing
End Function 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-18T23:41:31.437

我正在建立一个网站，可以方便地使用动态包含。该站点全是 ajax（根本不重新加载页面），虽然纯数据 JSON 返回调用不需要它，但每个不同应用程序子部分（窗口/窗格/区域/表单等）的所有不同 html 内容在我看来最好是在不同的文件中。

我最初的想法是让 ajax 调用回到“中央集线器”主文件（首先启动应用程序），然后它会知道要包含哪个子文件。在我意识到每次调用一些可能很小的部分都必须解析整个站点的所有 ASP 代码之后，简单地包含所有文件是行不通的！并且使用 Execute 方法在速度和维护方面都不好。

我通过将假定的“子”页面设置为主页面并在每个页面中包含“中央集线器”文件来解决了这个问题。基本上，它是一个 javascript 往返包含。

这比看起来的成本要低，因为网页的整个想法是服务器始终响应客户端对“下一页”的请求。被请求的内容在范围内由被调用的页面定义。

唯一的缺点是应用程序的“web 片段”必须部分分开：它们的大部分内容都在一个真正的命名 .asp 文件中，但它们的结构和关系在主 .asp 文件中定义的足够多（所以例如，一个 web 片段中的菜单项知道用于调用或加载另一个 web 片段的名称以及应该如何进行加载）。不过，在某种程度上，这仍然比传统网站的优势，因为传统网站的每个页面都必须知道如何加载其他页面。*现在，我可以做一些事情，比如“以它想要*的方式加载这部分（无论是整个页面还是其他页面）”。

我还对其进行了设置，因此每个部分都可以拥有自己的 javascript 和 css（如果只有该部分需要这些东西）。然后，这些文件仅在第一次加载该部分时通过 javascript 动态包含。然后，如果零件被重复加载，它不会产生额外的开销。

# java - 泄漏抽象定律的例外

> ID：479493
> 
> 赞同：1
> 
> 时间：2009-01-26T11:39:35.263
> 
> 标签：java, abstraction

我与一位友好的程序员发生了争执，他受到了 Joel 的[泄漏抽象定律的](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)轻微损害。很难说服他使用任何新的框架/工具箱。我试图提出一个观点，即“只要允许对抽象级别的低级访问，抽象就可以了”。

例子：

*   GWT - Google 出色的 Java 到 Javascript 编译器，具有 JSNI - 如果你真的愿意，可以编写“本机”Javascript。
*   Hibernate - AFAIK 有 SQLQuery - 编写本机 SQL 的方式。
*   Java - JNI - 如果你想念 C。

好听吗？我错过了什么吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T11:45:56.780

我从阅读泄漏抽象文章中得到的并不是抽象是不好的，而是您应该重点了解幕后发生的事情，以便您可以解释“意外”行为并避免它们。

你朋友的程序是什么？机器语言？:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T11:53:35.157

Joel 的观点（据我所知）是，通过抽象复杂性，您牺牲了对潜在复杂性的更好控制。除了微不足道的情况外，您最终将需要访问更精细的控制粒度，此时抽象会崩溃。

因此，根据定义，所有抽象（几乎）都是泄漏的：

*   如果系统中存在复杂性，那么它的存在一定是有原因的（或者你应该找到一种方法来消除它），因此它有时会很有用/很重要。
*   通过抽象，你限制了你对底层复杂性的控制。
*   当那些“偶尔”出现时，您将不得不打破抽象。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T12:05:57.520

To some extent he has a point. Traditional c/unix development works to a platform that is simple enough to be able to understand more-or-less in its entirety. Modern platforms are orders of magnitude more complex, and understanding how all of the layers interact is much harder, often infeasible.

The law of leaky abstractions mainly applies when the framework does a bad job of managing the underlying complexity. Some of the ways in which a framework may be judged are its transparency (ease of understanding what's going on behind the scenes) and its ability to drop out to a custom workaround for limitations in its functionality.

When a framework does a lot of complex magic behind the scenes, diagnosing and troubleshooting become much harder, often requiring a disproportionately large amount of expertise in the underlying architecture of the framework. This means that productivity gains from the framework get absorbed in the extra effort of training and debugging the code. It also makes the framework difficult to learn and use with confidence, which is what your C programming friend is used to.

When a framework obstructs you from working around its limitations, then it becomes an impediment to development. When this happens often enough, the code base is either boxed in or becomes polluted with ever greater and messier hacks to work around the issues. This also leads to stability and debugging problems,

Examples of frameworks with these flaws abound. MFC was quite famous for failing to hide the underlying complexity of Win32\. It also made extensive use of wizards that generated messy code that needed to be manually modified aftwrwards, defeating the purpose of having a code generator in the first place. Early Java GUI toolkits (AWT and early versions of Swing) have very little uptake in desktop applications because they obstructed developeers from implementing a native look-and-feel for the applications. SWT was built in no small part because of these limitations with Swing.

However, now Java has matured a bit, it could be argued that most of its early sins have been fixed in modern frameworks. J2EE is still a large, complex system, and developing a non-triviall user interface in a browser is also quite a substantial undertaking. Becoming proficient in this platform is quite a lot of work. However, it's not beyond the wit of man.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T11:52:42.227

虽然我认为每个抽象都是有漏洞的，但这并不一定是坏事。

例如，在传统的纯 C（C#、Java 等）代码中，您通常使用循环、ifs 等从数组中检索数据。但这样您就过度指定了问题的解决方案。

SQL、Linq 处理相同问题的方式更加智能：你只要说出你想要的，机器就会计算出如何去做。这样，它就没有传统方式的任何特定命令排序，并且可以将工作拆分到不同的 cpu 上，或者重新排序以更好地利用缓存等。

所以是的，你给了机器一些控制权，但是机器比你有一个很大的优势：它在用户/客户的位置，这样可以做出按需决策（比如使用多核，利用 MMX 的优势，无论如何）。

# c++ - Visual Studio 2005 VB 调试与 c++ dll - 混合语言调试

> ID：479495
> 
> 赞同：1
> 
> 时间：2009-01-26T11:40:23.967
> 
> 标签：c++, debugging, visual-studio-2005, mixed

我有一个调用 dll 中的函数的 vb 项目。该dll是在一个单独的vs项目（portaudio）中创建的，它是用c编写的。

dll c项目编译干净并构建所需的dll，我目前将其放入c:\windows\system到vb运行时可以看到它。

VB 项目位于 c:\devprojects\vbtest

C 项目位于 c:\devprojects\portaudio，项目文件位于 c:\devprojects\portaudio\build\msvc。在此 msvc 目录下的 Win32\debug 中创建的 Dll。

当我调用dll函数时，vs调试器是否可以单步调试dll中的c函数-我有所有代码等，但我不知道VS2005是否支持这种混合语言调试。

如果这是可能的，您能否建议我应该如何设置我的 Visual Studio 来实现这一点。

非常感谢大卫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T15:19:36.940

不必将两个项目都放在同一个解决方案中，但您应该在启用调试符号的情况下编译这两个项目。

现在在您的 VB 网络解决方案项目/属性中，在“调试”选项卡中确保选中“启用非托管代码调试”。

还要确保加载的 dll 与编译它的位置相同，否则它可能找不到存储调试符号的 pdb。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T11:55:27.493

使用两个项目创建一个解决方案，使用“添加引用..”对话框 -> 项目将 VB 项目中的引用添加到 C 项目，并在调试模式下构建它们。

你如何从VB调用C dll？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:56:56.363

如果它是 VB.NET，那么这很容易，只需设置一个包含两个项目的解决方案，设置它们的依赖项并确保在构建 VB 项目的调试版本时链接到从 C++ 项目生成的调试 lib/dll . Visual Studio 完成其余的工作。

我之前已经用 C# 应用程序调用 C++ dll 做过几次。我不打算设置它，但尝试在调试时单步执行，假设我会得到程序集列表并且至少可以解决我的代码出了什么问题......但是它加载了正确的 .cpp 文件和允许我继续单步执行该代码。

# .net - 如何快速学习 CSLA.NET？

> ID：479497
> 
> 赞同：6
> 
> 时间：2009-01-26T11:40:50.847
> 
> 标签：.net, csla

我想快速学习 CSLA.NET。你有什么建议？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-06-08T13:18:26.547

我建议下载 CSLA 源代码和示例（尤其是 ProjectTracker 示例）并查看代码。对我来说快速学习东西的最好方法是构建一些东西。

要开始编写对象，首先要创建数据门户基础设施。

例如，这是一个基本 CSLA 对象：

```
[Serializable()]
public class Widget : Csla.BusinessBase<Widget>
{
    private Widget()
    {
    }
} 
```

创建数据门户的下一步是确定获取在您的对象上的样子。例如，您是否想要根据他们的 id、他们的名字、他们的类别或其他一些属性来获取一个对象。这是实现了 fetch 工厂方法的同一对象的示例：

```
[Serializable()]
public class Widget : Csla.BusinessBase<Widget>
{
    private Widget()
    {
    }

    public static Widget Fetch(int id)
    {
        return Csla.DataPortal.Fetch<Widget>(new Csla.SingleCriteria<Widget, int>(id));
    }
} 
```

下一步是创建 CSLA 数据门户将创建的数据门户方法。

```
[Serializable()]
public class Widget : Csla.BusinessBase<Widget>
{
    private Widget()
    {
    }

    public static Widget Fetch(int id)
    {
        return Csla.DataPortal.Fetch<Widget>(new Csla.SingleCriteria<Widget, int>(id));
    }

    private void DataPortal_Fetch(Csla.SingleCriteria<Widget, int> criteria)
    {
        // Connect to database (or use ORM) and populate the object here based on the criteria.Value which is the id value
    }
} 
```

完成后，下一步是使用属性等定义您的业务对象。您将在此处查看提供的示例并查看如何定义父/子关系等。

希望这可以帮助您入门。

[您可以在http://lhotka.net/cslanet/Download.aspx](http://lhotka.net/cslanet/Download.aspx)下载代码和示例

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-26T11:54:00.070

这个问题的答案完全取决于你对“学习”和“快速”这两个词的定义。根据我的经验，没有人能快速学习*任何东西*。

话虽如此，我建议您访问 Rockford Lhotka 的网站并查看那里的论坛和书籍。

[http://www.lhotka.net/cslanet/](http://www.lhotka.net/cslanet/)
[http://forums.lhotka.net/](http://forums.lhotka.net/)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-26T11:54:05.967

**[拿到书](http://store.lhotka.net/ "CSLA.Net商店")。读了这本书。开始使用框架：o/**

我已经在 CSLA.Net 工作了 4 年，我仍然每周都在学习新的技巧和功能 :o)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-01T17:19:33.843

我强烈建议您查看我们的[CSLA 3.8 模板](http://code.google.com/p/codesmith/downloads/list)。它们有 VB.NET 和 C# 两种风格。我们目前正在开发一个添加 SQL 存储过程、对象工厂和多对多支持的主要版本。这是一个很好的起点，因为我们有真实世界的示例，例如完全生成的 Microsoft PetShop 示例应用程序（包括业务层和数据访问层），并带有单元测试，可以准确地向您展示 CSLA 的工作原理。如果您有任何疑问或遇到问题，我们将帮助您了解并成长为 CSLA 开发人员。

学习 CSLA 的另一个重要补充是购买以下书籍：[Expert C# 2008 Business Objects](https://rads.stackoverflow.com/amzn/click/com/1430210192)。

谢谢 -Blake Niemyjski（[CodeSmith CSLA 模板](http://www.codesmithtools.com/generate-csla-code-with-templates.aspx)的作者）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T11:53:18.760

我建议您阅读Rockford 的[这本书](http://www.apress.com/book/view/9781430210191)，以开始了解框架背后的基本原理以及所有内容如何组合在一起

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-15T00:28:56.620

Magenic（Rocky 的公司）全年提供多门 CSLA 大师班，这些课程非常棒，将为您带来沉浸式体验。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-15T00:40:41.930

我最好的建议是不要。有许多数据访问架构更健壮、更易于维护、性能更好，并且在行业中更被广泛接受。NHibernate、Linq-to-Sql 和 Microsoft Entity Framework 是三个。与行业同行。不要成为独行侠。

# javascript - Caja 准备好投入生产了吗？

> ID：479499
> 
> 赞同：5
> 
> 时间：2009-01-26T11:41:01.687
> 
> 标签：javascript, security

我们正在寻找一种方法来保护我们网页中的第三方代码。有人建议我们使用[Caja](http://code.google.com/p/google-caja/)。我对此进行了调查，但有关它的信息非常稀少。在深入研究之前，我首先想知道：

1.  Caja 能否像 Google Map 那样处理嵌入式 HTML，它有效地充当引导程序，并在浏览器运行时加载所有活动的 HTML 和 JavaScript？

2.  Caja 是否足够成熟，可以在生产环境中使用，还是仍处于概念阶段？

谢谢，伊兰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T11:47:53.110

你应该看看他们的[问题列表](http://code.google.com/p/google-caja/issues/list)。从某种意义上说，这份名单看起来很健康，而且很活跃，所以这是赞成的。但是你应该看看这些问题是否适用于你的需求，如果没有，那么你可能很好，如果答案是肯定的，你需要决定你是否愿意等待，或者贡献，或者更好地寻找新鲜玩意。

个人觉得还可以，但不知道你想走多远

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-30T17:42:58.170

Caja 正被包括 Yahoo Applications Portal 在内的许多项目积极用于生产。

来自[http://developer.yahoo.com/yap/guide/caja-support.html](http://developer.yahoo.com/yap/guide/caja-support.html)

> 然后，诱骗脚本在浏览器中创建的安全沙箱中运行。这提供了一种在任何网页上安全地包含任意第三方内容的方法。
> 
> 原则上，Caja 应该是透明的。大多数 JavaScript 的行为都是一样的，无论是直接运行还是被哄骗。但是，由于 Caja 目前正在发展且不完整，因此存在一些明显的差异。

# wpf - 适用于 WPF 和 Windows 窗体的图像表示

> ID：479501
> 
> 赞同：0
> 
> 时间：2009-01-26T11:41:34.527
> 
> 标签：wpf, winforms, image-processing, drawing, system.drawing

在处理 Windows 窗体和图像时，我处理 System.Drawing.Image 的后代。当我使用 WPF 时，我处理 System.Windows.Media.Imaging.BitmapSource 类。

是否有独立于 UI 框架的方式来引用内存图像？也许它会是一个 Intptr 或字节数组？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T11:43:49.980

您应该能够让它们都与指向字节数组的 MemoryStream 一起工作（无论如何对我来说都有意义！）

还没有尝试过 WinForms 方式，但您当然可以使用 WPF 做到这一点。

# winforms - 在 wpf 应用程序中更改托管 winForms 元素的可见性

> ID：479512
> 
> 赞同：0
> 
> 时间：2009-01-26T11:44:45.237
> 
> 标签：winforms, element, visibility, hosted

我有 ReportViewer winForms 控件，用于在通过 WindowsFormsIntegration 托管的 WPF 应用程序中显示 Microsoft Reports。当我的 textBlock 的 MouseDown 事件触发时，我希望它淡出让我们说从 0 到 100 的可见性，就像我的窗口中的其他一些元素一样。它没有，所以我想知道所有托管控件或这个特定控件是否相同，如何解决？

问候，

伊万

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T13:00:02.230

WindowsFormsHost 支持透明度。但有些 WinForms 控件没有。

请参阅MSDN 上[的 Windows Presentation Foundation 和 Windows 窗体互操作中支持的方案一文。](http://msdn.microsoft.com/en-us/library/ms751797.aspx)尤其是“行为”表的第一行：

> 某些 Windows 窗体控件不支持透明度。例如，当由 WPF 托管时，TextBox 和 ComboBox 控件将不是透明的。

# java - Java 中 TCP 套接字编程的好介绍？

> ID：479514
> 
> 赞同：5
> 
> 时间：2009-01-26T11:45:20.057
> 
> 标签：java, sockets

我正在寻找一个关于 Java 中 TCP 套接字编程的好教程。

这里的重点是好，我经常发现，当我查找这种指南时，我发现一半才意识到编写指南的人不知道他们在说什么，或者无法表达他们所知道的以有利于知识转移的方式。

要么有 12 页的“什么是套接字”，而这里的一页是一些使用套接字的代码。

或者，如果某人想写出代码片段以通过 TCP 套接字发送文本并在也可以工作的端口上等待消息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T11:51:01.153

这有帮助吗？[http://java.sun.com/docs/books/tutorial/networking/sockets/](http://java.sun.com/docs/books/tutorial/networking/sockets/)。这是 sun 自己的套接字教程。它有一个“什么是套接字”部分，一个“写入/读取套接字”部分，最后是一个“读/写对”简单示例，正如您所询问的那样。

华夫饼：代码比率似乎相当不错。

# java - JFrame最大化窗口

> ID：479523
> 
> 赞同：94
> 
> 时间：2009-01-26T11:48:02.017
> 
> 标签：java, swing, maximize-window

我正在使用摇摆组合一个快速而肮脏的动画。我希望窗口最大化。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-01-26T11:58:46.287

假设您正在扩展 JFrame：

```
public void run() {
    MyFrame myFrame = new MyFrame();
    myFrame.setVisible(true);
    myFrame.setExtendedState(myFrame.getExtendedState() | JFrame.MAXIMIZED_BOTH);
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-26T11:54:39.693

就像是`this.setExtendedState(this.getExtendedState() | this.MAXIMIZED_BOTH);`

```
import java.awt.*;
import javax.swing.*;

public class Test extends JFrame
{
    public Test()
    {
        GraphicsEnvironment env =
GraphicsEnvironment.getLocalGraphicsEnvironment();
        this.setMaximizedBounds(env.getMaximumWindowBounds());
        this.setExtendedState(this.getExtendedState() | this.MAXIMIZED_BOTH);
    }

    public static void main(String[] args)
    {
        JFrame.setDefaultLookAndFeelDecorated(true);

        Test t = new Test();
        t.setVisible(true);
    }
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-26T11:54:03.580

如果你使用的是 JFrame，试试这个

```
JFrame frame = new JFrame();
//...
frame.setExtendedState(JFrame.MAXIMIZED_BOTH); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-26T11:54:04.267

怎么样[`JFrame.setExtendedState(JFrame.MAXIMIZED_BOTH)`](http://java.sun.com/javase/6/docs/api/java/awt/Frame.html#setExtendedState(int))？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T11:56:07.507

设置JFrame全屏的方法是设置[`MAXIMIZED_BOTH`](https://docs.oracle.com/javase/7/docs/api/java/awt/Frame.html#MAXIMIZED_BOTH)代表的选项`MAXIMIZED_VERT | MAXIMIZED_HORIZ`，分别设置frame垂直最大化和水平最大化

```
package Example;
import java.awt.GraphicsConfiguration;
import javax.swing.JFrame;
import javax.swing.JButton;

public class JFrameExample
{
    static JFrame frame;
    static GraphicsConfiguration gc;
    public static void main(String[] args)
    {
        frame = new JFrame(gc);
        frame.setTitle("Full Screen Example");
        frame.setExtendedState(MAXIMIZED_BOTH);

        JButton button = new JButton("exit");
        b.addActionListener(new ActionListener(){@Override
        public void actionPerformed(ActionEvent arg0){
            JFrameExample.frame.dispose();
            System.exit(0);
        }});

        frame.add(button);
        frame.setVisible(true);
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-02T11:52:58.930

我喜欢这个版本：

```
import java.awt.Dimension;
import java.awt.GraphicsConfiguration;
import java.awt.Toolkit;
import javax.swing.JFrame;

public class Test
{
    public static void main(String [] args)
    {
        final JFrame frame = new JFrame();
        final GraphicsConfiguration config = frame.getGraphicsConfiguration();

        final int left = Toolkit.getDefaultToolkit().getScreenInsets(config).left;
        final int right = Toolkit.getDefaultToolkit().getScreenInsets(config).right;
        final int top = Toolkit.getDefaultToolkit().getScreenInsets(config).top;
        final int bottom = Toolkit.getDefaultToolkit().getScreenInsets(config).bottom;

        final Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        final int width = screenSize.width - left - right;
        final int height = screenSize.height - top - bottom;

        frame.setResizable(false);
        frame.setSize(width,height);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);       
        frame.setVisible(true);
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-04-09T12:02:05.770

我已经尝试了这个线程和[这里](https://stackoverflow.com/q/5258207/243373)的解决方案，但只是在调用`setExtendedState(getExtendedState()|Frame.MAXIMIZED_BOTH);`后立即调用`setVisible(true);`显然不适用于我的环境（Windows 10、JDK 1.8，我的任务栏位于屏幕右侧）。这样做仍然会在左侧、右侧和底部留下一个很小的空间。

然而，对我有用的是`setExtendedState(...`在激活窗口时调用，如下所示：

```
public class SomeFrame extends JFrame {

    public SomeFrame() {
        // ...
        setVisible(true);
        setResizable(true);
        // if you are calling setSize() for fallback size, do that here
        addWindowListener (
            new WindowAdapter() {
                private boolean shown = false;
                @Override
                public void windowActivated(WindowEvent we) {
                    if(shown) return;
                    shown = true;
                    setExtendedState(getExtendedState()|JFrame.MAXIMIZED_BOTH);
                }
            }
        );
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-23T11:35:34.190

我最终使用了这段代码：

```
public void setMaximized(boolean maximized){
    if(maximized){
        DisplayMode mode = this.getGraphicsConfiguration().getDevice().getDisplayMode();
        Insets insets = Toolkit.getDefaultToolkit().getScreenInsets(this.getGraphicsConfiguration());
        this.setMaximizedBounds(new Rectangle(
                mode.getWidth() - insets.right - insets.left, 
                mode.getHeight() - insets.top - insets.bottom
        ));
        this.setExtendedState(this.getExtendedState() | JFrame.MAXIMIZED_BOTH);
    }else{
        this.setExtendedState(JFrame.NORMAL);
    }
} 
```

此选项是所有选项中效果最好的，包括多显示器支持。唯一的缺陷是在所有显示器上都使用任务栏偏移量是一些配置。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-09T01:38:41.800

@kgiannakakis 的回答是完全正确的，但如果有人遇到这个问题并在**Linux上使用****Java 6**（例如 Mint 19 Cinnamon），有时不会应用*MAXIMIZED_BOTH状态。*

 ***您可以在设置此状态后尝试调用[pack()方法。](https://docs.oracle.com/javase/6/docs/api/java/awt/Window.html#pack())

代码示例：

```
public MainFrame() {
    setContentPane(contentPanel); //some JPanel is here
    setPreferredSize(new Dimension(1200, 800));
    setMinimumSize(new Dimension(1200, 800));
    setSize(new Dimension(1200, 800));
    setExtendedState(JFrame.MAXIMIZED_BOTH);
    pack();
} 
```

如果您在 Windows 上使用 Java 7+ 或 Java 6，则不需要这样做。

# java - 如果导航到目录，如何让树脂默认为 index.html 提供服务？（相当于 Apache 中的 DirectoryIndex）

> ID：479530
> 
> 赞同：1
> 
> 时间：2009-01-26T11:51:43.977
> 
> 标签：java, resin

是否可以将[Resin](http://caucho.com/resin/)配置为提供静态文件，以便导航到例如[http://localhost:8888/foo/bar/](http://localhost:8888/foo/bar/)将提供文件 foo/bar/index.html（不执行重定向）？我在 Resin 文档中找不到答案，尽管我可能找错了地方。

Apache 中的等价物是 DirectoryIndex 指令。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T12:31:47.340

也许我不明白这个问题，但[welcome-file-list](http://caucho.com/resin/doc/webapp-tags.xtp#welcome-file-list)似乎就是这样做的？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T12:33:03.750

看起来欢迎文件列表标签用于指定这一点。见[http://caucho.com/resin/doc/webapp-tags.xtp#welcome-file-list](http://caucho.com/resin/doc/webapp-tags.xtp#welcome-file-list)

# objective-c - 如何声明仅调试语句

> ID：479531
> 
> 赞同：40
> 
> 时间：2009-01-26T11:51:46.940
> 
> 标签：objective-c, xcode

在 C# 中，我可以使用以下代码来生成仅在调试构建期间执行的代码，我如何在 Xcode 中执行相同的操作？

```
#if DEBUG
{
    // etc etc
}
#endif 
```

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-01-26T11:59:23.100

您可以使用

```
#ifdef DEBUG
    ....
#endif 
```

您需要`DEBUG=1`在调试配置的设置中添加项目的预处理器符号定义，因为 Xcode 不会自动为您完成。

我个人更喜欢`DEBUG=1`检查`NDEBUG=0`，因为后者意味着默认构建配置包含调试信息，然后您必须显式关闭这些信息，而“DEBUG=1”意味着*打开*仅调试代码。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-01-26T12:01:34.563

NDEBUG 符号应该已经在发布模式构建中为您定义

```
#ifndef NDEBUG
/* Debug only code */    
#endif 
```

通过使用 NDEBUG，您不必为调试构建自己指定 -D DEBUG 参数给编译器

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-02-19T07:07:36.963

DEBUG 现在默认在 Project/Preprocessor Macros 下定义为“调试模式”。所以测试它总是有效的，除非你有一个非常老的项目。

但是我讨厌它弄乱了代码缩进并且不是特别紧凑的事实。这就是为什么我使用另一个让生活更轻松的宏。

```
#ifdef DEBUG
#define DEBUGMODE YES
#else
#define DEBUGMODE NO
#endif 
```

所以测试 DEBUGMODE 值要紧凑得多：

```
if (DEBUGMODE) {
//do this
} else {
//do that
} 
```

我的最爱：

```
NSTimeInterval updateInterval = DEBUGMODE?60:3600; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-26T12:10:28.587

有一个非常有用的调试技术说明：Technical Note TN2124 Mac OS X Debugging Magic [http://developer.apple.com/technotes/tn2004/tn2124.html#SECENV](http://developer.apple.com/technotes/tn2004/tn2124.html#SECENV)，其中包含许多对调试应用程序有用的东西。

托尼

# .net - 如何将 DataTable 转换为 IDatareader？

> ID：479532
> 
> 赞同：13
> 
> 时间：2009-01-26T11:51:57.703
> 
> 标签：.net, ado.net, datatable, idatareader

我们都知道 DataReader 比 DataTables 更快，因为 DataReader 用于构建 DataTable。

因此，鉴于我已经有一个 DataTable....**为什么要将其转换为 DataReader？**

好吧，我正在创建一个名为 IDataProvider 的内部接口。此接口旨在在本地和作为 WebService 实现。该接口将有一个方法“Getdata”，它接受一些标准信息并返回一些数据。

由于 DataReader 是最快的数据检索机制，因此我希望将其用作“GetData”方法的结果类型。但是，我们也知道 DataReader 不可序列化，因此无法通过 Web 服务在 Web 上传输...

在网络的情况下，我会让本地代理类将数据请求为 DataTable，然后在本地将其转换为 DataReader。

通过这种方式，本地应用程序不需要知道（或关心）它是在本地还是远程访问数据。

但是，为了做到这一点，我需要知道...**如何将 DataReader 包装在预先存在的 DataTable 周围？**

更新：我的业务逻辑不会保留在 Web 服务中，因为使用 Web 服务的 DataProvider 可以切换为不使用的。因此，businessLogic 将保存在客户端应用程序中。

FWIW我正在使用.Net 3.5 SP1

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-27T16:23:36.873

只需在 DataTable 上调用 CreateDataReader

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T12:40:10.617

DataReader 是读取数据存储的最快方法，但前提是满足某些条件：

1.  数据将以只进方式读取。
2.  数据是只读的。

即使您的方案满足这些条件，DataReader 也代表一个 Connected Datastore，这意味着您需要在 DataReader 通过网络传递的整个过程中保持连接打开，直到另一端调用的方法返回一些种回应。

因此，我认为永远不应该通过各种层和应用程序传递活动的 DataReader。我宁愿先将数据提取到另一个数据存储或集合中，然后立即处理 DataReader。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T12:35:06.633

没有现有的课程可以为您执行此操作。但是编写一个实现 IDataReader 并且是现有 DataTable 的包装器的可序列化类对您来说应该不难。

编辑：您可能会发现从 DbDataReader 继承更容易（我认为，请在对象资源管理器中检查 SqlDataReader 的基类）。它为您提供了一些界面实现。但是，是的，它仍然是很多枯燥的代码。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-26T11:59:36.330

你不能。DataReader 和 DataTable 是两个不同的东西。

由于 DataReader 使您能够以流的形式读取数据，因此我真的不明白您为什么要在客户端执行此操作。

DataReader 通常用于从数据库中读取数据并添加逻辑以填充对象列表或 DataTable。因此，最好执行与在 Web 服务上构建 DataTable 有关的大多数业务逻辑，将其作为 Web 服务传递给客户端，并与那里的其他 ADO.Net 功能一起使用以获得更多业务逻辑。

也许您可以更具体地说明您真正想要 DataReader 的原因？

# php - 您如何让客户使用他们的 Google 帐户登录您的网站？

> ID：479535
> 
> 赞同：21
> 
> 时间：2009-01-26T11:53:00.790
> 
> 标签：php, mysql, login, openid

我刚看到[http://uservoice.com/login](http://uservoice.com/login)。它使用 Google 帐户、[Myspace](http://en.wikipedia.org/wiki/Myspace)、Yahoo、[OpenID](http://en.wikipedia.org/wiki/OpenID)和所有帐户让客户登录其网站？我可以这样做吗？

我的意思是，客户不需要注册到我的网站。他们可以在上述网站上使用他们的帐户登录。

如果您有解决方案，我更喜欢基于 PHP 和 MySQL 的解决方案。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-26T11:59:25.660

请参阅此处：[Google 登录 PHP 类](http://www.andrewpeace.com/php-google-login-class.html)。

此外，请务必参阅[Google 联合登录站点](https://developers.google.com/accounts/docs/OpenID)以获取更多信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T11:56:42.997

您可能也想看看这个：[https](https://rpxnow.com/) ://rpxnow.com/ - 它只需要在 HTML/javascript 级别进行集成。

这是[http://uservoice.com/login](http://uservoice.com/login)似乎使用的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T19:10:41.983

您应该查看 OpenID 启用的 PHP 库 ( [http://www.openidenabled.com/php-openid/](http://www.openidenabled.com/php-openid/) )。

这应该可以很好地与任何 LAMP 安装一起使用，而无需使用 Zend。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T12:22:25.457

[Zend_OpenId](http://framework.zend.com/manual/en/zend.openid.html) from [Zend Framework](http://framework.zend.com/)

> Zend_OpenId is a Zend Framework component that provides a simple API for building OpenID-enabled sites and identity providers.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T11:55:55.887

[http://openidenabled.com/php-openid/](http://openidenabled.com/php-openid/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T16:51:18.817

Uservoice 用户 RPX [http://rpxnow.com](http://rpxnow.com)。您可以轻松地将它与 PHP 一起使用，只需 https 并解析 json 或 xml 响应。您甚至不需要更改数据库架构或在本地存储任何内容。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-02-13T12:04:13.387

我认为一步一步对你来说是一个很好的解决方案

1-下载[openid](http://gitorious.org/lightopenid/lightopenid/blobs/raw/master/openid.php)

2-像这样创建名为 login.php 的文件（在同一目录中或将 require_one 更改为您自己的）：

```
<?php
require_once 'openid.php';
$myopenid = new LightOpenID("your-domain.com");//no problem even if u can write http://localhost

if ($myopenid->mode) {
    if ($myopenid->mode == 'cancel') {
        echo "User has canceled authentication !";
    } elseif($myopenid->validate()) {
        $data = $myopenid->getAttributes();
        $email = $data['contact/email'];
        $first = $data['namePerson/first'];
        echo "Identity : $openid->identity <br>";
        echo "Email : $email <br>";
        echo "First name : $first";
    } else {
        echo "The user has not logged in";
    }
} else {
    echo "Go to index page to log in.";
}
?> 
```

3-next 是关于创建名为 index.php 的文件：

```
<?php
require_once 'openid.php';
$openid = new LightOpenID("your-domain.com");//no problem even if u can write http://localhost

$openid->identity = 'https://www.google.com/accounts/o8/id';
$openid->required = array(
  'namePerson/first',
  'namePerson/last',
  'contact/email',
);
$openid->returnUrl = 'your-domain.com/login.php'
?>

<a href="<?php echo $openid->authUrl() ?>">Login with Google</a> 
```

我差点忘了注销你可以终止会话；

# c# - 获取活动窗口文本（并向其发送更多文本）

> ID：479548
> 
> 赞同：13
> 
> 时间：2009-01-26T11:55:32.453
> 
> 标签：c#, winapi, pinvoke

我正在 C# 中创建一个小实用程序，当按下全局热键时，它将向活动文本框添加一些文本，这是一种自动完成功能。我有我的全局热键工作，但现在我不知道如何在活动文本框中获取当前文本（如果活动窗口是一个文本框。）到目前为止我尝试的是使用

一个。GetForegroundWindow，然后使用该句柄调用 GetWindowText。这给了我活动窗口的窗口标题，而不是文本框内容。

湾。GetActiveWindow 并使用该句柄调用 GetWindowText。这根本没有给我任何文字。

这是我所做的一个例子

```
[DllImport("user32.dll")]
private static extern bool UnregisterHotKey(IntPtr hWnd, int id);
[ DllImport("user32.dll") ]
static extern int GetForegroundWindow();
[ DllImport("user32.dll") ]
static extern int GetWindowText(int hWnd, StringBuilder text, int count);   
[DllImport("user32.dll")]
static extern int GetActiveWindow();

public static void TestA() {
    int h = GetForegroundWindow();
    StringBuilder b = new StringBuilder();
    GetWindowText(h, b, 256);
    MessageBox.Show(b.ToString());
}

public static void TestB() {
    int h = GetActiveWindow();
    StringBuilder b = new StringBuilder();
    GetWindowText(h, b, 256);
    MessageBox.Show(b.ToString());
} 
```

那么，关于如何实现这一目标的任何想法？

**编辑 28.01.2009：** 所以，我发现了如何做到这一点。这是我使用的：

```
using System;
using System.Text;
using System.Runtime.InteropServices;

public class Example
{
[DllImport("user32.dll")]
static extern int GetFocus();

[DllImport("user32.dll")]
static extern bool AttachThreadInput(uint idAttach, uint idAttachTo, bool fAttach);

[DllImport("kernel32.dll")]
static extern uint GetCurrentThreadId();

[DllImport("user32.dll")]
static extern uint GetWindowThreadProcessId(int hWnd, int ProcessId);    

[DllImport("user32.dll") ]
static extern int GetForegroundWindow();

[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = false)]
static extern int SendMessage(int hWnd, int Msg, int wParam, StringBuilder lParam); 

const int WM_SETTEXT = 12;
const int WM_GETTEXT = 13;

public static void Main() 
{
    //Wait 5 seconds to give us a chance to give focus to some edit window,
    //notepad for example
    System.Threading.Thread.Sleep(5000);
    StringBuilder builder = new StringBuilder(500);

    int foregroundWindowHandle = GetForegroundWindow();
    uint remoteThreadId = GetWindowThreadProcessId(foregroundWindowHandle, 0);
    uint currentThreadId = GetCurrentThreadId();

    //AttachTrheadInput is needed so we can get the handle of a focused window in another app
    AttachThreadInput(remoteThreadId, currentThreadId, true);
    //Get the handle of a focused window
    int  focused = GetFocus();
    //Now detach since we got the focused handle
    AttachThreadInput(remoteThreadId, currentThreadId, false);

    //Get the text from the active window into the stringbuilder
    SendMessage(focused, WM_GETTEXT, builder.Capacity, builder);
    Console.WriteLine("Text in active window was " + builder);
    builder.Append(" Extra text");
    //Change the text in the active window
    SendMessage(focused, WM_SETTEXT, 0, builder);
    Console.ReadKey();
    }
} 
```

关于这一点的一些注释。该示例在执行任何操作之前等待 5 秒，让您有机会将焦点放在某个编辑窗口上。在我的真实应用程序中，我使用热键来触发它，但这只会混淆这个例子。此外，在生产代码中，您应该检查 win32 调用的返回值以查看它们是否成功。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T12:27:33.607

It's reasonable to send keystrokes if you aware of active window and focused input field. See [http://www.pinvoke.net/default.aspx/user32/keybd_event.html](http://www.pinvoke.net/default.aspx/user32/keybd_event.html) for API.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T12:05:27.197

请检查，即使 em_replacesel 消息可能无法在不同的进程中工作，您可能需要使用 WM_COPYDATA 或调用 url 中给出的窗口过程，

[http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.smartphone.developer&tid=4e3a9289-9355-4af7-a5b9-84f1aa601441&cat=&lang=&cr=&sloc=en-美国&p=1](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.smartphone.developer&tid=4e3a9289-9355-4af7-a5b9-84f1aa601441&cat=&lang=&cr=&sloc=en-us&p=1)

# wpf - 如何在 WPF、Button 或 Border/Textarea 中制作带有圆角的可点击颜色区域？

> ID：479554
> 
> 赞同：0
> 
> 时间：2009-01-26T11:56:15.307
> 
> 标签：wpf, layout

我想要四个可点击的彩色区域。我可以在边框中使用 TextBlock 来获取颜色区域，但是它们都没有 Click 事件。所以我可以把整个东西变成一个按钮，但是它没有圆角，我似乎无法改变背景。

推荐的解决方法是什么，这是我到目前为止所拥有的：

```
<Window x:Class="WpfApplication6.Window7"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window7" Height="300" Width="300">
    <UniformGrid>
        <UniformGrid.Resources>
            <Style TargetType="{x:Type TextBlock}">
                <Setter Property="FontSize" Value="20"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
            </Style>
        </UniformGrid.Resources>
        <Button BorderThickness="1px" Margin="10" BorderBrush="Blue" CornerRadius="33" Background="Orange">testing1</Button>
        <Border BorderThickness="1px" Margin="10" BorderBrush="Blue" CornerRadius="10" Background="Yellow">
            <TextBlock>testing2</TextBlock>
        </Border>
        <Border BorderThickness="1px" Margin="10" BorderBrush="Blue" CornerRadius="10" Background="LightBlue">
            <TextBlock>testing3</TextBlock>
        </Border>
        <Border BorderThickness="1px" Margin="10" BorderBrush="Blue" CornerRadius="10" Background="LightGreen">
            <TextBlock>testing4</TextBlock>
        </Border>
    </UniformGrid>
</Window> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T12:17:17.107

您必须为您的按钮定义一个自定义模板

例如：

```
<UniformGrid>
  <UniformGrid.Resources>
    <ControlTemplate x:Key="buttonTemp">
      <Border Margin="10" CornerRadius="10" Background="Yellow">
        <TextBlock Text="{TemplateBinding Button.Content}"/>
      </Border>
    </ControlTemplate>
  </UniformGrid.Resources>
  <Button Template="{StaticResource buttonTemp}">testing1</Button>
</UniformGrid> 
```

另请参阅[http://mark-dot-net.blogspot.com/2007/07/creating-custom-wpf-button-template-in.html](http://mark-dot-net.blogspot.com/2007/07/creating-custom-wpf-button-template-in.html)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-26T14:52:37.293

我相信你也可以做这样的事情，虽然我没有尝试过。

```
<Border CornerRadius="5" ButtonBase.Click="ButtonClickHandler" /> 
```

# .net - 是否可以编辑列表视图列中的文本？

> ID：479557
> 
> 赞同：1
> 
> 时间：2009-01-26T11:57:08.643
> 
> 标签：.net, winforms

是否可以在报表视图的列表视图子项列中编辑文本？换句话说，集成一个组合框或一个文本框以方便输入

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-10T18:06:58.650

也许这可能是有趣的？

[http://www.codeproject.com/KB/list/extendedlistviews.aspx](http://www.codeproject.com/KB/list/extendedlistviews.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T12:01:24.487

为了允许这样做，您需要设置

```
yourListView.LabelEdit = true; 
```

这默认为，`false`因此您需要明确打开它以允许用户编辑标签。

# java - 为什么 Eclipse 使用本机启动器？

> ID：479558
> 
> 赞同：19
> 
> 时间：2009-01-26T11:57:29.580
> 
> 标签：java, eclipse, native

[Eclipse](http://www.eclipse.org) IDE 是用 Java 编写的大型桌面应用程序的最佳示例之一。

我见过的大多数 Java 应用程序通常依赖批处理或 shell 脚本来构建带有应用程序类路径的字符串，并使用类路径作为 env 变量启动 JVM。

另一方面，Eclipse 依赖于本机启动器。这是为什么 ？这个启动器做了哪些脚本没有做的事情？

我记得大约一年半前读过一篇文章，解释说“我们最好使用原生启动器”，但 id 没有解释启动器的内部工作原理。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-26T12:16:32.257

[Equinox 启动器](http://wiki.eclipse.org/index.php/Equinox_Launcher)使用 JNI在与启动器相同的进程中启动 Java VM。使用 JNI 还允许我们在启动屏幕中使用 SWT 小部件。

* * *

实际上，您仍然可以拥有一个脚本，因为启动器可执行文件 eclipse.exe 自 3.3M5 以来已被分成两部分：

*   可执行文件，以及
*   一个共享库（例如：eclipse_1006.dll）。

可执行文件位于 eclipse 安装的根目录中。
共享库位于`org.eclise.equinox.launcher.[config]`插件目录中的特定于平台的片段中。

将大部分启动器代码移动到位于片段中的共享库中意味着现在可以从更新站点更新该部分启动代码。此外，从 java 启动时，可以通过 JNI 加载共享库以显示启动画面。

正如这里所解释的，您可以在[没有本机启动器的情况下启动 Eclipse 3.3](http://eclipsenuggets.blogspot.com/2007/04/starting-eclipse-3.html)，

```
java -jar plugins/org.eclipse.equinox.launcher_1.0.0.v20070319.jar 
```

请注意，jar 文件的名称现在取决于版本，导致使用确切文件名调用 jar 的幼稚脚本在 jar 文件更新后中断。

相反，您可能想要查找与`org.eclipse.equinox_*.jar`. 值得庆幸的是，Eclipse-wiki 包含在这种情况下有用的[适当脚本模板。](http://wiki.eclipse.org/index.php/Starting_Eclipse_Commandline_With_Equinox_Launcher)
如果不想修改已有的脚本，也可以搜索Equinox Launcher插件，复制到Eclipse主目录，将复制的内容重命名为startup.jar。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-26T12:10:29.927

其中一些是特定于窗口的，一些是通用的。

1.  与目标平台的本机可用脚本语言中的批处理脚本相比，您的 shell 集成有了很大改进。

2.  无需启动额外的进程来执行脚本（如果您将 IDE 本身编写为构建/测试/部署周期的一部分，这可能很重要。

3.  可执行头文件通常定义程序的“位数”。因此，可执行文件可以明确指示它允许/禁止 32 位或 64 位执行。

4.  Windows 上的可执行文件可以进行加密签名。

5.  许多恶意软件/防火墙防护程序维护每个可执行的白名单。因此，在第一次启动 Eclipse（并且它会检查网络上的更新）时，它会更好地显示“Eclipse 正在尝试访问互联网”而不是通用的“javaw.exe”。试图访问互联网”。它还允许用户更精细地控制此行为。

6.  该进程将在 ps/task manager 上显示为“you_app_name”，而不是 java -jar “your jar file”。这使得跟踪/管理错误进程变得更加容易。在开发环境中并不少见。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-26T19:36:09.513

其他答案是高度技术性的，但在我看来，我认为其原因要简单得多：用户体验。

最终用户不必大惊小怪地让它工作。（是的，如果你想使用不同的虚拟机或将参数传递给虚拟机等，你可以大惊小怪，但你不必这样做）。

没有什么比安装一个程序更让用户讨厌的了，然后尝试运行它，只是得到一个 dos 框，上面写着“输入你的 java vm 的路径”，或者更糟糕的是，你双击它并没有任何反应，因为你有去编辑一个批处理文件以使其工作。

这是 2009 年，而不是 1996 年。没有用户（甚至开发人员！）不应该编辑批处理文件以使程序第一次运行。

# java - 如何在 Java 中定义一个常量类？

> ID：479565
> 
> 赞同：102
> 
> 时间：2009-01-26T12:00:09.543
> 
> 标签：java, class-constants

假设您需要定义一个类，它所做的只是保存常量。

```
public static final String SOME_CONST = "SOME_VALUE"; 
```

这样做的首选方法是什么？

1.  界面
2.  抽象类
3.  最后一堂课

我应该使用哪一个，为什么？

* * *

*澄清一些答案：*

**枚举**- 我不会使用枚举，我不会枚举任何东西，只是收集一些彼此不相关的常量。

**接口**- 我不会将任何类设置为实现接口的类。只想使用接口调用常量，如下所示：`ISomeInterface.SOME_CONST`.

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-01-26T12:06:51.403

使用最终课程。为简单起见，您可以使用静态导入在另一个类中重用您的值

```
public final class MyValues {
  public static final String VALUE1 = "foo";
  public static final String VALUE2 = "bar";
} 
```

在另一个班级：

```
import static MyValues.*
//...

if(variable.equals(VALUE1)){
//...
} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-01-26T12:28:20.377

您的澄清说明：“我不会使用枚举，我不会枚举任何东西，只是收集一些彼此不相关的常量。”

如果常量之间根本不相关，为什么要将它们收集在一起？将每个常量放在与其最密切相关的类中。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-04-07T17:14:49.760

我的建议（按优先顺序递减）：

1）**不要这样做**。在与它们最相关的实际类中创建常量。拥有一个“常量包”类/接口并没有真正遵循 OO 最佳实践。

我和其他所有人时常忽略#1。如果您要这样做，那么：

2)**带有私有构造函数的最终类**这至少可以防止任何人通过扩展/实现它以轻松访问常量来滥用您的“常量包”。（我知道你说过你不会这样做 - 但这并不意味着有人在你之后不会这样做）

3)**界面**这将起作用，但不是我的偏好，在#2 中可能会提到滥用。

一般来说，仅仅因为这些是常量并不意味着你不应该对它们应用正常的 oo 原则。如果只有一个类关心一个常量，那么它应该是私有的并且在那个类中。如果只有测试关心一​​个常量 - 它应该在测试类中，而不是生产代码中。如果在多个地方定义了一个常量（不仅仅是偶然地相同） - 重构以消除重复。等等 - 像对待方法一样对待它们。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-26T12:32:27.887

正如 Joshua Bloch 在 Effective Java 中所说：

*   接口只能用于定义类型，
*   抽象类不会阻止实例化（它们可以被子类化，甚至建议它们被设计为子类化）。

如果所有常量都相关（如行星名称），则可以使用 Enum，将常量值放在与它们相关的类中（如果您可以访问它们），或者使用不可实例化的实用程序类（定义私有默认构造函数） .

```
class SomeConstants
{
    // Prevents instanciation of myself and my subclasses
    private SomeConstants() {}

    public final static String TOTO = "toto";
    public final static Integer TEN = 10;
    //...
} 
```

然后，如前所述，您可以使用静态导入来使用您的常量。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-26T12:06:59.653

我的首选方法是根本不这样做。当 Java 5 引入类型安全枚举时，常量的时代几乎消失了。甚至在此之前，乔什·布洛赫（Josh Bloch）发布了一个（稍微冗长的）版本，该版本适用于 Java 1.4（及更早版本）。

除非您需要与某些遗留代码的互操作性，否则真的没有理由再使用命名的字符串/整数常量。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-26T12:03:23.017

只需使用最终课程。

如果您希望能够添加其他值，请使用抽象类。

使用接口没有多大意义，接口应该指定合同。您只想声明一些常量值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-26T12:06:07.363

[枚举](http://java.sun.com/j2se/1.5.0/docs/guide/language/enums.html)不是这类东西的最佳选择吗？

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-26T13:47:29.547

`enum`s很好。IIRC，有效Java（第2版）中的一项具有`enum`枚举标准选项的常量，这些选项`interface`为任何值实现[Java关键字]。

我的偏好是使用 [Java 关键字]`interface`而不是`final class`for 常量。你隐含地得到`public static final`. 有些人会争辩说，a`interface`允许糟糕的程序员实现它，但是无论你做什么，糟糕的程序员都会编写出糟糕的代码。

哪个更好看？

```
public final class SomeStuff {
     private SomeStuff() {
         throw new Error();
     }
     public static final String SOME_CONST = "Some value or another, I don't know.";
} 
```

或者：

```
public interface SomeStuff {
     String SOME_CONST = "Some value or another, I don't know.";
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-26T12:07:45.177

或者 4\. 将它们放在包含使用常量的逻辑最多的类中

...对不起，无法抗拒;-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-09T08:03:14.647

对我来说最好的方法是`enum`：

```
public enum SomeApiConstants {;

    public static final String SOME_CONST = "SOME_VALUE";

    //may be in hierarchy
    public enum ApiMapping {;
        public static final String VERSION = "/version";
        public static final String VERSION_LIST = "/list/{type}";
    }
} 
```

**优点：**

*   **干净的代码**
*   不需要定义私有构造函数
*   尝试实例化在编译时验证为`java: enum types may not be instantiated`
*   防止克隆和反序列化

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2015-09-11T06:34:42.077

1.  私有构造函数的缺点之一是方法的存在永远无法测试。

2.  枚举的性质概念很好地应用于特定的域类型，将其应用于分散的常量看起来不够好

Enum 的概念是“枚举是密切相关项的集合”。

3.  扩展/实现常量接口是一种不好的做法，很难考虑扩展不可变常量而不是直接引用它的要求。

4.  如果使用像 SonarSource 这样的质量工具，有规则迫使开发人员放弃常量接口，这是一件尴尬的事情，因为很多项目都喜欢常量接口，很少看到“扩展”的事情发生在常量接口上

# assembly - 如何使用 FASM 编译器在汇编语言中生成随机数？

> ID：479573
> 
> 赞同：3
> 
> 时间：2009-01-26T12:04:43.247
> 
> 标签：assembly, random, numbers, fasm

我对组装真的很陌生，我正在尝试创建一个简单的程序。为此，我需要生成一个随机数。

有人知道我如何使用 FASM 编译器做到这一点吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T12:17:39.790

You could use a Linear-Congruential Algorithm. Its the most common psuedo-random number algorithm.

Basically, you have a seed value. And then once you start generating random numbers each number becomes the seed for the new request.

The numbers are generated by

x = (a * s + b) MOD m

Where m, a and b are picked for the algorithm. There are some popular sets of these values used. Its a lot easier if you make m a power of 2, especially 2^32 for 32 bit machines. Then the mod step is done automatically by the machine.

Check out the wikipedia, they have popular sets of a, b and M and a lot more information.

There are more complicated things can be done with seeds as well (setting the seed based on the current time, for instance)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T13:13:09.693

我是 R250 的忠实粉丝，它的执行速度比 LCG 快得多。 [http://www.ddj.com/184408549?pgno=7](http://www.ddj.com/184408549?pgno=7)

显示我以前写回的旧汇编代码的速度显着提高。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T12:07:04.083

Take a look at [this Wikipedia page](http://en.wikipedia.org/wiki/List_of_pseudorandom_number_generators), pick an algorithm, and implement it.

Edit: Or you could take the easy route. Use your OS's C runtime and call their rand functions.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T13:24:20.747

> 随机数

这是一个有点模棱两可的问题。

到目前为止，大多数海报可能都是正确的；他们正在解释如何生成**伪**随机数，这可能就是您所需要的。使用当前时间播种算法（您必须向操作系统询问，或从时钟芯片中读取）。这将为您提供足以用于游戏和其他简单用途的“随机”数字。

但**请**不要将这些“随机数”用于任何安全应用程序（加密、密钥生成等）。对于安全应用程序，您需要一个非常好的**密码安全**随机数生成器。写其中一个真的很难。（Netscape[弄错了，](http://www.cs.berkeley.edu/~daw/papers/ddj-netscape.html)因此 Netscape Navigator 的早期版本有一个易于破解的 HTTPS 实现；Debian 最近[弄错了，](http://www.debian.org/security/2008/dsa-1571)导致大量易于破解的 SSH 和 HTTPS/SSL 密钥）。

# c# - 测试从 ComboBox 派生的自定义控件

> ID：479587
> 
> 赞同：2
> 
> 时间：2009-01-26T12:09:23.410
> 
> 标签：c#, .net, winforms, unit-testing, custom-controls

我创建了一个从 ComboBox 派生的控件，并希望对其行为进行单元测试。

但是，它在我的单元测试中的行为似乎与它在实际应用程序中的行为不同。

在实际应用程序中，Combobox.DataSource 属性和 .Items 同步 - 换句话说，当我更改 Combobox.DataSource 时，.Items 列表会立即自动更新以显示 DataSource 的每个元素的项目。

在我的测试中，我构造了一个 ComboBox，为其分配了一个数据源，但 .Items 列表根本没有更新，仍然是 0 个项目。因此，当我尝试在测试中将 .SelectedIndex 更新为 0 以选择第一项时，我收到 ArgumentOutOfRangeException。

这是因为我的单元测试中没有 Application.Run 开始一个事件循环，还是这有点像红鲱鱼？

编辑：第一次测试的更多细节：

```
 [SetUp]
    public void SetUp()
    {
        mECB = new EnhancedComboBox();

        mECB.FormattingEnabled = true;
        mECB.Location = new System.Drawing.Point( 45, 4 );
        mECB.Name = "cboFind";
        mECB.Size = new System.Drawing.Size( 121, 21 );
        mECB.TabIndex = 3;

        mECB.AddObserver( this );

        mTestItems = new List<TestItem>();
        mTestItems.Add( new TestItem() { Value = "Billy" } );
        mTestItems.Add( new TestItem() { Value = "Bob" } );
        mTestItems.Add( new TestItem() { Value = "Blues" } );

        mECB.DataSource = mTestItems;
        mECB.Reset();

        mObservedValue = null;
    }

    [Test]
    public void Test01_UpdateObserver()
    {
        mECB.SelectedIndex = 0;
        Assert.AreEqual( "Billy", mObservedValue.Value );
    } 
```

在尝试将 SelectedIndex 设置为 0 时，测试在第一行失败。在调试时，这似乎是因为当 .DataSource 更改时，.Items 集合没有更新以反映这一点。但是，在调试实际应用程序时，始终会在 .DataSource 更改时更新 .Items 集合。

当然，我不必在测试中实际渲染 ComboBox，我什至没有设置任何绘图表面来渲染！也许我需要的唯一答案是“在我实际上不需要绘制框的单元测试场景中，如何以与绘制时相同的方式更新组合框？”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T12:16:09.013

由于您只是调用构造函数，因此组合框的许多功能将不起作用。例如，当 ComboBox 在屏幕上或表单上绘制时，项目将被填充。在单元测试中构建它时不会发生这种情况。

为什么要在该组合框上编写单元测试？

您不能将现在在自定义控件中的逻辑分开吗？例如把它放在一个控制器中，然后测试它？

为什么不对 DataSource 属性而不是 Items 集合进行测试？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T12:13:14.273

我确信`Application.Run`缺席不会影响任何控件的行为

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T06:35:38.153

我在项目绑定数据的组合框中遇到了同样的问题。我目前的解决方案是在测试中创建一个表单，将组合框添加到 Controls 集合中，然后在我的测试中显示该表单。有点丑。我所有的组合框真正做的是列出一堆 TimeSpan 对象，排序，并具有 TimeSpan 值的自定义格式。它对按键事件也有特殊行为。我尝试将所有数据和逻辑提取到一个单独的类中，但无法弄清楚。可能有更好的解决方案，但我正在做的似乎令人满意。

为了使测试更容易，我在测试代码中创建了这些类：

```
 class TestCombo : DurationComboBox {
        public void SimulateKeyUp(Keys keys) { base.OnKeyUp(new KeyEventArgs(keys)); }
        public DataView DataView { get { return DataSource as DataView; } }
        public IEnumerable<DataRowView> Rows() { return (DataView as IEnumerable).Cast<DataRowView>(); }
        public IEnumerable<int> Minutes() { return Rows().Select(row => (int)row["Minutes"]); }
    }

    class Target {
        public TestCombo Combo { get; private set; }
        public Form Form { get; private set; }

        public Target() {
            Combo = new TestCombo();
            Form = new Form();
            Form.Controls.Add(Combo);
            Form.Show();
        }
    } 
```

这是一个示例测试：

```
 [TestMethod()]
    public void ConstructorCreatesEmptyList() {
        Target t = new Target();
        Assert.AreEqual<int>(0, t.Combo.DataView.Count);
        Assert.AreEqual<int>(-1, t.Combo.SelectedMinutes);
        Assert.IsNull(t.Combo.SelectedItem);
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T13:47:29.227

如果目标是 ComboBox 或任何其他控件，这将解决一些问题：

目标.CreateControl();

但我无法将 SelectedValue 设置为空值，我的测试使用组合框的两个数据源，一个作为数据源，第二个绑定到 selevted 值。使用其他控件一切正常。一开始我也在测试中创建表单，但是在执行测试时在我们的构建服务器上创建表单时出现问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-03T17:00:47.373

我做了一些小技巧以在我的自定义派生组合框中允许这样做：

```
public class EnhancedComboBox : ComboBox 
{

    [... the implementation]

    public void DoRefreshItems()
    {
        SetItemsCore(DataSource as IList);       
    }
} 
```

该`SetItemsCore`函数指示基本组合框使用提供的列表加载内部项目，这是数据源更改后内部使用的内容。

当控件不在表单上时，这个函数永远不会被调用，因为有很多对`CurrencyManager`s 和`BindingContext`s 的检查都失败了，因为我相信这个组件是由父表单以某种方式提供的。

无论如何，在测试中，您必须在`mECB.DoRefreshItems()`the 之后调用`mECB.DataSource = mTestItems`，如果您只依赖`SelectedIndex` and`Items`属性，一切都应该没问题。像数据绑定这样的任何其他行为可能仍然不起作用。

# svg - SVG Positioning

> ID：479591
> 
> 赞同：227
> 
> 时间：2009-01-26T12:11:15.683
> 
> 标签：svg, position, grouping

I'm having a play with SVG and am having a few problems with positioning. I have a series of shapes which are contained in the `g` group tag. I was hoping to use it like a container, so I could set its x position and then all the elements in that group would also move. But that doesn't seem to be possible.

1.  How do most people go about positioning a group of elements which you wish to move in tandem?
2.  Is there any concept of relative positioning? e.g. relative to its parent

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2009-01-26T12:33:02.393

Everything in the g element is positioned relative to the current transform matrix.

To move the content, just put the transformation in the g element:

```
<g transform="translate(20,2.5) rotate(10)">
    <rect x="0" y="0" width="60" height="10"/>
</g> 
```

Links: [Example](http://www.w3.org/TR/SVG11/images/struct/Use03-GeneratedContent.svg) from [the SVG 1.1 spec](http://www.w3.org/TR/SVG11/struct.html)

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2012-11-28T19:59:28.267

上一个答案有一个更短的替代方案。SVG 元素也可以通过嵌套 svg 元素进行分组：

```
<svg xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <svg x="10">
    <rect x="10" y="10" height="100" width="100" style="stroke:#ff0000;fill: #0000ff"/>
  </svg>
  <svg x="200">
    <rect x="10" y="10" height="100" width="100" style="stroke:#009900;fill: #00cc00"/>
  </svg>
</svg> 
```

这两个矩形是相同的（除了颜色），但父 svg 元素具有不同的 x 值。

[请参阅 http://tutorials.jenkov.com/svg/svg-element.html](http://tutorials.jenkov.com/svg/svg-element.html)。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-02-18T14:32:30.817

如另一条评论中所述，元素`transform`上的属性`g`是您想要的。用来`transform="translate(x,y)"`移动`g`周围和里面的东西`g`会相对于 移动`g`。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2015-05-02T05:50:52.663

有两种方法可以对多个 SVG 形状进行分组并定位该组：

正如 Aaron 所写，第一个使用`<g>`with属性。`transform`但是你不能只在元素 上使用`x`属性。`<g>`

另一种方法是使用嵌套`<svg>`元素。

```
<svg id="parent">
   <svg id="group1" x="10">
      <!-- some shapes -->
   </svg>
</svg> 
```

这样，#group1 svg 嵌套在#parent 中，并且`x=10`是相对于父svg 的。但是，您不能`transform`在元素上使用属性`<svg>`，这与元素完全相反`<g>`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-07-03T18:46:30.777

我知道这很旧，但既不是`<svg>`组标签也不是`<g>`解决我面临的问题。我需要调整一个`<g>`标签的 y 位置，它上面也有动画。

解决方案是同时使用`<svg>`和`<g>`标签：

```
<svg y="1190" x="235">
   <g class="light-1">
     <path />
   </g>
</svg> 
```

# java - Struts 中的预选值标签？

> ID：479592
> 
> 赞同：5
> 
> 时间：2009-01-26T12:12:56.040
> 
> 标签：java, forms, struts2, struts, struts-tags

我有这个 Struts 标签：

```
<s:select name="country.id" 
          list="countries"  
          listValue="name" 
          listKey="id"
          headerValue="Select Country"
          headerKey=""
          label="Country" /> 
```

它输出以下 HTML 代码：

```
<select name="country.id" tabindex="12" id="registration_country">
    <option value="">Select Country</option>
    <option value="1">United States</option>
    <option value="2">Afghanistan</option>
    <option value="3">Albania</option>
    <option value="4">Algeria</option>
    ...
    <option value="192">Zambia</option>
    <option value="193">Zimbabwe</option>
</select> 
```

如何指定我希望在列表中预选例如“阿尔巴尼亚”？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T00:21:25.943

使用标签`value`中的属性：`s:select`

```
<s:select name="country.id" 
list="countries"  
listValue="name" 
listKey="id"
headerValue="Select Country"
headerKey=""
label="Country"
value="3" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T12:33:39.960

试试这个：

```
headerKey="3" 
```

# java - 将传入的 TCP“命令”转发给函数？

> ID：479595
> 
> 赞同：3
> 
> 时间：2009-01-26T12:14:24.210
> 
> 标签：java, sockets

在 Java 中，您将如何设置一个套接字侦听器，该侦听器侦听套接字以获取表示命令的一系列字节，并在接收时调用一个解析传入数据并调用适当命令的方法？

**澄清：**

我的问题不在于处理命令（也可能是错误代码或对来自服务器的命令的响应），而是创建套接字并监听它。

**更多说明：**

我想要做的是模仿下面的.Net（C#）代码行：

```
_stream.BeginRead(_data,0, _data.Length, new  
    AsyncCallback(this.StreamEventHandler), _stream); 
```

在哪里：

*   _stream 是从套接字创建的网络流
*   _data 是一个长度为 9 的字节数组
*   this.StreamHandler 是在读取数据时执行的委托（函数指针）。

我正在将一个库从 C# 重写为 Java，并且我当前正在编写的组件通过 TCPIP 将命令传递给服务器，但还必须能够将事件/响应冒泡到它上面的层。

在 C# 中，这似乎是微不足道的，在 Java 中看起来越来越少。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T12:22:02.730

有一个小的 main 方法来设置套接字并监听传入的连接。将每个连接传递给一个工作对象（可能在它自己的线程中）。

worker 对象应该有两个 API：服务器和客户端。客户端 API 获取连接并从中读取数据，服务器 API 获取连接并向其写入数据。

我喜欢将这两个放在一个类中，因为这样可以更简单地保持两者同步。使用辅助类对数据进行编码/解码以进行传输，因此您可以单点决定如何传输整数、命令、选项等。

如果您想更进一步，请定义一个命令类并编写代码以将其序列化到套接字连接并从中读取它。这样，您的工作对象只需要声明它们处理的命令类，并且服务器/客户端 API 变得更加简单（以命令类为代价）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T15:46:44.767

[从我的另一个答案开始](https://stackoverflow.com/questions/479595/forwarding-incoming-tcp-commands-to-a-function#479898)：您要求的特定部分是进入该部分的部分：“魔术在这里”。它可以通过多种方式完成，但其中一种是：

```
final InputStream in = socket.getInputStream();
// This creates a new thread to service the request.
new Thread(new Runnable(){
  public void run(){
    byte[] retrievedData= new byte[ITEM_LENGTH];
    in.read(retrievedData, 0, ITEM_LENGTH);
    in.close();

    // Here call your delegate or something to process the data
    callSomethingWithTheData(retrievedData);
  }
}).start(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T12:21:17.427

我会

1.  将每个命令放入`class`它自己的一个，其中每个类实现一个特定的`interface`（例如`Command`）

2.  创建一个`Map<String,Command>`包含从每个命令字符串到实现该命令的类的实例的查找表

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T12:34:20.783

TCP 连接为您提供了一个[`InputStream`](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#getInputStream())和一个[`OutputStream`](http://java.sun.com/javase/6/docs/api/java/net/Socket.html#getOutputStream())。您可以`InputStream`在专用线程上连续轮询下一个命令（及其输入）。[`ByteBuffer.wrap(byte[] array)`](http://java.sun.com/javase/6/docs/api/java/nio/ByteBuffer.html#wrap(byte%5B%5D))在将字节解释为 chars、ints、longs 等方面可能很有用。您还可以使用[serialization](http://java.sun.com/javase/6/docs/api/java/io/Serializable.html)传递对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T12:58:34.293

这应该会有所帮助。 [第 1 课：套接字通信](http://java.sun.com/developer/onlineTraining/Programming/BasicJava2/socket.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T13:11:38.167

任何幼稚的方法很可能都无法很好地扩展。

考虑使用带有合适的小型 Web 服务器的 REST 方法。码头通常是一个不错的选择。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T14:09:51.950

以一种非常幼稚的方式创建一个监听套接字：

```
 mServerSocket = new ServerSocket(port);

    listening = true;

    while (listening) {

      // This call blocks until a connection is made
      Socket socket = serverSocket.accept();

      OutputStream out = socket.getOutputStream();
      InputStream in = socket.getInputStream();

      // Here you do your magic, reading and writing what you need from the streams
      // You would set listening to true if you have some command to close the server
      // remotely

      out.close();
      in.close();
      socket.close();
   } 
```

通常，将输入流的处理委托给其他线程是一个好主意，这样您就可以回答下一个请求。否则，您将按顺序回答所有请求。

您还需要定义某种协议，说明您期望在输入和输出流上使用哪些字节，但从您的问题来看，您似乎已经有了一个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T21:55:27.750

您可以为每个命令创建一个包含一个成员的枚举

```
interface Comamnd {
    // whatever you expect all command to know to perform their function
    void perform(Context context);
}

enum Commands implements Command{
   ACTIONONE() {
        void perform(Context context) {
             System.out.println("Action One");
        }
   },
   ACTIONTWO() {
        void perform(Context context) {
             System.out.println("Action Two");
        }
   }
}

// initialise
DataInputStream in = new DataInputStream(socket.getInputStream());

// in a loop
byte[] retrievedData= new byte[ITEM_LENGTH];
in.readFully(retrievedData);
String command = new String(retrievedData, 0);
Commands.valueOf(command).perform(context); 
```

# legacy - 是什么让代码遗留？

> ID：479596
> 
> 赞同：44
> 
> 时间：2009-01-26T12:15:29.277
> 
> 标签：legacy

我听说许多开发人员将代码称为“遗留”。大多数情况下，代码是由不再从事该项目的人编写的。是什么造就了代码，遗留代码？

更新以回应：“从祖先或前任或过去传下来的东西” [http://www.thefreedictionary.com/legacy](http://www.thefreedictionary.com/legacy)。显然你想知道别的东西。您能否澄清或扩展您的问题？洛特

我正在寻找遗留代码的症状，这些症状使其无法使用或使用起来是一场噩梦。什么时候扔掉比较好？我认为应该更频繁地丢弃代码，并且重新发明轮子是开发的宝贵部分。不重新发明轮子的学术理想是一个不错的理想，但它不是很实用。

另一方面，显然有遗留代码值得保留。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-26T12:19:36.697

通过使用不再支持或已被取代的硬件、软件、API、语言、技术或功能，通常几乎不可能替换该代码，而是使用它直到它或系统死机。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-26T12:18:20.833

> 是什么造就了代码，遗留代码？

与普通遗产一样，当作者去世或失踪时，您作为继承人可以获得他的全部或部分代码。

你流下了眼泪，并试图弄清楚如何处理所有这些垃圾。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-01-26T12:22:38.187

Michael Feathers 在他的《有效地使用遗留代码》一书中有一个有趣的定义。根据他的说法，遗留代码是没有自动化测试的代码。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-01-26T12:25:09.040

这是一个非常笼统的（并且经常被滥用的术语），但以下任何一项都是将应用程序称为旧版的正当理由：

1.  代码库基于原始产品制造商完全不支持的语言/平台（通常说制造商已经停业）。

2.  （真的 1a）构建它的代码库或平台太老了，以至于为系统找到合格或有经验的开发人员既困难又昂贵。

3.  该应用程序支持业务的某些方面，这些方面不再积极发展，并且更改极为罕见，通常会在其周围发生完全意外的变化（典型示例是 Y2K 问题）或某些监管/外部压力时修复它它。由于这两个原因都很紧迫且通常是不可避免的，但该项目没有发生重大进展，因此分配处理此问题的人员很可能不熟悉该系统（以及它的累积行为和错综复杂）。在这些情况下，这通常是增加对与项目相关的风险的感知和计划的理由。

4.  该系统已经/或正在被另一个系统替换。因此，该系统的用途可能远低于最初的预期，或者可能仅用作查看历史数据的一种方式。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-26T12:21:30.747

Legacy 通常是指不再开发的代码——这意味着如果你使用它，你必须按照它的原始条款使用它——你不能只是编辑它来支持当今世界的样子。例如，遗留代码必须在今天可能不存在或不再受支持的硬件上运行。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-01-26T12:26:17.837

根据 Michael Feathers，优秀的[Working Effectively with Legacy Code](https://rads.stackoverflow.com/amzn/click/com/0131177052)的作者，遗留代码是没有测试的代码。当无法知道此代码更改时会发生什么中断时。

> 遗留代码与非遗留代码的主要区别在于测试，或者说缺乏测试。我们可以通过一个小小的思考实验来了解这一点：如果它可以反击，如果它可以告诉你什么时候犯了错误，那么修改你的代码库会有多容易？这很容易，不是吗？对大型代码库进行更改所涉及的大部分恐惧是害怕引入细微的错误。害怕不经意间改变事情。通过测试，您可以使事情变得更好而不受惩罚。对我来说，这种差异是如此重要，它压倒了任何其他的区别。通过测试，您可以使事情变得更好。没有他们，你只是不知道事情是变得更好还是更糟。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-26T14:25:10.467

一位同事曾经告诉我，遗留代码是您自己没有编写的任何代码。

可以说，这只是对我们不再喜欢的代码的贬义词，无论出于何种原因（通常是因为它不酷或不时尚，但它确实有效）。

TDD 团队可能会建议任何未经测试的代码都是遗留代码。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-01-26T12:20:34.043

[遗留代码](http://en.wikipedia.org/wiki/Legacy_code)是与不再支持或制造的操作系统或其他计算机技术相关的源代码。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-12-06T15:48:36.380

没有人会读这个，但我觉得其他答案不太正确：

1.  它有价值，如果它没有用它早就被扔掉了
2.  这很难推理，因为
    1.  缺乏文件，
    2.  无法找到或忘记原始作者（是的 2 个月后您的代码也可以是遗留代码！！），
    3.  缺乏测试或类型系统
    4.  不遵循现代实践（即没有上下文可以坚持）
3.  需要更改或扩展它。如果不需要更改它，它就不是遗留代码，因为没有人关心它。它做它的事，周围没有人称它为遗留代码。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-01-26T12:19:58.520

[http://en.wikipedia.org/wiki/Legacy_code](http://en.wikipedia.org/wiki/Legacy_code)

“遗留代码是与不再支持或制造的源代码”

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-01-26T12:22:23.383

缺少支持（或文档）的任何代码。就这样吧：

*   内联评论
*   技术文档
*   口述文件（写它的人）
*   记录代码工作的单元测试

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-01-26T14:47:59.547

对我来说，遗留代码是在某些范式转变之前编写的代码。它可能仍在使用中，但正在重构以使其符合要求。
例如，旧的程序代码挂在其他 OO 系统中。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-26T14:41:26.287

当代码（或其他任何东西，真的）被更新/更好的东西取代时，它就变成了“遗产”，尽管如此，它仍然在“野外”使用并保持活力。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-26T15:22:52.147

保留遗留代码与其说是学术上的理想，不如说是保持代码有效，无论多么糟糕。在许多保守的企业情况下，这被认为比扔掉它并从头开始更实用。最好是你认识的魔鬼……

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-06-01T22:49:58.593

遗留代码是为了适应不断变化的需求而痛苦/昂贵的代码。

发生这种情况有两种方式：

1.  代码不适合更改
2.  代码的语义已换出到硅片

1）两者中较容易识别。它是具有基本限制的软件，使其无法跟上周围的生态系统。例如，围绕 O(n^2) 算法构建的系统不会超出某个点，如果需求朝那个方向移动，则必须重新编写。另一个示例是使用最新操作系统版本不支持的库的代码。

2) 更难识别，但所有此类代码都具有人们害怕更改它的特点。这可能是因为它一开始就编写/记录得很糟糕，因为它未经测试，或者因为它不是微不足道的，并且理解它的原始作者离开了团队。

组成活代码的 ASCII/Unicode 字符在与之相关的人们的头脑中具有语义含义，即“为什么”、“是什么”以及在某种程度上“如何”。遗留代码要么是无主的，要么所有者对大部分代码没有意义。一旦发生这种情况（如果代码写得非常糟糕，它可能会在第二天发生），要更改此代码，必须有人学习并理解它。这个过程是最初编写它所需时间的很大一部分。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-05-14T10:48:50.837

你害怕重构代码的那一天，就是你的代码成为遗留问题的那一天。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-01T04:08:31.280

如果以下任何或所有条件适用，我认为代码“遗留”：

*   它是使用落后于当前标准一代的语言或方法编写的
*   代码是一团糟，背后没有任何规划或设计
*   它是用过时的语言和过时的、非面向对象的风格编写的
*   很难找到懂这门语言的开发者，因为它太老了

与这里的其他一些观点不同，我见过很多现代应用程序在没有单元测试的情况下也能正常工作。单元测试仍然没有受到所有人的欢迎。也许十年后，下一代程序员会关注我们当前的应用程序，并认为它们是“遗留的”，因为它们不包含单元测试，就像我认为非面向对象的应用程序是遗留的一样。

如果需要对遗留代码库进行少量更改，最好保持原样并顺其自然。如果应用程序需要大刀阔斧的功能更改、GUI 大修和/或您找不到任何了解编程语言的人，那么是时候扔掉并重新开始了。但是，请注意：从头开始重写可能非常耗时，并且很难知道您是否复制了所有功能。您可能希望为旧应用程序和新应用程序编写测试用例和单元测试。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-26T15:06:03.537

老实说，遗留代码是其他软件构造的任何代码、框架、api，不再“酷”了。例如 COBOL 被一致认为是遗留的，而 APL 不是。现在，人们还可以将 COBOL 视为传统和 APL，而不是因为它的安装基数是 APL 的大约 100 万倍。但是，如果您说您需要处理 APL 代码，则回复不会是“哦，不，那些遗留的东西”，而是“哦，我的上帝，你猜下个世纪你不会做任何事情”看到区别了吗？

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-05-04T12:37:15.113

这是软件生态系统中经常（并且非常笼统地）抛出的通用术语。

好吧，我喜欢将遗留代码视为**继承代码**。这只是过去编写的代码。在大多数情况下，遗留代码不遵循新的/当前的做法，通常被认为是过时的。

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2009-02-23T13:52:45.817

遗留代码是一个多月前编写的任何东西:-)

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2011-10-07T09:28:10.513

通常是任何不是用流行的脚本语言编写的代码，我只是在开玩笑。

# visual-studio - 是否有适用于 Visual Studio 的 Jira 插件？

> ID：479599
> 
> 赞同：30
> 
> 时间：2009-01-26T12:17:06.450
> 
> 标签：visual-studio, jira

我们正在切换到 SVN+Jira+VS2008 进行 .NET 开发。是否有任何 Visual Studio 插件允许直接从 IDE 使用 Jira？如果它可以与 SVN 支持集成（我们现在使用 AnkhSVN），那就太好了，尽管这可能要求太多了。谷歌并没有产生太多，只有一些主要是关于其他主题的邮件列表。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-03-18T16:55:20.310

Atlassian 为 Visual Studio 发布了一个免费的连接器。它可从插件交换网站获得：[https ://plugins.atlassian.com/plugin/details/19493](https://plugins.atlassian.com/plugin/details/19493)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T17:34:57.640

JIRA-VSTD 集成已经存在；我昨天才发现的。

看看[这个](http://almworks.com/tracklink/overview.html)。这是 ALM Works 的商业产品。

我自己没有亲自尝试过，但正在获取它的过程中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-01-13T00:26:50.940

VSJira Visual Studio 扩展于 2015 年 10 月启动，[并](https://marketplace.visualstudio.com/items?itemName=farmas.VSJira#overview)在本月（2018 年 1 月）得到积极维护。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-10-19T13:20:53.790

看起来这已被 Atlassian [https://developer.atlassian.com/blog/2015/06/discontinuing-ide-connectors-support/弃用](https://developer.atlassian.com/blog/2015/06/discontinuing-ide-connectors-support/)

但我下载并修复了它的连接器的某些部分，现在您可以在**Visual Studio 2015**中下载：http : [//u2s.ir/3fknUR](http://u2s.ir/3fknUR)

```
fix that i done: extension.vsixmanifest, [Content_Types].xml 
```

并将所有文件压缩为 Atlassian Connector For Visual Studio.vsix

抱歉，我只是用我的 jira 版本进行测试，新版本的 jira 可能不适用于 **使用 JIRA v6.1.4 测试的这个**

# xslt - XSL 模板可以在 *ALL* 模式下匹配吗？

> ID：479607
> 
> 赞同：14
> 
> 时间：2009-01-26T12:19:55.557
> 
> 标签：xslt

有没有办法编写一个在所有模式下都匹配的 XSL 1.0 模板？

还是我必须为每个现有模式编写一个单独的模板（包括将来添加的模式的附加模板）？

这是我所拥有的：

```
<xsl:apply-templates mode="mode1" />
    ...
<xsl:apply-templates mode="mode2" />
    ...
<!-- Do not process text content of nodes no matter in what mode -->
<!-- Is there a way to have only one template here? -->
<xsl:template match="text()" mode="mode1" />
<xsl:template match="text()" mode="mode2" /> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T12:25:28.820

预定义模式：（[`#all`](http://www.zvon.org/xxl/XSL-Ref/Tutorials/Modes/m4.html)但仅在 XSLT 2.0 中可用）。

编辑：使用 1.0 复制共享模式行为

```
<xsl:template match="/">
    <xsl:variable name="choice" select="'a'"/><!-- input seed here -->
    <xsl:choose>
        <xsl:when test="$choice='a'">
            <xsl:apply-templates mode="a"/>
        </xsl:when>
        <xsl:when test="$choice='b'">
            <xsl:apply-templates mode="b"/>
        </xsl:when>
    </xsl:choose>
</xsl:template>

<xsl:template match="*" mode="a">
    [A]
    <xsl:apply-templates />
</xsl:template>

<xsl:template match="*" mode="b">
    [B]
    <xsl:apply-templates />
</xsl:template>

<xsl:template match="text()">
    [ALL]
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T14:31:49.207

> 有没有办法编写一个在所有模式下都匹配的 XSL 1.0 模板

**是的，为了做到这一点，应该遵循以下两条规则**：

1.  编写**没有模式属性**的模板。

2.  在模式化的模板中有一个**没有模式属性**`<xsl:apply-templates>`的指令，这将导致上面 1\. 中的模板被选择进行处理

 ****这直接来自[XSLT 1.0](http://www.w3.org/TR/xslt)规范，[该规范说](http://www.w3.org/TR/xslt#modes)**：

> 如果一个`xsl:apply-templates`元素有一个`mode`属性，那么它只适用于那些来自具有相同属性值的元素的模板 `xsl:template`规则`mode` ；如果一个 `xsl:apply-templates`元素没有`mode`属性，那么它只适用于那些来自 `xsl:template`没有`mode`属性的元素的模板规则。

**To summarise**: A set of templates each in a different mode can still issue `<xsl:apply-templates>` in such a way (described above), so that the same specific, single template will be selected for processing in each case.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T12:43:12.873

如果您想让模板在所有模式下都匹配，那么为什么要使用模式？如果您不使用模式，则模板将一直使用。模式的原因是有条件地用相同的数据类型做不同的事情。好像你想要无模式。

# .net - SCT 过期时续订 WCF 客户端？

> ID：479618
> 
> 赞同：10
> 
> 时间：2009-01-26T12:21:32.683
> 
> 标签：.net, wcf, performance

我正在使用 WCF 到使用安全模式“TransportWithMessageCredential”的肥皂端点。

WCF 客户端/服务器使用 SCT（安全上下文令牌）来维护安全连接，并且它在一般情况下按预期工作。

但是，在一段时间不活动之后，SCT 将过期，并且下一次方法调用将导致 MessageSecurityException：

> 从另一方收到不安全或不正确安全的故障。故障代码和细节见内部FaultException

内部异常：

> 无法处理该消息。这很可能是因为操作“ [http://tempuri.org/IMyService/MyMethod](http://tempuri.org/IMyService/MyMethod) ”不正确，或者因为消息包含无效或过期的安全上下文令牌，或者因为绑定之间不匹配。如果服务由于不活动而中止通道，则安全上下文令牌将无效。为了防止服务过早中止空闲会话，请增加服务端点绑定的接收超时。

在随后的调用中，当我看到 CommunicationState 出现故障时，我会更新连接。但是我找不到在进行方法调用之前先发制人地检查 SCT 是否已过期的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T12:19:15.863

您可以使用委托来解决您的问题。这将允许安全地调用该操作，如果失败，则捕获异常，构造一个新的服务实例并再次执行该操作。

```
using System;
using System.ServiceModel;
using System.ServiceModel.Security;

public static class Service
{
    private static IService _service;

    public static void Invoke(Action<IService> action)
    {
        try
        {
            action(_service);
        }
        catch (MessageSecurityException)
        {
            if (_service.State != CommunicationState.Faulted)
            {
                throw;
            }

            _service.Abort();
            _service = CreateFreshInstance();

            action(_service);
        }           
    }
} 
```

`Service.Invoke(s => s.Method());`然后，您可以像调用 IService.Method()一样调用您的帮助程序类。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-08-03T15:16:53.297

在第一个答案的基础上，我提出了这个解决方案，它通常包装由 svcutil.exe 创建的自动生成的客户端代理：

```
public class ProxyWrapper<T> where T : ICommunicationObject
{
    private T _service;

    public ProxyWrapper()
    {
        _service = CreateNewInstance();
    }

    public void Invoke(Action<T> action)
    {
        try
        {
            action(_service);
        }
        catch (MessageSecurityException)
        {
            if (_service.State != CommunicationState.Faulted)
            {
                throw;
            }

            _service.Abort();
            _service = CreateNewInstance();

            action(_service);
        }
    }

    public TResult Invoke<TResult>(Func<T, TResult> func)
    {
        try
        {
            return func(_service);
        }
        catch (MessageSecurityException)
        {
            if (_service.State != CommunicationState.Faulted)
            {
                throw;
            }

            _service.Abort();
            _service = CreateNewInstance();

            return func(_service);
        }
    }

    private T CreateNewInstance()
    {
        Type type = typeof(T);
        return (T)type.GetConstructor(Type.EmptyTypes).Invoke(null);
    }
} 
```

要使用它，您需要做的就是：

```
ProxyWrapper<ServiceClient> client = new ProxyWrapper<ServiceClient>();
client.Invoke(s => s.SomeAction());
int val = client.Invoke<int>(s => s.ReturnsAnInteger()); 
```

**注意：**由于我只使用客户端代理的默认构造函数，这就是所有这些支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T20:49:18.977

您也许可以使用装饰器模式来处理带有 WCF 代理的异常。如果这条路径对您开放，您可以考虑这样的设置，它将处理代理故障并为调用者重新初始化它。随后的异常将被抛出给调用者。

```
//Proxy implements this
interface IMyService
{

  void MyMethod();

}

//Decorator 1
public class MyServiceProxyRetryingDecorator : IMyService
{

  //This is the real proxy that might be faulted
  private realProxy = new RealProxy();

  public void MyMethod()
  {
    ReEstablishProxyIfNecessary();
    //now just pass the call to the proxy, if it errors again, 
    //do more handling or let the exception bubble up
    realProxy.MyMethod();
  }

  private void ReEstablishProxyIfNecessary()
  {
    if(realProxy.CommunicationState == CommunicationState.Faulted)
    {
       realProxy.Abort();
       realProxy = new RealProxy();
    }
  }
} 
```

不同版本的装饰器可以让装饰器处理您的 MessageSecurityException，并在它被捕获时重新初始化真正的代理：

```
//Decorator 2
public class MyServiceProxyExceptionHandlingDecorator : IMyService
{

  //This is the real proxy that might be faulted
  private realProxy = new RealProxy();

  public void MyMethod()
  {
    try {realProxy.MyMethod(); } 
    catch (ExceptionYouAreInterestedIn ex)
    { 
    ReEstablishProxyIfNecessary(); 
    realProxy.MyMethod(); //do it again
    }
  }

  private void ReEstablishProxyIfNecessary()
  {
    if(realProxy.CommunicationState == CommunicationState.Faulted)
    {
       realProxy.Abort();
       realProxy = new RealProxy();
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T09:19:34.400

查看这篇文章，您可以在其中下载代理包装器，该包装器会在会话到期时重试。

[http://www.dasblonde.net/2008/04/24/MyProxyWrapperAndTheEVILSUOFile.aspx](http://www.dasblonde.net/2008/04/24/MyProxyWrapperAndTheEVILSUOFile.aspx)

# c++ - 从 SDL 检测可执行文件夹

> ID：479634
> 
> 赞同：1
> 
> 时间：2009-01-26T12:31:00.603
> 
> 标签：c++, path, cross-platform, directory, sdl

我正在创建一个 C++ SDL 游戏引擎，并且了解可执行文件路径是相关的，因为图像和其他资源不存储在可执行文件中 - 它们位于单独的文件夹（“res/”）中。

在 Linux 下，我使用一个 shell 脚本“rungame.sh”，它 cd 到可执行文件路径，然后运行可执行文件（然后使用“./”来引用可执行文件夹）。但是，我相信这是一种“丑陋”的方法，我希望它与 Windows 兼容。

此外，当前的方法不是很好，因为它可能会改变某些命令行参数的含义。

我想要一个跨平台（*NIX、Windows 和 Mac OS X，如果可能的话）解决方案来获取可执行文件的当前路径。游戏路径/可执行文件名称可能会改变。

解决我的问题的最简洁方法是什么（最好使用 std::string 和尽可能少的平台相关 API）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-09-23T03:53:23.793

从 SDL 2.0.1 开始，就有[了 SDL_GetBasePath](https://wiki.libsdl.org/SDL_GetBasePath)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T14:20:04.423

我强烈建议在发布之前搜索：[如何获取程序运行的目录？](https://stackoverflow.com/questions/143174/c-c-how-to-obtain-the-full-path-of-current-directory)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-30T19:28:43.473

[physicsfs](http://icculus.org/physfs/)有[`PHYSFS_getBaseDir()`](http://icculus.org/physfs/docs/html/physfs_8h.html#a0034c327dfb381a1c95deb80878bcede)：

> 获取应用程序所在的路径。
> 
> 辅助功能。
> 
> 获取“基本目录”。这是运行应用程序的目录，可能是安装目录，可能是也可能不是进程的当前工作目录。
> 
> 您可能应该在搜索路径中使用基本目录。

# c - 如何比较编译器

> ID：479647
> 
> 赞同：7
> 
> 时间：2009-01-26T12:33:54.327
> 
> 标签：c, compiler-construction

你用什么指针来比较编译器？

我听说 gcc 是最好的 C 编译器，这是真的吗？如果是这样，为什么？

我的意思是一般来说，所以你可以说明哪个编译器更适合哪个架构。

（例如，我听说 igc 更适合英特尔，但我不知道为什么）

我个人打算使用 AMD 64 位，在 Linux 和 Windows、GUI 和非 GUI 应用程序中开发。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T12:46:53.037

嗯，不知道你在哪里听说 gcc 是“最好的 C 编译器”。当 gcc 在 1990 年代问世时，它只是最普遍的，而且比大多数商业 UNIX 供应商提供的本地 C 编译器要好得多。

但是什么定义了“最好的”？

*   是时候编译代码了；
*   编译代码的大小；
*   编译代码的速度；
*   编译代码的内存使用；
*   段错误的错误和概率；
*   支持;
*   社区;
*   等等

不同的事情对不同的人很重要。

这是一[组将 gcc 与 Intel 编译器进行比较的指标，](http://web.archive.org/web/20090211054751/http://coyotegulch.com/reviews/linux_compilers/)以及[另一组与 clang 的比较](http://clang.llvm.org/comparison.html)。我相信您也可以找到与 Microsoft 编译器的一些比较。

一般来说，人们并不关心相关的大小或速度或编译器（甚至不一定关心输出的大小或速度小于两倍），而是它是否有效（这是一个真正的问题一两年前），它是否支持相关标准以及它是否有任何你必须解决的奇怪/错误/功能。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-26T12:46:42.023

一般来说：首先，编译器质量最重要的方面是**正确性**。有错误或意外行为的编译器真的会毁了你的一天。**生成的代码**的质量，如速度、大小和内存使用情况，也在列表的顶部。

**编译速度**是另一个方面，尤其是在编译大型项目时。

我发现特别重要的一件事是**错误处理**，即当编译器遇到它不能（或不会）处理的东西时你得到的消息的质量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T02:47:15.697

**正确性**是*必要条件*。

我也喜欢

*   拥有一个运行速度非常快的编译器（如[lcc](http://www.cs.princeton.edu/software/lcc)或[ocamlc](http://caml.inria.fr)）
*   拥有一个能够产生非常好的代码的编译器（比如[ocamlopt](http://caml.inria.fr)或[MLton](http://mlton.org)）

如果它们是两个不同的编译器也没关系。

我*讨厌*有一个编译器会在新版本出现时使程序中断。（理查德斯托曼，打电话给你的办公室。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T12:43:04.793

我知道 INTEL 和 MS 编译器已经开始为[SSE3/4](http://en.wikipedia.org/wiki/SSE4)指令生成代码，并在编译器中做一些聪明的事情，比如展开循环和支持向量化。不确定 GCC 是否这样做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T13:21:12.670

我一直认为错误消息和警告会有所作为。一些编译器会让你不必要地难以理解他们想要表达的意思。其他的则更加用户友好。当您可以启用警告而编译器不会无休止地警告您它自己创建的东西时，这也很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T12:48:15.950

你的意思是

*   最好的编译速度
*   最好的最小代码
*   最快的代码最好？

您可以创建一个测试应用程序，可能使用一些讨厌的代码（需要智能优化器）并使用所有编译器对其进行测试。

比较您的基准并使用您最喜欢的基准。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T04:37:28.580

gcc 是一个可怕的编译器。它拥有最好的技术支持，也许是因为它的价格、用户数量和互联网（以及寻找帮助的谷歌）。但就其生成的机器代码的质量而言，它的输出充其量只是平均到低于平均水平。

# testing - 您对 AutomatedQA 的 TestComplete 有何经验？

> ID：479649
> 
> 赞同：11
> 
> 时间：2009-01-26T12:34:30.457
> 
> 标签：testing

在我的工作场所，我们正在考虑购买 TestComplete，但在使用评估版后，我不确定它是否对我们有任何好处。

创建测试似乎需要做很多工作，而我的老板并不完全相信这是值得的。

另一方面，我们没有任何单元测试，所以我们迫切需要一些自动化测试。

*   您对 TestComplete 有什么体验？
*   非开发人员可以创建测试是否现实？（没有开发人员的帮助）
*   TestComplete 可以替代单元测试吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-09-28T15:10:01.113

我对 TestComplete 3 有过噩梦般的经历。

我继承了一个糟糕的脚本和一个过时的应用程序，我用血汗和泪水设法让它正常工作。我在路上学到了很多 VBScript，但在开发人员附近没有任何东西。

然后我设法升级到了 TestComplete 7。它与 3、4、5 和 6 都没有任何关系。好吧，它可能看起来类似于 5 和 6，但它有更多的功能。3和4太史前了，我什至不敢谈论它们。

到目前为止，TestComplete7 对我们来说是一种魅力。我们正在开发独立和基于 Web 的应用程序，我们发现 v7.5 可以提供我们需要的一切。

非技术测试人员可能只利用了 TestComplete 必须提供的 5% 到 10%，并且根据被测应用程序的成熟度，他可能会发现自己浪费的时间比节省的时间还要多。

但是，具有中等高级脚本知识的测试人员可能会用它创造奇迹。

所有这些都是我们在功能测试方面的经验。我们还没有调查它是否可以进行单元测试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-28T14:27:53.223

取决于你想测试什么。如果您很难模拟 GUI 上的点击，那么 TestComplete 可以很好地完成。就这样做而言，对象浏览器和记录功能非常有用。

如果你正在尽你所能避免 GUI 测试的烦恼，那么 VB 脚本、python、perl 或选择你最喜欢的脚本语言。我们决定在我们的项目中使用 JScript，并且它的实现有时会“令人兴奋”。

基本上通过功能列表并决定您将使用和不使用什么。如果您只是要使用它来收集所有测试用例，请不要打扰。如果您要大量使用 GUI 测试、分布式测试等，请务必使用它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-07-22T19:24:37.123

我对 TestComplete 有压倒性的仇恨......

它的 IDE 很笨重，它的 GUI 几乎没用，它的脚本语言和系统很笨拙（我很好）

*如果*您有时间学习它...
*如果*您有耐心弄清楚...
*如果*您已经进行了适当的单元/集成/系统测试...
*如果*您有一个可以针对模拟系统（消除系统变量）

***那***你可能要考虑一下。否则，您最好花时间编写自下而上的测试，学习如何从系统中抽象出您的 UI，或者只是挖鼻孔。

我们为 TestComplete 花费了 $$,$$$（经理决定，没有工程师参与）来运行负载测试（因为它说这是他们网站上的主要功能）。当我们无法弄清楚如何让它运行负载测试时（你知道，它会在 Y 分钟内保持 X 连接），我们通过电子邮件发送给 AutomatedQA。几周后，我们听到“我们的软件无法做到这一点”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T13:06:00.033

几年前，我与 TestComplete 有过短暂的接触，并没有给我留下太大的印象。脚本语言（不记得我脑子里想的是什么）看起来很笨拙，正如你提到的，创建简单的测试似乎需要做很多工作。

我认为完全非开发人员创建可靠的测试是非常不现实的 - 我认为需要一定程度的开发专业知识，尽管真正了解他们的东西并具有良好技术能力的专门测试人员可能会相处得很好用它

至于最后一点，我认为您在谈论两种不同类型的测试 - TestComplete 更适合功能测试（或者对我来说似乎是这样），也许您会从实现一套单元中获得更多价值首先测试（虽然很难在不了解您的应用的情况下说）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-25T23:08:53.077

我的经历很棒，而且我不是开发人员，但我确实在电视上玩过。

在这里和那里使用 TestComplete 时，我需要开发人员的帮助。我想说的是，如果 TestComplete 的操作员可以理解基本的 If Then Else 语句和变量，并且开发人员可以不时提供帮助，那么是的，非开发人员可以使用它。

单元测试和 GUI 测试是不同的东西；单元测试（非开发人员警告）测试类，GUI 测试测试控件。如果你有 5 块抽象资源，你应该把 3 块放在单元测试中，2 块放在 GUI 测试中，而不是 5 块放在其中一个中。

** 澄清一下，TestComplete 可以运行单元测试，但您仍然必须编写它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T19:51:29.890

我们使用 Test Complete 来自动化我们所有的测试，它运行得非常好。我们花了一些时间来自动化我们所有的回归测试用例，但这是值得的。现在我们每天进行构建并在构建时运行我们的 Test Complete 测试，并将结果报告回我们的测试管理工具（Software Planner [http://www.softwareplanner.com](http://www.softwareplanner.com)）。

我们还围绕 Test Complete 构建了一个关键字驱动的界面，以便我们的主题专家可以使用关键字而不是脚本创建新的测试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-16T00:02:57.217

当我作为 QA（2011 年 12 月）加入我的公司时，它已经有一个未使用的 testComplete 7（又名 TC 7）许可证，我尝试在我的 Windows 7 上安装它。

*   testComplete 7 在 win7 下根本无法运行。好的，我（免费）升级到最新的 TC 8。
*   testComplete 8 在安装期间杀死了我的计算机（我怀疑许可本地服务器）。不小的崩溃：计算机在启动时对我进行了蓝屏，直到我完全重新设置它。

后来我在 MS 档案中发现[TC 8 （默默地）没有标记为与 win7 兼容](http://www.microsoft.com/Windows/compatibility/windows-7/en-us/Details.aspx?type=Software&p=AutomatedQA%20TestComplete&v=AutomatedQA&uid=7&l=en&pf=2&pi=2&c=Development%20Tools&sc=all&os=64-bit)。SmartBear 网站上没有任何警告，安装时也没有。

我不知道这是否可以在其他系统上重现，或者只是运气不好与我的另一个应用程序冲突（不是那么多，崩溃发生在我的第三天）。但这绝对让我对他们的解决方案失去信心：一个测试软件怎么能在一个近乎普通的高度流行的系统上发布之前不进行测试呢？

我不能谈论 GUI，我实际上从未见过它。

我的结论很简单：**只在虚拟机上使用它，因为它非常不稳定**。

**编辑（2012 年 2 月）：**我在 winXP SP3 虚拟机上尝试了新下载的 TC8（使用 Sun 的 VirtualBox）。这一次，来宾计算机在安装过程中意外重新启动，我能够启动闪屏并激活我的演示许可证，然后才被告知安装不正确并关闭应用程序。我想这是对 win7 行为的改进，因为它没有将我的访客机器撕成碎片。

# java - 用于自由文本差异的 Java 库

> ID：479654
> 
> 赞同：19
> 
> 时间：2009-01-26T12:35:40.797
> 
> 标签：java, string, text, comparison, diff

我需要匹配两个几乎相同的长自由文本字符串；即，尽可能找到索引到索引的对应关系。

因为这是自由文本，所以比较不应该像代码差异那样基于行。

对 Java 库有什么建议吗？

一个简单的例子（在现实生活中，当然，不会有额外的空格来排列东西，可能会有更复杂的挑战，比如整个子句的移动。）

```
The quick brown  fox jumped over the  lazy     dog.
||||||||||      |||||||||||||||||||||         |||||
The quick yellow fox jumped over the well-bred dog. 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-26T13:01:56.253

这可能是很好的[Diff Match Patch](https://github.com/google/diff-match-patch)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-26T13:03:19.867

根据您的具体要求，[Apache Commons Lang](http://commons.apache.org/lang/)`StringUtils`组件的类可能会有所帮助，例如：

*   StringUtils#difference：比较两个字符串，并返回它们不同的部分
*   StringUtils#getLevenshteinDistance：求两个字符串之间的[Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:17:09.637

这是一个（经过轻微测试）版本的代码，可以满足您的要求。您可以轻松地与输入并行遍历结果以定位插入和删除。

```
public class StringDiff {

    private static int   length(String s) { return s == null ? 0 : s.length(); }
    private static char[] chars(String s) { return s == null ? new char[0] : s.toCharArray(); }

    private final String left;
    private final String right;

    private final char[] lccs;
    private final String lcs;

    public StringDiff(String left, String right) {
        this.left = left;
        this.right = right;
        lccs = init();
        lcs = new String(lccs);
    }

    public String getLcs()  { return lcs; }
    public char[] getLccs() { return lccs.clone(); }

    private char[] init() {
        int lLength = length(left);
        int rLength = length(right);
        char[] lChars = chars(left);
        char[] rChars = chars(right);
        int [][] t = new int [lLength + 1][rLength + 1];
        for (int i = lLength - 1; i >= 0; --i) {
            for (int j = rLength - 1; j >= 0; --j) {
                if (lChars[i] == rChars[j]) {
                    t[i][j] = t[i + 1][j + 1] + 1;
                } else {
                    t[i][j] = Math.max(t[i + 1][j], t[i][j + 1]);
                }
            }
        }
        char[] result = new char[t[0][0]];
        int l = 0, r = 0, p = 0;
        while (l < lLength && r < rLength) {
            if (lChars[l] == rChars[r]) {
                result[p++] = lChars[l++];
                r++;
            } else {
                if (t[l + 1][r] > t[l][r + 1]) {
                    ++l;
                } else {
                    ++r;
                }
            }
        }
        return result;
    }

} 
```

根据它，原始输入的实际最长子序列：

```
The quick brown  fox jumped over the  lazy     dog.
The quick yellow fox jumped over the well-bred dog. 
```

是：

```
The quick ow fox jumped over the l dog. 
```

（因为“brown”和“yellow”有共同的“ow”等）

修改上面的内容以分割空格（而不是字符数组）并将 String#equals 替换为 == 以获得一个版本，该版本找到单词的最长公共子序列而不是字符，这是相对简单的。对于您上面的示例，该更改将产生明显的结果：

```
found 7 words
    'The'
    'quick'
    'fox'
    'jumped'
    'over'
    'the'
    'dog.' 
```

（您的问题暗示了字符比较，因为您匹配了单词之间的空格。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T15:09:18.880

如果您的示例确实是您想要做的 - 即子序列仅在它们从相同索引开始时才匹配（这与差异通常的操作方式不同） - 这就是您需要做的一切：

```
import java.util.*;

class StringDiff {
    public static List<int[]> from(String s1, String s2) {
        int start = -1;
        int pos = 0;
        LinkedList<int[]> list = new LinkedList<int[]>();

        for(; pos < s1.length() && pos < s2.length(); ++pos) {
            if(s1.charAt(pos) == s2.charAt(pos)) {
                if(start < 0) start = pos;
            }
            else {
                if(start >= 0) list.add(new int[] { start, pos });
                start = -1;
            }
        }

        if(start >= 0) list.add(new int[] { start, pos });

        return list;
    }

    public static void main(String[] args) {
        for(int[] idx : from(args[0], args[1]))
            System.out.println(args[0].substring(idx[0], idx[1]));
    }
} 
```

实际的差异实现将更加复杂。

# opengl - 使相机同时移动和旋转的最佳方法

> ID：479656
> 
> 赞同：3
> 
> 时间：2009-01-26T12:38:20.217
> 
> 标签：opengl

我正在学习一些 OpenGL 游戏编程，但我一直在坚持如何实现，以便相机跟随鼠标指针。就像在 fps 游戏中一样，您想查看鼠标指向的位置，但是在移动时我找不到很好的解决方案。我正在考虑为移动保存一个矩阵，例如步行和扫射，同时使用四元数来处理旋转。然后将四元数转换为旋转矩阵，加载模型视图矩阵的标识，并使用两个矩阵对该矩阵进行计时。

这当然有一些问题，比如我们应该先在乘法中使用哪个矩阵，代码会很丑陋。

所以我想知道是否有人有一个很好的解决方案来解决这个问题，所以我不必找出首先使用哪个矩阵，哪个矩阵可以提供更清晰的代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T15:18:16.273

将相机的视图细节存储为位置向量、视图向量和向上向量（想想伸出拇指指向：您的手指是视图向量，拇指是向上向量）。保持这些向量归一化并且彼此成 90 度。您应该能够看到这三个向量足以表示任何相机位置和方向。

您可以使用这些向量将世界坐标转换为相机坐标：

*   按-位置翻译；
*   围绕（向上矢量“交叉”y轴）旋转-（向上矢量和y轴之间的角度）；
*   围绕向上矢量旋转 -（视图矢量和 z 轴之间的角度）。

（我可能在那里弄​​错了一些标志）。

您可以在用户移动鼠标时转换这些向量：

*   当鼠标侧向移动时，围绕向上矢量旋转视图矢量（或者如果您愿意，也可以围绕 y 轴旋转视图矢量和向上矢量）。
*   当鼠标向后/向前移动时，旋转视图向量和向上向量（视图向量“交叉”向上向量）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T13:02:26.610

对于您的问题，我并没有真正的解决方案，但我知道开源 3d 引擎[Irrlicht](http://irrlicht.sourceforge.net/)有一个 FPS 相机，它可以完全满足您的需求，而且通常它有一个有据可查的来源。

您可以尝试查看 FPS 相机是如何在 Irrlicht 中实现的，或者您甚至可以将 Irrlicht 本身用于您的项目；我在大学的时候把它用在了我的几个上，它总是很有魅力:)

# c# - In a .NET service application, where do I add the functions that it should perform?

> ID：479657
> 
> 赞同：0
> 
> 时间：2009-01-26T12:38:38.700
> 
> 标签：c#, .net, windows, windows-services, service

I know how to "create" a Service application.

I know what to write in the main() function.

I know how to add an EventLog (or other components) to the service.

I know how to define what happens when the service starts, stops or resumes.

What I want to know is this...

I want my Windows Service to perform certain function (like Indexing files).

Where do I add the code to perform this function in the Service application?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T12:47:01.197

我假设您想要定期运行的东西，而不是经常运行的东西。您可能需要考虑设置一个在到期时执行方法的计时器。计时器可以自动重置，或者您的回调可以在完成时重置计时器以使其下一次到期。您将在 OnStart 方法中初始化计时器。您需要小心在服务暂停或停止时停止计时器，并在关闭时清理内容。

您可能还需要考虑降低服务的优先级，以便它不会抢占系统上的前台任务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T12:44:14.273

My guess is that you'd want to index every X minutes, so you'd probably want to set a [Timer](http://msdn.microsoft.com/en-us/magazine/cc164015.aspx) in the Start event for the service, then perform your indexing when that timer fires.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T12:45:23.320

I am going to assume that by "indexer function" you are referring to a library function you have written that you wish to run by means of a windows service. If this is the case then add your code to this overriden method:

```
protected override void OnStart(String[] args)
{
    // your stuff here
} 
```

This code will fire when the service starts.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T12:46:38.530

我会说这取决于您的索引器功能应该何时运行。如果它应该在服务启动后立即开始运行，您将在 OnStart 方法中调用该函数。如果它是作为自定义事件的结果而启动的，那么您将在该事件的处理程序中调用它。如果需要在特定时间间隔后调用该函数，您可能需要使用 Timer。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T12:48:50.380

重复动作服务的简单示例，基于`System.Timers.Timer`：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.ServiceProcess;
using System.Text;
using System.Timers;

namespace SrvControl
{
public partial class Service1 : ServiceBase
{
    Timer mytimer;
    public Service1()
    {
        InitializeComponent();
    }

    protected override void OnStart(string[] args)
    {
        if (mytimer == null)
            mytimer = new Timer(5 * 1000.0);
        mytimer.Elapsed += new ElapsedEventHandler(mytimer_Elapsed);
        mytimer.Start();
    }

    void mytimer_Elapsed(object sender, ElapsedEventArgs e)
    {
        //Do Anything, e.g. write to eventlog
    }

    protected override void OnStop()
    {
        mytimer.Stop();
    }
}
} 
```

# apache - 如何让 Apache HTTP Server 2.2 和 IIS 5.1 在我的本地主机上工作？

> ID：479658
> 
> 赞同：0
> 
> 时间：2009-01-26T12:39:57.920
> 
> 标签：apache, iis, port

我认为最简单的方法就是更改 Apache 侦听的端口号，但在安装 IIS 后我仍然无法启动它。我的 IIS 目前在[http://localhost:80](http://localhost:80)正确地提供页面。我有几个 PHP 项目，以下是我的 httpd.conf 中如何配置端口的基础知识：

```
Listen 81

# Begin listening for virtual hosts.

NameVirtualHost *:81

<VirtualHost *:81>

# virtual.myvirtualdomain.com virtual host.

ServerAdmin webmaster@virtual.myvirtualdomain.com
DocumentRoot "c:/Development/HTTPServer_WWW/virtual.myvirtualdomain.com/www"
ServerName virtual.myvirtualdomain.com
ErrorLog "c:/Development/HTTPServer_WWW/virtual.myvirtualdomain.com/logs/log"

<Directory "c:/Development/HTTPServer_WWW/virtual.myvirtualdomain.com/www">
    Options Indexes FollowSymLinks
    AllowOverride All
    Order allow,deny
    Allow from all
</Directory>

</VirtualHost> 
```

然后在我的 Windows 主机文件中，我有一个这样的条目：

127.0.0.1 virtual.myvirtualdomain.com

我有几个这样的虚拟域设置，所有这些都在本地运行，用于我目前正在处理的众多 PHP 项目。这一切都在端口 80 上正常工作，但后来我安装了 IIS 5.1，服务不再启动。我做了一些研究，它们不能都在同一个端口上运行。我更改了它，因此 Apache 现在查看端口 81，但它仍然无法启动。

**编辑：**

所以，我卸载了 IIS，现在我仍然无法启动 Apache HTTP Server。我将所有设置改回端口 80，但仍然失败。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:56:49.807

停止服务，然后从命令行运行 Apache。它将向您显示启动过程中发生的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T15:18:00.300

我按照 Haarsma 的建议做了，结果发现我删除了一个虚拟目录，因此 Apache 找不到它（因此无法启动）。显然它与端口完全无关，这是我的愚蠢错误。我重新安装了 IIS，更改了我的 Apache 配置以侦听端口 81，它工作正常！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T12:51:53.683

*   停止 iis 服务器并查看 apache 是否启动。
*   在命令行中，运行：

    netstat -ano

这将告诉您哪个进程 ID 在哪个端口上运行。

*   禁用windows防火墙

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T13:45:44.400

这很奇怪！我的 IIS 6.0 和 Apache 2.2 在我的 Windows Server 2003 上正常工作。IIS 在端口 80 上，Apache 在端口 8081 上，这两个服务都设置为自动运行。

# windows - 如何过滤来自托管 DLL 的 Windows 消息

> ID：479661
> 
> 赞同：0
> 
> 时间：2009-01-26T12:41:31.207
> 
> 标签：windows, user-interface, winapi

如何获得独立于 UI 框架（WinForms、WPF、其他框架）的方式来过滤 Windows 消息？

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T12:49:39.770

Windows 消息依赖于框架*。*WPF 实际上试图将其隐藏起来，但它的大部分行为仍然取决于旧的 win32 消息循环。WinForms 也只是 win32 上的一个纸薄（而且非常不完整）的包装器。

[共享它们](http://msdn.microsoft.com/en-us/library/aa348549.aspx)的技术在编写通用过滤器函数并将其连接到所有不同的框架方面可能很有用。

请注意，随着框架与 win32 模型的距离越来越远，对拦截有意义的消息集变得越来越少。

# c++ - Include indirection on Visual C++

> ID：479668
> 
> 赞同：1
> 
> 时间：2009-01-26T12:43:28.490
> 
> 标签：c++, include, indirection

Let's say we have an application that will need Boost to compile. Boost being an external library, updated regularly, and our application having multiple binaries and multiple versions (*"multiple" as in "Let them grow and multiply"... don't ask...*), we need an easy to update/maintain indirection to have for each app's version link with the right Boost version.

For example:

*   MyApp 8.0 => Boost 1.34
*   MyApp 8.1 => Boost 1.35
*   MyApp 9.0 => Boost 1.35
*   MyApp 10.0 => Boost 1.37

On a Linux filesystem, we would create a symbolic link redirecting to the right boost directory:

*   MyApp 8.0 => MyAppBoostLink_8.0 => Boost 1.34
*   MyApp 8.1 => MyAppBoostLink_8.1 => Boost 1.35
*   MyApp 9.0 => MyAppBoostLink_9.0 => Boost 1.35
*   MyApp 10.0 => MyAppBoostLink_10.0 => Boost 1.37

This would enable us to easily update MyApp 10.0 to link with Boost 1.38 when it will be available, just by replacing the symbolic link.

But on Windows, this does not work (or I missed something).

Boost itself seems to give up on the idea: With BJam, I recall seeing warnings saying BJam was copying the lib files because symbolic links did not work on WinNT. I tried an alternative, as we use Visual C++, but no pragma resolves this problem (I searched for a pragma adding default search directories for header includes and library links, but found none).

I can't believe I'll need to launch a script to check-out the VCPROJs files (Visual C++ XML makefiles), to update the Boost includes, and then check-in the modifications, but I see no other solution until Windows have working symbolic links (or either I discover how to create them).

Is there a better idea?

## Edit

The problem disappeared when we updated our compiler, from Visual C++ 2003 to Visual C++ 2008\. Apparently, Visual C++ 2008 sees symbolic links across networks.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T12:49:07.620

在 NTFS 文件系统上等效的 Windows 符号链接称为连接：[http ://technet.microsoft.com/en-us/sysinternals/bb896768.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T12:56:06.793

您可以将 boost 安装的基本目录保存在特定于版本的环境变量中，该环境变量在 VS2008 的“启动批处理文件”中设置。这可能不像在构建过程中必须操作 .vcproj 文件那么难看。大概...

# installshield - 许可协议中的 InstallShield 超链接

> ID：479672
> 
> 赞同：0
> 
> 时间：2009-01-26T12:46:09.217
> 
> 标签：installshield

我在安装程序 Eula 文档（许可协议）中有一个“超链接”。问题是单击链接不会在 Web 浏览器中打开页面。我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T00:42:35.073

通过[http://blogs.msdn.com/robmen/archive/2006/05/30/610950.aspx](http://blogs.msdn.com/robmen/archive/2006/05/30/610950.aspx)

> RICHEDIT 控件不支持超链接。您可以将文本着色为蓝色并加下划线，但文本仍然不是可点击的超链接。
> 
> 本机 MSI UI 通常不支持超链接。悲伤但真实。

# image-capture - 狗仔队但在线（需要网络捕获工具）

> ID：479677
> 
> 赞同：0
> 
> 时间：2009-01-26T12:47:24.597
> 
> 标签：image-capture

我需要一个用于捕获整个网站并将其导出为 JPG 或 PNG 的网络服务。

我在我的 Mac 上使用 Paparazzi，但我有一个 linux 服务器，并且想在 linux 上使用它。

任何想法？你知道任何网络服务吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T13:25:08.030

[http://browsershots.org/](http://browsershots.org/)

这是你正在寻找的那种捕捉吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T13:33:38.763

在 linux 上，我将[screengrab 用于 firefox](http://www.screengrab.org/)。

在线您应该尝试[http://browsershots.org](http://browsershots.org)，它提供了来自许多不同浏览器的截图，当我必须在不同的 Web 浏览器上测试页面的外观时，我会使用它。

# jasper-reports - 如何在 JasperReports 中使用 XML 数据源创建子报表？

> ID：479678
> 
> 赞同：4
> 
> 时间：2009-01-26T12:47:56.593
> 
> 标签：jasper-reports, ireport

我正在使用*iReport ，我需要使用**XML DataSource*创建子报告。

我将只有一个用于孔报告的 XML。像这样的东西：

```
<question>
  <text>What do you think about SO?</text>
  <options>
    <option>Like it</option>
    <option>Really like it</option>
    <option>Love it</option>
  </options>
</question> 
```

主报告将详细链接到问题，每个问题都有很多选项。每个子报告都必须链接到问题的选项......嗯，主细节。

我可以通过谷歌搜索找到的所有内容都是使用*SQL*，我想使用*XPath*。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T12:53:17.377

查看[JRXmlDataSource JavaDoc](http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/data/JRXmlDataSource.html)。有例子说明它是如何完成的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-26T17:19:07.230

首先使用 xpath 将子报表创建为报表。然后在父报表中创建子报表元素并将子报表链接到父报表。下面是一个示例子报表元素：

```
<subreport>
    <reportElement x="0" y="20" width="555" height="100"/>
    <subreportParameter name="XML_DATE_PATTERN">
        <subreportParameterExpression><![CDATA[$P{XML_DATE_PATTERN}]]></subreportParameterExpression>
    </subreportParameter>
    <subreportParameter name="XML_DATA_DOCUMENT">
        <subreportParameterExpression><![CDATA[$P{XML_DATA_DOCUMENT}]]></subreportParameterExpression>
    </subreportParameter>
    <subreportParameter name="XML_LOCALE">
        <subreportParameterExpression><![CDATA[$P{XML_LOCALE}]]></subreportParameterExpression>
    </subreportParameter>
    <subreportParameter name="XML_NUMBER_PATTERN">
        <subreportParameterExpression><![CDATA[$P{XML_NUMBER_PATTERN}]]></subreportParameterExpression>
    </subreportParameter>
    <subreportParameter name="XML_TIME_ZONE">
        <expressionistic><![CDATA[$P{XML_TIME_ZONE}]]></subreportParameterExpression>
    </subreportParameter>
    <connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
    <subreportExpression class="java.lang.String"><![CDATA[$P{SUBREPORT_DIRECTORY} + "PS_Product_Match.jasper"]]></subreportExpression>
</subreport> 
```

# algorithm - 大小算法

> ID：479692
> 
> 赞同：3
> 
> 时间：2009-01-26T12:52:26.847
> 
> 标签：algorithm

好的，这是一个小问题，我很想得到一些帮助。

我有一个视图，视口大小会根据用户屏幕分辨率而有所不同。视口需要包含 N 个框，它们从右到左并排排列，并占据视口中的所有水平空间。现在，如果所有框的大小都相同，这将很容易，只需将视口宽度除以 N 即可。

问题是每个框都需要比其左侧的框小 10%，因此例如，如果视口是 271 像素宽并且有三个框，我将返回 [100, 90, 81]

所以我需要一种算法，当处理视口的宽度和水平框的数量时，将返回一个数组，其中包含每个框的宽度，以便填充视口的宽度并减少每个框的大小10%。

任何 OO 语言的答案都很酷。只是想获得一些关于如何解决这个问题的想法，也许看看谁能想出最优雅的解决方案。

问候，

克里斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T13:15:34.227

在 Python 中使用简单的几何级数，

```
def box_sizes(width, num_boxes) :
    first_box = width / (10 * (1 - 0.9**n))
    return [first_box * 0.9**i for i in range(n)]

>>> box_sizes(100, 5)
[24.419428096993972, 21.977485287294574, 19.779736758565118, 17.801763082708607, 16.021586774437747]
>>> sum(_)
100.00000000000001 
```

您可能想要整理精度，或转换为整数，但应该这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T13:01:02.727

这确实是一个数学问题。给出两个盒子：

x = 第一个框的大小 n = 框数 P = 像素数

然后

x + 0.9x = P

3：x + 0.9x + 0.81x = P
4：x + 0.9x + 0.81x + 0.729x = P

这实际上是一个几何级数，形式为：

S(n) = a + ar + ar ^n + ... + ar ^(n-1)

在哪里：

a = 第一个框的大小
r = 0.9
S(n) = P

S(n) = a(1-r ^n )/(1-r)

所以

x = 0.1P/( ^(1-0.9n) )

这（终于！）似乎是正确的并且可以解决任何（P，n）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-26T13:10:46.030

它被称为几何级数，并且有一篇关于它的[维基百科文章](http://en.wikipedia.org/wiki/Geometric_progression)。公式也在那里。~~我相信**cletus**在他的 f(n) 上犯了一个错误。~~已更正。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T13:11:33.313

```
Let:
x = size of the first box
n = number of boxes
P = number of pixels

n = 1: x = P
n = 2: x + .9x = P
n = 3: x + .9x + .81x = P

P = x sum[1..n](.9 ^ (n - 1))

Therefore:
x = P / sum[1..n](.9 ^ (n - 1))

Using the Geometric Progression formula:
x = P (.9 - 1) / ((.9 ^ n) - 1))

Test:
P = 100
n = 3
Gives:
x = 36.9 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T13:12:55.137

```
 public static int[] GetWidths(int width, int partsCount)
    {
        double q = 0.9;
        int[] result = new int[partsCount];

        double a = (width * (1 - q)) / (1 - Math.Pow(q, partsCount));

        result[0] = (int) Math.Round(a);
        int sum = result[0];

        for (int i = 1; i < partsCount - 1; i++)
        {
            result[i] = (int) Math.Round( a * Math.Pow(q, i) );
            sum += result[i];
        }

        result[partsCount - 1] = width - sum;

        return result;
    } 
```

因为它是[几何级数](http://en.wikipedia.org/wiki/Geometric_progression)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T13:03:47.013

从计算框宽度的总和开始，假设第一个框是 1，第二个框是 0.81，等等。您可以迭代地或从几何级数的公式中执行此操作。然后按（视口宽度）/（原始框宽度之和）比率缩放每个框。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T13:30:26.273

就像其他人提到的那样，盒子的宽度形成[几何级数](http://en.wikipedia.org/wiki/Geometric_progression)。给定视口宽度**W**和框数**N**，我们可以*直接求解*最宽框**X**的宽度。为了在视口中放置**N**个框，我们需要

> **X** + 0.9 **X** + 0.9^2 **X** + ... + 0.9^( **N** -1) **X** <= **W**
> 
> { 1 + 0.9 + 0.9^2 + ... + 0.9^( **N** -1) } **X** <= **W**

应用几何级数之和的公式给出

> (1 - 0.9^ **N** ) **X** / (1 - 0.9) <= **W**
> 
> **X** <= 0.1 **W** / (1 - 0.9^ **N** )

所以你有它，一个封闭形式的表达式，它给你最宽的盒子**X**的宽度。

# sql - 如何为矩阵中的列指定顺序？

> ID：479697
> 
> 赞同：25
> 
> 时间：2009-01-26T12:56:55.450
> 
> 标签：sql, visual-studio, reporting-services, matrix

我正在编写一个 SQL Reporting Services 报告（在 VS.Net 2005 中），它在矩阵中显示不同数据的计数。这些列对特定集合中的客户数量进行计数。所以我有几个这样的列：“1 个雇主”、“2-9 个雇主”、“10-19 个雇主”等等。

我遇到的问题是 SQL Reporting Services 按字母顺序对矩阵中的列进行排序。所以我最终在“1 个雇主”列之后但在“2-9”之前有一个“10-19”列。

有没有什么办法解决这一问题？或者可能是一种将列标签更改为正确排序的技巧？

谢谢。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2014-04-16T19:27:05.033

这也可以通过将新列添加到排序顺序的查询中来完成。然后右键单击矩阵中的列组并选择组属性。在左侧选择排序。从这里您可以指定另一列作为排序依据，而不是列标题。无需自定义公式。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-23T15:49:52.790

我们做了很多 SSRS 报告，这一直是 mdx 的问题。这是我们这样做的一种方法：

在*Grouping and Sorting Properties*中设置*Sorting*以按此表达式排序：

 *```
=iif(Fields!DataSetField.Value = "ColumnName", "zzz", Fields!DataSetField.Value) 
```

其中“zzz”可以是一个数字或任何您需要的帮助排序，然后根据此表达式选择*方向*作为升序或降序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-28T10:51:00.400

这可能有点令人费解，但我们遇到了类似的问题，无法更改 SQL。我们所做的是在数据集中创建一个计算字段，该字段为每列返回一个数字，并根据该数字对组进行排序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T13:40:56.203

我遇到了类似的问题，但没有及时找到使用矩阵的解决方案——所以我使用了一个表——并将所需的矩阵逻辑放在我的 SQL 语句中。这不是最好的事情，但它确实有效 - 它足够快，并且不需要那么长时间来编写。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-04T00:05:46.807

我进入了 MATRIX --> PROPERTIES --> GROUPS。然后，我“移动”了我希望它在列表中按 UP 排序的 GROUP。我去了预览版，效果很好。它甚至使我的列顺序保持不变。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-27T15:10:31.763

转到编辑组 - 排序 - 将表达式的方向更改为降序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-08T10:27:52.380

对于 Tablix 的不同数字顺序，请在表达式中使用以下代码行。

=RunningValue(CountDistinct("YourTableName"),Count,"YourTableName")

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-05-19T12:01:55.153

只需转到 tablix/Matrix 列组并右键单击组属性，然后转到排序并从排序中删除自动添加的记录。现在您的排序将基于您在数据集中添加的数据。

# .net - 使用 ASP.Net MVC 将图像上传到 SQL Server 2005？

> ID：479699
> 
> 赞同：3
> 
> 时间：2009-01-26T12:57:45.963
> 
> 标签：.net, sql, asp.net-mvc, database, image

我知道有一种方法可以将图像作为图像类型或 varbinary 类型上传到数据库，但是，我搜索了整整一周，我找不到任何可以帮助我的东西，所以这真的是我最后的手段，如果有人知道如何将图像上传到数据库，我使用的是 SQL Server 2005 Express。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T13:25:21.540

您应该能够访问请求的文件集合并为每个上传的文件获取一个 HttpPostedFile 实例。从文件中获取 InputStream 并将其读入列属性的字节数组中。我假设这是您的 DAL 将 varbinary 映射到您的业务类的方式——如果不是，则说它是本机图像，那么您需要在保存之前进行转换。下面的示例使用 LINQ2SQL。

```
MyClass obj = new MyClass();
obj.Name = Request["name"];   // other properties
obj.Alt = Request["altText"];

HttpPostedFile file = Request.Files[0];
if (file != null)
{
     obj.Image image = new byte[file.ContentLength];
     file.Read(obj.Image,0,file.ContentLength];
}

using (DataContext context = new DataContext())
{
    context.InsertOnSubmit( obj );
    context.SubmitChanges();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T13:12:03.983

如果您可以将图像存储为 VARCHAR，这里有一些代码可以做到这一点。

```
 String b64;
    using (System.IO.MemoryStream ms = new System.IO.MemoryStream())
    {
        this.pic.Image.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);
        Byte[] bytes = ms.ToArray();
        b64 = Convert.ToBase64String(bytes);
    }
    using (SqlConnection conn = new SqlConnection(ConnectionString))
    {
        using (SqlCommand cmd = new SqlCommand("UPDATE [settings] SET [value] = @val WHERE [id] = 2", conn))
        {
            conn.Open();
            cmd.Parameters.Add(new SqlParameter("@val", b64));
            cmd.ExecuteNonQuery();
            conn.Close();
        }
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T13:32:41.820

假设您有一个名为 TestProc 的存储过程，它接受一个名为 @data 且类型为 IMAGE 的单个参数，您的 C# 代码可能如下所示：

```
SqlConnection conn = new SqlConnection("<your connection string>");
conn.Open();

SqlCommand cmd = new SqlCommand("TestProc", conn);
cmd.CommandType = CommandType.StoredProcedure;

SqlParameter param = new SqlParameter("@data", SqlDbType.Image);
param.Value = System.IO.File.ReadAllBytes("any_file.jpg");
cmd.Parameters.Add(param);

cmd.ExecuteNonQuery(); 
```

如果您也想要存储过程代码，请告诉我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-29T06:39:06.537

查看[通过 ASP.Net MVC 从 SQL Server 下载和上传图像，](http://rusanu.com/2010/12/28/download-and-upload-images-from-sql-server-with-asp-net-mvc/)了解存储在 SQL Server BLOB 字段中的图像文件的高效流式传输示例。

# c# - 如何获得 DependancyProperty 的实际值？

> ID：479700
> 
> 赞同：1
> 
> 时间：2009-01-26T12:58:06.930
> 
> 标签：c#, wpf, user-interface, .net-3.5

我有一个小的 UserControl，它需要知道正在渲染它的控件的背景画笔。

但是，如果我查看 UserControl 的 Background 属性，它会返回 null。

如果我调用 GetValue(UserControl.BackgroundProperty) 它也返回 null 即使在 Visual 树上它肯定是被设置的。

似乎我必须遗漏一些非常明显的东西，因为要弄清楚控件的背景颜色并不难。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T13:12:48.493

在我看来，您的 UserControl 没有定义背景颜色 - null 表示透明，这就是父控件的背景完全可见的原因。

它仍然是父控件的背景颜色——您的控件没有自己的背景颜色这一事实并不意味着它采用父控件的颜色。您的控件的“背景”将简单地显示您的控件背后的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T15:48:04.747

背景属性不是从父级继承的，您必须自己设置。

# java - Java有缓冲区溢出吗？

> ID：479701
> 
> 赞同：102
> 
> 时间：2009-01-26T12:58:25.120
> 
> 标签：java, buffer-overflow, buffer-overrun

Java有缓冲区溢出吗？如果是，你能给我一些场景吗？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-01-26T13:10:01.603

由于 Java 字符串基于 char 数组并且 Java 会自动检查数组边界，因此缓冲区溢出仅在不寻常的情况下可能发生：

1.  如果通过 JNI 调用本机代码
2.  在 JVM 本身中（通常用 C++ 编写）
3.  解释器或 JIT 编译器无法正常工作（Java 字节码强制边界检查）

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-01-26T13:01:23.007

Java 和 C# 等托管语言不存在这些问题，但实际运行代码的特定虚拟机（JVM/CLR/等）可能存在这些问题。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-26T13:02:32.693

出于所有意图和目的，不。

Java 有数组[边界检查](http://en.wikipedia.org/wiki/Bounds_checking)，它将检查不能从分配的数组之外的区域访问数据。当尝试访问超出数组大小的区域时，[`ArrayOutOfBounds`](http://java.sun.com/javase/6/docs/api/java/lang/ArrayIndexOutOfBoundsException.html)将引发异常。

如果存在缓冲区溢出，它可能来自 Java 虚拟机中的错误，并且据我所知，这不是 Java 语言规范或 Java 虚拟机规范中所写的预期行为。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-26T13:03:11.287

是和不是。不，因为它是一个托管内存模型，所以您不能真正错误地创建自己的缓冲区溢出漏洞。但是，JVM 和 JDK 中可能存在缓冲区溢出漏洞。请参阅此 Secunia 咨询：

[http://secunia.com/advisories/25295](http://secunia.com/advisories/25295)

或者查看这些关于以前几个 JDK 和 JRE 漏洞的旧公告：

*   Java 运行时环境 (JRE)“unpack200”JAR 解包实用程序中的整数和缓冲区溢出漏洞可能导致权限升级[https://download.oracle.com/sunalerts/1020225.1.html](https://download.oracle.com/sunalerts/1020225.1.html)

    > Java 运行时环境 (JRE) 中的整数和缓冲区溢出漏洞，带有解包小程序和使用“unpack200”JAR 解包实用程序的 Java Web Start 应用程序可能允许不受信任的小程序或应用程序提升权限。例如，不受信任的小程序可能会授予自己读取和写入本地文件或执行运行不受信任的小程序的用户可访问的本地应用程序的权限。
    > 
    > Sun 衷心感谢“regenrecht”与 iDefense VCP ( [http://labs.idefense.com/vcp/](http://labs.idefense.com/vcp/) ) 和 Google 的 Chris Evans 将这些问题提请我们注意。

*   Sun Java Development Kit (JDK) 和 Java Runtime Environment (JRE) 中发现了多个漏洞。[https://security.gentoo.org/glsa/200705-23](https://security.gentoo.org/glsa/200705-23)

    > 富士通安全团队报告了一个涉及“不正确使用系统类”的未指定漏洞。此外，来自 Google 安全团队的 Chris Evans 报告了整数溢出，导致用于 JPG 或 BMP 文件的 ICC 解析器中的缓冲区溢出，以及在处理某些 BMP 文件时对 /dev/tty 的错误 open() 调用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-26T13:04:43.827

严格意义上的覆盖堆栈或堆本身的缓冲区溢出将需要：

1.  框架中的一个错误（这些在过去已经存在并且很可能再次出现）
2.  JNI 的使用（本质上不再使用托管代码）

从某种意义上说，缓冲区溢出是您的代码使用缓冲区并且您的代码负责正确解析它但没有这样做是可能的。例如，您可能编写了一个 XML 解析器，并且有人可能会向您提供格式错误（或合法但不常见）的请求，由于您的解析器的设计会用某些有效负载覆盖先前验证的数据，这会导致您的应用程序表现不佳。

后一种形式不太可能，但是一个广泛分布的写得不好的 sql 字符串清理函数存在这样的问题，这将是一个诱人的目标。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-26T13:08:46.643

Java（和 .Net）虚拟机捕获试图在保留内存之外写入的代码。不能正确处理此问题的应用程序仍会导致安全问题。例如，如果恶意用户可以通过输入无效输入来触发异常，他们可以进行拒绝服务攻击。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-26T13:05:39.800

正如已经指出的那样，Java 作为一种语言，对所有内存访问进行了边界检查，如果这里出现错误，则说明 JVM 有问题，而不是程序有问题。但是，需要注意的是，这与 Java 中的内存泄漏类似；虽然无法粉碎堆栈，但在错误位置出现的 ArrayOutOfBoundsException 未正确处理，仍可能最终会搞砸您的系统。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-26T13:24:37.907

如果您使用 Java Native Interace (JNI) 工具调用外部代码，并且外部代码存在可利用的问题，那么您可能会在 Java 程序中导致缓冲区溢出。这是相当少见的，因为大多数应用程序尽可能避免使用 JNI。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-26T13:36:48.443

一种方法可能会写入它不打算写入的数组的有效条目，通常是通过整数溢出。

例如，以下内容不足以检查边界：

```
/* !! WRONG !! */ 0 <= off && 0 <= len && off+len <= buff.length /* !! WRONG !! */ 
```

IIRC，`StringBuffer`曾经有过这样的错误，但你可以用它做任何有趣的事情。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-06-04T06:36:12.470

JAVA 的关键特性之一是安全性。用解释性语言编写的程序不容易受到缓冲区溢出漏洞的影响，但您总是可以在解释器本身中导致缓冲区溢出。虽然会很困难。类似地，Python 也是一种解释型语言，可以避免缓冲区溢出。

# c# - C# 中的 reinterpret_cast

> ID：479705
> 
> 赞同：9
> 
> 时间：2009-01-26T12:58:46.553
> 
> 标签：c#, arrays, casting

我正在寻找一种将 byte[] 类型的数组重新解释为不同类型的方法，比如 short[]。在 C++ 中，这可以通过简单的强制转换来实现，但在 C# 中，我还没有找到一种方法来实现这一点，而无需借助复制整个缓冲区。

有任何想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-26T13:21:55.103

你可以做到这一点，但这是一个相对糟糕的主意。像这样的原始内存访问不是类型安全的，只能在完全信任的安全环境下完成。您永远不应该在设计合理的托管应用程序中这样做。如果您的数据伪装成两种不同的形式，也许您实际上有两个独立的数据集？

无论如何，这是一个快速简单的代码片段来完成您的要求：

```
byte[] bytes = new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
int byteCount = bytes.Length;

unsafe
{
    // By using the fixed keyword, we fix the array in a static memory location.
    // Otherwise, the garbage collector might move it while we are still using it!
    fixed (byte* bytePointer = bytes)
    {
        short* shortPointer = (short*)bytePointer;

        for (int index = 0; index < byteCount / 2; index++)
        {
            Console.WriteLine("Short {0}: {1}", index, shortPointer[index]);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-12-14T01:07:06.790

这个问题有四个很好的答案。每个都有不同的缺点。当然，请注意字节顺序，并意识到所有这些答案都是类型系统中的漏洞，而不是特别危险的漏洞。简而言之，不要经常这样做，只有在你真正需要的时候才这样做。

1.  [桑德](https://stackoverflow.com/a/479767/4093018)的回答。使用不安全代码重新解释指针。这是最快的解决方案，但它使用了不安全的代码。并不总是一种选择。

2.  [列奥尼达斯](https://stackoverflow.com/a/480962/4093018)的回答。使用[`StructLayout`](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.structlayoutattribute.aspx)and[`FieldOffset(0)`](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.fieldoffsetattribute.aspx)将结构转换为联合。这样做的缺点是一些（罕见的）环境不支持 StructLayout（例如 Unity3D 中的 Flash 构建）并且 StructLayout 不能与泛型一起使用。

3.  [ljs](https://stackoverflow.com/a/479736/4093018)的回答。使用[`BitConverter`](http://msdn.microsoft.com/en-us/library/system.bitconverter.aspx)方法。这样做的缺点是大多数方法都会分配内存，这在低级代码中并不是很好。此外，没有一整套这些方法，因此您不能真正通用地使用它。

4.  [`Buffer.BlockCopy`](http://msdn.microsoft.com/en-us/library/system.buffer.blockcopy.aspx)两个不同类型的数组。唯一的缺点是您需要两个缓冲区，这在转换数组时非常完美，但在转换单个值时会很痛苦。请注意，长度以字节为单位，而不是元素。[`Buffer.ByteLength`](http://msdn.microsoft.com/en-us/library/system.buffer.bytelength.aspx)有帮助。此外，它仅适用于原语，如整数、浮点数和布尔值，而不适用于结构或枚举。

但是你可以用它做一些整洁的事情。

```
public static class Cast {

    private static class ThreadLocalType<T> {

        [ThreadStatic]
        private static T[] buffer;

        public static T[] Buffer
        {
            get
            {
                if (buffer == null) {
                    buffer = new T[1];
                }
                return buffer;
            }
        }
    }

    public static TTarget Reinterpret<TTarget, TSource>(TSource source)
    {
        TSource[] sourceBuffer = ThreadLocalType<TSource>.Buffer;
        TTarget[] targetBuffer = ThreadLocalType<TTarget>.Buffer;

        int sourceSize = Buffer.ByteLength(sourceBuffer);
        int destSize = Buffer.ByteLength(targetBuffer);
        if (sourceSize != destSize) {
            throw new ArgumentException("Cannot convert " + typeof(TSource).FullName + " to " + typeof(TTarget).FullName + ". Data types are of different sizes.");
        }

        sourceBuffer[0] = source;
        Buffer.BlockCopy(sourceBuffer, 0, targetBuffer, 0, sourceSize);
        return targetBuffer[0];
    }
}

class Program {
    static void Main(string[] args)
    {
        Console.WriteLine("Float: " + Cast.Reinterpret<int, float>(100));
        Console.ReadKey();
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T13:14:53.043

只要您愿意使用不安全的代码，c# 就支持这一点，但仅限于结构。

例如：（框架为您提供了此功能，但您可以将其扩展为 int <-> uint 转换

```
public unsafe long DoubleToLongBits(double d)
{
    return *((long*) (void*) &d);
} 
```

由于数组是引用类型，并且拥有关于其类型的自己的元数据，因此您无法在不覆盖实例上的元数据标头的情况下重新解释它们（操作可能会失败）。

您可以从 foo[] 获取 foo* 并将其转换为 bar* （通过上述技术）并使用它来迭代数组。这样做需要您在重新解释的指针使用的生命周期内固定原始数组。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T19:08:37.573

您可以将您的短裤/字节包装成一个允许您访问这两个值的结构：

另请参见：[C# 中的 C++ 联合](https://stackoverflow.com/questions/126781/c-union-in-c)

```
使用系统；
使用 System.Collections.Generic；
使用 System.Runtime.InteropServices；

命名空间 TestShortUnion {
    [StructLayout(LayoutKind.Explicit)]
    公共结构短字节{
        公共静态隐式运算符shortbyte（int输入）{
            如果（输入> short.MaxValue）
                throw new ArgumentOutOfRangeException("input", "shortbyte 只接受短范围内的值");
            返回新的短字节（（短）输入）；
        }

        公共短字节（字节输入）{
            短值 = 0;
            字节值 = 输入；
        }

        公共短字节（短输入）{
            字节值 = 0;
            短值 = 输入；
        }

        [FieldOffset(0)]
        公共字节byteval；
        [FieldOffset(0)]
        公共短线；
    }

    类程序{
        静态无效主要（字符串[] args）{
            短字节[] testarray = 新短字节[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1111 };

            foreach（testarray 中的短字节单值）{
                Console.WriteLine("Byte {0}: Short {1}", singleval.byteval, singleval.shortval);
            }

            System.Console.ReadLine();
        }
    }
}

```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-07-23T21:45:36.973

您可以使用[System.Memory](https://www.nuget.org/packages/System.Memory/)以安全的方式执行此操作。

```
public static TTo[] Cast<TFrom, TTo>(this TFrom[] source) where TTo : struct where TFrom : struct => 
  MemoryMarshal.Cast<TFrom, TTo>(source).ToArray();

private byte[] CastToBytes(int[] foo) => foo.Cast<int, byte>(foo); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T13:09:36.970

这种行为会导致 C# 相当不安全。但是，您可以轻松地以类型安全的方式实现这一点（当然，这样做是在复制数组）。

如果您希望一个字节映射到一个短字节，那么使用 ConvertAll 很简单，例如：-

```
short[] shorts = Array.ConvertAll(bytes, b => (short)b); 
```

如果您只想将每 2 个字节映射到一个短字节，那么以下应该可以工作：-

```
if (bytes.Length % 2 != 0)
{
    throw new ArgumentException("Byte array must have even rank.");
}

short[] shorts = new short[bytes.Length / 2];
for (int i = 0; i < bytes.Length / 2; ++i)
{
    shorts[i] = BitConverter.ToInt16(bytes, 2*i);
} 
```

可以使用编组器进行一些奇怪的位旋转来实现这一点，可能使用不安全的 { ... } 代码块，尽管这很容易出错并使您的代码无法验证。

我怀疑使用类型安全的习语而不是类型不安全的 C/C++ 习语可以更好地实现您想要做的事情！

**更新**：更新以考虑评论。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T13:04:33.390

像这样的转换从根本上来说是不安全的，并且在托管语言中是不允许的。这也是 C# 不支持联合的原因。是的，解决方法是使用 Marshal 类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T16:16:05.313

难道不能创建一个实现字节和短裤接口的集合类吗？也许同时实现 IList< byte > 和 IList< short >？然后你可以让你的底层集合包含字节，但实现 IList<short> 函数，该函数适用于字节对。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-14T23:53:48.140

我使用[FastArraySerializer](https://gist.github.com/OmerMor/1050703)中的代码创建了一个类型转换器以从 SByte[] 到 Double[]

```
public unsafe class ConvertArrayType
{
    [StructLayout(LayoutKind.Explicit)]
    private struct Union
    {
        [FieldOffset(0)] public sbyte[] sbytes;
        [FieldOffset(0)] public double[] doubles;
    }

    private Union _union; 
    public double[] doubles {
        get { return _union.doubles; }
    }
    public sbyte[] sbytes
    {
        get { return _union.sbytes; }
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    private struct ArrayHeader
    {
        public UIntPtr type;
        public UIntPtr length;
    }

    private readonly UIntPtr SBYTE_ARRAY_TYPE;
    private readonly UIntPtr DOUBLE_ARRAY_TYPE;

    public ConvertArrayType(Array ary, Type newType)
    {
        fixed (void* pBytes = new sbyte[1])
        fixed (void* pDoubles = new double[1])
        {
            SBYTE_ARRAY_TYPE = getHeader(pBytes)->type;
            DOUBLE_ARRAY_TYPE = getHeader(pDoubles)->type;
        }
        Type typAry = ary.GetType();
        if (typAry == newType)
            throw new Exception("No Type change specified");
        if (!(typAry == typeof(SByte[]) || typAry == typeof(double[])))
            throw new Exception("Type Not supported");

        if (newType == typeof(Double[]))
        {
            ConvertToArrayDbl((SByte[])ary);
        }
        else if (newType == typeof(SByte[]))
        {
            ConvertToArraySByte((Double[])ary);
        }
        else
        {
            throw new Exception("Type Not supported");
        }
    }

    private void ConvertToArraySByte(double[] ary)
    {
        _union = new Union { doubles = ary };
        toArySByte(_union.doubles);
    }
    private void ConvertToArrayDbl(sbyte[] ary)
    {
        _union = new Union { sbytes = ary };
        toAryDouble(_union.sbytes);
    }

    private ArrayHeader* getHeader(void* pBytes)
    {
        return (ArrayHeader*)pBytes - 1;
    }

    private void toAryDouble(sbyte[] ary)
    {
        fixed (void* pArray = ary)
        {
            var pHeader = getHeader(pArray);
            pHeader->type = DOUBLE_ARRAY_TYPE;
            pHeader->length = (UIntPtr)(ary.Length / sizeof(double));
        }
    }

    private void toArySByte(double[] ary)
    {
        fixed (void* pArray = ary)
        {
            var pHeader = getHeader(pArray);
            pHeader->type = SBYTE_ARRAY_TYPE;
            pHeader->length = (UIntPtr)(ary.Length * sizeof(double));
        }
    }
} // ConvertArrayType{} 
```

这是VB的用法：

```
Dim adDataYgch As Double() = Nothing
Try
    Dim nGch As GCHandle = GetGch(myTag)
    If GCHandle.ToIntPtr(nGch) <> IntPtr.Zero AndAlso nGch.IsAllocated Then
        Dim asb As SByte()
        asb = CType(nGch.Target, SByte())
        Dim cvt As New ConvertArrayType(asb, GetType(Double()))
        adDataYgch = cvt.doubles
    End If
Catch ex As Exception
    Debug.WriteLine(ex.ToString)
End Try 
```

# c# - 获取十进制数的整数部分的最佳方法

> ID：479706
> 
> 赞同：99
> 
> 时间：2009-01-26T12:59:52.200
> 
> 标签：c#, .net, decimal, int

返回小数的整数部分（在c＃中）的最佳方法是什么？（这必须适用于可能不适合 int 的非常大的数字）。

```
GetIntPart(343564564.4342) >> 343564564
GetIntPart(-323489.32) >> -323489
GetIntPart(324) >> 324 
```

这样做的目的是：我正在插入数据库中的十进制 (30,4) 字段，并希望确保我不会尝试插入一个对于该字段来说太长的数字。确定小数的整数部分的长度是此操作的一部分。

* * *

## 回答 #1

> 赞同：228
> 
> 时间：2009-01-26T13:03:16.263

顺便说一句， (int)Decimal.MaxValue 会溢出。您无法获得小数的“int”部分，因为小数太大而无法放入 int 框中。刚刚检查过......它甚至太大了（Int64）。

如果您希望 Decimal 值的位位于点的左侧，则需要执行以下操作：

```
Math.Truncate(number) 
```

并将值返回为... DECIMAL 或 DOUBLE。

*编辑：截断绝对是正确的功能！*

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-26T13:32:05.880

我认为[System.Math.Truncate](http://msdn.microsoft.com/en-us/library/c2eabd70.aspx)是您正在寻找的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T13:26:10.960

取决于你在做什么。

例如：

```
//bankers' rounding - midpoint goes to nearest even
GetIntPart(2.5) >> 2
GetIntPart(5.5) >> 6
GetIntPart(-6.5) >> -6 
```

或者

```
//arithmetic rounding - midpoint goes away from zero
GetIntPart(2.5) >> 3
GetIntPart(5.5) >> 6
GetIntPart(-6.5) >> -7 
```

默认值始终是前者，这可能会让人感到意外，但[也很有意义](http://bizvprog.blogspot.com/2008/01/computers-didnt-learn-rounding-at.html)。

您的明确演员将做：

```
int intPart = (int)343564564.5
// intPart will be 343564564

int intPart = (int)343564565.5
// intPart will be 343564566 
```

从你提出问题的方式来看，这听起来不是你想要的——你每次都想把它说出来。

我会做：

```
Math.Floor(Math.Abs(number)); 
```

还要检查你的尺寸`decimal`- 它们可能很大，所以你可能需要使用`long`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T13:03:21.833

你只需要转换它，如下所示：

```
int intPart = (int)343564564.4342 
```

如果您仍想在以后的计算中将其用作小数，那么 Math.Truncate （或者如果您想要负数的某种行为，则可能是 Math.Floor）是您想要的函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-17T12:37:07.427

分离值及其小数部分值的非常简单的方法。

```
double  d = 3.5;
int i = (int)d;
string s = d.ToString();
s = s.Replace(i + ".", ""); 
```

s 是小数部分 = 5，
i 是整数值 = 3

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-24T07:44:40.007

我希望能帮助你。

```
/// <summary>
/// Get the integer part of any decimal number passed trough a string 
/// </summary>
/// <param name="decimalNumber">String passed</param>
/// <returns>teh integer part , 0 in case of error</returns>
private int GetIntPart(String decimalNumber)
{
    if(!Decimal.TryParse(decimalNumber, NumberStyles.Any , new CultureInfo("en-US"), out decimal dn))
    {
        MessageBox.Show("String " + decimalNumber + " is not in corret format", "GetIntPart", MessageBoxButtons.OK, MessageBoxIcon.Error);
        return default(int);
    } 

    return Convert.ToInt32(Decimal.Truncate(dn));
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2017-05-09T14:49:48.537

```
 Public Function getWholeNumber(number As Decimal) As Integer
    Dim round = Math.Round(number, 0)
    If round > number Then
        Return round - 1
    Else
        Return round
    End If
End Function 
```

# javascript - 正则表达式匹配第一个 '?' 之前的所有 '&'

> ID：479716
> 
> 赞同：0
> 
> 时间：2009-01-26T13:03:13.190
> 
> 标签：javascript, regex

基本上，我想做“zipzam&&&?&&&?&&&”->“zipzam%26%26%26?&&&?&&&”。我可以在没有正则表达式的情况下以许多不同的方式做到这一点，但如果我能用正则表达式来做的话，它会稍微清理一下。

谢谢

编辑： "zip=zam&&&=?&&&?&&&" -> "zip=zam%26%26%26=?&&&?&&&" 应该让事情更清楚一些。

编辑： "zip=zam=&=&=&=?&&&?&&&" -> "zip=zam=%26=%26=%26=?&&&?&&&" 应该让事情更清楚。

然而，这些只是例子。我仍然想在第一个 '?' 之前替换*所有*'&' 无论第一个“？”之前的“&”在哪里 并且无论'&'是否连续。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T13:31:19.703

这应该这样做：

```
"zip=zam=&=&=&=?&&&?&&&".replace(/^[^?]+/, function(match) { return match.replace(/&/g, "%26"); }); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T13:26:23.893

您需要在 JS 中难以复制的负面lookbehinds，但幸运的是有一些方法和手段：

```
var x = "zipzam&&&?&&&?&&&";

x.replace(/(&+)(?=.*?\?)/,function ($1) {for(var i=$1.length, s='';i;i--){s+='%26';} return s;}) 
```

评论：这行得通，因为它*不是*全球性的。因此，第一个匹配是给定的，并且使用“%26”替换所有匹配的“&”字符 1:1 的技巧是通过函数循环实现的

* * *

编辑：只需稍作修改即可简单地（如果可能有点笨拙）实现“&”未知分组的解决方案。替换方法的基本模式是无限灵活的。

```
var x = "zipzam&foo&bar&baz?&&&?&&&";

var f = function ($1,$2)
{
  return $2 + ($2=='' || $2.indexOf('?')>-1 ? '&' : '%26')
}

x.replace(/(.*?)&(?=.*?\?)/g,f) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:17:54.847

这应该这样做：

```
^[^?]*&[^?]*\? 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T13:20:00.553

在这种情况下，正则表达式确实不是最适合使用的东西。简单搜索“？”的第一个索引 然后替换每个 '&' 字符将是最好的。但是，如果您真的想要一个正则表达式，那么这应该可以完成工作。

```
(?:.*?(&))*?\? 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T13:23:56.393

或者这个，我认为：

```
^[^?]*(&+?)\? 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T13:28:03.967

这与您所追求的足够接近：-

```
alert("zipzam&&&?&&&?&&&".replace(/^([^&\?]*)(&*)\?/, function(s, p, m)
{
for (var i = 0; i < m.length; i++) p += '%26';
return  p +'?';
})); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T13:36:33.937

由于 OP 只想在第一个问号之前匹配 & 符号，稍微修改 Michael Borgwardt 的回答给了我这个看起来合适的正则表达式：

```
^[^?&]*(\&+)\? 
```

用“%26”替换所有匹配项

这将不匹配**zipzam&&abc?&&&?&&&**因为第一个“？” 前面没有 & 符号。

# php - PHP $_POST 函数中缺少参数

> ID：479718
> 
> 赞同：0
> 
> 时间：2009-01-26T13:03:16.407
> 
> 标签：php, codeigniter

我正在使用 CodeIgniter 通过`$_POST`请求将一些参数传递给我的 PHP 页面，并且在我正在阅读的 PHP 页面中。

```
$foo = $this->input->post('myParam'); 
```

如果`myParam`参数存在于`$_POST`请求中，`$foo`则将被赋值`myParam`。如何检查请求 中`myParam`是否**未通过？**`$_POST`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T13:08:49.297

我用谷歌搜索了“codeigniter 输入帖子”。

第一个结果是[这样](http://codeigniter.com/user_guide/libraries/input.html)。

从该文件中：

> ```
> $this->input->post('some_data'); 
> ```
> 
> 如果您尝试检索的项目不存在，该函数将返回 FALSE（布尔值）。

所以你需要这样做：

```
if ($foo===false) {
   // do something if it's not set
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T12:19:40.090

我认为最好的方法是使用表单验证类对您的数据进行预处理。这[在此处](http://codeigniter.com/user_guide/libraries/form_validation.html)记录。

你会做这样的事情：

```
function index()
{
    $this->load->helper(array('form', 'url'));
    $this->load->library('form_validation');

    $this->form_validation->set_rules('myParam', 'myParam', 'required');
            if ($this->form_validation->run() == FALSE)
    {
        $this->load->view('myform');
    }
    else
    {
        $this->load->view('formsuccess');
    }
} 
```

如果您的验证失败，它会将您发送回表单，并且您必须用数据重新填充它，有一种方法可以做到这一点（请参阅文档）。如果它通过了，那么您可以确定它`$this->input->post('myParam');`会返回一个值。

# c++ - 如何在 C++ 中获取当前的 CPU 和 RAM 使用情况？

> ID：479722
> 
> 赞同：29
> 
> 时间：2009-01-26T13:03:40.600
> 
> 标签：c++, cpu-usage, ram

是否有可能在 C++ 中获得当前的 RAM 和 CPU 使用率？是否有独立于平台的函数调用？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-26T13:17:40.697

遗憾的是，这些东西严重依赖底层操作系统，因此没有独立于平台的调用。（也许有一些包装框架，但我不知道。）

在 Linux 上，您可以查看[getrusage()](http://linux.die.net/man/2/getrusage)函数调用，在 Windows 上，您可以使用[GetProcessMemoryInfo()](http://msdn.microsoft.com/en-us/library/ms683219.aspx)来查看 RAM 使用情况。还可以查看Windows的[Process Status API中的其他功能。](http://msdn.microsoft.com/en-us/library/ms684884(VS.85).aspx)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-26T13:50:57.387

据我所知，没有一个独立于平台的功能。如果您计划针对多个版本的 Windows，请注意某些版本的实现不同。例如，在 NT 3.51 下测试应用程序时，我遇到了这个问题......（我知道这是过时的）。

这是我用于内存方面的一些代码。这在 Windows 以外的平台上不起作用，并且在没有 WIN32 定义的情况下编译时只会返回 0：

编辑：我忘了提，这段代码划分并向下舍入到最接近的 MB，因此到处都是 >> 20。

```
// get memory info...
int getTotalRAM()
{
    int ret = 0;
#ifdef WIN32
    DWORD v = GetVersion();
    DWORD major =  (DWORD)(LOBYTE(LOWORD(v)));
    DWORD minor =  (DWORD)(HIBYTE(LOWORD(v)));
    DWORD build;
    if (v < 0x80000000) build = (DWORD)(HIWORD(v));
    else build = 0;

    // because compiler static links the function...
    BOOL (__stdcall*GMSEx)(LPMEMORYSTATUSEX) = 0;

    HINSTANCE hIL = LoadLibrary(L"kernel32.dll");
    GMSEx = (BOOL(__stdcall*)(LPMEMORYSTATUSEX))GetProcAddress(hIL, "GlobalMemoryStatusEx");

    if(GMSEx)
    {
        MEMORYSTATUSEX m;
        m.dwLength = sizeof(m);
        if(GMSEx(&m))
        {
            ret = (int)(m.ullTotalPhys>>20);
        }
    }
    else
    {
        MEMORYSTATUS m;
        m.dwLength = sizeof(m);
        GlobalMemoryStatus(&m);
        ret = (int)(m.dwTotalPhys>>20);
    }
#endif
    return ret;
}

int getAvailRAM()
{
    int ret = 0;
#ifdef WIN32
    DWORD v = GetVersion();
    DWORD major =  (DWORD)(LOBYTE(LOWORD(v)));
    DWORD minor =  (DWORD)(HIBYTE(LOWORD(v)));
    DWORD build;
    if (v < 0x80000000) build = (DWORD)(HIWORD(v));
    else build = 0;

    // because compiler static links the function...
    BOOL (__stdcall*GMSEx)(LPMEMORYSTATUSEX) = 0;

    HINSTANCE hIL = LoadLibrary(L"kernel32.dll");
    GMSEx = (BOOL(__stdcall*)(LPMEMORYSTATUSEX))GetProcAddress(hIL, "GlobalMemoryStatusEx");

    if(GMSEx)
    {
        MEMORYSTATUSEX m;
        m.dwLength = sizeof(m);
        if(GMSEx(&m))
        {
            ret = (int)(m.ullAvailPhys>>20);
        }
    }
    else
    {
        MEMORYSTATUS m;
        m.dwLength = sizeof(m);
        GlobalMemoryStatus(&m);
        ret = (int)(m.dwAvailPhys>>20);
    }
#endif
    return ret;
}

int getTotalMemory()
{
    int ret = 0;
#ifdef WIN32
    DWORD v = GetVersion();
    DWORD major =  (DWORD)(LOBYTE(LOWORD(v)));
    DWORD minor =  (DWORD)(HIBYTE(LOWORD(v)));
    DWORD build;
    if (v < 0x80000000) build = (DWORD)(HIWORD(v));
    else build = 0;

    // because compiler static links the function...
    BOOL (__stdcall*GMSEx)(LPMEMORYSTATUSEX) = 0;

    HINSTANCE hIL = LoadLibrary(L"kernel32.dll");
    GMSEx = (BOOL(__stdcall*)(LPMEMORYSTATUSEX))GetProcAddress(hIL, "GlobalMemoryStatusEx");

    if(GMSEx)
    {
        MEMORYSTATUSEX m;
        m.dwLength = sizeof(m);
        if(GMSEx(&m))
        {
            ret = (int)(m.ullTotalPhys>>20) + (int)(m.ullTotalVirtual>>20);
        }
    }
    else
    {
        MEMORYSTATUS m;
        m.dwLength = sizeof(m);
        GlobalMemoryStatus(&m);
        ret = (int)(m.dwTotalPhys>>20) + (int)(m.dwTotalVirtual>>20);
    }
#endif
    return ret;
}

int getAvailMemory()
{
    int ret = 0;
#ifdef WIN32
    DWORD v = GetVersion();
    DWORD major =  (DWORD)(LOBYTE(LOWORD(v)));
    DWORD minor =  (DWORD)(HIBYTE(LOWORD(v)));
    DWORD build;
    if (v < 0x80000000) build = (DWORD)(HIWORD(v));
    else build = 0;

    // because compiler static links the function...
    BOOL (__stdcall*GMSEx)(LPMEMORYSTATUSEX) = 0;

    HINSTANCE hIL = LoadLibrary(L"kernel32.dll");
    GMSEx = (BOOL(__stdcall*)(LPMEMORYSTATUSEX))GetProcAddress(hIL, "GlobalMemoryStatusEx");

    if(GMSEx)
    {
        MEMORYSTATUSEX m;
        m.dwLength = sizeof(m);
        if(GMSEx(&m))
        {
            ret = (int)(m.ullAvailPhys>>20) + (int)(m.ullAvailVirtual>>20);
        }
    }
    else
    {
        MEMORYSTATUS m;
        m.dwLength = sizeof(m);
        GlobalMemoryStatus(&m);
        ret = (int)(m.dwAvailPhys>>20) + (int)(m.dwAvailVirtual>>20);
    }
#endif
    return ret;
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-28T08:40:02.240

有一个开源库可以跨许多平台提供这些（以及更多系统信息）：[SIGAR API](https://github.com/hyperic/sigar)

我在相当大的项目中使用过它并且效果很好（除了 OS X 上的某些极端情况等）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-26T13:13:17.040

不，没有，不在标准中。

如果您确实需要此信息，则必须编写特定于平台的#ifdefs 或链接到提供它的库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-05T04:59:10.547

在 Linux 上，这将使用 /proc/self/status 。需要做更多的工作才能把它变成一个数字。我发现这很有用，只是将内存使用情况作为字符串直接打印到屏幕上。

```
static string memory_usage() {
        ostringstream mem;
        PP("hi");
        ifstream proc("/proc/self/status");
        string s;
        while(getline(proc, s), !proc.fail()) {
                if(s.substr(0, 6) == "VmSize") {
                        mem << s;
                        return mem.str();
                }
        }
        return mem.str();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T08:55:27.917

没有平台独立的方式来做到这一点。虽然对于 Windows，您可以通过在代码中使用 PDH.dll（Performance Data Helper）及其相关 API 来获取 CPU 使用率和性能指标。

[这里有更多关于如何使用它的信息。](http://www.codeproject.com/kb/system/cpuusageByDudiAvramov.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T16:41:11.690

不是直接的。

但是您可以使用抽象操作系统的库（例如 ACE）。
尽管如果您只需要 CPU 和内存，这可能会有点重。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-05T10:52:06.347

如果还是这样，请检查：

[http://sourceforge.net/projects/cpp-cpu-monitor/](http://sourceforge.net/projects/cpp-cpu-monitor/)

它为您提供了如何获取 Linux 的 CPU 和 RAM 使用率的示例（在 Debian 和 CentOS 上测试）以及如何安装的非常简单的说明。

如果您对这个小项目有任何疑问，请随时询问。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-03-05T12:01:38.173

我注意到[ACE](http://www.dre.vanderbilt.edu/~schmidt/ACE.html)已移植到[vcpkg](https://github.com/Microsoft/vcpkg)，这将使编译和链接跨平台 C++ 应用程序变得容易。

在 C++ 中，我想监视可用的系统 CPU 和内存资源，以便我的应用程序可以根据资源可用性调整其消耗。

有没有人可以提供一个 ACE 代码片段来开始这个？

# c# - 如何将 ListBox 项绑定到用户控件？

> ID：479737
> 
> 赞同：8
> 
> 时间：2009-01-26T13:09:51.633
> 
> 标签：c#, .net, wpf, wpf-controls

人们经常使用类似的东西：

```
<ListBox ItemsSource="{Binding ElementName=thisControl, Path=ListIndexes}">
<ListBox.ItemTemplate>
<DataTemplate>
<StackPanel>
<Label Content="{Binding Path=IndexName}"/>
<Label Content="{Binding Path=IndexValue}"/>
</StackPanel>
</DataTemplate>
</ListBox.ItemTemplate>
</ListBox> 
```

但我想使用一个控件而不是标签，如下所示：

```
<ListBox ItemsSource="{Binding ElementName=thisControl, Path=ListIndexes}">
<ListBox.ItemTemplate>
<DataTemplate>
<local:Index Item="**{Binding}**"/>
</DataTemplate>
</ListBox.ItemTemplate>
</ListBox> 
```

我的疑问是在这个 Binding 中加入什么来包含集合中的整个项目。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-26T13:11:48.087

其语法是：

```
<local:Index Item="{Binding}"/> 
```

这将告诉数据绑定函数将每个 ListBox 项的整个数据上下文绑定到 Index 控件中的 Item 属性

# project-management - 对于不断变化的需求，您如何管理客户？

> ID：479739
> 
> 赞同：8
> 
> 时间：2009-01-26T13:10:40.367
> 
> 标签：project-management, requirements, change-management

[尽管Steve Yegge 很有智慧](http://steve-yegge.blogspot.com/2008/08/business-requirements-are-bullshit.html)，但大多数开发人员都面临着从非技术客户那里收集到的需求。有时有项目经理与客户打交道并翻译他们的要求，有时则没有。无论如何，需求将发生变化的事实是不可避免的。

构成“良好编程实践”的大部分内容都与[开发适应性强的系统](https://stackoverflow.com/questions/466081/adapting-to-meet-changing-business-requirements)有关，以便它们能够承受不断变化的需求。YAGNI、DRY、松散耦合等原则促成了这一点。诸如敏捷之类的迭代开发过程也试图解决试图击中移动目标的问题，当然，拥有一个正在测试的系统使得进行更改变得更加可行。

尽管如此，对于我们中的许多人来说，不断变化的需求似乎不仅[会损害我们的软件质量](https://stackoverflow.com/questions/162367/what-hurts-the-quality-of-your-code-most)，而且还会[消耗我们的动力](https://stackoverflow.com/questions/71199/what-makes-you-lose-motivation)，让我们想要刺伤某人。

这个问题是关于如何**管理客户**，使他们能够以他们需要的方式改变他们的需求，同时阻止随意或轻率的改变。你怎么做呢？

*   您是否有项目经理将开发人员与客户隔离开来？
*   您有正式的变更管理流程吗？更换经理？
*   客户在真正需要时获得更改有多难？
*   相反，当“轻率”时，客户获得更改有多容易？
*   在解释变更成本时，您向客户提供了多少细节？
*   在收到更改请求后，您能多快向客户提供此信息？
*   哪些因素会破坏流程（例如[无法对客户说不的 PM？](https://stackoverflow.com/questions/463512/telling-a-project-manager-no)）
*   **什么对你有用？**

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-26T13:36:12.767

如果您正在寻找客户永远不会改变主意的理想世界，或者您获得了理想的规格，**那么您就错了**。话虽如此，我发现管理客户期望和变更请求的最有效机制是建立一个准确的测量系统。

这就是我管理团队的方式：

1）我们从用户故事开始。客户参与编写它们，开发团队以相对的方式估计每个用户故事需要多长时间。

2）利用以前的经验，我采用这些相对估计（故事点），并为项目的主要里程碑何时完成制定一个粗略的时间表。

3) 在这些里程碑中，我们运行 2 周的迭代。客户参与设置批准标准以及故事是否已被批准。一个简单的燃尽图向客户展示了我们离实现发布目标有多近。

4) 在审批过程中，客户通常会要求更改，因为该功能没有达到他的预期（即使它符合他最初的审批标准）。此时，您会生成一个带有新估计的新故事。您还可以适当调整里程碑日期。然后将球放回客户场地：

*   他们经常意识到他们的变更请求不值得（他们必须得到老板的批准），我们会取消新功能
*   有时它很重要，所以我们会推迟截止日期以获取该功能
*   最后，总是可以选择杀死另一个不那么重要的功能，这将花费相同的时间。

关键不是逃避变更请求，而是要确定每个变更请求都会对产品产生影响。没有*免费的午餐。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T13:18:46.827

我作为独立开发人员工作，因此直接与客户联系。大多数时候他们不知道自己真正想要什么，这很正常。所以我们慢慢开始，我很早就给他们原型让他们玩，然后逐渐做出改变。如果我认为客户想要“轻率”的更改，那么我会告诉他这种更改不起作用或不需要。如果是 5 分钟的工作，那么我什至可能会这样做。

它有助于稍后在合同中添加一些维护条款，以便为稍后出现的那些小改动获得资金。对于较大的更改，您只需按小时收费。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T14:47:09.597

管理客户很困难，而且很容易出错。

我发现你需要尽早**获得客户的信任**。对我来说，我认为您可以通过以下方式做到这一点：

*   要求客户任命一名**产品经理**——他/她的思维清晰，可以传达他/她想要的要求，并希望与他/她建立牢固的工作关系。
*   **真正尝试了解他们的业务**——您不需要成为领域专家，但您需要知道客户来自哪里。
*   问他们想要什么的相关问题——**不要假设他们（起初）要求的是他们真正想要**的。
*   首先**欢迎所有的变化**。这不是客户烦人和善变，而是一个更好地了解客户真正想要什么的机会。如果这会花费您时间/金钱，那么您可能需要接受它作为**损失领导者**。
*   **尽早交付原型**，并尽可能多地纳入客户反馈。
*   给客户**一个踢屁股的产品**。

一旦你做到了这一点，并且客户信任你，那么你就可以开始拒绝不合理的更改，或者为以前被认为超出范围的事情要求额外的付款/时间。

当然，你不可能与每个客户都建立这种关系，有些*是白痴（在这种情况下，看看你是否可以任命不同的产品经理），但**你*应该尽可能多地建立一个有效的工作关系。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T14:22:39.350

你不能指望客户一开始就知道他们想要什么，所以你必须适应。但你也需要为了改变而停止改变。

**这是针对“内部”客户的。**

我发现与客户讨价还价是一种有效的方法。如果他们等待，或者牺牲一些其他（尚未实现的）功能，他们可以拥有他们想要的任何功能。这迫使他们考虑他们所要求的改变相对于整个系统的价值。

有时这很有效，并且达成了很好的妥协。其他时候，顾客把他们的玩具从婴儿车里扔了出去，不管他们为了实现这个功能而必须走多高，质量都会降低。

如果客户付款，那就是另一场比赛了。需要让他们意识到变更成本，并且成本会随着产品接近完成而增加。这意味着您必须对您将交付的内容进行大量前期分析，并确保就规范达成一致。因此，您可以衡量发生了什么变化。对于任何一方来说，这可能都不是最有效的解决方案，但它确实可以让事情变得干脆利落。所以他们不会不满意，你也不会最终免费做大量的工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T14:36:25.750

在软件工程中，变化只是一个事实。它会发生。对我们来说，一切都是有代价的。我们几乎会做出客户想要的任何改变，但总会有时间估算和与之相关的成本。我们是否曾经告诉客户不 - 通常不是，但有时更改请求的成本非常高。我们确实在潜在的安全威胁等方面划清界限，在这种情况下，我们会冷静地向他们解释我们无法满足该请求。

我们向客户解释了多少，我们解释了资金将分配到哪里，用于开发，用于分析等等。我们没有明确地告诉他们为什么某些东西会以这种方式收费。现在我承认，这确实与我们的一些客户有所不同。他们中的一些人得到了非常详细的账单，以确定在哪里花费了多少小时。为了得到合同，我们必须同意，尽管这对我们来说非常罕见。

我们的销售人员有时不能拒绝，这可能会导致问题。我们花了很多时间来解决这个问题，但不幸的是它仍然出现了。我们通过引用一些东西来解释他们花了我们多少钱而不研究它需要什么来对抗它。透明度是所有级别的关键。每个人都必须知道他们的决定如何影响底线。

我们会做无意义的改变吗？是的。您必须记住的是，当您大部分时间按小时计费时，5 分钟的更改按整小时计费，因此这是非常有利可图的。我们之前解释了所有这些，就像我们对任何更改请求所做的那样，以便他们意识到这一点，但它往往有助于阻止这种行为，除非它真的很重要。事实上，我们对待所有的变化都是一样的。我们不认为我们知道什么对他们来说是轻浮的，无论我们认为它可能多么荒谬。我们有一个正式的变更流程，客户要求我们将其写下来并让他们签字，这就是我们对其进行评估并提供工作成本估算的内容。他们要么同意在这种情况下正式签署一份文件，让我们知道可以开始，要么他们撤销请求。我们努力勤奋，

我的一位同事给了我听过的关于管理客户关系船舶的最佳建议。这是一个给予和接受。为了让客户满意，你必须愿意在他们需要的时候帮助他们，但同时，你必须能够说不。与人打交道时，他们希望您帮助他们，但他们也希望您有脊椎并为自己挺身而出。这样就变成了双赢的局面。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T16:14:46.893

我更喜欢“不断变化的需求”这个术语。MMLehman 教授（[http://www.doc.ic.ac.uk/~mml/](http://www.doc.ic.ac.uk/~mml/)和[http://en.wikipedia.org/wiki/Meir_Manny_Lehman](http://en.wikipedia.org/wiki/Meir_Manny_Lehman)）对软件进化的研究做出了相当大的贡献；他的作品还表明，并非所有类型的需求都会演变。如果他们碰巧在其中一个要求保持不变的系统（即数学库等）上工作，他们可能会认为自己很幸运。

对于我们其他人来说，经验表明，开发人员更喜欢尽可能多地预先了解有关需求的信息，而客户或最终用户则重视在开发过程中尽可能晚地指定或调整需求的能力。前者需要详细的信息来帮助规划和设计解决方案，后者可以通过后期更改需求来获得战略优势，因为它为客户提供了一些回旋余地，以响应不断变化的环境或因需求而获得的信息。项目的早期阶段/迭代。制定详细计划和改变事物的能力之间的权衡很大程度上决定了开发过程本身（瀑布、敏捷、螺旋等）。

一些管理需求演变的实用建议：

*   在初始计划中建立一些空间，以考虑不断变化的需求、多个检查点或迭代。

*   要么将易变的需求放在项目的开始，以便某种原型或可行性研究可能会澄清它们，要么计划在项目后期进行更改。

*   监控需求是否仍然相关。

*   手边有一份最新的、按优先顺序排列的当前需求列表。没有其他方法可以帮助控制进化，让所有利益相关者都能看到当前“必备品”的所有利益相关者，包括他们的相对优先级和成本。

*   继续管理客户对事情需要多长时间的期望；这也有助于保持专注。

*   如果需要，请引入正式流程以更改或添加需求。过程描述需要详细说明所涉及的角色、审查频率等。它可以很好地防止一些政治和最投机但不是必要的要求。

*   即使是第一个版本，也要花一些时间进行重构。由于在开发过程中获得了额外的知识，您很可能会抛出全部或部分解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T19:40:58.207

客户来找你做某事是因为他们要么没有时间去做，要么不知道该做什么**（并且想付钱让你为他们做这件事）**。如果您有不断变化的需求，那是因为后者。换句话说，他们付钱让你弄清楚细节！他们知道自己喜欢和不喜欢什么，但他们不知道它是如何工作的。

认识到这一点，无论解决方案需要什么到位。

# python - 解析 XML 时所有 nodeValue 字段均为 None

> ID：479751
> 
> 赞同：7
> 
> 时间：2009-01-26T13:15:03.823
> 
> 标签：python, xml, rss, minidom

我正在用 Python 构建一个简单的基于 Web 的 RSS 阅读器，但在解析 XML 时遇到了问题。我首先在 Python 命令行中尝试了一些东西。

```
>>> from xml.dom import minidom
>>> import urllib2 
>>> url ='http://www.digg.com/rss/index.xml'
>>> xmldoc = minidom.parse(urllib2.urlopen(url))
>>> channelnode = xmldoc.getElementsByTagName("channel")
>>> channelnode = xmldoc.getElementsByTagName("channel")
>>> titlenode = channelnode[0].getElementsByTagName("title")
>>> print titlenode[0]
<DOM Element: title at 0xb37440> 
>>> print titlenode[0].nodeValue 
None 
```

我玩了一段时间，但`nodeValue`一切似乎都是`None`. 但是，如果您查看 XML，那里肯定有值。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-26T13:21:44.747

对于 RSS 提要，您应该尝试[通用提要解析器](http://code.google.com/p/feedparser/)库。它极大地简化了 RSS 提要的处理。

```
import feedparser
d = feedparser.parse('http://www.digg.com/rss/index.xml')
title = d.channel.title 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-26T13:26:05.767

这是您正在寻找的语法：

```
>>> print titlenode[0].firstChild.nodeValue
digg.com: Stories / Popular 
```

请注意，节点值是节点本身的逻辑后代。

# database - DB约束可以忽略现有记录并仅申请新数据吗？

> ID：479756
> 
> 赞同：1
> 
> 时间：2009-01-26T13:17:37.733
> 
> 标签：database, constraints

我想了解不同数据库引擎的答案，但在我们的例子中；我们有一些记录对于一列来说不是唯一的，现在我们想让该列唯一，这迫使我们删除重复值。我们使用 Oracle 10g。这合理吗？还是这类似于 goto 语句:) ？我们真的应该删除吗？如果我们有数百万条记录怎么办？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T13:23:42.120

要回答发布的问题：*不，它不能在我知道的任何 RDBMS 上完成*。

但是，像大多数事情一样，您可以通过执行以下操作来解决它。

**使用新列和现有列创建复合键**

您可以通过添加新列使其唯一而不删除任何内容，称为 PartialKey。

对于现有行，您将 PartialKey 设置为唯一值（从零开始）。

在现有列和 PartialKey 上创建唯一约束（您可以这样做，因为现在这些行中的每一行都是唯一的）。

对于新行，仅对 PartialKey 使用默认值零（因为已使用零），这将强制现有列在表中具有唯一值。

**重要编辑**

这很弱 - 如果您删除具有部分键 0 的行。现在可以添加另一行，其值已经在现有列中，因为部分键中的 0 将保证唯一性。

您需要确保

1.  您永远不会删除带有部分键 0 的行
2.  您总是有一个带有部分键 0 的虚拟行，并且您永远不会删除它（或者您立即自动重新插入它）

**编辑：咬紧牙关清理数据**

如果如您所说，您刚刚意识到该列应该是唯一的，那么您应该（如果可能）清理数据。上述方法是一种 hack，您会发现自己在访问表时编写了更多 hack（您可能会发现您有两组逻辑用于处理针对该表的查询，一组用于列唯一的位置，另一组用于不是。我现在就把它清理干净，否则它会回来咬你一千遍。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T13:55:07.720

这可以在 SQL Server 中完成。

> 创建检查约束时，您可以设置一个选项以将其仅应用于新数据或也应用于现有数据。当您知道现有数据已经​​满足新的检查约束时，或者当业务规则要求仅从此时开始强制执行约束时，仅将约束应用于新数据的选项很有用。

例如

```
ALTER TABLE myTable 
WITH NOCHECK
ADD CONSTRAINT myConstraint CHECK ( column > 100 ) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:19:47.043

在添加约束之前，您必须直接设置记录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T14:24:50.110

您可以使用 NOVALIDATE ENABLE 约束状态来执行此操作，但删除是更优选的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T07:29:13.410

在 Oracle 中，您可以将约束置于启用 novalidate 状态。当约束处于启用 novalidate 状态时，将检查所有后续语句是否符合约束。但是，不会检查表中的任何现有数据。启用 novalidated 约束的表可以包含无效数据，但不能向其中添加新的无效数据。在 novalidated 状态下启用约束在上传有效 OLTP 数据的数据仓库配置中最有用。

# silverlight - Silverlight 设备独立坐标

> ID：479758
> 
> 赞同：1
> 
> 时间：2009-01-26T13:17:53.927
> 
> 标签：silverlight, pixels

我编写了一个 Silverlight 应用程序，当我从 96 dpi 更改为 120 dpi 时，该应用程序无法缩放文本和图形不会改变屏幕上用尺子测量的物理尺寸。我在不同的地方读到 Silverlight 应该根据 DPI 配置的变化进行调整。网页的非 Silverlight 部分按预期缩放。似乎 Silverlight 插件使用像素作为度量单位，而不是 1/96 英寸。有什么解释？

我正在运行 Windows XP 并在 Wndows XPdesktop 属性/设置/常规/DPI 设置中设置 DPI。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T04:51:45.210

如果您追求可测量的坐标（即：在您的应用程序中显示准确的标尺），这将无济于事，但如果您希望您的 UI 独立于分辨率，您可以使用 ViewBox 包装它，它是[Silverlight 工具包的一部分](http://www.codeplex.com/Silverlight)

# java - 如何快速找到添加/删除的文件？

> ID：479762
> 
> 赞同：11
> 
> 时间：2009-01-26T13:19:13.270
> 
> 标签：java, file, filesystems

我正在编写一个小程序，它为我的目录中的所有文件创建索引。它基本上遍历磁盘上的每个文件并将其存储到可搜索的数据库中，就像 Unix 的定位一样。问题是，索引生成非常慢，因为我有大约一百万个文件。

生成索引后，是否有一种快速方法可以找出自上次运行以来磁盘上添加或删除了哪些文件？

**编辑**：我不想监视文件系统事件。我认为风险太高而无法同步，我更喜欢快速重新扫描之类的东西，它可以快速找到添加/删除文件的位置。也许与目录最后修改日期或什么？

## 一个小基准

我只是做了一个小基准。跑步

```
dir /b /s M:\tests\  >c:\out.txt 
```

需要 0.9 秒，并为我提供所需的所有信息。当我使用 Java 实现（[很像这样](https://stackoverflow.com/questions/189094/how-to-scan-a-folder-in-java)）时，大约需要 4.5 秒。任何想法如何至少改进这种蛮力方法？

相关文章：[如何查看目录的子文件是否已更改](https://stackoverflow.com/questions/56682/how-to-see-if-a-subfile-of-a-directory-has-changed)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-04T08:32:45.037

能不能跳出java。

你可以简单地使用

```
dir /b /s /on M:\tests\ 
```

/on 按名称排序

如果你把它输出到 out.txt

然后对您上次在 Java 或批处理文件中运行此文件的时间进行比较。在 Dos 中有类似的东西。你需要一个 diff 工具，无论是 cygwin 中的 diff 还是优秀的 ht​​tp: [//gnuwin32.sourceforge.net/packages/diffutils.htm](http://gnuwin32.sourceforge.net/packages/diffutils.htm)

```
dir /b /s /on m:\tests >new.txt
diff new.txt archive.txt >diffoutput.txt
del archive.txt
ren new.txt archive.txt 
```

显然，您也可以使用 java diff 类，但我认为可以接受的是，shell 命令几乎总是会在文件列表操作中击败 Java。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-26T13:23:48.283

不幸的是，在 java 中没有标准的监听文件系统事件的方法。这*可能*会出现在 java7 中。

现在，您必须搜索“java 文件系统事件”并选择与您的平台匹配的自定义实现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-04T08:18:48.233

我已经在我的工具 MetaMake 中完成了这项工作。这是食谱：

1.  如果索引为空，则使用时间戳 == dir.lastModified()-1 将根目录添加到索引中。
2.  查找索引中的所有目录
3.  将索引中目录的时间戳与文件系统中的时间戳进行比较。这是一个快速操作，因为您拥有完整路径（不扫描所涉及的树中的所有文件/目录）。
4.  如果时间戳已更改，则您在此目录中进行了更改。重新扫描它并更新索引。
5.  如果您在这一步中遇到缺少目录，请从索引中删除子树
6.  如果遇到现有目录，请忽略它（将在第 2 步中检查）
7.  如果遇到新目录，请使用 timestamp == dir.lastModified()-1 添加它。确保它在第 2 步中得到考虑。

这将使您能够有效地注意到新文件和已删除文件。由于您在步骤 #2 中仅扫描已知路径，因此这将非常有效。文件系统不擅长枚举目录中的所有条目，但是当您知道确切名称时它们会很快。

缺点：您不会注意到更改的文件。因此，如果您编辑文件，这*不会*反映在目录的更改中。如果您也需要此信息，则必须对索引中的文件节点重复上述算法。这一次，您可以忽略新的/删除的文件，因为它们在目录运行期间已经更新。

[编辑] Zach 提到时间戳是不够的。我的回答是：根本没有其他方法可以做到这一点。对于目录和从实施到实施的变化，“大小”的概念是完全未定义的。没有 API 可以在其中注册“我希望在对文件系统中的某些内容进行任何更改时收到通知”。当您的应用程序处于活动状态时，有些 API 可以工作，但如果它停止或错过某个事件，那么您就不同步了。

如果文件系统是远程的，情况会变得更糟，因为各种网络问题都会导致您失去同步。因此，虽然我的解决方案可能不是 100% 完美且防水，但它适用于除构造最完善的特殊情况之外的所有情况。这是唯一能做到这一点的解决方案。

现在有一种应用程序希望在进行修改后保留目录的时间戳：病毒或蠕虫。这显然会破坏我的算法，但它并不是为了防止病毒感染。如果要防止这种情况发生，则必须采用完全不同的方法。

实现 Zach 想要的唯一另一种方法是构建一个新的文件系统，将这些信息永久记录在某个地方，然后将其出售给 Microsoft，然后等待几年（可能 10 年或更长时间），直到每个人都使用它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T13:39:05.193

您可以加快速度的一种方法是遍历目录并检查上次修改时间以查看自上次索引以来目录的内容是否已更改，以及他们是否刚刚对目录进行了正常扫描然后查看如果你能找到事情发生变化的地方。我不知道这将是多么可移植，但是它改变层次结构会在 Linux 系统上传播（可能取决于文件系统），因此您可以从根目录开始并向下工作，当您点击一个目录时停止没有改变

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T02:45:31.963

鉴于我们不想监视文件系统事件，那么我们是否可以只跟踪`(name,size,time,checksum)`每个文件的事件？文件校验和（或加密哈希，如果您愿意）的计算将成为瓶颈。您可以在初始运行时只计算一次，然后仅在必要时重新计算（例如，当文件与其他三个属性匹配时）。当然，如果我们只想跟踪文件名而不是文件内容，我们不需要为此烦恼。

您提到与“”相比，您的 Java 实现（类似于[此](https://stackoverflow.com/questions/189094/how-to-scan-a-folder-in-java)）非常慢`dir /s`。我认为这有两个原因：

1.  [`File.listFiles()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#listFiles())本质上是缓慢的。有关更多信息，请参阅此较早的问题“ [Java 在遍历大型目录时性能不佳的解决方法吗？](https://stackoverflow.com/questions/354703/is-there-a-workaround-for-javas-poor-performance-on-walking-huge-directories) ”，以及此 Java RFE“ [File.list(FilenameFilter) 对大型目录无效](http://bugs.sun.com/view_bug.do;jsessionid=db7fcf25bcce13541c4289edeb4?bug_id=4285834)”。[NIO.2](http://www.jcp.org/en/jsr/detail?id=203)显然解决了这个缺点，即将推出。

2.  您是否正在使用递归遍历您的目录？如果是这样，请尝试使用非递归方法，例如在堆栈上/从堆栈上推送/弹出要访问的目录。我[有限的个人经验](http://syncdir.sourceforge.net/)表明，这种改进可能非常显着。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T13:55:34.147

文件日期方法可能不是最好的。例如，如果您从备份中恢复文件。也许在索引期间，您可以存储文件内容的 MD5 哈希。但是，您可能需要进行一些性能基准测试以查看性能是否可以接受

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-29T16:09:46.943

我听说这项任务很难有效地完成。我敢肯定，如果它很容易，MS 会实现与 Windows 类似的工具，尤其是现在，因为 HD:s 正在增长和增长。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T16:16:58.863

我没有检查实现或性能，但 commons-io 有一个[listFiles()](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#listFiles(java.io.File,%20java.lang.String[],%20boolean))方法。可能值得一试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-04T08:02:03.850

[像这样](https://stackoverflow.com/questions/236737/language-showdown-how-do-you-make-a-system-call-that-returns-the-stdout-output-a/373223#373223)的东西怎么样：

```
private static String execute( String command ) throws IOException  { 
    Process p = Runtime.getRuntime().exec( "cmd /c " + command );
    InputStream i = p.getInputStream();
    StringBuilder sb = new StringBuilder();
    for(  int c = 0 ; ( c =  i.read() ) > -1  ; ) {
        sb.append( ( char ) c );
    }
    i.close();
    return sb.toString();
} 
```

（那里有**很大**的改进空间，因为该版本一次读取一个字符：您可以 [从这里](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file)选择更好的版本以更快地读取流）

你用作为论点：

```
"dir /b /s M:\tests\" 
```

如果这将用于正在运行的应用程序（而不是作为独立应用程序），您可以忽略 JVM 的“预热”时间，这取决于您的硬件大约 1 - 2 秒。

你可以试试看有什么影响。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-05T08:35:57.353

尝试使用 git。版本控制软件就是针对这类问题的，git以速度着称；它专为快速处理本地文件而设计。'git diff --name-status' 会给你我想要的东西。

# delphi - 文件/文件夹监控

> ID：479770
> 
> 赞同：9
> 
> 时间：2009-01-26T13:22:45.540
> 
> 标签：delphi, file, monitoring, directory

针对文件活动监视磁盘的最佳方法是什么。我的意思是获取完整的文件名（c:\temp\abc.txt）、操作（创建/删除/修改/重命名），以及导致文件的用户（user1）和进程名（notepad.exe）（多个删除）活动。

我听说过一些 API 和 ShellNotifications，但无法将它们用于上述全部需求。

此致。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-26T16:13:26.817

很久以前，我最喜欢的博客之一回答了这个问题（带有完整源代码和演示应用程序）。在此处查看[Delphi About.com 文章，](http://delphi.about.com/od/kbwinshell/l/aa030403a.htm)其中有更深入的解释。Zarko Gajic 在[http://delphi.about.com提供的代码](http://delphi.about.com)

*想要在系统上创建、重命名或删除文件时收到通知？需要知道确切的文件夹和文件名吗？让我们开始监控系统外壳的变化吧！*

```
//TSHChangeNotify

unit SHChangeNotify;

{$IFNDEF VER80} {$IFNDEF VER90} {$IFNDEF VER93}
  {$DEFINE Delphi3orHigher}
{$ENDIF} {$ENDIF} {$ENDIF}

//*************************************************************
//*************************************************************
// TSHChangeNotify component by Elliott Shevin  shevine@aol.com
// vers. 3.0, October 2000
//
//   See the README.TXT file for revision history.
//
//*
//*  I owe this component to James Holderness, who described the
//*  use of the undocumented Windows API calls it depends upon,
//*  and Brad Martinez, who coded a similar function in Visual
//*  Basic. I quote here from Brad's expression of gratitude to
//*  James:
//*     Interpretation of the shell's undocumented functions
//*     SHChangeNotifyRegister (ordinal 2) and SHChangeNotifyDeregister
//*     (ordinal 4) would not have been possible without the
//*     assistance of James Holderness. For a complete (and probably
//*     more accurate) overview of shell change notifcations,
//*     please refer to James'  "Shell Notifications" page at
//*     http://www.geocities.com/SiliconValley/4942/
//*
//*  This component will let you know when selected events
//*  occur in the Windows shell, such as files and folders
//*  being renamed, added, or deleted. (Moving an item yields
//*  the same results as renaming it.) For the complete list
//*  of events the component can trap, see Win32 Programmer's
//*  reference description of the SHChangeNotify API call.
//*
//*  Properties:
//*     MessageNo: the Windows message number which will be used to signal
//*                a trapped event. The default is WM_USER (1024); you may
//*                set it to some other value if you're using WM_USER for
//*                any other purpose.
//*     TextCase:  tcAsIs (default), tcLowercase, or tcUppercase, determines
//*                whether and how the Path parameters passed to your event
//*                handlers are case-converted.
//*     HardDriveOnly: when set to True, the component monitors only local
//*                hard drive partitions; when set to False, monitors the
//*                entire file system.
//*
//*  Methods:
//*     Execute:   Begin monitoring the selected shell events.
//*     Stop:      Stop monitoring.
//*
//*  Events:
//*     The component has an event corresponding to each event it can
//*     trap, e.g. OnCreate, OnMediaInsert, etc.
//*     Each event handler is passed either three or four parameters--
//*          Sender=this component.
//*          Flags=the value indentifying the event that triggered the handler,
//*             from the constants in the SHChangeNotify help. This parameter
//*             allows multiple events to share handlers and still distinguish
//*             the reason the handler was triggered.
//*          Path1, Path2: strings which are the paths affected by the shell
//*             event. Whether both are passed depends on whether the second
//*             is needed to describe the event. For example, OnDelete gives
//*             only the name of the file (including path) that was deleted;
//*             but OnRenameFolder gives the original folder name in Path1
//*             and the new name in Path2.
//*             In some cases, such as OnAssocChanged, neither Path parameter
//*             means anything, and in other cases, I guessed, but we always
//*             pass at least one.
//*     Each time an event property is changed, the component is reset to
//*     trap only those events for which handlers are assigned. So assigning
//*     an event handler suffices to indicate your intention to trap the
//*     corresponding shell event.
//*
//*     There is one more event: OnEndSessionQuery, which has the same
//*     parameters as the standard Delphi OnCloseQuery (and can in fact
//*     be your OnCloseQuery handler). This component must shut down its
//*     interception of shell events when system shutdown is begun, lest
//*     the system fail to shut down at the user's request.
//*
//*     Setting CanEndSession (same as CanClose) to FALSE in an
//*     OnEndSessionQuery will stop the process of shutting down
//*     Windows. You would only need this if you need to keep the user
//*     from ending his Windows session while your program is running.
//*
//*   I'd be honored to hear what you think of this component.
//*   You can write me at shevine@aol.com.
//*************************************************************
//*************************************************************

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  {$IFNDEF Delphi3orHigher}
     OLE2,
  {$ELSE}
     ActiveX, ComObj,
  {$ENDIF}

  ShlObj;

const
   SHCNF_ACCEPT_INTERRUPTS      = $0001;
   SHCNF_ACCEPT_NON_INTERRUPTS  = $0002;
   SHCNF_NO_PROXY               = $8000;

type NOTIFYREGISTER = record
    pidlPath      : PItemIDList;
    bWatchSubtree : boolean;
end;

type PNOTIFYREGISTER = ^NOTIFYREGISTER;

type TTextCase = (tcAsIs,tcUppercase,tcLowercase);

type
    TOneParmEvent = procedure(Sender : TObject; Flags : cardinal; Path1 : string) of object;
    TTwoParmEvent = procedure(Sender : TObject; Flags : cardinal; Path1, Path2 : string) of object;
    TEndSessionQueryEvent = procedure(Sender: TObject; var CanEndSession: Boolean) of object;

    function SHChangeNotifyRegister(
       hWnd        : HWND;
       dwFlags     : integer;
       wEventMask  : cardinal;
       uMsg        : UINT;
       cItems      : integer;
       lpItems     : PNOTIFYREGISTER) : HWND; stdcall;
    function SHChangeNotifyDeregister(
       hWnd        : HWND) : boolean; stdcall;
    function SHILCreateFromPath(Path: Pointer;
                     PIDL: PItemIDList; var Attributes: ULONG):
                     HResult; stdcall;

type
  TSHChangeNotify = class(TComponent)
  private
    fTextCase      : TTextCase;
    fHardDriveOnly : boolean;
    NotifyCount    : integer;
    NotifyHandle   : hwnd;
    NotifyArray    : array[1..26] of NOTIFYREGISTER;
    AllocInterface : IMalloc;
    PrevMsg        : integer;
    prevpath1      : string;
    prevpath2      : string;
    fMessageNo     : integer;
    fAssocChanged     : TTwoParmEvent;
    fAttributes       : TOneParmEvent;
    fCreate           : TOneParmEvent;
    fDelete           : TOneParmEvent;
    fDriveAdd         : TOneParmEvent;
    fDriveAddGUI      : TOneParmEvent;
    fDriveRemoved     : TOneParmEvent;
    fMediaInserted    : TOneParmEvent;
    fMediaRemoved     : TOneParmEvent;
    fMkDir            : TOneParmEvent;
    fNetShare         : TOneParmEvent;
    fNetUnshare       : TOneParmEvent;
    fRenameFolder     : TTwoParmEvent;
    fRenameItem       : TTwoParmEvent;
    fRmDir            : TOneParmEvent;
    fServerDisconnect : TOneParmEvent;
    fUpdateDir        : TOneParmEvent;
    fUpdateImage      : TOneParmEvent;
    fUpdateItem       : TOneParmEvent;
    fEndSessionQuery  : TEndSessionQueryEvent;

    OwnerWindowProc   : TWndMethod;

    procedure SetMessageNo(value : integer);
    procedure WndProc(var msg: TMessage);

  protected
    procedure QueryEndSession(var msg: TMessage);

  public
    constructor Create(AOwner : TComponent); override;
    destructor  Destroy; override;
    procedure   Execute;
    procedure   Stop;

  published
    property MessageNo : integer read fMessageNo write SetMessageNo default WM_USER;
    property TextCase : TTextCase read fTextCase write fTextCase  default tcAsIs;
    property HardDriveOnly : boolean  read fHardDriveOnly write fHardDriveOnly default True;

    property OnAssocChanged     : TTwoParmEvent read fAssocChanged write fAssocChanged;
    property OnAttributes   : TOneParmEvent read fAttributes   write fAttributes;
    property OnCreate           : TOneParmEvent read fCreate       write fCreate;
    property OnDelete           : TOneParmEvent read fDelete       write fDelete;
    property OnDriveAdd         : TOneParmEvent read fDriveAdd     write fDriveAdd;
    property OnDriveAddGUI  : TOneParmEvent read fDriveAddGUI  write fDriveAddGUI;
    property OnDriveRemoved : TOneParmEvent read fDriveRemoved write fDriveRemoved;
    property OnMediaInserted    : TOneParmEvent read fMediaInserted write fMediaInserted;
    property OnMediaRemoved : TOneParmEvent read fMediaRemoved write fMediaRemoved;
    property OnMkDir            : TOneParmEvent read fMkDir        write fMkDir;
    property OnNetShare         : TOneParmEvent read fNetShare     write fNetShare;
    property OnNetUnshare   : TOneParmEvent read fNetUnshare   write fNetUnshare;
    property OnRenameFolder : TTwoParmEvent  read fRenameFolder write fRenameFolder;
    property OnRenameItem   : TTwoParmEvent read fRenameItem   write fRenameItem;
    property OnRmDir            : TOneParmEvent read fRmDir        write fRmDir;
    property OnServerDisconnect : TOneParmEvent read fServerDisconnect write fServerDisconnect;
    property OnUpdateDir        : TOneParmEvent read fUpdateDir    write fUpdateDir;
    property OnUpdateImage  : TOneParmEvent read fUpdateImage  write fUpdateImage;
    property OnUpdateItem       : TOneParmEvent read fUpdateItem   write fUpdateItem;
    property OnEndSessionQuery  : TEndSessionQueryEvent
                                         read fEndSessionQuery write fEndSessionQuery;
    { Published declarations }
  end;

procedure Register;

implementation

const Shell32DLL = 'shell32.dll';

function SHChangeNotifyRegister;
              external Shell32DLL index 2;
function SHChangeNotifyDeregister;
              external Shell32DLL index 4;
function SHILCreateFromPath;
              external Shell32DLL index 28;

procedure Register;
begin
  RegisterComponents('Custom', [TSHChangeNotify]);
end;

// Set defaults, and ensure NotifyHandle is zero.
constructor TSHChangeNotify.Create (AOwner : TComponent);
begin
   inherited Create(AOwner);
   fTextCase      := tcAsIs;
   fHardDriveOnly := true;

   fAssocChanged     := nil;
   fAttributes       := nil;
   fCreate           := nil;
   fDelete           := nil;
   fDriveAdd         := nil;
   fDriveAddGUI      := nil;
   fDriveRemoved     := nil;
   fMediaInserted    := nil;
   fMediaRemoved     := nil;
   fMkDir            := nil;
   fNetShare         := nil;
   fNetUnshare       := nil;
   fRenameFolder     := nil;
   fRenameItem       := nil;
   fRmDir            := nil;
   fServerDisconnect := nil;
   fUpdateDir        := nil;
   fUpdateImage      := nil;
   fUpdateItem       := nil;
   fEndSessionQuery  := nil;

   MessageNo    := WM_USER;

   // If designing, dodge the code that implements messag interception.
   if csDesigning in ComponentState
      then exit;

   // Substitute our window proc for our owner's window proc.
   OwnerWindowProc := (Owner as TWinControl).WindowProc;
   (Owner as TWinControl).WindowProc := WndProc;

   // Get the IMAlloc interface so we can free PIDLs.
   SHGetMalloc(AllocInterface);
end;

procedure TSHChangeNotify.SetMessageNo(value : integer);
begin
   if (value >= WM_USER)
     then fMessageNo := value
     else raise Exception.Create
                    ('MessageNo must be greater than or equal to '
                    + inttostr(WM_USER));
end;

// Execute unregisters any current notification and registers a new one.
procedure TSHChangeNotify.Execute;
var
   EventMask      : integer;
   driveletter    : string;
   i              : integer;
   pidl           : PItemIDList;
   Attributes     : ULONG;
   NotifyPtr      : PNOTIFYREGISTER;
begin
   NotifyCount := 0;

   if csDesigning in ComponentState
      then exit;

   Stop;  // Unregister the current notification, if any.

   EventMask := 0;
   if assigned(fAssocChanged     ) then EventMask := (EventMask or SHCNE_ASSOCCHANGED);
   if assigned(fAttributes       ) then EventMask := (EventMask or SHCNE_ATTRIBUTES);
   if assigned(fCreate           ) then EventMask := (EventMask or SHCNE_CREATE);
   if assigned(fDelete           ) then EventMask := (EventMask or SHCNE_DELETE);
   if assigned(fDriveAdd         ) then EventMask := (EventMask or SHCNE_DRIVEADD);
   if assigned(fDriveAddGUI      ) then EventMask := (EventMask or SHCNE_DRIVEADDGUI);
   if assigned(fDriveRemoved     ) then EventMask := (EventMask or SHCNE_DRIVEREMOVED);
   if assigned(fMediaInserted    ) then EventMask := (EventMask or SHCNE_MEDIAINSERTED);
   if assigned(fMediaRemoved     ) then EventMask := (EventMask or SHCNE_MEDIAREMOVED);
   if assigned(fMkDir            ) then EventMask := (EventMask or SHCNE_MKDIR);
   if assigned(fNetShare         ) then EventMask := (EventMask or SHCNE_NETSHARE);
   if assigned(fNetUnshare       ) then EventMask := (EventMask or SHCNE_NETUNSHARE);
   if assigned(fRenameFolder     ) then EventMask := (EventMask or SHCNE_RENAMEFOLDER);
   if assigned(fRenameItem       ) then EventMask := (EventMask or SHCNE_RENAMEITEM);
   if assigned(fRmDir            ) then EventMask := (EventMask or SHCNE_RMDIR);
   if assigned(fServerDisconnect ) then EventMask := (EventMask or SHCNE_SERVERDISCONNECT);
   if assigned(fUpdateDir        ) then EventMask := (EventMask or SHCNE_UPDATEDIR);
   if assigned(fUpdateImage      ) then EventMask := (EventMask or SHCNE_UPDATEIMAGE);
   if assigned(fUpdateItem       ) then EventMask := (EventMask or SHCNE_UPDATEITEM);

   if EventMask = 0   // If there's no event mask
      then exit;      // then there's no need to set an event.

   // If the user requests watches on hard drives only, cycle through
   // the list of drive letters and add a NotifyList element for each.
   // Otherwise, just set the first element to watch the entire file
   // system.
   if fHardDriveOnly
     then for i := ord('A') to ord('Z') do begin
            DriveLetter := char(i) + ':\';
            if GetDriveType(pchar(DriveLetter)) = DRIVE_FIXED
               then begin
                      inc(NotifyCount);
                      with NotifyArray[NotifyCount] do begin
                          SHILCreateFromPath
                                     (pchar(DriveLetter),
                                      addr(pidl),
                                      Attributes);
                          pidlPath := pidl;
                          bWatchSubtree := true;
                      end;
            end;
     end

     // If the caller requests the entire file system be watched,
     // prepare the first NotifyElement accordingly.
     else begin
          NotifyCount := 1;
          with NotifyArray[1] do begin
              pidlPath      := nil;
              bWatchSubtree := true;
          end;
     end;

     NotifyPtr    :=  addr(NotifyArray);

     NotifyHandle :=  SHChangeNotifyRegister(
                               (Owner as TWinControl).Handle,
                                SHCNF_ACCEPT_INTERRUPTS       +
                                    SHCNF_ACCEPT_NON_INTERRUPTS,
                                EventMask,
                                fMessageNo,
                                NotifyCount,
                                NotifyPtr);

   if NotifyHandle = 0
      then begin
             Stop;
             raise Exception.Create('Could not register SHChangeNotify');
   end;
end;

// This procedure unregisters the Change Notification
procedure TSHChangeNotify.Stop;
var
   NotifyHandle   : hwnd;
   i              : integer;
   pidl           : PITEMIDLIST;
begin
   if csDesigning in ComponentState
      then exit;

   // Deregister the shell notification.
   if NotifyCount > 0
      then SHChangeNotifyDeregister(NotifyHandle);

   // Free the PIDLs in NotifyArray.
   for i := 1 to NotifyCount do begin
      pidl := NotifyArray[i].PidlPath;
      if AllocInterface.DidAlloc(pidl) = 1
                         then AllocInterface.Free(pidl);
   end;

   NotifyCount := 0;
end;

// This is the procedure that is called when a change notification occurs.
// It interprets the two PIDLs passed to it, and calls the appropriate
// event handler, according to what kind of event occurred.
procedure TSHChangeNotify.WndProc(var msg: TMessage);
type
   TPIDLLIST = record
      pidlist : array[1..2] of PITEMIDLIST;
   end;
   PIDARRAY = ^TPIDLLIST;
var
   Path1    : string;
   Path2    : string;
   ptr      : PIDARRAY;
   p1,p2    : PITEMIDLIST;
   repeated : boolean;
   p        : integer;
   event    : longint;
   parmcount      : byte;
   OneParmEvent   : TOneParmEvent;
   TwoParmEvent   : TTwoParmEvent;

   // The internal function ParsePidl returns the string corresponding
   // to a PIDL.
   function ParsePidl (Pidl : PITEMIDLIST) : string;
   begin
      SetLength(result,MAX_PATH);
      if not SHGetPathFromIDList(Pidl,pchar(result))
          then result := '';
   end;

// The actual message handler starts here.
begin
  if Msg.Msg = WM_QUERYENDSESSION
     then QueryEndSession(Msg);

  if Msg.Msg = fMessageNo
     then begin
        OneParmEvent := nil;
        TwoParmEvent := nil;

        event := msg.LParam and ($7FFFFFFF);

        case event of
           SHCNE_ASSOCCHANGED     : TwoParmEvent := fAssocChanged;
           SHCNE_ATTRIBUTES       : OneParmEvent := fAttributes;
           SHCNE_CREATE           : OneParmEvent := fCreate;
           SHCNE_DELETE           : OneParmEvent := fDelete;
           SHCNE_DRIVEADD         : OneParmEvent := fDriveAdd;
           SHCNE_DRIVEADDGUI      : OneParmEvent := fDriveAddGUI;
           SHCNE_DRIVEREMOVED     : OneParmEvent := fDriveRemoved;
           SHCNE_MEDIAINSERTED    : OneParmEvent := fMediaInserted;
           SHCNE_MEDIAREMOVED     : OneParmEvent := fMediaRemoved;
           SHCNE_MKDIR            : OneParmEvent := fMkDir;
           SHCNE_NETSHARE         : OneParmEvent := fNetShare;
           SHCNE_NETUNSHARE       : OneParmEvent := fNetUnshare;
           SHCNE_RENAMEFOLDER     : TwoParmEvent := fRenameFolder;
           SHCNE_RENAMEITEM       : TwoParmEvent := fRenameItem;
           SHCNE_RMDIR            : OneParmEvent := fRmDir;
           SHCNE_SERVERDISCONNECT : OneParmEvent := fServerDisconnect;
           SHCNE_UPDATEDIR        : OneParmEvent := fUpdateDir;
           SHCNE_UPDATEIMAGE      : OneParmEvent := fUpdateImage;
           SHCNE_UPDATEITEM       : OneParmEvent := fUpdateItem;
           else begin
                   OneParmEvent := nil; // Unknown event;
                   TwoParmEvent := nil;
                end;
        end;
        if (assigned(OneParmEvent)) or (assigned(TwoParmEvent))
          then begin

                // Assign a pointer to the array of PIDLs sent
                // with the message.
                ptr := PIDARRAY(msg.wParam);

                // Parse the two PIDLs.
                p1 := ptr^.pidlist[1];
                try
                   SetLength(Path1,MAX_PATH);
                   Path1 := ParsePidl(p1);
                   p := pos(#00,Path1);
                   if p > 0
                      then SetLength(Path1,p - 1);
                except
                   Path1 := '';
                end;

                p2 := ptr^.pidlist[2];
                try
                   SetLength(Path2,MAX_PATH);
                   Path2 := ParsePidl(p2);
                   p := pos(#00,Path2);
                   if p > 0
                      then SetLength(Path2,p - 1);
                except
                   Path2 := '';
                end;

                // If this message is the same as the last one (which happens
                // a lot), bail out.
                try
                   repeated := (PrevMsg = event)
                                and (uppercase(prevpath1) = uppercase(Path1))
                                and (uppercase(prevpath2) = uppercase(Path2))
                except
                   repeated := false;
                end;

                // Save the elements of this message for comparison next time.
                PrevMsg    := event;
                PrevPath1  := Path1;
                PrevPath2  := Path2;

                // Convert the case of Path1 and Path2 if desired.
                case fTextCase of
                        tcUppercase : begin
                           Path1 := uppercase(Path1);
                           Path2 := uppercase(Path2);
                        end;
                        tcLowercase : begin
                           Path1 := lowercase(Path1);
                           Path2 := lowercase(Path2);
                        end;
                end;

                // Call the event handler according to the number
                // of paths we will pass to it.
                if not repeated then begin
                   case event of
                        SHCNE_ASSOCCHANGED,
                        SHCNE_RENAMEFOLDER,
                        SHCNE_RENAMEITEM   : parmcount := 2;
                   else parmcount := 1;
                   end;

                   if parmcount = 1
                      then OneParmEvent(self, event, Path1)
                      else TwoParmEvent(self, event, Path1, Path2);
                end;

        end;  // if assigned(OneParmEvent)...

  end;        // if Msg.Msg = fMessageNo...

  // Call the original message handler.
  OwnerWindowProc(Msg);
end;

procedure TSHChangeNotify.QueryEndSession(var msg: TMessage);
var
   CanEndSession : boolean;
begin
   CanEndSession := true;
   if Assigned(fEndSessionQuery)
      then fEndSessionQuery(Self, CanEndSession);
   if CanEndSession
      then begin
             Stop;
             Msg.Result := 1;
      end
      else Msg.Result := 0;
end;

destructor TSHChangeNotify.Destroy;
begin
   if not (csDesigning in ComponentState)
      then begin
             if Assigned(Owner)
               then (Owner as TWinControl).WindowProc := OwnerWindowProc;
             Stop;
   end;

   inherited;
end;

end.

{
********************************************
Zarko Gajic
About.com Guide to Delphi Programming
http://delphi.about.com
email: delphi.guide@about.com
free newsletter: http://delphi.about.com/library/blnewsletter.htm
forum: http://forums.about.com/ab-delphi/start/
********************************************
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-26T13:32:37.453

有一个 Windows API 可以接收有关目录和可选子目录更改的通知，请参阅[这个 SO question](https://stackoverflow.com/questions/396905/detect-disk-activity-in-delphi#397932)以了解封装 API 的 Delphi 组件。

但是，（AFAIK）没有现成的界面来获取您需要的所有信息。您当然可以查看目录，使用每个文件的所有可用信息填充文件列表，并将当前列表与之前的列表进行比较，以确定发生了什么变化以及是谁做的。但是，这不会扩展，并且无法获取所有信息 - 例如，您会看到文件已被删除，但我认为您无法从哪个用户帐户获取文件被删除的信息.

**编辑：**像[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)和朋友这样的工具提供了比 Windows API 提供的更多关于系统中正在发生的事情的信息，但它们通常需要驱动程序才能访问此类信息，并且需要以管理员权限运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-11-25T17:58:49.587

Stack Overflow 不允许我评论 Mick 的回答。我想让大家知道**它只能在目标平台 windows 32bit 中编译**。如果你尝试使用目标平台 windows 64 位编译它，它会抛出各种错误。

[您可以在 Torry.net https://torry.net/pages.php?id=252](https://torry.net/pages.php?id=252)的最底部页面上找到原始源代码。

原始版本给了我一些错误，这是次要的，但我修复了。

这是我编辑的适用于 Delphi 10.4.1 的版本（将此源代码放在 .pas 文件中并将其包含到新的包文件中。您将能够从那里编译和安装它。）：

```
//TSHChangeNotify

unit SHChangeNotify;

{$DEFINE Delphi3orHigher}

//*************************************************************
//*************************************************************
// TSHChangeNotify component by Elliott Shevin  shevine@aol.com
// vers. 3.0, October 2000
//
//   See the README.TXT file for revision history.
//
//*
//*  I owe this component to James Holderness, who described the
//*  use of the undocumented Windows API calls it depends upon,
//*  and Brad Martinez, who coded a similar function in Visual
//*  Basic. I quote here from Brad's expression of gratitude to
//*  James:
//*     Interpretation of the shell's undocumented functions
//*     SHChangeNotifyRegister (ordinal 2) and SHChangeNotifyDeregister
//*     (ordinal 4) would not have been possible without the
//*     assistance of James Holderness. For a complete (and probably
//*     more accurate) overview of shell change notifcations,
//*     please refer to James'  "Shell Notifications" page at
//*     http://www.geocities.com/SiliconValley/4942/
//*
//*  This component will let you know when selected events
//*  occur in the Windows shell, such as files and folders
//*  being renamed, added, or deleted. (Moving an item yields
//*  the same results as renaming it.) For the complete list
//*  of events the component can trap, see Win32 Programmer's
//*  reference description of the SHChangeNotify API call.
//*
//*  Properties:
//*     MessageNo: the Windows message number which will be used to signal
//*                a trapped event. The default is WM_USER (1024); you may
//*                set it to some other value if you're using WM_USER for
//*                any other purpose.
//*     TextCase:  tcAsIs (default), tcLowercase, or tcUppercase, determines
//*                whether and how the Path parameters passed to your event
//*                handlers are case-converted.
//*     HardDriveOnly: when set to True, the component monitors only local
//*                hard drive partitions; when set to False, monitors the
//*                entire file system.
//*
//*  Methods:
//*     Execute:   Begin monitoring the selected shell events.
//*     Stop:      Stop monitoring.
//*
//*  Events:
//*     The component has an event corresponding to each event it can
//*     trap, e.g. OnCreate, OnMediaInsert, etc.
//*     Each event handler is passed either three or four parameters--
//*          Sender=this component.
//*          Flags=the value indentifying the event that triggered the handler,
//*             from the constants in the SHChangeNotify help. This parameter
//*             allows multiple events to share handlers and still distinguish
//*             the reason the handler was triggered.
//*          Path1, Path2: strings which are the paths affected by the shell
//*             event. Whether both are passed depends on whether the second
//*             is needed to describe the event. For example, OnDelete gives
//*             only the name of the file (including path) that was deleted;
//*             but OnRenameFolder gives the original folder name in Path1
//*             and the new name in Path2.
//*             In some cases, such as OnAssocChanged, neither Path parameter
//*             means anything, and in other cases, I guessed, but we always
//*             pass at least one.
//*     Each time an event property is changed, the component is reset to
//*     trap only those events for which handlers are assigned. So assigning
//*     an event handler suffices to indicate your intention to trap the
//*     corresponding shell event.
//*
//*     There is one more event: OnEndSessionQuery, which has the same
//*     parameters as the standard Delphi OnCloseQuery (and can in fact
//*     be your OnCloseQuery handler). This component must shut down its
//*     interception of shell events when system shutdown is begun, lest
//*     the system fail to shut down at the user's request.
//*
//*     Setting CanEndSession (same as CanClose) to FALSE in an
//*     OnEndSessionQuery will stop the process of shutting down
//*     Windows. You would only need this if you need to keep the user
//*     from ending his Windows session while your program is running.
//*
//*   I'd be honored to hear what you think of this component.
//*   You can write me at shevine@aol.com.
//*************************************************************
//*************************************************************

interface

uses
  Windows, Messages, SysUtils, Classes, Vcl.Graphics, Vcl.Menus, Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ComCtrls,
  Vcl.ImgList, Vcl.StdActns, Vcl.Clipbrd, Vcl.ToolWin, Vcl.Printers, Vcl.ListActns, Vcl.GraphUtil, Vcl.Consts,
  ActiveX, ComObj, ShlObj;

const
   SHCNF_ACCEPT_INTERRUPTS      = $0001;
   SHCNF_ACCEPT_NON_INTERRUPTS  = $0002;
   SHCNF_NO_PROXY               = $8000;

type NOTIFYREGISTER = record
    pidlPath      : PItemIDList;
    bWatchSubtree : boolean;
end;

type PNOTIFYREGISTER = ^NOTIFYREGISTER;

type TTextCase = (tcAsIs,tcUppercase,tcLowercase);

type
    TOneParmEvent = procedure(Sender : TObject; Flags : cardinal; Path1 : string) of object;
    TTwoParmEvent = procedure(Sender : TObject; Flags : cardinal; Path1, Path2 : string) of object;
    TEndSessionQueryEvent = procedure(Sender: TObject; var CanEndSession: Boolean) of object;

    function SHChangeNotifyRegister(
       hWnd        : HWND;
       dwFlags     : integer;
       wEventMask  : cardinal;
       uMsg        : UINT;
       cItems      : integer;
       lpItems     : PNOTIFYREGISTER) : HWND; stdcall;
    function SHChangeNotifyDeregister(
       hWnd        : HWND) : boolean; stdcall;
    function SHILCreateFromPath(Path: Pointer;
                     PIDL: PItemIDList; var Attributes: ULONG):
                     HResult; stdcall;

type
  TSHChangeNotify = class(TComponent)
  private
    fTextCase      : TTextCase;
    fHardDriveOnly : boolean;
    NotifyCount    : integer;
    NotifyHandle   : hwnd;
    NotifyArray    : array[1..26] of NOTIFYREGISTER;
    AllocInterface : IMalloc;
    PrevMsg        : integer;
    prevpath1      : string;
    prevpath2      : string;
    fMessageNo     : integer;
    fAssocChanged     : TTwoParmEvent;
    fAttributes       : TOneParmEvent;
    fCreate           : TOneParmEvent;
    fDelete           : TOneParmEvent;
    fDriveAdd         : TOneParmEvent;
    fDriveAddGUI      : TOneParmEvent;
    fDriveRemoved     : TOneParmEvent;
    fMediaInserted    : TOneParmEvent;
    fMediaRemoved     : TOneParmEvent;
    fMkDir            : TOneParmEvent;
    fNetShare         : TOneParmEvent;
    fNetUnshare       : TOneParmEvent;
    fRenameFolder     : TTwoParmEvent;
    fRenameItem       : TTwoParmEvent;
    fRmDir            : TOneParmEvent;
    fServerDisconnect : TOneParmEvent;
    fUpdateDir        : TOneParmEvent;
    fUpdateImage      : TOneParmEvent;
    fUpdateItem       : TOneParmEvent;
    fEndSessionQuery  : TEndSessionQueryEvent;

    OwnerWindowProc   : TWndMethod;

    procedure SetMessageNo(value : integer);
    procedure WndProc(var msg: TMessage);

  protected
    procedure QueryEndSession(var msg: TMessage);

  public
    constructor Create(AOwner : TComponent); override;
    destructor  Destroy; override;
    procedure   Execute;
    procedure   Stop;

  published
    property MessageNo : integer read fMessageNo write SetMessageNo default WM_USER;
    property TextCase : TTextCase read fTextCase write fTextCase  default tcAsIs;
    property HardDriveOnly : boolean  read fHardDriveOnly write fHardDriveOnly default True;

    property OnAssocChanged     : TTwoParmEvent read fAssocChanged write fAssocChanged;
    property OnAttributes   : TOneParmEvent read fAttributes   write fAttributes;
    property OnCreate           : TOneParmEvent read fCreate       write fCreate;
    property OnDelete           : TOneParmEvent read fDelete       write fDelete;
    property OnDriveAdd         : TOneParmEvent read fDriveAdd     write fDriveAdd;
    property OnDriveAddGUI  : TOneParmEvent read fDriveAddGUI  write fDriveAddGUI;
    property OnDriveRemoved : TOneParmEvent read fDriveRemoved write fDriveRemoved;
    property OnMediaInserted    : TOneParmEvent read fMediaInserted write fMediaInserted;
    property OnMediaRemoved : TOneParmEvent read fMediaRemoved write fMediaRemoved;
    property OnMkDir            : TOneParmEvent read fMkDir        write fMkDir;
    property OnNetShare         : TOneParmEvent read fNetShare     write fNetShare;
    property OnNetUnshare   : TOneParmEvent read fNetUnshare   write fNetUnshare;
    property OnRenameFolder : TTwoParmEvent  read fRenameFolder write fRenameFolder;
    property OnRenameItem   : TTwoParmEvent read fRenameItem   write fRenameItem;
    property OnRmDir            : TOneParmEvent read fRmDir        write fRmDir;
    property OnServerDisconnect : TOneParmEvent read fServerDisconnect write fServerDisconnect;
    property OnUpdateDir        : TOneParmEvent read fUpdateDir    write fUpdateDir;
    property OnUpdateImage  : TOneParmEvent read fUpdateImage  write fUpdateImage;
    property OnUpdateItem       : TOneParmEvent read fUpdateItem   write fUpdateItem;
    property OnEndSessionQuery  : TEndSessionQueryEvent
                                         read fEndSessionQuery write fEndSessionQuery;
    { Published declarations }
  end;

procedure Register;

implementation

const Shell32DLL = 'shell32.dll';

function SHChangeNotifyRegister;
              external Shell32DLL index 2;
function SHChangeNotifyDeregister;
              external Shell32DLL index 4;
function SHILCreateFromPath;
              external Shell32DLL index 28;

procedure Register;
begin
  RegisterComponents('Custom', [TSHChangeNotify]);
end;

// Set defaults, and ensure NotifyHandle is zero.
constructor TSHChangeNotify.Create (AOwner : TComponent);
begin
   inherited Create(AOwner);
   fTextCase      := tcAsIs;
   fHardDriveOnly := true;

   fAssocChanged     := nil;
   fAttributes       := nil;
   fCreate           := nil;
   fDelete           := nil;
   fDriveAdd         := nil;
   fDriveAddGUI      := nil;
   fDriveRemoved     := nil;
   fMediaInserted    := nil;
   fMediaRemoved     := nil;
   fMkDir            := nil;
   fNetShare         := nil;
   fNetUnshare       := nil;
   fRenameFolder     := nil;
   fRenameItem       := nil;
   fRmDir            := nil;
   fServerDisconnect := nil;
   fUpdateDir        := nil;
   fUpdateImage      := nil;
   fUpdateItem       := nil;
   fEndSessionQuery  := nil;

   MessageNo    := WM_USER;

   // If designing, dodge the code that implements messag interception.
   if csDesigning in ComponentState
      then exit;

   // Substitute our window proc for our owner's window proc.
   OwnerWindowProc := (Owner as TWinControl).WindowProc;
   (Owner as TWinControl).WindowProc := WndProc;

   // Get the IMAlloc interface so we can free PIDLs.
   SHGetMalloc(AllocInterface);
end;

procedure TSHChangeNotify.SetMessageNo(value : integer);
begin
   if (value >= WM_USER)
     then fMessageNo := value
     else raise Exception.Create
                    ('MessageNo must be greater than or equal to '
                    + inttostr(WM_USER));
end;

// Execute unregisters any current notification and registers a new one.
procedure TSHChangeNotify.Execute;
var
   EventMask      : integer;
   driveletter    : string;
   i              : integer;
   pidl           : PItemIDList;
   Attributes     : ULONG;
   NotifyPtr      : PNOTIFYREGISTER;
begin
   NotifyCount := 0;

   if csDesigning in ComponentState
      then exit;

   Stop;  // Unregister the current notification, if any.

   EventMask := 0;
   if assigned(fAssocChanged     ) then EventMask := (EventMask or SHCNE_ASSOCCHANGED);
   if assigned(fAttributes       ) then EventMask := (EventMask or SHCNE_ATTRIBUTES);
   if assigned(fCreate           ) then EventMask := (EventMask or SHCNE_CREATE);
   if assigned(fDelete           ) then EventMask := (EventMask or SHCNE_DELETE);
   if assigned(fDriveAdd         ) then EventMask := (EventMask or SHCNE_DRIVEADD);
   if assigned(fDriveAddGUI      ) then EventMask := (EventMask or SHCNE_DRIVEADDGUI);
   if assigned(fDriveRemoved     ) then EventMask := (EventMask or SHCNE_DRIVEREMOVED);
   if assigned(fMediaInserted    ) then EventMask := (EventMask or SHCNE_MEDIAINSERTED);
   if assigned(fMediaRemoved     ) then EventMask := (EventMask or SHCNE_MEDIAREMOVED);
   if assigned(fMkDir            ) then EventMask := (EventMask or SHCNE_MKDIR);
   if assigned(fNetShare         ) then EventMask := (EventMask or SHCNE_NETSHARE);
   if assigned(fNetUnshare       ) then EventMask := (EventMask or SHCNE_NETUNSHARE);
   if assigned(fRenameFolder     ) then EventMask := (EventMask or SHCNE_RENAMEFOLDER);
   if assigned(fRenameItem       ) then EventMask := (EventMask or SHCNE_RENAMEITEM);
   if assigned(fRmDir            ) then EventMask := (EventMask or SHCNE_RMDIR);
   if assigned(fServerDisconnect ) then EventMask := (EventMask or SHCNE_SERVERDISCONNECT);
   if assigned(fUpdateDir        ) then EventMask := (EventMask or SHCNE_UPDATEDIR);
   if assigned(fUpdateImage      ) then EventMask := (EventMask or SHCNE_UPDATEIMAGE);
   if assigned(fUpdateItem       ) then EventMask := (EventMask or SHCNE_UPDATEITEM);

   if EventMask = 0   // If there's no event mask
      then exit;      // then there's no need to set an event.

   // If the user requests watches on hard drives only, cycle through
   // the list of drive letters and add a NotifyList element for each.
   // Otherwise, just set the first element to watch the entire file
   // system.
   if fHardDriveOnly
     then for i := ord('A') to ord('Z') do begin
            DriveLetter := char(i) + ':\';
            if GetDriveType(pchar(DriveLetter)) = DRIVE_FIXED
               then begin
                      inc(NotifyCount);
                      with NotifyArray[NotifyCount] do begin
                          SHILCreateFromPath
                                     (pchar(DriveLetter),
                                      addr(pidl),
                                      Attributes);
                          pidlPath := pidl;
                          bWatchSubtree := true;
                      end;
            end;
     end

     // If the caller requests the entire file system be watched,
     // prepare the first NotifyElement accordingly.
     else begin
          NotifyCount := 1;
          with NotifyArray[1] do begin
              pidlPath      := nil;
              bWatchSubtree := true;
          end;
     end;

     NotifyPtr    :=  addr(NotifyArray);

     NotifyHandle :=  SHChangeNotifyRegister(
                               (Owner as TWinControl).Handle,
                                SHCNF_ACCEPT_INTERRUPTS       +
                                    SHCNF_ACCEPT_NON_INTERRUPTS,
                                EventMask,
                                fMessageNo,
                                NotifyCount,
                                NotifyPtr);

   if NotifyHandle = 0
      then begin
             Stop;
             raise Exception.Create('Could not register SHChangeNotify');
   end;
end;

// This procedure unregisters the Change Notification
procedure TSHChangeNotify.Stop;
var
   NotifyHandle   : hwnd;
   i              : integer;
   pidl           : PITEMIDLIST;
begin
   if csDesigning in ComponentState
      then exit;

   NotifyHandle := 0;

   // Deregister the shell notification.
   if NotifyCount > 0
      then SHChangeNotifyDeregister(NotifyHandle);

   // Free the PIDLs in NotifyArray.
   for i := 1 to NotifyCount do begin
      pidl := NotifyArray[i].PidlPath;
      if AllocInterface.DidAlloc(pidl) = 1
                         then AllocInterface.Free(pidl);
   end;

   NotifyCount := 0;
end;

// This is the procedure that is called when a change notification occurs.
// It interprets the two PIDLs passed to it, and calls the appropriate
// event handler, according to what kind of event occurred.
procedure TSHChangeNotify.WndProc(var msg: TMessage);
type
   TPIDLLIST = record
      pidlist : array[1..2] of PITEMIDLIST;
   end;
   PIDARRAY = ^TPIDLLIST;
var
   Path1    : string;
   Path2    : string;
   ptr      : PIDARRAY;
   p1,p2    : PITEMIDLIST;
   repeated : boolean;
   p        : integer;
   event    : longint;
   parmcount      : byte;
   OneParmEvent   : TOneParmEvent;
   TwoParmEvent   : TTwoParmEvent;

   // The internal function ParsePidl returns the string corresponding
   // to a PIDL.
   function ParsePidl (Pidl : PITEMIDLIST) : string;
   begin
      SetLength(result,MAX_PATH);
      if not SHGetPathFromIDList(Pidl,pchar(result))
          then result := '';
   end;

// The actual message handler starts here.
begin
  if Msg.Msg = WM_QUERYENDSESSION
     then QueryEndSession(Msg);

  if Msg.Msg = fMessageNo
     then begin
        OneParmEvent := nil;
        TwoParmEvent := nil;

        event := msg.LParam and ($7FFFFFFF);

        case event of
           SHCNE_ASSOCCHANGED     : TwoParmEvent := fAssocChanged;
           SHCNE_ATTRIBUTES       : OneParmEvent := fAttributes;
           SHCNE_CREATE           : OneParmEvent := fCreate;
           SHCNE_DELETE           : OneParmEvent := fDelete;
           SHCNE_DRIVEADD         : OneParmEvent := fDriveAdd;
           SHCNE_DRIVEADDGUI      : OneParmEvent := fDriveAddGUI;
           SHCNE_DRIVEREMOVED     : OneParmEvent := fDriveRemoved;
           SHCNE_MEDIAINSERTED    : OneParmEvent := fMediaInserted;
           SHCNE_MEDIAREMOVED     : OneParmEvent := fMediaRemoved;
           SHCNE_MKDIR            : OneParmEvent := fMkDir;
           SHCNE_NETSHARE         : OneParmEvent := fNetShare;
           SHCNE_NETUNSHARE       : OneParmEvent := fNetUnshare;
           SHCNE_RENAMEFOLDER     : TwoParmEvent := fRenameFolder;
           SHCNE_RENAMEITEM       : TwoParmEvent := fRenameItem;
           SHCNE_RMDIR            : OneParmEvent := fRmDir;
           SHCNE_SERVERDISCONNECT : OneParmEvent := fServerDisconnect;
           SHCNE_UPDATEDIR        : OneParmEvent := fUpdateDir;
           SHCNE_UPDATEIMAGE      : OneParmEvent := fUpdateImage;
           SHCNE_UPDATEITEM       : OneParmEvent := fUpdateItem;
           else begin
                   OneParmEvent := nil; // Unknown event;
                   TwoParmEvent := nil;
                end;
        end;
        if (assigned(OneParmEvent)) or (assigned(TwoParmEvent))
          then begin

                // Assign a pointer to the array of PIDLs sent
                // with the message.
                ptr := PIDARRAY(msg.wParam);

                // Parse the two PIDLs.
                p1 := ptr^.pidlist[1];
                try
                   SetLength(Path1,MAX_PATH);
                   Path1 := ParsePidl(p1);
                   p := pos(#00,Path1);
                   if p > 0
                      then SetLength(Path1,p - 1);
                except
                   Path1 := '';
                end;

                p2 := ptr^.pidlist[2];
                try
                   SetLength(Path2,MAX_PATH);
                   Path2 := ParsePidl(p2);
                   p := pos(#00,Path2);
                   if p > 0
                      then SetLength(Path2,p - 1);
                except
                   Path2 := '';
                end;

                // If this message is the same as the last one (which happens
                // a lot), bail out.
                try
                   repeated := (PrevMsg = event)
                                and (uppercase(prevpath1) = uppercase(Path1))
                                and (uppercase(prevpath2) = uppercase(Path2))
                except
                   repeated := false;
                end;

                // Save the elements of this message for comparison next time.
                PrevMsg    := event;
                PrevPath1  := Path1;
                PrevPath2  := Path2;

                // Convert the case of Path1 and Path2 if desired.
                case fTextCase of
                        tcUppercase : begin
                           Path1 := uppercase(Path1);
                           Path2 := uppercase(Path2);
                        end;
                        tcLowercase : begin
                           Path1 := lowercase(Path1);
                           Path2 := lowercase(Path2);
                        end;
                end;

                // Call the event handler according to the number
                // of paths we will pass to it.
                if not repeated then begin
                   case event of
                        SHCNE_ASSOCCHANGED,
                        SHCNE_RENAMEFOLDER,
                        SHCNE_RENAMEITEM   : parmcount := 2;
                   else parmcount := 1;
                   end;

                   if parmcount = 1
                      then OneParmEvent(self, event, Path1)
                      else TwoParmEvent(self, event, Path1, Path2);
                end;

        end;  // if assigned(OneParmEvent)...

  end;        // if Msg.Msg = fMessageNo...

  // Call the original message handler.
  OwnerWindowProc(Msg);
end;

procedure TSHChangeNotify.QueryEndSession(var msg: TMessage);
var
   CanEndSession : boolean;
begin
   CanEndSession := true;
   if Assigned(fEndSessionQuery)
      then fEndSessionQuery(Self, CanEndSession);
   if CanEndSession
      then begin
             Stop;
             Msg.Result := 1;
      end
      else Msg.Result := 0;
end;

destructor TSHChangeNotify.Destroy;
begin
   if not (csDesigning in ComponentState)
      then begin
             if Assigned(Owner)
               then (Owner as TWinControl).WindowProc := OwnerWindowProc;
             Stop;
   end;

   inherited;
end;

end. 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-12-14T07:42:56.917

我有一些适用于 Windows 的 Python 内容，如果您愿意，您可能有兴趣从中移植：http: [//github.com/gorakhargosh/watchdog](http://github.com/gorakhargosh/watchdog)

# .net - 用于标准 .NET 项目的 Windows Mobile dll

> ID：479776
> 
> 赞同：0
> 
> 时间：2009-01-26T13:24:47.143
> 
> 标签：.net, windows-mobile

快速问题（我希望），如何在标准网络项目中包含一个窗口 6 类库 dll？我似乎可以在早期版本的 windows mobile 项目中通过 VS 添加引用，但不能在版本 6 中添加引用。从我读到的内容，只要没有使用 CE 特定的库，它就应该是可能的。

任何帮助表示赞赏。

谢谢，克里斯。

编辑：

不是我发现的，我做了以下事情：

1）新建windows mobile 6类库（CF .NET dll）

2) 创建新的标准类库(Standard .NET dll)

3）尝试将移动6库包含到标准库中

我在这里得到：

“无法添加对的引用”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:41:35.343

如果这是一个 CF .NET dll，您可以将其添加为参考（无论是什么版本）。如果它是本机代码库，则不能。您需要围绕这个 dll 创建一个 .NET 包装器（使用 P/Invoke）并将这个 dll 添加到您的项目中。您需要注意本机 dll 在运行时是否存在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T17:14:11.327

我在这里找到了我自己的问题的答案：

[http://social.msdn.microsoft.com/Forums/en-US/vssmartdevicesvbcs/thread/c0cae024-a9a2-43bd-9d37-69bc9a9338c7/](http://social.msdn.microsoft.com/Forums/en-US/vssmartdevicesvbcs/thread/c0cae024-a9a2-43bd-9d37-69bc9a9338c7/)

事实证明，VB.NET 项目无法引用在 VB.NET 中创建的 CF 项目。都很好玩。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:36:12.303

根据我的经验，你根本*不能*，这真的很糟糕！！！编译一次，到处运行。

无论如何，我找到的一个解决方案是：

1.  在 CF 类库或 Win32 库中编码您的项目，无论哪个 (Project1)。
2.  添加另一个类型的新项目 (Project2)。
3.  复制 Project2 下的文件夹结构，使其镜像 Project1。
4.  右键单击 Project2 并选择 Add --> Existing Item...
5.  导航到 Project1 的文件夹并选择您感兴趣的所有文件（请记住选择性地避免使用 .designer.cs 文件，例如 .resx 的 .designer.cs）。
6.  在添加按钮 (Add | **V** ) 的右侧，您将看到一个向下的箭头，单击它。
7.  添加为链接。
8.  对 Project2 下的所有文件夹重复相同的过程。

关键是即使您现在有两个程序集，对 cs 文件的任何更改都会反映在所有程序集中。这就是 XNA GameStudio 做事的方式，也是我过去为手机使用 CF 的方式。

一旦你完成了最初的“移植”，事情就会很快进行。CF 项目应该有一个调试符号（POCKETPC 或 SMARTPHONE IIRC），但我建议您添加 MOBILE，以便您可以在 PocketPC 和 SmartPhone 项目之间共享 CF 代码。

我正在考虑编写一个镜像项目的工具，如果你有兴趣在评论中说出来，我会抽出时间来做（现在我没有处理任何 CF 的东西）。

也应该可以使用 MSBUILD 任务自动执行此操作。但不幸的是，通过在构建时生成一个 csproj 文件，人们在代码时失去了智能感知。

# vb.net - 可以覆盖 VB.NET 根命名空间吗？

> ID：479782
> 
> 赞同：16
> 
> 时间：2009-01-26T13:26:20.493
> 
> 标签：vb.net, namespaces

VB.NET 自动将项目属性中设置的根命名空间作为每个类的命名空间的前缀。这与 C# 不同，在 C# 中，每次都必须声明完整的命名空间。

是否可以覆盖此行为，在根名称空间之外创建名称空间？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T13:35:45.280

如果我理解正确，您只需要在项目属性对话框中设置一个空白名称空间，然后使用开始/结束名称空间命令在每个源文件中设置名称空间。

从 VS2012 开始，可以解决这个问题，请参阅[stackoverflow.com/a/17360357/233095](https://stackoverflow.com/a/17360357/233095)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-26T13:39:35.270

将项目的默认值定义为空白，然后在每个类中完全控制允许您执行 c# 所做的事情。但是，某些项目类型（我相信是库）不允许您将默认命名空间更改为空白。

使用 Global 关键字也不允许您跳出根名称空间：http: [//msdn.microsoft.com/en-us/library/16czfx55.aspx](http://msdn.microsoft.com/en-us/library/16czfx55.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-06-28T08:30:06.820

他们现在实现[了它](https://connect.microsoft.com/VisualStudio/feedback/details/484455/allow-escaping-root-namespaces-in-vb)：

```
Namespace Global.MyNamespace

End Namespace 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-26T13:37:11.610

您可以通过转到项目的属性来更改整个项目的命名空间。否则，您将必须有一个空的根命名空间，并在每个文件中使用

```
Namespace test
    class.....
End Namespace 
```

# sharepoint - 从其他列表中提取的 SharePoint 列表

> ID：479784
> 
> 赞同：5
> 
> 时间：2009-01-26T13:26:33.330
> 
> 标签：sharepoint, list

有人可以指出我将如何执行以下操作的方向：

我想创建一个列表，它从其他列表（多个）中提取（前 3 个）项目，并将它们显示在一个合并列表中。这可能吗？如果是这样，请指出我如何做到这一点的方向，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T21:30:33.247

Oliver，只要您的所有列表都在同一个网站集中，内容查询 Web 部件就应该做您想做的事情（[引用](http://office.microsoft.com/en-us/sharepointdesigner/HA101741341033.aspx)）。您将需要一些 XSLT 方面的专业知识来保持显示前三个列表项（[示例](http://www.heathersolomon.com/blog/articles/CustomItemStyle.aspx)）。CQWP 有很多事情没有这样做，这似乎是常识，这就是其中之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T21:35:21.363

Ray，我不确定查找字段将如何处理他的两个主要要求：限制返回集（前三项）或将多个列表合并到一个数据源中。查找列接受一个列表作为数据源，除了自定义代码开发之外，我不确定您如何让它接受许多列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:37:40.313

如果您有 MOSS，那么您需要的是 Content Query Web Part。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T01:24:56.127

如果不使用自定义代码，您将不得不使用多个数据查询或内容查询 Web 部件并修改它们的 xslt 以显示为一个集成显示。

我个人会创建一个自定义控件，由运行多个 CAML 查询并显示每个查询的最佳结果的 web 部件托管。

# wpf - WPF新手问题

> ID：479785
> 
> 赞同：0
> 
> 时间：2009-01-26T13:26:41.303
> 
> 标签：wpf

我正在尝试学习 WPF 动画，目前对很多事情感到困惑：

我使用了诸如处理之类的工具，您有一个简单的方法，称为每分钟 n 次，其中 n 是帧速率。

在 WPF 中做动画的方法是修改一个属性。如果我使用例如 DoubleAnimation ，那么随着动画的进行会增加一个 double 。但这并不是我想要的。我希望在每个周期中都会增加一些属性，一些是随机修改的，一些是通过用户交互修改的。如何在 WPF 中做到这一点？

让我感到困惑的是 WPF 同时支持多个动画这一事实。这是如何运作的？每个动画都有一个线程还是所有动画只有一个线程。

前段时间我在 c# 中使用了 gdi。我什至可以使用多个线程进行绘图；据我记得，我只需要在某个队列中插入所有绘图命令，然后 Windows 就会处理它们。我不知道 WPF 是如何处理的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T13:36:32.750

在基本层面上，WPF 动画与任何其他类型的动画一样：内部有一个计时器滴答声，并且修改了一些属性，这些属性在绘制到屏幕上时会导致不同的图片。

WPF 为您完成所有工作，以便能够指定相对于挂钟时间的动画，例如“以每秒 3 毫米的速度向左移动该框”。对于更复杂的场景，您可能想要编写自己的动画，请参阅 MSDN 上的[自定义动画概述](http://msdn.microsoft.com/en-us/library/aa970564.aspx)文章。

关于线程，WPF 的工作方式与 GDI 相同：有一个`Thread`处理与 WPF 模型的所有交互，如果您在此线程上运行，您只能与 WPF 控件对话。如果您是自由线程，则可以使用[Dispatcher](http://msdn.microsoft.com/en-us/library/ms750441.aspx#System_Threading_DispatcherObject)将代码“发送”到该线程。DirectX 的实际绘图是在一个单独的线程中完成的，但这对于 API 的普通用户来说无关紧要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T15:45:30.167

您可以通过将它们放入 StoryBoard 中来同时运行多个动画。

您可以使用动画的 BeginTime 让一个动画一个接一个地开始。

您可以使用关键帧版本 (DoubleAnimationUsingKeyFrames) 或路径版本 (DoubleAnimationUsingPath) 来创建复杂的非线性动画。

# eclipse - Eclipse Ganymede - 与 Tomcat 6 的集成（没有整个 WTP）

> ID：479789
> 
> 赞同：4
> 
> 时间：2009-01-26T13:28:25.887
> 
> 标签：eclipse, tomcat, eclipse-plugin

如果我从[Eclipse IDE for Java Developers (85 MB)](http://www.eclipse.org/downloads/) (Ganymede) 开始安装。我需要安装哪些插件才能：

*   查看服务器选项卡并能够添加我的 Tomcat 6 安装。
*   能够创建一个我可以连接到我的服务器的动态 Web 项目。
*   我希望能够启动和停止服务器。
*   在我的控制台选项卡中查看服务器标准输出。
*   在服务器上调试应用程序。

我想尽量少装，只要能做到以上几点我就满足了。

特别是因为我在使用完整的 Web 工具平台 (WTP) 时遇到了问题；据*我说*，它充满了与验证相关的错误。它有时会说有效文件无效，如果您只是重新启动 Eclipse，通常会有所帮助。我还发现它忽略了排除，有时甚至完全忽略了我已经一起禁用了验证。

我遇到的问题使我对 WTP 项目中的任何东西都不感兴趣，*除了*插件使我能够通过完成上述无序列表更顺利地工作（因为 WTP 的那部分工作得非常好）。

我听说有些人使用[Sysdeo Eclipse Tomcat Launcher Plug-in](http://www.eclipsetotale.com/tomcatPlugin.html)和 Ganymede 取得了成功。但由于它不受官方支持，并且自 2007 年 5 月以来没有发布新版本，并且使用 Ganymede 运行它涉及更改插件文件以接受 >=3.4 的版本，我不认为它是一个长期解决方案。

安装**WTP**的**一部分**而**不是整体**安装感觉像是一个长期的解决方案，同时跳过了 WTP 中充满错误的部分。但是我需要关于需要安装哪些部件的帮助，因为 Eclipse.org 上的文档没有解释。当然，如果除了使用 WTP 的一部分之外，还有其他受支持的解决方案，那么这也很有趣！

 ***** * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:51:03.673

当我为 显示“eclipse 插件依赖项”视图时`org.eclipse.jst.server.tomcat.ui`，我看到：

*   org.eclipse.wst.common.emf
*   org.eclipse.wst.common.emfwrokben.integration
*   org.eclipse.wst.common.environment
*   org.eclipse.wst.common.frameworks
*   org.eclipse.wst.common.modulecore
*   org.eclipse.wst.common.project.facet.core
*   org.eclipse.wst.common.project.facet.ui
*   org.eclipse.wst.common.uriresolver
*   org.eclipse.wst.internet.monitor.core
*   org.eclipse.wst.server.core
*   org.eclipse.wst.server.ui
*   org.eclipse.wst.validation

因此，如果您可以`org.eclipse.jst.server.tomcat.ui`通过 p2 选择并让“更新过程”为您选择依赖项，那么您最终应该得到在 Eclipse（使用 WTP）上运行/管理 Tomcat 所需的最少插件集。

# .net - 将 Linq 中的外键设置为 SQL

> ID：479791
> 
> 赞同：9
> 
> 时间：2009-01-26T13:29:53.917
> 
> 标签：.net, vb.net, linq-to-sql

众所周知，如果实体已经加载，则不能直接在 Linq to SQL 中设置外键 ID。但是，您可以通过实体的外键查找实体，然后使用实体关系将该实体设置为外部实体。（为了简单起见，我在这里取出了枚举并使用了整数值）。即，如果我有一个加载的约会实体和一个关联的 AppoinmentStatus 实体，我不能这样做：-

```
ExistingAppointment.AppointmentStatusID = 7 
```

但我可以这样做：-

```
ExistingAppointment.AppointmentStatus = (From appstat In db.AppointmentStatus _
                                        Where appstat.StatusID = 7 _
                                        Select appstat).Single 
```

我有这种东西乱扔我的代码，我想重构。所以...

我显然可以在这样的模块中使用辅助方法：-

```
 Module Helper
    Public Shared Function GetAppointmentStatus(ByVal AppStatusID As Integer) As AppointmentStatus
        GetAppointmentStatus = (From appstat In db.AppointmentStatus _
                                       Where appstat.AppointmentStatusID = AppStatus _
                                       Select appstat).Single
    End Function
End Module 
```

我什至可以把它变成一个扩展方法，就像这样。

```
 Imports System.Runtime.CompilerServices
Module Helper
Extension()> _
    Public Shared Function GetAppointmentStatus(ByVal db as DataClassesDataContext, ByVal AppStatusID As Integer) As AppointmentStatus
        GetAppointmentStatus = (From appstat In db.AppointmentStatus _
                                       Where appstat.AppointmentStatusID = AppStatusID _
                                       Select appstat).Single
    End Function
End Module 
```

我也可以把它放在 Linq to SQL 部分类中，就像这样。

```
 Partial Public Class DataClassesDataContext    
    Public Function GetAppointmentStatus(ByVal AppStatusID As Integer) As AppointmentStatus
        GetAppointmentStatus = (From appstat In Me.AppointmentStatus _
                                       Where appstat.AppointmentStatusID = AppStatusID _
                                       Select appstat).Single
    End Function
End Class 
```

此外，我可以将代码放在 Linq to SQL Appointment Entity 部分类中，如下所示：-

```
 Partial Public Class Appointment    
    Public Function GetAppointmentStatus(ByVal db as DataClassesDataContext, ByVal AppStatusID As Integer) As AppointmentStatus
            GetAppointmentStatus = (From appstat In db.AppointmentStatus _
                                       Where appstat.AppointmentStatusID = AppStatusID _
                                       Select appstat).Single
    End Function
End Class 
```

我应该做什么，为什么，或者有更好的选择？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-31T02:27:26.183

对此有两种主要的思想流派：

1.  将逻辑放入`DataContext`（部分类，或者如果您`DataContext`手动编写代码，则为实际类）。这背后的基本原理是您`DataContext`已经知道所有不同的实体，因此这不会产生任何额外的耦合，也不会导致类膨胀。

    当然，缺点是如果你有几百个这样的 API 方法（而且你最终可能会），那么你`DataContext`很快就会变成一团泥，里面塞满了任何程序员决定投入的每一个随机查询 API . 你可以尝试通过将相关函数分离到同一个部分类的不同实例中来清理它`DataContext`，但这实际上只是一个表面上的改进。

2.  将逻辑放在存储库类中，即`AppointmentRepository`. 这种方法的两个优点是（a）能够在存储库和 IoC 框架上使用依赖注入，以防您决定更改数据模型，以及（b）您坚持[单一责任原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)这一事实-将方法放在它所在的位置实际上是*有意义的。*

    将这些放在存储库中的主要缺点是：（a）它们可能会复制非常相似的逻辑，这些逻辑已经在您`DataContext`的存储过程中；(b) 在交易管理方面，他们有一种让人头疼的方式（如果您还使用它们来保存）；(c) 当您开始有大量自定义查询返回针对特定操作或报告的特别定制的 DTO 时，您将面临两个糟糕的选择，要么为每个 DTO 创建一个存储库，要么创建一个主所有 DTO 或其中一些松散相关组的“实用程序”存储库。两者最终都是一个相当糟糕的设计。

这些是权衡；只有您可以决定哪个更适合您自己的目的。

我绝对建议*不要**使用*扩展方法方法，因为扩展方法很难发现（你不能只键入方法并让 Intellisense 获取相关参考），而且当你有能力时它们也根本没有必要直接修改或扩展（通过部分）原始类。

我还建议不要扩展`Appointment`课程；我们使用 Linq To SQL 之类的工具的原因之一是我们可以处理不需要知道它们来自何处的 POCO*实体*。出于这个原因，我个人非常反对将实体类与其耦合`DataContext`——依赖关系应该是单向的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-31T01:55:02.203

我通常将这些方法放在DataContext的分部类中，理论上这些方法在某种意义上类似于存储过程，并且存储过程表现为DataContext上的方法。

无论您决定采用哪种方式，都绝对值得重构，以便您只在一个地方拥有此查询并且不要重复自己。这也使您可以选择用更复杂的方法替换您描述的简单方法，该方法缓存查询的编译版本并重用它，而无需更新该方法的所有调用者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-10T08:39:51.913

通常 AppointmentStatusId 的设置器看起来像：（C#中的代码，但应该很容易得到它）

```
[Column(Storage="_AppointmentStatusId", DbType="Int")]
public System.Nullable<int> AppointmentStatusId
{
    get
    {
        return this._AppointmentStatusId;
    }
    set
    {
        if ((this._AppointmentStatusId != value))
        {
            if (this._AppointmentStatus.HasLoadedOrAssignedValue)
            {
                throw new System.Data.Linq.ForeignKeyReferenceAlreadyHasValueException();
            }
            this.OnCapabilityIdChanging(value);
            this.SendPropertyChanging();
            this._AppointmentStatusId = value;
            this.SendPropertyChanged("AppointmentStatusId");
            this.OnCapabilityIdChanged();
        }
    }
} 
```

所以，如果我是你，我会在设计器生成的部分文件中添加一个方法 SetAppointmentStatusId(int statusId) ，并在需要时为其他属性添加更多。您甚至可以选择将属性的设置器设为私有（从设计器中选择属性并按 F4 键以打开 VS 属性窗口以更改可访问性）。
在这种方法中，我将编写与 setter 相同的代码，只是它不包含此部分：

```
 if (this._AppointmentStatus.HasLoadedOrAssignedValue)
            {
                throw new System.Data.Linq.ForeignKeyReferenceAlreadyHasValueException();
            } 
```

# eclipse - JavaMe deploy

> ID：479798
> 
> 赞同：8
> 
> 时间：2009-01-26T13:32:06.223
> 
> 标签：eclipse, deployment, java-me, lwuit

Im using Eclipse 3.4, EclipseMe 1.7.9\. Im trying to deploy/"create package" a simple project with an external .jar file ([LWUIT.jar](https://lwuit.dev.java.net/)) included. When I try to create the package with the the .jar file exported (Properties -> Java build path -> order and export) I receieve the following error msg: "Error during build"

(Details: Errors during build. Errors running builder 'Preverification' on project 'Try'. org.eclipse.jdt.internal.core.JavaModel.getTarget(Lorg/eclipse/core/resources/IContainer;Lorg/eclipse/core/runtime/IPath;Z)Ljava/lang/Object; org.eclipse.jdt.internal.core.JavaModel.getTarget(Lorg/eclipse/core/resources/IContainer;Lorg/eclipse/core/runtime/IPath;Z)Ljava/lang/Object; )

How to make the build succeed?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-26T14:14:13.593

It seems to be a [known issue on Eclipse 3.4](http://www.mail-archive.com/eclipseme-users@lists.sourceforge.net/msg01254.html).

At the time of the thread mentionned above (July 2008), adding the url [http://eclipseme.org/testversions](http://eclipseme.org/testversions) to the software updates list, and upgraded to eclipseMe 1.8 did solve the issue.

Could you check if you can upgrade eclipseMe and still reproduce the problem ?

# c# - 替换 Uri 中的主机

> ID：479799
> 
> 赞同：97
> 
> 时间：2009-01-26T13:32:21.323
> 
> 标签：c#, .net, uri

使用 .NET 替换 Uri 的主机部分的最佳方法是什么？

IE：

```
string ReplaceHost(string original, string newHostName);
//...
string s = ReplaceHost("http://oldhostname/index.html", "newhostname");
Assert.AreEqual("http://newhostname/index.html", s);
//...
string s = ReplaceHost("http://user:pass@oldhostname/index.html", "newhostname");
Assert.AreEqual("http://user:pass@newhostname/index.html", s);
//...
string s = ReplaceHost("ftp://user:pass@oldhostname", "newhostname");
Assert.AreEqual("ftp://user:pass@newhostname", s);
//etc. 
```

System.Uri 似乎没有多大帮助。

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-01-26T13:36:43.497

[System.UriBuilder](https://docs.microsoft.com/en-us/dotnet/api/system.uribuilder)是您所追求的...

```
string ReplaceHost(string original, string newHostName) {
    var builder = new UriBuilder(original);
    builder.Host = newHostName;
    return builder.Uri.ToString();
} 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2012-08-18T10:42:29.893

正如@Ishmael 所说，您可以使用 System.UriBuilder。这是一个例子：

```
// the URI for which you want to change the host name
var oldUri = Request.Url;

// create a new UriBuilder, which copies all fragments of the source URI
var newUriBuilder = new UriBuilder(oldUri);

// set the new host (you can set other properties too)
newUriBuilder.Host = "newhost.com";

// get a Uri instance from the UriBuilder
var newUri = newUriBuilder.Uri; 
```

# css - IE6 项目符号点对齐问题

> ID：479800
> 
> 赞同：0
> 
> 时间：2009-01-26T13:32:32.570
> 
> 标签：css, internet-explorer-6

我目前`<li>`在 IE6 中遇到一些问题，基本上我的代码看起来像这样，

```
<ul>
  <li>some filler text some filler text</li>
  <li>some filler text some filler text</li>
  <li>some filler text some filler text</li>
</ul> 
```

当我在 IE 6 中查看页面时，问题就出现了，项目符号和文本没有像你期望的那样排列有没有人遇到过这个问题，这里记录的是 div 和 li 相关的 CSS。

```
#contentMiddle li
{
    /*background-image:url(../images/bullet.gif);
    background-repeat:no-repeat;
    background-position:left bottom;
    text-align:left;
    list-style-position:outside;*/
    list-style-image:url(../images/bullet.gif);
    list-style-position:inside;
    text-align:left;
    margin-bottom:5px;
}

#contentMiddle
{
    background-color:#A3BAD9;
    padding-left:20px;
    padding-right:20px;
} 
```

感谢您的帮助

sico87 :-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:48:35.850

您应该决定是否要使用 background-image 或 list-style-image 来添加项目符号。正如您已经看到的，我建议使用背景图像解决方案，因为另一个在 IE6 中存在问题。

# c++ - Visual C++ 2008 Express Edition 创建新项目时出错

> ID：479805
> 
> 赞同：0
> 
> 时间：2009-01-26T13:33:52.320
> 
> 标签：c++, visual-c++

我已经在 Vista Home Premium 上安装了 Visual C++ 2008 Express Edition，每当我尝试创建一个新项目时，无论哪种类型（CLR、控制台、Win32、空项目）我都会得到“正在创建项目'项目名称'......项目创建失败的。” 但是我可以打开一个现有的解决方案。
所以基本上我的 Visual C++ 是没用的。

知道我能做些什么来让它工作吗？我讨厌需要重新安装整个操作系统才能使其正常工作。

我尝试多次卸载并再次安装。同样的错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T18:46:38.210

按照本指南中的步骤解决：[http](http://masteranza.wordpress.com/2008/12/27/solution-vs-c-2008-project-creation-failed-bug/) ://masteranza.wordpress.com/2008/12/27/solution-vs-c-2008-project-creation-failed-bug/经过**大量**谷歌搜索

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T18:07:11.423

检查您是否有权访问要保存您的解决方案的目录。

# javascript - 在处理的 javascript 版本中打印出错误消息

> ID：479809
> 
> 赞同：2
> 
> 时间：2009-01-26T13:36:17.540
> 
> 标签：javascript, processing, processing.js

长话短说，我必须在课堂上使用处理，而我完全失明。该 ide 完全无法访问，因此我使用 JavaScript 版本的处理来创建一个页面，并让一个站点人员向我描述输出。不幸的是，如果代码有错误，页面会显示为空白，并且没有说明错误的原因。鉴于以下代码，JavaScript 版本的处理是否有办法告诉我，因为我忘记了，所以我有语法错误）；

```
void setup()
{
  size(500, 500);
}

void draw()
{
  line(250, 200, 250, 40
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T13:52:59.863

对于调试（当代码编译时），您可以使用 println() 命令。

我已经使用处理 2 个月了，我遇到了同样的问题，但无法找到解决方案。

在 SO 中，我看到几乎没有人使用 Processing 或知道如何使用它。您可以尝试处理论坛，通常会在一两天内得到答复。你可以在这里找到[http://processing.org/discourse/](http://processing.org/discourse/)

很抱歉无法提供帮助。我看到的另一个唯一解决方案是如果您使用他们的 PDE（Processsing 开发环境）并在那里编译它。

编辑：根据以前提出处理问题的经验，您甚至不会有太多人调查您的问题:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T10:10:23.903

带有语法高亮的 js 编辑器（例如 Aptana）会向您显示错误，例如您所遇到的错误。

不过，我不知道您是否会发现它比处理 ide 本身更有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-28T18:55:25.793

在浏览器中打开页面时，请确保已打开**开发人员工具**。它们随每个主要浏览器一起提供（查看工具菜单），并包括一个**JavaScript 控制台**。这将包括您从 Processing.js 解析器获得的任何错误。

我不确定是否有更多可访问的开发者工具版本，但那将是一个很好的起点。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2017-11-21T02:08:50.403

在 processing.js 中，使用 createCanvas(); 而不是大小，因此： createCanvas(500, 500);

# c++ - 网络库 + 助手 (c++)

> ID：479816
> 
> 赞同：1
> 
> 时间：2009-01-26T13:36:57.710
> 
> 标签：c++, networking

是否有任何非常有用且强大的 C++ 网络库？和库来帮助他们更好地运行？使用 << 时自动进行字节序转换，阻止读取直到结构或 w/e 读取完全传输，帮助调试协议等

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T14:07:07.493

你看过[Boost.Asio](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html)吗？它是一个支持异步和同步操作的网络库。过去我用它做了一些实验，发现它非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T14:24:14.633

我喜欢[自适应通信环境](http://www.cs.wustl.edu/~schmidt/ACE.html)。它内置了几乎所有网络模式的结构。我特别喜欢 ACE_Task。它使消息传递**变得**更加容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:24:04.917

我建议使用套接字...如果您使用它，它很容易为 Win32/*nix 制作跨平台代码，尽管它的级别很低，但它确实提供了阻塞功能（即暂停执行直到收到消息）。有大量可用的套接字编程教程......只需谷歌搜索“套接字”或“WinSock”（Win32 风格）。

[http://www.google.co.uk/search?q=sockets+programming](http://www.google.co.uk/search?q=sockets+programming)

它不会为您处理字节序，但是有许多简单的方法可以解决这个问题，例如在消息的开头使用签名字节/字（例如 0xC1 (11000001b)、0x00C1）来确定字节序-性。

# events - 如何在 SharePoint 上的 ItemAdded() 事件上检测项目还原

> ID：479817
> 
> 赞同：3
> 
> 时间：2009-01-26T13:37:02.593
> 
> 标签：events, sharepoint, recycle-bin

我知道当从回收站中恢复一个项目时，会触发 ItemAdded 事件。但是，如何检测添加的项目是来自回收站还是新文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-08-23T15:44:23.823

这是一个非常古老的线程，但它出现在该主题搜索的顶部结果中。

从我对 SP2010 的实验来看，当项目来自回收站时，它看起来像[properties.AfterProperties是空的，而它完全填充在实际的新项目上。](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spitemeventproperties.afterproperties.aspx)

因此，像这样的简单块就可以了：

```
if (!properties.AfterProperties.Cast<DictionaryEntry>().Any())
{
    // From Recycle Bin!
}
else
{
    // This item is really new.
} 
```

我还没有测试过 MOSS 或 SP2013。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T02:31:34.283

如果您想手动检测它，请检查文档的属性：创建的数据不同。对于一个文档，即使它被扔进回收站，创建的数据也是一样的。如果您想通过某种工作流程来做到这一点，那么您可以将属性设置为基准。更多细节请自行查找。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T16:21:19.140

您可以检查项目的创建日期。回收站中的项目应该有一个以前的创建日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T20:50:06.867

回收站中的项目有一个 DeletedDate，它可能在 properties.BeforeProperties 中可用

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-04-18T15:23:15.310

检查 SPItemEventProperties.ListItemId 属性的值：

*   如果为0，则为新项；
*   如果不是 0，那么它是从回收站恢复的项目。

# sql - 批量插入、SQL Server 2000、unix 换行符

> ID：479819
> 
> 赞同：35
> 
> 时间：2009-01-26T13:37:17.240
> 
> 标签：sql, sql-server, bulkinsert

我正在尝试将 .csv 文件插入到带有 unix 换行符的数据库中。我正在运行的命令是：

```
BULK INSERT table_name
FROM 'C:\file.csv' 
WITH 
( 
    FIELDTERMINATOR = ',', 
    ROWTERMINATOR = '\n' 
) 
```

如果我将文件转换为 Windows 格式，加载工作，但如果可以避免，我不想做这个额外的步骤。有任何想法吗？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2010-11-17T17:03:15.807

我觉得有必要做出贡献，因为我遇到了同样的问题，而且我每天至少需要从 SAP 读取 2 个 UNIX 文件几次。因此，我不需要使用 unix2dos，而是需要人工干预更少、通过编程更自动化的东西。

如前所述，Char(10) 在 sql 字符串中工作。我不想使用 sql 字符串，所以我使用了 ''''+Char(10)+''''，但由于某种原因，这没有编译。

工作得非常顺利的是：with (ROWTERMINATOR = '0x0a')

问题用 Hex 解决了！

希望这可以帮助某人。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-26T14:16:06.540

感谢所有回答的人，但我找到了我喜欢的解决方案。

当您告诉 SQL Server ROWTERMINATOR='\n' 时，它会将其解释为 Windows 下的默认行终止符，实际上是“\r\n”（使用 C/C++ 表示法）。如果您的行终止符真的只是“\n”，您将不得不使用下面显示的动态 SQL。

```
DECLARE @bulk_cmd varchar(1000)
SET @bulk_cmd = 'BULK INSERT table_name
FROM ''C:\file.csv''
WITH (FIELDTERMINATOR = '','', ROWTERMINATOR = '''+CHAR(10)+''')'
EXEC (@bulk_cmd) 
```

为什么你不能说 BULK INSERT ...(ROWTERMINATOR = CHAR(10)) 超出了我的范围。看起来您不能评估命令的 WITH 部分中的任何表达式。

上面所做的是创建一个命令字符串并执行它。巧妙地回避了创建附加文件或执行额外步骤的需要。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-17T21:27:05.980

我确认语法

```
ROWTERMINATOR = '''+CHAR(10)+''' 
```

与 EXEC 命令一起使用时有效。

如果您有多个 ROWTERMINATOR 字符（例如管道和 unix 换行符），则其语法为：

```
ROWTERMINATOR = '''+CHAR(124)+''+CHAR(10)+''' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-28T12:04:23.663

它比这更复杂一点！当您告诉 SQL Server ROWTERMINATOR='\n' 时，它会将其解释为 Windows 下的默认行终止符，实际上是“\r\n”（使用 C/C++ 表示法）。如果您的行终止符真的只是“\n”，您将不得不使用上面显示的动态 SQL。我刚刚花了一个小时的大部分时间弄清楚为什么 \n 在与 BULK INSERT 一起使用时并不真正意味着 \n！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T14:00:19.940

一种选择是使用[bcp](http://msdn.microsoft.com/en-us/library/aa174646.aspx)，并设置一个控制文件`'\n'`作为换行符。

尽管您已表示不希望这样做，但另一种选择是使用[unix2dos](http://en.wikipedia.org/wiki/Unix2dos)将文件预处理为带有`'\r\n'`换行符的文件。

最后，您可以使用 上的`FORMATFILE`选项`BULK INSERT`。这将使用 bcp 控制文件来指定导入格式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T14:10:17.457

在我看来，可以采取两种一般途径：在 SQL 脚本中读取 CSV 或预先转换 CSV 的多种方法（bcp，unix2dos，如果它是一个 -时间之王，您甚至可以使用代码编辑器为您修复文件）。

但是你将不得不有一个额外的步骤！

如果此 SQL 是从程序启动的，您可能希望转换该程序中的行尾。在这种情况下，您决定自己编写转换代码，您需要注意以下几点： 1\. 行尾可能是 \n 2\. 或 \r\n 3\. 甚至是 \r (Mac!) 4.很遗憾，可能有些行有 \r\n 而其他行有 \n，除非您控制 CSV 的来源，否则任何组合都是可能的

好的好的。可能性4是牵强的。它发生在电子邮件中，但这是另一回事。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T14:37:11.100

我认为“ROWTERMINATOR = '\n'”会起作用。我建议在显示“隐藏字符”的工具中打开文件，以确保该行像您想象的那样被终止。我使用记事本++来处理这样的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T16:48:51.660

归结为这一点。Unix 使用 LF (ctrl-J)，MS-DOS/Windows 使用 CR/LF (ctrl-M/Ctrl-J)。

当您在 Unix 上使用 '\n' 时，它会被转换为 LF 字符。在 MS-DOS/Windows 上，它被翻译成 CR/LF。当您的导入在 Unix 格式的文件上运行时，它只看到一个 LF。因此，首先通过 unix2dos 运行文件通常更容易。但是正如您在原始问题中所说的那样，您不想这样做（我认为您不能这样做是有充分理由的）。

为什么你不能这样做：

```
(ROWTERMINATOR = CHAR(10)) 
```

可能是因为在解析 SQL 代码时，它没有将 char(10) 替换为 LF 字符（因为它已经包含在单引号中）。或者也许它被解释为：

```
(ROWTERMINATOR =
     ) 
```

当您回显@bulk_cmd 的内容时会发生什么？

# excel - SWT OleClientSite：如何在 Excel 中加载 XML 文件？

> ID：479822
> 
> 赞同：1
> 
> 时间：2009-01-26T13:38:38.550
> 
> 标签：excel, swt, ole

我有一个 OfficeML 格式的 Excel 文件，MyData.xls。由于我从 Office 2003 升级到 Office 2007，我收到一条警告消息，指出文件内容与文件扩展名不匹配。看来 OfficeML 现在必须具有扩展名“xml”。

在我的应用程序中，我使用 OleClientSite 在 OleFrame 对象中显示文件。如果我将文件扩展名更改为“xml”，则不会启动 Excel。如果我将扩展名保留为“xsl”，则会收到上述警告消息。

如何强制使用 Excel 在 OleFrame 中打开扩展名为“xml”的文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T18:48:45.570

最简单的解决方案是切换回 2003 格式，这不需要对您的应用程序进行任何更改。为此，请打开扩展名为 *.xls 的文件。当出现警告提示（“...您现在要打开文件吗？”）时，继续打开（这是一个警告，以确保您不会无意中打开启用宏的文件）。在 Excel 中打开文件后，只需将其另存为 *.xls。这可以通过转到“Office 按钮/另存为/Excel 97-2003 工作簿”来完成。

现在，更难的解决方案是升级您的应用程序以处理新的 OfficeML 格式。我不知道您正在使用的组件，但它可能仍然适用于新标准中的某些二进制部分（最值得注意的是 VBA 项目），但您将不得不解压缩并开始读取 XML 文件.

如果您还没有这样做，请创建一个新的 Excel 工作簿，将其保存为 *.xlsx（2007 格式），然后在资源管理器中，将其扩展名更改为 *.zip。打开它，看看周围。为了更深入地了解这些文件，我将开始消化这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa338205.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:25:35.220

也许我遗漏了一些东西，但你不应该只`.xslx`用作你的扩展吗？我假设通过 OfficeML，您指的是[Office Open XML](http://en.wikipedia.org/wiki/Office_Open_XML)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-18T14:26:40.037

`<?mso-application progid="Excel.Sheet"?>`应该出现在使用的 XSL 模板中。下面的链接清楚地解释了如何包含处理指令。我必须做类似的事情，它对我有用。

[http://www.shareyourwork.org/roller/ralphsjavablog/entry/generating_excel_sheets_with_xslt](http://www.shareyourwork.org/roller/ralphsjavablog/entry/generating_excel_sheets_with_xslt)

# java - 在java中修剪日文字符串的问题

> ID：479825
> 
> 赞同：5
> 
> 时间：2009-01-26T13:39:54.257
> 
> 标签：java, string, nlp

我有以下字符串（日语）“ yuーザー名”，第一个字符是“like”空格，但它在 unicode 中的数字是 12288，所以如果我这样做 “ yuーザー名”.trim() 我得到相同的字符串（trim 没有不工作）。如果我在 C++ 中进行修剪，它可以正常工作。有谁知道如何在java中解决这个问题？unicode有特殊的修剪方法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T14:25:50.967

作为`StringUtils`Mike 提到的类的替代方案，您还可以使用 Unicode 感知正则表达式，仅使用 Java 自己的库：

```
"　ユーザー名".replaceAll("\\p{Z}", "") 
```

或者，实际上只修剪，而不是删除字符串中的空格：

```
"　ユーザ ー名 ".replaceAll("(^\\p{Z}+|\\p{Z}+$)", "") 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-26T14:13:05.797

看看[Unicode Normalization](http://www.unicode.org/charts/normalization/index.html)和[Normalizer](http://java.sun.com/javase/6/docs/api/java/text/Normalizer.html)类。该类是 Java 6 中的新类，但如果您使用的是较早的 JRE ，您会在[ICU4J](http://icu-project.org/)库中找到等效版本。

```
 int character = 12288;
    char[] ch = Character.toChars(character);
    String input = new String(ch);
    String normalized = Normalizer.normalize(input, Normalizer.Form.NFKC);

    System.out.println("Hex value:\t" + Integer.toHexString(character));
    System.out.println("Trimmed length           :\t"
            + input.trim().length());
    System.out.println("Normalized trimmed length:\t"
            + normalized.trim().length()); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T13:48:32.007

试试 Apache Commons 的[StringUtils](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringUtils.html)类。StringUtils.strip() 方法应该适合您。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T13:47:41.760

从 java 文档中，它解释了为什么这不起作用。

> 如果此 String 对象表示一个空字符序列，或者此 String 对象表示的字符序列的第一个和最后一个字符的代码都大于 '\u0020'（空格字符），则返回对该 String 对象的引用。

你可以很容易地扮演你自己的版本。也许方法 codePointAt 可以用于此目的。

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T13:47:48.407

您必须`trim()`根据`Character.isWhitespace()`- 不幸的是，`trim()`它没有按照其 API 文档声称的那样编写自己的方法：它只去除 ASCII 空格，而不是任何其他类型的空格。

# asp.net - 动态gridview删除按钮未显示

> ID：479827
> 
> 赞同：1
> 
> 时间：2009-01-26T13:40:29.090
> 
> 标签：asp.net, gridview, dynamic

我有一个从数据库表动态创建网格视图的 ASPX 页面。每次在回发时创建 gridview 时，我都会将 AutoGenerateDeleteButton 属性设置为 true。但是，第一次创建 gridview 时，没有显示删除按钮。我写了 AutoGenerateDeleteButton 的值，它是 True。当我向 gridview 添加第二行时，会显示删除按钮。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:05:45.093

您最初是在绑定事件触发后创建网格视图吗？

如果是这样，在 gridview 的绑定事件期间创建的任何控件都不会触发，这可以解释为什么不显示删除按钮。

澄清一下：您的问题实际上表明删除按钮第一次和第二次都显示。我猜这是第一次不显示？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T16:14:37.890

确保在绑定之前添加删除按钮。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T16:26:21.393

我没有将 AutoGenerateDeleteButton 设置为“true”，而是动态创建了一个 CommandField 并将其作为列添加到 gridview。这似乎每次都有效。但感谢您的建议。

# windows - 如何在 64b 操作系统上执行 Xperf 调用堆栈捕获？

> ID：479832
> 
> 赞同：3
> 
> 时间：2009-01-26T13:42:01.007
> 
> 标签：windows, performance, profiling, 64-bit, xperf

我已经从 Windows SDK 安装了 Xperf 性能分析器，并使用以下命令捕获了文档中描述的跟踪：

```
xperf -on SysProf -stackwalk profile 
```

尽管如此，堆栈跟踪不包含任何调用堆栈数据。

我的平台是 Vista 64b。在 64b Windows 上捕获调用堆栈是否需要任何特殊设置或技巧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T14:00:57.117

经过一番搜索，我找到了一个设置：

设置注册表值 DisablePagingExecutive = 1 并重新启动（请参阅[Windows Performance Toolkit FAQ](http://social.msdn.microsoft.com/Forums/en-US/wptk_v4/thread/282e5beb-0afd-411b-9a81-a0bbbf569dfe/)）。

虽然这听起来不错，但它似乎对我的系统没有帮助，仍然没有调用堆栈。

* * *

在联系 Microsoft 支持后，他们的答复是使用 x64 Vista，您只能捕获 x64 本机应用程序的调用堆栈，而不是 32b 应用程序。

* * *

Windows 7 似乎已经消除了限制，它在 Win 7 x64 上运行良好，至少这表明[Valve 在 Xperf 上的演示](http://www.valvesoftware.com/publications/2011/ValveXperf-Dawson.pdf)。

# vb.net - 如何使用索引中的字段来删除条目？

> ID：479834
> 
> 赞同：0
> 
> 时间：2009-01-26T13:42:51.583
> 
> 标签：vb.net, indexing, lucene, lucene.net, indexer

我正在使用 Lucene.NET 在 VB 9 中开发桌面搜索引擎

我希望删除并为更新的文件创建一个新条目。

索引存储完整的文件路径和最后修改日期。

```
doc.Add(New Field("path", filepath, Field.Store.YES, Field.Index.UN_TOKENIZED))
doc.Add(New Field("modified", New FileInfo(filepath).LastWriteTime, Field.Store.YES, Field.Index.UN_TOKENIZED))
.
. 
```

我正在使用 IndexReader 检查索引中是否存在文件（以避免重新索引相同的文件）。

```
Dim reader As IndexReader = IndexReader.Open(SearchForm.IndexFolderTextBox.Text)

If reader.DocFreq(New Term("path", filepath)) = 0 Then
     addFile(filepath)
End If

reader.Close() 
```

我有以下疑问：

1.  如何使用`modified`字段中的值来检查特定文件的索引条目是否旧？IndexReader 的什么功能可以让我这样做？

2.  如何获取函数 deleteDocument() 的文档编号 (docNum)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T21:44:19.177

要回答您的第二个问题，请使用以下 IndexReader 方法：

```
public int deleteDocuments(Term term) 
```

所以你不需要文件编号。

# java - 从 PHP 移植到 Java - 框架建议？

> ID：479836
> 
> 赞同：2
> 
> 时间：2009-01-26T13:44:52.750
> 
> 标签：java, frameworks

我将一个项目从 php 移植到 java。该项目是一个基于 php 和 ajax 技术的 web 应用程序，带有一个 javascript 前端。你会用什么 java 框架来做这样的事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T14:02:43.460

结果必须用 Java 编写，还是只需要在 JVM 上运行？在后一种情况下，您可能需要考虑使用 Groovy 的[Grails](http://grails.org/)，它是一种基于 Java 的动态语言，可以编译为 Java 字节码，并且可以完全访问 Java 标准 API。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T13:51:27.477

你对 Java 了解多少？

你为什么要移植？

根据您的描述，我真的无法判断，但是那里有很多[Java Web 框架](http://java-source.net/open-source/web-frameworks)。选一个。我更喜欢春天。

我担心你会非常失望。我预计会有很多问题，例如“为什么我不能用 Java 做 X？用 PHP 很容易！”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T13:52:45.400

[Apache Wicket](http://wicket.apache.org/)是您可能会考虑的基于 Java 的 Web 框架。默认为 java servlet 和 jsp 框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T13:57:31.787

没有看到源代码 - 你将需要一个完整的重写。只是“移植”可能行不通。

在所有可用的框架中，我推荐两个：如果你想要干净的轻量级技术，wicket。用阿贾克斯。如果您在一个很容易获得大量经验丰富的开发人员的公司环境中，请使用 jsf/seam。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-26T15:32:22.033

我真的很喜欢[条纹](http://www.stripesframework.org)。

也有一本非常好的书。[Stripes ... 和 Java Web 开发再次变得有趣](http://www.stripesbook.org)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T16:53:24.630

这个问题似乎出现了很多。有关的：

*   [推荐什么 Java Web 应用程序框架？](https://stackoverflow.com/questions/24596/what-web-application-framework-for-java-is-recommended)
*   [Web 应用程序的最佳 java mvc 框架实现](https://stackoverflow.com/questions/309254/best-java-mvc-framework-implementation-for-web-apps)
*   [为简单的 Java Web 应用程序使用框架是否有意义？](https://stackoverflow.com/questions/403825/does-it-make-sense-to-use-a-framework-for-a-simple-java-web-app)
*   [为新的 Web 应用程序选择什么语言/平台？](https://stackoverflow.com/questions/231902/what-language-platform-to-choose-for-a-new-web-application)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T13:55:17.237

在我看来，您仍然会这样做，但使用 JSP 和 javabeans 而不是 php 生成 html。如果输出的 html 相同，javascripts 和 ajax 仍然可以正常工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T13:59:01.393

这取决于项目的大小、功能和资源。

如果项目没有很多特殊需求，您可以使用[Struts](http://struts.apache.org/)。Thsi 是一个稳定的框架，不是很先进，但对于开发来说简单而强大。

另一个更新和先进的框架是[Spring](http://www.springsource.org/)和[Wicket](http://wicket.apache.org)。在你开始之前，我建议你做一个你需要的清单：

1.  您是否也必须移植 O/R 映射？
2.  您是否是一位了解 Java/J2EE 的稳定开发人员？
3.  您认为在移植期间或短期内添加一些功能吗？

等等等等

祝你好运！:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T14:05:17.840

我会把它移植到[GWT](http://code.google.com/webtoolkit/ "谷歌网络工具包")

> Google Web Toolkit (GWT) 是一个开发工具包，用于构建和优化基于浏览器的复杂应用程序。它的目标是实现高性能 Web 应用程序的高效开发，而开发人员无需成为浏览器怪癖、XMLHttpRequest 和 JavaScript 方面的专家。Google 的许多产品都使用 GWT，包括 Google Wave 和新版 AdWords。它是开源的、完全免费的，并被全球成千上万的开发人员使用。

# django - 我如何在我的 django 表单上连接 WMD 编辑器？

> ID：479837
> 
> 赞同：8
> 
> 时间：2009-01-26T13:45:05.417
> 
> 标签：django, wmd-editor

我如何将 WMD 编辑器连接到我的 django 表单上？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T21:51:32.627

这是完整的 Django 小部件类：

```
class WMDEditor(forms.Textarea):

    def __init__(self, *args, **kwargs):
        attrs = kwargs.setdefault('attrs', {})
        if 'cols' not in attrs:
            attrs['cols'] = 58
        if 'rows' not in attrs:
            attrs['rows'] = 8
        super(WMDEditor, self).__init__(*args, **kwargs)

    def render(self, name, value, attrs=None):
        rendered = super(WMDEditor, self).render(name, value, attrs)
        return rendered + mark_safe(u'''<script type="text/javascript">
            wmd_options = {
                output: "Markdown",
                buttons: "bold italic | link blockquote code image | ol ul"
            };
            </script>
            <script type="text/javascript" src="%sjs/wmd/wmd.js"></script>''' % settings.MEDIA_URL) 
```

在您的表单定义中使用它，例如`text = forms.CharField(widget=WMDEditor)`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T14:47:05.277

从当前 WMD 下载的 readme.txt 中：

> 要安装编辑器，请在结束标记之前包含 wmd.js `<body>` ：
> 
> ```
> <script type="text/javascript" src="wmd/wmd.js"></script> 
> ```
> 
> 例子：
> 
> ```
> <!DOCTYPE html>
> <html>
>   <head>
>     <title>My Page</title>
>   </head>
>   <body>
>     <textarea></textarea>
>     <script type="text/javascript" src="wmd/wmd.js"></script>
>   </body>
> </html> 
> ```
> 
> 默认情况下，WMD 会将页面上的第一个文本区域变成编辑器。您可以使用类修改此行为 `wmd-ignore`，如下所述。（也可以通过 JavaScript 禁用自动启动和实例化编辑器，如 中所示 `apiExample.html`。但请注意，当前的 API 将在即将发布的开源版本中发生很大变化；它实际上从未用于公共消费。）

因此，将必要的代码添加到您用于呈现表单的模板中，并确保您要在其上使用 WMD 的文本区域是页面上的第一个，这样就可以了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-07T02:52:07.380

我刚做完这个。还有一些微妙之处需要注意，其他答案（到目前为止）并未涵盖这些细节。

1.  首先，为了让 Django 在提交表单时正确检索 WMD 编辑器的值，它需要设置 Django 的 id="" 值。通常这看起来像'id_'

2.  但是#1 产生了一个问题：WMD 编辑器被硬编码为查找 id="wmd-input" 以了解它使用的文本区域。

3.  因此，我们需要一种将 id 属性的值传递给 WMD 的方法。我自己通过让 Django 模板呈现一个全局 javascript 变量来完成此操作，当执行客户端时，WMD 将使用该变量正确定位 textarea 标记。

4.  如果我们要重新制作 WMD id 标签，那么我们还需要确保 CSS 仍然有效

5.  最后，为了让 Django 预先填充该值，我们需要确保该值在 textarea 标记中呈现

所以这里有一些代码给你。

## 小部件.py

```
from django import forms
from django.contrib.admin import widgets as admin_widgets
from django.template import loader, Context
from django.utils.html import conditional_escape
from django.utils.encoding import force_unicode

class WMDEditor(forms.Textarea):
    def render(self, name, value, attrs=None):
        # Prepare values
        if not value:
            value = ''
        attrs = self.build_attrs(attrs, name=name)

        # Render widget to HTML
        t = loader.get_template('wmd/widget.html')
        c = Context({
            'attributes' : self._render_attrs(attrs),
            'value' : conditional_escape(force_unicode(value)),
            'id' : attrs['id'],
        })

        return t.render(c) 
```

## wmd/widget.html

（命名为您的应用所需的任何名称）

```
<div class="wmd-wrapper">
    <div id="wmd-button-bar" class="wmd-panel"></div><br/>
    <textarea class="wmd-panel wmd-input" {{ attributes|safe }}>{{ value }}</textarea><br/>
    Preview
    <div id="wmd-preview" class="wmd-panel"></div><br/>
</div>
<script type="text/javascript">// <![CDATA[
    var WMD_TEXTAREA_ID = '{{ id }}'
// ]]> </script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/wmd/wmd.js"></script> 
```

*注意：您可能需要根据处理方式（自定义模板标签、中间件等）调整 MEDIA_URL。如果您是 Django 新手并且不理解我刚才所说的内容，请暂时将值硬编码以使其正常工作，并在以后了解这一切的含义。*

最后，您需要对 WMD 源代码进行 1 次小编辑（请注意，我使用的是 StackOverflow 分支，因此对于其他版本可能会略有不同）

## wmd.js

```
// This is around line 69
// Change this -> this.input = doc.getElementById("wmd-input");
// Into this:
this.input = doc.getElementById(WMD_TEXTAREA_ID); 
```

如果您正在使用 wmd.css 并且尚未编写自己的文件，则还需要对其进行轻微更新。因为该元素不再是#wmd-input，我们需要更新它以确保它使用 wmd-input 类：

## wmd.css

```
.wmd-input,   /* <-- Add this here, around line 33 */
#wmd-input 
{ 
    height: 250px;
    width: 100%;
    background-color: #FFFFFF;
    border: 1px solid #4d86c1;
} 
```

哇！那是一堆。希望对大家有所帮助。

# asp.net - ASP Membership 无法处理 web.config 中的加密连接字符串

> ID：479838
> 
> 赞同：0
> 
> 时间：2009-01-26T13:45:33.683
> 
> 标签：asp.net, encryption, membership, config

在我们拥有的测试网络服务器上，我们的一种网络方法遇到了错误。主要错误是：

```
"Access to the path 'E:\websites\Discovery\ProfileService\App_Data' is denied" 
```

进一步查看堆栈跟踪会提供更多信息：

```
"at System.Web.DataAccess.SqlConnectionHelper.CreateMdfFile..."
"at System.Web.DataAccess.SqlConnectionHelper.EnsureSqlExpressDBFile..."
"at System.Web.DataAccess.SqlConnectionHelper.GetConnection..."
"at System.Web.Security.SqlMembershipProvider.GetUser..."
"at System.Web.Security.Membership.GetUser..."
"at System.Web.Security.Membership.GetUser..." 
```

似乎成员资格提供者正试图为成员资格调用查找连接字符串。在未能找到此条目时，它尝试创建一个新的本地成员数据库，但由于权限错误而未能执行此操作。

我们仔细检查了连接字符串，虽然它们被加密了，但它们看起来还不错。然后，我们保存了连接字符串部分解密的配置 - 调用现在有效！

我们知道连接字符串是正确的，因为其他服务方法工作正常。更奇怪的是，会员资格的某些方面似乎与加密一起工作。

有没有人见过这个或者知道如何使用加密的连接字符串来实现这个？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T14:30:19.537

在您的代码中，在进行 SQL 调用之前，您是否在解密连接字符串？

堆栈跟踪中的错误可能是您的应用在该目录中没有写入权限。

# web-services - .asmx 带有 ssl 的 Web 服务

> ID：479840
> 
> 赞同：1
> 
> 时间：2009-01-26T13:47:12.120
> 
> 标签：web-services, asmx

是否需要进行任何特殊的配置设置才能使 Web 服务与 SSL 一起使用？

有没有办法强制服务方法使用用户名/密码进行身份验证，就像我可以使用 WCF 服务一样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T14:25:02.027

1.  不，Web 服务器 (IIS) 提供 SSL 支持。
2.  是的。只需通过 web.config 配置身份验证

# sharepoint - 没有内容的重复 SharePoint MOSS 网站

> ID：479845
> 
> 赞同：1
> 
> 时间：2009-01-26T13:48:04.800
> 
> 标签：sharepoint, deployment, moss

复制现有 SharePoint MOSS 网站然后在同一服务器上重新创建它的副本的最佳方法是什么？

理想情况下，我希望包含 Web 部件，但不包含文档等实际内容。

我查看了使用 SPDeploymentWizard 并将站点保存为模板，但 SPDeploymentWizard 获取所有内容并将其保存为模板我收到一个错误，即站点太大而无法保存。

任何建议表示赞赏

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T16:17:56.950

您可以通过单击站点设置页面中的“将站点另存为模板”选项来创建站点模板。SharePoint 无法根据发布定义创建模板，但此处列出了一种解决方法：

[链接文本](http://sharepointsolutions.blogspot.com/2008/07/create-site-template-from-publishing.html "从发布站点创建站点模板")

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T13:55:04.180

您可以 使用 stsadm.exe[备份](http://technet.microsoft.com/en-us/library/cc263441.aspx)和[还原](http://technet.microsoft.com/en-us/library/cc262087.aspx)到不同的服务器。

**编辑**

显然，内容有一个实际的导出功能 [http://msdn.microsoft.com/en-us/library/bb507233.aspx](http://msdn.microsoft.com/en-us/library/bb507233.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T17:26:27.590

模板的默认大小约为 10 MB。您可以使用 stsadm -o setproperty -pn max-template-document-size 来增加它

此外，如果您正在做模板，那也不会做子网站。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T20:30:18.937

无论是否包含 wepart 的网页都被视为 SharePoint 中的内容。因此，要移动站点，您必须创建一个带有关联内容数据库的新 moss 站点。

然后，您将能够备份您的原始站点并在新站点上恢复它。

然后，您将不得不删除您不想在新站点中拥有的内容。

[为避免将来出现此问题，请使用STSDev2008](http://www.codeplex.com/stsdev2008)创建包含网站模板的 SharePoint 解决方案。这需要时间，但它可以让您创建一个站点，其中包含所有需要的内容页面等准备就绪，并将减少创建这些站点的时间。

# c# - 访问编译器的错误和警告

> ID：479847
> 
> 赞同：4
> 
> 时间：2009-01-26T13:50:53.017
> 
> 标签：c#

我正在为我的一门大学课程开发一个简单的 C# 编辑器，我需要将一个 .cs 文件发送到编译器并收集错误（如果存在）并在我的应用程序中显示它们。换句话说，我想在我的编辑器中添加一个 C# 编译器。调试器有这样的东西吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-26T13:57:45.420

如果您使用 CodeDomProvider

```
using System.CodeDom;
using System.CodeDom.Compiler;
using Microsoft.CSharp;

// the compilation part

// change the parameters as you see fit
CompilerParameters cp = CreateCompilerParameters(); 
var options = new System.Collections.Generic.Dictionary<string, string>();
if (/* you want to use the 3.5 compiler*/)
{
    options.Add("CompilerVersion", "v3.5");
}
var compiler = new CSharpCodeProvider(options);
CompilerResults cr = compiler.CompileAssemblyFromFile(cp,filename);
if (cr.Errors.HasErrors)
{
    foreach (CompilerError err in cr.Errors)
    {
        // do something with the error/warning 
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T13:55:10.670

使用`System.Diagnostics.Process`该类启动一个通用进程并从标准输入/输出收集 I/O。

对于这个特定的场景，我建议你看看`Microsoft.CSharp.CSharpCodeProvider`class。它会为你完成任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T13:56:07.500

您可以在命令中调用 C# 编译器，然后捕获输出。

[在这里查看更多关于从命令行构建的信息](http://msdn.microsoft.com/en-us/library/1700bbwd(VS.71).aspx)。

# .net - 应用程序窗口的 z 顺序 - WPF

> ID：479854
> 
> 赞同：0
> 
> 时间：2009-01-26T13:54:45.647
> 
> 标签：.net, wpf, .net-3.5

有没有办法找出我的应用程序（application.current.windows）中所有活动窗口的 z 顺序或任何其他方式来找出模式窗口的“父”窗口是什么？

我正在尝试实现“着色器”功能，当显示模式窗口时，它应该使父窗口淡化。（到目前为止我发现的唯一方法是将“父”窗口作为参数传递，但我不太喜欢这种方式）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:22:10.613

无论如何，您都应该将其传递给父窗口，否则如果用户在您的应用程序和其他应用程序之间切换，您可能会遇到奇怪的情况（我上周不得不解决这个问题。:)）。Windows 有一个 Owner 属性，您应该在显示模式窗口时设置它：

```
bool? res = new MyWindow(){Owner = this}.ShowDialog(); 
```

然后您可以使用子窗口中的 Owner 属性：

```
if (Owner != null) {
 Owner.DoWhateverYouWant();
} 
```

# java - 是否有一个类似于 PropertyPlaceholderConfigurer 的类用于接受 XML 的 Spring？

> ID：479855
> 
> 赞同：9
> 
> 时间：2009-01-26T13:54:46.020
> 
> 标签：java, xml, spring, properties

Spring 有一个非常方便的名为[PropertyPlaceholderConfigurer](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html)的类，它采用标准的 .properties 文件并将其中的值注入到您的 bean.xml 配置中。

有谁知道一个做完全相同的事情的类，并以相同的方式与 Spring 集成，但接受 XML 文件进行配置。具体来说，我正在考虑 Apache 消化器风格的配置文件。这样做很容易，我只是想知道是否有人已经拥有。

建议？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T16:32:28.933

我刚刚对此进行了测试，它应该可以正常工作。

PropertiesPlaceholderConfigurer 包含一个 setPropertiesPersister 方法，因此您可以使用自己的[PropertiesPersister](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/util/PropertiesPersister.html)子类。默认的 PropertiesPersister 已经支持 XML 格式的属性。

只是为了向您展示完整的工作代码：

JUnit 4.4 测试用例：

```
package org.nkl;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@ContextConfiguration(locations = { "classpath:/org/nkl/test-config.xml" })
@RunWith(SpringJUnit4ClassRunner.class)
public class PropertyTest {

    @Autowired
    private Bean bean;

    @Test
    public void testPropertyPlaceholderConfigurer() {
        assertNotNull(bean);
        assertEquals("fred", bean.getName());
    }
} 
```

弹簧配置文件`test-config.xml`

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context-2.5.xsd
">
  <context:property-placeholder 
      location="classpath:/org/nkl/properties.xml" />
  <bean id="bean" class="org.nkl.Bean">
    <property name="name" value="${org.nkl.name}" />
  </bean>
</beans> 
```

XML 属性文件`properties.xml`- 有关使用说明，请参见[此处](http://www.ibm.com/developerworks/java/library/j-tiger02254.html)。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
  <entry key="org.nkl.name">fred</entry>
</properties> 
```

最后是 bean：

```
package org.nkl;

public class Bean {
    private String name;
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
} 
```

希望这可以帮助...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T13:32:12.470

发现 Spring Modules 提供[了 Spring 和 Commons Configuration 之间的集成](http://www.springbyexample.org/twiki/bin/view/Example/SpringModulesWithCommonsConfiguration)，它具有层次结构的 XML 配置样式。这直接与 PropertyPlaceholderConfigurer 相关联，这正是我想要的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-05-05T11:28:41.727

一直试图自己想出一个很好的解决方案

1.  围绕为配置文件创建 XSD - 因为在我看来，使用 XML 的全部好处是您可以在数据类型方面强输入配置文件，以及哪些字段是强制性/可选的
2.  将针对 XSD 验证 XML，因此如果缺少值，它将抛出错误，而不是您的 bean 被注入“null”
3.  不依赖于 spring 注释（比如@Value - 在我看来，这让 bean 了解它们的容器 + 与其他 bean 的关系，因此破坏了 IOC）
4.  将针对 XSD 验证 spring XML，因此如果您尝试引用 XSD 中不存在的 XML 字段，它也会抛出错误
5.  bean 不知道它的属性值是从 XML 注入的（即我想注入单个属性，而不是整个 XML 对象）

我想出的内容如下，抱歉，这很啰嗦，但我喜欢它作为一种解决方案，因为我相信它涵盖了所有内容。希望这可能对某人有用。先说些琐碎的：

我希望将属性值注入的 bean：

```
package com.ndg.xmlpropertyinjectionexample;

public final class MyBean
{
    private String firstMessage;
    private String secondMessage;

    public final String getFirstMessage ()
    {
        return firstMessage;
    }

    public final void setFirstMessage (String firstMessage)
    {
        this.firstMessage = firstMessage;
    }

    public final String getSecondMessage ()
    {
        return secondMessage;
    }

    public final void setSecondMessage (String secondMessage)
    {
        this.secondMessage = secondMessage;
    }
} 
```

测试类以创建上述 bean 并转储它获得的属性值：

```
package com.ndg.xmlpropertyinjectionexample;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public final class Main
{
    public final static void main (String [] args)
    {
        try
        {
            final ApplicationContext ctx = new ClassPathXmlApplicationContext ("spring-beans.xml");
            final MyBean bean = (MyBean) ctx.getBean ("myBean");
            System.out.println (bean.getFirstMessage ());
            System.out.println (bean.getSecondMessage ());
        }
        catch (final Exception e)
        {
            e.printStackTrace ();
        }
    }

} 
```

MyConfig.xsd：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:myconfig="http://ndg.com/xmlpropertyinjectionexample/config" targetNamespace="http://ndg.com/xmlpropertyinjectionexample/config">

    <xsd:element name="myConfig">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element minOccurs="1" maxOccurs="1" name="someConfigValue" type="xsd:normalizedString" />
                <xsd:element minOccurs="1" maxOccurs="1" name="someOtherConfigValue" type="xsd:normalizedString" />
            </xsd:sequence>
        </xsd:complexType>
    </xsd:element>

</xsd:schema> 
```

基于 XSD 的示例 MyConfig.xml 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<config:myConfig xmlns:config="http://ndg.com/xmlpropertyinjectionexample/config">
    <someConfigValue>First value from XML file</someConfigValue>
    <someOtherConfigValue>Second value from XML file</someOtherConfigValue>
</config:myConfig> 
```

运行 xsd2java 的 pom.xml 文件的片段（除了设置为 Java 1.6 和 spring-context 依赖项之外，这里没有太多其他内容）：

```
 <plugin>
            <groupId>org.jvnet.jaxb2.maven2</groupId>
            <artifactId>maven-jaxb2-plugin</artifactId>
            <executions>
                <execution>
                    <id>main-xjc-generate</id>
                    <phase>generate-sources</phase>
                    <goals><goal>generate</goal></goals>
                </execution>
            </executions>
        </plugin> 
```

现在是 spring XML 本身。这将创建一个模式/验证器，然后使用 JAXB 创建一个解组器以从 XML 文件创建一个 POJO，然后使用 spring # 注释通过查询 POJO 来注入属性值：

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd" >

    <!-- Set up schema to validate the XML -->

    <bean id="schemaFactory" class="javax.xml.validation.SchemaFactory" factory-method="newInstance">
        <constructor-arg value="http://www.w3.org/2001/XMLSchema"/>
    </bean> 

    <bean id="configSchema" class="javax.xml.validation.Schema" factory-bean="schemaFactory" factory-method="newSchema">
        <constructor-arg value="MyConfig.xsd"/>
    </bean>

    <!-- Load config XML -->

    <bean id="configJaxbContext" class="javax.xml.bind.JAXBContext" factory-method="newInstance">
        <constructor-arg>
            <list>
                <value>com.ndg.xmlpropertyinjectionexample.config.MyConfig</value>
            </list>
        </constructor-arg>
    </bean>

    <bean id="configUnmarshaller" class="javax.xml.bind.Unmarshaller" factory-bean="configJaxbContext" factory-method="createUnmarshaller">
        <property name="schema" ref="configSchema" />
    </bean>

    <bean id="myConfig" class="com.ndg.xmlpropertyinjectionexample.config.MyConfig" factory-bean="configUnmarshaller" factory-method="unmarshal">
        <constructor-arg value="MyConfig.xml" />
    </bean>

    <!-- Example bean that we want config properties injected into -->

    <bean id="myBean" class="com.ndg.xmlpropertyinjectionexample.MyBean">
        <property name="firstMessage" value="#{myConfig.someConfigValue}" />
        <property name="secondMessage" value="#{myConfig.someOtherConfigValue}" />
    </bean>

</beans> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-25T09:05:59.177

我不确定 Apache 消化器风格的配置文件，但我找到了一个不难实现且适合我的 xml 配置文件的解决方案。

您可以使用 spring 中的普通 PropertyPlaceholderConfigurer，但要读取您的自定义配置，您必须创建自己的 PropertiesPersister，您可以在其中解析 xml（使用 XPath）并自己设置所需的属性。

这是一个小例子：

首先通过扩展默认的 PropertiesPersister 创建你自己的：

```
public class CustomXMLPropertiesPersister extends DefaultPropertiesPersister {
            private XPath dbPath;
            private XPath dbName;
            private XPath dbUsername;
            private XPath dbPassword;

            public CustomXMLPropertiesPersister() throws JDOMException  {
                super();

            dbPath = XPath.newInstance("//Configuration/Database/Path");
            dbName = XPath.newInstance("//Configuration/Database/Filename");
            dbUsername = XPath.newInstance("//Configuration/Database/User");
            dbPassword = XPath.newInstance("//Configuration/Database/Password");
        }

        public void loadFromXml(Properties props, InputStream is)
        {
            Element rootElem = inputStreamToElement(is);

            String path = "";
            String name = "";
            String user = "";
            String password = "";

            try
            {
                path = ((Element) dbPath.selectSingleNode(rootElem)).getValue();
                name = ((Element) dbName.selectSingleNode(rootElem)).getValue();
                user = ((Element) dbUsername.selectSingleNode(rootElem)).getValue();
                password = ((Element) dbPassword.selectSingleNode(rootElem)).getValue();
            }
            catch (JDOMException e)
            {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }

            props.setProperty("db.path", path);
            props.setProperty("db.name", name);
            props.setProperty("db.user", user);
            props.setProperty("db.password", password);
        }

        public Element inputStreamToElement(InputStream is)
        {       
            ...
        }

        public void storeToXml(Properties props, OutputStream os, String header)
        {
            ...
        }
    } 
```

然后将 CustomPropertiesPersister 注入应用程序上下文中的 PropertyPlaceholderConfigurer：

```
<beans ...>
    <bean id="customXMLPropertiesPersister" class="some.package.CustomXMLPropertiesPersister" />

    <bean id="propertyPlaceholderConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_FALLBACK" />
        <property name="location" value="file:/location/of/the/config/file" />
        <property name="propertiesPersister" ref="customXMLPropertiesPersister" />
    </bean> 
</beans> 
```

之后，您可以像这样使用您的属性：

```
<bean id="someid" class="some.example.class">
  <property name="someValue" value="$(db.name)" />
</bean> 
```

# svn - svn:externals 可以在忽略该 URL 的外部时使用吗？

> ID：479859
> 
> 赞同：3
> 
> 时间：2009-01-26T13:55:14.523
> 
> 标签：svn, svn-externals

是否可以忽略 svn:externals 属性中引用的标记的外部依赖项？这听起来像是一个非常奇怪的问题，但让我解释一下……

我有大量单独的“可插入”代码模块，每个模块都可以作为独立项目进行独立测试、编译和开发。其中一些模块依赖于其他模块，通过 svn:externals 属性。问题是我们的测试框架[gtest](http://code.google.com/p/googletest/)也是每个模块的依赖项，并且包含一个用于测试套件的静态库，这意味着每个模块至少有 ~15Mb，因为我们已经为多个平台构建了这些静态库。

无论如何，这意味着一个相对简单的项目在签出时可能会占用超过 200Mb 的磁盘空间，这主要归功于每个模块的 gtest 副本。我的一些同事现在开始抱怨工作副本的体积过大，最好通过在每个模块的*顶层*包含 gtest 依赖项并在构建中仅包含该副本来减少这种情况。

基本上，我想要一种在我的 proplist 中设置 svn:externals 的方法，但是检查每个依赖项，就好像我要将“--ignore-externals”传递给 svn co。这可能吗？我有一种感觉没有，但值得一问...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T18:41:35.363

我建议查看稀疏结帐。仅签出顶级目录（使用“仅此项目”选项），获取外部文件。然后，对于您想要的每个模块，您可以使用所需的目录更新 WC，但省略外部文件。对所有子项目重复。

您可能仍然需要将 gtest 依赖项放在您的存储库中的另一个文件夹中，但我认为它可能对您有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T19:04:23.663

我不知道有什么方法可以让 svn 跳过一个依赖项。

但我认为您可以通过在没有共享依赖项的情况下制作这些模块的标记版本来以另一种方式解决这个问题。然后其他依赖模块可以将它们的 svn:externals 指向这些标签，而不是指向独立编译的分支。

我只建议这样做，因为听起来您对单个大型共享库有一个非常具体的问题。任何更复杂的事情，你可能无法单独使用 svn:externals 解决这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T00:24:02.397

从 1.6.0+ 开始的 Subversion 可以使用 svn:externals 引用[文件](http://subversion.tigris.org/svn_1.6_releasenotes.html#file-externals)而不是目录。这可能有帮助吗？

# .net - .NET DataTable 的最佳用例是什么？

> ID：479862
> 
> 赞同：1
> 
> 时间：2009-01-26T13:55:43.973
> 
> 标签：.net, data-binding, datatable, dataview

我有三个表客户，工作，订单

我在数据集中也有这些表，它符合与数据库本身相同的约束。

最初，我的意图是将数据保留在 DataSet 中，并创建各种 DataView 对象以向用户显示这些数据，并执行任何所需的操作，然后显然将使用 .NET TableAdapter 方法将其更新回数据库.

但是，似乎 DataView 对象只能对单个 DataTable 对象进行操作。

我的问题是：这是在内存中创建数据以确保可维护性和性能的最佳方式。

1.  创建多个包含非规范化数据的 DataTable 对象。这可能会在内存中创建数据的副本，但我更担心在更改数据库时会出现问题。
2.  创建一些自定义类，它按照我期望 DataView 的行为方式运行，并且还能够自动更新 DataSet（然后是数据库）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:08:22.593

只需与原始 DataSet 进行数据绑定。您已经拥有所有数据，并且创建单独的 DataTables 将使跟踪数据更改变得非常困难。[在此处查找有关数据绑定父/子关系的一些提示](http://www.vbforums.com/showthread.php?t=518067)。

# vb.net - 由 GZIP 压缩的文件会增长而不是缩小

> ID：479865
> 
> 赞同：2
> 
> 时间：2009-01-26T13:56:33.303
> 
> 标签：vb.net, gzip

我使用下面的代码来压缩文件，它们一直在增长而不是缩小。我压缩了一个 4 kb 的文件，它变成了 6 个。由于压缩开销，这对于一个小文件是可以理解的。我尝试了一个 400 mb 的文件，压缩后它变成了 628 mb。怎么了？查看代码。(.net 2.0)

```
Public Sub Compress(ByVal infile As String, ByVal outfile As String)
    Dim sourceFile As FileStream = File.OpenRead(inFile)
    Dim destFile As FileStream = File.Create(outfile)

    Dim compStream As New GZipStream(destFile, CompressionMode.Compress)

    Dim myByte As Integer = sourceFile.ReadByte()
    While myByte <> -1
        compStream.WriteByte(CType(myByte, Byte))
        myByte = sourceFile.ReadByte()
    End While

    sourceFile.Close()
    destFile.Close()
End Sub 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T14:04:06.470

如果底层文件本身是高度不可预测的（已经压缩或很大程度上是随机的），那么尝试压缩它会导致文件变得更大。

从 400 到 628Mb 听起来不太可能作为扩展因子，因为 deflate 算法（用于 GZip）趋向于[0.03% 的最大扩展因子](http://www.zlib.net/zlib_tech.html)。GZip 标头的开销应该可以忽略不计。

编辑：4.0 c# 版本表明压缩库已得到改进，不会导致不可压缩数据的显着扩展。这表明他们没有实施“回退到原始流块”模式。尝试使用 SharpZipLib 的库作为快速测试。当流无法通过放气压缩时，这应该为您提供接近相同的性能。如果它确实考虑移至该版本或等待 4.0 版本以获得更高性能的 BCL 实现。请注意，您得到的压缩不足强烈表明您没有必要尝试进一步压缩

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T14:01:19.407

您确定逐字节写入流是一个非常好的主意吗？它肯定不会有理想的性能特征，也许这也是 gzip 压缩算法的困惑所在。

此外，您尝试压缩的数据可能无法很好地压缩。如果我是您，我会尝试使用与文本文档大小相同的文本文档来尝试您的代码，其压缩比随机二进制文件要好得多。

此外，您可以尝试使用纯 DeflateStream 而不是 GZipStream，因为它们都使用相同的压缩算法（deflate），唯一的区别是 gzip 添加了一些额外的数据（如错误检查），因此 DeflateStream 可能会产生更小的结果。

我的 VB.NET 有点生疏，所以我宁愿不尝试在 VB.NET 中编写代码示例。相反，这就是你应该如何在 C# 中执行此操作，对于有一点经验的人来说，将它翻译成 VB.NET 应该相对简单：（或者也许擅长 VB.NET 的人可以编辑我的帖子并将其翻译成VB.NET)

```
FileStream sourceFile;
GZipStream compStream;

byte[] buffer = new byte[65536];
int bytesRead = 0;
while (bytesRead = sourceFile.Read(buffer, 0, 65536) > 0)
{
     compStream.Write(buffer, 0, bytesRead);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T16:04:30.760

这是内置 GZipStream（和 DeflateStream）的[已知异常。](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93930)
我可以想到两种解决方法：

*   使用替代压缩机。
*   构建一些逻辑来检查“压缩”输出的大小并将其与输入的大小进行比较。如果更大，则丢弃输出并仅存储数据。

[DotNetZip](http://DotNetZip.codeplex.com)包含一个基于 zlib 托管端口的“固定”GZipStream。（它采用上面的方法＃1）。Ionic.Zlib.GZipStream 可以用简单的命名空间交换替换应用程序中的内置 GZipStream。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T14:36:21.053

谢谢大家的好答案。早些时候，我尝试压缩 .wmv 文件和一个文本文件。我将代码更改为 DeflateStream，它现在似乎可以工作了。干杯。

# c# - Windows 帮助按钮的问题（编辑-新问题）

> ID：479871
> 
> 赞同：0
> 
> 时间：2009-01-26T13:58:40.257
> 
> 标签：c#, winforms

安装应用程序然后运行 ​​exe 文件时会发生奇怪的行为。首先让我解释一下我的步骤：

1）我添加了 HelpProvidor 并将 HelpNameSpace 属性设置为 chm 文件路径。2）在表单属性中，我将 helpProvidor 属性上的 HelpNavigator 设置为：HelpProvidor 上的 KeywordIndex 和 HelpString 以使用 ASGATech Quran Sound Downloder Help 3）我创建了一个安装 pkg。它运行成功。

我的问题是当我调试应用程序并按下“？” （这是帮助按钮）它显示 chm 文件。

但是当我在桌面上运行从安装包创建的排序时，它不会。

为什么 HelpNamespce 是一样的。和应用程序文件夹中的exe是一样的，为什么会这样。

exe文件是相同的，当我在开始 - >程序菜单中创建一个新项目时，创建的exe文件运行chm文件，但快捷方式不运行。

我将 chm 与应用程序文件夹一起放置在：c:\program Files\Manufacturer\ProductName

并且它成功地将文件放在了这个路径上，所以他为什么看不到它。

编辑：我发现问题是当我卸载应用程序时它保留产品文件夹它只删除图标 ans chm 所以当你重新安装应用程序时他感觉不到新状态（他有 chm 文件）

现在我如何从 programFiles 中删除产品文件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T14:37:30.613

你确定exe文件是一样的吗？

您的应用程序似乎找不到帮助文件，或者 IE 的当前安全设置阻止它被加载。

使用像[Procmon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)这样的工具来查看您的应用程序在哪里寻找帮助文件。

如果找不到，请确保它包含在您的安装程序包中。

如果找到它，请确保它在本地磁盘上，并且本地计算机的默认安全设置没有在 IE 中更改。

# nunit - 从 CruieControl 运行时获取 WatiN.Core.Exceptions.TimeoutException

> ID：479877
> 
> 赞同：0
> 
> 时间：2009-01-26T14:02:07.707
> 
> 标签：nunit, cruisecontrol.net

我得到`WatiN.Core.Exceptions.TimeoutException`：

> 通过 CruiseControl.Net 执行我的测试时 Internet Explorer 忙时超时。

任何人都知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:19:16.470

当我们使用 TeamCity 时，我们必须禁用 IE 保护模式。

此外，检查运行 watiN 测试的用户是否可以与桌面交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-02T10:52:43.303

我知道这个问题很老并且已经回答，但以下是我的一些观察。

可以在服务帐户下运行 watin 测试，但适用以下限制/先决条件：

*   服务必须以桌面交互模式运行。仅在作为系统运行时可用。
*   测试不得创建新窗口，甚至警告/确认对话框
*   即无法创建新窗口，因此当寻找/期望它出现时，watin 失败。
*   即可能会显示自己的警告，例如安全页面中的不安全内容，这可能会导致测试失败*
*   如果测试失败/超时并且 ie 实例被强制关闭，下一个实例可能会尝试恢复之前的状态。然后测试似乎失败*
*   这可以在高级设置中关闭。

*根据我的经验，通常是因为提示正在停止文档被报告为加载完成。

随意添加其他限制/评论。

# visual-studio - 如何在 MS Dynamics CRM 中以编程方式创建快速营销活动

> ID：479880
> 
> 赞同：1
> 
> 时间：2009-01-26T14:03:31.947
> 
> 标签：visual-studio, dynamics-crm, crm

我正在尝试在代码中创建一个“快速活动”，但我没有找到一个类来做到这一点。

我找到了创建列表并将用户添加到该列表的方法。但我不能继续，因为我不知道路。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T08:49:46.970

这是一个旧帖子，但我想我还是会回复。

CRM 中的“快速活动”实体称为“批量操作”。快速活动向导仅创建其他类型的活动记录，例如电话或任务。批量操作是实际执行分发活动的操作。快速活动不是标准的 CRM 实体。

据我所知，您无法使用代码创建批量操作记录 - 此类没有“创建”方法。我认为这是因为批量操作与 CRM 平台的联系过于紧密。

我建议，最接近模拟创建快速活动的方法是使用代码执行快速活动向导的操作，并创建向导通常会创建的相关活动。或者使用可以使用代码管理的 Campaign 实体。

在 CRM SDK 中搜索 bulkoperation 类以获取更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-10-28T11:49:46.340

要创建快速营销活动，您可以使用 PropagateByExpressionRequest。Microsoft 提供了有关如何执行此操作的示例代码-> [https://msdn.microsoft.com/en-us/library/gg328526.aspx](https://msdn.microsoft.com/en-us/library/gg328526.aspx)

# language-agnostic - 输入的多语言环境验证

> ID：479881
> 
> 赞同：1
> 
> 时间：2009-01-26T14:03:55.673
> 
> 标签：language-agnostic, validation, locale

在要跨多个语言环境运行的应用程序中验证用户输入时，最合适的方法是什么？我在几年前的一个项目中遇到了这个问题，现在我有兴趣回顾一下我们可以如何解决这个问题。

我的想法是编写一个跨多个语言环境有效的输入条件，或者使用大型 switch 语句（我不喜欢这个），或者编写一个可以存储在外部属性中的特定于语言环境的正则表达式文件（或类似文件）。第三种选择是我的首选方法，但我有兴趣听取其他人的意见。

这个问题的一个例子是，例如在欧洲大陆语言中更广泛的上下文中使用重音字母，或者完全不同的字符集。

因此，如果输入需要验证，并且条件会因语言环境而异，这是处理此问题的最佳方法。

PS：我并不是专门寻找特定语言的解决方案，更多的是寻找解决一般问题的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T14:44:10.240

如果您正在为全球市场编写软件，您最好使用国际化部分的框架。国家和语言之间存在巨大差异。有很多陷阱和陷阱。您当然**不想**自己实现所有这些差异。

这就是它变得依赖于语言（编程语言）的地方。如果您有幸使用 Java，您将免费获得国际化支持。Java 有很多工具可以支持您编写国际化软件。其他高级语言也支持国际化。

如果你的语言没有内置的国际化支持，你最好开始寻找一个现成的框架。

# c# - C# 类型推断有多好？

> ID：479883
> 
> 赞同：19
> 
> 时间：2009-01-26T14:04:54.610
> 
> 标签：c#, .net, type-inference

C# 类型推断有多好？我在某处读到它仅适用于局部变量？它适用于类级别属性吗？对于方法签名？方法返回类型？等等

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-26T14:39:44.993

C# 中有几种主要的类型推断：

*   隐式类型的局部变量：

    *   仅适用于局部变量
    *   仅当值作为声明的一部分分配时
    *   值不能为空
    *   值不能是 lambda 表达式、匿名方法或方法组（没有强制转换）
    *   值的编译时类型用于变量的类型
    *   变量的任何进一步使用仅根据初始声明+赋值确定的类型进行检查；它们对推理本身没有贡献。
*   泛型方法类型参数推断，即您没有在调用泛型方法时指定类型参数，编译器会根据参数计算出它们。

    *   对于泛型类型和泛型方法来说，这真的很方便
    *   无论如何真的很方便 - 没有它 LINQ 将很难或无法使用
    *   没有它，匿名类型将毫无用处
    *   非常复杂的规则，甚至规范在一些地方是错误的
*   Lambda 表达式参数类型推断

    *   编译器尝试根据使用它的上下文来计算 lambda 表达式的参数类型
    *   根据我的经验，通常效果很好
*   数组类型推断，例如，`new[] { "Hi", "there" }`而不是`new string[] { "Hi", "there" }`

    *   各种小限制，没什么大不了的

我可能已经忘记了一些可能被称为“类型推断”的其他功能。我怀疑您最感兴趣的是第一个，但其他可能也与您相关:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-26T14:11:02.757

它只能用于局部变量，但它可以检测多种不同形式的类型。

```
var myVar = SomeMethodThatReturnsInt(); //will know it's an int
var myIntList = new List<int>(); //this works too (although this is technically not type inference)
var myOwnVar = new { Name = "John", Age = 100 }; // will create own type and infer that 
```

编辑： Tye 推理的另一个例子是 Lambdas。IE：

```
var myList = new List<int>();
//add some values to list

int x = myList.Find(i => i == 5); // compiler can infer that i is an int. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T14:07:36.510

据我了解，它仅适用于局部变量。

# vba - VB6 中的 Call 关键字有什么作用？

> ID：479891
> 
> 赞同：33
> 
> 时间：2009-01-26T14:08:20.110
> 
> 标签：vba, vb6, syntax

我们的项目中有一些代码看起来有点像这样：

```
Private Sub Method1()
    Call InnerMethod
End Sub

Private Sub Method2()
    InnerMethod
End Sub

Private Sub InnerMethod()
    '' stuff
End Sub 
```

Method1 比 Method2 有什么优势？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-26T14:11:35.033

从[MSDN](http://msdn.microsoft.com/en-us/library/wcx04ck5(VS.85).aspx)：

> 调用过程时不需要使用 Call 关键字。但是，如果您使用 Call 关键字调用需要参数的过程，argumentlist 必须用括号括起来。如果省略 Call 关键字，则还必须省略argumentlist 周围的括号。如果您使用 Call 语法来调用任何内部或用户定义的函数，则该函数的返回值将被丢弃。

例如：

```
Sub Proc1()
    Debug.Print "Hello World"
End Sub

Sub Proc2(text As String)
    Debug.Print "Hello " & text
End Sub 
```

在即时窗口中，如果您输入

```
Proc1 
```

然后打印“Hello World”。如果你输入

```
Call Proc1 
```

然后打印“Hello World”。如果你输入

```
Proc2 "World" 
```

然后打印“Hello World”。如果你输入

```
Call Proc2 "World" 
```

你得到一个编译错误。你必须输入

```
Call Proc2("World") 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-26T14:13:08.683

除了调用方法之外，调用没有什么特别的。这是 Basic 旧时代的遗留问题，当时所有行都必须以关键字开头。“Let”是这些关键字中的另一个，它总是放在分配之前，但不再需要。

Method1 和 Method2 做同样的事情。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-07-01T16:15:56.257

我发现'call'关键字与具有ByRef Arguments的函数有一个主要区别（我在MS-Access VBA编辑器中找到了这个）。如果您在没有“Call”关键字的情况下调用该函数，则不会为被调用者设置 ByRef 参数。例如：

```
Private Function Test(Optional ByRef refArg As String) As Boolean    
    refArg = "Test"
    Test = True
End Function 
```

如果您在没有`Call`关键字 like的情况下调用该函数

```
Dim a As String
Test(a) 
```

`a`将是一个空字符串，调用返回后

如果您使用`Call`关键字 like调用该函数

```
Dim a As String
Call Test(a) 
```

`a`将包含字符串`Test`

以下链接中提供的详细说明：http: [//blogs.msdn.com/b/ericlippert/archive/2003/09/15/52996.aspx](http://blogs.msdn.com/b/ericlippert/archive/2003/09/15/52996.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T14:09:59.890

没有区别。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T14:16:49.643

这是一篇[文章](http://forums.devx.com/showthread.php?t=54171)，描述了何时需要使用 call 与不使用它以及何时在参数周围加上括号。

您还可以从 MSDN阅读有关[呼叫的更多信息。](http://msdn.microsoft.com/en-us/library/sxz296wz(VS.71).aspx)本质上主要区别在于，当您使用 call 调用函数时，您无法访问返回值。

# xcode - 如何在 Xcode 中启用研究助理？

> ID：479896
> 
> 赞同：0
> 
> 时间：2009-01-26T14:08:46.553
> 
> 标签：xcode

我在 Xcode 中创建了一个空项目，并将我的所有源代码文件添加到其中。由于项目为空，我没有设置任何构建选项/配置，并且我使用命令行中的旧 Makefile 来构建应用程序。一切正常-但是...

我的问题是，由于研究助理根本没有显示任何信息，所以没有触手可及的信息有点烦人！

显示了研究助理，但它没有显示任何信息，我想它必须以某种方式被指示 - 但是如何？有没有办法启用研究助理以及如何启用？另外，请注意我有所有可用的文档（但不是来自研究助理）！

提前致谢！/约翰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T14:31:56.617

在显示研究助手的情况下使用 Xcode 时，我发现它仅在您突出显示代码中的某些内容时才显示信息。例如，如果您有：

```
NSString *foo; 
```

并且您突出显示（单击）NSString，然后研究助理将为您提供 NSString 的定义、API 所属等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T16:02:01.350

好的，问题有点解决了。

我尝试创建一个新的简单 iPhone 项目，然后删除所有包含的项目文件，而不是创建一个空项目。然后我将我的原始文件添加到项目中，当我开始编辑时 - WHAM - 研究助理立即显示了所有符号的所有血腥细节！:-)

但是不知道如何从一个空项目手动修复这个问题是相当烦人的......

/约翰

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T18:25:04.603

此外，您可以将自己的项目添加到 Xcode 帮助系统中，它们将显示在研究助手中。

[http://developer.apple.com/tools/creatingdocsetswithdoxygen.html](http://developer.apple.com/tools/creatingdocsetswithdoxygen.html)

# python - 如何从 Python 列表中删除重复项并保持顺序？

> ID：479897
> 
> 赞同：79
> 
> 时间：2009-01-26T14:09:15.040
> 
> 标签：python, list, sorting, unique

给定一个字符串列表，我想按字母顺序对其进行排序并删除重复项。我知道我可以这样做：

```
from sets import Set
[...]
myHash = Set(myList) 
```

但我不知道如何按字母顺序从哈希中检索列表成员。

我没有嫁给哈希，所以任何方法都可以做到这一点。此外，性能不是问题，因此我更喜欢用代码清晰表达的解决方案，而不是快速但更不透明的解决方案。

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2009-01-26T14:16:10.360

可以使用内置函数对列表进行排序和去重：

```
myList = sorted(set(myList)) 
```

*   [`set`](http://docs.python.org/library/functions.html#func-set)是 Python >= 2.3 的内置函数
*   [`sorted`](http://docs.python.org/library/functions.html#sorted)是 Python >= 2.4 的内置函数

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-26T14:48:21.683

如果您的输入已经排序，那么可能有一种更简单的方法：

```
from operator import itemgetter
from itertools import groupby
unique_list = list(map(itemgetter(0), groupby(yourList))) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-05-10T09:49:06.297

如果要保持原始列表的顺序，只需将 OrderedDict 与`None`as 值一起使用。

在 Python2 中：

```
 from collections import OrderedDict
    from itertools import izip, repeat

    unique_list = list(OrderedDict(izip(my_list, repeat(None)))) 
```

在 Python3 中它甚至更简单：

```
 from collections import OrderedDict
    from itertools import repeat

    unique_list = list(OrderedDict(zip(my_list, repeat(None)))) 
```

如果您不喜欢迭代器（zip 和重复），您可以使用生成器（适用于 2 和 3）：

```
 from collections import OrderedDict
    unique_list = list(OrderedDict((element, None) for element in my_list)) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T14:16:56.193

如果你追求的是清晰度，而不是速度，我认为这很清楚：

```
def sortAndUniq(input):
  output = []
  for x in input:
    if x not in output:
      output.append(x)
  output.sort()
  return output 
```

虽然它是 O(n^2)，但对于输入列表的每个元素重复使用 not in 。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T15:22:18.027

> 但我不知道如何按字母顺序从哈希中检索列表成员。

不是你的主要问题，但为了将来参考 Rod's answer using`sorted`可用于`dict`按排序顺序遍历 a 的键：

```
for key in sorted(my_dict.keys()):
   print key, my_dict[key]
   ... 
```

并且还因为`tuple`'s 是由元组的第一个成员排序的，您可以对 执行相同操作`items`：

```
for key, val in sorted(my_dict.items()):
    print key, val
    ... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-26T09:36:24.987

对于字符串数据

```
 output = []

     def uniq(input):
         if input not in output:
            output.append(input)
 print output 
```

# networking - 笔记本电脑上的 VMWare 播放器 - 在无线断开连接时保持连接

> ID：479915
> 
> 赞同：0
> 
> 时间：2009-01-26T14:15:37.773
> 
> 标签：networking, vmware

我是 VMWare 和解决网络问题的新手。

我正在笔记本电脑上通过 VMWare Player 运行 buildix 应用程序。当我连接到我的家庭无线网络时，一切正常。

但是，当我没有连接到网络时，我的无线网卡被关闭（例如，为了省电），或者当我连接到另一个无线网络时，Buildix 设备/VMWare 播放器无法获取 IP 地址。

我只希望设备能够与我的笔记本电脑通信。

我在所有 3 种网络模式下都试过了：Host-Only（我相信我想要的）、NAT 和桥接，都没有成功。

我还通过在 VMWare Player 安装目录中运行 vmnetcfg.exe 来查看设置，但在这里看不到任何明显的东西。

有人可以帮忙吗？

问候

马蒂

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T19:55:40.130

仅主机模式可能是您的情况。问题是 NAT 和桥接模式依赖某些第三方 DHCP 服务器来提供 IP 地址，而当您断开连接运行时，该服务器不可用。

如果您的机器配置在正确的虚拟网络交换机上，VMware Workstation（不确定 Player）会提供内置 DHCP 服务器。您还可以调整哪个虚拟交换机拥有 DHCP 服务器、它提供的 IP 地址等。

如果 Player 不支持此功能，您可能会被迫手动设置虚拟机的 IP 地址。这取决于您正在运行的操作系统。

# c++ - 在 C++ 中快速搜索已排序的字符串列表

> ID：479919
> 
> 赞同：8
> 
> 时间：2009-01-26T14:16:42.217
> 
> 标签：c++, visual-c++

我有一个 C++ 中大约数百个唯一字符串的列表，我需要检查该列表中是否存在一个值，但最好快如闪电。

我目前正在使用带有 std::strings 的 hash_set（因为我无法让它与 const char* 一起使用），如下所示：

```
stdext::hash_set<const std::string> _items;
_items.insert("LONG_NAME_A_WITH_SOMETHING");
_items.insert("LONG_NAME_A_WITH_SOMETHING_ELSE");
_items.insert("SHORTER_NAME");
_items.insert("SHORTER_NAME_SPECIAL");

stdext::hash_set<const std::string>::const_iterator it = _items.find( "SHORTER_NAME" ) );

if( it != _items.end() ) {
   std::cout << "item exists" << std::endl;
} 
```

是否有其他人对更快的搜索方法有一个好主意，而无需自己构建完整的哈希表？

* * *

该列表是一个固定的字符串列表，不会更改。它包含受特定错误影响的元素名称列表，当使用较新版本打开时应即时修复。

在使用 Aho-Corasick 之前我已经构建了哈希表，但我不太愿意增加太多的复杂性。

* * *

我对答案的数量感到惊讶。我最终测试了一些方法来测试它们的性能，最后结合了 kirkus 和 Rob K. 的答案。我之前尝试过二进制搜索，但我想我有一个小错误来实现它（它有多难......）。

结果令人震惊......我认为我使用 hash_set 进行了快速实现......好吧，结果我没有。这是一些统计数据（以及最终的代码）：

> **随机查找 5 个现有密钥和 1 个不存在密钥，50.000 次**
> 
> 我的原始算法平均**耗时 18.62**秒
> 线性搜索平均耗时**2.49**秒
> 二进制搜索平均耗时**0.92**秒。
> 使用 gperf 生成的完美哈希表进行搜索平均**需要 0.51**秒。

这是我现在使用的代码：

```
bool searchWithBinaryLookup(const std::string& strKey) {
   static const char arrItems[][NUM_ITEMS] = { /* list of items */ };

   /* Binary lookup */
   int low, mid, high;

   low = 0;
   high = NUM_ITEMS;
   while( low < high ) {
      mid = (low + high) / 2;
      if(arrAffectedSymbols[mid] > strKey) {
         high = mid;
      }
      else if(arrAffectedSymbols[mid] < strKey) {
         low = mid + 1;
      }
      else {
         return true;
      }
   }

   return false;
} 
```

*注意：这是 Microsoft VC++，所以我没有使用 SGI 的 std::hash_set。*

* * *

我今天早上按照[VardhanDotNet 的](https://stackoverflow.com/users/10958/vardhandotnet)建议使用 gperf 进行了一些测试，这确实快了很多。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-26T15:25:21.703

如果您的字符串列表在编译时是固定的，请使用 gperf [http://www.gnu.org/software/gperf/](http://www.gnu.org/software/gperf/)引用 ：gperf 是一个完美的哈希函数生成器。对于给定的字符串列表，它以 C 或 C++ 代码的形式生成哈希函数和哈希表，用于根据输入字符串查找值。哈希函数是完美的，这意味着哈希表没有冲突，哈希表查找只需要单个字符串比较。

gperf 的输出不受 gpl 或 lgpl 的约束，afaik。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-26T14:47:57.770

如果标准容器都不能满足您的需求，您可以尝试使用 PATRICIA Trie。

最坏情况的查找受您正在查找的字符串长度的限制。此外，字符串共享公共前缀，因此在内存上非常容易。因此，如果您有很多相对较短的字符串，这可能是有益的。

[在这里查看。](http://en.wikipedia.org/wiki/Radix_tree)

注意：PATRICIA = 检索以字母数字编码的信息的实用算法

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T18:08:31.937

std::vector 有什么问题？加载它，sort(v.begin(), v.end()) 一次，然后使用 lower_bound() 查看字符串是否在向量中。在排序的随机访问迭代器上，lower_bound 保证为 O(log2 N)。如果值是固定的，我无法理解对哈希的需求。向量比散列占用更少的内存空间并且分配更少。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-26T14:50:26.640

如果是固定列表，对列表进行排序并进行二分查找？我无法想象，现代 CPU 上只有一百个左右的字符串，你真的会看到算法之间有任何明显的差异，除非你的应用程序除了 100% 的时间搜索列表之外什么都不做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T14:28:24.300

我怀疑你会想出一个更好的哈希表；如果列表不时变化，您可能已经找到了最好的方法。

最快的方法是构建一个有限状态机来扫描输入。我不确定最好的现代工具是什么（自从我在实践中做过类似的事情已经十多年了），但 Lex/Flex 是标准的 Unix 构造函数。

FSM 有一个状态表和一个接受状态列表。它从初始状态开始，对输入进行逐个字符的扫描。每个状态对每个可能的输入字符都有一个条目。该条目可能是进入另一个状态，也可能是因为字符串不在列表中而中止。如果 FSM 在没有中止的情况下到达输入字符串的末尾，它会检查它所处的最终状态，这是一个接受状态（在这种情况下你已经匹配了字符串）或者不是（在这种情况下你没有't）。

任何关于编译器的书都应该有更多的细节，或者你无疑可以在网上找到更多的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T14:51:28.887

如果您所说的要检查数百个数字的字符串集，这是在执行 I/O 时（加载文件，我假设它通常来自磁盘），那么我会说：profile what you'在寻找更奇特/复杂的解决方案之前，已经有了。

当然，可能是您的“文档”包含数以亿计的这些字符串，在这种情况下，我想这真的需要时间......没有更多细节，很难确定。

我所说的归结为“在（过度）优化之前考虑用例和典型场景”，我想这只是关于邪恶根源的旧事物的专业化...... :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-26T17:57:26.950

100 个独特的字符串？如果不经常调用它，并且列表不会动态更改，我可能会使用带有线性搜索的直接 const char 数组。除非你经常搜索它，否则这么小的东西不值得额外的代码。像这样的东西：

```
const char _items[][MAX_ITEM_LEN] = { ... };
int i = 0;
for (;  strcmp( a, _items[i] ) < 0 && i < NUM_ITEMS; ++i );
bool found = i < NUM_ITEMS && strcmp( a, _items[i] ) == 0; 
```

对于这么小的列表，我认为您的实施和维护成本以及任何更复杂的东西可能会超过运行时间成本，而且您不会真正获得比这更便宜的空间成本。为了获得更快的速度，你可以做一个第一个字符的哈希表->列表索引来设置 i 的初始值；

对于这么小的列表，您可能不会变得更快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-26T14:41:33.587

我不知道 MS 使用哪种散列函数来处理刺痛，但也许你可以想出一些更简单（=更快）的东西，适用于你的特殊情况。容器应该允许您使用自定义散列类。

如果这是容器的实现问题，您也可以尝试 boosts [std::tr1::unordered_set](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered.html)是否提供更好的结果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T14:51:58.260

哈希表是一个很好的解决方案，通过使用预先存在的实现，您可能会获得良好的性能。尽管我相信另一种选择称为“索引”。

保留一些指向方便位置的指针。例如，如果它使用字母进行排序，请保留一个指向以 aa、ab、ac... ba、bc、bd 开头的所有内容的指针...这是几百个指针，但这意味着您可以跳到列表的一部分在继续之前已经非常接近结果了。例如，如果一个条目是“afunctionname”，那么您可以在 af 和 ag 的指针之间进行二进制搜索，这比搜索全部要快得多...如果您总共有一百万条记录，您可能只需要二进制搜索一个列表几千。

我重新发明了这个特殊的轮子，但是可能已经有很多实现了，这将让您省去实现的麻烦，并且可能比我可以在这里粘贴的任何代码都快。:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-06T20:29:38.173

您正在使用二进制搜索，即 O(log(n))。您应该查看插值搜索，这不是“最坏情况”那么好，但它的平均情况更好：O(log(log(n)).

# powershell - 使用 PowerShell 进行过滤和复制

> ID：479922
> 
> 赞同：0
> 
> 时间：2009-01-26T14:17:25.180
> 
> 标签：powershell

为了提高我的 PowerShell 技能，这里有一个简单问题的丑陋解决方案示例。欢迎任何关于如何改进 oneliner 的建议。

任务：将庞大的图标库精简为更易于管理的东西。原始目录结构如下所示：

```
  /应用程序和实用程序
    /编译
      /32 位阿尔法 PNG
        /编译 16 n p.png
        /+ 10 个或更多文件
      /+ 5 种格式，每种格式有 10 个或更多文件
    /+ 20 个左右的图标名称
  /+ 22 个更多类别

```

我想复制 32 位 Alpha png 并将目录结构展平一点。这是我快速且非常肮脏的解决方案：

```
$dest = mkdir c:\icons; gci -r | ? { $_.Name -eq '32 位阿尔夫
一个png' } | % { mkdir ("$dest\" + $_.Parent.Parent.Name + "\" + $_.Parent.Name); $_ } | gci | % { cp $_。
全名 -dest ("$dest\" + $_.Directory.Parent.Parent + "\" + $_.Directory.Parent) }

```

不好，但它解决了我的问题。结果结构：

```
  /应用程序和实用程序
    /编译
      /编译 16 n p.png
      /ETC
    /ETC
  /ETC

```

你会怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-26T18:14:57.790

三个评论：

*   在第一次测试后，您并没有隐含地对结果进行排序。这可能无关紧要（它们可能无论如何都会排序），但是由于您正在构建基于 Parent.Parent 的目录结构......我可以设想一个 PNG 图像列表，它会导致某种（不是双关语）问题。
*   也许我是老式的，但我发现**dir**比**gci**更具可读性。在我自己的脚本中，我通常会尝试扩展大多数别名，因为它往往会提高那些对 PowerShell 较新的人的可读性和可维护性。
*   与其将所有内容链接在一起，不如将块分解为变量并将其封装在 cmdlet/函数中。

# c# - C# 是单调度语言还是多调度语言？

> ID：479923
> 
> 赞同：30
> 
> 时间：2009-01-26T14:17:39.843
> 
> 标签：c#, programming-languages, multiple-dispatch, single-dispatch

我试图准确地理解单次和多次调度是什么。

我刚读到这个：
[http ://en.wikipedia.org/wiki/Multiple_dispatch](http://en.wikipedia.org/wiki/Multiple_dispatch)

从这个定义来看，在我看来，C# 和 VB.Net 是多调度的，即使在编译时选择调用哪个重载也是如此。

我在这里是正确的，还是我错过了什么？谢谢！

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-27T14:42:51.930

好的，我理解函数重载与多次调度的细微差别。

基本上，区别在于调用哪个方法是在运行时还是编译时选择的。现在，我知道每个人都这么说，但没有一个明确的例子，这听起来很明显，因为 C# 是静态类型的，而多调度语言（至少对我来说显然）似乎是动态类型的。到现在为止，就这个定义而言，多重调度和函数重载对我来说听起来完全一样。

真正不同的情况是，当您有 2 个在参数类型上不同的方法重载时，但是这 2 个类型是多态的，并且您使用声明为更高类型的引用进行调用，该引用的对象为较低的类型...（如果有人能想到更好的表达方式，请随时编辑此答案）

例子：

```
int CaptureSpaceShip(IRebelAllianceShip ship) {}
int CaptureSpaceShip(XWing ship) {}

void Main() { 
  IRebelAllianceShip theShip = new XWing();
  CaptureSpaceShip(theShip);
} 
```

XWing 显然实现了 IRebelAllianceShip。在这种情况下，将调用第一个方法，而如果 C# 实现了多次调度，则将调用第二个方法。

对文档重新哈希感到抱歉...在我看来，这似乎是解释这种差异的最清晰方法，而不仅仅是阅读每个调度方法的定义。

更正式的解释： [http ://en.wikipedia.org/wiki/Double_dispatch#Double_dispatch_is_more_than_function_overloading](http://en.wikipedia.org/wiki/Double_dispatch#Double_dispatch_is_more_than_function_overloading "http://en.wikipedia.org/wiki/Double_dispatch#Double_dispatch_is_more_than_function_overloading")

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-06-14T15:42:38.467

对于那些使用搜索引擎找到这篇文章的人，C# 4.0 引入了[动态](http://msdn.microsoft.com/en-us/library/dd264736.aspx)关键字。代码如下所示。

```
int CaptureSpaceShip(IRebelAllianceShip ship) {}
int CaptureSpaceShip(XWing ship) {}

void Main() {   
    IRebelAllianceShip theShip = new XWing();  
    CaptureSpaceShip((dynamic)theShip);
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-26T14:29:32.160

C# 是单一调度，但有一些博客文章的标题看起来像是在尝试模拟多方法。如果我可以加载其中一篇文章，我将在此处更新我的答案。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-01-18T11:56:17.007

也许有人会对使用动态关键字**进行多次调度的良好 C# 示例感兴趣（** [MSDN 博客](http://www.shawnhargreaves.com/blog/visitor-and-multiple-dispatch-via-c-dynamic.html)）

```
class Animal 
{ 
}

class Cat : Animal 
{ 
}

class Dog : Animal 
{ 
}

class Mouse : Animal 
{ 
} 
```

我们可以为同一个方法创建多个重载，根据其参数类型的不同组合进行专门化：

```
void ReactSpecialization(Animal me, Animal other) 
{ 
    Console.WriteLine("{0} is not interested in {1}.", me, other); 
}

void ReactSpecialization(Cat me, Dog other) 
{ 
    Console.WriteLine("Cat runs away from dog."); 
}

void ReactSpecialization(Cat me, Mouse other) 
{ 
    Console.WriteLine("Cat chases mouse."); 
}

void ReactSpecialization(Dog me, Cat other) 
{ 
    Console.WriteLine("Dog chases cat."); 
} 
```

现在神奇的部分：

```
void React(Animal me, Animal other) 
{ 
    ReactSpecialization(me as dynamic, other as dynamic); 
} 
```

这是因为“动态”强制转换，它告诉 C# 编译器，而不是仅仅调用 ReactSpecialization(Animal, Animal)，动态检查每个参数的类型并在运行时选择要调用的方法重载。

为了证明它确实有效：

```
void Test() 
{ 
    Animal cat = new Cat(); 
    Animal dog = new Dog(); 
    Animal mouse = new Mouse();

    React(cat, dog); 
    React(cat, mouse); 
    React(dog, cat); 
    React(dog, mouse); 
} 
```

输出：

```
Cat runs away from dog.
Cat chases mouse.
Dog chases cat.
Dog is not interested in Mouse. 
```

维基百科说 C# 4.0（动态）是“多调度”语言。
我还认为 Java、C#（4.0 之前的版本）、C++ 等语言是单调度的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T14:38:25.433

C# 不支持多分派。访问者设计模式模拟了可以描述为多次分派的东西，尽管访问者模式主要关注将算法与层次结构分离。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T17:47:59.670

根据[引用的 Wikipedia 文章](http://en.wikipedia.org/wiki/Multiple_dispatch "维基百科关于多次调度的文章")，根据定义，多重分派是基于所涉及对象的运行时类型，因此 C# 和 VB.net*不*使用它，因为正如您所说，在编译时做出决定.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T14:36:28.993

GoF 访问者模式是如何进行双重调度的示例。Scott Meyers “更有效的 C++” 向您展示了如何在 C++ 中执行此操作。这是 Dobbs 博士的[链接](http://www.ddj.com/cpp/184405527)，讨论了如何在 Java 和 C++ 中进行双重调度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-01-22T14:13:03.720

我明白这是一个老问题..

在 .Net 4.0 中，您可以`dynamic`为多种方法使用关键字...请看下面的示例[.Net 4.0 重构现有“if”条件和“is”运算符的优化代码](https://stackoverflow.com/questions/21261519/net-4-0-optimized-code-for-refactoring-existing-if-conditions-and-is-operat/21284844#21284844)

# linux - 我应该在嵌入式系统上 fsck ext3 吗？

> ID：479926
> 
> 赞同：3
> 
> 时间：2009-01-26T14:19:05.457
> 
> 标签：linux, embedded, filesystems, ext3

我们有许多嵌入式系统需要对文件系统进行读/写访问，这些文件系统驻留在具有块设备仿真的闪存存储上。我们最古老的平台在紧凑型闪存上运行，这些系统已经使用了 3 年以上，在启动期间没有运行单个 fsck，到目前为止，我们没有任何故障归因于文件系统或 CF。

在我们最新的平台上，我们使用 USB 闪存进行初始生产，现在正在迁移到 Disk-on-Module 进行读写存储。不久前，我们在 USB 存储上运行的许多设备上的文件系统存在一些问题，因此我启用了 e2fsck 以查看是否有帮助。事实证明，我们收到了一批坏闪存，因此一旦更换了这些闪存，问题就消失了。从那以后我禁用了 e2fsck，因为我们没有迹象表明它使系统更加可靠，而且从历史上看，没有它我们一直很好。

现在我们已经开始放入 Disk-on-Module 单元，我又开始看到文件系统错误。突然系统无法读取/写入某些文件，如果我尝试从紧急控制台访问该文件，我只会收到“*输入/输出错误*”。我再次启用了 e2fsck 并更正了所有文件。

O'Reilly 的“*构建嵌入式 Linux 系统*”建议在 ext2 文件系统上运行 e2fsck，但没有提及与 ext3 相关的内容，所以我对是否应该启用它有点困惑。

您对在嵌入式系统上运行 fsck 有何看法？我们正在考虑将二进制文件放在 ar/o 分区上，并且只将必须修改的文件放在同一闪存设备上的 ar/w 分区上，以便 fsck 永远不会意外删除重要的系统二进制文件，有没有人有这种设置的经验（好坏）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T14:46:08.147

我认为您的问题的答案更多地与您的应用程序相对于其数据的一致性要求类型有关。也就是说，如果在没有正式关闭系统的情况下断电，必须保证什么？一般来说，如果没有特定的应用程序关闭/同步文件和刷新磁盘缓存等，在应用程序的关键事务点，没有一个桌面操作系统类型的文件系统可以很好地处理这一切，以确保您需要维护的内容在事实向媒体承诺。

运行 fsck 会修复文件系统，但如果没有上述注意，则无法保证您所做的更改将实际保留。即：由于电源故障，您将失去什么并不是完全确定的。

我同意将您的二进制文件或其他重要的只读数据放在单独的只读分区上确实有助于确保它们不会由于对文件系统结构的 fsck 更正而被错误地丢弃。至少，将它们放在与保存 R/W 数据的位置不同的子目录中会有所帮助。但是在这两种情况下，如果您支持软件更新，您仍然需要有方案来处理写入“只读”区域。

在我们的应用程序中，我们实际上为二进制文件之类的东西维护了一对目录，并且系统设置为从这两个区域中的任何一个区域启动。在软件更新期间，我们更新第一个目录，将所有内容同步到媒体并验证磁盘上的 MD5 校验和，然后再进行第二个副本的更新。在引导期间，它们仅在 MD5 校验和良好时使用。这可确保您始终启动一致的映像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T18:12:03.013

戴夫，

我总是建议在多次重新启动后运行 fsck，但不是每次都运行。

原因是，ext3 是日志型的。因此，除非您启用回写（无日志），否则大多数情况下，您的元数据/文件系统表应该与您的数据（文件）同步。

但就像 Jeff 提到的，它不能保证文件系统之上的层。这意味着，您仍然会得到“损坏”的文件，因为某些记录可能没有写入文件系统。

我不确定您在哪个嵌入式设备上运行，但它多久重新启动一次？如果它是受控重启，您可以在重启前执行“同步；同步；同步”。

我自己使用 CF 已经很多年了，而且在极少数情况下我会遇到文件系统错误。fsck 确实对这种情况有所帮助。

关于分离你的分区，我怀疑它的优势。对于文件系统上的每个数据/文件，都有一个与之关联的元数据。大多数情况下，如果您不更改文件，例如。二进制/系统文件，则此元数据不应更改。除非您的硬件有故障，例如串扰读写，否则那些只读文件应该是安全的。

大多数问题出现在你有可写的东西时，不管你把它放在哪里，如果应用程序不能很好地处理它，它可能会导致问题。

希望有帮助。

# c++ - 在 C++ 中从主机获取延迟

> ID：479929
> 
> 赞同：2
> 
> 时间：2009-01-26T14:19:56.767
> 
> 标签：c++, latency, ping

使用 C++，我想使用命令/类来获取 ping 主机以在我的程序中使用的延迟时间。我尝试使用 ping 命令，但没有简单的方法来收集时间，因为它包含在其他统计信息中。我希望有一个更简单的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T14:56:15.413

[ping](http://en.wikipedia.org/wiki/Ping)工具通常在 C 中实现，通过在原始套接字上发送ICMP [Echo](http://en.wikipedia.org/wiki/Raw_socket)[请求](http://en.wikipedia.org/wiki/Internet_Control_Message_Protocol) [数据](http://en.wikipedia.org/wiki/Ping#Echo_request)包来工作。当发出 Echo 请求并再次收到[Echo 回复](http://en.wikipedia.org/wiki/Ping#Echo_reply)（如果有）以确定往返时间时，系统时间被记录 - 通常在[posix下使用](http://en.wikipedia.org/wiki/POSIX)[gettimeofday 。](http://www.opengroup.org/onlinepubs/000095399/functions/gettimeofday.html)[您可以使用sockets](http://beej.us/guide/bgnet/output/html/singlepage/bgnet.html#theory)在您的 C++ 应用程序中放置相同的功能。

否则，从 ping 系统调用中提取信息可能比您想象的要容易。关键是打开[管道](http://en.wikipedia.org/wiki/Pipeline_(Unix))以允许读取 ping 命令的[标准输出](http://en.wikipedia.org/wiki/Stdout#Standard_output_.28stdout.29)（请参阅[`popen`](http://opengroup.org/onlinepubs/007908775/xsh/popen.html)或[`_popen`](http://msdn.microsoft.com/en-us/library/96ayss4b(VS.80).aspx)）。可以使用[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)（例如“time=([0-9]*)”）来提取所需的数据。如果您没有可用的正则表达式库，那么提取此数据只需要相当简单的字符串操作。[STL 字符串类](http://www.sgi.com/tech/stl/basic_string.html)提供了几种可能有用的算法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T15:57:29.907

如果您不喜欢正则表达式，您可以随时循环输出，查找 t 后跟 i 后跟 m 后跟 e 后跟 =，只需一次遍历输出字符串即可。在 = 之后存储指向 char 的指针，然后进一步执行并将下一个空格替换为零。您现在有一个带有延迟的字符串，可以使用现有的转换函数转换为数字。

例如，如果输出是 char* 输出，长度存储在 unsigned int 长度中，并且匹配的字符串需要进入 char* 匹配...

```
for(unsigned int i = 4; i < length; ++i)
{
  if(output[i] == '=')
  {
    if((output[i-4] = 't') && (output[i-3] = 'i') && (output[i-2] = 'm') && (output[i-1] = 'e'))
    {
      match = &(output[i+1]);
      while(output[i] != ' ') ++i;
      output[i] = 0;
      break;
    }
  }
} 
```

正则表达式虽然更好......它们使您的代码看起来更潮和可读。虽然如果你没有他们的图书馆，那么像这样实现它会更快...... :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-05-06T07:06:49.170

如果您使用的是 Windows，则可以使用 win32 api 函数[https://docs.microsoft.com/en-us/windows/win32/api/icmpapi/nf-icmpapi-icmpsendecho2](https://docs.microsoft.com/en-us/windows/win32/api/icmpapi/nf-icmpapi-icmpsendecho2)。

# php - 将 xCache 与 Zend 优化器一起使用

> ID：479938
> 
> 赞同：0
> 
> 时间：2009-01-26T14:23:23.437
> 
> 标签：php, xcache, zend-optimizer

我同时安装了 xCache 和 Zend 优化器，它给了我 PHP 致命错误：[Zend Optimizer] Zend Optimizer 3.3.3 is in compatible with XCache 1.2.1 in Unknown on line 0

我在安装文档中有几行我应该将 zend php.ini 文件包含到普通的 php.ini 中，并确保 xCache 在 Zend Optimizer 之前运行。

我的问题是如何在 php.ini 中包含文件以及如何确保 xCache 在 Zend Optimizer 之前运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-08T23:00:21.257

我遇到过同样的问题。FWIW Zend Optimizer（不包括 Zend Platform）不是像 XCache 那样的操作码缓存器。我已经成功地同时运行了两者。诀窍是替换以下行：

```
extension=xcache.so 
```

有了这个：

```
zend_extension=/path/to/xcache.so 
```

（请注意，zend 扩展可能需要 xcache.so 库的完整路径）

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-21T06:48:41.733

所有 PHP 操作码缓存都是互斥的 - 包括：xCache、Zend Optimizer、APC 或 eAccelerator。不要尝试同时使用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-17T18:07:22.800

您可以通过将 xcache ini 设置放在 Zend Optimizer ini 设置之前来确保首先加载 xcache。没有其他方法我知道...

IE。确保 ini 中的 [xcache] 和所有其他 [xcache...] 部分在加载 Zend Optimizer 的行之前（在 Linux 上应该类似于以下内容：zend_extension=/usr/local/Zend/lib/ZendOptimizer 。所以）。

但正如其他回复中提到的，将 XCache 和 Zend Optimizer 一起使用可能并不可取，特别是因为过去存在兼容性问题。如果您可以不使用 Zend Optimizer（即不使用受 Zend Guard 保护的脚本时），那么从 php.ini 中删除相关配置行是安全的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T11:10:20.753

经典笑话：“医生，我做X的时候很痛！” - “所以不要做X”

快速浏览似乎表明这两种产品都在 PHP 操作码级别上运行，并且很可能，特别是考虑到错误消息，它们是不兼容的。

# wpf - Image.FromHbitmap WPF 等效项

> ID：479939
> 
> 赞同：4
> 
> 时间：2009-01-26T14:23:33.777
> 
> 标签：wpf, winforms, system.drawing

WPF 中是否有等效的 System.Drawing.Image.FromHbitmap？另外，是否可以在创建图像后正确处理手柄？

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T14:29:55.137

查看System.Windows.Interop 命名空间中的[Imaging.CreateBitmapSourceFromHBitmap](http://msdn.microsoft.com/en-us/library/system.windows.interop.imaging.createbitmapsourcefromhbitmap.aspx)。

# linux - 如何找出 Linux 中哪些进程正在使用交换空间？

> ID：479953
> 
> 赞同：263
> 
> 时间：2009-01-26T14:29:57.697
> 
> 标签：linux, memory, swap

在 Linux 下，如何找出哪个进程使用的交换空间更多？

* * *

## 回答 #1

> 赞同：313
> 
> 时间：2011-08-24T17:58:15.467

我找到的最好的脚本在这个页面上：http: [//northernmost.org/blog/find-out-what-is-using-your-swap/](http://northernmost.org/blog/find-out-what-is-using-your-swap/)

这是脚本的一种变体，不需要根：

```
#!/bin/bash 
# Get current swap usage for all running processes
# Erik Ljungstrom 27/05/2011
# Modified by Mikko Rantalainen 2012-08-09
# Pipe the output to "sort -nk3" to get sorted output
# Modified by Marc Methot 2014-09-18
# removed the need for sudo

SUM=0
OVERALL=0
for DIR in `find /proc/ -maxdepth 1 -type d -regex "^/proc/[0-9]+"`
do
    PID=`echo $DIR | cut -d / -f 3`
    PROGNAME=`ps -p $PID -o comm --no-headers`
    for SWAP in `grep VmSwap $DIR/status 2>/dev/null | awk '{ print $2 }'`
    do
        let SUM=$SUM+$SWAP
    done
    if (( $SUM > 0 )); then
        echo "PID=$PID swapped $SUM KB ($PROGNAME)"
    fi
    let OVERALL=$OVERALL+$SUM
    SUM=0
done
echo "Overall swap used: $OVERALL KB" 
```

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-01-26T14:47:05.150

运行*top*然后按`O``p``Enter`。现在应该按照它们的交换使用对进程进行排序。

这是一个更新，因为我的原始答案没有提供评论中指出的问题的确切答案。从[htop 常见问题解答](http://hisham.hm/htop/index.php?page=faq)：

> 无法获得进程已用交换空间的确切大小。Top 通过设置 SWAP = VIRT - RES 来伪造此信息，但这不是一个好的指标，因为其他东西（例如视频内存）也计入 VIRT（例如：top 说我的 X 进程正在使用 81M 的交换，但它也报告我的系统整体只使用了2M的swap。因此，我不会在htop中添加类似的Swap列，因为我不知道获取此信息的可靠方法（实际上，我认为无法获取）一个确切的数字，因为共享页面）。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2012-09-03T22:24:27.737

这是脚本的另一个变体，但旨在提供更具可读性的输出（您需要以 root 身份运行它才能获得准确的结果）：

```
#!/bin/bash

    # find-out-what-is-using-your-swap.sh
    # -- Get current swap usage for all running processes
    # --
    # -- rev.0.3, 2012-09-03, Jan Smid          - alignment and intendation, sorting
    # -- rev.0.2, 2012-08-09, Mikko Rantalainen - pipe the output to "sort -nk3" to get sorted output
    # -- rev.0.1, 2011-05-27, Erik Ljungstrom   - initial version

SCRIPT_NAME=`basename $0`;
SORT="kb";                 # {pid|kB|name} as first parameter, [default: kb]
[ "$1" != "" ] && { SORT="$1"; }

[ ! -x `which mktemp` ] && { echo "ERROR: mktemp is not available!"; exit; }
MKTEMP=`which mktemp`;
TMP=`${MKTEMP} -d`;
[ ! -d "${TMP}" ] && { echo "ERROR: unable to create temp dir!"; exit; }

>${TMP}/${SCRIPT_NAME}.pid;
>${TMP}/${SCRIPT_NAME}.kb;
>${TMP}/${SCRIPT_NAME}.name;

SUM=0;
OVERALL=0;
    echo "${OVERALL}" > ${TMP}/${SCRIPT_NAME}.overal;

for DIR in `find /proc/ -maxdepth 1 -type d -regex "^/proc/[0-9]+"`;
do
    PID=`echo $DIR | cut -d / -f 3`
    PROGNAME=`ps -p $PID -o comm --no-headers`

    for SWAP in `grep Swap $DIR/smaps 2>/dev/null| awk '{ print $2 }'`
    do
        let SUM=$SUM+$SWAP
    done

    if (( $SUM > 0 ));
    then
        echo -n ".";
        echo -e "${PID}\t${SUM}\t${PROGNAME}" >> ${TMP}/${SCRIPT_NAME}.pid;
        echo -e "${SUM}\t${PID}\t${PROGNAME}" >> ${TMP}/${SCRIPT_NAME}.kb;
        echo -e "${PROGNAME}\t${SUM}\t${PID}" >> ${TMP}/${SCRIPT_NAME}.name;
    fi
    let OVERALL=$OVERALL+$SUM
    SUM=0
done
echo "${OVERALL}" > ${TMP}/${SCRIPT_NAME}.overal;
echo;
echo "Overall swap used: ${OVERALL} kB";
echo "========================================";
case "${SORT}" in
    name )
        echo -e "name\tkB\tpid";
        echo "========================================";
        cat ${TMP}/${SCRIPT_NAME}.name|sort -r;
        ;;

    kb )
        echo -e "kB\tpid\tname";
        echo "========================================";
        cat ${TMP}/${SCRIPT_NAME}.kb|sort -rh;
        ;;

    pid | * )
        echo -e "pid\tkB\tname";
        echo "========================================";
        cat ${TMP}/${SCRIPT_NAME}.pid|sort -rh;
        ;;
esac
rm -fR "${TMP}/"; 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2014-10-06T12:36:22.500

采用[**`smem`**](https://www.selenic.com/smem/)

```
smem -s swap -r 
```

这是一个链接，它告诉您如何安装它以及如何使用它： [http ://www.cyberciti.biz/faq/linux-which-process-is-using-swap/](http://www.cyberciti.biz/faq/linux-which-process-is-using-swap/)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-26T14:54:09.787

如果您的意思是要查找换出页面最多的进程或导致大多数页面换出的进程，这并不完全清楚。

对于第一个，您可以`top`通过交换运行和排序（按“Op”），对于后者，您可以运行`vmstat`并查找“so”的非零条目。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2015-09-01T09:10:45.780

另一个避免 shell 循环的脚本变体：

```
#!/bin/bash
grep VmSwap /proc/[0-9]*/status | awk -F':' -v sort="$1" '
  {
    split($1,pid,"/") # Split first field on /
    split($3,swp," ") # Split third field on space
    cmdlinefile = "/proc/"pid[3]"/cmdline" # Build the cmdline filepath
    getline pname[pid[3]] < cmdlinefile # Get the command line from pid
    swap[pid[3]] = sprintf("%6i %s",swp[1],swp[2]) # Store the swap used (with unit to avoid rebuilding at print)
    sum+=swp[1] # Sum the swap
  }
  END {
    OFS="\t" # Change the output separator to tabulation
    print "Pid","Swap used","Command line" # Print header
    if(sort) {
      getline max_pid < "/proc/sys/kernel/pid_max"
      for(p=1;p<=max_pid;p++) {
        if(p in pname) print p,swap[p],pname[p] # print the values
      }
    } else {
      for(p in pname) { # Loop over all pids found
        print p,swap[p],pname[p] # print the values
      }
    }
    print "Total swap used:",sum # print the sum
  }' 
```

标准用法是以`script.sh`随机顺序获取每个程序的使用情况（直至如何`awk`存储其哈希值）或`script.sh 1`按 pid 对输出进行排序。

我希望我对代码的评论足以说明它的作用。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-08-05T13:24:48.527

## 还有两个变种：

因为`top`或`htop`不能安装在小型系统上，所以浏览`/proc`始终是可能的。

即使在小型系统上，您也会发现`shell`...

### 外壳变[体](/questions/tagged/shell "显示标记为“外壳”的问题")！（不只是 bash）

[这与lolotux 脚本](https://stackoverflow.com/a/7180078/1765658)完全相同`grep`，但没有任何 fork`awk`或`ps`. 这要**快很多！**

由于[bash](/questions/tagged/bash "显示标记为“bash”的问题")是性能最差的[shell](/questions/tagged/shell "显示标记为“外壳”的问题")之一，因此做了一些工作以确保该脚本在[dash](/questions/tagged/dash "显示标记为“破折号”的问题")、[busybox](/questions/tagged/busybox "显示标记为“busybox”的问题")和其他一些下运行良好。然后，（[感谢 Stéphane Chazelas](https://unix.stackexchange.com/posts/comments/529313)）再次变得更快！

```
#!/bin/sh 
# Get current swap usage for all running processes
# Felix Hauri 2016-08-05
# Rewritted without fork. Inspired by first stuff from
# Erik Ljungstrom 27/05/2011
# Modified by Mikko Rantalainen 2012-08-09
# Pipe the output to "sort -nk3" to get sorted output
# Modified by Marc Methot 2014-09-18
# removed the need for sudo

OVERALL=0
for FILE in /proc/[0-9]*/status ;do
    SUM=0
    while read FIELD VALUE;do
        case $FIELD in
            Pid )    PID=$VALUE         ;;
            Name )   PROGNAME="$VALUE"  ;;
            VmSwap ) SUM=${VALUE%% *} ; break ;;
        esac
    done <$FILE
    [ $SUM -gt 0 ] &&
        printf "PID: %9d  swapped: %11d KB (%s)\n" $PID $SUM "$PROGNAME"
    OVERALL=$((OVERALL+SUM))
done
printf "Total swapped memory: %14u KB\n" $OVERALL 
```

不要忘记双引号`"$PROGNAME"`！见[Stéphane Chazelas 的评论](https://stackoverflow.com/posts/comments/65031174?noredirect=1)：

```
read FIELD PROGNAME < <(
    perl -ne 'BEGIN{$0="/*/*/../../*/*"} print if /^Name/' /proc/self/status
)
echo $FIELD "$PROGNAME" 
```

不要`echo $PROGNAME`在明智的系统上尝试没有双引号，并准备好之前杀死当前的shell！

### 还有一个[perl](/questions/tagged/perl "显示标记为“perl”的问题")版本

随着这变成一个*不那么简单*的脚本，是时候使用更高效的语言来编写专用工具了。

```
#!/usr/bin/perl -w

use strict;
use Getopt::Std;
my ($tot,$mtot)=(0,0);
my %procs;

my %opts;
getopt('', \%opts);

sub sortres {
    return $a <=> $b                                          if $opts{'p'};
    return $procs{$a}->{'cmd'} cmp $procs{$b}->{'cmd'}        if $opts{'c'};
    return $procs{$a}->{'mswap'} <=> $procs{$b}->{'mswap'}    if $opts{'m'};
    return $procs{$a}->{'swap'} <=> $procs{$b}->{'swap'};
};

opendir my $dh,"/proc";

for my $pid (grep {/^\d+$/} readdir $dh) {
    if (open my $fh,"</proc/$pid/status") {
        my ($sum,$nam)=(0,"");
        while (<$fh>) {
            $sum+=$1 if /^VmSwap:\s+(\d+)\s/;
            $nam=$1 if /^Name:\s+(\S+)/;
        }
        if ($sum) {
            $tot+=$sum;
            $procs{$pid}->{'swap'}=$sum;
            $procs{$pid}->{'cmd'}=$nam;
            close $fh;
            if (open my $fh,"</proc/$pid/smaps") {
                $sum=0;
                while (<$fh>) {
                    $sum+=$1 if /^Swap:\s+(\d+)\s/;
                };
            };
            $mtot+=$sum;
            $procs{$pid}->{'mswap'}=$sum;
        } else { close $fh; };
    };
};
map {
    printf "PID: %9d  swapped: %11d (%11d) KB (%s)\n",
        $_, $procs{$_}->{'swap'}, $procs{$_}->{'mswap'}, $procs{$_}->{'cmd'};
} sort sortres keys %procs;
printf "Total swapped memory: %14u (%11u) KB\n", $tot,$mtot; 
```

可以通过其中之一运行

```
-c  sort by command name
-p  sort by pid
-m  sort by swap values
by default, output is sorted by status's vmsize 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-07-27T07:31:15.973

top 命令还包含一个字段，用于显示进程的页面错误数。页面错误最多的进程将是交换最多的进程。对于长时间运行的守护进程，它们可能会在开始时引发大量页面错误，并且以后数量不会增加。所以我们需要观察缺页是否在增加。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-03-16T17:15:29.050

我在网上改编了一个不同的脚本来适应这个长的单行：

```
 { date;for f in /proc/[0-9]*/status; do 
   awk '{k[$1]=$2} END { if (k["VmSwap:"]) print k["Pid:"],k["Name:"],k["VmSwap:"];}' $f 2>/dev/null; 
   done | sort -n ; } 
```

然后我将其放入 cronjob 并将输出重定向到日志文件。这里的信息和在smaps文件中累积`Swap:`条目是一样的，但是如果你想确定，你可以使用：

```
{ date;for m in /proc/*/smaps;do 
  awk '/^Swap/ {s+=$2} END { if (s) print FILENAME,s }' $m 2>/dev/null;
  done | tr -dc ' [0-9]\n' |sort -k 1n; } 
```

此版本的输出分为两列：pid、swap 数量。在上述版本中，去`tr`除了非数字组件。在这两种情况下，输出都按 pid 进行数字排序。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-05-30T08:01:04.473

给出使用交换的进程的总数和百分比

```
smem -t -p 
```

[![在此处输入图像描述](https://i.stack.imgur.com/kvPfg.jpg)](https://i.stack.imgur.com/kvPfg.jpg)

来源：[https ://www.cyberciti.biz/faq/linux-which-process-is-using-swap/](https://www.cyberciti.biz/faq/linux-which-process-is-using-swap/)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-01-19T09:31:52.883

在 MacOSX 上，您也可以运行 top 命令，但需要输入“o”，然后输入“vsize”，然后按 Enter。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-05-08T09:11:00.510

自 2015 年内核补丁添加`SwapPss`（[https://lore.kernel.org/patchwork/patch/570506/](https://lore.kernel.org/patchwork/patch/570506/)）以来，最终可以获得成比例的交换计数，这意味着如果一个进程交换了很多然后它分叉，两个分叉的进程将报告每个交换 50%。如果有任何一个分叉，每个进程都被计算为交换页面的 33%，所以如果你把所有这些交换使用一起计算，你会得到真正的交换使用，而不是乘以进程计数的值。

**简而言之：**

```
(cd /proc; for pid in [0-9]*; do printf "%5s %6s %s\n" "$pid" "$(awk 'BEGIN{sum=0} /SwapPss:/{sum+=$2} END{print sum}' $pid/smaps)" "$(cat $pid/comm)"; done | sort -k2n,2 -k1n,1) 
```

第一列是 pid，第二列是 KiB 中的交换使用情况，该行的其余部分是正在执行的命令。相同的交换计数按 pid 排序。

上面可能会发出诸如

```
awk: cmd. line:1: fatal: cannot open file `15407/smaps' for reading (No such file or directory) 
```

这仅仅意味着 pid 为 15407 的进程在在列表中看到它`/proc/`和读取进程`smaps`文件之间结束。如果这对您很重要，只需添加`2>/dev/null`到最后。请注意，您也可能会丢失任何其他可能的诊断信息。

在现实世界的示例案例中，这会将其他工具报告为在一台服务器上运行的每个 apache 子级的大约 40 MB 交换使用量，变为每个子级实际使用的 7-3630 KB 之间的实际使用量。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-26T14:38:55.917

我想您可以通过运行`top`并查找使用大量内存的活动进程来很好地猜测。以编程方式执行此操作更难——只要看看关于 Linux OOM 杀手启发式的无休止辩论。

交换是一种使*活动*使用的内存多于安装的内存的功能，因此通常很难将其归咎于单个进程。如果这是一个持续存在的问题，最好的解决方案是安装更多内存，或进行其他系统更改。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-05-12T22:03:18.707

这是一个与@loolotux 的脚本输出相同的版本，但速度更快（但可读性较差）。这个循环在我的机器上大约需要 10 秒，我的版本需要 0.019 秒，这对我很重要，因为我想把它变成一个 cgi 页面。

```
 join -t / -1 3 -2 3 \
    <(grep VmSwap /proc/*/status  |egrep -v '/proc/self|thread-self' | sort -k3,3 --field-separator=/ ) \
    <(grep -H  '' --binary-files=text /proc/*/cmdline |tr '\0' ' '|cut -c 1-200|egrep -v '/proc/self|/thread-self'|sort -k3,3 --field-separator=/ ) \
    | cut -d/ -f1,4,7- \
    | sed 's/status//; s/cmdline//' \
    | sort -h -k3,3 --field-separator=:\
    | tee >(awk -F: '{s+=$3} END {printf "\nTotal Swap Usage = %.0f kB\n",s}') /dev/null 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-08-17T16:46:07.647

那是我的一个班轮：

```
cat /proc/*/status | grep -E 'VmSwap:|Name:' | grep VmSwap -B1 | cut -d':' -f2 | grep -v '\-\-' | grep -o -E '[a-zA-Z0-9]+.*$' | cut -d' ' -f1 | xargs -n2 echo | sort -k2 -n 
```

这一行的步骤是：

*   获取`/proc/process/status`所有进程的所有数据
*   为每个字段选择 VmSwap 和 Name
*   删除没有 VmSwap 字段的进程
*   删除字段的名称（VmSwap: 和 Name:）
*   删除上一步添加的带有 -- 的行
*   删除行首的空格
*   去掉每个进程名的第二部分和交换使用号后面的“kB”
*   取名称和编号（进程名称和交换用法）并将它们放在一行中，一个接一个
*   按交换使用对行进行排序

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-01-26T14:40:43.697

我不知道任何直接的答案，即如何准确找到正在使用交换空间的进程，但是，此链接可能会[有所帮助](http://www.linux.com/articles/114341)。另一个好的[在这里](http://www.linuxjournal.com/article/8178)

此外，使用像 htop 这样的好工具来查看哪些进程正在使用大量内存以及总体上使用了多少交换空间。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-09-01T07:24:52.097

`iotop`是一个非常有用的工具。它提供每个进程/线程的 I/O 和交换使用情况的实时统计信息。默认情况下，它显示每个线程，但您可以`iotop -P`获取每个进程信息。默认情况下不可用。您可能必须通过 rpm/apt 安装。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-09-26T13:39:10.763

您可以使用[Procpath](https://pypi.org/project/Procpath/)（此处为作者）来简化`VmSwap`from的解析`/proc/$PID/status`。

```
$ procpath record -f stat,cmdline,status -r 1 -d db.sqlite
$ sqlite3 -column db.sqlite \
  'SELECT status_name, status_vmswap FROM record ORDER BY status_vmswap DESC LIMIT 5'
Web Content  192136       
okular       186872       
thunderbird  183692       
Web Content  143404       
MainThread   86300 
```

您还可以`VmSwap`像这样随着时间的推移绘制感兴趣的过程。在这里，我记录了我的 Firefox 进程树，同时打开了几十个选项卡，并启动了一个需要大量内存的应用程序以尝试使其交换（这对 Firefox 来说并不令人信服，但你的里程可能会有所不同）。

```
$ procpath record -f stat,cmdline,status -i 1 -d db2.sqlite \
  '$..children[?(@.stat.pid == 6029)]'
# interrupt by Ctrl+C
$ procpath plot -d db2.sqlite -q cpu --custom-value-expr status_vmswap \
  --title "CPU usage, % vs Swap, kB" 
```

[![CPU 使用率，% vs Swap，kB](https://i.stack.imgur.com/kZ7X7.png)](https://i.stack.imgur.com/kZ7X7.png)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-11-16T11:17:57.417

[与@lolotux](https://stackoverflow.com/users/910206/)相同的答案，但输出排序：

```
printf 'Computing swap usage...\n';
swap_usages="$(
    SUM=0
    OVERALL=0

    for DIR in `find /proc/ -maxdepth 1 -type d -regex "^/proc/[0-9]+"`
    do
        PID="$(printf '%s' "$DIR" | cut -d / -f 3)"
        PROGNAME=`ps -p $PID -o comm --no-headers`
        for SWAP in `grep VmSwap $DIR/status 2>/dev/null | awk '{ print $2 }'`
        do
            let SUM=$SUM+$SWAP
        done
        if (( $SUM > 0 )); then
            printf "$SUM KB ($PROGNAME) swapped PID=$PID\\n"
        fi
        let OVERALL=$OVERALL+$SUM
        SUM=0
        break
    done
    printf '9999999999 Overall swap used: %s KB\n' "$OVERALL"
)"

printf '%s' "$swap_usages" | sort -nk1 
```

示例输出：

```
Computing swap usage...
2064 KB (systemd) swapped PID=1
59620 KB (xfdesktop) swapped PID=21405
64484 KB (nemo) swapped PID=763627
66740 KB (teamviewerd) swapped PID=1618
68244 KB (flameshot) swapped PID=84209
763136 KB (plugin_host) swapped PID=1881345
1412480 KB (java) swapped PID=43402
3864548 KB (sublime_text) swapped PID=1881327
9999999999 Overall swap used: 2064 KB 
```

# java - Documentum 5.3 连接

> ID：479961
> 
> 赞同：2
> 
> 时间：2009-01-26T14:32:09.190
> 
> 标签：java, documentum

我是 Documentum 的新手。我正在创建一个需要连接到 documentum 实例（5.3）的独立 Java 应用程序。我将如何连接到实例？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-26T16:47:21.587

您必须在客户端计算机上安装和配置[Documentum 基础类](http://www.emc.com/products/detail/software/api.htm)（Documentum API），将 dfc.jar 复制到类路径中的任何位置，最后阅读大量文档 :-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T18:37:38.900

首先，您的 dmcl.ini 文件必须包含以下几行

```
[DOCBROKER_PRIMARY]
host=<host address or ip of docbroker for your docbase>
port=<port # usually 1489> 
```

那么下面的代码应该适合你

```
 String docbaseName = "docbase";
        String userName = "user";
        String password = "pass";
        IDfClientX clientx = new DfClientX();
        IDfClient client = clientx.getLocalClient();

        IDfSessionManager sMgr = client.newSessionManager();
        IDfLoginInfo loginInfoObj = clientx.getLoginInfo();
        loginInfoObj.setUser(userName);
        loginInfoObj.setPassword(password);
        loginInfoObj.setDomain(null);
        sMgr.setIdentity(docbaseName, loginInfoObj);
        IDfSession session = null;
        try
        {
            session = sMgr.getSession(docbaseName);
            // do stuff here
        }
        finally
        {
            if(session != null)
            {
                sMgr.release(session);
            }
        } 
```

# php - 从 mysql 转换为 mysqli - 输出变量

> ID：479962
> 
> 赞同：0
> 
> 时间：2009-01-26T14:33:36.160
> 
> 标签：php, mysql, mysqli

我一直在 PHP 中使用 mysql api，现在正在转换为 mysqli 以提高安全性。我看到的示例语法使用 printf，我想知道这是否有必要。目前我使用回声，像这样：

```
echo "<h1>".$row['ARTICLE_NAME']."</h1>
<div id='leftlayer' class='leftlayer'>
<p><strong>Username: </strong>".$row['USERNAME']."
<p><strong>Article Number: </strong>".$row['ARTICLE_NO']."
<p><strong>Subtitle: </strong>".$row['SUBTITLE']."
<p><strong>Auction Start: </strong>".$row['ACCESSSTARTS']." 
</div>"; 
```

由于使用 mysqli 您必须将变量绑定到结果，所以我这样做了：

```
$getRecords->bind_result($ARTICLE_NO, $ARTICLE_NAME, $SUBTITLE$, $CURRENT_BID, $START_PRICE, $BID_COUNT, $QUANT_TOTAL, $QUANT_SOLD, $ACCESSSTARTS, $ACCESSENDS, $ACCESSORIGIN_END, $USERNAME, $BEST_BIDDER_ID, $FINISHED$, $WATCH$$, $BUYITNOW_PRICE, $PIC_URL, $PRIVATE_AUCTION, $AUCTION_TYPE, $ACCESSINSERT_DATE, $ACCESSUPDATE_DATE, $CAT_DESC$, $CAT_PATH, $ARTICLE_DESC, $COUNTRYCODE, $LOCATION$, $CONDITIONS, $REVISED$, $PAYPAL_ACCEPT, $PRE_TERMINATED, $SHIPPING_TO, $FEE_INSERTION, $FEE_FINAL$, $FEE_LISTING, $PIC_XXL$, $PIC_DIASHOW, $PIC_COUNT, $ITEM_SITE_ID); 
```

并且想知道我是否可以简单地将我对 $row 的引用替换为绑定变量，例如：

```
 <p><strong>Username: </strong>".$USERNAME." 
```

这种方法是否存在任何安全问题，或者是否可以

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T21:57:49.073

我同意 mysqli - 至少在原则上 - 比 mysql 包更好，因为您可以绑定参数，这既更安全，也更适合查询执行。话虽如此，我发现 mysqli 至少有两个严重的问题：

*   [错误 46808](http://bugs.php.net/bug.php?id=46808)是一个严重的问题，已以不同方式报告了**至少三年**，但仍未修复。如果你想使用 LONGTEXT 列，你可能会遇到问题；和
*   有时我只是在mysqli失败的地方遇到奇怪的错误（关于“金丝雀形式”或类似错误的毫无意义的消息）。正是在这一点上（结合（1）），我才不得不放弃mysqli。

PDO 可能是更好的选择。我？我刚回到mysql。只要您小心转义字符串等，就很难与简单性争论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T15:03:57.503

当您从数据库中获取数据时，我不确定绑定是否会使您的应用程序更安全，但是当您写入数据库时​​它会有所帮助，因为您不会有 SQL 注入的风险。

`htmlspecialchars()`无论您采用何种方法从数据库中读取数据，如果您不能完全确定数据是否完全干净，您仍然需要使用转义输出。绑定语句不会像您在对 Ionut 的评论中所建议的那样处理此问题 - 您必须以适用于输出位置的方式转义数据。PHP/MySQL 不知道您是否正在打印到 HTML 文档/shell 命令/json/等。没有一种神奇的转义方法可以使任何数据对任何输出介质都安全。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:44:10.337

在提供 XML/HTML 页面时，您应该转义输出。为此使用[htmlspecialchars](http://www.php.net/manual/en/function.htmlspecialchars.php)或[htmlentities](http://www.php.net/manual/en/function.htmlentities.php)。无论如何，无论数据源和用于获取该数据的 API 如何，您都应该转义输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T15:43:45.270

我知道某些 PHP 版本已经报告了一些缓冲区溢出漏洞。虽然不知道是哪个版本。因此，基于此，假设输入未正确过滤，使用**printf**可能不如使用**echo**安全。不过很大程度上取决于上下文。

# c# - 从字符串表示访问对象属性

> ID：479966
> 
> 赞同：2
> 
> 时间：2009-01-26T14:35:54.050
> 
> 标签：c#, generics, reflection, sorting

我有一个自定义对象（仅为便于理解的示例代码）...

```
public class MyClass
{
    private string name;
    private int increment;
    private Guid id;

    public string Name
    {
        get { return name; }
        set { name = value; }
    }

    public int Increment
    {
        get { return increment; }
        set { increment = value; }
    }

    public Guid Id
    {
        get { return id; }
        set { id = value; }
    }
} 
```

...以及此类的自定义集合...

```
public class MyClassCollection : Collection<MyClass>
{

} 
```

我正在寻找为集合编写一个排序例程，它将具有以下公共方法......

```
 public void Sort(params string[] sortProperties)
    {
        if (sortProperties == null)
        {
            throw new ArgumentNullException("sortProperties", "Parameter must not be null");
        }

        if ((sortProperties.Length > 0) && (Items.Count > 1))
        {
            foreach (string s in sortProperties)
            {
        // call private sort method
                Sort(s);
            }
        }
    } 
```

...并且私有 Sort 方法将采用属性名称的参数...

```
 private void Sort(string propertyName)
    {

    } 
```

我想要做的是能够将一组属性名称传递给方法......

```
 MyClassCollection current = new MyClassCollection();

        // setup a objects in the collection
        current = GetCollectionData();

        // sort by Name, then by Increment
        current.Sort("Name", "Increment"); 
```

使用传递给方法的属性名称，我希望能够检查它是否具有该名称的属性，如果有，则确定它是什么类型，然后运行一种类型。

我目前得到的临时解决方法是......

```
 private void Sort(string propertyName)
    {
        // convert to List
        List<MyClass> myCurrentClass = Items as List<MyClass>;

        // sort
        if (myCurrentClass != null)
        {
            switch (propertyName)
            {
                case "Name":
                    myCurrentClass.Sort(delegate(MyClass myClassOne, MyClass myClassTwo)
                                 {
                                     return
                                         Comparer<string>.Default.Compare(myClassOne.Name,
                                                                          myClassTwo.Name);
                                 }
                        );
                    break;

                case "Increment":
                    myCurrentClass.Sort(delegate(MyClass myClassOne, MyClass myClassTwo)
                                 {
                                     return
                                         Comparer<int>.Default.Compare(myClassOne.Increment,
                                                                       myClassTwo.Increment);
                                 });
                    break;
            }
        }
    } 
```

...但理想情况下，我想打开属性的基础类型（字符串、整数等）并使用不同数量的委托调用来进行排序。我环顾四周，但我没有找到任何指向正确方向的东西。我看过反思，但我看不到任何可以帮助我的东西。

这甚至可能吗？如果是这样，怎么办？！

干杯!

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T14:41:42.167

反思将是要走的路——看看`Type.GetProperty(string name)`。之后创建正确的比较器可能会很棘手 - 您可能想要编写一个通用方法，然后根据属性类型使用反射调用它。恐怕这一切都会变得很糟糕——但这绝对是可行的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-26T14:45:35.310

```
private void Sort( string propertyName )
{
   List<MyClass> myCurClass = ...

   myCurClass.Sort(delegate( MyClass left, MyClass right ){

      PropertyInfo lp = typeof(MyClass).GetProperty (propertyName);

      Comparer.Default.Compare (pi.GetValue(left), pi.GetValue(right));

   });
} 
```

我认为这应该让你开始。:)（未测试，也未编译，但您会明白的）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T08:36:53.213

在遇到这个问题一段时间并希望昨晚在回家的火车上之后，我决定尝试猛烈抨击答案。结合使用 Jon 的指针和 Frederik 对 PropertyInfo 类的使用，并保持切换底层对象类型的原始想法，这就是我想出的......

```
 private void Sort_version2(string propertyName)
    {
        // convert to list
        List<MyClass> myCurrentClass = Items as List<MyClass>;

        string typeOfProperty;
        PropertyInfo pi;

        // sort
        if ((myCurrentClass != null) && (MyClass.HasDetailAndExtract(propertyName, out typeOfProperty, out pi)))
        {
            switch(typeOfProperty)
            {
                case "System.String":
                    myCurrentClass.Sort(delegate(MyClass one, MyClass two)
                                            {
                                                return
                                                    Comparer<string>.Default.Compare(pi.GetValue(one, null).ToString(),
                                                                                     pi.GetValue(two, null).ToString());
                                            });
                    break;

                case "System.Int32":
                    myCurrentClass.Sort(delegate (MyClass one, MyClass two)
                                            {
                                                return
                                                    Comparer<int>.Default.Compare(
                                                        Convert.ToInt32(pi.GetValue(one, null)),
                                                        Convert.ToInt32(pi.GetValue(two, null)));
                                            });
                    break;
                default:
                    throw new NotImplementedException("Type of property not implemented yet");
            }
        }
    } 
```

我已经在[我的博客](http://westdiscgolf.blogspot.com/2009/01/accessing-object-properties-from-string.html)上记录了思考过程和更多细节，让我知道你的想法！

感谢 Jon 和 Frederik 的帮助 :-)

# web-services - 如何在 MSDN 中查找 ASMX Web 服务的文档？

> ID：479972
> 
> 赞同：-1
> 
> 时间：2009-01-26T14:36:31.083
> 
> 标签：web-services, asmx

在 MSDN 中查找老式 .asmx Web 服务的文档时使用什么术语？

我想添加身份验证（用户名/密码），以便每个 Web 方法在执行之前都经过身份验证。

由于一切都是WCF，我找不到任何东西呵呵。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:42:27.093

怎么样：

[http://quickstarts.asp.net/QuickStartv20/webservices/doc/SoapHeaders.aspx](http://quickstarts.asp.net/QuickStartv20/webservices/doc/SoapHeaders.aspx)

[http://msdn.microsoft.com/en-gb/library/system.web.services.aspx](http://msdn.microsoft.com/en-gb/library/system.web.services.aspx)

# c#-4.0 - 您如何看待托管合同工具库

> ID：479976
> 
> 赞同：1
> 
> 时间：2009-01-26T14:37:42.533
> 
> 标签：c#-4.0, design-by-contract, spec#

我最近看到了这个视频 [http://channel9.msdn.com/pdc2008/TL51/](http://channel9.msdn.com/pdc2008/TL51/)关于托管合同工具库，这看起来非常有趣。可悲的是，他们似乎不会将其包含在语言本身中，这会像 Spec# 中那样更优雅。事实上，在 C#4.0 中拥有这两个选项会很好，因为合同给业务代码增加了很多噪音。

这里有人用过它并有一些真实世界的反馈吗？您还可以将合同添加到类属性甚至变量吗？就像是

```
decimal Percentage (min 0, max 1)
string NotNullString (not null, regex("??")) 
```

也许会很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T15:15:25.693

我正在尝试，但我认为该库还太年轻，无法在大型项目中认真使用，至少在启用静态检查的情况下：编译非常慢，具体的警告不是很清楚阅读。

运行时检查可以毫无问题地使用，因为它们似乎是作为 Debug.Assert 实现的。至少你记录方法。

为了向属性添加契约，我会向 set 属性添加约束，但在这种特定情况下，我认为编写一个可以实际封装需求的类会更好，只允许构造好的对象。反正：

```
 private decimal _Percentage;
    decimal Percentage
    {
        get{ return _Percentage;}
        set
        {
            CodeContract.RequiresAlways(value <= 1);
            CodeContract.RequiresAlways(value >= 0);
            _Percentage = value;
        }
    } 
```

ps：在我看来，C# 的趋势是朝着动态类型方向发展，而不是走向严格和强类型的编码方法。我认为[DbC](http://en.wikipedia.org/wiki/Design_by_contract)更适合强类型，至少因为它允许您向类型和函数添加更多要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T18:20:59.767

合同库似乎很适合 Linq2Sql。在您的 sql 数据库中定义字段和约束，并且可以为您生成合同。这可能是对合同的一个很好的介绍。

# java - 从 Eclipse 中运行我们的客户端时出现问题

> ID：479977
> 
> 赞同：1
> 
> 时间：2009-01-26T14:38:01.737
> 
> 标签：java, eclipse, rmi

每当我们从 Eclipse 中运行 Java 客户端以使用 RMI 联系服务器应用程序时，我们都会收到异常：java.io.StreamCorruptedException: invalid type code: 01

这只发生在 Eclipse 中，没有其他地方（IntelliJ、命令行等）。

有谁知道发生了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T15:02:10.347

您之前似乎[遇到过这个问题；）](https://stackoverflow.com/questions/308430)并且[在 JBoss 中也可以看到](http://dev.eclipse.org/newslists/news.eclipse.platform.rcp/msg19181.html)。

它通常是一个：

*   类路径问题（您需要包含一些 j2ee 库）。
*   或者您的流被另一种方法使用。
*   或者[上下文类加载器没有在 eclipse 中正确设置](http://dev.eclipse.org/newslists/news.eclipse.birt/msg29321.html)：
    [下面的例子：](http://dev.eclipse.org/newslists/news.eclipse.birt/msg29330.html)

> 查看器`ClassLoader`运行时上下文中的 是`org.apache.catalina.loader.WebappClassLoader`.
> 
> 因此，如果我执行以下操作：

```
ClassLoader savedClassLoader = Thread.currentThread.getContextClassLoader();
if (savedClassLoader.getClass().getName().equalsIgnoreCase("org.apache.catalina.loader.WebappClassLoader")){
Thread.currentThread().setContextClassLoader(this.getClass().getClassLoader());
} 
```

> 然后将保存的加载程序设置回`IConnection.Close()`，它可以工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T14:44:38.743

会不会是服务器和客户端代码不兼容？你用什么 JVM 来编译每一个？

# .net - msbuild，定义条件编译符号

> ID：479979
> 
> 赞同：75
> 
> 时间：2009-01-26T14:38:49.583
> 
> 标签：.net, msbuild, compiler-options

我可能只是瞎了眼，但是有没有命令行可以在 MSBUILD 中指定条件编译符号？

我目前在我的 buildscript 中有这条线：

```
SET MSBUILD=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\MSBuild.exe
SET CONFIG=Debug
%MSBUILD% /p:Configuration=%CONFIG% /p:OutputPath=..\..\output source\MyProject\MyProject.csproj 
```

我想添加一个条件。在 Visual Studio 中，我可以进入项目属性 => 构建 => 条件编译符号，但我没有看到 msbuild 的选项？

如果您知道我是否可以完全覆盖 .csproj 文件中已指定的所有符号以确保只有来自我的 Buildscript 的条件进入，则奖励 Karma。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-01-26T15:40:39.300

你见过[这个](http://social.msdn.microsoft.com/Forums/en-US/tfsbuild/thread/95bf6b1d-9dae-48ba-b56d-08fa5ae26563/)吗？（大部分信息在倒数第二个帖子中）

```
/p:DefineConstants="MYSYMBOL1;MYSYMBOL2" 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-11-26T17:17:47.403

我不得不使用空格而不是分号，比如 Björn Lasar 的这篇文章：[http ://www.linqinpark.net/2009/01/13/MSBuildWithMultipleDefineConstants.aspx](http://www.linqinpark.net/2009/01/13/MSBuildWithMultipleDefineConstants.aspx)

**更新：博客消失了；** [通过 Internet 存档检索](https://web.archive.org/web/20100406211501/http://www.linqinpark.net/CategoryView,category,MSBuild.aspx)：

> 最近我不得不直接使用 MSBuild 来自动化一些构建。我还必须根据配置配置一些预处理器定义。这通常由这样的参数完成

```
"/p:DefineConstants=MY_PREPROC_FLAG" 
```

> 这里没什么特别的，因为网上有足够多的评论。今天我还需要一个 Flag，我使用的命令行语法类似于我在 IDE 中所知道的：

```
"/p:DefineConstants=MY_PREPROC_FLAG;YET_ANOTHER_FLAG" 
```

> 但是这个没有用。
> 
> 所以关键是，如果你想通过命令行支持对项目的多个定义，你必须用简单的空格分隔它们......

```
"/p:DefineConstants=MY_PREPROC_FLAG YET_ANOTHER_FLAG" 
```

> 它将被添加到 IDE 的（分号分隔的）定义中。很高兴知道我认为...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-11T11:15:29.083

`/p:DefineConstants`是全有或全无的交易。

如果你只想关闭跟踪符号，你不能这样做：`msbuild /p:DefineTrace=false`

你必须定义一些东西来覆盖所有已经定义的符号：`msbuild /p:DefineConstants="RANDOM-SYMBOL"`

感谢 Michael Stum 指出了这个隐藏的排除 [我还写了一篇关于它的博客 --- 死链接](http://www.tomatosoft.biz/blog/2011/11/11/msbuild-override-symbols-already-definded-in-csproj-file/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-17T12:02:27.833

答案中所说的对`C#`代码有效，也适用于 ASP.NET “代码隐藏” C# 代码。对于**ASP.NET Web 项目**，如果您也想在 ASPX 页面中进行条件编译，则在页面上有条件地呈现 HTML 的工作方式略有不同（请注意，我已经删除`MasterPageFile="..." AutoEventWireup="true" CodeBehind="..." Inherits="..."`了您通常在`<%@ ... %>`声明中拥有的内容）：

```
<%@ Page Title="MyPage" Language="C#" CompilerOptions="/d:DebugSym1;DebugSym2" %>

<% #if DebugSym1 %>         
    <h4>Section1</h4>
<% #else %>
    <h4>(Section 1 skipped)</h4>
<% #endif %>

<% #if DebugSym2 %>         
    <h4>Section2</h4>
<% #else %>
    <h4>(Section 2 skipped)</h4>
<% #endif %> 
```

如果从 中删除`DebugSym1`或，则呈现相关语句的部分。`DebugSym2``CompilerOptions``#else``#if`

I thought this was worth mentioning for completeness of this topic and can save you time. More you can find in this [article](http://haacked.com/archive/2007/09/16/conditional-compilation-constants-and-asp.net.aspx), if you're interested.

# .net - 是否可以在 .NET 中自定义 WindowsForms ColorDialog？

> ID：479986
> 
> 赞同：1
> 
> 时间：2009-01-26T14:40:37.533
> 
> 标签：.net, winforms

是否可以自定义或子类化`System.Windows.Forms.ColorDialog`以添加一些按钮？我知道它使用本机 Windows 颜色对话框，但有没有办法从 .NET 自定义它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T15:29:28.340

由于该类不是密封的，您可以扩展它并尝试修改它的行为，但对话框的底层显示是通过创建普通的 win32 对话框并连接到它的消息分发循环。因此，简单地尝试添加托管控件是行不通的。

有几个人已经实现了他们自己的完全托管的变体，您可能希望使用/更改您的需求。[这个例子](http://www.codeproject.com/KB/selection/dotnetcolorpicker.aspx)可能是最好的起点之一，因为它涵盖了几种不同的方法并包含源代码。

# vb.net - Com 对象异常

> ID：479990
> 
> 赞同：1
> 
> 时间：2009-01-26T14:41:27.750
> 
> 标签：vb.net, exception, exception-handling, comobject

我编写了一个应用程序，它遍历一组记录并打印两件事。

一个是来自 SSRS 的报告，它工作正常。

另一种是使用 COM 对象进行打印的绘图。COM 对象随机失败并导致程序退出。

当 COM 对象失败时，有没有办法阻止它杀死整个程序？我已经尝试在每个级别捕获每个异常，但它仍然不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T14:47:55.290

你有你正在调用的 COM 对象的代码吗？如果您有代码，请检查是否有任何退出命令失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T14:44:19.227

您是否正在使用来自多个线程的 COM 对象？您应该只使用消息泵从单个线程访问 COM 对象。以我的经验，这可能会导致无法通过 try-catch 捕获的奇怪不稳定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T14:46:19.753

听起来问题可能与 com 对象本身有关，而不是您的代码。如果是这种情况，那么如果 com 对象没有抛出错误，那么您将无法捕捉到错误。

亲切的问候

托尼·史密斯-布鲁斯特************~~**``