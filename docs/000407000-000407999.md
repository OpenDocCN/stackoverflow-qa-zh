# StackOverflow 问答 000407000-000407999

# wxwidgets - wxWidgets 中的通知？

> ID：407004
> 
> 赞同：3
> 
> 时间：2009-01-02T15:03:41.680
> 
> 标签：wxwidgets

我正在使用 C++/wxWidgets 开发一个小型应用程序，其中 GUI 的几个部分需要根据接收到的 UDP 数据报进行更新。更具体地说，辅助线程尝试在网络中保留可用“客户端”的列表（可能会出现和消失），例如，UI 中的相应组合框需要更新以反映更改。

文档提到对于这种事情 EVT_UPDATE_UI 将是一个不错的选择。据我从稀疏文档中了解到，这个事件是由系统自动发送的，并为辅助 UI 更改提供了一些支持。

但是，使用更直接的方法我会感觉更舒服，例如，窗口对象可以注册/订阅以接收特定事件的通知（事件或回调），并且代码的另一部分在需要时发送这些通知。我可以使用我自己的代码在 C++ 中做到这一点，但是我想如果 wxWidgets 已经支持类似的东西，我应该使用它。但是，我在这方面还没有发现任何东西。

所以，问题是：wxWidgets 是否支持这种通知系统（或类似的替代方案），或者我最好自己编写代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T15:20:20.320

AFAIK 在 wxWidgets 中没有任何东西可以直接使用，但是你自己做这件事似乎很容易。

我会做什么：

*   创建一个 wxEvtHandler-descendent 类来保存网络中可用“客户端”的列表。让这个类有一个 wxCriticalSection，并在所有添加或删除“客户端”的方法中使用 wxCriticalSectionLocker。

*   通过继承 wxThread 创建一个工作线程类来处理您的 UDP 数据报，使用阻塞调用。每当必须添加或删除客户端时，线程应直接调用客户端列表对象的方法。在这些方法中更新客户端列表，并且 ::wxPostEvent() 向自身发送一个事件（这将在主 GUI 线程中执行整个通知调用）。

*   处理客户端列表类中的事件，并通知所有侦听器客户端列表已更改。在我看来，观察者模式很合适。您可以直接调用所有已注册侦听器的方法，也可以向它们发送 wxCommandEvent。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T23:18:40.653

您是否尝试过在发生变化的小部件上调用 Update()？更新组合框的内容后，调用 Update()，内容应该会更新。

# performance - 需要将整个 postgreSQL 数据库加载到 RAM 中

> ID：407006
> 
> 赞同：23
> 
> 时间：2009-01-02T15:04:38.370
> 
> 标签：performance, postgresql, ram

如何将整个 PostgreSql 数据库放入 RAM 以便更快地访问？我有 8GB 内存，我想为数据库专用 2GB。我已经阅读了有关共享缓冲区设置的信息，但它只是缓存了数据库中访问次数最多的片段。我需要一个解决方案，将整个数据库放入 RAM 并且从 RAM DB 进行任何读取，并且任何写入操作都将首先写入 RAM DB，然后写入硬盘驱动器上的 DB。（类似于默认 fsync =在 postgresql 配置设置中使用共享缓冲区）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-04T06:29:24.353

我曾经问过自己同样的问题有一段时间了。PostgreSQL 的缺点之一是它似乎不像 MySQL 那样支持 IN MEMORY 存储引擎......

无论如何，几周前我遇到了[一篇描述如何做到这一点的文章；](http://www.redhatmagazine.com/2007/12/12/tip-from-an-rhce-memory-storage-on-postgresql/)虽然它似乎只适用于 Linux。我真的不能保证它，因为我自己没有尝试过，但它似乎是有道理的，因为 PostgreSQL 表空间确实分配了一个挂载的存储库。

但是，即使使用这种方法，我也不确定您是否也可以将索引放入 RAM；我不认为 MySQL 强制 HASH 索引与它的 IN MEMORY 表一起使用......

我也想做类似的事情来提高性能，因为我也在处理大量数据集。我正在使用python；他们有字典数据类型，基本上是 {key: value} 对形式的哈希表。使用这些是非常有效和有效的。基本上，为了将我的 PostgreSQL 表放入 RAM，我将其加载到这样的 python 字典中，使用它，并偶尔将其持久化到 db 中；如果使用得好，它是值得的。

如果您不使用 python，我很确定它们是您的语言中类似的字典映射数据结构。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T15:07:58.240

如果您按 id 提取数据，请使用 memcached - [http://www.danga.com/memcached/](http://www.danga.com/memcached/) + postgresql。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T22:33:04.067

设置一个老式的 RAMdisk 并告诉 pg 将其数据存储在那里。

确保你备份它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T15:09:19.437

如果您使用的是 Java，也许类似于[Tangosol Coherence 缓存。](http://wiki.java.net/bin/view/Javapedia/Tangosol)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-04T06:59:32.577

只有 8GB 的​​数据库，如果你已经优化了所有的 SQL 活动，并且准备好用硬件解决查询问题，我建议你有麻烦了。从长远来看，这不是一个可扩展的解决方案。您确定您无法在软件和数据库设计方面做出重大改变吗？

# java - 如何将现有 Java 应用程序转换为 SYS V 服务（守护程序）

> ID：407016
> 
> 赞同：8
> 
> 时间：2009-01-02T15:08:55.770
> 
> 标签：java, service, daemon, sysv

我有一个 Java 应用程序，要启动它我使用

> java -jar myapp.jar

为了阻止它，我使用 CTRL+C。

现在我需要将该应用程序转换为我可以开始使用的东西：

> /etc/init.d/myapp 启动

我可以停止：

> /etc/init.d/myapp 停止

问题全在于保存进程的PID，我想我在某个地方看到了这样做的秘诀，我不记得在哪里，我也找不到它。

我看到有一个名为[Java Server Wrapper](http://wrapper.tanukisoftware.org/doc/english/download.jsp)的项目，但我正在寻找不限制内存使用的免费项目。而且我认为这项工作可以在单个 bash 脚本中完成。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-02T15:18:22.443

看看[Apache Commons Daemon](http://commons.apache.org/daemon/)。

它有 'jsvc' 启动器，支持启动和停止基于 java 的守护进程（服务）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-05T02:56:12.877

首先，在 *nix 上保存 PID：

```
$ ./yourprogram &
$ echo $! > /var/run/yourpid 
```

yourpid 现在将包含 yourpgram 的 PID，而 /var/run 是放置它的合适位置。

以上可以放在你的“开始”脚本中。“停止”脚本可以查看您的pid 以知道要杀死什么。

如果您想更优雅并正确停止您的应用程序，您可以查看 Tomcat 的 org.apache.catalina.startup.Catalina.java 的源代码，了解如何实现正确的关闭挂钩。

其次，可以将上面的“停止”和“启动”脚本放在 /etc/init.d/mystopstartscript 中：

```
#!/bin/bash
# processname: yourprogram
# pidfile: /var/run/yourpid

case $1 in
start)
        sh /some/where/start.sh
        ;;
stop)  
        sh /some/where/stop.sh
        ;;
restart)
        sh /some/where/stop.sh
        sh /some/where/start.sh
        ;;
esac   
exit 0 
```

这是一个相当本土的解决方案，其想法主要来自优秀的 'ol Tomcat，但我希望它有所帮助:)

# c# - 将键盘宏命令发送到游戏窗口

> ID：407020
> 
> 赞同：2
> 
> 时间：2009-01-02T15:09:44.413
> 
> 标签：c#, api, keyboard, sendkeys

我想做一个游戏的宏程序。但是仅将密钥发送到游戏应用程序（游戏窗口）存在问题。我正在使用`keybd_event`API 将密钥发送到游戏窗口。但是我只想在宏程序运行时将密钥发送到游戏窗口，而不是资源管理器或任何打开的窗口。当我更改 Windows 时，它仍在发送密钥。我尝试参考`Interaction.App`使用`Visual Basic.dll`。但`Interaction.App`只关注游戏窗口。

我找不到任何关于我的问题的信息。谁能帮我？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-05T06:44:28.190

我解决了我的问题。在这个领域里 ;

PostMessage(hWnd, WM_KEYDOWN, key, **{必须给出密钥的 lParam}** );

否则它不起作用。我们可以使用微软的 Spy++ 工具来控制 ChildWindow 类。

感谢大家的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T16:06:17.933

```
class SendKeySample
{
    private static Int32 WM_KEYDOWN = 0x100;
    private static Int32 WM_KEYUP = 0x101;

    [return: MarshalAs(UnmanagedType.Bool)]
    [DllImport("user32.dll", SetLastError = true)]
    static extern bool PostMessage(IntPtr hWnd, int Msg, System.Windows.Forms.Keys wParam, int lParam);

    [DllImport("user32.dll", SetLastError = true)]
    private static extern IntPtr FindWindowEx(IntPtr hwndParent, IntPtr hwndChildAfter, string lpszClass, string lpszWindow);

    public static IntPtr FindWindow(string windowName)
    {
        foreach (System.Diagnostics.Process p in System.Diagnostics.Process.GetProcesses())
        {
            if (p.MainWindowHandle != IntPtr.Zero && p.MainWindowTitle.ToLower() == windowName.ToLower())
                return p.MainWindowHandle;
        }

        return IntPtr.Zero;
    }

    public static IntPtr FindWindow(IntPtr parent, string childClassName)
    {
        return FindWindowEx(parent, IntPtr.Zero, childClassName, string.Empty);
    }

    public static void SendKey(IntPtr hWnd, System.Windows.Forms.Keys key)
    {
        PostMessage(hWnd, WM_KEYDOWN, key, 0);

    }
} 
```

调用代码

```
 var hWnd = SendKeySample.FindWindow("Untitled - Notepad");
        var editBox = SendKeySample.FindWindow(hWnd, "edit");

        SendKeySample.SendKey(editBox, Keys.A); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T15:31:10.983

FindWindow API：
[http ://www.pinvoke.net/default.aspx/user32.FindWindowEx](http://www.pinvoke.net/default.aspx/user32.FindWindowEx)

SendMessage API：
[http ://www.pinvoke.net/default.aspx/user32/SendMessage.html](http://www.pinvoke.net/default.aspx/user32/SendMessage.html)

VB

```
Private Const WM_KEYDOWN As Integer = &H100
Private Const WM_KEYUP As Integer = &H101 
```

C＃

```
private static int WM_KEYDOWN = 0x100
private static int WM_KEYUP = 0x101 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T15:14:16.120

您是一直在检索窗口的句柄，还是在记住它？

如果您使用 FindWindow() API，您可以简单地存储句柄并使用 SendMessage API 手动发送键/鼠标事件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T15:26:28.013

如果您想与游戏通信，通常必须处理 DirectInput，而不是普通的键盘 API。

# java - Java 中的 printf() 功能与 CharBuffer 或类似的东西相结合

> ID：407026
> 
> 赞同：0
> 
> 时间：2009-01-02T15:11:24.813
> 
> 标签：java, stream, printf

我在这里有点困惑。

我想做这样的事情：

1.  创建某种我可以写入的缓冲区
2.  清除缓冲区
3.  根据一些我只想做一次的复杂计算，多次使用类似 printf() 的函数将一堆东西附加到缓冲区中
4.  使用缓冲区的内容并将其打印到多个`PrintStream`对象
5.  根据需要重复步骤 2-4

例如：

```
SuperBuffer sb = new SuperBuffer();
  /* SuperBuffer is not a real class, so I don't know what to use here */
PrintStream[] streams = new PrintStream[N];
/* ... initialize this array to several streams ... */

while (!done)
{
    sb.clear();
    sb.printf("something %d something %d something %d", 
        value1, value2, value3);
    if (some_complicated_condition())
        sb.printf("something else %d something else %d", value4, value5);
    /* ... more printfs to sb ... */
    for (PrintStream ps : streams)
        ps.println(sb.getBuffer());
} 
```

看起来像在[StringWriter](http://java.sun.com/j2se/1.5.0/docs/api/java/io/StringWriter.html)周围包装[PrintWriter](http://java.sun.com/j2se/1.5.0/docs/api/java/io/PrintWriter.html)会为上面的对象做我想要的，除了没有方法。我想我可以每次通过循环创建一个新的 PrintWriter 和 StringWriter 对象，但这似乎很痛苦。（在我的真实代码中，我在多个地方执行此操作，而不仅仅是一次循环......）`sb``clear()`

我也经常使用`java.nio.CharBuffer`其他 NIO 缓冲区，这似乎是一种很有前途的方法，但我不确定如何将它们包装成一个可以为我提供`printf()`功能的对象。

有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T15:23:39.470

啊：我想我明白了。该类[`Formatter`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Formatter.html)有一个类似于 的`format()`方法`printf()`，并且可以构造它以包装任何类型的实现`Appendable`. [`CharBuffer`](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/CharBuffer.html)implements `Appendable`，我可以根据需要`clear()`读出或读出其中的内容`CharBuffer`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T15:23:40.420

为什么在循环中创建新缓冲区很痛苦？这就是垃圾收集器的用途。无论如何，都需要在 clear() 中进行新的分配。

如果你真的想实现你的 SuperBuffer，那一点也不难。只需使用 clear() 函数创建 OutputStream 的子类，然后将 PrintStream 包装在其周围。如果需要，您可以在超级缓冲区中使用 CharBuffer。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T01:46:13.520

考虑创建一个 OutputStream（或 Writer）的子类 TeeOutputStream，它保存您的流数组并委托给它们。然后用 PrintStream（或 PrintWriter）包装您的流，然后在其上调用 printf()。不需要临时缓冲区或任何东西：

```
PrintStream[] streams = new PrintStream[N]; // any output streams really
PrintStream ps = new PrintStream(new TeeOutputStream(streams));

while (!done)
{
    ps.printf("something %d something %d something %d",
              value1, value2, value3);    
    if (some_complicated_condition())
        ps.printf("something else %d something else %d", value4, value5);
    ps.println();
} 
```

# sql - Oracle REPLACE() 函数不处理回车和换行

> ID：407027
> 
> 赞同：27
> 
> 时间：2009-01-02T15:11:36.017
> 
> 标签：sql, oracle

我们有一个带有一`varchar2(100)`列的表格，其中偶尔包含回车和换行。我们想删除 SQL 查询中的那些字符。我们正在使用：

```
REPLACE( col_name, CHR(10) ) 
```

这**没有效果**，但是将 'CHR(10)' 替换为更传统的 'letter' 字符证明 REPLACE 函数可以正常工作。我们还发现

```
REPLACE( col_name, CHR(10), '_' ) 
```

找到换行符的*位置*，但在它之后*插入*下划线，而不是替换它。

在 Oracle8i 上运行。升级不是一种选择。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-01-02T15:47:02.387

另一种方法是使用[TRANSLATE](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/functions196.htm#i1501659)：

```
TRANSLATE (col_name, 'x'||CHR(10)||CHR(13), 'x') 
```

'x' 是您不希望转换为 null 的任何字符，因为如果第三个参数为 null，则 TRANSLATE 无法正常工作。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-01-02T15:31:57.520

啊啊！凯德有钱。

TOAD 中的工件打印`\r\n`为两个占位符“blob”字符，但也将单个字符打印`\r`为两个占位符。解决方案的第一步是使用 ..

```
REPLACE( col_name, CHR(13) || CHR(10) ) 
```

..但我选择了稍微更健壮的..

```
REPLACE(REPLACE( col_name, CHR(10) ), CHR(13) ) 
```

..它以任何顺序捕获违规字符。我非常感谢凯德。

M。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-02T15:17:29.450

您确定您的换行符不是`CHR(13) + CHR(10)`，在这种情况下，您最终会得到`CHR(13) + '_'`，它可能看起来仍然像换行符吗？

尝试`REPLACE(col_name, CHR(13) + CHR(10), '')`

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-02T15:30:38.113

如果数据库中的数据是从 HTML 表单 TextArea 控件发布的，则不同的浏览器使用不同的换行符：

Firefox 仅使用 CHR(10) 分隔行

Internet Explorer 使用 CHR(13) + CHR(10) 分隔行

Apple (pre-OSX) 仅使用 CHR(13) 分隔行

所以你可能需要类似的东西：

```
set col_name = replace(replace(col_name, CHR(13), ''), CHR(10), '') 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-06-24T19:16:18.800

只是想留个便条。我在格式化一个有自己想法的文本 4000 字段时遇到了问题，并且文本似乎在报告中随机换行（或不换行）。当我使用上面提到的替换 chr(10) 更新列时。我的报告最终按照我想要的格式进行了格式化。非常感谢！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-08T13:33:00.917

如果您的换行符是`CRLF`，则表示它是 a`CHR(13)`后跟`CHR(10)`. 如果你`REPLACE(input, CHR(10), '_')`，那变成`CHR(13)`后跟一个下划线。因为`CR`它本身可以像换行符一样被渲染，所以它*看起来*好像在换行符之后插入了一个下划线，但*实际上*只有一半的换行符被替换了。

用于`REPLACE(REPLACE(input, CHR(13)), CHR(10))`替换所有`CR`'s 和`LF`'s。

# php - 本地主机上的 Zend_Rest_Client 无法连接错误

> ID：407030
> 
> 赞同：1
> 
> 时间：2009-01-02T15:12:02.147
> 
> 标签：php, zend-framework, localhost, zend-rest

我正在使用`Zend_Rest_Client`连接`Zend_Rest_Server`，一切似乎都很好，但是当我尝试`get()`从服务器连接时，我收到此错误：

> Zend_Http_Client_Adapter_Exception：无法连接到 tcp://localhost:80。错误#10060：连接尝试失败，因为连接方在一段时间后没有正确响应，或者连接失败，因为连接的主机没有响应。在第 148 行 C:\www\zf_1_72\library\Zend\Http\Client\Adapter\Socket.php

这是我使用的代码

```
$client = new Zend_Rest_Client('http://localhost/my_application/api/index/');       
$client->auth($key);
$result = $client->get(); 
```

谢谢你的建议

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-04T12:40:28.127

[该线程](http://www.zfforums.com/zend-framework-components-13/web-web-services-22/http_client-raising-error-10060-a-1302.html)建议问题可能与“本地主机”名称有关 - 尝试`127.0.0.1`改用。

# roles - 什么时候有人从其他角色回到开发角色太长了？

> ID：407046
> 
> 赞同：0
> 
> 时间：2009-01-02T15:16:23.557
> 
> 标签：roles

将人们从其他角色（例如销售、管理、支持、测试等）带回“他们的初恋”（即编程）的最佳方式是什么？

鉴于当前的经济状况，这可能会成为一个问题。

我不是在谈论上一次使用穿孔卡对 ALGOL 进行编程的 CEO，而是最近从编程转向他们意识到不适合他们的角色的人。

什么时候“远离编程”太长了，以至于有人无法切换回来并做出有用的贡献？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T15:22:11.080

我认为不应该用离开的时间来定义一个人是否准备好回来。我做了很长一段时间的开发人员，进入管理，然后进入执行管理，最后决定我必须回到开发。我能够做到这一点的关键是，当我“离开”时，我仍然密切关注这个行业，我仍然做一些小项目来保持我的技能（和我对发展的渴望）敏锐。

所以，我离开了将近十年，我又回来了，玩得很开心。

高温下，

科尔比非洲

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T15:58:54.843

你总是可以回来的。

这更像是一个问题；需要多长时间才能恢复？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-02T15:19:09.243

恐怕无益的答案是这完全取决于人。

就像我永远不会根据他们在行业中的时间来判断某人一样，我也不会根据他们离开行业的时间来判断他们 - 如果他们可以成为团队中有用的成员并做出贡献，那就是一切都很重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T15:38:50.703

如果这个人意识到他在新的非编程职位上错了，那么“回来”可能会在相当长的一段时间后起作用。他甚至可能是比以前更好的开发人员，因为他在其他地方有一些有用的见解，可能是针对“底线”。

如果不是，如果他被降级为开发猴子，那么可能一分钟就是工具。

总而言之，这是一个动态的过程。我看到人们在过去 2 年的时间里改变了角色，一开始他们似乎坚持编程并且在做“管理的事情”时感觉不好，后来他们无法再正常发展，喜欢他们现在正在做的工作，并说他们永远不会回来。

当然，这是一个个性问题：个人的个性，以及周围环境的个性：如果团队中的某个人成为他们的领导者，那么重新回到队伍中可能会更加困难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T15:48:55.923

我希望我们能从 Y2K 时代吸取教训，当时许多文科领域的人被引入 IT 领域，试图解决 IT 人员短缺的问题。我并不是说其他​​领域的人不能成为伟大的程序员，但我认为他们至少必须具备逻辑/问题解决能力和一些培训。

# javascript - 从其他函数访问变量而不使用全局变量

> ID：407048
> 
> 赞同：77
> 
> 时间：2009-01-02T15:16:50.107
> 
> 标签：javascript, global-variables

我从很多地方听说全局变量本质上是讨厌和邪恶的，但是在做一些非面向对象的 Javascript 时，我看不出如何避免它们。假设我有一个函数，它使用复杂算法使用随机数和其他东西生成一个数字，但我需要在其他函数中继续使用该特定数字，该函数是回调或其他东西，因此不能成为同一函数的一部分。

如果最初生成的数字是局部变量，则无法从那里访问它。如果函数是对象方法，我可以将数字设为属性，但它们不是，并且更改整个程序结构来执行此操作似乎有些过于复杂。全局变量真的那么糟糕吗？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-01-02T15:24:13.383

我认为你最好的选择可能是定义一个*全局*范围的变量，然后在那里转储你的变量：

```
var MyApp = {}; // Globally scoped object

function foo(){
    MyApp.color = 'green';
}

function bar(){
    alert(MyApp.color); // Alerts 'green'
} 
```

没有人应该因为你做了上述那样的事情而对你大喊大叫。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-01-02T15:22:21.237

要使函数 A 中计算的变量在函数 B 中可见，您有三个选择：

*   使其成为全球性的，
*   使其成为对象属性，或
*   从 A 调用 B 时将其作为参数传递。

如果您的程序相当小，那么全局变量还不错。否则我会考虑使用第三种方法：

```
function A()
{
    var rand_num = calculate_random_number();
    B(rand_num);
}

function B(r)
{
    use_rand_num(r);
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-02T15:33:51.260

考虑使用命名空间：

```
(function() {
    var local_var = 'foo';
    global_var = 'bar'; // this.global_var and window.global_var also work

    function local_function() {}
    global_function = function() {};
})(); 
```

两者`local_function`都`global_function`可以访问所有局部和全局变量。

**编辑**：另一种常见模式：

```
var ns = (function() {
    // local stuff
    function foo() {}
    function bar() {}
    function baz() {} // this one stays invisible

    // stuff visible in namespace object
    return {
        foo : foo,
        bar : bar
    };
})(); 
```

现在`return`可以通过命名空间对象访问 ed 属性，例如`ns.foo`，同时仍保留对本地定义的访问。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-02T15:23:05.010

您要查找的内容在技术上称为柯里化。

```
function getMyCallback(randomValue)
{
    return function(otherParam)
    {
        return randomValue * otherParam //or whatever it is you are doing.
    }

}

var myCallback = getMyCallBack(getRand())

alert(myCallBack(1));
alert(myCallBack(2)); 
```

以上并不完全是一个柯里化函数，但它实现了维护现有值的结果，而无需向全局命名空间添加变量或需要其他一些对象存储库。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-06-12T08:04:18.770

我发现这对于原始问题非常有帮助：

返回您希望在 functionOne 中使用的值，然后在 functionTwo 中调用 functionOne，然后将结果放入一个新的 var 并在 functionTwo 中引用这个新的 var。这应该使您能够在 functionTwo 中使用 functionOne 中声明的 var。

```
function functionOne() {
  var variableThree = 3;
  return variableThree;
}

function functionTwo() {
  var variableOne = 1;
  var var3 = functionOne();

  var result = var3 - variableOne;

  console.log(variableOne);
  console.log(var3);
  console.log('functional result: ' + result);
}

functionTwo(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-02T15:21:27.383

如果另一个函数需要使用变量，则将其作为参数传递给函数。

全局变量也不是天生讨厌和邪恶的。只要使用得当，它们就没有问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-02T15:22:24.993

如果您有机会重用此代码，那么我可能会努力采用面向对象的视角。使用全局命名空间可能很危险——由于变量名会被重用，您会冒着难以发现错误的风险。通常，我首先使用面向对象的方法，而不是简单的回调，这样我就不必重新编写。每当您在 javascript 中拥有一组相关函数时，我认为它都是面向对象方法的候选者。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-02-23T15:48:50.877

另一种方法是我从 Douglas Crockford 论坛帖子 ( [http://bytes.com/topic/javascript/answers/512361-array-objects](http://bytes.com/topic/javascript/answers/512361-array-objects) ) 中选择的。这里是...

道格拉斯·克罗克福德写道：

2006 年 7 月 15 日

“如果你想通过 id 检索对象，那么你应该使用一个对象，而不是一个数组。由于函数也是对象，你可以将成员存储在函数本身中。”

```
function objFacility(id, name, adr, city, state, zip) {

    return objFacility[id] = {

        id: id,
        name: name,
        adr: adr,
        city: city,
        state: state,
        zip: zip

    }
}

objFacility('wlevine', 'Levine', '23 Skid Row', 'Springfield', 'Il', 10010); 
```

“该对象可以通过”获得

```
objFacility.wlevine 
```

现在可以从任何其他函数中访问对象属性。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-02T15:23:26.570

我不知道您的问题的具体情况，但如果函数需要该值，那么它可以是通过调用传递的参数。

全局变量被认为是不好的，因为全局变量状态和多个修饰符会产生难以遵循的代码和奇怪的错误。对许多演员来说，摆弄某些东西会造成混乱。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-08-22T07:54:29.377

您可以使用自定义 jQuery 事件完全控制 javascript 函数的执行（并在它们之间传递变量）....有人告诉我，这在这些论坛中是不可能的，但我得到了一些可以做到这一点的东西（即使使用一个ajax调用）。

这是答案（重要提示：这不是经过检查的答案，而是我“Emile”的答案）：

[如何获取跨多个函数返回的变量 - Javascript/jQuery](https://stackoverflow.com/questions/3531080/how-to-get-a-variable-returned-across-multiple-functions-javascript-jquery)

# community-server - 社区服务器中使用的 cs_PostViews 表是什么

> ID：407063
> 
> 赞同：1
> 
> 时间：2009-01-02T15:19:59.837
> 
> 标签：community-server

我目前正在运行 Community Server 2.1。我的 cs_PostViews 表为 200MB。这个表的具体用途是什么。截断是否安全？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-10T23:11:08.580

自己发现了。

此表包含请求和提供的每个唯一 URL 的列表。即没有 404 类型的 URL 和它被请求的次数。

我最终截断了这张表，到目前为止没有任何不良影响。

# windows - 在 Windows XP 上：如何创建一个只能读取某个目录的用户？

> ID：407069
> 
> 赞同：1
> 
> 时间：2009-01-02T15:20:42.783
> 
> 标签：windows, windows-xp, privileges

首先让我声明：我知道任何想要运行程序（甚至登录）的用户都必须有权访问（可能至少）Windows系统目录和共享库`%ProgramFiles%`，但我想成为能够访问 Skype，例如，通过使用非特权用户运行它并确保它不能访问*任何*不必要的文件。

我担心这样做的唯一方法是识别我存储不希望该用户访问的文件的所有大量目录，然后创建一个可以访问这些目录的新用户组，或者运行 Skype 和 Azureus在虚拟机中。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T16:08:31.220

通常，帐户至少是用户组的成员，它确实可以访问许多东西。您可以使该帐户成为任何组的成员，或者是非常严格的来宾组。

真正的问题是程序的令牌（一个跟踪正在运行的进程具有哪些安全身份的内部安全对象）将包含每个人和经过身份验证的用户组，它们也具有对许多内容的读取权限。没有这些组就无法创建帐户。您可以删除每个人和经过身份验证的用户组对大多数所有内容的访问权限，但要跟踪所有这些内容将需要大量工作。

我想说为不受信任的程序创建标准用户或访客访问帐户就足够安全了。为了支持自我更新并将相关文件保存在同一位置，我建议您将这些程序直接安装在它们将运行的用户帐户的配置文件中，例如`C:\Documents and Settings\skype\Program Files\Skype`

如果您想获得真正的花哨，您可以使用受限令牌来使每个人、经过身份验证的用户等组仅拒绝（因此他们不能授予任何访问权限）或创建受限 SID 列表。这将很难实现，因为程序期望访问的全局对象是 Everyone 组可以访问的，这通常是一个安全的选择。

请参阅[CreateRestrictedToken 函数](http://msdn.microsoft.com/en-us/library/aa446583(VS.85).aspx)。

还有一个开源命令行程序，我为此创建了一个用于动态创建受限令牌和作业对象的程序：[UlimitNT](http://czwsoft.dyndns.org/ulimitnt.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T15:45:16.837

也许[sudown](http://sudown.sourceforge.net/)是一个解决方案。这是一种类似于 sudo（从 Linux 中得知）的方法，以非特权用户身份运行，但可以在需要时升级为管理帐户（使用密码）。

我想你可以锁定机器，这样用户就可以单独登录，甚至不能用他的权限启动 Skype，而是通过 sudown 的“运行方式”启动 Skype。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T15:24:12.730

除了使用虚拟机之外，您还可以考虑使用沙盒。以[Sandboxie](http://www.sandboxie.com/) fox 为例。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-03T14:32:59.073

只需使用 acl apis（msdn 中的示例）

# c++ - 自动构建 ID

> ID：407074
> 
> 赞同：6
> 
> 时间：2009-01-02T15:22:05.620
> 
> 标签：c++, visual-studio, svn, visual-c++

我们正在寻找一种在我们的构建中自动包含某种构建 ID 的方法。这需要是可移植的（Linux 和 Mac 上的 VC++、g++）和自动的。VC++ 是最重要的，因为在其他环境中我们使用自定义 Python 构建脚本，所以我可以做任何我想做的事情。

我们使用 SVN，因此我们正在研究使用 svnversion 的输出将修订写入标题并包含它。这有问题：如果我们把文件放在 SVN 中，它每次都会显示为已修改，但这将是一个多余的提交，并且在某种意义上会产生一个不断增加的修订的无限循环。如果我们不将文件放入 SVN 并仅将其创建为预构建步骤，则源将不完整，因为它们需要预构建步骤或 Makefile 来生成该文件。

我们也可以使用`__DATE__`，但我们不能保证`__DATE__`如果其他文件被修改，使用（即写入日志文件）的文件将被编译 - 除非我们“触摸”它，但我们会导致项目永远过时。我们可以将其作为预构建步骤进行处理，因此只有在项目的其余部分已过期时才会对其进行处理，因此不会导致虚假编译，但如果 VC++在预构建步骤*之前*计算依赖关系，这将'不起作用（文件`__DATE__`不会被编译）

有什么有趣的想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-02T15:30:02.360

我们正在使用 的输出`svnversion`，写入头文件并包含在内。我们从存储库中省略该文件，并在预构建步骤中创建它；这对我们来说效果很好。（我不确定您为什么反对使用预构建步骤？）

我们目前正在使用 Perl 脚本将`svnversion`' 的输出转换为头文件；后来我发现 TortoiseSVN 包含一个`subwcrev`命令（它也被移植到 Linux），它可以做很多相同的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T15:34:57.543

如果您不喜欢构建所需的包含文件不在源代码控制中的想法，请考虑以编程方式创建文件/包含并在构建过程中调用 svnversion 的批处理文件或其他构建步骤。

基本上生成文件，这样你就没有未版本化和必需的文件。

编辑 Josh 的 subwcrev 可能是最好的主意。

在实现之前，我编写了自己的 hacky 工具来做同样的事情 - 在模板文件中进行替换。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T15:36:12.813

它可能很简单：

```
% make -DBUILD_NUMBER=`svnlook youngest /path/to/repo` 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-02T19:04:39.523

我会看看[SvnRev](http://www.compuphase.com/svnrev.htm)。您可以将其用作 VS 中的自定义预构建步骤，或从 makefile 或您需要做的任何其他事情中调用它，它会生成一个头文件，您可以将其包含在其他文件中，这将为您提供所需的内容. 网站上有很好的文档。

[SubWCRev](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-subwcrev.html)是另一种选择，尽管 Linux 端口较新，而且我不知道是否存在 Mac 版本。它在适用于 .NET 的 Windows 上非常有用（我猜这对您来说不是问题，但我将其添加以供将来参考），因为它允许您创建可用于生成的模板文件，用于例如，.NET 程序集的属性文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T15:51:53.377

自动构建通常可以是完整的、干净的构建。在这种情况下，您从一个干净的目录开始，无论如何都不会有问题`__DATE__`。否则，请参阅 Paul Beckinham 的想法。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-02T15:32:40.527

为什么不将[GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)绑定到它，几乎每种语言都支持生成一个，或者如果您的语言没有，那么周围有很多算法。

（虽然，如果你确实使用颠覆，我个人更喜欢 Josh 的想法！）

# mysql - MySQL 数据库的最佳更新方法

> ID：407080
> 
> 赞同：0
> 
> 时间：2009-01-02T15:23:02.497
> 
> 标签：mysql, reporting, diff, version, compare

我已经阅读了类似问题的解决方案，但它们似乎都涉及脚本和额外的工具。我希望我的问题足够简单以避免这种情况。

所以用户上传下周数据的 csv。它被插入数据库，没问题。

但

一个小时后，他得到了每个人的反馈，并且必须做出相应的更新。他更新了 csv 并将其上传到数据库。

现在，我正在使用的系统检查该周的数据是否已经存在，如果存在，则从数据库中提取所有数据，脚本会找到差异并将它们发送出去，毕竟这样，旧数据的数据将被删除并用新数据替换。

显然，将其擦干净并重新输入数据要容易得多，但这不是最好的方法，尤其是在有大量更改或大量数据的情况下。但我必须知道为了发送警报做了哪些更改。但是我不想要事务日志，因为警报只需要发送一次，之后旧数据就没用了。

所以！

是否有一种聪明的方法可以将新数据与现有数据进行比较，仅获取已更改/删除/添加的行并进行这些更改？现在看来我可以进行更新，但是我不会就发生的变化得到任何回应...

谢谢！

快速编辑：

当前没有外键在使用。这很快就会改变，但不会有什么不同，因为外键只会指向数据影响的对象，因此不需要更改。就主键而言，这确实带来了一些困境：

有问题的数据是每个人的工作时间表。因此，每个班次都有一个密钥会很好（对于这个时间表的特定应用，而不是简单的输出）。但问题是，假设 user1 周一迟到了。迟到记录在一个单独的表中，并使用 shift 键与班次相关联。但是，如果在星期二需要对已经进行的一周进行一些更改，我担心要确保数据库中的所有条目已经发生（因此可能具有不应该发生的关联）将变得太困难被破坏）将在此过程中重新键入。不幸的是，它并不像只更新当前时间之后发生的所有事件那么简单，因为这会给上传的人增加工作量（从而使其不那么有市场）。基本上，他们在一个程序上制定时间表，将其导出为 CSV，然后将其上传到需要该数据的所有 Web 应用程序的网页上。因此，每次导出整个一周并上传它时，他们（并且对每个相关人员的压力都较小）执行相同的例程变得容易得多。

所以我最关心的是让上传脚本在两端尽可能智能。尝试查找更改不会变得臃肿，无论输入如何，它都可以找到更改，并且没有任何未更改的数据有被重新键入的风险。

这是一个相关的问题：

```
Suppose Joe User was schedule to wash dishes from 7:00 PM to 8:00 PM, but the new
data has him working 6:45 PM to 8:30 PM.  Has the shift been changed? Or has the old
one been deleted and a new one added? 
```

还有一个：

```
Say Jane was schedule to work 1:00 PM to 3:00 PM, but now everyone has a mandatory
staff meeting at 2:00 to 3:00\. Has she lost one shift and gained two? Or has one
shift changed and she gained one? 
```

我真的很想知道这种数据通常是如何处理/接近的，而不是上面的具体答案。

再次谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-02T15:30:33.030

如果您在其中一个字段上有唯一键，则可以使用：

```
LOAD DATA LOCAL INFILE '/path/to/data.csv' REPLACE INTO TABLE table_name 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T15:31:54.710

> 现在，我正在使用的系统检查该周的数据是否已经存在，如果存在，则从数据库中提取所有数据，脚本会找到差异并将它们发送出去，毕竟这样，旧数据的数据将被删除并用新数据替换。

所以你的脚本知道这些差异，对吧？除了脚本和 MySQL 之外，您不想使用一些额外的工具，对吗？

我非常相信 MySQL 本身不提供任何“差异”工具，所以你能做到的最好的事情就是制作新的 CSV 文件只用于更新。我的意思是 - 它应该只包含更改的行。更新会更快，并且所有更改的数据都将很容易获得。

# c++ - 从非常量对象调用 const 函数

> ID：407100
> 
> 赞同：23
> 
> 时间：2009-01-02T15:28:50.083
> 
> 标签：c++, function, constants

我需要从非常量对象调用 const 函数。查看示例

```
struct IProcess {
   virtual bool doSomeWork() const = 0L;
};
class Foo : public IProcess {    
  virtual bool doSomeWork() const {
    ...
  }
};

class Bar
{
public:
   const IProcess& getProcess() const {return ...;}
   IProcess& getProcess() {return ...;}

   void doOtherWork {
    getProcess().doSomeWork();        
  }
}; 
```

打电话

```
getProcess().doSomeWork(); 
```

总是会导致调用

```
IProcess& getProcess() 
```

有没有别的方法可以打电话

```
const IProcess& getProcess() const 
```

从非常量成员函数？到目前为止我用过

```
const_cast<const Bar*>(this)->getProcess().doSomeWork(); 
```

这可以解决问题，但似乎过于复杂。

* * *

编辑：我应该提到代码正在被重构，最终只剩下一个函数。

```
const IProcess& getProcess() const 
```

但是，目前存在副作用，有时 const 调用可能会返回 IProcess 的不同实例。

请继续话题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-04T15:31:11.577

`const_cast`是为了**摆脱**constness！

您正在从非常量转换为安全的 const，因此请使用`static_cast`：

```
 static_cast<const Bar*>(this)->getProcess().doSomeWork(); 
```

*我的意思是从技术上讲，您可以使用 constness 进行转换`const_cast`，但这不是对运算符的务实使用。新风格演员表（相对于旧的 c 风格演员表）的目的是传达演员表的意图。`const_cast`是一种代码味道，至少应该对其使用进行审查。`static_cast`另一方面是安全的。但这是 C++ 风格的问题。*

或者您可以创建一个新的（私有）const 方法，并从以下位置调用它`doOtherWork`：

```
 void doSomeWorkOnProcess() const { getProcess().doSomeWork(); } 
```

使用 const 临时也是一种选择（由“MSN”回答）：

```
 const Bar* _this = this;
   _this->getProcess().doSomeWork(); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-02T19:10:53.550

避免强制转换：将其分配给 a`const Bar *`或任何东西并使用它来调用`getProcess()`.

这样做有一些迂腐的理由，但它也让你在不强制编译器做一些可能不安全的事情的情况下更清楚你在做什么。当然，您可能永远不会遇到这些情况，但您不妨编写一些在这种情况下不使用强制转换的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-09T08:00:42.840

如果演员表对你来说太难看，你可以添加一个方法来`Bar`简单地返回一个 const 引用`*this`：

```
Bar const& as_const() const {
    return *this;    // Compiler adds "const" without needing static_cast<>
} 
```

然后，您可以通过预先添加来调用*任何* `const`方法，例如：`Bar``as_const().`

```
as_const().getProcess().doSomeWork(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T15:42:59.197

如果`getProcess()`并且`getProcess() const`没有返回对同一对象的引用（但限定不同），则表明`class Bar`. 重载`const`函数的本质并不是区分具有不同行为的函数的好方法。

如果它们返回对同一对象的引用，则：

```
const_cast<const Bar*>(this)->getProcess().doSomeWork(); 
```

和

```
getProcess().doSomeWork(); 
```

调用完全相同的`doSomeWork()`函数，因此无需使用`const_cast`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T15:31:38.970

如果函数没有重载，你不必做任何转换技巧。调用非常量对象的 const 方法很好。它从被禁止的 const 对象调用非常量方法。如果方法被 const 和非 const 函数覆盖，那么将对象转换为 const 就可以了：

```
const_cast<const IProcess&> (getProcess()).doSomeWork(); 
```

编辑：我没有阅读整个问题。是的，您需要对*this*指针进行 const_cast 或使*doOtherWork*函数 const 来调用*const IProcess& getProcess() const*。

关键仍然是您不需要 const 对象来调用*doSomeWork*。既然这是目标，你需要调用 const 方法吗？

另一种选择是重命名覆盖的函数。如果这两个函数实际上具有不同的行为/副作用，这将是一个非常好的主意。否则，函数调用的效果不会很明显。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-06T10:35:17.337

定义一个模板

```
template< class T >
const T & addConst ( T & t ) 
{
    return t;
} 
```

并打电话

```
addConst( getProcess() ).doSomeWork(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T15:32:49.857

好吧，你能声明

```
void doOtherWork const () 
```

?

这样就可以了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-02T15:41:31.103

我认为 const_cast 方法是你最好的选择。这只是 C++ 中 const 框架的一个限制。我认为您可以避免强制转换的唯一方法是定义一个无论如何都返回 const IProcess 实例的方法。例如。

```
const IProcess* getProcessConst() const { return ... }
...
getProcessConst().doSomeWork(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-02T15:45:59.377

我假设您希望 DoOtherWork 调用您的两个 getprocess 调用之一，具体取决于它是否是从 const 对象调用的。

我能建议的最好的是：

```
class Bar
{
public:
   const IProcess& getProcess() const {return ...;}
   IProcess& getProcess() {return ...;}

   void doOtherWork {            // should use getProcess()      
    getProcess().doSomeWork();        
  }
   void doOtherWork const {
    getProcess().doSomeWork();   // should use getProcess() const     
  }
}; 
```

即使这样可行，这对我来说似乎是一种难闻的气味。我会非常警惕根据对象的常量性而彻底改变的类行为。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-02T16:30:57.010

> 由 monjardin 发布
> *另一种选择是重命名被覆盖的函数。如果这两个函数实际上具有不同的行为/副作用，这将是一个非常好的主意。否则，函数调用的效果不会很明显。*

IProcess& 主要通过属性在其他代码中访问

```
__declspec(property(get=getProcess)) IProcess& Process; 
```

所以重命名不是一种选择。调用函数的大部分时间*常数*与 getProcess() 匹配，因此没有问题。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-01-02T15:40:44.007

您基本上坚持重命名其他方法或 const_cast。

顺便说一句，这是写时复制智能指针在 C++ 中实际上不能正常工作的原因之一。写时复制智能指针是可以无限共享的。当用户在非常量上下文中访问数据时，会制作数据的副本（如果用户不持有唯一引用）。当共享只有部分客户端需要修改的大型数据结构时，这种指针可以非常方便地使用。最“合乎逻辑”的实现是有一个 const 和一个非常量 operator->。const 版本只返回底层引用。非常量版本进行唯一的引用检查和复制。它没有用，因为非常量智能指针默认使用非常量运算符->，即使您想使用 const 版本。

我欢迎任何证明我错了并在 C++ 中显示用户友好的写时复制指针的人......

# asp.net - SQL 2005 SP 的返回值返回 DBNULL - 我哪里出错了？

> ID：407108
> 
> 赞同：1
> 
> 时间：2009-01-02T15:30:17.723
> 
> 标签：asp.net, sql, vb.net, tsql, sql-server-2005

这是SP...

```
USE [EBDB]
GO
/****** Object:  StoredProcedure [dbo].[delete_treatment_category]    Script Date: 01/02/2009 15:18:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
RETURNS 0 FOR SUCESS
        1 FOR NO DELETE AS HAS ITEMS
        2 FOR DELETE ERROR
*/

ALTER PROCEDURE [dbo].[delete_treatment_category]
(
    @id INT
)
AS
    SET NOCOUNT ON

    IF EXISTS
    (
        SELECT id
        FROM dbo.treatment_item
        WHERE category_id = @id
    )
    BEGIN
        RETURN 1
    END 
    ELSE
    BEGIN
        BEGIN TRY
            DELETE FROM dbo.treatment_category
            WHERE id = @id
        END TRY

        BEGIN CATCH
            RETURN 2
        END CATCH 

        RETURN 0                        
    END 
```

我正在尝试使用以下代码（VB .NET 中的 sqlDataSource 和 Gridview 组合）获取返回值

```
Protected Sub dsTreatmentCats_Deleted(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.SqlDataSourceStatusEventArgs) Handles dsTreatmentCats.Deleted
    Select Case CInt(e.Command.Parameters(0).Value)
    Case 0
        'it worked so no action
        lblError.Visible = False
    Case 1
        lblError.Text = "Unable to delete this category because it still has treatments associated with it."
        lblError.Visible = True
    Case 2
        lblError.Text = "Unable to delete this category due to an unexpected error. Please try again later."
        lblError.Visible = True
End Select
End Sub 
```

问题是 CInt(e.Command.Parameters(0).Value) 行返回一个 DBNull 而不是返回值，但仅在删除时 - 这种方法适用于更新和插入。

希望我只是有点密集并且错过了一些明显的东西 - 有什么想法吗？

**编辑**

我仍然遇到这个问题，并且尝试了以下所有选项都无济于事 - 我很惊讶没有其他人遇到这个问题？

添加参数的代码：

```
<asp:SqlDataSource ID="dsTreatmentCats" runat="server" 
        ConnectionString="<%$ ConnectionStrings:EBDB %>" 
        DeleteCommand="delete_treatment_category" DeleteCommandType="StoredProcedure" 
        InsertCommand="add_treatment_category" InsertCommandType="StoredProcedure" 
        SelectCommand="get_treatment_categories" SelectCommandType="StoredProcedure" 
        UpdateCommand="update_treatment_category" 
        UpdateCommandType="StoredProcedure" ProviderName="System.Data.SqlClient">

    <DeleteParameters>
        <asp:Parameter Direction="ReturnValue" Name="RetVal" Type="Int32" />
        <asp:Parameter Name="id" Type="Int32" />
    </DeleteParameters>
    <UpdateParameters>
        <asp:Parameter Direction="ReturnValue" Name="RetVal" Type="Int32" />
        <asp:Parameter Name="id" Type="Int32" />
        <asp:Parameter Name="name" Type="String" />
        <asp:Parameter Name="additional_info" Type="String" />
    </UpdateParameters>
    <InsertParameters>
        <asp:Parameter Direction="ReturnValue" Name="RetVal" Type="Int32" />
        <asp:ControlParameter ControlID="txtCat" Name="name" PropertyName="Text" 
            Type="String" />
        <asp:ControlParameter ControlID="txtAddInfo" Name="additional_info" 
            PropertyName="Text" Type="String" />
    </InsertParameters>
</asp:SqlDataSource> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T17:26:59.803

我在这里玩游戏有点晚了，但为了那些偶然发现这个问题的人......

如果您在 ADO.Net 中使用 ExecuteReader，则在您关闭 Reader 或与数据库的基础连接之前，不会填充返回值。（[见这里](http://dhenztm.spaces.live.com/blog/cns!761D77A7A749C21B!727.entry)）

这将不起作用：

```
SqlConnection conn = new SqlConnection(myConnectionString);
 SqlCommand cmd = new SqlCommand(mySqlCommand, conn);

 //     Set up your command and parameters

 cmd.Parameters.Add("@Return", SqlDbType.Int).Direction = ParameterDirection.ReturnValue;

 SqlDataReader reader = cmd.ExecuteReader();
 while (reader.Read())
 {
       //     Read your data
 }

 int resultCount = (int)cmd.Parameters["@Return"].Value;
 conn.Close();
 return resultCount; 
```

这会：

```
SqlConnection conn = new SqlConnection(myConnectionString);
 SqlCommand cmd = new SqlCommand(mySqlCommand, conn);

 //     Set up your command and parameters

 cmd.Parameters.Add("@Return", SqlDbType.Int).Direction = ParameterDirection.ReturnValue;

 SqlDataReader reader = cmd.ExecuteReader();
 while (reader.Read())
 {
       //     Read your data
 }

 conn.Close();
 int resultCount = (int)cmd.Parameters["@Return"].Value;
 return resultCount; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T15:36:53.360

添加参数时，是否将 Direction 设置为[ReturnValue](http://msdn.microsoft.com/en-us/library/system.data.parameterdirection.aspx)？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T15:43:27.167

是的，我做到了——我正在使用 sqlDataSource 控件，它为我嗅出参数，包括具有正确方向设置的返回值。只是为了好玩，我也确实从头开始创建了带有 return val 方向的参数，但没有乐趣:(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T08:30:37.693

在 SQL 工具中运行它以确保存储过程的行为符合预期。

```
DECLARE @rtn int;
EXEC @rtn = dbo.delete_treatment_category /*insert valid id here > 2*/;
SELECT @rtn; 
```

我提到“一个 id > 2”是因为你*可能*读错了参数。也就是说，这个存储过程有 2 个参数……一个用于 id，另一个用于返回值。

IIRC：

```
cmd.CommandType = CommandType.StoredProcedure 'cmd is SqlCommand

Dim retValParam as New SqlParameter("@RETURN_VALUE", SqlDbType.Int)
retValParam.Direction = ParameterDirection.ReturnValue
cmd.Parameters.Add(retValParam)

'add the ID parameter here

'execute

'look at the @RETURN_VALUE parameter here 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T12:21:26.210

您不会在添加参数和执行命令的位置显示代码。两者都可能很关键。

我知道重现这种情况的一种方法 - 如果您的过程还返回行（例如，从 DELETE 触发器），并且您没有使用这些行......基本上，输出/返回参数值*遵循*TDS 流中的网格，所以如果您还没有读取网格（使用 ExecuteReader 时） - 那么您将无法获得更新的参数/返回值。但是，如果您正在使用`ExecuteNonQuery`这不应该是一个因素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-21T14:08:17.293

为什么对 Delete 参数使用 Name="RETURN_VALUE" 而对 Update 和 Insert 使用 Name="RetVal"？如果后两者有效，那是我要看的第一个地方。

# visual-studio - 从 Visual Studio 安装程序项目安装 Windows 服务

> ID：407109
> 
> 赞同：40
> 
> 时间：2009-01-02T15:30:24.463
> 
> 标签：visual-studio, windows-services, installation

一位同事编写了一个 Windows 应用程序，让我去做安装程序。我已经通过 Visual Studio 创建了安装程序项目，并将服务项目的主要输出添加到新项目中。

当我运行安装程序时，它会创建正确的文件夹并复制 dll、exe 和配置文件，但它不会执行服务的实际安装。

该服务未在“服务”窗口中列出，如果我双击该 exe，我被告知我需要运行 installutil 来安装该服务。

我如何让安装程序为我做这件事？我找到了这篇文章：

[http://www.codeproject.com/KB/install/InstallService.aspx](http://www.codeproject.com/KB/install/InstallService.aspx)

但这对于我所期望的非常基本的东西来说似乎过于复杂。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-02T15:34:17.327

我用了这篇文章：

[如何在 Visual Basic .NET 或 Visual Basic 2005 中为 Windows 服务创建安装项目](http://support.microsoft.com/kb/317421)

在完成本文中的所有步骤之前，我无法弄清楚这一切，感觉非常愚蠢。无论如何，这不是一个简单的练习。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2010-11-23T20:31:30.330

对于那些正在寻找 Visual Studio 2010 更新说明（答案说明适用于 VS 2005）的人，请查看以下链接：

[演练：在组件设计器中创建 Windows 服务应用程序](http://msdn.microsoft.com/en-us/library/zt39148a%28v=vs.100%29.aspx)（注意“其他版本”[VS 2005、VS2008] 可从同一链接获得）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-11-29T09:29:46.263

我遇到了这个问题，问题是我忽略了为安装程序项目添加自定义操作。要在此处找到这些右键单击项目->“查看”->“自定义操作”，它需要将主要输出添加到文件夹中。

# wpf - 在 WPF 中设置组合框的下拉高度

> ID：407115
> 
> 赞同：14
> 
> 时间：2009-01-02T15:31:40.077
> 
> 标签：wpf, combobox

我在 WPF 中有一个组合框，我在运行时添加项目（通过数据绑定到列表）。我想动态设置下拉框的高度，以便显示所有（或大部分）项目。不幸的是，下拉菜单的高度似乎设置了一次，并且不能动态更改。它似乎总是相同的大小。

是否有一些相对简单的调整下拉高度？

* * *

是的，我在将项目添加到组合框后尝试设置它。在调试器中，看起来新值就在那里。但是，当我打开下拉列表时，它会下降到自己选择的大小。我尝试过夸大 MaxDropDownHeight，甚至将其设置为“自动”也无济于事。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-02T17:14:24.020

该属性`MaxDropDownHeight`是一个依赖属性，在组合框上控制下拉列表的高度。由于它是一个依赖属性，它的值可以动态设置。

您是否尝试设置此值？

```
MaxDropDownHeight="Auto" 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2017-07-10T16:39:27.463

对我来说，问题是 ComboBox 下拉菜单的高度为 95 像素，与项目数量无关。

我的 ComboBox 数据源是`Collection<>`，但在将其更改为 后`ObservableCollection<>`，ComboBox 下拉菜单打开，显示所有项目。

现在该`MaxDropDownHeight`物业也工作得很好。

参考：这里的评论[使组合框的下拉菜单更短？](https://stackoverflow.com/questions/11302874/make-the-dropdown-of-a-combobox-be-shorter#comment14889455_11302915)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-19T17:13:13.113

设置您的 ComboBox 的 Style={x:Null} 以确保您没有影响下拉面板大小的样式问题。

# url - 在 URL 中使用 DB id 的优缺点？

> ID：407120
> 
> 赞同：2
> 
> 时间：2009-01-02T15:32:17.813
> 
> 标签：url, web-applications, url-routing, slug

例如：`http://stackoverflow.com/questions/396164/exposing-database-ids-security-risk`并`http://stackoverflow.com/questions/396164/blah-blah`加载相同的问题。

（我猜这是 Questions 表的 DB id？这是 ASP.NET 中的标准吗？）

在您的 Web 应用程序中使用这种类型的方案有哪些优点和缺点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T15:36:18.023

好吧，首先，简单的 id 通常是连续的，因此很容易猜测并从应用程序中检索其他数据。

[在运行时加载 JSON，而不是通过 AJAX](https://stackoverflow.com/questions/395857/doesnt-matter-what-I-type-here) [https://stackoverflow.com/questions/395858/doesnt-matter-what-I-type-here动态加载](https://stackoverflow.com/questions/395858/doesnt-matter-what-I-type-here)

现在，话虽如此，这也可能被视为一种奖励，因为没有人会认为他们的整个安全取决于您必须点击链接才能访问您的*安全数据*，因此很容易发现数据可能很好。

然而，有一点是你在某个时候要重新索引你的数据库，如果没有其他原因搜索引擎仍然有旧链接，那么让旧网址无效的东西会很糟糕。

此外，在 SO 上，将这样的链接用于其他问题是很正常的，所以如果他们在某个时候想要重新索引并因此重新编号（或移动到 guid），他们仍然必须保留旧的结构和 id。

现在，这可能会发生或需要吗？可能没有。

我不会太担心它，只需构建您的安全性，就好像您的应用程序的每个入口点都是已知的并且应该没有问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T15:52:03.687

1.  数据库 ID 用于在数据库中查找问题。它是数字，意思是：快。如果您将其省略，则必须查找要慢得多的标题。

2.  问题本身是 url 的一部分，使其“搜索引擎友好”。它会被 g**gle 等排名更高。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T16:06:01.007

临：

*   超级容易检索页面信息。拿ID，调用数据库，中提琴。您的表将（应该）被索引以使此查找超级快。
*   保证唯一的 URL。

缺点：

*   您系统中的 ID 正在公开显示。在像 SO 这样的公开系统中不是问题。但是，即使在敏感系统上，后端的适当安全措施也不会成为问题。
*   丑陋的网址。6 位以上的数字很难记住，并且如果数字是唯一可以识别它的页面，则更难以区分页面。这也可能产生 SEO 后果，因为具有更多相关和结构良好的信息的 URL 通常排名更好。SO 也通过在 URL 中提供帖子名称来进行补偿。虽然我仍然无法在午餐时向我的好友发出特定的帖子，但我仍然可以在浏览器历史记录中找到它更容易。
*   较慢的查找。在数据库上进行文本搜索通常较慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T15:40:07.517

但请记住，在这样的社区中，同一问题名称同时发布的可能性更高（尽管仍然很小），这会破坏事情，因此需要应用某种唯一标识，ID 可能在开发此特定 Web 应用程序的上下文。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T16:06:58.353

我不认为在 ASP.NET 和其他框架中这样做是不好的做法，而且相当普遍。正如@lassevk 所说，如果您的安全性取决于它，那么您需要在那里进行更多检查（用户 X 可以记录 Y），但这更多地归结为公共网站 URL 的 SEO 友好性。

例如，SO 的 URL*相当*友好：

> [在 URL 中使用 DB id 的优缺点？](https://stackoverflow.com/questions/407120/pros-and-cons-of-using-db-id-in-the-url)

谷歌在 URL 的开头对信息的评分高于结尾，所以看起来像：

> [https://stackoverflow.com/pros-and-cons-of-using-db-id-in-the-url/q/407120](https://stackoverflow.com/pros-and-cons-of-using-db-id-in-the-url/q/407120)

**应该在“在 url 中使用 db id 的利弊”**获得更高的排名。这不是唯一的因素，但它是一个非常重要的因素 - 看看亚马逊的格式，他们这样做是有充分理由的：

> [http://www.amazon.com/Maverick-Ricardo-Semler/dp/0712678867](https://rads.stackoverflow.com/amzn/click/com/0712678867)
> 
> [http://server/book-name/dp/book-id](http://server/book-name/dp/book-id)

Wordpress 是这样做的：

> [http://server/yyyy/mm/dd/name-of-the-post](http://server/yyyy/mm/dd/name-of-the-post)

但是，如果您在同一天发布两个名为“foo”的帖子，您会得到：

> [http://server/yyyy/mm/dd/foo](http://server/yyyy/mm/dd/foo)
> 
> [http://server/yyyy/mm/dd/foo2](http://server/yyyy/mm/dd/foo2)

slug (foo/foo2) 不是 PK，但它在帖子表中保持唯一。

我认为将 ID 放入 URL 中没有问题，除非您的 URL 是 GUID！太长了，很难打字。如果它是一个 int 或某种短 guid（例如 6-8 个字符），那么它应该不是问题。

# fonts - 控制台窗口的替代字体？

> ID：407129
> 
> 赞同：42
> 
> 时间：2009-01-02T15:35:20.553
> 
> 标签：fonts, console, terminal

我喜欢为控制台找到一些新的/有趣的固定宽度字体。

我们都知道 Lucida/Courier，还有什么？

**更新**

因此，获胜者是 Consolas（它确实内置于新的 Windows 7 中）

杰夫对此有很好的[主题](http://www.codinghorror.com/blog/archives/000157.html)（以及后来[重新讨论的主题](http://www.codinghorror.com/blog/2007/10/revisiting-programming-fonts.html)）：

其他有趣的字体是：

*   无情的
*   Proggy 清洁
*   终点站
*   6x13（如果你需要小字体）

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-02T15:37:13.170

[康索拉斯](http://www.codinghorror.com/blog/archives/000969.html)。

[我从Jeff 的博客](http://www.codinghorror.com/blog/archives/000157.html)中找到了 Consolas 。这是迄今为止我最喜欢的等宽字体。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-02T15:45:42.903

6x13 - 经典的 xterm 字体。它的名声在于它是 6 像素宽，而 Lucida Console 的最小有用尺寸是 7 像素宽。使用 6x13 的 80 列终端或编辑器窗口是 480 像素宽加上滚动条和窗口边框。这意味着 1024 像素的屏幕足以容纳两个并排的编辑器或 shell 窗口，而 1600 像素的屏幕足够容纳三个。

虽然如今 1024 像素屏幕在 PC 上有点过时，但它们在上网本上很常见。1600x1200 屏幕在 PC 上广泛使用，许多笔记本电脑都有 1600x900 屏幕，因此根据您拥有的屏幕类型，这种字体有几个最佳点。

可以在[此处下载 Windows 版本。](http://www.hassings.dk/lars/fonts.html) 还有几种 6 像素宽的 X11 字体，高度小于 13 像素（通常称为“清晰”），因此您可以在屏幕上获得更多线条。但是，我从未见过它们的 windows .FON 转换。请注意，这些是位图字体，虽然在屏幕空间方面相当节俭，但它们不可扩展且不支持抗锯齿。

PS 话虽如此，我在工作中使用的是 Windows 上的 Lucida Console，尽管我有两个 1280x1024 的屏幕足够宽。Lucida 控制台不如 6x13 高，因此它为给定数量的垂直像素提供更多行。在家里，我有两台 1600x1200 显示器，在 Linux 上使用 6x13，在 Windows 上使用 Lucida Console for Visual Studio。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T15:44:03.360

**[这里](http://www.kuro5hin.org/story/2004/12/6/11739/5249)**有一个很好**的等宽字体列表** ，它可能会提供一些灵感。

### 更新：链接断开

我已经根据@jleedev 的评论更新了上面的链接，但是，正如他所指出的，图像的链接似乎已损坏。道歉。

旧链接是：[http ://www.lowing.org/fonts/](http://www.lowing.org/fonts/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-02T15:50:05.127

Proggy 或[Terminus](http://terminus-font.sourceforge.net/) (ter-112n 9pt)，两者都非常适合编码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-02T15:36:49.303

FixedSys、Consolas、无衬线字体。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-02T15:38:07.227

你可以试试例如Consolas。但是，必须在注册表中配置其他字体（参见[http://blog.wolffmyren.com/2008/09/15/consolas-as-cmdexe-windows-console-font/](http://blog.wolffmyren.com/2008/09/15/consolas-as-cmdexe-windows-console-font/)）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-02T15:42:43.487

[Andale Mono](http://web.nickshanks.com/typography/corefonts)是我玩过的另一个选择（尽管我没有选择它）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-02T18:38:53.303

如果您发现编码太容易并且想要在工作时考虑其他事情，或者您出于某种原因正在对您的眼睛发起某种攻击性活动，那么[这款程序员的字体非常棒。](http://www.arcavia.com/Software/ProgFont/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-10T04:59:00.733

很长一段时间以来，我都是一个 Consolas 怪胎，但我刚刚转换为 Monaco——它也是一种适用于 Windows 的 Apple 字体。眼睛很舒服..但也许我只是喜欢弯曲的东西；）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-30T21:22:53.427

[Droid Sans Mono](http://www.google.com/webfonts/family?family=Droid%20Sans%20Mono)是唯一的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-02T15:37:11.050

等宽和无衬线的东西，否则不在乎

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-02T15:41:28.153

康索拉 10pt

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-02T15:56:54.800

所以，赢家是康索拉斯

杰夫对此有很好的[话题](http://www.codinghorror.com/blog/archives/000157.html)：

其他有趣的字体是：

*   无情的
*   Proggy 清洁
*   终点站
*   6x13（如果你需要小字体[http://www.hassings.dk/lars/fonts.html](http://www.hassings.dk/lars/fonts.html)）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-03T14:03:22.267

Consolas 如果你是一个只用 Windows 的家伙（当我在别处尝试时它看起来像垃圾）。Inconsolata 如果您在其他平台上。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-08-10T05:15:35.180

[ProFont](http://www.tobias-jung.de/seekingprofont/)是 Monaco 的绝佳替代品（斜线零，更明显的标点符号，可以区分 I、l 和 1。）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-08-10T05:22:44.727

固定 18 中。很清晰，支持很多字符，而且自带X。

我遇到的唯一问题是 gnome-terminal 会对字体大小进行一些调整。也就是说，我还没有在 gnome-terminal(xterm ftw) 中看到真正的 fixed-18。而且，如果你没有得到真正的fixed-18，它看起来就像垃圾，IMO。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-04-15T09:59:42.647

我认为[白兔](http://img.dafont.com/dl/?f=white_rabbit)（matix 电影中使用的字体）是最好的极客字体之一。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-10-21T19:35:44.450

我在我的 shell 和编辑器中都使用 Vera Monospace Roman。:)

# c# - 调用 C# 方法，并使其返回需要 10 秒

> ID：407130
> 
> 赞同：2
> 
> 时间：2009-01-02T15:35:34.250
> 
> 标签：c#, .net, wcf, multithreading

在 Web 服务 (WCF) 中，我希望端点需要 10 秒才能完成。

有没有办法我可以`thread.sleep(10);`对方法做一个？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-02T15:38:32.107

您可以创建一个包装方法来进行适当的睡眠。

```
Thread.Sleep(TimeSpan.FromSeconds(10)) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T15:43:28.417

启动一个休眠 10 秒的新线程，然后返回，这样方法运行所需的时间不会增加到 10 秒

```
using System.Threading;

public static WCF(object obj) 
    {
        Thread newThread = 
            new Thread(new ThreadStart(Work));
        newThread.Start();

        //do method here

        newThread.Join();
        return obj;

    }

    static void Work()
    {
        Thread.Sleep(10000);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T15:38:34.290

如果您的意思是不更改 WCF 调用的另一端（服务器端）的代码，（因为如果您可以更改那里的代码，那么答案很明显），

那就不要..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T15:54:48.673

如果这只是为了测试，您可以让代理类指向模拟超时的 Web 代理。使用[Fiddler](http://www.fiddlertool.com/fiddler/)，您可以编写延迟 10 秒的请求/响应脚本，然后让代理类使用 Fiddler 通过设置“代理”属性来发出 Web 服务请求：

```
IWebProxy proxy = new WebProxy("http://localhost:8888", true);
webService.Proxy = proxy; 
```

# iphone - UIDatePicker 仅显示月份和日期

> ID：407149
> 
> 赞同：11
> 
> 时间：2009-01-02T15:38:33.840
> 
> 标签：iphone, cocoa-touch, uidatepicker

我想要一个`UIDatePicker`用户可以选择一个月和一天但不能选择年份的地方。我知道闰年有额外的一天，所以为了简单起见，让我们把那一天扔掉。

有没有办法删除年份列或有 2 个月/日卷轴，其行为类似于`UIDatePicker`（所选月份中不存在的灰色日期）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-05T10:27:16.930

您不能使用 UIDatePicker 类来执行此操作 - UIDatePicker 仅支持以下模式

```
typedef enum {
   UIDatePickerModeTime,
   UIDatePickerModeDate,
   UIDatePickerModeDateAndTime,
   UIDatePickerModeCountDownTimer
} UIDatePickerMode; 
```

创建一个实现 UIPickerViewDelegate 的视图和控制器并创建您自己的 - 您可以在此处找到更多详细信息[Fixed labels in the selection bar of a UIPickerView](https://stackoverflow.com/questions/367471/fixed-labels-in-the-selection-bar-of-a-uipickerview)

# function - (g)Vim 7.x :: 可能诱使 Vim 允许使用小写的用户定义命令

> ID：407154
> 
> 赞同：4
> 
> 时间：2009-01-02T15:40:25.503
> 
> 标签：function, vim, naming-conventions

并不是说打字很麻烦

```
:My_custom_foobar() 
```

而不仅仅是

```
:my_custom_foobar() 
```

但是考虑到 Vim 的几乎所有其他方面都是如此可扩展的，这感觉很奇怪。一些寻找答案的人并没有出现太多，但我知道不必从源代码重新编译 Vim 就可以了。有没有人知道如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T15:57:10.073

也许尝试[映射](http://vim.wikia.com/wiki/Mapping_keys_in_Vim_-_Tutorial_(Part_3))。

```
nnoremap <Leader>f :call My_custom_foobar()<CR> 
```

您必须一次完成一项功能。不知道你将如何为所有功能做这件事。我说要遵守约定并为函数名称键入大写字母。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T03:38:36.397

你可以用 :abbrev 来做，但真的不推荐。您不能这样做的原因是：1）vi 兼容性，2）未来的扩展。

第 2 点是更大的问题——如果你可以编写函数，那么不能保证你最终不会命名一个后来与内置函数冲突的函数，而这根本是不允许的。尝试加载函数时最终会出错。

# pdf - 有没有办法在没有框架的 asp.net 网页中显示 PDF？

> ID：407179
> 
> 赞同：0
> 
> 时间：2009-01-02T15:44:45.090
> 
> 标签：pdf

我有一个 PDF 文档需要在浏览器中提取、编辑和保存。我可以通过嵌入式 adobe 工具栏以及所有其他 acrobat 功能进行保存。但是，我想看看是否有一种方法可以在网页中与 Web 控件一起显示 PDF。

例如，在网页的顶部，我有一个下拉列表。它有一个 PDF 列表。我选择一个，网页的底部打开 PDF。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T15:47:52.480

您是否正在寻找类似[Scribd 的 iPaper 查看器之](http://www.scribd.com/tools/ipaper)类的东西？

您可以将其嵌入您的网站或与他们一起托管。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T15:48:54.677

这通常使用[iframe](http://www.w3schools.com/TAGS/tag_iframe.asp)完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T15:47:54.663

抱歉，您必须使用 Frames 或 iFrames。也许您也可以通过`<object>`标签获取它，但这可能是特定于浏览器的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T15:49:40.493

我会联系 ceTe 的人员（DynamicPDF 的制造商）。他们的产品允许您用 PDF 文件动态替换页面输出，但这涉及更改整个页面（mime 类型将是 pdf）。是否可以将页面输出到面板？我不这么认为，但他们会是我会求助的人。

# c# - 将具有子对象的对象作为属性绑定到数据网格

> ID：407180
> 
> 赞同：8
> 
> 时间：2009-01-02T15:44:54.653
> 
> 标签：c#, datagrid, binding, object, datagridviewcolumn

我正在使用其中包含子对象的对象（请参见下面的示例）。我正在尝试将 a 绑定`List<rootClass>`到数据网格。`List<>`当我在包含 的单元格中绑定 时`subObject`，我看到以下值`... "namespace.subObject" ...`字符串值正确显示。

理想情况下，我希望看到数据单元中的“描述”属性`subObject`。如何映射`subObject.Description`以显示在数据单元中？

```
public class subObject
{
   int id;
   string description;

   public string Description
   { get { return description; } }
}

public class rootClass
{
   string value1;
   subObject value2;
   string value3;

   public string Value1
   { get { return value1; } }

   public subObject Value2
   { get { return value2; } }

   public string Value3
   { get { return value3; } }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-03T12:10:03.447

既然你提到`DataGridViewColumn`（标签），我假设你的意思是winforms。

访问子属性很痛苦；货币管理器绑定到列表，因此默认情况下您只能访问即时属性；但是，*如果您绝对需要*，可以使用自定义类型描述符来解决这个问题。您还需要使用不同的令牌，例如“Foo_Bar”而不是“Foo.Bar”。然而，这是一项需要知识的大量工作**，**`PropertyDescriptor`而且`ICustomTypeDescriptor`可能`TypeDescriptionProvider`而且几乎可以肯定是不值得的，

最简单的解决方法是将属性公开为 shim / pass-thru：

```
public string Value2Description {
    get {return Value2.Description;} // maybe a null check too
} 
```

然后绑定到“Value2Description”等。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-02T15:49:33.647

如果我没记错的话，它会显示在您的子对象上调用 .ToString() 的结果，因此您可以覆盖它以返回描述的内容。

您是否尝试过仅绑定到 Value1.Description？（我猜它不起作用）。

我有一个可以在绑定时代替 List 使用的类，它将处理这个问题，它实现了 ITypedList，它允许集合为其对象提供更多“属性”，包括计算的属性。

我拥有的文件的最新版本在这里：

[https://gist.github.com/lassevk/64ecea836116882a5d59b0f235858044](https://gist.github.com/lassevk/64ecea836116882a5d59b0f235858044)

要使用：

```
List<rootClass> yourList = ...
TypedListWrapper<rootClass> bindableList = new TypedListWrapper<rootClass>(yourList);
bindableList.BindableProperties = "Value1;Value2.Description;Value3.Description";
gridView1.DataSource = bindableList; 
```

基本上你绑定到一个实例，`TypedList<T>`而不是`List<T>`，并调整 BindableProperties 属性。我对工作进行了一些更改，包括一个只是在运行时自动构建 BindableProperties，但它还没有放在主干中。

您还可以添加计算属性，如下所示：

```
yourList.AddCalculatedProperty<Int32>("DescriptionLength",
    delegate(rootClass rc)
    {
        return rc.Value2.Description.Length;
    }); 
```

或使用 .NET 3.5：

```
yourList.AddCalculatedProperty<Int32>("DescriptionLength",
    rc => rc.Value2.Description.Length); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T17:27:10.173

我不确定您是否使用 ASP.NET，但如果是，那么您可以使用模板列和 Eval() 方法来显示嵌套对象的值。例如显示子对象的描述属性：

```
<asp:GridView ID="grid" runat="server" AutoGenerateColumns="true">
  <Columns>
    <asp:TemplateField>
      <ItemTemplate>
        <asp:Literal Text='<%# Eval("Value2.Description") %>' runat="server" />
      </ItemTemplate>
    </asp:TemplateField>
  </Columns>
</asp:GridView> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-24T14:18:30.523

不知道你追求的是不是这样的……

您可以编写如下方法：

```
protected string getSubObject(object o)
{
    string result = string.empty;

    try
    {
        result = ((subObject)o).Description;
    }
    catch
    { /*Do something here to handle/log your exception*/ } 

    return result;
} 
```

然后像这样绑定对象：

```
<asp:Literal Text='<%# getSubObject(Eval("Value2")) %>' runat="server" /> 
```

# bash - 如何在 bash 脚本中检查文件名的扩展名？

> ID：407184
> 
> 赞同：209
> 
> 时间：2009-01-02T15:46:04.010
> 
> 标签：bash, scripting, file

我正在用 bash 编写一个夜间构建脚本。
一切都很好，花花公子，除了一点点障碍：

```
 #!/bin/bash

for file in "$PATH_TO_SOMEWHERE"; do
      if [ -d $file ]
      then
              # do something directory-ish
      else
              if [ "$file" == "*.txt" ]       #  this is the snag
              then
                     # do something txt-ish
              fi
      fi
done; 
```

我的问题是确定文件扩展名，然后采取相应措施。我知道问题出在 if 语句中，测试 txt 文件。

如何确定文件是否具有 .txt 后缀？

* * *

## 回答 #1

> 赞同：313
> 
> 时间：2009-01-02T16:30:27.947

制作

```
if [ "$file" == "*.txt" ] 
```

像这样：

```
if [[ $file == *.txt ]] 
```

也就是说，双括号，没有引号。

右侧`==`是贝壳图案。如果您需要正则表达式，请使用`=~`then。

* * *

## 回答 #2

> 赞同：290
> 
> 时间：2009-01-02T15:59:50.020

我想你想说“$file 的最后四个字符是否等于`.txt`？” 如果是这样，您可以使用以下内容：

```
if [ "${file: -4}" == ".txt" ] 
```

请注意，和之间的空格`file:`是`-4`必需的，因为 ':-' 修饰符的含义不同。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-01-02T16:10:01.640

在 Unix 系统上，您无法确定 .txt 文件确实是文本文件。你最好的选择是使用“文件”。也许尝试使用：

```
file -ib "$file" 
```

然后，您可以使用 MIME 类型列表来匹配或解析 MIME 的第一部分，您可以在其中获得“文本”、“应用程序”等内容。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2011-08-03T11:56:45.533

你也可以这样做：

```
 if [ "${FILE##*.}" = "txt" ]; then
       # operation for txt files here
   fi 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-01-02T15:54:13.450

如果您确实想查找有关文件的信息而不是依赖扩展名，则可以使用“文件”命令。

如果您对使用扩展感到满意，您可以使用 grep 来查看它是否匹配。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2017-01-26T17:38:56.147

关于如何在 linux 中获取文件名中可用的扩展名的正确答案是：

```
${filename##*\.} 
```

打印目录中所有文件扩展名的示例

```
for fname in $(find . -maxdepth 1 -type f) # only regular file in the current dir
    do  echo ${fname##*\.} #print extensions 
done 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2012-12-29T12:51:15.223

与“文件”类似，使用稍微简单的“mimetype -b”，无论文件扩展名如何，它都可以使用。

```
if [ $(mimetype -b "$MyFile") == "text/plain" ]
then
  echo "this is a text file"
fi 
```

编辑：如果 mimetype 不可用，您可能需要在系统上安装 libfile-mimeinfo-perl

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-04-01T15:34:33.413

我编写了一个 bash 脚本，它查看文件的类型，然后将其复制到一个位置，我用它来查看我从我的 Firefox 缓存中在线观看的视频：

```
#!/bin/bash
# flvcache script

CACHE=~/.mozilla/firefox/xxxxxxxx.default/Cache
OUTPUTDIR=~/Videos/flvs
MINFILESIZE=2M

for f in `find $CACHE -size +$MINFILESIZE`
do
    a=$(file $f | cut -f2 -d ' ')
    o=$(basename $f)
    if [ "$a" = "Macromedia" ]
        then
            cp "$f" "$OUTPUTDIR/$o"
    fi
done

nautilus  "$OUTPUTDIR"& 
```

它使用与此处介绍的类似的想法，希望这对某人有所帮助。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-08-03T12:18:31.130

我想这`'$PATH_TO_SOMEWHERE'`就像`'<directory>/*'`.

在这种情况下，我会将代码更改为：

```
find <directory> -maxdepth 1 -type d -exec ... \;
find <directory> -maxdepth 1 -type f -name "*.txt" -exec ... \; 
```

如果你想对目录和文本文件名做一些更复杂的事情，你可以：

```
find <directory> -maxdepth 1 -type d | while read dir; do echo $dir; ...; done
find <directory> -maxdepth 1 -type f -name "*.txt" | while read txtfile; do echo $txtfile; ...; done 
```

如果文件名中有空格，您可以：

```
find <directory> -maxdepth 1 -type d | xargs ...
find <directory> -maxdepth 1 -type f -name "*.txt" | xargs ... 
```

# html - 进出数据库后的编码问题

> ID：407200
> 
> 赞同：1
> 
> 时间：2009-01-02T15:50:16.530
> 
> 标签：html, encoding

我正在做一个书签系统。但是当我插入获取的标题“第 4 章。VLC 流输出的高级使用示例（转码、多流等）”时，它在数据库中看起来非常好，但是当我在显示器上再次打印出来时-page，它看起来像这样：

`Chapter�4.� Examples for advanced use of VLC's stream output (transcoding, multiple streaming, etc...)`

为什么会发生这种情况，我该如何解决？

整个系统运行在 utf-8 上。

提前致谢！=)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T03:47:29.240

There is most likely a layer of your application not using utf-8\. Try to isolate the problem by inserting known extended characters (e.g.‘’—) into the database and into your application code and see how they are displayed.

# comments - 关于龙的可怕代码注释是什么？

> ID：407202
> 
> 赞同：23
> 
> 时间：2009-01-02T15:51:27.883
> 
> 标签：comments

该短语被用作警告代码正在拉一些严重的特技。我的谷歌搜索正在拉起 nada；但我记得很久以前有人在谷歌来源搜索该短语。

在谎言龙？

龙睡在这里……

呸...

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-02T15:55:24.303

[这里是龙。](http://en.wikipedia.org/wiki/Here_be_dragons)

最初来自[旧地图](http://www.maphist.nl/extra/herebedragons.html)，并不是任何旧地图实际使用该术语！

PS。不建议使用原始的拉丁语“hic sunt dracones”，除非您想成为真正的书呆子并且看起来优于未来的代码维护者:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-11-06T07:48:12.507

> ### //[这里是龙](http://en.wikipedia.org/wiki/Here_be_dragons)

* * *

一个示例在[HipHop for PHP](http://en.wikipedia.org/wiki/HipHop_for_PHP)的源代码中，截至 2012 年 7 月 13 日，位于 /src/runtime/ext/ext_imagesprite.cpp 的第[649 行：](https://github.com/facebook/hiphop-php/blob/39415630e84538fb553cd325a85ce837bcf6cb70/src/runtime/ext/ext_imagesprite.cpp#L649)

```
// Here be dragons. Thou art forewarned 
```

如果由于某种原因程序员不太理解代码在做什么，那么“这里是龙”的注释意味着代码是“未知领域”。

（*注意我的用户名* `:P`）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T15:56:51.773

[这里是龙](http://en.wikipedia.org/wiki/Here_be_dragons)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-09T12:06:44.923

当您在 Firefox 的地址栏中转到 about:config 时，会显示“Here be dragons”。

**编辑：**请注意我在英国，所以这可能是特定于语言环境的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-06-24T10:54:24.920

在 GitHub 存储库中搜索显示“Here be dragons”出现 1,904 次：[https](https://grep.app/search?q=Here%20be%20dragons) ://grep.app/search?q=Here%20be%20dragons 。

例子：

*   [Golang中多精度除法的500行注释](https://github.com/golang/go/blob/a9bb38222a06333176cafc5637083e0322277c09/src/math/big/natdiv.go#L5-L497)
*   [叮当](https://github.com/llvm/llvm-project/blob/d480f968ad8b56d3ee4a6b6df5532d485b0ad01e/clang-tools-extra/clangd/SourceCode.cpp#L53-L63)
*   [Kubernetes/kops](https://github.com/kubernetes/kops/blob/2f003d8e5664d403889c831a69578c74ebb93507/upup/pkg/fi/cloudup/populate_cluster_spec.go#L72-L81%20https://github.com/facebook/folly/blob/99fbca1df19fdd21f1b831cad6f50ece94573675/folly/experimental/symbolizer/SignalHandler.cpp#L420)
*   [Twitter 的 Finangle](https://github.com/twitter/finagle/blob/develop/finagle-core/src/main/scala/com/twitter/finagle/server/ListeningStackServer.scala#L110-L120)
*   [厨师](https://github.com/chef/chef/blob/2205419ad84a18881fc57fdb2ec3fe492228dcea/lib/chef/provider/package/snap.rb#L148-L169)

# html - 如何在 Visual Studio 中移动自动完成的结束标记

> ID：407209
> 
> 赞同：11
> 
> 时间：2009-01-02T15:54:38.877
> 
> 标签：html, visual-studio, autocomplete

我想让 Visual Studio 将自动完成的结束标记向右移动一个单词（或更多）。例如，给定以下 HTML：

```
<p>I need to emphasize some text.</p> 
```

如果我`<em>`在“强调”这个词之前输入，Visual Studio 会像这样自动完成：

```
<p>I need to <em></em>emphasize some text.</p> 
```

然后我需要移动关闭`</em>`以获得我想要的东西：

```
<p>I need to <em>emphasize</em> some text.</p> 
```

有没有办法让 Visual Studio 自动完成最后一步？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T00:03:24.773

你的问题让我想到如果这个功能存在该有多酷。幸运的是，在 VS 中实现为宏非常简单。下面是宏的代码。您可以使用 VS 中的自定义工具轻松地将其绑定到 CTRL+ALT+Right。

（**注意**：我只是很快把它放在一起，因为它是星期五晚上）

```
Sub MoveClosingTag()
    Dim ts As EnvDTE.TextSelection = CType(DTE.ActiveDocument.Selection(), EnvDTE.TextSelection)
    Dim start As EditPoint = ts.ActivePoint.CreateEditPoint()
    Dim tag As String

    ts.WordRight(True)
    If ts.Text = "</" Then
        Do Until ts.ActivePoint.AtEndOfLine
            ts.CharRight(True)
            If ts.Text.EndsWith(">") Then Exit Do
        Loop
        tag = ts.Text
        If tag.EndsWith(">") Then
            ts.Delete()
            ts.WordRight(False)
            ts.Insert(tag, EnvDTE.vsInsertFlags.vsInsertFlagsCollapseToStart)
        Else
            ts.MoveToPoint(start)
        End If
    Else
        ts.MoveToPoint(start)
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T16:09:57.630

我不认为这是可能的。但是，您可以配置哪些 HTML 标记将自动关闭：

工具 -> 选项 -> 文本编辑器 -> HTML -> 格式 -> “标签特定选项”按钮 -> 客户端 HTML 标签 -> em -> 结束标签 -> 无结束标签

还请考虑自动移动结束标记并非微不足道（单词边界应该是什么？）并且它只涵盖一个非常特殊的用例（例如应该突出显示一个单词）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-05T18:45:21.043

支持@w4g3n3r 努力工作。我对宏进行了一些修改，以便更好地使用空格。

注意：我发现它`CTRL+.`可以很好地用作快捷键；`.`在我最初描述的用例中，你的右手无名指已经在钥匙上了。

```
Sub MoveClosingTag()
    Dim ts As EnvDTE.TextSelection = CType(DTE.ActiveDocument.Selection(), EnvDTE.TextSelection)
    Dim start As EditPoint = ts.ActivePoint.CreateEditPoint()
    Dim tag As String

    ts.WordRight(True)
    If ts.Text = "</" Then
        Do Until ts.ActivePoint.AtEndOfLine
            ts.CharRight(True)
            If ts.Text.EndsWith(">") Then Exit Do
        Loop
        tag = ts.Text
        If tag.EndsWith(">") Then
            ts.Delete()
            Dim pos As Integer
            pos = ts.CurrentColumn
            ts.FindPattern(">", vsFindOptions.vsFindOptionsRegularExpression)
            If ts.CurrentColumn = pos Then
                ts.WordRight(False)
                ts.FindPattern(">", vsFindOptions.vsFindOptionsRegularExpression)
            End If
            ts.Insert(tag, EnvDTE.vsInsertFlags.vsInsertFlagsCollapseToStart)
        Else
            ts.MoveToPoint(start)
        End If
    Else
        ts.MoveToPoint(start)
    End If
End Sub 
```

# wpf - System.Windows.Window 的 XAML 中的自定义属性

> ID：407210
> 
> 赞同：0
> 
> 时间：2009-01-02T15:54:43.370
> 
> 标签：wpf, user-controls

我有一个非常简单的 WPF UserControl，如下所示：

```
namespace WpfControlLibrary1
{
  public partial class UserControl1 : UserControl
  {
    public UserControl1()
    {
      InitializeComponent();
      Composite = new Composite();
      Composite.Color = Colors.Red;
    }

    protected override void OnRender(DrawingContext drawingContext)
    {
      Draw(drawingContext, new Rect(RenderSize));
    }

    public void Draw(DrawingContext g, Rect rect)
    {
      Composite.Draw(g, rect);
    }

    public Composite Composite
    {
      get;
      set;
    }
  }

  public class Composite
  {
    public void Draw(DrawingContext g, Rect rect)
    {
      g.DrawRectangle(new SolidColorBrush(Color), new Pen(Brushes.Black, 1.0), rect);
    }

    public Color Color
    {
      get;
      set;
    }
  }
} 
```

但是，当我尝试在 UserControl 所在的窗口的 XAML 中执行此操作时：

```
<Window x:Class="WpfApplication1.Window2"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:test="clr-namespace:WpfControlLibrary1;assembly=WpfControlLibrary1"
    Title="Window2" Height="500" Width="700">

  <test:UserControl1 Name="uControl1" Composite.Color="Blue">
  </test:UserControl1>
</Window> 
```

我收到以下错误：

```
Error   1   The attachable property 'Color' was not found in type 'Composite'.
Error   2   The property 'Composite.Color' does not exist in XML namespace 'http://schemas.microsoft.com/winfx/2006/xaml/presentation'. 
```

必须有简单的方法来使上述工作，但恐怕我无法找到有关该主题的任何相关信息。有人可以给我一两个指点吗？

非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T16:51:08.403

该语法`Type.Property`用于设置[附加属性](http://msdn.microsoft.com/en-us/library/ms749011.aspx)。试试这个：

```
<test:UserControl1 Name="whatever">
    <test:UserControl1.Composite>
        <test:Composite Color="Blue"/>
    </test:UserControl1.Composite>
</test:UserControl1> 
```

# .net - 以 100% 的正常运行时间更新应用程序

> ID：407235
> 
> 赞同：10
> 
> 时间：2009-01-02T16:03:59.590
> 
> 标签：.net, architecture

在过去的一次采访中，有人问我如何编写一个必须保持 100% 正常运行时间、响应迅速且可更新的关键任务 Windows 服务。该服务被描述为基于远程处理的应用程序，它接收请求、执行计算并发送回响应。

我的解决方案是拥有一个非常通用的服务，它只是充当网关。这项服务永远不会停止。它将请求排队并将它们转发到一个单独的应用程序域中的另一个服务，该应用程序域将实际处理请求。至少需要有两个这样的处理服务，这样一个可以被关闭以进行更新，而另一个可以响应传入的请求。服务之间的接口将包括握手以查看服务是否正在运行的能力。将存在一个非常小的超时，因此如果服务完全退出，它不会阻止请求。我还强调了这个解决方案可以很好地扩展这一点，因为您可以在不同的盒子上添加更多这些服务。

由于跨应用程序域甚至跨网络通信之间的延迟问题，面试官对这个想法并不太疯狂。我说过，对于任务关键型应用程序，您应该建立一个坚如磐石的基础设施，因为仅靠软件无法解决问题。他还说，他们目前有一个使用 relfection 的系统。我曾考虑将程序集加载到应用程序域并查看目录以进行程序集更改，但这似乎太容易出错。

有没有人构建任何具有类似要求的东西？您使用了哪些解决方案？什么不起作用？反射是一个可用的选项吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-02T16:23:58.273

.Net 内置了对在使用时更新程序集的支持。它被称为[影子复制](http://msdn.microsoft.com/en-us/library/ms404279.aspx)，并在加载程序集之前有效地将程序集复制到单独的目录中。在加载新版本之前，您仍然需要卸载 appdomain，但其他 appdomains 仍然可以使用旧版本的程序集。这样一个 appdomain 就可以在新的 appdomain 加载时为请求提供服务。这也是 IIS 和 ASP.Net 处理事情的方式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-02T16:48:18.457

没有 100% 的正常运行时间。即使是最好的系统也以“5 个九”来衡量停机时间，这意味着 99.999% 的正常运行时间。

此外，还有一个关键点：此测量适用于*计划外*停机时间，例如故障。它不包括您为定期维护而故意关闭系统的时间。

在任何情况下，目标都是安装/更新软件而不会导致停机、计划停机或其他停机。如果 Web 服务器本身不支持动态重新加载，那么您的解决方案似乎是正确的，但我认为现在很多服务器都内置了这种方法。也就是说，您只需要将新文件拖放到服务器上，它就会自动发现某些内容发生了变化并开始使用它们。

但是，取决于可能导致会话状态出现问题的更改的性质。也就是说，现有的用户会话最终可能会在会话中存储与您的新代码不兼容的对象。同样，服务器可能足够聪明，可以保留原始代码的缓存副本，直到使用旧代码的所有会话都终止，但也许您需要自己处理。您的“影子服务器”方法应该可以很好地处理这个问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-02T16:11:29.687

100% 正常运行时间？“五个九”意味着每年 315 秒的停机时间。如果你能做到这一点，你确实会做得很好。

听起来像是一个不可能的面试问题。“...保持 100% 的正常运行时间，响应速度非常快，并且可以更新......” - 给出了正常运行时间的一项指标，但没有提供响应能力。

延迟是一个值得担心的问题，但后来他们说这是一个远程应用程序，所以你无法摆脱它。我认为面试官可能出于自身的原因不同意，也许是为了看看你会如何处理它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-04T07:08:19.407

好的，背景很少，我在无线电信工作，我们的平台需要绝对的正常运行时间，并且看到了所有不同的策略，你绝对不应该使用基于软件的方法，它增加了软件的复杂性，你需要做的就是添加一些硬件。

由于他们要求进行无中断升级，因此必须有一个冗余系统，而让服务器应用程序冗余的绝对最佳方法是使用硬件负载平衡器。在工作中，我们有代工厂，我们所有的新东西都在 Cisco Ace 负载平衡器上进行。

因此，您需要的是两个 Cisco 负载均衡器，在它们之间设置 HSRP，以便在负载均衡器之间进行故障转移。您可以对故障转移设置非常激进，但根据我们的经验，对这些设置过于激进可能会导致不必要的故障转移。另外，请确保关闭 proxy-arp（它会为您省去心痛，因为 cisco 默认情况下已启用它）。

现在，您有一个应用程序服务器集群，对吗？所以你有负载平衡器 ping、端口 ping 和监控应用程序响应时间。您只需要至少两台服务器，但您可以稍后添加更多（容量计划在哪里？）。所以现在这里是无中断升级，在您的维护窗口期间，您可以从负载平衡器管理您的服务器之一。但是负载平衡器可以执行真正的 wikid 管理员操作，任何当前连接都会保留，直到它们自然完成。

在这种状态下，任何请求都会发送到第二台服务器，并且您有时间对正在升级的服务器做任何您想做的事情。就像真的一样，当您必须每 3 个月重新启动服务器以应用关键的 Windows 补丁时，为什么还要编写一个具有花哨的应用程序域重新加载功能的应用程序？只需为硬件掏出现金，并拥有可以 100% 正常工作的东西，即使出现计划外的问题，也能让你进入 5x 9 的范围内。

现在是下一步，地理冗余。思科确实有可以进行地理负载平衡的负载平衡产品，但我从未见过。我见过的最好的地理模型实际上是基于请求的应用程序。这不是无中断升级，但绝对可靠。您所做的是在请求应用程序中配置主服务器和故障转移服务器 IP 地址。如果服务器不可用，它的请求中的应用程序将向备用服务器发起相同的请求，在这种情况下，备用服务器可能位于同一服务器机房或备份位置。理想的组合是应用程序可以在一个位置或备份位置定位负载均衡器虚拟 IP，并且您可以使用负载均衡器在每个位置保持 100%。

此外，如果他担心应用程序域之间的延迟，或网络上的延迟，那家伙就在破解，因为使用正确的 cisco 设备，gig 链接上的延迟在微秒内，不会是你的弱点。

祝你好运。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T16:13:43.737

Spring dm Server 声称能够对 OSGi 包进行热部署/取消部署。如果硬件可以保持足够长的时间，您就可以更新应用程序而无需关闭服务器。如果这一点流行起来，它将成为所有 Java EE 应用服务器的标准功能。

# asp.net - 使用 javascript 确定 ASP.NET 页面是否为回发

> ID：407237
> 
> 赞同：5
> 
> 时间：2009-01-02T16:04:15.783
> 
> 标签：asp.net, javascript

是否可以确定 ASP.NET 页面是否是来自 javascript 的回发？所以基本上是 C# Page.IsPostBack 的 javascript 等价物。

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-02T16:05:42.257

我只想在 javascript 中放置一个渲染标签

```
var isPostBack = <%= Page.IsPostBack ? "true" : "false" %>; 
```

应该将“true”和“false”作为字符串来消除将类型转换为字符串的任何可能问题，如 C# true.ToString() 通常是“True”，这是 javascript 中的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T16:05:48.807

当然。如果您真的需要，只需使用您的服务器代码写出一个 javascript 标志。

但我怀疑你在这里叫错了树。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T17:02:47.333

我不确定您要做什么，但您可能想查看 PageRequestManagerClass：

[http://www.asp.net/AJAX/Documentation/Live/ClientReference/Sys.WebForms/PageRequestManagerClass/default.aspx](http://www.asp.net/AJAX/Documentation/Live/ClientReference/Sys.WebForms/PageRequestManagerClass/default.aspx)

它公开请求的所有不同部分的事件。

# c# - ReaderWriterLockSlim 与监视器

> ID：407238
> 
> 赞同：5
> 
> 时间：2009-01-02T16:04:29.357
> 
> 标签：c#, multithreading, locking, readerwriterlock

我有一个`IDictionary<TKey,TValue>`内部保存 n other 的实现，`Dictionary<TKey, TValue>`并通过键的 HashCode 将插入分发到各个子字典。有 16 个子字典，在 4 核机器上的冲突数量非常低。

对于并行插入，我用 a 锁定了 Add-method `ReaderWriterLockSlim`，只锁定了单个子字典：

```
 public void Add(TKey key, TValue value)
        {
            int poolIndex = GetPoolIndex(key);
            this.locks[poolIndex].EnterWriteLock();
            try
            {
                this.pools[poolIndex].Add(key, value);
            }
            finally
            {
                this.locks[poolIndex].ExitWriteLock();
            }
        } 
```

当插入具有四个线程的项目时，我只有大约 32% 的 cpu 使用率和糟糕的性能。所以我用监视器（即`lock`关键字）替换了 ReaderWriterLockSlim。CPU 使用率现在接近 100%，性能提高了一倍以上。

我的问题是：为什么 CPU 使用率会增加？碰撞次数不应改变。是什么让 ReaderWriterLock.EnterWriteLock 等了这么多次？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-02T23:47:37.330

对于只写负载，Monitor 比 ReaderWriterLockSlim 便宜，但是，如果您模拟读取比写入大得多的读取 + 写入负载，则 ReaderWriterLockSlim 应该执行 Monitor。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T16:08:58.817

我不是专家，但我的猜测是 RWLS 更适合于激烈的争用（例如，数百个线程），而`Monitor`更适合那些一次性同步问题。

我个人使用一个`TimerLock`使用`Monitor.TryEnter`带有超时参数的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T20:30:31.143

你怎么知道是什么导致了糟糕的表现？您无法猜测，唯一的方法是进行某种分析。

你如何处理父集合的锁定或者它是恒定的？

也许您需要添加一些调试输出，看看到底发生了什么？

# silverlight - 如何将控件动态添加到 Silverlight 按钮？

> ID：407239
> 
> 赞同：1
> 
> 时间：2009-01-02T16:04:51.040
> 
> 标签：silverlight, controls

我正在研究 Silverlight 轮询控件。我的目标是拥有一个包含其他控件的 Button，这样当用户单击此组合时，就会发生一些事情。

这是基本的 XAML：

```
<Button Grid.Row="1" Grid.Column="0" Style="{StaticResource AnswerButton}">
   <StackPanel Grid.Row="1" Grid.Column="0" Height="Auto" Width="Auto" Style="{StaticResource StackPnl}">
      <TextBox Text="this is a text box" Style="{StaticResource Answer}" />
      <ProgressBar Style="{StaticResource PollProgress}" />
   </StackPanel>
</Button> 
```

这很好用，但假设我没有定义 StackPanel 等：

```
<Button Grid.Row="1" Grid.Column="0" Style="{StaticResource AnswerButton}">

</Button> 
```

但是我想在运行时添加 StackPanel、TextBox 和 ProgressBar。

看看我遇到的第一个障碍，如何将 StackPanel 动态添加到 Button 控件？

或者，如果有人知道更好的方法来做到这一点......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T16:57:50.513

var panel = new StackPanel();

Button.Content = 面板；

# java - 在循环之前或循环中声明变量之间的区别？

> ID：407255
> 
> 赞同：336
> 
> 时间：2009-01-02T16:06:40.397
> 
> 标签：java, performance, loops, variables, initialization

我一直想知道，一般来说，在循环之前声明一个丢弃变量，而不是在循环内重复声明，是否会产生任何（性能）​​差异？Java中的一个*（非常没有意义的）示例：*

**a)**循环前声明：

```
double intermediateResult;
for(int i=0; i < 1000; i++){
    intermediateResult = i;
    System.out.println(intermediateResult);
} 
```

**b）**在循环内（重复）声明：

```
for(int i=0; i < 1000; i++){
    double intermediateResult = i;
    System.out.println(intermediateResult);
} 
```

哪个更好，**a**还是**b**？

我怀疑重复的变量声明（示例**b ）***在理论上*会产生更多的开销，但是编译器足够聪明，所以没关系。示例**b**的优点是更紧凑，并将变量的范围限制在使用它的位置。尽管如此，我还是倾向于根据示例**a**编写代码。

***编辑：***我对 Java 案例特别感兴趣。

* * *

## 回答 #1

> 赞同：271
> 
> 时间：2009-01-02T16:18:10.217

哪个更好，**a**还是**b**？

从性能的角度来看，您必须对其进行衡量。（在我看来，如果你可以测量差异，编译器就不是很好）。

从维护的角度来看，**b**更好。在尽可能窄的范围内，在同一个地方声明和初始化变量。不要在声明和初始化之间留下一个空洞，也不要污染你不需要的命名空间。

* * *

## 回答 #2

> 赞同：227
> 
> 时间：2009-01-02T16:25:15.507

好吧，我分别运行了您的 A 和 B 示例 20 次，循环了 1 亿次。（JVM - 1.5.0）

A：平均执行时间：0.074 秒

B：平均执行时间：0.067 秒

令我惊讶的是，B 稍微快了一点。与计算机一样快，现在很难说你是否能准确地测量到这一点。我也会将其编码为 A 方式，但我会说这并不重要。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-01-02T16:16:53.200

这取决于语言和确切的用途。例如，在 C# 1 中它没有任何区别。在 C# 2 中，如果局部变量由匿名方法（或 C# 3 中的 lambda 表达式）捕获，它会产生非常显着的差异。

例子：

```
using System;
using System.Collections.Generic;

class Test
{
    static void Main()
    {
        List<Action> actions = new List<Action>();

        int outer;
        for (int i=0; i < 10; i++)
        {
            outer = i;
            int inner = i;
            actions.Add(() => Console.WriteLine("Inner={0}, Outer={1}", inner, outer));
        }

        foreach (Action action in actions)
        {
            action();
        }
    }
} 
```

输出：

```
Inner=0, Outer=9
Inner=1, Outer=9
Inner=2, Outer=9
Inner=3, Outer=9
Inner=4, Outer=9
Inner=5, Outer=9
Inner=6, Outer=9
Inner=7, Outer=9
Inner=8, Outer=9
Inner=9, Outer=9 
```

不同之处在于所有动作都捕获相同的`outer`变量，但每个动作都有自己独立的`inner`变量。

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2010-01-13T11:52:39.503

以下是我在 .NET 中编写和编译的内容。

```
double r0;
for (int i = 0; i < 1000; i++) {
    r0 = i*i;
    Console.WriteLine(r0);
}

for (int j = 0; j < 1000; j++) {
    double r1 = j*j;
    Console.WriteLine(r1);
} 
```

当[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)被渲染回代码时，这就是我从[.NET Reflector中得到的。](http://en.wikipedia.org/wiki/.NET_Reflector)

```
for (int i = 0; i < 0x3e8; i++)
{
    double r0 = i * i;
    Console.WriteLine(r0);
}
for (int j = 0; j < 0x3e8; j++)
{
    double r1 = j * j;
    Console.WriteLine(r1);
} 
```

所以编译后两者看起来完全一样。在托管语言中，代码被转换为 CL/字节代码，并在执行时被转换为机器语言。因此，在机器语言中，甚至可能不会在堆栈上创建双精度数。它可能只是一个寄存器，因为代码反映了它是`WriteLine`函数的临时变量。对于循环，有一整套优化规则。所以一般人不应该担心它，尤其是在托管语言中。`string a; a+=anotherstring[i]`在某些情况下，您可以优化管理代码，例如，如果您必须使用 just vs using连接大量字符串`StringBuilder`. 两者之间的性能差异很大。在很多这样的情况下，编译器无法优化您的代码，因为它无法确定更大范围内的意图。但它几乎可以为您优化基本的东西。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-01-02T16:20:15.550

这是 VB.NET 中的一个问题。Visual Basic 结果不会重新初始化此示例中的变量：

```
For i as Integer = 1 to 100
    Dim j as Integer
    Console.WriteLine(j)
    j = i
Next

' Output: 0 1 2 3 4... 
```

这将在第一次打印 0（声明时 Visual Basic 变量具有默认值！），但`i`此后每次。

但是，如果您添加一个`= 0`，您会得到预期的结果：

```
For i as Integer = 1 to 100
    Dim j as Integer = 0
    Console.WriteLine(j)
    j = i
Next

'Output: 0 0 0 0 0... 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-10-10T14:24:23.117

我做了一个简单的测试：

```
int b;
for (int i = 0; i < 10; i++) {
    b = i;
} 
```

对比

```
for (int i = 0; i < 10; i++) {
    int b = i;
} 
```

我用 gcc - 5.2.0 编译了这些代码。然后我反汇编了这两个代码的main()，结果是这样的：

1º：

```
 0x00000000004004b6 <+0>:     push   rbp
   0x00000000004004b7 <+1>:     mov    rbp,rsp
   0x00000000004004ba <+4>:     mov    DWORD PTR [rbp-0x4],0x0
   0x00000000004004c1 <+11>:    jmp    0x4004cd <main+23>
   0x00000000004004c3 <+13>:    mov    eax,DWORD PTR [rbp-0x4]
   0x00000000004004c6 <+16>:    mov    DWORD PTR [rbp-0x8],eax
   0x00000000004004c9 <+19>:    add    DWORD PTR [rbp-0x4],0x1
   0x00000000004004cd <+23>:    cmp    DWORD PTR [rbp-0x4],0x9
   0x00000000004004d1 <+27>:    jle    0x4004c3 <main+13>
   0x00000000004004d3 <+29>:    mov    eax,0x0
   0x00000000004004d8 <+34>:    pop    rbp
   0x00000000004004d9 <+35>:    ret 
```

对比

2º

```
 0x00000000004004b6 <+0>: push   rbp
   0x00000000004004b7 <+1>: mov    rbp,rsp
   0x00000000004004ba <+4>: mov    DWORD PTR [rbp-0x4],0x0
   0x00000000004004c1 <+11>:    jmp    0x4004cd <main+23>
   0x00000000004004c3 <+13>:    mov    eax,DWORD PTR [rbp-0x4]
   0x00000000004004c6 <+16>:    mov    DWORD PTR [rbp-0x8],eax
   0x00000000004004c9 <+19>:    add    DWORD PTR [rbp-0x4],0x1
   0x00000000004004cd <+23>:    cmp    DWORD PTR [rbp-0x4],0x9
   0x00000000004004d1 <+27>:    jle    0x4004c3 <main+13>
   0x00000000004004d3 <+29>:    mov    eax,0x0
   0x00000000004004d8 <+34>:    pop    rbp
   0x00000000004004d9 <+35>:    ret 
```

这与 asm 结果完全相同。不是证明这两个代码产生相同的东西吗？

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-01-02T16:11:26.957

它取决于语言 - IIRC C# 对此进行了优化，因此没有任何区别，但 JavaScript（例如）每次都会执行整个内存分配。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-01-02T16:18:13.650

我总是使用 A （而不是依赖编译器），也可能重写为：

```
for(int i=0, double intermediateResult=0; i<1000; i++){
    intermediateResult = i;
    System.out.println(intermediateResult);
} 
```

这仍然限制`intermediateResult`在循环的范围内，但不会在每次迭代期间重新声明。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-01-02T16:16:59.113

在我看来， b 是更好的结构。在 a 中，intermediateResult 的最后一个值在循环完成后仍然存在。

编辑：这与值类型没有太大区别，但引用类型可能有点重。就个人而言，我喜欢尽快取消引用变量以进行清理，而 b 会为你做这件事，

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-01-02T16:14:05.360

我怀疑一些编译器可以将两者优化为相同的代码，但肯定不是全部。所以我会说你最好选择前者。后者的唯一原因是如果您想确保声明的变量**仅**在循环中使用。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-01-02T16:15:15.387

作为一般规则，我在最内部的可能范围内声明我的变量。所以，如果你没有在循环之外使用intermediateResult，那么我会选择B。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-01-02T17:41:30.580

一位同事更喜欢第一种形式，告诉它​​是一种优化，更喜欢重用声明。

我更喜欢第二个（并试图说服我的同事！;-)），读过：

*   它将变量的范围缩小到需要它们的地方，这是一件好事。
*   Java 优化到足以在性能上没有显着差异。IIRC，也许第二种形式更快。

无论如何，它属于依赖编译器和/或 JVM 质量的过早优化类别。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2011-10-23T12:39:49.273

好吧，你总是可以为此做一个范围：

```
{ //Or if(true) if the language doesn't support making scopes like this
    double intermediateResult;
    for (int i=0; i<1000; i++) {
        intermediateResult = i;
        System.out.println(intermediateResult);
    }
} 
```

这样你只声明一次变量，当你离开循环时它就会死掉。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-11-07T21:15:13.193

如果您在 lambda 等中使用变量，则 C# 会有所不同。但一般来说，编译器基本上会做同样的事情，假设变量只在循环中使用。

鉴于它们基本相同：请注意，版本 b 使读者更清楚地知道该变量不是，也不能在循环之后使用。此外，**版本 b 更容易重构。在版本 a 中，将循环体提取到自己的方法中更加困难。**此外，版本 b 向您保证这种重构没有副作用。

因此，版本 a 让我烦恼不已，因为它没有任何好处，而且它使推理代码变得更加困难......

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-01-02T16:08:53.077

我认为这取决于编译器，很难给出一般性答案。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-01-16T06:01:16.510

我一直认为，如果您在循环中声明变量，那么您就是在浪费内存。如果你有这样的事情：

```
for(;;) {
  Object o = new Object();
} 
```

那么不仅需要为每次迭代创建对象，而且需要为每个对象分配一个新的引用。似乎如果垃圾收集器很慢，那么您将有一堆需要清理的悬空引用。

但是，如果你有这个：

```
Object o;
for(;;) {
  o = new Object();
} 
```

然后，您每次只创建一个引用并为其分配一个新对象。当然，它可能需要更长的时间才能超出范围，但是只有一个悬空引用需要处理。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-02-05T06:03:24.560

我的做法如下：

*   如果变量的类型很简单*（int、double、...），*我更喜欢变体**b**（内部）。
    *原因：*缩小变量范围。

*   如果变量的类型不简单*（某种`class`或`struct`）*，我更喜欢变体**a**（外部）。
    *原因：*减少 ctor-dtor 调用次数。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2019-02-09T09:18:49.990

很长一段时间我都有同样的问题。所以我测试了一段更简单的代码。

**结论：**对于**这种情况**，**没有**性能差异。

**外循环案例**

```
int intermediateResult;
for(int i=0; i < 1000; i++){
    intermediateResult = i+2;
    System.out.println(intermediateResult);
} 
```

**内循环案例**

```
for(int i=0; i < 1000; i++){
    int intermediateResult = i+2;
    System.out.println(intermediateResult);
} 
```

我在 IntelliJ 的反编译器上检查了编译文件，对于这两种情况，我得到了**相同的结果** `Test.class`

```
for(int i = 0; i < 1000; ++i) {
    int intermediateResult = i + 2;
    System.out.println(intermediateResult);
} 
```

我还使用此[答案](https://stackoverflow.com/a/30928846/7588896)中给出的方法对这两种情况的代码进行了反汇编。我将只显示与答案相关的部分

**外循环案例**

```
Code:
  stack=2, locals=3, args_size=1
     0: iconst_0
     1: istore_2
     2: iload_2
     3: sipush        1000
     6: if_icmpge     26
     9: iload_2
    10: iconst_2
    11: iadd
    12: istore_1
    13: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
    16: iload_1
    17: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V
    20: iinc          2, 1
    23: goto          2
    26: return
LocalVariableTable:
        Start  Length  Slot  Name   Signature
           13      13     1 intermediateResult   I
            2      24     2     i   I
            0      27     0  args   [Ljava/lang/String; 
```

**内循环案例**

```
Code:
      stack=2, locals=3, args_size=1
         0: iconst_0
         1: istore_1
         2: iload_1
         3: sipush        1000
         6: if_icmpge     26
         9: iload_1
        10: iconst_2
        11: iadd
        12: istore_2
        13: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
        16: iload_2
        17: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V
        20: iinc          1, 1
        23: goto          2
        26: return
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
           13       7     2 intermediateResult   I
            2      24     1     i   I
            0      27     0  args   [Ljava/lang/String; 
```

如果您密切注意，只有`Slot`分配到`i`和`intermediateResult`输入`LocalVariableTable`被交换为它们出现顺序的产物。插槽的相同差异反映在其他代码行中。

*   没有执行额外的操作
*   `intermediateResult`在这两种情况下仍然是局部变量，因此访问时间没有差异。

**奖金**

编译器进行了大量优化，看看在这种情况下会发生什么。

**零工作案例**

```
for(int i=0; i < 1000; i++){
    int intermediateResult = i;
    System.out.println(intermediateResult);
} 
```

**零工作反编译**

```
for(int i = 0; i < 1000; ++i) {
    System.out.println(i);
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-04-20T12:29:41.780

从性能的角度来看，外部（好多）更好。

```
public static void outside() {
    double intermediateResult;
    for(int i=0; i < Integer.MAX_VALUE; i++){
        intermediateResult = i;
    }
}

public static void inside() {
    for(int i=0; i < Integer.MAX_VALUE; i++){
        double intermediateResult = i;
    }
} 
```

我分别执行了这两个函数 10 亿次。outside() 花费了 65 毫秒。inside() 花了 1.5 秒。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-04-04T20:32:19.887

如果有人感兴趣，我用 Node 4.0.0 测试了 JS。在循环外声明导致平均超过 1000 次试验的性能提高约 0.5 毫秒，每次试验有 1 亿次循环迭代。所以我会说继续以最易读/可维护的方式编写它，即 B，imo。我会把我的代码放在一个小提琴中，但我使用了性能-now Node 模块。这是代码：

```
var now = require("../node_modules/performance-now")

// declare vars inside loop
function varInside(){
    for(var i = 0; i < 100000000; i++){
        var temp = i;
        var temp2 = i + 1;
        var temp3 = i + 2;
    }
}

// declare vars outside loop
function varOutside(){
    var temp;
    var temp2;
    var temp3;
    for(var i = 0; i < 100000000; i++){
        temp = i
        temp2 = i + 1
        temp3 = i + 2
    }
}

// for computing average execution times
var insideAvg = 0;
var outsideAvg = 0;

// run varInside a million times and average execution times
for(var i = 0; i < 1000; i++){
    var start = now()
    varInside()
    var end = now()
    insideAvg = (insideAvg + (end-start)) / 2
}

// run varOutside a million times and average execution times
for(var i = 0; i < 1000; i++){
    var start = now()
    varOutside()
    var end = now()
    outsideAvg = (outsideAvg + (end-start)) / 2
}

console.log('declared inside loop', insideAvg)
console.log('declared outside loop', outsideAvg) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-05-11T14:28:54.897

A) 比 B) 更安全............想象一下，如果你在循环中初始化结构而不是“int”或“float”，那会怎样？

像

```
typedef struct loop_example{

JXTZ hi; // where JXTZ could be another type...say closed source lib 
         // you include in Makefile

}loop_example_struct;

//then....

int j = 0; // declare here or face c99 error if in loop - depends on compiler setting

for ( ;j++; )
{
   loop_example loop_object; // guess the result in memory heap?
} 
```

你肯定会面临内存泄漏的问题！因此，我相信“A”是更安全的选择，而“B”容易受到内存积累的影响，尤其是在使用封闭源代码库时。您可以在 Linux 上使用“Valgrind”工具特别是子工具“Helgrind”进行检查。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-03-06T03:38:12.987

这是一个有趣的问题。根据我的经验，当你为代码辩论这个问题时，需要考虑一个终极问题：

**有什么理由为什么变量需要是全局的？**

全局只声明一次变量而不是在本地声明多次是有意义的，因为它更适合组织代码并且需要更少的代码行。但是，如果它只需要在一个方法中本地声明，我会在该方法中对其进行初始化，因此很明显该变量与该方法完全相关。如果您选择后一种选项，请注意不要在初始化它的方法之外调用此变量——您的代码将不知道您在说什么，并且会报告错误。

另外，作为旁注，不要在不同方法之间重复局部变量名称，即使它们的目的几乎相同；它只是变得混乱。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-07-13T11:06:52.990

这是更好的形式

```
double intermediateResult;
int i = byte.MinValue;

for(; i < 1000; i++)
{
intermediateResult = i;
System.out.println(intermediateResult);
} 
```

1）以这种方式声明一次时间两个变量，而不是每个循环。2）分配它比所有其他选项更胖。3）因此最佳实践规则是迭代之外的任何声明。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-02-19T05:25:25.407

在 Go 中尝试了同样的事情，并使用`go tool compile -S`go 1.9.4比较了编译器输出

零差异，根据汇编程序的输出。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-04-15T16:04:36.310

当我想在退出循环后查看变量的内容时，我使用 (A)。它只对调试很重要。当我希望代码更紧凑时，我使用 (B)，因为它节省了一行代码。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2009-01-02T16:13:07.390

即使我知道我的编译器足够聪明，我也不喜欢依赖它，并且会使用 a) 变体。

*只有当您迫切需要在循环体之后使middleResult*不可用时，b) 变体才对我有意义。但无论如何，我无法想象这种绝望的情况......

编辑：**Jon Skeet**提出了一个很好的观点，表明循环内的变量声明可以产生实际的语义差异。

# php - 相当于 PHP 的 preg_replace 的 JavaScript

> ID：407256
> 
> 赞同：75
> 
> 时间：2009-01-02T16:06:48.570
> 
> 标签：php, javascript, regex

我正在使用一个简单的正则表达式用换行符替换中断标签：

```
br_regex = /<br>/;
input_content = input_content.replace(br_regex, "\n"); 
```

这仅替换了中断标记的第一个实例，但我需要全部替换。`preg_match_all()`会在 PHP 中做到这一点，但我想知道 JavaScript 的等价物。

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2009-01-02T16:08:48.397

使用全局标志，`g`：

```
foo.replace(/<br>/g,"\n") 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-02T23:37:48.223

非正则表达式全局替换的 JS 成语：

```
input_content.split('<br>').join('\n') 
```

# php - 如何为“其他 - 请指定”制作单选按钮？

> ID：407272
> 
> 赞同：7
> 
> 时间：2009-01-02T16:10:06.053
> 
> 标签：php, html, forms, radio-button

我正在创建一个带有一些单选按钮选项的 HTML 表单。我希望有一个选项为“其他 - 请指定”并允许用户输入内容。

两个问题：

1）如何制作“混合”输入类型`radio/text`？

2) 在 PHP 后端，如果输入`name`与单选输入具有相同的属性，那么用户的输入是否会属于同一个数组？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-02T16:16:36.260

为什么不向输入添加不同的*名称属性，并且仅在选择了**其他*单选按钮时才验证它？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-14T20:20:59.893

我是这样做的：

```
<input type="radio" name="phone" value="313-375-2151">Taylor <br>
<input type="radio" name="phone" value="555-444-1234">OverheadHts <br>
<input type="radio" name="phone" value="555-333-1234">Smith Ctr <br>
<input type="radio" name="phone" value="444-344-1234">Mainsville<br>
<input type="radio" name="phone" value="other">Other:
    <input type="text" name="phone-other" size="14"> 
```

然后当您处理表单时：

```
$phone = mysql_real_escape_string($_POST['phone']);
if ($phone =='other'){
  $phone = mysql_real_escape_string($_POST['phone-other']);
} 
```

等等

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-02T16:41:37.847

#1：在“其他：”单选字段中，添加一个`<input type="text" ...>`带有样式的 display:none，并且仅在用户选择“其他：”单选字段时显示。

但是，我不完全确定#2 是否可行。您`rboption=other`将从单选按钮和`rboption=some%20text`文本字段中获得。一个通常会覆盖另一个，但不确定是哪个（阅读：取决于页面中的位置、浏览器和月相）。
可以肯定的是，使文本字段名称不同，并且仅在`rboption == 'other'`（如 Salty 所说）时处理它

# bash - 一次性填充文件中的占位符

> ID：407279
> 
> 赞同：6
> 
> 时间：2009-01-02T16:11:41.587
> 
> 标签：bash, replace, sed, awk, textutils

我有一个带有占位符字符串的骨架文本文件：

```
blah blah blah
blah $PLACEHOLDER_1$
blah
$PLACEHOLDER_2$ 
```

等等。占位符的特定“形式”无关紧要——我可以将它们更改为最适合特定实现的任何形式。

我有一个 bash 脚本，我知道占位符的值，我需要生成一个新文件，将占位符替换为值。

```
#! /bin/sh
PLACEHOLDER_1 = 'string 1'
PLACEHOLDER_2 = 'multiline 
string 
2'
# TODO: Generate file output.txt from file output.template 
#       using placeholders above. 
```

我可以使用 sed 多次执行此操作，但这并不有趣。我**不想**使用 Perl。我只想使用 textutils 和 bash 本身。

一次性完成我想做的事情的最佳方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-29T05:37:55.867

这是一种不使用 sed 的方法：

首先，一个稍微修改的模板文件，其中占位符是 bash 变量：

```
blah blah blah
blah $PLACEHOLDER_1
blah
$PLACEHOLDER_2 
```

和脚本：

```
#! /bin/sh
templatefile=output.template
outputfile=output.txt

PLACEHOLDER_1='string 1'

PLACEHOLDER_2='multiline 
string 
2'

# DONE: Generate file output.txt from file output.template 
#       using placeholders above.

echo "$(eval "echo \"$(cat $templatefile)\"")" > $outputfile 
```

这是一个演示脚本中包含的模板的版本，但有所不同。它还演示了默认值，也可以在模板文件版本中使用，此外您还可以在模板中进行数学运算：

```
#! /bin/sh
template='blah blah blah
blah $PLACEHOLDER_1
blah
${PLACEHOLDER_2:-"some text"} blah ${PLACEHOLDER_3:-"some
lines
of
text"} and the total is: $((${VAL_1:-0} + ${VAL_2:-0}))'
# default operands to zero (or 1) to prevent errors due to unset variables
outputfile=output.txt

# gears spin, bells ding, values for placeholders are computed

PLACEHOLDER_1='string 1'

PLACEHOLDER_2='multiline 
string 
2'

VAL_1=2

VAL_2=4

unset PLACEHOLDER_3 # so we can trigger one of the defaults

# Generate file output.txt from variable $template 
#       using placeholders above.

echo "$(eval "echo \"$template\"")" > $outputfile 
```

没有 sed，没有循环，只有毛茸茸的嵌套和引号。我很确定所有引用都会保护您免受模板文件中的恶意内容的侵害，但我不保证这一点。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-02T16:22:14.610

您仍然可以使用 sed 一次性完成替换。您只需要在一个命令中指定所有替换。

例如。

```
sed -i 's/PLACEHOLDER_1/string 1/g;s/PLACEHOLDER_2/string 2/g' <file> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T17:28:15.600

基于上一个答案，也许使用数组并计算 sed 字符串？

```
#!/bin/sh
PLACEHOLDER[0]='string 1'
PLACEHOLDER[1]='multiline 
string 
2'

s="sed -i "
for(( i=0 ; i<${#PLACEHOLDER[*]} ; i++ )) ; do 
    echo ${PLACEHOLDER[$i]}
    s=$s"s/PLACEHOLDER_$i/${PLACEHOLDER[$i]}/g;"
done
echo $s 
```

不过，似乎在多行字符串上失败了。

我不知道 Bash 数组的可移植性如何。以上代码段使用“GNU bash，版本 3.2.17(1)-release (i386-apple-darwin9.0)”测试

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-26T15:51:53.450

我的 bash 唯一解决方案：

```
TEMPLATE='
foo
$var1
bar
$var2'
eval "echo \"$TEMPLATE\"" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-03-31T20:54:37.603

我只是偶然发现了这个问题，因为我只是在寻找完全相同的问题，然后我找到了`envsubst(1)`.

如果您不介意使用环境变量，可以使用*envsubst ：*

```
PLACEHOLDER_1='string 1' PLACEHOLDER_2='multiline 
string 
2' envsubst < output.template 
```

如果您有很多变量，您可以将它们存储在一个文件中，并且只是`source`它（记住`export`在源文件的末尾使用！）

# javascript - AJAX - 重新加载网页的一部分而不使用单独的文件来加载

> ID：407287
> 
> 赞同：1
> 
> 时间：2009-01-02T16:14:54.623
> 
> 标签：javascript, jquery, ajax, xmlhttprequest, httprequest

标题可能有点混乱，所以让我解释一下。

我有一个网站，它有一个侧面板，其中包含有关用户的信息、用户可以做的事情等。当用户没有登录时，这个侧面板成为登录或注册的区域。

代码是：

```
<?php
if($user->loggedIn)
{
?>
<!-- side-panel for logged in users here -->
<?php
}
else
{
?>
<!-- login/registration etc -->
<?php
}
?> 
```

我想要做的是在用户单击使用 AJAX 登录时再次加载这段代码，并使用 jQuery 效果（可能是淡入淡出）使侧面板从登录/注册顺利过渡到闪亮的用户专用面板。

我知道如果我将该代码放在另一个文件中，并通过 AJAX 将其加载到侧面板的 div 中，我可以做到这一点......但我宁愿不为侧面板制作单独的文件。这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T16:18:14.710

您可以使用 AJAX 请求加载页面，然后删除侧面板以外的数据，但重点是什么？您最好的选择是将侧面板简单地分离到自己的文件中。

哦，这也被认为是正确的做法，因此您可以编辑侧边栏而无需编辑它所在的页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T16:23:40.427

如果我完全理解您的需求，您可以尝试这种方式：

```
$.ajax({
    type: "GET",
    url: "url", // replace 'url' with your url
    cache: false,
    success: function(data){
        alert($(data).find('#sidebar').html());
    }
}); 
```

也许可以与 $.load() 或 $.get() 一起使用，不知道。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T16:24:10.597

您为什么反对将侧面板保存在自己的文件中？使事情更加模块化和有条理。

如果您真的反对将内容保存在文件中，您可以将内容放入数据库并在进行 AJAX 调用时查询它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T16:29:05.483

假设您将通过另一个调用获取实际的用户数据，您可以使用两个 div。包含用户面板 html 的 div 开始隐藏。成功登录后，隐藏登录 div 并显示用户面板 div。使用来自 AJAX 登录的数据，填写面板自定义信息。我假设 AJAX 登录调用将返回必要的信息来填写用户名和他们可以做什么。这样做只是为了让您不必为整个用户面板拉入 html。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T16:32:09.457

您能否将查询字符串参数传递给页面，然后基于该参数仅对页面进行部分渲染（仅侧边栏）？然后只需使用您的普通 jquery/ajax 方法并包含查询字符串参数。

```
$.ajax(function(){
    url: MyPage.php?sidebar_only=true
    ect...
}) 
```

# .net - 在一台机器上运行多个版本的 .net

> ID：407306
> 
> 赞同：4
> 
> 时间：2009-01-02T16:20:35.470
> 
> 标签：.net, asp.net, iis

我很好奇.net 的各种版本。我们有一个开发各种版本（1.1 和 2.0）的应用程序的环境。现在，我正在尝试在 3.5 中进行开发。最大的问题是这些版本在同一个 IIS 安装上是否能很好地协同工作。另一个需要注意的是，我正在使用 Visual Studio 2005 和 IIS 5.0 在 Windows XP 上进行开发。这些应用程序将在 Windows Server 2003 上运行并使用 IIS 6.0。从我所见，看起来每个 IIS 虚拟目录都可以设置自己特定的 .net 版本。这难道不应该足以使使用不同 .Net 版本的不同应用程序不会相互影响吗？

我会接受我能得到的任何答案，但是如果您可以直接从 Microsoft 的一些文档中引用您的答案，那将非常有帮助（可以说，我的公司非常重视“直接从小时的嘴里听到它”）。也就是说，我真的会在这里接受任何答案。来自沟渠的故事也很受欢迎。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T16:25:15.507

托管 v.1.1 和 v.2.0 及更高版本的应用程序时遇到的最大问题是您需要两个应用程序池。

一个用于 v.1.1 网站，另一个用于 v.2.0 和更高版本的站点。

据您所知，.Net 3.0 和 3.5 都是 .Net 2.0 的超集，基本上是运行时的附加组件。尽管主机仍然需要安装它们。对于所有 .Net 2.0 和更高版本的 Web 应用程序，只需在主机服务器上安装最新的 .Net 3.5 SP1 运行时。

使用 IIS 6.0 和更高版本，您可以访问应用程序池，而 IIS 5.0 不会公开这一点。

我建议将您的开发环境切换到 Win 2k3 或 Vista (IIS 7.0)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T16:57:53.010

除了汤姆安德森的回答，您提到您的开发环境是 XP (IIS 5.0) 上的 Visual Studio 2005。请务必注意，无法从 Visual Studio 2005 开发 .NET 3.5。您需要升级到 Visual Studio 2008。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T16:23:55.947

在 Windows 2003 上，您不能在一个应用程序池内的不同版本的框架上运行应用程序。您必须为每个应用程序或至少每个框架版本创建单独的应用程序池。

顺便说一句：创建单独的应用程序池是一件好事，并为您带来一些其他优势，例如应用程序彼此隔离，您可以设置每个应用程序的性能设置（内存、回收等）等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T16:51:45.097

您应该考虑在不同的[虚拟机](http://www.microsoft.com/windows/downloads/virtualpc/default.mspx)上运行不同的版本。

# c# - 如何使用 C# 从用户名获取存储在 Active Directory 中的真实姓名？

> ID：407314
> 
> 赞同：3
> 
> 时间：2009-01-02T16:23:36.430
> 
> 标签：c#, active-directory, ldap

我想为人们创建一个快速应用程序，以从一组凭据中解析存储在 Active Directory 中的用户名。某些应用程序仅提供用户 ID，并且期望最终用户启动 Active Directory 用户和组 MMC 管理单元太过分了。

输入类似于“MYCORP\a_user”，输出将是“Dave Smith”，如果这是存储在 AD 中的内容。

我希望它能够在我的测试域以及多林环境中运行。

有人可以提供这样做的样本吗？从 AD 中检索其他属性（例如电话号码）是否遵循相同的模式？

目标平台：.NET 2.0 及以上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T16:55:14.607

这是我使用的代码，取自我的身份验证类：

```
string[] strUserName = username.Split("\\".ToCharArray());
using (var entry = new DirectoryEntry("LDAP://" + ADServer, ADServiceDomain + "\\" + ADServiceAccount, ADServicePassword))
using (var ds = new DirectorySearcher(entry, "sAMAccountName=" + strUserName[1])) {
  ds.SearchScope = SearchScope.Subtree;
  SearchResult result = ds.FindOne();
  string fullname = result.Properties["displayName"][0].ToString();
} 
```

* * *

System.DirectoryServices 很烂。如您所见，即使是最基本的事情也需要大量的代码。我希望看到一种不需要使用异常进行流控制的用户身份验证方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T18:24:04.147

在 C# 中使用 Active Directory 有点痛苦，当然 3.5 添加了一些新的类来提供帮助，但是为了纯粹的生产力，我喜欢使用 Powershell 和 Quest 的免费[PowerShell 命令用于 Active Directory](http://www.quest.com/powershell/activeroles-server.aspx) ，在这种情况下，代码看起来像

```
get-qaduser userid | select PhoneNumber,DisplayName 
```

如果您需要它作为 C# 程序的一部分运行，您也可以这样做

```
 public static IEnumerable<PSObject> Invoke(string script, params object[] input)
    {
        IList errors = null;
        using (var run = new RunspaceInvoke())
        {
            var psResults = run.Invoke(script, input, out errors);
            if (errors != null && errors.Count > 0)
                Debug.WriteLine(errors.Count);
            foreach (PSObject res in psResults)
                yield return res;
        }
    }
    PSObject psUser = POSHelp.Invoke(
        @"add-pssnapin Quest.ActiveRoles.ADManagement
        ($userid) = $input | % { $_ }
        get-qaduser $userid", "auserid").Single();
     Debug.WriteLine(psUser.Properties["DisplayName"].Value); 
```

将引用添加到 Program Files\Reference Assemblies\Microsoft\WindowsPowerShell\v1.0\System.Management.Automation.dll

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T16:42:45.677

请参阅[DirectorySearcher](http://msdn.microsoft.com/en-us/library/system.directoryservices.directorysearcher.aspx)，加载属性“DisplayName”。

# sql - 奇怪的SQL2005问题。“SqlConnection 不支持并行事务”

> ID：407320
> 
> 赞同：3
> 
> 时间：2009-01-02T16:24:23.153
> 
> 标签：sql, transactions

我有一个问题，似乎是死锁情况的结果。他现在正在寻找问题的根源，但同时我们想重新启动服务器并让客户继续前进。

现在每次我们启动程序时，它只会说“SqlConnection 不支持并行事务”。我们没有更改程序中的任何内容，它已编译并在客户服务器上，但在“可能的死锁”情况下它想再次上线。

我们有 7 个客户端（计算机）运行该程序，每个客户端都与本地服务器上的 Web 服务通信，而 Web 服务正在与 sql-server（与 Web 服务器相同的机器）通信。

我们已经重新启动了 sql-server 和 iis-server，但没有重新启动服务器，因为服务器上正在运行其他重要服务，所以这是我们做的最后一件事。我们可以在管理选项卡中看到没有锁或任何东西。

所以我的问题是，为什么“SqlConnection 不支持并行事务”错误从一个时间传到另一个而不改变程序中的任何内容，并且它仍然存在于 sql-restart 之间。

似乎它发生在程序启动时执行的第一个 db-request 中。

如果您需要更多信息，请询问。我很困惑...

**更多信息：** 我认为我没有“长时间”运行的交易。这种情况通常是我有一个包含 20-100 行 (ContractRows) 的数据集，我将在 tableAdapter 上执行 .Update。我还循环遍历这 20-100 行，其中一些会创建 ad-hook-sql-querys（例如，如果租用的产品被标记为已返回，我会创建一个 sql-query 以将产品标记为在数据库中返回）

所以我这样做非常简化：

```
Create objTransactionObject
Create objtableadapter (objTransactionObject)
for each row in contractDS.contractrows
  if row.isreturned then
    strSQL &= "update product set instock=1 where prodid=" & row.productid & vbcrlf
 End if
next
objtableadapter.update(contractDS)
objData.ExecuteQuery(strSQL, objTransactionObject)    
if succsesfull 
  objtransactionobject.commit
else
  objtransactionobject.rollback
end if
objTran.Dispose() 
```

然后我根据它是否顺利进行提交或回滚。

编辑：没有一个答案可以解决问题，但我会感谢您提供良好的故障排除指针。

“SqlConnection 不支持并行事务”突然消失了，现在 sql-server 每天只“掉线”4-5 次，我想这是一个死锁，但我没有正确的知识去找出并且很短目前可以为我监控的 sql 专家。我只是重新启动 sql-server，一切都恢复正常了。10 次中的 1 次我还必须重新启动计算机。它真的困扰着我（当然还有我的客户）。

任何认识瑞典（或世界各地，英语）的人在分析死锁或其他 sql 问题方面有**很好的知识的人都可以与我联系。**我知道这不是一个联系网站，但我想问这个问题，因为我已经没有选择了，我花了 3 天三夜优化客户，以确保我们关闭连接并且不要在那里做太多愚蠢的事情. 没有运气。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-11T01:58:34.917

似乎您正在共享连接并在同一个打开的连接上创建新事务（这是您看到的异常的并行部分）。

您的示例似乎支持这一点，因为您没有提及如何获得其中的连接。

您应该检查您的代码，并确保您只打开一个连接，然后在完成后处理它（并且无论如何，使用 using 语句来确保您关闭连接），看起来就像你在某处留下一个敞开的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T16:37:15.967

你的问题似乎不是一个不寻常的问题。当我将您的错误字符串粘贴到查询框中时，Google 发现了很多命中。

阅读过去的答案，听起来这与不正确地交错事务或隔离级别有关。

连接保持打开多长时间？你有长期交易吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-02T17:10:01.097

您是否在某处打开了[隐式事务](http://msdn.microsoft.com/en-us/library/ms188317.aspx)，因此有些事务是您意想不到的？您是否打开了活动监视器以查看是否有任何意外事务？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T00:56:11.293

您是否尝试过备份事务日志？如果我正确地记得以前的类似经历，那也可能会清除它。

# windows-services - 由于闰年，.NET 1.1 Windows 服务无法启动

> ID：407336
> 
> 赞同：1
> 
> 时间：2009-01-02T16:31:32.187
> 
> 标签：windows-services

我们有一些用 .net framework 1.1 编写的后端 Windows 服务正在运行，并且在 2008 年 12 月 31 日下午 5 点左右（美国东部标准时间）我们停止了这些服务以运行一些年终报告。在报告运行后，我们尝试启动服务和当我们尝试时，它会给出一个错误“服务没有及时启动”。我们尝试了谷歌想出的所有可能的东西。Service Packs、WinDbg、GFlags 等。

最后，我们在晚上 10.30 左右致电 Microsoft 支持（我们与 Microsoft 签订了高级支持合同），他们开始收集各种服务器数据，并在上午 12.05（美国东部标准时间）左右成功启动服务，没有任何问题。我们没有做任何不同或特别是开始它。整个团队对正在发生的事情感到困惑，并且同样很高兴它正在工作。

结论是微软支持团队认为这很可能与 .NET Framework 1.1 命名空间 System.ServiceProcess.ServiceBase 无法支持闰年有关。他们尚未确认这一点，仍在调查中。

当我有来自 MSFT 支持的更新时，我会继续发布。我计划在 2009 年开始一个可怕的开始，但很高兴这一切都结束了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-02T16:47:47.163

我想知道这个错误是否与导致 Zune 30GB 在闰年的 12 月 31 日锁定的错误有关：它在一个地方测试 day>365，在另一个地方测试 day>366，结果当 day=366 它失败了第二个测试并进入无限循环。

# c# - .NET - 获取反映的 PropertyInfo 的默认值

> ID：407337
> 
> 赞同：65
> 
> 时间：2009-01-02T16:32:01.250
> 
> 标签：c#, .net, reflection

这真的让我今天很难过。我确信它并不难，但我有一个 System.Reflection.PropertyInfo 对象。我想根据数据库查找的结果设置它的值（想想 ORM，将列映射回属性）。

我的问题是如果数据库返回值为DBNull，我只想将属性值设置为默认值，与调用相同：

```
value = default(T);  // where T is the type of the property. 
```

但是，如果你给它一个类型，default() 方法将不会编译，这就是我所拥有的：

```
object myObj = ???; // doesn't really matter. some arbitrary class.
PropertyInfo myPropInf = ???; // the reflection data for a property on the myObj object.
myPropInf.SetValue(myObj, default(myPropInf.PropertyType), null); 
```

以上不编译。默认（类型）无效。我也想过做：

```
object myObj = ???;
PropertyInfo myPropInf = ???;
myPropInf.SetValue(myObj, Activator.CreateInstance(myPropInf.PropertyType), null); 
```

但是，如果类型是字符串，那将分配值“new String()”，但我真的想要“null”，这就是“default(string)”将返回的值。

那么我在这里错过了什么？我想一个非常老套的方法是创建一个 myObj 类型的新实例并将属性复制过来，但这似乎很愚蠢......

```
object myObj = ???;
PropertyInfo  myPropInf = ???;
var blank = Activator.CreateInstance(myObj.GetType());
object defaultValue = myPropInf.GetValue(blank, null);
myPropInf.SetValue(myObj, defaultValue, null); 
```

我宁愿不浪费内存来创建一个全新的实例，只是为了获得该属性的默认值。显得非常浪费。

有任何想法吗？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-01-02T16:43:12.600

我相信如果你这样做

```
prop.SetValue(obj,null,null); 
```

如果是值类型，则将其设置为默认值，如果是引用类型，则将其设置为空。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-01-02T16:37:30.897

```
object defaultValue = type.IsValueType ? Activator.CreateInstance(type) : null; 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-01-03T10:37:54.383

“null”技巧会将其设置为类型的**零**值，这不一定与属性的默认值相同。首先，如果它是一个新对象，为什么不把它放在一边呢？或者，使用`TypeDescriptor`：

```
PropertyDescriptor prop = TypeDescriptor.GetProperties(foo)["Bar"];
if (prop.CanResetValue(foo)) prop.ResetValue(foo); 
```

这既尊重模式`[DefaultValue]`又尊重`Reset{name}()` 模式（如绑定和序列化所使用的），使其非常通用且可重用。

如果你做了很多这样的事情，你还可以`TypeDescriptor`通过重新使用`PropertyDescriptorCollection`和使用[HyperDescriptor](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)（相同的代码，但比反射或 raw 快得多**）**`TypeDescriptor`来获得性能提升，而不是反射。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-10-23T21:42:36.520

尝试以下方法，我已经编写并针对数千种类型进行了测试：

```
 /// <summary>
    /// [ <c>public static T GetDefault&lt; T &gt;()</c> ]
    /// <para></para>
    /// Retrieves the default value for a given Type
    /// </summary>
    /// <typeparam name="T">The Type for which to get the default value</typeparam>
    /// <returns>The default value for Type T</returns>
    /// <remarks>
    /// If a reference Type or a System.Void Type is supplied, this method always returns null.  If a value type 
    /// is supplied which is not publicly visible or which contains generic parameters, this method will fail with an 
    /// exception.
    /// </remarks>
    /// <seealso cref="GetDefault(Type)"/>
    public static T GetDefault<T>()
    {
        return (T) GetDefault(typeof(T));
    }

    /// <summary>
    /// [ <c>public static object GetDefault(Type type)</c> ]
    /// <para></para>
    /// Retrieves the default value for a given Type
    /// </summary>
    /// <param name="type">The Type for which to get the default value</param>
    /// <returns>The default value for <paramref name="type"/></returns>
    /// <remarks>
    /// If a null Type, a reference Type, or a System.Void Type is supplied, this method always returns null.  If a value type 
    /// is supplied which is not publicly visible or which contains generic parameters, this method will fail with an 
    /// exception.
    /// </remarks>
    /// <seealso cref="GetDefault&lt;T&gt;"/>
    public static object GetDefault(Type type)
    {
        // If no Type was supplied, if the Type was a reference type, or if the Type was a System.Void, return null
        if (type == null || !type.IsValueType || type == typeof(void))
            return null;

        // If the supplied Type has generic parameters, its default value cannot be determined
        if (type.ContainsGenericParameters)
            throw new ArgumentException(
                "{" + MethodInfo.GetCurrentMethod() + "} Error:\n\nThe supplied value type <" + type +
                "> contains generic parameters, so the default value cannot be retrieved");

        // If the Type is a primitive type, or if it is another publicly-visible value type (i.e. struct), return a 
        //  default instance of the value type
        if (type.IsPrimitive || !type.IsNotPublic)
        {
            try
            {
                return Activator.CreateInstance(type);
            }
            catch (Exception e)
            {
                throw new ArgumentException(
                    "{" + MethodInfo.GetCurrentMethod() + "} Error:\n\nThe Activator.CreateInstance method could not " +
                    "create a default instance of the supplied value type <" + type +
                    "> (Inner Exception message: \"" + e.Message + "\")", e);
            }
        }

        // Fail with exception
        throw new ArgumentException("{" + MethodInfo.GetCurrentMethod() + "} Error:\n\nThe supplied value type <" + type + 
            "> is not a publicly-visible type, so the default value cannot be retrieved");
    } 
```

GetDefault 的第一个（通用）版本对于 C# 来说当然是多余的，因为您可以只使用 default(T) 关键字。

享受！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-04-03T18:12:54.397

我知道这是一篇旧帖子，但我喜欢 Darin Dimitrov 的回答。它首先检查任何 DefualtValue 属性，然后使用[Darin Dimitrov 的答案](https://stackoverflow.com/a/407345/7446265)：

```
public static object GetDefaultValueForProperty(this PropertyInfo property)
    {
        var defaultAttr = property.GetCustomAttribute(typeof(DefaultValueAttribute));
        if (defaultAttr != null)
            return (defaultAttr as DefaultValueAttribute).Value;

        var propertyType = property.PropertyType;
        return propertyType.IsValueType ? Activator.CreateInstance(propertyType) : null;
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-23T15:28:16.110

这是一个更完善的版本，它在不添加任何不必要的自定义代码的情况下维护了 .NET 运行时的功能。

注意：此代码为 .NET 3.5 SP1 编写

```
namespace System {

public static class TypedDefaultExtensions {

    public static object ToDefault(this Type targetType) {

        if (targetType == null)
            throw new NullReferenceException();

        var mi = typeof(TypedDefaultExtensions)
            .GetMethod("_ToDefaultHelper", Reflection.BindingFlags.Static | Reflection.BindingFlags.NonPublic);

        var generic = mi.MakeGenericMethod(targetType);

        var returnValue = generic.Invoke(null, new object[0]);
        return returnValue;
    }

    static T _ToDefaultHelper<T>() {
        return default(T);
    }
} 
```

}

用法：

```
PropertyInfo pi; // set to some property info
object defaultValue = pi.PropertyType.ToDefault();

public struct MyTypeValue { public int SomeIntProperty { get; set; }
var reflectedType = typeof(MyTypeValue);
object defaultValue2 = reflectedType.ToDefault(); 
```

拉沙德·里维拉 (OmegusPrime.com)

# plugins - 用于图形覆盖插件 (IE) 的 applet 或 activex？

> ID：407342
> 
> 赞同：0
> 
> 时间：2009-01-02T16:34:40.747
> 
> 标签：plugins, activex, applet

我正在寻找为 IE 编写一个插件，它将对任何网页进行一点解析，并在该页面顶部显示一个我的用户可以与之交互的图层（分析热图可能是我最接近的例子）。我正在尝试决定是否应该将其编写为 Applet（我倾向于）或 ActiveX 控件？

此外，任何能够向我介绍基本示例的人也会很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T16:45:46.903

当您以 IE 为目标时，您可能还想看看 BHO（浏览器帮助对象）：

[http://msdn.microsoft.com/en-us/library/bb250436.aspx](http://msdn.microsoft.com/en-us/library/bb250436.aspx)

# java - Swing 应用程序在哪里使用？

> ID：407343
> 
> 赞同：17
> 
> 时间：2009-01-02T16:35:53.973
> 
> 标签：java, swing

现在真的在使用 Swing 应用程序吗？我找不到使用它们的地方。跳过 AWT 和 Swing 包可以吗（虽然我学到了一些基础知识）？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-02T17:51:09.203

如果您专门为网络写作，您可能可以跳过 Swing，但否则您绝对会遇到它。我从来没有在没有 Swing GUI 的情况下开发过不平凡的 Java 应用程序。

此外，Swing 是更好用的 API 之一。如果您使用大多数其他人，您会发现它们更难使用和/或平台不兼容。（如果任何阅读本文的人都知道例外情况，请发表评论，我已经有一段时间没有寻找了，并且有点好奇是否有更好的东西可用）

其他 JVM 语言（如 JRuby 和 Jython）经常使用，因为它们可以访问 Swing。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-05T00:16:10.173

您可以查看[Swing Sightings](http://java.sun.com/products/jfc/tsc/sightings/)。

该网站由 SUN 托管，专门用于使用 Swing 的 sw 项目。有很多项目使用 Swing ...

[http://java.sun.com/products/jfc/tsc/sightings/](http://java.sun.com/products/jfc/tsc/sightings/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-02T16:43:39.060

Swing 大量用于业务特定（垂直）/内部应用程序开发。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-02T16:43:05.083

Swing 应用程序用于 Java 应用程序在桌面上运行的大多数情况。有时您甚至不知道——例如，LimeWire 是一个 Java Swing 应用程序。

在学习 Swing 的时候，你会发现你会开始了解 AWT 中那些仍然很重要的部分，比如 Event、LayoutManager、Graphics、Font、Color 等。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-02T16:48:33.153

嗯……NetBeans 怎么样？你知道，IDE？它使用 Swing。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-02T16:41:45.320

您当然应该为桌面 Java 编写 Swing，仅在 Swing 需要的程度上使用 AWT。

我相信人们可以想出除了 SQL Squirrel 和 IntelliJ 之外的非常好的 Swing 应用程序示例。

我认为 Flex、Silverlight 等 RIA 技术正在兴起，因为 Web 和服务正在从台式机中抢走注意力。失败的不仅仅是 Swing。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-02T18:01:01.353

每当您想为非 Windows 操作系统编写桌面 GUI 应用程序时，您都可以使用 Swing 作为唯一健全且有保证的跨平台 GUI 框架。

此外，Swing 的设计非常好。我建议无论如何都要学习它，以使自己成为更好的程序员。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-02T16:49:27.957

查看[肮脏的富客户](https://rads.stackoverflow.com/amzn/click/com/0132413930)。它解释了 AWT 和 Swing 的一些历史。Swing，是大多数 AWT 类的轻量级替代品（继任者）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-02T17:30:00.043

跳过 AWT 和 Swing？跳到哪里？SWT？基于Web的开发？

从更广泛的意义上说，我有许多 Java 应用程序，尽管我不太确定它们使用的是 Swing 还是 SWT。

*   很多数据库工具，如 SQuirreL SQL Client 都是用 Java 编写的。我认为 SQuirrel 使用来自 Netbean 的东西，当然，它是基于 Swing 的。
*   yEd 是用 Java 编写的，可能是 Swing。
*   许多 P2P 软件都是用 Java 编写的，包括 Frostwire（我在那里看不到 SWT 的踪迹，但我只能错过它）。

这份清单远非详尽无遗！

哈哈！我忘了提到我工作的公司制作的软件套件！它非常专业，被移动电话公司用来监控其网络节点的健康状况（表面上看起来像一个电子表格）。完全基于 Swing。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-04T17:43:52.603

IIRC [jEdit](http://jedit.org/)也是一个 Swing 应用程序。相当流行的文本编辑器。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-01-05T01:12:31.217

Geertjan Wielenga 经常发表关于基于 NetBeans 平台的应用程序的[博客，因此也讨论了 Swing。](http://blogs.oracle.com/geertjan/)应用范围广泛，从相当小的深奥应用到非常大的关键任务系统（想到波音飞机）。[在Planet NetBeans](http://www.planetnetbeans.org/)上提到了 Geertjan 错过的许多企业级应用程序。似乎每隔几周就会有这样一个程序的公告或描述。

如上所述，许多工具都使用 Swing，包括最受欢迎的[IntelliJ IDEA](http://www.jetbrains.com/idea/) IDE。我很惊讶没有其他人提到它。

Sun 还曾经维护一个[Swing Sightings](http://java.sun.com/products/jfc/tsc/sightings/)网站，但几年来没有更新。

在我工作的地方，Swing 用于一个非常大的文档管理系统的表示层。在我自己的开发经验中，我曾将 Swing 用于图像处理、设备控制（视频、电机等）、数学、统计和医疗设备领域的桌面应用程序。

顺便说一句，我同意文件选择器的缓慢性。但是有很多替代品将使用本机文件选择器。如果 L&F 不能很好地匹配，那可能会有点刺耳。

**编辑**：哦，正如其他人所提到的，在 JVM 上使用其他语言的 Swing 非常容易。以 Clojure 为例，在我看来，它甚至比在 Java 中更容易使用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-06-08T04:12:16.527

虽然 Swing 有一些跨平台的外观和感觉缺陷，如果更新它以支持泛型会很好，但它仍然设计良好且非常实用。我一直很喜欢提供的大量定制服务。SWT 很好，而且更原生，但你也放弃了一些权力和控制权。此外，它似乎更易于使用，这可能是一个优点，因为 Swing 由于其灵活性而可能过于复杂。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-02T18:15:28.313

是否可以跳过某些内容没有普遍的问题。这是一个优先事项。虽然 Swing 有很多东西要教给您（而且它与 AWT 的融合程度太高），但如果您永远不会编写 GUI，那么最好还是投资于其他东西。

Swing，虽然丑得要命，但仍然在许多地方使用。在 Indeed 或 dice 中快速搜索“java swing”会发现许多需要它的工作和行业。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-04T17:23:33.063

你跳过它去参加考试/面试吗？除了 IntelliJ IDEA 和 NetBeans 等非常好的应用程序之外，还有很多 Swing 类框架 [SWT (Eclipse)、GWT 等]，您可以通过 Swing 知识更快地学习它们......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-05T00:25:56.877

您可能应该关注[JavaFX](http://java.sun.com/javafx/)以备将来工作。正如[常见问题解答所述](http://java.sun.com/javafx/faqs.jsp#4)，

> Sun 不会用 JavaFX Script 代替 Swing。相反，JavaFX Script 使 Swing 更易于使用。

使用/学习它将让您很好地理解重要的 Swing 概念，以及它们如何适应“未来”。我还没有使用过 JavaFX，但听说过很好的消息。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-06-18T06:42:30.487

Armitage 工具是用swing 制作的，metasploit 框架的GUI 工具。

# c# - 在 .NET 中如何最好地使用 XPath 和非常大的 XML 文件？

> ID：407350
> 
> 赞同：17
> 
> 时间：2009-01-02T16:39:24.263
> 
> 标签：c#, .net, xml, xpath, large-files

我需要在 C# 中对相当大的 XML 文件（这里可能超过千兆字节）进行一些处理，包括执行一些复杂的 xpath 查询。我遇到的问题是，我通常通过 System.XML 库执行此操作的标准方式喜欢在对整个文件执行任何操作之前将整个文件加载到内存中，这可能会导致这种大小的文件出现内存问题。

我根本不需要更新文件，只需阅读它们并查询其中包含的数据。一些 XPath 查询非常复杂，并且涉及多个级别的父子类型关系——我不确定这是否会影响使用流读取器而不是将数据作为块加载到内存中的能力。

我可以看到使其工作的一种方法是使用基于流的方法执行简单的分析，并且可能将 XPath 语句包装到 XSLT 转换中，然后我可以在文件中运行，尽管它看起来有点复杂。

或者，我知道 XPath 查询不会遇到某些元素，所以我想我可以根据它的原始树结构将文档分成一系列较小的片段，这些片段可能足够小，可以在内存中处理而无需造成太大的破坏。

我试图在这里解释我的目标，所以如果我在一般方法方面完全错误的树，我相信你们可以让我正确......

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-04T06:44:51.810

XPathReader 就是答案。它不是 C# 运行时的一部分，但可以从 Microsoft 下载。这是一篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms950778.aspx)。

如果您使用 XmlTextReader 构造 XPathReader，您将获得流式读取的效率以及 XPath 表达式的便利性。

我没有在千兆字节大小的文件上使用它，但我已经在几十兆字节的文件上使用它，这通常足以减慢基于 DOM 的解决方案的速度。

引用以下内容：“XPathReader 提供了以流方式在 XML 文档上执行 XPath 的能力”。

[从微软下载](http://www.microsoft.com/downloads/details.aspx?FamilyID=DB0C5FAE-111D-4B24-B10C-E4CDB13705DA&displaylang=en)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T10:46:45.037

技嘉 XML 文件！我不羡慕你这个任务。

有什么方法可以更好地发送文件吗？例如，它们是通过网络发送给您的吗？如果它们是一种更有效的格式，对所有相关人员来说可能会更好。将文件读入数据库并不是一个坏主意，但确实可能非常耗时。

我不会尝试通过读取整个文件在内存中完成所有操作 - 除非您有 64 位操作系统和大量内存。如果文件变成 2、3、4GB 怎么办？

另一种方法是读入 XML 文件并使用 SAX 解析文件并根据某些逻辑拆分写出较小的 XML 文件。然后，您可以使用 XPath处理**这些。**我在 20-30MB 的文件上使用了 XPath，它非常快。我最初打算使用 SAX，但我想我会尝试一下 XPath，但它的速度之快让我感到惊讶。我节省了很多开发时间，每次查询可能只损失了 250 毫秒。我使用 Java 进行解析，但我怀疑 .NET 几乎没有区别。

我确实读过 XML::Twig（一个 Perl CPAN 模块）是明确编写的，用于处理基于 SAX 的 XPath 解析。你能用不同的语言吗？

这也可能有助于[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1044772.html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1044772.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-16T09:31:13.803

[http://msdn.microsoft.com/en-us/library/bb387013.aspx](http://msdn.microsoft.com/en-us/library/bb387013.aspx)有一个利用 XStreamingElement 的相关示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T16:49:02.433

你已经概述了你的选择。

要么您需要放弃 XPath 并使用 XmlTextReader，要么您需要将文档分成可管理的块，您可以在这些块上使用 XPath。

如果您选择后者使用 XPathDocument，它的只读限制允许更好地使用内存。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T16:49:36.643

为了使用标准 .NET 类执行 XPath 查询，需要将整个文档树加载到内存中，如果它可能占用 1 GB，这可能不是一个好主意。恕我直言，[XmlReader](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.aspx)是处理此类任务的好类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T11:14:44.277

我认为最好的解决方案是制作您自己的 xml 解析器，它可以读取小块而不是整个文件，或者您可以将大文件拆分为小文件，并对这些文件使用 dotnet 类。问题是在整个数据可用之前您无法解析某些数据，因此我建议使用您自己的解析器而不是 dotnet 类

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-02T17:27:53.697

**看来您已经尝试过使用**[`XPathDocument`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathdocument.aspx)****并且无法在内存中容纳已解析的 xml 文档**。**

 **如果是这种情况，在开始拆分文件之前（这最终是正确的决定！）您可以尝试使用[**Saxon**](http://www.saxonica.com/) XSLT/XQuery 处理器。它具有加载的 XML 文档（[**“小树”模型**](http://sites.computer.org/debull/A08dec/saxonica.pdf)）的非常有效的内存表示。此外， [**Saxon SA**](http://www.saxonica.com/documentation/schema-processing/intro.html)（shema-aware 版本，不是免费的）有[**一些流媒体扩展**](http://www.saxonica.com/documentation/sourcedocs/serial.html)。[**在此处**](http://www.saxonica.com/documentation/sourcedocs/serial/implementation.html)阅读有关此内容的更多信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-02T18:38:33.913

将整个内容读入数据库然后使用临时数据库怎么样？这可能会更好，因为这样您的查询可以使用 TSQL 更有效地完成。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-02T16:48:50.763

您是否尝试过 XPathDocument？此类针对有效处理 XPath 查询进行了优化。

如果您不能使用 XPathDocument 有效地处理您的输入文档，您可以考虑使用 XmlReader 预处理和/或拆分您的输入文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-19T19:11:54.217

由于在您的情况下，数据大小可以在 Gbs 中运行，您是否考虑过使用 ADO.NET 和 XML 作为数据库。除此之外，内存占用不会很大。

另一种方法是使用 Linq to XML 并使用 XElementStream 等元素。希望这可以帮助。

# apache-flex - 自定义 Flex Ant 构建任务

> ID：407362
> 
> 赞同：0
> 
> 时间：2009-01-02T16:43:09.247
> 
> 标签：apache-flex, ant, custom-build-step

一个初学者的问题。

我正在使用 Flex Ant 构建一个 .swf。

到我的 .swf 我链接一个文件，我使用命令`target.as`从文件生成`source.txt`

```
./tool.sh source.txt > target.as 
```

如何将上述句子中描述的内容添加到我的 ant 构建过程中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T17:00:22.443

[exec 任务](http://ant.apache.org/manual/Tasks/exec.html)执行任何外部程序：

```
<exec executable="${basedir}/tool.sh" dir="${basedir}" output="target.as">
    <arg path="source.txt"/>
</exec> 
```

因此，如果您使用 mxmlc ant 任务来编译您的 swf，您可以像这样定义您的构建任务：

```
<target name="build">
     <exec executable="${basedir}/tool.sh" dir="${basedir}" output="target.as">
          <arg path="source.txt"/>
     </exec>

     <mxmlc ....>
         ...
     </mxmlc>
</target> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T16:57:29.623

要在 Ant 中运行该命令，请使用该[`exec`](http://ant.apache.org/manual/Tasks/exec.html)任务。

```
<exec executable="tool.sh" dir="toolshdir" output="target.as">
    <arg value="source.txt" />
</exec> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T07:36:25.870

[http://livedocs.adobe.com/flex/3/html/anttasks_1.html](http://livedocs.adobe.com/flex/3/html/anttasks_1.html)

您可能还想使用 Flex“mxmlc”任务而不是使用 exec 调用它。如果您不想维护 shell 脚本，您可以直接在 XML 中进行大量配置。

# sql - 在 SQL Server Reporting Services 中使用内联 SQL 列出报表？

> ID：407367
> 
> 赞同：2
> 
> 时间：2009-01-02T16:44:09.010
> 
> 标签：sql, reporting-services, inline

在我们关于报表管理器的许多报表中，我都有几个内联 SQL。现在我需要对所有这些进行一些代码更改，有没有办法根据内联 SQL 而不是任何 SP 列出所有这些报告？

谢谢，
D

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T17:19:13.933

您可以执行 NXC 建议的操作，或者如果这是一次性活动，您只需在文本编辑器中打开报告的 RDL 文件，然后搜索常见的 SQL 字符串，如“select”、“delete”等，即可找到具有内联 SQL 的报告

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T17:10:38.270

您可以使用报告服务 API 从 Web 服务获取报告并在 XML 中搜索适当的标签。可以在[此处](http://msdn.microsoft.com/en-us/library/ms155062.aspx)找到报告定义 XML 架构和图表的 MSDN 文档，并在此处找到数据源相关部分的图表[。](http://msdn.microsoft.com/en-us/library/bb677408.aspx) API 文档可以在[这里找到。](http://msdn.microsoft.com/en-us/library/ms155076.aspx)

您可以编写 .Net 程序，使用[ReportingService.GetReportDefinition](http://msdn.microsoft.com/en-us/library/aa258101(SQL.80).aspx)和[SetReportDefinition](http://msdn.microsoft.com/en-us/library/aa258544(SQL.80).aspx)从 Reporting Services API 上传和下载报告。您可以将报告定义上传或下载到缓冲区中，该缓冲区可以读取或写入磁盘。在某个地方，我有一个 Ironpython 原型可以做到这一点，如果我找到它，我会发布它。

要使用它，您需要查询 WSDL 并生成一个存根。执行此操作的工具称为[WSDL.EXE](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.71).aspx)。如果我能找到它，我会把它贴在这里，但你也可以很容易地使用 C#。

还有一个名为[rs.exe](http://msdn.microsoft.com/en-us/library/aa256617(SQL.80).aspx)的工具随[BIDS](http://msdn.microsoft.com/en-us/library/ms170338.aspx)一起提供，该工具采用 VB.net 程序，并在其顶部和尾部包含 Reporting Services API。您可以使用它从命令行执行 VB.Net 脚本 - 本质上它是程序的顶部和尾部，在后台编译它并针对报表服务器运行它。

# c# - ASP.NET：功能键快捷键？

> ID：407370
> 
> 赞同：5
> 
> 时间：2009-01-02T16:44:54.737
> 
> 标签：c#, asp.net, user-interface, mainframe

我最近参与了一个项目，将大型机系统替换为 web（asp.net 2.0，VS2005）系统。
3270 终端仍然被大量使用，我尊重 IMS/CICS/Cobol 应用程序设计人员的工作。

用户喜欢 Web 应用程序，但他们一直要求的一件事是：
直接导航到不同 Web 表单的功能键和快捷方式。

你知道在 asp.net 中实现功能键快捷方式的方法，就像 3270 功能键操作吗？

我们在母版页中使用 asp:menu 作为内容，但 asp:item 不支持 accesskey 属性：

```
<asp:SiteMapDataSource ID="_siteMapDataSource" runat="server"  ShowStartingNode="False" />

<asp:Menu ID="Menu1" runat="server"  DataSourceID="_siteMapDataSource" Orientation="Horizontal">
</asp:Menu> 
```

更新：24.jan 09：我喜欢@John Sheehan 的回答。将使用 ASP.Net 3.5 SP1 中的 jQuery 支持来实现它

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T16:55:56.257

ASP.NET 对此没有什么特别之处，因为您需要使用 JavaScript 来处理它。最简单的方法是使用像[js-hotkeys这样的 jQuery 插件](http://jshotkeys.googlepages.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T17:10:38.287

您也可以查看 accesskey 属性...

# c# - 如何将插入符号位置移动到当前单词的末尾？

> ID：407371
> 
> 赞同：1
> 
> 时间：2009-01-02T16:45:40.583
> 
> 标签：c#, winforms, webbrowser-control

我正在使用网络浏览器控件。如何将 execCommand 的插入位置移动到当前选择的单词末尾？

例子：

| <- 当前插入位置

Som|eword -> 移动 -> Someword| -> execCommand 在当前单词之后执行

我想要做的是在不中断单词的情况下插入一行。现在发生的事情是：

Somew|ord -> 行

一些

* * *

秩序

应该发生的是：

Somew|ord -> 行

* * *

某字

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-04T17:57:31.073

这太hacky了，我几乎不好意思发布它，但是......你可以通过执行类似的操作来完成“插入一行而不破坏单词”“使用网络浏览器控件”

```
webBrowser1.Url = 
            new Uri("javascript:" +
                "var tr=document.selection.createRange();" +
                "tr.expand('word');" +
                "tr.collapse(false);" +
                // "tr.select();" // Necessary to actually move the caret
                "tr.pasteHTML('<hr>');"); 
```

在网络浏览器加载了您想要操作的文档之后，并且用户已经选择了他们想要在其后插入一行的文本。如果您真的需要移动插入符号，则需要`tr.select()`在`tr.collapse()`.

但它不使用 execCommand，因此它可能不适合您的目的。也许其他人可以想出一种方法来让它更干净一些......

# sql-server - VS C#/SQL Server Compact 设置疑难解答 - “事件日志文件已满”消息

> ID：407402
> 
> 赞同：0
> 
> 时间：2009-01-02T16:55:47.803
> 
> 标签：sql-server

我正在尝试开发一个小的 C# 应用程序（使用 MS Visual Express 和 SQL Server）并且在试图找出弹出的错误对话框时遇到问题：“事件日志文件已满”

我正在遵循这些说明：http: [//msdn.microsoft.com/en-us/library/aa983322.aspx](http://msdn.microsoft.com/en-us/library/aa983322.aspx)

在 MS Visual C# 中，我打开了“数据库资源管理器”窗口。有一个项目显示“数据连接”。当我右键单击该项目并单击“添加连接...”时，我收到了错误消息。

我的系统是 Windows XP SP2。

任何帮助理解这一点将不胜感激。我对 SQL 并不陌生（我是 MySQL 人），但我对 MS SQL Server 的东西还是很陌生。

-阿迪娜

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:03:45.023

清空事件日志并重试：

*   Windows-R（“运行”）-eventvwr
*   对于每个事件日志（在左侧窗格中），右键单击并选择“清除所有事件”（如果您愿意，请备份现有日志）

# java - MBean可以在Tomcat下运行吗？

> ID：407405
> 
> 赞同：4
> 
> 时间：2009-01-02T16:56:49.547
> 
> 标签：java, tomcat, jboss, mbeans

我们有 2 个在 JBoss 下运行的应用程序。我正在寻找一种方法来减少服务器的开销。主应用程序在 Tomcat 下运行。另一个应用程序由 MBean 组成。有没有办法在 Tomcat 下运行 MBean？

替代建议表示赞赏。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T17:01:05.047

MBean 是 JRE 中包含的 JMX 规范的一部分。应该可以在 Tomcat 下运行 MBean。Tomcat 5 或更高版本提供了一个 MBean 服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-21T21:28:44.053

您可以使用以下 JVM 参数来启动启用了 MBean 的 Tomcat

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=4444 (could be anything)
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-11T17:41:57.803

您还应该使用 tomcat 中的 MBean 服务器 - 您必须通过以下方式找到该服务器：

```
 // find the existing MBean server (tomcat's) in lieu of
    // creating our own
    //
    ArrayList<MBeanServer> mbservers = MBeanServerFactory
            .findMBeanServer(null);

    int nservers = mbservers.size();
    if (nservers > 0) {
        //
        // TODO: A better way to get the currently active server ?
        // For some reason, every time the webapp is reloaded there is one
        // more instance of the MBeanServer
        mbserver = (MBeanServer) mbservers.get(nservers - 1);
    }

    if (mbserver == null) {
        mbserver = MBeanServerFactory.createMBeanServer();
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-13T15:02:07.347

试试这个[http://community.jboss.org/wiki/JBossASTuningSliming](http://community.jboss.org/wiki/JBossASTuningSliming)。当然，您有许多没有使用的服务。

# perl - 如何在 Perl 中读取固定长度的记录？

> ID：407407
> 
> 赞同：12
> 
> 时间：2009-01-02T16:57:44.757
> 
> 标签：perl, fixed-length-record

在 Perl 中读取固定长度记录的最佳方法是什么。我知道要读取如下文件：

```
ABCDE 302
DEFGC 876 
```

我可以

```
while (<FILE>) {
   $key = substr($_, 0, 5);
   $value = substr($_, 7, 3);
} 
```

但是没有办法通过读取/解包来做到这一点吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-02T17:06:20.433

```
my($key, $value) = unpack "A5 A3";    # Original, but slightly dubious 
```

我们都需要查看[unpack](http://perldoc.perl.org/functions/unpack.html)手册页（尤其是[pack](http://perldoc.perl.org/functions/pack.html)手册页）中的选项。

由于 A pack 运算符删除了尾随空格，因此您的示例可以编码为：

```
my($key, $value) = unpack "A6A3"; 
```

或者（这是 Perl，所以是 TMTOWTDI）：

```
my($key, $blank, $value) = unpack "A5A1A3"; 
```

1 是可选的，但系统性和对称性。这样做的一个优点是您可以验证`$blank eq " "`.

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-02T20:53:44.717

更新：有关明确的答案，请参阅下面 Jonathan Leffler 的答案。

我不会只将它用于两个字段（我会直接使用[pack](http://perldoc.perl.org/functions/pack.html) / [unpack](http://perldoc.perl.org/functions/unpack.html)），但对于 20 或 50 个左右的字段，我喜欢使用[Parse::FixedLength](http://search.cpan.org/dist/Parse-FixedLength/FixedLength.pm)（但我有偏见）。例如（对于您的示例）（更新：另外，您可以使用 $/ 和 <> 作为替代 read($fh, $buf, $buf_length)...见下文）：

```
use Parse::FixedLength;

my $pfl = Parse::FixedLength->new([qw(
  key:5
  blank:1
  value:3
)]);
# Assuming trailing newline
# (or add newline to format above and remove "+ 1" below)
my $data_length = $pfl->length() + 1;

{
  local $/ = \$data_length;
  while(<FILE>) {
    my $data = $pfl->parse($_);
    print "$data->{key}:$data->{value}\n";
    # or
    print $data->key(), ":", $data->value(), "\n";
  }
} 
```

有一些类似的模块使打包/解包更加“友好”（参见 Parse::FixedLength 的“另见”部分）。

更新：哇，这是一个替代答案，而不是官方答案......好吧，既然它就是这样，我应该包括一些乔纳森莱弗勒更直接的代码，这可能是你通常应该做的（请参阅下面的[打包](http://perldoc.perl.org/functions/pack.html)/[解包](http://perldoc.perl.org/functions/unpack.html)文档和 Jonathan Leffler 的节点）：

```
$_ = "ABCDE 302";
my($key, $blank, $value) = unpack "A5A1A3"; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-02T18:28:37.803

假设每条记录有 10 条字符记录，每条记录有两个 5 字符字段：

```
open(my $fh, "<", $filename) or die $!;
while(read($fh, $buf, 10)) {
  ($field1, $field2) = unpack("A5 A5", $buf);
  # ... do something with data ...
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-02-19T19:20:47.840

这是另一种方法：

```
while (<FILE>)
{
    chomp;
    if (/^([A-Z]{5}) ([0-9]{3})$/)
    {
        $key = $1;
        $value = $2;
    }
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-02T17:31:46.607

不管你的记录和字段是否是定长的，如果字段用统一的分隔符（如空格或逗号）分隔，你可以使用 split 功能比 unpack 更容易。

```
my ($field1, $field2) = split / /; 
```

查找拆分的文档。参数列表和分隔符模式的格式有一些有用的变化。

# html - 如果您需要到处清理积木，那么无表设计有什么好处？

> ID：407420
> 
> 赞同：9
> 
> 时间：2009-01-02T17:05:06.083
> 
> 标签：html, css, semantic-markup

我知道从标签转向`<div>`标签的目标`<table>`是有意义的，因为它更具语义性。但是，如果您仍然需要一个清除块来使基于列的布局工作，我不明白所获得的好处。例如：

```
<!-- Note: location-info & personal-info both float left. -->
<div class="contact"> 
    <div class="personal-info">
        <p>
           Shawn, etc, etc
        </p>
    </div>
    <div class="location-info">
        <p><address>etc</address></p>
    </div>
    <br style="clear:both" /> <!-- clearing block -->
 </div> 
```

外来`<br>`标记严格用于描述样式，并且是使布局正常工作所必需的。这不会破坏删除表格所获得的所有好处吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-02T17:06:14.817

如果我告诉你[你不需要](http://www.positioniseverything.net/easyclearing.html)[清理](http://www.sitepoint.com/simple-clearing-of-floats/) [块](http://www.innovatingtomorrow.net/2008/03/24/how-clear-floats-css) 怎么办？

```
.clear-block:after {
    content: ".";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
}

.clear-block {
    display: inline-block;
}
```

```
<div id="wrapper" class="clear-block">
    <div style="float:right">
        Your content here
    </div>
    <div style="float:left">
        More content here
    </div>
</div>
```

[JSFiddle](https://jsfiddle.net/v3vnbz4p/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-02T17:15:13.927

如果您正在显示表格数据，那么使用表格仍然比使用许多浮动 div 更有意义。明智地使用你拥有的工具——不要盲目地使用 CSS，因为表格是最好的选择。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-02T23:03:22.553

> 我知道从标签转向`<div>`标签的目标`<table>`是有意义的，因为它更具语义性。

实际上，恰恰相反：从`<table>`到`<div>`使您的 HTML语义*更少。*事实上，(and ) 元素的*全部意义*在于*没有*语义！[`<div>`](https://www.w3.org/TR/html5/grouping-content.html#the-div-element)[`<span>`](https://www.w3.org/TR/html5/text-level-semantics.html#the-span-element)

 *`<div>`当我看到一个被描述为“语义 HTML”的 s 森林时，它总是让我感到兴奋。不，这不对！那是 *un-* 语义 HTML！特别是如果它包含很多`<div class='float-left'>`，`<div id='bottom'>`我个人的最爱`<div class='paragraph'>`和`<span class='emphasis'>`。

不要误会我的意思，使用 un-semantic`<div>`肯定比使用*wrong* -semantic`<table>`更好，但更好的是使用语义*正确*的元素——尽管在许多情况下问题是 HTML 不提供任何元素。例如，在您的代码段中，您使用了该`<address>`元素，但根据[规范](https://www.w3.org/TR/html5/sections.html#the-address-element)，该元素*并非*用于标记地址！它*仅*用于标记*页面作者的*地址 - IOW 它完全没用。

您发布的示例缺少很多上下文，因此很难说，但实际上看起来您可能想要显示表格或分层数据，在这种情况下`<table>`s 或`<ul>`s 可能是更好的选择。

* * *

与您的问题完全无关：您可能想看看[hCard](http://Microformats.Org/wiki/hCard)和[XOXO](http://Microformats.Org/wiki/XOXO)微格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T17:08:12.207

一点也不。避免使用表格还有很多其他好处。

*   [表而不是 DIV](https://stackoverflow.com/questions/30251/tables-instead-of-divs)
*   [DIVs vs. TABLEs 请反驳](https://stackoverflow.com/questions/96137/divs-vs-tables-a-rebuttal-please)
*   [DIV 与表格或 CSS 与愚蠢](https://stackoverflow.com/questions/61250/divs-vs-tables-or-css-vs-being-stupid)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T00:28:50.523

我个人使用 clearfix hack 来满足我的清算需求。

```
/* Clearfix */
#content:after,
.box:after {
  content:'.';
  display: block;
  clear: both; 
  visibility: hidden; 
  height: 0;
}
#content,
.box {
  zoom: 1; /* IE */
} 
```

请注意，我只是用逗号分隔选择器，而不是将`clearfix`类添加到所有内容中。它真的很好用。唯一的问题是该`zoom`属性是 IE 特定的并且不验证，但是没有像其他属性有时可能存在的副作用，例如`overflow: auto`.

我已经在专业网站上使用它 5 年了，没有任何问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T17:21:13.680

正如 annakata 的回答所示，您不需要那些清除块。但除此之外，避免使用表格的一个优点是可以逐步呈现页面。*只有在整个*表格（包括其所有内容）都已解析后才能呈现表格，如果您的页面很大且连接速度较慢，则可能需要一段时间。div 可以立即呈现，这意味着您可以比使用表格更快地向用户呈现可用的东西。

当然，这只是一个不错的小红利，它不是，也不应该是避免使用表格*的*原因（对于非表格数据）

# cocoa - 将核心数据模型与 Web 服务同步

> ID：407424
> 
> 赞同：5
> 
> 时间：2009-01-02T17:07:02.507
> 
> 标签：cocoa, core-data, crud, key

这个问题已经困扰我好几天了。

我有一个提供 XML 的 Web 服务，如下所示：

```
<levels>
    <level>Level 1</level>
    <level>Level 2</level>
    <level>Consulting</level>
    <level>Office Support</level>
    <level>Learning</level>
</levels> 
```

这些数据需要进入我的核心数据模型中的实体，以便我的应用程序可以使用它们。我已经能够很好地将它们解析到模型中，当其中一个级别发生变化时，我的问题就出现了。我可以创建、读取和删除，但我不知道如何更新，因为我需要维护与模型中其他实体存在的关系。我来自强大的 PHP 和 MySQL 背景，所以我的第一直觉是在模型中添加一个可以用来关联的键，但由于 Core Data 并不是真正的数据库，所以感觉不对，我知道肯定有更好的方式。我在谷歌上搜索了一下，找不到任何答案。我是在正确的轨道上使用密钥还是 Core Data 提供了我所缺少的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:34:34.743

我需要更多信息来准确了解您的模型是如何工作的，但总的来说，我认为将您自己的唯一密钥添加到核心数据模型中没有任何问题。我正在为我的一个应用程序做同样的事情，我在每个对象上保留一个 UUID 以与 iPhone 应用程序同步。

# asp.net - 与实体框架的数据绑定 ASP.net DropDownList

> ID：407428
> 
> 赞同：1
> 
> 时间：2009-01-02T17:09:29.927
> 
> 标签：asp.net, entity-framework, data-binding, 3-tier

我正在尝试将 ASP.net DropDownList 绑定到实体框架查询的结果，同时仍保持多层分离。（即，我不希望我的 UI 代码包含查询详细信息，也不希望我的数据层代码具有 UI 依赖项。）我在 Page_Load 事件处理程序中的代码隐藏如下所示：

```
 IEnumerable<Lookup> TypesLookup = Business.DocumentBO.GetDocumentTypes(_LookupTypeID);
        DocTypeDropDownList.DataSource = TypesLookup;
        DocTypeDropDownList.DataTextField = "Description";
        DocTypeDropDownList.DataValueField = "LookupID";
        DocTypeDropDownList.DataBind(); 
```

虽然我的数据代码看起来像这样（还有一个中间业务层，但那里还没有处理——只是一个传递。）：

```
 public static IEnumerable<Lookup> GetLookups(int LookupTypeID)
    {
        using (VLFDocumentEntities context = new VLFDocumentEntities())
        {
            IEnumerable<Lookup> l = (from c in context.Lookup
                        where c.LookupTypeID == LookupTypeID
                        select c);

            return l;
        }
    } 
```

当我到达 DocTypeDropDownList.DataBind(); 时，它会抛出一个带有消息“DocTypeDropDownList.DataBind();”的 ObjectDisposedException。谁能告诉我解决这个问题的最佳方法？

谢谢，安迪

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:14:59.917

您不必从上下文中分离对象吗？例如：

```
IEnumerable<Lookup> l = (from c in context.Lookup
                        where c.LookupTypeID == LookupTypeID
                        select c);
foreach (Lookup lookup in l)
  context.Detach(lookup);
return l; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-27T11:50:55.723

为什么不直接使用 List<>？

```
public static List<Lookup> GetLookups(int LookupTypeID)
{
    using (VLFDocumentEntities context = new VLFDocumentEntities())
    {
        return (from c in context.Lookup
                    where c.LookupTypeID == LookupTypeID
                    select c).ToList();
    }
} 
```

# testing - Google Chrome 对开发网络应用程序的产品所有者有何影响？

> ID：407451
> 
> 赞同：6
> 
> 时间：2009-01-02T17:20:06.707
> 
> 标签：testing, google-chrome, cross-browser

如果我的应用程序已在 Firefox 3、Safari 3 和 IE 7 中测试过，是否需要针对 Chrome 进行额外测试？

如果有需要进一步测试的领域——那么有没有我可以与我的设计师和开发人员分享的在线指南？

什么时候 Chrome 才会被认为有足够的市场份额被视为主流浏览器？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-02T17:25:55.260

如果它在 Safari 上运行良好，那么它也可能在 Chrome 上运行。唯一的区别是 JavaScript 引擎，但我还没有看到一些合法 JavaScript 代码不能在 Chrome 上运行的真实示例。

我个人使用 Chrome 测试我的东西，因为我大量使用 Chrome 进行开发。不过，最好使用至少一个基于 WebKit（或 KHTML）的浏览器来测试您的页面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T17:26:35.947

Chrome 使用 WebKit 渲染引擎，在 Safari 和其他一些小型浏览器中也有使用。总体而言，随着 Chrome 和 Safari 市场份额的增加，它绝对是一款需要测试的浏览器（您只需要真正测试一个）。它非常符合标准，并且不断更新以跟上新的 CSS 草案。

Webkits 主站点 - [http://webkit.org/](http://webkit.org/)

**浏览器市场份额** [http://www.w3schools.com/browsers/browsers_stats.asp](http://www.w3schools.com/browsers/browsers_stats.asp)和[http://en.wikipedia.org/wiki/Usage_share_of_web_browsers](http://en.wikipedia.org/wiki/Usage_share_of_web_browsers)是寻找浏览器市场份额的好地方，尽管它们在 Chrome 上的反应截然不同.

根据维基百科，大约 7.96% 的人正在使用基于 WebKit 的浏览器，但 W3C 显示 11 月份只有 5.8% 使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T17:25:58.647

从理论上讲，由于 Google Chrome 使用与 Safari (WebKit) 相同的引擎，因此您已经进行了测试。但是谷歌对引擎做了一些改变，包括完全重写了 JavaScript 解释器。额外的测试永远不会受到伤害，并且很快就可以确认一切都按预期工作。

现在 GMail 建议人们从 IE 切换到 Firefox 和 Chrome，我猜我们会看到 IE 将越来越多的市场份额拱手让给这些浏览器。Chrome 现在没有太多的用户群，但我可以想象这会改变。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T17:27:27.503

更好地测试它。我已经在 Safari 中运行但在 Chrome 中不运行的站点上运行过。我的机器上安装了 IE8b2、FF3、Safari 和 Chrome。不是出于测试原因，而是因为我访问的网站。采取所有这 4 项以使所有网站正确显示...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T17:58:06.770

如果您没有从 CSS 更改不透明度的 PNG24，那么一切都应该没问题。

但是，我总是尝试使用所有现代浏览器（ie6/7、ff2/3、opera 9.x、safari 和 chrome）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-02T20:05:33.347

[根据维基百科](http://en.wikipedia.org/wiki/Comparison_of_web_browsers)，Chrome 目前的使用率为 0.78%。根据您的受众，实际用户数量可能很少，并且不需要测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T17:25:06.947

Chrome 已经占据了社区的一小部分。但是据我所知，Chrome 遵循 W3C 的标准，所有在 IE6、IE7 和 FF2 / 3 中运行的网站对我来说都非常适合。

话虽如此，我认为您也应该已经在 chrome 中测试您的应用程序。

现在总是在这些浏览器中测试：

*   互联网浏览器 6、7、8
*   火狐 2、3
*   铬合金
*   歌剧
*   苹果浏览器
*   猞猁

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-02T17:27:27.927

Chrome 使用 WebKit 引擎，我记得它与 Safari 使用的引擎相同。所以理论上，如果你的网站适用于 Safari，它也应该适用于 Chrome。

有关详细信息，请参阅此[Google 的 Chrome 页面](http://www.google.com/chrome/intl/en/webmasters-faq.html)。

# sql-server - MSSQL 数据库清理 - 如何找到未使用的对象（表、视图、过程、函数）

> ID：407452
> 
> 赞同：9
> 
> 时间：2009-01-02T17:20:09.983
> 
> 标签：sql-server, logging

假设您继承了 MS SQL 2000 或 2005 数据库，并且您知道某些表、视图、过程和函数实际上并未在最终产品中使用。

是否有某种内部日志记录或其他机制可以告诉我哪些对象没有被调用？或者只被调用了几次而不是数千次。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-04T03:13:40.050

这个 SO 问题，[Identifying Unused Objects In Microsoft SQL Server 2005](https://stackoverflow.com/questions/290773/identifying-unused-objects-in-microsoft-sql-server-2005)，可能是相关的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-02T18:35:35.900

答案在一定程度上取决于数据库是如何组合在一起的，但我对类似问题的处理方法有 3 倍：

找出哪些对象没有内部依赖关系。您可以通过针对 sysdepends 的查询来解决这个问题，例如：

```
select 
    id, 
    name
from
    sys.sysdepends sd
inner join sys.sysobjects so
    on so.id = sd.id
where 
    not exists (
        select 
            1
        from 
            sysdepends sd2
        where 
            sd2.depid = so.id
    ) 
```

您应该将此与收集对象类型 (sysobjects.xtype) 结合起来，因为您只想隔离表、函数、存储过程和视图。也忽略任何以“sp_”开头的过程，除非人们已经为您的应用程序创建了具有这些名称的过程！

许多返回的过程可能是您的应用程序的入口点。也就是说，从您的应用程序层或其他远程调用调用的过程在数据库中没有任何依赖于它们的对象。

假设该过程不会太具有侵入性（它会产生一些额外的负载，但不会太多），您现在可以打开一些 SP:Starting、SQL:BatchStarting 和/或 SP:StmtStarting 事件的分析。只要你认为合适就运行它，最好是登录到一个 sql 表以便于交叉引用。您应该能够消除许多直接从您的应用程序调用的过程。

通过交叉引用此日志中的文本数据和您的依赖对象列表，您有望隔离大部分未使用的过程。

最后，您可能希望获取由此过程产生的候选列表，并将源代码库与它们相对应。这是一项繁琐的任务，仅仅因为您在代码中找到引用并不意味着您需要它们！可能只是代码没有被删除，尽管它现在在逻辑上不可访问。

这远非一个完美的过程。一个相对干净的替代方法是在服务器上设置更详细（因此是侵入性的）分析来监控所有活动。这可以包括在日志处于活动状态期间调用的每个 SQL 语句。然后，您可以从这些文本数据中重新处理依赖表甚至跨数据库依赖项。我发现日志详细信息的可靠性（每秒尝试解析的行太多）以及难以处理的大量数据。如果您的应用程序不太可能受此影响，那么这可能是一个好方法。

警告：

因为，据我所知，没有一个完美的答案，尤其要小心删除表格。如果出现问题，过程、函数和视图很容易被替换（当然，在烧录它们之前要确保它们在源代码管理中！）。如果您真的很紧张，为什么不重命名表格并使用旧名称创建视图，那么您就很容易了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-07T06:29:07.807

我们还可以使用以下查询找到未使用的列和表。我累了写光标。光标将为您提供有关每个表格中每列的信息。

```
declare @name varchar(200), @id bigint, @columnname varchar(500)
declare @temptable table
(
 table_name varchar(500),
 Status bit
)
declare @temp_column_name table 
(
 table_name varchar(500),
 column_name varchar(500),
 Status bit
)

declare find_table_dependency cursor for
select name, id from sysobjects where xtype ='U'
open find_table_dependency
fetch find_table_dependency into @name, @id
while @@fetch_Status = 0
begin

 if exists(select top 1 name from sysobjects where id in 
   (select id from syscomments where text like '%'+@name +'%'))
  insert into @temptable
  select @name, 1
 else 
  insert into @temptable
  select @name, 0

 declare find_column_dependency cursor for
    select name from syscolumns where id = @id
 open find_column_dependency
 fetch find_column_dependency into @columnname
 while @@fetch_Status = 0
 begin

  if exists(select top 1 name from sysobjects where id in 
   (select id from syscomments where text like '%'+@columnname +'%'))
   insert into @temp_column_name
   select @name,@columnname, 1
  else 
   insert into @temp_column_name
   select @name,@columnname, 0

  fetch find_column_dependency into @columnname
 end
 close find_column_dependency
 deallocate find_column_dependency

 fetch find_table_dependency into @name, @id
end
close find_table_dependency
deallocate find_table_dependency

select * from @temptable
select * from @temp_column_name 
```

# asp.net - 将 Crystal Report 的内容转换为 ANSI 格式的文本文件

> ID：407456
> 
> 赞同：0
> 
> 时间：2009-01-02T17:20:26.940
> 
> 标签：asp.net, crystal-reports, report

有什么方法可以将 Crystal Report 的内容导出到文本文件 - 我使用的是 VS 2005。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T12:17:52.267

我会尝试导出到 rtf/html 并剥离标签

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-23T10:41:02.340

在调用 ReportDocument.Export() 之前设置 ReportDocument 对象 FormatOptions.ExportFormatType = TabSeperatedText

# visual-studio-2008 - Visual Studio 在服务项目中缺少“添加安装程序”链接

> ID：407459
> 
> 赞同：6
> 
> 时间：2009-01-02T17:20:35.210
> 
> 标签：visual-studio-2008, windows-services, .net-2.0, service-installer

我正在构建 Windows 服务并遵循[此 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa984464(VS.71).aspx)，但我被困在“创建安装程序”下的第 3 步。我找不到它所指的“添加安装程序”链接。我到处点击，包括按照它给出的说明进行操作，但我似乎找不到它。Google 上的一些人遇到了同样的问题，但从未找到解决方案（除了添加 ServiceInstaller 对象并手动配置它）。

有没有其他人遇到过这个问题并找到了原因？如果重要的话，我正在使用 VS2008 并以 .Net 2.0 为目标。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T18:44:16.600

他们正在谈论的“灰色区域”是“属性”面板的“命令”面板（不是错字）。它不是很有用，所以你可能已经关闭了它，我做到了。

您可以通过右键单击“属性”面板并选择“命令”来重新启用它，或者通过右键单击“服务设计”视图（带有“将组件添加到您的类... ") 并选择“添加安装程序”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-11-03T19:42:27.650

要了解新的 Visual Studio Express(2015) 版本，请执行以下操作：

看来我们不能从快速版中获得这个“添加安装程序”。但这真的很简单。您只需要创建一个类并添加以下代码。

您还需要添加参考 System.Configuration.Install.dll。

```
using System.Configuration.Install;
using System.ServiceProcess;
using System.ComponentModel;

namespace SAS
{
    [RunInstaller(true)]
    public class MyProjectInstaller : Installer
    {
        private ServiceInstaller serviceInstaller1;
        private ServiceProcessInstaller processInstaller;

        public MyProjectInstaller()
        {
            // Instantiate installer for process and service.
            processInstaller = new ServiceProcessInstaller();
            serviceInstaller1 = new ServiceInstaller();

            // The service runs under the system account.
            processInstaller.Account = ServiceAccount.LocalSystem;

            // The service is started manually.
            serviceInstaller1.StartType = ServiceStartMode.Manual;

            // ServiceName must equal those on ServiceBase derived classes.
            serviceInstaller1.ServiceName = "SAS Service";

            // Add installer to collection. Order is not important if more than one service.
            Installers.Add(serviceInstaller1);
            Installers.Add(processInstaller);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-09-23T15:34:57.860

对于 Visual Studio 2012，右键单击“Services1.cs”并选择“查看设计器”（或按 Shift-F7）。然后，右键单击设计器的灰色背景。

然后，也只有到那时，你才会看到微软一直向你隐瞒的复活节彩蛋：难以捉摸的`Add Installer`链接。

![在此处输入链接描述](https://i.stack.imgur.com/Kf9ZJ.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-06-28T11:46:28.160

检查您尝试添加安装程序的 .cs 文件是否扩展`System.ServiceProcess.ServiceBase`而不是`System.ComponentModel.Component`.

要将 .cs 文件作为代码而不是在设计器中打开，请在解决方案资源管理器中选择它并按 F7 或右键单击它并选择“查看代码”。

# iphone - 添加日期选择器以编程方式查看？

> ID：407460
> 
> 赞同：16
> 
> 时间：2009-01-02T17:21:01.323
> 
> 标签：iphone, datepicker

有人可以说明（或指向我一个很好的教程）如何以编程方式将日期选择器添加到视图中（即，不使用界面编辑器）？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2010-10-14T08:31:54.467

这很容易，你可以在几秒钟内完成。

只需在 your.m 文件中使用这些方法...一切就绪

```
- (void)viewDidLoad {

    CGRect pickerFrame = CGRectMake(0,250,0,0);

    UIDatePicker *myPicker = [[UIDatePicker alloc] initWithFrame:pickerFrame];
    [myPicker addTarget:self action:@selector(pickerChanged:)               forControlEvents:UIControlEventValueChanged];
    [self.view addSubview:myPicker];
    [myPicker release]; 
}

- (void)pickerChanged:(id)sender
{
    NSLog(@"value: %@",[sender date]);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T17:27:17.520

`initWithFrame`使用 UIView 的方法像创建普通对象一样创建它。请记住，您指定的框架矩形应该根据超级视图的边界创建。这是一个示例，您可能需要更改框架矩形，并根据需要添加您自己的代码来设置日期选择器。

```
UIDatePicker *datePicker = [[UIDatePicker alloc] initWithFrame:[superview bounds]];
[superview addSubview:datePicker];
[datePicker release]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T06:05:17.367

Try the UIControls example provided in the iPhone SDK sample code. That shows you how to add almost any control programatically.

And the size of a picker is fixed. It is 320x216

# c++ - 如何在客户端-服务器应用程序中同步客户端和服务器端的相同对象？小消息框架适合这项工作吗？

> ID：407464
> 
> 赞同：1
> 
> 时间：2009-01-02T17:22:29.807
> 
> 标签：c++, python, oop

我正在用 c++ 和 python 制作游戏引擎。我使用 OGRE 进行 3D 渲染，OpenAL 用于声音，ODE 用于物理，OIS 用于输入，HawkNL 用于网络，boost.python 用于嵌入式 Python 解释器。每个子系统（库）都由一个类管理器包装，每个管理器都是单例的。现在，我有一个类——对象——这可能是游戏世界中所有可见的对象。这是某种混合，对象具有图形表示（实体）和物理模拟器中的表示（实体）。这两个在这里是最重要的。Class Object 只是纯粹的抽象基类——接口。我决定在客户端实现 Object 作为 ObjectClientSide - 这个实现有实体，在服务器端作为 ObjectServerSide - 这个实现有实体。物理模拟器仅在服务器上运行，当然，渲染只在客户端完成。只有当两个实现一起工作时，该对象才能存在。每个对象都有唯一的 id，并且客户端和服务器端的同一对象的两个实例都具有相同的 id。

所以，经过这个简短的背景，我的第一个问题是：这个设计好不好？我怎样才能让它变得更好？主要问题：我应该如何同步这些对象？

接下来，两种实现都有相同的接口，但一部分是在服务器端实现的，一部分是在客户端实现的。因此，例如，如果玩家想要移动他的角色，他应该向服务器上的对象发送请求。然后服务器对模拟进行更改并将更新的位置发送给客户端。出于这个原因，我创建了小消息框架。有一个 Message 类、Router、Rule 和从 Rule 继承的规则。当消息到达时，路由器会根据规则对其进行检查并将其发送到目的地。所以，当我调用 myObjectInstanceOnClientSide->setPosition(x,y,z) 这个对象创建消息时，它的内容是函数和参数，目标是服务器上具有相同 ID 的对象。当服务器端具有相同 id 的对象收到此消息时，它会使用给定的参数调用此函数。所以，当一个函数可以' 在一侧实现它会创建一条消息并将其发送到另一侧的对象。我认为这在脚本中非常有用。脚本可以非常干净，如果脚本需要例如在客户端上打开动画，我只需要在服务器的本地对象上调用这个函数 - 其余的在后台。

那么，这样可以吗？我错了吗？这是通用的解决方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-02T17:27:09.003

听起来你会发送很多小消息。UDP 和 IP 报头将增加 28 字节的开销（IPv4 报头为 20 字节，IPv6 报头为 40 字节，UDP 报头为 8 字节）。因此，**我建议将多条消息组合在一起以周期性的速率发送。**

您可能还想阅读这些其他问题和答案：

*   [处理网络游戏中的延迟](https://stackoverflow.com/questions/42515/dealing-with-latency-in-networked-games)
*   [实时多人游戏（概念题）](https://stackoverflow.com/questions/390067/real-time-multiplayer-game-concept-question#390078)

几年前，我向[DevMaster.net](http://www.devmaster.net/) [Wiki](http://www.devmaster.net/wiki/Main_Page)添加了[一堆有用的链接](http://www.devmaster.net/wiki/Networking_links)，这些链接仍然相关：

*   [网络游戏 101 常见问题](http://www.gamedev.net/reference/articles/article1138.asp)
*   [多人游戏和网络编程](http://www.gamedev.net/community/forums/showfaq.asp?forum_id=15)
*   [多人游戏简介](http://trac.bookofhook.com/bookofhook/trac.cgi/wiki/IntroductionToMultiplayerGameProgramming)
*   [Quake3 网络模型编程](http://trac.bookofhook.com/bookofhook/trac.cgi/wiki/Quake3Networking)
*   [虚幻网络架构](http://unreal.epicgames.com/Network.htm)
*   [网络物理](http://gafferongames.wordpress.com/game-physics/networked-physics/)
*   [Beej 的网络指南](http://beej.us/guide/bgnet/)

我建议开始阅读[Glenn Fiedler 的博客](http://gafferongames.wordpress.com/)。他在网络物理方面做了一些令人难以置信的工作，包括最近的[雇佣兵 2](http://www.pandemicstudios.com/mercenaries/index.php)版本。他开始了一系列名为[Networking for Game Programmers](http://gafferongames.wordpress.com/networking-for-game-programmers/)的文章。

# delphi - TRemotable 派生类中的 Index 选项是什么？

> ID：407467
> 
> 赞同：3
> 
> 时间：2009-01-02T17:23:48.090
> 
> 标签：delphi, class, soap, interface

当 WSDL 导入器向导生成接口时，所有属性都有 Index 选项，但是阅读代码和 InvokeRegistry 单元，我找不到那是什么，有人知道是否真的有必要吗？

像这样

```
 Login = class(TRemotable)
  private
    [...] 
  published
    property User: string Index (IS_OPTN) read GetUser write SetUser stored User_Specified;
    [...]
  end; 
```

我问是因为我想改变这个单元，向这些类添加一些接口，以便与 MVP 框架集成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T05:07:14.800

当您访问用户属性时，IS_OPTN 通过“索引”参数传递给 GetUser 和 SetUser。

getter/setter 可能如下所示：

```
function GetUser(Index:Integer):String;
procedure SetUser(Index:Integer;const value:string); 
```

所以，把它想象成这样：

```
MyString := MyLogin.user;
// is translated to:
MyString := getUser(IS_OPTN); 
```

和

```
MyLogin.user := 'me'; 
// is translated to:
SetUser(IS_OPTN,'me'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T17:01:16.520

我为这个问题找到了更详细的解释， **当使用索引时，多个属性可以共享相同的访问方法。**

一个很好的例子，来自 Delphi 2009 帮助：

```
type 
   TRectangle = class 
     private 
       FCoordinates: array[0..3] of Longint; 
       function GetCoordinate(Index: Integer): Longint; 
       procedure SetCoordinate(Index: Integer; Value: Longint); 
     public 
       property Left: Longint index 0 read GetCoordinate write SetCoordinate; 
       property Top: Longint index 1 read GetCoordinate write SetCoordinate; 
       property Right: Longint index 2 read GetCoordinate write SetCoordinate; 
       property Bottom: Longint index 3 read GetCoordinate write SetCoordinate; 
       property Coordinates[Index: Integer]: Longint read GetCoordinate write SetCoordinate; 
       ... 
   end; 
```

请注意，所有属性共享相同的方法访问权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-10-27T15:50:04.800

是的，这是必要的。有了这些信息，例如 IS_OPTN，来自 TRemotable 的类知道当属性是可选的来构建 XML，所以如果是可选的，则只有在存储值时才添加节点。在你的情况下：

```
property User: string Index (IS_OPTN) read GetUser write SetUser stored User_Specified 
```

*如果User_Specified 为*真，则元素*User*将添加到 XML中。当您将值设置为 User 时， *User_Specified*会自动变为 true，因为设置器 SetUser 会执行此操作。

 **因此，当组件 SOAP 或示例将构建 XML 时，只有在存储元素时才会添加元素，因为它是可选的 (IS_OPTN)。

# python - Python urllib2 文件上传问题

> ID：407468
> 
> 赞同：6
> 
> 时间：2009-01-02T17:23:55.607
> 
> 标签：python, post, upload, urllib2

我目前正在尝试使用 urllib2 和[urllib2_file](http://fabien.seisen.org/python/urllib2_multipart.html)库启动文件上传。这是我的代码：

```
import sys
import urllib2_file
import urllib2

URL='http://aquate.us/upload.php'
d = [('uploaded', open(sys.argv[1:]))]
req = urllib2.Request(URL, d)
u = urllib2.urlopen(req)
print u.read() 
```

我已将此 .py 文件放在我的“我的文档”目录中，并在我的“发送到”文件夹中放置了它的快捷方式（快捷方式 URL 为 ）。

当我右键单击一个文件，选择发送到，然后选择 Aquate (my python) 时，它会在瞬间打开一个命令提示符，然后将其关闭。什么都没有上传。

我知道可能发生了错误，所以我将代码逐行输入到 CL python 中。当我跑`u=urllib2.urlopen(req)`线时，我没有收到错误； [替代文字 http://www.aquate.us/u/55245858877937182052.jpg](http://www.aquate.us/u/55245858877937182052.jpg)

相反，光标只是在该行下方的新行上开始闪烁。我等了几分钟，看看是否会发生什么事情，但它就是这样。为了让它停止，我不得不按 ctrl+break。

这个脚本是怎么回事？

提前致谢！

[编辑] 忘了提——当我在没有请求数据（文件）的情况下运行脚本时，它运行起来就像一个魅力。urllib2_file 有问题吗？

[编辑 2]：

```
import MultipartPostHandler, urllib2, cookielib,sys
import win32clipboard as w
cookies = cookielib.CookieJar()
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookies),MultipartPostHandler.MultipartPostHandler)
params = {"uploaded" : open("c:/cfoot.js") }
a=opener.open("http://www.aquate.us/upload.php", params)
text = a.read()
w.OpenClipboard()
w.EmptyClipboard()
w.SetClipboardText(text)
w.CloseClipboard() 
```

如果您通过命令行运行该代码，它就像一个魅力。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:52:22.773

如果您使用的是 Python 2.5 或更高版本，`urllib2_file`则既不必要也不支持，因此请检查您使用的是哪个版本（可能还需要升级）。

如果您使用的是 Python 2.3 或 2.4（受 支持的唯一版本`urllib2_file`），请尝试运行[示例代码](http://fabien.seisen.org/python/test.py)，看看您是否有同样的问题。如果是这样，您的 Python 或`urllib2_file`安装可能有问题。

**编辑：**

此外，您似乎没有使用`urllib2_file`POST 数据的两种支持格式中的任何一种。尝试使用以下两行**之一：**

```
d = ['uploaded', open(sys.argv[1:])]
## --OR-- ##
d = {'uploaded': open(sys.argv[1:])} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T17:56:42.000

首先，还有第三种运行 Python 程序的方法。

在 cmd.exe 中，键入`python myprogram.py`. 你会得到一个很好的日志。您不必一次输入一行内容。

其次，查看[urrlib2](http://www.python.org/doc/2.5.2/lib/module-urllib2.html)文档。您还需要查看[urllib](http://www.python.org/doc/2.5.2/lib/module-urllib.html)。

一个请求需要一个 URL 和一个 urlencoded 编码的数据缓冲区。

> data 应该是标准 application/x-www-form-urlencoded 格式的缓冲区。urllib.urlencode() 函数采用 2 元组的映射或序列，并以这种格式返回一个字符串。

您需要对数据进行编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-25T22:29:34.373

如果您仍在使用 Python2.5，那么对我有用的是在此处下载代码：

[http://peerit.blogspot.com/2007/07/multipartposthandler-doesnt-work-for.html](http://peerit.blogspot.com/2007/07/multipartposthandler-doesnt-work-for.html)

并将其保存为 MultipartPostHandler.py

然后使用：

```
import urllib2, MultipartPostHandler

opener = urllib2.build_opener(MultipartPostHandler.MultipartPostHandler())
opener.open(url, {"file":open(...)}) 
```

或者如果您需要 cookie：

```
import urllib2, MultipartPostHandler, cookielib

cj = cookielib.CookieJar()
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj), MultipartPostHandler.MultipartPostHandler())
opener.open(url, {"file":open(...)}) 
```

# asp.net-mvc - ASP.NET MVC Beta 支持列表中的模型绑定器 ?

> ID：407491
> 
> 赞同：9
> 
> 时间：2009-01-02T17:29:06.363
> 
> 标签：asp.net-mvc, modelbinder

以下面的示例类为例。我想在表单上显示客户和两个地址（来自 LIST）。MVC beta 中的模型绑定器是否支持这一点，还是我必须编写自己的自定义绑定器？

```
public class Customer
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public List<Address> Addresses { get; set; }

    public Customer()
    {
        Addresses = new List<Address>();
    }

}

public class Address
{
    public int Line1 { get; set; }
    public int Line2 { get; set; }
    public int City { get; set; }
    public int State { get; set; }
    public int Zip { get; set; }
} 
```

您将如何对这些字段进行编码？像这样？

```
<!-- some HTML formatting -->
<%= Html.TextBox("customer.address.line1", ViewData.Customer.Address[0].Line1)%>
<!-- some more HTML formatting -->
<%= Html.TextBox("customer.address.line1", ViewData.Customer.Address[1].Line1)%>
<!-- end of HTML form formatting --> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T17:36:39.203

我从来没有尝试过，但是看看[这篇](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx)文章，它是关于模型绑定到列表的，也许它可以帮助你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T15:32:49.247

使用 MvcContrib 的 NameValueDeserializer 使其更简单。假设您的页面派生自 ViewPage<Customer>。你可以这样做：

```
<%= Html.TextBox("Address[0].Line1", ViewData.Model.Address[0].Line1)%>
<%= Html.TextBox("Address[1].Line1", ViewData.Model.Address[1].Line1)%> 
```

还有这个：

```
public ActionResult Save([Deserialize]Customer customer) 
```

并且客户将从表单帖子中反序列化，并填充地址集合。您的索引不必按顺序排列——这支持您希望在发布之前在客户端删除行的情况。

如果您从视图数据字典（而不是模型）反序列化某些内容，则语法类似于 [Deserialize("customer")]，其中“customer”是前缀。

您可能会发现此[博客文章](http://lunaverse.wordpress.com/2009/01/02/editing-a-variable-length-list-of-items-with-mvccontribfluenthtml/)有趣且相关。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-05T18:37:02.543

只是为了完成这个。使用名称为 Index 的隐藏字段很重要。所以我上面的代码变成了这样：

```
<!-- some HTML formatting -->
<%= Html.Hidden("customer.address.Index", 0) %>
<%= Html.TextBox("customer.address[0].line1", ViewData.Customer.Address[0].Line1)%>
<!-- some more HTML formatting -->
<%= Html.Hidden("customer.address.Index", 1) %>
<%= Html.TextBox("customer.address[1].line1", ViewData.Customer.Address[1].Line1)%>
<!-- end of HTML form formatting --> 
```

它就像一个魅力！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T17:36:33.540

您可以像这样使用 ViewData 传递对象列表，但您需要更改一些行。在这里阅读更多：

[http://weblogs.asp.net/scottgu/archive/2007/12/06/asp-net-mvc-framework-part-3-passing-viewdata-from-controllers-to-views.aspx](http://weblogs.asp.net/scottgu/archive/2007/12/06/asp-net-mvc-framework-part-3-passing-viewdata-from-controllers-to-views.aspx)

和这里：

[ASP.NET MVC：如何将列表（来自模型中的类）传递给视图中的转发器？](https://stackoverflow.com/questions/314933/aspnet-mvc-how-do-i-pass-a-list-from-a-class-in-model-to-a-repeater-in-a-view)

希望这可以帮助

* * *

编辑

* * *

如果使用模型，则需要先设置DataContext并选择列表，但确保可以使用使用LINQ时生成的类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T19:32:08.097

我定义了一个类似的对象。我按照上面提到的绑定到列表的帖子进行了操作，虽然绑定有效，但我无法在控制器的操作参数中使用绑定白名单或黑名单。模型是一个 IList

# java - 具有多个会话工厂的 HibernateTransactionManager(Spring)

> ID：407492
> 
> 赞同：1
> 
> 时间：2009-01-02T17:29:28.047
> 
> 标签：java, hibernate, spring, transactions

我有一个使用 HibernateTransactionManager 进行事务管理的 DAO 实现，并且该应用程序有 2 个会话工厂。我在下面的 transactionManager.commit() 行遇到异常。**在与不同会话工厂相关的事务管理器中执行休眠操作会导致问题吗？**

```
TransactionStatus status = transactionManager.getTransaction(def);
try{
    doHibernateStuff1();  //Does Hibernate stuff with session
                          //factory related to Tx Manager
    doHibernateStuff2();  //Does Hibernate stuff with session 
                          //factory not related to Tx Manager
}
catch(DataAccessException){
 transactionManager.rollback(status);
}
transactionManager.commit(status); //Exception happens here. 
```

该异常似乎试图 `doHibernateStuff2();`在`txManager.commit()`.

如果您想建议一种解决方法和/或适当的方法，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:33:39.003

您是否使用 XA 驱动程序连接到事务中涉及的两个数据源？否则不能工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-02T14:19:40.247

我知道这是一个老问题，但我遇到了类似的问题。我假设 Brandon 有2 个用于**不同数据源的****会话工厂**，并且他正在使用**HibernateTransactionManager**。而且我相信使用这样的经理是问题所在。从我读过的内容来看，HibernateTransactionManager 无法使用 2 个不同的会话工厂。相反，他应该使用不同的管理器，例如 JTA 事务管理器。但前提是他需要在一个事务中访问两个数据源。否则，解决方案应该为每个会话工厂使用额外的管理器，如下面的链接中提到的：

 ****[类似的问题](https://stackoverflow.com/questions/8700160/spring-hibernatetransactionmanager-handling-multiple-datasources)

# java - Google Web Toolkit 是否类似于 AWT 和 Swing

> ID：407506
> 
> 赞同：9
> 
> 时间：2009-01-02T17:35:13.277
> 
> 标签：java, swing, gwt, awt

我简要地研究了[GWT](http://code.google.com/webtoolkit/)，并喜欢我可以用 Java 开发并将应用程序编译为 HTML 和 JavaScript 的想法。GWT 和 AWT 和 Swing 背后的概念是相同还是不同？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-02T17:45:13.460

它的编程非常相似（以 Swing 为模式），代码是 100% java（使用标准 Java 编译器编译没有错误），但它的工作方式非常不同。它不是编译成 Java 应用程序，而是编译成发送到浏览器的 Javascript。

这种无需实际编写 Javascript 和 HTML 即可编写好的活动 Javascript 的能力非常好。

此外，由于它的程序很像摇摆，你可以做一些事情，比如添加影响其他控件的侦听器很容易。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-04T17:27:49.453

GWT 在使用小部件、面板和它提供的 EventListener 方面与 Swing 非常相似。看待 GWT 的另一种方式是将 Javascript 和 HTML 视为汇编语言，而将 GWT 视为一种生成 Javascript 和 HTML 的高级语言。使用 GWT，您可以使用与构建桌面应用程序相同的工具轻松为 Web 开发类似桌面的应用程序

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-02T17:57:06.460

定义概念。

AWT/Swing 用于桌面 Java 应用程序或小程序。它们都需要 JVM 才能运行。

GWT 用于将 Java 代码转换为 Javascript。这仅在 Javascript 引擎上运行，即浏览器。

如上所述，API 设计类似于 Swing。您将获得与 Swing 中相同的面板、按钮和其他组件类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-02T17:44:17.813

AWT 和 Swing 用于编写独立的应用程序（在较小程度上是小程序）。GWT 应该使编程 Web 应用程序类似于独立应用程序。我不会使用 GWT 编写非 Web 应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T17:49:48.677

GWT 在概念上与 Swing 相似，但更多的是 JSP 的替代品。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T21:21:55.050

GWT 是一个 javascript 工具包，允许您用 Java 编写 javascript。与 Swing 和 AWT 唯一真正的相似之处是它们是用于创建用户界面的工具包并且它们使用 Java。最终产品不同，使用它们的真正目的也不同。GWT 使您能够为 Web 浏览器生成 ajax 用户界面，而其他 2 则为您提供控制台（或小程序）Java 应用程序。在我看来，使用 GWT 的真正原因是为原型设计目的获得一个快速的 ajax 接口。但我不认为它真的准备好生产——即我不认为谷歌在他们自己的网络应用程序中使用它。对于更健壮的 ajax webapps，更好的选择是[http://developer.yahoo.com/yui/](http://developer.yahoo.com/yui/)或[http://script.aculo.us/](http://script.aculo.us/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-04T18:02:33.767

*免责声明：虽然我在 IT Mill 工作，但这只是为原始发布者提供信息。这不是营销垃圾邮件。*

如果您喜欢能够编写 Java 并从中获得网页的想法，您可能会对[IT Mill Toolkit](http://www.itmill.com/itmill-toolkit/)感兴趣。它是一个用于在 J2EE 堆栈之上制作 RIA 软件的工具包，它大量使用 GWT。

基本思想之一是 GWT 生成的代码与任何其他 JS/Ajax 流量一样容易受到客户端伪造攻击。IT Mill Toolkit 确保数据也在服务器端得到验证。

该工具包的设计方式也使得如果您熟悉 Swing，那么在使用它时应该没有问题。

# code-golf - Code Golf：Pi 的莱布尼茨公式

> ID：407518
> 
> 赞同：31
> 
> 时间：2009-01-02T17:42:45.507
> 
> 标签：code-golf, rosetta-stone

我最近在“[您有什么更具争议的编程观点”中发布](https://stackoverflow.com/questions/406760/whats-your-most-controversial-programming-opinion)[了我最喜欢的面试白板编码问题](https://stackoverflow.com/questions/406760/whats-your-most-controversial-programming-opinion#406948)之一，即编写一个使用[莱布尼茨公式](http://en.wikipedia.org/wiki/Leibniz_formula_for_pi)计算 Pi 的函数。

它可以通过多种不同的方式来处理，退出条件需要一些思考，所以我认为它可能会成为一个有趣的代码高尔夫问题。最短的代码获胜！

> 假设 Pi 可以使用函数 4 * (1 - 1/3 + 1/5 - 1/7 + ...) 来估计，更多的项可以提供更高的准确性，请编写一个计算 Pi 到 0.00001 以内的函数。

**编辑：2008 年 1 月 3 日**

正如评论中所建议的那样，我将退出条件更改为 0.00001 以内，因为这就是我真正的意思（由于四舍五入，精确到小数点后 5 位要困难得多，所以我不想在面试中问这个问题，而在 0.00001 以内是更容易理解和实现退出条件）。

另外，为了回答评论，我想我的意图是解决方案应该计算迭代次数，或者检查它何时完成了足够的工作，但是没有什么可以阻止您预先计算迭代次数并使用该数字。我真的很感兴趣地问了这个问题，看看人们会想出什么。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-01-03T12:51:45.220

**J，14 个字符**

```
4*-/%>:+:i.1e6 
```

* * *

*解释*

*   `1e6`是数字 1 后跟 6 个零 (1000000)。
*   `i.y`生成第一个`y`非负数。
*   `+:`是一个将列表参数中的每个元素加倍的函数。
*   `>:`是一个函数，它使列表参数中的每个元素加一。

因此，表达式`>:+:i.1e6`生成前一百万个奇数：

> 1 3 5 7 ...

*   `%`是倒数运算符（分子“1”可以省略）。
*   `-/`对列表参数中的每个元素进行交替求和。

因此，该表达式`-/%>:+:i.1e6`生成前一百万个奇数的倒数的交替和：

> 1 - 1/3 + 1/5 - 1/7 + ...

*   `4*`是乘以四。如果将前一个总和乘以四，则得到 π。

就是这样！[J](http://www.jsoftware.com/)是一种强大的数学语言。

* * *

*编辑*：因为生成9！(362880) 项的交替和足以具有 5 个十进制数字的精度，并且由于莱布尼茨公式也可以这样写：

> 4 - 4/3 + 4/5 - 4/7 + ...

...您可以编写一个较短的**12 个字符**版本的程序：

```
-/4%>:+:i.9! 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-01-03T02:19:18.430

**语言：Brainfuck，字符数：51/59**

这算不算？=]

因为 Brainfuck 中没有浮点数，所以很难让除法正常工作。Grr。

没有换行符（51）：

```
+++++++[>+++++++<-]>++.-----.+++.+++.---.++++.++++. 
```

使用换行符（59）：

```
+++++++[>+++++++>+<<-]>++.-----.+++.+++.---.++++.++++.>+++. 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-01-02T18:59:39.503

## Perl

### 26 个字符

26 只是函数，27 用于计算，31 用于打印。从评论到[这个答案](https://stackoverflow.com/questions/407518/code-golf-leibniz-formula-for-pi#407647)。

```
sub _{$-++<1e6&&4/$-++-&_}       # just the sub
sub _{$-++<1e6&&4/$-++-&_}_      # compute
sub _{$-++<1e6&&4/$-++-&_}say _  # print 
```

### 28 个字符

28 只是计算，34 用于打印。从评论。请注意，此版本不能使用“说”。

```
$.=.5;$\=2/$.++-$\for 1..1e6        # no print
$.=.5;$\=2/$.++-$\for$...1e6;print  # do print, with bonus obfuscation 
```

### 36 个字符

36 只计算，42 打印。从评论中，哈德森对 dreeves 的重新安排的看法。

```
$/++;$\+=8/$//($/+2),$/+=4for$/..1e6
$/++;$\+=8/$//($/+2),$/+=4for$/..1e6;print 
```

关于迭代次数：就我的数学记忆而言，400000 可证明足以精确到 0.00001。但是一百万（或低至 8e5）实际上使十进制扩展实际上匹配 5 个小数位，并且它是相同的字符数，所以我保留了它。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-01-03T03:20:46.213

**红宝石，33 个字符**

```
(0..1e6).inject{|a,b|2/(0.5-b)-a} 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-01-02T18:19:39.363

另一个 C# 版本：

（60 个字符）

```
4*Enumerable.Range(0, 500000).Sum(x => Math.Pow(-1, x)/(2*x + 1));  // = 3,14159 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-01-02T17:50:20.080

**Python**中的 52 个字符：

```
print 4*sum(((-1.)**i/(2*i+1)for i in xrange(5**8))) 
```

（51 从 xrange 中删除了“x”。）

Octave（或 Matlab）中的 36 个字符：

```
l=0:5^8;disp((-1).^l*(4./(2.*l+1))') 
```

（执行“format long;”以显示所有有效数字。）省略 'disp' 我们达到 30 个字符：

```
octave:5> l=0:5^8;(-1).^l*(4./(2.*l+1))'
ans = 3.14159009359631 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-01-03T14:52:29.330

**Oracle SQL** 73 个字符

```
select -4*sum(power(-1,level)/(level*2-1)) from dual connect by level<1e6 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-01-03T01:46:22.503

**语言：C，字符数：71**

```
float p;main(i){for(i=1;1E6/i>5;i+=2)p-=(i%4-2)*4./i;printf("%g\n",p);} 
```

**语言：C99，字符数：97**（包括必需的换行符）

```
#include <stdio.h>
float p;int main(){for(int i=1;1E6/i>5;i+=2)p-=(i%4-2)*4./i;printf("%g\n",p);} 
```

我应该注意，上述版本（相同）会跟踪额外的迭代是否会影响结果。因此，它执行最少数量的操作。要添加更多数字，请替换`1E6`为`1E(num_digits+1)`或`4E5`替换为`4E(num_digits)`（取决于版本）。对于完整的程序，`%g`可能需要更换。 `float`可能也需要更改`double`为。

**语言：C，字符数：67**（见注释）

```
double p,i=1;main(){for(;i<1E6;i+=4)p+=8/i/(i+2);printf("%g\n",p);} 
```

此版本使用已发布算法的修改版本，正如其他一些答案所使用的那样。此外，它不像前两个解决方案那样干净/高效，因为它强制进行 100 000 次迭代，而不是检测迭代何时变得毫无意义。

**语言：C，字符数：24（作弊**）

```
main(){puts("3.14159");} 
```

但是，不适用于数字计数> 6。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-01-03T10:57:28.883

**哈斯克尔**

我把它缩小到 34 个字符：

```
foldl subtract 4$map(4/)[3,5..9^6] 
```

此表达式在评估时产生 3.141596416935556。

编辑：这是一个较短的版本（33 个字符），它使用 foldl1 而不是 foldl：

```
foldl1 subtract$map(4/)[1,3..9^6] 
```

编辑 2：9^6 而不是 10^6。一个必须是经济的;）

编辑 3：分别用 foldl 和 foldl1 替换为 foldl' 和 foldl1' - 由于编辑 2，它不再溢出。感谢 ShreevatsaR 注意到这一点。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-01-22T19:47:57.427

MATLAB 中的 23 个字符：

```
a=1e6;sum(4./(1-a:4:a)) 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2009-01-02T18:44:42.327

**F#**：

尝试#1：

```
let pi = 3.14159 
```

作弊？不，它以风格取胜！

尝试#2：

```
 let pi =
    seq { 0 .. 100 }
    |> Seq.map (fun x -> float x)
    |> Seq.fold (fun x y -> x + (Math.Pow(-1.0, y)/(2.0 * y + 1.0))) 0.0
    |> (fun x -> x * 4.0) 
```

它不像它可能得到的那么紧凑，但是非常地道的 F#。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-01-05T03:53:43.917

## 普通的 lisp，55 个字符。

```
(loop for i from 1 upto 4e5 by 4 sum (/ 8d0 i (+ i 2))) 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-01-03T02:04:04.590

### Mathematica，27 个字符（可以说低至 26，或高达 33）

```
NSum[8/i/(i+2),{i,1,9^9,4}] 
```

如果您删除最初的“N”，那么它会以（巨大的）分数形式返回答案。

如果 Mathematica 不需要打印语句来输出其结果是作弊，则在前面加上“ `Print@`”，总共 33 个字符。

### 注意：

如果硬编码条款的数量是作弊，那么我认为还没有任何答案可以做到这一点。检查当前术语何时低于某个阈值并不比硬编码术语的数量更好。仅仅因为当前项仅更改第 6 位或第 7 位，并不意味着足够后续项的总和不会更改第 5 位。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-01-03T02:18:24.420

使用交替序列中的误差项的公式（因此，实现所需精度所需的迭代次数不会硬编码到程序中）：

```
public static void Main(string[] args) {
    double tolerance = 0.000001;
    double piApproximation = LeibnizPi(tolerance);
    Console.WriteLine(piApproximation);
}

private static double LeibnizPi(double tolerance) {
    double quarterPiApproximation = 0;

    int index = 1;
    double term;
    int sign = 1;
    do {
        term = 1.0 / (2 * index - 1);
        quarterPiApproximation += ((double)sign) * term;
        index++;
        sign = -sign;
    } while (term > tolerance);

    return 4 * quarterPiApproximation;
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-01-02T18:16:11.370

C＃：

```
public static double Pi()
{
    double pi = 0;
    double sign = 1;
    for (int i = 1; i < 500002; i += 2)
    {
        pi += sign / i;
        sign = -sign;
    }
    return 4 * pi;
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-01-02T18:30:27.080

珀尔：

```
$i+=($_&1?4:-4)/($_*2-1)for 1..1e6;print$i 
```

总共42个字符。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-01-02T19:37:42.547

Ruby，41 个字符（使用 irb）：

```
s=0;(3..3e6).step(4){|i|s+=8.0/i/(i-2)};s 
```

或者这个稍长的非 irb 版本：

```
s=0;(3..3e6).step(4){|i|s+=8.0/i/(i-2)};p s 
```

这是修改后的莱布尼茨：

1.  组合成对的术语。这给了你 2/3 + 2/35 + 2/99 + ...
2.  Pi 变为 8 * (1/(1 * 3) + 1/(5 * 7) + 1/(9 * 11) + ...)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2009-01-03T14:19:50.643

**F#**（交互模式）（59 个字符）

```
{0.0..1E6}|>Seq.fold(fun a x->a+ -1.**x/(2.*x+1.))0.|>(*)4. 
```

（产生警告但省略演员表）

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-01-02T18:52:42.777

这是 MUMPS 中的一个解决方案。

```
pi(N)
 N X,I
 S X=1 F I=3:4:N-2 S X=X-(1/I)+(1/(I+2))
 Q 4*X 
```

参数 N 表示要使用多少个重复分数。也就是说，如果您传入 5，它将评估 4 * (1 - 1/3 + 1/5 - 1/7 + 1/9 - 1/11)

一些经验测试表明，N=272241 是在截断到小数点后 5 位时给出正确值 3.14159 的最低值。您必须转到 N=852365 才能得到一个四舍五入为 3.14159 的值。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2009-01-03T02:27:13.483

**Javascript：**

```
a=0,b=-1,d=-4,c=1e6;while(c--)a+=(d=-d)/(b+=2) 
```

在 JavaScript 中。51 个字符。显然不会赢，但是嗯。:P

编辑——感谢 Strager，现在更新为 46 个字符。:)

* * *

**更新** *（2010 年 3 月 30 日）*

[大卫默多克](https://stackoverflow.com/users/160173/david-murdoch)更快（精确到小数点后 5 位）的 43 个字符*版本*

```
for(a=0,b=1,d=4,c=~4e5;++c;d=-d)a-=d/(b-=2) 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-01-03T09:00:31.660

C# 使用迭代器块：

```
static IEnumerable<double> Pi()
{
    double i = 4, j = 1, k = 4;
    for (;;)
    {
        yield return k;
        k += (i *= -1) / (j += 2);
    }
} 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2009-01-04T06:33:17.543

作为记录，这个 Scheme 实现有 95 个字符，忽略了不必要的空格。

```
(define (f)
  (define (p a b)
    (if (> a b)
      0
      (+ (/ 1.0 (* a (+ a 2))) (p (+ a 4) b))))
  (* 8 (p 1 1e6))) 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-01-02T17:46:29.587

这是使用 C# 的递归答案。它只能在发布模式下使用 x64 JIT 工作，因为这是唯一应用尾调用优化的 JIT，并且由于系列收敛如此缓慢，它会导致`StackOverflowException`没有它。

将`IteratePi`函数用作匿名 lambda 会很好，但由于它是自递归的，我们必须开始使用 Y 组合器做各种可怕的事情，所以我把它作为一个单独的函数。

```
public static double CalculatePi()
{
    return IteratePi(0.0, 1.0, true);
}

private static double IteratePi(double result, double denom, bool add)
{
    var term = 4.0 / denom;
    if (term < 0.00001) return result;    
    var next = add ? result + term : result - term;
    return IteratePi(next, denom + 2.0, !add);
} 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-01-02T21:49:37.677

### 语言：dc，字符数：35

```
dc -e '9k0 1[d4r/r2+sar-lad274899>b]dsbxrp' 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2009-01-03T00:55:05.807

**语言：C99（隐式返回 0），字符数：99（95 + 4 个必需空格）**

退出条件取决于当前值，而不是固定计数

```
#include <stdio.h>

float p, s=4, d=1;
int main(void) {
  for (; 4/d > 1E-5; d += 2)
        p -= (s = -s) / d;
  printf("%g\n", p);
} 
```

压缩版

```
#include<stdio.h>
float
p,s=4,d=1;int
main(void){for(;4/d>1E-5;d+=2)p-=(s=-s)/d;printf("%g\n",p);} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-01-03T02:59:03.043

当前的大多数答案都假设他们将在一定次数的迭代中获得 5 位数的准确度，并且这个数字被硬编码到程序中。我对这个问题的理解是，程序本身应该弄清楚它何时得到精确到 5 位数的答案并停在那里。基于这个假设，这是我的 C# 解决方案。我没有费心尽量减少字符的数量，因为它无法与已经存在的一些答案竞争，所以我想我会让它变得可读。:)

```
 private static double GetPi()
    {
        double acc = 1, sign = -1, lastCheck = 0;

        for (double div = 3; ; div += 2, sign *= -1)
        {
            acc += sign / div;

            double currPi = acc * 4;
            double currCheck = Math.Round(currPi, 5);

            if (currCheck == lastCheck)
                return currPi;

            lastCheck = currCheck;
        }
    } 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-01-02T18:13:55.443

红宝石：

```
irb(main):031:0> 4*(1..10000).inject {|s,x| s+(-1)**(x+1)*1.0/(2*x-1)}
=> 3.14149265359003 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-01-03T01:51:51.840

**C# 作弊 - 50 个字符**：

```
static single Pi(){
  return Math.Round(Math.PI, 5));
} 
```

它只说“考虑到公式编写一个函数......”它没有说以编程方式重现公式:) 跳出框框思考......

**C# LINQ - 78 个字符**：

```
static double pi = 4 * Enumerable.Range(0, 1000000)
               .Sum(n => Math.Pow(-1, n) / (2 * n + 1)); 
```

**C# 备用 LINQ - 94 个字符**：

```
static double pi = return 4 * (from n in Enumerable.Range(0, 1000000)
                               select Math.Pow(-1, n) / (2 * n + 1)).Sum(); 
```

最后 - 这采用前面提到的算法并在数学上对其进行压缩，因此您不必担心不断变化的符号。

**C# 速记 - 89 个字符（不包括不需要的空格）**：

```
static double pi()
{
  var t = 0D;
  for (int n = 0; n < 1e6; t += Math.Pow(-1, n) / (2 * n + 1), n++) ;
  return 4 * t;
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2009-01-03T14:02:16.340

AWK 中的 64 个字符：

```
~# awk 'BEGIN {p=1;for(i=3;i<10^6;i+=4){p=p-1/i+1/(i+2)}print p*4}'
3.14159 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2009-01-05T10:23:53.987

```
#!/usr/bin/env python
from math import *
denom = 1.0
imm = 0.0
sgn = 1
it = 0
for i in xrange(0, int(1e6)):
    imm += (sgn*1/denom)
    denom += 2
    sgn *= -1    
print str(4*imm) 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-01-09T21:56:06.890

C++

```
double LeibnizPi( double tolerance )
{
    double sum = 1.0;
    for( int plus_div = 5, minus_div = -3, limit = 10 / tolerance; plus_div < limit ; plus_div += 4, minus_div -= 4 )
        sum += 1./plus_div + 1./minus_div;
    return 4 * sum;
} 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-01-10T20:59:20.483

注意到之后

```
(= (- (/ 4 n)
      (/ 4 (+ n 2)))
   (/ 8 n (+ n 2)))
```

或者，用更熟悉的表示法：

```
4 4 8
- - --- = ------
n n+2 n(n+2)
```

Common Lisp，带有`do*`循环（62 个基本字符）：

```
(do* ((n 1 (+ n 4))
      (p 8/3 (+ p (/ 8 n (+ n 2)))))
     ((< (- pi p) 1e-6)
      p) 
```

带有尾递归函数（70 个基本字符）：

```
(defun l (n p)
  (if (< (- pi p) 1e-6)
      p
      (l (+ n 4)
          (+ p (/ 8 n (+ n 2))))))
(l 1 0) 
```

并使用扩展循环（86 个基本字符）：

```
(loop for n from 1 by 4
      sum (/ 8 n (+ n 2)) into p
      until (< (- pi p) 1e-6)
      finally (return p)) 
```

所有这些都假设初步检查我们必须走多远才能获得所需的准确性是作弊。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-01-19T04:10:17.960

```
double d = 1;
double s = 1;
double pi = 0;

while(4.0 / d > 0.000001){
    pi += s*4.0/d;
    d+=2;
    s = -s;        
}
printf("%f\n", pi); 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2010-09-14T16:51:59.767

爪哇

```
 double pi=0,s=-1,i=1;
    for (;i<1E6;i+=2)pi+=((1d/i)*(s=-s)); 
    pi*=4; 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2009-01-03T04:23:32.187

**VB 117 个字符**：

```
Function Pi()
  Dim t = 0D
  For n = 0 To 1000000
    t += Math.Pow(-1, n) / (2 * n + 1)
  Next
  Return 4 * t
End Function 
```

**VB LINQ 115 字符（省略不必要的续行）**：

```
Function Pi()
  Return 4 * Enumerable.Range(0, 1000000) _
             .Sum(Function(n) Math.Pow(-1, n) / (2 * n + 1))
End Function 
```

然后调用：

```
Sub Main()
  Console.WriteLine("{0:n5}", Pi)
End Sub 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2009-01-03T11:14:27.240

另一个 VB 解决方案，使用相当酷的聚合语法：

```
Public ReadOnly Pi As Double = 4 * Aggregate i In Enumerable.Range(0, 100000) _
                                   Select (-1) ^ i / (i * 2 + 1) Into Sum() 
```

仅表达式：74 个字符，没有不必要的空格。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-01-04T11:45:42.700

Erlang，~126 个字符：

```
-module (pi).
-export ([pi/0]).

pi() -> 4 * pi(0,1,1).
pi(T,M,D) ->
    A = 1 / D,
    if A > 0.00001 
              -> pi(T+(M*A), M*-1, D+2);
        true  -> T
    end. 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2009-01-05T14:04:59.987

这是我用 C++ 编写的，可能是最长的方法：P

```
double pi(){
   bool add = true;
   double rPi = 0;
   for(long i = 1; i < 99999999; i=i+2)
   {
            double y = (double) i;
            double x = (double) 1;
            if(add)
            {
                   rPi = rPi + (x/y);
                   add = false;
            }
            else
            {
                    rPi = rPi - (x/y);
                    add = true;
            }
   }
            return (rPi * (double) 4);
   } 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2009-01-18T08:53:26.740

我只是在阅读了关于有争议的观点的话题中的采访问题后才写了这篇文章。这不是很漂亮，但我花了大约 3-4 分钟，我正在检查每个循环的准确性。C++。我明天会醒来并发布一个不糟糕的解决方案:)

```
double get_pi(int acc)
{

  double pi;
  double dynamicpart;
  int operationCoeff = 1;
  int denom = 3;
  while(1)
  { 
      dynamicpart =
         1/denom + operationCoeff*(denom+2);
      pi = 4*(1-dynamicpart);
      if(!(pi*acc*10-(int)pi*acc*10)) break;
)
      denom+=2;
      operationCoeff = -operationCoeff;
  }

} 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2009-08-19T00:46:32.077

呃....作为数值处理的一般规则，应该从*最小*项到最大项对系列求和，以避免精度损失的麻烦。所以在

## fortran77

精简（248 个字符）

```
 function pi(n)
      pi=0.
      t=10**(-n-0.5)
      i=int(4/t)
      i=i/2
      s=-1\.                     
      do 1 j=i*2+1,1,-2
         pi = pi + s/j
         s=-s
 1    continue
      pi=abs(pi)*4              
      return
      end 
```

带脚手架和评论（600 个字符）

```
 program leibnitz

      n=5
      p=int(pi(n)*10.**n)/10.**n
      write(6,*)p 

      stop
      end

c     Returns pi computed to <n> digits by the leibniz formula
      function pi(n)
      pi=0.
c     find the smallest term we need by insuring that it is too small to
c     effect the interesting digits.
      t=10**(-n-0.5)
      i=int(4/t)
      i=i/2
      s=-1\.                     ! sign of term, might be off by one, but
      do 1 j=i*2+1,1,-2
         pi = pi + s/j
         s=-s
 1    continue
      pi=abs(pi)*4              ! we fix the sign problem here
      return
      end 
```

输出：

```
 3.1415901 
```

它似乎适用于精度高达 6ish 的任意位数`real`。它*没有*针对速度或最少操作次数进行优化。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2009-08-21T15:43:20.067

爪哇

```
void pi(){
    double x=1,y=1,d=1;
    for(;x<1E6;) { y=-y;d+=y/((2*x++)+1); }
    System.out.println(d*4);
} 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2009-10-11T21:13:20.517

## Python 3（40 字节）

```
sum(8/(n*(n+2))for n in range(1,5**8,4)) 
```

此版本使用来自[@Svante 的答案的](https://stackoverflow.com/questions/407518/code-golf-leibniz-formula-for-pi/431745#431745)优化。

### 打印 +7 字节

```
print(sum(8/(n*(n+2))for n in range(1,5**8,4))) 
```

## Python 2.x +1 字节

```
sum(8./(n*(n+2))for n in range(1,5**8,4)) 
```

### 打印 +6 字节

```
print sum(8./(n*(n+2))for n in range(1,5**8,4)) 
```

[http://codepad.org/amtxUxKp](http://codepad.org/amtxUxKp)

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2010-02-16T17:47:31.780

# Lua，46 个字符

```
p=4 for i=3,9^6,4 do p=p-8/i/(i+2)end print(p) 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2010-12-27T18:22:50.373

**PHP，99 个字符**

`$output =`

`${!${''}=function(){$pi=1;for($i=0;$i<pow(10,6);$i++){$pi+=($i%2?1:-1)/(3+$i*2);}return $pi*4;}}();`

`var_dump($output);`

我想有一些我不知道的漂亮技巧可以减少这个答案！[从这篇文章](https://stackoverflow.com/questions/3011595/code-golf-one-line-php-syntax)中获取了单行输出技巧。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2011-01-18T19:41:47.663

**R - 27 个字符**

```
sum(4/seq(1,1e6,2)*c(1,-1)) 
```

* * *

## 回答 #46

> 赞同：-1
> 
> 时间：2009-12-03T14:39:13.050

1 个字符：. 写在“MySuperDuperDomainSpecificLanguageThatOnlyReturnsThisOneAnswerAndNothingElse”中。

是的，这只是个玩笑，但说真的，除非您禁止 DSL，否则每场 Code Golf 比赛都可能由某个编写自己的语言的 goober 赢得，该语言使用一个字符来返回一个结果......

# sql-server - SQL Server Compact 有哪些限制？（或者——如何选择在 MS 平台上使用的数据库？）

> ID：407521
> 
> 赞同：55
> 
> 时间：2009-01-02T17:43:36.287
> 
> 标签：sql-server, database, visual-studio-2008, sql-server-ce

我想使用 MS Visual C# Express 构建的应用程序（如果需要，我愿意升级到 Standard），它需要一个数据库。

我对 SQL Server Compact 感到非常兴奋——因为我不希望那些在他们的计算机上安装我的应用程序的人不得不安装整个 SQL Server 或类似的东西。我希望最终用户安装起来尽可能简单。

所以我很兴奋，直到我对表格中的列的操作似乎受到限制。我创建了一个新数据库，创建了一个表，当我去创建列时，似乎没有“文本”数据类型 - 只是一种称为“ntext”的东西，似乎限制为 255 个字符。“int”似乎仅限于 4（我想要 11）。而且似乎没有“auto_increment”功能。

这些是我必须忍受的真正限制吗？（或者是因为我使用的是“Express”而不是“Standard”）。如果这些是真正的限制，那么满足我要求的其他数据库选项是什么？（对于大用户来说易于安装 - 我假设我的最终用户只是计算机的普通用户，如果它很复杂，我的应用程序会感到沮丧）

-阿迪娜

PS：我还希望将我的数据库数据加密给最终用户。我不希望他们能够直接访问数据库表。

聚苯乙烯。我确实阅读了：http: [//www.microsoft.com/Sqlserver/2005/en/us/compact.aspx](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx) 并没有看到关于这些特殊限制的讨论

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-02T18:06:06.303

我不确定加密，但您可能会发现此链接有帮助：http:
[//msdn.microsoft.com/en-us/library/ms171955.aspx](http://msdn.microsoft.com/en-us/library/ms171955.aspx)

至于其余部分：
“Text”和“auto_increment”让我想起了 Access。SQL Server Compact 应该与 SQL Server 的*服务器*版本升级兼容，因为紧凑型数据库中使用的查询和表应无需修改即可转移到完整数据库。考虑到这一点，您应该首先查看[SQL Server 类型和名称，](http://msdn.microsoft.com/en-us/library/ms172424.aspx)而不是访问名称：在这种情况下，即`varchar(max)`、`bigint`和`identity`列。

不幸的是，您会注意到 varchar(max) 失败了，因为 Compact Edition 还没有 varchar(max) 类型。希望他们能尽快解决这个问题。但是，您正在查看的 ntext 类型支持超过 255 个字节：实际上是 2 ^(30)，相当于超过 5 亿个字符。

最后，bigint 使用 8 个字节进行存储。您要求的是 11。但是，我认为您可能会对此感到困惑，因为存储大小表示可用的十进制位数。绝对不是这种情况。8 个字节的存储允许值高达 2 ^(64)，这将容纳多于 11 位的数字。如果您有这么多项目，您可能无论如何都想要一个服务器级数据库。如果你真的想用数字来思考，也`numeric`提供了一种类型。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-06T16:41:02.157

一些希望有帮助的评论：

1st - 不要使用 SQLite，除非您喜欢在写入期间锁定整个数据库（[http://www.sqlite.org/faq.html#q6](http://www.sqlite.org/faq.html#q6)），也许更重要的是在 .Net 应用程序中它不是线程安全的或更重要的是它必须重新编译以支持线程（[http://www.sqlite.org/faq.html#q6](http://www.sqlite.org/faq.html#q6)）

作为我当前项目的替代方案，我查看了 Scimore DB（他们有一个带有 ADO.Net 提供程序的嵌入式版本：[http](http://www.scimore.com/products/embedded.aspx) ://www.scimore.com/products/embedded.aspx ）但我需要使用 LINQ To SQL 作为O/RM 所以我不得不使用 Sql Server CE。

自动增量（如果您指的是自动键增量）一直是 - 示例表：

-- 表用户

```
CREATE TABLE Tests (
    Id       **int IDENTITY(1,1) PRIMARY KEY NOT NULL,**
    TestName     nvarchar(100) NOT NULL,
    TimeStamp    datetime NOT NULL
)
GO 
```

至于文字大小，我认为已经回答了。

以下是来自 microsoft technet 的加密信息链接：( [http://technet.microsoft.com/en-us/library/ms171955.aspx](http://technet.microsoft.com/en-us/library/ms171955.aspx) )

希望这个对你有帮助....

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-09-11T05:05:03.223

不得不考虑两个因素：

1.  我经常使用 Sql Compact，它非常适合它的用途——单个用户、嵌入式数据库，以及单个文件数据存储。它具有所有 SQL 优点和事务。它对我来说很好地处理了并行性。请注意，此页面上的反对者很少经常使用该产品。不要在服务器上使用它，那不是它的用途。我的许多客户甚至不知道该文件是“数据库”，这只是一个实施问题。
2.  你想加密来自用户的数据——大概是这样他们只能从你的程序中查看它。这根本不会发生。如果您的程序可以解密数据，那么您必须将密钥存储在某个地方，并且足够敬业的攻击者会找到它，期间。

您可能能够很好地隐藏密钥，以至于恢复它的努力不值得信息的价值。Windows 有一些简洁的机器和用户本地加密例程可以提供帮助。但是，如果您的设计强烈要求用户永远不会找到您隐藏在他们计算机上的数据（但您的程序会），您需要重新设计 - 保证根本无法实现。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-02T17:55:23.283

SQL CE 对我来说是个谜。我们真的需要另一个不同的 SQL 数据库平台吗？这是过去几年中第三次针对 MS 的移动平台……我不太相信它会是最后一个。它与 SQL Server 共享的技术并不多——据我所知，它是一种从头开始的新技术。

我已经尝试过了，然后在 SQLite 和 Codebase 上都取得了更大的成功。

编辑：[这是](http://msdn.microsoft.com/en-us/library/bb896140.aspx)（许多）差异的列表。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-05-20T14:45:32.850

`ntext`支持非常大的文本数据（请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms172424%28SQL.110%29.aspx) - 这是针对 Compact 4.0，但对于您提到的数据类型同样适用于 3.5）。

`int`是数字数据类型，因此大小`4`表示 4 字节/32 位存储空间（–2,147,483,648 到 2,147,483,647）。如果您打算在单个列中存储 11 个字节的数据，请使用`varbinary`大小为 11 的类型。

SQL Server 世界中的自动递增列是使用`IDENTITY`关键字完成的。这会导致 SQL Server 在将数据插入行时自动确定列的值，从而防止与任何其他行发生冲突。

您还可以在 SQL Compact 中创建数据库时设置密码或加密数据库，以防止用户直接访问您的应用程序。请参阅[MSDN 上的保护数据库](http://technet.microsoft.com/en-us/library/ms171955.aspx)。

您上面提到的所有项目都不是真正的限制，因为他们了解如何使用 SQL Server。

话虽如此，SQL Compact 还是有一些限制。

*   不支持`NVARCHAR(MAX)`
    *   `NTEXT`工作得很好
*   不支持`VIEW`s 或`PROCEDURE`s
    *   这是我认为的主要限制

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-02T18:19:05.327

我曾多次使用各种 SQL Server Compact 版本，但仅作为移动平台上的数据捕获存储库——它适用于与服务器数据库同步，在这种情况下无疑是可选的选择。

但是，如果您需要做更多的事情并充当应用程序的主数据库，那么我建议 SQLLite 可能是更好的选择，它完全可靠，广泛支持并在各种地方都可以找到（在 iPhone 上用于示例）但功能惊人（虚拟现实模拟器[OpenSim](http://opensimulator.org)将其用作默认数据库）并且还有[很多其他的](http://www.sqlite.org/famous.html)（包括 Microsoft）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-16T05:32:27.790

我还必须在这里使用[VistaDB](http://www.vistadb.net)作为 SQL CE 的替代方案。

VistaDB 确实支持加密（Blowfish），它还支持 TEXT 和 NTEXT（包括它们上的 FTS 索引）。

是的，上面的帖子是正确的，因为您必须查看 SQL Server 类型才能真正匹配它们，VistaDB 也使用 SQL Server 类型（我们实际上支持的比 SQL CE 更多；只缺少 XML）。

要查看[VistaDB 和 SQL CE 之间的其他比较，](http://www.vistadb.net/compare/sql-ce.aspx)请访问比较页面。[另请参阅有关 VistaDB 优势](https://stackoverflow.com/questions/55273/what-are-the-advantages-of-vistadb)的 SO 线程以获取更多信息。

（完全披露——我是 VistaDB 的所有者，所以我可能有偏见）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-01-24T01:16:53.840

根据这篇文章（[http://www.nelsonpires.com/web-development/microsoft-webmatrix-the-dawn-of-a-new-era/](http://www.nelsonpires.com/web-development/microsoft-webmatrix-the-dawn-of-a-new-era/)），它说因为它使用数据库文件，所以只有一个进程可以每次读/写都访问它，因此它需要对文件的独占访问，它也被限制为 256 个连接，并且整个文件很可能必须加载到内存中。因此，SQL Server compact 在您的站点增长时可能对您的站点不利。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-02T17:49:53.810

有一些限制......乔尔似乎已经解决了细节问题。SQL CE 非常适合移动开发。大多数“嵌入式”数据库解决方案都有类似的约束。查看

*   [SQLite](http://sqlite.phxsoftware.com/)

    *   没有`TEXT`字段字符限制
    *   `INTEGER PRIMARY KEY`仅在列上自动递增
    *   一些第三方[加密支持](http://www.google.com/search?q=sqlite+encrypt)
*   [埃森特](http://www.codeplex.com/ManagedEsent)

    *   （非托管代码不是我的强项，我无法破译[非托管文档](http://msdn.microsoft.com/en-us/library/ms683072(VS.85).aspx)）

# string - 为 sed 替换模式转义字符串

> ID：407523
> 
> 赞同：375
> 
> 时间：2009-01-02T17:44:15.677
> 
> 标签：string, sed, escaping

在我的 bash 脚本中，我有一个外部（从用户接收）字符串，我应该在 sed 模式中使用它。

```
REPLACE="<funny characters here>"
sed "s/KEYWORD/$REPLACE/g" 
```

如何转义字符串，以便将其作为文字替换`$REPLACE`安全地接受？`sed`

**注意：**这`KEYWORD`是一个没有匹配项等的哑子字符串。它不是由用户提供的。

* * *

## 回答 #1

> 赞同：325
> 
> 时间：2010-04-24T18:35:19.547

**警告**：这不*考虑*换行符。有关更深入的答案，请参阅[此 SO-question](https://stackoverflow.com/questions/29613304/is-it-possible-to-escape-regex-metacharacters-reliably-with-sed "是否可以使用 sed 可靠地转义正则表达式元字符")。（谢谢，[Ed Morton](https://stackoverflow.com/a/29626460/4575793)和 Niklas Peter）

请注意，逃避一切是一个坏主意。Sed 需要对许多字符进行转义才能*获得*它们的特殊含义。例如，如果您对替换字符串中的数字进行转义，它将变成反向引用。

正如 Ben Blank 所说，替换字符串中只有三个字符需要转义（转义自己，正斜杠表示语句结束，& 表示全部替换）：

```
ESCAPED_REPLACE=$(printf '%s\n' "$REPLACE" | sed -e 's/[\/&]/\\&/g')
# Now you can use ESCAPED_REPLACE in the original sed statement
sed "s/KEYWORD/$ESCAPED_REPLACE/g" 
```

如果您需要转义`KEYWORD`字符串，以下是您需要的：

```
sed -e 's/[]\/$*.^[]/\\&/g'
```

并可用于：

```
KEYWORD="The Keyword You Need";
ESCAPED_KEYWORD=$(printf '%s\n' "$KEYWORD" | sed -e 's/[]\/$*.^[]/\\&/g');

# Now you can use it inside the original sed statement to replace text
sed "s/$ESCAPED_KEYWORD/$ESCAPED_REPLACE/g" 
```

请记住，如果您使用除`/`定界符以外的字符，则需要将上述表达式中的斜杠替换为您正在使用的字符。有关解释，请参阅 PeterJCLaw 的评论。

*编辑：*由于以前没有考虑到一些极端情况，上面的命令已经改变了好几次。查看编辑历史以获取详细信息。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2015-04-30T11:40:55.677

sed 命令允许您使用其他字符而不是`/`分隔符：

```
sed 's#"http://www\.fubar\.com"#URL_FUBAR#g' 
```

双引号不是问题。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-01-02T18:31:15.427

在替换子句中特殊处理的仅有的三个文字字符是`/`（关闭子句）、`\`（转义字符、反向引用等）和`&`（在替换中包含匹配项）。因此，您需要做的就是转义这三个字符：

```
sed "s/KEYWORD/$(echo $REPLACE | sed -e 's/\\/\\\\/g; s/\//\\\//g; s/&/\\\&/g')/g" 
```

例子：

```
$ export REPLACE="'\"|\\/><&!"
$ echo fooKEYWORDbar | sed "s/KEYWORD/$(echo $REPLACE | sed -e 's/\\/\\\\/g; s/\//\\\//g; s/&/\\\&/g')/g"
foo'"|\/><&!bar 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2012-05-06T01:46:06.793

基于 Pianosaurus 的正则表达式，我制作了一个 bash 函数，可以同时转义关键字和替换。

```
function sedeasy {
  sed -i "s/$(echo $1 | sed -e 's/\([[\/.*]\|\]\)/\\&/g')/$(echo $2 | sed -e 's/[\/&]/\\&/g')/g" $3
} 
```

以下是你如何使用它：

```
sedeasy "include /etc/nginx/conf.d/*" "include /apps/*/conf/nginx.conf" /etc/nginx/nginx.conf 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2014-01-23T17:39:17.893

回复有点晚了……但是有一种更简单的方法可以做到这一点。只需更改分隔符（即分隔字段的字符）。所以，而不是`s/foo/bar/`你写`s|bar|foo`.

而且，这是执行此操作的简单方法：

```
sed 's|/\*!50017 DEFINER=`snafu`@`localhost`\*/||g' 
```

结果输出没有那个讨厌的 DEFINER 子句。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-12-29T22:51:55.223

事实证明你问错了问题。我也问错了问题。错误的原因是第一句话的开头：“在我的***bash***脚本中......”。

我有同样的问题并犯了同样的错误。如果您使用的是 bash，则不需要使用 sed 来进行字符串替换（而且使用 bash 内置的替换功能更简洁）*。*

而不是类似的东西，例如：

```
function escape-all-funny-characters() { UNKNOWN_CODE_THAT_ANSWERS_THE_QUESTION_YOU_ASKED; }
INPUT='some long string with KEYWORD that need replacing KEYWORD.'
A="$(escape-all-funny-characters 'KEYWORD')"
B="$(escape-all-funny-characters '<funny characters here>')"
OUTPUT="$(sed "s/$A/$B/g" <<<"$INPUT")" 
```

您可以专门使用 bash 功能：

```
INPUT='some long string with KEYWORD that need replacing KEYWORD.'
A='KEYWORD'
B='<funny characters here>'
OUTPUT="${INPUT//"$A"/"$B"}" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-14T23:34:43.547

使用 awk - 它更干净：

```
$ awk -v R='//addr:\\file' '{ sub("THIS", R, $0); print $0 }' <<< "http://file:\_THIS_/path/to/a/file\\is\\\a\\ nightmare"
http://file:\_//addr:\file_/path/to/a/file\\is\\\a\\ nightmare 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-02T17:58:37.660

这是我不久前使用的 AWK 的示例。它是一个打印新 AWKS 的 AWK。AWK 和 SED 相似，它可能是一个很好的模板。

```
ls | awk '{ print "awk " "'"'"'"  " {print $1,$2,$3} " "'"'"'"  " " $1 ".old_ext > " $1 ".new_ext"  }' > for_the_birds 
```

它看起来过分了，但不知何故，引号的组合可以使 ' 打印为文字。然后，如果我没记错的话，变量只是用这样的引号括起来：“$ 1”。试试看，让我知道它是如何与 SED 一起工作的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-02T20:56:17.957

这些是我发现的转义码：

```
* = \x2a
( = \x28
) = \x29

" = \x22
/ = \x2f
\ = \x5c

' = \x27
? = \x3f
% = \x25
^ = \x5e 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2013-11-22T15:29:11.137

不要忘记围绕 " 和 ' 的外壳限制所带来的所有乐趣

所以（在 ​​ksh 中）

```
Var=">New version of \"content' here <"
printf "%s" "${Var}" | sed "s/[&\/\\\\*\\"']/\\&/g' | read -r EscVar

echo "Here is your \"text\" to change" | sed "s/text/${EscVar}/g" 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2016-06-01T02:24:35.720

如果情况恰好是您正在生成一个随机密码以传递给`sed`替换模式，那么您选择要小心随机字符串中的哪一组字符。如果您选择将值编码为 base64 的密码，那么只有一个字符既可以在 base64 中使用，又是`sed`替换模式中的特殊字符。该字符是“/”，很容易从您生成的密码中删除：

```
# password 32 characters log, minus any copies of the "/" character.
pass=`openssl rand -base64 32 | sed -e 's/\///g'`; 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2017-09-01T06:35:20.697

如果您只是想替换 sed 命令中的变量值，那么只需删除示例：

```
sed -i 's/dev-/dev-$ENV/g' test to sed -i s/dev-/dev-$ENV/g test 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2017-09-30T19:41:37.517

我对 sedeasy 函数进行了改进，该函数将使用制表符等特殊字符中断。

```
function sedeasy_improved {
    sed -i "s/$(
        echo "$1" | sed -e 's/\([[\/.*]\|\]\)/\\&/g' 
            | sed -e 's:\t:\\t:g'
    )/$(
        echo "$2" | sed -e 's/[\/&]/\\&/g' 
            | sed -e 's:\t:\\t:g'
    )/g" "$3"
} 
```

那么，有什么不同呢？`$1`并`$2`用引号括起来以避免外壳扩展并保留制表符或双空格。

额外的管道`| sed -e 's:\t:\\t:g'`（我喜欢`:`作为令牌）在`\t`.

* * *

## 回答 #14

> 赞同：-6
> 
> 时间：2017-10-06T06:54:20.417

一种更简单的方法是事先构建字符串并将其用作参数`sed`

```
rpstring="s/KEYWORD/$REPLACE/g"
sed -i $rpstring  test.txt 
```

# oracle - 消除 SQL Developer 表视图的数据选项卡上的排序顺序

> ID：407529
> 
> 赞同：6
> 
> 时间：2009-01-02T17:46:25.093
> 
> 标签：oracle, oracle-sqldeveloper

在 Oracle SQL Developer 中，可以在查看表时使用“数据”选项卡列出表中的数据。还有一个“排序...”按钮来设置您正在查看的数据的排序顺序。这对于即时查看一些数据非常方便。

问题：我设置了一个排序顺序来查看该表上的索引不支持的特定表。当您查看该数据时，SQL Developer 似乎会即时进行排序。起初延迟并不算太糟糕。但是桌子已经长大了，现在它需要永远。没有办法阻止它，除非强制退出 SQL Developer，丢失任何未保存的内容。（如果您知道停止这种排序的另一种方法，请告诉我！）因此，我应该将查看排序顺序更改为其他内容，但您只能在查看数据时访问“排序...”按钮。

除了查看数据，还有其他删除查看排序顺序的方法吗？

SQL Developer 将这些信息存储在哪里？

在等待数据出现的同时单击数据选项卡后，有什么方法可以停止数据的排序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-08-23T14:32:02.343

易于修复（至少在 v1.5.5 中，这是我正在使用的）。有一个 prefs 选项可以重置它，请在此处阅读： [https ://forums.oracle.com/forums/thread.jspa?threadID=860431](https://forums.oracle.com/forums/thread.jspa?threadID=860431)

> 转到工具 > 首选项 > 数据库 > ObjectViewer 参数并选择清除按钮。这将清除排序设置。

[![在此处输入图像描述](https://i.stack.imgur.com/a4Gfp.png)](https://i.stack.imgur.com/a4Gfp.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T10:00:03.697

我还没有从 GUI 中找到消除排序顺序的命令，但您可以使用以下解决方法：

1.  进入 sqldeveloper 设置文件夹。在 M$ Windows 上位于 %HOME_USER%/Application Data/SQL Developer
2.  执行指定排序列的名称的全文搜索。如果列的名称太常见（例如：数据），请在同一个表中指定另一个具有不同名称的列。您将找到一个或多个与您的搜索条件匹配的 xml 文件。这些文件是表描述符。
3.  在 xml 描述符的末尾搜索名称为“orderByClause”的 taf 元素。如果它包含要从排序中消除的列的名称，则将该行替换为空元素 ()
4.  重新启动 sqldeveloper 和 ... sort 不再存在！

希望这可以帮助

干杯，法布里齐奥·福蒂诺

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T21:42:35.500

如果您愿意冒一点风险，您可以按照 Fabrizio 的建议开始，然后按照以下方式清理房屋：

1.  进入 sqldeveloper 设置文件夹。在 M$ Windows 上位于 %HOME_USER%/Application Data/SQL Developer
2.  使用以下掩码“*tablesettings.xml”执行搜索。
3.  删除返回给您的文件。
4.  重新启动 sqldeveloper，你的问题就消失了。

    *   为了安全起见，您可能只想将这些文件移动到隔离目录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T17:57:13.670

我相信目前还没有办法，但是有一个建议的增强功能不保留会话之间的过滤器，您可以[在 SQL Developer 论坛上投票](http://htmldb.oracle.com/pls/otn/f?p=42626:39:4431026159675936::NO::P39_ID:15501)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-28T19:47:21.683

1.  进入 sqldeveloper 设置文件夹。在 M$ Windows 上位于 %HOME_USER%/Application Data/SQL Developer
2.  在 SQLDEveloper 版本 3.0.03（我猜是更高版本）上搜索 *GridSettings.xml
3.  查找包含与您的表/视图相关的 xml 的文件。
4.  要么删除文件，要么只删除与先前从表中删除的列相对应的行。您需要从 ; 中删除行 ;
5.  您不需要重新启动 sqldeveloper。只需断开连接并重新连接就可以了。

# sharepoint - 您的自定义 SharePoint 程序集的代码维护策略是什么？

> ID：407531
> 
> 赞同：4
> 
> 时间：2009-01-02T17:46:37.917
> 
> 标签：sharepoint, feature-upgrade

您如何处理现有 SharePoint 代码的改进和添加的功能？

您是否将原始代码部署为功能？
您是否创建了一个新的 feature_V2 并停用了原来的？

您发现哪些流程会导致未来出现问题？

我对 WebParts、EventHandlers 和 WorkFlows 特别感兴趣。

据我所知，MS 没有留下关于更新现有代码的“最佳实践”。（实际上，我不确定他们留下了“实践”，更不用说“最佳实践”了）

您可以查看有关此主题的其他问题：
[how-to-upgrade-a-long-running-sharepoint-workflow-already-in-production](https://stackoverflow.com/questions/357032/how-to-upgrade-a-long-running-sharepoint-workflow-already-in-production)
[how-to-update-spitemeventreceiver-assembly-version-for-a-list-in- sharepoint](https://stackoverflow.com/questions/382535/how-to-update-spitemeventreceiver-assembly-version-for-a-list-in-sharepoint)
[我应该在 1-1 比率中保留解决方案和功能](https://stackoverflow.com/questions/374919/should-i-keep-solutions-and-features-in-a-1-1-ratio)

你的方法是什么？

我知道这个问题可能是主观的，但我觉得围绕 SharePoint 开发的这个领域存在很大的信息差距。

谢谢你，
基思

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T02:35:03.920

We always deploy custom code as features and solutions. When it is time to upgrade the existing code, all you have to do is stsadm -upgradesolution and everything works very nicely. I do not like the idea of having feature_v2 type features around...it makes it extremely difficult to keep track of the current version. I think you should only have one version of each feature in your production environment.

Leave the version control to your source control system.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T23:00:43.153

我在一家从事大量 SharePoint 开发的商店工作。您希望使用解决方案包按功能进行部署。您可以在进行过程中轻松升级您的功能，并且您需要升级解决方案包。可以使用[WSPBuilder](http://www.codeplex/wspbuilder)从 TFS 构建服务器创建此解决方案包。随着您的前进，唯一剩下的就是升级解决方案并“强制”重新激活您的功能以拥有该功能的新功能。

不要忘记对通过 GAC 完成的任何新代码部署进行 IIS 重置。如果您在 12 中放置任何内容，例如站点地图和资源，您将需要执行**stsadm -o copyappbincontent**。

如果您部署包含应用程序文件的功能，您希望在场的所有服务器上卸载您的应用程序。可以通过将[App_Offline.htm](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)放在每台机器上每个应用程序的根目录中轻松完成。

完成后，删除 App_Offline.htm（或重命名），您就完成了。您的网站已重新上线。

# .net - 用于阻止大量站点流量的 IIS 模块

> ID：407536
> 
> 赞同：0
> 
> 时间：2009-01-02T17:49:33.670
> 
> 标签：.net, asp.net, iis, module

# 问题

大家好，

关于我的问题的一点背景...我目前有一个为我工作的 ISP 构建的站点，该站点根据用户的帐单状态向用户显示消息。当他们处于非付费状态时，我会显示一条非付费消息，如果他们处于滥用状态，我会显示一条滥用消息等。流量由思科 SCE 生成，它将最终用户的 HTTP 流量重定向到我的站点。

我看到的问题是流量过多。我相信流量可能是 P2P 流量、自动更新或其他任何类型的流量。基本上任何使用端口 80 的东西都会被 SCE 重定向到我的页面。

我试图在我的服务器上实施的解决方案是放置一个模块，根据用户的点击次数阻止用户。因此，如果它们在一定时间内超过阈值，它们将被重定向到另一个页面，这有望减轻处理器的负载，因为它不必执行所有 SQL 查找和发生在ASP.NET 页面。

但是，当我尝试强制执行我构建的模块时，它实际上会产生相反的结果（增加 CPU 负载）。该模块使用存储在应用程序状态中的内存表，用于通过 IP 跟踪请求。这是模块的代码：

```
public class IpHitCount : IHttpModule
{
    const string tableKey = "appIpLog";

    #region IHttpModule Members

    public void Dispose()
    {

    }

    public void Init(HttpApplication context)
    {
        context.PreRequestHandlerExecute += new EventHandler(checkHitCount);
    }

    #endregion

    private void checkHitCount(object sender, EventArgs e)
    {
        // Cast the parameter into a HttpApp object
        HttpApplication app = (HttpApplication)sender;

        // make sure that this is the user's first request for the app
        // (all first requests are routed through main)
        if (app.Request.Url.AbsolutePath.ToLower().Contains("main.aspx"))
        {
            // If the in memory table does not exist, then create it
            if (app.Application[tableKey] == null)
            {
                app.Application[tableKey] = CreateTable();
            }

            DataSet ds = (DataSet)app.Application[tableKey];
            DataTable tbl = ds.Tables["IpTable"];
            DeleteOldEntries(tbl);

            string filter = string.Format("ip = '{0}'", app.Request.UserHostAddress);
            DataRow[] matchedRows = tbl.Select(filter);

            if (matchedRows.Length > 0)
            {
                DataRow matchedRow = matchedRows[0];
                if ((int)matchedRow["hitCount"] > 4)
                {
                    app.Response.Redirect("HitCountExceeded.htm", true);
                }
                else
                {
                    matchedRow["hitCount"] = (int)matchedRow["hitCount"] + 1;
                }
            }
            else
            {
                DataRow newEntry = tbl.NewRow();
                newEntry["timestamp"] = DateTime.Now;
                newEntry["hitCount"] = 1;
                newEntry["ip"] = app.Request.UserHostAddress;
                tbl.Rows.Add(newEntry);
            }                
        }
    }

    private DataSet CreateTable()
    {
        DataSet ds = new DataSet();
        DataTable table = new DataTable("IpTable");

        DataColumn col1 = new DataColumn("timestamp", typeof(DateTime));
        col1.AutoIncrement = false;
        col1.DefaultValue = DateTime.Now;
        col1.ReadOnly = false;
        col1.Unique = false;

        DataColumn col2 = new DataColumn("ip", typeof(string));
        col1.AutoIncrement = false;
        col1.ReadOnly = false;  
        col1.Unique = false;

        DataColumn col3 = new DataColumn("hitCount", typeof(int));
        col1.AutoIncrement = false;
        col1.ReadOnly = false;
        col1.Unique = false;

        table.Columns.Add(col1);
        table.Columns.Add(col2);
        table.Columns.Add(col3);

        ds.Tables.Add(table);

        return ds;
    }

    private void DeleteOldEntries(DataTable tbl)
    {
        // build the where clause
        string filter = "timestamp < '" + DateTime.Now.AddMinutes(-5.0).ToString() + "'";

        // run the query against the table
        DataRow[] rowsToDelete = tbl.Select(filter);

        // individually delete each row returned
        foreach (DataRow row in rowsToDelete)
        {
            row.Delete();
        }
    }
} 
```

所以我想知道的是：您是否可以看到我在模块中做错了什么，这可能导致 CPU 利用率高？是否有其他方法可以阻止此流量？

您能提供的任何帮助将不胜感激。

谢谢， C

* * *

# 解决方案

我已将模块中的代码更改为仅每 1 分钟运行一次删除部分：

```
 if (app.Application[deletedKey] == null)
    app.Application[deletedKey] = DateTime.Now;

    DateTime deletedDate = (DateTime)app.Application[deletedKey];

    if (DateTime.Now >= deletedDate.AddMinutes(1))
    {
        DeleteOldEntries(tbl);
        app.Application[deletedKey] = DateTime.Now;
    } 

```

我还添加了一些我认为索引数据集的 IP 列的代码。但这似乎不对，所以我不确定它是否正在做我打算做的事情：

```
 DataColumn[] key = new DataColumn[1];
    key[0] = col1;

    table.PrimaryKey = key;

    ds.Tables.Add(table); 

```

进行上述两项更改后，CPU 负载似乎已大幅下降。我想我们的 SQL 服务器现在也正在感谢上帝，它终于可以呼吸了。

谢谢大家的帮助！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T17:59:29.327

好吧，您必须记住 DataSet 将在内存中，并且要搜索 DataSet，将花费大量 CPU 周期来查找您要查找的记录。

再加上一个事实，因为这是一个 Web 应用程序，你会得到很多点击，所以你最终会非常非常频繁地调用这个例程。

我的建议是将命中计数存储在数据库服务器中，然后更新并查询服务器以查看是否超出命中计数。它将能够处理负载，以及处理您要查询的数据集的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T20:51:57.437

我会尝试几件事：

*   我看到的第一件事是，每次运行此代码时，您都在调用“DeleteOldEntries”子程序，这会导致它在每次通过时扫描整个 DataTable。有没有另一种方法可以限制它只在特定时间运行？如果不是每 15 秒运行一次的计时器，那么可能是状态中的第二个变量（如“ExecCount”），每次运行“CheckHitCount”时都会递增，这样您就只能每 10 次或 20 次清除一次？这样，您可以在每次运行时避免这个潜在的昂贵的代码部分。
*   另一种选择是向您的 DataTable 添加索引。我不确定 .NET 如何处理 DataTables 中的查找，但也许您会对此感兴趣：[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.data.datatable.primarykey.aspx)

您可以使用 ANTS Profiler 之类的工具来查看执行期间花费最多的时间吗？因为我想象这个页面被调用了很多很多次/秒，任何可以降低影响的方式，即使是一点点也会有很大的不同。

如果您得到一些结果但仍然不满意，请确保修改您的问题以添加新信息，以便我们可以继续努力寻找您满意的解决方案。

# javascript - Javascript 和翻译

> ID：407550
> 
> 赞同：2
> 
> 时间：2009-01-02T17:54:09.773
> 
> 标签：javascript, translation, translation-scheme

我有一个在客户端广泛使用 Javascript 的 PHP 应用程序。我在 PHP 端有一个简单的系统，用于为翻译人员提供一种提供新语言的简单方法。但是在某些情况下，javascript 需要向用户显示语言元素（可能是确定或取消按钮或“加载”或其他东西）。

使用 PHP，我只有一个缓存在服务器端的文本文件，其中一侧包含短语代码，另一侧包含它们的翻译。翻译人员只需要用他们自己的语言替换英语，然后将我集成到应用程序中的翻译版本发送给我。

我想要在客户端有类似的东西。我突然想到有一个 JavaScript 包含，它只是一组翻译后的常量，但是每个页面加载都在下载一个潜在的大文件，其中大部分是不必要的。

有没有人不得不处理这个？如果是这样，您的解决方案是什么？

**编辑**：要清楚，我在这里指的不是“即时”翻译。翻译已经准备好并准备就绪，我只需要以有效的方式将它们提供给客户。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-02T18:00:23.477

从 php 提供 javascript 怎么样？因此，而不是举起：

```
 <script type='text/javascript' src='jsscript.js'></script> 
```

做

```
 <script type='text/javascript' src='jsscript.php'></script> 
```

然后在 php 文件中用它们相关的常量替换所有输出的文本。

确保从 PHP 代码中输出正确的缓存标头。

**编辑**

这些是我使用的标题：

```
header('Content-type: text/javascript');
header('Cache-Control: public');
header('expires: '. date("r", time() + ( 7 * 24 * 60 * 60 ) ) ); // 1 week
header("Pragma: public"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-04T06:49:50.083

我通常将适当的语言值作为 JavaScript 对象加载到一个单独的文件中，我的其余代码可以引用该文件：

```
var messages = {
    "loading": "Chargement"
}

alert(messages.loading); 
```

语言库将在第一次加载后缓存在客户端，您可以通过将值拆分为基于上下文加载的单独文件来提高加载效率：例如用于公共操作的小型库，登录后的附加库等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T18:02:18.433

您正在寻找的似乎是[AJAX](http://en.wikipedia.org/wiki/Ajax_(programming))（客户端和服务器使用 Javascript 交换异步请求）。

如果您正在寻找现成的东西，请在[Google Translation AJAX APIs](http://code.google.com/intl/it/apis/ajaxlanguage/)上一探究竟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T18:04:03.170

我从来没有亲自这样做过，但我的第一个猜测是参考第三方库。我相信 Google AJAX API 可能只有执行此操作的工具，并且由于该库是通过 Google 提供的，因此不会从您的站点下载 javascript 文件。

尝试浏览以下网站： [http ://code.google.com/apis/ajaxlanguage/documentation/](http://code.google.com/apis/ajaxlanguage/documentation/)

让我知道这是否对您有帮助。我可能有兴趣为我管理的网站实施类似的东西。

祝你好运，C

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T22:04:13.607

我喜欢 Pim Jager 的回答，我自己也这样做了。如果您不想让 PHP 为您生成 JavaScript（例如，出于性能原因），您可以拥有 JavaScript 库的主副本，当它们发生更改时，运行翻译程序以生成每个库的版本对于每种语言。然后让 PHP 将当前用户的正确版本放入它发送的脚本标记中。

我开发的系统需要为不同的客户进行大量本地化和品牌推广。我们所做的是发送到屏幕的任何东西都有一个独特的宏，比如**[ *3027* ]**（或类似的东西）。然后我们有一堆语言环境和品牌文件，其中包含每个宏代码的条目，以及替换每个宏的文本。程序将遍历所有源文件和所有语言并进行替换。

我们发现我们还需要一些用于本地化的函数，用于货币金额、日期、时间等。这一切都很好。

我们发现我们需要一个更重要的东西：一个工具来检查所有语言文件并确保它们都具有所有必要的代码。节省大量时间。

# vmware - 有什么理由不使用 ESXi？

> ID：407564
> 
> 赞同：1
> 
> 时间：2009-01-02T17:59:21.870
> 
> 标签：vmware, esxi

我们这里有 3 台相同的 HP DL380 G5 服务器，其中一台正在运行 vmware-server，其中一台正在运行虚拟机。

我已经开始迁移这些系统以运行 ESXi（$0，“嵌入式”系统）；两台物理机将有 %99.99 的时间恰好有 1 个 VM，另一台将有 2 个。

为此，我获得灾难恢复能力的主要优势。我们的磁带备份系统没有“裸机”能力。不过，我可以手动将 VM 映像复制到不同的服务器。即使它们是几个月大的，它们也提供了非常接近即时的恢复，它们将从磁带中进一步恢复。

作为免费版本，我没有获得 VMWare“整合备份”或 VMotion。而且我需要对每台物理机进行管理。但是 ESXi 需要 32MB 的磁盘，而且它专门支持服务器。

考虑到这一点，如果硬件支持，是否有任何理由*不**总是*使用 ESXi？即使您只计划在该硬件上运行 1 个虚拟机？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T18:18:26.357

好吧，在您的情况下，ESXi 是更好的选择。在某些情况下，您想使用 VMware Server，但实际上并不适合这种情况。这就是 ESXi 的用途。例如，我在我的开发操作系统之上使用 VMware Server，因此我可以进行测试和使用不同的发行版等。我不会像您描述的那样为生产服务器使用 VMware Server，但 ESXi 将是最佳选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-07T15:35:30.640

虚拟化整个操作系统以获得备份能力是一个好主意吗？不！它不是......该死的炒作在没有真正需要的情况下进行虚拟化。

有免费的替代方案可以备份您选择的几乎任何操作系统、映像或存档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-05T12:10:30.550

更准确地说，XSIBackup 将允许您热备份 5.1 及更高版本的任何 ESXi 版本，它在运行时备份来宾操作系统，甚至可以通过 IP 将其传输到辅助 ESXi 机器并随时准备就绪切换到：

[https://33hops.com/xsibackup-vmware-esxi-backup.html](https://33hops.com/xsibackup-vmware-esxi-backup.html)

# visual-studio-2008 - 源文件的 VSS 和 Visual Studio 2008“二进制文件不同”消息

> ID：407571
> 
> 赞同：5
> 
> 时间：2009-01-02T18:01:07.827
> 
> 标签：visual-studio-2008, visual-sourcesafe

我正在使用 VSS 2008 和 Visual Studio 2008。签入我的源文件后，VSS 属性对话框将它们显示为类型“Unicode (UTF-8)”。但是，如果我从 Visual Studio 中检出一个，然后进行比较，它会显示“二进制文件不同”。还有人看到这个吗？我在某个地方搞砸了设置吗？

谢谢，安迪

更新：感谢 VonC 提供的一些见解。在大多数情况下，关闭“自动检测本地文件的编码”复选框可以修复它，尽管对于至少一个文件，它没有帮助。此外，我还没有找到一种方法来处理多个文件——它们必须一次一个地更改。我仍在寻找更全面的解决方案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-05T15:24:54.973

From this [old (2004) but may be still relevant article](http://www.7hertz.com/archives/2004/11/binary_files_differ_vss_file_types.html):

> visual source safe doesn't always recognize text file types properly. when checking-in files using '`auto`' type -- it treats them as binary.
> 
> So when you compare two .sql files you might see '`binary files differ`' -- and nothing more. (that's how vss treats binary files).

![The binary file differ](https://i.stack.imgur.com/OW35Y.png)

> The solution is to change the file type using the properties context menu for the file in source safe. Change the type to text, you should be able to perform the visual comparison. You can also click on the 'advanced' option when checking-in the file, and manually change the selection to '`text`' then.
> 
> To avoid in the future - you can add file type settings under the options menu in visual source safe, to set the default behavior for various file types there.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-23T18:51:11.220

除了使用 VSS 的内置比较工具外，您还可以指定其他应用程序。这可以帮助您避免二进制问题。例如，如果您碰巧使用 Beyond Compare（遗憾的是，它不是免费软件，但我有相关说明）：

1.  转到工具菜单
2.  转到选项菜单项
3.  转到自定义编辑器选项卡
4.  将操作更改为“文件差异”选择
5.  将文件扩展名更改为：.*
6.  将命令行更改为（包括引号）：“C:\Program Files\Beyond Compare 2\bc2.exe”%1 %2
7.  点击添加按钮
8.  单击确定按钮

我猜你可以用另一个程序换掉上面的命令行值，但我自己没有尝试过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-04T15:48:17.150

是的，其他答案是正确的。但是如果文件被某人锁定并且您需要进行代码合并怎么办？一旦属性被禁用，您将无法更改它们：

![其他人签出时类型被禁用](https://i.stack.imgur.com/V4woS.png)

要启用版本的类型下拉菜单，请执行此简单技巧。

0) 下载并运行 WinSpy++；

1）将指针拖放到禁用的下拉列表中；

2) 将句柄更改为“启用”；

3) VSS 将允许您保存任何更改。

![WinSpy++ 序列](https://i.stack.imgur.com/MQL8b.png)

附言。VSS 已过时，但仍广泛用于懒惰改变的公司。

# c# - 逻辑错误 BST ... 错误结果

> ID：407579
> 
> 赞同：1
> 
> 时间：2009-01-02T18:04:39.410
> 
> 标签：c#, binary-tree

嗨，我在 Marc Gravell 的帮助下完成了这段代码

[为什么在 BinarySearchTree 中找不到 _left 和 _right？](https://stackoverflow.com/questions/406791/)
&
[如何更正 BST C# 代码中的隐式转换错误？](https://stackoverflow.com/questions/406402/bst-c-code-with-errors)

，它的二叉搜索树，但现在我遇到了逻辑错误，结果是错误的，我的代码输出如下：

```
2
3
5
6
10
17
------------------------------------------------
17
2
------------------------------------------------
3                 
6
Press any key to continue . . . 
```

最后两个数字必须给出插入元素的总数 6 但它显示 9

但是我怎么能得到树的高度？！

* * *

```
using System;
using System.Collections.Generic;
using System.Text;

namespace errors
{
    class Program
    {
        static void Main(string[] args)
        {
            BinarySearchTree t = new BinarySearchTree();

            t.insert(ref t.root, 10);
            t.insert(ref t.root, 5);
            t.insert(ref t.root, 6);
            t.insert(ref t.root, 17);
            t.insert(ref t.root, 2);
            t.insert(ref t.root, 3);

            BinarySearchTree.print(t.root);

            Console.WriteLine("------------------------------------------------");
            Console.WriteLine(t.FindMax());
            Console.WriteLine(t.FindMin());
            Console.WriteLine("------------------------------------------------");

            Console.WriteLine(t.CountLeaves(t.root));
            Console.WriteLine(t.CountNodes(t.root));

        }

        public class TreeNode
        {
            public int n;
            public TreeNode _left;
            public TreeNode _right;

            public TreeNode(int n, TreeNode _left, TreeNode _right)
            {
                this.n = n;
                this._left = _left;
                this._right = _right;
            }

            public void DisplayNode()
            {
                Console.Write(n);
            }

        }

        public class BinarySearchTree
        {
            public TreeNode root;

            public BinarySearchTree()
            {
                root = null;
            }

            public void insert(ref TreeNode root, int x)
            {
                if (root == null)
                {
                    root = new TreeNode(x, null, null);
                }
                else
                    if (x < root.n)
                        insert(ref root._left, x);
                    else
                        insert(ref root._right, x);
            }

            public int FindMin()
            {
                TreeNode current = root;

                while (current._left != null)
                    current = current._left;

                return current.n;
            }

            public int FindMax()
            {
                TreeNode current = root;

                while (current._right != null)
                    current = current._right;

                return current.n;
            }

            public TreeNode Find(int key)
            {
                TreeNode current = root;

                while (current.n != key)
                {
                    if (key < current.n)
                        current = current._left;
                    else
                        current = current._right;
                    if (current == null)
                        return null;
                }
                return current;
            }

            public void InOrder(ref TreeNode root)
            {
                if (root != null)
                {
                    InOrder(ref root._left);
                    root.DisplayNode();
                    InOrder(ref root._right);
                }
            }

            public int CountNodes(TreeNode root)
            {
                int count=1;
                if (root._left != null)
                    count += CountNodes(root._left);
                if (root._right != null)
                    count += CountNodes(root._right);
                return count;
            }

            public int CountLeaves(TreeNode root)
            {
                int count = (root._left == null && root._right == null) ? 1 : 0;
                if (root._left != null)
                    count += CountLeaves(root._left);
                if (root._right != null)
                    count += CountLeaves(root._right);
                return count;
            }

            public static void print(TreeNode root)
            {
                if (root != null)
                {
                    print(root._left);
                    Console.WriteLine(root.n.ToString());
                    print(root._right);
                }

            }

        }

    }
} 
```

提前感谢并特别感谢 Marc Gravell。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T18:16:13.053

如果您的意思`CountNodes`是计算所有非叶节点，则必须更改此行：

```
int count=1; 
```

阅读这个：

```
int count = (root._left == null && root._right == null) ? 0 : 1; 
```

（与 中的相反`CountLeaves`）。

这将为您提供树的高度：

```
public int Height(TreeNode root)
{
    int height = 1;
    if (root._left != null)
        height = Math.Max(height, Height(root._left));
    if (root._right != null)
        height = Math.Max(height, Height(root._right));
    return height;   
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T18:16:48.280

关于获取树高，请使用以下递归伪代码，调用`nodeHeight(root)`：

```
nodeHeight(node)
    left=0
    right=0

    if (node == null) return 0

    left = 1 + nodeHeight(getLeft(node))
    right = 1 + nodeHeight(getRight(node))

    return max(left,right) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T18:19:08.710

看起来你没有平衡你的树，所以你只得到一个简单的链表，这可能会导致你的值不正确。一个适当平衡的树将具有 log2(n) 的最大高度。

# c# - c# 匿名类型代码的 VB.Net 代码等效项是什么？

> ID：407586
> 
> 赞同：4
> 
> 时间：2009-01-02T18:08:47.453
> 
> 标签：c#, vb.net, language-features

有人可以告诉我 VB.Net 中与此 C# 代码等效的代码是什么吗？

```
new {name="value"} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T18:12:10.473

这称为匿名类型，VB 等价物是：

```
 New With {.Name = "value"} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T18:11:18.743

该功能称为匿名类型。

# python - Python：设置位计数（popcount）

> ID：407587
> 
> 赞同：13
> 
> 时间：2009-01-02T18:09:07.263
> 
> 标签：python, bit-manipulation

在我的数据库（oracle 11g）中复制了几个 blob，使用 UTL_RAW.BIT_XOR 对 blob 执行了 XOR 操作。之后我想计算二进制字符串中设置的位数，所以写了上面的代码。

在一个小实验中，我想看看生成的十六进制和整数值是什么，并编写了这个程序..

```
SQL> declare
2
3 vblob1 blob;
4
5 BEGIN
6
7 select leftiriscode INTO vblob1 FROM irisdata WHERE irisid=1;
8
9 dbms_output.put_line(rawtohex(vblob1));
10
11
12 dbms_output.put_line(UTL_RAW.CAST_TO_binary_integer(vblob1));
13
14
15 END;
16 / 
```

输出：十六进制值：

```
0F0008020003030D030C1D1C3C383C330A3311373724764C54496C0A6B029B84840547A341BBA83D
BB5FB9DE4CDE5EFE96E1FC6169438344D604681D409F9F9F3BC07EE0C4E0C033A23B37791F59F84F
F94E4F664E3072B0229DA09D9F0F1FC600C2E380D6988C198B39517D157E7D66FE675237673D3D28
3A016C01411003343C76740F710F0F4F8FE976E1E882C186D316A63C0C7D7D7D7D397F016101B043
0176C37E767C7E0C7D010C8302C2D3E4F2ACE42F8D3F3F367A46F54285434ABB61BDB53CBF6C7CC0
F4C1C3F349B3F7BEB30E4A0CFE1C85180DC338C2C1C6E7A5CE3104303178724CCC5F451F573F3B24
7F24052000202003291F130F1B0E070C0E0D0F0E0F0B0B07070F1E1B330F27073F3F272E2F2F6F7B
2F2E1F2E4F7EFF7EDF3EBF253F3D2F39BF3D7F7FFED72FF39FE7773DBE9DBFBB3FE7A76E777DF55C
5F5F7ADF7FBD7F6AFE7B7D1FBE7F7F7DD7F63FBFBF2D3B7F7F5F2F7F3D7F7D3B3F3B7FFF4D676F7F
5D9FAD7DD17F7F6F6F0B6F7F3F767F1779364737370F7D3F5F377F2F3D3F7F1F2FE7709FB7BCB77B
0B77CF1DF5BF1F7F3D3E4E7F197F571F7D7E3F7F7F7D7F6F4F75FF6F7ECE2FFF793EFFEDB7BDDD1F
FF3BCE3F7F3FBF3D6C7FFF7F7F4FAF7F6FFFFF8D7777BF3AE30FAEEEEBCF5FEEFEE75FFEACFFDF0F
DFFFF77FFF677F4FFF7F7F1B5F1F5F146F1F1E1B3B1F3F273303170F370E250B

INTEGER VALUE: 15 
```

十六进制代码和产生的整数值之间存在差异，因此使用以下 python 代码检查实际的整数值。

```
print int("0F0008020003030D030C1D1C3C383C330A3311373724764C54496C0A6B029B84840547A341BBA83D
BB5FB9DE4CDE5EFE96E1FC6169438344D604681D409F9F9F3BC07EE0C4E0C033A23B37791F59F84F
F94E4F664E3072B0229DA09D9F0F1FC600C2E380D6988C198B39517D157E7D66FE675237673D3D28
3A016C01411003343C76740F710F0F4F8FE976E1E882C186D316A63C0C7D7D7D7D397F016101B043
0176C37E767C7E0C7D010C8302C2D3E4F2ACE42F8D3F3F367A46F54285434ABB61BDB53CBF6C7CC0
F4C1C3F349B3F7BEB30E4A0CFE1C85180DC338C2C1C6E7A5CE3104303178724CCC5F451F573F3B24
7F24052000202003291F130F1B0E070C0E0D0F0E0F0B0B07070F1E1B330F27073F3F272E2F2F6F7B
2F2E1F2E4F7EFF7EDF3EBF253F3D2F39BF3D7F7FFED72FF39FE7773DBE9DBFBB3FE7A76E777DF55C
5F5F7ADF7FBD7F6AFE7B7D1FBE7F7F7DD7F63FBFBF2D3B7F7F5F2F7F3D7F7D3B3F3B7FFF4D676F7F
5D9FAD7DD17F7F6F6F0B6F7F3F767F1779364737370F7D3F5F377F2F3D3F7F1F2FE7709FB7BCB77B
0B77CF1DF5BF1F7F3D3E4E7F197F571F7D7E3F7F7F7D7F6F4F75FF6F7ECE2FFF793EFFEDB7BDDD1F
FF3BCE3F7F3FBF3D6C7FFF7F7F4FAF7F6FFFFF8D7777BF3AE30FAEEEEBCF5FEEFEE75FFEACFFDF0F
DFFFF77FFF677F4FFF7F7F1B5F1F5F146F1F1E1B3B1F3F273303170F370E250B",16) 
```

回答：

```
611951595100708231079693644541095422704525056339295086455197024065285448917042457
942011979060274412229909425184116963447100932992139876977824261789243946528467423
887840013630358158845039770703659333212332565531927875442166643379024991542726916
563271158141698128396823655639931773363878078933197184072343959630467756337300811
165816534945075483141582643531294791665590339000206551162697220540050652439977992
246472159627917169957822698172925680112854091876671868161705785698942483896808137
210721991100755736178634253569843464062494863175653771387230991126430841565373390
924951878267929443498220727531299945275045612499928105876210478958806304156695438
684335624641395635997624911334453040399012259638042898470872203581555352191122920
004010193837249388365999010692555403377045768493630826307316376698443166439386014
145858084176544890282148970436631175577000673079418699845203671050174181808397880
048734270748095682582556024378558289251964544327507321930196203199459115159756564
507340111030285226951393012863778670390172056906403480159339130447254293412506482
027099835944315172972281427649277354815211185293109925602315480350955479477144523
387689192243720928249121486221114300503766209279369960344185651810101969585926336
07333771272398091 
```

为了获得设置位计数，我在 C 中编写了以下代码：

```
int bitsoncount(unsigned x)
{
    unsigned int b=0;
    if(x > 1)
        b=1;    
    while(x &= (x - 1))
        b++;    
    return b;
} 
```

当我在 python 中尝试相同的代码时，它不起作用。由于我正在试验的好奇心，我是 python 的新手，如果错了，请原谅。

```
def bitsoncount(x):
b=0;
if(x>1):
b=1;
while(x &= (x-1)): 
```

我在最后一行遇到错误，需要一些帮助来解决这个问题并在 python 中实现逻辑:-)

在我看到之后，我有兴趣查看 python 中的 set bits 版本！

相关问题：[计算 32 位整数中设置位数的最佳算法？](https://stackoverflow.com/questions/109023/best-algorithm-to-count-the-number-of-set-bits-in-a-32-bit-integer)

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-02T19:12:55.607

Python 2.6 或 3.0：

```
def bitsoncount(x):
    return bin(x).count('1') 
```

例子：

```
>>> x = 123
>>> bin(x)
'0b1111011'
>>> bitsoncount(x) 
6 
```

或者

[Matt Howells](https://stackoverflow.com/questions/109023/best-algorithm-to-count-the-number-of-set-bits-in-a-32-bit-integer#109025)在 Python 中的回答：

```
def bitsoncount(i):
    assert 0 <= i < 0x100000000
    i = i - ((i >> 1) & 0x55555555)
    i = (i & 0x33333333) + ((i >> 2) & 0x33333333)
    return (((i + (i >> 4) & 0xF0F0F0F) * 0x1010101) & 0xffffffff) >> 24 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-02T18:42:26.027

您正在寻找的东西称为[Hamming Weight](http://en.wikipedia.org/wiki/Hamming_weight)。

在 python 2.6/3.0 中可以很容易地找到它：

```
bits = sum( b == '1' for b in bin(x)[2:] ) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2020-06-20T17:38:26.160

从 Python 3.10 开始，您可以使用[`int.bit_count()`](https://docs.python.org/3.10/library/stdtypes.html#int.bit_count)：

```
x = 826151739

print(x.bit_count()) # 16 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T18:18:54.843

你使用的是什么版本的 Python？首先，Python 使用空格而不是分号，所以开始它应该看起来像这样......

```
 def bitsoncount(x): 
      b=0
      while(x > 0):
          x &= x - 1   
          b+=1
      return b 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-02T18:31:19.340

你的C算法的直接翻译如下：

```
def bitsoncount(x):
    b = 0
    while x > 0:
        x &= x - 1
        b += 1
    return b 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-02T18:40:29.947

也许这就是你的意思？

```
def bits_on_count(x):
    b = 0
    while x != 0:
        if x & 1: # Last bit is a 1
            b += 1
        x >>= 1 # Shift the bits of x right
    return b 
```

还有一种方法可以在 Python 3.0 中简单地做到这一点：

```
def bits_on_count(x):
  return sum(c=='1' for c in bin(x)) 
```

这使用了 bin(x) 给出 x 的二进制表示这一事实。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T19:06:26.820

试试这个模块：

```
import sys
if sys.maxint < 2**32:
    msb2= 2**30
else:
    msb2= 2**62
BITS=[-msb2*2] # not converted into long
while msb2:
    BITS.append(msb2)
    msb2 >>= 1

def bitcount(n):
    return sum(1 for b in BITS if b&n) 
```

这应该适用于机器整数（取决于您的操作系统和 Python 版本）。它对任何人都不起作用`long`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-24T18:41:03.310

你喜欢这个：

```
def bitsoncount(x):
    b   = 0
    bit = 1
    while bit <= x:
        b += int(x & bit > 0)
        bit = bit << 1

    return b 
```

基本上，您使用的测试位从右开始并一直移动到您的 in 参数的位长度。对于每个位置，位 & x 产生一个打开或无的单个位。检查 > 0 并使用 int() 将结果 True|False 变为 1|0，并将其添加到累加器中。似乎长期工作得很好:-)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-01-16T21:16:53.963

如何计算以 Python 开头的 1 位的数量`3.10`：[https ://docs.python.org/3/library/stdtypes.html#int.bit_count](https://docs.python.org/3/library/stdtypes.html#int.bit_count)

```
# int.bit_count()

n = 19
bin(n)
# '0b10011'

n.bit_count()    # <-- this is how
# 3

(-n).bit_count()
# 3 
```

等效于（根据上面链接的页面），但比以下更有效：

```
def bit_count(self):
    return bin(self).count("1") 
```

# jquery - 你如何处理来自 AJAX 调用的错误？

> ID：407596
> 
> 赞同：29
> 
> 时间：2009-01-02T18:12:27.303
> 
> 标签：jquery, ajax, validation

假设我有以下 jQuery AJAX 调用：

```
$.ajax({
   type: "POST",
   url: "MyUrl",
   data: "val1=test",
   success: function(result){
        // Do stuff
   }
 }); 
```

现在，当进行此 AJAX 调用时，我希望服务器端代码运行一些错误处理检查（例如，用户是否仍在登录，他们是否有权使用此调用，数据是否有效等）。如果检测到错误，我如何将该错误消息冒泡回客户端？

我最初的想法是返回一个带有两个字段的 JSON 对象：error 和 errorMessage。然后将在 jQuery AJAX 调用中检查这些字段：

```
$.ajax({
   type: "POST",
   url: "MyUrl",
   data: "val1=test",
   success: function(result){
       if (result.error == "true") 
       {
           alert("An error occurred: " & result.errorMessage);
       }
       else 
       {
           // Do stuff
       }
   }
 }); 
```

这对我来说感觉有点笨拙，但它确实有效。有更好的选择吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-02T19:54:56.927

就个人而言，我的库中有与以下代码类似的代码。

```
$.ajaxSetup({
    error: function(xhr){
        alert('Request Status: ' + xhr.status + ' Status Text: ' + xhr.statusText + ' ' + xhr.responseText);
    }
}); 
```

[jQuery 文档 Ajax/jQuery.ajaxSetup](http://docs.jquery.com/Ajax/jQuery.ajaxSetup#options)

将该错误从服务器端（使用 php）冒泡到客户端的最佳方法是通过 Ajax 请求在 400 的某处发送标头（始终与错误相关联）。一旦 Ajax 请求收到它，它将触发您的错误函数。这也意味着您不必定义错误：在每个 $.ajax 调用中调用。

```
header('HTTP/1.0 419 Custom Error'); 
```

引自[w3.org 标头信息](http://www.w3.org/Protocols/HTTP/HTRESP.html)

*错误 4xx, 5xx 4xx 代码用于客户端似乎出错的情况，而 5xx 代码用于服务器知道服务器出错的情况。一般来说，不可能区分这些情况，因此差异只是信息性的。正文部分可能包含以人类可读形式描述错误的文档。文档采用 MIME 格式，并且只能采用 text/plain、text/html 或请求中指定为可接受的格式之一。*

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-02T18:26:45.373

```
$.ajax({
   type: "POST",
   url: "MyUrl",
   data: "val1=test",
   success: function(result){
        // Do stuff
   },
   error: function(request,status,errorThrown) {
        // There's been an error, do something with it!
        // Only use status and errorThrown.
        // Chances are request will not have anything in it.
   }
 }); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T18:16:37.780

jQuery ajax 函数最后不接受一个参数，失败调用的回调吗？如果是这样，只需`fail:function(...){..}`在成功回调后添加一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T18:16:42.833

使用 HTTP 错误在服务器端返回一个错误代码，这与错误是什么是最接近的。然后使用错误回调。这也将允许您显示您的网络服务器给出的错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-06T09:31:05.660

现在回答这个问题已经很晚了，但我认为这对使用 es6 和 jquery 2.2 的人来说是有益的。

我通常在我的代码中遵循这个（延迟方法）

```
sendAjaxRequest(URL, dataToSend) {
    return $.ajax({
        type        : 'POST',
        url         : URL,
        data        : JSON.stringify(dataToSend),
        dataType    : 'json'
    }).fail((responseData) => {
        if (responseData.responseCode) {
            console.error(responseData.responseCode);
        }
    });
}, 
```

我附加了一个延迟`fail`方法，如果发生错误，将调用该方法。它是错误回调选项的替代构造， .fail() 方法替换了最新 jquery 中已弃用的 .error() 方法。

接下来从调用的地方`sendAjaxRequest`我使用`then`jquery **promise 回调**

```
sendAjaxRequest(URL, dataToSend)
.then(
     (success) => {
     },
     (error) => {
     }
); 
```

它将根据从服务器收到的响应调用成功或错误函数。

# java - 如何在 Windows 上获取不在控制台中运行的 Java 进程的线程和堆转储

> ID：407612
> 
> 赞同：257
> 
> 时间：2009-01-02T18:17:31.117
> 
> 标签：java, jvm, heap-dump, thread-dump

我有一个从控制台运行的 Java 应用程序，该控制台又执行另一个 Java 进程。我想获得该子进程的线程/堆转储。

在 Unix 上，我可以做一个`kill -3 <pid>`但在 Windows AFAIK 上，获得线程转储的唯一方法是控制台中的 Ctrl-Break。但这只会给我父进程的转储，而不是子进程。

还有另一种方法来获取堆转储吗？

* * *

## 回答 #1

> 赞同：428
> 
> 时间：2010-06-15T04:12:24.430

`jmap`假设您知道`pid`.

使用任务管理器或资源监视器来获取`pid`. 然后

```
jmap -dump:format=b,file=heap.hprof <pid> 
```

获取该进程的堆。

对于安装`bash`和`pgrep`并且运行单个 Java 进程的系统，请尝试：

```
jmap -dump:format=b,file=heap.hprof $(pgrep java) 
```

* * *

## 回答 #2

> 赞同：126
> 
> 时间：2013-09-18T19:15:12.247

您混淆了两个不同的 java 转储。 `kill -3`生成线程转储，而不是堆转储。

> 线程转储 = JVM 中每个线程的堆栈跟踪以文本形式输出到标准输出。
> 
> 堆转储 = JVM 进程输出到二进制文件的内存内容。

要在 Windows 上进行线程转储，`CTRL`+`BREAK`如果您的 JVM 是前台进程是最简单的方法。如果你在 Windows 上有一个类似 unix 的 shell，比如 Cygwin 或 MobaXterm，你可以`kill -3 {pid}`像在 Unix 中一样使用。

要在 Unix 中进行线程转储，`CTRL`+`C`如果您的 JVM 是前台进程，或者`kill -3 {pid}`只要您为 JVM 获得正确的 PID 就可以工作。

对于这两种平台，Java 都带有几个可以提供帮助的实用程序。对于线程转储，`jstack {pid}`是您最好的选择。[http://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jstack.html](http://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jstack.html)

只是为了完成转储问题：堆转储不常用，因为它们难以解释。但是，如果您知道在哪里/如何查看它们，它们中就会包含很多有用的信息。最常见的用法是定位内存泄漏。最好`-D`在 java 命令行上设置，以便在 OutOfMemoryError 时自动生成堆转储，`-XX:+HeapDumpOnOutOfMemoryError` 但是，您也可以手动触发堆转储。最常见的方法是使用 java 实用程序`jmap`。

**注意：**此实用程序并非在所有平台上都可用。从 JDK 1.6 开始，`jmap`可在 Windows 上使用。

一个示例命令行看起来像

```
jmap -dump:file=myheap.bin {pid of the JVM} 
```

输出“myheap.bin”不是人类可读的（对于我们大多数人来说），您需要一个工具来分析它。我的首选是MAT。 [http://www.eclipse.org/mat/](http://www.eclipse.org/mat/)

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2013-10-14T22:31:34.940

我认为在 Linux 进程中创建 .hprof 文件的最佳方法是使用**jmap**命令。例如：`jmap -dump:format=b,file=filename.hprof {PID}`

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-11-29T17:46:04.897

除了使用提到的 jconsole/visualvm 之外，您还可以`jstack -l <vm-id>`在另一个命令行窗口上使用，并捕获该输出。

<vm-id> 可以使用任务管理器找到（它是 windows 和 unix 上的进程 ID），或者使用`jps`.

两者`jstack`都`jps`包含在 Sun JDK 版本 6 及更高版本中。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-01-02T19:25:54.630

我推荐随 JDK (jvisualvm.exe) 一起分发的 Java VisualVM。它可以动态连接并访问线程和堆。我发现某些问题非常宝贵。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2016-02-09T05:43:13.633

如果您使用的是 server-jre 8 及更高版本，则可以使用：

```
jcmd PID GC.heap_dump /tmp/dump 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2016-07-08T14:02:01.733

尝试以下选项之一。

1.  对于 32 位 JVM：

    ```
    jmap -dump:format=b,file=<heap_dump_filename> <pid> 
    ```

2.  对于 64 位 JVM（明确引用）：

    ```
    jmap -J-d64 -dump:format=b,file=<heap_dump_filename> <pid> 
    ```

3.  对于在 VM 参数中使用 G1GC 算法的 64 位 JVM（仅使用 G1GC 算法生成活动对象堆）：

    ```
    jmap -J-d64 -dump:live,format=b,file=<heap_dump_filename> <pid> 
    ```

相关的 SE 问题：[Java heap dump error with jmap command : Premature EOF](https://stackoverflow.com/questions/36604102/java-heap-dump-error-with-jmap-command-premature-eof/)

查看本文的`jmap`各种[选项](http://docs.oracle.com/javase/7/docs/technotes/tools/share/jmap.html)

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2012-01-18T15:59:12.330

如果您想在内存不足时进行堆转储，可以使用选项启动 Java`-XX:-HeapDumpOnOutOfMemoryError`

cf [JVM 选项参考页](http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html)

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-01-02T18:19:51.907

您可以`kill -3 <pid>`从 Cygwin 发送。您必须使用 Cygwin`ps`选项来查找 Windows 进程，然后将信号发送到该进程。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2009-01-02T18:45:22.340

您可以运行`jconsole`（包含在 Java 6 的 SDK 中）然后连接到您的 Java 应用程序。它将向您显示每个正在运行的线程及其堆栈跟踪。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-01-02T18:26:26.340

您必须将输出从第二个 java 可执行文件重定向到某个文件。然后，使用[SendSignal](http://www.viewtier.com/support/technical_notes/SendSignal.exe)将[“-3”发送](https://stackoverflow.com/questions/813086/can-i-send-a-ctrl-c-sigint-to-an-application-on-windows)到您的第二个进程。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-01-03T07:59:44.063

**如何获取java应用程序的进程ID？**

执行命令 'jcmd' 以获取 java 应用程序的进程 ID。

**如何获得线程转储？**

jcmd PID Thread.print > thread.dump

参考[链接](https://self-learning-java-tutorial.blogspot.com/2018/08/jcmd-threadprint-get-thread-dumps.html)

您甚至可以使用 jstack 来获取线程转储（jstack PID > thread.dump）。参考[链接](https://self-learning-java-tutorial.blogspot.com/2018/08/jstack-get-thread-dump.html)

**如何获得堆转储？**

使用 jmap 工具获取堆转储。jmap -F -dump:live,format=b,file=heap.bin PID

PID 代表应用程序的进程 ID。参考[链接](https://self-learning-java-tutorial.blogspot.com/2018/08/jmap-force-heap-dump-generation.html)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2017-03-23T18:28:56.383

以下脚本使用 PsExec 连接到另一个 Windows 会话，因此即使通过远程桌面服务连接也可以正常工作。

[`PsExec`](https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)我为 Java 8（使用和`jcmd`）编写了一个名为 的小批处理脚本[`jvmdump.bat`](https://gist.github.com/isapir/e2bf7595b926a94d54516f395f89e1c8)，它转储线程、堆、系统属性和 JVM 参数。

```
:: set the paths for your environment
set PsExec=C:\Apps\SysInternals\PsExec.exe
set JAVA_HOME=C:\Apps\Java\jdk1.8.0_121
set DUMP_DIR=C:\temp

@echo off

set PID=%1

if "%PID%"=="" (
    echo usage: jvmdump.bat {pid}
    exit /b
)

for /f "tokens=2,3,4 delims=/ " %%f in ('date /t') do set timestamp_d=%%h%%g%%f
for /f "tokens=1,2 delims=: " %%f in ('time /t') do set timestamp_t=%%f%%g
set timestamp=%timestamp_d%%timestamp_t%
echo datetime is: %timestamp%

echo ### Version >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% VM.version >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"

echo. >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
echo ### Uptime >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% VM.uptime >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"

echo. >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
echo ### Command >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% VM.command_line >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"

echo. >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
echo ### Flags >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% VM.flags >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"

echo. >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
echo ### Properties >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"
%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% VM.system_properties >>"%DUMP_DIR%\%PID%-%timestamp%-jvm.log"

%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% Thread.print -l >"%DUMP_DIR%\%PID%-%timestamp%-threads.log"

%PsExec% -s %JAVA_HOME%\bin\jcmd.exe %PID% GC.heap_dump "%DUMP_DIR%\%PID%-%timestamp%-heap.hprof"

echo Dumped to %DUMP_DIR% 
```

它必须在启动 JVM 的用户的同一 Windows 会话中运行，因此如果您通过远程桌面连接，您可能需要在其中启动命令提示符`Session 0`并从那里运行它。例如

```
%PsExec% -s -h -d -i 0 cmd.exe 
```

这将提示您（单击底部的任务栏图标）进入`View the message`交互式会话，这将带您进入另一个会话中的新控制台，您可以从中运行`jvmdump.bat`脚本。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-02-12T09:48:17.463

如果您使用JDK 1.6 或更高版本，您可以使用`jmap`命令对Java 进程进行堆转储，条件是您应该知道ProcessID。

如果你在 Windows 机器上，你可以使用任务管理器来获取 PID。对于 Linux 机器，您可以使用各种命令，如`ps -A | grep java`or `netstat -tupln | grep java`或`top | grep java`，具体取决于您的应用程序。

然后你可以使用像`jmap -dump:format=b,file=sample_heap_dump.hprof 1234`1234 是 PID 这样的命令。

有多种[工具可](http://www.oracle.com/technetwork/java/javase/tooldescr-136044.html)用于解释 hprof 文件。我会推荐Oracle的visualvm工具，使用简单。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2018-08-03T02:00:25.307

如果由于某种原因您不能（或不想）使用控制台/终端，则可以使用替代解决方案。您可以让 Java 应用程序为您打印线程转储。收集堆栈跟踪的代码相当简单，可以附加到按钮或 Web 界面。

```
private static String getThreadDump() {
    Map<Thread, StackTraceElement[]> allStackTraces = Thread.getAllStackTraces();

    StringBuilder out = new StringBuilder();
    for (Map.Entry<Thread, StackTraceElement[]> entry : allStackTraces.entrySet()) {
        Thread thread = entry.getKey();
        StackTraceElement[] elements = entry.getValue();
        out.append(String.format("%s | prio=%d | %s", thread.getName(), thread.getPriority(), thread.getState()));
        out.append('\n');

        for (StackTraceElement element : elements) {
            out.append(element.toString()).append('\n');
        }
        out.append('\n');
    }
    return out.toString();
} 
```

此方法将返回如下所示的字符串：

```
main | prio=5 | RUNNABLE
java.lang.Thread.dumpThreads(Native Method)
java.lang.Thread.getAllStackTraces(Thread.java:1607)
Main.getThreadDump(Main.java:8)
Main.main(Main.java:36)

Monitor Ctrl-Break | prio=5 | RUNNABLE
java.net.PlainSocketImpl.initProto(Native Method)
java.net.PlainSocketImpl.<clinit>(PlainSocketImpl.java:45)
java.net.Socket.setImpl(Socket.java:503)
java.net.Socket.<init>(Socket.java:424)
java.net.Socket.<init>(Socket.java:211)
com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:59)

Finalizer | prio=8 | WAITING
java.lang.Object.wait(Native Method)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

Reference Handler | prio=10 | WAITING
java.lang.Object.wait(Native Method)
java.lang.Object.wait(Object.java:502)
java.lang.ref.Reference.tryHandlePending(Reference.java:191)
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153) 
```

对于那些对带有流的 Java 8 版本感兴趣的人，代码更加紧凑：

```
private static String getThreadDump() {
    Map<Thread, StackTraceElement[]> allStackTraces = Thread.getAllStackTraces();
    StringBuilder out = new StringBuilder();
    allStackTraces.forEach((thread, elements) -> {
        out.append(String.format("%s | prio=%d | %s", thread.getName(), thread.getPriority(), thread.getState()));
        out.append('\n');

        Arrays.stream(elements).forEach(element -> out.append(element.toString()).append('\n'));
        out.append('\n');
    });
    return out.toString();
} 
```

您可以使用以下方法轻松测试此代码：

```
System.out.print(getThreadDump()); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-05-16T07:41:08.900

下面的 java 代码用于通过提供远程进程的 PID 来获取 Java 进程的堆转储。该程序使用远程 JMX 连接将堆转储到文件。它可能对某些人有帮助。不需要jmap。

```
import java.lang.management.ManagementFactory;
import javax.management.MBeanServerConnection;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;
import java.lang.reflect.Method;

public class HeapDumper {

public static final String HOST = "192.168.11.177";
public static final String PORT = "1600";
public static final String FILE_NAME = "heapDump.hprof";
public static final String FOLDER_PATH = "C:/";
private static final String HOTSPOT_BEAN_NAME ="com.sun.management:type=HotSpotDiagnostic";

public static void main(String[] args) {
    if(args.length == 0) {
        System.out.println("Enter PID of the Java Process !!!");
        return;
    }

    String pidString = args[0];
    int pid = -1;
    if(pidString!=null && pidString.length() > 0) {
        try {
            pid = Integer.parseInt(pidString);
        }
        catch(Exception e) {
            System.out.println("PID is not Valid !!!");
            return;
        }
    }
    boolean isHeapDumpSuccess = false;
    boolean live = true;
    if(pid > 0) {
        MBeanServerConnection beanServerConn = getJMXConnection();

        if(beanServerConn!=null) {
            Class clazz = null;
            String dumpFile = FOLDER_PATH+"/"+FILE_NAME;
            try{
                clazz = Class.forName("com.sun.management.HotSpotDiagnosticMXBean");
                Object hotspotMBean = ManagementFactory.newPlatformMXBeanProxy(beanServerConn, HOTSPOT_BEAN_NAME, clazz);
                Method method = clazz.getMethod("dumpHeap", new Class[]{String.class , boolean.class});
                method.setAccessible(true);
                method.invoke(hotspotMBean , new Object[] {dumpFile, new Boolean(live)});
                isHeapDumpSuccess = true;
            }
            catch(Exception e){
                e.printStackTrace();
                isHeapDumpSuccess = false;
            }
            finally{
                clazz = null;
            }
        }
    }

    if(isHeapDumpSuccess){
        System.out.println("HeapDump is Success !!!");
    }
    else{
        System.out.println("HeapDump is not Success !!!");
    }
}

private static MBeanServerConnection getJMXConnection() {
    MBeanServerConnection mbeanServerConnection = null;
    String urlString = "service:jmx:rmi:///jndi/rmi://" + HOST + ":" + PORT + "/jmxrmi";
    try {
        JMXServiceURL url = new JMXServiceURL(urlString);
        JMXConnector jmxConnector = JMXConnectorFactory.connect(url);
        mbeanServerConnection = jmxConnector.getMBeanServerConnection();
        System.out.println("JMX Connection is Success for the URL :"+urlString);
    }
    catch(Exception e) {
        System.out.println("JMX Connection Failed !!!");
    }
    return mbeanServerConnection;
} 
```

}

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-12-12T06:25:42.437

为了从 Windows 中的子 java 进程中获取线程转储/堆转储，您需要识别子进程 ID 作为第一步。

通过发出命令：**jps**您将能够获取在您的 Windows 机器上运行的所有 Java 进程 ID。从此列表中，您需要选择子进程 ID。一旦有了子进程 ID，就有多种选项可以捕获线程转储和堆转储。

**捕获线程转储：**

有 8 个选项可以捕获线程转储：

1.  堆栈
2.  杀死 -3
3.  jvisualVM
4.  江铃
5.  窗口（Ctrl + Break）
6.  线程MXBean
7.  APM 工具
8.  指令

可以[在本文](https://www.eclipse.org/)中找到有关每个选项的详细信息。捕获线程转储后，您可以使用[fastThread](https://heaphero.io/)、[Samuraito](https://github.com/yusuke/samurai)等工具分析线程转储。

**捕获堆转储：**

有 7 个选项可以捕获堆转储：

1.  地图

2.  -XX:+HeapDumpOnOutOfMemoryError

3.  指令

4.  视觉虚拟机

5.  JMX

6.  程序化方法

7.  管理控制台

可以[在本文](https://www.eclipse.org/)中找到有关每个选项的详细信息。捕获堆转储后，您可以使用[Eclipse 内存分析工具](https://www.eclipse.org/)、[HeapHero](https://heaphero.io/)等工具来分析捕获的堆转储。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-05-29T13:49:53.973

也许[jcmd](https://docs.oracle.com/javase/8/docs/technotes/tools/windows/jcmd.html)？

**Jcmd**实用程序用于向 JVM 发送诊断命令请求，这些请求可用于控制 Java 飞行记录、故障排除和诊断 JVM 和 Java 应用程序。

jcmd 工具是在 Oracle 的 Java 7 中引入的，通过使用它来识别 Java 进程的 ID（类似于 jps）、获取堆转储（类似于 jmap）、获取线程转储（类似于 jstack），在解决 JVM 应用程序问题时特别有用)，查看系统属性和命令行标志等虚拟机特征（类似于 jinfo），并获取垃圾收集统计信息（类似于 jstat）。jcmd 工具被称为“用于调查和解决 JVM 应用程序问题的瑞士军刀”和“隐藏的宝石”。

这是您在调用 时需要使用的过程`jcmd`：

1.  去`jcmd <pid> GC.heap_dump <file-path>`
2.  其中
3.  pid：是一个 Java 进程 ID，将为其捕获堆转储此外，
4.  文件路径：是打印堆转储的文件路径。

查看有关获取[Java 堆转储](https://javatutorial.net/capture-java-heap-dump)的更多信息。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-01-28T18:43:25.337

Visualvm 跟进：

如果您从 jvisualvm “无法连接”到正在运行的 JVM，因为您没有使用正确的 JVM 参数启动它（并且它在远程机器上），`jstatd`请在远程机器上运行，然后，假设您有直接连接，添加它作为visualvm中的“远程主机”，双击主机名，该框上的所有其他JVM都会神奇地出现在visualvm中。

如果你没有“直接连接”到那个盒子上的端口，你也可以通过[代理](https://dzone.com/articles/visualvm-monitoring-remote-jvm)来做到这一点。

一旦你可以看到你想要的进程，在 jvisualvm 中钻取它并使用监视器选项卡 - >“heapdump”按钮。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-02-22T09:37:41.530

在 Oracle JDK 上，我们有一个名为 jmap 的命令（位于 Java Home 的 bin 文件夹中）。命令用法如下

> jmap (选项) (pid)

示例：jmap -dump:live,format=b,file=heap.bin (pid)

# java - Java RMI 资源

> ID：407614
> 
> 赞同：12
> 
> 时间：2009-01-02T18:17:41.723
> 
> 标签：java, networking, network-programming, rmi

我目前正在开展一个涉及广泛使用 Java RMI 的项目，我想知道是否有人知道有关它的任何好的资源。

我目前发现的材料的问题是它通常已经过时（如Java 1.3）和/或半完成。我什至很乐意买一本关于它的书，但在亚马逊上看，所有的书都像是 7 岁了。

因此，如果有人知道任何好的资源、书籍或好的示例实现，我会非常有兴趣了解它们。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T09:31:52.127

[RMI Hello World](http://java.sun.com/javase/6/docs/technotes/guides/rmi/hello/hello-world.html)看起来不错。当然，这仍然是一个简单的例子，所以也许[关于 RMI 性能/可扩展性的提示](http://www.javaperformancetuning.com/tips/j2ee_rmi.shtml)会很有用，因为您已经熟悉 RMI。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-28T21:24:37.763

Java.RMI 这些年来几乎没有什么变化，所以大部分旧文档仍然可以参考。请注意，如果您使用的是 Java 5.0 版本，则需要编译 RMI 存根，这是一项重大变化。大多数人已经离开 RMI 并接受了[River](http://river.apache.org/)（以前称为 Jini）的分布式系统。

如果您仍在考虑继续使用 RMI，那么我建议您阅读[Oracle 文档或在](http://docs.oracle.com/javase/tutorial/rmi/index.html)[他们的论坛](https://forums.oracle.com/forums/forum.jspa?forumID=930)上发布您的问题。

至于书籍…… William Grosso 的**Java RMI或 Elliotte Harold 的****Java Network Programming**。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-02T18:28:13.513

RMI 并没有太大变化。我认为1.3时代的书会很好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T08:56:58.327

谢谢大家的回答我认为人们所说的关于 RMI 没有太大变化的说法是正确的，但是教程仍然可以更好一些，它们掩盖了一些重要的观点。

最后，我发现迄今为止最好的一本书，它涵盖了 RMI 的一些非常好的部分，例如激活是[Java 网络编程和分布式计算](http://www.amazon.co.uk/Java-Network-Programming-Distributed-Computing/dp/0201710374/)。

我确实看过[O'reilly Java RMI](http://www.amazon.co.uk/Java-RMI-William-Grosso/dp/1565924525)的另一本书，在我看来，它对于任何比最小的 RMI 项目更大的东西都不是很好。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T09:19:37.593

如果你打算大量使用 RMI，我建议你看看[Spring Remoting](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-rmi)。它对抽象远程协议有很大帮助，可以帮助您稍后根据需要切换远程实现（例如切换到 Hessian 或 SOAP）。

如果您使用 RMI 或任何其他远程对象协议，要记住的一件事是，您可以通过调用远程对象上的方法来产生大量流量。在您的代码中，这些对象是远程的可能并不明显。它可能会产生性能问题。

如果可以的话，我建议你有一个或多或少面向服务的架构，你可以调用远程服务来获取数据对象，但不要对这些对象有太多的行为......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-28T21:29:59.983

您是否尝试过 Sun't [RMI 教程](http://java.sun.com/docs/books/tutorial/rmi/index.html)？Sun 的教程都非常好，它们通常是我学习 Java 的第一个起点。

我们在学校使用的一本有很好示例代码的书是[J2EE Developer's Handbook](https://rads.stackoverflow.com/amzn/click/com/0672323486)。请记住，这是一本大约 1500 页的巨大参考书，其中只有一章（约 50 页）关于 RMI。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T15:05:53.373

O'Reilly RMI 的书非常好。去吧。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-01T07:09:14.127

关于多宿主 RMI（具有多个 IP 的主机）的绝对无价的[文章](https://community.oracle.com/blogs/emcmanus/2006/12/22/multihomed-computers-and-rmi)以非常容易理解的方式解释了 RMI，并探讨了在具有多个 IP 地址的机器上托管注册表以及如何处理私有 IP 的问题。救了我的培根。

这是带有图像的文章，来自[归途存档](https://web.archive.org/web/20120921234615/http://weblogs.java.net/blog/emcmanus/archive/2006/12/multihomed_comp.html)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T13:33:23.247

除了已经提到的那些，文章[Understanding Java RMI Internals](https://www.developer.com/java/ent/article.php/3455311)是相当不错的恕我直言，对内部进行了一些介绍。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-06-04T08:17:50.113

这是使用 Redisson 框架进行远程方法调用的另一个很好的示例：

假设`YourServiceImpl`包含您需要远程调用的方法并实现`YourService`接口。

YourServiceImpl 应该通过 RemoteService 对象在 Redisson 中注册：

```
YourService yourService = new YourServiceImpl();

RRemoteService remoteService = redisson.getRemoteService();
remoteService.register(YourService.class, yourService); 
```

要远程调用方法，只需要服务接口：

```
RRemoteService remoteService = redisson.getRemoteService();
YourService service = remoteService.get(YourService.class);

MyObject result = service.myMethod(someParam1, someParam2); 
```

它还支持异步调用。

```
// async interface for YourService
@RRemoteAsync(YourService.class)
public interface YourServiceAsync {

    RFuture<Long> someMethod1(Long param1, String param2);

    RFuture<Void> someMethod2(MyObject param);

}

RRemoteService remoteService = redisson.getRemoteService();
YourServiceAsync asyncService = remoteService.get(YourServiceAsync.class);

RFuture<Long> res = asyncService.someMethod1(12L, "param");
res.thenApply(r -> {
 ...
}); 
```

更多细节[在这里](https://github.com/mrniko/redisson/wiki/6.-distributed-objects#69-remote-service)

# java - 用于音频处理的 Java 实用吗？

> ID：407624
> 
> 赞同：20
> 
> 时间：2009-01-02T18:19:40.567
> 
> 标签：java, performance, audio, signal-processing, real-time

Java 是否适合替代 C/C++ 进行实时音频处理？

我正在考虑一个应用程序，它有大约 100 个（最大）音频轨道，延迟线（30s @ 48khz），过滤（512 点 FIR？），以及每个轨道上同时发生的其他 DSP 类型操作。

这些操作将被转换并以浮点数执行。

该系统可能是运行 Ubuntu 的四核 3GHz 和 4GB RAM。

我已经看到有关 Java 比以前快得多、接近 C / C++ 并且现在还具有实时扩展的文章。这是现实吗？是否需要硬核编码和调整才能达到 C 的 %50-%100 性能？

如果这是可能的，我真的在寻找一种感觉，并为任何问题提个醒。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-02T18:37:49.907

对于音频应用程序，您通常只有非常小的部分代码用于大部分时间。

在 Java 中，您始终可以使用 JNI（Java Native 接口）并将计算量大的代码移动到 C 模块（如果您确实需要强大的功能，也可以使用 SSE 进行程序集）。所以我会说使用 Java 并让你的代码工作。如果事实证明您没有达到性能目标，请使用 JNI。

无论如何，90% 的代码很可能是胶水代码和应用程​​序的东西。但请记住，您会以这种方式失去一些跨平台功能。如果您可以接受该 JNI 将始终为您打开本地代码性能的大门。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-03-06T11:22:21.403

Java 适用于许多音频应用程序。与其他一些海报相反，我发现使用 Java 音频是一种乐趣。将您可用的 API 和资源与 CoreAudio 的可怕的、几乎没有文档记录的 mindf*k 进行比较，您就会相信。Java 音频存在一些延迟问题，尽管对于许多应用程序来说这无关紧要，并且缺乏编解码器。还有很多人从来没有费心花时间编写好的音频播放引擎（提示，永远不要关闭 SourceDataLine，而是向其写入零），然后将问题归咎于 Java。从 API 的角度来看，Java 音频非常简单易用，并且在[jsresources.org](http://jsresources.org/)上有大量的指导。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T18:29:05.337

当然，为什么不呢？

关键问题（独立于语言，来自排队论）是：

*   您需要处理的最大吞吐量是多少（您指定了 100 x 48kHz，是单声道还是立体声，在该频率下等效于多少位？）
*   您的 Java 例程能否平均跟上这个速度？
*   最大允许延迟是多少？

如果您的程序可以跟上平均吞吐量，并且您有足够的延迟空间，那么您应该能够使用队列进行输入和输出，并且程序中唯一对计时至关重要的部分是将数据放入输入队列并将其从输出队列中取出并将其发送到 DAC/扬声器/其他任何东西。

延迟线的计算负载低，你只需要足够的内存（+内存带宽）......事实上你可能应该只使用输入/输出队列，即立即开始将数据放入输入队列，然后开始取出数据30 秒后输出队列。如果它不存在，你的程序太慢了......）。

FIR 更昂贵，这可能会成为瓶颈（以及您想要优化的内容），除非您考虑到其他一些丑陋的讨厌操作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-07-06T11:39:55.367

我认为延迟将是您的主要问题——在现代操作系统上的 C/C++ 中已经很难保持延迟，而 Java 肯定会增加问题（垃圾收集器）。“实时”音频处理的一般设计是让您的处理线程在实时调度中运行（Linux 内核上的 SCHED_FIFO，在其他操作系统上等效），并且这些线程永远不应该阻塞。这意味着没有系统调用，没有 malloc，当然没有 IO，等等......甚至分页也是一个问题（从磁盘获取一个页面到内存很容易需要几个毫秒），所以你应该锁定一些页面以确保它们永远不会换掉了。

你也许可以用 Java 做这些事情，但是 java 让它变得更复杂，而不是更容易。我会研究一个混合设计，其中核心将在 C 中，其余部分（GUI 等）将在 java 中，如果你愿意的话。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-06T11:29:39.817

我在您的问题中没有看到的一件事是您是否需要播放这些处理过的样本，或者您是否正在对它们做其他事情（例如，将它们编码到文件中）。我更担心 Java 声音引擎的状态，而不是 JVM 处理样本的速度。

几年前，我在 javax.sound.sampled 上非常努力地推动了它，并没有留下深刻的印象——它无法与 OpenAL 或 Mac/iPhone 的 Core Audio 等等效框架相比（我都在类似的水平上使用过它们）强度）。javax.sound.sampled 要求您将样本推送到持续时间未知的不透明缓冲区中，这使得同步几乎不可能。它的记录也很差（很难找到通过 Line 流式传输不确定长度音频的示例，而不是内存中剪辑的琐碎示例），具有未实现的方法（DataLine.getLevel() ...甚至没有记录），最重要的是，我相信 Sun 在几年前解雇了最后一位 JavaSound 工程师。

如果我**必须**使用 Java 引擎进行混音和输出，我可能会尝试将 JOAL 绑定到 OpenAL 作为首选，因为我至少知道该引擎当前受支持并且能够实现非常低的延迟. 虽然我怀疑从长远来看 Nils 是正确的，但您最终会使用 JNI 来调用本机声音 API。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-11-15T21:18:07.597

是的，Java 非常适合音频应用程序。您可以使用 Java 并通过 Asio 访问音频层，并且在 Windows 平台上具有非常低的延迟（64 个样本延迟几乎没有）。这意味着您将在视频/电影上进行口型同步。Mac 上的延迟时间更长，因为没有 Asio 可以“捷径”将 OS X 和“Java 在顶部”的组合，但仍然可以。linux也有，不过我比较无知。有关 Java 和 Asio 完美协调工作的实用（也是世界首创）示例，请参阅 soundpimp.com。另请参阅包含 sw mp3 解码器（来自 Java）的 NRK Radio&tv Android 应用程序。您可以使用 Java 完成大多数音频操作，然后在时间紧迫的情况下使用本机层。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-24T17:09:13.467

查看一个名为 Jsyn 的库。

[http://www.softsynth.com/jsyn/](http://www.softsynth.com/jsyn/)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-09-06T02:30:50.943

为什么不花一天时间编写一个简单的 Java 应用程序，该应用程序执行最少的处理并验证性能是否足够。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2017-01-09T18:48:50.763

来自[http://www.jsresources.org/faq_performance.html#java_slow](http://www.jsresources.org/faq_performance.html#java_slow)

> 让我们收集一些以太智慧：
> 
> *   地球是平的。
>     
>     
> *   而且，不要忘记：Java 很慢。
>     
>     
> 
> 正如几个应用程序所证明的（参见链接部分），Java 足以构建音频编辑器、多轨录音系统和 MIDI 处理软件。试试看！

# fitnesse - Fitnesse-重构页面时出错

> ID：407628
> 
> 赞同：0
> 
> 时间：2009-01-02T18:22:29.890
> 
> 标签：fitnesse

嗨，每次我尝试重构页面时，都会收到以下错误 - 无法将 FitNesse.StoreProcedure 重命名为 TestSuite.StoreProcedure TestSuite.StoreProcedure 不是有效的简单页面名称。因此，我在创建测试套件时遇到了麻烦。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T00:47:51.763

您是否试图将页面从一个子 wiki 移动到另一个而不是重命名它？

Refactor 选项卡允许您删除、重命名或移动页面。

要重命名您`FitNesse.StoredProcedure`，请在重命名字段中`FitNesse.TestStoredProcedure`输入`TestStoredProcedure`。

要将您的页面移动到不同的子 wiki - 例如 from `FitNesse.StoredProcedure`到，请在移动字段中`TestSuite.StoredProcedure`输入。`TestSuite`

# .net - 需要内置“邮件合并”功能的 .NET 应用程序

> ID：407629
> 
> 赞同：1
> 
> 时间：2009-01-02T18:22:58.313
> 
> 标签：.net, ms-word, mailmerge

有没有办法在我的应用程序中拥有邮件合并功能？也许是 MS Word API？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T18:25:49.633

是的，您使用 Word Automation：

[http://support.microsoft.com/kb/301659](http://support.microsoft.com/kb/301659)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T18:43:57.927

我已经使用 Microsoft Word 的第三方库实现了它：[Aspose Words](http://www.aspose.com/categories/file-format-components/aspose.words-for-.net-and-java/default.aspx)。

有一些[邮件合并内置功能](http://www.aspose.com/documentation/file-format-components/aspose.words-for-.net-and-java/mail-merge-with-regions-explained.html)。您不需要在客户端或服务器上安装 Microsoft Word 的副本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T18:36:19.643

您可以编写自己的功能，也许从您的数据生成 XML（XmlSerialization 在这里可能是您的朋友）并使用 XSLT 转换来生成选择的输出格式（如果您喜欢 HTML，甚至是直接用于 Word 的 XML 格式）。办公室集成可能会有所帮助，但它可能不会为您的应用程序提供最集成的感觉。

决定取决于谁将创建模板——如果您只想要预先设计的模板，那么选择更加开放——如果您希望最终用户创建它们，您可能只想创建一种友好的生成方式（比如）用于 Word（或他们最喜欢的文字处理器）的 CSV 文件，用于导入和合并邮件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T18:43:05.247

我不推荐使用 MS Word 来提供邮件合并功能，除非您的应用程序已经绑定到 MS Word API。仅出于一个原因使用它将是一个您可能会后悔的决定——就像几年前我后悔这样做一样。虽然大多数人确实拥有 MS Word，但您最终将支持 Word、邮件合并界面和您的应用程序，而只能真正控制您的应用程序。即使界面在您的计算机上运行良好（就像在我们的计算机上一样），您也可能会发现很多很多人根本无法使用您的界面。请记住，如果您的应用程序很受欢迎，即使是 3% 的失败率也可能转化为数千次调用！

如果可能的话，使用第三方库/控件来滚动您自己的邮件合并以进行文字处理。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-28T00:13:53.477

这个不支持（尚） doc 或 docx，但它支持 RTF。另一方面，它是免费的 :) 我正在积极地努力改进它。看一下，可能对您的情况有用。ntemplates.codeplex.com

# oracle - Oracle 数据库到类图

> ID：407639
> 
> 赞同：2
> 
> 时间：2009-01-02T18:28:12.063
> 
> 标签：oracle

我们在一个项目中使用了一个 oracle 数据库。大多数表代表应用程序中的类或对象。该应用程序目前没有大量的文档。我正在使用 StarUML 为项目中的其他开发人员制作一些类图等，以增加他们对整个项目的理解。使用数据库表作为入门指南，然后根据需要对图表进行修改将是进行这些设置的最简单和最快捷的方法。是否有任何免费应用程序可以帮助我从 Oracle 数据库中提取模式并从中创建类图？目前，有 98 个“对象”或类在数据库中紧密建模，在建模应用程序中从头开始创建所有这些将非常耗时。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T18:51:52.840

你没有说你的目标语言是什么。

您可以使用 Hibernate 从对象模型和映射生成模式。

Middlegen 是一个可以从模式创建 Java 类的工具。也许这些会有所帮助。

1:1 对象到表的映射并不总是最好的做事方式。它几乎不是面向对象的。我只会将其视为一个起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T18:54:34.363

我（简要地）查看了 StarUML 文档，没有看到任何导入数据库定义的方法，所以我不确定你是如何做到这一点的，抱歉。

如果您能找到将数据导入 StarURL 的方法，则可以使用 Oracle 的免费 SQL Developer 工具将表定义作为 DDL 或 XML 导出。

我知道微软的 Visio 工具（专业版和企业版）可以从您的 Oracle 数据库中读取选定的表并从中生成模型，但它并不便宜。我真的很喜欢 Allround Automation 的 PL/SQL Developer 作为面向程序员（相对于 DBA）的价格合理的 IDE，而且我知道它会在本地生成图表。但我不确定它是否可以将元数据保存为您可以在 StarUML 中使用的形式。

祝你好运，

- 炖

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T17:35:06.097

很遗憾您没有费心回复您自己的问题。还是我误解了人们只是给分然后继续前进的标准做法？

# sql - SQL：判断列是否彼此唯一

> ID：407646
> 
> 赞同：0
> 
> 时间：2009-01-02T18:30:09.343
> 
> 标签：sql

假设我有一张桌子：

```
Role
----
person_id company_id financial_year 
```

我怎么能说出以下内容：

1.  在此表中，每个 person_id 是否每个 company_id 每个财务年度最多出现一次
2.  如果 1\. 为假，则哪一个 person_id's 和 company_id's 和 financial_year's 多次同时出现

编辑1：编辑添加financial_year col

编辑 2：这里的 RDBMS 平台恰好是 MySQL，尽管我不认为这需要很多特定于供应商的 SQL

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T18:38:16.957

首先，最好有一个分组，然后可以根据需要对其进行过滤：

```
select
  r.company_id, r.person_id, r.financial_year, count(r.person_id) 
from
  Role as r 
group by
  r.company_id, r.person_id, r.financial_year 
```

对于第二个，您可以像这样修改上面的内容：

```
select
  r.company_id, r.person_id, r.financial_year, count(r.person_id) 
from
  Role as r 
group by
  r.company_id, r.person_id, r.financial_year
having
  count(r.person_id) > 1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T18:37:45.817

这应该做你需要的：

```
select left.person_id, left.company_id, left.financial_year, count(*)
from role left
inner join role right
    on left.person_id = right.person_id 
        and left.company_id = right.company_id
        and left.financial_year = right.financial_year
group by left.person_id, left.company_id, left.financial_year 
```

请注意，这是 T-SQL (MS)，但我所知道的唯一可能改变的是表别名语法，其余的是 ANSI SQL。这将为每个重复的人/公司/年份组合返回一行，并计算该组合重复的次数（尽管问题中没有提到该计数，但我知道它有时会很有用）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T18:58:15.730

我认为这将为＃1做到这一点：

```
select count(*), count(distinct person_id, company_id, financial_year)
    from role 
```

（编辑：如果两个 count() 不同，则表中每个三列的唯一组合包含多行，这是我在问题 #1 中所问的。取它们的差来获得此类行的数量。 )

并且 casperOne 的答案将为 #2

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T19:36:04.483

是的，一般来说，为了检测重复，

```
Select [ColumnList you want to be unique]
From Table
Group By [SameColumn List]
Having Count(*) > 1 
```

在您的具体情况下

```
Select person_id, company_id, financial_year
From Table
Group By person_id, company_id, financial_year
Having Count(*) > 1 
```

或者，对于您的子问题 (1)，关于此表中每个 person_id 是否每个 company_id 每个财务年度最多出现一次

```
Select company_id, financial_year
From Table
Group By company_id, financial_year
Having Count(Person_Id) > 1 
```

而对于 (2): (当 (1) 为假时，person_id 和 company_id 以及 Financial_year 多次同时出现

```
Select person_id, company_id, financial_year
From Table T
Where Not Exists 
     (Select * From Table
      Where company_id = T.company_id 
         And financial_year = T.financial_year          
      Having Count(Person_Id) > 1)
Group By person_id, company_id, financial_year
Having Count(*) > 1 
```

# jquery - 如何使用 ASP.NET MVC 在 jQuery AJAX 调用中触发“错误”回调？

> ID：407651
> 
> 赞同：31
> 
> 时间：2009-01-02T18:31:31.913
> 
> 标签：jquery, asp.net-mvc, ajax

这与我关于[如何处理来自 jQuery AJAX 调用的错误的](https://stackoverflow.com/questions/407596/how-do-you-handle-errors-from-ajax-calls)问题有关。一些响应建议我使用“错误”回调来显示来自 jQuery AJAX 调用的任何错误。我想知道如何使用 ASP.NET MVC 做到这一点。有没有办法让我的控制器操作返回可以从“错误”回调访问的错误？客户端代码如下所示：

```
$.ajax({
   type: "POST",
   url: "MyUrl",
   data: "val1=test",
   success: function(result){
        // Do stuff
   },
   error: function(request,status,errorThrown) {

   }
 }); 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-02T18:53:41.993

注意：嘿，这是在 ASP.Net MVC 甚至达到 1.0 之前发布的，从那时起我什至没有看过该框架。您可能应该停止对此表示赞同。

* * *

做这样的事情：

```
Response.StatusCode = (int)HttpStatusCode.BadRequest;
actionResult = this.Content("Error message here"); 
```

状态码应根据错误的性质而改变；通常，4xx 用于用户生成的问题，5xx 用于服务器端问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-02T19:14:09.207

如果你正在使用

```
[HandleError] 
```

然后抛出**HttpException**将被捕获并路由到您的自定义错误页面。

另一种选择是使用

```
Response.StatusCode = 500;
Response.Write("Error Message");
Response.End(); 
```

可能有一种更方便的方法来写这个，但我还没有偶然发现它。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-09-29T13:17:04.103

如果您使用的是 MVC 3，那么您可以在控制器中返回一个 ActionResult，其中包含 HTTP 状态代码和状态消息：

```
return new HttpStatusCodeResult(500, "Error message"); 
```

然后，在您的错误回调中：

```
error: function (request, textStatus, errorThrown) {
    alert(request.statusText);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T18:38:50.840

我认为对于响应代码不是 200 的任何响应都会引发该事件。但我在文档中找不到这一点的证据。

从代码中执行此操作（在 Webforms 中工作）：

```
throw new HttpException(500, "Error message"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-02T18:45:45.990

根据[这个](http://groups.google.com/group/jquery-en/browse_thread/thread/4480642a3824bd60)页面，您只需要`HTTP/1.0 500 Internal Server Error`在您的 ASP.net 页面上应用标题。该`$.ajax`请求将捕获该错误并执行`error`回调函数。=]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-29T08:56:45.750

我给你一个建议；适用于受控和不受控制的异常。

```
 public class CodeExceptionToHttpFilter : FilterAttribute, IExceptionFilter
{
    public CodeExceptionToHttpFilter()
    {
      Order = 2;
    }
    public void OnException(ExceptionContext filterContext)
    {
      var codeException = filterContext.Exception as CodeException;
      var response = filterContext.RequestContext.HttpContext.Response;
  response.StatusCode = (codeException == null)? 550: 551;
      response.ContentType = MediaTypeNames.Text.Plain;
      response.Charset = "utf-8";
      response.Write(filter.Exception.Message);
      filterContext.ExceptionHandled = true;
      response.TrySkipIisCustomErrors = true;
   } 
```

}

更多信息在我的博客上。 [http://rodrigopb.wordpress.com/2012/11/28/gestion-de-errores-en-peticiones-ajax-a-mvc/](http://rodrigopb.wordpress.com/2012/11/28/gestion-de-errores-en-peticiones-ajax-a-mvc/)

# emacs - 如何保存我在 LispBox/Slime 中输入的所有函数？

> ID：407658
> 
> 赞同：6
> 
> 时间：2009-01-02T18:36:20.127
> 
> 标签：emacs, lisp, read-eval-print-loop, slime

情况：我在 Emacs 中使用 REPL 时输入了几个函数。问题：当我只是保存缓冲区时，会有像“;评估中止”这样的垃圾。我想要的：清楚地描述我在其最新版本中输入的所有功能。

我可以这样做吗？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T18:49:15.030

我不明白。您是否在 REPL 中输入定义并期望稍后恢复它们？只需像使用任何其他语言一样保存源文件。使用 Cx 2 将您的 Emacs 窗口一分为二。在其中一个 Cx Cf foo.lisp 中打开一个源文件。使用 Cc Ck、Cc Cr 和朋友（参见 SLIME 菜单）来编译/评估 REPL 中源代码的区域。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-02T19:00:04.337

我过去一直在寻找类似的东西，但一直找不到。你最好将所有定义写在一个单独的缓冲区中，并使用 SLIME 广泛的评估/编译功能（Cc Ck 加载整个文件，Cx Ce 评估最后一个表达式，Cc Cr 评估一个区域等），只直接进入REPL 你不想保存的东西。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-02T19:09:57.920

嗯，`C-x o`或者`C-x b`去 SLIME REPL 缓冲区，然后`C-x w`或者`C-x C-s`将其保存到文件中。所有 SLIME/CL 的东西都是读者评论；您可以编写阅读器技巧来重新加载将提示视为注释的文件，或者您可以自己浏览文件以捕获要保存的部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-03T16:12:31.507

我同意最好的工作流程方法是将代码写入单独的缓冲区并在其中进行评估，而不是在 repl 中输入函数。

假设您已经采用了 repl 方式，我猜想，C. Martin 保存 repl 日志并手动检查它的解决方案是您唯一的选择。

如果您将函数和变量输入到单独的包中，则可以通过包中的符号来帮助您决定要保留的内容。

例如查看在 cl-user 包中创建的所有符号：

```
(let ((p (find-package :cl-user)))
  (loop
     for s being the symbols in p
     when (eq p (symbol-package s))
     do (format t "~a~%" s))) 
```

# sql-server-2005 - 从 sql server 2005 查询 AD

> ID：407671
> 
> 赞同：3
> 
> 时间：2009-01-02T18:40:08.543
> 
> 标签：sql-server-2005, active-directory, ldap, adsi

我试图从 SQL Server 2005 中通过 ldap 查询 AD，但收到以下错误：

Msg 7321, Level 16, State 2, Line 1 准备查询“SELECT NAME,MAIL FROM "LDAP:///CN=foo,CN=Users,DC=bar,DC=com"" 执行时出错链接服务器“ADSI”的 OLE DB 提供程序“ADsDSOObject”。

这是在执行以下存储过程之后：
exec sp_addlinkedserver 'ADSI', 'Active Directory Services 2.5', 'ADsDSOObject', 'adsdatasource'

目前，我正在本地 SQL Server 2005 实例上运行查询。我尝试将安全上下文更改为 1) Made without... ，2) 使用登录名的当前 ... 制作，以及 3) 使用此安全上下文制作：指定我自己的域帐户。三个都一样的错误。

不确定是否重要，但“bar”（请参阅​​上面的 ldap 查询）不是我的机器（本地 sql 服务器实例）或 ldap 服务器的域。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T21:29:35.053

主要问题是LDAP查询周围的双引号需要双引号。

LDAP 查询可以包括服务器名称或 IP 和/或 LDAP 规范。

一些对我有用的查询：

```
SELECT * FROM OPENQUERY
(ADSI,'SELECT NAME FROM ''LDAP://*ldap.server.name*''') 
```

```
SELECT * FROM OPENQUERY
(ADSI, 'SELECT name, sAMAccountName, distinguishedName 
FROM ''LDAP://DC=*mycompany*, DC=*mytld*''
WHERE objectCategory = ''Person'' AND objectClass = ''user''') 
```

```
SELECT * FROM OPENQUERY
(ADSI,'SELECT name, sAMAccountName, distinguishedName
FROM ''LDAP://*ldap.server.name*/OU=ITDept, OU=users, OU=DC, OU=Corporate, DC=*mycompany*, DC=*mytld*''
WHERE objectCategory = ''Person'' AND objectClass = ''user''') 
```

再一次......上面没有双引号......多个单引号。

ADSI 需要注册/链接

```
EXEC sp_addlinkedserver 'ADSI', 'Active Directory Service Interfaces', 'ADSDSOObject', 'adsdatasource' 
```

如果您有权限问题，您可以在 ADSI 链接服务器上的安全属性选项卡下设置使用的帐户。

# php - 我如何使用 Zend 框架在数据库中插入和获取值

> ID：407687
> 
> 赞同：0
> 
> 时间：2009-01-02T18:45:49.810
> 
> 标签：php, zend-framework

我如何使用 Zend 框架将我的用户名、密码值插入数据库。

以及如何使用 zend 框架从数据库中获取值。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T18:58:19.037

你有在 PHP 中使用数据库的知识吗？在进入框架之前，您绝对应该[从那里开始。](http://dev.mysql.com/tech-resources/articles/ddws/index.html)当您对 PHP 和数据库如何交互有了基本的了解后，将其转换为像 Zend 这样的优秀框架应该不会太困难。

[Zend Framework 手册对数据库可以做的所有事情](http://framework.zend.com/manual/en/zend.db.html)都有相当全面的概述。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-10-09T13:33:04.803

/ **Insert** / /** * 我假设你正在通过控制器传递数据 */

```
class Application_Model_YourModelName extends Zend_Db_Table_Abstract {

private static $_instance = null;
protected $_name = 'YourModelName';

public static function getinstance() {
    if (self::$_instance == null)
        self::$_instance = new Application_Model_YourModelName();
    return self::$_instance;
}

public function insertFunction(){
  if(func_num_args()>0){
      $userName = func_get_arg(0); // or some index if wanna pass through key value pair
     $password = md5(func_get_arg(1));
       $data = array('userName'=>$userName, 'password'=>$password);
         $insert = $this->insert($data);
  }
}

public function fetchFunction(){
  $sql = $this->select()
       ->where("*Your condition*")
       ;
   $result = $this->getAdapter->fetchAll(sql);
} 
```

在安全方面使用 md5 函数不够安全，你可能想寻找 bcrypt 散列算法。这是相同的链接：http: [//framework.zend.com/manual/current/en/modules/zend .crypt.password.html](http://framework.zend.com/manual/current/en/modules/zend.crypt.password.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-28T05:03:48.587

```
/**
*
*To insert your values
*
* Here $uname and $password are values dynamically
*/

$db = new Zend_Db(....);
$data = array(
              'vUserName'=>$uname,
              'vPassword'=>md5($pwd)
);

$db->insert('tablename',$data);

/*
* 
*To get the values 
*
*/

$sql = "SELECT * FROM <TABLENAME> WHERE vUserName = '".$uname."'";
$data = $db->fetchAll($sql);
return $data; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T19:08:24.960

```
$db = new Zend_Db(....);
$data = array('username'=>'thomaschaaf', 'password'= md5('secret'));
$db->insert('field', $data); 
```

# java - Apache Derby：我该如何做“如果不存在则插入”？

> ID：407688
> 
> 赞同：13
> 
> 时间：2009-01-02T18:46:22.027
> 
> 标签：java, sql, derby

我正在给[Apache Derby](http://db.apache.org/derby/)，又名[JavaDB](http://developers.sun.com/javadb/)一个旋转。在插入可能已经存在的记录时，我似乎无法解决重复键问题。是否有相当于 " `insert if not exists`" 或 " `merge`" 的德比？

同样，有没有办法做类似“ `drop table foo if exists`”的事情？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-10T12:56:26.463

我从未使用过 apache derby，但是一个完全独立于数据库的通用解决方案如下：

要将值 'a' 和 'b' 插入到表 foo 中（列名为 A，B），但仅限于值不存在的地方，请尝试类似

```
INSERT INTO foo (  
  SELECT 'a' as A, 'b' as B
  FROM foo  
  WHERE  
    A = 'a' AND B = 'b'  
  HAVING count(*)=0  
 ) 
```

这可能需要针对特定​​的 dbms 进行调整，但想法是插入仅在没有值时才返回值的选择结果。

这是创建幂等 sql 脚本（第二次运行时不执行任何操作）的有用技巧。但是，在生产代码中使用它时要小心，因为`HAVING count(*)=0`在大表上可能会非常慢。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-21T04:12:06.900

支持 SQL:2003 MERGE 语句的请求在 Derby 错误跟踪器中记录为[https://issues.apache.org/jira/browse/DERBY-3155](https://issues.apache.org/jira/browse/DERBY-3155)

你可以为这个问题投票，或者更好的是，贡献一个实现！

否则，我所知道的唯一解决方案需要先选择行以查看它是否存在，或者插入它并捕获异常，正如其他人所指出的那样。

您可以将此逻辑打包到数据库过程中，以使其更易于执行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-01T14:13:07.553

我使用 PostgreSQL 数据库的标准方法如下：

```
INSERT INTO foo ( col1, col2, col3, ... )
SELECT 'col1 value', 'col2 value', 'colc value', ...
WHERE NOT EXISTS (
  SELECT 0
  FROM foo
  WHERE col1 = 'col1 value'
  ...
) 
```

不确定它的可移植性或严格符合 ANSI 的程度。外部 SELECT 语句中缺少的 FROM 子句尤其可能是非标准的。试一试吧。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-08-31T07:18:25.720

Derby 在 10.11 中实现了 MERGE：[https](https://db.apache.org/derby/docs/10.11/ref/rrefsqljmerge.html)
://db.apache.org/derby/docs/10.11/ref/rrefsqljmerge.html 请 注意，您需要在使用数据库之前将其升级到 10.11：[https ://db.apache.org /derby/docs/10.11/devguide/cdevupgrades.html](https://db.apache.org/derby/docs/10.11/devguide/cdevupgrades.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-16T22:05:28.610

我遇到了同样的问题，我得到了这个在 Derby 上只有一个值/列的插入。（我从来没有用更多的时间来测试它，但我没有理由认为它不应该）：

```
INSERT INTO my_table (my_column)
    (SELECT 'new_value_to_insert'
    FROM my_table
    WHERE my_column = 'new_value_to_insert' 
    HAVING count(*)=0) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-29T08:52:19.390

**我正在使用此解决方案，但只有在您了解数据库视图**中的**重复项与用户视图**中的重复项之间的区别时，您才必须使用它

 ***   数据库视图中的重复项是具有相同主键的两条记录
*   用户视图中的重复项是所有字段都相同的两条记录

    ```
     while (ResultSet.next()) {
        try {
        PreparedStatement insertion = myConn.prepareStatement("insert into table values (?)");
        insertion .setString(1, "test");
        insertion .executeUpdate();           
        } catch (SQLException e) {
            if(e.getSQLState().equals("23505"))//Found duplicate from database view
             {continue;}//ignore duplicate and continue with the insert statement
            else{try {                           
                  throw e;
            } catch (Exception ex) {  
                }
              }
            }
          } 
    ```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-27T22:10:03.983

对此没有本机支持，为了解决这个问题，我正在使用 eclipse-link，eclipse-link 将尝试创建表并忽略尝试创建已经存在的表时出现的任何错误。

如果您进行架构更改，您可以告诉 eclipse 链接在创建表之前删除它们。

# asp.net - 如何使用 ASP.Net 将 Rtf 转换为文本？

> ID：407689
> 
> 赞同：3
> 
> 时间：2009-01-02T18:46:27.657
> 
> 标签：asp.net, text, rtf

如何使用 ASP.Net 从 RTF 转换为文本格式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:26:10.027

[您在MSDN](http://msdn.microsoft.com/en-us/library/cc488002.aspx)上有说明

在 C# 中

```
class ConvertFromRTF
{
    static void Main()
    {

        string path = @"test2.rtf";

        //Create the RichTextBox. (Requires a reference to System.Windows.Forms.dll.)
        System.Windows.Forms.RichTextBox rtBox = new System.Windows.Forms.RichTextBox();

        // Get the contents of the RTF file. Note that when it is
        // stored in the string, it is encoded as UTF-16.
        string s = System.IO.File.ReadAllText(path);

        // Display the RTF text.
        System.Windows.Forms.MessageBox.Show(s);

        // Convert the RTF to plain text.
        rtBox.Rtf = s;
        string plainText = rtBox.Text;

        // Display plain text output in MessageBox because console
        // cannot display Greek letters.
        System.Windows.Forms.MessageBox.Show(plainText);

        // Output plain text to file, encoded as UTF-8.
        System.IO.File.WriteAllText(@"output.txt", plainText);
    }
} 
```

# c# - 如何在 Progress Database Character[] 数据类型和 C# 字符串之间进行转换？

> ID：407690
> 
> 赞同：1
> 
> 时间：2009-01-02T18:47:12.990
> 
> 标签：c#, odbc, progress-db

进度数据库允许 Character[x] 数据类型。如何使用 C# 和 ODBC 写入特定的 x？

除非您了解 Character[x] 的含义，否则请不要回答……它不是字符串（字符数组），而是字符串数组（字符数组）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T09:20:00.797

> 格式 x(24) 表示数组中的每个字符串可以是 24 个字符长。

不太准确，格式是 DISPLAY 格式，很多 Progress 例程在显示/打印/导出该字段时使用该格式。所有字符字段，无论是否有范围，都作为可变长度字符串存储在数据库中。因此，您可以轻松地在 20 个数据块中的每个数据块中拥有多达 32K 的数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T17:19:52.477

我想到了。我拥有的文档引用了字符 [20] 的数据类型，格式为 x(24)。character[x] （其中 x 是一个数字），就像一个字符串数组。格式 x(24) 表示数组中的每个字符串可以是 24 个字符长。

本质上是 characters[20]，格式 x(24) 是一个 20 * 24 个字符长的字符串，每个“数组元素”用分号 (;) 分隔。

如果列“options”被定义为 character[20], x(24) 然后用从 1 到 20 的字符串填充它，只需写：

row.options = "1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20";

要使用所有空字符串填充它，请写入：

row.options = ";;;;;;;;;;;;;;;;;;;;";

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T19:28:16.263

[Progress ODBC Driver Guide](http://www.psdn.com/library/servlet/KbServlet/download/1102-102-905/odr.pdf)似乎根本没有提到那种类型？

# javascript - Dojo 到 jQuery 迁移

> ID：407691
> 
> 赞同：4
> 
> 时间：2009-01-02T18:47:36.140
> 
> 标签：javascript, jquery, frameworks, dojo, code-migration

我有这个代码：

```
dojo.declare("City", null, {
    constructor : function(cityid, cityinfo){
    }
});

dojo.declare("TPolyline", GPolyline, {
    constructor     : function(points, color){

    },
    initialize      : function(map){
}); 
```

它应该是什么 jQuery 等价物？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T19:18:16.937

我不认为 jQuery 提供了开箱即用的创建类和包的工具。你可以看看是否有一个[插件](http://docs.jquery.com/Plugins#jQuery_Extensions)可以做到这一点。

如果事实证明这不是真的，我也很想知道答案！我使用了一点 jQuery，但使用 YUI 来构建包和类。

# .net - 在数据库事务中自动包装单元测试？

> ID：407702
> 
> 赞同：2
> 
> 时间：2009-01-02T18:51:47.943
> 
> 标签：.net, nunit, aop

[编辑（哈伦）：[重复](https://stackoverflow.com/questions/321180/how-do-i-test-database-related-code-with-nunit)]

我正在寻找一种将我的 NUnit 集成测试自动包装在数据库事务中的方法，以便在测试结束时自动回滚测试所做的更改。理想情况下，我会用自定义属性装饰某些测试方法，这会导致 NUnit 在测试开始时创建事务并在测试结束时回滚...我可以编写属性，但我不知道在哪里添加检查它。

测试数据库大小为 3GB，因此无法在每次测试开始时恢复它。我知道我可以在每个测试的主体中手动创建一个事务，但我正在寻找更优雅的东西。

也许有一个 IL 重写工具（也许是 AOP 框架）可以为我做到这一点？有人有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:01:55.020

您不会在这里遇到嵌套事务的麻烦吗？据我了解，大多数数据库不支持事务中的事务。因此，如果被测代码完全使用事务（我认为如果您使用的是支持事务的数据库，那么您将使用它们），那么您真正想要的是嵌套事务，（我被告知）大多数数据库不直接支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T18:59:31.093

有两个建议。第一种是使用 SetUp 和 TearDown 属性来启动事务并在完成后回滚。在 NUnit 中这样做的文档在这里：

[http://www.nunit.org/index.php?p=setup&r=2.4.8](http://www.nunit.org/index.php?p=setup&r=2.4.8)

如果您不想使用它，我看到的另一个选项是在每个方法中对其进行编码，但在 using 语句中使用 TransactionScope 实例来创建事务（提供者应该自动登记）。

当然，您也可以在 SetUp 和 TearDown 方法中创建 TransactionScope 实例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T18:58:29.177

春网？

我来自 Java/JUnit 背景，但我知道在 Java 中你可以使用 Springframework 来做到这一点。

（您还必须从 ApplicationContext/BeanFactory 获取您的测试，以便对其应用 AOP）。

# entity-framework - 使用实体框架将现有实体添加到新创建实体的集合中

> ID：407712
> 
> 赞同：8
> 
> 时间：2009-01-02T18:56:00.087
> 
> 标签：entity-framework, many-to-many

我正在使用实体框架来创建新订单。该订单包含联系人集合，多对多关系。我想在创建订单时添加对现有联系人的引用。订购和联系实体对象。

```
 Order order = new Order();

 //set details on order

 Contact contact = new Contact();

 EntityKey contactKey =
                    new EntityKey("OrderDetails.Contact",
                        "contact_id", contact.Key.Id);

 contact.EntityKey = contactKey;
 contact.contact_id = contact.Key.Id;

 order.Contact.Attach(contact);  // throws an exception!

 OrderDetails ordTable = new OrderDetails();
            ordTable.AddToOrder(order);
            int result = orgTable.SaveChanges(); 
```

当我去附加，这个异常被抛出：

“当与此相关端关联的源对象处于添加、删除或分离状态时，附加不是有效操作。使用 NoTracking 合并选项加载的对象始终是分离的。”

我知道我可能错过了一步，或者没有完全理解实体框架如何处理多对多关系。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-16T05:16:33.520

不允许“附加”，因为您尚未保存订单。调用“添加”告诉 Entity Framework 您要插入一个新联系人。所以你只剩下一个选择。您需要加载联系人。

这是最快的方法：

```
OrderDetails context = new OrderDetails();
Contact contact = context.GetObjectByKey(new EntityKey("OrderDetails.Contact", "contact_id", existingContactId));
order.Contact.Add(contact); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-05T15:48:35.440

如果 Order 有一个属性 Contact，那么你可以这样做：

```
order.Contact.Add(contact); 
```

不过，我建议将属性称为 Contact **s**而不是 Contact。

# c# - 除了修改 web.config 之外，如何重新启动 asp.net 应用程序

> ID：407713
> 
> 赞同：29
> 
> 时间：2009-01-02T18:57:21.817
> 
> 标签：c#, asp.net, restart

除了从应用程序内部触摸 web.config 之外，是否有推荐的方法来反弹 asp.net 应用程序？是`HttpRuntime.UnloadAppDomain()`；这样做的首选方法是什么？如果是这样，你在哪里做这个？在卸载页面或应用程序的其他地方？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-02T19:21:01.580

IMO，从应用程序内部触摸 web.config 是个坏主意。此外，拥有一个您修改的文件的想法有点陈词滥调，IMO。

该文档特别指出[`UnloadAppDomain`](http://msdn.microsoft.com/en-us/library/system.web.httpruntime.unloadappdomain.aspx)将关闭应用程序：

> UnloadAppDomain 允许以编程方式关闭未使用的应用程序。

您应该能够在应用程序的任何位置进行此调用。请注意，您可能会得到一个[`SecurityException`](http://msdn.microsoft.com/en-us/library/system.security.securityexception.aspx)，因此请确保运行时为您提供适当的权限（您可能希望将其放入库中并进行调用，然后在 GAC 中设置库并提供充分信任的证据） .

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-02T19:14:56.587

如果这是 .NET 2.0 或更高版本，则可以添加“App_offline.htm”文件，向服务器发出请求，将其删除，然后向服务器发出另一个请求。

只要文件夹中存在 app_offline.htm 文件，这一系列事件就会强制 ASP.NET 卸载应用程序。

Scott Guthrie 的博客文章： [http ://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2015-12-08T11:12:02.230

这段代码对我有用。只需调用它来重新加载应用程序。

```
System.Web.HttpRuntime.UnloadAppDomain(); 
```

[阅读更多](http://daron.yondem.com/asp_net_uygulamalarina_programatik_restart)

> 这个方法只会卸载我们的应用程序。如果您只是将此方法放在 ASP.NET Web 按钮中，那么您就完全完成了。那么我们的应用程序什么时候会重新加载呢？实际上，如果您单击按钮，它将首先启动我们的方法并卸载应用程序。在那一刻我们所在的网页上也会重新加载，因为我们只需单击一个按钮，网页就会刷新。启动我们的方法后，页面刷新过程也会导致我们的应用程序重新加载。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-02T19:02:48.153

您也可以停止和启动与应用程序关联的应用程序池。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-04-20T00:17:59.440

您可以通过调用***HttpRuntime.ShutdownAppDomain***方法来做到这一点（您需要使用反射来调用它，因为它是一个私有静态方法）

有关我如何在“重新启动”REST API 中使用此方法的示例，请参阅[如何以编程方式重新启动 IIS 工作进程（即关闭当前的 ASP.NET 域）](http://blog.diniscruz.com/2013/04/how-to-restart-iis-worker-process.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-12T04:25:46.517

您可以通过在运行时在应用程序目录下创建或重命名文件夹来安全地重新启动 Web 应用程序。显然，您需要授予分配给运行应用程序的用户对 web 目录或其下的子目录的“修改”权限。

该方法在 [http://www.bartlannoeye.be/blog/restarting-a-.net-web-application-without-restarting-iis中提到](http://www.bartlannoeye.be/blog/restarting-a-.net-web-application-without-restarting-iis)

在我的情况下，我使用以下代码来执行此操作。修改它以在“可写”子目录上工作

```
protected void RestartButton_Click(object sender, EventArgs e)
{
    //restart web app (instead of iisreset)
    DirectoryInfo dir = new DirectoryInfo(Server.MapPath("restart"));
    if (dir.Exists)
    {
        Directory.Move(dir.FullName, dir.FullName + "ed");
    }
    else
    {
        DirectoryInfo dired = new DirectoryInfo(Server.MapPath("restarted"));
        if (dired.Exists)
        {
            Directory.Move(dired.FullName, dir.FullName);
        }
        else
        {
            Directory.CreateDirectory(dir.FullName);
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T19:46:54.213

如果您不想停止并启动应用程序池，您可以随时回收它。

# sql-server - 插入后停止 LINQ to SQL 执行选择语句

> ID：407720
> 
> 赞同：6
> 
> 时间：2009-01-02T18:59:09.003
> 
> 标签：sql-server, linq, sql-server-2005, linq-to-sql

我正在使用 LINQ to SQL 来更新我的数据库。我插入了很多记录，当我调用 SubmitChanges() 时，LINQ to SQL 为每个对象执行一个插入和一个选择语句。在将对象插入数据库后，我真的不关心更新我的对象。

你知道我可以阻止 LINQ to SQL 在插入语句之后发出选择语句吗？这应该使我的应用程序更快。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T20:49:33.477

您正在寻找[ColumnAttribute.AutoSync](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.columnattribute.autosync.aspx)。如果您使用设计器，请检查每一列的自动同步属性并将其设置为从不。

**编辑：** 好的，这对你不起作用。为一些映射黑客做好准备！

当我插入一些自动生成的主键列时，我得到了这个 SQL：

```
INSERT INTO [dbo].[TableName]( fieldlist )
VALUES (@p0, @p1, @p2, @p3, @p4)

SELECT CONVERT(Int,SCOPE_IDENTITY()) AS [value] 
```

据我了解你的要求，你不想要那个 SELECT

尝试 1：我转到主键字段并将自动生成设置为 false。这导致了 Sql 异常“当 IDENTITY_INSERT 设置为 OFF 时，无法在表 'TableName' 中插入标识列的显式值。” 换句话说，linq 为该列指定了一个值。

尝试 2：我从设计器中删除了自动生成的列。这导致 Linq 给我一个无效的操作异常：“无法对 'Table(TableName)' 执行创建、更新或删除操作，因为它没有主键。”

尝试 3：我从设计器中删除了自动生成的列，然后将另一列标记为主键。即使此列不是数据库中的主键，LINQ 的 DataContext 也会使用它来跟踪行标识。对于给定 DataContext 的观察记录，它必须是唯一的。

第三次尝试生成了以下 SQL（这是您要求的）

```
INSERT INTO [dbo].[TableName]( fieldlist )
VALUES (@p0, @p1, @p2, @p3, @p4) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T19:13:42.547

我现在不记得设置了，但是在设计器中，在列的属性上，您有一些“刷新”设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-21T20:03:03.293

我曾经在一个项目中遇到过这个问题。我只是使用了 context.ExecuteCommand({sql string here.})。这是针对一个导致性能问题的插入。在我看来，最简单的修复，易于查看和维护，而不是挖掘模型。

# c# - 使用 Linq 确定一个序列是否包含另一个序列的所有元素

> ID：407729
> 
> 赞同：114
> 
> 时间：2009-01-02T19:02:48.950
> 
> 标签：c#, linq

给定两组值：

```
var subset = new[] { 2, 4, 6, 8 };

var superset = new[] { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 }; 
```

如何确定是否`superset`包含所有元素`subset`？

我想出了这个：

```
superset.Intersect(subset).Count() == subset.Count() 
```

这是最合乎逻辑和最有效的方法吗？

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2009-01-02T19:09:33.693

数数？Not Any 怎么样？

```
bool contained = !subset.Except(superset).Any(); 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-02T21:35:05.913

所以，我的另一个答案很容易使用。但这是一个 O(n*m) 解决方案。

这是一个稍微不太友好的 O(n+m) 解决方案。如果超集很大，应该使用这个。它避免了重复枚举超集。

```
HashSet<int> hashSet = new HashSet<int>(superset);
bool contained = subset.All(i => hashSet.Contains(i)); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-11-09T12:54:47.260

我有一个使用现有 Contains() 方法的扩展方法。我发现它比使用 Instersect() 或 except() 更直观。

```
public static bool ContainsAll<T>(this IEnumerable<T> source, IEnumerable<T> values)
{
    return values.All(value => source.Contains(value));
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T19:07:28.707

您可以使用除外，结果计数应为 0。

在 MSDN 上阅读参数的详细信息。

例子：

```
subset.Except(superset).Count() == 0 
```

# language-agnostic - 包含常数集的测试

> ID：407731
> 
> 赞同：2
> 
> 时间：2009-01-02T19:04:06.920
> 
> 标签：language-agnostic, code-generation, set, predicate

问题陈述：

给定一组预先知道的整数，**生成**代码来测试集合中是否有单个整数。测试函数的域是某个连续范围内的整数。

* * *

现在对要测试的范围或集合一无所知。范围可以很小也可以很大（但解决方案可以拒绝很大的问题，但更高的限制更好）。可能是允许范围内的值很少在集合中，或者它们中的大多数在集合中，或者介于两者之间。该集合可以是均匀分布的或聚集的。可能有大部分只包含/不包含的值，或者在大多数条带中每种类型的值可能至少有几个。（有点像在分析排序算法时对要排序的项目所做的假设）

目标是生成用于运行测试的有效代码的过程。

想到的部分解决方案包括

*   完美的散列函数（大集合成本高）
*   范围测试：`foreach(b in ranges) if(b.l <= v && v <= b.h) return true;`
*   树/索引（在某些情况下比其他更昂贵）
*   表查找（大集合成本高）
*   这些中的任何一个的倒数（[杰森 S](https://stackoverflow.com/users/44330/jason-s)的科多斯）

似乎一个理想的解决方案能够选择最好的选项，或者如果没有一个效果很好，使用树将整个范围分解为部分，然后切换到更适合它们的其他子部分选项。

可能有用的主题包括：

*   [霍夫曼编码](http://en.wikipedia.org/wiki/Huffman_coding)

* * *

注意：这不是家庭作业。如果它是作为低于博士水平的家庭作业发布的，教授应该用 Nerf 枪射击（如果你没有得到那个然后重新阅读问题，这非常重要）

注意：这是我几天前遇到的一个问题，我一直在困惑。我对此没有直接用途，但认为这将是一个很酷的攻击问题。我想要生成代码的原因是因为生成的代码不会比一般代码慢（如果需要，它可以是同一件事）并且在某些/许多情况下可能会更快。

我发布这个问题是为了澄清我的想法。如果我能想出任何合理或酷的解决方案，我计划将它们实现为模板元程序（生成代码的另一个原因）

有些人注意到这个问题非常普遍。这就是我想说的。我希望生成一个可以在一个非常普遍的领域工作的系统：某个范围内的整数集。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T20:10:45.117

让我们暂时假设这是一个真实的问题：

*   基集或输入集的大小没有限制

这使得“问题”在任何实际意义上都是不切实际的、未指定的和无法解决的

如果有人想提出解决方案，这里有一些单元测试用例：

*   单元测试1：

    *   基集是 -1,000,000,000,000 和 +1,000,000,000,000 之间的所有整数，100,000,000,000 个随机删除的值除外
    *   输入集是 100,000,000,000 个在同一范围内随机生成的整数
*   单元测试2：

    *   基集是斐波那契数列
    *   输入集是 0..infinity 范围内的 1T 个随机生成的整数

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T20:49:59.123

还有[boost::dynamic_bitset](http://www.boost.org/doc/libs/1_37_0/libs/dynamic_bitset/dynamic_bitset.html)，不确定它如何随时间缩放，或在空间中相对于原始数字的分布。（例如，如果位存储在 8/16/32/64 的块中，则稀疏位集效率低下）

或者也许[这个（压缩位集）](http://code.google.com/p/compressedbitset/)或[这个（位向量）](http://bmagic.sourceforge.net/memsave.html)网页（我搜索了“大型稀疏位集”和“压缩位集”）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T19:46:38.707

[之前关于字典/拼写检查](https://stackoverflow.com/questions/405433/)的问题有许多提到[Bloom 过滤器](http://en.wikipedia.org/wiki/Bloom_filter)的回答；也许这会有所帮助。

我认为无论如何测试大型集都会很昂贵。

# python - Python 的通用优先级队列

> ID：407734
> 
> 赞同：59
> 
> 时间：2009-01-02T19:05:54.653
> 
> 标签：python, queue

我需要在我的 Python 代码中使用优先级队列，并且：

*   我正在寻找优先级队列的任何**快速**实现
*   最佳情况下，我希望队列是**通用**的（即适用于具有指定比较运算符的任何对象）。

环顾四周寻找有效的东西，我遇到了[heapq](http://docs.python.org/library/heapq.html)，但是：

*   我正在寻找比 更快的东西`heapq`，它是在本机 Python 中实现的，所以它并不快。
*   它看起来不错，但似乎只为整数指定。我想它适用于任何具有比较运算符的对象，但它没有指定它需要什么比较运算符。
*   更新：重新比较`heapq`，我可以`(priority, object)`按照查理马丁的建议使用 a ，或者只是`__cmp__`为我的对象实现。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-02T19:11:31.367

您可以使用[Queue.PriorityQueue](http://docs.python.org/library/queue.html#Queue.PriorityQueue)。

回想一下，Python 不是强类型的，所以你可以保存任何你喜欢的东西：只需创建一个元组就可以了`(priority, thing)`。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2016-05-03T15:18:23.523

在使用优先级队列的时候，reduce-key是很多算法（Dijkstra's Algorithm, A*, OPTICS）的必备操作，不知道为什么Python内置的优先级队列不支持。其他答案都没有提供支持此功能的解决方案。

Daniel Stutzbach的[这个](https://github.com/DanielStutzbach/heapdict)实现也支持减少键操作的优先级队列在 Python 3.5 中非常适合我。

```
from heapdict import heapdict

hd = heapdict()
hd["two"] = 2
hd["one"] = 1
obj = hd.popitem()
print("object:",obj[0])
print("priority:",obj[1])

# object: one
# priority: 1 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-01-02T20:19:36.113

我最终实现了一个包装器`heapq`，添加了一个字典来保持队列元素的唯一性。结果应该对所有运算符都非常有效：

```
class PriorityQueueSet(object):

    """
    Combined priority queue and set data structure.

    Acts like a priority queue, except that its items are guaranteed to be
    unique. Provides O(1) membership test, O(log N) insertion and O(log N)
    removal of the smallest item.

    Important: the items of this data structure must be both comparable and
    hashable (i.e. must implement __cmp__ and __hash__). This is true of
    Python's built-in objects, but you should implement those methods if you
    want to use the data structure for custom objects.
    """

    def __init__(self, items=[]):
        """
        Create a new PriorityQueueSet.

        Arguments:
            items (list): An initial item list - it can be unsorted and
                non-unique. The data structure will be created in O(N).
        """
        self.set = dict((item, True) for item in items)
        self.heap = self.set.keys()
        heapq.heapify(self.heap)

    def has_item(self, item):
        """Check if ``item`` exists in the queue."""
        return item in self.set

    def pop_smallest(self):
        """Remove and return the smallest item from the queue."""
        smallest = heapq.heappop(self.heap)
        del self.set[smallest]
        return smallest

    def add(self, item):
        """Add ``item`` to the queue if doesn't already exist."""
        if item not in self.set:
            self.set[item] = True
            heapq.heappush(self.heap, item) 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-10-12T07:11:32.850

您可以将 heapq 用于非整数元素（元组）：

```
import heapq

heap = []
data = [(10,"ten"), (3,"three"), (5,"five"), (7,"seven"), (9, "nine"), (2,"two")]
for item in data:
    heapq.heappush(heap, item)
sorted_data = []
while heap:
    sorted_data.append(heapq.heappop(heap))
print(sorted_data)
data.sort()
print(data == sorted_data) 
```

这将比`queue.PriorityQueue`最佳答案中推荐的选项快得多，并且与 不同的是，如果您尝试从空堆中弹出`queue.PriorityQueue`，则不会永远挂起。`heapq`

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-02T19:57:30.650

我没用过，但你可以试试[PyHeap](http://hkn.eecs.berkeley.edu/~dyoo/python/)。它是用 C 编写的，所以希望它对你来说足够快。

你肯定 heapq/PriorityQueue 不够快吗？可能值得从其中一个开始，然后进行分析以查看它是否真的是您的性能瓶颈。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-02T19:13:33.967

您是否查看了 heapq 页面上的[“显示源代码”链接？](http://docs.python.org/_sources/library/heapq.txt)有一个使用带有 (int, char) 元组列表的堆作为优先级队列的示例。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-12-14T15:33:52.410

我正在使用这样`priority queue`的python 3实现a-[`queue.PriorityQueue`](https://docs.python.org/3/library/queue.html)

```
from queue import PriorityQueue

class PqElement(object):
    def __init__(self, value: int):
        self.val = value

    #Custom Compare Function (less than or equsal)
    def __lt__(self, other):
        """self < obj."""
        return self.val > other.val

    #Print each element function
    def __repr__(self):
        return f'PQE:{self.val}'

#Usage-
pq = PriorityQueue()
pq.put(PqElement(v))       #Add Item      - O(Log(n))
topValue = pq.get()        #Pop top item  - O(1)
topValue = pq.queue[0].val #Get top value - O(1) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-04-01T19:57:11.263

这很有效，也适用于字符串或任何类型的输入-:)

```
import itertools
from heapq import heappush, heappop

pq = []                         # list of entries arranged in a heap
entry_finder = {}               # mapping of tasks to entries
REMOVED = '<removed-task>'      # placeholder for a removed task
counter = itertools.count()     # unique sequence count

def add_task(task, priority=0):
    'Add a new task or update the priority of an existing task'
    if task in entry_finder:
        remove_task(task)
    count = next(counter)
    entry = [priority, count, task]
    entry_finder[task] = entry
    heappush(pq, entry)

def remove_task(task):
    'Mark an existing task as REMOVED.  Raise KeyError if not found.'
    entry = entry_finder.pop(task)
    entry[-1] = REMOVED

def pop_task():
    'Remove and return the lowest priority task. Raise KeyError if empty.'
    while pq:
        priority, count, task = heappop(pq)
        if task is not REMOVED:
            del entry_finder[task]
            return task
    raise KeyError('pop from an empty priority queue') 
```

**参考：** [http ://docs.python.org/library/heapq.html](http://docs.python.org/library/heapq.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-11-06T18:01:32.220

我在[https://pypi.python.org/pypi/fibonacci-heap-mod有一个优先级队列/斐波那契堆](https://pypi.python.org/pypi/fibonacci-heap-mod)

它并不快（delete-min 上的大常数 c，即 O(c*logn)）。但是 find-min、insert、reduce-key 和 merge 都是 O(1) - IOW，它很懒。

如果在 CPython 上太慢，您可以尝试 Pypy、Nuitka 甚至 CPython+Numba :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-01-18T20:57:50.090

> 我可以`(priority, object)`按照查理马丁的建议使用 a ，或者只是`__cmp__`为我的对象实现。

如果您希望根据特定规则对插入的对象进行优先级排序，我发现编写一个`PriorityQueue`接受键函数的简单子类非常有帮助。您不必`(priority, object)`手动插入元组，并且处理感觉更自然。

**所需行为的演示**：

```
>>> h = KeyHeap(sum)
>>> h.put([-1,1])
>>> h.put((-1,-2,-3))
>>> h.put({100})
>>> h.put([1,2,3])
>>> h.get()
(-1, -2, -3)
>>> h.get()
[-1, 1]
>>> h.get()
[1, 2, 3]
>>> h.get()
set([100])
>>> h.empty()
True
>>>
>>> k = KeyHeap(len)
>>> k.put('hello')
>>> k.put('stackoverflow')
>>> k.put('!')
>>> k.get()
'!'
>>> k.get()
'hello'
>>> k.get()
'stackoverflow' 
```

**Python 2 代码**

```
from Queue import PriorityQueue

class KeyHeap(PriorityQueue):
    def __init__(self, key, maxsize=0):            
        PriorityQueue.__init__(self, maxsize)
        self.key = key

    def put(self, x):
        PriorityQueue.put(self, (self.key(x), x))

    def get(self):
        return PriorityQueue.get(self)[1] 
```

**Python 3 代码**

```
from queue import PriorityQueue

class KeyHeap(PriorityQueue):
    def __init__(self, key, maxsize=0):            
        super().__init__(maxsize)
        self.key = key

    def put(self, x):
        super().put((self.key(x), x))

    def get(self):
        return super().get()[1] 
```

显然，`put`如果您尝试插入您的键功能无法处理的对象，调用将（并且应该！）引发错误。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-09-27T00:58:48.757

如果您想保持整个列表有序，而不仅仅是最高值，我在多个项目中使用了此代码的一些变体，它是`list`用类似 api 替换标准类的一个下降：

```
import bisect

class OrderedList(list):
    """Keep a list sorted as you append or extend it

    An ordered list, this sorts items from smallest to largest using key, so
    if you want MaxQueue like functionality use negative values: .pop(-1) and
    if you want MinQueue like functionality use positive values: .pop(0)
    """
    def __init__(self, iterable=None, key=None):
        if key:
            self.key = key
        self._keys = []
        super(OrderedList, self).__init__()
        if iterable:
            for x in iterable:
                self.append(x)

    def key(self, x):
        return x

    def append(self, x):
        k = self.key(x)
        # https://docs.python.org/3/library/bisect.html#bisect.bisect_right
        i = bisect.bisect_right(self._keys, k)
        if i is None:
            super(OrderedList, self).append((self.key(x), x))
            self._keys.append(k)
        else:
            super(OrderedList, self).insert(i, (self.key(x), x))
            self._keys.insert(i, k)

    def extend(self, iterable):
        for x in iterable:
            self.append(x)

    def remove(self, x):
        k = self.key(x)
        self._keys.remove(k)
        super(OrderedList, self).remove((k, x))

    def pop(self, i=-1):
        self._keys.pop(i)
        return super(OrderedList, self).pop(i)[-1]

    def clear(self):
        super(OrderedList, self).clear()
        self._keys.clear()

    def __iter__(self):
        for x in super(OrderedList, self).__iter__():
            yield x[-1]

    def __getitem__(self, i):
        return super(OrderedList, self).__getitem__(i)[-1]

    def insert(self, i, x):
        raise NotImplementedError()
    def __setitem__(self, x):
        raise NotImplementedError()
    def reverse(self):
        raise NotImplementedError()
    def sort(self):
        raise NotImplementedError() 
```

它可以像`(priority, value)`默认一样处理元组，但您也可以像这样自定义它：

```
class Val(object):
    def __init__(self, priority, val):
        self.priority = priority
        self.val = val

h = OrderedList(key=lambda x: x.priority)

h.append(Val(100, "foo"))
h.append(Val(10, "bar"))
h.append(Val(200, "che"))

print(h[0].val) # "bar"
print(h[-1].val) # "che" 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-05-08T17:25:57.157

如果您只有一个“更高优先级”级别而不是 支持的任意多个[`queue.PriorityQueue`](https://docs.python.org/3/library/queue.html#queue.PriorityQueue)，您可以[`collections.deque`](https://docs.python.org/3/library/collections.html#collections.deque)通过在左侧插入正常作业并在右侧`.appendleft()`插入更高优先级的条目来有效地使用 a`.append()`

queue 和 deque 实例都有线程安全的 push/pop 方法

双端队列的其他优势

*   允许查看任意元素（可索引和可​​迭代而不会弹出，而队列实例只能弹出）
*   明显快于`queue.PriorityQueue`（见下面的粗略测试）

关于长度限制的注意事项

*   设置长度将让它*从任一端推出元素*，而不仅仅是从左边推出，这与阻塞或引发的队列实例不同`queue.Full`
*   如果输入速率超过消耗，任何无限集合最终都会使您的系统内存不足

```
import threading
from collections import deque as Deque

Q = Deque()  # don't set a maximum length

def worker_queue_creator(q):
    sleepE = threading.Event()  # use wait method for sleeping thread
    sleepE.wait(timeout=1)

    for index in range(3):  # start with a few jobs
        Q.appendleft("low job {}".format(index))

    Q.append("high job 1")  # add an important job

    for index in range(3, 3+3):  # add a few more jobs
        Q.appendleft("low job {}".format(index))

    # one more important job before ending worker
    sleepE.wait(timeout=2)
    Q.append("high job 2")

    # wait while the consumer worker processes these before exiting
    sleepE.wait(timeout=5)

def worker_queue_consumer(q):
    """ daemon thread which consumes queue forever """
    sleepE = threading.Event()  # use wait method for sleeping thread
    sleepE.wait(timeout=1)  # wait a moment to mock startup
    while True:
        try:
            pre_q_str = str(q)  # see what the Deque looks like before before pop
            job = q.pop()
        except IndexError:  # Deque is empty
            pass            # keep trying forever
        else:  # successfully popped job
            print("{}: {}".format(job, pre_q_str))
        sleepE.wait(timeout=0.4)  # quickly consume jobs

# create threads to consume and display the queue
T = [
    threading.Thread(target=worker_queue_creator, args=(Q,)),
    threading.Thread(target=worker_queue_consumer, args=(Q,), daemon=True),
]

for t in T:
    t.start()

T[0].join()  # wait on sleep in worker_queue_creator to quit 
```

```
% python3 deque_as_priorityqueue.py
high job 1: deque(['low job 5', 'low job 4', 'low job 3', 'low job 2', 'low job 1', 'low job 0', 'high job 1'])
low job 0: deque(['low job 5', 'low job 4', 'low job 3', 'low job 2', 'low job 1', 'low job 0'])
low job 1: deque(['low job 5', 'low job 4', 'low job 3', 'low job 2', 'low job 1'])
low job 2: deque(['low job 5', 'low job 4', 'low job 3', 'low job 2'])
low job 3: deque(['low job 5', 'low job 4', 'low job 3'])
high job 2: deque(['low job 5', 'low job 4', 'high job 2'])
low job 4: deque(['low job 5', 'low job 4'])
low job 5: deque(['low job 5']) 
```

比较

```
import timeit

NUMBER = 1000

values_builder = """
low_priority_values  = [(1, "low-{}".format(index)) for index in range(5000)]
high_priority_values = [(0, "high-{}".format(index)) for index in range(1000)]
"""

deque_setup = """
from collections import deque as Deque
Q = Deque()
"""
deque_logic_input = """
for item in low_priority_values:
    Q.appendleft(item[1])  # index into tuples to remove priority
for item in high_priority_values:
    Q.append(item[1])
"""
deque_logic_output = """
while True:
    try:
        v = Q.pop()
    except IndexError:
        break
"""

queue_setup = """
from queue import PriorityQueue
from queue import Empty
Q = PriorityQueue()
"""
queue_logic_input = """
for item in low_priority_values:
    Q.put(item)
for item in high_priority_values:
    Q.put(item)
"""

queue_logic_output = """
while True:
    try:
        v = Q.get_nowait()
    except Empty:
        break
"""

# abuse string catenation to build the setup blocks
results_dict = {
    "deque input":  timeit.timeit(deque_logic_input, setup=deque_setup+values_builder, number=NUMBER),
    "queue input":  timeit.timeit(queue_logic_input, setup=queue_setup+values_builder, number=NUMBER),
    "deque output": timeit.timeit(deque_logic_output, setup=deque_setup+values_builder+deque_logic_input, number=NUMBER),
    "queue output": timeit.timeit(queue_logic_output, setup=queue_setup+values_builder+queue_logic_input, number=NUMBER),
}

for k, v in results_dict.items():
    print("{}: {}".format(k, v)) 
```

结果（推送和弹出 6000 个元素，timeit `number=1000`）

```
% python3 deque_priorityqueue_compare.py
deque input: 0.853059
queue input: 24.504084000000002
deque output: 0.0013576999999997952
queue output: 0.02025689999999969 
```

虽然这是一个展示 deque 性能的虚构示例，但`PriorityQueue`' 的插入时间是[其长度的重要函数，`O(log n)`甚至更糟](https://en.wikipedia.org/wiki/Priority_queue)，而[Deque 是`O(1)`](https://docs.python.org/3/library/collections.html#collections.deque)，因此它应该相当代表真实用例

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-11-26T03:57:33.433

一个简单的工具：

因为`PriorityQueue`首先较低。

```
from queue import PriorityQueue

class PriorityQueueWithKey(PriorityQueue):
    def __init__(self, key=None, maxsize=0):
        super().__init__(maxsize)
        self.key = key

    def put(self, item):
        if self.key is None:
            super().put((item, item))
        else:
            super().put((self.key(item), item))

    def get(self):
        return super().get(self.queue)[1]

a = PriorityQueueWithKey(abs)
a.put(-4)
a.put(-3)
print(*a.queue) 
```

# hibernate - 休眠条件 - 在 n:m 关系中查询表

> ID：407737
> 
> 赞同：0
> 
> 时间：2009-01-02T19:06:29.333
> 
> 标签：hibernate, many-to-many, criteria

我正在尝试为以下场景构建一个带有休眠条件的查询：

*   两个实体：指标和报告（每个都有自己的表格、类等）
*   一个指标可用于零到多个报告
*   报告使用零到多个指标
*   因此，我有一个交集表来存储关系
*   关系在两个类及其休眠映射中定义
*   在 UI 中，用户可以选择一个或多个报告（除其他外），我想在数据库中查询这些报告中使用的指标

我尝试了以下方法：

```
criteria.add(Restrictions.in("Reports", selectedReports)); 
```

但我得到的只是一个奇怪的 SQL 语句

```
where this_.Indicator_ID in (?) 
```

然后是 JDBC 异常（缺少参数）

有任何想法吗？谢谢。

注意：我已经研究了[Querying ManyToManyrelationship with Hibernate Criteria](https://stackoverflow.com/questions/264339/querying-manytomany-relationship-with-hibernate-criteria)，但接受的解决方案是构建自定义 sql-string ...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:21:19.660

```
 Criteria c = session.createCriteria(Indicator.class);
    c.add(Restrictions.eq("someField", myObject).createCriteria("reports")
    .add(Restrictions.eq("reportName", name);
    c.list(); 
```

您需要为保存在某个其他实体的集合中的实体创建一个子标准。

```
String[] selectedReportsId = {"1", "2", "3"};
 c.add(Restrictions.eq("someField",myObject).createCriteria("reports")
    .add(Restrictions.in("id", selectedReportsId); 
```

然后从这里查看有关转换结果的信息： [https ://docs.jboss.org/hibernate/orm/3.3/reference/en-US/html/querycriteria.html#querycriteria-associations](https://docs.jboss.org/hibernate/orm/3.3/reference/en-US/html/querycriteria.html#querycriteria-associations)

这也可以说明您可以使用标准做什么： [http ://www.hibernate.org/hib_docs/v3/api/org/hibernate/criterion/Restrictions.html](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/criterion/Restrictions.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T19:50:39.463

如果您必须这样做，以下是 Google 在搜索“hibernate hql 多对多”后返回的一些建议：

[http://patf.net/blogs/index.php?blog=2&c=1&more=1&pb=1&tb=1&title=many_to_many_in_hql](http://patf.net/blogs/index.php?blog=2&c=1&more=1&pb=1&tb=1&title=many_to_many_in_hql)

来自 Hibernate 论坛：

[http://forum.hibernate.org/viewtopic.php?p=2340747&sid=d4c8d2fcc16aed0201f73eb74619692a](http://forum.hibernate.org/viewtopic.php?p=2340747&sid=d4c8d2fcc16aed0201f73eb74619692a)

来自 Spring 论坛：

[http://forum.springframework.org/showthread.php?t=36870](http://forum.springframework.org/showthread.php?t=36870)

希望这些帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T21:01:46.153

现在，这就是我让它工作的方式（感谢 zmf）。

```
Criteria subcrit = criteria.createCriteria("Reports");
Disjunction dis = Restrictions.disjunction();
for (Reports r : selectedReports) {
    dis.add(Restrictions.idEq(r.getID()));
}
subcrit.add(dis); 
```

这几乎正​​是 zmf 所建议的，我添加的只是从传递的集合中构建标准的析取。

剩下要做的就是尝试直接使用该集合...

# .net - 实用程序库中包含的内容

> ID：407739
> 
> 赞同：4
> 
> 时间：2009-01-02T19:06:59.457
> 
> 标签：.net, code-reuse, utilities, common-tasks

随着我的项目越来越多，我发现我经常从一个项目到另一个项目，从一个客户到另一个客户重复许多常见的任务。所以我开始组装一个“实用程序”库，一个项目之间经常重复的这些常见元素的集合。

到目前为止，我拥有调整图像大小、将数据网格导出到 Excel、发送电子邮件和替换标记化消息的实用程序。

如果您正在构建/使用 .NET 实用程序类库，您会认为哪些类型的进程有帮助？您会设想哪些名称空间/组？

**更新**

我说的是一个实际的类库，它被分成命名空间来对公共元素进行分组。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T19:12:41.597

1.  我不会写一个名为“Common”或“Utilities”或“Misc”的库，或者......你明白了。相反，我有一个名为“Lib”的目录，并将每个功能区域放在一个单独的库中。例如，对于 C++ 项目，我可能有 Lib/Trace、Lib/UI、Lib/Net、Lib/Web。对于 C#，我有 Lib/Acme.Trace、Lib/Acme.Windows.Forms、Lib/Acme.Net 等（假设您的顶级命名空间/公司称为“Acme”）。
2.  雅尼。不要去编写你*可能*需要的代码。
3.  在您在两个或更多项目中使用它们之前，不要将它们放入共享库中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T19:09:27.627

就个人而言，我会将其中一些功能放入单独的库中，因为“实用程序”是一个相当主观的术语，一个人认为有用的东西对其他人没有那么有帮助。

如果在库中将其分解为描述性命名空间，那么我会说这样会*更好*（例如，调整图像大小将位于某种 .Drawing 命名空间或 .Drawing.dll 中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T19:15:52.090

我的类库中有很多东西可以在项目之间共享：

*   IoC 容器和依赖注入框架
*   一个完整的控制器/观察者框架，允许我将 UI 代码与 backlogic 代码分开
*   一组合理的、独立于数据库的用于执行 SQL 的类，负责处理一些语法差异，主要是函数名
*   许多其他用于处理数据的辅助类和实用方法
*   一些标准化的内部存储类，如`Tuple<..>`等。
*   一些自定义集合，如`Set<T>`, `Heap<T>`，以及大量用于处理各种类型集合的实用方法

当我需要更多东西时，会添加类库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T19:57:26.780

我建议不要使用“实用程序”库，而是制作特定于域的（图形、身份验证、验证等）库，并且只在需要的地方包含它们。关键当然是决定具体到什么程度。更多的特异性通常更好。

不管它是否没有域，那么您可能并不完全理解它，这意味着您应该重新评估您正在做的事情并首先尝试完成。

另外，请记住，在一两个项目中有用的东西最终可能只在一两个项目中有用。添加不必要的类只会导致后续的维护问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T19:13:48.100

虽然我自己只是一个初出茅庐的开发人员，但我发现 RegEx 函数和 SQL 过滤器非常有用。我还拥有 MSSQL 的合并复制功能，到目前为止对我来说非常方便。

# eclipse - 保证 Eclipse 插件启动顺序

> ID：407752
> 
> 赞同：2
> 
> 时间：2009-01-02T19:10:50.900
> 
> 标签：eclipse, plugins, startup

有人知道保证插件启动顺序的方法吗？我有一个要开发的插件，它将向我无法修改的第 3 方插件提供运行时配置信息。

所以，我想确保我的插件总是在第 3 方之前***运行完成。***

Eclipse 3.3，顺便说一句。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T20:11:50.747

OSGi 的方法是在 config.ini 中使用启动级别。但是对于 Eclipse 插件，它们通常不会在此处列出，而是由配置器包自动配置。

老实说，你真的不应该这样做。通常，OSGi 包（即 Eclipse 插件）应该能够以任何顺序启动。使用服务注册表在您需要的任何内容可用时立即获取它们的句柄。

另一种看待它的方式：是什么导致 3rd-party 插件加载（因为 Eclipse 倾向于延迟加载插件）？也许您可以使用相同的机制。

如果您感到绝望，您可以强迫自己开始使用[Eclipse 启动扩展点](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/extension-points/org_eclipse_ui_startup.html "Eclipse 启动扩展点")。请记住，a）这是核选项，b）用户在 Preferences 下有 UI 来关闭您的启动扩展，c）您无法控制启动扩展点的顺序，所以如果您的 3rd-party 插件也使用它，你是 SOL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T20:00:35.230

检查启动级别或启动级别服务。尽管在 Eclipse 中使用它似乎不是很简单。

# c# - 数据库中的国际化

> ID：407756
> 
> 赞同：5
> 
> 时间：2009-01-02T19:12:36.747
> 
> 标签：c#, sql-server, internationalization

你们认为国际化应该只在代码级别完成还是应该在数据库中完成。

是否有任何设计模式或公认的数据库国际化实践？

如果您认为这是一个代码问题，那么您是否只是使用资源文件来查找从数据库返回的密钥？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:15:37.973

只要您的列能够保存数据，国际化就会扩展到数据库。NText、NChar、NVarchar 代替 Text、Char、Varchar。

就您的 UI 而言，对于不变的标签，资源文件是一种很好的使用方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T19:32:11.387

如果您指的是让您的应用程序在 UI 级别支持多种语言，那么还有更多可能性。如果标签永远不会改变，除非您发布新版本，那么嵌入可执行文件或程序集本身的资源文件是您最好的选择，因为它们工作得更快。另一方面，如果您的标签需要用户在运行时进行调整，那么将翻译存储在数据库中是一个不错的选择。至于代码本身，数据库中的表和字段的名称，我们尽可能保持英文，因为英文是 IT 人员“事实上的”标准。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T19:19:09.527

这取决于您在数据库中存储的很多内容。以我最近参与的一个项目为例，在客户站点输入且仅对该客户可见的电影标题是公平的游戏，可以按原样存储在数据库中。另一方面，由于客户端以及可能位于不同国家/地区的网络运营中心都可以查看投影仪错误代码，因此应将其存储为错误代码（以及支持数据，如灯泡使用时间和正在放映的电影的标题），可以根据观众的语言设置在 gui 级别进行翻译。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T19:34:34.363

[@hova](https://stackoverflow.com/questions/407756/internationalization-in-the-database#407767)涵盖了技术细节，但您可能需要考虑支持显示您不懂的语言的系统。

解决此问题的一种方法是将英语作为默认语言，以及切换到不同语言的用户设置。这样，您的支持用户可以以自然的方式登录并查看系统（假设英语是他们的第一语言），而您的实际用户可以使用他们的第一语言查看系统。IMO，数据应该始终是“自然的”——用用户的语言。

这提出了另一个有趣的观点——您的系统是否应该允许多种语言进行跨境安装？以我的经验，对于用户界面，是的，但对于数据，不是。举一个简单的地址格式示例，从瑞士系统发给法国第三方的信件仍应使用瑞士格式地址，而不是法国地址，因为它必须首先通过瑞士邮政系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T19:44:26.650

如果您的客户是日本人，并且希望以汉字和片假名（有时在最正式的外字中）看到他们的名字，您必须将它们存储为 Unicode。没办法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T19:45:07.400

即使是地址之类的东西在美国和日本之间也有很大不同。一种模式不会同时适用于两者。

# c# - C#：显示“frmMainForm”设置和处理表单的正确方法是什么？

> ID：407763
> 
> 赞同：0
> 
> 时间：2009-01-02T19:13:59.130
> 
> 标签：c#

背景：有两种形式，一种是主应用程序形式，另一种是用于编辑主应用程序操作的各种设置的形式。

在实际的 frmSettings 表单中单击“确定”或“取消”后，显示 frmSettings 表单的正确方法是什么以及如何处理它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T19:25:53.320

也许对话框更适合您的设置“表单”。对话框和使对话框更易于处理的表单之间存在细微差别。指示单击的按钮的返回代码使对话框很有用。

假设您使用了一个对话框 - 可以使用 using 语句（在我的脑海中）：

```
 using (DialogSettings dlgSettings = new DialogSettings)
{
  if (dlgSettings.ShowDialog() == DialogResult.OK)
  {

}
} 
```

如果您坚持使用表格，那么您将不得不

*   实例化表单
*   显示表格
*   记录是否单击了确定或取消到表单级别变量（从表单确定/取消按钮单击代码中）
*   隐藏表格
*   保存表单中的记录值
*   处理表格
*   使用保存的 ok/cancel 值

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T20:00:51.143

仅供参考，使用“frm”不是 C# 编码指南的推荐部分。[Microsoft 不希望您在 .NET 中使用匈牙利符号。](http://blogs.msdn.com/brada/articles/361363.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T19:23:10.953

```
using (frmSettings s = new frmSettings() )
{
   if( s.ShowDialog() == DialogResult.OK )
   {
       //do work
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T19:24:22.883

在主应用程序中声明一个实例并显示它。

```
using(frmSettings settingsInstance = new frmSettings())
{
    settingsInstance.Show();  //or ShowDialog()
} 
```

然后在完成后关闭表单...

# vb.net - 在 VB.Net 中动态调用方法

> ID：407769
> 
> 赞同：1
> 
> 时间：2009-01-02T19:16:45.850
> 
> 标签：vb.net, reflection, dynamic, sapb1

我在 dll 文件中定义了一些类。这些都是com api的形式。

我正在尝试动态创建一个类的对象，而不是设置该对象的某些属性。

当我手动设置属性时，它可以工作，但是当我尝试使用反射调用相同的属性时，它会给出错误

对象与目标类型不匹配。

以下是我的代码

```
Private Sub SetObjectValue(ByVal SelectedObject As SAPbobsCOM.BoObjectTypes, ByVal ClassName As String, ByVal FieldName As String, ByVal SetValue As String, ByVal KeyValue As String)
    Dim oObject As Object

    Dim myAssembly As Reflection.Assembly = Reflection.Assembly.LoadFrom("interop.sapbobscom.dll")
    Dim myType As Type = myAssembly.GetType(ClassName)

    Dim myMember() As MemberInfo = myType.GetMember(FieldName)
    Dim myProperty As PropertyInfo = CType(myMember(0), PropertyInfo)
    Dim myMethod As MethodInfo = myProperty.GetSetMethod

   oObject = oCompany.GetBusinessObject(SelectedObject)

    oObject.GetByKey(KeyValue)

    myProperty.SetValue(oObject, CDbl(SetValue), Nothing)
End Sub 
```

调用 SetValue 方法时会出现错误。相反，如果我像下面这样使用它，它可以正常工作：

```
oObject.CreditLimit = 129
oObject.Update 
```

其中 CreditLimit 是给定类的属性，而 update 是我必须在设置值后调用的方法，以便更新基础数据库中的值。

类似地，GetByKey 用于从底层数据库中检索对象的值，其中必须传递主键字段的值。

由于有多个类，每个类都有很多不同的属性，因此动态调用它们会有很大帮助。

谢谢拉胡尔耆那教

刚刚尝试做 casper 在这里建议的事情。它给出了一个错误消息 - 找不到成员。（来自 HRESULT 的异常：0x80020003 (DISP_E_MEMBERNOTFOUND)）

拉胡尔

> 完成。我使用 vbLet 而不是 vbSet，它成功完成。
> 
> 谢谢拉胡尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T19:34:46.890

我有点好奇你为什么要这样做，因为 VB 会为你做这一切。您只需声明为类型对象然后进行调用，或者您是否使用了一个选项（我相信它是严格的？）阻止您让编译器为后期绑定调用发出反射代码？

如果你需要一个参数，你应该也可以使用 CallByName ：

```
Private Sub SetObjectValue(ByVal SelectedObject As SAPbobsCOM.BoObjectTypes, ByVal ClassName As String, ByVal FieldName As String, ByVal SetValue As String, ByVal KeyValue As String)
    Dim oObject As Object
   oObject = oCompany.GetBusinessObject(SelectedObject)

    oObject.GetByKey(KeyValue)

    CallByName(oObject, FieldName, vbSet, CDbl(SetValue))
End Sub 
```

# asp.net-mvc - 将 ASP.NET MVC 视图上的单个按钮映射到控制器操作

> ID：407770
> 
> 赞同：9
> 
> 时间：2009-01-02T19:17:16.067
> 
> 标签：asp.net-mvc

我有一个应用程序，我需要用户能够从数据库中更新或删除数据行。这些行使用我视图的 .aspx 文件中的 foreach 循环显示给用户。每行将有两个文本字段（txtName、txtDesc）、一个更新按钮和一个删除按钮。我不确定的是，如何让更新按钮将消息发送到控制器以更新哪一行？我可以看到这样做的几种方法：

1.  将每一行放在它自己的表单标签中，然后当点击更新按钮时，它将只提交该行的值（也会有一个带有 rowId 的隐藏字段）并且控制器类会将所有帖子值作为参数到控制器上的 Update 方法。
2.  不知何故，让按钮以某种方式编写脚本，以仅将带有 POST 的该行的值发送回控制器。

有没有办法做到这一点？我担心的一件事是，如果每一行都有不同的名称来分配由 ASP.NET 分配的控件（txtName1、txtDesc1、txtName2、txtDesc2），那么它们的值将如何映射到 Controller 方法的正确参数？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-02T20:59:35.517

您可以使用多个表单，并将表单上的操作设置为如下所示：

```
<form method="post" action="/YourController/YourAction/<%=rowId%>"> 
```

因此，您将拥有`YourController/YourAction/1`，`YourController/YourAction/2`依此类推。

无需为不同的文本框赋予不同的名称，只需将它们称为 txtName、txtDesc 等（或者更好的是，去掉那些 txt 前缀）。由于它们的形式不同，它们不会混淆。

然后在动作上你做类似的事情

```
public ActionResult YourAction(int id, string username, string description) 
```

其中用户名、描述与您在表单控件上使用的名称相同（因此它们会自动映射）。id 参数将自动映射到您在表单操作中输入的数字。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-29T20:18:34.493

您还可以在表单上有多个“有效命名”按钮，例如：

```
<input type="submit" value="Save" name="btnSave" id="btnSave"/>
<input type="submit" value="Delete" name="btnDelete" id="btnDelete" / 
```

然后查看您收到的提交内容。每个表单只能发送一个提交操作，因此就像所有其他提交按钮实际上并不存在一样：

```
if ( HttpContext.Request.Form["btnDelete"] != null ) {
    //Delete stuff
} elseif ( HttpContext.Request.Form["btnSave"] != null ) {
    //Update stuff
} 
```

我还认为您可以像这里[http://weblogs.asp.net/dfindley/archive/2009/05/31/asp-net-mvc-multiple-buttons-in-the-same-form 一样实现自定义 ActionMethodSelectorAttribute。 aspx](http://weblogs.asp.net/dfindley/archive/2009/05/31/asp-net-mvc-multiple-buttons-in-the-same-form.aspx)（也在上面列出）具有更清晰的分隔代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T10:07:41.260

正如 rodbv 所说，您想使用单独的`<form>`元素。

当您使用 Asp.Net MVC 或经典 html（php、经典 asp 等）时，您必须忘记 Asp.Net 处理按钮按下的方式。当表单被发送回网络服务器时，服务器所知道的只是“表单已发送，并包含以下输入元素”。

Asp.net（标准）使用 javascript 为许多标准 html 回发操作添加了一个包装器（__doPostback javascript 函数几乎在所有地方都使用），这添加了有关表单的哪个输入元素导致回发并将其传递到服务器的信息一个隐藏的表单变量。如果您真的愿意，您可以模仿这种行为，但我建议您不要这样做。

在一个页面上“乱扔”许多 's 可能看起来很奇怪`<form>`，但这意味着回发到服务器的重量会更轻，并且应该让用户的一切运行得更快一点。

# xss - 允许在表单输入中使用代码片段，同时防止 XSS 和 SQL 注入攻击

> ID：407771
> 
> 赞同：3
> 
> 时间：2009-01-02T19:17:16.847
> 
> 标签：xss, sql-injection, code-snippets

如何在防止 XSS、SQL 注入和相关攻击的同时允许将代码片段输入到 FCKeditor 或任何其他编辑器之类的编辑器中（就像 stackoverflow 一样）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T20:16:37.570

这里的部分问题是您希望允许某些类型的 HTML，对吗？以链接为例。但是您只需要清理那些可能包含 XSS 攻击的 HTML 标记，例如脚本标记，甚至事件处理程序属性或 href 或其他以“javascript:”开头的属性。因此，您的问题的完整答案需要比“替换特殊字符”更复杂，因为这不允许链接。

防止 SQL 注入可能在某种程度上取决于您的平台选择。我首选的 Web 平台具有用于参数化查询的内置语法，这将主要防止 SQL 注入（称为 cfqueryparam）。如果您使用 PHP 和 MySQL，则有一个类似的本机 mysql_escape() 函数。（我不确定 PHP 函数在技术上会创建参数化查询，但到目前为止，它在防止 sql 注入尝试方面对我来说效果很好，因为我已经看到一些安全地存储在数据库中。）

在 XSS 保护方面，出于这种原因，我曾经使用正则表达式来清理输入，但后来因为在允许链接等内容同时删除危险代码方面存在困难，因此不再使用该方法。作为替代方案，我转向的是 XSLT。同样，您执行 XSL 转换的方式可能因您的平台而异。不久前，我为 ColdFusion Developer's Journal 写[了一篇](http://br.sys-con.com/node/206288)关于如何执行此操作的文章，其中包括您可以使用的[样板 XSL 表](http://gemsres.com/story/apr06/206288/source.html)，并展示了如何使用原生 XmlTransform() 函数使其与 CF 一起工作。

为此我选择迁移到 XSLT 的原因有两个。

首先验证输入是否是格式良好的 XML，从而消除了使用某些字符串连接技巧进行 XSS 攻击的可能性。

其次，使用 XSL 和 XPath 选择器比使用正则表达式更容易操作 XHTML 数据包，因为与为原始字符串操作设计的正则表达式相比，它们是专门为处理结构化 XML 文档而设计的。所以它更干净，更容易，我犯错误的可能性更小，如果我发现我犯了错误，更容易修复。

此外，当我测试它们时，我发现像 CKEditor（他删除了 F）这样的 WYSIWYG 编辑器保留了格式良好的 XML，因此您不必担心这是一个潜在问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T19:46:47.847

相同的规则适用于保护： **过滤输入，转义输出。**

在输入包含代码的情况下，过滤只是意味着字符串必须包含可打印的字符，并且可能您有长度限制。

将文本存储到数据库中时，要么使用查询参数，要么对字符串进行转义，以确保您没有创建 SQL 注入漏洞的字符。代码可能包含更多的符号和非字母字符，但是关于 SQL 注入，您必须注意的那些与普通文本相同。

不要试图复制正确的转义函数。大多数数据库库已经包含一个函数，该函数对所有需要转义的字符进行正确的转义（例如，这可能是特定于数据库的）。它还应该处理字符集的特殊问题。只需使用您的库提供的功能。

我不明白为什么人们说“使用存储过程！” 存储过程没有针对 SQL 注入提供特殊保护。如果您将未转义的值插入 SQL 字符串并执行结果，这很容易受到 SQL 注入的攻击。无论您是在应用程序代码中还是在存储过程中执行此操作都没有关系。

输出到 Web 演示文稿时，转义 HTML 特殊字符，就像处理任何文本一样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T19:42:06.483

防止 SQL 注入攻击的最佳方法是确保在进行数据库调用时使用参数化查询或存储过程。通常，我还建议执行一些基本的输入清理，但由于您需要接受用户的代码，这可能不是一个选项。

另一方面（在将用户的输入呈现到浏览器时），对数据进行 HTML 编码将导致任何恶意 JavaScript 等被**呈现**为文字文本，而不是在客户端的浏览器中**执行**。任何体面的 Web 应用服务器框架都应该具备这种能力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T19:45:28.270

我会说可以将所有 < 替换为 < 等（例如，在 PHP 上使用 htmlentities），然后选择带有某种白名单的安全标签。问题是白名单可能有点过于严格。

这是一个PHP示例

```
$code = getTheCodeSnippet();
$code = htmlentities($code);
$code = str_ireplace("&lt;br&gt;", "<br>", $code); //example to whitelist <br> tags
//One could also use Regular expressions for these tags 
```

为防止 SQL 注入，您可以将所有 ' 和 \ 字符替换为“无害的”等价物，如 \' 和 \，以便以下 C 行

```
#include <stdio.h>//'); Some SQL command-- 
```

在数据库中不会有任何负面结果。

# random - 以编程方式选择高对比度的颜色

> ID：407793
> 
> 赞同：28
> 
> 时间：2009-01-02T19:25:56.453
> 
> 标签：random, colors, rgb

这应该是一个简单的问题，但我一直无法找到使其工作的方法。

本质上，我有一个愚蠢的 localhost 页面，用于我的 web 开发。当我在我们的开发服务器和我的本地版本的 C# 代码（通过主机文件从 dev url 重定向）之间浏览时，我知道有时会忘记“dev.foo.com”指向的内容 - 本地或服务器。

所以我创建了一个页面，它将作为我的默认网页的默认页面在本地运行，因此我可以轻松地从服务器识别我的本地主机。

这个页面随机做了很多事情（包括为 D&D 生成角色的起始统计数据），包括设置随机背景颜色。我通过生成 0 到 255 之间的 3 个随机数来实现这一点，并将它们设置为 CSS 中主体背景颜色的 RGB 值。

给定 3 个整数 R、G 和 B，我如何确定 R2、G2 和 B2 以使第二种颜色与第一种颜色具有高对比度？我喜欢让页面有随机的背景颜色（它让我不习惯登陆页面的外观），但我也喜欢能够阅读文本。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-02T19:45:30.673

您需要不同的亮度才能使文本可读，因为色觉本身的分辨率太低。

因此，作为一种算法，我建议以下内容：

*   选择一个随机的背景颜色。

*   然后决定是浅色还是深色。例如，您可以检查三基色的平均值是否大于或等于 128。

*   对于浅色使用黑色文本，对于深白色文本。

**更新：**这是我在玩`split_evenly`Rust crate 示例时制作的示例图像`plotters`。它显示颜色`Palette99`：

[![7x3 彩色字段，其索引为黑色或白色，具体取决于背景的亮度](https://i.stack.imgur.com/tIbFY.png)](https://i.stack.imgur.com/tIbFY.png)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-02T19:35:18.150

“对比度”是一个加载词。如果您只关心能够阅读文本，那么一种简单的方法是在 HSL 等基于亮度的颜色空间中工作，并选择亮度差异很大的前景色和背景色。

HSL 和 RGB 之间的转换是众所周知的——有关详细信息，请参阅 Wikipedia。

如果您谈论的是实际的颜色对比度，它几乎没有那么简单（据我所知，有很多感知因素尚未简化为单一颜色空间），但我怀疑你不需要那种复杂程度。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-31T20:15:49.480

查看这个 PHP 解决方案：Andreas Gohr[用 PHP 计算颜色对比度。](http://www.splitbrain.org/blog/2008-09/18-calculating_color_contrast_with_php)当然，它可以移植到任何语言。

他还对他的对比度分析仪进行了很好的演示，您可以在其中找到一些可以使用的最小对比度级别。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-03-19T11:20:34.167

您可以`GetBrightness()`在`Color`课堂上使用方法。它返回一个从 0.0（黑色亮度）到 1.0（白色）的浮点值。一个简单的解决方案是：

```
var color1 = new Color.FromArgb(r1, g1, b1);
var brightness = color1.GetBrightness();

var color2 = brightness > 0.5 ? Color.Black : Color.White; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-02T19:36:34.687

我在 Palm OS 应用程序中做了类似的事情。这就是我想出的。它不会为您提供“高对比度”颜色，但它会为您提供与文本颜色足够不同的背景颜色，以使其易于阅读：

```
 // Black background is a special case.  It's fairly likely to occur and 
  // the default color shift we do isn't very noticeable with very dark colors.
  if (backColor.r < 0x20 && backColor.g < 0x20 && backColor.b < 0x20)
  {
      textColor.r = backColor.r + 0x20;
      textColor.g = backColor.g + 0x20;
      textColor.b = backColor.b + 0x20;
  }
  else
  {
      textColor.r = backColor.r + ((backColor.r < 128) ? 0x10 : -0x10);
      textColor.g = backColor.g + ((backColor.g < 128) ? 0x10 : -0x10);
      textColor.b = backColor.b + ((backColor.b < 128) ? 0x10 : -0x10);
  } 
```

您可能不需要将黑色作为特殊情况用于您的目的 - Palm 的颜色处理有点时髦（16 位颜色）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-12-15T03:57:52.390

这些答案或多或少建议根据颜色是亮还是暗来使用两种或三种颜色中的一种。

我使用了一些不同的方法，在我的情况下它工作得很好。这是实现。

```
 int color = your_color;
 contrastColor = Color.rgb(255-(color >> 16)&0xFF, 255-(color >> 8)&0xFF, 255- color&0xFF); 
```

它简单而美妙。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-02T19:31:30.297

如果你翻转所有位，你会得到“相反”的颜色，这将是一个很好的对比。

我相信它是 C# 中的 ~ 运算符：

```
R2 = ~R1;
G2 = ~G1;
B2 = ~B1; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-07-15T19:38:47.160

感谢**@starblue**！

这是`C#`我使用的代码

```
 public static string GetContrastBlackOrWhiteColorAsHtmlColorCode(Color c)
        {
            System.Drawing.Color color = System.Drawing.ColorTranslator.FromHtml("transparent");

            try
            {
                if (c.R >= 128 && c.G >= 128 && c.B >= 128)
                {
                    return System.Drawing.ColorTranslator.ToHtml(Color.Black);
                }
                else
                {
                    return System.Drawing.ColorTranslator.ToHtml(Color.White);
                }
            }
            catch (Exception)
            {
            }

            return System.Drawing.ColorTranslator.ToHtml(color);
        } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-12-26T10:42:06.887

为了获得最佳对比度，请使用此代码

```
function lumdiff($R1,$G1,$B1,$R2,$G2,$B2){

    $L1 = 0.2126 * pow($R1/255, 2.2) +
          0.7152 * pow($G1/255, 2.2) +
          0.0722 * pow($B1/255, 2.2);

    $L2 = 0.2126 * pow($R2/255, 2.2) +
          0.7152 * pow($G2/255, 2.2) +
          0.0722 * pow($B2/255, 2.2);

    if($L1 > $L2){
        return ($L1+0.05) / ($L2+0.05);
    }else{
        return ($L2+0.05) / ($L1+0.05);
    }
}

function get_the_contrast($c1, $c2) {
    return (lumdiff(hexdec(substr($c1,0,2)),
        hexdec(substr($c1,2,2)),hexdec(substr($c1,4,2)),
        hexdec(substr($c2,0,2)),hexdec(substr($c2,2,2)),
        hexdec(substr($c2,4,2))));
} 
```

上面的方法（ AVG(red,green,blue) > 128 ）不是很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-14T22:16:31.770

```
private Color GetContrastingColor(Color color)
{
    int r = color.R > 0 ? 256 - color.R : 255;
    int g = color.G > 0 ? 256 - color.G : 255;
    int b = color.B > 0 ? 256 - color.B : 255;
    return System.Drawing.Color.FromArgb(r, g, b);
} 
```

# memory-management - 你什么时候不想使用垃圾收集？

> ID：407798
> 
> 赞同：14
> 
> 时间：2009-01-02T19:27:48.010
> 
> 标签：memory-management, garbage-collection

垃圾收集从 LISP 的早期就已经存在，现在 - 几十年过去了 - 大多数现代编程语言都在使用它。

假设您正在使用其中一种语言，您有什么理由*不*使用垃圾收集，而是以某种方式手动管理内存分配？

你曾经不得不这样做吗？

如果可能，请给出可靠的例子。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-02T19:32:20.437

我能想到几个：

确定性释放/清理

实时系统

不放弃一半的内存或处理器时间 - 取决于算法

更快的内存分配/释放和特定于应用程序的内存分配、释放和管理。基本上是写你自己的内存东西——通常用于性能敏感的应用程序。这可以在应用程序的行为得到很好理解的情况下完成。对于通用 GC（如 Java 和 C#），这是不可能的。

编辑

也就是说，GC 肯定对社区的大部分人都有好处。它使我们能够更多地关注问题领域，而不是漂亮的编程技巧或模式。不过，我仍然是一个“非托管”C++ 开发人员。在这种情况下，良好的做法和工具会有所帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-02T19:32:16.317

内存分配？不，我认为 GC 比我更擅长。

但是稀缺的资源分配，如文件句柄、数据库连接等？完成后，我编写代码来关闭它们。GC不会为您这样做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-03T11:02:28.297

我做了很多嵌入式开发，问题更可能是是使用 malloc 还是静态分配，而垃圾收集不是一种选择。

我还编写了很多基于 PC 的支持工具，并且很乐意在可用且足够快的地方使用 GC，这意味着我不必使用 pedant::std::string。

我写了很多压缩和加密代码，除非我真的弯曲实现，否则 GC 性能通常不够好。GC 还要求您对地址别名技巧非常小心。我通常用 C 编写性能敏感代码，并从 Python / C# 前端调用它。

所以我的回答是有理由避免 GC，但原因几乎总是性能，然后最好用另一种语言编写需要它的东西，而不是试图欺骗 GC。

如果我在 MSVC++ 中开发一些东西，我从不使用垃圾收集。部分是因为它是非标准的，但也因为我在 C++ 中没有 GC 并且在安全内存回收中自动设计。话虽如此，我认为 C++ 是一个可憎的东西，它无法提供 C 的翻译透明度和可预测性，或者后来的 OO 语言的范围内存安全（除其他外）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T19:32:53.070

使用垃圾收集器可能很难编写实时应用程序。也许使用在另一个线程中工作的增量 GC，但这是额外的开销。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-03T11:16:08.703

两个字：**空间硬化**

我知道这是一个极端情况，但仍然适用。适用于火星探测器核心的编码标准之一实际上禁止动态内存分配。虽然这确实是极端的，但它说明了“部署并忘记它，无忧无虑”的理想。

简而言之，对您的代码实际上对某人的计算机所做的事情有所了解。如果你这样做了，而且你很保守……那就让记忆精灵来处理剩下的事情。当您在四核上开发时，您的用户可能会使用更老的东西，可用的内存要少得多。

使用垃圾收集作为安全网，注意分配的内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-02T19:40:52.803

我能想到的一种情况是，当您处理达到数百兆字节或更多的大型数据集时。根据具体情况，您可能希望在完成后立即释放此内存，以便其他应用程序可以使用它。

此外，在处理一些非托管代码时，您可能希望阻止 GC 收集一些数据，因为非托管部分仍在使用这些数据。尽管我仍然必须想出一个很好的理由，为什么仅仅保留对它的引用可能还不够好。:P

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-02T20:08:10.597

我处理过的一种情况是图像处理。在研究裁剪图像的算法时，我发现托管库的速度不足以同时在大图像或多个图像上进行裁剪。

以合理的速度对图像进行处理的唯一方法是在我的情况下使用非托管代码。这是在 C# .NET 中从事一个小型个人副项目时，我不想学习第三方库，因为项目的规模很大，因为我想学习它以使自己变得更好。可能有一个现有的第三方库（可能是 Paint.NET）可以做到这一点，但它仍然需要非托管代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T00:36:04.597

有两种主要类型的实时系统，硬的和软的。主要区别在于硬实时系统要求算法始终在特定的时间预算内完成，而软系统希望它正常发生。软系统可能会使用设计良好的垃圾收集器，尽管普通的垃圾收集器是不可接受的。但是，如果硬实时系统算法没有及时完成，那么生命可能处于危险之中。您会在核反应堆、飞机和航天飞机中找到此类系统，即便如此，也只能在构成操作系统和驱动程序的专业软件中找到。可以说这不是你常见的编程工作。

编写这些系统的人不倾向于使用通用编程语言。Ada 是为编写这类实时系统而设计的。尽管在某些系统中是此类系统的特殊语言，但该语言被进一步缩减为称为 Spark 的子集。Spark 是 Ada 语言的一个特殊的安全关键子集，它不允许的功能之一是创建新对象。对象的 new 关键字被完全禁止，因为它可能会耗尽内存和可变的执行时间。实际上，Spark 中的所有内存访问都是通过绝对内存位置或堆栈变量完成的，并且不会在堆上进行新的分配。垃圾收集器不仅完全无用，而且对保证的执行时间有害。

这些类型的系统并不常见，但在它们存在的地方需要一些非常特殊的编程技术，并且保证执行时间至关重要。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-03T12:35:24.677

几乎所有这些答案都归结为性能和控制。我在之前的文章中没有看到的一个角度是，跳过 GC 可以通过两种方式为您的应用程序提供更可预测的缓存行为。

1.  在某些缓存敏感的应用程序中，让语言每隔一段时间自动丢弃您的缓存（尽管这取决于实现）可能是一个问题。
2.  尽管 GC 与分配正交，但大多数实现使您对细节的控制较少。许多高性能代码具有针对缓存调整的数据结构，并且实现诸如[缓存忽略算法之](http://en.wikipedia.org/wiki/Cache-oblivious_algorithm)类的东西需要对内存布局进行更细粒度的控制。尽管从概念上讲，没有理由 GC 与手动指定内存布局不兼容，但我想不出一个流行的实现可以让您这样做。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-12-28T06:20:11.250

> 假设您正在使用其中一种语言，您有什么理由不使用垃圾收集，而是以某种方式手动管理内存分配？

可能有几个可能的原因：

1.  由于垃圾收集器导致的程序延迟高得无法接受。

2.  回收前的延迟时间长得令人无法接受，例如，在 .NET 上分配一个大数组会将其放入不经常收集的大对象堆 (LOH) 中，因此在变得无法访问后它会停留一段时间。

3.  与垃圾收集相关的其他开销高得令人无法接受，例如写屏障。

4.  垃圾收集器的特性是不可接受的，例如，当 32 位地址空间用尽时，即使理论上有足够的可用空间，.NET 上的加倍数组也会使大对象堆 (LOH) 碎片化，从而导致内存不足。在 OCaml（可能还有大多数 GC 语言）中，具有深线程堆栈的函数运行速度越来越慢。同样在 OCaml 中，线程被 GC 上的全局锁阻止并行运行，因此（理论上）可以通过下降到 C 并使用手动内存管理来实现并行性。

> 你曾经不得不这样做吗？

不，我从来没有*这样*做过。我这样做是为了好玩。例如，我用 F#（一种 .NET 语言）编写了一个垃圾收集器，为了让我的计时具有代表性，我采用了一种无分配风格以避免 GC 延迟。在生产代码中，我不得不使用垃圾收集器如何工作的知识来优化我的程序，但我什至不必从 .NET 中规避它，更不用说完全放弃 .NET，因为它强加了 GC。

我最接近放弃垃圾收集的是放弃 OCaml 语言本身，因为它的 GC 会阻碍并行性。但是，我最终迁移到了 F#，它是一种 .NET 语言，因此继承了 CLR 出色的多核 GC。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-05T06:51:15.947

在视频游戏中，您不想在游戏帧之间运行垃圾收集器。

> 例如，大坏蛋就在你面前，你的生命值下降到 10。你决定跑向四倍伤害加电。一旦你拿起通电，你就准备好转向你的敌人，用你最强大的武器开火。
> 
> 当道具消失时，仅仅因为游戏世界必须删除道具的数据而运行垃圾收集器将是一个坏主意。

电子游戏通常通过确定特定地图中需要什么来管理它们的对象（这就是为什么加载包含大量对象的地图需要一段时间的原因）。某些游戏引擎会在某些事件后调用垃圾收集器（保存后，当引擎检测到附近没有威胁时等）。

除了视频游戏，我没有找到任何关闭垃圾收集的充分理由。

编辑：在阅读了其他评论之后，我意识到嵌入式系统和空间强化（分别是 Bill 和 tinkertim 的评论）也是关闭垃圾收集器的好理由

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-02T23:12:11.380

我不太明白这个问题。既然你问的是一种使用 GC 的语言，我假设你是在问像这样的例子

1.  即使我知道它已经死了，也故意挂在一个引用上，也许是为了重用该对象以满足未来的分配请求。
2.  跟踪一些对象并显式关闭它们，因为它们拥有垃圾收集器无法轻松管理的资源（打开的文件描述符、屏幕上的窗口等）。

我从来没有找到做#1的理由，但#2是偶尔出现的原因。许多垃圾收集器提供**终结**机制，这是您绑定到对象的操作，系统在回收对象之前运行该操作。但通常系统*无法*保证终结器是否实际运行，因此终结器的效用有限。

我在垃圾收集语言中所做的主要事情是**密切关注**我所做的其他工作的每个单位的分配数量。分配通常是性能瓶颈，尤其是在 Java 或 .NET 系统中。在 ML、Haskell 或 LISP 之类的语言中，这不是什么问题，它们通常设计为程序将疯狂分配的想法。

* * *

**编辑**：对评论的回复更长。

不是每个人都明白，在性能方面，分配器和 GC 必须被视为一个团队。在最先进的系统中，分配是从连续的可用空间（“托儿所”）完成的，并且与测试和增量一样快。但是，除非分配的对象非常短暂，否则该对象会产生债务：它必须从托儿所中复制出来，如果它存在一段时间，它可能会被复制几代。最好的系统使用连续的可用空间进行分配，并在某些时候从复制切换到标记/扫描或标记/扫描/压缩旧对象。所以如果你非常挑剔，你可以忽略分配，如果

*   您知道您正在处理从连续可用空间（托儿所）分配的最先进的系统。
*   您分配的对象非常短暂（在托儿所中不到一个分配周期）。

否则，分配的对象最初可能很便宜，但它们代表必须稍后完成的工作。即使分配本身的成本是测试和增量，减少分配*仍然*是提高性能的最佳方法。我已经使用最先进的分配器和收集器调整了数十个 ML 程序，这*仍然*是正确的；**即使使用最好的技术，内存管理也是一个常见的性能瓶颈**。

你会惊讶于有多少分配器不能很好地处理非常短寿命的对象。我刚刚从 Lua 5.1.4（可能是最快的脚本语言，带有分代 GC）通过替换 30 个替换序列获得了很大的加速，每个替换都分配了一个大表达式的新副本，同时替换30 个名字，这分配了一份大表达式而不是 30 个。性能问题消失了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-10-30T18:27:19.463

> 执行越关键，你就越想推迟垃圾收集，但是你推迟垃圾收集的时间越长，它最终会成为一个更大的问题。

使用上下文来确定需要：

1.

*   垃圾收集应该防止内存泄漏
*   您需要的状态是否超出您的头脑所能管理的范围？

2.

*   通过销毁没有引用的对象来返回内存可能是不可预测的
*   您是否需要比您的头脑中管理的更多的指针？

3.

*   垃圾回收可能导致资源匮乏
*   您的 CPU 和内存是否超出了您的头脑所能管理的范围？

4.

*   垃圾收集无法寻址文件和套接字
*   您是否将 I/O 作为主要关注点？

> 在使用垃圾回收的系统中，弱指针有时用于实现简单的缓存机制，因为没有强引用的对象只有在内存压力触发垃圾回收时才会被释放。然而，使用 ARC，值在它们最后一个强引用被删除后立即被释放，使得弱引用不适合这种目的。

**参考**

*   [GC 常见问题](http://www.iecc.com/gclist/GC-faq.html)
*   [智能指针指南](http://www.chromium.org/developers/smart-pointer-guidelines)
*   [过渡到 ARC 发行说明](https://developer.apple.com/library/ios/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html)
*   [使用 LLVM 进行准确的垃圾收集](http://llvm.org/docs/GarbageCollection.html)
*   [各种语言的内存管理](http://www.memorymanagement.org/mmref/lang.html)
*   [jwz 上 垃圾收集](http://www.jwz.org/doc/gc.html)
*   [苹果可以为网络提供动力](http://kevinlawler.com/objective-c)
*   [脚本垃圾收集器如何工作？](http://blogs.msdn.com/b/ericlippert/archive/2003/09/17/53038.aspx)
*   [最小化垃圾生成：GC 是你的朋友，而不是你的仆人](https://blogs.oracle.com/dholmes/entry/minimize_garbage_generation)
*   [IE6 中的垃圾回收](http://pupius.co.uk/blog/2007/03/garbage-collection-in-ie6/)
*   [当您在 Internet Explorer 6 中查看使用 JScript 的网页时，Web 浏览器性能下降](http://smallbusiness.support.microsoft.com/en-us/kb/942840)
*   [过渡到 ARC 发行说明：哪些类不支持弱引用？](https://developer.apple.com/library/content/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html#//apple_ref/doc/uid/TP40011226-CH1-SW18)
*   [自动引用计数：弱引用](https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/AutomaticReferenceCounting.html#//apple_ref/doc/uid/TP40014097-CH20-ID53)

# asp.net - MVC beta 中的 <%=Html.RadioButtonList()%> 扩展在哪里？

> ID：407803
> 
> 赞同：3
> 
> 时间：2009-01-02T19:30:49.190
> 
> 标签：asp.net, asp.net-mvc, extension-methods

核心 MVC 测试版中没有单选按钮列表助手有什么原因吗？有一个下拉列表，但没有单选按钮列表。

我知道我可以很容易地创建一个扩展方法来确定这是一个核心的事情吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T20:11:37.907

它在 mvc 期货中，您可以在 codeplex 上下载。但我相信它有错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T19:46:26.973

我认为为了简化而将其删除，而您可以只使用 foreach 循环。

# exception - 在 Windows 服务中引发异常

> ID：407805
> 
> 赞同：7
> 
> 时间：2009-01-02T19:31:54.057
> 
> 标签：exception, windows-services

在 Windows 服务中引发异常会使服务崩溃吗？

即它必须手动重新启动

**注意：** 我从 catch 子句中抛出异常。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:33:43.397

严格来说并非如此 - 如果异常未处理，它只会导致问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T19:35:03.800

如果异常未被捕获并且冒泡返回到 OnStart() 方法，它将使服务崩溃。您通常会在 Windows 事件日志中看到类似于以下内容的消息：

“MyServiceName 服务服务意外终止。它已经完成了 x 次。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T20:21:28.713

我们遇到了子线程上未捕获的异常导致服务停止的问题，而没有提供有关导致异常的任何信息。我们使用这种方法来找出异常的来源。

你可以给服务放一个Handler来捕获所有未处理的异常（包括服务的所有子线程）。在 VB.NET 中，您需要为 AppDomain.CurrentDomain.UnhandledException 添加一个处理程序。在 C# 中可能类似。然后它会捕捉到任何在你的 onStart 之后冒出来的东西。您可以选择在那里使用它或允许它从那里崩溃服务。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-02T20:06:35.483

如果你在 Catch 中抛出异常，并且它上面没有任何东西可以重新捕获它，那么这将导致你的服务停止。OnStart() 方法需要一个 try/catch。如果您不想在发生异常时停止服务，那么您需要处理它（记录并继续，或其他）。

我的偏好是处理预期的异常，并且有意外的异常会导致服务停止，或者至少自动停止/重新启动。如果发生意外情况，您的服务将在未知状态下运行，谁知道它会做什么。

# file-upload - 直接下载 - 无需等待

> ID：407834
> 
> 赞同：1
> 
> 时间：2009-01-02T19:45:05.010
> 
> 标签：file-upload

我想编写一些程序，您可以在一侧上传文件，而其他人可以在我开始上传的那一刻下载它。我知道这样的服务，但不记得名字了。如果您知道该服务，我想知道它的名称，如果它不再存在，我想将它编程为一个开源项目。

它应该是一个网站

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T20:16:58.940

pipebytes.com 我找到了 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T19:47:02.263

您所描述的内容听起来很像 Bit Torrent。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T20:00:16.103

您*可以*通过自定义 ISAPI 过滤器（如果您使用 IIS）上传来实现这一点——在请求完成之前，所有 CGI 实现都不会开始运行您的脚本，这是有道理的，因为您不会刚刚告诉了所有的值，我怀疑 ISAPI 也可能会违反这一点。

因此，您的下一个最佳选择是编写一个自定义 HTTP 服务器，它可以处理尚未完成上传的文件服务。

# asp.net - 对齐由 javascript 设置源的图像

> ID：407838
> 
> 赞同：0
> 
> 时间：2009-01-02T19:46:16.880
> 
> 标签：asp.net, javascript, html

我将网络解决方案“印章”图像放在我的网站上，它们会为您提供设置图像的 javascript。我希望图像对齐>正确。但是，如果你想要图像，他们会给你一个 javascript 代码存根，它会处理剩下的，没有对齐属性。我什至尝试将javascript放入一个正确对齐的表中，但显然javascript是在浏览器呈现表之后呈现的。

关于如何解决这个问题的想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T19:51:02.237

你可以用一个 div 包裹 JavaScript 代码区域，并给它一个 class 或 id。然后你很可能用 CSS 来定位它。

```
<div id="network-solutions">
    <script type="text/javascript" src="foo.js"></script>
</div>

#network-solutions img {
    float:right;
} 
```

# asp.net - 从错误代码访问 Profile 对象？（ASP.NET 2.0 提供者模型）

> ID：407845
> 
> 赞同：1
> 
> 时间：2009-01-02T19:47:35.757
> 
> 标签：asp.net, profile, provider

我一直在使用 ASP.NET 的成员资格、角色和配置文件提供程序。为此，我最近设置了 Microsoft Sample 的自定义 Table Profile Provider（参见：[http](http://www.asp.net/downloads/sandbox/table-profile-provider-samples/) ://www.asp.net/downloads/sandbox/table-profile-provider-samples/ ）

当我运行测试解决方案时，我可以通过编程方式访问 Profile 变量。即我可以键入配置文件。在后面的代码中，Intellsense 将允许我访问我的自定义配置文件变量（在 web.config 中设置）...姓氏、名字、年龄等。

但是，当我在自己的解决方案中设置相同的场景并输入 Profile 时。在代码隐藏中，它无法识别 IntelliSense 中的对象，并且如果我自己键入它也不会编译。

话虽这么说......如果我输入 <%= Profile. 在前端，VS 为我提供了我正在寻找的东西（前端 Intellisense 弹出我定义的配置文件变量）

有没有其他人遇到过这个问题/知道解决方案

谢谢！

-麦克风

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-05T15:04:48.257

对于 Web 应用程序项目，请参见此处：[http ://code.msdn.microsoft.com/WebProfileBuilder](http://code.msdn.microsoft.com/WebProfileBuilder)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T21:07:59.323

似乎我的问题是 Profile 仅对 VS.NET 网站模板有效（不适用于 Web 应用程序模板）

-麦克风

# svn - 使用 svn 创建标签时如何将日志消息添加到主干？

> ID：407854
> 
> 赞同：3
> 
> 时间：2009-01-02T19:51:10.350
> 
> 标签：svn

在构建项目时，我使用 svn copy 命令标记源。查看中继的历史记录时，我看不到这些标签的日志消息。我想在主干中查看我的每个发布版本的日志消息。

我希望能够轻松查看每个版本中有哪些更改。现在我需要返回并找到每个标签的修订号，并在查看日志时手动跟踪该数字。

如果我可以在标记发生后运行另一个命令将日志消息添加到主干，我什至会很高兴。但是，我找不到在日志中显示每个文件的消息的方法，因为在标记之后没有文件更改。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T19:53:28.113

我想你想看看“消息”参数

[http://svnbook.red-bean.com/en/1.0/re07.html](http://svnbook.red-bean.com/en/1.0/re07.html)

svn copy .... --message (-m) TEXT

编辑：

没关系。那不是你想要的。您想查看后备箱以查看您制作的副本/标签...您可以这样做：

svn list --verbose 例如 svn list --verbose file:///repository_name/tags

但最终我认为你回答了你自己的问题。将文本文件保存在某个地方，并在构建期间使用标签名称自动附加到它，然后使用标签/标签的注释将其签入。

我在以前的公司做过类似的事情。构建脚本有自己的用户登录 SVN 并签入版本文件。

即/Project/Builds/builds.txt

包含标记版本的列表。您可以追加或覆盖它。由于它是版本化的，因此是否覆盖它并不重要。对于进行 CI/许多构建，它可能有助于防止它变得如此之大。

编辑

在文本文件中，您放置了修订和与之关联的标签名称。您还签入了该文件，因此您可以假设它是每个标记构建的 tag-revision-n +1。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T20:18:23.680

在您的分支/标签上，使用 svn log --stop-on-copy -v 。底部条目将显示您最初复制的位置：修订版。

有关更多信息，请参阅[http://blank.jasonwhaley.com/2008/12/subversion-t-where-and-what-revision.html](http://blank.jasonwhaley.com/2008/12/subversion-t-where-and-what-revision.html) 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T12:36:38.153

在颠覆中，您通常不会将消息添加到主干，而是添加到分支。（因为您实际上并没有通过创建分支/标签来更改主干）。如果您真的想将日志消息添加到主干，您应该更改主干本身的内容。

要为此使用相同的消息和修订，您需要做一些特别的事情（或者在包含主干和新分支的工作副本中做所有事情）。

使用 svnmucc 您可以执行以下操作：（当您看到反斜杠时，行继续）

```
svnmucc \
  cp 1234 http://srv/svn/project/trunk http://srv/svn/project/tags/release \
  propset last-tag ^/tags/release http://srv/svn/project/trunk \
  -m "The log message" 
```

（svnmucc 代表 Subversion 的多 URL 命令客户端，在大多数 subversion 版本中都可用）

这在一次提交中完成了所有这些：

*   复制[http://srv/svn/project/trunk@1234](http://srv/svn/project/trunk@1234)到[http://srv/svn/project/tags/release](http://srv/svn/project/tags/release)
*   在主干上设置属性“last-tag”，其值为 ^/tags/release
*   应用日志消息“日志消息”

last-tag 属性可以用其他东西代替；但这是仅对主干进行非常小的更改的示例。

# java - Java 垃圾收集器如何处理自引用？

> ID：407855
> 
> 赞同：23
> 
> 时间：2009-01-02T19:51:12.800
> 
> 标签：java, garbage-collection

希望是一个简单的问题。以循环链表为例：

```
class ListContainer
{
  private listContainer next;
  <..>

  public void setNext(listContainer next)
  {
    this.next = next;
  }
}

class List
{
  private listContainer entry;
  <..>
} 
```

现在因为它是一个循环链表，当添加一个元素时，它在它的下一个变量中有一个对自身的引用。删除列表中的唯一元素时，条目设置为 null。是否需要将 ListContainer.next 设置为 null 以及垃圾收集器释放它的内存还是自动处理这种自引用？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-02T20:14:19.553

仅依靠引用计数的垃圾收集器通常容易无法收集此类自引用结构。这些 GC 依赖于对对象的引用数的计数，以计算给定对象是否可访问。

非引用计数方法应用更全面的可达性测试来确定对象是否有资格被收集。这些系统定义了一个总是被认为是可达的对象（或一组对象）。可以从此对象图中获得引用的任何对象都被认为不符合收集条件。不能从该对象直接访问的任何对象都不是。因此，循环不会最终影响可达性，并且可以被收集。

另请参阅有关[跟踪垃圾收集器](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science)#Tracing_garbage_collectors)的 Wikipedia 页面。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-02T19:57:25.190

如果您依靠计数引用来确定对象是否已死，则循环引用是一个（可解决的）问题。没有java实现使用引用计数，AFAIK。较新的 Sun JRE 混合使用了几种类型的 GC，我认为都是标记和清除或复制。

[例如，您可以在Wikipedia](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))上阅读有关垃圾收集的更多信息，并[在此处](http://www.javaworld.com/javaworld/jw-08-1996/jw-08-gc.html)和[此处](http://blogs.oracle.com/jonthecollector/entry/our_collectors)阅读有关 java GC 的一些文章。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-02T20:19:43.273

对此的实际答案取决于实现。Sun JVM 会跟踪一些根对象（线程等），当它需要进行垃圾回收时，会从这些对象中找出可以访问的对象并保存它们，丢弃其余对象。允许一些优化实际上比这更复杂，但这是基本原则。这个版本不关心循环引用：只要没有活对象持有对死对象的引用，它就可以被 GC。

其他 JVM 可以使用一种称为引用计数的方法。当创建对对象的引用时，一些计数器会增加，当引用超出范围时，计数器会减少。如果计数器达到零，则对象被最终确定并被垃圾收集。然而，这个版本确实允许循环引用永远不会被垃圾收集。作为一种保护措施，许多这样的 JVM 包括一个备份方法来确定哪些对象实际上是死的，它会定期运行以解决自引用和对堆进行碎片整理。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-02T22:38:51.480

作为一个非答案（现有答案已经足够了），如果您对 GC 完全感兴趣，您可能需要查看有关 JVM 垃圾收集系统的白皮书。（任何，只是谷歌 JVM 垃圾收集）

我对其中使用的一些技术感到惊讶，并且在阅读诸如“伊甸园”之类的一些概念时，我第一次真正意识到 Java 和 JVM 实际上可以在速度上击败 C/C++。（每当 C/C++ 释放一个对象/内存块时，都会涉及到代码......当 Java 释放一个对象时，它实际上什么都不做；因为在良好的 OO 代码中，大多数对象几乎是立即创建和释放的，这非常有效。）

现代 GC 往往非常高效，管理旧对象与新对象大不相同，能够控制 GC 短而半，长而彻底，并且许多 GC 选项可以通过命令行开关管理，因此实际上了解所有术语实际指的是什么很有用。

注意：我刚刚意识到这是误导。C++ 的 STACK 分配非常快——我的意思是分配在当前例程完成后能够存在的对象（我相信应该是所有对象——如果你打算这样做，你不应该考虑在 OO 中思考，但在 C++ 中的速度可能会使这不切实际）。

如果您只是在堆栈上分配 C++ 类，它的分配将至少与 Java 一样快。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-02T19:57:09.900

Java 收集任何不可访问的对象。如果没有其他东西引用该条目，那么它将被收集，即使它具有对自身的引用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-08-21T06:54:05.127

是的 Java 垃圾收集器处理自引用！

```
How? 
```

有称为垃圾收集根（GC 根）的特殊对象。这些总是可以访问的，任何以它们为根的对象也是如此。

一个简单的 Java 应用程序具有以下 GC 根：

1.  main方法中的局部变量
2.  主线程
3.  主类的静态变量

![在此处输入图像描述](https://i.stack.imgur.com/IjZqR.png)

为了确定哪些对象不再使用，JVM 会间歇性地运行一种非常恰当地称为**标记和清除算法的**方法。它的工作原理如下

1.  该算法遍历所有对象引用，从 GC 根开始，并将找到的每个对象标记为活动的。
2.  所有未被标记对象占用的堆内存都会被回收。它被简单地标记为空闲，基本上清除了未使用的对象。

因此，如果任何对象无法从 GC 根访问（即使它是自引用或循环引用的），它将受到垃圾回收。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-02T22:18:23.500

简单地说，是的。:)

查看[http://www.ibm.com/developerworks/java/library/j-jtp10283/](http://www.ibm.com/developerworks/java/library/j-jtp10283/)

所有 JDK（来自 Sun）都有“可达性”的概念。如果 GC 不能“到达”一个对象，它就会消失。

这不是任何“新”信息（您对受访者的第一个信息很棒），但链接很有用，简洁是甜蜜的。:)

# apache-flex - 将 flashvars 样式的参数传递给加载的 SWF

> ID：407858
> 
> 赞同：5
> 
> 时间：2009-01-02T19:52:20.940
> 
> 标签：apache-flex, flash, actionscript-3, swfloader, flashvars

我有一个 Flex 3 应用程序（播放器 v9），它加载一个 Flash SWF（AS3，也是播放器 v9），并且需要动态地向它传递一组在运行时已知的参数。这些是通常通过`flashvars`HTML 页面中的元素传递的参数。`loaderInfo.parameters`嵌入的电影通过对象访问这些参数。

我尝试过使用`SWFLoader`和`Loader`类，但在参数传递中没有成功。

相关细节：

*   这是一个本地程序，不能依赖查询字符串参数。
*   我已经`loaderInfo.parameters["foo"] = "123"`从嵌入代码中进行了设置，但是该参数似乎永远不会在嵌入的电影中结束。
*   我不能在嵌入式电影中放置额外的参数传递机制，因为它们是由第三方创建的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-15T17:40:05.937

在 URL 中传递此参数无济于事，因为它们是使用 html-wrapper 中的 javascript 代码获取的。'flashVars' 参数是使用 Application.application.parameters 获取的，因此，您必须根据您的情况手动设置这些参数。

如果您使用 SWFLoader 加载另一个应用程序，您应该创建对象，该对象将代表已加载的应用程序并应用您需要的所有内容：

```
<mx:Script>
    <![CDATA[
        import mx.managers.SystemManager;
        import mx.controls.Alert;
        import mx.events.FlexEvent;

        private var loadedApp:Application;

        private function onLoadComplete(event:Event):void {
            var smAppLoaded:SystemManager = SystemManager(event.target.content);
            smAppLoaded.addEventListener(FlexEvent.APPLICATION_COMPLETE, onLoadedAppComplete);
        }

        private function onLoadedAppComplete(event:FlexEvent):void {
            try {
                loadedApp = Application(event.target.application);
                if(!loadedApp) throw new Error();

                loadedApp.parameters["param1"] = "value1";
            } catch (e:Error) {
                Alert.show("Failed to get application loaded.", "Error", Alert.OK); 
            }
        }

        private function onLoadError():void {
            Alert.show("Failed to load an application.", "Error", Alert.OK);
        }

    ]]>
</mx:Script>

<mx:SWFLoader 
    width="100%" height="100%"
    source="./AppToLoad.swf" 
    complete="onLoadComplete(event)" 
    ioError="onLoadError()" securityError="onLoadError()" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-24T12:37:04.197

原因很简单。我今天发现了这一点。

在通过`SWFloader`具有`parentApplication`或`Aplication.application`设置为顶级应用程序加载的组件中（此女巫通过 SWFLoader 加载组件）。并且加载的组件可以看到`flashvars`设置为顶级应用程序。这可能是设置参数`SWFLoader`没有任何影响的原因。

我已经在我的顶级应用程序上设置了正确的 flashvars，它们也可以在加载的应用程序中看到:-)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T10:25:53.097

在网页上嵌入 SWF 时，您可以将 flashvars 作为 URL 上的参数传递给 SWF，也许同样适用于您的情况？如果 SWF 位于`file:///some/path/to/a.swf`尝试使用`file:///some/path/to/a.swf?hello=world&foo=bar`. 它可能会起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-13T01:28:34.490

如果我首先找到这个答案，今天会为自己节省很多时间：[AS3 Pass FlashVars to loaded swf](https://stackoverflow.com/questions/2302722/as3-pass-flashvars-to-loaded-swf)。

本质上：从 Flash Player 10.2 开始，可以通过将 flashvars 设置为 LoaderContext 上的参数来传递它们。

# resolution - Ghostscript和高分辨率？

> ID：407869
> 
> 赞同：1
> 
> 时间：2009-01-02T19:57:43.770
> 
> 标签：resolution, ghostscript

我正在编写一个脚本来读取一些标记数据，生成一个 tex 文档并将其转换为 png 图像。

只要我使用 tp 286 像素/英寸的分辨率，一切正常。不幸的是，我用来创建图片数据的 GhostScript 在我使用更高的值时没有任何作用。

我该如何解决这种行为？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-08-09T23:38:49.153

由于有关您的问题的信息不是很详细（*TeX 文档中使用了哪种字体？它们是中文、日文、韩文还是...？您使用的是哪个 Ghostscript 命令行？*）...这里是要检查的东西。但这只是第一个猜测：尝试将“ `-c "100000000 setvmthreshold" -f /path/to/pdffile.pdf`”添加到您的命令中：

```
 gswin32c.exe ^
      -o c:/path/to/output.png ^
      -sDEVICE=png ^
      -r600x600 ^
      -c "100000000 setvmthreshold" ^
      -f /path/to/pdffile.pdf 
```

这将允许 Ghostscript 使用约 100 MB 的额外 RAM。如果您使用的是 X-Windows（Linux、Unix），那么“ `-dMaxBitmap=...`”可能会有所帮助（前提是您有足够的 RAM）：

```
 gs \
      -o /path/to/output.png \
      -sDEVICE=png \
      -r600x600 \
      -dMaxBitmap=100000000 \
      -c "100000000 setvmthreshold" \
      -f /path/to/pdffile.pdf 
```

# javascript - 分页：服务器端还是客户端？

> ID：407878
> 
> 赞同：53
> 
> 时间：2009-01-02T20:01:02.217
> 
> 标签：javascript, pagination, client-side, server-side

什么是最好的分页处理？服务器端还是使用javascript动态执行？

我正在开发一个大量使用 ajax 并动态提取数据的项目，所以我一直在研究一个使用 dom 的 javascript 分页系统 - 但我开始认为处理这一切会更好服务器端。

大家的想法是什么？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-01-02T20:08:35.527

正确的答案取决于您的优先级和要分页的数据集的大小。

**服务器端分页最适合：**

*   大型数据集
*   更快的初始页面加载
*   那些不运行 javascript 的人的可访问性

**客户端分页最适合：**

*   小数据集
*   更快的后续页面加载

因此，如果您主要出于美观原因进行分页，则在客户端处理它更有意义。如果您要分页以减少初始加载时间，那么服务器端是显而易见的选择。

当然，如果您使用 Ajax 加载后续页面，客户端在后续页面加载时间方面的优势就会减弱。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-02T20:03:50.480

在客户端执行此操作将使您的用户首先下载所有可能不需要的数据，并将消除分页的主要好处。

对于此类 AJAX 应用程序，最好的方法是让 AJAX 调用服务器以获取下一页并使用客户端脚本添加更新当前页面。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-02T20:10:01.640

如果您有大页面和大量页面，您最好通过 AJAX 从服务器请求分块页面。因此，让服务器根据您的请求 URL 进行分页。

您还可以预取用户可能会查看的接下来的几个页面，以使界面看起来更具响应性。

如果只有几页，则预先抓取所有页面并在客户端上分页可能是更好的选择。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-02T20:16:46.977

即使数据量很小，最好的选择也是服务器端分页。如果您的 Web 应用程序进一步扩展，您以后不必担心。

对于更大的数据量，答案是显而易见的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-02T20:08:07.710

服务器端 - 向客户端发送当前视图的足够内容。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-02T22:03:46.917

在一个实际的限制世界中，我会在服务器端分页以节省与发送数据相关的所有资源。此外，服务器需要保护自己免受请求巨大页面的恶意/故障客户端的影响。

一旦该代码愉快地运行，我将向客户端添加“智能”以获取“下一个”和“上一个”页面并将其保存在内存中。当用户翻到下一页时，更新您的缓存。

如果客户端软件执行这种页面缓存，请考虑数据老化的速度（可能会更改）以及是否应该检查缓存的数据页面是否仍然有效。如果它的时间超过 2 分钟，可能会重新请求它。也许里面有一个“脏”的标志。类似的东西。希望你觉得这很有帮助。:)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-02T22:31:52.727

您的意思是您的 JavaScript 将所有数据都保存在内存中，并且一次显示一页吗？或者它使用 AJAX 根据需要从服务器下载每个页面？

如果是后者，您可能还需要考虑排序。如果您使用 JavaScript 进行排序，则一次只能对一页进行排序，这没有多大意义。所以你的排序应该在服务器上完成。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-02T22:24:52.803

我更喜欢服务器端分页。但是，在实现它时，您需要确保正确优化 SQL。例如，我相信 MySQL，如果你使用 LIMIT 选项它不使用索引，所以你需要重写你的 sql 以正确使用索引。

G人

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-03-02T18:33:51.323

这里要指出的另一件事是，您很少会被限制为简单地通过原始数据集进行分页。

您可能必须在您正在显示的一个或多个列中搜索某些术语，然后对几列进行排序，然后让用户能够翻阅这个过滤的数据集。

在这种情况下，您可能必须查看是否有此逻辑搜索和/或排序客户端或服务器端更好。

另一件要考虑的事情是，亚马逊的云搜索 API 为您提供了一些非常强大的搜索能力，如果您碰巧将数据托管在那里，您显然希望允许云搜索为您处理搜索和排序。

# visual-studio-2008 - 如何让 Intellisense（代码完成）在 Mac 上的 Parallels 内的 VS.NET 上工作？

> ID：407879
> 
> 赞同：4
> 
> 时间：2009-01-02T20:01:06.447
> 
> 标签：visual-studio-2008, intellisense, parallels

如何让 Intellisense 在 Mac 上的 Parallels 内运行的 Visual Studio 上工作？

在我的 PC 上，我按 CTRL+Space 来获取 Intellisense，但在 Parallels 中似乎没有组合键有效；我认为这可能是因为 Quicksilver 或 Spotlight 使用相同的组合键并且可能会被拦截，但在我重新映射它们以使用 F 键后它仍然无法正常工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-07-11T12:42:50.080

我知道这已经有几年了，但我会坚持我在这里找到的东西，以防其他人在谷歌搜索中找到它。

我发现直到我交换了我的 Mac 的 Control 和 Command 键之后我才遇到问题，所以我只需要使用 Control+C、Control+V 来复制和粘贴。

一旦我通过 Control+Space 交换这些，在 Visual Studio 中将无法工作，直到我转到 Parallels Preferences -> Keyboard 并取消选中“启用 Mac OS X 系统快捷方式”

我猜 Cmd+Space 或 Ctrl+Space 是某种 Mac OS X 快捷方式，它覆盖了我在 Windows 机器上输入的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-01-25T19:29:00.620

使用 Fn+Ctrl+Space 而不是 Ctrl+Space 以使 Intellisense 出现在 Mac 上的 Parallels Desktop 内运行的 Visual Studio 上

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T20:18:51.807

在我的 MacBook Pro 上使用 Parallels 3.0 对我来说很好。我可以单击一个类，按 Ctrl-Space 并弹出 Intellisense。适用于 Coherence 和 Single Windows 模式。在空格中键入单个字符也会显示它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T20:05:39.977

应该可以正常工作。自从我使用 Parallels 已经有一段时间了，但我确信有一个选项可以将“特殊”MacOS 密钥发送到虚拟机，而不是 OSX——如果你打开它，它应该会将所有内容发送到 VM。

如果您在 Coherence 模式下使用它，那么我唯一能想到的就是更改 Visual Studio 中的键盘映射（工具、选项）

# c++ - 我可以使用模板而不是宏来创建异常类吗？

> ID：407881
> 
> 赞同：3
> 
> 时间：2009-01-02T20:02:15.600
> 
> 标签：c++, templates, constructor

我经常想定义新的“异常”类，但需要定义一个适当的构造函数，因为构造函数不是继承的。

```
class MyException : public Exception 
{ 
public:
  MyException (const UString Msg) : Exception(Msg)
  {
  };
} 
```

Typedef 对此不起作用，因为它们只是别名，而不是新类。目前，为了避免重复这个琐碎的样板文件，我使用了一个#define 来完成这项工作。

```
#define TEXCEPTION(T) class T : public Exception \
{ \
public:\
    T(const UString Msg) : Exception(Msg) {}; \
}

...

TEXCEPTION(MyException); 
```

但我一直想知道是否有更好的方法来实现这一点——可能是模板，或者一些新的 C++0x 特性

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T20:43:17.920

如果你真的想要从 Exception 派生新类，而不是让模板由参数参数化，那么没有办法编写自己的构造函数，它只委托参数而不使用宏。C++0x 将拥有你所需要的能力，通过使用类似的东西

```
class MyException : public Exception 
{ 
public:
    using Exception::Exception;
}; 
```

[您可以在C++0x](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2798.pdf)的最新草案中的 12.9“继承构造函数”中阅读有关该细节的详细信息（似乎有很多额外的规则）。

[与此同时，我会推荐一个基于策略的设计（制作小文本，因为 OP 接受了上述内容，而不是这个政策内容）：]

```
// deriving from Impl first is crucial, so it's built first
// before Exception and its Ctor can be used.
template<typename Impl>
struct ExceptionT : Impl, Exception {
    // taking a tuple with the arguments.
    ExceptionT(arg_types const& t = arg_types())
        :Exception(Impl::Ctor(t)) { }
    // taking a string. plain old stuff
    ExceptionT(std::string const& s):Exception(Impl::Ctor(s)) { }
};

struct ExceptionDefImpl {
    typedef boost::tuple<> arg_types;

    // user defined ctor args can be done using a tuple
    std::string Ctor(arg_types const& s) {
        return std::string();
    }

    std::string const& Ctor(std::string const& s) {
        return s;
    }
};

// will inherit Ctor modifier from DefImpl.
struct MemoryLost : ExceptionDefImpl { 
    typedef boost::tuple<int> arg_types;

    std::string Ctor(arg_types const& s) {
        std::ostringstream os;
        os << "Only " << get<0>(s) << " bytes left!";
        return os.str();
    }

    int getLeftBytes() const { return leftBytes; }
private:
    int leftBytes;
};

struct StackOverflow : ExceptionDefImpl { };

// alias for the common exceptions
typedef ExceptionT<MemoryLost> MemoryLostError;
typedef ExceptionT<StackOverflow> StackOverflowError;

void throws_mem() {
    throw MemoryLostError(boost::make_tuple(5));
}    

void throws_stack() { throw StackOverflowError(); }

int main() {
    try { throws_mem(); } 
    catch(MemoryListError &m) { std::cout << "Left: " << m.getLeftBytes(); }
    catch(StackOverflowError &m) { std::cout << "Stackoverflow happened"; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T20:34:09.797

你可以用一个整数参数化你的模板类：

```
#include <iostream>
#include <string>

using namespace std;

enum ExceptionId {
    EXCEPTION_FOO,
    EXCEPTION_BAR
};

class Exception {
    string msg_;

public:
    Exception(const string& msg) : msg_(msg) { }
    void print() { cout << msg_ << endl; }
};

template <int T>
class TException : public Exception {
public:
    TException(const string& msg) : Exception(msg) {};
};

void
foo()
{
    throw TException<EXCEPTION_FOO>("foo");
}

void
bar()
{
    throw TException<EXCEPTION_BAR>("bar");
}

int
main(int argc, char *argv[])
{
    try {
        foo();
    } catch (TException<EXCEPTION_FOO>& e) {
        e.print();
    };

    try {
        bar();
    } catch (TException<EXCEPTION_BAR>& e) {
        e.print();
    };

    return 0;
} 
```

虽然，我不明白为什么你会喜欢使用具有在运行时设置/读取的内部枚举的单个类：

```
class TException {
public:
    enum Type { FOO, BAR };

    TException(Type type, const string& msg) : Exception(msg), type_(type) {}

    Type type() const { return type_; }

private:
    Type type_;
}; 
```

然后在捕获 TException 时打开类型...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T20:50:24.863

```
// You could put this in a different scope so it doesn't clutter your namespaces.
template<struct S>   // Make S different for different exceptions.
class NewException :
    public Exception 
{ 
    public:
        NewException(const UString Msg) :
            Exception(Msg)
        {
        }
};

// Create some new exceptions
struct MyExceptionStruct;    typedef NewException<MyExceptionStruct> MyException;
struct YourExceptionStruct;  typedef NewException<YourExceptionStruct> YourException;
struct OurExceptionStruct;   typedef NewException<OurExceptionStruct> OurException;

// Or use a helper macro (which kinda defeats the purpose =])
#define MAKE_EXCEPTION(name) struct name##Struct; typedef NewException<name##Struct> name;

MAKE_EXCEPTION(MyException);
MAKE_EXCEPTION(YourException);
MAKE_EXCEPTION(OurException);

// Now use 'em
throw new MyException(":("); 
```

# php - 如何发送 debian sendmail 以使用 google Apps smtp 以绕过 ISP 阻止 smtp

> ID：407887
> 
> 赞同：2
> 
> 时间：2009-01-02T20:05:47.030
> 
> 标签：php, sendmail, google-apps

我有一个 debian 网络服务器，它正在运行 shopsite 和一些 php 程序。其中使用 sendmail 向客户发送电子邮件。所以这个服务器只需要发送电子邮件。那么如何设置 sendmail 以使用 Google Apps smtp？因为我收到以下错误：sm-mta stat=Deferred: Connection reset by mx4.hotmail.com

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T21:27:13.153

如果您还没有设置它，最简单的方法是放弃 sendmail，安装 postfix，然后将 Google Apps SMTP 服务器设置为您的智能主机。IIRC，默认的后缀配置有一个完全注释的配置文件，所以你只需要通读它，取消智能主机行的注释，放入谷歌 SMTP 服务器，你就完成了。

否则，您仍然需要将 Google Apps 设置为您的智能主机。有大量关于如何做到这一点的谷歌信息；例如，请参见[此处](http://www.cyberciti.biz/faq/configure-sendmail-as-a-smart-host/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-04T02:42:53.857

据我所知，你不能让谷歌成为你的 MTA。

尝试使用[sSMTP](http://www.delodder.be/howto/gmail-with-ssmtp-on-deb-based-system/)

# c# - 为请求的持续时间设置全局变量

> ID：407902
> 
> 赞同：7
> 
> 时间：2009-01-02T20:11:57.237
> 
> 标签：c#, .net, asp.net, global-variables

我可以为单个请求的长度设置某种全局变量，以便页面的所有控件都可以响应它，而不必将其传递给每个控件吗？

例如，如果有人在我的 MasterPage 上点击了 Save 按钮，我可以设置一些东西，以便我的 Page 上的每个 UserControl 都可以有一个 Page_Load，例如：

```
protected void Page_Load(object sender, EventArgs e)
{
    if (isSaving) // isSaving is a global variable
    {
        saveData();  // save myself
    }
    loadData();
} 
```

这似乎比让来自母版页的委托调用 Page 的保存函数，然后调用 UC1.saveData() 到每个 UserControl 容易得多，尽管我知道这是更好的面向对象思维。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-02T20:36:03.770

是的你可以。查看明显的位置：HttpContext 和`HttpContext.Current.Items`在请求处理期间始终可访问的集合（请参阅[http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx)）。

就像一个*提示*：

```
public static class RequestScopedData
{
    private const string key = "key_that_you_choose";
    public static bool IsSaving
    {
        get
        {
            object o = HttpContext.Current.Items[key];
            return Convert.ToBoolean(o);            
        }
        set
        {
            HttpContext.Current.Items[key] = value;
        }
    }
} 
```

# php - 实施关键字比较方案（反向搜索）

> ID：407904
> 
> 赞同：3
> 
> 时间：2009-01-02T20:12:42.960
> 
> 标签：php, mysql, search, keyword, tokenize

我有一个不断增长的关键字数据库。我需要解析传入的文本输入（文章、提要等）并查找数据库中的哪些关键字出现在文本中。关键字的数据库比文本大得多。

由于数据库不断增长（用户添加了越来越多的关键字来关注），我认为最好的选择是将文本输入分解为单词并将其与数据库进行比较。我的主要困境是实现这个比较方案（这个项目将使用 PHP 和 MySQL）。

最简单的实现是针对关键字表创建一个简单的 SELECT 查询，其中有一个巨大的 IN 子句列出所有找到的关键字。

```
SELECT user_id,keyword FROM keywords WHERE keyword IN ('keyword1','keyword2',...,'keywordN'); 
```

另一种方法是在内存中创建一个哈希表（使用 memcache 之类的东西）并以相同的方式对其进行检查。

有没有人对这种搜索有任何经验，并对如何更好地实现这一点有任何建议？我还没有尝试过任何这些方法，我现在只是在收集想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T23:00:06.117

在文本流中搜索多个关键字的经典方法是[Aho-Corasick 有限自动机](http://en.wikipedia.org/wiki/Aho-Corasick_algorithm)，它使用要搜索的文本中的时间线性。您需要进行小的修改以仅在单词边界上识别字符串，或者检查找到的关键字并确保它们没有嵌入更大的单词中可能会更简单。

您可以在`fgrep`. 更好的是，Preston Briggs 用 C 语言编写了一个非常不错的实现，它完全可以进行您所说的关键字搜索。（它在程序中搜索“有趣的”标识符的出现。） Preston 的实现作为[Noweb literate-programming tool](http://www.cs.tufts.edu/~nr/noweb/)的一部分分发。你可以找到一种方法从 PHP 调用这段代码，或者你可以用 PHP 重写它——识别本身大约是 220 行 C，而主程序是另外 135 行。

所有提议的解决方案，*包括*Aho-Corasick，都具有以下共同特性：

*   一个预处理步骤，花费的时间和空间与数据库中的关键字数量成正比。

*   一个搜索步骤，所花费的时间和空间与文本长度加上找到的关键字数量成正比。

Aho-Corasick 在搜索步骤中提供了相当好的比例常数，但如果您的文本很小，这无关紧要。事实上，如果您的文本很小而数据库很大，您可能希望尽量减少预处理步骤中使用的内存量。[来自世界上最快的拼字游戏程序的](http://www.gtoal.com/wordgames/jacobson+appel/aj.pdf)Andrew Appel 的 DAWG 数据结构可能会成功。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T21:04:39.797

一般来说，

1.  将文本分解成单词

    湾。将单词转换回规范根形式

    C。删除常用连词

    d。剥离重复项

2.  将单词插入临时表，然后对关键字表进行内部连接，或者（如您所建议）将关键字构建到复杂的查询条件中

缓存一个 3 或 4 个字母的哈希数组可能是值得的，用它来预过滤潜在的关键字；您将不得不进行试验以找到内存大小和有效性之间的最佳折衷。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T22:44:47.070

I hacked up some code for scanning for multiple keywords using a dawg (as suggested above referencing the Scrabble paper) although I wrote it from first principles and I don't know whether it is anything like the AHO algorithm or not.

[http://www.gtoal.com/wordgames/spell/multiscan.c.html](http://www.gtoal.com/wordgames/spell/multiscan.c.html)

A friend made some hacks to my code after I first posted it on the wordgame programmers mailing list, and his version is probably more efficient:

[http://www.gtoal.com/wordgames/spell/multidawg.c.html](http://www.gtoal.com/wordgames/spell/multidawg.c.html)

Scales fairly well...

G

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T20:47:42.513

我不是 100% 清楚你在问什么，但也许你正在寻找的是[倒排索引](http://developer.apple.com/documentation/UserExperience/Conceptual/SearchKitConcepts/searchKit_basics/chapter_2_section_2.html)？

更新：

您可以使用倒排索引一次匹配多个关键字。

将新文档拆分为标记，并将与文档标识符配对的标记插入倒排索引表中。一个（相当非规范化的）倒排索引表：

```
inverted_index
-----
document_id keyword 
```

如果您手动搜索 3 个关键字：

```
select document_id, count(*) from inverted_index
  where keyword in (keyword1, keyword2, keyword3)
  group by document_id 
  having count(*) = 3 
```

如果您有一个您关心的关键字表，只需使用内部联接而不是 in() 操作：

```
keyword_table
----
keyword othercols

select keyword_table.keyword, keyword_table.othercols from inverted_index 
   inner join keyword_table on keyword_table.keyword=inverted_index.keyword
   where inverted_index.document_id=id_of_some_new_document 
```

这是否更接近你想要的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T21:01:53.733

我会在这里做两件事。

首先（这与问题没有直接关系）我会按用户分解和划分用户关键字。拥有更少数据的更多表，理想情况下在不同的服务器上进行分布式查找，其中切片或用户范围存在于不同的切片上。Aka，所有 usera 的数据都存在于切片 1 上，userb 存在于切片 2 上，等等。

其次，我有某种内存哈希表来确定关键字的存在。这也可能被联合起来分发查找。对于 n 个存在关键字的服务器，对关键字进行哈希处理并将其修改为 n，然后将这些关键字的范围分布在所有 memcached 服务器上。这种快速方法可以让您说正在监视关键字 x，对其进行哈希处理并确定它将在哪个服务器***上***运行。然后进行查找并收集/聚合被跟踪的关键字。

到那时，您至少会知道哪些关键字正在被跟踪，并且您可以获取用户切片并执行后续查找以确定哪些用户正在跟踪哪些关键字。

简而言之：**SQL 在这里不是一个理想的解决方案。**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-02T22:41:23.643

您是否考虑过使用[像 Sphinx](http://www.sphinxsearch.com/)这样的全文解决方案？

我在这里说的是我的帽子，因为我自己没有使用它。但它作为一种高速全文搜索解决方案受到了广泛关注。它可能比您使用的任何关系解决方案都具有更好的扩展性。

这是[一篇](http://capttofu.livejournal.com/13037.html)关于在 MySQL 中使用 Sphinx 作为全文搜索解决方案的博客。

# windows - 如何从源代码构建 Windows D3D9 refrast？

> ID：407905
> 
> 赞同：3
> 
> 时间：2009-01-02T20:13:39.417
> 
> 标签：windows, build, direct3d, wdk

Microsoft 将源代码分发给硬件供应商、驱动程序开发人员等，以参考其不同 Direct3D API 的实现。此代码使用永远神秘的 WDK（以前的 DDK）构建系统构建，并且几乎从不开箱即用。虽然被广泛使用，但此代码是半私有的，因此在更广泛的网络上永远没有任何基本的有用信息。这很常用（并且在这个社区中众所周知的痛苦），并且基本的构建信息足够不敏感，它应该可以在 Google 上发现。

构建自述文件建议使用 WDK 并使用命令进行构建`build -cz -daytona`。令人困惑的是，这会吐出一堆输出但什么也没有构建。

克服这个问题，带有 WDK 6001.18002 的 Vista，最新的 d3def9 源代码分发在`link`子项目中失败，“无法产生任何输出 - 警告被视为错误”。

XP d3dref9.dll 的构建也可能令人困惑，经常找不到 D3D 标头和类型。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T20:21:21.053

由于直接来自 Microsoft，在构建 refrast source drop 时通常存在两个非常常见的主要问题。

首先，该`build -cz -daytona`命令要么是拼写错误，要么依赖于未记录的附加外部配置。在此模式下构建会解析所有源代码，但从不指定要构建的平台。由于指定实际输出的所有平台`dirs`（`daytona`和`win9x`）都是“可选的”，因此实际上没有构建任何内容。对此的解决方案是使用正确指定的命令`build -cz daytona`（没有 ' `-`' on `daytona`）。这应该解析源代码，然后实际*构建*所有内容。

除此之外，开箱即用的构建设置通常也存在问题。

新的 WDK（例如在 Vista 上）通常在最后的链接步骤中失败，并出现虚假链接器错误。通过添加以下内容可以轻松解决此问题：

```
LIBRARIAN_FLAGS = $(LIBRARIAN_FLAGS) /IGNORE:4001 
```

到`link/sources.inc`构建文件。在此之后，`build -cz daytona`在源drop 的根目录中应该构建和链接所有开箱即用的东西。

在 XP 上，如果使用较旧的 DDK（Windows Server 2003 之前的版本，即带有“XP”标签的 DDK），也会出现问题。特别是，refrast 项目依赖于外部存在的核心 D3D9 标头，这些不包含在 XP DDK 中。只需使用最新的 WDK（从 XP 后的“DDK”重新命名）即可解决此问题。与命名相反，所有较新的 WDK 通常都是旧版本的超集，因此包括通过 XP 支持平台的构建环境。

某些 XP refrast 源版本也可能存在问题，包括在较新的 WDK 编译器版本中触发更多迂腐编译器错误的代码。然而，这些通常可以通过迭代编译和源代码调整来轻松修复，以响应编译器引发的任何简单的安全/正确性错误。

# reflection - 仅加载一次程序集

> ID：407906
> 
> 赞同：2
> 
> 时间：2009-01-02T20:13:53.003
> 
> 标签：reflection, assemblies, loading, assembly.load

我在运行时加载程序集，每次调用代码时出现的问题是我是否应该检查该特定程序集是否已经加载？还是.Net 会处理这个问题并且一个程序集（相同版本）只能加载一次？这里的基本问题是我是否必须遍历已加载程序集的列表并查看我的程序集是否已加载？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-02T20:19:35.050

引用[MSDN](http://msdn.microsoft.com/en-us/library/1009fa28.aspx)：“如果已经加载了具有相同标识的程序集，即使指定了不同的路径，LoadFrom 也会返回加载的程序集。”

# xml - 是否有 XSLT 伙伴可用？

> ID：407910
> 
> 赞同：32
> 
> 时间：2009-01-02T20:16:04.263
> 
> 标签：xml, xslt

我想很多人都知道 RegexBuddy 之类的工具。XSLT 有类似的东西吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-02T21:41:31.640

*XSLT IDE*（交互式开发环境）：

*   **[XSelerator](http://sourceforge.net/projects/xselerator)**（我已经使用了 6-7 年的那个）。免费，具有 MSXML 调试器，具有 XSLT 1.0 和 XSLT 2.0 的智能感知。此外还有一些动态智能感知。调试器有断点、数据断点、可视化临时树、变量、测试条件、当前输出……等。
*   **[VS2008——](http://www.microsoft.com/visualstudio/default.mspx)**一个很好的 XML 编辑器 + XSLT 调试器。良好的静态智能。匹配模式是静态检查的。断点、数据断点、变量和当前输出的可视化。
*   **[氧](http://www.oxygenxml.com/)**
*   **[XML-SPY](http://www.altova.com/products/xmlspy/xml_editor.html) (Altova)**
*   **[手写笔工作室](http://www.stylusstudio.com/)**

*XPath 工具*：

*   **[XPath Visualizer](http://www.huttar.net/dimitre/XPV-Zip-2008.zip)** —— 一个通过玩 XPath 表达式来学习 XPath**的**[**流行工具。**](http://www.huttar.net/dimitre/XPV/TopXML-XPV.html)免费和开源。允许针对给定的 XML 文档评估任何 XPath 表达式，并在 xml 文档（如果它们是节点）或单独的框中（如果结果是原子值）中高亮显示结果。允许定义 xsl:variable-s，然后在 XPath 表达式中使用。允许定义 xsl:key-s，然后由 XPath 表达式中的 key() 函数引用。

**编辑**：由于 Lars Huttar 的善意，XPath Visualizer 现在有了一个**[新的、更安全的家。](http://www.huttar.net/dimitre/XPV/TopXML-XPV.html)**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T20:40:28.097

这是我所知道的最接近免费的：[XML Copy Editor](http://xml-copy-editor.sourceforge.net/)

Altova XML Spy 非常好，但价格昂贵。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-02T20:59:23.303

如果您只想试验 XSLT 表达式，[Orbeon Forms 中有一个沙箱](http://ogres.sandre.eaufrance.fr/orbeon/sandbox-transformations/xslt/)。显然，RegexBuddy 中还有许多其他功能无法与之媲美，但它是一种很好的交互方式，可以处理您尝试调试的一些奇怪的 XSLT 表达式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-02T22:07:38.657

我过去使用[过 Architag XRay](http://www.softpedia.com/get/Office-tools/Other-Office-Tools/XRay-XML-Editor.shtml "Architag X 射线")（我现在有[oXygen](http://www.oxygenxml.com/ "氧")）。XRay 是免费且轻量级的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T22:46:45.427

还有您的游击选项，有漏洞且看似不受支持的免费家庭最爱：[XML 灶具](http://www.xmlcooktop.com/)

# eclipse - 如何更改 Eclipse 以使用空格而不是制表符？

> ID：407929
> 
> 赞同：925
> 
> 时间：2009-01-02T20:21:47.543
> 
> 标签：eclipse, formatting, tabs, whitespace

默认情况下， [Eclipse](http://en.wikipedia.org/wiki/Eclipse_%28software%29)使用硬制表符缩进。如何将其更改为空格？

* * *

## 回答 #1

> 赞同：1272
> 
> 时间：2009-01-03T01:32:54.310

### Java 编辑器

1.  单击**窗口**»**首选项**
2.  展开**Java** »**代码风格**
3.  单击**格式化程序**
4.  单击**编辑**按钮
5.  单击**缩进**选项卡
6.  在**General Settings**下，将**Tab policy**设置为：`Spaces only`
7.  单击“**确定**”以应用更改。

[***注意***：如有必要，使用新名称保存配置文件作为默认配置文件不能被覆盖。]

### 默认文本编辑器

3.6 版之前：

```
Window->Preferences->Editors->Text Editors->Insert spaces for tabs 
```

版本 3.6 及更高版本：

1.  单击**窗口**»**首选项**
2.  展开**一般**»**编辑**
3.  单击**文本编辑器**
4.  检查**为制表符插入空格**
5.  单击“**确定**”以应用更改。

请注意，默认文本编辑器用作 Eclipse 中许多非 Java 编辑器的基础。令人惊讶的是，此设置直到 3.3 才可用。

### C / C++

1.  单击**窗口**»**首选项**
2.  展开**C/C++** »**代码风格**
3.  单击**格式化程序**
4.  单击“**新建”**按钮创建新配置文件，然后单击“**确定**”继续
5.  单击**缩进**选项卡
6.  在**General Settings**下，将**Tab policy**设置为：`Spaces only`
7.  单击“**确定**”以应用更改。

### HTML

1.  单击**窗口**»**首选项**
2.  展开**网络**» **HTML 文件**
3.  单击**编辑器**
4.  在**Formatting**下，选择**Indent using spaces**单选按钮
5.  单击**确定**以应用更改。

### CSS

对 HTML 遵循相同的说明，但选择**CSS Files**而不是**HTML Files**。

### JSP

默认情况下，JSP 文件遵循 HTML 文件的格式首选项。

### XML

XML 文件间距在首选项中配置。

1.  单击**窗口**»**首选项**
2.  展开**XML** » **XML 文件**
3.  单击**编辑器**
4.  使用空格选择**缩进**
5.  如果需要，您可以指定**缩进大小**：缩进的空格数。

* * *

## 回答 #2

> 赞同：155
> 
> 时间：2011-05-25T04:52:08.127

对于默认文本编辑器：

*   **通用**»**编辑器**»**文本编辑器**» `Insert spaces for tabs` *（检查）*

* * *

对于 PHP：

*   **PHP** »**代码风格**»**格式化程序**» `Tab policy` *（选择“空格”）*
*   **PHP** »**代码风格**»**格式化**程序» `Indentation size` *(设置为 4)*

* * *

对于 CSS：

*   **网页**» **CSS** »**编辑器**» `Indent using spaces` *（选择它）*
*   **网页**» **CSS** »**编辑器**» `Indentation size` *(设置为 4)*

* * *

对于 HTML：

*   **网页**» **HTML** »**编辑器**» `Indent using spaces` *（选择它）*
*   **网页**» **HTML** »**编辑器**» `Indentation size` *（设置为 4）*

* * *

对于 XML：

*   **XML** » **XML 文件**»**编辑器**» `Indent using spaces` *（选择它）*
*   **XML** » **XML 文件**»**编辑器**» `Indentation size` *（设置为 4）*

* * *

对于 Javascript：

*   **Javascript** »**首选项**»**代码样式**»**格式化程序**»**编辑**» `Indentation` *（选择“仅空格”）*
*   重命名格式化程序设置配置文件以保存它

* * *

对于 Java：

*   **Java** » **Preferences** » **Code Style** » **Formatter** » **Edit** » `Indentation` *（选择“仅空格”）*
*   重命名格式化程序设置配置文件以保存它

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-01-02T20:24:02.467

从[在 eclipse 中将制表符更改为空格](http://blog.dotkam.com/2007/03/21/changing-tabs-to-spaces-in-eclipse/)：

**窗口**»**首选项**» **Java** »**代码样式**»**格式化**程序»**编辑**» `Indentation` *（选择“仅限空格”）*

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2011-03-19T14:56:04.113

对于**CDT**：

*   *转到* **窗口/首选项**» **C/C++** »**代码样式**»**格式化**程序»**新建**
*   *创建一个新的，因为内置配置文件无法更改*
*   **MyProfile** *（为配置文件选择一个名称）*
*   **缩进**» `Tab Policy` *（仅选择空格）*

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2012-06-26T18:50:07.007

只是为偶然发现此线程的人们提供的快速提示；在您的项目中，还有**一个地方**也可以设置此设置！

Eclipse 支持特定于项目的设置，一些项目将使用它们自己的、非托管的选项卡/空格设置，这些设置除了当前项目的属性外不会显示在任何地方。

这可以通过以下方式进行管理：

*   **在包资源管理器**中右键单击当前项目
***   **属性**» **Java 代码风格***   关闭所有项目特定*的*选项**

 **如果您将其他人的代码导入到您的 Eclipse 中，这通常只会成为问题。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2014-10-01T05:32:20.203

**对于默认编辑器：**

**窗口**»**首选项**»**编辑器**»**文本编辑器**»`Insert spaces for tabs`

![在此处输入图像描述](https://i.stack.imgur.com/VwuRQ.png)

**对于 Java 编辑器**

**窗口**»**首选项**» **Java** »**代码样式**»**格式化**程序»**编辑**»**缩进**» `Tab policy` *“仅限空格”*

![在此处输入图像描述](https://i.stack.imgur.com/OTqIq.png)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-02-21T18:52:28.090

当我遇到这个问题时，我在所有我能找到的地方都将“使用制表符的空格”设置为 true，但我仍然得到制表符。最终是因为制表符在文件的其他地方使用，并且它试图进行智能缩进或令人沮丧的事情。

通过选择文件的全部内容并在 Mac 上按`command+shift+f`. 这会将给定的格式应用于文件。我不知道 Windows 上的相同键绑定，但试试看。那时我开始得到预期的行为。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2018-06-26T15:04:46.573

转到*Window* -> *Preferences*并键入*tab*作为搜索文本（将显示如下所示的对话框）：

[![在此处输入图像描述](https://i.stack.imgur.com/pkVWg.png)](https://i.stack.imgur.com/pkVWg.png)

转到突出显示的部分以更改选项卡策略。对于*编辑器*设置，它主要是*使用空格缩进*（也如上所示）。

对于*格式化*程序设置，您需要编辑活动配置文件并更新*选项卡策略*（在 `*缩进*->*常规设置*下可用：

[![在此处输入图像描述](https://i.stack.imgur.com/AsW1N.png)](https://i.stack.imgur.com/AsW1N.png)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-07-20T17:41:46.090

请务必检查 java 格式化程序，因为它会覆盖**“为制表符插入空格”**设置。去：

`Java->Code Style"->Formatter->Edit->Identation`

注意：您需要创建一个自定义格式才能保存您的配置。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2014-05-19T07:05:49.127

**面向 C/C++ 开发人员的 Eclipse IDE，版本：Helios Service Release 2**

您需要通过按“窗口->首选项->代码样式”中的新建按钮来创建新的配置文件

转到缩进选项卡并选择“选项卡策略 = 仅空格”

* * *

**面向 C/C++ 开发人员的 Eclipse IDE，版本：Kepler Service Release 1**

按照以下路径创建新配置文件：“Window > Preferences > C/C++ > Code Style > Formatter”

转到缩进选项卡并选择“选项卡策略 = 仅空格”

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-07-05T18:39:44.800

我发现这个问题的解决方案非常简单，并且始终有效。它是更改 eclipse 设置文件。

例如（更改 HTML 缩进大小）：

* * *

1.  找到`org.eclipse.wst.html.core.prefs`应该在的文件`your_workspace/.metadata/.plugins/org.eclipse.core.runtime/.settings/`
2.  添加/更改到文件中的行：

```
indentationChar=space

indentationSize=4 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-09-03T05:26:32.810

在 Eclipse 中，转到**Window** » **Preferences**然后搜索**Formatter**。

您将看到各种粗体链接，单击每个粗体链接并将其设置为`use spaces`而不是`tabs`.

在 java 格式化程序链接中，您必须`spaces only`在缩进选项卡中编辑配置文件并选择选项卡策略

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-06-25T23:57:52.437

Window->Preferences->Java->Code Style->Formatter->Edit->Indentation = "Spaces Only"

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-02-02T20:40:54.313

## 在eclipse格式的xml中：

### 对于选项卡：

```
<setting id="org.eclipse.jdt.core.formatter.tabulation.char" value="tab"/> 
```

### 对于空间：

```
<setting id="org.eclipse.jdt.core.formatter.tabulation.char" value="space"/> 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-04-19T16:55:58.977

不要错过两者的制表策略 * 仅限空格 * 使用空格缩进换行

我只检查了后者，并将组合框保留为仅选项卡，这一直失败 CheckStyle.. 仅供参考，我说的是首选项 > Java > 格式化程序 > 编辑...

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-12-18T13:21:20.217

还可以考虑使用 .editorconfig 文件：[https](https://marketplace.eclipse.org/content/editorconfig-eclipse) ://marketplace.eclipse.org/content/editorconfig-eclipse 。不使用 Eclipse 的人也可以从中受益，在最坏的情况下，它可以作为指导。注意：我不会进入制表符与空间大战，而是使用空格 FTW :-)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-01-15T05:17:07.390

您绝对可以使用 XML 文件来配置您的编码风格的格式化程序。格式化程序文件可帮助您在团队成员中拥有相同的编码风格和准则。

**即使您在使用Eclipse**编码时可能使用速记键，在下面添加这些设置变量也会有`a tab= 2 spaces`并转换为空格。`Tab`

 **```
<setting id="org.eclipse.jdt.core.formatter.tabulation.size" value="2"/>
<setting id="org.eclipse.jdt.core.formatter.tabulation.char" value="space"/>    
<setting id="org.eclipse.jdt.core.formatter.use_tabs_only_for_leading_indentations" value="yes"/> 
```

最好的，

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-03-19T05:05:14.343

在 Mac OS X 上的 Eclipse mars (EE) 中，我可以在首选项中找到它的唯一方法是打开首选项对话框并键入 Formatter，然后选择 Java->Code Style->Formatter。

**Java->Code Style 无法访问 Formatter！**

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-06-26T02:22:13.483

不要忘记**ANT 编辑器**

由于某种原因，Ant Editor 没有出现在搜索结果中，`'tab'`因此`'spaces'`可能会被遗漏。

在**Windows** >**首选项下**

*   **Ant** » **Editor** » **Formatter** » `Tab size:` *(设置为 4)*
*   **Ant** » **Editor** » **Formatter** » `Use tab character instead of spaces` *（取消选中它）*

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-09-02T16:22:45.643

*   单击窗口 » 首选项
*   展开 Java » 代码风格
*   单击格式化程序
*   点击新建
*   选择个人资料名称
*   点击确定
*   单击编辑按钮
*   单击缩进选项卡
*   在常规设置下，将选项卡策略设置为：仅限空格
*   单击确定。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-04-30T22:18:17.060

作为对其他答案的补充，在 Mac OS X 上，“首选项”菜单位于 Eclipse 下，**而不是**Window（与 Windows/Linux Eclipse 发行版不同）。其他一切仍然与过去其他答案所指出的相同。

IE：Java Formatter 可用于：

```
Eclipse >      | # Not Window!
Preferences >  |
Java >         |
Code Style >   |
Formatter      | 
```

从这里，编辑格式化程序，并且可以在“缩进”下设置选项卡策略。

# c# - ASP.NET/C# - 自定义 PerformanceCounters 仅显示在 64 位系统上的 32 位 perfmon

> ID：407930
> 
> 赞同：1
> 
> 时间：2009-01-02T20:22:58.290
> 
> 标签：c#, asp.net, performancecounter

我正在尝试创建一组供我的 ASP.NET 应用程序使用的自定义性能计数器。我使用以下代码来增加计数器：

```
internal static void Increment(String instanceName, DistributedCacheCounterInstanceType counterInstanceType)
{
    var permission = new PerformanceCounterPermission(PerformanceCounterPermissionAccess.Write, Environment.MachineName, "CounterName");
    permission.Assert();

    var counter = new PerformanceCounter("CategoryName", "CounterName", instanceName, false);
    counter.RawValue++; // Use RawValue++ instead of Increment() to avoid locking
    counter.Close();
} 
```

这在单元测试中以及在我的开发盒（Vista Business x64）上的 Cassini 中都非常有效，并且我可以观察在性能监视器中工作的计数器。但是，在我的生产环境（Win Server 2003 x64）中，计数器似乎没有记录任何增量。计数器实例本身是可用的，但它们都只显示“--”用于最后/平均/最小/最大显示。

关于我可能做错了什么的任何想法？

**编辑：**这[是我用作参考的 [可能有些过时的] MSDN 文章](http://msdn.microsoft.com/en-us/library/ms979204.aspx#scalenethowto12_topic5)

**编辑 2：**我正在使用 VS 2008/.NET Framework v3.5 SP1，如果这有什么不同的话。

**编辑 3：**刚刚发现[这篇关于 32 bit/64 bit app and monitor mismatching](http://www.improve.dk/blog/2008/04/01/missing-asp-net-performance-counter-values)的文章，但我不确定它如何适用于我的情况，如果有的话。Cassini 确实是一个 32 位应用程序，但我在 64 位系统上查看值没有问题。在我的生产服务器上，应用程序和系统都是 64 位的，但我看不到值。

**编辑 4：**当我在生产服务器上运行 32 位 perfmon 时，*会*显示这些值。所以我想现在的问题是为什么我不能读取 64 位 perfmon 中的值？

**编辑 5：**它实际上似乎在工作，只是我不得不重新启动我的 perfmon 实例，因为它在创建计数器之前是打开的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T15:32:26.647

我读到实例化 PerformanceCounter 非常耗费资源。您是否想过将这些缓存在 Session / Application 变量中？

此外，在不锁定多线程 ASP.net 应用程序的情况下更新计数器是否明智？

帕特里克

# asp.net - asp.net 的 __doPostBack 方法中的断点？

> ID：407934
> 
> 赞同：0
> 
> 时间：2009-01-02T20:24:34.743
> 
> 标签：asp.net

放置“调试器”的最佳方式是什么？__doPostBack 方法中的语句还是方法中的步骤？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T20:29:25.140

__doPastBack 仍然是在浏览器中运行的 javascript。

虽然可以使用 Visual Studio 和 IE 调试 javascript，但如果要设置断点，则需要能够在 Visual Studio 中打开 javascript。您可以为 __doPostBack 执行此操作，因为它是由编译器生成的。

但是，如果您在 firefox 中查看页面，您可以使用 firebug 扩展在页面加载后在浏览器中设置断点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T20:34:39.950

在 IE 中，您可以转到 Internet 设置 -> 高级 -> 并取消选中“禁用 Javascript 调试”框。这将允许您在 JS 代码中放置断点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T20:45:14.437

`iexplore.exe`您可以作为脚本调试器手动附加到进程，并***在生成的页面上***相应地设置断点。或者，如果您在 Internet 选项的高级选项卡中启用了脚本调试，则可以通过从菜单中选择选项随时进入调试器

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T01:23:50.053

在 FireFox 中使用 FireBug 确实要容易得多，而且您不必经历很多废话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T01:27:21.327

JS 调试和 FireFox（我经常使用）的另一个选择是使用 venkman。您可以[在此处将其作为 FF 扩展名获取。](https://addons.mozilla.org/en-US/firefox/addon/216)

# sql-server - 如何测试 SQL Server 触发器中的多行操作？

> ID：407935
> 
> 赞同：7
> 
> 时间：2009-01-02T20:25:13.650
> 
> 标签：sql-server, database

我幼儿园的 SQL Server 告诉我，在插入和删除的伪表中可能会触发多行触发器。我在编写触发代码时大多考虑到这一点，通常会导致一些基于光标的混乱。现在我真的只能测试它们一次发射一行。如何生成多行触发器，SQL Server 是否真的会发送多行触发器？我可以设置一个标志以便 SQL Server 只触发单行触发器吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-03T00:22:42.393

触发器定义应始终处理多行。

取自[SQLTeam](http://weblogs.sqlteam.com/tarad/archive/2004/09/14/2077.aspx)：

```
-- BAD Trigger code following:

CREATE TRIGGER trg_Table1 
ON Table1 
For UPDATE
AS
DECLARE @var1 int, @var2 varchar(50)

SELECT @var1 = Table1_ID, @var2 = Column2
FROM inserted

UPDATE Table2
SET SomeColumn = @var2
WHERE Table1_ID = @var1 
```

**上述触发器仅适用于插入表中的最后一行。**

这就是你应该如何实现它：

```
CREATE TRIGGER trg_Table1 
ON Table1 
FOR UPDATE
AS

UPDATE t2
SET SomeColumn = i.SomeColumn
FROM Table2 t2
INNER JOIN inserted i
ON t2.Table1_ID = i.Table1_ID 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T20:42:50.013

是的，如果一条语句影响多行，它应该由一个触发器调用处理，因为您可能希望恢复整个事务。不可能在逻辑上将其拆分为单独的触发器调用，我不认为 SQL Server 提供了这样的标志。您可以通过发出影响多行的 UPDATE 或 DELETE 语句，使 SQL Server 使用多行调用您的触发器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T18:47:49.963

首先，我担心您正在使用游标使触发器处理多行。不要那样做！使用基于集合的语句来代替插入或删除的伪表。在我来这里工作之前，有人将其中一个基于光标的触发器放在我们的数据库中。处理 400,00 条记录插入需要 40 多分钟（而且我经常需要为一个客户在此表中插入超过 100,000 条记录）。将其更改为基于集合的解决方案将时间更改为不到一分钟。虽然所有触发器都必须能够处理多行，但您不能通过制造性能噩梦来做到这一点。

如果您可以为 cusor 编写 select 语句，则可以基于基于 set 的相同 select 语句编写插入、更新或删除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T20:32:02.343

我一直编写我的触发器来处理多行，据我了解，如果一个查询插入/更新/删除了多行，那么只有一个触发器会触发，因此您必须使用游标在记录中移动一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T20:46:48.287

一条 SQL 语句总是调用一个触发器执行——这是触发器定义的一部分。（这也是一种情况，似乎每个编写触发器的人至少都会绊倒一次。）我相信您可以通过检查@@ROWCOUNT 发现有多少记录受到影响。

# c# - 是否有正确的方法来检索 SQL 中的字符串字段

> ID：407947
> 
> 赞同：4
> 
> 时间：2009-01-02T20:33:34.850
> 
> 标签：c#, sql

我已经看到了从 SQL 中检索字符串字段的不同方法。有没有“正确”的方式，有什么区别

```
 SqlDataReader rdr;
  1\.  String field = (String) rdr["field"];
  2\.  String field = rdr["field"].ToString();
  3\.  String field = rdr["field"] As String; 
```

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T20:57:14.430

您还可以使用：

```
int ordinal=rdr.GetOrdinal("stringField");
if (rdr.IsDBNull(ordinal))
{
    return string.Empty; //Or null or however you want to handle it 
}
else
{   
   rdr.GetString(ordinal);
} 
```

如果您查看 SQlDataReader["field"] 的定义，则如下所示：

```
public override object this[string name]
{
    get
    {
        return this.GetValue(this.GetOrdinal(name));
    }
} 
```

本质上这是做同样的事情，只是它是类型安全的。我喜欢做的是创建我自己的包装 SqlDataReader 的 IDataReader。CSLA 使用他们称为 SafeDataReader 的类似机制，因为它为实现此模式的所有各种数据类型提供重载。

如果您知道该字段不会为空，则可以省略 isDbNull 检查。由于冗长，我建议将它放在某种类型的包装器或帮助器类中，并用它们制作函数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T20:36:14.520

1.  如果类型不是字符串，可能会导致异常
2.  绝对是错误的，因为如果值为 null，则可能引发异常。
3.  如果它是 null 或者它的类型不是字符串，将分配 null

所以，为了安全起见-我会选择3。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-02T21:03:31.903

请记住，问题与您的数据定义交互。如果“字段”已定义为“非空”，那么您不必担心空数据，应选择#1 以提高可读性。同样，如果该字段可以为空，但您在执行查询时使用了“IsNull”函数：

```
Select IsNull(Field1, '') as Field1 From DBTable Where... 
```

然后，您应该再次选择 #1，因为您仍然不必担心 null。当然，这假设您希望空值被空字符串屏蔽。如果您想针对 null 进行测试，因为它是一个错误条件，那么您的逻辑如下：

```
if (nwReader.IsDBNull(nwReader.GetOrdinal("Field1")))
    *throw exception or otherwise handle null condition
string aStr = (string)nwReader["field"]; 
```

然而，这最后一种情况并不是很好的做法。如果 null 是一个无效值——一个错误条件——那么你应该在你的 DDL 中排除它。

不过，最后，我总是选择选项 #1，因为我认为它会带来更好的可读性，并且它迫使我明确我的 null 处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T20:41:09.703

如果我期待一个字符串，我会做#1。如果由于某种原因该字段不是字符串或更改类型，您至少可以通过异常机制了解它。 *（只是不要将它包裹在 try / empty catch 中。）*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T07:10:01.040

我喜欢 ？？用于检查空值的运算符（如其他帖子中所述）

String field = rdr["field"] As String ?? 字符串.空

这应该有效。如果不是，那就晚了：P，除非你真的希望结果为空。如果是这样，那么我喜欢3。

# c - 在一元 & 中强制转换相关的无效左值

> ID：407953
> 
> 赞同：1
> 
> 时间：2009-01-02T20:35:25.597
> 
> 标签：c, gcc

我使用 gcc 3.4.6 得到了无效的左值错误。调用错误的行有一个函数，它接收指向 SetElement（即`typedef void*`）的指针。我正在尝试通过`typedef void*`以下方式使用另一种类型（也是）的强制转换来实现这一点`&((SetElement)my_var)`：gcc 对此抱怨。知道可以做什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T20:39:42.360

您正在获取临时地址 (an `rvalue`)，这是无法完成的。这就像尝试这样做：

```
&(2+2)
// or
&4
// or
&(my_ptr + 4) 
```

您可以使用以下两种方法之一自己创建一个临时文件（因此是`lvalue`）：

```
AnotherType **my_var_ptr = &my_var;
SetElement **set_element_ptr = (SetElement *)my_var_ptr;

// or

SetElement *set_element = (SetElement)my_var;
SetElement **set_element_ptr = &set_element; 
```

或者您可以简单地以不同的方式进行转换（**解决方案**）：

```
SetElement **set_element_ptr = (SetElement *)&my_var; 
```

这是有效的，因为您使用的是`my_var`(an `lvalue`) 的地址，而不是`(SetElement)my_var`(an `rvalue`) 的地址。

# ruby-on-rails - 你必须弄乱 Rails 的“routes.rb”文件吗？

> ID：407956
> 
> 赞同：9
> 
> 时间：2009-01-02T20:36:49.540
> 
> 标签：ruby-on-rails, configuration, rest, routes

`routes.rb`除了打电话`map.root`来设置默认路线外，我从来没有接触过。我一直满足于使用表单的 URL...

```
/controller/action/perhaps_an_id 
```

它工作正常。

这会让我成为一个坏人吗？我错过了一些非常棒的东西吗？

如果我尝试采用 RESTful 设计怎么办？这是否意味着我必须编辑`routes.rb`或者我可以继续愉快地忽略它？

（我试图在 The Rails Way 中阅读有关此主题的内容，但无法忍受。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-02T22:55:34.673

如果您使用默认的脚手架生成资源，那么它甚至会在 routes.rb 中为您包含 restful 路由。

如果您不使用脚手架，那么它工作的原因是因为默认情况下底部的默认路由：

```
 map.connect ':controller/:action/:id'
    map.connect ':controller/:action/:id.:format' 
```

我一直在遵循最好的做法是为生产应用程序删除这些，而是​​确保只公开需要公开的资源。使用 Rails 2.2，您甚至可以通过以下方式限制 map.resources 中的 RESTful 方法：

```
map.resources :posts, :only => [:index, :show]
map.resources :comments, :except => [:edit] 
```

您还可以使用嵌套资源、命名路由等做很多很酷的事情。文档中有很多示例（[http://www.railsbrain.com/api/rails-2.2.2/doc/index.html）。 html?a=M000255&name=resources](http://www.railsbrain.com/api/rails-2.2.2/doc/index.html?a=M000255&name=resources) )

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-02T20:53:48.977

没有切换到 RESTful 设计并不会让你成为一个坏人，如果你觉得没有必要改变，请继续以 1.x 的方式编写你的应用程序。

大多数 Rails 开发人员都采用了 REST，并且似乎对此感到非常高兴。我认为这里没有必要重复所有支持 REST 的论点。

您确实需要在路由文件中为每个资源添加一行，例如：

```
map.resources :posts 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T21:04:22.543

您可能还想为您的营销部门创建自定义命名路由（例如：mycoolsite.com/free-trial），这些路由会转到特定的控制器和操作等。

Ryan Bates 提供了一系列截屏视频，其中介绍了您可以对路线进行的一些巧妙操作：[http ://railscasts.com/tags/14](http://railscasts.com/tags/14)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T20:56:30.563

如果您要使用 RESTful，是的，您必须编辑 routes.rb 并添加您的资源，例如，

```
map.resources :your_resource 
```

或者如果您有嵌套资源，

```
 map.resources :people do |person|
      person.resources :ideas do |idea|
        ideas.resources :bad_ones
      end
    end 
```

# asp.net - asp.net 角色提供者何时生死？

> ID：407963
> 
> 赞同：4
> 
> 时间：2009-01-02T20:42:28.873
> 
> 标签：asp.net, roleprovider

我正在使用 asp.net 中的自定义角色提供程序，并且似乎一旦将提供程序加载到内存中，它就不会退出内存，直到重新启动 Web 应用程序（例如更改和保存 web.config 文件时） ）。此外，对该 Web 应用程序的所有请求似乎都使用了角色提供者的一个实例。

所以我的问题是：asp.net 什么时候创建角色提供者的实例？他们的寿命是多少？asp.net 什么时候创建新实例？**有没有办法通过删除旧实例并创建一个新实例来强制 asp.net 刷新当前提供程序实例？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T21:07:34.127

ASP.NET 的设计假定提供程序是无状态对象。因此，您应该以不需要知道它何时创建和何时终止的方式设计您的提供程序。基本上，如果您真的想这样做，您可以将实际逻辑放在不同的类中，它的创建和处置将由您引入 ASP.NET 的代理类处理。

此外，ASP.NET 不保证何时创建角色提供程序对象。这有点像静态构造函数。您应该只依赖于它们在需要时确实存在的事实。

# vb.net - 如何在 VB.NET 中播放 MP3 并确定播放的 MS？

> ID：407964
> 
> 赞同：1
> 
> 时间：2009-01-02T20:42:34.257
> 
> 标签：vb.net

我需要在生成动画时在后台播放 MP3。音频驱动动画时间线，因此我必须从文件开头跟踪 MS 以保持同步。在 VB6 中，我使用了 MMControl，它以一定的时间间隔引发一个事件，并且可以从头开始计算帧数以始终确定我的位置。只是想不出 .Net 的方式来做到这一点。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T20:49:15.537

由于 VB6 中的 MMControl 只是一个 COM 对象，因此我建议使用相同的对象，因为它过去对您有用。

以下文章似乎展示了如何做到这一点： [http ://www.c-sharpcorner.com/UploadFile/xxxpluto/MultimediaControls11182005001632AM/MultimediaControls.aspx](http://www.c-sharpcorner.com/UploadFile/xxxpluto/MultimediaControls11182005001632AM/MultimediaControls.aspx)

让我知道这是否有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-02T21:20:31.653

谢谢，

在 MicroSofts 网站上找到了这个在后面的代码中声明 com 对象。

[http://msdn.microsoft.com/en-us/library/bb262248(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb262248(VS.85).aspx)

看起来是解决问题的简单方法。猜猜我正在努力寻找 .Net 解决方案。

# c# - 何时使用浮点数

> ID：407970
> 
> 赞同：42
> 
> 时间：2009-01-02T20:46:54.573
> 
> 标签：c#, types, floating-point

几年前，我学到了关于浮点数精度问题的艰难方法，所以我放弃了使用它们。但是，我仍然会遇到使用浮点数的代码，这让我感到畏缩，因为我知道有些计算会不准确。

那么，什么时候适合使用浮点数呢？

**编辑：** 作为信息，我不认为我遇到过一个数字的准确性并不重要的程序。但我有兴趣听听例子。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-01-02T20:53:36.090

简短的回答：只有当你确切地知道你在做什么以及为什么时，你才需要使用**浮点数。**

长答案：据我所知，**浮点数**（而不是**doubles**）在 3D API 之外不再真正使用。浮点数和双精度数在现代 CPU 上具有相同的性能特征，双精度数更大一些，仅此而已。如果有疑问，请使用双精度。

哦，是的，当然，使用**小数**进行财务计算。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-02T20:53:51.910

在一般情况下，所有浮点计算都是不准确的，浮点数比双精度数还要多。如果您想了解更多信息，请阅读 [每个计算机科学家应该了解的关于浮点运算的知识](http://docs.sun.com/source/806-3568/ncg_goldberg.html)

至于何时使用浮点数——通常在精度不如节省内存重要时使用。例如视频游戏中的简单粒子模拟。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-03T15:09:20.043

首先，如果您想精确表示十进制值，切勿使用浮点数或双精度数 - 使用整数类型（int、long 等）或小数（它只是具有比例因子的整数类型）。浮点数和双精度数在内部转换为以 2 为底的指数表示，而以 10 为底的指数表示精确表示的数字通常不能精确表示。（例如，数字 10 仅由浮点数或双精度数近似表示）。

其次，就精度而言，这取决于您的需求。我不同意你的观点，即从来没有计算精度无关紧要。您通常有一个特定的需求，即您的最终结果准确地说是 3 位数。如果您的输入只有有限的准确度，那么寻找可能的最高精度是没有意义的 - 比如说您称重约 5 克面粉，而您的秤的准确度只有 0.5 克。也就是说，中间计算通常受益于更高的精度，但如果经常速度的话，这比高精度更重要。

第三，在执行一系列计算时，比如在一个循环中，你需要知道在处理任何不精确的计算时你在做什么——你会产生四舍五入的错误，一些算法可能无法达到任何精确度的答案. 详细了解这些问题可能需要一门数值分析课程。这不取决于您为计算选择浮点数还是双精度数。

对于浮点计算，我通常会使用双精度数，因为它们比浮点数更通用、更快。但是，浮点数更小，如果您需要存储大量浮点数，则可以选择它们来防止由于缓存未命中而导致的性能问题。

据我所知，硬件支持双精度浮点处理，但浮点数不支持浮点处理，因此使用浮点数会导致转换为双精度。但是，在传递浮点数时迭代计算值时，某些例程会更快停止，因为这意味着您只需要大约 8 位精度，而双精度大约需要 16 位。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-02T20:50:10.840

在很多情况下，您会想要使用`float`. 然而，我不明白的是你可以使用什么。如果您的意思是使用`double`而不是`float`，那么是的，在大多数情况下，您想要这样做。但是，`double`也会有精度问题。`decimal`只要准确性很重要，您就应该使用它。

`float`并且`double`在许多应用中非常有用。`decimal`是一种昂贵的数据类型，它的范围（它可以表示的最大数的大小）小于`double`. 计算机通常对这些数据类型具有特殊的硬件级别支持。它们在科学计算中被**大量使用。**基本上，它们是您要使用的主要小数数据类型。然而，在精确度极其重要的货币计算中，这是可行`decimal`的方法。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-02T21:09:08.523

我能想到的最常见的原因是节省空间。并不是说这通常值得担心，但在某些情况下它很重要。float 占用的内存是 double 的一半，因此您可以在同一空间中获得两倍的内存。例如，我有一个数字数组，它太大而不能作为双精度数放入 RAM，但适合作为浮点数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-20T17:45:15.753

事实上，使用 32 位浮点数（即“单精度”）仍然很常见：图形应用程序和打印。

另一个原因是带有 GPU 的显卡。数据类型越小，操作越快，因为必须传输的位越少。整数数据类型在高动态范围图像方面存在问题：眼睛能够在 1: 10^13 的亮度范围内工作，并且可以识别 ca。4000级。因此，虽然整数数据类型可以存储级别数，但它们无法存储背景亮度，而浮点数则没有问题。事实上，IEEE 754R 允许使用 16 位和 10 位尾数的新“半精度”浮点数，这会损失一些精度，但会允许更快的速度。OpenGL 和 DirectX 例如广泛使用浮点数。眼睛对伪影非常宽容，所以那里没有问题。

所有其他基于图形的媒体都继承了浮动作为方便的措施。尾数有 24 位，因此允许 2^24 = 16,7 百万个连续步骤。如果您有一台分辨率为 2000 dpi 的打印机，您仍然可以打印 213x213 米的纸张。精度绰绰有余。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-03T07:41:52.023

使用 float 来表示**性能和大小**。如果您可以管理精度损失。

虽然现代处理器确实需要相同的时间来处理单精度和双精度操作，但如果使用带有 SIMD（x86 上的 MMX/SSE/等）指令的浮点数，有时可以获得*两倍的吞吐量。*

SSE 寄存器为 128 位宽，可容纳*4 个浮点数*或*2 个双精度*数。因此，如果使用得当，您可以使用浮点数执行两倍于双精度数的操作。

在处理非常大的数据集时，减小大小（4 个字节而不是 8 个字节）变得很重要（并且由于缓存等原因，减小大小通常也会提高性能）

# cryptography - 椭圆曲线上的点数

> ID：407977
> 
> 赞同：7
> 
> 时间：2009-01-02T20:49:45.957
> 
> 标签：cryptography, elliptic-curve

如果您有以下形式的椭圆曲线：

```
y^2 = x^3 + a*x + b  (mod p) 
```

有没有一个好的程序来计算这条曲线上的点数？

我已阅读有关 Schoof 和 Schoof-Elkies-Atkin (SEA) 算法的信息，但我正在寻找开源实现。有谁知道可以做到这一点的好程序？

此外，如果 a 为 1，b 为 0，则无法使用 SEA 算法，因为 j 不变量为 0。这是正确的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T05:14:44.300

你听说过[圣人](http://sagemath.org/)吗？

Sage 包括 Pari，这是一个数论的开源软件包。Pari 有一个 SEA 的实现。

来自[http://wstein.org/papers/2008-bordeaux/sphinx/elliptic_curves.html#schoof-elkies-atkin-point-counting](http://wstein.org/papers/2008-bordeaux/sphinx/elliptic_curves.html#schoof-elkies-atkin-point-counting)：

```
sage: k = GF(next_prime(10^20))
sage: E = EllipticCurve(k.random_element())
sage: E.cardinality()                   # less than a second
100000000005466254167 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-03-17T14:34:13.860

为此，我也一直在使用 Mike Scotts 程序（miracl）。只是好奇，我可能会问：您可以使用该软件生成的具有主要组顺序的域有多大？我升到了 1024 位，现在退出了，因为我需要我的办公室 PC 来连续数周运行点计数软件以外的东西。您是否制作了更大的域？如果是这样，我会很高兴获得域参数，如果您没有异议，请将它们包含在我的 ECC 软件学术签名中。

我的域可以在这里找到[ECC 域页面](http://www.fh-wedel.de/~an/crypto/accessories/domains_anders.html)。使用它们的软件可从此处访问[手册，带有下载页面的链接](http://www.fh-wedel.de/~an/crypto/Academic_signature_eng.html)

问候。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T14:03:46.527

我试过圣人。我花了大约 3-4 个小时编译到 x64 ubuntu。这似乎是一个很好的程序。但是当 j-invariant 为 0 时，不能使用 SEA 算法，如果 p/k 使用较大的值，似乎会出现一些问题。

在搜索了更多之后，我还发现了 miracl：[http](http://www.shamus.ie/index.php?page=elliptic-curves) ://www.shamus.ie/index.php?page=elliptic-curves 他们对普通的 Schoof 和 SEA 算法都有实现。但是这个程序在使用大输入值时也存在一些问题。运行 3-4 小时后，它崩溃了：/。我试图修复它，目前它正在再次运行，所以希望它会起作用。

编辑：它现在工作。上面链接中的程序与 Rasmus Faber 给出的程序相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T18:35:35.790

这里有一些链接： [P1363 草案部分的实现](http://grouper.ieee.org/groups/1363/P1363/implementations.html)（本页的回溯[备份链接](https://web.archive.org/web/20170114091037/http://grouper.ieee.org/groups/1363/P1363/implementations.html)）。

# php - PHP中的引用计数

> ID：407980
> 
> 赞同：2
> 
> 时间：2009-01-02T20:50:03.413
> 
> 标签：php, database, caching

我想基于引用计数在 PHP 中实现数据库缓存功能。例如，访问表`foo`中 ID 为 1 的记录的代码可能如下所示：

```
$fooRecord = $fooTable->getRecord(1); 
```

第一次调用它时，`$fooTable`从数据库中获取适当的记录，将其存储在内部缓存中，然后返回。任何后续调用都`getRecord(1)`将返回对内存中同一对象的另一个引用。`$fooRecord`当它销毁时发出信号`$fooTable`，如果没有剩余的引用，它会将任何更改存储回数据库并将其从缓存中删除。

问题是 PHP 的内存管理抽象出了关于引用计数的细节。我已经搜索了 PECL 和 Google 的扩展程序，但没有找到任何结果。所以问题 #1 是：这样的扩展存在吗？

在另一种方法中，$fooTable 返回一个超级偷偷摸摸的假对象。它通过转发`__call()`、`__set()`和来伪装成记录`__get()`，并且它的构造函数和析构函数为引用计数提供了适当的钩子。测试，效果很好，只是它破坏了类型提示。我所有期望 FooRecord 对象的方法现在都得到一个 Sneaky 对象，或者如果我想为我的*每个表*创建一个 Sneaky 的空子类，我可能会得到一个 FooSneaky ，但我没有。另外，我担心它会混淆维护程序员（比如我自己）。

问题 #2：我错过了另一种方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T21:08:11.863

对于 php5，只需使用记录类中的析构函数即可。

```
class Table {
    /* [...] */
    protected $record_cache = array();
    public function getRecord($id) {
        if(isset($this->record_cache[$id]) return $this->record_cache[$id];

        $r = $db->getRecord($id);
        if($r instanceof Record) {
            $this->record_cache[$id] = $r;
        }
        return $r;
    }

    public function _unregister($id) {
        unset($this->record_cache[$id]);
    }
}

class Record {
    /* [...] */
    function __destruct() {
        this->table->_unregister($this->id);
    }
} 
```

如果你不想在 Table 中有一个公共方法，你可能会使用一些回调技巧或其他一些聪明的 hack :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T15:40:36.860

标准 Internet 帮助论坛警告：我可能不完全理解您要做什么。

我不确定您的想法是否适合 PHP 请求/响应周期。传统上（CGI，mod_php），PHP 请求的生命周期看起来像

1.  用户对 PHP 页面发出 HTTP 请求
2.  PHP 页面（和所有包含的文件）被转换为 opt-code
3.  opt-code 被执行
4.  一旦循环完成，**一切都被丢弃**

这就是 PHP 在经验不足的程序员市场上表现出色的原因之一。即使是最可怕的编码应用程序也只能在请求的生命周期内挂起服务器。与 HTTP 有一些相似之处；PHP（某种程度上）是这样构建的，每个请求对任何其他请求一无所知。

我不太熟悉 fast-cgi 部署技术（例如，在 Zend 平台中使用），但据我了解，多个 PHP 进程将在内存中挂起以处理请求，然后会有一些魔法巫术会杀死根据需要关闭并重新生成进程。

更重要的一点是，通过引用计数来跟踪 PHP 对象在内存中的位置的想法对于 PHP 请求模型没有意义，这就是为什么你在那里找不到太多东西的原因。PHP 用户态中的缓存意味着使用单独的可编程系统，按照[memcached](http://www.danga.com/memcached/)或[APC](http://us3.php.net/apc)的方式为您处理内存管理的细节。缓存被抽象为一个简单的键/值对存储系统。

也就是说，如果你继续推进你的方法，我很想看看最终结果:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T20:59:16.470

你看过 PHP 中的简单缓存实现吗？例如，使用[Zend_Cache 之](http://framework.zend.com/manual/en/zend.cache.html)类的东西：

```
public function getRecord($id) {
     $cache = $this -> getCache(); //Retrieves an instanced Zend_Cache object or creates one
     $key = $this -> _name . $id; //_name is the table name and with the ID create a unique key

     if(!$result = $cache->load($key)) { 
         //Cache miss, query database
         $result = $this -> query(...);
         $cache->save($result, $key);
     }
     return $result;
} 
```

您可以自己轻松实现此缓存功能，或使用 Zend 之类的现成组件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T20:56:07.130

在我看来，您想要一些带有框架或 API 的[ORM 。](http://en.wikipedia.org/wiki/Object-relational_mapping)我没有使用过它，但我知道[ADOdb](http://phplens.com/lens/adodb/docs-active-record.htm)可以做到这一点。或者， [CakePHP](http://cakephp.org)使用 ORM，这可能是一个不错的选择。

# c# - C# 3.0 泛型类型推断 - 将委托作为函数参数传递

> ID：407983
> 
> 赞同：24
> 
> 时间：2009-01-02T20:50:53.583
> 
> 标签：c#, generics, delegates, c#-3.0, type-inference

我想知道为什么当 C# 3.0 编译器可以隐式地为同一方法创建委托时，当它作为参数传递给泛型函数时，它无法推断方法的类型。

这是一个例子：

```
class Test
{
    static void foo(int x) { }
    static void bar<T>(Action<T> f) { }

    static void test()
    {
        Action<int> f = foo; // I can do this
        bar(f); // and then do this
        bar(foo); // but this does not work
    }   
} 
```

我原以为我可以传递`foo`给`bar`并让编译器从传递的函数的签名中推断出类型，`Action<T>`但这不起作用。但是，我可以在不强制转换的情况下创建一个`Action<int>`from `foo`，所以编译器不能通过类型推断来做同样的事情是否有正当理由？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-02T21:00:10.773

也许这会让它更清楚：

```
public class SomeClass
{
    static void foo(int x) { }
    static void foo(string s) { }
    static void bar<T>(Action<T> f){}
    static void barz(Action<int> f) { }
    static void test()
    {
        Action<int> f = foo;
        bar(f);
        barz(foo);
        bar(foo);
        //these help the compiler to know which types to use
        bar<int>(foo);
        bar( (int i) => foo(i));
    }
} 
```

foo 不是一个动作 - foo 是一个方法组。

*   在赋值语句中，编译器可以清楚地分辨出你在说哪个 foo，因为指定了 int 类型。
*   在 barz(foo) 语句中，编译器可以分辨出您正在谈论的是哪个 foo，因为指定了 int 类型。
*   在 bar(foo) 语句中，它可以是任何带有单个参数的 foo - 所以编译器放弃了。

编辑：我添加了两种（更多）方法来帮助编译器找出类型（即 - 如何跳过推理步骤）。

从我阅读 JSkeet 回答中的文章来看，不推断类型的决定似乎是基于相互推断的场景，例如

```
 static void foo<T>(T x) { }
  static void bar<T>(Action<T> f) { }
  static void test()
  {
    bar(foo); //wut's T?
  } 
```

由于一般问题无法解决，因此他们选择将存在解决方案的特定问题保留为未解决。

由于此决定，您不会为方法添加重载，并且不会从所有用于单个成员方法组的调用者那里获得大量类型混淆。我想这是一件好事。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-02T21:05:37.033

理由是，如果类型扩展，则应该没有失败的可能性。即，如果将方法 foo(string) 添加到类型中，则它与现有代码无关——只要现有方法的内容不改变。

因此，即使只有一个方法 foo，对 foo 的引用（称为方法组）也不能转换为非类型特定的委托，例如`Action<T>`但只能转换为类型特定的委托，例如`Action<int>`.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-02T21:02:55.277

这有点奇怪，是的。用于类型推断的 C# 3.0 规范很难阅读并且有错误，但它*看起来*应该可以工作。在第一阶段（第 7.4.2.1 节）我认为有一个错误 - 它不应该在第一个项目符号中提及方法组（因为它们没有被显式参数类型推断（7.4.2.7）涵盖 - 这意味着它应该使用输出类型推断（7.4.2.6）。*看起来*它应该可以工作 - 但显然它没有:(

我知道 MS 正在寻求改进类型推断的规范，所以它可能会变得更清晰一些。我也知道，不管阅读它的难度如何，方法组和类型推断都有限制——当方法组实际上只是一个方法时，这些限制可能是特殊情况，诚然。

Eric Lippert 有一篇关于[返回类型推断不与方法组一起工作](http://blogs.msdn.com/ericlippert/archive/2007/11/05/c-3-0-return-type-inference-does-not-work-on-member-groups.aspx)的博客条目，这与这种情况*类似*——但这里我们对返回类型不感兴趣，只对参数类型感兴趣。不过，他的类型推断系列中的[其他帖子](http://blogs.msdn.com/ericlippert/archive/tags/Type+Inference/default.aspx)可能会有所帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-02T22:27:33.903

请记住，分配

```
Action<int> f = foo; 
```

已经有很多语法糖。编译器实际上为此语句生成代码：

```
Action<int> f = new Action<int>(foo); 
```

相应的方法调用编译没有问题：

```
bar(new Action<int>(foo)); 
```

Fwiw，帮助编译器推断类型参数也是如此：

```
bar<int>(foo); 
```

所以归结为一个问题，为什么赋值语句中的糖而不是方法调用中的糖？我不得不猜测这是因为分配中的糖是明确的，只有一种可能的替换。但是在方法调用的情况下，编译器编写者已经不得不处理重载解决问题。其中的规则相当详尽。他们可能只是没有解决它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-04T14:36:47.910

只是为了完整起见，这并不特定于 C#：相同的 VB.NET 代码同样失败：

```
Imports System

Module Test
  Sub foo(ByVal x As integer)
  End Sub
  Sub bar(Of T)(ByVal f As Action(Of T))
  End Sub

  Sub Main()
    Dim f As Action(Of integer) = AddressOf foo ' I can do this
    bar(f) ' and then do this
    bar(AddressOf foo) ' but this does not work
  End Sub
End Module 
```

错误 BC32050：无法推断“Public Sub bar(Of T)(f As System.Action(Of T))”的类型参数“T”。

# operators - 什么是原始的 Forth 运算符？

> ID：407987
> 
> 赞同：40
> 
> 时间：2009-01-02T20:52:11.227
> 
> 标签：operators, interpreter, vm-implementation, forth

我对实现一个 Forth 系统很感兴趣，这样我就可以获得一些构建简单 VM 和运行时的经验。

在开始使用 Forth 时，通常首先了解堆栈及其运算符（DROP、DUP、SWAP 等），因此很自然地将这些视为原始运算符。但他们不是。它们中的每一个都可以分解为直接操作内存和堆栈指针的运算符。后来学习了 store (!) 和 fetch (@)，它们可用于实现 DUP、SWAP 等（哈哈！）。

那么什么是原始运算符呢？哪些必须直接在运行时环境中实现，所有其他的都可以在其中构建？我对高性能不感兴趣；我想要一些我（和其他人）可以从中学习的东西。运算符优化可以稍后进行。

（是的，我知道我可以从图灵机开始，然后从那里开始。这有点极端。）

编辑：我的目标类似于引导操作系统或新编译器。我至少需要实现什么，以便我可以用这些原始构建块构建系统的其余部分？我不会在裸硬件上实现它；作为一项教育练习，我会编写自己的最小虚拟机。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-02T21:26:10.893

[该线程](http://newsgroups.derkeiler.com/Archive/Comp/comp.lang.forth/2005-09/msg00337.html)涵盖了您的确切问题。这是一个包含完整文档[的简单实现。](http://code.google.com/p/subtle-stack/downloads/detail?name=jonesforth.s.txt)

我在大学时编写了一个针对[68K的 Forth 线程子程序。](http://en.wikipedia.org/wiki/Motorola_68000_family)我定义了运行时环境和字典格式，然后编写了一些引导 Macintosh 应用程序的 C 代码，该应用程序加载了一个默认字典，填充了一些 I/O 向量并让代码运行。然后我拿了 Leo Brodie 的书《[开始](http://home.iae.nl/users/mhx/sf.html)》 ，开始用 68K 汇编语言实现基本字典。我从算术/逻辑字开始，然后是控制结构，然后是字定义/操作字。我的理解是，您至少需要@、!、+、-、* 和 /。其余的可以根据这些来实现，但这就像尝试基于`SetPixel`and编写一个完整的图形库`GetPixel`：它会工作，但是哎呀，为什么呢？

我喜欢这个过程，因为有一些非常有趣的谜题，比如`DOES>`完全正确（一旦我有一个可靠的`DOES>`实现，我正在创建变成很小的代码的闭包）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-02T21:13:10.527

很久以前，我有一本名为“Threaded Interpretive Languages”的书，我认为是 Byte 出版的，它讨论了如何在 Z80 汇编中实现类似 Forth 的语言（我认为他们从未将其称为 Forth）。

您可能手边没有 Z80，或者想要一个，但这本书可能很有启发性。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-02T23:55:56.520

comp.lang.forth 上的这篇文章列出了一些“最小的 Forths”。

[http://groups.google.com/group/comp.lang.forth/msg/10872cb68edcb526](http://groups.google.com/group/comp.lang.forth/msg/10872cb68edcb526)

为什么我会知道这个？我的兄弟，Mikael，写了#3，他还写了[一篇](http://libris.kb.se/bib/879246)关于制作“最小的​​ Forth”的论文（虽然是瑞典语）。如果我没记错的话，他想获得一组可以内置在硅片中的最小运算符。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-02T23:19:01.850

我仍然不相信这个问题是正确的。例如，可以减少 Plinth 的指令；毕竟，`*`and`/`可以用 and 来实现`+`，`-`但是 '+' 可以用后继函数来实现（参见[Peano 公理](http://en.wikipedia.org/wiki/Peano_axioms)。）这让你进入了图灵机的附近。你怎么知道在哪里停下来？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-03T13:29:31.290

您可能还想看看 Hans Bezemer 的[4tH compiler](http://www.xs4all.nl/~thebeez/4tH/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-02T21:01:00.757

您使用的哪个 Forth 实现未在文档中提供此信息？鉴于 Forth 的性质，它可能依赖于实现。字典中有一组标准的单词，但它们是通过汇编/C/其他方式还是通过 Forth 到达那里并不重要，因为根据定义，Forth 是一种可自我扩展的语言。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-01-19T15:41:59.623

与您所说的相反，通常 DROP SWAP 等被认为是基本的 Forth 操作。原因是，如果您按照您的建议使用内存操作来实现它们，整个系统会变得更加复杂，而不是更复杂。在 Forth 中也没有明确区分什么是基本的和什么不是。在 80 年代，字典搜索将是基本的，并以汇编程序编码以提高速度，而托管的现代 linux 可以负担得起所谓的高级编码。此外，Forthers 倾向于例行地用高级语言重新编码汇编器字，并用汇编器重新编码高级字。我是 ciforth 和 yourforth 的作者。可以像在 ciforth 中那样将 <= 定义为 "> not" 。但是在你以后，我决定让所有的 < <= > >= 看起来相似，外观一致，小型汇编程序例程实际上更简单。

在上下文中，我将问题解释为：“以合理的速度达到合理强大的 Forth 的原始操作数量的合理规模是多少？” 显然，您对以巨大开销为代价摆脱一个汇编器字的巧妙技巧不感兴趣，正如在讨论该主题的一些线程中发现的那样。

现在，您可以查看一些小型 Forth，例如 jonesforth yourforth eforth，并得出结论，大多数情况下，其中一个到达大约 50 到 100 个基元。那些 Forth 是在汇编程序中定义的。如果您想在 c、python 或 Java 中定义您的原语，情况又有所不同。现在对于例如上面的字典搜索，您可以在 c 和 Forth 之间进行选择。与语言设计无关的考虑开始发挥作用。你可能是一个多产的 c 程序员，或者你可能坚持用 Forth 编码，因为它是一个学习项目。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-07-23T04:58:37.807

1.  [我最喜欢的一个是Frank Sergeant](http://pygmy.utoh.org/3ins4th.html)的 MSDOS Pygmy Forth 中的三条指令。我相信他使用了一个系留的 Forth，我相信，一个在 PC 上功能更完整的 Forth，一个到目标的串行链接，以及在目标上的 peek、poke、execute（基本语言术语），即读、写和运行。

2.  如果您想要最新、技术最先进的答案，请查看Charles Moore 开发的[144 核第四 cpu中](http://www.greenarraychips.com/home/support/index.html#software)[列出的 5 位 (32) 指令（PDF 第 5 页，图 3）](http://www.greenarraychips.com/home/documents/greg/DB001-171107-F18A.pdf)福斯之父。基本上，Moore 先生给了我们 Forth，让我们可以将他当时拥有的 Fork设计自己的芯片的设计工具，也在他自己的 ColorForth 中从下到上设计。那不是低级语言，也不是高级语言——那是全能级语言！）

3.  [我认为因素编程语言](http://factorcode.org/)非常相似，其核心是一个用 C（或 C++）语言编码的虚拟机

4.  最后，还有一个[名为 pForth 的公共领域 Forth](http://www.softsynth.com/pforth/)，它的[内核是用 C 语言编写的](http://www.softsynth.com/pforth/pf_ref.php#C-kernel)。

# php - 在PHP中计算邮政编码之间的距离

> ID：407989
> 
> 赞同：23
> 
> 时间：2009-01-02T20:52:57.993
> 
> 标签：php, mysql, algorithm, math, distance

[我从This page](http://www.populardata.com/downloads.html)中获取了邮政编码及其经度/纬度等的数据库 。它有以下字段：

> 邮编、纬度、经度、城市、州、县、邮编类

数据在一个文本文件中，但我将它插入到 MySQL 表中。我现在的问题是，我如何利用上面的字段来计算用户可以在网站上输入的两个邮政编码之间的距离？PHP中的工作代码将不胜感激

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-03T00:32:04.213

**这是 mike 的答案，带有一些魔术数字**的注释。[对于一些测试数据](http://www.ilc-usa.com/library/pdfs/tb1401.pdf)，它似乎对我来说很好：

```
function calc_distance($point1, $point2)
{
    $radius      = 3958;      // Earth's radius (miles)
    $deg_per_rad = 57.29578;  // Number of degrees/radian (for conversion)

    $distance = ($radius * pi() * sqrt(
                ($point1['lat'] - $point2['lat'])
                * ($point1['lat'] - $point2['lat'])
                + cos($point1['lat'] / $deg_per_rad)  // Convert these to
                * cos($point2['lat'] / $deg_per_rad)  // radians for cos()
                * ($point1['long'] - $point2['long'])
                * ($point1['long'] - $point2['long'])
        ) / 180);

    return $distance;  // Returned using the units used for $radius.
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-02T20:58:34.817

只用数学就可以了...

```
function calc_distance($point1, $point2)
{
    $distance = (3958 * 3.1415926 * sqrt(
            ($point1['lat'] - $point2['lat'])
            * ($point1['lat'] - $point2['lat'])
            + cos($point1['lat'] / 57.29578)
            * cos($point2['lat'] / 57.29578)
            * ($point1['long'] - $point2['long'])
            * ($point1['long'] - $point2['long'])
        ) / 180);

    return $distance;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-02T21:22:20.727

您也可以尝试点击网络服务来计算距离。让别人做繁重的工作。

[https://www.zipcodeapi.com/API#distance](https://www.zipcodeapi.com/API#distance)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-02T21:32:03.127

查看用于计算两点之间大圆距离的[Haversine 公式。](http://en.wikipedia.org/wiki/Haversine_formula)可以在[此处找到更多示例](http://www.movable-type.co.uk/scripts/latlong.html)

哈弗辛公式：

*   R = 地球半径（平均半径 = 6,371km）
*   Δlat = lat2− lat1
*   Δlong = long2− long1
*   a = sin²(Δlat/2) + cos(lat1).cos(lat2).sin²(Δlong/2)
*   c = 2.atan2(√a, √(1−a))
*   d = RC

*（请注意，角度需要以弧度为单位才能传递给三角函数）。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-07T18:12:35.603

在您的 zip 表中，您需要获取要获取距离的两个点的坐标（纬度、经度）。

然后，您可以直接在 SQL 中或使用 PHP 计算距离。这篇文章概述了这两种方法：

[http://dev.strategystar.net/2011/10/mysql-php-get-distance-between-two-coordinates-in-miles-kilometers/](http://dev.strategystar.net/2011/10/mysql-php-get-distance-between-two-coordinates-in-miles-kilometers/)

示例中的计算基于此线程中已讨论的公式。它以英里和公里为单位提供地球的半径，因此它可以让您获得两个单位中两点之间的距离。

上面的链接很棒，因为计算方法不包括任何幻数，只有地球的半径！

# java - 使用 JCA 有效地检查大型数据集的签名

> ID：407990
> 
> 赞同：1
> 
> 时间：2009-01-02T20:53:31.770
> 
> 标签：java, security, performance, digital-signature, jca

我必须验证可能大至 2Gb 的文件上的签名，并且我希望以尽可能节省内存的方式进行验证。由于各种原因，该文件已经完全加载到内存中，`InputStream`并由应用程序使用访问。我想使用流接口验证签名，但是 JCA`Signature`类的`update`方法只接受`byte[]`和相关的类。

我怎样才能有效地做到这一点？我不想将野兽加载到第二个字节数组中，否则我们会看到一些严重的高内存使用，但接口似乎不支持它。

**更新**

如果重要，签名算法是 SHA-1

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T21:06:57.453

为什么不一次读取输入流一个块（4096 字节或任何方便的大小），为每个块调用 update()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T23:58:43.830

创建一个字节数组作为*缓冲区*，并从 InputStream 中一次读取缓冲区，每次在 Signature 上调用 update()。如果缓冲区的大小合理，则将数据从一个进程传输到另一个进程所消耗的 CPU 时间（我猜这就是您正在做的事情？）与计算时间相比可能可以忽略不计。在从磁盘读取的情况下，CPU 使用率回报可忽略不计的截止点似乎是大约 8K 的缓冲区大小，我怀疑这或多或少也适用于您的情况。（如果它很有趣，请参阅我放在一起的页面[InputStream 缓冲区大小](http://www.javamex.com/tutorials/io/input_stream_buffer_size.shtml)。）***************