# StackOverflow 问答 000306000-000306999

# java - 使用 JSP 处理文本文件的最简单方法是什么？

> ID：306012
> 
> 赞同：0
> 
> 时间：2008-11-20T16:48:45.243
> 
> 标签：java, unix, jsp, shell, ksh

在 *NIX 框内有一个实际运行的 Java ServerPages (JSP) 应用程序，我在某种程度上以良好的权限管理它。这个想法是创建一个新的但非常简单的 JSP 页面来控制我在那里运行的一些 Korn Shell 脚本。所以目标是制作某种 HTML 表单，它将编写某种 scriptStatus.on / scriptStatus.off 文件：

```
#!usr/bin/ksh
# coolScript.sh
# This is my cool script that is being launched by cron every 10 minutes.

if [ -e scriptStatus.off ]
  then 
      # monitor disabled
  else
      # monitor enabled
fi 
```

然后可以在运行脚本中检查它是否存在，因此可以轻松激活/停用它而无需实际处理 cron。如果所有这些都有意义，请告诉我，并且不要犹豫，根据需要提出尽可能多的问题。

提前非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T17:11:58.007

您可能在这里遇到安全问题。考虑您有什么风险并采取适当的步骤来验证用户并确保他们被授权执行此操作。为此所需的步骤在某种程度上取决于您正在使用的 servlet 容器。

您不需要像 Apache Commons IO 这样的库来完成如此简单的任务。如果您不关心两个不同用户之间的竞争条件，则可以使用[File.createNewFile](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#createNewFile())和[File.delete 。](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#delete())

```
File flag = new File("/path/scriptStatus.off");
String message;
if (flag.delete())
  message = "Script enabled.";
else if (flag.createNewFile()) 
  message = "Script disabled.";
else
  /* Maybe missing directory, wrong permissions, race condition. */
  message = "Error: script state unknown."; 
```

cron 作业可以检查（空）文件是否存在，并采取相应措施。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T17:11:13.217

可能是[http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#touch(java.io.File)](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html#touch(java.io.File)) ？

# php - PHP 表单未显示在收件人邮箱中

> ID：306013
> 
> 赞同：-2
> 
> 时间：2008-11-20T16:49:13.513
> 
> 标签：php, email, scripting, forms

我的表格在提交时没有发送给收件人！我将文件 mail.tpl.txt 更改为直接发送到我自己的电子邮件地址作为测试，我收到了电子邮件就好了。

客户也检查了垃圾邮件文件夹，但他没有得到信息。

下面是表单代码，然后是 mail.tpl.txt 中的代码，然后是表单的 index.php 代码。

对我来说一切都很好，所以我想问是否有人知道为什么他不会收到表格。如果有帮助，他会使用 qwest 发送电子邮件。

这是表单代码：

```
<form id="contactForm" name="form" action="form/index.php" method="post">
  <fieldset>
  <legend><font color="#000000"><strong>Please fill out the form below if you have any questions.</strong></font></legend>
    <div>
    <label for="name">Name:* </label>
    <input type="text" size="30" name="name" class="txt" id="name" />
  </div>
    <div>
    <label for="label">Phone: </label>
    <input type="text" size="30" name="phone" class="txt" id="label" />
  </div>
    <div>
    <label for="email">Email:* </label>
    <input type="text" size="30" name="email" class="txt" id="email" />
  </div>
    <div>
    <label for="message">Message: </label>
    <textarea rows="6" name="message" id="message" cols="40" class="txt"></textarea>
  </div>
    <input type="hidden" name="thanks" value="../thanks.php" />
  <input type="hidden" name="email_fields" value="email" />
  <input type="hidden" name="required_fields" value="name, email" />
  <input type="hidden" name="html_template" value="form.tpl.html" />
  <input type="hidden" name="mail_template" value="mail.tpl.txt" />
  <div class="submit">
    <input type="submit" class="btn" value="Send Message" name="Submit" id="Submit" />
  </div>
  </fieldset>
</form> 
```

现在是 mail.tpl.text 代码：（我已经取出了我的客户的完整地址和域名。）

```
 To: "xxxxxxx Custom Homes" <xxxxxxx@q.com>
    From: "{name}" {phone} <{email}> <{message}>
    MIME-Version: 1.0
    Content-type: text/plain; charset={txt_charset}
    Subject: Online Contact Request from Freese Custom Homes

    Contact Information:
    {name} {phone}
    Email Address: {email}

    Contact Message:
    {message}

Lastly, here's the form's index.php code: (Again, I have taken out my client's domain name for the post)

<?php

          $script_root           = './';

          $referring_server      = ''; // Example: $referring_server = 'xxxxxxx.com, www.xxxxxxx.com';

          $language              = 'en';      // (see folder 'languages')

          $ip_banlist            = '';

          $ip_address_count      = '0';
          $ip_address_duration   = '48';

          $show_limit_errors     = 'yes';    // (yes, no)

          $log_messages          = 'no';     // (yes, no) -- make folder "temp" writable with: chmod 777 temp

          $text_wrap             = '72';

          $show_error_messages   = 'yes';

          $attachment            = 'no';    // (yes, no) -- make folder "temp" writable with: chmod 777 temp
          $attachment_files      = 'jpg, gif,png, zip, txt, pdf, doc, ppt, tif, bmp, mdb, xls, txt';
          $attachment_size       =  9000000;

          $captcha               = 'no';   // (yes, no) -- make folder "temp" writable with: chmod 777 temp

          $path['logfile']       = $script_root . 'logfile/logfile.txt';
          $path['templates']     = $script_root . 'templates/';

          $file['default_html']  = 'form.tpl.html';
          $file['default_mail']  = 'mail.tpl.txt';

  /*****************************************************
  ** Add further words, text, variables and stuff
  ** that you want to appear in the templates here.
  ** The values are displayed in the HTML output and
  ** the e-mail.
  *****************************************************/
          $add_text = array(
                              'txt_additional' => 'Additional', //  {txt_additional}
                              'txt_more'       => 'More'        //  {txt_more}

                            );

  /*****************************************************
  ** Do not edit below this line - Ende der Einstellungen
  *****************************************************/

  /*****************************************************
  ** Send safety signal to included files
  *****************************************************/
          define('IN_SCRIPT', 'true');

  /*****************************************************
  ** Load formmail script code
  *****************************************************/
          include($script_root . 'inc/formmail.inc.php');

          echo $f6l_output;

?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T16:53:37.433

您现在发送纯文本电子邮件 - 您应该更正该电子邮件的标题内容类型。

只需将其设置为 text/html。这里可能有更多信息：

*   [http://www.ietf.org/rfc/rfc2387.txt](http://www.ietf.org/rfc/rfc2387.txt)
*   [http://www.faqs.org/rfcs/rfc2822](http://www.faqs.org/rfcs/rfc2822)

或者google一下，那里有很多资源！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T18:09:21.337

要添加适当的标题，请参阅：
[http](http://nl2.php.net/manual/en/function.mail.php)
://nl2.php.net/manual/en/function.mail.php 示例 4。
顺便说一句，这只是 Sebastian 的一个链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-03T01:15:52.047

From 标题行不正确。引号外有文字：

```
From: "{name}" {phone} <{email}> <{message}> 
```

<{message}> 在那里做什么。唯一正确的格式是：

```
From: "{name} {phone}" <{email}> 
```

您不能在那里使用消息占位符，因为它包含新行并且会破坏邮件标题。

# subsonic - 亚音速控制器

> ID：306015
> 
> 赞同：0
> 
> 时间：2008-11-20T16:49:58.987
> 
> 标签：subsonic, controller

SubSonic 中的控制器有什么用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:20:12.620

我相信控制器与 ObjectDataSouce 一起工作。

如果您不使用 ODS，则有一个名为 generateODSControllers 的配置设置，您可以将其设置为 false 以防止生成控制器。

[有关 ODS/控制器使用的更多信息（向下滚动）](http://www.codeplex.com/subsonic/Wiki/View.aspx?title=Examples&referringTitle=Docs)

# c - 使用远函数指针

> ID：306017
> 
> 赞同：6
> 
> 时间：2008-11-20T16:50:11.420
> 
> 标签：c, pointers, embedded, function-pointers

我意识到 far 是特定于编译器的，但我的期望是 far 说明符的放置对那些真正理解指针的人来说应该是有意义的。

所以，我有两个应用程序共享处理器的整个内存空间。

应用 A 需要调用应用 B 中存在的函数 foo。

我知道函数 foo 的内存位置。

所以这应该工作，在应用程序A：

```
typedef int (* __far MYFP)(int input);

void somefunc(void)
{
   int returnvalue;
   MYFP foo;

   foo = (MYFP) 0xFFFFFA;

   returnvalue = foo(39);
} 
```

*   __far 在 typedef 中的正确位置吗？
*   我是否需要将 __far 添加到 (MYFP) 演员表中？
*   一些信息表明对 foo 的调用不需要取消引用，您的经验是什么？
*   这看起来还有什么不正确的，或者我可以尝试完成这个吗？

*   有一个更好的方法吗？

编辑：

这是在使用 Code Warrior 的嵌入式设备（飞思卡尔 S12XEQ 设备）上。这是一个具有 24 位内存空间的 16 位设备，所以是的，它是分段/存储的。

-亚当

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-20T17:06:39.093

`__far`在创建使用分段内存的二进制文件时，至少在 MS 世界中使用了该关键字。您需要了解 8086 内存系统才能理解这一点。8086将内存分成段，每段64K长，所以段中的每个地址需要16位。地址有两种形式：近处和远处。近地址为 16 位，是当前段的偏移量，根据指令为 CS、DS、ES、SS 之一，远地址为 32 位，由段和偏移量组成。在 8086 中，绝对地址是 16 * 段 + 偏移量，可寻址范围为 1Mb。

如果您没有使用分段内存系统，并且看起来您没有使用，那么所有地址都具有相同的位数，因此不需要区分近/远，这意味着编译器可能会忽略关键字。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-20T18:27:54.123

*__far 在 typedef 中的正确位置吗？*

[编辑，回应 ChrisN 的评论——谢谢]

这是一个依赖于编译器的功能，因为它不是 ANSI C 的一部分。根据编译器手册 <[http://www.freescale.com/files/soft_dev_tools/doc/ref_manual/CW_Compiler_HC12_RM.pdf](http://www.freescale.com/files/soft_dev_tools/doc/ref_manual/CW_Compiler_HC12_RM.pdf) >，第 8 章，您已正确放置。在其他编译器中，您可能需要颠倒顺序。不过，这应该很容易弄清楚，因为这两个选项中的一个将与任何给定的编译器一起编译。

*我是否需要将 __far 添加到 (MYFP) 演员表中？*

不，它是类型的一部分。

*一些信息表明对 foo 的调用不需要取消引用，您的经验是什么？*

可以选择在 C 中取消引用函数指针。以下几行都是有效的，做完全相同的事情：

```
foo = (MYFP)0xFFFFFA;
returnvalue = foo(39);  // 1
returnvalue = (*foo)(39);  // 2 
```

*这看起来还有什么不正确的，或者我可以尝试完成这个吗？*

你做得完全正确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T18:22:57.067

这是一段代码，适用于我正在从事的项目。它是 Paradigm C++，所以它使用了 Borland 的某个版本。它使用的 CPU 是 8086 克隆，因此分段的 20 位内存。

```
void softSerial0SR(unsigned16);
void (__far *softHandler)(unsigned16); 
```

我毫无怨言地将 softHandler 初始化为 0。

然后，

```
softHandler = softSerial0SR; 
```

在设置代码中。

要调用它，只需像普通函数一样调用 softHandler 即可。

请注意，此代码是根据我拥有的实际代码为您稍微调整的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T17:57:49.257

这两个程序都是由相同的编译器/选项构建的，所以它们使用相同的 OBI？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T16:11:13.480

同意代码看起来不错 - 在这种情况下，我会反汇编生成的代码，并确定它是否正确。最多应该只有 10 条指令——然后你就会确定它是否有效。

# networking - Windows 2008 并发 TCPIP 连接

> ID：306040
> 
> 赞同：0
> 
> 时间：2008-11-20T16:57:25.400
> 
> 标签：networking, tcp, windows-server-2008

在 Windows XP 中，Microsoft 决定在以后的服务包中限制半开连接的数量。据传修补 tcpip.sys 可以解决此问题。Windows 2008 中是否存在这样的限制，如果存在，是否可以配置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-20T17:14:45.393

当 Vista SP1 发布时，有一篇关于与 Windows Server 2008 对齐的文章，他们的例子是网络子系统，他们说它旨在处理数千个连接。所以我想，不，他们不会将其限制为 10 :)

我想是[这篇文章](http://technet.microsoft.com/en-us/library/cc709618.aspx)（滚动到底部），虽然我想我记得它更长。

# subsonic - 亚音速收集顶部 1

> ID：306051
> 
> 赞同：6
> 
> 时间：2008-11-20T17:01:41.270
> 
> 标签：subsonic, collections

下一段代码有没有办法只获得第一条记录？

```
Dal.TreeHtmlExportsCollection treeHtmlExportsCollection =
  new Dal.TreeHtmlExportsCollection().Where(Dal.TreeHtmlExports.Columns.TreeId, treeId).
  OrderByDesc(Dal.TreeHtmlExports.Columns.DateCreated).Load(); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-20T17:37:34.320

您可以使用查询工具执行此操作，如下所示：（需要 SubSonic 2.1）

```
var query = new Select()
     .Top("1")
     .From(TreeHtmlExports.Schema)
     .Where(TreeHtmlExports.Columns.TreeId).IsEqualTo(treeId)
     .OrderDesc(TreeHtmlExports.Columns.DateCreated);

treeHtmlExportCollection = query.ExecuteAsCollection<TreeHtmlExportsCollection>(); 
```

希望有帮助！

# css - CSS3选择器找到同一类的第二个div

> ID：306062
> 
> 赞同：58
> 
> 时间：2008-11-20T17:05:20.250
> 
> 标签：css

我需要一个 CSS 选择器，它可以找到具有相同类的 2 的第二个 div。我已经看过了，`nth-child()`但这不是我想要的，因为我看不到进一步澄清我想要的课程的方法。如果有帮助，这 2 个 div 将是文档中的兄弟姐妹。

我的 HTML 看起来像这样：

```
<div class="foo">...</div>
<div class="bar">...</div>
<div class="baz">...</div>
<div class="bar">...</div> 
```

我想要第二个 div.bar （或者最后一个 div.bar 也可以）。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-20T17:12:56.537

选择器可以组合：

```
.bar:nth-child(2) 
```

意思是“有类*栏*的东西”，也是第二个孩子。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2012-09-29T10:40:32.967

我原来的回答`:nth-of-type`是完全错误的。感谢保罗指出这一点。

那里的“类型”一词仅指“元素类型”（如`div`）。事实证明，选择器`div.bar:nth-of-type(2)`和`div:nth-of-type(2).bar`意思是一样的。两者都选择 [a] 是`div`其父级的第二个元素，并且 [b] 具有 class `bar`。

所以我知道的唯一纯 CSS 解决方案，如果你想选择某个选择器的所有元素，除了第一个，是通用兄弟选择器：

```
.bar ~ .bar 
```

[http://www.w3schools.com/cssref/sel_gen_sibling.asp](http://www.w3schools.com/cssref/sel_gen_sibling.asp)

* * *

*我的原始（错误）答案如下：*

随着 CSS3 的到来，还有另一种选择。首次提出问题时，它可能不可用：

```
.bar:nth-of-type(2) 
```

[http://www.w3schools.com/cssref/sel_nth-of-type.asp](http://www.w3schools.com/cssref/sel_nth-of-type.asp)

这将选择满足`.bar`选择器的第二个元素。

如果您想要特定类型元素的**第二个和最后**一个（或除第一个之外的所有元素），通用兄弟选择器也可以正常工作：

```
.bar ~ .bar 
```

[http://www.w3schools.com/cssref/sel_gen_sibling.asp](http://www.w3schools.com/cssref/sel_gen_sibling.asp)

它更短。但当然，我们不喜欢重复代码，对吧？:-)

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-11-20T17:41:28.227

**更新**：这个答案最初是在 2008 年编写的，当时`nth-of-type`支持充其量是不可靠的。今天我想说你可以安全地使用类似的东西`.bar:nth-of-type(2)`，除非你必须支持 IE8 和更早版本。

* * *

*2008 年的原始答案如下（请注意，我不会再推荐这个了！）*：

如果您可以使用[Prototype JS](http://www.prototypejs.org/)，您可以使用此代码设置一些样式值，或添加另一个类名：

```
// set style:
$$('div.theclassname')[1].setStyle({ backgroundColor: '#900', fontSize: '1.2em' });
// OR add class name:
$$('div.theclassname')[1].addClassName('secondclass'); // pun intentded... 
```

（我没有测试这段代码，也没有检查是否真的存在第二个 div，但这样的东西应该可以工作。）

但是，如果您正在生成 html 服务器端，您不妨在第二项上添加一个额外的类......

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-11-20T17:23:26.780

您的 HTML 的结构到底是什么？

如果 HTML 是这样的，则以前的 CSS 将起作用：

**CSS**

```
.foo:nth-child(2) 
```

**HTML**

```
<div>
 <div class="foo"></div>
 <div class="foo">Find me</div>
...
</div> 
```

但是，如果您有以下 HTML，它将无法正常工作。

```
<div>
 <div class="other"></div>
 <div class="foo"></div>
 <div class="foo">Find me</div>
 ...
</div> 
```

简单地说，没有选择器用于从它之前的选择器的其余部分获取匹配项的索引。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-03-14T08:22:52.603

**HTML**

```
<h1> Target Bar Elements </h1>

<div class="foo">Foo Element</div>
<div class="bar">Bar Element</div>
<div class="baz">Baz Element</div>
<div class="bar">Bar Second Element</div>
<div class="jar">Jar Element</div>
<div class="kar">Kar Element</div>
<div class="bar">Bar Third Element</div> 
```

**CSS**

```
.bar {background:red;}
.bar~.bar {background:green;}
.bar~.bar~.bar {background:yellow;} 
```

[演示](https://jsfiddle.net/ssuryar/6ka13xve/) [https://jsfiddle.net/ssuryar/6ka13xve/](https://jsfiddle.net/ssuryar/6ka13xve/)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-06-24T13:17:40.547

对于正在寻找 jQuery 兼容答案的人：

```
$('.foo:eq(1)').css('color', 'red'); 
```

HTML：

```
<div>
  <div class="other"></div>
  <div class="foo"></div>
  <div class="foo">Find me</div>
  ... 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-20T17:43:22.310

您是否有理由不能通过 Javascript 执行此操作？我的建议是使用通用规则 ( `.foo`) 定位选择器，然后重新解析以使用 Javascript 获取最后一个 foo 并设置您需要的任何其他样式。

或者按照 Stein 的建议，如果可以的话，只需添加两个类：

```
<div class="foo"></div>
<div class="foo last"></div>

.foo {}
.foo.last {} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-09-29T01:26:36.810

```
.parent_class div:first-child + div 
```

`div`我只是使用上面的方法通过将第一个孩子与选择器链接起来来找到第二个`+`。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-12-16T05:42:40.120

首先，您必须选择父元素并为父元素设置`:nth-of-type(n)`，然后选择您想要的元素。像这样的东西：

```
#topmenu li:nth-of-type(2) ul.childUl { 
```

这将从顶部菜单中选择第二个子菜单。`#topmenu li`是父元素。

**HTML：**

```
<ul id="topmenu">
    <li>
        <ul class="childUl">
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </li>
    <li>
        <ul class="childUl">
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </li>
    <li>
        <ul class="childUl">
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </li> 
```

# asp.net - 在 asp.net 中管理全局变量的最佳方法是什么？

> ID：306065
> 
> 赞同：0
> 
> 时间：2008-11-20T17:06:00.903
> 
> 标签：asp.net

目前我在 App_Code 中有一个 NotInheritable 类，它包含一些需要在应用程序中访问的变量，但我认为这不是管理全局变量的好方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T17:09:56.060

通常，这种事情需要[Singleton](http://en.wikipedia.org/wiki/Singleton_pattern)。但是，我建议不要自己编写单例代码，而是使用依赖注入/IoC 框架来处理服务的生命周期。

使用 ASP.NET 时您必须记住的另一件事是 ASP.NET 进程会不时自动回收自身，因此您需要将更改持久保存到永久存储（例如文件系统或数据库）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T20:32:53.543

作为应用程序状态的替代方案，请考虑将变量设为静态。它基本上等同于相同的东西，具有强类型的额外好处。

*就个人*而言，我会采用 David 的建议并使用由 IoC 容器管理的单例范围服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T17:48:12.003

您应该使用应用程序设置。只需转到应用程序属性窗口，选择设置选项卡并添加变量。比在代码上只使用强类型类。例如，如果我创建了一个名为*PortalName*的全局变量，我只需使用：`Settings.Default.PortalName`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T17:50:41.703

我相信 Application 对象是一种使用全局变量的内置方式，您可以根据需要在对象中存储各种值。

# wpf - 如何在 Expander 标题中指示折叠的内容有错误

> ID：306074
> 
> 赞同：1
> 
> 时间：2008-11-20T17:09:28.587
> 
> 标签：wpf, validation, xaml, expander

我有包含文本框的扩展器，文本框使用 wpf 验证内容在它们周围绘制一个红色框（文本框被包裹在 Adorner 装饰器中，以确保在展开器折叠时我不会到处都是空的红色框）

我想在扩展器的标题中指出它的内容有错误（如果它处于折叠状态） - 一个图标或红色感叹号或其他东西。我想我从我的验证函数中看到了一种在代码中执行此操作的方法（不理想），但是有没有办法在 xaml 中执行此操作？我可以使用带有触发器的扩展器样式以某种方式指向所有孩子的 Validation.HasError 吗？

谢谢你的任何想法..

特雷夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T21:39:52.490

如果您知道扩展器的内容，则可以使用 MultiDataTrigger 来执行此操作：

```
<Expander>
    <Expander.Header>
        <TextBlock>
            <TextBlock.Style>
                <Style TargetType="{x:Type TextBlock}">
                    <Setter Property="Text" Value="ERROR"/>
                    <Style.Triggers>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding ElementName=txtWidth, Path=(Validation.HasError)}" Value="False"/>
                                <Condition Binding="{Binding ElementName=txtHeight, Path=(Validation.HasError)}" Value="False"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Text" Value="NO ERROR"/>
                        </MultiDataTrigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>
    </Expander.Header>
    <StackPanel>
        <TextBox x:Name="txtWidth" Text="{Binding Width, ElementName=rect, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True}"/>
        <TextBox x:Name="txtHeight" Text="{Binding Height, ElementName=rect, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True}"/>
        <Rectangle x:Name="rect" Width="100" Height="100" Margin="10" Fill="Green"/>
    </StackPanel>
</Expander> 
```

如果扩展器的内容未知，那么您可能必须在 TextBoxes 上设置 Binding.NotifyOnValidationError 并处理附加的错误事件。

# asp.net - ASP.NET 如何将请求与会话相关联？

> ID：306075
> 
> 赞同：3
> 
> 时间：2008-11-20T17:09:48.713
> 
> 标签：asp.net, session

是否有一个cookie自动放置在用户的机器上？或者它是否与请求者的 IP 地址相关联？或者也许在 ViewState 中？基本问题，我知道，但我很难找到答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T17:14:14.677

在 IIS 中，在 ASP.NET 的配置下有一个状态管理选项卡，其中有一个名为“无 Cookie 模式”的设置，它具有以下选项：

使用Uri

使用 Cookie

自动侦测

使用设备配置文件

通常，选择“使用 Cookie”并因此使用 cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T17:12:17.770

它被称为`ASP.NET_SessionId`。

对于本地应用程序，我的当前

```
ASP.NET_SessionId=kxt1dee1laeuq445pyzjvv55; path=/; domain=localhost; HttpOnly 
```

你可以让它使用 URL，但它很快就会变得一团糟。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T17:11:05.230

这是一个饼干

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T17:23:37.297

这是一篇 MSDN 概述文章，描述了该过程以及您有哪些选项：

[**ASP.NET 会话状态概述**](http://msdn.microsoft.com/en-us/library/ms178581.aspx)

特别是，请注意底部，如果您的用户通过身份验证访问您的站点，您应该在注销时放弃会话，以便会话状态不会持续存在。

# installation - 在没有 SelfReg 的情况下安装 Capicom：未找到 Wix 自定义操作 (Err 2721)

> ID：306080
> 
> 赞同：1
> 
> 时间：2008-11-20T17:11:04.450
> 
> 标签：installation, wix, windows-installer, custom-action

在成功遵循[这个问题](https://stackoverflow.com/questions/302560/wix-custom-actions-with-wixuiminimal)中的建议后，我为另一个自定义操作添加了几行额外的代码。这个是为了在我试图放入用户系统文件夹的 capicom 副本上调用 regsvr32。但是，我收到错误 2721，从我所见，这似乎是未找到自定义操作错误。有什么建议么？我试图通过调用 regsvr 来保持与我的安装程序以前迭代的一致性，而不是仅仅在安装期间添加注册表项，这可能是一个好主意。:::耸肩:::

```
<Directory Id="SystemFolder" Name="Sys">
  ...
  <component ...>
     ...
    <File Id="CapiCom.Dll" LongName="CapiCom.Dll" Name="CAPICOM.DLL" Source=... />
  </component>
</directory>
...
<CustomAction Id="REGCAPICOM" ExeCommand='regsvr32.exe "[SystemFolder]capicom.dll"' Return = "ignore" Execute="deferred" />
...
<InstallExecuteSequence>
  ...
  <Custom Action="REGCAPICOM" After="InstallFiles" />
</InstallExecuteSequence> 
```

编辑：是的，使用 regsvr32 作为安装程序很难看。但是当我下载 Capicom SDK 时，MS 说要安装它。四处搜索发现很多人说这是一种愚蠢的方法……但这也是MS提供的机制。我会听取建议以寻求更好的方法。考虑到它是标准的 Windows 组件，如果在卸载我的应用程序时留下 Capicom，我认为这没什么大不了的。

编辑：嗯。显然，在 dll 上运行 selfreg 所做的事情之一就是创建一个随机种子以添加到注册表中。不确定它使用什么机制来生成这个种子，但我怀疑自己生成一个会被认为是低俗的，特别是如果我给所有用户提供相同的种子。不确定.... 显然，如果我跳过这个 Capicom 会自己做，所以我很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T15:25:11.217

正确的方式：

*   c:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Tools\Deployment\regcap.exe" /O capicom.reg capicom.dll

*   从 Adam Tengen 的[帖子](https://stackoverflow.com/questions/269423/how-to-generate-wix-xml-from-a-reg-file)中运行程序。

请注意，截至本文发布时，Heat（和 Tallow，IIRC）不能在 Capicom 上正常工作。

错误的方法：

```
<CustomAction Id="RegisterCapicom" Directory="SystemFolder" ExeCommand="regsvr32.exe /s &quot;[SystemFolder]Capicom.dll&quot;" Return="check" Execute="deferred" />
...
<InstallExecuteSequence>
  <Custom Action="RegisterCapicom" After="InstallFiles" />
</InstallExecuteSequence> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T17:52:15.210

呃，你真的要自己安装Windows系统文件吗？这在很多层面上都是不允许的。此外，regsvr32.exe 是 SelfReg，而 SelfReg 在安装中是众所周知的。实际使用 Windows Installer 编写注册是有优势的

但是，这里的整个设计非常可疑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T18:44:18.973

您可以在文件上使用 heat 来创建一个输出 WXS 文件，当执行 msi 时，它将在不使用 regsvr32 的情况下将 capicom.dll 信息放入注册表

像这样：

```
heat file [Path\Capicom.dll] -template:product -out capicom.wxs 
```

然后将 capicom.wxs 添加到您的安装程序中，在该文件中创建一个 ComponentGroup 元素，其中包含 Component(s) 元素：

```
<ComponentGroup Id="capicom">
  <ComponentRef Id="capicom.dll"/>
</ComponentGroup> 
```

在主 WXS 文件中添加将链接 capicom 组件的 Fragment 元素后

最后一步是将 ComponentGroupRef 添加到它所属的功能中：

```
<Feature Id="PRODUCTFEATURE">
  <ComponentGroupRef Id="capicom" />
  ... [Other components or ComponentGroups references]
</Feature> 
```

# c#-4.0 - C# 4.0 的新“命名参数”特性不应该被称为“命名参数”吗？

> ID：306085
> 
> 赞同：3
> 
> 时间：2008-11-20T17:12:25.977
> 
> 标签：c#-4.0, parameters, arguments, terminology, named-parameters

我想这个命名可能有历史原因，其他语言也有类似的特性，但在我看来，参数在 C# 中总是有一个名称。参数是未命名的。或者选择这个术语有什么特别的原因吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-20T17:32:11.380

哦，你想要**争论**！抱歉，这是参数 - 参数是左侧大厅的两扇门。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-20T17:24:49.430

是的，你是绝对正确的（在我看来，无论如何）。具有讽刺意味的是，虽然我通常对这些术语很挑剔，但当我应该谈论“参数传递”时，我仍然使用“参数传递”。我想有人可能会争辩说，在 C# 4.0 之前，如果您正在调用一种方法，那么您并不关心参数名称，而当您也可以在参数上指定它们时，名称就会成为重要元数据的一部分。

我同意它会有所作为，而且术语很重要。

不过，“可选参数”绝对没问题 - 当您之前无法这样做时，它会将元数据添加到参数中:)（话虽如此，就生成的 IL 而言，它不是可选的......）

你想让我向团队询问他们的反馈吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-09T11:26:41.187

我不这么认为。这些名称绝对是参数的名称，因为它们在方法定义中被定义并赋予特定含义，它们被正确地称为方法的参数。在调用站点，参数现在可以用它们为其提供值的参数的名称进行标记。

新术语指的是方法调用者的视角——这是合乎逻辑的，因为这是该功能适用​​的地方。以前，调用者只需将参数视为“定位参数”。现在他们可以选择将它们视为“命名参数” - 因此名称。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-22T04:14:35.457

我不知道它现在是否值得添加，但无论如何MS 都称它为*命名参数。*请参阅[命名参数和可选参数](http://msdn.microsoft.com/en-us/library/dd264739%28v=vs.100%29.aspx)

# javascript - 是否有适用于 IE 的 HTML SELECT 的全功能下拉替换？

> ID：306097
> 
> 赞同：1
> 
> 时间：2008-11-20T17:14:57.343
> 
> 标签：javascript, html, html-select

我们在[上一个问题](https://stackoverflow.com/questions/303810/variable-dynamic-option-lists-in-html-select-using-ie)中确定 IE 不支持 HTML SELECT 的许多功能。您是否会根据您的经验推荐满足以下要求的替代小部件？

1.  尊重`contentEditable`属性（如果为真，则不允许选择更改）
2.  尊重`disabled`单个 OPTION 的属性（将它们显示为“灰色”或带有删除线字体，并使它们不可选择）
3.  支持选项组（`OPTGROUP`元素）
4.  支持和所有子元素中的`style`选项`border``margin``SELECT`
5.  `OPTION`支持动态添加和删除`OPTGROUP`元素
6.  在 IE 6 及以上版本中支持上述内容

编辑：正如@Joel Coehoorn 所指出的，上述第 3 和第 5 项目前在 IE 中受支持。它们包含在此处以确保它们不会在替换小部件中被忽略。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T17:22:54.740

最后检查 IE6+ 是否支持 #3 和 #5，并且您可以（错误）使用 OPTGROUP 来解决大多数其他项目。

您可以通过在其中没有任何选项的 optgroup 来做到这一点，如下所示：

```
<optgroup label="--"></optgroup> 
```

您可以根据需要制作任何标签，但关键是您最终会得到一个看起来像普通选项但无法选择的项目。这为各种乐趣打开了大门：

*   您可以通过将特定项目添加为 optgroup 来禁用它们
*   您可以通过将除当前选项以外的所有选项编码为 optgroups 来防止选择更改（如果需要，请使用其他一些文本键来指示它们已禁用）
*   您可以使用空白、- 或 — 标签来指示简单的分隔符而不是整个组。

无论如何，这占了列表中#1 和#2 的大部分——至少是功能点。

“（误）使用”的原因是因为这不会通过大多数 html 验证器。但是，该技巧确实适用于所有主要浏览器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-12T04:29:49.883

我正在写这样一个小部件。我计划在我的下一个版本中实现 optgroup，希望在几天内实现，因为我已经取得了良好的进展。

[演示页面](http://programmingdrunk.com/current-projects/dropdownReplacement/)

[svn](https://code.google.com/p/dogself-jquery/source/browse/trunk/jquery.dropdownReplacement/)

# asp.net - ASP.NET 成员资格：登录控件源代码

> ID：306100
> 
> 赞同：2
> 
> 时间：2008-11-20T17:15:20.340
> 
> 标签：asp.net, asp.net-membership, visual-studio-2005, forms-authentication

通用登录控件的源代码是否可用？

这些是工具箱中登录部分下可用的控件：

*   登录，
*   登录视图，
*   找回密码，
*   登录状态，
*   登录名，
*   创建用户向导，
*   更改密码

最后，您能否指出这些控件提供的自定义功能实现的良好来源，或者在不使用上述控件的情况下实现此功能的一些指导。

我正在使用 Visual Studio 2005 (.net2)

我将使用 SQLMembershipProvider 作为 MembershipProvider 但这可能没有什么区别。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T12:26:17.973

“整个框架都可用”是不正确的。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T17:30:25.050

整个框架的源代码是可用的。以下链接提供了有关如何访问的一些详细信息：

[http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-10T21:53:45.707

我要给这个合格的“不”。

我已经走上了使用反射源作为起点实现登录服务器控件的道路（这是在符号服务器集成之前）。

事情似乎进展得很顺利，通过一些反射技巧来获取核心框架成员，从而避免大量代码。

直到你找到设计师。该基础设施是一个雷区，并且会迅速变得广泛而深入，并且充满了需要实现或反射黑客的更深埋的内部类型。

最终得到了一个我可以扩展但永远不想维护的工作控制。

努力没有白费；我学到了很多关于如何设计过度设计的服务器控件的知识。

然后我只是将登录控件切换到模板模式，并用几行代码完成了我需要完成的一切。;-)

除了作为一种学习经验，我当然会建议不要走这条路。

祝你好运。

# linq-to-sql - 如何让 Castle MonoRail 的 DataBinder/SmartDispatcherController 绑定到包含接口属性的类型？

> ID：306103
> 
> 赞同：1
> 
> 时间：2008-11-20T17:15:39.060
> 
> 标签：linq-to-sql, castle-monorail, databinder

我们在域模型中使用接口来表示实体类。通过使用 LinqToSql，我们有这些的具体实现。我们为每个 LinqToSql 类添加了一个工厂方法，我们的服务层使用它来实例化一个新实体（注意；与控制器的 DataBind 属性相反）。

MonoRail 的默认 DataBinder 实现将忽略定义为接口的属性。

理想情况下，我们不想在 MonoRail 中实例化我们的数据层类——接口的全部意义在于分离这些关注点。

此外，我们真的不想创建另一组非 LinqToSql 具体类，其唯一工作是在层之间进行转换。

**在这里**结束了漫长的一天；请有人怜悯并指出我们应该用自己的实现重载的 IDataBinder 部分，或者暗示我们可能尝试的其他方法？;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T19:41:57.867

您应该查看 IParameterBinder。看看[我写的关于这个主题的帖子](http://www.kenegozi.com/Blog/2008/09/15/creating-a-custom-parameter-binder-for-monorail-actions-iparameterbinder.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-24T04:07:51.677

正如 Ken 指出的那样，您的想法可以使用自定义 IParameterBinder 来实现。

一个解决方案是使用 IOC：

*   从其界面解析表单的具体实例
*   然后使用 IDataBinder 将实例绑定到请求参数

另一种是使用 IDictionaryAdapter：

*   为您的界面生成一个 dto 代理
*   然后使用 IDataBinder 将 dto 代理实例绑定到请求参数

注意：如果接口，第二个选项将不起作用：

*   不公开（哼）
*   有方法
*   或事件
*   或只读属性
*   或 setonly 属性

最后，我不确定在控制器签名中暴露具体类的问题是什么。

我自己在实现应用层服务中定义的接口的控制器中使用具体形式，它允许我在两边分离关注点：

*   控制器端是表单/命令的 Http 映射和第一级数据验证
*   应用层服务是表单/命令的业务验证和处理

# python - Python装饰器使函数忘记它属于一个类

> ID：306130
> 
> 赞同：61
> 
> 时间：2008-11-20T17:24:39.150
> 
> 标签：python, reflection, metaprogramming

我正在尝试编写一个装饰器来进行日志记录：

```
def logger(myFunc):
    def new(*args, **keyargs):
        print 'Entering %s.%s' % (myFunc.im_class.__name__, myFunc.__name__)
        return myFunc(*args, **keyargs)

    return new

class C(object):
    @logger
    def f():
        pass

C().f() 
```

我想打印这个：

```
Entering C.f 
```

但相反，我收到此错误消息：

```
AttributeError: 'function' object has no attribute 'im_class' 
```

大概这与 'logger' 中的 'myFunc' 的范围有关，但我不知道是什么。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-20T18:08:33.400

Claudiu 的答案是正确的，但您也可以通过从`self`参数中获取类名来作弊。这会在继承的情况下给出误导性的日志语句，但会告诉您正在调用其方法的对象的类。例如：

```
from functools import wraps  # use this to preserve function signatures and docstrings
def logger(func):
    @wraps(func)
    def with_logging(*args, **kwargs):
        print "Entering %s.%s" % (args[0].__class__.__name__, func.__name__)
        return func(*args, **kwargs)
    return with_logging

class C(object):
    @logger
    def f(self):
        pass

C().f() 
```

正如我所说，如果您从父类继承了函数，这将无法正常工作。在这种情况下，你可能会说

```
class B(C):
    pass

b = B()
b.f() 
```

并`Entering B.f`在您真正想要获取消息的地方获取消息，`Entering C.f`因为那是正确的类。另一方面，这可能是可以接受的，在这种情况下，我会推荐这种方法而不是 Claudiu 的建议。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-11-20T23:16:51.123

函数仅在运行时成为方法。也就是说，当你`C.f`得到一个绑定函数（和`C.f.im_class is C`）。在定义您的函数时，它只是一个普通函数，它不绑定到任何类。这个未绑定和分离的函数是由 logger 修饰的。

`self.__class__.__name__`将为您提供类的名称，但您也可以使用描述符以更通用的方式完成此操作。这种模式[在一篇关于 Decorators 和 Descriptors 的博客文章中进行了描述](http://blog.ianbicking.org/2008/10/24/decorators-and-descriptors/)，特别是您的 logger 装饰器的实现如下所示：

```
class logger(object):
    def __init__(self, func):
        self.func = func
    def __get__(self, obj, type=None):
        return self.__class__(self.func.__get__(obj, type))
    def __call__(self, *args, **kw):
        print 'Entering %s' % self.func
        return self.func(*args, **kw)

class C(object):
    @logger
    def f(self, x, y):
        return x+y

C().f(1, 2)
# => Entering <bound method C.f of <__main__.C object at 0x...>> 
```

显然可以改进输出（例如，通过使用`getattr(self.func, 'im_class', None)`），但这种通用模式适用于方法和函数。但是它*不适*用于旧式课程（但不要使用那些;）

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-08-05T07:54:48.090

这里提出的想法非常好，但也有一些缺点：

1.  `inspect.getouterframes`并且`args[0].__class__.__name__`不适合普通函数和静态方法。
2.  `__get__`必须在一个被拒绝的类中`@wraps`。
3.  `@wraps`本身应该更好地隐藏痕迹。

所以，我结合了这个页面的一些想法，链接，文档和我自己的头脑，
终于找到了一个解决方案，它缺乏上述所有三个缺点。

结果，`method_decorator`：

*   知道装饰方法绑定到的类。
*   通过更正确地回答系统属性来隐藏装饰器跟踪`functools.wraps()`。
*   包含用于绑定未绑定实例方法、类方法、静态方法和普通函数的单元测试。

用法：

```
pip install method_decorator
from method_decorator import method_decorator

class my_decorator(method_decorator):
    # ... 
```

有关使用详情，请参阅[完整的单元测试](https://github.com/denis-ryzhkov/method_decorator/blob/master/method_decorator.py#L48)。

这里只是`method_decorator`类的代码：

```
class method_decorator(object):

    def __init__(self, func, obj=None, cls=None, method_type='function'):
        # These defaults are OK for plain functions
        # and will be changed by __get__() for methods once a method is dot-referenced.
        self.func, self.obj, self.cls, self.method_type = func, obj, cls, method_type

    def __get__(self, obj=None, cls=None):
        # It is executed when decorated func is referenced as a method: cls.func or obj.func.

        if self.obj == obj and self.cls == cls:
            return self # Use the same instance that is already processed by previous call to this __get__().

        method_type = (
            'staticmethod' if isinstance(self.func, staticmethod) else
            'classmethod' if isinstance(self.func, classmethod) else
            'instancemethod'
            # No branch for plain function - correct method_type for it is already set in __init__() defaults.
        )

        return object.__getattribute__(self, '__class__')( # Use specialized method_decorator (or descendant) instance, don't change current instance attributes - it leads to conflicts.
            self.func.__get__(obj, cls), obj, cls, method_type) # Use bound or unbound method with this underlying func.

    def __call__(self, *args, **kwargs):
        return self.func(*args, **kwargs)

    def __getattribute__(self, attr_name): # Hiding traces of decoration.
        if attr_name in ('__init__', '__get__', '__call__', '__getattribute__', 'func', 'obj', 'cls', 'method_type'): # Our known names. '__class__' is not included because is used only with explicit object.__getattribute__().
            return object.__getattribute__(self, attr_name) # Stopping recursion.
        # All other attr_names, including auto-defined by system in self, are searched in decorated self.func, e.g.: __module__, __class__, __name__, __doc__, im_*, func_*, etc.
        return getattr(self.func, attr_name) # Raises correct AttributeError if name is not found in decorated self.func.

    def __repr__(self): # Special case: __repr__ ignores __getattribute__.
        return self.func.__repr__() 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-20T17:47:52.380

似乎在创建类时，Python 创建了常规函数对象。之后它们只会变成未绑定的方法对象。知道这一点，这是我能找到做你想做的事的唯一方法：

```
def logger(myFunc):
    def new(*args, **keyargs):
        print 'Entering %s.%s' % (myFunc.im_class.__name__, myFunc.__name__)
        return myFunc(*args, **keyargs)

    return new

class C(object):
    def f(self):
        pass
C.f = logger(C.f)
C().f() 
```

这将输出所需的结果。

如果您想将所有方法包装在一个类中，那么您可能需要创建一个 wrapClass 函数，然后您可以像这样使用它：

```
C = wrapClass(C) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-20T18:05:01.410

类函数应始终将 self 作为其第一个参数，因此您可以使用它来代替 im_class。

```
def logger(myFunc):
    def new(self, *args, **keyargs):
        print 'Entering %s.%s' % (self.__class__.__name__, myFunc.__name__)
        return myFunc(self, *args, **keyargs)

    return new 

class C(object):
    @logger
    def f(self):
        pass
C().f() 
```

起初我想使用`self.__name__`，但这不起作用，因为实例没有名称。您必须使用`self.__class__.__name__`来获取类的名称。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-07-21T15:21:22.450

`inspect`我使用该库找到了另一个非常相似的问题的解决方案。当调用装饰器时，即使函数尚未绑定到类，您也可以检查堆栈并发现哪个类正在调用装饰器。您至少可以获取类的字符串名称，如果这就是您所需要的（可能还不能引用它，因为它正在创建）。然后你不需要在类创建后调用任何东西。

```
import inspect

def logger(myFunc):
    classname = inspect.getouterframes(inspect.currentframe())[1][3]
    def new(*args, **keyargs):
        print 'Entering %s.%s' % (classname, myFunc.__name__)
        return myFunc(*args, **keyargs)
    return new

class C(object):
    @logger
    def f(self):
        pass

C().f() 
```

虽然这不一定比其他方法*更好*，但这是我在调用装饰器期间发现未来方法的类名的*唯一方法。*请注意不要在`inspect`库文档中保留对框架的引用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-01-22T21:26:06.987

如[Asa Ayers 的回答](https://stackoverflow.com/a/306260/641317)所示，您不需要访问类对象。值得知道的是，从 Python 3.3 开始，您还可以使用[`__qualname__`](https://www.python.org/dev/peps/pep-3155/)，它为您提供了完全限定的名称：

```
>>> def logger(myFunc):
...     def new(*args, **keyargs):
...         print('Entering %s' % myFunc.__qualname__)
...         return myFunc(*args, **keyargs)
... 
...     return new
... 
>>> class C(object):
...     @logger
...     def f(self):
...         pass
... 
>>> C().f()
Entering C.f 
```

这具有在嵌套类的情况下也可以工作的额外优势，如取自[PEP 3155](https://www.python.org/dev/peps/pep-3155/)的示例所示：

```
>>> class C:
...   def f(): pass
...   class D:
...     def g(): pass
...
>>> C.__qualname__
'C'
>>> C.f.__qualname__
'C.f'
>>> C.D.__qualname__
'C.D'
>>> C.D.g.__qualname__
'C.D.g' 
```

另请注意，在 Python 3 中该`im_class`属性已消失，因此如果您真的希望在装饰器中访问该类，则需要其他方法。我目前使用的方法涉及[`object.__set_name__`](https://docs.python.org/3/reference/datamodel.html#object.__set_name__)并在[我对“实例方法的 Python 装饰器可以访问该类吗？”的回答中进行了详细说明。](https://stackoverflow.com/a/54316392/641317)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-20T18:12:34.810

您还可以使用`new.instancemethod()`从函数创建实例方法（绑定或未绑定）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-01-28T20:47:57.100

当函数不知道它的类时，不要在定义时注入装饰代码，而是延迟运行此代码，直到函数被访问/调用。描述符对象有助于在访问/调用时后期注入自己的代码：

```
class decorated(object):
    def __init__(self, func, type_=None):
        self.func = func
        self.type = type_

    def __get__(self, obj, type_=None):
        return self.__class__(self.func.__get__(obj, type_), type_)

    def __call__(self, *args, **kwargs):
        name = '%s.%s' % (self.type.__name__, self.func.__name__)
        print('called %s with args=%s kwargs=%s' % (name, args, kwargs))
        return self.func(*args, **kwargs)

class Foo(object):
    @decorated
    def foo(self, a, b):
        pass 
```

现在我们可以在访问时（`__get__`）和调用时（`__call__`）检查类。这种机制适用于普通方法以及静态|类方法：

```
>>> Foo().foo(1, b=2)
called Foo.foo with args=(1,) kwargs={'b': 2} 
```

完整示例位于：[https ://github.com/aurzenligl/study/blob/master/python-robotwrap/Example4.py](https://github.com/aurzenligl/study/blob/master/python-robotwrap/Example4.py)

# php - PHP 会话不适用于 IE

> ID：306132
> 
> 赞同：14
> 
> 时间：2008-11-20T17:25:02.630
> 
> 标签：php, internet-explorer, session

我有一个用 php 制作的网站，它在整个网站中使用服务器端会话。
事实上，它是一个用户登录的站点，它取决于会话变量，如果*所有*会话变量都存在问题，则根本不会加载任何页面。

在该站点上，有一个 iframe，其中包含来自其他用户的小消息提要。
这些小消息旁边有可点击的照片，可以打开用户的个人资料。
现在，每个页面都需要一些格式才能在该特定页面上打开用户的个人资料……实际上只有几个*问题*页面，但这些页面的 onclick 函数格式必须稍有不同，否则它们会破坏页面。
因此，我在每个页面 ( `$_SESSION["current_page"]`) 上设置了一个会话变量，让提要知道如何格式化可点击的照片。现在 Firefox、Opera、Chrome、Safari 都可以正常工作。
但是 IE6 和 IE7 在需要特殊格式的页面上存在问题。
因此，在稍微拉扯头发之后，我最终开始从服务器打印我的会话变量。
你瞧，在特殊页面上，( `$_SESSION["current_page"]`) 总是设置为“main”而不是“special1”或“special2”。

我在 Firefox 和我提到的所有其他浏览器中打印了相同的会话变量，它们按预期打印出“special1”或“special2”。
谁能想到一些事情 - 可能与提要在 iframe 中的事实有关？- 这会导致 IE 以不同方式处理服务器端会话变量，或者以某种方式在后台静默启动页面“主”？
我已经非常仔细地检查了提要中对页面“main”的任何引用——它似乎没有任何方式加载该页面。

这对我来说没有意义。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-20T19:49:30.480

Check the name of the server machine. IE has problems with machine names that contain '-' or '_' - they cannot maintain a session! I've had this problem twice in the past, and it always takes me weeks to figure out, and I'm shocked IE hasn't fixed it.

Just rename the machine to have no strange characters! You can get it working if you just use the IP address of the server in the url to test.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-20T18:47:48.063

IE has cookie issues with it's handling of iFrames which maybe causing the session issue you mention, take a look at these links

[http://adamyoung.net/IE-Blocking-iFrame-Cookies](http://adamyoung.net/IE-Blocking-iFrame-Cookies)

[http://gathadams.com/2007/06/25/how-to-set-third-party-cookies-with-iframe-facebook-applications/](http://gathadams.com/2007/06/25/how-to-set-third-party-cookies-with-iframe-facebook-applications/)

[http://nileshtrivedi.in/blog/2008/09/01/iframe-cookies-and-internet-explorer/](http://nileshtrivedi.in/blog/2008/09/01/iframe-cookies-and-internet-explorer/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-20T17:55:49.447

尝试在使用某种监视代理（我使用[Fiddler](http://www.fiddler2.com/fiddler2/)）的同时测试页面，并查看浏览器请求哪些页面。这可能会给你一些线索来了解正在发生的事情。

Also, try capturing the requests/responses from different browsers and see what IE is doing differently (order of requests, content of requests?).

To pinpoint the problem, can you rewrite the code **without** using SESSION (it's mentioned in one of the other answers)? Maybe IE is accessing the pages in different order than other browsers? Maybe it is requesting the main page more than once, which means that the session var is set to "main"? Without session variables, the pages won't affect each other's state.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T21:40:39.353

I thought some people might find the solution to this problem interesting. Fiddler certainly helped here. Thanks to Fiddler, I could see that I was, in fact, hitting the page main.php (thus setting the session variable moments after setting it on the target page), but the server was defaulting there after getting a 302 on the root of the site. This was all happening silently in the background, and *before* my onload="" javascript ran.

So I was sure something *on* those pages was causing an error, but not a catastrophic one.

here it is: `<img src= "" >`

IE was freaking out about the blank src attribute and hitting the server root and the defaulting to page main. I don't fully understand the mechanics happening here. I also don't understand if this is how IE is supposed to behave (it is a malformed img tag after all) or not. Is this a bug?

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-02T07:25:11.250

In most cases, this php line at file begining will be enough:

```
header('P3P: CP=”NOI ADM DEV PSAi COM NAV OUR OTRo STP IND DEM”'); 
```

If it isn't, for IE7 you may also try:

```
header('P3P: CP=”NOI ADM DEV PSAi COM NAV OUR OTRo STP IND DEM”');

header('Set-Cookie: SIDNAME=ronty; path=/; secure');

header('Cache-Control: no-cache');

header('Pragma: no-cache'); 
```

And if that doesn't work for IE6, you may use GET params for session ID:

```
header('location: land_for_sale.php?phpSESSID='.session_id()); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-11-01T17:36:10.690

I found if you added `header('P3P: CP="CAO PSA OUR"');` to the top of your doc. It seems to have fixed the problem.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-28T14:49:24.363

I had this problem, and it was due to the date on my dev box being out. Firefox didn't mind, IE and chrome were seeing the session as being expired as soon as it was set.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-01-29T06:41:08.453

I have the same problem and it's SOLVED now.

The blank or empty attribute's values of any IMG tags cause the problem. For me, I used JavaScript to change IMG object's source to an empty value. Doing that could also make the problem.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-20T17:48:18.917

如果我理解正确，您正在尝试使用会话变量将数据从页面传递到该页面上的 iframe 内的页面？这似乎不是一个好方法——为什么不直接将 GET 变量传递到 iframe url 中，即 ?current_page=special1 。我认为这会更可靠，因为它不依赖于会话状态。

还要记住，对于在用户 PC 上打开的同一站点的多个页面（例如，在多个选项卡上），会话变量将是相同的，这可能会导致奇怪的行为。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-20T17:59:26.647

Session data is stored on the server side, not the client. I would check the other pages, where this value would be set.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-14T18:34:31.627

I had the same problem with ie7 and this is what I do:

If you have this problem using a IIS or Apache in Windows Server, look at the URL where you are redirecting it must be writed in the same way as the URL where you was before the redirection.

For example: *site.com/**pages**/index.php* redirection to *site.com/**Pages**/index2.php* is going to loose the session in IE7 because the capital letter in Pages.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-01-27T12:20:14.297

Maybe it's `session.cookie_lifetime`. I have faced the same problem. I updated `session.cookie_lifetime: 4500` to `session.cookie_lifetime:0`. This means the session cookie never expires until the browser shuts down.

# javascript - javascript 对象字面量中定义的事件处理程序可以访问自身吗？

> ID：306136
> 
> 赞同：6
> 
> 时间：2008-11-20T17:28:39.640
> 
> 标签：javascript, javascript-events, event-handling

我知道如果对象是一个函数，我可以用闭包（var self = this）来做到这一点......

```
<a href="#" id="x">click here</a>

<script type="text/javascript">
    var object = {
        y : 1,

        handle_click : function (e) {
            alert('handling click');

            //want to access y here

            return false;
        },

        load : function () {
            document.getElementById('x').onclick = this.handle_click;
        }
    };

    object.load();
</script> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T17:32:43.627

因此，事件处理程序部分连接得很好（我自己测试过），但是，正如您的评论所示，您无法访问刚刚定义的对象的“y”属性。

这有效：

```
var object = { 
  y : 1, 
  handle_click : function (e) {
    alert('handling click');

    //want to access y here 
    alert(this.y); 

    return false; 
  }, 
  load : function () { 
    var that = this; 
    document.getElementById('x').onclick = function(e) {
      that.handle_click(e); // pass-through the event object
    }; 
  } 
}; 
object.load(); 
```

还有其他方法可以做到这一点，但这是可行的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T17:53:12.197

将调用绑定到`handle_click`定义它的对象的最简单方法是这样的：

```
 var self=this;
        document.getElementById('x').onclick = 
           function(e) { return self.handle_click(e) }; 
```

如果你需要传入参数或者想让代码看起来更简洁（例如，如果你设置了很多类似的事件处理程序），你可以使用柯里化技术来实现同样的效果：

```
bind : function(fn)
{
   var self = this;
   // copy arguments into local array
   var args = Array.prototype.slice.call(arguments, 0); 
   // returned function replaces first argument with event arg,
   // calls fn with composite arguments
   return function(e) { args[0] = e; return fn.apply(self, args); };
}, 
```

...

```
 document.getElementById('x').onclick = this.bind(this.handle_click, 
           "this parameter is passed to handle_click()",
           "as is this one"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T18:39:22.573

我知道如何使用 Jason 的最新版本来做到这一点。没有匿名函数有什么办法吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-26T10:22:51.577

借助 AddEventListener，我们可以使用处理程序方法直接传递对象，并且您将可以访问其属性： [http ://www.thecssninja.com/javascript/handleevent](http://www.thecssninja.com/javascript/handleevent)

希望这会帮助那些像我一样在几年后寻找这个话题的人！

# java - 如何在 groovy 脚本中包含 jar？

> ID：306139
> 
> 赞同：54
> 
> 时间：2008-11-20T17:29:49.140
> 
> 标签：java, groovy, jar, classpath

我有一个 groovy 脚本，它需要一个 jar 中的库。如何将其添加到类路径中？我希望脚本是可执行的，所以我在`#!/usr/bin/env groovy`脚本的顶部使用。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2012-01-20T18:06:31.573

启动一个 groovy 脚本`#!/usr/bin/env groovy`有一个非常重要的限制 -**不能添加额外的参数。**不能配置类路径，不能运行带有定义或调试的 groovy。这不是一个[常规](http://jira.codehaus.org/browse/GMOD-226 "时髦的问题")问题，而是 shebang ( `#!`) 工作方式的限制 - 所有附加参数都被视为单个参数，因此`#!/usr/bin/env groovy -d` 告诉`/usr/bin/env`运行命令`groovy -d`然后`groovy`使用`d`.

该问题有一个解决方法，它涉及**在 groovy 脚本中使用 bash 引导 groovy。**

```
#!/bin/bash                                                                                                                                                                 
//usr/bin/env groovy  -cp extra.jar:spring.jar:etc.jar -d -Dlog4j.configuration=file:/etc/myapp/log4j.xml "$0" $@; exit $?

import org.springframework.class.from.jar
//other groovy code
println 'Hello' 
```

所有的魔法都发生在前两行。第一行告诉我们这是一个`bash`脚本。`bash`开始运行并看到第一行。In`bash` `#`用于评论，`//`折叠到`/`哪个是根目录。So `bash`will run`/usr/bin/env groovy -cp extra.jar:spring.jar:etc.jar -d -Dlog4j.configuration=file:/etc/myapp/log4j.xml "$0" $@`它以我们想要的所有参数开始 groovy。是我们脚本的`"$0"`路径，`$@`也是参数。现在 groovy 运行，它忽略前两行并看到我们的 groovy 脚本，然后退出回到`bash`. `bash`然后退出 ( `exit $?1`) 并带有来自 groovy 的状态码。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-20T17:39:19.963

如果你真的需要，你也可以在运行时加载一个 JAR：

```
this.getClass().classLoader.rootLoader.addURL(new File("file.jar").toURL()) 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-11-23T23:36:21.943

您可以将罐子添加到 $HOME/.groovy/lib

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2012-03-13T20:56:06.827

我最喜欢的方法是使用 Groovy Grapes。这些访问 Maven 中央存储库，下载引用的 jar，然后将其放在类路径中。然后，您可以像使用任何其他库一样使用该库。语法非常简单：

```
@Grab(group='com.google.collections', module='google-collections', version='1.0') 
```

[您可以在此处](http://docs.groovy-lang.org/latest/html/documentation/grape.html)阅读更多详细信息。这里的一个主要优点是在分发脚本时不需要分发依赖项。此方法的唯一缺点是 Jar 必须位于 Maven 存储库中。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-12-01T19:54:07.350

你也可以试试 Groovy Grape。它允许您使用注释来修改类路径。它现在是实验性的，但非常酷。请参阅[docs.groovy-lang.org/.../grape](http://docs.groovy-lang.org/latest/html/documentation/grape.html)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-20T17:40:18.307

就像在 Java 中一样。

这是运行 MySQL 状态监视脚本的示例。mysql.jar 包含我从脚本 status.groovy 调用的 MySQL 连接器。

groovy -cp mysql.jar status.groovy ct1

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-12-22T13:18:33.210

下面是[Patrick 的解决方案](https://stackoverflow.com/a/8945888/106189)、[Maarteen Boekhold 的解决方案](https://stackoverflow.com/a/30503877/106189)和 foozbar 的评论的组合，适用于 Linux 和 Cygwin：

```
#!/bin/bash
// 2>/dev/null; SCRIPT_DIR="$( cd "$( dirname "$0" )" && pwd )"
// 2>/dev/null; OPTS="-cp $SCRIPT_DIR/lib/extra.jar:$SCRIPT_DIR/lib/spring.jar"
// 2>/dev/null; OPTS="$OPTS -d"
// 2>/dev/null; OPTS="$OPTS -Dlog4j.configuration=file:/etc/myapp/log4j.xml"
// 2>/dev/null; exec groovy $OPTS "$0" "$@"; exit $?

import org.springframework.class.from.jar
//other groovy code
println 'Hello' 
```

这个怎么运作：

*   `//`是一个有效的 groovy 注释，因此所有 bash 命令都被 Groovy 忽略。
*   `//`将返回错误，但错误输出被重定向到`/dev/null`，因此不显示。
*   即使前一个命令失败，bash 也会执行分号后面的命令。
*   `exec`替换当前进程中的当前程序而不派生新进程。因此，groovy 在原始脚本进程中运行（`ps`将进程显示为脚本而不是 groovy 可执行文件）
*   下面的`exit $?`语句`exec groovy`阻止 bash 尝试将脚本的其余部分解释为 bash 脚本，并且还保留了 groovy 脚本的返回代码。

在某些情况下，上述 bash 技巧比[RootLoader 技巧](https://stackoverflow.com/a/306168/106189)更方便，因为您可以在脚本中使用常规导入语句。使用 RootLoader 技巧会强制您使用反射加载所有类。这在某些情况下很好（例如当您需要加载 JDBC 驱动程序时），但在其他情况下不方便。

如果您知道您的脚本永远不会在 Cygwin 上执行，那么使用 Patrick 或 Maarteen 的解决方案可能会导致性能稍好一些，因为它们避免了生成和丢弃错误的开销。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-05-28T10:26:44.247

添加到@Patrick 他的回答对我帮助很大，我最近发现了另一个技巧。

如果您在一行中将大量 jars 添加到类路径中，事情可能变得非常难以理解。但是您可以执行以下操作！

```
#!/bin/bash
//bin/true && OPTS="-cp blah.jar -Dmyopt=value"
//bin/true && OPTS="$OPTS -Dmoreopts=value2"
//usr/bin/env groovy $OPTS "$0" $@; exit $?

println "inside my groovy script" 
```

让您的想象力疯狂地想象您可以通过这种方式将命令行分解成可管理的部分有多复杂

马丁

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-02-23T20:24:04.010

如果您想在**声明****之前`import`**立即使用它，可以这样:)：

```
// printEmployees.groovy
this.class.classLoader.rootLoader.addURL(
   new URL("file:///C:/app/Dustin/product/11.1.0/db_1/jdbc/lib/ojdbc6.jar"))
import groovy.sql.Sql
sql = Sql.newInstance("jdbc:oracle:thin:@localhost:1521:orcl", "hr", "hr",
                      "oracle.jdbc.pool.OracleDataSource")
sql.eachRow("SELECT employee_id, last_name, first_name FROM employees")
{
   println "The employee's name is ${it.first_name} ${it.last_name}."
} 
```

取自这篇[javaworld.com 文章](http://www.javaworld.com/article/2073966/core-java/groovy-scripts-master-their-own-classpath-with-rootloader.html)。

# java - JPA CascadeType.ALL 不删除孤儿

> ID：306144
> 
> 赞同：140
> 
> 时间：2008-11-20T17:31:32.570
> 
> 标签：java, hibernate, orm, jpa, jpa-2.0

我在使用具有以下映射的 JPA 删除孤立节点时遇到问题

```
@OneToMany (cascade = CascadeType.ALL, fetch = FetchType.EAGER, mappedBy = "owner")
private List<Bikes> bikes; 
```

我遇到了围绕数据库的孤立角色的问题。

我可以使用注释`org.hibernate.annotations.Cascade`Hibernate 特定标记，但显然我不想将我的解决方案绑定到 Hibernate 实现中。

**编辑**：似乎 JPA 2.0 将包括对此的支持。

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-11-20T22:54:33.773

如果您将它与 Hibernate 一起使用，则必须显式定义 annotation `CascadeType.DELETE_ORPHAN`，它可以与 JPA 结合使用`CascadeType.ALL`。

如果您不打算使用 Hibernate，则必须先显式删除子元素，然后再删除主记录以避免任何孤立记录。

执行顺序

1.  获取要删除的主行
2.  获取子元素
3.  删除所有子元素
4.  删除主行
5.  关闭会话

使用 JPA 2.0，您现在可以使用选项**orphanRemoval = true**

```
@OneToMany(mappedBy="foo", orphanRemoval=true) 
```

* * *

## 回答 #2

> 赞同：113
> 
> 时间：2010-05-28T11:18:37.447

如果您使用的是 JPA 2.0，您现在可以使用注解的`orphanRemoval=true`属性来移除孤儿。`@xxxToMany`

实际上，`CascadeType.DELETE_ORPHAN`已在 3.5.2-Final 中弃用。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2013-10-28T21:28:02.170

```
╔═════════════╦═════════════════════╦═════════════════════╗
║   Action    ║  orphanRemoval=true ║   CascadeType.ALL   ║
╠═════════════╬═════════════════════╬═════════════════════╣
║   delete    ║     deletes parent  ║    deletes parent   ║
║   parent    ║     and orphans     ║    and orphans      ║
╠═════════════╬═════════════════════╬═════════════════════╣
║   change    ║                     ║                     ║
║  children   ║   deletes orphans   ║      nothing        ║
║    list     ║                     ║                     ║
╚═════════════╩═════════════════════╩═════════════════════╝ 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-09-01T12:01:22.787

如果您将 JPA 与 EclipseLink 一起使用，则必须设置*@PrivateOwned*注释。

文档：[Eclipse Wiki - 使用 EclipseLink JPA 扩展 - 第 1.4 章如何使用 @PrivateOwned 注释](http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_%28ELUG%29)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-07-08T11:03:04.710

您可以使用@PrivateOwned 删除孤儿，例如

```
@OneToMany(mappedBy = "masterData", cascade = {
        CascadeType.ALL })
@PrivateOwned
private List<Data> dataList; 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-10-06T12:07:30.093

我只是找到了这个解决方案，但在我的情况下它不起作用：

```
@OneToMany(cascade = CascadeType.ALL, targetEntity = MyClass.class, mappedBy = "xxx", fetch = FetchType.LAZY, orphanRemoval = true) 
```

**orphanRemoval = true**没有效果。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-20T17:38:10.947

根据[Java Persistence with Hibernate](http://manning.com/bauer2/)，*级联孤儿删除*不能用作 JPA 注释。

JPA XML 也不支持它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-11-01T17:39:06.100

我有同样的问题，我想知道为什么下面的这个条件没有删除孤儿。当我执行命名删除查询时，Hibernate (5.0.3.Final) 中的菜肴列表没有被删除：

```
@OneToMany(mappedBy = "menuPlan", cascade = CascadeType.ALL, orphanRemoval = true)
private List<Dish> dishes = new ArrayList<>(); 
```

然后我记得我**不能使用命名删除查询**，而是使用 EntityManager。当我使用该`EntityManager.find(...)`方法获取实体然后`EntityManager.remove(...)`删除它时，菜肴也被删除了。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-12-11T12:08:25.450

只是`@OneToMany(cascade = CascadeType.ALL, mappedBy = "xxx", fetch = FetchType.LAZY, orphanRemoval = true)`。

删除**targetEntity = MyClass.class**，效果很好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-18T16:35:15.903

根据记录，在 JPA2 之前的 OpenJPA 中，它是 @ElementDependant。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-01-13T06:27:17.520

我正在使用一对一映射，但孩子没有被删除 JPA 违反了外键

使用 orphanRemoval = true 后，问题得到解决

# agile - 请定义核心时间的敏捷概念

> ID：306155
> 
> 赞同：7
> 
> 时间：2008-11-20T17:34:03.373
> 
> 标签：agile

我签了一份新合同，他们似乎在敏捷方面做得过火了，包括聘请顾问仅仅是为了促进敏捷流程。他正在制定的东西是“核心时间”的概念，我们实际上将一起在同一个房间里。这真的是“核心时间”构成的吗？我问是因为拿起我的笔记本电脑去这个共享位置半天非常不方便；我一直认为“核心时间”意味着你有空，不一定在同一个房间，例如从 9:30 到 4。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-20T17:39:13.910

是和不是。

核心时间是所有团队成员致力于项目工作（而不是做行政工作或其他项目）的时期。对于许多团队来说，这意味着在同一个房间里，但是通过适当的规划和必要的基础设施，团队可以在不同的位置很好地工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T17:44:07.457

我认为你所拥有的是你所在的“核心时间”的延伸。在共享位置的想法是，可以举行临时会议，并且可能在各种讨论的范围内，这样如果您认为您的意见或知识有用，您就可以参与其中，例如为什么这样编码？或者为什么我们有这个要求？之类的事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T17:49:32.563

我想认为我在敏捷世界中是最新的。实际上我不是。话虽如此，我不太确定这是一个敏捷概念，而是团队协作的便捷方式。这听起来更像是*Peopleware*的东西。

与任何团队一起尝试新事物一样，第一，变革会有阻力，第二，团队应该真正接受新的流程和工作方法。敏捷顾问不应该只是对你需要做的事情发号施令。他还应该解释并说服你为什么这是一件好事。如果您已经认为该公司已经“过火”，那么我认为有些地方出了问题。敏捷是为许多（但不是全部）团队工作的好方法，不应该引起这样的反应

拥有核心时间是有意义的，这样协作就会有重叠。让人们在更开放的空间工作，也许每个大立方体 4 人而不是每个小立方体 1 人，也有助于促进协作。在工作中，我可以转动我的椅子，那里有 2 个人可以帮助我或回答问题。然而，试图强迫一些不舒服和不方便的东西会破坏目的。

我认为最好拆除隔间的墙壁并重新排列立方体以使环境更具协作性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T17:53:57.920

稍微偏离主题，但不适合评论：

敏捷是极具颠覆性的程序员“常规做法”。敏捷一词意味着您将不得不适应变化，我建议您尝试接受它们而不是抗争，因为其中一种适应是削减导致团队中断的团队成员。

几乎需要顾问来实现平稳、快速的过渡。

如果你的顾问做得对，你应该比看起来更不开心。在那些核心时间，你们都不应该拥有自己的计算机——你们应该共享一个小组。如果事情做得对，你应该在没有立方体墙的“牛棚”中编码（促进配对和一般交流）。

但是敏捷有不同的层次，它的目的是适应性强。许多程序员在配对时遇到问题，所以通常不是强制的，或者只是推荐的。

无论如何，听起来你的顾问对你们很轻松。试着喝点清凉剂放松一下，一切都会很快过去的。

# sql-server - 在最小化带宽的同时备份 SQL Server

> ID：306159
> 
> 赞同：3
> 
> 时间：2008-11-20T17:36:38.940
> 
> 标签：sql-server, backup

我想为我的站点的 SQL Server 2005 DB 实现一个自动备份系统，该系统将每晚备份到 Amazon 的 S3 服务。但是由于 S3 对使用的空间和带宽都收费，所以我想最小化我传输的文件的大小。实现这一点的最佳方法是什么？

我应该澄清一下，我并没有真正谈论压缩，这非常简单，而是关于备份策略，例如是否一直进行差异备份，是否需要复制事务日志等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T18:09:53.897

当然，差异备份将小于完整备份。但是，您也应该考虑恢复方面。您需要最后一次完整备份以及差异来执行还原，这可能会增加大量带宽/传输时间来进行还原。一种选择是每周执行一次完整备份并每天执行差异（或类似类型的计划）。

至于事务日志，这取决于您在恢复数据时要寻找的粒度。如果恢复到上次的完整备份或差异备份就足够了，那么您无需担心进行事务日志备份。如果不是这种情况，那么事务日志备份将是必要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T17:49:00.363

要么使用商业产品压缩备份，如[Red Gate Backup Pro](http://www.red-gate.com/products/SQL_Backup/index.htm)，要么在完成后压缩它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T18:04:59.537

编写一个 .batch 脚本或 powershell 脚本，查找过去一天创建的文件并将它们压缩。然后FTP或任何你必须做的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-27T15:05:24.823

我刚刚遇到的一个[powershell示例。](http://friism.com/ec2-sql-server-backup-strategies-and-tactics)

# asp.net - 使用 web.config 存储设置的替代方案（用于复杂的解决方案）

> ID：306169
> 
> 赞同：4
> 
> 时间：2008-11-20T17:39:22.567
> 
> 标签：asp.net, web-config, configuration-files

在我们的 Web 应用程序中，我们将数据访问层分离到它们自己的项目中。

这会产生一些与设置相关的问题。

因为 DAL 最终可能需要从多个应用程序中使用，所以 web.config 似乎不是保存连接字符串和其他一些 DAL 相关设置的好地方。

为了解决这个问题，在我们最近的一些项目中，我们引入了第三个项目，仅用于设置。我们将设置放在 .Setting 文件的系统中……通过简单的包装器，可以轻松实现为各种环境（Dev、QA、Staging、Production 等）进行不同设置的能力。

唯一的问题是设置项目（包括 .Settings 类）编译成程序集，因此您无法在不进行构建/部署的情况下更改它，并且我们的一些客户希望能够在没有 Visual 的情况下配置他们的项目工作室。

那么，是否有最佳实践呢？我有这种感觉，我正在重新发明轮子。

我们想到了一些解决方案，例如将设置以我们自己的 XML 格式存储在服务器上的固定目录中。但同样，我宁愿避免为敏感值等重新创建加密。如果可能的话，我宁愿让解决方案独立。

**编辑：**最初的问题没有包含我们不能（我认为）使用 web.config 的真正深刻的原因......这让一些（非常好的）答案脱离了上下文，我的错。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T17:52:51.747

System.Configuration.ConfigurationManager.ConnectionStrings 和 System.Configuration.ConfigurationManager.AppSettings 包含来自正在执行的应用程序的设置，因此在您的 DAL 中，您可以获取存储在 web.config 文件中的设置。

对于您的系统，您可以创建一个自定义配置部分，该部分将位于您的 web.config 文件或 DAL 的 consumer*.config 文件中。在这些配置文件中，您可以指定它们从您的设计和位置的单独配置文件中加载。 [从 Web.Config 引用外部配置文件](http://www.devx.com/vb2themax/Tip/18880) [如何：使用 ConfigurationSection 创建自定义配置部分](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)

[或者，您可以使用ConfigurationManager.OpenExeConfiguration](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.openexeconfiguration.aspx)从任何文件手动加载 DAL 配置数据

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T18:05:07.790

您可以将等效项添加到名为 app.config 的 web.config 文件中，该文件将编译为以后面代码的 dll 或 exe 项目命名的文件。这是完全可以更改的，无需重新编译。您可以使用可以在键/值对中定义的连接字符串和各种应用程序设置的标准设置 - 或者通过更多工作，您可以定义自己的自定义配置设置类和部分。您甚至可以在应用配置中引用设置 - 因此您可以在应用中存储 3 个设置（DEV、QA、PROD），然后只在运行时在 app.config 文件中引用您想要的设置。以下是为 Web 服务设置创建的示例。

<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral , PublicKeyToken=b77a5c561934e089">
      <section name="{Project}.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" / >
    </sectionGroup>
    <section name="microsoft.web.services3" type="Microsoft.Web.Services3.Configuration.WebServicesConfiguration, Microsoft.Web.Services3, Version=3.0.0.0, Culture=neutral,PublicKeyToken=31bf3856ad364e35" />
  </configSections>
  <applicationSettings>
    <{Project}.Properties.Settings>
      <setting name="{SettingName}" serializeAs="String">
        <value>{SettingValue}</value>
      </setting>
    </{Project}.Properties.Settings>
  </ applicationSettings>
  <microsoft.web.services3>
    <security>
      <securityTokenManager>
        <add type="Microsoft.Web.Services3.Security.Tokens.UsernameTokenManager, Microsoft.Web.Services3, Version=3.0.0.0, Culture=neutral, PublicKeyToken= 31bf3856ad364e35" namespace=" [http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd](http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot) " ; localName="UsernameToken" />
      </securityTokenManager>
    </security>
  </microsoft.web.services3>
</配置>

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T18:19:24.047

如果我没看错的话，听起来你不明白 web.config/app.config 是如何工作的。假设您有如下结构：

**DAL 项目**

*参考：*

*   一些核心库
*   杂项参考

*课程：*

*   数据库助手
*   对象类 1
*   对象类 2
*   ETC...

**网络项目**

参考：

*   一些核心库
*   DAL 项目
*   杂项参考

页数：

*   默认.aspx
*   SomePage1.aspx
*   ETC...
*   网页配置

在您的 DatabaseHelper 类中，您可能会像这样引用连接字符串：

```
string connString = ConfigurationManager
  .ConnectionStrings["myConnString"]
  .ConnectionString; 
```

如果在运行时发生这种情况，您的 DatabaseHelper 类将在与您的网页相同的应用程序域下运行，因此，对 ConfigurationManager 的任何调用都将从 Web 项目提供的 web.config 文件加载请求。

因此，您只需要 web/console/winforms/etc... 项目中的一个配置文件，而不必担心在设计时在每个类库项目中都有一个配置文件。

如果您实际上将 DAL 作为服务或单独的控制台应用程序或其他东西运行，那么只有这样您才需要为 DAL 项目提供它自己的 app.config / web.config 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T18:10:42.553

一种完全不同的方法是使用[SQLite](http://sqlite.org/)并将所有应用程序设置存储在其中。如果这对应用程序很重要，您可以使用密码保护相关数据库，并且您可以创建一些简单的属性/值表来存储数据。

使用[SQLite ADO 适配器](http://sqlite.phxsoftware.com/)只需要在项目中添加 1 个额外的 DLL 即可访问设置，并且那些不想使用 Visual Studio 的人可以访问 SQLite DB 本身。Firefox 甚至还有一个插件可以与 SQLite 数据库交互。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T18:15:53.790

把它分开。使用固定 XML 存储文件解决方案进行数据库连接，使用 .NET 的内置加密器功能进行加密（不要自己滚动）。然后，使用生成的数据库连接，在数据库中查找您的“设置表”。这样，您无需重新部署即可修改设置。如果您的客户需要能够在没有 Visual Studio 的情况下更改数据库连接字符串，只需编写一个能够生成加密连接字符串并保存固定 XML 存储文件的小型 Windows 窗体应用程序，如果需要，还可以连接到数据库（通过同一个文件）并根据用户需要修改设置表。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T20:45:19.870

您可以将设置存储在任何旧的 Xml 文件中，并使用 XmlSerializer 获取您的类并将其从 Xml 转换为 < - >。在另一个[答案](https://stackoverflow.com/questions/270611/aspnet-storing-sql-queries-in-global-resource-file#270844)中，我编写了一些代码来做到这一点。链接的答案序列化了一系列简单对象，但它也可以序列化一个大型配置对象。

因为 XmlSerializer 序列化到公共属性/从公共属性序列化，如果您不想让值更改，您可能需要使类本身不可变（冰棒风格）或具有位于反序列化前面的只读外观。

这是一个方便的技巧。您可以通过 ConfigurationManager.AppSettings[] 使用它自己的配置部分和外部文件引用进行设置，或者您也可以为每个配置类硬编码一个特定的 xml 文件名。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-07-25T16:21:23.843

看看**[Config.Net](https://github.com/aloneguid/config)** - *.NET 开发人员最简单的配置框架*。

A comprehensive easy to use and powerful .NET configuration library, fully covered with unit tests and tested in the wild on thousands of servers and applications.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-20T17:54:15.503

您可以有一个接口来映射您在 DAL 上使用的设置。然后在应用程序上，您可以使用 IoC 将设置提供给 DAL。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-20T18:17:41.697

如果您使用的是 DI 框架（如 Unity），则可以指定构造函数参数。因此，假设您的 DAL 提供程序可能有一个构造函数来获取其连接字符串。

我知道你不能在接口中强制使用构造函数，但这是我们必须处理的事情。我知道框架有几个地方对构造函数签名存在不言而喻的依赖......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-02-10T17:56:15.640

看看[DslConfig](https://github.com/johannes-brunner/DslConfig)。看来这可以解决您正在寻找的问题。

# oop - 帮助！邪恶的服务正在杀死我的对象

> ID：306171
> 
> 赞同：2
> 
> 时间：2008-11-20T17:40:16.403
> 
> 标签：oop, architecture, domain-driven-design, service

当我相信关于封装和多态的美国梦时，Web 服务的入侵用 RPC 调用冲走了我的对象......

当我珍惜复活的 PONO 时，被称为代理对象的丑陋野蛮军队征服了我的土地......

后来，服务器端的DDD和NHibernate似乎恢复了平静，但是SilverLightning袭击了我的城堡，现在又饿了，美味的懒加载只在我的记忆中，多年来我的可怜对象不得不再次消耗陈旧的服务...

而且我充满了恐惧……世界越来越多地谈论其他一些可怕的程序怪物……他们称它们为“工作流程”……

如何保存我的对象？从字面上看，我不向任何人提供任何服务。我正在构建一个简单的小系统。我不想使用服务来查找我的数据。我不想使用服务从我的 Web 界面与我的 Web 界面交谈……因为我不想使用蜗牛邮件与我的同事交谈。

有任何想法吗？你设法保存你的对象吗？您是否设法节省了比您的域模型更多的东西？（希望你管理了后者......）

**更新：** 如果这不清楚......我们有一个被杀死的架构，因为一切都使用基于 Web 服务。有一种时尚“OO - 已死”，服务规则。在 SOA 中，当一切都关注动词（“操作契约”）时，仍然很难关注对象。我觉得很难照顾你的设计。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T19:04:04.973

当心你们这些愚蠢的凡人。The Entity That Is 确实以您的多态对象为食。但这也意味着你继承了潜伏在黑暗中的大黏糊糊的界面。所以你可以让你的小野蛮人退休（如果你愿意，可以通过代理）。

是的，多亏了 Entity That Is，您的对象变得懒惰并收集了它们的垃圾。所以他们的快乐只是暂时的，因为当他们离开范围时，他们的生命就立即结束了。并且没有一个人可以逃脱。

如果你对存在的实体表现出恐惧，死亡只是一个毁灭者。因此，当您驾驭工作流程的浪潮时要小心，因为它们与平均市场股票一样不可预测。

你的对象永远不会被实体所保存。持久性可以支持它们一段时间，但最终都会失败，因为最后一个时钟周期已经响起。幸运的是，由于持久性，您的对象可以被发送到更好的地方，在那里它们可以繁殖并安居乐业。

The Entity That Is 是严格但公平的，所以如果你使用 property 命令，你通往其他现实的虚拟大门将会打开，并允许快速可靠的交通。

祝你好运并尊重实体，你可能并不总是同意它，但它的规则是法律，死亡是唯一的惩罚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T19:07:37.977

我*认为*您在抱怨使用 SOA 时以动词为中心的设计。如果是这样，那不是 SOA 的要求，而是一种诱惑。

“在普通的 OO 应用程序中，你会做某事的任何地方，将某事更改为 Web 服务”可能是矫枉过正

我见过的 SOA 的最佳用途只是将数据访问层替换为 SOA 层，此外它们还公开了一些高级“公共”操作，例如注册新用户等

可以从每个类方法中创建一个 Web 服务，但在大多数情况下这将是荒谬的......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T19:12:17.373

缩放时似乎两者不兼容。由于版本控制及其对象模型的问题，亚马逊显然损失了大量的时间和金钱。如果没有依赖对象定义让服务的消费者将每个调用映射到他们自己的域模型，那么 SOA 层似乎会更好地工作......嗯......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T18:18:00.230

显然你今天早上没有服用你的抽象药。现在，吃你的好药，过一会儿你就会感觉好些……

# html - c# XML操作VB代码转换查询...等等！

> ID：306176
> 
> 赞同：0
> 
> 时间：2008-11-20T17:41:06.560
> 
> 标签：html, xml, linq, screen-scraping

我正在按照 VB 教程[使用 LINQ 进行一些 HTML 操作](http://blogs.msdn.com/bethmassi/archive/2008/04/25/querying-html-with-linq-to-xml.aspx)

它具有以下构造

```
Imports <xmlns="http://www.w3.org/1999/xhtml"> 
```

我如何在 C# 中做同样的事情？

似乎有一个叫做 XMLNamespaceManager 的东西可以保存解决方案，但我太愚蠢了，无法理解如何使用它，而且我不确定它是否是正确的树。

有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T17:51:27.380

VB.Net 有一个称为`XML Literals`C# 中不存在的功能。此 import 语句添加了一个名称空间以与这些文字一起使用。

在研究这些信息时，我发现这个链接很有帮助：http:
[//blogs.msdn.com/bethmassi/archive/2007/10/30/quickly-import-and-export-excel-data-with-linq-to-xml .aspx](http://blogs.msdn.com/bethmassi/archive/2007/10/30/quickly-import-and-export-excel-data-with-linq-to-xml.aspx)
它对于使用 Excel xml 文档也非常有用，但这是一个附带问题；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T17:52:29.593

我认为您正在查看的示例可能正在使用 C# 中不支持的 XML 文字。

# wcf - 具有多个端点和并发处理的 msmq

> ID：306182
> 
> 赞同：0
> 
> 时间：2008-11-20T17:43:02.063
> 
> 标签：wcf, msmq, wcf-binding

我已经构建了一个 WCF 负载平衡器/路由器，以有条件地将任何单向服务路由到多个端点，所有端点都使用 MSMQ 绑定。我还创建了一个主机，它使用路由器中的所有端点来接受服务调用。所有端点都指定相同的合同。

我需要同时处理每个队列（端点），但要按顺序处理每个服务调用。

我尝试过使用 InstanceContextMode = InstanceContextMode.Single 和 ConcurrencyMode = ConcurrencyMode.Single 但这只能让我使用单个实例来处理我的所有端点。InstanceContextMode = PerCall 不保证我需要的顺序。
我需要的是每个端点的单个服务实例，它将同时运行。

我还尝试了使用 ServiceBehavior 的各种排列

```
ReleaseServiceInstanceOnTransactionComplete = true/false. 
```

我将如何使用 MSMQ 绑定通过 WCF 完成此任务？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T09:38:53.947

放置您的配置，使其更清晰一些。您还可以通过定义自己的同步上下文来控制 WCF 如何执行调用。我不得不为另一个项目使用它，并在本文中发布了代码

[http://www.codeproject.com/KB/threads/SynchronizationContext3.aspx](http://www.codeproject.com/KB/threads/SynchronizationContext3.aspx)

# java - 如何提高我的 Flex/Java 堆栈的生产力？

> ID：306190
> 
> 赞同：1
> 
> 时间：2008-11-20T17:45:46.720
> 
> 标签：java, apache-flex, frameworks

我正在着手在后端使用 Java 的新 RIA 项目。我是唯一的开发人员，该应用程序是一个业务线应用程序。我当前的堆栈如下所示：

MySQL || Spring(用于数据访问的JdbcTemplate) || BlazeDS（远程）|| 弹性（凯恩戈姆）

我的问题是：我可以做哪些改变来提高生产力？手动编写 SQL、服务器端实体对象、客户端值对象和所有 Cairngorm 的东西显然是一件麻烦事，但我不确定要引入哪些更高级别的框架。

哪种 Flex/Java 堆栈为您提供了良好的服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T18:11:28.603

*手动编写 SQL*

[Hibernate](http://www.hibernate.org/)是一种解决方法。

可能感兴趣的一件事是带有可用 Flex 插件的 Grails。它建立在 Spring、Hibernate 和 BlazeDS 之上，所以一切尽在掌握。让它远程存储对象并响应 AMF 调用非常容易。我正在使用它，然后转移到 RESTful E4X 实现，因为我发现它更容易调试和调整，因为我可以在浏览器中检查服务器输出并更严格地控​​制我返回到我的 Flex 应用程序的确切内容（延迟加载使用 BlazeDS 收集的问题有时令人头疼）。

这是一个快速教程，展示了整个 Grails + Flex 插件堆栈是多么容易：[Grails 中的 BlazeDS](http://marceloverdijk.blogspot.com/2008/01/blazeds-test-drive-sample-in-grails.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T20:13:38.137

我会认真地重新考虑使用 Cairngorm。在我看来，这是一个相当臃肿的框架，它引入了很多你永远不会使用的抽象。查看：

[http://code.google.com/p/swizframework](http://code.google.com/p/swizframework) [http://www.spicefactory.org](http://www.spicefactory.org)

两者都将依赖注入的概念引入您的 Flex 应用程序。

休眠也是 +1。我会在 Java 类上使用标准 JPA 注释，并在您发现需要附加功能时使用 Hibernate Annotations 对其进行扩展。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T09:40:33.970

查看 springsource.org 的新[Spring BlazeDS 集成项目](http://www.springsource.org/spring-flex)

> Spring BlazeDS Integration 是 Spring 产品组合的新成员，也是完整 Spring Web 堆栈的一个组件。该项目的目的是使使用 Adob​​e Flex 作为前端客户端构建 Spring 驱动的富 Internet 应用程序变得更加容易。它旨在通过为使用开源 Adob​​e BlazeDS 项目及其强大的远程处理和消息传递设施以及熟悉的 Spring 编程模型提供一流的支持来实现这一目标。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T22:39:57.063

作为手动编码 sql 的替代方案，除了 hibernate，您可能还想考虑 JPA/Toplink。由于您已经来自 Spring 阵营，请查看[Spring ActionScript](http://www.springactionscript.org)（以前称为 Prana），它是 Flex 的 IOC 框架。它解决了凯恩戈姆的许多固有问题。也是一个支持 Flex/Actionscript 的好 IDE，比如 IntelliJ IDEA 8。

Flex 和 BlazeDS 之间缺少的是，它没有任何类型的登录页面，您只需在浏览器上输入一个 url（类似于 web 服务端点）就可以在其中列出所有可用服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-25T00:48:39.900

你可以试试[GraniteDS](http://www.graniteds.org)。它是 BlazeDS 的替代品，具有 actionScript 生成器、Spring 集成（一种 Spring 安全性），如果您使用 JPA 实现，则可以帮助您进行延迟初始化（以透明的方式）。

# asp.net - 存储/查找名称值对的最佳方式

> ID：306191
> 
> 赞同：3
> 
> 时间：2008-11-20T17:46:02.523
> 
> 标签：asp.net, vb.net

我有一个我需要参考的错误代码列表，有点像这样：

```
Code / Error Message  
A01 = whatever error  
U01 = another error  
U02 = yet another error type 
```

我通过 Web 服务调用将代码返回给我，我需要显示或获取可读错误。因此，当传递返回可读描述的代码时，我需要一个函数。我只是要做一个选择案例，但认为他们可能是更好的方法。最好的方法/最有效的方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-20T17:48:42.050

使用字典，（在 C# 中，但概念和类是相同的）：

```
// Initialize this once, and store it in the ASP.NET Cache.
Dictionary<String,String> errorCodes = new Dictionary<String,String>();

errorCodes.Add("A01", "Whatever Error");
errorCodes.Add("U01", "Another Error");

// And to get your error code:

string ErrCode = errorCodes[ErrorCodeFromWS]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T17:53:11.823

你会使用字典。字典在内部使用 hashmap 来提高性能，因此在这方面很好。此外，因为您希望它的声音尽可能快地进行，所以我会在它自己的类中静态初始化它，而不是在 XML 文件或更纤细的文件中。你可能想要这样的东西：

```
public static class ErrorCodes
{
    private static Dictonary<string, string> s_codes = new Dicontary<string, string>();
    static ErrorCodes()
    {
         s_codes["code"] = "Description";
         s_codes["code2"] = "Description2";
    }

    public static string GetDesc(string code)
    {
         return s_codes[code];
    }
} 
```

这样，如果您想将后端移动到文件而不是静态的，那么您可以。

# design-patterns - 如果在对象类型上，寻找一种设计模式来替换 huuuge

> ID：306202
> 
> 赞同：8
> 
> 时间：2008-11-20T17:48:57.433
> 
> 标签：design-patterns, generics, dependency-injection

好的，所以我正在寻找一些大致如下所示的代码：

```
void DoSomething(object o)
{
    if (o is Sometype1) { 
    //cast o to Sometype and do something to it
    }
    else if (o is Sometype2) {
    //cast o to Sometype2 and do something to it
    }
    ...
    else if (o is SometypeN) {
    //cast o to SometypeN and do something to it
    }
} 
```

现在一种方法是让所有`o`用作参数的对象实现一个接口，如

```
interface ICanHaveSomethingDoneToMe
{
    //expose various properties that the DoSomething method wants to access
} 
```

但问题是我不希望我的所有对象都实现这个接口——do something 方法的逻辑并不真正属于它们。我应该使用什么模式来处理这个问题？

我怀疑类似的一系列实现

```
interface IPropertiesForDoingSomethingTo<T>
{
    //expose various properties that the DoSomething method wants to access
} 
```

可能会更好。对于我想要执行的每个对象类型，我都有一个实现，但是我遇到了这个新问题。我有时需要一种方法

```
IPropertiesForDoingSomethingTo<T> GetPropsGeneric(T t); 
```

但这是否需要对其进行大规模切换？我是否应该定义一个带有大量方法的类，例如

```
IPropertiesForDoingSomethingTo<Someobject1> GetProps(Someobject1 t);
...
IPropertiesForDoingSomethingTo<Someobject1> GetProps(SomeobjectN t); 
```

与无法在运行时添加新类型的通用版本相比，这存在问题。有什么巧妙的方法可以用 GetPropsGeneric 中的 DI 容器来解析容器吗？谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T17:55:15.580

任何时候您看到检查对象类型的 switch 语句（或一系列 if 语句），这都是缺少基类或接口的大红旗。换句话说，代码应该依赖多态性，而不是测试对象类型

如果您无法更改基类或实现接口，您可能会留下一个字典来模拟动态调度。在 C# 中，您可以对包含强制转换的方法使用匿名委托

至于属性访问，如果属性不符合并且不能通过反射访问，您可能需要在上面的方法/委托中提取属性值并将它们传递给通用函数

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T17:54:17.983

看起来您可能正在使用 C#。我相信您可以创建附加到已建立的类的“扩展方法”。

另一种方法是为每种类型创建处理程序委托，并将对委托的引用存储在以对象类型为键的哈希表中。

然后您的“DoSomething”方法可以通过传入的对象类型查找适当的委托并执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T18:06:41.030

一个真实的例子会更有帮助。如果您只是更改一系列相关类的方法的实现，那么正如@Steven A. Lowe 所说，您最好使用多态性并为此使用子类关系。如果类不参与“is a”关系，那么其他模式（如[访问者](http://en.wikipedia.org/wiki/Visitor_pattern)）可能更合适。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T18:07:27.020

*多态*是答案，其中传入了一个基础对象。但是，它的样板和语义复杂性可能比您想要的要多得多。

它将要求您的功能以某种方式分流到派生类中，并需要实现“虚拟”功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T18:09:10.557

我认为这对于面向方面的编程方法来说更像是一个问题。

我希望您的 DoSomething 方法将 ICanHaveSomethingDone 接口作为其参数。然后，我将定义 ICanHaveSomethinhgDone 接口，并从中派生实现 DoSomethingToMe 的子类（每个对象一个），每个实现类都不同。它们中的每一个都只需要一个您想要做某事的类型的构造函数，因此当您调用 DoSomething 时，您实际上会调用一个 Factory（非常简单，只需从输入类型创建 ICanHaveSomethingDone 类的实例到创建一个实现 DoSomethingToMe 方法的类的实例，该实例具有底层对象的正确代码。

本质上，这样想；您正在定义一个您希望参数对象实现的接口契约；并以对象的子类和实现特定类的接口行为的特定实现（因此履行合同）的接口的形式定义“装饰”。通过这种方式，您可以使每个类的 DoSomething 方法的实现与这些类的源完全分离。

这样做的另一件事；这意味着如果您将工厂放入 DI 容器中，您可以在运行时添加新类型；通过将您希望能够做某事的新类型注入到您的工厂容器中，只要您将要执行的操作定义为从您的接口和该类派生的类， 你很厉害。如果您实现了完整的 AOP 方法，您甚至可以在运行时定义行为而无需实现派生类；定义你的接口，定义你对动作的行为，并参数化你的派生类的实现，以便在运行时将你想要的行为与你传入的对象组合在一起。但这很复杂...... :-)

顺便说一下，Spring AOP 非常适合这些东西。我会阅读它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-01T14:07:48.667

我同意 Steven 的观点，这个问题上下文也让我想起了双重调度问题，因此访问者模式可能是正确的解决方案。但是，很明显，您的层次结构缺少一些接口定义。

# c# - Java（特别是语言）发生了什么？

> ID：306212
> 
> 赞同：13
> 
> 时间：2008-11-20T17:50:55.807
> 
> 标签：c#, java, sun

早在 2000 年（当 .NET 向我们释放 IIRC 时）它是一种创新的尖端语言（我上次使用它是 2003 年）。

不过，从我读到的内容来看，Sun 的语言发展非常缓慢。我什至读过该语言在哪些地方发生了演变，例如添加了泛型，开发人员抱怨实现不佳。

这些是准确的看法吗？如果是，有什么想法，尤其是在看似明显的 C# 竞争的情况下？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-20T18:10:25.563

从企业的角度来看，发展一种语言并不是一件好事，它实际上是非常糟糕的。

这就是为什么你会听到像 cobol、fortran 甚至 C 之类的老语言在它们后面写上年份数字的原因——许多企业坚持使用年份。

最重要的是，更大的团队意味着您团队中的某个人更有可能做其他人不理解的事情，因此保持语言简单和干净有一个重要但被低估的价值。这意味着不要添加太多替代方法来做事。

我与 Ruby 合作过，并且对这门语言很感兴趣，但从企业的角度来看，它是一种绝对可怕的语言。我无法计算一个糟糕的程序员会如何搞砸一个大团队，迫使他们花费数天时间来解决几分钟内造成的混乱。

由于泛型的复杂性，有些公司拒绝使用 java 5.0。（我们仍在研究 1.3 倍，但这是另一个原因）。

老实说，大多数“改进”给你买的很少。一些语法更改，删除几级大括号的能力。

我想不出一个 Java 迫使我重复业务逻辑的案例（当我试图让我的代码“DRY”时，我担心的就是这个）——它是一种足够干净的语言，可以完全 DRY，如果你是一个很好的程序员。

例如，你可以用闭包做的任何事情都可以用子类做而无需重复业务逻辑——由于大括号/额外的类定义层，你最终得到的看起来更糟，但通常更可重用（你可以扩展类你用来实现你的回调，但你不能扩展一个闭包方法，你必须重写它。）

在我职业生涯的前几十年里，我对代码并没有这种感觉（我喜欢语言技巧，越有趣越好），但现在我已经在这很长一段时间了——这可能是我的晚年潜入，或者可能是经验，但现在我看到了简单、明确、稳定的代码（由一种不会让你玩花样的语言提供）的巨大好处，并且无法真正找到许多替代方法的单一优势，即使他们节省了一两行打字。

但是，如果您正在寻找 java 升级，请查看 Scala。它非常惊人，仍然在 JVM 上运行，与 Java 交互等等。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-20T18:14:26.460

大多数语言的起源和演变都有一只强大的手。想一想：Larry Wall/Perl、Guido/Python、Matz/Ruby、Odersky/Scala、Hickey/Clojure 等等。这些人都是语言天才。我愿意让我的左臂比他们中的任何一个聪明一半。

Java 实际上的区别在于掌舵的不仅仅是一个，而是一系列令人惊叹的语言专家——从 Gosling 开始，但我也想到 Guy Steele、Bill Joy、Gilad Bracha、Neal Gafter 等——都是了不起的人。这实际上是一件好事（我认为）。它使语言更好，但防止了停滞。

但在过去的几年里，语言领导力确实存在真空。目前，没有人在意这家商店。没有人会做出艰难的决定来决定什么适合 Java 模型并且添加（或更重要的是不添加）有意义。我不知道那是什么意思。我希望 Java 的巨大普及和影响力以及 JVM 的强大基础意味着这个真空太有吸引力了，不能在某个时候被填补和指导。但我只是谨慎地抱有希望，因为我不知道那会是谁。

John Rose 就是 JVM 方面的那个家伙。虽然如果我只能在其中一项中获得创新，我现在无论如何都会采用 JVM。:)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-20T17:58:22.343

Java 的发展当然非常缓慢——尤其是如果您将它与 C# 和 VB 进行比较。我个人认为他们在以牺牲执行时安全性和效率为代价保持向后兼容性方面对泛型做出了错误的决定。*.NET 方法在几乎*所有方面都工作得更好，IMO。

Java 7 有很[长的*潜在*特性](http://tech.puredanger.com/java7)列表——语言和平台——但它的制作时间非常长，而且许多特性仍然存在很大的问号。

但是，我不想对为什么会发生这种情况有任何“责备”。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-20T18:05:44.793

Java 语言的发展一直很缓慢，但故意如此。

泛型提供了一个很好的例子。与早期版本的 Java 兼容是一项要求。*鉴于项目的目标*，泛型实现完全按照设计执行非常有用的功能。但是，它并没有满足许多开发人员对具体泛型行为的期望。

另一方面，JVM 的创新非常迅速，经常引领其他 VM，并促进性能领域的竞争。

在我看来，Java 语言应该尽可能稳定。我喜欢闭包的想法，但我不相信 Java 是它们的语言。（如果必须加入，我更喜欢保守的 FCM。）我与一个需要培训的开发人员团队合作，以构建和维护一个复杂的生产应用程序。Java 语言为我们提供了强大的功能和结构的完美结合。

其他语言，如 Scala 和 Groovy，以及移植到 JVM 的 Ruby 和 Python，将继续为 Java 平台带来生命，即使在 Java 语言本身已经走上了 COBOL 的道路之后。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-20T18:48:24.083

Java目前与.Net有不同的问题，导致选择不同。

.Net，相对较新，有机会避免 Java 的一些错误，有机会做不同的事情。这给了它两个主要优点：

1.  MS 能够更清楚地区分运行时平台。C# 3.0 显然不会在 1.1 框架上运行，C# 1.1 也不会在 3.0 框架上运行。当然，那里有些模糊，但总的来说，您对自己的立场有更好的了解。另一方面，客户端 JVM 默认在 Windows 上自动更新。因此，保持旧系统正常工作可能会更加棘手。
2.  .Net 框架更年轻，积累的繁琐和内部复杂性要少得多。这些东西会降低您添加新功能的速度。我们现在也开始在 .Net 中看到其中的一些内容。例如：有许多 BCL 函数要求您传入或返回一个应该使用 IEnumerable 的数组。这些函数的历史使得几乎不可能改变它们。

这两件事共同使 .Net 语言（目前）能够更快地发展。但是，就像我已经说过的那样，我们开始看到这些影响也赶上了 .Net。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T18:07:44.790

我认为 Sun 现在是保守的，并确保他们在做出一些糟糕的决定后做出正确的决定。

此外，在 Java 1.5 出来之前，还有很多政治和混乱。许多公司都在使用像 Generic Java 这样的第三方 hack，因为这些核心语言功能不可用，但非常需要。

我认为他们从 1.5 开始再次加速，即将推出 1.7，看起来每个都提供了非常有用的新功能。该语言的开源也很好。

不管有些人怎么说，保持向后兼容性一直是 Java 语言中一个非常重要的特性。

我会说 .NET 已经让 Sun 的驴子发挥了作用，而且它们都存在是件好事。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-20T21:58:46.087

长期以来，Java（无论好坏）都更喜欢通过框架引入新功能，而不是通过语言本身。

例如，您可能会争辩说，编写 Spring/Hibernate/Struts 应用程序的人实际上是在使用 Java 的一种特殊方言编写代码，因为如果没有框架执行的所有反射/注入/检测魔法，他们的代码将在很大程度上无法运行。

就个人而言，我更希望该语言能够进一步发展，并且框架作者可以通过字节码操作停止对语言语义的胡思乱想。

作为旁注，我也强烈不同意 Sun 在其泛型实现中使用类型擦除的决定。据说，他们想要确保向后兼容性，但对我来说这似乎完全是虚假的，因为注释（在 Java 5 中同时添加）创建了他们自己的一组不兼容性。无论如何，为 Java 5 编译的代码永远无法在早期的 JVM 上执行，因此向后兼容性声明对我来说似乎非常可疑。

# java - JRuby 和 Java 对象

> ID：306217
> 
> 赞同：7
> 
> 时间：2008-11-20T17:51:43.153
> 
> 标签：java, scripting, jruby, jruby-java-interop

请告诉我是否可以执行以下操作：

*   在 Java 中创建特定类的实例
*   将其传递给 JRuby 以对其进行处理
*   继续使用 Java 中的“修改”版本

您可以提供一个小的工作示例吗？

编辑：事实证明，嵌入是实现这一目标的最简单方法。[有关嵌入 JRuby](http://github.com/jruby/jruby/wiki/RedBridge)的更多信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T17:56:58.383

是的，这是可能的。[JRuby wiki 上的这个页面](https://github.com/jruby/jruby/wiki/CallingJavaFromJRuby)应该可以帮助您入门。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-06T11:25:06.123

这是我使用的解决方案：[Direct JRuby embedding](https://github.com/jruby/jruby/wiki/RedBridge)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-18T15:47:00.287

这取决于你所说的“做某事”是什么意思。如果您的意思是“重新定义方法”，那么答案是否定的，不是真的。jruby 将使用新方法，但在 java 中对该方法的任何调用都将继续调用旧方法。

# visual-studio-2005 - 如何以编程方式更改项目的产品版本？

> ID：306233
> 
> 赞同：11
> 
> 时间：2008-11-20T17:55:07.327
> 
> 标签：visual-studio-2005, automated-deploy

我有几个部署项目。为了部署一个应用程序，我需要做几项任务，其中之一是更改每个部署项目的产品版本和产品代码。

我找不到以编程方式更改它们的方法。

由于它是一个部署项目（最终生成一个可执行安装程序），因此我无法使用 MSBuild，而是在命令提示符下使用 Devenv。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-29T16:49:03.537

我今天正在寻找完全相同的东西。我用谷歌找到了这个：

```
static void Main(string[] args) 
{
    string setupFileName = @"<Replace the path to vdproj file>"; 
    StreamReader reader = File.OpenText(setupFileName); 
    string file = string.Empty; 

    try 
    { 
        Regex expression = new Regex(@"(?:\""ProductCode\"" = 
        \""8.){([\d\w-]+)}"); 
        Regex expression1 = new Regex(@"(?:\""UpgradeCode\"" = 
        \""8.){([\d\w-]+)}"); 
        file = reader.ReadToEnd(); 

        file = expression.Replace(file, "\"ProductCode\" = \"8:{" + 
        Guid.NewGuid().ToString().ToUpper() + "}"); 
        file = expression1.Replace(file, "\"UpgradeCode\" = \"8:{" 
        + Guid.NewGuid().ToString().ToUpper() + "}"); 
    } 
    finally 
    { 
        // Close the file otherwise the compile may not work 
        reader.Close(); 
    } 

    TextWriter tw = new StreamWriter(setupFileName); 
    try 
    { 
        tw.Write(file); 
    } 
    finally 
    { 
        // close the stream 
        tw.Close(); 
    } 
 } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-29T17:35:31.417

我知道原始发帖人正在寻找解决此问题的 .NET 2.0 解决方案。然而，由于它没有被标记为 .NET，我将提供我的 C++ 解决方案来解决这个问题。这可能适用于 .NET 领域，但我将把它留给其他人。

这不仅更新了我的应用程序的 about 框和日志文件中的版本信息，而且还更新了在 Windows 资源管理器中看到的所有 Windows 版本信息。

**更新：**添加了自我最初回答以来我对该过程所做的一些更改。

首先，我将整个版本信息块从我的 Project.rc 文件移动到我的 Project.rc2 文件：

```
/////////////////////////////////////////////////////////////////////////////
//
// Version
//

VS_VERSION_INFO VERSIONINFO
 FILEVERSION FILE_VER
 PRODUCTVERSION PROD_VER
 FILEFLAGSMASK 0x3fL
#ifdef _DEBUG
  FILEFLAGS 0x1L
#else
  FILEFLAGS 0x0L
#endif
  FILEOS 0x4L
  FILETYPE 0x1L
  FILESUBTYPE 0x0L
BEGIN
   BLOCK "StringFileInfo"
   BEGIN
       BLOCK "040904e4"
       BEGIN
           VALUE "CompanyName", "MyCompany"
           VALUE "FileDescription", "Software Description"
           VALUE "FileVersion", 1,0,0,1
           VALUE "InternalName", "FileName.exe"
           VALUE "LegalCopyright", "(c) 2008 My Company.  All rights reserved."
           VALUE "OriginalFilename", "FileName.exe"
           VALUE "ProductName", "Product Name"
           VALUE "ProductVersion", 1,0,0,1
       END
   END
   BLOCK "VarFileInfo"
   BEGIN
       VALUE "Translation", 0x409, 1252
   END
END 
```

这实际上将您将从资源编辑器编辑的所有版本信息内容传输到单独的文件中。这使得您在从编辑器外部编辑资源文件时不会出错。缺点是您不能再从资源编辑器中编辑版本信息。但是，由于我们希望这些东西自动更新，这没什么大不了的。

接下来，我创建了一个 VersionInfo.h 文件并将其添加到我的项目中：

```
#pragma once

//major release version of the program, increment only when major changes are made
#define VER_MAJOR 2

//minor release version of the program, increment if any new features are added
#define VER_MINOR 0

//any bugfix updates, no new features
#define VER_REV 0

//if this is some special release (e.g. Alpha 1) put the special release string here
#define STR_SPECIAL_REL "Alpha 1"

#define FILE_VER VER_MAJOR,VER_MINOR,VER_REV
#define PROD_VER FILE_VER

//these are special macros that convert numerical version tokens into string tokens
//we can't use actual int and string types because they won't work in the RC files
#define STRINGIZE2(x) #x
#define STRINGIZE(x) STRINGIZE2(x)

#define STR_FILE_VER STRINGIZE(VER_MAJOR) "." STRINGIZE(VER_MINOR) "." STRINGIZE(VER_REV)
#define STR_PROD_VER STR_FILE_VER " " STR_SPECIAL_REL

#define STR_COPYRIGHT_INFO "©" BuildYear " Your Company. All rights reserved." 
```

然后我在 rc2 文件中包含 VersionInfo.h 并进行了以下更改：

```
#include "VersionInfo.h"
/////////////////////////////////////////////////////////////////////////////
//
// Version
//

<no changes>
           VALUE "FileVersion", STR_FILE_VER
           <no changes>
           VALUE "LegalCopyright", STR_COPYRIGHT_INFO
           <no changes>
           VALUE "ProductVersion", STR_PROD_VER
<no changes> 
```

通过这个设置，我可以编辑我的构建脚本（它使用 Perl）来修改 VersionInfo.h 文件中的版本信息，然后再使用 devenv 命令行重新构建整个项目。

我添加的另一个步骤可能也很有趣（尽管它还没有完全完善，并且可能是未来的问题）是在每次构建项目时生成一个唯一的构建号。在当前版本中，它始终适用于完全重建，但仅偶尔适用于增量构建。我所做的是创建一个名为 build_number.incl 的文件，其中包含以下内容：

```
#define CurrentBuildNumber  "20081020P1525" 
```

这本质上是构建开始的日期和时间。我创建了一个批处理文件，该文件作为生成此文件的项目的预构建事件运行。该脚本还定义了 BuildYear，以便 VersionInfo.h 文件中的版权始终包含最近构建的年份。批处理脚本如下：

```
 echo Generating Build Number
    @For /F "tokens=2,3,4 delims=/ " %%A in ('Date /t') do @(
    Set Month=%%A
    Set Day=%%B
    Set Year=%%C
    )

    @For /F "tokens=1,2,3 delims=/M: " %%A in ('Time /t') do @(
    Set Hour=%%A
    Set Minute=%%B
    Set AmPm=%%C
    )

    @echo #define CurrentBuildNumber  "%Year%%Month%%Day%%AmPm%%Hour%%Minute%" > "$(ProjectDir)\build_number.incl"
    @echo #define BuildYear "%Year%" >> "$(ProjectDir)\build_number.incl"
    echo ---------------------------------------------------------------------- 
```

然后，该文件将包含在项目中需要使用内部版本号的任何文件中（即关于框）。

其中一些是从[这个 CodeProject 帖子中收集的。](http://69.10.233.10/KB/macros/IncVersionVC8.aspx?display=Print)

希望这些信息对您有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T08:10:23.207

我遇到了同样的问题，我发现**`.vdproj`**在 a 中修改文件**`prebuildevent`**并不完全符合我的喜好。

在构建安装项目后，我使用了一些其他代码来修改**`msi`**文件文件，所以我使用**`postbuildevent`**.

[在此处](http://stefdev.blogspot.com/2009/03/dynamically-change-productname.html)查看我的博客文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T18:54:36.333

我们使用基于配置文件值更新每个 AssemblyInfo.cs 或 AssemblyInfo.vb 的程序。我们在每次构建之前运行这个可执行文件。这是我们可以做的最好的自动化这个过程。您可以在项目配置中添加对此批处理过程的调用作为预构建步骤。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T17:57:43.170

您可以使用 msbuild 任务来更新您的产品版本。查看MSBuild 团队关于此主题的[这篇文章](http://blogs.msdn.com/msbuild/archive/2005/11/11/how-to-update-assembly-version-numbers-with-msbuild.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T17:59:56.210

[在 Windows 应用程序的编译时嵌入 SVN 修订号](https://stackoverflow.com/questions/151299/embedding-svn-revision-number-at-compile-time-in-a-win32-app#151445)

在我对这个问题的回答中，我描述了我是如何使用 SVN 完成这项任务的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T19:22:09.257

这可能不是您所追求的，但在过去的迷雾中，我写了一个名为[stampver](http://blog.dixo.net/downloads/stampver-win32-version-resource-stamping/)的东西，它可以直接在 .exe 文件中自动增加内部版本号，作为构建后的步骤。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T14:24:43.667

**[资源调谐器控制台](http://www.reseditor.com)**

> 此控制台资源编辑器允许在构建过程的最后阶段从命令提示符创建一个可靠且可重复的过程来更新产品版本信息资源。

具体参见文件版本信息页面的**批量操作以获取更多详细信息：**

*   [http://www.reseditor.com/rtc-solution-version-info.htm](http://www.reseditor.com/rtc-solution-version-info.htm "编辑版本信息")

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-12T06:33:19.227

我知道这是一个非常古老的线程，但这是一个实现相同目的的 vbs 解决方案。只需将其放在 .vdproj 文件旁边的部署文件夹中。

```
Function CreateGuid()
    CreateGuid = Left(CreateObject("Scriptlet.TypeLib").Guid,38)
End Function

Const ForReading = 1, ForWriting = 2, ForAppending = 8

Set fso = CreateObject("Scripting.FileSystemObject")
Set RegEx = CreateObject("VBScript.RegExp")

For Each file in fso.GetFolder(".").Files
    if (fso.GetExtensionName(file.Name) = "vdproj") then
        WScript.Echo "Updating: " + file.Name
        Set oFile = fso.OpenTextFile(file.Name, ForReading, True)
        fileContents = oFile.ReadAll
        oFile.Close
        RegEx.Pattern = """ProductCode"" = ""8:{.*-.*-.*-.*-.*}"
        fileContents=Regex.Replace(fileContents, """ProductCode"" = ""8:" & CreateGuid)
        Set oFile = fso.OpenTextFile(file.Name, ForWriting, True)
        oFile.Write fileContents
        oFile.Close
    end if
Next 
```

然后在你的真实项目中，有一个类似于以下的构建后事件：

```
cd $(SolutionDir)\CustomWebSetup
cscript -nologo UpdateProductCode.vbs 
```

这将使用新的 ProductCode 更新 vdproj，为**下一次**构建做准备。构建完成后，VS 会提示重新加载部署项目。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-12-29T19:05:27.973

研究 RCS、CVS 和/或颠覆的使用。我只熟悉RCS；我的理解是 CVS 基于 RCS 但更全面。我在各种板上读到颠覆更好，但我从未使用过它。RCS 足以跟踪我所有文档和软件项目的更改和版本。

RCS 在这里：[http ://www.cs.purdue.edu/homes/trinkle/RCS/](http://www.cs.purdue.edu/homes/trinkle/RCS/)

CVS 在这里：[http ://www.nongnu.org/cvs/](http://www.nongnu.org/cvs/)

颠覆在这里：[http ://subversion.tigris.org/](http://subversion.tigris.org/)

# vba - 未能将参数传递给 VBA for Excel 2007 中的 UDF

> ID：306243
> 
> 赞同：2
> 
> 时间：2008-11-20T17:58:49.970
> 
> 标签：vba, excel, user-defined-functions

我有一个复杂的迭代电子表格，我想在其中使用 UDF 来计算热交换器的传热系数。该函数有 5 个参数（2 个字符串和 3 个双精度）。字符串和 1 双通就好了。剩下的两个似乎根本没有通过。对有问题的论点的观察表明它们等于零。我尝试将参数重新定义为变体，然后我可以在“value2”字段中找到我想要的值。但是，一旦我尝试访问它（通过 varName.Value2），它就会消失（手表突然将该字段列为“空”）。

为有问题的参数传递给函数的单元格在很大程度上依赖于电子表格的其余部分，并且它们的值几乎每次迭代都会改变。

有没有人见过这个并且知道解决方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T21:21:48.360

我使用带有 +6 输入变量（标准类型和变体）的 UDF，并且我注意到（这是我对所发生情况的解释）有时 excel calc 引擎会在所有输入值被计算之前尝试触发 UDF 并且可用的。从调试视图来看，这被视为“错误启动”并停止执行中间过程（线程丢失）的函数，因此在调试方面它显示出奇怪的行为。

但是，当写入单元格时，该函数仍会正确计算并返回。

# computer-science - 第一个 NP 完全问题是如何被证明是 NP 完全的？

> ID：306249
> 
> 赞同：30
> 
> 时间：2008-11-20T18:00:27.330
> 
> 标签：computer-science, np-complete

从 NP-Complete 上的维基百科条目：

“证明一些新问题是NP完全的最简单方法是首先证明它在NP中，然后将一些已知的NP完全问题简化为它”

我很确定我理解这一点：如果我有问题，我可以证明它是 NP-Complete 如果我：

1.  证明它在 NP 中（可以在非确定性图灵机上以多项式时间验证问题的解决方案）

2.  证明一个已知为 NP-Complete 的问题可以“简化”为新问题

所以，我的问题是，第一个 NP 完全问题是如何“证明”为 NP 完全的？有一次，已知 NP 完全问题的集合必须为零，这使得无法诉诸上述过程中的步骤 2。

这让我觉得有一种我不知道的不同的证明方法。由于缺乏已知的多项式时间解，对于某些问题，要么是这样，要么可能是整个 NP 完全属性被“假设”。（实际上，在写完这篇文章后，如果是这种情况，我不会感到惊讶，但无论哪种方式，我都希望得到一些大师的反馈）。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-20T18:08:41.370

[库克定理](http://en.wikipedia.org/wiki/Cook%27s_theorem)

NP类可以定义为非确定性图灵机在多项式时间内可判定的一类问题。这个定理表明**SAT 是 NP 完全**的，它通过一个布尔公式对任何非确定性图灵机的操作进行编码，使得机器接受当且仅当该公式是 SATisfiable 时。

从历史上看，NP-completeness 的概念是在 Richard Karp 的开创性论文（*[Reducibility Between Combinatorial Problems](http://en.wikipedia.org/wiki/Karp%27s_21_NP-complete_problems)*）中引入的，他在其中定义了 NP-completeness，使用了 Cook 定理，并且一举证明了 21 个问题 NP-complete。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-20T18:29:51.390

为了给你证明的本质（这是 Garey & Johnson 的*Computers and Intractibility*中的好几页）：

任何计算问题都可以表示为图灵机。

可以将图灵机表示为一个逻辑问题，满足一定的复杂性约束。

因此，如果你能在多项式时间内解决逻辑问题，你就可以在多项式时间内解决图灵机问题。

这（连同其他一些考虑）表明，如果您可以在多项式时间内解决逻辑问题，那么您可以在多项式时间内解决任何 NP 问题。这是NP完全的定义，因此逻辑问题是NP完全的，并且可以用作其他问题的基础。

使用的逻辑问题称为可满足性（通常缩写为 SAT）。给定一系列形式为（A or not-B or not-C）的子句（由任意数量的命题和由逻辑或连接的命题的否定组成的子句），是否存在对命题的真值分配，使得所有条款是真的吗？

NP 完全性是一个定义明确的属性。你怀疑一个问题是否是 NP 完全的唯一原因是你认为你可以将另一个 NP 完全问题简化为它，但还没有设法找到一个方便的问题或得到一个证明。

问题不在于是否存在 NP 完全问题，或者如何证明一个问题是 NP 完全的，而是这意味着什么。还没有人提出多项式时间算法来解决 NP 完全问题，也没有人证明这样的算法不存在。不管 P=NP，我们肯定没有好的算法来解决任何 NP 完全问题。

这是克莱普尔基金会的千年问题之一，所以如果你能拿出一个证明，让一些非常聪明的人多年来一直没有找到答案，那么你就有一百万美元。

# html - 如何跨浏览器一致地对齐复选框及其标签

> ID：306252
> 
> 赞同：1829
> 
> 时间：2008-11-20T18:02:01.650
> 
> 标签：html, css, cross-browser, alignment, forms

这是一直困扰我的小 CSS 问题之一。

Stack Overflow 周围的人如何垂直对齐***`checkboxes`***以及他们***`labels`***始终如一**的跨浏览器**？

每当我在 Safari 中正确对齐它们（通常`vertical-align: baseline`在 上使用`input`）时，它们在 Firefox 和 IE 中完全关闭。

在 Firefox 中修复它，Safari 和 IE 难免搞砸了。每次编写表格时，我都会在这上面浪费时间。

这是我使用的标准代码：

```
<form>
    <div>
        <label><input type="checkbox" /> Label text</label>
    </div>
</form>
```

我通常使用 Eric Meyer 的重置，因此表单元素相对而言没有覆盖。期待您提供的任何提示或技巧！

* * *

## 回答 #1

> 赞同：1033
> 
> 时间：2008-11-20T19:47:43.153

# 警告！这个答案***太旧了***，***不适***用于现代浏览器。

[我不是这个答案的发布者，但在撰写本文时，这是迄今为止在正面和负面投票中投票最多的答案（+1035 -17），它仍然被标记为接受的答案（可能是因为问题的原始海报是写这个答案的人）。]

正如评论中已经多次指出的那样，这个答案不再适用于大多数浏览器（并且自 2013 年以来似乎没有这样做）。

* * *

经过一个多小时的调整、测试和尝试不同风格的标记，我想我可能有一个不错的解决方案。这个特定项目的要求是：

1.  输入必须在自己的行上。
2.  复选框输入需要在所有浏览器中以类似方式（如果不相同）与标签文本垂直对齐。
3.  如果标签文本换行，则需要缩进（因此不要在复选框下方换行）。

在我进行任何解释之前，我将给你代码：

```
label {
  display: block;
  padding-left: 15px;
  text-indent: -15px;
}
input {
  width: 13px;
  height: 13px;
  padding: 0;
  margin:0;
  vertical-align: bottom;
  position: relative;
  top: -1px;
  *overflow: hidden;
}
```

```
<form>
  <div>
    <label><input type="checkbox" /> Label text</label>
  </div>
</form>
```

这是[JSFiddle](http://jsfiddle.net/t8EGn/6/)中的工作示例。

此代码假定您正在使用像 Eric Meyer 这样的重置，它不会覆盖表单输入边距和填充（因此在输入 CSS 中放置边距和填充重置）。显然，在实时环境中，您可能会嵌套/覆盖内容以支持其他输入元素，但我想让事情保持简单。

注意事项：

*   该`*overflow`声明是一个内联 IE hack（star-property hack）。IE 6 和 7 都会注意到它，但 Safari 和 Firefox 会正确地忽略它。我认为它可能是有效的 CSS，但最好还是使用条件注释；只是为了简单起见。
*   据我所知，唯一`vertical-align`在浏览器中一致的语句是`vertical-align: bottom`. 在 Safari、Firefox 和 IE 中设置这个然后相对向上定位的行为几乎相同，只有一两个像素的差异。
*   使用对齐的主要问题是 IE 在输入元素周围贴了一堆神秘的空间。它不是填充或边距，它是该死的持久性。在复选框上设置宽度和高度，然后`overflow: hidden`由于某种原因切断了额外的空间，并允许 IE 的定位与 Safari 和 Firefox 非常相似。
*   根据您的文本大小，您无疑需要调整相对位置、宽度、高度等，以使内容看起来正确。

希望这对其他人有帮助！除了我今天早上工作的项目之外，我还没有在任何项目上尝试过这种特定的技术，所以如果你发现一些更一致的东西，一定要努力。

* * *

# 警告！这个答案***太旧了***，***不适***用于现代浏览器。

* * *

## 回答 #2

> 赞同：254
> 
> 时间：2009-01-30T09:12:46.720

有时垂直对齐需要两个相邻的内联（跨度、标签、输入等）元素才能正常工作。以下复选框在 IE、Safari、FF 和 Chrome 中正确垂直居中，即使文本大小非常小或大。

它们都在同一行上彼此相邻浮动，但 nowrap 意味着整个标签文本始终位于复选框旁边。

缺点是额外无意义的 SPAN 标签。

```
.checkboxes label {
  display: inline-block;
  padding-right: 10px;
  white-space: nowrap;
}
.checkboxes input {
  vertical-align: middle;
}
.checkboxes label span {
  vertical-align: middle;
}
```

```
<form>
  <div class="checkboxes">
    <label><input type="checkbox"> <span>Label text x</span></label>
    <label><input type="checkbox"> <span>Label text y</span></label>
    <label><input type="checkbox"> <span>Label text z</span></label>
  </div>
</form>
```

现在，如果您有一个很长的标签文本*需要*在复选框下方换行而不换行，您将在标签元素上使用填充和负文本缩进：

```
.checkboxes label {
  display: block;
  padding-right: 10px;
  padding-left: 22px;
  text-indent: -22px;
}
.checkboxes input {
  vertical-align: middle;
}
.checkboxes label span {
  vertical-align: middle;
}
```

```
<form>
  <div class="checkboxes">
    <label><input type="checkbox"> <span>Label text x so long that it will probably wrap so let's see how it goes with the proposed CSS (expected: two lines are aligned nicely)</span></label>
    <label><input type="checkbox"> <span>Label text y</span></label>
    <label><input type="checkbox"> <span>Label text z</span></label>
  </div>
</form>
```

* * *

## 回答 #3

> 赞同：199
> 
> 时间：2009-04-05T19:41:57.190

使用[One Crayon 的解决方案](https://stackoverflow.com/a/306593/1079573)，我有一些对我有用且更简单的东西：

```
.font2 {font-family:Arial; font-size:32px} /* Sample font */

input[type=checkbox], input[type=radio] {
  vertical-align: middle;
  position: relative;
  bottom: 1px;
}

input[type=radio] { 
  bottom: 2px; 
} 
```

```
<label><input type="checkbox" /> Label text</label>
<p class="font2">
  <label><input type="checkbox"/> Label text</label>
</p>
```

在 Safari（我信任其基线）中逐个像素地渲染相同的像素，并且 Firefox 和 IE7 都很好。它也适用于各种大小的标签字体大小。现在，为了修复 IE 在选择和输入上的基线...

* * *

**更新：（**第三方编辑）

正确的`bottom`位置取决于字体系列和字体大小！我发现使用**`bottom: .08em;`**复选框和单选元素是一个很好的通用值。我在 Chrome/Firefox/IE11 中使用 Arial 和 Calibri 字体在 Windows 中使用几种小/中/大字体大小对其进行了测试。

```
.font2, .font2 input {font-family:Arial; font-size:32px} /* Sample font */

input[type=checkbox], input[type=radio] {
  vertical-align: middle; 
  position: relative;
  bottom: .08em; /* this is a better value for different fonts! */
}
```

```
<label><input type="checkbox" /> Label text</label> 

<p class="font2">
  <label><input type="checkbox"/> Label text</label>
</p>
```

* * *

## 回答 #4

> 赞同：158
> 
> 时间：2010-05-10T22:06:09.190

一件似乎效果很好的简单事情是使用垂直对齐来调整复选框的垂直位置。它仍然会因浏览器而异，但解决方案并不复杂。

```
input {
    vertical-align: -2px;
} 
```

[**参考**](http://www.cssdesignpatterns.com/Chapter%2012%20-%20ALIGNING%20CONTENT/Vertical-offset%20Content/example.html)

* * *

## 回答 #5

> 赞同：94
> 
> 时间：2008-11-20T18:07:01.310

尝试`vertical-align: middle`

您的代码也应该是：

```
<form>
    <div>
        <input id="blah" type="checkbox"><label for="blah">Label text</label>
    </div>
</form>
```

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2008-12-28T05:23:25.153

试试我的解决方案，我在 IE 6、FF2 和 Chrome 中尝试过，它在所有三种浏览器中逐像素呈现。

```
* {
  padding: 0px;
  margin: 0px;
}
#wb {
  width: 15px;
  height: 15px;
  float: left;
}
#somelabel {
  float: left;
  padding-left: 3px;
}
```

```
<div>
  <input id="wb" type="checkbox" />
  <label for="wb" id="somelabel">Web Browser</label>
</div>
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2015-02-24T19:07:55.060

对我来说唯一完美的解决方案是：

```
input[type=checkbox], input[type=radio] {
    vertical-align: -2px;
    margin: 0;
    padding: 0;
} 
```

今天在 Chrome、Firefox、Opera、IE 7 和 8 中进行了测试。示例：**[Fiddle](http://jsfiddle.net/6Lf9eohs/6/)**

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2013-04-17T14:46:43.857

我还没有完全测试我的解决方案，但它似乎工作得很好。

我的 HTML 很简单：

```
<label class="checkbox"><input type="checkbox" value="0000">0000 - 0100</label> 
```

然后我将所有复选框设置`24px`为高度和宽度。为了使文本对齐，我也制作了标签`line-height`并像这样`24px`分配：`vertical-align: top;`

**编辑：**在 IE 测试之后，我添加`vertical-align: bottom;`到输入并更改了标签的 CSS。您可能会发现您需要一个有条件的 IE css 案例来整理填充 - 但文本和框是内联的。

```
input[type="checkbox"] {
    width: 24px;
    height: 24px;
    vertical-align: bottom;
}
label.checkbox {
    vertical-align: top;
    line-height: 24px;
    margin: 2px 0;
    display: block;
    height: 24px;
}
```

```
<label class="checkbox"><input type="checkbox" value="0000">0000 - 0100</label>
<label class="checkbox"><input type="checkbox" value="0100">0100 - 0200</label>
<label class="checkbox"><input type="checkbox" value="0200">0200 - 0300</label>
<label class="checkbox"><input type="checkbox" value="0300">0300 - 0400</label>
```

如果有人发现这不起作用，请告诉我。这是它的实际效果（在 Chrome 和 IE 中 - 很抱歉，因为屏幕截图是在视网膜上拍摄的，并且对 IE 使用了相似之处）：

![复选框的屏幕截图：Chrome](https://i.stack.imgur.com/ARAZM.png) ![复选框截图：IE](https://i.stack.imgur.com/sHbmT.png)

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2008-11-20T21:21:50.827

我通常使用行高来调整静态文本的垂直位置：

```
label {
  line-height: 18px;
}
input {
  width: 13px;
  height: 18px;
  font-size: 12px;
  line-height: 12px;
}
```

```
<form>
  <div>
    <label><input type="checkbox" /> Label text</label>
  </div>
</form>
```

希望有帮助。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2019-06-12T09:05:25.403

# 最后我们来看看问题的根源

复选框是使用图像呈现的（可以通过 CSS 设置自定义的）。这是 FireFox 中的一个（未选中）复选框，用 DOM 检查器突出显示：

[![它只是一个正方形](https://i.stack.imgur.com/GHFTL.png)](https://i.stack.imgur.com/GHFTL.png)

这是 Chrome 中相同的无样式复选框：

[![这是一个不居中的正方形](https://i.stack.imgur.com/ItaYN.png)](https://i.stack.imgur.com/ItaYN.png)

可以看到边距（橙色）；填充不存在（将显示为绿色）。那么复选框右侧和底部的伪边距是什么？**这些是用于复选框的图像的一部分**。这就是为什么使用 just`vertical-align: middle`还不够，这就是跨浏览器问题的根源。

# 那么我们能做些什么呢？

一个明显的选择是——替换图像！幸运的是，可以通过 CSS 实现这一点，并用外部图像、base64 (in-CSS) 图像、in-CSS svg 或只是伪元素替换它们。这是一种强大的（跨浏览器！）方法，这是从[这个问题](https://stackoverflow.com/q/34712350/3995261)中窃取的这种调整的一个例子：

```
.checkbox-custom {
  opacity: 0;
  position: absolute;
}
.checkbox-custom,
.checkbox-custom-label {
  display: inline-block;
  vertical-align: middle;
  margin: 5px;
  cursor: pointer;
}
.checkbox-custom + .checkbox-custom-label:before {
  content: '';
  display: inline-block;
  background: #fff;
  border-radius: 5px;
  border: 2px solid #ddd;
  vertical-align: middle;
  width: 10px;
  height: 10px;
  padding: 2px;
  margin-right: 10px;
  text-align: center;
}
.checkbox-custom:checked + .checkbox-custom-label:before {
  width: 1px;
  height: 5px;
  border: solid blue;
  border-width: 0 3px 3px 0;
  transform: rotate(45deg);
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  border-radius: 0px;
  margin: 0px 15px 5px 5px;
}
```

```
<div>
  <input id="checkbox-1" class="checkbox-custom" name="checkbox-1" type="checkbox">
  <label for="checkbox-1" class="checkbox-custom-label">First Choice</label>
</div>
<div>
  <input id="checkbox-2" class="checkbox-custom" name="checkbox-2" type="checkbox">
  <label for="checkbox-2" class="checkbox-custom-label">Second Choice</label>
</div>
```

您可能想阅读一些有关此类样式的更深入的文章，例如[此处](https://stackoverflow.com/a/4148544/3995261)列出的一些文章；它超出了这个答案的范围。

# 好的，仍然没有自定义图像或伪元素解决方案呢？

**TL；DR：看起来这不起作用，请改用自定义复选框**

首先，让我们注意，如果在其他浏览器中复选框图标内的那些伪边距是任意的，则没有一致的解决方案。要构建一个，我们必须在现有浏览器中探索此类图像的解剖结构。

那么哪些浏览器在复选框中有伪边距？我检查了 Chrome 75、Vivaldi 2.5（基于 Chromium）、FireFox 54（不要问为什么这么过时）、IE 11、Edge 42、Safari ?? （借了一分钟，忘记查看版本）。只有 Chrome 和 Vivaldi 有这样的伪边距（我怀疑所有基于 Chromium 的浏览器，比如 Opera）。

这些伪边距的大小是多少？要弄清楚这一点，可以使用缩放复选框：

```
input {
  zoom: 10;
  box-shadow: 0 0 1px inset #999;
}
```

```
<input type=checkbox>
```

我的结果是宽度/高度的约 7%，因此绝对单位为 0.9-1.0px。但是，准确性可能会受到质疑：尝试`zoom`复选框的不同值。在我对 Chrome 和 Vivaldi 的测试中，伪边距的相对大小在`zoom`值 10、20 和值 11-19 (??) 时非常不同：

[![对于缩放 = 10，它是 7%](https://i.stack.imgur.com/kIIXb.png)](https://i.stack.imgur.com/kIIXb.png) [![而对于 zoom = 11，它几乎是该值的两倍](https://i.stack.imgur.com/gcjS3.png)](https://i.stack.imgur.com/gcjS3.png)

`scale`似乎更一致：

```
input {
  transform: scale(10) translate(50%, 50%);
  box-shadow: 0 0 1px inset #999;
}
```

```
<input type=checkbox>
```

所以可能 ~14% 和 2px 是正确的值。

现在我们知道（？）伪边距的大小，让我们注意这还不够。所有浏览器的复选框图标的大小是否相同？唉! 以下是 DOM 检查器为无样式复选框显示的内容：

*   火狐：**13.3px**
*   基于 Chromium：**12.8px**表示整个事物，因此 12.8 (100% - 14%) = **11px**表示在视觉上被视为复选框
*   IE 11，边缘：**13px**
*   Safari：不适用（我相信这些应该在同一个屏幕上进行比较）

现在在我们讨论任何解决方案或技巧之前，让我们问一下：什么是*正确*的对齐方式？我们想要达到什么目的？在某种程度上，这是一个品味问题，但基本上我可以想到以下“不错”的对齐方面：

同一基线上的文本和复选框（我故意不在这里调整复选框大小）：

[![在此处输入图像描述](https://i.stack.imgur.com/oXnDy.png)](https://i.stack.imgur.com/oXnDy.png)

或在小写字母方面具有相同的中间线：

[![在此处输入图像描述](https://i.stack.imgur.com/Cvbyf.png)](https://i.stack.imgur.com/Cvbyf.png)

或大写字母的相同中间线（更容易看出不同字体大小的差异）：

[![在此处输入图像描述](https://i.stack.imgur.com/4TIBr.png)](https://i.stack.imgur.com/4TIBr.png)

我们还必须决定复选框的大小是否应该等于小写字母、大写字母或其他字母的高度（更大、更小或介于小写和大写之间）。

对于本次讨论，如果复选框与文本在同一基线上并且具有大写字母的大小（一个非常有争议的选择），我们称对齐为好：

[![在此处输入图像描述](https://i.stack.imgur.com/A9Fer.png)](https://i.stack.imgur.com/A9Fer.png)

现在我们需要什么工具：

1.  调整复选框大小
2.  使用伪边距复选框识别 Chromium 并设置特定样式
3.  调整复选框/标签垂直对齐

?

1.  关于[复选框大小调整](https://stackoverflow.com/q/306924/3995261)：有`width`, `height`, `size`, `zoom`, `scale`（我错过了什么吗？）。`zoom`并且`scale`不允许设置绝对大小，因此它们可能仅有助于调整文本大小，而不是设置跨浏览器大小（除非我们可以编写特定于浏览器的规则）。`size`不适用于 Chrome（它是否适用于旧 IE？无论如何，它并不那么有趣）。`width`并且`height`在 Chrome 和其他浏览器中工作，所以我们可以设置一个共同的大小，但同样，在 Chrome 中它设置整个图像的大小，而不是复选框本身。注意：定义复选框大小的是 minimum(width, height) （如果宽度≠高度，则将复选框正方形之外的区域添加到“伪边距”）。

    不幸的是，据我所知，Chrome 复选框中的伪边距对于任何宽度和高度都没有设置为零。

2.  恐怕这些天没有可靠[的纯 CSS 方法。](https://stackoverflow.com/q/9328832/3995261)

3.  让我们考虑垂直对齐。当设置为或由于 Chrome 的伪边距`vertical-align`时无法给出一致的结果，为所有浏览器获得相同“坐标系”的唯一真正选择是将标签和输入对齐：`middle``baseline``top`

    [![比较垂直对齐：顶部和底部](https://i.stack.imgur.com/yFAYN.png)](https://i.stack.imgur.com/yFAYN.png)

    （上图：vertical-align: top, bottom and bottom without box-shadow）

那么我们从中得到什么结果呢？

```
input[type="checkbox"] {
    height: 0.95em;
    width: 0.95em;
}
label, input {
    vertical-align: top;
}
```

```
<label><input type="checkbox">label</label>
```

上面的代码片段适用于 Chrome（基于 Chromium 的浏览器），但其他浏览器需要较小尺寸的复选框。似乎不可能以一种围绕 Chromium 的复选框图像怪癖的方式调整大小和垂直对齐方式。**我的最后建议是：改用自定义复选框——这样你就可以避免沮丧:)**

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2016-07-24T23:53:35.390

现在所有现代浏览器都支持 flexbox，这样的方法对我来说似乎是一种更简单的方法。

```
<style>
label {
  display: flex;
  align-items: center;
}
input[type=radio], input[type=checkbox]{
  flex: none;
}
</style>
<form>
  <div>
    <label><input type="checkbox" /> Label text</label>
  </div>
</form> 
```

**这是完整的前缀版本演示：**

```
label {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
	-webkit-box-align: center;
	-webkit-align-items: center;
	-ms-flex-align: center;
	align-items: center;
}
input[type=radio], 
input[type=checkbox] {
	-webkit-box-flex: 0;
	-webkit-flex: none;
	-ms-flex: none;
	flex: none;
	margin-right: 10px; 
}
/* demo only (to show alignment) */
form {
  max-width: 200px
}
```

```
<form>
  <label>
    <input type="radio" checked>
    I am an aligned radio and label
  </label>
  <label>
      <input type="checkbox" checked>
    I am an aligned checkbox and label
  </label>
</form>
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2011-09-01T22:31:07.770

```
<form>
    <div>
        <label style="display: inline-block">
            <input style="vertical-align: middle" type="checkbox" />
            <span style="vertical-align: middle">Label text</span>
         </label>
    </div>
</form>
```

诀窍是仅在表格单元格或内联块中使用垂直对齐（如果使用标签标记）。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2013-11-21T09:31:41.447

我认为这是最简单的方法

```
input {
    position: relative;
    top: 1px;
}
```

```
<form>
    <div>
        <label><input type="checkbox" /> Label text</label>
    </div>
<form>
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2014-11-06T13:59:37.960

我不喜欢相对定位，因为它使元素呈现在其级别上的所有其他内容之上（如果您有复杂的布局，它可以在某些东西之上）。

我发现这`vertical-align: sub`使得复选框在 Chrome、Firefox 和 Opera 中看起来足够好。无法检查 Safari，因为我没有 MacOS 并且 IE10 稍微有些偏离，但我发现它对我来说已经足够好。

另一种解决方案可能是尝试为每个浏览器制作特定的 CSS，并在 %/pixels/EMs 中使用一些垂直对齐对其进行微调：http: [//css-tricks.com/snippets/css/browser-specific-hacks/](http://css-tricks.com/snippets/css/browser-specific-hacks/)

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2009-01-30T09:26:00.813

这对我很有效：

```
fieldset {
  text-align:left;
  border:none
}
fieldset ol, fieldset ul {
  padding:0;
  list-style:none
}
fieldset li {
  padding-bottom:1.5em;
  float:none;
  clear:left
}
label {
  float:left;
  width:7em;
  margin-right:1em
}
fieldset.checkboxes li {
  clear:both;
  padding:.75em
}
fieldset.checkboxes label {
  margin:0 0 0 1em;
  width:20em
}
fieldset.checkboxes input {
  float:left
}
```

```
<form>
  <fieldset class="checkboxes">
    <ul>
      <li>
        <input type="checkbox" name="happy" value="yep" id="happy" />
        <label for="happy">Happy?</label>
      </li>
      <li>
        <input type="checkbox" name="hungry" value="yep" id="hungry" />
        <label for="hungry">Hungry?</label>
      </li>
    </ul>
  </fieldset>
</form>
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2013-08-19T21:38:53.353

在 Chrome 28 OSX 中，选择的 400+ 投票的答案对我不起作用，可能是因为它没有在 OSX 中进行测试，或者它在 2008 年回答这个问题时确实有效。

时代变了，新的 CSS3 解决方案现在是可行的。我的解决方案使用[伪元素](http://reference.sitepoint.com/css/pseudoelements)来创建*自定义复选框*。所以规定（优点或缺点，不管你怎么看）如下：

*   仅适用于现代浏览器（FF3.6+、IE9+、Chrome、Safari）
*   依赖于一个定制设计的复选框，它将在每个浏览器/操作系统中呈现完全相同。在这里，我刚刚选择了一些简单的颜色，但您总是可以添加线性渐变等，以使其更加出色。
*   适用于特定的字体/字体大小，如果更改，您只需更改复选框的位置和大小，使其显示为垂直对齐。如果调整正确，最终结果在所有浏览器/操作系统中仍应接近完全相同。
*   没有垂直对齐属性，没有浮动
*   必须在我的示例中使用提供的标记，如果结构像问题，它将不起作用，但是，布局看起来基本相同。如果你想移动东西，你还必须移动相关的 CSS

```
div.checkbox {
    position: relative;
    font-family: Arial;
    font-size: 13px;
}
label {
    position: relative;
    padding-left: 16px;
}
label::before {
    content :"";
    display: inline-block;
    width: 10px;
    height: 10px;
    background-color: white;
    border: solid 1px #9C9C9C;
    position: absolute;
    top: 1px;
    left: 0px;
}
label::after {
    content:"";
    width: 8px;
    height: 8px;
    background-color: #666666;
    position: absolute;
    left: 2px;
    top: 3px;
    display: none;
}
input[type=checkbox] {
    visibility: hidden;
    position: absolute;
}
input[type=checkbox]:checked + label::after {
    display: block;
}
input[type=checkbox]:active + label::before {
    background-color: #DDDDDD;
}
```

```
<form>
    <div class="checkbox">
        <input id="check_me" type=checkbox />
        <label for="check_me">Label for checkbox</label>
    </div>
</form>
```

此解决方案*隐藏复选框*，并向标签添加伪元素并设置其样式以创建可见复选框。因为标签绑定到隐藏的复选框，所以输入字段仍然会更新，并且值将与表单一起提交。

如果您有兴趣，这是我对单选按钮的看法：http: [//jsfiddle.net/DtKrV/2/](http://jsfiddle.net/DtKrV/2/)

希望有人觉得这很有用！

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2008-11-20T19:52:48.103

我从来没有遇到过这样的问题：

```
<form>
  <div>
    <input type="checkbox" id="cb" /> <label for="cb">Label text</label>
  </div>
</form> 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2011-08-03T17:33:22.360

如果您使用**ASP.NET Web 窗体**，则无需担心 DIV 和其他元素或固定大小。我们可以通过在 CSS 中设置 CheckboxList 输入类型来对齐`<asp:CheckBoxList>`文本。`float:left`

请检查以下示例代码：

```
.CheckboxList
{
    font-size: 14px;
    color: #333333;
}
.CheckboxList input
{
    float: left;
    clear: both;
} 
```

**.ASPX 代码：**

```
<asp:CheckBoxList runat="server" ID="c1" RepeatColumns="2" CssClass="CheckboxList">
</asp:CheckBoxList> 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2010-01-14T10:31:56.103

将输入类型复选框包裹在标签内并像这样向左浮动：

```
<label for="id" class="checkbox">
    <input type="checkbox" id="id">
    <span>The Label</span>
</label> 
```

这对我有用：

```
label.checkbox {
    display: block;
}
.checkbox input {
    float: left;
    height: 18px;
    vertical-align: middle;
}
.checkbox span {
    float: left;
    line-height: 18px;
    margin: 0 0 0 20px;
} 
```

确保 的高度与 (blocklevel) 的行高相同。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-04-06T18:31:35.950

如果您使用的是 Twitter Bootstrap，您可以使用以下`checkbox`类`<label>`：

```
<label class="checkbox">
    <input type="checkbox"> Remember me
</label> 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2014-08-07T00:18:52.297

硬编码复选框的高度和宽度，删除其填充，并使其高度加上垂直边距等于标签的行高。如果标签文本是内联的，则浮动复选框。Firefox、Chrome 和 IE7+ 都以相同的方式呈现以下示例：[http ://www.kornea.com/css-checkbox-align](http://www.kornea.com/css-checkbox-align)

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2017-06-13T21:43:48.710

```
input[type=checkbox]
{
    vertical-align: middle;
} 
```

```
<input id="testCheckbox" name="testCheckbox" type="checkbox">
<label for="testCheckbox">I should align</label>
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-11-20T18:24:46.080

我通常不标记复选框，然后将其“标签”作为单独的元素。这很痛苦，但是在显示复选框及其标签的方式之间存在很大的跨浏览器差异（正如您已经注意到的），这是我可以接近控制一切外观的唯一方法。

出于同样的原因，我最终也在 winforms 开发中这样做了。我认为复选框控件的根本问题在于它实际上是两个不同的控件：框和标签。通过使用复选框，您将其留给控件的实现者来决定这两个元素如何彼此相邻显示（并且他们总是弄错，其中错误 = 不是您想要的）。

我真的希望有人能更好地回答你的问题。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2012-03-02T09:10:48.047

CSS：

```
.threeCol .listItem {
    width:13.9em;
    padding:.2em;
    margin:.2em;
    float:left;
    border-bottom:solid #f3f3f3 1px;
}
.threeCol input {
    float:left;
    width:auto;
    margin:.2em .2em .2em 0;
    border:none;
    background:none;
}
.threeCol label {
    float:left;
    margin:.1em 0 .1em 0;
} 
```

HTML：

```
<div class="threeCol">
    <div class="listItem">
        <input type="checkbox" name="name" id="id" value="checkbox1" />
        <label for="name">This is your checkBox</label>
    </div>
</div> 
```

上面的代码会将您的列表项放在三个列中，并更改宽度以适应。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2014-06-05T12:10:14.563

所以我知道这已经被回答了很多次，但我觉得我有一个比已经提供的更优雅的解决方案。不仅有 1 个优雅的解决方案，还有 2 个单独的解决方案来满足您的喜好。话虽如此，您需要知道和看到的所有内容都包含在 2 JS Fiddle's 中，并带有注释。

* * *

解决方案 #1 依赖于给定浏览器的本机“复选框”，尽管有一点扭曲......它包含在一个 div 中，该 div 更容易定位跨浏览器，带有溢出：隐藏以砍掉多余的 1px 拉伸复选框（这样你就看不到FF丑陋的边框了）

简单的HTML：（**按照链接查看带有注释的css，代码块是为了满足stackoverflow）** [http://jsfiddle.net/KQghJ/](http://jsfiddle.net/KQghJ/)

```
<label><div class="checkbox"><input type="checkbox" /></div> Label text</label> 
```

* * *

解决方案 #2 使用“Checkbox Toggle Hack”来切换 DIV 的 CSS 状态，该状态已在浏览器中正确定位，并使用简单的精灵设置复选框未选中和选中状态。所需要的只是使用上述 Checkbox Toggle Hack 调整背景位置。在我看来，这是更优雅的解决方案，因为您可以更好地控制复选框和收音机，并且可以保证它们在浏览器中看起来相同。

简单的 HTML：（**按照链接查看带有注释的 CSS，代码块是为了满足 StackOverflow）** [http://jsfiddle.net/Sx5M2/](http://jsfiddle.net/Sx5M2/)

```
<label><input type="checkbox" /><div class="checkbox"></div>Label text</label> 
```

* * *

如果有人不同意这些方法，请给我留言，我很想听听一些反馈，说明为什么其他人没有遇到这些解决方案，或者如果他们有，为什么我在这里看不到关于它们的答案？如果有人看到其中一种方法失败了，也很高兴看到，但是这些方法已经在最新的浏览器中进行了测试，并且依赖于我所看到的非常古老且通用的 HTML / CSS 方法。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2015-09-16T14:02:16.483

**下面给出了跨浏览器的像素完美一致性，甚至是 IE9：**

该方法非常明智，显而易见：

1.  创建一个输入和一个标签。
2.  将它们显示为块，以便您可以随意浮动它们。
3.  将高度和行高设置为相同的值，以确保它们居中并垂直对齐。
4.  对于***em***测量，要计算元素的高度，浏览器必须知道这些元素的字体高度，并且它本身不能在 em 测量中设置。

**这导致了一个全球适用的一般规则：**

```
input, label {display:block;float:left;height:1em;line-height:1em;} 
```

字体大小可根据表单、字段集或元素进行调整。

```
#myform input, #myform label {font-size:20px;} 
```

***在 Mac、Windows、Iphone 和 Android 上的最新 Chrome、Safari 和 Firefox 中测试。和IE9。***

此方法可能适用于所有不高于一行文本的输入类型。应用类型规则以适应。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-03-19T17:12:35.807

耶，谢谢！这也一直让我发疯。

在我的特殊情况下，这对我有用：

```
input {
    width: 13px;
    height: 13px;
    padding: 0;
    margin:0;
    vertical-align: top;
    position: relative;
    *top: 1px;
    *overflow: hidden;
}
label {
    display: block;
    padding: 0;
    padding-left: 15px;
    text-indent: -15px;
    border: 0px solid;
    margin-left: 5px;
    vertical-align: top;
} 
```

我正在使用 reset.css 这可能会解释一些差异，但这似乎对我来说效果很好。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2010-07-08T04:11:49.953

这不是解决问题的最佳方式

```
vertical-align: middle 
```

* * *

添加`style="position:relative;top:2px;"`到输入框会将其向下移动`2px`。因此，根据您的字体大小，您可以移动它。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2010-10-18T13:28:09.853

`position: relative;`在 IE 中，z-index 和 jQuery 的 slideUp/slideDown 等动画存在一些问题。

CSS：

```
input[type=checkbox], input[type=radio] {
    vertical-align: baseline;
    position: relative;
    top: 3px;
    margin: 0 3px 0 0;
    padding: 0px;
}
input.ie7[type=checkbox], input.ie7[type=radio] {
    vertical-align: middle;
    position: static;
    margin-bottom: -2px;
    height: 13px;
    width: 13px;
} 
```

jQuery：

```
$(document).ready(function () {
    if ($.browser.msie && $.browser.version <= 7) {
        $('input[type=checkbox]').addClass('ie7');
        $('input[type=radio]').addClass('ie7');
    }
}); 
```

样式可能需要根据中使用的字体大小进行调整`<label>`

PS：
我使用[ie7js](http://ie7-js.googlecode.com/)使 css 在 IE6 中工作。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-07-30T10:04:29.353

简单地使用`vertical-align: sub`，正如[pokrishka](https://stackoverflow.com/a/26781309/1763602)已经建议的那样。

[小提琴](https://jsfiddle.net/3e3gL73w/)

HTML 代码：

```
<div class="checkboxes">
    <label for="check1">Test</label>
    <input id="check1" type="checkbox"></input>
</div> 
```

CSS 代码：

```
.checkboxes input {
    vertical-align: sub;
} 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2018-08-28T22:55:13.477

**简单的解决方案：**

```
<label style="display:block">
  <input style="vertical-align:middle" type="checkbox">
  <span  style="vertical-align:middle">Label</span>
</label> 
```

**在 Chrome、Firefox、[IE9](https://www.browserling.com/browse/win/vista/ie/9/http%3A%2F%2Fwww.sharhon.com%2Ffiles%2Fcheckbox-align.html) +、Safari、iOS 9+中测试**

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2010-12-30T20:49:55.723

```
<fieldset class="checks">
    <legend>checks for whatevers</legend>
    <input type="" id="x" />
    <label for="x">Label</label>
    <input type="" id="y" />
    <label for="y">Label</label>
    <input type="" id="z" />
    <label for="z">Label</label>
</fieldset> 
```

无论如何，您应该将组合在一起的表单控件包装在它们自己的字段集中，在这里，它播放 wrappa。设置输入/标签做显示：块，输入浮动左，标签浮动右，设置你的宽度，控制间距与左/右边距，相应地对齐标签文本。

所以

```
fieldset.checks {
    width:200px
}
.checks input, .checks label {
    display:block;
}
.checks input {
    float:right;
    width:10px;
    margin-right:5px
}
.checks label {
    float:left;
    width:180px;
    margin-left:5px;
    text-align:left;
    text-indent:5px
} 
```

您可能还需要为跨浏览器/媒体解决方案设置边框、轮廓和行高。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2013-05-29T22:40:40.927

也许有些人犯了和我一样的错误？这是...我已经为输入框设置了一个宽度，因为它们大多是 'text' 类型，但后来忘记覆盖复选框的宽度 - 所以我的复选框试图占据很多多余的宽度和所以很难在它旁边对齐标签。

```
.checkboxlabel {
    width: 100%;
    vertical-align: middle;
}
.checkbox {
    width: 20px !important;
} 
```

```
<label for='acheckbox' class='checkboxlabel'>
    <input name="acheckbox" id='acheckbox' type="checkbox" class='checkbox'>Contact me</label> 
```

早在 IE6（使用类选择器）和 Firefox、Safari 和 Chrome 的最新版本中就提供可点击的标签和正确的对齐方式

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2019-01-31T00:27:57.087

我发现我可以排列它们的唯一方法是使用绝对位置作为输入。玩弄输入的顶部变量得到了我想要的结果。

```
div {
  clear:    both;
  float:    none;
  position: relative;
}

input {
  left:     5px;
  position: absolute;
  top:      3px;
}

label {
  display:     block;
  margin-left: 20px;
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-05-11T15:42:08.660

```
label {
    display: inline-block;
    padding-right: 10px;
}
input[type=checkbox] {
    position: relative;
    top: 2px;
} 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-11-17T12:30:48.370

最简单的解决方案是

```
input {
  vertical-align: text-top;
}
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2012-11-23T21:21:19.970

我发现了一种在几乎所有浏览器中都给出相同结果的方法。至少是最新的浏览器。它适用于 Firefox、Chrome、Safari、Opera。在 IE 中，它看起来几乎就像没有为输入或标签应用规则（即，它仍然在输入**下方**有几个像素的标签），所以我认为这是可以原谅的。

HTML

```
<label class="boxfix"><input type="radio">Label</label> 
```

CSS

```
.boxfix {
    vertical-align: bottom;
}
.boxfix input {
    margin: 0;
    vertical-align: bottom;
    position: relative;
    top: 1.999px; /* the inputs are slightly more centered in IE at 1px (they don't interpret the .999 here), and Opera will round it to 2px with three decimals */
} 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2013-07-29T21:55:33.250

为了与跨浏览器的表单字段保持一致，我们使用：**box-sizing:border-box**

```
button, checkbox, input, radio, textarea, submit, reset, search, any-form-field {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
} 
```

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2013-11-20T10:21:02.523

试试这个代码

```
input[type="checkbox"] {
    -moz-appearance: checkbox;
    -webkit-appearance: checkbox;
    margin-left:3px;
    border:0;
    vertical-align: middle;
    top: -1px;
    bottom: 1px;
    *overflow: hidden;
    box-sizing: border-box; /* 1 */
    *height: 13px; /* Removes excess padding in IE 7 */
    *width: 13px;
    background: #fff;
} 
```

* * *

## 回答 #40

> 赞同：-2
> 
> 时间：2010-02-23T13:16:32.877

```
input {
    margin: 0;
} 
```

实际上可以解决问题

# asp.net - 这两种访问 SharePoint 模型的方法有什么区别？

> ID：306253
> 
> 赞同：4
> 
> 时间：2008-11-20T18:02:32.693
> 
> 标签：asp.net, sharepoint, wss

在从 ASP.NET 应用程序访问 SharePoint Services 3.0 网站的 SharePoint 模型的几种方法中，有两种方法似乎非常相似：

1.  `SPWeb site = SPControl.GetContextWeb(Context);`

2.  `SPWeb site = SPContext.Current.Web;`

据我了解，这两种方法都需要在 ASP.NET 应用程序中执行，那么它们之间有什么区别？是否存在一种更适合使用另一种的情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T21:41:25.917

它们在技术上保存了相同的目的，但我建议您使用在 WSS V3.0 的对象模型中引入的 SPContext。SPControl 类只是为了向后兼容 WSS V2.0

# api - 浏览器 <-> 客户端硬件 API？

> ID：306267
> 
> 赞同：0
> 
> 时间：2008-11-20T18:07:09.487
> 
> 标签：api, browser, thin-client

是否有任何举措来实施/同意标准 API 以用于 Web 浏览器和客户端硬件之间的连接。

示例：iPhone 中有一个 GPS/相机/加速度计。如果我的 web 应用程序可以与他们通信（而不是我必须编写一个厚厚的 ObjectiveC 应用程序），那就太酷了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:04:29.297

我见过的最接近的东西是 Android 手机 API，它可以让你的程序（相对）轻松地访问它的硬件。谷歌正在推动它成为新标准，但它与网络应用程序（根据大多数定义，完全在您的浏览器中运行？）几乎不是一回事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-02T01:49:47.990

即将推出的 FireFox 版本有一个 API 可以从 GPS 设备上读取您的纬度/经度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:38:46.163

补充我自己的问题；雅虎提供了一个名为 FireEagle 的地理定位服务，它可以充当中介并提供类似的功能。

本质上，手机与更新其位置的中央雅虎服务器通信。然后，您的 Web 应用程序可以从该中央服务器确定您的大致位置。

# http - 通过 REST (RESTful) API 进行批量收集操作

> ID：306271
> 
> 赞同：74
> 
> 时间：2008-11-20T18:08:01.887
> 
> 标签：http, rest

我想要一些关于设计 REST API 的建议，该 API 将允许客户端有效地向集合添加/删除大量对象。

通过 API，客户端需要能够将项目添加到集合中并从中删除项目，以及操作现有项目。在许多情况下，客户希望对集合进行批量更新，例如添加 1000 个项目并删除 500 个不同的项目。感觉客户端应该能够在与服务器的单个事务中执行此操作，而不是需要 1000 个单独的 POST 请求和 500 个 DELETE。

有没有人有关于实现这一目标的最佳实践或约定的任何信息？

我目前的想法是应该能够 PUT 一个表示对集合 URI 的更改的对象，但这似乎与[HTTP 1.1 RFC](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6)不一致，这似乎表明在 PUT 请求中发送的数据应该独立于URI 中已经存在的数据。这意味着客户端必须一次性发送集合新状态的完整描述，这很可能比更改要大得多，甚至比客户端发出请求时所知道的还要多。

显然，如有必要，我很乐意偏离 RFC，但如果存在这样的约定，我更愿意以传统方式执行此操作。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-08-12T23:10:35.097

您可能希望将更改任务本身视为一种资源。因此，您实际上是在 PUT-ing 一个对象，它是一个批量数据更新对象。也许它有一个名称、所有者和 CSV、XML 等的大块，需要解析和执行。对于 CSV，您可能还想确定 CSV 数据中表示的对象类型。

列出作业、添加作业、查看作业状态、更新作业（可能是为了启动/停止它）、删除作业（如果它正在运行则停止它）等。这些操作很容易映射到 REST API 设计。

完成此操作后，您可以轻松添加批量数据更新程序可以处理的不同数据类型，甚至可以在同一个任务中混合在一起。换句话说，对于您要导入的每种类型的东西，没有必要在您的应用程序中复制相同的 API。

这也很容易实现后台任务。在这种情况下，您可能希望向各个任务对象添加字段，以允许 API 客户端指定他们希望如何获得通知（他们希望您在完成后获取的 URL，或向他们发送电子邮件等） .

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-08-13T07:52:59.623

是的，PUT 创建/覆盖，但不会部分更新。

如果您需要部分更新语义，请使用 PATCH。请参阅[http://greenbytes.de/tech/webdav/draft-dusseault-http-patch-14.html](http://greenbytes.de/tech/webdav/draft-dusseault-http-patch-14.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T18:21:39.847

您应该使用[AtomPub](http://bitworking.org/projects/atom/rfc5023.html#rfc.section.1)。它专为通过 HTTP 管理集合而设计。甚至可能有您选择的语言的实现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T20:09:26.883

对于 POST，至少，您似乎应该能够 POST 到列表 URL 并让请求的正文包含新资源列表而不是单个新资源。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-04T10:23:31.917

据我了解，REST 表示 REpresentational State Transfer，因此您应该将状态从客户端传输到服务器。

如果这意味着过多的数据来回传输，那么您可能需要更改您的表示。一个collectionChange结构可以工作，一系列删除（通过id）和添加（嵌入完整的xml表示），发布到处理接口URL。接口实现可以选择自己的方法进行服务器端的删除和添加。

最纯粹的版本可能是通过 URL 定义项目，并且集合包含一系列 URL。新集合可以在客户端更改后被 PUT，然后是一系列被添加的项目的 PUT，如果您想实际从服务器中删除项目，而不是仅仅从该列表中删除它们，可能还会进行一系列删除。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T10:32:06.920

您可以引入不需要传输整个状态的现有集合元素的元表示，因此在一些抽象代码中，您的更新可能如下所示：

```
{现有元素 1-100}
{新元素 foo 的值为 "bar", "baz"}
{现有元素 105}
{新元素 foobar 的值为 "bar", "foo"}
{现有元素 110-200}
```

添加（和修改）元素是通过定义它们的值来完成的，删除元素是通过不提及新集合来完成的，并且通过指定新顺序来重新排序元素（如果完全存储了顺序）。

通过这种方式，您可以轻松地表示整个新集合，而无需重新传输整个内容。使用`If-Unmodified-Since`标头可确保您对内容的想法确实与服务器的想法相匹配（这样您就不会意外删除您在提交请求时根本不知道的元素）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-01-30T05:02:16.433

最好的方法是：

```
Pass Only Id Array of Deletable Objects from Front End Application To Web API
    2\. Then You have Two Options: 
       2.1 Web API Way : Find All Collections/Entities using Id arrays and Delete in API , but you need to take care of Dependant entities like Foreign Key Relational Table Data too
     2.2\. Database Way : Pass Ids to your database side, find all records in Foreign Key Tables and Primary Key Tables and Delete in same order i.e. F-Key Table records then P-Key Table records 
```

# php - 如何在 PHP 中的类中创建调度表？

> ID：306272
> 
> 赞同：2
> 
> 时间：2008-11-20T18:08:24.820
> 
> 标签：php, dispatch-table

假设我有一个带有私人调度表的课程。

```
$this->dispatch = array(
    1 => $this->someFunction,
    2 => $this->anotherFunction
); 
```

如果我再打电话

```
$this->dispatch[1](); 
```

我收到一个错误，该方法不是字符串。当我把它变成这样的字符串时：

```
$this->dispatch = array(
    1 => '$this->someFunction'
); 
```

这会产生 **致命错误：调用未定义函数 $this->someFunction()**

我也尝试过使用：

```
call_user_func(array(SomeClass,$this->dispatch[1])); 
```

导致**消息： call_user_func(SomeClass::$this->someFunction) [function.call-user-func]: 第一个参数应该是一个有效的回调**。

**编辑：**我意识到这并没有真正的意义，因为当 $this 是 SomeClass 时它正在调用 SomeClass::$this。我已经尝试了几种方法，数组包含

```
array($this, $disptach[1]) 
```

这仍然没有完成我所需要的。

**结束编辑**

如果我没有类并且只有一个带有一些功能的调度文件，这将有效。例如，这有效：

```
$dispatch = array(
    1 => someFunction,
    2 => anotherFunction
); 
```

我想知道是否有一种方法可以让我仍然将这些作为私有方法保留在类中，但仍然可以将它们与调度表一起使用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-20T18:17:14.753

您可以将方法的名称存储在 dispatch 中，例如：

```
$this->dispatch = array('somemethod', 'anothermethod'); 
```

然后使用：

```
$method = $this->dispatch[1];
$this->$method(); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-20T18:31:10.547

call_user_func*-Family 函数应该像这样工作：

```
$this->dispatch = array('somemethod', 'anothermethod');
...
call_user_func(array($this,$this->dispatch[1])); 
```

# java - 在复制构造函数中复制侦听器/观察器

> ID：306276
> 
> 赞同：4
> 
> 时间：2008-11-20T18:08:30.653
> 
> 标签：java

我正在编写一个实现可观察模式（而不是接口）的类，并且我正在考虑复制构造函数是否也应该复制侦听器。

一方面，复制构造函数应该创建一个尽可能接近原始实例的实例，以便它可以在显示上下文中被换出。

另一方面，这会假设听众可以应付这种事情。

有什么想法吗？有没有最佳实践？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T18:23:01.513

不要复制。侦听器不知道新对象并且不期望接收与其相关的消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T22:17:22.430

答案是**这取决于你想要发生什么**。

从技术上讲，您可以做三件事：

1.  什么都不复制。任何观察者都不会对新对象一无所知。
2.  让新对象将自己添加到旧观察者正在观察的事物列表中。现有的观察者将像对旧对象一样响应新对象。
3.  创建观察新对象的新观察者，就像旧对象观察旧对象一样。新的观察者将响应新对象的变化，就像旧的观察者对旧对象所做的那样。

其他海报肯定是正确的，1）可能是首选选项，如果只是因为在复制构造函数中执行 2 或 3 意味着**始终**创建/复制观察者。什么都不做允许稍后在必要时添加观察者。

但是，可以想象其他选项正确的情况。*如果您想要一个响应给定类的任何*实例的观察者，无论是如何创建的，那么 2) 是正确的。如果您的观察者为对象执行特定任务，并且不关心系统的其余部分，那么 3) 可能是方法。

通常最好考虑您的系统是如何工作的，而不仅仅是遵循规则。如果这不是您要修改的代码，请询问所有者。如果您根本不知道自己想要发生什么，请选择 1) 并稍后添加观察者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T20:13:00.340

我的偏好是**不要复制 listeners**。

侦听器注册在原始对象上，而不是副本上 - 如果您决定使用复制构造函数作为原型模式的基础，那么您最终会得到相同的侦听器来侦听系统中的几乎每个对象。

*然而*：与所有这些类型的问题一样，从最低限度开始（即不要复制），然后看看你是怎么做的。如果您发现自己在构造对象之后重复相同的代码，每次使用该构造函数（比如超过 3-4 次），那么重新考虑这个决定可能会很有成效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T18:18:24.517

不要复制。

# haskell - Haskell Typeclass 速记

> ID：306284
> 
> 赞同：23
> 
> 时间：2008-11-20T18:10:10.463
> 
> 标签：haskell, typeclass

因此，我有一对类型类，我将经常一起使用它们，并且我想避免每次都指定它们。基本上，而不是把

```
:: (Ord a, Fractional a, Ord b, Fractional b, ... Ord z, Fractional z) => 
```

在我所有类型规范的开头，我宁愿把

```
:: (OrdFractional a, OrdFractional b, ... OrdFractional z) 
```

所以，我最初的想法是声明一个新的类型类

```
module Example where

class (Fractional a, Ord a) => OrdFractional a

example :: (OrdFractional a, OrdFractional b) => (a,b) -> (a,b) -> (a,b) -> Bool
example (x1,y1) (x2,y2) (x3,y3) = (x1/x2 < x2/x3) && (y1/y2 < y2/y3) 
```

但这并没有像我希望的那样自动工作：

```
% ghci
Prelude> :l Example.hs
Ok, modules loaded: Example.
Prelude Example> example (1::Float,3::Float) (2,2) (3,1)

<interactive>:1:0:
    No instance for (OrdFractional Float)
      arising from a use of `example' at <interactive>:1:0-39
    Possible fix:
      add an instance declaration for (OrdFractional Float)
    In the expression: example (1 :: Float, 3 :: Float) (2, 2) (3, 1)
    In the definition of `it':
        it = example (1 :: Float, 3 :: Float) (2, 2) (3, 1) 
```

手动创建实例似乎很麻烦，所以接下来，我想我可能会尝试自动创建实例：

```
module Example where

class OrdFractional a
instance (Fractional a, Ord a) => OrdFractional a

example :: (OrdFractional a, OrdFractional b) => (a,b) -> (a,b) -> (a,b) -> Bool
example (x1,y1) (x2,y2) (x3,y3) = (x1/x2 < x2/x3) && (y1/y2 < y2/y3) 
```

但是编译器不喜欢这样：

```
ghc -c Example.hs

Example.hs:4:0:
    Illegal instance declaration for `OrdFractional a'
        (All instance types must be of the form (T a1 ... an)
         where a1 ... an are type *variables*,
         and each type variable appears at most once in the instance head.
         Use -XFlexibleInstances if you want to disable this.)
    In the instance declaration for `OrdFractional a' 
```

那么有没有办法我可以做到这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2012-11-29T07:42:01.803

随着 GHC 7.4 中引入的 ConstraintKinds 扩展，约束现在是 kind 类型`Constraint`，因此您可以使用普通类型同义词来获得您想要的：

```
{-# LANGUAGE ConstraintKinds #-}

type OrdFractional a = (Ord a, Fractional a) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-20T22:02:00.977

你想要的是一个类别名。[在http://repetae.net/recent/out/classalias.html](http://repetae.net/recent/out/classalias.html)有一个建议将它添加到 Haskell

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-07-03T05:44:47.360

当编译器说“ `Use -XFlexibleInstances`”时，您应该尝试添加

```
{-# LANGUAGE FlexibleInstances #-} 
```

到您的源代码的顶部（当然，请阅读文档以了解它的作用！）。

在这种特定情况下，这将使您的代码工作：

```
{-# LANGUAGE FlexibleInstances, UndecidableInstances #-} 
```

为了`=>`在实例头上启用上下文，需要灵活的实例，并且需要不可确定的实例，因为编译器在处理`OrdFractional a`上下文时可以结束向上下文添加`Fractional a`和`Ord a`- 这不会直接帮助最终确定`a`, 和在适当可怕的情况下，类型检查可能会出现分歧；编译器真的不喜欢那样。（如果编译器永远运行或内存不足，您可能不会喜欢它。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-03T07:41:38.947

不。

您对暗示其他类的超类的解决方案最接近您在 Haskell 中可能想要的解决方案。尽管这需要手动实例化该新类，但有时也会使用它，例如在[重写](http://hackage.haskell.org/package/rewriting)库中。

正如 CesarB 提到的那样，类别名可以满足您的需求（以及更多），但它们只是一个已经存在多年且从未实施过的提议，可能是因为它存在许多问题。相反，各种其他提案已经出现，但也没有一个被实施。（有关这些建议的列表，请参阅此[Haskellwiki 页面](http://haskell.org/haskellwiki/Comparing_class_alias_proposals)。）Hac5 的一个项目[是](http://haskell.org/haskellwiki/Hac5)修改 GHC 以包含一小部分称为*上下文同义词*的类别名（它完全符合您在这里的要求，仅此而已） ，但遗憾的是它从未完成。

# javascript - 用jQuery修改选定表格单元格的样式属性？

> ID：306285
> 
> 赞同：3
> 
> 时间：2008-11-20T18:10:22.023
> 
> 标签：javascript, jquery, html, dom, html-table

我正在使用直接 DOM 操作构建一个非常基本的 HTML 表格创建器/编辑器（基于 designMode iframe）。这很痛苦，显然是由于 Internet Explorer。

在设计模式下，插入到 iframe 编辑区的表格可以调整大小，并且可以自由编辑单元格的内容。在 Firefox 中，也可以添加和删除行和列。我目前专注于编辑边框宽度、前景色和背景色以及其他需要 DOM 工作的东西。

问题在于 IE6/7 中缺少适当的 DOM 选择/范围功能。我无法找到几个同时选择的单元格的包含节点。对于单个单元格，它可以使用 parentElement，但对于几个选定的单元格，parentElement 是容纳 TD 单元格的 TR 节点。由于缺少anchorNode、focusNode 和W3C DOM 提供的各种偏移，我无法弄清楚如何仅提取对TR 内已选择的那些TD 单元的节点引用。

我已经为符合 W3C 的浏览器实现了单个单元格以及选定单元格组的表格创建和样式修改，但我完全坚持使用 IE 实现。jQuery可以帮助我吗？我从未使用过它，但它似乎足够直观，掌握它所需的时间比弄清楚如何单独使用 IE DOM 做到这一点要少。

有三个基本的样式修改场景需要工作：

1.  未通过 Ctrl/Cmd 单击显式选择但其中包含文本光标的表格单元格必须更改其背景颜色。单元格中可能包含格式化文本或其他父节点/子节点关系复杂器。
2.  几个明确选择的表格单元格（Ctrl/Cmd 单击、Shift 选择或只是用鼠标“绘制”）必须更改其背景颜色。这必须适用于连续的矩形选择以及分散的单个选定单元格。
3.  需要可以对“选定表”进行表级修改（边框宽度、颜色等）。也就是说，在编辑区域中有多个表格的情况下，将针对一个或多个具有光标焦点的表格（场景 1）或其中包含选定单元格（场景 2）的表格进行修改。

在 Firefox 中，我已经拥有适用于所有三个场景的代码。现在我需要一个跨浏览器的解决方案。有谁能够帮助我？

（之前在这里讨论过 IE 的选择和范围问题，但不是在 jQuery 的上下文中。我一眼就发现[了](https://stackoverflow.com/questions/218043/issue-with-ie-selection-and-range)[这些](https://stackoverflow.com/questions/235411/is-there-an-internet-explorer-approved-substitute-for-selectionstart-and-select)：[164147、218043、235411](https://stackoverflow.com/questions/164147/character-offset-in-an-internet-explorer-textrange)）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T00:41:13.963

如果我理解正确，您需要用于选择表格单元格和更改选择的属性（CSS 属性）的通用代码。

您可以在 jQuery 中轻松完成此操作。

```
var curTableCell = null; // "Softclicked" - not part of the selection (1)

// We call this in the click event below.  You'd probably want this for keyboard events as well (for arrow key nav, etc.)
function softclick(element) {
    $(curTableCell).removeClass('softclicked');
    curTableCell = element;
    $(element).addClass('softclicked');
}

$('td, th').click(function() {
    if(keyHeld) { // Dunno how you do this (I'm not good at Javascript)
        $(this).toggleClass('selected'); // Explicitly added/removed to/from selection (2)
    } else {
        softclick(this);
    }
});

/* When you want to do something on selection: */
$('td.selected, th.selected').css({borderColor: 'red', borderWidth: '1px'});

/* When you want to do something on selected tables (3): */
$('td.selected, th.selected').parents('table')
    .css({borderColor: 'red', borderWidth: '1px'});
$('td.selected, th.selected').parents('table').children('td') // Change things on all of table's cells
    .css({borderColor: 'red', borderWidth: '1px'});
$('td.selected, th.selected, td.softclicked, th.softclicked').parents('table').children('td') // Change things on all of table's cells, including tables of "softclicked" cells
    .css({borderColor: 'red', borderWidth: '1px'}); 
```

（我不太擅长 Javascript 或 jQuery（目前正在学习），但我希望这足以让你开始。）

# asp.net - 自定义 ASP.NET 容器控件

> ID：306288
> 
> 赞同：14
> 
> 时间：2008-11-20T18:11:16.873
> 
> 标签：asp.net, custom-controls, panel

我一直在尝试创建一个自定义控件，该控件的工作原理与 Panel 控件完全相同，只是被几个 div 包围，这样可以创建一个圆角框外观。我还没有找到一个很好的例子来说明如何做到这一点。

我需要能够在控件内放置文本和控件并直接访问它而不引用面板（正是面板控件的工作方式）。

有没有人有这方面的例子？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-20T18:16:05.863

有两种方法可以做到这一点。一种是`INamingContainer`在你的控件上实现，这需要付出很多努力。

另一种方法是从 Panel 继承，并覆盖 RenderBeginTag 和 RenderEndTag 方法以添加您的自定义标记。这很简单。

```
public class RoundedCornersPanel : System.Web.UI.WebControls.Panel
{
    public override RenderBeginTag (HtmlTextWriter writer)
    {
        writer.Write("Your rounded corner opening markup");
        base.RenderBeginTag(writer);
    }

    public override RenderEndTag (HtmlTextWriter writer)
    {
        base.RenderEndTag(writer);
        writer.Write("Your rounded corner closing markup");                     
    }
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-02-22T11:01:44.423

这里已经有很多答案了，但我只是想粘贴这个最基本的实现，而不是从 Panel 类继承。所以这里是：

```
using System.ComponentModel;
using System.Web.UI;
using System.Web.UI.WebControls;

[ToolboxData("<{0}:SimpleContainer runat=server></{0}:SimpleContainer>")]
[ParseChildren(true, "Content")]
public class SimpleContainer : WebControl, INamingContainer
{
    [PersistenceMode(PersistenceMode.InnerProperty)]
    [TemplateContainer(typeof(SimpleContainer))]
    [TemplateInstance(TemplateInstance.Single)]
    public virtual ITemplate Content { get; set; }

    public override void RenderBeginTag(HtmlTextWriter writer)
    {
        // Do not render anything.
    }

    public override void RenderEndTag(HtmlTextWriter writer)
    {
        // Do not render anything.
    }

    protected override void RenderContents(HtmlTextWriter output)
    {
        output.Write("<div class='container'>");
        this.RenderChildren(output);
        output.Write("</div>");
    }

    protected override void OnInit(System.EventArgs e)
    {
        base.OnInit(e);

        // Initialize all child controls.
        this.CreateChildControls();
        this.ChildControlsCreated = true;
    }

    protected override void CreateChildControls()
    {
        // Remove any controls
        this.Controls.Clear();

        // Add all content to a container.
        var container = new Control();
        this.Content.InstantiateIn(container);

        // Add container to the control collection.
        this.Controls.Add(container);
    }
} 
```

然后你可以像这样使用它：

```
<MyControls:SimpleContainer
    ID="container1"
    runat="server">
    <Content>
        <asp:TextBox
            ID="txtName"
            runat="server" />

        <asp:Button
            ID="btnSubmit"
            runat="server"
            Text="Submit" />
    </Content>
</MyControls:SimpleContainer> 
```

从代码隐藏中，您可以执行以下操作：

```
this.btnSubmit.Text = "Click me!";
this.txtName.Text = "Jack Sparrow"; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T18:19:43.360

创建一个继承 System.Web.UI.Control 的类，并重写 Render (HtmlTextWriter) 方法。在此方法中，渲染周围的开始标签，然后渲染子项（RenderChildren），然后渲染结束标签。

```
protected override void Render ( HtmlTextWriter output )
{
  output.Write ( "<div>" );
  RenderChildren ( output );
  output.Write ( "</div>" );
} 
```

圆角通常使用 CSS 和左上角、右上角、左下角和右下角的角图像来实现。可以使用 4 个嵌套的 div 来完成，它们充当图层，每个图层都有一个角图像作为背景图像。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T18:22:16.523

代码项目有一些您可能感兴趣的东西：[Panel Curve Container - An ASP.NET Custom Control Nugget](http://www.codeproject.com/KB/custom-controls/panelcurvecontainer.aspx)。我相信您可以使用代码并拥有您想要的行为和外观。

![替代文字](https://www.codeproject.com/KB/custom-controls/PanelCurveContainer/PanelCurveContainer1.jpg)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-03T20:35:46.200

如果您不想直接从 WebControl 继承而不是从 Panel 继承，最简单的方法是使用属性装饰类`[ParseChildren(false)]`。尽管乍一看这可能表明您不想解析孩子，但`false`实际上表明您不希望孩子被视为属性。相反，您希望它们被视为控件。

通过使用此属性，您几乎可以获得所有开箱即用的功能：

```
[ToolboxData("<{0}:RoundedBox runat=server></{0}:RoundedBox>")]
[ParseChildren(false)]
public class RoundedBox : WebControl, INamingContainer
{
    public override void RenderBeginTag(HtmlTextWriter writer)
    {
        writer.Write("<div class='roundedbox'>");
    }

    public override void RenderEndTag(HtmlTextWriter writer)
    {
        writer.Write("</div>");
    }
} 
```

这将允许您将 RoundedBox 控件添加到您的页面，并添加将在您的 div 中呈现的子项（asp.net 控件或原始 html）。

当然，将添加 css 以正确设置 roundedbox 类的样式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T18:53:29.063

您可以使用的另一件事是，ASP.Net ajax 工具包中有一个[圆角扩展器。](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/RoundedCorners/RoundedCorners.aspx)

我知道这不完全符合您的要求，但您不必编写任何自定义代码。

希望有帮助！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-10T06:18:02.007

我看这个问题是因为我想制作一个 2 列布局面板。（不完全是，但它是我需要的一个更简单的例子。我正在分享我最终使用的解决方案：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace Syn.Test
{
    [DefaultProperty("Text")]
    [ToolboxData("<{0}:MultiPanel runat=server></{0}:MultiPanel>")]
    [ParseChildren(true)]
    [PersistChildren(false)]
    public class MultiPanel : WebControl, INamingContainer
    {
        public ContentContainer LeftContent { get; set; }

        public ContentContainer RightContent { get; set; }

        protected override void CreateChildControls()
        {
            base.CreateChildControls();
        }

        protected override void Render(HtmlTextWriter output)
        {
            output.AddStyleAttribute("width", "600px");
            output.RenderBeginTag(HtmlTextWriterTag.Div);

            output.AddStyleAttribute("float", "left");
            output.AddStyleAttribute("width", "280px");
            output.AddStyleAttribute("padding", "10px");
            output.RenderBeginTag(HtmlTextWriterTag.Div);
            LeftContent.RenderControl(output);
            output.RenderEndTag();

            output.AddStyleAttribute("float", "left");
            output.AddStyleAttribute("width", "280px");
            output.AddStyleAttribute("padding", "10px");
            output.RenderBeginTag(HtmlTextWriterTag.Div);
            RightContent.RenderControl(output);
            output.RenderEndTag();

            output.RenderEndTag();
         }
    }

    [ParseChildren(false)]
    public class ContentContainer : Control, INamingContainer
    {
    }
} 
```

我仍然遇到的问题是智能感知在这种情况下不起作用，它不会建议左右内容标签。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-11-20T18:25:02.913

```
public class myCustomPanel : Panel
{
    public override void RenderBeginTag(HtmlTextWriter writer)
    {
        writer.AddAttribute(HtmlTextWriterAttribute.Class, "top_left_corner");
        writer.RenderBeginTag(HtmlTextWriterTag.Div);
            base.RenderBeginTag(writer);
    }

    public override void RenderEndTag(HtmlTextWriter writer)
    {
            base.RenderEndTag(writer);
        writer.RenderEndTag();
    }

} 
```

# sql - SQL Server 中的 4 字节无符号整数？

> ID：306291
> 
> 赞同：19
> 
> 时间：2008-11-20T18:11:54.843
> 
> 标签：sql, sql-server-2005, types

MS SQL Server 中是否有 4 字节无符号整数数据类型？

我是否被迫使用 bigint？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-20T18:22:41.250

您可以在常规 int 中添加/减去 2,147,483,648 (2^31) 吗？（在输入的过程中减去，然后添加出来）我知道这听起来很傻，但是如果您声明一个自定义数据类型来执行此操作，它是整数运算并且非常快......它只是无法直接从表中读取

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-20T18:16:38.017

似乎并非如此。

这是一篇文章，描述了如何创建自己的规则，将 an 限制`int`为正值。但这并不能赋予您上述的积极价值`2^31-1`。

[http://www.julian-kuiters.id.au/article.php/sqlserver2005-unsigned-integer](http://www.julian-kuiters.id.au/article.php/sqlserver2005-unsigned-integer)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-11T08:15:04.953

您可以使用 bigint 并检查约束，但数据类型仍将是 8 字节 :(

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2016-01-17T12:56:26.607

我使用 BINT(11) 而不是 INT(11)，它充当 UNSIGNED INT(11)

# javascript - 什么会使 offsetParent 为空？

> ID：306305
> 
> 赞同：15
> 
> 时间：2008-11-20T18:17:45.830
> 
> 标签：javascript, html, positioning

我正在尝试在 JavaScript 中进行定位。我正在使用基于[经典 quirksmode 函数](http://www.quirksmode.org/js/findpos.html "查找位置")的累积位置函数，该函数对每个函数求和`offsetTop`，直到顶部节点。`offsetLeft``offsetParent`

但是，我遇到了一个问题，我感兴趣的元素`offsetParent`在 Firefox 中没有。在 IE`offsetParent`中存在，但`offsetTop`总和`offsetLeft`为 0，因此在效果上与 Firefox 中存在相同的问题。

什么会导致在屏幕上清晰可见且可用的元素没有`offsetParent`? 或者，更实际地，我怎样才能找到这个元素的位置以便在它下面放置一个下拉菜单？

**编辑**：以下是如何重现此特定实例的方法（当前接受的答案未解决）：

1.  打开[Stack Overflow 的主页](http://stackoverflow.com)。
2.  在 Web 浏览器（例如 Chromev21）的控制台中运行以下代码：

    ```
    var e = document.querySelector('div');
    console.log(e);
    // <div id="notify-container"></div>
    do{
      var s = getComputedStyle(e);
      console.log(e.tagName,s.display,s.visibility,s.position,e.offsetParent);
    } while(e=e.parentElement)
    // DIV block visible fixed null
    // BODY block visible static null
    // HTML block visible static null 
    ```

**为什么是`offsetParent`那个元素`null`？**

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2012-07-24T21:33:54.160

我[对 2,304 个 div 进行了测试](http://jsfiddle.net/XEHZV/3/)`position`，其中`display`、 和的值的`visibility`唯一组合嵌套在每个这些值的唯一组合中，并确定：

在以下情况下，作为 的后代的其他有效元素`<body>`
将没有`offsetParent`值：

*   该元素有`position:fixed`（*Webkit 和 IE9*）
*   该元素具有`display:none` （*Webkit 和 FF*）
*   任何祖先都有`display:none` （*Webkit 和 FF*）

*期望没有父元素或未添加到页面本身（不是页面的后代`<body>`）的元素也将具有`offsetParent==null`.*

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-20T18:46:06.117

如果文档尚未完成加载，则 offsetParent 可以为 null

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-10-06T22:50:14.103

[https://developer.mozilla.org/en/DOM/element.offsetParent](https://developer.mozilla.org/en/DOM/element.offsetParent)

当元素的 style.display 设置为“none”时，offsetParent 返回 null。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-27T23:18:39.823

这是一个老问题，但我有另一个案例。如果您操作 DOM，您最终可能会得到一个 null offsetParent - 在 IE6 和 IE7 中。

请参阅：[IE 6/7 - 访问 offsetParent (Javascript) 时出现“未指定错误”](http://weblogs.asp.net/rajbk/archive/2006/11/29/ie-6-7-unspecified-error-when-accessing-offsetparent-javascript.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-15T20:40:08.930

`offsetParent`如果您的元素对象尚未附加到 DOM，则将返回 null。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-22T20:24:25.993

当元素左侧的兄弟姐妹被隐藏时，我遇到了这个问题：

```
<div id="parent">
  <div id="element1">some stuff</div>
  <div id="element2" style="display: none">some hidden stuff</div>
  <div id="element3">child whose offset we want</div>
</div> 
```

我遇到了**element3的****offsetParent**为null 的情况，即使**element3**本身是可见的，并且**parent**是可见的。

 ******我见过瘦的是 Firefox 3.6 和 Chrome 5。它似乎也会影响**element3上的****getBoundingClientRect()**函数，这真的很烦人，因为它在许多其他情况下都有效！

 *** * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-01-16T15:01:22.727

`offsetParent`当父级位于 Web 组件内时，我也经历过`null`（即我尝试获取的元素`offsetParent`被投影到 Web 组件中）。

# python - "is" 运算符对整数的行为异常

> ID：306313
> 
> 赞同：591
> 
> 时间：2008-11-20T18:21:16.603
> 
> 标签：python, int, operators, identity, python-internals

为什么以下在 Python 中会出现意外行为？

```
>>> a = 256
>>> b = 256
>>> a is b
True           # This is an expected result
>>> a = 257
>>> b = 257
>>> a is b
False          # What happened here? Why is this False?
>>> 257 is 257
True           # Yet the literal numbers compare properly 
```

我正在使用 Python 2.5.2。尝试一些不同版本的 Python，似乎 Python 2.3.3 显示了 99 到 100 之间的上述行为。

基于上述，我可以假设 Python 是在内部实现的，因此“小”整数的存储方式与较大的整数不同，`is`操作员可以分辨出差异。为什么有泄漏的抽象？当我事先不知道它们是否是数字时，比较两个任意对象以查看它们是否相同的更好方法是什么？

* * *

## 回答 #1

> 赞同：432
> 
> 时间：2008-11-20T18:30:20.017

看看这个：

```
>>> a = 256
>>> b = 256
>>> id(a)
9987148
>>> id(b)
9987148
>>> a = 257
>>> b = 257
>>> id(a)
11662816
>>> id(b)
11662828 
```

这是我在 Python 2 文档[“Plain Integer Objects”](https://docs.python.org/2/c-api/int.html)中找到的内容（对于[Python 3](https://docs.python.org/3/c-api/long.html)也是如此）：

> 当前的实现为 -5 到 256 之间的所有整数保留一个整数对象数组，当您在该范围内创建一个 int 时，您实际上只是取回了对现有对象的引用。所以应该可以改变 1 的值。我怀疑 Python 在这种情况下的行为是未定义的。:-)

* * *

## 回答 #2

> 赞同：139
> 
> 时间：2015-03-04T20:20:12.797

> # Python 的“is”运算符对整数表现出意外？

总之——让我强调一下：***不要`is`用来比较整数。***

这不是你应该有任何期望的行为。

相反，使用`==`和`!=`分别比较相等和不等。例如：

```
>>> a = 1000
>>> a == 1000       # Test integers like this,
True
>>> a != 5000       # or this!
True
>>> a is 1000       # Don't do this! - Don't use `is` to test integers!!
False 
```

## 解释

要知道这一点，您需要了解以下内容。

首先，`is`做什么？它是一个比较运算符。从[文档](https://docs.python.org/2/reference/expressions.html#not-in)中：

> 对象身份的运算符`is`和测试：当且仅当 x 和 y 是同一个对象时为真。产生逆真值。`is not``x is y``x is not y`

所以以下是等价的。

```
>>> a is b
>>> id(a) == id(b) 
```

从[文档](https://docs.python.org/library/functions.html#id)中：

> **`id`** 返回对象的“身份”。这是一个整数（或长整数），保证该对象在其生命周期内是唯一且恒定的。具有不重叠生命周期的两个对象可能具有相同的`id()`值。

请注意，CPython（Python 的参考实现）中对象的 id 是内存中的位置这一事实是一个实现细节。Python 的其他实现（例如 Jython 或 IronPython）可以很容易地为`id`.

那么用例是`is`什么？ [PEP8 描述](https://www.python.org/dev/peps/pep-0008/#programming-recommendations)：

> 与单例的比较`None`应该总是使用`is`or `is not`，而不是相等运算符。

## 问题

您提出并陈述以下问题（带代码）：

> **为什么以下在 Python 中会出现意外行为？**
> 
> ```
> >>> a = 256
> >>> b = 256
> >>> a is b
> True           # This is an expected result 
> ```

这*不是*预期的结果。为什么是预期的？这仅意味着`256`两者引用`a`的整数值`b`是相同的整数实例。整数在 Python 中是不可变的，因此它们不能改变。这应该对任何代码都没有影响。这是不应该的。它只是一个实现细节。

但也许我们应该庆幸的是，每次我们声明一个等于 256 的值时，内存中都没有一个新的单独实例。

> ```
> >>> a = 257
> >>> b = 257
> >>> a is b
> False          # What happened here? Why is this False? 
> ```

看起来我们现在有两个独立的整数实例，其值`257`在内存中。由于整数是不可变的，这会浪费内存。希望我们没有浪费太多。我们可能不是。但不能保证这种行为。

> ```
> >>> 257 is 257
> True           # Yet the literal numbers compare properly 
> ```

好吧，这看起来像您的特定 Python 实现正试图变得聪明，并且除非必须这样做，否则不会在内存中创建冗余值整数。您似乎表明您正在使用 Python 的参考实现，即 CPython。适合 CPython。

如果 CPython 可以在全球范围内执行此操作可能会更好，如果它可以如此便宜地执行（因为查找会产生成本），也许另一种实现可能会更好。

但至于对代码的影响，您不应该关心整数是否是整数的特定实例。您应该只关心该实例的值是什么，并且您将为此使用正常的比较运算符，即`==`.

## `is`做什么

`is`检查`id`两个对象是否相同。在 CPython 中，`id`是内存中的位置，但它可能是另一个实现中的其他唯一标识号。用代码重申这一点：

```
>>> a is b 
```

是相同的

```
>>> id(a) == id(b) 
```

## 那我们为什么要使用`is`呢？

相对于检查两个非常长的字符串的值是否相等，这可以是一个非常快速的检查。但由于它适用于对象的唯一性，因此我们的用例有限。实际上，我们主要想用它来检查`None`，它是一个单例（存在于内存中某个位置的唯一实例）。如果有可能将它们混为一谈，我们可能会创建其他单例，我们可能会检查它们`is`，但这些相对较少。这是一个示例（适用于 Python 2 和 3），例如

```
SENTINEL_SINGLETON = object() # this will only be created one time.

def foo(keyword_argument=None):
    if keyword_argument is None:
        print('no argument given to foo')
    bar()
    bar(keyword_argument)
    bar('baz')

def bar(keyword_argument=SENTINEL_SINGLETON):
    # SENTINEL_SINGLETON tells us if we were not passed anything
    # as None is a legitimate potential argument we could get.
    if keyword_argument is SENTINEL_SINGLETON:
        print('no argument given to bar')
    else:
        print('argument to bar: {0}'.format(keyword_argument))

foo() 
```

哪个打印：

```
no argument given to foo
no argument given to bar
argument to bar: None
argument to bar: baz 
```

因此我们看到，使用`is`和 一个哨兵，我们能够区分何时`bar`调用不带参数和何时调用它`None`。这些是主要用例`is`- 不要*用*它来测试整数、字符串、元组或其他类似事物的相等性。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2016-01-23T13:26:00.273

*我迟到了，但是，你想要一些你的答案的来源吗？*我会尝试以介绍性的方式表达这一点，以便更多人可以跟进。

* * *

CPython 的一个好处是您实际上可以看到它的源代码。我将使用**3.5**版本的链接，但找到相应的**2.x**版本是微不足道的。

在 CPython 中，处理创建新对象的**C-API**函数是. 这个函数的描述是：`int`[`PyLong_FromLong(long v)`](https://docs.python.org/3/c-api/long.html#c.PyLong_FromLong)

> *当前的实现为 -5 到 256 之间的所有整数保留一个整数对象数组，当您在该范围内创建一个 int 时，您实际上只是取回了对现有对象的引用*。所以应该可以改变 1 的值。我怀疑 Python 在这种情况下的行为是未定义的。:-)

（我的斜体）

不了解你，但我看到这个并想：*让我们找到那个数组！*

如果您还没有摆弄实现 CPython 的 C 代码，*那么您应该*；一切都井井有条，可读性强。对于我们的例子，我们需要查看[主源代码目录树](https://hg.python.org/cpython/file/tip)的[`Objects`子目录](https://hg.python.org/cpython/file/d489394a73de/Objects/)。

`PyLong_FromLong`处理`long`对象，因此不难推断我们需要窥视内部[`longobject.c`](https://hg.python.org/cpython/file/tip/Objects/longobject.c)。往里看后，你可能会认为事情很混乱；他们是，但不要害怕，我们正在寻找的功能正在[230 行](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l230)等待我们检查。这是一个很小的函数，所以主体（不包括声明）很容易粘贴在这里：

```
PyObject *
PyLong_FromLong(long ival)
{
    // omitting declarations

    CHECK_SMALL_INT(ival);

    if (ival < 0) {
        /* negate: cant write this as abs_ival = -ival since that
           invokes undefined behaviour when ival is LONG_MIN */
        abs_ival = 0U-(unsigned long)ival;
        sign = -1;
    }
    else {
        abs_ival = (unsigned long)ival;
    }

    /* Fast path for single-digit ints */
    if (!(abs_ival >> PyLong_SHIFT)) {
        v = _PyLong_New(1);
        if (v) {
            Py_SIZE(v) = sign;
            v->ob_digit[0] = Py_SAFE_DOWNCAST(
                abs_ival, unsigned long, digit);
        }
        return (PyObject*)v; 
} 
```

现在，我们不是 C *master-code-haxxorz*但我们也不傻，我们可以看到它`CHECK_SMALL_INT(ival);`诱人地偷看我们；我们可以理解这与此有关。[让我们来看看：](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l51)

```
#define CHECK_SMALL_INT(ival) \
    do if (-NSMALLNEGINTS <= ival && ival < NSMALLPOSINTS) { \
        return get_small_int((sdigit)ival); \
    } while(0) 
```

`get_small_int`因此，如果值`ival`满足条件，它是一个调用函数的宏：

```
if (-NSMALLNEGINTS <= ival && ival < NSMALLPOSINTS) 
```

那么`NSMALLNEGINTS`和是什么`NSMALLPOSINTS`？宏！*[他们在这里](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l12)*：

```
#ifndef NSMALLPOSINTS
#define NSMALLPOSINTS           257
#endif
#ifndef NSMALLNEGINTS
#define NSMALLNEGINTS           5
#endif 
```

所以我们的条件是`if (-5 <= ival && ival < 257)`call `get_small_int`。

接下来让我们看看[`get_small_int`它的所有荣耀](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l37)（好吧，我们只看它的身体，因为那是有趣的地方）：

```
PyObject *v;
assert(-NSMALLNEGINTS <= ival && ival < NSMALLPOSINTS);
v = (PyObject *)&small_ints[ival + NSMALLNEGINTS];
Py_INCREF(v); 
```

好的，声明一个`PyObject`，断言前面的条件成立并执行赋值：

```
v = (PyObject *)&small_ints[ival + NSMALLNEGINTS]; 
```

`small_ints`看起来很像我们一直在寻找的那个数组，它就是！*[我们本可以只阅读该死的文档，我们就会一直知道！](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l25)*：

```
/* Small integers are preallocated in this array so that they
   can be shared.
   The integers that are preallocated are those in the range
   -NSMALLNEGINTS (inclusive) to NSMALLPOSINTS (not inclusive).
*/
static PyLongObject small_ints[NSMALLNEGINTS + NSMALLPOSINTS]; 
```

所以是的，这是我们的家伙。当您想`int`在该范围内创建一个新对象时`[NSMALLNEGINTS, NSMALLPOSINTS)`，您只需返回对已预先分配的现有对象的引用。

由于引用指向同一个对象，`id()`直接发出或检查身份`is`将返回完全相同的东西。

### 但是，他们什么时候分配？

[在`_PyLong_Init`](https://hg.python.org/cpython/file/tip/Objects/longobject.c#l5343)Python 的初始化过程中，我们很乐意输入一个 for 循环来为您执行此操作：

```
for (ival = -NSMALLNEGINTS; ival <  NSMALLPOSINTS; ival++, v++) { 
```

查看源代码以阅读循环体！

我希望我的解释现在已经使您清楚地了解*C*事情（双关语显然是有意的）。

* * *

### 但是，`257 is 257`? 这是怎么回事？

这实际上更容易解释，[我已经尝试过这样做](https://stackoverflow.com/questions/34147515/is-operator-returns-different-results-on-integers)；这是因为 Python 会将这个交互式语句作为一个块执行：

```
>>> 257 is 257 
```

在编译此语句期间，CPython 将看到您有两个匹配的文字并将使用相同的`PyLongObject`表示`257`。如果您自己进行编译并检查其内容，您可以看到这一点：

```
>>> codeObj = compile("257 is 257", "blah!", "exec")
>>> codeObj.co_consts
(257, None) 
```

当 CPython 执行操作时，它现在将加载完全相同的对象：

```
>>> import dis
>>> dis.dis(codeObj)
  1           0 LOAD_CONST               0 (257)   # dis
              3 LOAD_CONST               0 (257)   # dis again
              6 COMPARE_OP               8 (is) 
```

所以`is`会回来`True`。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2008-11-20T18:36:06.977

这取决于您是否要查看 2 个事物是否相等或相同的对象。

`is`检查它们是否是同一个对象，而不仅仅是相等。小整数可能指向相同的内存位置以提高空间效率

```
In [29]: a = 3
In [30]: b = 3
In [31]: id(a)
Out[31]: 500729144
In [32]: id(b)
Out[32]: 500729144 
```

您应该使用`==`来比较任意对象的相等性。您可以使用`__eq__`, 和`__ne__`属性指定行为。

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2008-11-20T19:50:11.337

正如您可以检查[源文件*intobject.c 一样*](http://svn.python.org/projects/python/trunk/Objects/intobject.c)，Python 缓存小整数以提高效率。每次创建对小整数的引用时，您指的是缓存的小整数，而不是新对象。257不是一个小整数，所以计算为不同的对象。

最好`==`用于此目的。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2008-11-20T18:29:48.583

我认为你的假设是正确的。试验`id`（对象的身份）：

```
In [1]: id(255)
Out[1]: 146349024

In [2]: id(255)
Out[2]: 146349024

In [3]: id(257)
Out[3]: 146802752

In [4]: id(257)
Out[4]: 148993740

In [5]: a=255

In [6]: b=255

In [7]: c=257

In [8]: d=257

In [9]: id(a), id(b), id(c), id(d)
Out[9]: (146349024, 146349024, 146783024, 146804020) 
```

似乎数字`<= 255`被视为文字，上面的任何内容都被不同地对待！

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-11-21T01:58:53.853

对于不可变的值对象，如整数、字符串或日期时间，对象标识并不是特别有用。最好考虑平等。身份本质上是值对象的实现细节——因为它们是不可变的，所以对同一个对象或多个对象具有多个引用之间没有有效的区别。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2018-03-25T03:48:45.813

任何现有答案中都没有指出另一个问题。Python 允许合并任何两个不可变值，并且预先创建的小 int 值并不是发生这种情况的唯一方法。Python 实现永远不能*保证*这样做，但它们都不仅仅是小整数。

* * *

一方面，还有一些其他预先创建的值，例如空`tuple`的 、`str`和`bytes`，以及一些短字符串（在 CPython 3.6 中，它是 256 个单字符 Latin-1 字符串）。例如：

```
>>> a = ()
>>> b = ()
>>> a is b
True 
```

* * *

而且，即使是非预先创建的值也可以是相同的。考虑这些例子：

```
>>> c = 257
>>> d = 257
>>> c is d
False
>>> e, f = 258, 258
>>> e is f
True 
```

这不仅限于`int`值：

```
>>> g, h = 42.23e100, 42.23e100
>>> g is h
True 
```

显然，CPython 没有`float`为`42.23e100`. 那么，这里发生了什么？

CPython 编译器将在同一个编译单元中合并一些已知不可变类型的常量值，例如`int`, `float`, `str`, 。`bytes`对于一个模块，整个模块是一个编译单元，但在交互式解释器中，每条语句都是一个单独的编译单元。由于`c`和`d`是在单独的语句中定义的，因此它们的值不会合并。由于`e`和`f`在同一语句中定义，因此它们的值被合并。

* * *

您可以通过反汇编字节码来查看发生了什么。尝试定义一个函数`e, f = 128, 128`然后调用`dis.dis`它，你会看到有一个常量值`(128, 128)`

```
>>> def f(): i, j = 258, 258
>>> dis.dis(f)
  1           0 LOAD_CONST               2 ((128, 128))
              2 UNPACK_SEQUENCE          2
              4 STORE_FAST               0 (i)
              6 STORE_FAST               1 (j)
              8 LOAD_CONST               0 (None)
             10 RETURN_VALUE
>>> f.__code__.co_consts
(None, 128, (128, 128))
>>> id(f.__code__.co_consts[1], f.__code__.co_consts[2][0], f.__code__.co_consts[2][1])
4305296480, 4305296480, 4305296480 
```

* * *

您可能会注意到编译器已将其存储`128`为常量，即使它实际上并未被字节码使用，这让您了解 CPython 的编译器所做的优化是多么少。这意味着（非空）元组实际上并没有最终合并：

```
>>> k, l = (1, 2), (1, 2)
>>> k is l
False 
```

把它放在一个函数中，`dis`它，看看`co_consts`——有一个`1`和一个`2`，两个`(1, 2)`元组共享相同但不相同，一个`1`元组有两个不同的相等元组。`2``((1, 2), (1, 2))`

* * *

CPython 还做了一项优化：字符串实习。与编译器常量折叠不同，这不仅限于源代码文字：

```
>>> m = 'abc'
>>> n = 'abc'
>>> m is n
True 
```

另一方面，它受限于类型和[内部存储类型“ascii compact”、“compact”或“legacy ready”](https://github.com/python/cpython/blob/master/Include/unicodeobject.h#L197)`str`的字符串，在许多情况下，只有“ascii compact”会被实习。

* * *

无论如何，关于什么值必须是、可能是或不能不同的规则因实现而异，在同一实现的版本之间，甚至可能在同一实现的同一副本上运行相同代码之间有所不同.

为了好玩，学习一个特定 Python 的规则是值得的。但是在你的代码中依赖它们是不值得的。唯一安全的规则是：

*   不要编写假定两个相等但单独创建的不可变值相同的代码（不要使用`x is y`，使用`x == y`）
*   不要编写假定两个相等但单独创建的不可变值是不同的代码（不要使用`x is not y`，使用`x != y`）

或者，换句话说，仅用于`is`测试记录的单例（如`None`）或仅在代码中的一个位置创建的单例（如`_sentinel = object()`习语）。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-03-20T11:20:46.180

`is` *是*恒等运算符（功能类似于`id(a) == id(b)`）；只是两个相等的数字不一定是同一个对象。出于性能原因，一些小整数恰好被[记忆](http://en.wikipedia.org/wiki/Memoization)，因此它们往往是相同的（可以这样做，因为它们是不可变的）。

`===`另一方面，[PHP 的](http://en.wikipedia.org/wiki/PHP)`x == y and type(x) == type(y)`运算符被描述为检查相等性和类型：根据 Paulo Freitas 的评论。这对于常见的数字就足够了，但与以荒谬方式`is`定义的类不同：`__eq__`

```
class Unequal:
    def __eq__(self, other):
        return False 
```

PHP 显然允许对“内置”类进行同样的操作（我认为这是在 C 级别实现的，而不是在 PHP 中实现的）。一个稍微不那么荒谬的使用可能是一个计时器对象，它每次用作数字时都有不同的值。这就是为什么您要模拟 Visual Basic`Now`而不是显示它是`time.time()`我不知道的评估的原因。

Greg Hewgill (OP) 发表了一条澄清评论：“我的目标是比较对象身份，而不是价值平等。除了数字，我想将对象身份视为价值平等。”

这将有另一个答案，因为我们必须将事物归类为数字，以选择我们是否与`==`或进行比较`is`。[CPython](http://en.wikipedia.org/wiki/CPython)定义了[数字协议](http://docs.python.org/2/c-api/number.html)，包括 PyNumber_Check，但这不能从 Python 本身访问。

我们可以尝试使用`isinstance`我们知道的所有数字类型，但这不可避免地是不完整的。types 模块包含一个 StringTypes 列表，但没有 NumberTypes。从 Python 2.6 开始，内置的数字类有一个基类[`numbers.Number`](https://docs.python.org/2/library/numbers.html#numbers.Number)，但它有同样的问题：

```
import numpy, numbers
assert not issubclass(numpy.int16,numbers.Number)
assert issubclass(int,numbers.Number) 
```

顺便说一句，[NumPy](http://en.wikipedia.org/wiki/NumPy)将产生单独的低数字实例。

我实际上不知道这个问题的变体的答案。我想理论上可以使用 ctypes 来调用`PyNumber_Check`，但即使是那个函数[也有争议](http://mail.python.org/pipermail/python-dev/2002-November/030237.html)，而且它肯定不是可移植的。我们只需要对我们现在测试的内容不那么挑剔。

最后，这个问题源于 Python 最初没有具有像[Scheme](http://en.wikipedia.org/wiki/Scheme_%28programming_language%29) `number?`或[Haskell 的](http://en.wikipedia.org/wiki/Haskell_%28programming_language%29) [类型类](https://en.wikipedia.org/wiki/Type_class) [Num](http://www.haskell.org/ghc/docs/7.4-latest/html/libraries/base-4.5.1.0/Prelude.html#t:Num)这样的谓词的类型树。`is`检查对象身份，而不是值相等。PHP 也有一段丰富多彩的历史，`===`显然只表现在 PHP5`is`中的对象[上，而不是 PHP4](http://www.php.net/manual/en/language.operators.comparison.php)上。这就是跨语言（包括一种语言的版本）移动的日益增长的痛苦。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-10-14T15:53:05.600

字符串也会发生这种情况：

```
>>> s = b = 'somestr'
>>> s == b, s is b, id(s), id(b)
(True, True, 4555519392, 4555519392) 
```

现在一切似乎都很好。

```
>>> s = 'somestr'
>>> b = 'somestr'
>>> s == b, s is b, id(s), id(b)
(True, True, 4555519392, 4555519392) 
```

这也是意料之中的。

```
>>> s1 = b1 = 'somestrdaasd ad ad asd as dasddsg,dlfg ,;dflg, dfg a'
>>> s1 == b1, s1 is b1, id(s1), id(b1)
(True, True, 4555308080, 4555308080)

>>> s1 = 'somestrdaasd ad ad asd as dasddsg,dlfg ,;dflg, dfg a'
>>> b1 = 'somestrdaasd ad ad asd as dasddsg,dlfg ,;dflg, dfg a'
>>> s1 == b1, s1 is b1, id(s1), id(b1)
(True, False, 4555308176, 4555308272) 
```

现在这是出乎意料的。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2019-08-24T20:34:16.037

[Python 3.8 的新特性：Python 行为的变化](https://docs.python.org/3.8/whatsnew/3.8.html#changes-in-python-behavior)：

> 当身份检查 (和 ) 与某些类型的文字（例如字符串、整数）一起使用时，编译器现在会生成[SyntaxWarning 。](https://docs.python.org/3.8/library/exceptions.html#SyntaxWarning)这些通常可以在 CPython 中意外工作，但语言规范不能保证。该警告建议用户改用相等测试 ( 和)。`is``is not``==``!=`

# c++ - 确定两个矩形是否相互重叠？

> ID：306316
> 
> 赞同：367
> 
> 时间：2008-11-20T18:21:45.807
> 
> 标签：c++, algorithm, geometry, overlap, rectangles

我正在尝试编写一个 C++ 程序，该程序接受用户的以下输入来构造矩形（2 到 5 之间）：高度、宽度、x-pos、y-pos。所有这些矩形都将平行于 x 和 y 轴存在，也就是说，它们的所有边都将具有 0 或无穷大的斜率。

我试图实现[这个](https://stackoverflow.com/questions/115426)问题中提到的内容，但我运气不佳。

我当前的实现执行以下操作：

```
// Gets all the vertices for Rectangle 1 and stores them in an array -> arrRect1
// point 1 x: arrRect1[0], point 1 y: arrRect1[1] and so on...
// Gets all the vertices for Rectangle 2 and stores them in an array -> arrRect2

// rotated edge of point a, rect 1
int rot_x, rot_y;
rot_x = -arrRect1[3];
rot_y = arrRect1[2];
// point on rotated edge
int pnt_x, pnt_y;
pnt_x = arrRect1[2]; 
pnt_y = arrRect1[3];
// test point, a from rect 2
int tst_x, tst_y;
tst_x = arrRect2[0];
tst_y = arrRect2[1];

int value;
value = (rot_x * (tst_x - pnt_x)) + (rot_y * (tst_y - pnt_y));
cout << "Value: " << value; 
```

但是我不太确定（a）我是否已经正确实现了我链接到的算法，或者我是否确实做了如何解释这个？

有什么建议么？

* * *

## 回答 #1

> 赞同：778
> 
> 时间：2008-11-20T18:25:30.603

```
if (RectA.Left < RectB.Right && RectA.Right > RectB.Left &&
     RectA.Top > RectB.Bottom && RectA.Bottom < RectB.Top ) 
```

或者，使用笛卡尔坐标

（X1是左坐标，X2是右坐标，从左到右**增加**，Y1是上坐标，Y2是下坐标，**从下到上增加**——如果这不是你的坐标系[例如，大多数计算机有Y方向反转]，**交换下面的比较**）...

```
if (RectA.X1 < RectB.X2 && RectA.X2 > RectB.X1 &&
    RectA.Y1 > RectB.Y2 && RectA.Y2 < RectB.Y1) 
```

假设你有 Rect A 和 Rect B。证明是矛盾的。四个条件中的任何一个都保证**不存在重叠**：

*   条件 1。如果 A 的左边缘在 B 的右边缘的右侧，则 - 则 A 完全在 B 的右侧
*   条件 2。如果 A 的右边缘在 B 的左边缘的左侧， - 那么 A 完全在 B 的左侧
*   条件 3。如果 A 的上边缘低于 B 的下边缘，则 - 则 A 完全低于 B
*   条件 4。如果 A 的底边高于 B 的顶边， - 那么 A 完全高于 B

所以非重叠的条件是

```
非重叠 => Cond1 或 Cond2 或 Cond3 或 Cond4
```

因此，重叠的充分条件是相反的。

```
重叠 => 非（Cond1 或 Cond2 或 Cond3 或 Cond4）
```

德摩根定律说
`Not (A or B or C or D)`与`Not A And Not B And Not C And Not D`
使用德摩根相同，我们有

```
非 Cond1 且非 Cond2 且非 Cond3 且非 Cond4
```

这相当于：

*   A 的左边缘到 B 的右边缘的左侧，[ `RectA.Left < RectB.Right`] 和
*   A 的右边缘到 B 的左边缘的右侧，[ `RectA.Right > RectB.Left`]，以及
*   A 的顶部高于 B 的底部，[ `RectA.Top > RectB.Bottom`] 和
*   A 的底部低于 B 的顶部 [ `RectA.Bottom < RectB.Top`]

**注 1**：很明显，同样的原理可以扩展到任意数量的维度。
**注意2**：计算一个像素的重叠也应该是相当明显的，将该边界上的`<`和/或更改为a或a 。**注意 3**：当使用笛卡尔坐标 (X, Y) 时，此答案基于标准代数笛卡尔坐标（x 从左到右增加，Y 从下到上增加）。显然，如果计算机系统可能以不同的方式机械化屏幕坐标（例如，从上到下增加 Y，或从右到左增加 X），则需要相应地调整语法/`>``<=``>=`

 *** * *

## 回答 #2

> 赞同：126
> 
> 时间：2008-11-20T18:36:20.627

```
struct rect
{
    int x;
    int y;
    int width;
    int height;
};

bool valueInRange(int value, int min, int max)
{ return (value >= min) && (value <= max); }

bool rectOverlap(rect A, rect B)
{
    bool xOverlap = valueInRange(A.x, B.x, B.x + B.width) ||
                    valueInRange(B.x, A.x, A.x + A.width);

    bool yOverlap = valueInRange(A.y, B.y, B.y + B.height) ||
                    valueInRange(B.y, A.y, A.y + A.height);

    return xOverlap && yOverlap;
}
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-11-20T18:53:28.190

```
struct Rect
{
    Rect(int x1, int x2, int y1, int y2)
    : x1(x1), x2(x2), y1(y1), y2(y2)
    {
        assert(x1 < x2);
        assert(y1 < y2);
    }

    int x1, x2, y1, y2;
};

bool
overlap(const Rect &r1, const Rect &r2)
{
    // The rectangles don't overlap if
    // one rectangle's minimum in some dimension 
    // is greater than the other's maximum in
    // that dimension.

    bool noOverlap = r1.x1 > r2.x2 ||
                     r2.x1 > r1.x2 ||
                     r1.y1 > r2.y2 ||
                     r2.y1 > r1.y2;

    return !noOverlap;
} 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2010-11-04T15:51:55.987

检查一个矩形是否完全在另一个矩形之外更容易，所以如果它是

在左侧...

```
(r1.x + r1.width < r2.x) 
```

或者在右边...

```
(r1.x > r2.x + r2.width) 
```

或在顶部...

```
(r1.y + r1.height < r2.y) 
```

或在底部...

```
(r1.y > r2.y + r2.height) 
```

第二个矩形，它不可能与它发生碰撞。因此，要拥有一个返回布尔值的函数，表示矩形碰撞的天气，我们只需通过逻辑 OR 组合条件并否定结果：

```
function checkOverlap(r1, r2) : Boolean
{ 
    return !(r1.x + r1.width < r2.x || r1.y + r1.height < r2.y || r1.x > r2.x + r2.width || r1.y > r2.y + r2.height);
} 
```

要仅在触摸时已经收到阳性结果，我们可以将“<”和“>”更改为“<=”和“>=”。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2020-07-11T17:56:52.977

如果两个矩形重叠，这是使用 C++ 检查的一种非常快速的方法：

```
return std::max(rectA.left, rectB.left) < std::min(rectA.right, rectB.right)
    && std::max(rectA.top, rectB.top) < std::min(rectA.bottom, rectB.bottom); 
```

它的工作原理是计算相交矩形的左右边界，然后比较它们：如果右边界等于或小于左边界，则表示交点为空，因此矩形不重叠；否则，它会再次尝试使用顶部和底部边框。

与传统的 4 次比较替代方法相比，这种方法有什么优势？这是关于现代处理器的设计方式。他们有一种叫做分支预测的东西，当比较的结果总是相同的时候效果很好，但否则会有巨大的性能损失。但是，在没有分支指令的情况下，CPU 的性能相当不错。通过计算交叉点的边界而不是对每个轴进行两次单独的检查，我们节省了两个分支，每对一个。

如果第一次比较很可能是错误的，那么四种比较方法可能会优于这种方法。不过，这种情况非常少见，因为这意味着第二个矩形通常位于第一个矩形的左侧，而不是右侧或重叠。大多数情况下，您需要检查第一个矩形两侧的矩形，这通常会抵消分支预测的优势。

这种方法可以进一步改进，具体取决于矩形的预期分布：

*   如果您希望选中的矩形主要位于彼此的左侧或右侧，则上述方法效果最佳。例如，当您使用矩形交集来检查游戏的碰撞时，可能就是这种情况，其中游戏对象主要水平分布（例如，类似于 SuperMarioBros 的游戏）。
*   如果您希望检查的矩形主要位于彼此的顶部或底部，例如在冰塔类型的游戏中，那么先检查顶部/底部和最后检查左/右可能会更快：

```
return std::max(rectA.top, rectB.top) < std::min(rectA.bottom, rectB.bottom)
    && std::max(rectA.left, rectB.left) < std::min(rectA.right, rectB.right); 
```

*   但是，如果相交的概率接近于不相交的概率，最好有一个完全无分支的替代方案：

```
return std::max(rectA.left, rectB.left) < std::min(rectA.right, rectB.right)
     & std::max(rectA.top, rectB.top) < std::min(rectA.bottom, rectB.bottom); 
```

（注意更改为`&&`single `&`）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-20T18:47:47.500

问自己一个相反的问题：我如何确定两个矩形是否根本不相交？显然，完全在矩形 B 左侧的矩形 A 不相交。此外，如果 A 完全在右侧。同样，如果 A 完全高于 B 或完全低于 B。在任何其他情况下，A 和 B 相交。

以下可能有错误，但我对算法非常有信心：

```
struct Rectangle { int x; int y; int width; int height; };

bool is_left_of(Rectangle const & a, Rectangle const & b) {
   if (a.x + a.width <= b.x) return true;
   return false;
}
bool is_right_of(Rectangle const & a, Rectangle const & b) {
   return is_left_of(b, a);
}

bool not_intersect( Rectangle const & a, Rectangle const & b) {
   if (is_left_of(a, b)) return true;
   if (is_right_of(a, b)) return true;
   // Do the same for top/bottom...
 }

bool intersect(Rectangle const & a, Rectangle const & b) {
  return !not_intersect(a, b);
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-12-23T16:38:06.017

假设您已经定义了矩形的位置和大小，如下所示：

![在此处输入图像描述](https://i.stack.imgur.com/XRSWq.png)

我的 C++ 实现是这样的：

```
class Vector2D
{
    public:
        Vector2D(int x, int y) : x(x), y(y) {}
        ~Vector2D(){}
        int x, y;
};

bool DoRectanglesOverlap(   const Vector2D & Pos1,
                            const Vector2D & Size1,
                            const Vector2D & Pos2,
                            const Vector2D & Size2)
{
    if ((Pos1.x < Pos2.x + Size2.x) &&
        (Pos1.y < Pos2.y + Size2.y) &&
        (Pos2.x < Pos1.x + Size1.x) &&
        (Pos2.y < Pos1.y + Size1.y))
    {
        return true;
    }
    return false;
} 
```

根据上图的示例函数调用：

```
DoRectanglesOverlap(Vector2D(3, 7),
                    Vector2D(8, 5),
                    Vector2D(6, 4),
                    Vector2D(9, 4)); 
```

块内的比较`if`如下所示：

```
if ((Pos1.x < Pos2.x + Size2.x) &&
    (Pos1.y < Pos2.y + Size2.y) &&
    (Pos2.x < Pos1.x + Size1.x) &&
    (Pos2.y < Pos1.y + Size1.y))
                 ↓  
if ((   3   <    6   +   9    ) &&
    (   7   <    4   +   4    ) &&
    (   6   <    3   +   8    ) &&
    (   4   <    7   +   5    )) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-20T19:01:12.217

在问题中，您链接到矩形何时处于任意旋转角度的数学。但是，如果我了解问题中关于角度的一点，我会解释为所有矩形都相互垂直。

一般知道重叠面积公式是：

使用示例：

```
   1 2 3 4 5 6

1 +---+---+
   | |   
2 + A +---+---+
   | | 乙|
3 + + +---+---+
   | | | | |
4 +---+---+---+---+ +
               | |
5 + C +
               | |
6 +---+---+

```

1）将所有x坐标（左右）收集到一个列表中，然后对其进行排序并删除重复项

```
1 3 4 5 6
```

2）将所有y坐标（顶部和底部）收集到一个列表中，然后对其进行排序并删除重复项

```
1 2 3 4 6
```

3) 通过唯一 x 坐标之间的间隙数 * 唯一 y 坐标之间的间隙数创建一个 2D 数组。

```
4 * 4
```

4）将所有矩形绘制到这个网格中，增加它出现的每个单元格的计数：

```
   1 3 4 5 6

1 +---+
   | 1 | 0 0 0
2 +---+---+---+
   | 1 | 1 | 1 | 0
3 +---+---+---+---+
   | 1 | 1 | 2 | 1 |
4 +---+---+---+---+
     0 0 | 1 | 1 |
6 +---+---+

```

5）当你绘制矩形时，很容易拦截重叠。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-24T06:31:52.420

下面是它在 Java API 中的实现方式：

```
public boolean intersects(Rectangle r) {
    int tw = this.width;
    int th = this.height;
    int rw = r.width;
    int rh = r.height;
    if (rw <= 0 || rh <= 0 || tw <= 0 || th <= 0) {
        return false;
    }
    int tx = this.x;
    int ty = this.y;
    int rx = r.x;
    int ry = r.y;
    rw += rx;
    rh += ry;
    tw += tx;
    th += ty;
    //      overflow || intersect
    return ((rw < rx || rw > tx) &&
            (rh < ry || rh > ty) &&
            (tw < tx || tw > rx) &&
            (th < ty || th > ry));
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-20T19:31:23.810

```
struct Rect
{
   Rect(int x1, int x2, int y1, int y2)
   : x1(x1), x2(x2), y1(y1), y2(y2)
   {
       assert(x1 < x2);
       assert(y1 < y2);
   }

   int x1, x2, y1, y2;
};

//some area of the r1 overlaps r2
bool overlap(const Rect &r1, const Rect &r2)
{
    return r1.x1 < r2.x2 && r2.x1 < r1.x2 &&
           r1.y1 < r2.y2 && r2.x1 < r1.y2;
}

//either the rectangles overlap or the edges touch
bool touch(const Rect &r1, const Rect &r2)
{
    return r1.x1 <= r2.x2 && r2.x1 <= r1.x2 &&
           r1.y1 <= r2.y2 && r2.x1 <= r1.y2;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-20T19:33:15.490

不要将坐标视为指示像素所在的位置。把它们想象成像素之间。这样，2x2 矩形的面积应该是 4，而不是 9。

```
bool bOverlap = !((A.Left >= B.Right || B.Left >= A.Right)
               && (A.Bottom >= B.Top || B.Bottom >= A.Top)); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-04-23T07:25:26.143

如果矩形重叠，则重叠区域将大于零。现在让我们找到重叠区域：

如果它们重叠，则重叠矩形的左边缘将是 ，`max(r1.x1, r2.x1)`而右边缘将是`min(r1.x2, r2.x2)`。所以重叠的长度将是`min(r1.x2, r2.x2) - max(r1.x1, r2.x1)`

所以该区域将是：

```
area = (max(r1.x1, r2.x1) - min(r1.x2, r2.x2)) * (max(r1.y1, r2.y1) - min(r1.y2, r2.y2)) 
```

如果`area = 0`那么它们不重叠。

是不是很简单？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-06-28T15:16:15.450

假设这两个矩形是矩形A和矩形B。让它们的中心是A1和B1（A1和B1的坐标很容易找到），让高度是Ha和Hb，宽度是Wa和Wb，让dx是A1 和 B1 之间的 width(x) 距离和 dy 是 A1 和 B1 之间的 height(y) 距离。

现在我们可以说我们可以说 A 和 B 重叠：当

```
if(!(dx > Wa+Wb)||!(dy > Ha+Hb)) returns true 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-05-26T11:26:08.923

最简单的方法是

```
/**
 * Check if two rectangles collide
 * x_1, y_1, width_1, and height_1 define the boundaries of the first rectangle
 * x_2, y_2, width_2, and height_2 define the boundaries of the second rectangle
 */
boolean rectangle_collision(float x_1, float y_1, float width_1, float height_1, float x_2, float y_2, float width_2, float height_2)
{
  return !(x_1 > x_2+width_2 || x_1+width_1 < x_2 || y_1 > y_2+height_2 || y_1+height_1 < y_2);
} 
```

首先请记住，在计算机中，坐标系是颠倒的。x轴与数学相同，但y轴向下增加并向上减少..如果从中心绘制矩形。如果 x1 坐标大于 x2 加上它的一半宽度。那么这就意味着走了一半他们会互相接触。并以同样的方式向下 + 其高度的一半。会碰撞..

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-20T18:46:04.650

我已经实现了一个 C# 版本，它很容易转换为 C++。

```
public bool Intersects ( Rectangle rect )
{
  float ulx = Math.Max ( x, rect.x );
  float uly = Math.Max ( y, rect.y );
  float lrx = Math.Min ( x + width, rect.x + rect.width );
  float lry = Math.Min ( y + height, rect.y + rect.height );

  return ulx <= lrx && uly <= lry;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-05-12T07:17:40.553

我有一个非常简单的解决方案

令 x1,y1 x2,y2 ,l1,b1,l2,分别为它们的坐标和长宽

考虑条件（（x2

现在，这些矩形重叠的唯一方法是，如果与 x1,y1 对角线的点位于另一个矩形内，或者类似地，与 x2,y2 对角线的点将位于另一个矩形内。这正是上述条件所暗示的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-01-16T17:30:19.997

A和B是两个矩形。C 是它们的覆盖矩形。

```
four points of A be (xAleft,yAtop),(xAleft,yAbottom),(xAright,yAtop),(xAright,yAbottom)
four points of A be (xBleft,yBtop),(xBleft,yBbottom),(xBright,yBtop),(xBright,yBbottom)

A.width = abs(xAleft-xAright);
A.height = abs(yAleft-yAright);
B.width = abs(xBleft-xBright);
B.height = abs(yBleft-yBright);

C.width = max(xAleft,xAright,xBleft,xBright)-min(xAleft,xAright,xBleft,xBright);
C.height = max(yAtop,yAbottom,yBtop,yBbottom)-min(yAtop,yAbottom,yBtop,yBbottom);

A and B does not overlap if
(C.width >= A.width + B.width )
OR
(C.height >= A.height + B.height) 
```

它会处理所有可能的情况。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-08-01T10:06:02.573

这是来自《Java 编程简介-综合版》一书的练习 3.28。代码测试两个矩形是否有齿，一个是否在另一个内部，一个是否在另一个外部。如果这些条件都不满足，则两者重叠。

**3.28（几何：两个矩形）编写一个程序，提示用户输入两个矩形的中心x、y坐标、宽度和高度，并确定第二个矩形是否在第一个内部或与第一个重叠，如图 3.9 所示。测试您的程序以涵盖所有情况。以下是示例运行：

输入 r1 的中心 x、y 坐标、宽度和高度：2.5 4 2.5 43 输入 r2 的中心 x、y 坐标、宽度和高度：1.5 5 0.5 3 r2 在 r1 内

输入 r1 的中心 x、y 坐标、宽度和高度：1 2 3 5.5 输入 r2 的中心 x、y 坐标、宽度和高度：3 4 4.5 5 r2 与 r1 重叠

输入 r1 的中心 x、y 坐标、宽度和高度：1 2 3 3 输入 r2 的中心 x、y 坐标、宽度和高度：40 45 3 2 r2 不与 r1 重叠

```
import java.util.Scanner;

public class ProgrammingEx3_28 {
public static void main(String[] args) {
    Scanner input = new Scanner(System.in);

    System.out
            .print("Enter r1's center x-, y-coordinates, width, and height:");
    double x1 = input.nextDouble();
    double y1 = input.nextDouble();
    double w1 = input.nextDouble();
    double h1 = input.nextDouble();
    w1 = w1 / 2;
    h1 = h1 / 2;
    System.out
            .print("Enter r2's center x-, y-coordinates, width, and height:");
    double x2 = input.nextDouble();
    double y2 = input.nextDouble();
    double w2 = input.nextDouble();
    double h2 = input.nextDouble();
    w2 = w2 / 2;
    h2 = h2 / 2;

    // Calculating range of r1 and r2
    double x1max = x1 + w1;
    double y1max = y1 + h1;
    double x1min = x1 - w1;
    double y1min = y1 - h1;
    double x2max = x2 + w2;
    double y2max = y2 + h2;
    double x2min = x2 - w2;
    double y2min = y2 - h2;

    if (x1max == x2max && x1min == x2min && y1max == y2max
            && y1min == y2min) {
        // Check if the two are identicle
        System.out.print("r1 and r2 are indentical");

    } else if (x1max <= x2max && x1min >= x2min && y1max <= y2max
            && y1min >= y2min) {
        // Check if r1 is in r2
        System.out.print("r1 is inside r2");
    } else if (x2max <= x1max && x2min >= x1min && y2max <= y1max
            && y2min >= y1min) {
        // Check if r2 is in r1
        System.out.print("r2 is inside r1");
    } else if (x1max < x2min || x1min > x2max || y1max < y2min
            || y2min > y1max) {
        // Check if the two overlap
        System.out.print("r2 does not overlaps r1");
    } else {
        System.out.print("r2 overlaps r1");
    }

}
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-08-07T03:29:22.090

```
bool Square::IsOverlappig(Square &other)
{
    bool result1 = other.x >= x && other.y >= y && other.x <= (x + width) && other.y <= (y + height); // other's top left falls within this area
    bool result2 = other.x >= x && other.y <= y && other.x <= (x + width) && (other.y + other.height) <= (y + height); // other's bottom left falls within this area
    bool result3 = other.x <= x && other.y >= y && (other.x + other.width) <= (x + width) && other.y <= (y + height); // other's top right falls within this area
    bool result4 = other.x <= x && other.y <= y && (other.x + other.width) >= x && (other.y + other.height) >= y; // other's bottom right falls within this area
    return result1 | result2 | result3 | result4;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-08-13T18:27:11.617

对于那些在矩形数据中使用中心点和一半大小的人，而不是典型的 x、y、w、h 或 x0、y0、x1、x1，您可以这样做：

```
#include <cmath> // for fabsf(float)

struct Rectangle
{
    float centerX, centerY, halfWidth, halfHeight;
};

bool isRectangleOverlapping(const Rectangle &a, const Rectangle &b)
{
    return (fabsf(a.centerX - b.centerX) <= (a.halfWidth + b.halfWidth)) &&
           (fabsf(a.centerY - b.centerY) <= (a.halfHeight + b.halfHeight)); 
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-03-01T17:00:48.280

```
struct point { int x, y; };

struct rect { point tl, br; }; // top left and bottom right points

// return true if rectangles overlap
bool overlap(const rect &a, const rect &b)
{
    return a.tl.x <= b.br.x && a.br.x >= b.tl.x && 
           a.tl.y >= b.br.y && a.br.y <= b.tl.y;
} 
```

# sql - ibatis.net - isqlmapper.BeforeQuery 在 1.6.1 中丢失

> ID：306325
> 
> 赞同：1
> 
> 时间：2008-11-20T18:24:12.477
> 
> 标签：sql, ibatis.net

我们正在尝试升级到**iBatis.Net DataMapper 1.6.1**（从**1.5.1**开始）。我在这一行收到一个错误：

```
( ( SqlMapDaoSession ) daoManager.GetDaoSession() ).SqlMap.BeforeQuery += new BeforeQueryDelegate ( SqlMap_BeforeQuery ); 
```

我什至在任何地方都找不到对这个`BeforeQuery`事件的引用。Google 上有 0 个匹配项！

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T01:42:19.207

我查看了 iBatis 1.5.1 源代码，在课堂上或项目中的任何地方都没有`BeforeQuery`事件。`SqlMap`您必须有一个修改版本。您的代码在`SqlMap_BeforeQuery`委托中做了什么？

# svn - SVN？VSS？为什么一个比另一个好？

> ID：306339
> 
> 赞同：17
> 
> 时间：2008-11-20T18:27:45.373
> 
> 标签：svn, version-control, visual-sourcesafe

我倾向于认为这里的大多数人认为 SVN 是镀金的好东西，而 VSS 是有史以来设计的最糟糕的程序（至少就版本控制而言）。

说了这么多，为什么呢？我使用了一些 CVS，而我目前的工作使用 VSS，从团队的角度来看，我真的无法分辨出那么大的区别。我看到的大多数差异都是外观上的。当然，我也没有尝试过任何分支/合并，但是作为一个进来的编码器，签出文件，处理这些文件并在一天结束时签入，为什么我想要 1其他？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-20T19:05:04.487

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-20T18:29:59.113

使 Visual Source Safe 的 Microsoft 不会在内部将它用于任何规模很大的项目。在我的书中，这是反对它的主要标志。将它用于大型项目，您就会明白为什么；它很慢，如果你决定让它自动合并任何东西，上帝会帮助你。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-20T18:45:50.250

VSS 不是[原子](http://en.wikipedia.org/wiki/Atomic_operation)的，因此在另一个用户的大型签入期间获取最新信息将导致文件集不完整。如果在 WAN 上工作，由于 VSS 的设计是在共享上工作，这也会变得更糟。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-20T18:30:35.600

我最后一家公司从 VSS 切换到 SVN 是因为

1.  扩张。程序员的数量翻了一番，我们不想为额外的 VSS 许可证付出代价
2.  错误。VSS 擅长维护文件的最新版本，但历史记录经常被破坏。
3.  更多的错误。检查/恢复工具毫无用处，因为当数据库变得非常大时它们开始崩溃。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-20T18:31:31.840

SVN 比 CVS/VSS 有一些重要的特性，比如原子提交、廉价副本、更高效的服务器端存储。

然而，SVN 并不是唯一的修订控制系统……有很多不同的修订控制应用程序。一种新趋势似乎是分布式修订控制，例如[Git](http://git.or.cz/)或[Mercurial](http://www.selenic.com/mercurial/wiki/)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-21T03:17:51.107

我知道选择 VSS 很容易，但重要的是要记住一些事情（暂时离开杂草！）

*   对于小型 Microsoft 开发团队，VSS 是一个非常易于实施的解决方案，其中的替代方案是无版本控制。
*   VSS 没有成本，不需要服务器（文件共享除外）。
*   最低的常见恶魔。
*   它通常确实有效，并且许多商店都在使用它。
*   我宁愿选择 VSS，也不愿让它不存在。

你不必在所有这些点上都同意我的观点，我只是在证明它确实有它的位置，并且在不同的场景中具有价值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-20T18:30:30.967

VSS 有一段非常糟糕的历史，它必须克服。更新的版本似乎更稳定，但它仍然背负着大量的负面包袱。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-20T19:18:39.590

您应该尽快从 VSS 运行。如果您过去没有遇到过问题，那么您应该得到一些。这就像俄罗斯轮盘赌的定时炸弹——你永远不知道它什么时候会爆炸。

SVN 是一个很棒的工具，非常易于设置和管理。用于备份或复制的管理工具非常好。

我会在任何时候推荐 SVN 而不是 VSS。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-21T14:44:22.203

Visual Studio 中集成的旧论点不再适用。[AnkhSVN 2.0](http://ankhsvn.net)提供了一个集成解决方案，[VisualSVN](http://www.visualsvn.com)将 TortoiseSVN 集成到 Visual Studio 中。

而[TortoiseSVN](http://tortoisesvn.net/)本身就足以让许多用户有理由切换。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-20T18:56:09.853

我在使用 Java 代码时遇到 VSS 问题。虽然是 getLatestVersion，但 VSS 无法处理 Java 中项目和包的嵌套结构。我得到了相同的 inifite 文件夹结构。SVN 在这方面相当简单。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-20T18:31:49.483

就功能而言，CVS 和 VSS 几乎是一回事。因此，它们不是比较它们中的每一个的好起点。

但是，如果您只是将 SVN 和 VSS 用作团队的咕噜声，您可能永远不会看到它们之间的区别。您确实必须开始将它们用作项目经理才能真正看到差异，例如分支，合并等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-20T18:34:01.710

从开发人员的角度来看，SVN 运行良好，但它在整个目录树中存储配置信息的方式对于系统管理员来说是令人抓狂的（尤其是那些在开发人员拒绝执行提交/重新签出过程时将其移动到另一台服务器的人）。:) 所以，这不是所有的镀金善良！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-20T18:46:00.280

我实际上认为 Perforce 是镀金的好东西。GUI 工具足够好，您可以将它们提供给设计师或艺术家，并让他们像我们开发人员一样使用源代码控制。我很确定 VSS File->Add Files 窗口早于 windows 95。使用中的文件被锁定的整个概念是荒谬的。几十年前我们不是用并发版本控制解决了这个问题吗？我经历过历史记录损坏（如果我错了，请纠正我）但 VSS 甚至不支持分支和合并。

# asp.net - ASP.NET 自定义控件

> ID：306381
> 
> 赞同：2
> 
> 时间：2008-11-20T18:38:17.100
> 
> 标签：asp.net, custom-server-controls

您如何创建自定义控件（不是 ASCX 控件），更重要的是，如何在您的项目中使用它？我不想为其创建单独的项目或将其编译为 DLL

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-20T18:43:52.390

服务器控件应编译为 DLL。没有理由害怕在您的项目中添加额外的程序集，它有助于创建良好的项目组织。

ASP.NET 服务器控件实际上是程序集中的自定义类。它们没有关联的“ascx”标记文件。

要使用 ASP.NET 服务器控件，您需要告诉 ASP.NET 在哪里寻找它的类。

首先，创建一个类库项目并将其添加到您的解决方案中，我将调用我的“CustomControls.dll”。

在那里，添加一个简单的类作为您的 webcontrol：

```
public class Hello : System.Web.UI.WebControl
{
    public override Render(HtmlTextWriter writer)
    {
        writer.Write("Hello World");
        base.Render(writer);
    }
} 
```

构建您的项目，并将其添加为对您的主 Web 项目的引用。

现在，在要使用此控件的 ASPX 页面中，您需要注册它，因此将其添加为页面指令之后 aspx 的第一行：

```
<%@ Register TagPrefix="Example" Namespace="CustomControls" Assembly = "CustomControls" %> 
```

现在，您应该可以使用一个名为 <Example:Hello> 的控件。在智能感知中出现可能需要一分钟。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T18:40:01.073

为控件创建类并构建解决方案。如果一切顺利，控件现在应该可以在工具箱上使用。

有时 VS 不会更新工具箱。如果发生这种情况，请将 Register 指令添加到页面：

```
<%@ Register Assembly="NAME_OF_THE_ASSEMBLY" Namespace="NAMESPACE_OF_THE_CUSTOM_CONTROL" TagPrefix="cc1" %> 
```

然后只需使用页面上的控件：

```
<cc1:mycustompanel id="MyCustomPanel1" runat="server"><asp:TextBox id="TextBox1" runat="server"></asp:TextBox></cc1:mycustompanel> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T18:50:05.607

如果你不想要一个*.ascx 文件，你不想要一个单独的项目，你不想要一个*.dll 文件，你认为还剩下什么？代码必须存在于某个地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T09:12:27.837

您提到您希望避免创建单独的项目。正如其他回复所表明的那样，简单地创建一个新项目来存储您的自定义控件并引用它更为常见。但是，可以使用常规语法注册在同一项目中定义的控件：

```
<%@ Register TagPrefix="Example" Namespace="CustomControls" Assembly="CustomControls" %> 
```

其中“程序集”是控件和页面所在的程序集。如果您使用的是 Web 应用程序项目，而不是网站，这会更容易。

# c# - C# 代表 - 您多久使用一次，何时使用？

> ID：306387
> 
> 赞同：3
> 
> 时间：2008-11-20T18:39:22.713
> 
> 标签：c#, delegates

代表看起来像一个如此强大的语言功能，但我还没有找到机会在愤怒中使用它们（我必须说在 DAL 中除外）。

您多久使用一次？在什么情况下您觉得它们最有用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T18:41:12.083

我大部分时间使用 C# Delegate 和 Event。

```
public delegate void MyDelegate(object sender, EventArgs e, string otherParameterIWant);
//...Inside the class
public event MyDelegate myEvent;
//...Inside a method
if (myEvent != null)
    myEvent(this, new EventArgs(), "Test for SO"); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T18:41:05.190

我将它们用于事件处理程序、回调和谓词等等。如果您使用 C++ 编程，您可以将它们视为函数指针，我认为它们的一些用途会立即显现出来。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T18:43:31.643

当您必须在样板代码中间更改一件事时，我特别喜欢代表：

```
public delegate bool ItemFilterDelegate(MyItem item);

public IEnumerable<MyItem> FilterItems(ItemFilterDelegate filter)
{
    var result = new List<MyItem>();

    foreach(MyItem item in AllItems)
    {
        if(filter(item))
            result.Add(item);
    }

    return item;
}    

public IEnumerable<MyItem> FilterByName(string name)
{
    return FilterItems(item => item.Name == name);
} 
```

它们也以这种方式与 LINQ 一起大量使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-20T18:53:35.710

Funcs 和 Actions 是代表的新“类型”，我在 Linq 和其他奇怪的情况下经常使用它们。对于 Linq，它们很好，因为我个人宁愿使用描述性名称而不是 lambda 表达式：

```
someList.Select(item => item.Name); 
```

我可以在哪里使用 Func：

```
Func<Item, String> itemName = item => item.Name;
...
someList.Select(itemName); 
```

可能会多出一行，但有时我发现自己在课堂上重复了几次特定的 lambda 表达式，所以我个人认为 Funcs 可以很好地解决这个问题。

另一种情况是，由于缺乏更好的术语，方法工厂。基本上，它是一个字典，其中包含一个 Actions 列表作为值，并说一个 Enum 作为键：

```
Dictionary<UserType, Action<User>> showControls;
showControls = new Dictionary<UserType, Action<User>>();

showControls.Add(SomeEnum.Admin, setControlsForAdmin);
showControls.Add(SomeEnum.Normal, setControlsForNormalUser);
showControls.Add(SomeEnum.Unregistered, setControlsForUnregisteredUser); 
```

然后我将方法本身写在页面的其他地方。用途是：

```
showControls[user.UserType](); 
```

或者，也许您想将方法本身传递给另一个：

```
Action<User> neededMethod;

neededMethod = showControls[user.UserType];

SomeMethod(neededMethod); 
```

我确信代表有更好的用途，但这些很有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T18:41:32.507

事件，谓词搜索，有时是内联功能......它们在大量场景中都很有用......

List.ForEach(代表...)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T18:41:40.197

好吧，在 C#3 中添加了 lambda 表达式，它们变得更容易使用，因为杂乱的部分被隐藏了。

```
myList.Sort(a=> a.LastName); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T18:40:57.453

我最常使用它们进行回调。代替回调方法的对象（使用接口），我可以将方法包装在委托中并传递它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-20T19:02:37.643

正如 Daok 所说的那样，我曾经一直使用它们来处理事件，直到我了解到您可以将内置处理程序用于大多数常见事件（至少对我所做的事情来说很常见）。现在我通常将它们用作 API 交互的回调处理程序。

# python - 如何从列表中随机选择一个项目？

> ID：306400
> 
> 赞同：2144
> 
> 时间：2008-11-20T18:42:21.817
> 
> 标签：python, list, random

假设我有以下列表：

```
foo = ['a', 'b', 'c', 'd', 'e'] 
```

从此列表中随机检索项目的最简单方法是什么？

* * *

## 回答 #1

> 赞同：3168
> 
> 时间：2008-11-20T18:46:39.470

使用[`random.choice()`](https://docs.python.org/library/random.html#random.choice)：

```
import random

foo = ['a', 'b', 'c', 'd', 'e']
print(random.choice(foo)) 
```

对于[加密安全](https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator)的随机选择（例如，从单词列表生成密码），使用[`secrets.choice()`](https://docs.python.org/library/secrets.html#secrets.choice)：

```
import secrets

foo = ['battery', 'correct', 'horse', 'staple']
print(secrets.choice(foo)) 
```

`secrets`在 Python 3.6 中是新的。在旧版本的 Python 上，您可以使用[`random.SystemRandom`](https://docs.python.org/library/random.html#random.SystemRandom)该类：

```
import random

secure_random = random.SystemRandom()
print(secure_random.choice(foo)) 
```

* * *

## 回答 #2

> 赞同：256
> 
> 时间：2015-05-27T17:07:07.017

如果您想从列表中随机选择多个项目，或者从一组中选择一个项目，我建议您`random.sample`改用。

```
import random
group_of_items = {'a', 'b', 'c', 'd', 'e'}  # a sequence or set will work here.
num_to_select = 2                           # set the number to select here.
list_of_random_items = random.sample(group_of_items, num_to_select)
first_random_item = list_of_random_items[0]
second_random_item = list_of_random_items[1] 
```

但是，如果您只是从列表中提取单个项目，则选择不那么笨拙，因为使用 sample 将具有语法`random.sample(some_list, 1)[0]`而不是`random.choice(some_list)`.

不幸的是，选择仅适用于序列的单个输出（例如列表或元组）。虽然`random.choice(tuple(some_set))`可能是从一组中获取单个项目的选项。

**编辑：使用秘密**

正如许多人指出的那样，如果您需要更安全的伪随机样本，您应该使用 secrets 模块：

```
import secrets                              # imports secure module.
secure_random = secrets.SystemRandom()      # creates a secure random object.
group_of_items = {'a', 'b', 'c', 'd', 'e'}  # a sequence or set will work here.
num_to_select = 2                           # set the number to select here.
list_of_random_items = secure_random.sample(group_of_items, num_to_select)
first_random_item = list_of_random_items[0]
second_random_item = list_of_random_items[1] 
```

**编辑：Pythonic One-Liner**

如果你想要一个更 Pythonic 的单行来选择多个项目，你可以使用 unpacking。

```
import random
first_random_item, second_random_item = random.sample({'a', 'b', 'c', 'd', 'e'}, 2) 
```

* * *

## 回答 #3

> 赞同：178
> 
> 时间：2012-09-11T15:31:16.497

如果您还需要索引，请使用[`random.randrange`](https://docs.python.org/3/library/random.html#random.randrange)

```
from random import randrange
random_index = randrange(len(foo))
print(foo[random_index]) 
```

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2016-12-05T16:52:58.020

从 Python 3.6 开始，您可以使用该[`secrets`](https://docs.python.org/3.6/library/secrets.html#module-secrets)模块，该模块优于该[`random`](https://docs.python.org/3.6/library/random.html#module-random)模块用于加密或安全用途。

要打印列表中的随机元素：

```
import secrets
foo = ['a', 'b', 'c', 'd', 'e']
print(secrets.choice(foo)) 
```

要打印随机索引：

```
print(secrets.randbelow(len(foo))) 
```

有关详细信息，请参阅[PEP 506](https://www.python.org/dev/peps/pep-0506/)。

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2013-05-13T02:47:36.817

我提出了一个脚本，用于从列表中删除随机选取的项目，直到它为空：

维护一个`set`并删除随机拾取的元素（带有`choice`），直到列表为空。

```
s=set(range(1,6))
import random

while len(s)>0:
  s.remove(random.choice(list(s)))
  print(s) 
```

三个运行给出三个不同的答案：

```
>>> 
set([1, 3, 4, 5])
set([3, 4, 5])
set([3, 4])
set([4])
set([])
>>> 
set([1, 2, 3, 5])
set([2, 3, 5])
set([2, 3])
set([2])
set([])

>>> 
set([1, 2, 3, 5])
set([1, 2, 3])
set([1, 2])
set([1])
set([]) 
```

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2017-11-29T16:40:11.270

```
foo = ['a', 'b', 'c', 'd', 'e']
number_of_samples = 1 
```

在 Python 2 中：

```
random_items = random.sample(population=foo, k=number_of_samples) 
```

在 Python 3 中：

```
random_items = random.choices(population=foo, k=number_of_samples) 
```

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2018-07-17T16:20:04.580

[NumPy](https://en.wikipedia.org/wiki/NumPy)解决方案：[`numpy.random.choice`](https://numpy.org/doc/stable/reference/random/generated/numpy.random.choice.html)

对于这个问题，它与接受的答案（`import random; random.choice()`）相同，但我添加它是因为程序员可能已经导入了 NumPy（像我一样）

[而且这两种方法之间](https://stackoverflow.com/q/43664994/2573061)也存在一些可能与您的实际用例有关的差异。

```
import numpy as np
np.random.choice(foo) # randomly selects a single item 
```

为了重现性，您可以执行以下操作：

```
np.random.seed(123)
np.random.choice(foo) # first call will always return 'c' 
```

对于**一个或多个 items**的样本，以 an 形式返回`array`，传递`size`参数：

```
np.random.choice(foo, 5)          # sample with replacement (default)
np.random.choice(foo, 5, False)   # sample without replacement 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2017-06-23T22:22:13.237

> ## 如何从列表中随机选择一个项目？
> 
> 假设我有以下列表：
> 
> ```
> foo = ['a', 'b', 'c', 'd', 'e'] 
> ```
> 
> 从此列表中随机检索项目的最简单方法是什么？

如果你想接近*真正的***随机**，那么我建议`secrets.choice`从标准库（Python 3.6 中的新功能）：

```
>>> from secrets import choice         # Python 3 only
>>> choice(list('abcde'))
'c' 
```

以上等同于我之前的建议，使用模块中的`SystemRandom`对象和方法 - 在 Python 2 早期可用：`random``choice`

```
>>> import random                      # Python 2 compatible
>>> sr = random.SystemRandom()
>>> foo = list('abcde')
>>> foo
['a', 'b', 'c', 'd', 'e'] 
```

现在：

```
>>> sr.choice(foo)
'd'
>>> sr.choice(foo)
'e'
>>> sr.choice(foo)
'a'
>>> sr.choice(foo)
'b'
>>> sr.choice(foo)
'a'
>>> sr.choice(foo)
'c'
>>> sr.choice(foo)
'c' 
```

如果您想要确定性的伪随机选择，请使用该`choice`函数（实际上是`Random`对象上的绑定方法）：

```
>>> random.choice
<bound method Random.choice of <random.Random object at 0x800c1034>> 
```

看起来是随机的，但实际上并非如此，如果我们反复重新播种，我们可以看到：

```
>>> random.seed(42); random.choice(foo), random.choice(foo), random.choice(foo)
('d', 'a', 'b')
>>> random.seed(42); random.choice(foo), random.choice(foo), random.choice(foo)
('d', 'a', 'b')
>>> random.seed(42); random.choice(foo), random.choice(foo), random.choice(foo)
('d', 'a', 'b')
>>> random.seed(42); random.choice(foo), random.choice(foo), random.choice(foo)
('d', 'a', 'b')
>>> random.seed(42); random.choice(foo), random.choice(foo), random.choice(foo)
('d', 'a', 'b') 
```

### 一条评论：

> 这与 random.choice 是否真正随机无关。如果你修复了种子，你将获得可重复的结果——这就是种子的设计目的。您也可以将种子传递给 SystemRandom。`sr = random.SystemRandom(42)`

好吧，是的，您可以向它传递一个“种子”参数，但是您会看到该[`SystemRandom`对象只是忽略了它](https://github.com/python/cpython/blob/master/Lib/random.py#L836)：

```
def seed(self, *args, **kwds):
    "Stub method.  Not used for a system random number generator."
    return None 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2012-12-23T22:06:36.427

如果您需要索引，只需使用：

```
import random
foo = ['a', 'b', 'c', 'd', 'e']
print int(random.random() * len(foo))
print foo[int(random.random() * len(foo))] 
```

*random.choice*也一样：）

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2018-10-12T15:47:25.097

## 总之，使用`random.sample`方法

该`sample`方法返回一个新列表，其中包含人口中的元素，同时保持原始人口不变。结果列表按选择顺序排列，因此所有子切片也将是有效的随机样本。

```
import random
lst = ['a', 'b', 'c', 'd', 'e']
random.seed(0)  # remove this line, if you want different results for each run
rand_lst = random.sample(lst,3)  # 3 is the number of sample you want to retrieve
print(rand_lst)

Output:['d', 'e', 'a'] 
```

这是一个运行代码 [https://onecompiler.com/python/3xem5jjvz](https://onecompiler.com/python/3xem5jjvz)

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2021-10-30T22:04:29.103

我通常使用随机模块来处理列表和随机化

```
import random
foo = ['a', 'b', 'c', 'd', 'e']
print(random.choice(foo)) 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2015-05-25T14:57:25.813

这是带有定义随机索引的变量的代码：

```
import random

foo = ['a', 'b', 'c', 'd', 'e']
randomindex = random.randint(0,len(foo)-1) 
print (foo[randomindex])
## print (randomindex) 
```

这是没有变量的代码：

```
import random

foo = ['a', 'b', 'c', 'd', 'e']
print (foo[random.randint(0,len(foo)-1)]) 
```

这是以最短和最聪明的方式执行此操作的代码：

```
import random

foo = ['a', 'b', 'c', 'd', 'e']
print(random.choice(foo)) 
```

（蟒蛇2.7）

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-08-27T21:29:03.780

# 随机项目选择：

```
import random

my_list = [1, 2, 3, 4, 5]
num_selections = 2

new_list = random.sample(my_list, num_selections) 
```

# 要保留列表的顺序，您可以执行以下操作：

```
randIndex = random.sample(range(len(my_list)), n_selections)
randIndex.sort()
new_list = [my_list[i] for i in randIndex] 
```

[https://stackoverflow.com/a/49682832/4383027](https://stackoverflow.com/a/49682832/4383027)的副本

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-05-28T06:06:10.373

你可以：

```
from random import randint

foo = ["a", "b", "c", "d", "e"]

print(foo[randint(0,4)]) 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2020-11-06T03:39:39.483

这可能已经是一个答案，但您可以使用`random.shuffle`. 例子：

```
import random
foo = ['a', 'b', 'c', 'd', 'e']
random.shuffle(foo) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-12-26T05:54:19.330

有两种方法可以做到这一点。

1.  通过随机方法

```
import random
foo = ['a', 'b', 'c', 'd', 'e']
print(random.choice(foo)) 
```

2.  通过 Secrets 方法

```
import secrets
foo = ['a', 'b', 'c', 'd', 'e']
print(secrets.choice(foo)) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-09-21T10:22:02.110

现在[推荐的`numpy`方法](https://numpy.org/doc/stable/reference/random/generated/numpy.random.choice.html)是使用显式 RNG：

```
from numpy.random import default_rng

rng = default_rng()
rng.choice(foo) 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2014-08-05T07:28:08.230

我们也可以使用 randint 来做到这一点。

```
from random import randint
l= ['a','b','c']

def get_rand_element(l):
    if l:
        return l[randint(0,len(l)-1)]
    else:
        return None

get_rand_element(l) 
```

# xml - 有效地访问对象模型中的父元素

> ID：306410
> 
> 赞同：3
> 
> 时间：2008-11-20T18:44:53.747
> 
> 标签：xml, language-agnostic, design-patterns, dom

我有以下对象模型：

```
- 书
-  第1章
--- 第 1 页
---- 图 1
---- 图 2
-  -  文本1
- - 第2页
...

```

资源在页面级别非常低。但是，我需要从资源的角度了解资源的完整路径。

一种方法是让资源了解他们的父母。

所以我的 Image 对象可以有一个“parentPage”属性，而该属性又可以有一个“parentChapter”属性。这样，我可以通过 currentImage.parentPage.parentChapter 访问完整路径。有没有更好的办法？

关于为什么我需要从资源的角度了解完整路径的几句话。我有一个可以在屏幕上行走和渲染的对象模型。渲染器从章节级别一直下降到元素/资源级别（这是渲染发生的地方）。但是要显示资源，我需要知道它们的位置（即磁盘上的实际路径），并且这些信息通常在章节级别指定。

谢谢！

-- 编辑 -- 澄清一下，这种 parent.parent 方法是最好的吗？它迫使子对象了解父母，这让我感到不舒服。耦合？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T18:58:27.340

我建议使用树结构，而您的每个类都继承自树节点。

c# 中的示例：

```
class TreeNode {
 public TreeNode Parent { get; set; }
 public List<TreeNode> Children { get; set; }
}

class Book : TreeNode {
 ... book attributes ...
}

... other classes ... 
```

其实，如果你担心耦合这个东西就问问自己是好耦合还是坏耦合？如果耦合确实增加了价值并且有合理的理由这样做，那就去做吧。如果没有，那就是浪费代码。如果您使用的是支持泛型的语言，则可以将其分离得更远一点：

```
class TreeNode<TParent, TChild>  
{
    public TParent Parent { get; set; }
    public List<TChild> Children { get; set; }
}

class Book : TreeNode<object, Chapter> { }
class Chapter : TreeNode<Book, Page> { }
class Page : TreeNode<Chapter, object> { } 
```

希望有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T22:07:22.420

无论您是使用 Zachary 的树结构还是以更特定于类型的方式使用，关于耦合的问题都存在。

如果图像的很多内容与图像在页面中的“托管”方式没有任何关系，您可能希望使用具有上下文相关方面并包含图像实例的中间类型（参考）。

只有您可以决定这是否过度，这取决于应用程序以及减少耦合和允许在其他上下文中更多地重用某些成分的重要性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T18:53:48.470

听起来您想要一个[双向链表](http://en.wikipedia.org/wiki/Doubly_linked_list#Doubly-linked_list)，甚至可能考虑使用[树结构](http://en.wikipedia.org/wiki/Tree_(data_structure))。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T18:59:29.380

您可以将对象序列化为 xml 并使用 linq to xml 来解析信息。

如果您必须使用对象的实例，另一种选择可能是查看复合模式（[参见维基百科](http://en.wikipedia.org/wiki/Composite_pattern)）

埃里克

# django - 在 Django 中使用 Contrib.Auth 生成登录和注册表单

> ID：306425
> 
> 赞同：6
> 
> 时间：2008-11-20T18:49:30.633
> 
> 标签：django, forms

我是 Django 的新手，在过去的几天里，我一直在围绕框架弹跳，我无法弄清楚如何在我的项目中正确安装 django.contrib.auth 应用程序。好吧，安装可能不是正确的词，而是为我的目的配置它。

我真正希望做的是扩展内置类以简单地创建注册和登录表单，因为我的 User 类在终端上工作得很好。

在 settings.py 中，我的 INSTALLED_APPS 中有 django.contrib.auth。我还安装了身份验证中间件和会话中间件。

我还可以在 Django.contrib.auth.views 和 Django.contrib.auth.forms 中清楚地看到注册和身份验证处理程序所在的位置。

由于我是框架的新手，我的问题似乎是在我的项目中正确包含这些文件并生成用于注册和登录的 HTML 表单。

（如，我是否需要在我的应用程序的 forms.py 中包含这些 Auth 文件？我需要为尚未为我建模的建模什么？最后，因为我可以在 Django.contrib.auth.views 中看到需要一个带有 HTML 模板的注册目录，我怎样才能让这些都正确地相互通信？）

**想通了问题。只需要遵循 Django 的 URL Conf 约定。示例：(r'^accounts/login/$', 'django.contrib.auth.views.login'),**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T19:46:20.790

James Bennet 的[django-registration](https://bitbucket.org/ubernostrum/django-registration/)是一个出色的帮助应用程序，用于常见的注册/登录模式。

# sql - 更新大表的主表和子表的主键

> ID：306433
> 
> 赞同：1
> 
> 时间：2008-11-20T18:52:59.907
> 
> 标签：sql, sql-server, oracle, migration, mysql4

我有一个相当大的数据库，其中一个主表具有一个单列 GUID（自定义 GUID 类似算法）作为主键和 8 个与此 GUID 列具有外键关系的子表。所有表都有大约 3-8 百万条记录。这些表都没有任何 BLOB/CLOB/TEXT 或任何其他花哨的数据类型，只有普通数字、varchars、日期和时间戳（每个表中大约 15-45 列）。除了主键和外键之外，没有分区或其他索引。

现在，自定义 GUID 算法已更改，尽管没有冲突，但我想迁移所有旧数据以使用使用新算法生成的 GUID。无需更改其他列。第一要务是数据完整性，性能是次要的。

我能想到的一些可能的解决方案是（你可能会注意到它们都只围绕一个想法）

1.  添加新列 ngu_id 并使用新的 gu_id 填充；禁用约束；用 ngu_id 作为 gu_id 更新子表；重命名 ngu_id->gu_id；重新启用约束
2.  从子表中读取一个主记录及其从属子记录；用新的 gu_id 插入同一张表；删除所有旧 gu_id 的记录
3.  丢弃约束；向主表添加触发器，以便更新所有子表；开始用新的新 gu_id 更新旧的 gu_id；重新启用约束
4.  向主表添加触发器，以便更新所有子表；开始用新的新 gu_id 更新旧 gu_id
5.  在所有主表和子表上创建新列 ngu_ids；在 ngu_id 列上创建外键约束；向主表添加更新触发器以将值级联到子表；将新的 gu_id 值插入 ngu_id 列；移除基于 gu_id 的旧外键约束；删除 gu_id 列并将 ngu_id 重命名为 gu_id；必要时重新创建约束；
6.  如果可用，使用`on update cascade`？

我的问题是：

1.  有没有更好的办法？（不能把我的头埋在沙子里，必须这样做）
2.  最合适的方法是什么？（我必须在 Oracle、SQL server 和 mysql4 中执行此操作，因此欢迎使用特定于供应商的 hack）
3.  这种练习的典型失败点是什么以及如何将它们最小化？

如果你到目前为止和我在一起，谢谢你，希望你能帮助:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T19:13:01.367

你的想法应该奏效。第一个可能是我会使用的方式。执行此操作时要考虑的一些注意事项和事项：
除非您有当前备份，否则请勿执行此操作。
我会将这两个值都留在主表中。这样，如果您必须从一些旧文件中找出您需要访问哪些记录，您就可以做到。在执行此操作时将数据库关闭以进行维护，并将其置于单用户模式。在执行此类操作时，您需要做的最后一件事是用户在您处于中游时尝试进行更改。当然，单用户模式下的第一个动作就是上面提到的备份。您可能应该将停机时间安排在使用量最轻的一段时间。先在开发上测试！这也应该让您了解关闭生产需要多长时间。此外，您可以尝试几种方法来查看哪种方法最快。
请务必提前与用户沟通数据库将在计划的维护时间关闭，并且他们可以期望它再次可用。确保时间没问题。当他们计划迟到以运行季度报告并且数据库不可用并且他们不知道时，这真的让人抓狂。
有相当多的记录，您可能希望批量运行子表的更新（不使用级联更新的一个原因）。这比尝试一次更新 500 万条记录要快。但是，不要尝试一次更新一条记录，否则您明年仍会在这里执行此任务。
删除所有表中 GUID 字段上的索引，并在完成后重新创建。这应该会提高更改的性能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T20:03:29.157

创建一个新表，其中包含旧的和新的 pk 值。在两列上放置唯一的约束，以确保您到目前为止没有破坏任何东西。

禁用约束。

对所有表运行更新以将旧值修改为新值。

启用 PK，然后启用 FK。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T00:14:52.833

很难说“最佳”或“最合适”的方法是什么，因为您没有描述您在解决方案中寻找什么。例如，当您迁移到新 ID 时，这些表是否需要可供查询？它们是否需要可用于并发修改？尽快完成迁移是否重要？最小化用于迁移的空间是否重要？

话虽如此，假设它们都满足您的要求，我更喜欢＃1而不是您的其他想法。

任何涉及更新子表的触发器似乎都容易出错且过于复杂，并且可能不会像＃1那样执行。

假设新 ID 永远不会与旧 ID 冲突是否安全？如果没有，基于一次更新一个 ID 的解决方案将不得不担心冲突——这会很快变得混乱。

您是否考虑过使用`CREATE TABLE AS SELECT`(CTAS) 使用新 ID 填充新表？您将制作现有表的副本，这将需要额外的空间，但它可能比更新现有表更快。想法是：(i) 使用 CTAS 创建具有新 ID 的新表来代替旧表，(ii) 在新表上创建适当的索引和约束，(iii) 删除旧表，(iv) 重命名新表旧名称的表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T01:04:06.557

实际上，这取决于您的 RDBMS。

使用 Oracle，最简单的选择是使所有外键约束“延迟”（提交时检查），在单个事务中执行更新，然后提交。

# postgresql - 调试 postgresql 触发器

> ID：306439
> 
> 赞同：41
> 
> 时间：2008-11-20T18:54:47.173
> 
> 标签：postgresql, triggers

我在 Postgresql 中有这个触发器，我不能只是开始工作（什么都不做）。为了理解，我是这样定义的：

```
CREATE TABLE documents (
    ...
    modification_time timestamp with time zone DEFAULT now()
);

CREATE FUNCTION documents_update_mod_time() RETURNS trigger
AS $$
    begin
    new.modification_time := now();
    return new;
    end
$$
    LANGUAGE plpgsql;

CREATE TRIGGER documents_modification_time
    BEFORE INSERT OR UPDATE ON documents
    FOR EACH ROW
    EXECUTE PROCEDURE documents_update_mod_time(); 
```

现在让它更有趣一点。你如何调试触发器？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-01-09T22:55:34.740

1.  在触发函数中使用以下代码，然后查看 pgAdmin3 中的“消息”选项卡或 psql 中的输出：

    ```
    RAISE NOTICE 'myplpgsqlval is currently %', myplpgsqlval;       -- either this
    RAISE EXCEPTION 'failed';  -- or that 
    ```

2.  要查看实际调用了哪些触发器、调用了多少次等，下面的语句是选择的救命稻草：

    ```
    EXPLAIN ANALYZE UPDATE table SET foo='bar'; -- shows the called triggers 
    ```

    请注意，如果您的触发器没有被调用并且您使用继承，则可能是您只在父表上定义了一个触发器，而子表不会自动继承触发器。

3.  要单步执行该功能，您可以使用 pgAdmin3 内置的调试器，在 Windows 上默认启用该调试器；您所要做的就是针对您正在调试的数据库执行**...\8.3\share\contrib\pldbgapi.sql**中的代码，重新启动 pgAdmin3，右键单击您的触发函数，点击“设置断点”，然后执行会导致触发器触发的语句，例如上面的 UPDATE 语句。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-23T19:45:48.490

原来我在上述问题中使用了继承而忘记提及它。现在对于可能遇到此问题的每个人，这里有一些调试提示：

使用以下代码调试触发器正在执行的操作：

```
RAISE NOTICE 'test';       -- either this
RAISE EXCEPTION 'failed';  -- or that 
```

要查看实际调用了哪些触发器、调用了多少次等，下面的语句是选择的救命稻草：

```
EXPLAIN ANALYZE UPDATE table SET foo='bar'; -- shows the called triggers 
```

然后是我以前不知道的一件事：**触发器仅在更新它们定义的确切表时触发。如果你使用继承，你也必须在子表上定义它们！**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T19:15:38.023

您可以在触发函数中使用“引发通知”语句来调试它。调试根本没有被调用的触发器是另一回事。

如果您在触发函数中添加“引发异常”，您还可以进行插入/更新吗？

此外，如果您的更新测试与插入测试发生在同一事务中，则 now() 将是相同的（因为每个事务仅计算一次），因此更新似乎不会做任何事情。如果是这种情况，请在单独的事务中执行它们，或者如果这是一个单元测试并且您不能这样做，请使用 clock_timestamp()。

我有一个单元测试，它依赖于事务之间的一段时间，所以在单元测试开始时我有类似的东西：

```
ALTER TABLE documents
   ALTER COLUMN modification_time SET DEFAULT clock_timestamp(); 
```

然后在触发器中，使用“set modify_time = default”。

所以通常它不会做额外的计算，但在单元测试期间，这允许我在中间插入 pg_sleep 以模拟时间流逝，并实际反映在数据中。

# html - 流畅的 CSS 布局和边框

> ID：306443
> 
> 赞同：12
> 
> 时间：2008-11-20T18:56:15.987
> 
> 标签：html, css

在设计流畅的布局时，如何在不破坏布局的情况下使用边框。

更具体地说，我有一个由五个 div 组成的 HTML 小部件。我希望五个 div 占据包含元素中的所有空间。我还想在每个周围有一个 1px 的边框。

我试过： .box { float: left; 高度：100%；宽度：100%；边框：1px 纯红色；这不起作用：将有一个额外的 10px 宽度导致盒子换行。减少宽度百分比不起作用，因为它不会占用正确的空间量，并且对于某些页面大小，仍然会换行。

管理这些元素之间交互的正确方法是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-23T15:25:28.327

见[这篇文章](http://www.quirksmode.org/css/box.html)。

基本上，在“传统”的 CSS 盒子模型中，盒子元素的宽度仅指定盒子*内容*的宽度，不包括其边框（和填充）。

在 CSS3 中，您可以切换到不同的盒子模型，如下所示：

```
box-sizing: border-box; 
```

特定于浏览器的实现是：

```
-moz-box-sizing: border-box; // for Mozilla
-webkit-box-sizing: border-box; // for WebKit
-ms-box-sizing: border-box; // for IE8 
```

这将导致框大小包括元素的边框和填充。所以你现在可以指定

```
.box { 
   box-sizing: border-box;
   -moz-box-sizing: border-box;
   -webkit-box-sizing: border-box;
   -ms-box-sizing: border-box;
   width:20%;
   border:1px solid red;
   float:left
} 
```

并让五个 div 占据包含元素的所有宽度而不换行。

请注意，旧版浏览器不支持此功能。对于这些，您必须根据此页面上的其他回复将每个盒子包装到第二个盒子中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T19:05:30.897

只放`width: 100%`最外层的div，不要放边框。如果你这样做，那么内框将填充空间（假设你没有浮动它们或任何东西），因为它们是块元素，你不必担心边框会增加总大小。

如果你真的需要五个实心单像素嵌套边框的外观，你可以这样做（希望有正确的语义名称）：

```
<div class="one">
    <div class="two">
        <div class="three">
        etc.
        </div>
    </div>
</div>

<style>
.one {
    width: 100%;
}
.two {
    border: 1px solid red;
    padding: 1px;
    background: red;
}
.three {
    border: 1px solid red;
    background: white;
}
</style> 
```

如您所见，您可以使用第二个 div 上的填充和背景颜色来伪造第二个边框（这样做甚至可以减少 div 的总数；请记住，您不能在不增加宽度的情况下填充最外面的 div ）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-07T20:57:44.823

哦，天哪，我几乎不想提这个，但是有一个非常简单的方法可以在单杠中做到这一点。除了最小宽度外，它不是“像素完美”，但肉眼无法辨别。

将容器 div 除以项目数。假设您有六个带有白色边框的导航项（这对于不被 100 整除的数字特别有用，因为它在任何情况下都不是完美的）。

将每个左浮动子 div 的总宽度设置为正确的分数（使用 % 表示左边距或右边距或填充），使它们等于 @ 100%。继续在子 div 上放置一个 1px 的边框。对于右端的最后一个 div，要么制作第二个没有边框的类，要么只使用 style='border:none'。

然后，在您的最小宽度处，慢慢降低每个子 div 的宽度，直到它们适合。

这是我的旧页面的一些代码，使用此方法用于最小宽度为 960 像素（958 像素和每边 1 像素边框）的液体页面：

```
.navitem {
width: 16.57%;
height: 35px;
float: left;
text-align: center;
font: 1em/35px arial,sans-serif;
border-right: 1px solid #eee;
margin: 0 auto 0 auto;
padding: 0;
} 
```

我认为它实际上是尽可能接近像素完美，因为你可以在最小宽度和更高的宽度下，虽然右侧的 div 可能比其他 div 宽 4 px，但你无法通过查看它来判断。（显然，如果您需要在最右边的 div 上设置右边框，这将不起作用，因为您会看到几个像素的背景。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T21:43:02.920

这会让你相当接近，但不是 100% 的方式（双关语）。要给一个元素 100% 的高度，它需要知道“什么的 100%？”。所有父元素也必须具有 100% 的高度，这包括主体。或者正如 W3C 所说：“如果包含块的高度没有明确指定（即，它取决于内容高度），并且该元素不是绝对定位的，则该值计算为 'auto'。” 如您所见，我们还需要给主体“位置：绝对；” 为了崇高的高度。此示例还将宽度分成五个相等的带有边框的列（以及一些填充和边距，只是为了好玩）：

```
<style>
body {
width: 100%;
height: 100%;
margin: 0;
position: absolute; 
/* overflow: hidden; */
}
div.section {
float: left;
width: 19.95%;
height: 100%;
}
    div.column {
    height: 100%;
    border: 1px solid blue;
    margin: 1em;
    padding: 2em;
    }
</style>

<div class="section"><div class="column">one</div></div>
<div class="section"><div class="column">two</div></div>
<div class="section"><div class="column">three</div></div>
<div class="section"><div class="column">four</div></div>
<div class="section"><div class="column">five</div></div> 
```

正如您在测试时所看到的，我们对 witdh 没有任何问题。这是因为划分宽度的“部分”没有填充、边距或边框。因此我们设置的宽度将是它们在屏幕上占据的宽度。现在，这在实践中并不严格。我实际上将宽度设置为 19.95%，而不是预期的 20%。问题是某些浏览器（一个是IE）在将百分比相加时会出现舍入误差，并且要加起来的细分越多，误差就越大。

这种方法明显失败的地方是高度。不像“width:auto;”会让div占据可用的水平空间，“height:auto;” 只会使 div 与其内容一样高。您必须指定“高度：100%；” 让 div 填充窗口的高度，但可惜的是，当添加边距、填充和边框时，div 的渲染高度变得大于视口，从而导致垂直滚动条。

在这里，我真的只能看到两个选择；要么 1) 接受 div 没有完全填充窗口高度并将它们的高度设置为 80% 或 2) 跳过底部边框并将主体设置为“溢出：隐藏;”，这将裁剪掉部分超出窗口边缘的 div。

最后，当然你也可以使用一些简单的脚本来实现你所追求的。根本不应该很复杂 - 但这是另一个标签的问题......快乐编码！

# architecture - 如何在您的域类中实现“最后 20 件事”属性？

> ID：306452
> 
> 赞同：0
> 
> 时间：2008-11-20T19:00:02.750
> 
> 标签：architecture, orm, domain-driven-design, lazy-loading

假设我需要为 StackOverflow 实现域模型。

如果我在做 ORM，我如何定义（和映射）属性来获取“最后的评论”和其他“最后”的东西？在我看来，这应该反映在域模型中。

有时我可能需要“所有评论”...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T19:16:16.663

我可能会受到我的 ORM 工具的影响，但我认为这是一个查询而不是域属性。域包含关联，存储库封装查询，例如您所描述的查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T19:24:52.340

您将查询您的存储库以获取特定用户的最后评论。就像是

```
IList<Comment> recentComments = repository.GetRecentComments(user,20); 
```

您可以在模型中执行此操作，但取决于您希望获得多少评论，我会避免它。模型不应该知道如何填充自己，这是存储库的工作；但是，如果您使用的是 NHibernate 之类的东西，它就会在那里。

```
public class User{

 public IList<Comment> Comments { get;set;}

 public IList<Comment> GetRecentComments()
 {
   // Logic
 }

} 
```

在那个实现中，你总是要加载所有评论以获得最后 20 条评论。如果只有 50 条评论，这没什么大不了的，但如果有 5,000 条评论，你就会有相当多的开销。

# error-correction - 量子计算 - 炒作还是超级？

> ID：306453
> 
> 赞同：0
> 
> 时间：2008-11-20T19:00:08.897
> 
> 标签：error-correction, quantum-computing

我最近一直在网上研究量子计算。

我们会在有生之年看到这些（曾经吗？）（例如，纠错问题对我来说似乎很棘手）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T19:23:29.190

只看一个网站的结果，我会说这不是不可能的：

[http://arstechnica.com/journals/science.ars/2008/03/28/encoding-more-than-one-bit-in-a-photon](http://arstechnica.com/journals/science.ars/2008/03/28/encoding-more-than-one-bit-in-a-photon)
[http://arstechnica.com/journals/science.ars/2008 /10/28/scalable-quantum-computing-in-the-next-5-years](http://arstechnica.com/journals/science.ars/2008/10/28/scalable-quantum-computing-in-the-next-5-years)
[http://arstechnica.com/news.ars/post/20080729-finding-lost-qubits.html](http://arstechnica.com/news.ars/post/20080729-finding-lost-qubits.html)
[http://arstechnica.com /news.ars/post/20080509-new-quantum-dot-logic-gates-a-step-towards-quantum-computers.html](http://arstechnica.com/news.ars/post/20080509-new-quantum-dot-logic-gates-a-step-towards-quantum-computers.html)
[http://arstechnica.com/news.ars/post/20080626-三维- qubits-on-the-way.html](http://arstechnica.com/news.ars/post/20080626-three-dimensional-qubits-on-the-way.html)
[http://arstechnica.com/news.ars/post/20080527-molecular-magnets-in-soap-bubbles-could-lead-to-quantum-ram.html](http://arstechnica.com/news.ars/post/20080527-molecular-magnets-in-soap-bubbles-could-lead-to-quantum-ram.html)

对于为什么它不像以前那么难的更多技术概述，有一个关于自校正量子计算机的四部分系列：http:
[//scienceblogs.com/pontiff/2008/08/selfcorrecting_quantum_compute.php](http://scienceblogs.com/pontiff/2008/08/selfcorrecting_quantum_compute.php)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T19:05:15.267

我投票：炒作。

...但希望我错了。

兰迪

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T19:10:05.803

它已经在这里了，只是到目前为止用途非常有限。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T20:10:41.217

量子计算并没有超过“想法”阶段。当然，他们可以将两个 2 位整数相乘，但需要十几名研究生一周才能准备好运行，还要一周才能验证结果。

从长远来看，它可能有很大的潜力，尽管它可能永远不够稳定，无法在高度控制的基于实验室的“超级计算机”环境之外使用。

在这一点上，我将其归类为物理学而不是计算机科学。在某种程度上，就好像查尔斯·巴贝奇拿到了迈克尔·法拉第的一篇论文，并开始思考也许，也许，有朝一日，能够使用电磁学作为计算的基础。

在过去的几年里，《科学美国人》上关于量子计算的文章相当多，其中大部分是主要研究人员自己写的： [http ://www.sciam.com](http://www.sciam.com)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T20:59:39.527

据我了解，纠错和失去相干性是量子计算中的大问题。很多聪明人都在努力解决这些问题，但我上次读到，看起来纠错要求可能是 qbit 数量的指数，这确实有损于“我们将立即解决 NP 问题” ！” 量子计算的吸引力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T19:07:15.167

量子计算是一种工具；它只是一个太原始的工具，到目前为止还没有任何有用的应用程序，但谁知道呢。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-01T23:13:10.533

很好，我可以逐字重复使用[另一个 SO 问题的答案。](https://stackoverflow.com/questions/432922/significant-new-inventions-in-computing-since-1980/5161092#5161092):)

一些答案提到量子计算机，好像它们还很遥远，但我不敢苟同。

在 1970 年代和 1980 年代模糊地提到了量子计算机的可能性（参见[Wikipedia 上的时间线](http://en.wikipedia.org/wiki/Timeline_of_quantum_computing)），但是第一台“工作”的 3 量子位 NMR 量子计算机是在 1998 年建成的。该领域仍处于起步阶段，几乎所有进展都还在理论上并仅限于学术界，但在 2007 年，名为 D-Wave Systems 的公司提出了一个工作 16 量子位的原型，并在当年晚些时候推出了 28 量子位绝热量子计算机。他们的努力是值得注意的，因为他们声称他们的技术在商业上是可行的和可扩展的。截至 2010 年，他们拥有 7 个钻机，他们当前一代的芯片有 128 个量子比特。他们似乎与谷歌合作，寻找有趣的问题来测试他们的硬件。

我推荐[这个 24 分钟的短视频](http://www.youtube.com/watch?v=56qR0iX5A4o)和关于 D-Wave 的[Wikipedia 文章](http://en.wikipedia.org/wiki/D-Wave_Systems)，以便快速浏览，在这个由 D-Wave 创始人和 CFO 撰写的[博客](http://dwave.wordpress.com/)上还有更多资源。

# python - 如何使用 GTK 获取正在运行的应用程序列表？

> ID：306456
> 
> 赞同：1
> 
> 时间：2008-11-20T19:02:27.127
> 
> 标签：python, gtk, pygtk

如何获取正在运行的应用程序的列表？我指的是屏幕底部面板中的那些。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T22:13:36.367

我相信你正在寻找的是 libwnck

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T21:12:51.920

您所指的面板是 GNOME 面板。所以这是一个 GNOME 问题，而不是 GTK 问题。

据我所知，GNOME 中没有明确定义的“多窗口应用程序”概念。面板任务列表可能是通过在窗口管理器中查询窗口列表并按其“类”属性对窗口进行分组来构建的。

还必须考虑各种窗口管理器提示，例如忽略面板和其他实用程序窗口。在您的位置，我会查看任务栏小程序的源代码。某处可能有一些涵盖现状的文档，但我确实知道它会在哪里。

# .net - 使用 LINQ 修复“字符串或二进制数据将被截断”警告的任何巧妙方法

> ID：306459
> 
> 赞同：10
> 
> 时间：2008-11-20T19:02:41.060
> 
> 标签：.net, sql-server, linq-to-sql

有没有一种聪明的方法来确定哪个字段导致使用 LINQ 的“字符串或二进制数据将被截断”。

我总是通过单步调试器手动完成它，但是使用“SubmitChanges”的批次我必须将我的代码更改为插入一行以在一批行中找到罪魁祸首。

我是否遗漏了某些东西，或者在这个时代，我真的仍然必须使用蛮力方法来找到问题。

请不要给我建议以防止将来出现此错误（除非它比“验证您的数据”更聪明）。源数据来自不同的系统，无论如何我都无法完全控制——而且我想偷懒。

PS。SQL Server 2008 是否真的告诉我字段名称。请告诉我有！我要升级！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-10-13T06:32:30.977

启动 SQL Profiler。您的应用程序中的最后一个查询应该是失败的查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T13:20:18.030

似乎他们为 .NET 3.5 的 Service Pack 1 解决了这个问题，如以下链接所述： [http ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=353232](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=353232)

可能想自己检查一下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-13T05:08:22.537

重新发布/编辑此标记为 linq .net 可能会很有用

DJ - 您从哪里获得作为建议解决方案发布的这些数据？

例外不包含此信息，因此您的帖子几乎没有用 - 除非您可以指定来源。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-11-20T19:24:20.873

假设您正在处理大量记录并且您不想（不能）事先验证数据，而您只希望 db 约束来捕获任何错误？

更改您的程序以捕获异常并将当前记录详细信息打印到日志文件或其他内容中。

```
Record # 9999
Caused "string or binary data would be truncated" error
Field1: "Data" Length: 55
Field2: 9999
etc. 
```

# c# - C#、Lotus Interop：获取消息信息

> ID：306462
> 
> 赞同：0
> 
> 时间：2008-11-20T19:03:20.963
> 
> 标签：c#, lotus-notes, interop-domino

我正在使用[Interop.Domino.dll](http://www.codeproject.com/KB/cs/lotusnoteintegrator.aspx)从 Lotus“数据库”（松散使用的术语）中检索电子邮件。我在检索某些字段时遇到了一些困难，想知道如何正确地做到这一点。我一直在使用`NotesDocument.GetFirstItem`检索主题、发件人和正文。

因此，我在这方面的问题是：

1.  如何检索回复地址？是否有“物品”列表可以到达某个地方？我找不到它。
2.  如何检索 From 和 Reply-To 地址的友好名称？
3.  当我以这种方式检索正文时，它的格式很奇怪，方括号集 ([]) 随机散布在消息正文中，并且部分文本不在我期望的位置。

相关代码：

```
string 
  ActualSubject = nDoc.GetFirstItem("Subject").Text,
  ActualFrom = nDoc.GetFirstItem("From").Text,
  ActualBody = nDoc.GetFirstItem("Body").Text; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T19:55:10.517

哈哈，明白了！

```
Object[] ni = (Object[])nDoc.Items;
string names_values = "";
for (int x = 0; x < ni.Length; x++)
{
NotesItem item = (NotesItem)ni[x];
if (!string.IsNullOrEmpty(item.Name)) names_values += x.ToString() + ": " + item.Name + "\t\t" + item.Text + "\r\n";
} 
```

这返回了索引、名称和值的列表：

```
0: Received     from example.com ([192.168.0.1])          by host.example.com (Lotus Domino Release 6.5.4 HF182)          with ESMTP id 2008111917343129-205078 ;          Wed, 19 Nov 2008 17:34:31 -0500
1: Received     from example.com ([192.168.0.2])          by host2.example.com (Lotus Domino Release 6.5.4 HF182)          with ESMTP id 2008111917343129-205078 ;          Wed, 19 Nov 2008 17:34:31 -0500
2: X_PGRTRKID       130057945714t
3: X_PGRSRC     IE
4: ReplyTo      "example" <name@email.example.com>
5: Principal        "example" <customerservice@email.example.com>
6: From         "IE130057945714t"<service@test.email.example.com>
7: SendTo       me@example.com
8: Subject      (Message subject redacted)
9: PostedDate       11/19/2008 03:34:15 PM
10: MIME_Version        1.0
11: $Mailer     SMTP DirectMail
12: $MIMETrack      Itemize by SMTP Server on xxxPT02-CORP/example(Release 6.5.4 HF182|May 31, 2005) at 11/19/2008 05:34:31 PM;Serialize by Router on xxxPT02-CORP/example(Release 6.5.4 HF182|May 31, 2005) at 11/19/2008 05:34:32 PM;Serialize complete at 11/19/2008 05:34:32 PM;MIME-CD by Router on xxxPT02-CORP/example(Release 6.5.4 HF182|May 31, 2005) at 11/19/2008 05:34:32 PM;MIME-CD complete at 11/19/2008 05:34:32 PM;Itemize by Router on camp-db-05/example(Release 7.0.2 HF76|November 03, 2006) at 11/19/2008 05:34:32 PM;MIME-CD by Notes Client on MyName/Guest/example(Release 6.5.6|March 06, 2007) at 11/20/2008 12:46:25 PM;MIME-CD complete at 11/20/2008 12:46:25 PM
13: Form        Memo
14: $UpdatedBy      ;CN=xxxPT02-CORP/O=example
15: $ExportHeadersConverted     1
16: $MessageID      <redacted@LocalDomain>
17: RouteServers        CN=xxxPT02-CORP/O=example;CN=camp-db-05/O=example
18: RouteTimes      11/19/2008 03:34:31 PM-11/19/2008 03:34:32 PM;11/19/2008 03:34:32 PM-11/19/2008 03:34:32 PM
19: $Orig       958F2E4E4B666AB585257506007C02A7
20: Categories      
21: $Revisions      
22: DeliveredDate       11/19/2008 03:34:32 PM
23: Body        []exampleexample 
```

现在，谁能告诉我为什么身体总是一团糟？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T20:10:18.067

Body 项是 NotesRichTextItem，而不是常规的 NotesItem。它们是 Lotus Notes 世界中的一种不同类型的对象（通常是许多开发人员沮丧的根源！）

我没有太多使用 COM 连接到 Domino 的经验，而且我知道您可以访问的内容有所不同，但是 Domino 设计器帮助应该为您提供大量的类信息，例如 NotesRichTextItem。

也许“GetFormattedText”方法比访问项目的 Text 属性更适合您。

这是该方法的一个示例（取自 Domino Designer 帮助）

```
Dim doc As NotesDocument
Dim rtitem As Variant
Dim plainText As String
Dim fileNum As Integer
'...set value of doc...
Set rtitem = doc.GetFirstItem( "Body" )
If ( rtitem.Type = RICHTEXT ) Then
  plainText = rtitem.GetFormattedText( False, 0 )
End If
' get a file number for the file
fileNum = Freefile
' open the file for writing
Open "c:\plane.txt" For Output As fileNum
' write the formatted text to the file
Print #fileNum, plainText
' close the file
Close #fileNum 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T13:44:22.107

它可能不起作用，具体取决于您的环境设置方式，但在 domino 中处理邮件的最简单方法是将它们保留为 MIME，并通过 NotesMIMEEntity 和 NotesMIMEHeader 获取值。这仅在邮件来自 Web 而不是本地 Notes 并且环境已设置为以 MIME 格式存储邮件时才有效。

否则，您需要将正文作为 NotesRichTextItem 访问。从该项目中，您需要获得一个 NotesRichTextNavigator，如果您需要，它将允许您在富文本结构中移动。

如果您认为结构应该相对简单，请尝试调用 NotesRichTextItem.GetFormattedText()。如果这仍然不起作用，那么您将需要通过使用示例文档并查看 NotesRichTextNavigator 的结构来了解正在发生的事情。

# sql-server-2005 - SQL Server 性能：派生表与公用表表达式 (CTE)

> ID：306463
> 
> 赞同：8
> 
> 时间：2008-11-20T19:03:44.863
> 
> 标签：sql-server-2005, performance, common-table-expression, derived-table

在派生表上使用 CTE 是否有任何性能提升？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T19:14:14.780

我经常使用 CTE，在某些情况下它确实看起来运行得更快。服务器的负载相当好，运行时间的变化非常显着，我不敢相信执行计划有那么不同，但看起来具有 CTE 的执行计划仍然表现得更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T19:14:44.530

从我所阅读的内容和我对它们的有限使用来看，不，它们只是更容易阅读并且可以参考自己。

# php - MySQL - 跳过重复的 WordPress 条目

> ID：306466
> 
> 赞同：2
> 
> 时间：2008-11-20T19:04:30.040
> 
> 标签：php, mysql, wordpress

我正在编写一个脚本来显示 10 个最近“活跃”的 WordPress 博客文章（即那些具有最新评论的文章）。问题是，该列表有很多重复项。我想清除重复项。有没有一种简单的方法可以通过更改 MySQL 查询（如 IGNORE、WHERE）或其他方式来做到这一点？这是我到目前为止所拥有的：

```
<?php

function cd_recently_active() {
    global $wpdb, $comments, $comment;
    $number = 10; //how many recently active posts to display? enter here

if ( !$comments = wp_cache_get( 'recent_comments', 'widget' ) ) {
    $comments = $wpdb->get_results("SELECT comment_date, comment_author, comment_author_url, comment_ID, comment_post_ID, comment_content FROM $wpdb->comments WHERE comment_approved = '1' ORDER BY comment_date_gmt DESC LIMIT $number");

    wp_cache_add( 'recent_comments', $comments, 'widget' );
}
?> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T19:10:43.117

查看 SELECT 语句的[DISTINCT](http://dev.mysql.com/doc/refman/5.0/en/select.html)选项。或者使用 GROUP BY 语法（查看相同的链接）。尽管它们以不同的方式工作，但这两种方法最有可能帮助您获得您想要的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T21:56:54.530

我以为我已经使用 GROUP BY 解决了这个问题，但现在我不太确定。这是代码：

```
 if ( !$comments = wp_cache_get( 'recent_comments', 'widget' ) ) {
    $comments = $wpdb->get_results("SELECT comment_post_ID, comment_author, comment_date FROM $wpdb->comments WHERE comment_approved = '1' GROUP BY comment_post_ID ORDER BY comment_date_gmt DESC LIMIT $number");
    wp_cache_add( 'recent_comments', $comments, 'widget' );
} 
```

唯一的变化是添加 GROUP BY comment_post_ID （我想要唯一的字段）。不幸的是，这“破坏”了功能；它被冻结并且不更新。

我也无法让 DISTINCT 工作。我正在跟进以解决此问题的一条评论来自[http://www.webmasterworld.com/forum88/9204.htm](http://www.webmasterworld.com/forum88/9204.htm)

特别是，ergophobe 的评论 #:1259236 说：“您遗漏了 GROUP BY。没有它，您将获得给定 topic_id b/c 的多个结果，该行将不会是不同的。事实上，**不同的不是必需的，只是 GROUP BY。** ”

还在寻找....

# sharepoint - SharePoint 列默认值 - 添加 10 个工作日

> ID：306475
> 
> 赞同：2
> 
> 时间：2008-11-20T19:05:42.597
> 
> 标签：sharepoint, moss

在 SharePoint MOSS 2007 中，我创建了一个将应用于文档库的自定义内容类型。其中一个必填字段是“收货日期”，另一个是“截止日期”。

截止日期总是从收货日期算起 10 个工作日。接收日期是收发室收到信件的时间，不一定是文件被邮寄到图书馆的时间。

从这里：http: [//msdn.microsoft.com/en-us/library/bb862071.aspx](http://msdn.microsoft.com/en-us/library/bb862071.aspx)

```
=DATE(YEAR([Incoming Date]),MONTH([Incoming Date]),DAY([Incoming Date])+10) 
```

增加10天，但我怎样才能增加10个工作日？根据我们共享点推出的治理计划，我也没有 VS.NET 的奢侈。

假设一个人负责数据输入，但我想让他们更容易。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-04-24T15:50:42.447

对于非常具体的“10 天”要求来说，这是多余的，但这应该计算从**任何 start date 开始的****任何天数的**到期日期。

 **我编写它是为了匹配 Excel 的 WORKDAY 函数的结果（考虑到计算字段中的每个函数都是 Excel 函数，它几乎应该是一个东西）。它经过了 1 到 146 天的“完成天数”、一周中的每一天以及多年的测试，没有任何不一致的迹象。除非我从 Excel 复制它时打错字，否则它应该像宣传的那样工作。唯一的缺点是它不做假期，但如果用户习惯了 SharePoint，他们无论如何也不会有期望。完全没有。任何形式的。为了任何东西。或者希望。或者他们脸上曾经负责微笑的肌肉。或者看着一个孩子的能力，除了死亡枯萎的凄凉确定性之外，还能看到任何东西。所以，如果他们的任务是在圣诞节到期，这没什么大不了的。它也比它可能需要的更草率。

```
=[Start Date]+[Days to Complete] 
+ ROUNDDOWN([Days to Complete]/5,0)*2 
+ IF(WEEKDAY([Start Date])+MOD([Days to Complete],5)>=7,2,0)
- ROUNDDOWN(WEEKDAY([Start Date])/7,0) 
+ IF(AND(MOD([Days to Complete],5)=0,WEEKDAY([Start Date])=1),-2,0)  
+ IF(AND(MOD([Days to Complete],5)=0,WEEKDAY([Start Date])=7),-2,0) 
```

第一行是……很明显。第二行增加了周末。并且接下来的 4 行针对第二行的不足进行了调整。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T15:23:52.547

首先，我应该指出，您正在努力研究该公式，这将起到同样的作用。

=[入境日期] + 10

从您发现 10 个工作日 (MF) 将始终有 2 个周末的评论中，您可以使用它

=[入境日期] + 14

但这仍然没有考虑到假期

[如果没有工作流程中的一些自定义代码，或者可能没有一些javascript 'hack'](http://www.endusersharepoint.com/?p=964)和您所在地区的假期数据库，您将无法做到这一点。

一种可能性是将您的到期日期默认为创建记录后的 10 个工作日

=今天+14

如果该期间有假期，请依靠您的用户手动更改此日期。

在我刚刚写的博客条目中对此有更多详细信息 - [SharePoint 计算列中的工作日、周末和假期](http://blog.pentalogic.net/2008/11/working-days-weekdays-holidays-sharepoint-calculated-columns/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T19:59:29.510

也许您可以通过使用工作流（可能是自定义的）来管理截止日期来解决这个限制？截止日期意味着它是一个可操作的项目，无论如何都应该分配给某人。

请注意，VS.NET 不一定是奢侈品——您可以[免费](http://www.microsoft.com/Express/)使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T22:42:47.700

我相信我已经找到了一种相当可靠的方法来计算 10 个工作日的最后期限，其中包括假期和周末。1) 计算 2 周期间是否为星期一，如果是，则仅添加 11 天（假设开始日算作 10 天期间的第 1 天）。否则，将 13 加到 10 个工作日加上两个周末（请记住，开始日期已经算作第 1 天；如果您没有将开始日期算作第 1 天，您的变量将是 12 和 14）。2) 为每个假期创建一个唯一的计算列，如果假期在该范围内，则返回值 1。3) 通过将值（周末和节假日）添加到您的开始日期来确定您的“总日期”。4) 确定您的总日期是在周六还是周日，如果是，请返回适当的天数以推迟到周一。

注意：我在这里看到的唯一挑战是假期是否将截止日期推到周末，然后将截止日期推到恰好是另一个假期的星期一。这在我的假期安排中没有发生，但它可能在你的安排中发生。此外，您每年都需要不断添加新的假期，因此需要您从头开始重新创建列数组以获得长期运行的列表。或者，您可以每年开始一个新列表。

```
C_Wknd  =IF(TEXT(WEEKDAY([Complaint Created On]),"ddd")="Mon",11,13)

C_NYDay =IF(AND([Complaint Created On]<=DATE(2009,1,1),([Complaint Created On])+C_Wknd>=DATE(2009,1,1)),"1","0")

C_MLKDay    =IF(AND([Complaint Created On]<=DATE(2009,1,19),([Complaint Created On])+C_Wknd>=DATE(2009,1,19)),"1","0")

C_MemDay    =IF(AND([Complaint Created On]<=DATE(2009,5,25),([Complaint Created On])+C_Wknd>=DATE(2009,5,25)),"1","0")

C_PresDay   =IF(AND([Complaint Created On]<=DATE(2009,2,16),([Complaint Created On])+C_Wknd>=DATE(2009,2,16)),"1","0")

C_IndDay    =IF(AND([Complaint Created On]<=DATE(2009,7,4),([Complaint Created On])+C_Wknd>=DATE(2009,7,4)),"1","0")

C_LabDay    =IF(AND([Complaint Created On]<=DATE(2009,9,7),([Complaint Created On])+C_Wknd>=DATE(2009,9,7)),"1","0")

C_ColDay    =IF(AND([Complaint Created On]<=DATE(2009,10,12),([Complaint Created On])+C_Wknd>=DATE(2009,10,12)),"1","0")

C_VetDay    =IF(AND([Complaint Created On]<=DATE(2009,11,11),([Complaint Created On])+C_Wknd>=DATE(2009,11,11)),"1","0")

C_ThxDay    =IF(AND([Complaint Created On]<=DATE(2009,11,26),([Complaint Created On])+C_Wknd>=DATE(2009,11,26)),"1","0")

C_XmsDay    =IF(AND([Complaint Created On]<=DATE(2009,12,25),([Complaint Created On])+C_Wknd>=DATE(2009,12,25)),"1","0")

C_GrossDte  =[Complaint Created On]+C_Wknd+C_NYDay+C_MLKDay+C_MemDay+C_PresDay+C_IndDay+C_LabDay+C_ColDay+C_VetDay+C_ThxDay+C_XmsDay

C_EndSat    =IF(TEXT(WEEKDAY(C_GrossDte),"ddd")="Sat",2,0)

C_EndSun    =IF(TEXT(WEEKDAY(C_GrossDte),"ddd")="Sun",1,0)

Resolution Due  =C_GrossDte+C_EndSat+C_EndSun 
```

# c++ - 静态库中的 MFC CSocket

> ID：306477
> 
> 赞同：1
> 
> 时间：2008-11-20T19:06:14.437
> 
> 标签：c++, mfc

我正在使用 MFC 类`CSocket`。没什么复杂的——打开与服务器的连接并发送一条短消息。当我在 DLL 中与 MFC 链接时，代码工作正常。但是，当我在静态库中链接到 MFC 时，调用会`CSocket::Create()`崩溃。

我想在静态库中使用 MFC，因为它简化了分发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-01-11T12:32:03.700

根据[http://support.microsoft.com/kb/193101](http://support.microsoft.com/kb/193101)

需要为每个线程创建套接字使用的句柄映射。以下代码显示了执行此操作的函数：

```
 void SocketThreadInit()
   {
   #ifndef _AFXDLL
   #define _AFX_SOCK_THREAD_STATE AFX_MODULE_THREAD_STATE
   #define _afxSockThreadState AfxGetModuleThreadState()

      _AFX_SOCK_THREAD_STATE* pState = _afxSockThreadState;
      if (pState->m_pmapSocketHandle == NULL)
         pState->m_pmapSocketHandle = new CMapPtrToPtr;
      if (pState->m_pmapDeadSockets == NULL)
         pState->m_pmapDeadSockets = new CMapPtrToPtr;
      if (pState->m_plistSocketNotifications == NULL)
         pState->m_plistSocketNotifications = new CPtrList;

   #endif
   } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T19:29:04.407

您是否收到任何链接器警告？确保根据“代码生成”设置链接正确的 CRT 库。对于多线程静态，您需要 libcmt.lib 用于发布（libcmtd.lib 用于调试），还要确保 _AFXDLL 未定义。

# windows - 在 Windows XP 命令提示符下循环目录

> ID：306482
> 
> 赞同：1
> 
> 时间：2008-11-20T19:07:15.167
> 
> 标签：windows, command-line

我有以下命令，它将遍历特定位置的所有子目录并输出完整路径：

```
for /d %i in ("E:\Test\*") do echo %i 
```

会给我：

```
E:\Test\One
E:\Test\Two 
```

但是我如何获得完整路径和目录名称，所以 do 命令可能类似于：

```
echo %i - %j 
```

输出可能类似于：

```
E:\Test\One - One
E:\Test\Two - Two 
```

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T19:14:51.800

以下命令语法可用于仅返回完整路径或目录名称：

```
%~fI        - expands %I to a fully qualified path name
%~nI        - expands %I to a file name only 
```

使用您的示例，以下命令将以您指定的格式列出目录：

```
for /d %i in ("E:\Test*") do echo %~fi - %~ni 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T19:18:01.090

您可以使用“%~ni”。这是一个增强的替换，它将返回路径的文件名（或者，更准确地说，最后一部分，在您的情况下是目录名）：

```
for /d %i in ("E:\Test\*") do echo %i - %~ni 
```

另请参阅此问题：[Windows 批处理文件中的 %~d0 是什么意思？](https://stackoverflow.com/questions/112055/what-does-d0-mean-in-a-windows-batch-file)

# asp.net - 使用 ASP.NET 查找 COM DLL 的文件版本

> ID：306488
> 
> 赞同：0
> 
> 时间：2008-11-20T19:09:53.383
> 
> 标签：asp.net, com

我有一个软件诊断页面，我想在上面列出几个 COM DLL 的文件版本信息。该页面在正常的、受限制的 ASP.Net 帐户 (NETWORK SERVICE) 下运行。

给定 COM 库的 ProgID，获取物理文件路径或以其他方式访问文件版本的最佳方法是什么？

请注意，通过 Type.GetTypeFromProgID 加载它并使用该类型的 Assembly 对象将不起作用，因为返回的 Assembly 对象是 mscorlib 的对象。

安装路径可由用户选择，不保证为特定值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:49:37.940

解决此问题的一种方法是使用 COM 函数[CLSIDFromProgID](http://msdn.microsoft.com/en-gb/library/ms688386(VS.85).aspx)（Pinvoke.Net 显示如何从 .Net[此处](http://pinvoke.net/default.aspx/ole32/CLSIDFromProgID.html)调用此函数）来获取 CLSID，使用 GUID.ToString("B") 将 CLSID 转换为适当格式的字符串然后使用它在注册表中查找COM服务器的注册位置。

`HKEY_CLASSES_ROOT\CLSID\<YourCLSID>\InprocServer32`如果 COM 服务器是进程内服务器（即您所期望的 DLL），则 路径将是

请注意，注册表中的文件路径不一定是完全限定路径。

# passwords - Lotus Notes、ID 文件以及新版本（8 及更高版本）中的变化

> ID：306489
> 
> 赞同：2
> 
> 时间：2008-11-20T19:09:54.460
> 
> 标签：passwords, lotus-notes, lotus-domino, identity-management

对于那些不知道的人，Lotus Notes 是一个很酷的系统，它具有非常强大的数据库复制能力，以及非常强大的证书管理和签名。

然而，强大的证书使用本身就是 Notes 的缺点之一。

当您通过 Notes 客户端登录到 Lotus Notes 时，您使用的密码不会存储在任何地方，除了作为存储在本地工作站上的 Notes ID 文件中的私钥的加密/解密密钥。

这意味着您可以拥有此文件的 15 个副本，具有 15 个不同的密码，只要您有匹配的密码，每个副本都是有效的。

对于身份管理系统，这是相当严重的，因为没有服务器端组件可以访问密码更改事件，而是完全基于客户端，服务器几乎无法告诉它发生了！

我听到的谣言是，在后来的 Lotus Notes/Domino 版本中，这种基于 ID 文件的身份验证开始发生变化。

我很难找到关于正在改变的内容、方式和版本的明确解释。（8.5？9？以后？）

这个问题的第二部分是，在 Active Directory 集成方面发生了什么？我听说有传言说可能允许AD认证而不是ID文件认证。我在这方面的猜测是，存储在服务器上的 ID 文件仍将用于授权，但成功的 Active Directory 身份验证将用于解锁对它的访问？还是其他型号？

寻找已经弄清楚这一点的人的观点！

附带说明一下，当访问 Notes 的 Webmail 时，会使用第二个密码 (httpPassword)，因为当用户进行身份验证时，服务器当然无法访问本地 ID 文件。有人假设这是他们将用于其他形式的身份验证的模型，但众所周知，假设是一个糟糕的计划！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T10:11:40.147

Notes Domino 8.5 具有新的 ID Vault 功能。它于一月初发布。

ID Vault 通过将 id 的副本安全地保存在服务器上来工作。然后它根据需要向用户提供 id。这允许用户要求服务器重置密码并且服务器在将其下载给用户之前对 id 文件进行更改的配置。

有关 ID Vault 的更多信息：

[一种管理 Notes 用户 ID 和密码的新方法 (dominoblog.com)](http://www.dominoblog.com/dominoblog/dblog.nsf/dx/a-new-way-to-manage-notes-user-ids-and-passwords)

[潜行高峰 - Domino 8.5 id vault (pmooney.net)](http://www.pmooney.net/pmooney/pmooneynet.nsf/d6plinks/PMOY-7HUEHA)

更新：8.5 已发布。

# activereports - 如何使用 ActiveReports3 将页码添加到报表中每个页面的底部？

> ID：306493
> 
> 赞同：1
> 
> 时间：2008-11-20T19:10:55.427
> 
> 标签：activereports

我试图了解您应该如何使用 ActiveReports3 将页码添加到每个页面的底部。

例如

第 1 页，共 10 页。

谢谢，

莫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T14:49:19.670

使用具有以下 FormatString 的 ReportInfo 对象

第 {PageNumber} 页，共 {PageCount} 页

您还可以使用 ReportInfo 对象通过此 FormatString 显示打印时间

打印：{RunDateTime}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T20:24:08.150

使用“ReportInfo”控件并设置“FormatString”属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T19:45:27.257

在 Data Dynamics 网站上有两个关于如何执行此操作的演练。您可以从以下页面看到两者的链接：[http](http://www.datadynamics.com/Help/ARNET3/ar3oriPageNumberingWalkthroughs.html) ://www.datadynamics.com/Help/ARNET3/ar3oriPageNumberingWalkthroughs.html 以下页面还有一个如何完全在代码中执行此操作的示例：[http:// /www.datadynamics.com/Help/ARNET3/ActiveReports3~DataDynamics.ActiveReports.ReportInfo.html](http://www.datadynamics.com/Help/ARNET3/ActiveReports3~DataDynamics.ActiveReports.ReportInfo.html)

# php - 每个 PHP 程序员都应该知道什么？

> ID：306497
> 
> 赞同：26
> 
> 时间：2008-11-20T19:12:12.663
> 
> 标签：php, mysql, frameworks

我想成为一名 PHP/MySQL 程序员

我必须知道哪些技术？

喜欢：

1.  构架
2.  IDE
3.  模板引擎
4.  Ajax 和 CSS 框架

请告诉我我必须知道的最低要求，并告诉我您在上一个列表中最喜欢的东西？

谢谢

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-20T19:29:09.320

首先，学习 PHP 和 MySQL*没有*必要知道……你什么都不知道就进去了，你就会知道一堆。如果必须知道，那么没有人能够进入 PHP 和 MySQL 开发。我个人认为，在不了解所有情况的情况下，您在这方面有一点优势。它会给你一个全新的视角和跳出框框的态度:)

至于这个线程中的面向对象的东西，这是真的。但是，正如其他人所说，完全由程序员（您）决定如何编写代码。您可以使用面向对象的实践，制作意大利面条式代码连接，或者恰到好处的一堆函数，或其他任何东西。无论哪种方式，正如其他人一直在说的那样，这取决于你:)

**IRC 频道：**

真的不需要这个，但我觉得它很有帮助......在这里见 :)

irc.freenode.net #php

**手动的：**

手册是您的朋友，可能是您在深入了解之前唯一*应该*知道的事情。

[http://www.php.net/manual/en/](http://www.php.net/manual/en/)

[http://dev.mysql.com/doc/refman/5.0/en/apis-php.html](http://dev.mysql.com/doc/refman/5.0/en/apis-php.html)

**构架：**

确保它是一个 MVC 框架:)

[http://www.cakephp.org/](http://www.cakephp.org/)

[http://www.phpmvc.net/](http://www.phpmvc.net/)

[http://www.codeigniter.com/](http://www.codeigniter.com/)

[http://www.symfony.com/](http://www.symfony.com/)

[http://www.laravel.com](http://www.laravel.com/)

[http://www.yiiframework.com/](http://www.yiiframework.com/)

**IDE：**

什么最适合你:)

[http://www.eclipse.org/](http://www.eclipse.org/)

[http://www.vim.org/](http://www.vim.org/)

[http://www.zend.com/en/products/studio/](http://www.zend.com/en/products/studio/)

[http://php.netbeans.org/](http://php.netbeans.org/)

[https://www.jetbrains.com/phpstorm/](https://www.jetbrains.com/phpstorm/)

**模板引擎：**

PHP是一个很好的模板引擎

模型视图控制器框架有助于解决这个问题

[twig.sensiolabs.org](http://twig.sensiolabs.org/)

[http://www.smarty.net/](http://www.smarty.net/)

**阿贾克斯：**

[http://jquery.com/](http://jquery.com/)

[http://www.mootools.net/](http://www.mootools.net/)

[http://developer.yahoo.com/yui/](http://developer.yahoo.com/yui/)

[http://www.prototypejs.org/](http://www.prototypejs.org/)

[http://www.extjs.com/](http://www.extjs.com/)

[http://code.google.com/webtoolkit/](http://code.google.com/webtoolkit/)

[https://angularjs.org/](https://angularjs.org/)

**CSS：**

[http://www.yaml.de/en/home.html](http://www.yaml.de/en/home.html)

[http://code.google.com/p/blueprintcss/](http://code.google.com/p/blueprintcss/)

[http://developer.yahoo.com/yui/reset/](http://developer.yahoo.com/yui/reset/)

绝对不是一个详尽的清单，而且事情不断变化......但是，这是一个开始:)

玩得开心！

克雷拉德

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-20T21:38:08.687

PHP 是我的第一语言，我在 10 多年前的第一份工作中作为一名办公室初级人员工作时学习了它。以下是我的一些经验：

*   **下载 PHP 手册，打印出来，然后从第一页开始阅读。继续前进，直到你走到最后。**略读您可能不需要的部分（例如使用 KADM5 或 Hyperwave），但始终阅读介绍，以便了解 PHP 的功能（这将避免您尝试重新发明轮子）。PHP 文档彻底颠覆了我使用过的几乎所有其他语言的文档。
*   下一步; **设置 PHP。手动。**不要使用 XAMPP 或其他任何东西，*自己做*。了解您的环境是如何设置的总是有帮助的。
*   **不要一**开始就使用 IDE。了解一门语言意味着近距离接触。IDE 隐藏事物以试图帮助您 GetThingsDone 当您知道自己在做什么并了解您的目标环境时效果很好，但是当您刚开始时，它们只会妨碍您并隐藏重要的事情。
*   **也不要**一开始就为框架而烦恼。同样，他们在那里帮助您 GetThingsDone 仅当您首先知道自己在做什么时才有效。从基础开始，否则您将学习*框架*而不是 PHP。
*   **PHP 本质上是一个高级模板引擎**。不要落入过度宣传的“PHP 模板引擎”的陷阱。他们只是在做 PHP 已经做的事情，加倍工作并且运行速度是 PHP 的两倍。坚持使用内联 html/php 开始。同样，这将帮助您了解 PHP 是什么、它是如何工作的以及何时使用它。
*   与 AJAX 和 CSS 一样……它们与 PHP 无关，但与您从 PHP 生成的输出有关（以及 AJAX 获取输入）。**不要一次把太多的东西放在你的盘子里。**从普通的 PHP+HTML 开始，然后手工编写 CSS。然后，当你高兴的时候，混入一点 JavaScript。
*   你可以用*任何*语言做的最好的事情就是**学习**你将要工作的环境，因为编程在所有语言中（相对）都是相似的。它们都有循环、数据结构、输入/输出等，但它们的工作方式都略有不同。
*   **不要相信炒作。**我现在正在从 PHP 迁移到 Python，我本可以跳上 Django 的潮流去 GetThingsDone，但我知道如果遇到问题，我不知道从哪里开始解决它。所以我接受自己的建议，从头开始；阅读手册、设置测试系统、解析简单文件、获取输入/输出、将其与 Web 服务器链接……所有这些都是了解我的新环境的一部分。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-11-20T20:09:41.050

安全性是每个 Web 程序员在被允许发布可在 Internet 上公开访问的代码之前应该研究的一个重要主题。

安全问题示例：

*   [注入缺陷](http://www.owasp.org/index.php/Top_10_2007-A2)
*   [跨站脚本缺陷](http://www.owasp.org/index.php/Top_10_2007-A1)
*   [跨站请求伪造](http://www.owasp.org/index.php/Top_10_2007-A5)

在编写 PHP 应用程序时，您应该了解并牢记更多安全问题。网站[http://www.owasp.org](http://www.owasp.org)包含许多有用的[信息](http://www.owasp.org/index.php/Top_10_2007)以提供帮助。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-20T20:04:06.160

> 每个 PHP 程序员都应该知道什么？

您需要了解一种不是 PHP 的语言。我并不是说你不应该用 PHP 来开发你的网站，它实际上真的很好，但你真的需要至少了解一种其他语言才能获得一些观点。

为什么？PHP 已损坏，充满了糟糕的设计和错误功能。您可以用 PHP 编写出色的代码，但如果您不了解更多，您将永远无法发现 PHP 本身的糟糕设计和故障。

我建议使用 python、ruby 或 C#

PS：如果您认为这不是一个有用的建议，那么请务必降低此答案，但如果您因为我声称 PHP 已损坏且设计不佳而感到侮辱而正在降低，请不要射击信使，我'我只是说实话！

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-11-20T19:14:35.870

首先，PHP 本身就是一个模板系统

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-11-20T19:31:25.743

安全。

就像 Lucas Oman 所说的那样——用 PHP 写好代码取决于你；它不会溺爱你。如果您不明白为什么需要确认注销，或者为什么不能只在 javascript 中验证，或者为什么 register_globals 不好 - 您的应用程序将以某种形式存在漏洞。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-20T19:22:53.593

您需要学习以下内容（我建议按此顺序）：

1.  **面向对象的基本**原理（如继承、多态、封装）
2.  PHP 语言本身。具体来说，PHP 5。
3.  数据库设计原则，如表、键、关系、规范化等。
4.  SQL - 结构化（或标准永远无法记住）查询语言。具体学习选择、插入、更新和删除查询的基础知识。
5.  良好的设计原则和编码实践（你可以在这里找到 StackOverflow 上的帖子），例如划分表示和业务逻辑。
6.  一个框架，任何框架——这将帮助您了解更高级的面向对象设计模式的概念，并允许您遵循鼓励良好设计和编码实践的教程。
7.  面向对象的设计模式，如 MVC、数据库抽象模型等
8.  高级 SQL 和其他数据库内容，如触发器、存储过程和其他函数。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-28T05:09:30.893

忽略 mysql_* 函数。它们不仅没有提供编写安全代码的直接方法，而且如果您尝试，它们实际上会竭尽全力让它变得[痛苦和乏味。](http://php.net/mysql_real_escape_string)改用 mysqli 或 PDO（你现在没有任何借口了 - PHP 4 几个月前就已经停产了）。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-12-22T04:59:34.163

所有好的答案，但缺少一些重要的东西：如果你想认真进入 PHP，那么你应该知道有很多 PHP 程序员懒惰、无能、无知、被误导，不幸的是他们的代码被发布了对公众。PHP 的历史意味着它支持一些有问题的特性（不仅像 register_globals 这样的东西，还像自动初始化这样的小东西）并且人们仍然在使用它们。你不想。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-11-20T19:26:03.477

我想说最重要的是了解使用 PHP 构建页面的整个过程是如何工作的——请求来自客户端（Web 浏览器），点击 Web 服务器，传递给 PHP，然后生成响应即被送回。对此有深刻的理解将使您立足

*   为什么输出开始后不能发送标头
*   会话和 cookie 的工作原理
*   每个页面应该如何以无状态的方式构建（即交付请求所要求的任何内容，不记得上次发生了什么，或者猜测用户在做什么）
*   HTML、PHP、JavaScript 和 CSS 之间的区别，更重要的是，它们各自的主要用途以及各自的职责所在。

一旦你明白了这一点，那么你应该对编写任何应用程序都很满意。但是除非你把它记下来，否则你会开始混合一些东西，就像我以前看到的许多新秀所做的那样。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-20T20:03:25.103

必须对各处的每个值进行适当的编码。`echo $some_variable_that_seems_innocent`十有八九是邪恶的。

在 HTML/XML、预处理语句中使用`htmlspecialchars()`，或者至少`addslashes()`在构建 SQL 查询、`json_encode()`向脚本中插入值、`rawurlencode()`附加 URL 组件、`escapeshellargs()`构建 shell 命令等时使用。

如果您在作为 XHTML 文档中脚本一部分的 URL 中插入文本，则需要对数据进行 3 次编码。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-20T19:23:46.820

虽然这不是一项技术，但我认为你理解这一点非常重要，在使用 PHP 时，编写好的代码完全取决于你。PHP 能够做到这一点，但它不鼓励这样做。您对编写设计良好的代码负全部责任，如果您愿意，请遵循 OO 原则。你不会得到语言的帮助。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-20T19:19:21.617

使用一个出色的 IDE（例如 Eclipse），它可以让您调试并完成一些代码。这将为您节省一些时间。

PHP 有很多程序员并且很受欢迎 = 很多事情已经为你完成了，在编写一些代码之前，谷歌搜索总是一个好主意。

如果你从头开始，你应该使用一些框架。这将回答您关于 AJax、模板引擎的所有问题......因为它们中的大多数都带有这些包。这是一些关于如何开始选择框架的帖子：[SO 1](https://stackoverflow.com/questions/249984/php-framework-decision-analysis-paralysis#250107)，[SO2](https://stackoverflow.com/questions/133701/is-symfony-a-good-framework-to-learn)，这是[PHP](https://stackoverflow.com/questions/199023/what-php-mvc-framework-can-you-recommend#199051)框架的列表。

您可以在 Windows、Linux 或 Mac 上开发 PHP。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-28T05:52:27.217

**获取 Web 服务器设置**

要在您的计算机上本地运行 PHP 和 MySQL，您需要安装带有 php 模块的 Apache 网络服务器和 MySQL 数据库服务器。IE。LAMP 网络服务器（Linux Apache MySQL PHP）。

过去，我建议安装 Ubuntu。如今，有一些可用的解决方案可以让您在不使用 linux 的情况下一键安装网络服务器。

对于 Windows：
[http ://www.wampserver.com](http://www.wampserver.com)

对于 OSX： http: [//www.mamp.info](http://www.mamp.info)

拥有 LAMP 网络服务器后，使用[w3schools.com](http://www.w3schools.com/php/default.asp)教程开始。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-22T05:41:41.363

我会说一个基本的将是 HTML。;)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-28T06:24:48.090

1.  没有 PHP 框架专家。因为模板使系统变得非常复杂。
2.  了解业务逻辑需求并考虑利弊。希望SA为您考虑一切并不是好的程序员。
3.  没有 ajax。我处理大量数据，渲染到一个 js 文件大约 4000 k 数据是非常糟糕的。
4.  从记事本或 VI 开始
5.  在学习 php 大约 1 到 2 年之后，尝试学习其他语言，如 c# 或 c++ 来改进您的 php 应用程序。
6.  Php 是上瘾的语言，而不是其他语言。你输入它就可以了。其他语言，你输入它是编译它的挂断。7.对于复杂的应用程序，php对我来说是最好的，而不是其他语言，因为你想，你写它就行了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-20T19:16:58.050

您应该知道如何有效地使用至少一个调试器/IDE。令人惊奇的是，您可以通过单步执行代码并观察其运行来从代码中学到什么。它既使跟踪错误变得更加简单，又提高了代码的质量。我相信你永远不应该将代码提交给你没有见过执行的项目。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-20T20:11:23.510

就个人而言，我发现“[使用 PHP 和 MySQL 构建自己的数据库驱动网站](http://www.amazon.co.uk/Build-Database-Driven-Website-Using/dp/0975240218/ref=sr_1_1?ie=UTF8&s=books&qid=1227211838&sr=1-1)”一书非常有帮助。

除此之外，与我曾经使用过的任何其他语言相比，我发现使用 PHP 最难适应的一件事是它的轻松程度。我的意思是没有类型，语法和标点符号的灵活性。我个人认为这是一件好事，但我也知道它可能会鼓励非常糟糕的行为。

这是我的另一个提示：尝试使用类似 DRY 原则的东西——也就是说，你会发现自己一遍又一遍地编写相同的小（或大）代码——尽可能早地将它们变成函数在编码的过程中，以后的生活会轻松很多。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-28T04:39:00.253

请注意您在网络上找到的代码片段。通常它们在 html 中包含 sql，这是不好的做法，以及 sql 注入等安全漏洞。我见过很少使用准备好的语句，这对安全性有好处。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-11-20T20:18:17.413

**PHP 语言**

转到 PHP.net 并阅读所有文档。完成后，您将不会知道需要了解的有关 php 的所有信息，但您会知道去哪里寻找。

# c# - 维护 ASP.NET 面板状态的好方法？

> ID：306504
> 
> 赞同：1
> 
> 时间：2008-11-20T19:14:34.827
> 
> 标签：c#, panel, state

我正在 ASP.NET 中创建一个多部分 Web 表单，该表单将面板用于不同的步骤，仅使当前步骤的面板可见。在第 1 步，我有一个下拉列表，它使用 Javascript 函数通过“onchange”重新配置同一面板中的某些字段。显然，由于客户端脚本只影响 DOM，所以当我转到第 2 步然后返回第 1 步时，即使选择了相同的下拉选项，第 1 步中的字段也会恢复到原来的配置。

在步骤之间存储面板的视觉状态的好方法是什么？我考虑在页面加载时调用下拉菜单的 onchange 函数，但这似乎很笨拙。谢谢！

--

感谢您的快速回答 - 我想我会尝试使用向导，但 AJAX 解决方案听起来也很有趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T19:17:53.320

您可能会为此考虑使用 ASP.Net 向导控件 - 它会自动执行您尝试执行的许多操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T19:18:23.227

我建议你使用 MultiView 控件，这在语义上更合适。然后将这些数据存储在 ViewState 中。我写过类似的东西，它很摇滚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T19:22:14.047

我认为最好的选择是将所有状态保持在一个地方，或者根本不保持任何状态。您遇到的主要问题是将客户端状态与服务器端状态同步。

如果可能，请尝试使用 javascript 显示/隐藏您的面板，而不是回发。如果没有，请使用一些 ajax 来更新服务器端的值，而不是单击下一个/上一个按钮时。

否则，您可以使用[ASP.Net Ajax Toolkit Tabs 之](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Tabs/Tabs.aspx)类的工具来帮助进行转换。

希望有帮助！

# ruby-on-rails - 应该为 Ruby on Rails 中的多态关联添加哪些索引？

> ID：306517
> 
> 赞同：4
> 
> 时间：2008-11-20T19:17:06.210
> 
> 标签：ruby-on-rails, database-design

我在 Ruby on Rails 模型中有一个多态关联。在迁移中，我有：

```
create_table "offer_defs" do |t|
  t.integer "product_def_id"
  t.string  "product_def_type"
  ...
end 
```

我想为这个关联添加一个索引。我在以下选项之间犹豫不决：

```
add_index :offer_defs, [:product_def_id, :product_def_type] 
```

**或者**

```
add_index :offer_defs, :product_def_id
add_index :offer_defs, :product_def_type 
```

**或者**两者兼而有之？

优缺点都有什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:02:10.860

我会选择后一种选择。如果您需要计算特定类型的多态附件，这将有所帮助，您可能会这样做。如果您想要多列索引，我至少会交换两列的顺序（首先放置类型），因为该类型字段比 id 字段更有可能是该表上的查询参数。

注意：我假设您在这里使用 mysql，如果您使用不同的数据库，我的建议可能应该被忽略，或者至少检查一下。

# c# - 我如何将其他参数传递给 MatchEvaluator

> ID：306527
> 
> 赞同：28
> 
> 时间：2008-11-20T19:20:28.963
> 
> 标签：c#, matchevaluator

我有一些看起来像这样的代码：

```
text = reg.Replace(text, new MatchEvaluator(MatchEvalStuff)); 
```

我需要像这样传递第二个参数：

```
text = reg.Replace(text, new MatchEvaluator(MatchEvalStuff, otherData)); 
```

这可能吗，最好的方法是什么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-20T19:34:02.913

MatchEvaluator 是一个委托，因此您无法更改其签名。您可以创建一个调用带有附加参数的方法的委托。使用 lambda 表达式很容易做到这一点：

```
text = reg.Replace(text, match => MatchEvalStuff(match, otherData)); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-20T19:56:12.777

抱歉，我应该提到我使用的是 2.0，所以我无权访问 lambdas。这是我最终做的事情：

```
private string MyMethod(Match match, bool param1, int param2)
{
    //Do stuff here
}

Regex reg = new Regex(@"{regex goes here}", RegexOptions.IgnoreCase);
Content = reg.Replace(Content, new MatchEvaluator(delegate(Match match) { return MyMethod(match, false, 0); })); 
```

这样我就可以创建一个“MyMethod”方法并将我需要的任何参数传递给它（param1 和 param2 仅用于此示例，而不是我实际使用的代码）。

# arrays - 在将由 cron 调用的脚本中声明数组的正确方法是什么？

> ID：306531
> 
> 赞同：0
> 
> 时间：2008-11-20T19:22:45.840
> 
> 标签：arrays, shell, scripting, cron, ksh

我编写了一个 KornShell (ksh) 脚本，它通过以下方式设置数组：

```
set -A fruits Apple Orange Banana Strawberry 
```

但是当我试图从 cron 中运行它时，它会引发以下错误：

```
Your "cron" job on myhost
/myScript.sh

produced the following output:

myScript.sh: -A: bad option(s) 
```

我尝试了许多 crontab 语法变体，例如：

尝试1：

```
0,5,10,15,20,25,30,35,40,45,50,55 * * * * /path/to/script/myScript.sh 
```

尝试2：

```
0,5,10,15,20,25,30,35,40,45,50,55 * * * * /path/to/script/./myScript.sh 
```

尝试 3：

```
0,5,10,15,20,25,30,35,40,45,50,55 * * * * cd /path/to/script && ./myScript.sh 
```

任何解决方法将不胜感激。提前非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-11-29T09:33:01.710

`*/5 * * * * cd /path/to/script && ksh ./myScript.sh`:- 它将每 5 分钟运行一次。也在 cron 本身中定义路径变量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T21:18:08.680

是否`myScript.sh`开始

```
#!/bin/ksh 
```

（或者你的ksh的路径是什么）？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T20:08:04.420

虽然我不确定这是最好的方法，但我已经设法通过这种方式解决它：

尝试4：

```
0,5,10,15,20,25,30,35,40,45,50,55 * * * * cd /path/to/script && ksh ./myScript.sh 
```

# c++ - 如何在 C++ 中获取目录中的文件列表？

> ID：306533
> 
> 赞同：47
> 
> 时间：2008-11-20T19:23:19.113
> 
> 标签：c++, file, directory

如何获取目录中的文件列表以便处理每个文件？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-12-19T12:58:24.897

这是我使用的：

```
/* Returns a list of files in a directory (except the ones that begin with a dot) */

void GetFilesInDirectory(std::vector<string> &out, const string &directory)
{
#ifdef WINDOWS
    HANDLE dir;
    WIN32_FIND_DATA file_data;

    if ((dir = FindFirstFile((directory + "/*").c_str(), &file_data)) == INVALID_HANDLE_VALUE)
        return; /* No files found */

    do {
        const string file_name = file_data.cFileName;
        const string full_file_name = directory + "/" + file_name;
        const bool is_directory = (file_data.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) != 0;

        if (file_name[0] == '.')
            continue;

        if (is_directory)
            continue;

        out.push_back(full_file_name);
    } while (FindNextFile(dir, &file_data));

    FindClose(dir);
#else
    DIR *dir;
    class dirent *ent;
    class stat st;

    dir = opendir(directory);
    while ((ent = readdir(dir)) != NULL) {
        const string file_name = ent->d_name;
        const string full_file_name = directory + "/" + file_name;

        if (file_name[0] == '.')
            continue;

        if (stat(full_file_name.c_str(), &st) == -1)
            continue;

        const bool is_directory = (st.st_mode & S_IFDIR) != 0;

        if (is_directory)
            continue;

        out.push_back(full_file_name);
    }
    closedir(dir);
#endif
} // GetFilesInDirectory 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-11-20T19:24:45.383

但`boost::filesystem`可以这样做：http: [//www.boost.org/doc/libs/1_37_0/libs/filesystem/example/simple_ls.cpp](http://www.boost.org/doc/libs/1_37_0/libs/filesystem/example/simple_ls.cpp)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-11-20T21:30:36.550

这是 Linux 上的 C 语言示例。也就是说，如果你在 Linux 上并且不介意在 ANSI C 中做这点小事。

```
#include <dirent.h>

DIR *dpdf;
struct dirent *epdf;

dpdf = opendir("./");
if (dpdf != NULL){
   while (epdf = readdir(dpdf)){
      printf("Filename: %s",epdf->d_name);
      // std::cout << epdf->d_name << std::endl;
   }
}
closedir(dpdf); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-09-07T22:00:23.947

C++11/Linux 版本：

```
#include <dirent.h>

if (auto dir = opendir("some_dir/")) {
    while (auto f = readdir(dir)) {
        if (!f->d_name || f->d_name[0] == '.')
            continue; // Skip everything that starts with a dot

        printf("File: %s\n", f->d_name);
    }
    closedir(dir);
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-12-19T12:56:05.037

您必须使用操作系统调用（例如 Win32 API）或围绕它们的包装器。我倾向于使用[Boost.Filesystem](http://www.boost.org/doc/libs/1_41_0/libs/filesystem/doc/index.htm)，因为与 Win32 API 的混乱（以及跨平台）相比，它具有更好的接口。

如果您希望使用 Win32 API，Microsoft在 msdn 上有一个[函数](http://msdn.microsoft.com/en-us/library/aa363950%28VS.85%29.aspx)列表和[示例。](http://msdn.microsoft.com/en-us/library/bb540535%28VS.85%29.aspx)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-20T22:19:40.693

如果您在 Windows 中并使用 MSVC，则 MSDN 库有[执行此操作的示例代码。](http://msdn.microsoft.com/en-us/library/aa365200.aspx)

这是该链接中的代码：

```
#include <windows.h>
#include <tchar.h> 
#include <stdio.h>
#include <strsafe.h>

void ErrorHandler(LPTSTR lpszFunction);

int _tmain(int argc, TCHAR *argv[])
{
   WIN32_FIND_DATA ffd;
   LARGE_INTEGER filesize;
   TCHAR szDir[MAX_PATH];
   size_t length_of_arg;
   HANDLE hFind = INVALID_HANDLE_VALUE;
   DWORD dwError=0;

   // If the directory is not specified as a command-line argument,
   // print usage.

   if(argc != 2)
   {
      _tprintf(TEXT("\nUsage: %s <directory name>\n"), argv[0]);
      return (-1);
   }

   // Check that the input path plus 2 is not longer than MAX_PATH.

   StringCchLength(argv[1], MAX_PATH, &length_of_arg);

   if (length_of_arg > (MAX_PATH - 2))
   {
      _tprintf(TEXT("\nDirectory path is too long.\n"));
      return (-1);
   }

   _tprintf(TEXT("\nTarget directory is %s\n\n"), argv[1]);

   // Prepare string for use with FindFile functions.  First, copy the
   // string to a buffer, then append '\*' to the directory name.

   StringCchCopy(szDir, MAX_PATH, argv[1]);
   StringCchCat(szDir, MAX_PATH, TEXT("\\*"));

   // Find the first file in the directory.

   hFind = FindFirstFile(szDir, &ffd);

   if (INVALID_HANDLE_VALUE == hFind) 
   {
      ErrorHandler(TEXT("FindFirstFile"));
      return dwError;
   } 

   // List all the files in the directory with some info about them.

   do
   {
      if (ffd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)
      {
         _tprintf(TEXT("  %s   <DIR>\n"), ffd.cFileName);
      }
      else
      {
         filesize.LowPart = ffd.nFileSizeLow;
         filesize.HighPart = ffd.nFileSizeHigh;
         _tprintf(TEXT("  %s   %ld bytes\n"), ffd.cFileName, filesize.QuadPart);
      }
   }
   while (FindNextFile(hFind, &ffd) != 0);

   dwError = GetLastError();
   if (dwError != ERROR_NO_MORE_FILES) 
   {
      ErrorHandler(TEXT("FindFirstFile"));
   }

   FindClose(hFind);
   return dwError;
}

void ErrorHandler(LPTSTR lpszFunction) 
{ 
    // Retrieve the system error message for the last-error code

    LPVOID lpMsgBuf;
    LPVOID lpDisplayBuf;
    DWORD dw = GetLastError(); 

    FormatMessage(
        FORMAT_MESSAGE_ALLOCATE_BUFFER | 
        FORMAT_MESSAGE_FROM_SYSTEM |
        FORMAT_MESSAGE_IGNORE_INSERTS,
        NULL,
        dw,
        MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
        (LPTSTR) &lpMsgBuf,
        0, NULL );

    // Display the error message and exit the process

    lpDisplayBuf = (LPVOID)LocalAlloc(LMEM_ZEROINIT, 
        (lstrlen((LPCTSTR)lpMsgBuf)+lstrlen((LPCTSTR)lpszFunction)+40)*sizeof(TCHAR)); 
    StringCchPrintf((LPTSTR)lpDisplayBuf, 
        LocalSize(lpDisplayBuf) / sizeof(TCHAR),
        TEXT("%s failed with error %d: %s"), 
        lpszFunction, dw, lpMsgBuf); 
    MessageBox(NULL, (LPCTSTR)lpDisplayBuf, TEXT("Error"), MB_OK); 

    LocalFree(lpMsgBuf);
    LocalFree(lpDisplayBuf);
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-06-25T16:26:43.213

我刚刚问了一个类似的[问题](https://stackoverflow.com/q/31051317/4383472)，这是我根据收到的答案（使用`boost::filesystem`库）的解决方案：

```
#include <string>
#include <iostream>
#include <boost/filesystem.hpp>
using namespace std;
using namespace boost::filesystem;

int main()
{
    path p("D:/AnyFolder");
    for (auto i = directory_iterator(p); i != directory_iterator(); i++)
    {
        if (!is_directory(i->path())) //we eliminate directories in a list
        {
            cout << i->path().filename().string() << endl;
        }
        else
            continue;
    }
} 
```

输出如下：

```
file1.txt
file2.dat 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-20T19:25:43.040

解决这个问题需要一个特定于平台的解决方案。在 unix/linux 上查找 opendir() 或在 Windows 上查找 FindFirstFile()。或者，有许多库可以为您处理特定于平台的部分。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-06-19T14:53:20.583

在结合了很多片段后，我终于找到了一个可重用的 Windows 解决方案，它使用了 Visual Studio 附带的 ATL 库。

```
#include <atlstr.h>

void getFiles(CString directory) {
    HANDLE dir;
    WIN32_FIND_DATA file_data;
    CString  file_name, full_file_name;
    if ((dir = FindFirstFile((directory + "/*"), &file_data)) == INVALID_HANDLE_VALUE)
    {
        // Invalid directory
    }

    while (FindNextFile(dir, &file_data)) {
        file_name = file_data.cFileName;
        full_file_name = directory + file_name;
        if (strcmp(file_data.cFileName, ".") != 0 && strcmp(file_data.cFileName, "..") != 0)
        {
            std::string fileName = full_file_name.GetString();
            // Do stuff with fileName
        }
    }
} 
```

要访问该方法，只需调用：

```
getFiles("i:\\Folder1"); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-19T12:59:13.533

```
HANDLE WINAPI FindFirstFile(
  __in   LPCTSTR lpFileName,
  __out  LPWIN32_FIND_DATA lpFindFileData
); 
```

将属性设置为仅查找目录。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-07-02T23:41:07.850

或者你这样做，然后读出 test.txt：

```
#include <windows.h>

int main() {    
system("dir /b > test.txt");
} 
```

"/b" 表示只返回文件名，没有更多信息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-07-03T09:50:18.510

您可以使用以下代码获取目录中的所有文件。在 Andreas Bonini 答案中进行简单修改以删除“。”的出现。和 ”..”

```
CString dirpath="d:\\mydir"
DWORD errVal = ERROR_SUCCESS;
HANDLE dir;
WIN32_FIND_DATA file_data;
CString  file_name,full_file_name;
if ((dir = FindFirstFile((dirname+ "/*"), &file_data)) == INVALID_HANDLE_VALUE)
{
    errVal=ERROR_INVALID_ACCEL_HANDLE;
    return errVal;
}

while (FindNextFile(dir, &file_data)) {
    file_name = file_data.cFileName;
    full_file_name = dirname+ file_name;
    if (strcmp(file_data.cFileName, ".") != 0 && strcmp(file_data.cFileName, "..") != 0)
    {
        m_List.AddTail(full_file_name);
    }
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2014-05-06T23:28:00.610

```
void getFilesList(String filePath,String extension, vector<string> & returnFileName)
{
    WIN32_FIND_DATA fileInfo;
    HANDLE hFind;   
    String  fullPath = filePath + extension;
    hFind = FindFirstFile(fullPath.c_str(), &fileInfo);
    if (hFind == INVALID_HANDLE_VALUE){return;} 
    else {
        return FileName.push_back(filePath+fileInfo.cFileName);
        while (FindNextFile(hFind, &fileInfo) != 0){
            return FileName.push_back(filePath+fileInfo.cFileName);}
        }
 }

 String optfileName ="";        
 String inputFolderPath =""; 
 String extension = "*.jpg*";
 getFilesList(inputFolderPath,extension,filesPaths);
 vector<string>::const_iterator it = filesPaths.begin();
 while( it != filesPaths.end())
 {
    frame = imread(*it);//read file names
            //doyourwork here ( frame );
    sprintf(buf, "%s/Out/%d.jpg", optfileName.c_str(),it->c_str());
    imwrite(buf,frame);   
    it++;
 } 
```

# oop - 为对象类型选择正确的视图

> ID：306541
> 
> 赞同：3
> 
> 时间：2008-11-20T19:24:26.287
> 
> 标签：oop, inheritance, user-interface

我以前遇到过很多次这个问题，而且我从来没有一个让我感觉很好的解决方案。

假设我有一个 Transaction 基类和两个派生类 AdjustmentTransaction 和 IssueTransaction。

我在 UI 中有一个事务列表，每个事务的具体类型为 AdjustmentTransaction 或 IssueTransaction。

当我选择交易并单击“编辑”按钮时，我需要决定是显示 AdjustmentTransactionEditorForm 还是 IssueTransactionEditorForm。

问题是我如何以 OO 方式执行此操作，而不必对所选事务的类型使用 switch 语句？switch 语句有效，但感觉很笨拙。我觉得我应该能够以某种方式利用事务和事务编辑器之间的并行继承层次结构。

我可以在我的事务上拥有一个 EditorForm 属性，但这是我的 UI 花生酱与我的模型巧克力的可怕混合。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T19:34:16.393

您需要在某个时候将您的“EditorForm”映射到交易。你有几个选择：

*   一个 switch 语句......像你一样，我认为这很臭，而且扩展性很差。
*   基本 Transaction 类中的抽象“EditorForm”属性，可以更好地扩展，但关注点分离很差。
*   前端中的类型 -> 表单映射器。这可以很好地扩展，并保持良好的分离。

在 C# 中，我会像这样实现一个 Type -> Form 映射器：

```
Dictionary <Type,Type> typeMapper = new Dictionary<Type,Type>();
typeMapper.Add(typeof(AdjustTransaction), typeof(AdjustTransactionForm));
// etc, in this example, I'm populating it by hand, 
// in real life, I'd use a key/value pair mapping config file, 
// and populate it at runtime. 
```

然后，当单击编辑时：

```
Type formToGet;
if (typeMapper.TryGetValue(CurrentTransaction.GetType(), out formToGet))
{
    Form newForm = (Form)Activator.CreateInstance(formToGet);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T19:35:43.193

您可能不想将它与继承树联系起来——当您得到轻微的需求更改时，它会很好地绑定您。

该关系应在外部文件中的某处指定。描述这种关系的东西：

```
Editing AdujustmentTransaction = AdjustmentTransactionEditorForm
Editing IssueTransaction = IssueTransactionEditorForm 
```

通过一点解析和一些比我在这里使用的更好的语言，这个文件可以变得非常通用和可重用——如果需要，您可以为不同的对象重用表单，或者更改用于编辑对象的表单而不用太多努力。

（您可能希望名为“Joe”的用户改用“JoeIssueTransactionEditorForm”，这可以很容易地融入您的“语言”）

这本质上是依赖注入——您可能可以使用 Spring 以更一般的方式解决问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T19:34:46.580

我错过了问题中的某些内容吗？我只是问，因为显而易见的 OO 答案是：多态

只需执行 Transaction.editWindow() （或者您想调用它），并使用所需的功能覆盖 AdjustmentTransaction 和 IssueTrasaction 中的方法。调用 element.editWindow() 然后为您打开正确的对话框。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T20:18:11.407

字典/配置文件方法的替代方法是

1) 为每个事务编辑器定义一个接口。

2) 在您的 EXE 或 UI 程序集中，让每个表单都向创建单个事务的程序集注册。

3) 控制注册的类应该是一个单例，所以你不会有多个表单实例浮动。

3) 创建单个事务时，它会从注册对象中提取正确的表单变量，并为其分配一个内部变量。

4) 当调用 Edit 方法时，它只使用内部方法的 Show 方法来启动调用链，这将导致该事务编辑器的显示。

这消除了对配置文件和字典的需要。它继续将 UI 与对象分开。另外，您不需要任何 switch 语句

缺点是除了表单本身之外，还必须为每个表单编写界面。

如果您有大量不同类型的编辑器（数十种），那么在这种情况下，我建议您使用命令模式

您有一个包含 Jonathan 推荐的字典的主命令。该命令将依次使用该字典来执行许多其他命令之一，这些命令使用正确的对象调用正确的表单。形式继续与对象本身分开。表单驻留在命令程序集中。此外，您不必更新 EXE 来添加另一个编辑器，只需添加命令程序集。最后，通过将内容放入 Command 中，您可以更轻松地实现 Undo/Redo。（实现 Unexecute 和 Execute）

# .net - 与控件一起缩放字体

> ID：306545
> 
> 赞同：1
> 
> 时间：2008-11-20T19:25:43.477
> 
> 标签：.net, winforms

使用 WinForms，我可以使用`Control.Scale`更大的控件缩放。当我这样做时，所有子控件都会正确重新定位和缩放，但字体大小保持不变。

是否有一种简单的方法可以强制字体放大/缩小，或者是在缩放控件时手动更新所有控件的字体的唯一方法？

背景：我正在开发一个程序，我需要支持放大/缩小以使标签、文本框等对于视力不佳的用户更具可读性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T20:33:12.360

反过来做。更改字体大小，控件将自动缩放以适应较大的字体。例如：

```
 public partial class Form1 : Form {
    float mDesignSize;
    int mIncrement;
    public Form1() {
      InitializeComponent();
      mDesignSize = this.Font.SizeInPoints;
    }
    private void adjustFont() {
      float size = mDesignSize * (1 + mIncrement / 7f);
      this.Font = new Font(this.Font.FontFamily, size);
    }
    private void btnIncreaseFontSize_Click(object sender, EventArgs e) {
      mIncrement += 1;
      adjustFont();
    }
    private void btnDecreateFontSize_Click(object sender, EventArgs e) {
      mIncrement -= 1;
      adjustFont();
    }
  } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T04:16:12.407

我找不到解决方案，所以我最终手动缩放字体。

我正在使用支持主题的[Krypton Toolkit](http://www.componentfactory.com/) *强烈推荐，很棒的控件库）。我只是使用反射来查找所有字体属性并将它们放大。

# sql-server - MS SQL 2000 - 使用 xp_cmdshell 在 DTSRUN 中的参数

> ID：306547
> 
> 赞同：0
> 
> 时间：2008-11-20T19:26:58.030
> 
> 标签：sql-server, xp-cmdshell

我正在运行以下命令：master..xp_cmdshell 'dtsrun /S ricmssql02 /U admindw /P letmein /N "scott - debug"' 但也发送参数。我看到以下内容可以做到这一点： /A global_parameter_name:typeid=value 而且整个事情可以重复发送多个。我的问题是；多个的分隔符是什么？typeid 的值是什么，或者我什至需要它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T08:58:05.023

尽管没有它 DTSRUN 通常也可以工作，但 typeid 的值如下：

```
Data type Type ID
-----------------
Integer (small) 2
Integer 3
Real (4-byte) 4
Real (8-byte) 5
Currency 6
Date 7
String 8
Boolean 11
Decimal 14
Integer (1-byte) 16
Unsigned int (1-byte) 17
Unsigned int (2-byte) 18
Unsigned int (4-byte) 19
Integer (8-byte) 20
Unsigned int (8-byte) 21
Int 22
Unsigned int 23
HRESULT 25
Pointer 26
LPSTR 30
LPWSTR 31 
```

我不确定“多个分隔符”是什么意思 - 您需要为要替换的每个变量都有一个 /A 。因此，如果您想在示例中设置三个字符串变量：

```
master..xp_cmdshell 'dtsrun /S ricmssql02 /U admindw /P letmein /N "scott - debug" /A "param1:8=string 1" /A "param2:8=string 2" /A "param3:8=string 3"' 
```

# c# - 如果我只有 MIME 类型，打开/编辑数据流的最佳方式是什么

> ID：306551
> 
> 赞同：1
> 
> 时间：2008-11-20T19:28:31.117
> 
> 标签：c#, windows, mime, mime-types

我在一个 Windows 桌面应用程序中，我在数据库中有一个数据流和一个 mime 类型。有没有比将其写入临时文件夹并为其启动默认编辑器更好的方法？

如果我必须使用临时文件夹，如何从 C# Windows 桌面应用程序中的 MIME 类型获取文件扩展名？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T19:48:42.230

查找 MIME 类型`HKEY_CLASSES_ROOT\MIME\Database\Content Type`以找出相应的文件扩展名并从那里开始。一些入门链接：

*   [http://msdn.microsoft.com/en-us/library/ms775147(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms775147(VS.85).aspx)
*   [http://bitworking.org/news/Atom_Auto_Sub_How_To](http://bitworking.org/news/Atom_Auto_Sub_How_To)

如果这还不够，也许[libmagic](http://en.wikipedia.org/wiki/Libmagic)（由`file`命令行工具使用）或其数据库对您有用，即使它完全是 UNIX:y。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T19:30:02.050

这取决于您想对该数据流做什么。如果您只想打开该文件类型的默认程序，那么编写一个临时文件并在其上调用 Process.Start 并不是一个坏方法。如果您希望对数据执行其他操作......好吧，这取决于您想到的操作。

# c++ - 将 boost::any 传递给 boost::bind 的结果

> ID：306559
> 
> 赞同：1
> 
> 时间：2008-11-20T19:33:27.893
> 
> 标签：c++, boost

我试图弄清楚如何编写这个函数：

```
template <typename Bound>
Bound::result_type callFromAnyList(Bound b, list<any> p)
{
} 
```

然后，如果我有一些功能：

```
double myFunc(string s, int i)
{
    return -3.0;
} 
```

我可以通过这样做来调用它：

```
list<any> p;
p.push_back((string)"Hello");
p.push_back(7);
double result = callFromAnyList(bind(myFunc, _1, _2), p); 
```

是否可以编写类似我的`callFromAnyList`函数的东西？你能从返回的类型中检查结果类型和参数类型`bind`吗？然后打电话`any_cast<P1>(*p.begin())`等？我试图理解绑定代码，但它有点难以理解，而且看起来他们编写它时并没有考虑到检查。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:12:16.970

当您在评论部分更新您的担忧时，这里有答案。只需获取函数的返回类型是可能的：

```
template<typename>
struct return_of;

template<typename R>
struct return_of<R(*)()> {
    typedef R type;
};

template<typename R, typename P1>
struct return_of<R(*)(P1)> {
    typedef R type;
    typedef P1 parameter_1;
};

void foo(int);

template<typename Func>
typename return_of<Func>::parameter_1 bar(Func f) {
    return 42;
}

// call: bar(foo); 
```

我想你明白这归结为:) 你可以使用已经解决它的 boost 函数类型：http: [//www.boost.org/doc/libs/1_37_0/libs/function_types/doc/html/index.html](http://www.boost.org/doc/libs/1_37_0/libs/function_types/doc/html/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T21:16:02.803

我现在最终这样做了-

```
void invoke(void (f)(), list<any>& params)
{
    f();
}

template <typename R>
void invoke(R (f)(), list<any>& params)
{
    params.push_front(f());
}

template <typename T0>
void invoke(void (f)(T0), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    f(t0);
}

template <typename R, typename T0>
void invoke(R (f)(T0), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    params.push_front(f(t0));
}

template <typename T0, typename T1>
void invoke(void (f)(T0, T1), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    T1 t1 = any_cast<T1>(*params.begin()); params.pop_front();
    f(t0, t1);
}

template <typename R, typename T0, typename T1>
void invoke(R (f)(T0, T1), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    T1 t1 = any_cast<T1>(*params.begin()); params.pop_front();
    params.push_front(f(t0, t1));
}

template <typename T0, typename T1, typename T2>
void invoke(void (f)(T0, T1, T2), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    T1 t1 = any_cast<T1>(*params.begin()); params.pop_front();
    T2 t2 = any_cast<T2>(*params.begin()); params.pop_front();
    f(t0, t1, t2);
}

template <typename R, typename T0, typename T1, typename T2>
void invoke(R (f)(T0, T1, T2), list<any>& params)
{
    T0 t0 = any_cast<T0>(*params.begin()); params.pop_front();
    T1 t1 = any_cast<T1>(*params.begin()); params.pop_front();
    T2 t2 = any_cast<T2>(*params.begin()); params.pop_front();
    params.push_front(f(t0, t1, t2));
} 
```

我缺乏 boost::bind 的全部功能——比如，我无法处理方法指针——但我也意识到通过这样做，我有一个堆栈处理器。我可以继续调用对堆栈上的参数进行操作的方法。

# c# - Windows 需要什么来更新“文件修改”时间戳？

> ID：306562
> 
> 赞同：3
> 
> 时间：2008-11-20T19:33:43.820
> 
> 标签：c#, windows, file, timestamp

显然它在写入操作期间会更新，但是是否有任何非破坏性操作也会强制更新？基本上希望能够以编程方式在 C# 中执行与 *nix touch 命令等效的操作。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-20T19:43:20.197

使用函数 SetFileTime (C++) 或 File.SetLastWriteTime (C#) 将上次写入时间设置为当前时间。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T19:44:23.003

[System.IO.File.SetLastWriteTime(string path, DateTime lastWriteTime);](http://msdn.microsoft.com/en-us/library/system.io.file.setlastwritetime.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T19:44:29.460

在 .NET 中，使用 FileSystemInfo 对象的 LastWriteTime 属性。事实上，[在 MSDN 中，该属性的示例中有一个完整的 Touch 应用程序。](http://msdn.microsoft.com/en-us/library/system.io.filesysteminfo.lastwritetime.aspx)

# c# - App.config - 自定义部分不起作用

> ID：306572
> 
> 赞同：5
> 
> 时间：2008-11-20T19:36:37.027
> 
> 标签：c#

我最近开始构建 Web 应用程序的控制台版本。我从我的 web.config 复制了我的自定义部分。到我的 app.config。当我去获取配置信息时，我得到了这个错误：

为 x/y 创建配置节处理程序时出错：无法从程序集“System.Configuration”加载类型“x”

它不喜欢的行是：

返回 ConfigurationManager.GetSection("X/Y") 作为 Z；

有人遇到这样的事情吗？

我能够添加

```
<add key="IsReadable" value="0"/> 
```

在 appSettings 中并阅读它。

添加：

我确实有关于自定义部分的定义：

```
 <configSections>
    <sectionGroup name="x">
      <section name="y" type="zzzzz"/>
    </sectionGroup>

  </configSections> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T19:40:09.673

听起来您的配置节处理程序未定义

```
<configSection>
    <section
            name="YOUR_CLASS_NAME_HERE"
            type="YOUR.NAMESPACE.CLASSNAME, YOUR.NAMESPACE, Version=1.1.0.0, Culture=neutral, PublicKeyToken=PUBLIC_TOKEN_ID_FROM_ASSEMBLY"
            allowLocation="true"
            allowDefinition="Everywhere"
          />
</configSection> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-13T20:03:33.783

我最近遇到了同样的问题。我为 Web 应用程序创建了一个自定义部分组（运行得很好），但是当我将此层移植到控制台应用程序时，部分组失败了。

关于部分定义中需要多少“类型”的问题，您的问题是正确的。我用下面的例子修改了你的配置部分：

```
<configSection>
    <section
        name="yourClassName"
        type="your.namespace.className, your.assembly"
        allowLocation="true"
        allowDefinition="Everywhere" />
</configSection> 
```

您会注意到，该类型现在具有类名，后跟程序集名。这是在 Web 环境之外的交互所必需的。

注意：程序集名称不一定等于您的命名空间（对于给定的部分）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T19:43:20.760

如果您想要一个自定义配置处理程序，您必须定义类并引用它，如 Steven Lowe 所示。您可以从预定义的处理程序继承，或者您可以只使用 appSetting 部分中提供的值/键对，如您所述。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T19:43:23.020

在文件的顶部，您需要在该部分内有 configSection 标记。

您也可以拥有 sectionGroup。例子：

```
<configuration>
   <configSections>
     <sectionGroup name="x">
       <section name="y" type="a, b"/>
     </sectionGroup>
    <configSections>
</configuration> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T19:53:49.363

此类用作任何类型的通用自定义配置节处理程序...

```
public class XmlConfigurator : IConfigurationSectionHandler
    {
        public object Create(object parent, object configContext, XmlNode section)
        {
            if (section == null) return null;
            Type sectionType = Type.GetType((string)(section.CreateNavigator()).Evaluate("string(@configType)"));
            XmlSerializer xs = new XmlSerializer(sectionType);
            return xs.Deserialize(new XmlNodeReader(section));
        }
    } 
```

在您的 app.config 中，添加

```
 <section name="NameofConfigSection"  type="NameSpace.XmlConfigurator, NameSpace.Assembly"/> 
```

并在配置部分元素中，添加一个属性来指定您希望根元素反序列化为的类型。

```
<?xml version="1.0" encoding="utf-8" ?>

<NameofConfigSection configType="NameSpace.NameofTypeToDeserializeInto, Namespace.Assembly" >

 ... 

</NameofConfigSection> 
```

# php - phpdoc 的多个子包

> ID：306573
> 
> 赞同：2
> 
> 时间：2008-11-20T19:36:52.410
> 
> 标签：php, phpdoc

一个文件可以属于多个子包吗？例如：

```
/**
 * Name
 *
 * Desc
 *
 * @package    Core
 * @subpackage  Sub1
 * @subpackage  Sub2
 */ 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T21:56:24.203

由于命名空间的原因，PHPDoc 似乎不允许您这样做。来自[PHPDoc 文档](http://manual.phpdoc.org/HTMLSmartyConverter/HandS/phpDocumentor/tutorial_tags.subpackage.pkg.html)：

> 注意：@subpackage 标记旨在帮助对实际 @package 值中的元素进行分类。由于 PHP 本身不允许您在同一脚本中有两个具有相同名称的函数，因此 PhpDocumentor 还要求 @package 中的所有名称都是唯一的……这意味着，@subpackage 不允许在其中进一步“命名分离” @包裹。它所做的是允许该@package 内的元素进行一定程度的视觉分组/分离。

似乎因为 PHPDoc 的 @package 是一种对函数和类进行伪命名空间的方法，但 @subpackage 只是用于分类。您是否尝试过添加多个子包？如果有，结果如何？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-09T23:19:39.083

您可以使用以下方法来执行此操作：

```
* @package popcap\system\cache 
```

这将在您编译 PHPdocs 时创建包的层次结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-13T02:52:01.223

[http://pear.php.net/package/PHP_UML/](http://pear.php.net/package/PHP_UML/)

使用多个@subpackage 标签似乎做得很好——它甚至会像 phpDocumentor 一样生成 html- 文档——尽管它似乎不像 phpDocumentor 那样具有样式。

它还通过在生成的 UML 图中显示额外的子包来使用它。

# c# - 自定义日期时间 XML 序列化

> ID：306579
> 
> 赞同：5
> 
> 时间：2008-11-20T19:42:30.963
> 
> 标签：c#, web-services, .net-2.0, xml-serialization, asmx

我希望能够使用不是服务器的特定时区序列化 DateTime，也不是客户端时间。基本上，任何时区。是否可以在 .Net2.0 webservices 中覆盖 DateTime 序列化？

我使用 xsd.exe 编译了一个 xmlschema，所以我尝试使用 XmlSchemaImporter。

OnSerialize 示例显示值更改，但不更改输出格式。

XmlSchemaImporter，将其加载到 gac 中，运行 xsd.exe，并生成具有我想要的类的代码……但该类是一个属性，最终无法反映。

> [InvalidOperationException：无法序列化 Cuahsi.XmlOverrides.W3CDateTime 类型的成员“metadataDateTime”。XmlAttribute/XmlText 不能用于编码复杂类型。]

生成的代码

```
[System.Xml.Serialization.XmlAttributeAttribute()]
public Cuahsi.XmlOverrides.W3CDateTime dateTime {
    get {
        return this.dateTimeField;
    }
    set {
        this.dateTimeField = value;
    }
} 
```

XmlSchemaImporter

```
public class ImportW3CTime : 
  System.Xml.Serialization.Advanced.SchemaImporterExtension
{
    public override string ImportSchemaType(string name, string ns,
        XmlSchemaObject context, XmlSchemas schemas,
        XmlSchemaImporter importer, CodeCompileUnit compileUnit, 
        CodeNamespace mainNamespace, CodeGenerationOptions options,
        CodeDomProvider codeProvider)
    {
        if (XmlSchema.Namespace == ns)
        {
            switch (name)
            {
                case "dateTime":
                    string codeTypeName = typeof(W3CDateTime).FullName;
                    CodeTypeDeclaration cls = 
                        new CodeTypeDeclaration("W3CDateTime");                     
                    cls.IsStruct = true;
                    cls.Attributes = MemberAttributes.Public;
                    cls.BaseTypes.Add("dateTime");
                    mainNamespace.Types.Add(cls);
                    return codeTypeName;
                default: return null;
            }
        }
        else { return null; }
    }
} 
```

**附录 1：** 我只是厌倦了 DateTimeoffset，当类被标记为如下时仍然会导致错误：

```
[System.Xml.Serialization.XmlAttributeAttribute(DataType = "dateTime")]
public System.DateTimeOffset metadataDateTime {
    get {
        return this.metadataDateTimeField;
    }
    set {
        this.metadataDateTimeField = value;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-08-21T18:32:48.150

不要`DateTimeOffset`直接序列化，而是序列化一个字符串：

```
// Don't serialize this one
[System.Xml.Serialization.XmlIgnore]
public System.DateTimeOffset metadataDateTime
{
    get { ... }
    set { ... }
}

// Serialize this one instead
[System.Xml.Serialization.XmlAttribute("metadataDateTime")]
public string metadataDateTimeXml
{
    get { /* format metadataDateTime to custom format */ }
    set { /* parse metadataDateTime from custom format */ }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T19:45:26.400

您可能希望使用 DateTimeOffset 而不是纯 DateTime 对象。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-20T19:46:15.590

这是2天前讨论的。这对你有用吗？

[C# 将类序列化为 XML，其中类属性之一是 DateTime。如何以 ISO 格式制作此属性？](https://stackoverflow.com/questions/299387/c-serializing-class-to-xml-where-one-of-class-properties-is-datetime-how-to-mak#299418)

# javascript - 如何获取 $(this) 选择器的孩子？

> ID：306583
> 
> 赞同：2339
> 
> 时间：2008-11-20T19:44:05.733
> 
> 标签：javascript, jquery, jquery-selectors

我有一个类似于这样的布局：

```
<div id="..."><img src="..."></div> 
```

并想使用 jQuery 选择器来选择点击`img`内的孩子`div`。

要获得`div`，我有这个选择器：

```
$(this) 
```

如何让孩子`img`使用选择器？

* * *

## 回答 #1

> 赞同：2933
> 
> 时间：2008-11-20T21:27:29.097

jQuery 构造函数接受调用的第二个参数[`context`](http://api.jquery.com/jQuery/#jQuery-selector-context)，该参数可用于覆盖选择的上下文。

```
jQuery("img", this); 
```

这与这样使用相同[`.find()`](http://api.jquery.com/find)：

```
jQuery(this).find("img"); 
```

如果您想要的 imgs**只是**单击元素的直接后代，您还可以使用[`.children()`](http://api.jquery.com/children)：

```
jQuery(this).children("img"); 
```

* * *

## 回答 #2

> 赞同：482
> 
> 时间：2008-11-20T21:23:15.393

你也可以使用

```
$(this).find('img'); 
```

这将返回所有`img`s 的后代`div`

* * *

## 回答 #3

> 赞同：143
> 
> 时间：2011-07-21T18:47:31.383

如果您需要获得`img`恰好下降一个级别的第一个，您可以这样做

```
$(this).children("img:first") 
```

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2011-06-21T13:25:45.817

如果您的 DIV 标签紧跟在 IMG 标签之后，您还可以使用：

```
$(this).next(); 
```

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2012-07-16T20:07:51.357

*直系*子女是

```
$('> .child-class', this) 
```

* * *

## 回答 #6

> 赞同：47
> 
> 时间：2013-03-22T08:05:27.547

您可以找到`img`父 div 的所有元素，如下所示

```
$(this).find('img') or $(this).children('img') 
```

如果你想要一个特定的`img`元素，你可以这样写

```
$(this).children('img:nth(n)')  
// where n is the child place in parent list start from 0 onwards 
```

您的 div 仅包含一个`img`元素。所以下面这个是正确的

```
 $(this).find("img").attr("alt")
                  OR
  $(this).children("img").attr("alt") 
```

但是，如果您的 div 包含更多`img`元素，如下所示

```
<div class="mydiv">
    <img src="test.png" alt="3">
    <img src="test.png" alt="4">
</div> 
```

那么你不能使用上面的代码来查找第二个 img 元素的 alt 值。所以你可以试试这个：

```
 $(this).find("img:last-child").attr("alt")
                   OR
 $(this).children("img:last-child").attr("alt") 
```

此示例显示了如何在父对象中找到实际对象的一般想法。您可以使用类来区分您孩子的对象。这既简单又有趣。IE

```
<div class="mydiv">
    <img class='first' src="test.png" alt="3">
    <img class='second' src="test.png" alt="4">
</div> 
```

您可以按以下方式执行此操作：

```
 $(this).find(".first").attr("alt") 
```

更具体为：

```
 $(this).find("img.first").attr("alt") 
```

您可以使用 find 或 children 作为上述代码。有关更多信息，请访问儿童[http://api.jquery.com/children/](http://api.jquery.com/children/)和查找[http://api.jquery.com/find/](http://api.jquery.com/find/)。参见示例[http://jsfiddle.net/lalitjs/Nx8a6/](http://jsfiddle.net/lalitjs/Nx8a6/)

* * *

## 回答 #7

> 赞同：35
> 
> 时间：2015-01-25T10:51:43.413

在 jQuery 中引用子项的方法。我在下面的 jQuery 中总结了它：

```
$(this).find("img"); // any img tag child or grandchild etc...   
$(this).children("img"); //any img tag child that is direct descendant 
$(this).find("img:first") //any img tag first child or first grandchild etc...
$(this).children("img:first") //the first img tag  child that is direct descendant 
$(this).children("img:nth-child(1)") //the img is first direct descendant child
$(this).next(); //the img is first direct descendant child 
```

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2008-11-20T19:51:32.083

试试这个代码：

```
$(this).children()[0] 
```

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2008-11-20T19:56:20.250

在不知道 DIV 的 ID 的情况下，我认为您可以像这样选择 IMG：

```
$("#"+$(this).attr("id")+" img:first") 
```

* * *

## 回答 #10

> 赞同：23
> 
> 时间：2015-08-14T11:29:57.947

您可以使用以下任一方法：

**1 查找（）：**

```
$(this).find('img'); 
```

**2 个孩子（）：**

```
$(this).children('img'); 
```

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2013-06-26T07:42:16.747

jQuery`each`是一种选择：

```
<div id="test">
    <img src="testing.png"/>
    <img src="testing1.png"/>
</div>

$('#test img').each(function(){
    console.log($(this).attr('src'));
}); 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2014-07-25T21:56:40.380

您可以使用[Child Selecor](http://api.jquery.com/child-selector/)来引用父元素中可用的子元素。

```
$(' > img', this).attr("src"); 
```

以下是如果您没有参考`$(this)`并且您想在其他函数中参考`img`可用。`div`

```
 $('#divid > img').attr("src"); 
```

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2015-06-21T00:15:29.903

这也应该有效：

```
$("#id img") 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2016-12-28T18:08:36.933

这是一个功能代码，您可以运行它（这是一个简单的演示）。

当您单击 DIV 时，您会通过一些不同的方法获取图像，在这种情况下，“this”就是 DIV。

```
$(document).ready(function() {
  // When you click the DIV, you take it with "this"
  $('#my_div').click(function() {
    console.info('Initializing the tests..');
    console.log('Method #1: '+$(this).children('img'));
    console.log('Method #2: '+$(this).find('img'));
    // Here, i'm selecting the first ocorrence of <IMG>
    console.log('Method #3: '+$(this).find('img:eq(0)'));
  });
});
```

```
.the_div{
  background-color: yellow;
  width: 100%;
  height: 200px;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<div id="my_div" class="the_div">
  <img src="...">
</div>
```

希望能帮助到你！

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2017-08-23T14:08:30.573

您`<img>`的`<div>`.

要查找元素，请使用`.find()`.

为了保证您的代码安全，请使用`.each()`.

在 0 个元素的情况下使用`.find()`and`.each()`一起防止空引用错误，`<img>`同时还允许处理多个`<img>`元素。

```
// Set the click handler on your div
$("body").off("click", "#mydiv").on("click", "#mydiv", function() {

  // Find the image using.find() and .each()
  $(this).find("img").each(function() {

        var img = this;  // "this" is, now, scoped to the image element

        // Do something with the image
        $(this).animate({
          width: ($(this).width() > 100 ? 100 : $(this).width() + 100) + "px"
        }, 500);

  });

});
```

```
#mydiv {
  text-align: center;
  vertical-align: middle;
  background-color: #000000;
  cursor: pointer;
  padding: 50px;

}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<div id="mydiv">
  <img src="" width="100" height="100"/>
</div>
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-03-05T13:27:33.393

```
$(document).ready(function() {
  // When you click the DIV, you take it with "this"
  $('#my_div').click(function() {
    console.info('Initializing the tests..');
    console.log('Method #1: '+$(this).children('img'));
    console.log('Method #2: '+$(this).find('img'));
    // Here, i'm selecting the first ocorrence of <IMG>
    console.log('Method #3: '+$(this).find('img:eq(0)'));
  });
});
```

```
.the_div{
  background-color: yellow;
  width: 100%;
  height: 200px;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<div id="my_div" class="the_div">
  <img src="...">
</div>
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-05-07T08:38:51.367

如果您的 img 恰好是 div 中的第一个元素，那么请尝试

```
$(this.firstChild); 
```

```
$( "#box" ).click( function() {
  let img = $(this.firstChild);
  console.log({img});
})
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div id="box"><img src="https://picsum.photos/seed/picsum/300/150"></div>
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-03-26T07:10:29.973

使用本机 javascript，您可以使用

如果您有多个图像标签，请使用

`this.querySelectorAll("img")`

如果只有一个图像标签，那么我们

`this.querySelector("img")`

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2019-09-19T07:18:23.190

你可以使用

```
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
 $(this).find('img');
</script> 
```

# asp.net - VB.NET 和 ASP.NET DLL 行号不会出现在生产错误日志中

> ID：306589
> 
> 赞同：5
> 
> 时间：2008-11-20T19:46:09.740
> 
> 标签：asp.net, vb.net, stack-trace, line-numbers

我可以在我们的开发环境中看到错误日志中的行号，其中 VB.NET 2005 和 ASP.NET 组件在调试模式下编译，PDB 文件在部署时复制到服务器。

我看不到生产中的行号，在发布模式下编译的东西，大概没有创建或部署 PDB 文件？有人可以解释一种方法来编译和发布在堆栈跟踪中显示行号的生产就绪组件吗？在下面的 dev 中工作的调试代码：

```
st = New StackTrace(err, True)

For i As Integer = 0 To st.FrameCount - 1
  Dim sf As StackFrame = st.GetFrame(i)
  system.diagnostics.debug.print sf.GetFileLineNumber
Next i 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T19:49:28.873

看看[这篇文章](http://www.knowdotnet.com/articles/linenumbersinreleasemode.html)。基本上，即使在发布模式下运行，您也需要将项目配置为仍然输出 PDB。

# php - 如何使用 file_get_contents 发送 cookie

> ID：306591
> 
> 赞同：16
> 
> 时间：2008-11-20T19:46:48.770
> 
> 标签：php, session, cookies, file-get-contents

我正在尝试从另一个文件中获取内容`file_get_contents`（不要问为什么）。
我有两个文件：*test1.php*和*test2.php*。*test1.php*根据登录的用户返回一个字符串。

*test2.php*尝试获取 test1.php 的内容，*并且*正在被浏览器执行，从而获取 cookie。

为了发送 cookie `file_get_contents`，我创建了一个流式上下文：

```
$opts = array('http' => array('header'=> 'Cookie: ' . $_SERVER['HTTP_COOKIE']."\r\n"))`; 
```

我正在检索内容：

```
$contents = file_get_contents("http://www.example.com/test1.php", false, $opts); 
```

但现在我得到了错误：

> 警告：file_get_contents（[http://www.example.com/test1.php](http://www.example.com/test1.php)）[function.file-get-contents]：打开流失败：HTTP 请求失败！HTTP/1.1 404 未找到

有人知道我在这里做错了什么吗？

编辑：
忘了提：没有*streaming_context*，页面只会加载。但如果没有 cookie，我就无法获得所需的信息。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-21T06:38:53.133

首先，这可能只是您的问题中的一个错字，但是 file_get_contents() 的第三个参数需要是您的流上下文，而不是选项数组。我用这样的东西进行了快速测试，一切都按预期工作

```
$opts = array('http' => array('header'=> 'Cookie: ' . $_SERVER['HTTP_COOKIE']."\r\n"));
$context = stream_context_create($opts);
$contents = file_get_contents('http://example.com/test1.txt', false, $context);
echo $contents; 
```

**该错误表明服务器正在返回 404。尝试从运行 PHP 的机器**而**不是**从您的工作站/台式机/笔记本电脑获取 URL 。可能是您的 Web 服务器无法访问该站点，您的本地计算机有缓存副本，或者其他一些网络问题。

确保在运行此测试时重复您的确切请求，包括您发送的 cookie（命令行 curl 对此很有用）。有问题的页面完全有可能在没有 cookie 的浏览器中正常加载，但是当您发送 cookie 时，该站点实际上返回 404。

确保 $_SERVER['HTTP_COOKIE'] 具有您认为的原始 cookie。

如果您要进行屏幕抓取，请下载 Firefox 和 LiveHTTPHeaders 扩展的副本。执行所有必要的步骤以在 Firefox 中访问您想要的任何页面。然后，使用 LiveHTTPHeaders 的输出，重新创建完全相同的请求 requence。包括每个标题，**而**不仅仅是 cookie。

最后，[PHP Curl](http://us.php.net/curl)的存在是有原因的。如果可能的话，（我不是在问！）改用它。:)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-03-01T02:28:06.360

只是为了分享这些信息。使用`session_start()`时，会话文件被 PHP 锁定。因此，实际脚本是唯一可以访问会话文件的脚本。如果您尝试通过`fsockopen()`或`file_get_contents()`您尝试打开已锁定的文件后等待很长时间。

解决此问题的一种方法是使用`session_write_close()`解锁文件并在使用`session_start()`.

例子：

```
<?php
 $opts = array('http' => array('header'=> 'Cookie: ' . $_SERVER['HTTP_COOKIE']."\r\n"));
 $context = stream_context_create($opts);
 session_write_close(); // unlock the file
 $contents = file_get_contents('http://120.0.0.1/controler.php?c=test_session', false, $context);
 session_start(); // Lock the file
 echo $contents;
?> 
```

由于`file_get_contents()`是一个阻塞函数，因此在尝试修改会话文件时，两个脚本都不会并发。

但我确信这不是使用扩展连接操作会话的最佳方式。

顺便说一句：它比**cURL**和`fsockopen()`

如果你找到更好的东西，请告诉我。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-12T00:41:31.993

只是出于好奇，您是否正在尝试`file_get_contents`在其中有空格的页面上？我记得尝试在名称中有空格的 URL 上使用 fgc，而我的 Web 浏览器可以很好地解析它，但 fgc 没有。我最终不得不使用 a`str_replace`将 ' ' 替换为 '%20'。

我认为这应该相对容易发现，因为它只报告文件名的一半。另外，我注意到在其中一篇文章中，有人在定义标题时使用了 \r\n。请记住，PHP 不喜欢将它们放在单引号中，但它们在双引号中可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T20:03:29.003

确保 file1.php 存在于服务器上。尝试在您自己的浏览器中打开它以确保！

# backwards-compatibility - 向后兼容性有多重要？

> ID：306594
> 
> 赞同：6
> 
> 时间：2008-11-20T19:47:58.660
> 
> 标签：backwards-compatibility

当您考虑升级开发工具时，向后兼容性对您来说有多重要？如果 Visual Studio 2010 需要对您的源代码进行重大更改，您还会购买它吗？在为新功能交易向后兼容性方面，您的转折点在哪里？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-20T19:59:41.287

虽然您从开发人员的角度提出了这个问题，但我认为对于您开发的软件来说，这将是一个更有趣的问题。所以我要回答这个问题。:)

向后兼容（更重要的是，未来兼容）的硬件和软件为您的用户提供安全感，尤其是在购买或升级 Windows 等平台时。如果不出意外，Windows 以其对向后兼容性的细致关注而闻名。您可以在 Windows Vista 上运行十年前编写的程序，只要它们“编写良好”（即不要使用未记录的 API），只会出现小问题。

另一方面，当您尝试引入新功能或彻底改变平台时，严格注意向后兼容性可能会束缚您的手脚。Apple 知道它的操作系统即将死去，在其最大胆的举措之一中，它购买了 NeXT 并决定将 NeXTSTEP 打造为新的 MacOS。在过渡期间向人们推销的关键之一是向后兼容的层 Classic。同样，当 Apple 决定改用 Intel 芯片时，一种在 Intel 上运行 PowerPC 应用程序的机制称为 Rosetta 以及通用二进制文件，允许人们在 PowerPC 和 Intel 之间自由移动，而不必担心应用程序丢失。

一件有趣的事情是，随着向 Intel 的过渡，Classic 环境消失了，但没有人真正关心，因为他们在前 5 年中从 Mac OS 9 过渡。因此，只要您有，最终就有可能放弃对遗留系统的支持一种迁移到新系统并为您的用户提供充足时间的简单方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T19:56:16.130

在开发工具中，如果它不能完全向后兼容我以前的代码，我不会购买它，我怀疑有人会购买。坦白说，没有意义。如果我已经有一个编译器可以将我的源代码构建为适合我的可执行代码，那么我将使用它。为什么要更改我的代码以符合对工具制造商来说显然不是标准的东西？如果他们强制将源代码从一个版本更改到另一个版本，他们为什么还要费心使下一个版本兼容？

与源代码 100% 向后兼容是一项要求。唯一不完全要求的情况是不兼容的位是扩展；即特定于工具的 API 更改，例如 Eclipse 插件等。即便如此，我想要兼容性，但我意识到它不能完全被期望。但是如果你为基础应用/工具开发提供了一个API，并且懒得维护兼容性；好吧，那么，您显然对您的工具并不认真，我也不会为它们支付大笔钱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T19:56:15.617

对于家庭项目，向后兼容性真的不重要。对于办公室/企业来说，这绝对是至关重要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T19:51:52.817

这取决于您需要支持哪些环境以及使用哪些可能兼容或不兼容的第三方工具。

例如，在我工作的地方，我们将所有人都从 VS2005 升级到 VS2008，除了我们的 BI 组，因为 SQL Server BI 工具与 VS2008 不兼容。更新后，他们升级到 VS2008。

在具体查看 VS 时，请记住 VS2008 可以针对 .NET 2.0、.NET 3.0 和 .NET 3.5。诀窍是要意识到它实际上以 .NET 2.0 SP1 和 .NET 3.0 SP1 为目标。因此，升级 IDE 不应要求您更改代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T19:52:22.113

由于软件和硬件领域正在发生很多变化，我认为在构建解决方案时对新变化和更好的工具持开放态度是个好主意。比如90年代我们没有多核处理器和高端显卡或网卡，所以编译器和工具的优化目标自然是不同的。但与此同时，类似***Visual Studio***的工具正在尽最大努力适应旧的框架和应用程序。

我认为，如果我们期待一个更美好的世界，我们应该对不断变化持开放态度，直到这个行业超级成熟。（虽然可能不会发生在我们的一生中:)）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T19:54:36.353

一般来说，如果您正在开发一个平台，该平台将被许多其他用户不断使用来构建他们自己的产品，并且您计划长期开发该应用程序，那么这很重要。查看 PHP、Python、Eclipse 和其他非常重视向后兼容性的开源项目。在开发 n 层架构中使用的服务或其他开放 API 时，它也很重要。当您更改服务时，您可以让企业中的所有应用程序一直中断。

现在，如果您正在构建收缩包装应用程序或商业应用程序，那么它就不是那么重要了，因为每个版本都与其前身分开。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T19:51:31.647

定义“重大变化”。如果可以通过精心设计的“搜索和替换”进行更改，即使它们很广泛，我也会这样做。

然而，这就是*我*会做的。我工作过的任何公司都会拒绝对现有代码进行任何更改。

# c# - 在解析完成之前遇到流结束？

> ID：306596
> 
> 赞同：47
> 
> 时间：2008-11-20T19:48:21.247
> 
> 标签：c#, .net, serialization, .net-2.0, c#-2.0

我正在尝试反序列化流，但总是收到此错误“在解析完成之前遇到流结束”？

这是代码：

```
 //Some code here
        BinaryFormatter b = new BinaryFormatter();
        return (myObject)b.Deserialize(s);//s---> is a Stream object that has been fill up with data some line over here 
```

有人有想法吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-20T19:48:49.547

尝试将位置设置为流的 0 并且不要使用您的对象，而是使用对象类型。

```
 BinaryFormatter b = new BinaryFormatter();
        s.Position = 0;
        return (YourObjectType)b.Deserialize(s); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-20T20:00:30.567

确保序列化完成，并且序列化类型与反序列化类型匹配（即，如果您使用 BinaryFormatter 进行反序列化，请确保您使用 BinaryFormatter 进行序列化）。此外，请确保您序列化的流真正完成了序列化，使用 Stream.Flush() 或类似的东西。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-05-22T00:41:34.977

我抛出了同样的异常，直到我将 [Serializable] 标记添加到我正在序列化的类中:)

然后一切都很完美。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-29T15:01:28.897

就我而言，我使用了：

```
stream.Seek(0, SeekOrigin.Begin); 
```

在我序列化流之后，在我反序列化流之前工作魅力。希望这可以帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-11-21T14:56:43.303

我花了 5 个小时，得到了流错误和数据丢失的结束（GzipStream 中没有明显的特征：你应该只在刷新 GzipStream 之后使用底层流）。

工作代码的完整示例：

```
using System;
using System.IO;
using System.IO.Compression;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;

namespace ConsoleApp3
{
    class Program
    {
        static void Main(string[] args)
        {
            string large = LargeJsonContent.GetBigObject();
            string base64;

            using (var readStream = new MemoryStream())
            using (var writeStream = new MemoryStream())
            {
                using (GZipStream compressor = new GZipStream(writeStream, CompressionMode.Compress, true)) //pay attention to leaveOpen = true
                {
                    var formatter = new BinaryFormatter();
                    formatter.Serialize(readStream, large);

                    Console.WriteLine($"After binary serialization of JsonString: {readStream.Length} bytes");

                    readStream.Position = 0;
                    readStream.CopyTo(compressor);
                }

                Console.WriteLine($"Compressed stream size: {writeStream.Length} bytes");

                writeStream.Position = 0;
                byte[] writeBytes = writeStream.ToArray();
                base64 = Convert.ToBase64String(writeBytes);
            }

            ////

            using (var stream = new MemoryStream())
            {
                var formatter = new BinaryFormatter();
                formatter.Serialize(stream, base64);
                Console.WriteLine($"Size of base64: {stream.Length} bytes");
            }

            Console.WriteLine("---------------------");
            ////

            string large2;

            var bytes = Convert.FromBase64String(base64);
            using (var readStream = new MemoryStream())
            {
                readStream.Write(bytes, 0, bytes.Length);
                readStream.Position = 0;
                Console.WriteLine($"Compressed stream size: {readStream.Length} bytes");
                using (var writeStream = new MemoryStream())
                {
                    using (GZipStream decompressor = new GZipStream(readStream, CompressionMode.Decompress, true)) //pay attention to leaveOpen = true
                    {
                        decompressor.CopyTo(writeStream);
                        writeStream.Position = 0;
                    }

                    var formatter = new BinaryFormatter();
                    large2 = (string)formatter.Deserialize(writeStream);
                }
            }

            Console.WriteLine(large == large2);
            Console.WriteLine($"large:{large.Length} | large2:{large2.Length}");
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-28T10:24:26.313

如果您没有执行以下操作，请检查您的发件人代码

```
NetworkStream strm = client.GetStream(); // the stream
formatter.Serialize(strm, status); // the serialization process
strm.Close();// Remove this code, this was the culprit in my case 
```

# c# - 在 C# 中，使用 UInt32 与 Int32 是否存在显着的性能差异

> ID：306602
> 
> 赞同：17
> 
> 时间：2008-11-20T19:50:06.877
> 
> 标签：c#, performance, int32, uint32

我正在将现有应用程序移植到 C# 并希望尽可能提高性能。许多现有的循环计数器和数组引用被定义为 System.UInt32，而不是我会使用的 Int32。

使用 UInt32 和 Int32 有什么显着的性能差异吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2016-02-02T00:16:28.440

简短的回答是“不。任何性能影响都可以忽略不计”。

正确答案是“视情况而定”。

一个更好的问题是，“当我确定不需要符号时，我应该使用 uint 吗？”

您无法就性能给出明确的“是”或“否”的原因是目标平台最终将决定性能。也就是说，性能取决于将要执行代码的任何处理器以及可用的指令。您的 .NET 代码编译为[中间语言](https://en.wikipedia.org/wiki/Common_Intermediate_Language "中级语言")（IL 或字节码）。这些指令随后由[即时](https://msdn.microsoft.com/en-us/library/ht8ecch6(v=vs.90).aspx "准时制")(JIT) 编译器编译到目标平台，作为[公共语言运行时](https://msdn.microsoft.com/en-us/library/ht8ecch6(v=vs.90).aspx "公共语言运行时")(CLR) 的一部分。您无法控制或预测将为每个用户生成什么代码。

因此，知道硬件是性能的最终仲裁者，问题就变成了“.NET 为有符号整数和无符号整数生成的代码有何不同？” 和“差异会影响我的应用程序和目标平台吗？”

回答这些问题的最佳方法是进行测试。

```
class Program
{
  static void Main(string[] args)
  {
    const int iterations = 100;
    Console.WriteLine($"Signed:      {Iterate(TestSigned, iterations)}");
    Console.WriteLine($"Unsigned:    {Iterate(TestUnsigned, iterations)}");
    Console.Read();
  }

  private static void TestUnsigned()
  {
    uint accumulator = 0;
    var max = (uint)Int32.MaxValue;
    for (uint i = 0; i < max; i++) ++accumulator;
  }

  static void TestSigned()
  {
    int accumulator = 0;
    var max = Int32.MaxValue;
    for (int i = 0; i < max; i++) ++accumulator;
  }

  static TimeSpan Iterate(Action action, int count)
  {
    var elapsed = TimeSpan.Zero;
    for (int i = 0; i < count; i++)
      elapsed += Time(action);
    return new TimeSpan(elapsed.Ticks / count);
  }

  static TimeSpan Time(Action action)
  {
    var sw = new Stopwatch();
    sw.Start();
    action();
    sw.Stop();
    return sw.Elapsed;
  }
} 
```

两种测试方法**TestSigned**和**TestUnsigned**分别对有符号和无符号整数执行约 200 万次简单增量迭代。测试代码对每个测试运行 100 次迭代并对结果进行平均。这应该消除任何潜在的不一致。我为 x64 编译的 i7-5960X 上的结果是：

```
Signed:      00:00:00.5066966

Unsigned:    00:00:00.5052279 
```

这些结果几乎相同，但要获得明确的答案，我们确实需要查看为程序生成的字节码。我们可以使用[ILDASM](https://msdn.microsoft.com/en-us/library/f7dy01k1(v=vs.110).aspx "伊尔达斯姆")作为 .NET SDK 的一部分来检查编译器生成的程序集中的代码。

[![字节码](https://i.stack.imgur.com/sMA1r.png)](https://i.stack.imgur.com/sMA1r.png)

在这里，我们可以看到 C# 编译器偏爱有符号整数，并且实际上在本机作为有符号整数执行大多数操作，并且仅在比较分支（也称为跳转或 if）时将内存中的值视为无符号。尽管我们在**TestUnsigned**中对迭代器和累加器都使用了无符号整数，但代码几乎与**TestSigned**方法相同，除了一条指令：**IL_0016**。快速浏览[ECMA 规范](https://en.wikipedia.org/wiki/List_of_CIL_instructions "ECMA 规范")描述了不同之处：

> blt.un.s ：如果小于（无符号或无序），则分支到目标，短格式。
> 
> blt.s ：如果小于，则分支到目标，短格式。

作为如此常见的指令，可以安全地假设大多数现代高功率处理器将具有用于这两种操作的硬件指令，并且它们很可能会在相同数量的周期内执行，但这**并不能保证**。低功耗处理器可能有更少的指令，并且没有 unsigned int 的分支。在这种情况下，JIT 编译器可能必须发出多个硬件指令（例如，首先是转换，然后是分支）来执行**blt.un.s** IL 指令。即使是这种情况，这些附加指令也是基本的，可能不会显着影响性能。

因此，就性能而言，长答案是“使用有符号整数或无符号整数之间不太可能存在性能差异。如果存在差异，则可能可以忽略不计。”

因此，如果性能相同，下一个合乎逻辑的问题是，“当我确定不需要符号时，我应该使用无符号值*吗*？”

这里有两件事要考虑：首先，无符号整数不[符合 CLS](https://msdn.microsoft.com/library/bhc3fa7f(v=vs.100).aspx "符合 CLS")，这意味着如果您将无符号整数作为另一个程序将使用的 API 的一部分公开（例如，如果您是分发一个可重用的库）。其次，.NET 中的大多数操作，包括 BCL 公开的方法签名（出于上述原因），都使用有符号整数。因此，如果您打算实际使用无符号整数，您可能会发现自己对它进行了相当多的转换。这将对性能造成非常小的影响，并且会使您的代码更加混乱。最后，它可能不值得。

**TLDR；**回到我的 C++ 时代，我会说“使用最合适的东西，让编译器解决剩下的问题。” C# 并不那么简单，所以我会为 .NET 这么说：x86/x64 上的有符号整数和无符号整数之间确实没有性能差异，但大多数操作都需要有符号整数，所以除非你真的需要仅将值限制为正数，或者您确实需要符号位所吃的额外范围，请坚持使用有符号整数。你的代码最终会更干净。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-20T19:56:37.363

除了处理器级别的有符号和无符号算术之间可能存在的差异之外，我认为没有任何性能考虑，但在这一点上，我认为这些差异是没有实际意义的。

更大的区别在于 CLS 合规性，因为无符号类型不符合 CLS，因为并非所有语言都支持它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T19:59:56.920

我没有在 .NET 中对此事进行任何研究，但是在 Win32/C++ 的旧时代，如果你想将“signed int”转换为“signed long”，cpu 必须运行一个 op 来扩展标志。要将“unsigned int”转换为“unsigned long”，它的高字节只有零。节省大约几个时钟周期（即，您必须执行数十亿次才能获得甚至可察觉的差异）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-20T20:01:08.523

没有区别，性能方面。简单的整数计算是众所周知的，现代 CPU 经过高度优化以快速执行它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T22:30:35.927

这些类型的优化很少值得付出努力。使用最适合该任务的数据类型并保留它。如果这件事涉及到数据库，您可能会在数据库设计、查询语法或索引策略中找到十几个调整，这些调整将使 C# 中的代码优化抵消几百个数量级。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T19:54:38.537

无论哪种方式，它都会分配相同数量的内存（尽管一个可以存储更大的值，因为它不会为符号节省空间）。因此，我怀疑您会看到“性能”差异，除非您使用会导致一个选项或另一个选项爆炸的大值/负值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T20:07:32.957

这实际上与性能无关，而是与循环计数器的要求有关。

Prehaps有很多迭代要完成

```
 Console.WriteLine(Int32.MaxValue);      // Max interation 2147483647
        Console.WriteLine(UInt32.MaxValue);     // Max interation 4294967295 
```

unsigned int 可能是有原因的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-25T18:00:38.837

我从来没有同情`int`in loops的使用`for(int i=0;i<bla;i++)`。通常我也想用`unsigned`它来避免检查范围。不幸的是（在 C++ 和 C# 中出于类似原因），建议**不要**使用`unsigned`来获得更多位或确保非消极性，：

> “使用 an`unsigned`而不是 an`int`来获得更多位来表示正整数几乎从来都不是一个好主意。通过声明变量来确保某些值是正数的尝试`unsigned`通常会被隐式转换规则打败”

**该语言的创建者**Bjarne Stroustrup的“C++ 编程语言”的第 73 页。

我的理解（我很抱歉没有手头的来源）是硬件制造商也有优化`integer`类型的偏见。

尽管如此，做上面#Robear所做的相同练习会很有趣，但使用`integer`一些积极性`assert`与`unsigned`.

# php - 以编程方式将 Speex 文件转换为 MP3？

> ID：306622
> 
> 赞同：0
> 
> 时间：2008-11-20T19:54:48.550
> 
> 标签：php, mp3, speex

是否有某种库可以让我将 speex 文件转换为 mp3 文件？如果它可以从 php 中实现，那就更好了，但实际上任何东西都可能起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:04:33.197

如果您的平台上有可用的[gstreamer](http://gstreamer.freedesktop.org/)，只要您安装了正确的编解码器，它就可以为您完成。

在[http://forums.fedoraforum.org/showthread.php?t=61984](http://forums.fedoraforum.org/showthread.php?t=61984)我发现这段代码用于 wma 到 mp3 的转换，你应该能够根据你的需要制作类似的东西：

> `gst-launch filesrc location=filename.wma ! spider ! lame ! filesink location=filename.mp3`

# unit-testing - 如何决定单元测试的测试用例？

> ID：306625
> 
> 赞同：11
> 
> 时间：2008-11-20T19:55:17.210
> 
> 标签：unit-testing

我刚刚开始进行单元测试，并编写了一些简短的测试来检查名为 isPrime() 的函数是否正常工作。

我有一个测试来检查函数是否有效，并且有一些数字形式的测试数据和预期的返回值。

我应该测试多少？我如何决定测试哪个？这里的最佳实践是什么？

一种方法是生成 1000 个素数，然后循环遍历它们，另一种方法是只选择 4 或 5 个并测试它们。正确的做法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-20T20:37:48.683

我还被告知，每次发现错误时，您都应该编写一个测试来验证它是否已修复。无论如何，这对我来说似乎是合理的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-20T20:06:29.853

你想检查边缘情况。您的方法应该能够处理多大的素数？这将取决于您使用的表示（类型）。如果您只对小的（在数论中使用时*是*相对术语）素数感兴趣，那么您可能正在使用 int 或 long。在您选择的表示中测试一些最大的素数。确保你也检查了一些非质数。（这些更容易独立验证。）

当然，您还需要测试一些小数（素数和非素数）和范围中间的一些数。一把应该足够了。还要确保为超出有效输入范围的数字抛出异常（或返回错误代码，以您的偏好为准）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T20:01:12.097

问你自己。我到底想测试什么。并且测试最重要。测试以确保它在预期的情况下基本上可以满足您的期望。

测试所有那些空值和边缘情况——我——不认为是真实的，太费时了，以后需要有人维护它！而且...您的测试代码应该足够简单，这样您就不需要测试您的测试代码了！

如果您想检查您的函数是否正确应用了算法并正常工作 - 可能会足够一些素数。

如果你想证明寻找素数的方法是正确的 - 100000 个素数是不够的 :) 但你不想测试后者（可能）......

只有你知道你想测试什么！:)

PS我认为在单元测试中使用循环并不总是错误的，但在这样做之前我会三思而后行。测试代码应该非常简单。如果出现问题并且您的测试中有错误怎么办？？？？:) 但是，您应该尽量避免测试代码重复作为常规代码重复。必须有人维护测试代码。

**人们请评论为什么您认为这值得两次投反对票:)**

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T20:12:08.063

一般来说，尽可能多地测试你需要感到舒适/自信的案例

同样，一般情况下，测试基本/零情况、最大情况和至少一种中值/中间情况

如果适用，还测试预期的异常情况

如果您不确定您的素数算法，那么请务必使用前 1000 个素数左右对其进行测试，以获得信心

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T20:12:30.373

“当心错误。我已经证明上述算法是正确的，但还没有测试过。”

有些人不理解上面的引用（释义？），但是当您考虑它时，它是完全有道理的。测试永远不会证明算法是正确的，它们只会帮助表明你是否编码正确。为您预期可能出现的错误和边界条件编写测试以实现良好的代码覆盖率。不要只是从蓝色中挑选值来查看它们是否有效，因为这可能会导致大量测试都测试完全相同的东西。

对于您的示例，只需手动选择一些素数和非素数来测试实现中的特定条件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T20:07:14.080

几个问题，答案可能会影响您的决定：

*   这段代码的正确运行有多重要？
*   将来是否可能更改此代码的实现？（如果是这样，测试更多以支持未来的变化）
*   这段代码的公共合约未来有可能发生变化吗？（如果是这样，请减少测试 - 以减少一次性测试代码的数量）
*   代码覆盖率如何，是否所有分支都访问过？
*   即使代码没有分支，是否测试了边界考虑？
*   测试运行速度快吗？

编辑：嗯，所以在你的具体情况下建议。自从您昨天开始编写单元测试以来，您可能没有经验在所有这些因素中做出决定。让我来帮助你：

*   这段代码可能不太重要（没有人死亡，没有人参战，没有人被起诉），所以少量测试就可以了。
*   实现可能不会改变（素数技术是众所周知的），所以我们不需要测试来支持这一点。如果实现确实发生了变化，则可能是由于观察到的失败值。可以在更改时将其添加为新测试。
*   这个公共合同不会改变。
*   获得 100% 的代码覆盖率。在这种情况下，没有理由编写测试不访问的代码。您应该能够通过少量测试来做到这一点。
*   如果您关心调用零时代码的作用，请对其进行测试。
*   少量测试应该快速运行。这将允许它们经常运行（由开发人员和自动化）。

我会测试 1、2、3、21、23、一个“大”素数（5 位数字）、一个“大”非素数和 0，如果你关心它对 0 的作用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T20:46:34.907

确实，您将不得不对它们进行全部测试。:-)

不过说真的，对于这种功能，您可能正在使用已建立且经过验证的算法。您需要做的主要事情是验证您的代码是否正确实现了算法。

另一件事是确保您了解数字表示的限制，无论是什么。至少，这将对您可以测试的数量设置上限。例如，如果您使用 32 位无符号整数，您将永远无法测试大于 4G 的值。您的限制可能会低于此，具体取决于您的实施细节。

就像一个实现可能出错的例子：一个简单的测试素数的算法是尝试将候选除以所有已知的素数，直到候选的平方根。平方根函数不一定会给出准确的结果，所以为了安全起见，你应该稍微超越一下。过去多远具体取决于平方根函数的实现方式以及它可以关闭多少。

关于测试的另一个注意事项：除了测试已知的素数以查看您的函数是否正确地将它们识别为素数外，还要测试已知的合数以确保您没有得到“误报”。为确保您得到平方根函数的正确性，请选择一些具有尽可能接近其平方根的素数的合数。

此外，请考虑如何“生成”用于测试的素数列表。你能相信这份清单是正确的吗？这些数字是如何测试的，由谁测试的？

您可能会考虑编写两个函数并相互测试它们。一种可能是一种简单但缓慢的算法，您可以更确定是否正确编码，另一种可能是您真正想在应用程序中使用的更快但更复杂的算法，但更有可能出现编码错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-20T22:09:46.220

“如果值得构建，就值得测试
”

我猜你没有先订阅测试，在你写代码之前你在哪里写测试？
不用担心，我相信你并不孤单。
如上所述，测试边缘，这是一个很好的起点。还必须测试坏案例，如果你只测试你知道有效的东西，你可以确定坏案例会在最坏的时候发生在生产中。

哦，“我刚刚发现了最后一个错误”——哈哈。

# android - 使用 Android 的多个 ListView 滚动

> ID：306626
> 
> 赞同：35
> 
> 时间：2008-11-20T19:55:37.863
> 
> 标签：android, listview, scrollview, android-linearlayout

我完全被这个难住了。我需要在屏幕上显示三个不同的列表。列表完全有可能超出屏幕的底部边缘，所以我需要滚动。

我已经尝试使用 a`ScrollView`和一个`LinearLayout`孩子，并将我`ListViews`的`LinearView`，但所有的`ListViews`锁都锁定到一个带有滚动条的固定高度。使用其他类型的布局意味着没有滚动。

有没有人有任何建议，或者我需要以编程方式将列表项添加到一些布局并希望最好？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-06-29T14:53:48.277

将触摸事件从`touched`视图转发到其他视图。您的所有视图也将同步展开/折叠。

```
 OnTouchListener mOnTouch = new OnTouchListener()
    {
        @Override
        public boolean onTouch(View v, MotionEvent event)
        {            
            MotionEvent newEvent = MotionEvent.obtain(event);
            switch(event.getAction()){  
            case MotionEvent.ACTION_MOVE:
                if(mTouched == null){
                    mTouched = v;
                }
                mMovingFlag = true;
                break;
            case MotionEvent.ACTION_UP:
                if(mMovingFlag==false){
                    newEvent.setAction(MotionEvent.ACTION_CANCEL);
                }
                mMovingFlag = false;
                break;
            default:
                mMovingFlag = false;
                if(mTouched != null && mTouched.equals(v)){
                    mTouched = null;
                }
                break;

            }
            if(mTouched == null || mTouched.equals(v)){
                int items = mLayoutWithListViews.getChildCount();
                for(int list=0; list<items; list++){
                    AbsListView listView =mLayoutWithListViews.getChildAt(list));
                    if(listView != v){
                         listView.onTouchEvent(newEvent);
                    }
                }
            }
            return false;
        }
    }; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-12T09:58:06.603

我还没有这样做，但我一直在考虑它，因为我可能需要这样做。我可以想到三个选项：仅使用一个包含所有列表内容的列表。您可以制作一个这样做的 ListAdapter 并插入某种标题。这可能是非常可重用的东西。

另一个想法是制作一个列表列表。但这听起来像是自找麻烦。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-02-26T13:16:27.410

我有一个类似的问题，除了我有两个 GridView 和一个 ListView 可以滚动。我通过手动设置 ListViews 和 GridView 的高度来解决它：

```
 ListAdapter listAdapter = listView.getAdapter();

    int rows = listAdapter.getCount() / columns;
    int height = 60 * rows; // Insert the general cell height plus the dividers.

    ViewGroup.LayoutParams params = listView.getLayoutParams();
    params.height = height;
    listView.setLayoutParams(params);
    listView.requestLayout(); 
```

希望我能帮助别人。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-10T18:53:14.667

尽管此答案适用于滚动视图而不是列表视图，但问题是相同的，并且此解决方案对我来说效果很好。滚动左滚动视图将滚动右滚动视图，反之亦然。

```
 public class MainActivity extends Activity implements OnTouchListener {
    private ScrollView scrollViewLeft;
    private ScrollView scrollViewRight;
    private static String LOG_TAG = MainActivity.class.getName();
    private boolean requestedFocus = false;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        scrollViewLeft = (ScrollView) findViewById(R.id.scrollview_left);
        scrollViewRight = (ScrollView) findViewById(R.id.scrollview_right);

        scrollViewLeft.setOnTouchListener(this);
        scrollViewRight.setOnTouchListener(this);

        scrollViewLeft.setFocusableInTouchMode(true);
        scrollViewRight.setFocusableInTouchMode(true);
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.activity_main, menu);
        return true;
    }

    @Override
    public boolean onTouch(View view, MotionEvent motionEvent) {
        Log.d(LOG_TAG, "--> View, event: " + view.getId() + ", " + motionEvent.getAction() + ", " + view.isFocused());
        Log.d(LOG_TAG, "--> " + scrollViewLeft.isFocused() + ", " + scrollViewRight.isFocused());

        if (motionEvent.getAction() == MotionEvent.ACTION_DOWN && requestedFocus == false){
            view.requestFocus();
            requestedFocus = true;
        }else if (motionEvent.getAction() == MotionEvent.ACTION_UP){
            requestedFocus = false;
        }

        if (view.getId() == R.id.scrollview_left && view.isFocused()){
            scrollViewRight.dispatchTouchEvent(motionEvent);
        }else if (view.getId() == R.id.scrollview_right && view.isFocused()){
            scrollViewLeft.dispatchTouchEvent(motionEvent);
        }

        return super.onTouchEvent(motionEvent);
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-17T07:25:33.687

```
ListAdapter listAdapter = listView.getAdapter();
int rows = listAdapter.getCount() / columns;
 int height = 60 * rows; // Insert the general cell height plus the dividers.
 ViewGroup.LayoutParams params = listView.getLayoutParams();
 params.height = height;
 listView.setLayoutParams(params);
 listView.requestLayout(); 
```

# sharepoint - 在 SharePoint 列表中表示父子关系

> ID：306639
> 
> 赞同：12
> 
> 时间：2008-11-20T19:58:36.797
> 
> 标签：sharepoint, list, parent-child, relationship

我需要在我们的 SharePoint 应用程序中创建一些功能，用一些简单的分层数据填充一个或多个列表。每个父记录将代表一个“提交”，每个子记录将是一个“提交项”。提交和提交项目之间存在 1 对 n 的关系。这在 SharePoint 中实用吗？到目前为止，我所做的唯一类型的列表关系是查找列，但这似乎有点不同。此外，一旦建立了这样的列表关系，那么在这种数据上创建视图的最佳方式是什么。我几乎确信将这些内容写入外部数据库会更容易，但我想试一试 SharePoint 以利用自动搜索功能。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T07:48:53.477

*如果不自己开发，Sharepoint 中的正确*父/子几乎是不可能的。这里有一种方法：[Simulate Parent / Child relationship in SharePoint 2007 with Folders & Content Types](http://medhatelmasry.blogspot.com/2007/10/simulate-parent-child-relationship-in.html)

（注意：这涉及 SharePoint 2007。在 2010 年，[联接使这变得更容易](http://www.zimmergren.net/archive/2010/01/04/sp-2010-list-joins-amp-spquery-enchancements.aspx)）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T20:16:04.763

在单独的数据库中执行此操作，创建一个页面，其中包含显示数据的控件并对其运行搜索。虽然失去了相当多的 SharePoint 功能。

否则，创建一个允许您在其他列表中查找数据的自定义字段控件可能没问题。自定义字段控件可以是“查看”相关数据的控件。我知道我们已经为同一列表上的页面之间的父子关系做了它。虽然不是一对一。

无论哪种方式都是艰难的选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T15:32:54.843

我的投票是“将这些东西写入外部数据库”

您在 Sharepoint 中遗漏了很多东西，例如事务支持、参照完整性、简单的更新方式（比较 SQL）、报告（使用 Reporting Services 和 SQL 数据库）……将 sharepoint 视为存储文档和简单列表的一种方式。 ……

Sharepoint 的论点是如果它是一个小型应用程序，对事务的支持没有要求，不需要导入外部数据等......

当人们说 Sharepoint 是一个开发平台时，需要定义他们认为开发平台是什么。

有关 Sharepoint 2010 的最新传言告诉我们，下一个版本将支持基于 SQL 服务器的列表......我认为这至少会使 Sharepoint 朝着正确的方向发展......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-10T17:45:34.740

看看 SLAM，SharePoint 列表关联管理器，这是我公司创建并积极支持的开源项目。SLAM 允许您将 SharePoint 数据同步到 SQL，包括列表之间的任何关系。SLAM 除了本身非常有用之外，它实际上是一个框架，旨在允许开发人员使用我们所谓的 SLAM 类型配置文件创建自己的复杂数据关联。我们有一个开箱即用的类型配置文件，它是开源项目的一部分，它实际上允许您使用嵌套集模型使 SharePoint 列表分层。有关更多信息，请参阅我们的 codeplex 网站上的[此页面。](http://slam.codeplex.com/Wiki/View.aspx?title=Hierarchy)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T22:04:48.140

使用连接的 Web 部件很容易做到。

创建两个列表：

父级（Id、Title） 子级（Id、Title、ParentId）

创建一个新的sharepoint页面，为Child添加DataFormWebPart（显示Parent）和另一个，将它们都设置为基于QueryString参数过滤（使用该参数过滤Parent.Id和Child.ParentId）瞧，您可以显示父- 孩子的关系。现在，添加孩子更加困难，这是我还没有解决的部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T20:57:58.173

我经常使用sharepoint，使用称为AAA（Activity，Assignment，Artifact）的框架，它允许您使用查找列将分配或工件链接到父Activity。然后，您使用连接的 Web 部件构建一个 Web 部件页面，允许您按活动过滤所有分配和工件。例如，单击提交 Web 部件中提交的旁边，将显示附加到该提交的所有提交项。效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T11:33:08.343

您可以使用的另一种方法是将 XML 与项目中的字段保持一致。这是 Podcasting Kit（在 CodePlex 上）用来存储评分等内容的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T13:02:00.677

一种可能的方法是创建基于文件夹内容类型的提交内容类型和基于项目内容类型的提交项目。然后，您可以像在文件系统中一样分层存储数据，并且还可以使用默认视图和搜索功能。

另一种方法是创建指向相同列表的查找字段（list=”self”）。该字段将用作对父项的引用，您将获得包含递归相关数据的列表。以编程方式使用这些数据是可以的，但使用视图功能会有点复杂。

# oop - 关于如何实现验证类的建议？

> ID：306641
> 
> 赞同：0
> 
> 时间：2008-11-20T19:59:11.880
> 
> 标签：oop, asp-classic

我正在经典 ASP 中实现一个验证类。验证类应该如何与我的其他类交互？

我当前的设置： User 类的 set 方法在验证类中调用适当的验证方法。发生的任何错误都存储在 User.mError 中。例如，这是我在 ASP Classic 中设置 Email 成员变量的方法：

```
Class User
  Property Let Email(EmailInput)
     If (myValidation.isEmail(EmailInput)) then
        mEmail = EmailInput
     Else
        mError = "Invalid Email Address format."
     End If 
```

我不喜欢每个调用我的验证类的对象都需要一个错误成员变量。关于更好设置的建议？

对于我应该作为基准审查的验证架构有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T03:31:12.937

您应该尝试 ajaxed 中使用的验证概念（这是经典 ASP 的 AJAX 库 - [www.webdevbros.net/ajaxed/](http://www.webdevbros.net/ajaxed/)）。不幸的是，验证器将在 2.0 版中正式发布，但它已经在[SVN](http://code.google.com/p/asp-ajaxed/source/browse/#svn/trunk/ajaxed/class_validator)中可用- 您可以在没有整个库（独立）的情况下轻松使用它

Ajaxed 有一个称为验证器的类，您可以使用它来验证您的业务对象。它需要创建一个 isValid() 方法，该方法将 Validator 作为参数并返回实例是否有效。isValid() 方法在保存实例之前被调用。如果有任何无效，它会执行所有验证并填充给定的验证器。

例子：

```
class User
    public firstname
    public lastname

    'validates the user instance
    '- call before save()
    public function isValid(byRef v)
        isValid = true
        if len(firstname) < 5 then
            v.add "firstname", "Firstname must be at least 5 chars long."
            isValid = false
        end if
        if len(lastname) < 5 then
            v.add "lastname", "Lastname must be at least 5 chars long."
            isValid = false
        end if
    end function

    public sub save()
        'do some DB stuff
    end sub
end class

'usage scenario 1 (simple - we just know if valid or not)
set u = new User
if u.isValid(new Validator) then
    u.save()
else
    response.write("User is invalid. some error happend")
end if

'usage scenario 2 (detailed - we have an error summary)
set u = new User
u.firstname = "Michal"
set v = new Validator
if u.isValid(v) then
    u.save()
else
    'the validator offers a helper to create a validation summary
    response.write(v.getErrorSummary("<div><ul>", "<ul/></div>", "<li>", "</li>"))
end if

'usage scenario 3 (we can even validator more users in one go)
set u1 = new User
set u2 = new User
set v = new Validator
u1.isValid(v)
u2.isValid(v)

if v then
    u1.save()
    u2.save()
else
    response.write("something is invalid")
end if 
```

我已经使用这种方法多年了，而且它非常灵活。您可以单独使用 Validator 类，但我建议您将 ajaxed 库作为一个整体使用。它让您开发 ASP 更加容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T20:50:20.577

我建议查看 .net 框架提供的 Validator 相关类。

在您的情况下，您可以有一个 Validator 类（具体来说是 EmailValidator），它可以有一个名为 Validate 的方法，它接受一个字符串，返回一个布尔值

您还可以将 ErrorMessage 作为 Validate 函数的参数之一传递，例如

```
 Psuedo Code.

class EmailValidator
...
function Validate(byval EmailAddress as string, optional byval Result as string) as boolean)
..
if (condition success)
result = success
elseif (emailafddress doesnt have @)
result = "invalid email address. missing @"
endif
end function
end class 

```

如果您想控制它，您可以删除错误消息。

我邀请其他人提出这方面的任何缺点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T20:59:27.437

[Spring](http://www.springframework.org/)有自己的验证器模式，用于验证复杂的对象并返回多个错误。[这里](http://static.springframework.org/spring/docs/1.2.x/reference/validation.html)有详细说明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T21:15:53.770

我已经用几种不同的方式编写了自己的 Validator 类。本质上的验证不一定需要实例化的对象，所以我创建了一个带有静态方法的类来进行验证。我使用了一种验证器方法，您必须在其中传递一个类型（例如电子邮件、名字、网站...），或者每个给定类型的多个方法。最后，我真的只需要一种算法，所以我选择了一种方法。本质上，有类属性来保存每种类型的验证正则表达式，以及给定类型的相关错误消息。这一切都等同于一个类似于下面的类：

```
class Validation
{

    // define the properties for dealing with different type validations
    public static $firstNamePattern = '/[-a-zA-Z0-9._ ]{2,}/';
    public static $lastNamePattern = '/[-a-zA-Z0-9._ ]{2,}/';
    // ... more fields

    public static function validateText($type, $text, $fieldName)
    {
        $pattern = $type."Pattern";
        if ($this->$pattern != '')
        {
            // perfom the validation
            // ...
            return true; // or false
        }
    }

    // other validation methods below
    // ...

} 
```

然后您可以从任何您需要的地方调用该方法（例如，在验证表单输入时）。

```
if (Validation->validateText('firstName', $formFirstName, 'First Name'))
{
    // validation passed
}
else
{
    // validation failed
} 
```

*我很抱歉上面是用 PHP 编写的，问题是关于 ASP 的，但你明白我的意思。*

# c# - 如何从 Proficy Historian 查询原始数据？

> ID：306642
> 
> 赞同：13
> 
> 时间：2008-11-20T19:59:20.587
> 
> 标签：c#, oledb, proficy, historian

如何从 Proficy Historian/iHistorian 中检索原始时间序列数据？

理想情况下，我会询问两个日期之间特定标签的数据。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-07-23T16:45:39.797

您可以尝试几种不同的采样模式。

*   生的
*   插值
*   实验室
*   趋势
*   计算出来的

这些模式可通过以下所有 API 使用。

*   用户 API (ihuapi.dll)
*   SDK (ihsdk.dll)
*   OLEDB (iholedb.dll)
*   客户端访问 API (Proficy.Historian.ClientAccess.API)

其中趋势采样模式可能是您想要的，因为它是专门为图表/趋势设计的。不过，lab 和 interpolated 也可能有用。

阅读电子书以获取有关每种采样模式的更多信息。在我的机器上它被存储为`C:\Program Files\GE Fanuc\Proficy Historian\Docs\iHistorian.chm`并且我安装了 3.5 版。请特别注意以下部分。

*   使用 Historian OLE DB 提供程序
*   高级主题 | 恢复

以下是构建 OLEDB 进行趋势采样的方法。

```
set 
    SamplingMode = 'Trend',
    StartTime = '2010-07-01 00:00:00',
    EndTime = '2010-07-02 00:00:00',
    IntervalMilliseconds = 1h
select 
    timestamp, 
    value, 
    quality 
from 
    ihRawData 
where 
    tagname = 'YOUR_TAG' 
```

使用用户 API 和 SDK 显示等效方法很复杂（使用用户 API 更是如此），因为它们需要在代码中进行大量的设置才能进行设置。客户端访问 API 较新，并在幕后使用 WCF。

顺便说一句，OLEDB 方法有一些限制。

*   尽管文档说我*从来*没有能够让本机查询参数工作。例如，如果您想将它与 SQL Server Reporting Services 一起使用，那将是一个很好的选择。
*   您不能将样本写入存档或以任何方式更改 Historian 配置，包括添加/更改标签、写入消息等。
*   在某些情况下，它可能会有点慢。
*   它没有规定将多个标记名交叉制表到列中，然后继续执行样本，以便每个时间戳和标记组合都存在一个值。趋势采样模式让您成功了一半，但仍然没有交叉表，也没有实际加载原始样本。然后用户 API 和 SDK 也不能这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T19:59:48.010

我的一个同事把这个放在一起：

在 web.config 中：

```
<add name="HistorianConnectionString" 
     providerName="ihOLEDB.iHistorian.1" 
     connectionString="
       Provider=ihOLEDB.iHistorian;
       User Id=;
       Password=;
       Data Source=localhost;"
/> 
```

在数据层：

```
public DataTable GetProficyData(string tagName, DateTime startDate, DateTime endDate)
{
    using (System.Data.OleDb.OleDbConnection cn = new System.Data.OleDb.OleDbConnection())
    {
        cn.ConnectionString = webConfig.ConnectionStrings.ConnectionStrings["HistorianConnectionString"];
        cn.Open();

        string queryString = string.Format(
                "set samplingmode = rawbytime\n select value as theValue,Timestamp from ihrawdata where tagname = '{0}' AND timestamp between '{1}' and '{2}' and value > 0 order by timestamp",
                tagName.Replace("'", "\""), startDate, endDate);

        System.Data.OleDb.OleDbDataAdapter adp = new System.Data.OleDb.OleDbDataAdapter(queryString, cn);
        DataSet ds = new DataSet();

        adp.Fill(ds);
        return ds.Tables[0];
    }
} 
```

* * *

**更新：**

这运作良好，但我们遇到了标签不经常更新的问题。如果标签在请求的 startDate 和 endDate 的开始或结束附近没有更新，则趋势看起来很糟糕。更糟糕的是，在请求的窗口期间仍然没有明确的点——我们不会得到任何数据。

我通过三个查询解决了这个问题：

1.  开始日期*之前*的上一个值
2.  startDate 和 endDate 之间的点
3.  endDate*之后*的下一个值

这是一种潜在的低效方法，但它有效：

```
public DataTable GetProficyData(string tagName, DateTime startDate, DateTime endDate)
{
    DataSet ds = new DataSet();
    string queryString;
    System.Data.OleDb.OleDbDataAdapter adp;

    using (System.Data.OleDb.OleDbConnection cn = new System.Data.OleDb.OleDbConnection())
    {
        cn.ConnectionString = proficyConn.ConnectionString;
        cn.Open();

        // always get a start value
        queryString = string.Format(
             "set samplingmode = lab\nselect value as theValue,Timestamp from ihrawdata where tagname = '{0}' AND timestamp between '{1}' and '{2}' order by timestamp",
            tagName.Replace("'", "\""), startDate.AddMinutes(-1), startDate);
        adp = new System.Data.OleDb.OleDbDataAdapter(queryString, cn);
        adp.Fill(ds);

        // get the range
        queryString = string.Format(
             "set samplingmode = rawbytime\nselect value as theValue,Timestamp from ihrawdata where tagname = '{0}' AND timestamp between '{1}' and '{2}' order by timestamp",
            tagName.Replace("'", "\""), startDate, endDate);
        adp = new System.Data.OleDb.OleDbDataAdapter(queryString, cn);
        adp.Fill(ds);

        // always get an end value
        queryString = string.Format(
             "set samplingmode = lab\nselect value as theValue,Timestamp from ihrawdata where tagname = '{0}' AND timestamp between '{1}' and '{2}' order by timestamp",
        tagName.Replace("'", "\""), endDate.AddMinutes(-1), endDate);
        adp = new System.Data.OleDb.OleDbDataAdapter(queryString, cn);
        adp.Fill(ds);

        return ds.Tables[0];
    }
} 
```

是的，我知道，这些查询应该被参数化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-01T02:46:26.377

Michael——在 IP21 中有一个“插值”表，以及“实际”数据点表。Proficy也有吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-25T03:19:18.577

我们编写了一个如下所示的包装 DLL：

```
[DllImport("IHUAPI.dll", CallingConvention = CallingConvention.StdCall, EntryPoint = "ihuReadRawDataByTime@24")]
public static extern int ihuReadRawDataByTime(int serverhandle, string tagname, ref IHU_TIMESTAMP startTime, ref IHU_TIMESTAMP endTime, ref int noOfSamples, ref IHU_DATA_SAMPLE* dataValues);
...
private int _handle;

public HistorianTypes.ErrorCode ReadRawByTime(string tagName, DateTime startTime, DateTime endTime,
                                              out double[] timeStamps, out double[] values, out IhuComment [] comments)
{
    var startTimeStruct = new IhuApi.IHU_TIMESTAMP();  //Custom datetime to epoch extension method
    var endTimeStruct = new IhuApi.IHU_TIMESTAMP();

    int lRet = 0;
    int noOfSamples = 0;
    startTimeStruct = DateTimeToTimeStruct(dstZone.ToUniversalTime(startTime));
    endTimeStruct = DateTimeToTimeStruct(dstZone.ToUniversalTime(endTime));
    IhuApi.IHU_DATA_SAMPLE* dataSample = (IhuApi.IHU_DATA_SAMPLE*)new IntPtr(0);

    try {
        lRet = IhuApi.ihuReadRawDataByTime
            (
                _handle, // the handle returned from the connect
                tagName, // the single tagname to retrieve
                ref startTimeStruct, // start time for query
                ref endTimeStruct, // end time for query
                ref noOfSamples, // will be set by API
                ref dataSample // will be allocated and populated in the user API
            );
            .... 
```

一些注意事项是，iFIX 将检查 DLL 是否在启动时加载，因此您需要执行动态加载/卸载 DLL 等操作，以免其他应用程序崩溃。我们通过动态删除/添加注册表项来做到这一点。

另一种情况是，如果您轮询 10,000 个样本并且其中 1 个样本已损坏，它将丢弃所有 10,000 个样本。您需要实现一个不良数据处理程序，该处理程序将从不良数据的任一侧开始并逐步递增以获取不良样本任一侧的所有数据。

有几个 C 头文件包含所有错误代码和 DLL 的函数头。

# asp.net - 在代码中编写查询与 SqlDataSource

> ID：306644
> 
> 赞同：4
> 
> 时间：2008-11-20T19:59:35.313
> 
> 标签：asp.net, sql

我一直认为在后面的代码中编写 SQL 查询与使用 SqlDataSource 编写相比并不好

```
SqlDataAdapter ad = new SqlDataAdapter("SELECT * FROM Categories", myConnection);

DataSet ds = new DataSet();

ad.Fill(ds, "Categories");

myGridView.DataSource = ds;

myGridView.DataBind(); 
```

对比

```
<asp:SqlDataSource ID="SqlDataSource1" runat="server"
  ConnectionString="<%$ ConnectionStrings:myConnection %>"
  SelectCommand="SELECT * FROM Categories" /> 
```

我觉得使用SqlDataSource 是安全的，易于维护。我的担心是真的吗？请辩解。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-20T20:03:18.207

我不会在句号后面的代码中编写 SQL 查询。数据访问层怎么样？

如果你想改变你的后备存储会发生什么？您将不得不重新编写所有代码隐藏。

如果您需要在多个地方使用数据，会发生什么情况？你重复代码。

在后面的代码中编写 SQL 查询之前，您需要认真考虑如何构建解决方案。在质疑 SqlDataSource 对象的“安全性”之前，请考虑分离和可维护性。严重地。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-20T20:14:53.067

代码隐藏中的 SQL 查询和 SqlDataSource 中的 SQL 查询几乎是等价的。

他们在安全方面都差不多；至于更容易维护，SqlDataSource 在大多数情况下可能会更容易一些。

首选数据访问层，但 SqlDataSource 有时是一种足够好的权宜之计。如果你还没有数据访问层，我不会用卷起的报纸来打击你，因为它是简单的/一次性的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T20:23:08.697

您的任何一种方法都不比另一种更安全。由于您的 aspx 页面的编译方式与页面背后的代码一样，因此您不会冒着仅使用 SqlDataSources 意外暴露 SQL 语句或数据库结构的风险。但是，安全性不是您的主要问题——它是可维护性。

当 Microsoft 将 SqlDataSources 作为 .NET 2.0 的一部分发布时，很多人抱怨：我们认为它鼓励并强化了坏习惯。

对于大于单个 Intranet 页面的任何类型的项目，您都应该查看其表现良好的老大哥[ObjectDataSource](http://msdn.microsoft.com/en-us/library/9a4kyhcx.aspx)。在使用 ODS 时，您几乎受限于为您的数据开发一个单独的模型，远离您的视图。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T20:22:16.653

以我的经验，SQLDataSource 非常适合用于快速显示数据并可能对其进行编辑的一次性页面。但是一旦你进入任何一种复杂的场景（我总是这样），它很快就会崩溃。在后面的代码中同时使用 SQLDataSource 和直接 SQL 的可维护性是一场噩梦。我被 SQLDataSource 烧了很多次。

我至少会写一个数据访问层作为一个单独的程序集，你可以调用它。如果需要，这将为您提供一种可插入的方式来更改它。更好的是诸如 NHibernate 或 LinqToSql 之类的数据访问解决方案，它为您处理管道并防止您必须自己编写整个事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-12T00:33:40.870

aspx 或 aspx.cs 中的 SQL 都是非常新手、不好的方法。查找 n 层/n 层设计、关注点分离和任何有关软件设计的书籍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-15T17:33:51.823

DataSource 控件非常适合大多数事情。它们支持网格中的分页和服务器端缓存，并且可以节省访问数据库的次数。然而，一个缺点是，如果您使用 db 事务做任何复杂的事情，您将无法跨多个 sqldatasource 使用事务，至少不容易。

由于池化，两个数据源可能有不同的连接，并且在命令执行之前没有简单的方法来分配事务对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-25T12:25:58.637

我使用 SQLDataSources 来填充网格，需要一个简单的查询。使用存储过程而不是将查询直接放在 SQLDataSource 中解决了可重用性问题。Telerik 控件中的示例广泛使用数据源，但这可能是由于需要简单性而不是现实世界的限制。我遇到的另一个用途是放置在客户端的每个站点上的一个页面上，它并不特别关注安全性，它使工作人员能够即时执行 sql。它包含一个简单的 SQL 查询——打开页面是检查数据库是否可访问的一种简单方法。

# asp.net - ASP.NET 应用程序通过 Windows 身份验证或表单身份验证对 Active Directory 或 SQL 进行身份验证

> ID：306652
> 
> 赞同：14
> 
> 时间：2008-11-20T20:02:50.330
> 
> 标签：asp.net, sql, active-directory, asp.net-membership, membership

我正在编写一个需要多种形式的身份验证的应用程序。

应用程序需要支持对 Active Directory 的身份验证，但如果用户不在 Active Directory 中，则能够故障回复到 SQL 成员资格提供程序。我们可以根据提供的用户名在代码中处理 SQL Provider 的失败，因为用户名的格式与 Active Directory 用户名的格式不同。

这甚至可能吗？我的意思是，我可以使用会员资格并同时使用 ActiveDirectoryMembershipProvider 和 SqlMembershipProvider 还是我必须自己推出？

另一个额外增加的复杂性是，我想根据 Windows 身份验证自动将我的内部用户身份验证回 AD，但对不在我们内部网络上的用户或使用 SQL 提供程序的用户使用表单身份验证。

这些很可能是单独的服务器，一个是内部的，另一个是外部的，所以我有很多计划要做来弄清楚数据复制，以及如果 AD 用户访问外部服务器等，我将如何对其进行身份验证。

当我开始走这条路时，我想知道那里有什么想法。如果我不自己动手，我想做的事情甚至可能吗，或者有没有办法将它们融合在一起？

* * *

谢谢回复。

我最初问的原因是因为我能够在大约 7 年前使用 IIS 进行身份验证，然后将凭据传递回 Lotus Domino 服务器 Web 应用程序，从而使这个特定的 senerio 工作。如果用户未通过 Windows 身份验证/ISS 进行身份验证，则 Domino 将处理身份验证。这就是我在这里想要做的，但真的想不出一种让它在 IIS 中工作的方法。

至于您的其余答复，我认为您正在走我需要采取的方式。我已经考虑过这一点，并在我的脑海中反复折腾。无论如何，两台服务器上的应用程序都会有所不同，因为无论如何访问外部服务器上的数据都会受到限制。事实上已经有很多不同了，我可能只是将它们视为两个应用程序，因此不需要在同一个应用程序中使用两种类型的身份验证。

我正在考虑为外部服务器编写自己的身份验证/登录窗口的想法，如果用户尝试在外部服务器上使用他们的 AD 凭据登录，我将能够检测到并将它们重定向到内部服务器。如果他们不在本地网络或 VPN 中，他们将根本无法访问。这部分仍然有一些思考过程，所以我不确定。

作为一个额外的想法 - 有没有办法将足够的 AD 提取到 SQL 数据库中，以允许我使用他们的 AD 凭据从外部服务器对 SQL 数据库的用户进行身份验证，而不会产生任何安全问题？我希望我清楚地输入我的想法......

再次感谢！

蒂姆

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T22:39:44.647

这是我根据[此信息](http://beensoft.blogspot.com/2008/06/mixing-forms-and-windows-authentication.html)处理类似情况的方式：

1.  将应用程序配置为使用表单身份验证。
2.  将 LoginUrl 设置为名为 WinLogin.aspx 的页面。
3.  在 WinLogin.aspx 中，使用 Request.ServerVariables["LOGON_USER"] 获取用户名，然后调用 FormsAuthentication.RedirectFromLoginPage(authorizedUserName, false) 登录。我想您也可以手动检查 Active Directory。
4.  创建一个重定向到名为 Login.aspx 的页面的 html 页面
5.  Login.aspx 是您的标准用户名/密码登录。
6.  在 IIS 中，在整个站点上启用集成身份验证和匿名，但拒绝对 WinLogin.aspx 的匿名访问。
7.  在 IIS 中，将 401 错误设置为在步骤 3 中创建的页面。

基本上发生的情况是，当未经身份验证的用户访问该站点时，他们会被重定向到 WinLogin.aspx。由于匿名已关闭，因此集成安全性会进行检查。如果通过，您在 WinLogin 中的自定义代码可以运行。如果集成安全检查失败，则会出现 401 错误。您的自定义 401 页面重定向到 Login.aspx，用户可以在其中使用 SQL 提供程序的用户名和密码登录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T19:28:35.313

据我所知，Web 应用程序配置为使用 Windows 身份验证或表单身份验证，但不能同时使用两者。因此，我认为在要求其他人输入用户名/密码的同时自动验证内部用户身份是不可能的。

您可以使用自定义提供程序通过表单身份验证对 Active Directory 或 SQL 用户存储进行身份验证。但是，AD 用户仍然需要输入他们的用户名和密码。尽管我从未将这两种方法结合使用，但我已经使用 Forms 身份验证一次或多次针对这两种来源进行身份验证。

话虽如此，我认为您可能需要考虑降低系统的“灵活性”。如果您有一个面向外部的服务器和一个面向内部的服务器，您可以简单地更改应用程序的每个副本上的提供程序配置以针对不同的源。然后，您可以将内部配置为使用 Windows（自动）身份验证，将外部配置配置为使用 Forms 身份验证。

恕我直言，我相信内部用户不应该使用外部服务器来访问应用程序。如果是，他们应该有一个存储在 SQL 中的用户帐户，与他们的 AD 帐户完全分开。基本上，当有人从外部访问应用程序时，他们充当的是外部用户，无论他们的物理位置如何。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-23T12:23:20.273

好吧，可以使用 ActiveDirectoryMembershipProvider 和 SqlMembershipProvider，但这需要您使用自己的代码而不是登录控件来设计登录页面。

关于混合身份验证（Windows 和窗体），据我所知，只有 IIS 7 使它变得简单和干净。有关详细信息，请参阅此帖子，

[http://mvolo.com/blogs/serverside/archive/2008/02/11/IIS-7.0-Two_2D00_Level-Authentication-with-Forms-Authentication-and-Windows-Authentication.aspx](http://mvolo.com/blogs/serverside/archive/2008/02/11/IIS-7.0-Two_2D00_Level-Authentication-with-Forms-Authentication-and-Windows-Authentication.aspx)

# asp.net - 参数真的足以防止 Sql 注入吗？

> ID：306668
> 
> 赞同：85
> 
> 时间：2008-11-20T20:06:43.940
> 
> 标签：asp.net, sql, database, sql-injection

我一直在向我的同事和这里宣讲在 SQL 查询中使用参数的好处，尤其是在 .NET 应用程序中。我什至承诺他们会提供对 SQL 注入攻击的免疫力。

但我开始怀疑这是否真的是真的。是否有任何已知的 SQL 注入攻击可以成功针对参数化查询？例如，您可以发送一个导致服务器缓冲区溢出的字符串吗？

当然，还有其他考虑因素可以确保 Web 应用程序是安全的（比如清理用户输入和所有这些东西），但现在我正在考虑 SQL 注入。我对针对 MsSQL 2005 和 2008 的攻击特别感兴趣，因为它们是我的主数据库，但所有数据库都很有趣。

编辑：澄清我所说的参数和参数化查询的意思。通过使用参数，我的意思是使用“变量”而不是在字符串中构建 sql 查询。
所以不要这样做：

```
SELECT * FROM Table WHERE Name = 'a name' 
```

我们这样做：

```
SELECT * FROM Table WHERE Name = @Name 
```

然后在查询/命令对象上设置@Name 参数的值。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-20T20:09:16.103

**占位符**足以防止注射。您可能仍然对缓冲区溢出持开放态度，但这是与 SQL 注入完全不同的攻击方式（攻击向量不是 SQL 语法，而是二进制）。由于传递的参数都将被正确转义，因此攻击者无法传递将被视为“实时”SQL 的数据。

您不能在占位符中使用函数，也不能将占位符用作列名或表名，因为它们被转义并引用为字符串文字。

但是，如果您在动态查询中使用**参数**作为**字符串连接**的一部分，您仍然容易受到注入的影响，因为您的字符串不会被转义，而是文字。使用其他类型的参数（例如整数）是安全的。

也就是说，如果您使用 use 输入来设置类似 的值`security_level`，那么有人可以让自己成为您系统中的管理员，并且可以免费使用。但这只是基本的输入验证，与 SQL 注入无关。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-20T20:48:58.490

不，当您将未经验证的数据插入 SQL 查询时，仍然存在 SQL 注入的风险。

查询参数通过将文字值与 SQL 语法分开来帮助避免这种风险。

```
'SELECT * FROM mytable WHERE colname = ?' 
```

这很好，但是将数据插入到不能使用查询参数的动态 SQL 查询中还有其他用途，因为它不是 SQL 值，而是表名、列名、表达式或其他一些语法。

```
'SELECT * FROM ' + @tablename + ' WHERE colname IN (' + @comma_list + ')'
' ORDER BY ' + @colname' 
```

无论您是使用存储过程还是直接从应用程序代码执行动态 SQL 查询，都没有关系。风险依然存在。

在这些情况下，补救措施是根据需要使用**FIEO**：

*   **过滤输入：**在插入数据之前验证数据看起来像合法的整数、表名、列名等。

*   **转义输出：**在这种情况下，“输出”意味着将数据放入 SQL 查询中。我们使用函数来转换在 SQL 表达式中用作字符串文字的变量，以便对字符串中的引号和其他特殊字符进行转义。我们还应该使用函数来转换将用作表名、列名等的变量。至于其他语法，例如动态编写整个 SQL 表达式，这是一个更复杂的问题。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-20T21:49:32.720

这个线程似乎对“参数化查询”的定义有些混淆。

*   SQL，例如接受参数的存储过程。
*   使用 DBMS 参数集合调用的 SQL。

鉴于前一个定义，许多链接显示有效的攻击。

但“正常”的定义是后一种。鉴于该定义，我不知道任何有效的 SQL 注入攻击。这并不意味着没有，但我还没有看到它。

从评论中，我表达得不够清楚，所以这里有一个希望更清楚的例子：

这种方法**对**SQL 注入开放

```
exec dbo.MyStoredProc 'DodgyText' 
```

这种方法**不对**SQL 注入开放

```
using (SqlCommand cmd = new SqlCommand("dbo.MyStoredProc", testConnection))
{
    cmd.CommandType = CommandType.StoredProcedure;
    SqlParameter newParam = new SqlParameter(paramName, SqlDbType.Varchar);
    newParam.Value = "DodgyText";
    .....
    cmd.Parameters.Add(newParam);
    .....
    cmd.ExecuteNonQuery();
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-20T20:09:25.743

任何用于构造动态查询的字符串类型（varchar、nvarchar 等）的 sql 参数仍然容易受到攻击

否则参数类型转换（例如到 int、decimal、date 等）应该消除通过参数注入 sql 的任何尝试

编辑：一个例子，其中参数@p1 是一个表名

```
create procedure dbo.uspBeAfraidBeVeryAfraid ( @p1 varchar(64) ) 
AS
    SET NOCOUNT ON
    declare @sql varchar(512)
    set @sql = 'select * from ' + @p1
    exec(@sql)
GO 
```

如果从下拉列表中选择@p1，则它是潜在的 sql 注入攻击向量；

如果@p1 以编程方式制定而没有用户干预的能力，那么它不是潜在的 sql 注入攻击向量

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-20T20:10:14.260

缓冲区溢出不是 SQL 注入。

参数化查询保证您可以安全地抵御 SQL 注入。他们不保证您的 SQL 服务器中不存在漏洞形式的漏洞，但没有任何东西可以保证这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-20T20:28:31.620

如果您以任何形式或形式使用动态 sql，您的数据是不安全的，因为权限必须在表级别。是的，您已经限制了来自该特定查询的注入攻击的类型和数量，但不限制用户在找到进入系统的方法时可以获得的访问权限，并且您完全可以让内部用户访问他们不应该访问的内容以进行欺诈或窃取个人信息进行出售。任何类型的动态 SQL 都是危险的做法。如果您使用非动态存储过程，您可以在过程级别设置权限，除了过程定义的内容（当然系统管理员除外）之外，没有用户可以做任何事情。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-20T20:15:15.577

存储过程可能会通过溢出/截断容易受到特殊类型的 SQL 注入的影响，请参阅：此处的数据截断启用注入：

[http://msdn.microsoft.com/en-us/library/ms161953.aspx](http://msdn.microsoft.com/en-us/library/ms161953.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-22T00:32:49.860

请记住，使用参数您可以轻松存储字符串，或者如果您没有任何策略，则说用户名，"); drop table users; --"

这本身不会造成任何伤害，但您最好知道该日期在您的应用程序中进一步使用的位置和方式（例如，存储在 cookie 中，稍后检索以执行其他操作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-12T14:47:07.523

您可以运行动态 sql 作为示例

```
DECLARE @SQL NVARCHAR(4000);
DECLARE @ParameterDefinition NVARCHAR(4000);

SELECT  @ParameterDefinition = '@date varchar(10)'

SET @SQL='Select CAST(@date AS DATETIME) Date'

EXEC sp_executeSQL @SQL,@ParameterDefinition,@date='04/15/2011' 
```

# python - 从 xml 创建 python 对象表示的模块

> ID：306671
> 
> 赞同：8
> 
> 时间：2008-11-20T20:07:54.640
> 
> 标签：python, xml, pickle

我正在寻找一个易于处理的 python 本机模块来从 xml 创建 python 对象表示。

我通过谷歌找到了几个模块（其中一个是[XMLObject](http://freenet.mcnabhosting.com/python/xmlobject/)），但不想全部尝试。

你认为做这些事情的最好方法是什么？

**编辑：**我没有提到我想阅读的 XML 不是由我生成的。这是一个现有的 XML 文件，其结构我无法控制。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-20T22:40:50.370

您说您想要一个*对象*表示，我将其解释为节点成为对象，并且节点的属性和子节点表示为对象的属性（可能根据某些模式）。我相信这就是 XMLObject 所做的。

我知道有一些软件包。 [4Suite](https://pypi.python.org/pypi/4Suite-XML/1.0.2)包含一些执行此操作的工具，我相信[Amara](http://xml3k.org/Amara)专门实现了这一点（构建在 4Suite 之上）。您还可以使用受 Amara 和[gnosis.xml.objectify启发的](http://gnosis.cx/download/)[lxml.objectify](http://lxml.de/objectify.html)。

当然，第三种选择是，给定 XML 的具体表示（使用 ElementTree 或 lxml），您可以围绕它构建自己的自定义模型。 [lxml.html](http://lxml.de/lxmlhtml.html)就是一个例子，它用一些 HTML 特定的功能扩展了 lxml 的基本接口。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-20T20:22:11.477

我支持 xml.etree.ElementTree 的建议，主要是因为它现在在标准库中。还有一个更快的实现，xml.etree.cElementTree 也可用。

如果你真的需要性能，我会建议 lxml

[http://www.ibm.com/developerworks//xml/library/x-hiperfparse/](http://www.ibm.com/developerworks//xml/library/x-hiperfparse/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T20:12:08.843

我听说最简单的是[ElementTree](http://docs.python.org/library/xml.etree.elementtree.html)，虽然我很少使用 XML 并且我不能从经验中说任何话。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-09-02T23:03:20.820

还有用于 Python 的优秀的 3rd 方库[pyxser](http://coder.cl/products/pyxser/)。

> pyxser 代表 Python XML 序列化，是 XML 序列化器和反序列化器的 Python 对象。换句话说，它可以将 Python 对象转换为 XML，也可以将该 XML 转换回原始 Python 对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T20:43:35.630

Python 具有用于 Python 对象序列化的 pickle 和 cPickle 模块。这两个模块都提供了序列化/反序列化 Python 对象层次结构以转换为字节流/从字节流转换的功能：

*   [https://docs.python.org/library/pickle.html](https://docs.python.org/library/pickle.html)

以下提供了类似的接口：pickle()、unpickle() 用于序列化到/从 XML

*   [http://code.activestate.com/recipes/355487/](http://code.activestate.com/recipes/355487/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T22:09:16.987

我使用（和喜欢）PyRXP，它创建了一个从 XML 文档构建的元组。

直接 XML -> python 对象结构的主要问题是属性列表没有 python 模拟 - 即带有元素的列表，它也恰好具有属性。如果您愿意，它既是列表又是字典。

我从 PyRXP 解析结果，并根据结构创建列表/字典——我正在处理的 XML 要么是基于列表的，要么是基于属性的，而不是两者兼而有之。（我正在使用来自已知来源的数据）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-08-15T18:34:20.363

Wai Yip Tung 的 xml2obj 函数在这里可用，我很幸运：

[http://code.activestate.com/recipes/534109-xml-to-python-data-structure/](http://code.activestate.com/recipes/534109-xml-to-python-data-structure/)

这是大约 84 行代码。它是原生的纯python；使用 xml.sax 和 re（正则表达式）库。您只需传递 XML 并取回您的对象。

# asp.net - asp.net帮助资源位置

> ID：306672
> 
> 赞同：0
> 
> 时间：2008-11-20T20:07:58.603
> 
> 标签：asp.net, xml, resources, web-config

我有一个相对简单的网站，我正在为 Intranet 环境工作。当用户单击页面上的链接时，页面有一个钩子来显示一些简单的文本（可能带有一些 HTML 用于标记目的）以获得帮助。我正在争论是将帮助片段放在他们自己的 XML 文件中还是在`web.config`. 该站点将部署在多个客户端站点上，并且鉴于更新 web.config 文件似乎会重新启动站点，我倾向于将其放在自己的文件中。我的问题是在哪里找到它的最佳位置？我宁愿它不容易通过网络访问，所以尽管根目录或某些文件夹是一个选项，但我想知道这样的文件是否有一个更“标准”的位置，`App_LocalResources`也许？欢迎任何反馈。谢谢。

* * *

我会看看这些选项。我预计帮助文件/资源​​不会有很多更新，但我认为随着网站功能的扩展，这当然是可能的。我喜欢它类似于 XML 或至少在文本编辑器中可编辑的想法，因此更新不一定需要 VS 来更新文件。谢谢大家！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:14:05.143

听起来像是 App_GlobalResources 文件夹中 resx（资源）文件的完美候选者。这些很容易编辑并发布到网站，无需重新启动。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T20:12:46.707

使用嵌入式资源怎么样？有几个关于如何使用嵌入式资源并将其打包到 dll 中以与您的网站一起分发的教程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T20:13:08.967

在我的项目中，我尽可能将 Web 应用程序连接到在线帮助 wiki。

.aspx 页面名称用作帮助页面标题。进入 wiki 后，您可以自由使用所有 wiki 技巧，例如重定向和链接

有关技术信息，请参阅我的[博客条目](http://devio.wordpress.com/2008/04/28/online-help-for-web-applications/)。

# xml - 有没有类似的东西 ?

> ID：306678
> 
> 赞同：0
> 
> 时间：2008-11-20T20:09:29.833
> 
> 标签：xml, ajax, xslt, params

**如果我将此请求发送到页面：**

```
http://www.server.com/show.xml?color=red&number=two 
```

**我可以做这样的事情吗？：**

```
I like the color <xsl:url-param name="color" /> and the number <xsl:url-param name="number" />. 
```

* * *

如果您需要澄清问题，请让我知道

感谢您的任何答案，

*克雷拉德*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:53:11.937

不; 通常，XSL 引擎不绑定到 Web 服务器。

但是，大多数 XSL 引擎允许您将一些参数与样式表和文档一起传递，因此如果您从支持 Web 的系统调用它，您可以将 GET 参数直接映射到您的 XSL 引擎*。*

例如，如果您使用的是 PHP，您可以执行以下操作：

```
<?php

$params = array(
    'color' => $_GET['color'],
    'number' => $_GET['number']
);

$xsl = new DOMDocument;
$xsl->load('mystylesheet.xsl');

$xml = new DOMDocument;
$xml->load('mydocument.xml');

$proc = new XSLTProcessor;
$proc->importStyleSheet($xsl); // attach the xsl rules

foreach ($params as $key => $val)
    $proc->setParameter('', $key, $val);

echo $proc->transformToXML($xml); 
```

您必须确保对通过的任何东西进行消毒。然后，您可以简单地执行以下操作：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet 
  version="1.0" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!-- Remember to pick-up the parameters from the engine -->
  <xsl:param name="color" />
  <xsl:param name="number" />
  <xsl:template match="*">
    I like the color <xsl:value-of select="$color" /> 
    and the number <xsl:value-of select="$number" />.
  </xsl:template>
</xsl:stylesheet> 
```

# c# - WPF 富文本框问题

> ID：306679
> 
> 赞同：6
> 
> 时间：2008-11-20T20:09:31.720
> 
> 标签：c#, wpf, richtextbox

如果一行文本被换行到另一行，我如何以编程方式确定字符串中被破坏的点。

示例：输入字符串 =“这是对换行文本的测试”。

```
 Based on the width of the richTextBox it could display:

            This is a test of a wrapped line of
            text. 
```

我需要确定的是被包装的单词行中的偏移量。在上述情况下，单词“文本”。

当我从richTextBox 中提取Xaml 时，我得到了解包的原始文本。

谢谢，

鲍勃·克林格

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-24T00:29:24.893

我发现的技巧使用 TextPointer 类及其 GetCharacterRec 方法。

RichTextBox 包含一个 FlowDocument。流文档中的文本包含在 Run 对象中（有点简化，但它有效）。代码在第一次运行开始时找到 TextPointer。然后它获取第一个字符的边界矩形。接下来，代码一次前进一个字符，获取一个新的边界矩形，并检查新矩形的底部是否与原始矩形不同。如果底部不同，那么我们就在新的一行。然后 TextPointer 可以在中断之前或之后获取文本。

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
    }

    private void inspect(object sender, RoutedEventArgs e)
    {
        TextPointer pointer = FindRun(inBox.Document);

        string textAfterBreak = FindBreak(pointer);

        outBox.Text = textAfterBreak;
    }

    private string FindBreak(TextPointer pointer)
    {
        Rect rectAtStart = pointer.GetCharacterRect(LogicalDirection.Forward);

        pointer = pointer.GetNextInsertionPosition(LogicalDirection.Forward);
        Rect currentRect = pointer.GetCharacterRect(LogicalDirection.Forward);

        while (currentRect.Bottom == rectAtStart.Bottom)
        {
            pointer = pointer.GetNextInsertionPosition(LogicalDirection.Forward);
            currentRect = pointer.GetCharacterRect(LogicalDirection.Forward);
        }

        string textBeforeBreak = pointer.GetTextInRun(LogicalDirection.Backward);
        string textAfterBreak = pointer.GetTextInRun(LogicalDirection.Forward);

        return textAfterBreak;
    }

    private TextPointer FindRun(FlowDocument document)
    {
        TextPointer position = document.ContentStart;

        while (position != null)
        {
            if (position.Parent is Run)
                break;

            position = position.GetNextContextPosition(LogicalDirection.Forward);
        }

        return position;
    }
}

<Window x:Class="LineBreaker.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition></RowDefinition>
            <RowDefinition></RowDefinition>
            <RowDefinition></RowDefinition>
        </Grid.RowDefinitions>
        <RichTextBox Grid.Row="0" Name="inBox">
        </RichTextBox>
        <Button Grid.Row="1" Click="inspect">Find Break</Button>
        <TextBox Name="outBox" Grid.Row="2"/>
    </Grid>
</Window> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T02:50:32.613

[http://msdn.microsoft.com/en-us/library/system.windows.documents.textpointer.getlinestartposition.aspx](http://msdn.microsoft.com/en-us/library/system.windows.documents.textpointer.getlinestartposition.aspx)

```
TextPointer startOfFirstLine = richTextBox.Document.ContentStart;
TextPointer startOfNextLine = startOfFirstLine.GetLineStartPosition(1);
if(startOfNextLine != null)
{
     // At this point what you do with the TextPointer depends on what you define as the position of text.
     // If you want to find out how many characters are on the first line ...
    int firstLineCharacterCount = new TextRange(startOfFirstLine, startOfNextLine).Text.Length;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T05:28:12.660

但`startOfFirstLine.GetLineStartPosition(1)`返回**null**

# msmq - 如果目标队列不存在，MSMQ 会丢弃消息吗？

> ID：306684
> 
> 赞同：4
> 
> 时间：2008-11-20T20:10:32.950
> 
> 标签：msmq

我遇到了一个奇怪的情况：

消息从 ServerA 发送到 ServerB。它进入 ServerA 的传出队列，然后发送到 ServerB 的队列。

服务器 B 崩溃。我们不得不重新格式化。当我们提出它时，我们忘记了安装 MSMQ 服务。

消息开始在 ServerA 的传出队列中堆积，直到发送消息的程序抛出资源不足异常。

我们注意到错误并将 MSMQ 服务安装到 ServerB 上。ServerA 开始立即清空其传出队列。

当我们启动程序处理 ServerB 上的消息时，它无法连接。我们了解到我们忘记在 ServerB 上创建队列。然而，此时，为时已晚。位于 ServerA 队列中的所有 900K 消息都已发送到 ServerB。据我所知，ServerB 把它们扔掉了，因为它没有配置目标队列。我已经知道正确的解决方案是停止 ServerA 上的队列，直到我们完全设置了 ServerB。

问题是：这真的是我们应该期待的 MSMQ 的真实行为吗？我本以为更防御性的设计方法是让 ServerB 拒绝消息，而不是接受并丢弃它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T16:23:53.147

当打开队列向远程计算机发送消息时（当 dwAccess 设置为 时`MQ_SEND_ACCESS`），消息队列不检查队列是否存在。

从 MSMQ 文档：

[http://msdn2.microsoft.com/en-us/library/ms699817.aspx](http://msdn2.microsoft.com/en-us/library/ms699817.aspx)

原因似乎是 MSMQ 旨在用作异步传输，因此发送方发送，然后在此过程中可能会发生许多不同的事情，导致消息无法传递。看起来唯一确定的方法是寻找返回的否定确认消息。我们从未使用过这些。您要么开始使用它们，要么尽量不进行远程发送。

[Usenet线程讨论这个。](http://groups.google.com/group/microsoft.public.msmq.programming/browse_thread/thread/4b6fd472717dd379/9072a2ac55f2cec5?lnk=st&q=Message+Queuing+does+not+check+for+the+existence+of+the+queue.+#9072a2ac55f2cec5)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T01:03:53.483

这在很大程度上取决于您使用的队列类型以及您要求 MSMQ 对消息采取的保证。请记住，MSMQ 中的消息具有在消息传输过程中可能过期的生存时间（甚至是读取时间限制）。

根据您配置发件人的方式，无法传递的消息可能已进入死信队列，因此我肯定会在两台服务器上检查以查看那里的内容。

如果您想更好地处理这种情况，您可以要求 MSMQ 做更多事情。例如，您可以要求它在日志队列中保留已发送消息的副本（然后根据需要自己将其排出）。或者，您可以要求它对消息传递甚至读取消息的肯定或否定 ACK。在这些情况下，ACK/NACK 将发送到您选择的管理队列，您自己的应用程序可以监控和响应该队列。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-17T16:01:56.600

我们有类似的行为，消息消失。我注意到，如果“UseDeadLetterQueue”设置为 true，至少当传输失败时，它会在源系统的死信队列中保留一份副本。

例子：

```
var message = new System.Messaging.Message();
message.UseDeadLetterQueue = true; 
```

# css - a:hover 标记中的 css 溢出

> ID：306697
> 
> 赞同：0
> 
> 时间：2008-11-20T20:13:30.027
> 
> 标签：css, cross-browser

我有一个图像（地图），其中一些兴趣点使用 position: absolute 和每个 poi 的坐标放置。我希望它使用以下方法在鼠标悬停时扩展每个 POI 的信息：

```
.poi a {
    width: 32px;
    height: 32px;
    overflow: hidden
}

.poi a:hover {
    width: 128px;
    height: 192px;
    overflow: auto
} 
```

这在 IE 中运行良好，但在 Firefox 或 chrome 中不起作用。它没有裁剪溢出，它只是一次显示所有信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T20:27:32.057

使它们成为块或内联块元素，因为（从上面的片段中）链接是内联的，不会溢出。

```
.poi a {
    width: 32px; 
    height: 32px; 
    overflow: hidden;
    display: block;
} 
```

# cryptography - 有没有办法使用 CryptoAPI 创建私钥并为其播种？

> ID：306703
> 
> 赞同：1
> 
> 时间：2008-11-20T20:15:38.883
> 
> 标签：cryptography, cryptoapi

我们需要创建一个以 2 个明文密钥为种子的私钥。2 个明文密钥由不同的管理器维护。这是为了满足我们拥有的双重控制关键要求。我们可以将这两个键组合成一个种子。但是，通过阅读 Microsoft CryptoAPI 文档，所有密钥生成都是完全随机的，无法提供种子。这是真的？如果是，您能否建议创建此密钥的替代解决方案？

注意：密钥将存储在密钥容器中并标记为不可导出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T08:28:01.340

为什么不反过来呢？生成一个私钥，然后将其拆分为两个密钥共享，每个管理器只有一个。对于一个简单的 2-out-of-2 方案，您需要做的就是生成一个与密钥大小相同的随机（真正随机，而不是伪随机）数据块，将其与生成的密钥进行异或，然后给一个经理随机数据，另一个管理器是加密密钥。

然后，当您需要使用密钥时，两位经理都会提供他们的数据，然后您从中重建数据，完成后将其删除。

# macos - 禁用核心如何影响正在运行的进程？

> ID：306705
> 
> 赞同：10
> 
> 时间：2008-11-20T20:16:00.070
> 
> 标签：macos, cpu, multicore

我在我的 Macbook Pro 上安装了这个应用程序，它允许我禁用 CPU 上的核心。这让我想知道：禁用核心如何影响正在运行的进程？

如果禁用核心对以下内容有影响，我也很感兴趣

*   电池寿命
*   发热
*   当处理器通常使用少于 40% 的两个内核时提高性能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T14:11:44.013

## 禁用核心如何影响正在运行的进程？

它不会，除非你使用的程序写得非常糟糕。操作系统调度程序将收到处理器不再可用的警报，并将简单地停止将进程调度到该处理器中。将一个进程从“运行”转变为“等待”需要几微秒，因此切换将出现在瞬间。当进程可用且优先级允许时，该进程将继续在另一个核心上运行。

## 禁用核心如何影响电池寿命

它将产生可衡量但不显着的影响——在某些情况下，它会增加。换句话说，您不应该看到能源使用量减少超过 5%，因为现代处理器已经采用了积极的节能技术。处理器不会运行空闲循环——当没有准备好运行的进程时它们会停止。如果整个系统负载较低，操作系统会减慢处理器速度而不是停止它们，这具有类似的节省效果。

在某些非常具体的使用场景中，由于操作系统使用处理器的方式（更多的任务切换，这会导致更低的性能和更高的处理器利用率），能源使用量会上升。

## 禁用核心如何影响热量产生

与功率一样，它是可测量的，但如果不仔细测量就不会注意到。同样，处理器已经具有出色的功率控制，并将调节时钟、电压和处理器空闲以匹配负载，无论有多少处理器处于活动状态。

## 禁用一个核心如何影响性能（假设处理器使用的两个核心不到 40%）

过程非常“尖峰”。当您按下一个键或移动鼠标时，它会启动数十个等待进程，并希望在很短的时间内达到 100%。

通过强制处理器一次运行一个而不是并行运行，是的，总体平均使用率只有 80%，但它会感觉滞后，这不仅是因为有很多等待进程，还因为任务切换 - 每次一个进程被改变（由于优先级，或者它正在完成，或者中断等）处理器加载操作系统任务，然后运行调度程序，然后加载下一个任务。

您将一个处理器上的任务切换负载加倍，这意味着您要更频繁地运行操作系统代码（调度程序、事件管理器等）以跟上需求。

这很浪费，性能下降实际上可能很明显。例如，如果操作系统可以选择以正常速度的 40% 运行两个处理器，则不一定需要执行这些额外的工作。

-亚当

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T00:42:05.603

有趣的问题。这有点涉及。您对“禁用核心的应用程序”的确切含义以及它的作用并没有特别具体，但我从您的问题和对另一个问题的评论中推测该应用程序正在以对操作系统内核友好的方式禁用核心。

因此，通常当 OS X 运行时，有许多不同的可能线程/进程（我会从这里开始说线程）在调度程序中竞争 CPU 资源。当您的 Core 2 Duo 处理器的两个内核都启用时，内核能够同时运行两个线程 - 在需要运行的所有内容中旋转两个内核。当您禁用其中一个内核时，内核将退回到仅将工作分派给单个内核。当然，这不会改变需要完成的工作量......它只会将您的*潜在*执行性能降低一半。

如果您的核心平均忙碌率低于 50%，您可能认为这并不重要，对吧？好吧，在许多情况下它确实很重要，原因是执行东西的延迟。如果任何时候只有一个线程可以运行，那么第二个核心总是无用的，即使它仍然启用。但是，在两个或多个线程变得可运行的任何情况下......可以利用两个内核，如果其中一个被禁用，那么在第二个线程上完成的工作甚至无法开始，直到前一个线程执行一段时间，然后被换出。假设要完成相同工作的两个线程，显然与双核情况相比，第二个线程完成所需的时间是双核情况的两倍。你可能没有注意到这一点，这取决于我们在这里谈论的工作量，但显然，至少在理论上，延迟（响应能力）将减少一半。显然，随着系统加载越来越多的需要运行的线程或有更多工作要做的线程，一切都在以半速运行——实际上——将变得越来越明显。

这一切都很简单。

***那么这对于散热和电池寿命意味着什么呢？***

您是否在这里领先......因为事实上，虽然您可能倾向于认为您每单位时间消耗的功率只有一半，但实际上工作需要两倍的时间才能完成。

这里的结论是，最终禁用内核对整体电池寿命的影响非常小，因为操作系统和 CPU 已经在协同工作以降低时钟并有效地关闭不需要的内核。也就是说，在您需要时准备好*等待使用的内核几乎没有开销。*事实上，一个只使用一个内核的系统实际上可能具有更短的电池寿命，因为主板上的所有其他设备必须保持活动更长时间，因为 CPU 需要更长的时间才能完成所需的工作。

相对于散热来说，效果是差不多的。显然，仅用一个核心就可以显着降低 WATTS 的峰值散热量……因为实际上只有两个核心中的一个处于活动状态。但是，再一次，该核心将运行更长时间，并且净总能量输出（焦耳或瓦特秒）将大致相同......这也是为什么您的电池寿命在单核与两核情况下基本上不受影响的原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T19:06:13.640

我假设当您“禁用”核心时，您实际上是在告诉 OS X 不再并行处理。

我还假设操作系统足够聪明，可以在您禁用它们后移动进程:)

但是，我认为您不会真正看到功耗或电池寿命的巨大改善，但这是一个猜测 - CPU 仍在供电，只是其中一部分没有被访问。

另外，这只是一个理论上的问题，除非注意保持热性能恒定，否则只运行一个内核可能不会增加 CPU 烧毁的可能性？只是一个想法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T00:07:59.307

它不会真正影响您正在运行的进程。调度程序将从核心清除正在运行的进程，并且不会将另一个进程专用于它。
现在你的调度器只需要找到一个很好的策略来找到一个公平的进程分配给剩余的核心。

1.  电池：边缘
2.  热差：可忽略不计……负载为 2x40%
3.  不存在或稍差
    *   更糟糕的是，现在所有进程都必须切换到唯一的核心
    *   在一个进程（和他的上下文！）可能一直停留在一个核心之前
    *   所以这将添加 I/O ...并且您唯一的核心必须等待它（刷新 TLB 和页表）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T20:43:30.857

我不知道功耗，但我希望你会节省一些利润。这取决于 CPU 在 MBP 内使用的功率百分比。

至于对原始处理能力的影响，这取决于您正在运行的应用程序的性质。大多数应用程序并非旨在利用多核，尽管大多数高端应用程序都是。因此，如果您使用的是 Photoshop 或视频编辑软件，那么在性能瓶颈是 CPU（而不是网络 IO 或磁盘 IO）的情况下，您会注意到峰值性能显着降低。

# svn - 使用 SVN 协议的 SVN 结帐

> ID：306709
> 
> 赞同：9
> 
> 时间：2008-11-20T20:16:45.730
> 
> 标签：svn, svn-checkout

我作为单个用户在一台计算机上使用了很多 SVN

现在我想在多台计算机上共享我的东西

到目前为止，我一直在检查`file://c:/myproject`

我想结帐`svn://mycomputer/myproject`

如何将第一个映射到第二个？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-20T20:34:47.160

你需要 svnserve 守护进程。配置它的文档在这里（关于“svnserve as Windows service”的段落）：

[http://svnbook.red-bean.com/en/1.5/svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.invoking](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.svnserve.html#svn.serverconfig.svnserve.invoking)

您可能还想查看本章中访问 svn 服务器的其他可能性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-20T20:33:54.930

存储库的布局相同。为了使用 svn 协议访问存储库，您需要设置 svnserv，并将其指向您正在使用的存储库。这将允许两种访问 - file:// 本地和 svn:// 远程（或本地）。一位同事对[Visual SVN](http://www.visualsvn.com/server/)发誓。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T20:55:05.620

不确定路径在 Windows 中的转换方式，但在 Linux 上，您需要启动 svnserve 守护程序并指定存储库根目录：

```
svnserve -d -r /path/to/repos/ 
```

`/path/to/repos/myproject`因此，如果您的svn 存储库存储在

```
svn co svn://your.ip.addr/myproject ./myproject_checkout 
```

如果您想使用该协议，这将有所不同`svn+ssh`，其中为每个存储库访问请求创建一个 svnserve 进程。这意味着您不需要生成自己的 svnserve 守护进程，ssh 会为您处理这些。为单个用户设置这非常简单。有关更多信息，SliceHost 在[这里](http://articles.slicehost.com/2007/9/5/using-ssh-with-svnserve)有一篇很棒的文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T16:26:39.010

鲜为人知的事实：如果您是单个用户并且您的存储库位于可以通过 SSH 连接到的基于 *nix 的 PC 上，那么您甚至不需要服务器。

只需使用以下命令：

```
scn checkout svn+ssh://USERNAME@mycomputer/ABSOLUTE/PATH/TO/REPOSITORY 
```

这将提示您输入 SSH 密码（=登录到 mycomputer）。

# java - Collections.emptyList() 返回一个列表? I'm having some trouble navigating Java's rule for inferring generic type parameters. Consider the following class, which has an optional list parameter: import java.util.Collections 问问题 Chris Conway 问问题 2008-11-20T20:17:33.483 218034 次 This question shows research effort; it is useful and clear 281 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. I'm having some trouble navigating Java's rule for inferring generic type parameters. Consider the following class, which has an optional list parameter: import java.util.Collections; import java.util.List; public class Person { private String name; private List<String> nicknames; public Person(String name) { this(name, Collections.emptyList()); } public Person(String name, List<String> nicknames) { this.name = name; this.nicknames = nicknames; } } My Java compiler gives the following error: Person.java:9: The constructor Person(String, List<Object>) is undefined But Collections.emptyList() returns type <T> List<T>, not List<Object>. Adding a cast doesn't help public Person(String name) { this(name,(List<String>)Collections.emptyList()); } yields Person.java:9: inconvertible types Using EMPTY_LIST instead of emptyList() public Person(String name) { this(name, Collections.EMPTY_LIST); } yields Person.java:9: warning: [unchecked] unchecked conversion Whereas the following change makes the error go away: public Person(String name) { this.name = name; this.nicknames = Collections.emptyList(); } Can anyone explain what type-checking rule I'm running up against here, and the best way to work around it? In this example, the final code example is satisfactory, but with larger classes, I'd like to be able to write methods following this "optional parameter" pattern without duplicating code. For extra credit: when is it appropriate to use EMPTY_LIST as opposed to emptyList()? You want to use: Collections.<String>emptyList(); If you look at the source for what emptyList does you see that it actually just does a return (List<T>)EMPTY_LIST; javagenericstype-inference 4 4 回答 4 This answer is useful 465 The issue you're encountering is that even though the method emptyList() returns List<T>, you haven't provided it with the type, so it defaults to returning List<Object>. You can supply the type parameter, and have your code behave as expected, like this: public Person(String name) { this(name,Collections.<String>emptyList()); } Now when you're doing straight assignment, the compiler can figure out the generic type parameters for you. It's called type inference. For example, if you did this: public Person(String name) { List<String> emptyList = Collections.emptyList(); this(name, emptyList); } then the emptyList() call would correctly return a List<String>. 于 2008-11-20T20:34:46.067 回答 This answer is useful 106 你想使用： Collections.<String>emptyList(); 如果您查看 emptyList 的来源，您会发现它实际上只是做了一个 return (List<T>)EMPTY_LIST; 于 2008-11-20T20:25:10.423 回答 This answer is useful 27 the emptyList method has this signature: public static final <T> List<T> emptyList() That <T> before the word List means that it infers the value of the generic parameter T from the type of variable the result is assigned to. So in this case: List<String> stringList = Collections.emptyList(); The return value is then referenced explicitly by a variable of type List<String>, so the compiler can figure it out. In this case: setList(Collections.emptyList()); There's no explicit return variable for the compiler to use to figure out the generic type, so it defaults to Object. 于 2008-11-20T20:25:29.533 回答 This answer is useful 1 Since Java 8 this kind of code compiles as expected and the type parameter gets inferred by the compiler. public Person(String name) { this(name, Collections.emptyList()); // Inferred to List<String> in Java 8 } public Person(String name, List<String> nicknames) { this.name = name; this.nicknames = nicknames; } The new thing in Java 8 is that the target type of an expression will be used to infer type parameters of its sub-expressions. Before Java 8 only direct assignments and arguments to methods where used for type parameter inference. In this case the parameter type of the constructor will be the target type for Collections.emptyList(), and the return value type will get chosen to match the parameter type. This mechanism was added in Java 8 mainly to be able to compile lambda expressions, but it improves type inferences generally. Java is getting closer to proper Hindley–Milner type inference with every release! 于 2020-10-08T13:54:59.177 回答 Related 1 oracle - 执行 oracle 查询时出现 SSRS BIDS 错误（此提供程序不支持此命令） 1 ruby-on-rails - Rails 3.2.8“NotImplementedError：在意外的 T_NODE 对象上调用方法‘backtrace’”错误 1 android - 将 Canvas（另一个线程）保存到 SD 卡 2 mysql - 数据库新手 - 主键，外键，根本没有键？ 1 c++ - C++ 隐式转换 bool 到 int 和算术，删除分支，找不到错误 1 amazon-s3 - 如何根据扩展名限制 S3 中的文件？ 3 java - 在方法中使用“this” 1 android - 如何使用新信息开始恢复活动？ 1 mysql - 如何查询一个范围的列MYSQL 1 python - matplotlib savefig() 空白 - show() 不是 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：306713
> 
> 赞同：281
> 
> 时间：
> 
> 标签：java, generics, type-inference

I'm having some trouble navigating Java's rule for inferring generic type parameters. Consider the following class, which has an optional list parameter:

```
import java.util.Collections;
import java.util.List;

public class Person {
  private String name;
  private List<String> nicknames;

  public Person(String name) {
    this(name, Collections.emptyList());
  }

  public Person(String name, List<String> nicknames) {
    this.name = name;
    this.nicknames = nicknames;
  }
} 
```

My Java compiler gives the following error:

```
Person.java:9: The constructor Person(String, List<Object>) is undefined 
```

But `Collections.emptyList()` returns type `<T> List<T>`, not `List<Object>`. Adding a cast doesn't help

```
public Person(String name) {
  this(name,(List<String>)Collections.emptyList());
} 
```

yields

```
Person.java:9: inconvertible types 
```

Using `EMPTY_LIST` instead of `emptyList()`

```
public Person(String name) {
  this(name, Collections.EMPTY_LIST);
} 
```

yields

```
Person.java:9: warning: [unchecked] unchecked conversion 
```

Whereas the following change makes the error go away:

```
public Person(String name) {
  this.name = name;
  this.nicknames = Collections.emptyList();
} 
```

Can anyone explain what type-checking rule I'm running up against here, and the best way to work around it? In this example, the final code example is satisfactory, but with larger classes, I'd like to be able to write methods following this "optional parameter" pattern without duplicating code.

For extra credit: when is it appropriate to use `EMPTY_LIST` as opposed to `emptyList()`?

* * *

## 回答 #1

> 赞同：465
> 
> 时间：2008-11-20T20:34:46.067

The issue you're encountering is that even though the method `emptyList()` returns `List<T>`, you haven't provided it with the type, so it defaults to returning `List<Object>`. You can supply the type parameter, and have your code behave as expected, like this:

```
public Person(String name) {
  this(name,Collections.<String>emptyList());
} 
```

Now when you're doing straight assignment, the compiler can figure out the generic type parameters for you. It's called type inference. For example, if you did this:

```
public Person(String name) {
  List<String> emptyList = Collections.emptyList();
  this(name, emptyList);
} 
```

then the `emptyList()` call would correctly return a `List<String>`.

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2008-11-20T20:25:10.423

你想使用：

```
Collections.<String>emptyList(); 
```

如果您查看 emptyList 的来源，您会发现它实际上只是做了一个

```
return (List<T>)EMPTY_LIST; 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-11-20T20:25:29.533

the emptyList method has this signature:

```
public static final <T> List<T> emptyList() 
```

That `<T>` before the word List means that it infers the value of the generic parameter T from the type of variable the result is assigned to. So in this case:

```
List<String> stringList = Collections.emptyList(); 
```

The return value is then referenced explicitly by a variable of type `List<String>`, so the compiler can figure it out. In this case:

```
setList(Collections.emptyList()); 
```

There's no explicit return variable for the compiler to use to figure out the generic type, so it defaults to `Object`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-10-08T13:54:59.177

Since Java 8 this kind of code compiles as expected and the type parameter gets inferred by the compiler.

```
public Person(String name) {
    this(name, Collections.emptyList()); // Inferred to List<String> in Java 8
}

public Person(String name, List<String> nicknames) {
    this.name = name;
    this.nicknames = nicknames;
} 
```

The new thing in Java 8 is that the [*target type*](https://docs.oracle.com/javase/tutorial/java/generics/genTypeInference.html#target_types) of an expression will be used to infer type parameters of its sub-expressions. Before Java 8 only direct assignments and arguments to methods where used for type parameter inference.

In this case the parameter type of the constructor will be the target type for `Collections.emptyList()`, and the return value type will get chosen to match the parameter type.

This mechanism was added in Java 8 mainly to be able to compile lambda expressions, but it improves type inferences generally.

Java is getting closer to proper [Hindley–Milner](https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system) type inference with every release!

# mysql - 为什么 MyEclipse 的 Hibernate 逆向工程在映射某些表时会创建多个类？

> ID：306722
> 
> 赞同：5
> 
> 时间：2008-11-20T20:19:03.480
> 
> 标签：mysql, hibernate, reverse-engineering, myeclipse

我的 MYSQL 数据库中有一个表，它没有主键，但在两列上有一个唯一键。当使用 MyEclipse 的 Hibernate 逆向工程工具为该表创建映射时，它会生成两个类，一个以表本身命名，一个以“Id”后缀命名。似乎大多数有用的方法最终都出现在 Id 类中，所以它似乎是您要实例化并保存以持久化数据的方法。我可以理解这样一个事实，即创建 Id 类是为了表示表/映射对象中的唯一行，但是将其分成两个类有什么用，那么非 Id 的用途是什么- 后缀类？

我的同事认为你可以只用一节课来完成同样的事情，并嘲笑对这些没有主键的表使用逆向工程。另一方面，我假设 MyEclipse 开发人员比我聪明得多，而且这样做是有充分理由的。在那儿？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-20T21:53:09.437

你假设太多了我的朋友。这些工具实际上并不是来自 MyEclipse 团队，而是来自 Hibernate Tools 项目（JBoss，Hibernate 的开发者）。

这是一个无法猜测所有内容的程序化工具。这对于注释良好的简单内容非常有用，但有时，它不会生成您需要的内容。

通常需要 id 类来表示复合主键（使用多个属性的键）。它使用了组件类 Hibernate 的概念。

也可以稍微调整生成器选项。

在你的情况下，最好按照你的同事所说的去做。创建您自己的实体类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-27T03:08:31.447

我在 Eclipse 中针对 teradata 实例运行该工具时遇到了类似的问题。我有几个视图要反转，它们在一个模式中。我得到了用这个生成的 AcxiomDataId 类：

```
<table catalog=".*" schema="U01TKE_GRPR_RADMT_VW" name="F_ACXM_MBR" class="AcxiomData">
    <primary-key>
        <generator class="increment"></generator>
        <key-column name="MBR_UNIQ_KEY" property="memberUniqKey" />
    </primary-key>
</table> 
```

但是从表元素中删除模式和目录属性，我没有得到 AcxiomDataId 类：

```
<table name="F_ACXM_MBR" class="AcxiomData">
    <primary-key>
        <generator class="increment"></generator>
        <key-column name="MBR_UNIQ_KEY" property="memberUniqKey" />
    </primary-key>
</table> 
```

不知道为什么会这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-02T15:26:52.743

在您的逆向工程文件中：

```
 <table schema="public" name="yourtable">
            <primary-key>
                <!-- generator may not be necessary for mysql -->
                <generator class="increment"></generator> 
                <key-column name="column_name_of_primary_key" />
            </primary-key>
        </table> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-22T11:37:48.730

我面临同样的问题。我认为当您在表中没有任何键时，它会生成两个类。否则，如果您在表中有任何键，那么它只会生成一个。

至少对我来说，在表中添加主键后，它只生成一个代表表的类。如果我删除主键，那么它会生成两个类。

旧线程，但我认为对某人有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-11-12T09:51:41.103

你必须进入你的数据库并检查你是否已经将一个字段设置为主键，然后是休眠逆向工程文件，不要再创建多个类了。

# java - 如何检查 FreeMarker 模板中是否存在变量？

> ID：306732
> 
> 赞同：194
> 
> 时间：2008-11-20T20:21:42.367
> 
> 标签：java, templates, freemarker

我有一个 Freemarker 模板，其中包含一堆占位符，在处理模板时会为其提供值。如果提供了 userName 变量，我想有条件地包含模板的一部分，例如：

```
[#if_exists userName]
  Hi ${userName}, How are you?
[/#if_exists] 
```

但是，FreeMarker 手册似乎表明 if_exists 已被弃用，但我找不到另一种方法来实现这一点。当然，我可以简单地提供一个额外的布尔变量 isUserName 并像这样使用它：

```
[#if isUserName]
  Hi ${userName}, How are you?
[/#if] 
```

但是如果有办法检查 userName 是否存在，那么我可以避免添加这个额外的变量。

* * *

## 回答 #1

> 赞同：341
> 
> 时间：2008-11-20T20:25:21.843

要检查该值是否存在：

```
[#if userName??]
   Hi ${userName}, How are you?
[/#if] 
```

或者使用标准的 freemarker 语法：

```
<#if userName??>
   Hi ${userName}, How are you?
</#if> 
```

检查值是否存在且不为空：

```
<#if userName?has_content>
    Hi ${userName}, How are you?
</#if> 
```

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2012-07-23T14:15:59.423

这个似乎更合适：

```
<#if userName?has_content>
... do something
</#if> 
```

[http://freemarker.sourceforge.net/docs/ref_builtins_expert.html](http://freemarker.sourceforge.net/docs/ref_builtins_expert.html)

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-11-20T20:33:05.667

我也认为*if_exists*被用作：

```
Hi ${userName?if_exists}, How are you? 
```

如果 userName 为 null，则不会中断，如果为 null，则结果为：

```
Hi , How are you? 
```

if_exists 现在已弃用，并已替换为默认运算符！如在

```
Hi ${userName!}, How are you? 
```

default 运算符还支持默认值，例如：

```
Hi ${userName!"John Doe"}, How are you? 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-05-12T18:59:35.580

我想很多人都希望能够检查他们的变量是否不为空以及它是否存在。我认为在很多情况下检查存在性和空性是一个好主意，并且可以使您的模板更加健壮并且不易出现愚蠢的错误。换句话说，如果您在使用它之前检查以确保您的变量不为空且不为空，那么您的模板会变得更加灵活，因为您可以将空变量或空字符串放入其中，并且它的工作方式相同在任一情况下。

```
<#if p?? && p?has_content>1</#if> 
```

假设您要确保这`p`不仅仅是空格。然后你可以在检查它之前修剪它是否`has_content`。

```
<#if p?? && p?trim?has_content>1</#if> 
```

**更新**

请忽略我的建议——`has_content`仅此而已，因为它会进行空检查和空检查。做`p?? && p?has_content`就相当于`p?has_content`，所以你还不如直接用`has_content`。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-04-06T11:08:12.470

> 对于 FreeMarker 2.3.7 之前的版本

你不能用它`??`来处理缺失值，旧的语法是：

```
<#if userName?exists>
   Hi ${userName}, How are you?
</#if> 
```

# sql-server - 如何检测 SQL Server 表中的重复行？

> ID：306743
> 
> 赞同：42
> 
> 时间：2008-11-20T20:23:49.927
> 
> 标签：sql-server, rdbms

在 10 列/50K 行表中检测重复项的最有效方法是什么？我正在使用 MSSQL 8.0

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-20T20:44:07.470

举一个其他人描述的例子：

```
SELECT
    Col1, -- All of the columns you want to dedupe on
    Col2, -- which is not neccesarily all of the columns
    Col3, -- in the table
    Col4,
    Col5,
    Col6,
    Col7,
    Col8,
    Col9,
    Col10
FROM
    MyTable
GROUP BY
    Col1,
    Col2,
    Col3,
    Col4,
    Col5,
    Col6,
    Col7,
    Col8,
    Col9,
    Col10
HAVING
    COUNT(*) > 1 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-20T20:28:13.180

您可以`group by`在所有列上使用，然后`count(*)>1`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-20T20:43:19.263

试试这个

```
Select * From Table
Group By [List all fields in the Table here]
Having Count(*) > 1 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-20T20:39:04.390

要检测，只需按照古格所说的分组即可。

```
select fieldA, fieldB, count(*) from table
group by fieldA, fieldB
having count(*) > 1 
```

如果你想删除欺骗......伪......

```
select distinct into a temp table
truncate original table
select temp table back into original table 
```

使用 truncate 如果您有 FK 约束，您可能会遇到问题，所以要明智地放弃约束并确保您不会孤立记录。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-20T21:48:17.700

除了提供的建议之外，我会在以后努力防止重复，而不是稍后尝试找到它们。

这是通过对应该是唯一的列（或列组）使用唯一索引来完成的。请记住，除了通过您正在处理的特定应用程序之外，可以从其他位置修改数据库中的数据，因此最好在数据库级别定义表中允许和不允许的内容。

# iphone - iPhone 版青蛙

> ID：306755
> 
> 赞同：2
> 
> 时间：2008-11-20T20:27:58.203
> 
> 标签：iphone

我的大部分编程经验要么是使用表单（Windows Forms，或 ASP.NET），要么是使用与硬件连接的小型嵌入式项目。最近我开始阅读一些关于 iPhone 开发的教程。我对学习 Objective-C 和 iPhone sdk 很感兴趣。

我想制作一个类似青蛙的小游戏来帮助我学习，但我从未真正涉足过游戏开发。我会有四个按钮（上、下、左、右）并且很好奇如何进行导航。制作一个大网格（矩阵）并使用它在屏幕上导航会很聪明吗？最终使用 OpenGL 会很好，但我还没有准备好进入那个领域。

感谢您的任何意见。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T20:34:11.733

您需要派生 UIView 的子类并覆盖 keyDown: 方法以获取按键。有一个 NSTimer 类，非常适合定期更新，还有一个 UIImage，用于在屏幕上加载和显示位图。

您可能只对要绘制的所有对象使用 (x,y) 坐标，而不是使用明确的网格。然后，您可以定期更新对象的位置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T22:29:05.197

[这](http://monoclestudios.com/cocos2d_whitepaper.html)是一个关于 Cocoa2D 的简单教程，您将使用它来制作 2D 游戏。

Coca2D 教程的作者之一也有一个关于触摸检测[的教程。](http://lethain.com/entry/2008/oct/20/touch-detection-in-cocos2d-iphone/)

[此外，一个完整的、可运行的游戏的源代码可能会很有用——在我的问题“周围有开源的 iPhone 应用程序吗？”](https://stackoverflow.com/questions/200850/are-there-any-open-source-iphone-applications-around)中列出了一些开源的、完整的游戏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T22:18:41.257

Lights Off 是一款相对简单的 iPhone 游戏，它是在不使用 OpenGL 的情况下构建的。源代码已经发布，可能会让您对如何开始有一个不错的了解。

更多信息在这里： http: [//furbo.org/2008/09/19/lights-off/](http://furbo.org/2008/09/19/lights-off/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T00:49:00.907

我遇到了你的情况，在开始构建 2D 益智游戏之前，我研究了石英和 opengl，最后我选择了 opengl 方式。它有点复杂，但更灵活。性能方面，您可能不需要它来构建青蛙克隆，但如果您需要提升，就像一次有许多形状一样，它将由任务决定。我所做的就是将opengl代码封装在我自己的方法中，所以我不需要考虑太多。在我对它有了更多经验之后，我开始在我想要优化的地方直接调用它。

要快速入门，您可以使用 xcode 上的 opengl 模板。您还可以使用它来查看 NSTimer 是如何设置的。如果您需要纹理，请查看苹果 CrashLanding 示例应用程序中的 Texture2D 类。

该网站是掌握 opengl es 基本概念的绝佳资源，例如顶点和颜色数组： [http ://www.zeuscmd.com/tutorials/opengles/index.php](http://www.zeuscmd.com/tutorials/opengles/index.php)

至于您提到的网格，请阅读基于瓦片的引擎。有很多关于这个主题的教程。这对青蛙来说绝对是个好主意。

# .net - .NET Framework：对象单元是否绑定？

> ID：306757
> 
> 赞同：7
> 
> 时间：2008-11-20T20:28:19.200
> 
> 标签：.net, multithreading

**Given:*****禁止***从一个线程构造 ADO Connection 对象并将其提供给另一个线程。这两个线程是不同的单元，即使第一个线程**永远不会再**接触它（甚至不维护对它的引用！），也没关系。

那个 ADO Connection 对象是由 ThreadA 创建的，ThreadA 是唯一的线程，在任何情况下，在任何情况下，都永远被允许使用该 Connection 对象，永远。

现在将“ADO 连接”替换为“ADO.NET 连接”。是否适用相同的规则？

* * *

我知道 .NET 框架中的大多数对象都不是线程安全的。例如，SDK 中的[DictionaryEntry结构说：](http://msdn.microsoft.com/en-us/library/system.collections.dictionaryentry.aspx)

> **线程安全**
> 这种类型的 任何公共**静态**成员都是线程安全的。不保证任何实例成员都是线程安全的。

我知道**不是线程安全的**意味着如果我要从不同的线程访问它，我必须同步对对象的访问。这一切都很好，我可以确保一次只有一个线程访问该对象：

```
lock (myObject)
{
   ...
} 
```

但是还有一些东西不仅仅是线程安全的。

在 COM 中，（一些）对象被绑定到创建它的“*公寓”。*一旦在一个单元上构建了对象，就***禁止***从另一个单元访问它 - 无论您如何保护该对象免受多个同时线程访问。

.NET 中是否存在类似的概念？

* * *

## 更多信息

我知道你被禁止从创建它的线程以外的线程访问控件——即使你以线程安全的方式使用它。这在 MSDN 上没有记录：

> **线程安全**
> 
> 只有以下成员是线程安全的：BeginInvoke、EndInvoke、Invoke、InvokeRequired 和 CreateGraphics（如果已创建控件的句柄）。在后台线程上创建控件句柄之前调用 CreateGraphics 可能会导致非法的跨线程调用。

当您从单个线程创建和使用控件时，没有提到控件引发异常 - 当该线程不是应用程序启动时创建的第一个线程时。

但是任意对象呢？关于什么：

```
public class MyClass
{
    int _number;

    public int Number { get { return _number; } set { _number = value; } }
}

MyClass myObject = new MyClass(); 
```

只要我同步对 myObject 的访问，两个线程就可以与之交谈吗？

* * *

这同样适用于：

```
List<Object> sharedList = new List<Object>(); 
```

两个线程可以与列表对话，只要它们不同时进行，通常使用：

```
lock (sharedList)
{
    sharedList.Add(data);
} 
```

允许两个线程接触同一个对象吗？

* * *

这同样适用于：

```
IAsyncResult ar = BeginSetLabelToTheValueINeed(label1);
...
EndSetLabelToTheValueINeed(ar); 
```

* * *

这同样适用于：

```
//Fetch image on connection that is an existing DB transaction
public static Bitmap GetImageThumbnail(DbConnection conn, int imageID) 
{
} 
```

被转换为异步委托模式：

```
//Begin fetching an image on connection that is an existing DB transaction
IAsyncResult ar = BeginGetImageThumbnuts(conn, imageID, callback, stateOjbect);
...
//Finish fetching an image on connection that is an existing DB transaction
Bitmap thumb = EndGetImageNumbthail(ar); 
```

* * *

人们没有回答这个问题，而是开始讨论 ADO.NET 中的设计模式。请回答问题。如果这些示例混淆并分散了您的松鼠大脑，请忽略这些示例。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T15:20:48.967

.NET 对象未绑定到公寓。只有当您的 .NET 代码与 COM 对象交互时，公寓才真正发挥作用，尽管在不知不觉中做到这一点并不难。例如，如果您与 Windows 剪贴板交互，您将激活 COM 子系统。套间是在线程级别设置的，一旦你的线程建立了它的套间（MTA、STA 等），它就不能改变，所以让套间正确是非常重要的。所有 WinForms 应用程序都将 [STAThread] 附加到它们的 Main() 方法，以确保主应用程序线程（即 GUI 消息泵线程）是 STA，并且可以与 Windows 剪贴板等便利设施进行交互。

.NET 运行时必须知道 COM 子系统才能提供 COM 互操作功能。虽然需要内在可怕的细节是非常罕见的。

据我了解，将 COM 对象划分为不同单元的目的之一是让应用程序可以使用使用不同线程模型开发的软件组件，而不必关心这些问题本身。

这里涉及很多复杂的问题，特别是单线程库通常不是为处理重入而构建的概念，当然也不支持让两个执行线程同时修改对象的概念。

例如，假设您想在新的多线程 C++ 应用程序中使用 COM 对象。此 COM 对象是在 Visual Basic 中开发的，不是线程安全的，但您希望从多个线程中使用该组件的多个实例。虽然确实可以添加一些锁定机制来防止不正确的访问，但对象存在于其自己的单线程单元 (STA) 中的事实意味着 COM 子系统将代表您序列化对对象的访问。您不必知道 COM 对象的线程模型即可使用它，或者至少它通常是这样工作的。

.NET 是为我们新的多线程世界编写的，因此不使用套间的概念。运行时肯定知道并且必须知道它们以支持与旧 COM 对象的互操作。

公寓非常复杂，如果您不知道自己在做什么，很多奇怪的事情都会出错。很高兴您在 .NET 中通常不需要担心它。

如果您想要一些真正的核心信息，您可以查看[CLR 中的 Apartments and Pumping](http://blogs.msdn.com/cbrumme/archive/2004/02/02/66219.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:39:20.837

为赏金射击！

好的，.NET 中的某些类/类框架具有公寓绑定的方法，但仅限于设计。这意味着您必须专门编码才能做到这一点。默认情况下未设置。为此编码有点笨拙。你必须得到你想坚持的线程 ID 并一直检查它。除了用于跟踪 UI 线程的 UI 组件之外，我认为框架中没有任何工具可以让这变得简单。该支持框架可能深埋在 UI 堆栈中；我从未在任何 MSDN 文档中看到它。

更常见的是设置线程单元。整个框架的许多部分都被设计为 STA 线程（[STAThreadAttribute](http://msdn.microsoft.com/en-us/library/system.stathreadattribute.aspx)）。这通常是因为它们在其核心深处触及 COM 对象，这些对象通常要求它们仅在 STA 线程中使用。例如，winforms 应用程序中的主线程使用 STAThreadAttribute 进行标记，因此每个 UI 组件只能在它们创建的同一个线程中被触及，即 UI 线程。有趣的是，WPF 中的 XamlReader 知道当前的线程单元，甚至不会反序列化 UI 组件，除非它运行的线程是 STA 线程。

“标准 POCO 是否具有线程亲和力或关心它是否在 STA 或 MTA 线程中？” 答案是否定的，除非您将其编码为这样或使用 STAThreadAttribute 标记其方法，*或者如果对象在调用堆栈中实例化，该调用堆栈在其层次结构中的某处具有使用 STAThreadAttribute 标记的方法*。

“ADO.NET 对象是否具有线程亲和性，它是否可以感知公寓？”

嗯，DbConnection 从 Component 扩展而来，后者扩展 MarshalByRefObject。组件、MBRO、DbConnection 及其后代（即 SqlConnection）不包含用 STAThreadAttribute 标记的方法。快速检查它们的主要依赖项（例如 DbTransaction）并没有发现任何 THOSE 类的方法也仅标记为 STA。因此他们不知道公寓。

使用 Reflector 快速浏览并没有发现任何明显的线程 ID 观察。DbConnection 确实依赖于 Transaction，这似乎是最有可能的线程爱好者。

我淘汰了 Reflector 并检查了其中一些类。
DbConnection - 不关心当前线程的 ID
SqlConnection - 在调试
SqlTransaction 时进行一些线程跟踪 - 有一个名为“ZombieCheck”的函数，但没有线程监视
DbTransaction - 这里什么都没有。

所以我认为可以肯定地说 ADO.NET 对象没有线程亲和性。我什至没有看到他们使用[Thread.Begin/EndThreadAffinity](http://msdn.microsoft.com/en-us/library/system.threading.thread.beginthreadaffinity.aspx)。

* * *

**编辑**

正如 Jeremy 在评论中指出的那样，我一直在谈论用属性而不是 CLASSES 的方法标记的类。大错特错。我给人的印象是我只看类定义而不是整个类，这让我搞砸了。

我已经对此进行了编辑以澄清，让我在这里说得非常清楚：System.Data 中没有类方法用 STAThreadAttribute 标记。您可以使用以下 hacky 代码自行检查：

```
SqlConnection sc = new SqlConnection();
var data = AppDomain.CurrentDomain.GetAssemblies()
           .Where(x => x.FullName.StartsWith("System.Data,")).First();
var dtypes = data.GetTypes();
var results = new List<string>();
foreach (var type in dtypes)
    foreach (var method in type.GetMethods())
        foreach (var attr in 
                method.GetCustomAttributes(true).OfType<System.Attribute>())
        {
            results.Add(string.Format("{0} {1} {2}", 
                               type.Name, method.Name, attr.GetType().Name));
            if (attr.GetType() == typeof(STAThreadAttribute)) 
                                           throw new Exception("SHIII");
        } 
```

此外，winforms 中的 UI 类也不使用 STAThreadAttribute；它是使用此属性的应用程序（正如 Jeremy 再次指出的那样）。

有一个特殊情况，我遇到了一个知道公寓的班级。反序列化 xaml 并创建 WPF UI 类的 XamlReader 在 MTA 线程上调用其 Load 方法时将引发异常。它甚至不在文档中，这很烦人......所以，同样，默认情况下，课程不支持公寓；您必须以这种方式对其进行编码，或者您必须通过在包含由 STAThreadAttribute 标记的方法的方法链中更新它们来使它们的实例知道。唷。这东西解释起来比理解更难……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T15:13:01.120

.NET 中的对象不是单元绑定的，除非您特别指定它们。

例如，如果您使用线程本地存储，那么您将遇到多个线程访问对象的问题，只要您假设对对象的所有访问都将发生在一个线程上。

另一方面，线程本地存储可能是一项功能，其中跨多个线程的对象使用至少部分分开处理。

至于你的其他案例，让我们一次拿一个，并附上评论：

* * *

但是任意对象呢？关于什么：

```
public class MyClass
{
    int _number;

    public int Number { get { return _number; } set { _number = value; } }
}

MyClass myObject = new MyClass(); 
```

只要我同步对 myObject 的访问，两个线程就可以与之交谈吗？

**答**：是的，在这种情况下，是否需要同步取决于您的要求。

如果您在计时方面绝对必须保证，如果在一个线程上为对象设置一个新值，而在另一个线程上在设置后立即读取它（但是两个不同的线程），则您需要第二个线程读取第一个线程的值放入，然后你需要锁定。

但是，存储 int 的值是原子操作。需要锁来获得内存屏障，以便在第二个线程上读取值不会使用缓存副本。

您通常可以通过声明 volatile 来处理这些简单的类，但锁定是提供更好保证的可靠方法。

对于更复杂的对象，比如设置一个大于 cpu 的本机总线大小的结构（即大于 32 位或 64 位，取决于），需要锁定，因为将数据复制到内存中的正确位置是在这种情况下不是原子操作。换句话说，如果一个线程试图在另一个线程上执行的写操作中间读取数据，那么如果没有锁，您就有读取一半旧一半新数据的风险。

* * *

这同样适用于：

```
List<Object> sharedList = new List<Object>(); 
```

两个线程可以与列表对话，只要它们不同时进行，通常使用：

```
lock (sharedList)
{
    sharedList.Add(data);
} 
```

允许两个线程接触同一个对象吗？

**回答**：是的。在集合上使用 ICollection 接口的 SyncRoot 属性通常是一个好主意，或者完全使用不同的锁定对象。

* * *

这同样适用于：

```
IAsyncResult ar = BeginSetLabelToTheValueINeed(label1);
...
EndSetLabelToTheValueINeed(ar); 
```

**答**：这个我不确定，哪个是有问题的变量？如果`label1`这里没有任何东西可以阻止多个线程访问和弄乱这个变量，那么您需要使用锁定机制来防止此类问题。

* * *

这同样适用于：

```
//Fetch image on connection that is an existing DB transaction
public static Bitmap GetImageThumbnail(DbConnection conn, int imageID) 
{
} 
```

被转换为异步委托模式：

```
//Begin fetching an image on connection that is an existing DB transaction
IAsyncResult ar = BeginGetImageThumbnuts(conn, imageID, callback, stateOjbect);
...
//Finish fetching an image on connection that is an existing DB transaction
Bitmap thumb = EndGetImageNumbthail(ar); 
```

**答**：如果您的意思是您将并行执行多个此类请求，您可能不会获得太多收益，因为您需要序列化对连接对象的访问，因为这些不是线程安全的。让缩略图方法打开并关闭它自己的连接可能会更好。

当然，除非您只想使用一个连接并序列化该访问但并行化缩略图的计算，但是由于这些线程将以某种方式按顺序执行，因为它们中的大多数都在等待第一个完成访问连接，您可能不会在这里获得太多收益。

* * *

简而言之，锁定通常很容易实现，并且几乎总是可以很好地保证您不会通过从两个线程访问对象而弄乱对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T20:39:52.500

为什么要在一个线程上创建连接并从另一个线程使用它？

连接创建/打开和关闭/处置之间的时间应该尽可能短，因此无论是否可能，将其交给另一个线程听起来都不是一个好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T20:46:52.860

首先，您**不需要**在多线程场景中同步对对象的访问。您可以从多个线程中自由地“摆弄”您自己的类的任何成员，而不受 CLR 的任何限制。表单（以及一般的控件）不允许您在另一个线程上调用成员这一事实是一个实现细节（并且在 .Net 2.0 之前并不明确）。

话虽如此，您通常**需要**强制执行某种类型的同步来对多个线程可访问的对象执行任何有用的操作。

关于你的具体问题。我相信 SqlConnection 可以从多个线程中使用，但不能同时使用。无法同时使用几乎完整的 SqlConnection 会抵消使用共享连接可能获得的任何性能优势。考虑到创建一个新的 SqlConnection 是多么便宜（尤其是在连接被池化后），像这样重用连接几乎没有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T20:48:51.437

我知道只有几个用例可以满足上述要求：

*   使用 SqlCe 是一种性能技巧
*   使用 NHibernate 并始终保持连接处于活动状态（尽管这基本上违反了 NHibernate 最佳实践）

除了这两个（可能还有其他几个？）你真的不想做你在这里问的事情。

我同意 StingyJack 的观点，在大多数情况下，您的 ADO 对象应该出现在 usings 中（在范围内创建和销毁）并且是局部变量，从而消除线程问题。

与 WinForm 的处理是处理 POST 和 SEND 消息之间的区别（将消息块发送给消费者，直到它们完成）。实际上它不会抛出异常，异常只是2.00在调试中添加的警告。在实践中，无一例外都会导致（看似）随机锁定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T15:09:30.707

请参阅 Alik Levin 的这个方便的页面

[http://blogs.msdn.com/alikl/archive/2008/06/20/pitfalls-with-net-multithreading-and-com-objects-threads-must-have-compatible-apartment-models-mta-vs- sta.aspx](http://blogs.msdn.com/alikl/archive/2008/06/20/pitfalls-with-net-multithreading-and-com-objects-threads-must-have-compatible-apartment-models-mta-vs-sta.aspx)

**.net 对象是 MTA 建模的。如果您正在与 COM 对象交互，这只是一个问题**

> .Net 多线程和 COM 对象的缺陷——线程必须具有兼容的单元模型（MTA 与 STA）
> 
> 结合 COM 对象实现多线程 .Net 时要小心。线程公寓模型很重要。
> 
> .Net 线程默认具有多线程单元 (MTA) 模型。COM 对象具有单线程单元 (STA)。在您生成的 .Net 线程上调用 COM 对象可能会导致无法预料的结果。
> 
> .Net 中的多线程很容易基于 Thread 或 ThreadPool 对象实现。Thread.Start() 方法产生具有多线程单元 (MTA) 模型的新线程。ThreadPool.QueueUserWorkItem(myMethod) 将 myMethod 排队，以便在其管理的可用线程上执行。

# pppoe - 以编程方式重拨 PPPOE 连接

> ID：306779
> 
> 赞同：3
> 
> 时间：2008-11-20T20:36:58.920
> 
> 标签：pppoe

我在计算机上有一个 PPPOE 连接。那台计算机有两个 LAN 卡，我在上面激活了 ICS。问题是，连接会随着时间的推移而退化（不知道为什么），重拨会很好，也许每小时一次。我正在考虑编写一个 AutoIT 脚本来执行此操作，例如，如果我将一些数据发送到网关 pc 正在侦听的端口。唯一的麻烦是，我不知道我必须运行的可执行文件的名称是什么。

编辑：我对带有 GUI 的那个很感兴趣。

编辑 2：我对自动化这个过程很感兴趣，并且不想在 AutoIT 中写东西（这是最后的选择）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T18:01:00.610

您可以使用 rasdial（内置在 Windows 中）并创建一个批处理脚本（.bat 扩展名），如下所示：

```
rasdial connectionname 
```

-或者-

如果你想用编程语言来做，你可以在内部调用命令

C# 示例：

```
public static int OpenConnection(string connectionName, int Timeout) {
   int ExitCode;
   ProcessStartInfo ProcessInfo;
   Process Process;

   ProcessInfo = new ProcessStartInfo("cmd.exe", "/C rasdial " + connectionName);
   ProcessInfo.CreateNoWindow = true; 
   ProcessInfo.UseShellExecute = false;
   Process = Process.Start(ProcessInfo);
   Process.WaitForExit(Timeout);
   ExitCode = Process.ExitCode;
   Process.Close();

   return ExitCode;
} 
```

我猜你想要的语言也会有类似的东西。

哦，你可以使用：

```
rasdial "connection name" /d 
```

断开连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-18T10:48:21.000

[也许你可以用rasdial](http://webtools.live2support.com/windows/rasdial.php)和[at](http://support.microsoft.com/kb/313565)为自己做点什么？

# sql - SQL日期比较

> ID：306788
> 
> 赞同：1
> 
> 时间：2008-11-20T20:38:52.893
> 
> 标签：sql, tsql

如何检查记录的时间戳日期是否在今天午夜之前？

datediff 快把我逼疯了……

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T20:40:53.483

尝试：

```
WHERE dtColumn < DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T20:44:00.713

这是如何在 SQL 中获取今天的 0 小时

```
SELECT (CAST(FLOOR(CAST(GETDATE() as FLOAT)) AS DateTime)) 
```

只需将您的时间与此进行比较。

不要使用 varchar 强制转换，因为它们很慢。

[查看此列表](https://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server#202288) 以获取更多日期时间帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T20:48:05.213

试试这个：

```
where myColumn < cast( (cast(getdate() - 0.5 as int)) as datetime) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T20:48:29.723

您的意思是您使用的列的数据类型是“TimeStamp”，而不是 dateTime 或 smalldatetime ？

如果是这样，那你就不走运了。这种数据类型与日期或时间无关（这真的很容易误导......）它只是保证在时间上是唯一的和连续的......但是没有办法将它与日期时间进行比较

[http://msdn.microsoft.com/en-us/library/aa260631(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa260631(SQL.80).aspx)

[http://www.sqlteam.com/article/timestamps-vs-datetime-data-types](http://www.sqlteam.com/article/timestamps-vs-datetime-data-types)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T23:00:18.537

如果 ColumnName（您正在检查的列）的数据类型是日期时间，而不是时间戳，那么最快的方法是

```
Select Case DateDiff(day, columnName, getDate()) 
   When 0 Then 'Today' Else 'Earlier' End
From TableName 
```

假设 ColumnName 中的所有日期值现在或更早......

考虑 datediff 的最简单方法是它计算从一个日期时间到另一个日期时间必须传递的指定类型的“边界”的数量......

# .net - 提供“键入时搜索”的最佳方式是什么？

> ID：306795
> 
> 赞同：2
> 
> 时间：2008-11-20T20:42:51.497
> 
> 标签：.net, vb.net, asynchronous

我正在将 Forms 应用程序移植到 VB.NET Web 应用程序，用户真正喜欢的功能之一是能够在用户在搜索框中键入时缩小可能的选择范围。搜索本身针对多个表和列（并且需要几秒钟），因此它不是简单的自动完成或任何东西。允许用户键入并使用匹配项异步更新 ListView 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T20:47:45.310

JQuery 将是在客户端过滤 ListView 的一个很好的解决方案。在这里查看这篇最近的[文章](http://beckelman.net/post/2008/10/16/Client-Side-ASPNET-ListView-Sorting-via-jQuery-TableSorter-Plugin-Demo.aspx) 和另一个很酷的[演示](http://beckelman.net/post/2008/11/20/jQuery-tableSorter-and-quickSearch-Plugins-Together-Demo.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T20:54:39.537

您应该能够使用[AJAX 控件工具包中的](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/)[Dynamic Populate](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/DynamicPopulate/DynamicPopulate.aspx)控件来完成大部分工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T21:02:50.503

查看 ASP.NET AJAX 控件。自动完成有一个特定的控件：

> AutoComplete 是一个 ASP.NET AJAX 扩展器，可以附加到任何 TextBox 控件，并将该控件与弹出面板相关联，以显示以输入到文本框中的前缀开头的单词。
> 
> 由 Web 服务提供的包含候选词的下拉菜单位于文本框的左下方。
> 
> 在上面的示例中，文本框与 AutoCompleteExtender 相关联，该 AutoCompleteExtender 使用 Web 服务提取以文本框内容开头的单词。
> 
> 当您输入的内容超过指定的最小字长时，弹出窗口将显示以该值开头的单词或短语。缓存已打开，因此多次键入相同的前缀只会导致对 Web 服务的一次调用。

[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)

如您所述，还有一个用于搜索列表的控件。

# xml - 生成word 2003文档

> ID：306801
> 
> 赞同：1
> 
> 时间：2008-11-20T20:43:40.793
> 
> 标签：xml, ms-word

我有 XHTML 中的数据和 SQL Server 2005 中的纯文本。我需要从这些数据中生成一个 Word 2003 文档。我正在考虑使用 Word XML 2003 来执行此操作。有没有生成 Word XML 2003 的好工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T14:15:54.647

如果您想在 Word 2003 中使用 XML，您可以使用 Microsoft 的 SDK：http: [//msdn.microsoft.com/en-us/library/aa214923.aspx](http://msdn.microsoft.com/en-us/library/aa214923.aspx)

由于您已经拥有 XML 格式的数据，您可以使用以下工具来创建 XSLT：http: [//msdn.microsoft.com/en-us/library/aa212886.aspx](http://msdn.microsoft.com/en-us/library/aa212886.aspx)。该工具应包含在 SDK 中。

如果您需要进一步的帮助，请告诉我。

# java - Hibernate：根据实体类自动创建/更新数据库表

> ID：306806
> 
> 赞同：104
> 
> 时间：2008-11-20T20:45:25.797
> 
> 标签：java, mysql, hibernate, jpa, groovy

我有以下实体类（在 Groovy 中）：

```
import javax.persistence.Entity
import javax.persistence.Id
import javax.persistence.GeneratedValue
import javax.persistence.GenerationType

@Entity
public class ServerNode {

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  Long id

  String firstName
  String lastName

} 
```

和我的persistence.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="http://java.sun.com/xml/ns/persistence" version="1.0">
    <persistence-unit name="NewPersistenceUnit">
        <provider>org.hibernate.ejb.HibernatePersistence</provider>
        <properties>
            <property name="hibernate.connection.url" value="jdbc:mysql://localhost:3306/Icarus"/>
            <property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver"/>
            <property name="hibernate.connection.username" value="root"/>
            <property name="hibernate.connection.password" value=""/>
            <property name="hibernate.archive.autodetection" value="class"/>
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hbm2ddl.auto" value="create"/>
        </properties>
        <class>net.interaxia.icarus.data.models.ServerNode</class>
    </persistence-unit>
</persistence> 
```

和脚本：

```
import javax.persistence.EntityManager
import javax.persistence.EntityManagerFactory
import javax.persistence.Persistence
import net.interaxia.icarus.data.models.ServerNode

def factory = Persistence.createEntityManagerFactory("NewPersistenceUnit")
def manager = factory.createEntityManager()

manager.getTransaction().begin()

manager.persist new ServerNode(firstName: "Test", lastName: "Server")

manager.getTransaction().commit() 
```

数据库*Icarus*存在，但目前没有表。我希望 Hibernate 基于实体类自动创建和/或更新表。我将如何做到这一点？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-11-20T21:16:45.860

我不知道离开`hibernate`前面是否会有所不同。

参考[建议](http://docs.jboss.org/hibernate/core/3.3/reference/en/html/session-configuration.html#configuration-misc-properties)它应该是`hibernate.hbm2ddl.auto`

的值`create`将在 sessionFactory 创建时创建您的表，并保持它们不变。

的值`create-drop`将创建您的表，然后在您关闭 sessionFactory 时删除它们。

也许您应该[`javax.persistence.Table`](http://java.sun.com/javaee/5/docs/api/javax/persistence/Table.html)明确设置注释？

希望这可以帮助。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2008-11-20T20:51:13.070

您可以尝试在您的 persistence.xml 中更改这一行

```
<property name="hbm2ddl.auto" value="create"/> 
```

到：

```
<property name="hibernate.hbm2ddl.auto" value="update"/> 
```

这应该维护架构以遵循您每次运行应用程序时对模型所做的任何更改。

从[JavaRanch得到这个](https://coderanch.com/forums/search/search/-1?match_type=all&sort_by=time&q=hibernate.hbm2ddl.auto&groupByTopic=true)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-05-29T23:28:06.103

有时根据配置的设置方式，属性标签的长格式和短格式也会有所不同。

例如，如果你有它：

```
<property name="hibernate.hbm2ddl.auto" value="create"/> 
```

尝试将其更改为：

```
<property name="hibernate.hbm2ddl.auto">create</property> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-12-10T17:02:12.830

在我的情况下，如果没有下面列出的最后一个属性，则不是第一次创建表：

```
<properties>
    <property name="hibernate.archive.autodetection" value="class"/>
    <property name="hibernate.show_sql" value="true"/>
    <property name="hibernate.format_sql" value="true"/>
    <property name="hbm2ddl.auto" value="create-drop"/>
    <!-- without below table was not created -->
    <property name="javax.persistence.schema-generation.database.action" value="drop-and-create" />
</properties> 
```

使用 Wildfly 的内存 H2 数据库

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-05-19T13:44:57.387

有一个非常重要的细节，可能会阻止你的休眠生成表（假设你已经设置了`hibernate.hbm2ddl.auto`）。您还需要`@Table`注释！

```
@Entity
@Table(name = "test_entity")
    public class TestEntity {
} 
```

在我的情况下，它已经帮助了至少 3 次 - 仍然不记得它；）

PS。阅读休眠文档 - 在大多数情况下，您可能不想设置`hibernate.hbm2ddl.auto`为`create-drop`，因为它会在停止应用程序后删除您的表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-15T06:17:15.543

在 applicationContext.xml 文件中：

```
<bean id="entityManagerFactoryBean" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
      <property name="dataSource" ref="dataSource" />
      <!-- This makes /META-INF/persistence.xml is no longer necessary -->
      <property name="packagesToScan" value="com.howtodoinjava.demo.model" />
      <!-- JpaVendorAdapter implementation for Hibernate EntityManager.
           Exposes Hibernate's persistence provider and EntityManager extension interface -->
      <property name="jpaVendorAdapter">
         <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter" />
      </property>
      <property name="jpaProperties">
         <props>
            <prop key="hibernate.hbm2ddl.auto">update</prop>
            <prop key="hibernate.dialect">org.hibernate.dialect.MySQL5Dialect</prop>
         </props>
      </property>
   </bean> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-18T10:57:06.500

为了支持@thorinkor 的答案，我将扩展我的答案，不仅对实体使用@Table (name = "table_name") 注释，而且实体类的每个子变量都应该使用@Column(name = "col_name") 进行注释。这导致在旅途中无缝更新表。

对于那些正在寻找基于 Java 类的休眠配置的人，该规则也适用于基于 Java 的配置（NewHibernateUtil）。希望它可以帮助别人。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-08T07:24:28.910

1.  自动创建表，与注释无关
2.  为此，我们需要更改“hibernate.cfg.xml”。

```
 <property name="hbm2ddl.auto">update</property> 
```

# python - 使用 Python，如何确保在特定文件夹中压缩文件夹？

> ID：306811
> 
> 赞同：1
> 
> 时间：2008-11-20T20:47:28.740
> 
> 标签：python, file, zip

我已经能够压缩我的文件夹的内容。但我希望压缩文件保留在刚刚压缩的文件夹中。例如，我在 C: 驱动器中压缩了一个名为 test 的文件夹。但我希望我的“test.zip”文件包含在 C:\test 中。我怎样才能做到这一点？提前致谢。

***用代码示例澄清问题：***

有人好心地指出我的问题令人困惑，但对于 python 新手来说，很多事情都令人困惑:) - 如果这个问题太基本或答案很明显，我提前道歉。我不知道如何确保生成的 zip 文件位于已压缩的文件夹中。换句话说，我希望压缩过程发生在“basedir”中。这样用户就不会浪费时间在 C 驱动器的某个地方搜索它。

```
 def zip_folder(basedir, zip_file):
        z = zipfile.ZipFile(zip_file, 'w', zipfile.ZIP_DEFLATED)
        for dirpath, dirnames, filenames in os.walk(basedir):
        print "zipping files:"
        for fn in filenames:
        print fn
        absfn = os.path.join(dirpath, fn)
        z.write(absfn)
        z.close 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T22:23:49.000

无论您作为 zip_file 传递给函数的任何内容都将是 ZipFile 对象将写入的文件。因此，如果您将完整路径传递给它，那么它将被放在那里。如果您只传递一个文件名，那么它将被写入当前工作路径下的该文件名。听起来您只需要确保 zip_file 是绝对路径。

# database - 如何创建无法访问数据的 Web 应用程序？

> ID：306830
> 
> 赞同：8
> 
> 时间：2008-11-20T20:54:09.960
> 
> 标签：database, security, encryption

*前提*：即将到来的项目的要求包括除了授权用户之外没有人可以访问某些数据的事实。这通常很好，但这种情况并不常见。要求规定，即使是程序员或任何其他 IT 员工也无法访问此信息。（他们希望我永远无法看到它来存储它。）

在我想出的所有场景中，我总能找到访问数据的方法。让我来描述其中的一些。

**方案 I：**限制实时数据库上的表，以便只有 SQL 管理员可以直接访问它。
**技巧 1：**我推出了一项更改，将数据发送到不同的表以供以后查看。此外，SQL 管理员可以查看数据，这违反了要求。

**场景二：**加密数据，使其需要密码才能解密。这个密码只有用户知道。每次创建新记录以及每次检索旧记录中的数据时都需要它。加密/解密将在 JavaScript 中进行，因此密码永远不会发送到服务器，在那里它可以被记录或嗅探。
**Hack II：**推出一项更改，在 javascript 中记录按键并将它们发送回服务器，以便我可以检索密码。或者，推出一项更改，将未加密的数据简单地存储在一个隐藏字段中，该字段可以发布到服务器以供以后查看。

**场景三：**与场景二一样，只是加密/解密发生在我们无法控制的网站上。这个神奇的网站将允许用户输入密码和加密或纯文本数据，然后使用 javascript 解密或加密该数据。然后，用户只需复制加密文本并将其放入字段中以获取新记录。他们还必须使用该站点来查看旧记录的纯文本。
**Hack III：**除了在他们的系统上安装一个成熟的键盘记录器外，我不知道如何破解这个。

所以，场景三看起来很有希望，但对用户来说很麻烦。还有其他我可能忽略的可能性吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-20T21:00:59.697

如果您可以在页面上使用 javascript，那么我认为您无能为力。如果您可以在浏览器中看到它，那么这意味着它在 DOM 中，这意味着您可以编写脚本来获取它并在解密后将其发送给您。

这些问题通常不是通过控件解决的吗：

1.  所有程序员都需要一定程度的许可和背景调查
2.  他们接受过培训，了解推出代码来访问数据是一种可激发或更严重的罪行
3.  某些领域的每一次变化都需要某种形式的签署

例如——没有签名的页面上没有 JavaScript。

如果您被允许添加任何您想要的代码，那么总会有办法，IMO。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T21:02:28.260

要求客户提供一份保密协议供您签署、签署，然后查看所需的尽可能多的数据。

我想知道的是，你到底能用加密数据*做*什么？几乎所有应用程序都要求您对数据进行*一些*过滤，无论是将其移动到所需位置、修改、清理还是显示。否则，你只是一个美化的管道，你不需要做任何工作。

我能想到的唯一方法是您不会查看数据或对其进行任何操作，这将是使用 CRUD 选项的简单表格映射。如果您知道数据将采用什么格式，因为您应该能够使用 RoR（一个简单的皮肤）推出一些东西，将 SSL 混合在一起，然后推出。使用相同格式的虚拟数据进行测试，然后您就设置好了。

事实上，您的客户是否无法提供虚拟数据进行测试？如果他们可以，那么您的生活很简单，因为您所做的只是提供“可安装”并告诉他们如何编辑配置文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T21:08:54.750

我认为您仍然可以通过以下方式创建应用程序：

1.  创建一个开发数据库并为其设置一个用户。
2.  询问他们：需要在屏幕上显示的每个字段的数据类型、大小和名称。
3.  设置屏幕，在数据库中创建接受它们指定的数据类型和大小的列。
4.  将应用程序部署到生产环境，并连接到一个空数据库。让有权限的人（不是您）进入并为数据库用户设置密码，并在 Web 应用程序中为数据库用户设置密码。
5.  然后，授权用户可以做他们想做的任何事情，而您永远不会看到任何数据的样子。

当然，维护应用程序和调试将是一个婊子！

——回复评论：

6.  好的，所以在数据库和 Web 应用程序的配置中为用户名设置密码后，编写一个连接到数据库的程序，设置一个随机密码，然后将相同的随机密码写入 Web 配置。

7.  阻止任何从机器传出的数据包，除了一组授权的工作站——这样你就不能安装你的间谍软件。

8.  然后将两台服务器上的Admin密码设置为相同的随机密码，然后删除服务器上所有其他用户，删除程序，删除程序源代码。

9.  用 DOD 算法擦拭开发者机器的硬盘，然后将它们扔进工业碎纸机。

## **10\. 如果服务器需要调试，把它扔进垃圾桶，买一个新的，然后从 #1 开始。**

但说真的 - 这是一个无法解决的问题。最好的答案真的是：

告诉他们他们不能申请。把你的东西写在纸上。把它放在一个文件夹里。把它锁在保险库里。推，重复。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T21:02:29.710

场景 3 不会只是将所有数据暴露给魔法网站吗？这听起来不像是一个可以解决的问题（至少我想不出一个解决方案）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-20T21:08:01.227

选择对您来说最容易实施的任何解决方案，我认为需求表明客户不了解软件开发，因此应该很容易推销您采用的任何方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-20T21:36:36.147

我不得不说我真的不喜欢在客户端使用 JavaScript 来解密数据的想法。这是一个巨大的漏洞，因为任何脚本（黑客、GreaseMonkey、IE7Pro 等）都可以访问 DOM 并从页面中获取数据。

此外，很难解决击键记录器的问题。如果你把它们混在一起，那么你的选择是有限的。此时，您需要一个安全 FOB，例如 RSA（通常与企业 VPN 一起使用）来生成真正随机的 PIN。这可能会很昂贵，而且很痛苦，我只看到它与 VPN 一起使用，但我认为它也可以与网站一起使用。

就网站而言，我会坚持使用 HTTPS，并找到一种通过 WebServer 加密/解密的方法，而不是依赖 JavaScript。SSL 流量不太容易被嗅探（非常难以解密），因此允许加密和解密发生在服务器端（恕我直言）更安全。

以银行场景和其他金融机构为起点，然后从那里开始。如果可能，尽量不要过于复杂。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-20T21:44:21.763

只要您可以访问数据所在的服务器，就不能保证不会入侵数据。因此，告诉雇主他们必须将数据托管在其他地方，并通过安全的 HTTPS 连接授予对*客户端浏览器的访问权限。*

您可以将网页设计为安全地动态加载 XML 数据流，并使用客户端上的 XSLT 脚本将其格式化为网页。

有关示例，请参见[http://www.w3schools.com/xsl/xsl_client.asp](http://www.w3schools.com/xsl/xsl_client.asp)

这样您就可以生成代码，但您永远无法访问数据。只有用户有权访问自己的数据。

至于雇主如何在不授予任何 IT 人员访问权限的情况下托管数据，这是他们的问题。这是一个愚蠢的要求。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-20T21:46:08.437

我想我会告诉他们，要么他们必须信任我们中的几个人才能访问（而不是看它），要么他们没有得到项目。

感谢您的回答。如果您有更多想法，请随时发表。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-20T21:21:39.437

您永远不可能拥有 100% 的安全性，而额外的安全性是以速度/价格/便利等为代价的。

假设您采用场景 3 - 您的一位程序员可以使用社会工程从其中一位用户那里获取密码。再见安全。

如果人们可以绕过它，那么将高度安全的铁门用作大门是没有意义的。只需实施适当的安全级别即可。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T05:28:00.407

> （他们希望我永远无法看到它来存储它。）

嘿，唱片业希望人们能够听到他们的音乐，但不能复制它。听起来他们应该在某个时候聚在一起！

他们的想法行不通的原因与 DRM 行不通的原因相同：信任链本身就受到损害。加密示例通常使用 Alice、Bob 和 Charlie，其中 Alice 试图在没有 Charlie 监听的情况下与 Bob 通信。使用 DRM，信任链受到损害，因为 Bob 和 Charlie 是同一个人。根据您的情况，Charlie 是编写 Alice 和 Bob 用来交流的软件的人。有一种隐含的信任，因为如果你不信任查理，那么你也不能信任查理的软件。

这就是问题的根源：信任。如果他们不能信任程序员，游戏还没开始就结束了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-11T22:22:40.637

根据他们的真正目标，有很多选择，但我对他们的偏执狂，呃，意图感到困惑：

*   这是*他们*（和最终用户）希望保密的数据还是最终用户数据对所有人保密？
*   仅仅是*您的*（或任何签约的）公司是可疑的吗？
*   他们害怕通过网络窥探吗？
*   他们是否害怕通过 JavaScript 或浏览器插件访问 DOM？

他们是否计划分阶段部署？在这种情况下，您在没有真实数据的测试/开发服务器上工作，但无法访问具有真实数据的生产服务器，并且 DNS 日志记录和/或防火墙规则会阻止您的所有黑客行为未被发现。

最终，如果数据存储在数据库中，那么程序员和数据库管理员可以通过合作获得它。时期。不过，良好的审计应该会发现这一点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-20T21:04:28.253

如果这确实是一项要求，那么防止这种情况发生的唯一方法是在发布软件之前聘请外部公司来审核代码，这将非常昂贵。

# c# - WPF XAML 全局参考

> ID：306839
> 
> 赞同：4
> 
> 时间：2008-11-20T20:59:10.060
> 
> 标签：c#, wpf, xaml

有没有办法重用第 3 方控件引用？

例如，我在 App.xaml 中引用了这个

```
xmlns:cust="clr-namespace:ThirdParty.Controls;assembly=ThirdParty.Controls" 
```

我不想在每个需要来自库的控件的页面/控件上重复这个第 3 方控件 xml 命名空间。

无论如何集中这些引用并使用此处定义的前缀？每个控件具有不同前缀的可能性也令人担忧。在 asp.net 中，您将在 web.config 中放置一个引用，并且它在全球范围内可用，我只是想看看 WPF 中是否有类似的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T21:53:45.503

我在想两个选择

1）将该控件包装到 UserControl 中，然后在所有地方使用您的 UserControl。

2）在某处将第三方控件声明为资源，然后在其他地方使用 DynamicResource 引用。

第二个选项可以如下实现。

无论您想要第三方控件在哪里放置 ContentControl，如下所示

```
<ContentControl Template="{DynamicResource thirdPartyControlTemplate}" /> 
```

ControlTemplate 将位于资源文件或 App.Xaml 中，如下所示。

```
 xmlns:thridParty="clr-namespace:WpfCustomControlLibrary1;assembly=WpfCustomControlLibrary1"                >
<Application.Resources>
    <ControlTemplate x:Key="thirdPartyControlTemplate" TargetType="{x:Type ContentControl}">
        <thridParty:ThirdPartyControl />
    </ControlTemplate>
</Application.Resources> 
```

您可以看到命名空间声明将始终在此资源文件上，您将能够从任何地方使用该 Control 控件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T22:07:58.797

以 Label 的内置控件模板为例：

```
<ControlTemplate TargetType="Label" 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:s="clr-namespace:System;assembly=mscorlib" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"> 
```

[Show Me The Template](http://www.sellsbrothers.com/tools/#ShowMeTheTemplate)对于这类事情来说是一个非常有用的资源。高温高压

# makefile - 为多个操作系统创建一个makefile，这个make（ext？）不起作用？

> ID：306840
> 
> 赞同：1
> 
> 时间：2008-11-20T20:59:13.257
> 
> 标签：makefile, multiple-makefiles

我有一个使用 mingw32 构建的工作 makefile。现在我将该makefile重命名为Makefile.w32（来源-> [http://pastie.org/319964](http://pastie.org/319964)）

现在我有一个带有以下内容的 Makefile。问题是，它没有构建我的源

```
all:
    make mingw32

clean:
    @echo "causes an infinite loop -> make mingw32 clean"

mingw32:
    @echo "yeahhhhhhhhh"
    make Makefile.w32

mingw32-clean:
    @echo "mingw clean"
    make Makefile.w32 clean 
```

结果：

```
> "make" 
make mingw32
make[1]: Entering directory `/c/nightly/test'
yeahhhhhhhhh
make Makefile.w32
make[2]: Entering directory `/c/nightly/test'
make[2]: Nothing to be done for `Makefile.w32'.
make[2]: Leaving directory `/c/nightly/test'
make[1]: Leaving directory `/c/nightly/test' 
```

在我看来，它不喜欢 Makefile.w32 扩展名。我不明白为什么它没有建立。它很明显进入了我的“make Makefile.w32”行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T21:06:01.183

“make Makefile.w32”正在寻找名为 Makefile.w32 的**目标**，而不是该名称的 make 文件。要运行 make 并告诉它读取 make 文件“Makefile.w32”，请使用 -f 开关：

```
make -f Makefile.w32 
```

**编辑**：顺便说一句，如果你想要的只是让“all”依赖于同一个make文件中的“mingw32”目标，为什么要在“all”目标中启动一个单独的make实例？恕我直言，最好将其声明为依赖目标：

```
all: mingw32 
```

与 "clean" 和 "mingw32-clean" 类似：

```
clean: mingw32-clean 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T21:07:34.317

您可以使用[cmake](http://cmake.org/)生成 makefile。它应该适用于大多数平台。

# .net - 构建批量邮件发件人

> ID：306844
> 
> 赞同：3
> 
> 时间：2008-11-20T21:01:00.913
> 
> 标签：.net, email, bulk

我想构建一个应用程序，允许我的客户通过电子邮件发送营销信息。这将是一个经过仔细监控的工具，仅用于合法的批量邮寄。它将具有所有必要的“取消订阅”功能等。

该解决方案将使用 VB.NET 构建。

我的问题与实际发送电子邮件的最佳方式有关。我们的数据中心有一个可以使用的 SMTP 服务器。我想我们可以编写某种多线程 Windows 服务来监视要发送的电子邮件数据库，然后调用 System.Net.Mail API 以通过该服务器发送。

这是否会给我在合理的时间范围内向数千名用户发送邮件所需的性能水平？

如果不是，我是否应该考虑在“较低级别”做事，在一个线程中执行 DNS 查找，在另一个线程中的端口 25 上直接发送到相关服务器，等等？

任何指针将不胜感激！

* * *

不是一个真正的答案 - 但对于任何感兴趣的人来说都是一个更新......我目前正在查看[ActiveUp](http://www.activeup.com)的一个名为 ActiveMail 的产品。

这似乎是一个 MTA（执行它自己的 MX 查找并直接发送邮件），它带有一个多线程队列应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-24T11:52:43.813

我认为自己推出这样的东西并不难。建造需要一天左右的时间。但是你应该更好地使用现有的东西。

不过，在使用 Bulk-Email 时，我发现一些重要的事情：

**不要使用您自己的 SMTP 发送这些邮件。**

查找收件人的 MX 条目并将 SMTPClient 连接到*他们的*SMTP，这样您就可以在找不到邮箱或其他错误时立即收到错误消息，并且您不会对自己的服务器造成压力。

SmtpClient 中还有一个小错误给我带来了麻烦，因为主机名不是完全限定的域名（按照 SMTP 规范的要求），而是机器名（这是 SmtpClient 中的内部字段）。一些 SMTP 服务器非常重视这一点并想要一个域名，所以我最终将该字段设置为反射到 FQDN。（希望这已经改变了）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T11:05:03.003

首先得到一个组件来完成繁重的工作。我会推荐：[aspnetmail](http://www.aspnetemail.com)

然后设置群发邮件就像下载一些示例代码一样简单。
[WebMailer：从网页发送 1000 封电子邮件而不会超时。](http://www.aspnetemail.com/samples/webmailer.aspx)

同一供应商还提供 mx 记录检查器/退回邮件检查器等。此解决方案不是免费的，但您节省的时间不追逐标准邮件组件中的错误/不一致将使您值得一试。

哦，如果你想要一个位于桌面上的批量邮件，也提供： [http ://www.aspnetemail.com/rapidmailer/](http://www.aspnetemail.com/rapidmailer/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T22:43:48.040

这个问题不够精确，但无论如何我都会尝试回答。有几个因素限制了您的选择。最好的“方式”真的取决于你的情况。你工作的最后期限是什么？

与您提到的其他选项相比，实施大型、低级、多线程邮件发送系统将花费大量时间。当然，从头开始编写整个事情比使用 SMTP 服务器和 .NET 库发送邮件要优雅得多。

还有不同数据之间的带宽问题。.NET 应用程序和数据库是否会与 SMTP 在同一台服务器上运行？如果不是，带宽管道将如何限制每秒发送的最大邮件数？

就我个人而言，我非常喜欢保持简单。如果时间紧迫，重用可用软件是明智之举。您多久会发送数千封邮件？该间隔将定义时间范围是否合理。它是不是太小了，以至于当另一个版本准备好发送出去时，系统仍然在处理第一个“批次”？

# c# - 在 C# 中，如何捕获 Web 服务调用中使用的 SOAP？

> ID：306852
> 
> 赞同：16
> 
> 时间：2008-11-20T21:05:39.157
> 
> 标签：c#, web-services, soap

我有一个 C# 应用程序，它是 Web 服务的客户端。我的要求之一是允许捕获我发送的 SOAP，这样如果出现问题，我可以修复错误，或者证明问题出在我正在调用的服务中。

`System.Web.Services.Protocols.SoapHttpClientProtocol`我的 WebReference 代理服务类照常派生。如果我有一根魔杖，我会让这个基类实现一个`OnPost`我可以处理的事件，以便将 SOAP 写入我的日志并继续。

如果没有运行像 WireShark 这样的数据包嗅探器，有没有一种简单的方法来获得这种级别的日志记录？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-20T21:08:44.517

我认为您正在寻找的内容已在此问题中得到解决：

[从 ASP.net 中运行的 Web 参考客户端获取 RAW Soap 数据](https://stackoverflow.com/questions/300674/getting-raw-soap-data-from-a-web-reference-client-running-in-aspnet)

虽然它看起来像很多代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T21:28:56.410

如果应用程序在您的本地机器上运行并且 Web 服务没有做任何时髦的事情，您可以使用 Fiddler。启动 IE，运行 Fiddler，你会看到你的 web 服务调用也通过了 fiddler 的代理。

我今天早上刚刚用这个来做几乎同样的事情。我必须证明我的网络服务发送的数据没有搞砸。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-06T02:01:49.037

要在提琴手中查看此流量，请使用以下代码：

```
mySoapHttpClientProtocol.Url = mySoapHttpClientProtocol.Url.Replace("localhost", "localhost.fiddler"); 
```

否则，Visual Studio 的内置 Web 服务器将绕过所有代理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T21:11:53.700

看看[SoapExtensions](http://msdn.microsoft.com/en-us/library/ms972353.aspx)。

他们是你需要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-25T11:24:17.433

由于某种原因，在使用 Visual Studio 附带的 ASP.NET 开发服务器时，Fiddler 没有显示我的本地服务调用。为了解决这个问题，我在运行时将 Web 服务 Url 更改为 Fiddler 端口，只是为了捕获 SOAP 消息。

您可以从“立即”窗口执行此操作，例如：

myservice.Url = "localhost:8888" （或者你有 Fiddler 的任何端口）

我使用 SoapUI 客户端来测试响应。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-03T12:26:44.760

只是 ”。” 在“localhost”之后添加端点中的地址。像这样：

```
 <endpoint address="http://localhost.:8868/FEInvoice.asmx" binding="basicHttpBinding"
    bindingConfiguration="FEInvoice_Test" contract="EInvoiceIntegration.FEInvoiceSoap"
    name="FEInvoice_Test" /> 
```

# c# - 选择/突出显示时 ToolStripMenuItem 不在可见区域

> ID：306859
> 
> 赞同：4
> 
> 时间：2008-11-20T21:08:42.350
> 
> 标签：c#, winforms

我有一个 ContextMenuStrip，其中包含动态生成的 ToolStripMenuItems 的子菜单。最多有 80 个子菜单项。按所需菜单项的第一个字母会正确选择它，但如果该项目恰好超出可见范围（在滚动箭头处理的范围内），则不会显示 - 用户必须按向上箭头然后向下箭头显示所需选项并聚焦在屏幕上。

例如，我有 6 个以“m”开头的项目，但只有 3.5 个可见。我按 m 一个，第一个项目突出显示，我再按 m 3 次，我可以看到半个选定的行（它在可见区域的底部），再按 m 两次，我看不到选择行，然后再 m 一次，第一个 m 条目可见并再次被选中。

默认情况下 ToolStripMenuItems (TSMI) 没有可用的关键侦听器，但是如果我将 TSMI 子类化，我可以捕获 ProcessDialogKey 和 ProcessCmdKey 并手动选择正确的选项，但我无法向下滚动工具条子菜单以确保我的选项可见.

关于如何的任何提示：

**a)**滚动工具条的子菜单

或者

**b)**允许子菜单使用多个列（并希望用户没有低得离谱的分辨率）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T22:18:40.890

我遇到了这个问题。我不记得确切的解决方案（如果找不到，请告诉我），但基本上，ToolStripMenu 具有“最顶层项目索引”的属性。

只需将新选择的项目（例如，第 4 个“m”）设置为最顶部的项目索引，WinForms 将处理其余的。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T21:58:25.260

您是否尝试过该`KeyPress`活动`ContextMenuStrip`？您可能能够检测到更改所选项目的按键，然后使用`ToolStripMenuItem.Selected`每个项目的属性来确定选择了哪个项目。然后使用`AutoScrollOffset`将`ContextMenuStrip`项目滚动到视图中。

或者，您可以改用旧`ContextMenu`控件 - 它的项目有一个`Select`事件。

# java - 在 Java 中对变量使用 final 会改善垃圾收集吗？

> ID：306862
> 
> 赞同：89
> 
> 时间：2008-11-20T21:08:55.283
> 
> 标签：java, garbage-collection, final

今天我和我的同事讨论了`final`在Java中使用关键字来改进垃圾收集。

例如，如果您编写如下方法：

```
public Double doCalc(final Double value)
{
   final Double maxWeight = 1000.0;
   final Double totalWeight = maxWeight * value;
   return totalWeight;  
} 
```

在方法中声明变量`final`将有助于垃圾收集在方法退出后从方法中未使用的变量中清理内存。

这是真的？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-11-20T21:46:09.230

这是一个稍微不同的示例，一个具有最终引用类型字段而不是最终值类型局部变量的示例：

```
public class MyClass {

   public final MyOtherObject obj;

} 
```

每次创建 MyClass 的实例时，都会创建对 MyOtherObject 实例的传出引用，并且 GC 必须按照该链接查找活动对象。

JVM 使用标记扫描 GC 算法，该算法必须检查 GC“根”位置中的所有活动引用（就像当前调用堆栈中的所有对象一样）。每个活动对象都被“标记”为活动的，并且活动对象引用的任何对象也被标记为活动的。

标记阶段完成后，GC 扫过堆，为所有未标记的对象释放内存（并为剩余的活动对象压缩内存）。

此外，重要的是要认识到 Java 堆内存被划分为“年轻一代”和“老一代”。所有对象最初都在年轻代（有时称为“托儿所”）中分配。由于大多数对象都是短暂的，GC 更积极地从年轻代中释放最近的垃圾。如果一个对象在年轻代的收集周期中幸存下来，它就会被移入老年代（有时称为“老年代”），而老年代的处理频率较低。

所以，在我的脑海中，我会说“不，'final' 修饰符不会帮助 GC 减少它的工作量”。

在我看来，在 Java 中优化内存管理的最佳策略是尽快消除虚假引用。您可以通过在使用完对象引用后立即将“null”分配给它来做到这一点。

或者，更好的是，最小化每个声明范围的大小。例如，如果您在 1000 行方法的开头声明一个对象，并且如果该对象在该方法的范围关闭（最后一个闭合花括号）之前保持活动状态，那么该对象可能会比实际保持活动更长时间必要的。

如果您使用只有十几行代码的小方法，那么在该方法中声明的对象将更快地超出范围，而 GC 将能够在效率更高的范围内完成大部分工作年轻一代。除非绝对必要，否则您不希望将对象移入老一代。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-20T21:25:25.497

声明一个局部变量`final`不会影响垃圾回收，它只意味着你不能修改这个变量。上面的示例不应编译，因为您正在修改`totalWeight`已标记的变量`final`。另一方面，声明一个原语（`double`而不是`Double`）`final`将允许将该变量内联到调用代码中，这样可能会导致一些内存和性能改进。当您`public static final Strings`在班级中有很多人时使用此选项。

一般来说，编译器和运行时会尽可能优化。最好适当地编写代码，不要试图太棘手。`final`当您不想修改变量时使用。假设编译器将执行任何简单的优化，如果您担心性能或内存使用，请使用分析器来确定真正的问题。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-11-20T21:23:36.267

不，这绝对不是真的。

请记住，`final`这并不意味着恒定，它只是意味着您不能更改参考。

```
final MyObject o = new MyObject();
o.setValue("foo"); // Works just fine
o = new MyObject(); // Doesn't work. 
```

基于 JVM 永远不必修改引用（例如无需检查它是否已更改）的知识，可能会有一些小的优化，但它会很小以至于不用担心。

`Final`应该将其视为对开发人员有用的元数据，而不是编译器优化。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-06-19T18:25:19.960

需要澄清的几点：

*   取消引用不应该帮助 GC。如果是这样，则表明您的变量超出了范围。一个例外是客体裙带关系的情况。

*   到目前为止，Java 中还没有堆栈分配。

*   声明一个变量 final 意味着您不能（在正常情况下）为该变量分配一个新值。由于 final 没有说明范围，因此它没有说明它对 GC 的影响。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-20T21:13:29.657

好吧，我不知道在这种情况下使用“final”修饰符，或者它对 GC 的影响。

但是我*可以*告诉你：你使用盒装值而不是原始值（例如，双精度而不是双精度）将在堆而不是堆栈上分配这些对象，并且会产生 GC 必须清理的不必要的垃圾。

我只在现有 API 需要时使用盒装原语，或者当我需要可为空的原语时。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-08-30T08:16:29.960

初始赋值后（由编译器强制执行），最终变量不能更改。

这不会改变*垃圾收集*的行为。唯一的问题是，这些变量在不再使用时不能为空（这可能有助于在内存紧张的情况下进行垃圾收集）。

您应该知道 final 允许编译器对要优化的内容做出假设。内联代码，不包括已知不可访问的代码。

```
final boolean debug = false;

......

if (debug) {
  System.out.println("DEBUG INFO!");
} 
```

println 不会包含在字节码中。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-20T22:26:37.607

分代垃圾收集器有一个不太为人所知的极端案例。（有关简要说明，请阅读[benjismith](https://stackoverflow.com/questions/306862/does-using-final-for-variables-in-java-improve-garbage-collection#306966)的答案，以获得更深入的了解，请阅读最后的文章）。

世代 GC 的想法是大多数时候只需要考虑年轻一代。扫描根位置的引用，然后扫描年轻代对象。在这个更频繁的扫描期间，没有检查老一代中的任何对象。

现在，问题来自一个对象不允许引用年轻对象的事实。当长寿命（老一代）对象获得对新对象的引用时，垃圾收集器必须显式跟踪该引用（参见 IBM 关于[热点 JVM 收集器](http://www.ibm.com/developerworks/java/library/j-jtp11253/)的文章），实际上会影响 GC 性能。

旧对象不能引用年轻对象的原因是，由于旧对象没有在次要集合中检查，如果对对象的唯一引用保存在旧对象中，它不会被标记，并且会被错误地标记在扫描阶段释放。

当然，正如许多人所指出的，final 关键字并不会真正影响垃圾收集器，但它确实保证了如果该对象在次要收集中幸存并进入较旧的堆，则该引用永远不会更改为较年轻的对象。

文章：

IBM 谈垃圾收集：[历史](http://www.ibm.com/developerworks/java/library/j-jtp10283/)、[热点 JVM](http://www.ibm.com/developerworks/java/library/j-jtp11253/)和[性能](http://www.ibm.com/developerworks/java/library/j-jtp01274.html)。这些可能不再完全有效，因为它可以追溯到 2003/04，但它们提供了一些易于阅读的 GC 洞察力。

Sun on [Tuning 垃圾收集](http://java.sun.com/docs/hotspot/gc1.4.2/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-20T21:56:43.563

GC 作用于无法访问的引用。这与“final”无关，后者只是一次性赋值的断言。是否有可能某些 VM 的 GC 可以使用“final”？我不明白如何或为什么。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-25T18:16:03.383

`final`局部变量和参数对生成的类文件没有影响，因此不会影响运行时性能。如果一个类没有子类，HotSpot 将该类视为无论如何都是最终的（如果加载了打破该假设的类，它可以稍后撤消）。我相信`final`方法与类非常相似。`final`在静态字段上可能允许将变量解释为“编译时常量”，并在此基础上由 javac 进行优化。`final`on fields 允许 JVM 有一些自由来忽略*之前发生的*关系。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-17T18:52:38.167

似乎有很多答案是游荡的猜想。事实是，**字节码级别的局部变量没有 final 修饰符。** 虚拟机永远不会知道您的局部变量是否定义为最终变量。

你的问题的答案是肯定的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-07T21:10:59.187

默认情况下，子类中的所有方法和变量都可以被覆盖。如果我们想保存子类而不是覆盖超类的成员，我们可以使用关键字 final 将它们声明为 final。例如 `final int a=10;` `final void display(){......}` ，使方法成为最终方法可确保超类中定义的功能无论如何都不会改变。类似地，最终变量的值永远不会改变。最终变量的行为类似于类变量。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-12-18T12:57:22.890

严格来说*实例*字段，如果特定的 GC 想要利用它，`final` *可能会稍微提高性能。*当并发`GC`发生时（这意味着您的应用程序仍在运行，*而 GC 正在进行中*），请参阅[此以获得更广泛的解释](https://stackoverflow.com/questions/59044616/whats-the-mark-compact-algorithm-used-by-hotspot/59141137#59141137)，GC 在写入和/或读取完成时必须使用某些障碍。我给你的链接几乎解释了这一点，但要简短地说：当 a 进行`GC`一些并发工作时，所有对堆的读写（当 GC 正在进行时）都会被“拦截”并在稍后应用；以便并发 GC 阶段可以完成它的工作。

例如`final`字段，因为它们不能被修改（除非反射），这些障碍可以被省略。这不仅仅是纯粹的理论。

`Shenandoah GC`将它们*付诸实践*（尽管[时间不长](https://bugs.openjdk.java.net/browse/JDK-8229419)），您可以这样做，例如：

```
-XX:+UnlockExperimentalVMOptions  
-XX:+UseShenandoahGC  
-XX:+ShenandoahOptimizeInstanceFinals 
```

并且GC 算法*将进行优化*，使其速度稍快一些。这是因为没有障碍拦截`final`，因为没有人应该修改它们，永远。甚至没有通过反射或 JNI。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-20T21:21:52.433

我唯一能想到的是编译器可能会优化最终变量并将它们作为常量内联到代码中，因此最终没有分配内存。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-04-27T18:05:38.290

绝对地，只要缩短对象的寿命，从而对内存管理产生很大的好处，最近我们检查了在一个测试中具有实例变量的导出功能和另一个具有方法级局部变量的测试。在负载测试期间，JVM 在第一次测试时抛出 outofmemoryerror 并且 JVM 停止了。但在第二次测试中，由于更好的内存管理，成功地获得了报告。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-09-16T07:55:38.737

我更喜欢将局部变量声明为 final 的唯一时间是：

*   我**必须**使它们成为最终的，以便它们可以与一些匿名类共享（例如：创建守护线程并让它从封闭方法访问一些值）

*   我**想让**它们成为最终的（例如：一些不应该/不应该被错误覆盖的值）

> > > 它们有助于快速垃圾收集吗？
> > > AFAIK 如果一个对象对它的强引用为零，那么它就会成为 GC 收集的候选对象，并且在这种情况下，也不能保证它们会立即被垃圾收集。通常，当强引用超出范围或用户明确将其重新分配给空引用时，就说强引用死亡，因此，将它们声明为最终意味着引用将继续存在直到方法存在（除非其范围明确缩小到一个特定的内部块 {})，因为您不能重新分配最终变量（即不能重新分配给 null）。所以我认为垃圾收集“最终”**可能会**引入不必要的可能延迟，因此在定义范围时必须小心谨慎，因为它控制了它们何时成为 GC 的候选者。

# java - JAVA：使用 XPath 表达式构建 XML 文档

> ID：306863
> 
> 赞同：8
> 
> 时间：2008-11-20T21:09:25.407
> 
> 标签：java, xml, xpath

我知道这并不是 XPath 的真正用途，但如果我有一个 XPath 表达式的 HashMap 来表示值，我将如何构建 XML 文档。我发现 dom-4j 的 DocumentHelper.makeElement(branch, xpath) 除了它不能创建属性或索引。肯定存在可以做到这一点的图书馆吗？

```
Map xMap = new HashMap();

xMap.put("root/entity/@att", "fooattrib");
xMap.put("root/array[0]/ele/@att", "barattrib");
xMap.put("root/array[0]/ele", "barelement");
xMap.put("root/array[1]/ele", "zoobelement"); 
```

会导致：

```
<root>
<entity att="fooattrib"/>
<array><ele att="barattrib">barelement</ele></array>
<array><ele>zoobelement</ele></array>
</root> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-24T16:40:22.093

几年前我寻找过类似的东西——一种可写的 XPath。*最后，在没有找到任何东西的情况下，我通过向父*表达式添加新节点来破解了一些基本上构建 XML 文档的内容：

```
parent="/" element="root"
parent="/root" element="entity"
parent="/root/entity" attribute="att" value="fooattrib"
parent="/root" element="array"
parent="/root" element="ele" text="barelement" 
```

（这本身是由 XML 配置文件管理的，因此出现了上面的内容。）

尝试自动执行其中的一些操作以获取最后一个路径元素并加以利用是很诱人的，但我总觉得我可以编写一些 XPath 表达式，但这种愚蠢的方法会出错。

我考虑的另一种方法，虽然没有实现（以上是“足够好”），是使用优秀的 Jaxen 生成不存在的元素，如果它不存在的话。

来自[Jaxen 常见问题解答](http://jaxen.codehaus.org/faq.html)：

> 唯一需要的是接口 org.jaxen.Navigator 的实现。并非所有接口都是必需的，并且还提供了 org.jaxen.DefaultNavigator 形式的默认实现。

将`DOMWriterNavigator`wrap 和 existing `DOMNavigator`，然后`makeElement`在元素不存在时使用该方法。但是，即使使用这种方法，您也可能必须对诸如`attributes`和`text()`函数之类的 XPath 查询进行一些前/后处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-21T18:23:58.487

我能想到的最好的方法是使用 JAXB 实现，它将编组/解组对象到 xml，然后我使用 Dozer (http://dozer.sourceforge.net/documentation/mapbackedproperty.html) 映射 xpath它们是 JAXB 对象方法设置器的映射中的键。

```
<mapping type="one-way" map-id="TC1">
<class-a>java.util.Map</class-a>
<class-b>org.example.Foo</class-b>
<field>
  <a key="root/entity/@att">this</a>
  <b>Foo.entity.att</b>
  <a-hint>java.lang.String</a-hint>
</field> 
```

这更像是一个两步解决方案，但确实对我有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-08-28T03:30:46.383

我也想要自然如此动态并且不想使用 XSLT 或任何对象映射框架的同类要求，所以我已经在 java 中实现了这段代码并在上面写了博客，请访问，

[http://ganesh-kandisa.blogspot.com/2013/08/dynamic-xml-transformation-in-java.html](http://ganesh-kandisa.blogspot.com/2013/08/dynamic-xml-transformation-in-java.html)

或在 git 存储库中分叉代码，

[https://github.com/TheGanesh/DynamicXMLTransformer](https://github.com/TheGanesh/DynamicXMLTransformer)

# javascript - 如何使用 JavaScript 来识别客户端？

> ID：306867
> 
> 赞同：1
> 
> 时间：2008-11-20T21:13:00.000
> 
> 标签：javascript

我有一个问题，我无法识别我的 Intranet 页面的访问者，因为他们的浏览器配置为使用代理，即使是本地 Intranet。我总是看到代理 IP 并且没有关于客户端的其他详细信息。我公司使用的 SOE 已经为 Firefox 和 Internet Explorer 设置了代理，我不能要求他们重新配置浏览器，因为这相当复杂。我尝试过使用 PHP`$_SERVER['REMOTE_ADDR']`和一个名为`$HTTP_SERVER_VARS['HTTP_X_FORWARD_FOR']`. 事实上，我写了一个页面，列出了`$_SERVER`和`$HTTP_SERVER_VARS`数组，没有任何关于实际客户端连接的信息。这就是为什么我认为它需要在客户端完成。

我不是在寻找一个安全的解决方案，因为它只是一个简单的页面，所以我希望我可以使用 Javascript 或类似的东西来找到有关客户端的信息并将其作为`GET`变量发送到我的 Intranet 页面。它主要用于整理统计数据。告诉我大多数访问者都是代理是没有用的！:)

如果可能，我还想避免让用户登录。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T21:20:52.527

您可以使用在第一次进入时设置的具有随机唯一 ID 的 cookie，然后用于识别。可以在 JavaScript 或 PHP 中完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T21:19:42.310

我很确定没有通用的方法可以做到这一点，否则匿名代理的整个概念都会付诸东流:)

我的建议是让您的 IT 部门配置代理以填充`HTTP-X-FORWARD-FOR`或`REMOTE-ADDR`其他标识标头。

# oracle - 如何检测 Oracle 表上的特定列是否存在索引？

> ID：306871
> 
> 赞同：5
> 
> 时间：2008-11-20T21:14:52.523
> 
> 标签：oracle, indexing

存在其他人加载的表。我需要对表进行查询，但是缺少索引使得查询计划很糟糕。我想要做的是检测是否有特定列的索引，以便如果它不存在我可以创建它，如果它已经存在则不创建它。

谢谢。

邪恶的

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-20T21:24:12.507

可以查询`DBA_/ALL_/USER_IND_COLUMNS`，即

```
SQL> SELECT index_name
  2    FROM dba_ind_columns
  3   WHERE table_owner = 'SCOTT'
  4     AND table_name  = 'EMP'
  5     AND column_name = 'EMPNO';

INDEX_NAME
------------------------------
PK_EMP 
```

当然，您可能希望稍微扩展查询。这将获取 EMPNO 列出现的任何索引。您可能希望将自己限制为该列是索引的前导列 ( `COLUMN_POSITION`= 1) 的索引。或者您可能希望将自己限制为仅在该特定列上的索引（以便在 2 中没有列`COLUMN_POSITION`），即

```
SQL> ed
Wrote file afiedt.buf

  1  SELECT index_name
  2    FROM dba_ind_columns a
  3   WHERE table_owner = 'SCOTT'
  4     AND table_name  = 'EMP'
  5     AND column_name = 'EMPNO'
  6     AND column_position = 1
  7     AND NOT EXISTS( SELECT 1
  8                       FROM dba_ind_columns b
  9                      WHERE a.index_owner = b.index_owner
 10                        AND a.index_name  = b.index_name
 11*                       AND b.column_position = 2)
SQL> /

INDEX_NAME
------------------------------
PK_EMP 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T21:19:31.593

熟悉查询 SYS 模式：

```
Select * from sys.all_ind_columns where table_name=:TabName and table_owner=:TabOwner; 
```

# xml-serialization - XmlSerializer 可以反序列化为 Nullable ?

> ID：306877
> 
> 赞同：8
> 
> 时间：2008-11-20T21:16:50.867
> 
> 标签：xml-serialization, nullable, xml-nil

我想反序列化包含一个元素的 XML 消息，该元素可以标记`nil="true"`为具有 type 属性的类`int?`。我可以让它工作的唯一方法是编写我自己的`NullableInt`类型来实现`IXmlSerializable`. 有更好的方法吗？

[我在博客上](http://alexscordellis.blogspot.com/2008/11/using-xmlserializer-to-deserialize-into.html)写了完整的问题和解决方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-20T21:49:18.617

我认为您需要在 nil="true" 前面加上一个命名空间，以便 XmlSerializer 反序列化为 null。

[xsi:nil 上的 MSDN](http://msdn.microsoft.com/en-us/library/ybce7f69(VS.80).aspx)

```
<?xml version="1.0" encoding="UTF-8"?>
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="array">
  <entity>
    <id xsi:type="integer">1</id>
    <name>Foo</name>
    <parent-id xsi:type="integer" xsi:nil="true"/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-16T21:17:54.547

我的解决方法是预处理节点，修复任何“nil”属性：

```
public static void FixNilAttributeName(this XmlNode @this)
{
    XmlAttribute nilAttribute = @this.Attributes["nil"];
    if (nilAttribute == null)
    {
        return;
    }

    XmlAttribute newNil = @this.OwnerDocument.CreateAttribute("xsi", "nil", "http://www.w3.org/2001/XMLSchema-instance");
    newNil.Value = nilAttribute.Value;
    @this.Attributes.Remove(nilAttribute);
    @this.Attributes.Append(newNil);
} 
```

我将此与对子节点的递归搜索相结合，因此对于任何给定的 XmlNode（或 XmlDocument），我可以在反序列化之前发出单个调用。如果您想保持原始内存结构不变，请使用 XmlNode 的 Clone()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-29T10:02:22.437

非常懒惰的方式来做到这一点。由于多种原因，它很脆弱，但我的 XML 足够简单，足以保证进行如此快速而肮脏的修复。

```
xmlStr = Regex.Replace(xmlStr, "nil=\"true\"", "xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:nil=\"true\""); 
```

# java - 在 java 数组列表中搜索正则表达式

> ID：306880
> 
> 赞同：16
> 
> 时间：2008-11-20T21:19:19.987
> 
> 标签：java, regex, search, arraylist

```
ArrayList <String> list = new ArrayList(); 
list.add("behold");
list.add("bend");
list.add("bet");
list.add("bear");
list.add("beat");
list.add("become");
list.add("begin"); 
```

有一种方法可以搜索正则表达式 bea.* 并获取 ArrayList.indexOf 中的索引？

编辑：返回项目很好，但我需要比线性搜索性能更高的东西

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-20T21:56:27.730

爱马仕的基础知识是正确的。如果你想要字符串而不是索引，那么你可以通过使用 Java 5 foreach 循环来改进：

```
import java.util.regex.Pattern;
import java.util.ListIterator;
import java.util.ArrayList;

/**
 * Finds the index of all entries in the list that matches the regex
 * @param list The list of strings to check
 * @param regex The regular expression to use
 * @return list containing the indexes of all matching entries
 */
List<String> getMatchingStrings(List<String> list, String regex) {

  ArrayList<String> matches = new ArrayList<String>();

  Pattern p = Pattern.compile(regex);

  for (String s:list) {
    if (p.matcher(s).matches()) {
      matches.add(s);
    }
  }

  return matches
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-20T21:44:06.460

有内置方法吗？从来没听说过。但是，自己做应该很容易。这是一些完全未经测试的代码，应该可以为您提供基本概念：

```
import java.util.regex.Pattern;
import java.util.ListIterator;
import java.util.ArrayList;

/**
 * Finds the index of all entries in the list that matches the regex
 * @param list The list of strings to check
 * @param regex The regular expression to use
 * @return list containing the indexes of all matching entries
 */
List<Integer> getMatchingIndexes(List<String> list, String regex) {
  ListIterator<String> li = list.listIterator();

  List<Integer> indexes = new ArrayList<Integer>();

  while(li.hasNext()) {
    int i = li.nextIndex();
    String next = li.next();
    if(Pattern.matches(regex, next)) {
      indexes.add(i);
    }
  }

  return indexes;
} 
```

我可能对 Pattern 和 ListIterator 部分的使用有点错误（我从来没有使用过），但这应该给出基本的想法。您还可以在迭代器上执行简单的 for 循环而不是 while 循环。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T21:44:45.710

一种选择是使用[Apache Commons CollectionUtils](https://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/CollectionUtils.html) “选择”方法。您需要创建一个 Predicate 对象（具有单个“评估”方法的对象，该方法使用正则表达式检查匹配并返回 true 或 false），然后您可以在列表中搜索匹配的项目。但是，它不会返回索引，它会返回一个包含项目本身的集合。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-06-30T09:38:39.367

这是番石榴中的一个衬里：

```
final Iterable<String> matches = Iterables.filter(myStrings, Predicates.contains(Pattern.compile("myPattern")));

for (final String matched : matches) {
   ...
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T21:43:20.127

我不相信有这样做的 Java API 方式，也没有这样做的 Apache Commons 方式。然而，自己动手并不难。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-27T12:08:19.333

当我们谈论大型列表时，将它们与 Java8 内置函数并行处理是有意义的。

```
@Test
public void testRegexPerformance()
{
    List<String> list = new ArrayList<>();
    list.add("behold");
    list.add("bend");
    list.add("bet");
    list.add("bear");
    list.add("beat");
    list.add("become");
    list.add("begin");
    for (int i = 0; i < 20; i++)
    {
        list.addAll(list);
    }
    System.out.println("Original list size: " + list.size());
    Instant startTime = Instant.now();
    List<String> results = testLoopApproach(list, "bea.*");
    Instant current = Instant.now();
    System.out.println("Found List size: " + results.size());
    System.out.println("Elapsed millis: " + (current.toEpochMilli() - startTime.toEpochMilli()));
    startTime = Instant.now();
    results = testStreamApproach(list, "bea.*");
    current = Instant.now();
    System.out.println("Found List size: " + results.size());
    System.out.println("Elapsed millis: " + (current.toEpochMilli() - startTime.toEpochMilli()));
}

private List<String> testStreamApproach(List<String> list, String regex)
{
    Predicate<String> pred = Pattern.compile(regex).asPredicate();
    return list.parallelStream().filter(pred).collect(Collectors.toList());
}

private List<String> testLoopApproach(List<String> list, String regex)
{
    Pattern p = Pattern.compile(regex);
    List<String> resulsts = new ArrayList<>();
    for (String string : list)
    {
        if (p.matcher(string).find())
        {
            resulsts.add(string);
        }
    }
    return resulsts;
}

and the results are:
Original list size: 7340032
Found List size: 2097152
Elapsed millis: 1785
Found List size: 2097152
Elapsed millis: 260 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-10-07T16:11:52.323

这将是线程复兴，但可能对某人有用。您可能不需要索引，可能下一步将对匹配正则表达式的项目做一些事情，因此您要求索引。但是您可以使用 Java8 流和 lambda 表达式：

```
 import java.util.regex.Pattern;
  import java.util.stream.Collectors;
  import java.util.List;

  ...

  var pattern = Pattern.compile(define);  // var is Java 10 feature

  List<String> list = originalList
      .stream()
      .filter(e -> pattern.matcher(e).matches())
      .collect(Collectors.toList()); 
```

您可以获取原始列表，将其转换为流，在其上运行过滤器，该过滤器运行 lambda 以匹配您的模式并将其转换回列表。但是您可以将其保留为流并使用另一个 lambda 表达式在其上运行 .foreach。

# asp.net - 没有为 ASP.NET Web 应用程序加载程序集

> ID：306891
> 
> 赞同：0
> 
> 时间：2008-11-20T21:22:50.887
> 
> 标签：asp.net, assemblies

我有一个引用外部 DLL 的 Web 应用程序（我们称之为 productA.dll）

我已经更新了我的 GAC、我`web.config`的 和我的参考资料，检查了版本，一切看起来都是一致的。

但是，当我运行我的应用程序时，`productA.dll`无法调用我使用的方法，并且出现`the specified module cannot be found`错误。

我尝试创建一个 Windows 应用程序，我可以使用得`productA.dll`很好。

在 Web 应用程序运行时观察输出窗口，我注意到`productA.dll`符号没有加载。所以我猜这就是找不到模块的原因。

问题是：为什么没有加载符号？

任何有关解决方案或诊断技术的提示将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:11:50.553

程序集不需要在 GAC 中。我会说检查以下内容：

1.  您的程序集位于网站的 bin 文件夹中。
2.  您的程序集在 web.config 的程序集部分中引用。
3.  web.config 中的程序集引用具有正确的版本号。

顺便说一句，只有在程序集旁边有调试文件 (.pdb) 时才会加载符号。

# c# - 您在 C# 中使用哪些命名约定？

> ID：306894
> 
> 赞同：6
> 
> 时间：2008-11-20T21:24:12.397
> 
> 标签：c#, naming-conventions

作为一名初级程序员，我正在尝试为自己制定一个标准的命名约定。我意识到这是个人喜好，但我试图从比我聪明得多的你们中的一些人（很多人）那里得到一些想法。

我不是在谈论骆驼符号，而是如何命名变量等。恕我直言，var_Quantity 比 Q 或 varQ 更具描述性。但是，如何防止变量变得太长。我试图在命名我的控件时更具描述性，但我最终得到了一些像“rtxtboxAddrLine1”这样的 RadTextBox，它包含地址行 1。对我来说，这是无法管理的，尽管很清楚该控件是什么。

我只是好奇你是否有一些你遵循的指南，或者我是否留给我自己的设备？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-20T21:33:25.093

一些[基本规则可以在这里找到](http://msdn.microsoft.com/en-us/library/ms229045.aspx)。[更多扩展规则可以在这里](http://msdn.microsoft.com/en-us/library/ms229002.aspx)找到。这些是来自 Microsoft 框架设计者的官方指南。

至于您的示例，应该简单地调用该变量`quantity`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-20T21:36:43.010

在这种情况下，我认为您最好将其命名为 primaryAddressLine 或 firstAddressLine。这就是为什么 - rtxt 作为前缀无用地告诉您类型。Intellisense 将帮助您确定类型，并且不受对实际对象类型所做的更改的影响。调用它 firstAddressLine 使其远离在变量名称末尾使用 1、2、3... 的（不良）约定，以表明由于某种原因您需要更多它们而不是集合。

将其命名为它所代表的内容/它的解释或使用方式，而不是它的数据类型，并且在命名时，如果您不需要，请不要缩写。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-20T21:57:03.517

[名称指南](http://msdn.microsoft.com/en-us/library/ms229002.aspx)是最好的起点。但是就像在生活的其他领域一样，一旦你知道了规则，你就会开始知道在哪里打破它们是合理的。

我从不使用旧的匈牙利符号来称呼事物`strFirstName`,`intCount`等；但我仍然在控件上使用它：`txtFirstName`，`btnVerifyData`等。原因包括：

*   我不太可能更改控件的类型
*   如果我*确实*更改了控件的类型，我将不得不更改很多东西，而不仅仅是名称，所以更改名称也没什么大不了的
*   使用 Intellisense 更容易找到它们。

此外，我很可能对页面或表单上的许多 TextBoxes 或 ComboBoxes 做同样的事情，而我不太可能对页面或表单上引用的所有 int 或字符串做某事。因此，能够快速找到所有带有`txt`前缀的文本框很有帮助。

不过，即使在这种情况下，也有其他人坚决反对匈牙利语，我相信他们有他们的理由。无论您的个人风格如何，您都可能会发现自己在一个风格迥异的团队中工作。在这种情况下，就做他们该做的；很少值得讨论它。我唯一会这样做是如果他们的风格会导致很多错误，但在我脑海中，我想不出会导致这种情况的案例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T21:29:25.240

网上有一些很好的编码标准文档 - David Lance 写道： [http ://weblogs.asp.net/lhunt/attachment/591275.ashx](http://weblogs.asp.net/lhunt/attachment/591275.ashx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-20T21:36:27.817

我建议您使用 Microsoft 自己的指南作为起点。通常，大多数公司都是从那里开始的（无论如何，根据我的经验）。

[http://msdn.microsoft.com/en-us/library/czefa0ke(VS.71).aspx](http://msdn.microsoft.com/en-us/library/czefa0ke(VS.71).aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T21:28:00.250

描述性越强越好，您会发现长度并不像记住该控件/变量在五年后所做的那样重要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-20T21:36:12.200

对于 .NET API 设计（和一些通用 C# 指南），请查看 Krzysztof Cwalina 和 Brad Abrams 的[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)

问候，坦伯格

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-20T21:44:01.933

我通常会尝试遵循 microsoft 指南，并带有一些非常古老的习惯。
所以，我仍然无法摆脱在 private 前加上下划线 _privateMember 的习惯。
我老了，这已经烧到我的脑海里了。

至于为控件添加前缀，我发现如果描述性太强，在更改 UI 的情况下会变得很痛苦。

例如，您有一个名为 ddlProductLine 的下拉列表，然后必须更改为单选按钮组，您的前缀约定开始比 PITA 更有帮助。

当您有很多小部件要使用时，有时像 uiCtl 这样更通用的前缀可以帮助解决混乱，但如果您必须更改小部件类型，仍然有意义。

# actionscript-3 - AS3 - 我可以使用 addEventListener 检测变量值的变化吗？

> ID：306896
> 
> 赞同：10
> 
> 时间：2008-11-20T21:24:13.037
> 
> 标签：actionscript-3, addeventlistener

是否可以使用 EventListener 监听变量并检测该变量的值何时发生变化？谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-25T19:50:10.073

如果你把它全部包装到一个类中，这很容易做到。我们将使用 getter/setter 方法。每当调用 setter 方法时，它都会分派和事件。

（注意：Setter 和 Getter 被视为属性）。您只需分配一个值，而不是调用一个方法（例如`someVar = 5`，而不是`someVar(5);` 即使 setter / getter 是函数/方法，它们也被视为属性。

```
//The document class
package
{
  import flash.display.Sprite;
  import flash.events.Event;
  import flash.events.EventDispatcher;

  public Class TestDocClass extends Sprite
  {
    private var _model:Model;

    public function TestDocClass():void
    {
      _model = new Model();
      _model.addEventListener(Model.VALUE_CHANGED, onModelChanged);
    }

    private function onModelChanged(e:Event):void
    {
      trace('The value changed');
    }
  }
}

//The model that holds the data (variables, etc) and dispatches events. Save in same folder as DOC Class;
package
{
  import flash.events.Event;
  import flash.events.EventDispatcher;

  public class Model extends EventDispatcher
  {
    public static const VALUE_CHANGED:String = 'value_changed';
    private var _someVar:someVarType;

    public function Model():void
    {
      trace('The model was instantiated.');
    }

    public function set someVariable(newVal:someVarType):void
    {
      _someVar = newVal;
      this.dispatchEvent(new Event(Model.VALUE_CHANGED));
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T23:34:00.193

@BrianHodge：您如何实际使用您的示例？你如何调用set函数？你如何参考它？在哪里传递要更改的变量..？

例如，假设我想通过单击按钮来更改包装变量。我不得不承认我尝试了一些其他代码和示例（getter/setter）类型，`dispatchEvent`无论有没有，我都无法克服它！但是您的示例似乎正是我所需要的，只是无法使其正常工作。

`The model was instantiated`当我将函数设置为文档类时，我得到了。就这样。

我终于发现，对于像我这样正在浪费时间处理这个调度的人！
在我的情况下，`_someVar`变量必须是数据类型的`String`（同样的事情`fornewVal`）。

`OnceTestDocClass`设置为您的文档类；你指的是这样实例化的模型：

```
_model.someVariable="new stuff"; 
```

我试图改变这样的值：

```
_model.someVariable("new stuff"); 
```

您可以在类中添加一些跟踪操作，`Model`以便在输出面板中进行清晰的演示：

```
package
{
  import flash.events.Event;
  import flash.events.EventDispatcher;

  public class Model extends EventDispatcher
  {
    public static const VALUE_CHANGED:String = 'value_changed';
    private var _someVar:String = "default";

    public function Model():void
    {
      trace('The model was instantiated.');
    }

    public function set someVariable(newVal:String):void
    {
      trace ("before " + _someVar);
      _someVar = newVal;
      trace ("after " + _someVar);
      this.dispatchEvent(new Event(Model.VALUE_CHANGED));
    }
  }
} 
```

不多，但这些事情可能会花费一些人很多时间=）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T21:28:57.067

您曾经能够在 AS2 中使用 Object.watch 做类似的事情。我没有看到直接的等价物，但看起来[mx.binding.utils.ChangeWatcher](http://livedocs.adobe.com/flex/3/langref/mx/binding/utils/ChangeWatcher.html)将为任何可绑定的变量提供类似的功能。

我不知道在 AS3 中为不可绑定变量执行此操作的方法，但如果您要查看的变量是可绑定的（或者如果您可以将其修改为可绑定的），那么 ChangeWatcher 可能会为您提供所需的内容。

# syntax - 如何使用 if then else 在水晶报表公式中构建字符串

> ID：306899
> 
> 赞同：13
> 
> 时间：2008-11-20T21:24:52.910
> 
> 标签：syntax, crystal-reports

顺便说一下，这是 Visual Studio 2003 中的 Crystal Reports 9

关于水晶报表公式语法的简单问题：如何使用 if then 子句构建公式的结果？

具体来说，我想要这样的东西：

```
dim val as string
val = {table.level}
if {table.uom_id} = 5 then 
  val = val & ' feet'
else
  val = val $ ' meters'
end if 
```

val 应该是公式的结果。

只要我们在，有没有写这些的捷径？这些非常冗长，三元运算符将非常受欢迎。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-20T21:30:27.627

你的例子很接近。只需使用 Crystal 语法，如下所示：

```
stringvar val := {table.level};

if {table.uom_id} = 5 then
  val := val + ' feet'
else
  val := val + ' meters';

//to return a value, just plop it down at the end
val 
```

但是，如果您想要更简洁的东西，请使用：

```
if {table.uom_id} = 5 then
  {table.level} + ' feet'
else
  {table.level} + ' meters'; 
```

# python - 如何在不卸载 PythonWin 的情况下禁用 PythonWin 的“将输出重定向到 win32trace 远程收集器”功能？

> ID：306901
> 
> 赞同：1
> 
> 时间：2008-11-20T21:26:35.137
> 
> 标签：python, windows, wxpython

当我运行 wxPython 应用程序时，它会打印字符串“将输出重定向到 win32trace 远程收集器”，我必须打开 PythonWin 的跟踪收集器工具才能查看该跟踪输出。

由于我对收集此输出不感兴趣，我应该如何禁用此功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T21:38:55.360

您甚至可以在实例化 wx.App() 时传递它：

```
if __name__ == "__main__":
    app = wx.App(redirect=False) #or 0
    app.MainLoop() 
```

[wxPython wx.App 文档](http://wxpython.org/docs/api/wx.App-class.html#__init__)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T21:34:17.820

这条消息让我误以为 win32trace 阻止我在常规控制台（我的 IDE）中看到未捕获的异常。真正的问题是 wxPython 默认将 stdout/stderr 重定向到一个弹出窗口，该窗口在未捕获的异常后迅速消失。为了解决*这个*问题，我只需要通过

```
重定向=0
```

到我的应用程序的超类构造函数。

```
class MyApp(wx.App):
    def __init__(self):
        # Prevent wxPython from redirecting stdout/stderr:
        super(MyApp, self).__init__(redirect=0) 
```

尽管进行了修复，但我仍然对如何控制 win32trace 感到好奇。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-21T15:51:39.520

这似乎是[TortoiseHG](http://mercurial.selenic.com/bts/issue969)的问题。使用 win32gui.GetOpenFileNameW 时也会发生这种情况。卸载解决了这个问题。不幸的是，我没有找到真正的解决方案来解决这个问题。

# sql-server - 如何在不区分大小写的字段上执行精确的字符串匹配？

> ID：306906
> 
> 赞同：7
> 
> 时间：2008-11-20T21:27:46.477
> 
> 标签：sql-server

我想查找表中的所有行并匹配精确区分大小写的字符串。不幸的是，我的表有不区分大小写的排序规则。

执行此操作的最有效方法是什么。

例如。

我希望以下内容不返回任何行：

```
select * from sysobject where name = 'Sysbinobjs' 
```

对于答案，假设 @match 在一个变量中：

```
declare @match varchar(4000) 
set @match = 'sysbinobjs' 
```

**编辑**

澄清一下，确保正确处理尾随空格，我想要一个考虑尾随空格的完全匹配，所以“Hello”只会与“Hello”匹配，而不是与“Hello”匹配

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-20T21:30:36.580

这是一个有效的代码片段，以安全有效的方式执行此操作确实很棘手。双重匹配是为了避免表扫描（查看执行计划）。varbinary 强制转换强制长度和大小写匹配。所以尾随空格被正确处理，大小写被正确处理。

**请注意**，要比较的类型必须与表中的类型相同，才能进行 varbinary 强制转换（例如，sysobject 中的名称是 nvarchar，因此 @match 需要是 nvarchar）。

```
declare @match nvarchar(4000) 
set @match = 'sysbinobjs'

select * from sysobjects
where name = @match and
cast(name as varbinary(4000)) = cast(@match as varbinary(4000)) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T11:41:06.847

实际上我不明白为什么你必须先进行转义，这是通过 COLLATE 语句内置到 SQL 服务器中的。

```
select * from sysobjects
WHERE name = @match and --Get all relevant hits from the index before doing the final case sensitive test
name COLLATE Latin1_General_CS_AS = @match COLLATE Latin1_General_CS_AS 
```

# asp.net - 带有扩展面板行的 ASP.net 2.0 Gridview -- 如何“即时”构建面板

> ID：306920
> 
> 赞同：2
> 
> 时间：2008-11-20T21:31:29.743
> 
> 标签：asp.net, javascript, gridview, panel, expandable

我目前正在构建一个具有可扩展行的 Gridview。每行包含一个动态创建的表单元素面板。现在，我有一个 javascript 函数，当在 Gridview 行上单击图像时，它会展开（或者在我的情况下，使其可见）面板。

我的问题是......有没有更有效的方法来做到这一点。当用户单击展开按钮时，有没有一种方法可以简单地使用充满文本框和下拉列表的面板来简单地创建行，而不是从一开始就提取所有数据并构建每个新行？”

我想通过这种方式而不是我目前的方式来限制服务器调用，循环遍历每一行并使用表单元素创建一个新面板并将其插入隐藏的行中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T21:48:21.270

实际上，它的性能并不差，因为我的原始 SQL 查询可以填充每一行，并且我在 Gridview 上启用了分页。我只是想知道是否可以使用 PageMethods 或某种 JSON/AJAX 解决方案即时构建它们。我什么都没看到，但是……值得一试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-09T04:13:45.927

您可以覆盖 RowdataBound 事件，然后根据单元格中的数据添加所需的任何控件。

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdatabound.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdatabound.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T21:44:01.687

个人尝试动态创建数据很可能会导致用户体验变慢。

当我做你所描述的事情时，我通常使用中继器，这样我就可以做一个模板布局，立即简单地定义所有需要的元素，并处理绑定操作。

否则，我会想象您的方式不会像现在这样执行得太慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-09T01:29:19.697

实际上，最近将其用于返回表单结构的 AJAX 处理程序。它是按需提供的，并且运行良好。只需通过 jQuery 调用 $ajax，返回一个 HTML 结构，注入 DIV。它对实际功能有点限制，所以要小心。

# html - 我可以使用 CSS 更改复选框的大小吗？

> ID：306924
> 
> 赞同：528
> 
> 时间：2008-11-20T21:34:14.357
> 
> 标签：html, css

是否可以跨浏览器使用 CSS 或 HTML 设置复选框的大小？

`width`并`size`在 IE6+ 中工作，但不适用于 Firefox，即使我设置了较小的尺寸，复选框也会保持 16x16。

* * *

## 回答 #1

> 赞同：499
> 
> 时间：2012-05-02T13:58:19.670

它有点难看（由于扩大了规模），但它适用于大多数较新的浏览器：

```
input[type=checkbox]
{
  /* Double-sized Checkboxes */
  -ms-transform: scale(2); /* IE */
  -moz-transform: scale(2); /* FF */
  -webkit-transform: scale(2); /* Safari and Chrome */
  -o-transform: scale(2); /* Opera */
  transform: scale(2);
  padding: 10px;
}

/* Might want to wrap a span around your checkbox text */
.checkboxtext
{
  /* Checkbox text */
  font-size: 110%;
  display: inline;
}
```

```
<input  type="checkbox" name="optiona" id="opta" checked />
<span class="checkboxtext">
  Option A
</span>
<input type="checkbox" name="optionb" id="optb" />
<span class="checkboxtext">
  Option B
</span>
<input type="checkbox" name="optionc" id="optc" />
<span class="checkboxtext">
  Option C
</span>
```

* * *

## 回答 #2

> 赞同：449
> 
> 时间：2014-07-11T00:59:52.193

适用于所有现代浏览器的工作解决方案。

```
input[type=checkbox] {
    transform: scale(1.5);
}
```

```
<label><input type="checkbox"> Test</label>
```

* * *

[兼容性：](http://caniuse.com/#feat=transforms2d)

*   即：10+
*   法郎：16+
*   铬：36+
*   野生动物园：9+
*   歌剧：23+
*   iOS Safari：9.2+
*   适用于 Android 的 Chrome：51+

* * *

外貌：

*   [![Chrome 上的缩放复选框，Win 10](https://i.stack.imgur.com/etEAf.png)](https://i.stack.imgur.com/etEAf.png) Chrome 58（2017 年 5 月）、Windows 10

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2014-01-14T13:37:40.970

一个简单的解决方案是使用属性`zoom`：

```
input[type="checkbox"] {
    zoom: 1.5;
}
```

```
<input type="checkbox" />
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2017-06-19T08:48:54.673

**2020 版**- 使用伪元素，大小取决于字体大小。

默认复选框/收音机在屏幕之外呈现，但 CSS 创建的虚拟元素与默认元素非常相似。支持所有浏览器，不模糊。大小取决于字体大小。还支持键盘操作（空格、制表符）。

[https://jsfiddle.net/ohf7nmzy/2/](https://jsfiddle.net/ohf7nmzy/2/)

```
body{
    padding:0 20px;
}
.big{
    font-size: 50px;
}

/* CSS below will force radio/checkbox size be same as font size */
label{
    position: relative;
    line-height: 1.4;
}
/* radio */
input[type=radio]{
    width: 1em;
    font-size: inherit;
    margin: 0;
    transform: translateX(-9999px);
}
input[type=radio] + label:before{
    position: absolute;
    content: '';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border:none;
    border-radius: 50%;
    background-color: #bbbbbb;
}
input[type=radio] + label:after{
    position: absolute;
    content: '';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: white;
    border-radius: 50%;
    transform: scale(0.8);
}
/*checked*/
input[type=radio]:checked + label:before{
    position:absolute;
    content:'';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: #3b88fd;
}
input[type=radio]:checked + label:after{
    position: absolute;
    content: '';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: white;
    border-radius: 50%;
    transform: scale(0.3);
}
/*focused*/
input[type=radio]:focus + label:before{
    border: 0.2em solid #8eb9fb;
    margin-top: -0.2em;
    margin-left: -0.2em;
    box-shadow: 0 0 0.3em #3b88fd;
}

/*checkbox/*/
input[type=checkbox]{
    width: 1em;
    font-size: inherit;
    margin: 0;
    transform: translateX(-9999px);
}
input[type=checkbox] + label:before{
    position: absolute;
    content: '';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border:none;
    border-radius: 10%;
    background-color: #bbbbbb;
}
input[type=checkbox] + label:after{
    position: absolute;
    content: '';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: white;
    border-radius: 10%;
    transform: scale(0.8);
}
/*checked*/
input[type=checkbox]:checked + label:before{
    position:absolute;
    content:'';
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: #3b88fd;
}
input[type=checkbox]:checked + label:after{
    position: absolute;
    content: "\2713";
    left: -1.3em;
    top: 0;
    width: 1em;
    height: 1em;
    margin: 0;
    border: none;
    background-color: #3b88fd;
    border-radius: 10%;
    color: white;
    text-align: center;
    line-height: 1;
}
/*focused*/
input[type=checkbox]:focus + label:before{
    border: 0.1em solid #8eb9fb;
    margin-top: -0.1em;
    margin-left: -0.1em;
    box-shadow: 0 0 0.2em #3b88fd;
}
```

```
<input type="checkbox" name="checkbox_1" id="ee" checked /> 
<label for="ee">Checkbox small</label>

<br />

<input type="checkbox" name="checkbox_2" id="ff" /> 
<label for="ff">Checkbox small</label>

<hr />

<div class="big">
    <input type="checkbox" name="checkbox_3" id="gg" checked /> 
    <label for="gg">Checkbox big</label>

    <br />

    <input type="checkbox" name="checkbox_4" id="hh" /> 
    <label for="hh">Checkbox big</label>
</div>

<hr />

<input type="radio" name="radio_1" id="aa" value="1" checked /> 
<label for="aa">Radio small</label>

<br />

<input type="radio" name="radio_1" id="bb" value="2" /> 
<label for="bb">Radio small</label>

<hr />

<div class="big">
    <input type="radio" name="radio_2" id="cc" value="1" checked /> 
    <label for="cc">Radio big</label>

    <br />

    <input type="radio" name="radio_2" id="dd" value="2" /> 
    <label for="dd">Radio big</label>
</div>
```

**2017 版**- 使用缩放或缩放

`zoom`如果支持（质量很好）或标准`transform: scale`（在 Safari 上模糊）作为后备，浏览器将使用非标准功能。

[https://jsfiddle.net/ksvx2txb/11/](https://jsfiddle.net/ksvx2txb/11/)

```
@supports (zoom:2) {
    input[type="radio"],  input[type=checkbox]{
    zoom: 2;
    }
}
@supports not (zoom:2) {
    input[type="radio"],  input[type=checkbox]{
        transform: scale(2);
        margin: 15px;
    }
}
label{
  /* fix vertical align issues */
    display: inline-block;
    vertical-align: top;
    margin-top: 10px;
}
```

```
<input type="radio" name="aa" value="1" id="aa" checked /> 
<label for="aa">Radio 1</label>
<br />
<input type="radio" name="aa" value="2" id="bb" /> 
<label for="bb">Radio 2</label>

<br /><br />

<input  type="checkbox" name="optiona" id="cc" checked /> 
<label for="cc">Checkbox 1</label>
<br />
<input  type="checkbox" name="optiona" id="dd" /> 
<label for="dd">Checkbox 1</label>
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2017-10-24T13:06:33.617

我刚出来这个：

```
input[type="checkbox"] {display:none;}
input[type="checkbox"] + label:before {content:"☐";}
input:checked + label:before {content:"☑";}
label:hover {color:blue;}
```

```
<input id="check" type="checkbox" /><label for="check">Checkbox</label>
```

当然，多亏了这一点，您可以根据需要更改 的值`content`并根据需要使用图像或使用其他字体...

这里的主要兴趣是：

1.  复选框大小与文本大小成比例

2.  您可以控制复选框的纵横比、颜色、大小

3.  不需要额外的 HTML！

4.  只需要3行CSS（最后一行只是给你一些想法）

**编辑**：正如评论中所指出的，该复选框将无法通过键导航访问。您可能应该将其添加`tabindex=0`为标签的属性以使其具有焦点。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2012-11-03T15:30:42.140

预览：http:
[//jsfiddle.net/h4qka9td/](http://jsfiddle.net/h4qka9td/)

```
*,*:after,*:before {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

.switch {
  margin: 50px auto;
  position: relative;
}

.switch label {
  width: 100%;
  height: 100%;
  position: relative;
  display: block;
}

.switch input {
  top: 0; 
  right: 0; 
  bottom: 0; 
  left: 0;
  opacity: 0;
  z-index: 100;
  position: absolute;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

/* DEMO 3 */

.switch.demo3 {
  width: 180px;
  height: 50px;
}

.switch.demo3 label {
  display: block;
  width: 100%;
  height: 100%;
  background: #a5a39d;
  border-radius: 40px;
  box-shadow:
      inset 0 3px 8px 1px rgba(0,0,0,0.2),
      0 1px 0 rgba(255,255,255,0.5);
}

.switch.demo3 label:after {
  content: "";
  position: absolute;
  z-index: -1;
  top: -8px; right: -8px; bottom: -8px; left: -8px;
  border-radius: inherit;
  background: #ababab;
  background: -moz-linear-gradient(#f2f2f2, #ababab);
  background: -ms-linear-gradient(#f2f2f2, #ababab);
  background: -o-linear-gradient(#f2f2f2, #ababab);
  background: -webkit-gradient(linear, 0 0, 0 100%, from(#f2f2f2), to(#ababab));
  background: -webkit-linear-gradient(#f2f2f2, #ababab);
  background: linear-gradient(#f2f2f2, #ababab);
  box-shadow: 0 0 10px rgba(0,0,0,0.3),
        0 1px 1px rgba(0,0,0,0.25);
}

.switch.demo3 label:before {
  content: "";
  position: absolute;
  z-index: -1;
  top: -18px; right: -18px; bottom: -18px; left: -18px;
  border-radius: inherit;
  background: #eee;
  background: -moz-linear-gradient(#e5e7e6, #eee);
  background: -ms-linear-gradient(#e5e7e6, #eee);
  background: -o-linear-gradient(#e5e7e6, #eee);
  background: -webkit-gradient(linear, 0 0, 0 100%, from(#e5e7e6), to(#eee));
  background: -webkit-linear-gradient(#e5e7e6, #eee);
  background: linear-gradient(#e5e7e6, #eee);
  box-shadow:
      0 1px 0 rgba(255,255,255,0.5);
  -webkit-filter: blur(1px);
  -moz-filter: blur(1px);
  -ms-filter: blur(1px);
  -o-filter: blur(1px);
  filter: blur(1px);
}

.switch.demo3 label i {
  display: block;
  height: 100%;
  width: 60%;
  border-radius: inherit;
  background: silver;
  position: absolute;
  z-index: 2;
  right: 40%;
  top: 0;
  background: #b2ac9e;
  background: -moz-linear-gradient(#f7f2f6, #b2ac9e);
  background: -ms-linear-gradient(#f7f2f6, #b2ac9e);
  background: -o-linear-gradient(#f7f2f6, #b2ac9e);
  background: -webkit-gradient(linear, 0 0, 0 100%, from(#f7f2f6), to(#b2ac9e));
  background: -webkit-linear-gradient(#f7f2f6, #b2ac9e);
  background: linear-gradient(#f7f2f6, #b2ac9e);
  box-shadow:
      inset 0 1px 0 white,
      0 0 8px rgba(0,0,0,0.3),
      0 5px 5px rgba(0,0,0,0.2);
}

.switch.demo3 label i:after {
  content: "";
  position: absolute;
  left: 15%;
  top: 25%;
  width: 70%;
  height: 50%;
  background: #d2cbc3;
  background: -moz-linear-gradient(#cbc7bc, #d2cbc3);
  background: -ms-linear-gradient(#cbc7bc, #d2cbc3);
  background: -o-linear-gradient(#cbc7bc, #d2cbc3);
  background: -webkit-gradient(linear, 0 0, 0 100%, from(#cbc7bc), to(#d2cbc3));
  background: -webkit-linear-gradient(#cbc7bc, #d2cbc3);
  background: linear-gradient(#cbc7bc, #d2cbc3);
  border-radius: inherit;
}

.switch.demo3 label i:before {
  content: "off";
  text-transform: uppercase;
  font-style: normal;
  font-weight: bold;
  color: rgba(0,0,0,0.4);
  text-shadow: 0 1px 0 #bcb8ae, 0 -1px 0 #97958e;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 24px;
  position: absolute;
  top: 50%;
  margin-top: -12px;
  right: -50%;
}

.switch.demo3 input:checked ~ label {
  background: #9abb82;
}

.switch.demo3 input:checked ~ label i {
  right: -1%;
}

.switch.demo3 input:checked ~ label i:before {
  content: "on";
  right: 115%;
  color: #82a06a;
  text-shadow: 
    0 1px 0 #afcb9b,
    0 -1px 0 #6b8659;
}
```

```
<div class="switch demo3">
  <input type="checkbox">
  <label><i></i>
  </label>
</div>

<div class="switch demo3">
  <input type="checkbox" checked>
  <label><i></i>
  </label>
</div>
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2019-02-21T10:16:23.090

默认情况下，复选框的外观似乎是固定的。但正如 Worthy7 所指出的，这可以使用[CSS`appearance`属性](https://developer.mozilla.org/en-US/docs/Web/CSS/appearance)来解决。它将使复选框完全为空，因此您可以定义自己的外观。这样做的好处是：您可以使用现有的 HTML 代码。缺点：是[实验技术](https://developer.mozilla.org/en-US/docs/MDN/Contribute/Guidelines/Conventions_definitions#Experimental)。Edge（旧版）和 IE 不使用自定义样式。

以下是所需的 CSS 样式：

```
input[type=checkbox] {
    width: 14mm;
    -webkit-appearance: none;
    -moz-appearance: none;
    height: 14mm;
    border: 0.1mm solid black;
}

input[type=checkbox]:checked {
    background-color: lightblue;
}

input[type=checkbox]:checked:after {
    margin-left: 4.3mm;
    margin-top: -0.4mm;
    width: 3mm;
    height: 10mm;
    border: solid white;
    border-width: 0 2mm 2mm 0;
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
    content: "";
    display: inline-block;
}
```

```
<label><input type="checkbox"> Test</label>
```

截图：

铬合金：[![在此处输入图像描述](https://i.stack.imgur.com/YQHCo.png)](https://i.stack.imgur.com/YQHCo.png)

火狐：[![在此处输入图像描述](https://i.stack.imgur.com/pwFsF.png)](https://i.stack.imgur.com/pwFsF.png)

边缘：[![在此处输入图像描述](https://i.stack.imgur.com/kzI5O.png)](https://i.stack.imgur.com/kzI5O.png)

边缘（旧版）：[![在此处输入图像描述](https://i.stack.imgur.com/AJy6X.png)](https://i.stack.imgur.com/AJy6X.png)

IE：[![在此处输入图像描述](https://i.stack.imgur.com/bSvp6.png)](https://i.stack.imgur.com/bSvp6.png)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2019-07-14T02:50:15.637

我认为最简单的解决方案是按照一些用户的建议重新设置复选框的样式。下面的 CSS 对我有用，只需要几行 CSS，并回答 OP 问题：

```
input[type=checkbox] {
    -webkit-appearance: none;
    -moz-appearance: none;
    vertical-align: middle;
    width: 14px; 
    height: 14px;
    font-size: 14px;
    background-color: #eee;
}

input[type=checkbox]:checked:after {
    position: relative;
    bottom: 3px;
    left: 1px;
    color: blue;
    content: "\2713"; /* check mark */
} 
```

如本文所述，缩放属性似乎不适用于 Firefox，并且转换可能会导致不良影响。

在 Chrome 和 Firefox 上测试，应该适用于所有现代浏览器。只需根据您的需要更改属性（颜色、大小、底部、左侧等）。希望能帮助到你！

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2014-01-27T17:14:07.747

我正在寻找一个稍微大一点的复选框，并查看了 37Signals Basecamp 的源代码以找到以下解决方案 -

您可以更改字体大小以使复选框略大：

```
font-size: x-large; 
```

然后，您可以通过执行以下操作正确对齐复选框：

```
vertical-align: top;
margin-top: 3px; /* change to center it */ 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2010-06-28T12:55:08.257

您可以使用以下属性在 Safari 中使复选框变大——这通常对通常的方法有抵抗力：`-webkit-transform: scale(1.3, 1.3);`

[资源](http://forums.devnetwork.net/viewtopic.php?f=13&t=89167)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-11-20T21:48:40.710

我的理解是，跨浏览器根本不容易。无需尝试操作复选框控件，您始终可以使用图像、javascript 和隐藏输入字段构建自己的实现。我假设这类似于 niceforms 是什么（来自 Staicu lonut 上面的回答），但实施起来并不特别困难。我相信 jQuery 也有一个插件来允许这种自定义行为（如果我能找到它，我会寻找链接并在此处发布）。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2021-07-11T01:37:28.883

这应该工作

```
input {
  width: 25px;
  height: 25px;
} 
```

它至少适用于 Firefox 和 Chrome 以及 iPhone 的 Firefox、Chrome 和 Safari。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-12-31T00:12:41.500

我发现这个纯 CSS 库非常有用： [https ://lokesh-coder.github.io/pretty-checkbox/](https://lokesh-coder.github.io/pretty-checkbox/)

或者，您可以使用相同的基本概念推出自己的产品，类似于 @Sharcoux 发布的内容。基本上是：

*   隐藏普通复选框（不透明度 0 并放置在它会去的地方）
*   添加一个基于 CSS 的伪复选框
*   用于`input:checked~div label`格子样式
*   确保您`<label>`可以点击使用`for=yourinputID`

```
.pretty {
  position: relative;
  margin: 1em;
}
.pretty input {
  position: absolute;
  left: 0;
  top: 0;
  min-width: 1em;
  width: 100%;
  height: 100%;
  z-index: 2;
  opacity: 0;
  margin: 0;
  padding: 0;
  cursor: pointer;
}
.pretty-inner {
  box-sizing: border-box;
  position: relative;
}
.pretty-inner label {
  position: initial;
  display: inline-block;
  font-weight: 400;
  margin: 0;
  text-indent: 1.5em;
  min-width: calc(1em + 2px);
}
.pretty-inner label:after,
.pretty-inner label:before {
  content: '';
  width: calc(1em + 2px);
  height: calc(1em + 2px);
  display: block;
  box-sizing: border-box;
  border-radius: 0;
  border: 1px solid transparent;
  z-index: 0;
  position: absolute;
  left: 0;
  top: 0;
  background-color: transparent;
}
.pretty-inner label:before {
  border-color: #bdc3c7;
}
.pretty input:checked~.pretty-inner label:after {
  background-color: #00bb82;
  width: calc(1em - 6px);
  height: calc(1em - 6px);
  top: 4px;
  left: 4px;
}

/* Add checkmark character style */
.pretty input:checked~.pretty-inner.checkmark:after {
  content: '\2713';
  color: #fff;
  position: absolute;
  font-size: 0.65em;
  left: 6px;
  top: 3px;
}

body {
  font-size: 20px;
  font-family: sans-serif;
}
```

```
<div class="pretty">
	<input type="checkbox" id="demo" name="demo">
	<div class="pretty-inner"><label for="demo">I agree.</label></div>
</div>

<div class="pretty">
	<input type="checkbox" id="demo" name="demo">
	<div class="pretty-inner checkmark"><label for="demo">Please check the box.</label></div>
</div>
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2021-06-16T20:20:54.523

**使用这个 CSS 代码**

```
input[type=checkbox]
{
  /* Double-sized Checkboxes */
  -ms-transform: scale(1.5); /* IE */
  -moz-transform: scale(1.5); /* FF */
  -webkit-transform: scale(1.5); /* Safari and Chrome */
  -o-transform: scale(1.5); /* Opera */
  transform: scale(1.5);
  padding: 10px;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2017-04-27T01:20:34.027

问题是 Firefox 不听宽度和高度。禁用它，你的好去处。

```
input[type=checkbox] {
    width: 25px;
    height: 25px;
    -moz-appearance: none;
}
```

```
<label><input type="checkbox"> Test</label>
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2021-01-29T18:13:25.273

我的声誉有点太低，无法发表评论，但我对上面 Jack Miller 的代码进行了修改，以使其在您选中和取消选中时不会改变大小。这给我造成了文本对齐问题。

```
 input[type=checkbox] {
        width: 17px;
        -webkit-appearance: none;
        -moz-appearance: none;
        height: 17px;
        border: 1px solid black;
    }

    input[type=checkbox]:checked {
        background-color: #F58027;
    }

    input[type=checkbox]:checked:after {
        margin-left: 4px;
        margin-top: -1px;
        width: 4px;
        height: 12px;
        border: solid white;
        border-width: 0 2px 2px 0;
        -webkit-transform: rotate(45deg);
        -moz-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
        content: "";
        display: inline-block;
    }
    input[type=checkbox]:after {
        margin-left: 4px;
        margin-top: -1px;
        width: 4px;
        height: 12px;
        border: solid white;
        border-width: 0;
        -webkit-transform: rotate(45deg);
        -moz-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
        content: "";
        display: inline-block;
    }
```

```
<label><input type="checkbox"> Test</label>
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-11-02T12:16:03.183

其他答案显示了一个像素化的复选框，而我想要一些漂亮的东西。结果如下所示： [![复选框预览](https://i.stack.imgur.com/SQtB9.png)](https://i.stack.imgur.com/SQtB9.png)

尽管这个版本更复杂，但我认为值得一试。

```
.checkbox-list__item {
  position: relative;
  padding: 10px 0;
  display: block;
  cursor: pointer;
  margin: 0 0 0 34px;
  border-bottom: 1px solid #b4bcc2;
}
.checkbox-list__item:last-of-type {
  border-bottom: 0;
}

.checkbox-list__check {
  width: 18px;
  height: 18px;
  border: 3px solid #b4bcc2;
  position: absolute;
  left: -34px;
  top: 50%;
  margin-top: -12px;
  transition: border .3s ease;
  border-radius: 5px;
}
.checkbox-list__check:before {
  position: absolute;
  display: block;
  width: 18px;
  height: 22px;
  top: -2px;
  left: 0px;
  padding-left: 2px;
  background-color: transparent;
  transition: background-color .3s ease;
  content: '\2713';
  font-family: initial;
  font-size: 19px;
  color: white;
}

input[type="checkbox"]:checked ~ .checkbox-list__check {
  border-color: #5bc0de;
}
input[type="checkbox"]:checked ~ .checkbox-list__check:before {
  background-color: #5bc0de;
}
```

```
<label class="checkbox-list__item">
  <input class="checkbox_buttons" type="checkbox" checked="checked" style="display: none;">
  <div class="checkbox-list__check"></div>
</label>
```

JSFiddle：[https ://jsfiddle.net/asbd4hpr/](https://jsfiddle.net/asbd4hpr/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-12-03T07:23:32.513

您可以在下面的代码中更改高度和宽度

```
.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 20px;
    width: 20px;
    border-radius:5px;
    border:1px solid #ff7e02;
}
```

```
<div class="check">

     <label class="container1">Architecture/Landscape

    <input type="checkbox" checked="checked">

    <span class="checkmark"></span>

    </label>
</div>
```

# c - 轻量级正则表达式解析器

> ID：306927
> 
> 赞同：9
> 
> 时间：2008-11-20T21:35:13.857
> 
> 标签：c, regex, embedded, string

我想使用正则表达式解析器来帮助 C 应用程序中的一些字符串处理。理想情况下，我正在寻找轻量级和开源的东西。目标平台是嵌入式系统，因此我们希望尽可能多地节省内存消耗。我在网上找到了许多选项，但想知道是否有人可以提出可能在这种特定情况下有所帮助的其他建议。

非常感谢，

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-20T22:21:12.657

[Scintilla](http://www.scintilla.org/ "闪烁和 SciTE")是一个开源文本编辑器组件，使用[Ozan S. Yigit 的 RE 引擎](http://www.cs.yorku.ca/~oz/)

之所以选择它，是因为它属于公共领域（因此没有妨碍许可）并且非常轻量级。但它有点有限......对于它的价值，[RESearch.cxx](http://scintilla.cvs.sourceforge.net/viewvc/scintilla/scintilla/src/RESearch.cxx?revision=1.19&view=markup "1.19")使用了稍微更现代的代码（转换为 C++，但将其转换回 C 应该并不复杂），并带有一些我自己制作的小扩展（支持 \d \s \w 等）。

还有一些替代方案，例如[Henry Spencer 的正则表达式库](http://www.arglist.com/regex/)。

想一想，[Lua](http://www.lua.org/ "编程语言 Lua")正则表达式引擎（在字符串库、gsub 实现等中）可能又快又小，就像语言本身一样。它有其怪癖和局限性，但它非常有用。

副项目[LPeg](http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html "LPeg - 为 Lua 解析表达式语法")可以成为 REs 的一个有趣的替代品，它仍然是轻量级但功能强大的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-20T21:58:11.097

如果您不需要功能齐全的正则表达式实现（听起来您不需要），那么在[Beautiful Code](http://oreilly.com/catalog/9780596510046/)中突出显示的 Brian Kernighan 和 Rob Pike 编写的代码 可能会满足您的需求。我[发现了一篇 Dobb 博士的文章](http://www.ddj.com/architect/184410904?pgno=1)，我认为这是书中出现的代码的起源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T10:47:43.553

鉴于您的轻量级要求，我推荐[Henry Spencer 的正则表达式库](https://garyhouston.github.io/regex/)，它实现了[POSIX BRE 和 ERE 正则表达式风格](http://www.regular-expressions.info/posix.html)。这些是您的用户可能已经熟悉的标准正则表达式风格。

# vb6 - VB6 演员表

> ID：306937
> 
> 赞同：11
> 
> 时间：2008-11-20T21:39:08.170
> 
> 标签：vb6, casting

在 Visual Basic 6 中，与 VB.NET 的 CType 等效的强制转换表达式是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-20T21:42:10.207

根据您要投射的类型，它们有很多

```
cint() Cast to integer
cstr() cast to string
clng() cast to long
cdbl() cast to double
cdate() cast to date 
```

它还具有隐式转换，因此您可以执行此操作 myString=myInt

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-22T05:23:29.903

相当多的海报似乎误读了这个问题，所以我将尝试通过重新表述问题并总结迄今为止给出的正确答案来纠正问题。

## 问题

> 我想将一种类型的数据转换为另一种类型。在我的 VB.NET 代码中，我将使用它`CType`来执行此操作。但是，当我尝试`CType`在 VB6 中使用时，出现“未定义子或函数”错误。`CType`那么，如果不起作用，我该如何在 VB6 中执行强制转换？

## 解决方案

您可能已经发现，VB6 没有`CType`VB.NET 那样的功能。`C`但是，您可能在 VB.NET 代码中遇到的其他转换函数（名称以类型。没有用于将一个类的对象转换为另一类的对象的内置函数。请记住，与 VB.NET 不同，VB6 不支持继承。VB6 中的一个类可以实现一个或多个接口，但不能从另一个类继承。但是，如果一个对象的类实现了多个接口，您可以使用该`Set`语句将一个对象强制转换为它支持的接口之一（如 Ant 建议的那样）。下面提供了 Ant 代码示例的扩展版本：

**示例：将类强制转换为其支持的接口之一**

```
Dim base As BaseClass
Dim child As ChildClass     'implements BaseClass'

Set child = New ChildClass 
Set base = child            '"Cast" child to BaseClass' 
```

## VB6内置类型转换函数

*下面是 VB6 中可用的内置转换函数的完整列表，直接取自 VB6 帮助文件。*

> * * *
> 
> ## CBool
> 
> **退货**
> 
> `Boolean`
> 
> **描述**
> 
> 将*表达式*转换为布尔值。
> 
> ***表达式*参数的范围：**
> 
> 任何有效的字符串或数字表达式。
> 
> * * *
> 
> ## 字节
> 
> **退货**
> 
> `Byte`
> 
> **描述**
> 
> 将*表达式*转换为字节。
> 
> ***表达式*参数的范围：**
> 
> 0 到 255。
> 
> * * *
> 
> ## CCur
> 
> **退货**
> 
> `Currency`
> 
> **描述**
> 
> 将*表达式*转换为货币。
> 
> ***表达式*参数的范围：**
> 
> -922,337,203,685,477.5808 至 922,337,203,685,477.5807。
> 
> * * *
> 
> ## 日期
> 
> **退货**
> 
> `Date`
> 
> **描述**
> 
> 将*表达式*转换为日期。
> 
> ***表达式*参数的范围：**
> 
> 任何有效的日期表达式。
> 
> * * *
> 
> ## CDbl
> 
> **退货**
> 
> `Double`
> 
> **描述**
> 
> 将*表达式*转换为 Double。
> 
> ***表达式*参数的范围：**
> 
> -1.79769313486232E308 到 -4.94065645841247E-324 用于负值；4.94065645841247E-324 到 1.79769313486232E308 为正值。
> 
> * * *
> 
> ## CDEC
> 
> **退货**
> 
> `Decimal`
> 
> **描述**
> 
> 将*表达式*转换为十进制。
> 
> ***表达式*参数的范围：**
> 
> +/-79,228,162,514,264,337,593,543,950,335 用于零刻度数字，即没有小数位的数字。对于小数点后 28 位的数字，范围为 +/-7.9228162514264337593543950335。最小可能的非零数是 0.00000000000000000000000000001。
> 
> * * *
> 
> ## 整数
> 
> **退货**
> 
> `Integer`
> 
> **描述**
> 
> 将*表达式*转换为 Long。
> 
> ***表达式*参数的范围：**
> 
> -32,768 至 32,767；分数四舍五入。
> 
> * * *
> 
> ## CLng
> 
> **退货**
> 
> `Long`
> 
> **描述**
> 
> 将*表达式*转换为 Long。
> 
> ***表达式*参数的范围：**
> 
> -2,147,483,648 至 2,147,483,647；分数四舍五入。
> 
> * * *
> 
> ## CSng
> 
> **退货**
> 
> `Single`
> 
> **描述**
> 
> 将*表达式*转换为 Single。
> 
> ***表达式*参数的范围：**
> 
> -3.402823E38 到 -1.401298E-45 用于负值；1.401298E-45 到 3.402823E38 为正值。
> 
> * * *
> 
> ## CSTR
> 
> **退货**
> 
> `String`
> 
> **描述**
> 
> 将*表达式*转换为字符串。
> 
> ***表达式*参数的范围：**
> 
> CStr 的返回取决于表达式参数。
> 
> * * *
> 
> ## CVar
> 
> **退货**
> 
> `Variant`
> 
> **描述**
> 
> 将*表达式*转换为变体。
> 
> ***表达式*参数的范围：**
> 
> 与数字的 Double 范围相同。与非数字字符串的范围相同。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-21T12:48:41.313

假设您有一个要转换为 BaseClass 的 ChildClass（子）对象。你来做这件事：

```
Dim base As BaseClass
Set base = child 
```

由于 VB6 处理编译时类型安全的方式，您无需任何额外语法就可以做到这一点。

注意：鉴于其他人似乎都提到了`CType`，我可能只是完全误解了这个问题，如果是这样，我深表歉意！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T22:32:54.113

已经提到的强制转换是正确的，但是如果类型是 Object，那么您必须在 VB6 中使用“Set”，例如：

```
If IsObject(Value) Then
    Set myObject = Value ' VB6 does not have CType(Value, MyObjectType)
Else
    myObject = Value     ' VB6 does not have CType(Value, MyObjectType)
End If 
```

当然，这取决于您要转换的类型。几乎所有的用户类都是对象以及 Collection、Dictionary 和许多其他类。long、integer、boolean 等内置类型显然不是对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T21:40:44.220

Ctype() 我相信。C*（CDate()、CStr() 等）在大多数情况下都是保留的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T06:10:35.360

转换根本不是“强制转换”。例如尝试：

```
MsgBox CLng(CBool(3&)) 
```

结果是 -1，而不是 3。这是因为这些是*转换*函数，而不是强制转换。语言很重要！

# deployment - 是否可以将 servlet 转发到其上下文根之外的 jsp？

> ID：306938
> 
> 赞同：1
> 
> 时间：2008-11-20T21:39:14.097
> 
> 标签：deployment, war, contextroot

我们目前有一个应用服务器设置，其中所有内容都来自一个大上下文根，我们复制类文件并重新启动应用服务器以进行部署。不理想。我正在尝试设置一个 ant 脚本来使用 wdeploy 进行构建和部署，并且一切正常，除了我需要将我的 servlet 转发到我的 war 文件部署的上下文根之外的 jsps。所以我想如果我可以在我的战争文件中放置一个符号链接，它可以指向我的上下文根空间之外的某个地方。

这是我试图实现的目标，也许符号链接不是最好的主意。我只需要一种从 servlet 转发到上下文根之外的方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-20T22:00:37.673

我不确定符号链接是否有效，我同意这不是一个好主意。尝试创建一个指向 jsps 所在位置的虚拟目录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T22:16:28.327

您可以随时将`HttpServletResponse.sendRedirect`用户发送到任何地方，但如果您想使用`RequestDispatcher.forward`or `jsp:forward`，它只能在应用程序的上下文根中工作。

假设它与一个应用程序相关，我认为将所有代码放在一个上下文根下并不是那么糟糕。为同一个应用程序的不同部分创建多个 WAR 似乎会增加您的维护成本而收益甚微。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-16T11:49:41.077

如果另一个 webapp 在同一个 servlet-container 中运行，则可以转发到 webapp 上下文之外的资源。

有关详细信息，请参阅：[Servlets：转发到不同 webapp 中的资源](https://stackoverflow.com/questions/2690198/servlets-forwarding-to-a-resource-in-a-different-webapp)

# asp.net - 为什么我不能在运行时编辑我的 ASP.NET Web 应用程序？

> ID：306943
> 
> 赞同：3
> 
> 时间：2008-11-20T21:41:57.040
> 
> 标签：asp.net, visual-studio-2008, web-applications

为什么 ASP.NET Web 应用程序的代码隐藏页面在运行时被锁定？我有较旧的项目（可能定义为“网站”而不是“网络应用程序”），我可以在其中编辑代码、刷新浏览器并查看我的更改。使用网络应用程序，如果我想实时查看我的更改，我必须不断关闭并重新打开浏览器。是否有设置或我缺少的东西允许我在运行时进行编辑，而无需重新启动调试会话？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-20T21:50:04.013

您可以在项目属性中启用编辑并继续。右键单击解决方案资源管理器中的项目，选择 Web 选项卡并选中 Enable Edit and Continue。

现在您可以编辑源代码，但您必须暂停调试器才能这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T21:46:31.180

将 IIS 用作开发服务器时，Visual Studio for ASP.NET 目前无法使用“编辑并继续”。

但是，请参阅此[博客条目](http://whyiamright.wordpress.com/2007/12/20/aspnet-edit-and-continue-in-visual-studio-2005/)，它表明[Visual Studio 2005 Web 应用程序项目](http://webproject.scottgu.com/)项目类型是可能的。它需要在开发期间使用 Visual Studio 开发服务器 (Cassini) 而不是本地 IIS（请参阅项目的属性框）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T21:51:50.093

不，在 Web 应用程序中，代码隐藏被预编译为 dll，因此 dll 中的任何更改都将回收应用程序池，并停止您的调试会话，

如果您按 ctrl-F5 而不是 F5 来启动（或在 IIS 中托管您的站点），您将在没有调试器的情况下启动，并且不需要一直重新启动浏览器......

除非您*真的需要调试您无法解决的问题，否则您应该在* *没有*调试器的情况下启动 Web 应用程序，使其启动起来更快捷。花在调试上的每一分钟都是不花在编写单元测试上的一分钟。恕我直言，您应该编写单元测试，它们会持续更长时间。

# sql-server - 如何刷新 TSQL 中的 PRINT 缓冲区？

> ID：306945
> 
> 赞同：245
> 
> 时间：2008-11-20T21:42:34.467
> 
> 标签：sql-server, tsql, printing

我正在尝试调试 SQL Server 2005 中有一个运行时间很长的存储过程，并且我正在使用“打印”命令来执行此操作。问题是，我只是在存储过程的最后从 SQL Server 获取消息 - 我希望能够在存储过程的运行时刷新消息缓冲区并立即查看这些消息，而不是在结尾。

* * *

## 回答 #1

> 赞同：333
> 
> 时间：2008-11-20T21:58:02.360

使用[`RAISERROR`](http://msdn.microsoft.com/en-us/library/ms178592.aspx)功能：

```
RAISERROR( 'This message will show up right away...',0,1) WITH NOWAIT 
```

您不应该用 raiserror 完全替换所有打印件。如果您在某处有一个循环或大光标，则每次迭代执行一次或两次，甚至每隔几次迭代执行一次。

另外：我首先在此链接上了解了 RAISERROR，现在我认为它是 SQL Server 错误处理的权威来源，绝对值得一读： http:
[//www.sommarskog.se/error-handling-I.html](http://www.sommarskog.se/error-handling-I.html)

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2017-09-11T00:51:18.410

基于@JoelCoehoorn 的回答，我的方法是将我的所有 PRINT 语句保留在原位，然后简单地使用 RAISERROR 语句跟随它们以导致刷新。

例如：

```
PRINT 'MyVariableName: ' + @MyVariableName
RAISERROR(N'', 0, 1) WITH NOWAIT 
```

这种方法的优点是 PRINT 语句可以连接字符串，而 RAISERROR 不能。（因此，无论哪种方式，您的代码行数都相同，因为您必须声明并设置要在 RAISERROR 中使用的变量）。

如果像我一样，您使用 AutoHotKey 或 SSMSBoost 或等效工具，您可以轻松设置快捷方式，例如“]flush”为您输入 RAISERROR 行。如果每次都是同一行代码，这可以节省您的时间，即不需要定制来保存特定的文本或变量。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-11-01T10:32:01.657

是的... RAISERROR 函数的第一个参数需要一个 NVARCHAR 变量。所以尝试以下方法；

```
-- Replace PRINT function
DECLARE @strMsg NVARCHAR(100)
SELECT @strMsg = 'Here''s your message...'
RAISERROR (@strMsg, 0, 1) WITH NOWAIT 
```

或者

```
RAISERROR (n'Here''s your message...', 0, 1) WITH NOWAIT 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2016-04-18T20:43:35.527

另一个更好的选择是不依赖于 PRINT 或 RAISERROR，只需将“打印”语句加载到 TempDB 中的 ##Temp 表或数据库中的永久表中，这将使您可以通过另一个窗口中的 SELECT 语句立即查看数据. 这对我来说是最好的。使用永久表也可以作为过去发生的事情的日志。打印语句对于错误很方便，但是使用日志表，您还可以根据该特定执行的最后记录值确定确切的故障点（假设您在日志表中跟踪总体执行开始时间。）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-05-23T17:24:22.503

仅供参考，**如果您在脚本（批处理）中工作，而不是在存储过程中工作**，则刷新输出由 GO 命令触发，例如

```
print 'test'
print 'test'
go 
```

一般来说，我的结论如下：在 SMS GUI 中或使用 sqlcmd.exe 执行的 mssql 脚本执行的输出在第一个 GO 语句或直到脚本结束时刷新到文件、stdoutput、gui 窗口。

存储过程内部的刷新功能不同，因为您不能将 GO 放在里面。

参考：[tsql Go 语句](https://msdn.microsoft.com/en-us/library/ms188037.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-05-18T10:21:04.953

为了扩展[Eric Isaac 的答案](https://stackoverflow.com/a/36703942/4255824)，这里是如何正确使用表格方法：

首先，如果您的 sp 使用事务，您将无法实时监控表的内容，除非您使用以下`READ UNCOMMITTED`选项：

```
SELECT *
FROM table_log WITH (READUNCOMMITTED); 
```

或者

```
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SELECT *
FROM table_log; 
```

要解决回滚问题，请在日志表上放置一个递增的 ID，并使用以下代码：

```
SET XACT_ABORT OFF;
BEGIN TRY
  BEGIN TRANSACTION mytran;
  -- already committed logs are not affected by a potential rollback
  -- so only save logs created in this transaction
  DECLARE @max_log_id = (SELECT MAX(ID) FROM table_log);
  /*
   * do stuff, log the stuff
   */

  COMMIT TRANSACTION mytran;
END TRY
BEGIN CATCH
  DECLARE @log_table_saverollback TABLE
  (
    ID INT,
    Msg NVARCHAR(1024),
    LogTime DATETIME
  );

  INSERT INTO @log_table_saverollback(ID, Msg, LogTime)
  SELECT ID, Msg, LogTime
  FROM table_log
  WHERE ID > @max_log_id;

  ROLLBACK TRANSACTION mytran; -- this deletes new log entries from the log table

  SET IDENTITY_INSERT table_log ON;

  INSERT INTO table_log(ID, Msg, LogTime)
  SELECT ID, Msg, LogTime
  FROM @log_table_saverollback;

  SET IDENTITY_INSERT table_log OFF;
END CATCH 
```

请注意这些重要细节：

1.  `SET XACT_ABORT OFF;`防止 SQL Server 只是关闭整个事务而不是运行您的 catch 块，如果您使用此技术，请始终包含它。
2.  使用一个`@table_variable`，而不是一个`#temp_table`。临时表也受到回滚的影响。

# asp.net-2.0 - 在 Asp.net 2.0 中如何、在哪里存储不同范围内的对象

> ID：306946
> 
> 赞同：0
> 
> 时间：2008-11-20T21:42:39.630
> 
> 标签：asp.net-2.0, persistence, scope

需要问你一些帮助。

我有在 Net 2.0 中运行的网络应用程序。
我想问我应该为我的对象使用什么存储（缓存、会话、文件），因为它们有不同的使用范围。可以分为几组：
1）与访问者直接相关的对象（例如认证后收到的有关访问者的详细信息）
2）每个访问者使用的对象，因此它的应用范围（一些初始化数据，公共数据）

这些对象中的大多数都从 Web 服务获取数据，这很昂贵。

那么，考虑到速度、内存、可访问性以及我应该注意的其他方面，我的最佳选择是什么。

欢迎任何帮助。谢谢，X。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T21:48:46.077

1.  应该存储与访问者直接相关的对象，`Session`尽管过度使用`Session`和许多用户可能会导致可伸缩性问题。

2.  应该存储为每个访问者共享的对象，`Cache`以便如果不经常访问它们，它们将超出范围，以便可以回收内存（更不用说依赖项的额外激励）。在您知道对象必须立即可访问的情况下，无论上次访问对象之间经过了多长时间，您都应该将该对象存储在`Application`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T21:48:26.653

第 1 项 - 会话很可能是每个用户的最佳会话，但是，请务必限制其中的项目数量，因为存在扩展问题以及在网络场中的注意事项。

第 2 项 - 根据您的需要，这将是您想要添加的缓存或应用程序级别的项目，具体取决于到期需要等。关键区别在于缓存具有可以删除它的到期和使用项目，应用程序用于总是留在那里的东西。

总体而言，在 Web 应用程序中，我强烈推荐 AGAINST 文件，因为您必须担心线程安全。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T21:49:16.603

每个访问者的相对对象应存储在 Session 中。这是每个访问者唯一的，但往往会经常刷新，当您移动到多服务器环境时，这也很难扩展。

与整个应用程序相关的对象应存储在 ASP.NET 缓存中。

# linux - 在 Linux 中使用调制解调器库的 PPP 请求拨号

> ID：306968
> 
> 赞同：2
> 
> 时间：2008-11-20T21:47:32.397
> 
> 标签：linux, scripting, scalability, ppp

我有一个带有一组调制解调器的 linux 机器，需要创建到一组非常大的远程机器的按需拨号（出站）PPP 连接。由于我的遥控器比本地调制解调器多得多，因此我想启动一个或多个`pppd`in`demand`模式实例，但在请求连接之前不要分配特定的调制解调器。当连接空闲时，我想`pppd`释放调制解调器，以便它可以用于连接到不同的遥控器。

我已经浏览了这些`pppd man`页面并了解了`call`和`connect`选项的概念，以及`options.DEVICE`文件和`/etc/ppp/peers`目录。锁定文件会告诉我哪些调制解调器正在使用或可用。只要我对调制解调器分配进行硬编码，我就可以连接到多个远程对等点。但是我还没有找到一种动态分配它们的方法，比如在需要拨号`get_available_modem`时调用脚本。`pppd`谷歌似乎也不知道。

一种解决方法可能是检测是否需要使用外部机制进行请求拨号，然后启动`pppd`以对其进行服务，但在其内部利用该设施似乎更清洁`pppd`。

任何指针或想法表示赞赏。谢谢你的想法！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T21:51:53.813

这是我要使用的解决方案：

*   将调制解调器枚举为`/dev/modem0`, `/dev/modem1`, ...
*   `pppd`为每个对等点启动请求拨号模式的实例，但不是“真正的”调制解调器，而是将其附加到`/dev/modem.`*对等*点，“ppp-on-dialer”脚本动态软链接到第一个可用的调制解调器。
*   当连接超时并且调制解调器脱机时，软链接`/dev/modem.`*对等*，`/dev/null`因此调制解调器可以重新用于与不同对等的连接。

感谢您的意见！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T18:43:28.507

它是否必须由 Linux 机器直接驱动，或者你可以使用像旧的 Lucent Portmaster boxen 这样的东西吗？

# visual-studio-2008 - VS 2008 页面向左打开

> ID：306971
> 
> 赞同：0
> 
> 时间：2008-11-20T21:48:06.217
> 
> 标签：visual-studio-2008

当我从 VS 2008 的解决方案资源管理器中打开一个页面（.aspx,xslt,css..etc）时，它会在我当前活动选项卡的左侧打开。我习惯了 VS2003/VS2005，其中新页面打开到当前活动页面的右侧。如何将所有页面设置为向右打开？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T22:40:16.220

似乎这在 VS 2005/VS 2008 中无法完成

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=360962](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=360962) [http://www.codeverge.net/ng.asp-net-forum.visual_studio_2005/order-of-document-tabs-in -vs-2005](http://www.codeverge.net/ng.asp-net-forum.visual_studio_2005/order-of-document-tabs-in-vs-2005)

很伤心……很难习惯这种行为

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-20T19:41:43.563

这现在可以在 Visual Studio 2010 Beta 2 中，在工具 > 选项 > 环境 > 文档下：

![替代文字](https://farm3.static.flickr.com/2719/4290601573_568d419cc6_o.jpg)

# asp.net - .net 缓存大小

> ID：306986
> 
> 赞同：2
> 
> 时间：2008-11-20T21:51:50.717
> 
> 标签：asp.net, iis

有没有办法监控 Web 服务器上缓存的大小？我只是想看看我的服务器有多少内存被缓存占用了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T22:24:38.700

**在ASP.NET 应用程序**类别中有一个名为**Cache % Process Memory Limit Used的**[性能计数器](http://msdn.microsoft.com/en-us/library/fxk122b4.aspx)

 ****# .net - 如何在使用 WiX 安装期间加密 app.config 文件部分？

> ID：306992
> 
> 赞同：7
> 
> 时间：2008-11-20T21:54:24.910
> 
> 标签：.net, wix, installation, app-config, dtf

我在[这里](http://madtechnology.wordpress.com/2007/05/04/using-wix-to-secure-a-connection-string/)找到了一个在安装期间加密 web.config 的示例，但我的应用程序是 Windows 服务。该`aspnetreg_iis`方法仅适用于 web.config 文件。

我知道如何以编程方式加密配置文件，但我认为我不能使用 WiX 来做到这一点。我错了吗？有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T04:59:15.207

这就是我最终得到的......

我使用 WiX 和 DTF 创建了一个托管代码自定义操作来加密配置文件的给定部分：

```
 public static void EncryptConfig(Session session)
    {

        var configPath = session["APPCONFIGPATH"];
        var sectionToEncrypt = session["SECTIONTOENCRYPT"];

        var fileMap = new ExeConfigurationFileMap();
        fileMap.ExeConfigFilename = configPath;
        var configuration = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);
        ConfigurationSection section = configuration.GetSection(sectionToEncrypt);

        if (!section.SectionInformation.IsProtected)
        {
            section.SectionInformation.ProtectSection("DataProtectionConfigurationProvider");
            section.SectionInformation.ForceSave = true;
            configuration.Save(ConfigurationSaveMode.Modified);

        }
    } 
```

导致这个问题的部分原因是我不知道您可以使用 DTF 在托管代码中安全地创建自定义操作。DTF 上的文档很少，但一旦你开始工作，它就很棒。

我发现这仅在我在 InstallFinalize 之后安排自定义操作时才有效。

这是实现它的 WiX 配置：

```
<InstallExecuteSequence>
  <Custom Action="EncryptConfigurationFiles" After="InstallFinalize" />
</InstallExecuteSequence>

<Fragment>
    <Binary Id="YourProject.CustomActions.dll" SourceFile="$(var.YourProject.CustomActions.TargetDir)$(var.YourProject.CustomActions.TargetName).CA.dll" />
    <CustomAction Id="EncryptConfigurationFiles" BinaryKey="YourProject.CustomActions.dll" DllEntry="EncryptConfig" Return="check" />
</Fragment> 
```

这些博客/网站帮助我到达那里，上面的大部分代码都来自它们：

[http://geekswithblogs.net/afeng/Default.aspx](http://geekswithblogs.net/afeng/Default.aspx) [http://blog.torresdal.net/2008/10/24/WiXAndDTFUsingACustomActionToListAvailableWebSitesOnIIS.aspx](http://blog.torresdal.net/2008/10/24/WiXAndDTFUsingACustomActionToListAvailableWebSitesOnIIS.aspx) [http://blogs.msdn.com/jasongin/archive/2008/07/ 09/votive-project-platform-configurations.aspx](http://blogs.msdn.com/jasongin/archive/2008/07/09/votive-project-platform-configurations.aspx)

@PITADeveloper ...感谢您的回复。我发现我不需要加载程序集来加密配置文件。

如果你使用这个，你应该使用一个try catch并返回一个ActionResult......上面是伪代码。

最后，我正在使用 DataProtectionConfigurationProvider。对于 RSA Provider，我认为还有更多的障碍需要跳过。

我希望这可以帮助别人！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T22:21:27.960

您应该能够在自定义操作中执行此操作。我发现为 ExeConfigurationFileMap 加载程序集会引发异常，但您可以通过向 AppDomain 添加 AssemblyResolve 处理程序来处理该异常。这是我编写的富客户端应用程序的一种破解，用于使用机器加密密钥加密/解密受保护的配置部分。它可能不是最漂亮的代码，但我希望你能从中得到图片。此代码假定您在配置文件中定义了要使用的 ProtectionProvider。

```
//class global
static System.Reflection.Assembly DefiningAssembly;

AppDomain currentDomain = AppDomain.CurrentDomain;
currentDomain.AssemblyResolve += new ResolveEventHandler(MyResolveEventHandler);

static System.Reflection.Assembly MyResolveEventHandler(object sender, ResolveEventArgs args)
{
     return DefiningAssembly;
} 
```

然后，您可以像这样加载配置：

```
DefiningAssembly = System.Reflection.Assembly.LoadFrom("path to defining assembly for config");

//Set the Configuration using an ExeConfigurationFileMap - This works for any .config file.
ExeConfigurationFileMap CfgMap = new ExeConfigurationFileMap();
CfgMap.ExeConfigFilename = "path to config file";
Configuration config = ConfigurationManager.OpenMappedExeConfiguration(CfgMap, ConfigurationUserLevel.None);

List<string> DefiningAssemblyTypes = new List<string>();
foreach (System.Type type in DefiningAssembly.GetExportedTypes())
{
     DefiningAssemblyTypes.Add(type.Name);
}

foreach (ConfigurationSection tempSection in config.Sections)
{
     if (DefiningAssemblyTypes.Contains(tempSection.ElementInformation.Type.Name))
     {
          section = tempSection;
          break;
     }
}
ProtectionProviderName = section.SectionInformation.ProtectionProvider.Name;
section.SectionInformation.ProtectSection(ProtectionProviderName);
config.Save(ConfigurationSaveMode.Minimal, true); 
```

我希望这对你有帮助，祝你好运。

# c# - 什么是使用受保护对象 C#（使用 NMock 和 NUnit 框架）为代码编写单元测试的好方法

> ID：306996
> 
> 赞同：4
> 
> 时间：2008-11-20T21:55:36.217
> 
> 标签：c#, unit-testing, nunit, nmock

为包含其他对象的单个类编写单元测试时，最好的使用方法是什么

模拟对象以避免依赖于其他类的测试。

示例 1：

```
public class MyClass
{
   protected MyObject _obj;

   public MyClass()
   {
       _obj = new MyObject();
   }

   public object DoSomething()
   {
      //some work
      _obj.MethodCall();
      //more work;
      return result;
   }
} 
```

我宁愿不公开受保护的值来为代码创建单元测试。包装类将

为测试工作，但有更好的方法吗？

示例 2：

```
public class MyClass
{

   public object DoSomething()
   {

      //some work
      MyObject obj = new obj(parameters);
      _obj.MethodCall(Method1);
      //more work;
      return result;
   }

   public int Method1()
   { ... }    

} 
```

与上面的示例类似，但 ojbect 是在我调用的方法中创建的。

示例 3：

```
public class MyClass
{

   public object DoSomething()
   {

      //some work
      obj.MethodCall(Method1);
      //more work;
      return result;
   }

   public int MethodA()
   { ... }    

} 
```

当 MethodA 仅用作委托时，有没有办法测试它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:49:13.253

我建议你看看依赖注入。一件事是使用模拟对象，但除非您使用诸如 TypeMock 之类的东西，它基本上可以让您动态修改代码，否则您希望有一种方法来注入您的类所依赖的实例，如果您想摆脱依赖关系。因此，在示例 1 中，我建议不要在构造函数中新建 MyObject 的实例，而是让调用者提供该实例。在这种情况下，您可以轻松地用模拟甚至存根替换它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T22:48:52.163

您是否尝试过从 MyClass 派生 UTMyClass？****************