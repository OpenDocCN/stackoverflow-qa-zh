# StackOverflow 问答 000158000-000158999

# html - “语音家族”黑客的共识是什么？

> ID：158004
> 
> 赞同：4
> 
> 时间：2008-10-01T14:49:34.403
> 
> 标签：html, css, xhtml

我刚开始在一家相当大的公司工作，我的团队管理着他们所有面向公众的网站。我今天第一次打开样式表，看到了超过 20 个设计人员使用语音系列破解来修复 IE 错误的实例。（我不知道他们为什么允许平面设计师编写任何类型的标记）

Voice-family hack的公众舆论是什么。值得花时间推荐使用 IE 条件注释来包含自定义样式表吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T16:45:31.020

“voice-family” hack，更广为人知的是 Tantek Celik Box Model Hack，用于在 Windows 上隐藏特定的 CSS 规则，因为这些浏览器中的 CSS 标准实现不正确。它试图向所有浏览器提供最正确的单个样式表，而无需借助浏览器嗅探和多个样式表。

具有讽刺意味的是，这种 hack 是许多工时（数月？）的实验和测试的结果，以开发适用于旧版、新版和未来浏览器的符合标准的样式表。它是为弥补浏览器遵守 CSS 标准的可怕状态而创建的几种解决方法之一。

请参阅 Jeffrey Zeldman 的*Designing with Web Standards*以深入了解为什么遵守标准（尽可能地）是一个有价值的目标，以及为什么使用浏览器嗅探和多个样式表只会让开发人员头疼：

[http://www.amazon.com/Designing-Web-Standards-Jeffrey-Zeldman/dp/0321385551/](https://rads.stackoverflow.com/amzn/click/com/0321385551)

一个例子是为了跟上浏览器/操作系统组合的军备竞赛，更不用说手机和其他具有浏览功能的未来设备了。每个新组合都必须更改检测代码，并且由于许多浏览器伪装成 Netscape Navigator 的方式，检测可以成为一项全职工作。

另一个很好的参考是 Web Standards Project，它有很多关于这个主题的很好的信息和教程：

[http://www.webstandards.org/](http://www.webstandards.org/)

如果您将编码风格转向符合标准，您通常不必担心未来浏览器的发布。是的，您仍然需要针对它们进行测试，但您不必编写然后测试每个自定义样式表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T17:40:47.830

任何类型的黑客都是危险的，因为它们很容易在未来的浏览器中产生意想不到的影响（很多都被 IE7 破坏了）。过滤 CSS 的安全方法是：

*   （仅适用于 IE）使用条件注释。这些将始终在 Microsoft 浏览器上运行，并且始终被所有其他浏览器忽略，因为它们在评论中
*   功能定位 - 使用仅现代浏览器支持的 CSS 选择器来阻止旧浏览器尝试解释规则。然而，浏览器识别语法这一事实并不意味着它可以正确处理它。你在这里保证的是旧浏览器不会尝试呈现这些规则，而不是现代浏览器会正确执行它们

尽可能使用所有主流浏览器正确支持的 CSS 子集。随着旧的错误浏览器下降到用户的可忽略百分比，随着时间的推移，这种情况正在改善。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T14:56:32.967

我对这样的黑客的感觉是，如果可以的话，你应该避免它们。如果可以在不诉诸此类恶作剧的情况下跨浏览器获得正确的渲染，那么您应该以正确的方式进行。然而，有时浏览器有错误的 CSS 实现，有必要使用这样的 hack。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T15:52:37.887

不要使用条件包含。改用[CSS 选择器](http://rafael.adm.br/css_browser_selector)，它更优雅。您可以在单个浏览器（和/或版本）上定位类：

。我的课 { ... }

.ie6 .myClass { ... }

# regex - 如何在 AWStats 配置文件中为 SkipHosts 指定 IP 范围 (RegEx)？

> ID：158008
> 
> 赞同：1
> 
> 时间：2008-10-01T14:50:35.553
> 
> 标签：regex, awstats

我正在更新一些旧的 AWStats 配置文件以过滤掉一些特定的 IP 范围。这是配置文件的相关部分：

```
# Do not include access from clients that match following criteria.
# If your log file contains IP addresses in host field, you must enter here
# matching IP addresses criteria.
# If DNS lookup is already done in your log file, you must enter here hostname
# criteria, else enter ip address criteria.
# The opposite parameter of "SkipHosts" is "OnlyHosts".
# Note: Use space between each value. This parameter is not case sensitive.
# Note: You can use regular expression values writing value with REGEX[value].
# Change : Effective for new updates only
# Example: "127.0.0.1 REGEX[^192\.168\.] REGEX[^10\.]"
# Example: "localhost REGEX[^.*\.localdomain$]"
# Default: ""
#
SkipHosts="" 
```

例如，我想过滤掉 XYZ[97-110]

我尝试了这种格式（注意：不是这些 IP 值，以私有范围为例）：

```
REGEX[^192\.168\.1\.[97-110]] 
```

但这会导致以下错误：

> **CGI 错误**
> 指定的 CGI 应用程序因未返回一组完整的 HTTP 标头而行为异常。

我讨厌一切都使用不同的 RegEx 语法。有谁知道这个是如何工作的，以及我如何在这里指定一个范围？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T15:09:49.953

假设 REGEX[ ] 中支持字符类：

```
SkipHosts = "REGEX[^192\.168\.1\.(9[7-9]|10[0-9]|110)$]" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:10:05.117

您使用的正则表达式将 9 或 7 指定为 1 或 1 或 0，这会搞砸。

您可以使用

```
SkipHosts="REGEX[^192\.168\.1\.(97|98|99|100|101|102|103|104|105|106|107|108|109|110)]" 
```

如果你这么倾向于

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T15:03:05.617

如果您将 SkipHosts 留空，AWStats 会运行吗？否则，请尝试使用命令行实用程序检查错误。例如，使用 Windows：

```
c:\perlpath\perl.exe awstats.pl config=yourconfigfile -update -logfile=yourlogfile 
```

那应该提供更多细节。

# bash - 如何使用“查找”来搜索在特定日期创建的文件？

> ID：158044
> 
> 赞同：278
> 
> 时间：2008-10-01T14:56:37.770
> 
> 标签：bash, unix, find

如何使用 UNIX 命令`find`搜索在特定日期创建的文件？

* * *

## 回答 #1

> 赞同：366
> 
> 时间：2008-10-01T15:30:48.250

正如 Max 指出的那样，您不能，但是检查修改或访问的文件并不是那么难。我写了一篇关于这个的[教程](http://virtuelvis.com/2008/10/how-to-use-find-to-search-for-files-created-on-a-specific-date/)，直到今天。其本质是使用`-newerXY`and `! -newerXY`：

示例：要查找 2007 年 6 月 7 日修改的所有文件：

```
$ find . -type f -newermt 2007-06-07 ! -newermt 2007-06-08 
```

要查找 2008 年 9 月 29 日访问的所有文件：

```
$ find . -type f -newerat 2008-09-29 ! -newerat 2008-09-30 
```

或者，在同一天更改了权限的文件：

```
$ find . -type f -newerct 2008-09-29 ! -newerct 2008-09-30 
```

但是，如果您不更改文件的权限，“c”通常对应于创建日期。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2008-10-01T15:03:58.750

使用此命令搜索文件和文件夹，`/home/`根据您的需要添加时间段：

```
find /home/ -ctime time_period 
```

**time_period 的示例：**

*   30 多天前：`-ctime +30`

*   不到 30 天前：`-ctime -30`

*   正好 30 天前：`-ctime 30`

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-10-01T15:05:07.390

这是两个步骤，但我喜欢这样做：

首先创建一个具有特定日期/时间的文件。在这种情况下，文件是 2008-10-01 午夜

```
touch -t 0810010000 /tmp/t 
```

现在我们可以找到所有比上述文件新或旧的文件（按文件修改日期。您也可以使用**-anewer**访问和**-cnewer**文件状态已更改）。

```
find / -newer /tmp/t
find / -not -newer /tmp/t 
```

您还可以通过触摸创建两个文件来查看特定日期之间的文件

```
touch -t 0810010000 /tmp/t1
touch -t 0810011000 /tmp/t2 
```

这将找到两个日期和时间之间的文件

```
find / -newer /tmp/t1 -and -not -newer /tmp/t2 
```

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2008-10-01T15:01:26.887

你可以这样做：

```
find ./ -type f -ls |grep '10 Sep' 
```

例子：

```
[root@pbx etc]# find /var/ -type f -ls | grep "Dec 24"
791235    4 -rw-r--r--   1 root     root           29 Dec 24 03:24 /var/lib/prelink/full
798227  288 -rw-r--r--   1 root     root       292323 Dec 24 23:53 /var/log/sa/sar24
797244  320 -rw-r--r--   1 root     root       321300 Dec 24 23:50 /var/log/sa/sa24 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-01T15:08:24.607

你不能。-c 开关告诉您上次更改权限的时间，-a 测试最近的访问时间，-m 测试修改时间。大多数Linux（ext3）使用的文件系统不支持“创建时间”记录。对不起！

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-01T15:23:39.280

@Max：关于创建时间是正确的。

但是，如果要计算`-atime`, `-ctime`,参数之一的经过天数`-mtime`参数，可以使用以下表达式

```
ELAPSED_DAYS=$(( ( $(date +%s) - $(date -d '2008-09-24' +%s) ) / 60 / 60 / 24 - 1 )) 
```

将“2008-09-24”替换为您想要的任何日期，ELAPSED_DAYS 将设置为从那时到今天的天数。`find`（更新：从结果中减去一个以与' 日期四舍五入对齐。）

因此，要查找在 2008 年 9 月 24 日修改的任何文件，命令将是：

```
find . -type f -mtime $(( ( $(date +%s) - $(date -d '2008-09-24' +%s) ) / 60 / 60 / 24 - 1 )) 
```

如果您的版本`find`不支持`-newerXY`@Arve:'s answer中提到的谓词，这将起作用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T15:03:30.390

通过查找 -atime、-ctime 和 -mtime 开关，您可以接近您想要实现的目标。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2011-10-24T15:53:32.373

```
cp `ls -ltr | grep 'Jun 14' | perl -wne 's/^.*\s+(\S+)$/$1/; print $1 . "\n";'` /some_destination_dir 
```

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-10-01T15:02:40.923

我在删除所有超过 14 天的文件的脚本中发现了这个脚本：

```
CNT=0
for i in $(find -type f -ctime +14); do
  ((CNT = CNT + 1))
  echo -n "." >> $PROGRESS
  rm -f $i
done
echo deleted $CNT files, done at $(date "+%H:%M:%S") >> $LOG 
```

我认为额外的“man find”并寻找 -ctime / -atime 等参数将在这里为您提供帮助。

# perl - 为什么我不能使用模板工具包？

> ID：158055
> 
> 赞同：3
> 
> 时间：2008-10-01T14:58:10.357
> 
> 标签：perl, iis, template-toolkit, activestate

我正在尝试使用 TemplateToolkit 而不是好的 ole' 变量插值，而我的服务器让我很伤心。以下是我得到的错误：

```
*** 'D:\Inetpub\gic\source\extjs_source.plx' error message at: 2008/09/30 15:27:37 failed to create context: failed to create context: failed to load Template/Stash/XS.pm: Couldn't load Template::Stash::XS 2.20:

Can't load 'D:/Perl/site/lib/auto/Template/Stash/XS/XS.dll' for module Template::Stash::XS: load_file:The specified procedure could not be found at D:/Perl/lib/DynaLoader.pm line 230\.  at D:/Perl/site/lib/Template/Stash/XS.pm line 31

BEGIN failed--compilation aborted at D:/Perl/site/lib/Template/Stash/XS.pm line 31\. Compilation failed in require at D:/Perl/site/lib/Template/Config.pm line 82. 
```

平台是 Windows Server 2003，我们使用 ActiveState perl 和 PPM 来处理带有 IIS 的包。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-01T14:59:25.563

想了很久才弄明白这个。显然 ActiveState 人员并没有对包进行太多检查，因为它需要 Template::Stash::XS，但这实际上在 PPM 中不可用。要解决此问题，只需编辑 Template/Config.pm 并将 Template::Stash::XS 更改为 Template::Stash。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T20:54:47.193

据我所知，如果 Template Toolkit 可用于 Strawberry Perl，您绝对应该考虑切换到 Strawberry。

# jquery - 如何使用 jQuery 相对于另一个元素定位一个元素？

> ID：158070
> 
> 赞同：359
> 
> 时间：2008-10-01T15:01:01.660
> 
> 标签：jquery

我有一个隐藏的 DIV，其中包含一个类似工具栏的菜单。

我有许多 DIV，当鼠标悬停在它们上方时，它们可以显示菜单 DIV。

是否有内置功能可以将菜单 DIV 移动到活动（鼠标悬停）DIV 的右上角？我正在寻找类似的东西`$(menu).position("topright", targetEl);`

* * *

## 回答 #1

> 赞同：402
> 
> 时间：2008-10-01T15:22:13.327

**tl;博士：（**[在这里](http://jsfiddle.net/wjbuys/QrrpB/)试试）

如果您有以下 HTML：

```
<div id="menu" style="display: none;">
   <!-- menu stuff in here -->
   <ul><li>Menu item</li></ul>
</div>

<div class="parent">Hover over me to show the menu here</div> 
```

那么您可以使用以下 JavaScript 代码：

```
$(".parent").mouseover(function() {
    // .position() uses position relative to the offset parent, 
    var pos = $(this).position();

    // .outerWidth() takes into account border and padding.
    var width = $(this).outerWidth();

    //show the menu directly over the placeholder
    $("#menu").css({
        position: "absolute",
        top: pos.top + "px",
        left: (pos.left + width) + "px"
    }).show();
}); 
```

**但它不起作用！**

只要菜单和占位符具有相同的偏移父级，这将起作用。如果他们没有，并且您没有嵌套的 CSS 规则来关心`#menu`元素在 DOM 中的位置，请使用：

```
$(this).append($("#menu")); 
```

就在定位`#menu`元素的行之前。

**但它仍然不起作用！**

您可能有一些奇怪的布局不适用于这种方法。在这种情况下，只需使用[jQuery.ui 的位置插件](http://jqueryui.com/demos/position/)（如下面的[答案](https://stackoverflow.com/a/2781557/22107)中所述），它可以处理所有可能的情况。请注意，在调用之前您必须`show()`使用菜单元素`position({...})`；该插件无法定位隐藏元素。

**3年后的2012年更新说明：**

（原始解决方案[在此处](http://jsfiddle.net/wjbuys/LCt7z/)存档以供后代使用）

所以，原来我在这里的原始方法远非理想。特别是，如果出现以下情况，它将失败：

*   菜单的偏移父级不是占位符的偏移父级
*   占位符有边框/填充

幸运的是，jQuery 在 1.2.6 中引入了方法 (`position()`和`outerWidth()`)，这使得在后一种情况下找到正确的值变得容易得多。对于前一种情况，`append`将菜单元素添加到占位符有效（但会破坏基于嵌套的 CSS 规则）。

* * *

## 回答 #2

> 赞同：210
> 
> 时间：2010-05-06T13:37:40.750

**注意：**这需要 jQuery UI（不仅仅是 jQuery）。

您现在可以使用：

```
$("#my_div").position({
    my:        "left top",
    at:        "left bottom",
    of:        this, // or $("#otherdiv")
    collision: "fit"
}); 
```

用于快速定位（*[jQuery UI/Position](http://api.jqueryui.com/position/)*）。

您可以[在此处下载 jQuery UI](http://jqueryui.com/)。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-02T07:16:12.080

这最终对我有用。

```
var showMenu = function(el, menu) {
    //get the position of the placeholder element  
    var pos = $(el).offset();    
    var eWidth = $(el).outerWidth();
    var mWidth = $(menu).outerWidth();
    var left = (pos.left + eWidth - mWidth) + "px";
    var top = 3+pos.top + "px";
    //show the menu directly over the placeholder  
    $(menu).css( { 
        position: 'absolute',
        zIndex: 5000,
        left: left, 
        top: top
    } );

    $(menu).hide().fadeIn();
}; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-07-15T00:19:21.040

这是我编写的一个 jQuery 函数，可以帮助我定位元素。

这是一个示例用法：

```
$(document).ready(function() {
  $('#el1').position('#el2', {
    anchor: ['br', 'tr'],
    offset: [-5, 5]
  });
}); 
```

上面的代码将#el1 的右下角与#el2 的右上角对齐。['cc', 'cc'] 将 #el1 居中在 #el2 中。确保 #el1 具有 position: absolute 和 z-index: 10000 （或一些非常大的数字）的 css 以使其保持在顶部。

偏移选项允许您将坐标微移指定数量的像素。

源代码如下：

```
jQuery.fn.getBox = function() {
  return {
    left: $(this).offset().left,
    top: $(this).offset().top,
    width: $(this).outerWidth(),
    height: $(this).outerHeight()
  };
}

jQuery.fn.position = function(target, options) {
  var anchorOffsets = {t: 0, l: 0, c: 0.5, b: 1, r: 1};
  var defaults = {
    anchor: ['tl', 'tl'],
    animate: false,
    offset: [0, 0]
  };
  options = $.extend(defaults, options);

  var targetBox = $(target).getBox();
  var sourceBox = $(this).getBox();

  //origin is at the top-left of the target element
  var left = targetBox.left;
  var top = targetBox.top;

  //alignment with respect to source
  top -= anchorOffsets[options.anchor[0].charAt(0)] * sourceBox.height;
  left -= anchorOffsets[options.anchor[0].charAt(1)] * sourceBox.width;

  //alignment with respect to target
  top += anchorOffsets[options.anchor[1].charAt(0)] * targetBox.height;
  left += anchorOffsets[options.anchor[1].charAt(1)] * targetBox.width;

  //add offset to final coordinates
  left += options.offset[0];
  top += options.offset[1];

  $(this).css({
    left: left + 'px',
    top: top + 'px'
  });

} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-29T11:59:17.230

为什么要复杂太多？解决方法很简单

CSS：

```
.active-div{
position:relative;
}

.menu-div{
position:absolute;
top:0;
right:0;
display:none;
} 
```

jQuery：

```
$(function(){
    $(".active-div").hover(function(){
    $(".menu-div").prependTo(".active-div").show();
    },function(){$(".menu-div").hide();
}) 
```

**即使它有效，**

*   两个 div 放置在其他任何地方
*   浏览器调整大小

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-03-31T14:24:37.197

你可以使用 jQuery 插件[PositionCalculator](http://tlindig.github.io/position-calculator/)

该插件还包括碰撞处理（翻转），因此可以将类似工具栏的菜单放置在可见位置。

```
$(".placeholder").on('mouseover', function() {
    var $menu = $("#menu").show();// result for hidden element would be incorrect
    var pos = $.PositionCalculator( {
        target: this,
        targetAt: "top right",
        item: $menu,
        itemAt: "top left",
        flip: "both"
    }).calculate();

    $menu.css({
        top: parseInt($menu.css('top')) + pos.moveBy.y + "px",
        left: parseInt($menu.css('left')) + pos.moveBy.x + "px"
    });
}); 
```

对于该标记：

```
<ul class="popup" id="menu">
    <li>Menu item</li>
    <li>Menu item</li>
    <li>Menu item</li>
</ul>

<div class="placeholder">placeholder 1</div>
<div class="placeholder">placeholder 2</div> 
```

这是小提琴：http: [//jsfiddle.net/QrrpB/1657/](http://jsfiddle.net/QrrpB/1657/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T15:22:34.837

像这样的东西？

```
$(menu).css("top", targetE1.y + "px"); 
$(menu).css("left", targetE1.x - widthOfMenu + "px"); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-14T08:56:14.307

这对我有用：

```
var posPersonTooltip = function(event) {
var tPosX = event.pageX - 5;
var tPosY = event.pageY + 10;
$('#personTooltipContainer').css({top: tPosY, left: tPosX}); 
```

# asp.net - DotNetNuke“保活”

> ID：158091
> 
> 赞同：3
> 
> 时间：2008-10-01T15:03:56.363
> 
> 标签：asp.net, dotnetnuke

我有几个我管理的 DNN 门户，我需要一个解决方案来让它们在交通不畅的时候保持“活跃”。在给定的不活动时间后，IIS 将从内存中卸载 DNN 应用程序，这将影响第一个客户端请求的加载时间。DNN 有一个“KeepAlive.aspx”文件，我每 5 分钟从 CRON 作业中使用 wget 命令访问该文件。我怀疑这种方法的有效性。有人有其他想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T19:46:47.650

一个好的网站监控服务很可能会为您提供一个 URL 来检查网站是否正常运行，这就是 Keepalive URL 的用途。让服务检查 URL 的频率超过 15 分钟，您应该可以继续保持网站正常运行。站点总是有可能因其他问题而关闭，但如果发生这种情况并且其他用户尚未点击它，则保持活动服务应该将其恢复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T15:14:43.093

在全局应用程序启动事件中，您可以设置一个超时为 5 分钟的缓存项或计时器，并在回调代码中，ping 一个应该返回 HTTP 200 的简单页面 - 重置缓存/计时器，然后重复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T19:34:33.073

如果您正在寻找一项服务，那里有很多服务，有些是免费的，有些不是

*   [主机跟踪器](http://www.host-tracker.com)
*   [王国](http://www.pingdom.com)
*   永远保持活力

我以前使用过 Host-Tracker 和 Pingdom，它们很棒，因为它们也会通知您中断

# php - 回显一个链接，得到一个尾随斜线？

> ID：158104
> 
> 赞同：1
> 
> 时间：2008-10-01T15:07:05.123
> 
> 标签：php, jfilechooser

我发现每当我执行以下操作时：

```
echo '<a href="http://" title="bla">huzzah</a>'; 
```

我最终将以下内容呈现给浏览器：

```
<a href="http:///" title="bla">huzzah</a> 
```

当我链接到带有扩展名的文件时，这尤其令人讨厌，因为它会破坏链接。

任何想法为什么会发生这种情况以及我该如何解决？

**更新：** 对于那些询问我的确切实施的人，在这里。在我的故障排除中，我尽可能地把它简化了，所以请不要介意我在哪里将纯文本连接到纯文本......

```
function print_it($item) {
    echo '<div class="listItem clearfix">';
    echo '<div class="info">';
    echo '<span class="title">';
    if(isset($item[6])) {
        echo '<a href="http://" title="">' . 'me' . '</a>';
    }
    echo '</span>';
echo '</div></div>';
} 
```

**更新：** 作为对 Matt Long 的回应，我粘贴了您的行，并且呈现相同的内容。

**更新：** 作为对 Fire Lancer 的回应，我重新尝试了最初的尝试，并将在下面向您展示。

```
echo substr($item[6],13) . '<br>';
echo '<a href="http://' . substr($item[6],13) . '" title="' . $item[0] . '">' . $item[0] . '</a>';

<span class="title">www.edu.gov.on.ca%2Feng%2Ftcu%2Fetlanding.html<br>
<a href="http://www.edu.gov.on.ca%2Feng%2Ftcu%2Fetlanding.html" title="Employment Ontario">Employment Ontario</a></span> 
```

子字符串的原因是由于 URL 在其他地方通过 rawurlencode() 运行，并且链接到 http%3A%2F%2F 使页面认为它是本地/相对链接。

**更新：** 我粘贴了上面的回复而没有真正看它。因此，在查看源代码时 HTML 是正确的，但实际页面会在其后加上另一个斜杠来解释它。

**解决方案：** 这都是 rawlurlencode() 的结果。如果我一起解码或跳过编码，一切都会完美运行。关于 rawurlencode() 的一些东西使浏览器想要在其中添加一个斜杠。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T15:09:51.547

我从来没有这样过，你对链接的反应如何？以下所有应该工作。

```
echo '<a href="http://someothersite.com">Link</a>';
echo '<a href="anotherpage.php">Some page</a>';
echo '<a href="../pageinparentdir.php">Another page</a>';
etc 
```

编辑，因为您添加了信息。

您不能只将 http:// 作为 href，即使将该链接直接输入到 html 页面也会产生这种效果。例如：
html：

```
 <a href="http://" title="bla">huzzah</a> 
```

链接（在FF3中）：

```
http:/// 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:43:29.233

Firefox, especially, shows you the html source the way it's seeing it which is rarely the way you've sent it. Clearly something about your link or it's context is making the browser interpret a trailing slash.

I wonder if it's a side effect of the url encoding. If you rawurldecode it will that help. If there are parts of the url that need to stay encoded you could search for the slashes and just put those back.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T15:10:03.603

错误必须在其他地方。`echo`逐字写入字符串。没有对任何部分进行后处理。因此，额外的斜杠会添加到代码中的其他位置（在将字符串传递给 之前`echo`）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T15:18:15.020

如果您使用双引号并像这样转义内部双引号，您会得到相同的结果吗？

```
echo "<a href=\"http://\" title=\"bla\">huzzah</a>"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T15:40:28.850

如果我将该 echo 命令放在我的 PHP 代码中，它会按预期输出“http://”（您可以在生成的输出的源代码中看到它），但是当我将鼠标悬停在结果页面中的链接上时（使用 IE7 )，它显示[http:///](http:///)。

My guess is, that that's browser behaviour, because there can't be a http:// link without a host name or IP address (you can't just access the protocol).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T15:54:34.557

正如一些人指出的那样，“http://”不是有效链接，因此您的浏览器会在末尾添加额外的斜杠。要查看它，请尝试 lynx -dump [http://yourdomain/yourfile.php](http://yourdomain/yourfile.php)（如果您有幸拥有 linux）或从您的机器 telnet 到您的服务器的 80 端口，然后输入：

```
GET /path/file.php HTTP/1.0 
```

看看结果。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-01T16:04:27.217

您是否查看过您的 PHP 配置设置？可能是 magic_quotes_gpc 决定为您逃避事情（我已经被该设置咬了好几次，尤其是在使用 AJAX/JSON 流量时）。尝试确保它已关闭并再次回显（您可能需要编辑 php.ini 文件，或添加`php_flag magic_quotes_gpc off`到您正在工作的目录中的 .htaccess 文件，具体取决于您的环境）。

# .net - Math.IEEERemainder 返回否定结果。为什么？

> ID：158120
> 
> 赞同：7
> 
> 时间：2008-10-01T15:10:54.833
> 
> 标签：.net, .net-2.0

除了标准的 mod 运算符之外，.net 框架还包括 Math.IEEERemainder(x, y)。这个函数到底在做什么？我不明白这会产生负数。

例子：

```
Math.IEEERemainder(0, 2) = 0
Math.IEEERemainder(1, 2) = 1
Math.IEEERemainder(2, 2) = 0
Math.IEEERemainder(3, 2) = -1 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T15:15:21.440

如果您阅读[System.Math.IEEERemainder 的 MSDN 页面](http://msdn.microsoft.com/en-us/library/system.math.ieeeremainder.aspx)中给出的示例，您会注意到两个正数可以有一个负数的余数。

> **返回值**
> 
> 一个等于*x - (y Q)*的数字，其中*Q*是*x / y*四舍五入到最接近的整数的商（如果*x / y*落在两个整数的中间，则返回偶数）。

所以：3 - (2 * (round(3 / 2))) = -1

```
/*
...
Divide two double-precision floating-point values:
1) The IEEE remainder of 1.797693e+308/2.00 is 0.000000e+000
2) The IEEE remainder of 1.797693e+308/3.00 is -1.000000e+000
Note that two positive numbers can yield a negative remainder.

*/ 
```

## 结语

实际的问题可能是，“为什么我们有两个余数运算？” 在处理浮点数据时，您始终需要了解您的浮点标准。由于我们处于 21 世纪，大多数东西都在 IEEE 754 上，我们中很少有人担心说 VAX F_Float 与 IEEE 754。

[C# 标准](https://stackoverflow.com/questions/127776/where-can-you-find-the-c-language-specifications)规定，当应用于浮点参数时，余数运算符（第 7.7.3 节）类似于应用于整数参数时的余数运算符。也就是说，在整数和浮点余数运算中都使用相同的数学公式¹（另外考虑与浮点表示相关的极端情况）。

因此，如果您希望浮点数的余数运算符合您当前的 IEEE 754 舍入模式，建议使用**Math.IEEERemainder**。但是，如果您的用法对 C# 余数运算符产生的舍入的细微差别不是特别敏感，那么请继续使用该运算符。

1.  给定：z = x % y，然后 z = x - (x / y) * y

# java - 为什么即使在非阻塞套接字上，SocketChannel 的写入也总是全部完成？

> ID：158121
> 
> 赞同：4
> 
> 时间：2008-10-01T15:11:06.580
> 
> 标签：java, sockets, network-programming, nio

在 Windows 上使用 Sun Java VM 1.5 或 1.6，我连接了一个非阻塞套接字。然后我用一条消息填充一个`ByteBuffer`要输出的消息，并尝试到`write()`SocketChannel。

如果要写入的量大于套接字 TCP 输出缓冲区中的空间量，我希望写入仅部分完成（这是我直观地期望的，这也是我对[文档](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/SocketChannel.html#write(java.nio.ByteBuffer))的理解），但这不是发生。`write()` *似乎总是*返回报告写入的全部量，即使它是几兆字节（套接字的 SO_SNDBUF 是 8KB，比我的多兆字节输出消息少得多）。

这里的一个问题是我无法测试处理输出被部分写入的情况的代码（将兴趣集注册`WRITE`到选择器并执行 a`select()`等待直到可以写入剩余部分），因为这种情况似乎永远不会发生。我不明白什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T16:12:16.763

我设法重现了可能与您的情况相似的情况。我认为，具有讽刺意味的是，您的收件人使用数据的速度比您编写数据的速度要快。

```
import java.io.InputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class MyServer {
  public static void main(String[] args) throws Exception {
    final ServerSocket ss = new ServerSocket(12345);
    final Socket cs = ss.accept();
    System.out.println("Accepted connection");

    final InputStream in = cs.getInputStream();
    final byte[] tmp = new byte[64 * 1024];
    while (in.read(tmp) != -1);

    Thread.sleep(100000);
  }
}

import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.SocketChannel;

public class MyNioClient {
  public static void main(String[] args) throws Exception {
    final SocketChannel s = SocketChannel.open();
    s.configureBlocking(false);
    s.connect(new InetSocketAddress("localhost", 12345));
    s.finishConnect();

    final ByteBuffer buf = ByteBuffer.allocate(128 * 1024);
    for (int i = 0; i < 10; i++) {
      System.out.println("to write: " + buf.remaining() + ", written: " + s.write(buf));
      buf.position(0);
    }
    Thread.sleep(100000);
  }
} 
```

如果您运行上面的服务器，然后让上面的客户端尝试写入 10 个 128 kB 的数据块，您会看到每个写入操作都会写入整个缓冲区而不会阻塞。但是，如果您修改上面的服务器不从连接中读取任何内容，您会看到只有客户端上的第一个写入操作会写入 128 kB，而所有后续写入都将返回`0`.

服务器从连接中读取时的输出：

```
to write: 131072, written:  131072
to write: 131072, written:  131072
to write: 131072, written:  131072
... 
```

服务器未从连接中读取时的输出：

```
to write: 131072, written:  131072
to write: 131072, written:  0
to write: 131072, written:  0
... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:27:17.260

我一直在使用 Java 中的 UDP，并且在 Java NIO 中看到了一些非常“有趣”且完全未记录的行为。确定发生了什么的最好方法是查看 Java 附带的源代码。

我还敢打赌，您可能会在任何其他 JVM 实现（例如 IBM 的实现）中找到您正在寻找的更好的实现，但如果不亲自查看它们，我不能保证这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T15:16:08.957

我将做出一个巨大的信念飞跃，并假设 Java 的底层网络提供程序与 C 的相同……O/S 分配的不仅仅是`SO_SNDBUF`每个套接字。我敢打赌，如果你把你的发送代码放在一个 for(1,100000) 循环中，你最终会得到一个成功的写入，其值小于请求的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T02:36:16.060

你真的应该看看像[MINA](http://mina.apache.org)或[Grizzly](https://grizzly.dev.java.net/)这样的 NIO 框架。我在企业聊天服务器中使用 MINA 取得了巨大成功。它也用于[Openfire](http://www.igniterealtime.org/projects/openfire/index.jsp)聊天服务器。Grizzly 用于 Sun 的 JavaEE 实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T17:30:57.143

你将数据发送到哪里？请记住，网络充当缓冲区，其大小至少等于您的 SO_SNDBUF 加上接收器的 SO_RCVBUF。如亚历山大所说，将其添加到接收者的阅读活动中，您可以获得大量数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-02T08:56:10.830

我在任何地方都找不到它的文档，但是 IIRC[1], send() 保证 a) 完全发送提供的缓冲区，或者 b) 失败。它永远不会部分完成发送。

[1] 我已经编写了多个 Winsock 实现（用于 Win 3.0、Win 95、Win NT 等），因此这可能是 Winsock 特定的（而不是通用套接字）行为。

# .net - Windows 窗体：由应用程序而不是用户打开/关闭的模式窗体？

> ID：158122
> 
> 赞同：1
> 
> 时间：2008-10-01T15:11:35.583
> 
> 标签：.net, winforms, multithreading

我有一个我认为结构良好的 .NET 3.5 表单应用程序（单元测试、依赖注入、SoC，表单只是中继输入和显示输出，不做任何逻辑，yadda yadda）我只是想念winforms关于如何让这个位工作的知识。

当与数据库的连接丢失时 - 经常发生 - 我正在检测并处理它，并希望弹出一个模式表单，阻止应用程序的使用，直到重新建立连接。我不是 100% 确定如何做到这一点，因为我不是在等待用户输入，而是使用计时器轮询数据库。

我的尝试是设计一个带有标签的表单并这样做：

```
partial class MySustainedDialog : Form {
    public MySustainedDialog(string msg) {
        InitializeComponent();
        lbMessage.Text = msg;
    }
    public new void Show() {
        base.ShowDialog();
    }

    public new void Hide() {
        this.Close();
    }

}

public class MyNoConnectionDialog : INoConnectionDialog {
            private FakeSustainedDialog _dialog;
    public void Show() {
        var w = new BackgroundWorker();
        w.DoWork += delegate {
            _dialog = new MySustainedDialog("Connection Lost");
            _dialog.Show();
        };
        w.RunWorkerAsync();
    }

    public void Hide() {
        _dialog.Close();
    }
} 
```

这不起作用，因为 _dialog.Close() 是一个跨线程调用。我已经能够找到有关如何在 Windows 窗体中解决此问题的信息，但在这种需要创建窗体本身的情况下却找不到。

有人可以给我一些建议如何实现我想要做的事情吗？

**编辑：**请注意，我只是因为缺乏其他想法而尝试了后台工作人员，因为我不太熟悉 UI 线程的工作原理，所以我完全愿意接受建议。我还应该注意，我不想关闭他们目前正在处理的表单，我只是希望它出现在它上面。就像一个确定/取消对话框，但我可以通过编程方式打开和关闭（我需要控制它的外观）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T15:43:09.157

我不确定您的整体方法的正确性，但要具体回答您的问题，请尝试将 MySustainedDialog Hide() 函数更改为如下：

```
 public new void Hide()
    {
        if (this.InvokeRequired)
        {
            this.BeginInvoke((MethodInvoker)delegate { this.Hide(); });
            return;
        }

        this.Close();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:29:51.900

There are two approaches I've taken in similar situations.

One is to operate in the main UI thread completely. You can do this by using a **Windows.Forms.Timer** instance, which will fire in the main UI thread.

Upside is the simplicity and complete access to all UI components. Downside is that any blocking calls will have a huge impact on user experience, preventing any user interaction whatsoever. So if you need long-running commands that eventually result in a UI action (for example if checking for the database took, say, several seconds), then you need to go cross-thread.

The simplest cross-thread solution from a code perspective is to call the **Control.Invoke** method from your BackgroundWorker.

Invoke lets you "post" work to a control, essentially saying "plz go use your owning thread to run this."

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T15:22:40.657

没有理由使用后台工作程序来实际启动表单的新实例，您可以简单地从 UI 线程中完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T15:22:35.290

将所有 UI 工作保持在主 UI 线程上而不是使用 BackgroundWorker 会更简单吗？在没有看到更多代码的情况下说起来很棘手，但我认为您不需要它。

创建计时器时，您可以为其分配 Timer.SynchronizingObject 以使其使用主 UI 线程。并坚持下去？

抱歉，如果不了解您的程序结构，无法给出更好的答案。

# counter - 计算网站上文件下载的最佳方法

> ID：158124
> 
> 赞同：9
> 
> 时间：2008-10-01T15:12:13.693
> 
> 标签：counter

令人惊讶的是，要找到一个简单、简洁的答案来回答这个问题是多么困难：

1.  我的网站上有一个文件 foo.zip
2.  我可以做些什么来找出有多少人访问了这个文件？
3.  如有必要，我可以使用 Tomcat 调用

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-01T15:15:47.757

或者，如果您不需要实时数据，您可以解析日志文件。

```
grep foo.zip /path/to/access.log | grep 200 | wc -l 
```

回复评论：

日志文件还包含下载的字节数，但正如其他人指出的那样，如果用户在客户端取消下载，这可能无法反映正确的计数。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-01T15:13:15.327

最简单的方法可能不是直接链接到文件，而是链接到增加计数器然后转发到相关文件的脚本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-09-13T11:44:53.547

答案是“最简单的方法可能不是直接链接到文件，而是链接到增加计数器然后转发到相关文件的脚本。”

这是额外的：

```
$hit_count = @file_get_contents('count.txt');
$hit_count++;
@file_put_contents('count.txt', $hit_count);

header('Location: http://www.example.com/download/pics.zip'); // redirect to the real    file to be downloaded 
```

这`count.txt`是一个简单的纯文本文件，用于存储计数器信息。您也可以将其保存在数据库表中`downloadable_filename.ext`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T15:13:49.930

使用日志——文件的每个 GET 请求都是另一个下载（除非访问者由于某种原因在中途停止了下载）。

# open-source - Visual Basic 的最佳开源、跨平台、编译、GUI 替代品？

> ID：158129
> 
> 赞同：6
> 
> 时间：2008-10-01T15:13:24.923
> 
> 标签：open-source

我即将编写一个小 GUI 应用程序，它将位于系统托盘中，执行一些 FTP 和 ODBC。

如果可能的话，我想在 Linux 中开发。

你会推荐什么？

非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T15:40:03.687

我可能会失望，但我认为[FreePascal](http://www.freepascal.org)是你最好的选择。

大多数（如果不是全部）功能都是跨平台的，并且可以很好地解决。我不确定，但我可以调查，但 TTrayIcon 是跨平台的，这就是将应用程序放入托盘所需的内容。它还与数据库上的主要参与者有很好的核心连接。它在 Windows、Linux、MAC OS 甚至 ARM 和其他嵌入环境中都是跨平台的。

唯一的问题是它是 Object Pascal 而不是 VB'ish。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T15:26:55.497

鉴于您提出问题的方式，[Gambas是显而易见的选择。](http://gambas.sourceforge.net/)但我不认为这可能是你真正想要的。不过，它是最接近 VB6 for Linux 的东西。

如果你真的需要编译，Perl 是一个选项 (JIT)，它在 Linux 上无处不在。在这种情况下，大多数 Linux 应用程序（如果需要编译）将使用带有 QT 或 GTK 工具包的 C/C++。但更多时候在 Linux 上，您会看到使用 Python 或 Perl。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T15:28:49.177

我相信 jdesktop 为您提供了 Java 的跨平台“系统托盘”功能。（编辑：实际上功能在[核心 Java](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/systemtray/)中，截至 6）

NetBeans 非常适合开发 GUI，可能不如 VB，但也不错。但是对于您的情况，Java 可能有点矫枉过正。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T16:59:25.993

对于“小 GUI 应用程序”，我会推荐 Tk，无论是使用 Tcl 还是作为 Tkinter 使用 Python。Tk 是一个非常易于使用的高级跨平台（和跨语言）GUI 工具包。哎呀，我也推荐将 Tk 用于大型 GUI 应用程序，但这不是重点。

如果您使用 Tcl，您还将获得一个非常棒的分发机制（tclkit/starkit/starpack），这使得创建单文件可执行文件或双文件平台特定运行时 + 平台不可知的虚拟文件系统变得微不足道。

Python 可能会为您提供更好的 ODBC 功能，尽管这只是一种预感。我没有将 ODBC 与 Tcl 或 Python 一起使用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-03T12:59:04.980

我使用了几个 GUI 工具包进行跨平台开发，以下是我的前 4 条建议，按我的首选顺序：

**Eclipse RCP** - 它可能是重量级的，但它是跨平台的，为每个操作系统生成原生 GUI 组件，并具有许多部署特性。

**wxWidgets** - 开源 GUI 库，可以使用 C++ 或 python (wxpython)。

**Tkinter** - 真正快速、简单、轻量级的 Python 图形用户界面工具包，跨平台，可能与上述选项一样具有完整的功能。

**Java Swing** - 很好的库，但可以“看起来像 java”（它不使用本机 GUI 组件）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T15:25:23.817

“坐在系统托盘中”位有多重要？我不知道有什么可以让您以跨平台的方式做到这一点。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T16:04:38.373

我仍然认为[wxWidgets](http://www.wxwidgets.org/)是一个很好的跨平台 UI 开发工具包，它正在积极开发中，并且有很大的社区支持。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T16:13:21.457

有几种 VB 替代方案：

[http://www.realsoftware.com/products/realbasic/](http://www.realsoftware.com/products/realbasic/)

[http://www.libertybasic.com/visual-basic.html](http://www.libertybasic.com/visual-basic.html)

那么德尔福呢？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-03T12:42:09.817

由于我的罪过，我是一名 VB 开发人员，我转向 C#，然后使用 Qt 转向 C++。

我认为这将取决于你作为程序员的技能，如果你高度依赖 VB 的程序性质，那么坚持使用 BASIC 作为一种语言。

如果您倾向于使用 VB 在类和对象中进行开发，您可能会发现 Python、C# 或 Java 是不错的选择。

此外，在查看跨平台时，它不仅仅是语言，还有您将使用的工具包。Qt 对我来说很棒，但也有 wxWidgets 和 GTK 之类的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T15:15:59.660

Miguel de Izaca 的 Mono - 现在由 Novell 拥有/赞助。它为您提供了 Linux 中 90% 的 .NET 框架。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T15:19:39.477

由于您特别提到了 Visual Basic，因此您应该查看[Gambas](http://gambas.sourceforge.net/)。它不是 VB 的克隆，而是类似于 VB。

# .net - 我什么时候会使用 AutoResetEvent 和 ManualResetEvent 而不是 Monitor.Wait()/Monitor.Pulse()？

> ID：158133
> 
> 赞同：20
> 
> 时间：2008-10-01T15:13:58.447
> 
> 标签：.net, multithreading, synchronization, locking

他们似乎都实现了相同的目的。我什么时候会选择其中之一？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T15:29:00.003

当您有一个线程正在等待多个事件中的一个或所有事件来做某事时，请使用这些事件。

如果您想通过限制可以访问的线程数来限制对数据结构的访问，请使用监视器。

监视器通常保护资源，而事件会告诉您正在发生的事情，例如应用程序关闭。

此外，可以命名事件（参见 OpenExisting 方法），这允许它们用于跨不同进程的同步。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-07-07T23:28:11.550

在我看来，如果可以的话，最好使用 Monitor，Monitor.Wait 和 Monitor.Pulse/PulseAll 用于线程之间的信号发送（如 Manual/AutoResetEvent），但是 Monitor 更快，并且不使用本机系统资源。同样显然 Monitor 是在用户模式下实现并受到管理的，而 Manual/AutoResetEvents 需要切换到内核模式并 p/invoke 到使用等待句柄的本机 win32 调用。

在某些情况下，您需要使用 Manual/AutoResetEvent，例如，在可以使用命名事件的进程之间发出信号，我猜想在您的应用程序中发出本机线程信号。

我只是在重复我在这篇关于线程的[优秀文章中读到的内容。](http://www.yoda.arachsys.com/csharp/threads/waithandles.shtml)

整篇文章都值得一读，但是链接会将您带到详细说明事件和监控等待/脉冲的等待句柄部分。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-03-12T17:56:15.773

`WaitHandle`当您希望线程发送或接收二进制信号*而不*需要临界区时，您会使用。另一方面，`Monitor.Wait`需要*一个*关键部分。与 BCL 中的大多数同步机制一样，您提到的两者的使用方式存在一些重叠。但是，不要以为它们实现了相同的目的。`Monitor.Pulse`

 *`Monitor.Wait`并且`Monitor.Pulse`是比 MRE 或 ARE 更原始的同步机制。事实上，您实际上可以只使用`Monitor`类来构建 MRE 或 ARE。要理解的最重要的概念是`Monitor.Wait`和`WaitHandle.WaitOne`方法的不同之处。`Wait`并且`WaitOne`都将线程置于`WaitSleepJoin`状态，这意味着线程变得空闲并且只响应 a`Thread.Interrupt`或相应的`Pulse`or`Set`调用。但是，这是一个主要区别，`Wait`它将留下一个关键部分并**以原子方式**重新获取它。`WaitOne`根本无法做到这一点。正是这些同步机制的行为方式的根本差异定义了它们可以使用的场景。

在大多数情况下，您会选择 MRE 或 ARE。这些满足了一个线程需要从另一个线程接收信号的大多数情况。但是，如果您想创建自己的信号机制，则需要使用`Wait`and `Pulse`。但是，同样，.NET BCL 已经涵盖了大多数流行的信号机制。以下信令机制已经存在¹．

*   ManualResetEvent（或 ManualResetEventSlim）
*   自动复位事件
*   信号量（或 SemaphoreSlim）
*   事件等待句柄
*   倒计时事件
*   屏障

* * *

¹荣誉奖进入`BlockingCollection`班级。它本身不是一种信号机制，但它确实具有信号机制的品质，并具有额外的好处，即您可以将数据附加到信号上。在这种情况下，信号意味着集合中的项目可用，并且与该信号关联的数据是项目本身。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T16:14:13.810

本教程详细描述了您需要了解的内容： [http ://www.albahari.com/threading/](http://www.albahari.com/threading/)

特别是，这将涵盖 XXXResetEvent 类，
[http://www.albahari.com/threading/part2.aspx](http://www.albahari.com/threading/part2.aspx)

这将涵盖等待/脉冲： [http ://www.albahari.com/threading/part4.aspx#_Wait_and_Pulse](http://www.albahari.com/threading/part4.aspx#_Wait_and_Pulse)

# web-services - .NET 客户端调用 java web 服务——（如何更改根命名空间）

> ID：158139
> 
> 赞同：1
> 
> 时间：2008-10-01T15:15:17.977
> 
> 标签：web-services, ssl

目前我们有一个 java web 服务，我们正在尝试通过 .NET 客户端连接。这一切都是通过 SSL 完成的。是否有任何众所周知的问题，因为这似乎是一个反复出现的问题。我应该寻找的最知名的陷阱是什么？

Java Web 服务是一个 SOAP/WSDL。没有像 WS-Security 这样的 WS-* 扩展。

好的，这就是我要解决的确切问题：我们得到了一个 java webservice，可以从 C# 客户端调用。我已将问题归结为 java web 服务期望 C# 客户端未生成的一些修改过的 xml 的事实。java webservice 期待以下内容：

`<?xml version="1.0" encoding="UTF-8" ?`> `<iAttr:MyObject1 xmlns="iAttr" xmlns:iAttr="http://www.foo.com/WS"`> `<iAttr:MyObject2 xmlns="isum" xmlns:isum="http://www.foo.com/WS"`> `<iAttr:OrderId`>1001027892 < `/isum:OrderId`>

问题是，我的客户端生成的 xml/SOAP 内容是这样的：

`<?xml version="1.0" encoding="UTF-8" ?`> `<iAttr:MyObject1 xmlns="iAttr" xmlns:iAttr="http://www.foo.com/WS"`> `<MyObject2`> `<OrderId`>1001027892< `/OrderId`>

注意：C# 版本中缺少“iAttr”。

问题：如何在 C# 中添加有问题的属性以匹配 java WS 的期望？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T15:24:19.390

我没有写服务。这是奇怪的事情：一个 java 客户端进行相同的 web 服务调用工作完美。但是，进行完全相同的 Web 服务调用的 .NET 客户端会中断。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-01T15:17:49.717

好吧，如果您以“正确”的方式编写服务，那么应该不会有任何问题，至少不会出现语言互操作的问题。

# java - 如何在不传输整个文件的情况下限制使用 JavaScript（或 Java）上传的文件的大小？

> ID：158149
> 
> 赞同：11
> 
> 时间：2008-10-01T15:16:40.313
> 
> 标签：java, javascript, jsp, file-upload

有没有办法在客户端浏览器上验证从 JSP 页面上传的文件的大小是否超过设定的大小限制，而不强制用户上传整个文件才发现它太大了？

如果可能，我想远离任何专有控件或技术，如 Flash 或 ActiveX。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T15:22:23.420

这不是一个完美的解决方案，但是如果您检查 Content-Length HTTP 标头，`request.getHeader("Content-Length")`那么您可以选择不传输整个文件。

作为解释，一个非常大的文件不会一次全部传输。您实际上必须打开一个表示该 POST 数据块的流并从中读取整个要传输的数据。

另一方面，如果您担心拒绝服务攻击，那么您就不能真正信任 Content-Length 标头，因为它很容易被伪造。在这种情况下，您应该设置一个限制并流式传输此文件，一旦超过该限制就停止。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:45:30.353

建议您重新考虑 Flash 决定并查看 YUI Uploader，此处：

[http://developer.yahoo.com/yui/uploader/](http://developer.yahoo.com/yui/uploader/)

除其他事项外，fileSelect 事件将在选择文件之后但在上传之前立即告诉您所选文件的大小（以字节为单位），因此您可以进行相应的限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T15:51:32.880

使用 JSP 或 PHP，您将无法限制文件大小，因为您的页面在上传完成之前不会收到请求。此时您可以决定不保存文件，但这可能为时已晚。

有一些 Java 解决方案，例如[MyUploader](http://www.javaatwork.com/java-upload-applet/demo.html)或[Hermes](http://javauploader.com/)。有些甚至支持多文件上传和恢复部分上传，有些还给你源代码。您也可以自己编写，但它需要是一个签名的小程序才能运行，因为它需要访问本地文件系统。如果您使用 Apache 作为您的网络服务器，则您的机器中需要足够的 RAM 以适应在给定时间上传的所有文件的内存中的整个文件大小。

# svn - 将 SVN 1.4 升级到 1.5.3 和 CC.Net 从 1.3 升级到 1.4

> ID：158150
> 
> 赞同：0
> 
> 时间：2008-10-01T15:16:41.763
> 
> 标签：svn, tortoisesvn, continuous-integration, cruisecontrol.net

我认为这是一个多部分的问题，所以请耐心等待。

目前我们所有的开发人员都使用为 SVN 1.4 构建的 Tortise 版本，我们的 SVN 服务器运行的是 1.4。我们的构建服务器正在运行 CC.Net 并使用 SVN 1.4。

我们想升级。

我已经确定将我们的客户端升级到 1.5，然后我们的服务器升级到 1.5 将为我们工作。但是，问题来自 CC.Net。我们可以将构建服务器上的 SVN 安装升级到 SVN 1.5 吗？还是我们也必须升级 CC.Net 的安装？我们也想利用这段时间升级 CC.Net，但是，我们想确保先完成 SVN 升级，然后再回来做 CC.Net。

此外，由于我们在这些项目中使用的 nAnt 脚本，在我们的一些项目中，我们维护了一个“工具”文件夹，该文件夹可能包含也可能不包含 SVN 的二进制文件。我假设如果我们将 SVN 的 CC.Net 服务器安装升级到 1.5，我们还需要更新所有这些项目，因为 CI 服务器使用与执行的 nAnt 脚本相同的工作目录。

清如泥？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T15:23:08.270

很难回答，因为您似乎在要求为您的环境制定计划，而我不在其中。

但是，这就是我要做的：

*   升级 cc.net（您有一个已知的良好起点，这是最有可能中断的步骤。不要使用任何其他变量，这样更容易回滚）
*   测试与验证
*   升级所有 svn 客户端，包括“工具”文件夹中的二进制文件
*   测试与验证
*   升级svn服务器
*   测试与验证
*   测试与验证

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T15:26:05.813

一个小技巧，可能对你有所帮助：SVN 1.4 客户端可以连接到 SVN 1.5 服务器，SVN 1.5 客户端可以连接到 SVN 1.4 服务器，没问题——只是当你有版本不匹配时，一些新添加的 SVN 功能将不可用（但所有正常的东西仍然可以正常工作）。

# windows - 如何将屏幕截图直接保存到 Windows 中的文件？

> ID：158151
> 
> 赞同：117
> 
> 时间：2008-10-01T15:16:53.743
> 
> 标签：windows, screenshot

是否有一种一键式方法可以将屏幕截图直接保存到 Windows 中的文件中？

TheSoftwareJedi 为 Windows 8 和 10 准确回答了上述问题。以下原始额外材料留给后代。

> 这是一个非常重要的问题，因为截至 2021 年的 316K 视图显示。在 2008 年被问到，SO 在 2015 年左右关闭了这个问题，因为它离题了，可能是因为下面的最后一个问题。

> 在 Windows XP 中，可以按 Alt-PrintScreen 复制活动窗口的图像，或按 Ctrl-PrintScreen 复制整个桌面的图像。
> 
> 然后可以将其粘贴到接受图像的应用程序中：Photoshop、Microsoft Word 等。
> 
> 我想知道：**有没有办法将屏幕截图直接保存到文件中？** 我*真的*必须打开一个图像程序，比如 Paint.net 或 Photoshop，来粘贴图像，然后保存吗？

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2008-10-01T15:41:52.357

在 Windows 8 之前，没有第三方工具无法直接保存到文件。这是我个人最喜欢的非第三方工具解决方案。

## 适用于 Windows 8 及更高版本

`![Windows Key](https://i.stack.imgur.com/B8Zit.png)`+`PrintScreen` 将屏幕截图保存到文件夹中`<user>/Pictures/Screenshots`

## 对于 Windows 7

在 win 7 中只需使用截图工具：最容易通过按开始访问，然后键入“sni”（回车）。或者 `![Windows Key](https://i.stack.imgur.com/B8Zit.png)`然后`s``n``i` `enter`

## 以前版本的 Windows

我使用以下键盘组合进行捕获，然后使用 mspaint 保存。执行几次后，只需 2-3 秒：

1.  `Alt`+`PrintScreen`
2.  `Win`+ `R`（“运行”）
3.  输入“mspaint”`enter`
4.  `Ctrl`- `V`（粘贴）
5.  `Ctrl`- `S`（保存）
6.  使用文件对话框
7.  `Alt`- `F4`（关闭 mspaint）

此外，[Cropper](http://www.codeplex.com/cropper)很棒（而且是开源的）。它可以将矩形捕获到文件或剪贴板，当然是免费的。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-01T15:21:28.973

您可以编写一些非常简单的代码来挂钩 PrintScreen 并将捕获保存在文件中。

这是开始捕获并保存到文件的内容。您只需要挂上“打印屏幕”键。

```
using System;
using System.Drawing;
using System.IO;
using System.Drawing.Imaging;
using System.Runtime.InteropServices;
public class CaptureScreen
{

    static public void Main(string[] args)
    {

        try
        {
            Bitmap capture = CaptureScreen.GetDesktopImage();
            string file = Path.Combine(Environment.CurrentDirectory, "screen.gif");
            ImageFormat format = ImageFormat.Gif;
            capture.Save(file, format);
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
        }

    }

    public static Bitmap GetDesktopImage()
    {
        WIN32_API.SIZE size;

        IntPtr  hDC = WIN32_API.GetDC(WIN32_API.GetDesktopWindow()); 
        IntPtr hMemDC = WIN32_API.CreateCompatibleDC(hDC);

        size.cx = WIN32_API.GetSystemMetrics(WIN32_API.SM_CXSCREEN);
        size.cy = WIN32_API.GetSystemMetrics(WIN32_API.SM_CYSCREEN);

        m_HBitmap = WIN32_API.CreateCompatibleBitmap(hDC, size.cx, size.cy);

        if (m_HBitmap!=IntPtr.Zero)
        {
            IntPtr hOld = (IntPtr) WIN32_API.SelectObject(hMemDC, m_HBitmap);
            WIN32_API.BitBlt(hMemDC, 0, 0,size.cx,size.cy, hDC, 0, 0, WIN32_API.SRCCOPY);
            WIN32_API.SelectObject(hMemDC, hOld);
            WIN32_API.DeleteDC(hMemDC);
            WIN32_API.ReleaseDC(WIN32_API.GetDesktopWindow(), hDC);
            return System.Drawing.Image.FromHbitmap(m_HBitmap); 
        }
        return null;
    }

    protected static IntPtr m_HBitmap;
}

public class WIN32_API
{
    public struct SIZE
    {
        public int cx;
        public int cy;
    }
    public  const int SRCCOPY = 13369376;
    public  const int SM_CXSCREEN=0;
    public  const int SM_CYSCREEN=1;

    [DllImport("gdi32.dll",EntryPoint="DeleteDC")]
    public static extern IntPtr DeleteDC(IntPtr hDc);

    [DllImport("gdi32.dll",EntryPoint="DeleteObject")]
    public static extern IntPtr DeleteObject(IntPtr hDc);

    [DllImport("gdi32.dll",EntryPoint="BitBlt")]
    public static extern bool BitBlt(IntPtr hdcDest,int xDest,int yDest,int wDest,int hDest,IntPtr hdcSource,int xSrc,int ySrc,int RasterOp);

    [DllImport ("gdi32.dll",EntryPoint="CreateCompatibleBitmap")]
    public static extern IntPtr CreateCompatibleBitmap(IntPtr hdc,  int nWidth, int nHeight);

    [DllImport ("gdi32.dll",EntryPoint="CreateCompatibleDC")]
    public static extern IntPtr CreateCompatibleDC(IntPtr hdc);

    [DllImport ("gdi32.dll",EntryPoint="SelectObject")]
    public static extern IntPtr SelectObject(IntPtr hdc,IntPtr bmp);

    [DllImport("user32.dll", EntryPoint="GetDesktopWindow")]
    public static extern IntPtr GetDesktopWindow();

    [DllImport("user32.dll",EntryPoint="GetDC")]
    public static extern IntPtr GetDC(IntPtr ptr);

    [DllImport("user32.dll",EntryPoint="GetSystemMetrics")]
    public static extern int GetSystemMetrics(int abc);

    [DllImport("user32.dll",EntryPoint="GetWindowDC")]
    public static extern IntPtr GetWindowDC(Int32 ptr);

    [DllImport("user32.dll",EntryPoint="ReleaseDC")]
    public static extern IntPtr ReleaseDC(IntPtr hWnd,IntPtr hDc);
} 
```

**更新** 这是从 C# 挂钩 PrintScreen （和其他键）的代码：

[挂钩代码](http://forum.cheatengine.org/viewtopic.php?t=192699&sid=d25bb4a9d48a3518bba28ec63d6510a2)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-01T15:59:26.917

鲜为人知的事实：在大多数标准 Windows (XP) 对话框中，您可以按 Ctrl+C 来获得对话框内容的文本副本。
示例：在记事本中打开一个文件，点击空格，关闭窗口，在“确认退出”对话框中按 Ctrl+C，取消，将对话框的文本粘贴到记事本中。
与您的直接问题无关，但我认为在此线程中提及会很好。

此外，确实，您需要第三方软件来制作屏幕截图，但您不需要为此启动大型 Photoshop。像 IrfanWiew 或 XnView 这样免费且轻量级的东西可以完成这项工作。我使用 MWSnap 复制屏幕的任意部分。我写了一个小 AutoHotkey 脚本调用 GDI+ 函数来做截图。等等。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-04-29T08:02:16.930

感谢所有源代码和评论 - 多亏了这一点，我终于有了一个我想要的应用程序 :)

我已经编译了一些示例，源代码和可执行文件都可以在这里找到：

[http://sdaaubckp.svn.sourceforge.net/viewvc/sdaaubckp/xp-take-screenshot/](http://sdaaubckp.svn.sourceforge.net/viewvc/sdaaubckp/xp-take-screenshot/)

我使用 InterceptCaptureScreen.exe - 只需在命令提示符终端中运行它，然后在要捕获屏幕截图时按 Insert（时间戳文件名，png，在可执行文件所在的同一目录中）；即使终端不在焦点上，也会捕获键。

（我使用 Insert 键，因为它应该更容易通过 VNC 传播而不是 PrintScreen - 在我的笔记本电脑上，它还要求按下 Fn 键，并且不会通过 VNC 传播。当然，它很容易改变什么是源代码中使用的实际密钥）。

希望这会有所帮助，干杯！

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-12-30T13:28:02.850

我意识到非常旧的帖子，但 Windows 终于意识到这个过程是多么愚蠢。

在 Windows 8.1 中（已验证，在 Windows 7 中不起作用（tnx @bobobobo））

`windows key`+`prnt screen`将屏幕截图保存到文件夹中`<user>/Pictures/Screenshots`

来源 - [http://windows.microsoft.com/en-in/windows/take-screen-capture-print-screen#take-screen-capture-print-screen=windows-8](http://windows.microsoft.com/en-in/windows/take-screen-capture-print-screen#take-screen-capture-print-screen=windows-8)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-10T04:46:26.950

我可以建议 WinSnap [http://www.ntwind.com/software/winsnap/download-free-version.html](http://www.ntwind.com/software/winsnap/download-free-version.html)。它提供自动保存选项并捕获 alt+printscreen 和其他组合键以捕获屏幕、窗口、对话框等。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-02-17T15:58:19.140

Dropbox 现在提供了自动执行此操作的挂钩。如果您获得了免费的 Dropbox 帐户并安装了笔记本电脑应用程序，当您按下 PrtScr 时，Dropbox 将为您提供自动将所有屏幕截图存储到您的 Dropbox 文件夹的选项。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T15:24:08.873

您需要一个第三方屏幕抓取实用程序才能在 XP 中实现该功能。我挖掘了 Scott Hanselman[关于酷工具的大量博客，](http://www.hanselman.com/tools)并且通常会在那里寻找这样的实用程序——果然，他在博客上写了一些关于很酷[的](http://www.hanselman.com/blog/WindowsClippingsACropperContender.aspx)工具。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-01T16:12:25.203

这将在 Delphi 中完成。注意 BitBlt 函数的使用，它是一个 Windows API 调用，不是 Delphi 特有的。

***编辑：添加示例用法***

```
function TForm1.GetScreenShot(OnlyActiveWindow: boolean) : TBitmap;
var
  w,h : integer;
  DC : HDC;
  hWin : Cardinal;
  r : TRect;
begin
  //take a screenshot and return it as a TBitmap.
  //if they specify "OnlyActiveWindow", then restrict the screenshot to the
  //currently focused window (same as alt-prtscrn)
  //Otherwise, get a normal screenshot (same as prtscrn)
  Result := TBitmap.Create;
  if OnlyActiveWindow then begin
    hWin := GetForegroundWindow;
    dc := GetWindowDC(hWin);
    GetWindowRect(hWin,r);
    w := r.Right - r.Left;
    h := r.Bottom - r.Top;
  end  //if active window only
  else begin
    hWin := GetDesktopWindow;
    dc := GetDC(hWin);
    w := GetDeviceCaps(DC,HORZRES);
    h := GetDeviceCaps(DC,VERTRES);
  end;  //else entire desktop

  try
    Result.Width := w;
    Result.Height := h;
    BitBlt(Result.Canvas.Handle,0,0,Result.Width,Result.Height,DC,0,0,SRCCOPY);
  finally
    ReleaseDC(hWin, DC) ;
  end;  //try-finally
end;

procedure TForm1.btnSaveScreenshotClick(Sender: TObject);
var
  bmp : TBitmap;
  savdlg : TSaveDialog;
begin
  //take a screenshot, prompt for where to save it
  savdlg := TSaveDialog.Create(Self);
  bmp := GetScreenshot(False);
  try
    if savdlg.Execute then begin
      bmp.SaveToFile(savdlg.FileName);
    end;
  finally
    FreeAndNil(bmp);
    FreeAndNil(savdlg);
  end;  //try-finally
end; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-01T17:27:41.463

试试这个：[http ://www.screenshot-utility.com/](http://www.screenshot-utility.com/)

从他们的主页：

*当您按下热键时，它会捕获屏幕快照并将其保存为 JPG、GIF 或 BMP 文件。*

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T15:20:16.153

如果不安装屏幕截图自动保存实用程序，是的。但是，您可以找到几个实用程序来执行此操作。

例如：[http ://www.screenshot-utility.com/](http://www.screenshot-utility.com/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T15:22:15.417

当然，您可以编写一个程序来监视剪贴板并为剪贴板中的每个图像显示一个烦人的另存为对话框；-)。我想您甚至可以找出按下的最后一个键是否是 PrintScreen 以限制误报的数量。

虽然我正在考虑它..你也可以谷歌搜索已经这样做的人。

* * *

**编辑**：..或者只是等待有人在这里发布源 - 就像刚刚发生的那样:-)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-01T15:37:06.923

Snagit...很多技术人员都在使用它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-06-03T13:48:57.177

除了我推荐的安装屏幕捕获程序之外，最好的方法是使用标准的 Print Screen 方法，然后打开 Microsoft Office 图片管理器并将屏幕截图粘贴到您想要的目录的白色区域中。它将创建一个位图，您可以对其进行编辑或另存为另一种格式。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-04-22T03:40:57.947

感谢 TheSoftwareJedi 提供有关 Windows 7 中的捕捉工具的有用信息。打开捕捉工具的快捷方式：转到开始，键入 sni 您将在“捕捉工具”列表中找到名称

![在此处输入图像描述](https://i.stack.imgur.com/s7r7o.png)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-05-30T06:25:43.403

让 Picasa 在后台运行，只需单击“打印屏幕”键

[来源](http://thetechgears.com/auto-save-screenshots-to-folder-in-windows-7-using-picasa/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-01T15:17:49.640

据我所知，在 XP 中，是的，您必须使用其他应用程序才能实际保存它。

Vista 带有截图工具，可以稍微简化一下流程！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-01T15:40:05.810

你可能想要这样的东西：http: [//addons.mozilla.org/en-US/firefox/addon/5648](http://addons.mozilla.org/en-US/firefox/addon/5648)

我认为有一个 IE 版本，也有 Explorer 集成。很不错的软件。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-12-05T22:17:16.640

事实证明，Google Picasa（免费）现在可以为您执行此操作。如果您打开它，当您点击它时，会将屏幕截图保存到文件中并将其加载到 Picasa 中。以我的经验，效果很好！

* * *

## 回答 #20

> 赞同：-6
> 
> 时间：2011-10-09T18:29:06.917

这可能吗：

1.  按 Alt 打印屏幕
2.  打开一个文件夹
3.  右键->粘贴截图

例子：

基准测试结果窗口打开，截图。打开 C:\Benchmarks 右键单击​​ -> 粘贴屏幕截图 出现一个名为 screenshot00x.jpg 的文件，其中选择了文本 screenshot00x。类型超频5

就是这样。无需打开任何东西。如果您不写任何内容，则保留默认名称。

# tcp - 大容量TCP Client的设计

> ID：158152
> 
> 赞同：3
> 
> 时间：2008-10-01T15:17:10.420
> 
> 标签：tcp, timeout, client, volume

我有一个 .NET TCP 客户端，它向（.NET 异步）TCP 服务器发送大量消息。

我需要继续向服务器发送消息，但由于 TIME_WAIT，我用完了客户端上的端口。

程序如何在不使用所有可用端口的情况下持续可靠地发送消息？

有没有办法继续重用同一个套接字。我查看了 Disconnect() 和 REUSEADDRESS 套接字标志，但找不到任何使用它们的好例子。事实上，大多数消息来源都说不要使用 Disconnect，因为它是用于较低级别的使用（即它只回收套接字句柄）。

我在想我需要切换到 UDP 还是有使用 C++ 和 IOCP 的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T18:18:40.030

如果您的服务器和客户端知道数据的格式，您可以保持套接字打开。您正在关闭套接字，以便服务器可以“看到”客户端“完成”。

如果您有一些协议，那么服务器可以“知道”它何时完成接收数据块。

您可以查找某种消息结束标记，您可以传入消息的长度，并根据大小等读取其余部分。不同的方法。

但是没有理由不断地打开和关闭与服务器的连接——这就是你要死的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T15:24:34.397

您的客户端可以保持相同的套接字打开并循环发送消息吗？

```
open socket connection

while(running)
    send messages over socket

close socket connection 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T18:51:01.280

TCP 非常努力地防止网络拥塞。所有新的 TCP 连接都以“慢启动”状态开始，它们只发送一个数据包并等待来自另一端的确认。如果收到 ACK，TCP 将发送两个数据包，然后是四个，以此类推，直到达到其最大窗口大小。

如果您正在以高数据速率生成消息，您确实希望避免打开和关闭 TCP 连接。每次打开新连接时，您都会回到慢启动状态。如果您可以保持套接字打开，则 TCP 连接将通过慢启动状态并能够以更高的速率发送数据。

为此，您需要让服务器在一个连接上处理多个消息（这意味着要找到一种方法来描述每条消息）。如果您的服务器支持任何类型的 HTTP 编码，这将起作用；确保检查与“持久”连接或 HTTP 1.1 相关的任何参数或配置，因为这是 HTTP 通过单个 TCP 连接发送多个请求的方式。

您提到的一种选择是UDP。如果您以相当高的速率生成消息，您可能会丢失其中的一些消息，因为沿途某处队列已满。如果您发送的消息需要可靠，UDP 可能不是一个好的基础。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:13:44.833

编写 TCP 服务器（用任何语言）背后的基本思想是打开一个端口来监听连接，然后创建新线程或进程来处理新的连接请求。

```
open a server socket // this uses the port the clients know about

while(running)
    client_socket = server_socket.listen
    fork(new handler_object(client_socket)) 
```

这是[C# 中的一个很好的例子](http://blog.paranoidferret.com/index.php/2007/10/30/csharp-tutorial-simple-threaded-tcp-server/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T15:49:30.623

当这样编码时，它不起作用。

服务器只接收第一条消息。

当我打开和关闭套接字时，服务器可以工作，但我的客户端端口用完了。

我猜这是我的服务器的设计导致我不得不像这样编写客户端。

那么如何使用 .NET 编写异步服务器。我已经关注了 MSDN 示例和许多在线示例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T17:14:13.260

类似于消息队列服务的东西会对您的项目有益吗？这样，您的客户端可以将尽可能多的消息传递给您的服务器，并且您的服务器可以简单地从队列中拉出这些消息，尽可能快地尽可能快，如果您的客户端发送的消息超出了它的处理能力，它们会很简单进入队列等待处理。

一些快速的谷歌搜索发现了这个[MSDN 文档，关于使用 C# 构建消息队列服务](http://msdn.microsoft.com/en-us/library/ms973816.aspx)。

# html - 使用 HTML 框架进行模板有哪些潜在的陷阱？

> ID：158155
> 
> 赞同：0
> 
> 时间：2008-10-01T15:18:10.573
> 
> 标签：html, iframe

我们也可以包含 IFrame。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T15:21:56.290

使用标准框架/框架组：

1.  书签可能很难完成。
2.  后退按钮可能会损坏。
3.  来自搜索引擎的到达可能会进入内部框架。
4.  跨浏览器的打印效果不同。
5.  滚动条可能位于非标准/意外的位置。

[更多在这里。](http://en.wikipedia.org/wiki/Framing_(World_Wide_Web)#Criticism)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T15:24:26.410

我想重新表述你的问题：使用 Html 框架进行模板有什么好处？有关该主题的详细阅读：

[http://www.yourhtmlsource.com/frames/goodorbad.html](http://www.yourhtmlsource.com/frames/goodorbad.html)

> **引用那篇文章：**
> 
> 因此，总而言之，框架违反了太多公认的网络标准，无法成为有价值的信息传递系统。使用表格或图层的精心设计的导航结构是无限可取的。
> 
> 太多的人使用框架来改变他们的导航栏，只修改一个页面。通过包含可以更好地实现这一点。
> 
> 仍然可以生成设计良好的框架页面，但这种情况很少发生，因此我建议所有编码人员远离这种想法。测试还表明，用户不喜欢框架导航。这对程序员来说可能看起来很性感，但如果用户不喜欢它，那么你的工作就很糟糕。框架使人感到困惑和恼怒。避开他们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-10T06:14:15.093

此处提供了一长串优点和缺点。 [http://fuzzzyblog.blogspot.com/2009/09/disadvantages-of-using-frames.html](http://fuzzzyblog.blogspot.com/2009/09/disadvantages-of-using-frames.html)

# c# - 在 C# 中使用有效数字格式化数字

> ID：158172
> 
> 赞同：32
> 
> 时间：2008-10-01T15:21:32.673
> 
> 标签：c#, significant-digits

我有一些十进制数据，我正在将其推送到要查看的 SharePoint 列表中。我想根据我对具体计算的了解来限制结果数据中显示的有效数字的数量。有时会是 3，所以 12345 会变成 12300，0.012345 会变成 0.0123。偶尔会是4个或5个。有什么方便的方法来处理这个吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-01-01T02:18:04.273

请参阅： “P Daddy”的[RoundToSignificantFigures](https://stackoverflow.com/questions/374316/round-a-double-to-x-significant-figures-after-decimal-point/374470#374470)。
我已经将他的方法与我喜欢的另一种方法结合起来。

在 TSQL 中舍入到有效数字要容易得多，其中舍入方法基于舍入位置，而不是小数位数 - .Net math.round 就是这种情况。您可以将 TSQL 中的数字四舍五入到负数，这将四舍五入整数 - 因此不需要缩放。

另请参阅此[其他线程](https://stackoverflow.com/questions/202302/rounding-to-an-arbitrary-number-of-significant-digits)。Pyrolistical 的方法很好。

问题的尾随零部分对我来说似乎更像是一个字符串操作，所以我包含了一个 ToString() 扩展方法，它会在必要时填充零。

```
using System;
using System.Globalization;

public static class Precision
{
    // 2^-24
    public const float FLOAT_EPSILON = 0.0000000596046448f;

    // 2^-53
    public const double DOUBLE_EPSILON = 0.00000000000000011102230246251565d;

    public static bool AlmostEquals(this double a, double b, double epsilon = DOUBLE_EPSILON)
    {
        // ReSharper disable CompareOfFloatsByEqualityOperator
        if (a == b)
        {
            return true;
        }
        // ReSharper restore CompareOfFloatsByEqualityOperator

        return (System.Math.Abs(a - b) < epsilon);
    }

    public static bool AlmostEquals(this float a, float b, float epsilon = FLOAT_EPSILON)
    {
        // ReSharper disable CompareOfFloatsByEqualityOperator
        if (a == b)
        {
            return true;
        }
        // ReSharper restore CompareOfFloatsByEqualityOperator

        return (System.Math.Abs(a - b) < epsilon);
    }
}

public static class SignificantDigits
{
    public static double Round(this double value, int significantDigits)
    {
        int unneededRoundingPosition;
        return RoundSignificantDigits(value, significantDigits, out unneededRoundingPosition);
    }

    public static string ToString(this double value, int significantDigits)
    {
        // this method will round and then append zeros if needed.
        // i.e. if you round .002 to two significant figures, the resulting number should be .0020.

        var currentInfo = CultureInfo.CurrentCulture.NumberFormat;

        if (double.IsNaN(value))
        {
            return currentInfo.NaNSymbol;
        }

        if (double.IsPositiveInfinity(value))
        {
            return currentInfo.PositiveInfinitySymbol;
        }

        if (double.IsNegativeInfinity(value))
        {
            return currentInfo.NegativeInfinitySymbol;
        }

        int roundingPosition;
        var roundedValue = RoundSignificantDigits(value, significantDigits, out roundingPosition);

        // when rounding causes a cascading round affecting digits of greater significance, 
        // need to re-round to get a correct rounding position afterwards
        // this fixes a bug where rounding 9.96 to 2 figures yeilds 10.0 instead of 10
        RoundSignificantDigits(roundedValue, significantDigits, out roundingPosition);

        if (Math.Abs(roundingPosition) > 9)
        {
            // use exponential notation format
            // ReSharper disable FormatStringProblem
            return string.Format(currentInfo, "{0:E" + (significantDigits - 1) + "}", roundedValue);
            // ReSharper restore FormatStringProblem
        }

        // string.format is only needed with decimal numbers (whole numbers won't need to be padded with zeros to the right.)
        // ReSharper disable FormatStringProblem
        return roundingPosition > 0 ? string.Format(currentInfo, "{0:F" + roundingPosition + "}", roundedValue) : roundedValue.ToString(currentInfo);
        // ReSharper restore FormatStringProblem
    }

    private static double RoundSignificantDigits(double value, int significantDigits, out int roundingPosition)
    {
        // this method will return a rounded double value at a number of signifigant figures.
        // the sigFigures parameter must be between 0 and 15, exclusive.

        roundingPosition = 0;

        if (value.AlmostEquals(0d))
        {
            roundingPosition = significantDigits - 1;
            return 0d;
        }

        if (double.IsNaN(value))
        {
            return double.NaN;
        }

        if (double.IsPositiveInfinity(value))
        {
            return double.PositiveInfinity;
        }

        if (double.IsNegativeInfinity(value))
        {
            return double.NegativeInfinity;
        }

        if (significantDigits < 1 || significantDigits > 15)
        {
            throw new ArgumentOutOfRangeException("significantDigits", value, "The significantDigits argument must be between 1 and 15.");
        }

        // The resulting rounding position will be negative for rounding at whole numbers, and positive for decimal places.
        roundingPosition = significantDigits - 1 - (int)(Math.Floor(Math.Log10(Math.Abs(value))));

        // try to use a rounding position directly, if no scale is needed.
        // this is because the scale mutliplication after the rounding can introduce error, although 
        // this only happens when you're dealing with really tiny numbers, i.e 9.9e-14.
        if (roundingPosition > 0 && roundingPosition < 16)
        {
            return Math.Round(value, roundingPosition, MidpointRounding.AwayFromZero);
        }

        // Shouldn't get here unless we need to scale it.
        // Set the scaling value, for rounding whole numbers or decimals past 15 places
        var scale = Math.Pow(10, Math.Ceiling(Math.Log10(Math.Abs(value))));

        return Math.Round(value / scale, significantDigits, MidpointRounding.AwayFromZero) * scale;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T18:11:09.440

这可能会奏效：

```
 double Input1 = 1234567;
string Result1 = Convert.ToDouble(String.Format("{0:G3}",Input1)).ToString("R0");

double Input2 = 0.012345;
string Result2 = Convert.ToDouble(String.Format("{0:G3}", Input2)).ToString("R6"); 
```

不过，将 G3 更改为 G4 会产生最奇怪的结果。它似乎将有效数字四舍五入？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T16:38:22.790

我最终从[http://ostermiller.org/utils/SignificantFigures.java.html](http://ostermiller.org/utils/SignificantFigures.java.html)中获取了一些代码。它在 java 中，所以我进行了快速搜索/替换和一些重新格式化以使 C# 构建。它似乎很适合我的重要人物需求。FWIW，我删除了他的 javadoc 注释以使其更简洁，但原始代码的文档记录得很好。

```
/*
 * Copyright (C) 2002-2007 Stephen Ostermiller
 * http://ostermiller.org/contact.pl?regarding=Java+Utilities
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * See COPYING.TXT for details.
 */
public class SignificantFigures
{
    private String original;
    private StringBuilder _digits;
    private int mantissa = -1;
    private bool sign = true;
    private bool isZero = false;
    private bool useScientificNotation = true;

    public SignificantFigures(String number)
    {
        original = number;
        Parse(original);
    }

    public SignificantFigures(double number)
    {
        original = Convert.ToString(number);
        try
        {
            Parse(original);
        }
        catch (Exception nfe)
        {
            _digits = null;
        }
    }

    public bool UseScientificNotation
    {
        get { return useScientificNotation; }
        set { useScientificNotation = value; }
    }

    public int GetNumberSignificantFigures()
    {
        if (_digits == null) return 0;
        return _digits.Length;
    }

    public SignificantFigures SetLSD(int place)
    {
        SetLMSD(place, Int32.MinValue);
        return this;
    }

    public SignificantFigures SetLMSD(int leastPlace, int mostPlace)
    {
        if (_digits != null && leastPlace != Int32.MinValue)
        {
            int significantFigures = _digits.Length;
            int current = mantissa - significantFigures + 1;
            int newLength = significantFigures - leastPlace + current;
            if (newLength <= 0)
            {
                if (mostPlace == Int32.MinValue)
                {
                    original = "NaN";
                    _digits = null;
                }
                else
                {
                    newLength = mostPlace - leastPlace + 1;
                    _digits.Length = newLength;
                    mantissa = leastPlace;
                    for (int i = 0; i < newLength; i++)
                    {
                        _digits[i] = '0';
                    }
                    isZero = true;
                    sign = true;
                }
            }
            else
            {
                _digits.Length = newLength;
                for (int i = significantFigures; i < newLength; i++)
                {
                    _digits[i] = '0';
                }
            }
        }
        return this;
    }

    public int GetLSD()
    {
        if (_digits == null) return Int32.MinValue;
        return mantissa - _digits.Length + 1;
    }

    public int GetMSD()
    {
        if (_digits == null) return Int32.MinValue;
        return mantissa + 1;
    }

    public override String ToString()
    {
        if (_digits == null) return original;
        StringBuilder digits = new StringBuilder(this._digits.ToString());
        int length = digits.Length;
        if ((mantissa <= -4 || mantissa >= 7 ||
             (mantissa >= length &&
              digits[digits.Length - 1] == '0') ||
             (isZero && mantissa != 0)) && useScientificNotation)
        {
            // use scientific notation.
            if (length > 1)
            {
                digits.Insert(1, '.');
            }
            if (mantissa != 0)
            {
                digits.Append("E" + mantissa);
            }
        }
        else if (mantissa <= -1)
        {
            digits.Insert(0, "0.");
            for (int i = mantissa; i < -1; i++)
            {
                digits.Insert(2, '0');
            }
        }
        else if (mantissa + 1 == length)
        {
            if (length > 1 && digits[digits.Length - 1] == '0')
            {
                digits.Append('.');
            }
        }
        else if (mantissa < length)
        {
            digits.Insert(mantissa + 1, '.');
        }
        else
        {
            for (int i = length; i <= mantissa; i++)
            {
                digits.Append('0');
            }
        }
        if (!sign)
        {
            digits.Insert(0, '-');
        }
        return digits.ToString();
    }

    public String ToScientificNotation()
    {
        if (_digits == null) return original;
        StringBuilder digits = new StringBuilder(this._digits.ToString());
        int length = digits.Length;
        if (length > 1)
        {
            digits.Insert(1, '.');
        }
        if (mantissa != 0)
        {
            digits.Append("E" + mantissa);
        }
        if (!sign)
        {
            digits.Insert(0, '-');
        }
        return digits.ToString();
    }

    private const int INITIAL = 0;
    private const int LEADZEROS = 1;
    private const int MIDZEROS = 2;
    private const int DIGITS = 3;
    private const int LEADZEROSDOT = 4;
    private const int DIGITSDOT = 5;
    private const int MANTISSA = 6;
    private const int MANTISSADIGIT = 7;

    private void Parse(String number)
    {
        int length = number.Length;
        _digits = new StringBuilder(length);
        int state = INITIAL;
        int mantissaStart = -1;
        bool foundMantissaDigit = false;
        // sometimes we don't know if a zero will be
        // significant or not when it is encountered.
        // keep track of the number of them so that
        // the all can be made significant if we find
        // out that they are.
        int zeroCount = 0;
        int leadZeroCount = 0;

        for (int i = 0; i < length; i++)
        {
            char c = number[i];
            switch (c)
            {
                case '.':
                    {
                        switch (state)
                        {
                            case INITIAL:
                            case LEADZEROS:
                                {
                                    state = LEADZEROSDOT;
                                }
                                break;
                            case MIDZEROS:
                                {
                                    // we now know that these zeros
                                    // are more than just trailing place holders.
                                    for (int j = 0; j < zeroCount; j++)
                                    {
                                        _digits.Append('0');
                                    }
                                    zeroCount = 0;
                                    state = DIGITSDOT;
                                }
                                break;
                            case DIGITS:
                                {
                                    state = DIGITSDOT;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                case '+':
                    {
                        switch (state)
                        {
                            case INITIAL:
                                {
                                    sign = true;
                                    state = LEADZEROS;
                                }
                                break;
                            case MANTISSA:
                                {
                                    state = MANTISSADIGIT;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                case '-':
                    {
                        switch (state)
                        {
                            case INITIAL:
                                {
                                    sign = false;
                                    state = LEADZEROS;
                                }
                                break;
                            case MANTISSA:
                                {
                                    state = MANTISSADIGIT;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                case '0':
                    {
                        switch (state)
                        {
                            case INITIAL:
                            case LEADZEROS:
                                {
                                    // only significant if number
                                    // is all zeros.
                                    zeroCount++;
                                    leadZeroCount++;
                                    state = LEADZEROS;
                                }
                                break;
                            case MIDZEROS:
                            case DIGITS:
                                {
                                    // only significant if followed
                                    // by a decimal point or nonzero digit.
                                    mantissa++;
                                    zeroCount++;
                                    state = MIDZEROS;
                                }
                                break;
                            case LEADZEROSDOT:
                                {
                                    // only significant if number
                                    // is all zeros.
                                    mantissa--;
                                    zeroCount++;
                                    state = LEADZEROSDOT;
                                }
                                break;
                            case DIGITSDOT:
                                {
                                    // non-leading zeros after
                                    // a decimal point are always
                                    // significant.
                                    _digits.Append(c);
                                }
                                break;
                            case MANTISSA:
                            case MANTISSADIGIT:
                                {
                                    foundMantissaDigit = true;
                                    state = MANTISSADIGIT;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                case '8':
                case '9':
                    {
                        switch (state)
                        {
                            case INITIAL:
                            case LEADZEROS:
                            case DIGITS:
                                {
                                    zeroCount = 0;
                                    _digits.Append(c);
                                    mantissa++;
                                    state = DIGITS;
                                }
                                break;
                            case MIDZEROS:
                                {
                                    // we now know that these zeros
                                    // are more than just trailing place holders.
                                    for (int j = 0; j < zeroCount; j++)
                                    {
                                        _digits.Append('0');
                                    }
                                    zeroCount = 0;
                                    _digits.Append(c);
                                    mantissa++;
                                    state = DIGITS;
                                }
                                break;
                            case LEADZEROSDOT:
                            case DIGITSDOT:
                                {
                                    zeroCount = 0;
                                    _digits.Append(c);
                                    state = DIGITSDOT;
                                }
                                break;
                            case MANTISSA:
                            case MANTISSADIGIT:
                                {
                                    state = MANTISSADIGIT;
                                    foundMantissaDigit = true;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                case 'E':
                case 'e':
                    {
                        switch (state)
                        {
                            case INITIAL:
                            case LEADZEROS:
                            case DIGITS:
                            case LEADZEROSDOT:
                            case DIGITSDOT:
                                {
                                    // record the starting point of the mantissa
                                    // so we can do a substring to get it back later
                                    mantissaStart = i + 1;
                                    state = MANTISSA;
                                }
                                break;
                            default:
                                {
                                    throw new Exception(
                                        "Unexpected character '" + c + "' at position " + i
                                        );
                                }
                        }
                    }
                    break;
                default:
                    {
                        throw new Exception(
                            "Unexpected character '" + c + "' at position " + i
                            );
                    }
            }
        }
        if (mantissaStart != -1)
        {
            // if we had found an 'E'
            if (!foundMantissaDigit)
            {
                // we didn't actually find a mantissa to go with.
                throw new Exception(
                    "No digits in mantissa."
                    );
            }
            // parse the mantissa.
            mantissa += Convert.ToInt32(number.Substring(mantissaStart));
        }
        if (_digits.Length == 0)
        {
            if (zeroCount > 0)
            {
                // if nothing but zeros all zeros are significant.
                for (int j = 0; j < zeroCount; j++)
                {
                    _digits.Append('0');
                }
                mantissa += leadZeroCount;
                isZero = true;
                sign = true;
            }
            else
            {
                // a hack to catch some cases that we could catch
                // by adding a ton of extra states.  Things like:
                // "e2" "+e2" "+." "." "+" etc.
                throw new Exception(
                    "No digits in number."
                    );
            }
        }
    }

    public SignificantFigures SetNumberSignificantFigures(int significantFigures)
    {
        if (significantFigures <= 0)
            throw new ArgumentException("Desired number of significant figures must be positive.");
        if (_digits != null)
        {
            int length = _digits.Length;
            if (length < significantFigures)
            {
                // number is not long enough, pad it with zeros.
                for (int i = length; i < significantFigures; i++)
                {
                    _digits.Append('0');
                }
            }
            else if (length > significantFigures)
            {
                // number is too long chop some of it off with rounding.
                bool addOne; // we need to round up if true.
                char firstInSig = _digits[significantFigures];
                if (firstInSig < '5')
                {
                    // first non-significant digit less than five, round down.
                    addOne = false;
                }
                else if (firstInSig == '5')
                {
                    // first non-significant digit equal to five
                    addOne = false;
                    for (int i = significantFigures + 1; !addOne && i < length; i++)
                    {
                        // if its followed by any non-zero digits, round up.
                        if (_digits[i] != '0')
                        {
                            addOne = true;
                        }
                    }
                    if (!addOne)
                    {
                        // if it was not followed by non-zero digits
                        // if the last significant digit is odd round up
                        // if the last significant digit is even round down
                        addOne = (_digits[significantFigures - 1] & 1) == 1;
                    }
                }
                else
                {
                    // first non-significant digit greater than five, round up.
                    addOne = true;
                }
                // loop to add one (and carry a one if added to a nine)
                // to the last significant digit
                for (int i = significantFigures - 1; addOne && i >= 0; i--)
                {
                    char digit = _digits[i];
                    if (digit < '9')
                    {
                        _digits[i] = (char) (digit + 1);
                        addOne = false;
                    }
                    else
                    {
                        _digits[i] = '0';
                    }
                }
                if (addOne)
                {
                    // if the number was all nines
                    _digits.Insert(0, '1');
                    mantissa++;
                }
                // chop it to the correct number of figures.
                _digits.Length = significantFigures;
            }
        }
        return this;
    }

    public double ToDouble()
    {
        return Convert.ToDouble(original);
    }

    public static String Format(double number, int significantFigures)
    {
        SignificantFigures sf = new SignificantFigures(number);
        sf.SetNumberSignificantFigures(significantFigures);
        return sf.ToString();
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-26T11:03:29.177

我有一个简短的答案来计算一个数字的[有效数字](http://www.physics.uoguelph.ca/tutorials/sig_fig/SIG_dig.htm)。这是代码和测试结果...

```
using System;
using System.Collections.Generic;

namespace ConsoleApplicationRound
{
    class Program
    {
        static void Main(string[] args)
        {
            //char cDecimal = '.';    // for English cultures
            char cDecimal = ',';    // for German cultures
            List<double> l_dValue = new List<double>();
            ushort usSignificants = 5;

            l_dValue.Add(0);
            l_dValue.Add(0.000640589);
            l_dValue.Add(-0.000640589);
            l_dValue.Add(-123.405009);
            l_dValue.Add(123.405009);
            l_dValue.Add(-540);
            l_dValue.Add(540);
            l_dValue.Add(-540911);
            l_dValue.Add(540911);
            l_dValue.Add(-118.2);
            l_dValue.Add(118.2);
            l_dValue.Add(-118.18);
            l_dValue.Add(118.18);
            l_dValue.Add(-118.188);
            l_dValue.Add(118.188);

            foreach (double d in l_dValue)
            {
                Console.WriteLine("d = Maths.Round('" +
                    cDecimal + "', " + d + ", " + usSignificants +
                    ") = " + Maths.Round(
                    cDecimal, d, usSignificants));
            }

            Console.Read();
        }
    }
} 
```

使用的数学类如下：

```
using System;
using System.Text;

namespace ConsoleApplicationRound
{
    class Maths
    {
        /// <summary>
        ///     The word "Window"
        /// </summary>
        private static String m_strZeros = "000000000000000000000000000000000";
        /// <summary>
        ///     The minus sign
        /// </summary>
        public const char m_cDASH = '-';

        /// <summary>
        ///     Determines the number of digits before the decimal point
        /// </summary>
        /// <param name="cDecimal">
        ///     Language-specific decimal separator
        /// </param>
        /// <param name="strValue">
        ///     Value to be scrutinised
        /// </param>
        /// <returns>
        ///     Nr. of digits before the decimal point
        /// </returns>
        private static ushort NrOfDigitsBeforeDecimal(char cDecimal, String strValue)
        {
            short sDecimalPosition = (short)strValue.IndexOf(cDecimal);
            ushort usSignificantDigits = 0;

            if (sDecimalPosition >= 0)
            {
                strValue = strValue.Substring(0, sDecimalPosition + 1);
            }

            for (ushort us = 0; us < strValue.Length; us++)
            {
                if (strValue[us] != m_cDASH) usSignificantDigits++;

                if (strValue[us] == cDecimal)
                {
                    usSignificantDigits--;
                    break;
                }
            }

            return usSignificantDigits;
        }

        /// <summary>
        ///     Rounds to a fixed number of significant digits
        /// </summary>
        /// <param name="d">
        ///     Number to be rounded
        /// </param>
        /// <param name="usSignificants">
        ///     Requested significant digits
        /// </param>
        /// <returns>
        ///     The rounded number
        /// </returns>
        public static String Round(char cDecimal,
            double d,
            ushort usSignificants)
        {
            StringBuilder value = new StringBuilder(Convert.ToString(d));

            short sDecimalPosition = (short)value.ToString().IndexOf(cDecimal);
            ushort usAfterDecimal = 0;
            ushort usDigitsBeforeDecimalPoint =
                NrOfDigitsBeforeDecimal(cDecimal, value.ToString());

            if (usDigitsBeforeDecimalPoint == 1)
            {
                usAfterDecimal = (d == 0)
                    ? usSignificants
                    : (ushort)(value.Length - sDecimalPosition - 2);
            }
            else
            {
                if (usSignificants >= usDigitsBeforeDecimalPoint)
                {
                    usAfterDecimal =
                        (ushort)(usSignificants - usDigitsBeforeDecimalPoint);
                }
                else
                {
                    double dPower = Math.Pow(10,
                        usDigitsBeforeDecimalPoint - usSignificants);

                    d = dPower*(long)(d/dPower);
                }
            }

            double dRounded = Math.Round(d, usAfterDecimal);
            StringBuilder result = new StringBuilder();

            result.Append(dRounded);
            ushort usDigits = (ushort)result.ToString().Replace(
                Convert.ToString(cDecimal), "").Replace(
                Convert.ToString(m_cDASH), "").Length;

            // Add lagging zeros, if necessary:
            if (usDigits < usSignificants)
            {
                if (usAfterDecimal != 0)
                {
                    if (result.ToString().IndexOf(cDecimal) == -1)
                    {
                        result.Append(cDecimal);
                    }

                    int i = (d == 0) ? 0 : Math.Min(0, usDigits - usSignificants);

                    result.Append(m_strZeros.Substring(0, usAfterDecimal + i));
                }
            }

            return result.ToString();
        }
    }
} 
```

有更短代码的答案吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-15T11:09:52.210

通过对 Decimal 使用 GetBits 方法并利用 BigInteger 执行屏蔽，您可以获得优雅的位完美舍入。

一些实用程序

```
 public static int CountDigits
        (BigInteger number) => ((int)BigInteger.Log10(number))+1;

    private static readonly BigInteger[] BigPowers10 
       = Enumerable.Range(0, 100)
                 .Select(v => BigInteger.Pow(10, v))
                 .ToArray(); 
```

主要功能

```
 public static decimal RoundToSignificantDigits
        (this decimal num,
         short n)
    {
        var bits = decimal.GetBits(num);
        var u0 = unchecked((uint)bits[0]);
        var u1 = unchecked((uint)bits[1]);
        var u2 = unchecked((uint)bits[2]);

        var i = new BigInteger(u0)
                + (new BigInteger(u1) << 32)
                + (new BigInteger(u2) << 64);

        var d = CountDigits(i);

        var delta = d - n;
        if (delta < 0)
            return num;

        var scale = BigPowers10[delta];
        var div = i/scale;
        var rem = i%scale;
        var up = rem > scale/2;
        if (up)
            div += 1;
        var shifted = div*scale;

        bits[0] =unchecked((int)(uint) (shifted & BigUnitMask));
        bits[1] =unchecked((int)(uint) (shifted>>32 & BigUnitMask));
        bits[2] =unchecked((int)(uint) (shifted>>64 & BigUnitMask));

        return new decimal(bits);
    } 
```

测试用例 0

```
 public void RoundToSignificantDigits()
    {
        WMath.RoundToSignificantDigits(0.0012345m, 2).Should().Be(0.0012m);
        WMath.RoundToSignificantDigits(0.0012645m, 2).Should().Be(0.0013m);
        WMath.RoundToSignificantDigits(0.040000000000000008, 6).Should().Be(0.04);
        WMath.RoundToSignificantDigits(0.040000010000000008, 6).Should().Be(0.04);
        WMath.RoundToSignificantDigits(0.040000100000000008, 6).Should().Be(0.0400001);
        WMath.RoundToSignificantDigits(0.040000110000000008, 6).Should().Be(0.0400001);
        WMath.RoundToSignificantDigits(0.20000000000000004, 6).Should().Be(0.2);
        WMath.RoundToSignificantDigits(0.10000000000000002, 6).Should().Be(0.1);
        WMath.RoundToSignificantDigits(0.0, 6).Should().Be(0.0);

    } 
```

测试用例 1

```
 public void RoundToSigFigShouldWork()
    {
        1.2m.RoundToSignificantDigits(1).Should().Be(1m);
        0.01235668m.RoundToSignificantDigits(3).Should().Be(0.0124m);
        0.01m.RoundToSignificantDigits(3).Should().Be(0.01m);

        1.23456789123456789123456789m.RoundToSignificantDigits(4)
                                     .Should().Be(1.235m);

        1.23456789123456789123456789m.RoundToSignificantDigits(16)
                                     .Should().Be(1.234567891234568m);

        1.23456789123456789123456789m.RoundToSignificantDigits(24)
                                     .Should().Be(1.23456789123456789123457m);

        1.23456789123456789123456789m.RoundToSignificantDigits(27)
                                     .Should().Be(1.23456789123456789123456789m);
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:16:41.237

我发现[这篇文章](http://www.eggheadcafe.com/software/aspnet/32197033/one-significant-figure-in.aspx)对它进行了快速搜索。基本上，这个转换为一个字符串，一次一个地遍历该数组中的字符，直到达到最大值。意义。这行得通吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-23T02:09:59.897

以下代码并不完全符合规范，因为它不会尝试将任何内容四舍五入到小数点左侧。但它比这里介绍的任何其他东西都简单（到目前为止）。我很惊讶 C# 没有内置的方法来处理这个问题。

```
static public string SignificantDigits(double d, int digits=10)
{
    int magnitude = (d == 0.0) ? 0 : (int)Math.Floor(Math.Log10(Math.Abs(d))) + 1;
    digits -= magnitude;
    if (digits < 0)
        digits = 0;
    string fmt = "f" + digits.ToString();
    return d.ToString(fmt);
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-10-01T17:40:56.957

我记得“有效数字”是指点分隔符之后的位数，因此 0.012345 的 3 个有效数字将是 0.012 而不是 0.0123，但这对于解决方案来说并不重要。我也明白，如果数字 > 1，您希望在一定程度上“取消”最后一位数字。您写道 12345 将变为 12300 但我不确定您是否希望 123456 变为 1230000 或 123400 ？我的解决方案是最后一个。如果您只有几个变体，您当然可以创建一个小的初始化数组，而不是计算因子。

```
private static string FormatToSignificantFigures(decimal number, int amount)
{
    if (number > 1)
    {
        int factor = Factor(amount);
        return ((int)(number/factor)*factor).ToString();
    }

    NumberFormatInfo nfi = new CultureInfo("en-US", false).NumberFormat;
    nfi.NumberDecimalDigits = amount;

    return(number.ToString("F", nfi));
}

private static int Factor(int x)
{
    return DoCalcFactor(10, x-1);
}

private static int DoCalcFactor(int x, int y)
{
    if (y == 1) return x;
    return 10*DoCalcFactor(x, y - 1);
} 
```

亲切的问候卡斯滕

# java - 你为什么要实现 finalize()？

> ID：158174
> 
> 赞同：389
> 
> 时间：2008-10-01T15:22:09.627
> 
> 标签：java, jvm, finalize

我一直在阅读很多关于 Java 的菜鸟问题`finalize()`，发现没有人真正明确说明 finalize() 是一种不可靠的资源清理方式，这有点令人困惑。我看到有人评论说他们用它来清理连接，这真的很可怕，因为接近保证连接已关闭的唯一方法是最终实现 try (catch)。

我没有受过 CS 教育，但我已经专业地使用 Java 编程近十年了，而且我从未见过有人`finalize()`在生产系统中实现过。这仍然不意味着它没有它的用​​途，或者与我一起工作的人一直在做正确的事情。

所以我的问题是，有哪些用例`finalize()`无法通过语言中的另一个进程或语法更可靠地处理？

请提供具体的场景或您的经验，只是重复 Java 教科书，或者 finalize 的预期用途是不够的，因为这不是这个问题的意图。

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2008-10-01T15:27:50.363

您可以将其用作持有外部资源（套接字、文件等）的对象的支持。实现`close()`需要调用的方法和文档。

如果您检测到它尚未完成，请实施`finalize()`以执行处理。`close()`也许有一些东西被倾倒来`stderr`指出你正在清理一个有缺陷的来电者。

它在异常/错误的情况下提供额外的安全性。不是每个调用者每次都会做正确的`try {} finally {}`事情。不幸的是，但在大多数环境中都是如此。

我同意它很少需要。正如评论者所指出的，它带有 GC 开销。只有在长时间运行的应用程序中需要“腰带和吊带”安全性时才使用。

我看到从 Java 9 开始，[`Object.finalize()`](https://docs.oracle.com/javase/9/docs/api/java/lang/Object.html#finalize--)它已被弃用！他们将我们指向[`java.lang.ref.Cleaner`](https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html)并[`java.lang.ref.PhantomReference`](https://docs.oracle.com/javase/9/docs/api/java/lang/ref/PhantomReference.html)作为替代方案。

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2008-10-01T16:05:23.067

`finalize()`是对 JVM 的提示，在未指定的时间执行代码可能会很好。当您希望代码神秘地无法运行时，这很好。

在终结器中做任何重要的事情（基本上除了日志之外的任何事情）在三种情况下也很好：

*   您想赌其他最终确定的对象仍将处于您程序的其余部分认为有效的状态。
*   您想向所有具有终结器的类的所有方法添加大量检查代码，以确保它们在终结后行为正确。
*   您想不小心复活已完成的对象，并花费大量时间试图弄清楚它们为什么不起作用，和/或为什么它们最终发布时没有完成。

如果你认为你需要 finalize()，有时你真正想要的是一个**幻像引用**（在给出的示例中，它可能持有对其引用对象使用的连接的硬引用，并在幻像引用排队后关闭它）。这也具有它可能神秘地永远不会运行的属性，但至少它不能调用方法或恢复最终对象。因此，它适用于您并非绝对需要干净地关闭该连接，但您非常愿意，并且您班级的客户不能或不会自己调用 close 的情况（这实际上很公平 -什么' *如果您设计的接口需要*在收集之前采取特定操作，那么拥有垃圾收集器的意义何在？这让我们回到了 malloc/free 的时代。）

其他时候，您需要您认为自己正在管理的资源更加强大。例如，为什么需要关闭该连接？它最终必须基于系统提供的某种I/O（套接字、文件等），那么当最低级别的资源被gced时，为什么不能依靠系统为您关闭它呢？如果另一端的服务器绝对要求您干净地关闭连接，而不是仅仅丢弃套接字，那么当有人绊倒您的代码正在运行的机器的电源线或中间网络中断时会发生什么？

免责声明：我过去曾研究过 JVM 实现。我讨厌终结者。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-10-01T17:38:32.093

一个简单的规则：永远不要使用终结器。

一个对象有一个终结器（不管它执行什么代码）这一事实就足以导致垃圾收集的大量开销。

来自Brian Goetz 的[一篇文章](http://www.ibm.com/developerworks/java/library/j-jtp01274.html)：

> 与没有终结器的对象相比，具有终结器的对象（具有非平凡 finalize() 方法的对象）具有显着的开销，应谨慎使用。可终结的对象分配和收集都比较慢。在分配时，JVM 必须向垃圾收集器注册任何可终结对象，并且（至少在 HotSpot JVM 实现中）可终结对象必须遵循比大多数其他对象更慢的分配路径。同样，可终结对象的收集速度也较慢。至少需要两个垃圾收集周期（在最好的情况下）才能回收可终结对象，并且垃圾收集器必须做额外的工作来调用终结器。结果是分配和收集对象花费了更多时间，垃圾收集器承受了更大的压力，因为无法访问的可终结对象使用的内存保留的时间更长。再加上终结器不能保证在任何可预测的时间范围内运行，甚至根本不能保证这一事实，您可以看到在相对较少的情况下终结器是正确的工具。

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2008-10-01T15:44:18.797

我在生产代码中使用 finalize 的唯一一次是检查给定对象的资源是否已被清理，如果没有，则记录一个非常明确的消息。它实际上并没有尝试自己做，如果做得不好，它只会大喊大叫。结果非常有用。

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2008-10-01T15:24:23.553

自 1998 年以来，我一直在专业地做 Java，但我从未实现过`finalize()`. 不止一次。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-10-01T16:56:03.303

公认的答案很好，我只是想补充一点，现在有一种方法可以在不实际使用它的情况下拥有 finalize 的功能。

查看“参考”类。弱参考、幻影参考和软参考。

您可以使用它们来保留对所有对象的引用，但此引用 ALONE 不会停止 GC。这样做的好处是你可以让它在它被删除时调用一个方法，并且这个方法可以**保证**被调用。

至于 finalize：我曾经使用 finalize 来了解哪些对象正在被释放。你可以用静态、引用计数等玩一些巧妙的游戏——但这只是为了分析，但要注意这样的代码（不仅仅是在 finalize 中，而是你最有可能看到它的地方）：

```
public void finalize() {
  ref1 = null;
  ref2 = null;
  othercrap = null;
} 
```

这表明有人不知道他们在做什么。几乎不需要像这样的“清理”。当类被 GC 时，这是自动完成的。

如果您在 finalize 中找到类似的代码，那么可以保证编写它的人会感到困惑。

如果它在其他地方，则可能是代码是对坏模型的有效补丁（一个类会存在很长时间，由于某种原因，它引用的东西必须在对象被 GC 之前手动释放）。通常是因为有人忘记删除侦听器或其他东西，并且无法弄清楚为什么他们的对象没有被 GC'd，所以他们只是删除了它所指的东西，然后耸耸肩走开了。

它不应该被用来“更快”地清理东西。

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2008-10-05T14:42:56.983

我不确定你能做些什么，但是......

```
itsadok@laptop ~/jdk1.6.0_02/src/
$ find . -name "*.java" | xargs grep "void finalize()" | wc -l
41 
```

所以我猜太阳发现**了一些**（他们认为）应该使用它的案例。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-06-02T01:55:24.967

```
class MyObject {
    Test main;

    public MyObject(Test t) {    
        main = t; 
    }

    protected void finalize() {
        main.ref = this; // let instance become reachable again
        System.out.println("This is finalize"); //test finalize run only once
    }
}

class Test {
    MyObject ref;

    public static void main(String[] args) {
        Test test = new Test();
        test.ref = new MyObject(test);
        test.ref = null; //MyObject become unreachable，finalize will be invoked
        System.gc(); 
        if (test.ref != null) System.out.println("MyObject still alive!");  
    }
} 
```

=====================================

结果：

```
This is finalize

MyObject still alive! 
```

======================================

因此，您可以在 finalize 方法中使无法访问的实例可访问。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-02-13T18:09:38.163

`finalize()`可用于捕获资源泄漏。如果资源应该关闭但没有将它没有关闭的事实写入日志文件并关闭它。这样您就可以消除资源泄漏并给自己一种方法来知道它已经发生，以便您可以修复它。

自 1.0 alpha 3 (1995) 以来，我一直在使用 Java 进行编程，但我还没有为任何事情重写 finalize...

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-01T15:27:49.520

您不应该依赖 finalize() 来为您清理资源。finalize() 在类被垃圾回收之前不会运行，如果那样的话。使用完资源后，最好显式释放资源。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-01T16:00:22.017

小心你在`finalize()`. 特别是如果您将它用于调用 close() 以确保资源被清理。我们遇到了几种情况，我们将 JNI 库链接到正在运行的 java 代码中，并且在我们使用 finalize() 调用 JNI 方法的任何情况下，我们都会遇到非常严重的 java 堆损坏。损坏不是由底层 JNI 代码本身引起的，本机库中的所有内存跟踪都很好。这只是我们从 finalize() 调用 JNI 方法的事实。

这是使用仍在广泛使用的 JDK 1.5。

直到很久以后我们才发现出了什么问题，但最终罪魁祸首始终是使用 JNI 调用的 finalize() 方法。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-01T17:43:12.083

为了突出上述答案中的一点：终结器将在单独的 GC 线程上执行。我听说过一个主要的 Sun 演示，开发人员在其中为一些终结器添加了一个小睡眠，并故意让一个原本花哨的 3D 演示屈服。

最好避免，除了测试环境诊断。

Eckel 的 Thinking in Java 对此[有很好的部分](http://www.codeguru.com/java/tij/tij0051.shtml)。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-10-01T16:15:39.313

嗯，我曾经用它来清理没有返回到现有池的对象。

他们经常被转来转去，所以不知道什么时候可以安全地回到游泳池。问题在于它在垃圾收集期间引入了巨大的惩罚，这远远超过了池化对象所节省的任何成本。在我拆掉整个游泳池之前，它已经投入生产了大约一个月，让所有东西都充满活力并完成了它。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-01T15:25:07.407

在编写将由其他开发人员使用的代码时，需要调用某种“清理”方法来释放资源。有时，其他开发人员忘记调用您的清理（或关闭、销毁或其他）方法。为避免可能的资源泄漏，您可以检查 finalize 方法以确保该方法被调用，如果不是，您可以自己调用它。

许多数据库驱动程序在他们的 Statement 和 Connection 实现中这样做，以便为忘记调用它们的开发人员提供一点安全性。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-02-03T12:10:59.377

编辑：好的，它真的不起作用。我实现了它，并认为如果它有时失败，那对我来说没问题，但它甚至没有一次调用 finalize 方法。

我不是专业的程序员，但在我的程序中，我有一个案例，我认为它是使用 finalize() 的一个很好的例子，它是一个缓存，可以在其内容被销毁之前将其写入磁盘。因为不需要每次销毁时都执行它，它只会加快我的程序，我希望我没有做错。

```
@Override
public void finalize()
{
    try {saveCache();} catch (Exception e)  {e.printStackTrace();}
}

public void saveCache() throws FileNotFoundException, IOException
{
    ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream("temp/cache.tmp"));
    out.writeObject(cache);
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-04-07T08:11:40.953

删除已添加到全局/静态位置（不需要）并且需要在删除对象时删除的东西会很方便。例如：

```
    私人无效 addGlobalClickListener() {
        weakAwtEventListener = new WeakAWTEventListener(this);

        Toolkit.getDefaultToolkit().addAWTEventListener(weakAwtEventListener, AWTEvent.MOUSE_EVENT_MASK);
    }

    @覆盖
    protected void finalize() 抛出 Throwable {
        super.finalize();

        如果（弱AwtEventListener！= null）{
            Toolkit.getDefaultToolkit().removeAWTEventListener(weakAwtEventListener);
        }
    }

```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-12-03T12:56:26.890

接受的答案列表可以完成在 finalize 期间关闭资源。

然而，[这个答案](https://stackoverflow.com/a/26645534/1197030)表明，至少在使用 JIT 编译器的 java8 中，您会遇到意想不到的问题，有时甚至在您完成从对象维护的流中读取之前调用终结器。

因此，即使在这种情况下，**也不**建议调用 finalize。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-09-19T17:01:58.387

iirc - 您可以使用 finalize 方法来实现昂贵资源的池化机制 - 所以它们也不会获得 GC。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-03-16T16:36:52.393

就个人而言，我几乎从不使用，`finalize()`除非在一种罕见的情况下：我创建了一个自定义泛型类型集合，并编写了一个自定义`finalize()`方法，它执行以下操作：

```
public void finalize() throws Throwable {
    super.finalize();
    if (destructiveFinalize) {
        T item;
        for (int i = 0, l = length(); i < l; i++) {
            item = get(i);
            if (item == null) {
                continue;
            }
            if (item instanceof Window) {
                ((Window) get(i)).dispose();
            }
            if (item instanceof CompleteObject) {
                ((CompleteObject) get(i)).finalize();
            }
            set(i, null);
        }
    }
} 
```

^(（`CompleteObject`是我制作的一个接口，可让您指定您已经实现了很少实现的`Object`方法，例如`#finalize()`、`#hashCode()`和`#clone()`）)

因此，使用姊妹`#setDestructivelyFinalizes(boolean)`方法，使用我的集合的程序可以（帮助）保证销毁对该集合的引用也会破坏对其内容的引用，并处理任何可能使 JVM 无意中保持活动状态的窗口。我也考虑过停止任何线程，但这打开了一个全新的蠕虫罐。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-06-24T03:54:26.150

一旦我们完成了资源（文件、套接字、流等），就需要关闭它们。它们通常具有`close()`我们通常在语句`finally`部分中调用的方法。`try-catch`有时`finalize()`也可以由少数开发人员使用，但 IMO 这不是一种合适的方式，因为不能保证总是会调用 finalize。

在 Java 7 中，我们有[try-with-resources](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)语句，可以像这样使用：

```
try (BufferedReader br = new BufferedReader(new FileReader(path))) {
  // Processing and other logic here.
} catch (Exception e) {
  // log exception
} finally {
  // Just in case we need to do some stuff here.
} 
```

在上面的示例中，try-with-resource 将`BufferedReader`通过调用`close()`方法自动关闭资源。如果我们愿意，我们也可以在我们自己的类中实现[Closeable](http://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html)并以类似的方式使用它。IMO 似乎更简洁易懂。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-06-04T07:20:37.610

作为旁注：

> 覆盖 finalize() 的对象由垃圾收集器特殊处理。通常，在对象不再在范围内之后，对象会在回收周期中立即销毁。但是，可终结的对象被移动到队列中，其中单独的终结线程将耗尽队列并在每个对象上运行 finalize() 方法。一旦 finalize() 方法终止，对象将最终准备好在下一个周期进行垃圾回收。

资料来源：[java-9 上不推荐使用 finalize()](https://www.infoq.com/news/2017/03/Java-Finalize-Deprecated#mainLogin)

# wpf - 你如何在WPF中进行相对定位？

> ID：158175
> 
> 赞同：32
> 
> 时间：2008-10-01T15:22:12.407
> 
> 标签：wpf, css-position

如何在 WPF 中相对定位元素？标准模型是对所有内容都使用布局管理器，但是如果您想简单地根据其他元素的位置来定位元素（例如在 Canvas 上）怎么办？

例如，您可能希望将一个元素（例如按钮）附加到另一个元素（可能是面板）的侧面，而与该面板的位置或布局无关。任何使用过工程工具（SolidWorks、AutoCad 等）的人都熟悉这种相对定位。

将所有内容强制放入布局管理器（不同的 WPF 面板）对于某些场景没有多大意义，在这些场景中，您不关心元素由某个父容器维护，并且您不希望其他子容器受到更改的影响彼此的布局/外观。WPF 是否以任何方式支持这种相对定位模型？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-02T09:42:35.490

您可以在画布上放置一个堆栈面板，水平对齐，然后将两个按钮放在那里，而不是直接在画布上放置（如您的示例中）按钮。

像这样：

```
<Canvas>
  <StackPanel Canvas.Left="100" Canvas.Top="100" Orientation="Horizontal">
    <Button>Button 1</Button><Button>Button 2</Button>
  </StackPanel>
</Canvas> 
```

![替代文字](https://farm4.static.flickr.com/3105/2907118452_d37fee4e41.jpg?v=0)

我认为当您在一个表单中使用多个布局时它非常灵活，并且您可以创建几乎任何您想要的配置。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T15:32:57.263

好问题。据我所知，我们需要有一个不同的自定义面板来获得这个功能。由于 WPF 基于视觉层次结构，因此无法为平台中的元素提供这种平面结构。

**但这里有一个技巧来做到这一点。** 将元素放置在相同位置并使用 RenderTransform.TranslateTransform 进行相对位移。这样，您的 TranslateTransfrom 的 X 和 Y 将始终与其他元素相关。

# sql - 如何在 Oracle 中将日期截断为秒

> ID：158189
> 
> 赞同：15
> 
> 时间：2008-10-01T15:23:35.770
> 
> 标签：sql, oracle

[此页面](http://www.techonthenet.com/oracle/functions/trunc_date.php])提到如何将时间戳截断为分钟/小时/等。在甲骨文。

您将如何以相同的方式将时间戳缩短为秒？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-01T15:35:24.993

由于 的精度`DATE`是秒（并且没有秒的分数），所以根本不需要`TRUNC`。

数据类型`TIMESTAMP`允许几分之一秒。如果将其转换为 a`DATE`小数秒将被删除 - 例如

```
select cast(systimestamp as date) 
  from dual; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-21T14:08:03.763

我很抱歉，但我所有的前辈似乎都错了。

```
select cast(systimestamp as date) from dual 
```

..不会截断，而是舍入到下一秒。

我使用一个函数：

```
CREATE OR REPLACE FUNCTION TRUNC_TS(TS IN TIMESTAMP) RETURN DATE AS
BEGIN

    RETURN TS;

END; 
```

例如：

```
SELECT systimestamp
    ,trunc_ts(systimestamp) date_trunc
    ,CAST(systimestamp AS DATE) date_cast 
FROM dual; 
```

回报：

```
 SYSTIMESTAMP                       DATE_TRUNC             DATE_CAST
    21.01.10 15:03:34,567350 +01:00    21.01.2010 15:03:34    21.01.2010 15:03:35 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T16:19:26.107

关于截断 Oracle 日期的一般主题，这里是可以在日期 trunc() 和 round() 函数中使用的格式模型的文档链接

[http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/functions242.htm#sthref2718](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/functions242.htm#sthref2718)

“秒”未列出，因为 DATE 数据类型的粒度为秒。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T08:18:13.917

我使用了这样的功能：

```
FUNCTION trunc_sec(p_ts IN timestamp)
IS
    p_res timestamp;
BEGIN
    RETURN TO_TIMESTAMP(TO_CHAR(p_ts, 'YYYYMMDDHH24MI'), 'YYYYMMDDHH24MI');
END trunc_sec; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-12-06T12:04:07.477

仅将工作截断到最小值，投射到日期`to_char(START_TIME,'YYYYMMDDHH24MISS')`

或者干脆`select to_char(current_timestamp, 'YYYYMMDDHH24MISS') from dual;`

[https://www.techonthenet.com/oracle/functions/trunc_date.php](https://www.techonthenet.com/oracle/functions/trunc_date.php)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T15:51:05.300

要将 a 截断`timestamp`为秒，您可以将其转换为日期：

```
CAST(timestamp AS DATE) 
```

然后执行`TRUNC`文章中的 's：

```
TRUNC(CAST(timestamp AS DATE), 'YEAR') 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T16:24:14.877

一些东西的顺序：

```
select to_char(current_timestamp, 'SS') from dual; 
```

# queue - 如何使用 mockrunner 设置模拟队列来测试 xml 过滤器？

> ID：158200
> 
> 赞同：5
> 
> 时间：2008-10-01T15:24:44.163
> 
> 标签：queue, jms, ejb, jndi, mockrunner

我正在使用[http://mockrunner.sourceforge.net/](http://mockrunner.sourceforge.net/)中的 mockrunner 包来设置一个模拟队列，用于 JUnit 测试一个 XML 过滤器，其操作如下：

1.  为 ftp 服务器设置可识别的属性以放置和获取 xml 输入以及跟踪作业的 jms 队列服务器。一旦接收到队列消息，就会远程等待实际解析 xml 的服务器。
2.  使用 ftp 创建一个远程目录并使用 mqconnectionfactory 启动到队列服务器的给定地址的队列连接。
3.  一旦在 2) 中创建了新的队列条目，过滤器将等待新的队列消息出现，表示远程服务器已完成作业。然后过滤器从 ftp 中抓取修改后的 xml 文件并将其传递给下一个过滤器。

我正在处理的 JUnit 测试只需要通过启动本地 ftp 和模拟队列服务器来模拟此环境以供过滤器连接，然后等待过滤器连接到队列并将新的 xml 输入文件放在本地目录中通过本地 ftp 服务器，等待队列消息，然后稍微修改 xml 输入，将修改后的 xml 放在新目录中，然后向队列发布另一条消息，表示作业已完成。

我在网上找到的所有教程都使用 EJB 和 JNDI 来查找队列服务器。如果可能的话，我想通过在我的本地机器上创建一个模拟队列并以最简单的方式连接到它，而不是使用 EJB 和 JNDI 来回避这条路线。

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-22T10:55:13.913

我正在使用[MockEjb](http://mockejb.sourceforge.net)，其中有一些示例用于使用模拟队列，因此请查看[信息](http://mockejb.sourceforge.net/javadoc/index.html)和[示例](http://mockejb.sourceforge.net/java2html/org/mockejb/test/MDBTest.java.html) ，希望对您有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T16:20:46.023

我建议看看使用[Apache Camel](http://activemq.apache.org/camel/)来创建您的测试用例。[然后很容易从任何可用组件](http://activemq.apache.org/camel/components.html)切换您的测试用例，最重要的是，Camel 带有一些非常方便的[Mock Endpoints](http://activemq.apache.org/camel/mock.html)，这使得测试复杂的路由逻辑变得非常容易，特别是使用异步操作。

[如果您还使用 Spring，那么可以先在 Camel 中使用模拟端点](http://activemq.apache.org/camel/spring-testing.html)尝试这些Spring 单元测试，这让您可以注入模拟端点以与 ProducerTemplate 对象一起执行断言，从而非常容易为您的测试用例触发消息. 例如，请参阅该页面上的最后一个示例。

[从使用像SEDA 端点](http://activemq.apache.org/camel/seda.html)这样的简单端点开始- 然后当您了解核心 spring/mock 框架时，尝试使用[JMS 端点](http://activemq.apache.org/camel/jms.html)或[FTP](http://activemq.apache.org/camel/ftp.html)端点等。

# bit-manipulation - Bit Twiddle 执行此转换

> ID：158209
> 
> 赞同：2
> 
> 时间：2008-10-01T15:26:45.937
> 
> 标签：bit-manipulation, bits

好奇是否有人对我将如何对二进制数执行以下操作有所了解：

转变

```
 01+0 -> 10+1 (+ as in regular expressions, one or more)
    01 -> 10  
    10 -> 01 
```

所以，

```
10101000010100011100
01010100101010100010 
```

并澄清这不是一个简单的反转：

```
000000100000000000
000001010000000000 
```

我在想正则表达式，但我正在使用二进制数并希望保持这种状态。[bit twiddling hacks](http://graphics.stanford.edu/~seander/bithacks.html)页面也没有给我任何见解。这显然具有元胞自动机的一些本质。那么，任何人都有一些可以解决这个问题的操作吗？（不需要代码，我知道该怎么做）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T15:36:14.977

假设 x 是您的变量。然后你会有：

```
unsigned myBitOperation(unsigned x)
{
    return ((x<<1) | (x>>1)) & (~x);
} 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-01T15:27:56.337

C/C++ 中的 Twidle 是 ~

# visual-studio - 跨多个 Visual Studio 版本的项目依赖项

> ID：158218
> 
> 赞同：3
> 
> 时间：2008-10-01T15:28:19.613
> 
> 标签：visual-studio, projects-and-solutions, project-organization

我有 3 个 .net 项目。

Project1.dll 由 VS2008 项目生成。

Project2.dll 由引用 Project1.dll 的 VS2005 项目生成。

Project3.dll 由引用 Project1.dll 和 Project2.dll 的 VS2008 项目生成。

现在，我构建了 Project1.dll，并手动将其复制到 Project 2 可以提取它的地方。

然后我构建 Project2.dll 并手动将它和 Project1.dll 复制到 Project 3 可以提取它们的地方。

显然我做错了什么（手动）。使我的项目参考资料保持最新的正确方法是什么？

* * *

将 Project2 更新到 VS2008，然后创建一个包含所有 3 个项目的解决方案目前不是一种选择。我们有一个 3rd 方的 visualstudio 插件，它还不能在 VS2008 中工作。Project2 必须留在 VS2005

将 Project1 和 Project3 取消更新到 VS2005，然后创建一个解决方案也不是一种选择。我们在这些项目中依赖于 C# 3.0 和 .net 3.5 功能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T15:39:41.847

可能最好的选择是为所有三个项目提供一个通用的构建文件夹。这可以在项目属性-> 构建-> 输出路径中完成。然后将引用指向输出文件夹。这样，无论何时您构建任何较低的项目，较高的项目都将拥有最新版本。您也可以为每个配置（调试、发布）设置路径，因此您无需为每种构建类型更改它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:41:07.523

Project3 的预构建事件怎么样，它出去并使用批处理文件构建 Project1 将其复制到 Project2 文件夹，然后构建 project2 并将其复制到 project3 文件夹。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T16:17:42.973

我建议在解决方案之间共享 csproj/vbproj 文件。项目文件的格式在两个版本的 studio 之间是兼容的（但是解决方案文件不兼容），只要您的 VS2008 项目针对 2.0 运行时，编译它们应该没有问题。这将允许您引用将处理依赖关系的项目。

唯一麻烦的地方是如果您有一个需要在两个版本的工作室之间工作的 Web 项目。在这种情况下，将对项目文件进行一些修改，这些修改将指向正确的 MSBuild 目标文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T15:35:04.543

我们使用构建脚本来处理依赖关系、构建 DLL 并手动执行您正在执行的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T16:14:22.420

我过去使用的一个技巧是将所有内容移至 2008 年。然后我在 2005 年为项目二设置了一个特殊的解决方案，并使用它与插件一起工作。让它发挥作用取决于项目二在 2008 年的表现有多糟糕。

# c# - 什么会导致正在执行的应用程序的当前目录发生变化？

> ID：158219
> 
> 赞同：2
> 
> 时间：2008-10-01T15:28:23.950
> 
> 标签：c#, .net, filesystems, working-directory

我有一个包含以下代码的 C# 应用程序：

```
string file = "relativePath.txt";

//Time elapses...

string contents = File.ReadAllText(file); 
```

这在大多数情况下都可以正常工作。该文件是相对于应用程序启动的目录读取的。但是在测试中发现，如果放置5个小时左右，app会抛出`FileNotFoundException`“C:\Documents and Settings\Adminstrator\relativePath.txt”的提示找不到。但是，如果读取文件的操作立即运行，则会从正确的位置读取文件，我们将其称为“C:\foo\relativePath.txt”

是什么赋予了？而且，最好的解决办法是什么？解决文件反对`Assembly.GetEntryAssembly().Location`？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T15:35:28.397

OpenFileDialog 是一个可以改变你的路径的诡异地方。当用户在文件夹之间导航时，它会将您的应用程序目录更改为当前正在查看的目录。如果用户在不同的目录中关闭对话框，那么您将被困在该目录中。

它有一个名为[RestoreDirectory](http://msdn.microsoft.com/en-us/library/system.windows.forms.filedialog.restoredirectory(VS.85).aspx)的属性，它会导致对话框重置路径。但我相信默认值为“假”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T15:32:44.750

如果文件始终位于相对于可执行程序集的路径中，那么可以，使用 Assembly.Location。我主要使用 Assembly.GetExecutingAssembly（如果适用）而不是 Assembly.GetEntryAssembly。这意味着如果您从 DLL 访问文件，则路径将相对于 DLL 路径。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T15:33:03.610

我认为教训应该是不要依赖相对路径，它们容易出错。当前目录可以通过运行过程中的任意数量的东西来更改，例如文件对话框（尽管有一个属性可以防止它们更改它），因此除非您使用从已知路径（如 Application.StartupPath（尽管从 Visual Studio 启动时要小心）或其他一些已知路径）生成固定路径的相对路径。

使用相对路径会使您的代码难以维护，因为项目中完全不相关部分的更改可能会导致另一部分失败。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T15:36:46.770

在 System.Environment 中，您有[SpecialFolder](http://msdn.microsoft.com/en-us/library/system.environment.specialfolder.aspx)枚举，这将帮助您获得标准的相对路径。

至少通过这种方式，路径是在内部获取并返回给您的，因此希望如果系统以某种方式更改路径，代码会处理它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T15:44:49.417

如果你做类似的事情

> cd c:\文件夹 1

c:\文件夹 1 > ../文件夹 2/theApplication.exe

应用程序的当前工作目录将是 c:\folder 1 。

这是一个示例程序

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace CWD {
    class Program {
        static void Main (string[] args) {
            Console.WriteLine(Application.StartupPath);
        }
    }
} 
```

在 visualstudio 中构建它，然后在 debug/bin 目录中打开命令提示符并执行

bin/调试 > CWD.exe

然后做

bin/debug > cd ../../ > bin/debug/CWD.exe

您将看到启动路径的差异。

关于原始问题......“如果单独放置大约 5 小时，应用程序将抛出 FileNotFoundException”

应用程序运行后，只有从预期位置移动或删除该文件才会导致此错误。

格雷格

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T15:36:45.537

如果您使用 openfiledialog 并且记住路径属性（不确定确切名称）为真，那么我认为它将更改您的当前目录。

# c++ - 你如何为 x64 编译 OpenSSL？

> ID：158232
> 
> 赞同：19
> 
> 时间：2008-10-01T15:30:18.517
> 
> 标签：c++, c, windows, 64-bit, win64

按照 INSTALL.W64 中的说明操作后，我遇到了两个问题：

*   代码仍然写入“out32”文件夹。我需要能够在我的工作站上链接到 32 位和 64 位版本的库，所以我不希望 64 位版本破坏 32 位库。
*   输出仍然是 32 位的！这意味着在尝试从 x64 应用程序链接到库时出现“未解析的外部符号”错误。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-01T15:33:27.323

要编译静态库（发布和调试），您需要执行以下操作：

1.  安装 Perl - [www.activestate.com](http://www.activestate.com/activeperl/downloads)
2.  运行“Visual Studio 2008 x64 Cross Tools 命令提示符”（注意：常规命令提示符将不起作用。）
3.  用perl配置 配置VC-WIN64A no-shared no-idea
4.  运行：ms\do_win64a
5.  编辑 ms\nt.mak 并将输出目录中的“32”更改为“64”：

```
    # 所有有趣的东西的输出目录
    OUT_D=out64.dbg
    # 所有临时垃圾的输出目录
    TMP_D=tmp64.dbg
    # 头文件的输出目录
    INC_D=inc64
    INCO_D=inc64\openssl

```

5.  如果您收到有关它的错误，请编辑 ms\nt.mak 并从 EX_LIBS 中删除 bufferoverflowu.lib。
6.  运行：nmake -f ms\nt.mak
7.  编辑 ms\do_win64a 文件并将“调试”添加到所有行，除了“ml64”和最后两行
8.  运行：ms\do_win64a
9.  重复步骤 4 和 5
10.  编辑 ms\nt.mak 文件并将 /Zi 添加到 CFLAG 列表中！
11.  运行：nmake -f ms\nt.mak

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-11-21T19:38:43.593

我使用 1.0.1c 源以这种方式解决了这个问题：

将此块添加到`util/pl/VC-32.pl`，就在该`$o='\\';`行之前。

```
if ($debug)
    {
    $ssl .= 'd';
    $crypto .= 'd';
    } 
```

将此块添加到`util/pl/VC-32.pl`，就在该`if ($debug)`行之前。

```
if ($FLAVOR =~ /WIN64/)
    {
    $out_def =~ s/32/64/;
    $tmp_def =~ s/32/64/;
    $inc_def =~ s/32/64/;
    } 
```

然后构建所有品种：

```
setenv /x86 /release
perl Configure VC-WIN32  --prefix=build -DUNICODE -D_UNICODE
ms\do_ms
nmake -f ms\ntdll.mak

setenv /x64 /release
perl Configure VC-WIN64A --prefix=build
ms\do_win64a.bat
nmake -f ms\ntdll.mak

setenv /x86 /debug
perl Configure debug-VC-WIN32  --prefix=build -DUNICODE -D_UNICODE
ms\do_ms
move /y ms\libeay32.def ms\libeay32d.def
move /y ms\ssleay32.def ms\ssleay32d.def
nmake -f ms\ntdll.mak

setenv /x64 /debug
perl Configure debug-VC-WIN64A --prefix=build
ms\do_win64a.bat
move /y ms\libeay32.def ms\libeay32d.def
move /y ms\ssleay32.def ms\ssleay32d.def
nmake -f ms\ntdll.mak 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-06-02T00:12:26.020

使用[柯南](https://www.conan.io/)。安装和使用非常简单。

您可以请求准备好使用的文件。例如对于 Linux x64 或与 Visual Studio 2012 一起使用。这里有一个示例说明：

`conan install OpenSSL/1.0.2g@lasote/stable -s arch="x86_64" -s build_type="Debug" -s compiler="gcc" -s compiler.version="5.3" -s os="Linux" -o 386="False" -o no_asm="False" -o no_rsa="False" -o no_cast="False" -o no_hmac="False" -o no_sse2="False" -o no_zlib="False" ...`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-12-03T16:59:09.627

在撰写本指南时，OpenSSL 的最新版本是 1.1.1a。

环境：

*   视窗 10
*   微软视觉工作室 2017

先决条件：

*   安装[ActivePerl](https://www.activestate.com/products/activeperl/downloads/) - 社区版很好
*   安装[NASM](https://nasm.us/)

> 确保 Perl 和 NASM 都在 PATH 环境变量中。

编译 x64：

1.  打开 x64 本机工具命令提示符
2.  perl 配置 VC-WIN64A --prefix=e:\projects\bin\OpenSSL\vc-win64a --openssldir=e:\projects\bin\OpenSSL\SSL
3.  制作
4.  nmake 测试
5.  制作安装

> 第 4 步是可选的。

编译 x86：

1.  打开 x86 Native Tools 命令提示符
2.  perl 配置 VC-WIN32 --prefix=e:\projects\bin\OpenSSL\vc-win32 --openssldir=e:\projects\bin\OpenSSL\SSL
3.  制作
4.  nmake 测试
5.  制作安装

> 第 4 步是可选的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-07-30T00:08:33.913

根据官方文档：

“您可能会感到惊讶：64 位人工制品确实在 out32* 子目录中输出，并且名称以 *32.dll 结尾。事实上，到目前为止，64 位编译目标是对传统 32 位 Windows 目标的增量更改。大量编译标志仍然标记为“32”，尽管它们确实适用于 32 位和 64 位目标。”

因此，不再需要第一个答案。

说明可以在这里找到：

[https://wiki.openssl.org/index.php/Compilation_and_Installation#W64](https://wiki.openssl.org/index.php/Compilation_and_Installation#W64)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-07T11:00:06.330

如果您在 cygwin 中构建，则可以使用以下脚本，假设 MSDEVPATH 已设置为您的 Visual Studio 目录

```
 echo "Building x64 OpenSSL"
 # save the path of the x86 msdev
 MSDEVPATH_x86=$MSDEVPATH
 # and set a new var with x64 one
 MSDEVPATH_x64=`cygpath -u $MSDEVPATH/bin/x86_amd64`

 # now set vars with the several lib path for x64 in windows mode
 LIBPATH_AMD64=`cygpath -w $MSDEVPATH_x86/lib/amd64`
 LIBPATH_PLATFORM_x64=`cygpath -w $MSDEVPATH_x86/PlatformSDK/lib/x64`
 # and set the LIB env var that link looks at
 export LIB="$LIBPATH_AMD64;$LIBPATH_PLATFORM_x64"

 # the new path for nmake to look for cl, x64 at the start to override any other msdev that was set previously
 export PATH=$MSDEVPATH_x64:$PATH

 ./Configure VC-WIN64A zlib-dynamic --prefix=$OUT --with-zlib-include=zlib-$ZLIB_VERSION/include --with-zlib-lib=zlib-$ZLIB_VERSION/x64_lib

 # do the deed
 ms/do_win64a.bat
 $MSDEVPATH_x86/bin/nmake -f ms/ntdll.mak  ${1:-install} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-10-12T14:23:56.410

自最初提出此问题以来，构建说明已更改。可以在[此处](https://stackoverflow.com/a/39247560)找到新说明。请注意，您需要安装 perl 和 NASM，并且需要使用开发人员命令提示符。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-04-18T10:11:27.880

You can also use MSYS+[mingw-w64](http://mingw-w64.sourceforge.net):

1) download and extract msys to C:\msys
2) download and extract mingw-w64 to c:\mingw64
3) run msys postinstall script. When it asks for your mingw installation, point it to C:\mingw64\bin
4) Extract an openssl daily snapshot (1.0.0 release has a bug). In the source dir run configure mingw64
make
make check
make install
5) openssl is installed to /local/

# php - PHP：用 UTF-8 字符串中最接近的 7 位 ASCII 等效替换变音符号

> ID：158241
> 
> 赞同：48
> 
> 时间：2008-10-01T15:32:41.133
> 
> 标签：php, utf-8, diacritics, strtr

我想要做的是从字符串中删除所有重音和变音符号，将“lärm”变成“larm”或“andré”变成“andre”。我试图做的是 utf8_decode 字符串，然后在其上使用 strtr，但由于我的源文件保存为 UTF-8 文件，我无法为所有变音符号输入 ISO-8859-15 字符 - 编辑器插入UTF-8 字符。

显然，解决这个问题的方法是包含一个 ISO-8859-15 文件，但必须有比拥有另一个必需的包含更好的方法吗？

```
echo strtr(utf8_decode($input), 
           'ŠŒŽšœžŸ¥µÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýÿ',
           'SOZsozYYuAAAAAAACEEEEIIIIDNOOOOOOUUUUYsaaaaaaaceeeeiiiionoooooouuuuyy'); 
```

**更新：**也许我对我尝试做的事情有点不准确：我实际上并不想删除变音符号，而是用最接近的“单字符 ASCII”等价物替换它们。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-10-01T15:38:45.407

```
iconv("utf-8","ascii//TRANSLIT",$input); 
```

扩展[示例](http://php.net/manual/en/function.iconv.php#83238)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2011-05-10T13:14:15.273

一个不需要设置语言环境或拥有巨大翻译表的小技巧：

```
function Unaccent($string)
{
    if (strpos($string = htmlentities($string, ENT_QUOTES, 'UTF-8'), '&') !== false)
    {
        $string = html_entity_decode(preg_replace('~&([a-z]{1,2})(?:acute|cedil|circ|grave|lig|orn|ring|slash|tilde|uml);~i', '$1', $string), ENT_QUOTES, 'UTF-8');
    }

    return $string;
} 
```

它正常工作的唯一要求是将文件保存在 UTF-8 中（您应该已经这样做了）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-02-03T13:12:13.483

你也可以试试这个

```
$string = "Fóø Bår";
$transliterator = Transliterator::createFromRules(':: Any-Latin; :: Latin-ASCII; :: NFD; :: [:Nonspacing Mark:] Remove; :: Lower(); :: NFC;', Transliterator::FORWARD);
echo $normalized = $transliterator->transliterate($string); 
```

但你需要有[http://php.net/manual/en/book.intl.php](http://php.net/manual/en/book.intl.php)可用

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T15:33:49.163

好的，我自己找到了一个明显的解决方案，但这并不是最好的性能......

```
echo strtr(utf8_decode($input), 
           utf8_decode('ŠŒŽšœžŸ¥µÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýÿ'),
           'SOZsozYYuAAAAAAACEEEEIIIIDNOOOOOOUUUUYsaaaaaaaceeeeiiiionoooooouuuuyy'); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-01T14:15:27.957

如果您使用的是 WordPress，则可以使用内置功能`remove_accents( $string )`

[https://codex.wordpress.org/Function_Reference/remove_accents](https://codex.wordpress.org/Function_Reference/remove_accents)

但是我注意到一个错误：它不适用于具有单个字符的字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-08T11:55:29.880

对于阿拉伯语和波斯语用户，我推荐这种方式来删除变音符号：

```
 $diacritics = array('َ','ِ','ً','ٌ','ٍ','ّ','ْ','ـ');
    $search_txt = str_replace($diacritics, '', $diacritics); 
```

要在阿拉伯语键盘中输入变音符号，您可以在 Windows 编辑器中使用此 Asci（这些代码是 Asci 而不是 Unicode）代码直接输入变音符号或按住 Alt +（输入变音符号的代码）这是代码

ـَ(0243) ـِ(0246) ـُ(0245) ـً(0240) ـٍ(0242) ـٌ(0241) ـْ(0250) ـّ(0248) ـ ـ(0220)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-24T00:18:50.433

我发现这个在法语和德语中给出了最一致的结果。将元标记设置为`utf-8`，我将它放在一个函数中以从单词数组中返回一行，并且效果很好。

```
htmlentities (  $line, ENT_SUBSTITUTE   , 'utf-8' ) 
```

# c# - 什么是最好的免费、兼容 Ajax.NET (System.Web.Extensions 3.5) 的富文本框控件？

> ID：158256
> 
> 赞同：6
> 
> 时间：2008-10-01T15:35:58.910
> 
> 标签：c#, asp.net, .net-3.5, richtext, ajax.net

我正在寻找一个很好的 ASP.NET RichTextBox 组件，它可以很容易地与 .NET Framework 3.5 Ajax 集成，特别是可以轻松地从 UpdatePanel 中提供其值的组件。

我被 RicherComponents RichTextBox 烧毁了，它仍然没有引用 Framework 3.5。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T15:44:57.467

查看 FCKEditor 以获得免费解决方案。我不确定它是否可以在更新面板中使用，但它是免费且开源的。

[http://www.fckeditor.net/](http://www.fckeditor.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:51:44.983

如果您考虑使用 HTML 编辑器而不是富文本格式编辑器，我推荐 Telerik Web 编辑器。它非常灵活，并且与 Ajax 集成得非常牢固。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T15:58:20.040

根据 craigmoliver 的回答进行谷歌搜索，发现： [http ://www.webcitation.org/5bFQaq7Wp](http://www.webcitation.org/5bFQaq7Wp)

基本上，这是一个允许 FCKEditor 在更新面板中工作的解决方案，如果它工作，我将尝试发布。

# asp.net - 从 localhost 到 localhost 的 WebRequest：为什么被拒绝？

> ID：158257
> 
> 赞同：0
> 
> 时间：2008-10-01T15:36:08.860
> 
> 标签：asp.net, security, configuration, webrequest

我的应用在某些时候使用 WebRequest 从自身获取页面。

这应该不是问题。它实际上在服务器上运行良好，这是一个具有中等信任的“共享”托管包。在本地，我使用基于中等信任的自定义安全策略，其中包括以下内容 - 直接从默认的中等信任策略复制：

```
<IP权限
  类="WebPermission"
  版本="1">
    <连接访问>
        <URI uri="$OriginHost$"/>
    </连接访问>
</IPermission>

```

违规行位于自定义 XmlRelativeUrlResolver 中：

```
public override object GetEntity( System.Uri puriAbsolute, string psRole, System.Type pReturnType )
{
    return _baseResolver.GetEntity( puriAbsolute, psRole, pReturnType );
} 
```

被请求的 url 位于本地主机上，与请求者在同一个应用程序中。这是堆栈跟踪的顶部。

```
在 System.Security.CodeAccessSecurityEngine.Check（对象需求，StackCrawlMark& stackMark，布尔 isPermSet）
   在 System.Security.CodeAccessPermission.Demand()
   在 System.Net.HttpWebRequest..ctor（Uri uri，ServicePoint 服务点）
   在 System.Net.HttpRequestCreator.Create(Uri Uri)
   在 System.Net.WebRequest.Create（Uri requestUri，布尔值 useUriBase）
   在 System.Net.WebRequest.Create(Uri requestUri)
   在 System.Xml.XmlDownloadManager.GetNonFileStream（Uri uri，ICredentials 凭据）
   在 System.Xml.XmlDownloadManager.GetStream（Uri uri，ICredentials 凭据）
   在 System.Xml.XmlUrlResolver.GetEntity（Uri absoluteUri，字符串角色，ObjectToReturn 类型）
   在 c:\flow\source\controls\DataTransform.cs:line 105 中的 flow.controls.XmlRelativeUrlResolver.GetEntity(Uri puriAbsolute, String psRole, Type pReturnType)
   在 System.Xml.Xsl.Xslt.XsltLoader.CreateReader（Uri uri，XmlResolver xmlResolver）
```

有人在这里看到问题吗？

@Sijin：谢谢你的建议。发送到解析器的 url 基于请求 URL，我在调试器中确认访问 127.0.0.1 的站点会产生相同的结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T15:38:22.337

如果您放置 127.0.0.1 而不是 localhost，它会起作用吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:17:09.137

我的无知。我不知道 $OriginHost$ 令牌是使用信任级别的 originUrl 属性替换的——我以为它只是来自应用程序的 url。我最初将此属性留空。

```
<trust level="CustomMedium" originUrl="http://localhost/" />

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:58:55.657

这可能不是解决方案，但是当我看到您的帖子时，我想起了大约一年前遇到的这个问题：

> [http://support.microsoft.com/default.aspx/kb/896861](http://support.microsoft.com/default.aspx/kb/896861)
> 
> 当您浏览使用集成身份验证并托管在 IIS 5.1 或 IIS 6 上的网站时，您会收到错误 401.1

我们正在创建一个 WebRequest 来筛选页面，它在我们的生产环境中工作，因为我们没有使用环回主机名，但在开发机器上我们最终被拒绝访问（在应用 Windows Server 2003 SP2 之后）。这里的一个区别是这是在集成身份验证下导致它失败......当请求是匿名的时它工作（这就是为什么我不确定这是你的答案）。

# python - Python 模块依赖

> ID：158268
> 
> 赞同：19
> 
> 时间：2008-10-01T15:38:58.217
> 
> 标签：python, module, circular-dependency

好的，我有两个模块，每个模块都包含一个类，问题是它们的类相互引用。

比如说，我有一个房间模块和一个包含 CRoom 和 CPerson 的人员模块。

CRoom 类包含有关房间的信息，以及房间中每个人的 CPerson 列表。

然而，CPerson 类有时需要将 CRoom 类用于其所在的房间，例如寻找门，或者查看房间里还有谁。

问题是两个模块相互导入我只是收到一个导入错误，第二个导入的是哪个模块:(

在 c++ 中，我可以通过仅包含标头来解决此问题，并且由于在这两种情况下，类都只有指向另一个类的指针，因此前向声明对于标头就足够了，例如：

```
class CPerson;//forward declare
class CRoom
{
    std::set<CPerson*> People;
    ... 
```

除了将两个类放在同一个模块或类似的东西中之外，是否有在 python 中执行此操作？

编辑：添加了显示使用上述类的问题的 python 示例

错误：

> 回溯（最后一次调用）：
> 文件“C:\Projects\python\test\main.py”，第 1 行，
> 从房间导入 Croom
> 文件“C:\Projects\python\test\room.py”，第 1 行，
> 从人导入 CPerson
> 文件“C:\Projects\python\test\person.py”，第 1 行，
> 从房间导入CRoom
> ImportError: cannot import name
> CRoom room.py

```
from person import CPerson

class CRoom:
    def __init__(Self):
        Self.People = {}
        Self.NextId = 0

    def AddPerson(Self, FirstName, SecondName, Gender):
        Id = Self.NextId
        Self.NextId += 1#

        Person = CPerson(FirstName,SecondName,Gender,Id)
        Self.People[Id] = Person
        return Person

    def FindDoorAndLeave(Self, PersonId):
        del Self.People[PeopleId] 
```

人.py

```
from room import CRoom

class CPerson:
    def __init__(Self, Room, FirstName, SecondName, Gender, Id):
        Self.Room = Room
        Self.FirstName = FirstName
        Self.SecondName = SecondName
        Self.Gender = Gender
        Self.Id = Id

    def Leave(Self):
        Self.Room.FindDoorAndLeave(Self.Id) 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-01T16:11:41.477

**无需导入 C Room**

你不使用`CRoom`in `person.py`，所以不要导入它。由于动态绑定，Python 不需要“在编译时查看所有类定义”。

如果您确实*使用*in `CRoom`，`person.py`则更`from room import CRoom`改为`import room`并使用 module-qualified form `room.CRoom`。有关详细信息，请参阅[Effbot 的循环导入](http://effbot.org/zone/import-confusion.htm#circular-imports)。

*旁注：*你可能有一个错误`Self.NextId += 1`。它递增`NextId`实例，而不是`NextId`类。增加类的计数器使用`CRoom.NextId += 1`or `Self.__class__.NextId += 1`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T15:52:34.330

你真的需要在类定义时引用这些类吗？IE。

```
 class CRoom(object):
     person = CPerson("a person") 
```

或者（更有可能），您是否只需要在您的类的方法中使用 CPerson（反之亦然）。例如：

```
class CRoom(object):
    def getPerson(self): return CPerson("someone") 
```

如果是第二个，则没有问题 - 因为当方法被**调用**而不是定义时，模块将被导入。您唯一的问题是如何引用它。您可能正在做类似的事情：

```
from CRoom import CPerson # or even import * 
```

使用循环引用模块，您不能这样做，因为在一个模块导入另一个模块时，原始模块主体不会完成执行，因此命名空间将不完整。相反，使用合格的引用。IE：

```
#croom.py
import cperson
class CRoom(object):
    def getPerson(self): return cperson.CPerson("someone") 
```

在这里，python 不需要在名称空间上查找属性，直到方法实际被调用，此时两个模块都应该完成它们的初始化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T16:30:26.470

首先，用大写字母命名你的参数是令人困惑的。由于 Python 没有正式的静态类型检查，我们使用`UpperCase`来表示类和`lowerCase`参数。

其次，我们不理会 C Room 和 CPerson。大写足以表明它是一个类。不使用字母 C。 `Room`. `Person`.

第三，我们通常不把东西放在**每个文件一个类**的格式中。文件是一个 Python 模块，我们更经常导入包含所有类和函数的整个模块。

[我知道这些都是习惯——你今天不需要打破它们，但它们确实让人难以阅读。]

Python 不使用像 C++ 这样的静态定义类型。当您定义一个方法函数时，您并没有正式定义该函数参数的数据类型。您只需列出一些变量名称。希望客户端类将提供正确类型的参数。

在运行时，当您发出方法请求时，Python 必须确保对象具有该方法。笔记。Python 不会检查对象是否是正确的类型——这无关紧要。它只检查它是否有正确的方法。

`room.Room`和之间的循环`person.Person`是个问题。在定义另一个时，您不需要包含一个。

导入整个模块是最安全的。

这里是`room.py`

```
import person
class Room( object ):
    def __init__( self ):
        self.nextId= 0
        self.people= {}
    def addPerson(self, firstName, secondName, gender):
        id= self.NextId
        self.nextId += 1

        thePerson = person.Person(firstName,secondName,gender,id)
        self.people[id] = thePerson
        return thePerson 
```

只要 Person 最终在执行它的名称空间中定义，就可以正常工作。定义类时不必知道人员。

在计算 Person(...) 表达式之前，不必知道 Person 。

这里是`person.py`

```
import room
class Person( object ):
    def something( self, x, y ):
        aRoom= room.Room( )
        aRoom.addPerson( self.firstName, self.lastName, self.gender ) 
```

你`main.py`看起来像这样

```
import room
import person
r = room.Room( ... )
r.addPerson( "some", "name", "M" )
print r 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T15:53:19.257

你可以给第二个起别名。

```
import CRoom

CPerson = CRoom.CPerson 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T16:55:17.220

@S.Lott 如果我没有将任何内容导入房间模块，我会收到一个未定义的错误（我将它导入到主模块中，就像你展示的那样）

> 回溯（最后一次调用）：
> 文件“C:\Projects\python\test\main.py”，第 6 行，在
> Ben = Room.AddPerson('Ben', 'Blacker', 'Male')
> 文件“C: \Projects\python\test\room.py"，第 12 行，在 AddPerson
> Person = CPerson(FirstName,SecondName,Gender,Id)
> NameError: global name 'CPerson' is not defined

此外，存在不同模块的原因是我从容器类（例如房间）开始遇到问题的地方已经有几百行，所以我希望其中的项目（例如人）在一个单独的文件中。

编辑：main.py

```
from room import CRoom
from person import CPerson

Room = CRoom()

Ben = Room.AddPerson('Ben', 'Blacker', 'Male')
Tom = Room.AddPerson('Tom', 'Smith',   'Male')

Ben.Leave() 
```

# reporting-services - 在报表管理器中看不到子报表

> ID：158277
> 
> 赞同：0
> 
> 时间：2008-10-01T15:41:07.867
> 
> 标签：reporting-services, subreport, reportmanager

我一直在学习[本教程](http://msdn.microsoft.com/en-us/library/aa337460(SQL.90).aspx)（第 6 课），以便构建和部署带有嵌入式子报表的示例报表，该子报表从父报表中读取其参数值。此子报表嵌入在报表表的组行之一中，并且两者共享相同的数据源。此外，在用户为表中的每组数据按下 (+) 按钮之前，详细信息行会显示为折叠状态。

当我在商业智能开发工作室（顺便说一下，SQL 2005 Express 版）中预览它时，该报表效果很好，但是**当我部署它并尝试在报表管理器中查看时，子报表没有显示**。而且，如果我按下 (+) 按钮，则会出现以下消息：

> *未指定某些参数或凭据*

有人知道我做错了什么吗？为什么它在 Visual Studio 中嵌入的报表查看器中可以完美运行，但在报表管理器 Web 应用程序中却不行？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:08:31.950

子报表是否使用与父报表相同的数据源？如果不是，请务必检查子报表的数据源以确保其正确。签入报告管理器，而不是您的本地副本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T10:48:48.967

我开始认为这可能是浏览器的问题。我目前正在使用 Internet Explorer 8 Beta，并且我还遇到了来自报告管理器的奇怪行为。我尝试过使用 Google Chrome 和 Firefox 3，虽然导航不如我喜欢的流畅，但问题似乎已解决。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-12T21:52:56.027

当您使用 IE8 作为报表浏览器时会发生这种情况。我遇到了同样的问题，当我在 chrome 上进行测试时，它运行良好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T07:50:42.913

这可能相关也可能不相关，但前段时间我遇到了类似的问题（除了在我的情况下，报告是通过自定义网页访问的），结果我们有一个旧版本的报告查看器控件（版本Sql 2005 RTM 附带）。升级到最新版本后，问题就消失了。

# silverlight - 使用 Silverlight B2 和 RC0

> ID：158278
> 
> 赞同：2
> 
> 时间：2008-10-01T15:41:19.893
> 
> 标签：silverlight, upgrade, silverlight-2-rc0

我一直在阅读有关 Silverlight 的新的仅限开发人员的 RC0，以及它应该仅由开发人员用于解决从 beta 2 升级时的任何重大更改的事实，因此当实际的 S2 发布时，迁移是更顺畅。

我的问题是，既然你应该在 VS2008 中卸载 B2 工具并安装 RC0，有没有办法在保持 RC0 分支的同时为现有的 B2 应用程序提供支持和错误修复？

或者唯一可能的做法是让一个带有 VS2008 和 B2 的 VM 用于处理 B2 应用程序，直到 RC 实际发布？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T15:53:11.270

到目前为止，VM 确实是我听说过的唯一解决方案。希望我们不会在这种困境中停留太久。

为了使 VM 更小，您可以做的一件事是，如果您在 VM 上执行 RC0 操作，则可以在其中使用 Visual Web Developer Express 2008 SP1，而不是完整的 Visual Studio。不幸的是，您不能在 VWD Express 上做相反的事情并做 Beta 2 的事情。

# php - 如何在 PHP 中安装 MySQL 模块？

> ID：158279
> 
> 赞同：2
> 
> 时间：2008-10-01T15:41:37.693
> 
> 标签：php, mysql, windows

我已经更新了**php.ini**并移动了**php_mysql.dll**，如此处[第 6 步和第 8 步中所述。](https://stackoverflow.com/questions/11919/how-do-i-get-php-and-mysql-working-on-iis-70#94341)

我得到这个错误…

```
致命错误：调用 C:\inetpub 中未定义的函数 mysql_connect()...
```

MySQL 没有出现在我的**phpinfo 中；**报告。

* * *

我已经更新了**c:\Windows\php.ini**文件

```
; 可加载扩展（模块）所在的目录。  
extension_dir = "./"
```

到

```
; 可加载扩展（模块）所在的目录。  
extension_dir = ".;c:\Windows\System32"
```

结果：没有变化。

* * *

我因此更改了extension_dir的**php.ini值：**

```
extension_dir = "C:\Windows\System32"
```

**结果： phpinfo**中有更多内容；报告，但 MySQL 仍然无法正常工作。

* * *

我将文件**libmysql.dll**从文件夹**C:\php**复制到文件夹**C:\Windows\System32**和**C:\Windows**

结果：没有变化。

* * *

我停止并**重新启动 IIS**。

结果：新的、不同的错误！

```
警告：mysql_connect() [function.mysql-connect]：访问被拒绝  
C:\inetpub\... 中的用户 '...'@'localhost'（使用密码：YES）
查询错误。
```

```
致命错误：在非对象上调用成员函数 RecordCount()  
在 C:\inetpub\...
```

* * *

我在网站中发现了几个 .php 文件，我必须在其中设置变量：

```
$db_user  
$db_pass
```

结果：该网站有效！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:36:06.813

正如其他人所说，php.ini 中的这两个值至关重要。

我的 php.ini 中有以下内容：注意尾部斜杠 - 不确定是否需要它 - 但它确实有效。

```
extension_dir = "H:\apps\php\ext\"
extension=php_mysql.dll 
```

此外，值得确保您的机器上只有一份 php.ini 副本 - 我遇到了问题，我一直在编辑 php.ini 文件，而 php 没有使用该文件并且非常沮丧，直到我意识到.

此外，如果 php 作为 apache 中的一个模块运行，您将需要重新启动 apache 服务器以获取更改。如果您不确定，无论如何都应该这样做。

cmd 提示符下的“php -m”将显示从 ini 文件加载的模块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T15:46:06.497

在php.ini文件中，检查扩展路径配置是否有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T16:15:27.473

您还需要在 php.ini 中启用 extension=php_mysql.dll 选项。另外，请确保该文件位于您设置的 extension_dir 中。

你可以阅读更多关于它的信息：

[http://us3.php.net/manual/en/install.windows.extensions.php](http://us3.php.net/manual/en/install.windows.extensions.php)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T03:14:03.207

在完全不同的情况下，我可以建议[WampServer](http://www.wampserver.com/en/index.php)吗？它应该让您立即启动并运行 Apache/PHP/MySQL 安装。

您甚至可以将 WampServer 配置文件与您自己的配置文件进行比较，以了解您最初出错的地方。

# directx - DirectSound 是 Windows 的最佳音频抽象层吗？

> ID：158282
> 
> 赞同：4
> 
> 时间：2008-10-01T15:42:02.653
> 
> 标签：directx, audio, directsound

DirectSound 是 Windows 的最佳音频抽象层吗？将我的应用程序从构建到特定芯片组的非常糟糕的声音实现切换到抽象层。

应用程序是本机 Winform，.net 3.5。DirectX/DirectSound 是可能的选择，但有点担心开销。还有其他选择吗？或者考虑其他事情是愚蠢的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T15:48:40.627

DirectSound 现在不像过去那样受到微软的喜爱。就 DirectX 而言，您可以尝试 XAudio2 或 XACT。有些人喜欢那些，有些人讨厌他们。XAudio2 更底层，而 XACT 则相当高级。两者都可以从 Microsoft XNA 访问，它类似于 Managed DirectX，但正在积极开发中。

但是你并不局限于使用 DirectX 附带的东西。如果您想要很棒的东西，请尝试[FMod 。](http://www.fmod.org/)他们仍然有共享软件/爱好者许可模式和免费软件许可模式，以防您不想花大价钱。

您的选择取决于您想要对声音做什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:46:47.917

看看[SDL](http://www.libsdl.org/)是否看起来更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T16:36:48.887

好吧，你可以试试[OpenAL](http://connect.creativelabs.com/openal/default.aspx)。OpenGL 之于 Direct3D 就是 OpenAL 之于 DirectSound(3D)。该界面与 OpenGL 非常相似，如果您不喜欢它，您可能也会不喜欢 OpenAL。此外，我不确定这个库的 Windows 版本是自己的、本机实现还是只是调用 DirectSound，因此可能只是它上面的一个（薄？）包装器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T15:58:51.210

DirectSound 很不错。

如果您需要低延迟或同时通过多个声卡对声音输入和输出提供良好支持，您可能还想看看 ASIO：

[http://de.wikipedia.org/wiki/Audio_Stream_Input/Output](http://de.wikipedia.org/wiki/Audio_Stream_Input/Output)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T16:10:33.787

**waveOut... API**仍然是一个选项。从托管代码中处理起来很棘手，但是您可以通过这种方式一次播放多个声音（至少在 XP 和 Vista 中）。

如果你只是偶尔需要播放声音，**System.Media.SoundPlayer**非常好用。但是，您不能使用此组件一次播放多个声音。

DirectSound 是您唯一的其他主要选择。它有一个内置的软件合成器，如果你需要的话。

编辑：SDL 看起来很有趣。谢谢，思进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-22T03:55:21.323

[SharpDX](http://code.google.com/p/sharpdx/)看起来很有趣。由于后者的 x86 限制，我计划尝试将其作为托管 DirectX 的替代品。

# windows-vista - IE7 在 Vista 上检测为 IE6...为什么？

> ID：158283
> 
> 赞同：1
> 
> 时间：2008-10-01T15:42:11.687
> 
> 标签：windows-vista, internet-explorer-6, internet-explorer-7, user-agent

我有两台vista Business 机器。我在两者上都安装了 IE 7。在我的第一台机器（Computer1）上，如果我访问这个站点（[http://www.quirksmode.org/js/detect.html](http://www.quirksmode.org/js/detect.html)），它会说我正在使用“Windows 上的 Explorer 6”。如果我将 Computer2 与 Vista Business 和 IE7 一起使用，它会显示我正在使用“Windows 上的 Explorer 7”。这是一个屏幕[截图](http://www.rickdoes.net/blog/images/ie6.png)。两台机器上的 IE 版本相同。有人有解决方案吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:08:23.153

```
Computer1: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; InfoPath.2; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618; MS-RTC LM 8; .NET CLR 1.1.4322) Rick Kierner (11 minutes ago)
Computer2: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; .NET CLR 3.0.04506; InfoPath.2; .NET CLR 3.5.21022)  Rick Kierner (10 minutes ago) 
```

Computer1 的用户代理中似乎有一些垃圾，它`Mozilla/4.0 (compatible...)`使用 MSIE 6.0 信息（以及不匹配的右括号）重复信息。也就是说，我通过您链接到的页面上提供的脚本运行您的用户代理，它以 Explorer 7 的形式返回，所以我不确定为什么它在页面本身上失败。

无论如何，请检查您的注册表以获取可以删除的其他用户代理信息`[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\ Internet Settings\5.0\User Agent]`（是的，即使您拥有 Internet Explorer 7，它也位于“5.0”下）。请注意，这是 Windows XP 中的位置，我假设它在 Windows Vista 中是相同的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T15:45:31.820

您可以发布两台机器的用户代理吗？（你可以去一些显示用户代理的网站，即[这个](http://www.hanselman.com/smallestdotnet/)，在最底部）。

我认为这是 Quirksmode 网站上与用户 gaent 一起出现的错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T15:48:20.813

你在两台机器上使用相同版本的 IE7 吗？如果版本不同，则脚本可能由于某种原因无法识别一个版本，而只是默认将 IE6 作为最低公分母。可能其中一台机器的 IE 版本没有完全遵守规则，并且脚本很难处理它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T16:10:43.943

检查注册表项 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\User Agent\Post Platform] 和 [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\ Internet Settings\5.0\User Agent\Post Platform]

某些软件会在此处添加其他值，这很好，除非您指定用户代理字符串。在这种情况下，大多数浏览器检测将触发并检测它们找到的最后一个值。

通常，这些值将位于“用户代理”键或“发布平台”键中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T21:59:20.017

我找到了注册表项：

HKEY_USERS\S-1-5-21-817507923-1393677948-3603797094-1205\Software\Microsoft\Windows\CurrentVersion\Internet Settings\User Agent\Post Platform

它有

> “Mozilla/4.0（兼容；MSIE 6.0；Windows NT 5.1；SV1）”

价值。删除后，我的浏览器被识别为 IE 7

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T16:10:16.550

这只是一个猜测，但您明确发布的第一个字符串在查询字符串中包含“MSIE 6.0”。如果该站点是惰性的并且没有正确解析字符串，则可能会覆盖前面字符串中的“MSIE 7.0”，并给您一个错误的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T14:15:25.827

我找到了 IE6 注册表项。我可以删除它而不会在我的电脑上造成问题吗？HKEY_USERS\S-1-5-21-117609710-1647877149-839522115-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\User Agent\Post Platform 我在其中找到以下内容：Mozilla/4.0（兼容；MSIE 6.0；Windows新台币 5.1；SV1)

我安装了 IE7 并且能够使用大多数 facebook 等项目。有人向我指出，我似乎有两个版本都处于活动状态，如果我不解决这个问题，可能会遇到问题。

如果这可能导致一系列新问题，我不想删除注册表项！谢谢

# oracle - 用于将 Oracle PL/SQL 转换为 Postgresql PL/pgSQL 的工具

> ID：158310
> 
> 赞同：8
> 
> 时间：2008-10-01T15:48:23.200
> 
> 标签：oracle, postgresql, plsql, translation, plpgsql

是否有工具（最好是免费的）可以将 Oracle 的 PL/SQL 存储过程语言翻译成 Postgresql 的 PL/pgSQL 存储过程语言？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T15:58:36.717

[http://ora2pg.darold.net/](http://ora2pg.darold.net/)上有一个工具可用于将 Oracle 模式转换为 Postgres 模式，但我不确定它是否也能转换存储过程。但它可能会提供一个开始的地方。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T16:07:45.963

还有[EnterpriseDB](http://www.enterprisedb.com)，它具有相当多的 Oracle 兼容性，以帮助从 Oracle 迁移。与 Oracle 兼容的版本不是免费的，但如果您要做的不仅仅是一个程序翻译，那么值得一看。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-10-25T16:43:19.680

很长一段时间以来一直致力于 Oracle 到 Postgres 的转换。唯一的方法是手工。两种语言之间存在细微的差异，可能会让您大吃一惊。我们尝试使用自动化工具，但它只会让问题变得更糟，我们最终破坏了输出。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-27T21:06:42.207

使用 ora2pg 转换您的架构。

对于存储过程：

1.  手动将所有 DECODE() 转换为 CASE 语句，并将所有旧式 Oracle WHERE (+) 外部联接转换为显式 LEFT OUTER JOIN 语句。我还没有找到执行此操作的工具。
2.  在 PL/PGSQL 中翻译 PL/SQL 函数（见下文）。

如果有人启动了一个 sourceforge 项目来做到这一点，那就太好了。
提示提示...

这就是我对上面（2）的意思：

```
CREATE OR REPLACE FUNCTION trunc(
  parmDate   DATE    ,
  parmFormat VARCHAR ) 
RETURNS date 
AS $$
DECLARE
  varPlSqlFormat VARCHAR;
  varPgSqlFormat VARCHAR;
BEGIN
  varPgSqlFormat := lower(parmFormat);

  IF varPgSqlFormat IN (
    'syyyy' ,
    'yyyy'  ,
    'year'  ,
    'syear' ,
    'yyy'   ,
    'yy'    ,
    'y'     ) THEN
    varPgSqlFormat := 'year';
  ELSEIF varPgSqlFormat IN (
    'month' ,
    'mon'   ,
    'mm'    ,
    'rm'    ) THEN 
    varPgSqlFormat := 'month';
  ELSEIF varPgSqlFormat IN (
    'ddd' ,
    'dd'  ,
    'j'   ) THEN 
    varPgSqlFormat := 'day';
  END IF;

  RETURN DATE_TRUNC(varPgSqlFormat,parmDate);
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION trunc(
  parmDate   DATE) 
RETURNS date 
AS $$
DECLARE
BEGIN
  RETURN DATE_TRUNC('day',parmDate);
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION last_day(in_date date) RETURNS date 
AS $$
DECLARE
BEGIN
  RETURN CAST(DATE_TRUNC('month', in_date) + '1 month'::INTERVAL AS DATE) - 1;
END;
$$ LANGUAGE plpgsql; 
```

# javascript - 单击后退按钮时是否存在跨浏览器 onload 事件？

> ID：158319
> 
> 赞同：190
> 
> 时间：2008-10-01T15:50:36.300
> 
> 标签：javascript, pageload

对于所有主流浏览器（IE 除外），`onload`当页面由于后退按钮操作而加载时不会触发 JavaScript 事件——它只会在页面首次加载时触发。

有人可以指出一些解决此问题的示例跨浏览器代码（Firefox、Opera、Safari、IE ......）吗？我熟悉 Firefox 的`pageshow`事件，但不幸的是 Opera 和 Safari 都没有实现这一点。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-10-14T14:32:27.130

伙计们，我发现 JQuery 只有一个效果：按下后退按钮时页面会重新加载。**这与“准备好**”无关。

这是如何运作的？好吧，JQuery 添加了一个**onunload**事件监听器。

```
// http://code.jquery.com/jquery-latest.js
jQuery(window).bind("unload", function() { // ... 
```

默认情况下，它什么也不做。但不知何故，这似乎触发了 Safari、Opera 和 Mozilla 的重新加载——无论事件处理程序包含什么。

[*编辑(Nickolay)*：这就是它以这种方式工作的原因：[webkit.org](http://webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/)，[developer.mozilla.org](https://developer.mozilla.org/En/Using_Firefox_1.5_caching)。请阅读这些文章（或我在下面单独答案中的摘要），并考虑您是否*真的*需要这样做并让您的用户的页面加载速度变慢。]

不能相信吗？试试这个：

```
<body onunload=""><!-- This does the trick -->
<script type="text/javascript">
    alert('first load / reload');
    window.onload = function(){alert('onload')};
</script>
<a href="http://stackoverflow.com">click me, then press the back button</a>
</body> 
```

使用 JQuery 时，您将看到类似的结果。

您可能想在没有**onunload的情况下与这个进行比较**

```
<body><!-- Will not reload on back button -->
<script type="text/javascript">
    alert('first load / reload');
    window.onload = function(){alert('onload')};
</script>
<a href="http://stackoverflow.com">click me, then press the back button</a>
</body> 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2010-02-07T22:58:50.170

一些现代浏览器（Firefox、Safari 和 Opera，但不包括 Chrome）支持特殊的“后退/前进”缓存（我称之为 bfcache，这是 Mozilla 发明的一个术语），在用户导航返回时涉及。与常规（HTTP）缓存不同，它捕获页面的完整状态（包括 JS、DOM 的状态）。这允许它更快地重新加载页面，并且与用户离开它时完全一样。

`load`从该 bfcache 加载页面时，不应触发该事件。例如，如果您在“加载”处理程序中创建了 UI，并且在初始加载时触发了一次“加载”事件，第二次从 bfcache 重新加载页面时，页面将结束重复的 UI 元素。

这也是为什么添加“卸载”处理程序会阻止页面存储在 bfcache 中（从而使其导航回更慢） - 卸载处理程序可以执行清理任务，这可能会使页面处于不可用状态。

对于需要知道何时离开/返回的页面，Firefox 1.5+ 和修复了[错误 28758](https://bugs.webkit.org/show_bug.cgi?id=28758)的 Safari 版本支持称为“pageshow”和“pagehide”的特殊事件。

参考：

*   Webkit：[http ://webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/](http://webkit.org/blog/516/webkit-page-cache-ii-the-unload-event/)
*   火狐：[https](https://developer.mozilla.org/En/Using_Firefox_1.5_caching) ://developer.mozilla.org/En/Using_Firefox_1.5_caching 。
*   铬：[https ://code.google.com/p/chromium/issues/detail?id=2879](https://code.google.com/p/chromium/issues/detail?id=2879)

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2010-02-19T19:35:07.393

当用户单击后退或前进时，我遇到了我的 js 没有执行的问题。我首先着手阻止浏览器缓存，但这似乎不是问题。我的 javascript 设置为在所有库等加载后执行。我用 readyStateChange 事件检查了这些。

经过一些测试，我发现点击返回的页面中元素的 readyState 不是“加载”而是“完成”。添加`|| element.readyState == 'complete'`到我的条件语句中解决了我的问题。

只是想我会分享我的发现，希望他们会帮助别人。

**编辑完整性**

我的代码如下所示：

```
script.onreadystatechange(function(){ 
   if(script.readyState == 'loaded' || script.readyState == 'complete') {
      // call code to execute here.
   } 
}); 
```

在上面的代码示例中，脚本变量是一个新创建的脚本元素，它已添加到 DOM。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-10-04T15:07:06.000

好的，这是基于ckramer 的初始解决方案和palehorse 的示例的最终解决方案，适用于所有浏览器，包括Opera。如果您将 history.navigationMode 设置为“兼容”，那么 jQuery 的就绪功能将在 Opera 以及其他主要浏览器中的后退按钮操作上触发。

此页面有[更多信息](http://web.archive.org/web/20080213182127/http://www.opera.com/support/search/view/827/)。

例子：

```
history.navigationMode = 'compatible';
$(document).ready(function(){
  alert('test');
}); 
```

我在 Opera 9.5、IE7、FF3 和 Safari 中对此进行了测试，它适用于所有这些版本。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-05-31T23:22:16.640

我无法让上述示例正常工作。我只是想在通过后退按钮返回页面时触发某些修改过的 div 区域的刷新。我使用的技巧是在 div 区域从原始区域更改后立即将隐藏的输入字段（称为“脏位”）设置为 1。当我点击返回时，隐藏的输入字段实际上保留了它的值，所以我可以在 onload 上检查这个位。如果已设置，我会刷新页面（或仅刷新 div）。但是，在原始加载时，未设置该位，因此我不会浪费时间两次加载页面。

```
<input type='hidden' id='dirty'>

<script>
$(document).ready(function() {
  if ($('#dirty').val()) {
    // ... reload the page or specific divs only
  }
  // when something modifies a div that needs to be refreshed, set dirty=1
  $('#dirty').val('1');
});
</script> 
```

每当我单击后退按钮时，它都会正确触发。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-01T16:07:13.187

我可以确认 jQuery 的 ready 事件在 IE 和 FireFox 中有效。这是一个示例：

```
<html>
<head>
    <title>Test Page</title>
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <script type="text/javascript">
            $(document).ready(function () {
               var d = new Date();
               $('#test').html( "Hi at " + d.toString() );
            });
    </script>
</head>
<body>
    <div id="test"></div>
    <div>
        <a href="http://www.google.com">Go!</a>
    </div>
</body>
</html> 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-24T09:57:56.640

如果我没记错的话，那么添加一个 unload() 事件意味着该页面无法被缓存（在前向/后向缓存中）——因为当用户离开时它的状态会发生变化/可能会发生变化。所以 - 当通过历史对象导航返回页面时恢复页面的最后一秒状态是不安全的。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-16T15:54:43.663

我认为这将用于“onunload”，而不是页面加载，因为我们不是在谈论在点击“Back”时触发事件吗？$document.ready() 用于页面加载所需的事件，无论您如何到达该页面（即重定向、直接打开浏览器到 URL 等），而不是单击“返回”时，除非您正在说话关于再次加载时在上一页上触发的内容。而且我不确定页面没有被缓存，因为我发现 Javascripts 仍然存在，即使 $document.ready() 包含在其中。在编辑具有此事件的脚本时，我们必须按 Ctrl+F5 来修改它们，并且我们想在我们的页面中测试结果。

```
$(window).unload(function(){ alert('do unload stuff here'); }); 
```

是您在点击“返回”并卸载当前页面时想要的 onunload 事件，并且在用户关闭浏览器窗口时也会触发。这听起来更像是我们想要的，即使我的 $document.ready() 响应数量超过了我。基本上区别在于在当前页面关闭时触发的事件或在加载时单击“返回”时加载的事件。在 IE 7 中测试很好，不能代表其他浏览器，因为它们在我们所在的地方是不允许的。但这可能是另一种选择。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T16:01:31.547

[jQuery 的](http://jquery.com/) [ready](http://docs.jquery.com/Events/ready#fn)事件就是为这类问题而创建的。您可能想深入研究实现以了解幕后情况。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-09-11T09:52:18.900

对于不想使用整个 jquery 库的人，我在单独的代码中提取了实现。它只有 0.4 KB 大。

您可以在此 wiki 中找到代码以及德语教程：[http ://www.easy-coding.de/wiki/html-ajax-und-co/onload-event-cross-browser-kompatibler-domcontentloaded.html](http://web.archive.org/web/20130417092220/http://www.easy-coding.de/wiki/html-ajax-und-co/onload-event-cross-browser-kompatibler-domcontentloaded.html)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-01T16:04:35.063

比尔，我敢回答你的问题，但我不能 100% 确定我的猜测。我认为当 IE 浏览器将用户带到历史页面时，它们不仅会从缓存中加载页面及其资源，而且还会为其恢复整个 DOM（读取会话）状态。IE 不执行 DOM 恢复（或至少不执行），因此 onload 事件看起来对于正确的页面重新初始化是必要的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-05-10T06:53:41.910

我使用 $(document).ready 尝试了 Bill 的解决方案...但起初它不起作用。我发现如果将脚本放在 html 部分之后，它将不起作用。如果它是 head 部分，它将起作用，但仅在 IE 中。该脚本在 Firefox 中不起作用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-01T16:37:13.100

好的，我试过了，它适用于 Firefox 3、Safari 3.1.1 和 IE7，但**不适**用于 Opera 9.52。
如果您使用下面显示的示例（基于palehorse 的示例），您会在页面首次加载时弹出一个警告框。但是，如果您随后转到另一个 URL，然后单击“后退”按钮返回此页面，则在 Opera 中不会弹出警告框（但在其他浏览器中会弹出）。

无论如何，我认为这已经足够接近了。谢谢大家！

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Untitled Document</title>
<meta http-equiv="expires" content="0">
<script src="jquery.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready( 
                    function(){
                      alert('test');
                    }
                 );
</script>
</head>
<body>
<h1>Test of the page load event and the Back button using jQuery</h1>
</body>
</html> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-08-07T11:25:50.197

Unload 事件在 IE 9 上不能正常工作。我用 load 事件 (onload()) 进行了尝试，它在**IE 9**和**FF5**上工作正常。

**例子：**

```
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Insert title here</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript">
    jQuery(window).bind("load", function() {
        $("[name=customerName]").val('');
    });
</script>
</head>
<body>
    <h1>body.jsp</h1>
    <form action="success.jsp">
        <div id="myDiv">

        Your Full Name: <input name="yourName" id="fullName"
            value="Your Full Name" /><br> <br> <input type="submit"><br>

        </div>

    </form>
</body>
</html> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-07-01T19:46:09.817

我使用了一个 html 模板。在这个模板的 custom.js 文件中，有这样一个函数：

```
 jQuery(document).ready(function($) {

       $(window).on('load', function() {
          //...
       });

    }); 
```

但是当我转到其他页面后返回时，此功能不起作用。

所以，我试过了，它奏效了：

```
 jQuery(document).ready(function($) {
       //...
    });

   //Window Load Start
   window.addEventListener('load', function() {
       jQuery(document).ready(function($) {
          //...
       });
   }); 
```

现在，我有 2 个“就绪”功能，但它没有给出任何错误，并且页面运行良好。

尽管如此，我必须声明它已经在 Windows 10 - Opera v53 和 Edge v42 上进行了测试，但没有在其他浏览器上进行测试。请记住这...

注意：jquery 版本是 3.3.1，迁移版本是 3.0.0

# ruby-on-rails - RoR：创建/更新：在保留先前值的同时显示验证错误

> ID：158324
> 
> 赞同：2
> 
> 时间：2008-10-01T15:51:58.653
> 
> 标签：ruby-on-rails, ruby

我有一个基本模型，我在其中指定了一些字段来验证其存在。在控制器的创建操作中，我执行标准：

```
@obj = SomeObject.new(params[:some_obj])

if @obj.save
  flash[:notice] = "ok"
  redirect...
else
  flash[:error] = @obj.errors.full_messages.collect { |msg| msg + "<br/>" }
  redirect to new form
end 
```

但是，当我重定向到新表单时，会显示错误，但字段为空。有没有办法用输入的值重新填充字段，以便轻松纠正错误？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:29:02.853

你`render :action => :new`而不是重定向。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T06:58:22.607

也捕获`@obj`闪存哈希，然后在`new`操作中检查它。

```
@obj = SomeObject.new(params[:some_obj])

if @obj.save
  flash[:notice] = "ok"
  # success
else
  flash[:error] = @obj.errors.full_messages.collect { |msg| msg + "<br/>" }
  flash[:obj] = @obj
  # redirect to new form
end 
```

在`new`：

```
@obj = flash[:obj] || MyClass.new 
```

# apache - 我将如何创建一个重定向到 launch.php?i=/the/url/that/they/want 的 mod_rewrite？

> ID：158328
> 
> 赞同：0
> 
> 时间：2008-10-01T15:52:45.997
> 
> 标签：apache, url, mod-rewrite

因此，如果用户键入**mydomain.com/dashboard**，服务器实际发送给他们的文档是**/launch.php?i=/dashboard**。

一个警告是我想留下请求

*   /标志
*   /人们
*   /海报
*   /css
*   /图标
*   /图片
*   /图书馆
*   /模式

单独，他们应该请求实际的文件夹。

我将如何创建这样的 mod_rewrite？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T15:55:57.533

这是[CakePHP](http://www.cakephp.org)框架的 .htaccess 文件。

请替换 index.php 和 ?url= 以满足您的需要。

```
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
</IfModule> 
```

"!-d" 告诉 Apache 跟踪现有文件夹，"!-f" 告诉 Apache 跟踪现有文件。

其他一切都通过 index.php

正如评论中所建议的那样，您必须注意，如果它不起作用，可能是因为未启用 mod_rewrite 并且您不会收到说明这一事实的错误，您可能只有 HTTP 404。

# java - 用于瘦客户端部署的 http/AJAX (GWT) 与 Eclipse gui

> ID：158330
> 
> 赞同：1
> 
> 时间：2008-10-01T15:53:17.633
> 
> 标签：java, ajax, eclipse, user-interface, gwt

我正在启动一个项目，我们将为此拥有一个瘦客户端，发送请求并从服务器获取响应。

我们仍处于计划阶段，因此我们可以选择选择基于 Eclipse 的 GUI（Eclipse 插件）或使用 GWT 作为应用程序的基础。

我不太熟悉 Eclipse 作为 GUI（也不是 GWT），但知道“普通”Java。

这两种方法的主要优点和缺点是什么？

**编辑：**解决提出的问题：

*   该项目，如果基于 Eclipse，将使用核心 Eclipse gui（没有编码工具，只是简单的框架），并且 GUI 将与它一起打包。
*   我一直在研究 GWT，到目前为止似乎是最好的选择，但仍有一些研究要做。
*   通信方法是 CORBA（内部库）的一种变体

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:08:00.623

来自与您有同样丰富经验的人（尚未开发任何基于 Eclipse 的插件或任何使用 GWT 的东西），这纯粹是另一种观点对您的问题的看法。

纯粹从瘦客户端提供此应用程序的角度来看，我认为 GWT 更适合这种情况。它肯定会更轻一些，并且不需要 Eclipse 插件所需的开销。

我还认为这将使部署更新变得更加容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T18:00:27.297

如果您正在考虑使用 Eclipse 构建一个独立的客户端或一个刚刚添加到现有 Eclipse 安装的插件，您打算如何与您的服务器通信？

我们的团队尝试构建一个 Eclipse 富客户端平台应用程序，并让它通过 RMI 与基于 J2EE EJB 的中间层进行通信，并且效果很好，除了当我们遇到安全问题并且无法使用任何标准 J2EE 安全模式时在 Eclipse 客户端上创建一个登录，该登录将对服务器进行身份验证。

这似乎是 Eclipse 圈子中的一个已知问题，但我还没有看到任何好的解决方案。

GWT 看起来相当先进，并且有几个 IDE 添加了使用它的工具，但我没有使用它开发的第一手经验。我在演示和示例中看到的所有内容都使它看起来非常强大且易于使用。

So my basic point is, Eclipse is an exciting platform, but you will face difficulties which you might have to solve yourself. GWT seems to be an easier alternative for now.

# java - 有没有办法只在 Tomcat/Wildfly/Glassfish 启动时运行方法/类？

> ID：158336
> 
> 赞同：54
> 
> 时间：2008-10-01T15:55:06.617
> 
> 标签：java, tomcat, jakarta-ee, web-applications, startup

我需要在 Tomcat 启动时删除临时文件，传递到包含临时文件的文件夹位于 applicationContext.xml 中。

有没有办法只在 Tomcat 启动时运行方法/类？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-01T16:01:17.180

您可以编写一个从方法`ServletContextListener`调用您的方法的`contextInitialized()`方法。您将侦听器附加到 web.xml 中的 webapp，例如

```
<listener>
   <listener-class>my.Listener</listener-class>
</listener> 
```

和

```
package my;

public class Listener implements javax.servlet.ServletContextListener {

   public void contextInitialized(ServletContext context) {
      MyOtherClass.callMe();
   }
} 
```

严格来说，这只是在 webapp 启动时运行一次，而不是在 Tomcat 启动时运行一次，但这可能相当于同一件事。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2014-10-25T22:06:24.020

您还可以使用（从 Servlet v3 开始）带注释的方法（无需向 web.xml 添加任何内容）：

```
 @WebListener
    public class InitializeListner implements ServletContextListener {

        @Override
        public final void contextInitialized(final ServletContextEvent sce) {

        }

        @Override
        public final void contextDestroyed(final ServletContextEvent sce) {

        }
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T16:08:34.227

我确信作为容器生命周期的一部分必须有更好的方法来做到这一点（编辑：汉克有答案 - 我想知道为什么他`SessonListener`在我回答之前建议一个），但你可以创建一个没有其他的 Servlet目的不是在服务器启动时执行一次性操作：

```
<servlet>
  <description>Does stuff on container startup</description>
  <display-name>StartupServlet</display-name>
  <servlet-name>StartupServlet</servlet-name>
  <servlet-class>com.foo.bar.servlets.StartupServlet</servlet-class>
  <load-on-startup>1</load-on-startup>
</servlet> 
```

# sql-server - 有没有办法让 SQL Management Studio 永远不会在脚本中生成 USE [database-name]？

> ID：158341
> 
> 赞同：2
> 
> 时间：2008-10-01T15:57:20.637
> 
> 标签：sql-server, ssms

有没有办法关闭这个“功能”？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:00:18.337

太棒了，我刚刚找到它：

`Tools -> Options -> Sql Server Object Explorer -> General Scripting Options`

`Script USE <database> -> False`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T16:01:05.010

工具 -> 选项 -> Sql Server 对象资源管理器 -> 脚本 -> **Script USE <database>**（在*常规脚本选项*标题下）。

那是在 SQL Server 2008 Management Studio 中，我听说它在 2005 年也有。

# c# - 远程客户端无法使用 ASP.NET/ADO 打开 XLS 文件

> ID：158343
> 
> 赞同：1
> 
> 时间：2008-10-01T15:57:50.680
> 
> 标签：c#, asp.net, iis, ado.net

我正在尝试执行以下操作：

1.  用户进入网页，上传 XLS 文件
2.  使用 ADO .NET 打开 XLS 文件，使用 JET 引擎连接到 Web 服务器上本地上传的文件

这一切都在本地运行良好（我的机器作为客户端和 Web 服务器） - 实际上正在使用远程客户端在客户的 Web 服务器上工作，但在尝试使用远程客户端进行内部测试时无法正常工作。

我得到的错误是：

```
TIME:       [10/1/2008 11:15:28 AM]
SEVERITY:   EXCEPTION
PROGRAM:    Microsoft JET Database Engine
EXCEPTION:  Unspecified error
STACK TRACE:       at System.Data.OleDb.OleDbConnectionInternal..ctor(OleDbConnectionString constr, OleDbConnection connection)
   at System.Data.OleDb.OleDbConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningObject)
   at System.Data.ProviderBase.DbConnectionFactory.CreateNonPooledConnection(DbConnection owningConnection, DbConnectionPoolGroup poolGroup)
   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)
   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)
   at System.Data.OleDb.OleDbConnection.Open() 
```

产生错误的代码是：

```
OleDbConnection l_DbConnection;
        OleDbDataAdapter l_DbCommand;
        DataSet l_dataSet = new DataSet();

        l_DbConnection = new OleDbConnection("provider=Microsoft.Jet.OLEDB.4.0; data source=\"" + l_importFileName + "\";Extended Properties=Excel 8.0;");
        l_DbCommand = new OleDbDataAdapter("select * from [Sheet1$]", l_DbConnection);

        //try using provider to read file
        try { l_DbConnection.Open(); } 
```

对“打开”的调用引发了上述异常。

该站点正在使用模拟，并且所有呼叫都是在用户登录客户端时进行的。到目前为止我所做的一切都是为了让这个工作：

按照此处的步骤[http://support.microsoft.com/kb/251254/](http://support.microsoft.com/kb/251254/)并将 TMP/TEMP 环境变量目录的权限分配给我用来测试的用户（也将权限分配给 ASPNET，然后分配给“每个人”作为一个毯子“这个权限相关吗？”测试）。

确保文件正在上传，并且 XLS 文件本身继承了允许用户完全访问文件的目录权限。为了以防万一，我还将此目录权限授予“每个人” - 这也没有帮助。

我不必更改任何环境变量，因此在进行这些更改后不必重新启动 - 但我不应该让 Windows 文件夹/文件权限生效。

在这一点上，我完全不知所措

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T19:06:29.993

好的，想通了——

事实证明，即使 IIS 使用模拟并将 TMP/TEMP 环境变量设置为 C:\WINDOWS\Temp，ASP.NET 进程仍在 ASPNET 帐户下运行，并且每个用户都需要对 Documents and Settings\ASPNET\ 的权限本地设置\临时文件夹

解决此问题的另一种方法可能是创建一个新的应用程序池，并让该应用程序池作为对正确文件夹而不是 ASPNET 具有权限的用户运行

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:42:00.813

转到目录 \Documents and Settings\"machineName"\ASPNET\Local Settings\Temp 并授予用户“EveryOne”读取、写入权限然后它会正常工作。此外，您必须在 web.config 文件中设置“”

# c# - 在 PowerShell 中，如何确定当前驱动器是否为网络驱动器？

> ID：158359
> 
> 赞同：7
> 
> 时间：2008-10-01T16:01:23.230
> 
> 标签：c#, powershell, networking, mapped-drive

我需要从 Powershell 中知道当前驱动器是否是映射驱动器。

不幸的是，Get-PSDrive 没有“按预期”工作：

```
PS:24 H:\temp
>get-psdrive  h

Name       Provider      Root      CurrentLocation
----       --------      ----      ---------------
H          FileSystem    H:\          temp 
```

但是在 MS-Dos “net use” 中显示 H: 实际上是一个映射的网络驱动器：

```
New connections will be remembered.

Status       Local     Remote                    Network
-------------------------------------------------------------------------------
OK           H:        \\spma1fp1\JARAVJ$        Microsoft Windows Network

The command completed successfully. 
```

我想要做的是获取驱动器的根并在提示符中显示它（请参阅：[自定义 PowerShell 提示符 - 相当于 CMD 的 $M$P$_$+$G?](https://stackoverflow.com/questions/157923/customizing-powershell-prompt-equivalent-to-cmds-mpg)）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T16:19:27.400

使用 .NET 框架：

```
PS H:\> $x = new-object system.io.driveinfo("h:\")
PS H:\> $x.drivetype
Network 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:32:28.727

尝试 WMI：

```
Get-WMI -query "Select ProviderName From Win32_LogicalDisk Where DeviceID='H:'" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T16:36:22.743

使用 WMI 的另一种方法：

`get-wmiobject Win32_LogicalDisk | ? {$_.deviceid -eq "s:"} | % {$_.providername}`

获取所有网络驱动器：

`get-wmiobject Win32_LogicalDisk | ? {$_.drivetype -eq 4} | % {$_.providername}`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T17:31:39.520

最可靠的方法是使用WMI

```
get-wmiobject win32_volume | ? { $_.DriveType -eq 4 } | % { get-psdrive $_.DriveLetter[0] } 
```

DriveType 是具有以下值的枚举

0 - 未知 1 - 无根目录 ​​2 - 可移动磁盘 3 - 本地磁盘 4 - 网络驱动器 5 - 光盘 6 - RAM 盘

这是我[在该主题上所做的博客文章的链接](http://blogs.msdn.com/jaredpar/archive/2007/12/06/filtering-get-psdrive-to-all-local-drives.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T16:04:40.657

对已接受答案的稍微更紧凑的变体：

```
[System.IO.DriveInfo]("C") 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-06T14:48:37.940

更进一步，如下所示：

```
([System.IO.DriveInfo]("C")).Drivetype 
```

请注意，这仅适用于本地系统。将 WMI 用于远程计算机。

# javascript - 是否可以通过 javascript 或 HTTP 标头检测*移动设备类型*？

> ID：158369
> 
> 赞同：2
> 
> 时间：2008-10-01T16:05:13.503
> 
> 标签：javascript, http, windows-mobile, http-headers

我收到客户的请求，要求自动检测移动设备的类型（不是浏览器，类型。例如：Moto Q、Blackjack II 等）并自动从下拉列表中选择设备，并提供支持列表设备。

到目前为止，我发现 HTTP 标头（由移动 IE 提交）包含诸如

*   解析度
*   UA-CPU（我见过 WM 2003 的 ARM 和 WM5 的 x86）
*   用户代理（基本上只是说 Windows CE）

我现在唯一能想到的可能是使用分辨率/CPU的组合并做出“最佳猜测”

有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T16:27:51.250

您可能想在这里查看 WURFL：[http](http://wurfl.sourceforge.net/) ://wurfl.sourceforge.net/ 。

从网站：

> 那么... WURFL 是什么？WURFL 是一个 XML 配置文件，其中包含有关许多移动设备的功能和特性的信息。
> 
> 该文件的主要范围是尽可能多地收集有关访问 WAP 页面的所有现有移动设备的信息，以便开发人员能够为用户构建更好的应用程序和更好的服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T16:13:31.860

客户所说的“支持”到底是什么意思。当然，这意味着有问题的手机支持 Web 应用程序及其内部功能 - 忘记设备检测并只专注于检测应用程序正常运行所需的那些功能不是更好吗？例如，如果我的移动网站需要 Ajax 工作，那么我可以做一些简单的对象检测来自己找出来，而不是列出所有据说“支持 Ajax”的设备。

设备检测，就像浏览器检测一样不可靠。是的，这是可能的，但我不推荐它......在我完成的一个项目中，我们使用用户代理字符串来检测各种设备。indexOf JavaScript 方法派上用场了！:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-02T20:18:39.150

另一个快速简单的解决方案是 Apache Mobile Filter： http: [//www.apachemobilefilter.org](http://www.apachemobilefilter.org)

# windows - 错误1053：服务没有及时响应启动或控制请求

> ID：158371
> 
> 赞同：69
> 
> 时间：2008-10-01T16:06:01.223
> 
> 标签：windows, error-handling, windows-services, timeout

我最近继承了几个作为 Windows 服务运行的应用程序，并且在为它们提供 gui（可从系统托盘中的上下文菜单访问）时遇到问题。

我们需要 Windows 服务的 gui 的原因是为了能够重新配置 Windows 服务的行为而无需停止/重新启动。

我的代码在调试模式下工作正常，我得到了上下文菜单，一切正常等等。

当我使用命名帐户（即不是本地系统帐户）通过“installutil”安装服务时，服务运行正常，但不会在系统托盘中显示图标（我知道这是正常行为，因为我不具有“与桌面交互”选项）。

但问题是——当我选择“LocalSystemAccount”选项并检查“与桌面交互”选项时，服务需要 AGES 来启动，没有明显的原因，我只是不断收到

> 无法在本地计算机上启动 ... 服务。
> 
> 错误 1053：服务没有及时响应启动或控制请求。

顺便说一句，我通过注册表黑客将 Windows 服务超时从默认的 30 秒增加到 2 分钟（请参阅[http://support.microsoft.com/kb/824344](http://support.microsoft.com/kb/824344)，在第 3 节中搜索 TimeoutPeriod），但是服务仍然启动超时。

我的第一个问题是 - 为什么“本地系统帐户”登录比使用非 LocalSystemAccount 登录的服务要长得多，从而导致 Windows 服务超时？这两者之间有什么区别会导致启动时出现这种不同的行为？

其次 - 退后一步，我想要实现的只是一个提供配置 gui 的 Windows 服务 - 我很乐意使用非本地系统帐户（使用命名用户/密码）运行，如果我可以让服务与桌面交互（也就是说，在系统托盘中有一个可用的上下文菜单）。这可能吗，如果可以，怎么办？

任何指向上述问题的指针将不胜感激！

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2011-09-30T14:12:40.300

在与这条消息抗争了几天后，一位朋友告诉我，你必须使用 Release 版本。当我 InstallUtil 调试版本时，它会给出此消息。发布版本开始正常。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-01T16:36:05.550

If you continue down the road of trying to make your service interact with the user's desktop directly, you'll lose: even under the best of circumstances (i.e. "before Vista"), this is extremely tricky.

Windows internally manages several [window stations](http://msdn.microsoft.com/en-us/library/ms681928.aspx), each with their own desktop. The window station assigned to services running under a given account is completely different from the window station of the logged-on interactive user. Cross-window station access has always been frowned upon, as it's a security risk, but whereas previous Windows versions allowed some exceptions, these have been mostly eliminated in Vista and later operating systems.

The most likely reason your service is hanging on startup, is because it's trying to interact with a nonexistent desktop (or assumes Explorer is running inside the system user session, which also isn't the case), or waiting for input from an invisible desktop.

The *only* reliable fix for these issues is to eliminate all UI code from your service, and move it to a separate executable that runs inside the interactive user session (the executable can be started using the global Startup group, for example).

Communication between your UI code and your service can be implemented using any RPC mechanism: Named Pipes work particularly well for this purpose. If your communications needs are minimal, using [application-defined Service Control Manager commands](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.executecommand.aspx) might also do the trick.

It will take some effort to achieve this separation between UI and service code: however, it's the only way to make things work reliably, and will serve you well in the future.

**ADDENDUM, April 2010:** Since this question remains pretty popular, here's a way to fix another common scenario that causes "service did not respond..." errors, involving .NET services that don't attempt any funny stuff like interacting with the desktop, but *do* use Authenticode signed assemblies: [disable the verification of the Authenticode signature at load time in order to create Publisher evidence](http://msdn.microsoft.com/en-us/library/bb629393.aspx), by adding the following elements to your .exe.config file:

```
<configuration>
    <runtime>
        <generatePublisherEvidence enabled="false"/>
    </runtime>
</configuration> 
```

Publisher evidence is a little-used Code Access Security (CAS) feature: only in the unlikely event that your service actually relies on the PublisherMembershipCondition will disabling it cause issues. In all other cases, it will make the permanent or intermittent startup failures go away, by no longer requiring the runtime to do expensive certificate checks (including revocation list lookups).

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2013-09-20T20:39:28.517

由于运行我的服务的盒子上缺少框架，我遇到了这个问题。盒子有 .NET 4.0，服务是在 .NET 4.5 之上编写的。

我在盒子上安装了以下下载，重新启动，服务启动正常： [http ://www.microsoft.com/en-us/download/details.aspx?id=30653](http://www.microsoft.com/en-us/download/details.aspx?id=30653)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-01T17:00:36.647

要调试服务的启动，请将以下内容添加到`OnStart()`服务方法的顶部：

```
 while(!System.Diagnostics.Debugger.IsAttached) Thread.Sleep(100); 
```

这将停止服务，直到您使用 Debug -> Attach to Process... 手动附加 Visual Studio 调试器...

**注意：**通常，如果您需要用户与您的服务进行交互，最好将 GUI 组件拆分为一个单独的 Windows 应用程序，该应用程序在用户登录时运行。然后您可以使用命名管道或其他形式的 IPC在 GUI 应用程序和您的服务之间建立通信。这实际上是在 Windows Vista 中实现此目的的*唯一方法。*

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-03-17T11:08:55.357

在 OnStart 方法中的服务类中不要进行大量操作，操作系统期望运行服务的时间很短，使用线程启动运行您的方法：

```
protected override void OnStart(string[] args)
{
    Thread t = new Thead(new ThreadStart(MethodName)); // e.g.
    t.Start();
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-01T16:14:38.130

我在这里盲目射击，但我经常发现服务启动的长时间延迟是由网络功能超时直接或间接引起的，通常是在查找帐户 SID 时尝试联系域控制器时 - 这经常通过间接发生`GetMachineAccountSid()`无论您是否意识到，因为该函数是由 RPC 子系统调用的。

有关如何在这种情况下进行调试的示例，请参阅Mark Russinovich 博客上[的进程启动延迟案例。](http://blogs.technet.com/markrussinovich/archive/2006/08/31/453100.aspx)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-11-24T10:38:36.190

If you are using Debug code as below in your service the problem may arise.

```
#if(!DEBUG)
ServiceBase[] ServicesToRun;
ServicesToRun = new ServiceBase[]
{
new EmailService()
};
ServiceBase.Run(ServicesToRun);
#else
//direct call function what you need to run
#endif 
```

To fix this, while you build your windows service remove #if condition because it didn't work as it is.

Please use argument for debug mode instead as below.

```
if (args != null && args.Length > 0)
{
_isDebug = args[0].ToLower().Contains("debug");
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-07-11T04:39:34.680

就我而言，问题是缺少`.net framework`.

我使用的服务

```
<startup>
  <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5" />
</startup> 
```

但是`.net Framework`服务器的版本是 4，所以通过将 4.5 更改为 4 解决了问题：

```
<startup>
  <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.0" />
</startup> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-08-16T18:16:44.440

我正在编写的服务遇到了类似的问题。它工作得很好，然后有一天我开始收到启动错误的超时。它发生在一个和/或两个版本和调试中，具体取决于发生了什么。我已经从 System.Diagnostics 实例化了一个 EventLogger，但是我看到的任何错误都必须在 Logger 能够写入之前发生......

如果您不知道在哪里查找事件日志，在 VS 中，您可以转到服务器资源管理器下的计算机。除了我的服务之外，我开始查看其他一些事件日志。在 Application - .NETRuntime 下，我发现了与启动错误相关的错误日志。基本上，我的服务的构造函数中有一些异常（一个结果是 EventLog 实例设置中的异常 - 这解释了为什么我在我的 Service EventLog 中看不到任何日志）。在以前的版本中，显然还有其他错误（这导致我进行了导致 EventLog 设置错误的更改）。

长话短说 - 超时的原因可能是由于各种异常/错误，但使用运行时事件日志可能只会帮助您弄清楚发生了什么（特别是在一个构建工作但另一个构建不工作的情况下）。

希望这可以帮助！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-02-22T13:56:48.683

复制发布DLL或从发布模式而不是调试模式获取DLL并将其粘贴到安装文件夹，它应该可以工作

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-01T18:17:50.453

我想在这里回应 mdb 的评论。不要走这条路。您的服务不应该有 UI...“无用户交互”就像服务的定义功能。

如果您需要配置您的服务，请编写另一个应用程序来编辑服务在启动时读取的相同配置。但是让它成为一个独特的工具——当你想启动服务时，你启动服务。当你想配置它时，你运行配置工具。

现在，如果您需要对服务进行实时监控，那就有点棘手了（当然这也是我希望通过服务实现的）。现在您正在谈论必须使用进程间通信和其他令人头疼的问题。

最糟糕的是，如果您需要用户交互，那么您会在这里真正断开连接，因为服务不与用户交互。

在您的情况下，我会退后一步，问**为什么这需要成为一项服务**？为什么**它需要用户交互**？

这两个要求是非常不兼容的，这应该引起警报。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-01T16:13:51.907

安装服务的调试版本并将调试器附加到服务以查看发生了什么。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-05-01T22:13:40.530

我遇到了这个问题，花了大约一天时间解决。对我来说，问题是我的代码跳过了“主要内容”并有效地运行了几行然后完成。这导致了我的错误。它是一个安装 Windows 服务的 C# 控制台应用程序，一旦它尝试使用 ServiceController (sc.Run() ) 运行它，它就会给我这个错误。

在我修复代码以转到主要内容后，它将运行预期的代码：

`ServiceBase.Run(new ServiceHost());`

然后它就不再出现了。

正如很多人已经说过的那样，错误可能是任何东西，人们提供的解决方案可能会也可能不会解决它。如果他们没有解决它（比如发布而不是调试，将 generatePublisherEvidence=false 添加到您的配置中等），那么问题很可能出在您自己的代码上。

尝试在不使用 sc.Run() 的情况下运行您的代码（即让 sc.Run() 执行的代码运行）。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-07-28T03:07:25.037

当您的程序集上缺少某些引用并且通常绑定在运行时失败时，通常会出现此问题。

调试`Thread.Sleep(1000)`放在`main()`. 并在下一行执行中放置一个断点。

然后启动进程并在启动时将调试器附加到进程。到达断点后按 f5。它将抛出缺少程序集或引用的异常。

希望这将解决此错误。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-03-04T21:45:11.223

我遇到了这个问题，这让我发疯了两天……如果您的问题与我的类似：

我的windows服务中有“用户设置”设置，所以服务可以自行维护，无需停止和启动服务。好吧，问题在于“用户设置”，其中这些设置的配置文件保存在服务-exe文件版本下运行Windows服务的用户的用户配置文件下的文件夹中。

由于某种原因，此文件夹已损坏。我删除了文件夹，服务又像往常一样愉快地开始工作了……</p>

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-09-04T18:35:22.320

一旦尝试运行您的 exe 文件。我遇到了同样的问题，但是当我通过双击 exe 文件直接运行它时，我收到一条关于 .Net 框架版本的消息，因为我发布了带有框架的服务项目，但它没有安装在目标机器上。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-01-15T13:32:11.683

将 127.0.0.1 crl.microsoft.com 添加到“Hosts”文件解决了我们的问题。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-08-10T07:47:40.200

[![在此处输入图像描述](https://i.stack.imgur.com/o2Iuh.png)](https://i.stack.imgur.com/o2Iuh.png)

花了我几个小时，应该看到事件查看器**get_AppSettings()**。

应用程序配置的更改导致了问题。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-10-26T12:57:45.250

我的问题是由于 Windows 服务配置中提到的目标框架是

```
<startup>
<supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6"/>
 </startup> 
```

这个.Net版本不支持我尝试安装Windows服务的服务器。

更改 which ，我可以解决问题。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-04-03T04:32:10.027

我有一个类似的问题，我遵循的步骤：

1.  `Debugger.Launch()`在windows服务构造函数中放一个
2.  一步一步看它卡在哪里

我的问题不是由于任何错误。我有一个`BlockingCollection.GetConsumingEnumerable()`导致 Windows 服务等待的方式。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-09-28T07:20:12.260

我也遇到了类似的问题，发现加载程序集有问题。尝试启动服务时，我立即收到此错误。

要快速调试问题，请尝试使用 ProcDump [http://technet.microsoft.com/en-us/sysinternals/dd996900](http://technet.microsoft.com/en-us/sysinternals/dd996900)通过命令提示符运行服务可执行文件。它应提供有关确切错误的充分提示。

[http://bytes.com/topic/net/answers/637227-1053-error-trying-start-my-net-windows-service](http://bytes.com/topic/net/answers/637227-1053-error-trying-start-my-net-windows-service)帮了我不少忙。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-03-03T20:10:31.473

我也有这个问题。我通过将登录帐户更改为本地系统帐户使其工作。在我的项目中，我将其设置为作为本地服务帐户运行。因此，当我安装它时，默认情况下它使用的是本地服务。我正在使用 .net 2.0 和 VS 2005。所以安装 .net 1.1 SP1 不会有帮助。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-07-20T13:33:17.883

本地系统帐户和本地服务都不适用于我，然后我将其设置为网络服务，这工作正常。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-02-21T02:52:17.393

就我而言，由于真正的错误，我遇到了这个麻烦。在调用服务构造函数之前，成员变量的一个静态构造函数失败了：

```
 private static OracleCommand cmd;

    static SchedTasks()
    {
        try
        {
            cmd = new OracleCommand("select * from change_notification");
        }
        catch (Exception e)
        {
            Log(e.Message); 
            // "The provider is not compatible with the version of Oracle client"
        }
    } 
```

通过添加 try-catch 块，我发现由于错误的 oracle 版本而发生异常。安装正确的数据库解决了这个问题。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2022-01-18T12:23:09.357

在我们的案例中，我们引用了事件查看器并收到错误说明机器配置不是格式良好的 XML，因此我们调查并发现有人在我们删除的元素之一中放置了双 << 尖括号，这解决了我们的问题

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-03-23T10:26:53.797

这对我有用。基本上确保登录用户设置为正确的。但是，这取决于帐户基础架构的设置方式。在我的示例中，它使用 AD 帐户用户凭据。

在启动菜单搜索框中搜索“服务”-在“服务”中找到所需的服务-右键单击并选择“登录”选项卡-选择“此帐户”并输入所需的内容/凭据-确定并照常启动服务

[![在此处输入图像描述](https://i.stack.imgur.com/oTdF9.png)](https://i.stack.imgur.com/oTdF9.png)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-09-02T08:44:28.370

我遇到了同样的问题并尝试了上述所有方法，但问题仍然存在，然后我尝试了以下解决方案，它对我有用，如果您尝试了所有方法，您也可以尝试这个，也许它会解决您的问题：

1.  转到文件夹：~\bin\Debug，
2.  备份所有文件，然后删除所有文件，
3.  重新构建应用程序，然后在服务器上部署新文件，
4.  现在尝试运行该服务。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-04-04T15:10:53.620

如果您有用于测试的 windows 窗体，请确保启动对象仍然是服务而不是 windows 窗体

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-08-25T08:19:21.620

1.  在发布模式下构建项目。
2.  将所有 Release 文件夹文件复制到源路径。
3.  在管理访问中使用命令提示符窗口执行 Window 服务。
4.  永远不要从源路径中删除文件。

至少这对我有用。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-06-15T17:48:35.713

我们将 Log4Net 配置为记录到数据库表。该表变得如此之大，以至于服务在尝试记录消息时超时。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-08-02T12:14:42.603

在我的情况下，它是AD中**用户帐户的权限。**正确设置后，它可以完美运行。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2022-02-02T11:52:46.537

我的问题是服务程序找不到第三方 dll。将 dll 的路径添加到系统 PATH 中解决了这个问题。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-08-22T04:47:13.137

以管理员身份打开服务窗口，然后尝试启动服务。这对我有用。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-03-21T14:40:08.650

发布版本对我不起作用，但是，我查看了事件查看器和应用程序日志，发现 Windows 服务在尝试创建事件日志时抛出了安全异常。我通过使用管理访问手动添加事件源来解决此问题。

我遵循了微软的这份指南：

*   打开注册表编辑器，运行 --> regedit
*   找到以下注册表子项： **HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application**
*   右键单击应用程序子项，指向新建，然后单击项。
*   键入 Windows 服务中使用的事件源名称作为键名。
*   关闭注册表编辑器。

# c# - 如何构建可以在窗口之间拖放用户控件的 WPF 应用程序？

> ID：158372
> 
> 赞同：3
> 
> 时间：2008-10-01T16:06:02.907
> 
> 标签：c#, wpf, windows, user-interface

我正在构建一个简单的待办事项列表应用程序，我希望能够在桌面上浮动多个列表，我可以在其中标记和管理任务。

我的应用程序中的相关 UIElements 是：

Window1（窗口） TodoList（用户控件） TodoStackCard（用户控件）

Window1 看起来像这样：

```
<Window x:Class="TaskHole.App.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:t="clr-namespace:TaskHole.App.Controls"
    xmlns:tcc="clr-namespace:TaskHole.CustomControls"
    Title="Window1" Width="500" Height="500" Background="Transparent" WindowStyle="None" AllowsTransparency="True" >
    <Canvas Name="maincanvas" Width="500" Height="500" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
        <ResizeGrip SizeChanged="ResizeGrip_SizeChanged" />
        <t:TodoList Canvas.Top="0" Canvas.Left="0" MinWidth="30" Width="50" Height="500" x:Name="todoList" TaskHover="todoList_TaskHover" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
    </Canvas>
</Window> 
```

TodoList 看起来像这样：

```
<UserControl x:Class="TaskHole.App.Controls.TodoList"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:t="clr-namespace:TaskHole.App.Controls"
    xmlns:tcc="clr-namespace:TaskHole.CustomControls"
    Background="Transparent">
<StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Stretch" MinWidth="1" Grid.Row="2" Height="Auto" AllowDrop="True">
<ItemsControl Name="todolist" ItemsSource="{Binding}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel Name="stackPanel" VerticalAlignment="Bottom">

                                </VirtualizingStackPanel>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <t:TodoStackCard x:Name="card" TaskHover="card_TaskHover" Orientation="Vertical" VerticalContentAlignment="Top" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
</StackPanel>
</UserControl> 
```

我有这些窗口的多个实例，我希望能够在窗口之间拖动任何控件。我尝试过使用 Thumb 控件，虽然这可行，但它只允许我在包含的画布周围拖动控件。

我如何模仿 Windows 资源管理器的行为，我可以在其中将文件拖到应用程序之外并拖到另一个应用程序上，同时看到光标下文件的幻影表示。

我可以纯粹在 C# 和 WPF 中完成这个吗？如果是/如果不是，怎么办？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T16:12:09.977

您必须调用 DoDragDrop 来初始化拖放框架。[Jaime Rodriguez在此处](http://blogs.msdn.com/b/jaimer/archive/2007/07/12/drag-drop-in-wpf-explained-end-to-end.aspx)提供拖放指南

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:15:57.597

仅供参考，“拖动控件”和执行 Explorer 所做的操作（即拖放，特别是文件）之间存在很大差异。这就是您要查找的内容，如何从 WPF 应用程序拖放到其他内容。您将需要创建数据对象 (IDataObject) 或 WPF 世界中他们称之为的任何东西，然后您需要调用 DoDragDrop（再次，或在 WPF 中与此类似的任何东西）来开始拖动。做 explorer 做的事情也是可能的，我怀疑你需要做一些较低级别的调用来完成这个。看看[http://www.codeproject.com/KB/wtl/wtl4mfc10.aspx](http://www.codeproject.com/KB/wtl/wtl4mfc10.aspx)看看你需要寻找的东西。WPF 实际上可能会包含所有这些，但如果不是，这些是您需要研究的一些事情，

# javascript - 清除发送到 Firebug 控制台的 JavaScript

> ID：158375
> 
> 赞同：22
> 
> 时间：2008-10-01T16:07:38.083
> 
> 标签：javascript, firebug

我想清除已发送的 JavaScript 的 Firebug 控制台。

类似的东西`console.clear()`存在并且有效吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-18T08:31:22.240

`console.clear();`

为我工作

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-01T16:19:05.653

如果你想在控制台下查看所有可用的方法：

```
for(var i in console) {
    console.log(i);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-08-22T07:54:25.433

只需从控制台调用 clear 函数即可。但是，我似乎无法从 javascript 代码中清除控制台，但这似乎是有道理的（您将丢失信息）。

因此，在 Chrome 的控制台中，只需键入：

```
clear(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T16:14:48.987

您可以键入 clear(); 在 Firebug 命令行中。我认为没有办法从网页上做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-04T14:02:25.997

_FirebugCommandLine.clear();

将清除控制台

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-22T15:30:41.593

console.clear() 是 Firebug API 的一部分。我修复了文档页面： http: [//getfirebug.com/wiki/index.php/Console_API#console.clear.28.29](http://getfirebug.com/wiki/index.php/Console_API#console.clear.28.29)

jjb

# performance - 性能测试 MSMQ 服务器

> ID：158380
> 
> 赞同：1
> 
> 时间：2008-10-01T16:08:32.263
> 
> 标签：performance, windows-server-2003, msmq

有没有人针对 MSMQ 做过任何类型的性能测试？

我们在 prod 环境中有一个解决方案，将错误添加到 MSMQ 以分发到数据库或事件监视器。

我们需要测试这个系统的容量，但不知道如何开始。

有人知道任何工具或有任何提示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:15:10.563

尝试用测试程序重载它，看看它在哪里停止/失败

[类似于材料工程中的“破坏性测试”]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T18:24:10.353

[QueueExplorer](http://www.cogin.com/)具有“批量发送”选项，可用于将一堆消息发送到队列，它们之间有或没有延迟。我知道这不是一个完全自动化的压力测试，但是从少数实例甚至几台机器上运行它可能会产生很大的压力负载。

免责声明：我是 QueueExplorer 的作者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:22:05.147

yeah I was thinking that was hoping for a more public tool.

# delphi - 使用 Delphi 打开一个 ANSI 文件并保存一个 Unicode 文件

> ID：158382
> 
> 赞同：6
> 
> 时间：2008-10-01T16:08:34.617
> 
> 标签：delphi, unicode, delphi-2009, delphi-2006

由于某种原因，最近我的许多客户端系统上的 *.UDL 文件不再兼容，因为它们曾经保存为 ANSI 文件，不再与预期的 UNICODE 文件格式兼容。最终结果是一个错误对话框，指出“文件不是有效的复合文件”。

以编程方式打开这些文件并保存为 unicode 文件的最简单方法是什么？我知道我可以通过在记事本中打开每个文件然后保存为同一个文件但在另存为对话框的编码部分中选择“unicode”来做到这一点，但我需要在程序中执行此操作以减少支持来电。

这个问题很容易重复，只需在目录中创建一个*.txt 文件，将其重命名为*.UDL，然后使用microsoft 编辑器进行编辑。然后在记事本中打开它并将其另存为 ANSI 编码文件。尝试从 udl 编辑器打开 udl，它会告诉您它已损坏。然后将其（使用记事本）保存为 Unicode 编码文件，它将再次正确打开。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T16:18:33.923

好的，使用delphi 2009，我能够提出以下似乎可以工作的代码，但这是进行这种转换的正确方法吗？

```
var
  sl : TStrings;
  FileName : string;
begin
  FileName := fServerDir+'configuration\hdconfig4.udl';
  sl := TStringList.Create;
  try
    sl.LoadFromFile(FileName, TEncoding.Default);
    sl.SaveToFile(FileName, TEncoding.Unicode);
  finally
    sl.Free;
  end;
end; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T16:15:52.260

这对我的[TGpTextFile](http://gp.17slon.com/gp/gptextfile.htm)单元来说非常简单。我将整理一个简短的示例并将其张贴在这里。

新的 Delphi 2009 也应该非常简单 - 您可能正在使用它吗？

编辑：这是他如何使用我在 2009 年之前的 Delphis 中的东西来做到这一点。

```
var
  strAnsi   : TGpTextFile;
  strUnicode: TGpTextFile;
begin
  strAnsi := TGpTextFile.Create('c:\0\test.udl');
  try
    strAnsi.Reset; // you can also specify non-default 8-bit codepage here
    strUnicode := TGpTextFile.Create('c:\0\test-out.udl');
    try
      strUnicode.Rewrite([cfUnicode]);
      while not strAnsi.Eof do
        strUnicode.Writeln(strAnsi.Readln);
    finally FreeAndNil(strUnicode); end;
  finally FreeAndNil(strAnsi); end;
end; 
```

许可证：上面的代码片段属于公共领域。随心所欲地使用它。

# php - 首先会发生什么？.htaccess 还是 php 代码？

> ID：158384
> 
> 赞同：10
> 
> 时间：2008-10-01T16:08:52.823
> 
> 标签：php, apache, .htaccess, mod-rewrite

如果我使用 mod_rewrite 来控制我的所有 301 重定向，这会在我的页面被提供之前发生吗？因此，如果我的页面上运行的 php 脚本中也有一堆重定向规则，.htaccess 会先启动吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-01T16:14:15.137

.htaccess 将首先启动。如果您查看 Apache 请求周期：

![Apache 请求周期](https://i.stack.imgur.com/3PwIg.gif)

PHP 是一个响应处理程序。mod_rewrite 在 URI 转换时运行，除了在修复阶段运行的 .htaccess 和 <Directory> 或 <Location> 块中的重写规则。这是因为 Apache 在 URI 转换之前不知道它在哪个目录中（因此要读取哪个 <Directory> 或 .htaccess）。

为了回答 gabriel1836 关于图像的问题，我从[本演示文稿](http://stein.cshl.org/~lstein/talks/perl_conference/apache_api/)的第二张幻灯片中截取了它，但它最初来自我强烈推荐[的《用 Perl 和 C 编写 Apache 模块》一书。](http://www.modperl.com/)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-01T16:11:43.567

当对受 .htaccess 文件影响的 URI 发出请求时，Apache 将在执行任何 PHP 代码之前处理所有重写规则。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-01T16:11:01.413

是的，.htaccess 文件在您的脚本被提供之前被解析。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T16:11:10.977

.htaccess 首先发生。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T16:12:45.513

htaccess 由网络服务器控制。此文件将在您的 PHP 文件之前考虑在内。

例如，您可以使用 htaccess 文件限制对特定文件夹的访问。所以，它必须在你的 PHP 之前负责。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-01T16:13:27.447

.htaccess 在 php 脚本执行之前由 Apache 执行。（想象一下，如果执行了 php 脚本，然后 .htaccess 重定向到另一个页面......）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-19T18:23:50.747

您始终可以使用以下命令对此进行测试：

```
wget -S --spider http://yourdomain.com 
```

使用此命令，您可以看到谁在响应您的请求。

正如所有其他人提到的，.htaccess 是第一位的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-24T22:10:53.923

所以基本上，`.htaccess`或多或少都需要相关的PHP代码或文件，按照中规定的规则`.htaccess`，意思`.htaccess`是先运行。

# c# - Citrix - 如何防止每次启动智能客户端应用程序时重新下载

> ID：158385
> 
> 赞同：4
> 
> 时间：2008-10-01T16:09:19.187
> 
> 标签：c#, deployment, clickonce, citrix, smartclient

我们公司使用 Citrix 远程访问终端服务器，以便远程用户在其机器上的虚拟窗口中启动智能客户端应用程序。

问题是每次用户启动智能客户端应用程序时都会下载它们，即使远程 citrix 服务器上的版本没有更改。这是因为每次关闭 Citrix 会话时都会清除用户的配置文件。

有什么办法可以避免这种情况并继续清除用户的个人资料？不清除配置文件会导致 citrix 服务器上的空间浪费和配置文件损坏问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T13:49:32.477

我无法谈论 Citrix 服务器的详细信息。但是，使用 ClickOnce，您无法决定应用程序的安装位置。它安装在用户配置文件下，没有 ifs、ands 或 buts。ClickOnce 的主要目标之一是提高安全性，将应用程序安装到配置文件使这更容易。因此，如果您正在清除配置文件，您就会被卡住。

但是，您不能在没有 ClickOnce 的情况下将应用程序部署到 Citrix 服务器吗？大多数 .Net 应用程序只能进行 xcopy 部署，因此编写一些批处理文件以将最新部署复制到您的 Citrix 服务器并一起跳过 ClickOnce 似乎很容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T13:46:39.260

在 Citrix 环境中执行此操作的方法是使用 Citrix URL 内容重定向功能（在功能版本 2 中）将 ClickOnce URL 重定向到本地计算机 ( [http://xxx.xxx/myapplication.application](http://xxx.xxx/myapplication.application) )。这将导致浏览器窗口在本地计算机上打开，而不是在 Citrix 计算机上打开。一旦发生这种情况，ClickOnce 将接管并安装在本地用户的计算机上，而不是在 Citrix 内部。在本地执行仍然会给您所有正常的 ClickOnce 好处。

由于 codeConcussion 答案中的问题，您不想在 Citrix 内部安装。另外，ClickOnce 不支持强制或临时配置文件，这可能是用户在 Citrix 内部所拥有的。

# macos - 如何让程序在 OSX 中自动启动？

> ID：158388
> 
> 赞同：6
> 
> 时间：2008-10-01T16:09:47.173
> 
> 标签：macos, osx-leopard, launchd

我有一个小程序，我想在我的 mac 启动时自动打开它。

因为这个程序接受命令行参数，它不像只是去系统首选项/帐户/登录项并将其添加到那里那么简单......

从谷歌，我读到我可以在用户的​​主文件夹中创建一个 .profile 文件，这将执行我放入其中的任何内容......所以我在 ~ 中有一个 .profile 页面，如下所示：

-rw-r--r--@ 1 马特员工 9 月 27 日 27 日 13:36 .profile

包含这个...

/应用程序/鼠标修复 3.5

但它不会在启动时执行！如果我在终端中手动输入“/Applications/mousefix 3.5”，它确实可以工作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T16:11:20.883

从这里到未来，寻找[`launchd`](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fdeveloper.apple.com%2Fmacosx%2Flaunchd.html&ei=JKHjSLHbH5GMpwT2_tH4Cw&usg=AFQjCNH84xt1QnHIRkhYtYJtGScdITegxQ&sig2=xYVn27D-CXFP8IbLig9-qg)你想做的事情。所有其他方法已被弃用或现在不受支持。不过，这可能比您想要的要重一些。

这也可能是您的 bash shell 版本没有正确执行您的`.profile`. 尝试将命令放入`.bashrc`您的主目录中，看看是否有帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T16:17:27.170

您可以使用[Lingon](http://tuppis.com/lingon/)帮助为 launchd 构建 plist 文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T16:14:52.420

在 MacOS 上启动时最常用的方法是使用[launchd](http://developer.apple.com/macosx/launchd.html "发射")。您可以创建一个 plist 文件来告诉它在启动时启动您的程序，其中可以包含参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T16:19:56.930

您可以使用可以运行终端命令的 Applescript，然后在启动时启动该 AppleScript。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:46:24.913

`.profile`和只有在`.bash_profile`你打开一个新的 shell 时才起作用（即打开终端或通过 SSH 进入）。另外，我相信如果 bash 检测到`.bash_profile`它不会查找`.profile`
如果您希望它在登录时启动，我会查看有关 launchd 的其他建议

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T16:11:18.310

您总是可以编写一个包装脚本，使用您想要的参数运行它

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:25:50.090

谢谢大家。launchd 解决方案非常酷，是的，它对于这么简单的事情来说是重量级的，但很高兴知道，作为开发人员，我很乐意修补:)

# database - 主键与唯一约束？

> ID：158392
> 
> 赞同：45
> 
> 时间：2008-10-01T16:10:15.770
> 
> 标签：database, database-design

我目前正在设计一个全新的数据库。在学校里，我们总是学会在每个表中放置一个主键。

我读了很多文章/讨论/新闻组帖子说最好使用唯一约束（也就是某些数据库的唯一索引）而不是 PK。

你的观点是什么？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-01T16:55:53.180

主键实际上只是一个不允许 NULL的[候选键。](http://en.wikipedia.org/wiki/Candidate_key)因此，在 SQL 术语中 - 它与任何其他唯一键没有什么不同。

但是，对于我们的非理论 RDBMS，您应该有一个主键 - 我从未听说过它有其他争论。如果该 Primary Key 是[surrogate key](http://en.wikipedia.org/wiki/Surrogate_key)，那么您*还*应该对[natural key(s)](http://en.wikipedia.org/wiki/Natural_key)具有唯一约束。

要放弃的重要一点是，您应该对*所有*候选键（无论是自然键还是代理键）都有唯一的约束。然后，您应该选择最容易在外键中引用的一个[作为](http://en.wikipedia.org/wiki/Foreign_key)您的主键*。

您还应该有一个[聚集索引](http://msdn.microsoft.com/en-us/library/ms190639.aspx)*. 这*可能*是您的主键，也可能是自然键 - 但也不是必须的。您应该根据表的查询使用情况选择聚集索引。如有疑问，主键是不错的首选。

*   尽管在技术上只需要引用外键关系中的唯一键，但普遍接受的标准做法是*非常*支持主键。事实上，如果某些 RDBMS 只允许主键引用，我不会感到惊讶。

*   编辑：有人指出，Oracle 的“聚集表”和“聚集索引”术语与 Sql Server 不同。我在 Oracle 语言中所说的等价物是[索引有序表](http://download.oracle.com/docs/cd/B28359_01/server.111/b28310/tables012.htm)，建议用于 OLTP 表——我认为这将是 SO 问题的主要焦点。我假设如果您负责大型 OLAP 数据仓库，您应该已经对数据库设计和优化有自己的看法。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-01T16:15:25.630

你能提供这些文章的参考吗？

我认为没有理由改变久经考验的方法。毕竟，主键是关系数据库的基本设计特征。

使用 UNIQUE 来实现相同的目的对我来说听起来很骇人听闻。他们的理由是什么？

编辑：我的注意力刚刚回到这个旧答案。也许您阅读的有关 PK 与 UNIQUE 的讨论涉及人们将某些东西作为 PK 来实现其唯一性的唯一目的。答案是，如果它是键，则将其设为键，否则将其设为 UNIQUE。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-01T16:19:01.490

主键只是一个候选键（唯一约束），被挑选出来进行特殊处理（自动创建索引等）。

我希望反对他们的人认为没有理由将一把钥匙与另一把钥匙区别对待。这就是我的立场。

[编辑] 显然，即使没有 50 分，我也无法对自己的答案发表评论。

@chris：我不认为有任何伤害。“主键”实际上只是语法糖。我一直使用它们，但我当然不认为它们是必需的。需要唯一*键*，是的，但不一定是主键。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-01T16:16:59.230

非常罕见的非规范化会让你想要一个没有主键的表。主键根据其作为 PK 的性质自动具有唯一约束。

当您想要保证添加到主键中的列的唯一性时，将使用唯一约束。

永远有一个PK的规则是一个很好的规则。

[http://msdn.microsoft.com/en-us/library/ms191166.aspx](http://msdn.microsoft.com/en-us/library/ms191166.aspx)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-01T19:20:09.137

您应该**始终**拥有一个主键。

但是我怀疑您的问题只是措辞有点误导，您实际上是要询问主键是否应该始终是自动生成的数字（也称为代理键），或者是一些实际有意义的数据的唯一字段（也称为自然key)，比如人的 SSN，书籍的 ISBN 等等。

这个问题在 DB 领域是一场古老的宗教战争。

我的看法是，如果自然键确实是唯一的并且永远不会改变，那么自然键是更可取的。但是，您应该小心，即使是像个人 SSN 这样看似稳定的东西，在某些情况下也可能会发生变化。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-01T18:20:04.223

除非该表是在您处理数据时暂存数据的临时表，否则您总是希望在表上放置一个主键，原因如下：

1 - 唯一约束可以允许空值，但主键*绝不*允许空值。如果您在具有空值的列上运行带有联接的查询，则会从结果数据集中消除这些行，因为 null 不等于 null。这就是即使是大公司也会犯会计错误并不得不重述利润的原因。他们的查询没有显示应该包含在总数中的某些行，因为在他们的唯一索引的某些列中有空值。应该使用主键。

2 - 唯一索引将自动放置在主键上，因此您不必创建一个。

3 - 大多数数据库引擎会自动在主键上放置一个聚集索引，使查询更快，因为行连续存储在数据块中。（这可以更改为将聚集索引放在不同的索引上，如果这样可以加快查询速度。）如果表没有聚集索引，则行将不会连续存储在数据块中，从而进行查询较慢，因为读/写头必须在整个磁盘上移动才能获取数据。

4 - 许多前端开发环境需要主键才能更新表或进行删除。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-01T16:17:39.120

主键应在您将建立从该表到将引用该值的其他表的关系的情况下使用。但是，根据表的性质和您正在考虑应用唯一约束的数据，您可以将该特定字段用作自然主键，而不必建立代理键。当然，代理键与自然键是完全不同的讨论。:)

如果此表与其他表之间没有建立关系，则可以使用唯一键。例如，一个包含有效电子邮件地址列表的表格，在插入新用户记录或类似之前将与之进行比较。或者，当您在具有主键但也必须绝对唯一的表中具有值时，可以使用唯一键。例如，如果您有一个包含用户名的 users 表。您不希望将用户名用作主键，但它也必须是唯一的，才能用于登录目的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T18:51:05.163

我们需要在这里区分逻辑结构和物理结构，同样也需要区分理论和实践。

首先：从理论上讲，如果没有主键，就没有表。就是这么简单。所以，你的问题不是你的表是否应该有一个主键（当然应该），而是你如何在 RDBMS 中标记它。

在物理级别，大多数 RDBMS 将主键约束实现为唯一索引。如果您选择的 RDBMS 是其中之一，那么在将列指定为主键和简单地对列设置唯一约束之间可能没有太大的实际区别。但是：其中一个选项捕获了您的意图，而另一个则没有。所以，这个决定是不费吹灰之力的。

此外，如果正确标记了主键，则某些 RDBMS 会提供其他功能，例如图表和半自动外键约束支持。

任何告诉你使用唯一约束而不是主键作为一般规则的人都应该提供一个非常好的理由。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T16:18:59.290

问题是主键可以是一个或多个唯一标识表的单个记录的列，其中唯一约束只是对字段的约束，它只允许表中任何给定数据元素的单个实例。

就个人而言，我使用 GUID 或自动递增的 BIGITS（SQL SERVER 的身份插入）作为用于在我的表之间进行交叉引用的唯一键。然后我将使用其他数据来允许用户选择特定的记录。

例如，我将有一个员工列表，并为我在幕后使用的每条记录附加一个 GUID，但是当用户选择员工时，他们会根据以下字段选择他们：LastName + FirstName + 员工编号。

在这种情况下，我的主键是 LastName + FirstName + EmployeeNumber，而唯一键是关联的 GUID。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T19:02:19.537

> 帖子说最好使用唯一约束（也就是某些数据库的唯一索引）而不是 PK

我想这里唯一的一点是相同的旧讨论“自然与代理键”，因为唯一索引和 pk 是同一回事。

翻译：

*帖子说最好使用自然键而不是代理键*

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T01:25:22.767

我通常同时使用 PK 和 UNIQUE KEY。因为即使您没有在架构中表示 PK，也会在内部为您生成一个。SQL Server 2005 和 MySQL 5 都是如此。

但我不在我的 SQL 中使用 PK 列。它用于管理目的，例如删除一些错误的行，如果设置为 AUTO INCREMENT，则找出 PK 值之间的差距。而且，将 PK 作为数字而不是一组列或字符数组是有意义的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-02T10:02:18.360

我已经写了很多关于这个主题的文章：如果您阅读我的任何内容，请清楚我可能专门指的是 Jet aka MS Access。

在 Jet 中，这些表使用非维护聚集索引（在紧凑型上聚集）在 PRIMARY KEY 上进行物理排序。如果表没有 PK 但确实有在 NOT NULL 列上使用 UNIQUE 约束定义的候选键，那么引擎将为聚集索引选择一个（如果你的表没有聚集索引，那么它被称为堆，可以说根本不是表！）引擎如何选择候选键？它可以选择一个包含可为空的列吗？我真的不知道。关键是在 Jet 中，为引擎指定聚集索引的唯一显式方法是使用 PRIMARY KEY。当然，Jet 中的 PK 还有其他用途，例如，如果在 SQL DDL 中的 FOREIGN KEY 声明中省略了一个，它将用作键，但为什么不明确。

Jet 的问题在于大多数创建表的人不知道或不关心聚集索引。事实上，大多数用户（我打赌）在每张表上都放置了一个自动增量 Autonumber 列，并仅在该列上定义 PRIMARY KEY，而没有对自然键和候选键设置任何唯一约束（自动增量列是否实际上可以被视为不向最终用户公开的密钥本身就是另一个讨论）。我不会在这里详细介绍聚集索引，但可以说 IMO 唯一的自动增量列很少是理想的选择。

无论您使用什么 SQL 引擎，PRIMARY KEY 的选择都是任意的并且是特定于引擎的。通常，引擎会对 PK 赋予特殊含义，因此您应该找出它是什么并利用它来发挥自己的优势。我鼓励人们使用 NOT NULL UNIQUE 约束，希望他们会更多地考虑所有候选键，特别是当他们选择使用（应该）在数据模型中没有意义的“自动编号”列时。但我宁愿人们选择一个经过深思熟虑的键并使用 PRIMARY KEY，而不是出于习惯将其放在自动增量列上。

所有桌子都应该有PK吗？我说是的，因为否则至少意味着您错过了引擎提供 PK 的轻微优势，最坏的情况是您没有数据完整性。

顺便说一句，Chris OC 在这里对临时表提出了一个很好的观点，它需要顺序的主键（小写），而这不能通过简单的 PRIMARY KEY 约束（大写的 SQL 关键字）来实现。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-06-24T10:05:43.273

**首要的关键**

**1\. Null** 它不允许 Null 值。因此，我们引用 PRIMARY KEY = UNIQUE KEY + Not Null CONSTRAINT。 **2\. INDEX** 默认情况下它添加一个聚集索引。 **3\. LIMIT** 一张表只能有一个 PRIMARY KEY Column[s]。

**唯一键**

**1\. Null** 允许 Null 值。但只有一个 Null 值。 **2\. INDEX** 默认情况下，它添加一个 UNIQUE 非聚集索引。 **3\. LIMIT** 一张表可以有多个UNIQUE Key Column[s]。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-01T16:26:54.310

`timestamp`如果您计划使用 LINQ-to-SQL，则如果您计划执行更新，您的表将需要主键，如果您计划在断开连接的环境中工作（例如通过 WCF 服务应用程序传递对象），它们将需要列）。

如果您喜欢 .NET，PK 和 FK 就是您的朋友。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T20:53:05.090

我认为你可能需要两者。主键本质上需要是唯一的并且不能为空。它们通常是代理键，因为整数比字符字段创建更快的连接，尤其是比多字段字符连接。但是，由于这些通常是自动生成的，因此它们不能保证数据记录的唯一性，不包括 id 本身。如果你的表有一个应该是唯一的自然键，你应该有一个唯一的索引来防止重复的数据输入。这是基本的数据完整性要求。

编辑补充：现实世界的数据通常没有真正保证规范化表结构中唯一性的自然键也是一个现实问题，特别是如果数据库是以人为中心的。姓名，甚至姓名、地址和电话号码的组合（想想父亲和儿子在同一个医疗机构）不一定是唯一的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-02-19T09:51:37.387

我自己也在想这个问题。如果你使用unique，你会伤害到2.NF。根据这一点，每个非 pk 属性都必须取决于 PK。此唯一约束中的属性对将被视为 PK 的一部分。

很抱歉 7 年后才回复这个问题，但不想开始新的讨论。

# visual-studio - 将 UI（设计器/编辑器）逻辑与包框架（如 Visual Studio 包）分离的最佳方法是什么

> ID：158420
> 
> 赞同：2
> 
> 时间：2008-10-01T16:13:59.800
> 
> 标签：visual-studio, user-interface, vsx

我想在这里分开关注点。创建自定义 XML 设计器、对象模型、验证等的所有 UI 逻辑并将其嵌入到单独的程序集中。然后，Package 框架应该只注册设计器信息并请求 UI 服务，一切都会神奇地工作。

这样，当我需要修改 UI 设计器时，我不需要使用 Package 框架（Visual Studio Package）程序集。

这个问题也适用于您必须将 UI 逻辑与加载它的 Skeleton 框架分离的任何事物，例如插件。

我有几个选择一个 ServiceProvider 模型、一个插件模型或者可能是其他的。

欢迎任何样本、模式建议、链接。

更新 1：我正在寻找的是一个想法，例如 - “Prism（复合 WPF）是否符合要求？有没有人从事过像我上面提到的那样进行关注点分离的项目/应用程序？等等”（我是还在寻找答案）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-15T07:43:18.573

我创建了一个加载编辑器的 VSPackage。编辑器位于一个单独的程序集中并实现了我定义的接口。VSPackage 与界面一起使用，因此只要我不更改界面，我对编辑器（及其程序集）所做的任何更改都不会影响 VSPackage。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:27:21.080

您对接缝的询问非常类似于[MVC](http://en.wikipedia.org/wiki/Model_view_controller)模式试图强制执行的关注点分离。

[ASP.NET MVC](http://www.asp.net/mvc/)已经有了[预览版 5](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=16775)。

它主要用于网络，但我认为他们也计划将其用于 WinForms，但我不确定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-29T09:00:14.677

我更喜欢[Model View Presenter](http://msdn.microsoft.com/en-us/magazine/cc188690.aspx#S1)模式

# winforms - 在 Winforms 应用程序中选择 Office 2003/2007 COM 对象（正确的一个）

> ID：158428
> 
> 赞同：1
> 
> 时间：2008-10-01T16:15:01.530
> 
> 标签：winforms, com, ms-office, officedev

我们正在创建一个需要引用 Office 2003 或 Office 2007 COM 对象的 Windows 窗体应用程序（C# 或 VB.NET），具体取决于安装的 Office 版本。处理这种情况并在运行时引用正确的 COM 对象的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T13:59:12.947

除非您想使用 Office 2007 对象模型的任何新添加的对象和方法，否则可以构建引用 Office 2003 PIA，只需确保在目标系统上部署了正确版本的 PIA：

> 解决此问题的另一种方法是消除对后来 PIA 的依赖。由于 Office 具有高度的向后兼容性，您可以放心地假设，如果您的加载项在 Office 2003（使用 Office 2003 PIA）上运行，那么它也应该在 Office 2007（使用 Office 2007 PIA）上运行。
> 
> （来自Andrew Whitechapel 的[无 PIA 的多个 Office 版本的加载项）](http://blogs.msdn.com/andreww/archive/2008/06/03/add-ins-for-multiple-office-versions-without-pias.aspx)

否则，我会向您推荐 Andrew Whitechapel 的以下博客文章：[您可以为多个版本的 Office 构建一个加载项吗？](http://blogs.msdn.com/andreww/archive/2007/06/15/can-you-build-one-add-in-for-multiple-versions-of-office.aspx)（请参阅 Microsoft 未正式支持此功能的 BIG 警告）。

不需要 PIA（这使部署更容易）的另一个选择是将*ComImport*与后期绑定一起使用。然而，这比使用互操作程序集要慢，但如果自动化代码不在快速路径上，这可能是一个很好的解决方案。您将在同一篇博文中找到如何实现这一点的解释：[Add-ins for Multiple Office Versions without PIAs](http://blogs.msdn.com/andreww/archive/2008/06/03/add-ins-for-multiple-office-versions-without-pias.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:23:52.663

Office 的主要互操作程序集对此没有帮助吗？我不确定，因为我不必认真使用它们，但我认为它们会。

# sql - SQL Server Reporting Services 2005 - 如何处理空报表

> ID：158431
> 
> 赞同：5
> 
> 时间：2008-10-01T16:15:24.930
> 
> 标签：sql, reporting-services, reporting, report

我想知道如果它是空的，是否可以不附加 Excel 工作表，如果它是空的，也许可以在电子邮件中写一个不同的评论。

当我去报告交付选项时，没有这样的配置。

**编辑**：我正在运行 SQL Server Reporting Services 2005。

一些可能的解决方法如下所述：

[MSDN：报告服务扩展](http://msdn.microsoft.com/en-us/library/ms152934(SQL.90).aspx)

[NoRows 和 NoRowsMessage 属性](http://technet.microsoft.com/es-es/library/microsoft.reportingservices.reportrendering.table.norows(SQL.90).aspx)

我应该调查这些事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:37:10.243

我相信答案是否定的，至少不是开箱即用。考虑到 RS 中包含的打印交付扩展示例，编写自己的交付扩展应该不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T17:06:32.543

是的，我不认为这是可能的。您可以使用表的“NoRows”属性在没有返回数据时显示消息，但这不会阻止附加报告。但至少当他们打开 excel 文件时，它可以打印出您的自定义消息而不是空文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-23T14:00:43.403

在别的地方找到这个...

我对这个问题有一个干净的解决方案，唯一的缺点是系统管理员必须创建和维护计划。尝试以下步骤：

1.  使用所有必需的收件人为报告创建订阅。

2.  将订阅设置为在​​昨天的每周运行（即如果今天是星期二，请选择星期一），计划从今天开始并在今天停止。本质上，这个时间表永远不会运行。

3.  在 SQL Management Studio 中打开新创建的作业，转到步骤并复制 SQL 行（它看起来像这样：EXEC ReportServer.dbo.AddEvent @EventType='TimedSubscription', @EventData='1c2d9808-aa22-4597 -6191-f152d7503fff')

4.  使用实际计划在 SQL 中创建自己的作业，并使用以下内容：

如果存在（选择您的测试标准...）

开始

EXEC ReportServer.dbo.AddEvent @EventType=... 等等。

结尾

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T14:25:19.340

我已经成功使用了数据驱动的订阅和包含我的订阅者的表，数据驱动的订阅查询如下所示：

```
SELECT * FROM REPORT_SUBSCRIBERS WHERE EXISTS (SELECT QUERY_FROM_YOUR_REPORT) 
```

在传递设置中，收件人是包含我的电子邮件地址的数据列。
如果内部查询没有返回任何行，则不会发送任何电子邮件。

* * *

出于您的目的，您可以利用“包括报告”和“评论”传送设置。
我想像这样的数据驱动订阅查询对你有用：

```
SELECT 'person1@domain.com; person2@domain.com' AS RECIPIENTS,
CASE WHEN EXISTS (REPORT_QUERY) THEN 'TRUE' ELSE 'FALSE' END AS INCLUDE_REPORT,
CASE WHEN EXISTS (REPORT_QUERY) THEN 'The report is attached' ELSE 'There was no data in this report' END AS COMMENT 
```

然后在为订阅配置交付设置时使用相应字段中的这些列。

# asp.net - 使用 IIS 运行 ASP.NET 应用程序的问题

> ID：158436
> 
> 赞同：1
> 
> 时间：2008-10-01T16:15:56.957
> 
> 标签：asp.net, iis

我编写了一个小型 ASP.NET 应用程序。它在使用 Visual Studio 2005 附带的小型 IIS 安装运行时运行良好，但在尝试使用 IIS 时运行良好。我在应用程序所在的 IIS 中创建了虚拟目录（通过 IIS 和 VS 2005 完成），但它不起作用。一开始我以为可能是web.config文件引起的，但经过几次测试，我认为问题出在IIS上（不确定）。

我得到的一些错误是

> 无法在 Web 服务器上开始调试。底层连接已关闭：接收器发生意外错误。单击帮助以获取更多信息

任何人都可以给我一个关于下一步尝试什么的建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T16:20:09.067

你有运行[aspnet_regiis](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/187d0e2c-8e89-49ad-a89d-e26e4d76ee68.mspx?mfr=true)吗？

这是[不同 IIS 版本设置的概述站点，](http://msdn.microsoft.com/en-us/library/ms178477.aspx)如果有其他问题/问题，应该会有所帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-11T02:17:09.930

尝试重新安装 aspnet_regiis.exe。

如果您使用 .net frameworktype 4.0 并使用 64 位系统，

转到运行，键入 cmd 和命令提示符将启动，然后键入

```
%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -i 
```

如果您使用的是 34 位系统，

转到运行类型 cmd 然后键入

```
%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet_regiis.exe -i 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:26:30.487

Make sure that the customErrors is set to off in the web.config. That should show the actual exception.

Make sure that your virtual directory in IIS is set to the correct version of the .NET framework.

Look at the properties in the virtual directory and see that the correct default documents are the ones that you are using in your dev project.

Also look at the url headers for the website in IIS.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T16:30:31.523

On some of our servers we have both versions of the .NET framework. In IIS I typically have to set what version the virtual directory should be using. This can cause problems running it on the server.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T16:19:34.093

该站点根本无法加载，或者您无法远程调试？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T16:21:37.833

一些想法：

1.  如果您尝试调试，请确保在 web.config 中启用了调试。否则，以“发布”模式构建。
2.  确保您的项目设置为应用程序，并以正确版本的 .NET 运行
3.  更多关于您的设置和错误消息的描述会很有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-01T17:36:06.637

首先确保您已经安装并配置了 IIS 服务器。检查是否安装了 IIS 服务器：运行->inetmgr 按回车。要了解如何安装和配置 IIS 服务器，请查看以下链接： [http ://chalaki.com/install-iis6-windows-xp-professional-sp3-setup-run-csharp-cgi/425/](http://chalaki.com/install-iis6-windows-xp-professional-sp3-setup-run-csharp-cgi/425/)

要使用带有 IIS 的 Visual 开发人员而不是“默认 ASP.NET 开发服务器”来开发网站，请在“位置”下的新网站窗口中单击“浏览”以查看不同的服务器选项，包括 IIS 服务器。用户可以选择服务器作为 IIS 服务器而不是“文件系统”，那么“位置”选项将是“HTTP”而不是“文件系统”。

在 Visual developer 2008 下的 Properties->Start Option->Server->"Use local IIS server" 选项没有显示，即使 IIS 服务器已成功安装和配置。显示的唯一选项是“使用默认服务器”和“使用带有基本 URL 的自定义服务器”。

所以在 Visual developer 2008 中要在 IIS 服务器上运行（如果安装了 IIS 服务器），需要执行以下操作：

新建网站 -> 在位置下点击“浏览” -> 点击“本地 IIS”，然后选择“IIS 虚拟目录”（IIS 虚拟目录是用户在配置 IIS 服务器时创建的目录） -> 打开

在运行/调试时，您在创建网站时选择的服务器，将使用同一台服务器打开网站，即在创建网站时，如果您选择“IIS服务器”，那么网站将通过 IIS 服务器打开。

还有一件事是，在安装 Visual developer 2008 和 IIS 服务器时，如果您在安装 Visual Studio 之后安装了 IIS 服务器，那么您需要在创建新网站之前执行以下操作：

运行->cmd 按回车（然后输入以下命令）-> C:\WINDOWS\Microsoft.NET\Framework\Version# aspnet_regiis -i 按回车 3 秒后收到消息“ASP.net 安装成功”。（*版本号在大多数情况下为 v2.0.50727）

# javascript - 通过javascript提交时IE7表单未提示记住密码

> ID：158438
> 
> 赞同：4
> 
> 时间：2008-10-01T16:16:32.400
> 
> 标签：javascript, html, internet-explorer-7

我有一个网站，我们使用 Javascript 提交登录表单。在 Firefox 上，它会提示用户在登录时记住他们的密码，但在 IE7 上却没有。

在做了一些研究之后，看起来只有当通过提交控件提交表单时，用户才会在 IE7 中得到提示。我创建了一些示例 html 来证明是这种情况。

```
<html>
<head>
<title>test autocomplete</title>
<script type="text/javascript">
function submitForm()
{
    return document.forms[0].submit();
}
</script>
</head>
<body>
<form method="GET" action="test_autocomplete.html">
<input type="text" id="username" name="username">
<br>
<input type="password" id="password" name="password"/>
<br>
<a href="javascript:submitForm();">Submit</a>
<br>
<input type="submit"/>
</form>
</body>
</html> 
```

href 链接没有得到提示，但提交按钮会在 IE7 中。两者都在 Firefox 中工作。

我无法使用提交按钮使我的网站的样式看起来相同，有谁知道如何在通过 Javascript 提交时显示记住密码提示？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:37:24.923

为什么不尝试以这种方式挂钩表单提交？

```
<html>
    <head>
        <title>test autocomplete</title>
        <script type="text/javascript">
            function submitForm()
            {
                    return true;
            }
        </script>
    </head>
    <body>
        <form method="GET" action="test_autocomplete.html" onsubmit="return submitForm();">
            <input type="text" id="username" name="username">
            <br>
            <input type="password" id="password" name="password"/>
            <br>
            <a href="#" onclick="document.getElementById('FORMBUTTON').click();">Submit</a>
            <br>
            <input id="FORMBUTTON" type="submit"/>
        </form>
    </body>
</html> 
```

这样，无论单击链接还是按下提交按钮（或按下回车键）都会调用您的函数，并且您可以通过返回 false 来取消提交。这可能会影响 IE7 解释表单提交的方式。

编辑：我建议始终以这种方式挂钩表单提交，而不是在表单对象上调用 submit()。如果你调用 submit() 那么它不会触发表单对象的 onsubmit。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:21:34.040

您是否尝试在 href 中放入 url 并附加一个单击事件处理程序以提交表单并从单击处理程序返回 false 以便该 url 不会被导航到。

或者通过javascript触发隐藏的提交按钮？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T19:31:50.993

您可以尝试使用 HTML <button> 标签而不是链接或提交按钮。

例如，

```
<button type="submit">Submit</button> 
```

<button> 标签比标准的 <input type="submit"> 更容易设置样式。有一些跨浏览器的怪癖，但它们并非不可克服。

一篇关于 <button> 使用的非常棒的文章可以在particletree中找到：[重新发现按钮元素](http://particletree.com/features/rediscovering-the-button-element/)

# c - Linux 中的守护进程日志记录

> ID：158457
> 
> 赞同：68
> 
> 时间：2008-10-01T16:19:28.913
> 
> 标签：c, linux, logging, daemon

所以我有一个在 Linux 系统上运行的守护进程，我想记录它的活动：日志。问题是，实现这一目标的“最佳”方法是什么？

我的第一个想法是简单地打开一个文件并写入它。

```
FILE* log = fopen("logfile.log", "w");
/* daemon works...needs to write to log */
fprintf(log, "foo%s\n", (char*)bar);
/* ...all done, close the file */
fclose(log); 
```

以这种方式记录有什么本质上的错误吗？有没有更好的办法，比如Linux内置一些框架？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-10-01T16:21:47.410

Unix 长期以来一直有一个名为[syslog](http://en.wikipedia.org/wiki/Syslog)的特殊日志记录框架。输入你的外壳

```
man 3 syslog 
```

您将获得 C 接口的帮助。

[一些](http://www.codeproject.com/KB/IP/syslog_client.aspx) [例子](http://www.c.happycodings.com/Gnu-Linux/code21.html)

```
#include <stdio.h>
#include <unistd.h>
#include <syslog.h>

int main(void) {

 openlog("slog", LOG_PID|LOG_CONS, LOG_USER);
 syslog(LOG_INFO, "A different kind of Hello world ... ");
 closelog();

 return 0;
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-01T16:27:18.707

这~~可能会是一场~~赛马，但是是的，存在于大多数（如果不是所有）Un*x 衍生产品中的 syslog 设施是首选的方式。记录到文件并没有错，但它确实会给您留下许多任务：

*   您的日志记录位置是否有文件系统来保存文件
*   缓冲（用于性能）与刷新（在系统崩溃之前写入日志）呢？
*   如果您的守护程序运行了很长时间，您会如何处理不断增长的日志文件。

Syslog 会为您处理所有这些，甚至更多。API 类似于 printf 部落，因此您在调整代码时应该没有问题。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-01T17:30:28.947

syslog 在更大（或更注重安全性）的安装中的另一个优点：可以将 syslog 守护进程配置为将日志发送到另一台服务器以进行记录，而不是（或附加于）本地文件系统。

将服务器场的所有日志放在一个地方会方便得多，而不必在每台机器上单独读取它们，尤其是当您尝试将一台服务器上的事件与另一台服务器上的事件相关联时。当一个被破解时，你就不能再信任它的日志了……但是如果日志服务器保持安全，你就知道它的日志中不会删除任何东西，所以任何入侵记录都将是完整的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-01T16:27:28.427

当我进行单元测试时，我会向 daemon.info 和 daemon.debug 吐出很多守护进程消息。syslog.conf 中的一行可以将这些消息粘贴到您想要的任何文件中。

[http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/040/4036/4036s1.html](http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/040/4036/4036s1.html)对 C API 的解释比手册页 imo 更好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T16:33:33.060

如上所述，您应该查看 syslog。但是，如果您想编写自己的日志记录代码，我建议您使用 fopen 的“a”（写入附加）模式。

编写自己的日志代码的一些缺点是：日志轮换处理、锁定（如果您有多个线程）、同步（您要等待日志写入磁盘吗？）。syslog 的缺点之一是应用程序不知道日志是否已写入磁盘（它们可能已丢失）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T16:41:43.603

Syslog 是一个不错的选择，但您可能希望考虑查看 log4c。log4[something] 框架在其 Java 和 Perl 实现中运行良好，并允许您 - 从配置文件 - 选择记录到 syslog、控制台、平面文件或用户定义的日志编写器。您可以为每个模块定义特定的日志上下文，并将每个上下文日志置于您的配置所定义的不同级别。（跟踪、调试、信息、警告、错误、关键），并让您的守护程序通过捕获信号即时重新读取该配置文件，从而允许您在正在运行的服务器上操作日志级别。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T17:32:20.330

如果您使用线程并将日志记录用作调试工具，您将需要寻找使用某种线程安全但未锁定的环形缓冲区的日志记录库。每个线程一个缓冲区，仅在严格需要时使用全局锁。

这可以避免日志记录导致您的软件严重变慢，并避免创建在您添加调试日志记录时会发生变化的 heisenbugs。

如果它有一个高速压缩的二进制日志格式，在记录过程中不会浪费时间进行格式操作，并且有一些不错的日志解析和显示工具，那是一个奖励。

我会为此提供一些好的代码参考，但我自己没有。我只想要一个。:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-02T00:41:06.587

我们的嵌入式系统没有系统日志，因此我编写的守护进程使用“a”打开模式对文件进行调试，类似于您描述的方式。我有一个打开日志文件的函数，吐出消息然后关闭文件（我只在发生意外情况时才这样做）。但是，我还必须编写代码来处理日志轮换，正如其他评论者提到的那样，它由“tail -c 65536 logfile > logfiletmp && mv logfiletmp logfile”组成。它非常粗糙，可能应该被称为“日志正面截断”，但它会阻止我们基于 RAM 磁盘的小型文件系统填满日志文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T16:26:40.580

有很多潜在的问题：例如，如果磁盘已满，您是否希望您的守护进程失败？此外，您每次都将覆盖您的文件。通常使用循环文件，以便您在机器上为文件分配空间，但您可以保留足够的历史记录以供使用，而不会占用太多空间。有像 log4c 这样的工具可以帮助你。如果您的代码是 C++，那么您可能会考虑在 Apache 项目中使用 log4cxx（apt-get install liblog4cxx9-dev on ubuntu/debian），但看起来您使用的是 C。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-09-25T22:23:13.703

So far nobody mentioned [boost log library](http://boost-log.sourceforge.net/libs/log/doc/html/index.html) which has nice and easy way to redirect your log messages to files or [syslog sink](http://boost-log.sourceforge.net/libs/log/doc/html/log/tutorial/sinks.html) or even Windows event log.

# c# - 使用复杂模式在目录中搜索文件

> ID：158460
> 
> 赞同：1
> 
> 时间：2008-10-01T16:20:02.093
> 
> 标签：c#, search, file, design-patterns

我正在寻找一个 C# 库，用于使用类似于 Ant 中使用的复杂模式从目录中获取文件或目录：

*   `dir1/dir2/**/SVN/*`--> 匹配 SVN 目录中位于目录树 dir1/dir2 下任意位置的所有文件
*   `**/test/**`--> 匹配路径中包含 test 元素的所有文件，包括 test 作为文件名。
*   ...

我需要自己编码吗？从 NAnt 中提取我想要的东西？或者这个图书馆存在，我的谷歌技能很烂。

`Directory.GetFiles(String path, String searchPattern)`不处理目录模式和[NDepend.Helpers.FileDirectoryPath](http://www.codeplex.com/FileDirectoryPath)（顺便说一句，它是一个很棒的路径操作库）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:23:53.427

自己编码不会那么难。

只需使用带有 System.IO 方法的正确公式化的正则表达式来构建完整路径

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-04T23:28:57.080

您是否愿意将“*”定义为“除斜线之外的任何内容”和“**”定义为“任何内容”？如果是这样，正则表达式转换似乎很简单。

```
*   -> [^\/]*
**  -> .* 
```

然后递归枚举所有文件，并检查它们的路径是否与正则表达式匹配。

# web-services - 如何以编程方式（合法）获取街道地址的经度和纬度

> ID：158474
> 
> 赞同：75
> 
> 时间：2008-10-01T16:22:21.277
> 
> 标签：web-services, api, geolocation, geocoding, street-address

据说，可以从谷歌地图或一些类似的服务中得到这个。（仅美国地址是不够的。）

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-01T16:24:29.633

您正在寻找的术语是地理编码，是的，谷歌确实提供了这项服务。

*   **新的 V3 API**：[http ://code.google.com/apis/maps/documentation/geocoding/](http://code.google.com/apis/maps/documentation/geocoding/)

*   旧 V2 API：[http ://code.google.com/apis/maps/documentation/services.html#Geocoding](http://code.google.com/apis/maps/documentation/services.html#Geocoding)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-01T16:34:19.627

除了前面提到的[谷歌地理编码网络服务](http://code.google.com/apis/maps/documentation/services.html#Geocoding_Direct)，还有[雅虎提供的竞争服务](http://developer.yahoo.com/geo/placefinder/)。在最近一个通过用户交互完成地理编码的项目中，我包含了对两者的支持。原因是我发现，尤其是在美国以外，他们对更隐蔽地点的处理差异很大。有时谷歌会有最好的答案，有时是雅虎。

需要注意的一个问题：如果 Google 真的认为他们不知道您的位置在哪里，他们将返回一个 602 错误指示失败。另一方面，如果雅虎可以从您的错误地址中剔除一个城市/省/州/等，它将返回该城镇中心的位置。所以你必须注意你得到的结果，看看它们是否真的是你想要的。一些结果中的辅助字段可以告诉您这一点：雅虎称此字段为“精确度”，而谷歌称其为“准确度”。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-01T16:31:45.903

如果您想在不依赖服务的情况下执行此操作，则可以从美国人口普查局下载[TIGER Shapefile 。](http://www.census.gov/cgi-bin/geo/shapefiles/national-files)

您查找您感兴趣的街道，它将有几个路段。每个段将有一个起始地址和结束地址，您可以沿该段进行插值以找到您的门牌号所在的段。

这将为您提供 lon/lat 对。

但是请记住，在线服务使用了大量的地址检查和更正，您也必须复制这些内容才能获得良好的结果。

另请注意，尽管免费数据很好，但它并不完美 - 最新的街道不在其中（它们可能在 Google 使用的数据中），并且由于调查不准确，街道可能在一定程度上偏离其真实位置。但是对于 98% 的地理编码需求，它可以完美运行，是免费的，并且您可以控制一切，因此您可以减少应用程序中的依赖性。

Openstreetmaps 的目标是映射世界上的所有事物，尽管它们并不完全存在，但值得密切关注，因为它们根据 CC 许可提供数据

但是，许多（大多数？）其他国家仅由您需要付费的政府或服务绘制。如果您不需要对大量数据进行地理编码，那么使用 Google、Yahoo 或其他一些免费的全球地图服务可能就足够了。

如果您必须对大量数据进行地理编码，那么最好从主要供应商那里租用地图数据，例如 teleatlas。

-亚当

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-15T09:36:06.350

您还可以尝试[OpenStreetMap](http://www.openstreetmap.org/) [NameFinder](http://wiki.openstreetmap.org/wiki/Namefinder)，它包含（可能）整个世界的开源、类似 wiki 的街道数据。NameFinder 将在 8 月底停止存在，但[Nominatim](http://wiki.openstreetmap.org/wiki/Nominatim)是它的替代品。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-09-29T16:49:42.337

Google 要求您使用他们的数据显示 Google 地图，每天最多 2.5k（原为 25k）HTTP 请求。有用，但您必须注意使用情况。

他们确实有

[http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders](http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders "链接到其他服务")

（谷歌已经删除了这个。如果你看到重复或缓存，我会链接到那个。）

...我在其中找到了具有可下载数据库、免费网络服务和商业网络服务的[GeoNames 。](http://www.geonames.org/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-01T16:42:27.877

如果您的网站反过来供消费者免费使用，Google 的服务条款将允许您免费使用他们的地理编码 API。如果没有，您将必须获得 Enterprise Maps 的许可证。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-03-26T19:20:03.343

用于 Drupal 和 PHP（并且易于修改）：

```
function get_lat_long($address) {
  $res = drupal_http_request('http://maps.googleapis.com/maps/api/geocode/json?address=' . $address .'&sensor=false');
  return json_decode($res->data)->results[0]->geometry->location;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T16:26:49.583

您可以在此处查看 Google Maps API 文档以开始使用：

[http://code.google.com/apis/maps/documentation/services.html#Geocoding](http://code.google.com/apis/maps/documentation/services.html#Geocoding)

这似乎也是您可以使用 Live Maps 为国际地址做的事情：

[http://virtualearth.spaces.live.com/blog/cns!2BBC66E99FDCDB98!1588.entry](http://virtualearth.spaces.live.com/blog/cns!2BBC66E99FDCDB98!1588.entry)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-04T06:51:28.860

您也可以使用 Microsoft 的 MapPoint Web 服务来做到这一点。

这是一篇解释如何的博客文章：http: [//www.codestrider.com/BlogRead.aspx? b=b5e8e275-cd18-4c24-b321-0da26e01bec5](http://www.codestrider.com/BlogRead.aspx?b=b5e8e275-cd18-4c24-b321-0da26e01bec5)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-05-13T09:15:26.393

**R代码获取街道地址的纬度和经度**

```
# CODE TO GET THE LATITUDE AND LONGITUDE OF A STREET ADDRESS WITH GOOGLE API
addr <- '6th Main Rd, New Thippasandra, Bengaluru, Karnataka'  # set your address here
url = paste('http://maps.google.com/maps/api/geocode/xml?address=', addr,'&sensor=false',sep='')  # construct the URL
doc = xmlTreeParse(url) 
root = xmlRoot(doc) 
lat = xmlValue(root[['result']][['geometry']][['location']][['lat']]) 
long = xmlValue(root[['result']][['geometry']][['location']][['lng']]) 
lat
[1] "12.9725020"
long
[1] "77.6510688" 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-07-21T17:36:55.430

如果您想在 Python 中执行此操作：

```
import json, urllib, urllib2

address = "Your address, New York, NY"

encodedAddress = urllib.quote_plus(address)
data = urllib2.urlopen("http://maps.googleapis.com/maps/api/geocode/json?address=" + encodedAddress + '&sensor=false').read()
location = json.loads(data)['results'][0]['geometry']['location']
lat = location['lat']
lng = location['lng']
print lat, lng 
```

请注意，如果 Google 看到超过一定数量的请求，它似乎确实会限制请求，因此您确实希望在 HTTP 请求中使用 API 密钥。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-02-18T22:16:12.680

我有一批 100,000 条记录要进行地理编码并遇到了 Google API 的限制（由于它是用于内部企业应用程序，我们不得不升级到他们的高级服务，即 1 万美元以上）

所以，我改用这个：[http](http://geoservices.tamu.edu/Services/Geocode/BatchProcess/) ://geoservices.tamu.edu/Services/Geocode/BatchProcess/——他们也有一个 API。（总成本约为 200 美元）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-11-21T10:45:24.223

您可以在 JavaScript 中为**kohat 之类的城市尝试此操作**

```
var geocoder = new google.maps.Geocoder();
var address = "kohat";
geocoder.geocode( { 'address': address}, function(results, status) {
var latitude = results[0].geometry.location.lat();
var longitude = results[0].geometry.location.lng();
alert(latitude+" and "+longitude);
  } 
}); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/PbbIR.png)](https://i.stack.imgur.com/PbbIR.png)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-01-31T10:22:30.593

在 python 中使用[geopy PyPI](https://pypi.org/project/geopy/) 用于获取纬度、经度、邮政编码等。这是工作示例代码..

```
from geopy.geocoders import Nominatim

geolocator = Nominatim(user_agent="your-app-id")

location = geolocator.geocode("Your required address ")

if location:
    print('\n Nominatim ADDRESS :',location.address)
    print('\n Nominatim LATLANG :',(location.latitude, location.longitude))
    print('\n Nominatim FULL RESPONSE :',location.raw)
else:
   print('Cannot Find') 
```

在**Nominatim** - 一些地址无法工作，所以我只是尝试了 [**MapQuest**](https://developer.mapquest.com/)。
它正确返回。Mapquest 提供每月 15000 笔免费计划的交易。这对我来说已经足够了。

示例代码：

```
import geocoder
g = geocoder.mapquest("Your required address ",key='your-api-key')

for result in g:
   # print(result.address, result.latlng)
   print('\n mapquest ADDRESS :',result.address,result.city,result.state,result.country)
   print('\n mapquest LATLANG :', result.latlng)
   print('\n mapquest FULL RESPONSE :',result.raw) 
```

希望能帮助到你。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-02-21T06:03:51.930

我知道这是一个老问题，但谷歌改变了定期获取纬度和经度的方式。

**HTML 代码**

```
<form>
    <input type="text" name="address" id="address" style="width:100%;">
    <input type="button" onclick="return getLatLong()" value="Get Lat Long" />
</form>
<div id="latlong">
    <p>Latitude: <input size="20" type="text" id="latbox" name="lat" ></p>
    <p>Longitude: <input size="20" type="text" id="lngbox" name="lng" ></p>
</div> 
```

**JavaScript 代码**

```
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>

    <script>
    function getLatLong()
    {
        var address = document.getElementById("address").value;
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode( { 'address': address}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var latitude = results[0].geometry.location.lat();
                document.getElementById("latbox").value=latitude;
                var longitude = results[0].geometry.location.lng();
                document.getElementById("lngbox").value=longitude;
            } 
        });
    }
    </script> 
```

# pdf - Programmatically recognize text from scans in a PDF File

> ID：158479
> 
> 赞同：30
> 
> 时间：2008-10-01T16:23:47.733
> 
> 标签：pdf, ocr

I have a PDF file, which contains data that we need to import into a database. The files seem to be pdf scans of printed alphanumeric text. Looks like 10 pt. Times New Roman.

Are there any tools or components that can will allow me to recognize and parse this text?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-01T17:43:25.157

I've used [pdftohtml](http://pdftohtml.sourceforge.net/) to successfully strip tables out of PDF into CSV. It's based on [Xpdf](http://www.foolabs.com/xpdf/portsntools.html), which is a more general purpose tool, that includes [pdftotext](http://en.wikipedia.org/wiki/Pdftotext). I just wrap it as a Process.Start call from C#.

If you're looking for something a little more DIY, there's the [iTextSharp](http://itextsharp.sourceforge.net/) library - a port of Java's [iText](http://www.1t3xt.com/products/index.php) - and [PDFBox](http://www.pdfbox.org/) (yes, it says Java - but they have a .NET version by way of [IKVM.NET](http://www.ikvm.net/)). Here's some CodeProject articles on using [iTextSharp](http://www.codeproject.com/KB/cs/PDFToText.aspx) and [PDFBox](http://www.codeproject.com/KB/string/pdf2text.aspx) from C#.

And, if you're *really* a masochist, you could call into Adobe's [PDF IFilter](http://www.adobe.com/support/downloads/detail.jsp?ftpID=2611) with COM interop. The [IFilter specs](http://msdn.microsoft.com/en-us/library/ms691105.aspx) is pretty simple, but I would guess that the interop overhead would be significant.

Edit: After re-reading the question and subsequent answers, it's become clear that the OP is dealing with *images* in his PDF. In that case, you'll need to extract the images (the PDF libraries above are able to do that fairly easily) and run it through an OCR engine.

I've used [MODI](http://en.wikipedia.org/wiki/Microsoft_Office_Document_Imaging) interactively before, with decent results. It's COM, so calling it from C# via interop is also [doable](http://secure.codeproject.com/KB/office/OCRSampleApplication.aspx) and pretty [simple](http://msdn.microsoft.com/en-us/library/aa167607.aspx):

```
' lifted from http://en.wikipedia.org/wiki/Microsoft_Office_Document_Imaging
Dim inputFile As String = "C:\test\multipage.tif"
Dim strRecText As String = ""
Dim Doc1 As MODI.Document

Doc1 = New MODI.Document
Doc1.Create(inputFile)
Doc1.OCR()  ' this will ocr all pages of a multi-page tiff file
Doc1.Save() ' this will save the deskewed reoriented images, and the OCR text, back to the inputFile

For imageCounter As Integer = 0 To (Doc1.Images.Count - 1) ' work your way through each page of results
   strRecText &= Doc1.Images(imageCounter).Layout.Text    ' this puts the ocr results into a string
Next

File.AppendAllText("C:\test\testmodi.txt", strRecText)     ' write the OCR file out to disk

Doc1.Close() ' clean up
Doc1 = Nothing 
```

Others like [Tesseract](http://code.google.com/p/tesseract-ocr/), but I have direct experience with it. I've heard both good and bad things about it, so I imagine it greatly depends on your source quality.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T17:27:34.273

You can't extract scanned text from a PDF. You need OCR software. The good news is there are a few open source applications you can try and the OCR route will most likely be easier than using a PDF library to extract text. Check out Tesseract and GOCR.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-24T21:41:27.010

I have posted about parsing pdf's in one of my blogs. Hit this link:

[http://devpinoy.org/blogs/marl/archive/2008/03/04/pdf-to-text-using-open-source-library-pdfbox-another-sample-for-grade-1-pupils.aspx](http://devpinoy.org/blogs/marl/archive/2008/03/04/pdf-to-text-using-open-source-library-pdfbox-another-sample-for-grade-1-pupils.aspx)

Edit: Link no long works. Below quoted from [http://web.archive.org/web/20130507084207/http://devpinoy.org/blogs/marl/archive/2008/03/04/pdf-to-text-using-open-source-library-pdfbox-another-sample-for-grade-1-pupils.aspx](http://web.archive.org/web/20130507084207/http://devpinoy.org/blogs/marl/archive/2008/03/04/pdf-to-text-using-open-source-library-pdfbox-another-sample-for-grade-1-pupils.aspx)

> Well, the following is based on popular examples available on the web. What this does is "read" the pdf file and output it as a text in the rich text box control in the form. The PDFBox for .NET library can be downloaded from sourceforge.
> 
> You need to add reference to IKVM.GNU.Classpath & PDFBox-0.7.3\. And also, FontBox-0.1.0-dev.dll and PDFBox-0.7.3.dll need to be added on the bin folder of your application. For some reason I can't recall (maybe it's from one of the tutorials), I also added to the bin IKVM.GNU.Classpath.dll.
> 
> On the side note, just got my copy of "Head First C#" (on Keith's suggestion) from Amazon. The book is cool! It is really written for beginners. This edition covers VS2008 and the framework 3.5.
> 
> Here you go...

```
/* Marlon Ribunal
 * Convert PDF To Text
 * *******************/

using System;
using System.Collections.Generic;
using System.Drawing;
using System.Windows.Forms;
using System.Drawing.Printing;
using System.IO;
using System.Text;
using System.ComponentModel.Design;
using System.ComponentModel;
using org.pdfbox.pdmodel;
using org.pdfbox.util;

namespace MarlonRibunal.iPdfToText
{
    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent(); 
        }

        void Button1Click(object sender, EventArgs e)    
        {    
            PDDocument doc = PDDocument.load("C:\\pdftoText\\myPdfTest.pdf");
            PDFTextStripper stripper = new PDFTextStripper();
            richTextBox1.Text=(stripper.getText(doc));
        }

     }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T16:31:18.620

At a company I used to work for, we used ActivePDF toolkit with some success:

[http://www.activepdf.com/products/serverproducts/toolkit/index.cfm](http://www.activepdf.com/products/serverproducts/toolkit/index.cfm)

I think you'd need at least the Standard or Pro version but they have trials so you can see if it'll do what you want it to.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T16:27:20.220

A quick google search shows this promising result. [http://www.pdftron.com/net/index.html](http://www.pdftron.com/net/index.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T16:30:05.470

You can use a module like perl's [PDF](http://search.cpan.org/~antro/PDF-111/PDF.pm) to extract the text. And use another tool to import the pertinent info into the database.

I am sure there are PDF components for .NET, but I have not tried any, so I don't know what is good.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T16:47:46.443

I've recently found [ReportLab](http://www.reportlab.org/rl_toolkit.html) for Python.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T17:21:54.550

If the PDF is a scans of printed text, it will be hard (involves image processing, character recognizing etc.) to do it yourself. PDF will generally store the scanned documents as JPEGs internally. You are better of using a third party tool (OCR tool) that does this.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T17:46:43.213

If I get it right, sheebz is asking how to extract PDF fields and load the data into a database. Have you looked at iTextSharp? - [http://sourceforge.net/projects/itextsharp/](http://sourceforge.net/projects/itextsharp/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-05-07T19:37:37.050

Based on Mark Brackett's answer, I created a [Nuget package](https://www.nuget.org/packages/XpdfNet) to wrap [pdftotext](https://www.xpdfreader.com/download.html).

It's [open source](https://github.com/gqy117/XpdfNet), targeting **.net standard 1.6** and **.net framework 4.5**.

Usage:

```
using XpdfNet;

var pdfHelper = new XpdfHelper();

string content = pdfHelper.ToText("./pathToFile.pdf"); 
```

# ruby-on-rails - 将数据成员注入对象

> ID：158482
> 
> 赞同：0
> 
> 时间：2008-10-01T16:24:02.053
> 
> 标签：ruby-on-rails, ruby, oop

这个问题是基于[我的另一个问题](https://stackoverflow.com/questions/150514/custom-method-in-model-to-return-an-object)（谢天谢地）。

所以如果在一个模型中我有这个：

```
def self.find_extended
    person = Person.find(:first)
    complete_name = person.firstname + ', ' + person.lastname
    return person
end 
```

如何在 person 对象中注入完整名称，以便在我的控制器/视图中我可以通过 person.complete_name 访问它？

谢谢你的时间，
西尔维

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T16:33:53.527

我认为最好的方法是在您的 Person 类中创建 complete_name 属性：

```
def complete_name
  firstname + ', ' + lastname
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-02T06:35:28.700

如果您要遍历大量记录，那么使用插值字符串将更节省内存。

```
def complete_name
  "#{firstname}, #{lastname}"
end 
```

使用`String#+`连接字符串会在每一步创建 String 对象。换句话说，如果`firstname`is`'John'`和`lastname`is `'Doe'`，那么这些字符串中的每一个都将存在于内存中，并且需要在某个时候进行垃圾收集：`'John'`、`'Doe'`、`'John, '`和 finally `'John, Doe'`。更不用说有三个方法调用而不是一个在 C 中更有效地实现的字符串插值。

如果您使用该`#{}`符号，那么您可以避免创建`'John, '`字符串。处理一两条记录时无关紧要，但在用于各种方法的大型数据集中，它可以快速加起来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T16:30:24.707

你可以定义：

```
attr_accessor :complete_name 
```

在人模型中，然后就做`person.complete_name= person.firstname + ', ' + person.lastname`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T19:31:49.590

另外，另一个快速说明。您不需要 Ruby 中的 return 语句。您方法中的最后一条语句将被返回。

# c# - c# 网络登录

> ID：158492
> 
> 赞同：5
> 
> 时间：2008-10-01T16:26:58.100
> 
> 标签：c#, networking

如何在 c# 中以编程方式执行网络登录，例如访问共享驱动程序？同样可以通过尝试通过资源管理器打开共享，或通过 net use shell 命令来实现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T16:34:38.190

[对WNetAddConnection2](http://msdn.microsoft.com/en-us/library/aa385413(VS.85).aspx)的P/Invoke 调用可以解决问题。[在这里](http://cticoder.wordpress.com/2008/08/11/msbuild-custom-task-drive-mapper/)查看更多信息。

```
[DllImport("mpr.dll")]
 public static extern int WNetAddConnection2A
 (
      [MarshalAs(UnmanagedType.LPArray)] NETRESOURCEA[] lpNetResource,
      [MarshalAs(UnmanagedType.LPStr)] string lpPassword,
      [MarshalAs(UnmanagedType.LPStr)] string UserName, int dwFlags
 ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:31:55.513

您需要使用 Windows 身份模拟，看看这些链接 [http://blogs.msdn.com/shawnfa/archive/2005/03/21/400088.aspx](http://blogs.msdn.com/shawnfa/archive/2005/03/21/400088.aspx) [http://blogs.msdn.com/saurabhkv /archive/2008/05/29/windowsidentity-impersonation-using-c-code.aspx](http://blogs.msdn.com/saurabhkv/archive/2008/05/29/windowsidentity-impersonation-using-c-code.aspx)

# jquery - How to use JQuery UI datepicker with bgIframe on IE 6

> ID：158502
> 
> 赞同：1
> 
> 时间：2008-10-01T16:30:17.017
> 
> 标签：jquery, datepicker, bgiframe

I am trying to use the JQuery UI datepicker (latest stable version 1.5.2) on an IE6 website. But I am having the usual problems with combo boxes (selects) on IE6 where they float above other controls. I have tried adding the bgIframe plugin after declaring the datepicker with no luck.

My guess is that the .ui-datepicker-div to which I am attaching the bgIframe doesn't exist until the calendar is shown.

I am wondering if I can put the .bgIframe() command directly into the datepicker .js file and if so, where? (the similar control by kelvin Luck uses this approach)

Current code

$(".DateItem").datepicker({
showOn:"button",
... etc ...
});
$(".ui-datepicker-div").bgIframe();

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:59:40.703

默认情况下，这应该为您处理好。

iframe 默认包含在 IE6 的 datepicker 中。它的样式，称为 ui-datepicker-cover 处理透明度。唯一不是这种情况的情况是在旧的 themeroller 代码中没有样式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-27T14:21:03.983

由于这个问题，我也很担心。解决方案变为以下。

```
$(".DateItem").datepicker({
  showOn:"button",
  beforeShow:function(){
    $('#ui-datepicker-div').bgiframe();
  },
  ... etc ...
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T10:37:30.287

我注意到 Marc 的评论，即 ui-datepicker-cover 样式应该处理这个问题。在我的情况下，日历的右边缘和下边缘仍会显示下拉菜单。

看起来 iFrame 的大小最初是由以下代码行设置的

```
if ($.browser.msie && parseInt($.browser.version, 10) < 7) // fix IE < 7 select problems
$('iframe.ui-datepicker-cover').css({ width: inst.dpDiv.width() + 4, height: inst.dpDiv.height() + 4 }); 
```

在 postProcess 函数中。

每次更改日期时都会重置此大小

```
inst.dpDiv.empty().append(this._generateHTML(inst)).
find('iframe.ui-datepicker-cover').
css({ width: dims.width, height: dims.height }); 
```

我最简单的解决方案是删除这两组代码并修复 .css 文件中封面样式的大小

```
//if ($.browser.msie && parseInt($.browser.version, 10) < 7) // fix IE < 7 select problems
//    $('iframe.ui-datepicker-cover').css({ width: inst.dpDiv.width() + 4, height: inst.dpDiv.height() + 4 });

inst.dpDiv.empty().append(this._generateHTML(inst))//.    <=== note the // before the .
//find('iframe.ui-datepicker-cover').
//css({ width: dims.width, height: dims.height }); 
```

在 css 文件中设置 .ui-datepicker-cover 的宽度为 220px，高度为 200px

史蒂夫

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-08T20:18:45.043

i had something like this and to use the bgIframe plugin, just i put the `bgiframe();` function inside `onBeforeShow()` datepicker's method

check it

```
$('#date').DatePicker({
format:'Y/m/d',
date: $('#date').val(),
current: $('#date').val(),
position: 'r',
onBeforeShow: function(){
    $('#date').DatePickerSetDate($('#date').val(), true);
    $('.datepickerContainer').bgiframe();
},
onChange: function(formated, dates){
    $('#date').val(formated);
    $('#date').DatePickerHide();
}
}); 
```

# reportviewer - ReportViewer 除以零

> ID：158508
> 
> 赞同：1
> 
> 时间：2008-10-01T16:30:37.233
> 
> 标签：reportviewer

我的报告中有一些公式，为了防止除以零，我在表达式字段中这样做：

=IIF（字段！F1.Value <> 0，字段！F2.Value/字段！F1.Value，0）

这通常可以正常工作，但是当 F1 和 F2 都为零时，我在报告中收到“#Error”，并收到以下警告：“文本框‘textbox196’的值表达式包含错误：试图除以零。 "

这是为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T16:34:09.050

IIF() 只是一个函数，与任何函数一样，*所有参数都在调用函数**之前*进行评估，包括`Fields!F2.Value/Fields!F1.Value`. 换句话说，不管`Fields!F1.Value <> 0`条件如何，它都会尝试除以零。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T18:27:11.853

必须有比这更漂亮的方法，但这应该有效：

```
=IIF(Fields!F1.Value <> 0, Fields!F2.Value / 
   IIF(Fields!F1.Value <> 0, Fields!F1.Value, 42), 0) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-30T10:26:39.990

但是，您可以使用

```
if Fields!F1.Value <> 0 
then 
Fields!F2.Value/Fields!F1.Value
else 0 
```

这应该有效，因为如果“if”部分为假，它不会评估 then 子句。

# .net - .NET企业应用平台（同JBoss转Java）

> ID：158509
> 
> 赞同：7
> 
> 时间：2008-10-01T16:30:38.403
> 
> 标签：.net, jboss, middleware

作为一名 .NET 开发人员，我想问是否存在 JBoss 替代方案以“更适合 .NET 开发”作为企业应用程序平台。

请不要提出任何建议，比如“让 JBoss 暴露 WebServices”……

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T14:58:51.283

Java 缺乏“托管”解决方案——这就是（主要）出现 JBoss 和 WhebLogic 等所有解决方案的地方。在 .NET 中，您有许多不同的托管解决方案，例如：服务、IIS、SQL、BizTalk ...

现在，借助最近的 WCF 功能，您可以在 5 分钟内实现自己的 JBoss - 创建一个具有数据和消息传递协定的对象，删除几行配置文件以通过 Web/其他服务公开接口并定义一个线程模型 - 您获得自己的 JBoss。Java 在他们的工具箱中没有这样的故事——这就是为什么你需要像 JBoss 这样的东西。[当然，我把事情过于简单化了，但在 80% 的情况下这是事实]。

如果您注意到像 Apache CX 服务这样的解决方案 - 越来越多的人正在远离 JBoss。现在他们可以找到替代方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-06T01:53:59.460

我也不太确定你在找什么。但是，如果您正在寻找适用于 .Net 的企业应用平台，您可以在 www.netquarry.com 上查看我们的产品 NetQuarry。

NetQuarry企业应用平台使用IIS作为应用服务器，在对象关系映射、丰富的AJAX UI等基础之上，提供了功能丰富的应用支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:45:29.477

如果您正在寻找 Java 应用程序服务器，可以使用 WebSphere 和 WebLogic。但从你的预期来看，它可能与 jBoss 略有不同。

你在找什么？jBoss 做了哪些您希望替代品做的事情？您是否正在寻找 .NET 中的内容？您的 .NET 代码是与服务器交互的客户端，还是在 .NET 中编写服务器？

# svn - 是否可以使 git svn dcommit 导致单个 svn 提交？

> ID：158514
> 
> 赞同：42
> 
> 时间：2008-10-01T16:31:22.737
> 
> 标签：svn, git, git-svn

根据[手册](http://git-scm.com/docs/git-svn)，`git dcommit`“将为 git 中的每个提交在 SVN 中创建一个修订版。” 但是有没有办法避免多次 Subversion 修订？也就是说，在执行`svn commit`?之前让 git 合并所有更改。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-01T16:43:10.010

如果你在 git 中的一个分支上工作，你可以[`git-merge --squash`](http://git-scm.com/docs/git-merge)在 git 中执行此操作。然后，您可以将一个压缩的提交推送到 SVN。

当然，很多小的提交是好的，那你为什么要压缩它们呢？

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-02T18:01:41.983

该命令`git rebase -i`可以做到这一点，甚至更多。这个命令非常强大，所以和它交朋友很好。

语法是：`git rebase -i <commit ID>`. 这将打开您的文本编辑器，其中包含用于修改所有提交（不包括）给定 ID 的选项（和说明）。

例如，要修改前 5 次提交，您可以这样做：

`git rebase -i HEAD~5`

或者如果你的 SVN 分支被称为“svn/trunk”，那么这个语法也很好：

`git rebase -i svn/trunk`

然后会弹出一个文本编辑器窗口。要压缩所有内容，请将第一行之后的第一个单词从“pick”更改为“squash”（如果这听起来令人困惑——当你看到它时会更有意义）。然后保存并关闭编辑器。然后，您将有机会编辑压缩提交的提交消息。

您可以使用 进行的其他操作`git rebase -i`包括重新排序提交、以不同方式压缩提交以及删除提交。

我经常使用这个命令；这是 Git 的杀手级功能。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-13T21:00:11.703

[Ryan Tomayko](http://tomayko.com/writings/the-thing-about-git)写了一些关于 的文章`git rebase -i`，他说：

> …[它]有点像 git commit --amend 跳上酸并拿着电锯——完全疯狂而且非常危险，但能够暴露出全新的心态。在这里，您可以以比应有的方式更容易和更直观的方式编辑、压缩、重新排序、梳理和注释现有提交。

我倾向于经常在 git 中提交，但不一定想将*每次*提交都提交到 svn，并且压缩我所有的工作也没有什么意义。我现在正在尝试将一些重新排序并压缩成更合乎逻辑的提交单元。

# sql - How to handle a lot of flags for a SQL record

> ID：158519
> 
> 赞同：7
> 
> 时间：2008-10-01T16:32:35.717
> 
> 标签：sql, sql-server-2008, bit-manipulation

I need advice on how to handle relatively large set of flags in my SQL2k8 table.

Two question, bear with me please :)

Let's say I have 20 flags I'd like to store for one record.

For example:

CanRead = 0x1 CanWrite = 0x2 CanModify = 0x4 ... and so on to the final flag 2^20

Now, if i set the following combination of one record: Permissions = CanRead | CanWrite

I can easily check whether that record has required permission by doing WHERE (Permissions & CanRead) = CanRead

That works.

But, I would also like to retrieve all records that can either write OR modify.

If I issue WHERE (Permissions & ( CanWrite | CanModify )) = (CanWrite | CanModify) i obviously won't get my record that has permissions set to CanRead | CanWrite

In other words, how can I find records that match ANY of the flags in my mask that i'm sending to the procedure?

Second question, how performant is in in SQL 2008? Would it actually be better to create 20 bit fields?

Thanks for your help

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-01T17:11:30.257

我假设您的 Permissions 列是一个 Int。如果是这样，我鼓励您使用我在下面提供的示例代码。这应该让您清楚地了解该功能是如何工作的。

```
Declare @Temp Table(Permission Int, PermissionType VarChar(20))

Declare @CanRead Int
Declare @CanWrite Int
Declare @CanModify Int

Select @CanRead = 1, @CanWrite = 2, @CanModify = 4

Insert Into @Temp Values(@CanRead | @CanWrite, 'Read,write')
Insert Into @Temp Values(@CanRead, 'Read')
Insert Into @Temp Values(@CanWrite, 'Write')
Insert Into @Temp Values(@CanModify | @CanWrite, 'Modify, write')
Insert Into @Temp Values(@CanModify, 'Modify')

Select * 
From   @Temp 
Where  Permission & (@CanRead | @CanWrite) > 0

Select * 
From   @Temp 
Where  Permission & (@CanRead | @CanModify) > 0 
```

当您使用逻辑与时，您将根据您的条件得到一个适当设置为 1 的数字。如果没有匹配项，则结果为 0。如果匹配 1 个或多个条件，则结果将大于 0。

让我给你看一个例子。

假设 CanRead = 1、CanWrite = 2 和 CanModify = 4。有效组合为：

```
Modify Write Read Permissions
------ ----- ---- -----------
  0       0    0   Nothing
  0       0    1   Read
  0       1    0   Write
  0       1    1   Read, Write
  1       0    0   Modify
  1       0    1   Modify, Read
  1       1    0   Modify, Write
  1       1    1   Modify, Write, Read 
```

现在，假设您要测试读取或修改。从您的应用程序中，您将传入 (CanRead | CanModify)。这将是 101（二进制）。

首先，让我们针对 ONLY 读取的表中的一行进行测试。

```
 001 (Row from table)
&  101 (Permissions to test)
------
   001 (result is greater than 0) 
```

现在，让我们针对只有 Write 的行进行测试。

```
 010 (Row from table)
&  101 (Permission to test)
------
   000 (result = 0) 
```

现在针对具有所有 3 个权限的行对其进行测试。

```
 111 (Row from table)
&  101 (Permission to test)
------
   101 (result is greater than 0) 
```

我希望您能看到，如果 AND 操作的结果是 value = 0，那么测试的权限都不会应用于该行。如果该值大于 0，则至少存在一行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T16:52:05.170

**不要那样做。**这就像将 CSV 字符串保存到备忘录字段中并破坏了数据库的目的。

为每个标志使用一个布尔（位）值。在这个特定的示例中，您会发现可以读取和写入或修改的所有内容：

```
WHERE CanRead AND (CanWrite OR CanModify) 
```

简单的纯 SQL，没有巧妙的技巧。您为每个标志浪费的额外 7 位不值得头疼。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T16:39:48.240

What about

```
WHERE (Permissions & CanWrite) = CanWrite 
OR (Permissions & CanModify) = CanModify 
```

?

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T16:42:36.267

WHERE (Permissions & CanWrite) = CanWrite OR (Permissions & CanModify) = CanModify

I think

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T16:50:30.803

是不是很简单...

```
WHERE (Permissions & ( CanWrite | CanModify )) > 0 
```

...因为任何设置为 1 的“位”都将导致“&”运算符的非零值。

天色已晚，我正要回家，所以我的大脑可能工作效率低下。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T16:48:35.817

拥有不同的权限模型会好得多。

20 个标志向我表明需要重新考虑，大多数文件系统可以通过 12 个基本标志和 ACLS 来解决 - 可能有一个单独的表，仅授予权限，或者对对象或访问器进行分组以允许不同的控制。

我希望选择更快地拥有 20 个单独的字段 - 但我也不会添加 20 个字段以提高性能。

- 更新 -

原始查询写为

```
 WHERE (Permissions & ( CanWrite | CanModify )) > 0 
```

就足够了，但是听起来好像您在数据库中拥有的是实体可以拥有的一组属性。在这种情况下，唯一明智的（在数据库方面）这样做的方法是与属性表建立一对多的关系。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T20:10:50.183

仅当您还通过其他键进行查询时才执行此操作。

如果您通过标志组合进行查询，请不要这样做。一般而言，针对此列的索引不会对您有所帮助。您将仅限于表扫描。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T16:49:25.923

不，那是行不通的。

我只向程序发送一个口罩

@filter 之类的东西，在 C# 中我用 @filter = CanModify | 填充。能写

因此，该过程将 OR-ed 值作为过滤器。

哦，顺便说一句，它不是一个权限模型，我只是用它作为一个例子。

我的对象确实有大约 20 个独特的标志。

# powershell - 在 PowerShell 中，如何确定驱动器的根目录（假设它是网络驱动器）

> ID：158520
> 
> 赞同：1
> 
> 时间：2008-10-01T16:33:08.867
> 
> 标签：powershell, networking, mapped-drive

在 PowerShell 中，即使可以知道驱动器是否为网络驱动器：请参阅[在 PowerShell 中，如何确定当前驱动器是否为网络驱动器？](https://stackoverflow.com/questions/158359/in-powershell-how-can-i-determine-if-the-current-drive-is-a-networked-drive-or)

当我尝试获取驱动器的“根”时，我得到了驱动器号。

设置：MS-Dos "net use" 显示 H: 实际上是一个映射的网络驱动器：

```
New connections will be remembered.

Status       Local     Remote                    Network
-------------------------------------------------------------------------------
OK           H:        \\spma1fp1\JARAVJ$        Microsoft Windows Network

The command completed successfully. 
```

Get-PSDrive 告诉我们 Root 是 H：

```
PS:24 H:\temp
>get-psdrive  h

Name       Provider      Root      CurrentLocation
----       --------      ----      ---------------
H          FileSystem    H:\          temp 
```

并且使用 system.io.driveinfo 并没有给我们一个完整的答案：

```
PS:13 H:\
>$x = new-object system.io.driveinfo("h:\")
PS:14 H:\
>$x.DriveType
Network
PS:15 H:\
>$x.RootDirectory

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
d----        29/09/2008     16:45            h:\ 
```

知道如何获取该信息吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2016-04-11T13:36:38.800

诀窍是属性名称与预期不同。尝试：

`(Get-PSDrive h).DisplayRoot`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T16:35:01.247

尝试 WMI：

```
Get-WMIObject -query "Select ProviderName From Win32_LogicalDisk Where DeviceID='H:'" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T17:21:42.447

$drive = gwmi win32_logicaldisk -filter "DeviceID='H:'" if($drive.DriveType -eq 4) {write-host "drive is a network share"}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T15:00:44.623

$fso=new-object -com "Scripting.Filesystemobject" $fso.GetDrive("Y").ShareName

# .net - 有没有一种简单的方法可以使用 DataContext 实现 LINQ 到对象？

> ID：158521
> 
> 赞同：0
> 
> 时间：2008-10-01T16:33:26.867
> 
> 标签：.net, linq, orm

我有一个有效的 LINQ to SQL 模型。我希望能够使用相同的模型，但连接到 DataSet 对象，而不是 SQL Server。

我需要能够查询模型、修改字段以及进行插入和删除操作。有没有简单的方法来实现这一点？

我注意到[另一个问题](https://stackoverflow.com/questions/142762/is-there-a-datacontext-in-linq-to-entities-not-linq-to-sql)提到了类似的情况，但我不确定这是否适用于我的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T16:37:04.037

您可以直接使用[LINQ to DataSet](http://msdn.microsoft.com/en-us/library/bb386977.aspx)，但 LINQ to SQL 查询转换器将表达式树转换为 SQL 语句，并且无法更改。

对于给定 DataContext 的插入/更新/删除列表，您可以调用[**`DataContext.GetChangeSet()`**](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:03:46.697

您需要一个由 DataSet 支持的 DataContext。不，除非您构建它，否则它不存在。

# c++ - Reading a windows *.dmp file

> ID：158534
> 
> 赞同：15
> 
> 时间：2008-10-01T16:35:20.903
> 
> 标签：c++, c, windows

I was wonder if any knows how to open up a windows *.dmp file after a application crash written C/C++.

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-01T16:45:46.150

Using Visual Studio's *File>Open Project* or the free WinDbg's (part of [Debugging Tools for Windows](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)) *File>Open Crash Dump* select the dmp file.

Make sure to configure the tools to include a path to the location of the PDB debugging symbols for that application (you do have symbols right?). Either tool has a thread and call stack window that should give you a good idea where the crash occurred. Including paths to the source code will help as well.

Symbol and Source paths can be set in WinDbg under the File menu. It's buried in Visual Studio under *Tools>Options>Debugging>Symbols* and *Tools>Options>Project and Solutions>VC++ Directores*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T16:40:04.853

Here's a link to an article from Microsoft on [reading the small memory dump files that Windows creates for debugging](http://support.microsoft.com/kb/315263)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T17:31:43.263

使用[Windows 调试工具](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)时，请务必设置符号。对于 Microsoft 符号，请使用：SRV*DownstreamStore* [http://msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols)

例如：SRV*c:\websymbols* [http://msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols)

查看这些博客以了解有关调试的更多信息：

*   [http://blogs.msdn.com/tom](http://blogs.msdn.com/tom)
*   [http://blogs.msdn.com/ntdebugging](http://blogs.msdn.com/ntdebugging)
*   [http://blogs.msdn.com/tess](http://blogs.msdn.com/tess)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T16:41:24.197

If you mean a dump file created by windows (either small memory dump, kernel memory dump or full memory dump) that is created after a system crash then you need [WinDBG](http://msdn.microsoft.com/en-us/library/windows/hardware/ff551063%28v=vs.85%29.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T16:44:26.873

You should be able to just double click the .dmp file to automatically open it in Visual Studio. If the .pdb file that was generated when the program was compiled is still around, Visual Studio should be able to automatically load the symbols from that. From then on, you can just hit Run/Debug (F5) to start peeking into the .dmp file.

# c# - Setting Focus on a Control within a ControlTemplate in WPF

> ID：158536
> 
> 赞同：3
> 
> 时间：2008-10-01T16:35:43.070
> 
> 标签：c#, .net, wpf, xaml, controls

In an application I'm working on, we have a bunch of custom controls with their ControlTemplates defined in Generic.xaml.

For instance, our custom textbox would look similar to this:

```
<Style TargetType="{x:Type controls:FieldTextBox}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type controls:FieldTextBox}">
                <Border BorderThickness="0" Margin="5">
                    <StackPanel ToolTip="{Binding Path=Field.HintText, RelativeSource={RelativeSource TemplatedParent}}">
                        <TextBlock Text="{Binding Path=Field.FieldLabel, RelativeSource={RelativeSource TemplatedParent}}" 
                                   HorizontalAlignment="Left" 
                                   />
                        <TextBox Width="{Binding Path=Field.DisplayWidth, RelativeSource={RelativeSource TemplatedParent}}" 
                                 HorizontalAlignment="Left" 
                                 Text="{Binding Path=Field.Data.CurrentValue, RelativeSource={RelativeSource TemplatedParent}}" 
                                 IsEnabled="{Binding Path=Field.IsEnabled, RelativeSource={RelativeSource TemplatedParent}}"
                                 ContextMenu="{Binding Source={StaticResource FieldContextMenu}}" >
                            <TextBox.Background>
                                <SolidColorBrush Color="{Binding Path=Field.CurrentBackgroundColor, RelativeSource={RelativeSource TemplatedParent}}"/>
                            </TextBox.Background>
                        </TextBox>
                    </StackPanel>
                </Border>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
    <Setter Property="Focusable" Value="True" />
    <Setter Property="IsTabStop" Value="False" />
</Style> 
```

In our application, we need to be able to programatically set the focus on a particular control within the ControlTemplate.

Within our C# code, we can get to the particular "FieldTextBox" based on our data. Once we have the correct FieldTextBox, we need to be able to set the focus on the actual TextBox contained within the ControlTemplate.

The best solution I've come up with is to set a name on the primary control in each control template (in this case it's the TextBox), such as "FocusableControl."

My code (contained in the code-behind for the FieldTextBox) to then set focus on the control would be:

```
 Control control = (Control)this.Template.FindName("FocusableControl", this);
    if (control != null)
    {
        control.Focus();
    } 
```

This solution works. However, does anyone else know of a solution that would be more efficient than this?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T16:47:19.067

Within your control template you can add a Trigger that sets the FocusedElement of the StackPanel's [FocusManager](http://msdn.microsoft.com/en-us/library/system.windows.input.focusmanager.focusedelement.aspx) to the textbox you want focused. You set the Trigger's property to {TemplateBinding IsFocused} so it fires when the containing control is focused.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:47:48.330

您可以通过提供一些 DependancyProperty 来摆脱代码中控件名称的硬编码，并在基于 DependancyProperty 的 controlLoaded 或 OnApplyTemplate 函数中具有相同的代码。此 DependancyProperty 的发件人将成为 .Focus() 调用的候选者。

# html - 不能在 Firefox 和 chrome 中工作

> ID：158539
> 
> 赞同：12
> 
> 时间：2008-10-01T16:36:07.360
> 
> 标签：html

换行标记在 Firefox 中不起作用，在 chrome 中也不起作用。当我看到我的页面的来源时，我得到：

```
<p>Zugang zu Testaccount:</br></br>peter petrelli </br></br>sein Standardpwd.</br></br>peter.heroes.com</p> 
```

但是，当我查看选定的源时，我得到：

```
<p>Zugang zu Testaccount: peter petrelli  sein Standardpwd. peter.heroes.com</p> 
```

似乎 Firefox 正在过滤断线标签。

它在 IE7 中运行良好。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-10-01T16:37:19.387

你正在寻找`<br />`而不是`</br>`

自闭合标签（如*br*）在标签末尾有斜线。

以下是 XHTML 中的其他自闭合标记：

*   [XHTML 中所有有效的自关闭标记（由主要浏览器实现）是什么？](https://stackoverflow.com/questions/97522/what-are-all-the-valid-self-closing-tags-in-xhtml-as-implemented-by-the-major-b)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-10-31T11:47:56.987

如果您试图在两个 div 之间放置空间并且`<br/>`不工作，则插入此代码（在 div 之间）以使`<br/>`标签工作。

```
<div class="clear"></div> 
```

并添加

```
.clear {
    clear: both;
} 
```

在你的 css 文件中。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-01T16:37:25.407

br 标签应该是：

```
<br/> 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-01T16:37:37.137

应该`<br>`或`<br />` **不应该** `</br>`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-01T16:39:03.377

IE7 更能容忍 quirksmode 中的错误语法。

而不是`<br>`or`</br>`它应该是`<br />`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-01T16:37:35.873

那是因为`</br>`是一个无效的标签。你想要的是`<br />`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T16:51:16.560

应该只在您编写 XHTML 时使用。如果您使用 validator.w3.org 将以下内容验证为 HTML 4.01：

```
<html>
<head>
<title></title>
</head>
<body>
<p>
<br />
</p>
</body>
</html> 
```

生成此警告：

第 8 行，第 3 列：启用 NET 的起始标记需要 SHORTTAG YES。

```
<br /> 
```

根据文档的 DOCTYPE，可以至少以两种不同的方式解释该序列。对于 HTML 4.01 Strict，'/' 终止标记 ')。然而，由于许多浏览器不以这种方式解释它，即使存在 HTML 4.01 Strict DOCTYPE，最好在纯 HTML 文档中完全避免它，并仅将其用于以 XHTML 编写的文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T16:36:31.307

它应该只是<br>。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T16:37:27.403

你想要 <BR> 或 <BR />，而不是 </BR>

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-05-31T09:49:26.743

如果您使用的是 struts 集`escapeXml="false"`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-05-17T15:19:17.217

不是`</br>`，是`<br>`或`<br />.`

所以，这不能按预期工作：

```
<!doctype html>
<html>
 <head>
  <title></title>
 </head>
 <body>
  <p>
   Some text... </br>
   Some more text...
  </p>
  More content...
 </body>
</html> 
```

但这有效：

```
<!doctype html>
<html>
 <head>
  <title></title>
 </head>
 <body>
  <p>
   Some text... <br>
   Some more text... <br />
  </p>
  More content...
 </body>
</html> 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2020-09-15T07:05:02.850

或者，`<br />`您`<br>`可以使用`<p></p>`或`</p>`

# javascript - 选中/取消选中父母和孩子

> ID：158544
> 
> 赞同：3
> 
> 时间：2008-10-01T16:36:59.213
> 
> 标签：javascript, jquery

你能写出更好的代码吗？我需要根据父母检查/取消选中所有孩子，当检查孩子时，检查父母，当所有孩子都未选中时，取消检查父母。

```
 $(".parent").children("input").click(function() {
    $(this).parent().siblings("input").attr("checked", this.checked);
});

$(".parent").siblings("input").click(function() {
    if (this.checked) {
        $(this).siblings("div").children("input").attr("checked", true);
        return;
    }

    var childs = $(this).siblings("div").siblings("input");

    for (i = 0; i < childs.length; i++) {
        if ($(childs.get(i)).attr("checked"))
            return;
    }

    $(this).parent().children("div").children("input").attr("checked", false);
}); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T21:14:55.473

```
$(".parent").children("input").click(function() {
    $(this).parent().siblings("input").attr("checked", this.checked);
});

$(".parent").siblings("input").click(function() {
    $(this).siblings("div").children("input").attr("checked",
        this.checked || $(this).siblings("input[checked]").length>0
    );
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T02:29:18.683

哇，我很困惑。看起来好像您在其中有其他输入的输入？......这没有意义。这就是我*认为*你的结构的样子，所以我开始了。

```
<div class="parent">
    <input type="checkbox" />
    <div>
        <input type="checkbox" />
        <input type="checkbox" />
    </div>
    <input type="checkbox" />
    <div>
        <input type="checkbox" />
        <input type="checkbox" />
    </div>
</div> 
```

这是我要使用的代码。

```
$("input[type='checkbox']").click(function() {
    // turn on or off all descendants.
    $(this)         // get this checkbox
        // get the div directly after it
        .next('div')
        // get ALL the inputs in that div (not just first level children)
        .find("input[type='checkbox']")
        .attr("checked", this.checked)
    ;

    // now check if we have to turn the parent on or off.
    $(this)
        .parent()  // this will be the div
        .prev('input[type="checkbox"]')  // this is the input
        .attr(
            "checked",     // set checked to true if...
            this.checked   // this one is checked, or...
            || $(this).siblings("input[type='checkbox'][checked]").length > 0
                           // any of the siblings are checked.
        )
    ;
}); 
```

更新：我刚刚对此进行了测试，它完全有效（哇！）。它还可以根据需要使用任意多的嵌套级别，而不仅仅是两个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-28T21:24:20.077

这是一个可爱的小线程，它让我几乎到达了我需要的地方。我稍微修改了 Nickf 的代码。目的是检查孩子也会检查父母，取消检查父母也会取消检查所有孩子。

$("input[type='checkbox']").click(function() { if (!$(this.checked)) {

```
$(this) 
    .next('div')
    .find("input[type='checkbox']")
    .attr("checked", this.checked)
;
}

$(this)
    .parent()  
    .prev('input[type="checkbox"]')  
    .attr("checked", this.checked || $(this).siblings("input[type='checkbox'][checked]").length > 0

    )
; 
```

});

如果父项未选中，将如何进行调整以使所有后代都未选中？

新的所有东西 JQ 和 javascript..apologies。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-04T14:56:56.797

```
$('.parent').click(function(){
    checkBox = $(this).find('input[type=checkbox]');
    checkBox.prop("checked", !checkBox.prop("checked")); // inverse selection
}); 
```

最终的。

# python - 在 python 中存储和使用大型文本文件的最佳方法

> ID：158546
> 
> 赞同：5
> 
> 时间：2008-10-01T16:37:08.153
> 
> 标签：python, boggle

我正在为我用 python 编写的 boggle-clone 创建一个网络服务器，它接受用户，解决板子，并对玩家输入进行评分。我使用的字典文件是 1.8MB（ENABLE2K 字典），我需要它可用于多个游戏求解器类。现在，我拥有它，以便每个类逐行遍历文件并生成一个哈希表（关联数组），但是我实例化的求解器类越多，占用的内存就越多。

我想做的是一次导入字典文件，然后在需要时将其传递给每个求解器实例。但是最好的方法是什么？我应该在全局空间中导入字典，然后在求解器类中以 globals()['dictionary'] 的形式访问它吗？或者我应该导入字典然后将它作为参数传递给类构造函数？其中一个比另一个更好吗？有第三种选择吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T17:30:41.083

如果您创建一个 dictionary.py 模块，其中包含读取文件并构建字典的代码，则此代码将仅在第一次导入时执行。进一步的导入将返回对现有模块实例的引用。因此，您的课程可以：

```
import dictionary

dictionary.words[whatever] 
```

哪里 dictionary.py 有：

```
words = {}

# read file and add to 'words' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:55:23.103

尽管此时它本质上是一个单例，但通常反对全局变量的论点仍然适用。对于 pythonic 单例替代，查找“borg”对象。

这真的是唯一的区别。创建字典对象后，除非您明确执行深层复制，否则您只会在传递它时绑定新引用。只要每个求解器实例不需要私有副本进行修改，就可以集中构造一次且仅一次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:00:11.583

亚当，当你说：

```
a = read_dict_from_file()
b = a 
```

...您实际上并没有*复制* `a`，因此使用了更多内存，您只是`b`对同一对象进行了另一个引用。

所以基本上你提出的**任何**解决方案在内存使用方面都会好得多。基本上，在字典中阅读**一次**，然后继续参考。无论您是使用全局变量，还是将其传递给每个实例或其他东西，您都将引用同一个对象而不是复制它。

哪一个最Pythonic？这是一个完整的“另一罐蠕虫”，但这是我个人会做的事情：

```
def main(args):
  run_initialization_stuff()
  dictionary = read_dictionary_from_file()
  solvers = [ Solver(class=x, dictionary=dictionary) for x in len(number_of_solvers) ] 
```

HTH。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T19:38:26.860

根据您的 dict 包含的内容，您可能对“搁置”或“anydbm”模块感兴趣。它们为您提供类似 dict 的接口（只是字符串作为“anydbm”的键和项目，字符串作为键和任何 python 对象作为“搁置”的项目）但数据实际上位于 DBM 文件中（gdbm、ndbm、dbhash、 bsddb，取决于平台上可用的内容。）您可能仍希望按照您的要求在类之间共享实际数据库，但它会避免解析文本文件步骤以及保留所有内容-记忆位。

# iphone - 获取纬度/经度对的街道地址

> ID：158557
> 
> 赞同：22
> 
> 时间：2008-10-01T16:38:55.903
> 
> 标签：iphone, web-services, gis, geocoding, street-address

我已经看到可以从街道地址获取纬度和经度（地理编码，如在[Google Maps API](http://code.google.com/apis/maps/documentation/services.html#Geocoding)中），但是当您知道纬度/经度已经是什么时，是否可以反过来获取街道地址?

该应用程序将是一个 iPhone 应用程序（以及为什么该应用程序已经知道纬度/经度），因此从 Web 服务到 iPhone API 的任何东西都可以工作。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-01T16:45:55.403

再次谷歌

[http://nicogoeminne.googlepages.com/documentation.html](http://nicogoeminne.googlepages.com/documentation.html)

[http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders](http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-24T21:54:57.310

Google 现在支持 JavaScript API 和基于 HTTP 的 Web 服务的反向地理编码。请求如下所示：

```
http://maps.google.com/maps/geo?output=xml&oe=utf-8&ll=LAT,LON&key=API_KEY 
```

请注意，您必须将 LAT 更改为纬度，将 LON 更改为经度，并将 API_KEY 更改为您的 Google Maps API 密钥。在以下电子表格中地理编码标记为*“是”的国家/地区的服务返回结果：*

[http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html](http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html)

更多信息应尽快从官方文档中找到：

[http://code.google.com/apis/maps/documentation/services.html#Geocoding_Direct](http://code.google.com/apis/maps/documentation/services.html#Geocoding_Direct)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T16:49:25.690

这称为“反向地理编码”，并且确实存在提供此功能的 Web 服务。

我敦促对免费服务的质量、规模和可靠性保持警惕，但这是一个开始的地方： [http ://www.geonames.org/export/reverse-geocoding.html](http://www.geonames.org/export/reverse-geocoding.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-21T16:15:13.630

iPhone OS 3.0 现在有[`MKReverseGeocoder`](http://developer.apple.com/iphone/library/documentation/MapKit/Reference/MKReverseGeocoder_Class/Reference/Reference.html)专门用于此目的的类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-01T18:33:04.097

您也可以为此目的使用 LINK REMOVED 库。MKReverseGeocoder 很不错，但它需要您将它与谷歌地图一起使用。来自 MKReverseGeocoder 参考文档：

> Google 服务条款要求反向地理编码服务与 Google 地图一起使用；在设计应用程序的用户界面时要考虑到这一点。

如果您的应用程序不使用 Google 地图，但只需要访问有关当前位置的详细信息，并且手头只有纬度和经度数据，那么[SSLLocationManager可能是一个替代方案。](https://github.com/ardalahmet/SSLocationManager)它使用雅虎！PlaceFinder API。希望这可以帮助。

# java - Tomcat 6：如何在 Web 方法调用结束后删除临时文件？

> ID：158568
> 
> 赞同：9
> 
> 时间：2008-10-01T16:43:03.630
> 
> 标签：java, web-services, tomcat, jax-ws

我有一个临时文件，其中包含通过 MTOM 二进制附件作为 SOAP 响应的一部分返回的数据。我想在方法调用“结束”（即完成传输）后立即将其丢弃。对我来说最好的方法是什么？我能弄清楚如何做到这一点的最好方法是在会话被销毁时删除它们，但我不确定是否有更“直接”的方法来做到这一点。

仅供参考，我没有使用 Axis，我使用的是 jax-ws，如果这很重要的话。

更新：我不确定回答者是否真的理解这个问题。我知道如何在java中删除文件。我的问题是这样的：

```
@javax.jws.WebService 
public class MyWebService {
...

 @javax.jws.WebMethod 
 public MyFileResult getSomeObject() {
   File mytempfile = new File("tempfile.txt");
   MyFileResult result = new MyFileResult();
   result.setFile(mytempfile);  // sets mytempfile as MTOM attachment

   // mytempfile.delete() iS WRONG
   // can't delete mytempfile because it hasn't been returned to the web service  client
   // yet.  So how do I remove it?

   return result;
 }
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-11T14:29:05.007

我遇到了同样的问题。问题是 JAX-WS 堆栈管理文件。无法在您的代码中确定 JAX-WS 何时完成该文件，因此您不知道何时删除它。

就我而言，我在对象模型上使用 DataHandler 而不是文件。MyFileResult 将具有以下字段而不是文件字段：

```
private DataHandler handler; 
```

我的解决方案是创建一个自定义版本的 FileDataSource。我没有返回 FileInputStream 来读取文件的内容，而是返回 FileInputStream 的以下扩展名：

```
private class TemporaryFileInputStream extends FileInputStream {
    public TemporaryFileInputStream(File file) throws FileNotFoundException {
        super(file);
    }

    @Override
    public void close() throws IOException {
        super.close();
        file.delete();
    }
} 
```

本质上，数据源只允许读取一次。流关闭后，文件被删除。由于 JAX-WS 堆栈只读取文件一次，因此它可以工作。

该解决方案有点棘手，但在这种情况下似乎是最佳选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T16:48:43.460

你在使用标准的 java 临时文件吗？如果是这样，您可以这样做：

```
File script = File.createTempFile("temp", ".tmp", new File("./"));
... use the file ...
script.delete(); // delete when done. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T20:31:51.130

您在上下文中为您正在谈论的这个 web 应用程序设置的工作文件夹。您可以将此工作目录设置在已知目录中吗？如果是，那么您可以在临时工作目录（您知道）中找到临时文件。找到后，您可以将其删除。

# .net - 最佳实践：.NET：如何针对 oracle 数据库返回 PK？

> ID：158571
> 
> 赞同：6
> 
> 时间：2008-10-01T16:43:20.727
> 
> 标签：.net, oracle

使用 SQLServer，似乎普遍认为在插入末尾添加 SELECT SCOPE_IDENTITY() 是返回新插入记录的 PK 的最佳方式，假设您使用 pk 的自动增量字段.

但是，我似乎找不到 Oracle 的等价物。

最佳实践似乎是使用序列来生成 PK，但即使是这样也有不同的选择。您是让开发人员插入 sequence.nexval 还是使用触发器？

无论哪种情况，取回新 ID 似乎都是一个常见问题。

我遇到的建议和解决方案包括：

*   创建一个返回 PK 的存储过程
*   从 seq.nextval 运行选择 id，然后将其传递给插入
*   插入后选择 max(id) （注意：不要这样做！）
*   将 RETURNING 子句添加到插入

对于这种情况，“最佳实践”解决方案应该是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T16:49:14.583

您可以在 Oracle 存储过程中使用 RETURNING 子句来执行此操作。

例如：

TABLEA 有 NAME 和 EMP_ID。EMP_ID 在插入记录时在内部填充。

插入表（名称）值（'BOB'）返回 EMP_ID 到 o_EMP_ID；

假设该行位于输出参数为 o_EMP_ID 的存储过程中。

希望有帮助......如果没有，这里有一个更详细的例子：

[http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/returninginto_clause.htm](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/returninginto_clause.htm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T16:48:15.023

RETURNING 子句仅用于这种用法，因此我将其称为使用它的最佳实践。

另一种方法是在插入后选择 seq.CURRVAL。**这将返回此**会话从序列中获得的最后一个值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T18:39:38.640

存储过程和返回子句具有单个数据库调用的明显好处，任何其他解决方案都逊色。无论您是通过存储过程还是使用返回子句，这本身就是一大堆蠕虫。

# ios - 以编程方式对齐 iPhone 键盘顶部的工具栏

> ID：158574
> 
> 赞同：94
> 
> 时间：2008-10-01T16:43:33.583
> 
> 标签：ios, iphone, cocoa-touch, keyboard

在某些情况下，我想在 iPhone 键盘的顶部添加一个工具栏（例如，在 iPhone Safari 中导航表单元素时）。

目前我正在用常量指定工具栏的矩形，但是因为界面的其他元素在不断变化 - 屏幕顶部的工具栏和导航栏 - 每次我们进行小的界面更改时，工具栏都会失去对齐。

有没有办法以编程方式确定键盘相对于当前视图的位置？

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2010-07-23T18:15:25.043

从 iOS 3.2 开始，有一种新方法可以实现这种效果：

`UITextFields`并`UITextViews`有一个`inputAccessoryView`属性，您可以将其设置为任何视图，该属性会自动显示在上方并使用键盘进行动画处理。

请注意，您使用的视图不应位于其他地方的视图层次结构中，也不应将其添加到某个超级视图中，这是为您完成的。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-12-28T05:37:28.760

所以基本上：

在初始化方法中：

```
NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
[nc addObserver:self selector:@selector(keyboardWillShow:) name: UIKeyboardWillShowNotification object:nil];
[nc addObserver:self selector:@selector(keyboardWillHide:) name: UIKeyboardWillHideNotification object:nil]; 
```

然后有上面提到的方法来调整条的位置：

```
-(void) keyboardWillShow:(NSNotification *) note
{
    CGRect r  = bar.frame, t;
    [[note.userInfo valueForKey:UIKeyboardBoundsUserInfoKey] getValue: &t];
    r.origin.y -=  t.size.height;
    bar.frame = r;
} 
```

可以通过将位置变化动画化来使它变得漂亮

```
 [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:0.3];
//...
    [UIView commitAnimations]; 
```

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2011-05-16T19:52:32.597

这是基于[来自 tonklon 的现有答案](https://stackoverflow.com/questions/158574/programatically-align-a-toolbar-on-top-of-the-iphone-keyboard/3321130#3321130)- 我只是添加一个代码片段，在键盘顶部显示一个半透明的黑色工具栏，以及右侧的“完成”按钮：

```
UIToolbar *toolbar = [[[UIToolbar alloc] init] autorelease];
[toolbar setBarStyle:UIBarStyleBlackTranslucent];
[toolbar sizeToFit];

UIBarButtonItem *flexButton = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemFlexibleSpace target:self action:nil];
UIBarButtonItem *doneButton =[[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemDone target:self action:@selector(resignKeyboard)];

NSArray *itemsArray = [NSArray arrayWithObjects:flexButton, doneButton, nil];

[flexButton release];
[doneButton release];
[toolbar setItems:itemsArray];

[aTextField setInputAccessoryView:toolbar]; 
```

`-resignKeyboard`看起来像：

```
-(void)resignKeyboard {
  [aTextField resignFirstResponder];
} 
```

希望对某人有所帮助。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-10-01T18:35:48.993

如果您注册了键盘通知，ie`UIKeyboardWillShowNotification` `UIKeyboardWillHideNotification`等，您收到的通知将在`userInfo`dict ( `UIKeyboardBoundsUserInfoKey`) 中包含键盘的边界。

请参阅`UIWindow`类参考。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-01-10T23:34:45.507

在 3.0 及更高版本中，您可以从`userInfo`通知字典中获取动画持续时间和曲线。

例如，要为视图的大小设置动画以为键盘腾出空间，请注册`UIKeyboardWillShowNotification`并执行以下操作：

```
- (void)keyboardWillShow:(NSNotification *)notification
{
    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationCurve:[[[notification userInfo] objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];
    [UIView setAnimationDuration:[[[notification userInfo] objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];

    CGRect frame = self.view.frame;
    frame.size.height -= [[[notification userInfo] objectForKey:UIKeyboardBoundsUserInfoKey] CGRectValue].size.height;
    self.view.frame = frame;

    [UIView commitAnimations];
} 
```

为`UIKeyboardWillHideNotification`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-11T16:33:47.153

创建此方法并在 ViewWillLoad 上调用它：

```
 - (void) keyboardToolbarSetup
{
    if(self.keyboardToolbar==nil)
        {
        self.keyboardToolbar = [[UIToolbar alloc] initWithFrame:CGRectMake(0, 0, self.view.bounds.size.width, 44)];

        UIBarButtonItem *cancelButton = [[UIBarButtonItem alloc] initWithTitle:@"Cancel" style:UIBarButtonItemStylePlain target:self action:@selector(anyAction)];

        UIBarButtonItem *extraSpace = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemFlexibleSpace target:nil action:nil];

        UIBarButtonItem *doneButton = [[UIBarButtonItem alloc] initWithTitle:@"Done" style:UIBarButtonItemStyleDone target:self action:@selector(anyOtherAction)];

        NSArray *toolbarButtons = [[NSArray alloc]initWithObjects:cancelButton,extraSpace,doneButton, nil];

        [self.keyboardToolbar setItems:toolbarButtons];

        self.myTextView.inputAccessoryView=self.keyboardToolbar;
        }
} 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-01T17:28:51.167

没有办法（AFAIK）获得键盘视图的尺寸。然而，它是恒定的，至少在迄今为止的每个 iPhone 版本中都是如此。

如果您将工具栏位置计算为与视图底部的偏移量，并考虑视图的大小，那么您不必担心导航栏是否存在。

例如

```
#define KEYBOARD_HEIGHT 240 // example - can't remember the exact size
#define TOOLBAR_HEIGHT 30

toolBarRect.origin.y = viewRect.size.height - KEYBOARD_HEIGHT - TOOLBAR_HEIGHT;

// move toolbar either directly or with an animation 
```

除了定义之外，您还可以轻松地创建一个`keyboardHeight`函数，该函数根据是否显示键盘来返回大小，并将此工具栏定位移动到一个单独的函数中，以重新组织您的布局。

此外，它可能取决于您在哪里进行此定位，因为您的视图大小可能会根据您的导航栏设置在加载和显示之间发生变化。我相信最好的地方是 viewWillAppear。

# .net - 简单的.net 门户。易于添加新模块

> ID：158584
> 
> 赞同：1
> 
> 时间：2008-10-01T16:46:36.850
> 
> 标签：.net, database, portal, frontend

我正在编写一个带有 Web 访问权限的简单数据库。

我以前使用过微软的（非常！）旧的 IBuySpy 门户系统。我相信我现在可以使用一些更新的东西！

我想要一个简单的轻量级系统，它可以让我的朋友拥有包含新闻和图片等的标签，并且我可以很容易地在我的数据库条目表单中添加标签。用户必须有一些认证机制，但不需要像个人博客或论坛那样复杂。

我已经快速浏览了一下 DNN，但它看起来需要学习很多东西。有简单的解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T17:01:07.113

你应该看看这个页面：[http](http://www.asp.net/community/projects/) ://www.asp.net/community/projects/ 。他们列出了一些门户，例如 DNN。但他们也有一些你可能想看看的 CMS 等。在我看来，CMS 比门户网站更适合您。我玩过[Graffiti CMS](http://graffiticms.com/)系统，认为它可能是最好的 .Net CMS 系统。如果您不制作商业网站，他们会提供免费版本。您可以查看的另一个门户是[Rainbow Portal](http://www.rainbowportal.org/)。但我认为任何门户系统都可能非常复杂“开箱即用”。我强烈建议您改用简单的 CMS 系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T16:51:56.870

我建议 mojoPortal。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T16:53:12.857

[DotNetNuke](http://dotnetnuke.com)是一个很好的门户，最初是使用 IBuySpy 门户作为其基础构建的。

[http://dotnetnuke.com](http://dotnetnuke.com)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T16:55:10.467

此外，作为替代方案，您可能希望从[BlogEngine.NET](http://dotnetblogengine.net/)开始，并使用您需要的功能对其进行扩展。我为[http://communitycodingcontest.org](http://communitycodingcontest.org)网站做了这个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T17:00:10.000

您可能还想看看[http://www.umbraco.org/](http://www.umbraco.org/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T16:50:23.583

当前由 MS 提供的门户解决方案是 SharePoint，但这对于您的情况来说可能是多余的，而且超出了您的预算。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T18:09:55.777

如果这只是为您和您的朋友准备的，那么 wiki 站点可能是一个更简单的解决方案

# c++ - 如何为 C++ 程序添加定时延迟？

> ID：158585
> 
> 赞同：115
> 
> 时间：2008-10-01T16:46:37.367
> 
> 标签：c++, time

我正在尝试在 C++ 程序中添加定时延迟，并且想知道是否有人对我可以尝试的内容或我可以查看的信息有任何建议？

我希望我有更多关于如何实现这个定时延迟的详细信息，但是在我有更多关于如何添加定时延迟的信息之前，我不确定我应该如何尝试实现这个。

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2012-03-17T05:57:58.580

C++11 的更新答案：

使用`sleep_for`和`sleep_until`函数：

```
#include <chrono>
#include <thread>

int main() {
    using namespace std::this_thread; // sleep_for, sleep_until
    using namespace std::chrono; // nanoseconds, system_clock, seconds

    sleep_for(nanoseconds(10));
    sleep_until(system_clock::now() + seconds(1));
} 
```

有了这些函数，就不再需要不断地添加新函数以获得更好的分辨率：`sleep`、`usleep`、`nanosleep`等`sleep_for`，并且`sleep_until`是可以通过`chrono`类型接受任何分辨率值的模板函数；小时、秒、飞秒等

`nanoseconds`在 C++14 中，您可以使用and的文字后缀进一步简化代码`seconds`：

```
#include <chrono>
#include <thread>

int main() {
    using namespace std::this_thread;     // sleep_for, sleep_until
    using namespace std::chrono_literals; // ns, us, ms, s, h, etc.
    using std::chrono::system_clock;

    sleep_for(10ns);
    sleep_until(system_clock::now() + 1s);
} 
```

请注意，睡眠的实际持续时间取决于实施：您可以要求睡眠 10 纳秒，但实施可能最终会睡眠一毫秒，如果这是它可以做的最短时间。

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2008-10-01T16:52:13.623

[在 Win32 中](https://msdn.microsoft.com/en-us/library/windows/desktop/ms686298(v=vs.85).aspx)：

```
#include<windows.h>
Sleep(milliseconds); 
```

[在 Unix 中](http://linux.die.net/man/3/usleep)：

```
#include<unistd.h>
unsigned int microsecond = 1000000;
usleep(3 * microsecond);//sleeps for 3 second 
```

`sleep()`只需要几秒钟，这通常太长了。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-10-01T16:50:32.800

```
#include <unistd.h>
usleep(3000000); 
```

这也将休眠三秒钟。不过，您可以进一步细化这些数字。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-10-01T16:47:31.653

你想要像这样简单的东西：

```
#include <unistd.h>
sleep(3);//sleeps for 3 second 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-01T16:55:19.983

请注意，这并不能保证线程休眠的时间量会接近休眠期，它只保证线程继续执行之前的时间量至少是所需的量。实际延迟将根据情况（尤其是相关机器上的负载）而有所不同，并且可能比所需的睡眠时间高几个数量级。

此外，您没有列出为什么需要睡觉，但通常应避免使用延迟作为同步方法。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-09-12T12:25:50.247

你可以试试这个代码片段：

```
#include<chrono>
#include<thread>

int main(){
    std::this_thread::sleep_for(std::chrono::nanoseconds(10));
    std::this_thread::sleep_until(std::chrono::system_clock::now() + std::chrono::seconds(1));
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-09-12T12:07:09.143

`"_sleep(milliseconds);"`如果包含`chrono`库，我发现（不带引号）适用于 Win32

例如：

```
#include <chrono>

using namespace std;

main
{
    cout << "text" << endl;
    _sleep(10000); // pauses for 10 seconds
} 
```

确保在睡觉前包含下划线。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-01T16:49:17.110

如果您想要微秒精度，也可以使用 select(2)（这适用于没有 usleep(3) 的平台）

以下代码将等待 1.5 秒：

```
#include <sys/select.h>
#include <sys/time.h>
#include <unistd.h>`

int main() {
    struct timeval t;
    t.tv_sec = 1;
    t.tv_usec = 500000;
    select(0, NULL, NULL, NULL, &t);
} 
```

`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T17:01:41.463

是的，睡眠可能是这里选择的功能。请注意，传递给函数的时间是调用线程处于非活动状态的最短时间。因此，例如，如果您在 5 秒内调用 sleep，则可以保证您的线程将休眠至少 5 秒。可能是 6、8 或 50，具体取决于操作系统在做什么。（在最佳操作系统执行期间，这将非常接近 5。）
睡眠函数的另一个有用特性是传入 0。这将强制从您的线程切换上下文。

一些附加信息：
[http ://www.opengroup.org/onlinepubs/000095399/functions/sleep.html](http://www.opengroup.org/onlinepubs/000095399/functions/sleep.html)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-04-18T17:09:05.437

要将 cpp 中的输出延迟固定时间，您可以通过包含 windows.h 头文件来使用 Sleep() 函数，Sleep() 函数的语法是 Sleep(time_in_ms) 为

```
cout<<"Apple\n";
Sleep(3000);
cout<<"Mango"; 
```

输出。上面的代码将打印 Apple 并在打印 Mango 之前等待 3 秒。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-01-15T23:11:13.160

这里的最佳答案似乎是依赖于操作系统的答案；对于更便携的解决方案，您可以使用 ctime 头文件编写快速睡眠功能（尽管这对我来说可能是一个糟糕的实现）。

```
#include <iostream>
#include <ctime>

using namespace std;

void sleep(float seconds){
    clock_t startClock = clock();
    float secondsAhead = seconds * CLOCKS_PER_SEC;
    // do nothing until the elapsed time has passed.
    while(clock() < startClock+secondsAhead);
    return;
}
int main(){

    cout << "Next string coming up in one second!" << endl;
    sleep(1.0);
    cout << "Hey, what did I miss?" << endl;

    return 0;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T16:48:49.280

句法：

无效睡眠（无符号秒）；

sleep() 暂停执行一段时间（秒）。调用 sleep 后，当前程序将暂停执行由参数 seconds 指定的秒数。间隔仅精确到最接近的百分之一秒或操作系统时钟的精确度，以较不精确的为准。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T04:43:53.397

许多其他人提供了很好的睡眠信息。我同意 Wedge 的观点，睡眠很少是最合适的解决方案。

如果您在等待某事时正在睡觉，那么您最好实际等待那件事/事件。查看条件变量。

我不知道您要在什么操作系统上执行此操作，但对于线程和同步，您可以查看[Boost Threading](http://www.boost.org/doc/libs/1_36_0/doc/html/thread.html)库（[Boost Condition Varriable](http://www.boost.org/doc/libs/1_36_0/doc/html/thread/synchronization.html#thread.synchronization.condvar_ref)）。

现在转向另一个极端，如果你试图等待非常短的时间，那么有几个黑客风格的选择。如果您在某种没有实现“睡眠”的嵌入式平台上工作，那么您可以尝试一个带有空主体的简单循环（for/while 等）（注意编译器不会优化它）。当然，在这种情况下，等待时间取决于具体的硬件。对于非常短的“等待”，您可以尝试组装“nop”。我非常怀疑这些是你所追求的，但不知道你为什么需要等待很难更具体。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-02T04:52:21.787

在 Windows 上，您可以包含 Windows 库并使用“Sleep(0);” 让程序休眠。它采用一个表示毫秒的值。

# firebug - 我如何安装 Firebug 1.2 使其表现得像以前的版本一样？

> ID：158593
> 
> 赞同：2
> 
> 时间：2008-10-01T16:48:24.070
> 
> 标签：firebug

在胡扯了几个月之后，我在我的开发机器上安装了 Firefox 3 并且很后悔，因为新的 Firebug 正在扼杀我的生存意愿。撇开脆弱不谈——它没有捕捉到基本的语法错误——所有东西都有一个全新的 UI 层，它让我思考。

拜托，有人能告诉我为了让 Firebug 完全按照它的方式运行，我需要做出一系列选择吗——请一直显示所有内容，不要让我重新发布以在我的 Net 标签中获得结果——在我升级之前？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:17:14.733

进展......聪明的同事向我指出了about：config的部分答案。我将 extensions.firebug.allowDoublePost 切换为 true，重新启动 Firefox，然后 Net 选项卡退出，要求我重新发布。

# sql-server - 同步数据集

> ID：158617
> 
> 赞同：3
> 
> 时间：2008-10-01T16:53:56.240
> 
> 标签：sql-server, ado.net, dataset

将 DataSet 与数据库中的数据同步的最佳方法是什么？以下是参数：

*   我们不能简单地重新加载数据，因为它绑定到用户可能已经配置的 UI 控件（这是一个他们可以展开/折叠的树形网格）
*   我们不能在数据库中使用更改标志（如 UpdatedTimeStamp），因为更改并不总是流经应用程序（例如，DBA 可以使用 SQL 语句更新字段）
*   我们不能在数据库中使用更新触发器，因为它是一个多用户系统
*   我们正在使用 ADO.NET 数据集
*   多个字段可以更改给定行

我查看了 DataSet 的合并功能，但这似乎没有保留“ID”列的概念。我查看了 DiffGram 功能，但这里的问题是这些似乎是由同一 DataSet 中的更改生成的，而不是在某些外部数据源上发生的更改。

我已经从这个解决方案运行了一段时间，但我知道可行的方法（效率低下）是构建一个单独的 DataSet，然后迭代所有行，逐个字段地应用更改到它所在的 DataSet边界。

有没有人有类似的情况？你做了什么来解决这个问题？即使您没有遇到类似的问题，我们也欢迎您提出任何解决方案的建议。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T18:08:35.033

*如果*您为每个 DataTable 定义了一个主键，则DataSet.Merge 非常适用；DataSet 将向任何数据绑定的 GUI 控件引发更改的事件

如果您的表很小，您可以重新读取所有行并定期合并，否则限制使用时间戳读取的集合是一个好主意 - 只需告诉 DBA 遵循规则并更新时间戳；-)

另一个选项 - 有点工作 - 是使用触发器或存储过程保留更改的行队列（时间戳，行 ID），并将刷新查询基于队列中的时间戳；如果基表中有很多行，这将更有效，允许您（通过队列记录上的内部连接）仅提取自上次轮询时间以来更改的行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:00:20.203

我认为存储用户扩展的节点列表会更容易（假设您可以唯一标识每个节点），然后重新加载数据并将其重新绑定到树视图，然后展开所有节点之前扩展的。

# java - MainSoft Grasshopper，.Net 到 Java

> ID：158618
> 
> 赞同：4
> 
> 时间：2008-10-01T16:54:42.697
> 
> 标签：java, .net, interop

我刚刚偶然发现了 MainSoft 的[Grasshopper](http://dev.mainsoft.com/Default.aspx?tabid=130)，它声称可以将 .Net ILM 交叉编译为 Java 字节码。它似乎使用 .Net 库的 Mono 实现。所有示例都涉及 Web 应用程序，但我的要求是将 .Net API（类库）交叉编译为 Java API，以便 Java 客户端可以使用该 API。有没有人有使用 Grasshopper 的经验，你能看出我的计划有什么问题吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T17:04:56.307

大约 12 到 18 个月前，我尝试将 ASPNET 站点移植到可以在 Apache 上运行的东西。我知道这不是你的预期目的，但请留在我身边。

过程并不顺利。.net 框架的某些部分（当时）没有在蚱蜢代码库中实现，一旦我们评估了问题的严重程度，决定以 Mono 的开发版本为目标会容易得多。

不管怎样，试试吧。他们当时有一个演示，所以我想还有一个。如果您遇到十亿个语言错误，我会考虑一个合适的端口（如果代码库很小）。如果它有效，请确保您有测试用例来真正彻底地测试它。

# .net - C# P/Invoke 中的 Marshal C++“字符串”类

> ID：158628
> 
> 赞同：7
> 
> 时间：2008-10-01T16:58:01.660
> 
> 标签：.net, c++, string, interop, marshalling

我在本机 DLL 中有一个函数，定义如下：

```
#include <string>
void SetPath(string path); 
```

我试图把它放在微软的 P/Invoke Interop Assistant 中，但它在“字符串”类（我认为它来自 MFC？）上窒息。

我尝试将其封送为各种不同的类型（C# String、char[]、byte[]），但每次我得到 NotSupportedException 或 Native Assembly Exception（取决于我尝试的封送处理）。

正如任何人做过使用本机字符串类的本机/托管互操作一样？有什么办法可以对此进行元帅吗？我将不得不编写自己的 Marshaler 吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T17:06:41.920

看起来您正在尝试使用 C++ 标准库字符串类。我怀疑这将是容易的元帅。最好坚持使用 char * 和 Marshal 作为 StringBuilder。这就是我通常做的。您必须添加一个为您生成 C++ 字符串的包装器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T17:39:41.560

PInvoke 互操作助手仅支持 C 而不是 C++。不幸的是，MFC String 类（我相信是 CString？）是 C++，不能通过助手工作。而是尝试使用以下

```
void SetPath(__in const WCHAR* path); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-15T03:31:15.320

是的。你可以。实际上，不仅仅是`std::string`, `std::wstring`，任何标准 C++ 类或您自己的类都可以从 C#/.NET 进行编组或实例化和调用。

从 .NET 世界中实例化 C++ 对象的基本思想是从 .NET 中分配 C++ 对象的确切大小，然后调用从 C++ DLL 导出的构造函数来初始化对象，然后您将能够调用任何访问该 C++ 对象的函数，如果任何方法涉及其他 C++ 类，您还需要将它们包装在 C# 类中，对于具有原始类型的方法，您可以简单地 P/Invoke 它们。如果你只有几个方法可以调用，那会很简单，手动编码不会花很长时间。完成 C++ 对象后，调用 C++ 对象的析构函数方法，这也是一个导出函数。如果它没有，那么你只需要从.NET 中释放你的内存。

这是一个例子。

```
public class SampleClass : IDisposable
{    
    [DllImport("YourDll.dll", EntryPoint="ConstructorOfYourClass", CharSet=CharSet.Ansi,          CallingConvention=CallingConvention.ThisCall)]
    public extern static void SampleClassConstructor(IntPtr thisObject);

    [DllImport("YourDll.dll", EntryPoint="DoSomething", CharSet=CharSet.Ansi,      CallingConvention=CallingConvention.ThisCall)]
    public extern static void DoSomething(IntPtr thisObject);

    [DllImport("YourDll.dll", EntryPoint="DoSomethingElse", CharSet=CharSet.Ansi,      CallingConvention=CallingConvention.ThisCall)]
    public extern static void DoSomething(IntPtr thisObject, int x);

    IntPtr ptr;

    public SampleClass(int sizeOfYourCppClass)
    {
        this.ptr = Marshal.AllocHGlobal(sizeOfYourCppClass);
        SampleClassConstructor(this.ptr);  
    }

    public void DoSomething()
    {
        DoSomething(this.ptr);
    }

    public void DoSomethingElse(int x)
    {
        DoSomethingElse(this.ptr, x);
    }

    public void Dispose()
    {
        Marshal.FreeHGlobal(this.ptr);
    }
} 
```

有关详细信息，请参阅以下链接，

[C#/.NET PInvoke 互操作 SDK](http://www.xinterop.com/index.php/2013/04/13/introduction-to-c-pinvoke-interop-sdk/)

（我是SDK工具的作者）

一旦为 C++ 类准备好 C# 包装类，它就很容易实现`ICustomMarshaler`，以便您可以从 .NET 编组 C++ 对象。

[http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.icustommarshaler.aspx](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.icustommarshaler.aspx)

# excel - 如何使用 VBA 从 Excel 向服务器发送 HTTP POST 请求？

> ID：158633
> 
> 赞同：151
> 
> 时间：2008-10-01T16:59:14.183
> 
> 标签：excel, vba, http, post, serverxmlhttp

从 Excel 电子表格执行 HTTP POST 需要什么 VBA 代码？

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-10-01T17:03:29.323

```
Set objHTTP = CreateObject("MSXML2.ServerXMLHTTP")
URL = "http://www.somedomain.com"
objHTTP.Open "POST", URL, False
objHTTP.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
objHTTP.send "" 
```

或者，为了更好地控制 HTTP 请求，您可以使用[`WinHttp.WinHttpRequest.5.1`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384106%28v=vs.85%29.aspx).[`MSXML2.ServerXMLHTTP`](https://msdn.microsoft.com/en-us/library/ms762278%28v=vs.85%29.aspx)

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2011-01-06T17:07:15.407

如果您需要它同时在 Mac 和 Windows 上工作，您可以使用 QueryTables：

```
With ActiveSheet.QueryTables.Add(Connection:="URL;http://carbon.brighterplanet.com/flights.txt", Destination:=Range("A2"))
    .PostText = "origin_airport=MSN&destination_airport=ORD"
    .RefreshStyle = xlOverwriteCells
    .SaveData = True
    .Refresh
End With 
```

笔记：

*   关于输出......我不知道是否可以将结果返回到调用 VBA 函数的同一单元格。在上面的示例中，结果被写入 A2。
*   关于输入...如果您希望在更改某些单元格时刷新结果，请确保这些单元格是您的 VBA 函数的参数。
*   这不适用于没有 VBA 的 Excel for Mac 2008。Excel for Mac 2011 恢复了 VBA。

[有关更多详细信息，您可以查看我关于“使用 Excel 中的 Web 服务](http://numbers.brighterplanet.com/2011/01/06/using-web-services-from-excel/)”的完整摘要。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2013-07-10T12:03:06.183

除了[蜥蜴比尔的](https://stackoverflow.com/questions/158633/how-can-i-send-an-http-post-request-to-a-server-from-excel-using-vba#158657)回答：

大多数后端解析原始帖子数据。例如，在 PHP 中，您将拥有一个数组`$_POST`，其中将存储发布数据中的各个变量。在这种情况下，您必须使用附加标头`"Content-type: application/x-www-form-urlencoded"`：

```
Set objHTTP = CreateObject("WinHttp.WinHttpRequest.5.1")
URL = "http://www.somedomain.com"
objHTTP.Open "POST", URL, False
objHTTP.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
objHTTP.setRequestHeader "Content-type", "application/x-www-form-urlencoded"
objHTTP.send "var1=value1&var2=value2&var3=value3" 
```

否则，您必须读取变量上的原始帖子数据`"$HTTP_RAW_POST_DATA"`。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2019-12-11T11:30:36.180

要完成其他用户的响应：

*为此，我创建了一个**“WinHttp.WinHttpRequest.5.1”**对象。*

使用 VBA 从 Excel 发送包含一些数据的发布请求：

```
Dim LoginRequest As Object
Set LoginRequest = CreateObject("WinHttp.WinHttpRequest.5.1")
LoginRequest.Open "POST", "http://...", False
LoginRequest.setRequestHeader "Content-type", "application/x-www-form-urlencoded"
LoginRequest.send ("key1=value1&key2=value2") 
```

使用 VBA 从 Excel 发送带有令牌身份验证的 get 请求：

```
Dim TCRequestItem As Object
Set TCRequestItem = CreateObject("WinHttp.WinHttpRequest.5.1")
TCRequestItem.Open "GET", "http://...", False
TCRequestItem.setRequestHeader "Content-Type", "application/xml"
TCRequestItem.setRequestHeader "Accept", "application/xml"
TCRequestItem.setRequestHeader "Authorization", "Bearer " & token
TCRequestItem.send 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-01T17:01:08.517

您可以`ServerXMLHTTP`通过添加对`MSXML`.

> 1.  打开 VBA 编辑器（通常通过编辑宏）
> 2.  转到可用参考列表
> 3.  检查微软 XML
> 4.  单击确定。

（来自[在 VBA 项目中引用 MSXML](https://msdn.microsoft.com/en-us/library/ms763701(v=vs.85).aspx)）

[ServerXMLHTTP MSDN 文档](https://msdn.microsoft.com/en-us/library/ms762278(v=vs.85).aspx)包含有关ServerXMLHTTP的所有属性和方法的完整详细信息。

简而言之，它的工作原理基本上是这样的：

> 1.  调用[open](https://msdn.microsoft.com/en-us/library/ms763809(v=vs.85).aspx)方法连接远程服务器
> 2.  调用[send](https://msdn.microsoft.com/en-us/library/ms755436(v=vs.85).aspx)发送请求。
> 3.  [通过responseXML](https://msdn.microsoft.com/en-us/library/ms757055(v=vs.85).aspx)、[responseText](https://msdn.microsoft.com/en-us/library/ms763684(v=vs.85).aspx)、[responseStream](https://msdn.microsoft.com/en-us/library/ms759211(v=vs.85).aspx)或[responseBody](https://msdn.microsoft.com/en-us/library/ms753682(v=vs.85).aspx)读取响应

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T17:03:18.170

我在使用 MSXML 库然后使用 XMLHttpRequest 对象之前执行了此操作，请参见[此处](http://web.archive.org/web/20060904064108/http://scriptorium.serve-it.nl/view.php?sid=40)。

# c# - 在 LINQ 查询中进行强制转换

> ID：158634
> 
> 赞同：29
> 
> 时间：2008-10-01T16:59:25.713
> 
> 标签：c#, .net, linq, .net-3.5

是否可以在 LINQ 查询中进行强制转换（为了编译器）？

下面的代码并不糟糕，但最好将它变成一个查询：

```
Content content = dataStore.RootControl as Controls.Content;

List<TabSection> tabList = (from t in content.ChildControls
                            select t).OfType<TabSection>().ToList();

List<Paragraph> paragraphList = (from t in tabList
                                 from p in t.ChildControls
                                 select p).OfType<Paragraph>().ToList();

List<Line> parentLineList = (from p in paragraphList
                             from pl in p.ChildControls
                             select pl).OfType<Line>().ToList(); 
```

代码继续进行更多查询，但要点是我必须从每个查询中创建一个 List ，以便编译器知道 in 中的所有对象`content.ChildControls`都是 type `TabSection`，并且所有对象`t.ChildControls`都是 type `Paragraph`。 ..等等等等。

在 LINQ 查询中有没有办法告诉编译器`t`in`from t in content.ChildControls`是一个`TabSection`？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-01T17:08:41.010

试试这个：

```
from TabSection t in content.ChildControls 
```

此外，即使这不可用（或者对于您可能遇到的不同的未来场景），您也不会被限制将所有内容转换为列表。转换为列表会导致当场查询评估。但是，如果您删除 ToList 调用，您可以使用 IEnumerable 类型，这将继续推迟查询的执行，直到您实际迭代或存储在真实容器中。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T17:29:46.623

根据您要执行的操作，其中之一可能会起作用：

```
List<Line> parentLineList1 =
  (from t in content.ChildControls.OfType<TabSection>()
   from p in t.ChildControls.OfType<Paragraph>()
   from pl in p.ChildControls.OfType<Line>()
   select pl).ToList();

List<Line> parentLineList2 =
  (from TabSection t in content.ChildControls
   from Paragraph p in t.ChildControls
   from Line pl in p.ChildControls
   select pl).ToList(); 
```

请注意，其中一个使用您正在使用的 OfType<T>()。这将过滤结果并仅返回指定类型的项目。第二个查询隐式使用 Cast<T>()，它将结果转换为指定的类型。如果任何项目无法转换，则会引发异常。正如 Turbulent Intellect 所提到的，您应该尽可能避免调用 ToList()，或者尽量避免它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T21:07:55.157

```
List<TabSection> tabList = (from t in content.ChildControls
                            let ts = t as TabSection
                            where ts != null
                            select ts).ToList(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T17:09:01.260

是的，您可以执行以下操作：

```
List<TabSection> tabList = (from t in content.ChildControls
                            where t as TabSection != null
                            select t as TabSection).ToList(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T20:05:44.767

这是查询方法表单。

```
List<Line> parentLineList =
  content.ChildControls.OfType<TabSections>()
    .SelectMany(t => t.ChildControls.OfType<Paragraph>())
    .SelectMany(p => p.ChildControls.OfType<Line>())
    .ToList(); 
```

# design-patterns - 相同的演示者使用不同的存储库

> ID：158651
> 
> 赞同：0
> 
> 时间：2008-10-01T17:01:49.250
> 
> 标签：design-patterns

您是否使用 MVP 模式管理同一个演示者处理不同的存储库？

我只有多个构造函数重载，演示者只使用适合该场景的那个。

```
AddCustomerPresenter presenter = new AddCustomerPresenter(this,customerRepository); 
presenter.AddCustomer(); 

presenter = new AddCustomerPresenter(this,archiveRepository); 
presenter.Archive(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:37:20.100

为什么没有

```
IRepository { /* .. */ }
CustomerRepository : IRepository { /* .. */ }
ArchiveRepository : IRepository { /* .. */ } 
```

进而

```
AddCustomerPresenter {
IRepository Store {get;set;}
public AddCustomerPresenter(IRepository store) { /*...*/ }
/*...*/
} 
```

您的演示者不应该对 IRepository 的任何实现有任何静态依赖。如果您发现没有其他方法，您需要重新设计您的设计，因为它可能存在缺陷。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:22:06.403

谢谢威尔！

但是 CustomerRepository 和 ArchiveRepository 没有任何关系。它们是两种完全不同的东西。

# svn - 'svn cleanup' 失败时我该怎么办？

> ID：158664
> 
> 赞同：255
> 
> 时间：2008-10-01T17:05:11.907
> 
> 标签：svn

我在工作文件夹中有很多更改，并且尝试进行更新时搞砸了。

现在，当我发出“svn cleanup”时，我得到：

```
>svn cleanup .
svn: In directory '.'
svn: Error processing command 'modify-wcprop' in '.'
svn: 'MemPoolTests.cpp' is not under version control 
```

MemPoolTests.cpp 是另一个开发人员添加的新文件，并在更新中被删除。它以前不存在于我的工作文件夹中。

我可以做些什么来尝试前进**而**无需签出存储库的新副本？

**澄清：**感谢有关将目录移开并删除新副本的建议。我知道这是一个选项，但这是我想避免的选项，因为有许多更改嵌套在多个目录深处（这应该是一个分支......）

我希望有一种更积极的方式来进行清理，也许以某种方式强制文件 SVN 无法恢复到已知状态（我尝试删除它的工作副本......这没有帮助）。

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2008-11-01T23:54:47.350

当重新开始不是一种选择时......

我删除了目录中的日志文件`.svn`（我还删除了 中的有问题的文件`.svn/props-base`），进行了清理，并恢复了我的更新。

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2013-04-26T17:58:19.577

SVN 1.7 发生了变化，删除 .svn 目录中的日志文件的流行解决方案在迁移到数据库工作副本实现时是不可行的。

这是我所做的似乎有效的事情：

1.  删除工作副本的 .svn 目录。
2.  在新的临时目录中开始新的签出。
3.  取消结帐（我们不想等待一切都被拉下来）。
4.  对此取消的结帐运行清理。
5.  现在我们有了一个新的 .svn 目录，里面有一个干净的数据库（尽管没有/很少的文件）
6.  将此 .svn 复制到您损坏的旧工作目录中。
7.  运行 svn update 它应该使您的新部分 .svn 目录与您的旧工作目录同步。

这有点令人困惑，过程明智。本质上，我们所做的是删除损坏的 .svn，然后为相同的结帐路径创建一个新的 .svn。然后我们将这个新的 .svn 移动到我们的旧工作目录并将其更新到 repo。

我刚刚在 TSVN 中做了这个，它似乎工作正常，不需要完整的结帐和下载。

-乔迪

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2014-01-17T15:31:28.460

看一眼

[http://www.anujvarma.com/svn-cleanup-failedprevious-operation-has-not-finished-run-cleanup-if-it-was-interrupted/](http://www.anujvarma.com/svn-cleanup-failedprevious-operation-has-not-finished-run-cleanup-if-it-was-interrupted/)

上述链接的修复摘要（感谢 Anuj Varma）

> 1.  [从http://www.sqlite.org/download.html](http://www.sqlite.org/download.html)安装 sqlite 命令行 shell (sqlite-tools-win32)
>     
>     
> 2.  `sqlite3 .svn/wc.db "select * from work_queue"`
>     
>     
> 
> SELECT 应该将您的违规文件夹/文件显示为工作队列的一部分。您需要做的是从工作队列中删除此项目。
> 
> 3.  `sqlite3 .svn/wc.db "delete from work_queue"`
> 
> 而已。现在，您可以再次运行 cleanup - 它应该可以工作。或者您可以在提示运行清理（添加新文件等）之前直接执行您正在执行的任务

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-10-01T17:11:00.240

如果一切都失败了：

1.  签出到一个新文件夹。
2.  将修改后的文件复制过来。
3.  重新入住。
4.  在删除旧文件夹并使用新文件夹之前，将旧文件夹压缩到某个地方（你永远不知道 + 妄想症很好）。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2017-03-08T03:09:52.733

最新版本（我使用的是 1.9.5）通过在清理菜单上添加“Break locks”选项解决了这个问题。只需确保在进行清理时选中此复选框即可。

[![eclean 窗口](https://i.stack.imgur.com/6A4el.png)](https://i.stack.imgur.com/6A4el.png)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-10-01T17:23:31.037

*此答案仅适用于 1.7 之前的版本（感谢@ŁukaszBachman）*。

Subversion 将其信息存储在每个文件夹（在 .svn 中），因此如果您只是处理一个子文件夹，则不需要检查整个存储库 - 只需检查已失效的文件夹：

```
cd dir_above_borked
mv borked_dir borked_dir.bak
svn update borked_dir 
```

这将为您提供 borked 文件夹的良好工作副本，但您仍然在 borked_dir.bak 中备份您的更改。同样的原则也适用于 Windows/TortoiseSVN。

如果您在隔离文件夹中有更改，请查看

```
svn checkout -N borked_dir   # Non-recursive, but deprecated 
```

或者

```
svn checkout --depth=files borked_dir
# 'depth' is new territory to me, but do 'svn help checkout' 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-01-07T10:06:08.653

```
$ ls -la .svn
$ rm -f .svn/lock 
```

然后

```
$ svn update 
```

希望能帮助到你

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-20T17:10:53.967

我有同样的问题。我无法提交，清理会失败。

使用命令行客户端，我能够看到一条错误消息，表明它无法将文件`.svn/props`从`.svn/prop-base`.

我查看了具体的文件，发现它被标记为只读。删除只读属性后，我能够清理文件夹并提交我的更改。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-01-02T17:39:50.210

我尝试`svn cleanup`通过控制台进行操作，但出现如下错误：

```
svn: E720002: Can't open file '..\.svn\pristine\40\40d53d69871f4ff622a3fbb939b6a79932dc7cd4.svn-base':
The system cannot find the file specified. 
```

所以我手动创建了这个文件（空）并`svn cleanup`再次创建。这次它完成了。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-02-05T10:40:23.187

您可能会遇到两个文件名仅大写不同的问题。如果您遇到此问题，创建另一个工作副本目录并不能解决问题。

当前的 Windows（即蹩脚的）文件系统根本无法理解 和 之间的`Filename`区别`FILEname`。您有两种可能的修复方法：

1.  在具有真实文件系统（基于 Unix）的平台上签出，重命名文件并提交更改。
2.  当您使用 Windows 时，您可以在 Eclipse SVN 存储库浏览器中重命名文件，该浏览器会识别差异并在那里重命名文件。
3.  您也可以使用任何命令行 SVN 客户端远程重命名有问题的文件`svn rename -m "broken filename case" http://server/repo/FILEname http://server/repo/filename`

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-01-03T14:14:16.123

在终端中运行`svn cleanup`命令（如果它在我的情况下从 Eclipse 失败）：

```
~/path/to/svn-folder/$ svn cleanup 
```

* * *

**我尝试**了这里解释的不同解决方案，但**没有一个有效**。

行动*团队*→*头部更新*失败：

> svn: E155004: '/home/user/path/to/svn-folder' 中有未完成的工作项；首先运行'svn cleanup'。

行动*小组*→*清理*失败并出现同样的错误。

对我有用的解决方案：**在终端中****运行*svn cleanup***命令。

命令成功。

然后Eclipse 中的*Team* → *Update*再次工作。

注意：我的 SVN 版本是 1.9.3。

如果不起作用，还请检查[Chris 的答案。](https://stackoverflow.com/a/4402137/912046)`svn cleanup`

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2012-06-28T18:05:27.517

我有同样的问题。对我来说，原因是与 EasySVN 和（TortoiseSVN 或只是 SVN）的冲突。我使用 EasySVN 进行了自动更新和提交（这不起作用）。

当我关闭它时，我无法清理、提交或更新。上述解决方案均无效，但重新启动确实有效：)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-05-10T11:28:51.547

我刚刚在 Windows 7 64 位上遇到了同样的问题。我以管理员身份运行控制台并从问题目录中删除了 .svn 目录（收到有关日志或其他内容的错误，但忽略了它）。然后，在资源管理器中，我删除了不再显示为受版本控制的问题目录。然后，我进行了更新，事情按预期进行。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-12-09T19:16:38.703

如果问题是区分大小写（这在签出到 Mac 和 Windows 时可能是个问题）并且您没有签出到 *nix 系统的选项，那么以下应该可以工作。这是从一开始的过程：

```
% svn co http://[domain]/svn/mortgages mortgages 
```

（结帐随之而来……然后……）

```
svn: In directory 'mortgages/trunk/images/rates'
svn: Can't open file 'mortgages/trunk/images/rates/.svn/tmp/text-base/Header_3_nobookmark.gif.svn-base': No such file or directory 
```

在这里，SVN 试图检查两个名称相似但仅大小写不同的文件 -`Header_3_noBookmark.gif`和`Header_3_nobookmark.gif`. Mac 文件系统默认不区分大小写，导致 SVN 在这种情况下阻塞。所以...

```
% cd mortgages/trunk/images/rates/
% svn up
svn: Working copy '.' locked
svn: run 'svn cleanup' to remove locks (type 'svn help cleanup' for details) 
```

然而，`svn cleanup`正如我们所知，跑步是行不通的。

```
% svn cleanup
svn: In directory '.'
svn: Error processing command 'modify-wcprop' in '.'
svn: 'spacer.gif' is not under version control 
```

`spacer.gif`不是这里的问题......它只是无法将上一个错误移至下一个文件。所以我从目录中删除了除 之外的所有文件`.svn`，并删除了 SVN 日志。这使得清理工作，以便我可以检查并重命名有问题的文件。

```
% rm *; rm -rf .svn/log; svn cleanup
% svn up Header_3_nobookmark.gif
A    Header_3_nobookmark.gif
Updated to revision 1087.
% svn mv Header_3_nobookmark.gif foo
A         foo
D         Header_3_nobookmark.gif
% svn up
A    spacer.gif
A    Header_3_noBookmark.gif 
```

在此之后，我能够返回到项目的根目录，然后运行`svn up`以检查它的其余部分。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-10-17T10:17:25.093

每当我遇到类似问题时，我都会使用 rsync（注意：我使用 Linux 或 Mac OS X）来提供帮助，如下所示：

```
# Go to the parent directory
cd dir_above_borked

# Rename corrupted directory
mv borked_dir borked_dir.bak

# Checkout a fresh copy
svn checkout svn://... borked_dir

# Copy the modified files to the fresh checkout
# - test rsync
#   (possibly use -c to verify all content and show only actually changed files)
rsync -nav --exclude=.svn borked_dir.bak/ borked_dir/

# - If all ok, run rsync for real
#   (possibly using -c again, possibly not using -v)
rsync -av --exclude=.svn borked_dir.bak/ borked_dir/ 
```

这样你就有了一个全新的结帐，但使用相同的工作文件。对我来说，这总是很有魅力。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-09-04T08:20:51.983

当我遇到 TortoiseSVN (Windows) 的这个问题时，我会去[Cygwin](http://en.wikipedia.org/wiki/Cygwin)并从那里运行“ *svn cleanup* ”；它为我正确清理，之后一切都可以从 TortoiseSVN 运行。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-12-30T19:27:05.660

我最近也遇到了。对我来说，诀窍是在选择“清理”后，在弹出的选项对话框中，选中“Break Locks”，然后选择“OK”。它为我成功清理。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-01-26T13:49:04.130

(Before you try moving folders and doing a new checkout.)

Delete the folder the offending file(s) are in - yes, even the `.svn` folder, then do an `svn cleanup` on the very top / parent folder.

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-03-28T10:18:10.347

Subclipse 对 Windows 真正恶魔般的锁定行为感到困惑。[解锁](http://unlocker.emptyloop.com/)器是你的朋友。这可以找到锁定的文件并强制释放锁定。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-10-11T12:29:29.940

我遇到了同样的问题。在网上搜索了一番后，找到了[下面的文章](http://h3x.no/2010/12/04/svn-gives-attempt-to-write-a-readonly-database-error)。然后意识到我登录的用户与我用来设置 SVN 的用户不同，基本上是权限问题。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-12-14T22:51:41.987

我也有清理失败的问题。最初我试图提交一些代码，但它说：

> svn: E155004: '/my/path/to/files' 中有未完成的工作项；首先运行'svn cleanup'。

但是当我试图清理时：

> svn: E155007: '/my/path/to/files' 不是工作副本目录

就我而言，事实证明我遇到了修订冲突。我的 svn 文件夹包含`.mine`、`.r1`和`.r2`文件。一旦我解决了冲突，清理就会成功运行。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2017-02-27T18:46:28.757

There are some very good suggestions in the previous answer, but if you are having an issue with TortoiseSVN on Windows (a good product, but ...) always fallback to the command line and do a simple "svn cleanup" first.

In many circumstances the Windows client will not run the cleanup command, but cleanup works fine using thing the SVN command line utility.

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-09-24T07:13:13.030

只读锁定有时会发生在装有 Windows 的网络驱动器上。尝试断开并重新连接。然后清理和更新。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-12-01T03:14:22.953

它可能不适用于所有情况，但是当我最近遇到这个问题时，我的“修复”是升级我系统上的 Subversion 包。我一直在运行 1.4.something，当我升级到最新版本（在我的情况下为 1.6.6）时，结帐工作。

（我确实尝试重新下载它，但结帐到一个干净的目录总是挂在同一个地方。）

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-01-11T19:21:54.523

在经历了这里引用的大多数解决方案之后，我仍然遇到了错误。

问题是[不区分大小写的 OS X](http://groups.google.com/group/google-code-hosting/browse_thread/thread/fa71ba7a03dd6f1d/3ca4c06b29b9b488?pli=1)。检出具有两个同名文件但大小写不同的目录会导致问题。例如，ApproximationTest.java 和 Approximationtest.java 不应位于同一目录中。一旦我们摆脱了其中一个文件，问题就会消失。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-02-22T15:14:15.930

我遇到了一个问题，在更新之后，SVN 显示一个文件夹存在冲突。奇怪的是，这只能通过命令行看到——TortoiseSVN 认为这一切都很好。

```
#>svn st
!       my_dir
!       my_dir\sub_dir 
```

`svn cleanup`, `svn revert`,`svn update`并且`svn resolve`都未能成功解决此问题。

我最终解决了如下问题：

*   在 .svn 目录中查找“sub_dir”
*   使用 RC -> 属性取消选中条目文件上的“只读”标志
*   打开条目文件并删除“未完成...”行和相应的校验和
*   保存并重新启用只读标志
*   对 my_dir 目录重复

之后，一切都很好。

请注意，我没有任何本地更改，所以我不知道如果你这样做会不会有风险。我没有使用其他人建议的删除/更新方法 - 我通过在 my_dir/sub_dir/sub_sub_dir 目录（以相同的症状开始）上尝试进入这种状态 - 所以我不想冒险让事情变得更糟再次！

不是很切题，但如果有人像我一样看到这篇文章，可能会有所帮助。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-06-03T19:48:05.710

我确实`sudo chmod 777 -R .`能够更改权限。没有`sudo`，它将无法工作，给我与运行其他命令相同的错误。

现在您可以做`svn update`任何事情，而不必废弃整个目录并重新创建它。这特别有用，因为您的 IDE 或文本编辑器可能已经打开了某些选项卡，或者存在同步问题。您无需使用此方法废弃和替换您的工作目录。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-04-27T18:56:48.180

在面临类似问题时，存储库同步视图中的手动合并有助于解决该问题。

一个文件名与另一个文件名冲突，它清楚地提到了这个问题。将较新的文件重命名为不同的名称可以解决它。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2018-03-11T13:16:45.590

我刚刚`svn-xxxxxxxx`从`~\.svn\tmp`文件夹中删除了文件，其中`xxxxxxxx`是一个数字。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-10-06T15:11:29.870

这里的答案对我没有帮助，但在再次检查项目之前，我关闭并打开了 Eclipse（Subversive 是我的 SVN 客户端），问题就消失了。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-08-10T22:31:35.190

我通过将一些同事的 .svn 目录复制到我的目录中然后更新我的工作副本来解决了这个问题。这是一个不错、快速且干净的解决方案。

# java - 如何使用 Ant 删除目录集？

> ID：158665
> 
> 赞同：14
> 
> 时间：2008-10-01T17:05:45.433
> 
> 标签：java, ant, build

我想删除根目录下名称中包含“tmp”的所有目录和子目录。这也应该包括任何 .svn 文件。我的第一个猜测是使用

```
<delete>
    <dirset dir="${root}">
          <include name="**/*tmp*" />
    </dirset>
</delete> 
```

这似乎不起作用，因为您不能将`dirset`a 嵌套在`delete`标签中。

这是一种正确的方法，还是我应该做其他事情？

*   蚂蚁版本 == 1.6.5。
*   java版本== 1.6.0_04

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-01T21:00:10.797

这是对我有用的答案：

```
<delete includeemptydirs="true">
    <fileset dir="${root}" defaultexcludes="false">
       <include name="**/*tmp*/**" />
    </fileset>
</delete> 
```

我还有一个额外的复杂性，我也需要删除`.svn`目录。使用`defaultexcludes`,`.*`文件被排除在外，因此空目录并不是真正的空目录，因此也没有被删除。

属性`includeemptydirs`(thanks, flicken, XL-Plüschhase) 允许尾随`**`通配符匹配空字符串。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T17:08:24.710

尝试：

```
<delete includeemptydirs="true">
    <fileset dir="${root}">
          <include name="**/*tmp*/*" />
    </fileset>
</delete> 
```

* * *

谢谢你！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-02-25T19:07:36.063

我只是想补充一点，对我有用的部分解决方案是附加`/**`到包含路径的末尾。我尝试了以下方法来删除 Eclipse .settings 目录：

```
<delete includeemptydirs="true">
    <fileset dir="${basedir}" includes"**/.settings">
</delete> 
```

但直到我将其更改为以下内容时它才起作用：

```
<delete includeemptydirs="true">
    <fileset dir="${basedir}" includes"**/.settings/**">
</delete> 
```

出于某种原因，附加`/**`到路径会删除匹配目录中的文件、所有子目录、子目录和匹配目录中的所有文件。追加`/*`只会删除匹配目录中的文件，但不会删除匹配目录。

# javascript - onbeforeunload 支持检测

> ID：158673
> 
> 赞同：20
> 
> 时间：2008-10-01T17:08:28.610
> 
> 标签：javascript

我想检查当前浏览器是否支持 onbeforeunload 事件。执行此操作的常见 javascript 方法似乎不起作用：

```
if (window.onbeforeunload) {
    alert('yes');
}
else {
    alert('no');
} 
```

实际上，它只检查是否某个处理程序已附加到事件。有没有办法在不检测特定浏览器名称的情况下检测是否支持 onbeforeunload？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-08-11T20:46:28.000

不久前，我写了一篇关于在现代浏览器[中检测事件支持](http://perfectionkills.com/detecting-event-support-without-browser-sniffing/)的或多或少可靠的推理。您可以在演示页面上看到至少 Safari 4+、FF3.x+ 和 IE 支持“beforeunload”。

**编辑**：这种技术现在用于 jQuery、Prototype.js、Modernizr 以及可能的其他脚本和库。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-08-08T22:33:47.277

不幸的是[，kangax 的答案](https://stackoverflow.com/a/1262811/345716)不适用于[iOS 上的 Safari](https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad)。在我的测试`beforeunload`中，我尝试过的每个浏览器都支持，除了 IOS 上的 Safari :-(

相反，我建议采用不同的方法：

这个想法很简单。在第一次访问页面时，我们实际上还不知道是否 `beforeunload`支持。但是在第一页上，我们设置了一个 `unload`和一个`beforeunload`处理程序。如果`beforeunload`处理程序触发，我们设置一个标志，表示`beforeunload`支持（实际上`beforeunloadSupported = "yes"`）。当`unload`处理程序触发时，如果尚未设置标志，我们将设置`beforeunload`不*支持*的标志。

在下文中，我们将使用`localStorage`（在我关心的所有浏览器中都支持 - 请参阅[http://caniuse.com/namevalue-storage](http://caniuse.com/namevalue-storage)）来获取/设置标志。我们也可以使用 cookie，但我选择了`localStorage`因为没有理由在每次请求时都将这些信息发送到 Web 服务器。我们只需要一个在页面重新加载后仍然存在的标志。一旦我们检测到它一次，它将永远被检测到。

有了这个，你现在可以打电话`isBeforeunloadSupported()`，它会告诉你。

```
(function($) {
    var field = 'beforeunloadSupported';
    if (window.localStorage &&
        window.localStorage.getItem &&
        window.localStorage.setItem &&
        ! window.localStorage.getItem(field)) {
        $(window).on('beforeunload', function () {
            window.localStorage.setItem(field, 'yes');
        });
        $(window).on('unload', function () {
            // If unload fires, and beforeunload hasn't set the field,
            // then beforeunload didn't fire and is therefore not
            // supported (cough * iPad * cough)
            if (! window.localStorage.getItem(field)) {
                window.localStorage.setItem(field, 'no');
            }
        });
    }
    window.isBeforeunloadSupported = function () {
        if (window.localStorage &&
            window.localStorage.getItem &&
            window.localStorage.getItem(field) &&
            window.localStorage.getItem(field) == "yes" ) {
            return true;
        } else {
            return false;
        }
    }
})(jQuery); 
```

这是一个完整的[jsfiddle](http://jsfiddle.net/pmorch/tW827/)示例用法。

请注意，它只会在您网站上的第二次或任何后续页面加载时检测到。如果让它在第一页上工作对您来说也很重要，您可以`iframe`在该页面上加载一个属性，该`src`属性指向同一域上的一个页面，并在此处进行检测，确保它已加载，然后将其删除。这应该确保检测已经完成，因此`isBeforeunloadSupported()`即使在第一页上也能正常工作。但我不需要那个，所以我没有把它放在我的演示中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-06-18T21:18:59.570

我意识到我在这个方面有点晚了，但我现在正在处理这个问题，我认为更像下面的东西会更容易和更可靠。这是特定于 jQuery 的，但它应该适用于任何允许绑定和取消绑定事件的系统。

```
$(window).bind('unload', function(){
    alert('unload event');
});

window.onbeforeunload = function(){
    $(window).unbind('unload');
    return 'beforeunload event';
} 
```

`unload`如果事件触发，这应该取消绑定`beforeunload`事件。否则它只会触发卸载。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T17:39:40.453

```
alert('onbeforeunload' in window); 
```

`onbeforeunload`如果是`window`（即使它为空）的属性，则警报为“真” 。

这应该做同样的事情：

```
var supportsOnbeforeunload = false;
for (var prop in window) {
    if (prop === 'onbeforeunload') {
    supportsOnbeforeunload = true;
    break;
    }
}
alert(supportsOnbeforeunload); 
```

最后：

```
alert(typeof window.onbeforeunload != 'undefined'); 
```

同样，`typeof window.onbeforeunload`它似乎是“对象”，即使它当前具有 value `null`，所以这是可行的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T18:03:50.410

结壳，

DOM-Events 规范中没有定义“beforeunload”，这是 IE 特有的功能。我认为创建它是为了在标准“卸载”事件之前触发执行。在其他 IE 浏览器中，您可以使用捕获阶段“卸载”事件侦听器，从而在例如内联正文 onunload 事件之前执行代码。

此外，**DOM 不提供任何接口来测试其对特定事件的支持**，您只能测试对事件组（MouseEvents、MutationEvents 等）的支持。

同时也可以参考 DOM-Events 规范[http://www.w3.org/TR/DOM-Level-3-Events/events.html](http://www.w3.org/TR/DOM-Level-3-Events/events.html)（可惜IE不支持）

希望这些信息对一些人有所帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T17:29:32.583

不同的方法，获取 typeof

```
if(typeof window.onbeforeunload == 'function')

{
alert("hello functionality!");
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-16T15:59:43.447

FF 也支持 onbeforeunload，因此对浏览器的测试无济于事。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-10-17T23:35:41.580

移动浏览器不会倾向于不支持`beforeunload`，因为浏览器可以在不卸载页面的情况下进入后台，然后随时被操作系统杀死。

但是，所有现代非移动浏览器都支持它。因此，您只需检查浏览器是否为移动浏览器即可。

为了解决我使用的问题：

```
var isMobile = navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/iPhone|iPad|iPod/i) || navigator.userAgent.match(/Opera Mini/i) || navigator.userAgent.match(/IEMobile/i);
if (isMobile)
{
    window.addEventListener("visibilitychange", function(e)
    {
        if (document.visibilityState == 'hidden')
        {
            console.log("beforeunload");
            location.reload();
        }
    });
}
else
{
    window.addEventListener("beforeunload", function(e)
    {
        console.log("beforeunload");
    });
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-09-29T23:37:07.890

我看到这是一个非常古老的线程，但接受的答案错误地检测到 iOS 上对 Safari 的支持，这导致我调查其他策略：

```
if ('onbeforeunload' in window && typeof window['onbeforeunload'] === 'function') {
  // onbeforeunload is supported
} else {
  // maybe bind to unload as a last resort
} 
```

if-check 的第二部分对于 iOS 上的 Safari 是必需的，它的属性设置为`null`.

*在 Chrome 37、IE11、Firefox 32 和 Safari for iOS 7.1 中测试*

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-10-01T17:28:44.520

最好手动找出哪些浏览器支持它，然后让你的条件更像：

```
if( $.browser.msie ) {
  alert( 'no' );
} 
```

...ETC。

这`$.browser.msie`是 jQuery 语法，大多数框架都有类似的内置函数，因为它们在内部使用了很多。如果您不使用框架，那么我建议您只看一下 jQuery 对这些功能的实现。

# tcp - TCP 连接寿命

> ID：158674
> 
> 赞同：25
> 
> 时间：2008-10-01T17:08:39.560
> 
> 标签：tcp

我可以期望客户端/服务器 TCP 连接在野外持续多长时间？

我希望它保持永久连接，但事情发生了，所以客户端将不得不重新连接。我在什么时候说代码有问题而不是某些外部设备有问题？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-01T17:32:13.823

我同意赞猞猁的观点。无法保证，但假设没有连接或带宽问题，您可以通过在其上发送数据来几乎无限期地保持连接。

一般来说，我已经采用了应用程序级别的保持活动方法，尽管这通常是因为它已经在客户端规范中，所以我不得不这样做。但只需每分钟或两分钟发送一些简短的数据，您期望得到某种确认。

是否计算一次失败以确认连接失败取决于您。通常这是我过去所做的，尽管有一个案例我连续等待三个失败的响应以断开连接，因为连接另一端的应用程序在响应“你在吗”时非常不稳定？” 要求。

如果连接失败，在某些时候它可能会失败，即使是同一网络上的机器，然后尝试重新建立它。如果失败了一定次数，那么你就有问题了。如果您的连接在连接一段时间后仍然持续失败，那么您就有问题了。在这两种情况下，最有可能的是一些网络问题，而不是你的代码，或者你机器上的 TCP/IP 堆栈有问题（已知：我在旧版本的 QNX 上遇到了这个问题——它会只是随机摔倒）。话虽如此，您可能遇到了软件问题，唯一确定的方法通常是附加调试器，或者在那里进行一些登录。例如，如果您始终可以成功连接，但一段时间后您停止收到 ACK，即使重新连接后，您的服务器也可能死锁，

真正有用的是在各种负载条件下设置一系列长时间运行的测试，从仅发送 keep alive are you there?/ack 请求和响应，到彻底破坏服务器。这通常会让您对您的软件组件更有信心，并且对于消除一些非常奇怪的问题非常有用，这些问题不一定会导致您的连接出现问题，尽管它们可能会导致发生的事务出现问题。例如，我曾经写过一个电信应用服务器，它提供诸如号码翻译之类的服务，而我们只是让它一次运行几天。问题是，当星期六到来时，一整天，它会拒绝每一个打进来的电话请求，这相当于数百万个电话，我们不知道为什么。

希望有帮助。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-07T07:39:18.110

我认为这里最重要的想法是理论与实践。

最初的理论是连接没有生命周期。如果您有连接，即使没有流量，它也会永远保持打开状态，直到某个事件导致它关闭。

新理论是大多数操作系统版本都打开了保活计时器。这意味着连接将永远持续下去，只要另一端的系统响应偶尔的 TCP 级交换。

实际上，许多连接将在一段时间后终止，具有各种标准和情况。

两个非常好的例子是：远程客户端使用 DHCP，租约到期，IP 地址更改。

另一个例子是防火墙，它似乎越来越智能，可以识别保持活动流量与真实数据，并根据任何高级标准关闭连接，尤其是空闲时间。

您希望如何实现重新连接逻辑在很大程度上取决于您的架构、工作环境和您的性能目标。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T17:10:11.770

没关系，如果这是所需的行为，您应该将代码设计为自动重新连接。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T17:13:02.530

真的没有办法说。TCP 本身没有任何东西会导致连接在一定时间后断开。使用可靠连接的人可能有多年的正常运行时间，而使用不同连接的人可能必须每 5 分钟重新连接一次。没有办法告诉甚至猜测。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T17:18:30.457

您需要定期通过连接传输一些数据以使其保持活动状态 - 许多操作系统或防火墙会断开非活动连接。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-01T17:18:19.553

选择一个值。每小时一滴可能没问题。5 分钟内出现 10 次意外连接断开可能表明存在问题。

TCP 连接通常会持续大约两个小时而没有任何流量。任何一端都可以发送保持活动的数据包，我认为这只是对最后收到的数据包的确认。这通常可以在每个套接字上设置，也可以在每个 TCP 连接上默认设置。

应用程序级别的保持活动也是可能的。对于 FTP、SMTP、POP 或 IMAP 之类的 telnet 样式协议，例如发送返回、换行符和返回命令提示符。

# spreadsheet - Web 应用程序中的类似电子表格的功能

> ID：158695
> 
> 赞同：0
> 
> 时间：2008-10-01T17:14:41.900
> 
> 标签：spreadsheet, xml-spreadsheet

我有一个用于商业物业管理的网络应用程序，它需要类似电子表格的功能来做预算。我不想使用 Google 表格，因为我的用户不一定有 Google 帐户。

那么有什么我可以使用的吗？

我看了看，只能找到对我来说不够好的[SocialCalc 。](http://www.socialcalc.org/)

**选项：**

*   [ExtJS](http://extjs.com/deploy/dev/examples/grid/edit-grid.html)网格组件（开源 [GPL3] 和商业许可）*   [Infragistics](http://www.infragistics.com/) Grid 组件（商业许可）*   TreeGrid（商业许可，免费版最多[33 行](http://www.coqsoft.com/TreeGrid5_7/Html/EJSTreeGrid.html)）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:21:10.777

如果您不介意自己实现逻辑，[ExtJS](http://extjs.com/deploy/dev/examples/grid/edit-grid.html)网格组件是一个 JavaScript 网格组件，具有许多强大的功能，并且提供开源和商业版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T17:59:12.323

我已经成功使用了 dhtmlXGrid。有一个开源版本，您可以免费使用它来开发您的应用程序。假设一切正常，您可以花 200 美元购买许可证并将其与您的应用程序一起分发。

非常容易使用；创建一个包含数据的 HTML 表格结构，然后将 dhtmlXGrid 绑定到表格 - 它会自动将表格单元格转换为可编辑字段。

在这里查看：[http ://www.dhtmlx.com/docs/products/dhtmlxGrid](http://www.dhtmlx.com/docs/products/dhtmlxGrid)

同样，您需要自己实现电子表格逻辑，但 dhtmlXGrid 可以直接将其转换为可编辑的列/行显示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T18:33:25.143

[Farpoint](http://www.fpoint.com/)有一个很好的网格

他们有可用的网络和赢取表格网格，价格也不错

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T17:17:21.723

[Infragistics](http://www.infragistics.com)在其数据网格产品中具有电子表格类型的功能

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T17:20:00.483

您可能想尝试一下 treegrid@www.coqsoft.com 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T17:56:16.263

试试telerik radgrid。这是一个相当不错的 .net 用户控件，可以轻松呈现 XML 数据源以供用户编辑。它还完全启用了 Ajax，以避免在输入大量数据时出现延迟。

# .net - 可以在 ASP.NET 应用程序之外使用 HttpRuntime.Cache 吗？

> ID：158703
> 
> 赞同：39
> 
> 时间：2008-10-01T17:17:54.937
> 
> 标签：.net, caching

Scott Hanselman[说是](http://www.hanselman.com/blog/UsingTheASPNETCacheOutsideOfASPNET.aspx)的。

> 将 System.Web 添加到您的非 Web 项目是让人们恐慌的好方法。另一个是在 C# 应用程序中添加对 Microsoft.VisualBasic 的引用。不过，两者都是合理且非常有用的事情。

MSDN[说不](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx)。

> Cache 类不适合在 ASP.NET 应用程序之外使用。它是为在 ASP.NET 中使用而设计和测试的，以便为 Web 应用程序提供缓存。在其他类型的应用程序中，例如控制台应用程序或 Windows 窗体应用程序，ASP.NET 缓存可能无法正常工作。

那我应该怎么想？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-05-05T08:08:48.220

我意识到这个问题已经过时了，但是为了帮助通过搜索找到这个问题的任何人，值得注意的是 .net v4 包含用于此类场景的新通用缓存。它在 System.Runtime.Caching 命名空间中：

[https://msdn.microsoft.com/en-us/library/dd997357(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/dd997357(v=vs.110).aspx)

默认缓存实例的静态引用是：MemoryCache.Default

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T17:23:05.360

使用 HttpRuntime.Cache 应该没有任何问题。这是一个复杂的内存哈希表，在 Web 环境之外非常有用。尽管如此，在非 Http 相关的应用程序中引用 HttpRuntime.Cache 可能有点代码味道，因此将它包装在一些 ICache 接口后面并尽可能使用它可能是一个好主意。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T17:22:29.387

要记住的一件事是，Microsoft 已经发布了 .NET Framework Client Profile Setup Package。这是针对客户端应用程序的 3.5 框架版本，占用空间更小。客户端配置文件不包括框架的 ASP.NET 部分。

如果您的应用程序依赖于 System.Web，它将阻止您的应用程序利用客户端配置文件。

有关详细信息，请参阅[Scott Gu 的博客。](http://weblogs.asp.net/scottgu/archive/2008/05/12/visual-studio-2008-and-net-framework-3-5-service-pack-1-beta.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T17:27:57.720

在当前版本的 System.Web.Caching.Cache 中似乎没有任何依赖于 HTTP 运行时的东西，除了**`Insert()`**接受 a 的方法 `CacheItemUpdateCallback`，所以 Scott 在大多数情况下是正确的。

这并不妨碍 Microsoft 将来修改该类以与 HTTP 基础结构更加集成。

我在另一个答案中写了一个[基于 WeakReference 的轻量级缓存。](https://stackoverflow.com/questions/15593/practical-use-of-systemweakreference#15616)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T17:22:58.323

不要使用它，即使它确实有效，它也会在下一个服务包/版本中停止工作。

当您基于内部实现细节而不是合同（在本例中为 MSDN）做某事时，您可能会在未来遇到麻烦。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T20:35:55.257

我曾经使用过它，但感觉不对，IIRC 显着增加了内存占用。相反，我实现了自己的轻量级缓存机制，这非常容易做到。

它利用了[WeakReference](http://msdn.microsoft.com/en-us/library/system.weakreference.aspx)类，该类允许缓存保留对对象的引用，但也允许垃圾收集器在引用未使用时回收内存。

我唯一没有的是一个单独的线程来清理缓存中的陈旧项目。我所做的是，如果缓存中有 > x 个项目，我会检查所有缓存的项目并在添加新项目之前删除旧项目。

如果您需要更健壮的东西，请使用 MS Enterprise Library [Caching Application Block](http://msdn.microsoft.com/en-us/library/cc511588.aspx)之类的东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-05T13:50:39.990

如果您正在寻找通用解决方案：这是依赖注入方法的典型情况。使用这种方法，您可以关注 Scott Hanselman**和**MSDN！

注入像 HttpRuntime.Cache 这样的 System.Web 依赖项，而您的库中没有 System.Web 引用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T17:21:18.157

为什么不完全避免这个问题并使用[企业库的缓存块](http://msdn.microsoft.com/en-us/library/cc511588.aspx)？您可以使用 System.Web.Caching，但如果遇到问题，您可能无法获得 Microsoft 支持，而且您会引起注意，因此可能不值得。

# c# - 如何正确清理 Excel 互操作对象？

> ID：158706
> 
> 赞同：787
> 
> 时间：2008-10-01T17:18:43.513
> 
> 标签：c#, excel, interop, com-interop

我在 C# ( `ApplicationClass`) 中使用 Excel 互操作，并在 finally 子句中放置了以下代码：

```
while (System.Runtime.InteropServices.Marshal.ReleaseComObject(excelSheet) != 0) { }
excelSheet = null;
GC.Collect();
GC.WaitForPendingFinalizers(); 
```

尽管这种方法有效，但`Excel.exe`即使在我关闭 Excel 后，该过程仍在后台。只有在我的应用程序手动关闭后才会发布。

我做错了什么，或者是否有其他方法可以确保正确处理互操作对象？

* * *

## 回答 #1

> 赞同：703
> 
> 时间：2008-10-01T17:30:41.020

Excel 不会退出，因为您的应用程序仍持有对 COM 对象的引用。

**我猜您正在调用 COM 对象的至少一个成员，而没有将其分配给变量。**

对我来说，这是我直接使用的*excelApp.Worksheets*对象，而没有将其分配给变量：

```
Worksheet sheet = excelApp.Worksheets.Open(...);
...
Marshal.ReleaseComObject(sheet); 
```

我不知道内部 C# 为**Worksheets** COM 对象创建了一个包装器，该包装器没有被我的代码释放（因为我不知道它），这也是 Excel 没有被卸载的原因。

我在[这个页面](http://www.velocityreviews.com/forums/showpost.php?s=f87f0674feda4442dcbd40019cbca65b&p=528575&postcount=2)上找到了我的问题的解决方案，它也有一个很好的规则，用于在 C# 中使用 COM 对象：

> 切勿对 COM 对象使用两个点。

* * *

因此，有了这些知识，执行上述操作的正确方法是：

```
Worksheets sheets = excelApp.Worksheets; // <-- The important part
Worksheet sheet = sheets.Open(...);
...
Marshal.ReleaseComObject(sheets);
Marshal.ReleaseComObject(sheet); 
```

**验尸后更新：**

我希望每位读者都非常仔细地阅读 Hans Passant 的这个答案，因为它解释了我和许多其他开发人员偶然发现的陷阱。当我几年前写这个答案时，我不知道调试器对垃圾收集器的影响并得出了错误的结论。为了历史，我保持我的答案不变，但请阅读此链接并且**不要**走“两个点”的方式：[了解 .NET 中的垃圾收集](https://stackoverflow.com/questions/17130382/understanding-garbage-collection-in-net/17131389#17131389)和[使用 IDisposable 清理 Excel 互操作对象](https://stackoverflow.com/questions/25134024/clean-up-excel-interop-objects-with-idisposable/25135685#25135685)

* * *

## 回答 #2

> 赞同：284
> 
> 时间：2008-10-01T19:54:21.410

您实际上可以干净地释放您的 Excel 应用程序对象，但您必须小心。

为您访问的每个 COM 对象维护一个命名引用然后显式释放它的建议`Marshal.FinalReleaseComObject()`在理论上是正确的，但不幸的是，在实践中很难管理。如果有人在任何地方滑倒并使用“两个点”，或者通过`for each`循环或任何其他类似命令迭代单元格，那么您将拥有未引用的 COM 对象并冒着挂起的风险。在这种情况下，将无法在代码中找到原因；您必须通过肉眼检查所有代码并希望找到原因，这对于大型项目来说几乎是不可能完成的任务。

好消息是您实际上不必维护对您使用的每个 COM 对象的命名变量引用。相反，调用`GC.Collect()`然后`GC.WaitForPendingFinalizers()`释放所有你不持有引用的（通常是次要的）对象，然后显式释放你持有命名变量引用的对象。

您还应该以相反的重要性顺序释放命名引用：首先是范围对象，然后是工作表、工作簿，最后是 Excel 应用程序对象。

例如，假设您有一个名为 的 Range 对象变量、一个名为`xlRng`的 Worksheet 变量`xlSheet`、一个名为 Workbook 的变量`xlBook`和一个名为 的 Excel 应用程序变量`xlApp`，那么您的清理代码可能如下所示：

```
// Cleanup
GC.Collect();
GC.WaitForPendingFinalizers();

Marshal.FinalReleaseComObject(xlRng);
Marshal.FinalReleaseComObject(xlSheet);

xlBook.Close(Type.Missing, Type.Missing, Type.Missing);
Marshal.FinalReleaseComObject(xlBook);

xlApp.Quit();
Marshal.FinalReleaseComObject(xlApp); 
```

在大多数代码示例中，您将看到用于从 .NET 中清理 COM 对象的`GC.Collect()`和`GC.WaitForPendingFinalizers()`调用两次，如下所示：

```
GC.Collect();
GC.WaitForPendingFinalizers();
GC.Collect();
GC.WaitForPendingFinalizers(); 
```

但是，除非您使用 Visual Studio Tools for Office (VSTO)，否则这不是必需的，它使用终结器导致整个对象图在终结队列中提升。*这样的对象在下一次*垃圾回收之前不会被释放。`GC.Collect()`但是，如果您不使用 VSTO ，则应该可以调用`GC.WaitForPendingFinalizers()`一次。

我知道明确调用`GC.Collect()`是一个禁忌（当然两次调用听起来很痛苦），但老实说，没有办法绕过它。通过正常操作，您将生成隐藏的对象，您没有引用这些对象，因此您无法通过调用以外的任何其他方式释放这些对象`GC.Collect()`。

这是一个复杂的话题，但这就是它的全部内容。一旦你为你的清理过程建立了这个模板，你就可以正常编码，而不需要包装等:-)

我在这里有一个教程：

[使用 VB.Net / COM 互操作自动化 Office 程序](http://www.xtremevbtalk.com/showthread.php?t=160433)

它是为 VB.NET 编写的，但不要因此而推迟，原理与使用 C# 时完全相同。

* * *

## 回答 #3

> 赞同：226
> 
> 时间：2009-12-12T14:50:15.970

**前言：我的答案包含两个解决方案，所以阅读时要小心，不要遗漏任何内容。**

如何使 Excel 实例卸载有不同的方法和建议，例如：

*   使用 Marshal.FinalReleaseComObject() 显式释放每个 com 对象（不要忘记隐式创建的 com 对象）。要释放每个创建的 com 对象，您可以使用此处提到的 2 点规则：
    [如何正确清理 Excel 互操作对象？](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c/158752#158752)

*   调用 GC.Collect() 和 GC.WaitForPendingFinalizers() 使 CLR 释放未使用的 com-objects * （实际上，它有效，详见我的第二个解决方案）

*   检查 com-server-application 是否可能显示一个消息框等待用户回答（虽然我不确定它是否可以阻止 Excel 关闭，但我听说过几次）

*   将 WM_CLOSE 消息发送到 Excel 主窗口

*   在单独的 AppDomain 中执行适用于 Excel 的函数。有些人认为 Excel 实例会在 AppDomain 卸载时关闭。

*   杀死在我们的 excel 互操作代码启动后实例化的所有 excel 实例。

**但！**有时所有这些选项都无济于事或不合适！

例如，昨天我发现在我的一个函数（适用于 excel）中，Excel 在函数结束后继续运行。我什么都试过了！我彻底检查了整个函数 10 次，并为所有内容添加了 Marshal.FinalReleaseComObject() ！我也有 GC.Collect() 和 GC.WaitForPendingFinalizers()。我检查了隐藏的消息框。我试图将 WM_CLOSE 消息发送到 Excel 主窗口。我在一个单独的 AppDomain 中执行了我的函数并卸载了该域。没有任何帮助！关闭所有 excel 实例的选项是不合适的，因为如果用户在执行我的也适用于 Excel 的函数期间手动启动另一个 Excel 实例，那么该实例也将被我的函数关闭。我打赌用户不会高兴的！所以，老实说，这是一个蹩脚的选择（没有冒犯的家伙）。**解决方案**：**通过其主窗口的 hWnd 杀死 excel 进程**（这是第一个解决方案）。

这是简单的代码：

```
[DllImport("user32.dll")]
private static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);

/// <summary> Tries to find and kill process by hWnd to the main window of the process.</summary>
/// <param name="hWnd">Handle to the main window of the process.</param>
/// <returns>True if process was found and killed. False if process was not found by hWnd or if it could not be killed.</returns>
public static bool TryKillProcessByMainWindowHwnd(int hWnd)
{
    uint processID;
    GetWindowThreadProcessId((IntPtr)hWnd, out processID);
    if(processID == 0) return false;
    try
    {
        Process.GetProcessById((int)processID).Kill();
    }
    catch (ArgumentException)
    {
        return false;
    }
    catch (Win32Exception)
    {
        return false;
    }
    catch (NotSupportedException)
    {
        return false;
    }
    catch (InvalidOperationException)
    {
        return false;
    }
    return true;
}

/// <summary> Finds and kills process by hWnd to the main window of the process.</summary>
/// <param name="hWnd">Handle to the main window of the process.</param>
/// <exception cref="ArgumentException">
/// Thrown when process is not found by the hWnd parameter (the process is not running). 
/// The identifier of the process might be expired.
/// </exception>
/// <exception cref="Win32Exception">See Process.Kill() exceptions documentation.</exception>
/// <exception cref="NotSupportedException">See Process.Kill() exceptions documentation.</exception>
/// <exception cref="InvalidOperationException">See Process.Kill() exceptions documentation.</exception>
public static void KillProcessByMainWindowHwnd(int hWnd)
{
    uint processID;
    GetWindowThreadProcessId((IntPtr)hWnd, out processID);
    if (processID == 0)
        throw new ArgumentException("Process has not been found by the given main window handle.", "hWnd");
    Process.GetProcessById((int)processID).Kill();
} 
```

正如你所看到的，我提供了两种方法，根据 Try-Parse 模式（我认为在这里是合适的）：如果无法杀死进程，一种方法不会抛出异常（例如进程不再存在） ，如果进程没有被杀死，另一个方法会抛出异常。此代码中唯一的弱点是安全权限。理论上，用户可能没有杀死进程的权限，但在 99.99% 的情况下，用户拥有这样的权限。我还使用访客帐户对其进行了测试 - 它运行良好。

因此，使用 Excel 的代码可能如下所示：

```
int hWnd = xl.Application.Hwnd;
// ...
// here we try to close Excel as usual, with xl.Quit(),
// Marshal.FinalReleaseComObject(xl) and so on
// ...
TryKillProcessByMainWindowHwnd(hWnd); 
```

瞧！Excel 已终止！:)

好的，让我们回到第二个解决方案，正如我在帖子开头所承诺的那样。 **第二种解决方案是调用 GC.Collect() 和 GC.WaitForPendingFinalizers()。**是的，它们确实有效，但你需要在这里小心！
许多人说（我也说过）调用 GC.Collect() 没有帮助。但它没有帮助的原因是如果仍然有对 COM 对象的引用！GC.Collect() 没有帮助的最常见原因之一是在调试模式下运行项目。在调试模式下，不再真正引用的对象在方法结束之前不会被垃圾收集。
因此，如果您尝试了 GC.Collect() 和 GC.WaitForPendingFinalizers() 并没有帮助，请尝试执行以下操作：

1) 尝试在发布模式下运行您的项目并检查 Excel 是否正确关闭

2) 将使用 Excel 的方法包装在一个单独的方法中。所以，而不是这样的事情：

```
void GenerateWorkbook(...)
{
  ApplicationClass xl;
  Workbook xlWB;
  try
  {
    xl = ...
    xlWB = xl.Workbooks.Add(...);
    ...
  }
  finally
  {
    ...
    Marshal.ReleaseComObject(xlWB)
    ...
    GC.Collect();
    GC.WaitForPendingFinalizers();
  }
} 
```

你写：

```
void GenerateWorkbook(...)
{
  try
  {
    GenerateWorkbookInternal(...);
  }
  finally
  {
    GC.Collect();
    GC.WaitForPendingFinalizers();
  }
}

private void GenerateWorkbookInternal(...)
{
  ApplicationClass xl;
  Workbook xlWB;
  try
  {
    xl = ...
    xlWB = xl.Workbooks.Add(...);
    ...
  }
  finally
  {
    ...
    Marshal.ReleaseComObject(xlWB)
    ...
  }
} 
```

现在，Excel 将关闭 =)

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-08-20T16:00:37.047

**更新**：添加了 C# 代码，并链接到 Windows 作业

我花了一些时间试图解决这个问题，当时 XtremeVBTalk 是最活跃和响应最灵敏的。这是我原来的帖子的链接，[Closing an Excel Interop process cleanly, even if your application crashs](http://www.xtremevbtalk.com/showpost.php?p=1335552&postcount=22)。以下是帖子的摘要，以及复制到此帖子的代码。

*   关闭 Interop 进程`Application.Quit()`并`Process.Kill()`在大多数情况下工作，但如果应用程序发生灾难性崩溃，则会失败。即，如果应用程序崩溃，Excel 进程仍将运行松散。
*   解决方案是让操作系统使用 Win32 调用通过[Windows 作业对象处理您的进程的清理。](http://msdn.microsoft.com/en-us/library/ms682409(VS.85).aspx)当您的主应用程序终止时，相关的进程（即 Excel）也将终止。

我发现这是一个干净的解决方案，因为操作系统正在做真正的清理工作。您所要做的就是*注册*Excel 进程。

**Windows 作业代码**

包装 Win32 API 调用以注册互操作进程。

```
public enum JobObjectInfoType
{
    AssociateCompletionPortInformation = 7,
    BasicLimitInformation = 2,
    BasicUIRestrictions = 4,
    EndOfJobTimeInformation = 6,
    ExtendedLimitInformation = 9,
    SecurityLimitInformation = 5,
    GroupInformation = 11
}

[StructLayout(LayoutKind.Sequential)]
public struct SECURITY_ATTRIBUTES
{
    public int nLength;
    public IntPtr lpSecurityDescriptor;
    public int bInheritHandle;
}

[StructLayout(LayoutKind.Sequential)]
struct JOBOBJECT_BASIC_LIMIT_INFORMATION
{
    public Int64 PerProcessUserTimeLimit;
    public Int64 PerJobUserTimeLimit;
    public Int16 LimitFlags;
    public UInt32 MinimumWorkingSetSize;
    public UInt32 MaximumWorkingSetSize;
    public Int16 ActiveProcessLimit;
    public Int64 Affinity;
    public Int16 PriorityClass;
    public Int16 SchedulingClass;
}

[StructLayout(LayoutKind.Sequential)]
struct IO_COUNTERS
{
    public UInt64 ReadOperationCount;
    public UInt64 WriteOperationCount;
    public UInt64 OtherOperationCount;
    public UInt64 ReadTransferCount;
    public UInt64 WriteTransferCount;
    public UInt64 OtherTransferCount;
}

[StructLayout(LayoutKind.Sequential)]
struct JOBOBJECT_EXTENDED_LIMIT_INFORMATION
{
    public JOBOBJECT_BASIC_LIMIT_INFORMATION BasicLimitInformation;
    public IO_COUNTERS IoInfo;
    public UInt32 ProcessMemoryLimit;
    public UInt32 JobMemoryLimit;
    public UInt32 PeakProcessMemoryUsed;
    public UInt32 PeakJobMemoryUsed;
}

public class Job : IDisposable
{
    [DllImport("kernel32.dll", CharSet = CharSet.Unicode)]
    static extern IntPtr CreateJobObject(object a, string lpName);

    [DllImport("kernel32.dll")]
    static extern bool SetInformationJobObject(IntPtr hJob, JobObjectInfoType infoType, IntPtr lpJobObjectInfo, uint cbJobObjectInfoLength);

    [DllImport("kernel32.dll", SetLastError = true)]
    static extern bool AssignProcessToJobObject(IntPtr job, IntPtr process);

    private IntPtr m_handle;
    private bool m_disposed = false;

    public Job()
    {
        m_handle = CreateJobObject(null, null);

        JOBOBJECT_BASIC_LIMIT_INFORMATION info = new JOBOBJECT_BASIC_LIMIT_INFORMATION();
        info.LimitFlags = 0x2000;

        JOBOBJECT_EXTENDED_LIMIT_INFORMATION extendedInfo = new JOBOBJECT_EXTENDED_LIMIT_INFORMATION();
        extendedInfo.BasicLimitInformation = info;

        int length = Marshal.SizeOf(typeof(JOBOBJECT_EXTENDED_LIMIT_INFORMATION));
        IntPtr extendedInfoPtr = Marshal.AllocHGlobal(length);
        Marshal.StructureToPtr(extendedInfo, extendedInfoPtr, false);

        if (!SetInformationJobObject(m_handle, JobObjectInfoType.ExtendedLimitInformation, extendedInfoPtr, (uint)length))
            throw new Exception(string.Format("Unable to set information.  Error: {0}", Marshal.GetLastWin32Error()));
    }

    #region IDisposable Members

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    #endregion

    private void Dispose(bool disposing)
    {
        if (m_disposed)
            return;

        if (disposing) {}

        Close();
        m_disposed = true;
    }

    public void Close()
    {
        Win32.CloseHandle(m_handle);
        m_handle = IntPtr.Zero;
    }

    public bool AddProcess(IntPtr handle)
    {
        return AssignProcessToJobObject(m_handle, handle);
    }

} 
```

**关于构造函数代码的注意事项**

*   在构造函数中，`info.LimitFlags = 0x2000;`被调用。`0x2000`是`JOB_OBJECT_LIMIT_KILL_ON_JOB_CLOSE`枚举值，这个值由[MSDN](http://msdn.microsoft.com/en-us/library/windows/desktop/ms684147(v=vs.85).aspx)定义为：

> 当作业的最后一个句柄关闭时，导致与作业关联的所有进程终止。

**额外的 Win32 API 调用以获取进程 ID (PID)**

```
 [DllImport("user32.dll", SetLastError = true)]
    public static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId); 
```

**使用代码**

```
 Excel.Application app = new Excel.ApplicationClass();
    Job job = new Job();
    uint pid = 0;
    Win32.GetWindowThreadProcessId(new IntPtr(app.Hwnd), out pid);
    job.AddProcess(Process.GetProcessById((int)pid).Handle); 
```

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2008-10-01T17:30:36.217

这适用于我正在从事的一个项目：

```
excelApp.Quit();
Marshal.ReleaseComObject (excelWB);
Marshal.ReleaseComObject (excelApp);
excelApp = null; 
```

我们了解到，当您完成对 Excel COM 对象的**每个**引用时，将其设置为 null 很重要。这包括单元格、表格和所有内容。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2016-06-29T22:50:23.497

首先 - 您*永远*不必打电话`Marshal.ReleaseComObject(...)`或`Marshal.FinalReleaseComObject(...)`在进行 Excel 互操作时。这是一个令人困惑的反模式，但任何有关此的信息（包括来自 Microsoft 的）表明您必须从 .NET 手动释放 COM 引用都是不正确的。事实上，.NET 运行时和垃圾收集器正确地跟踪和清理 COM 引用。对于您的代码，这意味着您可以删除顶部的整个 `while (...) 循环。

其次，如果要确保在进程结束时清理对进程外 COM 对象的 COM 引用（以便 Excel 进程将关闭），则需要确保垃圾收集器运行。您可以通过调用`GC.Collect()`和正确地做到这一点`GC.WaitForPendingFinalizers()`。两次调用它是安全的，并确保循环也被清除（尽管我不确定它是否需要，并且希望有一个显示这一点的示例）。

第三，在调试器下运行时，局部引用会人为地保持活动状态，直到方法结束（这样局部变量检查才起作用）。因此， 调用对于从同一方法`GC.Collect()`中清除对象无效。`rng.Cells`您应该将执行 COM 互操作的代码从 GC 清理中拆分为单独的方法。（这对我来说是一个关键的发现，来自@nightcoder 在此处发布的答案的一部分。）

因此，一般模式是：

```
Sub WrapperThatCleansUp()

    ' NOTE: Don't call Excel objects in here... 
    '       Debugger would keep alive until end, preventing GC cleanup

    ' Call a separate function that talks to Excel
    DoTheWork()

    ' Now let the GC clean up (twice, to clean up cycles too)
    GC.Collect()    
    GC.WaitForPendingFinalizers()
    GC.Collect()    
    GC.WaitForPendingFinalizers()

End Sub

Sub DoTheWork()
    Dim app As New Microsoft.Office.Interop.Excel.Application
    Dim book As Microsoft.Office.Interop.Excel.Workbook = app.Workbooks.Add()
    Dim worksheet As Microsoft.Office.Interop.Excel.Worksheet = book.Worksheets("Sheet1")
    app.Visible = True
    For i As Integer = 1 To 10
        worksheet.Cells.Range("A" & i).Value = "Hello"
    Next
    book.Save()
    book.Close()
    app.Quit()

    ' NOTE: No calls the Marshal.ReleaseComObject() are ever needed
End Sub 
```

关于这个问题有很多虚假信息和混淆，包括 MSDN 和 Stack Overflow 上的许多帖子（尤其是这个问题！）。

最终说服我仔细研究并找出正确建议的是博客文章*[Marshal.ReleaseComObject 被认为是危险](https://blogs.msdn.microsoft.com/visualstudio/2010/03/01/marshal-releasecomobject-considered-dangerous/)*的，以及在调试器下发现引用保持活动状态的问题，这使我之前的测试感到困惑。

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2008-10-01T17:45:45.213

**Excel 命名空间中的任何内容都需要发布。时期**

你不能这样做：

```
Worksheet ws = excel.WorkBooks[1].WorkSheets[1]; 
```

你必须做

```
Workbooks books = excel.WorkBooks;
Workbook book = books[1];
Sheets sheets = book.WorkSheets;
Worksheet ws = sheets[1]; 
```

其次是释放对象。

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2008-12-08T11:10:50.320

我[找到](http://www.deez.info/sengelha/2005/02/11/useful-idisposable-class-3-autoreleasecomobject/)了一个有用的通用模板，它可以帮助实现 COM 对象的正确处置模式，当它们超出范围时需要调用 Marshal.ReleaseComObject：

**用法：**

```
using (AutoReleaseComObject<Application> excelApplicationWrapper = new AutoReleaseComObject<Application>(new Application()))
{
    try
    {
        using (AutoReleaseComObject<Workbook> workbookWrapper = new AutoReleaseComObject<Workbook>(excelApplicationWrapper.ComObject.Workbooks.Open(namedRangeBase.FullName, false, false, missing, missing, missing, true, missing, missing, true, missing, missing, missing, missing, missing)))
        {
           // do something with your workbook....
        }
    }
    finally
    {
         excelApplicationWrapper.ComObject.Quit();
    } 
} 
```

**模板：**

```
public class AutoReleaseComObject<T> : IDisposable
{
    private T m_comObject;
    private bool m_armed = true;
    private bool m_disposed = false;

    public AutoReleaseComObject(T comObject)
    {
        Debug.Assert(comObject != null);
        m_comObject = comObject;
    }

#if DEBUG
    ~AutoReleaseComObject()
    {
        // We should have been disposed using Dispose().
        Debug.WriteLine("Finalize being called, should have been disposed");

        if (this.ComObject != null)
        {
            Debug.WriteLine(string.Format("ComObject was not null:{0}, name:{1}.", this.ComObject, this.ComObjectName));
        }

        //Debug.Assert(false);
    }
#endif

    public T ComObject
    {
        get
        {
            Debug.Assert(!m_disposed);
            return m_comObject;
        }
    }

    private string ComObjectName
    {
        get
        {
            if(this.ComObject is Microsoft.Office.Interop.Excel.Workbook)
            {
                return ((Microsoft.Office.Interop.Excel.Workbook)this.ComObject).Name;
            }

            return null;
        }
    }

    public void Disarm()
    {
        Debug.Assert(!m_disposed);
        m_armed = false;
    }

    #region IDisposable Members

    public void Dispose()
    {
        Dispose(true);
#if DEBUG
        GC.SuppressFinalize(this);
#endif
    }

    #endregion

    protected virtual void Dispose(bool disposing)
    {
        if (!m_disposed)
        {
            if (m_armed)
            {
                int refcnt = 0;
                do
                {
                    refcnt = System.Runtime.InteropServices.Marshal.ReleaseComObject(m_comObject);
                } while (refcnt > 0);

                m_comObject = default(T);
            }

            m_disposed = true;
        }
    }
} 
```

**参考：**

[http://www.deez.info/sengelha/2005/02/11/useful-idisposable-class-3-autoreleasecomobject/](http://www.deez.info/sengelha/2005/02/11/useful-idisposable-class-3-autoreleasecomobject/)

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2010-11-21T03:41:13.067

我不敢相信这个问题已经困扰了世界 5 年......如果您创建了一个应用程序，您需要先将其关闭，然后再删除链接。

```
objExcel = new Excel.Application();  
objBook = (Excel.Workbook)(objExcel.Workbooks.Add(Type.Missing)); 
```

关闭时

```
objBook.Close(true, Type.Missing, Type.Missing); 
objExcel.Application.Quit();
objExcel.Quit(); 
```

当您新建一个 excel 应用程序时，它会在后台打开一个 excel 程序。您需要在释放链接之前命令该 excel 程序退出，因为该 excel 程序不是您直接控制的一部分。因此，如果链接被释放，它将保持打开状态！

大家编程好~~

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2009-10-16T11:01:36.883

普通开发者，你们的解决方案都不适合我，所以我决定实现一个新**技巧**。

首先让我们指定“我们的目标是什么？” => “我们在任务管理器中工作后看不到 excel 对象”

行。让 no 挑战并开始破坏它，但考虑不要破坏并行运行的其他实例 os Excel。

因此，获取当前处理器列表并获取 EXCEL 进程的 PID，然后一旦你的工作完成，我们就会在进程列表中拥有一个具有唯一 PID 的新来宾，找到并销毁那个。

< 请记住，在您的 excel 作业期间任何新的 excel 进程都将被检测为新进程并被销毁 > <更好的解决方案是捕获新创建的 excel 对象的 PID 并销毁它>

```
Process[] prs = Process.GetProcesses();
List<int> excelPID = new List<int>();
foreach (Process p in prs)
   if (p.ProcessName == "EXCEL")
       excelPID.Add(p.Id);

.... // your job 

prs = Process.GetProcesses();
foreach (Process p in prs)
   if (p.ProcessName == "EXCEL" && !excelPID.Contains(p.Id))
       p.Kill(); 
```

这解决了我的问题，希望你也是。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2011-08-31T21:18:17.040

这肯定看起来过于复杂了。根据我的经验，让 Excel 正确关闭只有三个关键因素：

1：确保没有对您创建的 excel 应用程序的剩余引用（无论如何，您应该只有一个；将其设置为`null`）

2：打电话`GC.Collect()`

3：必须关闭 Excel，要么由用户手动关闭程序，要么由您调用`Quit`Excel 对象。（请注意，它`Quit`的功能就像用户试图关闭程序一样，如果有未保存的更改，即使 Excel 不可见，也会显示一个确认对话框。用户可以按取消，然后 Excel 将不会关闭。 )

1 需要在 2 之前发生，但 3 可以随时发生。

实现这一点的一种方法是用您自己的类包装互操作 Excel 对象，在构造函数中创建互操作实例，并使用 Dispose 实现 IDisposable 看起来像

```
if (!mDisposed) {
   mExcel = null;
   GC.Collect();
   mDisposed = true;
} 
```

这将从您的程序方面清除 excel。一旦 Excel 关闭（由用户手动或您调用`Quit`），该过程将消失。如果程序已经关闭，那么该进程将在`GC.Collect()`调用时消失。

（我不确定它有多重要，但您可能希望在`GC.WaitForPendingFinalizers()`通话后打个`GC.Collect()`电话，但摆脱 Excel 流程并不是绝对必要的。）

多年来，这对我来说一直没有问题。请记住，虽然这有效，但您实际上必须优雅地关闭才能使其正常工作。如果在清理 Excel 之前中断程序（通常在调试程序时点击“停止”），您仍然会累积 excel.exe 进程。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2013-03-28T14:12:39.593

我传统上遵循[VVS 的回答](https://stackoverflow.com/a/158752/741988)中的建议。但是，为了使这个答案与最新选项保持同步，我认为我未来的所有项目都将使用“NetOffice”库。

[NetOffice](https://osdn.net/projects/netoffice/)是 Office PIA 的完全替代品，并且完全与版本无关。它是托管 COM 包装器的集合，可以处理在 .NET 中使用 Microsoft Office 时经常引起此类头痛的清理工作。

一些主要特点是：

*   大部分与版本无关（并记录了与版本相关的功能）
*   无依赖
*   没有 PIA
*   没有注册
*   没有 VSTO

我与该项目没有任何关系；我真的很欣赏头痛的明显减少。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2010-12-06T13:08:35.833

添加 Excel 不关闭的原因，即使您在读取时创建对每个对象的直接引用，创建也是“For”循环。

```
For Each objWorkBook As WorkBook in objWorkBooks 'local ref, created from ExcelApp.WorkBooks to avoid the double-dot
   objWorkBook.Close 'or whatever
   FinalReleaseComObject(objWorkBook)
   objWorkBook = Nothing
Next 

'The above does not work, and this is the workaround:

For intCounter As Integer = 1 To mobjExcel_WorkBooks.Count
   Dim objTempWorkBook As Workbook = mobjExcel_WorkBooks.Item(intCounter)
   objTempWorkBook.Saved = True
   objTempWorkBook.Close(False, Type.Missing, Type.Missing)
   FinalReleaseComObject(objTempWorkBook)
   objTempWorkBook = Nothing
Next 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2009-12-17T20:15:04.830

这里接受的答案是正确的，但还要注意不仅需要避免“两点”引用，还需要避免通过索引检索的对象。你也不需要等到你完成程序来清理这些对象，最好创建函数，一旦你完成它们就会清理它们，如果可能的话。这是我创建的一个函数，它分配了一个名为的 Style 对象的一些属性`xlStyleHeader`：

```
public Excel.Style xlStyleHeader = null;

private void CreateHeaderStyle()
{
    Excel.Styles xlStyles = null;
    Excel.Font xlFont = null;
    Excel.Interior xlInterior = null;
    Excel.Borders xlBorders = null;
    Excel.Border xlBorderBottom = null;

    try
    {
        xlStyles = xlWorkbook.Styles;
        xlStyleHeader = xlStyles.Add("Header", Type.Missing);

        // Text Format
        xlStyleHeader.NumberFormat = "@";

        // Bold
        xlFont = xlStyleHeader.Font;
        xlFont.Bold = true;

        // Light Gray Cell Color
        xlInterior = xlStyleHeader.Interior;
        xlInterior.Color = 12632256;

        // Medium Bottom border
        xlBorders = xlStyleHeader.Borders;
        xlBorderBottom = xlBorders[Excel.XlBordersIndex.xlEdgeBottom];
        xlBorderBottom.Weight = Excel.XlBorderWeight.xlMedium;
    }
    catch (Exception ex)
    {
        throw ex;
    }
    finally
    {
        Release(xlBorderBottom);
        Release(xlBorders);
        Release(xlInterior);
        Release(xlFont);
        Release(xlStyles);
    }
}

private void Release(object obj)
{
    // Errors are ignored per Microsoft's suggestion for this type of function:
    // http://support.microsoft.com/default.aspx/kb/317109
    try
    {
        System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
    }
    catch { } 
} 
```

请注意，我必须设置`xlBorders[Excel.XlBordersIndex.xlEdgeBottom]`一个变量才能清理它（不是因为两个点，它们指的是不需要释放的枚举，而是因为我指的对象实际上是一个 Border 对象确实需要发布）。

这种事情在标准应用程序中并不是真正需要的，它们可以很好地自行清理，但在 ASP.NET 应用程序中，如果你错过了其中一个，无论你多久调用一次垃圾收集器，Excel 都会仍在您的服务器上运行。

在编写此代码时，在监视任务管理器的同时，它需要对细节和许多测试执行非常关注，但这样做可以省去拼命搜索代码页以找到您错过的一个实例的麻烦。这在循环中工作时尤其重要，您需要释放对象的每个实例，即使它在每次循环时使用相同的变量名。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2013-11-18T22:58:12.140

尝试后

1.  以相反的顺序释放 COM 对象
2.  最后加上`GC.Collect()`and`GC.WaitForPendingFinalizers()`两次
3.  不超过两个点
4.  关闭工作簿并退出应用程序
5.  在发布模式下运行

对我有用的最终解决方案是移动一组

```
GC.Collect();
GC.WaitForPendingFinalizers(); 
```

我们在函数的末尾添加了一个包装器，如下所示：

```
private void FunctionWrapper(string sourcePath, string targetPath)
{
    try
    {
        FunctionThatCallsExcel(sourcePath, targetPath);
    }
    finally
    {
        GC.Collect();
        GC.WaitForPendingFinalizers();
    }
} 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2014-02-25T03:35:56.367

我完全遵循了这一点......但我仍然遇到了 1000 次中的问题。谁知道为什么。是时候拿出锤子了……

在实例化 Excel 应用程序类之后，我立即获得了刚刚创建的 Excel 进程。

```
excel = new Microsoft.Office.Interop.Excel.Application();
var process = Process.GetProcessesByName("EXCEL").OrderByDescending(p => p.StartTime).First(); 
```

然后，一旦我完成了上述所有 COM 清理，我确保该进程没有运行。如果它还在运行，就杀死它！

```
if (!process.HasExited)
   process.Kill(); 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2013-06-14T15:16:58.820

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2008-11-06T15:21:25.463

您需要知道 Excel 对您所处的文化也非常敏感。

您可能会发现在调用 Excel 函数之前需要将区域性设置为 EN-US。这不适用于所有功能 - 但其中一些功能。

```
 CultureInfo en_US = new System.Globalization.CultureInfo("en-US"); 
    System.Threading.Thread.CurrentThread.CurrentCulture = en_US;
    string filePathLocal = _applicationObject.ActiveWorkbook.Path;
    System.Threading.Thread.CurrentThread.CurrentCulture = orgCulture; 
```

即使您使用的是 VSTO，这也适用。

详情： http: [//support.microsoft.com/default.aspx ?scid=kb;en-us;Q320369](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q320369)

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2012-06-25T06:52:30.430

“永远不要对 COM 对象使用两个点”是避免 COM 引用泄漏的一个很好的经验法则，但 Excel PIA 可能导致泄漏的方式比乍看之下更明显。

其中一种方法是订阅任何 Excel 对象模型的 COM 对象公开的任何事件。

例如，订阅 Application 类的 WorkbookOpen 事件。

### 关于 COM 事件的一些理论

COM 类通过回调接口公开一组事件。为了订阅事件，客户端代码可以简单地注册一个实现回调接口的对象，COM类将调用它的方法来响应特定的事件。由于回调接口是一个 COM 接口，因此实现对象有责任减少它为任何事件处理程序接收的任何 COM 对象（作为参数）的引用计数。

### Excel PIA 如何公开 COM 事件

Excel PIA 将 Excel 应用程序类的 COM 事件公开为常规的 .NET 事件。每当客户端代码订阅**.NET 事件**（强调“a”）时，PIA 都会创建**一个**实现回调接口的类的实例并将其注册到 Excel。

因此，许多回调对象注册到 Excel 以响应来自 .NET 代码的不同订阅请求。每个事件订阅一个回调对象。

用于事件处理的回调接口意味着，PIA 必须为每个 .NET 事件订阅请求订阅所有接口事件。它不能挑挑拣拣。在接收到事件回调时，回调对象会检查关联的 .NET 事件处理程序是否对当前事件感兴趣，然后调用处理程序或静默忽略回调。

### 对 COM 实例引用计数的影响

所有这些回调对象都不会减少它们接收的任何 COM 对象（作为参数）的任何回调方法（即使是那些被静默忽略的方法）的引用计数。它们仅依靠[CLR](http://en.wikipedia.org/wiki/Common_Language_Runtime)垃圾收集器来释放 COM 对象。

由于 GC 运行是不确定的，这可能导致 Excel 进程的延迟时间比预期的更长，并产生“内存泄漏”的印象。

### 解决方案

目前唯一的解决方案是避免使用 PIA 的 COM 类事件提供程序，并编写您自己的事件提供程序，以确定性地释放 COM 对象。

对于 Application 类，这可以通过实现 AppEvents 接口然后使用[IConnectionPointContainer 接口](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comtypes.iconnectionpointcontainer.aspx)向 Excel 注册实现来完成。Application 类（以及所有使用回调机制公开事件的 COM 对象）实现 IConnectionPointContainer 接口。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-10-01T18:26:09.857

正如其他人指出的那样，您需要为您使用的每个 Excel 对象创建一个显式引用，并在该引用上调用 Marshal.ReleaseComObject，如[本知识库文章](http://support.microsoft.com/default.aspx/kb/317109)中所述。您还需要使用 try/finally 来确保始终调用 ReleaseComObject，即使抛出异常也是如此。即代替：

```
Worksheet sheet = excelApp.Worksheets(1)
... do something with sheet 
```

您需要执行以下操作：

```
Worksheets sheets = null;
Worksheet sheet = null
try
{ 
    sheets = excelApp.Worksheets;
    sheet = sheets(1);
    ...
}
finally
{
    if (sheets != null) Marshal.ReleaseComObject(sheets);
    if (sheet != null) Marshal.ReleaseComObject(sheet);
} 
```

如果要关闭 Excel，还需要在释放 Application 对象之前调用 Application.Quit。

正如你所看到的，一旦你尝试做任何甚至中等复杂的事情，这很快就会变得非常笨拙。我已经成功地开发了带有简单包装类的 .NET 应用程序，该类包装了 Excel 对象模型的一些简单操作（打开工作簿、写入范围、保存/关闭工作簿等）。包装类实现 IDisposable，在它使用的每个对象上小心地实现 Marshal.ReleaseComObject，并且不会公开向应用程序的其余部分公开任何 Excel 对象。

但是这种方法不能很好地适应更复杂的需求。

这是.NET COM Interop 的一大缺陷。对于更复杂的场景，我会认真考虑用 VB6 或其他非托管语言编写一个 ActiveX DLL，您可以将所有与进程外 COM 对象（如 Office）的交互委托给它。然后您可以从您的 .NET 应用程序中引用这个 ActiveX DLL，并且事情会容易得多，因为您只需要发布这个引用。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2011-06-18T12:02:35.710

当上面的所有东西都不起作用时，尝试给 Excel 一些时间来关闭它的工作表：

```
app.workbooks.Close();
Thread.Sleep(500); // adjust, for me it works at around 300+
app.Quit();

...
FinalReleaseComObject(app); 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2012-08-08T18:38:33.667

确保释放所有与 Excel 相关的对象！

我花了几个小时尝试了几种方法。都是好主意，但我终于发现了我的错误：**如果您不释放所有对象，那么上述任何方法都无法帮助您**喜欢我的情况。确保释放所有对象，包括范围一！

```
Excel.Range rng = (Excel.Range)worksheet.Cells[1, 1];
worksheet.Paste(rng, false);
releaseObject(rng); 
```

选项都[在这里](http://birvesifir.com/2012/08/08/how-to-properly-clean-up-excel-interop-objects-in-c/)。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-01-11T01:46:22.340

一篇关于释放 COM 对象的好文章是*[2.5 释放 COM 对象](http://msdn.microsoft.com/en-us/library/office/aa679807(v=office.12).aspx#officeinteroperabilitych2_part2_rco)*(MSDN)。

我提倡的方法是将您的 Excel.Interop 引用设为空，如果它们是非局部变量，然后调用`GC.Collect()`and`GC.WaitForPendingFinalizers()`两次。本地范围的互操作变量将被自动处理。

这消除了为**每个**COM 对象保留命名引用的需要。

以下是文章中的一个示例：

```
public class Test {

    // These instance variables must be nulled or Excel will not quit
    private Excel.Application xl;
    private Excel.Workbook book;

    public void DoSomething()
    {
        xl = new Excel.Application();
        xl.Visible = true;
        book = xl.Workbooks.Add(Type.Missing);

        // These variables are locally scoped, so we need not worry about them.
        // Notice I don't care about using two dots.
        Excel.Range rng = book.Worksheets[1].UsedRange;
    }

    public void CleanUp()
    {
        book = null;
        xl.Quit();
        xl = null;

        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();
        GC.WaitForPendingFinalizers();
    }
} 
```

这些话直接来自文章：

> 在几乎所有情况下，清空 RCW 引用并强制进行垃圾回收都会正确清理。如果您还调用 GC.WaitForPendingFinalizers，垃圾收集将尽可能确定。也就是说，您将非常确定对象何时被清理——在第二次调用 WaitForPendingFinalizers 的返回时。作为替代方案，您可以使用 Marshal.ReleaseComObject。但是，请注意，您不太可能需要使用此方法。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2012-03-14T15:47:35.893

您应该非常小心使用 Word/Excel 互操作应用程序。在尝试了所有解决方案之后，我们仍然在服务器上打开了很多“WinWord”进程（超过 2000 个用户）。

在解决这个问题几个小时后，我意识到如果我同时在不同的线程上打开多个文档`Word.ApplicationClass.Document.Open()`，IIS 工作进程 (w3wp.exe) 会崩溃，而所有 WinWord 进程都处于打开状态！

所以我猜这个问题没有绝对的解决办法，而是改用其他方法比如[Office Open XML](https://en.wikipedia.org/wiki/Office_Open_XML)开发。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2013-12-12T22:37:19.883

两点规则对我不起作用。就我而言，我创建了一种清理资源的方法，如下所示：

```
private static void Clean()
{
    workBook.Close();
    Marshall.ReleaseComObject(workBook);
    excel.Quit();
    CG.Collect();
    CG.WaitForPendingFinalizers();
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2014-06-18T09:34:16.183

我的解决方案

```
[DllImport("user32.dll")]
static extern int GetWindowThreadProcessId(int hWnd, out int lpdwProcessId);

private void GenerateExcel()
{
    var excel = new Microsoft.Office.Interop.Excel.Application();
    int id;
    // Find the Excel Process Id (ath the end, you kill him
    GetWindowThreadProcessId(excel.Hwnd, out id);
    Process excelProcess = Process.GetProcessById(id);

try
{
    // Your code
}
finally
{
    excel.Quit();

    // Kill him !
    excelProcess.Kill();
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-10-01T17:47:22.913

我认为其中一些只是框架处理 Office 应用程序的方式，但我可能错了。在某些日子里，一些应用程序会立即清理进程，而其他日子似乎要等到应用程序关闭。总的来说，我不再关注细节，只是确保在一天结束时没有任何额外的流程浮出水面。

另外，也许我过度简化了事情，但我认为你可以......

```
objExcel = new Excel.Application();
objBook = (Excel.Workbook)(objExcel.Workbooks.Add(Type.Missing));
DoSomeStuff(objBook);
SaveTheBook(objBook);
objBook.Close(false, Type.Missing, Type.Missing);
objExcel.Quit(); 
```

就像我之前说的，我不倾向于关注 Excel 进程何时出现或消失的细节，但这通常对我有用。除了极短的时间之外，我也不喜欢保留 Excel 进程，但我可能只是对此感到偏执。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2013-04-11T14:01:14.757

*正如有些人可能已经写过的那样，关闭*Excel（对象）的方式不仅很重要；*打开*它的方式以及项目的类型也很重要。

在 WPF 应用程序中，基本上相同的代码在没有问题或很少有问题的情况下工作。

我有一个项目，其中针对不同的参数值多次处理相同的 Excel 文件 - 例如，根据通用列表中的值解析它。

我把所有与Excel相关的函数都放到了基类中，解析器放到了一个子类中（不同的解析器使用常用的Excel函数）。我不希望为通用列表中的每个项目再次打开和关闭 Excel，所以我只在基类中打开它一次并在子类中关闭它。将代码移动到桌面应用程序时遇到问题。我已经尝试了许多上述解决方案。`GC.Collect()`之前已经实施过，是建议的两倍。

然后我决定将打开 Excel 的代码移到子类中。现在我不是只打开一次，而是创建一个新对象（基类）并为每个项目打开 Excel 并在最后关闭它。有一些性能损失，但根据几个测试 Excel 进程正在关闭而没有问题（在调试模式下），因此也删除了临时文件。如果我能得到一些更新，我将继续测试并写更多。

底线是：您还必须检查初始化代码，特别是如果您有很多类等。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2014-09-05T11:42:45.330

接受的答案对我不起作用。析构函数中的以下代码完成了这项工作。

```
if (xlApp != null)
{
    xlApp.Workbooks.Close();
    xlApp.Quit();
}

System.Diagnostics.Process[] processArray = System.Diagnostics.Process.GetProcessesByName("EXCEL");
foreach (System.Diagnostics.Process process in processArray)
{
    if (process.MainWindowTitle.Length == 0) { process.Kill(); }
} 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2016-08-02T14:32:38.500

我目前正在研究办公自动化，并且偶然发现了一个每次都适用于我的解决方案。它很简单，不涉及杀死任何进程。

似乎仅仅通过循环当前的活动进程，并以任何方式“访问”一个打开的 Excel 进程，任何流浪的 Excel 挂起实例都将被删除。下面的代码仅检查名称为“Excel”的进程，然后将进程的 MainWindowTitle 属性写入字符串。这种与进程的“交互”似乎使 Windows 赶上并中止了冻结的 Excel 实例。

我在我正在开发的加载项退出之前运行以下方法，因为它会触发它的卸载事件。它每次都会删除任何挂起的 Excel 实例。老实说，我不完全确定为什么会这样，但它对我来说效果很好，可以放在任何 Excel 应用程序的末尾，而不必担心双点、Marshal.ReleaseComObject 或终止进程。我会对任何关于为什么这是有效的建议非常感兴趣。

```
public static void SweepExcelProcesses()
{           
            if (Process.GetProcessesByName("EXCEL").Length != 0)
            {
                Process[] processes = Process.GetProcesses();
                foreach (Process process in processes)
                {
                    if (process.ProcessName.ToString() == "excel")
                    {                           
                        string title = process.MainWindowTitle;
                    }
                }
            }
} 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2017-03-10T04:18:09.717

'这肯定看起来过于复杂了。根据我的经验，让 Excel 正确关闭只有三个关键因素：

1：确保没有对您创建的 excel 应用程序的剩余引用（无论如何，您应该只有一个；将其设置为 null）

2：调用 GC.Collect()

3：必须关闭 Excel，要么由用户手动关闭程序，要么由您在 Excel 对象上调用 Quit。（请注意，Quit 的功能就像用户试图关闭程序一样，如果有未保存的更改，即使 Excel 不可见，也会显示一个确认对话框。用户可以按取消，然后 Excel 将不会关闭.)

1 需要在 2 之前发生，但 3 可以随时发生。

实现这一点的一种方法是用您自己的类包装互操作 Excel 对象，在构造函数中创建互操作实例，并使用 Dispose 实现 IDisposable 看起来像

这将从您的程序方面清除 excel。一旦 Excel 关闭（由用户手动或通过您调用 Quit），该过程将消失。如果程序已经关闭，那么该进程将在 GC.Collect() 调用时消失。

（我不确定它有多重要，但您可能希望在 GC.Collect() 调用之后调用 GC.WaitForPendingFinalizers() ，但摆脱 Excel 进程并不是绝对必要的。）

多年来，这对我来说一直没有问题。请记住，虽然这有效，但您实际上必须优雅地关闭才能使其正常工作。如果您在清理 Excel 之前中断程序（通常在调试程序时点击“停止”），您仍然会累积 excel.exe 进程。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2019-04-02T20:24:30.487

这是一个非常简单的方法：

```
[DllImport("User32.dll")]
static extern uint GetWindowThreadProcessId(IntPtr hWnd, out int lpdwProcessId);
...

int objExcelProcessId = 0;

Excel.Application objExcel = new Excel.Application();

GetWindowThreadProcessId(new IntPtr(objExcel.Hwnd), out objExcelProcessId);

Process.GetProcessById(objExcelProcessId).Kill(); 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2019-09-29T06:46:15.000

我的回答迟了，它的唯一目的是通过一个完整的例子来支持 Govert、Porkbutts 和 Dave Cousineau 提出的解决方案。正如我们用德语所说，从与 COM 无关的 .NET 世界中自动化 Excel 或其他 COM 对象是一个“棘手的问题”，您很容易发疯。我依赖以下步骤：

1.  对于与 Excel 的每次交互，获取一个且只有一个`ExcelApp`应用程序接口的本地实例，并创建一个存在于其中的范围`ExcelApp`。这是必要的，因为在对 Excel 的任何引用超出范围之前，CLR 不会释放 Excel 的资源。一个新的 Excel 进程在后台启动。

2.  实现执行任务的函数，`ExcelApp`通过 Collection 属性生成新对象，如 Workbook(s)、Worksheet(s) 和 Cell(s)。在这些函数中，不关心 voodoo one-dot-good, two-dot-bad 规则，不要尝试为每个隐式创建的对象获取引用，也不要做 `Marshall.ReleaseComObject`任何事情。这就是垃圾收集器的工作。

3.  在范围内`ExcelApp`，调用这些函数并传递引用`ExcelApp`。

4.  加载 Excel 实例时，不允许任何会绕过`Quit`再次卸载此实例的函数的用户操作。

5.  使用完 Excel 后，`Quit`在 Excel 处理范围内调用单独的函数。这应该是此范围内的最后一条语句。

在运行我的应用程序之前，打开任务管理器并在“进程”选项卡中查看后台进程中的条目。当您启动程序时，一个新的 Excel 进程条目会出现在列表中并一直停留在那里，直到线程在 5 秒后再次唤醒。之后，将调用 Quit 函数，停止优雅地从后台进程列表中消失的 Excel 进程。

```
using System;
using System.Threading;
using Excel = Microsoft.Office.Interop.Excel;

namespace GCTestOnOffice
{
  class Program
  {
    //Don't: private  static Excel.Application ExcelApp = new Excel.Application();

    private static void DoSomething(Excel.Application ExcelApp)
    {
        Excel.Workbook Wb = ExcelApp.Workbooks.Open(@"D:\Aktuell\SampleWorkbook.xlsx");
        Excel.Worksheet NewWs = Wb.Worksheets.Add();

        for (int i = 1; i < 10; i++)
        {
            NewWs.Cells[i, 1] = i;
        }
        Wb.Save();
    }

    public static void Quit(Excel.Application ExcelApp)
    {
        if (ExcelApp != null)
        {
            ExcelApp.Quit(); //Don't forget!!!!!
            ExcelApp = null;
        }
        GC.Collect();
        GC.WaitForPendingFinalizers();
        GC.Collect();
        GC.WaitForPendingFinalizers();
    }

    static void Main(string[] args)
    {
      {
        Excel.Application ExcelApp = new Excel.Application();
        Thread.Sleep(5000);
        DoSomething(ExcelApp);
        Quit(ExcelApp);
        //ExcelApp goes out of scope, the CLR can and will(!) release Excel
      }

      Console.WriteLine("Input a digit: ");
      int k = Console.Read(); 
    }
  }
} 
```

如果我将 Main 函数更改为

```
static void Main(string[] args)
{
  Excel.Application ExcelApp = new Excel.Application();
  DoSomething(ExcelApp);

  Console.WriteLine("Input a digit: ");
  int k = Console.Read(); 
  Quit(ExcelApp);
} 
```

用户可以不输入数字，而是点击控制台的关闭按钮，我的 Excel 实例从此过上幸福的生活。因此，如果您的 Excel 实例仍然顽固地加载，您的清理功能可能不会出错，但会被不可预见的用户操作绕过。

如果 Program 类有 Excel 实例的成员，CLR 不会在应用程序终止之前卸载 Excel 实例。这就是为什么我更喜欢在不再需要时超出范围的本地引用。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2013-08-27T10:11:24.290

采用：

```
[DllImport("user32.dll")]
private static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId); 
```

声明它，在`finally`块中添加代码：

```
finally
{
    GC.Collect();
    GC.WaitForPendingFinalizers();
    if (excelApp != null)
    {
        excelApp.Quit();
        int hWnd = excelApp.Application.Hwnd;
        uint processID;
        GetWindowThreadProcessId((IntPtr)hWnd, out processID);
        Process[] procs = Process.GetProcessesByName("EXCEL");
        foreach (Process p in procs)
        {
            if (p.Id == processID)
                p.Kill();
        }
        Marshal.FinalReleaseComObject(excelApp);
    }
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2015-05-04T13:12:33.870

到目前为止，似乎所有答案都涉及其中一些：

1.  杀死进程
2.  使用 GC.Collect()
3.  跟踪每个 COM 对象并正确释放它。

这让我明白这个问题有多么困难:)

我一直在开发一个库来简化对 Excel 的访问，我正在努力确保使用它的人不会留下一团糟（手指交叉）。

我没有直接在 Interop 提供的接口上编写代码，而是制作扩展方法以使生活更轻松。像 ApplicationHelpers.CreateExcel() 或 workbook.CreateWorksheet("mySheetNameThatWillBeValidated")。自然地，创建的任何东西都可能导致稍后清理时出现问题，所以我实际上倾向于将进程终止作为最后的手段。然而，正确清理（第三种选择）可能是破坏性最小且可控性最强的。

所以，在那种情况下，我想知道做这样的事情是否最好：

```
public abstract class ReleaseContainer<T>
{
    private readonly Action<T> actionOnT;

    protected ReleaseContainer(T releasible, Action<T> actionOnT)
    {
        this.actionOnT = actionOnT;
        this.Releasible = releasible;
    }

    ~ReleaseContainer()
    {
        Release();
    }

    public T Releasible { get; private set; }

    private void Release()
    {
        actionOnT(Releasible);
        Releasible = default(T);
    }
} 
```

我使用“Releasible”来避免与 Disposable 混淆。不过，将其扩展到 IDisposable 应该很容易。

像这样的实现：

```
public class ApplicationContainer : ReleaseContainer<Application>
{
    public ApplicationContainer()
        : base(new Application(), ActionOnExcel)
    {
    }

    private static void ActionOnExcel(Application application)
    {
        application.Show(); // extension method. want to make sure the app is visible.
        application.Quit();
        Marshal.FinalReleaseComObject(application);
    }
} 
```

人们可以对各种 COM 对象做类似的事情。

在工厂方法中：

```
 public static Application CreateExcelApplication(bool hidden = false)
    {
        var excel = new ApplicationContainer().Releasible;
        excel.Visible = !hidden;

        return excel;
    } 
```

我希望每个容器都会被 GC 正确销毁，因此会自动调用`Quit`and `Marshal.FinalReleaseComObject`。

评论？或者这是对第三类问题的回答？

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2016-04-07T12:29:30.253

只是为了在这里列出的许多解决方案中添加另一个解决方案，使用 C++/ATL 自动化（我想你可以使用类似 VB/C# 的东西？？）

```
Excel::_ApplicationPtr pXL = ...
  :
SendMessage ( ( HWND ) m_pXL->GetHwnd ( ), WM_DESTROY, 0, 0 ) ; 
```

这对我来说就像一个魅力......

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2018-12-19T03:06:10.883

我有个主意，试着杀死你打开的excel进程：

1.  在打开一个 excel 应用程序之前，获取所有名为 oldProcessIds 的进程 ID。
2.  打开excel应用程序。
3.  现在获取所有名为 nowProcessIds 的 excel 应用程序进程 ID。
4.  当需要退出时，杀死 oldProcessIds 和 nowProcessIds 之间的 except ids。

    ```
    private static Excel.Application GetExcelApp()
         {
            if (_excelApp == null)
            {
                var processIds = System.Diagnostics.Process.GetProcessesByName("EXCEL").Select(a => a.Id).ToList();
                _excelApp = new Excel.Application();
                _excelApp.DisplayAlerts = false;

                _excelApp.Visible = false;
                _excelApp.ScreenUpdating = false;
                var newProcessIds = System.Diagnostics.Process.GetProcessesByName("EXCEL").Select(a => a.Id).ToList();
                _excelApplicationProcessId = newProcessIds.Except(processIds).FirstOrDefault();
            }

            return _excelApp;
        }

    public static void Dispose()
        {
            try
            {
                _excelApp.Workbooks.Close();
                _excelApp.Quit();
                System.Runtime.InteropServices.Marshal.ReleaseComObject(_excelApp);
                _excelApp = null;
                GC.Collect();
                GC.WaitForPendingFinalizers();
                if (_excelApplicationProcessId != default(int))
                {
                    var process = System.Diagnostics.Process.GetProcessById(_excelApplicationProcessId);
                    process?.Kill();
                    _excelApplicationProcessId = default(int);
                }
            }
            catch (Exception ex)
            {
                _excelApp = null;
            }

        } 
    ```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2019-01-04T19:26:25.477

使用 Microsoft Excel 2016 测试

一个真正经过测试的解决方案。

C#参考请看： [https ://stackoverflow.com/a/1307180/10442623](https://stackoverflow.com/a/1307180/10442623)

VB.net参考请看： [https ://stackoverflow.com/a/54044646/10442623](https://stackoverflow.com/a/54044646/10442623)

1 包括课堂作业

2 实现类来处理excel过程的适当处理

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2019-07-02T18:25:26.073

在我的 VSTO 插件中更新应用程序对象后，我在关闭 PowerPoint 时遇到了同样的问题。我在这里尝试了所有答案，但成功有限。

这是我为我的案例找到的解决方案 - 不要使用“新应用程序”，ThisAddIn 的 AddInBase 基类已经有一个“应用程序”的句柄。如果您在需要的地方使用该句柄（如果必须将其设为静态），那么您无需担心清理它，PowerPoint 也不会在关闭时挂起。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-12-02T23:00:09.600

在其他答案中考虑的三种一般策略中，终止`excel`进程显然是一种黑客行为，而调用垃圾收集器是一种残酷的霰弹枪方法，旨在补偿*COM*对象的不正确释放。在我的版本无关和后期绑定包装器中进行了大量实验和重写*COM*对象的管理后，我得出结论，准确和及时的调用`Marshal.ReleaseComObject()`是最有效和优雅的策略。不，您永远不需要`FinalReleaseComObject()`，因为在编写良好的程序中，每个*COM*一次获取一次，因此需要对引用计数器进行一次递减。

应确保释放每个单独的*COM*对象，最好在不再需要时立即释放。但是完全有可能在退出*Excel*应用程序后立即释放所有内容，唯一的代价是更高的内存使用率。只要不松动或忘记释放*COM*对象， *Excel就会按预期关闭。*

 *在这个过程中最简单和最明显的帮助是将每个互操作对象包装到一个*.NET*类实现`IDisposable`中，该`Dispose()`方法`ReleaseComObject()`在其互操作对象上调用。在析构函数中执行此操作，如在[此处](https://stackoverflow.com/a/30031089/2862241)提出的那样，没有任何意义，因为析构函数是非确定性的。

`WorkSheet`下面显示的是我们的包装器方法，它通过绕过中间`Cells`成员获取单元格。注意它在使用后处理中间对象的方式：

```
public ExcelRange XCell( int row, int col)
{   ExcelRange anchor, res;
    using( anchor = Range( "A1") )
    {   res = anchor.Offset( row - 1, col - 1 );  }
    return res;
} 
```

下一步可能是一个简单的内存管理器，它将跟踪获得的每个*COM*对象，并确保在*Excel*退出后释放它，如果用户更喜欢用一些 RAM 使用来换取更简单的代码。

### 进一步阅读

1.  [如何正确释放 Excel COM 对象](https://www.add-in-express.com/creating-addins-blog/2013/11/05/release-excel-com-objects/)，
2.  [释放 COM 对象：垃圾收集器与 Marshal.RelseaseComObject](https://www.add-in-express.com/creating-addins-blog/2020/07/20/releasing-com-objects-garbage-collector-marshal-relseasecomobject/)。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2021-11-19T06:33:47.097

我真的很喜欢事情自己清理的时候......所以我做了一些包装类来为我做所有的清理工作！这些记录在下面。

最终代码非常易读且易于访问。我还没有发现`Close()`在工作簿和`Quit()`应用程序之后运行的任何 Excel 幻象实例（除了我调试和关闭应用程序中间进程的地方）。

```
function void OpenCopyClose() {
  var excel = new ExcelApplication();
  var workbook1 = excel.OpenWorkbook("C:\Temp\file1.xslx", readOnly: true);
  var readOnlysheet = workbook1.Worksheet("sheet1");

  var workbook2 = excel.OpenWorkbook("C:\Temp\file2.xslx");
  var writeSheet = workbook.Worksheet("sheet1");

  // do all the excel manipulation

  // read from the first workbook, write to the second workbook.
  var a1 = workbook1.Cells[1, 1];
  workbook2.Cells[1, 1] = a1

  // explicit clean-up
  workbook1.Close(false);
  workbook2 .Close(true);
  excel.Quit();
} 
```

注意：您可以跳过`Close()`and`Quit()`调用，但如果您正在写入 Excel 文档，您至少需要`Save()`. 当对象超出范围（方法返回）时，类终结器将自动启动并进行任何清理。只要您注意变量的范围，工作表 COM 对象对 COM 对象的任何引用都将被自动管理和清理，例如，仅在存储对 COM 对象的引用时才将变量保持在当前范围内。如果需要，您可以轻松地将所需的值复制到 POCO，或者创建其他包装类，如下所述。

为了管理这一切，我创建了一个类，`DisposableComObject`它充当任何 COM 对象的包装器。它实现了`IDisposable`接口，还包含一个终结器，用于那些不喜欢`using`.

该`Dispose()`方法调用`Marshal.ReleaseComObject(ComObject)`然后将`ComObjectRef`属性设置为 null。

`ComObjectRef`当私有属性为空时，对象处于已释放状态。

如果在`ComObject`释放后访问该属性，`ComObjectAccessedAfterDisposeException`则会引发异常。

该`Dispose()`方法可以手动调用。它也被终结器调用，在`using`块结束时，以及`using var`在该变量的范围结束时。

`Microsoft.Office.Interop.Excel`, `Application`,`Workbook`和中的顶级类`Worksheet`有自己的包装类，其中每个都是`DisposableComObject`

这是代码：

```
/// <summary>
/// References to COM objects must be explicitly released when done.
/// Failure to do so can result in odd behavior and processes remaining running after the application has stopped.
/// This class helps to automate the process of disposing the references to COM objects.
/// </summary>
public abstract class DisposableComObject : IDisposable
{
    public class ComObjectAccessedAfterDisposeException : Exception
    {
        public ComObjectAccessedAfterDisposeException() : base("COM object has been accessed after being disposed") { }
    }

    /// <summary>The actual COM object</summary>
    private object ComObjectRef { get; set; }

    /// <summary>The COM object to be used by subclasses</summary>
    /// <exception cref="ComObjectAccessedAfterDisposeException">When the COM object has been disposed</exception>
    protected object ComObject => ComObjectRef ?? throw new ComObjectAccessedAfterDisposeException();

    public DisposableComObject(object comObject) => ComObjectRef = comObject;

    /// <summary>
    /// True, if the COM object has been disposed.
    /// </summary>
    protected bool IsDisposed() => ComObjectRef is null;

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this); // in case a subclass implements a finalizer
    }

    /// <summary>
    /// This method releases the COM object and removes the reference.
    /// This allows the garbage collector to clean up any remaining instance.
    /// </summary>
    /// <param name="disposing">Set to true</param>
    protected virtual void Dispose(bool disposing)
    {
        if (!disposing || IsDisposed()) return;
        Marshal.ReleaseComObject(ComObject);
        ComObjectRef = null;
    }

    ~DisposableComObject()
    {
        Dispose(true);
    }
} 
```

还有一个方便的通用子类，它使使用稍微容易一些。

```
public abstract class DisposableComObject<T> : DisposableComObject
{
    protected new T ComObject => (T)base.ComObject;

    public DisposableComObject(T comObject) : base(comObject) { }
} 
```

最后，我们可以使用`DisposableComObject<T>`为 Excel 互操作类创建包装类。

该`ExcelApplication`子类引用了一个新的 Excel 应用程序实例并用于打开工作簿。

`OpenWorkbook()`返回一个`ExcelWorkbook`也是 DisposableComObject 的子类。

`Dispose()`已被覆盖以在调用基本`Dispose()`方法之前退出 Excel 应用程序。 `Quit()`是 的别名`Dispose()`。

```
public class ExcelApplication : DisposableComObject<Application>
{
    public class OpenWorkbookActionCancelledException : Exception
    {
        public string Filename { get; }

        public OpenWorkbookActionCancelledException(string filename, COMException ex) : base($"The workbook open action was cancelled. {ex.Message}", ex) => Filename = filename;
    }

    /// <summary>The actual Application from Interop.Excel</summary>
    Application App => ComObject;

    public ExcelApplication() : base(new Application()) { }

    /// <summary>Open a workbook.</summary>
    public ExcelWorkbook OpenWorkbook(string filename, bool readOnly = false, string password = null, string writeResPassword = null)
    {
        try
        {
            var workbook = App.Workbooks.Open(Filename: filename, UpdateLinks: (XlUpdateLinks)0, ReadOnly: readOnly, Password: password, WriteResPassword: writeResPassword, );

            return new ExcelWorkbook(workbook);
        }
        catch (COMException ex)
        {
            // If the workbook is already open and the request mode is not read-only, the user will be presented
            // with a prompt from the Excel application asking if the workbook should be opened in read-only mode.
            // This exception is raised when when the user clicks the Cancel button in that prompt.
            throw new OpenWorkbookActionCancelledException(filename, ex);
        }
    }

    /// <summary>Quit the running application.</summary>
    public void Quit() => Dispose(true);

    /// <inheritdoc/>
    protected override void Dispose(bool disposing)
    {
        if (!disposing || IsDisposed()) return;
        App.Quit();
        base.Dispose(disposing);
    }
} 
```

`ExcelWorkbook`也是子类`DisposableComObject<Workbook>`并用于打开工作表。

`Worksheet()`方法返回，你猜对`ExcelWorksheet`了，它也是`DisposableComObject<Workbook>`.

该`Dispose()`方法被覆盖，并在调用 base 之前先关闭工作表`Dispose()`。

注意：我添加了一些用于迭代的扩展方法`Workbook.Worksheets`。如果你得到编译错误，这就是原因。最后添加扩展方法。

```
public class ExcelWorkbook : DisposableComObject<Workbook>
{
    public class WorksheetNotFoundException : Exception
    {
        public WorksheetNotFoundException(string message) : base(message) { }
    }

    /// <summary>The actual Workbook from Interop.Excel</summary>
    Workbook Workbook => ComObject;

    /// <summary>The worksheets within the workbook</summary>
    public IEnumerable<ExcelWorksheet> Worksheets => worksheets ?? (worksheets = Workbook.Worksheets.AsEnumerable<Worksheet>().Select(w => new ExcelWorksheet(w)).ToList());
    private IEnumerable<ExcelWorksheet> worksheets;

    public ExcelWorkbook(Workbook workbook) : base(workbook) { }

    /// <summary>
    /// Get the worksheet matching the <paramref name="sheetName"/>
    /// </summary>
    /// <param name="sheetName">The name of the Worksheet</param>
    public ExcelWorksheet Worksheet(string sheetName) => Worksheet(s => s.Name == sheetName, () => $"Worksheet not found: {sheetName}");

    /// <summary>
    /// Get the worksheet matching the <paramref name="predicate"/>
    /// </summary>
    /// <param name="predicate">A function to test each Worksheet for a macth</param>
    public ExcelWorksheet Worksheet(Func<ExcelWorksheet, bool> predicate, Func<string> errorMessageAction) => Worksheets.FirstOrDefault(predicate) ??  throw new WorksheetNotFoundException(errorMessageAction.Invoke());

    /// <summary>
    /// Returns true of the workbook is read-only
    /// </summary>
    public bool IsReadOnly() => Workbook.ReadOnly;

    /// <summary>
    /// Save changes made to the workbook
    /// </summary>
    public void Save()
    {
        Workbook.Save();
    }

    /// <summary>
    /// Close the workbook and optionally save changes
    /// </summary>
    /// <param name="saveChanges">True is save before close</param>
    public void Close(bool saveChanges)
    {
        if (saveChanges) Save();
        Dispose(true);
    }

    /// <inheritdoc/>
    protected override void Dispose(bool disposing)
    {
        if (!disposing || IsDisposed()) return;
        Workbook.Close();
        base.Dispose(disposing);
    }
} 
```

最后，`ExcelWorksheet`.

`UsedRows()`简单地返回一个可枚举的未包装`Microsoft.Office.Interop.Excel.Range`对象。我还没有遇到过从对象的属性访问的 COM`Microsoft.Office.Interop.Excel.Worksheet`对象需要手动包装的情况，就像使用`Application`、`Workbook`和`Worksheet`. 这些似乎都可以自动清理它们。大多数情况下，我只是迭代 Ranges 并获取或设置值，因此我的特定用例不如可用功能先进。

在这种情况下没有覆盖，`Dispose()`因为不需要对工作表执行特殊操作。

```
public class ExcelWorksheet : DisposableComObject<Worksheet>
{
    /// <summary>The actual Worksheet from Interop.Excel</summary>
    Worksheet Worksheet => ComObject;

    /// <summary>The worksheet name</summary>
    public string Name => Worksheet.Name;

    // <summary>The worksheets cells (Unwrapped COM object)</summary>
    public Range Cells => Worksheet.Cells;

    public ExcelWorksheet(Worksheet worksheet) : base(worksheet) { }

    /// <inheritdoc cref="WorksheetExtensions.UsedRows(Worksheet)"/>
    public IEnumerable<Range> UsedRows() => Worksheet.UsedRows().ToList();
} 
```

可以添加更多的包装类。只需`ExcelWorksheet`根据需要添加其他方法并在包装类中返回 COM 对象。只需复制我们在通过`ExcelApplication.OpenWorkbook()`和包装工作簿时所做的事情`ExcelWorkbook.WorkSheets`。

一些有用的扩展方法：

```
public static class EnumeratorExtensions
{
    /// <summary>
    /// Converts the <paramref name="enumerator"/> to an IEnumerable of type <typeparamref name="T"/>
    /// </summary>
    public static IEnumerable<T> AsEnumerable<T>(this IEnumerable enumerator)
    {
        return enumerator.GetEnumerator().AsEnumerable<T>();
    }

    /// <summary>
    /// Converts the <paramref name="enumerator"/> to an IEnumerable of type <typeparamref name="T"/>
    /// </summary>
    public static IEnumerable<T> AsEnumerable<T>(this IEnumerator enumerator)
    {
        while (enumerator.MoveNext()) yield return (T)enumerator.Current;
    }

    /// <summary>
    /// Converts the <paramref name="enumerator"/> to an IEnumerable of type <typeparamref name="T"/>
    /// </summary>
    public static IEnumerable<T> AsEnumerable<T>(this IEnumerator<T> enumerator)
    {
        while (enumerator.MoveNext()) yield return enumerator.Current;
    }
}

public static class WorksheetExtensions
{
    /// <summary>
    /// Returns the rows within the used range of this <paramref name="worksheet"/>
    /// </summary>
    /// <param name="worksheet">The worksheet</param>
    public static IEnumerable<Range> UsedRows(this Worksheet worksheet) =>
        worksheet.UsedRange.Rows.AsEnumerable<Range>();
} 
```

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2011-06-19T00:16:53.707

Excel 并非旨在通过 C++ 或 C# 进行编程。COM API 专门设计用于与 Visual Basic、VB.NET 和 VBA 一起使用。

此外，此页面上的所有代码示例都不是最佳的，原因很简单，即每个调用必须跨越托管/非托管边界，并进一步忽略 Excel COM API 可以自由地使任何调用失败的事实，并带有一个隐秘的[HRESULT](https://en.wikipedia.org/wiki/HRESULT)指示 RPC 服务器是忙碌的。

在我看来，自动化 Excel 的最佳方法是将您的数据收集到尽可能大/可行的数组中，并将其发送到 VBA 函数或子（通过`Application.Run`），然后执行任何所需的处理。此外 - 调用时`Application.Run`- 一定要注意指示 excel 正忙的异常并重试调用`Application.Run`。

* * *

## 回答 #43

> 赞同：-1
> 
> 时间：2017-02-14T07:55:42.520

这是唯一对我有用的方法

```
 foreach (Process proc in System.Diagnostics.Process.GetProcessesByName("EXCEL"))
        {
            proc.Kill();
        } 
```

# javascript - 您如何找到不会破坏给定文本的最大字体？

> ID：158710
> 
> 赞同：2
> 
> 时间：2008-10-01T17:20:32.497
> 
> 标签：javascript, css, printing

我正在尝试使用 CSS ( **under`@media print`** ) 和 JavaScript 打印一个单页文档，其中给定的文本尽可能大，同时仍然适合给定的宽度。事先不知道文本的长度，因此不能简单地使用固定宽度的字体。

换句话说，我正在寻找适当的调整大小，例如，“IIIIII”会以比“WWWWW”大得多的字体出现，因为“I”在变量中比“W”更瘦-宽度字体。

我能得到的最接近的方法是使用 JavaScript 尝试各种字体大小，直到`clientWidth`足够小。 **这对于屏幕媒体来说效果很好，但是当您切换到打印媒体时**，是否可以保证我的系统上显示的 90 DPI（即，我将边距设置为 0.5in 任一侧，并且对于调整大小的文本如此它正好适合它，我得到大约 675 `clientWidth`）在其他任何地方都一样吗？从像素测量值转换时，浏览器如何决定使用什么 DPI？有什么方法可以使用 JavaScript 访问这些信息？

如果这只是一个 CSS3 功能（`font-size:max-for-width(7.5in)`），我会喜欢它，但如果是，我找不到它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T07:15:49.790

CSS font-size 属性接受[长度单位](http://htmlhelp.com/reference/css/units.html#length)，包括以英寸或厘米为单位的绝对测量值：

> 绝对长度单位高度依赖于输出介质，因此不如相对单位有用。可以使用以下绝对单位：
> 
> *   英寸（英寸；1 英寸=2.54 厘米）
> *   cm（厘米；1cm=10mm）
> *   毫米（毫米）
> *   pt（点；1pt=1/72in）
> *   个人电脑 (picas; 1pc=12pt)

由于您还不知道您的文本有多少个字符，您可能需要结合使用 javascript 和 CSS 才能正确动态地设置 font-size 属性。例如，取字符串的长度（以字符为单位），然后将 8.5（假设您期望使用美国信纸大小的纸张）除以字符数，从而得到以英寸为单位的大小，以便为该块设置 font-size文本。在 Firefox、Safari 和 IE6 中使用绝对测量值测试了字体大小，因此它应该非常便携。希望有帮助。

**编辑**：请注意，您可能还需要使用诸如 letter-spacing 属性之类的设置，并尝试使用您使用的字体，因为 font-size 设置并不是真正的字母宽度，这会有所不同基于字母间距和字体，与长度成正比。哦，使用等宽字体会有所帮助；）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:53:16.113

我不知道如何在 CSS 中做到这一点。我认为你最好的选择是使用 Javascript：

1.  将文本放在 div 中
2.  获取 div 的尺寸
3.  必要时缩小文本
4.  返回第 2 步，直到文本足够小

这是一些[用于检测 div 大小的示例代码](http://www.dynamicdrive.com/forums/archive/index.php/t-7594.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T18:46:39.690

这是我最终使用的一些代码，以防有人发现它有用。您需要做的就是将外部 DIV 设置为您想要的尺寸（以英寸为单位）。

```
function make_big(id) // must be an inline element inside a block-level element
{
    var e = document.getElementById(id);
    e.style.whiteSpace = 'nowrap';
    e.style.textAlign = 'center';
    var max = e.parentNode.scrollWidth - 4; // a little padding
    e.style.fontSize = (max / 4) + 'px'; // make a guess, then we'll use the resulting ratio
    e.style.fontSize = (max / (e.scrollWidth / parseFloat(e.style.fontSize))) + 'px';
    e.style.display = 'block'; // so centering takes effect
} 
```

# arrays - 你如何有效地生成一个介于 0 和上限 N 之间的 K 个非重复整数的列表

> ID：158716
> 
> 赞同：28
> 
> 时间：2008-10-01T17:21:30.637
> 
> 标签：arrays, algorithm, random, permutation

*该问题提供了所有必要的数据：在给定区间[0,N-1]内生成**K*个非重复整数序列的有效算法是什么。*如果K*很大并且足够接近*N*，那么简单的算法（生成随机数并在将它们添加到序列之前查找它们以查看它们是否已经存在）非常昂贵。

 ***[有效地从链表中选择一组随机元素中](https://stackoverflow.com/questions/54059/efficiently-selecting-a-set-of-random-elements-from-a-linked-list)提供的算法似乎比必要的复杂，并且需要一些实现。我刚刚发现另一种算法似乎可以很好地完成这项工作，只要您知道所有相关参数，一次通过。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-09T16:02:12.517

在[*The Art of Computer Programming, Volume 2: Seminumerical Algorithms, Third Edition*](http://en.wikipedia.org/wiki/Special:BookSources/978-0-201-89684-8)中，Knuth 描述了以下选择抽样算法：

> 算法 S（选择采样技术）。从一组 N 中随机选择 n 条记录，其中 0 < n ≤ N。
> 
> S1。[Initialize.] 设置t ← 0, m ← 0。（在这个算法中，m代表到目前为止选择的记录数，t是我们处理过的输入记录的总数。）
> 
> S2。[生成 U.] 生成一个随机数 U，均匀分布在零和一之间。
> 
> S3。[测试] 如果 (N – t)U ≥ n – m，则转到步骤 S5。
> 
> S4。[Select.] 选择样本的下一条记录，将m和t加1。如果m<n，进入步骤S2；否则样本完成，算法终止。
> 
> S5。[Skip.] 跳过下一条记录（不包括在样本中），将t加1，返回步骤S2。

实现可能比描述更容易理解。这是一个从列表中随机选择 n 个成员的 Common Lisp 实现：

```
(defun sample-list (n list &optional (length (length list)) result)
  (cond ((= length 0) result)
        ((< (* length (random 1.0)) n)
         (sample-list (1- n) (cdr list) (1- length)
                      (cons (car list) result)))
        (t (sample-list n (cdr list) (1- length) result)))) 
```

这是一个不使用递归的实现，它适用于各种序列：

```
(defun sample (n sequence)
  (let ((length (length sequence))
        (result (subseq sequence 0 n)))
    (loop
       with m = 0
       for i from 0 and u = (random 1.0)
       do (when (< (* (- length i) u) 
                   (- n m))
            (setf (elt result m) (elt sequence i))
            (incf m))
       until (= m n))
    result)) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-01T17:47:01.573

Python 库中的[random 模块](https://docs.python.org/2/library/random.html#random.sample)使其非常简单有效：

```
from random import sample
print sample(xrange(N), K) 
```

`sample`函数返回从给定序列中选择的 K 个唯一元素的列表。
`xrange`是一个“列表模拟器”，即它的行为就像一个连续数字列表，而不是在内存中创建它，这使得它对于像这样的任务非常快。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-02T09:50:34.970

实际上可以在与所选元素数量成比例的空间中执行此操作，而不是您选择的集合的大小，无论您选择的总集合的比例如何。你可以通过生成一个随机排列来做到这一点，然后像这样从中选择：

选择一个分组密码，例如[TEA](http://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm)或 XTEA。使用[XOR 折叠](http://isthe.com/chongo/tech/comp/fnv/#xor-fold)将块大小减小到比您选择的集合大 2 的最小幂。使用随机种子作为密码的密钥。要在排列中生成元素 n，请使用密码加密 n。如果输出编号不在您的集合中，请对其进行加密。重复直到数字在集合内。平均而言，每个生成的数字必须执行少于两次的加密。这有一个额外的好处，如果你的种子是加密安全的，那么你的整个排列也是如此。

[我在这里](http://blog.notdot.net/archives/37-Damn-Cool-Algorithms,-Part-2-Secure-permutations-with-block-ciphers.html)更详细地写了这个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T17:27:50.043

以下代码（C 语言，来源不明）似乎很好地解决了这个问题：

```
 /* generate N sorted, non-duplicate integers in [0, max[ */
 int *generate(int n, int max) {
    int i, m, a;    
    int *g = (int *)calloc(n, sizeof(int));
    if ( ! g) return 0;

    m = 0;
    for (i=0; i<max; i++) {
        a = random_in_between(0, max - i);
        if (a < n - m) {
            g[m] = i;
            m ++;
        }
    }
    return g;
 } 
```

有谁知道我在哪里可以找到更多像这样的宝石？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T17:29:27.530

`0...N-1`生成一个填充的数组`a[i] = i`。

然后随机播放第一个`K`项目。

洗牌：

*   开始`J = N-1`
*   选择一个随机数`0...J` （例如`R`）
*   交换`a[R]`_`a[J]`
    *   因为`R`可以 等于`J`，所以元素可以与自身交换
*   减去`1`并`J`重复。

最后，取`K`最后一个元素。

这实质上是从列表中选择一个随机元素，将其移出，然后从剩余列表中选择一个随机元素，依此类推。

在*O(K)*和*O(N)*时间内工作，需要*O(N)*存储。

改组部分称为[*Fisher-Yates shuffle*](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle)或*Knuth's shuffle ，在**《计算机编程艺术*》第 2 卷中有描述。

 ** * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T17:25:36.353

通过将 K 个数字存储在散列存储中来加速简单算法。在开始之前知道 K 可以消除插入哈希映射的所有低效率，并且您仍然可以获得快速查找的好处。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T18:17:38.600

我的解决方案是面向 C++ 的，但我确信它可以翻译成其他语言，因为它非常简单。

*   首先，生成一个包含 K 个元素的链表，从 0 到 K
*   然后只要列表不为空，生成一个介于 0 和向量大小之间的随机数
*   获取该元素，将其推入另一个向量，然后将其从原始列表中删除

这个解决方案只涉及两次循环迭代，并且没有哈希表查找或任何类似的东西。所以在实际代码中：

```
// Assume K is the highest number in the list
std::vector<int> sorted_list;
std::vector<int> random_list;

for(int i = 0; i < K; ++i) {
    sorted_list.push_back(i);
}

// Loop to K - 1 elements, as this will cause problems when trying to erase
// the first element
while(!sorted_list.size() > 1) {
    int rand_index = rand() % sorted_list.size();
    random_list.push_back(sorted_list.at(rand_index));
    sorted_list.erase(sorted_list.begin() + rand_index);
}                 

// Finally push back the last remaining element to the random list
// The if() statement here is just a sanity check, in case K == 0
if(!sorted_list.empty()) {
    random_list.push_back(sorted_list.at(0));
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-22T19:06:47.587

第 1 步：生成整数列表。
第 2 步：执行[Knuth Shuffle](http://en.wikipedia.org/wiki/Fisher%2dYates_shuffle)。

请注意，您不需要打乱整个列表，因为 Knuth Shuffle 算法只允许您应用 n 次打乱，其中 n 是要返回的元素数。生成列表仍然需要与列表大小成正比的时间，但您可以重用现有列表以满足任何未来的洗牌需求（假设大小保持不变），而无需在重新启动洗牌算法之前对部分洗牌的列表进行预洗牌。

Knuth Shuffle 的基本算法是从整数列表开始。然后，将第一个整数与列表中的任意数字交换并返回当前（新）第一个整数。然后，将第二个整数与列表中的任何数字（第一个除外）交换并返回当前（新）第二个整数。然后……等等……

这是一个简单得离谱的算法，但在执行交换时要小心在列表中包含当前项目，否则会破坏算法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T18:01:56.703

Reservoir Sampling 版本非常简单：

```
my $N = 20;
my $k;
my @r;

while(<>) {
  if(++$k <= $N) {
    push @r, $_;
  } elsif(rand(1) <= ($N/$k)) {
    $r[rand(@r)] = $_;
  }
}

print @r; 
```

那是从 STDIN 中随机选择的 $N 行。如果您不使用文件中的行，请将 </$_ 替换为其他内容，但这是一个非常简单的算法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-21T18:26:22.500

如果列表是排序的，例如，如果你想从 N 中提取 K 个元素，但你并不关心它们的相对顺序，那么在论文[*An Efficient Algorithm for Sequential Random Sampling*](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.94.1689&rep=rep1&type=pdf)（Jeffrey Scott Vitter，*ACM Transactions on Mathematical Software*，第 13 卷，第 1 期，1987 年 3 月，第 56-67 页。）。

**编辑**以使用 boost 在 c++ 中添加代码。我刚刚输入了它，可能有很多错误。随机数来自 boost 库，带有一个愚蠢的种子，所以不要对此做任何严重的事情。

```
/* Sampling according to [Vitter87].
 * 
 * Bibliography
 * [Vitter 87]
 *   Jeffrey Scott Vitter, 
 *   An Efficient Algorithm for Sequential Random Sampling
 *   ACM Transactions on MAthematical Software, 13 (1), 58 (1987).
 */

#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <string>
#include <iostream>

#include <iomanip>

#include <boost/random/linear_congruential.hpp>
#include <boost/random/variate_generator.hpp>
#include <boost/random/uniform_real.hpp>

using namespace std;

// This is a typedef for a random number generator.
// Try boost::mt19937 or boost::ecuyer1988 instead of boost::minstd_rand
typedef boost::minstd_rand base_generator_type;

    // Define a random number generator and initialize it with a reproducible
    // seed.
    // (The seed is unsigned, otherwise the wrong overload may be selected
    // when using mt19937 as the base_generator_type.)
    base_generator_type generator(0xBB84u);
    //TODO : change the seed above !
    // Defines the suitable uniform ditribution.
    boost::uniform_real<> uni_dist(0,1);
    boost::variate_generator<base_generator_type&, boost::uniform_real<> > uni(generator, uni_dist);

void SequentialSamplesMethodA(int K, int N) 
// Outputs K sorted random integers out of 0..N, taken according to 
// [Vitter87], method A.
    {
    int top=N-K, S, curr=0, currsample=-1;
    double Nreal=N, quot=1., V;

    while (K>=2)
        {
        V=uni();
        S=0;
        quot=top/Nreal;
        while (quot > V)
            {
            S++; top--; Nreal--;
            quot *= top/Nreal;
            }
        currsample+=1+S;
        cout << curr << " : " << currsample << "\n";
        Nreal--; K--;curr++;
        }
    // special case K=1 to avoid overflow
    S=floor(round(Nreal)*uni());
    currsample+=1+S;
    cout << curr << " : " << currsample << "\n";
    }

void SequentialSamplesMethodD(int K, int N)
// Outputs K sorted random integers out of 0..N, taken according to 
// [Vitter87], method D. 
    {
    const int negalphainv=-13; //between -20 and -7 according to [Vitter87]
    //optimized for an implementation in 1987 !!!
    int curr=0, currsample=0;
    int threshold=-negalphainv*K;
    double Kreal=K, Kinv=1./Kreal, Nreal=N;
    double Vprime=exp(log(uni())*Kinv);
    int qu1=N+1-K; double qu1real=qu1;
    double Kmin1inv, X, U, negSreal, y1, y2, top, bottom;
    int S, limit;
    while ((K>1)&&(threshold<N))
        {
        Kmin1inv=1./(Kreal-1.);
        while(1)
            {//Step D2: generate X and U
            while(1)
                {
                X=Nreal*(1-Vprime);
                S=floor(X);
                if (S<qu1) {break;}
                Vprime=exp(log(uni())*Kinv);
                }
            U=uni();
            negSreal=-S;
            //step D3: Accept ?
            y1=exp(log(U*Nreal/qu1real)*Kmin1inv);
            Vprime=y1*(1\. - X/Nreal)*(qu1real/(negSreal+qu1real));
            if (Vprime <=1.) {break;} //Accept ! Test [Vitter87](2.8) is true
            //step D4 Accept ?
            y2=0; top=Nreal-1.;
            if (K-1 > S)
                {bottom=Nreal-Kreal; limit=N-S;}
            else {bottom=Nreal+negSreal-1.; limit=qu1;}
            for(int t=N-1;t>=limit;t--)
                {y2*=top/bottom;top--; bottom--;}
            if (Nreal/(Nreal-X)>=y1*exp(log(y2)*Kmin1inv))
                {//Accept !
                Vprime=exp(log(uni())*Kmin1inv);
                break;
                }
            Vprime=exp(log(uni())*Kmin1inv);
            }
        // Step D5: Select the (S+1)th record
        currsample+=1+S;
        cout << curr << " : " << currsample << "\n";
        curr++;
        N-=S+1; Nreal+=negSreal-1.;
        K-=1; Kreal-=1; Kinv=Kmin1inv;
        qu1-=S; qu1real+=negSreal;
        threshold+=negalphainv;
        }
    if (K>1) {SequentialSamplesMethodA(K, N);}
    else {
        S=floor(N*Vprime);
        currsample+=1+S;
        cout << curr << " : " << currsample << "\n";
        }
    }

int main(void)
    {
    int Ntest=10000000, Ktest=Ntest/100;
    SequentialSamplesMethodD(Ktest,Ntest);
    return 0;
    }

$ time ./sampling|tail 
```

在我的笔记本电脑上给出以下输出

```
99990 : 9998882
99991 : 9998885
99992 : 9999021
99993 : 9999058
99994 : 9999339
99995 : 9999359
99996 : 9999411
99997 : 9999427
99998 : 9999584
99999 : 9999745

real    0m0.075s
user    0m0.060s
sys 0m0.000s 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-04T15:09:38.383

此 Ruby 代码展示了[Reservoir Sampling，算法 R](https://en.wikipedia.org/wiki/Reservoir_sampling)方法。在每个循环中，我`n=5`从范围中选择唯一的随机整数`[0,N=10)`：

```
t=0
m=0
N=10
n=5
s=0
distrib=Array.new(N,0)
for i in 1..500000 do
 t=0
 m=0
 s=0
 while m<n do

  u=rand()
  if (N-t)*u>=n-m then
   t=t+1
  else 
   distrib[s]+=1
   m=m+1
   t=t+1
  end #if
  s=s+1
 end #while
 if (i % 100000)==0 then puts i.to_s + ". cycle..." end
end #for
puts "--------------"
puts distrib 
```

输出：

```
100000\. cycle...
200000\. cycle...
300000\. cycle...
400000\. cycle...
500000\. cycle...
--------------
250272
249924
249628
249894
250193
250202
249647
249606
250600
250034 
```

以几乎相同的概率选择 0-9 之间的所有整数。

它本质上是应用于任意序列的[Knuth 算法（实际上，该答案有一个 LISP 版本）。](https://stackoverflow.com/a/187952/648265)该算法在时间上是*O(N)并且在内存中可能是**O(1)*如果序列被流式传输到其中，如[@MichaelCramer's answer](https://stackoverflow.com/a/158901/648265)所示。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-01T18:16:33.437

这是一种在 O(N) 中无需额外存储的方法。我很确定这不是一个纯粹的随机分布，但它可能足够接近许多用途。

```
/* generate N sorted, non-duplicate integers in [0, max[  in O(N))*/
 int *generate(int n, int max) {
    float step,a,v=0;
    int i;    
    int *g = (int *)calloc(n, sizeof(int));
    if ( ! g) return 0;

    for (i=0; i<n; i++) {
        step = (max-v)/(float)(n-i);
        v+ = floating_pt_random_in_between(0.0, step*2.0);
        if ((int)v == g[i-1]){
          v=(int)v+1;             //avoid collisions
        }
        g[i]=v;
    }
    while (g[i]>max) {
      g[i]=max;                   //fix up overflow
      max=g[i--]-1;
    }
    return g;
 } 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-10-01T17:31:23.047

这是 Perl 代码。Grep 是一个过滤器，而且我一如既往地没有测试这段代码。

```
@list = grep ($_ % I) == 0, (0..N); 
```

*   我 = 间隔
*   N = 上限

仅通过模运算符获取与您的区间匹配的数字。

```
@list = grep ($_ % 3) == 0, (0..30); 
```

将返回 0, 3, 6, ... 30

这是伪 Perl 代码。您可能需要对其进行调整以使其编译。

# .net - 发布了哪些关于 .NET Framework 4.0 的信息？

> ID：158729
> 
> 赞同：2
> 
> 时间：2008-10-01T17:26:42.543
> 
> 标签：.net, .net-4.0

由于 Microsoft 似乎已经开始提供有关 .NET 4.0 的信息，我想我会问这个问题，因为我确信那里的信息比我发现的要多！

发布了哪些关于 .NET Framework 4.0 的信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T15:55:00.630

InfoQ 有一些很好的信息，但没有详细介绍。

*   [类型嵌入](http://www.infoq.com/news/2008/10/Type-Embedding)
*   [C# 中的动态类型](http://www.infoq.com/news/2008/10/CSharp-Dynamic)
*   [C# 中的可选参数](http://www.infoq.com/news/2008/10/CSharp-Optional)
*   [类型协变和逆变](http://www.infoq.com/news/2008/10/CSharp-Variance)

Microsoft 有一个信息页面，用于在[此处](https://connect.microsoft.com/VisualStudio/content/content.aspx?ContentID=9790)下载 Visual Studio 2010 和 .Net 4 CTP 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:27:48.670

[http://news.google.com/news?hl=en&ned=us&q=net+Framework+4.0&btnG=Search+News](http://news.google.com/news?hl=en&ned=us&q=net+Framework+4.0&btnG=Search+News)是一个很好的起点

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T17:28:08.420

它主要是营销“spiel”，但 Steven Martin 的博客上有[一篇](http://blogs.msdn.com/stevemar/archive/2008/10/01/the-road-to-pdc-net-framework-4-0-and-dublin.aspx)文章讨论了 WF/WCF 中的一些新事物。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T17:29:36.733

[ComputerWorld Australia](http://www.computerworld.com.au/index.php/id;1149786074;pp;1)刚刚对 Anders Hejlsberg 进行了一次[精彩的采访](http://www.computerworld.com.au/index.php/id;1149786074;pp;1)，他在采访中谈到了 C# 4.0 中即将发生的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T17:29:37.997

[Channel9 上的这个视频提供了有关下一版 C# 的一些有趣信息。](http://channel9.msdn.com/posts/Charles/C-40-Meet-the-Design-Team/) 显然，其中一些更改必须支持到 CLR 中......

（视频是 Anders etal 在 C# 诞生的房间里谈论 4.0）

# open-source - 您将如何将多站点 ClearCase/ClearQuest 环境迁移到所有开放源代码？

> ID：158737
> 
> 赞同：3
> 
> 时间：2008-10-01T17:28:09.810
> 
> 标签：open-source, version-control, clearcase, migrate, clearquest

我在一个多站点环境中工作，该环境当前使用 Rational ClearCase 进行源代码控制，使用 Rational ClearQuest 进行问题跟踪（我提前接受您的慰问）。作为粗略的估计，我会说这是支持 200 名工程师。

您将如何有效地将这种 SCM 方法迁移到一个可比较的全开源工具套件？这不仅可以节省数十万美元，而且我还相信与当前系统相比，它可以提高开发人员的工作效率并减少停机时间。

使用的平台包括 Windows、Linux、UNIX 和 Solaris。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:49:41.740

首先，您为什么认为这会提高开发人员的生产力？我没怎么用过ClearCase，也没有用过ClearQuest。这些工具阻碍了发展怎么办？

一旦你知道你想要什么，你就需要查看各种工具。作为一般规则，我喜欢 SCM 的 Subversion，但在某些情况下它不太适合。我对特定的版本跟踪系统没有强烈的感觉。

请记住，迁移可能是一个非常大的项目，这取决于您希望从 Rational 系统中带来什么（在 ClearCase 中检查所有内容并在 Subversion 中启动全新的项目将很容易，但是您希望保留任何历史记录更多的工作），因此不会立即节省美元。此外，切换工具会在短时间内（可能非常短）降低开发人员的生产力，因此最好将其视为长期举措。确保预先获得所需的工具，因为您不会经常进行迁移。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:32:58.817

Clearcase 很棒。我曾经像你一样思考，但在转向 perforce 之后，我意识到动态视图是多么棒。

我实际上在[另一个问题中问过这个问题](https://stackoverflow.com/questions/119204/migrate-clearcase-to-perforce)。基本上，如果您可以在没有修订历史的情况下生活，这真的非常非常困难并且变得容易得多。

至于错误跟踪，我的经验是开源错误跟踪工具很糟糕。然而，使用触发器通常很容易将它们与开源控制集成。作为一个例子，这里是如何[集成 bugzilla 和 subversion](http://blog.platinumsolutions.com/node/102)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T20:53:03.323

BasketCase[能让](http://basketcase.rubyforge.org/)你振作起来吗？您也许可以修改或至少抽象您已经拥有的一些环境......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-01T23:16:40.263

我已经使用 Gitcc 完成了从 ClearCase 基础到 Git 的迁移。像魅力一样工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-31T18:14:22.353

对于任何工具，ClearCase 都有[优点和缺点](https://stackoverflow.com/questions/1074580/clearcase-advantages-disadvantages/1074785#1074785)。
我们只将它用于具有复杂合并工作流程的大型项目，其中UCM 对于提前可视化不同的分支 [非常有用。](https://stackoverflow.com/questions/449549/how-to-leverage-clearcases-features)

目前，我们正在评估各种[DVCS 开源解决方案](https://stackoverflow.com/questions/2704996/describe-your-workflow-of-using-version-control-vcs-or-dvcs/2705286#2705286)，但在我看来，它们无法处理所有类型的项目（比如[文件太多](https://stackoverflow.com/questions/984707/what-are-the-git-limits/984973#984973)的项目）。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-24T13:33:03.097

哀悼不是必需的，似乎如果您在多个站点上进行大规模开发，那么您就有合适的工具来完成这项工作。

尝试让开源 SCM 产品在各种站点上运行将是一个非常有趣的挑战 - 我还没有看到可以安全、可靠且无需大量工作的东西（尽管我很想被证明是错误的！）。

尽管您的许可证确实要花很多钱，但您也可以访问 IBM 技术支持（我发现他们经常非常有用）。如果您的开源环境由于某种原因崩溃而您的支持网络由您和您的同事组成，那将花费多少？200 名开发人员无法有效工作？呃。

我很想听听您为什么认为它会提高开发人员的生产力。他们有特定的抱怨吗？他们发现什么是问题？我们可以从这里帮助您与他们一起解决问题吗？

在我看来，开源工具非常适合没有相对复杂性的中小型项目。我觉得你试图做的将是愚蠢的。

# asp.net - ASP.NET 的 MultiView 控件的适当用途是什么？

> ID：158741
> 
> 赞同：11
> 
> 时间：2008-10-01T17:29:27.233
> 
> 标签：asp.net, panel, multiview

在哪些情况下 MultiView 会是一个不错的选择？MultiView 控件及其视图控件似乎只是扩展了面板的概念。

Panels 和 MultiViews 似乎都容易被滥用。如果您的 UI 关注点和业务逻辑关注点被正确分离，为什么要将视图集中在一个 ASPX 中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T17:33:42.183

我使用 MultiViews 作为向导控件的更灵活的基础。

我同意将大量视图混为一谈是一种代码味道。在向导的情况下，您通常希望在整个过程中共享许多状态。多视图允许将此状态简单地存储在视图状态中。

大多数时候，我使每个视图的内容成为一个用户控件，它可以封装与该特定步骤相关的逻辑。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T17:31:50.690

我已经在传递中使用它来实现一个简单的启用 Ajax 的选项卡界面。

将按钮设置为看起来像选项卡，然后将其设置为 onClick 事件以在更新面板中切换活动视图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-29T13:57:36.537

任何您发现自己切换一个或多个面板的显示的情况都是 MultiView 控件的主要候选者。例如，更加模板化的向导控件或主/详细表单。

我同意它们可以被滥用，您应该在使用它们之前评估是否最好将代码分成单独的页面。我曾经参与过一些项目，以前的开发人员试图使用 MultiViews 在单个页面上放太多东西，而且它们简直就是地狱。

MultiViews 需要注意的一件事是，与面板不同，其中包含的任何声明性数据源控件将始终绑定，即使它们包含在其中的视图不是活动/可见的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T17:34:47.047

任何时候您想根据某些条件在页面上显示不同的内容。在工作中，我创建了一个仅使用 MultiView 的选项卡控件和另一个看起来像选项卡的简单控件。每个选项卡都会在另一个控件中放置一个链接（样式化），该控件已连接以将活动视图设置为正确的选项卡。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-29T13:37:58.627

它对于诸如在线表格之类的东西很有用，您可能有一个视图显示实际表格，而另一个视图显示带有“谢谢”文本等的后记。

# javascript - 您可以使用 JavaScript 将多个图像组合成一个图像吗？

> ID：158750
> 
> 赞同：14
> 
> 时间：2008-10-01T17:30:34.983
> 
> 标签：javascript, image-processing, image-manipulation

我想知道是否有一种方法可以仅使用 JavaScript 将多个图像组合成一个图像。这是Canvas能够做到的事情吗？效果可以通过定位来完成，但是您可以将它们组合成一个图像以供下载吗？

**2008 年 10 月 1 日更新：**

感谢您的建议，我正在帮助某人使用 jQuery 在仅 js/css 的网站上工作，他们希望拥有一些类似 MacOS 码头的图像效果，其中多个图像相互叠加。我们提出的解决方案只是绝对定位，并使用`<div>`相对定位的父级效果。组合图像并在单个图像上创建效果会容易得多。

然后它让我想到了像[Picnik](http://www.picnik.com/)这样的在线图像编辑器，并想知道是否可以有一个基于浏览器的图像编辑器，它具有仅用 javascript 编写的 Photoshop 功能。我想这是不可能的，也许在将来？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-04-16T02:54:23.573

我知道这是一个老问题，并且 OP 找到了一个解决方法，但是如果图像和画布已经是 HTML 页面的一部分，这将起作用。

```
<img id="img1" src="imgfile1.png">
<img id="img2" src="imgfile2.png">
<canvas id="canvas"></canvas>

<script type="text/javascript">
var img1 = document.getElementById('img1');
var img2 = document.getElementById('img2');
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');

canvas.width = img1.width;
canvas.height = img1.height;

context.globalAlpha = 1.0;
context.drawImage(img1, 0, 0);
context.globalAlpha = 0.5; //Remove if pngs have alpha
context.drawImage(img2, 0, 0);
</script> 
```

或者，如果您想即时加载图像：

```
<canvas id="canvas"></canvas>
<script type="text/javascript">
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
var img1 = new Image();
var img2 = new Image();

img1.onload = function() {
    canvas.width = img1.width;
    canvas.height = img1.height;
    img2.src = 'imgfile2.png';
};
img2.onload = function() {
    context.globalAlpha = 1.0;
    context.drawImage(img1, 0, 0);
    context.globalAlpha = 0.5; //Remove if pngs have alpha
    context.drawImage(img2, 0, 0);
};        

img1.src = 'imgfile1.png';
</script> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-04-03T14:15:37.990

[MarvinJ](https://www.marvinj.org)提供了**combineByAlpha()**方法，其中使用其 alpha 通道组合多个图像。因此，您只需要将图像采用支持透明度的格式，例如 PNG，并使用该方法，如下所示：

```
Marvin.combineByAlpha(image, imageOver, imageOutput, x, y); 
```

**图1：**

[![在此处输入图像描述](https://i.stack.imgur.com/mOjU8m.jpg)](https://i.stack.imgur.com/mOjU8m.jpg)

**图2：**

[![在此处输入图像描述](https://i.stack.imgur.com/MqM2Jm.png)](https://i.stack.imgur.com/MqM2Jm.png)

**图3：**

[![在此处输入图像描述](https://i.stack.imgur.com/IfkJum.png)](https://i.stack.imgur.com/IfkJum.png)

**结果：**

[![在此处输入图像描述](https://i.stack.imgur.com/nNrEGm.png)](https://i.stack.imgur.com/nNrEGm.png)

**可运行示例：**

```
var canvas = document.getElementById("canvas");
image1 = new MarvinImage();
image1.load("https://i.imgur.com/ChdMiH7.jpg", imageLoaded);
image2 = new MarvinImage();
image2.load("https://i.imgur.com/h3HBUBt.png", imageLoaded);
image3 = new MarvinImage();
image3.load("https://i.imgur.com/UoISVdT.png", imageLoaded);

var loaded=0;

function imageLoaded(){
  if(++loaded == 3){
    var image = new MarvinImage(image1.getWidth(), image1.getHeight());
    Marvin.combineByAlpha(image1, image2, image, 0, 0);
    Marvin.combineByAlpha(image, image3, image, 190, 120);
    image.draw(canvas);
  }
}
```

```
<script src="https://www.marvinj.org/releases/marvinj-0.8.js"></script>
<canvas id="canvas" width="450" height="297"></canvas>
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T17:38:44.060

我认为您不能或不想使用客户端 javascript 执行此操作（“将它们组合成单个图像以供下载”），因为它在客户端上运行：即使您可以将它们组合成单个图像文件客户端，此时您已经下载了所有单独的图像，因此合并毫无意义。

# linq - 将 Linq 与 WCF 一起使用

> ID：158760
> 
> 赞同：5
> 
> 时间：2008-10-01T17:31:43.840
> 
> 标签：linq, wcf, linq-to-sql, linq-to-entities

我正在寻找在 WCF（n 层应用程序）上使用 Linq 的任何示例或指南。请指定您显示的是 Linq-to-SQL 还是 Linq-to-entities。我想看看两者的用法示例。

我想知道诸如延迟执行之类的事情如何在 WCF 上工作（如果它确实有效）？循环引用支持等等...

任何使本文成为将 Linq 与 WCF 结合使用的快速入门指南的信息都会有所帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T17:39:02.793

对于基于 WCF 的通用查询，我不知道有任何 LINQ 提供程序。[但是， LINQ to ADO.NET Data Services](http://blogs.msdn.com/astoriateam/archive/2007/12/11/linq-to-ado-net-data-services.aspx)允许您通过 WCF/REST 查询实体模型。

来自[安迪康拉德的博客](http://blogs.msdn.com/aconrad/archive/2007/12/10/linq-to-rest.aspx)：

```
 static void Main(string[] args)
    {
      var context=new WebDataContext("http://localhost:18752/Northwind.svc");

      var query = from p in context.CreateQuery<Product>("Products")
                  where p.UnitsInStock > 100
                  select p;

      foreach (Product p in query)
      {
        Console.WriteLine(p.ProductName+", UnitsInStock="+p.UnitsInStock);
      }
   } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-15T21:04:46.883

您可以将 Linq to SQL 类添加到 WCF 服务。然后转到 Linq to SQL 类中的数据上下文，并在属性中将序列化模式设置为单向。

您的 Linq to SQL 类中的实体现在可以通过 WCF 服务使用 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T19:23:47.200

ADO.NET 数据服务可能是您最好的选择。有一个 codeplex 项目[interlinq](http://www.codeplex.com/interlinq)能够将任意 LINQ 表达式与 WCF 一起使用，然后可以由另一个 LINQ 提供程序处理，例如 LINQ to NHibernate 或 LINQ to SQL。可悲的是，这个项目似乎并不活跃。

祝你好运。

# c# - 服务启动时处理异常

> ID：158772
> 
> 赞同：17
> 
> 时间：2008-10-01T17:33:35.053
> 
> 标签：c#, .net, windows-services, error-handling

我正在编写一系列 Windows 服务。`OnStart()`如果在启动期间（在方法中）抛出错误，我希望它们失败。我原以为仅仅抛出一个错误`OnStart()`就可以做到这一点，但我发现它改为“启动”并向我显示一条消息，说明“服务已启动，但处于非活动状态。这是正确的吗？” （释义）。如何处理错误，使其实际上无法启动服务？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-08-08T18:22:04.937

如果您想要的主要内容是让服务窗口报告有错误，从我尝试过的（Windows 7 上的 .NET3.5）开始，唯一的方法是设置`ExitCode`. 我建议将其设置为 13816，因为这会导致消息“发生未知错误”。请参阅[Windows 错误代码](http://msdn.microsoft.com/en-us/library/ms681384%28v=vs.85%29 "窗口错误代码")。

下面的示例完成了三件事。

1.  设置 ExitCode 会为最终用户提供有用的消息。它不会影响 Windows 应用程序日志，但会在系统日志中包含一条消息。
2.  调用 Stop 会导致应用程序日志中出现“服务已成功停止”消息。

3.  抛出异常会在应用程序日志中生成一个有用的日志条目。

```
protected override void OnStart(string[] args) {
    try {
        // Start your service
    }catch (Exception ex) {
        // Log exception
        this.ExitCode = 13816;
        this.Stop();
        throw;
    }  
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T17:54:39.997

如果您正在运行 .NET 2.0 或更高版本，则可以使用[ServiceBase.Stop](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.stop)从 OnStart 停止服务。否则从新线程调用 Stop。

~~参考 [devnewsgroups] ( [http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic50404.aspx](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic50404.aspx) )~~

（新闻组走了）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T17:49:56.700

将所有启动逻辑移至单独的方法，并从该单独的方法中引发异常（或调用 OnStop）。

OnStart 在启动时有一些奇怪的地方。我发现如果 OnStart() 中的行数不超过一行，那么我不会收到“服务已启动然后停止。某些服务如果无工作可自动停止”消息，并且抛出的异常将终止处理并记录到应用程序事件日志。

同样使用单独启动方法，您可以使用这样的技术来调试它而无需附加。[http://www.codeproject.com/KB/dotnet/DebugWinServices.aspx](http://www.codeproject.com/KB/dotnet/DebugWinServices.aspx)

# frameworks - 有没有数据仓库框架？

> ID：158775
> 
> 赞同：15
> 
> 时间：2008-10-01T17:34:17.207
> 
> 标签：frameworks, reporting, data-warehouse, anchor-modeling

我有很多需要从中生成报告的 mysql 数据。它主要是历史数据，因此不会发生太大变化，但它的重量很容易达到 20-30 GB，并且预计会增长。我目前有一组 php 脚本，它们将执行一些复杂的查询并输出 csv 和 excel 文件。我还将 phpMyAdmin 与书签查询一起使用。我手动编辑它们以更改参数。数据量在增长，需要访问它的人数也在增长，所以我正在抽出时间来改善这种情况。

前几天我开始阅读有关数据仓库的信息，这似乎与我需要做的事情有关。我读过[一些](http://philip.greenspun.com/wtr/data-warehousing.html) [好](http://www.meansandends.com/mysql-data-warehouse/?link_body/body=%7Bincl:Aggregation%7D) [文章](http://en.wikipedia.org/wiki/Data_warehouse)，甚至在等一本书。我想我已经掌握了这些系统的功能和可能性。

为我的数据创建报告系统一直在待办事项列表上，但直到最近我才认为这将是一个高度利基的编程冒险。由于我现在知道数据仓库是很常见的事情，我认为必须有某种报告/仓库框架可用于简化开发。我很乐意跳过编写界面和脚本来安排和通过电子邮件发送报告等，而是坚持编写查询和建立关系。

我大部分时间都是一个灯人，但我并没有超越切换语言或平台。我只需要一个更强大的解决方案，因为我的一次性脚本不能很好地扩展。

那么从哪里开始呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T19:47:21.957

我将讨论关于{预算、业务效用函数、时间框架}范围的几点。为方便起见，让我们按照您链接到的架构概念化

    [维基百科数据仓库文章](http://en.wikipedia.org/wiki/Data_warehouse#Data_warehouse_architecture "维基百科数据仓库文章")

*   操作数据库层
    数据仓库的源数据 - 规范化，仅在一处进行数据维护

*   数据访问层
    将源数据转换为信息访问层。
    用于提取、转换、加载数据到仓库的 ETL 工具属于这一层。

*   信息访问层
      • 促进报告的数据结构
          *此处不维护数据。它只是您的源数据的反映*
          因此，非规范化结构（包含重复但系统派生的数据）
          通常在这里最有效
      • 报告工具
          您实际上如何允许您的用户访问数据
          • 预制报告（简单）
          •更动态的切片访问方法

        用于报告和分析的数据以及用于报告和分析数据的工具
        属于这一层。Inmon-Kimball 关于设计方法的差异（
        稍后将在 Wikipedia 文章中讨论）与这一层有关。

*   元数据层（促进自动化、组织等）

**自己动手（低端）**
只需很少的自付费用，只需认识到对非规范化结构的需求就可以为那些不使用它的结构购买一些效率

**参与其中**（需要一些支出）
您不需要立即使用平台的所有功能。
然而，IMO，你想在一个你知道会成长的平台上，在竞争激烈和整合的 BI 环境中，这似乎是四大企业超级供应商之一（我认为）

*   微软（我们拥有 110 名员工的公司的平台）
*   树液
*   甲骨文
*   IBM

    [双市场状态文章](http://searchdatamanagement.techtarget.com/news/article/0,289142,sid91_gci1298642,00.html "双市场状态文章")

我的公司正处于这个阶段，使用 SQL Server Integration Services (SSIS) 提供的一些 ETL 功能和一些开源的替代用法，但实际上许可证需要“数据访问层”中的 Talend 产品，这是一种非规范化的报告结构（完全在基本的 SQL Server 数据库中实现）和 SQL Server Reporting Services (SSRS) 可在很大程度上自动化（根据您的技能）预先指定的报告的生成。请注意，SSRS“报告”只是一个（可扩展的）XML 配置/规范，它在运行时通过 SSRS 引擎呈现。导出到 excel 文件等选项是简单的选项。

**认真的承诺**（需要一些重要的人工承诺）
请注意，我们尚未利用 SQL Server Analysis Services 的数据挖掘/动态切片/切片功能。我们正在朝着这个方向努力，但现在专注于提高“数据访问层”中数据清理的质量。

我希望这可以帮助您了解从哪里开始寻找。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T19:43:32.403

[Pentaho](http://www.pentaho.com/)已经整合了一套非常全面的产品。这些产品是“免费的”，但是一旦您提供了您的识别信息，请为通常的大量销售做好准备。

我还没有机会真正伸展它们，因为我们是一家微软商店，从一个悲伤的一端到另一端。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T19:48:18.507

我认为您应该首先查看 Kimball 和 Inmon，看看您是否想以特定方式处理您的数据仓库。尤其是 Kimball，为仓库的建模和构建奠定了非常好的框架。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-20T12:50:38.330

有许多工具试图完成设计、实施和管理/操作数据仓库的过程，它们各有优缺点，而且价格往往相差很大。如果您对 Kimball 和/或 Inmon 营地的仓储原则有很好的了解，那么在幕后您总是会做得最好。

除了 Kalido 和 Wherescape RED 之类的工具（它们以非常不同的方式做类似的事情），许多 ETL 平台现在都对实现的驴式工作（SCD 组件等和沿袭跟踪）提供了良好的内置支持。

最好将所有这些视为在您手中使用的工具，工匠，它们使某些简单的事情变得更容易（甚至是微不足道的），一些困难的事情更容易，但有些事情他们只是在恕我直言；）首先学习方法和原则并充分理解它们，然后您就会知道从您的工具包中应用哪些工具以及何时......

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T19:52:01.010

它已经有一段时间没有更新了，但是有一个不错的 Data Warehousing/ETL Ruby 包，叫做[ActiveWarehouse](http://activewarehouse.rubyforge.org/)。

但我会查看另一个答案中提到的像尼克这样的[Pentaho 产品。](http://www.pentaho.com/products/)它应该可以轻松处理您拥有的大量数据，并且可能为您提供比您想象的更多的数据切片和切块方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-05-08T23:55:46.033

您目前可以获得的最佳框架是[Anchor Modeling](http://www.anchormodeling.com/)。
它可能看起来很复杂，因为它具有通用结构和内置的历史数据功能。
建模技术也与 ERD 完全不同。
但是您最终会使用 sql 代码生成所有 db 对象，包括 3NF 视图和：

*   由触发器处理的插入/更新
*   查询历史中的任何点/范围
*   您的应用程序开发人员不会看到底层的 6NF 锚模型。

该技术是开源的，目前是无与伦比的。

如果你有 AM 问题，你可能想问那个标签[anchor-modeling](/questions/tagged/anchor-modeling "显示标记为“锚定建模”的问题")。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T23:08:41.403

Kimball 是更简单的数据仓库方法。

我们使用 Informatica 来移动数据，但默认情况下它不做 DW 之类的事情，比如索引。
我喜欢 Wherescape RED 的想法，作为 DW 工具并使用 MS SQL 的链接服务器来消除对 ETL 工具的需求。

# java - 我应该从返回 null 还是将“null object”模式应用于返回 Date 的函数？

> ID：158778
> 
> 赞同：2
> 
> 时间：2008-10-01T17:34:54.753
> 
> 标签：java

假设您有一个返回日期的函数：

```
Date myFunc(paramA, paramB){
   //conditionally return a date?
} 
```

`null`从这个函数返回是否合适？这看起来很难看，因为它迫使客户检查`null`.

“空对象”模式是解决这个问题的实现模式。
我不是空对象模式的忠实拥护者，但是是的，总是返回一个列表是有意义的，即使它是空的，而不是返回`null`。
但是，例如在 Java 中，空日期将是已清除且具有 1970 年的日期。

这里最好的实现模式是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T17:40:50.293

空对象模式不适用于您要执行的操作。该模式是关于创建一个在其实现中没有功能的对象，您可以将其传递给要求对象不为空的给定函数。一个例子是Eclipse 中的[NullProgressMonitor](http://download.eclipse.org/eclipse/downloads/documentation/2.0/html/plugins/org.eclipse.platform.doc.isv/reference/api/org/eclipse/core/runtime/NullProgressMonitor.html)，它是[IProgressMonitor](http://download.eclipse.org/eclipse/downloads/documentation/2.0/html/plugins/org.eclipse.platform.doc.isv/reference/api/org/eclipse/core/runtime/IProgressMonitor.html)的一个空实现。

如果您返回一个“空”日期，例如 1970 年，您的客户仍然需要通过查看它是否为 1970 年来检查它是否为“空”。如果他们不这样做，就会发生不当行为。但是，如果您返回 null，他们的代码将很快失败，并且他们会知道他们应该检查 null。此外，1970 年*可能*是一个有效日期。

您应该记录您的方法可能返回 null，仅此而已。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T17:36:45.513

null 是完全可以接受的。但是，如果您想在错误时返回 null，请考虑抛出异常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T17:37:33.080

如果有可能找不到日期，那么 null 是有意义的。否则，你最终会返回一些神奇的日期（比如 1970 年的纪元），这会使人们陷入函数中的挫败感远远超过返回 null 的情况。

记录它可以返回null，但是......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T17:40:45.927

我不喜欢空对象模式。

如果 null 是有效且预期的返回值，则返回它。如果它是由错误条件引起的，那么异常会更有意义。

有时，真正的问题是该方法应该返回一个代表更多信息的更复杂的类型。在这些情况下，很容易陷入陷阱并返回一些基本类型，加上一些特殊的魔法值来表示其他状态。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T18:05:17.427

这种方法的预期结果似乎是一个日期，或者没有找到。未找到的情况通常由返回 null 表示。尽管有些人会使用异​​常来表示这种情况，但我不会（因为这是预期的结果，而且我从来都不是异常处理的粉丝）。

如前所述，Null 对象模式不适合这种情况。事实上，从我自己的经验来看，很多情况下是不合适的。当然，由于一些被严重滥用的经验，我有一些偏见；-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T17:39:58.033

如果它不影响性能，我喜欢有一个明确的查询方法，然后使用异常：

```
if(employee.hasCustomPayday()) {
    //throws a runtime exception if no payday
    Date d = emp.customPayday();
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T17:42:30.680

如果这不是通常应该发生的情况，请使用异常。

否则，（例如，如果这是一个事件的结束日期），则返回 null。

在任何情况下都请避免使用魔法值；）

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-01T17:44:28.553

您可以尝试使用输出参数

```
boolean MyFunction( a,b,Date c)
{
  if (good) 
     c.SetDate(....);
  return good;

} 
```

然后你可以调用它

```
Date theDate = new Date();
if(MyFunction(a, b ,theDate ) 
{
   do stuff with C
} 
```

它仍然需要您检查一些东西，但是在这种情况下没有办法避免一些检查。

尽管 SetDate 已被弃用，而且 Calendar 实现也很丑陋。

Sun 做过的最愚蠢的 API 更改。

# windows - 在 Delphi 表单上递归更新字体

> ID：158780
> 
> 赞同：4
> 
> 时间：2008-10-01T17:35:24.597
> 
> 标签：windows, delphi

我正在尝试迭代表单上的所有控件并启用 ClearType 字体平滑。像这样的东西：

```
procedure TForm4.UpdateControls(AParent: TWinControl);
var
  I: Integer;
  ACtrl: TControl;
  tagLOGFONT: TLogFont;
begin
  for I := 0 to AParent.ControlCount-1 do
  begin
    ACtrl:= AParent.Controls[I];

    // if ParentFont=False, update the font here...

    if ACtrl is TWinControl then
      UpdateControls(Ctrl as TWinControl);
  end;
end; 
```

现在，有没有一种简单的方法来检查是否`ACtrl`有一个`Font`属性，所以我可以将它传递`Font.Handle`给一些人，比如：

```
GetObject(ACtrl.Font.Handle, SizeOf(TLogFont), @tagLOGFONT);
tagLOGFONT.lfQuality := 5;
ACtrl.Font.Handle := CreateFontIndirect(tagLOGFONT); 
```

先感谢您。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T17:46:21.340

您使用 TypInfo 单元，更具体地说是方法 IsPublishedProp 和 GetOrdProp。

在你的情况下，它会是这样的：

```
if IsPublishedProp(ACtrl, 'Font') then
  ModifyFont(TFont(GetOrdProp(ACtrl, 'Font'))) 
```

我的一个库中的一个片段应该让你走上正确的道路：

```
function ContainsNonemptyControl(controlParent: TWinControl;
  const requiredControlNamePrefix: string;
  const ignoreControls: string = ''): boolean;
var
  child   : TControl;
  iControl: integer;
  ignored : TStringList;
  obj     : TObject;
begin
  Result := true;
  if ignoreControls = '' then
    ignored := nil
  else begin
    ignored := TStringList.Create;
    ignored.Text := ignoreControls;
  end;
  try
    for iControl := 0 to controlParent.ControlCount-1 do begin
      child := controlParent.Controls[iControl];
      if (requiredControlNamePrefix = '') or
         SameText(requiredControlNamePrefix, Copy(child.Name, 1,
           Length(requiredControlNamePrefix))) then
      if (not assigned(ignored)) or (ignored.IndexOf(child.Name) < 0) then
      if IsPublishedProp(child, 'Text') and (GetStrProp(child, 'Text') <> '') then
        Exit
      else if IsPublishedProp(child, 'Lines') then begin
        obj := TObject(cardinal(GetOrdProp(child, 'Lines')));
        if (obj is TStrings) and (Unwrap(TStrings(obj).Text, child) <> '') then
          Exit;
      end;
    end; //for iControl
  finally FreeAndNil(ignored); end;
  Result := false;
end; { ContainsNonemptyControl } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T09:35:18.270

无需为此使用 RTTI。每个 TControl 后代都有一个 Font 属性。在 TControl 级别，它的可见性受到保护，但您可以使用此解决方法来访问它：

```
type
  THackControl = class(TControl);

ModifyFont(THackControl(AParent.Controls[I]).Font); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T09:42:47.007

还有一件事值得一提。每个控件都有一个 ParentFont 属性，如果设置了该属性，则允许 Form 的字体选择向下波及每个控件。我倾向于确保尽可能将 ParentFont 设置为 true，这也使得根据当前操作系统为表单设置主题变得更加容易。

无论如何，您肯定不需要做任何事情来启用 ClearType 平滑吗？如果您使用 TrueType 字体并且用户启用了 Cleartype“效果”，它应该会自动发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-17T19:01:48.413

[这是TOndrej 的答案](https://stackoverflow.com/a/320155/782738)的 C++Builder 示例：

```
struct THackControl : TControl
{
    __fastcall virtual THackControl(Classes::TComponent* AOwner);
    TFont* Font() { return TControl::Font; };
};

for(int ControlIdx = 0; ControlIdx < ControlCount; ++ControlIdx)
{
    ((THackControl*)Controls[ControlIdx])->Font()->Color = clRed;
} 
```

# .net - 有没有办法覆盖 ConfigurationManager.AppSettings？

> ID：158783
> 
> 赞同：22
> 
> 时间：2008-10-01T17:36:05.500
> 
> 标签：.net, configuration, app-config

我真的希望能够有一种方法来获取当前使用**ConfigurationManager.AppSettings["mysettingkey"]**获取其设置的应用程序，以使这些设置实际上来自集中式数据库而不是 app.config 文件。我可以制作一个自定义配置部分来处理这类事情，但我真的不希望我团队中的其他开发人员不得不更改他们的代码来使用我的新 DbConfiguration 自定义部分。我只是希望他们能够以他们一直使用的方式调用 AppSettings，但可以从中央数据库加载它。

有任何想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-02T00:04:25.643

如果您不介意围绕框架进行黑客攻击，并且可以合理地假设应用程序正在运行的 .net 框架版本（即它是 Web 应用程序或 Intranet 应用程序），那么您可以尝试这样的事情：

```
using System;
using System.Collections.Specialized;
using System.Configuration;
using System.Configuration.Internal;
using System.Reflection;

static class ConfigOverrideTest
{
  sealed class ConfigProxy:IInternalConfigSystem
  {
    readonly IInternalConfigSystem baseconf;

    public ConfigProxy(IInternalConfigSystem baseconf)
    {
      this.baseconf = baseconf;
    }

    object appsettings;
    public object GetSection(string configKey)
    {
      if(configKey == "appSettings" && this.appsettings != null) return this.appsettings;
      object o = baseconf.GetSection(configKey);
      if(configKey == "appSettings" && o is NameValueCollection)
      {
        // create a new collection because the underlying collection is read-only
        var cfg = new NameValueCollection((NameValueCollection)o);
        // add or replace your settings
        cfg["test"] = "Hello world";
        o = this.appsettings = cfg;
      }
      return o;
    }

    public void RefreshConfig(string sectionName)
    {
      if(sectionName == "appSettings") appsettings = null;
      baseconf.RefreshConfig(sectionName);
    }

    public bool SupportsUserConfig
    {
      get { return baseconf.SupportsUserConfig; }
    }
  }

  static void Main()
  {
    // initialize the ConfigurationManager
    object o = ConfigurationManager.AppSettings;
    // hack your proxy IInternalConfigSystem into the ConfigurationManager
    FieldInfo s_configSystem = typeof(ConfigurationManager).GetField("s_configSystem", BindingFlags.Static | BindingFlags.NonPublic);
    s_configSystem.SetValue(null, new ConfigProxy((IInternalConfigSystem)s_configSystem.GetValue(null)));
    // test it
    Console.WriteLine(ConfigurationManager.AppSettings["test"] == "Hello world" ? "Success!" : "Failure!");
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:28:00.843

无论您做什么，都需要添加一层重定向？ConfigurationManager.AppSettings["key"] 将始终查看配置文件。您可以创建 ConfigurationFromDatabaseManager 但这将导致使用不同的调用语法：

```
ConfigurationFromDatabaseManager.AppSettings["key"] instead of ConfigurationSettings["key"]. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T17:41:55.237

我不确定您是否可以覆盖它，但您可以尝试 AppSettings 的 Add 方法在应用程序启动时添加您的数据库设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-12T12:34:05.770

我会尝试编写一个应用程序启动器并将设置从数据库加载到应用程序域。所以应用程序不知道它的配置是如何生成的。使用 machiene.config 直接进入 dll-hell 2.0。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-22T15:28:59.437

如果您可以将修改后的配置文件保存到磁盘 - 您可以在不同的应用程序域中加载替代配置文件：

```
AppDomain.CreateDomain("second", null, new AppDomainSetup
{
    ConfigurationFile = options.ConfigPath,
}).DoCallBack(...); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-02T00:01:20.393

似乎有一种方法可以在 .NET 3.5 中通过在 machine.config 的 appSettings 定义部分中设置 allowOverride 属性来执行此操作。这允许您覆盖您自己的 app.config 文件中的整个部分并指定一个新类型来处理它。

# c# - 从 APSX 页面上的响应中获取 NTLM 凭据

> ID：158800
> 
> 赞同：1
> 
> 时间：2008-10-01T17:39:22.980
> 
> 标签：c#, asp.net, credentials

我有一个使用 NTLM 凭据调用的 ASPX 页面（在服务器 A 上）。该页面的部分工作是调用 HTML 页面（在服务器 B 上）并将其代理回客户端。（防火墙允许访问 A，但不允许访问 B。通常允许用户访问两个服务器。）。服务器 B 也不对匿名访问开放，所以我需要向它提供凭据。

如果我硬编码一些凭据（根据附加的代码），它可以工作，但理想情况下我会回显 .aspx 页面收到的凭据。有什么方法可以获取这些 NetworkCredentials，以便我可以传递它们吗？

```
protected void Page_Load(object sender, EventArgs e) { 
    Response.Clear(); 
    WebClient proxyFile = new WebClient(); 
    CredentialCache cc = new CredentialCache(); 
    cc.Add(new Uri("http://serverB/"), "NTLM", 
        new NetworkCredential("userName", "password", "domain")); 
    proxyFile.Credentials = cc; 

    Stream proxyStream = proxyFile.OpenRead("http://serverB/Content/webPage.html"); 
    int i; 
    do { 
        i = proxyStream.ReadByte(); 
        if (i != -1) { 
            Response.OutputStream.WriteByte((byte)i); 
        } 
    } while (i != -1); 
    Response.End(); 
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T19:11:50.730

您当然可以获取调用者的登录名，但不能获取密码。NTLM 使用质询/响应机制，因此永远不会传输密码。您的服务器必须有权访问密码等效项（哈希）才能形成质询并检查响应，但即使您可以掌握它，该密码等效项对您尝试形成的凭据也没有用处将被服务器 B 接受。

如果您可以设置模拟，如另一个答案中所述，即使这样也不一定能得到您想要的。默认情况下，不允许模拟服务器进程将其身份传输到另一台服务器。第二个跃点称为委托，需要在所涉及的服务器上（和/或在 Active Directory 中）显式配置。

Apart from delegation I think your only option is to maintain a database of credentials that server A can access and present to server B. Building that in a secure manner is a subtle and time-consuming process. On the other hand, there is a reason why delegation is disabled by default. When I log into a server, do I want it to be allowed to use my identity for accessing other servers? Delegation is the simplest option for you, but you'll need to be sure that server A can't be compromised to do irresponsible things with your users' identities.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:26:06.410

Page.User 将为您获取运行该页面的用户的安全主体。

从那里你应该能够弄清楚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T18:32:59.030

你能在你的场景中冒充呼叫者的身份吗？这样你甚至不需要传递凭据，例如：

```
<authentication mode="Windows" />
<identity impersonate="true" /> 
```

在服务器 A 的 web.config 中。但这当然取决于您的情况，因为您可能不希望服务器 A 那样。但是如果可以的话，这可以在没有自定义代码的情况下解决您的问题。

下面是设置模拟的链接：http: [//msdn.microsoft.com/en-us/library/ms998351.aspx#paght000023_impersonatingorigcaller](http://msdn.microsoft.com/en-us/library/ms998351.aspx#paght000023_impersonatingorigcaller)

# .net-3.5 - 将应用程序池的 .NET Framework 版本更改为 3.5？

> ID：158804
> 
> 赞同：11
> 
> 时间：2008-10-01T17:40:00.607
> 
> 标签：.net-3.5, iis-7, application-pool

我已经在 Web 服务器（Server 2008 Enterprise）上安装了 .NET Framework 3.5 SP1，因此运行 IIS 7.0。

我想更改现有站点使用的 .NET Framework 版本。所以我右键单击适当的应用程序池并选择编辑应用程序池。.NET Framework 下拉列表不包含框架 3.5 的显式条目，而仅包含 2.0.50727。

这仅仅是因为3.5中的核心RTL版本还是2.0吗？还是我需要做一些额外的事情才能让 IIS 看到 3.5 版？（确实尝试重新启动 IIS）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-01T17:43:38.633

3.5 框架仍然在 2.0 CLR 之上运行，因此您所看到的是正确的。

Scott Hanselman 有一篇关于此细节的精彩[博客文章：](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)

> 营销术语“.NET Framework 3.5”指的是一些东西。首先是 LINQ，它非常庞大，包括用于 C# 和 VB 的新语言编译器。其次，REST 支持添加到 Windows Communication Foundation，以及第三，包括 ASP.NET AJAX 的事实，而不是像以前在 ASP.NET 2.0 中那样单独下载。.NET 3.5 中还有一些其他内容，例如 .NET 2.0 的 SP1 来修复错误，但了解 .NET 3.5 中添加的内容的一种方法是查看 .NET 3.5 中添加的内容`c:\windows\assembly`。

[![.NET Framework 3.5、3.0 SP1、2.0 SP1：CLR、WinForms、ASP.NET、LINQ、REST、AJAX、WPF、WCF、WF、卡空间](https://i.stack.imgur.com/4Nzgl.png)](https://i.stack.imgur.com/4Nzgl.png)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T17:41:43.007

> 这仅仅是因为3.5中的核心RTL版本还是2.0吗？

是的

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T17:42:19.650

有问题的下拉列表使用加载到应用程序池进程空间中的 CLR 版本，该版本必须是唯一的（您不能将 1.1 CLR 加载到已加载 2.0 CLR 的进程中，反之亦然）。

但是，.NET 3.5 使用 v2.0 CLR - 唯一添加的是新版本的库和一些围绕 VB.NET 和 C# 中的新功能的编译器支持。如果您选择 3.5，只要您的程序集引用 3.5 版本的程序集，您就会使用 3.5。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T17:41:45.753

除了正确配置 web.config 之外，您无需再做任何事情

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T17:43:54.500

我们刚刚在我们的服务器（Windows Server 2003 /IIS6）上安装了 3.5 框架，重新启动，就是这样。

当然，您必须针对框架的 3.5 版本开发应用程序，但这与从 1.1 到 2.0 的更改不同，您需要使用 IIS 管理器更改网站属性中的 .Net 设置。

# javascript - jEditable 输入框 CSS 样式

> ID：158806
> 
> 赞同：7
> 
> 时间：2008-10-01T17:40:39.280
> 
> 标签：javascript, jquery, css

我正在尝试设置使用[jEditable](http://www.appelsiini.net/projects/jeditable)呈现的输入框的样式。

我想在双击文本并使其可编辑时更改表格单元格的颜色。像这样：

[替代文字 http://www.hongaijitsu.com/temp/foobar/public/Picture-2.png](http://www.hongaijitsu.com/temp/foobar/public/Picture-2.png)

这就是我现在所处的位置：[jEditable CSS Problem](http://www.hongaijitsu.com/temp/foobar/public/dashboard.html)（双击表格单元格中的文本）

HTML 片段：

```
<tr class="odd">
    <td class="dblclick" headers="customer-name">Drogo Shankara</td>
    <td class="dblclick" headers="mail">dshan@gmail.com</td>
    <td class="dblclick" headers="type">Web</td>
    <td class="dblclick" headers="status">Pending mail</td>
</tr> 
```

jQuery代码：

```
$(function() {

$(".dblclick").editable("#", { 
    tooltip   : "Doubleclick to edit...",
    event     : "dblclick",
    css : 'inherit'
    });
}); 
```

对应的CSS：

```
.dblclick form {
    height: inherit !important;
    width: inherit !important;
    border: 0;  
    margin: 0;
    padding: 0;
    background: red;
    }

.dblclick input {
    height: inherit !important;
    width: inherit !important;
    border: 0;  
    margin: 0;
    padding: 0;
    font: inherit;
    color: inherit;
    } 
```

我希望输入框从父表格单元格继承高度和宽度，但是当我查看 Firebug 中的输入框时，它已经设置了内联 CSS 高度和宽度，导致表格单元格在`td`文本被按下。我尝试用 覆盖内联 CSS `inherit !important`，但它不起作用。

这里有一些我还没有完全理解的概念，但它可能是完全平庸的东西。

有什么想法有什么问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T20:01:03.110

jQuery/JavaScript 正在操作 DOM 并在每次双击时动态添加/设置输入字段的宽度。由于内联样式（这里是在 DOM 中动态生成的）优先于所有其他样式，因此您不能使用附加类中的新属性更改动态呈现的内联样式。如果您想摆脱奇怪的跳跃效果，请删除 screen.css 文件中设置整个表格宽度的属性：

表{边框折叠：折叠；/*宽度：940px；...删除*/ }

似乎在计算宽度以将输入字段设置为使用固定表格宽度时代码会混淆（或者那里可能存在“冲突”的 css）。当我从表格中删除宽度时，该功能可以正常工作并且看起来还可以。

希望这会有所帮助，如果没有，请告诉我...

# database - 成本与一致的获取

> ID：158814
> 
> 赞同：4
> 
> 时间：2008-10-01T17:42:01.413
> 
> 标签：database, sql-execution-plan

在解释计划中看到具有低成本但在自动跟踪中获得高一致性的查询意味着什么？在这种情况下，成本是 100 美元，而 CR 是数百万美元。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T18:29:40.660

充其量，成本是优化器对查询将执行的 I/O 数量的估计。因此，充其量，只有在优化器找到了一个非常好的计划时，成本才可能是准确的——如果优化器对成本的估计是正确的并且计划是理想的，那通常意味着你永远不会去打扰查看计划，因为该查询将执行得相当好。

然而，一致获取是查询实际执行的获取数量的实际度量。所以这是一个更准确的基准。

尽管有很多很多因素会影响成本，还有一些因素会影响一致获取的数量，但如果您的成本非常低且一致获取的数量非常多，那么可以合理地预期优化器可能对各个步骤的基数估计不佳（PLAN_TABLE 中的 ROWS 列告诉您每个步骤中返回的预期行数）。这可能表明您缺少或过时的统计数据，您缺少一些直方图，您的初始化参数或系统统计数据在某种程度上是错误的，或者 CBO 由于某些其他原因在估计您的结果的基数时出现问题。

您使用的是什么版本的 Oracle？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T18:47:21.990

根据版本以及您是否在基于 cpu 的成本计算模式下运行，成本可以代表两种不同的东西。

简而言之，成本表示优化器期望查询执行的时间量，但它以单个块读取所花费的时间量为单位表示。例如，如果 Oracle 预计单个块读取需要 1 毫秒，而查询需要 20 毫秒，那么成本等于 20。

一致性获取与此不完全匹配的原因有很多：成本包括非一致性（当前）获取（例如读取和写入临时数据），成本包括 CPU 时间，并且一致性获取可以是多块读取而不是单个块读取，因此具有不同的持续时间。Oracle 还可能会完全错误地估算成本，并且最终可能需要比建议的估算更多或更少的一致获取。

一种可以解释预测执行计划与实际性能之间脱节的有用方法是“基数反馈”。请参阅此演示文稿：[http ://www.centrexcc.com/Tuning%20by%20Cardinality%20Feedback.ppt.pdf](http://www.centrexcc.com/Tuning%20by%20Cardinality%20Feedback.ppt.pdf)

# deployment - 将 Web 应用程序从 localhost 迁移到托管平台有多难？

> ID：158816
> 
> 赞同：0
> 
> 时间：2008-10-01T17:42:20.197
> 
> 标签：deployment

由于我不是当前管理我拥有的资源和知识的任何解决方案的超级粉丝，因此我正在考虑制作我自己的解决方案，这将涉及自定义代码以及可能集成 FOSS 解决方案。我会在我的本地机器上开始开发，但如果我喜欢它，迁移到公共服务器并让其他人也使用这个工具会有多困难？我可能会面临什么样的挑战？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T17:45:20.923

从理论上讲，除了将东西移到新机器上的过程之外，什么都没有。您可以在自己的端口（例如端口 80）上设置自己的服务器。

您甚至可以在家中创建自己的假域，只需调整 /etc/hosts 文件（或 Windows 上的等效文件）。

现在，如果你在 Windows 上开发并在 unix 上托管，你会遇到平台问题，所以我建议不要这样做，至少对于第一个项目。

但除此之外，它应该是直截了当的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T20:47:55.150

您没有硬编码“localhost”的任何路径，对吗？如果是这样，那应该是首先要剥离的东西。要么使用相对路径，要么使用某种可配置的**{AppPath}**变量，您只需要更改一次。

顺便说一句，您使用的是什么语言/框架？它将帮助我们提供示例代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:21:46.877

我要补充一点，如果要迅速被公众接受，文档在任何项目中都是一个非常重要的因素。在开发内部项目时，特别是如果它们只是供您个人使用时，往往会忽略甚至完全忽略各种使用文档以及代码中的文档。如果用户没有被告知如何使用该产品，他们就不会使用它，如果其他潜在的开发人员不知道事情是如何或为什么以他们现在的方式完成的，或者事情的目的是什么，他们要么不会麻烦尝试一下，否则会无意中引起其他问题。

# .net - 使用 .net 创建 JSON

> ID：158818
> 
> 赞同：15
> 
> 时间：2008-10-01T17:42:33.427
> 
> 标签：.net, asp.net, json

首先，让我开始说我不是 .net 开发人员。我问这个问题的原因是我们推出了 REST-API，我们的第一个集成合作伙伴之一是 .net 商店。

所以基本上我们假设 .net 会提供某种包装器来创建 JSON，但是有问题的开发人员手动创建了*字符串*。我对这个主题进行了一些研究，但我真的找不到任何东西，尽管我相信 .net 提供了一些东西。:)

```
'current code    
Dim data As String
data = "[hello, world]" 
```

在 PHP 中，我会执行以下操作（假设 ext/json 可用；）：

```
<?php
$json = array('hello', 'world');
$json = json_encode($json); 
```

我也对您使用什么将 json 解码为数组/对象结构感兴趣。

非常感谢帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T17:45:38.113

有几个第一方和第三方选项。[Rick Strahl](http://www.west-wind.com/weblog/posts/442969.aspx)有一个很好的概述。[JSON.net](http://james.newtonking.com/pages/json-net.aspx)是最流行的第三方选项。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-01T17:45:40.157

请参阅[.Net AJAX 中是否有内置方法可以将对象手动序列化为 JSON 字符串？](https://stackoverflow.com/questions/35106/is-there-a-built-in-way-in-net-ajax-to-manually-serialize-an-object-to-a-json-s)

也就是说，在 .NET 2.0 中，

```
Dim yourData As String() = { "Hello", "World" }
Dim jsonSerialiser As New System.Web.Script.Serialization.JavaScriptSerializer
Dim jsonString as String = jsonSerialiser.Serialize(yourData) 
```

在 .NET 3.5 中，将它们发送到上面提到的 Rick Strahl 的博客

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T17:46:29.780

[Json.Net](http://james.newtonking.com/pages/json-net.aspx)是一个易于使用的库，具有一些很酷的特性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-14T19:31:36.587

[JavaScriptSerializer](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)非常简单。

```
Person person = new Person();

JavaScriptSerializer serializer = new JavaScriptSerializer();
String json = serializer.Serialize(person); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T15:10:08.020

我和韦恩在一起——JSON.net 运行良好。好的是，它运行良好，没有学习曲线。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:08:51.473

查看[DataContractJsonSerializer](http://msdn.microsoft.com/en-us/library/bb410770.aspx)。

# .net - 托管 C++ 程序集属性

> ID：158821
> 
> 赞同：8
> 
> 时间：2008-10-01T17:42:48.683
> 
> 标签：.net, attributes, managed-c++

有没有办法将程序集属性添加到托管 C++ 程序集？在典型的 C# 项目中，文件中通常有一行代码，`AssemblyInfo.cs`如下所示：

`[assembly: AssemblyTitle("Some Assembly")]`

我有一个要添加的私有程序集属性（不是可以通过资源文件添加的版本属性之一），我不确定这是否可行。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-01T17:46:50.920

这是可能的 - 简单的方法是添加一个 AssemblyInfo.cpp 文件并放入：

```
#include attributes.h //your attribute decl
[assembly: MyCustomAttribute()]; 
```

不过，它可以在您想要的任何文件中。

*编辑*- 为程序集属性添加了必需的分号

# c++ - 地图中的随机元素

> ID：158836
> 
> 赞同：45
> 
> 时间：2008-10-01T17:45:22.343
> 
> 标签：c++, random, map

从地图中选择随机元素的好方法是什么？C++。据我了解，地图没有随机访问迭代器。关键是很长很长，地图人口稀少。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-01T17:51:11.830

```
map<...> MyMap;
iterator item = MyMap.begin();
std::advance( item, random_0_to_n(MyMap.size()) ); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-01T18:10:33.937

如果地图很小或者您不经常需要随机值，我喜欢 James 的回答。如果它很大并且您经常这样做以使速度变得重要，那么您可能可以保留一个单独的键值向量以从中选择一个随机值。

```
map<...> MyMap;
vector<...> MyVecOfKeys; // <-- add keys to this when added to the map.

map<...>::key_type key = MyVecOfKeys[ random_0_to_n(MyVecOfKeys.size()) ];
map<...>::data_type value = MyMap[ key ]; 
```

当然，如果地图真的很大，您可能无法像这样存储所有键的副本。如果您能负担得起，尽管您可以在对数时间内获得查找的优势。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-01T18:55:03.593

可能会绘制一个随机密钥，然后使用[lower_bound](http://www.cplusplus.com/reference/stl/map/lower_bound.html)找到实际包含的最接近的密钥。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-03T23:11:20.173

继续 ryan_s 预构建地图和快速随机查找的主题：我们可以使用迭代器的并行地图代替向量，这应该会加快随机查找速度。

```
map<K, V> const original;
...

// construct index-keyed lookup map   
map<unsigned, map<K, V>::const_iterator> fast_random_lookup;
map<K, V>::const_iterator it = original.begin(), itEnd = original.end();
for (unsigned i = 0; it != itEnd; ++it, ++i) {
  fast_random_lookup[i] = it;
}

// lookup random value
V v = *fast_random_lookup[random_0_to_n(original.size())]; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-04T00:17:34.767

如果您的地图是静态的，则使用向量以键顺序存储您的键/值对，使用二进制搜索以在 log(n) 时间内查找值，并使用向量索引以在恒定时间内获取随机对，而不是使用地图. 您可以将矢量/二进制搜索包装起来，使其看起来像具有随机访问功能的地图。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T18:28:42.520

也许您应该考虑[Boost.MultiIndex](http://www.boost.org/doc/libs/1_36_0/libs/multi_index/doc/index.html)，尽管请注意它的权重有点过重。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T18:39:21.907

这是必须以随机顺序访问*所有*地图项的情况。

1.  将地图复制到矢量。
2.  洗牌向量。

在伪代码中（它密切反映了以下 C++ 实现）：

```
import random
import time

# populate map by some stuff for testing
m = dict((i*i, i) for i in range(3))
# copy map to vector
v = m.items()
# seed PRNG   
#   NOTE: this part is present only to reflect C++
r = random.Random(time.clock()) 
# shuffle vector      
random.shuffle(v, r.random)
# print randomized map elements
for e in v:
    print "%s:%s" % e, 
print 
```

在 C++ 中：

```
#include <algorithm>
#include <iostream>
#include <map>
#include <vector>

#include <boost/date_time/posix_time/posix_time_types.hpp>
#include <boost/foreach.hpp>
#include <boost/random.hpp>

int main()
{
  using namespace std;
  using namespace boost;
  using namespace boost::posix_time;

  // populate map by some stuff for testing
  typedef map<long long, int> Map;
  Map m;
  for (int i = 0; i < 3; ++i)
    m[i * i] = i;

  // copy map to vector
#ifndef OPERATE_ON_KEY
  typedef vector<pair<Map::key_type, Map::mapped_type> > Vector;
  Vector v(m.begin(), m.end());
#else
  typedef vector<Map::key_type> Vector;
  Vector v;
  v.reserve(m.size());
  BOOST_FOREACH( Map::value_type p, m )
    v.push_back(p.first);
#endif // OPERATE_ON_KEY

  // make PRNG
  ptime now(microsec_clock::local_time());
  ptime midnight(now.date());
  time_duration td = now - midnight;
  mt19937 gen(td.ticks()); // seed the generator with raw number of ticks
  random_number_generator<mt19937, 
    Vector::iterator::difference_type> rng(gen);

  // shuffle vector
  //   rng(n) must return a uniformly distributed integer in the range [0, n)
  random_shuffle(v.begin(), v.end(), rng);

  // print randomized map elements
  BOOST_FOREACH( Vector::value_type e, v )
#ifndef OPERATE_ON_KEY
    cout << e.first << ":" << e.second << " ";
#else
    cout << e << " ";
#endif // OPERATE_ON_KEY
  cout << endl;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-02T14:46:20.437

有没有人试过这个？ [https://github.com/mabdelazim/Random-Access-Map](https://github.com/mabdelazim/Random-Access-Map) "用于随机访问映射的 C++ 模板类。这类似于 std::map 但您可以使用语法 my_map.key(i) 和 my_map 通过索引随机访问项目.data(i)"

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-09-01T00:48:46.270

```
std::random_device dev;
std::mt19937_64 rng(dev());

std::uniform_int_distribution<size_t> idDist(0, elements.size() - 1);
auto elementId= elements.begin();
std::advance(elementId, idDist(rng)); 
```

现在 elementId 是随机的 :)

# apache - mod_rewrite 用于尾随斜杠问题

> ID：158848
> 
> 赞同：10
> 
> 时间：2008-10-01T17:47:08.780
> 
> 标签：apache, mod-rewrite

我正在把头发拉出来解决应该是一个非常简单的问题。我们通过 F5 BigIP 运行 WebSphere IHS (Apache)。BigIP 正在为我们进行 https 翻译。我们的网址（已更改为网络，无效）是[https://superniftyserver.com/lawson/portal](https://superniftyserver.com/lawson/portal)。

当有人在门户后没有斜杠输入时，Apache 假定“门户”是一个文件而不是一个目录。当 Apache 发现它是什么时，它会发送 301 永久重定向。但由于 Apache 只知道 http，它会将 URL 作为[http://superniftyserver.com/lawson/portal/](http://superniftyserver.com/lawson/portal/)发送，这会产生问题。

所以我为 mod_rewrite 尝试了服务器级别的 httpd.conf 更改，这是我尝试过的几十种组合之一。

RewriteRule 上的 RewriteEngine ^/lawson/portal(.*) /lawson/portal/$1

我也试过 RewriteRule ^/lawson/portal$ /lawson/portal/

在许多其他事情中......我错过了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T18:02:30.197

如果您无法获得有关 RewriteRule 语法的答案，这里有两个其他选项供您选择： 在 BigIp 上编写一个自定义 iRule（请参阅[F5 DevCentral](http://devcentral.f5.com/)），查找 301 响应并将它们转换为 SSL；让 URL 传递到您的 WebSphere 服务器并执行发送 HTTPS 的编程重定向。但是，由于 F5 终止 SSL 连接，您必须设置您配置的自定义标头（请参阅[PQ86347](http://www-01.ibm.com/support/docview.wss?rs=180&uid=swg1PQ86347)），以便 Java request.getScheme() 可以按预期工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T20:13:06.683

固定的！

SOL6912：配置 HTTP 配置文件以重写 URL，以便来自 HTTP 服务器的重定向指定 HTTPS 协议

* * *

更新时间：2007 年 8 月 7 日上午 12:00

ClientSSL 虚拟服务器通常配置为接受来自客户端的 HTTPS 连接、解密 SSL 会话并将未加密的 HTTP 请求发送到 Web 服务器。

当请求的 URI 不包含尾部斜杠（URI 末尾的正斜杠，例如 /）时，某些 Web 服务器会生成礼貌重定向。如果没有尾部斜杠，Web 服务器将首先将 URI 中指定的资源视为文件。如果找不到该文件，则 Web 服务器可能会搜索具有相同名称的目录，如果找到，则将带有尾部斜杠的 HTTP 302 重定向响应发送回客户端。重定向将以 HTTP 模式而不是 HTTPS 模式返回给客户端，从而导致 SSL 会话失败。

以下是 HTTP 302 重定向响应如何导致 SSL 会话失败的示例：

· 要请求 SSL 会话，用户键入[https://www.f5.com/stuff](https://www.f5.com/stuff)后不带斜杠。

· 客户端浏览器向位于 BIG-IP LTM 系统上的 ClientSSL 虚拟服务器发送 SSL 请求。

· BIG-IP LTM 系统然后对请求进行解密并向网络服务器发送一个 GET /stuff 命令。

· 由于 Web 服务器上不存在 /stuff 文件，但存在 /stuff/ 虚拟目录，因此 Web 服务器为该目录发送 HTTP 302 重定向响应，但在资源的尾部附加一个斜杠。当 Web 服务器发送 HTTP 302 重定向响应时，它指定了 HTTP（不是 HTTPS）。

· 当客户端收到 HTTP 302 重定向响应时，它会向指定 HTTP（不是 HTTPS）的 BIG-IP LTM 虚拟服务器发送一个新请求。因此，SSL 连接失败。

配置 HTTP 配置文件以重写 URL

在 BIG-IP LTM 版本 9.x 中，您可以配置 HTTP 配置文件以重写 URL，以便来自 HTTP 服务器的重定向指定 HTTPS 协议。为此，请执行以下过程：

1.  登录到配置实用程序。

2.  单击本地流量。

3.  单击配置文件。

4.  单击创建按钮。

5.  键入配置文件的名称。

6.  从父配置文件下拉菜单中选择 http。

7.  在设置下，将重定向重写设置为全部、匹配或节点，具体取决于您的配置

例如：

o 选择全部以将任何 HTTP 301、302、303、305 或 307 重定向重写为 HTTPS

o 选择匹配以在请求和重定向的路径和查询 URI 组件相同时重写重定向（尾部斜杠除外）

o 当重定向 URI 包含节点 IP 地址而不是主机名并且您希望系统将其更改为虚拟服务器地址时，选择 Node to rewrite redirects

8.  单击完成。

您现在必须将新的 HTTP 配置文件与 ClientSSL 虚拟服务器相关联。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-17T18:40:20.490

试试这个：

```
# Trailing slash problem
RewriteCond    %{DOCUMENT_ROOT}%{REQUEST_FILENAME} -d
RewriteRule    ^(.+[^/])$           https://<t:sitename/>$1/ [redirect,last] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:02:07.373

```
LoadModule rewrite_module                modules/mod_rewrite.so 
```

确保该行位于 httpd.conf 文件中的某个位置

# javascript - Ruby on Rails 有哪些好的弹出对话框

> ID：158851
> 
> 赞同：13
> 
> 时间：2008-10-01T17:47:47.017
> 
> 标签：javascript, ruby-on-rails, user-interface, modalpopups

我想在 Ruby on Rails 的 Web 应用程序中使用模态弹出窗口。请注意，我不想创建新的浏览器窗口，而是现有网页内的子窗口。我们已经尝试过 TinyBox 之类的东西，但是从控制器内部返回错误信息存在问题。任何在 ruby​​ 中运行良好的方法或工具？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-10T05:59:46.773

还有[原型窗口](http://prototype-window.xilinus.com/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T23:32:14.350

我自己从未使用过它（至少现在还没有），但你试过[RedBox](http://blog.craigambrose.com/articles/2006/08/16/redbox-a-rails-compatible-lightbox)吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-05T06:11:10.770

我目前正在研究[ModalBox](http://www.wildbit.com/labs/modalbox/)，它看起来很有希望。

有一个[Google Group](http://code.google.com/p/modalbox/) and [Rails 插件](http://chrischerry.name/2008/02/modalbox-confirm-plugin.html)，它用一个模式对话框替换了基本的确认弹出窗口。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-14T21:45:41.727

试试[充值](http://gettopup.com)！它是在 Rails 应用程序中开发的，您可以从[GitHub](http://github.com/archan937/topup/tree/master)获取它。请注意，它仍然是测试版。随时欢迎反馈；）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-02T02:38:08.343

[Facebox](http://github.com/defunkt/facebox/tree/master)， jquery，Github 使用的是最好的。还有一个[原型版本](http://github.com/robertgaal/facebox-for-prototype/tree/master)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-04T07:02:02.967

我已经使用[Lightbox Gone Wild](http://particletree.com/features/lightbox-gone-wild/)有一段时间了，虽然我已经对其进行了修改以显示页面上已经存在的 DIV 或其他元素（虽然是隐藏的），然后在框关闭时将其返回给它的父级。我用它制作向导，引导用户完成一个过程。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-02T02:22:12.090

我的所有 Rails 项目都使用[了 facebox_render](http://github.com/ihower/facebox_render/tree/master)。它非常易于使用并提供完整的帮助。您可以在 RESTful 控制器中轻松呈现 html 或 javascript。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-30T02:20:38.240

我已经尝试了上面提到的几个，但是在稍微调整了一下之后，我发现[http://www.methods.co.nz/popup/popup.html](http://www.methods.co.nz/popup/popup.html)对我来说效果更好，唯一的问题是你创建了一个错误路由类似于 Rails 使用的路由，当返回错误的弹出窗口时，弹出窗口没有办法处理它

# php - 在 PHP 中创建文件进度条

> ID：158853
> 
> 赞同：5
> 
> 时间：2008-10-01T17:48:11.367
> 
> 标签：php, ajax, file-upload, progress-bar

有谁知道在 PHP 中创建文件上传进度条的任何方法？我经常听说这是不可能的。

我有一个想法，但不确定它是否可行：正常上传文件，而是提交到 iframe。提交后，将文件信息（大小和临时位置）存储在会话中。同时，每隔 10 秒启动一次 AJAX 调用，以检查文件的大小与会话中存储的大小相比。这会将大小返回给 AJAX，然后会调整进度条的大小，并可能向用户显示上传的大小。

想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T17:57:26.183

你几乎想通了如何做到这一点。主要问题是在完成上传之前，您通常无法访问上传文件的大小。

有解决方法：启用 APC，如果您包含一个名为“APC_UPLOAD_PROGRESS”的字段并使用 apc_fetch() 检索具有状态的缓存条目，则您可以访问此信息。

还有一个名为 uploadprogress 的插件，但它没有很好的文档记录并且在 Windows 上不起作用（最后我还是检查了）。

另一种方法是使用 Flash 来执行此操作。请参阅[FancyUpload 之](http://digitarald.de/project/fancyupload/)类的脚本。

在 APC 出现之前，我必须用 C 语言编写一个 CGI 脚本，将信息写入文本文件。不过，APC 现在似乎是一种更好的方法。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T17:57:52.717

到目前为止，最常见的做法是 SWFUpload：[http ://www.swfupload.org/](http://www.swfupload.org/)

但是，使用纯 PHP*是*可能的，只是非常困难且非常实验性。我看看能不能找到链接。

编辑：根据 php.net 上的评论，从 5.2 开始，有一个处理上传进度的钩子。[http://us.php.net/features.file-upload#71564](http://us.php.net/features.file-upload#71564)

更多解释：

*   [http://www.dinke.net/blog/2006/11/04/php-52-upload-progress-meter/en/](http://www.dinke.net/blog/2006/11/04/php-52-upload-progress-meter/en/)
*   [http://blog.liip.ch/archive/2006/09/10/upload-progress-meter-extension-for-php-5-2.html](http://blog.liip.ch/archive/2006/09/10/upload-progress-meter-extension-for-php-5-2.html)

拉斯穆斯的例子：

*   [http://progphp.com/progress.phps](http://progphp.com/progress.phps)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T19:08:46.090

你可以试试[YUI](http://developer.yahoo.com/yui/uploader/)或[Prototype](http://www.google.com/search?q=prototype+upload+progress)或[JQuery](http://www.google.com/search?q=jquery+upload+progress)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-08-20T12:24:02.900

从 PHP 5.4 开始，它在会话扩展中：http: [//php.net//manual/pl/session.upload-progress.php](http://php.net//manual/pl/session.upload-progress.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T17:53:39.903

在纯 PHP 中，您是对的：这是不可能的。

如果您对此进行 AJAX 化，那么您可以执行您所描述的操作。我见过的唯一进度表是 Javascript 或 Flash，尽管我想 Silverlight 也可以做到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T17:55:21.290

“老派”，但一种**PHP** + **Perl**技术：[http ://www.raditha.com/php/progress.php](http://www.raditha.com/php/progress.php)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T18:00:34.787

在我看来，最好/最简单的解决方案是构建一个小的 Flash 小部件，它由一个“上传”按钮和一个进度条组成。Flash 为您提供了关于到目前为止已上传了多少数据的非常详细的反馈，您可以基于此构建一个不错的进度条。不需要对服务器进行低效的轮询，实际上根本不需要对服务器代码进行任何更改。谷歌搜索“flash uploader”，你会发现很多人已经编写了这些小部件，并且很乐意将它们卖给你一分钱。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T18:06:55.927

我建议查看[SWFUpload](http://www.swfupload.org/)来完成你想要的。它相当灵活并支持文件排队，因此您甚至可以处理多文件上传。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T20:35:58.610

您肯定会想要使用[digitgerald 的 FancyUpload](http://digitarald.de/project/fancyupload/)。它是基于 Mootools 和 swfuplaod 的，它带有一个很好的队列，包含状态、进度、eta 等。这真的是我见过的上传文件的最巧妙的方法。对于我的个人用例，ivé 使用它让客户选择 1.2 GB 的 PDF 文件并上传它们。较新的会自动重命名和版本化，跳过相同的，等等。

# svn - 了解 SubVersion 工作副本是否已更新

> ID：158856
> 
> 赞同：0
> 
> 时间：2008-10-01T17:48:56.717
> 
> 标签：svn, build-process

有没有办法在 WC 更新到新版本时修改/触摸文件？或者，作为次优选择，无论何时`svn update`执行？

这是动机：我想在我的可执行文件中包含 SVN 修订号。所以我必须在构建过程中运行 SubWCRev。SubWCRev 的输出文件每次都会重新创建，即使修订号没有改变。这意味着该 exe 链接到每个构建，即使没有任何改变。我希望它仅在需要时链接。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T18:01:46.063

1.  将 SubWCRev 输出获取到临时文件中
2.  将此文件与当前修订号文件进行比较
3.  仅当两者不同时才用临时文件覆盖它
4.  删除临时文件

您甚至可以使用 .bat 文件（使用`fc`）来执行此操作。就像是...

```
REM ***UNTESTED***
FC temp.rev curr.rev | FIND "FC: no dif" > nul 
IF NOT ERRORLEVEL 1 COPY /Y temp.rev curr.rev
DEL temp.rev 
```

**编辑：**顺便说一句，您可以在 Mercurial 中通过使 rev-number-file 依赖于`.hg/dirstate`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T18:16:31.910

这听起来像是这里讨论的重复： [Embedding SVN Revision number at compile time in a Windows app](https://stackoverflow.com/questions/151299/embedding-svn-revision-number-at-compile-time-in-a-win32-app#151445)

我在那个问题中描述的方法可以跨平台工作，并且可以输出为您编程的任何格式，因此它可以在包含文件是可行解决方案的任何情况下工作。

在您的情况下，您想在 svnversion 的输出中观察 M 修饰符：这会让您知道您的 WC 已被修改。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-01T18:13:35.130

我的回答可能会太短，但可能会给你一些方向。

SVN 有钩子。它们是每次提交代码时都会执行的脚本。

也许？

# keyboard - 我是否不正确地订阅 YUI 菜单事件？

> ID：158864
> 
> 赞同：1
> 
> 时间：2008-10-01T17:51:10.737
> 
> 标签：keyboard, yui, shortcut, menu

我已阅读并遵循[YUI 的](http://developer.yahoo.com/yui/menu/)订阅菜单事件的教程。我还查看了菜单、菜单栏和自定义事件的 API 和代码位，但以下内容*无法*正常工作

```
// oMenuBar is a MenuBar instance with submenus
var buyMenu = oMenuBar.getSubmenus()[1];

// this works
buyMenu.subscribe('show', onShow, {foo: 'bar'}, false);

// using the subscribe method doesn't work
buyMenu.subscribe('mouseOver', onMouseOver, {foo: 'bar'}, false);

// manually attaching a listener doesn't work
YAHOO.util.Event.addListener(buyMenu, 'mouseOver', onMouseOver);

// http://developer.yahoo.com/yui/docs/YAHOO.widget.Menu.html#event_keyPressEvent        
// there is a keyPress Event, but no spelling of it will trigger the handler
buyMenu.subscribe('keypress', onShow, {foo: 'bar'}, false);
buyMenu.subscribe('keypressed', onShow, {foo: 'bar'}, false);
buyMenu.subscribe('keyPressed', onShow, {foo: 'bar'}, false);
buyMenu.subscribe('keyPress', onShow, {foo: 'bar'}, false); 
```

从功能上讲，我正在尝试为 MenuBar 的每个子菜单附加一个 keyPress 侦听器。我不想将 Bubbling 库添加为依赖项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-19T22:53:09.893

Todd Kloots 这里是 YUI 菜单小部件的作者。当您订阅基于 DOM 的事件时，事件名称都是小写的。因此，对于“鼠标悬停”事件，订阅如下：

buyMenu.subscribe('mouseover', onMouseOver, {foo: 'bar'}, false);

关于您的按键事件处理程序：您正在正确订阅。但是，请记住，任何与键相关的事件处理程序只有在菜单具有焦点时才会触发。因此，在测试与键相关的事件处理程序之前，请确保您的菜单具有焦点。另外 - 我建议监听“keydown”事件而不是“keypress”，因为并非所有键都会导致在 IE 中触发“keypress”事件。

如果您有任何其他问题，请直接向 ydn-javascript Y! 分组，因为我经常监视该组上的消息。

我希望这会有所帮助。

*   托德

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T09:49:53.193

Based on my testing, the following will work:

```
oMenu.subscribe('keypress', function () { alert("I'm your friendly neighborhood keypress listener.")}); 
```

but that only fires when the `Menu` is receiving the `keypress` event, so it would need to already have focus.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T22:47:43.463

onShow 是否指向一个函数？

例如。

```
var onShow = function()
{
    alert("Click!");
} 
```

# c# - C# 中的双精度数比浮点数快吗？

> ID：158889
> 
> 赞同：55
> 
> 时间：2008-10-01T17:58:46.337
> 
> 标签：c#, performance, floating-point, precision

我正在编写一个应用程序，它读取大型浮点数组并使用它们执行一些简单的操作。我正在使用浮点数，因为我认为它会比双精度数更快，但是在做了一些研究之后，我发现这个话题有些混乱。谁能详细说明这一点？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-10-01T18:15:00.680

简短的回答是，“使用可接受的结果所需的任何精度。”

您的一个保证是对浮点数据执行的操作至少在表达式的最高精度成员中完成。因此，将两个**float**相乘至少以 float 的精度完成**，而将****float**和**double**相乘至少以双精度完成。该标准规定“[浮点] 运算可以以比运算结果类型更高的精度执行。”

鉴于 .NET 的 JIT 试图让您的浮点运算保持要求的精度，我们可以查看 Intel 的文档以加快我们的运算速度。在英特尔平台上，您的浮点运算可能以 80 位的中间精度完成，并转换为要求的精度。

从 Intel's guide to C++ Floating-point Operations ¹（抱歉只有死树），他们提到：

> *   除非需要通过 double 或 long double 获得的额外精度，否则请使用单精度类型（例如，float）。更高精度的类型会增加内存大小和带宽要求。...
> *   避免混合数据类型算术表达式

最后一点很重要，因为[您可以通过对 float 和 double 的不必要强制转换来减慢自己的速度](http://weblog.ikvm.net/PermaLink.aspx?guid=f300c4e1-15b0-45ed-b6a6-b5dc8fb8089e)，这会导致 JIT 代码要求 x87 在操作之间放弃其 80 位中间格式！

*1\. 是的，它说的是 C++，但是 C# 标准加上 CLR 的知识让我们知道 C++ 的信息应该适用于这种情况。*

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-12-05T16:19:43.747

我刚刚阅读了 MCTS 考试 70-536 的“Microsoft .NET Framework-Application Development Foundation 2nd”，第 4 页（第 1 章）有注释：

> **注意 使用内置类型**
> 优化性能 运行时优化 32 位整数类型（Int32 和 UInt32）的性能，因此将这些类型用于计数器和其他经常访问的整数变量。对于浮点运算，Double 是最有效的类型，因为这些运算是由硬件优化的。

它是由托尼·诺斯鲁普（Tony Northrup）撰写的。我不知道他是否是权威，但我希望.NET 考试的官方书籍应该有一定的分量。这当然不是保证。我只是想我会把它添加到这个讨论中。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-02T04:52:09.073

几周前我介绍了一个类似的问题。底线是对于 x86 硬件，浮点数与双精度数的性能没有显着差异，除非您受到内存限制，或者您开始​​遇到缓存问题。在这种情况下，浮动通常具有优势，因为它们更小。

当前的英特尔 CPU 在 80 位宽的寄存器中执行所有浮点运算，因此计算的实际速度不应在浮点数和双精度数之间变化。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-01T20:14:48.193

如果加载和存储操作是瓶颈，那么浮点数会更快，因为它们更小。如果您在加载和存储之间进行大量计算，它应该大致相等。

其他人提到避免浮点和双精度之间的转换，以及使用这两种类型的操作数的计算。这是个好建议，如果您使用任何返回双精度的数学库函数（例如），那么将所有内容都保留为双精度会更快。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-06-26T12:21:07.767

我正在编写一个光线追踪器，并用我的 Color 类的双精度数替换浮点数，使我的速度提高了 5%。用 double 替换 Vectors 浮点数再快 5%！很酷:)

那是Core i7 920

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T04:58:55.563

使用 387 FPU 算术，对于某些长迭代操作，如 pow、log 等（并且仅当编译器适当地设置 FPU 控制字），float 仅比 double 快。

使用打包的 SSE 算法，它会产生很大的不同。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-01-05T23:41:06.460

[马蒂斯，](https://stackoverflow.com/questions/158889/are-doubles-faster-than-floats-in-c/4359766#4359766)

你错了。32 位比 16 位效率高得多——在现代处理器中……也许不是内存方面的，但在有效性方面 32 位是要走的路。

您确实应该将您的教授更新为更“最新”的东西。;)

无论如何，回答这个问题；float 和 double 具有完全相同的性能，至少在我的 Intel i7 870 上（理论上如此）。

这是我的测量结果：

（我做了一个“算法”，我重复了 10,000,000 次，然后重复了 300 次，然后我做了一个平均值。）

```
double
-----------------------------
1 core  = 990 ms
4 cores = 340 ms
6 cores = 282 ms
8 cores = 250 ms

float
-----------------------------
1 core  = 992 ms
4 cores = 340 ms
6 cores = 282 ms
8 cores = 250 ms 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-09-11T07:25:59.660

我一直认为无论浮点还是双精度，处理器都经过优化或相同。在我的密集计算中搜索优化（大量从矩阵中获取，两个值的比较），我发现浮点数的运行速度快了大约 13%。

这让我感到惊讶，但我想这是由于我的问题的性质。我不会在操作的核心中在 float 和 double 之间进行强制转换，我的计算主要是加法、乘法和减法。

这是在我的 i7 920 上，运行 64 位操作系统。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T18:01:53.050

这表明浮点数略快于双精度数：[http ://www.herongyang.com/cs_b/performance.html](http://www.herongyang.com/cs_b/performance.html)

一般来说，任何时候进行性能比较时，都应该考虑任何特殊情况，比如使用一种类型是否需要额外的转换或数据按摩？这些加起来可能会掩盖这样的通用基准。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T18:11:42.763

浮点数在 32 位系统上应该更快，但分析代码以确保您正在优化正确的东西。

# html - 将 HTML 输入限制为文本框

> ID：158893
> 
> 赞同：1
> 
> 时间：2008-10-01T18:00:08.110
> 
> 标签：html, user-input, markup

如何限制用户可以输入到文本框中的 HTML 类型？我正在使用一些我正在测试的自定义软件运行一个小型论坛，但我需要知道如何限制 HTML 输入。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T18:05:34.773

您没有说明论坛是用什么构建的，但如果是 PHP，请查看：

> [http://htmlpurifier.org/](http://htmlpurifier.org/)
> 
> 库功能：*白名单、删除、格式良好、嵌套、属性、XSS 安全、标准安全*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T18:19:26.160

我建议一种稍微替代的方法：

*   不要过滤传入的用户数据（除了防止 sql 注入）。用户数据应尽可能保持纯净。
*   从数据库中过滤所有传出数据，这就是标签剥离等事情应该发生的地方

保持用户数据干净可以让您更灵活地显示数据。过滤所有传出数据是一个好习惯（沿着从不信任数据模因）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T18:02:24.923

提交文本后，您可以使用 PHP 中的正则表达式去除任何/所有与您的预定义集不匹配的标签。

它看起来像下面这样：

```
find open tag (<)
if contents != allowed tag, remove tag (from <..>) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:05:05.773

1.  解析输入提供并删除所有与您允许的列表不完全匹配的 html 标记。这可以是一个复杂的正则表达式，或者您可以通过输入字符串的 char[] 进行有状态迭代，构建允许的输入字符串并去除标签上不需要的属性，例如`img`.

2.  使用不同的代码系统（BBCode、Markdown）

3.  在线查找一些已经执行此操作的代码，以用作实现的基础。例如 Slashcode 必须执行这个，所以在 Perl 中寻找它的实现并使用正则表达式（我假设在那里）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T19:47:11.707

无论您使用什么，请务必了解哪种 HTML 内容可能是危险的。

例如，<script> 标签非常明显，但<style> 标签在IE 中同样糟糕，因为它可以调用JScript 命令。

事实上，任何 style="..." 属性都可以在 IE 中调用脚本。

<object> 将是另一个需要厌倦的标签。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-06T19:06:46.443

PHP 带有一个简单的函数[strip_tag](http://us3.php.net/strip_tags)来去除 HTML 标签。它允许某些标签不被剥离。

**Example #1 strip_tags() 例子**

```
<?php
$text = '<p>Test paragraph.</p><!-- Comment --> <a href="#fragment">Other text</a>';
echo strip_tags($text);
echo "\n";

// Allow <p> and <a>
echo strip_tags($text, '<p><a>');
?> 
```

**上面的示例将输出：**

```
Test paragraph. Other text
<p>Test paragraph.</p> <a href="#fragment">Other text</a> 
```

就我个人而言，我会使用 BBCode 或 Markdown，因为提供的支持和功能数量较多，例如实时预览。

# .net - 如何使 Windows Forms .NET 应用程序显示为托盘图标？

> ID：158895
> 
> 赞同：20
> 
> 时间：2008-10-01T18:00:28.517
> 
> 标签：.net, vb.net, winforms, system-tray, systray

需要做什么才能让您的 .NET 应用程序在 Window 的系统托盘中显示为图标？

以及如何处理鼠标按钮单击所述图标？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-01T18:08:12.163

首先，向窗体添加一个[NotifyIcon](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.notifyicon)控件。然后连接通知图标来做你想做的事。

如果你想让它在最小化时隐藏到托盘，试试这个。

```
Private Sub frmMain_Resize(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Resize
    If Me.WindowState = FormWindowState.Minimized Then
        Me.ShowInTaskbar = False
    Else
        Me.ShowInTaskbar = True
    End If
End Sub

Private Sub NotifyIcon1_MouseClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles NotifyIcon1.MouseClick
    Me.WindowState = FormWindowState.Normal
End Sub 
```

我偶尔会使用气球文本来通知用户——这样做是这样的：

```
 Me.NotifyIcon1.ShowBalloonTip(3000, "This is a notification title!!", "This is notification text.", ToolTipIcon.Info) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T18:02:53.423

您可以将工具箱中的 NotifyIcon 组件添加到主窗体中。

这具有诸如 MouseDoubleClick 之类的事件，您可以使用它们来处理各种事件。

编辑：如果您希望它在系统托盘中正确显示，您必须确保将 Icon 属性设置为有效的 .ico 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-04-02T19:12:53.297

为了扩展[汤姆的回答](https://stackoverflow.com/a/158927/7444103)，我希望仅在应用程序最小化时才使图标可见。
为此，请设置`Visible = False`NotifyIcon[并](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.notifyicon)使用以下代码。

我还有下面的代码可以在关闭期间隐藏图标，以防止在应用程序关闭后仍然存在的烦人的*幽灵托盘图标。*

```
Private Sub Form_Resize(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Resize
    If Me.WindowState = FormWindowState.Minimized Then
        Hide()
        NotifyIcon1.Visible = True
        NotifyIcon1.ShowBalloonTip(3000, NotifyIcon1.Text, "Minimized to tray", ToolTipIcon.Info)
    End If
End Sub

Private Sub NotifyIcon1_MouseClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles NotifyIcon1.MouseClick
    Show()
    Me.WindowState = FormWindowState.Normal
    Me.Activate()
    NotifyIcon1.Visible = False
End Sub

Private Sub Form_FormClosing(sender As Object, e As FormClosingEventArgs) Handles Me.FormClosing
    NotifyIcon1.Visible = False
    Dim index As Integer
    While index < My.Application.OpenForms.Count
        If My.Application.OpenForms(index) IsNot Me Then
            My.Application.OpenForms(index).Close()
        End If
        index += 1
    End While
End Sub 
```

如果要添加右键菜单：

[VB.NET：如何为托盘图标制作右键菜单](https://social.technet.microsoft.com/wiki/contents/articles/13319.vb-net-how-to-make-a-right-click-menu-for-a-tray-icon.aspx)

根据文章（带有上下文的mods）：

设置用于托管托盘图标上下文菜单的表单

*   在属性中将 FormBorderStyle 设置为无。
*   将 ShowInTaskbar 设置为 False（因为当我们右键单击托盘图标时，我们不希望任务栏中出现图标！）。
*   将开始位置设置为手动。
*   将 TopMost 设置为 True。
*   将 ContextMenuStrip 添加到您的新表单中，然后将其命名为您想要的任何名称。
*   将项目添加到 ContextMenuStrip（对于此示例，只需添加一个名为“Exit”的项目）。

后面的表单代码将如下所示：

```
Private Sub Form_Deactivate(sender As Object, e As EventArgs) Handles Me.Deactivate
    Me.Close()
End Sub

Private Sub Form_Load(sender As Object, e As EventArgs) Handles MyBase.Load
    ContextMenuStrip1.Show(Cursor.Position)
    Me.Left = ContextMenuStrip1.Left + 1
    Me.Top = ContextMenuStrip1.Top + 1
End Sub

Private Sub ExitToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles ExitToolStripMenuItem.Click
    MainForm.NotifyIcon1.Visible = False
    End
End Sub 
```

然后我将 notifyicon 鼠标事件更改为此（`TrayIconMenuForm`是提供上下文菜单的表单的名称）：

```
Private Sub NotifyIcon1_MouseClick(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles NotifyIcon1.MouseClick
    Select Case e.Button
        Case Windows.Forms.MouseButtons.Left
            Show()
            Me.WindowState = FormWindowState.Normal
            Me.Activate()
            NotifyIcon1.Visible = False
        Case Windows.Forms.MouseButtons.Right
            TrayIconMenuForm.Show() 'Shows the Form that is the parent of "traymenu"
            TrayIconMenuForm.Activate() 'Set the Form to "Active", that means that that will be the "selected" window
            TrayIconMenuForm.Width = 1 'Set the Form width to 1 pixel, that is needed because later we will set it behind the "traymenu"
            TrayIconMenuForm.Height = 1 'Set the Form Height to 1 pixel, for the same reason as above
        Case Else
            'Do nothing
    End Select
End Sub 
```

# c++ - MFC 文件上传

> ID：158908
> 
> 赞同：2
> 
> 时间：2008-10-01T18:03:09.273
> 
> 标签：c++, mfc, upload

我如何使用 c++ 和 MFC 将文件上传到网络服务器。我们没有使用.Net。我需要打开一个套接字并自己做所有事情吗？如果是这样，在哪里可以参考？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T18:08:50.960

您不想使用直接套接字调用。很难以这种方式正确获取 HTTP。

更简单的方法是使用 WinINet API。查看 InternetOpen 的文档，这可能是您拨打的第一个电话。您可能需要的功能：

*   互联网开放
*   互联网连接
*   HttpOpenRequest
*   HttpSendRequest
*   HttpQueryInfo
*   互联网关闭句柄

您可以在 msdn 上找到所有这些的文档

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T17:23:35.643

这是我最终使用的代码。我去掉了错误检查和其他通知内容。这会进行多部分表单上传。

```
DWORD dwTotalRequestLength;
DWORD dwChunkLength;
DWORD dwReadLength;
DWORD dwResponseLength;
CHttpFile* pHTTP = NULL;

dwChunkLength = 64 * 1024; 
void* pBuffer = malloc(dwChunkLength);
CFile file ;

CInternetSession session("sendFile");
CHttpConnection *connection = NULL;

try {
//Create the multi-part form data that goes before and after the actual file upload.

CString strHTTPBoundary = _T("FFF3F395A90B452BB8BEDC878DDBD152");       
CString strPreFileData = MakePreFileData(strHTTPBoundary, file.GetFileName());
CString strPostFileData = MakePostFileData(strHTTPBoundary);
CString strRequestHeaders = MakeRequestHeaders(strHTTPBoundary);
dwTotalRequestLength = strPreFileData.GetLength() + strPostFileData.GetLength() + file.GetLength();

connection = session.GetHttpConnection("www.YOURSITE.com",NULL,INTERNET_DEFAULT_HTTP_PORT);

pHTTP = connection->OpenRequest(CHttpConnection::HTTP_VERB_POST, _T("/YOUURL/submit_file.pl"));
pHTTP->AddRequestHeaders(strRequestHeaders);
pHTTP->SendRequestEx(dwTotalRequestLength, HSR_SYNC | HSR_INITIATE);

//Write out the headers and the form variables
pHTTP->Write((LPSTR)(LPCSTR)strPreFileData, strPreFileData.GetLength());

//upload the file.

dwReadLength = -1;
int length = file.GetLength(); //used to calculate percentage complete.
while (0 != dwReadLength)
{
    dwReadLength = file.Read(pBuffer, dwChunkLength);
    if (0 != dwReadLength)
    {
    pHTTP->Write(pBuffer, dwReadLength);
    }
}

file.Close();

//Finish the upload.
pHTTP->Write((LPSTR)(LPCSTR)strPostFileData, strPostFileData.GetLength());
pHTTP->EndRequest(HSR_SYNC);

//get the response from the server.
LPSTR szResponse;
CString strResponse;
dwResponseLength = pHTTP->GetLength();
while (0 != dwResponseLength )
{
    szResponse = (LPSTR)malloc(dwResponseLength + 1);
    szResponse[dwResponseLength] = '\0';
    pHTTP->Read(szResponse, dwResponseLength);
    strResponse += szResponse;
    free(szResponse);
    dwResponseLength = pHTTP->GetLength();
}

AfxMessageBox(strResponse);

//close everything up.
pHTTP->Close();
connection->Close();
session.Close();

CString CHelpRequestUpload::MakeRequestHeaders(CString& strBoundary)
{
CString strFormat;
CString strData;
strFormat = _T("Content-Type: multipart/form-data; boundary=%s\r\n");
strData.Format(strFormat, strBoundary);
return strData;
}

CString CHelpRequestUpload::MakePreFileData(CString& strBoundary, CString& strFileName)
{
CString strFormat;
CString strData;

strFormat = _T("--%s");
strFormat += _T("\r\n");
strFormat += _T("Content-Disposition: form-data; name=\"user\"");
strFormat += _T("\r\n\r\n");
strFormat += _T("%s");
strFormat += _T("\r\n");

strFormat += _T("--%s");
strFormat += _T("\r\n");
strFormat += _T("Content-Disposition: form-data; name=\"email\"");
strFormat += _T("\r\n\r\n");
strFormat += _T("%s");
strFormat += _T("\r\n");

strFormat += _T("--%s");
strFormat += _T("\r\n");
strFormat += _T("Content-Disposition: form-data; name=\"filename\"; filename=\"%s\"");
strFormat += _T("\r\n");
strFormat += _T("Content-Type: audio/x-flac");
strFormat += _T("\r\n");
strFormat += _T("Content-Transfer-Encoding: binary");
strFormat += _T("\r\n\r\n");

strData.Format(strFormat, strBoundary, m_Name, strBoundary, m_Email,  strBoundary, strFileName);

return strData;
 }

CString CHelpRequestUpload::MakePostFileData(CString& strBoundary)
{

CString strFormat;
CString strData;

strFormat = _T("\r\n");
strFormat += _T("--%s");
strFormat += _T("\r\n");
strFormat += _T("Content-Disposition: form-data; name=\"submitted\"");
strFormat += _T("\r\n\r\n");
strFormat += _T("");
strFormat += _T("\r\n");
strFormat += _T("--%s--");
strFormat += _T("\r\n");

strData.Format(strFormat, strBoundary, strBoundary);

return strData;

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T07:04:45.290

建议使用 WinInet。请记住，有包装这些 API 的 MFC 类。如果由于某种原因这些 API 不能灵活地满足您的要求（例如，您需要通过代理实现连接，包括身份验证），请查看 WinHTTP。它是 WinInet 的超集（WinHTTP 没有 MFC 包装器）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:10:13.563

您可以使用 BITS：

[http://www.codeproject.com/KB/IP/bitsman.aspx](http://www.codeproject.com/KB/IP/bitsman.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T18:36:24.933

您还可以使用 XMLHTTP。即使您不发送 XML。基于 WinINet，但更易于使用（如果您习惯使用 COM）。
请参阅 MSDN：http: [//msdn.microsoft.com/en-us/library/ms759148.aspx](http://msdn.microsoft.com/en-us/library/ms759148.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T18:04:29.463

如果您有 ftp 服务器，请查看 CFtpConnection 类。

# ios - 裁剪 UIImage

> ID：158914
> 
> 赞同：214
> 
> 时间：2008-10-01T18:04:26.790
> 
> 标签：ios, objective-c, cocoa-touch, uiimagepickercontroller, image-manipulation

我有一些代码可以调整图像的大小，因此我可以获得图像中心的缩放块 - 我使用它来获取`UIImage`并返回图像的一个小的方形表示，类似于在专辑视图中看到的照片应用程序。（我知道我可以使用 a`UIImageView`并调整裁剪模式来获得相同的结果，但这些图像有时会显示在 中`UIWebViews`）。

我开始注意到这段代码中有一些崩溃，我有点难过。我有两种不同的理论，我想知道是否有任何一种是基于的。

理论 1）我通过绘制到我的目标尺寸的屏幕外图像上下文来实现裁剪。由于我想要图像的中心部分，因此我将`CGRect`传递给的参数设置为`drawInRect`大于图像上下文范围的参数。我希望这是 Kosher，但我是不是试图画出我不应该接触的其他记忆？

理论2）我在后台线程中完成所有这些。我知道 UIKit 的某些部分仅限于主线程。我假设/希望绘制到屏幕外视图不是其中之一。我错了吗？

（哦，我多么怀念`NSImage's drawInRect:fromRect:operation:fraction:`方法。）

* * *

## 回答 #1

> 赞同：237
> 
> 时间：2009-04-03T04:31:12.997

2014-05-28 更新：我在 iOS 3 左右是热门新事物时写了这个，我敢肯定现在有更好的方法可以做到这一点，可能是内置的。正如许多人提到的，这种方法没有考虑轮换；阅读一些额外的答案并传播一些赞成的爱，以使对这个问题的回答对每个人都有帮助。

原始回复：

我将在别处复制/粘贴我对同一问题的回答：

没有一个简单的类方法可以做到这一点，但有一个函数可以用来获得所需的结果：`CGImageCreateWithImageInRect(CGImageRef, CGRect)`将帮助你。

这是一个使用它的简短示例：

```
CGImageRef imageRef = CGImageCreateWithImageInRect([largeImage CGImage], cropRect);
// or use the UIImage wherever you like
[UIImageView setImage:[UIImage imageWithCGImage:imageRef]]; 
CGImageRelease(imageRef); 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2011-12-09T10:10:16.260

要在保持相同比例和方向的情况下裁剪视网膜图像，请在 UIImage 类别（iOS 4.0 及更高版本）中使用以下方法：

```
- (UIImage *)crop:(CGRect)rect {
    if (self.scale > 1.0f) {
        rect = CGRectMake(rect.origin.x * self.scale,
                          rect.origin.y * self.scale,
                          rect.size.width * self.scale,
                          rect.size.height * self.scale);
    }

    CGImageRef imageRef = CGImageCreateWithImageInRect(self.CGImage, rect);
    UIImage *result = [UIImage imageWithCGImage:imageRef scale:self.scale orientation:self.imageOrientation];
    CGImageRelease(imageRef);
    return result;
} 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2011-10-09T15:03:54.563

您可以创建一个 UIImage 类别并在任何需要的地方使用它。基于 HitScans 的响应和下面的评论。

```
@implementation UIImage (Crop)

- (UIImage *)crop:(CGRect)rect {

    rect = CGRectMake(rect.origin.x*self.scale, 
                      rect.origin.y*self.scale, 
                      rect.size.width*self.scale, 
                      rect.size.height*self.scale);       

    CGImageRef imageRef = CGImageCreateWithImageInRect([self CGImage], rect);
    UIImage *result = [UIImage imageWithCGImage:imageRef 
                                          scale:self.scale 
                                    orientation:self.imageOrientation]; 
    CGImageRelease(imageRef);
    return result;
}

@end 
```

你可以这样使用它：

```
UIImage *imageToCrop = <yourImageToCrop>;
CGRect cropRect = <areaYouWantToCrop>;   

//for example
//CGRectMake(0, 40, 320, 100);

UIImage *croppedImage = [imageToCrop crop:cropRect]; 
```

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2014-09-13T15:05:01.397

## 斯威夫特 3 版本

```
func cropImage(imageToCrop:UIImage, toRect rect:CGRect) -> UIImage{

    let imageRef:CGImage = imageToCrop.cgImage!.cropping(to: rect)!
    let cropped:UIImage = UIImage(cgImage:imageRef)
    return cropped
}

let imageTop:UIImage  = UIImage(named:"one.jpg")! // add validation 
```

![在此处输入图像描述](https://i.stack.imgur.com/6JTE8.png)

在此桥接功能的帮助下`CGRectMake`-> `CGRect`（[此答案](https://stackoverflow.com/a/38335180/1631379)由 回答`@rob mayoff`）：

```
 func CGRectMake(_ x: CGFloat, _ y: CGFloat, _ width: CGFloat, _ height: CGFloat) -> CGRect {
    return CGRect(x: x, y: y, width: width, height: height)
} 
```

用法是：

```
if var image:UIImage  = UIImage(named:"one.jpg"){
   let  croppedImage = cropImage(imageToCrop: image, toRect: CGRectMake(
        image.size.width/4,
        0,
        image.size.width/2,
        image.size.height)
    )
} 
```

*输出：*

![在此处输入图像描述](https://i.stack.imgur.com/gdAWS.png)

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2013-02-05T16:27:46.740

这是我的 UIImage 裁剪实现，它遵循 imageOrientation 属性。所有方向都经过彻底测试。

```
inline double rad(double deg)
{
    return deg / 180.0 * M_PI;
}

UIImage* UIImageCrop(UIImage* img, CGRect rect)
{
    CGAffineTransform rectTransform;
    switch (img.imageOrientation)
    {
        case UIImageOrientationLeft:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(90)), 0, -img.size.height);
            break;
        case UIImageOrientationRight:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(-90)), -img.size.width, 0);
            break;
        case UIImageOrientationDown:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(-180)), -img.size.width, -img.size.height);
            break;
        default:
            rectTransform = CGAffineTransformIdentity;
    };
    rectTransform = CGAffineTransformScale(rectTransform, img.scale, img.scale);

    CGImageRef imageRef = CGImageCreateWithImageInRect([img CGImage], CGRectApplyAffineTransform(rect, rectTransform));
    UIImage *result = [UIImage imageWithCGImage:imageRef scale:img.scale orientation:img.imageOrientation];
    CGImageRelease(imageRef);
    return result;
} 
```

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2013-09-03T22:44:54.290

注意：所有这些答案都假设一个`CGImage`支持的图像对象。

`image.CGImage``UIImage`如果由 a 支持，则可以返回 nil，`CIImage`如果您使用 a 创建此图像就是这种情况`CIFilter`。

在这种情况下，您可能必须在新的上下文中绘制图像，并返回该图像（*慢*）。

```
UIImage* crop(UIImage *image, rect) {
    UIGraphicsBeginImageContextWithOptions(rect.size, false, [image scale]);
    [image drawAtPoint:CGPointMake(-rect.origin.x, -rect.origin.y)];
    cropped_image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return cropped_image;
} 
```

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2014-08-13T18:32:52.133

这里没有一个答案能 100% 正确处理所有的比例和旋转问题。这是到目前为止所说的所有内容的综合，截至 iOS7/8 的最新版本。它应该作为一种方法包含在 UIImage 的类别中。

```
- (UIImage *)croppedImageInRect:(CGRect)rect
{
    double (^rad)(double) = ^(double deg) {
        return deg / 180.0 * M_PI;
    };

    CGAffineTransform rectTransform;
    switch (self.imageOrientation) {
        case UIImageOrientationLeft:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(90)), 0, -self.size.height);
            break;
        case UIImageOrientationRight:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(-90)), -self.size.width, 0);
            break;
        case UIImageOrientationDown:
            rectTransform = CGAffineTransformTranslate(CGAffineTransformMakeRotation(rad(-180)), -self.size.width, -self.size.height);
            break;
        default:
            rectTransform = CGAffineTransformIdentity;
    };
    rectTransform = CGAffineTransformScale(rectTransform, self.scale, self.scale);

    CGImageRef imageRef = CGImageCreateWithImageInRect([self CGImage], CGRectApplyAffineTransform(rect, rectTransform));
    UIImage *result = [UIImage imageWithCGImage:imageRef scale:self.scale orientation:self.imageOrientation];
    CGImageRelease(imageRef);

    return result;
} 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2018-01-05T09:32:16.407

`awolf`的答案的Swift 版本，对我有用：

```
public extension UIImage {
    func croppedImage(inRect rect: CGRect) -> UIImage {
        let rad: (Double) -> CGFloat = { deg in
            return CGFloat(deg / 180.0 * .pi)
        }
        var rectTransform: CGAffineTransform
        switch imageOrientation {
        case .left:
            let rotation = CGAffineTransform(rotationAngle: rad(90))
            rectTransform = rotation.translatedBy(x: 0, y: -size.height)
        case .right:
            let rotation = CGAffineTransform(rotationAngle: rad(-90))
            rectTransform = rotation.translatedBy(x: -size.width, y: 0)
        case .down:
            let rotation = CGAffineTransform(rotationAngle: rad(-180))
            rectTransform = rotation.translatedBy(x: -size.width, y: -size.height)
        default:
            rectTransform = .identity
        }
        rectTransform = rectTransform.scaledBy(x: scale, y: scale)
        let transformedRect = rect.applying(rectTransform)
        let imageRef = cgImage!.cropping(to: transformedRect)!
        let result = UIImage(cgImage: imageRef, scale: scale, orientation: imageOrientation)
        return result
    }
} 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2011-03-29T03:30:57.130

```
CGSize size = [originalImage size];
int padding = 20;
int pictureSize = 300;
int startCroppingPosition = 100;
if (size.height > size.width) {
    pictureSize = size.width - (2.0 * padding);
    startCroppingPosition = (size.height - pictureSize) / 2.0; 
} else {
    pictureSize = size.height - (2.0 * padding);
    startCroppingPosition = (size.width - pictureSize) / 2.0;
}
// WTF: Don't forget that the CGImageCreateWithImageInRect believes that 
// the image is 180 rotated, so x and y are inverted, same for height and width.
CGRect cropRect = CGRectMake(startCroppingPosition, padding, pictureSize, pictureSize);
CGImageRef imageRef = CGImageCreateWithImageInRect([originalImage CGImage], cropRect);
UIImage *newImage = [UIImage imageWithCGImage:imageRef scale:1.0 orientation:originalImage.imageOrientation];
[m_photoView setImage:newImage];
CGImageRelease(imageRef); 
```

我看到的大多数响应只处理 (x, y) 的 (0, 0) 位置。好的，这是一种情况，但我希望我的裁剪操作能够居中。我花了一段时间才弄清楚 WTF 评论后面的那一行。

让我们以纵向拍摄的图像为例：

1.  原始图像的高度高于其宽度（哇，到目前为止并不奇怪！）
2.  CGImageCreateWithImageInRect 方法在它自己的世界中想象的图像不是真正的肖像而是风景（这也是为什么如果你不使用 imageWithCGImage 构造函数中的方向参数，它将显示为 180 旋转）。
3.  所以，你应该想象它是一个风景， (0, 0) 位置是图像的右上角。

希望这是有道理的！如果没有，请尝试不同的值，您会发现在为您的cropRect 选择正确的 x、y、宽度和高度时，逻辑是相反的。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2016-11-04T11:54:25.813

# 迅捷3

```
extension UIImage {
    func crop(rect: CGRect) -> UIImage? {
        var scaledRect = rect
        scaledRect.origin.x *= scale
        scaledRect.origin.y *= scale
        scaledRect.size.width *= scale
        scaledRect.size.height *= scale
        guard let imageRef: CGImage = cgImage?.cropping(to: scaledRect) else {
            return nil
        }
        return UIImage(cgImage: imageRef, scale: scale, orientation: imageOrientation)
    }
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2015-05-22T18:47:57.307

快速扩展

```
extension UIImage {
    func crop(var rect: CGRect) -> UIImage {
        rect.origin.x*=self.scale
        rect.origin.y*=self.scale
        rect.size.width*=self.scale
        rect.size.height*=self.scale

        let imageRef = CGImageCreateWithImageInRect(self.CGImage, rect)
        let image = UIImage(CGImage: imageRef, scale: self.scale, orientation: self.imageOrientation)!
        return image
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-03-27T06:07:28.800

**在Swift**中裁剪 UIImage 的最佳解决方案，在精度、像素缩放方面......：

```
private func squareCropImageToSideLength(let sourceImage: UIImage,
    let sideLength: CGFloat) -> UIImage {
        // input size comes from image
        let inputSize: CGSize = sourceImage.size

        // round up side length to avoid fractional output size
        let sideLength: CGFloat = ceil(sideLength)

        // output size has sideLength for both dimensions
        let outputSize: CGSize = CGSizeMake(sideLength, sideLength)

        // calculate scale so that smaller dimension fits sideLength
        let scale: CGFloat = max(sideLength / inputSize.width,
            sideLength / inputSize.height)

        // scaling the image with this scale results in this output size
        let scaledInputSize: CGSize = CGSizeMake(inputSize.width * scale,
            inputSize.height * scale)

        // determine point in center of "canvas"
        let center: CGPoint = CGPointMake(outputSize.width/2.0,
            outputSize.height/2.0)

        // calculate drawing rect relative to output Size
        let outputRect: CGRect = CGRectMake(center.x - scaledInputSize.width/2.0,
            center.y - scaledInputSize.height/2.0,
            scaledInputSize.width,
            scaledInputSize.height)

        // begin a new bitmap context, scale 0 takes display scale
        UIGraphicsBeginImageContextWithOptions(outputSize, true, 0)

        // optional: set the interpolation quality.
        // For this you need to grab the underlying CGContext
        let ctx: CGContextRef = UIGraphicsGetCurrentContext()
        CGContextSetInterpolationQuality(ctx, kCGInterpolationHigh)

        // draw the source image into the calculated rect
        sourceImage.drawInRect(outputRect)

        // create new image from bitmap context
        let outImage: UIImage = UIGraphicsGetImageFromCurrentImageContext()

        // clean up
        UIGraphicsEndImageContext()

        // pass back new image
        return outImage
} 
```

用于调用此函数的说明：

```
let image: UIImage = UIImage(named: "Image.jpg")!
let squareImage: UIImage = self.squareCropImageToSideLength(image, sideLength: 320)
self.myUIImageView.image = squareImage 
```

注意：[最初用 Objective-C 编写的源代码灵感可以在“Cocoanetics”博客上找到。](http://www.cocoanetics.com/2014/07/square-cropping-images/)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-10-31T09:07:36.210

下面的代码片段可能会有所帮助。

```
import UIKit

extension UIImage {
    func cropImage(toRect rect: CGRect) -> UIImage? {
        if let imageRef = self.cgImage?.cropping(to: rect) {
            return UIImage(cgImage: imageRef)
        }
        return nil
    }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-09-25T17:06:52.980

看起来有点奇怪，但效果很好，并且考虑了图像方向：

```
var image:UIImage = ...

let img = CIImage(image: image)!.imageByCroppingToRect(rect)
image = UIImage(CIImage: img, scale: 1, orientation: image.imageOrientation) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-04-17T05:41:56.813

```
- (UIImage *)getSubImage:(CGRect) rect{
    CGImageRef subImageRef = CGImageCreateWithImageInRect(self.CGImage, rect);
    CGRect smallBounds = CGRectMake(rect.origin.x, rect.origin.y, CGImageGetWidth(subImageRef), CGImageGetHeight(subImageRef));

    UIGraphicsBeginImageContext(smallBounds.size);
    CGContextRef context = UIGraphicsGetCurrentContext();
    CGContextDrawImage(context, smallBounds, subImageRef);
    UIImage* smallImg = [UIImage imageWithCGImage:subImageRef];
    UIGraphicsEndImageContext();

    return smallImg;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-01-22T09:28:22.360

```
 (UIImage *)squareImageWithImage:(UIImage *)image scaledToSize:(CGSize)newSize {
    double ratio;
    double delta;
    CGPoint offset;

    //make a new square size, that is the resized imaged width
    CGSize sz = CGSizeMake(newSize.width, newSize.width);

    //figure out if the picture is landscape or portrait, then
    //calculate scale factor and offset
    if (image.size.width > image.size.height) {
        ratio = newSize.width / image.size.width;
        delta = (ratio*image.size.width - ratio*image.size.height);
        offset = CGPointMake(delta/2, 0);
    } else {
        ratio = newSize.width / image.size.height;
        delta = (ratio*image.size.height - ratio*image.size.width);
        offset = CGPointMake(0, delta/2);
    }

    //make the final clipping rect based on the calculated values
    CGRect clipRect = CGRectMake(-offset.x, -offset.y,
                                 (ratio * image.size.width) + delta,
                                 (ratio * image.size.height) + delta);

    //start a new context, with scale factor 0.0 so retina displays get
    //high quality image
    if ([[UIScreen mainScreen] respondsToSelector:@selector(scale)]) {
        UIGraphicsBeginImageContextWithOptions(sz, YES, 0.0);
    } else {
        UIGraphicsBeginImageContext(sz);
    }
    UIRectClip(clipRect);
    [image drawInRect:clipRect];
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return newImage;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-06-27T18:26:33.943

**Swift 2.0 更新（`CIImage`兼容性）**

扩展[Maxim 的答案](https://stackoverflow.com/a/25824454/409958)，但如果您的图像是`CIImage`基于的，也可以使用。

```
public extension UIImage {
    func imageByCroppingToRect(rect: CGRect) -> UIImage? {
        if let image = CGImageCreateWithImageInRect(self.CGImage, rect) {
            return UIImage(CGImage: image)
        } else if let image = (self.CIImage)?.imageByCroppingToRect(rect) {
            return UIImage(CIImage: image)
        }
       return nil
   }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-06-28T11:53:01.387

关注@Arne 的回答。我只是固定到类别功能。把它放在 UIImage 的类别中。

```
-(UIImage*)cropImage:(CGRect)rect{

    UIGraphicsBeginImageContextWithOptions(rect.size, false, [self scale]);
    [self drawAtPoint:CGPointMake(-rect.origin.x, -rect.origin.y)];
    UIImage* cropped_image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return cropped_image;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-06-13T11:16:56.927

斯威夫特 5：

```
extension UIImage {
    func cropped(rect: CGRect) -> UIImage? {
        guard let cgImage = cgImage else { return nil }

        UIGraphicsBeginImageContextWithOptions(rect.size, false, 0)
        let context = UIGraphicsGetCurrentContext()

        context?.translateBy(x: 0.0, y: self.size.height)
        context?.scaleBy(x: 1.0, y: -1.0)
        context?.draw(cgImage, in: CGRect(x: rect.minX, y: rect.minY, width: self.size.width, height: self.size.height), byTiling: false)

        let croppedImage = UIGraphicsGetImageFromCurrentImageContext()
        UIGraphicsEndImageContext()

        return croppedImage
    }
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-04-24T03:36:23.943

这是基于[Noodles](https://stackoverflow.com/a/38060768/235808)答案的更新 Swift 3 版本

```
func cropping(to rect: CGRect) -> UIImage? {

    if let cgCrop = cgImage?.cropping(to: rect) {
        return UIImage(cgImage: cgCrop)
    }
    else if let ciCrop = ciImage?.cropping(to: rect) {
        return UIImage(ciImage: ciCrop)
    }

    return nil
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-01-29T02:14:54.343

在 iOS9.2SDK 上，我使用下面的方法将帧从 UIView 转换为 UIImage

```
-(UIImage *)getNeedImageFrom:(UIImage*)image cropRect:(CGRect)rect
{
  CGSize cropSize = rect.size;
  CGFloat widthScale = image.size.width/self.imageViewOriginal.bounds.size.width;
  CGFloat heightScale = image.size.height/self.imageViewOriginal.bounds.size.height;
  cropSize = CGSizeMake(rect.size.width*widthScale, 
              rect.size.height*heightScale);
  CGPoint pointCrop = CGPointMake(rect.origin.x*widthScale,
             rect.origin.y*heightScale);
  rect = CGRectMake(pointCrop.x, pointCrop.y, cropSize.width, cropSize.height);
  CGImageRef subImage = CGImageCreateWithImageInRect(image.CGImage, rect);
  UIImage *croppedImage = [UIImage imageWithCGImage:subImage];
  CGImageRelease(subImage);

  return croppedImage;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-01-10T10:28:47.477

我对其他解决方案不满意，因为它们要么绘制了几次（使用了不必要的功率），要么有方向问题。这是我从 UIImage * 图像中用于缩放正方形croppedImage 的内容。

```
CGFloat minimumSide = fminf(image.size.width, image.size.height);
CGFloat finalSquareSize = 600.;

//create new drawing context for right size
CGRect rect = CGRectMake(0, 0, finalSquareSize, finalSquareSize);
CGFloat scalingRatio = 640.0/minimumSide;
UIGraphicsBeginImageContext(rect.size);

//draw
[image drawInRect:CGRectMake((minimumSide - photo.size.width)*scalingRatio/2., (minimumSide - photo.size.height)*scalingRatio/2., photo.size.width*scalingRatio, photo.size.height*scalingRatio)];

UIImage *croppedImage = UIGraphicsGetImageFromCurrentImageContext();

UIGraphicsEndImageContext(); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-01-29T13:01:10.813

我使用下面的方法。

```
 -(UIImage *)getNeedImageFrom:(UIImage*)image cropRect:(CGRect)rect
  {
    CGSize cropSize = rect.size;
    CGFloat widthScale =  
    image.size.width/self.imageViewOriginal.bounds.size.width;
    CGFloat heightScale = 
    image.size.height/self.imageViewOriginal.bounds.size.height;
    cropSize = CGSizeMake(rect.size.width*widthScale,  
    rect.size.height*heightScale);
    CGPoint  pointCrop = CGPointMake(rect.origin.x*widthScale, 
    rect.origin.y*heightScale);
    rect = CGRectMake(pointCrop.x, pointCrop.y, cropSize.width, 
    cropSize.height);
    CGImageRef subImage = CGImageCreateWithImageInRect(image.CGImage, rect);
    UIImage *croppedImage = [UIImage imageWithCGImage:subImage];
    CGImageRelease(subImage);
    return croppedImage; 
```

}

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-10-28T07:33:59.367

看看[https://github.com/vvbogdan/BVCropPhoto](https://github.com/vvbogdan/BVCropPhoto)

```
- (UIImage *)croppedImage {
    CGFloat scale = self.sourceImage.size.width / self.scrollView.contentSize.width;

    UIImage *finalImage = nil;
    CGRect targetFrame = CGRectMake((self.scrollView.contentInset.left + self.scrollView.contentOffset.x) * 比例，
            (self.scrollView.contentInset.top + self.scrollView.contentOffset.y) * 比例，
            self.cropSize.width * 比例，
            self.cropSize.height * 比例）；

    CGImageRef contextImage = CGImageCreateWithImageInRect([[self imageWithRotation:self.sourceImage] CGImage], targetFrame);

    如果（上下文图像！= NULL）{
        finalImage = [UIImage imageWithCGImage:contextImage
                                         规模：self.sourceImage.scale
                                   方向：UIImageOrientationUp];

        CGImageRelease(contextImage);
    }

    返回最终图像；
}

- (UIImage *)imageWithRotation:(UIImage *)image {

    if (image.imageOrientation == UIImageOrientationUp) 返回图片；
    CGAffineTransform 变换 = CGAffineTransformIdentity;

    开关（image.imageOrientation）{
        案例 UIImageOrientationDown：
        案例 UIImageOrientationDownMirrored：
            变换 = CGAffineTransformTranslate（变换，image.size.width，image.size.height）；
            变换 = CGAffineTransformRotate（变换，M_PI）；
            休息;

        案例 UIImageOrientationLeft：
        案例 UIImageOrientationLeftMirrored：
            变换 = CGAffineTransformTranslate(变换, image.size.width, 0);
            变换 = CGAffineTransformRotate（变换，M_PI_2）；
            休息;

        案例 UIImageOrientationRight：
        案例 UIImageOrientationRightMirrored：
            变换 = CGAffineTransformTranslate(变换, 0, image.size.height);
            变换 = CGAffineTransformRotate（变换，-M_PI_2）；
            休息;
        案例 UIImageOrientationUp：
        案例 UIImageOrientationUpMirrored：
            休息;
    }

    开关（image.imageOrientation）{
        案例 UIImageOrientationUpMirrored：
        案例 UIImageOrientationDownMirrored：
            变换 = CGAffineTransformTranslate(变换, image.size.width, 0);
            变换 = CGAffineTransformScale(变换, -1, 1);
            休息;

        案例 UIImageOrientationLeftMirrored：
        案例 UIImageOrientationRightMirrored：
            变换 = CGAffineTransformTranslate(变换, image.size.height, 0);
            变换 = CGAffineTransformScale(变换, -1, 1);
            休息;
        案例 UIImageOrientationUp：
        案例 UIImageOrientationDown：
        案例 UIImageOrientationLeft：
        案例 UIImageOrientationRight：
            休息;
    }

    // 现在我们将底层的 CGImage 绘制到一个新的上下文中，应用变换
    // 上面计算。
    CGContextRef ctx = CGBitmapContextCreate(NULL, image.size.width, image.size.height,
            CGImageGetBitsPerComponent(image.CGImage), 0,
            CGImageGetColorSpace(image.CGImage),
            CGImageGetBitmapInfo(image.CGImage));
    CGContextConcatCTM(ctx, 变换);
    开关（image.imageOrientation）{
        案例 UIImageOrientationLeft：
        案例 UIImageOrientationLeftMirrored：
        案例 UIImageOrientationRight：
        案例 UIImageOrientationRightMirrored：
            // 嘎嘎...
            CGContextDrawImage(ctx, CGRectMake(0, 0, image.size.height, image.size.width), image.CGImage);
            休息;

        默认：
            CGContextDrawImage(ctx, CGRectMake(0, 0, image.size.width, image.size.height), image.CGImage);
            休息;
    }

    // 现在我们只是从绘图上下文中创建一个新的 UIImage
    CGImageRef cgimg = CGBitmapContextCreateImage(ctx);
    UIImage *img = [UIImage imageWithCGImage:cgimg];
    CGContextRelease(ctx);
    CGImageRelease(cgimg);
    返回图片；

}

```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-12-08T02:50:24.573

**斯威夫特 5.0 更新**

```
public extension UIImage {
    func cropped(rect: CGRect) -> UIImage? {
        if let image = self.cgImage!.cropping(to: rect) {
            return UIImage(cgImage: image)
        } else if let image = (self.ciImage)?.cropped(to: rect) {
            return UIImage(ciImage: image)
        }
       return nil
   }
} 
```

# vba - 将 Word 2003 自定义宏工具栏迁移到 Word 2007 的最简单方法是什么？

> ID：158930
> 
> 赞同：1
> 
> 时间：2008-10-01T18:08:45.703
> 
> 标签：vba, ms-word, word-2007

我有一系列为 Word 2003 开发的宏和工具栏。现在我的办公室正在升级到 Word 2007，我需要迁移它们。宏本身迁移零努力，但工具栏是一个不同的问题。工具栏的一个随机子集显示在“加载项”功能区选项卡中，但我还没有找到控制哪些工具栏的方法。

可能有点复杂的是，我通过将模板放入用户的 Word STARTUP 文件夹（C:\Documents and Settings\username\Application Data\Microsoft\Word\STARTUP）来部署宏。虽然我可以将 normal.dot 中的宏添加到快速访问工具栏中，但我无法从该启动模板中添加宏。无论如何，我想要一个更好、更结构化的布局。

那么，在 Word 2007 中复制我的自定义宏工具栏的最简单方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T13:44:54.367

我为 Word 2003 开发的宏和工具栏位于许多 .dot 文件中。我只是将这些 .dot 文件放入我的 Startup 文件夹中。我重新启动了 Word'07，这些宏工具栏出现在加载项功能区中。

祝你好运

# actionscript-3 - 在 Actionscript 3 中查找前 3 个最接近的目标

> ID：158933
> 
> 赞同：2
> 
> 时间：2008-10-01T18:09:09.337
> 
> 标签：actionscript-3, actionscript

我有一个点字符数组，我想获取任何字符并能够遍历该数组并找到最接近的前 3 个（使用 Point.distance）邻居。谁能给我一个如何做到这一点的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T19:27:28.697

这是我昨晚发布的代码的新改进版本。它由两个类组成，PointTester 和 TestCase。这次我也可以测试它了！

**我们从 TestCase.as 开始**

```
package  {

    import flash.geom.Point;
    import flash.display.Sprite;

    public class TestCase extends Sprite {

        public function TestCase() {
            // some data to test with
            var pointList:Array = new Array();
            pointList.push(new Point(0, 0));
            pointList.push(new Point(0, 0));
            pointList.push(new Point(0, 0));
            pointList.push(new Point(1, 2));
            pointList.push(new Point(9, 9));

            // the point we want to test against
            var referencePoint:Point = new Point(10, 10);

            var resultPoints:Array = PointTester.findClosest(referencePoint, pointList, 3);

            trace("referencePoint is at", referencePoint.x, referencePoint.y);
            for each(var result:Object in resultPoints) {
                trace("Point is at:", result.point.x, ", ", result.point.y, " that's ", result.distance, " units away");
            }
        }

    }

} 
```

**这将是 PointTester.as**

```
package  {

    import flash.geom.Point;

    public class PointTester {

        public static function findClosest(referencePoint:Point, pointList:Array, maxCount:uint = 3):Array{

            // this array will hold the results
            var resultList:Array = new Array();

            // loop over each point in the test data
            for each (var testPoint:Point in pointList) {

                // we store the distance between the two in a temporary variable
                var tempDistance:Number = getDistance(testPoint, referencePoint);

                // if the list is shorter than the maximum length we don't need to do any distance checking
                // if it's longer we compare the distance to the last point in the list, if it's closer we add it
                if (resultList.length <= maxCount || tempDistance < resultList[resultList.length - 1].distance) {

                    // we store the testing point and it's distance to the reference point in an object
                    var tmpObject:Object = { distance : tempDistance, point : testPoint };
                    // and push that onto the array
                    resultList.push(tmpObject);

                    // then we sort the array, this way we don't need to compare the distance to any other point than
                    // the last one in the list
                    resultList.sortOn("distance", Array.NUMERIC );

                    // and we make sure the list is kept at at the proper number of entries
                    while (resultList.length > maxCount) resultList.pop();
                }
            }

            return resultList;
        }

        public static function getDistance(point1:Point, point2:Point):Number {
            var x:Number = point1.x - point2.x;
            var y:Number = point1.y - point2.y;
            return Math.sqrt(x * x + y * y);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-06T07:24:26.353

值得一提的是，如果点的数量足够大，以使性能变得重要，那么可以通过保留两个点列表来更快地实现目标，一个按 X 排序，另一个按 Y 排序。然后可以找到通过循环遍历每个点，在 O(logn) 时间内而不是 O(n) 时间内最接近的 3 个点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T21:13:22.860

如果您使用grapefrukt 的解决方案，您可以将getDistance 方法更改`return x*x + y*y;`为`return Math.sqrt( x * x + y * y );`

# java - 为什么我无法在 Java 中解析具有模式“MMMMM dd”的 SimpleDateFormat？

> ID：158935
> 
> 赞同：4
> 
> 时间：2008-10-01T18:09:22.003
> 
> 标签：java, parsing, date

我需要将像“February 12, 1981”这样的字符串解析为日期。我使用[SimpleDateFormat](http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html)。但如果我这样做：

```
new SimpleDateFormat("MMMMM dd, yyyy").parse("February 12, 1981") 
```

我得到 java.text.ParseException。

我试图减少它以查看问题所在。第一的：

```
new SimpleDateFormat("MMMMM").parse("February") 
```

作品。然后：

```
new SimpleDateFormat("MMMMM dd").parse("February 12") 
```

不再起作用了。有谁知道为什么？我也试过了`new SimpleDateFormat("MMMMM' 'dd")`。

我正在使用 JRE 1.6.0_06。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T18:13:24.677

您使用的是什么版本的 JDK/JRE？

这对我来说适用于 1.4.2_14、1.5.0_16 和 1.6.0_07：

```
SimpleDateFormat df = new SimpleDateFormat("MMMMM dd, yyyy");
Date parsed = df.parse("February 12, 1981");
System.out.println(parsed); 
```

输出：

> 1981 年 2 月 12 日星期四 00:00:00 EST

# vim - 在 Vim 中重置缓冲区

> ID：158940
> 
> 赞同：4
> 
> 时间：2008-10-01T18:10:51.110
> 
> 标签：vim, buffer, keyboard-shortcuts

是否可以将 vim 会话中的备用缓冲区重置为以前的缓冲区？

备用缓冲区是指# 所指的缓冲区，即输入cntl-^ 时显示的缓冲区。

假设我打开了两个文件 main.c 和 other.c 并且 :ls 给了我：

```
 1 %a   "main.c"              lines 27
  2 #    "other.c"             lines 56 
```

假设我打开另一个文件，例如refer.c， :ls 现在会给我：

```
 1 %a   "main.c"              lines 27
  2      "other.c"             lines 56
  3 #    "refer.c"             lines 125 
```

如果我删除包含 refer.c 的缓冲区， :ls 现在会显示：

```
 1 %a   "main.c"              lines 27
  2      "other.c"             lines 56 
```

但是如果我做一个cntl-^，refer.c会再次显示！

有没有办法让 vim 将备用缓冲区自动重置回上次的状态？备用缓冲区的“历史”？

还是我坚持做 a :2 b 将 other.c 重新加载到备用缓冲区？

或者也许这种行为有充分的理由？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T18:43:17.773

在这种情况下，“alternate”只是意味着“previous”。所以，是的，:b2（或 2 ctrl-6）可能是更改哪两个缓冲区将由 ctrl-6 切换的最简单方法。

另外，看看 :keepalt 命令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-03-18T00:56:41.330

正如您对 Vim 所期望的那样，这种行为是有充分理由的。`:bd`（缓冲区删除的助记符）不会*删除*缓冲区，它本身*会从主缓冲区列表中删除它*！

如果您尝试`:ls!`，否则`:buffers!`您将看到它仍然可用，但与`u`它的缓冲区号相邻，表示它现在是“未列出的”（即，除非您用感叹号列出它，否则它是未列出的！）。

我让它听起来尽可能可怕，但与大多数 Vim 一样，一旦你理解它就可以工作，并且使用感叹号/砰来强制命令是一致的。

要完全摆脱缓冲区，您*需要*使用`:bw`. 当你这样做了，你仍然会遇到同样的问题，但是这一次，尝试切换到备用缓冲区`CTRL-^`将会引发`No alternate file`（因为这次它*真的*已经消失了）。

要切换到您想要的文件，是的，使用缓冲区号：`:b2`，或者您想要的文件的任何缓冲区号，这将建立一个新的备用缓冲区。

我发现记住缓冲区编号或查找它们很容易，`:buffers`或者`:buffers!`非常快速，当然更改为它们很快，但当然 Vim 中有一系列技术可以更改缓冲区，尤其是*标记*。

您还在这里发现了另一个很棒的 Vim 特性，未列出的缓冲区。当您处理一些额外的文件时，有时使用 将它们从`:buffers`列表中“删除”会很有帮助`:bd`，只是为了让它们看不见，但是虽然隐藏它们不可用，您可以检查您想要的文件`:buffers!`和然后`:b<num>`将其拉起，而无需取消删除它或其他任何东西。

# version-control - TFS 签入 RSS 提要

> ID：158941
> 
> 赞同：10
> 
> 时间：2008-10-01T18:10:58.223
> 
> 标签：version-control, tfs, rss

如何生成 Team Foundation Server 提交消息的 RSS 源？

在 Visual Studio 的源代码管理资源管理器中，“查看历史记录”选项会生成一个漂亮的 GUI 视图。同样，命令行

```
tf history /recursive /stopafter:40 . 
```

产生一个漂亮的*GUI*视图。我想要一个 RSS 提要，它可以提供相同或相似的信息——甚至是一种从 TFS 中提取一些文本的方法，我可以将这些文本重新组合成 RSS。

这类似于问题[Sending SVN commits to an RSS feed](https://stackoverflow.com/questions/125028/sending-svn-commits-to-an-rss-feed)，但我确实可以控制私有 TFS 存储库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T20:34:56.073

[格兰特回答](https://stackoverflow.com/questions/158941/tfs-checkin-rss-feed#159917)中的一个链接似乎比[原始页面](http://blogs.msdn.com/abhinaba/archive/2005/12/21/506277.asp)更好。它包含 ASPX 文件的源代码，该文件生成 TFS 签入的 RSS 提要，该提要返回有关最近 N 个签入的信息：

[http://blogs.msdn.com/jefflu/archive/2005/07/27/443900.aspx](http://blogs.msdn.com/jefflu/archive/2005/07/27/443900.aspx)

我还没有尝试过，它似乎没有包含签入注释，从我的角度来看，这是最重要的部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T21:50:14.797

[http://blogs.msdn.com/abhinaba/archive/2005/12/21/506277.aspx](http://blogs.msdn.com/abhinaba/archive/2005/12/21/506277.aspx)

# rss - 将其他人的 RSS 提要重新打包到新的演示文稿中的合法性是什么？

> ID：158943
> 
> 赞同：4
> 
> 时间：2008-10-01T18:11:34.293
> 
> 标签：rss

我知道像 my.yahoo.com 这样的服务允许您将来自 RSS 提要的内容添加到您的个人页面，但一般来说，它们是吸引用户到提供提要的站点的链接。使用 RSS 提要作为网站数据源的合法性和影响是什么，该网站重新打包数据以使其无法识别它来自所述来源。

* * *

是否需要给予信用？是不是侵犯版权？什么是道德？

* * *

如果注明信用怎么办？这会改变你的看法吗？是否需要授予权限？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T18:38:05.397

当然是道德的！如果不是为了联合，RSS 到底是为了什么，可以变成开发人员能想到的尽可能多的精彩形式？

当然，必须以“ `GET /feed/ HTTP 1.0`”的形式请求许可。它必须以“ ”的形式授予`200 OK`- 或以“ ”的形式拒绝`403 Forbidden`。

屏幕抓取至少在道德上是模棱两可的，因为也许作者只希望人类而不是程序来查看内容（假设您认为作者有权做出这种区分）。但是RSS？严重地？没有人强迫任何人为其内容制作一种联合的、易于修改的格式。它不仅*适用*于新的演示文稿，而且*适用*于它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T18:31:08.927

在我看来，这取决于数据源公司是否在其条款和条件中允许这样做。它可能还取决于您的服务器所在的位置（即它们属于哪个法律框架。）

除非明确允许或您有书面同意，否则我认为这是不道德的。

这还取决于您的法律部门有多大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T18:21:07.203

好吧，撇开合法性不谈，不相信来源是不道德的。美联社例如[想要信用](http://www.ap.org/pages/contact/contact_perm.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T18:27:22.397

我会说在不给予信任的情况下发表他人的作品肯定会导致诉讼，或者至少会导致措辞强硬的停止和终止信函（随后是诉讼）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T18:36:32.017

您提议的内容与 my.yahoo.com、Netvibes、Bloglines、Google Reader 等服务之间的区别在于，**您是选择提要的人**，而对于其他服务**，用户指定提要**，因此知道它的原始来源。

尽管内容是在提要中发布的，因此预计会与我上面提到的服务一起使用，**但发布者仍然保留其内容的版权**，并且通常希望它按原样重新发布。习惯上还提供**指向内容原始来源的链接，**并且在没有它的情况下重新发布内容至少会令人不悦。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T18:11:01.290

我一直在想同样的事情，并且非常犹豫是否要重新发布 RSS 提要[FeedForAll](http://www.feedforall.com/rss-copyright-debate.htm)说复制内容没有固有的权利。您是在问是否可以破坏内容，我很确定即使复制内容也不行。我认为这就像把

`<iframe src='www.stackoverflow.com'> </iframe>`

在我的网站上。

顺便提一句。这不是一个主观问题，这很重要。我会重新提出这个问题或编辑标题并获得更多相关反馈。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T18:19:18.407

和你的律师谈谈。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T18:32:31.263

从[美联社的 RSS 网站](http://hosted.ap.org/dynamic/fronts/RSS?SITE=AP&SECTION=HOME)...

AP 根据以下条款和条件将这些 RSS 提要提供给个人用于个人非商业用途。所有其他人，包括美联社成员或新闻协会订阅者，必须在使用这些 RSS 提要之前获得明确的书面许可。AP 免费为您提供这些 RSS 提要，供您个人、非商业用途使用。您同意不将 RSS 提要与任何可能损害美联社声誉的内容相关联。美联社“按原样”提供此内容，美联社不对您使用信息或提要承担责任。在允许的最大范围内，美联社否认所有保证，包括对适销性、非侵权性和特定用途适用性的保证。您同意仅将 RSS 提要用于提供标题，每个都具有指向相关 AP 故事的功能链接，该链接应立即显示完整内容（例如，没有跳转页面或其他中间或插页式页面）。您进一步同意不构筑或以其他方式控制打开 AP 内容的浏览器窗口（如果有），包括限制此类窗口的大小或位置。您同意在合理接近您使用 RSS 提要的情况下向美联社提供适当的署名，并且您同意您不会修改 RSS 提要中提供的标题、摘要和其他信息的格式或品牌。RSS 提要可能不会被第三方 RSS 提供商拼接或以其他方式重新分发。不得将任何内容（包括任何广告或其他促销内容）添加到 RSS 提要中。美联社保留反对您展示 RSS 提要的权利，并有权随时要求您停止使用 RSS 提要。AP 进一步保留随时终止其 RSS 源分发或更改 RSS 源的内容或格式的权利，恕不另行通知。通过访问此处提供的 RSS 提要或 XML 说明，您表示您理解并同意这些条款和条件。注意：如果您没有资格使用本许可下的 RSS 提要，或者是 AP 成员或新闻协会订阅者并希望使用这些提要，请联系 AP Digital。AP 进一步保留随时终止其 RSS 源分发或更改 RSS 源的内容或格式的权利，恕不另行通知。通过访问此处提供的 RSS 提要或 XML 说明，您表示您理解并同意这些条款和条件。注意：如果您没有资格使用本许可下的 RSS 提要，或者是 AP 成员或新闻协会订阅者并希望使用这些提要，请联系 AP Digital。AP 进一步保留随时终止其 RSS 源分发或更改 RSS 源的内容或格式的权利，恕不另行通知。通过访问此处提供的 RSS 提要或 XML 说明，您表示您理解并同意这些条款和条件。注意：如果您没有资格使用本许可下的 RSS 提要，或者是 AP 成员或新闻协会订阅者并希望使用这些提要，请联系 AP Digital。[链接文本](http://hosted.ap.org/dynamic/fronts/RSS?SITE=AP&SECTION=HOME)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T18:36:40.533

来自[路透社 RSS 网站](http://www.reuters.com/tools/rss)...

路透社将 RSS 作为免费服务提供给任何个人用户或非营利组织，但须遵守以下条款和条件：

使用将用于非商业目的。使用仅限于提供功能链接的平台，允许在 Reuters.com 平台上立即显示完整的文章或视频，如提要中指定的那样。使用伴随着对路透社作为来源的适当归属。

通过访问我们的 RSS 服务，您表示您理解并同意您不会在违反上述条件的情况下使用路透社 RSS。路透社保留随时终止此服务的权利，并进一步保留要求立即停止对其 RSS 服务的任何特定使用的权利。

如果您想为您的商业网站获取路透社新闻，请访问 about.reuters.com/media。

# apache-flex - 老派 Flash 开发人员应该什么时候使用 flex？

> ID：158954
> 
> 赞同：10
> 
> 时间：2008-10-01T18:15:11.087
> 
> 标签：apache-flex, flash, actionscript-3, mxml

Flash 和 Flex 之间的主要区别是什么？我有超过五年的 flash 经验，并且对使用它和 ActionScript3 进行开发感到非常自在。我发现自己对 Flex 越来越好奇，想知道什么时候最好使用 flash 或 flex。另外，是不是所有可以用 MXML 完成的事情，都可以用 AS3 完成？我对 AS3 和 OOP 有深入的了解，并且想知道在 Flex 中使用 AS3 和 MXML 之间的区别。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T19:52:47.950

这取决于您现在使用 Flash 开发的应用程序类型。我从事 Flash 开发人员（主要是应用程序）已有 7 年了。我必须诚实地说，当 Flex 2 发布时我非常高兴，因为它具有我在 Flash 中没有的组件框架（好的组件、布局管理器……）。这是 IMO 与 Flash 和 Flex（或 Flex 框架）的最大区别。

MXML 是真正的福音，尤其是在使用数据绑定时。最后，一切都被编译成 ActionScript（检查 -keep 编译器选项），但 MXML 只是为您节省了很多时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-02T00:09:38.423

如果您想快速构建 UI，Flex 非常棒，您可以在几个小时内模拟一个功能正常的 UI。由于它仍然可以限制某些自定义 UI，因此它并不适合所有内容，但如果某些东西“看起来”或多或少像一个应用程序并适合网格，那么在 MXML 中模拟 UI 非常快速。也不要被大多数 Flex 应用程序的外观所吓倒（丑陋，imo），您可以自定义所有内容或轻松创建自己的组件。

将 actionscript 放入 mxml 与将 css 或 javascript 放入 html = 非常糟糕。不幸的是，即使是 Adob​​e 在多个示例中也有这个（可能主要是因为它更容易和更快地进行演示）。我个人认为这也适用于绑定，因为我不想将我的数据放在 UI (mxml) 中。

作为一名经验丰富的开发人员，我确信您不会在时间线上进行任何开发（以澄清 Flash = 时间线的误解）。仍然使用 Flex，您可以将 UI 分离在一个框架中，该框架可以处理大量布局负担，以便您可以专注于业务逻辑。工作流程的其余部分与您可能已经使用 Flash 的工作流程很接近。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T18:25:22.403

Flash 和 Flex 提供了不同的方法来生产不同的东西。我不熟悉 Flash，但我希望它依赖于以时间为导向的方式来生产某些东西，而 Flex 则面向更传统的软件开发。也就是说，不是处理 Flash 中的时间和帧，而是处理描述应使用 MXML 放置组件的位置以及这些组件如何与 ActionScript 一起工作。

还应该能够仅使用 AS3 而无需 MXML 编写 Flex 应用程序。

据我所知，Flex 中 AS3 和 MXML 之间的主要区别在于，MXML 并非旨在与应用程序逻辑一起使用，而是旨在像 HTML/CSS 一样在网页中使用，并将组件和内容放在Flex 应用程序。ActionScript 用于对行为、组件和其他外部事物或 MXML 所做的事情进行编程。因此，如果您想将一个事件附加到一个组件上，就需要编写 ActionScript 代码。

希望有帮助。我自己还在学习 Flex。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:31:00.093

想到的其他一些差异：

Flash 允许您创建图形资源，然后立即使用它们。要在 Flex 中使用这些相同的东西，您需要先使用 Flash 将它们导出到 swf 或 swc。

Flex 有一个布局管理器，因此具有可变窗口大小的应用程序更容易制作。例如，您可以取一个窗口并将其设置为窗口的 90% 宽度，它会改变大小......不要介意缩放，但实际上会随着窗口变大或变小而改变它的宽度。这在 Flex 框架之外并不容易。

Flex 中的数据绑定可以节省大量时间。它基本上通过简单地说 blah="{foo}" 来创建您需要在 AS3 中编写的所有代码。花括号表示“绑定到 this”。

Flex 调试器大大优于 Flash 调试器。还有一个 Profiler。

由于我从 Flex 而不是 Flash 开始，我不确定哪种 IDE 最适合 Flash 开发，但基于 Eclipse 的 Flex Builder 非常好。代码提示很棒。子剪辑集成很棒。

真的，Flash 和 Flex 是不同的野兽。如果您想使用 Flex，您应该了解并了解 AS3，而且既然您这样做了，那么您就可以充分利用 Flex 的功能。Flash 作为一种制作更具视觉创意的作品的工具没有任何意义，但 Flex 为应用程序开发提供了很多优势。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-06T04:44:14.397

我更喜欢 Flash IDE 与 Flex（我的评论又名 Flex Builder 又名 Flash Builder）

一般来说，我会说这取决于项目的规模。

我发现在 Flash 中快速启动和完成小型项目更容易。

我会建议 Flex 用于大型项目，因为它具有各种调试工具，可以为您节省大量时间（尽管我仍然会自己使用 Flash）

但也许如果你真的习惯了弯曲，那可能并不重要。

根据我的经验，Flex 的一些缺点。

*   在一个 4 人的团队中进行大型项目时，Flex 未能保留该项目
*   设置从一台计算机到另一台。（我们使用 SVN 共享文件）
*   对于我们来说，Flex 经常与 SVN 发生冲突。
*   我觉得远离艺术资产。

Flex的一些优点

*   只需单击一个按钮，就可以跟踪从一个类到另一个类的变量引用。
*   在调试时能够很容易地看到许多变量。无需跟踪它们。
*   Flash 过去没有自定义类代码提示，但现在有了 CS5。
*   我认为您可以使用 Flash Player 的最新功能而无需等待新的 Flash CS#，例如 MoleHill（一种使用 GPU 的新 3d api）现在已经发布了测试版。我认为 Flex SDK 已经可以使用它了。希望这可以帮助。

需要注意的是，我是一个不喜欢 flex 的罕见案例，大多数人都非常喜欢 flex，所以你至少应该尝试一下。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:26:51.243

MXML 编译为动作脚本，所以它真的是一个更高级别的版本。所以，是的，可以用 MXML 完成的所有事情都可以用 actionscript 完成（但不能反过来）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-13T22:43:30.950

## 闪存 CSx：

1.  **GUI\Layout** : 基本的 GUI 类框架
2.  **图形内容**：非常适合编辑带或不带动画的图形库对象
3.  **代码**：缺乏好的代码编辑器

## Flex/Flash Builder + Flex 框架：

1.  **GUI\Layout** : 高级 GUI 类框架和布局引擎 (Flex)
2.  **图形内容**：缺乏 Flash 的绘图功能，但您可以通过将它们为 ActionScript 导出到 SWC 并在 Flash Builder 中导入/引用 SWC 来包含 Flash 生成的图形。
3.  **代码**：比 Flash 更好的代码编辑器；不确定它是否与 FlashDevelop 相当
4.  **其他**：支持 MXML，这基本上只是另一种布局内容的方式。无需编写一堆“c = new C()”、“c.prop = x”、“c.addChild”……您可以使用 XML 构造来构造显示对象及其子对象，MXML 编译器将转换它全部回到可读性较差但基本相同的 AS3 代码。

这些技术都是相关且可互操作的。它们是 Flash 播放器和 ActionScript 技术的自然且可预测的扩展，但出于某种原因，Adobe 将 Flex/Flex-builder/MXML 技术开发为一个完全独立的产品，并将其作为一种全新且令人惊叹的产品进行营销。任何。所以现在我们必须在两者之间来回切换才能使用所有的功能，这就是 LAME。他们还必须浪费时间和资源来开发不必要但很有帮助的软件包，例如“Flex 组件工具包”，以减少将 Flash 内容导入 Flash Builder 所需的步骤。

您必须在这些应用程序之间来回切换，因为它们具有相互排斥的功能——Flash Builder 缺乏图形编辑，而 Flash CSx 缺乏 MXML 和良好的代码编辑器——但它们是可互操作的，因为您可以使用 Flex Flash 中的类，Flex 中的 Flash 类（及其嵌入的图形），您可以在没有 Flex 的情况下使用 Flash Builder 和 MXML 等。

我认为他们需要一个真正集成的单一 Flash IDE，因此他们需要将 Flash Builder 合并到 Flash CSx 编辑器中。

# c# - 在 C# 和 SQL Server 中，我应该使用哪些类型来表示百分比？

> ID：158966
> 
> 赞同：24
> 
> 时间：2008-10-01T18:17:02.157
> 
> 标签：c#, sql-server

我在想花车。作为记录，我也在使用 NHibernate。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-01T18:18:31.373

`decimal`

你不会因为四舍五入而失去精度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T18:50:23.497

答案取决于应用程序。

其他人指出，在表示精确值方面，十进制优于浮点数。但有时最好使用浮点数来提高精度（例如，一组计算的权重加起来为 100% 可能更好地表示为浮点数）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T18:19:11.310

这取决于您需要的准确度。如果您不需要任何小数位，您甚至可以使用 tiny int。但是，如果您需要一些小数位，通常浮点数是好的。我使用 LLBLGen 并为 %'s 浮动

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T18:36:24.420

这在很大程度上取决于您需要多少精度；最重要的是要保持一致和清晰。采取预防措施以确保您在整个字段的使用中保持一致。即不要将其存储为浮点数 (n = .5)，然后尝试将其重构为代码的另一部分中的整数（mypercentage = n/100)。只要您确保不这样做并且您不是在构建需要 30 位有效数字精度的激光器，只需在 int、double 或任何您的船的*浮动之间选择您最喜欢的口味。*瓦卡瓦卡。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T18:29:30.257

对于 SQL Server，我很少存储百分比。10 次中有 9 次您希望存储用于导出百分比并根据需要计算的数据。

当且仅当您有经验数据显示计算太慢时，请继续存储它。如前所述使用小数以避免四舍五入问题。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-01T18:20:34.223

这取决于您使用它们的目的。

如果是为了显示，int 就可以了，而且比浮点数快。如果它是用于不经常使用的数学，那么 int 仍然可以正常工作（或者在任何一种情况下都可以是短的）。

如果您要进行大量数学运算，那么从性能角度来看，浮点数可能是最好的。

当然，除非您对百分比进行大量操作，否则考虑到现代处理器的速度，最终在性能方面并不重要。

编辑：当然，'int' 假设您只是使用严格的整数百分比。如果不是，那么使用 float 或 dec 总是会更好。

# file - 按文件类型更改 Vim 缩进行为

> ID：158968
> 
> 赞同：417
> 
> 时间：2008-10-01T18:17:44.730
> 
> 标签：file, vim, settings, indentation

有人可以简单地向我解释根据文件类型更改 Vim 缩进行为的最简单方法吗？例如，如果我打开一个 Python 文件，它应该缩进 2 个空格，但如果我打开一个 Powershell 脚本，它应该使用 4 个空格。

* * *

## 回答 #1

> 赞同：330
> 
> 时间：2008-10-01T18:37:48.037

您可以添加`.vim`要在 vim 切换到特定文件类型时执行的文件。

例如，我有一个`~/.vim/after/ftplugin/html.vim` 包含以下内容的文件：

```
setlocal shiftwidth=2
setlocal tabstop=2 
```

这导致 vim 使用宽度为 2 个字符的制表符进行缩进（该`noexpandtab`选项在我的配置中的其他地方全局设置）。

此处对此进行了描述：http: [//vimdoc.sourceforge.net/htmldoc/usr_05.html#05.4](http://vimdoc.sourceforge.net/htmldoc/usr_05.html#05.4)，向下滚动到文件类型插件部分。

* * *

## 回答 #2

> 赞同：217
> 
> 时间：2008-10-01T18:37:42.093

使用 ftplugins 或自动命令来设置选项。

### ftplugin

在`~/.vim/ftplugin/python.vim:`

```
setlocal shiftwidth=2 softtabstop=2 expandtab 
```

并且不要忘记打开它们`~/.vimrc`：

```
filetype plugin indent on 
```

（`:h ftplugin`了解更多信息）

### 自动命令

在`~/.vimrc`：

```
autocmd FileType python setlocal shiftwidth=2 softtabstop=2 expandtab 
```

您可以将任何长命令或设置替换为其短版本：
[`autocmd`](http://vimdoc.sourceforge.net/htmldoc/autocmd.html#:autocmd): `au`
[`setlocal`](http://vimdoc.sourceforge.net/htmldoc/options.html#:setlocal): `setl`
[`shiftwidth`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27shiftwidth%27): `sw`
[`tabstop`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27tabstop%27): `ts`
[`softtabstop`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27softtabstop%27):`sts`
[`expandtab`](http://vimdoc.sourceforge.net/htmldoc/options.html#%27expandtab%27)`et`

`tabstop`我还建议学习和之间的区别`softtabstop`。很多人都不知道`softtabstop`。

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2015-05-08T00:49:59.833

编辑您的`~/.vimrc`, 并为不同的缩进添加不同的文件类型，例如我想要`html/rb`缩进 2 个空格，`js/coffee`文件缩进 4 个空格：

```
" by default, the indent is 2 spaces. 
set shiftwidth=2
set softtabstop=2
set tabstop=2

" for html/rb files, 2 spaces
autocmd Filetype html setlocal ts=2 sw=2 expandtab
autocmd Filetype ruby setlocal ts=2 sw=2 expandtab

" for js/coffee/jade files, 4 spaces
autocmd Filetype javascript setlocal ts=4 sw=4 sts=0 expandtab
autocmd Filetype coffeescript setlocal ts=4 sw=4 sts=0 expandtab
autocmd Filetype jade setlocal ts=4 sw=4 sts=0 expandtab 
```

参考：[按文件类型设置 Vim 空白首选项](https://stackoverflow.com/questions/1562633/setting-vim-whitespace-preferences-by-filetype)

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2008-10-01T18:21:31.070

根据 ~/.vimrc 中的文件后缀放置 autocmd 命令

```
autocmd BufRead,BufNewFile   *.c,*.h,*.java set noic cin noexpandtab
autocmd BufRead,BufNewFile   *.pl syntax on 
```

您正在寻找的命令可能是 ts= 和 sw=

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-10-01T18:23:34.653

我通常使用`expandtab`set，但这对 makefile 不利。我最近补充说：

```
:autocmd FileType make set noexpandtab 
```

到我的 .vimrc 文件的末尾，它将 Makefile、makefile 和 *.mk 识别为 makefile，并且不展开选项卡。据推测，您可以扩展它。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2012-05-03T11:49:50.897

就个人而言，我在 .vimrc 中使用这些设置：

```
autocmd FileType python set tabstop=8|set shiftwidth=2|set expandtab
autocmd FileType ruby set tabstop=8|set shiftwidth=2|set expandtab 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-03-17T19:52:58.183

这可能我们大多数人都知道，但无论如何（我第一次感到困惑）：做`:set et`（`:set`expandtabs）不会更改文件中已经存在的选项卡，一个必须做的事情`:retab`。例如：

```
:set et
:retab 
```

并且文件中的制表符被足够的空格替换。要返回标签，只需执行以下操作：

```
:set noet
:retab 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-02-29T22:14:55.520

对于那些使用`autocmd`的人，最好将它们组合在一起。如果分组与文件类型检测有关，您可能会有这样的情况：

```
augroup filetype_c
    autocmd!
    :autocmd FileType c setlocal tabstop=2 shiftwidth=2 softtabstop=2 expandtab
    :autocmd FileType c nnoremap <buffer> <localleader>c I/*<space><esc><s-a><space>*/<esc>
augroup end 
```

分组有助于保持`.vimrc`井井有条，尤其是在文件类型具有与其关联的多个规则时。在上面的示例中，定义了特定于 .c 文件的注释快捷方式。

初始调用`autocmd!`告诉 vim 删除所述分组中任何先前定义的自动命令。`.vimrc`如果再次来源，这将防止重复定义。有关`:help augroup`更多信息，请参阅。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-06-02T23:15:51.583

今天，你可以试试[editorconfig](http://editorconfig.org/)，还有一个[vim 插件](https://github.com/editorconfig/editorconfig-vim)。有了这个，您不仅可以在 vim 中更改缩进大小，而且在许多其他编辑器中，保持一致的编码样式。

下面是一个简单的编辑器配置，如您所见，python 文件将有 4 个用于缩进的空格，而 pug 模板文件将只有 2 个。

```
# 4 space indentation for python files
[*.py]
indent_style = space
indent_size = 4

# 2 space indentation for pug templates
[*.pug]
indent_size = 2 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-14T20:50:48.487

虽然您可以使用缩进插件或手动使用设置来很好地配置 Vim 的缩进，但我建议使用名为[Vindect](http://freshmeat.net/projects/vindect/)的 python 脚本，它会在您打开 python 文件时自动为您设置相关设置。使用[此技巧](http://vim.wikia.com/wiki/Set_indent_parameters_for_Python_files)可以使使用 Vindect 更加有效。当我第一次开始编辑由其他人创建的具有各种缩进样式（制表符与空格和空格数）的 python 文件时，非常令人沮丧。但是 Vindect 连同[这个缩进文件](http://www.vim.org/scripts/script.php?script_id=974)

还推荐：

*   [蟒蛇助手](http://www.vim.org/scripts/script.php?script_id=435)
*   [python_match](http://www.vim.org/scripts/script.php?script_id=386)
*   [python_ifold](http://www.vim.org/scripts/script.php?script_id=2002)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-12-05T02:22:17.153

我使用了一个我用 C 语言编写的实用程序，名为[`autotab`](http://www.kylheku.com/cgit/c-snippets/tree/autotab.c). 它分析您加载的文件的前几千行并确定 Vim 参数的值`shiftwidth`，`tabstop`以及`expandtab`.

例如，这是使用`gcc -O autotab.c -o autotab`. 与 Vim 集成的说明在顶部的注释标题中。

Autotab 相当聪明，但有时会让人感到困惑，特别是使用不同的缩进样式进行不一致的维护。

如果文件明显使用制表符或制表符和空格的组合进行缩进，Autotab 将通过考虑诸如注释等连续行的内部元素对齐等因素来确定正在使用的制表符大小。

它适用于各种编程语言，并且可以容忍不服从缩进增量的“带外”元素，例如 C 预处理指令、C 语句标签，更不用说明显的空行了。

# asp.net - ASP.NET 更新面板超时

> ID：158975
> 
> 赞同：58
> 
> 时间：2008-10-01T18:18:58.237
> 
> 标签：asp.net, ajax, updatepanel

我正在发出一个`UpdatePanel`需要超过 90 秒的请求。我收到此超时错误：

> Microsoft JScript 运行时错误：Sys.WebForms.PageRequestManagerTimeoutException：服务器请求超时。

有谁知道是否有办法增加通话超时前的时间？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-01T18:31:02.607

ScriptManager 上有一个属性，允许您以秒为单位设置超时。默认值为 90 秒。

```
AsyncPostBackTimeout="300" 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2010-03-16T16:33:24.810

在我的例子中，ScriptManager 对象是在母版页文件中创建的，然后与内容页文件共享。因此，要更改内容页面中的 ScriptManager.AsyncPostBackTimeout 属性，我必须访问内容页面的 aspx.cs 文件中的对象：

```
protected void Page_Load(object sender, EventArgs e)
{
     . . . 
     ScriptManager _scriptMan = ScriptManager.GetCurrent(this);
     _scriptMan.AsyncPostBackTimeout = 36000;
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-01T18:27:14.160

这成功了（基本上只是忽略了所有超时）：

```
<script type="text/javascript"> 
        Sys.WebForms.PageRequestManager.getInstance().add_endRequest(function (sender, args) { 
            if (args.get_error() && args.get_error().name === 'Sys.WebForms.PageRequestManagerTimeoutException') { 
                            args.set_errorHandled(true); 
            } 
        }); 
    </script> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-05-21T07:28:34.407

请按照以下步骤操作：

第 1 步：在**web.config**中，设置`httpRuntime maxRequestLength="1024000" executionTimeout="999999"`

第 2 步：将以下设置添加到网页的 ScriptManager：`AsyncPostBackTimeout ="360000"`

这将解决您的问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T18:25:12.933

这可以通过更改 IIS 中的 ASP 脚本超时来配置。

它位于您网站的属性、虚拟目录、配置按钮，然后在选项选项卡上。

或通过设置 Server.ScriptTimeout 属性来设置它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T18:31:50.280

好吧，我想如果你只是想把请求扔掉，它可能永远不会完全执行……

将 AsyncPostBackTimeOut 属性添加到 ScriptManager 标记，以将默认超时时间从 90 秒更改为对您的应用程序更合理的值。

此外，请考虑更改接收呼叫的 Web 服务以更快地移动。90秒也可能是互联网时间的无穷大。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-05-30T06:52:54.093

您面临的问题是您的应用程序在 SQL 数据库查询中遇到超时。返回输出所需的时间比默认值多。所以你需要增加 ConnectionTimeout 属性。

您可以通过以下几种方式做到这一点：

1.  连接字符串有一个`ConnectionTimeout`属性。它是一个属性，用于确定您的代码将等待打开数据库连接的最大秒数。您可以在 中的连接字符串部分设置连接超时`web.config`。

    ```
    <connectionstrings>
        <add name="ConnectionString" 
             connectionstring="Database=UKTST1;Server=BRESAWN;uid="      system.data.sqlclient="/><br mode=" hold=" /><br mode=" html="> <asp:ToolkitScriptManager runat=" server=" AsyncPostBackTimeOut=" 6000="><br mode=">
        </add>
    </connectionstrings> 
    ```

2.  你可以把`AsyncPostBackTimeout="6000"`页面`.aspx`

    ```
    <asp:ToolkitScriptManager runat="server" AsyncPostBackTimeOut="6000">
    </asp:ToolkitScriptManager> 
    ```

3.  `SqlCommand`您可以在 .cs 文件中调用存储过程的地方设置超时。

    ```
    command.CommandTimeout = 30*1000; 
    ```

希望你有解决办法！

# c# - 如何使用实体框架关联来自多个上下文的对象

> ID：158986
> 
> 赞同：14
> 
> 时间：2008-10-01T18:21:08.700
> 
> 标签：c#, .net, entity-framework

我对实体框架**很**陌生，所以请多多包涵...

如何将来自不同上下文的两个对象关联在一起？

下面的示例引发以下异常：

> System.InvalidOperationException：无法定义两个对象之间的关系，因为它们附加到不同的 ObjectContext 对象。

```
void MyFunction()
{
    using (TCPSEntities model = new TCPSEntities())
    {
        EmployeeRoles er = model.EmployeeRoles.First(p=>p.EmployeeId == 123);
        er.Roles = GetDefaultRole();
        model.SaveChanges();
     }
}

private static Roles GetDefaultRole()
{
    Roles r = null;
    using (TCPSEntities model = new TCPSEntities())
    {
        r = model.Roles.First(p => p.RoleId == 1);
    }
    return r;
} 
```

使用一个上下文不是一种选择，因为我们在 ASP.NET 应用程序中使用 EF。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T18:34:15.970

您将不得不使用相同的上下文（您可以将上下文传递给 getdefaultrole 方法）或重新考虑关系并扩展实体。

编辑：想要添加这是针对提供的示例，使用 asp.net 将需要您充分考虑您的上下文和关系设计。

你可以简单地传递上下文.. IE：

```
void MyFunction()
{
    using (TCPSEntities model = new TCPSEntities())
    {
        EmployeeRoles er = model.EmployeeRoles.First(p=>p.EmployeeId == 123);
        er.Roles = GetDefaultRole(model);
        model.SaveChanges();
     }

}

private static Roles GetDefaultRole(TCPSEntities model)
{
    Roles r = null;
    r = model.Roles.First(p => p.RoleId == 1);
    return r;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-17T04:08:07.900

您可以在此处使用的另一种方法是将对象从一个上下文中分离，然后将它们附加到另一个上下文。这有点小技巧，它可能不适用于您的情况，但它可能是一种选择。

```
 public void GuestUserTest()
    {
        SlideLincEntities ctx1 = new SlideLincEntities();
        GuestUser user = GuestUser.CreateGuestUser();
        user.UserName = "Something";
        ctx1.AddToUser(user);
        ctx1.SaveChanges();

        SlideLincEntities ctx2 = new SlideLincEntities();
        ctx1.Detach(user);
        user.UserName = "Something Else";
        ctx2.Attach(user);
        ctx2.SaveChanges();
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-04T18:42:52.273

是的 - 实体框架 V1 不支持跨 2 个或更多上下文工作。

以防万一您还没有找到它，在[http://blogs.msdn.com/dsimmons/pages/entity-framework-faq.aspx上有一个很好的关于 EF 的常见问题解答](http://blogs.msdn.com/dsimmons/pages/entity-framework-faq.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T21:04:50.117

据我了解，您希望尽可能少地实例化您的模型（通过“new XXXXEntities()”位）。根据 MS ( [http://msdn.microsoft.com/en-us/library/cc853327.aspx](http://msdn.microsoft.com/en-us/library/cc853327.aspx) ) 的说法，这是一个相当大的性能损失。因此将其包装在 using() 结构中并不是一个好主意。我在项目中所做的是通过始终提供相同上下文实例的静态方法来访问它：

```
 private static PledgeManagerEntities pledgesEntities;
    public static PledgeManagerEntities PledgeManagerEntities
    {
        get 
        {
            if (pledgesEntities == null)
            {
                pledgesEntities = new PledgeManagerEntities();
            }
            return pledgesEntities; 
        }
        set { pledgesEntities = value; }
    } 
```

然后我像这样检索它：

```
 private PledgeManagerEntities entities = Data.PledgeManagerEntities; 
```

# winapi - PrintDialog 过滤器列表

> ID：158993
> 
> 赞同：1
> 
> 时间：2008-10-01T18:24:27.787
> 
> 标签：winapi, filter, printdialog

我需要，最好在 C# 中 - 但 C++ 会做，找到一种方法来过滤 Windows 打印对话框中的打印机列表以进行任何 Windows 打印。

我遇到了 WinAPIOverride 并认为我将不得不编写自己的 dll 来覆盖获取打印机列表的方法，然后对其进行过滤并返回它。然后我必须将 dll 注入所有正在运行的进程中。

任何人都可以帮助我完成已经开发的东西或者更简单的方法吗？打印机列表出来的唯一方法是通过 API 方法调用，我什至考虑过修改注册表，但这会减慢打印对话框的响应速度，以至于对用户来说很烦人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-12T20:13:54.753

我不认为（重新）编写 DLL 是最简单的方法。为什么不使用[WMI](http://msdn.microsoft.com/en-us/library/aa393964(VS.85).aspx)来检索想要的[信息（在这种情况下是打印机）](http://msdn.microsoft.com/en-us/library/aa394363.aspx)？

以下代码用于检索所有本地安装的打印机：（从[此处](http://weblogs.asp.net/aghausman/archive/2008/12/30/get-list-of-installed-printers-using-c-wmi.aspx)
借用的代码示例）

```
 ManagementScope objScope = new ManagementScope(ManagementPath.DefaultPath); //For the local Access
    objScope.Connect();

    SelectQuery selectQuery = new SelectQuery();
    selectQuery.QueryString = "Select * from win32_Printer";
    ManagementObjectSearcher MOS = new ManagementObjectSearcher(objScope, selectQuery);
    ManagementObjectCollection MOC = MOS.Get();
    foreach (ManagementObject mo in MOC) {
      listBox1.Items.Add(mo["Name"].ToString().ToUpper());
    } 
```

要获得跨域已知的打印机，请使用以下命令：

```
ConnectionOptions objConnection = new ConnectionOptions();
objConnection.Username = "USERNAME";
objConnection.Password = "PASSWORD";
objConnection.Authority = "ntlmdomain:DDI"; //Where DDI is the name of my domain
// Make sure the user you specified have enough permission to access the resource. 

ManagementScope objScope = new ManagementScope(@"\\10.0.0.4\root\cimv2",objConnection); //For the local Access
objScope.Connect();

SelectQuery selectQuery = new SelectQuery();
selectQuery.QueryString = "Select * from win32_Printer";
ManagementObjectSearcher MOS = new ManagementObjectSearcher(objScope, selectQuery);
ManagementObjectCollection MOC = MOS.Get();
foreach (ManagementObject mo in MOC) {
  listBox1.Items.Add(mo["Name"].ToString().ToUpper());
} 
```

当然，由于您没有指定任何标准，因此该列表不会像您希望的那样“过滤”。但我相信你可以从这里自己管理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T23:41:50.467

感谢您提供有趣的代码。

这个想法是在不干扰用户的情况下尽可能全局地将过滤的打印机列表应用于系统。这意味着过滤后的列表必须适用于标准的 Windows 打印对话框，不幸的是......

因此，您的 WMI 代码虽然有点酷，但并不合适。如果我正在构建自己的打印对话框，它可以派上用场；）

# css - 当 Flex 应用程序由非 Flex 应用程序加载时，运行时 CSS 静默失败

> ID：158996
> 
> 赞同：0
> 
> 时间：2008-10-01T18:25:19.657
> 
> 标签：css, apache-flex, flash, actionscript-3

我已经编译了一个 CSS swf 文件，其中包括我的 Flex 应用程序的嵌入式皮肤。在我们的下载产品中，这个 CSS 工作正常。在 Web 上，一个非 Flex 容器正在加载 Flex 应用程序，CSS 默默地失败了。

调试应用程序时，可以在跟踪输出中看到以下运行时错误，但不会作为异常引发。

```
方法未实现 mx.core::IFlexDisplayObject/mx.core:IFlexDisplayObject::setActualSize()
   GlobalStyle__embed_css__319796825 中的过度绑定 0

访问器未实现 mx.core:IFlexDisplayObject::measuredHeight
   GlobalStyle__embed_css__319796825 中的过度绑定 0

访问器未实现 mx.core:IFlexDisplayObject::measuredWidth
   GlobalStyle__embed_css__319796825 中的过度绑定 0

方法未实现 mx.core::IFlexDisplayObject/mx.core:IFlexDisplayObject::move()
   GlobalStyle__embed_css__319796825 中的过度绑定 0

```

**更新**

现在我已经确定了实际问题，我已经编辑了这个问题，使其更有用和更直接。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T22:21:31.810

非 Flex 应用程序使用与嵌入在 CSS swf 中的 Flex 皮肤具有相同类名的库中的内容。因为 Flash 使用最通用的 swf 来进行类定义，所以它使用非 Flex 应用程序定义的类。

因为此内容没有扩展 UIMovieClip，所以会导致 StyleManager 失败。由于潜在的安全错误，Adobe 已将此过程的大部分内容包含在 try-catch 块中，以抑制预期的运行时错误。

重命名一个或另一个应用程序使用的类以解决此问题。******