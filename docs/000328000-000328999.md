# StackOverflow 问答 000328000-000328999

# python - wxpython：从 wx.lib.sheet.CSheet 对象更新字典或其他适当的数据类型

> ID：328003
> 
> 赞同：4
> 
> 时间：2008-11-29T21:00:12.023
> 
> 标签：python, wxpython, spreadsheet, wxwidgets

如果我有一个带有三个电子表格小部件的笔记本，那么对电子表格进行更改以更新字典（或者可能是一个 sqlite 文件？）的最佳方法是什么。是否所有 wx 网格对象都带有与 SetNumberRows 和 SetNumberCols 相关的内置字典？基本上，我正在寻找有关如何使用电子表格小部件中的用户输入数据的指导，如本示例改编自 python.org 上的教程：

```
class ExSheet(wx.lib.sheet.CSheet):
    def __init__(self, parent):
        sheet.CSheet.__init__(self, parent)
        self.SetLabelBackgroundColour('#CCFF66')
        self.SetNumberRows(50)
        self.SetNumberCols(50)

class Notebook(wx.Frame):
    def __init__(self, parent, id, title):
        wx.Frame.__init__(self, parent, id, title)
        nb = wx.Notebook(self, -1, style=wx.NB_BOTTOM)
        self.sheet1 = ExSheet(nb)
        self.sheet2 = ExSheet(nb)
        self.sheet3 = ExSheet(nb)
        nb.AddPage(self.sheet1, "Sheet1")
        nb.AddPage(self.sheet2, "Sheet2")
        nb.AddPage(self.sheet3, "Sheet3")
        self.sheet1.SetFocus()
        self.StatusBar() 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T22:14:09.720

将[wxGrid](http://docs.wxwidgets.org/stable/wx_wxgrid.html)与[wxGridTableBase](http://docs.wxwidgets.org/stable/wx_wxgridtablebase.html)一起使用

这是一个简单的例子：

```
import wx, wx.grid

class GridData(wx.grid.PyGridTableBase):
    _cols = "a b c".split()
    _data = [
        "1 2 3".split(),
        "4 5 6".split(),
        "7 8 9".split()
    ]

    def GetColLabelValue(self, col):
        return self._cols[col]

    def GetNumberRows(self):
        return len(self._data)

    def GetNumberCols(self):
        return len(self._cols)

    def GetValue(self, row, col):
        return self._data[row][col]

    def SetValue(self, row, col, val):
        self._data[row][col] = val

class Test(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None)
        self.data = GridData()
        grid = wx.grid.Grid(self)
        grid.SetTable(self.data)
        self.Bind(wx.EVT_CLOSE, self.OnClose)
        self.Show()

    def OnClose(self, event):
        print self.data._data
        event.Skip()

app = wx.PySimpleApp()
app.TopWindow = Test()
app.MainLoop() 
```

# c# - C# - 关闭 Sql 对象最佳实践

> ID：328005
> 
> 赞同：11
> 
> 时间：2008-11-29T21:02:14.873
> 
> 标签：c#, sql

如果您有一个带有 Sqlaccess 的 C# 函数，是否必须关闭所有对象/句柄，或者在退出该函数后自动清理所有内容

例如：

```
void DoSqlStuff()
{
    SqlConnection sqlConn = new SqlConnection(...);
    SqlCommand cmd = new SqlCommand(...);
    SqlDataReader sqlData= null;

    sqlConn,Open();
    sqlData = cmd.ExecutReader();

    while(sqlData.Read())
    {
         ...
    }
} 
```

关闭 SqlConn 和 SqlData 是可选的、推荐的还是强制的？

谢谢。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-29T21:07:34.177

完成后应立即关闭 SqlConnection 对象。如果您不这样做，则连接将保持打开状态，并且无法处理其他请求。

using 语句对此很有用。它将为您调用对象上的 Dispose()：

```
using (SqlConnection cn = new SqlConnection(connectionString))
{   
    SqlCommand cm = new SqlCommand(commandString, cn)
    cn.Open();
    cm.ExecuteNonQuery();       
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T23:28:13.720

除非您计划在 SqlDataReader 完全读取行集后对连接执行其他操作，否则您不需要为 SqlDataReader 提供单独的 using 语句（以及用于连接的一个 using 语句）。

如果您只是打开一个连接，使用阅读器读取一些数据，然后关闭连接，那么一个用于整个代码块（围绕连接）的 using 语句就足够了，因为垃圾收集器将清理与由第一个 using 语句处理的连接。

无论如何，这是一篇描述这一切的好[文章......](http://codeverity.com/timweaver/usingclosedisposeandfinalize/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T21:29:27.877

您应该在从函数返回之前关闭所有内容。打开数据读取器意味着打开数据库上的游标，导致内存使用量增加。数据库连接也是如此。

未使用的对象在 C# 中不会立即释放，而是仅在执行垃圾收集时才释放，这不是确定性的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T21:10:03.500

所有三个类都有一个 Dispose() 方法。强制太强，但绝对强烈建议您使用 using 关键字，以便自动调用 Dispose()。不这样做会使您的程序运行“繁重”，使用比必要更多的系统资源。当你没有使用足够的“new”关键字来触发垃圾收集器时，就会彻底失败。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T23:06:32.940

在 SQL 连接上调用 Close 并不会真正关闭它，而是会将其返回到连接池以供重用，从而提高性能。

此外，在使用完非托管资源后（尽快）不明确处置它们通常是不好的做法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T05:43:26.617

在 finally 语句中显式处理是另一种方法，尽管该[`using`](https://msdn.microsoft.com/en-us/library/yh598w02.aspx)语句是一个更好的解决方案。它产生了更多的代码，但演示了目标......

```
SqlConnection conn = null;
try
{
    //create connection

    SqlCommand cmd = null;
    try
    {
        //create command

        SqlDataReader reader = null;
        try 
        {
            //create reader
        }
        finally
        {
            reader.Dispose();
        }
    }
    finally
    {
        cmd.Dispose();
    }
}
finally 
{
    conn.Dispose();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-01T12:12:11.760

小心这里的绝对值。很大程度上取决于您在做什么以及效率低下的地方。在每个用户都有单独的安全上下文的网页中，您可能别无选择，只能在每次页面命中时使用新的安全凭证建立新的 SQL 连接。如果您可以使用具有共享安全上下文的 SQL 连接池并让网页过滤结果，那么显然更好，但也许您不能。

在 SQL Server 的早期版本（即 v6.5 或更低版本）中，登录身份验证由 SQL Server 完成。SQL 也受到连接内存和它可以处理的活动连接数的严重限制。因此，在不使用时断开连接是个好主意。在 v6.5 之后，大多数人使用 Windows 身份验证来登录 SQL。这会导致服务器之间的大量网络调用和一些延迟。Kerberos 安全性更加健谈，因此建立 SQL 连接的成本很高。因此，您需要在 WinForms 应用程序的生命周期内保持连接打开与在每个方法调用中打开和关闭连接之间找到平衡。

作为一个粗略的指导，如果您认为您的应用程序接下来会想要与 SQL 对话，比如 30 秒。保持已建立的连接打开。如果他们已经最小化了你的应用程序，在超时时间内没有触及它，或者你已经在 RAM 中获得了所有数据并且他们不太可能需要 SQL 系统提供更多的东西。关闭连接。

考虑使用系统计时器创建一个类来保持连接。您的类将始终提供有效的连接，但也许该类会选择删除它并在适当的时候释放 SQL 上的连接负载。

除非您也在编写基于服务器的代码，否则可能甚至不会注意到少量的内存效率低下。但是 2 到 10,000 个客户端都对您的安全和数据服务器使用不佳，可能会使您的数据中心陷入瘫痪。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T21:10:51.127

任何处理 SQL 内容（如 Connections）的类都应该按照 Microsoft .NET 编码指南的规定实现 IDisposable 接口。

因此，您可能应该在 Dispose 方法中关闭并处理您的连接。

# .net - MSBuild 的路径

> ID：328017
> 
> 赞同：203
> 
> 时间：2008-11-29T21:12:51.857
> 
> 标签：.net, msbuild

如何以编程方式从运行 .exe 的机器获取 MSBuild 的路径？

我可以从环境中获取 .NET 版本，但有没有办法为 .NET 版本获取正确的文件夹？

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2008-11-29T22:59:05.590

浏览注册表，它看起来像

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\2.0
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\3.5
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\4.0 
```

可能是你所追求的；启动 regedit.exe 并查看。

### 通过命令行查询（根据[Nikolay Botev](https://stackoverflow.com/a/15446618/712526)）

```
reg.exe query "HKLM\SOFTWARE\Microsoft\MSBuild\ToolsVersions\4.0" /v MSBuildToolsPath 
```

### 通过 PowerShell 查询（按[MovGP0](https://stackoverflow.com/a/31404176/712526)）

```
dir HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\ 
```

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2013-03-16T07:13:18.530

您还可以将 MSBuild.exe 的路径打印到命令行：

```
reg.exe query "HKLM\SOFTWARE\Microsoft\MSBuild\ToolsVersions\4.0" /v MSBuildToolsPath 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2018-11-15T12:39:34.240

[查找 MSBuild 的说明](https://github.com/Microsoft/vswhere/wiki/Find-MSBuild)：

*   电源外壳：`&"${env:ProgramFiles(x86)}\Microsoft Visual Studio\Installer\vswhere.exe" -latest -prerelease -products * -requires Microsoft.Component.MSBuild -find MSBuild\**\Bin\MSBuild.exe`
*   命令：`"%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe" -latest -prerelease -products * -requires Microsoft.Component.MSBuild -find MSBuild\**\Bin\MSBuild.exe`

[查找 VSTest 的说明](https://github.com/Microsoft/vswhere/wiki/Find-VSTest)：

*   电源外壳：`&"${env:ProgramFiles(x86)}\Microsoft Visual Studio\Installer\vswhere.exe" -latest -prerelease -products * -requires Microsoft.VisualStudio.PackageGroup.TestTools.Core -find Common7\IDE\CommonExtensions\Microsoft\TestWindow\vstest.console.exe`
*   命令：`"%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe" -latest -prerelease -products * -requires Microsoft.VisualStudio.PackageGroup.TestTools.Core -find Common7\IDE\CommonExtensions\Microsoft\TestWindow\vstest.console.exe`

（请注意，上面的说明与微软官方的说明略有修改。特别是，我已经包含了`-prerelease`允许预览和 RC 安装的标志，以及`-products *`检测 Visual Studio 构建工具安装的标志。）

* * *

只花了两年多的时间，但最终在 2019 年，[微软倾听并为我们提供了一种找到这些重要可执行文件的方法](https://github.com/Microsoft/vswhere/issues/162)！如果您安装了 Visual Studio 2017 和/或 2019，则`vswhere`可以查询该实用程序以获取 MSBuild 等的位置。由于`vswhere` **Microsoft 保证位于** `%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe`，因此不再需要引导和路径硬编码。

神奇的是`-find`参数，[在 2.6.2 版本中添加](https://github.com/Microsoft/vswhere/releases/tag/2.6.2%2Bf078b21784)。`vswhere`您可以通过运行或检查其文件属性来确定您已安装的版本。如果您有旧版本，您只需[下载最新](https://github.com/Microsoft/vswhere/releases/)版本并覆盖现有的`%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe`.

`vswhere.exe`是一个独立的可执行文件，因此您可以从任何有互联网连接的地方下载和运行它。这意味着您的构建脚本可以检查它们运行的​​环境是否设置正确，仅举一个选项。

如果你安装了[Chocolatey](https://chocolatey.org/)，[你也可以使用相关的`vswhere`包](https://community.chocolatey.org/packages/vswhere)。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2012-11-20T17:32:10.420

如果您想为 .Net 4 使用 MSBuild，那么您可以使用以下 PowerShell 命令来获取可执行文件的路径。如果您想要 2.0 或 3.5 版本，则只需更改 $dotNetVersion 变量。

要运行可执行文件，您需要在 $msbuild 变量前面加上 &。这将执行变量。

```
# valid versions are [2.0, 3.5, 4.0]
$dotNetVersion = "4.0"
$regKey = "HKLM:\software\Microsoft\MSBuild\ToolsVersions\$dotNetVersion"
$regProperty = "MSBuildToolsPath"

$msbuildExe = join-path -path (Get-ItemProperty $regKey).$regProperty -childpath "msbuild.exe"

&$msbuildExe 
```

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2012-12-06T21:02:34.243

对于 Windows 7 中的 cmd shell 脚本，我在批处理文件中使用以下片段在 .NET Framework 版本 4 中查找 MSBuild.exe。我假设版本 4 存在，但不假设子版本。这不是完全通用的，但对于快速脚本它可能会有所帮助：

```
set msbuild.exe=
for /D %%D in (%SYSTEMROOT%\Microsoft.NET\Framework\v4*) do set msbuild.exe=%%D\MSBuild.exe 
```

对于我的使用，如果这不起作用，我将退出批处理文件并出现错误：

```
if not defined msbuild.exe echo error: can't find MSBuild.exe & goto :eof
if not exist "%msbuild.exe%" echo error: %msbuild.exe%: not found & goto :eof 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2015-09-03T08:23:46.890

您可以使用这个非常试用的 PowerShell 命令`MSBuildToolsPath`从注册表中获取。

# PowerShell（来自注册表）

```
Resolve-Path HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\* | 
Get-ItemProperty -Name MSBuildToolsPath 
```

## 输出

```
MSBuildToolsPath : C:\Program Files (x86)\MSBuild\12.0\bin\amd64\
PSPath           : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\12.0
PSParentPath     : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions
PSChildName      : 12.0
PSDrive          : HKLM
PSProvider       : Microsoft.PowerShell.Core\Registry

MSBuildToolsPath : C:\Program Files (x86)\MSBuild\14.0\bin\amd64\
PSPath           : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\14.0
PSParentPath     : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions
PSChildName      : 14.0
PSDrive          : HKLM
PSProvider       : Microsoft.PowerShell.Core\Registry

MSBuildToolsPath : C:\Windows\Microsoft.NET\Framework64\v2.0.50727\
PSPath           : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\2.0
PSParentPath     : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions
PSChildName      : 2.0
PSDrive          : HKLM
PSProvider       : Microsoft.PowerShell.Core\Registry

MSBuildToolsPath : C:\Windows\Microsoft.NET\Framework64\v3.5\
PSPath           : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\3.5
PSParentPath     : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions
PSChildName      : 3.5
PSDrive          : HKLM
PSProvider       : Microsoft.PowerShell.Core\Registry

MSBuildToolsPath : C:\Windows\Microsoft.NET\Framework64\v4.0.30319\
PSPath           : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\4.0
PSParentPath     : Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions
PSChildName      : 4.0
PSDrive          : HKLM
PSProvider       : Microsoft.PowerShell.Core\Registry 
```

或从文件系统

# PowerShell（来自文件系统）

```
Resolve-Path "C:\Program Files (x86)\MSBuild\*\Bin\amd64\MSBuild.exe"
Resolve-Path "C:\Program Files (x86)\MSBuild\*\Bin\MSBuild.exe" 
```

## 输出

```
Path
----
C:\Program Files (x86)\MSBuild\12.0\Bin\amd64\MSBuild.exe
C:\Program Files (x86)\MSBuild\14.0\Bin\amd64\MSBuild.exe
C:\Program Files (x86)\MSBuild\12.0\Bin\MSBuild.exe
C:\Program Files (x86)\MSBuild\14.0\Bin\MSBuild.exe 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2013-12-06T19:27:23.147

@AllenSanborn 有一个很棒的 powershell 版本，但有些人要求只使用批处理脚本进行构建。

这是@ bono8106 回答的应用版本。

msbuildpath.bat

```
@echo off

reg.exe query "HKLM\SOFTWARE\Microsoft\MSBuild\ToolsVersions\14.0" /v MSBuildToolsPath > nul 2>&1
if ERRORLEVEL 1 goto MissingMSBuildRegistry

for /f "skip=2 tokens=2,*" %%A in ('reg.exe query "HKLM\SOFTWARE\Microsoft\MSBuild\ToolsVersions\14.0" /v MSBuildToolsPath') do SET "MSBUILDDIR=%%B"

IF NOT EXIST "%MSBUILDDIR%" goto MissingMSBuildToolsPath
IF NOT EXIST "%MSBUILDDIR%msbuild.exe" goto MissingMSBuildExe

exit /b 0

goto:eof
::ERRORS
::---------------------
:MissingMSBuildRegistry
echo Cannot obtain path to MSBuild tools from registry
goto:eof
:MissingMSBuildToolsPath
echo The MSBuild tools path from the registry '%MSBUILDDIR%' does not exist
goto:eof
:MissingMSBuildExe
echo The MSBuild executable could not be found at '%MSBUILDDIR%'
goto:eof 
```

构建.bat

```
@echo off
call msbuildpath.bat
"%MSBUILDDIR%msbuild.exe" foo.csproj /p:Configuration=Release 
```

对于 Visual Studio 2017 / MSBuild 15，Aziz Atif（编写[Elmah](https://elmah.github.io/)的人）编写了一个批处理脚本

```
build.cmd Release Foo.csproj 
```

[https://github.com/linqpadless/LinqPadless/blob/master/build.cmd](https://github.com/linqpadless/LinqPadless/blob/master/build.cmd)

```
@echo off
setlocal
if "%PROCESSOR_ARCHITECTURE%"=="x86" set PROGRAMS=%ProgramFiles%
if defined ProgramFiles(x86) set PROGRAMS=%ProgramFiles(x86)%
for %%e in (Community Professional Enterprise) do (
    if exist "%PROGRAMS%\Microsoft Visual Studio\2017\%%e\MSBuild\15.0\Bin\MSBuild.exe" (
        set "MSBUILD=%PROGRAMS%\Microsoft Visual Studio\2017\%%e\MSBuild\15.0\Bin\MSBuild.exe"
    )
)
if exist "%MSBUILD%" goto :restore
set MSBUILD=
for %%i in (MSBuild.exe) do set MSBUILD=%%~dpnx$PATH:i
if not defined MSBUILD goto :nomsbuild
set MSBUILD_VERSION_MAJOR=
set MSBUILD_VERSION_MINOR=
for /f "delims=. tokens=1,2,3,4" %%m in ('msbuild /version /nologo') do (
    set MSBUILD_VERSION_MAJOR=%%m
    set MSBUILD_VERSION_MINOR=%%n
)
if not defined MSBUILD_VERSION_MAJOR goto :nomsbuild
if not defined MSBUILD_VERSION_MINOR goto :nomsbuild
if %MSBUILD_VERSION_MAJOR% lss 15    goto :nomsbuild
if %MSBUILD_VERSION_MINOR% lss 1     goto :nomsbuild
:restore
for %%i in (NuGet.exe) do set nuget=%%~dpnx$PATH:i
if "%nuget%"=="" (
    echo WARNING! NuGet executable not found in PATH so build may fail!
    echo For more on NuGet, see https://github.com/nuget/home
)
pushd "%~dp0"
nuget restore ^
 && call :build Debug   %* ^
 && call :build Release %*
popd
goto :EOF

:build
setlocal
"%MSBUILD%" /p:Configuration=%1 /v:m %2 %3 %4 %5 %6 %7 %8 %9
goto :EOF

:nomsbuild
echo Microsoft Build version 15.1 (or later) does not appear to be
echo installed on this machine, which is required to build the solution.
exit /b 1 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-04-26T00:50:59.790

这适用于 Visual Studio 2015 和 2017：

```
function Get-MSBuild-Path {

    $vs14key = "HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\14.0"
    $vs15key = "HKLM:\SOFTWARE\wow6432node\Microsoft\VisualStudio\SxS\VS7"

    $msbuildPath = ""

    if (Test-Path $vs14key) {
        $key = Get-ItemProperty $vs14key
        $subkey = $key.MSBuildToolsPath
        if ($subkey) {
            $msbuildPath = Join-Path $subkey "msbuild.exe"
        }
    }

    if (Test-Path $vs15key) {
        $key = Get-ItemProperty $vs15key
        $subkey = $key."15.0"
        if ($subkey) {
            $msbuildPath = Join-Path $subkey "MSBuild\15.0\bin\amd64\msbuild.exe"
        }
    }

    return $msbuildPath

} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2018-11-01T01:21:00.830

基于[@dh_cgn 的答案的单行代码](https://stackoverflow.com/a/32370545/712526)：

`(Resolve-Path ([io.path]::combine(${env:ProgramFiles(x86)}, 'Microsoft Visual Studio', '*', '*', 'MSBuild', '*' , 'bin' , 'msbuild.exe'))).Path`

它选择所有现有路径路径，例如。`C:\Program Files (x86)\Microsoft Visual Studio\*\*\MSBuild\*\bin\msbuild.exe`.

通配符星星是：

*   年份 (2017)
*   视觉工作室版（社区、专业、企业）
*   工具版本 (15.0)

请注意，此命令正在选择与按字母排序的表达式匹配的第一个路径。要缩小范围，只需将通配符替换为特定元素，例如。年份或工具版本。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-08T19:08:19.933

注册表位置

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\2.0
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions\3.5 
```

给出可执行文件的位置。

但是，如果您需要保存任务扩展的位置，它就在

```
%ProgramFiles%\MSBuild 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-08-18T20:01:56.800

从 MSBuild 2017 (v15) 开始，MSBuild 现在安装在每个 Visual Studio 版本下的文件夹中

以下是在我的机器上找到 MSBuild.exe 的一些示例：

```
C:\windows\Microsoft.NET\Framework\v2.0.50727\MSBuild.exe  (v2.0.50727.8745  32-bit)
C:\windows\Microsoft.NET\Framework64\v2.0.50727\MSBuild.exe  (v2.0.50727.8745  64-bit)
C:\Windows\Microsoft.NET\Framework\v3.5\MSBuild.exe  (v3.5.30729.8763 32-bit)
C:\Windows\Microsoft.NET\Framework64\v3.5\MSBuild.exe  (v3.5.30729.8763 64-bit)
C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe  (v4.7.2053.0 32-bit)
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe  (v4.7.2053.0 64-bit)
C:\Program Files (x86)\MSBuild\12.0\Bin\MSBuild.exe  (v12.0.21005.1 32-bit)
C:\Program Files (x86)\MSBuild\12.0\Bin\amd64\MSBuild.exe (v12.0.21005.1 64-bit)
C:\Program Files (x86)\MSBuild\14.0\Bin\MSBuild.exe  (v14.0.25420.1 32-bit)
C:\Program Files (x86)\MSBuild\14.0\Bin\amd64\MSBuild.exe  (v14.0.25420.1 64-bit)
C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\Bin\MSBuild.exe  (v15.1.1012+g251a9aec17 32-bit)
C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\Bin\amd64\MSBuild.exe (v15.1.1012+g251a9aec17 64-bit)
C:\Program Files (x86)\Microsoft Visual Studio\2017\{LicenceName}\MSBuild\Bin\MSBuild.exe (v15.1.1012.6693 32-bit)
C:\Program Files (x86)\Microsoft Visual Studio\2017\{LicenceName}\MSBuild\Bin\amd64\MSBuild.exe (v15.1.1012.6693 64-bit) 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-07-14T10:33:40.927

最简单的方法可能是打开 PowerShell 并输入

```
dir HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\ 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-09-09T13:20:35.510

在 Windows 2003 及更高版本上，在 cmd 中键入以下命令：

```
cmd> where MSBuild
Sample result: C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe 
```

如果没有出现，则表示系统 PATH 中未包含 .NET 框架。MSBuild 应与 .NET 编译器（vbc.exe、csc.exe）一起位于 .NET 安装文件夹中

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-12-22T14:10:51.243

要从注册表中批量检索**msbuild 15** (Visual Studio 2017) 的路径，无需其他工具：

```
set regKey=HKLM\SOFTWARE\WOW6432Node\Microsoft\VisualStudio\SxS\VS7
set regValue=15.0
for /f "skip=2 tokens=3,*" %%A in ('reg.exe query %regKey% /v %regValue% 2^>nul') do (
    set vs17path=%%A %%B
)
set msbuild15path = %vs17path%\MSBuild\15.0\Bin\MSBuild.exe 
```

更好的可用工具：

*   [vswhere](https://github.com/Microsoft/vswhere)：找到 Visual Studio 2017 和更新的安装，请参阅[get msbuild15 path with batch](https://github.com/Microsoft/vswhere/wiki/Find-MSBuild)（使用硬编码路径作为我上面的代码片段）。
*   使用[Microsoft.VisualStudio.Workload.MSBuildTools](https://blogs.msdn.microsoft.com/vcblog/2017/03/06/finding-the-visual-c-compiler-tools-in-visual-studio-2017/)[设置 Visual Studio PowerShell 模块](https://github.com/Microsoft/vssetup.powershell)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-07-26T07:17:22.797

有很多正确的答案。但是，这里我使用 PowerShell 中的 One-Liner 来**确定最新版本的 MSBuild 路径**：

```
Get-ChildItem 'HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\' | 
    Get-ItemProperty -Name MSBuildToolsPath | 
    Sort-Object PSChildName | 
    Select-Object -ExpandProperty MSBuildToolsPath -first 1 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-06-06T09:24:35.097

您不会认为这里有太多要添加的内容，但也许是时候采用一种统一的方式在所有版本中执行此操作了。我将注册表查询方法（VS2015 及更低版本）与[vswhere](https://github.com/microsoft/vswhere)（VS2017 及更高版本）的使用结合起来提出了这一点：

```
function Find-MsBuild {
    Write-Host "Using VSWhere to find msbuild..."
    $path = & $vswhere -latest -requires Microsoft.Component.MSBuild -find MSBuild\**\Bin\MSBuild.exe | select-object -first 1

    if (!$path) {
        Write-Host "No results from VSWhere, using registry key query to find msbuild (note this will find pre-VS2017 versions)..."
        $path = Resolve-Path HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\* |
                    Get-ItemProperty -Name MSBuildToolsPath |
                    sort -Property @{ Expression={ [double]::Parse($_.PSChildName) }; Descending=$true } |
                    select -exp MSBuildToolsPath -First 1 |
                    Join-Path -ChildPath "msbuild.exe"
    }

    if (!$path) {
        throw "Unable to find path to msbuild.exe"
    }

    if (!(Test-Path $path)) {
        throw "Found path to msbuild as $path, but file does not exist there"
    }

    Write-Host "Using MSBuild at $path..."
    return $path
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-09-13T21:52:47.970

此 powershell 方法从多个来源获取 msBuild 的路径。按顺序尝试：

1.  首先使用 vswhere（因为 Visual Studio 似乎有更多最新版本的 msBuild）例如

    ```
    C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\MSBuild\15.0\Bin\MSBuild.exe 
    ```

2.  如果没有找到尝试注册表（框架版本），例如

    ```
    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe 
    ```

电源外壳代码：

```
Function GetMsBuildPath {

    Function GetMsBuildPathFromVswhere {
        # Based on https://github.com/microsoft/vswhere/wiki/Find-MSBuild/62adac8eb22431fa91d94e03503d76d48a74939c
        $vswhere = "${env:ProgramFiles(x86)}\Microsoft Visual Studio\Installer\vswhere.exe"
        $path = & $vswhere -latest -prerelease -products * -requires Microsoft.Component.MSBuild -property installationPath
        if ($path) {
            $tool = join-path $path 'MSBuild\Current\Bin\MSBuild.exe'
            if (test-path $tool) {
                return $tool
            }
            $tool = join-path $path 'MSBuild\15.0\Bin\MSBuild.exe'
            if (test-path $tool) {
                return $tool
            }
        }
    }

    Function GetMsBuildPathFromRegistry {
        # Based on Martin Brandl's answer: https://stackoverflow.com/a/57214958/146513
        $msBuildDir = Get-ChildItem 'HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\' |
            Get-ItemProperty -Name MSBuildToolsPath |
            Sort-Object PSChildName |
            Select-Object -ExpandProperty MSBuildToolsPath -last 1
        $msBuildPath = join-path $msBuildDir 'msbuild.exe'
        if (test-path $msBuildPath) {
            return $msBuildPath
        }
    }

    $msBuildPath = GetMsBuildPathFromVswhere
    if (-Not $msBuildPath) {
        $msBuildPath = GetMsBuildPathFromRegistry
    }
    return $msBuildPath
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-11-14T08:54:25.800

对于不知道确切版本的 Visual Studio 2017，您可以在批处理脚本中使用它：

```
FOR /F "tokens=* USEBACKQ" %%F IN (`where /r "%PROGRAMFILES(x86)%\Microsoft Visual 
Studio\2017" msbuild.exe ^| findstr /v /i "amd64"`) DO (SET msbuildpath=%%F) 
```

findstr 命令用于忽略某些 msbuild 可执行文件（在本例中为 amd64）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-01-22T01:12:54.863

[为https://github.com/linqpadless/LinqPadless/blob/master/build.cmd](https://github.com/linqpadless/LinqPadless/blob/master/build.cmd)添加 vswhere 分支，在我的计算机上运行良好，而 vswhere 分支在我伙伴的计算机上运行。可能是，vswhere 分支应该作为第一个检查前进。

```
@echo off
setlocal
if "%PROCESSOR_ARCHITECTURE%"=="x86" set PROGRAMS=%ProgramFiles%
if defined ProgramFiles(x86) set PROGRAMS=%ProgramFiles(x86)%
for %%e in (Community Professional Enterprise) do (
    if exist "%PROGRAMS%\Microsoft Visual Studio\2017\%%e\MSBuild\15.0\Bin\MSBuild.exe" (
        set "MSBUILD=%PROGRAMS%\Microsoft Visual Studio\2017\%%e\MSBuild\15.0\Bin\MSBuild.exe"
    )
)
if exist "%MSBUILD%" goto :build

for /f "usebackq tokens=1* delims=: " %%i in (`"%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe" -latest -requires Microsoft.Component.MSBuild`) do (
  if /i "%%i"=="installationPath" set InstallDir=%%j
)

if exist "%InstallDir%\MSBuild\15.0\Bin\MSBuild.exe" (
  set "MSBUILD=%InstallDir%\MSBuild\15.0\Bin\MSBuild.exe"
)
if exist "%MSBUILD%" goto :build
set MSBUILD=
for %%i in (MSBuild.exe) do set MSBUILD=%%~dpnx$PATH:i
if not defined MSBUILD goto :nomsbuild
set MSBUILD_VERSION_MAJOR=
set MSBUILD_VERSION_MINOR=
for /f "delims=. tokens=1,2,3,4" %%m in ('msbuild /version /nologo') do (
    set MSBUILD_VERSION_MAJOR=%%m
    set MSBUILD_VERSION_MINOR=%%n
)
echo %MSBUILD_VERSION_MAJOR% %MSBUILD_VERSION_MINOR%
if not defined MSBUILD_VERSION_MAJOR goto :nomsbuild
if not defined MSBUILD_VERSION_MINOR goto :nomsbuild
if %MSBUILD_VERSION_MAJOR% lss 15    goto :nomsbuild
if %MSBUILD_VERSION_MINOR% lss 1     goto :nomsbuild
:restore
for %%i in (NuGet.exe) do set nuget=%%~dpnx$PATH:i
if "%nuget%"=="" (
    echo WARNING! NuGet executable not found in PATH so build may fail!
    echo For more on NuGet, see https://github.com/nuget/home
)
pushd "%~dp0"
popd
goto :EOF

:build
setlocal
"%MSBUILD%" -restore -maxcpucount %1 /p:Configuration=%2 /v:m %3 %4 %5 %6 %7 %8 %9
goto :EOF

:nomsbuild
echo Microsoft Build version 15.1 (or later) does not appear to be
echo installed on this machine, which is required to build the solution.
exit /b 1 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-06-05T07:31:52.383

获取最新版本的 MsBuild。最佳方式，适用于所有类型的 msbuild 安装，适用于不同的处理器架构（Power Shell）：

```
function Get-MsBuild-Path
{
    $msbuildPathes = $null
    $ptrSize = [System.IntPtr]::Size
    switch ($ptrSize) {
        4 {
            $msbuildPathes =
            @(Resolve-Path "${Env:ProgramFiles(x86)}\Microsoft Visual Studio\*\*\MSBuild\*\Bin\msbuild.exe" -ErrorAction SilentlyContinue) +
            @(Resolve-Path "${Env:ProgramFiles(x86)}\MSBuild\*\Bin\MSBuild.exe" -ErrorAction SilentlyContinue) +
            @(Resolve-Path "${Env:windir}\Microsoft.NET\Framework\*\MSBuild.exe" -ErrorAction SilentlyContinue)
        }
        8 {
            $msbuildPathes =
            @(Resolve-Path "${Env:ProgramFiles(x86)}\Microsoft Visual Studio\*\*\MSBuild\*\Bin\amd64\msbuild.exe" -ErrorAction SilentlyContinue) +
            @(Resolve-Path "${Env:ProgramFiles(x86)}\MSBuild\*\Bin\amd64\MSBuild.exe" -ErrorAction SilentlyContinue) +
            @(Resolve-Path "${Env:windir}\Microsoft.NET\Framework64\*\MSBuild.exe" -ErrorAction SilentlyContinue)
        }
        default {
            throw ($msgs.error_unknown_pointersize -f $ptrSize)
        }
    }

    $latestMSBuildPath = $null
    $latestVersion = $null
    foreach ($msbuildFile in $msbuildPathes)
    {
        $msbuildPath = $msbuildFile.Path
        $versionOutput = & $msbuildPath -version
        $fileVersion = (New-Object System.Version($versionOutput[$versionOutput.Length - 1]))
        if (!$latestVersion -or $latestVersion -lt $fileVersion)
        {
            $latestVersion = $fileVersion
            $latestMSBuildPath = $msbuildPath
        }
    }

    Write-Host "MSBuild version detected: $latestVersion" -Foreground Yellow
    Write-Host "MSBuild path: $latestMSBuildPath" -Foreground Yellow

    return $latestMSBuildPath;
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2019-04-18T17:44:32.660

如果您喜欢冒险，您现在还可以从 GitHub 获取 MsBuild 的源代码和最新版本，网址为[https://github.com/Microsoft/msbuild/releases/](https://github.com/Microsoft/msbuild/releases/)

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2017-06-15T16:18:07.820

如果要编译一个Delphi项目，[使用msbuild+Delphi2009时看“ERROR MSB4040 There is no target in the project”](https://stackoverflow.com/questions/1342859/error-msb4040-there-is-no-target-in-the-project-when-using-msbuilddelphi2009)

正确答案是：“有一个名为**rsvars.bat**的批处理文件（在 RAD Studio 文件夹中搜索它）。在调用 MSBuild 之前调用它，它将设置必要的环境变量。确保 rsvars 中的文件夹正确无误.bat 如果您的编译器位于与默认位置不同的位置。”

此 bat 不仅会将 PATH 环境变量更新为具有正确 MSBuild.exe 版本的正确 .NET 文件夹，而且还会注册其他必要的变量。

# c++ - 如何将 bmp 加载到 GLubyte 数组中？

> ID：328019
> 
> 赞同：0
> 
> 时间：2008-11-29T21:14:44.833
> 
> 标签：c++, opengl, glut

全部，

我正在尝试将 bmp 文件加载到 GLubyte 数组中（不使用 aux）。

令人难以置信的是，我认为本来是一项微不足道的任务却占用了我数小时的时间。

在 Google 上似乎找不到任何东西！

这是我一起破解的，但它不是很有效：

```
// load texture

GLubyte *customTexture;

string fileName("C:\\Development\\Visual Studio 2008\\Projects\\OpenGL_Test\\Crate.bmp");

// Use LoadImage() to get the image loaded into a DIBSection
HBITMAP hBitmap = (HBITMAP)LoadImage( NULL, (LPCTSTR)const_cast<char*>(fileName.c_str()), IMAGE_BITMAP, 0, 0, 
LR_CREATEDIBSECTION | LR_DEFAULTSIZE | LR_LOADFROMFILE );

customTexture = new GLubyte[3*256*256]; // size should be the size of the .bmp file

GetBitmapBits(hBitmap, 3*256*256, (LPVOID) customTexture);

GetBitmapDimensionEx(hBitmap,&szBitmap); 
```

发生的情况是对 LoadImage 的调用似乎返回了未定义的值（NULL？我无法弄清楚它是否真的在加载 bmp - 有点困惑）。

目前我正在将 bmps 转换为 raw 那么这一切都很容易。

有人有更好更干净的片段吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T21:35:47.223

`LoadImage()`只能使用资源编译器加载嵌入到可执行文件中的位图 - 它不能从文件系统加载外部位图。幸运的是，位图文件很容易自己阅读。有关文件格式的说明，请参阅[Wikipedia](http://en.wikipedia.org/wiki/Windows_bitmap)。

只需像打开任何其他文件一样打开文件（**重要**：以二进制模式打开它，即使用`"rb"`选项 using`fopen`或`ios::binary`使用 C++ 的标志`ifstream`），读取位图尺寸，并读取原始像素数据。

# scheme - 您将如何在 Scheme 中读取输入文件？

> ID：328020
> 
> 赞同：6
> 
> 时间：2008-11-29T21:15:17.437
> 
> 标签：scheme

我正在尝试将 .txt 文件中的数据输入到方案结构中。每个元素都由数据文件中的制表符分隔，每个结构集都在新行上。我希望能够将数据从一行读入一个结构，并列出文件中设置的每个结构。有什么建议么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-05T19:10:38.453

不太确定您想到了什么结构，但假设您有一个如下文本文件：

```
--> cat blah.txt
富吧巴兹
1 2 3 4 5
aa bb cc dd ee

```

您可以使用 sed 将其直接转换为方案中的列表列表：

```
--> echo "(define mylist '("`sed -e 's/\(.*\)/(\1)/' blah.txt`"))" > foo.txt

```

然后生成以下文件：

```
--> 猫 foo.txt
(define mylist '((foo bar baz) (1 2 3 4 5) (aa bb cc dd ee)))

```

现在您所要做的就是将文件加载到方案中：

```
（加载“foo.txt”）

```

您可以通过“mylist”变量访问该结构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T14:39:53.070

听起来像是一个带有制表符而不是逗号的 CSV 文件。如果您使用 PLT Scheme (DrScheme/mzscheme) neil 的 csv 库可能是您想要的。

[这是文档](http://planet.plt-scheme.org/package-source/neil/csv.plt/1/2/doc.txt)。

这是远程加载它的方法：

```
(require (planet neil/csv:1:2/csv)) 
```

至少，说明书上是这么说的。在我稍微有点过分的 DrScheme 上，这是有效的：

```
(require (planet "csv.ss" ("neil" "csv.plt" 1 (= 1)))) 
```

# apache-flex - 按钮大小上的 Flex 图标 [设计]

> ID：328022
> 
> 赞同：0
> 
> 时间：2008-11-29T21:19:27.040
> 
> 标签：apache-flex, button, coding-style

我想根据其图标图像调整按钮的宽度。我试图将填充强制为 0，但没有成功。

在一个瓷砖

```
<mx:Button id="m1"  icon="@Embed('m1.png')"/> 
```

查看结果

[http://img513.imageshack.us/my.php?image=iconkg3.png](http://img513.imageshack.us/my.php?image=iconkg3.png)

我怎么能改变这个差距？

[图标 http://img513.imageshack.us/my.php?image=iconkg3.png](http://img513.imageshack.us/my.php?image=iconkg3.png)

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T13:13:18.407

在 creationComplete 事件上添加一个侦听器，您可以使用以下代码：

```
 private function OnCreationComplete(event: Event): void
    {
        if (event.target is Button)
        {
            var button: Button = (event.target as Button);
            var icon: DisplayObject = button.getChildByName("upIcon");
            if (icon) // check icon existence
            {
                button.width = icon.width;
                button.height = icon.height;
            }
        }
    } 
```

应该管用...

# security - 如何防止密码被保存？

> ID：328023
> 
> 赞同：10
> 
> 时间：2008-11-29T21:19:45.183
> 
> 标签：security, passwords

我注意到在银行网站等上，我的用户 ID 没有保存（它们不像其他常用输入的东西那样出现在下拉列表中）并且没有提示它记住您的密码。这是怎么做到的？站点如何通知浏览器它们处于“特殊”或例外状态？只是好奇。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T21:22:05.397

通常您只需要将 autocomplete="off" 放入要阻止的表单或字段中。

请记住，用户可以使用小脚本、插件或油脂猴子脚本来解决这个问题。

[https://developer.mozilla.org/en/How_to_Turn_Off_Form_Autocompletion#Exceptions_and_Recommended_Workarounds](https://developer.mozilla.org/en/How_to_Turn_Off_Form_Autocompletion#Exceptions_and_Recommended_Workarounds)

[http://msdn.microsoft.com/en-us/library/ms533032(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms533032(VS.85).aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-29T21:22:39.623

将自动完成设置为关闭：

```
<input type="password" autocomplete="off" /> 
```

另请参阅此问题：[禁用浏览器“保存密码”功能](https://stackoverflow.com/questions/32369/disable-browser-save-password-functionality)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-12T20:32:20.443

自动完成行为也可以在 TextBox 上进行控制。

正如下面链接中的建议，使用 AutoCompleteType = "Disabled" 禁用任何文本框的自动完成功能。

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.textbox.autocompletetype.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.textbox.autocompletetype.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-30T08:32:48.910

```
 $(document).ready(function () {  $('input[autocomplete="off"]').each(function () {

            var input = this;
            var name = $(input).attr('name');
            var id = $(input).attr('id');

            $(input).removeAttr('name');
            $(input).removeAttr('id');

            setTimeout(function () {

                $(input).attr('name', name);
                $(input).attr('id', id);
            }, 1);
        });
    }); 
```

# c# - 检查枚举是否具有等于字符串的字段

> ID：328025
> 
> 赞同：16
> 
> 时间：2008-11-29T21:20:55.303
> 
> 标签：c#, enums

我有一个枚举

```
public enum FileExtentions {
    mp3,
    mpeg
} 
```

我有一个 FileInfo，我想检查扩展名是否在前一个枚举中。我希望我能做一个

```
FileExtensions.Any(e=>e.ToString().Equals(file.Extension)); 
```

但这太棒了。有任何想法吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-30T00:53:54.297

背后的原因是什么`Any`…… `Equals`？你忽略了`Contains`吗？

```
bool result = Enum.GetNames(typeof(FileExtensions)).Contains("mp3"); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-29T21:23:37.250

在按下提交时，我自己想到了答案：

```
Enum.GetNames(typeof(FileExtensions)).Any(f=>f.Equals("."+file.Extension)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T01:22:41.603

[Enum.IsDefined](http://msdn.microsoft.com/en-us/library/system.enum.isdefined.aspx)将采用包含枚举值名称的字符串。唯一的丑陋是您必须从[File.Extension](http://msdn.microsoft.com/en-us/library/system.io.filesysteminfo.extension.aspx)中删除前导句点，并且它区分大小写：

```
Enum.IsDefined(typeof(FileExtension), file.Extension.Substring(1).ToLower()) 
```

编辑：扩展方法的优点以接近您想要的语法：

```
IEnumerable<string> GetNames(this Type t) {
   if (!t.IsEnum) throw new ArgumentException();

   return Enum.GetNames(t);
}

typeof(FileExtensions).GetNames().Any(e=>e.ToString().Equals(file.Extension)); 
```

不过，就个人而言，我仍然更喜欢 IsDefined 路线：

```
bool IsDefined(this Type t, string name) {
   if (!t.IsEnum) throw new ArgumentException();

   return Enum.IsDefined(t, name);
}

typeof(FileExtension).IsDefined(file.Extension); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T23:43:49.587

您可以使用以下扩展方法扩展 FileInfo 类型：

```
public static bool HasExtension(this FileInfo file)
{
    var ext = file.Extension.StartsWith(".") ? file.Extension.Substring(1) 
                                             : file.Extension;

    return Enum.GetNames(typeof(FileExtensions))
               .Any(f => f.Equals(ext));
} 
```

并像这样使用它：

```
bool hasExtension = file.HasExtension(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T21:25:47.010

您可以使用 System.Enum 类型来做到这一点：

```
string extension = Enum.GetName(typeof(FileExtensions), FileExtensions.mp3);

if (extension == file.Extension)
  // do something here 
```

**更新：**

啊，我误解了您要检查扩展的整个枚举，而不是特定的枚举值与扩展匹配。在这种情况下，您使用*GetNames()*的方法就是路线 - 抱歉，您无法将自己的答案标记为您自己的问题已接受。;-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-23T08:38:46.743

最好的方法是使用 Enum.IsDefined 函数。在您的情况下，这很容易：

```
if (Enum.IsDefined(typeof(FileExtentions), file.Extension)) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-11-16T18:56:34.523

一般解决方案：

```
Enum.IsDefined(Type, Object) 
```

您的解决方案是：

```
Enum.IsDefined(typeof(FileExtentions), FileInfo) 
```

# python - 初始性能的脚本语言选择

> ID：328041
> 
> 赞同：9
> 
> 时间：2008-11-29T21:34:13.390
> 
> 标签：python, ruby, perl, bash, scripting-language

我有一个小型轻量级应用程序，用作大型解决方案的一部分。目前它是用 C 语言编写的，但我希望使用跨平台脚本语言来重写它。该解决方案需要在 Windows、Linux、Solaris、AIX 和 HP-UX 上运行。

现有的 C 应用程序运行良好，但我希望有一个可以为所有平台维护的单一脚本。同时，我不想失去很多表现，但愿意失去一些。

脚本的启动成本非常重要。可以从每分钟到每秒多次调用此脚本。因此，保持它的内存和启动时间较短很重要。

所以基本上我正在寻找最好的脚本语言：

*   跨平台。
*   能够解析 XML 和 HTTP Posts。
*   低内存和低启动时间。

可能的选择包括但不限于：bash/ksh + curl、Perl、Python 和 Ruby。对于这种类型的场景，您会推荐什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-29T21:38:22.413

Lua 是一种符合您标准的脚本语言。它无疑是可用的最快和最低内存的脚本语言。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-29T22:01:23.663

由于您需要快速启动时间和大于 1Hz 的调用频率，我建议您使用 C 并弄清楚如何使其可移植（并不总是像几个 ifdef 那样简单）或探索将其变成始终运行的服务守护程序。当然这取决于如何

如果您编译模块并运行 .pyc 文件，Python 的启动时间可能会更短，但通常仍然认为它很慢。Perl，以我的经验，在最快的脚本语言中，所以你可能对 perl 守护进程有好运。

您还可以查看 gtk、wxWidgets 和 Qt 等跨平台框架。虽然它们针对的是 GUI，但它们确实具有低级跨平台数据类型和网络库，可以使使用基于 C 的快速应用程序的工作变得更容易。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-29T22:55:09.357

“从每分钟到每秒多次调用。因此，保持它的内存和启动时间很重要。”

这对我来说根本不像一个脚本。

这听起来像是一个服务器处理从每分钟到每秒几次到达的请求。

如果是服务器，处理请求，启动时间并不意味着响应能力。在这种情况下，Python 可能运行良好，并且仍然保持性能。

您只是在处理另一个请求，而不是重新启动。您可以保留优化性能所需的尽可能多的状态。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-29T21:48:55.293

如果编写得当，C 应该是独立于平台的，并且只需要为那些不同的平台重新编译。您可能需要跳过一些#ifdef 箍来获取标头（并非所有系统都使用相同的标头），但大多数普通（非win32 API）调用非常可移植。对于 Web 访问（我认为您在提到 bash+curl 时需要它），您可以查看 libcurl，它适用于您提到的所有平台，并且不应该那么难使用。

考虑到执行时间和内存成本，我怀疑您是否可以比使用任何脚本语言正确编写 C 更快，因为您至少会浪费一些时间来解释脚本......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-29T22:46:09.687

我同意 Lua：它是超级可移植的，它有 XML 库，可以是原生的，也可以通过绑定像 Expat 这样的 C 库，它有一个很好的套接字库（LuaSocket）加上，对于复杂的东西，一些 cURL 绑定，并且众所周知非常轻量级（通常嵌入在低内存设备中），非常快（最快的脚本语言之一），并且功能强大。而且非常容易编码！

它是用纯 Ansi C 编码的，很多人声称它拥有最好的 C 语言 API 之一（从 Lua 调用 C 例程，从 C 调用 Lua 代码......）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-29T21:59:35.350

如果低内存和低启动时间真的很重要，您可能需要考虑做一些工作以保持 C 代码跨平台，但是我发现这很少需要。

就我个人而言，我会使用 Ruby 或 Python 来完成这类工作，它们都可以很容易地编写出其他人可以维护的清晰易懂的代码（或者你可以在 6 个月不看它之后维护）。如果您有控制权，我还建议您获取最新版本的解释器，因为 Ruby 和 Python 最近在性能方面都取得了显着改进。

这是一个有点私人的事情。Ruby 编程让我很开心，而 C 代码却没有（也没有 bash 脚本编写任何重要的东西）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-29T23:15:50.737

正如其他人所建议的那样，守护您的脚本可能是一个好主意。这会将启动时间减少到几乎为零。要么有一个小的 C 包装器连接到你的守护进程并来回传输请求，要么让守护进程直接处理请求。

目前尚不清楚这是否旨在处理 HTTP 请求；如果是这样，Perl 有一个很好的 HTTP 服务器模块，绑定到几个不同的基于 C 的 XML 解析器，以及超快的字符串支持。（如果你不想守护进程，它有一个很好的、功能齐全的 CGI 模块；如果你可以完全控制它运行的服务器，你也可以使用 mod_perl 将你的脚本实现为 Apache 处理程序。） Ruby 的字符串速度有点慢，但是有一些非常好的后台工具可供使用。恐怕我对 Python 不太熟悉，所以我真的无法对它提出任何建议。

不过，总的来说，我认为您并不像您想象的那样受启动时间限制。如果脚本确实每秒被调用多次，那么任何体面的操作系统上的任何体面的解释器都将被缓存在内存中，脚本的源代码及其模块也将被缓存。结果：启动时间不会像您想象的那么糟糕。

```
Dagny:~ brent$ time perl -MCGI -e0

real    0m0.610s
user    0m0.036s
sys     0m0.022s
Dagny:~ brent$ time perl -MCGI -e0

real    0m0.026s
user    0m0.020s
sys     0m0.006s 
```

（Perl 解释器的参数加载相当大的 CGI 模块，然后执行代码行 '0;'。）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-29T22:12:41.877

蟒蛇很好。我还会查看 The Computer Languages Benchmarks Game 网站：

[http://shootout.alioth.debian.org/](http://shootout.alioth.debian.org/)

花点时间了解基准测试（包括启动时间和内存使用情况）可能是值得的。比较了许多语言，例如 Perl、Python、Lua 和 Ruby。您还可以将这些语言与 C 中的基准进行比较。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T22:09:35.970

我同意其他人的观点，您可能应该尝试使其成为更便携的 C 应用程序，而不是将其移植到其他东西，因为从启动的角度来看，任何脚本语言都会引入显着的开销，具有更大的内存占用，并且会可能要慢得多。

根据我的经验，Python 是三者中效率最高的，其次是 Perl，然后是 Ruby，Perl 和 Ruby 在某些方面的差异特别大。如果您真的想尝试将其移植到脚本语言，我会用您最熟悉的语言制作一个原型，看看它是否符合您的要求。如果您没有偏好，请从 Python 开始，因为它易于学习和使用，如果 Python 太慢，Perl 和 Ruby 可能无法做得更好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-29T22:24:05.053

请记住，如果您选择 Python，如果性能不是很好，您也可以在 C 中扩展它。哎呀，您甚至可以使用您现在拥有的一些代码。只需重新编译它并使用[pyrex](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/)包装它。

您也可以在 Ruby 和 Perl 中相当容易地做到这一点（尽管有些困难）。不要问我如何做到这一点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-29T22:58:24.203

你可以让它成为一个长期运行的过程并回答 http 或 rpc 请求吗？
这几乎可以满足任何情况下的延迟要求，但我不知道这是否会破坏您的内存占用限制。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-30T00:02:51.263

乍一看，这听起来像是过度工程，根据经验，我建议仅在出现问题时进行修复。

您有一个已经在工作的应用程序。显然你想调用从几个来源提供的功能。它看起来像是对我的服务描述（可能更容易维护）。

最后你还提到这是一个更大的解决方案的一部分，那么你可能想要重用更大的解决方案的语言和设施。从您给出的描述（xml + http）看来，它似乎是一个很常见的应用程序，可以用任何通用语言编写（可能是java中的Web容器？）。

一些库可以帮助您使代码可移植： [Boost](http://www.boost.org)、 [Qt](http://trolltech.com/products)

更多细节可能会引发更多想法:)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-30T06:18:51.817

将您的应用程序移植到 Ruby。如果您的应用程序太慢，请对其进行分析并用 C 重写这些部分。

# c# - 数据结构题

> ID：328044
> 
> 赞同：4
> 
> 时间：2008-11-29T21:37:30.170
> 
> 标签：c#, .net

我有一个包含大量行和一个数字列的数据库表，我想在内存中表示这些数据。我可以只使用一个大整数数组，这会非常快，但是行数可能太大了。

大多数行（超过 99%）的值为零。有没有我可以使用的有效数据结构，它只为具有非零值的行分配内存，并且几乎和数组一样快？

更新：例如，我尝试的一件事是哈希表，读取原始表并添加任何非零值，以原始表中的行号为键。如果未找到请求的索引，我使用返回 0 的函数获取值，否则返回 Hashtable 中的值。这可行，但与常规阵列相比，速度很慢 - 我可能做得不对。

**更新 2：这里是示例代码。**

```
private Hashtable _rowStates;
private void SetRowState(int rowIndex, int state)
{
    if (_rowStates.ContainsKey(rowIndex))
    {
        if (state == 0)
        {
            _rowStates.Remove(rowIndex);
        }
        else
        {
            _rowStates[rowIndex] = state;
        }
    }
    else
    {
        if (state != 0) 
        {
            _rowStates.Add(rowIndex, state);
        }
    }
}
private int GetRowState(int rowIndex)
{
    if (_rowStates.ContainsKey(rowIndex))
    {
        return (int)_rowStates[rowIndex];
    }
    else
    {
        return 0; 
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T21:46:54.283

*这是稀疏*数据结构的一个示例，有多种方法可以实现这种稀疏数组（或矩阵）——这完全取决于您打算如何使用它。两种可能的策略是：

*   仅存储非零值。对于每个不同于零的元素存储一对（索引，值），所有其他值默认为零。您还需要存储元素的总数。
*   压缩连续的零值。存储许多 (count, value) 对。例如，如果一行中有 12 个零，后跟 200 和另外 22 个零，则存储 (12, 0), (1, 200), (22, 0)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T22:00:44.803

我希望非零值的映射/字典/哈希表应该是一种快速且经济的解决方案。

在 Java 中，使用 Hashtable 类会引入锁定，因为它应该是线程安全的。也许类似的事情减慢了您的实施速度。

**--- 更新：使用 Google-fu 表明 C# Hashtable*确实*会产生线程安全开销。请尝试使用字典。**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T21:48:02.643

您究竟要如何实现它取决于您的要求，这是内存和速度之间的权衡。纯整数数组是最快的，具有恒定复杂度的查找。

使用基于散列的集合，例如 Hashtable 或 Dictionary （Hashtable 似乎更慢但线程安全 - 正如其他人所指出的那样）将为您的稀疏数据结构提供非常低的内存使用率，但可能会更昂贵执行查找。您为每个索引和非零值存储一个键值对。

您可以使用它`ContainsKey`来找出密钥是否存在，但使用它`TryGetValue`来进行检查并一次性获取数据要快得多。对于密集数据，捕获缺失元素的异常是值得的，因为这只会在异常情况下产生成本，而不是每次查找。

*当我让自己感到困惑时再次*编辑- 这将教我在我应该睡觉的时候发帖。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T02:14:22.387

您正在使用 Hashtable 支付拳击罚金。尝试切换到`Dictionary<int, int>`. 此外，我们正在谈论多少行 - 您需要多快？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T21:56:32.953

如果特定行包含非零值，则为非零值和位数组保存指标创建整数数组。

然后，您可以在第一个数组中找到必要的元素，对第二个数组中的位求和，从 0 开始到行索引位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T23:46:24.467

我不确定此解决方案的效率，但您可以尝试。因此，这取决于您将在哪种情况下使用它，但我将在这里写下我想到的其中两个。第一个解决方案是，如果您只有一个整数字段，则可以简单地使用通用整数列表：

```
List<int> myList = new List<int>(); 
```

第二个几乎相同，但是您可以创建自己类型的列表，例如，如果您有两个字段，计数和非零值，您可以创建一个具有两个属性的类，然后您可以创建一个列表您的班级并在其中存储信息。但您也可以尝试通用链表。所以解决方案二的代码可以是这样的：

```
public class MyDbFields
{
    public MyDbFields(int count, int nonzero)
    {
        Count = count;
        NonZero = nonzero;
    }

    public int Count { get; set; }
    public int NonZero { get; set; }
} 
```

然后你可以创建一个这样的列表：

```
List<MyDbFields> fields_list = new List<MyDbFields>(); 
```

然后用数据填充它：

```
fields_list.Add(new MyDbFields(100, 11)); 
```

我不确定这是否会完全帮助您解决问题，但只是我的建议。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T23:49:35.003

如果我理解正确，您不能只选择非零行，因为对于每个行索引（又名 PK 值），您的数据结构不仅必须能够报告该值，而且还必须能够报告它是否存在。因此，如果您在数据结构中找不到它，则假设 0 可能不是一个好主意。

只是为了确保 - 我们在这里谈论的是多少行？百万？一百万个整数作为一个数组只占用 4MB RAM。真的不多。我想它必须至少有 100'000'000 行。

基本上我会建议一个整数对的排序数组来存储非零值。每对中的第一个元素是 PK 值，这就是数组的排序依据。第二个元素是值。当然，您可以进行仅返回这些非零值的 DB 选择。由于数组将被排序，您将能够使用二进制搜索来查找您的值。

如果 PK 值中没有“漏洞”，那么除此之外您唯一需要的就是最小和最大 PK 值，以便您可以确定给定索引是否属于您的数据集。

如果在使用的 PK 值之间存在未使用的 PK 值，那么您需要一些其他机制来确定哪些 PK 值是有效的。可能是位掩码或另一个有效（或无效，以较少者为准）PK 值数组。

如果选择位掩码方式，还有另外一种思路。每个 PK 值使用两位。第一位将显示 PK 值是否有效。第二位将显示它是否为零。将所有非零值存储在另一个数组中。但是，这样做的缺点是您不知道哪个数组项对应于哪个位掩码条目。您必须从一开始就一直数数才能找到答案。这可以通过一些索引来缓解。比如说，对于值数组中的每 1000 个条目，您存储另一个整数，它告诉您该条目在位掩码中的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T03:15:38.363

也许您正在寻找错误的区域 - 您为每个值存储的只是数据库行的行号，这表明您可能只是使用它来检索行？为什么不尝试在数字列上索引您的表 - 这将为任何给定的数值提供对表行的快速访问（这似乎是这里的最终目标？）如果它仍然太慢，您可以将索引本身移动到内存等。我的观点是，您的数据库可能比您更优雅地解决这个问题。

# python - 创建一个包含文件每一行的列表

> ID：328059
> 
> 赞同：41
> 
> 时间：2008-11-29T21:55:53.313
> 
> 标签：python

我正在尝试打开一个文件并创建一个列表，其中包含从文件中读取的每一行。

```
 i=0
   List=[""]
   for Line in inFile:
      List[i]=Line.split(",")
      i+=1
   print List 
```

`i+=1`但是这个示例代码给了我一个错误，因为`index is out of range`. 我这里有什么问题？我如何编写代码以在 InFile 中的每个新行中增加我的列表？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-11-29T22:03:34.733

这比这容易得多：

```
List = open("filename.txt").readlines() 
```

这将返回文件中每一行的列表。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2015-08-10T15:22:21.900

我是这样做的

```
lines_list = open('file.txt').read().splitlines() 
```

每行都带有行尾字符（\n\r）；这样字符就被删除了。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-29T22:06:14.183

```
my_list = [line.split(',') for line in open("filename.txt")] 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-29T22:07:40.483

请阅读[PEP8](http://www.python.org/dev/peps/pep-0008/)。您与 python 约定相差甚远。

如果您想要以逗号分隔的每行列表的列表，我会这样做：

```
l = []
for line in in_file:
    l.append(line.split(',')) 
```

您将在每条记录上获得一个换行符。如果你不想这样：

```
l = []
for line in in_file:
    l.append(line.rstrip().split(',')) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T22:06:39.003

文件*几乎*是行列表。**您可以在for**循环中轻松使用它。

```
myFile= open( "SomeFile.txt", "r" )
for x in myFile:
    print x
myFile.close() 
```

或者，如果您想要一个实际的行列表，只需从文件中创建一个列表。

```
myFile= open( "SomeFile.txt", "r" )
myLines = list( myFile )
myFile.close()
print len(myLines), myLines 
```

您不能`someList[i]`将*新*项目放在列表的末尾。你必须这样做`someList.append(i)`。

此外，*切勿*以大写字母开头的简单变量名。 `List`让了解 Python 的人感到困惑。

此外，*切勿*使用内置名称作为变量。 `list`是一种现有的数据类型，将其用作变量会使了解 Python 的人感到困惑。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T22:07:14.557

f.readlines() 返回一个列表，其中包含每一行作为列表中的一个项目

如果您希望每一行都被拆分（“，”），您可以使用列表推导

```
[ list.split(",") for line in file ] 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-07T12:36:29.130

假设您还想在每行的开头和结尾去除空格，您可以将字符串 strip 函数映射到 readlines 返回的列表：

```
map(str.strip, open('filename').readlines()) 
```

* * *

## 回答 #8

> 赞同：-9
> 
> 时间：2008-11-29T22:01:33.943

我不确定 Python，但大多数语言都有数组的推送/追加功能。

# python - 如何在pygame中制作具有透明背景的表面

> ID：328061
> 
> 赞同：43
> 
> 时间：2008-11-29T21:58:40.300
> 
> 标签：python, transparency, pygame

有人可以给我一些在pygame中创建具有透明背景的表面的示例代码吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-29T22:02:45.563

这应该这样做：

```
image = pygame.Surface([640,480], pygame.SRCALPHA, 32)
image = image.convert_alpha() 
```

确保颜色深度 (32) 保持明确设置，否则这将不起作用。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-09T18:24:22.127

你也可以给它一个颜色键，就像 GIF 文件的透明度一样。这是制作精灵最常用的方法。原位图有原图，并且有某种颜色作为背景，不会被绘制出来，也就是colorkey：

```
surf.set_colorkey((255,0,255)) // Sets the colorkey to that hideous purple 
```

使用 colorkey 而不是 alpha 的表面更快地进行 blit，因为它们不需要任何混合数学。当 SDL 表面有一个颜色键集时，它使用一个简单的位掩码，这几乎没有开销。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-10-24T11:00:43.663

您有 3 种可能性：

*   设置一个透明的颜色键[`set_colorkey()`](https://www.pygame.org/docs/ref/surface.html#pygame.Surface.set_colorkey)

    color 键指定被视为透明的颜色。例如，如果您有一个应该是透明的黑色背景的图像，请设置一个黑色键：

    ```
    my_surface.set_colorkey((0, 0, 0)) 
    ```

*   您可以在创建新曲面时启用其他功能。设置[`SRCALPHA`](https://www.pygame.org/docs/ref/surface.html)标志以创建具有包含每像素 alpha 的图像格式的表面。像素的初始值为 (0, 0, 0, 0)：

    ```
    my_surface = pygame.Surface((width, height), pygame.SRCALPHA) 
    ```

*   用于[`convert_alpha()`](https://www.pygame.org/docs/ref/surface.html#pygame.Surface.convert_alpha)创建具有按像素提供 alpha 的图像格式的*Surface副本。*

    但是，如果您创建一个新表面并使用`convert_alpha()`，则 Alpha 通道最初会设置为最大值。像素的初始值为 (0, 0, 0, 255)。您需要用透明颜色填充整个表面，然后才能在其上绘制任何内容：

    ```
    my_surface = pygame.Surface((width, height))
    my_surface = my_surface.convert_alpha()
    my_surface.fill((0, 0, 0, 0)) 
    ```

# .net - .NET OpenId 库 - 提供者和消费者

> ID：328079
> 
> 赞同：0
> 
> 时间：2008-11-29T22:15:58.297
> 
> 标签：.net, asp.net-mvc, openid

我想为应用添加 OpenId 支持。它在 ASP.NET MVC 上运行，我希望它支持用户的 OpenId 身份验证，并允许用户将应用程序用作 OpenId 提供程序。所以基本上我正在寻找一个好的库，可以用作 OpenId 的提供者和消费者，并且它必须很容易插入到 ASP.NET MVC 中（或者至少很容易被控制器和一组视图包装。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T22:27:15.873

[Stacked](http://code.google.com/p/stacked/) an Open Source implementation of StackOverflow 使用[DotNetOpenID](http://code.google.com/p/dotnetopenid/)我认为 SO 本身也可能使用...

虽然它是建立在 WebControls 范式上的，但我认为你在使用 Microsoft MVC 实现它时会遇到麻烦。

我知道[Grurrah](http://www.grurrah.com/home/)使用基于 WebControl 的 Ajax 库（Gaia Ajax - 我以前的启动）和 Castle 项目 MVC 实现，但我不知道任何语义。虽然 Grurrah 也是开源的，所以我认为您可以轻松浏览它的代码来查看它:)

这意味着您可以将 DotNetOpenID 与 Castle 项目 MVC 库（可能）一起使用，并且您可以使用[Ra-Ajax](http://ra-ajax.org)来实现 Ajax 功能（免责声明；我使用 Ra-Ajax 和 Stacked）

# python - 您如何确定一个点位于线段上的其他两个点之间？

> ID：328107
> 
> 赞同：106
> 
> 时间：2008-11-29T22:37:13.090
> 
> 标签：python, math, geometry

假设您有一个二维平面，上面有 2 个点（称为 a 和 b），每个点用 x 整数和 ay 整数表示。

如何确定另一个点 c 是否在由 a 和 b 定义的线段上？

我最常使用 python，但任何语言的示例都会有所帮助。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-11-29T22:46:45.333

检查 (ba) 和 (ca) 的**叉积**是否为 0，正如 Darius Bacon 所说，告诉您点 a、b 和 c 是否对齐。

但是，当您想知道 c 是否在 a 和 b 之间时，您还必须检查(ba) 和 (ca)的**点积是否为***正*并且*小于*a 和 b 之间距离的平方。

在非优化伪代码中：

```
def isBetween(a, b, c):
    crossproduct = (c.y - a.y) * (b.x - a.x) - (c.x - a.x) * (b.y - a.y)

    # compare versus epsilon for floating point values, or != 0 if using integers
    if abs(crossproduct) > epsilon:
        return False

    dotproduct = (c.x - a.x) * (b.x - a.x) + (c.y - a.y)*(b.y - a.y)
    if dotproduct < 0:
        return False

    squaredlengthba = (b.x - a.x)*(b.x - a.x) + (b.y - a.y)*(b.y - a.y)
    if dotproduct > squaredlengthba:
        return False

    return True 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-11-29T23:39:34.713

这是我的做法：

```
def distance(a,b):
    return sqrt((a.x - b.x)**2 + (a.y - b.y)**2)

def is_between(a,c,b):
    return distance(a,c) + distance(c,b) == distance(a,b) 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-11-29T22:40:05.567

`b-a`检查和的叉积是否`c-a`为`0`：这意味着所有点都共线。如果是，请检查`c`'s 坐标是否在`a`'s 和`b`'s 之间。使用 x 或 y 坐标，只要`a`和`b`在该轴上是分开的（或者它们在两者上相同）。

```
def is_on(a, b, c):
    "Return true iff point c intersects the line segment from a to b."
    # (or the degenerate case that all 3 points are coincident)
    return (collinear(a, b, c)
            and (within(a.x, c.x, b.x) if a.x != b.x else 
                 within(a.y, c.y, b.y)))

def collinear(a, b, c):
    "Return true iff a, b, and c all lie on the same line."
    return (b.x - a.x) * (c.y - a.y) == (c.x - a.x) * (b.y - a.y)

def within(p, q, r):
    "Return true iff q is between p and r (inclusive)."
    return p <= q <= r or r <= q <= p 
```

这个答案曾经是三个更新的混乱。他们提供的有价值的信息：Brian Hayes在*Beautiful Code中的*[章节](http://bit-player.org/bph-publications/BeautifulCode-2007-Hayes.pdf)涵盖了共线性测试函数的设计空间——有用的背景。[文森特的回答](https://stackoverflow.com/questions/328107/how-can-you-determine-a-point-is-between-two-other-points-on-a-line-segment#328337)有助于改进这一点。海耶斯建议只测试 x 或 y 坐标中的一个。最初该代码已代替.*`and``if a.x != b.x else`*

 ** * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-29T23:05:55.093

这是另一种方法：

*   让我们假设两点是 A (x1,y1) 和 B (x2,y2)
*   通过这些点的线的方程是 (x-x1)/(y-y1)=(x2-x1)/(y2-y1) .. （只是使斜率相等）

如果满足以下条件，点 C (x3,y3) 将位于 A 和 B 之间：

*   x3,y3 满足上述等式。
*   x3 位于 x1 和 x2 之间，y3 位于 y1 和 y2 之间（简单检查）

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-30T01:58:59.113

段的长度并不重要，因此不需要使用平方根，应该避免使用，因为我们可能会损失一些精度。

```
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

class Segment:
    def __init__(self, a, b):
        self.a = a
        self.b = b

    def is_between(self, c):
        # Check if slope of a to c is the same as a to b ;
        # that is, when moving from a.x to c.x, c.y must be proportionally
        # increased than it takes to get from a.x to b.x .

        # Then, c.x must be between a.x and b.x, and c.y must be between a.y and b.y.
        # => c is after a and before b, or the opposite
        # that is, the absolute value of cmp(a, b) + cmp(b, c) is either 0 ( 1 + -1 )
        #    or 1 ( c == a or c == b)

        a, b = self.a, self.b             

        return ((b.x - a.x) * (c.y - a.y) == (c.x - a.x) * (b.y - a.y) and 
                abs(cmp(a.x, c.x) + cmp(b.x, c.x)) <= 1 and
                abs(cmp(a.y, c.y) + cmp(b.y, c.y)) <= 1) 
```

一些随机的用法示例：

```
a = Point(0,0)
b = Point(50,100)
c = Point(25,50)
d = Point(0,8)

print Segment(a,b).is_between(c)
print Segment(a,b).is_between(d) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-29T23:14:32.220

使用更几何的方法，计算以下距离：

```
ab = sqrt((a.x-b.x)**2 + (a.y-b.y)**2)
ac = sqrt((a.x-c.x)**2 + (a.y-c.y)**2)
bc = sqrt((b.x-c.x)**2 + (b.y-c.y)**2) 
```

并测试**ac+bc**是否等于**ab**：

```
is_on_segment = abs(ac + bc - ab) < EPSILON 
```

那是因为有三种可能：

*   三个点形成一个三角形 => **ac+bc > ab**
*   它们是共线的并且**c**在**ab**段之外 => **ac+bc > ab**
*   它们是共线的，**c**在**ab**段内 => **ac+bc = ab**

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-11-10T16:48:59.220

这是一种不同的方法，使用 C++ 给出的代码。给定两个点 l1 和 l2 将它们之间的线段表示为是微不足道的

```
l1 + A(l2 - l1) 
```

其中 0 <= A <= 1。如果您对线的向量表示感兴趣，而不仅仅是将其用于此问题。我们可以把它的 x 和 y 分量分开，给出：

```
x = l1.x + A(l2.x - l1.x)
y = l1.y + A(l2.y - l1.y) 
```

取一个点 (x, y) 并将其 x 和 y 分量代入这两个表达式以求解 A。如果两个表达式中 A 的解相等且 0 <= A <= 1，则该点在线。因为求解 A 需要除法，当线段是水平或垂直时，有些特殊情况需要处理以停止除以零。最终解决方案如下：

```
// Vec2 is a simple x/y struct - it could very well be named Point for this use

bool isBetween(double a, double b, double c) {
    // return if c is between a and b
    double larger = (a >= b) ? a : b;
    double smaller = (a != larger) ? a : b;

    return c <= larger && c >= smaller;
}

bool pointOnLine(Vec2<double> p, Vec2<double> l1, Vec2<double> l2) {
    if(l2.x - l1.x == 0) return isBetween(l1.y, l2.y, p.y); // vertical line
    if(l2.y - l1.y == 0) return isBetween(l1.x, l2.x, p.x); // horizontal line

    double Ax = (p.x - l1.x) / (l2.x - l1.x);
    double Ay = (p.y - l1.y) / (l2.y - l1.y);

    // We want Ax == Ay, so check if the difference is very small (floating
    // point comparison is fun!)

    return fabs(Ax - Ay) < 0.000001 && Ax >= 0.0 && Ax <= 1.0;
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-03-27T13:34:06.500

您可以使用楔形和点积：

```
def dot(v,w): return v.x*w.x + v.y*w.y
def wedge(v,w): return v.x*w.y - v.y*w.x

def is_between(a,b,c):
   v = a - b
   w = b - c
   return wedge(v,w) == 0 and dot(v,w) > 0 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-30T08:56:44.260

好的，很多提到线性代数（向量的叉积），这在真实（即连续或浮点）空间中有效，但问题特别指出这两个点表示为**整数**，因此叉积不正确解决方案虽然它可以给出一个近似的解决方案。

正确的解决方案是在两点之间使用[Bresenham 的直线算法，并查看第三个点是否是直线上的点之一。](http://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)如果这些点距离足够远以至于计算算法是无效的（并且它必须非常大才能成为这种情况），我相信你可以四处挖掘并找到优化。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-29T22:51:43.063

(ca) 和 (ba) 之间的标量积必须等于它们长度的乘积（这意味着向量 (ca) 和 (ba) 对齐且方向相同）。此外，（ca）的长度必须小于或等于（ba）的长度。伪代码：

```
# epsilon = small constant

def isBetween(a, b, c):
    lengthca2  = (c.x - a.x)*(c.x - a.x) + (c.y - a.y)*(c.y - a.y)
    lengthba2  = (b.x - a.x)*(b.x - a.x) + (b.y - a.y)*(b.y - a.y)
    if lengthca2 > lengthba2: return False
    dotproduct = (c.x - a.x)*(b.x - a.x) + (c.y - a.y)*(b.y - a.y)
    if dotproduct < 0.0: return False
    if abs(dotproduct*dotproduct - lengthca2*lengthba2) > epsilon: return False 
    return True 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-07-20T23:08:11.937

我需要在 html5 画布中使用 javascript 来检测用户光标是否在某行上方或附近。于是我将 Darius Bacon 给出的答案修改为coffeescript：

```
is_on = (a,b,c) ->
    # "Return true if point c intersects the line segment from a to b."
    # (or the degenerate case that all 3 points are coincident)
    return (collinear(a,b,c) and withincheck(a,b,c))

withincheck = (a,b,c) ->
    if a[0] != b[0]
        within(a[0],c[0],b[0]) 
    else 
        within(a[1],c[1],b[1])

collinear = (a,b,c) ->
    # "Return true if a, b, and c all lie on the same line."
    ((b[0]-a[0])*(c[1]-a[1]) < (c[0]-a[0])*(b[1]-a[1]) + 1000) and ((b[0]-a[0])*(c[1]-a[1]) > (c[0]-a[0])*(b[1]-a[1]) - 1000)

within = (p,q,r) ->
    # "Return true if q is between p and r (inclusive)."
    p <= q <= r or r <= q <= p 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-30T00:45:56.000

以下是我在学校的做法。我忘了为什么这不是一个好主意。

编辑：

@Darius Bacon：[引用了一本“美丽的代码”一书](https://stackoverflow.com/questions/328107/how-can-you-determine-a-point-is-between-two-other-points-on-a-line-segment#328110)，其中解释了为什么下面的代码不是一个好主意。

```
#!/usr/bin/env python
from __future__ import division

epsilon = 1e-6

class Point:
    def __init__(self, x, y):
        self.x, self.y = x, y

class LineSegment:
    """
    >>> ls = LineSegment(Point(0,0), Point(2,4))
    >>> Point(1, 2) in ls
    True
    >>> Point(.5, 1) in ls
    True
    >>> Point(.5, 1.1) in ls
    False
    >>> Point(-1, -2) in ls
    False
    >>> Point(.1, 0.20000001) in ls
    True
    >>> Point(.1, 0.2001) in ls
    False
    >>> ls = LineSegment(Point(1, 1), Point(3, 5))
    >>> Point(2, 3) in ls
    True
    >>> Point(1.5, 2) in ls
    True
    >>> Point(0, -1) in ls
    False
    >>> ls = LineSegment(Point(1, 2), Point(1, 10))
    >>> Point(1, 6) in ls
    True
    >>> Point(1, 1) in ls
    False
    >>> Point(2, 6) in ls 
    False
    >>> ls = LineSegment(Point(-1, 10), Point(5, 10))
    >>> Point(3, 10) in ls
    True
    >>> Point(6, 10) in ls
    False
    >>> Point(5, 10) in ls
    True
    >>> Point(3, 11) in ls
    False
    """
    def __init__(self, a, b):
        if a.x > b.x:
            a, b = b, a
        (self.x0, self.y0, self.x1, self.y1) = (a.x, a.y, b.x, b.y)
        self.slope = (self.y1 - self.y0) / (self.x1 - self.x0) if self.x1 != self.x0 else None

    def __contains__(self, c):
        return (self.x0 <= c.x <= self.x1 and
                min(self.y0, self.y1) <= c.y <= max(self.y0, self.y1) and
                (not self.slope or -epsilon < (c.y - self.y(c.x)) < epsilon))

    def y(self, x):        
        return self.slope * (x - self.x0) + self.y0

if __name__ == '__main__':
    import  doctest
    doctest.testmod() 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-10-27T08:42:26.343

线段 ( **a** , **b** ) 上的任何点（其中**a**和**b**是向量）都可以表示为两个向量**a**和**b的***线性组合*：

 ****换句话说，如果**c**位于线段 ( **a** , **b** ) 上：

```
c = ma + (1 - m)b, where 0 <= m <= 1 
```

求解*m*，我们得到：

```
m = (c.x - b.x)/(a.x - b.x) = (c.y - b.y)/(a.y - b.y) 
```

所以，我们的测试变成了（在 Python 中）：

```
def is_on(a, b, c):
    """Is c on the line segment ab?"""

    def _is_zero( val ):
        return -epsilon < val < epsilon

    x1 = a.x - b.x
    x2 = c.x - b.x
    y1 = a.y - b.y
    y2 = c.y - b.y

    if _is_zero(x1) and _is_zero(y1):
        # a and b are the same point:
        # so check that c is the same as a and b
        return _is_zero(x2) and _is_zero(y2)

    if _is_zero(x1):
        # a and b are on same vertical line
        m2 = y2 * 1.0 / y1
        return _is_zero(x2) and 0 <= m2 <= 1
    elif _is_zero(y1):
        # a and b are on same horizontal line
        m1 = x2 * 1.0 / x1
        return _is_zero(y2) and 0 <= m1 <= 1
    else:
        m1 = x2 * 1.0 / x1
        if m1 < 0 or m1 > 1:
            return False
        m2 = y2 * 1.0 / y1
        return _is_zero(m2 - m1) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-10T08:16:16.110

c# 来自[http://www.faqs.org/faqs/graphics/algorithms-faq/](http://www.faqs.org/faqs/graphics/algorithms-faq/) -> 主题 1.02：如何找到点到线的距离？

```
Boolean Contains(PointF from, PointF to, PointF pt, double epsilon)
        {

            double segmentLengthSqr = (to.X - from.X) * (to.X - from.X) + (to.Y - from.Y) * (to.Y - from.Y);
            double r = ((pt.X - from.X) * (to.X - from.X) + (pt.Y - from.Y) * (to.Y - from.Y)) / segmentLengthSqr;
            if(r<0 || r>1) return false;
            double sl = ((from.Y - pt.Y) * (to.X - from.X) - (from.X - pt.X) * (to.Y - from.Y)) / System.Math.Sqrt(segmentLengthSqr);
            return -epsilon <= sl && sl <= epsilon;
        } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-10-28T11:15:30.643

这是一些对我有用的Java代码：

```
boolean liesOnSegment(Coordinate a, Coordinate b, Coordinate c) {

    double dotProduct = (c.x - a.x) * (c.x - b.x) + (c.y - a.y) * (c.y - b.y);
    return (dotProduct < 0);
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-01-30T10:34:14.683

C# 中使用 Vector2D 类的答案

```
public static bool IsOnSegment(this Segment2D @this, Point2D c, double tolerance)
{
     var distanceSquared = tolerance*tolerance;
     // Start of segment to test point vector
     var v = new Vector2D( @this.P0, c ).To3D();
     // Segment vector
     var s = new Vector2D( @this.P0, @this.P1 ).To3D();
     // Dot product of s
     var ss = s*s;
     // k is the scalar we multiply s by to get the projection of c onto s
     // where we assume s is an infinte line
     var k = v*s/ss;
     // Convert our tolerance to the units of the scalar quanity k
     var kd = tolerance / Math.Sqrt( ss );
     // Check that the projection is within the bounds
     if (k <= -kd || k >= (1+kd))
     {
        return false;
     }
     // Find the projection point
     var p = k*s;
     // Find the vector between test point and it's projection
     var vp = (v - p);
     // Check the distance is within tolerance.
     return vp * vp < distanceSquared;
} 
```

注意

```
s * s 
```

是通过 C# 中的运算符重载得到的段向量的点积

关键是利用点在无限线上的投影，并观察投影的标量告诉我们投影是否在线段上。我们可以调整标量的范围以使用模糊容差。

如果投影在范围内，我们只需测试从点到投影的距离是否在范围内。

与叉积方法相比的好处是容差具有有意义的值。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-07-02T10:09:14.970

Jules 回答的 C# 版本：

```
public static double CalcDistanceBetween2Points(double x1, double y1, double x2, double y2)
{
    return Math.Sqrt(Math.Pow (x1-x2, 2) + Math.Pow (y1-y2, 2));
}

public static bool PointLinesOnLine (double x, double y, double x1, double y1, double x2, double y2, double allowedDistanceDifference)
{
    double dist1 = CalcDistanceBetween2Points(x, y, x1, y1);
    double dist2 = CalcDistanceBetween2Points(x, y, x2, y2);
    double dist3 = CalcDistanceBetween2Points(x1, y1, x2, y2);
    return Math.Abs(dist3 - (dist1 + dist2)) <= allowedDistanceDifference;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-30T20:52:30.557

如何确保斜率相同并且点在其他点之间？

给定点 (x1, y1) 和 (x2, y2) ( x2 > x1) 和候选点 (a,b)

如果 (b-y1) / (a-x1) = (y2-y2) / (x2-x1) 且 x1 < a < x2

那么 (a,b) 必须在 (x1,y1) 和 (x2, y2) 之间

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-10-19T02:50:58.153

这是我在 Unity 中使用 C# 的解决方案。

```
private bool _isPointOnLine( Vector2 ptLineStart, Vector2 ptLineEnd, Vector2 ptPoint )
{
    bool bRes = false;
    if((Mathf.Approximately(ptPoint.x, ptLineStart.x) || Mathf.Approximately(ptPoint.x, ptLineEnd.x)))
    {
        if(ptPoint.y > ptLineStart.y && ptPoint.y < ptLineEnd.y)
        {
            bRes = true;
        }
    }
    else if((Mathf.Approximately(ptPoint.y, ptLineStart.y) || Mathf.Approximately(ptPoint.y, ptLineEnd.y)))
    {
        if(ptPoint.x > ptLineStart.x && ptPoint.x < ptLineEnd.x)
        {
            bRes = true;
        }
    }
    return bRes;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-08-10T15:27:56.773

您可以通过使用点坐标求解该线段的线方程来做到这一点，您将知道该点是否在线上，然后检查线段的边界以了解它是在其内部还是外部。您可以应用一些阈值，因为它位于空间中的某个位置，很可能由浮点值定义，并且您不能达到确切的阈值。php中的示例

```
function getLineDefinition($p1=array(0,0), $p2=array(0,0)){

    $k = ($p1[1]-$p2[1])/($p1[0]-$p2[0]);
    $q = $p1[1]-$k*$p1[0];

    return array($k, $q);

}

function isPointOnLineSegment($line=array(array(0,0),array(0,0)), $pt=array(0,0)){

    // GET THE LINE DEFINITION y = k.x + q AS array(k, q) 
    $def = getLineDefinition($line[0], $line[1]);

    // use the line definition to find y for the x of your point
    $y = $def[0]*$pt[0]+$def[1];

    $yMin = min($line[0][1], $line[1][1]);
    $yMax = max($line[0][1], $line[1][1]);

    // exclude y values that are outside this segments bounds
    if($y>$yMax || $y<$yMin) return false;

    // calculate the difference of your points y value from the reference value calculated from lines definition 
    // in ideal cases this would equal 0 but we are dealing with floating point values so we need some threshold value not to lose results
    // this is up to you to fine tune
    $diff = abs($pt[1]-$y);

    $thr = 0.000001;

    return $diff<=$thr;

} 
```

# database - 一个表和其他一些表之间的最佳关系，每个表都取决于第一个表的 n 个数据集？

> ID：328123
> 
> 赞同：0
> 
> 时间：2008-11-29T22:48:43.600
> 
> 标签：database, entity-relationship

我有一个表可以保存各种内容类型的评论。这些保存在其他表格（新闻、文章、用户）中。我想知道连接这些表的最佳方法是什么？在以前的项目中，我为每种内容使用了第二个表格。他们持有映射到评论表 id 的某些内容的 id。因此，对于每条评论，我都有评论条目本身和一个“连接器”条目。另一种方法是对任何类型的内容使用单独的评论表。最后，两种方式都包含一些冗余缺陷。

那么我应该使用哪一个或者是否有一个解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T23:17:04.930

有一些明显的方法来设计你的桌子：

1) 您可以拥有一个主评论表和中间表，以将每个评论连接到您的文章、新闻和用户表：

```
评论
--------
ID

新闻动态评论
---- ------------
ID NewsID
          评论ID

文章文章评论
-------- ---------------
ID 文章ID
          评论ID

用户用户评论
----- ------------
用户ID
          评论ID
```

这样做的好处是查询每个功能的评论相对容易。但是，这种风格存在引用完整性问题：它可能将单个评论与多个评论、新闻文章和用户联系起来。此外，它的可扩展性不是很好：如果您为 RSS 提要、收藏链接、用户状态等添加评论，那么您就有所有这些类型的中间表。

2）另一种方法是稍微非规范化的版本：

```
评论
--------
ID
表名
PkID（连接其他表中的主键）

消息
----
ID  

文章
--------
ID

用户
-----
ID
```

这很有效，并且在您添加新功能时可以轻松扩展，但是您不能同时将 Comments.RefID 字段键入多个表，因此您失去了参照完整性。

3) 最后一个选项需要为每个功能提供大量冗余的“评论”表。

```
新闻动态评论
---- ------------
ID NewsID

文章文章评论
-------- ---------------
ID 文章ID

用户用户评论
----- ------------
用户ID
```

这种风格的优点是保留了引用完整性，并且任何查看您的模式的人都可以轻松理解。缺点是具有相同架构的表数量过多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T23:00:29.300

我可能会为每个内容表创建一个单独的注释表，以便我可以利用外键关系在更改/删除原始内容时自动管理更新/删除。因此，如果我有新闻和文章表，那么我将有 news_comments 和 article_comments 表。其中每一个都有一个 content_id 字段和一个 user_id 字段。content_id 字段将引用回内容表，而 user_id 字段将引用回用户表。我会在适当的内容和评论表与用户和每个评论表之间建立外键关系，并让更改在更新/删除时传播。您可能还想在 id 字段上设置索引，以便在它们之间进行索引连接。

如果您有一个注释表，则必须在代码中手动管理关系，而不是让数据库为您处理它——因为您只能让 FK 与另一个表相关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T23:10:41.247

您的问题似乎类似于

[如何将一张表关联到许多不同的表？](https://stackoverflow.com/questions/298319/how-do-i-relate-one-table-to-many-different-tables)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T23:57:28.170

另一种方式可能是这样的：

```
Comments
-------
ID
NewsID
ArticleID
UserID 
```

对于每一行，只有一个非零。这将使查询比使用中间表更简单。

然而，从数据完整性的角度来看，为每个 Contents 表设置一个 Comments 表会更明智。

# wpf - 如何将 wpf 窗口移动到负值？

> ID：328127
> 
> 赞同：5
> 
> 时间：2008-11-29T22:53:20.250
> 
> 标签：wpf

如果我使用 dragMove，wpf 窗口将不会移动到 y 值为负的位置。但是，我可以将窗口顶部值设置为负值。是否有一种简单的方法可以启用 dragMove 以允许将窗口顶部移动到显示 0 位置上方？

编辑：

看来这是默认窗口对moveWindow的处理。通过调用 SendMessage(hwnd, WM_SYSCOMMAND, SC_MOVE, null); 进行验证

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T15:55:56.660

正如我发现的那样，窗口将移动到“负”位置，但随后会跳回来。为了防止这种情况，您可以执行以下操作：

```
public partial class Window1: Window {

    public Window1() {
        InitializeComponent();
    }

    private void Window_MouseDown(object sender, MouseButtonEventArgs e) {
        DragMove();
    }

    public struct WINDOWPOS {
        public IntPtr hwnd;
        public IntPtr hwndInsertAfter;
        public int x;
        public int y;
        public int cx;
        public int cy;
        public UInt32 flags;
    };

    private static IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled) {
        switch(msg) {
            case 0x46://WM_WINDOWPOSCHANGING
                if(Mouse.LeftButton != MouseButtonState.Pressed) {
                    WINDOWPOS wp = (WINDOWPOS)Marshal.PtrToStructure(lParam, typeof(WINDOWPOS));
                    wp.flags = wp.flags | 2; //SWP_NOMOVE
                    Marshal.StructureToPtr(wp, lParam, false);
                }
                break;
        }
        return IntPtr.Zero;
    }

    private void Window_Loaded(object sender, RoutedEventArgs e) {
        HwndSource source = HwndSource.FromHwnd(new WindowInteropHelper(this).Handle);
        source.AddHook(new HwndSourceHook(WndProc));
    }        
} 
```

以这种方式处理 WM_WINDOWPOSCHANGING 将阻止窗口的任何移动，除非按下鼠标左键。这包括最大化窗口和窗口位置的编程更改，因此如果您需要其他行为，则必须调整代码。

# mfc - 创建自定义透明控件

> ID：328135
> 
> 赞同：5
> 
> 时间：2008-11-29T23:00:08.117
> 
> 标签：mfc, controls, transparency, alphablending, z-order

我正在尝试创建一个自定义控件，该控件显示具有每像素 alphablend 的位图（正如你们中的一些人已经知道的其他问题）。

现在我在资源编辑器中使用了一个自定义控件，并将它附加到一个从 CWnd 派生的类。当我注册我的自定义类时，我将 WNDCLASS 结构的 hbrBackground 设置为 NULL_BRUSH 以实现控件的透明度。

在控件的 OnPaint 中，我使用 AlphaBlend 绘制每像素 alpha 混合位图。

这工作得很好，但我有这两个问题：

*   当鼠标悬停在控件上时，我想更改显示的位图。由于控件是透明的，因此一个位图未与另一位图重叠的区域不会被擦除。更改图像时如何擦除背景？

*   第二个问题与两个重叠的控件有关。我的控件被绘制在具有渐变的其他控件上（实际上是在其他控件内部）。问题是，如果我将控件放在 z 顺序之前，其他控件会与我的控件重叠并且我的控件不会显示。如果我将另一个控件放在 z 顺序之前，我无法在我的控件中获取鼠标消息。

也许我做错了什么，或者我尝试实施控制的方式错了。任何形式的帮助将不胜感激。

谢谢，

哈维尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-08-17T18:49:43.340

我会抓住机会的。:-)

这应该为您提供完成我认为您想要的一切所需的一切。

[**透明控制的通用解决方案**](http://www.codeproject.com/KB/dialog/transparent-control.aspx)

就 Z 顺序问题而言，z 顺序不影响消息优先级。您需要发布一些代码，以便我们确定那里发生了什么。

# .net - 应用程序的文档管理

> ID：328151
> 
> 赞同：1
> 
> 时间：2008-11-29T23:11:09.310
> 
> 标签：.net, asp.net, document-management

我们正在设计一个需要管理大量文件（文档、电子表格、扫描文件、pdf 等）的应用程序。我们需要将文件与系统中的其他数据相关联。

这将是一个基于 Web 的应用程序。(asp.net)

虽然有很多方法可以解决这个问题，但我在想是否有文档管理后端可以插入到软件中，并使用它的 API 来存储、检索和引用文件。

肯定有一些，但是你知道你过去使用过的任何开源的吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T01:18:14.530

了解您使用的平台会很有帮助。由于我的大部分经验都是使用 Java 平台，因此这里有一些链接：

JSR-170：内容存储库 API [http://www.cmswatch.com/Feature/123](http://www.cmswatch.com/Feature/123)

这是参考实现，Apache Jackrabbit：http: [//jackrabbit.apache.org/](http://jackrabbit.apache.org/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T02:32:48.233

市面上有很多商业文档管理系统，它们可以配置为您需要存储的各种类别。它们通常还支持修订控制和归档。示例包括：

*   [开放式EDMS](http://www.openedms.com/)
*   [文献库](http://www.documentum.com/)
*   [弧形](http://www.software-innovation.com/en/pages/default.aspx)
*   [档案馆](http://www.filehold.com/)

还可以在这里阅读更多内容： [维基百科文章](http://en.wikipedia.org/wiki/Document_management_system)

谷歌搜索可以识别数百种产品，包括来自 Oracle 和 IBM 的产品。

# javascript - 使用 JavaScript 控制 Flash Player

> ID：328194
> 
> 赞同：7
> 
> 时间：2008-11-29T23:40:02.933
> 
> 标签：javascript, flash

我希望能够在与 Flash 组件相同的页面中使用 JavaScript 控制 Flash 电影流，包括：

*   播放和暂停流
*   更改流

我已经可以加载播放器并设置 flash args，但是一旦流开始，我不知道如何与播放器交互。在不修改当前用于播放电影的 SWF 的情况下是否可以这样做？

麦克风。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T01:10:56.213

SWF 需要使用 Flash 库中的 ExternalInterface API 向 Javascript 公开函数。这允许 Javascript 调用 Flash，反之亦然。

[http://livedocs.adobe.com/flex/3/langref/flash/external/ExternalInterface.html](http://livedocs.adobe.com/flex/3/langref/flash/external/ExternalInterface.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T01:18:37.977

“这是否可能在不修改当前用于播放电影的 SWF 的情况下实现”.. 只有当您使用的 SWF 实现具有符合您需求的文档化功能的 ExternalInterface 时才有可能 - 如悬崖.meyers 所述......否则， .... 不

# visual-studio - 如何在visual studio中释放组合键？

> ID：328199
> 
> 赞同：0
> 
> 时间：2008-11-29T23:43:53.020
> 
> 标签：visual-studio, hotkeys

我想为一个功能分配一个热键，但是这些键已经在其他一些功能的组合中使用了。如何轻松地从所有这些条目中删除此热键，以便将其释放并能够将其分配给我想要的功能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T23:53:01.533

我正在使用 Visual Studio C# Express 2008，但您可以进入**Tools/Options/Environment/Keyboard**。如果您将光标放在“**按下快捷键**”字段并键入要重新映射的键，它将显示哪些命令使用该键并让您清除或更改分配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T04:17:36.523

为命令分配一个快捷方式（工具 > 选项 > 环境 > 键盘）。如果它已经被占用，它将显示，但它不会阻止您将其分配给其他东西（这会从原始任务中删除快捷方式）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-13T17:28:51.820

一些关键快捷键是分层的。因此，例如在编辑文本时，文本编辑器键会覆盖全局键。如果您为优先层设置快捷方式，您可以忽略在较低层上分配的任何内容。因此，对于文本编辑键，将它们分配在文本编辑而不是全局下，以避免它们被忽略。

对您遇到的尽可能多的层重复此操作。仅当存在我想要相同快捷方式的其他上下文时，我才会逐步执行此部分。

# java - 如何使用 Hibernate/JPA 注释覆盖 GenerationType 策略？

> ID：328202
> 
> 赞同：12
> 
> 时间：2008-11-29T23:46:25.870
> 
> 标签：java, hibernate, jpa, annotations

我正在考虑使用 Annotations 来定义我的 Hibernate 映射，但遇到了一个问题：我想使用基实体类来定义公共字段（包括 ID 字段），但我希望不同的表具有不同的 ID 生成策略：

```
@MappedSuperclass
public abstract class Base implements Serializable {
    @Id
    @Column(name="ID", nullable = false)
    private Integer id;
    public Integer getId(){return id;}
    public void setId(Integer id){this.id = id;}
    ...
}

@Entity
@Table(name="TABLE_A")
public class TableA extends Base {
    // Table_A wants to set an application-defined value for ID
    ...
}

@Entity
@Table(name="TABLE_B")
public class TableB extends Base {
    // How do I specify @GeneratedValue(strategy = AUTO) for ID here?
    ...
} 
```

有没有办法做到这一点？我已经尝试将以下内容包含在`TableB`但hibernate反对我两次拥有相同的列，这似乎是错误的：

```
@Override // So that we can set Generated strategy
@Id
@GeneratedValue(strategy = AUTO)
public Integer getId() {
    return super.getId();
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T00:03:14.463

在上面的代码中，您似乎在字段（超类）和方法（子类）上混合了注释。Hibernate[参考文档](http://www.hibernate.org/hib_docs/annotations/reference/en/html_single/#entity-mapping-entity)建议避免这种情况，我怀疑它可能会导致问题。根据我使用 Hibernate 的经验，注释 getter/setter 方法而不是字段更安全、更灵活，所以如果可以的话，我建议坚持这种设计。

作为您的问题的解决方案，我建议从您的 Base 超类中完全删除**id字段。**相反，将该字段移动到子类中，并在您的基类中创建抽象**getId()**和**setId()**方法。然后在您的子类中覆盖/实现**getId()**和**setId()**方法，并使用所需的生成策略注释 getter。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T08:18:40.793

在子方法中不要添加第二个 @Id 标记。

```
@Override // So that we can set Generated strategy
@GeneratedValue(strategy = AUTO)
public Integer getId() {
    return super.getId();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-25T04:41:32.557

我的决议：

将类重构`Base`为：

```
@MappedSuperclass
abstract class SuperBase<K> {
    public abstract K getId();
}

@MappedSuperclass
class Base<K> extends SuperBase<K> {
    @Id @GeneratedValue(AUTO)
    public K getId() { ... }
} 
```

然后，您可以从 Base 扩展大多数实体类，如果需要覆盖`@GeneratedValue`，只需扩展`SuperBase`并定义它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T05:01:45.563

如果您将注释放在 getter 而不是字段上，当您在子类中覆盖方法时，将使用放置在那里的注释而不是超类中的注释。

# ios - 子类化 UIViewController，何时以及何时不

> ID：328206
> 
> 赞同：2
> 
> 时间：2008-11-29T23:51:40.960
> 
> 标签：ios, objective-c, iphone, cocoa-touch, uiviewcontroller

我处于一个假设的情况，我需要列出一所学校的学生。我有一个表视图控制器，它有几个部分，代表一所学校。每所学校都有后续学生。现在，我需要让用户能够通过单击导航控制器顶层视图中的学校名称来查看特定学校的所有学生。

这里的问题是，我是否要扩展我当前的“StudentsViewController”并添加复杂的逻辑以允许它显示个别学校的学生，还是您的专家会推荐一个新类来处理该表？

权衡是相当直接的，因为我确实可以将所有内容放在一个视图控制器中，但代价是一些混乱/复杂的逻辑。另一方面，如果我编写另一个控制器来处理个别学校的学生，将会有大量重复的代码。

专家对此有何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T01:01:51.973

我认为最简单的做法是让一个班级处理一系列学校。如果该数组仅包含一项，则可以（可选）不为单个部分显示标题。否则，所有部分都有标题。

将所有学校放入一个数组中，当需要显示一所学校时，将其单独放入一个数组中，然后将其推送到您的视图控制器中。

我们在我们的一个应用程序中做了非常相似的事情，方式基本相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T01:01:19.993

我认为这取决于您用来保存数据的模型。假设您有一组数组，（学校数组，每个学校都有一组学生。）

在这种情况下，我会坚持使用一个 tableController。

如果您的模型设计很简单，则逻辑不必很复杂，而且我认为在这种情况下，它会比多个子类更清洁和“更正确”。不要忘记系统传递给你的任何地方都有一个**NSIndexPath**你有节和行号。（**学校**和**学生**） **indexPath.section**和**indexPath.row**

# c - 是否有无法编译的 C 编译器？

> ID：328215
> 
> 赞同：22
> 
> 时间：2008-11-29T23:56:27.270
> 
> 标签：c

我在我的分析器中闲逛了一段时间，试图弄清楚如何加速一个在日期解析中遇到瓶颈的通用日志解析器，我尝试了各种算法来加快速度。

我尝试的对我来说最快的东西也是迄今为止最易读但可能是非标准的 C。

这在[GCC](http://en.wikipedia.org/wiki/GNU_Compiler_Collection)、[icc](https://en.wikipedia.org/wiki/Intel_C++_Compiler)和我非常古老且挑剔的 SGI 编译器中运行良好。由于它是一个可读性很强的优化，它在哪里没有做我想要的？

```
static int parseMonth(const char *input) {
    int rv=-1;
    int inputInt=0;
    int i=0;

    for(i=0; i<4 && input[i]; i++) {
        inputInt = (inputInt << 8) | input[i];
    }

    switch(inputInt) {
        case 'Jan/': rv=0; break;
        case 'Feb/': rv=1; break;
        case 'Mar/': rv=2; break;
        case 'Apr/': rv=3; break;
        case 'May/': rv=4; break;
        case 'Jun/': rv=5; break;
        case 'Jul/': rv=6; break;
        case 'Aug/': rv=7; break;
        case 'Sep/': rv=8; break;
        case 'Oct/': rv=9; break;
        case 'Nov/': rv=10; break;
        case 'Dec/': rv=11; break;
    }
    return rv;
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-30T01:17:04.017

Solaris 10 - SPARC - SUN 编译器。

测试代码：

```
#include <stdio.h>

static int parseMonth(const char *input) {
    int rv=-1;
    int inputInt=0;
    int i=0;

    for(i=0; i<4 && input[i]; i++) {
        inputInt = (inputInt << 8) | input[i];
    }

    switch(inputInt) {
        case 'Jan/': rv=0; break;
        case 'Feb/': rv=1; break;
        case 'Mar/': rv=2; break;
        case 'Apr/': rv=3; break;
        case 'May/': rv=4; break;
        case 'Jun/': rv=5; break;
        case 'Jul/': rv=6; break;
        case 'Aug/': rv=7; break;
        case 'Sep/': rv=8; break;
        case 'Oct/': rv=9; break;
        case 'Nov/': rv=10; break;
        case 'Dec/': rv=11; break;
    }

    return rv;
}

static const struct
{
    char *data;
    int   result;
} test_case[] =
{
    { "Jan/", 0 },
    { "Feb/", 1 },
    { "Mar/", 2 },
    { "Apr/", 3 },
    { "May/", 4 },
    { "Jun/", 5 },
    { "Jul/", 6 },
    { "Aug/", 7 },
    { "Sep/", 8 },
    { "Oct/", 9 },
    { "Nov/", 10 },
    { "Dec/", 11 },
    { "aJ/n", -1 },
};

#define DIM(x) (sizeof(x)/sizeof(*(x)))

int main(void)
{
    size_t i;
    int    result;

    for (i = 0; i < DIM(test_case); i++)
    {
        result = parseMonth(test_case[i].data);
        if (result != test_case[i].result)
            printf("!! FAIL !! %s (got %d, wanted %d)\n",
                   test_case[i].data, result, test_case[i].result);
    }
    return(0);
} 
```

结果（GCC 3.4.2 和 Sun）：

```
$ gcc -O xx.c -o xx
xx.c:14:14: warning: multi-character character constant
xx.c:15:14: warning: multi-character character constant
xx.c:16:14: warning: multi-character character constant
xx.c:17:14: warning: multi-character character constant
xx.c:18:14: warning: multi-character character constant
xx.c:19:14: warning: multi-character character constant
xx.c:20:14: warning: multi-character character constant
xx.c:21:14: warning: multi-character character constant
xx.c:22:14: warning: multi-character character constant
xx.c:23:14: warning: multi-character character constant
xx.c:24:14: warning: multi-character character constant
xx.c:25:14: warning: multi-character character constant
$ ./xx
$ cc -o xx xx.c
$ ./xx
!! FAIL !! Jan/ (got -1, wanted 0)
!! FAIL !! Feb/ (got -1, wanted 1)
!! FAIL !! Mar/ (got -1, wanted 2)
!! FAIL !! Apr/ (got -1, wanted 3)
!! FAIL !! May/ (got -1, wanted 4)
!! FAIL !! Jun/ (got -1, wanted 5)
!! FAIL !! Jul/ (got -1, wanted 6)
!! FAIL !! Aug/ (got -1, wanted 7)
!! FAIL !! Sep/ (got -1, wanted 8)
!! FAIL !! Oct/ (got -1, wanted 9)
!! FAIL !! Nov/ (got -1, wanted 10)
!! FAIL !! Dec/ (got -1, wanted 11)
$ 
```

请注意，最后一个测试用例仍然通过 - 也就是说，它生成了 -1。

这是 parseMonth() 的修订版 - 更详细 - 在 GCC 和 Sun C 编译器下的工作方式相同：

```
#include <stdio.h>

/* MONTH_CODE("Jan/") does not reduce to an integer constant */
#define MONTH_CODE(x)   ((((((x[0]<<8)|x[1])<<8)|x[2])<<8)|x[3])

#define MONTH_JAN       (((((('J'<<8)|'a')<<8)|'n')<<8)|'/')
#define MONTH_FEB       (((((('F'<<8)|'e')<<8)|'b')<<8)|'/')
#define MONTH_MAR       (((((('M'<<8)|'a')<<8)|'r')<<8)|'/')
#define MONTH_APR       (((((('A'<<8)|'p')<<8)|'r')<<8)|'/')
#define MONTH_MAY       (((((('M'<<8)|'a')<<8)|'y')<<8)|'/')
#define MONTH_JUN       (((((('J'<<8)|'u')<<8)|'n')<<8)|'/')
#define MONTH_JUL       (((((('J'<<8)|'u')<<8)|'l')<<8)|'/')
#define MONTH_AUG       (((((('A'<<8)|'u')<<8)|'g')<<8)|'/')
#define MONTH_SEP       (((((('S'<<8)|'e')<<8)|'p')<<8)|'/')
#define MONTH_OCT       (((((('O'<<8)|'c')<<8)|'t')<<8)|'/')
#define MONTH_NOV       (((((('N'<<8)|'o')<<8)|'v')<<8)|'/')
#define MONTH_DEC       (((((('D'<<8)|'e')<<8)|'c')<<8)|'/')

static int parseMonth(const char *input) {
    int rv=-1;
    int inputInt=0;
    int i=0;

    for(i=0; i<4 && input[i]; i++) {
        inputInt = (inputInt << 8) | input[i];
    }

    switch(inputInt) {
        case MONTH_JAN: rv=0; break;
        case MONTH_FEB: rv=1; break;
        case MONTH_MAR: rv=2; break;
        case MONTH_APR: rv=3; break;
        case MONTH_MAY: rv=4; break;
        case MONTH_JUN: rv=5; break;
        case MONTH_JUL: rv=6; break;
        case MONTH_AUG: rv=7; break;
        case MONTH_SEP: rv=8; break;
        case MONTH_OCT: rv=9; break;
        case MONTH_NOV: rv=10; break;
        case MONTH_DEC: rv=11; break;
    }

    return rv;
}

static const struct
{
    char *data;
    int   result;
} test_case[] =
{
    { "Jan/", 0 },
    { "Feb/", 1 },
    { "Mar/", 2 },
    { "Apr/", 3 },
    { "May/", 4 },
    { "Jun/", 5 },
    { "Jul/", 6 },
    { "Aug/", 7 },
    { "Sep/", 8 },
    { "Oct/", 9 },
    { "Nov/", 10 },
    { "Dec/", 11 },
    { "aJ/n", -1 },
    { "/naJ", -1 },
};

#define DIM(x) (sizeof(x)/sizeof(*(x)))

int main(void)
{
    size_t i;
    int    result;

    for (i = 0; i < DIM(test_case); i++)
    {
        result = parseMonth(test_case[i].data);
        if (result != test_case[i].result)
            printf("!! FAIL !! %s (got %d, wanted %d)\n",
                   test_case[i].data, result, test_case[i].result);
    }
    return(0);
} 
```

我想使用 MONTH_CODE() 但编译器不合作。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-30T00:14:43.597

```
if ( !input[0] || !input[1] || !input[2] || input[3] != '/' )
    return -1;

switch ( input[0] )
{
    case 'F': return 1; // Feb
    case 'S': return 8; // Sep
    case 'O': return 9; // Oct
    case 'N': return 10; // Nov
    case 'D': return 11; // Dec;
    case 'A': return input[1] == 'p' ? 3 : 7; // Apr, Aug
    case 'M': return input[2] == 'r' ? 2 : 4; // Mar, May
    default: return input[1] == 'a' ? 0 : (input[2] == 'n' ? 5 : 6); // Jan, Jun, Jul
} 
```

可读性稍差，验证性也不强，但可能更快，不是吗？

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-30T00:38:53.190

您只是在计算这四个字符的哈希值。为什么不预定义一些以相同方式计算散列的整数常量并使用它们呢？具有相同的可读性，并且您不依赖于编译器的任何实现特定的特质。

```
uint32_t MONTH_JAN = 'J' << 24 + 'a' << 16 + 'n' << 8 + '/';
uint32_t MONTH_FEB = 'F' << 24 + 'e' << 16 + 'b' << 8 + '/';

...

static uint32_t parseMonth(const char *input) {
    uint32_t rv=-1;
    uint32_t inputInt=0;
    int i=0;

    for(i=0; i<4 && input[i]; i++) {
        inputInt = (inputInt << 8) | (input[i] & 0x7f); // clear top bit
    }

    switch(inputInt) {
        case MONTH_JAN: rv=0; break;
        case MONTH_FEB: rv=1; break;

        ...
    }

    return rv;
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-30T00:06:08.870

我只知道 C 标准对此有何评论（C99）：

> 包含多个字符（例如，'ab'）或包含不映射到单字节执行字符的字符或转义序列的整数字符常量的值是实现定义的。如果整数字符常量包含单个字符或转义序列，则其值是将具有单个字符或转义序列的值的 char 类型的对象转换为 int 类型时产生的值。

（6.4.4.4/10 取自草稿）

所以它是实现定义的。这意味着它不能保证它在任何地方都一样，但行为必须由实现记录。例如，如果`int`在特定实现中只有 16 位宽，`'Jan/'`则不能再像您想要的那样表示（`char`必须至少为 8 位，而字符文字始终是类型`int`）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-30T01:54:08.637

```
char *months = "Jan/Feb/Mar/Apr/May/Jun/Jul/Aug/Sep/Oct/Nov/Dec/";
char *p = strnstr(months, input, 4);
return p ? (p - months) / 4 : -1; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-30T00:01:49.927

至少有 3 件事使该程序无法移植：

1.  多字符常量是实现定义的，因此不同的编译器可能会以不同的方式处理它们。
2.  一个字节可以超过 8 位，有很多硬件的最小可寻址内存单元是 16 位甚至 32 位，例如，您经常在 DSP 中找到这一点。如果一个字节超过 8 位，那么`char`因为`char`定义为一个字节长；您的程序将无法在此类系统上正常运行。
3.  最后，有许多机器`int`只有 16 位（这是 int 允许的最小尺寸），包括嵌入式设备和旧机器，您的程序也会在这些机器上失败。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-02T02:37:54.617

[National Instrument's CVI 8.5 for Windows](http://www.ni.com/lwcvi/) compiler fails on your original code with multiple warnings:

```
 Warning: Excess characters in multibyte character literal ignored. 
```

and errors of the form:

```
 Duplicate case label '77'. 
```

It succeeds on Jonathan's code.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-30T00:01:29.270

我收到警告，但没有错误（gcc）。似乎编译和运行良好。 **但是，可能不适用于大端系统！**

不过，我不建议这种方法。也许您可以通过异或而不是或移位来创建单个字节。然后在一个字节上使用 case 语句（或者，更快，使用前 N 位的 LUT）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-30T00:12:47.830

一个四字符常量等价于一个特定的 32 位整数这一事实是一个**非标准**特性，这种特性经常出现在 MS Windows 和 Mac 计算机（以及 PalmOS、AFAICR）的编译器上。

在这些系统上，四个字符串通常用作标识数据文件块的标记，或用作应用程序/数据类型标识符（例如“APPL”）。

那么对于开发人员来说，他们可以将这样的字符串存储到各种数据结构中，而不用担心零字节终止、指针等，这是一种便利。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-30T10:45:57.363

[科莫编译器](http://www.comeaucomputing.com/tryitout/)

```
Comeau C/C++ 4.3.10.1 (Oct  6 2008 11:28:09) for ONLINE_EVALUATION_BETA2
Copyright 1988-2008 Comeau Computing.  All rights reserved.
MODE:strict errors C99 

"ComeauTest.c", line 11: warning: multicharacter character literal (potential
          portability problem)
          case 'Jan/': rv=0; break;
               ^

"ComeauTest.c", line 12: warning: multicharacter character literal (potential
          portability problem)
          case 'Feb/': rv=1; break;
               ^

"ComeauTest.c", line 13: warning: multicharacter character literal (potential
          portability problem)
          case 'Mar/': rv=2; break;
               ^

"ComeauTest.c", line 14: warning: multicharacter character literal (potential
          portability problem)
          case 'Apr/': rv=3; break;
               ^

"ComeauTest.c", line 15: warning: multicharacter character literal (potential
          portability problem)
          case 'May/': rv=4; break;
               ^

"ComeauTest.c", line 16: warning: multicharacter character literal (potential
          portability problem)
          case 'Jun/': rv=5; break;
               ^

"ComeauTest.c", line 17: warning: multicharacter character literal (potential
          portability problem)
          case 'Jul/': rv=6; break;
               ^

"ComeauTest.c", line 18: warning: multicharacter character literal (potential
          portability problem)
          case 'Aug/': rv=7; break;
               ^

"ComeauTest.c", line 19: warning: multicharacter character literal (potential
          portability problem)
          case 'Sep/': rv=8; break;
               ^

"ComeauTest.c", line 20: warning: multicharacter character literal (potential
          portability problem)
          case 'Oct/': rv=9; break;
               ^

"ComeauTest.c", line 21: warning: multicharacter character literal (potential
          portability problem)
          case 'Nov/': rv=10; break;
               ^

"ComeauTest.c", line 22: warning: multicharacter character literal (potential
          portability problem)
          case 'Dec/': rv=11; break;
               ^

"ComeauTest.c", line 1: warning: function "parseMonth" was declared but never
          referenced
  static int parseMonth(const char *input) {
             ^ 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-30T00:13:27.687

抛开机器字长问题不谈，您的编译器可能会将 input[i] 提升为负整数，这只会使用 or 操作设置 inputInt 的高位，因此我建议您明确说明 char 变量的符号性。

但是由于在美国，没有人关心第 8 位，这对您来说可能不是问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-30T01:31:04.863

我肯定很想看到显示*这*是您最重要的瓶颈的分析，但无论如何，如果您要提取这样的东西，请使用联合而不是 50 条指令循环和移位。这是一个小示例程序，我将把它留给你来适应你的程序。

```
/* union -- demonstrate union for characters */

#include <stdio.h>

union c4_i {
    char c4[5];
    int  i ;
} ;

union c4_i ex;

int main (){
    ex.c4[0] = 'a';
    ex.c4[1] = 'b';
    ex.c4[2] = 'c';
    ex.c4[3] = 'd';
    ex.c4[4] = '\0';
    printf("%s 0x%08x\n", ex.c4, ex.i );
    return 0;
} 
```

这是示例输出：

```
bash $ ./union
abcd 0x64636261
bash $ 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-30T18:38:45.943

正如其他人所提到的，该代码会引发一堆警告，并且可能不是字节序安全的。

你原来的日期解析器也是手写的吗？你试过 strptime(3) 吗？

# c# - DictionaryBase 到泛型。

> ID：328235
> 
> 赞同：2
> 
> 时间：2008-11-30T00:12:34.023
> 
> 标签：c#, winforms, generics

如果我有一个继承自 DictionaryBase 的 .net 1.1 类，并且我将其移至 2.0 .. 将其更改为的泛型是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T00:16:41.207

您正在寻找[KeyedCollection](http://msdn.microsoft.com/en-us/library/ms132438.aspx)

# java - 如何在java中连接字符？

> ID：328249
> 
> 赞同：41
> 
> 时间：2008-11-30T00:22:49.790
> 
> 标签：java, character, concatenation

你如何在java中连接字符？连接字符串只需要`+`字符串之间的 a ，但是使用连接字符`+`会将 char 的值更改为 ascii 并因此给出数字输出。我想做`System.out.println(char1+char2+char3...`并创建一个这样的字符串词。

我可以

```
System.out.print(char1);
System.out.print(char2);
System.out.print(char3); 
```

但是，这只会让我得到 1 行中的字符。我需要它作为字符串。任何帮助，将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-11-30T00:28:46.703

你想用它们做一个字符串吗？

```
String s = new StringBuilder().append(char1).append(char2).append(char3).toString(); 
```

注意

```
String b = "b";
String s = "a" + b + "c"; 
```

实际上编译为

```
String s = new StringBuilder("a").append(b).append("c").toString(); 
```

**编辑**：正如 litb 指出的，你也可以这样做：

```
"" + char1 + char2 + char3; 
```

编译为以下内容：

```
new StringBuilder().append("").append(c).append(c1).append(c2).toString(); 
```

**编辑（2）**：更正了字符串追加比较，因为正如 cletus 指出的那样，编译器处理了一系列字符串。

上面的目的是说明编译器做了什么，而不是告诉你应该做什么。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-30T01:56:43.203

我不打算回答这个问题，但这里有两个答案（正在被投票！）这是完全错误的。考虑这些表达式：

```
String a = "a" + "b" + "c";
String b = System.getProperty("blah") + "b"; 
```

第一个是在**编译时**评估的。第二个是在**运行时**评估的。

所以**永远不要**用 StringBuilder、StringBuffer 等替换常量连接（任何类型）。仅在涉及变量的情况下使用那些，并且通常仅在您附加大量操作数或在循环中附加时使用。

如果字符是恒定的，这很好：

```
String s = "" + 'a' + 'b' + 'c'; 
```

但是，如果不是，请考虑以下问题：

```
String concat(char... chars) {
  if (chars.length == 0) {
    return "";
  }
  StringBuilder s = new StringBuilder(chars.length);
  for (char c : chars) {
    s.append(c);
  }
  return s.toString();
} 
```

作为适当的解决方案。

然而，有些人可能会倾向于优化：

```
String s = "Name: '" + name + "'"; // String name; 
```

进入这个：

```
String s = new StringBuilder().append("Name: ").append(name).append("'").toString(); 
```

虽然这是善意的，但底线是**不要**。

为什么？正如另一个答案正确指出的那样：编译器会为您执行此操作。所以在你自己做的时候，你不允许编译器优化代码或者不取决于它是否是一个好主意，代码更难阅读并且它不必要的复杂。

**对于低级优化，编译器比你更擅长优化代码。**

让编译器完成它的工作。在这种情况下，最坏的情况是编译器隐式地将您的代码更改为您编写的代码。连接 2-3 个字符串可能比构造 StringBuilder 更有效，因此最好保持原样。编译器知道在这方面什么是最好的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-30T00:30:58.040

如果您有一堆字符并想将它们连接成一个字符串，为什么不这样做

```
System.out.println("" + char1 + char2 + char3); 
```

?

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-30T06:33:59.620

您可以使用[String 构造函数](http://java.sun.com/javase/6/docs/api/java/lang/String.html#String(char[]))。

```
System.out.println(new String(new char[]{a,b,c})); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-30T00:30:06.997

您需要通过以字符串开始序列（甚至是空字符串）来告诉编译器您想要进行字符串连接。像这样：

```
System.out.println("" + char1 + char2 + char3...); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-21T16:50:40.793

```
System.out.println(char1+""+char2+char3) 
```

或者

```
String s = char1+""+char2+char3; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-30T00:29:53.427

您需要一个具有某种描述的 String 对象来保存您的串联字符数组，因为该`char`类型将只保存一个字符。例如，

```
StringBuilder sb = new StringBuilder('a').append('b').append('c');
System.out.println(sb.toString); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-02T22:32:18.463

公共类首字母{

```
public static void main (String [] args) {

    char initialA = 'M';
    char initialB = 'P';
    char initialC = 'T';

    System.out.println("" + initialA + initialB + initialC );

} 
```

}

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-10-29T06:16:10.753

我真的不认为自己是一个 Java 程序员，但只是想我会在这里“为了完整性”添加它；使用（C-inspired）`String.format`静态方法：

```
String s = String.format("%s%s", 'a', 'b'); // s is "ab" 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-04-19T11:48:01.523

> 这是连接或附加字符的非常简单的方法

```
 StringBuilder desc = new StringBuilder(); 
       String Description="this is my land"; 
       desc=desc.append(Description.charAt(i)); 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2017-04-17T19:24:14.940

从字符串中选择字符并附加到字符串变量的简单示例

private static String findaccountnum(String holdername, String mobile) {

```
 char n1=holdername.charAt(0);
    char n2=holdername.charAt(1);
    char n3=holdername.charAt(2);
    char n4=mobile.charAt(0);
    char n5=mobile.charAt(1);
    char n6=mobile.charAt(2);
    String number=new StringBuilder().append(n1).append(n2).append(n3).append(n4).append(n5).append(n6).toString();

    return number;
} 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2016-08-09T09:40:04.147

```
System.out.print(a + "" + b + "" + c); 
```

# linux - 脚本正在重新读取参数

> ID：328264
> 
> 赞同：1
> 
> 时间：2008-11-30T00:41:26.787
> 
> 标签：linux, bash, shell, scripting

当我为脚本提供参数时： hi[123].txt 它将完全按照我的意愿执行。但是，如果我指定通配符（ hi*.txt ），它将重新读取一些文件。

我想知道如何修改这个脚本来解决这个愚蠢的问题：

```
#!/bin/sh

count="0"
total="0"
FILE="$1"  #FILE specification is now $1 Specification..

for FILE in $@
do
  #if the file is not readable then say so
     if [ ! -r $FILE ];
         then
         echo "File: $FILE not readable"
     exit 0
     fi

# Start processing readable files
  while read line
          do

             if [[ "$line" =~ ^Total ]];
                 then
                   tmp=$(echo $line | cut -d':' -f2)

                   total=$(expr $total + $tmp)

                   echo "$FILE (s) have a total of:$tmp "
                   count=$(expr $count + 1)

             fi

        done < $FILE
done
echo " Total is: $total"
echo " Number of files read is:$count" 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T01:03:01.050

我不知道它有什么问题，但我注意到了一点：

更改`for FILE in $@`为`for FILE in "$@"`. 因为如果文件有嵌入的空格，你现在就安全了。它将扩展到`"$1" "$2" ...`then，而不是`$1 $2 ...`（并注意您使用 $FILE 的任何地方也记住`""`它）。

`FILE`和别人说的一样，进入循环前不需要初始化。它将自动设置为 for 循环中扩展位置参数的每个文件名。

但是，我会使用这样的 awk 脚本：

```
awk -F: '
/^Total/ { 
    total += $2
    # count++ not needed. see below
    print FILENAME "(s) have a total of: " $2
} 

END { 
    print "Total is: " total
    print "Number of files read is: " (ARGC-1) 
}' foo*.txt 
```

请注意，当一个文件包含多个“^Count”行时，如果您依靠`count`告诉您读取的文件数，您确实会说您读取的文件比实际读取的要多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T01:05:25.337

这似乎是多余的：

```
FILE="$1"  #FILE specification is now $1 Specification..

for FILE in $@
  ... 
```

初始分配会立即被覆盖。

总的来说，这似乎是一项更适合像 awk 或 perl 这样的行处理语言的任务。

考虑一下这个 awk 脚本的内容：

```
BEGIN{
   TOTAL=0;
   COUNT=0;
   FS=':';
}
/^Total/{
   TOTAL += $2;
   COUNT++;
   printf("File '%s' has a total of %i",FILENAME,TOTAL);
}
END{
   printf("Total is %i",TOTAL);
   printf("Number of files read is%i",COUNT);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T01:03:48.757

这个解决方案怎么样：

```
for FILE in `/bin/ls $@`
do
. . . 
```

这将有效地消除重复，因为`/bin/ls hi1.txt hi1.txt hi1.txt`应该只显示`hi1.txt`一次。

虽然我不确定它为什么要重新读取文件。通配符扩展应该只包含每个文件一次。您是否有一些匹配的文件`hi*.txt`是指向匹配的文件的链接`hi[123].txt`？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T01:39:36.467

出错时，以非零状态退出。同样在错误时，将错误报告给标准错误，而不是标准输出——尽管这对你来说可能有点先进。

```
echo "$0: file $FILE not readable" 1>&2 
```

1 理论上是不必要的（尽管我记得如果省略它，Windows 上的 shell 实现会出现问题）。在错误消息的开头回显脚本名称 ' `$0`' 也是一个好主意 - 当您的脚本在其他上下文中使用时，它使错误跟踪更容易。

我相信这个 Perl 单行代码可以完成您所追求的工作。

```
perl -na -F: -e '$sum += $F[1] if m/^Total:/; END { print $sum; }' "$@" 
```

我知道您正在学习 shell 编程，但是 shell 编程的重要内容之一是知道要使用哪些程序。

# objective-c - NSTableView -setDataSource 在由 FSEvents 触发时不起作用

> ID：328277
> 
> 赞同：0
> 
> 时间：2008-11-30T00:54:19.647
> 
> 标签：objective-c, cocoa, macos, fsevents

所以这就是我所拥有的：

*   带有 NSMutableArray 数据源的 NSTableView
*   FSEvents 监视包含包含表视图数据的文件的文件夹（使用[SCEvents](http://stuconnolly.com/blog/archive/2008/05/08/fsevents-objectivec-wrapper)实现 Objective-C 抽象优势）
*   FSEvents 触发与 UI 中的重新加载按钮相同的功能。此函数根据所述文件的内容，使用新的数据源刷新表格视图`setDataSource:`。

这就是发生的事情：

*   如果我对文件进行更改，则会触发 FSEvent 并调用刷新方法。
*   表视图应该接受的数组确实包含触发 FSEvent 的更改。
*   `setDataSource:`使用正确的数据源发送到 NSTableView。
*   更改不会出现在表格视图中！

但是之后：

*   如果我点击刷新按钮，它触发与 FSEvent 完全相同的方法，表格视图将使用新数据进行更新。

我还尝试用 NSNotification ( `NSApplicationDidBecomeActiveNotification`) 替换 FSEvent，但同样的事情发生了。

有人知道为什么会这样吗？

编辑：为了澄清起见，我的问题的要点是：为什么我的 NSTableView 会在按下按钮触发时重新加载，而不是在由 FSEvent 或 NSNotification 触发时重新加载？

编辑：感谢[diciu](https://stackoverflow.com/questions/328277/nstableview-setdatasource-not-working-when-triggered-by-fsevents#328648)，我发现实际上我的所有 UI 引用在事件触发时都指向 0x0，但在按钮单击触发时具有有效地址。这些对象都在 IB 中声明，因此在我的代码中没有对它们进行实例化或分配。所以我现在的问题是：我能做些什么来阻止这些指针指向 nil？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T02:29:35.900

当我们有新数据要添加/删除到表中时，我们会在 NSTableView 上调用**reloadData 。**

这可能有助于强制 NSTableView 重绘。

我不确定这是否是您的要求。你问题的措辞有点令人困惑，你陈述了一系列事件，但从来没有一个真正的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T02:29:17.380

您是否尝试过在第二次运行循环中从 FSEvent 调用您的方法？

```
[myObject performSelector:@selector(reloadAction:) withObject:nil afterDelay:0.0]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T07:23:31.703

您要`NSArray`直接设置为表视图的数据源？

这不是如何`NSTableView`工作的。数据源必须是符合[`NSTableDataSource`](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Protocols/NSTableDataSource_Protocol/). `NSArray`没有。您自己编写数据源；它可能与您当前调用的对象相同`setDataSource:`。

另一种方法是使用绑定。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T08:56:47.380

可能是刷新方法范围内对表视图的引用无效吗？

即你确定你没有调用不会产生任何错误的 [nil reloadData] 吗？如果您在 awakeFromNib 之前或在某些其他情况下设置刷新代码，则您对表格视图的引用可能为零。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T23:43:04.970

听起来当您注册事件/通知时，您正在传递控制器类的不同实例。

# windows - 为什么在 POST 请求中出现“Content-Length: 0”？

> ID：328281
> 
> 赞同：56
> 
> 时间：2008-11-30T00:59:57.467
> 
> 标签：windows, internet-explorer, http, web-applications, proxy

客户有时会在提交表单时发送 POST 请求`Content-Length: 0`（10 到 40 多个字段）。

我们使用不同的浏览器和不同的位置对其进行了测试，但无法重现该错误。客户正在使用 Internet Explorer 7 和代理。

我们要求他们让他们的系统管理员从他们的角度看待问题。在没有代理的情况下运行一些测试等。

与此同时（半年后仍然没有答案）我很好奇其他人是否知道类似的`Content-Length: 0`请求问题。也许来自一些 Windows 网络内部，为大公司提供了特殊代理。

Internet Explorer 7 是否存在已知问题？使用代理系统？Windows 网络本身？

Google 仅在 NTLM（和此类）身份验证的上下文中显示了一些内容，但我们没有在 Web 应用程序中使用它。可能是代理在使用 Windows 登录的客户网络中运行的方式？（我不是 Windows 专家。只是猜测。）

我没有关于基础设施的更多信息。

**更新：**在 2010 年 12 月，可以将此通知一位管理员，包括。来自这里的答案的链接。联系也是因为代理引起的另一个问题。从那以后没有任何反馈。并且错误消息仍然存在。我笑是为了不让我哭。

**更新 2：**这个问题自 2008 年中期以来就存在。每隔几个月，客户就会感到恼火，并希望尽快修复它。我们再次向他们发送所有旧电子邮件，并要求他们联系他们的管理员来修复它或运行一些进一步的测试。2010 年 12 月，我们能够向 1 位管理员发送一些信息。没有反馈。问题没有解决，我们不知道他们是否尝试过。并且在 2011 年 5 月，客户再次写信并希望解决此问题。自 2008 年以来拥有所有信息的同一个人。

感谢所有的答案。正如我从这里的一些评论中看到的那样，你帮助了很多人。太糟糕了，现实世界对我来说是这样的怪诞。

**更新 3：** 2012 年 5 月，我想知道为什么我们没有收到另一个解决此问题的要求（请参阅更新 2）。调查了错误协议，它每次发生时只报告这个单一的错误（大约每天 15 次）。它于 2012 年 1 月结束。没有人说什么。他们一定对他们的网络做了什么。现在一切正常。从 2008 年夏天到 2012 年 1 月。太糟糕了，我不能告诉你他们做了什么。

**更新 4：** 2015 年 9 月。网站必须收集一些数据并将其传送到客户的主网站。有一个带有帐户的 API。每当出现问题时，他们都会联系我们，即使问题显然在另一边。几个星期以来，我们无法向他们发送数据。该帐户不再可用。他们重新启动了，我再也找不到使用我们网站数据的页面了。错误报告没有得到答复，也没有人抱怨。我猜他们刚刚结束了这个项目。

**更新 5：** 2017 年 3 月。API 在 2015 年夏天停止工作。客户似乎继续为该网站付费，并且仍在 2017 年 2 月访问它。我猜他们将其用作存档。他们不再创建或更新任何数据，因此这个错误可能不会在 2012 年 1 月的神秘修复之后重新出现。但这将是其他人的问题。我走了。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-10T13:04:49.613

如果表单字段从经过身份验证的站点 (NTLM) 发布到未经过身份验证的站点（匿名），Internet Explorer 不会发送它们。

这是挑战响应情况（NTLM 或 Kerberos 安全网站）的功能，其中 IE 可以预期第一个 POST 请求立即导致*HTTP 401 Authentication Required*响应（包括质询），并且只有第二个 POST 请求（其中包括对挑战的回应）实际上将被接受。在这些情况下，出于性能原因，IE 不会将可能较大的请求正文与第一个请求一起上传。感谢[EricLaw](https://stackoverflow.com/questions/328281/why-content-length-0-in-post-requests/630059?noredirect=1#comment24906051_630059)在评论中发布这些信息。

每次从 NTLM 已验证（即 Intranet）页面到未验证（即 Internet）页面的 HTTP POST 时，或者如果未验证页面是框架集的一部分，框架集页面已在其中验证，则会发生此行为。

解决方法是使用 GET 请求作为表单方法，或者确保未经过身份验证的页面在没有部分经过身份验证的框架集的情况下在新的选项卡/窗口（收藏夹/链接目标）中打开。一旦整个窗口的认证模型一致，IE就会重新开始发送表单内容。

* * *

*   绝对相关：[http ://www.websina.com/bugzero/kb/browser-ie.html](http://www.websina.com/bugzero/kb/browser-ie.html)
*   可能相关：[KB923155](https://web.archive.org/web/20130925033628/http://support.microsoft.com:80/kb/923155)
*   **完整说明**：[IEInternals 博客 – 质询-响应身份验证和零长度帖子](http://blogs.msdn.com/b/ieinternals/archive/2010/11/22/internet-explorer-post-bodies-are-zero-bytes-in-length-when-authentication-challenges-are-expected.aspx)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-04-13T06:49:39.187

这很容易通过 MS-IE 和服务器端的 NTLM 身份验证过滤器重现。我对 XP-SP2 上的 JCIFS (1.2\. *)、struts 1.*和 MS-IE 6/7 有同样的问题。终于修好了。有几种解决方法可以弥补。

1.  将表单方法从 POST（struts 默认设置）更改为 GET。对于大多数具有小尺寸表单的页面，它运行良好。不幸的是，我可能有超过 50 条记录要在 HTTP 流中发送回服务器端。IE 的 GET URL 限制为 2038 字节（不是参数长度，而是整个 URL 长度）。所以这是一个快速的解决方法，但不适用于我。

2.  在执行 POST 操作之前发送 GET。这是在 MS-KB 中推荐的。我的项目有许多遗留程序，我不会在正确的时间冒险。我从未尝试过，因为根据我对 MS-KB 的理解，当过滤层接收到 GET 时，它仍然需要一些额外的身份验证处理，而且我不想改变其他浏览器的行为，例如 Firefox、Opera。

3.  检测是否以零内容长度发送 POST（您可以使用框架从标头属性哈希结构中获取它）。如果是这样，请通过从 DC 或缓存中获取质询代码来触发 NTLM 身份验证周期，并期待 NTLM 响应。当收到 NTLM type2 msg 并且会话仍然有效时，您实际上不需要对用户进行身份验证，只需将其转发到预期的操作（如果 POST 内容长度不为零）。顺便说一句，这会增加网络流量。因此，请在应用更改之前检查您的缓存寿命设置和 SMB 会话 soTimeOut 配置。或者，更简单，您可以只向 MS-IE 发送 401 未授权状态，然后浏览器将发送回 POST 请求和数据作为回复。

4.  MS-KB 提供了一个带有 KB-923155 的热修复程序（我不能发布多个链接，因为信誉数低 :{ ），但它似乎不起作用。有人会在这里发布一个可行的热修复吗？谢谢 :) 这是一个参考链接，[http://www.websina.com/bugzero/kb/browser-ie.html](http://www.websina.com/bugzero/kb/browser-ie.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-01T09:23:13.990

我们的系统上有一个客户遇到了完全相同的问题。我们已将其指向代理/防火墙。微软的 IAS。它正在剥离 POST 正文并发送 content-length: 0。然而，我们无法解决很多问题，并且想要使用 GET 请求，因为这会在 URL 字符串上暴露用户名/密码等。我们的系统上有近 7,000 个用户，只有一个有问题……也只有一个使用 Microsoft IAS，所以它必须是这个。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-11T21:05:06.970

**问题很可能是中间的代理服务器实现了 HTTP 1.0。**

在 HTTP 1.0 中，您必须使用 Content-Length 标头字段：（[请参阅此处的第 10.4 节](http://www.w3.org/Protocols/HTTP/1.0/spec.html#Content-Length)）

> 所有 HTTP/1.0 POST 请求都需要有效的 Content-Length。如果 HTTP/1.0 服务器无法确定请求消息内容的长度，它应该以 400（错误请求）消息进行响应。

进入代理的请求是 HTTP 1.1，因此不需要使用 Content-Length 标头字段。通常使用 Content-Length 标头，但并非总是如此。[请参阅HTTP 1.1 RFC S. 14.13](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.13)的以下摘录。

> [应用程序应该使用这个字段来指示消息体的传输长度，除非这被第 4.4 节](http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4)中的规则禁止。任何大于或等于零的 Content-Length 都是有效值。
> 
> 第[4.4](http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4)节描述了在没有给出 Content-Length 的情况下如何确定消息体的长度。

因此，代理服务器看不到 Content-Length 标头，它假设在 HTTP 1.0 中如果有正文则绝对需要该标头。因此它假定为 0，以便请求最终到达服务器。请记住，代理不知道 HTTP 1.1 规范的规则，因此它不知道如何处理没有 Content-Length 标头的情况。

您是否 100% 确定您的请求指定了 Content-Length 标头？如果它使用第 4.4 节中定义的另一种方式，因为它认为服务器是 1.1（因为它不知道中间的 1.0 代理），那么您将遇到您所描述的问题。

也许您可以改用 HTTP GET 来绕过这个问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-11T19:49:18.090

这是 Internet Explorer 6 的已知问题，但不是我所知道的 7。您可以为 IE6 [KB831167](http://www.microsoft.com/downloads/details.aspx?FamilyID=254eb128-5053-48a7-8526-bd38215c74b2&displaylang=en)修复安装此修复。

你可以[在这里阅读更多关于它的信息](http://publib.boulder.ibm.com/infocenter/wasinfo/v4r0/index.jsp?topic=/com.ibm.support.was.doc/html/Plug-in/1165399.html)。

给你一些问题：

*   你知道代理的类型吗？
*   您知道请求中是否发送了实际的正文？
*   每次都持续发生吗？还是只是有时？
*   请求中是否发送了任何二进制数据？也许数据以 \0 开头，并且代理有二进制数据的错误。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-30T15:32:15.157

如果用户正在通过使用 NTLM 身份验证的 ISA 代理，那么听起来像这个问题，它提供了一个解决方案（ISA 代理的补丁）

[http://support.microsoft.com/kb/942638](http://support.microsoft.com/kb/942638)
没有 POST 正文的 POST 请求可能会发送到在 ISA Server 2006 中发布的 Web 服务器

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-06-30T18:08:18.177

我还遇到了一个问题，即来自客户的 IE 11 浏览器的请求`Content-Length: 0`包含但不包含预期的 POST 内容。当客户使用 Firefox 或 Chrome 时，请求中包含预期的内容。

我发现原因是客户使用的是 HTTP URL 而不是 HTTPS URL（例如`http://...`，not `https://...`），而我们的应用程序使用 HSTS。似乎 IE 11 中可能存在一个错误，即当请求由于 HSTS 升级到 HTTPS 时，请求内容会丢失。

让客户更正 URL 以`https://...`使内容包含在 POST 请求中并解决问题。

在这个阶段，我还没有进一步调查它是否真的是 IE 11 中的一个错误。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-30T01:28:03.510

您确定这些请求来自“客户”吗？

我以前遇到过机器人的问题；他们有时会根据他们在抓取过程中发现的 FORM 标记中的操作 URI 发送空白 POST 请求来探测站点以查找“联系我们”表单。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-30T09:03:03.390

HTTP 中 ContentLength 标头的存在和可能值在 HTTP（我假设 1/1）RFC 中进行了描述：

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.13](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.13)

> *在 HTTP 中，只要可以在传输之前确定消息的长度，就应该发送它*

也可以看看：

> *如果接收到的消息同时带有 Transfer-Encoding 头字段和 Content-Length 头字段，则必须忽略后者。* [http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4](http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.4)

也许您的消息带有 Transfer-Encoding 标头？

稍后编辑：还请注意 RFC 中使用的“应该”非常重要，不等同于“必须”：

> *3\. 应该 这个词，或形容词“推荐”，意味着在特定情况下可能存在忽略特定项目的正当理由，但在选择不同的课程之前必须理解并仔细权衡全部含义。* 参考：[http ://www.ietf.org/rfc/rfc2119.txt](http://www.ietf.org/rfc/rfc2119.txt)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-09-15T06:25:17.730

我们有一位客户以匿名和 NTLM 模式（在不同端口上）使用同一网站。我们发现，在我们的案例中，401 与用于 http 优化的 Riverbed Steelhead 应用程序有关。将我们指向该方向的第一个信号是 X-RBT-Optimized-By 标头。问题是免费的 401 功能：

> 此功能可与按请求和按连接身份验证一起使用，但在与按请求身份验证一起使用时最有效。使用按请求身份验证，必须先针对服务器对每个请求进行身份验证，然后服务器才能将对象提供给客户端。但是，大多数浏览器不会缓存需要身份验证的服务器响应，因此每个 GET 请求都会浪费一次往返。使用 Gratuitous 401，客户端 Steelhead 设备将缓存服务器响应，当客户端发送没有任何身份验证标头的 GET 请求时，它将在本地响应“401 Unauthorized”消息，从而节省往返行程。请注意，HTTP 模块本身并不参与实际的身份验证。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-17T23:38:48.740

Microsoft 的[KB821814](http://support.microsoft.com/kb/821814)修补程序可以将 Content-Length 设置为 0：

> 本文介绍的修补程序将 Wininet.dll 中的代码更改为：
> 
> *   检测 POST 请求的 RESET 条件。
> *   保存要发布的数据。
> *   重试 POST 请求并将内容长度设置为 0。这可以防止发生重置并允许完成身份验证过程。
> *   重试原始 POST 请求。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-30T07:43:17.450

在 https 连接达到 keepalive 超时并重新连接到服务器后，Google 还将其显示为 IE（无论如何都是某些版本）错误。该解决方案似乎将服务器配置为在 https 下不对 IE 使用 keepalive。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-03-04T09:22:49.330

`curl`在配置为使用 HTTP 代理时发送`PUT/POST`请求。在第一次未经授权的代理请求`Content-Length: 0`的情况下克服所需的缓冲是一个技巧。`PUT/POST`在`GET/HEAD`请求`curl`的情况下，只需重复查询。的方案`PUT/POST`是这样的：

1.  发送设置为 0 的第一个`PUT/POST`请求。`Content-Length`

2.  得到答案。HTTP 状态码 407 意味着我们必须使用代理授权。为发送请求准备代理身份验证的标头。

3.  再次发送请求，并使用填充的标头进行代理身份验证，并将真实数据发送到 POST/PUT。

# caching - 反向代理HTTP请求的后处理？（如 Akamai 的 ESI）

> ID：328309
> 
> 赞同：6
> 
> 时间：2008-11-30T01:27:50.343
> 
> 标签：caching, proxy, amazon, reverse-proxy, edge-side-includes

我们经营着一个内容量相对较大的网站。像大多数内容网站一样，每个页面的大部分内容都是相对静态的。这些文章很少改变，使它们成为某种形式的静态/边缘缓存的良好候选者。但是，有两个大问题。二级页面元素（导航、最近的内容列表等）变化非常频繁，很快就会使“完整”缓存页面失效。我们在页面中包含更多动态位（例如用户特定信息等）也很常见。

拥有一个反向代理/负载均衡器来对内容进行后处理并让我们在代理/边缘处理包含内容会非常好。对后端的初始请求将返回一个粗略的模板，然后代理软件可以处理该模板以完成它。标记可能看起来像这样：

```
<html>
<body>
  <div id="content">
    Lorem ipsum whackem smackem.
    <%
      dynamic "http://related.content.service/this/story"
    %>
  </div>
  <div id="sidebar">
    <%
      dynamic do |request|
        url = "http://my.user.service/user-widget.html"
        if request.cookies.contains?("user_token")
          url = "http://my.user.service/" + request.cookies["user_token"] + "/user-widget.html"
        end

        error_text = "User service not available"
        { :url => url, :timeout => 500, :error => error_text }
      end
    %>
  </div>
</body>
</html> 
```

您将在该示例中看到一小部分 Ruby，它根据 cookie 值确定包含的文件，然后返回带有要拉入的 URL、超时和一些默认文本的哈希值，以在出现异常时显示错误。理论上，所有包含也可以异步请求。

我的理解是亚马逊会做这样的事情。各种页面组件由后端服务生成，具有严格的超时限制以确保整体页面速度。我希望他们的 CDN 服务会包含这样的内容，但事实并非如此！

Edge Side Includes (ESI) 的 W3 规范几乎是我想要的。然而，对它的支持很少。它可以通过 Akamai 获得，有一些 Oracle 软件可以做到这一点，开源 Varnish 缓存有一个非常基本的实现。它也是一种非常丑陋的 XML 格式。

所以问题是：有什么可以让我做我想做的事？还有其他人以这种方式做事吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T05:00:58.853

将 Nginx 设置为前端，并使用 SSI 来挑选页面的动态部分。动态源可以是 HTTP 服务器，如 Apache，或 FastCGI 服务器，如 PHP 或 Django。

编辑：

许多网络服务器支持某种形式的 SSI（服务器端包含），此功能允许您将一些标签作为一种非常有限的脚本形式添加到 HTML 中，比 PHP 更简单、更快（并且更早）。使用它，您可以设置包含大部分内容的静态页面，对于“小的动态部分”，SSI 标记引用在其他地方生成的动态页面。

我特别喜欢 nginx 作为几乎任何东西的前端。它速度快、资源少、可扩展性强（想想 lighthttp 的代码更干净、更稳定）。作者将其描述为不是通用的网络服务器；但作为代理前端。后端可以是 HTTP 服务器（通常是 Apache）或 FastCGI 进程（PHP、Python、Perl 等），也可以是其中之一的农场，或两者兼而有之。

memcached 模块非常棒，它使用 memcached（它是最快和最具可扩展性的通用分布式哈希表）直接将网页与 URL 关联起来，不涉及磁盘访问。因为 memcached 可以从网络服务器本身的“外部”访问，它甚至可以用于动态页面（给定一个健全的 URL/资源映射）；但我认为这对你的情况没有多大帮助。在任何情况下，首先使它与 SSI 一起工作，然后您可以（如有必要）使用 memcached 优化动态部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-22T17:55:08.447

所以事实证明，Varnish 拥有（并且拥有）基本的 ESI 支持，几乎可以满足我的所有需求。如果有人需要做一些 ESI 的东西，Varnish 似乎很适合它。这是非常基本的，但仍然很棒。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T07:50:16.937

我知道有些人写过关于使用 nginx SSI 和 memcache nginx 模块来拼接内容片段的文章。它比 ESI 之类的限制要多得多，但仍然有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-13T16:38:25.043

Akamai 有一个边缘计算解决方案，它允许 J2EE 在边缘运行。今天的其他替代品包括任何云计算服务——Rackspace 和亚马逊是这个市场的几个参与者。理想情况下，您将使用 CDN 和云计算的组合来获得所需的结果。此外，您可以选择在页面模板加载后通过 Web 服务异步提供动态内容，然后使用 html 模板缓存静态页面内容。

# spring - 各种 DispatcherServlet.detectAllXxx 标志有哪些用例？

> ID：328315
> 
> 赞同：1
> 
> 时间：2008-11-30T01:35:34.777
> 
> 标签：spring, spring-mvc

在 Spring Web MVC 中，DispatcherServlet 有一堆标志，例如

detectAllHandlerMappings detectAllHandlerAdapters detectAllHandlerExceptionResolvers detectAllViewResolvers

它允许您在查找应用上下文中所有类型匹配的 bean 和最多查找一个在特定 ID 下匹配的 bean 之间进行选择。它们都默认为真。

我正在尝试为这些找出一个好的用例；具体来说，是否有令人信服的情况我会设置一个错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-18T00:03:54.797

例如，“handlerMapping”是一个预定义的 bean id，如果定义则隐式使用（不需要显式连接）。如果使用了多个handlerMappings `detectAllHandlerMappings == true`，Spring会按类型加载它们，并采用多个URL-to-controller方法策略

# resources - 关于编译中链接过程的好资源

> ID：328336
> 
> 赞同：1
> 
> 时间：2008-11-30T01:58:34.807
> 
> 标签：resources, linker, compilation, dynamic-linking

我一直在写代码，我一直认为编译的链接阶段非常简单，但是最近我不得不在应用程序中添加一个插件系统，并且我遇到了很多编译和运行时问题，由于我对这件事完全缺乏了解。我现在已经让它工作得很好，并且在这个过程中学到了很多东西，但是现在我意识到我在这个主题上还有很多东西要学，我想更多地探索这个主题。所以我想知道是否有人对整个“代码部分、符号、链接、动态/静态库......”业务的文章、博客文章或书籍有很好的指导。

我正在使用 gcc 和 ld 在 Linux 上进行开发，但我也对 M$ 的做事方式感兴趣，我渴望知识:)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T02:05:28.163

这里有一些很好的在线资源：

*   [静态、共享动态和可加载的 Linux 库](http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html)
*   [程序库 HOWTO](http://www.dwheeler.com/program-library/Program-Library-HOWTO/)

Ulrich Drepper（glibc 的维护者）在他的论文[How To Write Shared Libraries](http://people.redhat.com/drepper/dsohowto.pdf)中对共享库的 linux 实现进行了非常详尽的描述，如果您想了解细节，绝对值得一读。我实际上想不出一本能很好地涵盖细节的书。

# .net - 使用 SharpZipLib 解压缩特定文件？

> ID：328343
> 
> 赞同：36
> 
> 时间：2008-11-30T02:05:47.693
> 
> 标签：.net, compression, sharpziplib

我正在尝试使用 SharpZipLib 从 zip 存档中提取指定的文件。我见过的所有示例总是希望您解压缩整个 zip，并执行以下操作：

```
 FileStream fileStreamIn = new FileStream (sourcePath, FileMode.Open, FileAccess.Read);

        ZipInputStream zipInStream = new ZipInputStream(fileStreamIn);
        ZipEntry entry;

        while (entry = zipInStream.GetNextEntry() != null)
        {
            // Unzip file
        } 
```

我想做的是：

```
ZipEntry entry = zipInStream.SeekToFile("FileName"); 
```

因为我的需要涉及使用 zip 作为一个包，并且只根据需要将文件抓取到内存中。

有人熟悉 SharpZipLib 吗？有谁知道我是否可以在不用手穿过整个拉链的情况下做到这一点？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-30T02:24:16.830

ZipFile.GetEntry 应该可以解决问题：

```
using (var fs = new FileStream(sourcePath, FileMode.Open, FileAccess.Read))
using (var zf = new ZipFile(fs)) {
   var ze = zf.GetEntry(fileName);
   if (ze == null) {
      throw new ArgumentException(fileName, "not found in Zip");
   }

   using (var s = zf.GetInputStream(ze)) {
      // do something with ZipInputStream
   }
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-30T02:29:32.000

```
FastZip.ExtractZip (string zipFileName, string targetDirectory, string fileFilter) 
```

可以根据文件过滤器提取一个或多个文件（即正则表达式字符串）

这是有关文件过滤器的文档：

```
// A filter is a sequence of independant <see cref="Regex">regular expressions</see> separated by semi-colons ';'
// Each expression can be prefixed by a plus '+' sign or a minus '-' sign to denote the expression
// is intended to include or exclude names.  If neither a plus or minus sign is found include is the default
// A given name is tested for inclusion before checking exclusions.  Only names matching an include spec
// and not matching an exclude spec are deemed to match the filter.
// An empty filter matches any name.
// </summary>
// <example>The following expression includes all name ending in '.dat' with the exception of 'dummy.dat'
// "+\.dat$;-^dummy\.dat$" 
```

因此，对于名为 myfile.dat 的文件，您可以使用 "+.*myfile\.dat$" 作为文件过滤器。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-12T22:47:51.670

*注意 - 这个答案提出了 SharpZipLib 的替代方案*

* * *

[DotNetZip](http://www.codeplex.com/DotNetZip)在 ZipFile 类上有一个字符串索引器，使这变得非常容易。

```
 using (ZipFile zip = ZipFile.Read(sourcePath)
 {
   zip["NameOfFileToUnzip.txt"].Extract();
 } 
```

您不需要摆弄输入流和输出流等，只需提取文件即可。另一方面，如果你想要流，你可以得到它：

```
 using (ZipFile zip = ZipFile.Read(sourcePath)
 {
   Stream s = zip["NameOfFileToUnzip.txt"].OpenReader();
   // fiddle with stream here
 } 
```

您还可以进行通配符提取。

```
 using (ZipFile zip = ZipFile.Read(sourcePath)
 {
     // extract all XML files in the archive
     zip.ExtractSelectedEntries("*.xml");
 } 
```

有重载来指定覆盖/不覆盖，不同的目标目录等。您还可以根据文件名以外的条件进行提取。例如，提取 2009 年 1 月 15 日之后的所有文件：

```
 // extract all files modified after 15 Jan 2009
     zip.ExtractSelectedEntries("mtime > 2009-01-15"); 
```

您可以结合标准：

```
 // extract all files that are modified after 15 Jan 2009) AND  larger than 1mb
     zip.ExtractSelectedEntries("mtime > 2009-01-15 and size > 1mb");

     // extract all XML files that are modified after 15 Jan 2009) AND  larger than 1mb
     zip.ExtractSelectedEntries("name = *.xml and mtime > 2009-01-15 and size > 1mb"); 
```

您不必提取您选择的文件。您可以选择它们，然后决定是否提取。

```
 using (ZipFile zip1 = ZipFile.Read(ZipFileName))
    {
        var PhotoShopFiles = zip1.SelectEntries("*.psd");
        // the selection is just an ICollection<ZipEntry>
        foreach (ZipEntry e in PhotoShopFiles)
        {
            // examine metadata here, make decision on extraction
            e.Extract();
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-10T22:30:13.020

我可以选择 VB.NET，从 Zip 存档器中提取特定文件。西班牙语评论。获取 Zip 文件路径、要提取的文件名和密码（如果需要）。如果 OriginalPath 设置为 1，则提取到原始路径，如果 OriginalPath=0，则使用 DestPath。密切关注“ICSharpCode.SharpZipLib.Zip.Compression.Streams.InflaterInputStream”的东西......

如下：

```
''' <summary>
''' Extrae un archivo específico comprimido dentro de un archivo zip
''' </summary>
''' <param name="SourceZipPath"></param>
''' <param name="FileName">Nombre del archivo buscado. Debe incluir ruta, si se comprimió usando guardar con FullPath</param>
''' <param name="DestPath">Ruta de destino del archivo. Ver parámetro OriginalPath.</param>
''' <param name="password">Si el archivador no tiene contraseña, puede quedar en blanco</param>
''' <param name="OriginalPath">OriginalPath=1, extraer en la RUTA ORIGINAL. OriginalPath=0, extraer en DestPath</param>
''' <returns></returns>
''' <remarks></remarks>
Public Function ExtractSpecificZipFile(ByVal SourceZipPath As String, ByVal FileName As String, _
ByVal DestPath As String, ByVal password As String, ByVal OriginalPath As Integer) As Boolean
    Try
        Dim fileStreamIn As FileStream = New FileStream(SourceZipPath, FileMode.Open, FileAccess.Read)
        Dim fileStreamOut As FileStream
        Dim zf As ZipFile = New ZipFile(fileStreamIn)

        Dim Size As Integer
        Dim buffer(4096) As Byte

        zf.Password = password

        Dim Zentry As ZipEntry = zf.GetEntry(FileName)

        If (Zentry Is Nothing) Then
            Debug.Print("not found in Zip")
            Return False
            Exit Function
        End If

        Dim fstr As ICSharpCode.SharpZipLib.Zip.Compression.Streams.InflaterInputStream
        fstr = zf.GetInputStream(Zentry)

        If OriginalPath = 1 Then
            Dim strFullPath As String = Path.GetDirectoryName(Zentry.Name)
            Directory.CreateDirectory(strFullPath)
            fileStreamOut = New FileStream(strFullPath & "\" & Path.GetFileName(Zentry.Name), FileMode.Create, FileAccess.Write)
        Else
            fileStreamOut = New FileStream(DestPath + "\" + Path.GetFileName(Zentry.Name), FileMode.Create, FileAccess.Write)
        End If

        Do
            Size = fstr.Read(buffer, 0, buffer.Length)
            fileStreamOut.Write(buffer, 0, Size)
        Loop While (Size > 0)

        fstr.Close()
        fileStreamOut.Close()
        fileStreamIn.Close()
        Return True
    Catch ex As Exception
        Return False
    End Try

End Function 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-09-15T20:24:04.297

FileStream fileStreamIn = new FileStream(fileNameZipped, FileMode.Open, FileAccess.Read);

```
 ZipInputStream zipInStream = new ZipInputStream(fileStreamIn);

            using (var zf = new ZipFile(fileStreamIn))
            {
                //zf.Password = "123";
                var ze = zf.GetEntry(fileName);
                if (ze == null)
                {
                    throw new ArgumentException(fileName, "not found in Zip");
                }

                using (var s = zf.GetInputStream(ze))
                {
                    byte[] buffer = new byte[ze.Size];
                    s.Read(buffer, 0, (int) ze.Size);
                    //string textdata = Encoding.Default.GetString(buffer)
                }
            } 
```

# ios - 将图像添加到 navigationItem 的标题

> ID：328352
> 
> 赞同：10
> 
> 时间：2008-11-30T02:19:45.590
> 
> 标签：ios, objective-c, iphone, cocoa-touch, uinavigationbar

我想在导航栏标题的左侧添加一个徽标。title 属性似乎只需要一个 NSString。将图像添加到导航栏的最佳方式是什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-30T02:49:06.017

您可以用这样的图像替换标题视图：

```
navigationItem.titleView = [[UIImageView alloc] initWithImage: [UIImage imageNamed:@"title_bar.png"]]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T02:36:02.063

设置`UINavigationItem.titleView`为*自定义视图*（或直接 UIImageView）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-21T08:32:05.513

您可以自定义`navigationItem.titleView`UIView 的类

# javascript - 在 Firefox 中，我可以找出鼠标悬停在一个充满单词的 div 中的哪个随机单词吗？

> ID：328355
> 
> 赞同：1
> 
> 时间：2008-11-30T02:27:33.360
> 
> 标签：javascript, firefox

例如，如果我有：

<div>Lorem ipsum dolor sit amet，consectetuer adipiscing elit。Curabitur urna felis、convallis quis、placerat in、elementum quis、libero。Nam quis lacus。Vivamus rhoncus quam et metus。Praesent et velit eget sem vestibulum volutpat。整数 sed risus。整数 quis libero id diam bibendum luctus。多内克 eleifend。Curabitur ut sem。Praesent at est ac sem rhoncus interdum。Etiam arcu nulla，molestie dictum，mollis sed，imperdiet sat amet，neque。Fusce at nibh sat amet mi eleifend aliquam。Nunc tristique scelerisque risus。Praesent et velit id magna volutpat volutpat.</div>

...然后它被加载到浏览器中，我将鼠标悬停在各种单词上，有没有合理的方法来检测悬停在哪个单词上？有什么不合理的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T03:46:11.767

这必须很重，但它有效（jQuery）：

```
// highlight every word found in a <p>
$("p").each(
    function () { 
        var content = "";    
        var words = $(this).html().match(/\W*\w+/g) ;
        var in_tag = false ;
        for (i in words) {
            if (words[i].match(/^\W*</)) {
                in_tag = true ;
            }
            if (words[i].match(/^\W*>/)) {
                in_tag = false ;
            }
            if (in_tag) {
                content += words[i];
            } else {
                content += words[i].replace(/(\w+)/,'<span class="word">$1</span>');
            }
        }
        $(this).html(content);
    }
);

// example event

$(".word").mouseover(function() { $(this).css("background-color","#FF0") });
$(".word").mouseout(function() { $(this).css("background-color","") }); 
```

您可能希望将 $("p") 替换为 $("#mydiv")。

编辑：我写了有一个错误打破标签，但标签不是这里的问题；问题是这段代码不能处理 HTML 实体。例如，在当前页面中，在处理<div>时，“gt”和“lt”就像它们自己是单词一样被转换，这确实是错误的。正则表达式必须稍微复杂一点才能修复该错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T02:39:51.853

不合理的方法是从鼠标的 x,y 坐标计算，然后在段落的内部映射中计数。当下一个用户使用不同的字体/大小时，这当然会中断。

查看滚动关键字时出现的那些烦人的智能标签广告弹出窗口。您会注意到它们是在页面加载后由 javascript 加载的，该 javascript 读取每个单词并用包围的 span 替换重要的单词。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T02:32:43.210

我不认为这是可能的。您必须将每个单词都放在某种可识别的标签中，例如跨度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T03:11:11.243

我不知道这是否有帮助，因为我没有查看代码，我会查看纽约时报。我这样说是因为我相信他们已经设置了站点，因此您可以双击任何单词并获得定义。这可能是一个开始的地方。

# python - 使用 Python 从 HTML 文件中提取文本

> ID：328356
> 
> 赞同：282
> 
> 时间：2008-11-30T02:28:04.640
> 
> 标签：python, html, text, html-content-extraction

我想使用 Python 从 HTML 文件中提取文本。如果我从浏览器复制文本并将其粘贴到记事本中，我希望得到的输出基本相同。

我想要比使用可能在格式不佳的 HTML 上失败的正则表达式更强大的东西。我见过很多人推荐 Beautiful Soup，但我在使用它时遇到了一些问题。一方面，它拾取了不需要的文本，例如 JavaScript 源代码。此外，它不解释 HTML 实体。例如，我希望 ' 在 HTML 源代码中转换为文本中的撇号，就像我将浏览器内容粘贴到记事本中一样。

**更新** `html2text`看起来很有希望。它正确处理 HTML 实体并忽略 JavaScript。但是，它并不完全生成纯文本。它会产生降价，然后必须将其转换为纯文本。它没有示例或文档，但代码看起来很干净。

* * *

相关问题：

*   [过滤掉 HTML 标签并解析 python 中的实体](https://stackoverflow.com/questions/37486/filter-out-html-tags-and-resolve-entities-in-python)
*   [在 Python 中将 XML/HTML 实体转换为 Unicode 字符串](https://stackoverflow.com/questions/57708/convert-xmlhtml-entities-into-unicode-string-in-python)

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2014-07-07T19:18:20.917

我发现的最好的一段代码，用于在不获取 javascript 或不需要的东西的情况下提取文本：

```
from urllib.request import urlopen
from bs4 import BeautifulSoup

url = "http://news.bbc.co.uk/2/hi/health/2284783.stm"
html = urlopen(url).read()
soup = BeautifulSoup(html, features="html.parser")

# kill all script and style elements
for script in soup(["script", "style"]):
    script.extract()    # rip it out

# get text
text = soup.get_text()

# break into lines and remove leading and trailing space on each
lines = (line.strip() for line in text.splitlines())
# break multi-headlines into a line each
chunks = (phrase.strip() for line in lines for phrase in line.split("  "))
# drop blank lines
text = '\n'.join(chunk for chunk in chunks if chunk)

print(text) 
```

你只需要安装 BeautifulSoup 之前：

```
pip install beautifulsoup4 
```

* * *

## 回答 #2

> 赞同：165
> 
> 时间：2008-11-30T03:23:58.877

[html2text](https://github.com/Alir3z4/html2text)是一个 Python 程序，在这方面做得很好。

* * *

## 回答 #3

> 赞同：103
> 
> 时间：2011-11-20T12:34:09.573

**注意：** NTLK 不再支持`clean_html`函数

下面的原始答案，以及评论部分的替代方案。

* * *

使用[NLTK](https://pypi.python.org/pypi/nltk)

我浪费了 4-5 个小时来解决 html2text 的问题。幸运的是我可以遇到 NLTK。
它神奇地起作用。

```
import nltk   
from urllib import urlopen

url = "http://news.bbc.co.uk/2/hi/health/2284783.stm"    
html = urlopen(url).read()    
raw = nltk.clean_html(html)  
print(raw) 
```

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2010-10-21T13:14:38.610

发现自己今天面临同样的问题。我编写了一个非常简单的 HTML 解析器来去除所有标记的传入内容，只返回具有最少格式的剩余文本。

```
from HTMLParser import HTMLParser
from re import sub
from sys import stderr
from traceback import print_exc

class _DeHTMLParser(HTMLParser):
    def __init__(self):
        HTMLParser.__init__(self)
        self.__text = []

    def handle_data(self, data):
        text = data.strip()
        if len(text) > 0:
            text = sub('[ \t\r\n]+', ' ', text)
            self.__text.append(text + ' ')

    def handle_starttag(self, tag, attrs):
        if tag == 'p':
            self.__text.append('\n\n')
        elif tag == 'br':
            self.__text.append('\n')

    def handle_startendtag(self, tag, attrs):
        if tag == 'br':
            self.__text.append('\n\n')

    def text(self):
        return ''.join(self.__text).strip()

def dehtml(text):
    try:
        parser = _DeHTMLParser()
        parser.feed(text)
        parser.close()
        return parser.text()
    except:
        print_exc(file=stderr)
        return text

def main():
    text = r'''
        <html>
            <body>
                <b>Project:</b> DeHTML<br>
                <b>Description</b>:<br>
                This small script is intended to allow conversion from HTML markup to 
                plain text.
            </body>
        </html>
    '''
    print(dehtml(text))

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2016-10-06T15:08:54.367

我知道已经有很多答案了，但是我发现的最优雅和 Pythonic 的解决方案**部分**描述**在**[这里](https://stackoverflow.com/questions/761824/python-how-to-convert-markdown-formatted-text-to-text)。

```
from bs4 import BeautifulSoup

text = ' '.join(BeautifulSoup(some_html_string, "html.parser").findAll(text=True)) 
```

## 更新

根据弗雷泽的评论，这里是更优雅的解决方案：

```
from bs4 import BeautifulSoup

clean_text = ' '.join(BeautifulSoup(some_html_string, "html.parser").stripped_strings) 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2013-05-07T16:04:21.887

这是 xperroni 的答案的一个版本，它更完整一些。它跳过脚本和样式部分并翻译字符引用（例如，'）和 HTML 实体（例如，&）。

它还包括一个简单的纯文本到 html 逆转换器。

```
"""
HTML <-> text conversions.
"""
from HTMLParser import HTMLParser, HTMLParseError
from htmlentitydefs import name2codepoint
import re

class _HTMLToText(HTMLParser):
    def __init__(self):
        HTMLParser.__init__(self)
        self._buf = []
        self.hide_output = False

    def handle_starttag(self, tag, attrs):
        if tag in ('p', 'br') and not self.hide_output:
            self._buf.append('\n')
        elif tag in ('script', 'style'):
            self.hide_output = True

    def handle_startendtag(self, tag, attrs):
        if tag == 'br':
            self._buf.append('\n')

    def handle_endtag(self, tag):
        if tag == 'p':
            self._buf.append('\n')
        elif tag in ('script', 'style'):
            self.hide_output = False

    def handle_data(self, text):
        if text and not self.hide_output:
            self._buf.append(re.sub(r'\s+', ' ', text))

    def handle_entityref(self, name):
        if name in name2codepoint and not self.hide_output:
            c = unichr(name2codepoint[name])
            self._buf.append(c)

    def handle_charref(self, name):
        if not self.hide_output:
            n = int(name[1:], 16) if name.startswith('x') else int(name)
            self._buf.append(unichr(n))

    def get_text(self):
        return re.sub(r' +', ' ', ''.join(self._buf))

def html_to_text(html):
    """
    Given a piece of HTML, return the plain text it contains.
    This handles entities and char refs, but not javascript and stylesheets.
    """
    parser = _HTMLToText()
    try:
        parser.feed(html)
        parser.close()
    except HTMLParseError:
        pass
    return parser.get_text()

def text_to_html(text):
    """
    Convert the given text to html, wrapping what looks like URLs with <a> tags,
    converting newlines to <br> tags and converting confusing chars into html
    entities.
    """
    def f(mo):
        t = mo.group()
        if len(t) == 1:
            return {'&':'&amp;', "'":'&#39;', '"':'&quot;', '<':'&lt;', '>':'&gt;'}.get(t)
        return '<a href="%s">%s</a>' % (t, t)
    return re.sub(r'https?://[^] ()"\';]+|[&\'"<>]', f, text) 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-09-23T03:21:58.567

您也可以在 stripogram 库中使用 html2text 方法。

```
from stripogram import html2text
text = html2text(your_html_string) 
```

要安装条形图，请运行 sudo easy_install stripogram

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2012-11-29T19:28:38.377

有用于数据挖掘的模式库。

[http://www.clips.ua.ac.be/pages/pattern-web](http://www.clips.ua.ac.be/pages/pattern-web)

您甚至可以决定保留哪些标签：

```
s = URL('http://www.clips.ua.ac.be').download()
s = plaintext(s, keep={'h1':[], 'h2':[], 'strong':[], 'a':['href']})
print s 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2018-02-18T13:36:16.157

我知道这里已经有很多答案，但我认为[报纸 3k](https://pypi.python.org/pypi/newspaper "报纸3k")也值得一提。我最近需要完成一项类似的任务，即从网络上的文章中提取文本，到目前为止，这个库在我的测试中做得非常出色。它忽略菜单项和侧边栏中的文本以及作为 OP 请求出现在页面上的任何 JavaScript。

```
from newspaper import Article

article = Article(url)
article.download()
article.parse()
article.text 
```

如果您已经下载了 HTML 文件，则可以执行以下操作：

```
article = Article('')
article.set_html(html)
article.parse()
article.text 
```

它甚至还有一些用于总结文章主题的 NLP 功能：

```
article.nlp()
article.summary 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-11-30T15:46:19.707

PyParsing 做得很好。PyParsing wiki 已被杀死，因此这里是另一个位置，其中有使用 PyParsing 的示例（[示例链接](http://www.ccp4.ac.uk/dist/checkout/pyparsing-2.0.1/examples/0README.html)）。在 pyparsing 上投入一点时间的一个原因是，他还编写了一本非常简短且组织良好的 O'Reilly Short Cut 手册，而且价格也不贵。

话虽如此，我经常使用 BeautifulSoup，处理实体问题并不难，您可以在运行 BeautifulSoup 之前将它们转换。

祝你好运

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-08-30T11:21:42.957

如果您需要更快的速度和更低的准确性，那么您可以使用原始 lxml。

```
import lxml.html as lh
from lxml.html.clean import clean_html

def lxml_to_text(html):
    doc = lh.fromstring(html)
    doc = clean_html(doc)
    return doc.text_content() 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-02-20T06:39:50.540

而不是 HTMLParser 模块，请查看 htmllib。它具有类似的界面，但可以为您完成更多工作。（它非常古老，因此在摆脱 javascript 和 css 方面没有太大帮助。您可以创建一个派生类，但添加名称为 start_script 和 end_style 的方法（有关详细信息，请参阅 python 文档），但这很难为格式错误的 html 可靠地执行此操作。）无论如何，这里有一些简单的东西，可以将纯文本打印到控制台

```
from htmllib import HTMLParser, HTMLParseError
from formatter import AbstractFormatter, DumbWriter
p = HTMLParser(AbstractFormatter(DumbWriter()))
try: p.feed('hello<br>there'); p.close() #calling close is not usually needed, but let's play it safe
except HTMLParseError: print ':(' #the html is badly malformed (or you found a bug) 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-05-18T10:02:26.960

这不完全是 Python 解决方案，但它会将 Javascript 生成的文本转换为文本，我认为这很重要（例如 google.com）。浏览器 Links（不是 Lynx）有一个 Javascript 引擎，并且会使用 -dump 选项将源代码转换为文本。

因此，您可以执行以下操作：

```
fname = os.tmpnam()
fname.write(html_source)
proc = subprocess.Popen(['links', '-dump', fname], 
                        stdout=subprocess.PIPE,
                        stderr=open('/dev/null','w'))
text = proc.stdout.read() 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-11-25T13:05:59.737

我推荐一个名为 goose-extractor 的 Python 包 Goose 会尝试提取以下信息：

文章的正文 文章的主图 文章中嵌入的任何 Youtube/Vimeo 电影 元描述 元标签

更多：[https ://pypi.python.org/pypi/goose-extractor/](https://pypi.python.org/pypi/goose-extractor/)

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2017-04-05T07:16:30.180

使用安装**html2text**

> 点安装 html2text

然后，

```
>>> import html2text
>>>
>>> h = html2text.HTML2Text()
>>> # Ignore converting links from HTML
>>> h.ignore_links = True
>>> print h.handle("<p>Hello, <a href='http://earth.google.com/'>world</a>!")
Hello, world! 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2012-11-30T08:23:23.367

美丽的汤确实可以转换 html 实体。考虑到 HTML 经常出错并且充满了 unicode 和 html 编码问题，这可能是您最好的选择。这是我用来将 html 转换为原始文本的代码：

```
import BeautifulSoup
def getsoup(data, to_unicode=False):
    data = data.replace("&nbsp;", " ")
    # Fixes for bad markup I've seen in the wild.  Remove if not applicable.
    masssage_bad_comments = [
        (re.compile('<!-([^-])'), lambda match: '<!--' + match.group(1)),
        (re.compile('<!WWWAnswer T[=\w\d\s]*>'), lambda match: '<!--' + match.group(0) + '-->'),
    ]
    myNewMassage = copy.copy(BeautifulSoup.BeautifulSoup.MARKUP_MASSAGE)
    myNewMassage.extend(masssage_bad_comments)
    return BeautifulSoup.BeautifulSoup(data, markupMassage=myNewMassage,
        convertEntities=BeautifulSoup.BeautifulSoup.ALL_ENTITIES 
                    if to_unicode else None)

remove_html = lambda c: getsoup(c, to_unicode=True).getText(separator=u' ') if c else "" 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2015-12-11T04:11:45.500

另一个非 python 解决方案：Libre Office：

```
soffice --headless --invisible --convert-to txt input1.html 
```

与其他替代方案相比，我更喜欢这个的原因是每个 HTML 段落都被转换为单个文本行（没有换行符），这正是我所寻找的。其他方法需要后处理。Lynx 确实产生了不错的输出，但不是我想要的。此外，Libre Office 可用于从各种格式转换...

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-01-16T14:10:24.890

有人试过[漂白剂](https://pypi.python.org/pypi/bleach)`bleach.clean(html,tags=[],strip=True)`吗？它对我有用。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2018-04-06T03:14:41.387

最适合我的是 inscripts 。

[https://github.com/weblyzard/inscriptis](https://github.com/weblyzard/inscriptis)

```
import urllib.request
from inscriptis import get_text

url = "http://www.informationscience.ch"
html = urllib.request.urlopen(url).read().decode('utf-8')

text = get_text(html)
print(text) 
```

结果真的很好

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2020-06-30T16:14:42.447

我有一个类似的问题，实际上使用了 BeautifulSoup 的答案之一。问题是它真的很慢。我最终使用了名为 selectolax 的库。它非常有限，但它适用于这项任务。唯一的问题是我手动删除了不必要的空格。但是，BeautifulSoup 解决方案的工作速度似乎要快得多。

```
from selectolax.parser import HTMLParser

def get_text_selectolax(html):
    tree = HTMLParser(html)

    if tree.body is None:
        return None

    for tag in tree.css('script'):
        tag.decompose()
    for tag in tree.css('style'):
        tag.decompose()

    text = tree.body.text(separator='')
    text = " ".join(text.split()) # this will remove all the whitespaces
    return text 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-08-08T02:29:50.050

另一种选择是通过基于文本的 Web 浏览器运行 html 并将其转储。例如（使用 Lynx）：

```
lynx -dump html_to_convert.html > converted_html.txt 
```

这可以在 python 脚本中完成，如下所示：

```
import subprocess

with open('converted_html.txt', 'w') as outputFile:
    subprocess.call(['lynx', '-dump', 'html_to_convert.html'], stdout=testFile) 
```

它不会只为您提供 HTML 文件中的文本，但根据您的用例，它可能比 html2text 的输出更可取。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2016-12-06T15:06:19.520

@PeYoTIL 使用 BeautifulSoup 并消除样式和脚本内容的答案对我不起作用。我尝试使用`decompose`而不是，`extract`但它仍然没有工作。所以我创建了自己的，它还使用标签格式化文本并用href 链接`<p>`替换标签。`<a>`还处理文本内的链接。可在[此 gist](https://gist.github.com/racitup/2ded9c06c2563049e7e12b25bf2a8369)中找到并嵌入测试文档。

```
from bs4 import BeautifulSoup, NavigableString

def html_to_text(html):
    "Creates a formatted text email message as a string from a rendered html template (page)"
    soup = BeautifulSoup(html, 'html.parser')
    # Ignore anything in head
    body, text = soup.body, []
    for element in body.descendants:
        # We use type and not isinstance since comments, cdata, etc are subclasses that we don't want
        if type(element) == NavigableString:
            # We use the assumption that other tags can't be inside a script or style
            if element.parent.name in ('script', 'style'):
                continue

            # remove any multiple and leading/trailing whitespace
            string = ' '.join(element.string.split())
            if string:
                if element.parent.name == 'a':
                    a_tag = element.parent
                    # replace link text with the link
                    string = a_tag['href']
                    # concatenate with any non-empty immediately previous string
                    if (    type(a_tag.previous_sibling) == NavigableString and
                            a_tag.previous_sibling.string.strip() ):
                        text[-1] = text[-1] + ' ' + string
                        continue
                elif element.previous_sibling and element.previous_sibling.name == 'a':
                    text[-1] = text[-1] + ' ' + string
                    continue
                elif element.parent.name == 'p':
                    # Add extra paragraph formatting newline
                    string = '\n' + string
                text += [string]
    doc = '\n'.join(text)
    return doc 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2018-05-07T11:07:18.570

我使用[Apache Tika](https://tika.apache.org/)取得了不错的成绩。它的目的是从内容中提取元数据和文本，因此底层解析器进行了相应的调整，开箱即用。

Tika 可以作为[服务器](https://wiki.apache.org/tika/TikaJAXRS)运行，在 Docker 容器中运行/部署很简单，并且可以从那里通过[Python 绑定](https://github.com/chrismattmann/tika-python)进行访问。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-02-02T00:13:03.087

在 Python 3.x 中，您可以通过导入 'imaplib' 和 'email' 包以非常简单的方式做到这一点。虽然这是一篇较旧的帖子，但也许我的回答可以帮助这篇文章的新人。

```
status, data = self.imap.fetch(num, '(RFC822)')
email_msg = email.message_from_bytes(data[0][1]) 
#email.message_from_string(data[0][1])

#If message is multi part we only want the text version of the body, this walks the message and gets the body.

if email_msg.is_multipart():
    for part in email_msg.walk():       
        if part.get_content_type() == "text/plain":
            body = part.get_payload(decode=True) #to control automatic email-style MIME decoding (e.g., Base64, uuencode, quoted-printable)
            body = body.decode()
        elif part.get_content_type() == "text/html":
            continue 
```

现在您可以打印正文变量，它将采用纯文本格式:) 如果它对您来说足够好，那么最好选择它作为接受的答案。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-06-02T15:04:54.757

以简单的方式

```
import re

html_text = open('html_file.html').read()
text_filtered = re.sub(r'<(.*?)>', '', html_text) 
```

此代码查找以“<”开头并以“>”结尾的 html_text 的所有部分，并将找到的所有部分替换为空字符串

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2017-10-25T00:08:25.103

这是我经常使用的代码。

```
from bs4 import BeautifulSoup
import urllib.request

def processText(webpage):

    # EMPTY LIST TO STORE PROCESSED TEXT
    proc_text = []

    try:
        news_open = urllib.request.urlopen(webpage.group())
        news_soup = BeautifulSoup(news_open, "lxml")
        news_para = news_soup.find_all("p", text = True)

        for item in news_para:
            # SPLIT WORDS, JOIN WORDS TO REMOVE EXTRA SPACES
            para_text = (' ').join((item.text).split())

            # COMBINE LINES/PARAGRAPHS INTO A LIST
            proc_text.append(para_text)

    except urllib.error.HTTPError:
        pass

    return proc_text 
```

我希望这会有所帮助。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2018-04-13T11:03:57.550

您只能使用 BeautifulSoup 从 HTML 中提取文本

```
url = "https://www.geeksforgeeks.org/extracting-email-addresses-using-regular-expressions-python/"
con = urlopen(url).read()
soup = BeautifulSoup(con,'html.parser')
texts = soup.get_text()
print(texts) 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-01-21T19:30:00.440

虽然很多人提到使用正则表达式来去除 html 标签，但也有很多缺点。

例如：

```
<p>hello&nbsp;world</p>I love you 
```

应解析为：

```
Hello world
I love you 
```

这是我想出的一个片段，您可以根据您的特定需求对其进行自定义，它就像一个魅力

```
import re
import html
def html2text(htm):
    ret = html.unescape(htm)
    ret = ret.translate({
        8209: ord('-'),
        8220: ord('"'),
        8221: ord('"'),
        160: ord(' '),
    })
    ret = re.sub(r"\s", " ", ret, flags = re.MULTILINE)
    ret = re.sub("<br>|<br />|</p>|</div>|</h\d>", "\n", ret, flags = re.IGNORECASE)
    ret = re.sub('<.*?>', ' ', ret, flags=re.DOTALL)
    ret = re.sub(r"  +", " ", ret)
    return ret 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-08-27T16:52:57.813

在 Python 2.7.9+ 中使用 BeautifulSoup4 的另一个例子

**包括：**

```
import urllib2
from bs4 import BeautifulSoup 
```

**代码：**

```
def read_website_to_text(url):
    page = urllib2.urlopen(url)
    soup = BeautifulSoup(page, 'html.parser')
    for script in soup(["script", "style"]):
        script.extract() 
    text = soup.get_text()
    lines = (line.strip() for line in text.splitlines())
    chunks = (phrase.strip() for line in lines for phrase in line.split("  "))
    text = '\n'.join(chunk for chunk in chunks if chunk)
    return str(text.encode('utf-8')) 
```

**解释：**

以 html 格式读取 url 数据（使用 BeautifulSoup），删除所有脚本和样式元素，并使用 .get_text() 仅获取文本。分成几行并删除每行的前导和尾随空格，然后将多个标题分成一行，每个块 = (phrase.strip() for line in lines for phrase in line.split(" "))。然后使用 text = '\n'.join，删除空白行，最后以认可的 utf-8 形式返回。

***笔记：***

*   由于 SSL 问题，某些运行此功能的系统会因 https:// 连接而失败，您可以关闭验证以解决该问题。修复示例：http: [//blog.pengyifan.com/how-to-fix-python-ssl-certificate_verify_failed/](http://blog.pengyifan.com/how-to-fix-python-ssl-certificate_verify_failed/)

*   Python < 2.7.9 运行时可能会出现一些问题

*   text.encode('utf-8') 可能会留下奇怪的编码，可能只想返回 str(text) 。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2018-05-15T19:36:59.157

LibreOffice writer 注释具有优点，因为应用程序可以使用 python 宏。它似乎为回答这个问题和促进 LibreOffice 的宏观基础提供了多种好处。如果此解决方案是一次性实现，而不是用作更大生产程序的一部分，则在编写器中打开 HTML 并将页面保存为文本似乎可以解决此处讨论的问题。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-07-06T11:36:06.380

Perl 方式（对不起妈妈，我永远不会在生产中这样做）。

```
import re

def html2text(html):
    res = re.sub('<.*?>', ' ', html, flags=re.DOTALL | re.MULTILINE)
    res = re.sub('\n+', '\n', res)
    res = re.sub('\r+', '', res)
    res = re.sub('[\t ]+', ' ', res)
    res = re.sub('\t+', '\t', res)
    res = re.sub('(\n )+', '\n ', res)
    return res 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-07-28T00:17:02.973

这里的所有方法都不适用于某些网站。由 JS 代码生成的段落可以抵抗上述所有内容。这是最终受此[答案](https://stackoverflow.com/a/58464784/1970830)和[此](https://stackoverflow.com/a/32629481/1970830)启发而对我有用的方法。

这个想法是在 webdriver 中加载页面并滚动到页面的末尾，让 JS 完成它的工作来生成/加载页面的其余部分。然后插入击键命令以选择所有复制/粘贴整个页面：

```
import selenium
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
import pyperclip
import time

driver = webdriver.Chrome()
driver.get("https://www.lazada.com.ph/products/nike-womens-revolution-5-running-shoes-black-i1262506154-s4552606107.html?spm=a2o4l.seller.list.3.6f5d7b6cHO8G2Y&mp=1&freeshipping=1")

# Scroll down to end of the page to let all javascript code load its content
lenOfPage = driver.execute_script("window.scrollTo(0, document.body.scrollHeight);var lenOfPage=document.body.scrollHeight;return lenOfPage;")
match=False
while(match==False):
        lastCount = lenOfPage
        time.sleep(1)
        lenOfPage = driver.execute_script("window.scrollTo(0, document.body.scrollHeight);var lenOfPage=document.body.scrollHeight;return lenOfPage;")
        if lastCount==lenOfPage:
            match=True

# copy from the webpage
element = driver.find_element_by_tag_name('body')
element.send_keys(Keys.CONTROL,'a')
element.send_keys(Keys.CONTROL,'c')
alltext = pyperclip.paste()
alltext = alltext.replace("\n", " ").replace("\r", " ")  # cleaning the copied text
print(alltext ) 
```

它很慢。但没有其他任何工作。

更新：更好的方法是使用 inscriptis 库滚动到页面末尾后加载页面的源代码：

```
from inscriptis import get_text
text = get_text(driver.page_source) 
```

仍然无法使用无头驱动程序（页面以某种方式检测到它没有被真实显示并且滚动到末尾不会使 JS 代码加载它的东西），但至少我们不需要阻碍我们的疯狂复制/粘贴在具有共享剪贴板的机器上运行多个脚本。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-09-06T10:37:51.257

回答使用 Pandas 从 HTML 获取表格数据。

如果您想从 HTML 中快速提取表格数据。您可以使用 read_HTML 函数文档在[这里](https://pandas.pydata.org/docs/reference/api/pandas.read_html.html)。在使用此功能之前，您应该阅读有关BeautifulSoup4/ [html5lib](https://pandas.pydata.org/docs/user_guide/io.html#io-html-gotchas) /lxml 解析器 HTML 解析库的问题/问题。

```
import pandas as pd

http = r'https://www.ibm.com/docs/en/cmofz/10.1.0?topic=SSQHWE_10.1.0/com.ibm.ondemand.mp.doc/arsa0257.htm'
table = pd.read_html(http)
df = table[0]
df 
```

输出 [![在此处输入图像描述](https://i.stack.imgur.com/dYdh7.jpg)](https://i.stack.imgur.com/dYdh7.jpg)

有许多选项可以使用，请参见[此处](https://pandas.pydata.org/docs/user_guide/io.html#reading-html-content)和[此处](https://pandas.pydata.org/docs/reference/api/pandas.read_html.html)。

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2016-08-07T17:27:43.933

我正在实现它。

```
>>> import requests
>>> url = "http://news.bbc.co.uk/2/hi/health/2284783.stm"
>>> res = requests.get(url)
>>> text = res.text 
```

# windows - Server 2003 中的单个远程桌面会话

> ID：328368
> 
> 赞同：3
> 
> 时间：2008-11-30T02:43:40.020
> 
> 标签：windows, windows-server-2003, remote-desktop, terminal-services

我有一个运行 Windows Server 2003 的无头服务器，并通过 VNC 对其进行管理。它设置为自动登录到特定的用户帐户。

我想改为使用远程桌面/终端服务。但是，当我远程登录时，会创建一个新的用户会话（除了自动登录的会话）。本质上，我希望远程桌面连接接管计算机中的默认会话（XP 是如何做到的）。有谁知道怎么做？

PS我不是在一个远程会话之后，而是一个全局会话:)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-30T04:12:19.310

要以“控制台”用户（用于本地登录的用户）身份登录，请使用 mstsc.exe 的参数 从命令提示符中键入 mstsc /h 以查看帮助。MSTSC /ADMIN /V:YOURSERVERNAME 或 MSTSC /CONSOLE /V:YOURSERVERNAME

（取决于您拥有的版本）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T04:18:07.567

请原谅自我回答，但对于那些使用 OS X 和远程桌面连接的用户，您只需将“/console”附加到您要连接的计算机的 IP 地址即可。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T03:57:16.377

这是您可以切换的方法。

1.  启动任务管理器
2.  切换到用户选项卡
3.  应该列出两个用户。您登录时使用的会话和您尝试连接的原始会话。
4.  右键单击要连接的那个，然后选择“切换”或“连接”。我不记得确切的一个。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T04:03:34.150

在服务器上：设置 > 控制面板 > 管理工具 > 终端服务配置 > 服务器设置 > 将每个用户限制为一个会话

或者，您可以登录到控制台（将在监视器上显示的会话，如果存在）。从 XP 时代的客户端，那是（命令行）“mstsc /console /v:host.to.connect.to”。对于 Vista 时代的客户端，它是“mstsc /admin /v:host.to.connect.to”。该选项可能出现在 RDP 客户端设置屏幕的某处，并且[终端](http://www.codeplex.com/Terminals)等工具也会公开它。

# c# - GSM 调制解调器库

> ID：328371
> 
> 赞同：4
> 
> 时间：2008-11-30T02:48:56.530
> 
> 标签：c#, .net, sms, serial-port

我正在寻找用 c# 编写的 SMS 库，任何人都是最好的库并且它是免费的吗？我可以在 Linux 中找到超过 1 个，但我找不到任何用 c# 编写且免费的内容

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-01T01:33:02.790

查看 GSMComm。

[http://www.scampers.org/steve/sms/index.htm](http://www.scampers.org/steve/sms/index.htm)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T03:10:00.263

大多数 GSM 调制解调器都带有自己的库。您实际上并不需要用 C# 编写库。通常它会在 dll 或 exe 中。如果它是使用 C++ 编写的 dll，您仍然可以通过 p/invoke 调用它的函数。您只需要知道函数签名即可正确发送和检索数据。检查文档。如果它是一个 exe，很可能是基于命令行的，那么您可以使用 Process.Start() 调用它，并通过参数输入您想要发送的任何内容。

# java - JSP 中的 htmlentities 等价物？

> ID：328381
> 
> 赞同：4
> 
> 时间：2008-11-30T03:11:32.710
> 
> 标签：java, jsp, html-entities

我是一个 php 人，但我必须在 JSP 中做一些小项目。我想知道 JSP 中是否有与 htmlentities 函数（php 的）等价的函数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-29T10:20:12.900

> 公共静态字符串 stringToHTMLString(String string) {...

[commons-lang](http://commons.apache.org/proper/commons-lang/)库中的实用程序也是如此：

```
org.apache.commons.lang.StringEscapeUtils.escapeHtml 
```

只需将其导出到自定义 tld - 您将获得一个方便的 jsp 方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T03:20:59.260

```
public static String stringToHTMLString(String string) {
    StringBuffer sb = new StringBuffer(string.length());
    // true if last char was blank
    boolean lastWasBlankChar = false;
    int len = string.length();
    char c;

    for (int i = 0; i < len; i++)
        {
        c = string.charAt(i);
        if (c == ' ') {
            // blank gets extra work,
            // this solves the problem you get if you replace all
            // blanks with &nbsp;, if you do that you loss 
            // word breaking
            if (lastWasBlankChar) {
                lastWasBlankChar = false;
                sb.append("&nbsp;");
                }
            else {
                lastWasBlankChar = true;
                sb.append(' ');
                }
            }
        else {
            lastWasBlankChar = false;
            //
            // HTML Special Chars
            if (c == '"')
                sb.append("&quot;");
            else if (c == '&')
                sb.append("&amp;");
            else if (c == '<')
                sb.append("&lt;");
            else if (c == '>')
                sb.append("&gt;");
            else if (c == '\n')
                // Handle Newline
                sb.append("&lt;br/&gt;");
            else {
                int ci = 0xffff & c;
                if (ci < 160 )
                    // nothing special only 7 Bit
                    sb.append(c);
                else {
                    // Not 7 Bit use the unicode system
                    sb.append("&#");
                    sb.append(new Integer(ci).toString());
                    sb.append(';');
                    }
                }
            }
        }
    return sb.toString();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-29T19:10:40.173

我建议直接在 JSP 中使用 escapeXml 设置为 JSTL 的 true 属性

```
<c:out value="${string}" escapeXml="true" /> 
```

# javascript - 如何进行 JavaScript 对象自省？

> ID：328382
> 
> 赞同：13
> 
> 时间：2008-11-30T03:11:49.900
> 
> 标签：javascript, jquery, introspection

在所有探测之后，如果一个据报道有效的对象对任何探测的属性返回“未定义”，该怎么办？我使用 jQuery，在函数范围内，`$('selector').mouseover(function() { });`一切都返回“未定义” 。`$(this)`选择器是地图标签的“区域”，我正在寻找它的父属性。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-30T03:57:20.013

您的问题有点模糊，所以也许您可以提供更多详细信息？

至于找出对象及其属性的值，有很多方法可以做到，包括使用 Firebug 或其他一些调试工具等。这是一个快速而肮脏的功能，可能会帮助您入门，直到您可以提供更多细节：

```
function listProperties(obj) {
   var propList = "";
   for(var propName in obj) {
      if(typeof(obj[propName]) != "undefined") {
         propList += (propName + ", ");
      }
   }
   alert(propList);
} 
```

这将显示您传递给它的对象的属性列表，这些属性不是`undefined`.

希望有帮助...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T04:27:36.987

是`selector`元素的名称吗？如果是这样，那么您应该将其引用为：

```
$('area#selector') 
```

或者

```
$('#selector') 
```

否则它将尝试寻找（不存在的）“选择器”HTML 标记，并且显然找不到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T19:17:37.357

虽然这个答案有点晚了，但我仍然建议查看这些链接：

[http://www.webweavertech.com/ovidiu/weblog/archives/000317.html](http://www.webweavertech.com/ovidiu/weblog/archives/000317.html)
[http://www.syger.it/Tutorials/JavaScriptIntrospector.html](http://www.syger.it/Tutorials/JavaScriptIntrospector.html)

# php - 如何存储和重置 PHP 数组指针？

> ID：328384
> 
> 赞同：4
> 
> 时间：2008-11-30T03:16:47.020
> 
> 标签：php, arrays, loops

我有一个关联数组，即

```
$primes = array(
  2=>2,
  3=>3,
  5=>5,
  7=>7,
  11=>11,
  13=>13,
  17=>17,
  // ...etc
); 
```

然后我做

```
// seek to first prime greater than 10000
reset($primes);
while(next($primes) < 10000) {}
prev($primes);

// iterate until target found
while($p = next($primes)) {
      $res = doSomeCalculationsOn($p);

      if( IsPrime($res) )
          return $p;
} 
```

问题是 IsPrime 还循环通过 $primes 数组，

```
function IsPrime($num) {
    global $primesto, $primes, $lastprime;

    if ($primesto >= $num)
        // using the assoc array lets me do this as a lookup
        return isset($primes[$num]);

    $root = (int) sqrt($num);
    if ($primesto < $root)
        CalcPrimesTo($root);

    foreach($primes as $p) {       // <- Danger, Will Robinson!
        if( $num % $p == 0 )
            return false;

        if ($p >= $root)
            break;
    }

    return true;
} 
```

这会破坏我正在迭代的数组指针。

我希望能够在 IsPrime() 函数中保存和恢复数组的内部指针，这样它就不会产生这种副作用。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T03:23:40.393

您可以“保存”数组的状态：

```
$state = key($array); 
```

和“恢复”（不确定是否有更好的方法）：

```
reset($array);

while(key($array) != $state)
    next($array); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-30T10:22:34.570

不要依赖数组指针。请改用迭代器。

您可以将外部代码替换为：

```
foreach ($primes as $p) {
  if ($p > 10000 && IsPrime(doSomeCalculationsOn($p))) {
    return $p;
  }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T04:56:58.427

如果速度不是问题并且您没有推动 php 内存限制，那么最快的解决方案就是复制您的素数数组并迭代 2 个不同的数组。

```
$awesomePrimes=$primes; 
```

然后将函数中的全局变量和 foreach 更改为`$awesomePrimes`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T10:58:11.473

再做一个数组怎么样`int -> int`，其中索引是从 0 到*n*的运行数字，值是关联数组的索引？因此，您将拥有：

```
$pointer = array(
  0 => 2,
  1 => 3,
  2 => 5,
  // ...
); 
```

而不是直接指代`$prime`您，而是使用`$prime[$pointer[$i]]`, 或类似的东西？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T12:31:36.840

为您的一次迭代使用“for”循环。例如在您的 IsPrime 方法中使用此循环：

```
$primesLength = count($primes); // this is to avoid calling of count() so many times.
for ($counter=0 ; $counter < $primesLength ; $counter++) {
    $p = $primesLength[$counter];
    if( $num % $p == 0 )
            return false;

    if ($p >= $root)
            break;
} 
```

这样内部数组指针将不会在方法中使用。

# java - 正则表达式替换字符串中的所有 \n，但没有 [code] [/code] 标记内的那些

> ID：328387
> 
> 赞同：9
> 
> 时间：2008-11-30T03:22:59.723
> 
> 标签：java, regex

我需要帮助来替换字符串中的所有 \n （换行符）字符
，而不是 [code][/code] 标记中的那些 \n 。我的大脑在燃烧，我自己无法解决这个问题:(

例子：

```
test test test
test test test
test
test

[code]some
test
code
[/code]

more text 
```

应该：

```
test test test<br />
test test test<br />
test<br />
test<br />
<br />
[code]some
test
code
[/code]<br />
<br />
more text<br /> 
```

谢谢你的时间。最好的祝福。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T03:29:18.743

我会建议一个（简单的）解析器，而不是一个正则表达式。像这样的东西（错误的伪代码）：

```
stack elementStack;

foreach(char in string) {
    if(string-from-char == "[code]") {
        elementStack.push("code");
        string-from-char = "";
    }

    if(string-from-char == "[/code]") {
        elementStack.popTo("code");
        string-from-char = "";
    }

    if(char == "\n" && !elementStack.contains("code")) {
        char = "<br/>\n";
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-30T03:44:54.280

您已标记问题正则表达式，但这可能不是这项工作的最佳工具。

您可能会更好地使用基本的编译器构建技术（即提供简单状态机解析器的词法分析器）。

您的词法分析器将识别五个标记： ("[code]", '\n', "[/code]", EOF, :all other strings:) 并且您的状态机如下所示：

```
状态令牌动作
----------------------
开始：无：-> out
out [代码] OUTPUT(token), --> in
out \n 输出（中断），输出（令牌）
出 * 输出（令牌）
in [/code] OUTPUT(token), --> out
在 * 输出（令牌）
* EOF --> 结束

```

编辑：我看到其他海报讨论可能需要嵌套块。这个状态机不会处理这个。对于嵌套块，使用递归的体面解析器（不是那么简单，但仍然足够简单且可扩展）。

编辑：Axeman 指出，这种设计不包括在代码中使用“[/code]”。可以使用逃生机制来解决这个问题。像将'\'添加到您的令牌并添加：

```
状态令牌动作
----------------------
在 \ --> esc-in
esc-in * OUTPUT(token), -->in
出 \ --> esc-out
esc-out * OUTPUT(token), -->out

```

到状态机。

支持机器生成的词法分析器和解析器的常用论点适用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T09:24:43.533

这似乎做到了：

```
private final static String PATTERN = "\\*+";

public static void main(String args[]) {
    Pattern p = Pattern.compile("(.*?)(\\[/?code\\])", Pattern.DOTALL);
    String s = "test 1 ** [code]test 2**blah[/code] test3 ** blah [code] test * 4 [code] test 5 * [/code] * test 6[/code] asdf **";
    Matcher m = p.matcher(s);
    StringBuffer sb = new StringBuffer(); // note: it has to be a StringBuffer not a StringBuilder because of the Pattern API
    int codeDepth = 0;
    while (m.find()) {
        if (codeDepth == 0) {
            m.appendReplacement(sb, m.group(1).replaceAll(PATTERN, ""));
        } else {
            m.appendReplacement(sb, m.group(1));
        }
        if (m.group(2).equals("[code]")) {
            codeDepth++;
        } else {
            codeDepth--;
        }
        sb.append(m.group(2));
    }
    if (codeDepth == 0) {
        StringBuffer sb2 = new StringBuffer();
        m.appendTail(sb2);
        sb.append(sb2.toString().replaceAll(PATTERN, ""));
    } else {
        m.appendTail(sb);
    }
    System.out.printf("Original: %s%n", s);
    System.out.printf("Processed: %s%n", sb);
} 
```

它不是一个简单的正则表达式，但我认为你不能用一个简单的正则表达式做你想做的事。不适用于处理嵌套元素等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T04:06:25.330

正如其他海报所提到的，正则表达式并不是这项工作的最佳工具，因为它们几乎普遍作为贪婪算法实现。这意味着即使您尝试使用以下内容匹配代码块：

```
(\[code\].*\[/code\]) 
```

然后表达式将匹配从第一个`[code]`标签到最后一个`[/code]`标签的所有内容，这显然不是您想要的。虽然有一些方法可以解决这个问题，但生成的正则表达式通常很脆弱、不直观，而且非常难看。像下面的 python 代码这样的东西会更好。

```
output = []
def add_brs(str):
    return str.replace('\n','<br/>\n')
# the first block will *not* have a matching [/code] tag
blocks = input.split('[code]')
output.push(add_brs(blocks[0]))
# for all the rest of the blocks, only add <br/> tags to
# the segment after the [/code] segment
for block in blocks[1:]:
    if len(block.split('[/code]'))!=1:
        raise ParseException('Too many or few [/code] tags')
    else:
        # the segment in the code block is pre, everything
        # after is post
        pre, post = block.split('[/code]')
        output.push(pre)
        output.push(add_brs(post))
# finally join all the processed segments together
output = "".join(output) 
```

请注意，上面的代码*没有*经过测试，这只是您需要做的一个粗略的想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T03:55:30.483

要做到这一点，您确实需要进行三遍：

1.  找到 [code] 块并用唯一的令牌 + 索引替换它们（保存原始块），例如，“foo [code]abc[/code] bar[code]efg[/code]”变为“foo TOKEN-1 barTOKEN -2"
2.  更换换行符。
3.  扫描逃逸标记并恢复原始块。

代码看起来像*：

```
Matcher m = escapePattern.matcher(input);
while(m.find()) {
    String key = nextKey();
    escaped.put(key,m.group());
    m.appendReplacement(output1,"TOKEN-"+key);
}
m.appendTail(output1);
Matcher m2 = newlinePatten.matcher(output1);
while(m2.find()) {
    m.appendReplacement(output2,newlineReplacement);
}
m2.appendTail(output2);
Matcher m3 = Pattern.compile("TOKEN-(\\d+)").matcher(output2); 
while(m3.find()) {
    m.appendReplacement(finalOutput,escaped.get(m3.group(1)));
}
m.appendTail(finalOutput); 
```

那是快速而肮脏的方式。有更有效的方法（其他人提到了解析器/词法分析器），但除非您正在处理数百万行并且您的代码受 CPU 限制（而不是像大多数 web 应用程序那样受 I/O 限制）并且您已通过分析器确认这是瓶颈，他们可能不值得。

* 没跑过，全凭记忆。只需检查[API](http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Matcher.html)，您就可以解决问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T09:50:51.953

这很难，因为如果正则表达式擅长查找某些内容，那么它们就不太擅长匹配除某些内容之外的所有内容……所以您必须使用循环，我怀疑您是否可以一次性完成。

搜索后，我发现了一些接近 cletus 的解决方案，除了我认为代码块不能嵌套，导致代码更简单：选择适合您需要的。

```
import java.util.regex.*;

class Test
{
  static final String testString = "foo\nbar\n[code]\nprint'';\nprint{'c'};\n[/code]\nbar\nfoo";
  static final String replaceString = "<br>\n";
  public static void main(String args[])
  {
    Pattern p = Pattern.compile("(.+?)(\\[code\\].*?\\[/code\\])?", Pattern.DOTALL);
    Matcher m = p.matcher(testString);
    StringBuilder result = new StringBuilder();
    while (m.find()) 
    {
      result.append(m.group(1).replaceAll("\\n", replaceString));
      if (m.group(2) != null)
      {
        result.append(m.group(2));
      }
    }
    System.out.println(result.toString());
  }
} 
```

粗略的快速测试，你需要更多（null、空字符串、无代码标签、多个等）。

# iphone - UITableView 中最后一个索引单元格的字体错误

> ID：328391
> 
> 赞同：1
> 
> 时间：2008-11-30T03:26:53.117
> 
> 标签：iphone, objective-c, cocoa-touch

我有以下代码，乍一看是微不足道的。如果单元格来自搜索结果或者我的学生数组中的计数为零，我只需将字体类型设置为大小为 14 的格鲁吉亚。

但是，我最后一个特定的代码单元`tableView`格采用了 14 号的 Georgia 字体。所有其他单元格都工作正常。我的代码在哪里逻辑错误？

```
- (UITableViewCell *)tableView:(UITableView *)tv cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    NSInteger row = [indexPath row];
    NSInteger section = [indexPath section];

    static NSString *CellIdentifier = @"Student";
    cell = [tv dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:CellIdentifier] autorelease];
    }
    // Configure the cell
    if([studentsSearch count] > 0) {
        cell.text = (NSString *)[[[studentsSearch objectAtIndex:section] objectAtIndex:row] valueForKey:@"name"];
        cell.accessoryType = UITableViewCellAccessoryDetailDisclosureButton;
    } else {
        if(isSearching == YES) 
            cell.text = @"No students available.";
        else 
            cell.text = @"No students have been added for this school.";

        cell.font = [UIFont fontWithName:@"Georgia" size:14];
        cell.accessoryType = UITableViewCellAccessoryNone;
    }

    return cell;
} 
```

**编辑**

似乎正在发生的事情是当视图控制器被实例化并被推送到导航控制器的堆栈顶部时，我的`studentsSearch`数组是`nil`. 我在该控制器中填充它。

因此，在初始化时，单元格的字体设置为 Georgia，大小为 14，因为`count`is < 0。但是，一旦我填充`studentsSearch`数组并重新加载`tableView`的数据，字体似乎从视图第一次初始化时就粘住了.

我想现在我需要找到如何将字体设置回该单元格的默认值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T03:47:26.537

我*不太*确定您在问什么，但我确实注意到您只有在有搜索结果时才将字体设置为 Georgia 14；否则，您将忽略它。如果您在第二个 if/then 分支中有一个单元格的字体设置，然后检索该单元格（使用 dequeueReusableCellWithIdentifier :)，它将已经设置了它的字体。

最简单的解决方案是添加

```
cell.font = [UIFont systemFontOfSize: 14]; 
```

后

```
 cell.text = (NSString *)[[[...
    cell.accessoryType = ... 
```

在第一个分支。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T04:28:33.037

请记住，表格单元格是可回收的。假设您的表有 15 个可见行。这意味着您有大约 15 个（或更多）单元被创建，并且如我所说，被回收。即使您的表格有数百行，它仍将使用相同的 15 个单元格。

在这种情况下，您永远不会重置字体大小，因此一旦您在单元格上设置了该字体大小，它将在重新使用该单元格之后的任何行上使用。

因此，如果您的 studentsSearch 计数 > 0，您需要确保将字体大小设置为您的基线（17？）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T00:44:02.587

我建议您通过给它一个不同的单元格标识符来识别“特殊”单元格。

在这种情况下，您将请求具有单元重用标识符的特殊单元格，例如@“None”，如果尚未创建单元格，则创建一个并设置其字体。

这样，您可以创建一个具有特殊标识符的额外单元格，并且它与表格中的其他常规单元格保持分开。

```
- (UITableViewCell *)tableView:(UITableView *)tv cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    NSInteger row = [indexPath row];
    NSInteger section = [indexPath section];

    static NSString *StudentCellIdentifier = @"Student";
    static NSString *NoneCellIdentifier = @"None";

    // did we find students?
    BOOL found = [studentsSearch count] > 0;

    // get/create correct cell type
    cell = [tv dequeueReusableCellWithIdentifier:(found ? StudentCellIdentifier : NoneCellIdentifier)];
    if (cell == nil) {
        cell = [[UITableViewCell alloc] initWithFrame:CGRectZero 
               reuseIdentifier:(found ? StudentCellIdentifier : NoneCellIdentifier)];
    }

    // return a student, or None cell if no studnts found
    if( found ) 
    {
        cell.text = (NSString *)[[[studentsSearch objectAtIndex:section] objectAtIndex:row] valueForKey:@"name"];
        cell.accessoryType = UITableViewCellAccessoryDetailDisclosureButton;
    } 
    else 
    {
        if(isSearching == YES) 
            cell.text = @"No students available.";
        else 
            cell.text = @"No students have been added for this school.";
        cell.font = [UIFont fontWithName:@"Georgia" size:14];
        cell.accessoryType = UITableViewCellAccessoryNone;
    }

    return [cell autorelease];
} 
```

# ipc - D-Bus 可以在不是 Unix 域套接字的流上使用吗？

> ID：328393
> 
> 赞同：0
> 
> 时间：2008-11-30T03:30:30.893
> 
> 标签：ipc, dbus

我在一个项目中使用 DBus。我从 DBus 规范中了解到，对于低级通信，它使用 Unix 域套接字。我不想使用 Unix 域套接字进行低级通信，因为我有一个修改后的`connect()`调用。是否有任何其他类型的 DBus 支持但不使用的低级通信`connect()`？如果是，那么如何切换到该模式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T05:13:31.637

从[D-Bus Tutorial](http://dbus.freedesktop.org/doc/dbus-tutorial.html#addresses)来看，目前 D-Bus 只支持 socket，可能是 Unix-domain 或者 TCP/IP。

# asp.net - ASP.NET 快速入门

> ID：328395
> 
> 赞同：5
> 
> 时间：2008-11-30T03:33:14.227
> 
> 标签：asp.net

我是一位经验丰富的 .NET 应用程序开发人员。我所有的开发经验都是使用带有 WinForms/WPF 的桌面应用程序。

我上一次使用 ASP 是在 1998 年。ASP.NET 发生了很多变化，我意识到这一点。我想知道使用 ASP.NET 和 WebForms（不是 MVC）**快速提升的最佳资源是什么。**有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T03:44:53.923

我总是推荐这个网站：

[ASP .NET 学习](http://www.asp.net/learn/)

这是官方的 ASP .NET 站点，在那里你会找到非常好的视频，这些视频将帮助你在 ASP .NET 中快速开发

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T03:50:01.557

[ASP.NET 页面生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx?ppud=4)，你必须知道，padawan，如果你想掌握网络，你做

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T03:41:10.623

就我个人而言，我发现最好的方法是开始挖掘，找到一个现有的项目来增强或开始构建一些东西。无论如何，对我来说最好的方法是解决问题，这样做会让生活变得更轻松。至少这是我学习新技术的方式。

还有很多很好的参考/教程网站可以帮助你很多，比如 4GuysFromRolla.com。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T16:35:01.997

*   [HTML/CSS 教程](http://www.htmldog.com/guides/)
*   [ASP.NET 快速入门教程](http://quickstarts.asp.net/QuickStartv20/aspnet/Default.aspx)
*   [不错的系列视频](http://weblogs.asp.net/scottgu/archive/2006/02/26/439088.aspx)
*   [.NET 3.5 增强培训套件 RTM](http://lostintangent.com/2008/08/11/net-35-enhancements-training-kit-rtm/)

ASP.NET Learn 已经提到过。

# apache-flex - Adobe Flex 作为 Web 2.0 框架的优缺点

> ID：328397
> 
> 赞同：8
> 
> 时间：2008-11-30T03:38:32.670
> 
> 标签：apache-flex, frameworks

有一天，我遇到了 Adob​​e Flex 框架。在观看 http://www.adobe.com/products/flex/media/flexapp/'> Flex 的演示后，在我看来它是一组不同的 Ajax 控件。我对 Flex 一点工作知识都没有，对 Flex 知之甚少。因此，我想听听这里有一些 Flex 经验的开发人员来解释这个框架的更多优点和缺点。尤其：

*   与 .Net + Silverlight 相比，在 Flex 中编程的效率如何？
*   与其他框架相比有什么技术优势吗？
*   有什么缺点吗？
*   它有任何已知的缩放问题吗？
*   它可以托管在哪种网络服务器上？
*   关于 Flex，我还应该注意哪些其他事项？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-01T20:04:49.810

*   与 .Net + Silverlight 相比，在 Flex 中编程的效率如何？

比 Silverlight 更高效，因为它拥有更丰富、更强大的控制库。不过，Silverlight 在这方面正在迅速取得进展。我认为当 SL 4 推出时，它们将达到功能平价，甚至可能达到 SL 3。

*   与其他框架相比有什么技术优势吗？

如果您可以在 Photoshop 中创建它，那么您几乎可以在 Flash 绘图 API 的帮助下在 Flex 中完成它。如果您想构建非常有趣的数据可视化（树/节点图，例如组织结构图），您无需大量工作即可完成此 Flex。

*   有什么缺点吗？

ActionScript 没有服务器端组件，因此您需要找到一种方法在 Flex 和后端之间传递数据，无论是 Java、.NET、PHP 等。AMF 远程处理的库几乎可以与任何后端一起使用让它变得容易。但就您在两者之间传递的对象而言，您需要同时维护两者或使用代码生成工具从后端类创建 AS3 类。

*   它有任何已知的缩放问题吗？

Flex 只是一种演示技术，所以这个问题并不适用。

*   它可以托管在哪种网络服务器上？

同样，只是一种演示技术。它编译成一个 SWF 文件，由浏览器通过 HTTP 加载，然后在 Flash Player 插件内部执行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T04:04:41.260

嗯~~ .. 更多的是Silverlight 与Flex 类似。它与其说是 Ajax，不如说是一种“围墙花园”，您可以在其中拥有丰富的编程环境。有点像 Java 应用程序所说的。

通常的批评正是源于此。Flex/Flash 应用程序往往对浏览器一无所知（或多或少），因此后退按钮之类的东西通常会产生意想不到的结果。

它将在所有平台上的所有当前浏览器上运行。您*不需要*“托管” flex，因为您构建了一个 SWF 文件，该文件会加载到浏览器中并由 Flash Player 执行，您的用户应该已经下载/安装了 .. (95+%) 渗透有帮助。

去年左右我一直在使用 Flex，它很好地满足了我的目的。它可以很好地与您网页上的 javascript 内容集成，并提供一组非常丰富的功能来执行所有类似的事情，例如 Web 服务和 XML 处理，当然还有您的所有视频/音频/音乐富媒体。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T04:38:33.550

该语言是 ActionScript 3。它基本上是 javascript 的严格超集。您可以按原样使用 javascript。（ActionScript 被 Adob​​e 设计为下一代 javascript。）

它可以编译成两种模式。一种是在浏览器中作为 Web 应用程序托管，使用 Flash 运行时对象提供精细的 GUI 控件。

或者它可以在桌面模式下编译，它使用另一个运行时（名为 AIR）在 Windows、Mac 或 Linux 上互换操作。

我不会将它与 Ajax 相提并论。它更像 .NET，如果 .NET 在 desktop.NET 和 ASP.NET 之间没有这样的差异的话。假装 ASP.NET 提供了一个桌面运行时，也许吧。（实际上，这不是一个坏主意）。

像许多非 MS 技术一样，它往往是基本的，但涵盖了重要的功能。更多概念完整性，恕我直言。与 VB6 大致相同的规模、范围和复杂性，并且适用于大致相同的任务集，适用于大致相同的开发人员和用户受众。是的，它也有很好的数据库连接。

# flv - 将我的 avi 文件转换为 flv 格式的最佳方法是什么？

> ID：328406
> 
> 赞同：1
> 
> 时间：2008-11-30T03:48:30.840
> 
> 标签：flv

我需要在客户的网站上嵌入视频，他们给出了以下准则：

*   必须可以作为 Flash（FLV 格式）查看
*   如果由外部公司（例如 Youtube）托管，则视频无法链接回外部公司的网站
*   如果由外部公司（例如 Youtube）托管，则视频不能有任何外部公司的广告

我想我正在寻找的是一个 AVI 到 FLV 转换器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T03:52:33.687

您客户的要求不允许使用 YouTube。您最好将它们托管在客户的网站上。

Flash 将导入您的 AVI 电影并将它们转换为 FLV。您可以在文件 -> 导入 -> 导入视频下找到视频导入工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T03:55:30.810

您可以在 Windows 上使用[Riva VX](http://rivavx.com/index.php?encoder)或在 Mac 上使用[ffmpegX](http://www.ffmpegx.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-07T19:38:14.607

最好的方法？FFmpeg 就是这个问题的答案，它是跨平台的，您可以轻松地编写脚本。

```
ffmpeg -i input.avi -acodec libmp3lame -vcodec flv output.flv

```

如果你想要一个工具来做到这一点（需要一个人），我建议 Miro [http://www.mirovideoconverter.com/](http://www.mirovideoconverter.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T03:57:27.673

[Super©](http://www.erightsoft.com/SUPER.html)将任何东西转换成任何东西.. 没有它就活不下去。有一个糟糕的用户界面，但我愿意处理它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T04:56:33.840

[Miksoft](http://www.miksoft.net/)的[移动媒体转换器](http://www.miksoft.net/)是最好的。它允许您对文件进行批量转换，还允许您设置输出质量。它也是免费的。

# jquery - jQuery自动完成：确定输入的文本是否不匹配

> ID：328430
> 
> 赞同：4
> 
> 时间：2008-11-30T04:08:14.890
> 
> 标签：jquery, autocomplete

我已经启动并运行良好的 jQuery Autocomplete (UI 1.6rc2)，当用户选择一个项目时，它会使用关联的 ID 更新隐藏的表单值。当输入的文本与自动完成列表中的结果不匹配时，如何将隐藏表单值设置为“0”？在这种情况下，我将创建一个新条目。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-02-01T00:00:47.473

我在自动完成功能中做到了这一点：

```
change: function(event, ui){
   $(this).next("input[id^=person_id]").val('');
  return false; 
```

在用户选择该选项并使用项目 ID 填充我的隐藏输入后，如果可见输入发生任何更改，隐藏的输入值将被清除。奇迹般有效！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-14T16:24:26.193

您还可以使用带有自动完成功能的“搜索”选项。

```
search: function(event, ui){
   $(this).next("input[id^=person_id]").val('');
} 
```

似乎工作。它确实在延迟和 minlength 之后触发，但如果您将其设置为 minlength=0，它确实会很好地清除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T21:34:07.537

我遇到了同样的问题...看起来当值不匹配时没有发生事件...但是，似乎找到了一些解决方法...

[来自此线程](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)的回复的 Xavier ：

```
selected: function() {
  if(listItems.filter(”.” + CLASSES.ACTIVE)[0]){
    return data && data[ listItems.filter("." + CLASSES.ACTIVE)[0].index ];
  } else {
    if (options.notFound){
      options.notFound();
    } 
  }
} 
```

这不是我认为的最佳解决方案......还有其他想法吗？是的，我也没有解决如何使用这个特定的解决方案:(

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T21:58:48.783

哦，我想我找到了一个技巧，如何超越所有这些事件......简单地，将它添加到`extraParams`发送到自动完成的其他参数中

```
extraParams: { 
    x: function(){ $("#targetField").val(''); }
} 
```

这个只是在发送请求时清空该字段，如果没有找到结果或没有选择任何内容并且输入了一些新的自定义值，它就保持为空......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T04:59:09.153

根据[此处](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)的评论线程，这似乎是不可能的。我想我只是根据数据库检查输入的值，如果它不存在，则创建一个新值。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-08-09T20:12:25.287

```
$("#txtSearchProvider").autocomplete("../WebServices/PageMethods/AutoComplete.aspx",
                {
                    minChars: 3,
                    formatItem: function(data, i, n, value) {
                        return  value.split("-z-")[0];
                    },
                    formatResult: function(data, value) 
                    {
                        return value.split("-z-")[0];
                    }
                }
            );
            $("#txtSearchProvider").result(function(event, data, formatted) {
                $("#txtSearchProviderHidden").val(data[0].split("-z-")[1]);
            }); 
```

* * *

来自：../WebServices/PageMethods/AutoComplete.aspx 的响应

数据 1，Corp-z-29310 数据 2，Almazan 和 Barbara，LLP-z-35745 Dos Santos Santos-z-36327 Calzano 和 Salzano-z-39295

# iphone - iPhone API 中的耦合

> ID：328438
> 
> 赞同：0
> 
> 时间：2008-11-30T04:20:28.717
> 
> 标签：iphone, cocoa-touch

我一直对 iPhone API 中奇怪的耦合感到困惑——尤其是 UIViewController，它具有对 UITabBarItem、UITabBarController 等的硬编码引用。

因此，您最终将 UIViewController 添加到 UITabBarController，它反过来查询 UIViewController 应在 UITabBar 上显示的内容（通过 UIViewController 的 tabBarItem 属性）。

为什么不去UITabBarController->UITabBarItem->UIViewController？似乎很明显。

有没有人觉得这很牛逼？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T15:17:45.410

UITabBarItem 实际上更像是一个按钮而不是其他任何东西。这是您点击以选择选项卡的东西。由于它是一个按钮，它不应该“拥有”它所显示的 UIViewController。相反，它会向 UITabBarController 发送消息以切换到 UIViewController，如所选标签栏项所示。

另外，请注意“硬编码”一词。使用该术语意味着无法更改值。对于 UITabBarController，这些是 CAN 和 DO 更改的属性。

# php - dpkg 无法安装 phpMyAdmin 和 MySQL (Ubuntu)

> ID：328463
> 
> 赞同：0
> 
> 时间：2008-11-30T05:04:42.967
> 
> 标签：php, mysql

我正在尝试安装 phpMyAdmin，但我经常遇到错误。

当我在终端中键入时：

```
sudo dpkg --configure -a 
```

出现以下消息：

```
设置 mysql-server-5.0 (5.0.45-1ubuntu3) ...
 * 停止 MySQL 数据库服务器 mysqld [OK]
 * 启动 MySQL 数据库服务器 mysqld [失败]
调用-rc.d：initscript mysql，操作“启动”失败。
dpkg: 错误处理 mysql-server-5.0 (--configure):
 子进程安装后脚本返回错误退出状态 1
dpkg：依赖问题阻止了 mysql-server 的配置：
 mysql-server 依赖于 mysql-server-5.0；然而：
  包 mysql-server 5.0 尚未配置。
dpkg: 错误处理 mysql-server (--configure):
 依赖性问题 - 未配置
处理时遇到错误：
 mysql-服务器-5.0
 mysql服务器

```

我还尝试通过键入以下内容通过控制台访问 MySQL：`mysql`

出现此错误：

```
ERROR (HY000): Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2) 
```

这发生在我尝试安装 phpMyAdmin 或访问我的`libapache`. 有谁知道如何解决这些问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T06:55:19.920

安装程序错误与`mysql-server-5.0`软件包有关。您可能应该做一个`apt-get purge mysql-server-5.0`然后尝试重新安装它。安装完成后，尝试安装 phpmyadmin。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T12:06:32.100

你也可以逃脱

```
dpkg --configure mysql-server-5.0 
```

因为 'mysql-server' 是一个元包。

# asp.net - 做 ASP.NET 时如何决定哪个是正确的，WebForms 还是 MVC

> ID：328465
> 
> 赞同：17
> 
> 时间：2008-11-30T05:06:55.270
> 
> 标签：asp.net, asp.net-mvc, webforms

所以我即将为我的体育俱乐部启动一个用于会员注册的小项目，我正在尝试在 WebForms 或 MVC 之间做出决定。

Allit 将是一个用户登录和数据捕获表单（或和数据检索），所以我最初考虑使用 FBA 的 WebForms，但我想玩 MVC 有一段时间了，我认为它不会是太糟糕的选择。

但是对 MVC 并没有太多的了解，我不知道它是否不合适。

那么什么是确定 WebForms 或 MVC 是否是正确选择的好方法呢？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-30T05:19:52.623

这是一个关键的生产级应用程序还是一个小的一次性应用程序？您能否处理 MVC 的学习曲线所花费的额外时间，或者您是否需要立即完成？如果 MVC 不成功，你能负担得起放弃整个事情并重新开始吗？您是否愿意在开发过程中改变平台（现在它处于测试阶段可能不会改变太多）？是否有另一个不太重要的项目可以使用 MVC 来学习它。

根据您如何回答这些问题，在这个项目中学习 MVC 可能是值得的。就个人而言，我认为它是一个更好的架构，但在这一点上是一个不太成熟的技术。它确实增加了我的 Web 代码的可测试性。我希望在接下来的一年左右的时间里将我所有的开发都朝着这个方向发展，尽管我怀疑我是否会改变我已经开发了一段时间的任何项目。我刚刚开始了我在 MVC 中的第一个新项目。在它进入测试版之前我不愿意承诺它，我认为它会在我完成项目之前投入生产。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T14:33:58.450

我真的很喜欢 WebControls 方法。很多人都说“在做 MVC 时，单元测试更容易”。首先，无论如何，您应该使用哪种类型的方法将业务逻辑和您的 UI 层完全分离。如果您这样做，那么无论您使用哪种方法，您都可以对您的业务逻辑进行单元测试。当然，使用 MVC 可能会更容易并且“开箱即用”，但这并不是通向罗马的唯一道路……

其次，您可以使用[WatiN](http://watin.sourceforge.net/)，它可以让您的应用程序以远远优于传统单元测试的方式进行测试。（请注意，我并不是说它应该取代单元测试，但除了单元测试之外，它还可以将您带到以前无法获得的安全级别）

第三，网络是无状态的。这是因为 HTTP 是一个完全无状态的协议。这正是使 Web 变得美丽的原因，但同时也很难为其开发*应用程序*。WebControls 方法主要通过拥有诸如 ViewState 之类的概念来完全解决这个问题。这在进行应用程序开发时消除了*很多麻烦。*看看这个[Ajax Calendar 示例，在任何其他范例中使用相同（](http://ra-ajax.org/samples/Viewport-Calendar-Starter-Kit.aspx)*少量*）的代码几乎不可能实现，然后是 WebControls（免责声明；我自己使用 Ra-Ajax）

现在看看[Stacked](http://stacked.ra-ajax.org/)（免责声明；......我也与 BTW 合作）然后意识到我到目前为止花了不到 3 天的时间来开发你在那里看到的东西。也许有人可以用 MVC 实现这一成就，但我对此表示怀疑......

我认为 WebControl 范式非常漂亮。当然它在某些方面有所欠缺，但你猜怎么着，*一切都是*如此。编程作为一种艺术形式存在的唯一“银弹”是不存在任何银弹。

话虽如此，我知道[Grurrah](http://www.grurrah.com/home/)*除了*使用基于 WebControl 的 Ajax 库外，还使用 ​​Castle Project 的 MVC 层。所以混合 WebControls*和*MVC 可能很困难，但肯定不是不可能的......

我认为 MVC 已经得到了很多“应得的”炒作，但不幸的是，在这个过程中也有很多*不应有的*炒作......！:(

下定决心，不要听 MVC 布道者试图说服你他们已经找到了 Web 编程的“银弹”。更重要的是，*也不相信我*！我也有一个议程（让 Ra-Ajax 采用）

下定*决心*。问别人你是否应该做 MVC 就像问我应该吃苹果还是橙子......你会得到的唯一好的答案是；“这取决于”...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T05:21:31.870

IMO，MVC 是前进的方向。如果你有时间学习 MVC 编程方式（因为你暗示你想玩 MVC ..意思是你还没用过），那么这将是一个深入研究产品的绝佳机会。

如果您有以前的 WebForms 经验（我猜您会这样做），那么学习曲线并不高。

如果您需要真正快速地创建一个站点，不要关心它是什么，并且站点会很小，那么请使用 WebForms。这是快速而讨厌的解决方案（仅出于我的意见）。WebForms 100% 完美运行。我所有的网站都是 WebForms，它们都很好。

概括：

*   有时间想学习制作网站的最佳方法：MVC
*   没有时间或不在乎：WebForms。

gl 和 hth。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T12:57:30.843

我们得到了同样的机会。在玩了几个星期的 MVC 之后，我们发现有些事情我们并不完全理解，以及一些事情会涉及到一些变化：

*   实现存储库设计模式
*   Html Helpers 与标准 Web 窗体控件，如 Repeaters 和 GridView
*   缓存
*   是否使用我们目前使用的框架，Csla，或者尝试移动到仅带有部分类的 Linq-To-Sql 来保存业务逻辑
*   涉及主从类的复杂类和用户界面

我们决定继续使用它，等到它正式发布，然后编写一个内部应用程序，看看它会把我们引向何方。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T17:48:05.030

Webforms 是来自 gui 世界的人们对 Web 的抽象。我发现它有很多优势，尤其是在 RAD 意义上，但是在编写大型强大的应用程序时，您通常最终会将自己描绘成一个很难摆脱的角落（即：与视图状态有关的一切。）

另一个问题是您在使用网络表单时会陷入不良习惯。你不应该使用拖放数据源、内置网格控件，并且如果你想要一些可扩展和可维护且具有干净架构的东西，那么绝对不能在背后的代码中包含业务逻辑。在网络表单中做到这一点需要深谋远虑和纪律，因为一切都会引导您朝着这些方向前进。

相比之下，使用 MVC，您会陷入最佳实践。它具有更高的性能（整个页面生命周期/视图状态在客户端和服务器上都表现出色），并且从架构的角度来看更清晰。

缺点是你可以和 RAD 说再见，而且你实际上需要对 css/javascript 有相当的了解才能制作好看的页面。

这真的归结为工作的最佳工具，以及您/您的团队拥有的经验/知识类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T06:57:04.673

根据您对 tvanfosson 的评论，听起来 MVC 对您来说是一个不错的选择，因为您将学习的愿望列为选择该技术的理由。我怀疑 MVC 会从它的测试版中发生*巨大的变化。*因此，这可能是学习新工具的好机会。至于 WebForms 是“快速而讨厌”的解决方案，我担心这是 MVC 宣传。

# php - GD缩略图生成器有问题

> ID：328468
> 
> 赞同：0
> 
> 时间：2008-11-30T05:09:45.887
> 
> 标签：php, gd

我正在使用 PHP 生成缩略图。问题是我设置了缩略图需要的宽度和高度，而且图像经常被拉伸。

我想要的是图像保持相同的比例，并且在高图像的左右两侧或宽图像的顶部和底部只有黑色填充物（或任何颜色）。

这是我目前正在使用的代码：（为了便于阅读，稍微简化了一点）

```
$temp_image_file = imagecreatefromjpeg("http://www.example.com/image.jpg");

list($width,$height) = getimagesize("http://www.example.com/image.jpg");

$image_file = imagecreatetruecolor(166,103);

imagecopyresampled($image_file,$temp_image_file,0,0,0,0,166,103,$width,$height);
imagejpeg($image_file,"thumbnails/thumbnail.jpg",50);

imagedestroy($temp_image_file);
imagedestroy($image_file); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T05:30:13.383

您需要计算新的宽度和高度以保持图像比例。查看此页面上的示例 2：

[http://us3.php.net/imagecopyresampled](http://us3.php.net/imagecopyresampled)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T06:44:14.887

好的，让它工作，这就是我最终做的事情：

```
$filename = "http://www.example.com/image.jpg";

list($width,$height) = getimagesize($filename);

$width_ratio = 166 / $width;
if ($height * $width_ratio <= 103)
{
    $adjusted_width = 166;
    $adjusted_height = $height * $width_ratio;
}
else
{
    $height_ratio = 103 / $height;
    $adjusted_width = $width * $height_ratio;
    $adjusted_height = 103;
}

$image_p = imagecreatetruecolor(166,103);
$image = imagecreatefromjpeg($filename);
imagecopyresampled($image_p,$image,ceil((166 - $adjusted_width) / 2),ceil((103 - $adjusted_height) / 2),0,0,ceil($adjusted_width),ceil($adjusted_height),$width,$height);

imagejpeg($image_p,"thumbnails/thumbnail.jpg",50); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T15:55:10.047

这是我编写的一个函数，它采用 GD 图像对象、最大宽度、最大高度，并在这些参数内重新缩放：

```
function resized($im, $mx, $my) {
  $x = $nx = imagesx($im);
  $y = $ny = imagesy($im);
  $ar = $x / $y;
  while ($nx > $mx || $ny > $my) {
    if ($nx > $mx) {
      $nx = $mx;
      $ny = $nx / $ar;
    }
    if ($ny > $my) {
      $ny = $my;
      $nx = $ny * $ar;
    }
  }
  if ($nx != $x) {
    $im2 = imagecreatetruecolor($nx, $ny);
    imagecopyresampled($im2, $im, 0, 0, 0, 0, $nx, $ny, $x, $y);
    return $im2;
  } else {
    return $im;
  }
} 
```

如果生成的图像不需要重新缩放，那么它只返回原始图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T05:27:36.960

看看这个[上传类](http://www.verot.net/php_class_upload.htm)。它可以做你想做的事，还有更多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-25T13:00:11.680

这会将图像重新缩放为宽度和高度的较大尺寸，然后将其裁剪为正确的尺寸。

```
// Crete an image forced to width and height
    function createFixedImage($img, $id=0, $preFix=false, $mw='100', $mh='100', $quality=90){

        // Fix path
        $filename = '../'.$img;

        // Check for file
        if(file_exists($filename))
        {           
            // Set a maximum height and width
            $width = $mw;
            $height = $mh;

            // Get new dimensions
            list($width_orig, $height_orig) = getimagesize($filename);

            $ratio_orig = $width_orig/$height_orig;

            if ($width/$height < $ratio_orig) {
                   $width = $height*$ratio_orig;
            }else{
                   $height = $width/$ratio_orig;
                }

            // Resample
            $image_p = imagecreatetruecolor($mw, $mh);
            $image = imagecreatefromjpeg($filename);
            imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);

            // Output
            imagejpeg($image_p, "../images/stories/catalog/{$preFix}{$id}.jpg", $quality);
        }
    } 
```

# windows - 使用免费 smtp 发送邮件时遇到问题

> ID：328472
> 
> 赞同：3
> 
> 时间：2008-11-30T05:13:53.960
> 
> 标签：windows, smtp

安装免费 smtp 后，我尝试使用 localhost 作为我的 smtp 服务器从本地 iis 应用程序发送邮件，但出现以下错误：

```
Mailbox unavailable. The server response was: Invalid 
```

收件人：'validAddress'@hotmail.com

知道问题可能是什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T22:44:00.827

看起来更像是需要将 SMTP 服务配置为“中继”电子邮件......通常这涉及告诉它您的邮件域是什么，然后任何发往非自己域的邮件都会导致它发送到世界，并尝试将消息中继到真实服务器。

但小心点！这就是垃圾邮件发送者利用电子邮件服务器的方式。他们寻找将为他们中继的 SMTP 侦听器。你要确保你的只接受来自“localhost”的中继邮件，或者任何连接到它的机器来进行发送。

一种更安全的方法是在您的防火墙处阻止端口 25 入站到此框，因此该 SMTP 服务器对外界不可见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T05:18:05.857

听起来您的免费（第 3 方）smtp 应用程序没有离开您的网络，并且可能正在尝试查看它是否具有该邮箱本身。试试看是否有允许 smtp 服务器访问外部连接等的设置。免费的 smtp 应用程序的名称是什么，顺便说一句？

或者，您可以使用内置于 iis 中的内置 SMTP 邮件提供程序吗？你知道如何使用它，而不是这个 3rd 方应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T13:40:13.393

使用[Wireshark](http://www.wireshark.org/)查看应用程序和 SMTP 服务器之间的线路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T13:04:47.990

用 C 语言编写和测试一个简单的 smtp 发送器。使用 RFC 需要 3 分钟

# asp.net-mvc - 如何将复杂对象传递给 ASP.NET MVC 中的另一个视图？

> ID：328474
> 
> 赞同：4
> 
> 时间：2008-11-30T05:15:18.670
> 
> 标签：asp.net-mvc

我正在尝试将一个复杂的对象（可以序列化，如果有帮助的话）传递给另一个视图。

目前这是我在某些控制器方法中拥有的代码：-

```
User user = New User { Name = "Fred, Email = "xxxx" };
return RedirectToAction("Foo", user); 
```

现在，我在同一个控制器中有以下操作......

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Foo(User user)
{
 ...
} 
```

当我在那里设置断点时，代码确实停在那里，但`user`值为`null`. 我需要做什么？我错过了什么`global.asax`吗？

干杯:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T05:24:43.877

将您的用户对象放入 TempData。您不能将其作为参数传递。

```
TempData["User"]  = new User { Name = "Fred", Email = "xxxx" };
return RedirectToAction("Foo");

[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Foo()
{
    User user = (User)TempData["User"];
    ...
} 
```

类似于[如何使用 RedirectToAction 维护 ModelState？](https://stackoverflow.com/questions/279665/how-can-i-maintain-modelstate-with-redirecttoaction#279740)

# language-agnostic - 我们是否应该将浮点数的相等性与 *relative* 错误进行比较？

> ID：328475
> 
> 赞同：17
> 
> 时间：2008-11-30T05:17:53.983
> 
> 标签：language-agnostic, math, comparison, floating-point

到目前为止，我已经看到很多关于浮点数相等的帖子。像“我们应该如何确定 x 和 y 是否相等？”这样的问题的标准答案。是

```
abs(x - y) < epsilon 
```

其中 epsilon 是一个*固定*的小常数。这是因为“操作数”x 和 y 通常是一些涉及舍入误差的计算的结果，因此标准相等运算符 == 不是我们的意思，我们真正应该问的是 x 和 y 是否*接近*, 不相等。

现在，我觉得如果 x 与 y “几乎相等”，那么 x*10^20 也应该与 y*10^20 “几乎相等”，因为*相对*误差应该是相同的（但“相对“对什么？）。但是对于这些大数字，上述测试将失败，即该解决方案不会“扩展”。

你会如何处理这个问题？我们应该重新调整数字还是重新调整 epsilon？如何？（还是我的直觉错了？）

这是一个[相关的问题](https://stackoverflow.com/questions/21265/comparing-ieee-floats-and-doubles-for-equality)，但我不喜欢它接受的答案，因为 reinterpret_cast 事情对我来说似乎有点棘手，我不明白发生了什么。请尝试提供一个简单的测试。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-30T05:22:08.373

这完全取决于具体的问题域。是的，在一般情况下使用相对误差会更正确，但它的效率可能会大大降低，因为它涉及额外的浮点除法。如果您知道问题中数字的大致比例，则可以使用绝对误差。

[本页](http://www.cygnus-software.com/papers/comparingfloats/comparingfloats.htm)概述了一些比较浮点数的技术。它还讨论了许多重要问题，例如具有次正规、无穷大和 NaN 的问题。这是一本很棒的书，我强烈建议您通读一遍。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T06:53:42.747

作为替代解决方案，为什么不直接对数字进行四舍五入或截断，然后进行直接比较？通过预先设置有效位数，您可以确定该范围内的准确性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T05:52:35.943

问题是，对于非常大的数字，与 epsilon 进行比较会失败。

也许更好（但更慢）的解决方案是使用除法，例如：

```
div(max(a, b), min(a, b)) < eps + 1 
```

现在“错误”将是相对的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-26T20:03:30.180

使用相对误差至少不如使用绝对误差那么糟糕，但由于舍入问题，它对于接近零的值存在微妙的问题。一个远非完美但有些鲁棒的算法结合了绝对误差和相对误差方法：

```
boolean approxEqual(float a, float b, float absEps, float relEps) {
    // Absolute error check needed when comparing numbers near zero.
    float diff = abs(a - b);
    if (diff <= absEps) {
        return true;
    }

    // Symmetric relative error check without division.
    return (diff <= relEps * max(abs(a), abs(b)));
} 
```

我从 Bruce Dawson 的优秀文章[Comparing Floating Point Numbers, 2012 Edition](https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)中改编了这段代码，这是任何进行浮点比较的人的必读文章——这是一个非常复杂的主题，有很多陷阱。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-02-27T23:00:47.293

大多数情况下，代码比较值是为了回答某种问题。例如：

1.  如果我知道给定 X 值时函数返回什么，我可以假设如果给定 Y 它将返回相同的东西吗？

2.  如果我有一种计算缓慢但准确的函数的方法，我愿意接受一些不准确以换取速度，并且我想测试一个似乎符合要求的候选函数，该函数的输出是否足够接近到已知准确的被认为是“正确的”。

为了回答第一个问题，理想情况下，代码应该对值进行逐位比较，除非一种语言支持 2009 年添加到 IEEE-754 的新运算符，其效率可能低于理想值。要回答第二个问题，应该定义所需的准确度并进行测试。

我认为通用方法没有太多优点，因为不同的应用程序对绝对和相对公差有不同的要求，这取决于测试应该回答的确切问题。

# web-services - Juval Lowy 的 WCF ServiceModelEx 库在哪里？

> ID：328485
> 
> 赞同：20
> 
> 时间：2008-11-30T05:30:28.233
> 
> 标签：web-services, wcf, servicemodelex

WCF 是 Microsoft 对 .Net Remoting 和 Web 服务的替代品。了解您是否是 .NET 组件开发人员至关重要。

WCF 的最佳参考似乎是（通过口耳相传、博客和亚马逊）Juval Lowy 的“Programming WCF Services”，由 O'Reilly 出版。

这本书在网络上的几个地方都被宣传为“随 Juval Lowy 的 ServiceModelEx 库一起提供”，它应该是扩展和简化 WCF 开发的这个很棒的 WCF 框架。在这本书中，Lowy 对这个框架进行了很多讨论。

但是，我不知道在哪里下载该库。如果您查看他网站的下载[页面](http://idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11)，那里有很多东西，但没有 ServiceModelEx。

他是否打算让他的读者通过他书中的代码示例手动重新编码所有内容？

有这方面经验的人吗？

是的，这是一个小众问题，但我认为这是一个重要的话题，而且肯定与编程有关。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-30T05:42:07.163

最新版本在 IDesign 的网站上维护：

[http://idesign.net/Downloads/GetDownload/1887](http://idesign.net/Downloads/GetDownload/1887)

旧版本可在 O'Reilly 网站上找到。

编程 WCF 服务第 3 版 (PWSTE) 示例： [http ://examples.oreilly.com/9780596805494/](http://examples.oreilly.com/9780596805494/)

编程 WCF 服务第 2 版 (PWSSE) 示例： [http ://examples.oreilly.com/9780596521301/](http://examples.oreilly.com/9780596521301/)

我通过以下方式找到了这个：

[http://oreilly.com/catalog/9780596521301/](http://oreilly.com/catalog/9780596521301/)

并单击“示例”

下载 zip 文件，其中包含 ServiceModelEx 的所有代码。我希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-05T08:15:28.233

你可以在这里找到它：

[http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11#WCFEssentials](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11#WCFEssentials)

只需在浏览器中搜索“ServiceModelEx”即可跳转到正确的链接；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-01T06:29:26.627

在 PWSTE - Sources 中有四个子文件夹：

1.  服务模型
2.  ServiceModelEx (.NET 3.5)
3.  ServiceModelEx（无服务总线）
4.  工具

WCF Samples 下的`ServiceModelEx`许多示例项目的源代码级别都包含它。通过学习 Juval 的代码，您可以学到很多好东西。好祝福他。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-19T23:57:56.033

我经历了同样的过程。但是，幸运的是，我需要从 Idesign 的网站下载 InProc Factory 项目，而且 ServiceModelEx 与 InProc Factory 示例捆绑在一起。

它存储在[InProc Factory](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11#WCFEssentials)下。

zip 文件有两个项目。一种是 InProc Factory，另一种是 ServiceModelEx。希望这会有所帮助。

# python - 监控python中的显示状态？

> ID：328490
> 
> 赞同：2
> 
> 时间：2008-11-30T05:32:54.470
> 
> 标签：python, winapi

如何判断 Windows 何时更改显示器电源状态？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T15:21:13.393

似乎，当 Windows 想要启动屏幕保护程序或关闭显示器时，它会向`WM_SYSCOMMAND`最顶层的窗口发送 a `wParam`（`SC_SCREENSAVE`启动屏幕保护程序）或 a `wParam`of`SC_MONITORPOWER`和`lParam`1 或 2 （打开显示器离开）。然后，此消息将被传递给`DefWindowProc`实际执行操作。因此，如果您的窗口恰好是最顶层的窗口，您可以拦截这些事件并忽略它们（或者在将它们传递给 之前做任何您想做的事情`DefWindowProc`）。

在 Windows Vista 上，似乎有一种更直观、更可靠的方式来了解显示器的电源状态。你打电话`RegisterPowerSettingNotification`告诉系统向你的窗口发送`WM_POWERBROADCAST`一条带有 a `wParam`of`PBT_POWERSETTINGCHANGE`和 a`lParam`指向`POWERBROADCAST_SETTING`结构的消息。

我无法测试它们中的任何一个，因为我目前附近没有任何装有 Windows 的计算机。但是，我希望他们为您指明正确的方向。

参考：

*   [旧新事物：在黑暗中摸索，偶然发现错误的解决方案](http://blogs.msdn.com/oldnewthing/archive/2006/06/13/629451.aspx)
*   [递归钩子... - borland.public.delphi.nativeapi.win32 | 谷歌网上论坛](http://groups.google.com/group/borland.public.delphi.nativeapi.win32/browse_thread/thread/81afbb4aff7503d4)
*   [注册电源事件 (Windows)](http://msdn.microsoft.com/en-us/library/aa373195(VS.85).aspx)

# python - 在python中设置监视器电源状态？

> ID：328492
> 
> 赞同：1
> 
> 时间：2008-11-30T05:34:32.110
> 
> 标签：python, winapi

如何让显示器进入/退出不同的电源状态（如睡眠）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T07:00:50.343

看完这篇文章后：

[http://vbnet.mvps.org/index.html?code/screen/scmonitorpower.htm](http://vbnet.mvps.org/index.html?code/screen/scmonitorpower.htm)

看来您需要发送类似于以下内容的 SendMessage 调用：

SendMessage（Me.hWnd，WM_SYSCOMMAND，SC_MONITORPOWER，ByVal MONITOR_OFF）

虽然，那是一个VB版本。您真正追求的是 WinAPI 调用，我相信您可以将这一位转换为在 Python 中调用 WinAPI 调用的任何方式。我希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-25T07:04:24.227

```
import win32gui
import win32con

if argument == "on":
  win32gui.SendMessage(win32con.HWND_BROADCAST, win32con.WM_SYSCOMMAND,
                       win32con.SC_MONITORPOWER, -1)

if argument == "off":
  win32gui.SendMessage(win32con.HWND_BROADCAST, win32con.WM_SYSCOMMAND,
                       win32con.SC_MONITORPOWER, 2)

if argument == "sleep":
  win32gui.SendMessage(win32con.HWND_BROADCAST, win32con.WM_SYSCOMMAND,
                       win32con.SC_MONITORPOWER, 1) 
```

# java - 你什么时候会使用建造者模式？

> ID：328496
> 
> 赞同：583
> 
> 时间：2008-11-30T05:41:23.250
> 
> 标签：java, design-patterns, builder

使用 Builder 模式的一些*常见*的、*真实的例子是什么？*它给你买了什么？为什么不直接使用工厂模式？

* * *

## 回答 #1

> 赞同：1097
> 
> 时间：2009-12-23T15:52:03.140

*以下是争论在 Java 中使用模式和示例代码的一些原因，但它是设计模式*中的四人组所涵盖的构建器模式的实现。在 Java 中使用它的原因也适用于其他编程语言。

正如 Joshua Bloch 在[Effective Java, 2nd Edition](http://www.amazon.co.uk/Effective-Java-Second-Joshua-Bloch/dp/0321356683)中所说：

> 在设计构造函数或静态工厂具有多个参数的类时，构建器模式是一个不错的选择。

我们都曾在某个时候遇到过一个带有构造函数列表的类，其中每个添加都会添加一个新的选项参数：

```
Pizza(int size) { ... }        
Pizza(int size, boolean cheese) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni, boolean bacon) { ... } 
```

**这称为伸缩构造器模式。**这种模式的问题在于，一旦构造函数有 4 或 5 个参数，就**很难记住**所需**的参数顺序**以及在给定情况下可能需要的特定构造函数。

伸缩构造函数模式的一种**替代方法是****JavaBean 模式**，您可以在其中调用具有强制参数的构造函数，然后在之后调用任何可选的设置器：

```
Pizza pizza = new Pizza(12);
pizza.setCheese(true);
pizza.setPepperoni(true);
pizza.setBacon(true); 
```

**这里的问题是，因为对象是通过多次调用创建的，所以它可能在构建过程中处于不一致的状态。**这也需要付出很多额外的努力来确保线程安全。

**更好的选择是使用构建器模式。**

```
public class Pizza {
  private int size;
  private boolean cheese;
  private boolean pepperoni;
  private boolean bacon;

  public static class Builder {
    //required
    private final int size;

    //optional
    private boolean cheese = false;
    private boolean pepperoni = false;
    private boolean bacon = false;

    public Builder(int size) {
      this.size = size;
    }

    public Builder cheese(boolean value) {
      cheese = value;
      return this;
    }

    public Builder pepperoni(boolean value) {
      pepperoni = value;
      return this;
    }

    public Builder bacon(boolean value) {
      bacon = value;
      return this;
    }

    public Pizza build() {
      return new Pizza(this);
    }
  }

  private Pizza(Builder builder) {
    size = builder.size;
    cheese = builder.cheese;
    pepperoni = builder.pepperoni;
    bacon = builder.bacon;
  }
} 
```

请注意，**Pizza 是不可变的，并且参数值都在一个位置**。因为 Builder 的 setter 方法返回 Builder 对象，所以它们**可以被链接**。

```
Pizza pizza = new Pizza.Builder(12)
                       .cheese(true)
                       .pepperoni(true)
                       .bacon(true)
                       .build(); 
```

**这导致代码易于编写且非常易于阅读和理解。**在此示例中，**可以修改 build 方法以在**将参数从构建器复制到 Pizza 对象后检查参数，**如果提供了无效的参数值，则抛出 IllegalStateException。**这种模式很灵活，将来很容易向其中添加更多参数。仅当构造函数的参数超过 4 或 5 个时，它才真正有用。也就是说，**如果您怀疑将来可能会添加更多参数，那么这可能是值得的。**

我从Joshua Bloch的《 *Effective Java, 2nd Edition*》一书中大量借鉴了这个主题。要了解有关此模式和其他有效 Java 实践的更多信息，**我强烈推荐它。**

* * *

## 回答 #2

> 赞同：340
> 
> 时间：2008-11-30T19:00:52.887

考虑一家餐馆。“今天的饭菜”的创建是一种工厂模式，因为你告诉厨房“给我今天的饭菜”，厨房（工厂）根据隐藏的标准决定生成什么对象。

如果您订购定制比萨，则会出现构建器。在这种情况下，服务员告诉厨师（建造者）“我需要一个比萨饼；加奶酪、洋葱和培根！” 因此，构建器公开了生成的对象应具有的属性，但隐藏了如何设置它们。

* * *

## 回答 #3

> 赞同：281
> 
> 时间：2008-11-30T05:51:16.913

恕我直言，构建器和工厂之间的主要区别在于，当您需要做很多事情来构建对象时，构建器很有用。例如想象一个 DOM。您必须创建大量节点和属性才能获得最终对象。当工厂可以在一个方法调用中轻松创建整个对象时，使用工厂。

使用构建器的一个示例是构建 XML 文档，例如，我在构建 HTML 片段时使用了此模型，我可能有一个构建器用于构建特定类型的表，它可能具有以下方法**（未显示参数）**：

```
BuildOrderHeaderRow()
BuildLineItemSubHeaderRow()
BuildOrderRow()
BuildLineItemSubRow() 
```

然后这个构建器会为我吐出 HTML。这比通过大型程序方法更容易阅读。

查看[Wikipedia 上的 Builder 模式](http://en.wikipedia.org/wiki/Builder_pattern)。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-20T01:46:00.190

.NET StringBuilder 类是构建器模式的一个很好的例子。它主要用于通过一系列步骤创建字符串。执行 ToString() 得到的最终结果始终是一个字符串，但该字符串的创建会根据使用的 StringBuilder 类中的函数而有所不同。总而言之，基本思想是构建复杂对象并隐藏其构建方式的实现细节。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-30T05:51:17.647

对于多线程问题，我们需要为每个线程构建一个复杂的对象。该对象表示正在处理的数据，并且可以根据用户输入而改变。

我们可以改用工厂吗？是的

为什么我们没有？我猜生成器更有意义。

工厂用于创建具有相同基本类型（实现相同接口或基类）的不同类型的对象。

构建器一遍又一遍地构建相同类型的对象，但构建是动态的，因此可以在运行时更改。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2014-10-07T13:16:29.123

我一直不喜欢 Builder 模式，因为它笨拙、突兀并且经常被经验不足的程序员滥用。只有当您需要从需要**初始化后步骤的**某些数据中组装对象时（即，一旦收集了所有数据 - 对其进行处理），它的模式才有意义。相反，在 99% 的时间里，构建器只是用来初始化类成员。

在这种情况下，最好在`withXyz(...)`类中简单地声明类型设置器并让它们返回对自身的引用。

考虑一下：

```
public class Complex {

    private String first;
    private String second;
    private String third;

    public String getFirst(){
       return first; 
    }

    public void setFirst(String first){
       this.first=first; 
    }

    ... 

    public Complex withFirst(String first){
       this.first=first;
       return this; 
    }

    public Complex withSecond(String second){
       this.second=second;
       return this; 
    }

    public Complex withThird(String third){
       this.third=third;
       return this; 
    }

}

Complex complex = new Complex()
     .withFirst("first value")
     .withSecond("second value")
     .withThird("third value"); 
```

现在我们有了一个简洁的类，它管理自己的初始化，并且与构建器完成几乎相同的工作，除了它更优雅。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-11-30T05:50:14.357

当您有很多选择要处理时，您会使用它。想想像 jmock 这样的事情：

```
m.expects(once())
    .method("testMethod")
    .with(eq(1), eq(2))
    .returns("someResponse"); 
```

它感觉更自然，并且......可能。

还有 xml 构建、字符串构建和许多其他的东西。想象一下，如果`java.util.Map`作为建设者投入。你可以做这样的事情：

```
Map<String, Integer> m = new HashMap<String, Integer>()
    .put("a", 1)
    .put("b", 2)
    .put("c", 3); 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2010-11-17T06:45:30.167

在浏览 Microsoft MVC 框架时，我想到了构建器模式。我在 ControllerBuilder 类中遇到了这种模式。该类是返回控制器工厂类，然后用于构建具体的控制器。

我看到使用构建器模式的优点是，您可以创建自己的工厂并将其插入框架。

@Tetha，可以有一家意大利人经营的餐厅（框架），供应披萨。为了准备比萨，意大利人（对象生成器）使用欧文（工厂）和比萨基地（基类）。

现在印度人从意大利人手中接管了餐厅。印度餐厅 (Framework) 提供 dosa 而不是披萨。为了准备 dosa 印度人（对象生成器）使用煎锅（工厂）和 Maida（基类）

如果你看场景，食物是不同的，食物的准备方式是不同的，但在同一家餐厅（在同一框架下）。餐厅的建造方式应该能够支持中国、墨西哥或任何菜肴。框架内的对象构建器有助于插入您想要的美食。例如

```
class RestaurantObjectBuilder
{
   IFactory _factory = new DefaultFoodFactory();

   //This can be used when you want to plugin the 
   public void SetFoodFactory(IFactory customFactory)
   {
        _factory = customFactory;
   }

   public IFactory GetFoodFactory()
   {
      return _factory;
   }
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-11-30T17:51:26.070

在前面的答案（双关语）的基础上，一个出色的真实示例是[Groovy](http://groovy-lang.org/)内置的对`Builders`.

*   [使用 Groovy 创建 XML`MarkupBuilder`](http://groovy-lang.org/processing-xml.html#_markupbuilder)
*   [使用 Groovy 创建 XML`StreamingMarkupBuilder`](http://groovy-lang.org/processing-xml.html#_streamingmarkupbuilder)
*   [摇摆生成器](http://groovy-lang.org/dsls.html#swingbuilder)
*   [`SwingXBuilder`](https://web-beta.archive.org/web/20150228001633/http://groovy.codehaus.org/SwingXBuilder)

请参阅[Groovy 文档](http://groovy-lang.org/documentation.html)中的[构建器](http://groovy-lang.org/dsls.html#_builders)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-12-24T00:20:42.263

构建器的另一个优点是，如果你有一个工厂，你的代码中仍然存在一些耦合，因为**工厂要工作，它必须知道它可能创建的所有对象**。如果添加另一个可以创建的对象，则必须修改工厂类以包含他。这也发生在抽象工厂中。

另一方面，使用构建器，您只需为这个新类创建一个新的具体构建器。导演类将保持不变，因为它在构造函数中接收构建器。

此外，还有许多口味的builder。Kamikaze Mercenary's 给了另一个。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-01-16T12:55:36.123

```
/// <summary>
/// Builder
/// </summary>
public interface IWebRequestBuilder
{
    IWebRequestBuilder BuildHost(string host);

    IWebRequestBuilder BuildPort(int port);

    IWebRequestBuilder BuildPath(string path);

    IWebRequestBuilder BuildQuery(string query);

    IWebRequestBuilder BuildScheme(string scheme);

    IWebRequestBuilder BuildTimeout(int timeout);

    WebRequest Build();
}

/// <summary>
/// ConcreteBuilder #1
/// </summary>
public class HttpWebRequestBuilder : IWebRequestBuilder
{
    private string _host;

    private string _path = string.Empty;

    private string _query = string.Empty;

    private string _scheme = "http";

    private int _port = 80;

    private int _timeout = -1;

    public IWebRequestBuilder BuildHost(string host)
    {
        _host = host;
        return this;
    }

    public IWebRequestBuilder BuildPort(int port)
    {
        _port = port;
        return this;
    }

    public IWebRequestBuilder BuildPath(string path)
    {
        _path = path;
        return this;
    }

    public IWebRequestBuilder BuildQuery(string query)
    {
        _query = query;
        return this;
    }

    public IWebRequestBuilder BuildScheme(string scheme)
    {
        _scheme = scheme;
        return this;
    }

    public IWebRequestBuilder BuildTimeout(int timeout)
    {
        _timeout = timeout;
        return this;
    }

    protected virtual void BeforeBuild(HttpWebRequest httpWebRequest) {
    }

    public WebRequest Build()
    {
        var uri = _scheme + "://" + _host + ":" + _port + "/" + _path + "?" + _query;

        var httpWebRequest = WebRequest.CreateHttp(uri);

        httpWebRequest.Timeout = _timeout;

        BeforeBuild(httpWebRequest);

        return httpWebRequest;
    }
}

/// <summary>
/// ConcreteBuilder #2
/// </summary>
public class ProxyHttpWebRequestBuilder : HttpWebRequestBuilder
{
    private string _proxy = null;

    public ProxyHttpWebRequestBuilder(string proxy)
    {
        _proxy = proxy;
    }

    protected override void BeforeBuild(HttpWebRequest httpWebRequest)
    {
        httpWebRequest.Proxy = new WebProxy(_proxy);
    }
}

/// <summary>
/// Director
/// </summary>
public class SearchRequest
{

    private IWebRequestBuilder _requestBuilder;

    public SearchRequest(IWebRequestBuilder requestBuilder)
    {
        _requestBuilder = requestBuilder;
    }

    public WebRequest Construct(string searchQuery)
    {
        return _requestBuilder
        .BuildHost("ajax.googleapis.com")
        .BuildPort(80)
        .BuildPath("ajax/services/search/web")
        .BuildQuery("v=1.0&q=" + HttpUtility.UrlEncode(searchQuery))
        .BuildScheme("http")
        .BuildTimeout(-1)
        .Build();
    }

    public string GetResults(string searchQuery) {
        var request = Construct(searchQuery);
        var resp = request.GetResponse();

        using (StreamReader stream = new StreamReader(resp.GetResponseStream()))
        {
            return stream.ReadToEnd();
        }
    }
}

class Program
{
    /// <summary>
    /// Inside both requests the same SearchRequest.Construct(string) method is used.
    /// But finally different HttpWebRequest objects are built.
    /// </summary>
    static void Main(string[] args)
    {
        var request1 = new SearchRequest(new HttpWebRequestBuilder());
        var results1 = request1.GetResults("IBM");
        Console.WriteLine(results1);

        var request2 = new SearchRequest(new ProxyHttpWebRequestBuilder("localhost:80"));
        var results2 = request2.GetResults("IBM");
        Console.WriteLine(results2);
    }
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-11-30T18:05:42.593

我在本土消息传递库中使用了构建器。库核心从线路接收数据，并使用 Builder 实例收集数据，然后，一旦 Builder 决定它已获得创建 Message 实例所需的一切， Builder.GetMessage() 正在使用从收集的数据构造消息实例金属丝。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-03-18T14:48:33.120

当我想在我的 XML 中使用标准 XMLGregorianCalendar 来对 Java 中的 DateTime 进行对象编组时，我听到了很多关于使用它的重量和繁琐程度的评论。我试图控制 xs:datetime 结构中的 XML 字段来管理时区、毫秒等。

因此，我设计了一个实用程序来从 GregorianCalendar 或 java.util.Date 构建 XMLGregorian 日历。

由于我工作的地方，我不允许在没有合法的情况下在线共享它，但这里有一个客户如何使用它的示例。它抽象了细节并过滤了一些不太用于 xs:datetime 的 XMLGregorianCalendar 实现。

```
XMLGregorianCalendarBuilder builder = XMLGregorianCalendarBuilder.newInstance(jdkDate);
XMLGregorianCalendar xmlCalendar = builder.excludeMillis().excludeOffset().build(); 
```

授予此模式更多的是一个过滤器，因为它将 xmlCalendar 中的字段设置为未定义，因此它们被排除在外，它仍然“构建”它。我已经轻松地向构建器添加了其他选项，以创建 xs:date 和 xs:time 结构，并在需要时操纵时区偏移。

如果您曾经看过创建和使用 XMLGregorianCalendar 的代码，您会看到这如何使它更易于操作。

# opengl - 在不裁剪的情况下缩放 SDL 曲面的正确方法？

> ID：328500
> 
> 赞同：8
> 
> 时间：2008-11-30T05:43:32.060
> 
> 标签：opengl, sdl

缩放 SDL 表面的正确方法是什么？我在网上找到了一种解释，但它需要逐个像素地重绘 Surface。似乎应该有某种方式通过 SDL 本地执行此操作，而不是像那样重绘图像。我无法在涵盖此内容的 SDL 文档中找到任何内容。我可以通过修改曲面的宽度和高度来毫无问题地调整曲面的大小，但生成的曲面会被剪裁。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2015-06-22T00:04:30.420

我知道这个答案太迟了，无法帮助提出这个问题的人，但我决定写这个来帮助任何偶然发现这个问题的人。在 SDL 2.0 中，您可以使用该`SDL_BlitScaled()`功能将表面缩放为目标`SDL_Rect`. [LazyFoo](http://lazyfoo.net/tutorials/SDL/05_optimized_surface_loading_and_soft_stretching/index.php)有一个教程描述了这一点，或者查看这个[文档](https://wiki.libsdl.org/SDL_BlitScaled)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-30T06:09:29.497

SDL 不支持缩放位图。根据[SDL_BlitSurface](http://www.libsdl.org/cgi/docwiki.cgi/SDL_BlitSurface)的文档：

> 注意：SDL blitter （还）不具备像其他更复杂的 blitting 机制那样向上或向下缩放 blitted 表面的能力。如果你想缩放图像（例如使用 SDL_gfx），你必须自己想办法。

[您可以在此处](http://www.ferzkopp.net/Software/SDL_gfx-2.0/)找到 SDL_gfx 。编写自己的 blitting 函数并没有那么糟糕，它可能是一个有趣且有用的学习实验（尽管你会重新发明轮子）。使用 OpenGL 也是一种选择，因为像缩放和旋转这样的东西可以在一个函数调用中完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-02-17T10:54:13.517

为了完整起见，并且由于问题未指定 SDL 版本，因此可以在 SDL2 中使用 API 方法进行缩放`SDL_RenderCopyEx`。除了基本的 SDL2 库之外，不需要其他库。

```
int SDL_RenderCopyEx(SDL_Renderer*          renderer,
                     SDL_Texture*           texture,
                     const SDL_Rect*        srcrect,
                     const SDL_Rect*        dstrect,
                     const double           angle,
                     const SDL_Point*       center,
                     const SDL_RendererFlip flip) 
```

通过设置一个的大小`dstrect`可以将纹理缩放到整数个像素。也可以同时旋转和翻转纹理。

从技术上讲，这不是缩放表面，而是缩放纹理。尽管在基于 SDL2 的应用程序中进行渲染之前，表面几乎总是被转换为纹理，但该过程应该是相关的。

参考：[https ://wiki.libsdl.org/SDL_RenderCopyEx](https://wiki.libsdl.org/SDL_RenderCopyEx)

像往常一样创建你的纹理：

```
surface = IMG_Load(filePath);
texture = SDL_CreateTextureFromSurface(renderer, surface); 
```

当需要渲染它时，调用`SDL_RenderCopyEx`而不是`SDL_RenderCopy`

# c - 是否存在搜索 unix $PATH 变量并在某个文件存在时返回 true 的函数？

> ID：328521
> 
> 赞同：3
> 
> 时间：2008-11-30T06:20:58.273
> 
> 标签：c, linux, unix

execvp() 函数执行作为参数给出的程序。它检查 $PATH 变量以找到程序。我正在写一些东西，我想在调用任何 exec() 函数之前检查是否存在多个程序。最好的方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T06:29:22.170

您可以使用 getenv 获取 PATH 环境变量，然后搜索它。

[http://www.opengroup.org/onlinepubs/000095399/functions/getenv.html](http://www.opengroup.org/onlinepubs/000095399/functions/getenv.html)

然后，您可以使用 fopen 检查特定二进制名称是否存在。

您也可以执行类似 system("which App") 的操作。它会为您搜索 $PATH。

[http://en.wikipedia.org/wiki/System_(C_standard_library)](http://en.wikipedia.org/wiki/System_(C_standard_library))

[http://en.wikipedia.org/wiki/Which_(Unix)](http://en.wikipedia.org/wiki/Which_(Unix))

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T06:56:58.013

glibc 和 netbsd 的 execvp 实际上会尝试为路径上的每个元素执行命令，直到它成功或用完搜索路径。不会留下太多重复使用的空间，但看起来不错。

一般来说，对于这样的问题，我喜欢去源头看看它做了什么。NetBSD 通常是最好的读物：

*   [NetBSD execvp 源码](http://cvsweb.netbsd.org/bsdweb.cgi/src/lib/libc/gen/execvp.c?rev=1.30&content-type=text/x-cvsweb-markup&only_with_tag=MAIN)
*   [glibc execvp 源码](http://sources.redhat.com/cgi-bin/cvsweb.cgi/libc/posix/execvp.c?rev=1.27&content-type=text/x-cvsweb-markup&cvsroot=glibc)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T06:47:35.193

该命令**可能**是您想要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T07:37:00.847

一旦有了绝对（规范化）路径名，就可以使用**stat** (2) 或**access** (2) 来查看文件是否存在。

有统计：

```
struct stat st;
if (stat(path, &st)) {
   // path doesn't exist
} 
```

有访问权限：

```
if (access(path, F_OK)) {
   // path doesn't exist
} 
```

# new-operator - 对于有经验的 PHP 开发人员来说，什么是好的 GUI 编程语言？

> ID：328522
> 
> 赞同：3
> 
> 时间：2008-11-30T06:23:57.813
> 
> 标签：new-operator, choice

我使用 PHP 已经有一段时间了，想学习一些基于 Windows 桌面的 GUI 应用程序。类似于 C# 或 Visual Basic 的东西会很好，但是我想学习一种开放的语言，类似于 PHP。

请不要建议任何需要昂贵编译器或不允许您创建独立应用程序的编译器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T06:37:21.420

如果您正在寻找除 php 之外的另一种语言：

**.NET WinForms**

1.  您可以在微软网站上免费下载 Visual Studio Express 2008。
2.  您还可以使用 MONO ( [http://www.mono-project.com/](http://www.mono-project.com/) ) 来编写您的 .net WinForms 代码。

**具有 GUI 绑定的其他语言**

*   Ruby/Python/Perl 与 wxWidgets/GTK/QT 绑定

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T06:44:42.483

不要将 PHP 用于 GUI 应用程序。这不是它的目的。您寻找另一种语言的想法很好。

*   Python 与 PH 非常相似，但作为一门语言要成熟得多。它有一些不错的 GUI 绑定。如果你不想要更多类似游戏的 UI，你甚至可以进入 pygame 之类的东西。
*   Java 现在是开源的。不过，Java GUI 往往很普通。我认为最近情况有所好转。Charles, Eclipse 是一些具有漂亮界面的 Java 应用程序。
*   我会跳过 VB，但 C# 是个好主意。您可能会发现它在将来找工作时很有用。当然，当涉及到 GUI 时，这将是最简单的。
*   你可以看看 Flex。不过，我不是 Adob​​e 开发环境的忠实粉丝。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T07:32:36.317

我认为您将很难找到非常适合桌面 GUI 应用程序的 PHP。像 PHP 这样的语言展示了它们的“网页脚本隐藏”传统，就像 awk 和 perl 非常适合 unix 机器上的通用/管理脚本一样。

许多语言都有 GUI 绑定（tk、gtk、...） - 包括最接近（但仍不那么接近）php 的“解释”绑定。明显的例子是 python、ruby 或 perl（尽管我强烈推荐前两个中的一个）。

然而，这些都不是真正面向桌面 GUI 应用程序的，它显示了。诸如 Java 之类的语言更适合这种事情，但在语言方面迈出了一大步。

如果您使用的是 Windows 系统，我建议您使用带有单声道的 c#。我认为使用正确的工具比使用接近 PHP 的工具更重要。

甚至不考虑VB

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T06:26:46.093

由于您有 PHP 背景，我建议您尝试[PHP-GTK](http://gtk.php.net/)。

PHP-GTK 是 PHP 的一个扩展，它实现了[GTK+](http://www.gtk.org/)的语言绑定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T20:32:13.757

PHP-GTK 是 PHP 预期用途的真正延伸。我个人会远离。Python 和 wxWidgets 是开始创建 GUI 的简单方法。如果您不想手写表单，有一些表单构建器（例如 PythonCard 和 wxGlade）可以加快处理过程。

# ruby-on-rails - Rails：如何在 ActiveRecord 中设置默认值？

> ID：328525
> 
> 赞同：438
> 
> 时间：2008-11-30T06:27:29.350
> 
> 标签：ruby-on-rails, rails-activerecord

如何在 ActiveRecord 中设置默认值？

我看到 Pratik 的一篇文章描述了一段丑陋、复杂的代码： http: [//m.onkey.org/2007/7/24/how-to-set-default-values-in-your-model](http://m.onkey.org/2007/7/24/how-to-set-default-values-in-your-model)

```
class Item < ActiveRecord::Base  
  def initialize_with_defaults(attrs = nil, &block)
    initialize_without_defaults(attrs) do
      setter = lambda { |key, value| self.send("#{key.to_s}=", value) unless
        !attrs.nil? && attrs.keys.map(&:to_s).include?(key.to_s) }
      setter.call('scheduler_type', 'hotseat')
      yield self if block_given?
    end
  end
  alias_method_chain :initialize, :defaults
end 
```

我已经看到以下示例在谷歌搜索：

```
 def initialize 
    super
    self.status = ACTIVE unless self.status
  end 
```

和

```
 def after_initialize 
    return unless new_record?
    self.status = ACTIVE
  end 
```

我也看到人们把它放在他们的迁移中，但我宁愿看到它在模型代码中定义。

是否有规范的方法来为 ActiveRecord 模型中的字段设置默认值？

* * *

## 回答 #1

> 赞同：578
> 
> 时间：2011-02-26T15:14:11.000

每个可用方法都有几个问题，但我认为定义`after_initialize`回调是可行的方法，原因如下：

1.  `default_scope`将为新模型初始化值，但这将成为您找到模型的范围。如果您只想将一些数字初始化为 0，那么这*不是*您想要的。
2.  在您的迁移中定义默认值也有部分时间......正如已经提到的，当您只调用 Model.new 时，这将*不起作用。*
3.  覆盖`initialize`可以工作，但不要忘记调用`super`！
4.  使用像 phusion 这样的插件有点荒谬。这是 ruby​​，我们真的需要一个插件来初始化一些默认值吗？
5.  `after_initialize` **从 Rails 3 开始不推荐使用**覆盖。当我`after_initialize`在 rails 3.0.3 中覆盖时，我在控制台中收到以下警告：

> 弃用警告：Base#after_initialize 已被弃用，请改用 Base.after_initialize :method。（从 /Users/me/myapp/app/models/my_model:15 调用）

因此，我会说编写一个`after_initialize`回调，*除了*让您在关联上设置默认值之外，它还可以让您使用默认属性，如下所示：

```
 class Person < ActiveRecord::Base
    has_one :address
    after_initialize :init

    def init
      self.number  ||= 0.0           #will set the default value only if it's nil
      self.address ||= build_address #let's you set a default association
    end
  end 
```

现在您**只有一个**地方可以查找模型的初始化。我一直在使用这种方法，直到有人提出更好的方法。

注意事项：

1.  对于布尔字段，请执行以下操作：

    `self.bool_field = true if self.bool_field.nil?`

    有关更多详细信息，请参阅 Paul Russell 对此答案的评论

2.  如果您只为模型选择列的子集（即；`select`在类似的查询中使用），如果您的方法访问未包含在子句中的列，`Person.select(:firstname, :lastname).all`您将得到一个。您可以像这样防范这种情况：`MissingAttributeError``init``select`

    `self.number ||= 0.0 if self.has_attribute? :number`

    对于布尔列...

    `self.bool_field = true if (self.has_attribute? :bool_value) && self.bool_field.nil?`

    另请注意，Rails 3.2 之前的语法有所不同（请参阅下面的 Cliff Darling 评论）

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2017-04-19T01:40:29.107

# 导轨 5+

您可以在模型中使用[属性](http://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute)方法，例如：

```
class Account < ApplicationRecord
  attribute :locale, :string, default: 'en'
end 
```

* * *

您还可以将 lambda 传递给`default`参数。例子：

```
attribute :uuid, :string, default: -> { SecureRandom.uuid } 
```

第二个参数是类型，也可以是自定义类型类实例，例如：

```
attribute :uuid, UuidType.new, default: -> { SecureRandom.uuid } 
```

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2008-11-30T13:45:52.493

我们通过迁移将默认值放入数据库中（通过`:default`在每个列定义上指定选项）并让 Active Record 使用这些值来为每个属性设置默认值。

恕我直言，这种方法符合 AR 的原则：约定优于配置、DRY、表定义驱动模型，而不是相反。

请注意，默认值仍在应用程序 (Ruby) 代码中，尽管不在模型中，而是在迁移中。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2012-07-18T14:36:30.567

一些简单的情况可以通过在数据库模式中定义一个默认值来处理，但不能处理一些更棘手的情况，包括其他模型的计算值和键。对于这些情况，我这样做：

```
after_initialize :defaults

def defaults
   unless persisted?
    self.extras||={}
    self.other_stuff||="This stuff"
    self.assoc = [OtherModel.find_by_name('special')]
  end
end 
```

我决定使用 after_initialize 但我不希望它应用于仅发现那些新的或创建的对象。我认为没有为这个明显的用例提供 after_new 回调几乎令人震惊，但我已经通过确认对象是否已经持久化表明它不是新的来做到这一点。

看过 Brad Murray 的回答后，如果将条件转移到回调请求，这将更加清晰：

```
after_initialize :defaults, unless: :persisted?
              # ":if => :new_record?" is equivalent in this context

def defaults
  self.extras||={}
  self.other_stuff||="This stuff"
  self.assoc = [OtherModel.find_by_name('special')]
end 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2012-09-14T05:37:50.120

只需执行以下操作即可改进 after_initialize 回调模式

```
after_initialize :some_method_goes_here, :if => :new_record? 
```

如果您的 init 代码需要处理关联，这有一个重要的好处，因为如果您读取初始记录而不包括关联，则以下代码会触发微妙的 n+1。

```
class Account

  has_one :config
  after_initialize :init_config

  def init_config
    self.config ||= build_config
  end

end 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-11-30T09:42:56.740

Phusion 家伙为此提供了一些不错的[插件](http://blog.phusion.nl/2008/10/03/47/)。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-01-11T04:00:59.257

我用[`attribute-defaults`宝石](https://github.com/bsm/attribute-defaults)

从文档中：运行`sudo gem install attribute-defaults`并添加`require 'attribute_defaults'`到您的应用程序。

```
class Foo < ActiveRecord::Base
  attr_default :age, 18
  attr_default :last_seen do
    Time.now
  end
end

Foo.new()           # => age: 18, last_seen => "2014-10-17 09:44:27"
Foo.new(:age => 25) # => age: 25, last_seen => "2014-10-17 09:44:28" 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-08-11T18:55:54.763

比建议的答案更好/更清洁的潜在方法是覆盖访问器，如下所示：

```
def status
  self['status'] || ACTIVE
end 
```

[请参阅ActiveRecord::Base 文档](http://api.rubyonrails.org/classes/ActiveRecord/Base.html)中的“覆盖默认访问器”以及[StackOverflow 中有关使用 self 的更多信息](https://stackoverflow.com/questions/10127393/why-use-self-to-access-activerecord-rails-model-properties)。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-12-22T22:05:59.183

类似的问题，但上下文略有不同： -[如何为 Rails activerecord 模型中的属性创建默认值？](https://stackoverflow.com/questions/1550688/how-do-i-create-a-default-value-for-attributes-in-rails-activerecords-model)

最佳答案:**看你想要什么！**

***如果您希望每个对象都****以一个值开头：*使用`after_initialize :init`

您希望`new.html`表单在打开页面时具有默认值吗？使用[https://stackoverflow.com/a/5127684/1536309](https://stackoverflow.com/a/5127684/1536309)

```
class Person < ActiveRecord::Base
  has_one :address
  after_initialize :init

  def init
    self.number  ||= 0.0           #will set the default value only if it's nil
    self.address ||= build_address #let's you set a default association
  end
  ...
end 
```

***如果您希望每个对象****都有一个根据用户输入计算的值：*使用`before_save :default_values` You want user to enter`X`then`Y = X+'foo'`? 采用：

```
class Task < ActiveRecord::Base
  before_save :default_values
  def default_values
    self.status ||= 'P'
  end
end 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-05-22T14:46:34.197

> 我也看到人们把它放在他们的迁移中，但我宁愿看到它在模型代码中定义。
> 
> 是否有规范的方法来为 ActiveRecord 模型中的字段设置默认值？

在 Rails 5 之前，规范的 Rails 方式实际上是在迁移中设置它，`db/schema.rb`只要想查看数据库为任何模型设置的默认值，只需查看 for 即可。

与@Jeff Perrin 的回答状态相反（有点旧），迁移方法甚至会在 using 时应用默认值`Model.new`，因为 Rails 有一些魔法。已验证在 Rails 4.1.16 中工作。

最简单的事情往往是最好的。减少代码库中的知识债务和潜在的混淆点。而且它“有效”。

```
class AddStatusToItem < ActiveRecord::Migration
  def change
    add_column :items, :scheduler_type, :string, { null: false, default: "hotseat" }
  end
end 
```

或者，对于不创建新列的列更改，请执行以下任一操作：

```
class AddStatusToItem < ActiveRecord::Migration
  def change
    change_column_default :items, :scheduler_type, "hotseat"
  end
end 
```

或者甚至更好：

```
class AddStatusToItem < ActiveRecord::Migration
  def change
    change_column :items, :scheduler_type, :string, default: "hotseat"
  end
end 
```

查看官方[RoR 指南](https://guides.rubyonrails.org/active_record_migrations.html#changing-columns)以了解列更改方法中的选项。

不允许在 DB 中使用`null: false`NULL 值，并且作为额外的好处，它还会更新，以便所有先前为 null 的预先存在的 DB 记录也设置为该字段的默认值。如果您愿意，您可以在迁移中排除此参数，但我发现它非常方便！

正如@Lucas Caton 所说，Rails 5+ 中的规范方式是：

```
class Item < ActiveRecord::Base
  attribute :scheduler_type, :string, default: 'hotseat'
end 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-30T10:07:56.567

~~这就是构造函数的用途！覆盖模型的`initialize`方法。~~

使用`after_initialize`方法。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-07-27T06:36:21.427

伙计们，我最终做了以下事情：

```
def after_initialize 
 self.extras||={}
 self.other_stuff||="This stuff"
end 
```

奇迹般有效！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-02-14T21:35:41.097

这已经回答了很长时间，但是我经常需要默认值并且不希望将它们放入数据库中。我提出了一个`DefaultValues`问题：

```
module DefaultValues
  extend ActiveSupport::Concern

  class_methods do
    def defaults(attr, to: nil, on: :initialize)
      method_name = "set_default_#{attr}"
      send "after_#{on}", method_name.to_sym

      define_method(method_name) do
        if send(attr)
          send(attr)
        else
          value = to.is_a?(Proc) ? to.call : to
          send("#{attr}=", value)
        end
      end

      private method_name
    end
  end
end 
```

然后在我的模型中使用它，如下所示：

```
class Widget < ApplicationRecord
  include DefaultValues

  defaults :category, to: 'uncategorized'
  defaults :token, to: -> { SecureRandom.uuid }
end 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-02-09T10:34:01.957

在进行复杂的查找时，我遇到了`after_initialize`给出错误的问题：`ActiveModel::MissingAttributeError`

例如：

```
@bottles = Bottle.includes(:supplier, :substance).where(search).order("suppliers.name ASC").paginate(:page => page_no) 
```

`.where`条件哈希中的“搜索”

所以我最终通过以这种方式覆盖初始化来做到这一点：

```
def initialize
  super
  default_values
end

private
 def default_values
     self.date_received ||= Date.current
 end 
```

调用是必要的`super`，以确保`ActiveRecord::Base`在执行我的自定义代码之前正确初始化对象，即：default_values

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-30T13:43:00.313

```
class Item < ActiveRecord::Base
  def status
    self[:status] or ACTIVE
  end

  before_save{ self.status ||= ACTIVE }
end 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-10-17T01:59:13.850

after_initialize 方法已弃用，请改用回调。

```
after_initialize :defaults

def defaults
  self.extras||={}
  self.other_stuff||="This stuff"
end 
```

但是，在迁移中使用**:default**仍然是最干净的方法。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-09-08T00:43:17.027

after_initialize 解决方案的问题在于，无论您是否访问此属性，您都必须为从数据库中查找的每个对象添加 after_initialize。我建议采用延迟加载的方法。

属性方法（getter）当然是方法本身，因此您可以覆盖它们并提供默认值。就像是：

```
Class Foo < ActiveRecord::Base
  # has a DB column/field atttribute called 'status'
  def status
    (val = read_attribute(:status)).nil? ? 'ACTIVE' : val
  end
end 
```

除非，就像有人指出的那样，你需要做 Foo.find_by_status('ACTIVE')。在这种情况下，如果数据库支持，我认为您确实需要在数据库约束中设置默认值。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-09-18T05:02:02.637

我强烈建议使用“default_value_for”gem：[https ://github.com/FooBarWidget/default_value_for](https://github.com/FooBarWidget/default_value_for)

有一些棘手的场景几乎需要重写该 gem 所做的初始化方法。

例子：

您的 db 默认值为 NULL，您的模型/ruby 定义的默认值为“某个字符串”，但您实际上*希望*将值设置为 nil，无论出于何种原因：`MyModel.new(my_attr: nil)`

这里的大多数解决方案都无法将值设置为 nil，而是将其设置为默认值。

好的，所以不要采用这种`||=`方法，而是切换到`my_attr_changed?`...

**但是**现在想象您的数据库默认值是“某个字符串”，您的模型/ruby 定义的默认值是“其他字符串”，但是在某种情况下，您*希望*将值设置为“某个字符串”（数据库默认值）：`MyModel.new(my_attr: 'some_string')`

这将导致**错误**`my_attr_changed?`，因为该值与 db 默认值匹配，这反过来会触发您的 ruby​​ 定义的默认代码并将该值设置为“其他字符串”——同样，这不是您想要的。

 *** * *

由于这些原因，我认为仅使用 after_initialize 钩子无法正确完成此操作。

同样，我认为“default_value_for”gem 采用了正确的方法：[https ://github.com/FooBarWidget/default_value_for](https://github.com/FooBarWidget/default_value_for)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-07-21T12:57:32.653

尽管在大多数情况下设置默认值会让人感到困惑和尴尬，但您也可以使用`:default_scope`。在这里查看[squil 的评论](http://apidock.com/rails/ActiveRecord/Base/default_scope/class)。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-03-30T21:24:23.197

我发现使用验证方法可以很好地控制设置默认值。您甚至可以为更新设置默认值（或验证失败）。如果您真的想要，您甚至可以为插入和更新设置不同的默认值。请注意，在 #valid? 之前不会设置默认值？叫做。

```
class MyModel
  validate :init_defaults

  private
  def init_defaults
    if new_record?
      self.some_int ||= 1
    elsif some_int.nil?
      errors.add(:some_int, "can't be blank on update")
    end
  end
end 
```

关于定义 after_initialize 方法，可能存在性能问题，因为 after_initialize 也被 :find 返回的每个对象调用： [http ://guides.rubyonrails.org/active_record_validations_callbacks.html#after_initialize-and-after_find](http://guides.rubyonrails.org/active_record_validations_callbacks.html#after_initialize-and-after_find)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-11-11T22:30:44.057

如果该列恰好是“状态”类型的列，并且您的模型适合使用状态机，请考虑使用[aasm gem](https://github.com/aasm/aasm)，之后您可以简单地执行

```
 aasm column: "status" do
    state :available, initial: true
    state :used
    # transitions
  end 
```

它仍然不会初始化未保存记录的值，但它比滚动你自己的`init`或其他任何东西要干净一些，并且你可以获得 aasm 的其他好处，例如所有状态的范围。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-03-24T12:39:31.780

[https://github.com/keithrowell/rails_default_value](https://github.com/keithrowell/rails_default_value)

```
class Task < ActiveRecord::Base
  default :status => 'active'
end 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-02-08T15:47:26.750

这是我使用的一个解决方案，我有点惊讶尚未添加。

它有两个部分。第一部分是在实际迁移中设置默认值，第二部分是在模型中添加验证以确保存在为真。

```
add_column :teams, :new_team_signature, :string, default: 'Welcome to the Team' 
```

所以你会看到这里已经设置了默认值。现在在验证中，您要确保字符串始终有一个值，所以只需执行

```
 validates :new_team_signature, presence: true 
```

这将为您设置默认值。（对我来说，我有“欢迎加入团队”），然后它会更进一步，确保该对象始终存在一个值。

希望有帮助！

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-12-15T19:29:55.930

```
# db/schema.rb
create_table :store_listings, force: true do |t|
  t.string :my_string, default: "original default"
end

StoreListing.new.my_string # => "original default"

# app/models/store_listing.rb
class StoreListing < ActiveRecord::Base
  attribute :my_string, :string, default: "new default"
end

StoreListing.new.my_string # => "new default"

class Product < ActiveRecord::Base
  attribute :my_default_proc, :datetime, default: -> { Time.now }
end

Product.new.my_default_proc # => 2015-05-30 11:04:48 -0600
sleep 1
Product.new.my_default_proc # => 2015-05-30 11:04:49 -0600 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-06-23T15:12:32.880

在开发 Rails 6 应用程序时，我遇到了类似的挑战。

**这是我解决它的方法**：

我有一张`Users`桌子和一张`Roles`桌子。表`Users`属于`Roles`表。我还有一个从表继承的`Admin`和`Student`模型。`Users`

然后，它要求我在创建用户时为角色设置一个默认值，比如`admin`具有 id = 的角色`1`或具有 id =`student`的角色`2`。

```
class User::Admin < User
  before_save :default_values

  def default_values
    # set role_id to '1' except if role_id is not empty
    return self.role_id = '1' unless role_id.nil?
  end
end 
```

这意味着`admin`在数据库中创建/保存用户之前，如果它不为空，则将其`role_id`设置为默认值。`1`

```
return self.role_id = '1' unless role_id.nil? 
```

是相同的：

```
return self.role_id = '1' unless self.role_id.nil? 
```

和一样：

```
self.role_id = '1' if role_id.nil? 
```

但第一个更干净，更精确。

就这样。

**我希望这有帮助**

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-10-22T22:26:17.353

使用这个有一段时间了。

```
# post.rb
class Post < ApplicationRecord
  attribute :country, :string, default: 'ID'
end 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-09-13T13:07:10.653

## 导轨 6.1+

您现在可以在模型上使用[属性](https://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute)方法而无需设置类型。

```
attribute :status, default: ACTIVE 
```

或者

```
class Account < ApplicationRecord
  attribute :locale, default: 'en'
end 
```

请注意，提供默认值`attribute`不能引用类的实例（lambda 将在类的上下文中执行，而不是实例）。因此，如果您需要根据实例或关联动态地将默认值设置为一个值，您仍然必须使用替代方法，例如`after_initialize`回调。如前所述，如果您引用关联，建议仅将其限制为新记录以避免 n+1 查询。

```
after_initialize :do_something_that_references_instance_or_associations, if: :new_record? 
```

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2011-02-03T21:50:12.790

在 Rails 3 中使用 default_scope

[api文档](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#method-c-default_scope)

ActiveRecord 掩盖了在数据库中定义的默认设置（模式）和在应用程序中完成的默认设置（模型）之间的区别。在初始化期间，它解析数据库模式并记录那里指定的任何默认值。稍后，在创建对象时，它会分配那些模式指定的默认值，而不涉及数据库。

[讨论](https://stackoverflow.com/questions/3975161/rails3-default-scope-and-default-column-value-in-migration)

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2012-05-31T18:43:21.200

从 api 文档[http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html](http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html)在您的模型中 使用该`before_validation`方法，它为您提供了为创建和更新调用创建特定初始化的选项，例如在本示例中（再次使用代码来自 api docs 示例）为信用卡初始化 number 字段。您可以轻松调整它以设置您想要的任何值

```
class CreditCard < ActiveRecord::Base
  # Strip everything but digits, so the user can specify "555 234 34" or
  # "5552-3434" or both will mean "55523434"
  before_validation(:on => :create) do
    self.number = number.gsub(%r[^0-9]/, "") if attribute_present?("number")
  end
end

class Subscription < ActiveRecord::Base
  before_create :record_signup

  private
    def record_signup
      self.signed_up_on = Date.today
    end
end

class Firm < ActiveRecord::Base
  # Destroys the associated clients and people when the firm is destroyed
  before_destroy { |record| Person.destroy_all "firm_id = #{record.id}"   }
  before_destroy { |record| Client.destroy_all "client_of = #{record.id}" }
end 
```

很惊讶他没有在这里被推荐

# asp.net - Azure 和 Microsoft ASP.NET MVC

> ID：328532
> 
> 赞同：17
> 
> 时间：2008-11-30T06:34:24.830
> 
> 标签：asp.net, asp.net-mvc, azure

我刚刚得到了我的天蓝色邀请码......耶！

windows azure + MS asp.net MVC有官方示例吗？

我仍然没有得到 Azure 附带的存储提供程序和服务，这有点令人困惑。我认为MS没有很好地解释它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-30T08:13:01.790

您可以在 Jim Nakashima 的博客中找到更多详细信息：[ASP.Net MVC Projects running on Windows Azure](http://blogs.msdn.com/jnak/archive/2008/10/28/asp-net-mvc-projects-running-on-windows-azure.aspx) and [ASP.Net MVC on Windows Azure with Providers](http://blogs.msdn.com/jnak/archive/2008/11/10/asp-net-mvc-on-windows-azure-with-providers.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-30T07:27:37.140

刚刚通过 Phil Haack 的博客找到[了这篇教程文章。](http://blogs.msdn.com/jnak/archive/2008/11/10/asp-net-mvc-on-windows-azure-with-providers.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-19T20:40:01.060

Azure 中 MVC 的示例/演练是位于[http://code.msdn.microsoft.com/mytodo](http://code.msdn.microsoft.com/mytodo) 的 myTodo 请注意，当“Windows Azure Tools for for使用 Microsoft Visual Studio 1.1（2010 年 2 月）和更高版本。carlosfemmer.com/?tag=/azure 中描述了重构

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-22T19:31:28.517

[这是另一个使用ASP.NET MVC 和 Window Azure](http://www.azurebright.com)的博客和论坛的完整示例

# regex - How can I make this Perl one-liner to toggle character in line in a file?

> ID：328547
> 
> 赞同：0
> 
> 时间：2008-11-30T06:48:57.810
> 
> 标签：regex, perl

I am attempting to write a one-line Perl script that will toggle a line in a configuration file from "commented" to not and back. I have the following so far:

```
perl -pi -e 's/^(#?)(\tDefaultServerLayout)/ ... /e' xorg.conf 
```

I am trying to figure out what code to put in the replacement (...) section. I would like the replacement to insert a '#' if one was not matched on, and remove it if it was matched on.

pseudo code:

```
if ( $1 == '#' ) then
   print $2
else
   print "#$2" 
```

My Perl is very rusty, and I don't know how to fit that into a `s///e` replacement.

My reason for this is to create a single script that will change (toggle) my display settings between two layouts. I would prefer to have this done in only one script.

I am open to suggestions for alternate methods, but I would like to keep this a one-liner that I can just include in a shell script that is doing other things I want to happen when I change layouts.

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-30T07:09:54.773

```
perl -pi -e 's/^(#?)(?=\tDefaultServerLayout)/ ! $1 && "#" /e' foo 
```

Note the addition of ?= to simplify the replacement string by using a [look-ahead assertion](http://perldoc.perl.org/perlre.html#%27(?=pattern)%27).

Some might prefer s/.../ $1 ? "" : "#" /e.

# asp.net - ASP.NET 上传图片后刷新页面

> ID：328549
> 
> 赞同：0
> 
> 时间：2008-11-30T06:49:28.510
> 
> 标签：asp.net, caching, uploading

我有一个 ASPX 页面，我在其中将图像上传到服务器以用于服务器端按钮单击事件。在我的页面中，它将显示可用的图像（如果存在）。当我上传一张图片时，它会用新的图片替换旧的。现在上传后也显示相同的图像。如何解决这个问题？我使用 window.location.reload() javascript 函数来刷新，但它不工作。它再次发布页面。

这是我的代码

```
 Do UploadImage(studentId,mode);  // Function to upload image
    StringBuilder sbc = new StringBuilder();

    sbc.Append("<script language='javascript'>");
    sbc.Append("alert('Upload process completed successfully!');");
    sbc.Append("window.location.reload()");
    sbc.Append("</script>");
    HttpContext.Current.Response.Write(sbc); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T06:59:29.160

您的浏览器可能正在缓存图像。禁用图像缓存或设置正确的缓存响应。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T09:43:31.920

它被缓存在浏览器中。为了克服这个问题 - 改变图像的 url。这可以通过在图像文件名中包含时间戳、版本号或 guid 来完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T07:02:45.473

您可以从服务器端重新加载

```
Response.Redirect(Request.URL) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T09:57:52.063

A useful tool to debug this is [fiddler](http://www.fiddlertool.com/fiddler/). As others already suggested it's likely that the browser caches the old version of the image. If you are using IIS you can change the cache policy so that the browser always check for a newer version of the image.

# c# - 用 .NET 编写的 OSS Twitter 克隆

> ID：328551
> 
> 赞同：3
> 
> 时间：2008-11-30T06:51:19.910
> 
> 标签：c#, .net, twitter

有谁知道用 .NET（或理想情况下是 C#）编写的 twitter 克隆？

我想尝试一些朋友和同事之间的私人推特网络。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T06:05:01.470

[http://www.yonkly.com/](http://www.yonkly.com/)。用 Asp.net mvc 完成

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T08:20:03.883

你看过[威蒂](http://code.google.com/p/wittytwitter/)吗？它是一个符合您标准的 Twitter 客户端，但我不知道有任何服务器软件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T08:31:30.037

我知道[TeleTwitter](http://code.google.com/p/teletwitter/)。尽管它的发展停滞不前，但它可以满足我的一切需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T09:15:08.873

我认为 C# 中没有任何 Twitter 实现。如果您正在寻找 C# twitter 客户端，那么 Witty 是您的最佳选择（目前..我正在开发一个基于 Witty 库的新客户端）

[http://code.google.com/p/wittytwitter/](http://code.google.com/p/wittytwitter/)

# asp.net - 作为单元测试设置的一部分启动 ASP.NET 开发 Web 服务器 (Cassini)？

> ID：328566
> 
> 赞同：3
> 
> 时间：2008-11-30T06:59:34.450
> 
> 标签：asp.net, unit-testing, nunit, watin

我正在使用 WatiN、NUnit 和 ReSharper 在 Visual Studio 中运行我的 ASP.NET 单元测试。我想（如果它还没有运行）启动 Cassini 来运行我的测试。

这可能吗？我该怎么做？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-01-04T00:50:04.467

如果您有兴趣，我刚刚发布了 CassiniDev 3.5.1/4.0.1 测试版，其中包含一个简单的测试夹具示例。

Cassini for Developers and Testers: [http://cassinidev.codeplex.com](http://cassinidev.codeplex.com)

Mo betta, word.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T07:55:21.763

这是一些代码：

```
private static void GetDevelopmentServerVPathAndPortFromProjectFile(
    string csprojFileName,
    out string developmentServerVPath,
    out int developmentServerPort)
{
    XPathDocument doc = new XPathDocument(csprojFileName);
    XPathNavigator navigator = doc.CreateNavigator();

    XmlNamespaceManager manager = new XmlNamespaceManager(navigator.NameTable);
    manager.AddNamespace("msbuild",
        "http://schemas.microsoft.com/developer/msbuild/2003");

    const string xpath = "/msbuild:Project/msbuild:ProjectExtensions/"
                       + "msbuild:VisualStudio/msbuild:FlavorProperties/"
                       + "msbuild:WebProjectProperties";

    XPathNavigator webProjectPropertiesNode =
        navigator.SelectSingleNode(xpath, manager);
    XPathNavigator developmentServerPortNode =
        webProjectPropertiesNode.SelectSingleNode("msbuild:DevelopmentServerPort",
            manager);
    XPathNavigator developmentServerVPathNode =
        webProjectPropertiesNode.SelectSingleNode("msbuild:DevelopmentServerVPath",
            manager);

    developmentServerPort = developmentServerPortNode.ValueAsInt;
    developmentServerVPath = developmentServerVPathNode.Value;
}

private static string GetCommonProgramFilesPath()
{
    string commonProgramFiles =
        Environment.GetEnvironmentVariable("CommonProgramFiles(x86)");
    if (string.IsNullOrEmpty(commonProgramFiles))
    {
        commonProgramFiles =
            Environment.GetEnvironmentVariable("CommonProgramFiles");
    }
    if (string.IsNullOrEmpty(commonProgramFiles))
    {
        commonProgramFiles =
            Environment.GetFolderPath(Environment.SpecialFolder.CommonProgramFiles);
    }
    return commonProgramFiles;
}

private static Process PrepareCassiniProcess(int developmentServerPort,
                                             string projectPhysicalPath,
                                             string developmentServerVPath)
{
    string commonProgramFiles = GetCommonProgramFilesPath();
    string cassiniPath = Path.Combine(commonProgramFiles,
        @"Microsoft Shared\DevServer\9.0\WebDev.WebServer.exe");
    string cassiniArgs = string.Format(
        CultureInfo.InvariantCulture,
        "/port:{0} /nodirlist /path:\"{1}\" /vpath:\"{2}\"",
        developmentServerPort, projectPhysicalPath, developmentServerVPath);

    Process cassiniProcess = new Process();
    cassiniProcess.StartInfo.FileName = cassiniPath;
    cassiniProcess.StartInfo.Arguments = cassiniArgs;
    return cassiniProcess;
} 
```

要使用它，您需要发现被测 Web 项目的 CSPROJ 文件的路径。我将把它作为练习留给读者（我目前已经硬编码）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T07:04:08.373

Cassini 服务器是 WebDev.WebServer.EXE。有几个博客展示了如何手动启动它。这是一个：

[http://www.dotnetjunkies.com/WebLog/saravana/archive/2005/06/18/126143.aspx](http://www.dotnetjunkies.com/WebLog/saravana/archive/2005/06/18/126143.aspx)

# python - 使用共享包部署 python 应用程序

> ID：328568
> 
> 赞同：2
> 
> 时间：2008-11-30T07:02:14.880
> 
> 标签：python, naming, package, conventions, deploying

我正在考虑如何安排一个已部署的 python 应用程序，该应用程序将具有

1.  位于 /usr/bin/ 中的可执行脚本，它将为实现的功能提供 CLI
2.  安装到当前站点包目录所在位置的库。

现在，目前，我的源代码中有以下目录结构：

```
foo.py
foo/
  __init__.py
  ... 
```

我想这不是做事的最佳方式。在开发过程中，一切都按预期工作，但是在部署时，foo.py 中的“from foo import FooObject”代码似乎试图导入 foo.py 本身，这不是我正在寻找的行为。

所以问题是编排这种情况的标准做法是什么？我能想到的一件事是，在安装时，将 foo.py 重命名为 foo，这会阻止它自行导入，但这似乎很尴尬......

我想，问题的另一部分是命名挑战。也许调用可执行脚本 foo-bin.py？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-02T10:57:19.790

[这篇文章](http://jcalderone.livejournal.com/39794.html)很不错，向你展示了一个很好的方法。*Do*列表中的第二项回答了您的问题。

*无耻的复制粘贴：*

> # Python项目的文件系统结构
> 
> *通过[Jp Calderone](http://jcalderone.livejournal.com/profile)*
> 
> **做：**
> 
> *   将目录命名为与您的项目相关的名称。例如，如果您的项目名为“Twisted”，请将其源文件的顶级目录命名为`Twisted`。当你发布时，你应该包含一个版本号后缀：`Twisted-2.5`.
> *   创建一个目录`Twisted/bin`并将您的可执行文件放在那里，如果有的话。不要给它们`.py` 扩展名，即使它们是 Python 源文件。除了导入和调用项目中其他地方定义的主函数外，不要在其中放置任何代码。
> *   如果您的项目可以表示为单个 Python 源文件，则将其放入目录中，并将其命名为与您的项目相关的名称。例如，`Twisted/twisted.py`。如果您需要多个源文件，请改为创建一个包（`Twisted/twisted/`, 为空 `Twisted/twisted/__init__.py`）并将源文件放入其中。例如， `Twisted/twisted/internet.py`。
> *   put your unit tests in a sub-package of your package (note - this means that the single Python source file option above was a trick - you always need at least one other file for your unit tests). For example, `Twisted/twisted/test/`. Of course, make it a package with `Twisted/twisted/test/__init__.py`. Place tests in files like `Twisted/twisted/test/test_internet.py`.
> *   add `Twisted/README` and `Twisted/setup.py` to explain and install your software, respectively, if you're feeling nice.
> 
> **Don't:**
> 
> *   put your source in a directory called `src` or `lib`. This makes it hard to run without installing.
> *   put your tests outside of your Python package. This makes it hard to run the tests against an installed version.
> *   create a package that only has a `__init__.py` and then put all your code into `__init__.py`. Just make a module instead of a package, it's simpler.
> *   try to come up with magical hacks to make Python able to import your module or package without having the user add the directory containing it to their import path (either via `PYTHONPATH` or some other mechanism). You will not correctly handle all cases and users will get angry at you when your software doesn't work in their environment.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T07:30:01.470

[Distutils](http://www.python.org/doc/2.5.2/dist/dist.html)支持安装模块、包和脚本。如果您创建一个作为包和脚本`setup.py`引用的 distutils ，那么应该安装到目标操作系统上的适当脚本安装路径或任何适当的脚本安装路径，并且包应该安装到目录中。`foo``foo.py``foo.py``/usr/local/bin``foo``site_packages`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T07:18:10.420

您应该调用可执行文件 just `foo`， not `foo.py`，然后尝试导入 foo 将不会使用它。

至于正确命名：这很难抽象地回答；我们需要知道它具体做了什么。例如，如果它配置和控制，调用它 -config 或 ctl 可能是合适的。如果它是库的外壳 API，它应该与库具有相同的名称。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T12:47:16.323

你的 CLI 模块是一回事，支持它的包是另一回事。不要将名称与模块`foo`（在文件中`foo.py`）和包`foo`（在`foo`带有文件的目录中）混淆`__init__.py`。

你有两个东西叫做`foo`：一个模块和一个包。你还想叫什么名字`foo`？一类？一个函数？一个变量？

为 foo 模块或 foo 包选择一个独特的名称。 `foolib`，例如，是一个流行的包名称。

# c++ - 面向 C++ 开发人员的 Python

> ID：328577
> 
> 赞同：56
> 
> 时间：2008-11-30T07:14:02.690
> 
> 标签：c++, python

我是一名长期尝试进入 Python 的 C++/Java 开发人员，我正在寻找陈规定型的“C++ 开发人员的 Python”文章，但一无所获。我已经在 C#、Java 等方面看到过这类东西，它们对于加快语言特性和值得注意的差异非常有用。任何人有任何参考？

作为第二个额外的问题，您建议使用哪个开源 Python 程序来进行简洁的设计、评论和使用该语言作为学习的参考点？

提前致谢。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-30T07:28:30.163

我从来没有真正理解过“针对语言 Y 开发人员的语言 X”的方法。当我去学习语言 XI 时，我想学习如何像语言 X 程序员那样编程，而不是像语言 Y 程序员那样。我想学习我正在学习的语言所特有的特征、习语等。我希望能够利用使语言变得特别的东西，并利用这些知识来扩展我的思维方式和解决问题的方式。我认为我不会从以另一种语言为框架的教程中获得同样的见解。如果你可以在没有针对你已经知道的东西的教程的情况下学习你的第一语言，你应该能够以同样的方式学习第二语言（根据我的经验，

话虽如此，我会推荐[Python 教程](http://docs.python.org/tutorial/)作为开始使用 Python 的一种良好、快速且简单的方法，并将[Dive Into Python](https://rads.stackoverflow.com/amzn/click/com/1590593561)作为更完整的介绍，也可在[此处](http://www.diveintopython.net/)免费获得。我也同意其他人所说的将标准库的代码视为良好示例和设计实践的来源，标准 python 库非常干净且易于阅读。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-30T08:24:50.347

[Dive Into Python](http://diveintopython.net/)是一本面向经验丰富的程序员的 Python 书籍。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-08T16:05:48.117

[Dive Into Python](http://www.diveintopython.org/)很棒，但不要忘记 PJE 的[Python Is Not Java](http://dirtsimple.org/2004/12/python-is-not-java.html)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-30T07:36:50.227

通过阅读 Python 附带的标准库的源代码，我学到了很多关于 Python 的知识。我似乎记得有几个“啊哈！” 特别是阅读的时刻`urllib2.py`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T16:36:59.870

要学习该语言，免费的在线[Python 教程](http://docs.python.org/tutorial/)实际上是您学习该语言并开始编写应用程序所需的全部内容。如果你想要一本书，我发现从 Apress[开始 Python](https://rads.stackoverflow.com/amzn/click/com/1590599829)是一个很好的参考和教程。当然，学习一门语言的最佳方式是编写代码，因此我建议您查看[Boost.Python](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/index.html)。如果您的 C++ 需要更灵活一点，Boost.Python 可以为您提供学习 Python 并获得报酬的好借口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T07:39:15.463

Python 与 C++ 有很大的不同，因此通常无法转移特定的知识。有一些可用的[语言](http://www.dmh2000.com/cjpr/) [比较](http://page.mi.fu-berlin.de/~prechelt/Biblio/jccpprt_computer2000.pdf)。您可以继承的是特定 API 的知识，例如 POSIX 或套接字 API。

作为典型 Python (GUI) 应用程序的示例，请查看 IDLE（为 Python 提供的）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-30T10:03:33.830

在许多应用领域，C# 和 Java 被视为 C++ 的更清洁的替代品，因此经常会从一个“迁移”到另一个——这就是为什么有书籍可用的原因。

Python 和 C++ 是非常不同的野兽，尽管它们都被认为是通用编程语言，但它们的目标是编程范围的不同端。

不要尝试用 Python 编写 C++；事实上，在编写 Python 时尽量忘记 C++。我发现学习常见的 Python 范例和技术并将它们应用到我的 C++ 程序中要比其他方式好得多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T07:36:42.550

对于一种语言的代码的最佳示例，该语言的标准库通常是一个很好的地方。不过，请选择最近的一篇文章 - 旧部分可能是为旧版本编写的，有时也是在库变得足够大以保证大标准之前编写的 - 例如 PHP 和 Erlang 的库，它们具有内部不一致。

特别是对于 Python，Python 3000 正在大量清理库，因此可能是优秀 Python 代码的重要来源（尽管它是为未来的 Python 版本编写的）。

# themes - Plesk 更名虚拟主机

> ID：328588
> 
> 赞同：0
> 
> 时间：2008-11-30T07:28:54.093
> 
> 标签：themes, plesk

我最近购买了新的 Plesk 软件，我不确定如何将网站重新命名为我们公司的徽标和主题。

有谁知道更改这些设置的步骤或可以回答我的问题的手册？

问候，奥利弗·詹姆斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T09:08:13.443

嗯，这真的取决于你想做多少工作。您只需更改徽标（这很简单），就可以完全重新设置界面以匹配您公司的品牌。阻力最小的路径是复制现有皮肤并对其进行修改以满足您的需求。

无论哪种方式，从管理界面开始并转到服务器配置页面。您应该感兴趣的两个选项在那里：徽标设置和界面管理。更改徽标非常明显，所以我将坚持界面管理部分。

进入界面管理部分后，单击皮肤选项卡。您应该在这里做的第一件事是找到与您希望成品外观最相似的皮肤。你会注意到皮肤列表上有一个软盘图标；单击此图标将允许您下载包含皮肤所有文件的 .zip 或 .tar.gz 文件。

现在您只需要根据需要更改皮肤。我建议设置一个开发服务器（或虚拟化服务器），您可以在其中使用 Plesk 而不会对您的生产服务器造成任何损坏。而且，当然，最佳实践要求您可能应该将其全部置于源代码控制之下，以确保不会出错。

无论如何，一旦您进行了更改并对结果感到满意，请返回界面管理部分的皮肤页面，然后单击添加新皮肤按钮。压缩你的皮肤（以匹配下载基础皮肤时的压缩方式）并上传文件。上传后，您可以从“皮肤”页面中选择皮肤。为了安全起见，我建议在将任何现有用户切换到新皮肤之前，创建一个虚拟客户端用户并在生产环境中测试皮肤，以防皮肤出现问题。

一旦您对新修改的皮肤在生产站点上的工作感到满意，请继续切换所有现有用户。

# php - 在 php 中解码引用的可打印消息

> ID：328590
> 
> 赞同：1
> 
> 时间：2008-11-30T07:31:27.240
> 
> 标签：php, encoding, quoted-printable

[我有在quoted-printable](http://en.wikipedia.org/wiki/Quoted_printable)中编码的字符串。如何在 php 中解码？

```
Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Vestibulum felis =
pede, vestibulum et, ullamcorper in, ultrices eget, metus. Suspendisse in n=
ulla. Sed justo. Donec dapibus auctor neque. Pellentesque faucibus ante nec=
 metus. Vivamus feugiat, velit rhoncus semper suscipit, libero augue venena=
tis leo, nec ornare nulla elit eget diam. Nullam sollicitudin. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T07:34:44.613

这应该有帮助：[quoted_printable_decode](http://us2.php.net/quoted_printable_decode)

# c# - 如果不支持包含，您如何在 LINQ to Entities（实体框架）中执行 SQL 样式的“IN”语句？

> ID：328600
> 
> 赞同：13
> 
> 时间：2008-11-30T07:36:57.370
> 
> 标签：c#, linq, entity-framework, linq-to-entities

我正在使用 LINQ to Entities（不是 LINQ to SQL），但在创建“IN”样式查询时遇到了麻烦。这是我目前的查询：

```
var items = db.InventoryItem
                .Include("Kind")
                .Include("PropertyValues")
                .Include("PropertyValues.KindProperty")
                .Where(itm => valueIds.Contains(itm.ID)).ToList<InventoryItem>(); 
```

但是，当我这样做时，会引发以下异常：

> LINQ to Entities 无法识别“Boolean Contains(Int64)”方法，并且该方法无法转换为存储表达式。

有没有人对此有解决方法或其他解决方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T09:42:15.900

您需要使用这个：

```
.Where(string.Format("it.ID in {0}", string.Join(",", valueIds.ToArray()))); 
```

或动态构建 WHERE 部分，如[本文](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3917617&SiteID=1)所述。

## PS - 信息已更新，此答案更新如下以保持相关性：

引用的链接包含以下更新：

> *...在 EF4 中，我们添加了对* *Contains 方法的支持，至少在这种* *特定情况下对集合值* *参数进行了支持。因此，这种* *代码现在可以直接* *使用，不需要使用任何* *附加的表达式构建方法：*

```
var statusesToFind = new List<int> {1, 2, 3, 4};
var foos = from foo in myEntities.Foos
           where statusesToFind.Contains(foo.Status)
           select foo; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-12-13T18:16:00.763

在某些情况下，您可以使用 Linq 的`Any`扩展方法：

```
var userIds = new[] { 1, 2, 3 };

from u in Users
     where userIds.Any(i => i==u.Id)
     select u; 
```

在这种情况下，生成的 SQL 看起来很奇怪，但就像许多 Linq-to-Entities 生成的 SQL 一样，它对人类来说可能过于冗长，但在实践中运行得很快。

```
SELECT 
[Extent1].[Id] AS [Id], 
[Extent1].[DisplayName] AS [DisplayName], 
FROM [dbo].[Users] AS [Extent1]
WHERE  EXISTS (SELECT 
    1 AS [C1]
    FROM  (SELECT 
        [UnionAll1].[C1] AS [C1]
        FROM  (SELECT 
            1 AS [C1]
            FROM  ( SELECT 1 AS X ) AS [SingleRowTable1]
        UNION ALL
            SELECT 
            2 AS [C1]
            FROM  ( SELECT 1 AS X ) AS [SingleRowTable2]) AS [UnionAll1]
    UNION ALL
        SELECT 
        3 AS [C1]
        FROM  ( SELECT 1 AS X ) AS [SingleRowTable3]) AS [UnionAll2]
    WHERE [UnionAll2].[C1] = [Extent1].[Id]
) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-15T00:03:36.547

正如 Diego B Vega 在[这篇文章](http://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/thread/095745fe-dcf0-4142-b684-b7e4a1ab59f0/)中提到的（第二个答案），`Contains`现在应该在 EF4 中工作。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2010-02-03T08:58:46.203

我的解决方法是将实体结果转换为列表，**然后**应用 Contains()。

例子：

```
var items = db.InventoryItem
                .Include("Kind")
                .Include("PropertyValues")
                .Include("PropertyValues.KindProperty")
                .ToList()
                .Where(itm => valueIds.Contains(itm.ID)); 
```

# c# - 浮点不准确性的确定性如何？

> ID：328622
> 
> 赞同：29
> 
> 时间：2008-11-30T08:11:54.757
> 
> 标签：c#, silverlight, math, floating-point

我知道浮点计算存在准确性问题，并且有很多问题可以解释原因。我的问题是，如果我两次运行相同的计算，我是否可以始终依靠它来产生相同的结果？哪些因素可能会影响这一点？

*   计算之间的时间？
*   CPU的当前状态？
*   不同的硬件？
*   语言/平台/操作系统？
*   太阳耀斑？

我有一个简单的物理模拟，并想记录会话，以便可以重播。如果可以依赖计算，那么我应该只需要记录初始状态以及任何用户输入，并且我应该总是能够准确地重现最终状态。如果计算不准确，开始时的错误可能会在模拟结束时产生巨大影响。

我目前在 Silverlight 工作，但很想知道这个问题是否可以得到普遍回答。

**更新：** 最初的答案表明是的，但显然这并不完全明确，正如所选答案的评论中所讨论的那样。看来我将不得不做一些测试，看看会发生什么。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-30T08:51:32.353

据我了解，只要您处理相同的指令集和编译器，并且您运行的任何处理器都严格遵守相关标准（即 IEEE754），您就可以保证获得相同的结果。也就是说，除非您正在处理一个特别混乱的系统，否则运行之间的任何计算偏差都不太可能导致错误行为。

我知道的具体问题：

1.  某些操作系统允许您以破坏兼容性的方式设置浮点处理器的模式。

2.  浮点中间结果通常在寄存器中使用 80 位精度，但在内存中仅使用 64 位。如果以更改函数内的寄存器溢出的方式重新编译程序，则与其他版本相比，它可能会返回不同的结果。大多数平台都会为您提供一种强制将所有结果截断为内存精度的方法。

3.  标准库函数可能会因版本而异。我收集到在 gcc 3 vs 4 中有一些不常见的例子。

4.  IEEE 本身允许一些二进制表示不同......特别是 NaN 值，但我不记得细节了。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-30T08:33:04.713

简短的回答是，根据[IEEE 浮点标准](http://en.wikipedia.org/wiki/IEEE_754)，FP 计算是完全确定的，但这并不意味着它们在机器、编译器、操作系统等之间完全可重现。

这些问题的详细答案以及更多问题可以在可能是关于浮点的最佳参考资料中找到，David Goldberg 的[What Every Computer Scientist Should Know About Floating Point Arithmetic](http://docs.sun.com/source/806-3568/ncg_goldberg.html)。跳至 IEEE 标准部分了解关键细节。

简要回答您的要点：

*   计算之间的时间和 CPU 的状态与此无关。

*   硬件会影响事物（例如，某些 GPU 不符合 IEEE 浮点）。

*   语言、平台和操作系统也会影响事物。有关此问题的更好描述，请参阅 Jason Watkins 的回答。如果您使用的是 Java，请查看 Kahan[关于 Java 的浮点数不足的咆哮](http://www.cs.berkeley.edu/~wkahan/JAVAhurt.pdf)。

*   太阳耀斑可能很重要，希望不经常发生。我不会太担心，因为如果它们确实很重要，那么其他一切都会搞砸。我会将其与担心[EMP 归](http://en.wikipedia.org/wiki/Effects_of_nuclear_explosions#Electromagnetic_pulse)为一类。

最后，如果您在相同的初始输入上执行相同的浮点计算*序列*，那么事情应该完全可以重播。确切的顺序可能会根据您的编译器/操作系统/标准库而改变，因此您可能会遇到一些小错误。

通常在浮点中遇到问题的地方是，如果您有一个数值不稳定的方法，并且您从 FP 输入开始，这些输入*大致*相同但不完全相同。如果您的方法稳定，您应该能够在一定的公差范围内保证重现性。如果您想了解更多细节，请查看上面链接的 Goldberg 的 FP 文章或获取有关数值分析的介绍性文本。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-30T08:38:49.493

我认为您的困惑在于浮点周围的不准确性类型。大多数语言都实现了[IEEE 浮点标准](http://en.wikipedia.org/wiki/IEEE_floating-point_standard)该标准阐述了如何使用浮点/双精度中的各个位来生成数字。通常一个浮点数由一个四个字节和一个双八字节组成。

两个浮点数之间的数学运算每次都将具有相同的值（如标准中指定的那样）。

不准确来自精确。考虑一个 int 与一个 float。两者通常占用相同数量的字节 (4)。然而，每个数字可以存储的最大值却大相径庭。

*   int：大约 20 亿
*   浮动：3.40282347E38（有点大）

区别在中间。int，可以表示 0 到大约 20 亿之间的每个数字。浮动但是不能。它可以表示 0 到 3.40282347E38 之间的 20 亿个值。但这留下了一系列无法​​表示的值。如果数学方程达到这些值之一，则必须将其四舍五入为可表示的值，因此被认为是“不准确的”。您对不准确的定义可能会有所不同:)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-30T09:01:17.170

此外，虽然[Goldberg](http://docs.sun.com/source/806-3568/ncg_goldberg.html#3098)是一个很好的参考资料，但原文也是错误的：**IEEE754 并不保证可移植**。鉴于此陈述基于略读文本的频率，我无法强调这一点。该文档的更高版本包括[专门讨论此问题的部分](http://docs.sun.com/source/806-3568/ncg_goldberg.html#3098)：

> 许多程序员可能没有意识到，即使是仅使用 IEEE 标准规定的数字格式和操作的程序也可以在不同的系统上计算出不同的结果。事实上，该标准的作者打算允许不同的实现获得不同的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T09:12:07.973

对不起，但我不禁认为每个人都没有抓住重点。

如果不准确性对您正在做的事情很重要，那么您应该寻找不同的算法。

你说如果计算不准确，那么一开始的错误可能会在模拟结束时产生巨大的影响。

我的朋友不是模拟的。如果由于舍入和精度导致的微小差异，您得到的结果大不相同，那么很可能没有任何结果具有任何有效性。仅仅因为您可以重复结果并不能使其更有效。

在包括测量或非整数计算在内的任何重要的现实世界问题上，引入小错误以测试算法的稳定性始终是一个好主意。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-17T16:46:39.180

C++ FAQ 中的这个答案可能描述得最好：

[http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.18](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.18)

不仅不同的体系结构或编译器可能会给您带来麻烦，浮点数在同一个程序中的行为也已经很奇怪了。正如常见问题解答指出的那样，如果`y == x`是真的，那仍然可能意味着这`cos(y) == cos(x)`将是错误的。这是因为 x86 CPU 使用 80 位计算值，而该值以 64 位存储在内存中，因此您最终将截断的 64 位值与完整的 80 位值进行比较。

计算仍然是确定性的，因为每次运行相同的编译二进制文件都会给您相同的结果，但是当您稍微调整源代码时，优化标志或使用不同的编译器编译它所有的赌注都没有了可以发生。

实际上，我并没有那么糟糕，我可以在 32 位 Linux 上使用不同版本的 GCC 逐位重现简单的浮点指向数学，但是当我切换到 64 位 Linux 时，结果不再相同。在 32 位上创建的演示录音不能在 64 位上运行，反之亦然，但在同一架构上运行时可以正常工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-19T06:57:21.750

由于您的问题被标记为 C#，因此值得强调 .NET 上面临的问题：

1.  浮点数学不是关联的——也就是说，`(a + b) + c`不能保证等于`a + (b + c)`；
2.  不同的编译器将以不同的方式优化您的代码，这可能涉及重新排序算术运算。
3.  在 .NET 中，CLR 的 JIT 编译器将即时编译您的代码，因此编译取决于运行时机器上的 .NET 版本。

这意味着，您不应依赖 .NET 应用程序在不同版本的 .NET CLR 上运行时产生相同的浮点计算结果。

例如，在您的情况下，如果您记录模拟的初始状态和输入，然后安装更新 CLR 的服务包，您的模拟可能不会在您下次运行时重放相同。

请参阅 Shawn Hargreaves 的博客文章[浮点数学是确定性的吗？](http://blogs.msdn.com/b/shawnhar/archive/2009/03/25/is-floating-point-math-deterministic.aspx)有关 .NET 的进一步讨论。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-30T13:41:51.563

嗯。由于 OP 要求使用 C#：

C# 字节码 JIT 是确定性的，还是在不同的运行之间生成不同的代码？我不知道，但我不会相信Jit。

我可以想到 JIT 具有一些服务质量特性并决定在优化上花费更少时间的场景，因为 CPU 在其他地方进行大量的数字运算（想想背景 DVD 编码）？这可能会导致细微的差异，并可能在以后导致巨大的差异。

此外，如果 JIT 本身得到改进（可能作为服务包的一部分），生成的代码肯定会发生变化。80 位内部精度问题已经被提及。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-03-04T00:27:31.140

这不是您问题的完整答案，但这里有一个示例证明 C# 中的双重计算是不确定的。我不知道为什么，但看似无关的代码显然会影响下游双重计算的结果。

1.  在 Visual Studio 版本 12.0.40629.00 Update 5 中创建一个新的 WPF 应用程序，并接受所有默认选项。
2.  将 MainWindow.xaml.cs 的内容替换为：

    ```
    using System;
    using System.Windows;

    namespace WpfApplication1
    {
        /// <summary>
        /// Interaction logic for MainWindow.xaml
        /// </summary>
        public partial class MainWindow : Window
        {
            public MainWindow()
            {
                InitializeComponent();
                Content = FooConverter.Convert(new Point(950, 500), new Point(850, 500));
            }
        }

        public static class FooConverter
        {
            public static string Convert(Point curIPJos, Point oppIJPos)
            {
                var ij = " Insulated Joint";
                var deltaX = oppIJPos.X - curIPJos.X;
                var deltaY = oppIJPos.Y - curIPJos.Y;
                var teta = Math.Atan2(deltaY, deltaX);
                string result;
                if (-Math.PI / 4 <= teta && teta <= Math.PI / 4)
                    result = "Left" + ij;
                else if (Math.PI / 4 < teta && teta <= Math.PI * 3 / 4)
                    result = "Top" + ij;
                else if (Math.PI * 3 / 4 < teta && teta <= Math.PI || -Math.PI <= teta && teta <= -Math.PI * 3 / 4)
                    result = "Right" + ij;
                else
                    result = "Bottom" + ij;
                return result;
            }
        }
    } 
    ```

3.  将构建配置设置为“发布”并构建，但不要在 Visual Studio 中运行。

4.  双击构建的 exe 运行它。
5.  请注意，窗口显示“底部绝缘接头”。
6.  现在在“字符串结果”之前添加这一行：

    ```
    string debug = teta.ToString(); 
    ```

7.  重复步骤 3 和 4。

8.  请注意，窗口显示“Right Insulated Joint”。

这种行为在同事的机器上得到了证实。请注意，如果以下任何一项为真，则窗口始终显示“Right Insulated Joint”：exe 从 Visual Studio 中运行，exe 是使用 Debug 配置构建的，或者在项目属性中未选中“Prefer 32-bit”。

很难弄清楚发生了什么，因为任何观察过程的尝试似乎都会改变结果。

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-11-30T15:59:46.497

很少有 FPU 符合 IEEE 标准（尽管他们声称）。所以在不同的硬件上运行相同的程序确实会给你不同的结果。结果很可能出现在极端情况下，作为在软件中使用 FPU 的一部分，您应该避免这些情况。

IEEE 错误通常在软件中修补，您确定您今天运行的操作系统包含来自制造商的适当陷阱和补丁吗？在操作系统更新之前或之后呢？是否删除了所有错误并添加了错误修复？C 编译器是否与所有这些同步，C 编译器是否生成正确的代码？

对此进行测试可能是徒劳的。在您交付产品之前，您不会看到问题。

遵守 FP 规则 1：永远不要使用 if(something==something) 比较。IMO 的第二条规则与 ascii 到 fp 或 fp 到 ascii（printf、scanf 等）有关。那里有比硬件更多的准确性和错误问题。

随着每一代新硬件（密度）的出现，来自太阳的影响更加明显。我们已经在行星表面上遇到了 SEU 的问题，因此独立于浮点计算，您会遇到问题（很少有供应商会费心去关心，所以预计新硬件会更频繁地崩溃）。

通过消耗大量逻辑，fpu 可能会非常快（单个时钟周期）。不比整数 alu 慢。不要将此与现代 fpus 与 alus 一样简单混淆，fpus 很昂贵。（alus 同样消耗更多的乘法和除法逻辑以将其降低到一个时钟周期，但它几乎没有 fpu 大）。

遵守上面的简单规则，多研究浮点数，了解随之而来的缺陷和陷阱。您可能需要定期检查无穷大或 nans。您的问题更有可能出现在编译器和操作系统中而不是硬件中（通常不仅仅是 fp 数学）。如今，现代硬件（和软件）根据定义充满了错误，因此请尽量减少错误，而不是运行软件的错误。

# php - 需要一个正则表达式将 css 类添加到第一个和最后一个列表项

> ID：328623
> 
> 赞同：2
> 
> 时间：2008-11-30T08:11:54.990
> 
> 标签：php, html, css, regex

更新：谢谢大家的意见。一些额外的信息。

它实际上只是我正在使用的一小部分标记（20 行），并且旨在利用正则表达式来完成这项工作。

我也有能力破解脚本（电子商务脚本）以在构建导航时插入类。当我去更新到最新版本的软件时，我想限制我拥有的黑客数量，以使自己更轻松。

话虽如此，我非常了解我的情况以及我可以使用的各种选择。我的正则表达式的第一部分按预期工作。我实际上或多或少地发布了，看看是否有人会说，“嘿，笨蛋，这很容易改变这个......”

在我的一些努力接近之后，在这一点上更多的是原则。只知道（并学习）这个问题的解决方案。我也讨厌被一段代码打败。

原来的：

我正在尝试利用正则表达式将 CSS 类添加到有序列表中的第一个和最后一个列表项。我尝试了很多不同的方法，但无法产生我想要的结果。

我有第一个列表项的正则表达式，但似乎无法为最后一个找到正确的表达式。这是我正在使用的内容：

```
 $patterns = array('/<ul+([^<]*)<li/m', '/<([^<]*)(?<=<li)(.*)<\/ul>/s');
    $replace = array('<ul$1<li class="first"','<li class="last"$2$3</ul>');
    $navigation = preg_replace($patterns, $replace, $navigation); 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T08:17:59.953

[Jamie Zawinski](http://www.jwz.org/)对此有[话要说](http://fishbowl.pastiche.org/2003/08/18/beware_regular_expressions/)……

你有合适的 HTML 解析器吗？我不知道 PHP 是否有类似[hpricot](http://code.whytheluckystiff.net/hpricot/)的东西，但这是处理它的正确方法。您至少可以雇用 hpricot 为您进行第一次清理工作。

如果您实际上是在生成 HTML —— 在那儿进行。看起来您想生成一些导航并在`.first`上面放一些`.last`东西。退后一步尝试一下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T09:29:20.200

+1 生成正确的 html 作为最佳选择。

但是一种完全不同的方法，您可能接受也可能不接受：您可以使用 javascript。

这使用 jquery 使它变得容易......

```
$(document).ready(
    function() {
        $('#id-of-ul:firstChild').addClass('first');        
        $('#id-of-ul:lastChild').addClass('last');
    }

); 
```

正如我所说，在这种情况下可能有用也可能没有用，但我认为它在某些情况下是解决问题的有效方法。

PS：你说有序列表，然后在你的例子中给出 ul 。ol = 有序列表，ul = 无序列表

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T09:16:08.450

你写了：

> ```
> $patterns = array('/<ul+([^<]*)<li/m','/<([^<]*)(?<=<li)(.*)<\/ul>/s'); 
> ```

第一种模式：
`ul+`=> 你搜索类似 ullll
的东西... m 修饰符在这里没用，因为你不使用 ^ 也不使用 $。

第二种模式：
将 .* 与 s 一起使用是“危险的”，因为您可能会选择整个文档，直到页面的最后一个 /ul ......
好吧，我只需删除 s 修饰符并使用：`(<li\s)(.*?</li>\s*</ul>)`替换：`'$1class="last" $2'`

鉴于上述言论，我会写第一个表达式：`<ul.*?>\s*<li`

尽管我厌倦了每次出现正则表达式问题时都看到 Jamie Zawinski 的引用，但 Dustin 正确地将您指向 HTML 解析器（或者只是从一开始就生成正确的 HTML！）：正则表达式和 HTML 不能很好地混合，因为 HTML 语法很复杂，除非您对众所周知的机器生成的输出进行操作，并且结果非常可预测，否则在某些情况下您很容易出现问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T03:18:14.267

我不知道是否有人不再关心，但我有一个适用于我的简单测试用例的解决方案（我相信它应该适用于一般情况）。

首先，让我指出两点：虽然 PhiLho 的正确之处在于*s*是“危险的”，因为点可能会匹配到文档结尾的所有内容，这很可能是您想要的。它只会成为格式不正确的页面的问题。在大型手动编写的页面上小心使用任何此类正则表达式。

其次，php有反斜杠的特殊含义，即使是单引号。大多数正则表达式无论哪种方式都会表现良好，但您应该始终双重转义它们，以防万一。

现在，这是我的代码：

```
<?php
$navigation='<ul>
<li>Coffee</li>
<li>Tea</li>
<li>Milk</li>
<li>Beer</li>
<li>Water</li>
</ul>';

$patterns = array('/<ul.*?>\\s*<li/',
                  '/<li((.(?<!<li))*?<\\/ul>)/s');
$replace = array('$0 class="first"',
                 '<li class="last"$1');
$navigation = preg_replace($patterns, $replace, $navigation);
echo $navigation;
?>
```

这将输出

```
<ul>
<li class="first">Coffee</li>
<li>Tea</li>
<li>Milk</li>
<li>Beer</li>
<li class="last">Water</li>
</ul>
```

这假定开始 <ul...> 标记内没有换行符。如果有的话，也可以在第一个表达式上使用*s*修饰符。

魔术发生在`(.(?<!<li))*?`. 这将匹配不是字符串*<li*开头的任何字符（点），以非贪婪方式（？）重复任意次数（*）。

当然，如果列表项有可能已经设置了*类*属性，则必须扩展整个内容。此外，如果只有一个列表项，它将匹配两次，赋予它两个这样的属性。至少对于 xhtml，这会破坏验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T10:51:44.980

[您可以在SimpleXML](http://www.php.net/simplexml)对象中加载导航并使用它。这可以防止你用一些疯狂的正则表达式破坏你的标记:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-30T19:06:25.920

作为序言..在大多数用例中，这太复杂了。请参阅其他答案以获得更多理智:)

这是我为解决类似问题而编写的一个小 PHP 类。它添加了“第一个”、“最后一个”和您想要的任何其他类。它将处理没有“类”属性的 li 以及已经有一些类的那些。

```
<?php
/**
 * Modify list items in pre-rendered html.
 *
 * Usage Example:
 *  $replaced_text = ListAlter::addClasses($original_html, array('cool', 'awsome'));
 */
class ListAlter {
  private $classes = array();
  private $classes_found = FALSE;
  private $count = 0;
  private $total = 0;

  // No public instances.
  private function __construct() {}

  /**
   * Adds 'first', 'last', and any extra classes you want.
   */
  static function addClasses($html, $extra_classes = array()) {
    $instance = new self();
    $instance->classes = $extra_classes;
    $total = preg_match_all('~<li([^>]*?)>~', $html, $matches);
    $instance->total = $total ? $total : 0;
    return preg_replace_callback('~<li([^>]*?)>~', array($instance, 'processListItem'), $html);
  }

  private function processListItem($matches) {
    $this->count++;
    $this->classes_found = FALSE;
    $processed = preg_replace_callback('~(\w+)="(.*?)"~', array($this, 'appendClasses'), $matches[0]);
    if (!$this->classes_found) {
      $classes = $this->classes;
      if ($this->count == 1) {
        $classes[] = 'first';
      }
      if ($this->count == $this->total) {
        $classes[] = 'last';
      }
      if (!empty($classes)) {
        $processed = rtrim($matches[0], '>') . ' class="' . implode(' ', $classes) . '">';
      }
    }
    return $processed;
  }

  private function appendClasses($matches) {
    array_shift($matches);
    list($name, $value) = $matches;
    if ($name == 'class') {
      $value = array_filter(explode(' ', $value));
      $value = array_merge($value, $this->classes);
      if ($this->count == 1) {
        $value[] = 'first';
      }
      if ($this->count == $this->total) {
        $value[] = 'last';
      }
      $value = implode(' ', $value);
      $this->classes_found = TRUE;
    }
    return sprintf('%s="%s"', $name, $value);
  }
} 
```

# sql - 哪个 SQL 语句更快？（拥有与在哪里......）

> ID：328636
> 
> 赞同：51
> 
> 时间：2008-11-30T08:39:45.293
> 
> 标签：sql, performance, grouping, if-statement

```
SELECT NR_DZIALU, COUNT (NR_DZIALU) AS LICZ_PRAC_DZIALU
    FROM  PRACOWNICY
    GROUP BY NR_DZIALU
    HAVING NR_DZIALU = 30 
```

或者

```
SELECT NR_DZIALU, COUNT (NR_DZIALU) AS LICZ_PRAC_DZIALU
    FROM PRACOWNICY
    WHERE NR_DZIALU = 30
    GROUP BY NR_DZIALU 
```

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-11-30T08:42:19.407

理论（理论我的意思是[SQL Standard](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)）说 WHERE 在返回行之前限制结果集，而 HAVING 在带来所有行之后限制结果集。所以 WHERE 更快。在这方面，在符合 SQL 标准的 DBMS 上，仅在不能将条件放在 WHERE 上的情况下使用 HAVING（如某些 RDBMS 中的计算列。）

您可以查看两者的执行计划并自行检查，没有什么比这更好的了（在您的特定环境中使用您的数据测量您的特定查询。）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-30T08:46:42.330

这可能取决于引擎。例如，MySQL 几乎在链中最后应用 HAVING，这意味着几乎没有优化空间。从[手册](http://dev.mysql.com/doc/refman/5.0/en/select.html)：

> HAVING 子句几乎在最后应用，就在项目发送到客户端之前，没有优化。（LIMIT 在 HAVING 之后应用。）

我相信这种行为在大多数 SQL 数据库引擎中都是相同的，但我不能保证。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-30T10:18:37.170

这两个查询是等效的，您的 DBMS 查询优化器*应该*能够识别这一点并生成相同的查询计划。可能不是，但这种情况很容易识别，所以我希望任何现代系统——甚至是 Sybase——都能处理它。

应该使用 HAVING 子句对组函数应用条件，否则可以将它们移到 WHERE 条件中。例如。例如，如果您想将查询限制在 COUNT(DZIALU) > 10 的组中，则需要将条件放入 HAVING 中，因为它作用于组，而不是单个行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T08:42:03.930

我希望 WHERE 子句会更快，但它们可能会优化到完全相同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-03T19:43:18.813

说他们会优化并不是真正控制并告诉计算机该做什么。我同意使用 have 不能替代 where 子句。有一个特殊的用法，即通过使用 sum() 之类的东西应用于组，并且您希望将结果集限制为仅显示 sum() > 本身大于 100 的组。在组上工作，在行上工作。它们是苹果和橙子。所以真的，它们不应该被比较，因为它们是两种截然不同的动物。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-04-28T15:46:19.070

“WHERE”比“HAVING”快！

查询的更复杂的分组是 - 比较慢的“HAVING”将执行比较，因为：“HAVING”“过滤器”将处理更大量的结果，它也是额外的“过滤器”循环

“HAVING”也会使用更多内存（RAM）

Altho 在处理小数据时 - 差异很小，绝对可以忽略

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-07-03T03:46:09.573

如果我们与大量数据进行比较，“Having”会更慢，因为它适用于记录组，而“WHERE”适用于行数。

“Where”在引入所有行之前限制结果，而“Having”在引入所有行之后限制结果

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-24T07:45:31.197

这两个语句将具有相同的性能，因为 SQL Server 足够聪明，可以将两个相同的语句解析为一个相似的计划。

因此，在查询中使用 WHERE 或 HAVING 并不重要。

但是，理想情况下，您应该在语法上使用 WHERE 子句。

# php - 在共享主机 Linux 帐户 (GoDaddy) 上使用 PHP 访问本地邮箱

> ID：328653
> 
> 赞同：0
> 
> 时间：2008-11-30T09:03:30.707
> 
> 标签：php, email, shared-hosting

我想这应该是一种常见的技术，但是，我尝试了以下两个选项：

1) 使用我现有的 POP3 PHP 客户端访问我的本地邮件帐户。我收到“无法连接”。如果我使用连接到 GoDaddy 的 pop3 服务器的本地主机运行相同的代码

2) 解析本地 mbox 文件 - 我不知道我是否可以访问它，好像我不能。

关于哪种方法应该在这里最好的任何好主意？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T09:34:14.670

我会选择 POP3 选项。一旦您获得正确的端口/主机等，它应该可以工作。

另一个选项将导致您复制邮件服务器中已有的大部分功能，并且您很可能会在其中出现小错误，从而导致电子邮件无法正确显示，或者更糟糕的是，mbox 中的损坏。

如果您确实选择了 2，请尝试找到一个用于执行 mbox 位的库！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T10:04:36.307

Zend Framework 有[一个邮件组件](http://framework.zend.com/manual/en/zend.mail.read.html)，它允许您从各种来源阅读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T19:00:03.170

好像我已经想通了。共享主机（特别是 GoDaddy）不允许任何地方的直接 TCP 连接，包括他们自己的 POP3 服务器。看起来我也无法直接访问 mbox 文件。所以我认为它只是行不通。

感谢所有回复者！

也许还有其他廉价的共享托管计划可以提供此选项...

# ruby-on-rails - 如何将 restful_authentication 插件提交到我的 git 存储库？

> ID：328655
> 
> 赞同：0
> 
> 时间：2008-11-30T09:11:30.207
> 
> 标签：ruby-on-rails, git

如何将[http://github.com/technoweenie/restful-authentication/tree/master](http://github.com/technoweenie/restful-authentication/tree/master)插件添加到我的 Rails 项目并将其提交到 git repo ？我需要它致力于项目。

我已经尝试了几次，但它被 git 忽略了。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T09:23:48.620

从自述文件：

*   要么使用 git clone git://github.com/technoweenie/restful-authentication.git restful_authentication
*   或在获取插件后将插件的目录重命名为restful_authentication。

是你做的吗？

完成 git clone 后，你会想让`rm -rf restful_authentication/.git`你的项目乐于添加它（或使用子模块）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T09:25:49.287

无论哪种方式 git status 都不会报告任何需要添加的内容，就像它没有看到它一样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T09:39:58.527

@Dustin 可能已经解决了您的问题。

另请注意，如果您的项目中还没有“lib”目录，我发现生成器将失败：

```
ruby script/generate authenticated user sessions 
```

所以首先是 mkdir lib。

我[发布了](http://tardate.blogspot.com/2008/10/restfulauthentication-and-openid-with.html)关于restful_authentication + openid的叙述，涵盖了这些细节，可能会有所帮助。

# java - toString 的显式与隐式调用

> ID：328661
> 
> 赞同：43
> 
> 时间：2008-11-30T09:23:29.213
> 
> 标签：java, tostring

在需要有关对象的一些调试信息时，我曾经使用 toString 的隐式调用，因为如果对象为空，它不会抛出异常。

例如：

```
System.out.println("obj: "+obj); 
```

代替：

```
System.out.println("obj: "+obj.toString()); 
```

除了 null case 有什么不同吗？
后一种情况可以工作，而前一种情况不行吗？

编辑：
在隐式调用的情况下到底做了什么？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-11-30T09:26:18.443

差别不大。使用更短且工作更频繁的那个。

如果您出于其他原因实际上想要获取对象的字符串值，并且希望它对 null 友好，请执行以下操作：

```
String s = String.valueOf(obj); 
```

**编辑**：问题已扩展，所以我将扩展我的答案。

在这两种情况下，它们都会编译成如下内容：

```
System.out.println(new StringBuilder().append("obj: ").append(obj).toString()); 
```

当你`toString()`是隐式的时，你会在第二个追加中看到。

如果您查看 java 的源代码，您会看到`StringBuilder.append(Object)`如下所示：

```
public StringBuilder append(Object obj) {
    return append(String.valueOf(obj));
} 
```

`String.valueOf`看起来像这样：

```
public static String valueOf(Object obj) {
    return (obj == null) ? "null" : obj.toString();
} 
```

现在，如果你`toString()`自己，你绕过空检查和堆栈帧，直接进入`StringBuilder`：

```
public StringBuilder append(String str) {
    super.append(str);
    return this;
} 
```

所以......在这两种情况下都会发生非常相似的事情。一个只是做更多的工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T09:41:28.383

正如其他人所说 - 使用该`"" + obj`方法。

根据[Java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.18.1)：

*   如果术语为空，请使用`"null"`
*   `new Boolean(X)`使用盒装类型构造函数或其他任何东西转换原始类型
*   `toString()`被调用（或等效）
*   如果*结果*是`toString()`，`null`使用`"null"`
*   连接字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T09:25:53.233

没有区别，就像你说的，零安全。总是更喜欢前者而不是后者。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T11:04:08.107

实际上，如果你的不变量说对象永远不应该为空，那没关系。所以这取决于你是否接受 obj 为空。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-16T13:09:19.057

编写泛型引用类型非常容易。

```
class ref
{
  static public class Reference<T>
  {
    private T value;
    public Reference(T value) { set(value); }
    public Reference() { set(null); }
    public void set (T value) { this.value = value; }
    public T get () { return this.value; }
    public String toString() { return String.valueOf(this.value); }
  }

  static void fillString (Reference<String> str)
  {
    str.set("foo");
  }

  public static void main (String[] args)
  {
    Reference<String> str = new Reference<String>("");
    fillString(str);
    System.out.println (str);
  }
} 
```

运行它会给出所需的输出：

```
javac ref.java && java ref
foo 
```

# perl - 如何在目录中找到最新创建的文件？

> ID：328673
> 
> 赞同：22
> 
> 时间：2008-11-30T09:35:29.220
> 
> 标签：perl, last-modified

Perl 中是否有一种优雅的方式来查找目录中的最新文件（按修改日期最新）？

到目前为止，我正在搜索我需要的文件，并为每个文件获取它的修改时间，推入一个包含文件名、修改时间的数组，然后对其进行排序。

肯定有更好的办法。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-30T14:41:00.290

如果您需要排序列表（而不仅仅是第一个，请参阅 Brian 的答案），您的方式是“正确”的方式。如果您不喜欢自己编写该代码，请使用[它](http://search.cpan.org/~tpaba/File-DirList-0.04/lib/File/DirList.pm)

```
use File::DirList;
my @list = File::DirList::list('.', 'M'); 
```

就我个人而言，我不会采用这种`ls -t`方法 - 这涉及分叉另一个程序并且它不是可移植的。几乎没有我所说的“优雅”！

* * *

关于 rjray 的解决方案手工编码的解决方案，我会稍微改变一下：

```
opendir(my $DH, $DIR) or die "Error opening $DIR: $!";
my @files = map { [ stat "$DIR/$_", $_ ] } grep(! /^\.\.?$/, readdir($DH));
closedir($DH);

sub rev_by_date { $b->[9] <=> $a->[9] }
my @sorted_files = sort rev_by_date @files; 
```

在此之后，`@sorted_files`包含排序列表，其中第 0 个元素是最新文件，每个元素本身都包含对 的结果的引用，`stat`文件名本身位于最后一个元素中：

```
my @newest = @{$sorted_files[0]};
my $name = pop(@newest); 
```

这样做的好处是，如果需要，以后更容易更改排序方法。

* * *

编辑：这是一个更易于阅读（但更长）的目录扫描版本，它还确保仅将普通文件添加到列表中：

```
my @files;
opendir(my $DH, $DIR) or die "Error opening $DIR: $!";
while (defined (my $file = readdir($DH))) {
  my $path = $DIR . '/' . $file;
  next unless (-f $path);           # ignore non-files - automatically does . and ..
  push(@files, [ stat(_), $path ]); # re-uses the stat results from '-f'
}
closedir($DH); 
```

注意：对`defined()`结果的测试`readdir()`是因为如果你只测试一个名为'0'的文件会导致循环失败`if (my $file = readdir($DH))`

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-30T17:25:59.850

您不需要将所有修改时间和文件名保存在一个列表中，而且您可能不应该这样做。您需要做的就是查看一个文件，看看它是否比您之前看到的最旧的文件更旧：

```
{
    opendir my $dh, $dir or die "Could not open $dir: $!";

    my( $newest_name, $newest_time ) = ( undef, 2**31 -1 );

    while( defined( my $file = readdir( $dh ) ) ) {
        my $path = File::Spec->catfile( $dir, $file );
        next if -d $path; # skip directories, or anything else you like
        ( $newest_name, $newest_time ) = ( $file, -M _ ) if( -M $path < $newest_time );
    }

    print "Newest file is $newest_name\n";
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-30T09:51:37.287

您可以尝试使用 shell 的`ls`命令：

```
@list = `ls -t`;
$newest = $list[0]; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-30T09:52:25.443

假设您知道`$DIR`要查看的内容：

```
opendir(my $DH, $DIR) or die "Error opening $DIR: $!";
my %files = map { $_ => (stat("$DIR/$_"))[9] } grep(! /^\.\.?$/, readdir($DH));
closedir($DH);
my @sorted_files = sort { $files{$b} <=> $files{$a} } (keys %files);
# $sorted_files[0] is the most-recently modified. If it isn't the actual
# file-of-interest, you can iterate through @sorted_files until you find
# the interesting file(s). 
```

将过滤器`grep`包裹在“。”中的那个。`readdir`和“..” UNIX（-ish）文件系统中的特殊文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T13:52:01.137

如果您不能`ls`像@Nathan 建议的那样让您进行排序，那么您可以通过仅保留迄今为止看到的最新修改时间和相关文件名并在每次在目录中找到更新文件时替换它来优化您的过程。无需保留任何您知道比您目前看到的最新文件更旧的文件，当然也不需要对它们进行排序，因为您可以在从目录中读取时检测哪个是最新的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-04-10T23:18:19.697

主题是旧的，但也许有人会尝试它 - 它不是可移植的（仅限类 Unix 系统），但它非常简单并且有效：

> chdir $directory or die "不能改变目录";
> 
> 我的 $newest_file = `bash -c 'ls -t | head -1'`;
> 
> 咀嚼 $newest_file;
> 
> 打印 "$newest_file \n";

# perl - 如何使用 RRDtool 更新数据？

> ID：328682
> 
> 赞同：6
> 
> 时间：2008-11-30T09:49:11.847
> 
> 标签：perl, rrdtool, rrd

我正在使用 RRDtool 存储数据以显示图形。我通过 RRDs::update 更新 RRD，但在尝试重写信息时失败，这意味着在过去一段时间内更新数据（例如，有人将系统计时器移回）。我得到的错误是：

```
ERROR: Cannot update /opt/dashboard/rrd/Disk/192.168.120.168_disk_1.rrd with 
'1228032301:24:24' illegal attempt to update using time 1228032301 when last 
update time is 1228050001 (minimum one second step) 
```

我想始终允许重写，我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-07-25T08:44:47.327

我在这种情况下使用以下脚本：

```
#!/bin/sh
rrdtool dump "$1" | perl -ne 'BEGIN {$t=`date +%s`; chomp($t);} $a=$_; if ($a =~ /lastupdate.\d+..lastupdate/) { $a =~ s/(lastupdate.)\d+(..lastupdate)/$1$t$2/; } print $a' | rrdtool restore -f - "$1" 
```

这有点……怪异，但我找不到另一个自动解决方案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-07-20T06:32:16.237

rrdtool 不会将您的输入写入 rrd 文件。而是对您输入的内容进行采样，然后存储结果数据点。因此，向 rrdtool update 提供“旧数据”将不会以相同的方式工作，因为您无法轻松地跳回录音以“修复”一些错误的音符。

显然有一些方法可以改变旧数据，在 rrdtool 中这样做的方法是将 rrd 文件“转储”到 xml，修改内容并“恢复”它。不是一个人愿意定期做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T13:42:26.663

根据 RRD 文档，该时间戳编号**必须**随着每次更新而增加。鉴于您的限制，我将修改您的更新例程，以便如果更新失败，您可以捕获异常并在时间字段设置为“N”的情况下重做更新。这将使 RRDtool 使用当前时间作为更新时间。

或者，如果您不想处理捕获并重试代码，只需修改更新代码以始终使用“N”作为时间值——那么更新将始终有效。

快速查看 RRDtool[更新命令](http://oss.oetiker.ch/rrdtool/doc/rrdupdate.en.html)的文档可能会有所帮助。

# ruby-on-rails - 如何将字符串传递给 has_many :finder_sql 参数？

> ID：328692
> 
> 赞同：5
> 
> 时间：2008-11-30T10:08:50.183
> 
> 标签：ruby-on-rails, has-many, finder-sql

在我的应用程序中，用户 has_many 票。不幸的是，tickets 表没有 user_id：它有一个 user_login（它是一个遗留数据库）。总有一天我会改变它，但现在这个改变会产生太多的影响。

那么如何通过**登录**列建立“user has_many :tickets”关联呢？

我尝试了以下finder_sql，但它不起作用。

```
class User  < ActiveRecord::Base
  has_many :tickets,
      :finder_sql => 'select t.* from tickets t where t.user_login=#{login}'
  ...
end 
```

我收到一个奇怪的错误：

```
ArgumentError: /var/lib/gems/1.8/gems/activesupport-2.0.2/lib/active_support/dependencies.rb:402:in `to_constant_name': Anonymous modules have no name to be referenced by
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/base.rb:2355:in `interpolate_sql'
    from /var/lib/gems/1.8/gems/activesupport-2.0.2/lib/active_support/dependencies.rb:214:in `qualified_name_for'
    from /var/lib/gems/1.8/gems/activesupport-2.0.2/lib/active_support/dependencies.rb:477:in `const_missing'
    from (eval):1:in `interpolate_sql'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations/association_proxy.rb:95:in `send'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations/association_proxy.rb:95:in `interpolate_sql'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations/has_many_association.rb:143:in `construct_sql'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations/has_many_association.rb:6:in `initialize'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations.rb:1032:in `new'
    from /var/lib/gems/1.8/gems/activerecord-2.0.2/lib/active_record/associations.rb:1032:in `tickets'
    from (irb):1 
```

我还尝试了这个 finder_sql （在登录名周围加上双引号）：

```
:finder_sql => 'select t.* from tickets t where t.user_login="#{login}"' 
```

但它以同样的方式失败（无论如何，如果它有效，它将容易受到 sql 注入的影响）。

在一个测试数据库中，我在门票表中添加了一个 user_id 列，并尝试了这个 finder_sql：

```
:finder_sql => 'select t.* from tickets t where t.user_login=#{id}' 
```

现在这工作正常。显然，我的问题与我尝试使用的用户列是字符串而不是 id 的事实有关。

我在网上搜索了很长时间......但找不到任何线索。

我希望能够将任何参数传递给 finder_sql，并编写如下内容：

```
has_many :tickets_since_subscription,
:finder_sql => ['select t.* from tickets t where t.user_login=?'+
     ' and t.created_at>=?', '#{login}', '#{subscription_date}'] 
```

编辑：我不能使用 has_many 关联的 :foreign_key 参数，因为我的 users 表*确实*有一个 id 主键列，在应用程序的其他地方使用。

编辑#2：显然我没有足够彻底地阅读文档：has_many 关联可以采用 :primary_key 参数来指定哪一列是本地主键（默认 id）。谢谢丹尼尔让我大开眼界！我想它回答了我原来的问题：

```
has_many tickets, :primary_key="login", :foreign_key="user_login" 
```

但我仍然很想知道如何使 has_many :tickets_since_subscription 关联工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T23:20:48.807

我认为您希望`:primary_key`选择`has_many`. 它允许您指定当前表上的列，谁的值存储在`:foreign_key`另一个表的列中。

```
has_many :tickets, :foreign_key => "user_login", :primary_key => "login" 
```

我通过阅读[has_many](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001599)文档发现了这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T18:30:01.823

要拥有类似 has_many :tickets_since_subscription 的内容，您可以使用 named_scopes：

在模型中添加：

```
named_scope :since_subscription, lambda { |subscription_date| { :conditions => ['created_at > ?', subscription_date] } 
```

有了这个，你可以像这样找到你想要的：

```
user.tickets.since_subscription 3.days.ago 
```

或者

```
user.tickets.since_subscription user.subscription_date 
```

（当然您需要用户模型中的 subscription_date 列）。

[您可以在此处](http://ryandaigle.com/articles/2008/3/24/what-s-new-in-edge-rails-has-finder-functionality)找到更多示例。

如果您不想使用 named_scopes，您可以通过以下方式找到您想要的内容：

```
user.tickets.all(:conditions => ['created_at > ?', subscription_date]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T10:16:22.913

`:foreign_key`我认为您正在寻找`has_many`. 这应该允许您指定外键不是`user_id`, 但是`user_login`，而无需调整查找器逻辑。

有关详细信息，请参阅 ActiveRecord [has_many](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001599)文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T17:21:57.393

只是回答自己，以防万一没有更好的解决方案。我找不到 has_many 关联的解决方案，所以我最终创建了一个简单的查找器方法。一点都不好：它确实允许我调用**some_user.tickets**，但它并没有给我带来 has_many 关联的所有好处（即关联本身的 clear、delete、<<,... 方法）。

```
def tickets
    return Ticket.find(:all, :conditions=>["user_login = ?", login])
end 
```

我仍然希望有人会提出更好的解决方案。

# hibernate - Hibernate - 程序化配置

> ID：328696
> 
> 赞同：1
> 
> 时间：2008-11-30T10:17:05.567
> 
> 标签：hibernate, configuration

我正在尝试不通过 XML/Annotation 配置 Hibernate 类，而是使用它们的编程 API：

```
Mappings mappings = configuration.createMappings();
    mappings.addClass(...); 
```

列添加示例：

```
public void addColumn(String colName, String accessorName, NullableType type)
      {
        if(this._table == null)
          {
            return;
          }

        Column column = new Column(colName);
//        this._table.addColumn(column);

        Property prop = new Property();
        prop.setName(accessorName);

        SimpleValue simpleValue = new SimpleValue();
        simpleValue.setTypeName(type.getName());
        simpleValue.addColumn(column);
        simpleValue.setTable(_table);
        prop.setValue(simpleValue);

        this._rootClass.addProperty(prop);
      } 
```

这有效，直到我第一次需要添加一个名称已经存在的列。不是我将同一列添加到同一个表中，这是两个不同的表，但是，我收到了

```
 ERROR:  java.lang.NullPointerException
    at
 org.hibernate.mapping.PersistentClass.checkColumnDuplication(PersistentClass.java:711) 
```

我检查了源代码（我使用的是 Hibernate 3.3.1 GA）并且在 PersistentClass 中有一行，第 711 行：

```
protected void checkColumnDuplication() {
    HashSet cols = new HashSet(); <=========After this line 'cols' already contain data!
    if (getIdentifierMapper() == null ) {
        //an identifier mapper => getKey will be included in the getNonDuplicatedPropertyIterator()
        //and checked later, so it needs to be excluded
        checkColumnDuplication( cols, getKey().getColumnIterator() );
    }
    checkColumnDuplication( cols, getDiscriminatorColumnIterator() );
    checkPropertyColumnDuplication( cols, getNonDuplicatedPropertyIterator() );
    Iterator iter = getJoinIterator();
    while ( iter.hasNext() ) {
        cols.clear();
        Join join = (Join) iter.next();
        checkColumnDuplication( cols, join.getKey().getColumnIterator() );
        checkPropertyColumnDuplication( cols, join.getPropertyIterator() );
    }
} 
```

有没有人尝试过这样配置它，有同样的问题？...

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-09T11:00:50.187

你的空指针是因为你没有给你的 RootClass 对象一个实体名称 - 你只需要在根类上调用 setEntityName ，你就会过去最初的异常。

您还需要在根类上定义一个标识符值 - 只需使用您想要制作标识符的值调用 setIdentifier 即可。（不要也用这个调用 addProperty ，否则它会抱怨列重复）。

# java - 如何关闭一个特定 JLabel 的抗锯齿功能？

> ID：328698
> 
> 赞同：2
> 
> 时间：2008-11-30T10:20:47.960
> 
> 标签：java, swing, jlabel, antialiasing

如何关闭一个特定 JLabel 的抗锯齿功能？它使用非常小的字体，如果没有抗锯齿效果可能会更好。

如果重要的话，我在 Mac OS X 上使用 Java 1.5。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T18:18:07.373

您是否尝试过覆盖paint(Graphics g) 或paintComponent(Graphics g)，为图形对象上的文本AA 设置渲染提示并调用super 方法？

请参阅渲染提示： [https ://docs.oracle.com/javase/7/docs/api/java/awt/RenderingHints.html#VALUE_TEXT_ANTIALIAS_OFF](https://docs.oracle.com/javase/7/docs/api/java/awt/RenderingHints.html#VALUE_TEXT_ANTIALIAS_OFF)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T10:55:10.963

我认为您必须重写 paint(Graphics g) 方法并自己绘制文本。

# sqlite - 如何在 Netbeans 6.5 中创建数据库服务以连接 SQLite 数据库？

> ID：328704
> 
> 赞同：0
> 
> 时间：2008-11-30T10:23:43.913
> 
> 标签：sqlite, netbeans, jdbc, sqlite2

我使用 Netbeans IDE (6.5) 并且我有一个 SQLite 2.x 数据库。[我从zentus.com](http://www.zentus.com/sqlitejdbc/)安装了一个 JDBC SQLite 驱动程序，并在 Nebeans 服务面板中添加了一个新驱动程序。然后尝试使用我的数据库的此 URL 从 Services > Databases 连接到我的数据库文件：

jdbc:sqlite:/home/farzad/netbeans/myproject/mydb.sqlite

但它无法连接。我得到这个例外：

```
org.netbeans.modules.db.dataview.meta.DBException: Unable to Connect to database : DatabaseConnection[name='jdbc:sqlite://home/farzad/netbeans/myproject/mydb.sqlite [ on session]']
    at org.netbeans.modules.db.dataview.output.SQLExecutionHelper.initialDataLoad(SQLExecutionHelper.java:103)
    at org.netbeans.modules.db.dataview.output.DataView.create(DataView.java:101)
    at org.netbeans.modules.db.dataview.api.DataView.create(DataView.java:71)
    at org.netbeans.modules.db.sql.execute.SQLExecuteHelper.execute(SQLExecuteHelper.java:105)
    at org.netbeans.modules.db.sql.loader.SQLEditorSupport$SQLExecutor.run(SQLEditorSupport.java:480)
    at org.openide.util.RequestProcessor$Task.run(RequestProcessor.java:572)
[catch] at org.openide.util.RequestProcessor$Processor.run(RequestProcessor.java:997) 
```

我该怎么办？:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T00:45:10.757

Zentus SQLiteJDBC 的当前版本是 v053，基于 SQLite 3.6.1。它不会打开 2.x SQLite 数据库。也许您可以使用 SQLite 2.x 命令行工具来 .dump 您的数据库，并使用 Sqlite3 命令行工具来 .load 它。使用 Zentus SQLiteJDBC 访问新的 SQLite 3.x 数据库。

或者，使用支持 SQLite 2 的 JDBC 驱动程序，例如[这个](http://www.ch-werner.de/javasqlite/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-10T01:56:24.887

又是我...

我在第一次尝试时犯了两个错误。在设置`CLASSPATH`为系统变量后（希望我没有破坏其他东西:)），放入文件夹并更正我已经成功了`sqlite_jni.dll`:)`system32``JDBC url`

我也下载了他们的`SQLite ODBC wrapper`. `SQLite2`安装它并通过普通和`UTF8`基于`ODBC`驱动程序连接到我的数据库。我还使用内置的`NetBeans JDBC-ODBC`Bridge 驱动程序来建立这个连接。

所有三个连接都已创建，但是：

*   `ordinary ODBC driver`: 我看到文本数据的编码错误。所有其他列都正确显示

*   `UTF8 ODBC driver`: 我根本看不到文本数据。所有其他列都正确显示

*   `JDBC driver`: 我根本没有看到任何专栏。总是`"Select * from my_any_table"`返回一个空的*单列*

我的数据库中有基于俄语的数据。

所以...目前我已经返回到 sqlite 命令行界面 :))

# salt - 如何最好地为网站生成随机盐？

> ID：328711
> 
> 赞同：5
> 
> 时间：2008-11-30T10:35:11.037
> 
> 标签：salt, web-farm, application-state

我想生成一个随机盐值并将其放入应用程序状态。

现在，我正在使用网络场，因此每台机器的应用程序状态会有所不同。我也不想购买分布式的国有农场应用程序。

那么..对此有什么解决方案？我以为我可以在代码或 web.config 文件中对其进行硬编码 .. 但这意味着 eva 使用相同的盐 .. 不是很安全。

有人有什么建议吗？

请记住——我需要一个在所有机器上都相同的唯一键（例如 guid）。也许配置文件是唯一的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T11:14:52.953

如果我理解正确，您希望机器共享一个值，并且您不希望该值永远相同。理想情况下，您不希望存储它。

因此，让“第一台”机器在启动时生成一个随机值（使用它可以使用的任何熵，例如 /dev/random。如果您不需要安全值，并且在启动时没有足够的熵来创建一个无论如何，使用时间或其他），并将其传达给所有其他人。随着新机器加入集群，它们需要能够从集群中已经存在的一台机器中找到值。机器退出没有任何区别。

哪台机器是“第一”？好吧，如果您总是可以在任何其他机器之前启动一台机器，并给它时间来生成一个值，那么您可以使用简单的算法：

1）寻找其他机器。如果你找到一个，问它的价值。2）如果你没有找到一个，自己产生价值。

如果多台机器同时启动，那么它们需要在自己之间决定哪个是“领导者”。您可以通过自己选择一个来做到这一点（例如，一台机器在通过管理界面接收到特定连接后立即声明自己为“领导者”：在启动时，每台机器等待直到它获得此连接，或者从另一台机器听到另一台机器机器是领导者）。在令牌环上自动执行是微不足道的：MAC 地址最少的机器或任何领导者。但是没有人再使用令牌环了......

在不可靠网络的相反极端，我什至不确定它是否可能，除非所有机器都知道总共有多少台机器（在这种情况下，它就像令牌环一样，只是它们都相互交谈，直到它们已经弄清楚谁是领导者）。有了可靠的广播，你可以在以太网的合理范围内假设，我确信某处发布了一个最佳算法，但我忘记了它是什么（如果我知道的话）。我猜每个人都会定期发布他们认为的领导者是谁（包括他们自己的声明，如果他们还没有看到更好的领导者）。一旦你听了足够长的时间（大约一个间隔），你就会知道领导者是谁，你就可以开始使用种子了。

如果该值是一个秘密，那么显然集群内的通信必须是安全的。您可能会免费获得它，具体取决于网络架构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T11:15:07.663

在 web 农场场景中，存储在 machine.config 中的[机器密钥](http://msdn.microsoft.com/en-us/library/ms998288.aspx)可能就是您要查找的内容。它是一个随机生成的散列，在网络场中的机器之间必须相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T21:54:17.263

这是一个有趣/有趣的方式：

在每天开始时，即在 00:00 之后，查找 twitter 或 digg 或friendfeed 或任何在 00:00 之前/00:00 之前/时具有频繁更改数据的数据。所有机器都将获得相同的数据，并且保证会发生变化。为了使它成为一个秘密，将这个细节与一些密钥或 DNS 服务器的 MAC 或类似的东西结合起来。

我认为这很简单，而且很有趣。当然，这意味着您的网站将依赖这个外部网站来做一件小事，如果网站关闭，可能会很困难。但在这种情况下，您可以保留并继续使用前一天的数据。

只是想把它写成一种有趣/有趣的方式:)

# javascript - Windows 上的 V8 JavaScript 引擎 (MinGW)

> ID：328718
> 
> 赞同：2
> 
> 时间：2008-11-30T10:41:21.913
> 
> 标签：javascript, windows, mingw, v8

V8 JavaScript Engine的[构建说明](http://code.google.com/p/v8/wiki/BuildingOnWindows)仅提及 Visual Studio 2005 和 2008。有没有人在 Windows XP/Vista 上使用[MinGW](http://mingw.org/)成功？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T20:46:49.630

有一个支持 MinGW 的补丁：http: [//codereview.chromium.org/18309](http://codereview.chromium.org/18309)

另请参阅： [http ://code.google.com/p/v8/issues/detail?id=64](http://code.google.com/p/v8/issues/detail?id=64)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-19T06:12:06.203

你只需要稍微改变一下 Scons。
查看 C:\YourPythonFolder\Lib\site-packages\scons-YourSconsVersion\SCons\Script__ init__.py 并转到第 560 行
。将链接器更改为 gnulink，将 c 编译器更改为 mingw，将 c++ 编译器更改为 g++。
最终它应该是这样的：

```
linkers = ['gnulink', 'mslink',  'ilink', 'linkloc', 'ilink32' ]
c_compilers = ['mingw', 'msvc',  'gcc', 'intelc', 'icl', 'icc', 'cc', 'bcc32' ]
cxx_compilers = ['g++', 'msvc', 'intelc', 'icc',  'c++', 'bcc32' ] 
```

现在默认情况下会激活 MingW :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T07:15:17.903

我已经尝试过，但似乎它会自动检测 WIN32 平台并尝试调用 vc++ 编译器，我尝试将 mingw-gcc 编译器（我没有安装 vc++）添加到 PATH 并且构建脚本正确地看到它，但是不能开箱即用。

我想删除“WIN32 标志”就可以了，因为要在 mingw 下成功编译，编译器需要认为是在 unix 环境中，但是即使它编译也可能由于平台不同而出现一些问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T08:04:45.333

V8 似乎将其代码的不同部分（尤其是文件系统的东西）用于不同的平台。我在 Cygwin 下构建了一个漂亮的 linux 库，它可以在 linux 上运行，但不能在 Win 上运行。如果您删除 WIN32 标志，我认为部分情况下这与 MinGW 相同！

目前我只能看到两种可能性。一个很简单：使用 Visual Studio，它是免费的。第二个非常难：写一个makefile :)

# blackberry - 如何更改黑莓音量或静音？

> ID：328722
> 
> 赞同：1
> 
> 时间：2008-11-30T10:44:10.207
> 
> 标签：blackberry, java-me, volume

我目前的代码是这样的：

```
int volume = Alert.getVolume(); // reads 100
Alert.setVolume(0); 
```

它不会改变音量设置，就像它应该做的那样即使调用`Alert.mute(true);`也不会产生任何好的效果。 `Audio.setVolume(0);`也不行！

我在 Curve 8310 上运行它。我安装了另一个软件，尽管它成功地降低了音量设置。o 我想我做错了什么。任何的想法 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T14:33:49.960

如果您使用的是 class `javax.microedition.lcdui.Alert`，那可能是您的问题。尝试查看`net.rim.device.api.notification.NotificationsManager`该类及其其他包类/接口。

虽然简单/礼貌的方式只是要求用户手动更改用户配置文件。如果我将我的黑莓设置为静音并且某些应用程序发出疯狂的噪音（或者如果我期待一个重要的电话，则根本不会发出噪音），我将尽快删除该应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-14T14:23:15.327

如果你想用[Alert](http://www.blackberry.com/developers/docs/4.5.0api/net/rim/device/api/system/Alert.html)播放声音：

```
class Scr extends MainScreen implements FieldChangeListener {    
 ButtonField mVolumeUp;
 ButtonField mVolumeDown;
 ButtonField mPlay;
 LabelField mVolumeLabel;
 int mVolumeValue = 50;
 private static final short[] tune = new short[] { 466, 125, 10, 466 };

 public Scr() {
 mVolumeLabel = new LabelField("Volume: " + mVolumeValue);
     add(mVolumeLabel);
     mVolumeUp = new ButtonField("Vol Up", ButtonField.CONSUME_CLICK);
     mVolumeUp.setChangeListener(this);
     add(mVolumeUp);
     mVolumeDown = new ButtonField("Vol Down", ButtonField.CONSUME_CLICK);
     mVolumeDown.setChangeListener(this);
     add(mVolumeDown);
     mPlay = new ButtonField("Play", ButtonField.CONSUME_CLICK);
     mPlay.setChangeListener(this);
     add(mPlay);
 }

 public void fieldChanged(Field field, int context) {
     if (mVolumeUp == field) {
         if (mVolumeValue <= 90)
      mVolumeValue += 10;
      mVolumeLabel.setText("Volume: " + mVolumeValue);
  } else if (mVolumeDown == field) {
      if (mVolumeValue >= 10)
   mVolumeValue -= 10;
      mVolumeLabel.setText("Volume: " + mVolumeValue);
  } else if (mPlay == field) {
      Alert.startAudio(tune, mVolumeValue);
     }
 }
} 
```

在 RIM 4.5 8310 模拟器上测试

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T11:51:20.897

黑莓（但不是模拟器）上的某些功能仅适用于签名代码。我不确定是否是音量的情况，但当它是时我不会感到惊讶。

# debugging - 当您陷入编程困境时要遵循的技术

> ID：328727
> 
> 赞同：9
> 
> 时间：2008-11-30T10:48:25.113
> 
> 标签：debugging

当我遇到问题时：

*   我在 Google 上搜索代码片段。
*   我着眼于隔离问题，以便我可以更好地向其他人解释以获得答案。

您使用什么搜索技术来找到问题的解决方案？

我开始在 Stack Overflow 中提问。

您遵循哪些其他技术或方法来更快地解决问题？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-30T11:16:14.073

去做点别的吧。不完全是。我发现把问题抛在脑后很有帮助。当我在做其他事情、看电视或吃饭时，我数不清有多少次我想到了一个很好的解决方案来解决我一直在做的事情。看来您的大脑仍在后台处理问题。

如果这无法解决您的问题，请尝试与某人交谈。您会惊讶地发现，其他人可以经常为您的问题提供解决方案，而这些解决方案如此简单，以至于您不得不面对。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-30T10:52:16.087

那么有：

*   谷歌
*   谷歌
*   谷歌
*   堆栈溢出
*   谷歌
*   谷歌
*   如果我有书的话，可能会是一本书。

说真的，我在 1980 年代开始（爱好）编程，甚至到了 90 年代中期，你必须了解一些事情并拥有一个技术库。然后谷歌出现了，谷歌搜索比查找（书签！）API文档更容易（谷歌“java stringbuilder”将比导航更快地让我到达那里）更不用说一本真正的书（电子书或纸质书）。

您尝试解决的大多数问题以前都已解决。很多次。

其余的调试归结为分解，可能是单元测试（与分解有关）和验证您的假设。

通过“分解”，我的意思是您的解决方案的结构使得小块可以单独测试并易于理解。如果您有 7000 行方法，那么您（可能）做错了什么。

了解您所做的假设也很关键，因此您可以验证它们。例如，当我开始使用 PHP 时，我写了一段这样的代码：

```
$fields = $_SESSION["fields"]; // $fields is an associative array
$fields["blah"] = "foo"; 
```

我挠头想弄清楚为什么它不起作用（下次我查询 $_SESSION 时数组没有更新）。我来自 Java 背景，您可能会这样做：

```
Map fields = (Map)httpSession.get("fields");
fields.put("blah", "foo"); 
```

那肯定会奏效。然而，PHP会**复制**数组。一个可行的解决方案是使用引用：

```
$fields =& $_SESSION["fields"]; // $fields is an associative array
$fields["blah"] = "foo"; 
```

或者简单地说：

```
$_SESSION["fields"]["blah"] = "foo"; 
```

关于调试和编写健壮的代码，我要说的最后一件事是了解解决方案的边界。我的意思是如果你正在实现一个链接列表，那么边界条件将围绕列表为空时旋转。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-30T19:50:01.960

向同事解释问题，或写下来进行描述。这会让你从不同的角度思考不同的方式。为了更准确，并描述问题的上下文，您将退后一步，对问题进行更高层次的了解，您可能会发现认为您忽略了一些实际上很重要的东西。

有时，您甚至会在结束描述*之前找到解释。*

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-30T11:12:07.373

多年来，我最好的朋友一直骑着我的自行车回家。多年来，远离键盘已经为我解决了许多问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T12:00:29.537

如果问题持续到一天结束，我会在睡觉前有意识地把问题锁起来等待解决。

我意识到这听起来有点过时，但在我的经验中，如果不是全面的解决方案，我至少会用另一种方法来解决这个问题，这是很常见的。这个想法不是强调它 - 而是积极决定在一夜之间解决它。这样你就可以安心入睡了。

我认为吃得好、有规律的运动和良好的睡眠是解决问题的重要因素。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T12:32:07.243

通常我会花几个小时左右的时间来解决这个问题，尝试不同的东西，把它写在纸上，制作图表。如果这些都不起作用，我通常会使用以下选项。

1.  在我的显示器上贴一张便条，然后继续做其他事情
2.  在接下来的几个小时里看一眼便条，把这个问题留在我的脑海里
3.  谷歌类似的问题和使用的方法
4.  咨询同事或朋友
5.  在stackoverflow之类的论坛上提问
6.  放弃并设计解决问题的方法或设计解决问题的方法以便可以在其他时间处理并在所述解决方法的站点上贴上 TODO 注释

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-24T20:14:14.727

如果我无法弄清楚如何解决真正的问题，我会尝试考虑问题的简化版本。举个简单的例子：我最近遇到了一个问题，要找到一组运输路线来将物品从 A 点运送到 B 点，当时不一定有从 A 到 B 的直接路线，但可能有 A 到 C然后是 C 到 B，或 A 到 C，C 到 D，然后是 D 到 B。（我相信航空公司和铁路一直都这样做。）这相当复杂，所以我试着先看看简单的案例：直接 A 到 B。这很容易。然后考虑一下我将如何在此过程中一站式处理它。然后考虑两站。那时我能够看到解决方案的模式。

问题的简化版本的解决方案可能最终成为更大解决方案的一部分，并带有一些额外的复杂性。但即使不是这样，解决更简单问题的练习也常常会给你提供如何解决真正问题的想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T08:37:29.230

再一次，浏览我认为可能相关的内容，然后小睡一下。还有两个其他答案提到了睡觉或午睡，但这值得更多强调。现在知道那里有一个 SERIOUS 机器，当你睡觉时它会开始工作。谷歌（（CBS SCIENCE SLEEP））将为您提供精彩的免费视频。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-03T09:25:20.037

问问自己：解决这个特别棘手的问题对你的工作真的很重要吗？

出于您的应用程序的目的（或任何大图），您可以解决一个类似但更容易的问题来完成大致相同的事情。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T09:28:15.957

通常，我会拿笔和纸，试着在那里找出问题的细节。如果这没有帮助，谷歌。如果做不到这一点，我会做一段时间的其他事情，或者在网上问。到目前为止为我工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-03T09:32:34.077

您被卡住的事实可能是“代码气味”。暗示他们的设计或其他地方的方法有问题。尝试找出导致此问题的原因并解决此问题。

当你回到你的问题时，它可能不再存在。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-30T12:21:12.633

不要忘记[谷歌代码搜索](http://www.google.com/codesearch)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-03T09:21:09.733

尝试先解决一个小得多的问题，然后看看你是如何解决这个问题的。一旦你做到了，更大的问题看起来就不会那么可怕了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-30T13:46:15.020

通常最好通过做一些编程以外的事情来清理你的头脑。请参阅[此答案](https://stackoverflow.com/questions/305223/jon-skeet-facts#309319)以获取示例 - 我在与一个特别棘手的错误作斗争时做到了，当我回到这个问题时，我在大约一分钟内解决了它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-30T20:07:15.157

通常我会尝试解决它直到我睡觉。有时我会在纸上写下代码在做什么，然后将其分成几部分；我试图知道程序在运行时变量是如何变化的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-26T18:45:23.930

我使用的主要技术（应按顺序遵循，以便您可以重用前面步骤中所做的工作以提高效率）：

1.  **定义您的问题**：尝试清楚地定义问题所在以及预期的问题。请参阅 2 以帮助您。

2.  **收集有关错误的数据**：记录所有内容：您的尝试、预期结果、观察到的结果。这将避免需要重做几次相同的测试（因为您的大脑无法记住所有内容），并且可能会帮助您看到更大的图景。

3.  [**减少你的问题**](http://sscce.org/)。这对于任何自然现象的抽象建模通常都是正确的，但对于编程来说更是如此，因为程序是非常复杂的实体。您应该尝试将您的代码简化为能够重现您的问题的最小程序。[存在](https://www.st.cs.uni-saarland.de/dd/DD.py)[自动化](http://delta.tigris.org/) [工具](http://git-scm.com/docs/git-bisect) 。

4.  **与某人交谈**：一些轶事证实，仅通过交谈就解决了大约 2/3 的错误。请参阅[有用的泰迪熊轶事](https://www.youtube.com/watch?v=VnQu83nbBVc)。如果您之前已将程序简化为最小程序，并且对您的问题有明确的定义，那么两者都将对您的解释有用。

5.  **寻求协作帮助**：在 Google 和 StackOverflow 上搜索，如果找不到任何可以解决问题的内容，请发布（但首先请参阅 1，您必须对问题有明确的定义）。

如您所见，我将协作帮助作为最后一步，因为只有在明确定义问题并尝试减少问题并自行解决问题后，您才应该寻求帮助。如果您在尝试前面的步骤之前寻求协作帮助，那么您最终会得到一个糟糕的帮助，或者在您发布后立即自行解决。

您也可以对[Coursera 软件调试](https://www.udacity.com/course/software-debugging--cs259)课程感兴趣，该课程还介绍了几种自动调试方法。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-12-03T09:23:15.907

去厕所。你移动，所以你的大脑得到氧气。你放松，所以你专注于其他事情。

为创新而撒尿！:)

# svn - 递归解决SVN合并延迟冲突

> ID：328730
> 
> 赞同：4
> 
> 时间：2008-11-30T10:50:18.993
> 
> 标签：svn, merge, conflict

我有一个开发分支，有一段时间没有动过。我将主干合并到其中以集成主线中的许多修复/更改，因为它被分支出来，但现在我有很多小冲突（合并左/右合并）。

我希望使用最新的主干修订版来解决每个冲突。有没有我可以运行的命令可以自动解决一个方向的工作副本下的所有冲突（merge-right 应该用于所有冲突）？

编辑：如评论中所示，我尝试使用 --accept 选项还原然后运行 ​​svn merge，但显然 SVN 1.0 中没有这样的选项。仍在寻找解决方案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T11:14:13.033

我认为您可以在发出 svn merge 命令时使用“--accept theirs-full”选项。那应该做你想要的......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T11:53:55.837

就像 abigagly 说的，你应该`--accept theirs-full`在合并时使用。如果您已经完成合并并想重新开始，您可以使用`svn revert -R`first, 重新开始。

该`--accept`选项是 SVN 1.5 中的新选项，以及交互式合并支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-19T19:10:27.613

```
svn --version
svn, version 1.6.17 (r1128011)

svn resolve -R --accept='theirs-full' <path> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T11:29:32.703

我认为如果您执行“检查修改”，TSVN 可以做到这一点，它将向您显示所有文件，包括冲突的文件，将它们全部选中，然后选择“使用他们的解决”。

不确定 TSVN 是否与您的平台相关，或者这实际上正是您想要做的，但它可能会有所帮助......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-11T19:59:13.477

好的，我有一个计划，我认为它解释了我的大部分困境 - （从我的帖子中收获到 users@subversion...）

我认为我们遇到了以下使事情变得更糟的问题：

*   樱桃挑选合并+根以下级别的合并（都允许，但它们可以使以后的合并更复杂）
*   我们假设合并命令完成意味着所有更改都合并（没有仔细检查 mergeinfo --show-revs 合格）
*   早期客户端（1.5 或早期 1.6）可能存在的错误。我们有许多 ubuntu 和 debian 系统，最初并不知道 wandisco 的更新站点。因此，我们错过了保持最新状态的简单方法。我们现在正在快速部署 1.6.11

**推送过程：**

1.  svn merge --reintegrate --accept 推迟 URL-branch path-to-workspace
2.  svn mergeinfo URL-branch path-to-workspace --show-revs 合格 > 合格_revs.txt
3.  重复直到没有任何符合条件的东西

**PULL 过程：** 相同的模式，但减去 --reintegrate

# c# - 处理这个对象就够了吗？还是我需要做更多？

> ID：328743
> 
> 赞同：1
> 
> 时间：2008-11-30T11:07:41.687
> 
> 标签：c#, .net, dispose, sha2

我有这个代码： -

```
using (System.Security.Cryptography.SHA256 sha2 = 
    new System.Security.Cryptography.SHA256Managed())
{ .. } 
```

我是否需要在离开该处置范围之前放置这行代码..还是已经处置“调用”了。

```
sha2.Clear(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T11:11:14.443

由于 AFAIK Clear() 方法只调用 Dispose，因此 using 块应该足以确保释放使用的资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T11:28:59.383

恕我直言，如果调用 Dispose() 不足以处理对象，那么代码中存在严重错误或设计中存在严重缺陷。所以不用担心在你自己的代码中采取任何额外的步骤！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T12:46:42.220

如果您使用 Reflector 看一下，您会看到它`Clear`只是调用，因此在您的示例中`Dispose`无需调用。`Clear`

许多框架类都提供了`Close`// `Clear`Whatever 覆盖，`Dispose`以使使用更加简单明了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T11:33:09.733

还有一个通用的有用提示——不要忘记现在所有这些东西的来源都可用——它通常可以帮助我回答这类问题，而无需猜测或推断。

这是一个很好的起点： http: [//www.codeplex.com/NetMassDownloader](http://www.codeplex.com/NetMassDownloader)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-30T11:57:28.437

Dispose() 已经足够好了。

我不确定.NET 是如何工作的。但是添加函数调用或“设置 null”会降低 Java 的性能。

CLR/Java VM 将（并且必须）能够在下一次垃圾回收中从“根”清除所有取消引用的托管对象。

PS。Dispose() 确实清理“非托管”资源，以提高 GC 性能，因为它不等待 Finallizer 线程完成。

# java - return 语句的问题

> ID：328747
> 
> 赞同：2
> 
> 时间：2008-11-30T11:13:29.757
> 
> 标签：java, methods, return

我的退货声明有问题>.<我想将所有杂志名称存储到

```
ArrayList<String> ListNameMagazine = new ArrayList<String>(); 
```

我有一个数据库；在数据库中有一个表`name_magazine`，其中的数据`name_magazine`是

> 杂志1
> 
> 杂志2
> 
> 杂志3
> 
> 杂志4

这是我的主要：

```
 ShowData Show = new ShowData();

    int HowManyMagazine = Show.HowManyMagazine(1); // to make sure there is how many Magazine name in my database

    //System.out.print(HowManyMagazine); //i want to make sure the data is out.

    String nmeMagazine = null; // this variable for get data from return statement 

    // i want to store in ListNameMagazine
    ArrayList<String> ListNameMagazine = new ArrayList<String>();

    for (int numbeer = 0;numbeer <= HowManyMagazine ; numbeer++)
    {
       //Store in 1 variable String, because if arrayList it's error
        nmeMagazine = Show.getResult("Select Name_Magazine from Magazine");
        // Store again in array list
        ListNameMagazine.add(nmeMagazine);
    }

    for (String s : ListNameMagazine)
    {
        System.out.println(s); // show the data
    } 
```

这是我的回报声明：

```
public String getResult(String sql)
throws SQLException
{
    ResultSet rs = st.executeQuery(sql);
    ResultSetMetaData resultsetmetadata = rs.getMetaData();

    //String just_try = null;
    while (rs.next()) { 
         System.out.println("Result:"+rs.getString(1));
         //just_try = rs.getString(1);
         //return just_try;
    }
    return null;    //return just_try;
} 
```

问题出在return语句中。

当注释（ // ）我擦除并且最后返回 null 时；我删除。它变成了这里：

```
public String getResult(String sql)
throws SQLException
{         
     ResultSet rs = st.executeQuery(sql);
     ResultSetMetaData resultsetmetadata = rs.getMetaData();
     String just_try = null;

     while (rs.next()) { 
         //System.out.println("Result:"+rs.getString(1));
        just_try = rs.getString(1);
        return just_try;
     }

     return just_try;
 } 
```

当我使用此语句显示数据时。

```
for (String s : ListNameMagazine)
    {
        System.out.println(s); // show the data
    } 
```

结果只

> 杂志4
> 
> 杂志4
> 
> 杂志4
> 
> 杂志4

@.@ 我已经搞不清楚@.@ 小姐在哪里了

但是当我在这样的返回语句中显示数据时

```
public String getResult(String sql)
throws SQLException
    {         
    ResultSet rs = st.executeQuery(sql);
    ResultSetMetaData resultsetmetadata = rs.getMetaData();
    String just_try = null;

    while (rs.next()) {     
        System.out.println("Result:"+rs.getString(1));
        //just_try = rs.getString(1);
        //return just_try;
    }

    return null;
} 
```

数据显示了我想要的。我知道我只是想念某个地方，但我不知道那个@.@ 在哪里。我希望你们能找到它。THX

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T11:30:17.163

你的问题是**return**只返回一件事，它会*立即返回并且函数会退出*！您正在重新调整杂志**just_try**的名称。

```
while (rs.next()) { 

    //System.out.println("Result:"+rs.getString(1));

   just_try = rs.getString(1);

  return just_try;

} 
```

因此，您开始遍历**rs**，并获得名称：

```
just_try = rs.getString(1); 
```

然后你告诉代码返回just_try。

```
return just_try; 
```

此时将返回just_try，函数将退出！我认为您的问题是您希望该函数继续运行，并继续将值返回给调用它的代码，但这不是它的工作方式。

我怀疑你想要做的是这样的：

```
ArrayList<String> ListNameMagazine;
ListNameMagazine = Show.getResult("Select Name_Magazine from Magazine"); 
```

然后在函数getResult中：

```
public ArrayList<String> getResult(String sql) throws SQLException {

    ResultSet rs = st.executeQuery(sql);

    ResultSetMetaData resultsetmetadata = rs.getMetaData();

    ArrayList<String> returnArrayList = new ArrayList<String>();

    while (rs.next()) { 

        returnArrayList.add(rs.getString(1));

    }
    return returnArrayList;

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T12:03:16.443

xan：您的方法返回一个字符串，而您尝试返回一个列表。

签名必须更改为

```
public List<String> getResult(String sql) throws SQLException; 
```

# air - 远景：Adobe AIR 可以获取您的 Firefox 标签页的当前网址吗？

> ID：328753
> 
> 赞同：2
> 
> 时间：2008-11-30T11:23:48.270
> 
> 标签：air

我知道这是一个远景，但我想知道是否有人知道这是否可能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T03:18:54.503

大多数浏览器在请求链接文档时[会将 HTTP_REFERRER](http://en.wikipedia.org/wiki/Referer)标头设置为当前 URL。但是，它可能会被欺骗，因此请勿将其用于安全性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T11:50:00.837

我对空气一无所知。

但是，如果 AIR 具有 JavaScript 访问权限，并且您可以访问容器文档（[如何在 Adob​​e AIR 中的不同页面之间共享 javascript 对象？](https://stackoverflow.com/questions/193130/how-do-i-share-a-javascript-object-between-different-pages-in-adobe-air)），那么您需要解决的只是如何从中获取 Document.location。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-30T13:34:08.893

我认为这已经很晚了，但是由于我在 3 年后搜索相同的信息，所以就这样了。

[LoaderInfo.loaderUrl](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/display/LoaderInfo.html#loaderURL)应该为您提供所需的信息。

！

# asp.net - 如何使用 StylePlaceHolder 和 Style 控件控制 ASP.NET 主题中的样式表

> ID：328763
> 
> 赞同：10
> 
> 时间：2008-11-30T11:32:24.413
> 
> 标签：asp.net, css, themes, custom-server-controls

**更新：**这变成了一篇博客文章，带有更新的链接和代码，在我的博客上：[https ://egilhansen.com/2008/12/01/how-to-take-control-of-style-sheets-in- asp-net-themes-with-the-styleplaceholder-and-style-control/](https://egilhansen.com/2008/12/01/how-to-take-control-of-style-sheets-in-asp-net-themes-with-the-styleplaceholder-and-style-control/)

* * *

问题很简单。使用 ASP.NET 主题时，您对如何将样式表呈现到页面没有太多发言权。

渲染引擎使用 <link href=”...” 符号按字母顺序添加您在主题文件夹中的所有样式表。

我们都知道样式表的顺序很重要，幸运的是，asp.nets 的缺点可以通过在样式表前面加上 01、02、...、99 来规避，从而强制您想要的顺序（参见 Rusty Swayne[上的博客](http://rustyswayne.com/post.aspx?id=cba116ea-b672-4c90-9f4e-18b70ca2f50a)文章更多信息的技术）。

如果您使用我强烈推荐的重置样式表，这一点尤其重要；它使跨浏览器以一致的形式对站点进行样式设置变得更加容易（请查看[来自 Eric Meyer 的 Reset Reloaded](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/)）。

您也错过了指定媒体类型（例如屏幕、印刷、投影、盲文、语音）的可能性。如果您更喜欢使用 @import 方法包含样式表，那么您也会被冷落。

另一个缺少的选项是条件注释，如果您使用“ie-fix.css”样式表，它特别有用。

在我解释 StylePlaceholder 和 Style 控件如何解决上述问题之前，我的解决方案受到Per Zimmerman关于该主题[的博客文章的启发。](http://www.dentaku.com/2007/01/take-control-over-stylesheet-order-and-media-when-using-asp-net-2-0-themes.aspx)

StylePlaceHolder 控件放置在母版页或页面的页眉部分。它可以承载一个或多个 Style 控件，并且默认会移除渲染引擎添加的样式，并添加自己的样式（它只会移除从当前活动主题中添加的样式）。

Style 控件既可以在其开始和结束标记之间托管内联样式，也可以通过其 CssUrl 属性对外部样式表文件的引用。使用其他属性，您可以控制样式表呈现给页面的方式。

让我举个例子。考虑一个简单的网站项目，它有一个母版页和一个包含三个样式表的主题——01reset.css、02style.css、99iefix.cs。注意：我使用前面描述的前缀技术命名它们，因为它可以提供更好的设计时体验。此外，自定义控件的标签前缀是“ass:”。

在母版页的标题部分中，添加：

```
<ass:StylePlaceHolder ID="StylePlaceHolder1" runat="server" SkinID="ThemeStyles" /> 
```

在您的主题目录中，添加一个皮肤文件（例如 Styles.skin）并添加以下内容：

```
<ass:StylePlaceHolder1runat="server" SkinId="ThemeStyles">
    <ass:Style CssUrl="~/App_Themes/Default/01reset.css" />
    <ass:Style CssUrl="~/App_Themes/Default/02style.css" />
    <ass:Style CssUrl="~/App_Themes/Default/99iefix.css" ConditionCommentExpression="[if IE]" />
</ass:StylePlaceHolder1> 
```

基本上就是这样。Style 控件上有更多属性可用于控制渲染，但这是基本设置。有了它，您可以轻松添加另一个主题并替换所有样式，因为您只需要包含不同的皮肤文件。

现在到使这一切发生的代码。我必须承认设计时体验有一些怪癖。可能是因为我写自定义控件不是很熟练（其实这两个是我第一次尝试），所以很想在下面输入。在我正在开发的当前基于 WCAB/WCSF 的项目中，我在 Visual Studios 设计视图中看到了这样的错误，我不知道为什么。该网站编译，一切都在线运行。

[Visual Studio 中的设计时错误示例 http://www.egil.dk/wp-content/styleplaceholder-error.jpg](http://www.egil.dk/wp-content/styleplaceholder-error.jpg)

以下是 StylePlaceHolder 控件的代码：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Security.Permissions;
using System.Web;
using System.Web.UI;
using System.Web.UI.HtmlControls;

[assembly: TagPrefix("Assimilated.Extensions.Web.Controls", "ass")]
namespace Assimilated.WebControls.Stylesheet
{
    [AspNetHostingPermission(SecurityAction.Demand, Level = AspNetHostingPermissionLevel.Minimal)]
    [AspNetHostingPermission(SecurityAction.InheritanceDemand, Level = AspNetHostingPermissionLevel.Minimal)]
    [DefaultProperty("SkinID")]
    [ToolboxData("<{0}:StylePlaceHolder runat=\"server\" SkinID=\"ThemeStyles\"></{0}:StylePlaceHolder>")]
    [ParseChildren(true, "Styles")]
    [Themeable(true)]
    [PersistChildren(false)]
    public class StylePlaceHolder : Control
    {
        private List<Style> _styles;

        [Browsable(true)]
        [Category("Behavior")]
        [DefaultValue("ThemeStyles")]
        public override string SkinID { get; set; }

        [Browsable(false)]
        public List<Style> Styles
        {
            get
            {
                if (_styles == null)
                    _styles = new List<Style>();
                return _styles;
            }
        }

        protected override void CreateChildControls()
        {
            if (_styles == null)
                return;

            // add child controls
            Styles.ForEach(Controls.Add);
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            // get notified when page has finished its load stage
            Page.LoadComplete += Page_LoadComplete;
        }

        void Page_LoadComplete(object sender, EventArgs e)
        {
            // only remove if the page is actually using themes
            if (!string.IsNullOrEmpty(Page.StyleSheetTheme) || !string.IsNullOrEmpty(Page.Theme))
            {
                // Make sure only to remove style sheets from the added by
                // the runtime form the current theme.
                var themePath = string.Format("~/App_Themes/{0}",
                                              !string.IsNullOrEmpty(Page.StyleSheetTheme)
                                                  ? Page.StyleSheetTheme
                                                  : Page.Theme);

                // find all existing stylesheets in header
                var removeCandidate = Page.Header.Controls.OfType<HtmlLink>()
                    .Where(link => link.Href.StartsWith(themePath)).ToList();

                // remove the automatically added style sheets
                removeCandidate.ForEach(Page.Header.Controls.Remove);
            }
        }

        protected override void AddParsedSubObject(object obj)
        {
            // only add Style controls
            if (obj is Style)
                base.AddParsedSubObject(obj);
        }

    }
} 
```

以及 Style 控件的代码：

```
using System.ComponentModel;
using System.Security.Permissions;
using System.Web;
using System.Web.UI;

[assembly: TagPrefix("Assimilated.Extensions.Web.Controls", "ass")]
namespace Assimilated.WebControls.Stylesheet
{
    [AspNetHostingPermission(SecurityAction.Demand, Level = AspNetHostingPermissionLevel.Minimal)]
    [AspNetHostingPermission(SecurityAction.InheritanceDemand, Level = AspNetHostingPermissionLevel.Minimal)]
    [DefaultProperty("CssUrl")]
    [ParseChildren(true, "InlineStyle")]
    [PersistChildren(false)]
    [ToolboxData("<{0}:Style runat=\"server\"></{0}:Style>")]
    [Themeable(true)]
    public class Style : Control
    {
        public Style()
        {
            // set default value... for some reason the DefaultValue attribute do
            // not set this as I would have expected.
            TargetMedia = "All";
        }

        #region Properties

        [Browsable(true)]
        [Category("Style sheet")]
        [DefaultValue("")]
        [Description("The url to the style sheet.")]
        [UrlProperty("*.css")]
        public string CssUrl
        {
            get; set;
        }

        [Browsable(true)]
        [Category("Style sheet")]
        [DefaultValue("All")]
        [Description("The target media(s) of the style sheet. See http://www.w3.org/TR/REC-CSS2/media.html for more information.")]
        public string TargetMedia
        {
            get; set;
        }

        [Browsable(true)]
        [Category("Style sheet")]
        [DefaultValue(EmbedType.Link)]
        [Description("Specify how to embed the style sheet on the page.")]
        public EmbedType Type
        {
            get; set;
        }

        [Browsable(false)]
        [PersistenceMode(PersistenceMode.InnerDefaultProperty)]
        public string InlineStyle
        {
            get; set;
        }

        [Browsable(true)]
        [Category("Conditional comment")]
        [DefaultValue("")]
        [Description("Specifies a conditional comment expression to wrap the style sheet in. See http://msdn.microsoft.com/en-us/library/ms537512.aspx")]
        public string ConditionalCommentExpression
        {
            get; set;
        }

        [Browsable(true)]
        [Category("Conditional comment")]
        [DefaultValue(CommentType.DownlevelHidden)]
        [Description("Whether to reveal the conditional comment expression to downlevel browsers. Default is to hide. See http://msdn.microsoft.com/en-us/library/ms537512.aspx")]
        public CommentType ConditionalCommentType
        {
            get; set;
        }

        [Browsable(true)]
        [Category("Behavior")]
        public override string SkinID { get; set; }

        #endregion

        protected override void Render(HtmlTextWriter writer)
        {            
            // add empty line to make output pretty
            writer.WriteLine();

            // prints out begin condition comment tag
            if (!string.IsNullOrEmpty(ConditionalCommentExpression))
                writer.WriteLine(ConditionalCommentType == CommentType.DownlevelRevealed ? "<!{0}>" : "<!--{0}>",
                                 ConditionalCommentExpression);

            if (!string.IsNullOrEmpty(CssUrl))
            {               
                // add shared attribute
                writer.AddAttribute(HtmlTextWriterAttribute.Type, "text/css");

                // render either import or link tag
                if (Type == EmbedType.Link)
                {
                    // <link href=\"{0}\" type=\"text/css\" rel=\"stylesheet\" media=\"{1}\" />
                    writer.AddAttribute(HtmlTextWriterAttribute.Href, ResolveUrl(CssUrl));
                    writer.AddAttribute(HtmlTextWriterAttribute.Rel, "stylesheet");
                    writer.AddAttribute("media", TargetMedia);
                    writer.RenderBeginTag(HtmlTextWriterTag.Link);
                    writer.RenderEndTag();
                }
                else
                {
                    // <style type="text/css">@import "modern.css" screen;</style>
                    writer.RenderBeginTag(HtmlTextWriterTag.Style);
                    writer.Write("@import \"{0}\" {1};", ResolveUrl(CssUrl), TargetMedia);
                    writer.RenderEndTag();
                }
            }

            if(!string.IsNullOrEmpty(InlineStyle))
            {
                // <style type="text/css">... inline style ... </style>
                writer.AddAttribute(HtmlTextWriterAttribute.Type, "text/css");
                writer.RenderBeginTag(HtmlTextWriterTag.Style);
                writer.Write(InlineStyle);
                writer.RenderEndTag();
            }

            // prints out end condition comment tag
            if (!string.IsNullOrEmpty(ConditionalCommentExpression))
            {
                // add empty line to make output pretty
                writer.WriteLine();
                writer.WriteLine(ConditionalCommentType == CommentType.DownlevelRevealed ? "<![endif]>" : "<![endif]-->");
            }
        }
    }

    public enum EmbedType
    {        
        Link = 0,
        Import = 1,
    }

    public enum CommentType
    {
        DownlevelHidden = 0,
        DownlevelRevealed = 1
    }
} 
```

那你们怎么看？这是解决 asp.net 主题问题的好方法吗？那代码呢？我真的很想对此进行一些输入，尤其是在设计时体验方面。

我上传了包含该项目[的 Visual Studio 解决方案的压缩版本，以防有人感兴趣。](http://egilhansen.com/sites/default/files/node/9/assimilatedwebcontrols.zip)

最好的问候，埃吉尔。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T20:34:23.210

找到了我自己的问题的答案。

我在设计模式下出现渲染错误的原因是 Visual Studio SP1 中的一个明显错误，[微软尚未修复](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361826)。

因此，上面的代码在设计模式下也能按预期工作，只要您只将自定义控件包含在预编译的程序集中，而不是通过同一解决方案中的另一个项目。

有关如何以及为什么更详细的说明，请参阅上面的链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:13:56.837

工作非常顺利。

对于像我这样从不记得 <% 标记语法的人来说，这是您需要添加到母版页定义和外观文件顶部以注册命名空间的内容。

```
<%@ Register TagPrefix="ass" Namespace="Assimilated.WebControls.Stylesheet" %> 
```

我不确定我的代码中是否需要那么多“屁股”，但除此之外我喜欢它。

哦，如果这真的是您的第一个自定义控件，那就太好了。我知道它的灵感来自其他人的代码，但它至少**看起来**具有所有正确的属性和接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-21T06:01:22.313

回复：使用特定的媒体 CSS 文件，您可以使用 @media CSS 语句，工作正常。

# c# - ICollection 到字符串[]

> ID：328765
> 
> 赞同：17
> 
> 时间：2008-11-30T11:34:01.680
> 
> 标签：c#, generics, collections, .net-2.0

我有一个类型的对象`ICollection<string>`。什么是最好的转换方式`string[]`。

这如何在 .NET 2 中完成？
如何在更高版本的 C# 中更干净地完成这项工作，也许在 C# 3 中使用 LINQ？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-30T11:40:42.027

您可以使用以下代码段将其转换为普通数组：

```
string[] array = new string[collection.Count];
collection.CopyTo(array, 0); 
```

那应该做的工作:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-30T11:44:52.580

如果您使用 C# 3.0 和 .Net framework 3.5，您应该能够：

```
ICollection<string> col = new List<string>() { "a","b"};
string[] colArr = col.ToArray(); 
```

当然，你必须有“使用 System.Linq;” 在文件的顶部

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-30T11:43:58.777

在 的（微不足道的）情况下`ICollection<String>`，使用 ToArray：

```
String[] GetArray(ICollection<String> mycoll)
{
    return mycoll.ToArray<String>();
} 
```

编辑：使用.Net 2.0，您可以返回带有额外的数组`List<String>`：

```
String[] GetArray(ICollection<String> mycoll)
{
    List<String> result = new List<String>(mycoll);
    return result.ToArray();
} 
```

# c# - 泛型和 System.Collections

> ID：328768
> 
> 赞同：8
> 
> 时间：2008-11-30T11:41:29.483
> 
> 标签：c#, .net, generics, collections

迁移到 .NET 2.0+ 之后，是否还有理由继续使用 systems.Collections 命名空间（除了维护遗留代码）？是否应该始终使用泛型命名空间？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-30T12:21:11.227

在大多数情况下，泛型集合将比非泛型集合执行得更快，并为您提供强类型集合的好处。比较 System.Collections 和 System.Collections.Generic 中可用的集合，您会得到以下“迁移”：

```
    非通用通用等效项
    -------------------------------------------------- ----------
    ArrayList 列表<T>
    位阵列不适用
    CaseInsensitiveComparer N/A
    集合基础集合<T>
    比较器 比较器<T>
    DictionaryBase 字典<TKey,TValue>
    哈希表字典<TKey,TValue>
    队列队列<T>
    ReadOnlyCollectionBase ReadOnlyCollection<T>
    SortedList SortedList<TKey,TValue>
    栈栈<T>

    DictionaryEntry KeyValuePair<TKey,TValue>

    ICollection N/A（使用 IEnumerable<T> 或任何扩展它的东西）
    IComparer IComparer<T>
    IDictionary IDictionary<TKey,TValue>
    IEnumerable IEnumerable<T>
    IEnumerator IEnumerator<T>
    IEqualityComparer IEqualityComparer<T>
    IList IList<T>

```

ICollection 是不可变的（没有成员可以更改集合的内容），而 ICollection<T> 是可变的。这使得接口仅在名称上相似，而 ICollection 和 IEnumerable<T> 差别很小。

从这个列表中，唯一没有泛型对应的非泛型类是 BitArray 和 CaseInsensitiveComparer。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T11:53:09.943

在某些情况下，通用容器的性能优于旧容器。在所有情况下，它们至少应该和旧的一样好。它们有助于捕捉编程错误。这是更有用的抽象和更好的性能的罕见组合，因此没有太多理由避免它们。只有当你被迫使用一个糟糕的库时，你才必须使用在泛型之前编写的库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T12:23:52.500

我看到了对来自 c# 团队的 Anders Hejlsberg 的采访，有人问他是否对以前的 .net 版本感到遗憾。他提到的第一件事是在 asp.net 1.0 中没有泛型。没有它意味着他们必须实施将坚持使用 .net 库并很快成为遗留代码的变通方法。

我从不使用 System.Collections 命名空间，从他的陈述来看，这似乎是正确的路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T12:35:05.567

关于使用泛型时我能想到的唯一不好的事情是方差，例如，如果你有一个`List<Person>`并且你想将它传递给一个`List<object>`你不能因为`List<Person>`不能`List<object>`直接转换的方法。

这个问题在 .NET 4.0 中得到解决。

# c# - 类继承通用字典 和接口

> ID：328772
> 
> 赞同：2
> 
> 时间：2008-11-30T11:45:22.203
> 
> 标签：c#, generics, collections, interface

我有一个继承通用字典和接口的类

```
public class MyDictionary: Dictionary<string, IFoo>, IMyDictionary
{
} 
```

问题是这个类的消费者正在寻找接口的“.Keys”和“.Values”属性，所以我补充说：

```
 /// <summary>
    /// 
    /// </summary>
    ICollection<string> Keys { get; }

    /// <summary>
    /// 
    /// </summary>
    IEnumerable<IFoo> Values { get; } 
```

到界面。

现在，实现也需要这个，但是当我实现这些时，我得到了这个错误：

“关键字 new 是必需的，因为它隐藏了属性 Keys ......”

所以我需要做什么。我应该在这些获取属性前添加一个“新”吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T12:23:45.403

另一种选择是将接口上的类型更改为：

```
public interface IMyDictionary
{
    /// <summary>
    /// 
    /// </summary>
    Dictionary<string, IFoo>.KeyCollection Keys { get; }

    /// <summary>
    /// 
    /// </summary>
    Dictionary<string, IFoo>.ValueCollection Values { get; }
} 
```

这样接口已经被字典实现了，省去了再次实现属性的麻烦，并且它不会隐藏或覆盖原始实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-30T12:40:35.010

Dictionary<string, IFoo> 实现了 IDictionary<TKey,TValue> 接口，该接口已经提供了 Keys 和 Values 属性。不需要创建自己的属性，但绕过编译器警告的方法是`new`在类中属性声明的开头添加关键字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T11:59:16.733

原因是您的键和值属性隐藏了 Dictionary 类中键和值属性的实现。

编辑：是的，您所要做的就是将新关键字添加到您的属性中。所以你的代码看起来像这样：

```
class IFoo
{ }

interface MyDictionary
{
    ICollection<string> Keys { get; }

    /// <summary>
    /// 
    /// </summary>
    IEnumerable<IFoo> Values { get; }
}

class IStuff : Dictionary<string, IFoo>, MyDictionary
{
    #region MyDictionary Members

    //Note the new keyword.
    public new ICollection<string> Keys
    {
        get { throw new NotImplementedException(); }
    }

    public new IEnumerable<IFoo> Values
    {
        get { throw new NotImplementedException(); }
    }

    #endregion
} 
```

我仍然建议实施 IDictionary。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T14:14:15.367

您还可以使用显式接口实现。这样，如果有人通过使用接口 IMyDictionary 来引用 MyDictionary，他们将看到方法，而没有其他任何东西。我还建议改为实施 IDictionary。除非您想将使用限制为仅键和值。

```
public class MyDictionary : Dictionary<string, IFoo>, IMyDictionary
{
    ICollection<string> IMyDictionary.Keys
    {
        get { return Keys; }
    }

    IEnumerable<IFoo> IMyDictionary.Values
    {
        get { return Values; }
    }
} 
```

# sql - 如何从 ServerGrid.com 备份数据库？

> ID：328774
> 
> 赞同：1
> 
> 时间：2008-11-30T11:49:36.160
> 
> 标签：sql, sql-server, sql-server-2005, ssis, backup

我有一个 servergrid.com 的托管帐户。我想备份我的数据库，他们说我必须使用 Sql Server Integration Service 来备份数据库，我需要一个商业版的 Sql Server management studio。

我有 Sql Server 2005 开发人员版。我不知道如何进行 SSIS 备份。我尝试在 VS2005 中使用 Sql Server 集成服务项目 .. 但我失败了。

谷歌似乎也没有像我这样的非 DBA 的分步指南。

任何人都可以指点我/给我写一个关于如何使用 SSIS 备份数据库的分步说明吗？以及如果可能的话如何将数据库再次恢复到主机

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T05:16:15.080

SSIS 并不是真正的数据库备份工具。

如果您有固定数量的表，您可以将数据从 SQL Server**导出**到逗号分隔或原始文件 - 即使用 SSIS 进行数据导出。如果表数量很少，使用 SSIS 项目很容易创建这样的包。但是，如果您有很多表，那都是手动过程。此外，这可能很难自动化 - 每次添加/删除/更改表或列时，都必须重新生成用于导出数据的 SSIS 包。

SSIS 只做数据导出，所以你需要一个单独的工具来做元数据备份（表和存储过程定义）。您可以使用 Management Studio 导出元数据（只需脚本数据库到文本文件）。

可以将这两个工具一起称为穷人备份工具，但如果您的元数据经常更改，您可能希望使用真正的 SQL 备份工具。不知道为什么托管人员说您必须使用 SSIS - 也许他们不想给您备份权限以确保数据库安全，但 SSIS 并不是进行数据库备份的最简单方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T01:55:23.280

你在这台机器上有一个本地驱动器，对吗？

[通过他们的工具或sqlcmd](http://msdn.microsoft.com/en-us/library/ms162773.aspx)访问 sql 提示符。

将数据库 MYDB 备份到磁盘 = 'E:\backups\mydb.bak'

然后 FTP 该文件异地。

否则，忘记这些让您使用 SSIS 执行可以用一行文本完成的任务的毛骨悚然。

# javascript - 你推荐什么 javascript 库在网页上显示/弹出屏幕截图？

> ID：328786
> 
> 赞同：1
> 
> 时间：2008-11-30T12:03:50.357
> 
> 标签：javascript, screenshot

我在网上看到了一些不错的屏幕截图弹出窗口，你知道有什么图书馆可以做到这一点吗？我可以自己写，但是……如果有免费的东西，我可以节省时间。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T12:17:45.260

这是来自 Smashing Magazine 的一些 Javascript 库的集合[- 用于画廊、幻灯片和灯箱的 30 个脚本](http://www.smashingmagazine.com/2007/05/18/30-best-solutions-for-image-galleries-slideshows-lightboxes/)（我排除了基于 CSS 的，请参阅网站以获取完整列表）：

*   [JonDesign 的 SmoothGallery](http://smoothgallery.jondesign.net/showcase/gallery/)
*   [Pyxy画廊](http://fennecfoxen.org/pyxy/gallery)
*   [禅影](http://www.zenphoto.org/)
*   [Couloir.org：调整大小、淡化幻灯片演示 - AJAX 幻灯片](http://www.couloir.org/js_slideshow/)
*   [灰盒](http://orangoo.com/labs/GreyBox/)
*   [灯箱2](http://www.huddletogether.com/projects/lightbox2/#example)
*   [精简版](http://www.doknowevil.net/litebox/)
*   [多面灯箱](http://www.gregphoto.net/lightbox/)
*   [略厚盒](http://www.jasons-toolbox.com/SlightlyThickerBox/)
*   [旅行追踪器](http://slideshow.triptracker.net/)
*   [超薄盒](http://www.digitalia.be/software/slimbox)
*   [Suckerfish HoverLightbox](http://mondaybynoon.com/2006/03/27/suckerfish-hoverlightbox/)
*   [Suckerfish HoverLightbox Redux](http://mondaybynoon.com/2007/02/19/suckerfish-hoverlightbox-redux/)
*   [厚盒](http://jquery.com/demo/thickbox/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-30T12:12:42.680

听起来你想要一个灯箱。

jQuery 灯箱得到我的投票。

[http://leandrovieira.com/projects/jquery/lightbox/](http://leandrovieira.com/projects/jquery/lightbox/)

死的简单 - 我没有必要写例子，它都在网站上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T15:55:51.293

你没有说你想从哪个网站获得缩略图，或者有多少个缩略图。看看 Alexa 的服务：

[http://aws.amazon.com/ast/](http://aws.amazon.com/ast/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T16:51:07.673

[Dojo](http://dojotoolkit.org/)有两个：[Lightbox](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/image/tests/test_Lightbox.html)和[Lightbox Nano](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/image/tests/test_LightboxNano.html)（链接直接指向 nightlies，此服务器可能很慢）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-27T11:19:13.897

[Multibox](http://webscripts.softpedia.com/script/Multimedia/Multibox-44125.html)也颇受欢迎

# python - python curses.ascii 取决于语言环境？

> ID：328793
> 
> 赞同：0
> 
> 时间：2008-11-30T12:18:18.800
> 
> 标签：python, locale, ncurses

该`curses.ascii`模块定义了一些很好的函数，例如允许识别哪些字符是可打印的（`curses.ascii.isprint(ch)`）。

但是，根据使用的区域设置，可以打印不同的字符代码。例如，有某些波兰语字符：

```
>>> ord('a')
97
>>> ord('ą')
177
>>> 
```

我想知道，有没有更好的方法来判断一个数字是否代表可打印字符，然后是`curses.ascii`模块中使用的那个：

```
def isprint(c): return _ctoi(c) >= 32 and _ctoi(c) <= 126 
```

这是一种不友好的语言环境。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T12:31:09.460

如果将字符转换为 unicode，则可以使用 unicodedata：

```
>>> unicodedata.category(u'ą')[0] in 'LNPS'
True 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T05:11:46.040

好吧，它被称为 curses.ascii，所以使用 ASCII 规则来打印可打印的内容应该不足为奇。如果您使用 ISO 8 位代码，或者您从已知代码页进行操作，您将需要与实际代码及其显示内容相对应的规则。

我认为使用 unicode 字符和标准 Unicode 分类很好。这可能无法处理诅咒和控制台安排实际上将正确显示的内容。

还需要考虑应用程序可接受和不可接受的内容，即使是可显示的。

# algorithm - “经典算法”的真实世界实现

> ID：328799
> 
> 赞同：9
> 
> 时间：2008-11-30T12:21:30.463
> 
> 标签：algorithm, language-agnostic

我想知道你们中有多少人在**现实世界**而不是学术项目中实现了计算机科学的“**[经典算法](http://www.cs.virginia.edu/~luebke/cs332/)**”之一，例如[Dijkstra 的算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)或**数据结构**（例如二叉搜索树） ？

 **当有大量的库、框架和 API 为您提供相同的功能时，了解这些算法和数据结构对我们的日常工作有什么好处？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-30T12:38:51.020

> 当有大量的库、框架和 API 为您提供相同的功能时，了解这些算法和数据结构对我们的日常工作有什么好处？

该库不知道您的问题域是什么，也无法选择正确的算法来完成这项工作。这就是为什么我认为了解它们很重要：然后您可以正确选择算法来解决您的问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-30T13:00:57.980

*了解*您的工具，而不是简单地知道它们的存在是否有好处？

是的，当然有。举个简单的例子，你不认为了解 List（或您的语言的等效动态数组实现）和 LinkedList（或您的语言的等效项）有什么区别吗？知道一个具有恒定的随机访问时间，而另一个是线性的，这一点非常重要。如果在序列中间插入一个值，一个需要 N 个副本，而另一个可以在恒定时间内完成。

你不认为理解相同的排序算法并不总是最优的有好处吗？例如，对于几乎排序的数据，快速排序很糟糕？如果您不了解幕后发生的事情，那么天真地调用 Sort() 并希望获得最好的结果可能会变得非常昂贵。

当然，有很多算法你可能不需要，但即便如此，只要了解它们是如何工作的，你就可以更容易地想出有效的算法来解决其他不相关的问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-30T16:12:42.383

了解或能够理解这些算法很重要，这些是您交易的工具。这并不意味着您必须能够在一个小时内凭记忆实现 A*。但是您应该能够弄清楚使用红黑树与普通不平衡树相比有什么优势，因此*您*可以决定是否需要它。*您*需要能够判断算法是否适合解决您的问题。

这听起来可能太精通了，但这些“经典算法”并不是为了给大学生考试问题而发明的，它们是为了解决问题或改进当前解决方案而发明的，就像数组、链表或堆栈是构建块一样编写一个程序，其中一些也是如此。就像在数学中你从加减法转向积分和微分一样，这些都是先进的技术，可以帮助你解决存在的问题。

它们可能并不直接适用于您的问题或工作情况，但从长远来看，了解它们会帮助您成为一名专业的软件工程师。

为了回答你的问题，我最近为一个游戏做了一个 A* 的实现。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-30T12:37:38.543

好吧，必须有人编写库。在一家地图软件公司工作期间，我实现了 Dijkstra 以及二叉搜索树、b-tree、n-ary 树、bk-trees 和隐藏马尔可夫模型。

此外，如果您只想要一个“众所周知的”算法，并且如果它对性能变得至关重要，您还希望可以自由地对其进行专门化和优化，那么包含整个库似乎是一个糟糕的选择。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-30T12:38:43.487

在我以前的工作场所（一家[EDA](http://www.answers.com/topic/electronic-design-automation)公司）中，我们实现了 Prim 和 Dijsktra 算法的版本、不相交的集合数据结构、A* 搜索等等。所有这些都具有现实世界的意义。我相信这取决于问题领域——一些领域的算法密集程度更高，而一些领域则更少。

话虽如此，还有一条好路要走——我认为没有商业理由重新实现[STL](http://www.sgi.com/tech/stl/)或[Java Generics](http://www.javabeat.net/articles/33-generics-in-java-50-1.html)。在许多情况下，标准库比“发明轮子”要好。您越靠近核心应用程序，就越需要实现教科书式算法或数据结构。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-30T15:38:44.403

我们使用来自 Knuth SemiNumeric 的 p 随机数生成器的本地实现作为一些统计处理的辅助

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-30T13:13:19.530

如果您从不使用性能关键代码，请认为自己很幸运。但是，我认为这种情况是不现实的。性能问题可能发生在任何地方。然后有必要知道如何解决这个问题。显然，在这里仅仅知道几个算法名称是不够的——除非你想全部实现它们并一个接一个地尝试它们。

不，了解（至少部分）不同算法的内部工作原理对于衡量它们的优缺点以及分析它们将如何处理您的情况非常重要。

显然，如果有一个库已经实现了您所需要的，那么您将非常幸运。但让我们面对现实吧，即使有这样的库，使用它也往往不是完全简单的（至少，接口和数据表示经常需要适应），所以知道会发生什么仍然是件好事。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-30T13:24:18.557

A* 用于 pac man 克隆。我花了几个星期才真正得到，但直到今天我认为这是一件美丽的事情。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-30T13:35:25.807

我不得不从数值分析中实现一些经典算法。自己编写比连接到现有库更容易。此外，我不得不编写经典算法的变体，因为教科书案例不适合我的应用程序。

对于经典数据结构，我几乎总是使用标准库，例如 C++ 的 STL。最近有一次，当我认为 STL 没有我需要的结构（堆）时，我推出了自己的结构，但几乎立即有人指出我不需要这样做。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-30T21:45:30.620

我在实际工作中使用过的经典算法：

*   拓扑排序

*   一棵红黑树（尽管我承认我只需要为该应用程序实现插入，并且它只在原型中使用）。这用于在 Python 中实现“有序字典”类型结构。

*   优先队列

*   各种状态机

*   可能还有一两个我不记得了。

至于问题的第二部分：

对算法的工作原理、复杂性和语义的理解得到了相当定期的使用。它们还为系统设计提供信息。有时必须做一些涉及解析或协议处理或一些稍微聪明的计算的事情。了解算法的作用、它们的工作原理、它们的成本以及在库代码中可能会发现它们的位置，这对于了解如何避免糟糕地重新发明轮子大有帮助。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-09-17T04:27:24.167

经典算法通常与迷人的事物相关联，例如游戏、网络搜索或科学计算。但是，对于纯粹的企业应用程序，我不得不使用一些经典算法。

我正在构建一个元数据迁移工具，我必须使用拓扑排序来解决依赖关系，使用各种形式的图遍历来查询元数据，以及修改 Tarjan 的 union-find 数据结构的变体来将类似森林的结构化元数据划分为树。

那真是一次令人满意的经历。这些算法中的大多数都是以前实现的，但是它们的实现缺少我的任务所需的东西。这就是为什么了解他们的内部结构很重要。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-09-29T04:58:49.117

我使用[Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)算法来帮助实现“您的意思是*[建议词]*吗？” 功能在我们的网站搜索。

与我们的“标记”系统结合使用时效果非常好，它允许我们将额外的单词（除了标题/描述/等中的单词）与数据库中的项目相关联。\

它无论如何都不完美，但它比大多数公司网站搜索要好，如果我自己不这么说的话；)

# language-agnostic - 命名包含文件名的变量？

> ID：328806
> 
> 赞同：3
> 
> 时间：2008-11-30T12:27:55.193
> 
> 标签：language-agnostic, naming-conventions

如果我有一个包含文件的完全限定名称的变量（例如，项目文件），应该调用它`projectFile`，`projectFileName`还是`projectPath`？或者是其他东西？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T12:34:38.220

我通常会选择这些：

*   `FileName`仅用于文件名（无路径）
*   `FilePath`仅用于父路径（没有文件名）
*   `FileFullName`对于带路径的完全限定名称

我不认为有这样一个公认的标准。我取决于您（团队）的偏好以及您是否需要在特定情况下区分这三者。

编辑：我对这些特定命名约定的想法是：

*   直观地说，“名称”是一个字符串，“路径”（和“文件名”）也是
*   “名称”是相对的，除非它是“全名”
*   相关的变量名应该以相同的前缀（“File”+ ...）开头，我认为这提高了可读性
*   concretions/properties 是右分支的：“File”->“FileName”
*   特化是左分支：“FileName”->“ProjectFileName”（或“ProjectFileFullName”）
*   “文件”是表示物理对象的对象/句柄，因此“项目文件”不能是字符串

我不能总是坚持这些约定，但我会努力。如果我决定使用特定的命名模式，我会保持一致，即使这意味着我必须编写更具描述性（= 更长）的变量名称。代码的阅读次数多于编写次数，因此额外的少量输入不会让我感到太多困扰。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T13:31:38.230

System.IO.Path 似乎将文件的完全限定名称称为`path`，将文件本身的名称称为`filename`，并将其包含目录称为`directory`。如果您在 System.IO.Path 的上下文中使用，我建议在您的情况下`projectPath`最符合此命名法。然后我将文件的名称称为`fileName`并且它包含目录为`parentDirectory`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T12:35:38.327

您应该在它可能包含的文件之后为其命名，即：

```
system_configuration_file_URI
user_input_file_URI
document_template_file_URI 
```

“文件”或“文件名”在其他方面大多无用

此外，“文件”可能意味着“我是一个文件点”，这是不明确的，“文件名”没有说明它是否具有上下文（即：目录），fileURI 是上下文明确的，因为它说“这是一个资源标识符当观察到时，它指向一个资源（一个文件）“

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T12:41:10.393

我认为对此没有共识，只是尽量保持一致。

.NET Framework 中的示例：

*   FileStream(字符串路径...);

*   Assembly.LoadFrom（字符串程序集文件）

*   XmlDocument.Load（字符串文件名）

甚至文件名（文件名/文件名）的大小写在框架中也是不一致的，例如：

*   FileInfo.CopyTo(string destFileName)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T12:42:53.947

一些想法：

*   `projectFile`可能不是一个字符串——它可能是一个代表文件解析内容的对象。
*   `projectFileName`可能不完全合格。如果文件实际上是`"D:\Projects\MyFile.csproj"`，那么这可能会包含`"MyFile.csproj"`.
*   `projectPath`可能被认为是文件的完全限定路径，或者可能被认为是包含文件的父文件夹的名称。
*   `projectFolder`可能被认为包含父文件夹的名称，或者它实际上可能是代码中某种`Folder`抽象的实现。

.NET 有时用于`path`引用文件，有时使用`filename`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T13:27:51.717

请注意，“<a href="http://dictionary.reference.com/search?q=filename" rel="nofollow noreferrer">filename”是**一个**英文单词！标识符中间的“n”无需大写。

也就是说，我附加`Filename`到所有包含文件名的字符串变量。但是，我尽量避免这种情况，而是在支持某种文件和目录的语言中使用强类型变量。毕竟，这*就是*可扩展类型系统的用途。

在强类型语言中，通常不需要描述性后缀（尤其是在函数参数中），因为变量类型和用法会推断其内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T12:37:21.273

所有这些部分取决于方法的**大小**以及变量是否为类变量。

**如果它们是类变量或在大型复杂方法中，则遵循 Kent Fredric 的建议，并为它们命名一个**表明文件用途的名称，即“projectFileName”。

如果这是一个小型实用方法，例如删除文件，则不要将其命名为“projectFileName”。然后将其简称为“文件名”。

我*永远不会将*其命名为“路径”，因为这意味着它指的是它所在的*文件夹*。

**如果**没有其他变量，例如“fileID”或“filePtr” ，则将其称为“file”就可以了。

所以，我会使用“文件夹”或“路径”来识别文件所在的目录。

而“fileID”则代表一个文件对象。

最后，“文件名”是文件的实际名称。

快乐编码，
兰迪

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T13:18:34.577

基于上述选择的答案，它们的含义模棱两可，并且没有被广泛接受的名称，如果这是一个请求文件位置的 .NET 方法，那么在 XML 注释中指定您想要的内容，以及一个示例，如如果其他开发人员不确定您想要什么，他们可以参考。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-30T15:08:04.683

这取决于您的环境中使用的命名约定，例如在 Python 中，答案是`projectpath`由于[os.path](http://www.python.org/doc/2.5.2/lib/module-os.path.html)模块的命名约定。

```
>>> import os.path
>>> path = "/path/to/tmp.txt"
>>> os.path.abspath(path)
'c:\\path\\to\\tmp.txt'
>>> os.path.split(path)
('/path/to', 'tmp.txt')
>>> os.path.dirname(path)
'/path/to'
>>> os.path.basename(path)
'tmp.txt'
>>> os.path.splitext(_)
('tmp', '.txt') 
```

# visual-studio - 为什么我调试时 Visual Studio 会启动多个 WebDev？

> ID：328820
> 
> 赞同：10
> 
> 时间：2008-11-30T12:42:28.330
> 
> 标签：visual-studio, visual-studio-2008, debugging, cassini

我有一个 Visual Studio 2008 解决方案，其中包含多个项目——其中一些是 Web 应用程序/站点。

每当我为特定的 Web 应用程序“调试 > 启动新实例”并且 VS 为该应用程序启动 ASP.net 开发服务器 (WebDev.WebServer.EXE) 时，VS 还会启动 3 个额外的此类进程 - 一个用于其他 3 个 Web我在解决方案中的应用程序。

如何告诉 Visual Studio 只为我正在调试的一个项目启动 WebDev？我查看了项目配置和解决方案配置，但找不到相关设置...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T18:38:49.207

我尝试了上述解决方案，但没有奏效。我的解决方案是vs2005，我发现解决该项目的方法是使VS 2008的属性窗口可见。然后单击 Web 项目，然后将“调试时始终启动”属性设置为 false，这应该会处理好它:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T19:03:41.540

我认为它为每个端口运行一个-您可以尝试将它们设置为具有相同的端口-单击项目并查看属性窗格（您必须关闭自动端口生成然后设置端口#）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-29T18:44:07.630

在 Visual Studio 2008 中，项目的“属性”页面上有一个条目，名为“调试时始终启动”。

请注意，您必须通过选择项目并转到“属性”窗格（或右键单击“属性”）来完成此操作。当您双击项目并在主编辑窗格中打开它时，此选项不存在。

默认情况下，VS 会为您的所有 Web 项目将此值设置为 on。关闭它可以解决这个问题。

[社论]这很烦人，我希望默认值是假的！[/社论]

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-30T19:34:31.710

建议 - 不要使用内部 WebDev，而是使用 IIS。也减少了系统托盘中的混乱。;)

# java - 如何使用 XStream 忽略类型？

> ID：328823
> 
> 赞同：2
> 
> 时间：2008-11-30T12:46:15.500
> 
> 标签：java, serialization, xstream

使用[XStream](http://x-stream.github.io/)，如何忽略已定义类型的序列化（例如，在序列化 GUI 时，我想忽略所有摆动类型）？

或者如果我想忽略所有 javax.* 类型？

提前致谢，
伯克哈德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T15:28:47.747

您需要为要忽略的类型编写自定义转换器。

例如，如果您想忽略 JLabels：

```
public class MyJLabelConverter implements Converter {

    @Override
    public void marshal(Object value, HierarchicalStreamWriter writer, MarshallingContext context) {
    }

    @Override
    public Object unmarshal(HierarchicalStreamReader reader, UnmarshallingContext context) {
        return null;
    }

    @Override
    public boolean canConvert(Class clazz) {
        return clazz.equals(JLabel.class);
    }
} 
```

并注册：

```
xstream.registerConverter(new MyJLabelConverter()); 
```

# java - 从 Java 访问 Windows Mobile 设备存储卡？

> ID：328824
> 
> 赞同：3
> 
> 时间：2008-11-30T12:46:21.660
> 
> 标签：java, windows-mobile

我希望能够访问 Windows Mobile 设备中存储卡的内容。通常，我只是将卡取出并将其推入读卡器，但它是加密的（因此，锁定到我的 WM 设备）。

是否有 API 或某种框架允许对存储卡进行读/写访问（当 PDA 连接到 PC 时）？

原因是：我厌倦了每次上传到每张专辑时都必须为每张专辑创建播放列表。我想自动化这个过程。

任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T13:43:42.730

当 PDA 连接到 PC 时，您可以使用[RAPI](http://msdn.microsoft.com/en-us/library/aa458022.aspx)访问 Windows Mobile 设备上的文件、注册表等，但我不知道它的 Java 接口。不过应该是 JNI 的小菜一碟... :-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T14:10:36.467

RAPI（Remote API）用于从桌面访问WM设备，可用于访问文件。请参阅[RAPI](http://msdn.microsoft.com/en-us/library/aa458022.aspx)和[CeCreateFile](http://msdn.microsoft.com/en-us/library/aa458360.aspx)或[有关 RAPI 的本教程](http://etutorials.org/Programming/Pocket+pc+network+programming/Chapter+9.+Desktop+Synchronization/Remote+API+RAPI/)。
您可以通过“\Storage Card\”路径将其指向存储卡上的文件。

但是，正如您所注意到的，这是一个 C++ API……不幸的是，我不知道有任何用于 Java 的 RAPI 包装器。

# c# - 字典 与字典

> ID：328830
> 
> 赞同：12
> 
> 时间：2008-11-30T12:59:47.123
> 
> 标签：c#, generics, collections

在这里使用 IDictionary 有什么价值？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-30T13:07:25.533

使用接口的价值始终相同：切换到另一个后端实现时，您不必更改客户端代码。

考虑到稍后分析您的代码表明哈希表实现（在`Dictionary`类中使用）不适合您的任务，并且二叉搜索树的性能会更好。如果您已经编码到一个接口，那么切换实现很简单。但是，如果您使用了具体类，则必须在更多地方更改更多代码。=> 这需要时间和金钱。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-30T13:12:23.713

IDictionary 可以实现更松散的耦合。

假设您有这样的方法：

```
void DoSomething(IDictionary<string, string> d)
{
   //...
} 
```

你可以像这样使用它：

```
Dictionary<string, string> a = new Dictionary<string, string>();
SortedDictionary<string, string> b = new SortedDictionary<string, string>();
DoSomething(a);
DoSomething(b); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T13:18:11.457

根据您之前的问题[Class inherits generic`dictionary<string, IFoo>`和 Interface](https://stackoverflow.com/questions/328772/class-inherits-generic-dictionarystring-ifoo-and-interface)以及答案中的讨论，我猜您询问更多关于继承而不是使用的问题。

如果您对字典的实现方式感到满意，那么从字典实现就可以了。如果你想改变一些东西，那么实施 IDictionary 会更好。

恕我直言，如果您要用“新”覆盖现有成员，那么最好实现接口而不是从原始类继承。

# hibernate - 使用 XStream 序列化 Hibernate 对象的问题

> ID：328832
> 
> 赞同：5
> 
> 时间：2008-11-30T13:01:21.660
> 
> 标签：hibernate, xstream

我一直面临这个问题，序列化的休眠对象会产生意外的 xml，其中包含来自 Hibernate 的所有检测代码。

在序列化对象之前，我们对对象进行了一些清理。

但是，是否有可用于直接序列化对象的标准选项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T19:27:23.863

我以前没有使用过 XStream，但是我已经序列化了 Hibernate 管理的实体。这不好玩。

有两个大问题：

*   延迟加载；
*   一对多关系。

前者很明显 - 您需要实际数据进行序列化。后者不那么重要 - 您针对集合接口（例如：）声明的任何一对多关系都`Set<T>`将被 Hibernate 自己的（不可序列化！）集合实现插入。这很可能是 Hibernate 的类渗入您的对象的地方。

我最终编写了执行此操作的反射代码（实际上是内省的）：

1.  在会话打开的情况下，触摸整个对象图以强制加载任何未加载的实体；
2.  关闭 Hibernate 会话（包括任何涉及其连接的事务）；
3.  遍历对象图，用 ArrayList、HashSet 或 HashMap（已知可序列化集合）的实例替换任何列表、集合或映射。

请注意，第 2 步很重要 - 如果您在关闭会话之前替换集合，Hibernate 只会在关闭时将其自己的集合放回...

**编辑：** @cliff.meyers 发现了一个我忘记提及的实现细节：如果你这样做，你需要将对象图限制在你自己的实体上，并注意循环引用路径（例如：通过缓存对你的对象的引用'已经走了）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-16T18:25:26.457

我想出了一些足够的解决方案。在我的应用程序中，只有 PersistentSets 会弄乱 XStream 生成的 XML。所以我向 XStream 添加了另一个转换器（它与打开的 Hibernate Session 和活动对象一起运行）：

```
XStream xs = new XStream();
xs.registerConverter(new CollectionConverter(xs.getMapper()) {
    @Override
    public void marshal(Object source, HierarchicalStreamWriter writer, MarshallingContext context) {
        org.hibernate.collection.PersistentSet ps = (PersistentSet) source;
        super.marshal(new HashSet(ps), writer, context);
    }

    @Override
    public boolean canConvert(Class type) {
        return type.isAssignableFrom(org.hibernate.collection.PersistentSet.class);
    }
}, XStream.PRIORITY_VERY_HIGH);
String s = xs.toXML(processInstance); 
```

序列化的 XML 如下所示：

```
 <processLogs class="org.hibernate.collection.PersistentSet">
    <pl.net.bluesoft.rnd.processtool.model.ProcessInstanceLog>
      <id>813017</id>
      <entryDate>
        <time>1310832421216</time>
        <timezone>GMT</timezone>
      </entryDate>
      <eventI18NKey>process.log.action-performed</eventI18NKey>
      <additionalInfo>Wydrukuj wniosek</additionalInfo>
      <logValue>GENERATE_APPLICATION</logValue>
      <logType>PERFORM_ACTION</logType>
      <state reference="../../../definition/states/pl.net.bluesoft.rnd.processtool.model.config.ProcessStateConfiguration[8]"/>
      <processInstance reference="../../.."/>
      <user reference="../../../creator"/>
    </pl.net.bluesoft.rnd.processtool.model.ProcessInstanceLog>
    <pl.net.bluesoft.rnd.processtool.model.ProcessInstanceLog>
      <id>808211</id>
      <entryDate>
        <time>1310828206169</time>
        <timezone>GMT</timezone>
      </entryDate>
      <eventI18NKey>process.log.action-performed</eventI18NKey>
      <additionalInfo>Zaakceptuj</additionalInfo>
      <logValue>ACCEPT</logValue>
      <logType>PERFORM_ACTION</logType>
      <state reference="../../../definition/states/pl.net.bluesoft.rnd.processtool.model.config.ProcessStateConfiguration[4]"/>
      <processInstance reference="../../.."/>
      <user reference="../../../creator"/>
    </pl.net.bluesoft.rnd.processtool.model.ProcessInstanceLog> 
```

在我的例子中，class 属性并不重要，所以我忽略了它的值。你当然可以修补它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-29T19:57:44.367

XStream 现在提供了一个单独的模块/jar 来处理 Hibernate 集合。[有关示例，](http://xstream.codehaus.org/faq.html#Serialization_Hibernate)请参阅XStream 的常见问题解答。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-26T02:10:05.127

尽管我没有使用休眠，但我遇到了类似的问题。我查看了实体修剪器，但它并不是我想要的，因为我正在寻找更简单的解决方案。

我想出了一个非常简单的解决方案，它使用反射来代理 CGLIB 增强对象，就像一个魅力。

请访问[http://www.anzaan.com/2010/06/serializing-cglib-enhanced-proxy-into-json-using-xstream/](http://www.anzaan.com/2010/06/serializing-cglib-enhanced-proxy-into-json-using-xstream/)示例和代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T19:50:06.877

Codehaus JIRA 上有一些关于此（和示例代码）的信息：

[http://jira.codehaus.org/browse/XSTR-226](http://jira.codehaus.org/browse/XSTR-226)

我们为许多其他远程实现（Axis 1、Blaze DS 等）编写了一些工具来解决此类问题。我们所做的与 Dan 的解决方案非常相似，尽管我们添加了声明哪些对象路径要走以及哪些要“剪断”的功能，因为在许多情况下我们对所有数据都不感兴趣；它还会导致“n+1 选择”问题发生数千次的严重问题！:) 我认为实现 XStream 转换器将是最佳方法，因为您只需遍历对象图一次。如果您在 Session 上设置 FlushMode.MANUAL ，您还应该能够随时修改对象图，而 Hibernate 不会做任何讨厌的事情。谨慎使用它，因为它是一种先进的技术。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-22T07:50:39.000

没有使用它，但[xstream-for-beans](http://code.google.com/p/xstream-for-beans/)似乎适合（引用）：

> 该项目提供了在以下方面增强 XStream 的映射器和转换器的实现：
> 
> 1.  序列化对象，因为它们被 getter 和 setter 公开。可用于字段的 XStream 功能应适用于为 getter/setter 属性定义的属性。
> 2.  清理托管对象的序列化：自动省略不相关的字段和类信息。
> 3.  处理“离线”字段和代理对象。

`Converter`不幸的是，作为闭源项目的一部分，我编写了一次自定义 XStream来处理这个问题。xstream-for-beans 处理相同的问题，非常值得一试。

我过去成功地使用了 Terracotta 的[Pojoizer](http://forge.terracotta.org/releases/projects/pojoizer/)实用程序，但我认为它不再被维护了。

# c++ - C++：删除与免费和性能

> ID：328834
> 
> 赞同：34
> 
> 时间：2008-11-30T13:06:00.327
> 
> 标签：c++, pointers, performance

1.  考虑：

    ```
    char *p=NULL;
    free(p) // or
    delete p; 
    ```

    如果我使用`free`and `delete`on会发生什么`p`？

2.  如果一个程序需要很长时间执行，比如 10 分钟，有没有办法将其运行时间减少到 5 分钟？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-30T18:03:12.193

关于 new/delete 和 malloc/free 的一些性能说明：

malloc 和 free**不**分别调用构造函数和解构函数。这意味着您的类不会自动初始化或取消初始化，这可能很糟糕（例如未初始化的指针）！不过，这对于像 char 和 double 这样的 POD 数据类型无关紧要，因为它们实际上并没有 ctor。

new 和 delete**确实**调用了构造函数和解构函数。这意味着您的类实例会自动初始化和取消初始化。但是，通常会影响性能（与普通分配相比），但这是为了更好。

我建议与 new/malloc 的用法保持一致，除非你有理由（例如 realloc）。这样，您的依赖项就会减少，从而减少您的代码大小和加载时间（尽管只有一点点）。此外，您不会因为释放分配给 new 的东西或删除分配给 malloc 的东西而搞砸。（这很可能会导致崩溃！）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-30T13:13:57.347

答案 1：两者都`free(p)`可以`delete p`使用 NULL 指针正常工作。

答案 2：没有看到代码的慢部分就无法回答。您应该分析代码！如果您使用的是 Linux，我建议使用 Callgrind（[Valgrind](http://valgrind.org/)的一部分）来找出执行的哪些部分花费的时间最多。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-30T14:40:08.950

问题一：什么都不会发生。

从 ISO/IEC 14882（或：C++）的当前草案：

> ## 20.8.15 C 库 [c.malloc]
> 
> [of 的内容`<cstdlib>`，即：where `free`lives,] 与标准 C 库 [(参见 intro.refs 的内容)] header 相同`<stdlib.h>`，但有以下更改：[没有影响这个答案]。

因此，根据 ISO/IEC 9899:1999（或：C）：

> ## 7.20.3.2`free`功能
> 
> 如果 [the] `ptr`[parameter] 是空指针，则**不会发生任何操作**。

再次来自 C++ 标准，有关`delete`此时间的信息：

> ## 3.7.4.2 释放函数 [basic.stc.dynamic.deallocation]
> 
> 提供给释放函数的第一个参数的值可以是空指针值；如果是这样，并且如果释放函数是标准库中提供的函数，**则调用无效**。

也可以看看：

*   [`new`/`delete`和`malloc`/和有什么不一样`free`？](https://stackoverflow.com/questions/240212/what-is-the-difference-between-newdelete-and-mallocfree)
*   [当你尝试在 c 中`free()`已经`free`d 内存时会发生什么？](https://stackoverflow.com/questions/135474/what-happens-when-you-try-to-free-already-freed-memory-in-c)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-30T14:27:22.237

如果您使用 NULL 参数调用 free 或使用 NULL 操作数删除，则不会发生任何事情。两者都被定义为接受 NULL 并且不执行任何操作。

您可以在 C++ 代码中更改任何数量的东西，这会影响它的运行速度。通常最有用的（按大致顺序）是：

*   使用好的算法。这是一个很大的话题，但是例如，我最近通过使用 std::vector 而不是 std::list 将一些代码的运行时间减半，以防元素仅在最后添加和删除.
*   避免重复冗长的计算。
*   避免不必要地创建和复制对象（但是每分钟发生少于 1000 万次的任何事情都不会产生任何显着差异，除非您正在处理*非常大*的东西，例如包含 1000 万个项目的向量）。
*   编译优化。
*   将常用函数（同样，在 10 分钟运行时调用超过 1 亿次的任何函数）标记为内联。

话虽如此，分而治之是绝对正确的——除非你知道它花时间做什么，否则你无法有效地加速你的程序。有时，当您知道代码是如何工作的时，可以正确猜到这一点，而其他时候则非常令人惊讶。所以最好是剖析。即使您无法分析代码以准确查看时间花费的位置，但如果您衡量您的更改有什么影响，您通常最终可以弄清楚。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T14:35:32.220

关于问题 2：
以前的答案非常好。但我只是想添加一些关于预优化的内容。假设一个中等复杂度的程序，90/10 规则通常适用——即 90% 的执行时间花在 10% 的代码上。“优化”的代码通常更难阅读和维护。所以，总是先解决问题，然后看看瓶颈在哪里（分析是一个很好的工具）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-30T17:30:50.043

正如其他人指出的那样，删除（或释放）NULL 指针不会做任何事情。但是，如果您分配了一些内存，那么是使用 free() 还是 delete 取决于您用于分配它们的方法。例如，如果你使用 malloc() 来分配内存，那么你应该使用 free()，如果你使用 new 来分配，那么你应该使用 delete。但是，请注意不要混合内存分配。使用单一方式分配和解除分配它们。

对于第二个问题，如果不看实际代码，很难一概而论。应根据具体情况进行处理。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-30T22:41:35.187

很好的答案。

在性能问题上，[这](https://stackoverflow.com/questions/266373/one-could-use-a-profiler-but-why-not-just-halt-the-program)提供了一种大多数人无法想象的方法，但少数人知道它确实有效，而且效果非常好。

90/10 规则是正确的。根据我的经验，通常有多个问题点，它们通常位于调用堆栈的中层。它们通常是由使用过度通用的数据结构引起的，但是除非您已经证明它确实是一个问题，否则您永远不应该修复某些东西。性能问题令人惊讶地无法预测。

修复任何单个性能问题可能无法为您提供所需的加速，但是您修复的每个问题都会使其余问题占用更大百分比的剩余时间，因此它们变得更容易找到。加速以复合方式组合在一起，因此您可能会对最终结果感到惊讶。

当您再也找不到可以解决的重大问题时，您已经尽了最大努力。有时，到那时，重新设计（例如使用代码生成）可以引发进一步的加速。

# sql - 同步数据库

> ID：328850
> 
> 赞同：2
> 
> 时间：2008-11-30T13:22:59.450
> 
> 标签：sql, mysql, sqlite, synchronization, air

我正在开发一个 Adob​​e AIR 应用程序，它使用 SQLite 数据库在本地存储数据。在任何时候，我都希望最终用户将他/她的本地数据同步到中央 MySQL 数据库。

有什么提示和建议可以正确解决这个问题吗？性能和稳定性是关键（除了安全性；））

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T03:12:40.173

If you're just sync'ing from the server to client, Eran's solution should work.

If you're just sync'ing from the client to the server, just reverse it.

If you're sync'ing both ways, have fun. You'll at minimum probably want to keep change logs, and you'll need to figure out how to deal with conflicts.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T14:59:00.597

我可以想到几种方法：

1.  定期转储您的 MySQL 数据库并从转储中创建一个新的 SQLite 数据库。然后，您可以为您的用户客户端提供 SQLite 数据库（SQLite 数据库包含在单个文件中）以下载和替换当前数据库。

2.  创建一个 diff 脚本，生成必要的语句以使当前数据库加速（各种 INSERT、UPDATE 和 DELETE 语句）。为此，您必须在数据库中连续记录每次更改的时间（每行的创建和更新时间，并保留已删除行的历史记录）。用户的客户端将下载差异文件（各种语句的文本文件）并将其应用于本地数据库。

这两种方法各有优缺点 - 通过转储整个数据库，您可以确保所有数据都通过。它也比创建差异更容易，但是它可能会给服务器带来更多负载，具体取决于数据库在转储之间更新的频率。

另一方面，数据库之间的差异只会为您提供更改的数据（希望如此），但它更容易出现逻辑错误。它也会给客户端带来额外的开销，因为它必须创建/更新所有必要的记录，而不仅仅是复制文件。

# python - 打印一个类的所有实例

> ID：328851
> 
> 赞同：76
> 
> 时间：2008-11-30T13:23:48.607
> 
> 标签：python, class

使用 Python 中的类，如何定义一个函数，以函数中定义的格式打印该类的每个实例？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-11-30T13:56:48.977

在这种情况下，我看到两个选项：

## 垃圾收集器

```
import gc
for obj in gc.get_objects():
    if isinstance(obj, some_class):
        dome_something(obj) 
```

当您有很多对象时，这具有非常慢的缺点，但适用于您无法控制的类型。

## 使用 mixin 和 weakrefs

```
from collections import defaultdict
import weakref

class KeepRefs(object):
    __refs__ = defaultdict(list)
    def __init__(self):
        self.__refs__[self.__class__].append(weakref.ref(self))

    @classmethod
    def get_instances(cls):
        for inst_ref in cls.__refs__[cls]:
            inst = inst_ref()
            if inst is not None:
                yield inst

class X(KeepRefs):
    def __init__(self, name):
        super(X, self).__init__()
        self.name = name

x = X("x")
y = X("y")
for r in X.get_instances():
    print r.name
del y
for r in X.get_instances():
    print r.name 
```

在这种情况下，所有引用都作为弱引用存储在列表中。如果你经常创建和删除很多实例，你应该在迭代后清理弱引用列表，否则会有很多垃圾。

这种情况下的另一个问题是您必须确保调用基类构造函数。您也可以 override `__new__`，但只有`__new__`第一个基类的方法用于实例化。这也仅适用于您控制的类型。

**编辑**：根据特定格式打印所有实例的方法留作练习，但它基本上只是`for`-loops 的一种变体。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-02-27T04:26:56.530

您需要在您的类上创建一个静态列表，并`weakref`为每个实例添加一个，以便垃圾收集器可以在不再需要它们时清理您的实例。

```
import weakref

class A:
    instances = []
    def __init__(self, name=None):
        self.__class__.instances.append(weakref.proxy(self))
        self.name = name

a1 = A('a1')
a2 = A('a2')
a3 = A('a3')
a4 = A('a4')

for instance in A.instances:
    print(instance.name) 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2019-07-02T09:13:17.643

你不需要导入任何东西！只需使用“自我”。这是你如何做到这一点

```
class A:
    instances = []
    def __init__(self):
        self.__class__.instances.append(self)
print('\n'.join(A.instances)) #this line was suggested by @anvelascos 
```

就是这么简单。没有导入模块或库

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-04-27T13:56:14.643

非常好的和有用的代码，但它有一个大问题：**列表总是更大**而且它永远不会被清理，测试它只需在方法`print(len(cls.__refs__[cls]))`的末尾添加`get_instances`。

这是该方法的修复`get_instances`：

```
__refs__ = defaultdict(list)

@classmethod
def get_instances(cls):
    refs = []
    for ref in cls.__refs__[cls]:
        instance = ref()
        if instance is not None:
            refs.append(ref)
            yield instance
    # print(len(refs))
    cls.__refs__[cls] = refs 
```

或者也可以使用 Wea​​kSet 来完成：

```
from weakref import WeakSet

__refs__ = defaultdict(WeakSet)

@classmethod
def get_instances(cls):
    return cls.__refs__[cls] 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-30T13:29:49.373

与几乎所有其他 OO 语言一样，将类的所有实例保存在某种集合中。

你可以试试这种东西。

```
class MyClassFactory( object ):
    theWholeList= []
    def __call__( self, *args, **kw ):
         x= MyClass( *args, **kw )
         self.theWholeList.append( x )
         return x 
```

现在你可以这样做了。

```
object= MyClassFactory( args, ... )
print MyClassFactory.theWholeList 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-30T13:57:28.630

Python 没有与 Smallktalk 的 #allInstances 等效的工具，因为该架构没有这种类型的中央对象表（尽管现代的 smalltalks 也不是真的那样工作）。

正如另一张海报所说，您必须明确管理一个集合。他对维护注册表的工厂方法的建议是一种完全合理的方法。您可能希望使用[弱引用](http://www.python.org/doc/2.5.2/lib/module-weakref.html)做一些事情，这样您就不必显式跟踪对象处置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-30T20:55:27.413

目前尚不清楚您是否需要一次打印所有类实例或在它们被初始化时打印，也不清楚您是否在谈论您可以控制的类与 3rd 方库中的类。

无论如何，我会通过使用 Python 元类支持编写一个类工厂来解决这个问题。如果您无法控制课程，请手动更新`__metaclass__`您正在跟踪的课程或模块。

有关更多信息，请参阅[http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html](http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-09-07T13:04:23.963

在我的项目中，我遇到了类似的问题，并找到了一个简单的解决方案，它也可能适用于您列出和打印您的类实例。该解决方案在 Python 3.7 版本中运行良好；在 Python 3.5 版中给出了部分错误。

我将从我最近的项目中复制粘贴相关的代码块。

```
```
instances = [] 

class WorkCalendar:
    def __init__(self, day, patient, worker):
        self.day = day
        self.patient = patient
        self.worker= worker
    def __str__(self):
        return f'{self.day} : {self.patient} : {self.worker}' 
```

在 Python`__str__`中，最后的方法决定了如何以字符串形式解释对象。我`:`在大括号之间添加了中间，它们完全是我对“Pandas DataFrame”类型阅读的偏好。如果你应用这个小`__str__` 函数，你将看不到一些机器可读的对象类型描述——这对人眼来说毫无意义。添加此`__str__` 功能后，您可以将对象附加到列表中并根据需要打印它们。

```
appointment= WorkCalendar("01.10.2020", "Jane", "John")
instances.append(appointment) 
```

对于打印，您的格式`__str__`将默认使用。但也可以分别调用所有属性：

```
for instance in instances:
    print(instance)
    print(instance.worker)
    print(instance.patient) 
```

详细阅读可以看源码：[https ://dbader.org/blog/python-repr-vs-str](https://dbader.org/blog/python-repr-vs-str)

# nant - nant logs with data and time stamp

> ID：328857
> 
> 赞同：7
> 
> 时间：2008-11-30T13:30:48.200
> 
> 标签：nant

How to run NAnt scripts in command line and get the timings of each task on the log file?

```
using nant <record> task or 
NAnt -buildfile:testscript.build testnanttarget 
```

This produces console output but I can't see any timing information.

All I want each log message prefixed with datatime.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-30T18:29:55.773

You can use the [tstamp task](http://nant.sourceforge.net/release/0.85-rc3/help/tasks/tstamp.html) to display the current date/time. Just include it everywhere where you want timing information. It will not prefix each line with a timestamp, but at least you can time some strategic points.

```
<tstamp /> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-07-06T15:56:12.870

Here is a sample of tstamp

```
 <echo>
    -----------------------------------------------------------------------------------------------------------------
    -----------------------------------------------------------------------------------------------------------------
    TASK : INITIALIZE
    -----------------------------------------------------------------------------------------------------------------
    -----------------------------------------------------------------------------------------------------------------
    </echo>

    <loadtasks assembly="nantcontrib-0.85/bin/NAnt.Contrib.Tasks.dll" />     
    <!-- http://www.basilv.com/psd/blog/2007/how-to-add-logging-to-ant-builds -->
    <tstamp>            
        <formatter property="timestamp" pattern="yyMMdd_HHmm"/>
    </tstamp>   

    <property name="build.log.filename" value="build_${timestamp}.log"/>

    <echo message="build.log.filename: ${build.log.filename}" />

    <record name="${build.log.dir}/${build.log.filename}"   action="Start" level="Verbose"/>        

    <echo message="Build logged to ${build.log.filename}"/>

    <echo message="Build Start at: ${datetime::now()}" />

</target> 
```

# .net - LinqToSql 和 DataContext 101

> ID：328877
> 
> 赞同：1
> 
> 时间：2008-11-30T13:47:37.527
> 
> 标签：.net, linq-to-sql

我正在寻找一篇或两篇很好的文章，或者只是一个解释，关于 LinqToSql 的 DataContext 或 dbml 文件如何在 LinqToSql 中准确工作。

*   这是一个断开连接的环境吗？
*   数据库连接是否仍由 Sql Server 池化？
*   如果我创建了我的 DataContext 的实例，我是否有责任处置它？
*   它如何处理多用户环境，当我的应用程序创建一个新的 DataContext 对象时，每个线程是否都有自己的 DataContext？

还有一堆其他问题以及一些最佳实践！

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T14:21:25.260

MSDN 上的[DataContext 常见问题解答](http://msdn.microsoft.com/en-us/library/bb386929.aspx)

[Rick Strahl](http://www.west-wind.com/weblog/posts/246222.aspx)关于 DataContext Lifetime 的文章

MSDN上的[LINQ](http://msdn.microsoft.com/en-us/library/bb397926.aspx)基础站点。

MSDN 上的[LINQ 项目](http://msdn.microsoft.com/en-us/netframework/aa904594.aspx)。

[LINQ 项目](http://forums.microsoft.com/msdn/showforum.aspx?siteid=1&forumid=123)论坛

[DataContext 类说明](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.aspx)

# javascript - 在 iframe 中禁用 JavaScript 按键事件

> ID：328887
> 
> 赞同：2
> 
> 时间：2008-11-30T14:07:49.250
> 
> 标签：javascript, events

如何在 iframe 中禁用对 JavaScript 按键事件的支持？

我只需要在特定的 iframe 中禁用按键事件，因此不能选择“捕获所有事件并制作 em-do-nothing”解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T14:22:24.073

这个[例子](http://home.arcor.de/martin.honnen/javascript/200503/test2005031201.html)做你想要的吗？

根据这个[线程](http://bytes.com/groups/javascript/151221-capturing-keypress-designmode-iframe-possible)，大致如下：

```
document.getElementById('edit').contentWindow.addEventListener('keypress', cK, true); 
```

有助于在给定的 iframe 中捕获按键。如果可以捕获它们，则可以禁用它们。

[警告：正如Alllain Lalonde](https://stackoverflow.com/users/2443/allain-lalonde)在评论中指出的那样：

> 如果 iframe 的内容不是来自另一个域，这将起作用。

# c# - 在 C# 中为对象实现审计跟踪？

> ID：328898
> 
> 赞同：8
> 
> 时间：2008-11-30T14:23:18.487
> 
> 标签：c#, object, audit, trail

我正在寻找有关如何在 C# 中为我的对象实施审计跟踪的想法，对于当前项目，基本上我需要：

1.存储给定对象的旧值和新值。2.记录新对象的创建。3.删除旧对象。

是否有任何通用的方法来执行此操作，例如使用 C# 泛型，这样我就不必为基础对象的事件编写代码，例如创建、删除等（ORM 对象）。问题是，如果有一种注入审计跟踪的方法，如果有人正在使用。任何人都有任何经验或他们遵循的任何方法。以面向方面 (AOP) 方式执行此操作的任何方法。

请分享您的想法等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-11T10:19:34.860

您可以实现与 INotifyPropertyChanged 类似的东西，但略有不同。我已经提取了大部分 INotifyPropertyChanged 并将其更改为通用并存储新旧值。然后，您可以拥有某种可以收听此内容的管理类，并且 onSaving 和 onDeleting 您可以处理这些更改。

```
public interface INotifyProperyChanged<T>
{
   event PropertyChangedEventHandler<T> PropertyChanged;
}

    public delegate void PropertyChangedEventHandler<T>(object sender,   
PropertyChangedEventArgs<T> e);

public class PropertyChangedEventArgs<T> : EventArgs
{
    private readonly string propertyName;

    public PropertyChangedEventArgs(string propertyName)
    {
        this.propertyName = propertyName
    }

    public virtual string PropertyName { get { return propertyName; } }

    public T OldValue { get; set; }
    public T NewValue { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T14:28:08.040

问题非常类似于您 [如何为您的对象实施审计跟踪（编程）？](https://stackoverflow.com/questions/148291/how-do-you-implement-audit-trail-for-your-objects-programming)

我们使用 AOP（aspectJ 实现）实现了类似的解决方案。使用这个特定的点可以被捕获并且可以执行特定的操作。

这可以在我们喜欢的时候插入和关闭。

然而，我们的实现是在 J2EE..

如果您真的想在应用程序层中执行此操作，我建议您这样做。

希望能帮助到你..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T16:17:49.423

除了上面线程中提到的一些事情之外，[命令模式](http://en.wikipedia.org/wiki/Command_pattern)可能会有所帮助，如果您将对象上的所有状态更改包装在命令中，那么命令可以负责保持审计跟踪，而对象则不会不得不担心审计本身。当然，创建和处理命令会增加开销。

您可以将命令包装在任何现有的对象结构周围，您只需将操作委托给命令层，而不是直接在对象上执行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T01:37:02.120

您是否考虑过使用简单的通知模式？您可以让服务层引发诸如 NewObject、ChangedObject、DeletedObject 之类的事件，这些事件将被通用服务层监听，然后可以获取对象并保存结果。

如果要保存对象的状态，可以利用 Xml 序列化。

如果您使用 SQL Server 2008，则可以使用另一种方法，您可以实现新的审核功能，这将允许您审核对数据库记录的更改，您甚至可以在读取数据时跟踪（我认为）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-07T22:57:45.363

很老的问题，但对于那些想要审计 C# 对象的人，我会推荐[Audit.NET](https://github.com/thepirat000/Audit.NET)库。

它具有日志到不同存储系统（SQL、Azure、Mongo）和审计不同系统（WCF、EF、MVC）的扩展。

注：我是楼主

# silverlight - Silverlight 2.0 - 将域对象数据绑定到 UserControl

> ID：328906
> 
> 赞同：3
> 
> 时间：2008-11-30T14:37:47.910
> 
> 标签：silverlight, data-binding, xaml

我从 Silverlight 开始。我想在 UI 上显示消息列表，但数据绑定对我不起作用。

我有一个消息类：

```
public class Message 
{
    public string Text { get; set; } 
    ...
} 
```

我有带有消息依赖属性的消息显示 Silverlight 用户控件：

```
public partial class MessageDisplay : UserControl
{
    public static readonly DependencyProperty MessageProperty =
        DependencyProperty.Register("Message", typeof(Message),
           typeof(MessageDisplay), null);

    public MessageDisplay()
    {
        InitializeComponent();
    }

    public Message Message
    {
        get
        {
            return (Message)this.GetValue(MessageProperty);
        }

        set
        {
            this.SetValue(MessageProperty, value);
            this.DisplayMessage(value);
        }
    }

    private void DisplayMessage(Message message)
    {
        if (message == null)
        {
            this.MessageDisplayText.Text = string.Empty;
        }
        else
        {
            this.MessageDisplayText.Text = message.Text;                
        }
    }
} 
```

}

然后在主控件xaml中我有

```
 <ListBox x:Name="MessagesList" Style="{StaticResource MessagesListBoxStyle}">
        <ListBox.ItemTemplate>
            <DataTemplate>
                <Silverbox:MessageDisplay Message="{Binding}"></Silverbox:MessageDisplay>
            </DataTemplate>
        </ListBox.ItemTemplate>
    </ListBox 
```

我在 control.xaml.cs 代码中绑定：

```
 this.MessagesList.SelectedIndex = -1;
    this.MessagesList.ItemsSource = this.messages; 
```

数据绑定没有给出错误，而且列表中的项目数似乎是正确的，但是永远不会命中 MessageDisplay 的 Message 属性设置器中的断点，并且永远不会正确显示消息。

我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T16:12:57.063

您的 Message 属性可能是由绕过您的实际 Message 属性（而不是依赖项）的数据绑定设置的。要解决此问题，请在该属性上添加 PropertyChangedCallback。

```
public static readonly DependencyProperty MessageProperty = 
  DependencyProperty.Register("Message", typeof(Message), typeof(MessageDisplay), 
  new PropertyMetadata(
    new PropertyChangedCallback(MessageDisplay.MessagePropertyChanged));

public static void MessagePropertyChanged(DependencyObject obj, DependecyPropertyChangedEventArgs e)
{
   ((MessageDisplay)obj).Message = (Message)e.NewValue;
} 
```

1.  [属性元数据](http://msdn.microsoft.com/en-us/library/ms557327(VS.95).aspx)
2.  [PropertyChangedCallback](http://msdn.microsoft.com/en-us/library/system.windows.propertychangedcallback(VS.95).aspx)

# smtp - 如何检查我的 ISP 是否阻塞了端口 25？

> ID：328914
> 
> 赞同：16
> 
> 时间：2008-11-30T14:46:24.413
> 
> 标签：smtp

我应该如何检查我的 ISP 是否阻止了端口 25？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-30T17:42:03.623

```
cmd> telnet <some well known email provider IP> 25 
```

确定哪个主机（子域）正在侦听端口 25：

```
nslookup -q=MX <top-level domain> 
```

例如：

```
cmd> nslookup -q=MX gmail.com

gmail.com       MX preference = 50, mail exchanger = gsmtp147.google.com
gmail.com       MX preference = 50, mail exchanger = gsmtp183.google.com
gmail.com       MX preference = 5, mail exchanger = gmail-smtp-in.l.google.com
gmail.com       MX preference = 10, mail exchanger = alt1.gmail-smtp-in.l.google.com
gmail.com       MX preference = 10, mail exchanger = alt2.gmail-smtp-in.l.google.com

gsmtp147.google.com     internet address = 209.85.147.27
gsmtp183.google.com     internet address = 64.233.183.27
gmail-smtp-in.l.google.com      internet address = 64.233.183.114

cmd> telnet gsmtp147.google.com 25

220 mx.google.com ESMTP l27si12759488waf.25 
```

我猜，在 Linux 上，你可以“挖掘”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-30T14:48:04.753

[http://www.canyouseeme.org/](http://www.canyouseeme.org/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-30T14:49:31.147

远程登录主机 25

只需选择一个您知道正在侦听端口 25 的主机。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T17:39:25.533

你可以打电话问他们。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-03T21:44:43.180

正如 abatishchev 所展示的，探测一个侦听所需端口的服务器当然是最好的选择。

如果您在所需端口上找不到“回声”服务，或者*您想知道谁*在路上阻挡了您，您可以求助于*firewalking*。Firewalking 通过将生存时间 (TTL) 设置为零开始探测路径，然后每次迭代将其递增 1。当您停止收到“ICMP TTL Exceeded”消息时，这意味着链中的下一跳正在过滤您的数据包。

您可以使用[hping3](http://www.hping.org/)来执行此操作：

```
:~$ hping3 -z -T -p 25 server.com 
```

或使用为此创建的[Firewalk 。](http://www.packetfactory.net/projects/firewalk/)

**编辑**：路由上的任何 NAT 设备都会默默地破坏您的结果，因为 TTL 被重置为路由器认为合适的任何合理值。

# mysql - 为什么我的 INSERT 有时会因“没有此类字段”而失败？

> ID：328915
> 
> 赞同：2
> 
> 时间：2008-11-30T14:46:48.157
> 
> 标签：mysql, perl, insert

多年来，我一直在开发中使用以下代码段。现在突然间我得到一个数据库错误：没有这样的字段警告

```
$process = "process";
$create = $connection->query
(
    "INSERT INTO summery (process) VALUES($process)"
);
if (DB::isError($create)) die($create->getMessage($create)); 
```

但如果我使用数字也没关系

```
$process = "12345";
$create = $connection->query
(
    "INSERT INTO summery (process) VALUES($process)"
);
if (DB::isError($create)) die($create->getMessage($create)); 
```

或将值直接写入表达式

```
$create = $connection->query
(
    "INSERT INTO summery (process) VALUES('process')"
);
if (DB::isError($create)) die($create->getMessage($create)); 
```

我真的很困惑......有什么建议吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T19:36:53.890

使用准备好的查询和参数占位符总是更好。在 Perl DBI 中就像这样：

```
my $process=1234;
my $ins_process = $dbh->prepare("INSERT INTO summary (process) values(?)");
$ins_process->execute($process); 
```

为了获得最佳性能，请在打开数据库连接后立即准备所有常用查询。许多数据库引擎会在会话期间将它们存储在服务器上，就像小型临时存储过程一样。

它对安全性也很有好处。自己将值写入插入字符串意味着您必须在每个 SQL 语句中编写正确的转义码。使用准备和执行风格意味着只有**一个**地方（执行）需要知道转义，如果转义甚至是必要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T04:24:33.217

与 Zan Lynx 关于占位符的说法相同。但是您可能仍然想知道为什么您的代码失败了。

您似乎忘记了之前为您工作多年的代码中的一个关键细节：引号。

这个（经过测试的）代码工作正常：

```
my $thing = 'abcde';
my $sth = $dbh->prepare("INSERT INTO table1 (id,field1)
                              VALUES (3,'$thing')");
$sth->execute; 
```

但是下一个代码（就像您的第一个示例一样，在 VALUES 字段中缺少引号）会产生您报告的错误，因为 VALUES (3,$thing) 解析为 VALUES (3,abcde) 导致您的 SQL 服务器查找字段称为 abcde 并且没有该名称的字段。

```
my $thing = 'abcde';
my $sth = $dbh->prepare("INSERT INTO table1 (id,field1)
                              VALUES (3,$thing)");
$sth->execute; 
```

所有这些都假设您的第一个示例不是直接引用您描述的失败的代码，因此不是您想要的。它解决：

```
"INSERT INTO summery (process) VALUES(process)" 
```

如上所述，这会导致您的 SQL 服务器将 VALUES 集中的项目读取为另一个字段名称。如给定的那样，这实际上在 MySQL 上运行而没有抱怨，并将用 NULL 填充名为“process”的字段，因为当 MySQL 在创建新记录时在那里查找值时，名为“process”的字段包含的内容。

我确实将这种风格用于涉及已知的安全数据（例如程序本身提供的值）的快速丢弃黑客。但是对于任何涉及来自程序外部的数据或可能包含 [0-9a-zA-Z] 以外的数据的任何内容，使用占位符都会让您省心。

# mysql - 将Mysql数据库转移到另一台计算机

> ID：328922
> 
> 赞同：30
> 
> 时间：2008-11-30T14:53:29.360
> 
> 标签：mysql, migration, dump, transfer

我有一个`mysql`数据库填充并在*Windows*计算机上运行，​​是否有任何工具可以将数据库传输到另一台计算机（运行*Ubuntu*）？

否则，我将只写一个`script`将所有数据库放入`SQL`并将其*插入*另一台计算机。只是想节省一些时间:)

谢谢你们。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-30T14:58:38.150

你说的工具已经存在：mysqldump

它转储到 sql，然后您可以将其复制到另一台机器并重新加载。

例如：

来源：

```
mysqldump -u username -p databasename > dumpfile.sql 
```

然后使用 ftp/rsync/whatever 将文件移动到目标机器，并在那里创建一个空数据库以导入并运行：

```
mysql -u username -p databasename < dumpfile.sql 
```

您还需要为可能已转移的任何用户设置权限，因为它们不在数据库中。

或者，您可以从 mysql 数据目录复制文件 - 但 mysqldump 是最简单/最可靠的方法。

值得注意的是，当它们不在原始系统上时，表名在一个系统上可能会区分大小写。它取决于两端的配置 - 特别是文件系统的区分大小写（或其他）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-01-27T17:19:02.747

您可以使用一个命令将它们全部导出，而不是一个一个地导出数据库。然后导入它们。例如。

```
mysqldump -u username -p --all-databases > c:\alldbs.sql 
```

PS-最大的好处是你不会失去用户权限。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-02T05:27:34.243

磁盘上的文件在 MySQL 的所有版本之间是 100% 兼容的。你只需要注意文件名的大小写，因为它在 Unix 上很重要，而它有时只在 Windows 上有用。

并且记住在复制之前停止 MySQL。MyISAM 文件可以在运行时进行复制，但 InnoDB 文件这样做并不安全，Windows 的 MySQL 默认为 InnoDB 文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-02T06:21:03.933

使用 mysqldump 时要小心字符集，尤其是在 Windows 上。我更喜欢显式设置我的数据库使用的字符集并使用 --result-file=file 而不是使用 > 运算符，以免某些东西被破坏。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-18T00:47:31.197

来自 MySQL 文档： [http ://dev.mysql.com/doc/refman/5.0/en/copying-databases.html](http://dev.mysql.com/doc/refman/5.0/en/copying-databases.html)

```
shell> mysqldump --quick db_name | gzip > db_name.gz 
```

将包含数据库内容的文件传输到目标机器并在那里运行这些命令：

```
shell> mysqladmin create db_name
shell> gunzip < db_name.gz | mysql db_name 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T14:58:06.527

您可以使用任何 gui 工具进行备份，例如 Mysql Administrator（ Windows 上的[http://dev.mysql.com/downloads/gui-tools/，Ubuntu](http://dev.mysql.com/downloads/gui-tools/)上的 aptitude install mysql-admin）或 phpmyadmin（[http://www. phpmyadmin.net/home_page/index.php](http://www.phpmyadmin.net/home_page/index.php)在 Windows 上，aptitude install phpmyadmin 在 Ubuntu 上），然后在另一台计算机上恢复它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-02T06:30:36.053

mysqldump 应该正确地转储它并保留数据库中任何内容的字符集。如果您不想出现问题，建议您使用相同版本的 mysql。

mysqldump 生成的文件不是文本文件，尽管看起来，不要用 notepad.exe 等编辑它，否则你会遇到麻烦。

第三方 gui 工具（尤其是 phpmyadmin）生成的转储通常不准确，不一定能正确恢复。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T22:40:42.440

我经常发现自己使用这种单线的一些变体通过网络复制数据库。

```
mysqldump --opt --compress --user=username database | mysql --user=username2 --password=p2 --host=hostB -D database -C database 
```

我最初在这里读到的：

[http://www.igvita.com/2007/10/10/hands-on-mysql-backup-migration/](http://www.igvita.com/2007/10/10/hands-on-mysql-backup-migration/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-05T08:18:30.547

使用新的mysql工作台（gui工具），您可以轻松导出数据库并将其导入到您要迁移的数据库中。

# java - 当我使用 nio 时，serverSocket.accept() 抛出 IllegalBlockingModeException

> ID：328925
> 
> 赞同：1
> 
> 时间：2008-11-30T14:55:48.233
> 
> 标签：java, nio

当我这样编码时：

```
ServerSocketChannel ssc = ServerSocketChannel.open();
InetSocketAddress sa = new InetSocketAddress("localhost",8888);
ssc.socket().bind(sa);
ssc.configureBlocking(false);
ssc.socket().accept(); 
```

该`ServerSocket.accept()`方法抛出`java.nio.channels.IllegalBlockingModeException`. 为什么我不能打电话`accept()`，即使我将阻止设置为`false`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T15:49:52.963

问题是你在打电话`ssc.socket().accept()`，而不是`ssc.accept()`。如果将最后一行更改为`ssc.accept()`then 它将按预期工作，即如果正在等待则返回 SocketChannel ，否则返回 null 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T15:12:12.660

因为这就是 serversocket.accept() 的 javadoc 所说的？

IllegalBlockingModeException - 如果此套接字具有关联的通道，并且通道处于非阻塞模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-10T18:37:44.700

Javadoc 特别指出`ServerSocketChannel.accept()`：

> 接受与此通道的套接字建立的连接。
> 
> 如果此通道处于非阻塞模式，则如果没有挂起的连接，此方法将立即返回 null。否则它将无限期地阻塞，直到有新的连接可用或发生 I/O 错误。

总体思路是：

*   如果您想在等待传入连接时阻塞，您可以让服务器套接字处于阻塞模式。如果您正在编写一个在连接实际进入之前无事可做的服务器，那么阻塞模式就是您想要的。
*   如果您想做其他事情，并定期检查是否有挂起的连接，则需要非阻塞模式。

阻塞模式是默认的，原因是：大多数服务器不希望轮询其接受套接字以获取传入连接。

# linux - 从类 Unix 系统中获取唯一 ID

> ID：328936
> 
> 赞同：25
> 
> 时间：2008-11-30T15:11:18.217
> 
> 标签：linux, unix, uniqueidentifier

我想从任何类 Unix 系统（如果可能的话）获得一个唯一的 id，每次我的应用程序在同一台机器上运行时都会保持不变。如果可能的话，我想从 Linux 或 FreeBSD 或 Solaris 等获取相同的 id...来自操作系统，我不喜欢使用 MAC 地址之类的东西。

如果没有其他可用选项，我可以将 MAC 与其他内容结合使用，例如 id 可以是 MAC 地址和其他内容组合的 md5 哈希。

我想听听你的建议。

如果有用，我的应用程序是用 C/C++ 编写的。

所有这些的目的是防止用户运行我的应用程序两次或更多次。我只想跑一次。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-05T17:55:13.857

根文件系统的 UUID 怎么样？`/etc/fstab`您可以通过手动解析文件或使用`getfsent (3)`或来获取根文件系统设备`getfsfile (3)`。拥有设备后，您可以通过检查命令中的链接`/dev/disk/by-uuid`或从`blkid`命令中获取 UUID。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-30T15:50:01.617

Solaris 和 Linux 都提供`hostid`(1) 实用程序

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-30T16:20:31.773

像往常一样，最好的方法是看看其他人已经解决了同样的问题。

[FLEXlm](http://en.wikipedia.org/wiki/FLEXlm)还为其节点锁定许可证使用主机标识符。它使用的最常见的主机标识符是您的网络接口之一的以太网 MAC 地址，它们没有任何分隔符拼凑在一起。

它还可以使用（在 Windows 上）C: 驱动器的卷序列号（再次拼凑在一起，没有任何分隔符），在 Solaris 上，`hostid`命令的输出（IIRC，在 Sun 计算机上，这个数字实际上是唯一的，位于系统板上的一个小型可移动 EEPROM）。

虽然 MAC 地址非常容易伪造，但它现在几乎是通用的标识符（几乎所有新计算机都至少有一个以太网端口，而且它们很常见），并且实际上是全球唯一的（在事实上，以太网协议依赖于这种唯一性）。这种方法会遇到的主要问题：

*   有些计算机有多个以太网地址；其中一些在主板上，一些在单独的可移动卡上。
*   它们非常容易伪造（并且某些协议依赖于能够更改它们）。
*   一些虚拟化环境会在每次启动时生成随机以太网地址（但它们通常有一种强制固定值的方法）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-03T18:10:22.487

另一种选择是使用来自[dmidecode](http://www.nongnu.org/dmidecode/)的信息，这是 linux 上的一个命令。此信息是从 /dev/mem 解码的，因此需要 root 访问权限。

众所周知，dmidecode 读取的信息存在缺陷，因为一些主板制造商在某些字段中撒谎或伪造。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-30T21:31:24.953

没有通用且可靠的方法来获得您想要的东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-30T15:18:37.343

我不认为这是可能的。最接近的方法是创建一个非常长的随机字符串（就像 MS 对 GUID 所做的那样）并将其存储在系统的某个位置。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-30T15:52:11.317

您必须考虑到许多设置可能已经创建了文件系统映像并克隆到许多机器上，而不是单独设置它们。在其他情况下，机器可能会多次重新设置。换句话说，操作系统提供的任何东西都不可信。

但是，CPU 确实保留了一个唯一的序列号，但是在不同的系统上访问它应该是不同的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-04-02T15:16:28.113

您可以获得根文件系统的 UUID `/`，这是相当可靠的，但它不会区分 chroot 和可能在同一磁盘上运行的虚拟机。

如果您主要处理专用于运行特定操作系统的内部或静态 HDD，那么您应该能够使用根文件系统的 UUID 来检测系统。

您可以通过以下方式获取根 fs 的 UUID： `alias sys_guid='sudo /sbin/blkid | grep "$(df -h / | sed -n 2p | cut -d" " -f1):" | grep -o "UUID=\"[^\"]*\" " | sed "s/UUID=\"//;s/\"//"'`

如果您需要进一步区分同一操作系统的内核版本，或在同一磁盘上运行的不同操作系统，您可以使用来自根 fs UUID 的数据`uname`和/或将它们与根 fs UUID 结合使用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-30T15:56:56.300

您没有提到唯一标识符需要有多稳定——您是否总是希望同一主机在每次运行代码时产生相同的 ID？

如果不是，那么fuzzymonk 的uuidgen 建议就是你想要的。

如果是，那么您需要确定就主机而言什么构成“相同”。一种方法是按照您的建议，将第一个以太网接口的 MAC 和“某物”的 MD5 和。对于那种情况下的“某事”，我会考虑 FQDN，除非您的“同一主机”概念包括 FQDN 更改......

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-07-01T16:33:23.217

As someone else stated, the `dmidecode` command is an option.

```
[root@sri-0000-0003 WebGui]# dmidecode -s system-uuid
03001234-1234-1234-1234-000700012345 
```

I edited the output to hide the UUID of the system I tested on.

There are other things that you can get from dmidecode. `dmidecode -t` will tell you the categories.

```
[root@sri-0000-0003 WebGui]# dmidecode -t
dmidecode: option requires an argument -- 't'
Type number or keyword expected
Valid type keywords are:
  bios
  system
  baseboard
  chassis
  processor
  memory
  cache
  connect 
```

If you're using actual hardware instead of a virtual machine then `dmidecode -t processor` would be a good option.

```
[root@sri-0000-0003 WebGui]# dmidecode -t processor
# dmidecode 3.1
Getting SMBIOS data from sysfs.
SMBIOS 3.0.0 present.

Handle 0x0041, DMI type 4, 48 bytes
Processor Information
        Socket Designation: U3E1
        Type: Central Processor
        Family: Core i3
        Manufacturer: Intel(R) Corporation
        ID: E3 00 00 00 11 22 33 44 
```

Given that the number of processor manufactures is small, this seems like a good alternate to `dmidecode -s system-uuid`. However, under virtualbox, `dmidecode -t processor` won't give you anything useful. I don't know about any other virtual platforms.

I'm willing to bet that `dmidecode -s system-uuid` will also work inside a docker container too but, I can't verify that.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-04T14:56:37.370

你提到在 Windows 上你使用一些 GUID...你有关于它是如何创建的一些细节吗？

除此之外，您可以尝试诸如 CPU ID 或硬盘 ID 之类的东西……我想这些是无法更改的（但是如果更换有故障的硬盘，您会遇到麻烦）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-30T15:54:13.200

听起来您正在寻找 UUID。这是一个通用的通用唯一 ID（实际上，与 GUID 相同）

在不同的库中有许多 C++ 实现，或者您可以使用 uuidgen 命令并捕获输出。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-30T16:05:34.393

大多数类 unix 机器都有一个可通过[/dev/random](http://en.wikipedia.org/wiki/Urandom)访问的随机数生成器。您将需要一个 MAC 地址和时间来为 GUID 生成器提供真正的唯一性（这是 Windows 上的 GUID 生成器所做的）。最重要的是，从 /dev/random 获取一些东西会给你一个相当好的 GUID 类型构造。在实践中，UUID 库在幕后做这种事情。

如果每台机器只需要一个数字，那么 MAC 地址可能就足够了。这些由中央机构管理，人们可以合理地假设没有两个 MAC 地址会相同。但是，如果您尝试使用它来将软件安装绑定到 MAC 地址，请注意某些组件具有可编程 MAC 地址或 MAC 地址的可编程组件。类 Unix 操作系统，尤其是开源操作系统，往往没有固定的序列号。这种方法还可能导致在 VM 中运行多个软件实例时出现问题。

一种选择可能是 USB[加密狗，](http://en.wikipedia.org/wiki/Dongle)可以从多家制造商处获得。另一种选择可能是许可证服务器，其中向服务器提供唯一代码。同样，可以从不同来源获得几种罐装解决方案。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-03-22T22:41:26.140

Jason Day 和 A.Danischewski 的答案似乎在正确的轨道上，但不符合您对任何“类 Unix 系统”的标准，因为OSX`/sbin/blkid`上`/etc/fstab`也不存在。

唯一 100% 可移植的方法是为您自己的应用程序将创建的文件选择一个标准位置，例如`/etc/YOURAPP.cfg`，如果 UUID 尚不存在，则在该位置存储一个 UUID。

远非理想，因为另一个人或应用程序可以删除或更改文件，或者如果用户更改了根文件系统，您可能会丢失当前机器的 ID，或者它可能会在另一台机器上存在。更不用说读写权限等问题了。

但最终没有“同一台机器”这回事。任何计算机都不过是其组件+当前配置。我不认为你可以做得比这更好，便携。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-12-05T17:18:10.377

您可以在以下位置使用锁定文件：

*   /var/run/yourapp.pid（如果程序由 root 运行）
*   $HOME/.yourapp.pid（如果由用户和本地文件系统运行）
*   $HOME/.yourapp.$(hostname -f).pid（nfs 上的主页）

当您的程序运行时，它应该执行以下操作：

```
lock = open(filename, O_CREAT | O_EXCL);
dprintf(lock, "%u", getpid()); 
```

如果打开失败，请检查进程是否仍在运行，如果没有：删除文件并重试。

# .net - 您对 Entity Framework 有什么体验？

> ID：328938
> 
> 赞同：7
> 
> 时间：2008-11-30T15:13:14.033
> 
> 标签：.net, entity-framework, orm

EF 已经推出一段时间了，我正在考虑评估它——你的经历是什么？

我对 Web 和桌面应用程序都感兴趣，可能还会对 EF 和您使用的其他 ORM 工具进行一些比较。

学习曲线是一个因素，因为有一个团队参与。这东西是臃肿的一团糟，还是又瘦又锋利？

我听说微软在内部大量使用它，所以这是一个好兆头。如果您对 MS 似乎正在花钱购买的基于云的未来有什么想法，那也可能很有趣。毕竟，如果这是我们最终可能都*需要*知道的事情，那将把优先级提高一两个档次。

非常感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-04T04:41:44.867

好吧，我刚刚在 EF 中实现了一个完整的系统，这是我在生产环境中第一次真正体验 EF。该应用程序现在运行了大约 45 天，每天有 100 名用户使用它，没有任何问题。

我认为最大的事情是你必须改变你的想法。如果您像关系数据库 ORM 一样思考，那么您已经有了错误的心态。您需要考虑部分方法、对象和扩展。一旦你掌握了基本的心态，事情就会开始流动（并且你从刚开始时重写了很多代码）。

**获得帮助很艰难**

EF 的另一个令人沮丧的部分是，无论你去哪里寻求帮助，到处都是 L2S 大佬，他们认为他们已经知道你需要做的一切，并一直试图告诉你放弃它，只使用 L2S ......如果我会要求如何在 L2S 中做到这一点，那么他们的意见可能是有效的......

**英孚工作正常**

生成对象的基本能力，然后您可以通过部分方法进行扩展。实际上，我在早期阶段非常沮丧，因为我一直在尝试以 SQLCommand 中的方式获取内容。一旦您意识到您可以根据业务逻辑的需求而不是 SQL 的工作方式来思考问题，您就可以完成更多工作。

例如 - 我一直在尝试进行连接以获取与特定 FK 相关的各种任务的列表。一旦我最终发现我可以将整个 where 子句交给 EF 并弄清楚如何快速将数据返回给我，代码实际上要快得多。

**包括臭味**

不过，Include 语法对我来说就像是 hack。必须使用 .Include("TableName.DetailTable") 是丑陋的。也许我只是被智能感知宠坏了，但我讨厌那种语法。

**按需加载**

主细节加载也有点难看。如果您不想包含它们，您可以随时参考它们并查看它是否为 .IsLoaded，然后调用 .Load。为什么？对象不能为我做那件事吗？我最终在我的对象上实现了一个扩展方法，如果我尝试加载一个未加载的细节类，它会按需加载它。似乎那应该是内置在我身上的。

注意：上面提到的过滤记录集的详细加载并不复杂，但也不明显。您可以使用 Lambda 表达式进行过滤。

**你想移动项目吗？**

这是一个重要的原因：非供应商锁定。如果您曾经想将该代码带到另一个数据库，那么您无法使用 Linq2SQL 执行此操作。没有提供者模型。您可能有机会将 EF 系统转移到另一个供应商。在我的情况下，相同的项目在 SQL Server 和 VistaDB EF (Alpha) 上运行，无需更改代码。所以我可以 xcopy 部署它，或者在运行时选择连接到服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T21:03:37.460

**编辑（是的，3 年后）...我不再讨厌 EF...Entity Framework 4.1 及更高版本很棒 - 它（最终）解决了它过去遇到的所有问题/失败。请注意，不是“4.0”，而是“4.1”最终删除了“魔术字符串”等丑陋的使用。它拥有`Contains`以及其他所有内容以及更多。**

## 以下是我 2008 年的旧评论

我个人讨厌EF。我喜欢 LINQ-2-SQL。以下是我对 EF 的具体警告：

1) EF 不支持“包含”功能。因此，如果您有一个包含 10,000 个“帐户”的表，并且您想返回一些用户提供了 ID 列表的帐户……您必须下载所有 10,000 个帐户并执行 for 循环。

2) EF 不支持延迟加载：[http ://www.singingeels.com/Articles/Entity_Framework_and_Lazy_Loading.aspx](http://www.singingeels.com/Articles/Entity_Framework_and_Lazy_Loading.aspx)

3) 如果您有一个简单的“类型”表，例如 AccountType...，并且您想从 AccountTypeID == 9 的 Accounts 表中选择所有帐户，则在 EF 中没有一种干净的方法... EF 会隐藏该字段，并让您提供 AccountType 类的实例。

所有这些问题都在 L2S 中得到解决。

编辑：哦，你确实问过“你的经历是什么......”而不仅仅是关于问题。在我的新工作中，他们有一个 205 个表的数据库、600 多个存储过程等。我想在编程的新世界中架起一座桥梁……所以我将 DAL 转换为 1-1 “将所有表拖入”使用 EF 的版本。这是它的样子：[Giant EDM](http://www.singingeels.com/Blogs/Nullable/2008/10/01/Plans_to_the_Death_Star_Or_an_AutoGenerated_EDM.aspx)

仅仅 1 周后，由于我上面提到的问题以及其他一些问题，我不得不把它撕掉并用 L2S 替换它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T01:10:54.417

在为一个新项目（ASP.Net/WCF）试用 EF 后，我发现：

通过 LINQ 查询非常容易实现。大多数情况下，生成的 T-SQL 都是赚钱的。

主要缺乏对 N 层应用程序的支持。

在 n 层的 asp.net 应用程序中，管理对象上下文的实例同样痛苦。

EF Designer 缺乏一些明显的功能，总是深入研究 XML。

更新会导致代价高昂的数据库往返，或者有非常晦涩难懂的方法来尝试避免它们。

基于 POCO 和 SP 的 n/tier 应用程序的性能损失非常明显。这是意料之中的，但没有达到我们注意到的程度。即使在编译查询之后。

由于易于查询，我们在开发中节省的时间很快就被浪费在尝试做以前简单的任务上。

正如 Brain 所说，通过字符串引用实体类型或表名非常烦人并且感觉非常混乱，我发现自己编写了包装器来从一个点返回这些。

如果您想使用单层应用程序，那么我们遇到的许多问题可能并不适用。

但对我们来说，我们一直在关注 V2，并希望有一些改进。

# c# - 应用程序中进行验证的最佳位置在哪里？经验法则？

> ID：328939
> 
> 赞同：2
> 
> 时间：2008-11-30T15:15:27.180
> 
> 标签：c#, validation, model-view-controller

我正在为一个类项目制作一个 C# 应用程序。我想确保一个字符串具有三个值之一。通常，在 Web 应用程序中，我会在客户端使用 javascript 进行验证。但是，这目前是一个控制台应用程序。我知道我应该尽早进行验证，但有哪些好的验证经验法则？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T15:31:20.097

每个模块都应该进行自己的验证，并且永远不要相信调用代码给它的东西。这通常意味着验证应该发生在应用程序的每一层。您尤其不想相信任何验证发生在客户端，因为这会导致安全漏洞。众所周知，在客户端上运行的代码会不时更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T17:47:03.783

如果您正在使用 MVC，那么您很可能正在使用 TDD 从头开始​​工作。

我不确定这是否是最好的方法，但我做事的方式是..

*   制作我的业务对象。
*   定义某种验证框架，以便业务对象可以返回有关其当前状态的错误列表并使用单元测试来测试这些错误。
*   如果您使用 linq to sql，请实现部分方法 OnValidate() 并使其调用您的 mybusinessobject.geterrors()。OnValidate 在您执行 db.submitchanges() 时被调用，因此您可以停止保存无效数据
*   现在，在您的控制器中，当有人创建一个新的业务对象或编辑一个业务对象时，使用您从用户那里获得的任何数据创建该对象 - 然后调用您的 geterrors() 方法并执行任何操作
*   然后客户端验证，如果你可以arsed

这是 scott guthrie 在这里描述的一个框架：[http ://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)

我喜欢它，这意味着您可以定义一次业务规则并在不同的层上重复使用它们，这意味着您在更新内容时不太可能在特定区域错过它们

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T15:27:48.107

根据经验，正如您所说，您应该尽早进行验证，但在客户端-服务器应用程序中，尽快在服务器上验证数据以防止可能出现的安全问题非常重要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T16:33:01.953

我认为你应该验证三遍。

1.  在客户端中，2 在服务器上，3\. 在带有检查约束的数据库中。

在控制台应用程序中，您可以立即进行验证，因为您知道用户输入数据的顺序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T15:46:16.307

我喜欢在用户点击 Ok 或 Next 之后进行验证——在他们离开他们所在的屏幕之前。在修改期间进行验证很少起作用 - 用户必须能够退格，在输入字符串时插入字符串，并且复制/粘贴到字符串字段有它自己的问题。如果字符串在有效之前一直是红色的，这可能会有所帮助，但在纠正之前，您仍然必须阻止继续进行。同样，对于离开文本框，在输入数据时显示消息框可能会令人不快。等到用户说一切都完成了，然后立即进行所有验证。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T04:49:07.503

我喜欢[Timothy 对 MVC 的了解](https://stackoverflow.com/questions/328939/where-is-the-best-place-in-an-app-to-do-validation-rules-of-thumb#329356)。

由于我们对应用程序的性质知之甚少，因此我想指出一些非常普遍的经验法则以及已经提供的良好建议。

以某种方式验证

1.  无效输入不会执行不可逆的操作

2.  用户不会失去工作

3.  用户的活动永远不会处于无法轻松识别错误输入并简单撤回的状态

4.  应用程序不会失败或崩溃

5.  由于应用程序处理无效数据而导致（或看到）任何（共享）持久材料处于不良状态

6.  用户在完成有用的工作时不会因为验证的方式和时间而感到沮丧

那应该几乎涵盖了它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T15:18:17.237

根据应用程序的进展情况，您可以在离开该页面/步骤之前进行验证（如果它像一个向导，您可以在其中逐步完成多个页面/步骤），或者您可以在用户离开该文本框/值后立即对其进行验证。另一种选择是在修改时进行验证。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T20:57:30.420

这里有很多关于一般最佳实践的很好的答案......但是您的问题指定了“MVC”，并且只有一个正确答案。

编辑：你的“问题”没有说 MVC，但你的标签说了。

MVC = 模型视图控制器

所有业务逻辑都在 Controller 中。这就是**答案**。

这篇文章中的其他答案是很好的提示，例如“不要信任客户端验证”......和“到处验证”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-30T21:57:54.370

另一个提示：如果您可以在所有验证逻辑都可以解释的元信息中定义验证规则，那么在任何地方进行验证都会容易得多。然后你只需要在一个地方定义规则，你就不必担心你的客户端验证、服务器端验证和测试用例之间会不同步。

# c++ - 如何检查文件是否为常规文件？

> ID：328944
> 
> 赞同：6
> 
> 时间：2008-11-30T15:18:23.600
> 
> 标签：c++, c, filesystems, dirent.h

如果文件是常规文件（而不是目录、管道等），我如何检查 C++？我需要一个函数 isFile()。

```
DIR *dp;
struct dirent *dirp;

while ((dirp = readdir(dp)) != NULL) {
if ( isFile(dirp)) {
     cout << "IS A FILE!" << endl;
i++;
} 
```

我尝试将 dirp->d_type 与 (unsigned char)0x8 进行比较，但它似乎无法通过不同的系统进行移植。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-30T15:31:59.547

您可以使用可移植[`boost::filesystem`](http://www.boost.org/doc/libs/1_31_0/libs/filesystem/doc/index.htm)的（标准 C++ 库直到最近在 C++17 中引入[std::filesystem才能做到这一点）：](http://en.cppreference.com/w/cpp/filesystem/is_regular_file)

```
#include <boost/filesystem/path.hpp>
#include <boost/filesystem/operations.hpp>
#include <iostream>

int main() {
    using namespace boost::filesystem;

    path p("/bin/bash");
    if(is_regular_file(p)) {
        std::cout << "exists and is regular file" << std::endl;
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-30T15:21:42.813

您需要对文件调用 stat(2)，然后在 st_mode 上使用 S_ISREG 宏。

类似的东西（改编自[这个答案](https://stackoverflow.com/a/3828537/6451573)）：

```
#include <sys/stat.h>

struct stat sb;

if (stat(pathname, &sb) == 0 && S_ISREG(sb.st_mode))
{
    // file exists and it's a regular file
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T15:27:26.813

C++ 本身不处理文件系统，因此语言本身没有可移植的方式。特定于平台的示例适用`stat`于 *nix（如 Martin v. Löwis 所述）和`GetFileAttributes`Windows。

此外，如果您对[Boost](http://www.boost.org/)不过敏，那么它还有相当多的跨平台`boost::filesystem`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-12-17T12:12:42.510

在 C++17 中，您可以使用 std::filesystem::is_regular_file

```
#include <filesystem> // additional include

if(std::filesystem::is_regular_file(yourFilePathToCheck)) 
    ; //Do what you need to do 
```

请注意，早期版本的 C++ 可能在 std::experimental::filesystem 下拥有它（来源：[http](http://en.cppreference.com/w/cpp/filesystem/is_regular_file) ://en.cppreference.com/w/cpp/filesystem/is_regular_file ）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T18:26:26.700

谢谢大家的帮助，我试过了

```
while ((dirp = readdir(dp)) != NULL) { 
   if (!S_ISDIR(dirp->d_type)) { 
        ... 
        i++; 
   } 
} 
```

它工作正常。=)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-19T08:45:30.810

```
#include <boost/filesystem.hpp>

bool isFile(std::string filepath)
{
    boost::filesystem::path p(filepath);
    if(boost::filesystem::is_regular_file(p)) {
        return true;
    }
    std::cout<<filepath<<" file does not exist and is not a regular file"<<std::endl;
    return false;
} 
```

# perl - Perl 中 dirhandle 上的“stat”的语义是什么？

> ID：328946
> 
> 赞同：1
> 
> 时间：2008-11-30T15:20:01.070
> 
> 标签：perl, stat

在研究另一个问题时，我注意到`stat`Perl 中的函数可以将 dirhandle 作为其参数（而不是文件句柄或文件名）。

但是我找不到任何正确使用它的例子——Perl 手册中没有。

谁能举例说明如何使用它？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T15:54:36.913

您可以像处理文件或文件句柄一样使用它：

```
#!/usr/bin/perl
use strict;

my $dir = shift;
opendir(DIR, $dir) or die "Failed to open $dir: $!\n";
my @stats = stat DIR;
closedir(DIR);
my $atime = scalar localtime $stats[8];

print "Last access time on $dir: $atime\n"; 
```

在 Perl 5.10 中刚刚添加了在目录句柄上使用 stat 的功能，因此如果您关心可移植性，应该避免使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T15:47:05.367

您可以像`stat`在文件句柄上一样使用它：

```
<~> $ mkdir -v foo ; perl -e 'opendir($dh , "./foo"); @s = stat $dh; print "@s"'
mkdir: created directory `foo'
2049 11681802 16877 2 1001 1001 0 4096 1228059876 1228059876 1228059876 4096 8 
```

（就个人而言，我喜欢使用`File::stat`来获得好的命名访问器，这样我就不必记住（或查找）第五个元素是 UID ......）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T19:56:28.237

请注意，如果句柄曾经用作文件句柄和目录句柄，则统计信息将应用于文件，而不是目录：

```
$ perl -wl
opendir $h, "." or die;
open $h, "/etc/services" or die;
print "dir:".readdir($h);
print "file:".readline($h);
print stat("/etc/services");
print stat(".");
print stat($h);
close($h);
print stat($h);
__END__
dir:.
file:# Network services, Internet style

205527886633188100018274122800783211967194861209994037409640
20551515522168777410001000020480122803711512280371021228037102409640
205527886633188100018274122800783211967194861209994037409640
stat() on closed filehandle $h at - line 1.
    (Are you trying to call stat() on dirhandle $h?) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-16T14:47:31.787

我在 windows (ActivePerl) 上使用 Perl 5.10.1 并且在 dirhandle 上执行 stat 不起作用。但是对目录的路径字符串进行统计是有效的。

# 作品

```
 my $mtime = (stat( $directory ))[ 9 ];
  print "D $directory $mtime\n"; 
```

# 这没有（“dirfd 函数未实现......”）

```
 my $dh;
  if( opendir( $dh, $directory ) == 0 ) {
    print "ERROR: can't open directory '$directory': $!\n";
    return;
  }
  $mtime = (stat( $dh ))[ 9 ];
  print "D $directory $mtime\n"; 
```

# c - C：关于 rand、random 和 arc4random 的最终真相

> ID：328950
> 
> 赞同：11
> 
> 时间：2008-11-30T15:22:13.110
> 
> 标签：c, cocoa, random

关于这个主题有很多相互矛盾的信息。因此，让我们尝试就明确的答案达成一致：

C 中的这些随机数生成器中的哪一个可以产生更好的随机性：rand、random 或 arc4random？

注意：只是为了澄清问题，这不是关于真正随机性的问题，它只是这三个之间的冲突。

* * *

正如所指出的，这个问题没有多大意义，因为这不是关于 C 的，而是关于一个具体的实现，在我的例子中，可可（更具体地说是 iphone sdk，但我的猜测是它们与这些相同函数去）。尽管如此，这里还是有一些有用的信息。我以实现 arc4random 结束，主要是因为它易于使用（无需播种），这是没有人指出的一个重要因素。

我要结束这个问题，并为可可开发人员添加可可标签以查找有关 RNG 的信息。非常感谢那些做出贡献的人，并对造成的混乱感到抱歉。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-30T15:38:01.610

在这些函数中，只有 rand 是标准 C 的一部分。 random 是 POSIX 的一部分，而 arc4random 仅在 BSD（和派生）中提供。所以只有 rand 是“在 C 中”。

对于 rand，C 标准没有说明生成器的质量，即始终返回相同的数字是符合要求的。它表示该数字必须介于 0 和 RAND_MAX 之间。RAND_MAX 的值以及所使用的精确算法由实现定义（尽管 RAND_MAX 必须至少为 32767）。

对于随机数，POSIX[规定](http://opengroup.org/onlinepubs/009695399/functions/initstate.html)它默认必须有至少 2^31 的周期，如果 initstate 以 256 字节的状态调用，那么它必须有至少 2^69 的周期；其他细节再次由实现定义。

对于 arc4random，具体实现是其定义（RC4）的一部分。它指定它给出 2^32 个不同的值；我找不到任何关于它的时期的信息。

要详细比较它们，您必须知道您指的是什么具体实现。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-30T15:29:18.103

C 标准没有指定 rand() 的实现，但是大多数编译器使用线性同余生成器。random() 和 arc4random() 也不是标准 C，但它们比 rand() 的通常实现要好

我想说：arc4random() 比 random() 好比 rand()

rand() 真的很糟糕。但是，您可以轻松地比这三个都做得更好。

它还取决于您想要随机数的用途。一个好的加密/安全随机数生成器可能不是一个好的模拟随机数生成器，反之亦然。

# c++ - 如何将 std::sort 与结构向量和比较函数一起使用？

> ID：328955
> 
> 赞同：12
> 
> 时间：2008-11-30T15:29:02.550
> 
> 标签：c++, sorting, stl, vector

感谢 C 中的[解决方案](https://stackoverflow.com/questions/327893/how-to-write-a-compare-function-for-qsort-from-stdlib)，现在我想在 C++ 中使用 std::sort 和向量来实现这一点：

```
typedef struct
{
  double x;
  double y;
  double alfa;
} pkt; 
```

`vector< pkt > wektor;`使用 push_back() 填充；比较功能：

```
int porownaj(const void *p_a, const void *p_b)
{
  pkt *pkt_a = (pkt *) p_a;
  pkt *pkt_b = (pkt *) p_b;

  if (pkt_a->alfa > pkt_b->alfa) return 1;
  if (pkt_a->alfa < pkt_b->alfa) return -1;

  if (pkt_a->x > pkt_b->x) return 1;
  if (pkt_a->x < pkt_b->x) return -1;

  return 0;
}

sort(wektor.begin(), wektor.end(), porownaj); // this makes loads of errors on compile time 
```

要纠正什么？在这种情况下如何正确使用 std::sort ？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-30T15:33:11.357

`std::sort`采用与 中使用的不同的比较功能`qsort`。此函数不返回 –1、0 或 1，而是返回一个`bool`指示第一个元素是否小于第二个元素的值。

您有两种可能性：`operator <`为您的对象实施；在这种情况下，没有第三个参数的默认`sort`调用将起作用；或者你可以重写上面的函数来完成同样的事情。

请注意，您必须在参数中使用强类型。

此外，最好不要在这里使用函数。相反，使用函数对象。这些受益于内联。

```
struct pkt_less {
    bool operator ()(pkt const& a, pkt const& b) const {
        if (a.alfa < b.alfa) return true;
        if (a.alfa > b.alfa) return false;

        if (a.x < b.x) return true;
        if (a.x > b.x) return false;

        return false;
    }
};

// Usage:

sort(wektor.begin(), wektor.end(), pkt_less()); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-30T15:54:58.830

在 C++ 中，您可以使用类似的仿函数`boost::bind`来很好地完成这项工作：

```
#include <vector>
#include <algorithm>

struct pkt {
    double x;
    double y;
    double alfa;
    pkt(double x, double y, double alfa)
        :x(x), y(y), alfa(alfa) { }
};

int main() {
    std::vector<pkt> p;
    p.push_back(pkt(10., 0., 20.));
    p.push_back(pkt(10,  0., 30.));
    p.push_back(pkt(5.,  0., 40.));

    std::sort(p.begin(), p.end(), 
              boost::bind(&pkt::alfa, _1) <  boost::bind(&pkt::alfa, _2) || 
              boost::bind(&pkt::alfa, _1) == boost::bind(&pkt::alfa, _2) && 
              boost::bind(&pkt::x,    _1) <  boost::bind(&pkt::x,    _2));
} 
```

如果您需要多次执行此操作，您还可以通过创建一个接受成员指针并进行排序的函数对象来解决问题。您可以将它重用于任何类型的对象和成员。首先你如何使用它：

```
int main() {
    /* sorting a vector of pkt */
    std::vector<pkt> p;
    p.push_back(pkt(10., 0., 20.));
    p.push_back(pkt(5.,  0., 40.));

    std::sort(p.begin(), p.end(), make_cmp(&pkt::x, &pkt::y));
} 
```

这是 make_cmp 的代码。随意撕掉它（使用[`boost::preprocessor`](http://www.boostpro.com/tmpbook/preprocessor.html)）：

```
#include <boost/preprocessor/repetition.hpp>
#include <boost/preprocessor/facilities/empty.hpp>

// tweak this to increase the maximal field count
#define CMP_MAX 10

#define TYPEDEF_print(z, n, unused) typedef M##n T::* m##n##_type;
#define MEMBER_print(z, n, unused) m##n##_type m##n;
#define CTORPARAMS_print(z, n, unused) m##n##_type m##n
#define CTORINIT_print(z, n, unused) m##n(m##n)

#define CMPIF_print(z, n, unused)              \
    if ((t0.*m##n) < (t1.*m##n)) return true;  \
    if ((t0.*m##n) > (t1.*m##n)) return false; \

#define PARAM_print(z, n, unused) M##n T::* m##n

#define CMP_functor(z, n, unused)                                       \
    template <typename T                                                \
              BOOST_PP_ENUM_TRAILING_PARAMS(n, typename M)>             \
    struct cmp##n {                                                     \
        BOOST_PP_REPEAT(n, TYPEDEF_print, ~)                            \
        BOOST_PP_REPEAT(n, MEMBER_print, ~)                             \
        cmp##n(BOOST_PP_ENUM(n, CTORPARAMS_print, ~))                   \
            BOOST_PP_IF(n, :, BOOST_PP_EMPTY())                         \
            BOOST_PP_ENUM(n, CTORINIT_print, ~) { }                     \
                                                                        \
        bool operator()(T const& t0, T const& t1) const {               \
            BOOST_PP_REPEAT(n, CMPIF_print, ~)                          \
            return false;                                               \
        }                                                               \
    };                                                                  \
                                                                        \
    template<typename T                                                 \
             BOOST_PP_ENUM_TRAILING_PARAMS(n, typename M)>              \
    cmp##n<T BOOST_PP_ENUM_TRAILING_PARAMS(n, M)>                       \
        make_cmp(BOOST_PP_ENUM(n, PARAM_print, ~))                      \
    {                                                                   \
        return cmp##n<T BOOST_PP_ENUM_TRAILING_PARAMS(n, M)>(           \
            BOOST_PP_ENUM_PARAMS(n, m));                                \
    }

BOOST_PP_REPEAT(CMP_MAX, CMP_functor, ~)

#undef TYPEDEF_print
#undef MEMBER_print
#undef CTORPARAMS_print
#undef CTORINIT_print
#undef CMPIF_print
#undef PARAM_print
#undef CMP_functor 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-04-17T12:44:09.880

使用 C++0x 和 lambdas，Konrad 的解决方案如下所示：

```
sort(wektor.begin(), wektor.end(), [](pkt const& a, pkt const& b)
{
    if (a.alfa < b.alfa) return true;
    if (a.alfa > b.alfa) return false;

    if (a.x < b.x) return true;
    if (a.x > b.x) return false;

    return false;
}); 
```

# django - 寻找一些好的资源来开始使用 Django

> ID：328960
> 
> 赞同：2
> 
> 时间：2008-11-30T15:34:41.463
> 
> 标签：django, resources

全部，

我想检查一下 Django，也许可以拼凑一些网页来看看它的感觉 - 但是在看了一些像[这样](http://www.showmedo.com/videos/video?name=stoops010)的教程之后，我开始想知道是否有任何方法可以让它在没有的情况下启动和运行键入 cmd 行内容 1/2 小时。

人们可以指出一些好的直接资源/教程来启动和运行吗？

我计划在 Windows 环境中执行此操作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T16:06:55.547

作为一个刚开始玩 Django 的人，我发现官方文档非常有帮助。只需在以下位置浏览“第一步”教程：

[http://docs.djangoproject.com/en/dev/](http://docs.djangoproject.com/en/dev/)

它将在很短的时间内教给你 Django 的要点。这绝对是迄今为止我见过的最好的框架官方文档之一。

为了在 Windows 下测试它，只需安装最新版本就足够[了](http://docs.djangoproject.com/en/dev/topics/install/#installing-an-official-release)（当然，鉴于 Python 本身已经安装）。

我看的第二个教程是[“The Django Book”](http://www.djangobook.com/)。虽然这也写得很好，但它有点过时了，还没有涵盖新风格的管理。如果您也想完成本教程，请注意管理页面示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T16:18:19.673

Holovaty 和 Kaplan-Moss 的[The Definitive Guide to Django](https://rads.stackoverflow.com/amzn/click/com/1590597257) (Apress) 写得很清楚。最让我印象深刻的是，在 40 分钟的火车旅程中，浏览一下就足以解释该系统是如何工作的——足够详细，可以开始使用它。 *强烈推荐。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T22:02:52.893

我使用了[Django Book](http://djangobook.com)，它有点过时了，而且（恕我直言）作为入门指南并不是很好。要获得良好的参考，请使用官方[文档](http://docs.djangoproject.com)。除此之外，反复试验帮助我了解了很多关于 Django 的知识。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T21:48:44.763

我将把官方教程作为一个很好的入门者。

如果您也是 Python 新手（就像我 3 天前一样），但不是一般的编程，我**强烈**建议您获取 Python Pocket Reference（由 O'Reilly 出版）的副本。只是（必要的）比谷歌搜索更有助于找出某些东西应该如何工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T22:38:31.357

官方教程是一个很好的起点。
概述：[http](http://docs.djangoproject.com/en/dev/intro/overview/) ://docs.djangoproject.com/en/dev/intro/overview/ 教程：[http ://docs.djangoproject.com/en/dev/intro/tutorial01/](http://docs.djangoproject.com/en/dev/intro/tutorial01/)

之后，将[文档](http://docs.djangoproject.com)放在身边，并在破解过程中将其用作参考。

使用 django，如果没有命令行，您将无法真正做很多事情，您应该习惯它！

另外，您不会在命令行上花费“半小时”。只需几个命令即可设置您的项目并同步数据库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T15:48:53.710

不需要半个小时，也不应该认为开发主要是写代码。总是要进行设置工作等。话虽如此，我理解你的困境。您可能很幸运地找到了一个您感兴趣并且已经存在的项目。只需查看他们的最新版本，您就可以运行它，在本地四处寻找，如果您在代码上取得了一些实际进展，您可以贡献它，而不是以乱搞的名义浪费。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-28T08:46:22.923

如果您在 google 上进行快速搜索，它有一个很好的关于学习 python 的视频系列，麻省理工学院 26+ 视频系列也在 YouTube 上，所以它们可以作为很好的支持。

以及来自 Forrst.com 贡献者之一的 iTunes 上的 Gigantuan Django 视频系列。

# c# - 参数异常 - 参数无效（WinForm 上的 LinkLabel）

> ID：328962
> 
> 赞同：0
> 
> 时间：2008-11-30T15:38:16.807
> 
> 标签：c#, forms, gdi+, linklabel, argumentexception

我编写了一个 Win Forms 应用程序来测试 LinkLabel 类的工作方式。在我单击更改后的 LinkLabel 之前，它似乎很好。Form1.cs 代码如下：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Diagnostics;

namespace LinkLabelTest
{
// Editor: code not fully indented - laziness!
public partial class Form1 : Form
{

    public Form1()
    {  
            InitializeComponent();
    }

    private void btnLinkColor_Click(object sender, EventArgs e)
    {
        colorDialog1.ShowDialog();
        llblinkLabel1.LinkColor = colorDialog1.Color;
    }

    private void btnActiveLinkColor_Click(object sender, EventArgs e)
    {
        colorDialog1.ShowDialog();
        llblinkLabel1.ActiveLinkColor = colorDialog1.Color;
    }

    private void btnVisitedLinkColor_Click(object sender, EventArgs e)
    {
        colorDialog1.ShowDialog();
        llblinkLabel1.VisitedLinkColor = colorDialog1.Color;
    }

    private void llblinkLabel1_LinkClicked(object sender, LinkLabelLinkClickedEventArgs e)
    {

        try
        {

            if (!(e.Link.Description == null))
            {
                if (e.Button == MouseButtons.Right)
                {
                    PopulateLinkDetails(e.Link);
                }

                if (e.Button == MouseButtons.Left)
                {   
                    e.Link.Visited = true;
                    Debugger.Break();
                }
            }
        }
        catch (Exception exc)
        {
            Debugger.Break();
            MessageBox.Show(exc.Message.ToString());
        }   
    }

    private void PopulateLinkDetails(LinkLabel.Link link)
    {
        textDescription.Text = link.Description;
        textLinkData.Text = (string)link.LinkData;
        textName.Text = link.Name;
        checkBoxEnabled.Checked = link.Enabled;
        checkBoxVisited.Checked = link.Visited;
        nudLinkAreaStart.Value = link.Start;
        nudLinkAreaEnd.Value = link.Length;
    }

    private void Form1_Load(object sender, EventArgs e)
    {
            cmbLinkBehaviour.DataSource = Enum.GetValues(typeof(LinkBehavior));
    }

    private void cmbLinkBehaviour_SelectedIndexChanged(object sender, EventArgs e)
    {
        llblinkLabel1.LinkBehavior = (LinkBehavior)cmbLinkBehaviour.SelectedItem;
    }

    private void AddLink_Click(object sender, EventArgs e)
    {
            LinkLabel.Link link = new LinkLabel.Link();

            link.Description = textDescription.Text.ToString();
            link.LinkData = textLinkData.Text.ToString();
            link.Name = textName.Text.ToString();
            link.Enabled = checkBoxEnabled.Checked;
            link.Visited = checkBoxVisited.Checked;
            link.Start = (int)nudLinkAreaStart.Value;
            link.Length = (int)nudLinkAreaEnd.Value;

            llblinkLabel1.Links.Add(link);
    }

}
} 
```

堆栈跟踪如下：

> 在 System.Drawing.Region.GetHrgn(Graphics g) 在 System.Windows.Forms.Control.Invalidate(Region region, Boolean invalidateChildren) 在 System.Windows.Forms.LinkLabel.InvalidateLink(Link link) 在 System.Windows.Forms。 LinkLabel.OnGotFocus(EventArgs e) 在 System.Windows.Forms.Control.WmSetFocus(Message& m) 在 System.Windows.Forms.Control.WndProc(Message& m) 在 System.Windows.Forms.Label.WndProc(Message& m) 在System.Windows.Forms.LinkLabel.WndProc(Message& msg) 在 System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m) 在 System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m) 在 System.Windows。在 System.Windows.Forms.UnsafeNativeMethods.SetFocus(HandleRef hWnd) 在 System.Windows 的 Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)。System.Windows.Forms.Control.WmMouseDown(Message& m, MouseButtons button, Int32 clicks) 在 System.Windows.Forms.Control 的 System.Windows.Forms.LinkLabel.OnMouseDown(MouseEventArgs e) 的 Forms.Control.FocusInternal()。 WndProc(Message& m) 在 System.Windows.Forms.Label.WndProc(Message& m) 在 System.Windows.Forms.LinkLabel.WndProc(Message& msg) 在 System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m) 在System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m) 在 System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam) 在 System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG&味精）在 System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager。FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData) at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context) at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context) at System.Windows.Forms.Application.Run(Form mainForm) at LinkLabelTest.Program.Main() 在 C:\Users\Tony\Documents\Visual Studio 2008\Projects\LinkLabelTest\LinkLabelTest\Program.cs:line 22C:\Users\Tony\Documents\Visual Studio 2008\Projects\LinkLabelTest\LinkLabelTest\Program.cs:line 22 中的 Main()C:\Users\Tony\Documents\Visual Studio 2008\Projects\LinkLabelTest\LinkLabelTest\Program.cs:line 22 中的 Main()

下面是设计器生成的代码：

```
using System.Diagnostics;

namespace LinkLabelTest
{
// Editor: code not fully indented - laziness again!
partial class Form1
{
    /// <summary>
    /// Required designer variable.
    /// </summary>
    private System.ComponentModel.IContainer components = null;

    /// <summary>
    /// Clean up any resources being used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
    protected override void Dispose(bool disposing)
    {
            if (disposing && (components != null))
            {
                components.Dispose();
            }

            base.Dispose(disposing);
    }

    #region Windows Form Designer generated code

    /// <summary>
    /// Required method for Designer support - do not modify
    /// the contents of this method with the code editor.
    /// </summary>
    private void InitializeComponent()
    {

        this.llblinkLabel1 = new System.Windows.Forms.LinkLabel();
        this.colorDialog1 = new System.Windows.Forms.ColorDialog();
        this.btnLinkColor = new System.Windows.Forms.Button();
        this.btnActiveLinkColor = new System.Windows.Forms.Button();
        this.btnVisitedLinkColor = new System.Windows.Forms.Button();
        this.nudLinkAreaStart = new System.Windows.Forms.NumericUpDown();
        this.lbllabel1 = new System.Windows.Forms.Label();
        this.nudLinkAreaEnd = new System.Windows.Forms.NumericUpDown();
        this.lbllabel2 = new System.Windows.Forms.Label();
        this.cmbLinkBehaviour = new System.Windows.Forms.ComboBox();
        this.lbllabel3 = new System.Windows.Forms.Label();
        this.groupBox1 = new System.Windows.Forms.GroupBox();
        this.textDescription = new System.Windows.Forms.TextBox();
        this.label1 = new System.Windows.Forms.Label();
        this.textName = new System.Windows.Forms.TextBox();
        this.label2 = new System.Windows.Forms.Label();
        this.label3 = new System.Windows.Forms.Label();
        this.textLinkData = new System.Windows.Forms.TextBox();
        this.label4 = new System.Windows.Forms.Label();
        this.checkBoxEnabled = new System.Windows.Forms.CheckBox();
        this.AddLink = new System.Windows.Forms.Button();
        this.btnAmendLink = new System.Windows.Forms.Button();
        this.checkBoxVisited = new System.Windows.Forms.CheckBox();
        this.panel1 = new System.Windows.Forms.Panel();
        this.textBox1 = new System.Windows.Forms.TextBox();
        ((System.ComponentModel.ISupportInitialize)(this.nudLinkAreaStart)).BeginInit();
        ((System.ComponentModel.ISupportInitialize)(this.nudLinkAreaEnd)).BeginInit();
        this.groupBox1.SuspendLayout();
        this.panel1.SuspendLayout();
        this.SuspendLayout();
        // 
        // llblinkLabel1
        // 
        this.llblinkLabel1.AutoSize = true;
        this.llblinkLabel1.Location = new System.Drawing.Point(13, 27);
        this.llblinkLabel1.Name = "llblinkLabel1";
        this.llblinkLabel1.Size = new System.Drawing.Size(96, 13);
        this.llblinkLabel1.TabIndex = 0;
        this.llblinkLabel1.TabStop = true;
        this.llblinkLabel1.Text = "This is a link label !";
        this.llblinkLabel1.LinkClicked += new System.Windows.Forms.LinkLabelLinkClickedEventHandler(this.llblinkLabel1_LinkClicked);
        // 
        // btnLinkColor
        // 
        this.btnLinkColor.Location = new System.Drawing.Point(0, 19);
        this.btnLinkColor.Name = "btnLinkColor";
        this.btnLinkColor.Size = new System.Drawing.Size(93, 23);
        this.btnLinkColor.TabIndex = 2;
        this.btnLinkColor.Text = "LinkColor";
        this.btnLinkColor.UseVisualStyleBackColor = true;
        this.btnLinkColor.Click += new System.EventHandler(this.btnLinkColor_Click);
        // 
        // btnActiveLinkColor
        // 
        this.btnActiveLinkColor.Location = new System.Drawing.Point(0, 48);
        this.btnActiveLinkColor.Name = "btnActiveLinkColor";
        this.btnActiveLinkColor.Size = new System.Drawing.Size(93, 23);
        this.btnActiveLinkColor.TabIndex = 3;
        this.btnActiveLinkColor.Text = "ActiveLinkColor";
        this.btnActiveLinkColor.UseVisualStyleBackColor = true;
        this.btnActiveLinkColor.Click += new System.EventHandler(this.btnActiveLinkColor_Click);
        // 
        // btnVisitedLinkColor
        // 
        this.btnVisitedLinkColor.Location = new System.Drawing.Point(0, 77);
        this.btnVisitedLinkColor.Name = "btnVisitedLinkColor";
        this.btnVisitedLinkColor.Size = new System.Drawing.Size(93, 23);
        this.btnVisitedLinkColor.TabIndex = 4;
        this.btnVisitedLinkColor.Text = "VisitedLinkColor";
        this.btnVisitedLinkColor.UseVisualStyleBackColor = true;
        this.btnVisitedLinkColor.Click += new System.EventHandler(this.btnVisitedLinkColor_Click);
        // 
        // nudLinkAreaStart
        // 
        this.nudLinkAreaStart.Location = new System.Drawing.Point(152, 64);
        this.nudLinkAreaStart.Maximum = new decimal(new int[] {
        21,
        0,
        0,
        0});
        this.nudLinkAreaStart.Name = "nudLinkAreaStart";
        this.nudLinkAreaStart.Size = new System.Drawing.Size(66, 20);
        this.nudLinkAreaStart.TabIndex = 6;
        // 
        // lbllabel1
        // 
        this.lbllabel1.AutoSize = true;
        this.lbllabel1.Location = new System.Drawing.Point(224, 71);
        this.lbllabel1.Name = "lbllabel1";
        this.lbllabel1.Size = new System.Drawing.Size(74, 13);
        this.lbllabel1.TabIndex = 7;
        this.lbllabel1.Text = "Link area start";
        // 
        // nudLinkAreaEnd
        // 
        this.nudLinkAreaEnd.Location = new System.Drawing.Point(152, 99);
        this.nudLinkAreaEnd.Maximum = new decimal(new int[] {
        21,
        0,
        0,
        0});
        this.nudLinkAreaEnd.Name = "nudLinkAreaEnd";
        this.nudLinkAreaEnd.Size = new System.Drawing.Size(67, 20);
        this.nudLinkAreaEnd.TabIndex = 8;
        // 
        // lbllabel2
        // 
        this.lbllabel2.AutoSize = true;
        this.lbllabel2.Location = new System.Drawing.Point(224, 105);
        this.lbllabel2.Name = "lbllabel2";
        this.lbllabel2.Size = new System.Drawing.Size(83, 13);
        this.lbllabel2.TabIndex = 9;
        this.lbllabel2.Text = "Link area length";
        // 
        // cmbLinkBehaviour
        // 
        this.cmbLinkBehaviour.FormattingEnabled = true;
        this.cmbLinkBehaviour.Location = new System.Drawing.Point(0, 106);
        this.cmbLinkBehaviour.Name = "cmbLinkBehaviour";
        this.cmbLinkBehaviour.Size = new System.Drawing.Size(93, 21);
        this.cmbLinkBehaviour.TabIndex = 10;
        this.cmbLinkBehaviour.SelectedIndexChanged += new System.EventHandler(this.cmbLinkBehaviour_SelectedIndexChanged);
        // 
        // lbllabel3
        // 
        this.lbllabel3.AutoSize = true;
        this.lbllabel3.Location = new System.Drawing.Point(-3, 130);
        this.lbllabel3.Name = "lbllabel3";
        this.lbllabel3.Size = new System.Drawing.Size(78, 13);
        this.lbllabel3.TabIndex = 11;
        this.lbllabel3.Text = "Link Behaviour";
        // 
        // groupBox1
        // 
        this.groupBox1.Controls.Add(this.btnLinkColor);
        this.groupBox1.Controls.Add(this.btnActiveLinkColor);
        this.groupBox1.Controls.Add(this.lbllabel3);
        this.groupBox1.Controls.Add(this.btnVisitedLinkColor);
        this.groupBox1.Controls.Add(this.cmbLinkBehaviour);
        this.groupBox1.Location = new System.Drawing.Point(12, 57);
        this.groupBox1.Name = "groupBox1";
        this.groupBox1.Size = new System.Drawing.Size(124, 155);
        this.groupBox1.TabIndex = 13;
        this.groupBox1.TabStop = false;
        this.groupBox1.Text = "THE link label";
        // 
        // textDescription
        // 
        this.textDescription.Location = new System.Drawing.Point(152, 136);
        this.textDescription.Name = "textDescription";
        this.textDescription.Size = new System.Drawing.Size(100, 20);
        this.textDescription.TabIndex = 14;
        // 
        // label1
        // 
        this.label1.AutoSize = true;
        this.label1.Location = new System.Drawing.Point(259, 143);
        this.label1.Name = "label1";
        this.label1.Size = new System.Drawing.Size(60, 13);
        this.label1.TabIndex = 15;
        this.label1.Text = "Description";
        // 
        // textName
        // 
        this.textName.Location = new System.Drawing.Point(152, 163);
        this.textName.Name = "textName";
        this.textName.Size = new System.Drawing.Size(100, 20);
        this.textName.TabIndex = 16;
        // 
        // label2
        // 
        this.label2.AutoSize = true;
        this.label2.Location = new System.Drawing.Point(262, 170);
        this.label2.Name = "label2";
        this.label2.Size = new System.Drawing.Size(35, 13);
        this.label2.TabIndex = 17;
        this.label2.Text = "Name";
        // 
        // label3
        // 
        this.label3.AutoSize = true;
        this.label3.Location = new System.Drawing.Point(16, 11);
        this.label3.Name = "label3";
        this.label3.Size = new System.Drawing.Size(283, 13);
        this.label3.TabIndex = 18;
        this.label3.Text = "Right Click on a link to retrieve properties. Left Click to visit";
        // 
        // textLinkData
        // 
        this.textLinkData.Location = new System.Drawing.Point(152, 191);
        this.textLinkData.Name = "textLinkData";
        this.textLinkData.Size = new System.Drawing.Size(100, 20);
        this.textLinkData.TabIndex = 19;
        // 
        // label4
        // 
        this.label4.AutoSize = true;

        this.label4.Location = new System.Drawing.Point(262, 198);
        this.label4.Name = "label4";
        this.label4.Size = new System.Drawing.Size(53, 13);
        this.label4.TabIndex = 20;
        this.label4.Text = "Link Data";
        // 
        // checkBoxEnabled
        // 
        this.checkBoxEnabled.AutoSize = true;
        this.checkBoxEnabled.Location = new System.Drawing.Point(151, 218);
        this.checkBoxEnabled.Name = "checkBoxEnabled";
        this.checkBoxEnabled.Size = new System.Drawing.Size(65, 17);
        this.checkBoxEnabled.TabIndex = 21;
        this.checkBoxEnabled.Text = "Enabled";
        this.checkBoxEnabled.UseVisualStyleBackColor = true;
        // 
        // AddLink
        // 
        this.AddLink.Location = new System.Drawing.Point(385, 64);
        this.AddLink.Name = "AddLink";
        this.AddLink.Size = new System.Drawing.Size(75, 23);
        this.AddLink.TabIndex = 22;
        this.AddLink.Text = "Add Link";
        this.AddLink.UseVisualStyleBackColor = true;
        this.AddLink.Click += new System.EventHandler(this.AddLink_Click);
        // 
        // btnAmendLink
        // 
        this.btnAmendLink.Enabled = false;
        this.btnAmendLink.Location = new System.Drawing.Point(385, 99);
        this.btnAmendLink.Name = "btnAmendLink";
        this.btnAmendLink.Size = new System.Drawing.Size(75, 23);
        this.btnAmendLink.TabIndex = 23;
        this.btnAmendLink.Text = "AmendLink";
        this.btnAmendLink.UseVisualStyleBackColor = true;
        // 
        // checkBoxVisited
        // 
        this.checkBoxVisited.AutoSize = true;
        this.checkBoxVisited.Location = new System.Drawing.Point(151, 241);
        this.checkBoxVisited.Name = "checkBoxVisited";
        this.checkBoxVisited.Size = new System.Drawing.Size(57, 17);
        this.checkBoxVisited.TabIndex = 24;
        this.checkBoxVisited.Text = "Visited";
        this.checkBoxVisited.UseVisualStyleBackColor = true;
        // 
        // panel1
        // 
        this.panel1.Controls.Add(this.textBox1);
        this.panel1.Location = new System.Drawing.Point(474, 13);
        this.panel1.Name = "panel1";
        this.panel1.Size = new System.Drawing.Size(200, 239);
        this.panel1.TabIndex = 25;
        // 
        // textBox1
        // 
        this.textBox1.Dock = System.Windows.Forms.DockStyle.Fill;
        this.textBox1.Location = new System.Drawing.Point(0, 0);
        this.textBox1.Multiline = true;
        this.textBox1.Name = "textBox1";
        this.textBox1.Size = new System.Drawing.Size(200, 239);
        this.textBox1.TabIndex = 0;
        // 
        // Form1
        // 
        this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
        this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
        this.ClientSize = new System.Drawing.Size(704, 264);
        this.Controls.Add(this.panel1);
        this.Controls.Add(this.checkBoxVisited);
        this.Controls.Add(this.btnAmendLink);
        this.Controls.Add(this.AddLink);
        this.Controls.Add(this.checkBoxEnabled);
        this.Controls.Add(this.label4);
        this.Controls.Add(this.textLinkData);
        this.Controls.Add(this.label3);
        this.Controls.Add(this.label2);
        this.Controls.Add(this.textName);
        this.Controls.Add(this.label1);
        this.Controls.Add(this.textDescription);
        this.Controls.Add(this.groupBox1);
        this.Controls.Add(this.lbllabel2);
        this.Controls.Add(this.nudLinkAreaEnd);
        this.Controls.Add(this.lbllabel1);
        this.Controls.Add(this.nudLinkAreaStart);
        this.Controls.Add(this.llblinkLabel1);
        this.Name = "Form1";
        this.Text = "Form1";
        this.Load += new System.EventHandler(this.Form1_Load);
        ((System.ComponentModel.ISupportInitialize)(this.nudLinkAreaStart)).EndInit();
        ((System.ComponentModel.ISupportInitialize)(this.nudLinkAreaEnd)).EndInit();
        this.groupBox1.ResumeLayout(false);
        this.groupBox1.PerformLayout();
        this.panel1.ResumeLayout(false);
        this.panel1.PerformLayout();
        this.ResumeLayout(false);
        this.PerformLayout();

    }

    #endregion

    private System.Windows.Forms.LinkLabel llblinkLabel1;
    private System.Windows.Forms.ColorDialog colorDialog1;
    private System.Windows.Forms.Button btnLinkColor;
    private System.Windows.Forms.Button btnActiveLinkColor;
    private System.Windows.Forms.Button btnVisitedLinkColor;
    private System.Windows.Forms.NumericUpDown nudLinkAreaStart;
    private System.Windows.Forms.Label lbllabel1;
    private System.Windows.Forms.NumericUpDown nudLinkAreaEnd;
    private System.Windows.Forms.Label lbllabel2;
    private System.Windows.Forms.ComboBox cmbLinkBehaviour;
    private System.Windows.Forms.Label lbllabel3;
    private System.Windows.Forms.GroupBox groupBox1;
    private System.Windows.Forms.TextBox textDescription;
    private System.Windows.Forms.Label label1;
    private System.Windows.Forms.TextBox textName;
    private System.Windows.Forms.Label label2;
    private System.Windows.Forms.Label label3;
    private System.Windows.Forms.TextBox textLinkData;
    private System.Windows.Forms.Label label4;
    private System.Windows.Forms.CheckBox checkBoxEnabled;
    private System.Windows.Forms.Button AddLink;
    private System.Windows.Forms.Button btnAmendLink;
    private System.Windows.Forms.CheckBox checkBoxVisited;
    private System.Windows.Forms.Panel panel1;
    private System.Windows.Forms.TextBox textBox1;
}
} 
```

请有人建议。是 LinkLabel 的 Paint 事件发生时没有窗口句柄的问题。

提前谢谢了

托尼

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-04T07:48:06.430

以下示例代码显示了如何从 a 设置链接标签的颜色`ColorDialog`：

```
using (var colorDlg = new ColorDialog())
{
    if (colorDlg.ShowDialog() == DialogResult.OK)
    {
       llblinkLabel1.LinkColor = colorDlg.Color;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-04T08:10:52.020

```
 private void AddLink_Click(object sender, EventArgs e)
    {
        // do proper validation and add only proper links
        // this will help you to avoid the exception 
        if (!string.IsNullOrEmpty(textLinkData.Text) && 
            nudLinkAreaEnd.Value > 0 && 
            nudLinkAreaStart.Value >= 0 && 
            nudLinkAreaStart.Value < llblinkLabel1.Text.Length)
       {
           LinkLabel.Link link = new LinkLabel.Link();
           link.Description = textDescription.Text.ToString();
           link.LinkData = textLinkData.Text.ToString();
           link.Name = textName.Text.ToString();
           link.Enabled = checkBoxEnabled.Checked;
           link.Visited = checkBoxVisited.Checked;
           link.Start = (int)nudLinkAreaStart.Value;
           link.Length = (int)nudLinkAreaEnd.Value;
           try
           {
               llblinkLabel1.Links.Add(link); 
           }
           catch (InvalidOperationException exception) // links can't overlap 
           {
               MessageBox.Show("Links are overlaping");
           }

       } 
```

# python - long <-> str 二进制转换

> ID：328964
> 
> 赞同：6
> 
> 时间：2008-11-30T15:40:58.343
> 
> 标签：python, string, bignum

是否有任何库可以将很长的数字转换为仅复制数据的字符串？

这些单线太慢了：

```
def xlong(s):
    return sum([ord(c) << e*8 for e,c in enumerate(s)])

def xstr(x):
    return chr(x&255) + xstr(x >> 8) if x else ''

print xlong('abcd'*1024) % 666
print xstr(13**666) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T15:45:53.157

你想要结构模块。

```
packed = struct.pack('l', 123456)
assert struct.unpack('l', packed)[0] == 123456 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T16:13:23.413

怎么样

```
from binascii import hexlify, unhexlify

def xstr(x):
    hex = '%x' % x
    return unhexlify('0'*(len(hex)%2) + hex)[::-1]

def xlong(s):
    return int(hexlify(s[::-1]), 16) 
```

我没有计时，但它应该更快并且也可以处理更大的数字，因为它不使用递归。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-14T14:13:38.500

事实上，我缺少 long(s,256) 。我潜伏更多，发现 Python CAPI 文件“longobject.h”中有 2 个函数：

```
PyObject * _PyLong_FromByteArray( const unsigned char* bytes, size_t n, int little_endian, int is_signed);
int _PyLong_AsByteArray(PyLongObject* v, unsigned char* bytes, size_t n, int little_endian, int is_signed); 
```

他们做这项工作。我不知道为什么某些python模块中没有包含，或者如果我错了，请纠正我。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T17:21:12.370

如果您需要快速序列化，请使用[marshal](http://www.python.org/doc/2.5.2/lib/module-marshal.html)模块。它比您的方法快 400 倍左右。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T17:11:41.547

我猜你不关心字符串格式，你只是想要一个序列化？如果是这样，为什么不使用 Python 的内置序列化程序[cPickle](http://www.python.org/doc/2.5.2/lib/module-cPickle.html)模块呢？该`dumps`函数会将包括长整数在内的任何 python 对象转换为字符串，该`loads`函数是它的逆函数。如果您这样做是为了保存到文件中，也请查看`dump`and`load`函数。

```
>>> import cPickle
>>> print cPickle.loads(cPickle.dumps(13**666)) % 666
73
>>> print (13**666) % 666
73 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-30T18:01:58.060

`cPickle`与`marshal`（Python 2.5.2，Windows）的性能：

```
python -mtimeit -s"from cPickle import loads,dumps;d=13**666" "loads(dumps(d))"
1000 loops, best of 3: 600 usec per loop

python -mtimeit -s"from marshal import loads,dumps;d=13**666" "loads(dumps(d))"
100000 loops, best of 3: 7.79 usec per loop

python -mtimeit -s"from pickle import loads,dumps;d= 13**666" "loads(dumps(d))"
1000 loops, best of 3: 644 usec per loop 
```

`marshal`快得多。

# windows - 在 Amazon EC2 Windows 实例中自动挂载 EBS 卷

> ID：328965
> 
> 赞同：7
> 
> 时间：2008-11-30T15:42:07.547
> 
> 标签：windows, amazon-ec2, cloud, amazon-ebs

有谁知道在 Amazon 的[Elastic Compute Cloud](http://aws.amazon.com/ec2/) (EC2)中启动 Windows 2003 实例时如何自动挂载[Elastic Block Storage](http://aws.amazon.com/ebs/) (EBS) 卷？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-09T16:10:42.520

设置：

*   确保 EBS 卷已格式化和标记（在示例中我使用了标签 PDRIVE）。
*   使用 Ec2ConfigServiceSettings.exe 设置驱动器映射
*   在实例上安装 Java
*   安装 EC2 API 命令行工具
*   安装您的证书和私钥的副本
*   安装 curl.exe 的副本（开源工具）

您可以使用组策略编辑器将此脚本设置为您的启动脚本。有关详细信息，请参阅[http://technet.microsoft.com/en-us/library/cc739591(WS.10).aspx](http://technet.microsoft.com/en-us/library/cc739591(WS.10).aspx)。

```
REM @echo off
REM setlocal ENABLEDELAYEDEXPANSION

C:\WINDOWS\system32\eventcreate /l SYSTEM /t information /id 100 /so AttachEbsBoot /d "Starting attach-ebs-boot.cmd"

REM local variables
REM Make sure you include the directory with curl.exe and the EC2 command line tools in the path
set path=C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;c:\Utils;C:\ebin\ec2\bin
set JAVA_HOME=c:\java
set EC2_HOME=c:\ebin\ec2
set EC2_CERT=<your_cert>
set EC2_PRIVATE_KEY=<your_private_key>

REM Please note: you should use the Ec2 Config Serive Settings application to ensure
REM that your EBS volume is mapped to a particular drive letter.
REM
REM edit as needed
set EBS_DRIVE=P:
set EBS_DEVICE=xvdp

REM Test to see if the drive is already attached. If it is then we're done.
if exist %EBS_DRIVE%\nul (goto done)

REM get the EBS volume ID from the user data and the instance ID from the meta-data
for /f "delims=" %%a in ('curl http://169.254.169.254/latest/user-data') do (set EBS_VOLUME=%%a)
for /f "delims=" %%b in ('curl http://169.254.169.254/latest/meta-data/instance-id') do (set INSTANCE_ID=%%b)

C:\WINDOWS\system32\eventcreate /l SYSTEM /t information /id 102 /so AttachEbsBoot /d "Volume == %EBS_VOLUME%"
C:\WINDOWS\system32\eventcreate /l SYSTEM /t information /id 103 /so AttachEbsBoot /d "Instance == %INSTANCE_ID%"

REM attach the volume
REM 
REM Use a series of set command to build the command line
SET COMMAND_LINE=%EBS_VOLUME%
SET COMMAND_LINE=%COMMAND_LINE% -i
SET COMMAND_LINE=%COMMAND_LINE% %INSTANCE_ID%
SET COMMAND_LINE=%COMMAND_LINE% -d
SET COMMAND_LINE=%COMMAND_LINE% %EBS_DEVICE%

C:\WINDOWS\system32\eventcreate /l SYSTEM /t information /id 104 /so AttachEbsBoot /d "calling ec2attvole %COMMAND_LINE%"

call ec2attvol.cmd %COMMAND_LINE%

:DONE
C:\WINDOWS\system32\eventcreate /l SYSTEM /t information /id 101 /so AttachEbsBoot /d "Exiting attach-ebs-boot.cmd"

REM Events logged in the System event log
REM source === AttachEbsBoot
REM 
REM Event 100 - Script start
REM Event 101 - Script end
REM Event 102 - Volume ID
REM Event 103 - Instance ID
REM Event 104 - Command line for ec2attvol 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-07T23:12:23.920

[我在http://www.ioncannon.net/system-administration/199/automounting-amazon-ebs-volumes-on-ec2-instances/](http://www.ioncannon.net/system-administration/199/automounting-amazon-ebs-volumes-on-ec2-instances/)找到了以下 Ruby 代码，由 Carson McDonald 提供。它适用于 Linux/Unix，但也许你可以在 Windows 2003 上为 Ruby 重新调整它，或者让它作为其他脚本语言的模型。

请注意，您可以将内容作为用户数据传递到映像中，例如 ECS EBS 卷 ID 和设备名称（例如，以下示例中的 /dev/sdh 或 Windows 中的任何内容）。您可以从实例本身作为元数据访问用户数据，如下面大致完成的那样来获取实例 ID。更具体地说，您将访问[http://169.254.169.254/1.0/user-data](http://169.254.169.254/1.0/user-data)以获取用户数据。

```
#!/usr/bin/ruby

require 'rubygems'
require 'right_aws'
require 'net/http'

url = 'http://169.254.169.254/2008-02-01/meta-data/instance-id'
instance_id = Net::HTTP.get_response(URI.parse(url)).body

AMAZON_PUBLIC_KEY='your public key'
AMAZON_PRIVATE_KEY='your private key'
EC2_LOG_VOL='the volume id'

ec2 = RightAws::Ec2.new(AMAZON_PUBLIC_KEY, AMAZON_PRIVATE_KEY)

vol = ec2.attach_volume(EC2_LOG_VOL, instance_id, '/dev/sdh')
puts vol

# It can take a few seconds for the volume to become ready.
# This is just to make sure it is ready before mounting it.
sleep 20

system('mount /dev/sdh /mymountpoint') 
```

# comparison - 彻底使用“if”语句或“try/catch”块？

> ID：328976
> 
> 赞同：9
> 
> 时间：2008-11-30T15:53:35.213
> 
> 标签：comparison, if-statement, try-catch

给我一些关于哪个是更好的编码实践/使代码更高效/看起来更漂亮/无论如何的想法：增加和提高使用 if 语句来预测和捕捉潜在问题的能力？或者只是简单地利用 try/catch？

假设这是针对 Java 的（如果重要的话）。

**编辑：** 我目前正在摆脱一些公认的过时和受限制的当前编码实践，但我对这样做的必要性有点担心（例如this）。我只是在询问对此的一些看法。不是辩论。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T16:12:32.993

这场辩论（2003 年）很好：

[http://www.joelonsoftware.com/items/2003/10/13.html](http://www.joelonsoftware.com/items/2003/10/13.html)

[http://nedbatchelder.com/blog/200310/joel_on_exceptions.html](http://nedbatchelder.com/blog/200310/joel_on_exceptions.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T16:03:41.917

`if`块稍微快一些；如果您不需要十几个，那么它们是一个比`try/catches`. 异常应该是异常的，而不是每次代码运行时。我将异常用于服务器断开等罕见事件（即使它们每天发生几次），并`if`阻止我的任何可控变量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T16:17:53.497

无论您正在编写什么代码，您最终都会同时使用这两种代码。我不能说 Java 运行时，但在 .NET 运行时，使用 try-catch 块会降低性能。因此，我尝试仅在我有明确方法处理一旦捕获的异常的区域中使用它们（即使它只是记录问题的存在）。

如果您发现自己在代码中使用了大量的 try-catch 块或 if-else 块，或者您的方法往往相当长，请考虑将代码重构为大量较小的方法。您的逻辑意图将更容易遵循 - 以及更容易进行单元测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T16:17:16.790

我认为如果陈述更好。你不能用 try..catch 包围每一行代码（你可以，但你不应该这样做）。你可以用 try catch 包围一段代码，但不是每一行。

例外会减慢速度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T15:59:31.223

我的 2p：最好使用 try/catch：

*   它使其他编码人员绝对清楚您正在执行异常处理
*   编译器了解您在做什么，并且可以为您执行更合适的编译时检查

根据我的经验，使用 if-conditional-logic 会使错误处理与业务逻辑区分开来变得更加困难。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-21T13:55:58.370

更有经验的开发人员和分析师告诉我，try/catch 更加面向对象，if 更加程序化。

我个人不在乎。

我知道 try/catch 较慢并导致性能下降的事实，但如果我要使用十几个 if 来验证，然后才能做我想做的事，我将始终使用 try/ catch 以节省代码行数。

它使我的生活变得更加轻松，无需验证任何内容，如果语句失败，只需执行我在“else”块中所做的事情......在我的“catch”块中。

有时，我显然将一些 if 语句包含在 try/catch 中，但无论如何。

如果在做我需要做的事情之前只有少量的事情需要验证（1 或 2），我会使用 if。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-26T16:14:47.473

有一件事在这里没有提到。

使用 if-else 语句，每次代码运行时，保证至少有 1 个条件被执行。我相信我们都知道 if-else-elseif 是如何工作的，但要清楚......语句的**if**部分将始终被评估，如果它是 false 则下面的**else-if**被评估，依此类推，直到只有**else**需要评估。

所以使用 if-else 语句会影响你的表现。不显着（在大多数情况下），但执行评估确实需要 CPU 时间。

try-catch 语句，如果我错了，请纠正我，在需要它们之前不要在运行时考虑（即抛出异常）。因此，简单地将代码包装在 try-catch 中不会影响性能，直到它实际捕获到异常为止。

此外，导致性能下降的不是接球，而是投掷。

重要的一点是，try-catch 语句永远不应该用于条件逻辑。它们应该只用于它们的设计目的：异常处理！

如果您知道如何处理异常，则捕获异常是必不可少的。如果您无法正确处理异常，那么您应该放手，因为链上的某些代码可能有更好的方法来处理它。

在应用程序的绝对顶级有一个异常处理程序以在用户看到异常之前捕获它们通常是一个好主意。在 ASP.NET 中，您可以在 global.asax 的 Application_Error 事件中执行此操作。在其他语言/环境中，您可以在主循环中执行此操作，无论它可能是什么。

但请注意，有一些例外总是最好不要被抓住。有时，当异常发生时，它表明您的应用程序的状态已受到严重破坏并且无法信任。唯一安全的做法是杀死并重新启动。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-26T16:40:38.187

@PersonalPerson - 对不起，但这只是懒惰的编码。与其因为 if 语句太多而使用 try-catch，不如重构您的代码（即将您的验证逻辑放在它自己的方法中）。这将使您的代码更清晰、更具可读性，并保持最佳性能实践。

永远不要尝试编写代码来实现最少的行数。这总会以糟糕的结局告终。当然，您可以找到一种更优雅的方式来编写您的编码伙伴会赞不绝口的东西，但这只会使事情变得不那么可读。

我发誓，我以前用过你的代码，这让我很头疼。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-14T00:01:58.030

使用异常是一种通用方法，可以通知代码的其他部分以松散耦合的方式发生了错误。想象一下，如果您想通过使用 if.. nad else.. 来处理一些异常情况，您需要在代码的不同部分插入一些任意变量和其他可能很容易导致很快出现意大利面条代码的东西。

接下来假设您正在使用任何外部库/包，并且作者决定在他/她的代码中放入其他任意方式来处理错误状态 - 它会迫使您调整处理它的方式 - 例如您需要检查特定方法是否返回 true 或 false 或其他。

使用异常可以更容易地处理错误——你只是假设如果出现问题——其他代码会抛出异常，所以你只需将代码包装在 try 块中并以自己的方式处理可能的异常。

# c# - 最佳实践：何时分派回 UI 线程

> ID：328980
> 
> 赞同：0
> 
> 时间：2008-11-30T15:54:40.783
> 
> 标签：c#, wpf

我有一个关于最佳协议的问题。当使用如下两种辅助加载方法时，何时是向 UI 发送回调的最佳时间？Button1 在返回时使用 Dispatcher，而 Button2 允许帮助加载类封装对 Dispatcher 的调用。我倾向于支持Button2。

```
private void Button1_Click(object sender, RoutedEventArgs e)
{
    AsyncLoader.LoadAsyncWithoutDispatcher(delegate(string result)
    {
        this.Dispatcher.Invoke((Action)delegate { this.TextBox1.Text = result; });
    });
}

private void Button2_Click(object sender, RoutedEventArgs e)
{
    AsyncLoader.LoadAsyncWithDispatcher(this.Dispatcher, delegate(string result)
    {
        this.TextBox1.Text = result;
    });
}

class AsyncLoader
{
    public static void LoadAsyncWithoutDispatcher(Action<string> completed)
    {
        var worker = new AsyncClass();
        worker.BeginDoWork(delegate(IAsyncResult result)
        {
            string returnValue = worker.EndDoWork(result);
            completed(returnValue);
        }, null);
    }

    public static void LoadAsyncWithDispatcher(Dispatcher dispatcher, Action<string> completed)
    {
        var worker = new AsyncClass();
        worker.BeginDoWork(delegate(IAsyncResult result)
        {
            string returnValue = worker.EndDoWork(result);
            dispatcher.Invoke(completed, returnValue);
        }, null);
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-30T17:56:09.367

如果代码是通用的并且对 WPF 基础结构不是很紧，那么第一种方法肯定更通用，因为它完全忽略了调度程序对象的使用。如果您的类与 WPF 紧密集成，则第二种方法是更好的做法，因为您必须使用 Dispatcher 调用该方法。在第一种方法中，可以根本不指定调度程序。这当然不是 WPF 中推荐的东西。*********