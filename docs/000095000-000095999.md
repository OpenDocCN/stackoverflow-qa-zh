# StackOverflow 问答 000095000-000095999

# c# - 在 UpdatePanel 中的 ASP.NET AJAX 回发期间更新客户端 javascript 数组变量的最简单方法？

> ID：95005
> 
> 赞同：3
> 
> 时间：2008-09-18T17:59:10.690
> 
> 标签：c#, javascript, asp.net-ajax

如果我想在整个页面回发期间将全局范围的数组变量注入页面的客户端 javascript，我可以使用：

```
this.Page.ClientScript.RegisterArrayDeclaration("WorkCalendar", "\"" + date.ToShortDateString() + "\""); 
```

在页面上声明和填充客户端 javascript 数组。很好很简单。

但我想从 UpdatePanel 的异步回发中做同样的事情。

到目前为止，我能想到的最接近的方法是创建一个仅包含 var 声明的 .js 文件，在异步回发期间更新文件，然后使用 a`ScriptManagerProxy.Scripts.Add`将 .js 文件添加到页面的全局范围。

有没有更简单的？你做错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T00:26:09.590

使用静态方法 System.Web.UI.ScriptManager.AddStartupScript()

该脚本将在所有完整和部分回发上运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-26T12:00:59.393

山姆是对的。ScriptManager.RegisterStartupScript 是函数的正确名称。它将在所有完整和部分页面更新上运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:07:09.797

您还可以更新更新面板内的隐藏标签，该标签允许您写出您喜欢的任何 javascript。我建议尽管使用 Web 服务甚至页面方法来获取您需要的数据，而不是使用更新面板。

示例：myLabel.Text = "...."; ... 将您的逻辑放入其中，或者您可以将 [WebMethod] 添加到任何公共静态页面方法并直接返回数据。

# math - 解释 R 中的 quantile() 函数

> ID：95007
> 
> 赞同：75
> 
> 时间：2008-09-18T17:59:19.583
> 
> 标签：math, r, statistics

我整天都对 R 分位数函数感到困惑。

我对分位数的工作方式和统计数据有一个直观的概念，但是天哪，天哪，它的文档让我感到困惑。

从文档：

> Q[i](p) = (1 - 伽马) x[j] + 伽马 x[j+1],

到目前为止，我已经同意了。对于*第 i*类分位数，它是 x[j] 和 x [j+1] 之间的插值，基于一些神秘的常数*gamma*

> 其中 1 <= i <= 9, (jm)/n <= p < (j-m+1)/ n, x[j] 是第 j 阶统计量，n 是样本量，m 是确定的常数按样本分位数类型。这里 gamma 取决于 g = np+mj 的小数部分。

那么，如何计算j呢？米？

> 对于连续样本分位数类型（4 到 9），样本分位数可以通过 k 阶统计量和 p(k) 之间的线性插值获得：
> 
> p(k) = (k - alpha) / (n - alpha - beta + 1)，其中 α 和 β 是由类型决定的常数。此外，m = alpha + p(1 - alpha - beta)，并且 gamma = g。

现在我真的迷路了。p，以前是一个常数，现在显然是一个函数。

所以对于类型 7 分位数，默认...

> 类型 7
> 
> p(k) = (k - 1) / (n - 1)。在这种情况下，p(k) = mode[F(x[k])]。这是 S 使用的。

有人想帮我吗？特别是我对 p 是一个函数和一个常数的符号感到困惑，这到底是什么*m*，现在要为某些特定的*p*计算 j 。

我希望根据这里的答案，我们可以提交一些修改后的文档，以更好地解释这里发生的事情。

[quantile.R 源代码](https://svn.r-project.org/R/trunk/src/library/stats/R/quantile.R) 或类型：quantile.default

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-09-22T23:58:43.997

你的困惑是可以理解的。那个文档很糟糕。我不得不回到基于 (Hyndman, RJ; Fan, Y. (November 1996). "Sample Quantiles in Statistical Packages". *American Statistician* 50 (4): 361–365\. [doi:10.2307/2684934](http://dx.doi.org/10.2307%2F2684934) )的论文获得理解。让我们从第一个问题开始。

> 其中 1 <= i <= 9, (jm)/n <= p < (j-m+1)/ n, x[j] 是第 j 阶统计量，n 是样本量，m 是确定的常数按样本分位数类型。这里 gamma 取决于 g = np+mj 的小数部分。

第一部分直接来自论文，但文档作者省略的是`j = int(pn+m)`. 这意味着`Q[i](p)`仅取决于最接近`p`通过（排序的）观察结果的一小部分的两个顺序统计量。（对于像我这样不熟悉这个术语的人来说，一系列观察的“顺序统计”就是排序序列。）

此外，最后一句话是错误的。它应该读

> 这里 gamma 取决于 np+m 的小数部分，g = np+mj

至于`m`那是直截了当的。 `m`取决于选择了 9 种算法中的哪一种。所以就像`Q[i]`是分位数函数，`m`应该考虑`m[i]`。对于算法 1 和 2，`m`是 0，对于 3，`m`是 -1/2，对于其他算法，这是在下一部分。

> 对于连续样本分位数类型（4 到 9），样本分位数可以通过 k 阶统计量和 p(k) 之间的线性插值获得：
> 
> p(k) = (k - alpha) / (n - alpha - beta + 1)，其中 α 和 β 是由类型决定的常数。此外，m = alpha + p(1 - alpha - beta)，并且 gamma = g。

这真的很令人困惑。文档所称`p(k)`的`p`与以前的不同。 `p(k)`是[绘图位置](http://mathworld.wolfram.com/PlottingPosition.html)。在论文中，作者将其写为`p`[`k`]，这很有帮助。尤其是因为在 for 的表达式中`m`，the`p`是原始的`p`，而`m = alpha + p * (1 - alpha - beta)`. 从概念上讲，对于算法 4-9，点 ( `p`[`k`], `x[k]`) 被插值以获得解 ( `p`, `Q[i](p)`)。每种算法仅在`p`[`k`].

至于最后一点，R 只是说明 S 使用什么。

原始论文给出了 6 个“样本分位数的理想属性”函数的列表，并声明了对 #8 的偏好，它满足所有 1。#5 满足所有这些，但他们不喜欢其他理由（它是比从原理派生的更现象学的）。＃2 是像我这样的非统计极客会考虑分位数，并且是维基百科中描述的内容。

顺便说一句，为了回应[dreeves 的回答](https://stackoverflow.com/questions/95007/explain-the-quantile-function-in-r/397303#397303)，Mathematica 的做法明显不同。我想我理解映射。虽然 Mathematica 更容易理解，但 (a) 使用无意义的参数更容易在脚上射击自己，并且 (b) 它不能执行 R 的算法 #2。（这是[Mathworld 的 Quantile 页面](http://mathworld.wolfram.com/Quantile.html)，其中指出 Mathematica 无法做到 #2，但根据四个参数对所有其他算法进行了更简单的概括。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-18T18:49:09.870

当您给它一个向量并且没有已知的 CDF 时，有多种计算分位数的方法。

考虑一下当您的观察结果不完全落在分位数上时该怎么办的问题。

“类型”只是确定如何做到这一点。因此，这些方法说，“在 k 阶统计量和 p(k) 之间使用线性插值”。

那么，什么是 p(k)？一个人说，“好吧，我喜欢使用 k/n”。另一个人说，“我喜欢使用 (k-1)/(n-1)”等。这些方法中的每一种都有不同的属性，更适合一个或另一个问题。

\alpha 和 \beta 只是参数化函数 p 的方法。在一种情况下，它们是 1 和 1。在另一种情况下，它们是 3/8 和 -1/4。我不认为 p 在文档中是一个常数。他们只是并不总是明确地显示依赖关系。

当您放入像 1:5 和 1:6 这样的向量时，看看不同类型会发生什么。

（另请注意，即使您的观察结果恰好落在分位数上，某些类型仍将使用线性插值）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-11-07T18:15:19.127

我相信在@RobHyndman 的评论中提到的修订之后，R 帮助文档很清楚，但我发现它有点压倒性。我发布此答案以防它帮助某人快速了解选项及其假设。

为了掌握`quantile(x, probs=probs)`，我想查看源代码。这也比我在 R 中预期的要棘手，所以我实际上只是从一个看起来足够近可以运行的[github 存储库中获取它。](https://github.com/SurajGupta/r-source/blob/master/src/library/stats/R/quantile.R)我对默认（类型 7）行为感兴趣，所以我注释了一些，但没有对每个选项做同样的事情。

您可以看到“类型 7”方法是如何在代码中逐步插入的，我还添加了几行来打印一些重要的值。

```
quantile.default <-function(x, probs = seq(0, 1, 0.25), na.rm = FALSE, names = TRUE
         , type = 7, ...){
    if(is.factor(x)) { #worry about non-numeric data
        if(!is.ordered(x) || ! type %in% c(1L, 3L))
            stop("factors are not allowed")
        lx <- levels(x)
    } else lx <- NULL
    if (na.rm){
        x <- x[!is.na(x)]
    } else if (anyNA(x)){
        stop("missing values and NaN's not allowed if 'na.rm' is FALSE")
        }
    eps <- 100*.Machine$double.eps #this is to deal with rounding things sensibly
    if (any((p.ok <- !is.na(probs)) & (probs < -eps | probs > 1+eps)))
        stop("'probs' outside [0,1]")

    #####################################
    # here is where terms really used in default type==7 situation get defined

    n <- length(x) #how many observations are in sample?

    if(na.p <- any(!p.ok)) { # set aside NA & NaN
        o.pr <- probs
        probs <- probs[p.ok]
        probs <- pmax(0, pmin(1, probs)) # allow for slight overshoot
    }

    np <- length(probs) #how many quantiles are you computing?

    if (n > 0 && np > 0) { #have positive observations and # quantiles to compute
        if(type == 7) { # be completely back-compatible

            index <- 1 + (n - 1) * probs #this gives the order statistic of the quantiles
            lo <- floor(index)  #this is the observed order statistic just below each quantile
            hi <- ceiling(index) #above
            x <- sort(x, partial = unique(c(lo, hi))) #the partial thing is to reduce time to sort, 
            #and it only guarantees that sorting is "right" at these order statistics, important for large vectors 
            #ties are not broken and tied elements just stay in their original order
            qs <- x[lo] #the values associated with the "floor" order statistics
            i <- which(index > lo) #which of the order statistics for the quantiles do not land on an order statistic for an observed value

            #this is the difference between the order statistic and the available ranks, i think
            h <- (index - lo)[i] # > 0  by construction 
            ##      qs[i] <- qs[i] + .minus(x[hi[i]], x[lo[i]]) * (index[i] - lo[i])
            ##      qs[i] <- ifelse(h == 0, qs[i], (1 - h) * qs[i] + h * x[hi[i]])
            qs[i] <- (1 - h) * qs[i] + h * x[hi[i]] # This is the interpolation step: assemble the estimated quantile by removing h*low and adding back in h*high. 
            # h is the arithmetic difference between the desired order statistic amd the available ranks
            #interpolation only occurs if the desired order statistic is not observed, e.g. .5 quantile is the actual observed median if n is odd. 
            # This means having a more extreme 99th observation doesn't matter when computing the .75 quantile

            ###################################
            # print all of these things

            cat("floor pos=", c(lo))
            cat("\nceiling pos=", c(hi))
            cat("\nfloor values= ", c(x[lo]))
            cat( "\nwhich floors not targets? ", c(i))
            cat("\ninterpolate between ", c(x[lo[i]]), ";", c(x[hi[i]]))
            cat( "\nadjustment values= ", c(h))
            cat("\nquantile estimates:")

    }else if (type <= 3){## Types 1, 2 and 3 are discontinuous sample qs.
                nppm <- if (type == 3){ n * probs - .5 # n * probs + m; m = -0.5
                } else {n * probs} # m = 0

                j <- floor(nppm)
                h <- switch(type,
                            (nppm > j),     # type 1
                            ((nppm > j) + 1)/2, # type 2
                            (nppm != j) | ((j %% 2L) == 1L)) # type 3

                } else{
                ## Types 4 through 9 are continuous sample qs.
                switch(type - 3,
                       {a <- 0; b <- 1},    # type 4
                       a <- b <- 0.5,   # type 5
                       a <- b <- 0,     # type 6
                       a <- b <- 1,     # type 7 (unused here)
                       a <- b <- 1 / 3, # type 8
                       a <- b <- 3 / 8) # type 9
                ## need to watch for rounding errors here
                fuzz <- 4 * .Machine$double.eps
                nppm <- a + probs * (n + 1 - a - b) # n*probs + m
                j <- floor(nppm + fuzz) # m = a + probs*(1 - a - b)
                h <- nppm - j

                if(any(sml <- abs(h) < fuzz)) h[sml] <- 0

            x <- sort(x, partial =
                          unique(c(1, j[j>0L & j<=n], (j+1)[j>0L & j<n], n))
            )
            x <- c(x[1L], x[1L], x, x[n], x[n])
            ## h can be zero or one (types 1 to 3), and infinities matter
            ####        qs <- (1 - h) * x[j + 2] + h * x[j + 3]
            ## also h*x might be invalid ... e.g. Dates and ordered factors
            qs <- x[j+2L]
            qs[h == 1] <- x[j+3L][h == 1]
            other <- (0 < h) & (h < 1)
            if(any(other)) qs[other] <- ((1-h)*x[j+2L] + h*x[j+3L])[other]

            } 
    } else {
        qs <- rep(NA_real_, np)}

    if(is.character(lx)){
        qs <- factor(qs, levels = seq_along(lx), labels = lx, ordered = TRUE)}
    if(names && np > 0L) {
        names(qs) <- format_perc(probs)
    }
    if(na.p) { # do this more elegantly (?!)
        o.pr[p.ok] <- qs
        names(o.pr) <- rep("", length(o.pr)) # suppress <NA> names
        names(o.pr)[p.ok] <- names(qs)
        o.pr
    } else qs
}

####################

# fake data
x<-c(1,2,2,2,3,3,3,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,7,99)
y<-c(1,2,2,2,3,3,3,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,7,9)
z<-c(1,2,2,2,3,3,3,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,7)

#quantiles "of interest"
probs<-c(0.5, 0.75, 0.95, 0.975)

# a tiny bit of illustrative behavior
quantile.default(x,probs=probs, names=F)
quantile.default(y,probs=probs, names=F) #only difference is .975 quantile since that is driven by highest 2 observations
quantile.default(z,probs=probs, names=F) # This shifts everything b/c now none of the quantiles fall on an observation (and of course the distribution changed...)... but 
#.75 quantile is stil 5.0 b/c the observations just above and below the order statistic for that quantile are still 5\. However, it got there for a different reason.

#how does rescaling affect quantile estimates?
sqrt(quantile.default(x^2, probs=probs, names=F))
exp(quantile.default(log(x), probs=probs, names=F)) 
```

# ado - 使用 ADO 删除连接表中的行

> ID：95041
> 
> 赞同：1
> 
> 时间：2008-09-18T18:03:04.143
> 
> 标签：ado, dao

现在我在[另一个论坛](http://www.access-programmers.co.uk/forums/showthread.php?t=95929)上看到了这个问题，但没有一个可以接受的答案。

假设我有两个表，Groups 表和 Elements 表。这些表没有定义的关系。Elements 表有一个 IdGroup 字段，该字段引用 Groups 表的 IdGroup (PK) 字段。

我通过 ADO 记录集使用以下查询将表值填充到数据网格：

```
SELECT Elements.*, Groups.GroupName
FROM Elements
INNER JOIN Groups ON Elements.IdGroup = Groups.IdGroup 
```

从那个网格中，我想按 Delete 键来删除一个元素。这是我的问题。当我使用 DAO 时，DAO Delete() 函数只删除了 Elements 组中的记录。这是预期的行为。

当我更改为 ADO 时，Delete() 函数删除了两个表中的记录，元素记录和元素所属的组！

有没有办法在 ADO 中重现 DAO 行为而不必在表中定义关系？

注意：我知道有其他选择（执行 DELETE 查询可以完成这项工作）。只是告诉我一种在 ADO 中执行此操作的方法，或者说它无法完成。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-08T12:19:45.017

将您的查询重写为：

*   用包含 EXISTS 的 WHERE 子句替换 INNER JOIN；
*   在 SELECT 子句中使用子查询来返回 Groups.GroupName 的值。

例子：

```
SELECT Elements.*, 
       (
        SELECT Groups.GroupName
          FROM Groups 
         WHERE Elements.IdGroup = Groups.IdGroup
       )
  FROM Elements
 WHERE EXISTS (
               SELECT * 
                 FROM Groups 
                WHERE Elements.IdGroup = Groups.IdGroup
              ); 
```

我已经使用 SQL Server 2008 进行了测试，其中 ADO 记录集设置为 Microsoft OLEDB Datagrid 控件（MSDATGRD.OCX）的 DataSource 属性，然后通过网格删除该行（我假设你正在做类似的事情）并且该行确实是仅从表元素中删除（即组中的行保持未删除）。

请注意，在获取行时，修改后的查询可能会对性能产生负面影响。

# drupal - 学习 drupal 快速通道：如何创建 stackoverflow 克隆？

> ID：95053
> 
> 赞同：2
> 
> 时间：2008-09-18T18:03:58.713
> 
> 标签：drupal

我已经开始弄清楚drupal，到目前为止，大多数结果都很丑陋。可能我需要在类似于现实生活项目的东西中学习它。我想——重现这个网站的功能可能是一个很好的学习项目。但我需要帮助。:)

不假设这个站点是基于drupal的（它很可能不是——我认为它太快了）有没有一种方法可以用现有的方法来构建功能相似的东西（是的，更慢，如果不像这个那么花哨，但是很接近） drupal 模块和方案（或进行最少的调整）？

还是drupal不够好？或者——对于一个学生来说，这个项目太复杂了吗？

哪些现有的模块和方案可能有助于构建类似的东西？

（没有与 stackoverflow 竞争的意图。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T18:05:39.350

首先，Drupal 绝不是一个缓慢的系统，实际上它运行良好。

其次，这已经在这里被问和回答[了](https://stackoverflow.com/questions/32638/which-cms-or-other-framework-to-develop-a-stackoverflow-like-site#32652)。

顺便说一下，Drupal 的学习曲线中等，但是一旦你学会了如何使用，你会发现它很简单，你会发现它几乎可以满足你想要用它做的所有事情。它的插件系统非常棒，而且对 SEO 非常友好（我发誓我没有从 Drupal 获得报酬，我只是碰巧非常喜欢它）

如果您想看一下，我的[网站是用 drupal 制作的（虽然是西班牙语）。](http://www.thealphasite.org/en/intermedio/patrones_de_dise_o_strategy)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-04T13:41:38.463

- 有没有办法用现有的drupal模块和方案（或最小的调整）在功能上构建类似[to stackoverflow]的东西？

通过尝试制作一个真实世界的项目来尝试学习新技术是一个好主意。但是，如果您打算实际学习drupal，然后尝试通过现有模块和“少量调整”来解决问题，那么您可能学不到很多东西！

-或者drupal还不够好？Drupal 当然能够实现这里实现的功能类型，甚至更多。

- 或者 - 对于学生来说，这是否太复杂的项目？这取决于学生。不同的人有不同的能力。你的旅费可能会改变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-21T11:21:28.653

一些可能有帮助的建议：

*   它有一个 Drupal**发行版**......（不仅仅是一个“模块”），即[ArrayShift](https://www.drupal.org/project/arrayshift)。引用其项目页面：

    > 一个问答站点，旨在模拟 StackExchange 平台上站点的核心功能，例如：
    > 
    > *   [堆栈溢出](https://stackoverflow.com/)。
    > *   [Drupal 答案](https://drupal.stackexchange.com/)。

*   它有一个 Drupal**主题**，即[ArrayShift Theme](https://www.drupal.org/project/as_theme)。这是一个屏幕截图（来自其项目页面）：

![在此处输入图像描述](https://i.stack.imgur.com/hjjn9.png)

直到最近，它一直处于一种不受支持的状态，尽管更新的项目页面包含一个路线图，可以让它在 D7（以及稍后的 D8）中再次运行。

披露：我是[ArrayShift](https://www.drupal.org/project/arrayshift)（及其相关模块和主题）的（新）维护者，
我希望这不会违反网站[关于自我推广的政策](https://drupal.stackexchange.com/faq#promotion)。

# java - Java：开始学习基本网络的最佳场所

> ID：95055
> 
> 赞同：10
> 
> 时间：2008-09-18T18:04:02.207
> 
> 标签：java, networking

我正在尝试用 Java 编写一个简单的网络聊天程序。我几乎没有网络经验。我想知道我应该开始查看哪些资源（当然在这里）。

目前最好还是坚持使用核心 Java API。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-18T18:07:05.023

我从 sun 自己的网站上找到了一个很棒的网络和 java 教程：http: [//download.oracle.com/javase/tutorial/networking/TOC.html](http://download.oracle.com/javase/tutorial/networking/TOC.html)

套接字部分甚至让您编写一个迷你客户端/服务器聊天演示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T18:17:38.617

我建议你先学习网络。如果您有时间阅读[Tanenbaum 书](https://rads.stackoverflow.com/amzn/click/com/0133499456)，这是网络中最大的参考。如果您想快速了解一下，这里有一张路线图：

*   OSI 层
*   UDP 和 TCP/IP
*   插座
*   广播和组播
*   网络安全

然后使用 Java：Socket、ServerSocket、DatagramSocket、RMI 等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T18:07:27.613

[Nio](http://en.wikipedia.org/wiki/New_I/O)还是传统方式用[ServerSocket](http://java.sun.com/j2se/1.4.2/docs/api/java/net/ServerSocket.html)或[Socket](http://java.sun.com/j2se/1.4.2/docs/api/java/net/Socket.html) 见[java.net 包](http://java.sun.com/j2se/1.4.2/docs/api/java/net/package-summary.html)

Nio 文档[在这里](http://java.sun.com/j2se/1.4.2/docs/api/java/nio/package-summary.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T18:07:31.030

Sun 的 Java API 和[官方教程](http://java.sun.com/docs/books/tutorial/networking/index.html)可能是您开始学习的最佳场所。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T18:13:39.610

它比你想象的要简单得多。老实说，我只是开始浏览 nio 包的 javadocs。它们甚至应该包含迷你教程和源代码。

除此之外，java.sun.com 应该到处都是教程。

如果您不了解套接字——我可以向您发送参考资料，但告诉您更容易——套接字是 2 个程序相互通信的一种方式。它们只是一个唯一编号（当与您的 IP 地址结合使用时）为您提供通往程序的唯一路径。因此，如果我在端口（套接字）1000 上“监听”，那么另一个程序连接到端口 1000，连接程序发送的任何内容，监听程序都会接收。

使用较高的端口号（例如，高于 5000），因为有许多程序会分配自己的端口。

这就是您计算机上几乎所有东西的通信方式。

如果 API 仍然令人困惑，您可能需要阅读关于套接字通信的简短介绍。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-10T18:51:30.050

这是一个非常基本的、易于阅读的 Java 网络教程：

[http://tutorials.jenkov.com/java-networking/index.html](http://tutorials.jenkov.com/java-networking/index.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T18:10:59.710

谷歌是你的朋友。搜索“java socket 编程教程”或类似的东西，你会得到很多结果，包括 zxcv 建议的结果以及这些：

[http://www.javaworld.com/javaworld/jw-12-1996/jw-12-sockets.html](http://www.javaworld.com/javaworld/jw-12-1996/jw-12-sockets.html)

[http://www.cafeaulait.org/books/jnp/javanetexamples/index.html](http://www.cafeaulait.org/books/jnp/javanetexamples/index.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T18:24:51.440

“Head First Java”是一本很棒的初学者书籍，他们提供了有关创建简单聊天程序的教程。

[http://oreilly.com/catalog/9780596004651/](http://oreilly.com/catalog/9780596004651/)

# sharepoint - 如何自动化将 InfoPath 表单部署到 SharePoint Server 2007 的过程？

> ID：95059
> 
> 赞同：6
> 
> 时间：2008-09-18T18:04:51.753
> 
> 标签：sharepoint, deployment, sharepoint-2007, infopath, stsadm

将我的 InfoPath 2007 表单从设计器部署到我们开发环境的 SharePoint 服务器中是一件非常痛苦的事情。我们所有的表单都需要“完全信任”，因为它们包含用 C# 编写的业务逻辑。以下是手动步骤：

1) 在 InfoPath 中运行“发布表单”向导，指定要发布到的目标站点和保存 xsn 文件的位置。

2) 从网站集功能中停用现有版本的表单（如果存在旧版本）。

3) 在开发服务器上登录 Central Admin。导航到应用程序管理 -> 管理表单模板并上传 xsn 文件。

4) 将表单激活为网站集功能。

有谁知道如何实现自动化？也许通过stsadm？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-18T19:39:34.380

您可以在 SharePoint 解决方案（WSP 文件）中打包 InfoPath 表单。这些可以通过使用 STSADM 进行部署。了解更多信息：

*   [http://blogs.importchaos.com/alonsorobles/2008/06/04/creating-a-sharepoint-solution-for-an-infopath-form-template-deployment/#comments](http://blogs.importchaos.com/alonsorobles/2008/06/04/creating-a-sharepoint-solution-for-an-infopath-form-template-deployment/#comments)
*   [http://www.crsw.com/mark/Lists/Posts/Post.aspx?ID=37](http://www.crsw.com/mark/Lists/Posts/Post.aspx?ID=37)
*   [http://blah.winsmarts.com/2008-8-Deploying_InfoPath_2007_Forms_to_Forms_Server_-and-ndash_Properly.aspx](http://blah.winsmarts.com/2008-8-Deploying_InfoPath_2007_Forms_to_Forms_Server_-and-ndash_Properly.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-10T14:48:22.867

我们可以构建自己的服务来在 Share point Server 中部署 InfoPath 表单。我开发了服务来解决我的问题。我使用“STSADM”命令部署 InfoPath 表单。您必须了解 STSADM 语法才能构建脚本来部署 InfoPath 表单。

在这里，我总结了我所做的。它可能对您开始有用。我开发了 Web 服务，它将使用 STSADM 构建脚本并将其保存为 bat 文件并使用 C# 中可用的 Process 命令运行批处理文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T06:16:59.167

另外几个选项是：

1) 运行“发布表单”向导后，按照以下博文使用带有 stsadm 命令的批处理文件：http: [//sharenotes.wordpress.com/2008/03/18/using-stsadm-to-deploy-upgrade-update -infopath-forms-templates-with-managed-code-behind/](http://sharenotes.wordpress.com/2008/03/18/using-stsadm-to-deploy-upgrade-update-infopath-forms-templates-with-managed-code-behind/)

2）使用 Codeplex 上的 InfoPath Form Deployment Tool（或者您可以简单地使用该工具生成批处理文件）： http: [//www.codeplex.com/InfoPathFormsInstall](http://www.codeplex.com/InfoPathFormsInstall)

# activerecord - 停止 Activerecord 加载 Blob 列

> ID：95061
> 
> 赞同：10
> 
> 时间：2008-09-18T18:05:01.427
> 
> 标签：activerecord, lazy-loading, blob

除非明确要求，否则我如何告诉 Activerecord 不加载 blob 列？我的遗留数据库中有一些相当大的 blob 必须排除在“普通”对象之外。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-07-18T04:45:16.037

我刚刚使用rail 3遇到了这个问题。

幸运的是，解决起来并不难。我设置了一个`default_scope`从结果中删除了我不想要的特定列。例如，在我的模型中，有一个可能很长的 xml 文本字段在大多数视图中都没有使用。

```
default_scope select((column_names - ['data']).map { |column_name| "`#{table_name}`.`#{column_name}`"}) 
```

您将从解决方案中看到，我必须将列映射到完全限定的版本，这样我才能通过关系继续使用模型，而不会在属性中产生歧义。稍后，如果您确实想要该字段，只需添加另一个字段即可`.select(:data)`将其包含在内。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T18:34:28.437

我相信您可以要求 AR 在您的调用中加载特定列以查找：

```
MyModel.find(id, :select => 'every, attribute, except, the, blobs') 
```

但是，这需要在添加列时进行更新，因此并不理想。我认为没有任何方法可以专门排除 rails 中的一列（也没有在单个 SQL 选择中）。

我想你可以这样写：

```
MyModel.find(id, :select => (MyModel.column_names - ['column_to_exclude']).join(', ')) 
```

不过，在你相信我的话之前先测试一下。:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-30T19:06:03.470

fd 的回答基本正确，但 ActiveRecord[目前不接受数组](http://dev.rubyonrails.org/ticket/5863)作为 :select 参数，因此您需要将所需的列加入逗号分隔的字符串中，如下所示：

```
desired_columns = (MyModel.column_names - ['column_to_exclude']).join(', ')
MyModel.find(id, :select => desired_columns) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-22T01:17:07.230

一种干净的方法，无需更改您在应用程序中其他位置的编码方式，即不会弄乱`:select`选项

> 无论出于何种原因，您需要或选择将 blob 存储在数据库中。但是，您不希望将 blob 列与常规属性混合在同一个表中。BinaryColumnTable 帮助您将所有 blob 存储在单独的表中，由 ActiveRecord 模型透明地管理。或者，它可以帮助您记录 blob 的内容类型。
> 
> [http://github.com/choonkeat/binary_column_table](http://github.com/choonkeat/binary_column_table)

用法很简单

```
Member.create(:name => "Michael", :photo => IO.read("avatar.png"))
#=> creates a record in "members" table, saving "Michael" into the "name" column
#=> creates a record in "binary_columns" table, saving "avatar.png" binary into "content" column

m = Member.last #=> only columns in "members" table is fetched (no blobs)
m.name          #=> "Michael"
m.photo         #=> binary content of the "avatar.png" file 
```

# macos - OS X 上的游戏手柄代码：嗯？

> ID：95071
> 
> 赞同：9
> 
> 时间：2008-09-18T18:06:13.717
> 
> 标签：macos, iokit

在我尝试为 OS X 编写游戏手柄代码之前，我认为我是一个不错的程序员。现在我觉得自己很没用。

有谁知道我可以在我的（非免费）游戏中合法使用的任何代码？

在 OS X 上与游戏手柄对话真的有这么难吗？我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T08:35:17.603

查看 HID 管理器，尤其是[Leopard 中的新 HID 管理器 API](http://developer.apple.com/technotes/tn2007/tn2187.html)。它有点冗长，但它的本质是您可以在连接和分离设备时获得回调，并在来自这些设备的事件入队时获得回调。

如果您正在使用 Cocoa，[Dave Dribin](http://www.dribin.org/dave/)有[DDHidLib](http://www.dribin.org/dave/software/#ddhidlib)，它在 HID 管理器之上提供了更好的 Objective-C API，并且也可以在 Tiger 上运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T19:24:19.013

原来答案是 Apple 的 HID_Utilities，它（在某种程度上）简化了与 HID Manager 交谈的工作。

当约翰卡马克说苹果不关心游戏时，他真的一针见血……

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T11:49:40.703

在 OSX 上获取游戏手柄事件的最快方法是使用游戏库 SDL。您不必使用整个库，只需初始化操纵杆子系统，然后轮询或等待 SDL_JOYAXISMOTION 和 SDL_JOYBUTTONUP/DOWN 事件。SDL 具有 LGPL 许可证，因此您可以在非免费游戏中动态链接到它。

简单的！

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-18T18:57:18.820

No code, but communicating with gamepads and the like is pretty straightforward with the [InputSprocket](http://developer.apple.com/DOCUMENTATION/mac/Sprockets/GameSprockets-162.html#HEADING162-0) mechanism. What was the precise problem you had?

# c# - 设置 DataGridViewRow.Height 慢

> ID：95074
> 
> 赞同：2
> 
> 时间：2008-09-18T18:06:37.147
> 
> 标签：c#, .net, datagridview

我注意到在 DataGridView 控件中设置行高很慢。有没有办法让它更快？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T18:36:34.843

对我自己造成类似布局延迟的原因与**AutoSizeRowsMo​​de有关**和**AutoSizeColumnsMode有关**

```
DataGridView1.AutoSizeRowsMode = None 
```

可能会修复它。

也尝试将**[ColumnHeadersHeightSizeMode](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.columnheadersheightsizemode.aspx)**设置为 None 并将**[AllowUserToResizeRows](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.allowusertoresizerows.aspx)**设置为 False。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:24:47.900

如果可以，请在绑定控件之前尝试设置高度。

如果您不能这样做，请尝试在设置高度之前隐藏控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:30:21.037

这在大多数情况下都有效，但我不确定这是否是您正在寻找的......

尝试设置 RowTemplate 并使用它来设置行高。

```
 // my test to specify a size for a datagridview row
        dataGridView1.Columns.Add(new DataGridViewTextBoxColumn { Name = "ColumnNameGoesHere" });
        dataGridView1.RowTemplate.Height = 50;
        for (var x = 0; x <= 10000; x++)
        {
            dataGridView1.Rows.Add(x.ToString());
        } 
```

这里还有一个关于缩放 Windows 窗体 DataGridView 控件的 Windows 窗体编程最佳实践的好页面，您可能会发现它很方便：http: [//msdn.microsoft.com/en-us/library/ha5xt0d9.aspx](http://msdn.microsoft.com/en-us/library/ha5xt0d9.aspx)

# asp.net - 跨回发存储状态

> ID：95077
> 
> 赞同：2
> 
> 时间：2008-09-18T18:06:55.930
> 
> 标签：asp.net

跨回发存储字符串数据的最佳方式是什么。我需要为多个实体存储 ID 和名称。我正在考虑在视图状态中使用数据表，但这会使视图状态变得太大吗？我还不能使用数据库，因为我将插入那些其他记录需要关联的记录。所以我只是暂时存储它们，直到用户提交表单。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T18:16:37.433

您实际上有很多选择 - 您选择的选项将完全取决于您自己的应用程序的要求。

1.  ViewState - 您可以将数据添加到页面的视图状态。这样做的好处是数据*只会*在用户在页面上并将其发布回服务器的整个生命周期中存在。它相对于隐藏字段的另一个优势是用户更难侵入它并更改您的值（我相信，事实上，您可以加密您的视图状态）。当然，缺点在于页面大小 - 您添加到视图状态的所有内容都是另一件事，它会被放置在用户页面上，然后被发布回服务器。这使得它不适合存储大量数据。

2.  Cookies - 您可以将信息以 cookie 的形式返回给用户。在这种情况下，您可以声明信息将持续多长时间 - 对于打开浏览器的用户范围或特定日历时间。每次用户点击该页面时，该信息将可用于您的应用程序的任何页面。坏消息是您可以存储的信息量有限，而且用户可以很容易地更改他们自己的 cookie。

3.  会话 - 您将用户的信息存储在您自己的服务器内存中（我将不讨论各种类型的会话存储）。在这种情况下，该信息将与您的用户会话存在一样长，并且可用于您的应用程序的所有页面。用户直接修改这些值没有风险，尽管会话劫持是您可能想要探索的风险。但是，缺点是在这种情况下您正在使用宝贵的服务器资源 - 如果您的应用程序负载很大，它可能会影响您将来的可伸缩性。

正如我所说 - 您选择做什么将完全取决于您的应用程序的需求和要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:09:33.397

几种方法（尽管不是详尽的清单）：

*   视图状态
*   隐藏字段
*   会议
*   请求参数
*   饼干

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T18:14:41.793

ViewState 很好。如果您跨回发存储它，最好使用客户端解决方案。因此，您将在某处添加大小——在 ViewState 或隐藏字段中。

如果你想在服务器端做这个，你可以使用 Session，但记得尽可能清理它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:09:07.080

您可以将它们存储到 cookie 中，这也将允许您从 Javascript 访问它们。或者，您可以将一个简单的字符串数组存储到视图状态。很大程度上取决于您希望存储什么信息以及存储多少信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:07:25.567

当我遇到这种情况时，我会为我的字段创建一个结构，并将其填充到 Viewstate 中。考虑到整个页面的控件集已经存在，我可以在页面大小和生命周期中添加一个小结构:)

此外，它会在您完成页面后自行清理，因此无需担心在您的 Session 中填满废话。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T11:31:04.763

我同意[接受的答案](https://stackoverflow.com/questions/95077/storing-state-across-postback#95199)，但我还要补充一点，如果您只想跟踪简单的键/值集合，最好将通用字典放入 ViewState 或 Session：

```
Dictionary<int, string> myValues = new Dictionary<int, string>();
myValues.Add(1, "Apple");
maValues.Add(2, "Pear"); 
```

# database - 为数字数据嵌入的 SQLite / Firebird

> ID：95087
> 
> 赞同：2
> 
> 时间：2008-09-18T18:07:29.047
> 
> 标签：database, sqlite, firebird

我有一个实验，需要存储 1Mb/s 的数字数据以供以后处理。直接写入数据库就像写入 CSV 文件一样容易，然后我就可以轻松检索子集或范围。

我有 sqlite2 的经验（当它只有文本字段时），它似乎与原始磁盘访问一样快。对此应用程序的当前最佳进程内 DBMS 有何意见？

抱歉 - 最初应该在 Windows 上添加这是 C++，但跨平台很好。理想情况下，DB 二进制文件格式应该是跨平台的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T22:49:15.283

如果您只需要读取/写入数据，而无需在数据库中进行任何检查或操作，那么两者都应该可以。Firebird 的数据库文件可以复制，只要系统具有相同的字节序（即不能在 Intel 和 PPC 处理器的系统之间复制文件，但 Intel-Intel 可以）。

但是，如果您需要对数据进行任何操作，而不仅仅是简单的读/写，那么请使用 Firebird，因为它是一个完整的 SQL 服务器，具有所有“企业”功能，如触发器、视图、存储过程、临时表、等等

顺便说一句，如果您决定尝试 Firebird，我强烈建议您使用 IBPP 库来访问它。它是围绕 Firebird 的 C API 的一个非常薄的 C++ 包装器。我有大约 10 个封装了所有内容的类，并且非常易于使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T18:59:18.753

如果您想要做的只是存储数字并能够轻松地进行范围查询，您可以采用 STL 中可用的任何标准树数据结构并将其序列化到磁盘。这可能会在跨平台环境中对您不利，尤其是在您尝试跨架构时。

就更灵活/人性化的解决方案而言，sqlite3 被广泛使用，坚固，稳定，非常好。

BerkeleyDB 有许多可以使用它的好特性，但没有一个适用于这种情况，恕我直言。

如果您可以接受许可协议，我会说使用 sqlite3。

-D

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:14:57.063

取决于您使用的语言。如果是 C/C++、TCL 或 PHP，SQLite 在单写者场景中仍然名列前茅。如果您不需要 SQL 访问，则 berkeley DB 风格的库可能会稍微快一些，例如 Sleepycat 或 gdbm。对于多个编写者，您可以考虑单独的客户端/服务器解决方案，但听起来您并不需要它。如果您使用 Java，hdqldb 或 derby（Sun 的 JVM 附带“JavaDB”品牌）似乎是首选的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-29T13:02:18.460

我怀疑这两个数据库都不允许您以如此高的速度写入数据。您可以自己检查以确定。以我的经验 - 对于具有单个整数主键的非常简单的表，SQLite 无法每秒插入超过 1000 行。

如果出现性能问题 - 我会使用 CSV 格式来编写文件，然后我会将它们的数据加载到数据库（SQLite 或 Firebird）以进行进一步处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-08T18:14:18.350

您可能还需要考虑专门用于存储这些类型的大型数据集的数字数据文件格式。例如：

*   [HDF——](http://en.wikipedia.org/wiki/Hierarchical_Data_Format)在许多语言中最常见且支持良好的免费库。我强烈推荐这个。
*   [CDF](http://cdf.gsfc.nasa.gov/) ——NASA 使用的类似格式（但任何人都可以使用）。
*   [NetCDF——](http://en.wikipedia.org/wiki/NetCDF)另一种类似的格式（最新版本实际上是精简的 HDF5）。

此链接包含有关上述数据集类型之间差异的一些信息：http: [//nssdc.gsfc.nasa.gov/cdf/html/FAQ.html](http://nssdc.gsfc.nasa.gov/cdf/html/FAQ.html)

# windows - 如何处理 sqlite2 到 sqlite3 迁移中的 UTF-8 字符

> ID：95089
> 
> 赞同：1
> 
> 时间：2008-09-18T18:07:34.070
> 
> 标签：windows, command-line, utf-8, sqlite, sqlite2

尝试简单的方法：

> sqlite2 mydb.db .dump | sqlite3 mydb-new.db

我收到了这个错误：

> 第 84802 行附近的 SQL 错误：没有这样的列：D

在该行中，脚本是这样的：

> 插入车辆值（127548,'21K0065217', **Ñ** ,'PA007808',65217,279,1989,3,468,'1998-07-30 00:00:00.000000','14/697/98-07',2, '',1);

我的猜测是**没有引号的 'Ñ' 是问题所在**。

任何的想法？

PD：我现在在 Windows 下，我想使用命令行以便它可以自动化（这个过程将由服务器每天完成）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T01:25:40.753

只需使用 sqlite3 二进制 CLI 打开 v2 数据库，然后保存即可。数据库文件将透明地迁移到 v3。

```
$ sqlite3 v2database.db
sqlite> .quit
$ 
```

注意：您可能需要在退出之前插入/删除一行以强制更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T02:44:02.830

好吧，没有人回答...最后我修改了我的原始脚本（首先创建了 sqlite2 数据库的那个）以直接在 sqlite3 中创建数据库。

我认为一个大的字符串处理脚本（大，因为 mi 数据库分别为 800mb 和 200mb）可以完成这项工作，但直接生成数据库对我来说更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-28T09:57:00.880

> 只需使用 sqlite3 二进制 CLI 打开 v2 数据库，然后保存即可。数据库文件将透明地迁移到 v3。

它不起作用。

```
$sqlite3 db2
SQLite version 3.6.16
Enter ".help" for instructions
Enter SQL statements terminated with a ";"
sqlite> .tables
Error: file is encrypted or is not a database
sqlite> .q 
```

并且文件没有改变（显然 sqlite3 无法读取它）。我认为最初的问题是 sqlite2 中的一个错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:24:49.473

我试图在没有 Windows 干预的情况下做到这一点：

> *通过在 old.db 上调用 sqlite2，并将转储直接发送到文件
> 
> *然后在 new.db 上调用 sqlite3 并直接从文件加载转储。

以防万一 windows 弄乱了命令行上的字符。

结果相同。

# c# - 为什么 Application.Restart() 不可靠？

> ID：95098
> 
> 赞同：46
> 
> 时间：2008-09-18T18:08:05.410
> 
> 标签：c#, .net

使用`Application.Restart()`C# 中的方法应该重新启动当前应用程序：但这似乎并不总是有效。

这个问题是否有原因，有人可以告诉我，为什么它一直不起作用？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-18T18:21:47.970

这可能有很多原因。不是方法不行；相反，很多时候程序员忘记了他们在他们的代码中添加了一些东西来阻止应用程序自动关闭或启动。两个例子：

*   表单上的 Closing 事件可以停止应用程序的关闭
*   如果您正在检查一个已经在运行的进程，那么旧进程的关闭速度可能不足以让新进程启动。

检查您的代码是否存在类似的问题。如果您在空白应用程序中看到此行为，那么这更有可能是实际功能的问题，而不是您的代码。

查看微软的[应用程序重启](https://referencesource.microsoft.com/#System.Windows.Forms/winforms/Managed/System/WinForms/Application.cs,de3600ec6a11dcac)源代码。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-10-23T20:48:16.157

在我的情况下（没有单实例），其中

```
Application.Restart(); 
```

没有工作，

```
System.Diagnostics.Process.Start(Application.ExecutablePath);
Application.Exit(); 
```

完成了任务！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-18T18:23:14.423

我遇到这种问题的唯一一次是在我的主窗体中我有一个自定义`FormClosing`事件处理程序，它执行逻辑并取消事件。

### 编辑：

我现在遇到了另一个实例，根据您的评论，它可能反映了您的经历。

在使用 Mutex 运行单实例应用程序时，我`Application.Restart()`从一个相当嵌入的位置调用，这需要做很多清理工作。因此，重新启动似乎在前一个实例完成之前启动了一个新实例，因此 Mutex 阻止了新实例的启动。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-01-29T20:53:38.670

在我的程序中，我有一个互斥锁来确保只有一个应用程序实例在计算机上运行。这导致新启动的应用程序无法启动，因为互斥锁没有及时释放。结果，我输入了一个值`Properties.Settings`，表明应用程序正在重新启动。在调用之前`Application.Restart()`将该`Properties.Settings`值设置为**true**。在`Program.Main()`我还添加了对该特定`property.settings`值的检查，以便当为**true**时将其重置为**false**并且有`Thread.Sleep(3000);`

在您的程序中，您可能有以下逻辑：

```
if (ShouldRestartApp)
{
   Properties.Settings.Default.IsRestarting = true;
   Properties.Settings.Default.Save();
   Application.Restart();
} 
```

在`Program.Main()`

```
[STAThread]
static void Main()
{
   Mutex runOnce = null;

   if (Properties.Settings.Default.IsRestarting)
   {
      Properties.Settings.Default.IsRestarting = false;
      Properties.Settings.Default.Save();
      Thread.Sleep(3000);
   }

   try
   {
      runOnce = new Mutex(true, "SOME_MUTEX_NAME");

      if (runOnce.WaitOne(TimeSpan.Zero))
      {
         Application.EnableVisualStyles();
         Application.SetCompatibleTextRenderingDefault(false);
         Application.Run(new Form1());
      }
   }
   finally
   {
      if (null != runOnce)
         runOnce.Close();
   }
} 
```

就是这样。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-18T18:20:08.673

在倾倒之前尝试锁定。这是我启动完整应用程序转储的方式。可能对你有用，可能不会。

```
Context.Application.Lock();
Context.Session.Abandon();
Context.Application.RemoveAll();
Context.Application.Restart();
Context.Application.UnLock(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-22T04:17:43.327

如果应用程序首先从网络位置启动并且未签名（您首先会收到警告对话框），它不会重新启动，只会退出。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-24T10:24:28.170

扩展方法：

```
public delegate void MethodDelegate<in TControl>(TControl value);

public static void InvokeIfRequired<TControl>(this TControl control, MethodDelegate<TControl> action)
    where TControl : Control
{
    if (control.InvokeRequired)
    {
        control.Invoke(action, control);
    }
    else
    {
        action(control);
    }
} 
```

私课：

```
private static bool _exiting;
private static readonly object SynchObj = new object(); 
```

工作马：

```
public static void ApplicationRestart(params string[] commandLine)
{
    lock (SynchObj)
    {
        if (Assembly.GetEntryAssembly() == null)
        {
            throw new NotSupportedException("RestartNotSupported");
        }

        if (_exiting)
            return;

        _exiting = true;

        if (Environment.OSVersion.Version.Major < 6) return;

        bool cancelExit = true;

        try
        {
            foreach (Form f in Application.OpenForms.OfType<Form>().ToList())
            {
                f.InvokeIfRequired(frm =>
                {
                    frm.FormClosing += (sender, args) => cancelExit = args.Cancel;
                    frm.Close();
                });

                if (cancelExit) break;
            }

            if (cancelExit) return;

            Process.Start(new ProcessStartInfo
            {
                UseShellExecute = true,
                WorkingDirectory = Environment.CurrentDirectory,
                FileName = Application.ExecutablePath,
                Arguments = commandLine.Length > 0 ? string.Join(" ", commandLine) : string.Empty
            });

            Application.Exit();
        }
        finally
        {
            _exiting = false;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-03-18T06:06:30.060

我试过下面的代码，它工作正常

```
static class Program
{
    static Mutex _mutex = new Mutex(false, "MYAPP");

    /// <summary>
    /// The main entry point for the application.
    /// </summary>
    [STAThread]
    static void Main()
    {
        if (!_mutex.WaitOne(1000, false))
        {
            MessageBox.Show("Another instance is already running!!!", "Already Running", MessageBoxButtons.OK,
                MessageBoxIcon.Error);
            return;
        }

        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new PrimaryForm());

        _mutex.ReleaseMutex();
    }
} 
```

//我调用应用程序重启的地方使用了这个代码

应用程序.Restart();
应用程序.ExitThread();

参考链接
[https://www.codeproject.com/articles/25674/preventing-multiple-application-instances-when-usi](https://www.codeproject.com/articles/25674/preventing-multiple-application-instances-when-usi)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-27T11:25:43.803

试试这个代码：

```
bool appNotRestarted = true; 
```

此代码也必须在函数中：

```
if (appNotRestarted == true)
{
    appNotRestarted = false;
    Application.Restart();
    Application.ExitThread();
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-21T06:27:53.523

```
Application.Restart();
Application.ExitThread(); 
```

这对我有用，谢谢。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-05-24T18:09:48.557

我对 .Net 4.7 框架也有同样的问题。接受的答案是我成功的关键。我确实在 FormClosing 事件中有代码需要一些时间并停止重新启动过程。我所做的是像这样放置一个哨兵：

```
If JustCloseIT = False Then
   'all closing code, like logging the session log-out to a database and all those goodies we all do.
 End If 
```

只有这样 Application.Restart() 才起作用！

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-02-03T20:39:32.273

我知道这是一个旧线程，但我找到了解决方法。希望这会帮助其他有需要的人。

我需要一个可以在 ClickOnce 应用程序从代码启动期间触发更新序列的解决方案。 `Applicatoin.Restart`没有这样做。我想要一种能够检查更新然后调用内置更新管理器的方法，这样我就不必编写自定义的更新管理器了。

```
 'VB Code Sample
    Dim strStart As String = System.Environment.GetFolderPath(Environment.SpecialFolder.StartMenu) & "\Programs\Folder\YourApplication.appref-ms"
    Application.Exit()
    Try
        Process.Start(strStart)
    Catch ex As Exception
        'Do something with the exception
    End Try 
```

我在此解决方法中看到的唯一问题是用户可以从开始菜单中删除快捷方式。如果这是一个问题，您可以编写一些代码将开始菜单链接复制到您选择的某个文件夹中，最好是在 ClickOnce 应用程序文件夹中。这很重要，因为您的应用程序的开始菜单图标不是 .lnk 或 .exe，它实际上是一个 .appref-ms 链接。看到[ClickOnce .appref-ms 不仅仅是指向 .application 文件的链接？](https://stackoverflow.com/questions/281173/clickonce-appref-ms-more-than-a-link-to-application-file) 此链接更详细地解释了这一点。

此代码适用于 ClickOnce SingleInstance 应用程序。

# c# - 是否有任何内置方法可以将整数转换为 C# 中的字符串（任何基数）？

> ID：95105
> 
> 赞同：6
> 
> 时间：2008-09-18T18:09:09.997
> 
> 标签：c#, base

Convert.ToString() 出于某种奇怪的原因仅允许基值 2、8、10 和 16；是否有一些模糊的方法可以提供 2 到 16 之间的任何基数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T18:28:10.747

可能是为了消除键入 7 而不是 8 的人，因为任意基数的用途很少（但并非不存在）。

这是一个可以进行任意基本转换的示例方法。如果你愿意，你可以使用它，没有任何限制。

```
string ConvertToBase(int value, int toBase)
{
     if (toBase < 2 || toBase > 36) throw new ArgumentException("toBase");
     if (value < 0) throw new ArgumentException("value");

     if (value == 0) return "0"; //0 would skip while loop

     string AlphaCodes = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

     string retVal = "";

     while (value > 0)
     {
          retVal = AlphaCodes[value % toBase] + retVal;
          value /= toBase;
     }

     return retVal;
} 
```

未经测试，但你应该能够从这里弄清楚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:16:37.263

你可以试试[http://www.codeproject.com/KB/macros/Convert.aspx 。](http://www.codeproject.com/KB/macros/Convert.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:19:39.470

您可以尝试以下方法：

[http://www.dotnetspider.com/resources/938-Conversion-Decimal-number-any-Base-vice.aspx](http://www.dotnetspider.com/resources/938-Conversion-Decimal-number-any-Base-vice.aspx)

这至少给人的印象是您可以拥有任何基础（从 2->16）。尽管我对您为什么要这样做感到有些困惑！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:34:22.290

```
//untested  -- public domain
// if you do a lot of conversions, using StringBuilder will be 
// much, much more efficient with memory and time than using string
// alone.

string toStringWithBase(int number, int base)
    { 
    if(0==number) //handle corner case
        return "0";
    if(base < 2)
        return "ERROR:  Base less than 2";

    StringBuilder buffer = new StringBuilder(); 

    bool negative = (number < 0) ? true : false;
    if(negative)
        {
        number=-number;
        buffer.Append('-');
        }

    int digits=0;
    int factor=1;

    int runningTotal=number;
    while(number > 0)
       {
       number = number/base;
       digits++;
       factor*=base;
       }
    factor = factor/base;

    while(factor >= 1)
       {
       int remainder = (number/factor) % base;

       Char out = '0'+remainder;
       if(remainder > 9)
           out = 'A' + remainder - 10;
       buffer.Append(out);
       factor = factor/base;
       }

    return buffer.ToString
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-12T07:02:29.203

对不起，我不是在回答你的问题，但是......基地的选择不是任意的。你的电脑不断地从基数 2（它是内部二进制系统）转换为人类可读的基数 10。基数 8 和 16 很容易与基数 2 相互转换，并且经常使用，因此计算机和人类可以读取值（例如 GUID）

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-18T18:10:25.373

```
string foo = Convert.ToString(myint,base); 
```

[http://msdn.microsoft.com/en-us/library/14kwkz77.aspx](http://msdn.microsoft.com/en-us/library/14kwkz77.aspx)

**编辑**：我的错，这将引发参数异常，除非您传入指定的基数（2、8、10 和 16）

如果你想使用不同的基地，你可能是 SOL（但为什么？？？）。

# vim - 为函数添加参数的 Vim 快捷方式

> ID：95106
> 
> 赞同：1
> 
> 时间：2008-09-18T18:09:21.447
> 
> 标签：vim, keyboard-shortcuts

是否有用于跳转到当前函数的参数列表的 Vim 快捷方式？我经常发现自己需要弄乱函数的参数列表，而且在我最终得到它之前必须执行 ?def 或 ?function 或 10k 或你有什么，然后 /( 或 t(或 5e 以到达参数列表中的正确位置，依此类推。例如，如果我可以点击 ,a 并立即在参数列表的末尾/开头进入插入模式，那就太好了。

可能的方法：

*   折叠式的
*   标签支持 (ctags)

此外，我正在使用 Python，因此基于花括号的解决方案很遗憾无法正常工作。

如果不存在这样的快捷方式，我将只写一个并将其发布在这里作为答案。:-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T19:01:43.707

*免责声明，我不了解 Python，我假设 Python 函数可以通过您的问题中的“函数”或“定义”来识别。只需更改正则表达式即可。*

可能是这样的：

```
 :nnoremap <buffer> [m :call search('def\|function', 'b')<cr>f( 
```

?

注意：

*   为了不弄乱搜索历史，我使用了 search() ；searchpair() 可能是更好的选择，因为它只会跳转到我们所在函数的定义，而不是之前的函数。
*   由于这仅适用于 Python，因此我使用 <buffer> 以免弄乱非 Python 文件中的键绑定；这个映射最好在 python ftplugin 中定义。

高温下，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:23:51.957

地图,a ma[{F(a

点击 ,a 转到参数列表，然后点击 `a 返回调用 ,a 时所在的位置。警告： [{ 跳回到最后一个不匹配的 { 字符，所以如果你在一个循环或其他控制结构中，它会带你到它的开头，而不是。

我不知道以一种万无一失的方式开始函数的方法。如果您对标签保持一致，则可以执行以下操作：

地图，ma?function :nohlf(a

在哪里，如果您在定义函数之前不使用单个选项卡，您将更改为适当的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T20:01:52.697

到达函数开头的最简单的方法是使用 [[. 所以你用

地图,a ma[[kf(a

因此它可以将您带到函数定义，搜索“（”的第一次出现，然后将您置于插入模式。

# process - 如何在 Visual Basic (VB6) 中延迟代码执行？

> ID：95112
> 
> 赞同：11
> 
> 时间：2008-09-18T18:09:44.860
> 
> 标签：process, vb6

我在 VB6 中有一个长时间运行的进程，我想在执行下一行代码之前完成它。我怎样才能做到这一点？内置功能？我可以控制等待多长时间吗？

简单的例子：

```
Call ExternalLongRunningProcess
Call DoOtherStuff 
```

如何延迟“DoOtherStuff”？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-19T15:15:31.097

虽然 Nescio 的[答案](https://stackoverflow.com/questions/95112/how-do-i-delay-code-execution-in-visual-basic-vb6#95142)(DoEvents) 会起作用，但它会导致您的应用程序使用 100% 的 CPU。睡眠将使 UI 无响应。您需要的是两者的结合，而似乎效果最好的神奇组合是：

```
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

While IsStillWaitingForSomething()
    DoEvents
    DoEvents
    Sleep(55)
Wend 
```

为什么有两个 DoEvent，一个休眠 55 毫秒？55 毫秒的睡眠是 VB6 可以处理的最小时间片，并且在需要超级响应能力的情况下有时需要使用两个 DoEvents（不是通过 API，而是如果您的应用程序正在响应外部事件、SendMessage、Interupts 等） ）。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-18T18:12:28.257

VB.Net：我会使用[WaitOne](http://msdn.microsoft.com/en-us/library/kzy257t0.aspx)事件句柄。

VB 6.0：我见过一个 DoEvents 循环。

```
Do
     If isSomeCheckCondition() Then Exit Do
     DoEvents
Loop 
```

最后，你可以睡觉了：

```
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

Sleep 10000 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T18:13:32.590

如何确定外壳进程何时终止：

*   [档案 1](https://web.archive.org/web/20130706022352/http://support.microsoft.com/kb/96844)

*   [存档 2](https://jeffpar.github.io/kbarchive/kb/129/Q129796/)

如果你正在调用一个外部进程，那么你实际上是在异步调用它。请参阅上述 MS 支持文档，了解如何等待外部流程完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:11:26.073

将您的代码分成 2 个进程。运行第一个，然后运行“长时间运行的进程”，然后运行第二个进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:12:04.123

在当前进程的中间运行长时间运行的进程并等待它完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-04T22:19:55.487

我希望您可以将 .net 框架 system.dll 或其他任何内容添加到您的项目引用中，以便您可以这样做：

```
Dim ALongTime As Integer = 2000
System.Threading.Thread.Sleep(ALongTime) 
```

...每次。我的机器上有 VB6 和 VB.net 2008，我总是很难在非常不同的 IDE 之间切换。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-08T17:31:57.220

如果你想写一个`sleep`或`wait`不声明`sleep`你可以写一个使用系统定时器的循环。这是我在运行解释器时用于测试/调试的。如果您需要这样的东西，可以在解释器暂停时添加它：

```
Dim TimeStart as currency
Dim TimeStop as currency
Dim TimePassed as currency
Dim TimeWait as currency

'use this block where you need a pause
TimeWait = 0.5 'seconds
TimeStart = Timer()
TimePassed = 0
Do while TimePassed < TimeWait  'seconds
    TimeStop = timer()
    TimePassed = TimeStop - TimeStart 
    doevents
loop 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2013-11-08T15:10:25.157

`System.Threading.Thread.Sleep(500)`

# c# - 在 asp.net 中存储用户相关数据的最佳位置在哪里？

> ID：95120
> 
> 赞同：5
> 
> 时间：2008-09-18T18:10:45.030
> 
> 标签：c#, asp.net

当客户登录我的网站时，我需要知道他们的帐户 ID 和菜单 ID。这让我知道他们可以在页面上看到什么数据以及他们得到什么菜单。我不想一遍又一遍地阅读这些数据。我应该将其存储在会话变量中还是自定义会员用户和会员提供者以包含此信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T18:13:18.677

如前所述，配置文件系统非常简单。

[http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx](http://msdn.microsoft.com/en-us/library/2y3fs9xs.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T22:14:35.443

如果您打算使用配置文件提供程序，如果您正在运行高流量站点，请务必查看本文的“优化 ASP.NET 2.0 配置文件提供程序”部分：http: [//www.codeproject.com /KB/aspnet/10ASPNetPerformance.aspx](http://www.codeproject.com/KB/aspnet/10ASPNetPerformance.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:11:50.783

配置文件系统可能会满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:16:06.250

我使用了[MS Table Profile Provider](http://www.asp.net/Downloads/sandbox/table-profile-provider-samples/)，它允许您指定自己的数据库表结构来存储数据，而不是默认配置文件系统中使用的 XML 模式。

这还有一个额外的好处，就是允许您编写自己的数据访问程序来访问通用配置文件数据。

# java - jstl的sql标签是如何工作的？

> ID：95134
> 
> 赞同：3
> 
> 时间：2008-09-18T18:11:58.960
> 
> 标签：java, jsp, web-applications, jstl

我正在使用以下代码从我的 jsp 中查询数据库，但我想更多地了解幕后发生的事情。

这是我的两个主要问题。

标签是直接访问 ResultSet，还是将查询结果存储在内存中的数据结构中？

连接何时关闭？

```
<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>

<sql:query var="query" dataSource="${ds}" sql="${listQuery}"></sql:query>
<c:forEach var="row" items="${query.rows}" begin="0">
    ${row.data }
    ${row.more_data }
</c:forEach> 
```

注意：我一直反对在 jsp 中运行查询，但是我的结果集太大而无法存储在我的操作和我的 jsp 之间的内存中。使用这个标签库看起来是最简单的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-18T19:23:52.063

基于 org.apache.taglibs.standard.tag.common.sql.QueryTagSupport 来源的观察

taglib 遍历 ResultSet 并将所有数据放入数组、映射和列表中。因此，在您开始循环之前，所有内容都已加载到内存中。

遇到查询开始标记时打开连接（doStartTag 方法）。遇到查询结束标记时检索结果（doEndTag 方法）。连接在 doFinally 方法中关闭。

简而言之，这绝对是可怕的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:07:43.320

这里的关键是：javax.servlet.jsp.jstl.sql.Result

这就是 JSTL 用作 SQL 查询的结果。如果你看一下界面，它有这个方法：

公共 java.util.SortedMap[] getRows()

c:forEach “知道” javax.servlet.jsp.jstl.sql.Result，因为 Result 不是 forEach 知道的任何其他东西（集合、数组、迭代器等）。

因此，所有这些都意味着 SQL 查询会将整个结果集吸入 RAM。

如果您因为不想将整个结果集加载到集合中而将查询移入 JSP，那么 SQL 标记似乎不会为您解决该问题。

实际上，您应该查找值列表模式。

但是，解决您的问题的“简单”解决方案是创建一个“了解”您的 ResultSet 的自定义迭代器。如果遇到异常或结果运行其过程（就像在 forEach 中一样），它会包装一个结果集并关闭所有内容。一种特殊用途的东西。

`public class ResultSetIterator implements Iterator {`

 ````
Connection con;
Statement s;
ResultSet rs;
Object curObject;
boolean closed;

public ResultSetIterator(Connection con, Statement s, ResultSet rs) {
    this.con = con;
    this.s = s;
    this.rs = rs;
    closed = false;
}

public boolean hasNext() {
    advance();
    return curObject != null;
}

public Object next() {
    advance();
    if (curObject == null) {
        throw new NoSuchElementException();
    } else {
        Object result = curObject;
        curObject = null;
        return result;
    }
}

public void remove() {
    throw new UnsupportedOperationException("Not supported yet.");
}

private void advance() {
    if (closed) {
        curObject = null;
        return;
    }
    if (curObject == null) {
        try {
            if (rs.next()) {
                curObject = bindObject(rs);
            }
        } catch (SQLException ex) {
            shutDown();
            throw new RuntimeException(ex);
        }
    }
    if (curObject == null) {
        // Still no object, must be at the end of the result set
        shutDown();
    }
}

protected Object bindObject(ResultSet rs) throws SQLException {
    // Bind result set row to an object, replace or override this method
    String name = rs.getString(1);
    return name;
}

public void shutDown() {
    closed = true;
    try {
        rs.close();
    } catch (SQLException ex) {
        // Ignored
    }
    try {
        s.close();
    } catch (SQLException ex) {
        // Ignored
    }
    try {
        con.close();
    } catch (SQLException ex) {
        // Ignored
    }
} 
```` 

`}`

这自然是未经测试的。但是由于 JSTL forEach 可以与 Iterator 一起使用，因此它是您可以真正传递给它的最简单的对象。这将阻止您将整个结果集加载到内存中。（顺便说一句，值得注意的是，ResultSets 行为与 Iterator 几乎但不完全不同。）

# java - MSIL 和 Java 字节码的区别？

> ID：95163
> 
> 赞同：83
> 
> 时间：2008-09-18T18:13:34.993
> 
> 标签：java, .net, bytecode, cil

我是 .Net 的新手，我试图先了解基础知识。MSIL 和 Java 字节码有什么区别？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-18T19:27:22.600

首先让我说，我不认为 Java 字节码和 MSIL 之间的细微差别应该困扰新手 .NET 开发人员。它们都用于定义抽象目标机器的相同目的，该目标机器是最终使用的物理机器之上的一层。

MSIL 和 Java 字节码非常相似，实际上有一个名为[Grasshopper](http://web.archive.org/web/20150713013105/http://dev.mainsoft.com:80/)的工具可以将 MSIL 转换为 Java 字节码，我是 Grasshopper 开发团队的一员，所以我可以分享一些我的（褪色的）知识。请注意，当 .NET 框架 2.0 出现时，我停止了这方面的工作，因此其中一些事情可能不再正确（如果是这样，请发表评论，我会更正它）。

*   .NET 允许用户定义的类型具有与*常规*引用语义 ( `struct`) 相对的值语义。
*   .NET 支持无符号类型，这使得指令集更加丰富。
*   Java 在字节码中包含方法的异常规范。尽管异常规范通常只由编译器强制执行，但如果使用默认类加载器以外的类加载器，则它可能由 JVM 强制执行。
*   .NET 泛型用 IL 表示，而 Java 泛型仅使用[类型擦除](http://safalra.com/programming/java/wrong-type-erasure/)。
*   .NET 属性在 Java 中没有等价物（这仍然是真的吗？）。
*   .NET`enums`只不过是整数类型的包装器，而[Java`enums`](http://java.sun.com/docs/books/tutorial/java/javaOO/enum.html)是非常成熟的类（感谢[Internet Friend](https://stackoverflow.com/users/18037/internet-friend)的评论）。
*   .NET 有`out`和`ref`参数。

还有其他语言差异，但其中大多数没有在字节码级别表示，例如，如果内存服务于 Java 的非`static`内部类（在 .NET 中不存在）不是字节码功能，编译器会生成一个附加参数内部类的构造函数并传递外部对象。.NET lambda 表达式也是如此。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2012-02-06T03:15:52.803

[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)（MSIL 的专有名称）和 Java 字节码的相同点多于不同点。但是有一些重要的区别：

1) CIL 从一开始就被设计为多种语言的目标。因此，它支持更丰富的类型系统，包括有符号和无符号类型、值类型、指针、属性、委托、事件、泛型、具有单个根的对象系统等等。CIL 支持初始 CLR 语言（C# 和 VB.NET）不需要的功能，例如全局函数和[尾调用优化](http://en.wikipedia.org/wiki/Tail_call)。相比之下，Java 字节码被设计为 Java 语言的目标，并反映了 Java 本身的许多约束。使用 Java 字节码编写 C 或 Scheme 要困难得多。

2) CIL 旨在轻松集成到本机库和非托管代码中

3) Java 字节码被设计为被解释或编译，而 CIL 被设计为仅假设 JIT 编译。也就是说，[Mono](http://www.mono-project.com/Main_Page)的初始实现使用了解释器而不是 JIT。

4) CIL 被设计（[并指定](http://www.ecma-international.org/publications/standards/Ecma-335.htm)）为具有人类可读和可写的汇编语言形式，该形式直接映射到字节码形式。我相信 Java 字节码（顾名思义）意味着只有机器可读。当然，Java 字节码相对容易反编译回原始 Java，如下所示，它也可以“反汇编”。

我应该注意到 JVM（它们中的大多数）比 CLR（它们中的任何一个）的优化程度更高。因此，原始性能可能是更喜欢以 Java 字节码为目标的原因。这是一个实现细节。

有人说 Java 字节码被设计为多平台，而 CIL 被设计为仅适用于 Windows。不是这种情况。.NET 框架中有一些“Windows”主义，但 CIL 中没有。

作为上面第 4 点的示例，我不久前为 CIL 编译器编写了一个玩具 Java。如果您将此编译器提供给以下 Java 程序：

```
class Factorial{
    public static void main(String[] a){
    System.out.println(new Fac().ComputeFac(10));
    }
}

class Fac {
    public int ComputeFac(int num){
    int num_aux ;
    if (num < 1)
        num_aux = 1 ;
    else 
        num_aux = num * (this.ComputeFac(num-1)) ;
    return num_aux ;
    }
} 
```

我的编译器会输出以下 CIL：

```
.assembly extern mscorlib { }
.assembly 'Factorial' { .ver  0:0:0:0 }
.class private auto ansi beforefieldinit Factorial extends [mscorlib]System.Object
{
   .method public static default void main (string[] a) cil managed
   {
      .entrypoint
      .maxstack 16
      newobj instance void class Fac::'.ctor'()
      ldc.i4 3
      callvirt instance int32 class Fac::ComputeFac (int32)
      call void class [mscorlib]System.Console::WriteLine(int32)
      ret
   }
}

.class private Fac extends [mscorlib]System.Object
{
   .method public instance default void '.ctor' () cil managed
   {
      ldarg.0
      call instance void object::'.ctor'()
      ret
   }

   .method public int32 ComputeFac(int32 num) cil managed
   {
      .locals init ( int32 num_aux )
      ldarg num
      ldc.i4 1
      clt
      brfalse L1
      ldc.i4 1
      stloc num_aux
      br L2
   L1:
      ldarg num
      ldarg.0
      ldarg num
      ldc.i4 1
      sub
      callvirt instance int32 class Fac::ComputeFac (int32)
      mul
      stloc num_aux
   L2:
      ldloc num_aux
      ret
   }
} 
```

这是一个有效的 CIL 程序，可以输入到 CIL 汇编程序中，例如`ilasm.exe`创建可执行文件。如您所见，CIL 是一种完全人类可读和可写的语言。您可以在任何文本编辑器中轻松创建有效的 CIL 程序。

也可以用`javac`编译器编译上面的Java程序，然后通过`javap`“反汇编器”运行生成的类文件，得到如下：

```
class Factorial extends java.lang.Object{
Factorial();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

public static void main(java.lang.String[]);
  Code:
   0:   getstatic   #2; //Field java/lang/System.out:Ljava/io/PrintStream;
   3:   new #3; //class Fac
   6:   dup
   7:   invokespecial   #4; //Method Fac."<init>":()V
   10:  bipush  10
   12:  invokevirtual   #5; //Method Fac.ComputeFac:(I)I
   15:  invokevirtual   #6; //Method java/io/PrintStream.println:(I)V
   18:  return

}

class Fac extends java.lang.Object{
Fac();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

public int ComputeFac(int);
  Code:
   0:   iload_1
   1:   iconst_1
   2:   if_icmpge   10
   5:   iconst_1
   6:   istore_2
   7:   goto    20
   10:  iload_1
   11:  aload_0
   12:  iload_1
   13:  iconst_1
   14:  isub
   15:  invokevirtual   #2; //Method ComputeFac:(I)I
   18:  imul
   19:  istore_2
   20:  iload_2
   21:  ireturn
} 
```

输出不可编译（据`javap`我所知），但如果将其与上面的 CIL 输出进行比较，您会发现两者非常相似。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-18T18:29:14.893

它们本质上是在做同样的事情，MSIL 是微软的 Java 字节码版本。

内部的主要区别是：

1.  字节码是为编译和解释而开发的，而 MSIL 是专门为 JIT 编译而开发的
2.  MSIL 旨在支持多种语言（C# 和 VB.NET 等），而 Bytecode 仅针对 Java 编写，导致 Bytecode 在语法上更类似于 Java，而不是 IL 与任何特定 .NET 语言的相似性
3.  MSIL 在值和引用类型之间有更明确的描述

更多信息和详细比较可以在[K John Gough 的这篇文章](http://web.archive.org/web/20080730224644/http://sky.fit.qut.edu.au/~gough/VirtualMachines.ps)中找到（附言文件）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T18:17:52.097

没有那么大的差异。两者都是您编写的代码的中间格式。执行时，虚拟机将执行托管的中间语言，这意味着虚拟机控制变量和调用。甚至还有一种我现在不记得的语言可以在 .Net 和 Java 上以相同的方式运行。

基本上，它只是同一事物的另一种格式

编辑：找到语言（除了 Scala）：它是 FAN（[http://www.fandev.org/](http://www.fandev.org/)），看起来很有趣，但还没有时间评估

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-18T18:18:00.693

CIL aka MSIL 旨在供人类阅读。Java 字节码不是。

将 Java 字节码视为不存在（但 JVM 模拟的）硬件的机器代码。

CIL 更像是汇编语言——离机器代码一步之遥，同时仍然是人类可读的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T18:22:27.670

同意，差异很小，足以让初学者难以接受。如果您想从基础开始学习 .Net，我建议您查看 Common Language Infrastructure 和 Common Type System。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T18:23:36.653

Serge Lidin 撰写了一本关于 MSIL 细节的不错的书：[Expert .NET 2.0 IL Assembler](https://rads.stackoverflow.com/amzn/click/com/1590596463)。[通过查看使用.NET Reflector](http://www.red-gate.com/products/reflector/)和[Ildasm (Tutorial)](http://msdn.microsoft.com/en-us/library/aa309387(VS.71).aspx)的简单方法，我还能够快速掌握 MSIL 。

MSIL 和 Java 字节码之间的概念非常相似。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-30T11:26:35.473

我认为 MSIL 不应该与 Java 字节码相比，而是“构成 Java 字节码的指令”。

没有反汇编的 java 字节码的名称。“Java Bytecode”应该是一个非官方的别名，因为我在官方文档中找不到它的名字。 [Java 类文件反汇编器](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javap.html)说

> 为类中的每个方法打印出反汇编代码，即组成 Java 字节码的指令。这些都记录在 Java 虚拟机规范中。

“Java VM 指令”和“MSIL”都被组装成 .NET 字节码和 Java 代码，它们不是人类可读的。

# java - 具有不可序列化部分的 Java 序列化

> ID：95181
> 
> 赞同：52
> 
> 时间：2008-09-18T18:15:15.893
> 
> 标签：java, serialization

我有：

```
class MyClass extends MyClass2 implements Serializable {
  //...
} 
```

在 MyClass2 中是不可序列化的属性。如何序列化（和反序列化）这个对象？

更正：MyClass2 当然不是接口而是类。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-09-18T22:24:30.663

正如其他人所指出的，Josh Bloch 的[Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)第 11 章是 Java 序列化不可或缺的资源。

该章节中与您的问题相关的几点：

*   假设您要序列化 ​​MyClass2 中不可序列化字段的状态，MyClass 必须可以直接或通过 getter 和 setter 访问该字段。MyClass 必须通过提供 readObject 和 writeObject 方法来实现自定义序列化。
*   不可序列化字段的 Class 必须有一个 API 以允许获取它的状态（用于写入对象流），然后使用该状态实例化一个新实例（稍后从对象流中读取时）。
*   根据 Effective Java 第 74 条，MyClass2*必须*有一个 MyClass 可访问的无参数构造函数，否则 MyClass 不可能扩展 MyClass2 并实现 Serializable。

我在下面写了一个简单的例子来说明这一点。

```
 class MyClass extends MyClass2 implements Serializable{

  public MyClass(int quantity) {
    setNonSerializableProperty(new NonSerializableClass(quantity));
  }

  private void writeObject(java.io.ObjectOutputStream out)
  throws IOException{
    // note, here we don't need out.defaultWriteObject(); because
    // MyClass has no other state to serialize
    out.writeInt(super.getNonSerializableProperty().getQuantity());
  }

  private void readObject(java.io.ObjectInputStream in)
  throws IOException {
    // note, here we don't need in.defaultReadObject();
    // because MyClass has no other state to deserialize
    super.setNonSerializableProperty(new NonSerializableClass(in.readInt()));
  }
}

/* this class must have no-arg constructor accessible to MyClass */
class MyClass2 {

  /* this property must be gettable/settable by MyClass.  It cannot be final, therefore. */
  private NonSerializableClass nonSerializableProperty;

  public void setNonSerializableProperty(NonSerializableClass nonSerializableProperty) {
    this.nonSerializableProperty = nonSerializableProperty;
  }

  public NonSerializableClass getNonSerializableProperty() {
    return nonSerializableProperty;
  }
}

class NonSerializableClass{

  private final int quantity;

  public NonSerializableClass(int quantity){
    this.quantity = quantity;
  }

  public int getQuantity() {
    return quantity;
  }
} 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-18T18:17:25.030

MyClass2 只是一个接口，所以技术上它没有属性，只有方法。话虽如此，如果您有本身不可序列化的实例变量，我所知道的唯一解决方法是声明这些字段是瞬态的。

前任：

```
private transient Foo foo; 
```

当您声明一个字段瞬态时，它将在序列化和反序列化过程中被忽略。请记住，当您反序列化具有瞬态字段的对象时，该字段的值将始终是默认值（通常为 null。）

请注意，您还可以覆盖类的 readResolve() 方法，以便根据其他系统状态初始化瞬态字段。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2012-11-12T16:51:06.157

如果可能，可将不可串行部分设置为瞬态

```
private transient SomeClass myClz; 
```

否则，您可以使用[Kryo](https://github.com/EsotericSoftware/kryo)。Kryo 是一个快速高效的 Java 对象图序列化框架（例如 java.awt.Color 的 JAVA 序列化需要 170 个字节，Kryo 只需 4 个字节），它也可以序列化不可序列化的对象。Kryo 还可以执行自动深浅复制/克隆。这是从对象到对象的直接复制，而不是`object->bytes->object`.

这是一个如何使用kryo的例子

```
Kryo kryo = new Kryo();
// #### Store to disk...
Output output = new Output(new FileOutputStream("file.bin"));
SomeClass someObject = ...
kryo.writeObject(output, someObject);
output.close();
// ### Restore from disk...
Input input = new Input(new FileInputStream("file.bin"));
SomeClass someObject = kryo.readObject(input, SomeClass.class);
input.close(); 
```

序列化的对象也可以通过注册精确的序列化器来压缩：

```
kryo.register(SomeObject.class, new DeflateCompressor(new FieldSerializer(kryo, SomeObject.class))); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-18T18:22:56.873

如果您可以修改 MyClass2，解决此问题的最简单方法是声明属性 transient。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-18T18:18:42.360

您将需要实现`writeObject()`并`readObject()`手动对这些字段进行序列化/反序列化。有关详细信息，请参阅 javadoc 页面`java.io.Serializable`。Josh Bloch 的*Effective Java*也有一些关于实现健壮和安全的序列化的好章节。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-18T18:27:20.327

取决于为什么 MyClass2 的该成员不可序列化。

如果 MyClass2 不能以序列化形式表示是有充分理由的，那么很有可能同样的原因也适用于 MyClass，因为它是一个子类。

可以通过实现 readObject 和 writeObject 为 MyClass 编写自定义的序列化表单，这样可以从序列化数据中适当地重新创建 MyClass 中 MyClass2 实例数据的状态。如果 MyClass2 的 API 是固定的并且您不能添加 Serializable，这将是可行的方法。

但首先你应该弄清楚为什么 MyClass2 不可序列化，并可能改变它。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-18T18:20:39.500

您可以从查看*transient*关键字开始，它将字段标记为不属于对象的持久状态。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-22T16:33:55.750

出现了几种可能性，我在这里恢复它们：

*   [按照sk](https://stackoverflow.com/users/16399/sk)的建议实施 writeObject() 和 readObject()
*   声明属性瞬态，它不会像[hank所说的那样被序列化](https://stackoverflow.com/users/7610/hank)
*   使用[boris-terzic所述的 XStream](https://stackoverflow.com/users/1996/boris-terzic)
*   使用[tom-hawtin-tackline所述的串行代理](https://stackoverflow.com/users/4725/tom-hawtin-tackline)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-18T18:23:07.653

[XStream](http://x-stream.github.io)是一个很棒的库，可以对任何对象进行快速的 Java 到 XML 序列化，无论它是否可序列化。即使 XML 目标格式不适合您，您也可以使用源代码来学习如何操作。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-19T10:21:58.223

序列化不可序列化类（或至少其子类）的实例的一种有用方法称为串行代理。本质上，您实现 writeReplace 以返回完全不同的可序列化类的实例，该类实现 readResolve 以返回原始对象的副本。[我写了一个在Usenet](http://groups.google.com/group/comp.lang.java.programmer/msg/820a7343ae7713a6)上序列化 java.awt.BasicStroke 的例子

# mysql - 如何在 MySql 中 DATETIME 字段的日期部分创建索引

> ID：95183
> 
> 赞同：74
> 
> 时间：2008-09-18T18:15:25.160
> 
> 标签：mysql

如何在 DATETIME 字段的日期部分创建索引？

```
mysql> SHOW COLUMNS FROM transactionlist;
+-------------------+------------------+------+-----+---------+----------------+
| Field             | Type             | Null | Key | Default | Extra          |
+-------------------+------------------+------+-----+---------+----------------+
| TransactionNumber | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| WagerId           | int(11)          | YES  | MUL | 0       |                |
| TranNum           | int(11)          | YES  | MUL | 0       |                |
| TranDateTime      | datetime         | NO   |     | NULL    |                |
| Amount            | double           | YES  |     | 0       |                |
| Action            | smallint(6)      | YES  |     | 0       |                |
| Uid               | int(11)          | YES  |     | 1       |                |
| AuthId            | int(11)          | YES  |     | 1       |                |
+-------------------+------------------+------+-----+---------+----------------+
8 rows in set (0.00 sec) 
```

TranDateTime 用于保存交易发生时的日期和时间

我的表中有超过 1,000,000 条记录和语句

```
SELECT * FROM transactionlist where date(TranDateTime) = '2008-08-17' 
```

花费很长时间。

编辑：

看看这篇关于“[为什么 MySQL 的 DATETIME 可以而且应该避免](http://billauer.co.il/blog/2009/03/mysql-datetime-epoch-unix-time/)”的博文

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-09-18T18:21:33.693

如果我没记错的话，那将运行整个表扫描，因为您正在通过函数传递列。MySQL 会乖乖地为每一列运行函数，绕过索引，因为查询优化器无法真正知道函数的结果。

我会做的是这样的：

```
SELECT * FROM transactionlist 
WHERE TranDateTime BETWEEN '2008-08-17' AND '2008-08-17 23:59:59.999999'; 
```

这应该会给你 2008-08-17 发生的一切。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-18T18:22:34.720

我并不是说听起来很可爱，但一种简单的方法是添加一个仅包含日期部分和索引的新列。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-06-14T15:13:59.460

另一个选项（与[*5.7.3*](https://dev.mysql.com/doc/refman/5.7/en/alter-table-generated-columns.html)[及更高](https://dev.mysql.com/doc/refman/5.7/en/alter-table-generated-columns.html)[版本相关](https://dev.mysql.com/doc/refman/5.7/en/alter-table-generated-columns.html)*）是基于 datetime 列创建生成/虚拟列，然后对其进行索引。*

 *```
CREATE TABLE `table` (
`my_datetime` datetime NOT NULL,
`my_date` varchar(12) GENERATED ALWAYS AS (DATE(`my_datetime`)) STORED,
KEY `my_idx` (`my_date`)
) ENGINE=InnoDB; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-18T19:03:18.353

您不能仅在日期部分创建索引。你有理由这样做吗？

即使您可以仅在日期部分创建索引，优化器也可能仍然不会将它用于上述查询。

我想你会发现

```
SELECT * FROM transactionlist WHERE TranDateTime BETWEEN '2008-08-17' AND '2008-08-18' 
```

高效，做你想做的事。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-18T18:21:23.023

我不知道 mySql 的细节，但是仅仅索引整个日期字段有什么害处？

然后只需搜索：

```
 select * from translist 
     where TranDateTime > '2008-08-16 23:59:59'
        and TranDateTime < '2008-08-18 00:00:00' 
```

如果索引是 b-trees 或其他合理的东西，这些应该很快就能找到。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-18T18:25:19.677

Valeriy Kravchuk 在 MySQL 网站上对这个问题的功能请求说使用这种方法。

“与此同时，您可以使用字符列将 DATETIME 值存储为字符串，只索引前 N 个字符。通过在 MySQL 5 中仔细使用触发器，您可以基于这个想法创建一个相当健壮的解决方案。”

您可以编写一个很容易添加此列的例程，然后使用触发器使此列保持同步。这个字符串列的索引应该很快。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-02-27T16:16:01.677

一个很好的解决方案是使用时间戳作为时间，而不是日期时间。它被存储为 INT 并且被索引得足够好。我个人在事务表上遇到过这样的问题，它有大约百万条记录并且速度很慢，最后我指出这是由错误的索引字段（日期时间）引起的。现在它运行得非常快。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-11T11:38:55.657

我不知道 mySQL 的细节，但是仅仅索引整个日期字段有什么害处？

如果你对*树使用函数魔法，散列，......就消失了，因为要获取值，你必须调用函数。但是，因为您不知道前面的结果，所以您必须对表进行全面扫描。

没有什么可补充的。

也许你的意思是计算（计算？）索引之类的东西......但到目前为止，我只在 Intersystems Caché 中看到过这个。我认为关系数据库（AFAIK）中没有案例。

在我看来，一个好的解决方案如下（更新的 clintp 示例）：

```
SELECT * FROM translist 
WHERE TranDateTime >= '2008-08-17 00:00:00.0000'
  AND TranDateTime < '2008-08-18 00:00:00.0000' 
```

无论您使用`00:00:00.0000`还是`00:00`我认为都没有区别（我通常以这种格式使用它）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-10-17T04:19:25.943

datetime LIKE something% 也不会捕获索引。

使用这个： **WHERE datetime_field >= curdate();**
这将捕获索引，
并涵盖**today:00:00:00 到 today:23:59:59**
Done。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-18T18:20:52.697

“解释”说什么？（运行 EXPLAIN SELECT * FROM transactionlist where date(TranDateTime) = '2008-08-17'）

如果由于 date() 函数而没有使用您的索引，则范围查询应该运行得很快：

SELECT * FROM transactionlist where TranDateTime >= '2008-08-17' AND TranDateTime < '2008-08-18'

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-18T18:24:27.917

而不是基于函数创建索引（如果这在 mysql 中甚至可能的话）让你的 where 子句进行范围比较。就像是：

> 其中 TranDateTime > '2008-08-17 00:00:00' 和 TranDateTime < '2008-08-17 11:59:59')

这使数据库可以使用 TranDateTime 上的索引（有一个，对吗？）进行选择。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-12-14T05:30:05.710

如果可以选择修改表，或者您正在编写新表，请考虑将日期和时间存储在具有相应类型的单独列中。您可以通过更小的键空间和更少的存储来获得性能（与从日期时间派生的仅日期列相比）。这也使得在复合键中使用变得可行，甚至在其他列之前使用。

在 OP 的情况下：

```
+-------------------+------------------+------+-----+---------+----------------+
| Field             | Type             | Null | Key | Default | Extra          |
+-------------------+------------------+------+-----+---------+----------------+
| TransactionNumber | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| WagerId           | int(11)          | YES  | MUL | 0       |                |
| TranNum           | int(11)          | YES  | MUL | 0       |                |
| TranDate          | date             | NO   |     | NULL    |                |
| TranTime          | time             | NO   |     | NULL    |                |
| Amount            | double           | YES  |     | 0       |                |
| Action            | smallint(6)      | YES  |     | 0       |                |
| Uid               | int(11)          | YES  |     | 1       |                |
| AuthId            | int(11)          | YES  |     | 1       |                |
+-------------------+------------------+------+-----+---------+----------------+ 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2011-08-08T09:11:54.080

创建一个仅包含日期的新字段，`convert(datetime, left(date_field,10))`然后对其进行索引。

# continuous-integration - CruiseControl + Starteam：不拾取所有文件

> ID：95192
> 
> 赞同：4
> 
> 时间：2008-09-18T18:16:09.650
> 
> 标签：continuous-integration, cruisecontrol.net, starteam

我们的 CruiseControl 系统从 starteam 签出。我注意到它有时不检查新版本的文件，只检查添加的文件。

有人知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T18:29:34.970

我不能说*为什么*会发生这种情况，但无论如何，我们通过让 StarTeam 在签出前删除所有本地文件来完全避免这个问题。我们以这种方式获取*所有*文件。我们在 NAnt 脚本中使用以下 StarTeam 参数：

```
delete-local -q -p &quot;${starteam_project_root}&quot; -is -filter &quot;N&quot; -cfgd &quot;${exec_time}&quot; 
```

这意味着：

```
delete-local -q -p "user:passwd@SERVER:49201/ProjectName/" -is -filter "N"-cfgd "09/18/2008 14:33:22" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-20T20:09:46.357

我最近遇到了同样的问题。发生这种情况的原因与您在 GUI 中看不到过期文件或您有一个状态未知的文件、状态未更新的原因相同。因此，如果您更新文件的状态，它将能够从源代码管理中获取那些已更改的文件。我们通过在配置文件中添加一个步骤来实现这一点。

```
 <prebuild>
    <exec>
      <executable>C:\Program Files\Borland\StarTeam Cross-Platform Client 2006 R2\stcmd.exe</executable >
      <buildArgs>update-status -nologo -is -q -p "username:password@192.168.0.1:49201/Code Project/Code Path" -fp "C:\projects\My Code Directory"</buildArgs>
      <buildTimeoutSeconds>0</buildTimeoutSeconds>
    </exec>
  </prebuild> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:37:26.840

这是一个 CI 构建，所以我想查看每个构建的差异，清理构建每次都会给我一个新的构建，我不知道什么是新的。

所以这是一个已知问题？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T15:32:23.373

如果您正在使用 StarTeam Ant 任务，请检查您为**包含**和**排除**参数设置的内容，以确保您不会无意中限制要签出的内容。

此外，**强制**和**递归**参数也可能需要查看。

您可以在此处查看结帐任务的完整说明：

[http://nantcontrib.sourceforge.net/help/tasks/stcheckout.html](http://nantcontrib.sourceforge.net/help/tasks/stcheckout.html)

# objective-c - 如何从 Xcode 项目生成 Makefile？

> ID：95211
> 
> 赞同：18
> 
> 时间：2008-09-18T18:17:39.163
> 
> 标签：objective-c, xcode, macos, makefile

我想从 Mac 上现有的 Xcode 项目生成 Makefile。具体来说，Mac 上现有的 iPhone、Objective-C 程序。

我找到[了 PBToMake](http://members.bellatlantic.net/%7Evze35xda/software.html)，但它看起来适用于 Xcode 2.1，当我尝试使用它时，它不适用于 Xcode 3.1 项目。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-01-30T06:54:22.460

GNUStep 提供“ [pbxbuild](http://wiki.gnustep.org/index.php/Pbxbuild) ”来将 .xcodeproj 文件转换为 GNUMakefile。

**更新：** [pbxbuild 现在已弃用](http://gnustep.8.n7.nabble.com/pbxbuild-is-now-deprecated-td24464.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-06T14:26:15.723

它不是生成 Makefile 的自动方式，但我发现它至少可以获得为目标构建的源文件列表。

在这种情况下，我使用的是 Xcode 4.0.2 ..

*   选择项目顶部节点
*   在目标列表中选择目标。
*   选择“构建阶段”
*   打开“编译源”
*   选择一个源文件
*   按 Command-A 全选
*   按 Command-C 复制
*   粘贴到您最喜欢的文本编辑器中，然后使用正则表达式进行重组。

粘贴的输出是每个源文件的完整路径名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T18:53:33.540

Xcode does not support generating a Makefile from a project. If you just want to build your project outside of the IDE, check out the `xcodebuild` command-line tool.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T22:30:24.523

你可以试试[mfg](http://freshmeat.net/projects/mfg/?topic_id=46)。它是基于模板的，我认为（我没有玩太多）你可以让它生成一个合适的 makefile。

# javascript - jQuery 可以将 cookie 读/写到浏览器吗？

> ID：95213
> 
> 赞同：99
> 
> 时间：2008-09-18T18:17:54.997
> 
> 标签：javascript, jquery, cookies

简单的例子：我想在页面上有一些项目（比如 div 或表格行），我想让用户点击它们来选择它们。这在 jQuery 中似乎很容易。为了在没有服务器端回传的情况下保存用户点击的项目，我认为 cookie 将是完成此任务的一种简单方法。

1.  在这种情况下是否可以假设 cookie 是可以的，对吗？
2.  如果它是正确的，jQuery API 是否有某种方式来读取/写入比默认 JavaScript API 更好的 cookie 信息？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-02-05T21:05:44.530

用于设置 cookie 的默认 JavaScript“API”很简单：

```
document.cookie = 'mycookie=valueOfCookie;expires=DateHere;path=/' 
```

使用 jQuery cookie 插件，如：

```
$.cookie('mycookie', 'valueOfCookie') 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-18T18:29:34.283

您将需要 cookie 插件，它为 cookie 函数提供了几个额外的签名。

`$.cookie('cookie_name', 'cookie_value')`存储一个临时 cookie（仅存在于此会话的范围内，同时`$.cookie('cookie_name', 'cookie_value', 'cookie_expiration")`创建一个跨会话持续存在的 cookie - 请参阅[http://www.stilbuero.de/2006/09/17/cookie-plugin-for-jquery/](http://www.stilbuero.de/2006/09/17/cookie-plugin-for-jquery/)了解更多信息在 JQuery cookie 插件上。

如果要设置用于整个站点的 cookie，则需要像这样使用 JavaScript：

```
document.cookie = "name=value; expires=date; domain=domain; path=path; secure" 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-15T16:52:32.087

一个新的 jQuery 插件，用于 cookie 检索和操作，绑定表单等： http: [//plugins.jquery.com/project/cookies](http://plugins.jquery.com/project/cookies)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-18T18:29:19.230

要回答你的问题，是的。另一个已经回答了那部分，但似乎你也在问这是否是最好的方法。

这可能取决于你在做什么。通常，您会让用户单击他们想要购买的商品（例如订购）。然后他们会点击购买或结账按钮。然后表单将发送到一个页面并处理结果。您可以使用 cookie 完成所有这些操作，但我会发现这更困难。

您可能需要考虑在另一个主题中发布您的第二个问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-18T18:20:24.070

看看 jQuery 的[Cookie 插件](http://plugins.jquery.com/cookie/)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-01-15T23:28:02.610

您可以在此处浏览所有带有“cookie”标签的 jQuery 插件：

[http://plugins.jquery.com/plugin-tags/cookies](http://plugins.jquery.com/plugin-tags/cookies)

那里有很多选择。

查看名为 jQuery Storage 的版本，它利用了 HTML5 的 localStorage。如果 localStorage 不可用，则默认为 cookie。但是，它不允许您设置过期时间。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-09-21T22:09:45.537

jQuery cookie 插件似乎无法下载。但是，您可以下载相同的 jQuery cookie 插件，并在*[jQuery & Cookies (get/set/delete & a plugin)](http://jquery-howto.blogspot.com/2010/09/jquery-cookies-getsetdelete-plugin.html)*中描述了一些改进。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-06-13T15:22:18.373

我已经设法编写了一个脚本，允许用户选择他/她的语言，使用来自[Klaus Hartl](https://github.com/carhartl/jquery-cookie)的 cookie 脚本。我花了几个小时的工作，我希望我能帮助别人。

# sql - T-SQL 触发器触发“列名或提供的值的数量与表定义不匹配”错误

> ID：95218
> 
> 赞同：5
> 
> 时间：2008-09-18T18:18:14.840
> 
> 标签：sql, tsql, triggers

这是我无法解决的问题，我**到处**寻找。也许这里有人会知道！

我有一个名为 dandb_raw 的表，其中特别包含三列：dunsId (PK)、name 和 searchName。我还有一个作用于此表的触发器：

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER TRIGGER [dandb_raw_searchNames]
    ON [dandb_raw]
    FOR INSERT, UPDATE
    AS

SET NOCOUNT ON

  select dunsId, name into #magic from inserted

        UPDATE dandb
            SET dandb.searchName = company_generateSearchName(dandb.name)
            FROM (select dunsId, name from #magic) i
            INNER JOIN dandb_raw dandb
                on i.dunsId = dandb.dunsId

        --Add new search matches
        SELECT c.companyId, dandb.dunsId
            INTO #newMatches
            FROM dandb_raw dandb
            INNER JOIN (select dunsId, name from #magic) a
                on a.dunsId = dandb.dunsId
            INNER JOIN companies c
                ON dandb.searchName = c.searchBrand
                --avoid url matches that are potentially wrong
                AND (lower(dandb.url) = lower(c.url)
                    OR dandb.url = ''
                    OR c.url = ''
                    OR c.url is null)

        INSERT INTO #newMatches (companyId, dunsId)
        SELECT c.companyId, max(dandb.dunsId) dunsId
            FROM dandb_raw dandb
            INNER JOIN
                (
                    select
                    case when charindex('/',url) <> 0 then left(url, charindex('/',url)-1)
                    else url
                    end urlMatch, * from companies
                ) c
                ON dandb.url = c.urlMatch
            where subsidiaryOf = 1 and isReported = 1 and dandb.url <> ''
                and c.companyId not in (select companyId from #newMatches)
            group by companyId
            having count(dandb.dunsId) = 1

        UPDATE cd
            SET cd.dunsId = nm.dunsId
            FROM companies_dandb cd
            INNER JOIN #newMatches nm
                ON cd.companyId = nm.companyId
GO 
```

触发器导致插入失败：

```
insert into  [dandb_raw](dunsId, name)
    select 3442355, 'harper'
    union all
    select 34425355, 'har 466per'
update [dandb_raw] set name ='grap6767e' 
```

出现此错误：

```
Msg 213, Level 16, State 1, Procedure companies_contactInfo_updateTerritories, Line 20
Insert Error: Column name or number of supplied values does not match table definition. 
```

对此最奇怪的是，触发器中的每个单独的语句都是独立工作的。如果您尝试将插入的临时表移动到其中一个中，就好像 insert 是一个一次性的表，它会感染临时表。

那么是什么导致触发器失败呢？怎么能阻止？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T19:07:23.443

我认为 David 和 Cervo 的结合已经解决了这里的问题。

我很确定发生的部分原因是我们在多个触发器中使用了#newMatches。当一个触发器更改了某些行时，它会触发另一个触发器，该触发器将尝试使用连接范围内的#newMatches。

结果，它会尝试找到已经存在的具有不同模式的表，然后死掉，并产生上面的消息。一个有利于的证据：插入是否使用堆栈样式范围（嵌套触发器有自己的插入？）

不过仍在猜测 - 至少现在事情似乎正在发挥作用！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:49:47.760

什么是company_contactInfo_updateTerritories？实际参考中提到了程序“companies_contactInfo_updateTerritories”，但我在给出的代码中没有看到它。我也看不到它在哪里被调用。除非它来自您的应用程序正在调用 SQL，因此无关紧要......

如果您测试了所有东西并且它工作但现在它不起作用，那么一定有什么不同。要考虑的一件事是安全性。我注意到您只是调用表 [dandb_raw] 而不是 [dbo].[dandb_raw]。因此，如果用户有一个同名的表 [user].[dandb_raw]，则该表将用于检查定义而不是您的表。此外，触发器创建临时表。但是，如果某些临时表由于某种原因已经存在但具有不同的定义，那么这也可能是一个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:04:06.137

我在代码中没有看到任何明显的问题。

“SELECT .. INTO”是弱功夫。尝试显式创建临时表定义：

```
CREATE TABLE #newMatches
(
  CompanyID int PRIMARY KEY,
  DunsID int
) 
```

完成#newMatches 后，您应该删除它，以便稍后再次创建它（临时表是连接范围的！！）

```
DROP TABLE #newMatches 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T21:49:25.503

触发器代码（因为它必须在每次更新数据时运行）必须高效并且必须考虑多个记录插入。你第二次成功了，但第一次没有成功。您使这变得过于复杂，并且在语句中使用了诸如 Not 之类的东西，这些东西通常比使用左连接效率低。这里不需要临时表（我永远不会考虑在触发器中使用临时表），因为它们会增加触发器的效率。没有理由不写 From insert i 而不是 FROM (select dunsId, name from #magic) i

第一个可能更快，更易于阅读和维护。

这里： JOIN (select case when charindex('/',url) <> 0 then left(url, charindex('/',url)-1) else url end urlMatch, * from Companies ) c ON dandb.url = c .urlMatch

您正在选择表中的所有字段，即使您似乎只使用了一个字段。为什么？您还在公司的所有记录上运行该案例陈述，即使在您加入后您可能不需要所有这些记录。

通常我也会避免使用 select * 但尤其是在触发器中。假设您正在插入另一个表，并且您使用 select * from some table join 以插入或删除。向该表添加一列将导致触发器失败并停止所有数据更改，直到它被修复。

您还在触发器中使用了一个函数。如果你有一个大的插入，这可能会非常缓慢。我建议您通过更新大量记录来测试这一点，看看会发生什么。所有数据更改都不会仅从用户界面发生，一次一个记录。有时会从管理工作室中的临时查询更新一个字段（当所有价格都需要调整 10% 时，这是想到的最简单的示例。）您的触发器需要能够处理这些类型，如果更新以及您期望的更新。我会运行一个更新 100000 行的测试用例，看看这个触发器减慢了多少。

也许这并不能真正回答您的问题，但触发器远非最佳，我不得不说。

# eclipse-rcp - 如何为内部项目评估 Eclipse RCP？

> ID：95221
> 
> 赞同：1
> 
> 时间：2008-09-18T18:18:34.810
> 
> 标签：eclipse-rcp, eclipse-ecf

我对 Eclipse RCP 只有一个基本的了解。我即将为我们的技术支持团队启动一个内部应用程序，该应用程序可能会随着时间的推移而增长。该团队分布在各大洲，因此我希望能够在新版本可用时自动更新应用程序。该应用程序旨在从技术支持事件中获取知识，同时使跨客户端重放数据修复变得容易。使 Eclipse RCP 看起来很有趣的是 Eclipse 通信框架 (ECF) 和数据工具平台 (DTP)。我的限制是：

1.  小团队（现在基本上只有我 :)
2.  必须将其作为副项目进行管理，直到其有用性得到证明

我基本上是在寻找其他使用过 Eclipse RCP 或知道更好替代方案的开发人员的见解。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T19:30:27.693

评估 RCP 的最佳方法是创建一个小项目......我从这里的教程开始：http: [//www.ibm.com/developerworks/edu/os-dw-os-ecl-rcpapp.html](http://www.ibm.com/developerworks/edu/os-dw-os-ecl-rcpapp.html)并逐渐创建一个不那么简单的应用程序。

可能我找到的最好的单一资源是“Eclipse Rich Client Platform”一书（我最初是从当地大学图书馆借来的。这本书的网站在这里：[http](http://eclipsercp.org/book/) ://eclipsercp.org/book/ 。

RCP 唯一的缺点是分布式程序的大小，但自动软件更新功能使这变得不那么痛苦，如果您使用插件模块化应用程序，用户不必下载整个应用程序来接收更新插入。

# emacs - Emacs 的 GLSL 主模式？

> ID：95222
> 
> 赞同：14
> 
> 时间：2008-09-18T18:18:36.713
> 
> 标签：emacs, elisp, glsl

我找到了这个链接[http://artis.imag.fr/~Xavier.Decoret/resources/glsl-mode/](http://artis.imag.fr/~Xavier.Decoret/resources/glsl-mode/)，但是除了它“简单”之外，没有太多关于它的描述。

理想情况下，我想要一个可以做到这一点的 CcMode 扩展，或者至少是一个可以处理自动样式并具有与 CcMode 类似的快捷方式的模式。

如果没有，任何可以帮助我自己开始编写它的好的 elisp 参考将不胜感激。

编辑：大卫的回应促使我仔细研究 glsl-mode.el，它实际上是基于 cc-mode，所以这正是我首先要寻找的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-18T18:40:16.490

将以下代码添加到您的 ~/.emacs 文件中。

```
(autoload 'glsl-mode "glsl-mode" nil t)
(add-to-list 'auto-mode-alist '("\\.vert\\'" . glsl-mode))
(add-to-list 'auto-mode-alist '("\\.frag\\'" . glsl-mode)) 
```

将文件[http://artis.imag.fr/~Xavier.Decoret/resources/glsl-mode/glsl-mode.el](http://artis.imag.fr/~Xavier.Decoret/resources/glsl-mode/glsl-mode.el)放在您的 emacs 路径的某个位置。您可以在您的*暂存*缓冲区中评估（打印加载路径）以获取可能位置的列表。如果您没有对其中任何一个的写入权限，则可以通过添加将另一个位置附加到加载路径

```
(setq load-path (cons "~/.emacs.d" load-path)) 
```

到您的 ~/.emacs 文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-30T05:57:10.840

基于 GLSL 模式，我为 HLSL 编写了一个类似的，用于 Direct3D 效果。这里是。[http://sourceforge.net/projects/hlslmode/files/hlsl-mode.el](http://sourceforge.net/projects/hlslmode/files/hlsl-mode.el)

# c# - 使用 C# 通过网络发送文件的最佳方式是什么？

> ID：95235
> 
> 赞同：8
> 
> 时间：2008-09-18T18:19:48.677
> 
> 标签：c#, .net, ftp, tcp, data-transfer

任何人都可以向我指出有关打开从客户端到服务器的连接、读取二进制文件并通过网络连接可靠地发送其内容的最佳方法的教程吗？更好的是，有没有我可以参考的已经这样做的开源库？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T18:32:32.047

您应该研究二进制序列化并通过 TCP 套接字发送它。

关于不同类型的序列化的很好的解释：

[http://www.dotnetspider.com/resources/408-XML-serialization-Binary-serialization.aspx](http://www.dotnetspider.com/resources/408-XML-serialization-Binary-serialization.aspx)

C# 中 TCP 客户端/服务器的良好入门：

[http://www.codeproject.com/KB/IP/tcpclientserver.aspx](http://www.codeproject.com/KB/IP/tcpclientserver.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T18:26:41.187

这取决于您所说的网络是什么意思——如果您在本地网络上复制，您可以只使用 System.IO 中的文件复制操作。如果您想发送到远程服务器，我会使用 Web 服务来执行此操作。我压缩字节数组并将它们发送过来并在远程端解压缩。字节数组非常容易使用流写回磁盘。

我知道有些人更喜欢 base 64 字符串而不是 byte[]。不确定是否重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T18:26:16.927

我不会使用 HTTP 或 FTP，因为对于单个文件来说开销太大而且编码太多，尤其是在 C# 中几乎已经为您制作了一个简单的 TCP 服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:47:30.133

如果您只需要通过网络进行操作，套接字可能是最佳途径。如果使用 TCP，您可以获得通信的可靠性，但会影响速度。如果您需要更高的性能，您可以尝试使用 UDP。但是 UDP 的缺点是不能保证数据包的传递和顺序，所以你需要自己编写所有的管道。

如果您需要通过 Web 本身传输文件（以编程方式，并且如果您不能使用 FTP），那么通过[MTOM](http://msdn.microsoft.com/en-us/library/aa395209.aspx)的 Web 服务方法可能会满足您的需求。

如果您在 Windows Server 2003 R2、Windows Vista 或 Windows Server 2008 之上构建并进行内部网络传输，则另一个选择是利用新的[远程差分压缩](http://msdn.microsoft.com/en-us/library/aa372948.aspx)功能。这不仅在压缩文件以最小化网络流量方面做得非常好，而且还被 DFS 复制直接使用。缺点（作为 .NET 开发人员），它是一种 COM+ 技术。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:23:18.260

使用 HTTP 或 FTP 怎么样？他们是为此而生的。

亚历克斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T18:23:57.260

根据您将文件发送到的位置，您可能需要查看[WebClient.UploadFileAsync](http://msdn.microsoft.com/en-us/library/system.net.webclient.uploadfileasync(VS.80).aspx)和[WebClient.UploadFile](http://msdn.microsoft.com/en-us/library/system.net.webclient.uploadfile(VS.80).aspx)。

# sql-server - 如何在 sql server 2005 中获取 x 和 y 之间的日期表

> ID：95257
> 
> 赞同：10
> 
> 时间：2008-09-18T18:21:35.177
> 
> 标签：sql-server, date, temp-tables, procedure

我只是想要一种快速的方法（最好不使用while循环）来创建日期@x和日期@y之间的每个日期的表，这样我就可以将外部连接留在一些统计表中，其中一些肯定没有记录之间的天数，允许我用 0 标记缺失的天数

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-18T19:00:12.120

严格来说，这并不能完全回答您的问题，但它非常整洁。

假设您可以指定开始日期之后的天数，那么使用公用表表达式可以为您提供：

```
WITH numbers ( n ) AS (
        SELECT 1 UNION ALL
        SELECT 1 + n FROM numbers WHERE n < 500 )
    SELECT DATEADD(day,n-1,'2008/11/01') FROM numbers
    OPTION ( MAXRECURSION 500 ) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:29:22.563

我将创建一个日历表，其中只包含从合适的开始日期到合适的结束日期的每个日期。这不会在您的数据库中占用太多空间，并且会使这些类型的查询成为孩子的游戏。

```
select  ...
from    Calendar
        left outer join
        ...
where   Calendar.Date >= @x
and     Calendar.Date <= @y 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:26:06.133

我认为您不妨在一个while循环中执行它。我知道这很丑，但它很容易而且很有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:27:19.937

不久前我实际上正在做类似的事情，但我想不出一种不使用循环的方法。

我得到的最好的是一个临时表，然后选择我想加入的日期。

链接到的博客 bduke 很可爱，尽管我认为临时表解决方案可能是更清洁的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:41:59.073

我找到了另一个存储每个日期的表（它是网站的访问者），那么这个怎么样......

```
Declare @FromDate datetime,  
        @ToDate datetime  
Declare @tmpDates table   
            (StatsDate datetime)
Set @FromDate = DateAdd(day,-30,GetDate())
Set @ToDate = GetDate()

Insert Into  @tmpDates (StatsDate)
Select 
    distinct CAST(FLOOR(CAST(visitDate AS DECIMAL(12, 5))) AS DATETIME)
FROM tbl_visitorstats 
Where visitDate between @FromDate And @ToDate 
Order By CAST(FLOOR(CAST(visitDate AS DECIMAL(12, 5))) AS DATETIME) 

Select * FROM @tmpDates 
```

它确实依赖于另一个表，我想要的每个日期都有一个条目，但是 98% 的可能性是每天都会有数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-15T01:32:54.143

[对https://stackoverflow.com/a/95728/395440](https://stackoverflow.com/a/95728/395440)给出的答案略有不同。允许指定天数并计算截至当前日期的范围。

```
DECLARE @startDate datetime
SET @startDate = '2015/5/29';

WITH number ( n ) AS (
        SELECT 1 UNION ALL
        SELECT 1 + n FROM dates WHERE n < DATEDIFF(Day, @startDate, GETDATE()) )
    SELECT DATEADD(day,n-1,@startDate) FROM number where
    datename(dw, DATEADD(day,n-1,@startDate)) in ('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
    OPTION ( MAXRECURSION 500 ) 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-18T19:21:14.520

只写循环。有人必须为此编写一个循环，无论是您还是 SQL Server。

```
DECLARE @Dates TABLE
(
  TheDate datetime PRIMARY KEY
)
DECLARE @StartDate datetime, @EndDate datetime
SELECT @StartDate = '2000-01-01', @EndDate = '2010-01-01'

DECLARE @LoopVar int, @LoopEnd int    
SELECT @LoopEnd = DateDiff(dd, @StartDate, @EndDate), @LoopVar = 0

WHILE @LoopVar <= @LoopEnd
BEGIN
  INSERT INTO @Dates (TheDate)
  SELECT DateAdd(dd,@LoopVar,@StartDate)

  SET @LoopVar = @LoopVar + 1
END

SELECT *
FROM @Dates 
```

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2008-09-18T18:22:56.593

只是： WHERE col > start-date AND col < end-date

# sql - 如何在 MS Access 2003 中创建参数化查询并使用其他查询/表单来填充参数并获得结果集

> ID：95277
> 
> 赞同：3
> 
> 时间：2008-09-18T18:23:29.820
> 
> 标签：sql, ms-access

我希望能够在 MS Access 2003 中创建参数化查询并将某些表单元素的值提供给该查询，然后获取相应的结果集并使用它们进行一些基本计算。我在弄清楚如何让查询的参数由表单元素填充方面做得很短。如果我必须使用 VBA，那很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T21:48:22.713

可以直接在 Access 查询中使用对表单上的控件的引用，但将它们定义为参数很重要（否则，最近版本的 Access 中的结果可能无法预测，因为它们曾经是可靠的）。

例如，如果您想通过 MyForm 上的 LastName 控件过滤查询，您可以使用它作为您的条件：

```
LastName = Forms!MyForm!LastName 
```

然后，您将表单引用定义为参数。生成的 SQL 可能如下所示：

```
PARAMETERS [[Forms]!MyForm![LastName]] Text ( 255 );
SELECT tblCustomers.*
FROM tblCustomers
WHERE tblCustomers.LastName=[Forms]![MyForm]![LastName]; 
```

但是，我会问为什么您需要为此目的保存查询。你对结果做了什么？在表格或报告中显示它们？如果是这样，您可以在表单/报告的 Recordsource 中执行此操作，并使保存的查询不受参数影响，因此可以在其他上下文中使用它而不会弹出提示填写参数。

另一方面，如果您在代码中做某事，只需动态编写 SQL 并使用表单控件的文字值来构造 WHERE 子句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:29:02.940

这是一段代码。它使用参数 txtHospital 更新表：

```
Set db = CurrentDb

Set qdf = db.QueryDefs("AddHospital")
qdf.Parameters!txtHospital = Trim(Me.HospName)
qdf.ReturnsRecords = False

qdf.Execute dbFailOnError

intResult = qdf.RecordsAffected 
```

下面是一个 SQL 示例：

```
PARAMETERS txtHospital Text(255); 

INSERT INTO tblHospitals ( 
[Hospital] )

VALUES ( 
[txtHospital] ) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:40:06.877

解决此问题的传统方法有以下三种：

1.  将参数命名为 cleaver，以便在运行查询时提示用户输入值。
2.  表单上的参考字段（可能隐藏）
3.  即时构建查询，不要使用参数。

我认为您必须`[?enter ISO code of the country]`在表单上注入类似或对字段的引用，例如 : ，这对我来说是错误的`[Forms]![MyForm]![LastName]`。

这意味着我们不能在多个地方重复使用相同的查询，不同的字段提供数据，或者必须依靠用户在查询运行时不要弄乱数据输入。我记得，对于用户输入的参数，可能很难多次使用相同的值。

通常，我选择了最后一个选项来动态构建查询，并根据需要更新查询对象。但是，对于 SQL 注入攻击（偶然或故意了解我的用户）来说，这很普遍，而且很恶心。

所以我做了一些挖掘，我在这里找到了以下内容（[http://forums.devarticles.com/microsoft-access-development-49/pass-parameters-from-vba-to-query-62367.html](http://forums.devarticles.com/microsoft-access-development-49/pass-parameters-from-vba-to-query-62367.html)）：

```
'Ed. Start - for completion of the example
dim qryStartDate as date
dim qryEndDate as date
qryStartDate = #2001-01-01# 
qryEndDate = #2010-01-01#   
'Ed. End

'QUOTEING "stallyon": To pass parameters to a query in VBA 
'                     is really quite simple:

'First we'll set some variables:
Dim qdf As Querydef
Dim rst As Recordset

'then we'll open up the query:
Set qdf = CurrentDB.QueryDefs(qryname)

'Now we'll assign values to the query using the parameters option:
qdf.Parameters(0) = qryStartDate
qdf.Parameters(1) = qryEndDate

'Now we'll convert the querydef to a recordset and run it
Set rst = qdf.OpenRecordset

'Run some code on the recordset
'Close all objects
rst.Close
qdf.Close
Set rst = Nothing
Set qdf = Nothing 
```

（我自己没有测试过，只是我在旅行中收集的东西，因为每隔一段时间我都想做这个，但最终使用了我之前提到的一个 kludges）

**编辑** 我终于有理由使用它了。这是实际的代码。

```
'...
Dim qdf As DAO.QueryDef
Dim prmOne As DAO.Parameter
Dim prmTwo As DAO.Parameter
Dim rst as recordset
    '...
    'open up the query:
    Set qdf = db.QueryDefs("my_two_param_query") 'params called param_one and 
                                                 'param_two

    'link your DAP.Parameters to the query
    Set prmOne = qdf.Parameters!param_one
    Set prmTwo = qdf.Parameters!param_two

    'set the values of the parameters
    prmOne = 1 
    prmTwo = 2

    Set rst = qdf.OpenRecordset(dbOpenDynaset, _
                                            dbSeeChanges)
    '... treat the recordset as normal

    'make sure you clean up after your self
    Set rst = Nothing
    Set prmOne = Nothing
    Set prmTwo = Nothing
    Set qdf = Nothing 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:39:04.460

让我们举个例子。参数化查询如下所示：

```
Select Tbl_Country.* From Tbl_Country WHERE id_Country = _
    [?enter ISO code of the country] 
```

并且您希望能够从表单中获取此值（[?enter ... country] 之一），其中您有控件和一些数据。嗯......这可能是可能的，但它需要一些代码规范化。

一种解决方案是让您的表单控件以某种逻辑命名，例如`fid_Country`用于保存`id_Country`值的控件。然后，您可以将查询作为字符串：

```
qr = "Select Tbl_Country.* From Tbl_Country WHERE id_Country = [fid_country]" 
```

在表单中输入所有请求的数据后，按“查询”按钮。逻辑将浏览所有控件并检查它们是否在查询中，最终将参数替换为控件的值：

```
Dim ctl as Control
For each ctl in Me.controls
    If instr(qr,"[" & ctl.name & "]") > 0 Then
         qr = replace(qr,"[" & ctl.name & "]",ctl.value)
    End if
Next i 
```

这样做，您将获得一个完全更新的查询，其中参数已被真实数据替换。根据 fid_country 的类型（字符串、GUID、日期等），您可能需要添加或不添加一些额外的双引号，以获得最终查询，例如：

```
qr = "Select Tbl_Country.* From Tbl_Country WHERE id_Country = ""GB""" 
```

这是一个完全兼容 Access 的查询，可用于打开记录集：

```
Set rsQuery = currentDb.openRecordset(qr) 
```

我想你已经完成了。

当您的目标是开发 Access 应用程序时，此主题至关重要。您必须为用户提供一种从其 GUI 查询数据的标准方法，不仅可以启动查询，还可以过滤连续表单（就像 Excel 使用“自动过滤”选项一样）和管理报告参数。祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-02-07T16:15:52.607

简单的方法在这里[Microsoft 'setparameter' 信息页面](https://msdn.microsoft.com/en-us/vba/access-vba/articles/docmd-setparameter-method-access)

```
DoCmd.SetParameter "frontMthOffset", -3
DoCmd.SetParameter "endMthOffset", -2
DoCmd.OpenQuery "QryShowDifference_ValuesChangedBetweenSELECTEDMonths" 
```

其中 Access 查询的 SQL 实际上在 SQL 中包含 [frontMthOffset]。例如

```
"select blah from mytable where dateoffset=[frontMthOffset]" 
```

这一切都行得通！

# .net - Log4Net：使用滚动日期在 RollingFileAppender 上设置最大备份文件

> ID：95286
> 
> 赞同：75
> 
> 时间：2008-09-18T18:24:06.997
> 
> 标签：.net, log4net

我有以下配置，但我找不到任何关于如何设置日期滚动样式的最大备份文件的文档。我知道您可以通过使用 maxSizeRollBackups 以大小滚动样式执行此操作。

```
<appender name="AppLogFileAppender" type="log4net.Appender.RollingFileAppender">
    <file value="mylog.log" />
    <appendToFile value="true" />
    <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
    <rollingStyle value="Date" />
    <datePattern value=".yyMMdd.'log'" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%d %-5p %c - %m%n"  />
    </layout>
</appender> 
```

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-18T22:26:14.183

你不能。

来自 [log4net SDK 参考
RollingFileAppender 类](https://logging.apache.org/log4net/release/sdk/html/T_log4net_Appender_RollingFileAppender.htm)

> **警告**
> 
> 不支持在日期/时间边界滚动时的最大备份文件数。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2010-05-26T20:40:36.617

即使它不受支持，以下是我处理这种情况的方法：

这是我的配置：

```
 <appender name="RollingLogFileAppender" type="log4net.Appender.RollingFileAppender">
        <file value="C:\logs\LoggingTest\logfile.txt" />
        <appendToFile value="true" />
        <rollingStyle value="Composite" />
        <datePattern value="yyyyMMdd" />
        <maxSizeRollBackups value="10" />
        <maximumFileSize value="1MB" />
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%date  - %message%newline" />
        </layout>
    </appender> 
```

在应用程序启动时，我会：

```
 XmlConfigurator.Configure();
 var date = DateTime.Now.AddDays(-10);
 var task = new LogFileCleanupTask();
 task.CleanUp(date); 
```

* * *

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;

using log4net;
using log4net.Appender;
using log4net.Config;

    public class LogFileCleanupTask
    {
        #region - Constructor -
        public LogFileCleanupTask()
        {
        }
        #endregion

        #region - Methods -
        /// <summary>
        /// Cleans up. Auto configures the cleanup based on the log4net configuration
        /// </summary>
        /// <param name="date">Anything prior will not be kept.</param>
        public void CleanUp(DateTime date)
        {
            string directory = string.Empty;
            string filePrefix = string.Empty;

            var repo = LogManager.GetAllRepositories().FirstOrDefault(); ;
            if (repo == null)
                throw new NotSupportedException("Log4Net has not been configured yet.");

            var app = repo.GetAppenders().Where(x => x.GetType() == typeof(RollingFileAppender)).FirstOrDefault();
            if (app != null)
            {
                var appender = app as RollingFileAppender;

                directory = Path.GetDirectoryName(appender.File);
                filePrefix = Path.GetFileName(appender.File);

                CleanUp(directory, filePrefix, date);
            }
        }

        /// <summary>
        /// Cleans up.
        /// </summary>
        /// <param name="logDirectory">The log directory.</param>
        /// <param name="logPrefix">The log prefix. Example: logfile dont include the file extension.</param>
        /// <param name="date">Anything prior will not be kept.</param>
        public void CleanUp(string logDirectory, string logPrefix, DateTime date)
        {
            if (string.IsNullOrEmpty(logDirectory))
                throw new ArgumentException("logDirectory is missing");

            if (string.IsNullOrEmpty(logPrefix))
                throw new ArgumentException("logPrefix is missing");

            var dirInfo = new DirectoryInfo(logDirectory);
            if (!dirInfo.Exists)
                return;

            var fileInfos = dirInfo.GetFiles("{0}*.*".Sub(logPrefix));
            if (fileInfos.Length == 0)
                return;

            foreach (var info in fileInfos)
            {
                if (info.CreationTime < date)
                {
                    info.Delete();
                }
            }

        }
        #endregion
    } 
```

Sub 方法是一个扩展方法，它基本上像这样包装 string.format：

```
/// <summary>
/// Extension helper methods for strings
/// </summary>
[DebuggerStepThrough, DebuggerNonUserCode]
public static class StringExtensions
{
    /// <summary>
    /// Formats a string using the <paramref name="format"/> and <paramref name="args"/>.
    /// </summary>
    /// <param name="format">The format.</param>
    /// <param name="args">The args.</param>
    /// <returns>A string with the format placeholders replaced by the args.</returns>
    public static string Sub(this string format, params object[] args)
    {
        return string.Format(format, args);
    }
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2016-06-07T12:19:49.997

要限制日志的数量，请不要在日期模式中包含年份或月份，例如 datePattern value="_dd'.log'"

这将每天创建一个新日志，并在下个月被覆盖。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-03-12T17:40:51.990

几个月前我花了一些时间研究这个。v1.2.10 不支持根据日期滚动删除较旧的日志文件。它在下一个版本的任务列表中。我自己拿了源代码并添加了功能，如果他们有兴趣，我会把它发布给其他人。问题和补丁可以在[https://issues.apache.org/jira/browse/LOG4NET-27](https://issues.apache.org/jira/browse/LOG4NET-27)找到。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-18T18:32:47.770

不确定你到底需要什么。以下是我的 lo4net.config 文件之一的摘录：

```
 <appender name="RollingFile" type="log4net.Appender.RollingFileAppender">
    <param name="File" value="App_Data\log"/>
    <param name="DatePattern" value=".yyyy-MM-dd-tt&quot;.log&quot;"/>
    <param name="AppendToFile" value="true"/>
    <param name="RollingStyle" value="Date"/>
    <param name="StaticLogFileName" value="false"/>
    <param name="maxSizeRollBackups" value="60" />
    <layout type="log4net.Layout.PatternLayout">
      <param name="ConversionPattern" value="%r %d [%t] %-5p %c - %m%n"/>
    </layout>
  </appender> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-03-12T15:09:40.020

我最近在尝试根据传递给我的服务的 maxAgeInDays 配置值清理日志日志时遇到了这种需求......正如我之前的许多人一样，我接触到了 NTFS“功能”隧道，这使得使用 FileInfo.CreationDate 有问题（尽管我也一直在解决这个问题）......

由于我有一个模式要摆脱，我决定只推出我自己的清理方法......我的记录器是通过编程方式配置的，所以我只在记录器设置完成后调用以下命令......

```
 //.........................
    //Log Config Stuff Above...

    log4net.Config.BasicConfigurator.Configure(fileAppender);
    if(logConfig.DaysToKeep > 0)
       CleanupLogs(logConfig.LogFilePath, logConfig.DaysToKeep);
}

static void CleanupLogs(string logPath, int maxAgeInDays)
{
    if (File.Exists(logPath))
    {
        var datePattern = "yyyy.MM.dd";
        List<string> logPatternsToKeep = new List<string>();
        for (var i = 0; i <= maxAgeInDays; i++)
        {
            logPatternsToKeep.Add(DateTime.Now.AddDays(-i).ToString(datePattern));
        }

        FileInfo fi = new FileInfo(logPath);

        var logFiles = fi.Directory.GetFiles(fi.Name + "*")
            .Where(x => logPatternsToKeep.All(y => !x.Name.Contains(y) && x.Name != fi.Name));

        foreach (var log in logFiles)
        {
            if (File.Exists(log.FullName)) File.Delete(log.FullName);
        }
    }
} 
```

可能不是最漂亮的方法，但对于我们的目的来说工作得很好......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-09T21:22:59.900

[NLog](http://nlog-project.org/)的设置方式与 Log4Net 几乎相同（并且得到了积极维护——甚至支持 .NET Core），支持基于日期的滚动日志。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-27T02:35:50.790

从 log4net appender 继承并添加你自己的覆盖方法来执行文件清理是相当容易的。我覆盖了 OpenFile 来执行此操作。这是一个自定义 log4net 附加程序的示例，可帮助您入门：[https ://stackoverflow.com/a/2385874/74585](https://stackoverflow.com/a/2385874/74585)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-17T16:48:54.013

不再担心每个日期更复杂的 x 以及只是指定和任意文件计数，只是将这个放在一起。小心[[SecurityAction.Demand]](https://stackoverflow.com/questions/2914819/what-is-the-purpose-of-the-permissionset-attribute-in-the-msdn-filesystemwatcher)。

```
public string LogPath { get; set; }
public int MaxFileCount { get; set; } = 10;

private FileSystemWatcher _fileSystemWatcher;

[PermissionSet(SecurityAction.Demand, Name = "FullTrust")]
public async Task StartAsync()
{
    await Task.Yield();

    if (!Directory.Exists(LogPath))
    { Directory.CreateDirectory(LogPath); }

    _fileSystemWatcher = new FileSystemWatcher
    {
        Filter = "*.*",
        Path = LogPath,
        EnableRaisingEvents = true,
        NotifyFilter = NotifyFilters.FileName
            | NotifyFilters.LastAccess
            | NotifyFilters.LastWrite
            | NotifyFilters.Security
            | NotifyFilters.Size
    };

    _fileSystemWatcher.Created += OnCreated;
}

public async Task StopAsync()
{
    await Task.Yield();

    _fileSystemWatcher.Created -= OnCreated; // prevents a resource / memory leak.
    _fileSystemWatcher = null; // not using dispose allows us to re-start if necessary.
}

private void OnCreated(object sender, FileSystemEventArgs e)
{
    var fileInfos = Directory
        .GetFiles(LogPath)
        .Select(filePath => new FileInfo(filePath))
        .OrderBy(fileInfo => fileInfo.LastWriteTime)
        .ToArray();

    if (fileInfos.Length <= MaxFileCount)
    { return; }

    // For every file (over MaxFileCount) delete, starting with the oldest file.
    for (var i = 0; i < fileInfos.Length - MaxFileCount; i++)
    {
        try
        {
            fileInfos[i].Delete();
        }
        catch (Exception ex)
        {
            /* Handle */
        }
    }
} 
```

# encryption - 标准库中加密的合法性

> ID：95297
> 
> 赞同：6
> 
> 时间：2008-09-18T18:25:32.063
> 
> 标签：encryption, programming-languages

一些编程语言（如 Java 和 C#）在其标准库中包含加密包。其他如 Python 和 Ruby 让你下载第三方模块来做强加密。我认为这是出于法律原因；也许 Sun Microsystems 有足够多的律师，他们不怕被起诉，而 Guido van Rossum 感觉更脆弱。

但法律实际上对此有何规定？在这一点上，如果开源作者在他们的编程语言的标准库中包含强加密，他们会担心吗？如果是这样，那他们为什么不呢？如果不是，那么 Sun 和 Microsoft 将如何摆脱它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-18T18:39:35.523

有两个问题：加密软件的进口和加密软件的出口。

一些国家（中国、俄罗斯、伊朗、伊拉克、缅甸等）限制其公民使用密码学。*向这些国家/地区进口*加密软件是违法的。

要在 JDK 中启用无限加密强度，您必须下载新的策略文件。如果您所在的国家/地区不允许导入加密，则那里的软件许可证不允许您使用该软件。这被称为“无限强度管辖政策”，下面我包括其 README.txt 的一部分。

其他国家，如美国，不想将加密软件出口到邪恶轴心。因此，将加密软件*出口到这些国家可能是非法的。*

美国的出口限制已大大放宽，可能是因为认识到将加密置于敌人手中是徒劳的，或者可能是为了鼓励使用已被 NSA 破坏的加密。但是，它们并没有完全消失。我不认为该软件可以被恐怖分子许可。

> JDK 5.0 的 JCE 已通过美国出口审查流程。JCE 框架以及标准附带的 SunJCE 提供程序是可导出的。
> 
> JCE 架构允许通过管辖策略文件配置灵活的加密强度。由于某些国家/地区的进口限制，JDK 5.0 软件分发的管辖策略文件对可用的加密强度进行了内置限制。此下载包中的管辖权策略文件（包含此 README 文件的包）不包含对加密强度的限制。这适用于大多数国家。框架供应商可以创建包含管辖政策文件的下载包，这些文件指定适用于政府强制限制的国家/地区的加密限制。这些国家/地区的用户可以下载适当的捆绑包，JCE 框架将强制执行指定的限制。
> 
> 建议您咨询您的出口/进口管制顾问或律师以确定确切的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T18:32:09.770

在美国，重要的法律是[ITAR](http://www.pmddtc.state.gov/itar_index.htm)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T18:33:58.563

快速谷歌出现了一篇维基百科的文章。

[http://en.wikipedia.org/wiki/Export_of_cryptography](http://en.wikipedia.org/wiki/Export_of_cryptography)

但截至目前，“无需重新发明轮子”似乎是正确的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:31:28.350

伊纳尔，但是……

Java 和 C# 是封闭源代码，因此在 EULA 中有条款或多或少地说“如果您在不应该使用的地方使用它，这不是我们的错”。他们还有律师团队来保护自己并执行该条款。

正如 OP 所说，大多数开源许可证没有类似的语言，即使有，他们也没有律师团队。

此外，从从美国出口加密软件是非法的日子开始，Python 和 PERL 比 Java 和 C# 更老。自从法律改变以来不添加密码学可能只是一个“一致性是好的”决定。

# regex - 寻找正则表达式以从 /etc/passwd 中提取电子邮件地址

> ID：95305
> 
> 赞同：1
> 
> 时间：2008-09-18T18:26:26.787
> 
> 标签：regex, linux, sed

我的大多数用户都有与他们的个人资料相关联的电子邮件地址`/etc/passwd`。它们总是在我可以抓取的第 5 个字段中，但它们出现在第 5 个字段中以逗号分隔的列表中的不同位置。

有人可以给我一个**正则表达式来从这个文件的一行中获取电子邮件地址**（用逗号分隔）吗？（我将在 bash 脚本中使用 grep 和 sed）

文件中的示例行：

```
user1:x:1147:5005:User One,Department,,,email@domain.org:/home/directory:/bin/bash
user2:x:1148:5002:User Two,Department2,email2@gmail.com,:/home/directory:/bin/bash 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T18:28:45.627

关于什么：

> ,([^@]+@[^,:]+)

组包含电子邮件地址的位置。

**[根据评论更新地址并不总是以逗号结尾]**

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-18T18:39:21.063

实际上，这对于 Awk 来说是一个完美的工作。现在，像大多数人一样，我会在继续之前说“我不是 Awk 专家”...

```
awk -F : '{print $5}' /etc/passwd 
```

将获得第 5 个字段，其中 ':' 是来自 /etc/passwd 的字段分隔符 - 它可能是您想要的第 5 个字段。

```
awk -F , '{print $1}' 
```

将从标准输入中获取第一个字段，其中“，”是他的定界符吗？

```
awk -F : '{print $5}' /etc/passwd | awk -F , '{print $1}' 
```

将从您的 /etc/passwd 文件中的第五个冒号分隔字段（包含所有那种杂乱无章的字段！）中获取第一个逗号分隔字段（名称字段）。

调整打印 $1 以获取包含您的电子邮件的字段。

毫无疑问，没有 awk 中的管道就可以做到这一点。我使用 Awk 来分割事物中的字段，而不是其他。我觉得它令人困惑，那是来自喜欢正则表达式的人......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T19:12:11.107

```
sed -r -e "s/^.*[,:]([^,:]+@[^,:]+).*$/\1/g" /etc/passwd 
```

会成功的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T18:29:02.273

搜索 @ 符号前后的所有电子邮件有效字符。像：

> [-A-z0-9。*]+@[-A-z0-9。*]+

贪婪匹配应该尽可能地提取所有内容，并且会在逗号或冒号处停止。

不过，请检查电子邮件地址中哪些字符有效。我遗漏了一些（比如+）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-19T04:29:42.770

```
sed 's/,*:\/.*//;s/^.*://;s/.*,//' /etc/passwd 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-18T18:29:08.357

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])? 
```

应该抓住大多数 emials

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-18T22:51:03.437

[标准RFC 2822](https://www.rfc-editor.org/rfc/rfc2822)怎么样：

```
(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]) 
```

是的。就是这样。:)

# javascript - 您使用什么工具和技术来修复浏览器内存泄漏？

> ID：95326
> 
> 赞同：11
> 
> 时间：2008-09-18T18:27:28.097
> 
> 标签：javascript, internet-explorer, memory

我正在尝试修复 IE 7 中的内存泄漏。使用 Drip 进行调查，但是当大多数动态生成的 DOM 元素没有唯一的 id 时，它并没有多大帮助。

尖端？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T18:33:39.297

您应该尝试在 Microsoft 内部开发的[Javascript 内存泄漏检测器。](https://docs.microsoft.com/en-us/archive/blogs/gpde/javascript-memory-leak-detector-v2)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T18:38:37.880

好吧，最好的办法是了解导致它们的原因，这样您就可以批判性地查看代码，识别可能导致泄漏的模式，然后避免或围绕它们进行重构。

这里有几个链接可以帮助您入门，两者都非常有用：

*   [http://www-128.ibm.com/developerworks/web/library/wa-memleak/](http://www-128.ibm.com/developerworks/web/library/wa-memleak/)
*   [http://msdn.microsoft.com/en-us/library/bb250448.aspx](http://msdn.microsoft.com/en-us/library/bb250448.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T18:33:08.253

请记住，内存泄漏实际上与您自己没有清理干净有关。你所需要的只是一个小组织。

过去，我创建了自己的代理对象，用于将事件附加到 DOM 元素。它使用我的 javascript 库的 api 来实际设置和删除事件。代理本身只是跟踪所有引用，以便我可以调用它的方法来清理所有潜在的内存泄漏。

出于我的目的，我可以只在页面上调用一个解构器，当用户离开页面时，它会清理整个页面的泄漏。

您可能必须更细化，但技术是相同的。

# rss - RSS 统计/流量指标

> ID：95346
> 
> 赞同：1
> 
> 时间：2008-09-18T18:29:18.497
> 
> 标签：rss, metrics

我想跟踪我在使用 .Net 2.0 和 SQL Server 设置的 RSS 提要上获得了多少流量。

是否有关于我应该使用哪些指标的行业标准，例如页面点击量？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T20:11:58.593

Feedburner 分析为您提供如下统计数据：（ [来源：][[blogperfume.com](http://www.blogperfume.com/feed-analysis/feed-analysis1.png)][）][![替代文字](https://i.stack.imgur.com/o5Mj5.png)](https://i.stack.imgur.com/o5Mj5.png)

[![替代文字](https://i.stack.imgur.com/Fn6dZ.png)](https://i.stack.imgur.com/Fn6dZ.png)
[（来源：[blogperfume.com](http://www.blogperfume.com/feed-analysis/feed-analysis2.png)）][（来源：][[blogperfume.com](http://www.blogperfume.com/feed-analysis/feed-analysis3.png)][）]
[![替代文字](https://i.stack.imgur.com/SCNh5.png)](https://i.stack.imgur.com/SCNh5.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:33:01.093

我同意，FeedBurner 可能是您最好的选择，几乎所有大型网站都使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:31:32.517

我鼓励您使用像[FeedBurner](http://www.feedburner.com/)这样的服务，而不是自己跟踪它。即使您不想使用第 3 方服务，它也会让您了解其他人跟踪 RSS 提要的内容。

# visual-studio - Visual Studio 2005\. RC 文件包括

> ID：95361
> 
> 赞同：9
> 
> 时间：2008-09-18T18:30:15.827
> 
> 标签：visual-studio, visual-studio-2005

我在 Visual Studio 2005 上用 C++ 编程。我的问题涉及 .rc 文件。您可以在 .rc 文件的顶部手动放置包含指令，例如 (#include "blah.h")。但这是个坏消息，因为有人第一次在资源编辑器中打开 .rc 文件时，它会被覆盖。我知道有一个地方可以进行这些定义，这样它们就不会被丢弃，但我找不到它，谷歌搜索也没有帮助。有人知道吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T18:59:11.250

以正常方式将您的#include 添加到文件中，但也将其添加到文件中的三个“TEXTINCLUDE”部分之一，如下所示：

```
2 TEXTINCLUDE
BEGIN
    "#include ""windows.h""\r\n"
     "#include ""blah.h\r\n"
     "\0"
 END 
```

请注意以下细节：

*   每行都包含在引号中
*   使用成对的引号，*例如*"" 将引号字符内联
*   每行以 \r\n 结束
*   以“\0”结束 TEXTINCLUDE 块

当资源编辑器重写文件时，放置在“1 TEXTINCLUDE”块中的语句将被写入 .rc 文件的开头。放置在 2 和 3 块中的语句紧随其后，因此您可以通过使用适当编号的块来保证相对的包含文件顺序。

如果您现有的 rc 文件尚未包含 TEXTINCLUDE 块，请使用解决方案资源管理器窗格中的新文件向导添加新的 rc 文件，然后将其用作模板。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T18:55:09.137

您希望[在编译时包含资源](http://msdn.microsoft.com/en-us/library/6e7446zd(VS.80).aspx)(MSDN)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T19:54:56.620

在 Visual Studio IDE 中，右键单击 .rc 文件（在“资源视图”面板中），然后从快捷菜单中选择“资源包含”。当对话框打开时，使用它的“编译时指令”区域输入您想要包含在 .rc 文件中的任何内容。例如，如果您希望 64 位和 32 位构建使用不同的图标，您可以为每个构建包含适当的资源文件，如下所示：

```
#ifdef WIN64
#include "Icons64.rc"
#else
#include "Icons32.rc"
#endif 
```

值得注意的是，这些定义默认情况下没有在资源编译器中设置，因此对于您的 64 位构建，请确保将 /DWIN64 添加到 rc 构建中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-25T08:44:26.330

所有血腥细节都可以在[MFC Technote #35](http://msdn.microsoft.com/en-us/library/6t3612sk.aspx)中找到。

-罗恩

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:50:19.880

我不完全确定您为什么要这样做，但是手动修改资源文件可能不是一个好主意。

我相信 VC++ 用于全局可访问值的一般做法是在 stdafx.h 中定义它们（至少我是这么看的），或者创建类似“globals.h”头文件的东西，并将其包含在你的任何位置需要它。不过，这实际上取决于您要完成的工作。

# vb.net - 如何修改 ReadOnly Linq 属性

> ID：95364
> 
> 赞同：1
> 
> 时间：2008-09-18T18:30:49.320
> 
> 标签：vb.net, linq-to-sql

我有一个带有只读属性的 LINQ to SQL 生成类：

```
<Column(Name:="totalLogins", Storage:="_TotalLogins", DbType:="Int", UpdateCheck:=UpdateCheck.Never)>  _
Public ReadOnly Property TotalLogins() As System.Nullable(Of Integer)
    Get
        Return Me._TotalLogins
    End Get
End Property 
```

这可以防止它在外部被更改，但我想从我的类中更新属性，如下所示：

```
Partial Public Class User

...

    Public Shared Sub Login(Username, Password)
        ValidateCredentials(UserName, Password)

        Dim dc As New MyDataContext()
        Dim user As User = (from u in dc.Users select u where u.UserName = Username)).FirstOrDefault()
        user._TotalLogins += 1
        dc.SubmitChanges()
    End Sub

...

End Class 
```

但是对 user._TotalLogins += 1 的调用没有被写入数据库？关于如何让 LINQ 查看我的更改的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T19:42:40.613

将现有 TotalLogins 属性设置为私有或受保护，并删除只读属性。您可能还想重命名它，例如 InternalTotalLogins。

然后在部分类中手动创建一个新属性，将其公开为只读属性：

```
Public ReadOnly Property TotalLogins() As System.Nullable(Of Integer)
    Get
        Return Me.InternalTotalLogins
    End Get
End Property 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T19:31:52.950

```
Make a second property that is protected or internal(?) 

<Column(Name:="totalLogins", Storage:="_TotalLogins", DbType:="Int", UpdateCheck:=UpdateCheck.Never)>  _
protected Property TotalLogins2() As System.Nullable(Of Integer)
    Get
        Return Me._TotalLogins
    End Get
    Set(byval value as System.Nullable(Of Integer))
        Return Me._TotalLogins
    End Get
End Property 
```

然后更新它。我认为默认情况下它不会保存只读属性。以及为什么要这样做。我现在这是一个黑客，但嘿，这就是生活。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-07T10:31:20.103

在更改字段之前调用 SendPropertyChanging()，然后在调用 SendPropertyChanged("") 之后。这将使 Table 实体跟踪知道发生了什么变化。

# spell-checking - 批量源代码感知拼写检查

> ID：95378
> 
> 赞同：12
> 
> 时间：2008-09-18T18:31:55.293
> 
> 标签：spell-checking

什么是可用于对整个源代码库及其相关资源文件执行拼写检查的工具或技术？

拼写检查应该是*源代码感知*的，这意味着它将坚持检查代码中的字符串文字，而不是代码本身。如果拼写检查器理解常见的资源文件格式，例如包含名称-值对的文本文件（仅检查值），则加分。如果您能告诉它应该检查 XML DTD 或 Schema 的哪些部分以及应该忽略哪些部分，那就太棒了。

许多 IDE 可以为您当前使用的文件执行此操作。我正在寻找的不同之处在于可以一次对整个源代码库进行操作。

诸如 Findbugs 或 PMD 类型的拼写错误工具将是理想的选择。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T20:19:44.627

正如您所提到的，许多 IDE 已经具有此功能，Eclipse 就是这样的 IDE。然而，与许多其他 IDE 不同的是，Eclipse 是：

一）开源

B) 设计为可编程的

例如，这是一篇关于从命令行使用 Eclipse 的代码格式化功能的文章： [http ://www.peterfriese.de/formatting-your-code-using-the-eclipse-code-formatter/](http://www.peterfriese.de/formatting-your-code-using-the-eclipse-code-formatter/)

理论上，您应该能够使用它的拼写检查机制做类似的事情。我知道这不是您正在寻找的东西，如果有一个程序可以在代码中进行拼写检查，那么显然会更好，但如果没有，那么 Eclipse 可能是下一个最好的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-14T17:00:19.957

这似乎有点旧，但似乎做得很好 [源代码拼写检查器](http://www.softario.com/scsc.html)

# c# - 传递参数以作为控制台或 GUI 应用程序启动？

> ID：95379
> 
> 赞同：3
> 
> 时间：2008-09-18T18:31:57.490
> 
> 标签：c#

我有一个控制台应用程序，它将通过调度程序启动。如果由于某种原因，该文件的一部分无法构建，我需要一个 GUI 前端，以便我们可以在第二天使用特定输入运行它。

是否可以将参数传递给应用程序入口点以根据传递的参数启动控制台应用程序或 GUI 应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T18:40:28.890

听起来您想要的是作为控制台应用程序或基于命令行开关的 Windows 应用程序运行。

如果您查看[此线程](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/fd89cf64-eab4-4cc5-8f35-74ec848d8a60)中的最后一条消息，Jeffrey Knight 发布了代码来执行您的要求。

但是，请注意，许多“混合”应用程序实际上提供了两个不同的可执行文件（查看 Visual Studio-devenv.exe 是 gui，devenv.com 是控制台）。使用“混合”方法有时会导致难以追踪问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:33:13.260

转到您的主要方法（Program.cs）。您将把逻辑放在那里，并确定要做什么，并有条件地执行 Application.Run()

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-08T14:04:33.060

我认为菲利普是对的。尽管我一直在广泛部署的商业应用程序中使用“混合”方法而没有问题。我开始使用的“混合”代码确实存在一些问题，所以我最终修复了它们并重新发布了解决方案。

因此，请随意利用它。它实际上很容易使用。[混合系统](http://code.google.com/p/dualsubsystem/ "双子系统")基于google 代码并更新了该技术的旧 codeguru 解决方案，并提供源代码和工作示例二进制文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:10:31.410

将 GUI 输出写入控制台应用程序在加载时检查的文件。这样，您的控制台应用程序可以在一个计划操作中执行修复操作和正常操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-16T00:26:59.547

一种解决方案是让控制台应用程序为 GUI 应用程序编写配置文件（WinForms 是最简单的）。

我喜欢 Hybrid 方法，命令行开关似乎是绒毛的。

让两个应用程序使用相同的引擎来实现通用功能可能会更简单。考虑它的方式是控制台应用程序是供计算机使用的，而 GUI 应用程序是供人类使用的。由于 CLI 应用程序将首先执行，因此它可以通过配置文件将其数据传递给 GUI 应用程序。

另一个好处是处理引擎的接口会更简洁，因此将来更容易维护。

这将是最简单的，因为配置文件机制很容易获得，您不必编写一堆格式化和解析例程。

如果您不想使用 Config 机制，您可以直接将 JSON 或 XML 序列化写入文件以轻松传输数据

# java - 如何强制 Java 子类定义注解？

> ID：95389
> 
> 赞同：11
> 
> 时间：2008-09-18T18:32:40.750
> 
> 标签：java, annotations, subclass

如果一个类定义了一个注解，是否可以强制其子类定义相同的注解？

例如，我们有一个简单的类/子类对，它们共享`@Author @interface.` 我想要做的是强制每个进一步的子类定义相同的`@Author`注释，防止在`RuntimeException`某个地方出现。

测试类.java：

```
import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
@interface Author { String name(); }

@Author( name = "foo" )
public abstract class TestClass
{
    public static String getInfo( Class<? extends TestClass> c )
    {
        return c.getAnnotation( Author.class ).name();
    }

    public static void main( String[] args )
    {
        System.out.println( "The test class was written by "
                        + getInfo( TestClass.class ) );
        System.out.println( "The test subclass was written by " 
                        + getInfo( TestSubClass.class ) );
    }
} 
```

测试子类.java：

```
@Author( name = "bar" )
public abstract class TestSubClass extends TestClass {} 
```

我知道我可以在运行时枚举所有注释并检查缺失的`@Author`，但如果可能的话，我真的很想在编译时这样做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T21:09:26.390

您可以在编译时使用 JSR 269 做到这一点。请参阅：[http ://today.java.net/pub/a/today/2006/06/29/validate-java-ee-annotations-with-annotation-processors.html#pluggable-annotation-processing-api](http://today.java.net/pub/a/today/2006/06/29/validate-java-ee-annotations-with-annotation-processors.html#pluggable-annotation-processing-api)

编辑 2020-09-20：链接已失效，此处存档版本：[https ://web.archive.org/web/20150516080739/http://today.java.net/pub/a/today/2006/06/29 /validate-java-ee-annotations-with-annotation-processors.html](https://web.archive.org/web/20150516080739/http://today.java.net/pub/a/today/2006/06/29/validate-java-ee-annotations-with-annotation-processors.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T18:38:53.433

我很确定这在编译时是不可能做到的。

但是，对于“单元”测试来说，这是一项显而易见的任务。如果你有这样的约定，你想强制执行，但是很难或不可能用编译器检查，“单元”测试是检查它们的简单方法。

另一种可能性是在静态分析器中实现自定义规则。这里也有很多选择。

（我把单元放在引号中，因为这实际上是对约定的测试，而不是对特定单元的测试。但它应该与您的单元测试一起运行）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T18:42:15.157

您可以在超类上使用@Inherited 创建一个注释（例如@EnforceAuthor），并使用编译器注释（从Java 1.6 开始）在编译时赶上。然后你有一个对子类的引用，并且可以检查是否缺少另一个注释（例如@Author）。这将允许取消编译并显示错误消息。

# java - 在 Java 中创建对象的所有不同方法是什么？

> ID：95419
> 
> 赞同：183
> 
> 时间：2008-09-18T18:35:16.937
> 
> 标签：java

前几天和同事讨论过这个问题。

使用构造函数很明显，但是还有其他方法吗？

* * *

## 回答 #1

> 赞同：291
> 
> 时间：2011-02-24T12:26:43.660

在java中创建对象有四种不同的方法：

**一个**。使用`new`关键字
这是在 java 中创建对象的最常用方法。几乎 99% 的对象都是以这种方式创建的。

```
 MyObject object = new MyObject(); 
```

**乙**。使用`Class.forName()`
如果我们知道类的名称并且如果它有一个公共的默认构造函数，我们可以通过这种方式创建一个对象。

```
MyObject object = (MyObject) Class.forName("subin.rnd.MyObject").newInstance(); 
```

**C.** _ 使用`clone()`
clone() 可用于创建现有对象的副本。

```
MyObject anotherObject = new MyObject();
MyObject object = (MyObject) anotherObject.clone(); 
```

**D.** _ 使用`object deserialization`
对象反序列化只不过是从其序列化形式创建一个对象。

```
ObjectInputStream inStream = new ObjectInputStream(anInputStream );
MyObject object = (MyObject) inStream.readObject(); 
```

您可以从[这里](http://javabeanz.wordpress.com/2007/09/13/different-ways-to-create-objects/)阅读它们。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2010-01-20T17:44:48.640

有多种方式：

*   通过`Class.newInstance`.
*   通过`Constructor.newInstance`.
*   通过反序列化（使用最派生的不可序列化基类的无参数构造函数）。
*   通过`Object.clone`（**不调用构造函数**）。
*   通过 JNI（应该调用构造函数）。
*   通过任何其他为您调用 a 的方法`new`。
*   我想您可以将类加载描述为创建新对象（例如 interned `String`）。
*   作为声明中初始化的一部分的文字数组（没有数组的构造函数）。
*   “varargs”( `...`) 方法调用中的数组（没有数组的构造函数）。
*   非编译时常量字符串连接（在典型实现中发生至少四个对象）。
*   导致运行时创建和抛出异常。例如`throw null;`或`"".toCharArray()[0]`。
*   哦，当然还有原语装箱（除非缓存）。
*   JDK8 应该有 lambdas（本质上是简洁的匿名内部类），它们被隐式转换为对象。
*   为了完整性（和 Paŭlo Ebermann），`new`关键字也有一些语法。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-18T19:01:35.440

在 Java 语言中，创建对象的唯一方法是调用其构造函数，无论是显式的还是隐式的。使用反射导致调用构造函数方法，反序列化使用反射调用构造函数，工厂方法包装对构造函数的调用以抽象实际构造，克隆同样是包装的构造函数调用。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-01-20T16:40:00.003

是的，您可以使用反射创建对象。例如，`String.class.newInstance()`会给你一个新的空字符串对象。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-11-19T05:55:29.760

在 Java 中创建对象有五种不同的方法，

**1.使用`new`关键字**→构造函数被调用

```
Employee emp1 = new Employee(); 
```

**2.使用`newInstance()``Class`**→构造函数**的方法被调用**

```
Employee emp2 = (Employee) Class.forName("org.programming.mitra.exercises.Employee")
                                .newInstance(); 
```

它也可以写成

```
Employee emp2 = Employee.class.newInstance(); 
```

**3.使用`newInstance()``Constructor`**→构造函数**的方法被调用**

```
Constructor<Employee> constructor = Employee.class.getConstructor();
Employee emp3 = constructor.newInstance(); 
```

**4.使用`clone()`方法** →无构造函数调用

```
Employee emp4 = (Employee) emp3.clone(); 
```

**5.使用反序列化** →没有构造函数调用

```
ObjectInputStream in = new ObjectInputStream(new FileInputStream("data.obj"));
Employee emp5 = (Employee) in.readObject(); 
```

前三个方法`new`关键字都`newInstance()`包含一个构造函数调用，但后面的两个克隆和反序列化方法在不调用构造函数的情况下创建对象。

所有上述方法都有不同的字节码与之相关联，阅读[不同的方式在 Java 中创建对象](https://programmingmitra.com/2016/05/different-ways-to-create-objects-in-java-with-example.html)的示例和更详细的描述，例如所有这些方法的字节码转换。

然而，有人可能会争辩说，创建数组或字符串对象也是一种创建对象的方式，但这些东西更特定于某些类并由 JVM 直接处理，而我们可以使用这 5 种方式创建任何类的对象。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-18T18:35:52.163

[克隆](http://en.wikipedia.org/wiki/Clone_(Java_method))和[反序列化](http://exampledepot.com/egs/java.io/DeserializeObj.html)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-01-20T16:41:47.457

你也可以使用

```
 Object myObj = Class.forName("your.cClass").newInstance(); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-01-20T16:44:36.763

如果您是 java 新手，请注意这一点，每个对象都继承自 Object

受保护的本机对象 clone() 抛出 CloneNotSupportedException；

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-01-20T17:03:35.847

此外，您可以将数据**反序列**化为对象。这不通过类 Constructor ！

* * *

**更新**：感谢汤姆在您的评论中指出这一点！迈克尔也进行了实验。

> 它通过最派生的不可序列化超类的构造函数。
> 当该类没有无参数构造函数时，反序列化时会抛出 InvalidClassException。

请参阅汤姆的回答以了解所有情况的完整处理；-)
[是否有任何其他方法可以在不使用 java 中的“new”关键字的情况下创建对象](https://stackoverflow.com/questions/2103089/is-there-any-other-way-of-creating-an-object-without-using-new-keyword-in-java/2103578#2103578)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2011-02-24T12:52:25.560

有一种对象，不能通过普通的实例创建机制（调用构造函数）来构造：**数组**。数组是用

```
 A[] array = new A[len]; 
```

或者

```
 A[] array = new A[] { value0, value1, value2 }; 
```

正如 Sean 在评论中所说，这在语法上类似于构造函数调用，在内部它只不过是分配和零初始化（或在第二种情况下使用显式内容初始化）内存块，并带有一些标头来指示类型和长度。

将参数传递给可变参数方法时，也会隐式创建（并填充）数组。

第四种方法是

```
 A[] array = (A[]) Array.newInstance(A.class, len); 
```

当然，克隆和反序列化也适用于此。

标准 API 中有许多创建数组的方法，但实际上它们都使用其中一种（或多种）方法。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-02-24T14:10:48.597

如果我们详尽无遗，还有其他方法。

*   在 Oracle JVM 上是 Unsafe.allocateInstance() ，它在不调用构造函数的情况下创建实例。
*   使用字节码操作，您可以将代码添加到`anewarray`、或. 这些可以使用 ASM 或 BCEL 等库添加。Oracle 的 Java 附带了一个 bcel 版本。同样，这不会调用构造函数，但您可以将构造函数作为单独的调用来调用。`multianewarray``newarray``new`

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-18T18:37:19.397

反射：

```
someClass.newInstance(); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-01-20T16:44:13.443

反射也将为您完成这项工作。

```
SomeClass anObj = SomeClass.class.newInstance(); 
```

是另一种创建类的新实例的方法。在这种情况下，您还需要处理可能引发的异常。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-02-24T12:23:26.173

*   使用`new`运算符（因此调用构造函数）
*   使用反射`clazz.newInstance()`（再次调用构造函数）。或者通过`clazz.getConstructor(..).newInstance(..)`（再次使用构造函数，但您可以选择哪一个）

总结答案 - 一种主要方式 - 通过调用对象类的构造函数。

更新：另一个答案列出了两种不涉及使用构造函数的方法——反序列化​​和克隆。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-05-14T07:35:03.133

在 Java 中创建对象有五种不同的方法：

### 1.使用`new`关键字：

这是在 Java 中创建对象的最常用方法。几乎 99% 的对象都是以这种方式创建的。

```
MyObject object = new MyObject();//normal way 
```

### 2.通过使用工厂方法：

```
ClassName ObgRef=ClassName.FactoryMethod(); 
```

*例子：*

```
RunTime rt=Runtime.getRunTime();//Static Factory Method 
```

### 3\. 通过使用克隆概念：

通过使用`clone()`，`clone()`可用于创建现有对象的副本。

```
MyObjectName anotherObject = new MyObjectName();
MyObjectName object = anotherObjectName.clone();//cloning Object 
```

### 4\. 使用`Class.forName()`：

如果我们知道类的名称并且如果它有一个公共的默认构造函数，我们可以通过这种方式创建一个对象。

```
MyObjectName object = (MyObjectNmae) Class.forName("PackageName.ClassName").newInstance(); 
```

*例子：*

```
String st=(String)Class.forName("java.lang.String").newInstance(); 
```

### 5.使用对象反序列化：

对象反序列化只不过是从其序列化形式创建一个对象。

```
ObjectInputStreamName inStream = new ObjectInputStreamName(anInputStream );
MyObjectName object = (MyObjectNmae) inStream.readObject(); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-01-20T17:08:27.540

您还可以克隆现有对象（如果它实现了 Cloneable）。

```
Foo fooClone = fooOriginal.clone (); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-07-09T09:28:11.947

方法一

使用新关键字。这是在java中创建对象的最常用方法。几乎 99% 的对象都是以这种方式创建的。

```
Employee object = new Employee(); 
```

方法二

使用 Class.forName()。Class.forName() 为您提供类对象，这对反射很有用。该对象具有的方法是由 Java 定义的，而不是由编写类的程序员定义的。它们对于每个班级都是一样的。调用 newInstance() 会为您提供该类的实例（即，callingClass.forName("ExampleClass").newInstance() 相当于调用 new ExampleClass()），您可以在其上调用该类定义的方法，访问可见字段等。

```
Employee object2 = (Employee) Class.forName(NewEmployee).newInstance(); 
```

Class.forName() 将始终使用调用者的 ClassLoader，而 ClassLoader.loadClass() 可以指定不同的 ClassLoader。我相信 Class.forName 也会初始化加载的类，而 ClassLoader.loadClass() 方法不会立即执行此操作（直到第一次使用它才初始化）。

另一个必须阅读：

Java：带有示例的线程状态介绍简单的Java枚举示例

方法三

使用克隆（）。clone() 可用于创建现有对象的副本。

```
Employee secondObject = new Employee();
Employee object3 = (Employee) secondObject.clone(); 
```

方法四

使用 newInstance() 方法

```
Object object4 = Employee.class.getClassLoader().loadClass(NewEmployee).newInstance(); 
```

方法五

使用对象反序列化。对象反序列化只不过是从其序列化形式创建一个对象。

```
// Create Object5
// create a new file with an ObjectOutputStream
FileOutputStream out = new FileOutputStream("");
ObjectOutputStream oout = new ObjectOutputStream(out);

// write something in the file
oout.writeObject(object3);
oout.flush();

// create an ObjectInputStream for the file we created before
ObjectInputStream ois = new ObjectInputStream(new FileInputStream("crunchify.txt"));
Employee object5 = (Employee) ois.readObject(); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-18T20:10:37.740

从 API 用户的角度来看，构造函数的另一种替代方法是静态工厂方法（如 BigInteger.valueOf()），尽管对于 API 作者（并且在技术上是“真实的”），对象仍然是使用构造函数创建的。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-09-18T18:40:20.200

完全取决于您创建的意思，但其他一些是：

*   克隆方法
*   反序列化
*   反射 (Class.newInstance())
*   反射（构造函数对象）

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-09-18T20:20:11.100

还有 ClassLoader.loadClass(string) 但这并不经常使用。

如果你想成为一个完整的律师，由于数组的 .length 属性，数组在*技术上是对象。*所以初始化一个数组会创建一个对象。

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2011-08-26T13:26:55.340

我们可以通过 5 种方式创建对象：

1.  由新运营商
2.  通过反射（例如 Class.forName() 后跟 Class.newInstance()）
3.  通过工厂方法
4.  通过克隆
5.  通过反射api

* * *

## 回答 #22

> 赞同：-5
> 
> 时间：2014-06-24T06:39:12.517

我们也可以这样创建对象：-

```
String s ="Hello"; 
```

没有人讨论它。

# unit-testing - .NET 中的单元测试：如何模拟实体数据提供者

> ID：95426
> 
> 赞同：4
> 
> 时间：2008-09-18T18:35:41.273
> 
> 标签：unit-testing, entity-framework, mocking

有谁知道是否有办法模拟实体数据提供者，以便单元测试不会影响实时数据？我找到了这个博客，但似乎该项目尚未发布：

[http://www.chrisdoesdev.com/index.php/archives/62](http://www.chrisdoesdev.com/index.php/archives/62)

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T18:41:41.073

Mattwar[在他的博客上](http://blogs.msdn.com/mattwar/archive/2008/05/04/mocks-nix-an-extensible-linq-to-sql-datacontext.aspx)有一篇关于使用反射模拟 LinqtoSql 的精彩文章——也许您可以以此为起点？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T18:38:24.573

我自己有兴趣知道这一点。我不认为这是可能的，因为让 Agile/Alt.Net 社区对实体框架感到困惑的一件事就是缺乏持久性无知的问题。

# windows - 如何在 Windows XP 的命令行中打开“查找文件”对话框来搜索特定文件夹？

> ID：95432
> 
> 赞同：4
> 
> 时间：2008-09-18T18:36:15.517
> 
> 标签：windows, windows-xp

我想创建一个热键来搜索Windows XP 中**特定文件夹下的文件；**我正在使用 AutoHotkey 创建此快捷方式。

问题是我需要知道要运行的命令行语句才能打开标准的 Windows“查找文件/文件夹”对话框。我已经用谷歌搜索了一段时间，但没有找到任何说明如何执行此操作的页面。

我假设如果我知道用于显示此提示的命令行语句，它将允许我为要在哪个文件夹下搜索的参数传递一个参数。我知道您可以通过右键单击 XP 中的文件夹来执行此操作，所以我认为有某种方法可以在命令行上执行此操作...？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T18:47:39.933

## 使用[Locate32](http://www.locate32.net/)

这不是您问题的确切答案，但您可以使用[**Locate32**](http://www.locate32.net/)而不是 Windows 搜索工具。它具有一整套命令行选项，并且具有作为索引搜索的巨大优势，这意味着结果将立即显示。这是我在 Windows 上不能没有的工具。

这是您将发出的搜索所有`index.php`文件的命令`D:\home`：

```
locate32.exe -r -p D:\home index.php 
```

其中`-r`开关使 Locate32 立即搜索而无需用户干预（没有它，界面将启动并填充字段，但您必须按 Enter 继续搜索）并且`-p D:\home`是搜索路径。

使用 AutoHotKey，将上述命令分配给键盘快捷键很简单。

在同一个名为`locate.exe`. 它使用与 Locate32 相同的索引，但由于它完全基于 CLI，因此脚本语言和其他工具可以使用它来利用它提供的出色搜索性能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T20:00:43.863

F3 或 Win+F 是启动查找文件的热键。如果您随后使用所需的条件进行搜索，则可以使用“文件”菜单保存搜索。这将创建一个 .FND 文件。FND 文件可以从命令行或使用 autohotkey 创建的热键启动。

可以编辑 .FND 文件（二进制）并更改它正在搜索的内容，但我会避免这样做，除非这是您完成所需内容的唯一方法。我试过了，效果很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T18:52:11.780

无法从命令行让资源管理器显示“搜索文件”窗格。但是你可以用一些 VBScript 来克服它。

试试这个

```
'ExplorerFind.vbs
Dim objShell
Set objShell = WScript.CreateObject("Shell.Application")
objShell.FindFiles 
```

并用 cscript /nologo ExplorerFind.vbs 编译它

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T18:52:14.777

来自[http://www.pcreview.co.uk/forums/thread-1468270.php](http://www.pcreview.co.uk/forums/thread-1468270.php)

```
@echo off
echo CreateObject("Shell.Application").FindFiles >%temp%\myff.vbs
cscript.exe //Nologo %temp%\myff.vbs
del %temp%\myff.vbs 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-09-22T05:31:36.217

只需执行这一行！（WinKey+R、CmdPrompt、快捷方式、ShellExecute、WinExec 等）

```
search-ms:query=New%20Folder& 
```

查找桌面中的所有快捷方式

```
search-ms:query=*.lnk&crumb=folder:%userprofile%\Desktop& 
```

在文件夹“C:\Program Files”中找到文本“exe”

```
search-ms:query=exe&crumb=location:C:\Program Files& 
```

其他例子

```
search-ms:query=microsoft&
search-ms:query=vacation&subquery=mydepartment.search-ms&
search-ms:query=seattle&crumb=kind:pics& 
search-ms:query=seattle&crumb=folder:C:\MyFolder& 
```

参考这里[http://msdn.microsoft.com/en-us/library/ff684385.aspx](http://msdn.microsoft.com/en-us/library/ff684385.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T18:40:27.813

尝试“启动”。对于windows和linux。很棒的实用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T18:40:42.963

如果您只需要一个热键，请使用`Win+f`.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T18:54:26.097

有点不清楚您想要的最终结果是打开“查找”对话框，还是只是在寻找一种命令行方式来搜索任意目录。如果后者有 FINDSTR （假设您要搜索文件的内容而不是它们的名称）：

[什么是适用于 Windows 的好 grep 工具？](https://stackoverflow.com/questions/87350/what-are-good-grep-tool-for-windows#87394)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-05T16:16:19.337

除了 Ben Dunlap 的回答：您还可以在 DIR 命令的输出上使用 FINDSTR（例如在 FOR 循环中）这将搜索文件名，而不是文件。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-15T20:59:38.477

根据 Vitim.us 从 cmd 的回答，您只需要根据需要 `explorer.exe "search-ms:query=*.exe&crumb=location:C:\Program Files&"` 更改位置和查询

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-18T18:37:24.047

你为什么不尝试抨击F3？:)

# apache-flex - 嗅探 Flex 应用程序和 ColdFusion 后端之间的流量

> ID：95442
> 
> 赞同：7
> 
> 时间：2008-09-18T18:36:52.660
> 
> 标签：apache-flex, debugging, coldfusion, amf, sniffing

在 Flex 应用程序和在 ColdFusion 服务器上运行的基于 ColdFusion 的后端之间嗅探/跟踪函数调用的好策略是什么？我了解他们使用 AMF 协议。

我习惯于使用[Fiddler](http://www.fiddlertool.com/fiddler/)来嗅探 HTTP 客户端和服务器之间的事务，只要您使用纯文本或 XML HTTP 请求和响应（包括通过 SSL 的请求和响应），它就可以很好地工作，但它对二进制文件没有多大帮助AMF over HTTP 等协议。

就我而言，我**确实**可以访问客户端和服务器的源代码，但我正在寻找一种简单的方法来在任何 Flex + ColdFusion 情况下被动地嗅探流量，而无需在服务器上进行任何调整。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-18T18:39:25.447

Wireshark：嗅探将互联网连接在一起的胶水

[http://www.wireshark.org/](http://www.wireshark.org/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-18T23:48:59.303

[http://www.charlesproxy.com/](http://www.charlesproxy.com/)

虽然不是免费的，但它会解码 AMF 二进制数据并允许跟踪 SSL 连接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T19:16:09.960

ServiceCapture 是另一种选择。如果我没记错的话，它会为你解码二进制 AMF。

[http://kevinlangdon.com/serviceCapture/](http://kevinlangdon.com/serviceCapture/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-04T15:47:14.597

简单而穷人的把戏。创建一个 cfc 以根据需要记录对不同 cfc 和页面的调用。把它全部倒在一张桌子上。随意筛选和排序。我过去做过这个，效果很好。这就像在您想知道的任何地方放置小鱼钩。这可能会为您提供与应用程序最相关的数据。如果你需要一个例子让我知道。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-04T13:33:12.287

带有 Flashbug 插件的 Firebug 将显示所有来自 Flash 应用程序的解码 AMF 消息。也适用于 HTTPS。

[https://addons.mozilla.org/en-us/firefox/addon/amf-explorer/](https://addons.mozilla.org/en-us/firefox/addon/amf-explorer/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T19:11:41.077

同样适用于wireshark（以前称为Ethereal的艺术家）。您可以嗅探每个协议层，并将流量拼接在一起。

# sql - 在 SQL 中存储任意（可能标记的）文本的规范方法是什么？

> ID：95459
> 
> 赞同：3
> 
> 时间：2008-09-18T18:38:14.153
> 
> 标签：sql, text

wikis/stackoverflow/等做什么。在存储文本时该怎么做？文本是否在换行符处断开？它被分成固定长度的块吗？你如何最好地存储任意长的文本块？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-18T18:40:00.170

nvarchar(max) ftw。因为把简单的事情复杂化是不好的，嗯？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T18:42:25.283

我想如果你需要提供存储大块文本的能力，并且你不介意在查询时不能过多地查看它们的内容，你可以使用 CLobs。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T18:43:33.203

这一切都取决于您使用的 RDBMS 以及您要存储的文本类型。如果文本被格式化成相当大的数据块，这些数据本身就意味着某些东西，比如标题/正文，那么您可能希望将数据分解为这些类型的列。根据您正在处理的内容，可能需要多个表才能使用此方法。

我不知道其他 RDBMS 是如何处理它的，但我知道在每个表中拥有多个开放式列（文本或 varchar(max)）并不是一个好主意。因此，您需要确保只有一列具有无限字符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T13:13:01.313

Regarding PostgreSQL - use type [TEXT](http://www.postgresql.org/docs/current/static/datatype-character.html) or [BYTEA](http://www.postgresql.org/docs/current/static/datatype-binary.html). If you need to read random chunks you may consider [large objects](http://www.postgresql.org/docs/current/static/largeobjects.html).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:45:02.797

如果您需要担心在文本中保留诸如格式化字符串、引号和其他“杂乱无章”之类的内容，就像代码可能那样，那么特殊字符需要首先完全转义 - 否则在提交数据库时，它们可能会结束导致发出无效命令。

大多数脚本语言都有本机内置的工具来执行此操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T18:45:04.807

我怀疑 StackOverflow 在任意大小的“文本”列中以降价格式存储文本。也许是 UTF8（但它可能是 UTF16 或其他东西。我猜它是 SQL Server，我不太了解）。

作为一般规则，您希望以可能的“最原始”形式将内容存储在数据库中。也就是说，进行所有解码，并可能进行清理，但不要对它做任何其他事情（例如，如果它是 Markdown，不要将其编码为 HTML，将其保留为原始的“原始”格式）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T18:49:01.507

我想这取决于您要存储文本的位置，是否需要交易等内容。

像 SQL Server 这样的数据库有一种可以存储长文本字段的类型。在 SQL Server 2005 中，这主要是用于长 unicode 文本字符串的 nvarchar(max)。通过使用数据库，您可以从事务和简单的备份/恢复中受益，假设您将数据库用于 StackOverflow.com 等其他事情。

另一种方法是将文本存储在磁盘上的文件中。这可能实现起来相当简单，并且可以在数据库不可用或过度杀伤的环境中工作。

关于存储在数据库或文件中的文本格式，它可能与输入非常接近。如果它是 HTML，那么您只需通过一个可以正确转义它的函数来推动它。

需要记住的是，您可能希望从创建到存储都使用 unicode 或 UTF-8，反之亦然。这将允许您支持其他语言。这种编码机制的任何问题都会破坏您的文本。从历史上看，人们可能会基于他们节省磁盘空间等的假设默认使用 ASCII。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T19:42:04.470

对于 SQL Server：

使用 varchar(max) 进行存储。我认为上限是 2 GB。

Don't try to escape the text yourself. Pass the text through a parameterizing structure that will do the escapes properly for you. In .Net you'd add a parameter to a SqlCommand, or just use LinqToSQL (which then manages the SqlCommand for you).

# java - 串行硬件设备的消息传递解决方案

> ID：95485
> 
> 赞同：1
> 
> 时间：2008-09-18T18:39:38.033
> 
> 标签：java, hardware, messaging, xmpp

我有一个串行硬件设备，我想与多个应用程序共享，它可能驻留在多个网络内或跨越多个网络的不同机器上。一个关键要求是系统必须支持双向通信，以便客户端/串行设备可以存在于防火墙后面和/或不同的网络上，并且仍然通过中央服务器相互通信（发送和接收）。系统的另一个要求是客户端必须能够确定网关/串行设备是否离线/在线。

该串行设备能够接收和发送数据包到无线网络。与串行设备通信的软件是用 Java 编写的，如果可能的话，我希望它保持 100% Java 解决方案。

我目前正在研究 XMPP，使用 Jive 软件的 Openfire 服务器和 Smack API。使用此解决方案，来自串行设备的数据包通过 XMPP 传递给客户端。类似地，任何客户端应用程序都可以通过 Smack API 向串行设备发送数据包。数据包只是字节数组，大小限制在 100 字节左右，因此可以将它们转换为十六进制字符串并作为消息正文中的文本发送。系统应该容忍客户端/串口设备离线，这意味着当它们再次可用时它们会自动重新连接，但如果客户端离线，数据包将被丢弃。数据包必须近乎实时地发送和接收，因此不希望离线传递。安全性应由消息传递系统和提供的客户端 API 提供。

我想听听其他可能的解决方案。我想过使用 JMS，但它似乎有点过于重量级，我不确定它是否支持了解客户端和/或网关/串行设备是否离线的要求。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T15:45:09.997

你真的需要提供更多细节......客户需要保证交货吗？线下配送呢？这是更大系统的一部分吗？你需要加密吗？安全？

如果你想要尽可能少的占用空间，那么应该使用 SocketServer、Sockets 和序列化来传输数据。但是，您将失去您提到的第 3 方解决方案的所有优势，通常包括可靠性、交付保证、安全性、管理等。

我个人会使用 JMS，但那是因为我熟悉它。有许多独立服务器可以开箱即用地部署，几乎无需配置。它们都提供有保证的交付、一些安全性、加密和许多其他易于使用的功能。编写 JMS 发布者或订阅者非常容易。

* * *

更新：如果您想要最轻松的编码，那么我会考虑第三方解决方案。查看 Smack/XMPP，对于您要求的功能，API 似乎比 JMS 更容易一些。您仍然必须设置/配置服务器等。

Smack API 也有很多你也不需要的额外包袱，但它的“概念”更直观一点，因为它都是聊天/IM 概念。

我仍然会看[OpenJMS](http://openjms.sourceforge.net/index.html)或[ActiveMQ](http://activemq.apache.org/)。我认为与了解 XMPP 相比，了解 JMS 在未来会更有价值。查看他们的[入门](http://openjms.sourceforge.net/usersguide/using.html)文档或[Sun 教程](http://java.sun.com/products/jms/tutorial/)，了解其中涉及多少编码。用 JMS 的说法，您将需要一个受管理的“主题”和一个“队列”，串行端口应用程序将分别在其中接收和发送消息。您的所有客户都将打开对该主题的订阅并将其出站消息发送到队列。当您发送消息时，它们的传递模式应该是非持久的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T10:25:15.703

Jini 可能适合这份工作。它在多播可用的分布式环境中工作得非常好，但它也可以在单播中工作，而且速度非常快。它不仅提供远程服务，还提供远程事件和分布式事务（如果需要）。缺点是它仅适用于 Java。

在我工作的地方，Jini 用于拥有 1000 多台机器的基础架构中，每台机器都提供远程服务，用于访问连接到机器串行端口的设备。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T19:36:28.287

我最终通过 Smack API 使用了 XMPP。导致我做出这个决定的原因是它对状态的原生支持（客户端在线/离线）和强大的连接处理（如果底层连接中断，它会自动重新连接）。XMPP 的另一个好处是它与 Google Talk 兼容，所以我不需要设置服务器。感谢您的建议。如果有人感兴趣，我已经在 Google Code [http://code.google.com/p/xbee-xmpp/上发布了代码](http://code.google.com/p/xbee-xmpp/)

# perl - 如何在 Perl 中将日期/时间转换为纪元时间（自 1970 年以来的 unix 时间/秒）？

> ID：95492
> 
> 赞同：50
> 
> 时间：2008-09-18T18:40:08.970
> 
> 标签：perl, datetime, parsing, date, time

给定日期/时间作为（年、月、日、小时、分钟、秒）的数组，您如何将其转换为纪元时间，即自 1970-01-01 00:00:00 GMT 以来的秒数?

额外问题：如果将日期/时间作为字符串给出，您将如何首先将其解析为 (y,m,d,h,m,s) 数组？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-18T18:49:25.780

如果您使用的是[DateTime](https://metacpan.org/pod/DateTime)模块，则可以在 DateTime 对象上调用[epoch()](https://metacpan.org/pod/DateTime#METHODS)方法，因为这就是您认为的 unix 时间。

使用 DateTimes 可以很容易地从 epoch 转换为 date 对象。

或者，[localtime](http://perldoc.perl.org/functions/localtime.html)和 gmtime 会将 epoch 转换为包含日期、月份和年份的数组，而来自[Time::Local 模块](https://metacpan.org/pod/Time::Local)的 timelocal 和 timegm将执行相反的操作，转换时间元素数组（秒、分钟、...、天, 月等) 进入一个时代。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-18T18:43:36.777

这是获取 unix 时间的最简单方法：

```
use Time::Local;
timelocal($second,$minute,$hour,$day,$month-1,$year); 
```

请注意参数的相反顺序，一月是第 0 个月。有关更多选项，请参阅 CPAN 的[DateTime](https://metacpan.org/pod/DateTime)模块。

至于解析，请参阅 CPAN 的[Date::Parse](https://metacpan.org/pod/Date::Parse)模块。如果您真的需要花时间解析日期，[Date::Manip](https://metacpan.org/pod/Date::Manip)可能会有所帮助，尽管它自己的文档会警告您远离它，因为它携带了很多包袱（例如，它知道常见的商务假期之类的事情）和其他解决方案要快得多。

如果您碰巧知道要解析的日期/时间的格式，那么一个简单的正则表达式可能就足够了，但您最好使用适当的 CPAN 模块。例如，如果您知道日期将始终按 YMDHMS 顺序排列，请使用 CPAN 模块[DateTime::Format::ISO8601](https://metacpan.org/pod/DateTime::Format::ISO8601)。

* * *

作为我自己的参考，如果没有别的，下面是我用于应用程序的函数，我知道日期将始终按 YMDHMS 顺序排列，全部或部分“HMS”部分是可选的。它接受任何分隔符（例如，“2009-02-15”或“2009.02.15”）。它返回相应的 unix 时间（自 1970-01-01 00:00:00 GMT 以来的秒数）或 -1 如果它无法解析它（这意味着你最好确保你永远不会合法地需要解析日期 1969- 12-31 23:59:59)。它还假定两位数的年份 XX 到“69”指的是“20XX”，否则“19XX”（例如，“50-02-15”表示 2050-02-15 但“75-02-15”表示 1975- 02-15）。

```
use Time::Local;

sub parsedate { 
  my($s) = @_;
  my($year, $month, $day, $hour, $minute, $second);

  if($s =~ m{^\s*(\d{1,4})\W*0*(\d{1,2})\W*0*(\d{1,2})\W*0*
                 (\d{0,2})\W*0*(\d{0,2})\W*0*(\d{0,2})}x) {
    $year = $1;  $month = $2;   $day = $3;
    $hour = $4;  $minute = $5;  $second = $6;
    $hour |= 0;  $minute |= 0;  $second |= 0;  # defaults.
    $year = ($year<100 ? ($year<70 ? 2000+$year : 1900+$year) : $year);
    return timelocal($second,$minute,$hour,$day,$month-1,$year);  
  }
  return -1;
} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-18T18:53:34.163

要解析日期，请查看 CPAN 中的[Date::Parse](https://metacpan.org/pod/Date::Parse)。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-02-12T17:42:27.023

我知道这是一个老问题，但我想我会提供另一个答案。

[`Time::Piece`](https://metacpan.org/pod/Time::Piece)是 Perl 5.9.5 的核心

`strptime`这允许通过该方法以任意格式解析时间。

例如：

```
my $t = Time::Piece->strptime("Sunday 3rd Nov, 1943",
                              "%A %drd %b, %Y"); 
```

有用的部分是 - 因为它是一个重载对象，您可以将它用于数值比较。

例如

```
if ( $t < time() ) { #do something } 
```

或者，如果您在字符串上下文中访问它：

```
print $t,"\n"; 
```

你得到：

```
Wed Nov  3 00:00:00 1943 
```

有一堆访问器方法允许进行一些其他有用的基于时间的转换。[https://metacpan.org/pod/Time::Piece](https://metacpan.org/pod/Time::Piece)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-24T07:39:21.183

```
$ENV{TZ}="GMT";
POSIX::tzset();
$time = POSIX::mktime($s,$m,$h,$d,$mo-1,$y-1900); 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-18T19:09:58.493

[从 CPAN 获取 Date::Manip](http://metacpan.org/pod/Date::Manip)，然后：

```
use Date::Manip;
$string = '18-Sep-2008 20:09'; # or a wide range of other date formats
$unix_time = UnixDate( ParseDate($string), "%s" ); 
```

编辑：

Date::Manip 又大又慢，但解析非常灵活，而且是纯 perl。如果您在编写代码时很着急，请使用它，并且您知道在运行它时您不会着急。

例如，在启动时使用它来解析命令行选项，但不要在繁忙的 Web 服务器上使用它来解析大量数据。

见[作者评论](https://metacpan.org/pod/Date::Manip::Misc#SHOULD-I-USE-DATE::MANIP)。

（感谢下面第一条评论的作者）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-18T19:07:18.467

我最喜欢的日期时间解析器是[DateTime::Format::ISO8601](http://search.cpan.org/perldoc?DateTime::Format::ISO8601) 一旦你得到它的工作，你就会有一个 DateTime 对象，很容易用 epoch() 转换为纪元秒

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-18T20:25:23.413

无论有没有 CPAN 的帮助，这可能是“有不止一种方法”的更好例子之一。

如果您可以控制作为“日期/时间”传递的内容，我建议您使用[DateTime](https://metacpan.org/pod/DateTime)路线，或者使用特定的 Date::Time::Format 子类，或者使用 DateTime::Format::Strptime if没有一个支持您古怪的日期格式（有关详细信息，请参阅[日期时间常见问题解答）。](http://datetime.perl.org/index.cgi?FAQBasicUsage)一般来说，如果你想对结果做任何严肃的事情，Date::Time 是要走的路：CPAN 上很少有课程能像肛门保持和痴迷一样准确。

如果你期待奇怪的自由形式的东西，把它扔到[Date::Parse](http://search.cpan.org/dist/TimeDate/)的 str2time() 方法，它会给你一个 seconds-since-epoch 值，然后你可以用你邪恶的方式来处理，而没有[Date 的开销： : 操作](https://metacpan.org/pod/Date::Manip)。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-18T20:32:15.317

CPAN 上有许多日期操作模块。我特别喜欢的是[DateTime](http://search.cpan.org/dist/DateTime/)，您可以使用[strptime 模块](http://search.cpan.org/search?query=strptime&mode=all)来解析任意格式的日期。CPAN 上还有许多 DateTime::Format 模块用于处理专门的日期格式，但 strptime 是最通用的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-03-23T11:36:33.113

为了进一步参考，可以在例如`!#/bin/sh`脚本中应用的一个衬里。

```
EPOCH="`perl -e 'use Time::Local; print timelocal('${SEC}','${MIN}','${HOUR}','${DAY}','${MONTH}','${YEAR}'),\"\n\";'`" 
```

请记住避免使用八进制值！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-03-28T23:09:19.723

我正在使用一个非常旧的操作系统，我不敢在上面安装库，所以这就是我使用的；

```
%MonthMatrix=("Jan",0,"Feb",31,"Mar",59,"Apr",90,"May",120,"Jun",151,"Jul",181,"Aug",212,"Sep",243,"Oct",273,"Nov",304,"Dec",334);
$LeapYearCount=int($YearFourDigits/4);
$EpochDayNumber=$MonthMatrix{$MonthThreeLetters};
if ($LeapYearCount==($YearFourDigits/4)) { if ($EpochDayNumber<32) { $EpochDayNumber--; }}
$EpochDayNumber=($YearFourDigits-1970)*365+$LeapYearCount+$EpochDayNumber+$DayAsNumber-493;
$TimeOfDaySeconds=($HourAsNumber*3600)+($MinutesAsNumber*60)+$SecondsAsNumber;
$ActualEpochTime=($EpochDayNumber*86400)+$TimeOfDaySeconds; 
```

输入变量是；

```
$MonthThreeLetters
$DayAsNumber
$YearFourDigits
$HourAsNumber
$MinutesAsNumber
$SecondsAsNumber 
```

...这应该是不言自明的。

当然，输入变量假定为 GMT (UTC)。输出变量是“$ActualEpochTime”。（通常，我只需要 $EpochDayNumber，这就是为什么这个多余的变量可以独立存在的原因。）

我多年来一直使用这个公式，没有任何错误。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-09-18T19:01:27.750

一个过滤器将标准输入上各种 ISO 相关格式的任何日期（以及谁会在阅读Mighty Kuhn[的著作](http://www.cl.cam.ac.uk/~mgk25/iso-time.html)后使用其他任何格式？）转换为标准输出上的自时代以来的秒数时间，这可能有助于说明这两个部分：

```
martind@whitewater:~$ cat `which isoToEpoch`
#!/usr/bin/perl -w
use strict;
use Time::Piece;
# sudo apt-get install libtime-piece-perl
while (<>) {
  # date --iso=s:
  # 2007-02-15T18:25:42-0800
  # Other matched formats:
  # 2007-02-15 13:50:29 (UTC-0800)
  # 2007-02-15 13:50:29 (UTC-08:00)
  s/(\d{4}-\d{2}-\d{2}([T ])\d{2}:\d{2}:\d{2})(?:\.\d+)? ?(?:\(UTC)?([+\-]\d{2})?:?00\)?/Time::Piece->strptime ($1, "%Y-%m-%d$2%H:%M:%S")->epoch - (defined ($3) ? $3 * 3600 : 0)/eg;
  print;
}
martind@whitewater:~$ 
```

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2008-09-18T18:51:21.017

如果您只是在寻找一个命令行实用程序（即，不是从其他函数调用的东西），试试这个脚本。它假定存在 GNU 日期（几乎存在于任何 Linux 系统上）：

```
#! /usr/bin/perl -w

use strict;

$_ = (join ' ', @ARGV);
$_ ||= <STDIN>;

chomp;

if (/^[\d.]+$/) {
    print scalar localtime $_;
    print "\n";
}
else {
    exec "date -d '$_' +%s";
} 
```

以下是它的工作原理：

```
$ Time now
1221763842

$ Time yesterday
1221677444

$ Time 1221677444
Wed Sep 17 11:50:44 2008

$ Time '12:30pm jan 4 1987'
536790600

$ Time '9am 8 weeks ago'
1216915200 
```

# c++ - 这个宏可以转换成函数吗？

> ID：95500
> 
> 赞同：8
> 
> 时间：2008-09-18T18:40:34.773
> 
> 标签：c++, macros, c-preprocessor

在重构代码并摆脱所有那些我们现在被教导讨厌的#defines 时，我发现了这种用于计算结构中元素数量的美感：

```
#define STRUCTSIZE(s) (sizeof(s) / sizeof(*s)) 
```

它非常有用，但它可以转换为内联函数或模板吗？

好的，ARRAYSIZE 会是一个更好的名字，但这是遗留代码（不知道它来自哪里，它至少有 15 年的历史）所以我按“原样”粘贴它。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-18T19:15:33.423

如前所述，代码实际上计算出数组中元素的数量，而不是结构。我会在需要时明确写出 sizeof() 除法​​。如果我要让它成为一个函数，我想在它的定义中明确说明它需要一个数组。

```
template<typename T,int SIZE>
inline size_t array_size(const T (&array)[SIZE])
{
    return SIZE;
} 
```

上面类似于[xtofl's](https://stackoverflow.com/questions/95500/can-this-macro-be-converted-to-a-function#95664)，除了它防止传递指向它的指针（表示指向动态分配的数组）并错误地得到错误的答案。

**编辑**：根据[JohnMcG](https://stackoverflow.com/users/1674/johnmcg)进行简化。 **编辑**：内联。

不幸的是，上面没有提供编译时答案（即使编译器确实内联并优化它以使其成为引擎盖下的常量），因此不能用作编译时常量表达式。即它不能作为大小来声明一个静态数组。*在 C++0x 下，如果将关键字inline*替换为 constexpr（constexpr 隐式为 inline），这个问题就会*消失*。

```
constexpr size_t array_size(const T (&array)[SIZE]) 
```

[jwfearn 的](https://stackoverflow.com/questions/95500/can-this-macro-be-converted-to-a-function#97523)解决方案适用于编译时，但涉及在新名称声明中有效地“保存”数组大小的 typedef。然后通过该新名称初始化一个常量来计算数组大小。在这种情况下，也可以从一开始就简单地将数组大小保存为常量。

[Martin York](https://stackoverflow.com/questions/95500/can-this-macro-be-converted-to-a-function#98059)发布的解决方案也在编译时工作，但涉及使用非标准*typeof()*运算符。解决这个问题的方法是等待 C++0x 并使用*decltype*（到那时我们实际上不需要它来解决这个问题，因为我们会有*constexpr*）。另一种选择是使用 Boost.Typeof，在这种情况下，我们最终会得到

```
#include <boost/typeof/typeof.hpp>

template<typename T>
struct ArraySize
{
    private:    static T x;
    public:     enum { size = sizeof(T)/sizeof(*x)};
};
template<typename T>
struct ArraySize<T*> {}; 
```

并通过写作使用

```
ArraySize<BOOST_TYPEOF(foo)>::size 
```

其中*foo*是数组的名称。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-18T22:10:44.830

[KTC](https://stackoverflow.com/users/12868/ktc)的解决方案是干净的，但它不能在编译时使用，它依赖于编译器优化来防止代码膨胀和函数调用开销。

可以使用零运行时成本的仅编译时元函数计算数组大小。 [BCS](https://stackoverflow.com/users/1343/bcs)在正确的轨道上，但该解决方案是不正确的。

这是我的解决方案：

```
// asize.hpp
template < typename T >
struct asize; // no implementation for all types...

template < typename T, size_t N >
struct asize< T[N] > { // ...except arrays
    static const size_t val = N;
};

template< size_t N  >
struct count_type { char val[N]; };

template< typename T, size_t N >
count_type< N > count( const T (&)[N] ) {}

#define ASIZE( a ) ( sizeof( count( a ).val ) ) 
#define ASIZET( A ) ( asize< A >::val ) 
```

带有测试代码（使用[Boost.StaticAssert](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_staticassert.html)来演示仅编译时的用法）：

```
// asize_test.cpp
#include <boost/static_assert.hpp>
#include "asize.hpp"

#define OLD_ASIZE( a ) ( sizeof( a ) / sizeof( *a ) )

typedef char C;
typedef struct { int i; double d; } S;
typedef C A[42];
typedef S B[42];
typedef C * PA;
typedef S * PB;

int main() {
    A a; B b; PA pa; PB pb;
    BOOST_STATIC_ASSERT( ASIZET( A ) == 42 );
    BOOST_STATIC_ASSERT( ASIZET( B ) == 42 );
    BOOST_STATIC_ASSERT( ASIZET( A ) == OLD_ASIZE( a ) );
    BOOST_STATIC_ASSERT( ASIZET( B ) == OLD_ASIZE( b ) );
    BOOST_STATIC_ASSERT( ASIZE( a ) == OLD_ASIZE( a ) );
    BOOST_STATIC_ASSERT( ASIZE( b ) == OLD_ASIZE( b ) );
    BOOST_STATIC_ASSERT( OLD_ASIZE( pa ) != 42 ); // logic error: pointer accepted
    BOOST_STATIC_ASSERT( OLD_ASIZE( pb ) != 42 ); // logic error: pointer accepted
 // BOOST_STATIC_ASSERT( ASIZE( pa ) != 42 ); // compile error: pointer rejected
 // BOOST_STATIC_ASSERT( ASIZE( pb ) != 42 ); // compile error: pointer rejected
    return 0;
} 
```

此解决方案在编译时拒绝非数组类型，因此它不会像宏版本那样被指针混淆。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-19T10:06:59.380

到目前为止，当您只有一个数组的实例而不是它的类型时，没有人提出了一种可移植的方法来获取数组的大小。（typeof 和 _countof 不可移植，因此不能使用。）

我会这样做：

```
template<int n>
struct char_array_wrapper{
    char result[n];
};

template<typename T, int s>
char_array_wrapper<s> the_type_of_the_variable_is_not_an_array(const T (&array)[s]){
}

#define ARRAYSIZE_OF_VAR(v) sizeof(the_type_of_the_variable_is_not_an_array(v).result)

#include <iostream>
using namespace std;

int main(){
    int foo[42];
    int*bar;
    cout<<ARRAYSIZE_OF_VAR(foo)<<endl;
    // cout<<ARRAYSIZE_OF_VAR(bar)<<endl;  fails
} 
```

*   只有值在附近时，它才有效。
*   它是可移植的，仅使用 std-C++。
*   它失败并显示描述性错误消息。
*   它不评估值。（我想不出这会成为问题的情况，因为数组类型不能由函数返回，但最好是安全而不是抱歉。）
*   它将大小作为编译时常量返回。

我将构造包装到一个宏中以获得一些不错的语法。如果您想摆脱它，唯一的选择是手动进行替换。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T18:58:58.410

宏有一个非常容易引起误解的名称 - 如果数组名称作为宏参数传入，则宏中的表达式将返回数组中元素的数量。

对于其他类型，如果类型是指针，您将获得或多或少毫无意义的东西，否则您将收到语法错误。

通常，该宏被命名为 NUM_ELEMENTS() 之类的名称或其他名称以表明它的真正用途。在 C 中不能用函数替换宏，但在 C++ 中可以使用模板。

我使用的版本基于 Microsoft 的 winnt.h 标头中的代码（如果发布此代码段超出合理使用范围，请告诉我）：

```
//
// Return the number of elements in a statically sized array.
//   DWORD Buffer[100];
//   RTL_NUMBER_OF(Buffer) == 100
// This is also popularly known as: NUMBER_OF, ARRSIZE, _countof, NELEM, etc.
//
#define RTL_NUMBER_OF_V1(A) (sizeof(A)/sizeof((A)[0]))

#if defined(__cplusplus) && \
    !defined(MIDL_PASS) && \
    !defined(RC_INVOKED) && \
    !defined(_PREFAST_) && \
    (_MSC_FULL_VER >= 13009466) && \
    !defined(SORTPP_PASS)
//
// RtlpNumberOf is a function that takes a reference to an array of N Ts.
//
// typedef T array_of_T[N];
// typedef array_of_T &reference_to_array_of_T;
//
// RtlpNumberOf returns a pointer to an array of N chars.
// We could return a reference instead of a pointer but older compilers do not accept that.
//
// typedef char array_of_char[N];
// typedef array_of_char *pointer_to_array_of_char;
//
// sizeof(array_of_char) == N
// sizeof(*pointer_to_array_of_char) == N
//
// pointer_to_array_of_char RtlpNumberOf(reference_to_array_of_T);
//
// We never even call RtlpNumberOf, we just take the size of dereferencing its return type.
// We do not even implement RtlpNumberOf, we just decare it.
//
// Attempts to pass pointers instead of arrays to this macro result in compile time errors.
// That is the point.
//
extern "C++" // templates cannot be declared to have 'C' linkage
template <typename T, size_t N>
char (*RtlpNumberOf( UNALIGNED T (&)[N] ))[N];

#define RTL_NUMBER_OF_V2(A) (sizeof(*RtlpNumberOf(A)))

//
// This does not work with:
//
// void Foo()
// {
//    struct { int x; } y[2];
//    RTL_NUMBER_OF_V2(y); // illegal use of anonymous local type in template instantiation
// }
//
// You must instead do:
//
// struct Foo1 { int x; };
//
// void Foo()
// {
//    Foo1 y[2];
//    RTL_NUMBER_OF_V2(y); // ok
// }
//
// OR
//
// void Foo()
// {
//    struct { int x; } y[2];
//    RTL_NUMBER_OF_V1(y); // ok
// }
//
// OR
//
// void Foo()
// {
//    struct { int x; } y[2];
//    _ARRAYSIZE(y); // ok
// }
//

#else
#define RTL_NUMBER_OF_V2(A) RTL_NUMBER_OF_V1(A)
#endif

#ifdef ENABLE_RTL_NUMBER_OF_V2
#define RTL_NUMBER_OF(A) RTL_NUMBER_OF_V2(A)
#else
#define RTL_NUMBER_OF(A) RTL_NUMBER_OF_V1(A)
#endif

//
// ARRAYSIZE is more readable version of RTL_NUMBER_OF_V2, and uses
// it regardless of ENABLE_RTL_NUMBER_OF_V2
//
// _ARRAYSIZE is a version useful for anonymous types
//
#define ARRAYSIZE(A)    RTL_NUMBER_OF_V2(A)
#define _ARRAYSIZE(A)   RTL_NUMBER_OF_V1(A) 
```

此外，Matthew Wilson 的书“不完美的 C++”对这里发生的事情进行了很好的处理（第 14.3 节 - 第 211-213 页 - 数组和指针 - dimensionof()）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T18:42:01.197

*   函数，没有模板函数，是的
*   模板，我想是的（但 C++
*   模板不是我的事）

**编辑：**来自 Doug 的代码

```
template <typename T>
uint32_t StructSize()  // This might get inlined to a constant at compile time
{
   return sizeof(T)/sizeof(*T);
}

// or to get it at compile time for shure

class StructSize<typename T>
{
   enum { result = sizeof(T)/sizeof(*T) };
} 
```

我被告知第二个不起作用。OTOH 之类的东西应该是可行的，我只是没有使用足够的 C++ 来修复它。

[用于编译时内容的 C++（和 D）模板页面](http://www.digitalmars.com/d/2.0/templates-revisited.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T18:51:48.100

您的宏命名错误，它应该被称为 ARRAYSIZE。它用于确定数组中元素的数量，其大小在编译时是固定的。这是它可以工作的一种方式：

> 字符富[128]；// 实际上，您将有一些常量或常量表达式作为数组大小。
> 
> for( 无符号 i = 0; i < STRUCTSIZE( foo ); ++i ) { }

使用起来有点脆弱，因为你可能会犯这个错误：

> char* foo = new char[128];
> 
> for( 无符号 i = 0; i < STRUCTSIZE( foo ); ++i ) { }

你现在将迭代 i = 0 到 < 1 并撕掉你的头发。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T18:54:40.447

与模板类相比，模板函数的类型是自动推断的。您可以更简单地使用它：

```
template< typename T > size_t structsize( const T& t ) { 
  return sizeof( t ) / sizeof( *t ); 
}

int ints[] = { 1,2,3 };
assert( structsize( ints ) == 3 ); 
```

但我同意它不适用于结构：它适用于数组。所以我宁愿称它为 Arraysize :)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-18T19:32:37.220

简化@KTC，因为我们在模板参数中有数组的大小：

```
template<typename T, int SIZE>
int arraySize(const T(&arr)[SIZE])
{
    return SIZE;
} 
```

缺点是对于每个类型名、大小组合，您的二进制文件中都会有一个副本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-18T23:39:01.607

我更喜欢 [BCS] 建议的 enum 方法（在[Can this macro be convert to a function?](https://stackoverflow.com/questions/95500/can-this-macro-be-converted-to-a-function#95518)）

这是因为您可以在编译器期望编译时间常数的地方使用它。该语言的当前版本不允许您将函数结果用于编译时常量，但我相信这会出现在下一版本的编译器中：

此方法的问题在于，当与重载“*”运算符的类一起使用时，它不会产生编译时错误（有关详细信息，请参见下面的代码）。

不幸的是，'BCS' 提供的版本没有按预期编译，所以这是我的版本：

```
#include <iterator>
#include <algorithm>
#include <iostream>

template<typename T>
struct StructSize
{
    private:    static T x;
    public:      enum { size = sizeof(T)/sizeof(*x)};
};

template<typename T>
struct StructSize<T*>
{
    /* Can only guarantee 1 item (maybe we should even disallow this situation) */
    //public:     enum { size = 1};
};

struct X
{
    int operator *();
};

int main(int argc,char* argv[])
{
    int data[]                                  = {1,2,3,4,5,6,7,8};
    int copy[ StructSize<typeof(data)>::size];

    std::copy(&data[0],&data[StructSize<typeof(data)>::size],&copy[0]);
    std::copy(&copy[0],&copy[StructSize<typeof(copy)>::size],std::ostream_iterator<int>(std::cout,","));

    /*
     * For extra points we should make the following cause the compiler to generate an error message */
    X   bad1;
    X   bad2[StructSize<typeof(bad1)>::size];
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-18T18:42:13.723

是的，它可以在 C++ 中制作模板

```
template <typename T>
size_t getTypeSize()
{
   return sizeof(T)/sizeof(*T);
} 
```

使用：

```
struct JibbaJabba
{
   int int1;
   float f;
};

int main()
{
    cout << "sizeof JibbaJabba is " << getTypeSize<JibbaJabba>() << std::endl;
    return 0;
} 
```

请参阅上面或下面的 BCS 帖子，了解在编译时使用一些轻量级模板元编程对类执行此操作的一种很酷的方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-18T18:44:39.630

我认为这并不能真正计算出结构中元素的数量。如果结构被打包并且您使用了小于指针大小的东西（例如 32 位系统上的 char），那么您的结果是错误的。此外，如果结构包含一个结构，你也错了！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-18T19:28:26.327

xtofl 具有查找数组大小的正确答案。查找结构的大小不需要宏或模板，因为 sizeof() 应该做得很好。

我同意[预处理器是邪恶](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.8)的，但在某些情况下它是[替代方案中最不邪恶的](http://www.parashift.com/c++-faq-lite/big-picture.html#faq-6.16)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-18T19:49:54.747

正如约翰麦格的回答，但是

*缺点是对于每个类型名、大小组合，您的二进制文件中都会有一个副本。*

这就是为什么你要把它变成一个**内联**模板函数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-18T19:59:25.253

在这里详细回答： [数组大小确定第 1 部分](http://heifner.blogspot.com/2008/04/c-array-size-determination.html) 和这里： [数组大小确定第 2 部分](http://heifner.blogspot.com/2008/04/c-array-size-determination-part-2.html)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-19T08:30:30.550

特定于 Windows：

`_countof()`CRT 提供了专门用于此目的的宏。

[MSDN 上的文档链接](http://msdn.microsoft.com/en-us/library/ms175773(VS.80).aspx)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-06T17:03:19.337

对于 C99 风格的可变长度数组，似乎纯宏方法 (sizeof(arr) / sizeof(arr[0])) 是唯一可行的方法。

# java - 如何将 JUnitPerf 与 JWebUnit 和 JUnit 4 一起使用？

> ID：95506
> 
> 赞同：7
> 
> 时间：2008-09-18T18:41:24.707
> 
> 标签：java, unit-testing

我对正确运行的 Web 应用程序进行了一系列功能测试，但每个测试都需要使用`@BeforeClass`和`@AfterClass`注释提供的类级别设置和拆卸，因此需要 JUnit 4.0 或更高版本。

现在我想使用少量这些功能测试来执行负载测试，模拟大量用户请求 Web 应用程序的相关页面。为了让每个用户在 JWebUnit 中拥有自己的“模拟浏览器”，我需要在 JUnitPerf 中使用 TestFactory 来实例化被测类，但是由于 JUnit 4 测试是用 注释`@Test`而不是从 派生的`TestCase`，所以我得到了一个`TestFactory must be constructed with a TestCase class`例外。

有人成功使用 JUnitPerf 及其 TestFactory 和 JUnit 4 吗？让这一切奏效的秘诀是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-19T03:39:12.170

你需要一个 JUnit4 感知的 TestFactory。我在下面包括了一个。

```
import junit.framework.JUnit4TestAdapter;
import junit.framework.TestCase;
import junit.framework.TestSuite;

import com.clarkware.junitperf.TestFactory;

class JUnit4TestFactory extends TestFactory {

    static class DummyTestCase extends TestCase {
        public void test() {
        }
    }

    private Class<?> junit4TestClass;

    public JUnit4TestFactory(Class<?> testClass) {
        super(DummyTestCase.class);
        this.junit4TestClass = testClass;
    }

    @Override
    protected TestSuite makeTestSuite() {
        JUnit4TestAdapter unit4TestAdapter = new JUnit4TestAdapter(this.junit4TestClass);
        TestSuite testSuite = new TestSuite("JUnit4TestFactory");
        testSuite.addTest(unit4TestAdapter);
        return testSuite;
    }

} 
```

# windows-vista - 如何检测Vista UAC是否开启？

> ID：95510
> 
> 赞同：22
> 
> 时间：2008-09-18T18:41:36.703
> 
> 标签：windows-vista, uac

我需要我的应用程序根据 Vista UAC 是否启用而表现不同。我的应用程序如何检测用户计算机上的 UAC 状态？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-18T18:49:26.200

此注册表项应告诉您：

```
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System 
```

价值 `EnableLUA (DWORD)`

`1`启用/`0`或缺少禁用

但这假设您有权阅读它。

以编程方式，您可以尝试读取用户的令牌并猜测它是否是启用 UAC 的管理员（请参阅[此处](http://blogs.msdn.com/cjacks/archive/2006/10/09/How-to-Determine-if-a-User-is-a-Member-of-the-Administrators-Group-with-UAC-Enabled-on-Windows-Vista.aspx)）。不是万无一失的，但它可能会奏效。

这里的问题更多的是“你为什么需要知道”——它与答案有关。实际上，没有 API，因为从操作系统行为的角度来看，重要的是用户是否是管理员 - 他们如何选择以管理员身份保护自己是他们的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T18:43:33.750

[这篇文章](http://www.itwriting.com/blog/198-c-code-to-detect-uac-elevation-on-vista.html)有 C# 中的示例代码，用于测试 UAC 是否打开以及当前应用程序是否已获得提升的权限。您可以下载代码并根据需要进行解释。还链接了一个在 C++ 中显示相同的示例

[http://www.itwriting.com/blog/198-c-code-to-detect-uac-elevation-on-vista.html](http://www.itwriting.com/blog/198-c-code-to-detect-uac-elevation-on-vista.html)

那篇文章中的代码不仅仅是从注册表中读取的。如果启用了 UAC，您可能无权从注册表中读取它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-05-24T18:02:59.117

您不想检查是否启用了 UAC；这并不能告诉你任何事情。

我可以成为禁用 UAC 的标准用户。

您想使用以下命令检查[用户是否以管理权限运行`CheckTokenMembership`](http://msdn.microsoft.com/en-us/library/aa376389.aspx)：

```
///This function tells us if we're running with administrative permissions.
function IsUserAdmin: Boolean;
var
    b: BOOL;
    AdministratorsGroup: PSID;
begin
    {
        This function returns true if you are currently running with 
               admin privileges.
        In Vista and later, if you are non-elevated, this function will 
               return false (you are not running with administrative privileges).
        If you *are* running elevated, then IsUserAdmin will return 
               true, as you are running with admin privileges.

        Windows provides this similar function in Shell32.IsUserAnAdmin.
               But the function is depricated, and this code is lifted from the 
               docs for CheckTokenMembership: 
               http://msdn.microsoft.com/en-us/library/aa376389.aspx
    }

    {
        Routine Description: This routine returns TRUE if the caller's
        process is a member of the Administrators local group. Caller is NOT
        expected to be impersonating anyone and is expected to be able to
        open its own process and process token.
        Arguments: None.
        Return Value:
            TRUE - Caller has Administrators local group.
            FALSE - Caller does not have Administrators local group.
    }
    b := AllocateAndInitializeSid(
            SECURITY_NT_AUTHORITY,
            2, //2 sub-authorities
            SECURITY_BUILTIN_DOMAIN_RID,    //sub-authority 0
            DOMAIN_ALIAS_RID_ADMINS,        //sub-authority 1
            0, 0, 0, 0, 0, 0,               //sub-authorities 2-7 not passed
            AdministratorsGroup);
    if (b) then
    begin
        if not CheckTokenMembership(0, AdministratorsGroup, b) then
         b := False;
        FreeSid(AdministratorsGroup);
    end;

    Result := b;
end; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T18:52:41.357

您可以检查以下注册表项中的 DWORD 值**EnableLUA ：**

HKLM/软件/微软/Windows/CurrentVersion/策略/系统

如果值为 0（或不存在），则 UAC 为 OFF。如果它存在且非零，则 UAC 为 ON：

```
BOOL IsUacEnabled( )
{
    LPCTSTR pszSubKey = _T("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System");
    LPCTSTR pszValue = _T("EnableLUA");
    DWORD dwType = 0;
    DWORD dwValue = 0;
    DWORD dwValueSize = sizeof( DWORD );

    if ( ERROR_SUCCESS != SHGetValue( HKEY_LOCAL_MACHINE, pszSubKey, pszValueOn, 
        &dwType, &dwValue, &dwValueSize) )
    {
            return FALSE;
    }

    return dwValue != 0;
} 
```

注意，如果用户改变了 UAC 的状态但还没有重启电脑，这个函数会返回不一致的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-18T18:43:19.930

检查 HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System 中的注册表值

EnableLUA 值确定 UAC 是否处于活动状态。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-03T01:23:23.203

这篇文章相当古老，但我想评论“你为什么需要知道”和“检查令牌成员资格”位。

事实是微软自己的文档说“如果用户帐户控制已关闭并且标准用户尝试执行需要提升的任务”我们应该提供错误而不是显示按钮和/或与 UAC 屏蔽的链接尝试提升。有关详细信息，请参阅底部的[http://msdn.microsoft.com/en-us/library/windows/desktop/aa511445.aspx 。](http://msdn.microsoft.com/en-us/library/windows/desktop/aa511445.aspx)

如果没有检查 UAC 是否启用的方法，我们如何做到这一点？

在这种情况下，也许检查用户是否以管理员权限运行是正确的做法，但谁知道呢？微软提供的指导*充其量*是不确定的，如果不是完全令人困惑的话。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-15T16:42:21.513

对于发现此问题并正在寻找 VBScript 解决方案的任何其他人。这是我想出的检测是否启用了 UAC，如果启用，则以提升的权限重新启动我的脚本。只需将您的代码放在 Body() 函数中。如果我编写代码以始终启动提升，我发现 XP 和 Windows 7 之间的可移植性存在问题。如果没有 UAC，则使用此方法绕过海拔高度。还应考虑启用了 UAC 的 2008 及更高版本的服务器版本。

```
On Error Resume Next
UACPath = "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA"
Dim WshShell
Set WshShell = CreateObject("wscript.Shell")
UACValue = WshShell.RegRead(UACPath)
If UACValue = 1 Then
'Run Elevated
    If WScript.Arguments.length =0 Then
      Set objShell = CreateObject("Shell.Application")
      'Pass a bogus argument with leading blank space, say [ uac]
      objShell.ShellExecute "wscript.exe", Chr(34) & _
      WScript.ScriptFullName & Chr(34) & " uac", "", "runas", 1
      WScript.Quit
    Else 
        Body()
    End If
Else
Body()
End If

Function Body()
MsgBox "This is the body of the script"
End Function 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-18T18:43:42.690

AFAIK，UAC 是本地用户或组的策略设置。因此，您可以从 .Net 中读取此属性。抱歉没有更多细节，但我希望这会有所帮助

# visual-studio-2008 - 为什么我的程序要求允许在 Vista 上运行？

> ID：95525
> 
> 赞同：3
> 
> 时间：2008-09-18T18:42:37.013
> 
> 标签：visual-studio-2008, windows-vista

我刚刚使用 VS 2008 构建了一个 VS C++ 6.0 程序。当我尝试运行或调试应用程序时，Vista 会请求许可。导致这种情况的程序是如何构建的？该程序正在从 C:\Dev 的子文件夹构建和运行

作为解决问题的方法，[这种回应对我来说毫无意义。](http://www.vistax64.com/vista-installation-setup/138053-vista-asks-permission-run-installed-programs.html)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T18:56:36.590

可能性一：

您的程序在其清单中被标记为需要管理员权限

可能性2：

您的程序称为 setup.exe 或 install.exe - 这样的程序名称总是需要管理员权限

有关这些和其他可能性的详细说明，为什么您会看到此检查[了解用户帐户控制 Technet 文章](http://technet.microsoft.com/en-us/library/cc512679.aspx "了解用户帐户控制")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:50:00.117

MVP 正在谈论让您的代码和项目从您的用户文件夹运行，例如 c:\users\yourname\appdata 或该路径下的其他内容。

不要禁用 UAC 来解决此问题，否则您的应用程序将无法在另一台机器上运行，除非它关闭了 UAC。这是一个非常糟糕的做法。在理想情况下，您的应用程序应该向用户请求提升的权限。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:27:52.380

谢谢苏玛。您的反应是最好的，并帮助我找到了解决方案。我已确定您的第一个建议解释了原因。将文件重命名为不包含“设置”一词的内容没有帮助。

原来我错了。我同时安装了 VS 2005 和 VS 2008，当我尝试打开旧的 .dsw 文件时，它是 2005 年启动并提供升级项目的。2005 显然创建了一个清单，其中只有一行带有“程序集”标签。一旦我使用 VS 2008 升级了项目，就会创建一个更广泛的清单文件。我通过检查 Manifest Tool...Input and Output...Embed Manifest 设置确认清单已嵌入到我的程序中。这个新清单包括以下数据：

```
<trustInfo xmlns="urn:schemas-microsoft-com:asm.v3">
    <security>
      <requestedPrivileges>
        <requestedExecutionLevel level="asInvoker" uiAccess="false"></requestedExecutionLevel>
      </requestedPrivileges>
    </security> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T18:50:23.470

如果您不是管理员，那么您可能没有在 C:\Dev 中执行程序的权限。

# svn - Subversion Error: "Working copy [directory] not locked"

> ID：95543
> 
> 赞同：0
> 
> 时间：2008-09-18T18:43:55.670
> 
> 标签：svn

I am trying to merge a directory in subversion, but I get the following error when I do so:

```
svn: Working copy '[directory name]' not locked' 
```

I tried deleting the working directory and doing a fresh update, but that did not solve the issue. I also did a cleanup on the directory.

Does anyone know how to fix this?

In this instance, the parent directory has the same name as the sub directory. I don't know if this has anything to do with the error though.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T18:45:28.537

Check out this blog posting ([Obscure "svn mv" problem solved](http://news.e-scribe.com/145))... I typically just remove the directory and grab fresh sources.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T16:24:21.483

我使用 IDEA 遇到了这个错误。我通过在 Windows 资源管理器中进行乌龟 svn 清理来解决这个问题，IDEA 中的等效清理不起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T18:56:26.077

Are you by chance using TortoiseSVN and some other client (Such as subversive or the commandline client?). Sometimes Tortoise can unintentionally gum up other clients. I don't remember what exactly causes this to happen.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:27:01.993

如果没有看到您确切的目录设置，就很难说发生了什么。此错误消息的一个原因可能是您的合并命令的一部分确实引用了不受版本控制的目录。

您可以发布触发错误的确切合并命令吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-18T18:55:47.963

Try doing a clean-up and then an update. If that not work, please explain better your issue.

# c# - 我应该只捕获异常来记录它们吗？

> ID：95547
> 
> 赞同：29
> 
> 时间：2008-09-18T18:44:30.830
> 
> 标签：c#, logging, exception-handling

我应该捕获异常以进行日志记录吗？

```
公共 foo(..)
{
   尝试
   {
     ...
   } 捕捉（异常前）{
     Logger.Error(ex);
     扔;
   }
}

```

如果我在每个层（DataAccess、Business 和 WebService）中都设置了这个，这意味着异常被记录了好几次。

如果我的层位于单独的项目中并且只有公共接口有 try/catch，这样做是否有意义？为什么？为什么不？我可以使用其他方法吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-18T18:47:10.043

当然不。您应该找到**处理**异常的正确位置（实际上是做一些事情，例如 catch-and-not-rethrow），然后记录它。当然，您可以而且应该包含整个堆栈跟踪，但是按照您的建议会在代码中乱扔 try-catch 块。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-18T18:48:42.583

除非您要更改异常，否则您应该只在您要处理错误的级别记录，而不是重新抛出它。否则，您的日志只有一堆“噪音”，每层记录 3 条或更多相同的消息。

我的最佳做法是：

1.  仅在公共方法中尝试/捕获（一般而言；显然，如果您要捕获特定错误，您会在那里检查它）
2.  仅在抑制错误并重定向到错误页面/表单之前登录 UI 层。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-18T19:04:31.343

一般的经验法则是，只有当您实际上可以对其进行处理时，您才能捕获异常。因此，在业务或数据层，您只会在如下情况下捕获异常：

```
try
{
    this.Persist(trans);
}
catch(Exception ex)
{
    trans.Rollback();
    throw ex;
} 
```

我的业务/数据层尝试保存数据 - 如果生成异常，则回滚任何事务并将异常发送到 UI 层。

在 UI 层，您可以实现一个通用的异常处理程序：

```
Application.ThreadException += new ThreadExceptionEventHandler(Application_ThreadException); 
```

然后处理所有异常。它可能会记录异常，然后显示用户友好的响应：

```
static void Application_ThreadException(object sender, ThreadExceptionEventArgs e)
{
    LogException(e.Exception);
}

static void LogException(Exception ex)
{
    YYYExceptionHandling.HandleException(ex,
        YYYExceptionHandling.ExceptionPolicyType.YYY_Policy,
        YYYExceptionHandling.ExceptionPriority.Medium,
        "An error has occurred, please contact Administrator");
} 
```

在实际的 UI 代码中，如果您打算做一些不同的事情，例如显示不同的友好消息或修改屏幕等，您可以捕获单个异常。

另外，提醒一下，始终尝试处理错误——例如除以 0——而不是抛出异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T18:56:39.007

一个好的做法是**翻译异常**。不要只记录它们。如果您想知道引发异常的具体原因，请抛出特定异常：

```
public void connect() throws ConnectionException {
   try {
       File conf = new File("blabla");
       ...
   } catch (FileNotFoundException ex) {
       LOGGER.error("log message", ex);
       throw new ConnectionException("The configuration file was not found", ex);
   }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T18:49:23.377

使用您自己的异常来包装内置异常。这样，您可以在捕获异常时区分已知错误和未知错误。如果您有一个方法调用可能会引发异常以对预期和意外失败做出反应的其他方法，这将非常有用

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T18:52:40.890

您可能想查找标准异常处理样式，但我的理解是：在您可以向异常添加额外细节的级别处理异常，或者在您将向用户呈现异常的级别处理异常。

在您的示例中，您除了捕获异常、记录它并再次抛出它之外什么都不做。如果您所做的只是记录它，为什么不使用一个 try/catch 在最高级别捕获它，而不是在每个方法中捕获它？

如果您要在再次抛出异常之前向异常添加一些有用的信息，我只会在该层处理它 - 将异常包装在您创建的新异常中，该异常具有超出低级异常文本的有用信息，这通常对任何人都没有意义没有一些上下文..

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-23T22:06:41.217

有时您需要记录在处理异常时不可用的数据。在这种情况下，记录只是为了获取该信息是合适的。

例如（Java 伪代码）：

```
public void methodWithDynamicallyGeneratedSQL() throws SQLException {
    String sql = ...; // Generate some SQL
    try {
        ... // Try running the query
    }
    catch (SQLException ex) {
        // Don't bother to log the stack trace, that will
        // be printed when the exception is handled for real
        logger.error(ex.toString()+"For SQL: '"+sql+"'");
        throw ex;  // Handle the exception long after the SQL is gone
    }
} 
```

这类似于追溯日志（我的术语），您可以在其中缓冲事件日志，但除非有触发事件（例如抛出异常），否则不要写入它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T18:49:42.830

如果您需要记录所有异常，那么这是一个绝妙的主意。也就是说，在没有其他原因的情况下记录所有异常并不是一个好主意。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-18T18:49:51.910

您可能希望在最高级别登录，通常是您的 UI 或 Web 服务代码。多次记录是一种浪费。此外，当您查看日志时，您想了解整个故事。

在我们的一个应用程序中，我们所有的页面都派生自一个 BasePage 对象，该对象处理异常处理和错误日志记录。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-18T18:50:32.143

如果这是它唯一做的事情，我认为最好从这些类中删除 try/catch，并将异常引发到负责处理它们的类。这样，每个异常您只会获得一个日志，从而为您提供更清晰的日志，甚至您可以记录堆栈跟踪，这样您就不会错过异常的起源。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-18T18:53:01.387

我的方法是仅在处理程序中记录异常。可以说是“真正的”处理程序。否则，日志将很难阅读，代码的结构也很差。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-18T18:54:56.220

这取决于异常：如果这实际上不应该发生，我肯定会记录它。另一方面：如果你期望这个异常，你应该考虑应用程序的设计。

无论哪种方式：您至少应该尝试指定要重新抛出、捕获或记录的异常。

```
public foo(..)
{
   try
   {
     ...
   }
   catch (NullReferenceException ex) {
     DoSmth(e);
   }
   catch (ArgumentExcetion ex) {
     DoSmth(e);
   }
   catch (Exception ex) {
     DoSmth(e);
   }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-18T18:59:32.573

您将希望在层边界处登录。例如，如果您的业务层可以部署在 n 层应用程序中物理上独立的机器上，那么以这种方式记录并抛出错误是有意义的。

通过这种方式，您可以在服务器上记录异常日志，而无需在客户端机器上四处探查以找出发生了什么。

我在使用 Remoting 或 ASMX Web 服务的应用程序的业务层中使用此模式。使用 WCF，您可以使用附加到 ChannelDispatcher（完全是另一个主题）的 IErrorHandler 拦截并记录异常 - 因此您不需要 try/catch/throw 模式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-18T19:48:55.433

您需要制定处理异常的策略。我不推荐接球再扔。除了多余的日志条目之外，它还使代码更难阅读。考虑将异常写入构造函数中的日志。这为您想要恢复的异常保留了 try/catch；使代码更易于阅读。要处理意外或不可恢复的异常，您可能希望在程序最外层附近使用 try/catch 来记录诊断信息。

顺便说一句，如果这是 C++，您的 catch 块正在创建异常对象的副本，这可能是其他问题的潜在来源。尝试捕获对异常类型的引用：

```
  catch (const Exception& ex) { ... }

```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-18T20:37:04.977

[这个](http://www.se-radio.net/podcast/2006-07/episode-21-error-handling-pt-2)软件工程广播播客是错误处理最佳实践的一个很好的参考。实际上有2个讲座。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-02-04T16:10:33.930

一般来说，这是不好的做法，除非您出于非常特定的原因需要登录。

就一般日志异常而言，应该在根异常处理程序中处理。

# ruby-on-rails - 在 Rails 中覆盖 MIME 类型

> ID：95554
> 
> 赞同：4
> 
> 时间：2008-09-18T18:44:56.320
> 
> 标签：ruby-on-rails, ruby, json, mime, mime-types

我想将 Rails 中的 JSON MIME 类型（“application/json”）覆盖为（“text/x-json”）。我尝试在 mime_types.rb 中再次注册 MIME 类型，但没有成功。有什么建议么？

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-18T19:22:06.060

这应该可以工作（在初始化程序、插件或类似的地方）：

```
Mime.send(:remove_const, :JSON)
Mime::Type.register "text/x-json", :json 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T19:12:40.793

尝试：

```
render :json => var_containing_my_json, :content_type => 'text/x-json' 
```

# .net - 将 Cocoa 的 MVC 版本与 .NET 一起使用有什么好处吗？

> ID：95567
> 
> 赞同：2
> 
> 时间：2008-09-18T18:46:40.500
> 
> 标签：.net, cocoa, model-view-controller

这里有一张图描述了传统 MVC 和 Cocoa MVC 之间的区别：

[Cocoa 设计模式：模型-视图-控制器设计模式](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaFundamentals/CocoaDesignPatterns/CocoaDesignPatterns.html#//apple_ref/doc/uid/TP40002974-CH6-SW1)

使用 Visual Studio 在 .NET 中以“Cocoa”方式进行操作有什么好处吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T19:23:46.603

如果它对您更有意义，那么没有理由**不**这样做。请注意，Cocoa 框架中的许多事情都是由于更高级别的设计决策而导致的，例如，优先组合和委托而不是子类化。

如果您愿意，您可以设计看起来像 Objective-C 软件的 C# 软件，但没有 Cocoa 经验的人必须向他们解释，因为松散耦合的设计对他们来说只是“奇怪”。

哦，对了——这种设计的优点包括 UI 视图和模型类的更高的可重用性（因为它们不会相互了解），视图类中的代码稍微简单一些，以及更多的“应用程序逻辑” " 在一个地方（控制器类）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T00:12:54.243

.Net developer's Journal 上的一位开发人员一直在撰写有关他的过渡并将 .Net 与 Cocoa 进行比较的文章，包括在 .Net 中使用 Cocoa MVC 样式

[http://dotnetaddict.dotnetdevelopersjournal.com/tags/?/cocoa](http://dotnetaddict.dotnetdevelopersjournal.com/tags/?/cocoa)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T19:27:45.517

“可可版本的 MVC”不是 ASP.NET MVC 中使用的模式吗？到目前为止，所有示例都指向通过控制器进行黑白视图和模型的通信，而 V 和 M 之间没有直接交互。我是否理解错误？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T00:28:48.320

使用 Cocoa 的“中介控制器”（NSController 的子类）的主要优点是它们实现了在模型和视图之间进行中介所需的大部分标准功能。诸如跟踪视图选择所指示的模型部分和事务支持（例如，以便您可以提交或放弃对视图或模型的一组修改）之类的东西是“免费”的。使用 NSController 子类作为模型和视图之间的“胶水”代码，作为开发人员，您可以将精力集中在“协调控制器”功能上——驻留在控制器层中的特定于应用程序的逻辑。

那么，是否值得在 .Net 中使用这种模式？让一个通用的协调控制器正常工作并非易事（例如，Apple 需要发布几个版本才能让它正常工作）。树控制器之类的东西特别棘手。如果您只在一个或几个项目中使用此模式，则可能不值得付出努力。另一方面，我相信社区会喜欢一个通用的控制器框架，比如 Cocoa 的 NSController 层次结构。

# oracle - 如何确定 Oracle 数据泵导出文件中的模式

> ID：95578
> 
> 赞同：41
> 
> 时间：2008-09-18T18:47:31.400
> 
> 标签：oracle, import, oracle-dump

*   我有一个使用 .dmp 创建的 Oracle 数据库备份文件 (.dmp) `expdp`。
*   .dmp 文件是整个数据库的导出。
*   我需要从这个转储文件中恢复 1 个模式。
*   我不知道这个转储文件中模式的名称。
*   要使用`impdp`导入数据，我需要加载模式的名称。

所以，我需要检查 .dmp 文件并列出其中的所有模式，我该怎么做？

* * *

*更新 (2008-09-18 13:02) - 更详细的信息：*

我当前使用的 impdp 命令是：

```
impdp user/password@database directory=DPUMP_DIR 
      dumpfile=EXPORT.DMP logfile=IMPORT.LOG 
```

并且 DPUMP_DIR 配置正确。

```
SQL> SELECT directory_path
2  FROM dba_directories
3  WHERE directory_name = 'DPUMP_DIR';

DIRECTORY_PATH
-------------------------
D:\directory_path\dpump_dir\ 
```

是的，EXPORT.DMP 文件实际上位于该文件夹中。

`impdp`运行命令时收到的错误消息是：

```
Connected to: Oracle Database 10g Enterprise Edition ...
ORA-31655: no data or metadata objects selected for the job
ORA-39154: Objects from foreign schemas have been removed from import 
```

此错误消息通常是预期的。我需要的`impdp`命令是：

```
impdp user/password@database directory=DPUMP_DIR dumpfile=EXPORT.DMP 
      SCHEMAS=SOURCE_SCHEMA REMAP_SCHEMA=SOURCE_SCHEMA:MY_SCHEMA 
```

但要做到这一点，我需要源模式。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2011-07-15T14:31:05.423

`impdp``dmp`如果使用[`SQLFILE`参数](https://docs.oracle.com/cd/B19306_01/server.102/b14215/dp_import.htm#sthref354)，则将备份的 DDL 导出到文件。例如，把它放到一个文本文件中

```
impdp '/ as sysdba' dumpfile=<your .dmp file> logfile=import_log.txt sqlfile=ddl_dump.txt 
```

然后检查`ddl_dump.txt`备份中的表空间、用户和模式。

根据文档，这实际上并没有修改数据库：

> SQL 并未实际执行，目标系统保持不变。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-19T06:25:02.473

如果您使用可以处理大文件的编辑器打开 DMP 文件，您可能能够找到提到架构名称的区域。只要确保不要改变任何东西。如果您打开原始转储的副本会更好。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-19T16:27:05.747

*更新 (2008-09-19 10:05) - 解决方案：*

**我的解决方案：**社会工程，我非常努力地挖掘并找到了知道模式名称的人。
**技术解决方案：**搜索 .dmp 文件**确实**产生了架构名称。
一旦我知道了模式名称，我就搜索了转储文件并了解了在哪里可以找到它。

在 .dmp 文件中看到 Schemas 名称的位置：

*   **`<OWNER_NAME>SOURCE_SCHEMA</OWNER_NAME>`** 这在每个表名/定义之前都可以看到。

*   **`SCHEMA_LIST 'SOURCE_SCHEMA'`** 这在 .dmp 结尾附近可见。

有趣的是，围绕该`SCHEMA_LIST 'SOURCE_SCHEMA'`部分，它还包含用于创建转储的命令行、使用的目录、使用的 par 文件、运行它的 Windows 版本以及导出会话设置（语言、日期格式）。

所以，问题解决了:)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-19T06:21:24.230

假设您没有最初生成文件的 expdp 作业的日志文件，最简单的选择可能是使用[SQLFILE 参数](http://docs.oracle.com/cd/B19306_01/server.102/b14215/dp_import.htm#sthref354)让 impdp 生成 DDL 文件（基于完全导入）。然后您可以从该文件中获取模式名称。当然不理想，因为 impdp 必须读取整个转储文件以提取 DDL，然后再次访问您感兴趣的模式，并且您必须执行一些文本文件搜索各种 CREATE USER 语句，但应该是可行的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-01-22T01:49:54.880

运行 impdp 命令以生成 sqlfile，您需要以具有 DATAPUMP_IMP_FULL_DATABASE 角色的用户身份运行它。

或者...以低权限用户身份运行它并使用 MASTER_ONLY=YES 选项，然后检查主表。例如

```
select value_t 
from SYS_IMPORT_TABLE_01 
where name = 'CLIENT_COMMAND' 
and process_order = -59;

col object_name for a30
col processing_status head STATUS for a6
col processing_state head STATE for a5
select distinct
  object_schema,
  object_name,
  object_type,
  object_tablespace,
  process_order,
  duplicate,
  processing_status,
  processing_state
from sys_import_table_01
where process_order > 0
and object_name is not null
order by object_schema, object_name
/ 
```

[http://download.oracle.com/otndocs/products/database/enterprise_edition/utilities/pdf/oow2011_dp_mastering.pdf](http://download.oracle.com/otndocs/products/database/enterprise_edition/utilities/pdf/oow2011_dp_mastering.pdf)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-04-26T06:34:04.027

第1步：这是一个简单的例子。您必须使用`SQLFILE`选项从转储文件创建 SQL 文件。

`CREATE USER`第 2 步：在生成的 SQL 文件（此处为 tables.sql）中Grep for

这里的例子：

```
$ impdp directory=exp_dir dumpfile=exp_user1_all_tab.dmp  logfile=imp_exp_user1_tab sqlfile=tables.sql 
```

> 导入：发布 11.2.0.3.0 - 2013 年 4 月 26 日星期五 08:29:06 生产
> 
> 版权所有 (c) 1982, 2011，Oracle 和/或其附属公司。版权所有。
> 
> 用户名：/ as sysdba
> 
> 处理对象类型 SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMA 作业 "SYS"."SYS_SQL_FILE_FULL_01" 在 08:29:12 成功完成

```
$ grep "CREATE USER" tables.sql 
```

> 创建由值标识的用户“USER1”'S:270D559F9B97C05EA50F78507CD6EAC6AD63969E5E;BBE7786A5F9103'

此处解释了许多数据泵选项[http://www.acehints.com/p/site-map.html](http://www.acehints.com/p/site-map.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-02-21T17:41:52.130

您需要搜索 OWNER_NAME。

```
cat -v dumpfile.dmp | grep -o '<OWNER_NAME>.*</OWNER_NAME>' | uniq -u 
```

cat -v 将转储文件转换为可见文本。

grep -o 仅显示匹配项，因此我们看不到很长的行

uniq -u 删除重复的行，因此您看到的输出更少。

即使在大型转储文件上，这也很有效，并且可以调整以在脚本中使用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-04-24T13:10:01.510

我的解决方案（类似于 KyleLanser 的回答）（在 Unix 机器上）：

```
strings dumpfile.dmp | grep SCHEMA_LIST 
```

# jquery - $.ajax 实用程序中的 JQuery 错误选项

> ID：95600
> 
> 赞同：34
> 
> 时间：2008-09-18T18:49:15.593
> 
> 标签：jquery, ajax

文档表明错误：选项函数将提供：XHR 实例、状态消息字符串（在这种情况下总是错误）和从 XHR 实例返回的可选异常对象（书籍：JQuery in Action）

使用以下（在 $.ajax 调用中）我能够确定我有一个“解析器错误”和一个“超时”（因为我添加了超时：选项）错误

```
error: function(request, error){} 
```

您在错误选项中评估的其他内容是什么？你包括可选的异常对象吗？

**编辑：**答案之一表明所有返回错误...了解更多有关 XHR 实例和异常对象中的价值（用于调试）的信息会有所帮助

这是一个完整的 $.ajax 调用：

```
$.ajax({
 type: "post",
 url: "http://myServer/cgi-bin/broker" ,
 dataType: "text",
 data: {
 '_service' : 'myService',
 '_program' : 'myProgram',
 'start' : start,
 'end' : end
 },
 beforeSend: function() {
  $("#loading").removeClass("hide");
 },
 timeout: 5000,
 error: function(request,error) {
  $("#loading").addClass("hide");
  if (error == "timeout") {
   $("#error").append("The request timed out, please resubmit");
  }
  else {
   $("#error").append("ERROR: " + error);
  }
  },
  success: function(request) {
   $("#loading").addClass("hide");
   var t = eval( "(" + request + ")" ) ;
  } // End success
}); // End ajax method 
```

感谢您的输入

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-12-24T03:26:33.790

我发现请求比错误更有用。

```
error:function(xhr,err){
    alert("readyState: "+xhr.readyState+"\nstatus: "+xhr.status);
    alert("responseText: "+xhr.responseText);
}
```

**xhr**是 XmlHttpRequest。
**readyState**值是 1:loading, 2:loaded, 3:interactive, *4:complete*。
**status**是 HTTP 状态编号，即 404: not found, 500: server error, *200: ok*。
**responseText**是来自服务器的响应 - 这可以是来自 Web 服务的文本或 JSON，或来自 Web 服务器的 HTML。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-18T19:53:23.567

**查看 jQuery 源代码，除了成功**之外，还有四种返回状态：

*   **timeout** - 超过您指定的超时时间
*   **error** - http 错误，如 404
*   **notmodified** - 自上次请求以来未修改请求的资源时
*   **parsererror** - 当 xml/json 响应错误时

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-05T17:28:55.937

这是一个旁白，但我认为您提交的代码中有一个错误。该行：

```
 if (error = "timeout") { 
```

应该有更多的等号：

```
 if (error == "timeout") { 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:53:31.977

传递给错误函数的第二个参数将是字符串“timeout”“parserror”“error”或“notmodified”。第三个将是异常对象。此对象有助于调试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:19:26.270

你确定这个回答是正确的吗？解析错误意味着在线评估数据存在错误 `var t = eval( "(" + request + ")" ) ;`

# xna - XNA 文件加载

> ID：95606
> 
> 赞同：2
> 
> 时间：2008-09-18T18:49:37.560
> 
> 标签：xna

在 XNA 中，如何在不使用内容管道的情况下从文件中加载纹理或网格？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T21:48:51.153

.FromFile 方法不适用于 xbox 或 zune。你有两个选择：

1.  只需在 xbox 或 zune 上使用内容管道……（如果您关心它们），无论如何您都不能拥有用户提供的内容，因此仅使用内容管道也没关系。
2.  编写代码来加载纹理（使用 .SetData），或者当然是解析模型文件并加载适当的顶点缓冲区等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T22:20:03.267

对于任何有兴趣从文件加载模型的人，请查看本教程：

[http://creators.xna.com/en-us/sample/winforms_series2](http://creators.xna.com/en-us/sample/winforms_series2)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-14T01:12:05.710

这是一种仅在 windows 上加载纹理而不通过管道加载的方式，正如 Cory 上面所说的，所有内容必须在加载到 Xbox 和 Zune 之前进行编译。

Texture2D texture = Texture2D.FromFile(GraphicsDeviceManager.GraphicsDevice, @Location of your Texture Here.png);

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T18:55:51.803

我相信 Texture2D.FromFile(); 就是你要找的。

不过，看起来你不能用模型来做到这一点。

[http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.graphics.texture2d.fromfile.aspx](http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.graphics.texture2d.fromfile.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-05T05:46:23.140

如果您真的想`Xna.Framework.Graphics.Model`在没有内容管道的情况下在 PC 上加载 Xna（例如，对于用户生成的内容），有一种方法。我使用 SlimDX 加载 X 文件，并避免解析代码、实例化模型的一些反射技巧（它是密封的并且有一个私有构造函数，因此不打算扩展或定制）。见这里：[http ://contenttracker.codeplex.com/SourceControl/changeset/view/20704#346981](http://contenttracker.codeplex.com/SourceControl/changeset/view/20704#346981)

# vba - Append Subject Header in Outlook (VBA)

> ID：95625
> 
> 赞同：5
> 
> 时间：2008-09-18T18:50:49.723
> 
> 标签：vba, outlook, append

Basically, we have a rule setup to run a script when a code word is detected in the body of an incoming message. The script will append the current subject header with a word in front. For example, Before: "Test Message", After: "Dept - Test Message". Any ideas?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T19:01:56.717

Or if you need an entire script:

Do the Run a script with the MailItem as the parameter.

```
Sub RewriteSubject(MyMail As MailItem)

    Dim mailId As String
    Dim outlookNS As Outlook.NameSpace
    Dim myMailItem As Outlook.MailItem

    mailId = MyMail.EntryID
    Set outlookNS = Application.GetNamespace("MAPI")
    Set myMailItem = outlookNS.GetItemFromID(mailId)

    ' Do any detection here

    With myMailItem 
      .Subject = "Dept - " & mailItem.Subject
      .Save
    End With

    Set myMailItem = Nothing
    Set outlookNS = Nothing

End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T18:56:49.133

Not tested:

```
mailItem.Subject = "Dept - " & mailItem.Subject
mailItem.Save 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T19:09:47.103

```
Sub AppendSubject(MyMail As MailItem)
    Dim strID As String
    Dim mailNS As Outlook.NameSpace
    Dim mailItem As Outlook.MailItem

    strID = MyMail.EntryID
    Set mailNS = Application.GetNamespace("MAPI")
    Set mailItem = mailNS.GetItemFromID(strID)
    mailItem.Subject = "Dept - " & mailItem.Subject
    mailItem.Save

    Set mailItem = Nothing
    Set mailNS = Nothing
End Sub 
```

Are we missing anything? EDIT: Doh! You already answered our question with a full script... Thanks!

# .net - 如何使用 64 位 COM 互操作构建 64 位 .NET DLL？

> ID：95628
> 
> 赞同：2
> 
> 时间：2008-09-18T18:51:15.260
> 
> 标签：.net, interop, activex, 64-bit

我需要构建一个针对 x64 的托管 DLL，并通过 x64 COM 公开它。我需要一个演练，好文章，等等......

互操作相当简单，但是当您在双方都谈论 x64 时，我找不到任何东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T19:02:09.277

看看[这个讨论](http://bytes.com/forum/thread584555.html)。而[这个](http://social.msdn.microsoft.com/Forums/en-US/netfx64bit/thread/bbb164c7-9d76-4804-b506-85172e586e99/)。

# emacs - 在 Emacs 中使用 su/sudo 打开一个文件

> ID：95631
> 
> 赞同：184
> 
> 时间：2008-09-18T18:51:47.320
> 
> 标签：emacs, file-permissions, sudo

假设我想在现有的 Emacs 会话中使用`su`or打开一个文件`sudo`，而不是下拉到 shell 并执行`sudoedit`or `sudo emacs`。一种方法是

```
C-x C-f /sudo::/path/to/file 
```

但这需要[通过 SSH 进行昂贵的往返](http://www.gnu.org/software/tramp/)。有没有更直接的方法？

[编辑] @JBB 是对的。我希望能够调用`su`/`sudo`来保存和打开。保存时重新授权可以（但不理想）。我正在寻找的是 and 的变体`find-file`，`save-buffer`可以通过`su`/进行“管道传输” `sudo`。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-19T02:17:30.400

Tramp 的好处在于，您只需在打开第一个文件时为 SSH 的往返支付费用。然后 Sudo 会缓存您的凭据，而 Emacs 会保存一个句柄，以便后续 sudo 打开的文件花费更少的时间。

我也没有发现节省负担所需的额外时间。它足够快，IMO。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2010-01-15T12:25:48.187

Tramp 不**通过**SSH 往返 sudo，它使用*subshel​​l*。参见手册：[https ://www.gnu.org/software/tramp/#Inline-methods](https://www.gnu.org/software/tramp/#Inline-methods)

因此，我建议您坚持使用 TRAMP。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-06-27T19:25:48.257

如果您使用`helm`，则`helm-find-files`支持以 root 身份打开文件`C-c r`。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-08-12T17:11:35.270

不是对原始问题的真正答案，但这里有一个帮助函数，可以让执行 tramp/sudo 路线更容易一些：

```
(defun sudo-find-file (文件名)
  “类似于查找文件，但以 root 身份打开文件。”
  （交互式“FSudo 查找文件：”）
  (let ((tramp-file-name (concat "/sudo::" (expand-file-name file-name))))
    （查找文件流浪汉文件名）））

```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-19T03:14:41.790

您的示例根本没有启动 ssh，至少在我的 TRAMP 版本（“2.1.13-pre”）中没有。find-file 和 save-buffer 都很好用。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-06-17T12:19:18.393

至少为了保存，一个[sudo-save 包](http://www.emacswiki.org/emacs/SudoSave)是专门针对这种问题编写的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-03-25T12:24:48.787

我建议您使用建议命令。将此函数放入您的 ~/.emacs

```
(defadvice ido-find-file (after find-file-sudo activate)
  "Find file as root if necessary."
  (unless (and buffer-file-name
               (file-writable-p buffer-file-name))
    (find-alternate-file (concat "/sudo:root@localhost:" buffer-file-name)))) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-04-12T09:39:37.793

（仅在本地工作。需要通过tramp更新才能正常工作）

稍微扩展了伯顿的回答：

```
(defun sudo-find-file (file-name)
"Like find file, but opens the file as root."
(interactive "FSudo Find File: ")
(let ((tramp-file-name (concat "/sudo::" (expand-file-name file-name))))
(find-file tramp-file-name)))

(add-hook 'dired-mode-hook
    (lambda ()
      ;; open current file as sudo 
      (local-set-key (kbd "C-x <M-S-return>") (lambda()
        (interactive)
        (message "!!! SUDO opening %s" (dired-file-name-at-point))
        (sudo-find-file (dired-file-name-at-point))
      ))
    )
) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-18T19:03:15.140

啊。也许您可以在 Emacs 中打开一个 shell 并执行 sudo emacs。

问题是您可能不只是想打开文件。您希望以后能够保存它。因此，您需要您的根权限才能持久，而不仅仅是为了打开文件而存在。

听起来您希望 Emacs 成为您的窗口管理器。没有那个就够臃肿了。:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-08-21T06:37:00.983

我发现`sudo edit`功能对此非常有用。打开文件后，按`s-e`sudo 访问以编辑/保存文件。

# compilation - 即时 (JIT) 编译器有什么作用？

> ID：95635
> 
> 赞同：608
> 
> 时间：2008-09-18T18:52:08.630
> 
> 标签：compilation, compiler-construction, jit

与非 JIT 编译器相比，JIT 编译器具体做什么？谁能给一个简洁易懂的描述？

* * *

## 回答 #1

> 赞同：590
> 
> 时间：2008-09-18T18:55:52.207

JIT 编译器**在**程序启动后运行并将代码（通常是字节码或某种 VM 指令）即时（或称为即时）编译成通常更快的形式，通常是主机 CPU 的本机指令系统。JIT 可以访问动态运行时信息，而标准编译器则不能，并且可以进行更好的优化，例如经常使用的内联函数。

这与在程序首次运行**之前将****所有**代码编译为机器语言的传统编译器形成对比。

 **换句话说，传统的编译器在您第一次运行它之前将整个程序构建为一个 EXE 文件。对于较新样式的程序，使用伪代码（p-code）生成程序集。只有在您在操作系统上执行程序之后（例如，通过双击其图标），（JIT）编译器才会启动并生成基于 Intel 的处理器或任何可以理解的机器代码（m-code）。

* * *

## 回答 #2

> 赞同：281
> 
> 时间：2008-09-18T19:06:10.310

一开始，编译器负责将高级语言（定义为比汇编程序更高的级别）转换为目标代码（机器指令），然后将其链接（通过链接器）成为可执行文件。

在语言发展的某个阶段，编译器会将高级语言编译为伪代码，然后（由解释器）解释该伪代码以运行您的程序。这消除了目标代码和可执行文件，并允许这些语言移植到多个操作系统和硬件平台。Pascal（编译成 P-Code）是最早的之一；Java 和 C# 是最近的例子。最终，术语 P-Code 被字节码取代，因为大多数伪操作都是一个字节长。

Just-In-Time (JIT) 编译器是运行时解释器的一个特性，它不是每次调用方法时都解释字节码，而是将字节码编译成运行机器的机器代码指令，然后调用它而是目标代码。理想情况下，运行目标代码的效率将克服每次运行时重新编译程序的低效率。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2013-04-29T08:55:11.847

JIT-及时这个词本身说什么时候需要（按需）

## 典型场景：

源代码完全转化为机器码

## JIT 场景：

源代码将被转换为类似结构的汇编语言 [for ex IL (intermediate language) for C#, ByteCode for java]。

只有当应用程序需要将所需代码转换为机器代码时，才将中间代码转换为机器语言。

## JIT 与非 JIT 比较：

*   在 JIT 中，并非所有代码都首先转换为机器代码，一部分必要的代码将被转换为机器代码，然后如果调用的方法或功能不在机器中，那么它将被转换为机器代码......它减少了CPU 的负担。

*   由于机器代码将在运行时生成...... JIT 编译器将生成针对运行机器的 CPU 架构进行优化的机器代码。

## JIT 示例：

1.  在 Java 中 JIT 在 JVM（Java 虚拟机）中
2.  在 C# 中，它位于 CLR（公共语言运行时）中
3.  在 Android 中，它位于 DVM（Dalvik 虚拟机）或较新版本的 ART（Android 运行时）中。

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2013-12-10T13:20:45.473

正如其他人提到的

**JIT 代表 Just-in-Time，这意味着代码在需要时被编译，而不是在运行时之前。**

只是为了在上面的讨论中添加一点，JVM 维护一个函数执行多少次的计数。如果这个计数超过预定义的限制，JIT 将代码编译成可以直接由处理器执行的机器语言（与 javac 将代码编译成字节码然后 java - 解释器逐行解释这个字节码将其转换为机器代码并执行）。

同样，下次计算此函数时，将再次执行相同的编译代码，这与正常解释不同，其中代码再次逐行解释。这使得执行速度更快。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2018-01-19T04:37:11.647

JIT 编译器仅在第一次执行时将字节码编译为等效的本机代码。在每次连续执行时，JVM 仅使用已编译的本机代码来优化性能。

[![在此处输入图像描述](https://i.stack.imgur.com/hSTYc.png)](https://i.stack.imgur.com/hSTYc.png)

如果没有 JIT 编译器，JVM 解释器会逐行翻译字节码，使其看起来好像正在执行本机应用程序。

[![在此处输入图像描述](https://i.stack.imgur.com/5sZie.png)](https://i.stack.imgur.com/5sZie.png)

[来源](https://en.wikibooks.org/wiki/Java_Programming/The_Java_Platform)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-09-18T19:00:45.770

JIT 代表 Just-in-Time，这意味着代码在需要时被编译，而不是在运行时之前。

这是有益的，因为编译器可以生成针对您的特定机器优化的代码。静态编译器，就像您的普通 C 编译器一样，会将所有代码编译为开发人员机器上的可执行代码。因此，编译器将根据一些假设执行优化。它可以更慢地编译并进行更多优化，因为它不会减慢用户程序的执行速度。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-08-10T08:46:09.190

在 Java 编译器生成字节码（与体系结构无关）后，将由 JVM（在 Java 中）处理执行。字节码将由加载器加载到 JVM 中，然后解释每个字节指令。

当我们需要多次调用一个方法时，我们需要多次解释相同的代码，这可能会花费比需要更多的时间。所以我们有 JIT（即时）编译器。当字节被加载到 JVM（它的运行时）时，整个代码将被编译而不是解释，从而节省时间。

JIT 编译器只在运行时工作，所以我们没有任何二进制输出。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-02-27T02:25:02.827

**即时编译器（JIT）：**
它将java字节码编译成特定CPU的机器指令。

例如，如果我们的 java 代码中有一个循环语句：

```
while(i<10){
    // ...
    a=a+i;
    // ...
 } 
```

如果 i 的值为 0，则上述循环代码运行 10 次。

没有必要一次又一次地编译字节码 10 次，因为同一条指令将执行 10 次。在这种情况下，只需要编译该代码一次，并且可以将值更改为所需的次数。因此，即时 (JIT) 编译器会跟踪此类语句和方法（如前所述），并将此类字节码编译成机器码以获得更好的性能。

另一个类似的例子是在字符串/句子列表中使用“正则表达式”搜索模式。

JIT Compiler 不会将所有代码编译为机器码。它在运行时编译具有相似模式的代码。

请参阅[有关了解 JIT 的 Oracle 文档以了解](https://docs.oracle.com/cd/E15289_01/doc.40/e15058/underst_jit.htm)更多信息。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-09-26T17:15:11.690

即时编译器 (JIT) 是一种软件，它接收不可执行的输入并返回要执行的适当机器代码。例如：

```
Intermediate representation    JIT    Native machine code for the current CPU architecture

     Java bytecode            --->        machine code
     Javascript (run with V8) --->        machine code 
```

这样做的结果是，对于特定的 CPU 架构，必须安装适当的 JIT 编译器。

## 差异编译器、解释器和 JIT

虽然当我们想要将源代码转换为机器代码时通常会有例外，但我们可以使用：

1.  **编译器**：获取源代码并返回可执行文件
2.  **解释器**：逐条执行程序。它获取源代码的一个可执行段并将该段转换为机器指令。重复此过程，直到所有源代码都转换为机器指令并执行。
3.  **JIT**：JIT 的许多不同实现是可能的，但是 JIT 通常是编译器和解释器的组合。JIT 首先通过解释将其接收到的中间数据（例如 Java 字节码）转换为机器语言。JIT 通常可以测量代码的某个部分何时经常执行，并将编译该部分以更快地执行。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-18T18:56:06.780

您有编译成某种 IL（中间语言）的代码。当您运行程序时，计算机不理解此代码。它只理解本机代码。因此，JIT 编译器会即时将您的 IL 编译为本机代码。它在方法级别执行此操作。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-03-21T13:36:55.570

我知道这是一个旧线程，但运行时优化是 JIT 编译的另一个重要部分，这里似乎没有讨论。基本上，JIT 编译器可以在程序运行时对其进行监控，以确定改进执行的方法。然后，它可以在运行时即时进行这些更改。谷歌 JIT 优化（javaworld 有[一篇关于它的不错的文章。](http://www.javaworld.com/article/2078623/core-java/jvm-performance-optimization--part-1--a-jvm-technology-primer.html)）

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-04-16T06:41:06.923

Jit 代表即时编译器 jit 是一个程序，可以将 java 字节码转换为可以直接发送到处理器的指令。

在特定系统平台使用java即时编译器（实际上是第二编译器）将字节码编译成特定的系统代码，一旦代码被jit编译器重新编译，它通常会在计算机中运行得更快。

即时编译器随虚拟机一起提供，可供选择使用。它将字节码编译成平台特定的可执行代码，立即执行。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-04-06T09:44:52.233

即时 (JIT) 编译（也称为动态翻译或运行时编译）是一种**执行计算机代码**的方式，**涉及在程序执行期间**（在运行时）**而不是在执行之前进行**编译。

IT 编译是两种传统的机器代码翻译方法的**组合——****提前编译 (AOT)**和**解释**——并结合了两者的一些优点和缺点。*JIT 编译结合了编译代码的速度和解释的灵活性*。

让我们考虑一下 JVM 中使用的 JIT，

例如，HotSpot JVM JIT 编译器生成动态优化。换句话说，它们在 Java 应用程序运行时做出优化决策，并生成针对底层系统架构**的高性能本机机器指令。**

选择用于编译的方法时，JVM将其字节码馈送到正常编译器（JIT）。JIT 需要理解字节码的语义和语法才能正确编译方法。为了帮助 JIT 编译器分析该方法，首先将其字节码重新表述为称为跟踪树的内部表示，它更类似于机器码而不是字节码。然后对该方法的树进行分析和优化。最后，树被翻译成本地代码。

> 跟踪树是在编程代码的运行时编译中使用的数据结构。跟踪树用于一种“即时编译器”，它跟踪热点期间执行的代码并对其进行编译。参考[这个](https://en.wikipedia.org/wiki/Trace_tree)。

参考 ：

*   [http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html](http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html)
*   [https://en.wikipedia.org/wiki/Just-in-time_compilation](https://en.wikipedia.org/wiki/Just-in-time_compilation)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-18T19:08:48.247

非 JIT 编译器获取源代码并在编译时将其转换为机器特定的字节码。JIT 编译器获取在编译时生成的与机器无关的字节码，并在运行时将其转换为机器特定的字节码。Java 使用的 JIT 编译器允许单个二进制文件无需修改即可在多个平台上运行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-07-06T10:12:11.003

80% 的时间使用了 20% 的字节码。JIT 编译器获取这些统计信息并通过添加内联方法、删除未使用的锁等以及创建特定于该机器的字节码来优化这 20% 的字节码以更快地运行。我引用这篇文章，我发现它很方便。[http://java.dzone.com/articles/just-time-compiler-jit-hotspot](http://java.dzone.com/articles/just-time-compiler-jit-hotspot)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-22T09:56:58.333

Just In Time 编译器也称为 JIT 编译器，用于提高 Java 的性能。默认情况下启用。它是在执行时更早完成的编译。Java 通过将 JIT 编译器包含在 JVM 中而普及了 JIT 编译器的使用。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2014-11-03T13:08:12.507

JIT 指的是少数 JVM 实现中的执行引擎，一种速度更快但需要更多内存的执行引擎，是一种即时编译器。在此方案中，方法的字节码在第一次调用该方法时被编译为本机机器码。然后缓存该方法的本机机器代码，以便下次调用相同的方法时可以重新使用它。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2015-12-13T05:21:35.177

出于性能原因，JVM 实际上会在运行时执行编译步骤。这意味着 Java 没有干净的编译执行分离。它首先进行所谓的从 Java 源代码到字节码的静态编译。然后这个字节码被传递给 JVM 执行。但是执行字节码很慢，因此 JVM 测量字节码运行的频率，当它检测到运行非常频繁的代码“热点”时，它会执行从字节码到“热点”代码的机器码的动态编译（热点分析器）。今天，Java 程序如此有效地通过机器代码执行来运行。

# python - 应用程序范围的异常处理程序有意义吗？

> ID：95642
> 
> 赞同：12
> 
> 时间：2008-09-18T18:52:30.920
> 
> 标签：python, exception-handling

长话短说，我有一个大量的 Python 应用程序，除其他外，它在 Linux 上调用“losetup”、“mount”等。本质上是消耗完成后必须释放的系统资源。

如果我的应用程序崩溃，我想确保正确释放这些系统资源。

执行以下操作是否有意义？

```
def main():
    # TODO: main application entry point
    pass

def cleanup():
    # TODO: release system resources here
    pass

if __name__ == "__main__":
    try:
        main()
    except:
        cleanup()
        raise 
```

这是通常做的事情吗？有没有更好的办法？也许是单例类中的析构函数？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-18T18:55:38.120

我喜欢一般的顶级异常处理程序（不管语言）。它们是清理资源的好地方，这些资源可能与引发异常的方法中消耗的资源没有直接关系。

如果您有这样的框架，它也是**记录**这些异常的好地方。顶级处理程序将捕获那些您没有计划的奇怪异常，并让您在将来更正它们，否则您可能根本不知道它们。

请注意您的顶级处理程序不会引发异常！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-18T18:56:07.933

析构函数（如在 __del__ 方法中）是一个坏主意，因为不能保证调用它们。atexit 模块是一种更安全的方法，尽管如果 Python 解释器崩溃（而不是 Python 应用程序），或者使用 os._exit()，或者进程被积极终止，或者机器重新启动，这些模块仍然不会触发。（当然，最后一项在您的情况下不是问题。）如果您的进程容易崩溃（例如，它使用变化无常的第三方扩展模块），您可能希望在一个简单的父进程中进行清理更多的隔离。

如果您并不担心，请使用 atexit 模块。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T18:54:18.623

应用程序范围的处理程序很好。它们非常适合记录。只要确保应用程序范围内的应用程序是耐用的并且不太可能自行崩溃。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T23:45:15.290

如果你使用类，你当然应该释放它们在析构函数中分配的资源。在整个应用程序上使用 try: 只是为了释放尚未被类的析构函数释放的资源。

而不是使用包罗万象的 except:，您应该使用以下块：

```
try:
    main()
finally:
    cleanup() 
```

这将确保以更 Pythonic 的方式进行清理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T18:56:44.717

这似乎是一种合理的方法，并且比单例类的析构函数更直接和可靠。您还可以查看“ [atexit](http://docs.python.org/lib/module-atexit.html) ”模块。（发音为“at exit”，而不是“a tex it”或类似的东西。我混淆了很长时间。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T10:26:25.297

考虑编写上下文管理器并使用 with 语句。

# multithreading - 我什么时候应该考虑更改线程优先级

> ID：95649
> 
> 赞同：7
> 
> 时间：2008-09-18T18:53:05.820
> 
> 标签：multithreading, language-agnostic

我曾经被要求提高线程优先级来解决问题。我拒绝了，说改变它是危险的，不是问题的根本原因。

我的问题是，在什么情况下我*应该*考虑改变线程的优先级？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T19:00:18.500

当您列出您正在使用的线程并为它们定义优先级顺序时，这对于它们所做的工作来说是有意义的。

如果您在这里和那里轻推线程以摆脱问题，最终它们都将成为高优先级，而您又回到了开始的地方。不要假设您可以在确实需要锁定时通过优先级修复竞争条件，因为您很可能只在友好条件下修复了它。仍然可能存在失败的情况，例如当低优先级线程经历了优先级继承时，因为另一个高优先级线程正在等待它持有的另一个锁。

如果您按照“这些线程填充音频缓冲区”、“这些线程使我的应用程序响应系统事件”、“这些线程使我的应用程序响应用户”、“这些线程正在处理某些业务”来对线程进行分类并且会在它们准备好并准备好时报告”，那么应该相应地对线程进行优先级排序。

最后，它取决于操作系统。如果线程优先级完全次于进程优先级，那么优先考虑线程不应该是“危险的”：你唯一可以饿死 CPU 的就是你自己。但是，如果您的高优先级线程优先于其他不相关应用程序的正常优先级线程运行，那么您将承担更广泛的责任。您应该只提高执行少量紧急工作的线程的优先级。“小型”的定义取决于您使用的是哪种设备 - 使用 3GHz 多核处理器，您可以轻松应对，但移动设备可能具有用户级应用程序可能会破坏的伪实时预期。

但是，保持音频缓冲区服务是何时成为高优先级的典型示例，因为小的欠载通常会导致令人讨厌的噼啪声。长时间下载（或其他慢速 I/O）是何时成为低优先级的典型示例，因为如果下一个数据不会持续很长时间，则没有紧迫性处理这块数据。如果您曾经编写设备驱动程序，您将需要做出更复杂的决定，如何与其他人一起玩得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T18:56:15.203

不多。我唯一一次必须朝*积极*方向更改线程优先级是使用用户界面线程。UI 必须非常活泼，才能让应用程序感觉正确，所以很多时候最好优先考虑绘制线程而不是其他线程。例如，Swing Event Dispatch Thread 默认以优先级 6 运行（比默认值高 1）。

我确实将线程的优先级降低了很多。同样，这通常是为了在一些长时间运行的后台进程执行其操作时保持 UI 响应。但是，这有时也适用于轮询守护程序等，我*知道*我不想干扰任何事情，无论干扰多么小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:00:02.777

我们的应用程序使用后台线程来下载数据，我们不希望它干扰单核机器上的 UI 线程，因此我们故意将其优先级较低。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:01:22.117

我认为这取决于您正在考虑更改优先级的方向。

通常你不应该增加线程优先级，除非你有*很好*的理由。增加线程优先级可能会导致您的应用程序的线程开始占用其他应用程序的时间，这可能不是用户想要的。如果您的线程正在使用大量 CPU，则可能会使机器难以使用，因为某些标准 UI 线程可能会开始饿死。

我想说，您应该将优先级提高到高于正常水平的唯一情况是用户明确告诉您的应用这样做，但即便如此，您仍想阻止“无知”的用户这样做。也许如果您的应用程序通常不使用太多 CPU，但可能会短暂爆发非常重要的活动，那么提高优先级可能是可以的，因为它通常不会减损用户的一般体验。

降低优先级是另一回事。如果您的应用程序正在做一些占用大量 CPU 并运行很长时间但并不重要的事情，那么降低优先级可能会很好。通过降低优先级，您可以在需要时将 CPU 用于其他事情，这有助于保持系统快速响应。只要系统除了您的应用程序之外大部分时间处于空闲状态，您仍然可以获得大部分 CPU 时间，但不会占用比您更需要它的任务。这方面的一个例子是索引硬盘驱动器的线程（想想谷歌桌面）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T18:58:16.460

我会说，当您对线程的原始设计假设不再有效时。

线程优先级主要是关于什么工作最重要的设计决策。因此，对于何时重新考虑的一些示例：如果您添加可能需要其自己的线程变得更重要的新功能，则重新考虑线程优先级。如果某些要求发生变化，迫使您重新考虑正在做的工作的优先级，那么请重新考虑。或者，如果您进行性能测试并意识到设计中指定的“高优先级工作”没有获得所需的性能，则调整优先级。

否则，它通常是一个黑客。

# c# - 如何使用 oAuth 令牌

> ID：95651
> 
> 赞同：4
> 
> 时间：2008-09-18T18:53:25.990
> 
> 标签：c#, rest, oauth

我正在使用库来获取“oAuth_token”和“oAuth_token_secret”。

如果我向 REST Web 服务发出请求，如何利用这两个密钥来验证身份验证？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-18T21:12:00.993

提供 C# 示例有点困难，因为有许多变量，即正在使用的签名方法、服务可能期望的其他参数等，这会影响示例的复杂性。

我为 .Net 开发了一个开源[OAuth 库，](http://code.google.com/p/devdefined-tools/wiki/OAuth)并发布了一篇关于[开始使用 OAuth](http://blog.bittercoder.com/PermaLink,guid,83488336-290d-4c4b-a314-14fe255e5b4e.aspx)的文章，这可能有助于您入门 - 我试图找到一个开发人员页面/API 规范来访问 brightkite - 但因为它是一个测试版服务，我没有'无权访问-所以也许可以通过我的[博客](http://blog.bittercoder.com/)向我发布此服务的邀请，我可以尝试开发一个示例 Brightkite 客户端，此时可以使用一些对其他人有用的具体示例代码来重新访问此答案。

# state - 维持状态的方式比较

> ID：95655
> 
> 赞同：11
> 
> 时间：2008-09-18T18:54:00.090
> 
> 标签：state

有多种方法可以在 Web 开发中使用来维护用户状态。

我现在能想到的有这些：

1.  请求参数

2.  饼干

3.  表单方法（Get 和 Post）

4.  Viewstate（我猜只有 ASP.NET）

5.  会话（InProc Web 服务器）

6.  会话（专用网络服务器）

7.  会话（数据库）

8.  本地持久性（Google Gears）（感谢 Steve Moyer）等。

我知道每种方法都有自己的优点和缺点，比如 cookie 不安全，QueryString 有长度限制，而且看起来很丑！;)

但是，在设计 Web 应用程序时，我总是对为什么应用程序使用什么方法或要避免什么方法感到困惑。

我想知道的是您通常使用哪些方法，并且会推荐或更有趣的是您希望在某些情况下避免使用哪些方法，为什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-18T19:09:31.583

虽然这是一个非常复杂的问题要回答，但在考虑实现状态时，我会考虑一些简单的事情。

*   查询字符串状态仅对最基本的任务有用——例如，维护用户在向导中的位置，或者提供在用户完成给定任务（例如，登录）后将其重定向到的路径。否则，查询字符串状态非常不安全，难以实现，并且为了公正起见，它需要通过包含一个密钥来将客户端绑定到服务器为该客户端维护的状态，从而将其绑定到某些服务器端状态机。
*   Cookie 状态或多或少是相同的——它只是比查询字符串状态更漂亮。但它仍然完全在客户端维护，除非 cookie 中的数据是将客户端与某些服务器端状态机联系起来的关键。
*   表单方法状态再次相似——它对于隐藏将给定表单与后端的一些数据相关联的字段很有用（例如，“这个用户正在编辑记录#512，所以表单将包含一个隐藏的输入值512”）。它在其他方面没有什么用处，同样，它只是查询字符串和 cookie 状态背后相同想法的另一种实现。
*   会话状态（您描述的任何方式）都很棒，因为它们可以无限扩展并且可以处理您选择的编程语言可以处理的任何事情。第一个警告是客户端需要有一个密钥来将该客户端与其存储在服务器上的状态联系起来；这是大多数 Web 框架向客户端提供基于 cookie 或基于查询字符串的密钥的地方。（几乎每个现代人都使用 cookie，但如果未启用 cookie，则使用查询字符串。）第二个警告是，您需要在存储状态的方式上添加一些内容……您会将其放入数据库？您的 Web 框架是否完全为您处理？再一次，大多数现代 Web 框架都可以解决这个问题，对于我来说要实现自己的状态机，我需要一个*非常*很好的理由......否则，我很可能会在任何成熟的框架中创建安全漏洞和功能破坏，这些漏洞已经随着时间的推移而被淘汰。

所以我想我真的无法想象除了最微不足道的原因之外不想使用基于会话的状态。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T19:14:34.707

安全也是一个问题；用户可以轻松更改查询字符串或表单字段中的值。用户身份验证应保存在加密或防篡改 cookie 或服务器端会话中。当用户完成一个过程（例如站点注册）时，跟踪表单中传递的值，这可能可以保存在隐藏的表单字段中。

不过，关于查询字符串的好处（有时也很危险）是，任何单击链接的人都可以获取该状态。如上所述，如果它给用户一些他们不应该拥有的授权，这是很危险的。不过，它可以向您的朋友展示您在网站上找到的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T19:06:56.613

随着越来越多地使用 Web 2.0，我认为您的列表中缺少两个重要的方法：

8 AJAX 应用程序 - 由于页面不会重新加载并且没有页面到页面导航，因此状态不是问题（但持久化用户数据必须使用异步 XML 调用）。

9 本地持久性 - 基于浏览器的应用程序可以使用 Google Gears 等库将其用户数据和状态持久化到本地硬盘驱动器。

至于哪个最好，我觉得各有千秋，但是Query String方式对于搜索引擎来说是有问题的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:03:44.997

就个人而言，由于我几乎所有的 Web 开发都是用 PHP 进行的，所以我使用 PHP 的会话处理程序。

以我的经验，会话是最灵活的：它们通常比数据库访问更快，并且它们生成的 cookie 在浏览器关闭时消失（默认情况下）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T19:16:55.950

如果您打算将您的网站托管在像 webhost4life 这样便宜且愉快的主机上，请避免使用 InProc。我已经了解到，由于他们的系统被过度订阅，他们**非常**频繁地回收应用程序，这会导致您的会话丢失。很烦人。

他们的建议是使用 StateServer 这很好，除非您必须序列化/反序列化会话 eash 回发。我喜欢对象，我的网络应用程序充满了它们。我担心切换到 StateServer 时的性能。我需要重构以仅将我真正需要的东西放入会话中。

希望我在开始之前就知道...

干杯，罗布。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T19:39:30.357

请注意您存储客户端的状态（查询字符串、表单字段、cookie）。任何与安全相关的东西都不应该存储在客户端，除非是会话标识符，如果它被合理地模糊且难以猜测的话。有太多的网站具有像“authenticated=true”这样的设置，并将这些设置存储在 cookie 或查询字符串或隐藏表单字段中。用户绕过类似的东西是微不足道的。请记住，来自客户端的任何输入都可能被篡改并且不应被信任。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T20:01:29.617

[当您需要获取数据时，已签名的 Cookie](http://code.google.com/p/django-signedcookies/)会链接到某种数据库存储。如果您有连接的后端，则没有理由在客户端存储数据；如果这是一个面向公众的网站，您只是在找麻烦。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T19:09:34.967

这不是使用什么和避免什么的问题，而是什么时候使用哪个。每个人在最好的情况下都有特定的情况，在最坏的情况下也有不同的情况。

决定因素通常是数据的生命周期。会话状态的寿命比表单字段长，依此类推。

# c# - .NET 属性生成“必须声明一个主体，因为它没有标记为抽象或外部”编译错误

> ID：95683
> 
> 赞同：12
> 
> 时间：2008-09-18T18:56:13.907
> 
> 标签：c#, properties, compilation

我有一个 .NET 3.5（目标框架）Web 应用程序。我有一些看起来像这样的代码：

```
public string LogPath { get; private set; }
public string ErrorMsg { get; private set; } 
```

它给了我这些行的编译错误：

```
"must declare a body because it is not marked abstract or extern." 
```

有任何想法吗？我的理解是，这种类型的属性在 .NET 3.0 中是有效的。

谢谢！

* * *

问题出在我的 .sln 文件本身。尽管我在构建选项中更改了目标版本，但在 .sln 文件中，我发现了这一点：

```
TargetFramework = "3.0" 
```

将其更改为“3.5”解决了它。多谢你们！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-07-16T21:28:59.887

添加到 web.config

```
<system.codedom>
    <compilers>
        <compiler language="c#;cs;csharp" extension=".cs" type="Microsoft.CSharp.CSharpCodeProvider,System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" warningLevel="4">
            <providerOption name="CompilerVersion" value="v3.5" />
            <providerOption name="WarnAsError" value="false" />
        </compiler>
    </compilers>
</system.codedom> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T19:07:23.117

您的代码是有效的 - 它应该可以正常工作。进入项目的属性页并确保“目标框架”是 .NET 3.0 或 3.5。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T19:02:07.747

语法有效。您可以设置不同的访问修饰符。你不在一个接口上是吗？这些所在的类不是抽象的吗？

此外，您所针对的框架的 v. 无关紧要，因为这是**一个编译器功能**。VS2008 将为您实现带有后备存储的属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T18:59:20.593

你是对的; 这种风格是允许的。

我会查看引用的标准程序集。我不确定你需要哪个来编译它，但我想你是在指向 csc.exe 的 .Net v2.0 版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T19:10:32.093

该错误不应该来自您发布的代码。根据 MSDN，您做得对：http: [//msdn.microsoft.com/en-us/library/bb384054.aspx](http://msdn.microsoft.com/en-us/library/bb384054.aspx)

因此，我建议您重新检查错误消息，以及编译器说错误来自何处。您发布的消息文本不包含对属性的引用，并且函数也有类似的消息...任何缺少实现且不在接口上或标记为 abstract 或 extern 的内容都可能生成此错误。

自动属性是 C# 3.0 语言/编译器的一个特性。如果您使用的是 VS 2008，即使您的目标是 .NET 2.0，它也应该可以工作。我只是测试了它以确保。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-14T14:20:54.437

**如果您在 MyControl.ascx 中使用CodeFile** ="MyControl.ascx.cs" 而不是**CodeBehind** ="MyControl.ascx.cs"，也会发生此错误。

在**CodeFile**的情况下，2.0 编译器会尝试重新编译页面，即使您有一个 WebProject 而不是 WebSite，当然 - 确实会失败。

将属性名称更改为**CodeBehind**解决了我的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T19:04:29.677

你在哪里定义这个属性？直接在 as*x 文件中还是在 codeBehind 中？（我认为这不是一个原因，但如果 build-Target 是 .NET 3.5，我看不到其他任何东西）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-25T19:46:05.717

这也发生在没有生成 web.config 的原始网站项目上。

虽然解决方案文件说的是 3.5，但 .Net 需要 web.config 来声明它也能识别。我运行调试允许它创建一个 webconfig，并且一切正常。

所以它就像提供的答案一样，但只要确保你有一个。

* * *

## 回答 #9

> 赞同：-7
> 
> 时间：2008-09-18T18:59:04.510

是的，只要你把**抽象**放在前面，或者实现方法。

```
public abstract string LogPath { get; private set; }
public abstract string ErrorMsg { get; private set; } 
```

见[http://forums.asp.net/t/1031651.aspx](http://forums.asp.net/t/1031651.aspx)

# sql-server - VB.Net（或 C#）2008 多线程导入

> ID：95700
> 
> 赞同：2
> 
> 时间：2008-09-18T18:57:10.113
> 
> 标签：sql-server, vb.net, visual-studio, multithreading, import

我正在寻找构建一个多线程文本导入工具（通常是 CSV 到 SQL Server 2005），并希望在 VB.NET 中执行此操作，但我不反对 C#。我有 VS 2008 试用版，只是不知道从哪里开始。谁能指出我可以查看和使用 VS 2008 的*非常*简单的多线程应用程序的源代码的方向？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T18:59:32.510

这是一篇很棒的文章：

[http://www.devx.com/DevX/10MinuteSolution/20365](http://www.devx.com/DevX/10MinuteSolution/20365)

尤其：

```
Dim t As Thread
t = New Thread(AddressOf Me.BackgroundProcess)
t.Start()

Private Sub BackgroundProcess()
   Dim i As Integer = 1
   Do While True
        ListBox1.Items.Add("Iterations: " + i)
        i += 1
        Thread.CurrentThread.Sleep(2000)
   Loop
End Sub 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T03:53:10.937

引用的*DevX*文章来自 2001 年和 .Net Framework 1.1，但今天 .Net Framework 2.0 提供了[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker(VS.95).aspx)类。如果您的应用程序包含前台 UI 组件，这是推荐的线程类。

从[MSDN 线程和线程](http://msdn.microsoft.com/en-us/library/6kac2kdh.aspx)：

> 如果您需要运行与用户界面交互的后台线程，.NET Framework 2.0 版提供了一个使用事件进行通信的 BackgroundWorker 组件，并通过跨线程封送处理到用户界面线程。

这个来自[MSDN BackgroundWorker 类](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)的示例显示了一个后台任务、进度 % 和取消选项。（该示例比 DevX 示例更长，但功能更多。）

```
Imports System.ComponentModel

Partial Public Class Page
    Inherits UserControl
    Private bw As BackgroundWorker = New BackgroundWorker

    Public Sub New()
        InitializeComponent()

        bw.WorkerReportsProgress = True
        bw.WorkerSupportsCancellation = True
        AddHandler bw.DoWork, AddressOf bw_DoWork
        AddHandler bw.ProgressChanged, AddressOf bw_ProgressChanged
        AddHandler bw.RunWorkerCompleted, AddressOf bw_RunWorkerCompleted

    End Sub
    Private Sub buttonStart_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)
        If Not bw.IsBusy = True Then
            bw.RunWorkerAsync()
        End If
    End Sub
    Private Sub buttonCancel_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)
        If bw.WorkerSupportsCancellation = True Then
            bw.CancelAsync()
        End If
    End Sub
    Private Sub bw_DoWork(ByVal sender As Object, ByVal e As DoWorkEventArgs)
        Dim worker As BackgroundWorker = CType(sender, BackgroundWorker)

        For i = 1 To 10
            If bw.CancellationPending = True Then
                e.Cancel = True
                Exit For
            Else
                ' Perform a time consuming operation and report progress.
                System.Threading.Thread.Sleep(500)
                bw.ReportProgress(i * 10)
            End If
        Next
    End Sub
    Private Sub bw_RunWorkerCompleted(ByVal sender As Object, ByVal e As RunWorkerCompletedEventArgs)
        If e.Cancelled = True Then
            Me.tbProgress.Text = "Canceled!"
        ElseIf e.Error IsNot Nothing Then
            Me.tbProgress.Text = "Error: " & e.Error.Message
        Else
            Me.tbProgress.Text = "Done!"
        End If
    End Sub
    Private Sub bw_ProgressChanged(ByVal sender As Object, ByVal e As ProgressChangedEventArgs)
        Me.tbProgress.Text = e.ProgressPercentage.ToString() & "%"
    End Sub
End Class 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-14T12:47:42.783

关于我发现的最好的线程文档是这个[http://www.albahari.com/threading/](http://www.albahari.com/threading/)

如果可以的话，简单示例的问题在于它们通常过于简单。一旦您在后台演示中通过计数或排序，您通常需要更新 UI 或类似内容，并且有一些陷阱。同样，您很少需要在简单的示例中处理资源争用问题，并且当资源不可用时（例如 Db 连接）需要考虑让线程优雅地降级。

从概念上讲，您需要决定如何跨线程分配工作以及需要多少线程。管理线程会产生开销，并且某些机制使用共享线程池，这本身可能会受到资源争用的影响（例如，每当您运行一个仅显示空表单的程序时，您会在任务管理器下看到多少线程）。

因此，对于您的情况，您执行实际上传的线程需要在它们已完成、是否失败（以及失败原因）时发回信号。控制器需要能够处理这些并管理启动/停止过程等。

最后（几乎），假设制作多线程会提高性能并不总是正确的。例如，如果您将文件分割成多个段，但它必须通过低速链路（例如 ADSL）传输，那么您会受到外力的限制，并且再多的线程技巧也无法解决这个问题。这同样适用于数据库更新、Web 请求、任何涉及大量磁盘 i/o 的事情等等。

尽管如此，我不是末日的预言家。这里的参考资料足以帮助您实现您想要的，但请注意，线程看起来很复杂的原因之一是因为它可以:)

如果您想要比 BackgroundWorker/Threadpool 更多的控制，但又不想自己做所有事情，那么至少有两个非常好的免费线程库在这个地方敲门（Wintellect 和 PowerThreading）

干杯

西蒙

# firefox - What causes Firefox to make a GET request after submitting a form via the POST method?

> ID：95715
> 
> 赞同：3
> 
> 时间：2008-09-18T18:58:59.160
> 
> 标签：firefox

What causes Firefox to follow a POST request with a GET request when submitting a form via the POST method? The GET method is sent to the same url as the POST method but without the request parameters.

If you change the form method to GET, it will result in two identical GET requests.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T19:03:38.883

This is a bug in Firefox 3\. This happens when the response to the POST contains an image tag with an empty source attribute. eg `<img src=""/>`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T19:06:44.803

The URL POSTed to might be returning a Redirect -- that would cause a GET. This is commonly done so that the page can be refreshed without reposting.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T19:03:09.490

Probably there is some javascript involved. The form is submitted as a result of an onclick event in an anchor with: href="..." onclick="..form.submit()"

# asp.net - 从 asp classic 转换为 asp.net 的最简单方法是什么？

> ID：95724
> 
> 赞同：14
> 
> 时间：2008-09-18T18:59:45.380
> 
> 标签：asp.net, asp-classic

我是一名 .Net 开发人员，负责将经典的 asp 网站升级到 asp.net。该网站目前靠运气和泡泡糖运行，但没有足够的时间或金钱来阻止进展并进行全面重写。当然，我在升级时仍然需要能够提供新功能。

我应该使用什么策略来对 asp.net 进行平滑渐进的更改？我应该转换为单层 .net 解决方案，然后重构为适当的多层解决方案，还是应该现在设计我的业务和数据层？我应该直接升级到 3.5 还是直接升级到 1.1 并在之后升级到 2.0 或 3.5 更容易？

完全转换可能需要 3-5 个月。还有一些现有的 1.1 代码，这就是为什么我考虑使用它作为起点。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-19T18:12:06.820

不要扔掉你的代码！

这是您可能犯的最严重的错误（在大型代码库上）。请参阅[您不应该做的事情，第 1 部分](http://www.joelonsoftware.com/articles/fog0000000069.html)。

您已经在旧代码上投入了大量精力并解决了许多错误。把它扔掉是一个典型的开发人员错误（我已经做过很多次了）。它让你感觉“更好”，就像大扫除一样。但是您不需要购买新公寓和所有新家具来装备您的房子。你可以一次在一个房间里工作……也许有些事情只需要一个新的油漆工作。因此，这就是重构的用武之地。

对于您的应用程序中的新功能，[用 C# 编写它并从您的经典 ASP 中调用它](http://blog.danbartels.com/articles/322.aspx)。当你重写这个新代码时，你将被迫模块化。当您有时间时，也可以将部分旧代码重构为 C#，并随时解决错误。最终，您将使用所有新代码替换您的应用程序。

您也可以编写自己的编译器。我们很久以前为我们的经典 ASP 应用程序编写了一个，以允许我们输出 PHP。它叫做[芥末](http://www.joelonsoftware.com/items/2006/09/01b.html)，我认为这就是杰夫阿特伍德认为乔尔斯波尔斯基失控的原因。实际上，也许我们应该把它寄出去，然后你就可以使用它了。

它允许我们将整个代码库切换到 .NET 以用于下一个版本，同时只重写我们源代码的一小部分。也让很多人骂我们疯了，但是写一个编译器也没那么复杂，给了我们很大的灵活性。

此外，如果这是一个仅限内部的应用程序，请离开它。不要重写它——你是唯一的客户，如果你需要将它作为经典的 asp 运行，你可以满足这个要求。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-19T05:53:52.377

长期以来，我一直是一名经典的 asp 程序员，现在是一名 ASP.NET 开发人员，我会花时间在 2.0 框架中正确地构建它（如果你想要/需要这些功能，则为 3.5）。

在我的上一份工作中，我们有大量非常糟糕的经典 asp 应用程序，我们正在重建这些应用程序，“nuke and pave”方法是最成功的。使用现有的经典应用程序作为您的功能规范和线框，并以此为基础构建您的任务和技术规范。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:02:15.017

完整的转换/重写需要多长时间？它还取决于您如何构建原始项目。

我**可以**回答你应该从一开始就定位 v2.0（如果你想要/需要它的功能，则为 3.5）。没有必要让自己受制于框架的 1.1。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:04:19.397

试试这些链接

[从 ASP 迁移](http://msdn2.microsoft.com/en-us/asp.net/aa336573.aspx)

[主要考虑因素](http://msdn2.microsoft.com/en-us/library/Aa479019.aspx)

[将 ASP 转换为 ASP.NET](http://msdn2.microsoft.com/en-us/library/ms973813.aspx)

[ASP 到 ASP.NET 迁移指南](http://msdn2.microsoft.com/en-us/asp.net/aa336623.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:10:51.703

您可能想查看新的 ASP.NET MVC 框架。灵活性水平是惊人的，编码风格更类似于 ASP 经典方法，尽管教会和国家更好地分离。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T20:14:20.663

看看 Snitz 论坛 (www.snitz.com) - 他们目前在 ASP 中，但到 ASP.NET 的端口几乎完成了。这两个代码库都可供您查看，因此您可能会了解它是如何完成的以帮助您。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T20:55:54.713

我会避免使用 .NET 1.1，因为 Microsoft 将于 2008 年 10 月 14 日结束对 .NET Framework v 1.1 的支持。扩展支持将持续到 2013 年 10 月 8 日，但通常购买成本很高。任何错误或安全漏洞都不会得到解决，而是您的问题。

[http://support.microsoft.com/lifecycle/?LN=en-us&x=11&y=10&p1=1249](http://support.microsoft.com/lifecycle/?LN=en-us&x=11&y=10&p1=1249)

保罗

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T18:13:57.690

最简单的方法就是先跳起来。获取一些 asp.net 书籍并潜入视觉工作室。做例子，玩它，为自己构建一些有趣的东西。你会边做边学。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-16T10:21:34.793

我还致力于从经典 ASP 逐步迁移到 ASP.NET。我们的第一阶段是将一些常见的逻辑从 ASP 包含迁移到暴露给 COM Interop 的 .NET 程序集，以便经典 ASP 和 ASP.NET 都可以调用它们。我已经使用[ASPUnit](http://aspunit.sourceforge.net/)编写了一些测试来验证迁移到 .NET 程序集后的行为（具有更安全重构的额外好处）。一旦核心逻辑在 .NET 中，我们就可以开始在 ASP.NET 中创建新页面，并按照我们自己的节奏将单个 ASP 页面迁移到 ASP.NET。

我会推荐 .NET 2.0 或 3.5 而不是 1.1。ASP.NET MVC 看起来像是一个有吸引力的升级路径。

# algorithm - 如何将浮点数转换为人类可读的分数？

> ID：95727
> 
> 赞同：110
> 
> 时间：2008-09-18T19:00:09.140
> 
> 标签：algorithm, language-agnostic, numbers

假设我们有`0.33`，我们需要输出`1/3`。
如果有`0.4`，我们需要输出`2/5`。

这个想法是让它易于阅读，让用户理解“ **x 部分来自 y** ”作为理解数据的更好方式。

我知道百分比是一个很好的替代品，但我想知道是否有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-18T19:28:07.560

我发现 David Eppstein[找到给定实数 C 代码的有理逼近](http://www.ics.uci.edu/%7Eeppstein/numth/frap.c)正是您所要求的。它基于连分数理论，非常快速且相当紧凑。

我已经使用了针对特定分子和分母限制定制的版本。

```
/*
** find rational approximation to given real number
** David Eppstein / UC Irvine / 8 Aug 1993
**
** With corrections from Arno Formella, May 2008
**
** usage: a.out r d
**   r is real number to approx
**   d is the maximum denominator allowed
**
** based on the theory of continued fractions
** if x = a1 + 1/(a2 + 1/(a3 + 1/(a4 + ...)))
** then best approximation is found by truncating this series
** (with some adjustments in the last term).
**
** Note the fraction can be recovered as the first column of the matrix
**  ( a1 1 ) ( a2 1 ) ( a3 1 ) ...
**  ( 1  0 ) ( 1  0 ) ( 1  0 )
** Instead of keeping the sequence of continued fraction terms,
** we just keep the last partial product of these matrices.
*/

#include <stdio.h>

main(ac, av)
int ac;
char ** av;
{
    double atof();
    int atoi();
    void exit();

    long m[2][2];
    double x, startx;
    long maxden;
    long ai;

    /* read command line arguments */
    if (ac != 3) {
        fprintf(stderr, "usage: %s r d\n",av[0]);  // AF: argument missing
        exit(1);
    }
    startx = x = atof(av[1]);
    maxden = atoi(av[2]);

    /* initialize matrix */
    m[0][0] = m[1][1] = 1;
    m[0][1] = m[1][0] = 0;

    /* loop finding terms until denom gets too big */
    while (m[1][0] *  ( ai = (long)x ) + m[1][1] <= maxden) {
        long t;
        t = m[0][0] * ai + m[0][1];
        m[0][1] = m[0][0];
        m[0][0] = t;
        t = m[1][0] * ai + m[1][1];
        m[1][1] = m[1][0];
        m[1][0] = t;
        if(x==(double)ai) break;     // AF: division by zero
        x = 1/(x - (double) ai);
        if(x>(double)0x7FFFFFFF) break;  // AF: representation failure
    } 

    /* now remaining x is between 0 and 1/ai */
    /* approx as either 0 or 1/m where m is max that will fit in maxden */
    /* first try zero */
    printf("%ld/%ld, error = %e\n", m[0][0], m[1][0],
           startx - ((double) m[0][0] / (double) m[1][0]));

    /* now try other possibility */
    ai = (maxden - m[1][1]) / m[1][0];
    m[0][0] = m[0][0] * ai + m[0][1];
    m[1][0] = m[1][0] * ai + m[1][1];
    printf("%ld/%ld, error = %e\n", m[0][0], m[1][0],
           startx - ((double) m[0][0] / (double) m[1][0]));
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2010-01-02T19:16:41.337

从 Python 2.6 开始就有这个[`fractions`](http://docs.python.org/library/fractions.html)模块。

（引用自文档。）

```
>>> from fractions import Fraction
>>> Fraction('3.1415926535897932').limit_denominator(1000)
Fraction(355, 113)

>>> from math import pi, cos
>>> Fraction.from_float(cos(pi/3))
Fraction(4503599627370497, 9007199254740992)
>>> Fraction.from_float(cos(pi/3)).limit_denominator()
Fraction(1, 2) 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-09-18T21:46:51.673

如果输出是为了让人类读者对结果的顺序有一个快速的印象，那么返回“113/211”之类的东西是没有意义的，所以输出应该限制自己使用一位数字（可能是 1/ 10 和 9/10）。如果是这样，您可以观察到只有 27*个不同的*分数。

由于生成输出的基础数学永远不会改变，解决方案可能是简单地对二叉搜索树进行硬编码，以便该函数最多执行 log(27) ~= 4 3/4 比较。这是代码的经过测试的 C 版本

```
char *userTextForDouble(double d, char *rval)
{
    if (d == 0.0)
        return "0";

    // TODO: negative numbers:if (d < 0.0)...
    if (d >= 1.0)
        sprintf(rval, "%.0f ", floor(d));
    d = d-floor(d); // now only the fractional part is left

    if (d == 0.0)
        return rval;

    if( d < 0.47 )
    {
        if( d < 0.25 )
        {
            if( d < 0.16 )
            {
                if( d < 0.12 ) // Note: fixed from .13
                {
                    if( d < 0.11 )
                        strcat(rval, "1/10"); // .1
                    else
                        strcat(rval, "1/9"); // .1111....
                }
                else // d >= .12
                {
                    if( d < 0.14 )
                        strcat(rval, "1/8"); // .125
                    else
                        strcat(rval, "1/7"); // .1428...
                }
            }
            else // d >= .16
            {
                if( d < 0.19 )
                {
                    strcat(rval, "1/6"); // .1666...
                }
                else // d > .19
                {
                    if( d < 0.22 )
                        strcat(rval, "1/5"); // .2
                    else
                        strcat(rval, "2/9"); // .2222...
                }
            }
        }
        else // d >= .25
        {
            if( d < 0.37 ) // Note: fixed from .38
            {
                if( d < 0.28 ) // Note: fixed from .29
                {
                    strcat(rval, "1/4"); // .25
                }
                else // d >=.28
                {
                    if( d < 0.31 )
                        strcat(rval, "2/7"); // .2857...
                    else
                        strcat(rval, "1/3"); // .3333...
                }
            }
            else // d >= .37
            {
                if( d < 0.42 ) // Note: fixed from .43
                {
                    if( d < 0.40 )
                        strcat(rval, "3/8"); // .375
                    else
                        strcat(rval, "2/5"); // .4
                }
                else // d >= .42
                {
                    if( d < 0.44 )
                        strcat(rval, "3/7"); // .4285...
                    else
                        strcat(rval, "4/9"); // .4444...
                }
            }
        }
    }
    else
    {
        if( d < 0.71 )
        {
            if( d < 0.60 )
            {
                if( d < 0.55 ) // Note: fixed from .56
                {
                    strcat(rval, "1/2"); // .5
                }
                else // d >= .55
                {
                    if( d < 0.57 )
                        strcat(rval, "5/9"); // .5555...
                    else
                        strcat(rval, "4/7"); // .5714
                }
            }
            else // d >= .6
            {
                if( d < 0.62 ) // Note: Fixed from .63
                {
                    strcat(rval, "3/5"); // .6
                }
                else // d >= .62
                {
                    if( d < 0.66 )
                        strcat(rval, "5/8"); // .625
                    else
                        strcat(rval, "2/3"); // .6666...
                }
            }
        }
        else
        {
            if( d < 0.80 )
            {
                if( d < 0.74 )
                {
                    strcat(rval, "5/7"); // .7142...
                }
                else // d >= .74
                {
                    if(d < 0.77 ) // Note: fixed from .78
                        strcat(rval, "3/4"); // .75
                    else
                        strcat(rval, "7/9"); // .7777...
                }
            }
            else // d >= .8
            {
                if( d < 0.85 ) // Note: fixed from .86
                {
                    if( d < 0.83 )
                        strcat(rval, "4/5"); // .8
                    else
                        strcat(rval, "5/6"); // .8333...
                }
                else // d >= .85
                {
                    if( d < 0.87 ) // Note: fixed from .88
                    {
                        strcat(rval, "6/7"); // .8571
                    }
                    else // d >= .87
                    {
                        if( d < 0.88 ) // Note: fixed from .89
                        {
                            strcat(rval, "7/8"); // .875
                        }
                        else // d >= .88
                        {
                            if( d < 0.90 )
                                strcat(rval, "8/9"); // .8888...
                            else
                                strcat(rval, "9/10"); // .9
                        }
                    }
                }
            }
        }
    }

    return rval;
} 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-09-18T19:06:03.167

这是一个链接，解释了将小数转换为分数背后的数学：

[http://www.webmath.com/dec2fract.html](http://www.webmath.com/dec2fract.html)

这是一个示例函数，说明如何使用 VB 实际执行此操作（来自[www.freevbcode.com/ShowCode.asp?ID=582](http://www.freevbcode.com/ShowCode.asp?ID=582)）：

```
Public Function Dec2Frac(ByVal f As Double) As String

   Dim df As Double
   Dim lUpperPart As Long
   Dim lLowerPart As Long

   lUpperPart = 1
   lLowerPart = 1

   df = lUpperPart / lLowerPart
   While (df <> f)
      If (df < f) Then
         lUpperPart = lUpperPart + 1
      Else
         lLowerPart = lLowerPart + 1
         lUpperPart = f * lLowerPart
      End If
      df = lUpperPart / lLowerPart
   Wend
Dec2Frac = CStr(lUpperPart) & "/" & CStr(lLowerPart)
End Function 
```

（来自谷歌搜索：将小数转换为分数，将小数转换为分数代码）

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-18T19:05:20.843

您可能想阅读[关于浮点运算的每位计算机科学家都应该了解的内容](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)。

您必须通过乘以一个大数来指定一些精度：

```
3.141592 * 1000000 = 3141592 
```

那么你可以做一个分数：

```
3 + (141592 / 1000000) 
```

并通过 GCD 减少...

```
3 + (17699 / 125000) 
```

但没有办法得到*预期*的分数。您可能希望*始终*在整个代码中使用分数——只要记住尽可能减少分数以避免溢出！

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-25T13:17:00.940

以下是 devinmoore 建议的 VB 代码的 Perl 和 Javascript 版本：

珀尔：

```
sub dec2frac {
    my $d = shift;

    my $df  = 1;
    my $top = 1;
    my $bot = 1;

    while ($df != $d) {
      if ($df < $d) {
        $top += 1;
      }
      else {
         $bot += 1;
         $top = int($d * $bot);
      }
      $df = $top / $bot;
   }
   return "$top/$bot";
} 
```

和几乎相同的javascript：

```
function dec2frac(d) {

    var df = 1;
    var top = 1;
    var bot = 1;

    while (df != d) {
        if (df < d) {
            top += 1;
        }
        else {
            bot += 1;
            top = parseInt(d * bot);
        }
        df = top / bot;
    }
    return top + '/' + bot;
}

//Put in your test number here:
var floatNumber = 2.56;
alert(floatNumber + " = " + dec2frac(floatNumber));
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-12-21T02:07:27.877

AC# 实现

```
/// <summary>
/// Represents a rational number
/// </summary>
public struct Fraction
{
    public int Numerator;
    public int Denominator;

    /// <summary>
    /// Constructor
    /// </summary>
    public Fraction(int numerator, int denominator)
    {
        this.Numerator = numerator;
        this.Denominator = denominator;
    }

    /// <summary>
    /// Approximates a fraction from the provided double
    /// </summary>
    public static Fraction Parse(double d)
    {
        return ApproximateFraction(d);
    }

    /// <summary>
    /// Returns this fraction expressed as a double, rounded to the specified number of decimal places.
    /// Returns double.NaN if denominator is zero
    /// </summary>
    public double ToDouble(int decimalPlaces)
    {
        if (this.Denominator == 0)
            return double.NaN;

        return System.Math.Round(
            Numerator / (double)Denominator,
            decimalPlaces
        );
    }

    /// <summary>
    /// Approximates the provided value to a fraction.
    /// http://stackoverflow.com/questions/95727/how-to-convert-floats-to-human-readable-fractions
    /// </summary>
    private static Fraction ApproximateFraction(double value)
    {
        const double EPSILON = .000001d;

        int n = 1;  // numerator
        int d = 1;  // denominator
        double fraction = n / d;

        while (System.Math.Abs(fraction - value) > EPSILON)
        {
            if (fraction < value)
            {
                n++;
            }
            else
            {
                d++;
                n = (int)System.Math.Round(value * d);
            }

            fraction = n / (double)d;
        }

        return new Fraction(n, d);
    }
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-19T02:27:50.157

[Stern-Brocot 树](http://en.wikipedia.org/wiki/Stern-Brocot_tree)引入了一种相当自然的方法来用简单分母的分数来近似实数。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-18T19:06:34.430

部分问题在于，如此多的分数实际上并不容易被解释为分数。例如，0.33 不是 1/3，而是 33/100。但是如果你记得你的小学培训，那么有一个将十进制值转换为分数的过程，但是它不太可能给你你想要的，因为大多数时候十进制数不是存储在 0.33，而是 0.329999999999998 之类的。

帮自己一个忙，不要为此烦恼，但如果需要，您可以执行以下操作：

将原始值乘以 10，直到删除小数部分。保留该数字，并将其用作除数。然后通过寻找共同点进行一系列简化。

所以 0.4 就是 4/10。然后，您将寻找从低值开始的公约数，可能是素数。从 2 开始，您将通过检查除法的下限是否与除法本身相同来查看 2 是否将分子和分母均分。

```
floor(5/2) = 2
5/2 = 2.5 
```

所以 5 不能平分 2。然后你检查下一个数字，比如 3。你这样做直到你达到或高于较小数字的平方根。

在你这样做之后，你需要

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-08-25T22:44:26.587

这不是一个“算法”，只是一个 Python 解决方案： http: [//docs.python.org/library/fractions.html](http://docs.python.org/library/fractions.html)

```
>>> from fractions import Fraction
>>> Fraction('3.1415926535897932').limit_denominator(1000)
Fraction(355, 113) 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-18T19:11:09.847

“假设我们有 0.33，我们需要输出“1/3”。”

您期望“解决方案”具有什么精度？0.33 不等于 1/3。您如何识别“好”（易于阅读）的答案？

无论如何，一个可能的算法可能是：

如果您希望找到 X/Y 形式中 Y 小于 10 的最接近的分数，那么您可以循环遍历所有 9 个可能的 Y，为每个 Y 计算 X，然后选择最准确的一个。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-18T19:13:35.113

您可以使用以下步骤在任何编程语言中执行此操作：

1.  乘除以 10^x，其中 x 是 10 的幂，以确保该数字没有剩余的小数位。示例：将 0.33 乘以 10^2 = 100 得到 33，再除以 33/100
2.  通过因式分解减少结果分数的分子和分母，直到您不能再从结果中获得整数。
3.  由此产生的减少分数应该是你的答案。

示例：0.2 =0.2 x 10^1/10^1 =2/10 =1/5

所以，这可以读作“五分之一”

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-12-29T20:09:00.747

R中的内置解决方案：

```
library(MASS)
fractions(0.666666666)
## [1] 2/3 
```

这使用连分数方法，并具有用于调整精度的可选参数`cycles`和参数。`max.denominator`

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-18T19:07:34.067

您必须弄清楚您愿意接受的错误级别。并不是所有的小数都会化简为简单的分数。我可能会选择一个容易整除的数字，例如 60，并找出最接近该值的 60 分之一，然后简化分数。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-18T22:16:10.980

一种解决方案是首先将所有数字存储为有理数。有理数算术库（例如[GMP](http://gmplib.org/)）。如果使用 OO 语言，您可以只使用有理数类库来替换您的数类。

除其他外，财务程序将使用这样的解决方案来进行精确计算并保持使用普通浮点数可能会丢失的精度。

当然，它会慢很多，所以对你来说可能不实用。取决于您需要进行多少计算，以及精度对您来说有多重要。

```
a = rational(1);
b = rational(3);
c = a / b;

print (c.asFraction)  --->  "1/3"
print (c.asFloat) ----> "0.333333" 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-09-17T19:35:07.297

我认为最好的方法是首先将您的浮点值转换为 ascii 表示。在 C++ 中，您可以使用`ostringstream`或在 C 中，您可以使用`sprintf`. 下面是它在 C++ 中的样子：

```
ostringstream oss;
float num;
cin >> num;
oss << num;
string numStr = oss.str();
int i = numStr.length(), pow_ten = 0;
while (i > 0) {
    if (numStr[i] == '.')
        break;
    pow_ten++;
    i--;
}
for (int j = 1; j < pow_ten; j++) {
    num *= 10.0;
}
cout << static_cast<int>(num) << "/" << pow(10, pow_ten - 1) << endl; 
```

可以在直接 C 中采用类似的方法。

之后，您需要检查分数是否为最低值。该算法将给出精确的答案，即 0.33 将输出“33/100”，而不是“1/3”。但是，0.4 将给出“4/10”，当减少到最低项时将是“2/5”。这可能不如 EppStein 的解决方案强大，但我相信这更直接。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-09-24T12:17:33.567

> 假设我们有 0.33，我们需要输出“1/3”。如果我们有“0.4”，我们需要输出“2/5”。

通常情况下是错误的，因为 1/3 = 0.3333333 = 0.(3) 此外，从上面建议的解决方案中不可能找出十进制可以转换为具有定义精度的分数，因为输出始终是分数。

但是，我建议我的综合函数有许多基于[无限几何级数](http://en.wikipedia.org/wiki/Geometric_progression#Infinite_geometric_series)的想法，特别是公式：

![在此处输入图像描述](https://i.stack.imgur.com/S6jaC.png)

起初，这个函数试图在字符串表示中找到分数的周期。之后应用上述公式。

有理数代码是从[Stephen M. McKamey](http://exif-utils.googlecode.com/svn/trunk/ExifUtils/ExifUtils/Rational.cs) C# 中的有理数实现中借用的。我希望将我的代码移植到其他语言上并不难。

```
/// <summary>
/// Convert decimal to fraction
/// </summary>
/// <param name="value">decimal value to convert</param>
/// <param name="result">result fraction if conversation is succsess</param>
/// <param name="decimalPlaces">precision of considereation frac part of value</param>
/// <param name="trimZeroes">trim zeroes on the right part of the value or not</param>
/// <param name="minPeriodRepeat">minimum period repeating</param>
/// <param name="digitsForReal">precision for determination value to real if period has not been founded</param>
/// <returns></returns>
public static bool FromDecimal(decimal value, out Rational<T> result, 
    int decimalPlaces = 28, bool trimZeroes = false, decimal minPeriodRepeat = 2, int digitsForReal = 9)
{
    var valueStr = value.ToString("0.0000000000000000000000000000", CultureInfo.InvariantCulture);
    var strs = valueStr.Split('.');

    long intPart = long.Parse(strs[0]);
    string fracPartTrimEnd = strs[1].TrimEnd(new char[] { '0' });
    string fracPart;

    if (trimZeroes)
    {
        fracPart = fracPartTrimEnd;
        decimalPlaces = Math.Min(decimalPlaces, fracPart.Length);
    }
    else
        fracPart = strs[1];

    result = new Rational<T>();
    try
    {
        string periodPart;
        bool periodFound = false;

        int i;
        for (i = 0; i < fracPart.Length; i++)
        {
            if (fracPart[i] == '0' && i != 0)
                continue;

            for (int j = i + 1; j < fracPart.Length; j++)
            {
                periodPart = fracPart.Substring(i, j - i);
                periodFound = true;
                decimal periodRepeat = 1;
                decimal periodStep = 1.0m / periodPart.Length;
                var upperBound = Math.Min(fracPart.Length, decimalPlaces);
                int k;
                for (k = i + periodPart.Length; k < upperBound; k += 1)
                {
                    if (periodPart[(k - i) % periodPart.Length] != fracPart[k])
                    {
                        periodFound = false;
                        break;
                    }
                    periodRepeat += periodStep;
                }

                if (!periodFound && upperBound - k <= periodPart.Length && periodPart[(upperBound - i) % periodPart.Length] > '5')
                {
                    var ind = (k - i) % periodPart.Length;
                    var regroupedPeriod = (periodPart.Substring(ind) + periodPart.Remove(ind)).Substring(0, upperBound - k);
                    ulong periodTailPlusOne = ulong.Parse(regroupedPeriod) + 1;
                    ulong fracTail = ulong.Parse(fracPart.Substring(k, regroupedPeriod.Length));
                    if (periodTailPlusOne == fracTail)
                        periodFound = true;
                }

                if (periodFound && periodRepeat >= minPeriodRepeat)
                {
                    result = FromDecimal(strs[0], fracPart.Substring(0, i), periodPart);
                    break;
                }
                else
                    periodFound = false;
            }

            if (periodFound)
                break;
        }

        if (!periodFound)
        {
            if (fracPartTrimEnd.Length >= digitsForReal)
                return false;
            else
            {
                result = new Rational<T>(long.Parse(strs[0]), 1, false);
                if (fracPartTrimEnd.Length != 0)
                    result = new Rational<T>(ulong.Parse(fracPartTrimEnd), TenInPower(fracPartTrimEnd.Length));
                return true;
            }
        }

        return true;
    }
    catch
    {
        return false;
    }
}

public static Rational<T> FromDecimal(string intPart, string fracPart, string periodPart)
{
    Rational<T> firstFracPart;
    if (fracPart != null && fracPart.Length != 0)
    {
        ulong denominator = TenInPower(fracPart.Length);
        firstFracPart = new Rational<T>(ulong.Parse(fracPart), denominator);
    }
    else
        firstFracPart = new Rational<T>(0, 1, false);

    Rational<T> secondFracPart;
    if (periodPart != null && periodPart.Length != 0)
        secondFracPart =
            new Rational<T>(ulong.Parse(periodPart), TenInPower(fracPart.Length)) *
            new Rational<T>(1, Nines((ulong)periodPart.Length), false);
    else
        secondFracPart = new Rational<T>(0, 1, false);

    var result = firstFracPart + secondFracPart;
    if (intPart != null && intPart.Length != 0)
    {
        long intPartLong = long.Parse(intPart);
        result = new Rational<T>(intPartLong, 1, false) + (intPartLong == 0 ? 1 : Math.Sign(intPartLong)) * result;
    }

    return result;
}

private static ulong TenInPower(int power)
{
    ulong result = 1;
    for (int l = 0; l < power; l++)
        result *= 10;
    return result;
}

private static decimal TenInNegPower(int power)
{
    decimal result = 1;
    for (int l = 0; l > power; l--)
        result /= 10.0m;
    return result;
}

private static ulong Nines(ulong power)
{
    ulong result = 9;
    if (power >= 0)
        for (ulong l = 0; l < power - 1; l++)
            result = result * 10 + 9;
    return result;
} 
```

有一些使用的例子：

```
Rational<long>.FromDecimal(0.33333333m, out r, 8, false);
// then r == 1 / 3;

Rational<long>.FromDecimal(0.33333333m, out r, 9, false);
// then r == 33333333 / 100000000; 
```

您的右部分零部分修剪案例：

```
Rational<long>.FromDecimal(0.33m, out r, 28, true);
// then r == 1 / 3;

Rational<long>.FromDecimal(0.33m, out r, 28, true);
// then r == 33 / 100; 
```

最小周期演示：

```
Rational<long>.FromDecimal(0.123412m, out r, 28, true, 1.5m));
// then r == 1234 / 9999;
Rational<long>.FromDecimal(0.123412m, out r, 28, true, 1.6m));
// then r == 123412 / 1000000; because of minimu repeating of period is 0.1234123 in this case. 
```

最后四舍五入：

```
Rational<long>.FromDecimal(0.8888888888888888888888888889m, out r));
// then r == 8 == 9; 
```

最有趣的案例：

```
Rational<long>.FromDecimal(0.12345678m, out r, 28, true, 2, 9);
// then r == 12345678 / 100000000;

Rational<long>.FromDecimal(0.12345678m, out r, 28, true, 2, 8);
// Conversation failed, because of period has not been founded and there are too many digits in fraction part of input value.

Rational<long>.FromDecimal(0.12121212121212121m, out r, 28, true, 2, 9));
// then r == 4 / 33; Despite of too many digits in input value, period has been founded. Thus it's possible to convert value to fraction. 
```

每个人都可以在[我的 github 上的 MathFunctions 库](https://github.com/KvanTTT/Math-Functions/blob/master/MathFunctions/Rational.cs)中找到其他测试和代码。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-12-08T04:29:38.097

Ruby 已经有一个内置的解决方案：

```
0.33.rationalize.to_s # => "33/100"
0.4.rationalize.to_s # => "2/5" 
```

在 Rails 中，ActiveRecord 数字属性也可以转换：

```
product.size = 0.33
product.size.to_r.to_s # => "33/100" 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-12-30T06:42:54.120

假设您有一个`BigInt`可以存储无限大小整数的类，请用 C++ 回答。

您可以`unsigned long long`改用，但它仅适用于某些值。

```
void GetRational(double val)
{
    if (val == val+1) // Inf
        throw "Infinite Value";
    if (val != val) // NaN
        throw "Undefined Value";

    bool sign = false;
    BigInt enumerator = 0;
    BigInt denominator = 1;

    if (val < 0)
    {
        val = -val;
        sign = true;
    }

    while (val > 0)
    {
        unsigned int intVal = (unsigned int)val;
        val -= intVal;
        enumerator += intVal;
        val *= 2;
        enumerator *= 2;
        denominator *= 2;
    }

    BigInt gcd = GCD(enumerator,denominator);
    enumerator /= gcd;
    denominator /= gcd;

    Print(sign? "-":"+");
    Print(enumerator);
    Print("/");
    Print(denominator);

    // Or simply return {sign,enumerator,denominator} as you wish
} 
```

顺便说一句，GetRational(0.0) 将返回“+0/1”，因此您可能想单独处理这种情况。

PS：多年来，我一直在自己的“RationalNum”类中使用此代码，并且已经过彻底测试。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2017-02-13T06:08:32.497

[Ian Richards](https://www.maa.org/sites/default/files/pdf/upload_library/22/Allendoerfer/1982/0025570x.di021121.02p0002y.pdf) / [John Kennedy](https://sites.google.com/site/johnkennedyshome/home/downloadable-papers/dec2frac.pdf)的这个算法不仅返回了不错的分数，而且在速度方面也表现得非常好。这是我从[这个答案](https://stackoverflow.com/a/42085412/344541)中获取的 C# 代码。

它可以处理`double`除 NaN 和 +/- 无穷大等特殊值之外的所有值，如果需要，您必须添加这些值。

它返回一个`new Fraction(numerator, denominator)`. 替换为您自己的类型。

**有关更多示例值以及与其他算法的比较，[请转到此处](https://stackoverflow.com/a/32903747)**

```
public Fraction RealToFraction(double value, double accuracy)
{
    if (accuracy <= 0.0 || accuracy >= 1.0)
    {
        throw new ArgumentOutOfRangeException("accuracy", "Must be > 0 and < 1.");
    }

    int sign = Math.Sign(value);

    if (sign == -1)
    {
        value = Math.Abs(value);
    }

    // Accuracy is the maximum relative error; convert to absolute maxError
    double maxError = sign == 0 ? accuracy : value * accuracy;

    int n = (int) Math.Floor(value);
    value -= n;

    if (value < maxError)
    {
        return new Fraction(sign * n, 1);
    }

    if (1 - maxError < value)
    {
        return new Fraction(sign * (n + 1), 1);
    }

    double z = value;
    int previousDenominator = 0;
    int denominator = 1;
    int numerator;

    do
    {
        z = 1.0 / (z - (int) z);
        int temp = denominator;
        denominator = denominator * (int) z + previousDenominator;
        previousDenominator = temp;
        numerator = Convert.ToInt32(value * denominator);
    }
    while (Math.Abs(value - (double) numerator / denominator) > maxError && z != (int) z);

    return new Fraction((n * denominator + numerator) * sign, denominator);
} 
```

此算法返回的示例值：

```
Accuracy: 1.0E-3      | Richards                     
Input                 | Result           Error       
======================| =============================
   3                  |       3/1          0         
   0.999999           |       1/1         1.0E-6     
   1.000001           |       1/1        -1.0E-6     
   0.50 (1/2)         |       1/2          0         
   0.33... (1/3)      |       1/3          0         
   0.67... (2/3)      |       2/3          0         
   0.25 (1/4)         |       1/4          0         
   0.11... (1/9)      |       1/9          0         
   0.09... (1/11)     |       1/11         0         
   0.62... (307/499)  |       8/13        2.5E-4     
   0.14... (33/229)   |      16/111       2.7E-4     
   0.05... (33/683)   |      10/207      -1.5E-4     
   0.18... (100/541)  |      17/92       -3.3E-4     
   0.06... (33/541)   |       5/82       -3.7E-4     
   0.1                |       1/10         0         
   0.2                |       1/5          0         
   0.3                |       3/10         0         
   0.4                |       2/5          0         
   0.5                |       1/2          0         
   0.6                |       3/5          0         
   0.7                |       7/10         0         
   0.8                |       4/5          0         
   0.9                |       9/10         0         
   0.01               |       1/100        0         
   0.001              |       1/1000       0         
   0.0001             |       1/10000      0         
   0.33333333333      |       1/3         1.0E-11    
   0.333              |     333/1000       0         
   0.7777             |       7/9         1.0E-4     
   0.11               |      10/91       -1.0E-3     
   0.1111             |       1/9         1.0E-4     
   3.14               |      22/7         9.1E-4     
   3.14... (pi)       |      22/7         4.0E-4     
   2.72... (e)        |      87/32        1.7E-4     
   0.7454545454545    |      38/51       -4.8E-4     
   0.01024801004      |       2/195       8.2E-4     
   0.99011            |     100/101      -1.1E-5     
   0.26... (5/19)     |       5/19         0         
   0.61... (37/61)    |      17/28        9.7E-4     
                      | 
Accuracy: 1.0E-4      | Richards                     
Input                 | Result           Error       
======================| =============================
   0.62... (307/499)  |     299/486      -6.7E-6     
   0.05... (33/683)   |      23/476       6.4E-5     
   0.06... (33/541)   |      33/541        0         
   1E-05              |       1/99999     1.0E-5     
   0.7777             |    1109/1426     -1.8E-7     
   3.14... (pi)       |     333/106      -2.6E-5     
   2.72... (e)        |     193/71        1.0E-5     
   0.61... (37/61)    |      37/61         0 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-18T19:06:31.573

您将遇到两个使这变得困难的基本问题：

1）浮点不是一个精确的表示，这意味着如果你有一个“x/y”的分数导致“z”的值，你的分数算法可能会返回一个“x/y”以外的结果。

2）无理数比有理数多得多。有理数是可以表示为分数的数。非理性的存在那些不能。

但是，以一种廉价的方式，由于浮点数的准确性有限，因此您始终可以将其表示为某种形式的派系。（我认为...）

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-01-02T18:59:31.717

完成上述代码并转换为as3

```
public static function toFrac(f:Number) : String
    {
        if (f>1)
        {
            var parte1:int;
            var parte2:Number;
            var resultado:String;
            var loc:int = String(f).indexOf(".");
            parte2 = Number(String(f).slice(loc, String(f).length));
            parte1 = int(String(f).slice(0,loc));
            resultado = toFrac(parte2);
            parte1 *= int(resultado.slice(resultado.indexOf("/") + 1, resultado.length)) + int(resultado.slice(0, resultado.indexOf("/")));
            resultado = String(parte1) +  resultado.slice(resultado.indexOf("/"), resultado.length)
            return resultado;
        }
        if( f < 0.47 )
            if( f < 0.25 )
                if( f < 0.16 )
                    if( f < 0.13 )
                        if( f < 0.11 )
                            return "1/10";
                        else
                            return "1/9";
                    else
                        if( f < 0.14 )
                            return "1/8";
                        else
                            return "1/7";
                else
                    if( f < 0.19 )
                        return "1/6";
                    else
                        if( f < 0.22 )
                            return "1/5";
                        else
                            return "2/9";
            else
                if( f < 0.38 )
                    if( f < 0.29 )
                        return "1/4";
                    else
                        if( f < 0.31 )
                            return "2/7";
                        else
                            return "1/3";
                else
                    if( f < 0.43 )
                        if( f < 0.40 )
                            return "3/8";
                        else
                            return "2/5";
                    else
                        if( f < 0.44 )
                            return "3/7";
                        else
                            return "4/9";
        else
            if( f < 0.71 )
                if( f < 0.60 )
                    if( f < 0.56 )
                        return "1/2";
                    else
                        if( f < 0.57 )
                            return "5/9";
                        else
                            return "4/7";
                else
                    if( f < 0.63 )
                        return "3/5";
                    else
                        if( f < 0.66 )
                            return "5/8";
                        else
                            return "2/3";
            else
                if( f < 0.80 )
                    if( f < 0.74 )
                        return "5/7";
                    else
                        if(f < 0.78 )
                            return "3/4";
                        else
                            return "7/9";
                else
                    if( f < 0.86 )
                        if( f < 0.83 )
                            return "4/5";
                        else
                            return "5/6";
                    else
                        if( f < 0.88 )
                            return "6/7";
                        else
                            if( f < 0.89 )
                                return "7/8";
                            else
                                if( f < 0.90 )
                                    return "8/9";
                                else
                                    return "9/10";
    } 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-12-09T10:40:49.397

这是 javascript 中使用蛮力方法的快速而肮脏的实现。根本没有优化，它在预定义的分数范围内工作：http: [//jsfiddle.net/PdL23/1/](http://jsfiddle.net/PdL23/1/)

```
/* This should convert any decimals to a simplified fraction within the range specified by the two for loops. Haven't done any thorough testing, but it seems to work fine.

I have set the bounds for numerator and denominator to 20, 20... but you can increase this if you want in the two for loops.

Disclaimer: Its not at all optimized. (Feel free to create an improved version.)
*/

decimalToSimplifiedFraction = function(n) {

for(num = 1; num < 20; num++) {  // "num" is the potential numerator
    for(den = 1; den < 20; den++) {  // "den" is the potential denominator
        var multiplyByInverse = (n * den ) / num;

        var roundingError = Math.round(multiplyByInverse) - multiplyByInverse;

        // Checking if we have found the inverse of the number, 
        if((Math.round(multiplyByInverse) == 1) && (Math.abs(roundingError) < 0.01)) {
            return num + "/" + den;
        }
    }
}
};

//Put in your test number here.
var floatNumber = 2.56;

alert(floatNumber + " = " + decimalToSimplifiedFraction(floatNumber));
```

这受到 JPS 使用的方法的启发。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-18T19:17:05.637

正如许多人所说，您确实无法将浮点数转换回分数（除非它非常精确，例如 0.25）。当然，您可以为大量分数创建某种类型的查找，并使用某种模糊逻辑来产生您正在寻找的结果。同样，这并不准确，您需要定义您希望分母有多大的下限。

.32 < x < .34 = 1/3 或类似的东西。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-05-26T12:05:57.690

这是 ruby[​​ http://github.com/valodzka/frac的实现](http://github.com/valodzka/frac)

```
Math.frac(0.2, 100)  # => (1/5)
Math.frac(0.33, 10)  # => (1/3)
Math.frac(0.33, 100) # => (33/100) 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2017-09-09T06:06:54.630

我遇到了一个特别优雅的使用变形的 Haskell 解决方案。这取决于[递归方案](https://hackage.haskell.org/package/recursion-schemes)包。

```
{-# LANGUAGE AllowAmbiguousTypes #-}
{-# LANGUAGE FlexibleContexts    #-}

import           Control.Applicative   (liftA2)
import           Control.Monad         (ap)
import           Data.Functor.Foldable
import           Data.Ratio            (Ratio, (%))

isInteger :: (RealFrac a) => a -> Bool
isInteger = ((==) <*>) (realToFrac . floor)

continuedFraction :: (RealFrac a) => a -> [Int]
continuedFraction = liftA2 (:) floor (ana coalgebra)
    where coalgebra x
              | isInteger x = Nil
              | otherwise = Cons (floor alpha) alpha
                  where alpha = 1 / (x - realToFrac (floor x))

collapseFraction :: (Integral a) => [Int] -> Ratio a
collapseFraction [x]    = fromIntegral x % 1
collapseFraction (x:xs) = (fromIntegral x % 1) + 1 / collapseFraction xs

-- | Use the nth convergent to approximate x
approximate :: (RealFrac a, Integral b) => a -> Int -> Ratio b
approximate x n = collapseFraction $ take n (continuedFraction x) 
```

如果你在 ghci 中尝试一下，它确实有效！

```
λ:> approximate pi 2
22 % 7 
```

# javascript - 为什么使用 setAttribute 设置的 onclick 属性无法在 IE 中工作？

> ID：95731
> 
> 赞同：50
> 
> 时间：2008-09-18T19:00:31.900
> 
> 标签：javascript, internet-explorer

今天遇到这个问题，发帖以防其他人有同样的问题。

```
var execBtn = document.createElement('input');
execBtn.setAttribute("type", "button");
execBtn.setAttribute("id", "execBtn");
execBtn.setAttribute("value", "Execute");
execBtn.setAttribute("onclick", "runCommand();"); 
```

结果是让 IE 在动态生成的元素上运行 onclick，我们不能使用 setAttribute。相反，我们需要在对象上设置 onclick 属性，并使用一个匿名函数来包装我们要运行的代码。

```
execBtn.onclick = function() { runCommand() }; 
```

**坏主意：**

你可以做

```
execBtn.setAttribute("onclick", function() { runCommand() }); 
```

但根据@scunliffe，它会在非标准模式下中断 IE。

你根本不能这样做

```
execBtn.setAttribute("onclick", runCommand() ); 
```

因为它立即执行，并将 runCommand() 的结果设置为 onClick 属性值，你也不能这样做

```
execBtn.setAttribute("onclick", runCommand); 
```

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-18T13:48:31.093

要使其在 FF 和 IE 中都能正常工作，您必须以两种方式编写：

```
 button_element.setAttribute('onclick','doSomething();'); // for FF
    button_element.onclick = function() {doSomething();}; // for IE 
```

感谢[这篇文章](http://mcarthurgfx.com/blog/article/assigning-onclick-with-new-element-breaks-in-ie)。

**更新：这***是*为了证明有时需要使用 setAttribute！如果您需要从 HTML 中获取原始 onclick 属性并将其添加到 onclick 事件中，则此方法有效，这样它就不会被覆盖：

```
// get old onclick attribute
var onclick = button_element.getAttribute("onclick");  

// if onclick is not a function, it's not IE7, so use setAttribute
if(typeof(onclick) != "function") { 
    button_element.setAttribute('onclick','doSomething();' + onclick); // for FF,IE8,Chrome

// if onclick is a function, use the IE7 method and call onclick() in the anonymous function
} else {
    button_element.onclick = function() { 
        doSomething();
        onclick();
    }; // for IE7
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-19T02:23:37.000

在IE中使用**.setAttribute** **()****无法设置**大量属性，其中包括每个内联事件处理程序。

 **有关详细信息，请参见此处：

[http://webbugtrack.blogspot.com/2007/08/bug-242-setattribute-doesnt-always-work.html](http://webbugtrack.blogspot.com/2007/08/bug-242-setattribute-doesnt-always-work.html)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-03-13T13:05:53.767

效果很好！

现在似乎没有必要同时使用这两种方式：

```
execBtn.onclick = function() { runCommand() }; 
```

显然适用于每个当前的浏览器。

在 Windows 上的当前 Firefox、IE、Safari、Opera、Chrome 中测试；Ubuntu 上的 Firefox 和 Epiphany；未在 Mac 或移动系统上测试。

*   克雷格：我会尝试“document.getElementById(ID).type='password';
*   有没有人用不同的引擎检查过“AddEventListener”方法？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-07-01T17:14:34.377

或者您可以使用 jQuery 并避免所有这些问题：

```
var execBtn = $("<input>", {
       type: "button",
       id: "execBtn",
       value: "Execute"
    })
    .click(runCommand); 
```

jQuery 也会处理所有跨浏览器的问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-06-09T20:17:14.720

这是跨浏览器兼容事件绑定的惊人功能。

[从http://js.isite.net.au/snippets/addevent](http://js.isite.net.au/snippets/addevent)得到它

有了它，您就`Events.addEvent(element, event, function);`可以无忧无虑！

例如：（[http://jsfiddle.net/Zxeka/](http://jsfiddle.net/Zxeka/)）

```
function hello() {
    alert('Hello');
}

var button = document.createElement('input');
button.value = "Hello";
button.type = "button";

Events.addEvent(input_0, "click", hello);

document.body.appendChild(button); 
```

这是功能：

```
// We create a function which is called immediately,
// returning the actual function object.  This allows us to
// work in a separate scope and only return the functions
// we require.
var Events = (function() {

  // For DOM2-compliant browsers.
  function addEventW3C(el, ev, f) {
    // Since IE only supports bubbling, for
    // compatibility we can't use capturing here.
    return el.addEventListener(ev, f, false);
  }

  function removeEventW3C(el, ev, f) {
    el.removeEventListener(ev, f, false);
  }

  // The function as required by IE.
  function addEventIE(el, ev, f) {
    // This is to work around a bug in IE whereby the
    // current element doesn't get passed as context.
    // We pass it via closure instead and set it as the
    // context using call().
    // This needs to be stored for removeEvent().
    // We also store the original wrapped function as a
    // property, _w.
    ((el._evts = el._evts || [])[el._evts.length]
        = function(e) { return f.call(el, e); })._w = f;

    // We prepend "on" to the event name.
    return el.attachEvent("on" + ev,
        el._evts[el._evts.length - 1]);
  }

  function removeEventIE(el, ev, f) {
    for (var evts = el._evts || [], i = evts.length; i--; )
      if (evts[i]._w === f)
        el.detachEvent("on" + ev, evts.splice(i, 1)[0]);
  }

  // A handler to call all events we've registered
  // on an element for legacy browsers.
  function addEventLegacyHandler(e) {
    var evts = this._evts[e.type];
    for (var i = 0; i < evts.length; ++i)
      if (!evts[i].call(this, e || event))
        return false;
  }

  // For older browsers.  We basically reimplement
  // attachEvent().
  function addEventLegacy(el, ev, f) {
    if (!el._evts)
      el._evts = {};

    if (!el._evts[ev])
      el._evts[ev] = [];

    el._evts[ev].push(f);

    return true;
  }

  function removeEventLegacy(el, ev, f) {
    // Loop through the handlers for this event type
    // and remove them if they match f.
    for (var evts = el._evts[ev] || [], i = evts.length; i--; )
      if (evts[i] === f)
        evts.splice(i, 1);
  }

  // Select the appropriate functions based on what's
  // available on the window object and return them.
  return window.addEventListener
      ? {addEvent: addEventW3C, removeEvent: removeEventW3C}
      : window.attachEvent
          ? {addEvent: addEventIE, removeEvent: removeEventIE}
          : {addEvent: addEventLegacy, removeEvent: removeEventLegacy};
})(); 
```

如果你不想使用这么大的功能，这应该适用于几乎所有浏览器，包括 IE：

```
if (el.addEventListener) { 
    el.addEventListener('click', function, false); 
} else if (el.attachEvent) { 
    el.attachEvent('onclick', function); 
} 
```

回答克雷格的问题。您将不得不创建一个新元素并复制旧元素的属性。这个功能应该做的工作：（[来源](http://www.universalwebservices.net/web-programming-resources/javascript/change-input-element-type-using-javascript)）

```
function changeInputType(oldObject, oType) {
  var newObject = document.createElement('input');
  newObject.type = oType;
  if(oldObject.size) newObject.size = oldObject.size;
  if(oldObject.value) newObject.value = oldObject.value;
  if(oldObject.name) newObject.name = oldObject.name;
  if(oldObject.id) newObject.id = oldObject.id;
  if(oldObject.className) newObject.className = oldObject.className;
  oldObject.parentNode.replaceChild(newObject,oldObject);
  return newObject;
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-09-24T19:34:31.887

实际上，据我所知，动态创建的内联事件处理程序在使用`x.setAttribute()`命令创建时可以在 Internet Explorer 8 中完美运行；您只需在 JavaScript 代码中正确定位它们。[我在这里](http://javascriptjedi.com/HTMLElement/setAttributeExperiment.html)偶然发现了您（和我的）问题的解决方案。

当我将所有包含的语句`x.appendChild()`移到正确位置时（即紧随其组中的最后一个 setAttribute 命令之后），我发现每一个 setAttribute 都按预期在 IE8 中工作，包括所有表单输入属性（包括“名称" 和 "type" 属性，以及我的 "onclick" 事件处理程序）。

我发现这非常了不起，因为在我这样做之前我在 IE 中得到的只是在屏幕上呈现垃圾，并且一个接一个的错误。此外，我发现每个 setAttribute 在其他浏览器中仍然有效，所以如果你只记得这个简单的编码练习，在大多数情况下你会很好。

但是，如果您必须即时更改任何属性，则此解决方案将不起作用，因为一旦将其 HTML 元素附加到 DOM，它们就无法在 IE 中更改；在这种情况下，我想人们必须从 DOM 中删除该元素，然后重新创建它及其属性（当然，以正确的顺序！）以使它们正常工作，并且不会引发任何错误。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-18T19:12:08.237

内联编写函数，解释器足够聪明，知道您正在编写函数。这样做，它假设它只是一个字符串（它在技术上是）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-02-17T15:31:39.263

```
function CheckBrowser(){
    if(navigator.userAgent.match(/Android/i)!=null||
        navigator.userAgent.match(/BlackBerry/i)!=null||
        navigator.userAgent.match(/iPhone|iPad|iPod/i)!=null||
        navigator.userAgent.match(/Nokia/i)!=null||
        navigator.userAgent.match(/Opera M/i)!=null||
        navigator.userAgent.match(/Chrome/i)!=null)
        {
            return 'OTHER';
    }else{
            return 'IE';
    }
}

function AddButt(i){
    var new_butt = document.createElement('input');
    new_butt.setAttribute('type','button');
    new_butt.setAttribute('value','Delete Item');
    new_butt.setAttribute('id', 'answer_del_'+i);
    if(CheckBrowser()=='IE'){
        new_butt.setAttribute("onclick", function() { DelElemAnswer(i) });
    }else{
        new_butt.setAttribute('onclick','javascript:DelElemAnswer('+i+');');
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-08-14T06:55:13.147

在某些情况下，此处列出的示例不适用于 Internet Explorer。

由于您必须使用这样的方法设置属性（不带括号）

```
HtmlElement.onclick = myMethod; 
```

如果您必须传递对象名称甚至参数，它将不起作用。对于 Internet Explorer，您应该在运行时创建一个新对象：

```
HtmlElement.onclick = new Function('myMethod(' + someParameter + ')'); 
```

也适用于其他浏览器。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-18T19:07:13.693

你试过了吗：

```
    execBtn.setAttribute("onclick", function() { runCommand() });

```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-18T19:26:05.007

与 onclick 问题无关，但也相关：

对于名称与 javascript 保留字冲突的 html 属性，将选择替代名称，例如。`<div class=''>`, 但是`div.className`, 或者`<label for='...'>`, 但是`label.htmlFor`。

在合理的浏览器中，这不会影响`setAttribute`. 所以在 gecko 和 webkit 中你会调用`div.setAttribute('class', 'foo')`，但在 IE 中你必须使用 javascript 属性名，所以`div.setAttribute('className', 'foo')`.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-13T14:19:29.693

您是否考虑过事件侦听器而不是设置属性？除其他外，它允许您传递参数，这是我在尝试执行此操作时遇到的问题。对于 IE 和 Mozilla，您仍然需要执行两次：

```
function makeEvent(element, callback, param, event) {
    function local() {
        return callback(param);
    }

    if (element.addEventListener) {
        //Mozilla
        element.addEventListener(event,local,false);
    } else if (element.attachEvent) {
        //IE
        element.attachEvent("on"+event,local);
    }
}

makeEvent(execBtn, alert, "hey buddy, what's up?", "click"); 
```

只需让事件成为“单击”或“鼠标悬停”之类的名称。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-07-01T17:04:37.417

我这样做是为了绕过它并继续前进，在我的情况下，我没有使用“输入”元素，而是使用图像，当我尝试为该图像设置“onclick”属性时，我遇到了同样的问题，所以我尝试用“a”元素包装图像，并像这样将引用指向函数。

```
var rowIndex = 1;
var linkDeleter = document.createElement('a');
linkDeleter.setAttribute('href', "javascript:function(" + rowIndex + ");");

var imgDeleter = document.createElement('img');
imgDeleter.setAttribute('alt', "Delete");
imgDeleter.setAttribute('src', "Imagenes/DeleteHS.png");
imgDeleter.setAttribute('border', "0");

linkDeleter.appendChild(imgDeleter); 
```

# visual-studio - Error List Freaking Out in VS 2008 while in large Aspx Files

> ID：95732
> 
> 赞同：0
> 
> 时间：2008-09-18T19:00:33.693
> 
> 标签：visual-studio, visual-studio-2008

I've been having this irritating issue lately. The site I'm currently working on has large aspx pages with tons of client side js code. While I'm typing the Error List window will keep opening and closing at the bottom of VS (where I have the window docked). I mean constantly. This is beyond aggravating as you can imagine. It's happening to a coworker as well. Does anybody else have this issue? Any solutions? (other than smaller pages)

We've got 2008 Pro SP1\. I've turned off every JS feature I can find since with pages this large it slows the VS to a crawl while it tries to parse it. I've tried closing the Error list completely but it just re-opens itself.

Thanks in advance, Geoff

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T19:58:07.410

1.  尝试删除项目目录中的 .user 文件
2.  使用添加/删除程序对 VS2008 进行修复
3.  如果这些都不起作用，请将标记复制到新项目并尝试复制。如果您可以重现此问题，请使用详细信息更新此问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T00:02:56.887

我终于找到了导致问题的选项。
1\. Options->Text Editor-> Miscellaneous，
    取消选中“Formal HTML on paste
2\. Options->Text Editor->JScript->Formatting
   ”取消选中“Automatic Formatting”下的复选框

# function - 如何在 MATLAB 中生成函数依赖项列表？

> ID：95760
> 
> 赞同：36
> 
> 时间：2008-09-18T19:03:18.790
> 
> 标签：function, matlab, dependencies, code-analysis

为了分发我编写的一个函数，该函数依赖于我编写的其他函数，这些函数有自己的依赖项等等，而不分发我曾经编写过的每个 m 文件，我需要弄清楚依赖项的完整列表是什么对于给定的 m 文件。是否有内置/可免费下载的方式来执行此操作？

具体来说，我对 MATLAB 7.4.0 (R2007a) 的解决方案感兴趣，但如果在旧版本中有不同的方法，请务必在此处添加它们。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-18T21:16:33.727

对于较新版本的 Matlab（例如 2007 或 2008），您可以使用内置函数：

1.  林特
2.  依赖报告和
3.  覆盖率报告

另一种选择是使用 Matlab 的分析器。该命令是配置文件，它也可以用于跟踪依赖关系。要使用个人资料，您可以这样做

```
>> profile on   % turn profiling on
>> foo;         % entry point to your matlab function or script
>> profile off  % turn profiling off
>> profview     % view the report 
```

如果分析器不可用，那么以下两个函数可能是（对于 MATLAB 2015a 之前的版本）：

1.  德普芬
2.  目录

例如，

```
>> deps = depfun('foo'); 
```

给出一个结构，deps，它包含 foo.m 的所有依赖项。

从答案[2](https://stackoverflow.com/a/29049918/4612)和[3](https://stackoverflow.com/a/34621308/4612)开始，使用较新版本的 MATLAB（2015a 之后）`matlab.codetools.requiredFilesAndProducts`。

查看答案

编辑：

感谢@Mike Katz 的评论

> *   请记住，Profiler 只会向您显示在这些运行中实际使用的文件，因此如果您不遍历每个分支，您可能会有额外的依赖项。依赖关系报告是一个很好的工具，但仅解决路径上的静态依赖关系，并且仅针对单个目录中的文件。
>     
>     
> *   Depfun 更可靠，但它可以为您提供所有可能的东西，但仍然错过了 LOAD 和 EVAL。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-03-14T14:15:58.530

For `MATLAB 2015a` and later you should preferably look at [matlab.codetools.requiredFilesAndProducts](http://www.mathworks.com/help/matlab/ref/matlab.codetools.requiredfilesandproducts.html)

or `doc matlab.codetools.requiredFilesAndProducts`

because `depfun` is marked to be removed in a future release.

# java - 如何在 Java 中捕获 AWT 线程异常？

> ID：95767
> 
> 赞同：18
> 
> 时间：2008-09-18T19:04:00.037
> 
> 标签：java, swing, exception-handling, awt

我们希望在我们的应用程序日志中跟踪这些异常——默认情况下，Java 只是将它们输出到控制台。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2015-01-09T10:57:04.227

从 Java 7 开始，您必须以不同的方式进行操作，因为该`sun.awt.exception.handler`hack 不再起作用。

[这是解决方案](https://stackoverflow.com/a/27858065/2003986)（来自[Uncaught AWT Exceptions in Java 7](http://www.javaspecialists.eu/archive/Issue196.html)）。

```
// Regular Exception
Thread.setDefaultUncaughtExceptionHandler(new ExceptionHandler());

// EDT Exception
SwingUtilities.invokeAndWait(new Runnable()
{
    public void run()
    {
        // We are in the event dispatching thread
        Thread.currentThread().setUncaughtExceptionHandler(new ExceptionHandler());
    }
}); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-18T21:27:40.877

EDT 内和 EDT 外未捕获的异常之间存在区别。

[另一个问题对两者都有解决方案，](https://stackoverflow.com/questions/75218/how-can-i-detect-when-an-exceptions-been-thrown-globally-in-java#75439)但如果您只想咀嚼 EDT 部分......

```
class AWTExceptionHandler {

  public void handle(Throwable t) {
    try {
      // insert your exception handling code here
      // or do nothing to make it go away
    } catch (Throwable t) {
      // don't let the exception get thrown out, will cause infinite looping!
    }
  }

  public static void registerExceptionHandler() {
    System.setProperty('sun.awt.exception.handler', AWTExceptionHandler.class.getName())
  }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T06:50:06.670

对*shemnon*的回答稍加补充：
第一次在 EDT 中发生未捕获的 RuntimeException（或错误）时，它正在寻找属性“sun.awt.exception.handler”并尝试加载与该属性关联的类。EDT 需要 Handler 类有一个默认的构造函数，否则 EDT 不会使用它。
如果您需要在处理故事中加入更多动态，则必须使用静态操作来执行此操作，因为该类由 EDT 实例化，因此没有机会访问静态以外的其他资源。这是我们正在使用的 Swing 框架中的异常处理程序代码。它是为 Java 1.4 编写的，在那里工作得很好：

```
public class AwtExceptionHandler {

    private static final Logger LOGGER = LoggerFactory.getLogger(AwtExceptionHandler.class);

    private static List exceptionHandlerList = new LinkedList();

    /**
     * WARNING: Don't change the signature of this method!
     */
    public void handle(Throwable throwable) {
        if (exceptionHandlerList.isEmpty()) {
            LOGGER.error("Uncatched Throwable detected", throwable);
        } else {
            delegate(new ExceptionEvent(throwable));
        }
    }

    private void delegate(ExceptionEvent event) {
        for (Iterator handlerIterator = exceptionHandlerList.iterator(); handlerIterator.hasNext();) {
            IExceptionHandler handler = (IExceptionHandler) handlerIterator.next();

            try {
                handler.handleException(event);
                if (event.isConsumed()) {
                    break;
                }
            } catch (Throwable e) {
                LOGGER.error("Error while running exception handler: " + handler, e);
            }
        }
    }

    public static void addErrorHandler(IExceptionHandler exceptionHandler) {
        exceptionHandlerList.add(exceptionHandler);
    }

    public static void removeErrorHandler(IExceptionHandler exceptionHandler) {
        exceptionHandlerList.remove(exceptionHandler);
    }

} 
```

希望能帮助到你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:08:30.900

有两种方法：

1.  /* 在 EDT 上安装 Thread.UncaughtExceptionHandler */
2.  设置系统属性：System.setProperty("sun.awt.exception.handler",MyExceptionHandler.class.getName());

我不知道后者是否适用于非 SUN jvm。

--

事实上，第一个是不正确的，它只是一种检测崩溃线程的机制。

# eclipse - How do I add FTP support to Eclipse?

> ID：95800
> 
> 赞同：93
> 
> 时间：2008-09-18T19:07:11.150
> 
> 标签：eclipse, ftp, eclipse-pdt

I'm using Eclipse PHP Development Tools. What would be the easiest way to access a file or maybe create a remote project trough FTP and maybe SSH and SFTP?.

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2011-08-04T15:22:53.853

Eclipse natively supports FTP and SSH. Aptana is not necessary.

Native FTP and SSH support in Eclipse is in the "Remote System Explorer End-User Runtime" Plugin.

Install it through Eclipse itself. These instructions may vary slightly with your version of Eclipse:

1.  Go to 'Help' -> 'Install New Software' (in older Eclipses, this is called something a bit different)
2.  In the 'Work with:' drop-down, select your version's plugin release site. Example: for Kepler, this is
    *Kepler - [http://download.eclipse.org/releases/kepler](http://download.eclipse.org/releases/kepler)*
3.  In the filter field, type 'remote'.
4.  Check the box next to 'Remote System Explorer End-User Runtime'
5.  Click 'Next', and accept the terms. It should now download and install.
6.  After install, Eclipse may want to restart.

Using it, in Eclipse:

1.  Window -> Open Perspective -> (perhaps select 'Other') -> Remote System Explorer
2.  File -> New -> Other -> Remote System Explorer (folder) -> Connection (or type Connection into the filter field)
3.  Choose FTP from the 'Select Remote System Type' panel.
4.  Fill in your FTP host info in the next panel (username and password come later).
5.  In the Remote Systems panel, right-click the hostname and click 'connect'.
6.  Enter username + password and you're good!
7.  Well, not exactly 'good'. The RSE system is fairly unusual, but you're connected.
8.  And you're one smart cookie! You'll figure out the rest.

**Edit:** To change the default port, follow the instructions on this page: [http://ikool.wordpress.com/2008/07/25/tips-to-access-ftpssh-on-different-ports-using-eclipse-rse/](http://ikool.wordpress.com/2008/07/25/tips-to-access-ftpssh-on-different-ports-using-eclipse-rse/)

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-11-04T16:23:15.267

Install [Aptana plugin](http://www.aptana.com/) to your Eclipse installation.

It has built-in FTP support, and it works excellently.

You can:

*   Edit files directly from the FTP server
*   Perform file/folder management (copy, delete, move, rename, etc.)
*   Upload/download files to/from FTP server
*   Synchronize local files with FTP server. You can make several profiles (actually projects) for this so you won't have to reinput over and over again.

As a matter of fact the FTP support is so good I'm using Aptana (or Eclipse + Aptana) now for all my FTP needs. Plus I get syntax highlighting/whatever coding support there is. Granted, Eclipse is not the speediest app to launch, but it doesn't bug me so much.

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-09-18T19:28:17.123

have you checked [RSE](http://wiki.eclipse.org/TM_and_RSE_FAQ#What_is_the_Target_Management_Project.3F) (**R**emote **S**ystem **E**xplorer) ? I think it's pretty close to what you want to achieve.

[a blog post about it, with screenshots](http://ikool.wordpress.com/2008/07/22/ssh-access-through-eclipse-rse/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T19:30:52.343

I'm not sure if this works for you, but when I do small solo PHP projects with Eclipse, the first thing I set up is an Ant script for deploying the project to a remote testing environment. I code away locally, and whenever I want to test it, I just hit the shortcut which updates the remote site.

Eclipse has good Ant support out of the box, and the scripts aren't hard to make.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-02-17T23:10:56.267

SFTP Plug-in: [http://www.jcraft.com/eclipse-sftp/](http://www.jcraft.com/eclipse-sftp/) :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-05T16:36:28.113

As none of the other solutions mentioned satisfied me, I wrote a script that uses WinSCP to sync local directories in a project to a FTP(S)/SFTP/SCP Server when eclipse's autobuild feature is triggered. Obviously, this is a Windows-only solution.

Maybe someone finds this useful: [http://rays-blog.de/2012/05/05/94/use-winscp-to-upload-files-using-eclipses-autobuild-feature/](http://rays-blog.de/2012/05/05/94/use-winscp-to-upload-files-using-eclipses-autobuild-feature/)

# arrays - 在 Perl 中，如何创建一个其键来自给定数组的哈希？

> ID：95820
> 
> 赞同：82
> 
> 时间：2008-09-18T19:08:09.840
> 
> 标签：arrays, perl, hash

假设我有一个数组，我知道我会做很多“数组是否包含 X？” 检查。执行此操作的有效方法是将该数组转换为哈希，其中键是数组的元素，然后您可以说

```
if($hash{X}) { ... }
```

有没有一种简单的方法来进行这种数组到哈希的转换？理想情况下，它应该足够通用，可以采用匿名数组并返回匿名哈希。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-09-18T19:08:38.153

```
%hash = map { $_ => 1 } @array; 
```

它不像“@hash{@array} = ...”解决方案那么短，但那些需要哈希和数组已经在其他地方定义，而这个可以采用匿名数组并返回匿名哈希。

它的作用是获取数组中的每个元素并将其与“1”配对。当这个 (key, 1, key, 1, key 1) 对的列表被分配给一个散列时，奇数的成为散列的键，偶数的成为各自的值。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-18T19:33:27.080

```
 @hash{@array} = (1) x @array; 
```

它是一个散列切片，一个来自散列的值列表，所以它在前面得到 list-y @。

从[文档](http://perldoc.perl.org/perldata.html#Slices)：

> 如果你对为什么在哈希切片上使用“@”而不是“%”感到困惑，可以这样想。括号的类型（方括号或花括号）决定了要查看的是数组还是散列。另一方面，数组或散列上的前导符号（'$' 或 '@'）表示您返回的是单数（标量）还是复数（列表）。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-09-18T19:14:56.733

```
@hash{@keys} = undef; 
```

此处使用 an 引用散列的语法`@`是散列切片。我们基本上说`$hash{$keys[0]}`AND `$hash{$keys[1]}`AND `$hash{$keys[2]}`... 是 = 左侧的一个列表，一个左值，我们分配给该列表，它实际上进入散列并设置所有命名键的值。在这种情况下，我只指定了一个值，因此该值进入`$hash{$keys[0]}`，而其他哈希条目都使用未定义的值自动激活（变得生动）。[我最初的建议是设置表达式 = 1，这会将一个键设置为 1，将其他键设置为`undef`. 为了保持一致性，我对其进行了更改，但正如我们将在下面看到的，确切的值并不重要。]

当您意识到左值（= 左侧的表达式）是一个由散列构建的列表时，我们就会开始理解为什么我们使用它`@`。[除了我认为这将在 Perl 6 中改变。]

这里的想法是您将哈希作为一个集合使用。重要的不是我分配的价值；这只是钥匙的存在。所以你想要做的不是这样的：

```
if ($hash{$key} == 1) # then key is in the hash 
```

反而：

```
if (exists $hash{$key}) # then key is in the set 
```

实际上，只运行`exists`检查比处理散列中的值更有效，尽管对我来说这里重要的只是你只用散列的键表示一个集合的概念。另外，有人指出，通过`undef`在这里使用 as 值，我们将消耗比分配值更少的存储空间。（并且也减少了混乱，因为值无关紧要，我的解决方案将只为散列中的第一个元素分配一个值而留下其他元素，`undef`而其他一些解决方案正在转动车轮以构建一个要进入的值数组哈希；完全浪费精力）。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-19T00:37:16.710

请注意，如果打字`if ( exists $hash{ key } )`对您来说不是太多工作（我更喜欢使用它，因为感兴趣的问题实际上是键的存在而不是其值的真实性），那么您可以使用简短而甜蜜的

```
@hash{@key} = (); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-21T19:21:22.113

我一直以为

```
foreach my $item (@array) { $hash{$item} = 1 } 
```

至少很好并且可读/可维护。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-19T04:13:37.297

这里有一个预设，即做很多“数组是否包含 X？”的最有效方法。检查是将数组转换为哈希。效率取决于稀缺资源，通常是时间，但有时是空间，有时是程序员的努力。通过同时保存列表和列表的哈希值，您至少会增加一倍的内存消耗。另外，您正在编写更多需要测试、记录等的原始代码。

作为替代方案，请查看 List::MoreUtils 模块，特别是函数`any()`、`none()`和。它们都将块作为条件，将列表作为参数，类似于and ：`true()``false()``map()``grep()`

`print "At least one value undefined" if any { !defined($_) } @list;`

我进行了快速测试，将 /usr/share/dict/words 的一半加载到一个数组（25000 个单词），然后在数组中查找从整个字典（每 5000 个单词）中选择的 11 个单词，同时使用数组-to-hash 方法和`any()`List::MoreUtils 中的函数。

在从源代码构建的 Perl 5.8.8 上，array-to-hash 方法的运行速度几乎是该`any()`方法的 1100 倍（在 Ubuntu 6.06 打包的 Perl 5.8.7 下快 1300 倍。）

然而，这还不是全部——数组到哈希的转换大约需要 0.04 秒，在这种情况下，数组到哈希方法的时间效率比该`any()`方法快 1.5 到 2 倍。仍然很好，但没有那么出色。

我的直觉是，`any()`在大多数情况下，数组到哈希的方法会胜出，但如果我有一些更可靠的指标（大量测试用例、体面的统计分析，也许还有一些大的—— O 每种方法的算法分析等）根据您的需要，List::MoreUtils 可能是更好的解决方案；它当然更灵活，需要更少的编码。请记住，过早优化是一种罪过... :)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-18T23:54:57.857

在 perl 5.10 中，有一个近乎神奇的 ~~ 运算符：

```
sub invite_in {
    my $vampires = [ qw(Angel Darla Spike Drusilla) ];
    return ($_[0] ~~ $vampires) ? 0 : 1 ;
} 
```

见这里：[http ://dev.perl.org/perl5/news/2007/perl-5.10.0.html](http://dev.perl.org/perl5/news/2007/perl-5.10.0.html)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-09-30T20:14:49.940

同样值得注意的是完整性，我通常使用 2 个相同长度的数组执行此操作的方法，`@keys`而`@vals`您更喜欢使用哈希...

`my %hash = map { $keys[$_] => $vals[$_] } (0..@keys-1);`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-18T19:25:03.167

Raldi 的解决方案可以收紧到这一点（原始的 '=>' 不是必需的）：

```
my %hash = map { $_,1 } @array; 
```

此技术还可用于将文本列表转换为哈希：

```
my %hash = map { $_,1 } split(",",$line) 
```

此外，如果您有这样的一行值： "foo=1,bar=2,baz=3" 您可以这样做：

```
my %hash = map { split("=",$_) } split(",",$line); 
```

[编辑包括]

* * *

提供的另一个解决方案（需要两行）是：

```
my %hash;
#The values in %hash can only be accessed by doing exists($hash{$key})
#The assignment only works with '= undef;' and will not work properly with '= 1;'
#if you do '= 1;' only the hash key of $array[0] will be set to 1;
@hash{@array} = undef; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-18T20:27:27.777

你也可以使用[Perl6::Junction](http://search.cpan.org/~cfranks/Perl6-Junction-1.40000/lib/Perl6/Junction.pm)。

```
use Perl6::Junction qw'any';

my @arr = ( 1, 2, 3 );

if( any(@arr) == 1 ){ ... } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-21T18:32:02.137

如果你做了很多集合论运算 - 你也可以使用[Set::Scalar](http://search.cpan.org/~jhi/Set-Scalar-1.22/lib/Set/Scalar.pm)或类似的模块。然后`$s = Set::Scalar->new( @array )`将为您构建 Set - 您可以使用以下方式查询它：`$s->contains($m)`.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-05T02:00:49.933

如果您不想污染名称空间，可以将代码放入子例程中。

```
my $hash_ref =
  sub{
    my %hash;
    @hash{ @{[ qw'one two three' ]} } = undef;
    return \%hash;
  }->(); 
```

甚至更好：

```
sub keylist(@){
  my %hash;
  @hash{@_} = undef;
  return \%hash;
}

my $hash_ref = keylist qw'one two three';

# or

my @key_list = qw'one two three';
my $hash_ref = keylist @key_list; 
```

如果你真的想传递一个数组引用：

```
sub keylist(\@){
  my %hash;
  @hash{ @{$_[0]} } = undef if @_;
  return \%hash;
}

my @key_list = qw'one two three';
my $hash_ref = keylist @key_list; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-09-14T11:18:07.740

```
#!/usr/bin/perl -w

use strict;
use Data::Dumper;

my @a = qw(5 8 2 5 4 8 9);
my @b = qw(7 6 5 4 3 2 1);
my $h = {};

@{$h}{@a} = @b;

print Dumper($h); 
```

给出（注意重复的键获得数组中最大位置的值 - 即 8->2 而不是 6）

```
$VAR1 = {
          '8' => '2',
          '4' => '3',
          '9' => '1',
          '2' => '5',
          '5' => '4'
        }; 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-19T16:47:11.407

您可能还想查看[Tie::IxHash](http://search.cpan.org/~gsar/Tie-IxHash-1.21/lib/Tie/IxHash.pm)，它实现了有序关联数组。这将允许您在一份数据副本上进行两种类型的查找（散列和索引）。

# ruby-on-rails - Should I use haml or erb or erubis for potentially high traffic site?

> ID：95821
> 
> 赞同：47
> 
> 时间：2008-09-18T19:08:17.107
> 
> 标签：ruby-on-rails, ruby, haml, erb, eruby

I have been playing with Haml recently and really like the way the resulting code looks to me...the developer. I'm also not too worried about a designer being able to consume or change it...we're a small team.

That said, beginning work on a project we believe will generate quite a bit of traffic (who doesn't?). I'm concerned that there are things I just don't know about haml. Is there anything erb can do that haml can't? Does haml have a negative effect as a project grows? Are there other things that should be considered?

And finally...how does Haml compare speedwise to erubis? I see that it supposedly beats erb and eruby now...

Thanks!

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-19T01:18:57.887

哈姆尔岩石。我没有看到任何最近的性能数据，但这些天它非常接近 erb。我认为如果你打开丑陋模式（它可以防止漂亮的缩进），它可能比 erb 更快。我们每天使用 Haml 进行 280 万次网页浏览。

有一个基准测试器检查到 Haml 源代码树：http: [//github.com/nex3/haml/tree/master/test](http://github.com/nex3/haml/tree/master/test)

**2009 年 11 月更新**

Nathan（Haml 的主要开发人员）在他的博客上[发布了一些 Haml 2.2 基准。](http://nex-3.com/posts/87-haml-benchmark-numbers-for-2-2)您可以在那里看到确切的数字，但简而言之：

*   正常（漂亮打印）模式 = 比 ERB 慢 2.8 倍
*   丑陋的模式（没有添加漂亮的标签）=等于ERB

`Haml::Template::options[:ugly] = true`您可以通过放入初始化程序或环境文件来启用丑陋模式。请注意，丑陋模式并不是真的那么丑陋 - 生成的 HTML 实际上比 ERB 更漂亮 - 它只是没有很好地缩进。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-18T23:05:11.813

如果您使用 Rails，Haml 和 erubis 之间的性能差异可以忽略不计：无论如何，模板在第一次命中后会被编译和缓存。将此与片段和页面缓存相结合，您可以放心，视图不是应用程序的性能瓶颈。

你应该问自己的问题是：你喜欢写 Haml 吗？它会让你更有效率吗？然后你可以更容易地决定。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-22T21:26:57.337

我喜欢 HAML，因为它是轻松编写结构化 HTML 的好工具，而且通常使用起来很有趣。但这与根据网站可能拥有的流量选择工具几乎没有关系。

如果您担心流量，您应该担心正确使用缓存。然后您需要应用一般 Web 应用程序性能的原则 - 结果是您将对页面加载做出超级快速的响应。这是一个高流量网站真正需要的。

可以在此处找到一些演示如何提高网站性能的演示文稿：

*   [Michael Koziarski 在 2008 年 Paris on Rails 上谈论 Rails 性能](http://2008.parisonrails.org/)

*   [Jeremy Kemper 在 RailsConf EU'08 上谈论 Rails 性能](http://railsconfeurope.blip.tv/file/1555719)

我所知道的学习如何正确使用 rails 缓存的最佳地点是：

*   [Rails 缓存 PeepCode 截屏视频](http://peepcode.com/products/page-action-and-fragment-caching)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-18T22:22:42.197

我认为这完全是个人喜好和可维护性的问题。对我来说，Haml 让模板更容易阅读和理解，性能也很可以接受。最后，模板语言不太可能是您需要优化的地方——更有可能是数据库查询、视图或对象缓存等。

但是，对于 ERb 模板，如果您使用 erubis，您将基本上免费获得更好的性能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-19T01:32:11.600

如果您从编码的角度喜欢 haml 的工作方式，请不要过分担心模板引擎的性能。（不过，正如您所指出的，它现在很快。）它绝对可以生成其他引擎可以生成的任何输出。

通常，将精力放在设置缓存上比担心模板引擎遇到性能问题更有利可图。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T19:37:41.077

我个人会在预编译模板中推荐我们 erubis。

特别是如果不需要动态模板。那么你最大的减速将受到 ruby​​ 解析 ruby​​ 的速度的限制。

我可能会设置一个小型 cron 作业，它只监视更改的源模板并在更改时自动编译它们，您可以在不使用时将其关闭。

编译一次，多次使用。

哦，如果你真的关心速度，Tenjin 可能也值得一看（与 erubis 相同的创造者）

[http://www.kuwata-lab.com/tenjin/rbtenjin-examples.html](http://www.kuwata-lab.com/tenjin/rbtenjin-examples.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T01:26:56.137

好吧，Haml 的性能随着每个版本的发布而不断提高。它在当前时间是否处于可接受的位置？这由您决定（我倾向于说“是”，但这是您根据需要做出的选择）。如果您喜欢模板和它们提供的可读性，那么性能下降（无论多么微不足道）应该是您决定的最终因素。

您应该考虑与 Haml 一起使用的其他工具之一是 make_resourceful，它是 Haml 的维护者 (Nathan Weizenbaum) 的另一个宝石，它简化了 Rails 应用程序中的许多 RESTful 事物。

如果您对 Haml（和 m_r）有任何进一步、更具体的问题，我相信 Nathan 会非常乐意回答这些问题。可以通过 Jabber/XMPP 和电子邮件联系到他。他的联系信息可以在[这里](http://nex-3.com/about)找到。

# latex - 用 LaTeX 中的字符串替换字符

> ID：95824
> 
> 赞同：10
> 
> 时间：2008-09-18T19:08:31.897
> 
> 标签：latex

我正在寻找一种方法来对 LaTeX 中的字符串进行子字符串替换。我想做的是构建一个可以这样调用的命令：

```
\replace{File,New} 
```

这会产生类似的东西

```
\textbf{File}$\rightarrow$\textbf{New} 
```

这是一个简单的示例，但我希望能够将格式/结构放在单个命令中，而不是文档中的任何地方。我知道我可以构建几个带有越来越多参数的命令，但我希望有一种更简单的方法。

**编辑澄清**

我正在寻找相当于

```
string.replace(",", "$\rightarrow$) 
```

可以采用任意字符串并用另一个子字符串替换子字符串的东西。

所以我可以用 \replace{File}、\replace{File,New}、\replace{File,Options,User} 等来调用命令，用粗体格式包装单词，并用右箭头命令替换任何逗号. 即使“用粗体包装”位太难（我认为可能如此），只是替换部分会有所帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T12:22:30.623

一般情况比较棘手（当您不使用逗号作为分隔符时），但是您给出的示例可以通过一些 LaTeX 内部知识的知识进行编码而没有太多麻烦。

```
\documentclass[12pt]{article}
\makeatletter
\newcommand\formatnice[1]{%
  \let\@formatsep\@formatsepinit
  \@for\@ii:=#1\do{%
    \@formatsep
    \formatentry{\@ii}%
  }%
}
\def\@formatsepinit{\let\@formatsep\formatsep}
\makeatother
\newcommand\formatsep{,}
\newcommand\formatentry[1]{#1}
\begin{document}
\formatnice{abc,def}

\renewcommand\formatsep{\,$\rightarrow$\,}
\renewcommand\formatentry[1]{\textbf{#1}}
\formatnice{abc,def}
\end{document} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-25T18:31:02.037

> 看起来您的“空格”问题来自该包中的错误。如果你用逗号包围“\GetTokens”宏，那么你会看到该宏插入了额外的空格。

是的，tokenizer 包中存在错误。正如我在[博客](http://b-p-i.blogspot.com/2011/02/bugfix-remove-unwanted-spaces-in.html)上所说，错误修复是使用以下更正代码，而不仅仅是“\usepackage[trim]{tokenizer}”：

```
\usepackage[trim]{tokenizer}  

\def\SH@GetTokens#1,#2\@empty{%
    \def\SH@token{#1}%
    \ifx\SH@trimtokens\SH@true% strip spaces if requested
        \TrimSpaces\SH@token%
    \fi%
    \SH@DefineCommand{\SH@FirstArgName}{\SH@token}%
    \SH@DefineCommand{\SH@SecondArgName}{#2}%
    }
\def\SH@CheckTokenSep#1,#2\@empty{%
    \def\SH@CTSArgTwo{#2}%
    \ifx\SH@CTSArgTwo\@empty%
        \edef\SH@TokenValid{\SH@false}%
    \else%
        \edef\SH@TokenValid{\SH@true}%
    \fi%
    } 
```

我会将此错误修复报告给开发人员[Sascha Herpers](http://www.scmp.uni-koeln.de/mitarbeiter/herpers.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-09T18:54:48.520

试试这个[`xstring`包](http://www.ctan.org/pkg/xstring)：

```
\usepackage{xstring}

[…]

\StrSubstitute{File,New}{,}{\(\rightarrow\)} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T10:45:33.657

有一个名为[*tokenizer*](http://tug.ctan.org/cgi-bin/ctanPackageInformation.py?id=tokenizer)的 LaTeX 包可以帮助你做你想做的事。

这是一个 hack（但纯 LaTeX，没有内部），它接近我认为你想要的，但有一些无关的空间我还没有完全能够修复。也许[罗伯逊](https://stackoverflow.com/users/4161/will-robertson)可以提供进一步的建议？与他稍微精致一点的答案不同，我没有参数化这些点点滴滴，这里是：

```
\usepackage{forloop}  
\usepackage[trim]{tokenizer}  
...  
\newcounter{rrCount}  
\newcommand{\replace}[1]{%  
    \GetTokens{rrFirst}{rrRest}{#1,}%  
    \textbf{\rrFirst}%  
    \forloop{rrCount}{0}{\value{rrCount} < 100}{%  
        \ifthenelse{\equal{\rrRest}{}}{%  
            \setcounter{rrCount}{101}%  
        }{%  
            \GetTokens{rrFirst}{rrRest}{\rrRest}%  
            $\rightarrow$\textbf{\rrFirst}%  
        }%  
    }%  
}%  
% -----------------------------------------------------------------  
\replace{a1}\\  
\replace{a2,b2}\\  
\replace{a3,b3,c3}\\ 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-18T19:20:46.097

好的，我撤回这个答案。感谢您澄清问题。

* * *

我怀疑这可能不是您想要的，但是无论如何：

```
\newcommand{\replace}[2]{\textbf{#1}$\rightarrow$\textbf{#2}}  
\replace{File}{New} 
```

如果这不是您要查找的内容，请您澄清一下问题吗？

# com - 使用 COM 互操作处理对象生命周期的最有效方法是什么？

> ID：95834
> 
> 赞同：0
> 
> 时间：2008-09-18T19:09:34.373
> 
> 标签：com, interop, workflow-foundation, marshalling, .net-3.0

我有一个 Windows 工作流应用程序，它使用我为 COM 自动化编写的类。我正在使用 COM 从我的课程中打开 Word 和 Excel。

我目前正在我的 COM 助手中实现 IDisposable 并使用 Marshal.ReleaseComObject()。但是，如果我的工作流程失败，则不会调用 Dispose() 方法，并且 Word 或 Excel 句柄保持打开状态并且我的应用程序挂起。

这个问题的解决方案非常简单，但不仅仅是解决它，我想学习一些东西并深入了解使用 COM 的正确方法。我正在寻找“最佳”或最有效和最安全的方式来处理拥有 COM 句柄的类的生命周期。模式、最佳实践或示例代码会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T20:38:29.263

我看不出你有什么不调用 Dispose() 方法的失败。我使用仅包含仅引发异常的代码活动的顺序工作流进行了测试，并且我的工作流的 Dispose() 方法被调用了两次（这是因为标准的 WorkflowTerminated 事件处理程序）。检查以下代码：

程序.cs

```
 class Program
    {
        static void Main(string[] args)
        {
            using(WorkflowRuntime workflowRuntime = new WorkflowRuntime())
            {
                AutoResetEvent waitHandle = new AutoResetEvent(false);
                workflowRuntime.WorkflowCompleted += delegate(object sender, WorkflowCompletedEventArgs e) 
                {
                    waitHandle.Set();
                };
                workflowRuntime.WorkflowTerminated += delegate(object sender, WorkflowTerminatedEventArgs e)
                {
                    Console.WriteLine(e.Exception.Message);
                    waitHandle.Set();
                };

                WorkflowInstance instance = workflowRuntime.CreateWorkflow(typeof(WorkflowConsoleApplication1.Workflow1));
                instance.Start();

                waitHandle.WaitOne();
            }
            Console.ReadKey();
        }
    } 
```

工作流1.cs

```
 public sealed partial class Workflow1: SequentialWorkflowActivity
    {
        public Workflow1()
        {
            InitializeComponent();
            this.codeActivity1.ExecuteCode += new System.EventHandler(this.codeActivity1_ExecuteCode);
        }

        [DebuggerStepThrough()]
        private void codeActivity1_ExecuteCode(object sender, EventArgs e)
        {
            Console.WriteLine("Throw ApplicationException.");
            throw new ApplicationException();
        }

        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                // Here you must free your resources 
                // by calling your COM helper Dispose() method
                Console.WriteLine("Object disposed.");
            }
        }
    } 
```

我错过了什么吗？关于活动（以及工作流）对象的生命周期相关方法，请查看这篇文章：[活动“生命周期”方法](http://blogs.msdn.com/advancedworkflow/archive/2006/02/22/537412.aspx)。如果您只想要一篇关于处置的通用文章，请查看[此](http://msdn.microsoft.com/en-us/library/fs2xkftw.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T21:15:11.797

基本上，您不应该依赖手动代码在工作结束时对您的对象调用 Dispose()。你现在可能有这样的事情：

```
MyComHelper helper = new MyComHelper();
helper.DoStuffWithExcel();
helper.Dispose();
... 
```

相反，您需要使用 try 块来捕获任何可能触发的异常并在此时调用 dispose。这是规范的方式：

```
MyComHelper helper = new MyComHelper();
try
{
    helper.DoStuffWithExcel();
}
finally()
{
    helper.Dispose();
} 
```

这很*常见*，以至于 C# 有一个特殊的结构，可以生成**与上图相同的代码** *[见注释]*；这是您大部分时间都应该做的事情（除非您有一些特殊的对象构造语义可以使上述手动模式更易于使用）：

```
using(MyComHelper helper = new MyComHelper())
{
    helper.DoStuffWithExcel();
} 
```

**编辑**：
注意：生成的实际代码比上面的第二个示例稍微复杂一点，因为它还引入了一个新的本地范围，使辅助对象在`using`块之后不可用。就像第二个代码块被 {}'s 包围一样。为了解释清楚而省略了。

# tsql - 如何在 MS SQL Server 2005 中确定表值变量的内部名称

> ID：95842
> 
> 赞同：5
> 
> 时间：2008-09-18T19:10:10.317
> 
> 标签：tsql

可以使用 #t1 等临时表的名称来确定

```
select @TableName = [Name]
from tempdb.sys.tables 
where [Object_ID] = object_id('tempDB.dbo.#t1') 
```

如何找到表值变量的名称，即由

```
declare @t2 as table (a int) 
```

目的是能够获取有关表的元信息，使用类似的东西

```
select @Headers = dbo.Concatenate('[' + c.[Name] + ']')  
from  sys.all_columns c
    inner join sys.tables t
        on c.object_id = t.object_id
where t.name = @TableName 
```

尽管对于临时表，您必须查看`tempdb.sys.tables`而不是`sys.tables`. 你在哪里寻找表值变量？

* * *

我现在意识到我不能做我想做的事，那就是编写一个通用函数来将表值变量格式化为 html 表。对于初学者，在 sql server 2005 中，您不能传递表值参数：

[http://www.sqlteam.com/article/sql-server-2008-table-valued-parameters](http://www.sqlteam.com/article/sql-server-2008-table-valued-parameters)

此外，在 sql server 2008 中，参数必须是强类型的，因此您将始终知道列的数量和类型。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-12-19T13:01:13.900

表变量元数据也可以在其中查看`tempdb.sys.tables`。这很容易从下面验证

```
declare @t2 as table ( [38F055D8-25D9-4AA6-9571-F436FE] int)

SELECT t.name, t.object_id
FROM tempdb.sys.tables t
JOIN tempdb.sys.columns c
ON t.object_id = c.object_id 
WHERE c.name = '38F055D8-25D9-4AA6-9571-F436FE' 
```

示例结果

```
name                           object_id
------------------------------ -----------
#4DB4832C                      1303675692 
```

但是您会注意到对象名称是自动生成的，并且与变量名称无关。

如果您没有保证唯一的列名，您可以使用上面的过滤器，并且表变量中至少有一行，您可以（从 SQL Server 2008 开始）使用`%%physloc%%`并`DBCC PAGE`确定此信息。下面的例子。

```
DECLARE @t2 AS TABLE ( a INT)

INSERT INTO @t2
VALUES      (1)

DECLARE @DynSQL NVARCHAR(100)

SELECT TOP (1) @DynSQL = 'DBCC PAGE(2,' + CAST(file_id AS VARCHAR) + ',' + 
                                          CAST( page_id AS VARCHAR) +
                                        ',1) WITH TABLERESULTS'
FROM   @t2
       CROSS APPLY sys.fn_PhysLocCracker( %% physloc %% )

DECLARE @DBCCPage TABLE (
  [ParentObject] [VARCHAR](100) NULL,
  [Object]       [VARCHAR](100) NULL,
  [Field]        [VARCHAR](100) NULL,
  [VALUE]        [VARCHAR](100) NULL )

INSERT INTO @DBCCPage
EXEC (@DynSQL)

SELECT VALUE                 AS object_id,
       OBJECT_NAME(VALUE, 2) AS object_name
FROM   @DBCCPage
WHERE  Field = 'Metadata: ObjectId' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T20:05:17.313

来自在线书籍：

表变量的行为类似于局部变量。它有一个明确定义的范围，即声明它的函数、存储过程或批处理。

鉴于此，不需要在运行时查找该值，因为您必须在设计时知道它。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-09-18T19:13:37.923

我不相信你可以，因为表变量是在内存中而不是在 tempdb 中创建的。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-10-19T01:23:56.590

关于将任意列表/数组传递到 SQL Server 2005 函数或存储过程的主题，
我所知道的最简单的方法是使用 XML 变量。如果需要，该 XML 变量可以是与 XML 模式关联的强类型 XML 类型。

给定一个作为 XML 传递给过程/函数的列表，您可以通过“粉碎”将该列表提取到表变量或临时表中。“分解”XML 意味着在相反的方向上进行转换——从 XML 到行集。（FOR XML 子句导致行集到 XML 的转换。）

在用户自定义表函数中

```
CREATE FUNCTION [dbo].[udtShredXmlInputBondIdList]  
( 
-- Add the parameters for the function here
@xmlInputBondIdList xml
)
RETURNS 
@tblResults TABLE 
(
-- Add the column definitions for the TABLE variable here
    BondId int 
)
AS
BEGIN
-- Should add a schema validation for @xmlInputIssuerIdList here
--Place validation here
-- Fill the table variable with the rows for your result set
INSERT @tblResults
SELECT  
nref.value('.', 'int') as BondId
FROM
@xmlInputBondIdList.nodes('//BondID') as R(nref)
RETURN 
END 
```

如果 @xmlInputBondIdList 是预期结构的 XML 片段，如下所示，并按如下方式调用

```
DECLARE @xmlInputBondIdList xml
SET @xmlInputBondIdList =
'<XmlInputBondIdList>

<BondID>8681</BondID>

<BondID>8680</BondID>

<BondID>8684</BondID>

</XmlInputBondIdList>
'

SELECT * 
FROM [CorporateBond].[dbo].[udtShredXmlInputBondIdList] 
     (@xmlInputBondIdList) 
```

结果将是行集

债券编号

8681

8680

8684

其他几个示例可以在[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=678284&SiteID=1找到](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=678284&SiteID=1)

# c# - 如何以编程方式查找 Commit Charge？

> ID：95850
> 
> 赞同：1
> 
> 时间：2008-09-18T19:11:03.497
> 
> 标签：c#

我正在寻找总[提交费用](http://en.wikipedia.org/wiki/Commit_charge)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T19:52:43.647

```
 public static long GetCommitCharge()
    {
        var p = new System.Diagnostics.PerformanceCounter("Memory", "Committed Bytes");
        return p.RawValue;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:34:06.017

下面是一个使用 WMI 的示例：

```
strComputer = "."

Set objSWbemServices = GetObject("winmgmts:\\" & strComputer)
Set colSWbemObjectSet = _
 objSWbemServices.InstancesOf("Win32_LogicalMemoryConfiguration")

For Each objSWbemObject In colSWbemObjectSet
 Wscript.Echo "Total Physical Memory (kb): " & _
 objSWbemObject.TotalPhysicalMemory
 WScript.Echo "Total Virtual Memory (kb): " & _
 objSWbemObject.TotalVirtualMemory
 WScript.Echo "Total Page File Space (kb): " & _
 objSWbemObject.TotalPageFileSpace
Next 
```

如果您在 CScript 下运行此脚本，您应该会在命令窗口中看到安装在目标计算机上的物理内存的千字节数。以下是脚本的典型输出： Total Physical Memory (kb): 261676

**编辑：**还包括总页面文件大小属性

取自：[http ://www.microsoft.com/technet/scriptcenter/guide/sas_wmi_dieu.mspx?mfr=true](http://www.microsoft.com/technet/scriptcenter/guide/sas_wmi_dieu.mspx?mfr=true)

# ftp - 大文件传输的最佳实践是什么 - SFTP 或非对称文件加密？

> ID：95852
> 
> 赞同：1
> 
> 时间：2008-09-18T19:11:10.720
> 
> 标签：ftp, sftp, security, data-transfer

当想要通过网络安全地传输平面文件时，通常认为哪个是“最佳实践”？非对称加密似乎很痛苦，因为您必须在端点管理密钥集并确保所有客户端都使用相同的算法，而 SFTP 似乎很痛苦，因为 NAT 问题与加密控制通道，因此路由器无法翻译IP。是否有强烈推荐的第三方解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T19:18:55.040

当您说 SFTP 时，我相信您是在谈论[带有 SSL 的 FTP ，而不是](http://en.wikipedia.org/wiki/FTPS)[与 SSH 一起使用的 SFTP 协议](http://en.wikipedia.org/wiki/SSH_file_transfer_protocol)。使用 SFTP（SSH 版本），因为它不需要加密的控制通道，并且可以在 NAT 上正常工作。我链接到的 SFTP 页面在页面底部列出了许多图形 SFTP 客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:16:18.383

rsync 是目前最好的文件传输实用程序。支持恢复、递归和各种加密，包括 ssh（默认）。就像类固醇上的 scp。

如果你有多个路由器要通过，你可以建立 ssh 隧道。它只会传输丢失的部分文件，这使得它非常适合备份。它有很多有用的功能，我用它代替 cp 进行本地复制。

它可用于许多平台，并且默认包含在现代 *nix 系统中。更多信息请访问[http://samba.anu.edu.au/rsync/](http://samba.anu.edu.au/rsync/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T19:13:45.113

使用[PGP](http://en.wikipedia.org/wiki/Pretty_Good_Privacy) / [GPG](http://www.gnupg.org/)并通过 ftp 或任何其他方法直接传输 gpg-ed 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:23:00.270

是的，我的意思是 SSL FTP，而不是 SFTP。“管理”对开源不利，但如果这是事实上的最佳实践，那么这就是要使用的......感谢您的回答

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-04T12:07:43.390

使用 FTPS，一般可以在认证后通过 CCC 命令切换到未加密的控制通道。这种方法意味着路由器没有问题，而您正在传输的数据将保持加密状态。

# javascript - 如何使用 JavaScript 动态更改 PDF 对象/嵌入文件的“src”或“数据”？

> ID：95858
> 
> 赞同：1
> 
> 时间：2008-09-18T19:11:59.347
> 
> 标签：javascript, pdf, object, embed

我有一个动态加载 PDF 文件以在浏览器中查看的 Web 应用程序。目前，它使用“innerHTML”将 div 替换为 PDF 对象。这行得通。

但是，有没有更好的方法来获取元素的 ID 并为 Object / Embed 设置“src”或“data”参数并让它立即加载新文档？我希望 Adob​​e Acrobat Reader 的实例会留在屏幕上，但新文档会加载到其中。

这是该对象的 JavaScript 示例：

```
document.getElementById(`divPDF`).innerHTML = `<OBJECT id='objPDF' DATA="'+strFilename+'" TYPE="application/pdf" TITLE="IMAGING" WIDTH="100%" HEIGHT="100%"></object>`; 
```

任何见解都值得赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-18T19:59:53.163

我不确定这是否可行，因为我还没有在我的项目中尝试过。

（看你的JS，相信你用的是jQuery，如果不是，请指正）

使用对象填充 divPDF 后，您可以尝试以下代码：

```
$("objPDF").attr({
    data: "dir/to/newPDF"
}); 
```

同样，我不确定这是否适用于您的特定需求，但如果您将此代码附加到事件处理程序，您可以切换出对象的数据。

您还可以将其包装在一个函数中以反复使用：

```
function pdfLoad(dirToPDF) {
    $("objPDF").attr({
        data: dirToPDF
    });
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T20:13:25.830

如果 PDF 的处理程序是 acrobat（不一定是），它会公开一个 JS 接口，此处记录了该接口：

[http://www.adobe.com/devnet/acrobat/pdfs/js_api_reference.pdf](http://www.adobe.com/devnet/acrobat/pdfs/js_api_reference.pdf)

看看您是否可以在 document.getElementById('objPDF') 上调用 openDoc(urlToPdf) ——即使这样有效，它也仅在使用 Acrobat 处理“应用程序/pdf”时才有效

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T21:42:59.437

@lark 稍作修正：

```
$('#objPDF').attr('data','dirToPDF'); 
```

# 指定 objPDF 是 ID 而不是元素名称。虽然我仍然不知道这是否会奏效。

@Tristan 看看[jQuery Media 插件](http://malsup.com/jquery/media/)。它也提到了对 PDF 的支持，尽管我从未使用过它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-08T17:57:35.597

在外部窗口中打开 PDF 链接 PDFN 与外部`PDF-Reader.EXE`：

单击以下按钮：

```
<FORM action=""> 
    <INPUT type="button" value="PDF file" 
        onclick="window.open('http://www.Dku-betrieb.eu/Pdfn.html', 
        'PDFN', 'width=620, height=630')">
</FORM> 
```

`Pdfn.html`在外部窗口中打开此框架集：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
<html lang="de">
    <meta http-equiv="refresh" content="12;url=http://www.dku-betrieb.eu/Pdfn1.html">
    <head>
        <title>Reader</title>
            <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    </head>
    <frameset>
    <frame src="http://www.dku-betrieb.eu/File.pdf" frameborder=0 name="p1">
    </frameset>
</HTML> 
```

它会在 12 秒内刷新到 PDF 阅读器的下载：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
<html lang="de">
    <head>
        <title>Reader</title>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    </head>
    <frameset >
    <frame src="http://www.dku-betrieb.eu/PDFReader.exe" frameborder=0 name="p2">
    </frameset>
</HTML> 
```

结果显示在外部窗口 PDFN 中的 PDF 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-12T13:15:30.353

```
function pdfLoad(datasrc) {

          var x =  document.getElementById('objPDF');
          x.data = datasrc;

        } 
```

这对我有用

# language-agnostic - 除了谷歌，开发者还有什么地方可以去学习他们需要学习的东西吗？

> ID：95862
> 
> 赞同：2
> 
> 时间：2008-09-18T19:12:34.820
> 
> 标签：language-agnostic

我并不是真的在问程序员如何学习如何编程。更多关于特定技术的信息。如果我想学习 Hibernate，我怎么知道在 Hibernate 之前我应该​​知道什么？我应该在 Hibernate 之前、期间还是之后学习 JPA？Hibernate 有更好的解决方案吗？（而且我并不是真的在寻找有关 Hibernate 的信息）

也许 stackoverflow 是找到这些答案的地方，但似乎随着框架、api、库、编程语言、平台以及您想使用的任何其他技术词的剪切浩大，它需要很长时间才能得出快速了解使用何种技术、何时以及在使用之前需要了解的内容。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T19:14:12.617

我使用 Wikipedia 比较各种技术来完成一项任务，尽管就商业闭源框架而言它可能是不完整的（可能是因为访问它们的人较少）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-18T19:15:02.537

有时最好的学习方法就是深入研究一个框架。当然，您可以使用某人的包装 API 来处理某些事情，但是如果休眠时出现问题，那么您将不知道发生了什么。

并且回答“我怎么知道在休眠之前我应该​​知道什么”，你不知道，这就是你学习的原因。在学习 c++ 时，从简单的数据类型开始，但我还不知道指针，不需要，但是当我到达那里时，我就了解了它们。只需要跳进去开始玩。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T20:01:46.153

对于特定技术，例如 Hibernate、Java、JPA、LDAP（尤其是 OpenLDAP）、Log4J、任何 Apache：它们都有与产品相关的 wiki 和/或论坛，通常比 Google 搜索学习更有帮助。许多甚至附带教程，您应该尝试一下。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T19:16:38.023

找一本关于这个主题的书并阅读它。然后通过电子邮件向作者发送其他问题。这些作者中的大多数都非常乐意提供帮助，特别是如果您购买并阅读了他们辛辛苦苦制作的材料。

如果这对您来说还不够，请参加一个涵盖该主题的会议，如果您能做到的话。同样，您可以遇到许多负责维护和/或创建这些技术的人，我发现他们总是愿意回答问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T19:14:40.307

访问 Coding Horror、Slashdot、Techcrunch 等网站，了解人们在谈论什么。通常，如果某件事很受欢迎，那可能是您可能想谈谈的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-03T12:50:21.013

这些东西叫做“书”，里面装满了各种知识。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T19:16:20.350

很多时候，任何技术或项目的文档和/或教程都会提到假设或有用的先验知识。

例如休眠： [http ://www.hibernate.org/hib_docs/v3/reference/en/html_single/#tutorial-intro](http://www.hibernate.org/hib_docs/v3/reference/en/html_single/#tutorial-intro)

“本教程适用于 Hibernate 的新用户，但需要 Java 和 SQL 知识”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T19:16:28.837

对我来说，对我的职业生涯有帮助并教会我要问什么问题的事情是：

1.  播客——.NET Rocks 等，介绍和讨论新技术并将它们置于上下文中
2.  加入您当地的用户组，并在演示后留下来与那里的人们交谈；您可以通过聆听其他人在做什么以及他们接下来要学习的内容来学到很多东西

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-18T19:17:31.767

只需在网上环顾四周，然后开始尝试使用您尝试学习的任何工具/技术。当你尝试学习一件事时，你会意识到你在其他需要的领域缺乏知识。此时，您可以重复四处寻找您需要学习的新项目的过程。

例如，也许你想学习 Rails，所以你开始学习 Rails 教程，但你意识到你对 Ruby 很烂。所以你开始更多地关注 Ruby 的细节，然后带着更多的知识回到 Rails 并继续直到下一个障碍。这并不完全正确，但你明白了。

您不会总能找到如何使用所有内容的完整指南。如果你有时间，试一试，自己解决

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-18T19:19:45.940

一个人可以学到的东西是无穷无尽的。也许更好的方法是考虑一个您感兴趣的项目，或者加入一个开源项目，然后了解您需要知道什么来完成该项目所需的内容。完成后，选择一个新项目，其中可能包含上一个项目中没有学到的新东西。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-18T19:21:06.827

就免费资源而言，作为 .NET 程序员，我喜欢 www.asp.net，还有很多其他资源，例如[http://quickstarts.asp.net/QuickStartv20/default 上的 ASP.NET 快速入门教程。 aspx](http://quickstarts.asp.net/QuickStartv20/default.aspx)，如果您不介意 C#，C-SharpCorner 也很好 [。](http://www.c-sharpcorner.com/)

如果您不反对花一点钱，Lynda.com 是一个不错的地方。他们有各种各样的教程，不仅仅是编程，而且我使用他们的教程之一在 Javascript 方面有了不错的基础。他们一直在添加新东西，所以如果他们现在在 Hibernate 上没有任何东西，他们可能会在以后。我认为他们的基本费用是每月 25 美元，但您可以支付一个月的费用，然后尽可能多地学习课程。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-18T19:22:27.043

在这里提出更具体的问题会得到更具体的答案。当我想阅读一些东西时，我通常会先去维基百科，然后再去谷歌。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-18T19:24:03.513

事实上，我们没有人有时间阅读我们想阅读的所有内容。所以我让别人替我做！

我解决这个问题的方法是快速阅读网络 - 也就是。订阅和阅读其他人的博客。

每次遇到不熟悉的东西我都会google。

# sql - “在组中选择最大值”的最佳性能查询？

> ID：95866
> 
> 赞同：14
> 
> 时间：2008-09-18T19:13:00.997
> 
> 标签：sql, database

我有一个简单的表格注释`(id INT, revision INT, comment VARCHAR(140))`，其中包含如下内容：

```
1|1|hallo1|
1|2|hallo2|
1|3|hallo3|
2|1|hallo1|
2|2|hallo2| 
```

我正在寻找一条 SQL 语句，它将返回具有最高修订版本的每条评论：

```
1|3|hallo3|
2|2|hallo2| 
```

我想出了这个解决方案：

```
select id, revision, comment 
  from comments 
  where revision = (
      select max(revision) 
        from comments as f 
        where f.id = comments.id
  ); 
```

但在大型数据集上非常慢。有没有更好的查询来完成这个？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-18T19:23:16.557

这是一种通过适当的索引不会非常慢并且不使用子选择的方法：

```
SELECT comments.ID, comments.revision, comments.comment FROM comments 
LEFT OUTER JOIN comments AS maxcomments 
ON maxcomments.ID= comments.ID
AND maxcomments.revision > comments.revision
WHERE maxcomments.revision IS NULL 
```

改编自这里的查询： [http ://www.xaprb.com/blog/2007/03/14/how-to-find-the-max-row-per-group-in-sql-without-subqueries/](http://www.xaprb.com/blog/2007/03/14/how-to-find-the-max-row-per-group-in-sql-without-subqueries/)

（来自谷歌搜索：max group by sql）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-18T19:16:57.820

1.  确保您已正确设置索引。在 id 上建立索引，修订会很好。

2.  这是对您的查询的不同看法。尚未检查其执行计划，但如果您设置好索引，它应该会有所帮助：

    ```
    SELECT c.* 
      FROM comments c
      INNER JOIN (
            SELECT id,max(revision) AS maxrev 
              FROM comments 
              GROUP BY id
      ) b
        ON c.id=b.id AND c.revision=b.maxrev 
    ```

编辑添加：

3.  如果您使用的是 SQL Server，您可能还想查看索引视图： http:
    [//www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx)

再次编辑以添加信息：

```
Subquery:
25157 records
2 seconds
Execution plan includes an Index Seek (82%) base and a Segment (17%)

Left Outer Join:
25160 records
3 seconds
Execution plan includes two Index Scans @ 22% each with a Right Outer Merge at 45% and a Filter at 11% 
```

我仍然会使用子查询。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-18T19:25:52.930

使用我们的一张表进行测试，该表总共有近 100 万行。字段FIELD2 和FIELD3 上都存在索引。在我们的开发盒上，查询在 3 秒内返回了 83953 行。

```
select
FIELD1, FIELD2, FIELD3
from
OURTABLE (nolock) T1
WHERE FIELD3 = 
(
SELECT MAX(FIELD3) FROM 
OURTABLE T2 (nolock)
WHERE T1.FIELD2=T2.FIELD2
)
ORDER BY FIELD2 DESC 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-22T16:54:43.533

分析将是我的建议。

```
select id, max_revision, comment
from (select c.id, c.comment, c.revision, max(c.revision)over(partition by c.id) as max_revision
      from comments c)
where revision = max_revision; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T16:48:24.883

对于大表，我发现此解决方案可以具有更好的性能：

```
 SELECT c1.id, 
           c1.revision, 
           c1.comment 
      FROM comments c1 
INNER JOIN ( SELECT id, 
                max(revision) AS max_revision
               FROM comments 
           GROUP BY id ) c2
        ON c1.id = c2.id
       AND c1.revision = c2.max_revision 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T10:43:40.993

执行“latest x by id”类型查询的一种非常干净的方法是这样。正确索引也应该很容易。

```
SELECT id, revision, comment 
FROM comments
WHERE (id, revision) IN (
  SELECT id, MAX(revision)
  FROM comments
  -- WHERE clause comes here if needed
  GROUP BY id
) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T20:25:26.220

来自左侧字段的想法，但是如何在表格中添加一个额外的字段：

```
CurrentRevision bit not null 
```

然后，当您进行更改时，在新修订上设置标志并在所有以前的修订上删除它。

然后，您的查询将简单地变为：

```
select  Id,
        Comment
from    Comments
where   CurrentRevision = 1 
```

这在数据库上会更容易，因此会更快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-07-23T09:29:41.743

没有子选择（或临时表）：

```
SELECT c1.ID, c1.revision, c1.comment 
FROM comments AS c1
LEFT JOIN comments AS c2 
    ON c1.ID = c2.ID
    AND c1.revision < c2.revision
WHERE c2.revision IS NULL 
```

# svn - SVN 的最佳 Web 前端？

> ID：95868
> 
> 赞同：25
> 
> 时间：2008-09-18T19:13:08.860
> 
> 标签：svn, version-control

我正在研究 SVN 存储库浏览器，鉴于那里有多少，这是一项令人厌烦的任务（我从[这里](http://subversion.tigris.org/links.html#browsers)开始）

“理想”系统将

*   在 Linux 上运行
*   易于使用，即使对于非开发人员类型
*   看起来不错（有一个体面的皮肤）
*   要么有内置的访问控制，要么用 PHP 编写，这样我就可以自己破解它，将它连接到[LDAP](http://en.wikipedia.org/wiki/LDAP)服务器之类的东西上。

基本上，我正在研究使用 SVN 前端作为资产交付系统的想法，将资产交付给需要只读访问权限且技术意识不强的其他员工（想想客户主管、项目经理等）需要易于使用/导航。而且我真的需要能够为每个文件夹设置读取权限——我们不能让每个人都拥有对整个存储库的完全读取权限。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-18T19:14:44.363

Trac.( [http://trac.edgewall.org/](http://trac.edgewall.org/) ) 它不是很好，但据我所见，SVN 是最好的。

使用访问控制启动。

我设法为各种 trac 用户设置了一个具有每个目录权限的装备（他们只是没有出现）。

有一段时间了。

默认皮肤看起来很不错，并且高度可调。

附带一个 wiki 和错误跟踪器，您可以根据需要禁用它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-22T07:31:48.317

Atlassian Fisheye [http://www.atlassian.com/software/fisheye/](http://www.atlassian.com/software/fisheye/)是我不能没有的商业鱼眼！

（完全披露......我受雇于 Atlassian，但我毫不含糊地说，Fisheye 是我用过的最好的鱼眼）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-21T18:04:57.757

[redmine](http://www.redmine.org/)是我们在工作中使用的。它类似于 trac，但提供了多个项目功能。浏览器的体面，允许对每个项目进行基于角色的权限，并且每个项目都基于存储库的一个子树。

还允许您浏览其他存储库类型，具有用于发布文件的文件存储和 wiki - 所有这些都可以在每个项目的基础上禁用或启用。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-01-19T11:00:59.283

[网络SVN](http://www.websvn.info/)？它是用 PHP 编写的，轻量级且简单。查看[演示](http://demo.websvn.info/listing.php)。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-18T19:44:46.007

ViewVC的主干开发版（设置为1.1版）支持访问控制。ViewVC 作为存储库查看器很有特色，使用直观，没有任何不必要的额外功能。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-22T07:29:44.593

[斯文顿](http://www.sventon.org/)看起来很有趣。它是在 svnkit Java 库之上编写的 servlet/jsp 解决方案。它可以充当真正的客户端，因此不需要直接访问存储库（例如 ViewVC）。它可以使用存储库本身的访问控制。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T22:56:40.450

我没有受雇于 Atlassian，而且 fisheye 很棒。我认为加入坩埚使它成为真正的胜利。（过去我使用过websvn，发现没问题）。我不太喜欢 viewVC 界面。有一些东西让我更难适应变化，我不知道是什么。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T08:05:27.273

[http://beanstalkapp.com/](http://beanstalkapp.com/)将托管您的存储库并同时使其可导航。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T08:01:32.620

我们使用 ViewVC 来浏览 CVS 和 SVN 存储库，但是自从我们切换到[FishEye](http://www.atlassian.com/software/fisheye)之后，我们终于有了一个非常好的代码浏览和检查解决方案。

我们还使用其他 Atlassian 产品（Jira 和 Confluence），它们之间的集成真是太棒了！

PS。我不是 Atlassian 员工 :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-10-27T13:45:10.513

你应该看看[http://www.groowiki.com](http://www.groowiki.com)

我们计划拥有您错过的访问控制功能，它在路线图上。我们还针对搜索、工作流支持，现在您可以使用 radeox 向文件和目录添加描述，并使用 Java 或 Groovy 编写插件。

是的，我隶属于 Groowiki。我写了它并计划进一步开发它。它也是免费和商业的。只有极少数功能是封闭（非开源）源代码，因此需要这些特定功能的大公司支持其开发。

# javascript - 如何检查是否在 JavaScript 中加载了变量？

> ID：95875
> 
> 赞同：25
> 
> 时间：2008-09-18T19:13:41.603
> 
> 标签：javascript, object

如何查看某个对象是否已加载，如果没有，如何加载，如下所示？

```
if (!isObjectLoaded(someVar)) {
    someVar= loadObject();
} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-18T19:18:07.710

如果它是一个对象，那么您应该能够检查它是否为[空](http://javascript.about.com/od/reference/g/rnull.htm)或[未定义](http://javascript.about.com/od/reference/g/sundefined.htm)，然后如果是则加载它。

```
if (myObject === null || myObject === undefined) {
   myObject = loadObject();
} 
```

使用[typeof](http://www.javascriptkit.com/javatutors/determinevar2.shtml)函数也是一种选择，因为它返回所提供对象的类型。但是，如果对象尚未加载，它将返回[null 或 undefined](http://www.javascriptkit.com/javatutors/determinevar2.shtml)，因此在可读性方面可能会归结为个人偏好。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-18T19:16:05.560

```
if(typeof(o) != 'object') o = loadObject(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-10-31T03:42:21.273

```
myObject = myObject || loadObject(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T19:20:43.613

我不确定您所说的“已加载”是什么意思...变量是否`object`存在并且根本没有您想要的类型？在这种情况下，你会想要这样的东西：

```
function isObjectType(obj, type) {
    return !!(obj && type && type.prototype && obj.constructor == type.prototype.constructor);
} 
```

然后使用`if (isObjectType(object, MyType)) { object = loadObject(); }`.

如果`object`在您的测试之前没有填充任何内容（即 - `typeof object === 'undefined'`），那么您只需要：

```
if ('undefined' === typeof object) { object = loadObject(); } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-18T19:22:12.923

您可能想查看是否*定义了给定对象*

特别是如果它在一个异步线程中完成，并带有 setTimeout 来检查它何时出现。

```
 var generate = function()
  { 
      window.foo = {}; 
  }; 
  var i = 0;
  var detect = function()
  {
     if( typeof window.foo == "undefined" ) 
     {
           alert( "Created!"); 
           clearInterval( i );
     }
   };
   setTimeout( generate, 15000 ); 
   i = setInterval( detect, 100 ); 
```

理论上应该检测 window.foo 何时存在。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-18T21:13:02.503

If by loaded you mean defined, you can check the type of the variable with the typeof function. **HOWEVER** typeof has a few quirks, and will identify an Object, an Array, and a **null** as an object

```
alert(typeof(null)); 
```

Identifying a null as a defined object would probably cause your program to fail, so check with something like

```
if(null !== x && 'object' == typeof(x)){
    alert("Hey, It's an object or an array; good enough!");
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-18T19:22:14.610

如果要检测自定义对象：

```
// craete a custom object
function MyObject(){

}

// check if it's the right kind of object
if(!(object instanceof MyObject)){
   object = new MyObject();
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-18T19:22:21.427

您也可以只使用快捷方式`if(obj)`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-18T19:15:53.050

`typeof(obj)`将在其他可能的值中返回类对象的“对象”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-09-23T00:02:02.100

```
if (!("someVar" in window)) {
  someVar = loadObject();
} 
```

will tell you whether any JS has previously assigned to the global `someVar` or declared a top-level `var someVar`.

That will work even if the loaded value is `undefined`.

# java - 从非常大的结果集中呈现数据的最佳方式是什么？

> ID：95886
> 
> 赞同：2
> 
> 时间：2008-09-18T19:14:44.597
> 
> 标签：java, hibernate, web-applications, jdbc

我正在编写审计跟踪的报告视图，我需要在 .jsp 中显示它。将数据从数据库获取到屏幕的“最佳”方式是什么？

我们使用 Spring 进行依赖注入、数据访问对象和 Hibernate。我可以为此报告使用休眠或直接 jdbc。

如果我将所有记录加载到内存中，我的内存就会用完。

任何不涉及在 jsp 中运行查询的想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-18T19:18:34.853

这似乎是使用 Hibernate 结果分页的自然场所——在 Servlet 级别运行查询，并以类似于此人描述的方式对结果进行分页：

[http://blog.hibernate.org/Bloggers/Everyone/Year/2004/Month/08/Day/14#pagination](http://blog.hibernate.org/Bloggers/Everyone/Year/2004/Month/08/Day/14#pagination)

这是我见过的实现 Hibernate 分页的最简单方法......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T23:55:24.953

显示[标记库](http://displaytag.org)非常擅长在 servlet 或 portlet 中呈现分页结果集。但它通常适用于加载到内存中的整个列表。因此，您必须做一些工作才能通过实现`org.displaytag.pagination.PaginatedList`接口使其与分页结果集一起使用。Display Tag 网站上有一个[教程。](http://displaytag.sourceforge.net/11/tut_externalSortAndPage.html)本教程没有太多内容，但是再次实现接口非常容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:15:48.417

只需使用分页，一次只在页面上加载一定数量的行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-17T22:10:24.037

另一种方法是使用 scroll() 一次流式传输一行。

# c++ - 什么是变量的链接和存储说明符？

> ID：95890
> 
> 赞同：11
> 
> 时间：2008-09-18T19:15:06.453
> 
> 标签：c++, c

当有人谈论变量存储类说明符时，他们在谈论什么？
他们还经常在同一上下文中谈论变量链接，那是什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-18T19:17:34.607

存储类说明符控制变量的*存储*和*链接*。这是两个不同的概念。C 为变量指定以下说明符：auto、extern、register、static。

**存储**
存储持续时间决定了您的变量将在 ram 中存在多长时间。
存储时长分为三种类型：静态、自动和动态。

*static*
如果您的变量是在文件范围内声明的，或者使用 extern 或 static 说明符，它将具有静态存储。只要程序正在执行，该变量就会存在。创建这些变量不会花费任何执行时间。

*自动*
如果变量在函数中声明，但**没有**extern 或 static 说明符，则它具有自动存储。该变量仅在您执行该函数时才存在。一旦你返回，变量就不再存在。自动存储通常在堆栈上完成。创建这些变量是一个非常快速的操作（只需将堆栈指针增加大小）。

*动态*
如果您使用 malloc（或 C++ 中的新功能），则您使用的是动态存储。在您调用 free（或删除）之前，此存储将一直存在。这是创建存储最昂贵的方式，因为系统必须动态管理分配和解除分配。

**Linkage**
Linkage 指定谁可以查看和引用该变量。联动分为内联动、外联动和无联动三种。

*无链接*
这个变量只在它被声明的地方可见。通常适用于函数中声明的变量。

*内部链接*
此变量将对文件中的所有函数（称为[翻译单元](https://stackoverflow.com/questions/28160/multiple-classes-in-a-header-file-vs-a-single-header-file-per-class)）可见，但其他文件将不知道它的存在。

*外部链接*
该变量将对其他翻译单元可见。这些通常被认为是“全局变量”。

这是一个描述基于说明符的存储和链接特性的表

```
  存储类函数文件
  说明符作用域  
-------------------------------------------------- ---
  无自动静态      
                 无联动 外联动

 外部静态静态
                 外联 外联

 静静静静
                 无联动内联动

  auto 自动无效
                 无联动

注册自动无效
                 无联动

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T19:26:05.647

变量存储类或类型说明符（如 volatile、auto 和 static）定义程序执行期间变量的保存方式/位置。例如，函数中定义的变量通常保存在堆栈中，这意味着函数返回后会丢失。使用“static”关键字，您可以强制编译器将变量放在内存中的数据段中，使变量内容在对该函数的调用之间保持不变。“register”关键字将导致编译器尽可能努力地将变量放入 CPU 寄存器中，这对于循环中的计数器等很有用。但是，它毕竟不能保证它实际上在寄存器中。

[在此处](http://www.space.unibe.ch/comp_doc/c_manual/C/CONCEPT/storage_class.html)阅读有关类型说明符的更多信息。

# c# - 如何在 C# 中检查一个日期时间是否大于另一个日期时间

> ID：95895
> 
> 赞同：126
> 
> 时间：2008-09-18T19:15:32.333
> 
> 标签：c#

我有两个`DateTime`对象：`StartDate`和`EndDate`. 我想确定`StartDate`是之前`EndDate`。这是如何在 C# 中完成的？

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2008-09-18T19:17:37.583

```
if (StartDate < EndDate)
   // code 
```

如果你只想要日期而不是时间

```
if (StartDate.Date < EndDate.Date)
    // code 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-18T19:17:15.400

```
if(StartDate < EndDate)
{} 
```

DateTime 支持普通的比较运算符。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-18T19:17:56.383

您可以使用重载的 < 或 > 运算符。

例如：

```
DateTime d1 = new DateTime(2008, 1, 1);
DateTime d2 = new DateTime(2008, 1, 2);
if (d1 < d2) { ... 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-18T19:17:58.223

```
if (StartDate>=EndDate)
{
    throw new InvalidOperationException("Ack!  StartDate is not before EndDate!");
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-18T19:17:32.560

```
StartDate < EndDate 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-08-20T13:18:11.070

这可能为时已晚，但为了让其他可能偶然发现这一点的人受益，我使用了一种扩展方法来做到这一点，`IComparable`如下所示：

```
public static class BetweenExtension
    {
        public static bool IsBetween<T>(this T value, T min, T max) where T : IComparable
        {
            return (min.CompareTo(value) <= 0) && (value.CompareTo(max) <= 0);
        }
    } 
```

使用此扩展方法`IComparable`使此方法更通用，并使其可用于多种数据类型，而不仅仅是日期。

你会像这样使用它：

```
DateTime start = new DateTime(2015,1,1);
DateTime end = new DateTime(2015,12,31);
DateTime now = new DateTime(2015,8,20);

if(now.IsBetween(start, end))
{
     //Your code here
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-18T19:17:30.563

查看 DateTime.Compare 方法

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-06-03T21:06:22.743

我有同样的要求，但是当使用接受的答案时，它并没有满足我所有的单元测试。对我来说问题是当你有一个新对象时，有开始和结束日期，你必须设置开始日期（在这个阶段你的结束日期的最小日期值为 01/01/0001） - 这个解决方案确实通过了所有我的单元测试：

```
 public DateTime Start
    {
        get { return _start; }
        set
        {
            if (_end.Equals(DateTime.MinValue))
            {
                _start = value;
            }
            else if (value.Date < _end.Date)
            {
                _start = value;
            }
            else
            {
                throw new ArgumentException("Start date must be before the End date.");
            }
        }
    }

    public DateTime End
    {
        get { return _end; }
        set
        {
            if (_start.Equals(DateTime.MinValue))
            {
                _end = value;
            }
            else if (value.Date > _start.Date)
            {
                _end = value;
            }
            else
            {
                throw new ArgumentException("End date must be after the Start date.");
            }
        }
    } 
```

它确实错过了开始日期和结束日期都可以是 01/01/0001 的边缘情况，但我并不担心。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-18T19:18:13.760

```
 if (new DateTime(5000) > new DateTime(1000))
        {
            Console.WriteLine("i win");
        } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-11T14:55:19.417

我想证明，如果您转换为 .Date ，您无需担心小时/分钟/秒等：

```
 [Test]
    public void ConvertToDateWillHaveTwoDatesEqual()
    {
        DateTime d1 = new DateTime(2008, 1, 1);
        DateTime d2 = new DateTime(2008, 1, 2);
        Assert.IsTrue(d1 < d2);

        DateTime d3 = new DateTime(2008, 1, 1,7,0,0);
        DateTime d4 = new DateTime(2008, 1, 1,10,0,0);
        Assert.IsTrue(d3 < d4);
        Assert.IsFalse(d3.Date < d4.Date);
    } 
```

# .net - 每个人都在查看网页的客户端视图

> ID：95909
> 
> 赞同：1
> 
> 时间：2008-09-18T19:16:30.723
> 
> 标签：.net, asp.net, sql-server, vb.net, ajax

首先让我说，我在这个问题上真的感到无方向。我正在使用 windows 集成安全，我可以使用 vb.net 从 AD 中查找有关用户的信息。我还有其他关于用户的信息，我可以通过获取登录身份名称从 MS SQL 2005 服务器中查找。

我想做的是向任何一个查看网页的用户显示有关所有积极查看网页的用户的信息。信息来自 AD 和 SQL，我可以毫无问题地检索它。

到目前为止，我的路线一直使用 SQL 来存储用户首次加载页面的时间。我不知道如何在用户*离开*页面时显示。我尝试使用 ajax 计时器每隔一秒更新一次用户访问的时间戳，这也会触发表将状态更改为未在 5 秒内更新的任何记录的非活动状态。这仅适用于少数用户，但我发现当我有超过几个人查看该页面时，1 秒更新是不可靠的。当用户最小化页面时，我似乎也有问题。这有时会停止来自 ajax 计时器的更新，并在用户仍在查看页面时将其踢出列表。

此功能对其所在站点的功能并不重要，因此一年多前我就放弃了它。从那时起，我真的很痛苦，我想不出办法来完成这项工作。我的搜索使我走上了许多徒劳无功的道路，因此我真的很感激可以提供的任何帮助，即使它只是朝着正确方向前进的线索。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-18T19:29:13.923

答案可能取决于您需要显示的准确度。如果只是为了让用户了解其他人在使用该网站，我会建议类似于您所描述的内容，但会在更新频率上有所退让：

*   在页面请求上将用户与页面（和时间戳）相关联
*   使用 Ajax 计时器每分钟左右更新时间戳
*   通过 window.onbeforeunload 事件（或类似事件）终止关联
*   假设任何早于一分钟（和一点）的时间戳都已失效

您可以尝试捕捉人们离开页面的一些方式，但这绝不是万无一失的。关于最小化页面，我想他们是否真的在查看页面是有争议的；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T19:20:29.887

我认为您能做的最好的事情就是为“访问页面”设置一个阈值。让自动化任务每 60、120、300 或某些秒数运行一次，以清除任何早于指定时间量的条目。当用户离开页面时，没有办法可靠地检测（我知道）。您可以做的最好的事情是“假设”用户在经过一定时间后停止使用该网站。因此，您将存储用户、页面和查看时间。一旦查看的时间超过了您的阈值，请将其删除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:21:48.090

我不认为每秒都有一个 AJAX 请求是一个好主意，它太健谈了。

我认为大多数人通过仅记录某人何时向站点发出请求以及从那时起`threshold`用户正在“访问”该站点来实现此功能。如果用户在到达之前没有发出另一个服务器请求，`threshold`那么我们假设他们已经继续前进。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:25:52.463

在页面上安装一个小型 Flash 应用程序如何从服务器流式传输微小的“心跳”数据流……足以让服务器知道何时丢弃了流，从而知道客户端何时离开从页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:21:09.137

对于正文有一个 onunload 脚本：< body onunload="userLeftPage()"

在该脚本中，发送一个 ajax 调用来说明用户离开了页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-21T16:28:21.827

第一个答案有效。

但...

您没有提到用户已登录，所以我怀疑这不是您正在查看的内容。但是，如果您只是每分钟左右请求登录用户列表，您当然可以简化事情。

# c# - 使用反射找到一个私有字段？

> ID：95910
> 
> 赞同：256
> 
> 时间：2008-09-18T19:16:32.300
> 
> 标签：c#, .net, reflection, .net-attributes

鉴于这个类

```
class Foo
{
    // Want to find _bar with reflection
    [SomeAttribute]
    private string _bar;

    public string BigBar
    {
        get { return this._bar; }
    }
} 
```

我想找到我将用属性标记的私有项目 _bar。那可能吗？

我已经在我寻找属性的属性中完成了此操作，但从未寻找私有成员字段。

我需要设置哪些绑定标志来获取私有字段？

* * *

## 回答 #1

> 赞同：317
> 
> 时间：2008-09-18T19:22:27.183

使用`BindingFlags.NonPublic`和`BindingFlags.Instance`标志

```
FieldInfo[] fields = myType.GetFields(
                         BindingFlags.NonPublic | 
                         BindingFlags.Instance); 
```

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2008-09-18T19:21:39.400

您可以像使用属性一样执行此操作：

```
FieldInfo fi = typeof(Foo).GetField("_bar", BindingFlags.NonPublic | BindingFlags.Instance);
if (fi.GetCustomAttributes(typeof(SomeAttribute)) != null)
    ... 
```

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2011-12-09T08:19:18.210

使用反射获取私有变量的值：

```
var _barVariable = typeof(Foo).GetField("_bar", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(objectForFooClass); 
```

使用反射设置私有变量的值：

```
typeof(Foo).GetField("_bar", BindingFlags.NonPublic | BindingFlags.Instance).SetValue(objectForFoocClass, "newValue"); 
```

其中 objectForFooClass 是类类型 Foo 的非空实例。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-18T19:26:11.963

在考虑私有成员时需要注意的一件事是，如果您的应用程序以中等信任度运行（例如，当您在共享托管环境中运行时），它将找不到它们—— BindingFlags.NonPublic 选项将被忽略。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2017-09-29T12:28:01.220

## 带有扩展方法的好语法

您可以使用如下代码访问任意类型的任何私有字段：

```
Foo foo = new Foo();
string c = foo.GetFieldValue<string>("_bar"); 
```

为此，您需要定义一个可以为您完成工作的扩展方法：

```
public static class ReflectionExtensions {
    public static T GetFieldValue<T>(this object obj, string name) {
        // Set the flags so that private and public fields from instances will be found
        var bindingFlags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance;
        var field = obj.GetType().GetField(name, bindingFlags);
        return (T)field?.GetValue(obj);
    }
} 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-09-18T19:19:40.090

```
typeof(MyType).GetField("fieldName", BindingFlags.NonPublic | BindingFlags.Instance) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-11-24T07:49:49.230

我个人使用这种方法

```
if (typeof(Foo).GetFields(BindingFlags.NonPublic | BindingFlags.Instance).Any(c => c.GetCustomAttributes(typeof(SomeAttribute), false).Any()))
{ 
    // do stuff
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2014-05-30T11:54:24.243

下面是一些用于简单获取和设置私有字段和属性（带有 setter 的属性）的扩展方法：

用法示例：

> ```
>  public class Foo
>     {
>         private int Bar = 5;
>     }
> 
>     var targetObject = new Foo();
>     var barValue = targetObject.GetMemberValue("Bar");//Result is 5
>     targetObject.SetMemberValue("Bar", 10);//Sets Bar to 10 
> ```

代码：

```
 /// <summary>
    /// Extensions methos for using reflection to get / set member values
    /// </summary>
    public static class ReflectionExtensions
    {
        /// <summary>
        /// Gets the public or private member using reflection.
        /// </summary>
        /// <param name="obj">The source target.</param>
        /// <param name="memberName">Name of the field or property.</param>
        /// <returns>the value of member</returns>
        public static object GetMemberValue(this object obj, string memberName)
        {
            var memInf = GetMemberInfo(obj, memberName);

            if (memInf == null)
                throw new System.Exception("memberName");

            if (memInf is System.Reflection.PropertyInfo)
                return memInf.As<System.Reflection.PropertyInfo>().GetValue(obj, null);

            if (memInf is System.Reflection.FieldInfo)
                return memInf.As<System.Reflection.FieldInfo>().GetValue(obj);

            throw new System.Exception();
        }

        /// <summary>
        /// Gets the public or private member using reflection.
        /// </summary>
        /// <param name="obj">The target object.</param>
        /// <param name="memberName">Name of the field or property.</param>
        /// <returns>Old Value</returns>
        public static object SetMemberValue(this object obj, string memberName, object newValue)
        {
            var memInf = GetMemberInfo(obj, memberName);

            if (memInf == null)
                throw new System.Exception("memberName");

            var oldValue = obj.GetMemberValue(memberName);

            if (memInf is System.Reflection.PropertyInfo)
                memInf.As<System.Reflection.PropertyInfo>().SetValue(obj, newValue, null);
            else if (memInf is System.Reflection.FieldInfo)
                memInf.As<System.Reflection.FieldInfo>().SetValue(obj, newValue);
            else
                throw new System.Exception();

            return oldValue;
        }

        /// <summary>
        /// Gets the member info
        /// </summary>
        /// <param name="obj">source object</param>
        /// <param name="memberName">name of member</param>
        /// <returns>instanse of MemberInfo corresponsing to member</returns>
        private static System.Reflection.MemberInfo GetMemberInfo(object obj, string memberName)
        {
            var prps = new System.Collections.Generic.List<System.Reflection.PropertyInfo>();

            prps.Add(obj.GetType().GetProperty(memberName,
                                               System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance |
                                               System.Reflection.BindingFlags.FlattenHierarchy));
            prps = System.Linq.Enumerable.ToList(System.Linq.Enumerable.Where( prps,i => !ReferenceEquals(i, null)));
            if (prps.Count != 0)
                return prps[0];

            var flds = new System.Collections.Generic.List<System.Reflection.FieldInfo>();

            flds.Add(obj.GetType().GetField(memberName,
                                            System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance |
                                            System.Reflection.BindingFlags.FlattenHierarchy));

            //to add more types of properties

            flds = System.Linq.Enumerable.ToList(System.Linq.Enumerable.Where(flds, i => !ReferenceEquals(i, null)));

            if (flds.Count != 0)
                return flds[0];

            return null;
        }

        [System.Diagnostics.DebuggerHidden]
        private static T As<T>(this object obj)
        {
            return (T)obj;
        }
    } 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-18T19:18:18.737

是的，但是您需要设置绑定标志来搜索私有字段（如果您在类实例之外寻找成员）。

您需要的绑定标志是：System.Reflection.BindingFlags.NonPublic

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-03-31T11:47:46.550

我在谷歌上搜索这个时遇到了这个，所以我意识到我正在撞一个旧帖子。但是 GetCustomAttributes 需要两个参数。

```
typeof(Foo).GetFields(BindingFlags.NonPublic | BindingFlags.Instance)
.Where(x => x.GetCustomAttributes(typeof(SomeAttribute), false).Length > 0); 
```

第二个参数指定是否要搜索继承层次结构

# windows-7 - 如何检测我的进程是否正在运行 UAC 提升？

> ID：95912
> 
> 赞同：42
> 
> 时间：2008-09-18T19:16:53.733
> 
> 标签：windows-7, windows-vista, uac, elevation

我的 Vista 应用程序需要知道用户是“作为管理员”（提升）还是作为标准用户（非提升）启动它。如何在运行时检测到它？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-22T12:54:25.357

对于我们这些使用 C# 工作的人，在 Windows SDK 中有一个“UACDemo”应用程序作为“交叉技术示例”的一部分。他们使用此方法查找当前用户是否是管理员：

```
private bool IsAdministrator
{
    get
    {
        WindowsIdentity wi = WindowsIdentity.GetCurrent();
        WindowsPrincipal wp = new WindowsPrincipal(wi);

        return wp.IsInRole(WindowsBuiltInRole.Administrator);
    }
} 
```

（注意：我将原始代码重构为属性，而不是“if”语句）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-18T19:17:11.283

以下 C++ 函数可以做到这一点：

```
HRESULT GetElevationType( __out TOKEN_ELEVATION_TYPE * ptet );

/*
Parameters:

ptet
    [out] Pointer to a variable that receives the elevation type of the current process.

    The possible values are:

    TokenElevationTypeDefault - This value indicates that either UAC is disabled, 
        or the process is started by a standard user (not a member of the Administrators group).

    The following two values can be returned only if both the UAC is enabled
    and the user is a member of the Administrator's group:

    TokenElevationTypeFull - the process is running elevated. 

    TokenElevationTypeLimited - the process is not running elevated.

Return Values:

    If the function succeeds, the return value is S_OK. 
    If the function fails, the return value is E_FAIL. To get extended error information, call GetLastError().

Implementation:
*/

HRESULT GetElevationType( __out TOKEN_ELEVATION_TYPE * ptet )
{
    if ( !IsVista() )
        return E_FAIL;

    HRESULT hResult = E_FAIL; // assume an error occurred
    HANDLE hToken   = NULL;

    if ( !::OpenProcessToken( 
                ::GetCurrentProcess(), 
                TOKEN_QUERY, 
                &hToken ) )
    {
        return hResult;
    }

    DWORD dwReturnLength = 0;

    if ( ::GetTokenInformation(
                hToken,
                TokenElevationType,
                ptet,
                sizeof( *ptet ),
                &dwReturnLength ) )
    {
            ASSERT( dwReturnLength == sizeof( *ptet ) );
            hResult = S_OK;
    }

    ::CloseHandle( hToken );

    return hResult;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-01-23T00:10:10.633

我不认为海拔类型是你想要的答案。您只想知道它是否升高。调用 GetTokenInformation 时使用 TokenElevation 而不是 TokenElevationType。如果结构返回正值，则用户是管理员。如果为零，则用户是正常海拔。

这是一个德尔福解决方案：

```
function TMyAppInfo.RunningAsAdmin: boolean;
var
  hToken, hProcess: THandle;
  pTokenInformation: pointer;
  ReturnLength: DWord;
  TokenInformation: TTokenElevation;
begin
  hProcess := GetCurrentProcess;
  try
    if OpenProcessToken(hProcess, TOKEN_QUERY, hToken) then try
      TokenInformation.TokenIsElevated := 0;
      pTokenInformation := @TokenInformation;
      GetTokenInformation(hToken, TokenElevation, pTokenInformation, sizeof(TokenInformation), ReturnLength);
      result := (TokenInformation.TokenIsElevated > 0);
    finally
      CloseHandle(hToken);
    end;
  except
   result := false;
  end;
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-16T16:51:22.963

这是一个检查（当前）进程是否被提升的VB6实现

```
Option Explicit

'--- for OpenProcessToken
Private Const TOKEN_QUERY                   As Long = &H8
Private Const TokenElevation                As Long = 20

Private Declare Function GetCurrentProcess Lib "kernel32" () As Long
Private Declare Function OpenProcessToken Lib "advapi32" (ByVal ProcessHandle As Long, ByVal DesiredAccess As Long, TokenHandle As Long) As Long
Private Declare Function GetTokenInformation Lib "advapi32" (ByVal TokenHandle As Long, ByVal TokenInformationClass As Long, TokenInformation As Any, ByVal TokenInformationLength As Long, ReturnLength As Long) As Long
Private Declare Function CloseHandle Lib "kernel32" (ByVal hObject As Long) As Long

Public Function IsElevated(Optional ByVal hProcess As Long) As Boolean
    Dim hToken          As Long
    Dim dwIsElevated    As Long
    Dim dwLength        As Long

    If hProcess = 0 Then
        hProcess = GetCurrentProcess()
    End If
    If OpenProcessToken(hProcess, TOKEN_QUERY, hToken) <> 0 Then
        If GetTokenInformation(hToken, TokenElevation, dwIsElevated, 4, dwLength) <> 0 Then
            IsElevated = (dwIsElevated <> 0)
        End If
        Call CloseHandle(hToken)
    End If
End Function 
```

# python - Python读取Oracle路径

> ID：95950
> 
> 赞同：1
> 
> 时间：2008-09-18T19:19:43.710
> 
> 标签：python, oracle, pylons, cx-oracle

在我的桌面上，我编写了一个连接到 Oracle 的小型 Pylons 应用程序。我现在正在尝试将它部署到运行 Win2k3 x64 的服务器上。（我的桌面是 32 位 XP） 服务器上的 Oracle 安装也是 64 位的。

我在加载 OCI dll 时遇到错误，因此我将 32 位客户端安装到`C:\oracle32`.

如果我将它添加到`PATH`环境变量中，效果很好。但我也想将 Pylons 应用程序作为服务运行（[使用这个配方](http://wiki.pylonshq.com/display/pylonscookbook/How+to+run+Pylons+as+a+Windows+service)），并且不想将这个 32 位库放在所有其他应用程序的路径上。

我尝试使用`sys.path.append("C:\\oracle32\\bin")`，但这似乎不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T19:26:04.367

sys.path 是 python 对 PYTHONPATH 的内部表示，听起来你想修改 PATH。

我不确定这是否可行，但您可以尝试：

```
import os
os.environ['PATH'] += os.pathsep + "C:\\oracle32\\bin" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-27T02:21:39.943

如果您的 Python 应用程序在 64 位空间中运行，您将需要访问 Oracle 的 oci.dll 的 64 位安装，而不是 32 位版本。通常，在运行脚本之前，您会更新系统路径以包含适当的 Oracle Home bin 目录。该解决方案也可能因您用于从 Python 访问 Oracle 的组件而异。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T02:58:07.503

在执行 python.exe 之前，您需要将 c:\Oracle32\bin 目录附加到环境的 PATH 变量中。
在 Linux 中，出于类似原因，我需要设置 LD_LIBRARY_PATH 变量，以在调用 python 之前找到 Oracle 库。我使用设置变量然后调用 Python 的包装器 shell 脚本。
在您的情况下，也许您可​​以在服务启动中调用设置 PATH 变量的 .cmd 或 .vbs 脚本，然后使用您的 .py 脚本调用 python.exe 。

我希望这有帮助！

# c# - 代表不只是简写接口吗？

> ID：95954
> 
> 赞同：11
> 
> 时间：2008-09-18T19:20:24.503
> 
> 标签：c#, delegates, interface

假设我们有：

```
interface Foo 
{
 bool Func(int x);
}

class Bar: Foo
{
  bool Func(int x)
  {
   return (x>0);
  }  
}

class Baz: Foo
{
  bool Func(int x)
  {
   return (x<0);
  }  
} 
```

现在我们可以将 Bar 和 Baz 作为 Foos 折腾并调用它们的 Func 方法。

代表简化了这一点：

```
delegate bool Foo(int x);

bool Bar(int x)
{
 return (x<0);
}

bool Baz(int x)
{
 return (x>0);
} 
```

现在我们可以将 Bar 和 Baz 作为 Foo 代表折腾。

除了获得更短的代码之外，委托的真正好处是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-18T19:29:00.100

有一点不同，委托可以访问定义它们的类的成员变量。在 C#（与 Java 不同）中，所有内部类都被认为是静态的。因此，如果您使用接口来管理回调，例如按钮的 ActionListener。实现内部类需要（通过构造函数）传递对包含类的部分的引用，在回调期间它可能需要与之交互。委托没有此限制，因此减少了实现回调所需的代码量。

更短、更简洁的代码也是一个有价值的好处。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-18T19:29:56.667

从软件工程的角度来看，你是对的，委托很像函数接口，因为它们是函数接口的原型。

它们也可以以同样的方式使用：与其传递一个包含您需要的方法的整个类，您可以只传递一个委托。这样可以节省大量代码并创建更具可读性的代码。

此外，随着 lambda 表达式的出现，它们现在也可以在运行中轻松定义，这是一个巨大的好处。虽然可以在 C# 中动态构建类，但这确实是一个巨大的痛苦。

比较两者是一个有趣的概念。从用例和代码结构的角度来看，我以前没有考虑过这些想法有多相似。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T19:33:56.407

从调用者的角度来看，委托确实与具有单一方法的接口引用有很多共同点。

在第一个示例中，Baz 和 Bar 是可以继承和实例化的类。在第二个示例中，Baz 和 Bar 是方法。

您不能仅将接口引用应用于与接口协定匹配的任何类。该类必须显式声明它支持该接口。您可以将委托引用应用于与签名匹配的任何方法。

您不能在接口的合同中包含静态方法。（尽管您可以使用扩展方法来固定静态方法）。您可以使用委托引用来引用静态方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:22:28.213

不，委托用于方法指针。然后，您可以确保与委托关联的方法的签名是正确的。

另外，你不需要知道类的结构。这样，您可以使用您编写的方法传递给另一个类中的方法，并定义您希望发生的功能。

使用 Find 方法查看[List<> 类](http://msdn.microsoft.com/en-us/library/x0b5b5bc.aspx)。现在您可以定义什么来确定某物是否匹配，而不需要类中包含的项目来实现 IListFindable 或类似的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T19:23:20.037

您可以在函数中将委托作为参数传递（从技术上讲，委托在编译时会成为对象，但这不是重点）。您可以将对象作为参数传递（显然），但随后您将该类型的对象作为参数绑定到函数。使用委托，您可以传递任何函数以在具有相同签名的代码中执行，无论它来自何处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T19:24:35.383

可以将委托视为一种方法的接口，它定义了方法必须具有哪些参数和返回类型才能适合委托

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-18T19:24:34.760

委托是一个类型化的方法指针。这为您提供了比接口更大的灵活性，因为您可以利用协变和逆变，并且可以修改对象状态（您必须使用基于接口的函子传递 this 指针）。

此外，委托有很多很好的语法糖，可以让您轻松地将它们组合在一起。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T19:26:03.993

是的，可以将委托视为具有一种方法的接口。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-18T19:41:00.213

接口和委托是两个完全不同的东西，虽然我理解为了便于理解而用类似接口的术语来描述委托的诱惑......但是，不知道真相可能会导致混乱。

代表们受到启发（部分）是因为 C++ 方法指针的黑魔法不足以满足某些目的。一个典型的例子是实现消息传递或事件处理机制。委托允许您在不了解类的类型或接口的情况下定义方法签名——我可以定义一个“void eventHandler(Event* e)”委托并在任何实现它的类上调用它。

对于这个经典问题的一些见解，以及为什么代表是可取的[阅读this](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)然后[this](http://www.codeproject.com/KB/cpp/fd.aspx)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-05T14:48:13.853

在至少一个向 Java 添加闭包（即匿名委托）的提议中，它们等同于具有单个成员方法的接口。

# c++ - FindNextFile 在 64 位 Windows 上失败？

> ID：95956
> 
> 赞同：11
> 
> 时间：2008-09-18T19:20:33.083
> 
> 标签：c++, 64-bit, c++builder

使用 C++Builder 2007，FindFirstFile 和 FindNextFile 函数似乎无法在 64 位版本的 Vista 和 XP 上找到某些文件。我的测试应用程序是 32 位的。

如果我使用它们遍历文件夹 C:\Windows\System32\Drivers 他们只会找到少数文件，尽管当我在命令提示符下发出 dir 命令时有 185 个文件。使用相同的示例代码可以在 32 位版本的 XP 上列出所有文件。

这是一个小示例程序：

```
int main(int argc, char* argv[])
{
  HANDLE hFind;
  WIN32_FIND_DATA FindData;
  int ErrorCode;
  bool cont = true;

  cout << "FindFirst/Next demo." << endl << endl;

  hFind = FindFirstFile("*.*", &FindData);
  if(hFind == INVALID_HANDLE_VALUE)
  {
    ErrorCode = GetLastError();
    if (ErrorCode == ERROR_FILE_NOT_FOUND)
    {
      cout << "There are no files matching that path/mask\n" << endl;
    }
    else
    {
      cout << "FindFirstFile() returned error code " << ErrorCode << endl;
    }
    cont = false;
  }
  else
  {
    cout << FindData.cFileName << endl;
  }

  if (cont)
  {
    while (FindNextFile(hFind, &FindData))
    {
      cout << FindData.cFileName << endl;
    }

    ErrorCode = GetLastError();
    if (ErrorCode == ERROR_NO_MORE_FILES)
    {
      cout << endl << "All files logged." << endl;
    }
    else
    {
      cout << "FindNextFile() returned error code " << ErrorCode << endl;
    }

    if (!FindClose(hFind))
    {
      ErrorCode = GetLastError();
      cout << "FindClose() returned error code " << ErrorCode << endl;
    }
  }
  return 0;
} 
```

在 64 位 XP 上的 C:\Windows\System32\Drivers 文件夹中运行它会返回：

```
C:\WINDOWS\system32\drivers>t:\Project1.exe
FindFirst/Next demo.

.
..
AsIO.sys
ASUSHWIO.SYS
hfile.txt
raspti.zip
stcp2v30.sys
truecrypt.sys

All files logged. 
```

同一系统上的 dir 命令返回以下内容：

```
C:\WINDOWS\system32\drivers>dir/p
 Volume in drive C has no label.
 Volume Serial Number is E8E1-0F1E

 Directory of C:\WINDOWS\system32\drivers

16-09-2008  23:12    <DIR>          .
16-09-2008  23:12    <DIR>          ..
17-02-2007  00:02            80.384 1394bus.sys
16-09-2008  23:12             9.453 a.txt
17-02-2007  00:02           322.560 acpi.sys
29-03-2006  14:00            18.432 acpiec.sys
24-03-2005  17:11           188.928 aec.sys
21-06-2008  15:07           291.840 afd.sys
29-03-2006  14:00            51.712 amdk8.sys
17-02-2007  00:03           111.104 arp1394.sys
08-05-2006  20:19             8.192 ASACPI.sys
29-03-2006  14:00            25.088 asyncmac.sys
17-02-2007  00:03           150.016 atapi.sys
17-02-2007  00:03           106.496 atmarpc.sys
29-03-2006  14:00            57.344 atmepvc.sys
17-02-2007  00:03            91.648 atmlane.sys
17-02-2007  00:03           569.856 atmuni.sys
24-03-2005  19:12             5.632 audstub.sys
29-03-2006  14:00             6.144 beep.sys
Press any key to continue . . .
etc. 
```

我很困惑。这是什么原因？

布赖恩

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-18T19:28:05.250

是否正在进行重定向？请参阅 Wow64DisableWow64FsRedirection 上的备注 [http://msdn.microsoft.com/en-gb/library/aa365743.aspx](http://msdn.microsoft.com/en-gb/library/aa365743.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T19:42:22.610

我在 MSDN 上找到了这个：

*如果您正在编写一个 32 位应用程序来列出目录中的所有文件，并且该应用程序可能在 64 位计算机上运行，​​您应该在调用 FindFirstFile 之前调用 Wow64DisableWow64FsRedirection 函数，并在最后一次调用 FindNextFile 之后调用 Wow64RevertWow64FsRedirection 函数。有关详细信息，请参阅文件系统重定向器。*

[这是链接](http://msdn.microsoft.com/en-us/library/aa364418(VS.85).aspx)

因此，我将不得不更新我的代码:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:44:30.033

知道了：

[http://msdn.microsoft.com/en-gb/library/aa384187(VS.85).aspx](http://msdn.microsoft.com/en-gb/library/aa384187(VS.85).aspx)

当 32 位应用程序从 64 位操作系统上的这些文件夹之一读取时：

```
%windir%\system32\catroot
%windir%\system32\catroot2
%windir%\system32\drivers\etc
%windir%\system32\logfiles
%windir%\system32\spool 
```

Windows 实际上列出了以下内容：

```
%windir%\SysWOW64\catroot
%windir%\SysWOW64\catroot2
%windir%\SysWOW64\drivers\etc
%windir%\SysWOW64\logfiles
%windir%\SysWOW64\spool 
```

感谢您的意见克里斯，这帮助我找出发生了什么。

编辑：也谢谢你 Ludvig :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:25:53.027

您确定它与 dir 命令在同一目录中查找吗？他们似乎没有任何共同的文件。

此外，这不是问题，但“所有文件”的正确通配符是 *

*.* 表示“名称中至少有一个 . 的所有文件”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:38:45.397

编译时有警告吗？

您是否为此特定测试打开了**所有**警告（因为它不起作用）？

确保首先解决警告。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T19:40:55.127

示例代码没有问题。我还有另一个应用程序也失败了，它是用 Delphi 编写的。我想我根据 Kris 关于重定向的回答找到了答案：http: [//msdn.microsoft.com/en-gb/library/aa364418 (VS.85).aspx](http://msdn.microsoft.com/en-gb/library/aa364418(VS.85).aspx)

# sql - 如何列出 SQL Server 表的主键？

> ID：95967
> 
> 赞同：123
> 
> 时间：2008-09-18T19:22:04.470
> 
> 标签：sql, sql-server, tsql

简单的问题，如何用 T-SQL 列出表的主键？我知道如何获取表上的索引，但不记得如何获取 PK。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-09-18T19:29:07.260

```
SELECT Col.Column_Name from 
    INFORMATION_SCHEMA.TABLE_CONSTRAINTS Tab, 
    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE Col 
WHERE 
    Col.Constraint_Name = Tab.Constraint_Name
    AND Col.Table_Name = Tab.Table_Name
    AND Constraint_Type = 'PRIMARY KEY'
    AND Col.Table_Name = '<your table name>' 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2015-09-10T20:26:24.247

现在通常建议在 SQL Server 中使用`sys.*`视图`INFORMATION_SCHEMA`，所以除非您计划迁移数据库，否则我会使用这些。以下是您将如何处理`sys.*`视图：

```
SELECT 
    c.name AS column_name,
    i.name AS index_name,
    c.is_identity
FROM sys.indexes i
    inner join sys.index_columns ic  ON i.object_id = ic.object_id AND i.index_id = ic.index_id
    inner join sys.columns c ON ic.object_id = c.object_id AND c.column_id = ic.column_id
WHERE i.is_primary_key = 1
    and i.object_ID = OBJECT_ID('<schema>.<tablename>'); 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-05-16T09:19:34.840

这是一个仅使用**sys** -tables 的解决方案。

它列出了数据库中的所有主键。它为每个主键返回**架构、表名、列名**和正确的**列排序顺序。**

如果要获取特定表的主键，则需要对**`SchemaName`**and进行过滤**`TableName`**。

恕我直言，这个解决方案非常通用，不使用任何字符串文字，因此它可以在任何机器上运行。

```
select 
    s.name as SchemaName,
    t.name as TableName,
    tc.name as ColumnName,
    ic.key_ordinal as KeyOrderNr
from 
    sys.schemas s 
    inner join sys.tables t   on s.schema_id=t.schema_id
    inner join sys.indexes i  on t.object_id=i.object_id
    inner join sys.index_columns ic on i.object_id=ic.object_id 
                                   and i.index_id=ic.index_id
    inner join sys.columns tc on ic.object_id=tc.object_id 
                             and ic.column_id=tc.column_id
where i.is_primary_key=1 
order by t.name, ic.key_ordinal ; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-18T19:31:08.473

在使用 MS SQL Server 时，您可以执行以下操作：

```
--List all tables primary keys
select * from information_schema.table_constraints
where constraint_type = 'Primary Key' 
```

如果您想要一个特定的表，您还可以过滤 table_name 列。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-06-04T18:52:27.273

这是问题[get table primary key using sql query](https://stackoverflow.com/q/3930338/1366033)的另一种方法：

```
SELECT COLUMN_NAME
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE OBJECTPROPERTY(OBJECT_ID(CONSTRAINT_SCHEMA+'.'+CONSTRAINT_NAME), 'IsPrimaryKey') = 1
  AND TABLE_NAME = '*<your table name>*' 
```

它用于[`KEY_COLUMN_USAGE`](http://msdn.microsoft.com/en-us/library/ms189789.aspx)确定给定表的约束
然后用于确定每个表是否是主键[`OBJECTPROPERTY(*id*, 'IsPrimaryKey')`](http://msdn.microsoft.com/en-us/library/ms176105.aspx)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-07T16:06:22.087

我喜欢 INFORMATION_SCHEMA 技术，但我使用的另一个技术是：exec sp_pkeys 'table'

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-09-26T06:36:00.973

--这是另一个修改版本，也是相关查询的一个例子

```
SELECT TC.TABLE_NAME as [Table_name], TC.CONSTRAINT_NAME as [Primary_Key]
 FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS TC
 INNER JOIN INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE CCU
 ON TC.CONSTRAINT_NAME = CCU.CONSTRAINT_NAME
 WHERE TC.CONSTRAINT_TYPE = 'PRIMARY KEY' AND
 TC.TABLE_NAME IN
 (SELECT [NAME] AS [TABLE_NAME] FROM SYS.OBJECTS 
 WHERE TYPE = 'U') 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-11-03T08:20:16.527

我正在讲述一个我遵循的简单技术

```
SP_HELP 'table_name' 
```

将此代码作为查询运行。在您想知道主键的 table_name 位置提及您的表名（不要忘记单引号）。结果将显示为附加图像。希望对你有帮助

[![在此处输入图像描述](https://i.stack.imgur.com/fGpNu.png)](https://i.stack.imgur.com/fGpNu.png)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-04-03T20:29:05.783

**这应该列出所有约束（主键和外键）并在查询末尾放置表名**

```
/* CAST IS DONE , SO THAT OUTPUT INTEXT FILE REMAINS WITH SCREEN LIMIT*/
WITH   ALL_KEYS_IN_TABLE (CONSTRAINT_NAME,CONSTRAINT_TYPE,PARENT_TABLE_NAME,PARENT_COL_NAME,PARENT_COL_NAME_DATA_TYPE,REFERENCE_TABLE_NAME,REFERENCE_COL_NAME) 
AS
(
SELECT  CONSTRAINT_NAME= CAST (PKnUKEY.name AS VARCHAR(30)) ,
        CONSTRAINT_TYPE=CAST (PKnUKEY.type_desc AS VARCHAR(30)) ,
        PARENT_TABLE_NAME=CAST (PKnUTable.name AS VARCHAR(30)) ,
        PARENT_COL_NAME=CAST ( PKnUKEYCol.name AS VARCHAR(30)) ,
        PARENT_COL_NAME_DATA_TYPE=  oParentColDtl.DATA_TYPE,        
        REFERENCE_TABLE_NAME='' ,
        REFERENCE_COL_NAME='' 

FROM sys.key_constraints as PKnUKEY
    INNER JOIN sys.tables as PKnUTable
            ON PKnUTable.object_id = PKnUKEY.parent_object_id
    INNER JOIN sys.index_columns as PKnUColIdx
            ON PKnUColIdx.object_id = PKnUTable.object_id
            AND PKnUColIdx.index_id = PKnUKEY.unique_index_id
    INNER JOIN sys.columns as PKnUKEYCol
            ON PKnUKEYCol.object_id = PKnUTable.object_id
            AND PKnUKEYCol.column_id = PKnUColIdx.column_id
     INNER JOIN INFORMATION_SCHEMA.COLUMNS oParentColDtl
            ON oParentColDtl.TABLE_NAME=PKnUTable.name
            AND oParentColDtl.COLUMN_NAME=PKnUKEYCol.name
UNION ALL
SELECT  CONSTRAINT_NAME= CAST (oConstraint.name AS VARCHAR(30)) ,
        CONSTRAINT_TYPE='FK',
        PARENT_TABLE_NAME=CAST (oParent.name AS VARCHAR(30)) ,
        PARENT_COL_NAME=CAST ( oParentCol.name AS VARCHAR(30)) ,
        PARENT_COL_NAME_DATA_TYPE= oParentColDtl.DATA_TYPE,     
        REFERENCE_TABLE_NAME=CAST ( oReference.name AS VARCHAR(30)) ,
        REFERENCE_COL_NAME=CAST (oReferenceCol.name AS VARCHAR(30)) 
FROM sys.foreign_key_columns FKC
    INNER JOIN sys.sysobjects oConstraint
            ON FKC.constraint_object_id=oConstraint.id 
    INNER JOIN sys.sysobjects oParent
            ON FKC.parent_object_id=oParent.id
    INNER JOIN sys.all_columns oParentCol
            ON FKC.parent_object_id=oParentCol.object_id /* ID of the object to which this column belongs.*/
            AND FKC.parent_column_id=oParentCol.column_id/* ID of the column. Is unique within the object.Column IDs might not be sequential.*/
    INNER JOIN sys.sysobjects oReference
            ON FKC.referenced_object_id=oReference.id
    INNER JOIN INFORMATION_SCHEMA.COLUMNS oParentColDtl
            ON oParentColDtl.TABLE_NAME=oParent.name
            AND oParentColDtl.COLUMN_NAME=oParentCol.name
    INNER JOIN sys.all_columns oReferenceCol
            ON FKC.referenced_object_id=oReferenceCol.object_id /* ID of the object to which this column belongs.*/
            AND FKC.referenced_column_id=oReferenceCol.column_id/* ID of the column. Is unique within the object.Column IDs might not be sequential.*/

)

select * from   ALL_KEYS_IN_TABLE
where   
    PARENT_TABLE_NAME  in ('YOUR_TABLE_NAME') 
    or REFERENCE_TABLE_NAME  in ('YOUR_TABLE_NAME')
ORDER BY PARENT_TABLE_NAME,CONSTRAINT_NAME; 
```

供参考，请阅读 - [http://blogs.msdn.com/b/sqltips/archive/2005/09/16/469136.aspx](http://blogs.msdn.com/b/sqltips/archive/2005/09/16/469136.aspx)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-18T19:23:42.577

系统存储过程`sp_help`将为您提供信息。执行以下语句：

```
execute sp_help table_name 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-18T20:06:54.317

```
SELECT t.name AS 'table', i.name AS 'index', it.xtype,

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 1 
        AND k.id = t.id)
    AS 'column1',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 2 
        AND k.id = t.id)
    AS 'column2',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 3
        AND k.id = t.id)
    AS 'column3',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 4
        AND k.id = t.id)
    AS 'column4',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 5
        AND k.id = t.id)
    AS 'column5',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 6
        AND k.id = t.id)
    AS 'column6',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 7
        AND k.id = t.id)
    AS 'column7',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 8 
        AND k.id = t.id)
    AS 'column8',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 9 
        AND k.id = t.id)
    AS 'column9',

(SELECT c.name FROM syscolumns c INNER JOIN sysindexkeys k 
    ON k.indid = i.indid 
        AND c.colid = k.colid 
        AND c.id = t.id 
        AND k.keyno = 10
        AND k.id = t.id)
    AS 'column10',

FROM sysobjects t
    INNER JOIN sysindexes i ON i.id = t.id 
    INNER JOIN sysobjects it ON it.parent_obj = t.id AND it.name = i.name

WHERE it.xtype = 'PK'
ORDER BY t.name, i.name 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-06-27T00:17:40.773

这一个为您提供了 PK 列。

```
SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_NAME = 'TableName' 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-01-20T02:57:10.423

谢了，兄弟们。

稍有变化，我用它来查找所有表的所有主键。

```
SELECT A.Name,Col.Column_Name from 
    INFORMATION_SCHEMA.TABLE_CONSTRAINTS Tab, 
    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE Col ,
    (select NAME from dbo.sysobjects where xtype='u') AS A
WHERE 
    Col.Constraint_Name = Tab.Constraint_Name
    AND Col.Table_Name = Tab.Table_Name
    AND Constraint_Type = 'PRIMARY KEY '
    AND Col.Table_Name = A.Name 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-09-26T06:18:23.130

```
SELECT A.TABLE_NAME as [Table_name], A.CONSTRAINT_NAME as [Primary_Key]
 FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS A, INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE B
 WHERE CONSTRAINT_TYPE = 'PRIMARY KEY' AND A.CONSTRAINT_NAME = B.CONSTRAINT_NAME 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-10-04T11:27:21.480

下面的查询将列出**特定表**的**主键**：

 **```
SELECT DISTINCT
    CONSTRAINT_NAME AS [Constraint],
    TABLE_SCHEMA AS [Schema],
    TABLE_NAME AS TableName
FROM
    INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE
    TABLE_NAME = 'mytablename' 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-05-07T07:47:28.650

如果您正在寻找自己的 ORM 或从给定的表生成代码，那么这可能是您正在寻找的形式：

```
declare @table varchar(100) = 'mytable';

with cte as
(
    select 
        tc.CONSTRAINT_SCHEMA
        , tc.CONSTRAINT_TYPE
        , tc.TABLE_NAME
        , ccu.COLUMN_NAME
        , IS_NULLABLE
        , DATA_TYPE
        , CHARACTER_MAXIMUM_LENGTH
        , NUMERIC_PRECISION
    from 
        INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc 
        inner join INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu on tc.TABLE_NAME=ccu.TABLE_NAME  and tc.TABLE_SCHEMA=ccu.TABLE_SCHEMA
        inner join information_schema.COLUMNS c on ccu.COLUMN_NAME=c.COLUMN_NAME and ccu.TABLE_NAME=c.TABLE_NAME and ccu.TABLE_SCHEMA=c.TABLE_SCHEMA
    where 
        tc.table_name=@table
        and 
        ccu.CONSTRAINT_NAME=tc.CONSTRAINT_NAME
    union 
    select TABLE_SCHEMA,'COLUMN', TABLE_NAME, COLUMN_NAME, IS_NULLABLE, DATA_TYPE,CHARACTER_MAXIMUM_LENGTH, NUMERIC_PRECISION from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME=@table
    and COLUMN_NAME not in (select COLUMN_NAME from INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE where TABLE_NAME = @table)
)
select 
    cast(iif(CONSTRAINT_TYPE='PRIMARY KEY',1,0) as bit) PrimaryKey
    ,cast(iif(CONSTRAINT_TYPE='FOREIGN KEY',1,0) as bit) ForeignKey
    ,cast(iif(CONSTRAINT_TYPE='COLUMN',1,0) as bit) NotKey
    ,COLUMN_NAME
    ,cast(iif(is_nullable='NO',0,1) as bit) IsNullable
    , DATA_TYPE
    , CHARACTER_MAXIMUM_LENGTH
    , NUMERIC_PRECISION 
from 
    cte 
order by 
    case CONSTRAINT_TYPE 
        when 'PRIMARY KEY' then 1 
        when 'FOREIGN KEY' then 2 
        else 3 end
    , COLUMN_NAME 
```

结果如下：

```
 <table cellspacing=0 border=1>
					<tr>
						<td style=min-width:50px>PrimaryKey</td>
						<td style=min-width:50px>ForeignKey</td>
						<td style=min-width:50px>NotKey</td>
						<td style=min-width:50px>COLUMN_NAME</td>
						<td style=min-width:50px>IsNullable</td>
						<td style=min-width:50px>DATA_TYPE</td>
						<td style=min-width:50px>CHARACTER_MAXIMUM_LENGTH</td>
						<td style=min-width:50px>NUMERIC_PRECISION</td>
					</tr>
					<tr>
						<td style=min-width:50px>1</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>LectureNoteID</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>int</td>
						<td style=min-width:50px>NULL</td>
						<td style=min-width:50px>10</td>
					</tr>
					<tr>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>1</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>LectureId</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>int</td>
						<td style=min-width:50px>NULL</td>
						<td style=min-width:50px>10</td>
					</tr>
					<tr>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>1</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>NoteTypeID</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>int</td>
						<td style=min-width:50px>NULL</td>
						<td style=min-width:50px>10</td>
					</tr>
					<tr>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>1</td>
						<td style=min-width:50px>Body</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>nvarchar</td>
						<td style=min-width:50px>-1</td>
						<td style=min-width:50px>NULL</td>
					</tr>
					<tr>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>1</td>
						<td style=min-width:50px>DisplayOrder</td>
						<td style=min-width:50px>0</td>
						<td style=min-width:50px>int</td>
						<td style=min-width:50px>NULL</td>
						<td style=min-width:50px>10</td>
					</tr>
				</table> 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-08-26T01:13:17.420

对于给定 TableName 和 Schema 的主键列的逗号分隔列表：

```
Select distinct SUBSTRING ( stuff(( select distinct ',' + [COLUMN_NAME] 
                                    from INFORMATION_SCHEMA.KEY_COLUMN_USAGE  
                                    where OBJECTPROPERTY(OBJECT_ID(CONSTRAINT_SCHEMA + '.' + QUOTENAME(CONSTRAINT_NAME)), 'IsPrimaryKey') = 1  
                                    AND TABLE_NAME = 'TableName' AND TABLE_SCHEMA = 'Schema'  
                                    order by 1 FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'),1,0,'' ) 
                            ,2,9999) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-18T19:32:07.363

试试这个：

```
SELECT
    CONSTRAINT_CATALOG AS DataBaseName,
    CONSTRAINT_SCHEMA AS SchemaName,
    TABLE_NAME AS TableName,
    CONSTRAINT_Name AS PrimaryKey
FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS 
WHERE CONSTRAINT_TYPE = 'Primary Key' and Table_Name = 'YourTable' 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-06-18T23:55:33.087

我发现这很有用，给出了一个表列表，其中包含一个逗号分隔的列列表，然后还有一个逗号分隔的主键列表

```
SELECT T.TABLE_SCHEMA, T.TABLE_NAME, 
STUFF((
    SELECT ', ' + C.COLUMN_NAME
    FROM INFORMATION_SCHEMA.COLUMNS C
        WHERE C.TABLE_SCHEMA = T.TABLE_SCHEMA
        AND T.TABLE_NAME = C.TABLE_NAME
        FOR XML PATH ('')
    ), 1, 2, '') AS Columns,
STUFF((
SELECT ', ' + C.COLUMN_NAME 
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE C
INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS TC
    ON C.TABLE_SCHEMA = TC.TABLE_SCHEMA
    AND C.TABLE_NAME = TC.TABLE_NAME
    WHERE C.TABLE_SCHEMA = T.TABLE_SCHEMA
    AND T.TABLE_NAME = C.TABLE_NAME
    AND TC.CONSTRAINT_TYPE = 'PRIMARY KEY'
    FOR XML PATH ('')
), 1, 2, '') AS [Key]
FROM INFORMATION_SCHEMA.TABLES T
ORDER BY T.TABLE_SCHEMA, T.TABLE_NAME 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-03-23T19:26:24.420

这个版本显示了模式、表名和一个有序的、逗号分隔的主键列表。Object_Id() 不适用于链接服务器，因此我们按表名过滤。

如果没有 REPLACE(Si1.Column_Name, '', '') 它会在我正在测试的数据库上显示 Column_Name 的 xml 开始和结束标记。我不确定为什么数据库需要替换“Column_Name”，所以如果有人知道，请发表评论。

```
DECLARE @TableName VARCHAR(100) = '';
WITH Sysinfo
    AS (SELECT Kcu.Table_Name
            , Kcu.Table_Schema AS Schema_Name
            , Kcu.Column_Name
            , Kcu.Ordinal_Position
        FROM   [LinkServer].Information_Schema.Key_Column_Usage Kcu
             JOIN [LinkServer].Information_Schema.Table_Constraints AS Tc ON Tc.Constraint_Name = Kcu.Constraint_Name
        WHERE  Tc.Constraint_Type = 'Primary Key')
    SELECT           Schema_Name
                    ,Table_Name
                    , STUFF(
                          (
                             SELECT ', '
                                 , REPLACE(Si1.Column_Name, '', '')
                             FROM    Sysinfo Si1
                             WHERE  Si1.Table_Name = Si2.Table_Name
                             ORDER BY Si1.Table_Name
                                   , Si1.Ordinal_Position
                             FOR XML PATH('')
                          ), 1, 2, '') AS Primary_Keys
    FROM Sysinfo Si2
    WHERE Table_Name = CASE
                       WHEN @TableName NOT IN( '', 'All')
                       THEN @TableName
                       ELSE Table_Name
                    END
    GROUP BY Si2.Table_Name, Si2.Schema_Name; 
```

使用 George 查询的相同模式：

```
DECLARE @TableName VARCHAR(100) = '';
WITH Sysinfo
    AS (SELECT S.Name AS Schema_Name
            , T.Name AS Table_Name
            , Tc.Name AS Column_Name
            , Ic.Key_Ordinal AS Ordinal_Position
        FROM   [LinkServer].Sys.Schemas S
             JOIN [LinkServer].Sys.Tables T ON S.Schema_Id = T.Schema_Id
             JOIN [LinkServer].Sys.Indexes I ON T.Object_Id = I.Object_Id
             JOIN [LinkServer].Sys.Index_Columns Ic ON I.Object_Id = Ic.Object_Id
                                                       AND I.Index_Id = Ic.Index_Id
             JOIN [LinkServer].Sys.Columns Tc ON Ic.Object_Id = Tc.Object_Id
                                                  AND Ic.Column_Id = Tc.Column_Id
        WHERE  I.Is_Primary_Key = 1)
    SELECT           Schema_Name
                    ,Table_Name
                    , STUFF(
                          (
                             SELECT ', '
                                 , REPLACE(Si1.Column_Name, '', '')
                             FROM    Sysinfo Si1
                             WHERE  Si1.Table_Name = Si2.Table_Name
                             ORDER BY Si1.Table_Name
                                   , Si1.Ordinal_Position
                             FOR XML PATH('')
                          ), 1, 2, '') AS Primary_Keys
    FROM Sysinfo Si2
    WHERE Table_Name = CASE
                       WHEN @TableName NOT IN('', 'All')
                       THEN @TableName
                       ELSE Table_Name
                    END
    GROUP BY Si2.Table_Name, Si2.Schema_Name; 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-08-02T05:52:50.097

> Sys.Objects 表包含每个用户定义的模式范围对象的行。
> 
> 像主键或其他创建的约束将是*对象*，表名将是*parent_object*
> 
> 查询 sys.Objects 并收集 Object 的所需类型的 Id

```
declare @TableName nvarchar(50)='TblInvoice' -- your table name
declare @TypeOfKey nvarchar(50)='PK' -- For Primary key

SELECT Name FROM sys.objects
WHERE type = @TypeOfKey 
AND  parent_object_id = OBJECT_ID (@TableName) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-02-01T22:49:31.467

我可以对下面的原始问题提出一个更准确的简单答案吗

```
SELECT 
KEYS.table_schema, KEYS.table_name, KEYS.column_name, KEYS.ORDINAL_POSITION 
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE keys
INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS CONS 
    ON cons.TABLE_SCHEMA = keys.TABLE_SCHEMA 
    AND cons.TABLE_NAME = keys.TABLE_NAME 
    AND cons.CONSTRAINT_NAME = keys.CONSTRAINT_NAME
WHERE cons.CONSTRAINT_TYPE = 'PRIMARY KEY' 
```

笔记：

1.  上面的一些答案缺少仅用于主键列的过滤器！
2.  我在 CTE 中使用下面来加入更大的列列表，以提供来自源的元数据，以提供 BIML 生成的临时表和 SSIS 代码

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-04-19T05:16:34.487

可能最近发布，但希望这将帮助某人通过使用此 t-sql 查询来查看 sql server 中的主键列表：

```
SELECT  schema_name(t.schema_id) AS [schema_name], t.name AS TableName,        
    COL_NAME(ic.OBJECT_ID,ic.column_id) AS PrimaryKeyColumnName,
    i.name AS PrimaryKeyConstraintName
FROM    sys.tables t 
INNER JOIN sys.indexes AS i  on t.object_id=i.object_id 
INNER JOIN  sys.index_columns AS ic ON  i.OBJECT_ID = ic.OBJECT_ID
                            AND i.index_id = ic.index_id 
WHERE OBJECT_NAME(ic.OBJECT_ID) = 'YourTableNameHere' 
```

如果您愿意，可以使用此查询查看所有外键的列表：

```
SELECT
f.name as ForeignKeyConstraintName
,OBJECT_NAME(f.parent_object_id) AS ReferencingTableName
,COL_NAME(fc.parent_object_id, fc.parent_column_id) AS ReferencingColumnName
,OBJECT_NAME (f.referenced_object_id) AS ReferencedTableName
,COL_NAME(fc.referenced_object_id, fc.referenced_column_id) AS 
 ReferencedColumnName  ,delete_referential_action_desc AS 
DeleteReferentialActionDesc ,update_referential_action_desc AS 
UpdateReferentialActionDesc
FROM sys.foreign_keys AS f
INNER JOIN sys.foreign_key_columns AS fc
ON f.object_id = fc.constraint_object_id
 --WHERE OBJECT_NAME(f.parent_object_id) = 'YourTableNameHere' 
 --If you want to know referecing table details 
 WHERE OBJECT_NAME(f.referenced_object_id) = 'YourTableNameHere' 
 --If you want to know refereced table details 
ORDER BY f.name 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-04-25T05:14:58.590

**我从我的朋友那里找到了这个，如果您要在特定模式下查找所有表的主键，这非常有效。**

```
SELECT tc.constraint_name AS IndexName,tc.table_name AS TableName,tc.table_schema
AS SchemaName,kc.column_name AS COLUMN_NAME
FROM information_schema.table_constraints tc,information_schema.key_column_usage kc
WHERE tc.constraint_type = 'PRIMARY KEY' AND kc.table_name = tc.table_name AND kc.table_schema = tc.table_schema
AND kc.constraint_name = tc.constraint_name AND tc.table_schema='<SCHEMA_NAME>' 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-07-07T20:37:10.153

如果需要主键和类型，此查询可能有用：

```
SELECT L.TABLE_SCHEMA, L.TABLE_NAME, L.COLUMN_NAME, R.TypeName
FROM(
    SELECT COLUMN_NAME, TABLE_NAME, TABLE_SCHEMA
    FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
    WHERE OBJECTPROPERTY(OBJECT_ID(CONSTRAINT_SCHEMA + '.' + QUOTENAME(CONSTRAINT_NAME)), 'IsPrimaryKey') = 1
)L
LEFT JOIN (
    SELECT
    OBJECT_NAME(c.OBJECT_ID) TableName ,c.name AS ColumnName ,t.name AS TypeName
    FROM sys.columns AS c
    JOIN sys.types AS t ON c.user_type_id=t.user_type_id
)R ON L.COLUMN_NAME = R.ColumnName AND L.TABLE_NAME = R.TableName 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-12T13:10:13.430

可能是最简单的解决方案:)

`EXEC sp_pkeys YourTable`

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-10-12T15:55:29.747

如果您在 Oracle 中需要它，那就太简单了。

```
SELECT `Constraint_Name`
  FROM `All_Constraints`
 WHERE `Constraint_Type` = `'P'`
   AND `Owner` = `'your schema here';` 
```

# .net - 访问修饰符也会影响反射吗？

> ID：95974
> 
> 赞同：6
> 
> 时间：2008-09-18T19:22:27.777
> 
> 标签：.net, reflection, access-modifiers

我一直相信他们做到了，但在这里看到一些答案让我怀疑......

我可以通过反射从类外部访问私有字段/属性/方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T19:24:57.177

是的，您可以通过反射访问私有字段。这就是许多 ORM 在不通过您的属性的情况下填充对象的方式（这将调用您可能不打算在对象加载时运行的业务逻辑）。

访问修饰符不是一种安全形式！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T19:23:58.240

但是，您确实需要额外的权限才能通过反射从类外部访问私有/受保护/内部字段/属性/方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T19:22:56.403

是的，您可以，您只需在访问它们时在 Bi​​ndingFlags 中指定访问修饰符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T19:24:19.003

是的，你可以：但你真的应该问自己为什么要这样做:)

实际上只有一种情况是有意义的，这就是 UnitTest。

# sql - 如何插入多条记录并获取标识值？

> ID：95988
> 
> 赞同：62
> 
> 时间：2008-09-18T19:24:11.843
> 
> 标签：sql, sql-server, sql-server-2005

我正在从另一个表 B 向表 A 中插入多条记录。有没有办法在不使用游标的情况下获取表 A 记录的标识值并更新表 b 记录？

```
Create Table A
(id int identity,
Fname nvarchar(50),
Lname nvarchar(50))

Create Table B
(Fname nvarchar(50),
Lname nvarchar(50),
NewId int)

Insert into A(fname, lname)
SELECT fname, lname
FROM B 
```

我正在使用 MS SQL Server 2005。

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2008-09-19T09:14:42.550

使用 2005 年的输出子句：

```
DECLARE @output TABLE (id int)

Insert into A (fname, lname)
OUTPUT inserted.ID INTO @output
SELECT fname, lname FROM B

select * from @output 
```

现在您的表变量具有您插入的所有行的标识值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-18T19:48:26.480

仔细阅读您的问题，您只想根据表 A 中的新标识值更新表 B。

插入完成后，只需运行更新...

```
UPDATE B
SET NewID = A.ID
FROM B INNER JOIN A
     ON (B.FName = A.Fname AND B.LName = A.LName) 
```

这假定 FName / LName 组合可用于键匹配表之间的记录。如果不是这种情况，您可能需要添加额外的字段以确保记录正确匹配。

如果您没有允许您匹配记录的备用键，那么它根本没有意义，因为表 B 中的记录无法相互区分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T19:32:35.740

据我了解，您遇到的问题是您想要插入到具有标识列的表 A 中，并且您想要保留没有标识列的表 B 中的标识。

为此，您只需要在表 A 上打开身份插入。这将允许您在插入时定义您的 ID，只要它们不冲突，您应该没问题。然后你可以这样做：

```
Insert into A(identity, fname, lname) SELECT newid, fname, lname FROM B 
```

不确定您使用的是什么数据库，但对于 sql server，打开身份插入的命令将是：

```
set identity_insert A on 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-18T19:51:13.527

我建议使用 uniqueidentifier 类型而不是身份。在这种情况下，您可以在插入之前生成 ID：

```
update B set NewID = NEWID()

insert into A(fname,lname,id) select fname,lname,NewID from B 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T19:26:27.813

如果您总是想要这种行为，您可以在 TableA 上放置一个 AFTER INSERT 触发器来更新表 B。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T19:29:02.970

您可以通过加入[行号](http://www.databasejournal.com/features/mssql/article.php/3572301)来获得。这是可能的，因为它是一个标识，它只会随着您添加项目而增加，这将按照您选择它们​​的顺序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-15T12:11:44.437

```
-- first create a table for show how its works
CREATE TABLE [dbo].[myTable]
  (
     [id]   [INT] IDENTITY(1, 1) NOT NULL,
     [text] [VARCHAR](10) NULL
  )
ON [PRIMARY]

GO

-- var table for keep new inserted id
DECLARE @tblNewInserted TABLE
  (
     newids INT
  )

--use the output clause in insert statement
INSERT INTO [dbo].[myTable]
output      inserted.id
INTO @tblNewInserted
VALUES      ('aa'),('bb'),('cc')

SELECT *
FROM   @tblNewInserted 
```

* * *

## 回答 #8

> 赞同：-7
> 
> 时间：2008-09-18T19:52:48.890

MBelly 是正确的 - 但是触发器将始终尝试更新表 B，即使这不是必需的（因为您也是从表 C 插入的？）。

Darren 在这里也是正确的，您不能将多个身份作为结果集返回。您的选择是使用游标并为您插入的每一行获取标识，或者使用 Darren 的方法在前后存储标识。只要您知道身份的增量，这应该可以工作，只要您确保表针对所有三个事件都已锁定。

如果是我，而且时间不紧迫，我会选择光标。*******