# StackOverflow 问答 000538000-000538999

# java - 使用 aspectj 分析选定的方法

> ID：538010
> 
> 赞同：4
> 
> 时间：2009-02-11T18:01:15.880
> 
> 标签：java, profiling, aop, aspectj

我想使用 aspectj 来分析一个库。我的计划是用注释标记需要分析的方法：

`@Profiled("logicalUnitOfWork")`

然后有一个方面会在方法之前和之后触发，这些方法将使用`logicalUnitOfWork`来突出显示已分析的内容。

所以，我的切入点看起来像这样。请注意，我在这里没有注释的论据；这是我不知道该怎么做的事情之一：

```
pointcut profiled() : execution(@Profiled * *());

before() : profiled () {
    // : the profiled logical name is in this variable:
String logicalEventType;
Profiler.startEvent (logicalEventType);
}

after() returning : profiled() {
    // : the profiled logical name is in this variable:
String logicalEventType;
    Profiler.endEvent (logicalEventType);
} 
```

被分析的方法将被定义如下：

```
@Profiled("someAction")
public void doAction (args...) {} 
```

简而言之，我怎样才能将`@Profiled`注释的值放入方面？我不需要根据值限制发生的分析，我只需要它对建议可见。另外，我是否需要将注释的保留设置为运行时才能正常工作，还是可以改为使用类级别的保留？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-15T01:18:49.407

我不确定这是否是最好的方法，但您可以尝试以下方法：

```
 pointcut profiledOperation(Profiled p) : 
      execution(@Profiled * *()) && @annotation(p);

   before(Profiled p): profiledOperation(p)
   {
      System.out.println("Before " + p.value());
   }

   after(Profiled p): profiledOperation(p)
   {
      System.out.println("After " + p.value());
   } 

```

由于您需要在运行时访问注释值，因此您必须`@Retention`将`RUNTIME`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:41:05.150

不久前我做了类似的事情来用“默认值”注释字段。我试图将其调整为应该可以找到的带注释的方法。当然，您应该在此处添加一些错误检查和空值测试，因为为了简洁起见，我将其省略了。

您可以使用连接点的静态部分获取注释的值。

```
private String getOperationName(final JoinPoint joinPoint) {
   MethodSignature methodSig = (MethodSignature) joinPoint
      .getStaticPart()
      .getSignature();
   Method method = methodSig.getMethod();
   Profiled annotation = method.getAnnotation(Profiled.class);
   return annotation.value();
} 
```

为了避免过多的反思，使用`around`建议可能是个好主意：

```
around(): profiled() {
   String opName = getOperationName(thisJoinPoint);
   Profiler.startEvent(opName);
   proceed();
   Profiler.endEvent(opName);
} 
```

# .net - .net Compact Framework 解决方案的打包和部署

> ID：538014
> 
> 赞同：2
> 
> 时间：2009-02-11T18:01:43.663
> 
> 标签：.net, compact-framework, deployment

你是怎么做到的：

1.  你是使用 exe 和 dll 还是创建了一个 cab 文件？
2.  就部署而言，您是否实施了 Web 服务更新程序或使用第三方部署工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T18:11:57.010

绝对要使用 CAB 和 MSI 文件。有关详细信息，请参阅 MSDN 中的这篇[精彩文章](http://msdn.microsoft.com/en-us/library/aa446504.aspx)。CAB 文件是使用 Visual Studio 的设置项目创建的。创建包含 exe、dll 和配置文件的 CAB 文件非常容易。您可以指示应将这些文件复制到何处。您还可以添加注册表值。另一个好的特性是 CAB 文件不会安装在不兼容的平台上。

稍加努力，您就可以创建一个 MSI 安装程序。在其中，您可以捆绑多个 CAB 文件，一个用于您想要支持的每个平台。由于您没有使用 ActiveSync，因此这对您来说不是一个很好的选择。

对于更新应用程序，这是另[一篇好文章](http://msdn.microsoft.com/en-us/library/aa446487.aspx)。虽然很老了，但我认为它仍然提供了一些有用的想法。

我的建议是使用 CAB 文件来安装和更新应用程序。SO中有一个关于如何通过无线方式更新应用程序的相关[问题。](https://stackoverflow.com/questions/347176/is-there-a-way-to-update-a-windows-mobile-5-app-over-the-air)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T18:14:48.063

通常，.NET CF 应用程序的安装是通过 CAB 文件完成的。如果您谈论的是企业级，那么像 Motorola/Symbol 这样的设备有一个可选的中央服务器设备，可以为您管理所有这些并将应用程序下推到设备上。

除此之外，如果您想自动更新 .NET CF 应用程序，这绝对可以使用 Web 服务检查版本号，然后下载从 Web 服务返回的更新文件列表。

但是，诀窍是您无法更新已在使用的文件。因此，为了实现这一点，我在将文件下载到应用程序目录方面取得了巨大成功，文件扩展名末尾带有“.update”。然后在下一次应用程序重新启动时，在应用程序绑定到其他程序集之前的第一件事，它使用“.update”扩展名更新所有内容。

# linux - Yellow Dog Linux 6.1 和 PS3 GameOS 版本？

> ID：538020
> 
> 赞同：0
> 
> 时间：2009-02-11T18:03:57.357
> 
> 标签：linux, cell, firmware, ps3

我正在努力在 PS3 上安装 linux 以进行一些开发工作，但遇到了一些障碍。我的 PS3 上的当前固件版本是 2.50。Yellow Dog 网站[特别提到](http://us.fixstars.com/support/advisories.shtml)此版本存在问题。官方的[Yellow Dog 安装指南](http://us.fixstars.com/support/installation/ydl6.0_ps3_guide.pdf)（PDF！）还提到我应该将我的 PS3 更新到最新版本（现在是 2.60）。那么有没有人有这方面的经验？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T09:43:23.803

好的，所以我将固件更新到 2.60 并且一切似乎都可以正常工作（除了一些网络内容，但我认为这是特定于我的环境，而不是 distro/ps3 的配置）。

# vba - Visual Basic 编辑器和 Microsoft 脚本编辑器之间的区别？

> ID：538038
> 
> 赞同：2
> 
> 时间：2009-02-11T18:07:46.317
> 
> 标签：vba, excel

我开始学习 Excel 编程，并一直在 Excel Visual Basic 编辑器中进行开发。

我现在可以选择获得 Visual Studio 6，所以我想知道使用 Microsoft 脚本编辑器有什么好处。

你怎么认为？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T18:16:35.360

我看不出有什么优势。Excel VBA 编辑器附带了您在 Excel 中编程所需的一切。

除非您计划编写自定义 COM 对象，否则您不需要 Visual Studio，并且您只需使用它为您的开发过程添加一个额外的步骤。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T18:25:46.197

首先，VBScript（ScriptEditor 所针对的 VB 风格）在很多方面与 VBA 非常不同。

例如，您不能声明对象类型，也不能直接创建对象，例如 ADODB 连接。

VBA：

```
Dim myObject as ADODB.Connection
set myObject = new ADODB.Connection 
```

VB脚本：

```
dim myObject
set myObject = CreateObject("ADODB.Connection") 
```

Visual Studio 6 确实有一些优势，例如能够轻松地将代码添加到源代码安全中，但是您失去了与 Excel 文档交互的便利性（Sheet1.Range("rangeName") 等）

简而言之，我会坚持使用 Excel 中内置的 VBA 编辑器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-15T03:00:03.267

您可以直接从 Excel 启动 Microsoft 脚本编辑器 - 这是工具/宏菜单上的最后一个选项。VisualBasic 编辑器的正下方。但是脚本编辑器用于将工作表（或其他文档）显示为网页时使用。Magnifico 和 Rathboma 都是正确的。我做了很多 VBA / Excel。我终于达到了我想要该语言所没有的功能的地步，但我喜欢编辑器，毕竟，电子表格黑客没有更好的选择。IS Resolver，基于 python 的电子表格应用程序。在某些方面比 VBA 更好，但我不能用它来工作。但是，如果您有选择，您可以免费获得 Resolver。

# iphone - UIImagePickerController 相机预览是横向应用程序中的纵向

> ID：538041
> 
> 赞同：46
> 
> 时间：2009-02-11T18:08:23.897
> 
> 标签：iphone, cocoa-touch

在我的纯横向 iPhone 应用程序中，我启动了 UIImagePickerController 来拍照，但是从相机显示的实时图像是纵向的，周围有空白区域。图像被旋转。

一旦按下相机按钮，预览就会非常混乱，大部分预览都在屏幕外，并且视图没有正确对齐。

Apple 已经承认这是一个缺陷，并且正在努力解决这个问题。

我的问题是，是否有人有解决方法（合法或非法）可以让我现在开始工作。我不会通过非法修复发布到 App Store，但我会有一个更好的应用程序供用户测试 - 目前相机在横向上几乎无法使用。

如果可以的话，我会附上一个简单的测试项目和图像。

编辑 - 只是为了澄清，我得到的图像是正确的风景。我希望相机和预览 UI 看起来正确！

* * *

[![相机](https://i.stack.imgur.com/Gz5KY.jpg)](https://i.stack.imgur.com/Gz5KY.jpg)

[![替代文字](https://i.stack.imgur.com/1tlse.jpg)](https://i.stack.imgur.com/1tlse.jpg)

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-11T18:14:05.367

答案比你想象的更荒谬。我遇到了同样的问题，并在某处的论坛中找到了解决方案。将您拍摄的图像传递给这样的方法：

```
// Code from: http://discussions.apple.com/thread.jspa?messageID=7949889
- (UIImage *)scaleAndRotateImage:(UIImage *)image {
  int kMaxResolution = 640; // Or whatever

    CGImageRef imgRef = image.CGImage;

    CGFloat width = CGImageGetWidth(imgRef);
    CGFloat height = CGImageGetHeight(imgRef);

    CGAffineTransform transform = CGAffineTransformIdentity;
    CGRect bounds = CGRectMake(0, 0, width, height);
    if (width > kMaxResolution || height > kMaxResolution) {
        CGFloat ratio = width/height;
        if (ratio > 1) {
            bounds.size.width = kMaxResolution;
            bounds.size.height = roundf(bounds.size.width / ratio);
        }
        else {
            bounds.size.height = kMaxResolution;
            bounds.size.width = roundf(bounds.size.height * ratio);
        }
    }

    CGFloat scaleRatio = bounds.size.width / width;
    CGSize imageSize = CGSizeMake(CGImageGetWidth(imgRef), CGImageGetHeight(imgRef));
    CGFloat boundHeight;
    UIImageOrientation orient = image.imageOrientation;
    switch(orient) {

        case UIImageOrientationUp: //EXIF = 1
            transform = CGAffineTransformIdentity;
            break;

        case UIImageOrientationUpMirrored: //EXIF = 2
            transform = CGAffineTransformMakeTranslation(imageSize.width, 0.0);
            transform = CGAffineTransformScale(transform, -1.0, 1.0);
            break;

        case UIImageOrientationDown: //EXIF = 3
            transform = CGAffineTransformMakeTranslation(imageSize.width, imageSize.height);
            transform = CGAffineTransformRotate(transform, M_PI);
            break;

        case UIImageOrientationDownMirrored: //EXIF = 4
            transform = CGAffineTransformMakeTranslation(0.0, imageSize.height);
            transform = CGAffineTransformScale(transform, 1.0, -1.0);
            break;

        case UIImageOrientationLeftMirrored: //EXIF = 5
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(imageSize.height, imageSize.width);
            transform = CGAffineTransformScale(transform, -1.0, 1.0);
            transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);
            break;

        case UIImageOrientationLeft: //EXIF = 6
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(0.0, imageSize.width);
            transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);
            break;

        case UIImageOrientationRightMirrored: //EXIF = 7
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeScale(-1.0, 1.0);
            transform = CGAffineTransformRotate(transform, M_PI / 2.0);
            break;

        case UIImageOrientationRight: //EXIF = 8
            boundHeight = bounds.size.height;
            bounds.size.height = bounds.size.width;
            bounds.size.width = boundHeight;
            transform = CGAffineTransformMakeTranslation(imageSize.height, 0.0);
            transform = CGAffineTransformRotate(transform, M_PI / 2.0);
            break;

        default:
            [NSException raise:NSInternalInconsistencyException format:@"Invalid image orientation"];

    }

    UIGraphicsBeginImageContext(bounds.size);

    CGContextRef context = UIGraphicsGetCurrentContext();

    if (orient == UIImageOrientationRight || orient == UIImageOrientationLeft) {
        CGContextScaleCTM(context, -scaleRatio, scaleRatio);
        CGContextTranslateCTM(context, -height, 0);
    }
    else {
        CGContextScaleCTM(context, scaleRatio, -scaleRatio);
        CGContextTranslateCTM(context, 0, -height);
    }

    CGContextConcatCTM(context, transform);

    CGContextDrawImage(UIGraphicsGetCurrentContext(), CGRectMake(0, 0, width, height), imgRef);
    UIImage *imageCopy = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return imageCopy;
} 
```

:(

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-03-12T07:50:56.800

我通过使`UIImagePickerController`屏幕以全屏模式出现解决了这个问题，这也是 Apple 为 iPad 推荐的。

从[`UIImagePickerController`文档](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImagePickerController_Class/)：

> 在 iPad 上，如果您指定 UIImagePickerControllerSourceTypeCamera 的源类型，则可以模态（全屏）或使用弹出框呈现图像选择器。但是，Apple 建议您仅全屏显示相机界面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-23T06:13:13.760

我认为您根本不需要额外的工作来处理 imageRotation 或 EXIF 数据。Image drawInRect 会自动处理。

所以，你只需要得到这个尺寸或图像并将其重绘为新图像，就足够了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-30T23:09:10.860

我不想在捕获后旋转图像；我想在横向模式下正确显示预览。所以在 iOS 6 中，我在应用级别允许纵向模式，但是将应用的根视图控制器设置为 class `MyNonrotatingNavigationController`，定义如下：

```
@implementation MyNonrotatingNavigationController

-(NSUInteger) supportedInterfaceOrientations
{
    return UIInterfaceOrientationMaskLandscape;
}

@end 
```

因此，在此导航控制器中显示的所有内容都将是横向的（您可以使用任何视图控制器执行此操作）。现在，当我需要显示图像选择器时，我将应用程序窗口的根视图控制器替换为支持纵向模式的通用控制器。为了防止旧的根视图控制器及其视图被解除分配，我维护指向它们的指针，直到我准备好将它们放回应用程序窗口。

```
#define APP_DELEGATE ((MyAppDelegate*)[[UIApplication sharedApplication] delegate])
static UIViewController *pickerContainer = nil;
static UIViewController *oldRoot = nil;
static UIView *holdView = nil;

-(void) showPicker
{
    ...create UIImagePickerController...

    oldRoot = APP_DELEGATE.window.rootViewController;
    holdView = [[UIView alloc] initWithFrame:APP_DELEGATE.window.bounds];
    [holdView addSubview:oldRoot.view];

    pickerContainer = [UIViewController new];
    pickerContainer.view = [[UIView alloc] initWithFrame:APP_DELEGATE.window.bounds];
    APP_DELEGATE.window.rootViewController = pickerContainer;
    [pickerContainer presentViewController:picker animated:YES completion:NULL];
}

-(void) imagePickerController:(UIImagePickerController*)picker didFinishPickingMediaWithInfo:(NSDictionary*)info
{
    [pickerContainer dismissViewControllerAnimated:YES completion:^{
        dispatch_async( dispatch_get_main_queue(), ^{
            APP_DELEGATE.window.rootViewController = oldRoot;
            [APP_DELEGATE.window addSubview:oldRoot.view];
            pickerContainer = nil;
            oldRoot = nil;
            holdView = nil;
        });
    }];
} 
```

有点痛苦，但它似乎对照片和视频都有效。图像选择器的控件以纵向模式显示，但应用程序的其余部分仅是横向模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-07-20T23:10:54.887

如果不鼓励重新发布上面的最佳答案，请告诉我，我为 Alex Wayne 的答案提供了 2019 年的快速版本。

```
/**
 Scale and rotate a UIImage so that it is correctly oriented

 :param: image: The image to be rotated

 :returns: UIImage
 */
func scaleAndRotateImage(_ image: UIImage) -> UIImage {
    let kMaxResolution: CGFloat = 640
    let imgRef: CGImage = image.cgImage!
    let width: CGFloat = CGFloat(imgRef.width)
    let height: CGFloat = CGFloat(imgRef.height)
    var transform: CGAffineTransform = CGAffineTransform.identity
    var bounds: CGRect = CGRect(x: 0, y: 0, width: width, height: height)
    if width > kMaxResolution || height > kMaxResolution {
        let ratio: CGFloat = width / height
        if ratio > 1 {
            bounds.size.width = kMaxResolution
            bounds.size.height = (bounds.size.width / ratio)
        }
        else {
            bounds.size.height = kMaxResolution
            bounds.size.width = (bounds.size.height * ratio)
        }
    }
    let scaleRatio: CGFloat = bounds.size.width / width
    let imageSize: CGSize = CGSize(width: CGFloat(imgRef.width), height: CGFloat(imgRef.height))
    var boundHeight: CGFloat
    let orient: UIImage.Orientation = image.imageOrientation
    switch orient {
    case UIImageOrientation.up:
        transform = CGAffineTransform.identity
    case UIImageOrientation.upMirrored:
        transform = CGAffineTransform(translationX: imageSize.width, y: 0.0)
        transform = transform.scaledBy(x: -1.0, y: 1.0)
    case UIImageOrientation.down:
        transform = CGAffineTransform(translationX: imageSize.width, y: imageSize.height)
        transform = transform.rotated(by: CGFloat(Double.pi))
    case UIImageOrientation.downMirrored:
        transform = CGAffineTransform(translationX: 0.0, y: imageSize.height)
        transform = transform.scaledBy(x: 1.0, y: -1.0)
    case UIImageOrientation.leftMirrored:
        boundHeight = bounds.size.height
        bounds.size.height = bounds.size.width
        bounds.size.width = boundHeight
        transform = CGAffineTransform(translationX: imageSize.height, y: imageSize.width)
        transform = transform.scaledBy(x: -1.0, y: 1.0)
        transform = transform.rotated(by: CGFloat(3.0 * .pi / 2.0))
    case UIImageOrientation.left:
        boundHeight = bounds.size.height
        bounds.size.height = bounds.size.width
        bounds.size.width = boundHeight
        transform = CGAffineTransform(translationX: 0.0, y: imageSize.width)
        transform = transform.rotated(by: CGFloat(3.0 * .pi / 2.0))
    case UIImageOrientation.rightMirrored:
        boundHeight = bounds.size.height
        bounds.size.height = bounds.size.width
        bounds.size.width = boundHeight
        transform = CGAffineTransform(scaleX: -1.0, y: 1.0)
        transform = transform.rotated(by: CGFloat(.pi / 2.0))
    case UIImageOrientation.right:
        boundHeight = bounds.size.height
        bounds.size.height = bounds.size.width
        bounds.size.width = boundHeight
        transform = CGAffineTransform(translationX: imageSize.height, y: 0.0)
        transform = transform.rotated(by: CGFloat(.pi / 2.0))
    }
    UIGraphicsBeginImageContext(bounds.size)
    let context: CGContext = UIGraphicsGetCurrentContext()!
    if orient == UIImage.Orientation.right || orient == UIImage.Orientation.left {
        context.scaleBy(x: -scaleRatio, y: scaleRatio)
        context.translateBy(x: -height, y: 0)
    }
    else {
        context.scaleBy(x: scaleRatio, y: -scaleRatio)
        context.translateBy(x: 0, y: -height)
    }
    context.concatenate(transform)
    UIGraphicsGetCurrentContext()?.draw(imgRef, in: CGRect(x: 0, y: 0, width: width, height: height))
    let imageCopy: UIImage = UIGraphicsGetImageFromCurrentImageContext()!
    UIGraphicsEndImageContext()
    return imageCopy
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-15T18:38:20.673

您需要将自定义视图（带有工具栏和标题）设置为`cameraOverlayView`，还需要设置`allowsEditing`和`showsCameraControls`，`NO`因为这将隐藏标准控件和预览。这就是我在我正在制作的应用程序中发现的必要内容（我认为我需要选择器是纵向的，但如果用户将他的设备旋转到横向，我需要它来应用一些 ui 更改）。
如果需要，可以提供代码。

PS我的代码中仍然存在一些错误，但我正在努力：）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-19T09:37:52.193

这个问题可以通过如下设置`modalPresentationStyle`来解决`overCurrentContext`，

```
 picker.modalPresentationStyle = .overCurrentContext 
```

并在喜欢的地方展示您的图像选择器`Main Thread`，

```
DispatchQueue.main.async {

   self.present(picker, animated: true) {

   }
} 
```

为什么会这样？

因为`ImagePickerController`仅适用于纵向模式，当您尝试从横向视图控制器中显示选择器时，它会尝试将您的状态栏设置为纵向模式。因此，如果您设置`modalPresentationStyle`为`overCurrentContext`then 它不会尝试设置方向。它将考虑当前方向。

请参阅[Apple 指南](https://developer.apple.com/documentation/uikit/uiimagepickercontroller)以获取`ImagePickerController`. 它指出，

> UIImagePickerController 类仅支持纵向模式。此类旨在按原样使用，不支持子类化。此类的视图层次结构是私有的，不得修改，但有一个例外。您可以将自定义视图分配给 cameraOverlayView 属性，并使用该视图来呈现附加信息或管理相机界面和代码之间的交互。

# c# - 什么是用于解构 SQL 查询的好的 .NET 库，它允许我确定每列来自哪个表？

> ID：538042
> 
> 赞同：0
> 
> 时间：2009-02-11T18:08:27.610
> 
> 标签：c#, .net, sql

我的公司需要允许我们应用程序的内部用户通过我们的 UI 直接针对数据库编写查询。但是当我们显示结果时，我们的代码需要知道每个返回列是针对哪一列和哪一表，这样结果就可以用一些颜色编码和每列的其他逻辑来显示。

所以我希望有一个类或一些简单的代码可以进行 SQL 解析，并以某种方式为我提供 SQL 查询中每个返回列所代表的源表和列名。

一个例子

```
select b.FirstName As Name, c.Address From BusinessOwner b
    left join ContactLocation c on b.ID = c.OwnerID 
```

所以我需要一些代码来确定“名称”输出列实际上来自`BusinessOwner`表，并且是列标题`FirstName`并且`Address`来自`ContactLocation`表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:11:07.187

但有些字段并非源自表！例如：

```
select getdate() 
```

甚至

```
select "hello world" as ShoutItOut from sysobjects 
```

或者您可以有多个来源：

```
select field1 + field2 as Field1And2 from a inner join b on a.id = b.aid 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T18:35:15.033

以前从未使用过这些人......但他们的产品看起来可以做你想做的事： [http ://www.sqlparser.com/index.php](http://www.sqlparser.com/index.php)

查看[http://www.sqlparser.com/docs/How_to_identify_DB_objects_in_your_sql.html](http://www.sqlparser.com/docs/How_to_identify_DB_objects_in_your_sql.html)这听起来很像您需要做的事情。

但是请注意……您尝试做的事情可能不是很有效。也许在需求/用例方面有更多时间会带来更好的解决方案（听起来您的用户需要一种快速简便的方法来将标准格式应用于报告/显示......而且我不确定数据库表是否匹配/field 确实是这个问题的答案）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T18:45:45.070

你可以尝试这样的事情：

```
Select b.FirstName As BusinessOwner.Name, c.Address as ContactLoaction.Address
From BusinessOwner as b, ContactLocation as c 
```

通过对从查询返回的列名的第一部分进行一些解析，您将确定列所属的表。像这样的东西：

```
string tempName = tabel.Columns[0].ColumnName;
string tableName = tempName.Substring(0, tempName.IndexOf('.')); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T18:23:03.270

没有内置的方法可以做到这一点，您需要一些自定义代码来维护您关心的映射。

这将很难以标准方式进行，因为选择查询中的列可以来自一个表（如您的示例）、多个表（添加、聚合、连接或以其他方式计算的多个列），或者没有表全部（选择“保罗”作为名称），可能还有其他几种我没有想到的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T18:29:57.073

[Korzh](http://devtools.korzh.com/eq/)的 EasyQuery 是一个嵌入式可视化查询设计器，最终用户可以使用它来构建查询。他们有可用的 Windows 窗体和 ASP.NET 版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T18:41:38.030

这听起来你可以比解析 sql 简单得多。从提供的查询中获取 DataReader 并使用[GetSchemaTable](http://support.microsoft.com/kb/310107) () 方法。您总是可以通过让用户将列包装在函数等中来愚弄它，但是您可以通过这种方式进行很好的尝试……而且它是内置的！

# jquery - jQuery 插件创作：为什么有些人使用 jQuery.pluginName 而其他人使用 jQuery.fn.pluginName？

> ID：538043
> 
> 赞同：5
> 
> 时间：2009-02-11T18:08:31.947
> 
> 标签：jquery, plugins

例如，我正在查看 jCalendar 源代码，创建者有插件的两个不同部分，一个函数在“jQuery.jcalendar”下，另一个函数在“jQuery.fn.jcalendar”下。将两者分开的目的是什么？一个比另一个做什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-11T18:16:23.940

jQuery.fn.mypluging 名称扩展了 jQuery 对象：

```
$(selector); //a jquery object
$(selector).myplugin(); 
```

jQuery.myplugin 扩展了 jquery 对象本身：

```
$; //the jQuery object
$.myPlugin(); 
```

通过将插件添加到 jQuery.fn，您可以对该选择器找到的对象进行处理：

```
jQuery.fn.makeRed = function(){
 this.each( function() {
  $(this).css('color', 'red');
 }
}

$('div.someClass').makeRed(); //makes all divs of class someclass have red text 
```

扩展 jQuery 对象本身通常用于您的类需要但不扩展 jQuery 对象的函数。因此，扩展我们之前的示例：

```
jQuery.fn.doStuff = function(){
 this.each( function() {
  $(this).css('color', 'red')
         .append($.doStuff.giveMeRandom());
 }
}

jQuery.doStuff = {
 giveMeRandom: function() {
  return Math.random();
 }
}

$('div.someClass').doStuff(); //makes all divs of class someclass have red text and append a random number to them 
```

# c# - JIT 编译器与离线编译器

> ID：538056
> 
> 赞同：40
> 
> 时间：2009-02-11T18:12:02.470
> 
> 标签：c#, .net, c++, compiler-construction, jit

是否存在 JIT 编译器比 C++ 等其他编译器更快的情况？

你认为未来 JIT 编译器只会看到一些小的优化、特性但遵循类似的性能，还是会有突破，使其无限优于其他编译器？

看起来多核范式有一些希望，但它不是通用的魔法。

有什么见解吗？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-11T18:22:44.003

是的，肯定有这样的场景。

*   JIT 编译可以使用运行时分析来优化特定情况，基于对代码当前实际执行的特征的测量，并且可以根据需要重新编译“热”代码。这不是理论上的。Java 的 HotSpot 实际上就是这样做的。
*   JITters 可以针对正在执行程序的实际硬件上使用的特定 CPU 和内存配置进行优化。例如，许多 .NET 应用程序将以 32 位或 64 位代码运行，具体取决于它们的 JIT 位置。在 64 位硬件上，它们将使用更多的寄存器、内存和更好的指令集。
*   基于引用类型的运行时知识，可以将紧密循环内的虚拟方法调用替换为静态调用。

我认为未来会有突破。特别是我认为JIT编译和动态类型的结合会得到显着的提升。我们已经在 Chrome 的 V8 和 TraceMonkey 的 JavaScript 领域看到了这一点。我希望在不久的将来看到其他类似规模的改进。这很重要，因为即使是所谓的“静态类型”语言也往往具有许多动态特性。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-11T18:38:00.473

是的，JIT 编译器可以生成针对当前环境优化的更快的机器代码。但实际上，VM 程序比 Native 程序慢，因为 JITing 本身会消耗时间（更多优化 == 更多时间），并且对于许多方法来说，JITing 它们可能比执行它们消耗更多时间。这就是在 .NET 中引入 GAC 的原因

JITing 的一个副作用是大量的内存消耗。但这与计算速度无关，它可能会减慢整个程序的执行速度，因为大量的内存消耗会增加您的代码被分页到辅助存储的可能性。

请原谅我的英语不好。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-11T19:25:23.633

JIT 有优势，但我不认为它会完全接管。传统编译器可能会花费更多时间进行优化，而 JIT 需要在优化过多（花费的时间比优化节省的时间多）和过少（直接执行花费的时间过多）之间取得平衡。

显而易见的答案是在其优越的地方使用每一个。与传统优化器相比，JIT 可以更轻松地利用运行时分析（尽管有些编译器可以将运行时分析作为输入来指导优化），并且通常可以进行更多特定于 CPU 的优化（同样，许多传统的编译器会这样做，但如果您希望在不同的系统上运行可执行文件，他们就无法充分利用它）。传统的编译器可能会花费更多时间，并以不同的方式进行。

因此，未来的语言系统将具有良好的优化编译器，这些编译器将发出专为良好优化 JIT 编译器使用而设计的可执行代码。（对于许多人来说，这也是当前的语言系统。）（未来的语言系统还将支持从现代 Python/VB 脚本到最丑陋的高速数字运算的一切。）

与许多事情一样，Lisp 预示了这一点。很久以前，一些 Lisp 系统（不能说很多，还没有那么多 Common Lisp 实现）通过动态编译 Lisp 函数来解释它们。Lisp S 表达式（编写代码的内容）是对解析树的相当直接的描述，因此编译速度可以很快。同时，优化的 Lisp 编译器可以提前处理性能非常重要的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T18:36:45.187

基本上，JIT 编译器有机会实际分析正在运行的应用程序，并根据该信息进行一些提示。“离线”编译器将无法确定一个分支跳转的频率以及它失败的频率，而无需插入特殊代码，要求开发人员运行程序，通过它的速度，然后重新编译。

为什么这很重要？

```
//code before
if(errorCondition)
{
  //error handling
}
//code after 
```

被转换成类似的东西：

```
//code before
Branch if not error to Code After
//error handling
Code After:
//Code After 
```

在没有来自分支预测单元的信息的情况下，x86 处理器不会预测条件跳转。这意味着它可以预测要运行的错误处理代码，并且当处理器发现错误条件没有发生时，它将不得不刷新管道。

JIT 编译器可以看到这一点，并为分支插入提示，以便 CPU 预测正确的方向。诚然，离线编译器可以以一种避免错误预测的方式构造代码，但是如果你需要查看程序集，你可能不喜欢它到处乱跳......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-09T23:20:59.603

本次对话中跳过的另一件事是，当您 JIT 一段代码时，它可以编译到内存中的空闲位置。在像 C++ 这样的语言中，如果 DLL 的基础是那块内存不可用，那么它将不得不经历代价高昂的变基过程。将代码 JIT 到未使用的地址然后将已编译的 DLL 重新设置为可用内存空间会更快。更糟糕的是，无法再共享重新设置的 DLL。（参见[http://msdn.microsoft.com/en-us/magazine/cc163610.aspx](http://msdn.microsoft.com/en-us/magazine/cc163610.aspx)）

我对 C# 3.5 JIT 代码中的一些优化印象不深。压缩所需的位旋转等简单的事情效率非常低（它拒绝在 CPU 寄存器中缓存值，而是为每个操作都进入内存）。我不知道它为什么会这样做，但它会产生巨大的影响，我对此无能为力。

我个人认为一个好的解决方案是优化级别（1-100），你可以设置它来告诉 JIT 编译器你认为它应该花多少时间优化你的代码。唯一的其他解决方案是 AOT（提前）编译器，然后您将失去 JIT 代码的许多优点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-20T10:22:17.320

JIT 编译器比静态编译器更了解系统。一旦机器开始工作，就可以在运行中添加特定于机器的 multitheading 可以极大地提高速度。

JIT 编译器通常有一点启动延迟，其中程序/代码的第一次运行可能*比*预编译代码慢得多。冷启动缺点。

JIT 编译的另一大优势是编译器可以在您的程序构建完成后更新并获得新的编译器技巧，而无需完整的新程序部署。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-08T07:33:17.537

很多人回答也许我在略读（也许我的棒子的一端是错误的），但对我来说，它们是两个不同的东西：

AFAIK 没有什么能阻止你 JIT'ing 编译的 c++ 例如项目 Dynamo JIT'ed 机器代码：

[http://arstechnica.com/reviews/1q00/dynamo/dynamo-1.html](http://arstechnica.com/reviews/1q00/dynamo/dynamo-1.html)

在某些情况下，它确实提供了速度改进。

在 c++ 编译器的意义上，编译代码意味着获取用一种语言编写的代码并将其转换为一组指令（或在某些情况下另一种语言然后再次编译），这些指令可以由某种逻辑设备执行。

例如 c++ 编译为程序集（我认为 ;-) 或 c# 编译为 IL 或 Java 编译为字节码

JIT 是在执行期间发生的过程。执行代码的机器对其进行分析，看它是否可以改进它。当编译器为 VM 准备命令时，Java 和 C# 能够同时使用这两者，然后 VM 至少有机会再进行一次优化。

有些程序没有编译它们被解释，这意味着运行它们的机器会读取您编写的确切代码。这些机器有机会做一些 JIT，但请记住它们也可以静态编译，可能以语言的原始设计者从未想过的方式成为第三方供应商。

因此，要回答您的问题，我认为 JIT 不会取代静态编译器。我认为总会有（只要至少有编程）有一个地方来表示程序并将其转换为某种类型的机器的一组指令。（可能会在执行此操作时进行优化）

然而，我确实认为 JIT 可能会成为故事的重要组成部分，随着 Java 运行时和 .net 运行时的发展，我相信 JIT 会变得更好，并且考虑到像 Dynamo 项目这样的东西，我猜硬件占用 JIT 的空间同样，您的处理器所做的一切都会根据运行时环境重新优化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-12-02T23:25:18.927

JITing 的一个尚未被提及的优点是程序可以定义无限数量的泛型类型。例如：

```
interface IGenericAction { bool Act<T>(); }

struct Blah<T>
{
  public static void ActUpon(IGenericAction action)
  {
     if (action.Act<T>())
       Blah<Blah<T>>.ActUpon(action);
  }
} 
```

打电话`Blah<Int32>.ActUpon(act)`会打电话`act.Act<Int32>()`。如果该方法返回 true，它将调用`Blah<Blah<Int32>>.ActUpon(act)`，然后调用`act.Act<Blah<Int32>>()`。如果返回 true，将使用嵌套更深的类型执行更多调用。*为所有可以*`ActUpon`调用的方法生成代码是不可能的，但幸运的是没有必要。在使用之前不需要生成类型。如果返回 false，则 不会调用，也不需要创建后一种类型。*`action<Blah<...50 levels deep...>>.Act()``Blah<Blah<...50 levels deep...>>.ActUpon``Blah<Blah<...51 levels deep...>>.ActUpon`*

 ** * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-12-04T15:57:49.700

还没有提到有利于“离线”编译器的一点是，这样的编译器可以有效地针对具有少量 RAM 的平台——甚至只有 16 个字节。可以肯定的是，任何甚至远程 PC 兼容的东西都倾向于拥有（字面上）数百万倍的 RAM，但我认为需要一段时间才能找到一台价格低于 0.50 美元且消耗大量内存的机器。运行期间的功率小于一毫瓦。

请注意，16 字节的 RAM 并不像听起来那么微弱，因为具有如此小的 RAM 的芯片不会在 RAM 中存储代码——有一个单独的非易失性内存区域来保存代码（384 字节是我所知道的最小的）。当然，这并不多，但足以让 0.25 美元的处理器执行原本需要价值 1.00 美元的分立元件的功能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-10-09T18:59:13.533

> 是否存在 JIT 编译器比 C++ 等其他编译器更快的情况？

确实。例如，如果您发现一个非常糟糕的 AOT 编译器和一个非常好的 JIT 编译器，那么您自然可以期望 JIT 对于这两种实现来说会更快。

> 你认为未来 JIT 编译器只会看到一些小的优化、特性但遵循类似的性能，还是会有突破，使其无限优于其他编译器？

不，相反的可能性要大得多。

从历史上看，大多数 AOT 实现已经被开发人员（而不是最终用户）使用，导致他们针对通用目标进行优化（例如，“所有 64 位 80x86，谁知道什么类型的 RAM”）而不是最终用户的特定硬件（例如“AMD Ryzen model 2345 with 16 GiB of DDR3-2400 RAM”）；并且软件被分解成单独优化的“编译单元”（以创建目标文件），然后在没有进一步优化的情况下链接。这造成了阻碍 AOT 实现其能力的主要优化障碍。

近年来，推动整个程序优化（以链接时间优化和/或链接时间代码生成的形式）以打破其中一个优化障碍。

为了打破另一个优化障碍（在编译时不知道具体目标），一些编译器（例如英特尔的 ICC）会生成某些部分代码的多个版本，并选择（在运行时）要使用的版本。还有一些情况会出现“安装时AOT”（例如Gentoo Linux）；在某些情况下，开发人员提供了许多单独的二进制文件（针对许多不同的目标进行了优化）并且安装程序选择下载/安装哪个二进制文件。

优化的另一个障碍来自使用——例如更改代码以更好地适应它给出的数据。没有什么可以阻止 AOT 为不同的场景生成不同的代码并根据运行时数据选择要使用的版本。最简单和最常见的情况是“ `memcpy()`”，您可以预期执行复制的代码的多个版本，其中使用的版本是根据被复制的数据量选择的。使用足够先进的 AOT（可能与分析器引导的优化相结合），同样的技术可以变得更加复杂。

本质上; 这些 (AOT) 优化的“历史障碍”对于 JIT 来说是不存在的，这也是 JIT 可以接近 AOT 性能的原因；AOT 更有可能继续寻找避免/修复这些障碍的方法，并且 AOT 将增加其相对于 JIT 的性能优势。

另一方面; JIT 不能做诸如整个程序优化之类的事情（没有成为 AOT 的一种形式），因此无论 JIT 编译器变得多么先进，它都永远不会像 AOT 一样好。

此外; 在运行时修改或生成代码会在现代 CPU 上产生性能成本（由于破坏推测执行和需要特殊序列化，此外还会污染跟踪缓存和分支预测数据等内容）；而对于现代多线程软件来说，情况更糟，因为 JIT 编译器还需要确保代码在所有 CPU 上保持一致；并确保可以修改代码也有“持久成本”（例如，使用间接调用而不是直接调用，这样您就可以在完成 JITting 后自动更新以指向另一段代码的单个位置) 即使没有修改代码并且所有 JITting 都已完成。

对于（虚拟）内存消耗，JIT 也差很多——而不是拥有程序的代码和程序的数据；你有程序的原始代码和程序的数据，加上程序的 JITted 代码、JIT 编译器的代码和 JIT 编译器的数据。随着 JIT 编译器变得更先进，它们消耗更多的内存并且内存消耗变得更糟。更高的内存消耗也会稍微降低性能（由于在较低层管理内存的“不是 O(1)”开销 - 页表等），但也会使程序更接近“内存不足”的情况（例如交换空间使用，内存分配失败和某些操作系统中的“OOM杀手”）。

当然大多数系统都是多任务的，全局资源由多个进程共享；这意味着如果一个进程使用更多的 CPU 时间和更多的内存，那么其他完全不相关的进程（以及操作系统的不相关部分 - 例如文件数据缓存）将使用更少的资源。即使 JIT 的低效率对一个进程无关紧要（一个进程仍然“足够快”并且本身不会耗尽内存），它也会影响其他一切，并且对所有其他进程都很重要。

换句话说; 如果您要比较特定的实现，JIT 可能会更好（或类似，或更糟），但这是一个实现细节，并不是因为 JIT 实际上更好。任何比较 JIT 和 AOT 的公平基准，表明 JIT 与 AOT 一样好，都必须依赖于特定的实现；并暗示使用的 AOT 编译器的实现可以而且应该改进（并不暗示 JIT 与 AOT 可以或应该一样好）。

然而...

> 还是会有突破，使其无限优于其他编译器？

这实际上取决于您所说的“优越”。与 AOT 相比，JIT 有一个巨大的优势 - 开发人员等待代码编译所花费的时间（其中对利润的渴望意味着更高的开发成本意味着更高的最终产品成本）。

多年来/几十年，对于许多领域，我们看到了牺牲最终结果的质量/效率以减少开发时间/成本的趋势（例如，转向“Web 应用程序”）。我们在不相关的市场上也看到了同样的情况（为了好玩，看看很难找到简单的衣夹，这些衣夹不便宜，而且几年后会在阳光下腐烂的讨厌的塑料）。

到底; “低质量、低成本”获胜，除非有法律强制执行的质量标准（确实存在，主要是出于安全原因 - 例如汽车、医疗设备、电气、易燃气体……）；并且（因为几乎所有软件都没有任何质量标准）可以合理地假设 JIT 将变得更加占主导地位，因为它更便宜（尽管质量较低/性能较差）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-11T18:35:44.970

JIT 编译器有更多的数据可以用来影响优化。当然，实际上必须有人编写代码才能使用这些数据，所以这不是那么简单。

# asp.net - 扩展会员 API，MembershipUser

> ID：538059
> 
> 赞同：3
> 
> 时间：2009-02-11T18:12:37.383
> 
> 标签：asp.net, security, membership, membership-provider

我创建了自己的数据库模式来存储用户信息。

```
CREATE TABLE [dbo].[MyCustomMembership_Users](
[UserId] [uniqueidentifier] NOT NULL,
[UserName] [nvarchar](256) NOT NULL,
[LoweredUserName] [nvarchar](256) NOT NULL,
[MobileAlias] [nvarchar](16) NULL,
[IsAnonymous] [bit] NOT NULL,
[LastActivityDate] [datetime] NOT NULL,
[FirstName] [nvarchar](256) NULL,
[MiddleName] [nvarchar](256) NULL,
[LastName] [nvarchar](256) NULL) 
```

然后我扩展 MembershipProvider 和 MembershipUser 并创建覆盖的方法。 **调用 CreateUser 方法时如何传递附加信息？**我知道我可以为此使用配置文件，但我也希望能够这样做，如果结果太复杂，我将使用配置文件路线。

```
public class MyMembershipProvider : MembershipProvider
{
  public override MembershipUser CreateUser(string username, string password, 
string email, string passwordQuestion, string passwordAnswer, bool isApproved, 
object providerUserKey, out MembershipCreateStatus status)
    {
        throw new NotImplementedException();
    }
}
public class MyMembershipUser : MembershipUser
{
    private string _firstName;
    public string FirstName { get { return _firstName; } set { _firstName = value; } }

    private string _middleName;
    public string MiddleName { get { return _middleName; } set { _middleName = value; } }

    private string _lastName;
    public string LastName { get { return _lastName; } set { _lastName = value; } }

    public MyMembershipUser() : base()
    {
        this.FirstName = _firstName;
        this.MiddleName = _middleName;
        this.LastName = _lastName;
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-11-15T18:07:34.510

您可以在 providerUserKey 对象中传递一个 MyMembershipUser

# c# - 正确使用 IDisposable 接口

> ID：538060
> 
> 赞同：1801
> 
> 时间：2009-02-11T18:12:41.470
> 
> 标签：c#, .net, garbage-collection, idisposable

我通过阅读[Microsoft 文档](https://docs.microsoft.com/dotnet/api/system.idisposable)知道该接口的“主要”用途`IDisposable`是清理非托管资源。

对我来说，“非托管”意味着数据库连接、套接字、窗口句柄等。但是，我已经看到了`Dispose()`实现该方法以释放*托管*资源的代码，这对我来说似乎是多余的，因为垃圾收集器应该处理给你的。

例如：

```
public class MyCollection : IDisposable
{
    private List<String> _theList = new List<String>();
    private Dictionary<String, Point> _theDict = new Dictionary<String, Point>();

    // Die, clear it up! (free unmanaged resources)
    public void Dispose()
    {
        _theList.clear();
        _theDict.clear();
        _theList = null;
        _theDict = null;
    } 
```

我的问题是，这是否会使垃圾收集器使用的空闲内存`MyCollection`比通常更快？

**编辑**：到目前为止，人们已经发布了一些使用 IDisposable 清理非托管资源（如数据库连接和位图）的好例子。但是假设在上面的代码中包含一百万个字符串，并且您*现在*`_theList`想释放该内存，而不是等待垃圾收集器。上面的代码能做到这一点吗？

 ** * *

## 回答 #1

> 赞同：2795
> 
> 时间：2009-02-11T18:55:20.617

Dispose**的目的是**释放非托管资源。它需要在某个时候完成，否则它们将永远不会被清理干净。垃圾收集器不知道**如何**调用`DeleteHandle()`类型变量`IntPtr`，它不知道**是否**需要调用`DeleteHandle()`。

> **注意**：什么是非*托管资源*？如果您在 Microsoft .NET Framework 中找到它：它是托管的。如果您自己浏览 MSDN，它是不受管理的。您使用 P/Invoke 调用来摆脱 .NET Framework 中所有可用的美好舒适世界的任何东西都是非托管的——您现在负责清理它。

您创建的对象需要公开*一些*外部世界可以调用的方法，以便清理非托管资源。该方法可以任意命名：

```
public void Cleanup() 
```

或者

```
public void Shutdown() 
```

但是这个方法有一个标准化的名称：

```
public void Dispose() 
```

甚至创建了一个接口`IDisposable`，它只有一个方法：

```
public interface IDisposable
{
   void Dispose()
} 
```

所以你让你的对象暴露`IDisposable`接口，这样你就保证你已经编写了一个方法来清理你的非托管资源：

```
public void Dispose()
{
   Win32.DestroyHandle(this.CursorFileBitmapIconServiceHandle);
} 
```

你完成了。**除非你可以做得更好。**

* * *

如果您的对象分配了一个 250MB **[System.Drawing.Bitmap](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)**（即 .NET 托管的 Bitmap 类）作为某种帧缓冲区怎么办？当然，这是一个托管的 .NET 对象，垃圾收集器会释放它。但是你真的想留下 250MB 的内存就坐在那里——等待垃圾收集器*最终*出现并释放它吗？如果有一个[开放的数据库连接](http://msdn.microsoft.com/en-us/library/system.data.common.dbconnection.aspx)怎么办？当然，我们不希望该连接处于打开状态，等待 GC 完成对象。

如果用户已经调用`Dispose()`（意味着他们不再打算使用该对象）为什么不摆脱那些浪费的位图和数据库连接呢？

所以现在我们将：

*   摆脱非托管资源（因为我们必须这样做），并且
*   摆脱托管资源（因为我们想提供帮助）

因此，让我们更新我们的`Dispose()`方法以摆脱那些托管对象：

```
public void Dispose()
{
   //Free unmanaged resources
   Win32.DestroyHandle(this.CursorFileBitmapIconServiceHandle);

   //Free managed resources too
   if (this.databaseConnection != null)
   {
      this.databaseConnection.Dispose();
      this.databaseConnection = null;
   }
   if (this.frameBufferImage != null)
   {
      this.frameBufferImage.Dispose();
      this.frameBufferImage = null;
   }
} 
```

一切都很好，**除了你可以做得更好**！

* * *

如果对方**忘记**呼唤`Dispose()`你的对象怎么办？然后他们会泄漏一些**非托管**资源！

> **注意：**它们不会泄漏**托管**资源，因为最终垃圾收集器将在后台线程上运行，并释放与任何未使用对象关联的内存。这将包括您的对象以及您使用的任何托管对象（例如 the`Bitmap`和 the `DbConnection`）。

如果对方忘记打电话`Dispose()`，我们*仍然*可以保存他们的培根！我们仍然有办法*为*它们调用它：当垃圾收集器最终开始释放（即最终确定）我们的对象时。

> **注意：**垃圾收集器最终将释放所有托管对象。当它这样做时，它会调用**`Finalize`** 对象上的方法。GC 不知道也不关心*您的* **Dispose**方法。当我们想要摆脱非托管的东西时，这只是我们为调用的方法选择的名称。

垃圾收集器销毁我们的对象是释放那些讨厌的非托管资源的*最佳时机。*我们通过覆盖该`Finalize()`方法来做到这一点。

> **注意：**在 C# 中，您不会显式覆盖该`Finalize()`方法。您编写了一个*看起来像*C **++ 析构函数**的方法，编译器将其作为您的`Finalize()`方法实现：

```
~MyObject()
{
    //we're being finalized (i.e. destroyed), call Dispose in case the user forgot to
    Dispose(); //<--Warning: subtle bug! Keep reading!
} 
```

但是该代码中有一个错误。你看，垃圾收集器在**后台线程**上运行；您不知道销毁两个对象的顺序。完全有可能在您的`Dispose()`代码中，您试图摆脱的**托管**对象（因为您想提供帮助）不再存在：

```
public void Dispose()
{
   //Free unmanaged resources
   Win32.DestroyHandle(this.gdiCursorBitmapStreamFileHandle);

   //Free managed resources too
   if (this.databaseConnection != null)
   {
      this.databaseConnection.Dispose(); //<-- crash, GC already destroyed it
      this.databaseConnection = null;
   }
   if (this.frameBufferImage != null)
   {
      this.frameBufferImage.Dispose(); //<-- crash, GC already destroyed it
      this.frameBufferImage = null;
   }
} 
```

因此，您需要一种方法`Finalize()`来告诉`Dispose()`它不应**触及任何托管**资源（因为它们*可能不再存在*），同时仍释放非托管资源。

执行此操作的标准模式是`Finalize()`同时`Dispose()`调用**第三个**（！）方法；如果您从`Dispose()`（而不是`Finalize()`）调用它，则传递一个布尔值，这意味着释放托管资源是安全的。

这个*内部*方法*可以*被赋予一些任意名称，如“CoreDispose”或“MyInternalDispose”，但传统上称它为`Dispose(Boolean)`：

```
protected void Dispose(Boolean disposing) 
```

但更有用的参数名称可能是：

```
protected void Dispose(Boolean itIsSafeToAlsoFreeManagedObjects)
{
   //Free unmanaged resources
   Win32.DestroyHandle(this.CursorFileBitmapIconServiceHandle);

   //Free managed resources too, but only if I'm being called from Dispose
   //(If I'm being called from Finalize then the objects might not exist
   //anymore
   if (itIsSafeToAlsoFreeManagedObjects)  
   {    
      if (this.databaseConnection != null)
      {
         this.databaseConnection.Dispose();
         this.databaseConnection = null;
      }
      if (this.frameBufferImage != null)
      {
         this.frameBufferImage.Dispose();
         this.frameBufferImage = null;
      }
   }
} 
```

并且您将`IDisposable.Dispose()`方法的实现更改为：

```
public void Dispose()
{
   Dispose(true); //I am calling you from Dispose, it's safe
} 
```

和你的终结者：

```
~MyObject()
{
   Dispose(false); //I am *not* calling you from Dispose, it's *not* safe
} 
```

> **注意**：如果您的对象是从实现的对象继承而来的`Dispose`，那么在您覆盖 Dispose 时不要忘记调用它们的**基本**Dispose 方法：

```
public override void Dispose()
{
    try
    {
        Dispose(true); //true: safe to free managed resources
    }
    finally
    {
        base.Dispose();
    }
} 
```

一切都很好，**除了你可以做得更好**！

* * *

如果用户调用`Dispose()`您的对象，那么一切都已清理完毕。稍后，当垃圾收集器出现并调用 Finalize 时，它​​会再次调用`Dispose`。

这不仅浪费，而且如果您的对象对您在**上次**调用时已经处置的对象有垃圾引用`Dispose()`，您将尝试再次处置它们！

您会注意到，在我的代码中，我小心地删除了对已处理对象的引用，因此我不会尝试调用`Dispose`垃圾对象引用。但这并没有阻止一个微妙的错误潜入。

当用户调用时`Dispose()`：句柄**CursorFileBitmapIconServiceHandle**被销毁。稍后当垃圾收集器运行时，它会再次尝试销毁相同的句柄。

```
protected void Dispose(Boolean iAmBeingCalledFromDisposeAndNotFinalize)
{
   //Free unmanaged resources
   Win32.DestroyHandle(this.CursorFileBitmapIconServiceHandle); //<--double destroy 
   ...
} 
```

你解决这个问题的方法是告诉垃圾收集器它不需要费心完成对象——它的资源已经被清理了，不需要更多的工作。您可以通过调用`GC.SuppressFinalize()`以下`Dispose()`方法来做到这一点：

```
public void Dispose()
{
   Dispose(true); //I am calling you from Dispose, it's safe
   GC.SuppressFinalize(this); //Hey, GC: don't bother calling finalize later
} 
```

现在用户调用了`Dispose()`，我们有：

*   释放非托管资源
*   释放托管资源

GC 运行终结器没有任何意义——一切都已处理完毕。

## 我不能使用 Finalize 来清理非托管资源吗？

的文档[`Object.Finalize`](https://msdn.microsoft.com/en-us/library/system.object.finalize.aspx)说：

> Finalize 方法用于在对象被销毁之前对当前对象持有的非托管资源执行清理操作。

但是 MSDN 文档也说，对于[`IDisposable.Dispose`](https://msdn.microsoft.com/en-us/library/system.idisposable.dispose(v=vs.110).aspx)：

> 执行与释放、释放或重置非托管资源相关的应用程序定义任务。

那么它是哪一个？哪一个是我清理非托管资源的地方？答案是：

> 这是你的选择！而是选择`Dispose`。

您当然可以将非托管清理放在终结器中：

```
~MyObject()
{
   //Free unmanaged resources
   Win32.DestroyHandle(this.CursorFileBitmapIconServiceHandle);

   //A C# destructor automatically calls the destructor of its base class.
} 
```

问题是你不知道垃圾收集器什么时候会完成你的对象。您的非托管、不需要、未使用的本机资源将一直存在，直到垃圾收集器*最终*运行。然后它会调用你的终结器方法；清理非托管资源。**Object.Finalize**的文档指出了这一点：

> 终结器执行的确切时间未定义。为确保为您的类实例确定性地释放资源，请实现**Close**方法或提供[`IDisposable.Dispose`](https://msdn.microsoft.com/en-us/library/system.idisposable.dispose(v=vs.110).aspx)实现。

这是`Dispose`用于清理非托管资源的优点；您可以了解并控制何时清理非托管资源。他们的毁灭是*“确定性的”*。

* * *

回答您最初的问题：为什么不现在释放内存，而不是在 GC 决定时释放内存？我有一个面部识别软件，现在**需要***删除*530 MB 的内部图像，因为它们不再需要。当我们不这样做时：机器会停止交换。

 **## 奖金阅读

对于任何喜欢这个答案风格的人（解释*为什么*，所以*如何*变得显而易见），我建议你阅读 Don Box 的 Essential COM 的第一章：

*   直接链接：[Pearson Publishing 的第 1 章示例](http://ptgmedia.pearsoncmg.com/images/0201634465/samplechapter/chap01.pdf)
*   磁铁：84bf0b960936d677190a2be355858e80ef7542c0

在 35 页中，他解释了使用二进制对象的问题，并在您眼前发明了 COM。一旦你了解了COM 的*原因*，剩下的 300 页就很明显了，只是详细介绍了微软的实现。

我认为每个处理过对象或 COM 的程序员至少应该阅读第一章。这是对任何事情的最好解释。

## 额外的奖金阅读

[当你知道的一切都是错误的](https://ericlippert.com/2015/05/18/when-everything-you-know-is-wrong-part-one/) ^([存档](https://archive.today/JuXpm))时埃里克·利珀特

> 因此，编写一个正确的终结器确实非常困难，**我能给你的最好建议是不要尝试**.

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2009-02-11T18:20:41.170

`IDisposable`通常用于利用该`using`语句并利用一种简单的方法对托管对象进行确定性清理。

```
public class LoggingContext : IDisposable {
    public Finicky(string name) {
        Log.Write("Entering Log Context {0}", name);
        Log.Indent();
    }
    public void Dispose() {
        Log.Outdent();
    }

    public static void Main() {
        Log.Write("Some initial stuff.");
        try {
            using(new LoggingContext()) {
                Log.Write("Some stuff inside the context.");
                throw new Exception();
            }
        } catch {
            Log.Write("Man, that was a heavy exception caught from inside a child logging context!");
        } finally {
            Log.Write("Some final stuff.");
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-02-11T18:42:51.490

Dispose 模式的目的是提供一种机制来清理托管和非托管资源，何时发生取决于调用 Dispose 方法的方式。在您的示例中，使用 Dispose 实际上并没有执行与 dispose 相关的任何操作，因为清除列表对正在处理的集合没有影响。同样，将变量设置为 null 的调用对 GC 也没有影响。

您可以查看这篇[文章](http://www.codeproject.com/KB/cs/idisposable.aspx)以了解有关如何实现 Dispose 模式的更多详细信息，但它基本上看起来像这样：

```
public class SimpleCleanup : IDisposable
{
    // some fields that require cleanup
    private SafeHandle handle;
    private bool disposed = false; // to detect redundant calls

    public SimpleCleanup()
    {
        this.handle = /*...*/;
    }

    protected virtual void Dispose(bool disposing)
    {
        if (!disposed)
        {
            if (disposing)
            {
                // Dispose managed resources.
                if (handle != null)
                {
                    handle.Dispose();
                }
            }

            // Dispose unmanaged managed resources.

            disposed = true;
        }
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }
} 
```

这里最重要的方法是 Dispose(bool)，它实际上在两种不同的情况下运行：

*   disposing == true：该方法已被用户代码直接或间接调用。可以处置托管和非托管资源。
*   disposing == false：该方法已被运行时从终结器内部调用，您不应引用其他对象。只能释放非托管资源。

简单地让 GC 负责清理的问题在于，您无法真正控制 GC 何时运行收集周期（您可以调用 GC.Collect()，但实际上不应该），因此资源可能会保留大约比需要的时间长。请记住，调用 Dispose() 实际上不会导致收集周期或以任何方式导致 GC 收集/释放对象；它只是提供了一种更确定性地清理所用资源的方法，并告诉 GC 已经执行了此清理。

IDisposable 和 dispose 模式的重点不是立即释放内存。对 Dispose 的调用实际上甚至有机会立即释放内存的唯一一次是在它处理 disposing == false 场景和操作非托管资源时。对于托管代码，内存实际上不会被回收，直到 GC 运行一个收集周期，你真的无法控制（除了调用 GC.Collect()，我已经提到这不是一个好主意）。

您的方案实际上并不有效，因为 .NET 中的字符串不使用任何未管理的资源并且不实现 IDisposable，因此无法强制“清理”它们。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-02-11T20:21:05.683

在对对象调用 Dispose 之后，不应再调用对象的方法（尽管对象应该容忍对 Dispose 的进一步调用）。因此，问题中的示例很愚蠢。如果调用 Dispose，则可以丢弃对象本身。因此，用户应该丢弃对整个对象的所有引用（将它们设置为 null），并且它内部的所有相关对象都将自动被清理。

至于关于托管/非托管的一般问题以及其他答案中的讨论，我认为对这个问题的任何答案都必须从非托管资源的定义开始。

归结为，您可以调用一个函数将系统置于某种状态，并且可以调用另一个函数将其从该状态中恢复。现在，在典型示例中，第一个可能是返回文件句柄的函数，第二个可能是对`CloseHandle`.

但是——这是关键——它们可以是任何匹配的函数对。一个建立一个状态，另一个破坏它。如果状态已建立但尚未拆除，则资源实例存在。您必须安排在正确的时间进行拆卸 - 资源不由 CLR 管理。唯一自动管理的资源类型是内存。有两种：GC和堆栈。值类型由堆栈管理（或通过在引用类型中搭便车），引用类型由 GC 管理。

这些函数可能会导致可以自由交错的状态更改，或者可能需要完美嵌套。状态更改可能是线程安全的，也可能不是。

看看Justice的问题中的例子。对日志文件缩进的更改必须完美嵌套，否则一切都会出错。它们也不太可能是线程安全的。

可以搭便车与垃圾收集器一起清理非托管资源。但前提是状态更改函数是线程安全的，并且两个状态的生命周期可以以任何方式重叠。因此，Justice 的资源示例不能有终结器！它只是不会帮助任何人。

对于这些类型的资源，您可以只实现`IDisposable`，而无需终结器。终结器是绝对可选的——它必须是。这在许多书中被掩盖甚至没有提及。

然后，您必须使用该`using`语句来确保`Dispose`调用该语句。这本质上就像在堆栈中搭便车（就像终结器对 GC 而言，`using`对堆栈而言）。

缺少的部分是您必须手动编写 Dispose 并使其调用您的字段和基类。C++/CLI 程序员不必这样做。在大多数情况下，编译器会为他们编写它。

有一个替代方案，我更喜欢完美嵌套且不是线程安全的状态（除了其他任何事情，避免 IDisposable 可以避免与无法抗拒向每个实现 IDisposable 的类添加终结器的人争论的问题） .

你不用写一个类，而是写一个函数。该函数接受一个委托来回调：

```
public static void Indented(this Log log, Action action)
{
    log.Indent();
    try
    {
        action();
    }
    finally
    {
        log.Outdent();
    }
} 
```

然后一个简单的例子是：

```
Log.Write("Message at the top");
Log.Indented(() =>
{
    Log.Write("And this is indented");

    Log.Indented(() =>
    {
        Log.Write("This is even more indented");
    });
});
Log.Write("Back at the outermost level again"); 
```

传入的 lambda 用作代码块，因此就像您制作自己的控制结构来实现与 相同的目的`using`，只是您不再有任何调用者滥用它的危险。他们不可能无法清理资源。

如果资源是可能具有重叠生命周期的资源，则此技术不太有用，因为您希望能够构建资源 A，然后是资源 B，然后杀死资源 A，然后再杀死资源 B。你不能这样做如果你强迫用户像这样完美嵌套。但是你需要使用`IDisposable`（但仍然没有终结器，除非你已经实现了线程安全，它不是免费的）。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-02-11T19:31:38.020

我使用 IDisposable 的场景：清理非托管资源、取消订阅事件、关闭连接

我用于实现 IDisposable 的成语（*不是线程安全*的）：

```
class MyClass : IDisposable {
    // ...

    #region IDisposable Members and Helpers
    private bool disposed = false;

    public void Dispose() {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    private void Dispose(bool disposing) {
        if (!this.disposed) {
            if (disposing) {
                // cleanup code goes here
            }
            disposed = true;
        }
    }

    ~MyClass() {
        Dispose(false);
    }
    #endregion
} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-02-11T18:19:27.303

是的，该代码是完全多余和不必要的，它不会使垃圾收集器做任何它不会做的事情（一旦 MyCollection 的实例超出范围，即）。尤其是`.Clear()`调用。

回答您的编辑：有点。如果我这样做：

```
public void WasteMemory()
{
    var instance = new MyCollection(); // this one has no Dispose() method
    instance.FillItWithAMillionStrings();
}

// 1 million strings are in memory, but marked for reclamation by the GC 
```

出于内存管理的目的，它在功能上与此相同：

```
public void WasteMemory()
{
    var instance = new MyCollection(); // this one has your Dispose()
    instance.FillItWithAMillionStrings();
    instance.Dispose();
}

// 1 million strings are in memory, but marked for reclamation by the GC 
```

如果您真的真的需要立即释放内存，请调用`GC.Collect()`. 不过，这里没有理由这样做。内存将在需要时被释放。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-02-11T18:20:56.223

如果`MyCollection`无论如何都要被垃圾收集，那么你不需要处理它。这样做只会过度消耗 CPU，甚至可能使垃圾收集器已经执行的一些预先计算的分析无效。

我`IDisposable`过去常常做一些事情，例如确保正确处理线程以及非托管资源。

**编辑**回应斯科特的评论：

> *影响 GC 性能指标的唯一时间是调用 [sic] GC.Collect() 时”*

从概念上讲，GC 维护对象引用图的视图，以及线程堆栈帧中对它的所有引用。这个堆可以很大并且跨越许多内存页。作为优化，GC 缓存其对不太可能经常更改的页面的分析，以避免不必要地重新扫描页面。当页面中的数据发生变化时，GC 会收到内核的通知，因此它知道该页面是脏的，需要重新扫描。如果集合在 Gen0 中，那么页面中的其他内容很可能也在发生变化，但在 Gen1 和 Gen2 中不太可能发生这种情况。有趣的是，这些钩子在 Mac OS X 中对于将 GC 移植到 Mac 以使 Silverlight 插件在该平台上工作的团队不可用。

反对不必要的资源处置的另一点：想象一个进程正在卸载的情况。还想象一下，该过程已经运行了一段时间。很可能该进程的许多内存页面已交换到磁盘。至少它们不再在 L1 或 L2 缓存中。在这种情况下，卸载的应用程序将所有这些数据和代码页交换回内存以“释放”在进程终止时无论如何都会被操作系统释放的资源是没有意义的。这适用于托管甚至某些非托管资源。只有保持非后台线程处于活动状态的资源必须被释放，否则进程将保持活动状态。

现在，在正常执行期间，必须正确清理临时资源（正如@fezmonkey 指出的*数据库连接、套接字、窗口句柄*）以避免非托管内存泄漏。这些是必须处理的东西。如果你创建了一个拥有线程的类（我说的拥有我的意思是它创建了它，因此负责确保它停止，至少按照我的编码风格），那么该类很可能必须`IDisposable`在`Dispose`.

.NET 框架使用接口作为信号，甚至警告开发人员*必须*`IDisposable`释放这个类。我想不出框架中实现（不包括显式接口实现）处置是可选的任何类型。*`IDisposable`*

 ** * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-02-11T21:07:01.827

在您发布的示例中，它仍然没有“立即释放内存”。所有内存都被垃圾收集，但它可能允许在较早的[一代](http://aspalliance.com/828_Understanding_Garbage_Collection_in_NET)中收集内存。您必须进行一些测试才能确定。

* * *

框架设计指南是指南，而不是规则。它们会告诉您界面的主要用途、何时使用、如何使用以及何时不使用。

我曾经读过代码，它是一个简单的 RollBack() 使用 IDisposable 失败时。下面的 MiniTx 类将检查 Dispose() 上的标志，如果`Commit`调用从未发生过，它将调用`Rollback`自身。它增加了一层间接性，使调用代码更容易理解和维护。结果看起来像：

```
using( MiniTx tx = new MiniTx() )
{
    // code that might not work.

    tx.Commit();
} 
```

我也看到计时/记录代码做同样的事情。在这种情况下，Dispose() 方法停止计时器并记录块已退出。

```
using( LogTimer log = new LogTimer("MyCategory", "Some message") )
{
    // code to time...
} 
```

因此，这里有几个具体示例，它们不执行任何非托管资源清理，但成功使用 IDisposable 创建更清晰的代码。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-02-11T21:08:56.380

我不会重复有关使用或释放​​非托管资源的常见内容，这些内容都已涵盖。但我想指出一个常见的误解。
给定以下代码

```
公共课LargeStuff
  实现 IDisposable
  Private _Large as string()

  '一些奇怪的代码意味着 _Large 现在包含数百万长字符串。

  Public Sub Dispose() 实现 IDisposable.Dispose
    _大=没有
  结束子

```

我意识到 Disposable 实现不遵循当前的指导方针，但希望你们都明白这一点。
现在，当调用 Dispose 时，释放了多少内存？

答：没有。
调用 Dispose 可以释放非托管资源，它不能回收托管内存，只有 GC 可以这样做。这并不是说上面不是一个好主意，实际上遵循上面的模式仍然是一个好主意。运行 Dispose 后，没有什么可以阻止 GC 重新声明 _Large 正在使用的内存，即使 LargeStuff 的实例可能仍在范围内。_Large 中的字符串也可能在 gen 0 中，但 LargeStuff 的实例可能在 gen 2 中，所以同样，内存会被更快地回收。
但是，添加终结器来调用上面显示的 Dispose 方法是没有意义的。这只会延迟内存的重新声明以允许终结器运行。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-06-03T21:07:50.083

如果您想立即**删除**，请使用**非托管内存**。

看：

*   [Marshal.AllocHGlobal](http://msdn.microsoft.com/en-us/library/vstudio/system.runtime.interopservices.marshal.allochglobal%28v=vs.100%29.aspx)
*   [元帅.FreeHGlobal](http://msdn.microsoft.com/en-us/library/vstudio/system.runtime.interopservices.marshal.freehglobal%28v=vs.100%29.aspx)
*   [Marshal.DestroyStructure](http://msdn.microsoft.com/en-us/library/vstudio/system.runtime.interopservices.marshal.destroystructure%28v=vs.100%29.aspx)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-02-11T20:32:25.670

如果有的话，我希望代码的效率*低于*将其排除在外时的效率。

调用 Clear() 方法是不必要的，如果 Dispose 没有这样做，GC 可能不会这样做......

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-06-15T13:56:16.593

除了作为控制**系统资源****生命周期**的主要用途（完全被*Ian*的精彩回答所涵盖，赞！）之外，**IDisposable/using**组合还可用于**确定（关键）全局资源的状态更改范围**：*控制台*、*线程*、*进程*、任何*全局对象*，如*应用程序实例*。

 *********我写了一篇关于这种模式的文章：http: [//pragmateek.com/c-scope-your-global-state-changes-with-idisposable-and-the-using-statement/](http://pragmateek.com/c-scope-your-global-state-changes-with-idisposable-and-the-using-statement/)

**它说明了如何以可重用**和**可读**的方式保护一些常用的全局状态：*控制台颜色*、当前*线程文化*、*Excel 应用程序对象属性*......

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-05-26T05:41:42.740

您给定的代码示例不是一个很好的`IDisposable`使用示例。字典清除*通常*不应该去该`Dispose`方法。字典项目超出范围时将被清除和处置。`IDisposable`需要实现来释放一些即使超出范围也不会释放/释放的内存/处理程序。

以下示例显示了 IDisposable 模式的一个很好的示例，其中包含一些代码和注释。

```
public class DisposeExample
{
    // A base class that implements IDisposable. 
    // By implementing IDisposable, you are announcing that 
    // instances of this type allocate scarce resources. 
    public class MyResource: IDisposable
    {
        // Pointer to an external unmanaged resource. 
        private IntPtr handle;
        // Other managed resource this class uses. 
        private Component component = new Component();
        // Track whether Dispose has been called. 
        private bool disposed = false;

        // The class constructor. 
        public MyResource(IntPtr handle)
        {
            this.handle = handle;
        }

        // Implement IDisposable. 
        // Do not make this method virtual. 
        // A derived class should not be able to override this method. 
        public void Dispose()
        {
            Dispose(true);
            // This object will be cleaned up by the Dispose method. 
            // Therefore, you should call GC.SupressFinalize to 
            // take this object off the finalization queue 
            // and prevent finalization code for this object 
            // from executing a second time.
            GC.SuppressFinalize(this);
        }

        // Dispose(bool disposing) executes in two distinct scenarios. 
        // If disposing equals true, the method has been called directly 
        // or indirectly by a user's code. Managed and unmanaged resources 
        // can be disposed. 
        // If disposing equals false, the method has been called by the 
        // runtime from inside the finalizer and you should not reference 
        // other objects. Only unmanaged resources can be disposed. 
        protected virtual void Dispose(bool disposing)
        {
            // Check to see if Dispose has already been called. 
            if(!this.disposed)
            {
                // If disposing equals true, dispose all managed 
                // and unmanaged resources. 
                if(disposing)
                {
                    // Dispose managed resources.
                    component.Dispose();
                }

                // Call the appropriate methods to clean up 
                // unmanaged resources here. 
                // If disposing is false, 
                // only the following code is executed.
                CloseHandle(handle);
                handle = IntPtr.Zero;

                // Note disposing has been done.
                disposed = true;

            }
        }

        // Use interop to call the method necessary 
        // to clean up the unmanaged resource.
        [System.Runtime.InteropServices.DllImport("Kernel32")]
        private extern static Boolean CloseHandle(IntPtr handle);

        // Use C# destructor syntax for finalization code. 
        // This destructor will run only if the Dispose method 
        // does not get called. 
        // It gives your base class the opportunity to finalize. 
        // Do not provide destructors in types derived from this class.
        ~MyResource()
        {
            // Do not re-create Dispose clean-up code here. 
            // Calling Dispose(false) is optimal in terms of 
            // readability and maintainability.
            Dispose(false);
        }
    }
    public static void Main()
    {
        // Insert code here to create 
        // and use the MyResource object.
    }
} 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2018-10-03T17:32:35.177

我看到很多答案已经转向谈论将 IDisposable 用于托管和非托管资源。我建议这篇文章作为我找到的关于 IDisposable 应该如何实际使用的最佳解释之一。

[https://www.codeproject.com/Articles/29534/IDisposable-What-Your-Mother-Never-Told-You-About](https://www.codeproject.com/Articles/29534/IDisposable-What-Your-Mother-Never-Told-You-About)

对于实际问题；如果您使用 IDisposable 来清理占用大量内存的托管对象，那么简短的回答是**否定**的。原因是一旦持有内存的对象超出范围，它就可以被收集了。此时，任何引用的子对象也超出范围并将被收集。

唯一真正的例外是，如果您在托管对象中占用了大量内存，并且您已阻止该线程等待某些操作完成。如果那些在调用完成后不再需要的对象，那么将这些引用设置为 null 可能允许垃圾收集器更快地收集它们。但这种情况将代表需要重构的错误代码——而不是 IDisposable 的用例。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-11T18:45:58.753

该`Dispose()`操作在示例代码中执行的某些操作*可能*会产生由于对象的正常 GC 而不会发生的效果`MyCollection`。

如果对象被其他对象引用`_theList`或被`_theDict`其他对象引用，则该对象`List<>`或`Dictionary<>`对象不会被收集，而是突然没有内容。如果没有像示例中那样的 Dispose() 操作，这些集合仍将包含它们的内容。

当然，如果是这种情况，我会称其为损坏的设计 - 我只是指出（我认为是迂腐的）`Dispose()`操作可能不是完全多余的，这取决于是否有`List<>`其他`Dictionary<>`用途显示在片段中。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-02-20T16:35:08.233

`IDisposable`有利于退订事件。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-02-22T06:38:32.443

大多数关于“非托管资源”的讨论的一个问题是，它们并没有真正定义该术语，但似乎暗示它与非托管代码有关。虽然许多类型的非托管资源确实与非托管代码交互，但以这种方式考虑非托管资源并没有帮助。

相反，人们应该认识到所有托管资源的共同点：它们都需要一个对象要求一些外部“事物”代表它做某事，而损害一些其他“事物”，并且另一个实体同意这样做，直到另行通知。如果对象被遗弃并消失得无影无踪，那么没有任何东西可以告诉外部“事物”它不再需要代表不再存在的对象改变其行为；因此，这件东西的用处将永久减少。

因此，非托管资源代表某个外部“事物”同意代表对象改变其行为，如果该对象被放弃并不再存在，这将无用地损害该外部“事物”的有用性。托管资源是一个对象，它是这种协议的受益者，但如果它被遗弃，它已经签约接收通知，并且在它被销毁之前将使用这种通知来整理它的事务。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-08-31T09:45:02.890

首先是定义。对我来说，非托管资源意味着一些类，它实现了 IDisposable 接口或使用对 dll 的调用创建的东西。GC 不知道如何处理这些对象。例如，如果类只有值类型，那么我不认为这个类是具有非托管资源的类。对于我的代码，我遵循以下做法：

1.  如果我创建的类使用了一些非托管资源，那么这意味着我还应该实现 IDisposable 接口以清理内存。

2.  一旦我完成使用它就清理对象。

3.  在我的 dispose 方法中，我遍历类的所有 IDisposable 成员并调用 Dispose。

4.  在我的 Dispose 方法中调用 GC.SuppressFinalize(this) 以通知垃圾收集器我的对象已被清理。我这样做是因为调用 GC 是昂贵的操作。

5.  作为额外的预防措施，我尝试多次调用 Dispose() 。

6.  有时我添加私有成员 _disposed 并检查方法调用是否已清理对象。如果它被清理然后生成[ObjectDisposedException](https://msdn.microsoft.com/en-us/library/system.objectdisposedexception(v=vs.110).aspx)
    以下模板演示了我用文字描述的代码示例：

```
public class SomeClass : IDisposable
    {
        /// <summary>
        /// As usually I don't care was object disposed or not
        /// </summary>
        public void SomeMethod()
        {
            if (_disposed)
                throw new ObjectDisposedException("SomeClass instance been disposed");
        }

        public void Dispose()
        {
            Dispose(true);
        }

        private bool _disposed;

        protected virtual void Dispose(bool disposing)
        {
            if (_disposed)
                return;
            if (disposing)//we are in the first call
            {
            }
            _disposed = true;
        }
    } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-09-14T05:40:49.443

处置托管资源的最合理用例是准备 GC 回收否则永远不会收集的资源。

一个典型的例子是循环引用。

虽然使用避免循环引用的模式是最佳实践，但如果您最终得到（例如）一个引用回其“父”的“子”对象，如果您只是放弃，这可能会停止父的 GC 收集引用并依赖 GC - 另外，如果您实现了终结器，它将永远不会被调用。

解决此问题的唯一方法是通过将子项上的父引用设置为 null 来手动中断循环引用。

在父母和孩子上实现 IDisposable 是最好的方法。在 Parent 上调用 Dispose 时，对所有 Child 调用 Dispose，并在子 Dispose 方法中，将 Parent 引用设置为 null。

# c# - 从从未上钩的事件中解开代表是否有任何问题？

> ID：538065
> 
> 赞同：4
> 
> 时间：2009-02-11T18:14:06.317
> 
> 标签：c#, .net, events

我在 C# 下使用标准的 Windows 窗体控件。

我有两个控件，它们是设置单个值的不同方式。因此，当一个改变时，改变的事件处理程序为另一个计算一个值并设置它。所以我需要暂时取消第二个控件上的更改事件以防止循环（A更改B，B更改因此它更改A，A更改......）。还有一些其他情况我需要停止更改事件。所以有几个地方我需要取消挂钩事件，只有一个地方需要挂钩。

我的问题是：我是否需要跟踪事件是否已被钩住，或者我是否可以随意多次取消钩住它，只是偶尔再次钩住它？（有没有解决这个问题的文档？）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T18:18:07.010

取消使用操作员从未注册过的事件处理程序`-=`不会给您带来任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T18:17:41.130

是的，你可以随意解开它，不会抛出任何异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T18:20:50.450

这将循环并取消挂钩任何订阅的方法：

```
Delegate[] subscribers = myEvent.GetInvocationList();

    for(int i = 0; i < subscribers.Length; i++)

    {

    myEvent -= subscribers[i] as yourDelegateType;

    } 
```

但是，我认为您应该能够通过编写带有逻辑的单个处理程序来确定应该如何修改数据来避免循环问题。这将更清洁，更易于维护。

# .net - 如何使用给定枚举中的所有项目填充 XAML 中的 WPF 组合框？

> ID：538072
> 
> 赞同：22
> 
> 时间：2009-02-11T18:15:12.337
> 
> 标签：.net, wpf, data-binding, combobox, enums

假设我有一个具有四个值的枚举：

```
public enum CompassHeading
{
    North,
    South,
    East,
    West
} 
```

使用这些项目填充 ComboBox 需要什么 XAML？

```
<ComboBox ItemsSource="{Binding WhatGoesHere???}" /> 
```

理想情况下，我不必为此设置 C# 代码。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-11T18:24:47.430

您可以使用 ObjectDataProvider 来执行此操作：

```
<ObjectDataProvider MethodName="GetValues" 
    ObjectType="{x:Type sys:Enum}" x:Key="odp">
    <ObjectDataProvider.MethodParameters>
        <x:Type TypeName="local:CompassHeading"/>
    </ObjectDataProvider.MethodParameters>
</ObjectDataProvider>

<ComboBox ItemsSource="{Binding Source={StaticResource odp}}" /> 
```

我在这里找到了解决方案：

[http://bea.stollnitz.com/blog/?p=28](http://bea.stollnitz.com/blog/?p=28)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-11T13:48:34.177

我认为使用 ObjectDataProvider 来做到这一点真的很乏味......我有一个更简洁的建议（是的，我知道，这有点晚了......），使用标记扩展：

```
<ComboBox ItemsSource="{local:EnumValues local:EmployeeType}"/> 
```

这是标记扩展的代码：

```
[MarkupExtensionReturnType(typeof(object[]))]
public class EnumValuesExtension : MarkupExtension
{
    public EnumValuesExtension()
    {
    }

    public EnumValuesExtension(Type enumType)
    {
        this.EnumType = enumType;
    }

    [ConstructorArgument("enumType")]
    public Type EnumType { get; set; }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        if (this.EnumType == null)
            throw new ArgumentException("The enum type is not set");
        return Enum.GetValues(this.EnumType);
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-12T08:06:12.273

[这](http://dotnet.org.za/rudi/archive/2008/10/02/binding-to-enum-s.aspx)是如何绑定到 WPF 中的枚举的详细示例

假设您有以下枚举

```
public enum EmployeeType    
{
    Manager,
    Worker
} 
```

然后您可以在代码隐藏中绑定

```
typeComboBox.ItemsSource = Enum.GetValues(typeof(EmployeeType)); 
```

或使用 ObjectDataProvider

```
<ObjectDataProvider MethodName="GetValues" ObjectType="{x:Type sys:Enum}" x:Key="sysEnum">
    <ObjectDataProvider.MethodParameters>
        <x:Type TypeName="local:EmployeeType" />
    </ObjectDataProvider.MethodParameters>
</ObjectDataProvider> 
```

现在您可以在标记中绑定

```
<ComboBox ItemsSource="{Binding Source={StaticResource sysEnum}}" /> 
```

另请查看： [将枚举属性数据绑定到 WPF 中的 ComboBox](https://stackoverflow.com/questions/58743/databinding-an-enum-property-to-a-combobox-in-wpf#62032)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T15:46:44.320

有关替代技术和衍生技术的分步演练，请尝试此网页：

[缺失的 .NET #7：在 WPF 中显示枚举](http://www.ageektrapped.com/blog/the-missing-net-7-displaying-enums-in-wpf/)

本文还演示了一种覆盖某些值的表示的方法。有大量代码示例的好书。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-03T15:24:00.043

这可能就像在教堂里发誓，但我想在 XAML 中显式声明每个 ComboBoxItem，原因如下：

*   如果我需要本地化，我可以将 XAML 提供给翻译人员并为自己保留代码。
*   如果我有不适合给定 ComboBox 的枚举值，我不必显示它们。
*   枚举的顺序在 XAML 中确定，不一定在代码中确定。
*   可供选择的枚举值的数量通常不是很高。我会认为具有数百个值的枚举是代码气味。
*   如果我需要一些 ComboBoxItems 上的图形或其他装饰，最简单的方法是把它放在它所属的 XAML 中，而不是一些棘手的模板/触发器的东西。
*   保持简单，愚蠢

C# 示例代码：

```
 public enum number { one, two, three };

public partial class MainWindow : Window, INotifyPropertyChanged
{
    public MainWindow()
    {
        InitializeComponent();
        this.DataContext = this;
    }

    private number _number = number.one;
    public number Number
    {
        get { return _number; }
        set {
            if (_number == value)
                return;
            _number = value;
            if (PropertyChanged != null)
                PropertyChanged(this, new PropertyChangedEventArgs("Number"));
        }
    }

    public event PropertyChangedEventHandler PropertyChanged;
} 
```

XAML 代码：

```
<Window x:Class="WpfApplication6.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="MainWindow" Height="480" Width="677">
<Grid>
    <ComboBox SelectedValue="{Binding Number}" SelectedValuePath="Tag">
        <ComboBoxItem Content="En" Tag="One"/>
        <ComboBoxItem Content="To" Tag="Two"/>
        <ComboBoxItem Content="Tre" Tag="Three"/>
    </ComboBox>
</Grid> 
```

如您所见，XAML 已本地化为挪威语，无需更改 C# 代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T08:28:07.853

第三种解决方案：

如果您要绑定到大量枚举，这在前期工作会稍微多一些，从长远来看会更容易。使用将枚举类型作为参数的转换器，并将其转换为字符串数组作为输出。

在 VB.NET 中：

```
Public Class EnumToNamesConverter
    Implements IValueConverter

    Public Function Convert(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.Convert
        Return [Enum].GetNames(DirectCast(value, Type))
    End Function

    Public Function ConvertBack(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.ConvertBack
        Throw New NotImplementedException()
    End Function
End Class 
```

或者在 C# 中：

```
public sealed class EnumToNamesConverter : IValueConverter
{
  object IValueConverter.Convert(object value, Type targetType, object parameter, CultureInfo culture)
  {
    return Enum.GetNames(value.GetType());
  }

  object IValueConverter.ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
  {
    throw New NotSupportedException()
  }
} 
```

然后在你的 中`Application.xaml`，添加一个全局资源来访问这个转换器：

```
<local:EnumToNamesConverter x:Key="EnumToNamesConverter" /> 
```

最后在需要任何枚举值的任何 XAML 页面中使用转换器...

```
<ComboBox ItemsSource="{Binding
                        Source={x:Type local:CompassHeading},
                        Converter={StaticResource EnumToNamesConverter}}" /> 
```

# apache - Mod Rewrite Question - 将参数转发到新参数名称

> ID：538079
> 
> 赞同：1
> 
> 时间：2009-02-11T18:16:41.693
> 
> 标签：apache, mod-rewrite, lamp, wamp, mamp

我已经在 MAMP 上测试了以下 Mod Rewrite，但由于某种原因，它在 LAMP 上失败了。知道我做错了什么吗？

```
RewriteEngine on
RewriteCond %{QUERY_STRING} ^newParamA=(.*)&newParamB=([0-9]*)$
RewriteRule ^newfolder/newsubfolder/$ oldfolder/oldsubfolder\.php?oldParamC=%1\&oldParamD=%2 [QSA,L] 
```

这个想法是这样的查询

```
http://domain.com/newfolder/newsubfolder/?newParamA=query&newParamB=111 
```

将成功映射到：

```
http://domain.com/oldfolder/oldsubfolder/?oldParamC=query&oldParamD=111 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T20:25:37.917

回答 Gumbo 的评论（您是否使用相同的配置）

是的 - Apache 的最新版本，启用了 mod_rewrite - 似乎它不喜欢 RewriteCond - 如果我将其注释掉，至少路径重定向有效。当我取消注释 RewriteCond 时，我收到“未找到”错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T20:40:43.030

我目前不知道是什么导致了这种行为。但是您可以尝试其中一种：

```
RewriteCond %{QUERY_STRING} ^newParamA=([^&]*)&newParamB=([0-9]*)$
RewriteRule ^newfolder/newsubfolder/$ oldfolder/oldsubfolder.php?oldParamC=%1&oldParamD=%2 [QSA,L]

RewriteCond %{QUERY_STRING} (^|&)newParamA=([^&]*)&newParamB=([0-9]*)($|&)
RewriteRule ^newfolder/newsubfolder/$ oldfolder/oldsubfolder.php?oldParamC=%2&oldParamD=%3 [QSA,L] 
```

甚至：

```
RewriteCond %{QUERY_STRING} (^|([^&]*&)*)newParamA=([^&]*)(.*)
RewriteCond %3&%1&%4 ^([^&]*)(&[^&]*)*&newParamB=([0-9]*)
RewriteRule ^newfolder/newsubfolder/$ oldfolder/oldsubfolder.php?oldParamC=%1&oldParamD=%3 [QSA,L] 
```

# feed - 设置 iCalendar 源的更新限制

> ID：538081
> 
> 赞同：17
> 
> 时间：2009-02-11T18:17:28.930
> 
> 标签：feed, icalendar

我的应用程序中有一个日历源 (.ics)，但它非常大，因为它包含 4,000 多个事件。在指定下载多少事件或日历应该往前或往前多远时，是否有标准或最佳实践？

不过，我的主要问题是如何在日历上配置或设置更新限制，因此假设用户正在使用 Outlook 订阅日历，它每隔几个小时才更新一次。我目前将我的提要缓存了几个小时，但如果我可以拥有 Outlook 或用户正在使用的任何客户端，那么每隔几个小时检查一次更新是理想的。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-07-14T13:57:21.213

要仅每小时检查一次更新（例如），请在您的 VCALENDAR 文件中使用：

```
X-PUBLISHED-TTL:PT1H 
```

我从 Microsoft 协议文档 [[MS-OXCICAL] 中收集了这些信息：iCalendar to Appointment Object Conversion Protocol Specification](http://msdn.microsoft.com/en-gb/library/cc463911.aspx) （下载链接的 PDF）

> **2.1.3.1.1.15 属性：X-PUBLISHED-TTL**
> 
> RFC 参考：不适用
> 
> 允许的实例数：0、1
> 
> 格式：持续时间（[[RFC2445]](http://www.rfc-editor.org/rfc/rfc2445.txt)第 4.3.6 节）
> 
> 简要说明：为具有同步功能的客户端和服务器指定建议的 iCalendar 文件下载频率。
> 
> **导入日历对象**
> 应该忽略此属性<32>。
> 
> **从日历对象导出**
> 如果此 iCalendar 定期自动发布到远程位置，则此属性应该<33> 设置为该间隔，最小粒度为分钟。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-01-04T18:05:34.857

RFC 7986 引入了一个新`REFRESH-INTERVAL`属性：

[https://www.rfc-editor.org/rfc/rfc7986#section-5.7](https://www.rfc-editor.org/rfc/rfc7986#section-5.7)

我不知道这是否受到任何客户的支持，但 RFC 是由 Apple 编写的，所以我认为他们对此感兴趣。

# image - firefoxs 在特定宽度的 png 的内容框边缘呈现细灰线 - 为什么？

> ID：538082
> 
> 赞同：3
> 
> 时间：2009-02-11T18:17:29.710
> 
> 标签：image, firefox, png, width, line

当 firefox (3.0.6) 以特定宽度（例如，50%）渲染 png 图像时，会在内容框的左边缘和上边缘显示一条细灰线。该线在其他宽度处消失（例如，70%）。此外，该线似乎不存在于原始图像中（使用 gimp 检查图像）。

这种现象发生在没有 CSS 样式标记的情况下——在下面的 HTML 示例中，CSS 的存在是为了阐明灰线的位置——灰线似乎很明显出现在内容框的最边缘本身。

我很难想象这是一个真正的 Firefox 错误，我想知道我忽略或没有掌握什么概念......

感谢您的时间和任何建议/想法...

图片可以在[这里看到](http://datlisp.blogspot.com/2009/02/img-width-tag-and-firefox-rendering-of.html) [http://datlisp.blogspot.com/2009/02/img-width-tag-and-firefox-rendering-of.html](http://datlisp.blogspot.com/2009/02/img-width-tag-and-firefox-rendering-of.html)

html:

```
<html>
<head><title>problems with pngs</title></head>
<body>
<div style="border-color: red; border-width: thin; border-style: solid;
      padding: 2px">
<img src="http://imagebin.ca/img/ato4dM.png"
    width="50%"
    style="border-color: blue; border-width: thin; border-style: solid;
    padding: 2px;"/>    
</div>
</body></html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T02:06:40.257

将图像保存为 PNG-24。尝试在浏览器中动态调整 PNG-8 图像的大小时，我遇到了类似的像素失真问题。

另外，我不确定这是否适用于您的特定情况，但如果可能的话，您应该在图像显示到浏览器之前调整它们的大小。如果您尝试以较小的格式显示非常大的图像，则依赖浏览器调整大小会导致失真并且可能会增加带宽使用量。

更多信息： http: [//graphicssoft.about.com/od/aboutgraphics/l/blresizehtml.htm](http://graphicssoft.about.com/od/aboutgraphics/l/blresizehtml.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T23:22:36.803

我一直在处理的图片库也遇到了类似的问题（抱歉，我是新手，所以无法链接）。缩略图显示为实际大小，没有进行 html/css 调整大小。

有时它们会在图像 div 和阴影背景之间的右侧和底部获得 1 像素宽的线。我们花了一段时间才弄清楚为什么它有时会发生，但我们将其缩小到 Firefox 缩放设置。

如果您在 Firefox 中缩放页面（ctrl 和鼠标滚轮，或 ctrl 和 +/-），那么就像您的情况一样，它们会出现在某些缩放级别。重置为 100% 缩放（ctrl 和 0）每次都为我们修复它，但对使用缩放功能的人没有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T03:04:25.783

使用您的演示页面和图像，我看不到任何错误。

可能是显卡驱动的问题？我相信firefox（和cairo，它使用的图形库）利用硬件加速来平滑地调整图像大小，不幸的是你不能禁用它AFAIK。

尝试通过远程协议登录以绕过视频卡并检查它。至少你可以得到一些安心。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-04T20:31:24.183

在 div-tag 中显示 .png-image 时，我遇到了类似的问题。在图像的一侧渲染了一条细黑线。要修复它，我必须添加以下 CSS 样式： `box-shadow: none;`

# .net - 如何在 log4net 中过滤自定义级别？

> ID：538095
> 
> 赞同：12
> 
> 时间：2009-02-11T18:20:04.150
> 
> 标签：.net, configuration, logging, log4net

我复制了 log4net 示例以实现自定义日志级别 AUDIT。我将 AUDIT 的值定义为 35000，介于 DEBUG 30000 和 INFO 40000 之间。

以下是我的配置部分。我有一个记录所有级别的附加程序和一个应该只记录 AUDIT 级别的附加程序（这仅用于测试）

```
<log4net>
  <appender name="FileAppender" type="log4net.Appender.FileAppender" >
    <file value="testrun.log" />
    <layout type="log4net.Layout.PatternLayout" >
      <conversionPattern value="%date{HH:mm:ss:fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>
  <appender name="FileAppender.Audit" type="log4net.Appender.FileAppender" >
    <filter type="log4net.Filter.LevelMatchFilter">
      <levelToMatch value="AUDIT" />
    </filter>
    <file value="testrun.audit.log" />
    <layout type="log4net.Layout.PatternLayout" >
      <conversionPattern value="%date{HH:mm:ss:fff} [%thread] %-5level %logger{1} - %message%newline" />
    </layout>
  </appender>  
  <root>
    <level value="ALL" />
    <appender-ref ref="FileAppender" />
    <appender-ref ref="FileAppender.Audit" />
  </root>
</log4net> 
```

测试方法是

```
private static readonly IAuditLog log = AuditLogManager.GetLogger(typeof(Program));
public static void Main()
{
    log.Debug("Debug");
    log.Audit("Audit");
    log.Info("Info");
} 
```

但是，附加程序的输出是相同的......

```
13:09:11:540 [9] DEBUG Program - Debug
13:09:11:560 [9] AUDIT Program - Audit
13:09:11:560 [9] INFO  Program - Info 
```

解析 LevelMatchFilter 时的 log4net 调试输出为

```
log4net: Loading Appender [FileAppender.Audit] type: [log4net.Appender.FileAppender]
log4net:ERROR XmlHierarchyConfigurator: Unknown Level Specified [AUDIT]
log4net:WARN Unable to set property [levelToMatch] on object [log4net.Filter.LevelMatchFilter] using value [AUDIT] (with acceptable conversion types)
log4net: Setting Collection Property [AddFilter] to object [log4net.Filter.LevelMatchFilter] 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-03T21:58:53.757

如果您想要我在问题中描述的行为，log4net 版本 1.2.10 要求您`LevelMatchFilter`以 a 结束链。`DenyAllFilter`

```
<appender name="FileAppender.Audit" type="log4net.Appender.FileAppender" >
  <filter type="log4net.Filter.LevelMatchFilter">
    <levelToMatch value="AUDIT" />
  </filter>
  <filter type="log4net.Filter.DenyAllFilter" />
  <file value="testrun.audit.log" />
  <layout type="log4net.Layout.PatternLayout" >
    <conversionPattern value="%date{HH:mm:ss:fff} [%thread] %-5level %logger{1} - %message%newline" />
  </layout>
</appender> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-11T18:29:00.400

您将需要添加

```
<level>
  <name value="AUDIT" />
  <value value="35000" />
</level> 
```

在您的 log4net 配置部分。

# .net - 何时使用 IComparable 比。比较器

> ID：538096
> 
> 赞同：104
> 
> 时间：2009-02-11T18:20:08.753
> 
> 标签：.net, icomparable, icomparer

我试图弄清楚我需要实现哪些接口。他们基本上都做同样的事情。我什么时候会使用其中一个？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2009-02-11T18:27:30.043

好吧，它们与在能够比较两个不同对象的类型上实现而在能够与同一类型的其他实例进行比较的类型上实现并不完全相同*。*`IComparer<T>``IComparable<T>`

`IComparable<T>`当我需要知道另一个实例如何与实例相关时，我倾向于使用它`this`。 作为比较之外的立场，`IComparer<T>`对于对集合进行排序很有用。`IComparer<T>`

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-02-11T18:24:31.473

`IComparable<T>`当类具有内在比较时使用。

`IComparer<T>`当您需要一种比较方法而不是类的内在比较（如果有的话）时使用。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2011-03-15T07:22:51.023

这取决于实体。例如，对于像“Student”这样的类，使用基于 Name 的 IComparable 是有意义的。

```
class Student : IComparable 
{
    public string Name { get; set; }
    public int MathScore { get; set; }
    public int EnglishScore { get; set; }

    public int TotalScore 
    {
        get
        {
            return this.MathScore + this.EnglishScore; 
        }
    }

    public int CompareTo(object obj)
    {
        return CompareTo(obj as Student);  
    }

    public int CompareTo(Student other)
    {
        if (other == null)
        {
            return 1;
        }
        return this.Name.CompareTo(other.Name);  
    }
} 
```

但是，如果老师“A”想根据 MathScore 比较学生，而老师“B”想根据 EnglishScore 比较学生。单独实现 IComparer 是个好主意。（更像是一种策略模式）

```
class CompareByMathScore : IComparer<Student>
{
    public int Compare(Student x, Student y)
    {
        if (x.MathScore > y.MathScore)
          return 1;
        if (x.MathScore < y.MathScore)
          return -1;
        else
          return 0;
    }
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-10-17T23:11:10.093

这完全取决于您的类型是否可变。您应该**只**在非可变类型上实现 IComparable。请注意，如果您实现 IComparable，则必须重写 Equals 以及 ==、!=、< 和 > 运算符（请参阅代码分析警告 CA1036）。

引用[此博客文章](http://weblogs.asp.net/bleroy/archive/2004/12/15/316601.aspx#7537755)中的 Dave G ：

> 但正确的答案是如果您的对象是可变的，则实现 IComparer 而不是 IComparable，并在必要时将 IComparer 的实例传递给排序函数。
> 
> 由于 IComparer 只是用于在该时间点进行排序的一次性对象，因此您的对象可以具有您想要的任何可变语义。此外，它不需要甚至不建议使用 Equals、GetHashCode 或 == - 您可以随意以任何方式定义它。
> 
> 最后，您可以为您的类型定义多个 IComparer，以便按不同的字段或使用不同的规则进行排序。这比坚持一个定义要灵活得多。
> 
> *简而言之：* **将 IComparable 用于值类型，将 IComparer 用于引用类型。**

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-02-05T01:20:28.457

**通过故事简单解释**

高中篮球。这是球队的校园选秀权。我想让我的团队中最高/最好/最快的人。我该怎么办？

**IComparer Interface** - 比较两个不同的人

*   这让我可以比较任何两个排队的人............基本上就是这样。Fred vs John........我把它们扔到一个实现接口的具体类中。`Compare(Fred, John)`它吐出谁更好。

**IComparable 怎么样？**- 将自己与他人进行比较

你最近上FB了吗？您会看到其他人在做很酷的事情：环游世界，创造发明，而我正在做一些不那么酷的事情——我们正在做的是利用 IComparable 接口。

*   我们将当前实例（您自己）与另一个具有相同类型（人）的对象（其他人）进行比较。

**比较器类呢？**

Comparer 类是实现 IComparer 接口的抽象基类。您应该从此类派生以获得具体的实现。无论如何，Microsoft 建议您使用 Comparer 类而不是实现 IComparer 接口：

> 我们建议您从 Comparer 类派生而不是实现 IComparer 接口，因为 Comparer 类提供了 IComparer.Compare 方法的显式接口实现以及获取对象的默认比较器的 Default 属性。

### 概括

*   IComparer - 排列两件事并进行比较。
*   IComparable - 在 FB 上与他人进行比较。

希望这些故事能帮助你记住。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-11T19:34:42.113

正如其他人所说，他们不做同样的事情。

无论如何，这些天我倾向于不使用 IComparer。我为什么要？它的职责（用于比较两个对象的外部实体）可以用 lambda 表达式处理得更干净，类似于大多数 LINQ 方法的工作方式。编写一个快速 lambda，它将要比较的对象作为参数，并返回一个布尔值。如果对象定义了自己的内在比较操作，它可以实现 IComparable 代替。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-09-09T03:49:43.553

IComparer 是一个用于对 Array 进行排序的接口，该接口将强制类实现 Compare(T x,T y) 方法，该方法将比较两个对象。实现该接口的类的实例用于数组的排序。

IComparable 是在需要比较相同类型的两个对象的类型中实现的接口，这个可比较的接口将强制类实现以下方法 CompareTo(T obj)

IEqualityComparer 是一个用于查找对象是否相等的接口，现在我们将在示例中看到这一点，我们必须在集合中查找对象的 Distinct。这个接口将实现一个方法 Equals(T obj1,T obj2)

现在我们举一个例子，我们有一个 Employee 类，基于这个类我们必须创建一个 Collection。现在我们有以下要求。

使用 Array 类 2 对 Array 进行排序。需要使用 Linq 的集合：删除重复项，按从高到低排序，删除一个员工 ID

```
abstract public class Person
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public string Address { set; get; }
}

public enum SortType
{
    ByID,
    BySalary
} 
```

公共类 EmployeeIdSorter : IComparer { public int Compare(Employee x, Employee y) { if (x.Id < y.Id) return 1; 否则如果 (x.Id > y.Id) 返回 -1；否则返回 0；} }

```
 public class EmployeeSalarySorter : IComparer<Employee>
    {
        public int Compare(Employee x, Employee y)
        {
            if (x.Salary < y.Salary)
                return 1;
            else if (x.Salary > y.Salary)
                return -1;
            else
                return 0;
        }
    } 
```

有关更多信息，请参阅以下 [http://dotnetvisio.blogspot.in/2015/12/usage-of-icomparer-icomparable-and.html](http://dotnetvisio.blogspot.in/2015/12/usage-of-icomparer-icomparable-and.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-11T18:28:26.127

IComparable 表示一个对象可以与另一个对象进行比较。IComparer 是一个可以比较任意两个项目的对象。

# apache - mod_rewrite 给了我 404

> ID：538097
> 
> 赞同：2
> 
> 时间：2009-02-11T18:20:26.740
> 
> 标签：apache, mod-rewrite

我想重写链接 `index.php?page=entry&id=15&action=edit`喜欢`entry/15/edit`。
这就是我的 .htaccess 现在的样子：

```
# Turn the Rewrite engine on
RewriteEngine On

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f

# Rewrite rules
RewriteRule ^([^/]*)(/([^/]*)/?)([^/]*)?$ index.php?page=$1&id=$2&action=$3 [QSA,L] 
```

给我404。

有什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T18:26:54.757

括号太多。你可能感染了 Lisp。

尝试：

```
RewriteRule ^([^/]*)/([^/]*)/?([^/]*)?$ index.php?page=$1&id=$2&action=$3 [QSA,L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T19:09:26.637

这里有一个非常好的一页 mod_rewrite 备忘单：[https ://www.cheatography.com/davechild/cheat-sheets/mod-rewrite/](https://www.cheatography.com/davechild/cheat-sheets/mod-rewrite/)

# reporting-services - 矩阵中的自定义计算 - Reporting Services 2005

> ID：538099
> 
> 赞同：0
> 
> 时间：2009-02-11T18:20:49.890
> 
> 标签：reporting-services, matrix

我正在写一份报告来显示每个部门使用的气体使用量（以加仑为单位）。请求是查看每个月和每个部门使用的加仑数。需要一个列来显示每个部门的目标目标是什么，根据他们在过去的时间范围内使用的汽油加仑数。每个部门的目标目标比所述时间范围内使用的总加仑数少 x%。

我目前在 Reporting Services 中有一个矩阵，其中部门组成行，月组成列，加仑填充细节。矩阵由 dataset1 填充。我有每个部门每个月要求的数据分组。我的问题是计算目标。我的想法是创建第二个数据集（dataset2），它根据请求的时间范围返回使用的加仑数。我按部门对这些数据进行了分组。我希望我可以使用每个数据集中的部门字段来确保使用了适当的数字。

我添加了一个新列，显示在加仑字段旁边。当我尝试构建表达式时，我发现如果我对加仑字段求和，我只能从 dataset2 中获取使用的加仑。这给了我每个部门加起来使用的总加仑数。

我试图找到与我想要完成的类似示例的资源，但我似乎无法找到一个。我试图尽可能详细地保持这一点，而不会使其过于罗嗦。如果需要，我将非常乐意澄清或进一步详细解释我在上面所写的内容。如果有人有链接、评论或建议，他们将不胜感激。

下面是一个非常简单的视觉效果或我希望完成的工作。月份和部门将根据返回的数据进行扩展。

```
 months
       ------------------------------ 
```

部门| 加仑/月 | 目标目标

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-15T20:10:39.153

Add a subtotal to you 'Months' Column, and then use some trickery to get either the gallons/month or target goal for the data. You can do this by using the InScope() function - this defines whether or not a particular 'Detail' cell falls in the gallons/month column or the target goal (subtotal column). Define either the field (Fields!GallonsPerMonth.value) or the calculation (Fields!GallonsPerMonth.Value * x%) for the appropriate scope.

For more on the InScope() function try [this link](http://www.lukehayler.com/2009/07/the-inscope-function-and-the-key-to-formatting-subtotals-in-ssrs-matrix-objects/) Let me know if you need any help with the expression for the Detail Cell.

PS - You've done a great job of explaining what you need.

# c# - 获取列表中包含的类型 通过反思？

> ID：538111
> 
> 赞同：12
> 
> 时间：2009-02-11T18:24:05.293
> 
> 标签：c#, .net, generics, reflection

通过反思，我有什么方法可以查看泛型 List 的包含类型以查看集合的类型？例如：

我有一组从接口派生的简单业务对象，如下所示：

```
public interface IEntityBase{}  

public class BusinessEntity : IEntityBase   
{
    public IList<string> SomeStrings {get; set;}       
    public IList<ChildBusinessEntity> ChildEntities { get; set;}
} 

public class ChildBusinessEntity : IEntityBase{} 
```

在我通过反射遍历 BusinessEntity 的属性的情况下，是否有办法让我查看嵌套在从 IEntityBase 派生的那些列表中的对象？

**像这样的伪**编码（糟糕）：

```
foreach(PropertyInfo info in typeof(BusinessEntity).GetProperties())
{
  if(info.PropertyType is GenericIList &&
     TheNestedTypeInThisList.IsAssignableFrom(IEntityBase)
  {
    return true;
  }
} 
```

到目前为止，我听到的唯一可行的选择是从该列表中拉出第一项，然后查看其类型。任何更简单的方法（特别是因为我不能保证列表不会为空）？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-11T18:28:53.707

假设您有`System.Type`which 描述了您的`List<>`，您可以使用该`Type.GetGenericArguments()`方法来获取`Type`描述它的列表的实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:56:13.687

像这样的东西？

```
foreach (System.Reflection.PropertyInfo info 
                                       in typeof(BusinessEntity).GetProperties())
{
    if (info.PropertyType.IsGenericType &&
        info.PropertyType.Name.StartsWith("IList") &&
        info.PropertyType.GetGenericArguments().Length > 0 &&
        info.PropertyType.GetGenericArguments()[0] == typeof(string)
        )
    {
        return true;
    }
} 
```

# php - php - 如何缩短输出的字符串？

> ID：538113
> 
> 赞同：0
> 
> 时间：2009-02-11T18:24:41.393
> 
> 标签：php

我正在使用 php

如果我输出的字符串长度未知，我该如何将其限制为仅输出 16 个字符？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T18:28:58.933

该函数称为 substr。

```
string substr ( string $string , int $start [, int $length ] ) 
```

所以：

```
return substr($mystring,0,16); 
```

应该这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T18:32:55.163

以上方法，提一下`substr`会对你有所帮助。但是，如果您的字符串包含多字节字符（非英文字符），`mb_substr`则应该使用它，这是一个安全的多字节子字符串函数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T19:29:31.613

I personally like this one if it is a blog or something:

```
<?php

if(strlen($string) > 16) { 
echo substr($string,0,16) . "...";
}else{
echo $string;
}

?> 
```

This way it won't truncate the string if its below 16 characters. Otherwise, it will add an ellipsis.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:25:36.817

> $str = "More than 16 characters of text in this string.";
> 
> print substr( $str,0, 16 );

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T18:31:49.737

使用[substr](http://php.net/substr)

```
 echo substr( $str,0, 16 ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T18:29:36.500

你能提供你现在使用的代码吗？我将基于你有一个函数返回一个未知长度的字符串。您所要做的就是使用 substr 函数。

```
$shorterString = substr( some_function(), 0, 16 ); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T18:30:01.380

```
substr($input_string, 0, 16) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T18:30:05.187

您可以像这样使用[substr](http://php.net/substr)函数。

```
$text = "I am pretty long text.";
echo $text;                        //outputs I am pretty long text.
echo substr($text, 0, 16);         //outputs I am pretty long 
```

# javascript - Safari/Chrome 中的全局控制台对象被重置

> ID：538116
> 
> 赞同：4
> 
> 时间：2009-02-11T18:25:11.360
> 
> 标签：javascript, debugging, safari, google-chrome, webkit

我正在开发一个 jQuery 插件，并试图制作一个统一的跨浏览器控制台对象以进行调试。该插件将利用 Firebug 或 FirebugLite，但也允许用户选择浏览器的本机控制台对象（如果可用）。对于 Safari/Chrome，控制台方法只接受 1 个参数，而 Firebug 控制台 API（这是我试图复制的）接受打印为串联字符串的任意数量的参数。我正在使用以下代码来覆盖本机控制台日志方法：

```
window.console._log = window.console.log;
window.console.log = function(){
    window.console._log($.makeArray(arguments).join(", "));
}; 
```

我有一个测试页面，点击时会触发 console.log("str1", "str2") 命令。前几次，日志消息按预期工作，但一段时间后（通常只有几秒钟），日志消息开始只打印第一个参数。就好像控制台对象正在恢复到其原始的本机状态，而我的覆盖 log() 方法正在被破坏。是否有人对此有更多信息或可能有解决方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-15T20:10:05.290

也许您可能会更幸运地替换整个 Console 对象？这对我有用：

```
window._console = window.console;
window.console = {
    log: function() {
        window._console.log($.makeArray(arguments).join(", "));
    }
}; 
```

* * *

FWIW，在 WebCore IDL 源代码中， 的`console`属性`DOMWindow`被[标记为 Replaceable](http://trac.webkit.org/browser/trunk/WebCore/page/DOMWindow.idl#L152)，而[控制台对象的属性不是](http://trac.webkit.org/browser/trunk/WebCore/page/Console.idl#L37)。

# c# - 你最喜欢的 FxCop 规则是什么？

> ID：538117
> 
> 赞同：4
> 
> 时间：2009-02-11T18:25:22.513
> 
> 标签：c#, .net, fxcop

您最看重哪些 FxCop 规则？哪些规则突出了最好的 .Net 陷阱？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T18:26:46.460

我最喜欢的 FxCop 规则是那些在编译我的代码时不会给我错误的规则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:08:06.890

> 您最看重哪些 FxCop 规则？

我要写的一个是为了阻止开发人员使用#defines 而不是配置（[需要引用：预处理器的使用是不好的 OO 实践](https://stackoverflow.com/questions/473354/quote-needed-preprocessor-usage-is-bad-oo-practice)）。我喜欢几乎所有的设计规则。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T17:28:48.143

我发现一些使用和设计规则特别有用。我永远记不起如何实现 IDisposable 或 ISerializable 接口的细节，所以我很欣赏这些规则的温柔提醒：

*   [正确实施 IDisposable](http://msdn.microsoft.com/en-ca/library/ms244737.aspx)
*   [一次性字段应该被丢弃](http://msdn.microsoft.com/en-ca/library/ms182328.aspx)
*   [正确调用 GC.SuppressFinalize](http://msdn.microsoft.com/en-ca/library/ms182269.aspx)
*   [正确实现 ISerializable](http://msdn.microsoft.com/en-ca/library/ms182342.aspx)
*   [实现序列化构造函数](http://msdn.microsoft.com/en-ca/library/ms182343.aspx)
*   [用 SerializableAttribute 标记 ISerializable 类型](http://msdn.microsoft.com/en-ca/library/ms182350.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:36:35.060

The ones I value the most, and which highlight the gotchas, are the Performance rules.

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-11-14T18:55:15.383

这不是 FxCop 规则，而是 NDepend [Code Query Language 规则](http://www.ndepend.com/Features.aspx#CQL)，但是，我喜欢 CQL 规则：

```
// <Name> Make sure refactored and added methods are covered by tests</Name>
WARN IF Count > 0 In SELECT METHODS WHERE 
PercentageCoverage < 100
AND (CodeWasChanged OR WasAdded) 
```

# .net - .Net XML 文档标准

> ID：538121
> 
> 赞同：2
> 
> 时间：2009-02-11T18:25:47.880
> 
> 标签：.net, documentation

我已经查看了建议的相关问题，但没有一个是我想要的。作为一名新开发人员，我正在努力遵循最佳实践，而文档是一个重要的。当我去的时候，我试图在我的代码中创建 XML 文档。我发现了有助于加快速度 的[GhostDoc插件。](http://www.roland-weigelt.de/ghostdoc/)

我的问题是；是否有关于应包含在 XML 中的内容的普遍例外标准。默认情况下，我`<Summary><Param><Returns>`在适用时使用。还有其他人吗？我应该包括作者吗？如何？`<Patrick></Patrick>`? `<Remarks>`值得花时间吗？

对于这方面的任何指导，我将不胜感激。谢谢你！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T18:32:59.173

我绝对认为该`<remarks>`标签值得花时间，因为它可以让您详细说明摘要，并且更多的知识总是一件好事。

我也认为这`<typeparamref>`对于泛型类很重要。

在您的每个元素中，您还应该使用`<see>`标签，以便您可以将文档链接在一起。

在标准标签之外，我添加`<author>`了显示类/方法/属性/等的原始作者，以及一个`<created>`标签来指示成员的创建时间。在团队环境中，您可能需要更健壮的东西，例如：

```
<revisions>
  <revision>
    <author>Nicholas Paldino</author>
    <revised>2009-02-01</revised>
  </revision>
  <revision>
    <author>Mr_Mom</author>
    <revised>2009-02-11</revised>
  </revision>
</revisions> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T18:52:29.487

我最近才发现[这个 XML 文档指南](http://thoughtpad.net/alan-dean/cs-xml-documentation.html)。它*真的很*方便。它本身不是最佳实践指南，但它擅长涵盖不经常使用并因此被遗忘的标签。

# asp.net - ASP.NET 线程在生产中不起作用

> ID：538122
> 
> 赞同：1
> 
> 时间：2009-02-11T18:25:58.160
> 
> 标签：asp.net, multithreading

出于某种奇怪的原因，我无法在生产环境中将任何功能作为新线程运行，即使它在本地运行良好并且在与生产服务器具有相同规格的登台服务器（Windows 2003，IIS 6）上运行良好

这是我的代码：

```
System.Threading.Thread th = new System.Threading.Thread(TestFunction);
th.Start(); 
```

这是功能：

```
public void TestFunction()
{
   LogUtility.Log("hello world");
} 
```

在 th.Start 之后，没有其他内容被访问。是否有一些设置可能导致这种行为？th.ThreadState 在 TestFunction 期间返回“正在运行”。

（LogUtility.Log 只是将文本写入文件）

编辑：这实际上之前有效，它只是突然停止工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T20:29:29.063

原来是因为我在使用模拟，而模拟在创建新线程时不适用。这就是我修复它的方式，以便线程使用与调用函数相同的模拟：

```
public static WindowsIdentity ident;

public void ProcessRequest(HttpContext context)
{
    ident = WindowsIdentity.GetCurrent();
    System.Threading.Thread th = new System.Threading.Thread(ThreadedFunction);
    th.Start();
}

public void ThreadedFunction()
{
    WindowsImpersonationContext c = null;
    try
    {
        c = ident.Impersonate();
        // Your code here
    }
    finally
    {
        if (c != null) c.Undo();
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T18:34:01.557

这可能与安全有关吗？线程操作需要相当高的 CAS（代码访问安全）权限，并且在托管环境中，您可能正在运行受限权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T18:34:15.833

您确定不仅仅是 LogUtility 失败了吗？当存在更简单的解释时，我不会这么快怀疑线程系统:)。

# maven-2 - Maven 包 .bat 脚本：如何添加延迟？

> ID：538130
> 
> 赞同：9
> 
> 时间：2009-02-11T18:27:56.253
> 
> 标签：maven-2, scripting, batch-file

我有这个 .bat 脚本，我用它来 maven 打包我的应用程序。问题是，就在它结束执行之后，它关闭了控制台窗口。最后两行不知何故被完全忽略了。

有谁知道使这项工作的诀窍？我只是想快速检查一下构建是否成功。

```
@echo off
cls
cd C:\svn\project
mvn package -o -P local
sleep 3
pause 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-11T18:32:43.230

你可以试着写

```
call mvn package -o -P local 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T18:31:45.947

这是我在[这里](http://notetodogself.blogspot.com/2007/11/wait-or-pause-in-windows-batch-script.html)找到的一个 hack ：

```
ping 1.0.0.0 -n 1 -w 5000 >NUL 
```

这将 ping 一个无法访问的主机，并在两者之间暂停。标准输出也被重定向，因此您在输出中看不到它。不是最好的解决方案，但会在紧要关头工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T18:32:59.127

Windows Server 2003 Resource Kit Tools 提供了命令行休眠功能：

[http://malektips.com/xp_dos_0002.html](http://malektips.com/xp_dos_0002.html)

# flash - 动态访问 Flash actionscript 2 中的嵌套影片剪辑

> ID：538133
> 
> 赞同：2
> 
> 时间：2009-02-11T18:28:19.793
> 
> 标签：flash, dynamic, variables, actionscript-2, movieclip

我有一个要访问的嵌套影片剪辑实例。影片剪辑的路径由两个变量定义（类似于行和列）。

我已经像这样动态访问父影片剪辑：

评估（“行”+ ActiveRow）

现在我想动态访问名为 let(#) 的 row(#) 的子节点之一。

以下是我完成任务的最佳猜测（两者都不起作用）：

变量我：数字；

eval("row" + ActiveRow + ".let" + i) 或 eval("row" + ActiveRow).eval("let" + i)

非常感谢您的努力和可能的解决方案..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T19:07:29.950

你可以试试

```
this["row" + ActiveRow]["let" + i] 
```

但是，如果在创建实例时将它们放入数组中，那会更好……所以也许

```
var rowClips : Array = [];

for (var i : int = 0; i < 10; i++)
{
     var row : MovieClip = this.createEmptyMovieClip("row" + i, i);

     rowClips.push(row);
} 
```

然后你可以通过

```
rowClips[i]; 
```

显然，视情况而定，将您的 MovieClips 添加到数组中可能会有不同的逻辑，但本质上这是一种更好的方式来存储对您的 MovieClips 的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T19:08:39.853

访问父影片剪辑后，只需对子影片进行索引。ActionScript 2 不要求您使用该`eval`函数来查找动态属性。只需使用对象和`[]`（数组）运算符来索引所需的变量。

如果您的“行”对象位于当前影片剪辑的根目录中，您可以简单地使用`_root[ "row" + ActiveRow ][ "let" + i ]`.

但是，由于您已经通过 获得了初始影片剪辑`eval("row"+ActiveRow)`，因此您可以使用此对象来获得下一个级别。例如，`eval("row" + ActiveRow)[ "let" + i ]`。

Flash 大量借鉴了 JavaScript，并且和 JavaScript 一样，每个对象本质上都是一个哈希表。使用点运算符等同于使用带有固定字符串的 []（数组）运算符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T18:31:26.297

首先，您似乎使用的是表格数据结构，因此一种简单的方法是创建一个二维数组并将影片剪辑存储在其中。然后您可以按索引进行查找。

或者，您可以为每个影片剪辑命名（使用 name 属性），并使用 getChildByName。

即 getChildByName("row"+i).getChildByName("column"+i)。

# winapi - 使用 dllexport 从 DLL 导出函数

> ID：538134
> 
> 赞同：111
> 
> 时间：2009-02-11T18:28:23.427
> 
> 标签：winapi, visual-c++, dll, name-decoration

我想要一个从 C++ Windows DLL 导出函数的简单示例。

我想查看标题、`.cpp`文件和`.def`文件（如果绝对需要）。

我希望导出的名称是***undecorated***。我想使用最标准的调用约定（`__stdcall`？）。我想要使​​用`__declspec(dllexport)`，而不是必须使用`.def`文件。

例如：

```
 //header
  extern "C"
  {
   __declspec(dllexport) int __stdcall foo(long bar);
  }

  //cpp
  int __stdcall foo(long bar)
  {
    return 0;
  } 
```

我试图避免链接器在名称中添加下划线和/或数字（字节数？）。

我可以不支持`dllimport`和`dllexport`使用相同的标题。我不想要任何关于导出 C++ 类方法的信息，只想要 c 样式的全局函数。

***更新***

不包括调用约定（和使用`extern "C"`）为我提供了我喜欢的导出名称，但这意味着什么？是什么默认调用约定我得到什么 pinvoke (.NET)、声明 (vb6) 和`GetProcAddress`期望？（我猜`GetProcAddress`这将取决于调用者创建的函数指针）。

我希望在没有头文件的情况下使用这个 DLL，所以我真的不需要太多花哨的东西`#defines`来使调用者可以使用头文件。

我可以回答是我必须使用`*.def`文件。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-02-11T18:39:15.117

如果您想要纯 C 导出，请使用 C 项目而不是 C++。C++ DLL 依赖于所有 C++isms（命名空间等）的名称修饰。您可以通过进入 C/C++->Advanced 下的项目设置将代码编译为 C，有一个选项“编译为”对应于编译器开关 /TP 和 /TC。

如果您仍想使用 C++ 编写 lib 的内部结构，但导出一些未损坏的函数以在 C++ 之外使用，请参阅下面的第二部分。

## 在 VC++ 中导出/导入 DLL 库

您真正想要做的是在头文件中定义一个条件宏，该宏将包含在您的 DLL 项目的所有源文件中：

```
#ifdef LIBRARY_EXPORTS
#    define LIBRARY_API __declspec(dllexport)
#else
#    define LIBRARY_API __declspec(dllimport)
#endif 
```

然后在要导出的函数上使用`LIBRARY_API`：

```
LIBRARY_API int GetCoolInteger(); 
```

在您的库构建项目中创建一个定义`LIBRARY_EXPORTS`，这将导致为您的 DLL 构建导出您的函数。

由于`LIBRARY_EXPORTS`不会在使用 DLL 的项目中定义，因此当该项目包含库的头文件时，将导入所有函数。

如果您的库是跨平台的，您可以在不在 Windows 上时将 LIBRARY_API 定义为空：

```
#ifdef _WIN32
#    ifdef LIBRARY_EXPORTS
#        define LIBRARY_API __declspec(dllexport)
#    else
#        define LIBRARY_API __declspec(dllimport)
#    endif
#elif
#    define LIBRARY_API
#endif 
```

使用 dllexport/dllimport 时不需要使用 DEF 文件，如果使用 DEF 文件则不需要使用 dllexport/dllimport。这两种方法以不同的方式完成相同的任务，我认为 dllexport/dllimport 是两者中推荐的方法。

## 从 C++ DLL 中为 LoadLibrary/PInvoke 导出未损坏的函数

如果您需要它来使用 LoadLibrary 和 GetProcAddress，或者可能从另一种语言导入（即来自 .NET 的 PInvoke，或 Python/R 中的 FFI 等），您可以`extern "C"`在 dllexport 中使用内联来告诉 C++ 编译器不要破坏名称。由于我们使用的是 GetProcAddress 而不是 dllimport，我们不需要从上面执行 ifdef 舞蹈，只需一个简单的 dllexport：

编码：

```
#define EXTERN_DLL_EXPORT extern "C" __declspec(dllexport)

EXTERN_DLL_EXPORT int getEngineVersion() {
  return 1;
}

EXTERN_DLL_EXPORT void registerPlugin(Kernel &K) {
  K.getGraphicsServer().addGraphicsDriver(
    auto_ptr<GraphicsServer::GraphicsDriver>(new OpenGLGraphicsDriver())
  );
} 
```

以下是使用 Dumpbin /exports 导出的内容：

```
 Dump of file opengl_plugin.dll

  File Type: DLL

  Section contains the following exports for opengl_plugin.dll

    00000000 characteristics
    49866068 time date stamp Sun Feb 01 19:54:32 2009
        0.00 version
           1 ordinal base
           2 number of functions
           2 number of names

    ordinal hint RVA      name

          1    0 0001110E getEngineVersion = @ILT+265(_getEngineVersion)
          2    1 00011028 registerPlugin = @ILT+35(_registerPlugin) 
```

所以这段代码工作正常：

```
m_hDLL = ::LoadLibrary(T"opengl_plugin.dll");

m_pfnGetEngineVersion = reinterpret_cast<fnGetEngineVersion *>(
  ::GetProcAddress(m_hDLL, "getEngineVersion")
);
m_pfnRegisterPlugin = reinterpret_cast<fnRegisterPlugin *>(
  ::GetProcAddress(m_hDLL, "registerPlugin")
); 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2017-01-28T13:40:01.923

**对于 C++：**

我刚刚遇到了同样的问题，我认为值得一提的是，当一个人同时使用 `__stdcall`(or `WINAPI`)**和** `extern "C"`时会出现一个问题：

如您所知`extern "C"`，删除了装饰，而不是：

```
__declspec(dllexport) int Test(void)                        --> dumpbin : ?Test@@YaHXZ 
```

你得到一个未修饰的符号名称：

```
extern "C" __declspec(dllexport) int Test(void)             --> dumpbin : Test 
```

但是`_stdcall`（= 宏 WINAPI，它改变了调用约定）也装饰了名称，因此如果我们同时使用两者，我们将获得：

```
 extern "C" __declspec(dllexport) int WINAPI Test(void)   --> dumpbin : _Test@0 
```

并且`extern "C"`由于符号被装饰（带有_ @bytes）而失去了好处

> 请注意，*这只*发生在 x86 架构上，因为`__stdcall`x64 上忽略了约定（[msdn](https://msdn.microsoft.com/en-us/library/zxk0tw93.aspx)：*在 x64 架构上，按照约定，参数尽可能在寄存器中传递，后续参数在堆栈上传递*。）。

如果您同时针对 x86 和 x64 平台，这尤其棘手。

* * *

**两种解决方案**

1.  使用定义文件。但这会迫使您维护 def 文件的状态。

2.  最简单的方法：定义宏（参见[msdn](https://msdn.microsoft.com/en-us/library/7f0aews7.aspx)）：

> #define EXPORT 注释（链接器，“/EXPORT：” __FUNCTION__ “=” __FUNCDNAME__）

然后在函数体中包含以下编译指示：

```
#pragma EXPORT 
```

完整示例：

```
 int WINAPI Test(void)
{
    #pragma EXPORT
    return 1;
} 
```

这将为 x86 和 x64 目标导出未修饰的函数，同时保留`__stdcall`x86 的约定。在这种情况下`__declspec(dllexport)` **不需要**。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-09-23T14:34:09.823

我遇到了完全相同的问题，我的解决方案是使用模块定义文件（.def）而不是`__declspec(dllexport)`定义导出（[http://msdn.microsoft.com/en-us/library/d91k01sh.aspx](http://msdn.microsoft.com/en-us/library/d91k01sh.aspx)）。我不知道为什么会这样，但确实如此

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-11T18:40:03.040

我认为 _naked 可能会得到你想要的，但它也会阻止编译器为函数生成堆栈管理代码。extern "C" 导致 C 样式名称装饰。删除它，那应该摆脱你的_。链接器不添加下划线，编译器会。stdcall 导致附加参数堆栈大小。

有关更多信息，请参阅： [http ://en.wikipedia.org/wiki/X86_calling_conventions](http://en.wikipedia.org/wiki/X86_calling_conventions) [http://www.codeproject.com/KB/cpp/calling_conventions_demystified.aspx](http://www.codeproject.com/KB/cpp/calling_conventions_demystified.aspx)

更大的问题是你为什么要这样做？乱七八糟的名字有什么问题？

# design-patterns - 最佳实践：在多个类中初始化相同的组件

> ID：538139
> 
> 赞同：2
> 
> 时间：2009-02-11T18:29:21.460
> 
> 标签：design-patterns, oop

这是我的第一个问题，所以请耐心等待:)

背景：我正在实现一个观察者模式，我有大约 20 个类最终会在其中实现它。为了使用主题和观察者，我需要： 1：初始化观察者类 2：创建委托 3：向事件添加委托

这可能很简单，但我不想在每个类中初始化所有这 3 个步骤，所以我倾向于使用基类来初始化这些组件。但这会是一个好习惯吗？因为基类与我的其他类没有任何关系，它只会进行初始化。或者创建另一个类并创建一个实例并通过该类使用这些组件会更好，但是我需要在 20 个类中创建相同的实例。

感谢您的反馈。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T18:34:32.040

这是一个支持组合而不是继承的地方。创建组件将该组件添加到每个需要它的类。

# php - 为什么 mysql_real_escape_string() 不起作用？

> ID：538146
> 
> 赞同：0
> 
> 时间：2009-02-11T18:31:30.037
> 
> 标签：php, sql

我正在尝试使用 PHP 将某些内容写入数据库，但是如果我尝试使用 mysql_real_escape_string() 我没有收到任何错误，但没有任何内容保存到数据库中，我不知道为什么 =/ 特别是因为我做了同样的事情在另一个 PHP 文件上，它工作得很好......

```
<?php
if(isset($_POST['reporte']))
    $falla = $_POST['reporte'];
else      
    $falla = "";

if(!isset($falla)){
    echo '<font color="red">Intentó enviar una forma vacía. Por favor intente de nuevo.</font>';
}else{
$fecha = mysql_real_escape_string(stripslashes($_POST['fecha']));
$usuario = mysql_real_escape_string(stripslashes($_POST['usuario']));

connection...

 $sql = "INSERT INTO $tbl_name(usuario, comentario, fecha, estado) VALUES('$usuario','$falla','$fecha', '0')" or die('mysql_error()'); 
```

现在我不检查“fecha”或“usuario”是否为空，因为它们是通过表单中的隐藏字段发送的。

* * *

**编辑**

我做了开关，仍然没有错误，没有任何东西进入 db =/我正在查看文档，但我很困惑，因为我之前已经以完全相同的方式完成了此操作并且它有效......哈哈......

* * *

**编辑 2**

是的，我有一个

```
mysql_query($sql) or die('Error SQL !'.$sql.'<br>'.mysql_error()); 
```

是的，我已将 $tbl_name 与连接一起设置在：

```
$host="localhost"; 
$username="user"; 
$password="pass"; 
$db_name="cosa"; 
$tbl_name="reportes"; 
```

我已经在数据库监视器中检查并打印了它......它返回正常......但是，你所说的“清理”$falla是什么意思？我认识注入，但我对 php 本身很陌生。

* * *

**编辑 3**

我使用 die 只是为了测试，但是没有显示错误，如果我使用“mysql_real_escape_string()”，它会顺利运行，只是不会插入东西

* * *

**编辑 4**

这是我当前的代码：

```
<?php
if(isset($_POST['reporte']))
    $falla = $_POST['reporte'];
else      
    $falla = "";

if(!isset($falla)){
    echo '<font color="red">Intentó enviar una forma vacía. Por favor intente de nuevo.</font>';
}else{

    $host="localhost"; // Host name
    $username="user"; // Mysql username
    $password="pass"; // Mysql password
    $db_name="cosa"; // Database name
    $tbl_name="reportes"; // Table name

    // To protect MySQL injection
    $fecha = mysql_real_escape_string(stripslashes($_POST['fecha']));
    $usuario = mysql_real_escape_string(stripslashes($_POST['usuario']));
    $falla = mysql_real_escape_string(stripslashes($falla));

    $db = mysql_connect($host, $username, $password) or die('Cannot Connect '.mysql_error()); 
     mysql_select_db($db_name) or die('Cannot select DB '.mysql_error());

    $sql = "INSERT INTO $tbl_name(usuario, comentario, fecha, estado) VALUES('$usuario','$falla','$fecha', '0')" or die('mysql_error()');

    mysql_query($sql) or die('Error SQL !'.$sql.'<br>'.mysql_error());

    header("location:../../user/usuario.php"); 
    mysql_close();    
}  
?> 
```

那是完整的，并且根据我在这里得到的建议进行了更改...仍然没有将任何内容放入数据库...

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-11T18:33:40.483

我认为您可能需要在使用[mysql_real_escape_string](http://php.net/mysql_real_escape_string)之前打开 mysql 连接。请参阅文档。

**编辑**

试试这个，但是你的表上的数据类型是什么？所有字段（usuario、commentario、fecha、estado）都是字符串吗？这就是你的插入语句所说的，我相信。

```
<?php
if( isset( $_POST[ 'reporte' ] ) ) {
    $falla = $_POST[ 'reporte' ];
} else {
    $falla = "";
}

if( !isset( $falla ) ) {
    echo '<font color="red">Intentó enviar una forma vacía. Por favor intente de nuevo.</font>';
} else {

    $host = "localhost"; // Host name
    $username = "user"; // Mysql username
    $password = "pass"; // Mysql password
    $db_name = "cosa"; // Database name
    $tbl_name = "reportes"; // Table name

    $db = mysql_connect( $host, $username, $password ) or die( 'Cannot connect ' . mysql_errno( ) );
    mysql_select_db( $db_name ) or die( 'Cannot select DB ' . mysql_error( ) );

    $fecha = mysql_real_escape_string( stripslashes( $_POST[ 'fecha' ] ) );
    $usuario = mysql_real_escape_string( stripslashes( $_POST[ 'usuario' ] ) );
    $falla = mysql_real_escape_string( stripslashes( $falla ) );

    $sql = "INSERT INTO $tbl_name(usuario, comentario, fecha, estado) VALUES('$usuario','$falla','$fecha', '0')" or die( 'mysql_error()' );

    mysql_query( $sql ) or die( 'Error SQL !' . $sql . '<br>' . mysql_error( ) );

    // You need a URL here, not a relative path
    header( "Location:../../user/usuario.php" );
    mysql_close( );
}
?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T18:44:58.100

检查[mysql_error的输出](http://www.php.net/manual/en/function.mysql-error.php)

mysql 扩展的一般使用模式是：

```
mysql_query($sql) or trigger_error(mysql_error()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T22:21:21.807

您不需要在 $sql var 末尾进行错误检查：

```
$sql = "INSERT INTO $tbl_name(usuario, comentario, fecha, estado) VALUES('$usuario','$falla','$fecha', '0')" or die( 'mysql_error()' ); 
```

这是一个声明，因此没有什么可以或因失败而死。尝试将其更改为以下内容：

```
$sql = "INSERT INTO $tbl_name(usuario, comentario, fecha, estado) VALUES('$usuario','$falla','$fecha', '0');" 
```

不确定它是否一定是你的错误的原因，但它不是必需的。

此外，我运行您的代码减去标头重定向，正如 nickohrn 所述，您需要在使用 mysql_real_escape_string 之前连接到 mysql 服务器。代码运行良好，本地记录已进入数据库。

尝试在没有 header() 调用的情况下运行您的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T01:52:03.017

请尝试另一种方式。使用 PEAR:DB 或类似框架来使用准备好的语句，而不是这种逃避黑客。调用 mysql_real_escape_string 和 stripslashes 之类的函数是引入奇怪错误和 SQL 注入问题的完美方式，这些问题最终会导致数据中的斜杠过多或过少。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T02:17:43.813

因为它不如 MySQLi 和 PDO 的 prepare() 方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T18:42:42.177

首先，我假设您有`mysql_query($sql)`以下内容：示例的最后一行将永远不会`die()`，因为您只是在那里创建了一个字符串。

二、你定了`$tbl_name`吗？

第三，尝试打印出来`$sql`，检查它，如果它看起来正确，请在数据库监视器或您使用的任何 GUI 工具中尝试；看看数据是否真的在数据库中结束（尝试插入，然后选择你刚刚插入的数据）。

顺便说一句，你真的应该`$falla`像你已经消毒`$fecha`和`$usuario`-`mysql_real_escape_string(stripslashes($falla));`或类似的东西一样消毒。否则，`$_POST['reporte']`(and `$falla`) 成为[SQL injection](http://en.wikipedia.org/wiki/SQL_injection)的向量。

# xml - 如何在 CDATA 部分中写入文字“]]>”而不结束该部分

> ID：538163
> 
> 赞同：10
> 
> 时间：2009-02-11T18:34:55.113
> 
> 标签：xml, cdata

非常简单的问题，我正在编写一个 XML 文档，但我不确定如何编写“]]>”而不将其视为本节的结尾。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-11T18:37:34.203

你可以这样做：

```
]]>]]&gt;<![CDATA[ 
```

这最终将 CDATA 部分分成两部分，但这是您必须做的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-11T18:37:53.407

我认为

```
<![CDATA[]]]]><![CDATA[>]]> 
```

是要走的路。

那是：

*   一个包含文字字符串`]]`( `<![CDATA[]]]]>`)的 CDATA 部分
*   一个包含文字字符串`>`( `<![CDATA[>]]>`)的 CDATA 部分

在实践中，可能会在第一个之前`]]`和/或之后有文本`>`

[在http://en.wikipedia.org/wiki/CDATA#Uses_​​of_CDATA_sections](http://en.wikipedia.org/wiki/CDATA#Uses_of_CDATA_sections)查看更多信息

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-11T18:37:46.057

你不能。CDATA 不提供任何转义字符的方法，因此这些字符将始终表示 CDATA 部分的结尾。但是，您可以让他们结束 CDATA 部分，添加“ `]]&gt;`”并使用“”开始一个新的部分`<![CDATA[`。

这样，字符串 " `]]>]]&gt;<![CDATA[`" 几乎具有在 CDATA 部分中作为 "`]]>" 转义的效果。

# javascript - 如何使用 Script# 生成缩小的 javascript？

> ID：538166
> 
> 赞同：1
> 
> 时间：2009-02-11T18:35:46.843
> 
> 标签：javascript, visual-studio, minify, script#

我正在测试 Script#，它的手册告诉我它有一个“发布”模式，其中代码被缩小以提高性能。但我找不到如何进入此模式。有谁知道？

**更新**BenS 找到了命令行解决方案。我想知道是否有图形解决方案，最好与 Visual Studio 集成。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T16:31:18.273

来自 Script# 的作者[Nikhil Kothari 的 Script# Intro](http://www.nikhilk.net/ScriptSharpIntro.aspx)：

> 编译器具有调试和发布版本的概念。
> 
> ssc /ref:sscorlib.dll /ref:Script.ScriptFX.Core.dll /minimize /out:HelloWorld.js HelloWorld.cs
> 
> 在没有 /debug 和 /minimize 的情况下运行编译器会生成一个发布版本。

从第 8 页的[Script# Manual中：](http://projects.nikhilk.net/Content/Projects/ScriptSharp/ScriptSharp.pdf)

> 生成的网站结构如下所示（如下面解决方案资源管理器的屏幕截图所示），Script# 程序集位于 Bin\Script 文件夹中，相应的调试和发布脚本文件位于 App_Scripts 文件夹中。

# netbeans - j2mewtk - 将文件添加到 DefaultColorPhone 临时设置

> ID：538167
> 
> 赞同：1
> 
> 时间：2009-02-11T18:36:29.120
> 
> 标签：netbeans, java-me, java-wireless-toolkit

我正在使用 Netbeans 和 j2mewtk 来开发和测试移动应用程序。如果我想在图像上执行文件 IO，则模拟器使用 ...\j2mewtk\2.5.2\appdb\temp.DefaultColorPhone[####]\filesystem\root1 来存储当前临时仿真的文件。

如果我想对预先存在的图像进行操作，我必须启动模拟器，检查它正在使用的临时环境（在 Netbeans 输出窗口中），然后导航到该目录并将图像放入，然后继续运行到移动应用程序

. 让模拟器或 netbeans 使用预先存在的图像启动临时目录应该非常简单。我尝试过使用初始的 DefaultColorPhone，希望每个临时实例都能从中汲取灵感，但我没有运气。我只是不知道该怎么做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:27:48.713

上个月我一直在寻找答案。可以相信，在发布后的几分钟内，我在[Sun（现在的 Oracle）论坛](https://forums.oracle.com/forums/thread.jspa?threadID=1744054)上找到了一些东西。基本上，模拟器将使用 DefaultColorPhone 作为初始目录。但是当它在使用时，`in.use`会创建一个文件并驻留在目录中。如果 in.use 没有被删除（应该是在模拟器关闭时），那么下一次运行会动态创建一个临时文件。所以，如果你有这个问题，只需清理 DefaultColorPhone 目录，一切都会好起来的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T21:14:58.470

嗖嗖声是对的。清理目录应该会有所帮助。workdir 是作为*当前使用*的work dir 的副本创建的，因此将文件放在那里也应该有所帮助。

# javascript - javascript 执行时 Internet Explorer 6 中止页面请求

> ID：538178
> 
> 赞同：0
> 
> 时间：2009-02-11T18:38:49.473
> 
> 标签：javascript, html, internet-explorer-6

场景是这样的。一个网页包含：

*   一些 DIV，其可见性可以用 javascript 切换（从超链接触发）
*   提交按钮，其响应大约需要 5 秒

超链接代码是

```
<a href="javascript:void null;" onclick="MyFunction()">foo</a> 
```

用户：

1.  按提交。
2.  在等待响应时，他单击超链接，并触发切换 DIV 可见性的 javascript（不执行其他请求）。
3.  在 Internet Explorer 6 中，浏览器停止等待第一个请求。

该问题在其他浏览器中不会发生，即使用户使用 DIV 进行操作，第一个请求也得到了正确处理，我们导航到下一页。

有谁知道这可能是什么原因造成的？这是一个已知的 IE6 问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T18:43:53.720

是的，这是由*超链接*上*的 Javascript 操作触发的***GET**请求的**IE6**问题（**其中 href 设置为 'javascript:...'**）。

 ******> 例如，如果您的 JavaScript 调用 `someForm.submit()`并且方法是 `GET`，则会有`NO`响应（尽管肯定会发送请求）

[http://webbugtrack.blogspot.com/2007/09/bug-223-magical-http-get-requests-in.html](http://webbugtrack.blogspot.com/2007/09/bug-223-magical-http-get-requests-in.html)

您要么需要修改链接，就像：

```
<a href="#bogushash" onclick="MyFunction()">foo</a>
         ^^^^^^^^^^ 
```

或始终使用 return false 设置链接；

```
<a href="javascript:void null;" onclick="MyFunction();return false;">foo</a>
                                                      ^^^^^^^^^^^^^ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T18:48:09.963

我真的不认为调用 javascript:void null; 是明智的。从链接。这可能会导致您的问题。而是让 href 包含有效链接，但阻止默认操作完成请求

```
<a href="#" onclick="return MyFunction(event)">foo</a> 
```

在哪里

```
function MyFunction(e)
{
  if (!e) e = window.event;

  // your code

  if (e.preventDefault) e.preventDefault();
  return false;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T19:39:48.170

`javascript:void null`应该的`javascript:void(0)`，更好的还是`href="#"`。如果 MyFunction 返回 false，则`return false`不需要使用 scunliffe 的答案`onclick="return MyFunction()"`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T18:48:53.597

因为这是一个问题。我建议使用一个伪“加载”微调器，在触发提交时覆盖可点击内容。

# c# - C# 中的工厂模型，不使用默认构造函数

> ID：538180
> 
> 赞同：0
> 
> 时间：2009-02-11T18:39:56.677
> 
> 标签：c#, winforms, mdi

我一直在使用工厂模型来创建子表单以添加到 MDI 表单。这是我一直在使用的代码：

```
 /// <summary>
    /// This uses the Factory Model to create the child node and then add it to the MDI Parent (this)
    /// </summary>
    /// <param name="childName">String class name of the child, i.e. RentalEase.PropertyGrid must extend Form or SingleInstance</param>
    /// <param name="singleInstance">bool If this class is to be a single instance and restricted to only on instance. Must extend SingleInstance</param>
    public void createChild(string childName, bool singleInstance) {
        if (singleInstance) {
            try {
                BaseAndSingleInstanceForm f = BaseAndSingleInstanceForm.getInstanceByType(this, Type.GetType(childName));
                    f.MdiParent = this;
                    f.Show();
                    f.BringToFront();
                    this.Refresh();
            } catch (Exception ex) {
                MessageBox.Show("Could not create child: " + ex.ToString());
            }
        } else {
            try {
                object o = Activator.CreateInstance(Type.GetType(childName));
                if (o is Form) {
                    Form f = (Form)o;
                    f.MdiParent = this;
                    f.Show();
                    f.BringToFront();
                    this.Refresh();
                } else {
                    throw new ArgumentException("Invalid Class");
                }
            } catch (Exception ex) {
                MessageBox.Show("Could not create child: " + ex.ToString());
            }
        }
    } 
```

但是，出现了一种情况，我必须将整数参数添加到特定表单的构造函数中。我怎样才能改变它并让它反映它，同时仍然保持模式在它当前的易用性（或几乎）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T18:46:42.493

您可以向方法添加一个`Object[]`参数，该参数表示您希望实例化的对象的构造函数的参数。然后，当您调用时，`Activator.CreateInstance`您可以传入该数组，并`Activator`尽最大努力在您指定的类型上找到与`Object`数组中的类型匹配的构造函数。

这是我的意思的一个非常简化的示例：

```
using System;

class Program
{
    static void Main()
    {
        Foo foo = (Foo)create("Foo", new Object[] { });
        Bar bar = (Bar)create("Bar", new Object[] { "hello bar" });
        Baz baz = (Baz)create("Baz", new Object[] { 2, "hello baz" });
    }

    static Object create(String typeName, Object[] parameters)
    {
        return Activator.CreateInstance(Type.GetType(typeName), parameters);
    }   
}

class Foo
{
    public Foo() { }
}

class Bar
{
    public Bar(String param1) { }
}

class Baz
{
    public Baz(Int32 param1, String param2) { }
} 
```

We have three types that all have different constructors - if the caller is responsible for sending in the type name then they will also be responsible for supplying an array of `Objects` that will satisfy a non-default constructor.

# apache-flex - 如何让 Flex 文本控件自动换行

> ID：538199
> 
> 赞同：33
> 
> 时间：2009-02-11T18:44:24.153
> 
> 标签：apache-flex, text, word-wrap

我正在创建一个 Adob​​e Flex 应用程序，并且我有一个文本控件 (mx:Text)，据说当您需要多行不可编辑文本时使用它（而不是标签，它是单行不可编辑文本）。当我将浏览器窗口的大小调整为小于文本时（或在浏览器窗口已经较小的情况下加载它）时，我的文本控件不会换行。在查阅我发现的[这个文档](http://livedocs.adobe.com/flex/3/html/help.html?content=textcontrols_08.html)后，似乎只有在您指定以像素为单位的绝对宽度时才会发生自动换行功能。这正是我想要避免的。我希望文本换行以适合我的 Flash 对象的大小，以便它始终可见......有没有办法通过我缺少的某些属性或不同的控件来实现这一点？谢谢。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-16T22:21:59.050

我有同样的问题。在我的情况下，我有一个 mx:Text 块（应该已经包装），并且那个 mx:Text 对象嵌入在两个 mx:VBox 容器中。

我成功包装文本的唯一方法是执行以下两项操作：

1.  将 'width="100%" ' 属性放入每个 VBox 容器（mx:text 所在的容器）。
2.  将 'width="100%" ' 属性放入每个 mx:Text 对象（位于 VBox 的此嵌套中）

非常不直观，但这对我有用。

我希望这可以帮助你！

乔恩·金斯廷

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-11T19:10:19.910

百分比宽度和高度实际上解析为它们的像素等价物，因此使用它们应该可以实现您正在寻找的环绕和相对大小。例如：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%">
    <mx:Text width="100%" height="100%" text="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum." />
</mx:Application> 
```

也就是说，只要有任何类型的宽度设置，相对大小（明确的数字、百分比、基于约束的锚点——例如，上、右、下、左等）应该会使文本自然换行. 这种方法不适用于您使用的布局吗？没有一些代码，很难说，但你是对的——包装确实需要在容器上设置一个与宽度相关的属性。

不过，调整大小和换行可能有点棘手，具体取决于上下文，所以如果您发现这不起作用，请尝试发布一些代码——我相信我们中的一个人将能够帮助您解决这个问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-11T17:57:24.420

如果您试图让文本换行在 MXML 组件中工作，请尝试以下操作：

```
<mx:Text id="testText"  
  width="{ this.width }"
  height="100%"   
  text="Your text here" /> 
```

您基本上将宽度设置为组件的宽度，并将高度设置为 100% 将允许它在缩小尺寸时正确包装。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T18:52:55.850

您可以尝试将事件处理程序添加到 的父节点`Event.RESIZE`，并调用 Text 对象的`validateNow()`方法。（也许之前有一个`invalidateSize()`电话。）为什么这不会自动发生，我不知道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-23T23:05:46.687

我认为应用 VBox width = "100%" 和 Text width = "100%" 是最简单的方法。注意：如果 Text 是动态生成的，别忘了做 text.percentWidth = 100

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-06T21:48:33.493

因此，Christian 的示例只是一个内部带有 Text 元素的应用程序，但是很容易搞砸布局。只需在其间添加一个 VBox 并且包装*不起作用*：

```
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="100%" height="100%">
<mx:VBox width="100%">
    <mx:Text width="100%" height="100%" text="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum." />    
</mx:VBox>
</mx:Application> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-04-27T20:28:25.890

尝试在您的文本字段中设置 htmlText="true"。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2011-03-11T10:19:07.300

我只能使用 mxml 来做到这一点。结果很丑陋，但我可以做到。

```
<s:Group id="propDisplay" width="100%">
    <mx:Text id="key" left="0" text="{data.key}:"/>
    <mx:Text left="{key.width}" maxWidth="{propDisplay.width - key.width}" 
                             text="{data.value}" />
</s:Group> 
```

* * *

## 回答 #9

> 赞同：-5
> 
> 时间：2010-01-07T05:52:01.617

```
render="invalidateSize();validateNow();
'component id'.mx_internal::getTextField().wordWrap=true" 
```

将此添加到您的文本组件中。

# c# - 添加或删除使用子表单检测的 MDI 表单

> ID：538204
> 
> 赞同：3
> 
> 时间：2009-02-11T18:45:32.247
> 
> 标签：c#, winforms, .net-3.5, mdi

是否有一个事件可以用来判断子窗体是否已从 MDI 父窗体中添加或删除？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-11T18:56:58.353

是的。在您的主 MDI 表单上，连接到 MdiChildActivated 事件。

像这样：

```
public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            this.MdiChildActivate += new EventHandler(Form1_MdiChildActivate);
        }

        void Form1_MdiChildActivate(object sender, EventArgs e)
        {
            MessageBox.Show("Activated");
        }

        private void addToolStripMenuItem_Click(object sender, EventArgs e)
        {
            Form form2 = new Form2();
            form2.MdiParent = this;
            form2.Show();
        }
    } 
```

当子窗体被激活或停用时，该事件将触发。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-20T15:57:51.990

将`MdiChildActivate`活动联系起来并保留一份已识别儿童的名单。激活新表单时，还要连接`FormClosed`事件。

```
private List<Form> ChildFormList = new List<Form>();

private void MyForm_MdiChildActivate(object sender, EventArgs e)
{
    Form f = this.ActiveMdiChild;

    if (f == null)
    {
        //the last child form was just closed
        return;
    }

    if (!ChildFormList.Contains(f))
    {
        //a new child form was created
        ChildFormList.Add(f);
        f.FormClosed += new FormClosedEventHandler(ChildFormClosed);
    }
    else
    {
        //activated existing form
    }
}

private void ChildFormClosed(object sender, FormClosedEventArgs e)
{
    //a child form was closed
    Form f = (Form)sender;
    ChildFormList.Remove(f);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T18:59:15.133

不，那里没有。您必须继承 Form 并公开特定事件，这些事件将指示何时添加子表单，然后通过连接子表单的方法路由子表单的所有附件，并引发事件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-16T03:28:21.073

我意识到这已经晚了很多年，但是因为这里的答案帮助我解决了这个问题，但我会提到使用 .net 4 中的 MdiChildren 数组可以正常工作。您唯一需要做的就是检查表单是否正在处理或处理告诉它是否关闭。

IE：

```
 private void frmContainer_MdiChildActivate(object sender, EventArgs e)
    {
        tabWindows.RefreshLayout(this.MdiChildren.ToList());
    }

    public void RefreshLayout(List<Form> forms)
    {
        this.nextButtonLeft = 1;
        panel1.Controls.Clear();
        foreach (Form frm in forms)
        {
            if (!(frm.Disposing || frm.IsDisposed)) { addButton(frm); }
        }
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-23T12:27:07.693

是的，您可以轻松检测添加到 MDI 表单中的表单。

当通过将 IsMdiContainer 设置为 true 将ParentForm 标记**为 MdiContainer时，将****引发 ParentForm.ControlAdded**事件以将“MdiClient”控件添加到父窗体。因此，当将 MdiClient 添加到父 MDI 表单时，**我们可以为 MdiClient 控件引发 ControlAdded 事件，**如下所示，

```
 public ParentForm()
  {
    InitializeComponent();
    this.ControlAdded += Form1_ControlAdded;
    this.IsMdiContainer = true; 
```

我们需要提高 MdiClient.ControlAdded 如下所示，

```
 void Form1_ControlAdded(object sender, ControlEventArgs e)
      {
           if(e.Control is MdiClient)
                e.Control.ControlAdded += MdiClient_ControlAdded;

      } 
```

默认情况下， MDI 子窗体被添加到父窗体**中的 MdiClient 的控件集合中。**因此，当将 ChildForm.MdiParent 值设置为 Parent 表单时，**MdiClient 的 ControlAdded 事件将引发**。

```
void MdiClient_ControlAdded(object sender, ControlEventArgs e)
{

} 
```

所以通过上面的方法，就可以**知道子MDI表单添加到父MDI表单**中了。像这样，您可以为 MdiClient 控件添加 ControlRemoved 事件，以了解从 MDI 表单中删除的子表单。

希望这会帮助你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-24T22:25:19.060

```
private void closeToolStripMenuItem1_Click(object sender, EventArgs e)
    {
      List<Form> fm = this.MdiChildren.ToList();
        if(fm!=null && fm.Count>0)
        {
            foreach(Form lfm in fm)
            {
                lfm.Close();
            }
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-31T08:47:33.663

由于 MdiChildActivate 事件是在 MDI 子窗体实际关闭之前触发的，因此没有足够的信息来检测 MDI 子窗体是实际激活还是关闭，因此我选择了一种不同的方法来解决问题。

我发现当 MDI 子窗体关闭时，ParentChanged 事件会触发它。

```
public class MdiParentForm : Form
{
    // ...

    private Form CreateMdiChildForm()
    {
        var form = new MdiChildForm
        form.ParentChanged += MdiFormParentChangedHandler;
        form.MdiParent = this;
        return form;
    }

    private void MdiFormParentChangedHandler(object sender, EventArgs args)
    {
        var form = sender as Form;
        if (form != null)
        {
            if (form.MdiParent != null)
            {
                // MDI child form will activate
                // ... your code here
            }
            else
            {
                // MDI child form will close
                form.ParentChanged -= MdiFormParentChangedHandler;
                // ... your code here
            }
        }
    }

    // ...
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2013-01-17T02:35:51.233

我最近想确定大约什么时候没有打开 MDIchildren，这样我就可以显示一个面板，上面有很多“要做的事情”按钮只有当没有打开子窗体时。（只是探索一个设计理念）。

我的最终解决方案非常简单——在父表单中添加一个计时器，并在 MdiChildActivate 事件确定有 1 个子表单打开时启动计时器。

```
 private void MyForm_MdiChildActivate(object sender, EventArgs e)
    {
        this.panel_Tools.Visible = false;
        if (this.MdiChildren.Count() == 1)
        {
            this.timer_WindowsCounter.Start();
        }
        else
        {
            this.timer_WindowsCounter.Stop();
        }

    }

    private void timer_WindowsCounter_Tick(object sender, EventArgs e)
    {
        if (this.MdiChildren.Count() == 0)
        {
            this.panel_Tools.Visible = true;
            this.timer_WindowsCounter.Stop();
        }
    } 
```

# regex - 如何使用 linq 找到相似的列名？

> ID：538208
> 
> 赞同：0
> 
> 时间：2009-02-11T18:46:08.690
> 
> 标签：regex, linq, datatable, matching

嗨，我正在尝试学习 Linq，所以我不确定这是否可以完成。

我正在做一个 [导入项目](https://stackoverflow.com/questions/489620/import-csv-file-excel-into-sql-database-asp-net) *，所以我决定使用 DataSets 导入数据。*

此时我面临的挑战：拥有 2 个具有不同架构的 DataTable，其中一个包含我的目标架构，另一个包含我的源架构。

**我需要做的是执行一些列匹配，我可以在其中识别与目标列*“有点相似”*的源列。我正在寻找一些东西，如果目标列名称的任何部分包含在源中，这是一个可能的匹配** ，我不知道有什么方法可以确定可能性。

例如源 [firstname, lastname, address] -> 目标 [fname, lname, addr1]

那么，LINQ 是这份工作的潜在候选人吗？还是正则表达式？我从这个开始

有一个源 DataTable dt

```
var Lcols = from c in dt.Columns.Cast<System.Data.DataColumn>()
select c.ColumnName; 
```

我不知道从这里去哪里......

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T18:49:46.700

LINQ*可能*是这里的候选者，但我认为您需要定义（如果您还没有这样做的话）是列如何相似。什么是分界点？一旦有了可以将一列映射到另一列的条件，就可以将这些条件应用于两组的笛卡尔积（源中的列是第一个集合，而第二个是目标的列）获取潜在匹配列表。

* * *

假设您有源列和目标列，如下所示：

```
IEnumerable<DataColumn> sourceColumns = 
  sourceDt.Columns.Cast<System.Data.DataColumn>();
IEnumerable<DataColumn> destColumns =
  destDt.Columns.Cast<System.Data.DataColumn>(); 
```

并将`IDictionary<string, string>`源中列的名称映射到目标中的列名称，您可以这样做：

```
var map =
  from s in sourceColumns
  from d in destColumns
where
  // colMap is the IDictionary<string, string>
  // The map has to contain the key.
  colMap.ContainsKey(s.ColumnName) &&

  // The destination column has to match the column map.
  // The OrdinalIgnoreCase option means to ignore case.
  string.Compare(colMap[s.ColumnName], 
      d.ColumnName, CompareOptions.OrdinalIgnoreCase) == 0
select
  new { SourceColumn = s, DestinationColumn = d }; 
```

这将为您提供基于字典中项目的可能映射。

# performance - 通过多线程优化文件复制

> ID：538209
> 
> 赞同：5
> 
> 时间：2009-02-11T18:46:39.140
> 
> 标签：performance, optimization, file, io

您可以通过多线程使文件复制更快吗？

**编辑**：为了澄清，假设您正在实施 CopyFile(src, tgt)。在某些情况下，您可以使用多个线程使其运行得更快，这似乎是合乎逻辑的。

**编辑**更多想法：

自然，这取决于所讨论的硬件/存储。

例如，如果您要从一个磁盘复制到另一个磁盘，很明显您可以使用两个线程同时读/写，从而节省了两个线程中最快的（通常是读取）的性能成本。但是您实际上并不需要多个线程来并行读取/写入，只需要异步 IO。

但是，如果 async-IO 在从不同磁盘读取/写入时真的可以加快速度（最高 2 倍），为什么这不是 CopyFile 的默认实现？（或者是吗？）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T18:49:01.803

如果你不小心，你可以让它变慢。磁盘擅长序列化访问，如果您有多个线程，磁盘头将无处不在。现在，如果您正在处理高性能 SAN，那么您的性能可能会有所提高，并且 SAN 将处理优化磁盘访问。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T19:32:13.087

这是一篇关于 Vista SP1 中文件复制性能改进的博客文章：

[http://blogs.technet.com/markrussinovich/archive/2008/02/04/2826167.aspx](http://blogs.technet.com/markrussinovich/archive/2008/02/04/2826167.aspx)

进行高性能文件复制很疯狂，您必须考虑缓存行为和网络驱动程序限制等因素。

所以总是使用 OS 文件复制功能（在 Windows 下是 FileCopyEx），不要自己写。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T18:50:01.597

我认为不会。CPU 能做的事情太少了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T19:00:42.773

如果文件位于不同的设备上，您会看到一个好处，在这种情况下，I/O 可以非常有效地重叠。

但是，在某些情况下，您很容易导致硬件抖动，因此我不认为这是一个应该掉以轻心的优化。

至于您添加的其他问题：

> 但是，如果 async-IO 在从不同磁盘读取/写入时真的可以加快速度（最高 2 倍），为什么这不是 CopyFile 的默认实现？（或者是吗？）

我不知道 的内部结构`CopyFile()`，但如果他们出于以下几个原因不这样做，我不会感到惊讶：

1.  如果他们要使用一个额外的线程（或多个线程）来实现它，这可能对进程的侵入性比适当的要大（特别是如果该进程是单线程的）
2.  如果他们尝试使用带有单个线程的异步 I/O 来实现它（正如[ChrisW 所指出](https://stackoverflow.com/questions/538209/file-copying-optimization-through-multiple-threads/538262#538262)的那样），他们可能会导致抖动问题和提高性能一样。一般地确定什么时候你会得到好处而不是坏处可能并不容易。

这并不是说它不能或不应该完成（或者甚至没有完成——我不知道）——这些只是可能无法完成的几个可能原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T18:51:48.130

这取决于，但通常不是，你的瓶颈将是磁盘 IO，你不能使用多线程使磁盘 IO 更快。

即使在极少数情况下，这也会起作用，但线程同步代码必须如此复杂以至于不值得。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T19:03:40.597

**如果您正在实现 CopyFile，那么您可以使用启动异步**I/O的单个线程（这样一个线程可以同时启动/重新启动读取和写入），而不是使用多个线程（例如，一个线程用于读取，另一个线程用于写入） ，使用完成端口或其他。

为了提高性能，它可能完全在内核中实现。

# vb.net - VB.NET 中的多个主题和母版页

> ID：538212
> 
> 赞同：2
> 
> 时间：2009-02-11T18:47:46.220
> 
> 标签：vb.net, master-pages, themes, blogengine.net

我今天在看 Blogengine.NET，他有一个有趣的主题设置，我想我想做类似的事情，但是......我根本无法让它工作。

对于每个主题，他都有一个文件夹，例如：

/主题/靛蓝/

/主题/标准/

/主题/手机/

每个主题都包含一个 site.master，它们都有自己的代码隐藏，如下所示：

```
public partial class site : System.Web.UI.MasterPage
{
  protected void Page_Load(object sender, EventArgs e)
  {
  }
} 
```

想知道他如何在 3 个不同的地方为每个主题设置一个 Page_Load，所有这些都是“站点”的部分类，但我在我的 VB.NET 应用程序中试了一下，就像我认为它不起作用一样

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) 
has multiple definitions with identical signatures 
```

我对此很陌生，但有没有办法让它工作，或者它只是在 C# 中工作的东西？

我想通过以下方式获得不同的母版页和用户控件：

```
MasterPageFile = "~/MasterPages/" & Theme & "/Site.master"

uc = LoadControl("~/UserControls/" & Theme & "/Box.ascx") 
```

还是有更好的方法来实现这一点？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T07:49:47.523

找到了解决方案，所以如果其他人正在寻找同样的东西，我会在这里发布。

多个相同的母版页适用于 .NET 网站，但不适用于 .NET Web 应用程序。也许其他人可以解释为什么，我只知道是这样。

所以这适用于 .NET 网站：

```
Me.MastePageFile = "~/themes/" & Theme & "/site.master" 
```

但它不适用于 .NET Web 应用程序，因为只有一个 site.master。

让我想知道是否有另一种好方法可以坚持使用 Web 应用程序，但仍然能够进行 WordPress 或 Blogengine.NET 等主要主题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T18:54:49.870

您可以在 Page_PreInit 期间为您的页面设置 MasterPage，如下所示：

Me.MasterPageFile = "~/themes/mytheme/theme.master"

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-24T08:48:43.790

我为模板文件添加了前缀以包含主题名称，您不能拥有多个相同主文件的原因是它将创建相同的类

我已经取得的一个例子如下

`ThemeName = "EA"`- 从 Web.config 提供

`Me.MasterPageFile = "~/Themes/" & ThemeName & "/" & ThemeName & "Site.Master"`

生成 ~/Themes/EA/EASite.Master

我还创建了一些我的所有网站都可能使用的通用 UserControls，如果我想用自定义用户控件覆盖它们，那么我使用与上面相同的命名约定检查我的自定义用户控件文件夹中是否存在该控件，并包含该控件，如果不使用自定义的。

我希望这可以帮助任何试图实现与我昨晚相同的目标的人。这只是初稿，可能会与我使用的生产版本有所不同，但我认为这将是一个好的开始

# installation - Windows 安装程序包的问题

> ID：538229
> 
> 赞同：11
> 
> 时间：2009-02-11T18:52:51.013
> 
> 标签：installation, wix, windows-installer, corruption

我有一个客户，我们的应用程序的 .msi 安装程序有问题。WiX 用于创建此安装程序。该应用程序在其他几十台机器上安装得很好，但在他的机器上它显示消息：

> 无法打开此安装包。请与应用程序供应商联系以验证这是否是有效的 Windows 安装程序包。

我的猜测是它是以下两种可能性之一：

1.  客户端计算机上的 Windows Installer 版本已过期。
2.  他拥有的 .msi 可能已损坏。

最可能的可能性是什么，或者还有其他我不知道的可能性？

我想我已经重现了用户的问题。如果我从命令 shell 运行**MyFile.msi**，然后它成功加载，那么我在日志文件中得到这个：

```
=== Verbose logging started: 2/12/2009  10:34:38  Build type: SHIP UNICODE 4.00.6001.00  Calling process: C:\Windows\System32\msiexec.exe ===
MSI (c) (F4:04) [10:34:38:795]: Resetting cached policy values
MSI (c) (F4:04) [10:34:38:795]: Machine policy value 'Debug' is 0
MSI (c) (F4:04) [10:34:38:795]: ******* RunEngine:
           ******* Product: C:\Users\kelley\Downloads\PixelActiveCityScape_v1_6_Demo.msi
           ******* Action:
           ******* CommandLine: **********
MSI (c) (F4:04) [10:34:38:802]: Machine policy value 'DisableUserInstalls' is 0
MSI (c) (F4:04) [10:34:38:830]: Note: 1: 1402 2: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer 3: 2
MSI (c) (F4:04) [10:34:39:140]: SOFTWARE RESTRICTION POLICY: Verifying package --> 'C:\Users\kelley\Downloads\PixelActiveCityScape_v1_6_Demo.msi' against software restriction policy
MSI (c) (F4:04) [10:34:39:141]: Note: 1: 2262 2: DigitalSignature 3: -2147287038
MSI (c) (F4:04) [10:34:39:141]: SOFTWARE RESTRICTION POLICY: C:\Users\kelley\Downloads\PixelActiveCityScape_v1_6_Demo.msi is not digitally signed
MSI (c) (F4:04) [10:34:39:142]: SOFTWARE RESTRICTION POLICY: C:\Users\kelley\Downloads\PixelActiveCityScape_v1_6_Demo.msi is permitted to run at the 'unrestricted' authorization level.
MSI (c) (F4:04) [10:34:39:189]: Cloaking enabled.
MSI (c) (F4:04) [10:34:39:190]: Attempting to enable all disabled privileges before calling Install on Server
MSI (c) (F4:04) [10:34:39:197]: End dialog not enabled
MSI (c) (F4:04) [10:34:39:197]: Original package ==> C:\Users\kelley\Downloads\PixelActiveCityScape_v1_6_Demo.msi
MSI (c) (F4:04) [10:34:39:197]: Package we're running from ==> C:\Users\kelley\AppData\Local\Temp\40a3581.msi
.
.
. 
```

但是，如果我运行**msiexec /i MyFile.msi /l*v MyLog.TXT**，我会得到：

```
 === Verbose logging started: 2/12/2009  10:32:19  Build type: SHIP UNICODE 4.00.6001.00  Calling process: C:\Windows\sy
stem32\msiexec.exe ===
MSI (c) (FC:F0) [10:32:19:597]: Resetting cached policy values
MSI (c) (FC:F0) [10:32:19:597]: Machine policy value 'Debug' is 0
MSI (c) (FC:F0) [10:32:19:597]: ******* RunEngine:
           ******* Product: .\PixelActiveCityScape_v1_6_Demo.msi
           ******* Action:
           ******* CommandLine: **********
MSI (c) (FC:F0) [10:32:19:599]: Note: 1: 2203 2: .\PixelActiveCityScape_v1_6_Demo.msi 3: -2147287038
MSI (c) (FC:F0) [10:32:19:600]: MainEngineThread is returning 2
=== Verbose logging stopped: 2/12/2009  10:32:19 === 
```

这显示了这个对话框：

> 无法打开此安装包。验证该包是否存在并且您可以访问它，或者联系应用程序供应商以验证这是一个有效的 Windows Installer 包。

所以这似乎是一个权限问题，但我不确定为什么以及如何解决它。我可能需要对 .msi 文件进行数字签名吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-11T18:57:48.320

**背景：**

当 MSI 安装程序文件未完全下载、被我的防病毒程序损坏或被我的 FTP 客户端损坏时，我注意到完全相同的消息。

错误消息实际上来自[msiexec.exe](http://technet.microsoft.com/en-us/library/cc759262.aspx)，它是 Windows Installer 系统的可执行程序，它实际解释 MSI 安装程序文件并将软件安装在目标客户端计算机上。

* * *

**检查 MSI 文件的完整性：**

使用类似 md5.exe 的方式计算 MSI 安装程序文件的已知良好副本的[MD5sum](http://www.fourmilab.ch/md5/)。让客户为他的副本做同样的事情，然后比较哈希值。如果结果不同，则客户端的 MSI 安装程序文件副本肯定已损坏。

* * *

**例如**：

最后：

```
C:\Documents and Settings\yourbox\Desktop>md5.exe AcroRead.msi
C587C739666E26B2A9B1F5BBAF358808 AcroRead.msi

```

在客户端：

```
C:\Documents and Settings\theclient\Desktop>md5.exe AcroRead.msi
90AFFBD9A1954EC9FF029B7AD7183A16 AcroRead.msi

```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-03-12T00:01:57.723

我也遇到了这个问题（“MainEngineThread 正在返回 2”）。该线程有助于缩小问题的范围，但我还没有完全解决它。

在我们的案例中，我们怀疑问题与 BitLocker 和/或使用相对路径（例如“msiexec /i ..\foo.msi”）调用 msiexec 有关。直接运行“..\foo.msi”，在正确的文件夹中运行“msiexec /i foo.msi”也可以。

也许这些线索会对其他人有所帮助。在我们的例子中，我们将更改目录结构以避免“..”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-11T20:36:27.907

如果 msiexec 检测到 MSI 文件已损坏，则会引发此错误消息。它可以做到这一点，因为所有 MSI 文件都有一个校验和，有些甚至是数字签名的。

不幸的是，MSI 文件的这种损坏经常发生。不仅仅是因为下载时网络连接不稳定，而且通常是因为病毒扫描程序会干扰下载本身——如果他们试图“清理”数据流，你最终会得到一个损坏的 MSI。

解决此问题的唯一方法是重新下载 MSI 文件，并可能禁用该下载的病毒扫描程序/防火墙。您可以在将 MSI 文件保存到磁盘后检查病毒，然后再尝试安装它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-11T19:13:12.743

您可以尝试在命令行中启动 MSI 并获取日志文件。

像这样： MSI: msiexec /i (Filename.MSI) /l*v (filename.TXT)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-05-17T09:17:56.570

当我使用它时它工作`absolute path ms file`

例子：

> `msiexec.exe /i .\a.msi`
> 
> `msiexec.exe /i c:\a.msi`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-17T18:41:35.040

[![在此处输入图像描述](https://i.stack.imgur.com/HraZC.jpg)](https://i.stack.imgur.com/HraZC.jpg)

解决方法：1）以管理员身份运行cmd，2）F:\SOFTWARES>msiexec /i node-v4.5.0-x64.msi

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-17T19:46:15.610

If anyone is developing a new installer and comes across this same error, check your Bootstrapper project output type. I added a new Bootstrapper project, and copied in a bunch of known-good code. The project output type defaults to MSI, and when attempting to test it I got an identical "MainEngineThread is returning 2" and the same preceding line.

Set the output type to its appropriate EXE and it's working great.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-09-25T12:46:18.423

我发现问题了！

我们的场景类似：

*   我们下载了 msi（我们尝试了几次：试用版、最新的 2019、beta 2019 和 beta 2020）
*   我们以交互方式启动了 MSI，一切顺利
*   当我们尝试使用安静模式（有据可查）时，结果总是一样的，它在几行后完成，没有有用的文档。

我们发现这是由于 MSIEXEC 访问 MSI 文件的方式，并且 ISSUE 与在下载文件上执行的新 Windows 阻止系统有关（该死！）

运行powershell命令“Unblock-File”就足够了，然后一切都开始正常工作了！

我希望这很有用，我会一直写信给 safe.com 团队，将此免责声明添加到他们的文档中。

# javascript - 我应该在哪里定义我的 Javascript 闭包？

> ID：538234
> 
> 赞同：0
> 
> 时间：2009-02-11T18:54:21.557
> 
> 标签：javascript, closures

我正在创建自己的 JavaScript 类数组对象，并且我有调用闭包的方法。我只是想知道定义闭包的最有效位置在哪里。

例如，假设我有一个 map 函数和一个 Chop 函数：

```
MyObject.prototype = 
{
  map: function(fn) { ... applies fn to each element ... };

  chop: function() 
  { this.map( 
    function(element) 
    {
      ... chop off last character ... 
    } 
  )};
} 
```

这样做是否更有效率？

```
MyObject.prototype = 
{
  map: function(fn) { ... applies fn to each element ... };

  __chop: function(element) 
  {
    ... chop off last character ... 
  }

  chop: function() 
  { this.map(this.__chop) };
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T19:04:11.017

第二种效率更高。这

```
 chop: function() 
  { map( 
    function(element) 
    {
      ... chop off last character ... 
    } 
  )} 
```

将在每次调用时创建一个新的函数对象，并`chop()`具有相应的运行时和内存开销。由于不会有对新对象的任何延迟引用，因此可以立即将其作为垃圾回收，但创建不必要的更多对象仍然是一种不好的做法。

我建议以下模式：

```
MyObject.prototype = (function() {

    function map(fn) { ... }

    function chopElement(element) { ... }

    function chop() {
        this.map(chopElement);
    }

    return {
        map : map,
        chop : chop
    };

})(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:01:33.037

在 JavaScript 中创建函数和查找函数都不是成本高昂的操作，因此如果您有一个包含相当数量元素的“数组”，则这两种方法之间的差异可以忽略不计。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:00:33.477

它们实际上是同一件事 - 选择更具可读性的那个。对于它的价值，我更喜欢第二个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-15T02:16:46.120

将函数闭包换成另一个函数闭包不会导致更高效的代码。最节省内存的方法是根本不使用闭包。

```
__proto__ = {
  map: function(){},
  _chop: function(str){
    return str.slice( str.length, -1 );
  },
  chop: function(arr){ 
    this.map(this._chop, arr);
  }
} 
```

这个问题在谷歌上的“关闭内存使用”率非常高，我认为它不合格。这是一个很难诊断的问题。

这里的答案更多是在闭包中隐藏功能的示例，但它增加了维护该内存空间以存储这些私有变量的成本。

# java - Eclipse Web 工具项目是否处理 JSP 内部的重构？

> ID：538239
> 
> 赞同：6
> 
> 时间：2009-02-11T18:55:33.970
> 
> 标签：java, eclipse, jsp, refactoring, eclipse-wtp

我已经为 Eclipse 版本 3.4 安装了 Web 工具项目。我一直在尝试按照我认为应该的方式进行重构，但没有成功。

我有一个 Java 项目，其中包含放入网站 /WEB-INF/lib 的 jar 的 Java 类。另一个项目（一个动态 Web 项目）具有相同站点的 JSP 文件。动态 Web 项目设置为 Java 项目作为构建路径中的必需项目。我还为 Dynamic Web 项目设置了 Project References 选项以引用 Java 项目。

如果我使用重构来更改其中一个 Java 类中的方法名称，我希望 JSP 中对该方法的引用会被重命名。但它不起作用。包含该类的 Java 项目中的引用以及使用该类的其他 Java 项目的引用已更改，但不会重构对 JSP 内方法的引用。

几天来我一直在摆弄它，尝试不同版本的 Eclipse 和 WTP。删除我所有的项目和文件并重新设置它们。没有任何区别。

这对其他人有用吗？我需要设置什么特别的东西才能让它工作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:04:42.807

我对 WTP（或任何 Eclipse 风格）如何处理 JSP 文件中的 scriptlet 块中的 Java 代码的经验一直很糟糕：它永远不会像您期望的那样工作得很好。我已经看到 Eclipse`<jsp:import>`在 JSP 文件的中间添加语句，并执行所有其他类型的奇怪格式化。

我唯一的建议是不要在 Eclipse 中编辑 JSP 中的代码。

（我的另一条建议是**不要**将 Java 代码直接放在 JSP 文件中，而是转向 MVC 架构，但这是另一天的主题......）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T20:48:14.517

抱歉，这不是直接回答您的问题，而是解决您的问题……也许有帮助，否则请忽略：

正如 matt b 建议的那样，您不应该将 java 代码放在 jsp 中。而是“简单地”使用标签。如果您使用的是[标准标签库](https://tomcat.apache.org/taglibs/standard/)，那么您需要的几乎所有东西都在那里。对于您必须自己处理的事情，一旦您知道标签是关于什么的，编写自己的标签就非常简单。

通过这个技巧，您将获得更好的应用程序（视图）架构、测试机会（希望您喜欢它们）、遵守 DRY（不要重复自己）原则并将所有 Java 代码放在 .java 文件中，以便它们轻松被*任何*工具拾取。

web.xml 甚至还有一个选项可以强制禁用脚本，让标签保持工作，但如果您已经在脚本化 jsps 上投入了大量资金，那么这可能不是您所需要的......

```
<jsp-config>
  <jsp-property-group>
    <url-pattern>*.jsp</url-pattern>
    <scripting-invalid>true</scripting-invalid>
  </jsp-property-group>
</jsp-config> 
```

另一个您没有问的问题的答案是 IntelliJ Idea 可以很好地处理您谈论的场景（尽管我自己每天都在使用 eclipse，这是两个 IDE 之间的区别之一）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T15:46:18.337

请在[此处](https://bugs.eclipse.org/bugs/buglist.cgi?quicksearch=jsp+refactor)投票支持此操作。或者创建一个新的更具体的功能请求。在该链接中，您可以看到有关重构和 JSP 的许多问题，但只有少数人知道，如果他们投票支持它们，它们更有可能在下一个 Eclipse 版本中实现。

请在使用之前复制并修复链接，因为它已损坏。“+”变成“%2B”。这是正确的链接：[https ://bugs.eclipse.org/bugs/buglist.cgi?quicksearch=jsp+refactor](https://bugs.eclipse.org/bugs/buglist.cgi?quicksearch=jsp+refactor)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:20:19.043

也许我没有正确理解您，但听起来您在尝试重构之前将类放入 Jar 或 War 中。重构是针对当前项目的，而不是针对构建路径中的任何内容。

如果我误解了你的问题，我很抱歉。

# java - Java GUI 问题

> ID：538240
> 
> 赞同：2
> 
> 时间：2009-02-11T18:56:41.393
> 
> 标签：java, swing

我正在设计一个非常简单的 GUI，但没有任何运气。基本上，外部布局有两列，这是一个拆分窗格（这是针对我正在编写的 IRC 客户端）。左侧是服务器/频道/用户树，右侧是聊天窗格。现在我将其分解，因此在右侧，顶部是输出窗格，底部是单行输入框。

这是用于创建整体 GUI 的代码（这只是一个片段）

```
ChatModel cm = new ChatModel();
ChatView cv = new ChatView(cm);

treeViewChatSplitPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, serverTreeView, cv);
treeViewChatSplitPane.setSize(500, 500);
treeViewChatSplitPane.setBorder(null);
treeViewChatSplitPane.setDividerSize(3);
this.getContentPane().add(treeViewChatSplitPane);

this.setSize(500, 500); 
```

ChatView 构造函数中有这个（它扩展了 java.awt.Container）

```
this.model = model;
this.setLayout(new BorderLayout());

mainTextArea = new JTextArea();
mainTextArea.setLineWrap(true);
mainTextArea.setBackground(new Color(255, 255, 255));

inputField = new JTextField();

this.add(mainTextArea, BorderLayout.CENTER);
this.add(inputField, BorderLayout.PAGE_END); 
```

现在它最初看起来不错，但我遇到的问题是您可以将分离器移动到左侧，但不能移动到右侧。事实上，如果你把它向左移动，你就不能再向右移动它了。我之前确实有它工作过，但实施并不那么好，我已经忘记了我做了什么。

有任何想法吗？我不明白为什么这行不通。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:06:50.013

如果我没记错的话，请`JSplitPanes`始终尊重其组件的最小尺寸。`ChatView`尝试明确设置to的最小大小，`(0,0)`看看是否有帮助。如果是这样，您可以查看其中的每个组件，以查看导致问题的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T19:07:18.827

您在任何地方都设置了 ChatView 的最小尺寸吗？如果是这样，这个最小值不等于帧大小（ 500 x 500 ）吗？

提供的信息很难解决，但以下建议对我（以及使用它的人）一直有效

*   创建可能工作的最简单的框架，并添加一个带有两个按钮的 SplitPane。
*   在那里调整大小。
*   在一切顺利的情况下，处理更换您的组件之一。
*   然后是另一个。
*   检测是哪一个导致了奇怪的行为。
*   在那一个上，开始做同样的事情，用你能想到的最小组件替换它（例如用 JPanel 替换它）

顺便说一句，用 javax.swing.JComponent 替换 java.awt.Container 可能会更好

我们的想法是从最简单的事情开始，并从那里开始发展。大多数时候，问题出在我们设置的一些愚蠢的属性上，并通过清理它出现的所有内容。

它应该需要不到 1 小时。为了这。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T08:25:34.787

如果两个组件都有合理的首选和最小尺寸，并且您仍然看到奇怪的行为，您可能需要调用`setResizeWeight()`.`JSplitPane`

请注意，顺便说一句，以编程方式设置分隔符位置 ( `setDividerLocation()`) 几乎永远不会起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:14:11.353

我不确定究竟是什么导致了您的问题，但是从模糊的记忆中我可以告诉您，如果您没有为每个窗格设置首选尺寸和最小尺寸，JSplitPane 就会变得疯狂。

我建议这样做只是为了看看它是否效果更好。

[以下是关于分隔线的 Java 教程中的一些内容。](http://java.sun.com/docs/books/tutorial/uiswing/components/splitpane.html#divider)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:20:46.627

它可能与正确组件的 minimunSize 有关。在以下示例中，您只需将分隔符移到左侧即可。

```
public static void main(String[] args) {
    JLabel barLabel = new JLabel("bar");
    JLabel fooLabel = new JLabel("foo");
    barLabel.setMinimumSize(new Dimension(150,150));
    fooLabel.setPreferredSize(new Dimension(50,50));

    JSplitPane treeViewChatSplitPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, fooLabel, barLabel);
    treeViewChatSplitPane.setSize(500, 500);
    treeViewChatSplitPane.setBorder(null);
    treeViewChatSplitPane.setDividerSize(3);

    JFrame frame = new JFrame();
    frame.add(treeViewChatSplitPane, BorderLayout.CENTER);

    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setSize(200,200);
    frame.setVisible(true);

} 
```

# html - 如何让多个单独的 HTML 表格都与最宽表格的宽度相同

> ID：538244
> 
> 赞同：12
> 
> 时间：2009-02-11T18:58:12.170
> 
> 标签：html, css, user-interface, html-table

**问题：**我有 HTML 标记来处理由嵌套在另一个表中的多个表组成。我希望“内表”都具有相同的宽度。我还希望所有“内桌”的宽度不超过自然状态下最宽的“内桌”的宽度。

我*不想*简单地将所有表格的宽度设置为某个固定百分比，因为在实际生成 HTML 页面之前，我事先不知道最宽的“内表”的宽度应该是多少。

![这是一个视觉示例](https://upload.wikimedia.org/wikipedia/en/0/00/Erasene-screen001.png)

^([来源：[https ://en.wikipedia.org/wiki/File:Erasene-screen001.png](https://en.wikipedia.org/wiki/File:Erasene-screen001.png)])

我希望所有表的宽度都与内表零相同。目前，没有一个表格有指定的宽度，这就是我喜欢的方式，因为我希望所有内部表格自然选择默认情况下最宽的表格的宽度。

**问题：**是否有任何人知道的任何 CSS、JQuery 或 Javascript 技巧可以获得这种所需的样式？

**更新：**我即将删除这个问题，因为人们似乎想对我投反对票，因为我没有充分的理由不想要 100%。我**确实**有充分的理由......直到运行时我也不知道*哪个*表将是“最外层”表（这是一个递归生成的可能无限深度的结构）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T19:20:26.423

我不知道任何 HTML/CSS 技巧来完成它，但既然你对 jQuery 持开放态度......

假设你所有的内部表都有一个“内部”类，你可以这样做：

```
$(document).ready(function() {
    var largest = 0;
    $('table.inner').each(function() {
        var width = $(this)[0].offsetWidth;
        if(width > largest) {
            largest = width;
        }
    }).width(largest);
}); 
```

编辑：更新了我的答案以使用`offsetWidth`而不是 jQuery's `width()`，因为后者不包括边框、填充或边距。在 IE7、FF、Safari、Opera 上进行了测试，效果很理想。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T19:01:47.093

为什么不能只将内表设置为 100% 宽度并让它受到外表的限制？如果不是您的外部表将限制内部表，那么您的示例在指定它方面做得不是很好。

您正在寻找的 CSS“技巧”是：

```
table.inner { width: 100%; } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T19:05:17.270

您可以使用 JavaScript 根据最宽的一个来更新每个表格的宽度。但我有一种感觉，你正在寻找一个无脚本的解决方案......（对吗？）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T19:25:17.583

将内部表编码为宽度=100%，然后它们都将与外部表一样宽。如果您希望内部表格的所有列具有相同的宽度，那么您必须在其列标题（或第一行）上指定这些宽度。

```
<HTML>
<HEAD>

<TITLE>Mike Test</TITLE>
</HEAD>
<BODY>

<table border=1>
  <tr><td>
    <table border=1>
      <tr>
      <td>First</td>
      <td>Second</td>
      </tr>
    </table>
  </td></tr>
  <tr><td>
    <table border=1>
      <tr>
      <td>1</td>
      <td>2</td>
      </tr>
    </table>
  </td></tr>
</table>

<table border=1>
  <tr><td>
    <table border=1 width="100%">
      <tr>
      <td>First</td>
      <td>Second</td>
      </tr>
    </table>
  </td></tr>
  <tr><td>
    <table border=1 width="100%">
      <tr>
      <td>1</td>
      <td>2</td>
      </tr>
    </table>
  </td></tr>
</table>

</BODY>
</HTML> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:04:01.127

我不明白你怎么能绕过宽度：100%。这实质上就是您要尝试做的：将每个表的宽度设置为包含元素的总宽度，其宽度由该列中最宽的嵌入表确定。

编辑添加：

如果您真的想不惜一切代价避免它，您始终可以使用原型来获取元素的实际宽度（以像素为单位），然后将最大宽度重新应用于所有其他元素。使用原型和行为可能很容易完成。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-11T19:46:01.837

> 直到运行时我也不知道哪个表将是“最外层”表（这是一个递归生成的可能无限深度的结构）。

你需要知道吗？

**将所有内容包裹在 div 或 table 周围**，给它一个固定或百分比宽度以使其正确进入您的网页设计，然后所有容器表应设置为 100%

```
.content-wrapper { width: 450px; }
table { width: 100%; }

<div id="content-wrapper">
    <!-- all your tables/content/divs/etc -->
</div> 
```

这就是每个人都在做的事情，这就是为什么在代码的所有设计元素中你都有称为 Wrappers 的 DIV，以达到你的目的。

请不要试图重新发明轮子......每个人都这样做，你不是第一个。

# javascript - Javascript保留字？

> ID：538249
> 
> 赞同：5
> 
> 时间：2009-02-11T19:00:12.260
> 
> 标签：javascript

我有一些生成以下对象的 JS 代码，

```
return {
    "type": "some thing",
    "width": 2,
    "colour": "#AA12BB",
    "values": [2,3,4]
} 
```

创建这个不是问题。

在编写返回此方法的测试时，访问宽度/类型属性时遇到问题：以下断言失败（它导致执行/语法错误，当我评论它们时消失）。

```
assertEquals('some thing', jsonObj.type);
assertEquals(2, jsonObj.width); 
```

尽管

```
assertEquals('#AA12BB', jsonObj.colour); 
```

通行证

由于我无法更改我正在做的事情的键名，有没有办法访问这些值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:01:48.137

试试这个：

```
assertEquals('some thing', jsonObj["type"]);
assertEquals(2, jsonObj["width"]); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T22:51:58.113

你的例子对我来说很好。'width' 和 'type'*不是*JavaScript 中的保留字（尽管 'typeof' 是）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:52:54.847

点表示法不适用于保留字，例如“type”。在这种情况下，您必须使用数组表示法。

Mozilla 的[Java Script 保留字](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Reserved_Words)列表。

# c# - 如何判断属性是否需要调用？

> ID：538251
> 
> 赞同：1
> 
> 时间：2009-02-11T19:00:31.853
> 
> 标签：c#, multithreading, invoke

如果我从非 UI 线程设置 Form 的 Text 属性，则需要使用 Invoke 来避免跨线程错误。但是，我可以在不使用 Invoke 的情况下读取 Text 属性。这安全吗？如果我尝试读取 Form 的 Handle 属性，则会出现跨线程错误。如果我阅读 Form 的 IsDisposed 属性，它可以正常工作。如何判断何时需要使用 Invoke？我是否应该**一直**使用 Invoke 来读取和写入属性值？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:07:32.163

每当您处于 UI 线程之外的线程中时，您应该[`Invoke`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invoke.aspx)在访问 UI 对象时使用。使用[`InvokeRequired`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invokerequired.aspx)属性来确定您是否实际上在不同的线程中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T19:08:51.957

最简单的方法是使用：

```
Delegate Sub SetTextCallback(ByVal [text] As String)

Private Sub SetText(ByVal [text] As String)
' InvokeRequired required compares the thread ID of the
' calling thread to the thread ID of the creating thread.
' If these threads are different, it returns true.
If Me.lboxResults.InvokeRequired Then
    Dim d As New SetTextCallback(AddressOf SetText)
    Me.Invoke(d, New Object() {[text]})
Else
    Me.lboxResults.Items.Add([text])
End If 
```

结束子

对不起VB代码...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:59:52.693

另一种选择是使用 SynchronizationContext。这不仅适用于 WinForms，也适用于 WPF 和 ASP.NET，并且它从 .NET 2.0 开始可用。

在主线程（例如在构造函数中）调用 SynchronizationContext.Current，并在需要同步调用时使用返回的对象。如果对象为空，则不需要同步。

# php - 根据表以不同方式显示 mysql join/union 结果

> ID：538258
> 
> 赞同：0
> 
> 时间：2009-02-11T19:01:50.837
> 
> 标签：php, mysql, join, union

我需要按照输入到表中的日期顺序从多个表中生成活动列表，但是当我将它们吐出（使用 php）时，我希望每个结果看起来都特定于我为每个表所拥有的设计.

即..我有桌子：`listings`，，，`photos``comments`

*   列表的结果应该以某种方式设计，照片的结果应该以不同的方式设计，评论的结果应该以第三种方式设计。
*   我想将所有三个表的结果网格化到一个按日期排序的列表中。

我可以通过 MySQL 连接提取结果，但我不知道如何根据表更改结果。

这有意义吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:06:59.467

过程是这样的：

*   查询数据库，返回按日期排序的结果
*   迭代结果创建表，基于日期/变量，您将为您正在创建的当前行分配一个 CSS 类。（使用 if/switch/function 等来确定应该分配什么类）
*   迭代完成后，完成表格/等并显示。

# java - 如何让 Java “热代码替换”在 JBoss 中工作？

> ID：538261
> 
> 赞同：6
> 
> 时间：2009-02-11T19:03:02.253
> 
> 标签：java, debugging, jboss

我正在运行 JBoss 4.0.3.SP1_CP04 并使用 Eclipse 3.4.1 的调试器连接到它，两者都使用 JDK 1.6.0_11。

当我对一个方法进行微小的更改（例如将逻辑中的“+ 1”更改为“+ 2”）并保存它时，我立即收到一个标题为“热代码替换失败”的错误消息对话框，错误为“删除方法未实现”

[热代码替换失败对话框 http://img6.imageshack.us/img6/531/hotcodereplacefailedkp6.png](http://img6.imageshack.us/img6/531/hotcodereplacefailedkp6.png)

任何人都可以建议让这个工作的步骤吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:50:48.597

您想要做的是将 JBOSS 作为[爆炸 WAR](http://www.jboss.org/community/docs/DOC-9719)部署到 JBOSS 。通常，如果编辑器自己进行初始部署，它将在单个文件更改时管理复制它们。

在 IntelliJ 中，[这很容易](http://www.jetbrains.com/idea/training/demos/JBoss_server.html)。我从来没有在 Eclipse 上做过，但是[这个项目](http://www.jboss.org/tools/)是你最好的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T23:44:56.427

我一直在使用[JRebel](http://zeroturnaround.com/jrebel/)，就修改代码和动态更新应用服务器而言，它是一个救命稻草。第一天自己付钱。（我们有一个 7 分钟的编译/部署/重启周期）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-15T16:08:18.853

1.  在 Eclipse 中运行调试器之前，确保您的工作区中的所有项目都已刷新（如果代码在 Eclipse 之外更改，则需要这样做，例如在使用外部工具从版本控制系统获取更改之后）
2.  在 Eclipse 的 Java 构建路径中，确保您不包含作为您尝试热交换的某些库类的一部分
3.  检查 Eclipse JRE = JBoss JRE
4.  检查您尝试热交换的类。它有内部类吗？当我无法将类与内部类交换时，我遇到了问题，而其他类交换时没有问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-18T13:26:19.053

原因是程序集可以使用另一个编译器即热插拔。例如，如果您通过 maven 构建项目，我们使用 javac。当您尝试执行热插拔时，etslipse 使用内置编译器 jdt 编译器（编译器不是从已安装的 jdk 中获取的，并且不能通过常规方式更改。）。得到的二进制类不同，jvm无法替代。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:49:27.110

What you described should work. What are your jvm args to jboss to enable debugging?

Mine are these: -Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-19T10:48:31.630

我遇到了一个问题，即热代码替换本身不起作用。我们做了一些更改，例如确保选中“自动构建”并取消选中 -“发生构建路径错误时中止构建”。但就我而言，HCR 本身不起作用。我没有收到你提到的消息。更多详细信息在此链接中。 [https://sites.google.com/site/javaerrorsandsolutions/home/hot-code-replacement](https://sites.google.com/site/javaerrorsandsolutions/home/hot-code-replacement)

# postscript - 将文本（实际上是条形码）添加到 Postscript 文件

> ID：538270
> 
> 赞同：2
> 
> 时间：2009-02-11T19:05:21.763
> 
> 标签：postscript

我希望能够将条形码添加到生成的 postscript 文件中。postscript 文件是由另一个程序生成的，我无法更改该程序的工作方式。

我发现几个线程表明这可以通过将 Postscript 文件转换为 PDF 来完成（[胶合（拼版）PDF 文档](https://stackoverflow.com/questions/465271/gluing-imposition-pdf-documents)；[从一个 .ps 文件创建两个 pdf？；将](https://stackoverflow.com/questions/310441/create-two-pdfs-from-one-ps-file)一个[pdf 或 ps 文件叠加在另一个之上](https://stackoverflow.com/questions/501723/overlay-one-pdf-or-ps-file-on-top-of-another)）。

我想知道是否有一种方法可以在没有 PDF 转换的情况下做到这一点（保持简单，保持快速，并避免质量损失）。如果事实证明 PDF 转换是唯一合理的解决方案，那么从 Postscript 到 PDF 是否有质量损失？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:37:37.350

如果生成的 Postscript 足够好，你可以写一些东西来挖掘它，找到 showpage 命令，然后在它之前插入一些额外的绘图命令。毕竟，你不需要处理一般情况，只需从这个程序输出，它应该总是以同样的方式吐出 Postscript。

更一般地，您可以通过编程将 PS 转换为 EPS，然后将其嵌入到另一个将绘制它的 Postscript 文件中，然后是条形码。（既然我提到了这个，它实际上可能更容易。）

[Postscript 语言参考手册](http://www.google.com/search?q=postscript+language+reference+manual)对于这两项任务都会派上用场。

# math - 使用 fov 和中心平移和倾斜值来计算边界的平移和倾斜？

> ID：538277
> 
> 赞同：0
> 
> 时间：2009-02-11T19:07:33.473
> 
> 标签：math, graphics, 3d

我有当前的 fov 和中心平移和倾斜值。我将如何使用此信息计算边缘的平移和倾斜值（即最小平移值和最大倾斜）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T20:26:45.030

最小（即视口底部）倾斜只是当前中心倾斜减去 FOV 的一半，可能以 90 度为界。最大值可以类似地定位。请注意，如果视口包含投影球体的一个极点，则倾斜值可能会超过 90 度，并且您必须确定您是否对视口延伸到另一半球的距离感兴趣，或者您是否只对最大渲染感兴趣倾斜（对于跨越杆的任何视口，+/-90 度）。

最小和最大平移定义不明确，因为直线视口的边缘不会平行于投影球体上的经线，因此视口北端的平移范围将大于南端（在正倾斜的情况）。

# vb.net - 在 .NET 中关闭数据库连接

> ID：538281
> 
> 赞同：-1
> 
> 时间：2009-02-11T19:08:36.217
> 
> 标签：vb.net

由于 ExecuteProc 过程失败，我需要修改以下代码（另一位开发人员编写的）。（它失败的原因不在这个问题的范围内。这是一个很长的故事）但在范围内，我不确定为什么`NullReferenceException`会发生 a 。它在 VB.NET 中（我自己不是 VB.NET 人，所以我不确定这是否是 VB.NET 独有的）：

```
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.SqlTypes
Imports System.Collections
'(...)
Public Overloads Function ExecuteProc( ByVal pvsProcName as String) As DataSet
Dim oCommand As SqlCommand
Dim oDataAdaptor As SqlDataAdapter = New SqlDataAdapter
'Other Stuff here

  Try
    oCommand = CommandGet(ConnectionGet)
    'Do some more stuff that's irrelevant
   Catch oException As Exception
    Throw oException
   Finally
    ConnectionClose(oCommand.Connection)
    oCommand.Dispose()
    oDataAdaptor.Dispose()
  End Try
End Function 
```

我收到以下警告：

```
Variable 'oCommand' is used before it has been assigned a value. A null reference exception could result at runtime.` 
```

**编辑**：我在发布问题之前就找到了答案。我张贴它是为了保留它（我讨厌花十分钟的时间来随意倾倒它）。

我对 VB.NET 人员的下一个问题是：

以下两个初始化有什么区别：

```
Dim oCommand As SqlCommand = Nothing 
```

和：

```
Dim oCommand as New SqlComand 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-11T19:11:00.643

好吧，最明显的是，如果`CommandGet`失败并抛出异常，`oCommand`将不会被设置 - 它仍然是 null，所以`oCommand.Connection`在 finally 块中会抛出一个`NullReferenceException`.

另外，我想说：

*   不需要`Catch`块
*   两个`Using`块（一个用于命令，一个用于适配器）比显式`Try`/`Finally`块更好 IMO

编辑：两种解决方案之间的区别很简单 - 一个创建一个“虚拟”命令，然后您忽略*或*处置（但不是两者）。另一个显式设置一个空引用，您可以检查它。

我会使用第三种解决方案 - 使用块：

```
Using oCommand As CommandGet(ConnectionGet)
  ' All the normal stuff in here '
End Using 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T19:14:16.750

这只是意味着 VB.NET 编译器无法判断变量在使用之前是否已初始化，因为您的异常方式或块的结构。

您可以通过显式初始化变量来避免警告：

```
Dim oCommand As SqlCommand = Nothing 
```

# xml - 使用 Xpath 找到共同的父级

> ID：538293
> 
> 赞同：5
> 
> 时间：2009-02-11T19:10:42.670
> 
> 标签：xml, xslt, xpath

我想知道是否有任何方法可以使用 Xpath 访问公共父节点。

```
<outer>
<main>
           <a><b> sometext </b></a>
           <c><d> sometext2 </d></c>
</main>
</outer> 
```

我有文本节点 sometext 和 sometext2。有没有办法可以访问这两个节点的主（共同父）？我不知道包含这些节点的 xml 的布局。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-12T03:58:00.280

**使用以下 XPath 1.0 表达式**：

```
$v1/ancestor::*
   [count(. | $v2/ancestor::*) 
   = 
    count($v2/ancestor::*)
   ]
    [1] 
```

**其中 $v1 和 $v2 保存两个文本节点**（如果您在 XSLT 之外使用 XPath，则必须将上述表达式中的 $v1 和 $v2 替换为选择这两个文本节点中的每一个的 XPath 表达式）。

**说明**：

**上面的 XPath 1.0 表达式找到两个节点集的交集**：$v1 的所有元素祖先的节点集和 $v2 的所有元素祖先的节点集。**这是通过所谓的 Kaysian 交叉方法完成的**（在 Michael Kay 之后，他在 2000 年发现了这一点）。使用 Kaysian 方法进行交集，**两个节点集 $ns1 和 $ns2 的交集由以下 XPath 表达式选择**：

```
 $ns1[count(. | $ns2) = count($ns2)] 
```

**然后，我们必须从祖先的交点中选择最后一个元素**。但是，**由于我们使用的是反向轴（祖先），因此所需的节点位置必须表示为 1**。

**通过应用以下转换，可以快速验证上述 XPath 表达式是否确实选择了最低的共同祖先**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:output method="text"/>

  <xsl:variable name="v1" select="/*/*/a/b/text()"/>
  <xsl:variable name="v2" select="/*/*/c/d/text()"/>

  <xsl:variable name="vCommonAncestor" select=
   "$v1/ancestor::*
       [count(. | $v2/ancestor::*) 
       = 
        count($v2/ancestor::*)
       ]
        [1]"
   />

    <xsl:template match="/">
      <xsl:value-of select="name($vCommonAncestor)"/>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于最初提供的 XML 文档**（更正为格式良好的 XML）时：

```
<outer>
    <main>
        <a>
            <b>sometext</b>
        </a>
        <c>
            <d>sometext2</d>
        </c>
    </main>
</outer> 
```

****产生****了想要的结果**（作为两个文本节点的最低共同祖先的元素的名称）：**

 ****主要的**

**选择两个节点的最低共同祖先的 XPath 2.0 表达式更简单**，因为它使用标准 XPath 2.0 运算符“intersect”：

```
 ($v1/ancestor::* intersect $v2/ancestor::*) 
                                         [last()] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-04-23T08:22:36.093

这似乎很复杂。试试看嘛：

```
xquery version "3.0";

let $test :=
    <outer>
    <main>
               <a><b> sometext </b></a>
               <c><d> sometext2 </d></c>
    </main>
    </outer>

return ($test//*[.//b][.//d])[last()] 
```

得到最近的共同祖先

# dotnetnuke - 如何将 ASP:Membership 表转移到 DotNetNuke？

> ID：538297
> 
> 赞同：2
> 
> 时间：2009-02-11T19:11:59.283
> 
> 标签：dotnetnuke

有谁知道如何在不丢失任何用户的情况下将 asp.net 成员表（角色、配置文件、用户、成员资格等）转移到 dotnetnuke。

谢谢， XaiSoft

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T16:54:32.987

您可以将帐户从其他系统移至 DotNetNuke，但您必须做一些事情。

1.  您必须更新 DotNetNuke web.config 以具有与实际创建用户的应用程序相同的验证和解密密钥。

2.  您必须更新 DNN web.config 中的成员资格提供程序，使其具有与外部系统相同的应用程序名称

3.  最后，您必须将条目和信息插入到用户、用户门户和用户角色表中，才能真正“授予对 DotNetNuke 的访问权限”。

# c++ - 在 C++ 中检查字符串以什么数字结尾

> ID：538300
> 
> 赞同：0
> 
> 时间：2009-02-11T19:13:26.487
> 
> 标签：c++, string, numbers, integer

在 C++ MD2 文件加载器中，我有很多帧，每个帧的名称都以数字结尾，例如

*   立场0
*   展台1
*   展台2
*   展位3
*   展位4
*   ...
*   站台10
*   站台11
*   运行0
*   运行1
*   运行2

等等

如果没有后面的数字，我如何得到字符串是什么？例如，将“stand10”更改为“stand”的功能

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:20:50.447

只是为了展示另一种方式，反向迭代器：

```
string::reverse_iterator rit = str.rbegin();
while(isdigit(*rit)) ++rit;
std::string new_str(str.begin(), rit.base()); 
```

如果你有 boost::bind，你可以让你的生活更轻松

```
std::string new_str(str.begin(),
    std::find_if(str.rbegin(), str.rend(),
                 !boost::bind(::isdigit, _1)).base()); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T19:21:50.413

**string::find_last_not_of** ("0123456789") 然后 是**string::substr()**

这给了你最后一个非数字/数字的位置。只需取所有前面的字符，这就是基本名称。

递增 1 以在字符串末尾获取数字序列的开始。

注意：没有错误检查或其他测试。

```
#include <string>

using namespace std;
int _tmain(int argc, _TCHAR* argv[])
{
   string test = "hellothere4";

   size_t last_char_pos = test.find_last_not_of("0123456789");
   string base = test.substr(0, last_char_pos + 1); 
```

编辑

当您的“基本名称”末尾有一个数字时，所有解决方案都有问题。

例如，如果基本字符串是“base1”，那么您永远无法获得正确的基本名称。我假设你已经意识到了这一点。

还是我错过了什么？只要基本名称在后缀数字之前的末尾不能有数字，它就可以正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T19:23:09.880

C风格的做法：

从左侧开始逐个字符地遍历您的字符串。当你读到一个数字时，停下来，把它标记为你的字符串的结尾。

```
char *curChar = myString;   // Temporary for quicker iteration.

while(*curChar != '\0') {   // Loop through all characters in the string.
    if(isdigit(*curChar)) { // Is the current character a digit?
        *curChar = '\0';    // End the string.
        break;              // No need to loop any more.
    }

    ++curChar;              // Move onto the next character.
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T19:45:09.327

只是为了完成它，一个带有 find_first_of 的：

```
string new_string = str.substr(0, str.find_first_of("0123456789")); 
```

只有一行:)

另外，对于这些事情，我喜欢使用正则表达式（虽然这种情况很简单）：

```
string new_string = boost::regex_replace(str, boost::regex("[0-9]+$"), ""); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:18:49.970

又快又脏又不太优雅：

```
for (int i = str.GetLength()-1; i >= 0; i--)
    {
    if (!isdigit(str.GetAt(i)) break;

    str.SetAt(i,'\0');
    } 
```

# c# - 从 jQuery 传递到 ASP.NET 代码时，Request.Files 集合为空

> ID：538302
> 
> 赞同：1
> 
> 时间：2009-02-11T19:13:33.460
> 
> 标签：c#, jquery, asp.net-mvc

我正在运行 ASP.NET MVC Beta。我有一个通过 jQuery 运行的 AJAX 调用，它获取我的表单值并将它们发布到控制器操作。如果我在没有 AJAX 的情况下在正常形式的发布场景中运行此调用，那么一切都会正确完成。但是，一旦我合并了 jQuery 代码，除了文件之外的所有表单值都会通过。Request.Files() 什么也不返回。我在这里还缺少一块吗？

HTML 代码：

```
<form action="/Images/AddImages/" enctype="multipart/form-data" id="frmAddImages" method="post">
    <%=Html.Hidden("hfPromoId",ViewData.Model.Promotion.PromoId) %>
    <table>
        <tr>
            <td>Images for Promo: </td>
            <td><span class="promoTitle"><%=Html.Encode(ViewData.Model.Promotion.PromoName) %></span></td>
        </tr>
        <tr class="newImageContainer">
            <td>Select Image:</td>
            <td>
                <input type="file" id="txtImagePath" name="txtImagePath" />
            </td>
        </tr>
        <tr class="newImageContainer">
            <td>Image Caption:</td>
            <td>
                <input id="txtImageCaption" name="txtImageCaption" />
            </td>
        </tr>
        <tr>
            <td><input type="submit" value="Save Image" id="AddImages" /></td>     
        </tr>
    </table> 
</form> 
```

控制器代码：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult AddImages(bool? partial)
{
    int promoId = Convert.ToInt32(Request.Form["hfPromoId"]);
    var promo = _promoRepository.GetPromotion(promoId);

    string imageCaption = Request.Form["txtImageCaption"].ToString();
    string imagePath = string.Empty;

    foreach (string file in Request.Files)
    {
        HttpPostedFileBase hpf = Request.Files[file] as HttpPostedFileBase;

        if (hpf.ContentLength == 0)
        { continue; }

        imagePath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory + @"Content\PromoImages",
                                            promo.PromoId.ToString() + "__" + Guid.NewGuid().ToString() + Path.GetFileName(hpf.FileName));
        hpf.SaveAs(imagePath);
    }

    _promoRepository.SaveImageForPromo(promoId, imageCaption, imagePath, this.Request);

    if (partial == true)
    {
        return List(true, promoId);
    }

    return View("Images", GetModel(promoId));
} 
```

jQuery代码：

```
$(document).ready(function() {
        $('#frmAddImages').submit(function() {
            runAjax(form, updateImageList, 'html');
            return false;
        });
});

function runAjax(form, callback, format) {
    $.ajax({
        url: form.action + '?partial=true',
        type: form.method,
        dataType: format,
        data: $(form).serialize(),
        success: callback
    });
}

function updateImageList(result) {
    $('#gallery').html(result);
    setElementStyling();
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:21:00.727

是的，这是有道理的，jquery serialize 不会处理文件上传数据。您将需要查看某种插件来处理文件上传。我做了一些谷歌搜索，只找到了允许浏览按钮样式的插件。您可能必须采用 iframe 或 silverlight 路线。

**更新** 如评论中所述，它们是一个支持文件上传的[jQuery 表单插件](http://malsup.com/jquery/form/)。

# mysql - 在所有行都满足条件的MySQL中选择

> ID：538303
> 
> 赞同：7
> 
> 时间：2009-02-11T19:13:49.950
> 
> 标签：mysql, select

在 MySQL 中，如何选择每一行都满足特定条件的数据？例如，假设我有一个表格显示员工何时上班，它包含三个字段：

```
CREATE TABLE ArrivalTimes
(UserID INT
,Day DATE 
,ArrivalTime TIME
); 
```

我想选择从未迟到（早上 9 点或更早到达）的所有员工的用户 ID，最好的方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-11T19:21:04.533

@jjclarkson 和 @davethegr8 的答案很接近，但您不能将聚合函数放在 WHERE 子句中。为每一行评估 WHERE 子句。

您需要评估`MAX()`每个组的表达式，因此您需要使用`HAVING`子句。

试试这个：

```
SELECT UserID 
FROM ArrivalTimes
GROUP BY UserID
HAVING MAX(ArrivalTime) <= '09:00:00'; 
```

* * *

@MBCook 评论`HAVING`可能很慢。你是对的，这可能不是产生所需结果的绝对最快的方法。但`HAVING`解决办法是最*清楚*的。在某些情况下，性能的优先级低于清晰度和可维护性。

我查看了`HAVING` 解决方案的 EXPLAIN 输出（在 MySQL 5.1.30 上）：没有使用索引，并且额外的注释说“” `Using temporary; Using filesort`，这通常意味着性能会很差。

考虑以下查询：

```
SELECT DISTINCT a1.UserID
FROM ArrivalTimes a1
  LEFT OUTER JOIN ArrivalTimes a2 
  ON (a1.UserID = a2.UserID AND a2.ArrivalTime > '09:00:00')
WHERE a2.UserID IS NULL; 
```

这会生成一个使用索引的优化计划，`UserID`并说：

*   a1：“ `Using index; Using temporary`”
*   a2：“ `Using where; Distinct`”

最后，以下查询生成了一个优化计划，该计划似乎最有效地使用索引，并且没有临时表或文件排序。

```
SELECT DISTINCT a1.UserID
FROM ArrivalTimes a1
WHERE NOT EXISTS (SELECT * FROM ArrivalTimes a2 
                  WHERE a1.UserID = a2.UserID 
                    AND a2.ArrivalTime > '09:00:00'); 
```

*   a1：“ `Using where; Using index`”
*   a2：“ `Using where`”

这似乎最有可能具有最佳性能。诚然，我的测试表中只有四行，所以这不是一个有代表性的测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T19:18:03.730

这是一个很好的想法，但它不起作用。

```
SELECT UserID FROM ArrivalTimes WHERE MAX(ArrivalTime) <= '09:00:00' GROUP BY UserID 
```

使用此查询，您将收到一条错误消息：“无效使用组功能”

根据定义，像 COUNT、MAX、MIN、AVG、SUM 等聚合函数在一组（或一组记录）上执行其功能，因此 MAX(ArrivalTime) 需要采用以下形式：

```
GROUP BY UserID HAVING MAX(ArrivalTime) <= '09:00:00' 
```

请参阅上面@Bill Karwin 的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T19:19:01.903

```
SELECT userID, MAX(ArrivalTime) as latest
FROM ArrivalTimes 
WHERE latest <= '9:00:00'
GROUP BY userID 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-28T11:06:06.013

比尔·卡尔文建议：

> 试试这个：

```
SELECT UserID 
FROM ArrivalTimes
GROUP BY UserID
HAVING MAX(ArrivalTime) <= '09:00:00'; 
```

> 我查看了 HAVING 解决方案的 EXPLAIN 输出（在 MySQL 5.1.30 上）：没有使用索引，并且额外的注释说“使用临时；使用文件排序”，这通常意味着性能会很差。

鉴于有一个 ArrivalTimes.UserId 是外键的用户表，我认为以下内容更加清晰。这将选择所有从不迟到的用户：

```
 select * from user a 
 where '09:00:00' 
  >= all( select ArrivalTime from ArrivalTime b where b.UserID = a.ID); 
```

这会选择任何迟到的用户：

```
 select * from user a 
 where '09:00:00' 
  < any( select ArrivalTime from ArrivalTime b where b.UserID = a.ID); 
```

这更清楚，因为它更符合我们的英语/自然语言规范。

它避免了 a 的低效率`group by`；在 MySql 5.0.51 下，它*不需要*像 Bill 那样临时或文件排序。

（请注意，它确实需要将常数时间值补零，因此：`'09:00:00'`;`'9:00:00'`失败。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-04T12:29:54.293

您可以通过 3 种方法获取更多结果 1.使用 Group-By 功能 2.使用子查询 3.使用连接......等

## 使用组 - 按

SELECT userID, MAX(ArrivalTime) as latest FROM ArrivalTimes WHERE latest <= '9:00:00'

## 按用户 ID 分组

## 使用子查询

select * from user a where '09:00:00'

> = all（从 ArrivalTime b 中选择 ArrivalTime，其中 b.UserID = a.ID）；

* * *

你也可以使用自我内部连接来获得它

# c# - 有没有办法确定一个方法是否要在 C# 中内联

> ID：538305
> 
> 赞同：0
> 
> 时间：2009-02-11T19:13:54.177
> 
> 标签：c#, .net, inline

假设您覆盖`operator*`for`point3`和`float`然后 for`float`并且`point3`您使用了这样的运算符：

```
point3 * float 
```

你能知道操作符方法是否会被内联吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T19:20:06.173

No, you can't tell for sure. In particular, because it's done at JIT time, it will depend on the version of the CLR - and I believe that the 64 bit CLR inlines differently to the 32 bit one as well. It will also depend on whether optimisations are enabled (e.g. whether you're debugging etc).

You can *prevent* inlining with [MethodImplAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimplattribute.aspx), but that doesn't help much...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:19:38.593

As far as I know there is no way to know for certain as the JIT is responsible for inlining.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T19:22:09.523

There is no way to know if a particular method will be inlined or not. C# itself won't ever inline a method call. Only the JITer will do this. While there are certain operations that are likely to be inlined, the JITer makes no guarantees.

# c# - 智能感知中缺少配置成员

> ID：538311
> 
> 赞同：1
> 
> 时间：2009-02-11T19:15:08.887
> 
> 标签：c#, configuration, c#-3.0

我目前正在尝试为我的应用程序创建一个自定义 ConfigurationSection，但是 VS2008 无法识别每个人和 MSDN 所说的任何成员。我唯一看到的是 ConfigurationException。

```
using System;
using System.Collections.Generic;
using System.Collections;
using System.Linq;
using System.Text;
using System.Configuration;
using System.Xml;

namespace CSharpIrcBot
{

    public class ServerSettings : ConfigurationSection
    {

    }
} 
```

我正在尝试创建一个包含以下数据的部分，我可以从应用程序中读取和更新。这些将是用户设置。

服务器名、端口 (int)、实名、昵称、用户名、模式掩码

问题不在于我无法弄清楚如何，而是我什至*无法*使用 ConfigurationSection。所以我的问题是……它去哪儿了？

我似乎也缺少 ConfigurationManager ......它没有出现在智能感知的*任何地方。*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:40:42.473

您可能需要添加对“System.Configuration”程序集的引用。您可以在“[windowsfolder]\Microsoft.NET\Framework[framework version]\”中找到它。看起来您拥有 System.Configuration 命名空间，因为智能感知在其中显示了一些对象，但在您手动添加引用之前，您不会获得所有对象。

# asp.net - 命名空间“系统”中不存在类型或命名空间“Linq”

> ID：538312
> 
> 赞同：3
> 
> 时间：2009-02-11T19:15:16.000
> 
> 标签：asp.net, json.net

我正在尝试构建[Json.NET 2.0 库](http://www.codeplex.com/Release/ProjectReleases.aspx?ProjectName=Json&ReleaseId=13099)以针对 .NET 框架版本 2.0，并且多次收到此错误。我去向项目中添加对 System.Linq 的引用，但是引用列表中不存在它！我该怎么办？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-11T19:18:54.227

Json.NET 2.0 不支持 .NET 2.0。如果您想要 .NET 2.0 支持，请使用[Json.NET 1.3.1](http://www.codeplex.com/Release/ProjectReleases.aspx?ProjectName=Json&ReleaseId=6987)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-11T19:17:27.867

System.Linq 是 3.5 版的 DLL；您需要删除对它的引用才能在 2.0 中编译。

# gridview - 编辑时 GridView 中的 DropDownList 不可用

> ID：538316
> 
> 赞同：2
> 
> 时间：2009-02-11T19:17:02.297
> 
> 标签：gridview, .net-2.0, drop-down-menu, edititemtemplate

我有下面的设置。当我单击 CommandField 上的“编辑”链接时，会触发 RowEditing 事件，但该行不允许我编辑；具体来说，DropDownList 没有出现。

我的代码似乎符合我能找到的所有示例。

我可能错过了一些非常基本的东西，因为我似乎是互联网上唯一遇到这个问题的人。我渴望另一双眼睛。

谢谢。

```
 <asp:GridView ID="grdvMachine1" runat="server" AutoGenerateColumns="False" CellSpacing="2"
    CssClass="GridViewFormat" GridLines="None" Width="500px"
    OnRowUpdating="grdvMachine1_RowUpdating" OnRowUpdated="grdvMachine1_RowUpdated"
    OnRowEditing="grdvMachine1_RowEditing" OnRowDeleting="grdvMachine1_RowDeleting">
    <PagerSettings Position="Top" />
    <FooterStyle BackColor="#CCCCCC" ForeColor="Black" />
    <Columns>
        <asp:BoundField DataField="Day Of Week" HeaderText="Day Of Week" SortExpression="Day Of Week" />
        <asp:TemplateField HeaderText="Package" SortExpression="Package">
            <EditItemTemplate>
                <asp:DropDownList ID="comboPackageNames"
                    runat="server"
                    DataSourceID="PackageNames"
                    DataTextField="PackageName"
                    DataValueField="PackageName"
                    SelectedValue='<%# Bind("Package") %>'>
                </asp:DropDownList>
                <asp:ObjectDataSource ID="PackageNames" runat="server" SelectMethod="GetSPPList"
                    TypeName="PCS.WebApp.DefaultSchedules">
                </asp:ObjectDataSource>
            </EditItemTemplate>
             <ItemTemplate>
                <asp:Label ID="Label1" runat="server" Text='<%# Eval("Package") %>' />
            </ItemTemplate>
       </asp:TemplateField>
        <asp:CommandField ShowEditButton="true" ShowDeleteButton="true"/>
    </Columns>
    <RowStyle BackColor="#EEEEEE" ForeColor="Black" HorizontalAlign="Center" VerticalAlign="Middle" />
    <EmptyDataTemplate>
        There is no schedule for the selected machine
    </EmptyDataTemplate>
    <SelectedRowStyle BackColor="#008A8C" Font-Bold="False" ForeColor="White" />
    <PagerStyle BackColor="#999999" ForeColor="Black" HorizontalAlign="Center" />
    <HeaderStyle BackColor="#000084" Font-Bold="True" ForeColor="White" HorizontalAlign="Center"
        VerticalAlign="Middle" />
    <AlternatingRowStyle BackColor="Gainsboro" />
</asp:GridView> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-15T03:12:30.260

你的代码在我看来也不错。以下几点可能有助于您进行故障排除：

1.  尝试用一些简单的文本替换 EditItemTemplate 的 DropDownList 和 ObjectDataSource，然后查看单击编辑时是否显示文本。
2.  尝试将 GridView 连接到 DataSource 对象，然后从 GridView 标记中删除 OnRowEditing 事件。然后看看GridView是否切换到编辑模式OK。
3.  尝试将 ObjectDataSource 移到 GridView 之外。我不知道这是否有什么不同，但我通常把我的放在外面。

如果这对您有任何改变，请告诉我们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-15T03:24:59.213

尝试从您的 GridView 中删除您的 PackageNames ODS。我不确定，但是将它嵌套在 GridView 中有点奇怪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T13:15:36.157

我没有 GridView 的 ObjectDataSource。我在代码隐藏中填充它，但显然你不能这样做并使用 CommandField。

# database - 是否应在数据库中重复“一个父对象最多有 2 个子对象”之类的规则

> ID：538317
> 
> 赞同：1
> 
> 时间：2009-02-11T19:17:14.963
> 
> 标签：database, database-design, orm, domain-driven-design

可以使用触发器在数据库中强制执行诸如“一个父对象最多有 2 个子对象”之类的规则。但是，如果该规则已在域层中实施，那么复制该规则是否是一个好主意。

在哪些情况下重复此类规则是合理的？有没有其他方法可以避免这种重复？这不是数据完整性规则吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:32:05.523

在数据库外部的代码中几乎不可能正确地做到这一点。任何查看是否已经存在 2 条记录并且如果不存在则允许添加新记录的代码都可能被同一父节点上同时运行的 2 个线程所欺骗。除非您实际上锁定数据库表或以某种方式序列化子添加过程，否​​则两者都会导致真正缺乏可伸缩性。

您没有提到 RDBMS，因此很难为您提供解决方案。

**编辑：**

我同意那些说触发器远非干净的人的观点。但它们并不是在数据库中强制执行规则的唯一方法。这就是为什么我说在不了解您的 RDBMS 的情况下，不可能提出任何数据库解决方案，甚至是可能不需要触发器的解决方案。

此外，您不需要触发器，因为您的中间层从不执行 DML，它只是调用封装您的 CRUD 的数据库过程或包。对？！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:25:48.063

我认为系统的每一层都应该强制执行其设计能够处理的最大数量的约束。剩下的交给别人处理。我认为数据库约束和 javascript 约束在某种程度上属于同一类别；*在保持合理清洁*的同时，您可以利用可用的手段尽其所能。

触发器远远超出了我认为相当干净的范围，所以我会让业务逻辑处理这个问题。有许多数据完整性规则超出了您期望 SQL 数据库处理的范围。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T20:12:20.553

这取决于。

如果对数据库的所有写入都由单个应用程序或服务完成，那么在应用程序/服务的业务层中实现此类业务规则是合理的。特别是如果您认为规则将来可能会改变。

但是在许多现实世界的场景中，尤其是在遗留系统中，您可能有多个编写者，并且在数据库中实现这些规则的额外复杂性可能是值得的。

所有的设计都是权衡。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T20:16:10.437

我会要求它在触发器中的数据库中。这是因为数据库可能会受到 GUI 以外的其他因素的影响，并且在数据库级别未强制执行的这种性质的规则会导致数据完整性问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:20:16.987

通常我会将这个逻辑排除在数据库层之外。在我看来，这听起来更像是一条业务规则，应该存在于业务层中。如果这条规则永远改变会发生什么？您想在哪里和多少个地方更新它？通常，除了通过您的业务层之外，没有任何东西可以访问数据库，因此可以不在业务层之外的任何其他地方实现它。此外，触发器很混乱，很难维护，最重要的是，以后很难调试。

无论如何，恕我直言。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T19:22:51.083

恕我直言，触发器通常是“坏事”，但除此之外，在插入数据库表的级别执行业务规则并没有让我觉得是一个很好的“关注点分离”

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T19:25:39.843

我会尽量避免将这种类型的“业务验证逻辑”放在您的数据库层中。最终，随着应用程序的成熟，您需要对数据进行比触发器提供的更多的控制和处理。

如果您的应用程序有业务层，我将只有 SQL 强制关系，而不是规则。

# python - 使用 Python 迭代字符串中的每个字符

> ID：538346
> 
> 赞同：548
> 
> 时间：2009-02-11T19:22:15.140
> 
> 标签：python, string, iteration

在 C++ 中，我可以像这样迭代`std::string`：

```
std::string str = "Hello World!";

for (int i = 0; i < str.length(); ++i)
{
    std::cout << str[i] << std::endl;
} 
```

如何在 Python 中遍历字符串？

* * *

## 回答 #1

> 赞同：483
> 
> 时间：2009-02-11T19:30:23.810

正如约翰内斯所指出的，

```
for c in "string":
    #do something with c 
```

`for loop`您可以使用该构造在 python 中迭代几乎任何东西，

例如，`open("file.txt")`返回一个文件对象（并打开文件），遍历它会遍历该文件中的行

```
with open(filename) as f:
    for line in f:
        # do something with line 
```

如果这看起来像魔术，那么它有点像，但它背后的想法真的很简单。

有一个简单的迭代器协议可以应用于任何类型的对象，以使`for`循环在其上工作。

只需实现一个定义`next()`方法的迭代器，并在一个类上实现一个`__iter__`方法以使其可迭代。（`__iter__`当然应该返回一个迭代器对象，也就是定义的对象`next()`）

[见官方文档](http://docs.python.org/library/stdtypes.html#iterator-types)

* * *

## 回答 #2

> 赞同：328
> 
> 时间：2010-12-28T16:54:32.510

如果您在遍历字符串时需要访问索引，请使用[`enumerate()`](http://docs.python.org/library/functions.html#enumerate)：

```
>>> for i, c in enumerate('test'):
...     print i, c
... 
0 t
1 e
2 s
3 t 
```

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2009-02-11T19:24:12.077

更容易：

```
for c in "test":
    print c 
```

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2009-02-17T05:36:55.683

只是为了做出更全面的答案，如果您真的想将方形钉子强制插入圆孔，则 C 迭代字符串的方法可以在 Python 中应用。

```
i = 0
while i < len(str):
    print str[i]
    i += 1 
```

但是话又说回来，当字符串本质上是可迭代的时，为什么要这样做呢？

```
for i in str:
    print i 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-05-20T14:18:45.027

那么你也可以做一些像这样有趣的事情并通过使用 for 循环来完成你的工作

```
#suppose you have variable name
name = "Mr.Suryaa"
for index in range ( len ( name ) ):
    print ( name[index] ) #just like c and c++ 
```

答案是

先生 。苏里亚

但是，由于 range() 创建了一个序列值列表，因此您可以直接使用名称

```
for e in name:
    print(e) 
```

这也会产生相同的结果，并且看起来更好，并且适用于任何序列，如列表、元组和字典。

我们使用了两个内置函数（Python 社区中的 BIF）

1) range() - range() BIF 用于创建索引示例

```
for i in range ( 5 ) :
can produce 0 , 1 , 2 , 3 , 4 
```

2) len() - len() BIF 用于找出给定字符串的长度

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-12-18T11:11:28.640

如果您想使用更实用的方法来迭代字符串（可能以某种方式对其进行转换），您可以将字符串拆分为字符，对每个字符应用一个函数，然后将生成的字符列表连接回字符串。

字符串本质上是一个字符列表，因此 'map' 将遍历字符串 - 作为第二个参数 - 将函数 - 第一个参数 - 应用于每个参数。

例如，这里我使用了一个简单的 lambda 方法，因为我想做的只是对字符进行微不足道的修改：在这里，增加每个字符的值：

```
>>> ''.join(map(lambda x: chr(ord(x)+1), "HAL"))
'IBM' 
```

或更一般地说：

```
>>> ''.join(map(my_function, my_string)) 
```

其中 my_function 接受一个 char 值并返回一个 char 值。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-09-27T03:20:27.800

这里有几个答案使用`range`. `xrange`通常更好，因为它返回一个生成器，而不是一个完全实例化的列表。在内存和/或长度变化很大的迭代可能成为问题的情况下，`xrange`这是优越的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-01-09T08:53:40.913

您还可以执行以下操作：

```
txt = "Hello World!"
print (*txt, sep='\n') 
```

这不使用循环，但内部 print 语句会处理它。

`*`将字符串解包到列表中并将其发送到打印语句

`sep='\n'`将确保下一个字符打印在新行上

输出将是：

```
H
e
l
l
o

W
o
r
l
d
! 
```

如果您确实需要循环语句，那么正如其他人所提到的，您可以使用这样的 for 循环：

```
for x in txt: print (x) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-29T03:15:20.333

如果您曾经在需要的情况下运行`get the next char of the word using __next__()`，请记住创建 a`string_iterator`并对其进行迭代，而不是`original string (it does not have the __next__() method)`

***在这个例子中，当我找到一个 char = 时，`[`我一直在寻找下一个单词，而我没有找到`]`，所以我需要使用 __next__***

这里对字符串的 for 循环无济于事

```
myString = "'string' 4 '['RP0', 'LC0']' '[3, 4]' '[3, '4']'"
processedInput = ""
word_iterator = myString.__iter__()
for idx, char in enumerate(word_iterator):
    if char == "'":
        continue

    processedInput+=char

    if char == '[':
        next_char=word_iterator.__next__()
        while(next_char != "]"):
          processedInput+=next_char
          next_char=word_iterator.__next__()
        else:
          processedInput+=next_char 
```

# php - Ruby 上瘾者在字符串中寻找 PHP 子表达式

> ID：538350
> 
> 赞同：2
> 
> 时间：2009-02-11T19:23:16.667
> 
> 标签：php, ruby, comparison, string-interpolation

## 语境

*   PHP 5.3.x

## 概述

在与经常使用 php 和 ruby​​ 的同事进行代码审查后，与 ruby​​ 相比，php 中的字符串插值出现了一个有趣的挑战。

## 问题

假设颜色=“橙色”；

**红宝石：**

```
puts("My favorite color is #{color.downcase() + 'ish'} -- at least for now."); 
```

**PHP：**

```
print("My favorite color is {strtolower( $color ) + 'ish'} -- at least for now."); 
```

**挑战：**谁能指定一种让 PHP 版本表现得像 Ruby 的方法？

## 警告

此挑战旨在作为一项有趣的练习，但仅限于使用直接 PHP。这不适用于严肃的 PHP 项目。对于严肃的 PHP 项目，开发人员将需要考虑插件库，例如[TWIG](https://stackoverflow.com/questions/tagged/twig)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T19:27:03.943

你很接近，你可以在字符串中嵌入变量，但不能在函数调用中。

为此，我使用`printf()`(and `sprintf()`)，它是同名 C 函数的薄包装：

```
printf('My favorite color is %sish -- at least for now.', strtolower( $color )); 
```

看到`%s`里面了吗？这是您作为第二个参数传入的字符串数据类型的占位符。

`sprintf()`工作方式相同，但它返回格式化的字符串而不是打印它。

唯一的其他选择是：

A. 首先执行函数调用并将最终结果分配给变量：

```
$color = strtolower( $color );
print("My favorite color is {$color}ish -- at least for now."); 
```

B.使用连接，这有点难看IMO：

```
print('My favorite color is ' . strtolower( $color ) . 'ish -- at least for now.'); 
```

您可能已经注意到我使用单引号（也称为刻度）和双引号。

在 PHP 中，双引号内的文字被解析为变量，正如您在上面的“A”中看到的那样。

不解析单引号内的文字。因此，它们更快。作为一项规则，您应该只在有要解析的变量时在文字周围使用双引号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T19:29:23.017

```
'My favorite color is ' . strtolower( $color ) . 'ish-- at least for now.' 
```

我不认为 PHP 支持插入字符串的完整表达式。自从我做任何 PHP 以来已经有一段时间了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T19:48:23.267

你不能在这样的字符串中调用普通函数，但你可以诱使解析器做一些奇怪的事情：

```
<?php
print "{$a->b()}"; // Works

//Parse error: syntax error, unexpected '(' in Command line code on line 1
print "${time()}";

print "${$a=time()} $a"; // Also works: prints "1234380996"
?> 
```

只要它在开始时看到一个有效的变量，它就会继续插入整个语句而不会抱怨。

对于那些想知道的人，是的，这也有效......

```
<?php
print "${$a or print shell_exec('ls')}";
?> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T19:53:30.697

如果这是任何事情......

```
class ColorIsh {
    var $color;

    function __constructor($color) { $this->color = $color; }
    function __get($prop) {
        if ($prop == 'ish') {
            // code here fixing suffix if needed
            return strtolower($this->color) . 'ish';
        }
        return '';
    }
    function __set($prop) {}
}

$color = new ColorIsh("orange");
$str = "My favorite color is $color->ish -- at least for now."; 
```

还有超进阶版

```
class ColorIsh {
    private $color;

    function __constructor($color) {$this->color = $color; }
    function __get($prop) {
        if ($prop == 'color') 
            return $this->color;
        if ($prop == 'ish')
            return isset($this->ish) ? $this->ish : $this->color . 'ish';
        return false;
    }
    function __set($prop, $value) {
        if ($prop == 'color') { $this->color = $value; unset($this->ish); }
        if ($prop == 'ish') { $this->ish = $value; }
    }
}

$color = new ColorIsh('orange');
$color->ish = 'orangish';
print "The color is kinda $color->ish";
$color->color = 'green';
print "The color is kinda $color->ish";

output:
The color is kinda orangish.
The color is kinda greenish. 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-06-03T15:28:12.287

它不是那么漂亮，但您可以使用匿名函数。

```
$e = function($val) { return $val; };
$foo = 'foo';
echo "Uppercase foo = {$e(strtoupper($foo))}"; 
```

我的项目通常有一个辅助函数，它返回上面的匿名函数，所以不需要每次都重新创建。

```
function returner() {
    static $returner;

    if (!$returner) {
        $returner = function($val) {
            return $val;
        };
    }

    return $returner;
}

$e = returner(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T19:47:00.133

不可能。但是如果你真的坚持，你总是可以创建一个具有流畅接口的 String 类......但这太疯狂了:)

# c# - 托管与非托管

> ID：538365
> 
> 赞同：3
> 
> 时间：2009-02-11T19:27:21.790
> 
> 标签：c#, .net, performance, unmanaged, managed

你对他们有什么看法？

有时我必须在工作中编写非托管代码，但是对于大型（游戏）项目，它只会变得更加耗时和复杂，这可以通过投入更多人来解决。

您认为托管代码对于大规模应用程序是否可行？（像 Photoshop、[3ds Max](http://www.softpedia.com/screenshots/3D-Studio-Max_8.png)、[Maya](http://www.d-vw.com/dsculptor/with_other/maya_screen_shot.gif)、[XSI](http://img259.imageshack.us/img259/4116/maxwellxsiur2.jpg)等应用程序，这些应用程序计算密集，但没有游戏的实时要求（在一定程度上）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:34:48.090

我认为出于性能原因使用非托管代码是我听说过的最糟糕的过早优化之一。在您选择一些更难使用的技术之前，因为它可能更快，您应该非常确定您需要速度。

此外，CLR 的性能非常接近无人值守的性能，以至于 100 个案例中有 99 个甚至不必考虑它。即使您属于需要性能的阵营，您也应该在托管空间中编写大部分代码，然后在探查器告诉您的部分中切换到非托管空间。

特别是关于游戏：现在已经有一些在单声道上编写的更大的游戏***获得了***性能，因为它们可以用托管代码编写所有内容，而不必为 AI 等抽象部分使用脚本语言。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T19:39:30.917

我认为您可以使用 .NET 进行大型应用程序。那里有很多例子：

*   VisualStudio 的一部分是用 .NET 编写的（例如 WinForms 编辑器和 WPF 编辑器）
*   Expression Blend 是用 .NET 和 WPF 编写的
*   Stackoverflow 和许多其他网站一样使用 .NET 和 ASP.NET。
*   在 VisualStudio 2010 中，新的编辑器（当前实现的替换）是用 .NET 和 WPF 编写的

关于计算密集型应用程序的一句话：由于代码由解释器编译为机器代码，因此大多数计算应该与非托管代码一样快。

另一方面，你有很多优势：

*   （几乎）没有内存泄漏（垃圾收集器）
*   出现问题时会出现异常，没有信息就不会崩溃
*   代码在 x32 和 x64 上同样运行良好，无需更改或重新编译应用程序
*   C# 比 C++ 更易于使用（委托、集合、LINQ 等）
*   ...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T19:41:45.170

因为您提到了 PhotoShop ... [paint.net](http://www.getpaint.net/features.html)是一个不错的图形包（不完全符合 PhotoShop，但令人印象深刻），用 C# 编写。

# vb6 - 是否有可以传递给 VB6 格式函数的格式字符串，该函数将简单地对数字进行分组？

> ID：538368
> 
> 赞同：1
> 
> 时间：2009-02-11T19:28:35.500
> 
> 标签：vb6, string-formatting

是否有格式字符串（？）我可以传递给执行数字分组的 VB6 格式函数？我想替换此语句中的问号...

```
Debug.Print Format(123456789, "?") 
```

...带有将生成以下输出的字符串：

```
123,456,789 
```

预定义的格式字符串“标准”很接近，但它添加了一个小数点和最后两个 0：

```
? Format(123456789, "Standard")
123,456,789.00 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:30:42.500

当我输入问题时，我又看了一眼文档并找到了答案，但我还是继续发布了它。这里是：

```
Debug.Print Format(123456789, "#,##0") 
```

# jquery - jQuery淡入效果

> ID：538373
> 
> 赞同：2
> 
> 时间：2009-02-11T19:30:23.747
> 
> 标签：jquery

我不确定为什么下面的代码没有像我期望的那样运行，但由于我是 jQuery 新手，我确信我缺少一些基本的东西。

html:

```
<div id="locale"></div>

<form id="theForm">
What would you like to do?<br /><br />
<input type="text" id="doThis" /><br /><br />
</form> 
```

js：

```
$(document).ready(function() {
    $("#theForm").submit(function(){
        var doThis = $("#doThis").val().toLowerCase();
        $("#locale").html(doThis).fadeIn("slow");
        return false;
    });
}); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-11T19:40:28.450

您只需首先隐藏区域设置 div 以便它可以真正淡入（否则它将直接显示）：

```
$(document).ready(function() {
    $("#theForm").submit(function(){
        var doThis = $("#doThis").val().toLowerCase();
        $("#locale").hide().html(doThis).fadeIn("slow");
        return false;
    });
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-11T19:38:24.460

我假设您在某处有一个提交按钮，所以这不是您的问题。

我在您的代码中看到的是区域设置 div 不会淡入。看起来它只是“弹出”存在。问题是 div 已经可见。并且 html 调用只是替换了内部 html。如果对象已经可见，fadeIn() 将不会做任何事情。

解决方案：在隐藏 div 的情况下启动页面。

改变这个：

```
<div id="locale"></div> 
```

对此：

```
<div id="local" style="display:none"></div> 
```

# sharepoint - In sharepoint how can a search be limited to current folder in a doc library?

> ID：538375
> 
> 赞同：5
> 
> 时间：2009-02-11T19:30:32.513
> 
> 标签：sharepoint

We have a large document library with 3000+ folders. Our customer wants to be able to search within the current folder. Because this document library has a lot of folders creating one scope per folder is out of question. So the question is: How can a search be limited to current folder in a doc library?

Thanks

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T20:08:48.193

顺便说一句，您需要实现自定义搜索功能并直接访问搜索 API。更重要的是，您似乎正遭受 FileShareism 的困扰。我已经看到许多 SharePoint 实施因这种痛苦而受苦甚至死亡。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T20:03:28.960

**如果要限制为文档库：**

这已经内置了。当您查看文档库时，右上角的搜索框默认为“此列表：NameOfDocLib”。在此处搜索会将范围限制在文档库中。

**如果要搜索单个文件夹：**

这是内置在 Windows 中的。使用内置的 Windows 资源管理器搜索。

告诉您的客户在资源管理器视图中打开文件夹。右键单击要搜索的文件夹并选择搜索。

不要告诉您的客户这一切都是内置的。为此而努力。利润！:)

@webwires 我同意 3000 个文件夹。您真的应该考虑将其分解为多个文档库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-07T20:59:34.027

对我有用的是真正微调我的搜索范围。确保我使用“包含”作为行为类型。然后将我的网址（非安全 URL）设置为我想要抓取的文档库文件夹。

*在 15 分钟的爬行之后，我知道事情很顺利，因为我注意到我的项目数大于 0！*

然后，我确保我的网页（这是一个现在转换为 v4 模板的搜索中心网站）能够在其上放置我的搜索框 Web 部件，并将搜索结果重定向到同一子目录下的 results.aspx 页面地点。

# c# - 帮助将 C# 代码转换为 Vb 8.0

> ID：538378
> 
> 赞同：-2
> 
> 时间：2009-02-11T19:30:38.473
> 
> 标签：c#, vb.net

.

```
 private void Form1_Load(object sender, EventArgs e)
    {

               List<CaclulatedData> tests = new List<CaclulatedData>
                                   {
                                    new CaclulatedData()
                                     {
                                      Bonds = "First Bond",
                                      TransactionList = new List<TransactionData>
                                                {
                                                 new TransactionData() {Debit = "DebitData"}
                                                }
                                     },
                                    new CaclulatedData()
                                     {
                                      Bonds = "Second Bond",
                                      TransactionList = new List<TransactionData>
                                                {
                                                 new TransactionData() {Debit = "123123"},
                                                 new TransactionData() {Debit = "12312", Credit = "3453"}
                                                }
                                     }
                                   };
               gridControl1.DataSource = tests;

    }

}
public class JEString
{

    public string Bonds { get; set; }

}

public class CaclulatedData : JEString
{
    public List<TransactionData> TransactionList { get; set; }
}

public class TransactionData
{
    public string Debit { get; set; }
    public string Credit { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T19:58:27.457

您还可以使用反射器将您的 .net 程序集转换为以下任何一种语言。

*   伊利诺伊州
*   C＃
*   VB.NET
*   德尔福
*   MC++

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:35:46.747

有许多免费的在线 C# 到 VB.NET 和 VB.NET 到 C# 转换器可用：

[http://converter.telerik.com/](http://converter.telerik.com/)

[http://www.developerfusion.com/tools/convert/vb-to-csharp/](http://www.developerfusion.com/tools/convert/vb-to-csharp/)

[http://www.kamalpatel.net/ConvertCSharp2VB.aspx](http://www.kamalpatel.net/ConvertCSharp2VB.aspx)

[http://www.carlosag.net/Tools/CodeTranslator/](http://www.carlosag.net/Tools/CodeTranslator/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T20:18:21.507

您的部分问题是 vb8 尚不支持您的 C# 代码正在使用的某些功能（例如，自动属性和集合初始化程序），因此翻译不是 1:1。其中一些特性是在 VB9 中添加的。也就是说，这并不难：

```
Private Sub Form1_Load(ByVal sender As Object, ByVal e As EventArgs)
    Dim tests As New List(Of CaclulatedData)(2)

    tests.Add(New CalculatedData())
    tests(0).Bonds = "First Bond"
    tests(0).TransactionList.Add(New TransactionData())
    tests(0).TransactionList(0).Debit = "DebitData"

    tests.Add(New CalculatedData())
    tests(1).Bonds = "Second Bond"
    tests(1).TransactionList.Add(New TransactionData())
    tests(1).TransactionList(0).Debit = "123123"
    tests(1).TransactionList.Add(New TransactionData())
    tests(1).TransactionList(1).Debit = "12312"
    tests(1).TransactionList(1).Credit = "3453"

    gridControl1.DataSource = tests
End Sub

Public Class JEString
    Private _Bonds As String
    Public Property Bonds() As String
       Get
          Return _Bonds
       End Get
       Set(ByVal value As String)
           _Bonds = value
       End Set
    End Property
End Class

Public Class CaclulatedData 
    Inherits JEString

    Private _TransactionList As New List(Of TransactionData)()
    Public ReadOnly Property TransactionList() As List(Of TransactionData)
        Get
            Return _TransactionList
        End Get
    End Property
End Class

Public Class TransactionData
    Private _Debit As String
    Private _Credit As String

    Public Property Debit() As String
       Get
          Return _ Debit
       End Get
       Set(ByVal value As String)
           _ Debit = value
       End Set
    End Property

    Public Property Credit() As String
       Get
          Return _ Credit
       End Get
       Set(ByVal value As String)
           _Credit = value
       End Set
    End Property
End Class 
```

# c# - 什么是托管/非托管 .net 代码，它对我有什么影响？

> ID：538385
> 
> 赞同：1
> 
> 时间：2009-02-11T19:31:52.120
> 
> 标签：c#, .net, unmanaged, managed

我看到这里使用了相当多的术语托管和非托管。在线搜索我可以对它们有一个模糊的概念，但我真正需要知道的是它如何影响我作为 C# 桌面应用程序开发人员？我怎么知道我在任何时候都在处理什么，以及它如何改变我对该代码的处理方式？

### 复制

> [什么是 C# 中的托管/非托管代码？](https://stackoverflow.com/questions/334326/what-is-managed-unmanaged-code-in-c)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T19:37:09.877

托管代码是需要 .NET 框架才能运行的代码……非托管代码不需要。如果您使用 C# 编写代码，那么您正在编写托管代码。如果您使用 Pinvoke，您可能会与非托管代码交互，但如果您坚持使用纯 C#，您的应用程序将是所有托管代码。

# php - AJAX 调用 PHP 脚本给我 500 内部服务器错误？

> ID：538391
> 
> 赞同：7
> 
> 时间：2009-02-11T19:33:25.767
> 
> 标签：php, ajax, apache

我使用 JQuery 发出这样的 AJAX 请求：

```
$.ajax({
  type: "GET",
  url: "getvideo.php",
  data: 'videoid=' + vid, 
```

我使用萤火虫告诉我发生了什么，它告诉我发生了 500 内部服务器错误？以下是相关脚本的一部分：

```
$videoid = $_GET['videoid'];
$get = new youtubeAPI();
$get->getVideoAPI($videoid);

class youtubeAPI extends Exception {

  function getVideoAPI($videoid){

    if (isset($videoid)) {

      $clientLibraryPath = 'library';
      $oldPath = set_include_path(
        get_include_path() . PATH_SEPARATOR . $clientLibraryPath
      );

      require_once 'Zend/Loader.php'; // the Zend dir must be in your include_path 
```

我对其他脚本使用相同的 AJAX 调用，它们很好。我已经在另一台服务器上使用了这些脚本，**除了**在另一台服务器上文件名为“getvideo.php5”之外，我将其命名为“getvideo.php”，因为我只安装了 PHP 5.2.6。

请帮忙

## 更新

这是错误：

> [2009 年 2 月 11 日星期三 20:48:17] [错误] [客户端 xx.xx.xxx.xxx] PHP 致命错误：在 /var/www/html/library/Zend/Gdata/App 中找不到类“DOMDocument”。 php上线734，referer：http: [//xx.xx.xx.xxx/](http://xx.xx.xx.xxx/)

我隐藏了我的IP。在那一行：

```
public static function importString($string, $className='Zend_Gdata_App_Feed') {
  // Load the feed as an XML DOMDocument object
  @ini_set('track_errors', 1);
  $doc = new DOMDocument(); // LINE 734
  $success = @$doc->loadXML($string);
  @ini_restore('track_errors'); 
```

但我不应该玩弄那个，对吧？无论如何，该类不作为脚本存在，也不作为类存在于该脚本中。我正在我的其他服务器中使用这个相同的库。它也错过了？？？这是我从 Youtube API zip 文件夹下载的。

## 解决了

这是一个全新的服务器，它安装了最少的 PHP。我缺少 PHP dom 函数。快速安装解决了这个问题。感谢您提醒我查看日志。我应该先尝试一下。

```
yum install php-xml
yum install php-xmlrpc 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-11T19:37:30.330

尝试自己在浏览器中手动执行调用（同样的事情），看看会返回什么。如果没有返回任何内容并且您收到 500 内部服务器错误，那么您需要查看您的日志并查看导致此错误发生的原因。

还要确保您正在对正确的域进行 ajax 调用。如果您尝试从您的域中调用，则每次调用都会失败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:37:11.423

什么？`.php5`? 我不知道您的 apache 配置（假设您正在使用它），但`.php`适用于所有版本的 PHP。

无论如何，尝试直接访问该 URL 并查看会发生什么，这应该与 Ajax 无关。还请查看您的网络服务器日志。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-19T01:03:55.733

确保权限设置正确。刚刚在 justhost.com 服务器上遇到了同样的问题 将我的 php 脚本的权限设置为 0644，一切都很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-20T10:46:06.833

我有类似的问题，但解决方案不同。检查**您是否已上传 PHP 代码中引用的所有文件**。我发现我通过 ajax 调用的文件引用了缺少定义文件的类，并且服务器为此返回了一个`500 Internal server error`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-31T08:25:40.427

可能你只是有一个 php 代码错误`copy`，`past`并且`(url)`
会告诉你错误修复它，一切都应该没问题祝你好运

# sql-server - Windows 6 应用程序从本地移动到服务器后，sql 连接不起作用

> ID：538397
> 
> 赞同：1
> 
> 时间：2009-02-11T19:34:50.053
> 
> 标签：sql-server, windows-mobile, connection

我有一个正在开发的 Windows 6 应用程序（在 VB 中）。我正在从 MSSQL 2005 数据库中提取数据。在本地（使用模拟器）运行它一切正常，但是当我将数据库移动到测试框时，出现以下错误：

System.Data.SqlClient.SqlException {“找不到指定的 SQL 服务器：xx.xx.xx.xxx\sql2005”}

我的连接字符串是：

```
Data Source=XX.XX.XX.XXX\sql2005;Initial Catalog=databaseName;UID=databaseUser;PWD=password 
```

连接字符串与我在本地运行时的唯一区别是我使用了我的计算机名称（我也尝试使用 sqlserver 计算机的名称）。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T19:38:29.563

确保 sql 浏览器正在运行

确保在 SQL 框上启用了远程连接和 TCP/IP

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T19:40:01.493

尝试将连接字符串更改为：

```
Data Source=XX.XX.XX.XXX;Initial Catalog=databaseName;UID=databaseUser;PWD=password 
```

很可能实例名称 (sql2005) 不正确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:06:29.120

戈登的想法很接近。实例名称 (sql2005) 是正确的，因为我可以从我的 Web 应用程序使用相同的连接字符串到达​​那里，但由于某种原因不适用于移动应用程序。当我将数据库从那个实例移动到那个盒子上时（所以 xx.xx.xx.xxx 没有 /sql2005）它起作用了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:38:41.653

应用程序是否与数据库在同一台服务器上运行？您是否尝试过使用“本地主机”？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:48:51.177

一定要确保按照 SqlMenace 的建议在 SQL Box 上启用远程连接。

如果 SQL Server 配置为允许远程连接并启用了 TCP/IP，请尝试在数据库服务器上运行该应用程序以查看它是否正常工作。如果它不起作用，则表明连接字符串有问题。

如果在数据库服务器上本地运行应用程序有效，并且启用了远程连接\TCP/IP，请尝试[这篇](http://msdn.microsoft.com/en-us/library/cc646023.aspx)关于 Windows 防火墙和 SQL Server 的文章。

# .net - Linq to SQL vs Entity Framework，微软支持

> ID：538401
> 
> 赞同：3
> 
> 时间：2009-02-11T19:35:50.163
> 
> 标签：.net, linq, linq-to-sql, entity-framework

两者的优点/缺点是什么？此外，我听说过有关 Microsoft 是否会继续支持 LINQ to SQL 的各种传言，如果有任何进一步的信息，我们将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T19:40:09.310

根据我的理解，L2S 将继续得到支持，根据我在上次 PDC 中的回忆，所有的重点都放在 .NET 4.0 的 L2E 上。

从我对 L2E 当前状态的试验来看，它“不够充分”。尤其是在速度领域。我做了一些简单的性能测试，我的 L2S 查询有时比 L2E 快 2-4 倍，即使预编译 L2E 视图也是如此。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T19:40:17.983

LINQ to SQL 适用于永远只使用 SQL 的应用程序。

实体框架适用于需要提供可插入后端（Oracle、MySQL、SQL、XML 等）数据源的应用程序。

我对谣言的看法是，当你从 MS（或任何其他公司）得到正面或负面的官方声明时，使用你认为稳定的对手头项目有意义的东西，并担心“支持”。截至目前，两者都受支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T19:38:35.117

这篇[文章](http://blogs.microsoft.co.il/blogs/sasha/archive/2008/07/01/linq-to-sql-more-useful-than-you-d-think.aspx)指出了一些信息。特别是3个主要区别：

*   能够查询 Microsoft SQL Server 以外的关系存储

*   不限于 LINQ 语言支持的全文查询语言

*   高级映射工具，例如将单个类映射到多个表

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T19:38:48.487

你可以改用 NHibernate 吗？它非常成熟，得到了社区的大力支持。

# sql - T-SQL 将日期时间修剪为最近的日期？

> ID：538412
> 
> 赞同：20
> 
> 时间：2009-02-11T19:38:08.423
> 
> 标签：sql, tsql, datetime, date-arithmetic

***[删除日期时间值（SQL Server）的时间部分的最佳方法是什么](https://stackoverflow.com/questions/2775)***？****

 **我有一列可以跟踪使用日期时间创建事物的时间，但我想生成一个按天对它们进行分组的报告，因此我需要一种方法来消除日期时间列的时间部分。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2012-01-05T20:24:47.577

为什么不直接转换为日期：

```
select convert(date, getdate()) 
```

这会截断天数，而不是轮数。要舍入 Days，请执行以下操作：

```
select convert(date, getdate() + 0.5) 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-11T19:43:02.860

一种方法是更改`getdate()`​​为您的列名，

```
select dateadd(dd, datediff(dd, 0, getdate())+0, 0) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-27T21:58:53.383

这是另一个解决方案：

```
SELECT CAST( FLOOR( CAST( GETDATE() AS float) ) AS smalldatetime) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T19:40:28.887

这是从日期时间获取日期（作为字符串）的简单方法：

```
convert(varchar, <the date field/value/etc>, 101) 
```

但请注意，此字段的排序将按字母顺序而不是按日期，因为它现在是一个字符串

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T19:40:20.243

是的。有多种格式可供选择，因此我将其链接起来。

[http://library.cirr.com/Microsoft/SQL-Server-v7/html/ca-co_1.htm](http://library.cirr.com/Microsoft/SQL-Server-v7/html/ca-co_1.htm)

如果您希望像您的帖子所暗示的那样将时间归零，您可以试试这个：

```
select cast(convert(varchar, getdate(), 101) as datetime) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-05-17T18:14:59.247

我只是做 cast(getdate() as date)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T19:43:12.750

```
declare @CurrentDate datetime
set @CurrentDate = dateadd(dd, datediff(dd, 0, getdate()), 0) 
```

- 或者 -

```
select dateadd(dd, datediff(dd, 0, MyDateColumn), 0) as DateOnly
from tblX 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T19:45:33.163

在我的搜索中，我遇到了以下解决方案，它仅从 UTC 时间中剔除时间，但我发现它很有趣，所以我认为其他人也会这样做：

```
FUNCTION TrimDate(@dt AS DATETIME) RETURNS DATETIME
BEGIN
    RETURN CAST(CAST((@dt - 0.500000038580247) AS INT) AS DATETIME) 
END 
```

我认为它运行得很快，因为它所做的只是四舍五入和铸造。

# c# - 我可以依赖 Linq 中的 SortedDictionary 的顺序，它是否有效地执行此操作？

> ID：538426
> 
> 赞同：0
> 
> 时间：2009-02-11T19:39:35.097
> 
> 标签：c#, .net, linq, linq-to-objects

在 Linq 中使用 SortedDictionary 并遍历它提供的 KeyValuePair 时，我可以确保复杂的 linq 查询将按升序执行它吗？这是一个简短的，虽然有点令人困惑的例子：

```
Random r = new Random();
//build 100 dictionaries and put them into a sorted dictionary
//with "priority" as the key and it is a number 0-99.
SortedDictionary<int, Dictionary<int, double>> sortedDict = 
    new SortedDictionary<int, Dictionary<int, double>>();
for (int i = 0; i < 100; i++)
{
    Dictionary<int, double> dict = new Dictionary<int, double>();
    //create the dictionary and a random 10 k/v pairs
    for (int j = 0; j < 10; j++)
    {
        dict[r.Next(0, 100)] = r.NextDouble() * i * 10;
    }
    sortedDict[i] = dict;
}

IEnumerable<int> keys = Enumerable.Range(0, 100);

//the goal is to find the FIRST existence of the "key" inside one
//of the inner dictionaries going through the SortedDictionary IN ORDER
//this appears to work:
var qry = from key in keys
          from priority in sortedDict
          where priority.Value.ContainsKey(key)
          let value = priority.Value[key]
          group value by key into keyGroup
          let firstValue = keyGroup.First()
          select new { Key = keyGroup.Key, Value = firstValue };

// the result is as expected, a list of the numbers at most 0-99 and their
// value found in the dictionary with the lowest "priority" 
```

问题：

1.  它似乎有效，但我可以依靠这种行为吗？
2.  这是有效的，还是小组把它扔掉了？
3.  添加“sortedDict.Reverse()”是否也能正常工作？（看来）
4.  Plinq 将如何处理这个问题——它是否仍然保持一致？

如果不能保证这一点，我知道如何在事后将“优先级”拉入分组并按其排序。但我宁愿不...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T20:00:25.937

1.  是的，您可以信任 SortedDictionary 的顺序。否则将毫无意义:)
2.  如果没有“let”子句，效率会更高一些。做就是了：

    ```
    var qry = from key in keys
              from priority in sortedDict
              where priority.Value.ContainsKey(key)
              let value = priority.Value[key]
              group value by key into keyGroup
              select new { Key = keyGroup.Key, Value = keyGroup.First() }; 
    ```

    但是，您仍然需要大量地浏览字典。您基本上不想要从键到包含该键的优先级的反向映射吗？这可以更有效地构建。正如你所说，这个例子很混乱。如果你能告诉我们你想在你的*真实*代码中实现什么，我们可能会想出更好的东西。（如果确实是这种情况，我当然可以解决这个问题 - 我宁愿不这样做，然后发现现实非常不同！）

3.  调用 Reverse() 确实会起作用 - 但它会缓冲所有数据。如果你想要它以相反的顺序，我建议你给 SortedDictionary 一个合适的 IComparer 开始。

4.  就订单而言，并行 LINQ 是“有趣的”。现在可能会有所不同，但[不久前](http://msmvps.com/blogs/jon_skeet/archive/2007/12/04/a-cautionary-parallel-tale-ordering-isn-t-simple.aspx)当我使用它绘制 Mandelbrot 集时我很开心......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T23:45:06.910

这是有关哪些 linq 方法保留顺序的[答案。](https://stackoverflow.com/questions/204505/preserving-order-with-linq/204777#204777)

目测查询，看起来您有：

```
 keys.SelectMany(...)
    .Where(...)
    .GroupBy(...)
    .Select(g => g.First())
    .Select(...); 
```

所有这些都会以某种方式保持排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:51:48.830

1.  是的你可以。SortedDictionary 无法取消排序。保证保持排序，即使它抛出异常
2.  排序是有效的。您可以通过了解使用什么类型的领域知识等更有效地做到这一点，但在 99,99% 的情况下，这样做会很多而且不值得
3.  是的：）
4.  看来我错了，plinq 有订购问题。请参阅乔恩的帖子

# .net - .Net 和 iPhone 之间的 AES 互操作性？

> ID：538435
> 
> 赞同：23
> 
> 时间：2009-02-11T19:40:33.643
> 
> 标签：.net, iphone, encryption, aes

我需要在 iPhone 上加密一个字符串并将其发送到 .Net Web 服务进行解密。我可以在 iPhone 和 .Net 上加密/解密，但来自 iPhone 的加密字符串不能被 .Net 解密。我得到的错误是“填充无效，无法删除。”

.Net 代码来自： [http ://blog.realcoderscoding.com/index.php/2008/07/dot-net-encryption-simple-aes-wrapper/](http://blog.realcoderscoding.com/index.php/2008/07/dot-net-encryption-simple-aes-wrapper/)

iPhone 代码使用的示例代码来自： http: [//nootech.wordpress.com/2009/01/17/symmetric-encryption-with-the-iphone-sdk/](http://nootech.wordpress.com/2009/01/17/symmetric-encryption-with-the-iphone-sdk/)

AFAIK 我的关键设置是一样的：

```
result.BlockSize = 128; // iPhone: kCCBlockSizeAES128
result.KeySize = 128; // kCCBlockSizeAES128
result.Mode = CipherMode.CBC;
result.Padding = PaddingMode.PKCS7; // kCCOptionPKCS7Padding 
```

我尝试了不同的生成密文的方法。你好/你好是：

e0PnmbTg/3cT3W+92CDw1Q== 在.Net

yrKe5Z7p7MNqx9+CbBvNqQ== 在 iPhone 上

并且“openssl enc -aes-128-cbc -nosalt -a -in hello.txt -pass pass:hello”生成：QA+Ul+r6Zmr7yHipMcHSbQ==

更新：[我已经在这里发布了这个工作代码](http://dotmac.rationalmind.net/2009/02/aes-interoperability-between-net-and-iphone/)。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-12T03:44:12.980

至少，您正在使用不同的初始化向量 (IV)。

*   .Net 代码使用 IV 的密钥。

    ```
    private static AesCryptoServiceProvider GetProvider(byte[] key)
    {
        //Set up the encryption objects
        AesCryptoServiceProvider result = new AesCryptoServiceProvider();
        byte[] RealKey = Encryptor.GetKey(key, result);
        result.Key = RealKey;
        result.IV = RealKey;
        return result;
    }
    ```

    和

    ```
    private static byte[] GetKey(byte[] suggestedKey, AesCryptoServiceProvider p)
    {
        byte[] kRaw = suggestedKey;
        List kList = new List();
        for (int i = 0; i < p.LegalKeySizes[0].MinSize; i += 8 )
        {
            kList.Add(kRaw[i % kRaw.Length]);
        }
        byte[] k = kList.ToArray();
        return k;
    }
    ```

    这可能应该是：`kList.Add(kRaw[(i / 8) % kRaw.Length]);`。否则长度 % 8 == 0 的键会重复使用同一个字母，呵呵！

    因此，.Net 使用的 IV（和密钥）是：`hleolhleolhleolh`. 这不是 API 的一部分，而是由于您指向的包装器代码（其中有一个严重的错误......）。

*   iPhone 代码使用 0 表示 IV。

    ```
    // Initialization vector; dummy in this case 0's.
    uint8_t iv[kChosenCipherBlockSize];
    memset((void *) iv, 0x0, (size_t) sizeof(iv));
    ```

*   默认情况下，openssl 会预先添加一个随机生成的盐（这就是输出更长的原因！）。

openssl 输出更安全，因为它预先添加了一个随机初始化向量。看起来base64解码字符串的前几个字节是“Salted__”。您还可以要求 openssl 不使用盐 (-nosalt) 和/或提供 IV (-iv)。

本质上，openssl、.Net 和 iPhone 使用相同的加密，您只需要注意如何使用加密密钥和初始化向量初始化 API。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-12-11T01:11:49.490

在c#中

```
void test(){
   string ctB64 = encrypt("hola");
   Console.WriteLine(ctB64);  // the same as in objective-c
}

string encrypt(string input)
        {
            try
            {
                // Create a new instance of the AesManaged class.  This generates a new key and initialization vector (IV).
                AesManaged myAes = new AesManaged();

                // Override the cipher mode, key and IV
                myAes.Mode = CipherMode.CBC;
                myAes.IV = new byte[16] { 0x10, 0x16, 0x1F, 0xAD, 0x10, 0x10, 0xAA, 0x22, 0x12, 0x51, 0xF1, 0x1E, 0x15, 0x11, 0x1B, 0x10 }; // must be the same as in objective-c
                myAes.Key = Encoding.UTF8.GetBytes(“0123456789123456”);
                //CipherKey;  // Byte array representing the key
                myAes.Padding = PaddingMode.PKCS7;

                // Create a encryption object to perform the stream transform.
                ICryptoTransform encryptor = myAes.CreateEncryptor();

                // perform the encryption as required...
                MemoryStream ms = new MemoryStream();
                CryptoStream ct = new CryptoStream(ms, encryptor, CryptoStreamMode.Write);
                byte[] binput = Encoding.UTF8.GetBytes(input);
                ct.Write(binput, 0, binput.Length);
                ct.Close();
                byte [] result = ms.ToArray();
                return Convert.ToBase64String(result);
            }
            catch (Exception ex)
            {
                // TODO: Log the error 
                Console.WriteLine(ex);
                throw ex;
            }

        } 
```

[· 在objective-c中，添加来自https://github.com/kelp404/CocoaSecurity](https://github.com/kelp404/CocoaSecurity)的CocoaSecurity库

```
#import "CocoaSecurity.h"
#import "Base64.h"

…

- (void) test{
 unsigned char bytes[] = { 0x10, 0x16, 0x1F, 0xAD, 0x10, 0x10, 0xAA, 0x22, 0x12, 0x51, 0xF1, 0x1E, 0x15, 0x11, 0x1B, 0x10 }; // must be the same as in c#

    NSData *iv = [NSData dataWithBytesNoCopy:bytes length:16 freeWhenDone:YES];
    NSData* key =   [@"0123456789123456" dataUsingEncoding:NSUTF8StringEncoding];

    CocoaSecurityResult *result = [CocoaSecurity aesEncrypt:@"hola" key:key iv:iv];
   NSLog(@"%@", result.base64); // the same as in c#

    NSData *data = [NSData dataWithBase64EncodedString:result.base64];
    CocoaSecurityResult *result2 = [CocoaSecurity aesDecryptWithData:data key:key iv:iv];

    NSLog(@"%@", result2.utf8String); // show "hola"

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T06:58:14.823

您确定在测试中使用相同的 AES 密钥吗？您帖子中的 OpenSSL 示例使用密码，OpenSSL 从中派生密钥和 IV（并且可能也使用盐。

生成一个随机的 128 位密钥，并以十六进制格式将此密钥指定给 OpenSSL：

```
openssl enc -aes-128-cbc -a -in hello.txt -K KEY_IN_HEX -iv 0 
```

您不应该在任何安全系统中使用 IV=0，但为了测试互操作性，它是可以的。

# sqlite - 修复 Unicode 字节序列

> ID：538441
> 
> 赞同：1
> 
> 时间：2009-02-11T19:41:53.237
> 
> 标签：sqlite, postgresql, vim, unicode

有时在将内容复制到 PostgreSQL 中时，我会收到无效字节序列的错误。

有没有一种简单的方法使用 vim 或其他实用程序来检测导致错误的字节序列，例如：**用于编码“UTF8”的无效无效字节序列：0xde70**等等，以及可能和简单的方法来进行转换？

编辑：

我的工作流程是：

1.  转储 sqlite3 数据库（来自 trac）
2.  试图在 postgresql 中重播它

也许有更简单的方法？

更多编辑：

还尝试了这些：

1.  运行 enca 来检测文件的编码

    *   告诉我这是ASCII
2.  尝试 iconv 从 ASCII 转换为 UTF8。出错了

起作用的是删除它抱怨的几行错误。但这并没有真正解决真正的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T19:47:20.820

基于一个简短的句子，听起来您有一种编码（例如 ANSI/ASCII）的文本，而您告诉 PostgreSQL 它实际上是另一种编码（Unicode UTF8）。您将使用的所有不同工具：PostgreSQL、Bash、某种编程语言、另一种编程语言、来自其他地方的其他数据、文本编辑器、IDE 等，都具有可能不同的默认编码，以及某些步骤顺便说一句，没有进行正确的转换。我会检查跨越这些边界的数据流，以确保编码对齐，或者正确检测到编码并且正确转换文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T20:07:38.460

如果您知道转储文件的编码，则可以使用`recode`. 例如，如果它以 latin-1 编码：

```
recode latin-1..utf-8 < dump_file > new_dump_file 
```

如果你不确定编码，你应该看看 sqlite 是如何配置的，或者尝试一些试验和错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:56:57.137

我想到了。这不是真正的编码问题。

SQLite 的输出转义字符串与 Postgres 预期的不同。在某些情况下会输出 'asdf\xd\foo'。我相信 '\x' 导致它期望以下字符是 unicode 编码。

解决方案是在 sqlite 3 中以 CSV 模式单独转储每个表。

第一的

```
sqlite3 db/trac.db .schema | psql 
```

现在，这在很大程度上可以将数据复制回

```
for table in `sqlite3 db/trac.db .schema | grep TABLE | sed 's/.*TABLE \(.*\) (/\1/'`
do              
echo ".mode csv\nselect * from $table;" | sqlite3 db/trac.db | psql -c "copy $table from stdin with csv"
done 
```

是的，有点像黑客，但它有效。

# asp.net - 多值参数

> ID：538442
> 
> 赞同：2
> 
> 时间：2009-02-11T19:42:03.283
> 
> 标签：asp.net, reporting-services

我正在开发一个将报告服务报告呈现为 PDF 的 Web 应用程序，我的要求之一是允许在同一个报告中包含多个位置。为了处理这个问题，我创建了一个多值报告参数，它在使用 RS UI 等时似乎可以解决问题。但是，我正在使用 web 服务来报告服务，并且我一生都无法弄清楚如何设置要识别为具有多个值的参数的值。

我尝试将其简单地设置为“LOC1，LOC2”，但它被作为单个值拾取。我也试过“LOC1”+ System.Environment.NewLine +“Loc2”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:47:36.187

如果您愿意在另一端解析它，您可以将其作为逗号分隔的字符串发送。许多语言都有一个 String.Split(",") 风格的方法，你可以使用它。

要么这样，要么您可以构造一个数组（或列表或集合）并将其作为参数传递，尽管这将涉及更改 webservice 方法上的合同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T22:35:35.307

想通了，你必须以相同的名称分别为每个值，片段：

```
 //Register parameters
    ArrayList<ParameterValue> parmValues;

    for(Map.Entry<String,String> entry:reportParams.entrySet()) { 
        //is it multi-value?
        if(entry.getValue().contains(",")) {
            //yes, add multiple ParameterValues under the same name 
            //  with each different value
            for(String mval:entry.getValue().split(",")) {
                ParameterValue pv = new ParameterValue();
                pv.setName(entry.getKey());
                pv.setValue(mval.trim());
                parmValues.add(pv);
            }
        } else {
            //no, just a single value
            ParameterValue pv = new ParameterValue();
            pv.setName(entry.getKey());
            pv.setValue(entry.getValue());
            parmValues.add(pv);
        }
    } 
```

# asp.net - ASP.NET Preload Post Back Event

> ID：538443
> 
> 赞同：1
> 
> 时间：2009-02-11T19:42:05.013
> 
> 标签：asp.net, events, postback, page-lifecycle

Is there any kind of event out there that would allow for a preload post back event.

The reason I ask is I have a control that adds sibling controls to it on postback events, however, by the time it has loaded the post back its too late to add the new control to the control collection. Therefore, the controls are never updated correctly.

Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:43:21.923

Try the Init event.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T19:45:48.500

覆盖`CreateChildControls`（确保调用 base！）。在您的回发事件处理程序中，确保您将应动态创建的控件列表存储在某处，因此当`CreateChildControls`在下一轮生命周期的早期被调用时，它将重新创建在最后一次回发上构建的控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T19:49:43.047

这是一个快速破解。您可以随时查询 __EventTarget 和/或 init 中提交按钮的值，并可以动态加载控件。

但是这样做可能不合适，因为您的控制层次结构会改变并可能导致问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:54:16.450

如上所述，必须在页面 Init 事件期间添加动态控件，以便可以在页面的 Viewstate 中正确处理它们。您可能还想关闭页面的 Viewstate，因为如果控件发生更改，它可能会向您触发错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:56:16.540

[此页面](http://msdn.microsoft.com/en-us/library/ms178472.aspx)解释了回发中的事件顺序（以及每个事件中发生的情况），它不止一次地帮助了我。

我刚刚找到[了这个链接](http://acodingfool.typepad.com/blog/aspnet-application-and-page-life-cycle-cheat-sheet.html)，它也对你有用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T19:57:12.217

如前所述，添加动态控件的适当位置是在 Init 事件中。这是一篇包含更多信息的文章。

[动态 Web 控件、回发和视图状态](http://aspnet.4guysfromrolla.com/articles/092904-1.aspx)

要更好地了解 ASP .NET 页面生命周期，请参阅：

[ASP.NET 页面生命周期概述](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

# c# - How to implement an offline reader writer lock

> ID：538450
> 
> 赞同：2
> 
> 时间：2009-02-11T19:43:37.617
> 
> 标签：c#, database, algorithm, domain-driven-design

Some context for the question

*   All objects in this question are persistent.
*   All requests will be from a Silverlight client talking to an app server via a binary protocol (Hessian) and not WCF.
*   Each user will have a session key (not an ASP.NET session) which will be a string, integer, or GUID (undecided so far).

Some objects might take a long time to edit (30 or more minutes) so we have decided to use pessimistic offline locking. Pessimistic because having to reconcile conflicts would be far too annoying for users, offline because the client is not permanently connected to the server.

Rather than storing session/object locking information in the object itself I have decided that any aggregate root that may have its instances locked should implement an interface ILockable

```
public interface ILockable
{
  Guid LockID { get; }
} 
```

This LockID will be the identity of a "Lock" object which holds the information of which session is locking it.

Now, if this were simple pessimistic locking I'd be able to achieve this very simply (using an incrementing version number on Lock to identify update conflicts), but what I actually need is ReaderWriter pessimistic offline locking.

The reason is that some parts of the application will perform actions that read these complex structures. These include things like

*   Reading a single structure to clone it.
*   Reading multiple structures in order to create a binary file to "publish" the data to an external source.

Read locks will be held for a very short period of time, typically less than a second, although in some circumstances they could be held for about 5 seconds at a guess.

Write locks will mostly be held for a long time as they are mostly held by humans.

There is a high probability of two users trying to edit the same aggregate at the same time, and a high probability of many users needing to temporarily read-lock at the same time too. I'm looking for suggestions as to how I might implement this.

One additional point to make is that if I want to place a write lock and there are some read locks, I would like to "queue" the write lock so that no new read locks are placed. If the read locks are removed withing X seconds then the write lock is obtained, if not then the write lock backs off; no new read-locks would be placed while a write lock is queued.

So far I have this idea

1.  The Lock object will have a version number (int) so I can detect multi-update conflicts, reload, try again.
2.  It will have a string[] for read locks
3.  A string to hold the session ID that has a write lock
4.  A string to hold the queued write lock
5.  Possibly a recursion counter to allow the same session to lock multiple times (for both read and write locks), but not sure about this yet.

Rules:

*   Can't place a read lock if there is a write lock or queued write lock.
*   Can't place a write lock if there is a write lock or queued write lock.
*   If there are no locks at all then a write lock may be placed.
*   If there are read locks then a write lock will be queued instead of a full write lock placed. (If after X time the read locks are not gone the lock backs off, otherwise it is upgraded).
*   Can't queue a write lock for a session that has a read lock.

Can anyone see any problems? Suggest alternatives? Anything? I'd appreciate feedback before deciding on what approach to take.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:53:27.920

您是否考虑过[mvcc](http://en.wikipedia.org/wiki/Multiversion_concurrency_control)实现：

当然，这将更难实现，但似乎比你所解释的要并发得多。只是把想法扔在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T00:41:56.087

（编辑成更多的措辞作为答案，而不是一堆问题）

我也在雅虎 DDD 列表上对此进行了回复，但为了完整起见，也不妨在这里。

您没有明确提到（我可以看到）任何类型的写锁超时。我知道他们将能够被持有很长时间，但有某种超时（即使它带有通知）将是一个谨慎的策略。

除此以外（甚至除此之外），如果您还没有考虑过，您可能需要考虑使用一种手动释放锁的方法 - 取决于系统的用户/角色，可能是某种易于操作的方法- 使用管理界面。

此外，您无疑也想到了这一点，请确保读锁数组是线程安全的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T22:43:08.500

如果您真的想滚动自己的锁定，我会遵循类似于线程锁定的锁定模式，例如在 ReaderWriterLockSlim 中。

[http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx)

# c++ - 使用 Qt 的 QLabel 类更改呈现的 HTML 中的制表位大小

> ID：538476
> 
> 赞同：1
> 
> 时间：2009-02-11T19:51:12.870
> 
> 标签：c++, html, qt, rendering

我在 QT QLabel 中呈现一些 HTML。HTML 如下所示：

```
<pre>foo\tbar</pre> 
```

（请注意，我已将“\t”放在代码中有制表符的位置）。

这渲染得很好，但是制表符似乎被渲染为八个空格，而我希望它被重新渲染为 4。如何在**不更改源 HTML 的情况下更改它**？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T20:00:49.307

根据[W3](http://www.w3.org/TR/html4/struct/text.html#h-9.3.4) (HTML4)：

> 水平制表符（[ISO10646] 和 [ISO88591] 中的十进制 9）通常被视觉用户代理解释为沿每 8 个字符的制表位排列字符所需的最小非零空格数。**我们强烈反对**在预格式化文本中使用水平制表符，因为在编辑时将制表符间距设置为其他值是常见的做法，这会导致文档未对齐。

它本质上是实现定义的。大多数（如果不是全部）浏览器/渲染器使用八个空格作为制表符。这不能在 Qt 中配置。

然而，浏览您的 HTML 并用您希望的任意数量的空格替换选项卡有点微不足道。为此编写一个简单的解析器。伪代码：

```
for each <pre> block {
    for each line in block {
        position_in_line = 0

        for each character in line {
            if character is a tab {
                remove tab character

                do {
                    add a space character

                    ++position_in_line
                } while position_in_line % 8 != 0
            } else {
                ++position_in_line
            }
        }
    }
} 
```

如果您好奇，HTML3 指定使用[八字符制表符](http://www.w3.org/MarkUp/html3/specialchars.html)：

> 在 <PRE> 中，tab 应该被解释为将水平列位置移动到下一个位置，该位置是同一行上 8 的倍数；也就是说，col := (col+8) mod 8。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-05T19:39:32.397

虽然在呈现富文本时在内部`QLabel`使用 a `QTextDocument`，但它不允许在其 API 中访问它。但是，由于`QTextDocument`是 a `QObject`，您可以尝试使用

```
QTextDocument * tl = label->findChild<QTextDocument>(); 
```

访问它（如果`QLabel`创建`QTextDocument`作为自身的（直接或间接）子级将起作用）。

一旦有了指向文本文档的指针，就可以使用`QTextDocument`API，例如`QTextOption::setTabsStop()`，更改制表位。

最后一步是以某种方式使`QLabel`重绘本身。可能调用`QWidget::update()`就足够了，但缓存（或更糟糕的是，重新创建文本文档）可能会阻止这一点。在这种情况下，您可以在标签上注册一个事件侦听器，以在 a 之前调整文本文档`paintEvent()`，但请注意，`sizeHint()`当制表符停止更改时，它也可能会更改，因此可能会更复杂。

也就是说，这就是我解决问题的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T20:55:08.457

试试这个：

```
<pre style="tab-interval:0.5in">foo\tbar</pre> 
```

可以工作

# c - “#if cpp”在C文件中是什么意思？

> ID：538485
> 
> 赞同：2
> 
> 时间：2009-02-11T19:54:22.567
> 
> 标签：c

这些天我正在研究一些源代码。在某些代码中，我发现它们位于开头。不知道是什么意思。有任何想法吗？

```
#include "pth_p.h"

#if cpp

#ifndef PTH_DEBUG

#define pth_debug1(a1)                     /* NOP */
#define pth_debug2(a1, a2)                 /* NOP */
#define pth_debug3(a1, a2, a3)             /* NOP */
#define pth_debug4(a1, a2, a3, a4)         /* NOP */
#define pth_debug5(a1, a2, a3, a4, a5)     /* NOP */
#define pth_debug6(a1, a2, a3, a4, a5, a6) /* NOP */

#else

#define pth_debug1(a1)                     pth_debug(__FILE__, __LINE__, 1, a1)
#define pth_debug2(a1, a2)                 pth_debug(__FILE__, __LINE__, 2, a1, a2)
#define pth_debug3(a1, a2, a3)             pth_debug(__FILE__, __LINE__, 3, a1, a2, a3)
#define pth_debug4(a1, a2, a3, a4)         pth_debug(__FILE__, __LINE__, 4, a1, a2, a3, a4)
#define pth_debug5(a1, a2, a3, a4, a5)     pth_debug(__FILE__, __LINE__, 5, a1, a2, a3, a4, a5)
#define pth_debug6(a1, a2, a3, a4, a5, a6) pth_debug(__FILE__, __LINE__, 6, a1, a2, a3, a4, a5, a6)

#endif /* PTH_DEBUG */

#endif /* cpp */ 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-11T19:55:58.053

它正在测试预处理器（可能是宏）可见的某个名为 cpp 的常量是否非零。

通常的约定是宏应该全部大写以便它们更明显，但它们不必是（显然是这里的情况）。

我的猜测是它代表 c++，如果使用 c++ 编译器，则包含的头文件之一（可能是 pth_p.h？）定义它。如果是这种情况，则可以使用更多标准的东西，例如：

```
#ifdef __cplusplus 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T19:55:55.357

这是允许您在编译时测试表达式的预处理器指令的示例。[这是一个很好的解释。](http://developer.apple.com/DOCUMENTATION/DeveloperTools/gcc-4.0.1/cpp/If.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T20:05:37.157

我怀疑这是在检查代码是由 c++ 编译器还是 ac 编译器编译的。如果是 C++，如果还设置了 PTH_DEBUG 标志，则定义宏。我怀疑这个标志会在对编译器的调用中设置。如果是 C，则未定义宏。为什么会这样取决于 pth_debug 宏打算做什么。

# sharepoint - SharePoint 表单库：以编程方式或 Stsadm 命令将内容类型更改为自定义表单模板

> ID：538501
> 
> 赞同：1
> 
> 时间：2009-02-11T19:59:32.477
> 
> 标签：sharepoint

我有一个包含表单库的自定义站点定义。我在 InfoPath 中创建了一个表单模板。通过 SharePoint 功能，我可以部署所有内容，但我不知道如何更改表单库的默认表单以指向我在 InfoPath 中创建的表单。我有一个功能可以很好地部署表单，但我必须手动进入表单库的高级设置，允许内容类型管理，将默认内容类型更改为模板，并删除默认内容类型。

任何关于如何以编程方式或通过 stsadm 执行此操作的想法将不胜感激！

科尔比非洲

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T20:30:15.567

这是我用来为列表设置内容类型的一些代码。

```
 void AddContentTypes(SPWeb web)
    {
        //get a reference to content types previously installed
        SPContentType CompanyAContentPage = web.AvailableContentTypes["CompanyA Content Page"];
        SPContentType CompanyAWelcomePage = web.AvailableContentTypes["CompanyA Welcome Page"];

        //get list to mess with
        SPList spList = web.Lists["Pages"];

        //enable management of content types
        spList.ContentTypesEnabled = true;

        //get the content types added to the list (different from the web ones)
        SPContentType newCompanyAPageContentType = spList.ContentTypes.Add(CompanyAContentPage);
        SPContentType newCompanyAWelcomePageContentType = spList.ContentTypes.Add(CompanyAWelcomePage);
        //update list
        spList.Update();

        //get a list of content types for the "new" drop down on the list
        List<SPContentType> contentTypeList = new List<SPContentType>();
        contentTypeList.Add(newCompanyAPageContentType);
        contentTypeList.Add(newCompanyAWelcomePageContentType);

        //set the content types for the "new" drop down list
        spList.RootFolder.UniqueContentTypeOrder = contentTypeList;
        spList.RootFolder.Update();
    } 
```

与您的问题不完全相同，但希望对您有所帮助。

# linux - 这种 bash 文件名提取技术的用途？

> ID：538504
> 
> 赞同：9
> 
> 时间：2009-02-11T19:59:52.477
> 
> 标签：linux, bash, shell, operators, filenames

我有一部分 bash 脚本正在获取不带扩展名的文件名，但我试图了解这里到底发生了什么。“%%”是干什么用的？有人可以详细说明 bash 在幕后做什么吗？如何在一般基础上使用这种技术？

```
#!/bin/bash

for src in *.tif
    do
    txt=${src%%.*}
    tesseract ${src} ${txt}
    done 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-11T20:08:37.070

它摆脱了文件扩展名（*这里*: `.tif`），示例：

```
$ for A in test.py test.sh test.xml test.xsl; do echo "$A: ${A%%.*}"; done
test.py: test
test.sh: test
test.xml: test
test.xsl: test 
```

来自 bash 手册：

```
 ${parameter%%word}
          The word is expanded to produce a pattern just as in pathname expansion.  If the
          pattern matches a trailing portion of the expanded value of parameter, then  the
          result  of  the  expansion  is the expanded value of parameter with the shortest
          matching pattern (the ``%'' case) or the longest matching  pattern  (the  ``%%''
          case) deleted.  If parameter is @ or *, the pattern removal operation is applied
          to each positional parameter in turn, and the expansion is the  resultant  list.
          If  parameter  is an array variable subscripted with @ or *, the pattern removal
          operation is applied to each member of the array in turn, and the  expansion  is
          the resultant list. 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T20:10:07.330

这是 bash 手册页的输出

```
 ${parameter%%word}
          The word is expanded to produce a pattern just  as  in  pathname
          expansion.   If  the  pattern  matches a trailing portion of the
          expanded value of parameter, then the result of the expansion is
          the  expanded value of parameter with the shortest matching pat-
          tern (the ``%'' case)  or  the  longest  matching  pattern  (the
          ``%%''  case)  deleted.   If  parameter  is  @ or *, the pattern
          removal operation is applied to  each  positional  parameter  in
          turn,  and the expansion is the resultant list.  If parameter is
          an array variable subscripted with @ or *, the  pattern  removal
          operation  is  applied  to each member of the array in turn, and
          the expansion is the resultant list. 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T20:50:17.657

显然 bash 有几个“**参数扩展**”工具，其中包括：

只需替换值...

```
${parameter} 
```

扩展为子字符串...

```
${parameter:offset}
${parameter:offset:length} 
```

代入参数值的长度...

```
${#parameter} 
```

扩展参数开头的匹配...

```
${parameter#word}
${parameter##word} 
```

扩展参数末尾的匹配...

```
${parameter%word}
${parameter%%word} 
```

扩展参数以查找和替换字符串...

```
${parameter/pattern/string} 
```

这些是我对我认为从手册页的这一部分中理解的部分的解释。如果我错过了重要的事情，请告诉我。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T20:06:27.250

查看 bash 手册页中的“参数扩展”。该语法扩展了 $src 变量，从中删除了与 .* 模式匹配的内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T20:10:41.853

这是一个字符串删除操作，格式如下：`${str%%substr}`

其中 str 是您正在操作的字符串，而 substr 是要匹配的模式。它在 str 中查找 substr 的最长匹配，并从那时起删除所有内容。

# moq - 使用 Moq 回调方法时出现 ParameterMismatch 异常

> ID：538516
> 
> 赞同：2
> 
> 时间：2009-02-11T20:03:32.810
> 
> 标签：moq

我有一个名为 IAuthorizationRepository 的接口，其接口如下：

```
public interface IAuthorizationRepository
{
    IQueryable<User> Users { get; }

    Int32 SaveChanges();

    void Detach(Object entity);
    void Attach(IEntityWithKey entity);

    void DeleteObject(Object entity);
    void AddObject(String entitySetName, Object entity);
} 
```

其中用户定义如下：

```
public class User{
string Username { get; set; }} 
```

我有一个这样的 TestInitialize 方法：

```
 [TestInitialize]
    public void Init()
    {
        _repository = new Mock<IAuthorizationRepository>();

        List<User> users = new List<User>();

        User user = new User();
        user.Username = "test_osness";

        _repository.ExpectGet(r => r.Users).Returns(users.AsQueryable());

        _repository.Expect(r => r.AddObject("Users", It.IsAny<Object>()))
            .Callback<User>(u => users.Add(u));

        _repository.Object.AddObject("Users", user);

        Console.WriteLine("Users: {0}", _repository.Object.Users.Count());
    } 
```

但是当我运行测试时，我在调用 _repository.Object.AddObject("Users", user) 的行上得到一个 System.Reflection.TargetParameterCountException。我是 Moq 的新手，但据我所知，这应该可行。我究竟做错了什么。我想在调用 AddObject("Users" , Object) 时将用户对象添加到我的列表中。所以 _repository.Object.Users.Count() 应该反映正确的用户数量。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:41:04.150

我将覆盖我之前的答案。

这一行：

```
_repository.Expect(r => r.AddObject("Users", It.IsAny<Object>()))
    .Callback<User>(u => users.Add(u)); 
```

正在寻求调用带有单个参数的 .Callback() 版本。但是，您期望的“AddObject”方法需要两个参数。我认为你需要更多这样的东西：

```
_repository.Expect(r => r.AddObject("Users", It.IsAny<Object>()))
    .Callback((s, o) => users.Add(o as User)); 
```

现在 Callback lambda 采用与您预期相同数量的参数，因此它应该可以工作。

# php - 谷歌应用引擎的 PHP 支持？

> ID：538524
> 
> 赞同：0
> 
> 时间：2009-02-11T20:06:30.633
> 
> 标签：php, google-app-engine

有人知道[Google App](http://code.google.com/appengine/)引擎何时支持 PHP 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:09:55.973

地狱何时结冰？=) 不。但我认为只有 Google 知道 Google App Engine 的下一步是什么。谷歌，也许还有一些围绕候选项目的关键开发人员。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T20:18:33.847

我相信这是在 Google AeroPork 推出之后进行的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T20:23:59.030

是的。谷歌知道。
这个问题应该提交给项目的[讨论组](http://code.google.com/appengine/groups.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T20:24:33.270

如果您查看最新的[路线图](http://code.google.com/appengine/docs/roadmap.html)，您会发现他们确实在开发新的语言运行时。但是，我非常怀疑它会是 PHP。似乎网上的人们[期望它是 Java](http://www.controlenter.in/2008/10/java-support-to-appengine-to-counter-microsofts-cloud-initiatives-microsoft-strata/)，但直到 2009 年 6 月（如果一切顺利）我们只需要推测。

# c# - 如何通过反射获取接口基类型？

> ID：538541
> 
> 赞同：27
> 
> 时间：2009-02-11T20:11:29.730
> 
> 标签：c#, reflection, interface

```
public interface IBar {} 
public interface IFoo : IBar {}

typeof(IFoo).BaseType == null 
```

如何获得 IBar？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-11T20:14:20.877

```
Type[] types = typeof(IFoo).GetInterfaces(); 
```

编辑：如果你特别想要 IBar，你可以这样做：

```
Type type = typeof(IFoo).GetInterface("IBar"); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-11T20:20:39.943

接口不是基本类型。接口不是继承树的一部分。

要访问接口列表，您可以使用：

```
typeof(IFoo).GetInterfaces() 
```

或者如果您知道接口名称：

```
typeof(IFoo).GetInterface("IBar") 
```

如果您只想知道一个类型是否与另一种类型隐式兼容（我怀疑这是您正在寻找的），请使用 type.IsAssignableFrom(fromType)。这等效于 'is' 关键字，但具有运行时类型。

例子：

```
if(foo is IBar) {
    // ...
} 
```

相当于：

```
if(typeof(IBar).IsAssignableFrom(foo.GetType())) {
    // ...
} 
```

但就您而言，您可能对以下内容更感兴趣：

```
if(typeof(IBar).IsAssignableFrom(typeof(IFoo))) {
    // ...
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T20:25:24.003

除了其他发帖人写的，你可以从GetInterface() 列表中获取第一个接口（如果列表不为空）来获取IFoo 的直接父级。这将与您的 .BaseType 尝试完全相同。

# svn - 使用 CVS 或 Subversion 作为办公文档备份框架的提示

> ID：538543
> 
> 赞同：3
> 
> 时间：2009-02-11T20:11:51.350
> 
> 标签：svn, backup, cvs

长期以来，我一直在使用 subversion（以及在此之前的 CVS）来存储源文件，以及后来的 LaTeX 文件以供我研究，并最终存储一些 word 文件和其他材料。

我喜欢这样一个事实，即我可以使用多台计算机并同步每台计算机的最新内容，同时仍然能够维护我的备份和项目的某些层次结构。

我敢肯定我不能是唯一一个这样做的人。

我现在正在考虑使用 CVS 或 subversion 作为家庭计算机的主要备份机制，其中包含许多经常更改的办公文档。这是一个好/坏主意吗？我能想到的主要问题是文件被认为是二进制文件，因此服务器会有点膨胀。

但是，我想听听我应该注意或注意的其他事情。

此外，我在哪里可以找到可以自动签入的脚本的好示例？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-11T20:20:16.107

实际上，我真的不建议这样做，因为之前已经走这条路了。首先，我认为不用说，如果您使用 SCM 存储库来执行此类任务，请*使用 SVN 而不是 CVS！* 在这种情况下，几乎可以保证您将存储二进制数据，这对于 CVS 来说是一个巨大的痛苦。

无论如何，我以前自己在 SVN 存储库中存储了很多与编程无关的东西，但现在只使用时间机器来备份我关心的文件，以及用于我的点文件等的基于 Web 的小型存储库。我认为阻碍的关键是您对普通数据文件的态度与对源代码的态度不同。在大多数情况下，您不太可能对区分您编写的报告的两个版本感兴趣，或者将您的工作副本版本恢复为您两周前编写的某个草稿。对于此类文档，您通常只关心最新版本，而 SCM 提供的工具和安全性在这方面往往更烦人而不是有用，尤其是在签入评论、合并等方面。

另外，我强烈不推荐（这是一个词吗？；））让非程序员使用 SCM。所需的解释量太大，以至于该工具对他们没有好处，尤其是在应用于该工具原本不打算用于的任务时。我已经在一些我们*认为*不会有问题的环境中这样做了，因为所讨论的人并不愚蠢，而且他们正在处理与软件相关的工件。但不可避免地合并冲突和其他 SCM 的“陷阱”导致混乱，并最终在晚上给我打电话。

我会说你应该研究像 Sharepoint 这样的文档共享门户，用于协作办公文档等。它们更适合处理这些类型的事情，而不会给非技术人员带来很多麻烦，并且可以优雅地处理版本历史、二进制数据等。这对你的家人来说可能有点矫枉过正，但设置一个小门户保存重要数据应该不是什么大问题——你只需要环顾四周，找到适合你需要的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T20:26:06.527

您应该调查 subversion 的 Autoversioning 选项。例如，它允许您设置任何计算机都可以看到和写入的网络共享，但它会在写入数据时自动执行必要的提交操作。如果有人不小心删除了他们的文档，可以使用 subversion 命令恢复。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T20:48:51.230

我使用 Mercurial 来保存办公文件。它可以满足我的一切需求 -

1.  跟踪旧版本。
2.  防范灾难。由于 Mercurial 是一个分布式版本控制系统 (DVCS)，我在我的工作机器、笔记本电脑、其他笔记本电脑和家用机器上都有一个存储库。
3.  允许“离线”提交，因为它是 DVCS。
4.  显示更改的简单 Web 界面

... 以及更多。它所做的大部分工作对我作为一名程序员很有用，但它也使事情变得足够简单，便于文档管理。

哦，还有一个主要好处 - 在 Mac 上，许多“文档”实际上是包含一堆文件的文件夹。使用 SVN，您会很快将这些文件夹与应用程序删除但 SVN 想要保留的文件混在一起。使用 Mercurial，当您删除一个文件时，该修订版会被“删除”，但如果您签出以前的修订版，它又会回来！Mac 应用程序的完美解决方案！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T20:14:21.797

其实这不是一个坏主意。Subversion 使用 xdelta 来存储二进制文档中的差异，因此服务器不会因不同版本而过载。

至于脚本，进入机器时只需 svn update，离开时别忘了做 svn commit。多年来，我一直在为自己的数据这样做，一点问题都没有。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-25T03:53:59.917

[http://wiki.documentfoundation.org/Libreoffice_and_subversion](http://wiki.documentfoundation.org/Libreoffice_and_subversion)

关键似乎是使用 .fodt 而不是 .odt 格式。Sans 压缩传统的差异，补丁系统运行良好，无需将所有文档视为二进制文件！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T20:23:21.823

是和不是。

假设您正确使用版本控制（CVS 或任何其他系统），这是跟踪文件旧版本的好方法，并且您更有可能在进行某些特定更改之前或之后找到该文件版本如果你有它。

然而，版本控制并不能保护您免受灾难的影响，例如数据的实际丢失（电涌将您的机器及其所有磁盘都吞噬了）。所以你需要定期将你的存储库备份到一些安全的媒体上。根据它的重要性，只需将其写入 CD/DVD 和存储在其他地方的另一个移动磁盘就足够了。

此外，您的版本控制存储库可能会发生不好的事情。由于版本控制软件中的错误、崩溃、冲突等，它的一部分可能会损坏。更糟糕的是，您可能直到有一天发现某些版本无法恢复时才真正注意到它。所以在备份之前有一些程序来检查你的存储库的一致性。并且不要一次覆盖所有备份。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T20:18:37.140

为什么不为您的文档使用备份工具？如果您不需要修订并且只需要最新的，那么备份工具/计划备份可能是最好的。

如果您想进行修订，请继续执行您的计划。在这种情况下，我唯一可以建议的是一个计划任务，它在所有文件的根目录下进行提交。提交注释可以是“自动提交 [日期/时间]”，我将为这些任务使用不同的用户名。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T20:21:07.303

我尝试在国内的 NAS 驱动器上使用 TortoiseSVN，但它不起作用 - 我认为是因为磁盘是 FAT32。我在家中使用[*SyncBack*](http://www.2brightsparks.com/freeware/freeware-hub.html)来维护我的文件的多个副本，因为我不关心维护修订历史。

# java - 各种 Java Web 表示层技术的优缺点

> ID：538550
> 
> 赞同：16
> 
> 时间：2009-02-11T20:13:43.530
> 
> 标签：java, jakarta-ee, presentation-layer

我目前正在开发一个大量使用 JSF 和 IceFaces 的网络应用程序。我们已经讨论过转移到另一个表示层，我想我会把讨论带到 SO 中，看看专家们是怎么想的。

我很好奇是否有人可以权衡各种 Java 表示层技术的优缺点。如果您只与一个人合作过，请说出您喜欢或讨厌它的原因。如果你和几个人一起工作过，请给出你对它们如何相互叠加的印象。

我们正在考虑的技术是：

*   冰面
*   JSF（没有 IceFaces）
*   GWT（谷歌网络工具包）
*   便门
*   挂毯

如果我的清单中缺少任何内容，请告诉我。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T12:41:07.760

我的观点对 Wicket 有很大的偏见，因为在多次绊倒 JSP 矿井之后，我已经使用了一段时间。

**检票口优点：**

*   布局和代码的真正分离。
*   基于组件，这意味着站点元素的高度可重用性；例如，您可以创建具有自动标签和 CSS 样式以及所有内容的美化表单，并且只需在组件的构造函数中更改它的 DAO 对象，它就可以在另一个项目中完全重用。
*   对 Ajax、Portlet 和各种框架等东西的出色支持通常直接开箱即用，更重要的是它不依赖 slf4j/log4j 以外的任何东西来工作，一切都是可选的！

**检票口缺点：**

*   总体而言，开发对事物有些困惑，尽管在 1.4 中对它们进行了很多清理，但 Wicket 泛型现在有点混乱
*   某些组件（如`Form.onSubmit()`）需要大量的子类化或匿名方法覆盖，以便轻松注入行为。这部分归功于 Wicket 强大的基于事件的设计，但不幸的是，这也意味着 Wicket 很容易使代码混乱。

**随机缺点：（**也就是说，我没有使用过，但这些是我的意见和/或我听说过的事情）

*   GWT 是基于 JavaScript 的，这对我来说听起来很愚蠢。主要问题是它让我想起了太多的 JSP:s 及其自动生成的类，这太可怕了。
*   Tapestry 没有以可以在两者之间轻松验证的方式正确分离标记和代码，这将在未来引起问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-11T20:21:48.987

我已经将 GWT 用于几个小项目。这里有一些我喜欢它的地方：

1.  默认情况下它是ajax，所以我不必*让它*做ajax，它只是伴随着使用GWT。
2.  它很好地将客户端代码与服务器端代码分开。
3.  我可以使用 junit 对我的客户端代码进行单元测试
4.  它可以让您构建清晰、快速的应用程序，主要是因为它是 ajax。

我不喜欢的东西：

1.  有些事情没有按预期工作。例如，我见过点击事件没有按预期触发的情况，所以我不得不做一个解决方法。
2.  自动部署到在 Eclipse 中运行的 tomcat 有时会停止工作，我永远无法弄清楚为什么。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T20:25:20.227

我要问的最大问题是为什么要更改表示层？这是一个非常昂贵的成本，我可以看到一种技术的好处超过了其他技术的成本，就像改变的成本一样......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T08:34:27.230

简而言之：

= JSF =

优点：

*   组件架构；
*   许多库和工具；
*   有点好的IDE支持

缺点：

*   重量级，在 CPU/内存**和**学习曲线方面；
*   当某些事情没有按预期工作时，很难调试

= 检票口 =

优点：

*   轻的;
*   合理的模板系统；
*   很好的教程；

缺点：

*   参考文档的组织和深度不如教程；
*   开发团队遇到了一些严重的困难，特别是在成为和孵化项目时。这导致了对框架的重要方面的混淆，当时我不得不切换到另一个框架，因为这个......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T21:54:15.817

[条纹](http://www.stripesframework.org)呢？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T07:07:56.930

我的选择是**Wicket**。已经使用过它，并且具有出色的可重用性。它拥有最活跃的论坛/邮件列表之一。作为一个问题，它会在几分钟内得到回答。它对 AJAX 有很好的支持。归因于 Wicket 的常见缺点之一是陡峭的学习曲线。好吧，这些是现在不再有价值的老年弊端之一。

JSF：最好远离它。另一个在 JSF 上开发项目的团队现在正在考虑在我们成功后转向 Wicket。

@Megadix：就像你说的文档一开始很差，但现在没有了。Wicket 的开发人员编写了一本名为 Wicket in Action 的优秀书籍。网站上提供的示例代码也是一个很好的开始和学习的地方

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T21:14:39.500

我想知道您是否有一个与 Web 客户端不同的服务层，Web 控制器只需调用它来完成他们的工作。

如果这样做，Web UI 技术的选择可以与后端解耦。如果它作为合同优先的 Web 服务公开，您可以让不同的应用程序共享它。只要您的客户可以发送和接收 XML，他们就可以与您的服务进行交互。想要切换到 Flex？不用担心 - 将它指向服务并呈现 XML 响应。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-15T14:40:13.767

请参阅我对 Wicket 和 Tapestry 5 的比较：[Apache Tapestry 和 Apache Wicket 之间的区别](https://stackoverflow.com/questions/657352/difference-between-apache-tapestry-and-apache-wicket/658177#658177)。

# python - 在 Python 中处理非常大的数字

> ID：538551
> 
> 赞同：164
> 
> 时间：2009-02-11T20:13:45.560
> 
> 标签：python, optimization, largenumber

我一直在考虑用 Python 进行快速扑克手评估。我突然想到，加快处理速度的一种方法是将所有牌面和花色表示为素数，然后将它们相乘以表示手牌。到白衣：

```
class PokerCard:
    faces = '23456789TJQKA'
    suits = 'cdhs'
    facePrimes = [11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 53, 59, 61]
    suitPrimes = [2, 3, 5, 7] 
```

和

```
 def HashVal(self):
      return PokerCard.facePrimes[self.cardFace] * PokerCard.suitPrimes[self.cardSuit] 
```

这将为每手牌提供一个数值，通过模数可以告诉我手中有多少国王或多少红心。例如，任何有五个或更多梅花的手牌都会被 2^5 平分；任何有四个 K 的手牌都会被 59^4 平分，以此类推。

问题是像 AcAdAhAsKdKhKs 这样的七张牌的散列值大约为 62.7 万亿，这将需要远远超过 32 位来表示内部。有没有办法在 Python 中存储如此大的数字，让我可以对其执行算术运算？

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2009-02-11T20:19:45.403

Python 支持“bignum”整数类型，它可以处理任意大的数字。在 Python 2.5+ 中，这个类型被调用`long`并且与类型分开`int`，但是解释器会自动使用更合适的那个。在 Python 3.0+ 中，该`int`类型已被完全删除。

不过，这只是一个实现细节——只要您拥有 2.5 或更高版本，只需执行标准数学运算，任何超出 32 位数学边界的数字都将自动（且透明地）转换为 bignum。

[你可以在PEP 0237](http://www.python.org/dev/peps/pep-0237)中找到所有血淋淋的细节。

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2014-01-07T19:50:08.040

python自然地支持***任意***大的***整数：***

例子：

```
>>> 10**1000
10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 
```

例如，您甚至可以获得一个巨大的整数值 fib(4000000)。

但它仍然**不**（目前）支持任意大的**浮动**！

如果你需要一个大的，大的，浮动然后检查十进制模块。这些论坛上有一些使用示例：[OverflowError: (34, 'Result too large')](https://stackoverflow.com/questions/20201706/overflowerror-34-result-too-large)

另一个参考：[http ://docs.python.org/2/library/decimal.html](http://docs.python.org/2/library/decimal.html)

如果您需要加速（这可能是您感兴趣的），您甚至可以使用 gmpy 模块：[处理代码中的大数字](https://stackoverflow.com/questions/1386604/handling-big-numbers-in-code)

另一个参考：[https ://code.google.com/p/gmpy/](https://code.google.com/p/gmpy/)

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-02-11T21:07:15.947

您可以这样做是为了好玩，但除此之外，这不是一个好主意。它不会加快我能想到的任何事情。

*   拿到手中的牌将是一个整数分解操作，它比仅仅访问一个数组要昂贵得多。

*   添加卡片将是乘法和删除卡片除法，两者都是大型多字数字，这比从列表中添加或删除元素更昂贵。

*   一手牌的实际数值不会告诉你什么。您将需要考虑素数并遵循扑克规则来比较两只手。对于这样的手，h1 < h2 没有任何意义。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2009-02-11T20:18:04.097

python 自然地支持任意大的整数：

```
In [1]: 59**3*61**4*2*3*5*7*3*5*7
Out[1]: 62702371781194950
In [2]: _ % 61**4
Out[2]: 0 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2019-11-11T23:36:10.473

python解释器会为你处理它，你只需要做你的操作（+、-、*、/），它就会正常工作。

`int`价值是无限的。

做除法时要小心，默认情况下商会变成`float`，但`float`不支持这么大的数字。如果您收到一条错误消息说不`float`支持如此大的数字，则意味着商太大而无法存储，`float`您必须使用地板除法 ( `//`)。

它忽略小数点后的任何小数，这样，结果将是`int`，所以你可以得到一个大数字的结果。

```
>>>10//3
3

>>>10//4
2 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-26T05:46:50.477

我知道这个问题很古老，但只是为了未来的人们......你*为什么*要这样做？如果您坚持将手存储为单个编码值而不是字典或列表，请使用位串而不是素数的乘积。乘法和素数因式分解很*慢*。将每张卡片编码为 2 的幂（1、2、4、8、16 等）。您可以添加一张手牌|=手牌。如果手牌和牌张 > 0，您可以检查牌。

# c++ - 获取 char* 缓冲区中的第一个字节

> ID：538560
> 
> 赞同：6
> 
> 时间：2009-02-11T20:15:45.943
> 
> 标签：c++, c

我有一个 char* 缓冲区，我有兴趣查看 char* 缓冲区中的第一个字节，什么是最优化的方法。

编辑：基于反对票，我可能想解释为什么这个问题，我知道方法，但是在我一直在寻找的代码库中，人们会做各种疯狂的事情，比如复制缓冲区，将其复制到流中，然后执行获取。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-11T20:17:16.767

只需使用

```
char firstByte = buffer[0]; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-11T20:19:13.080

或这个：

```
char firstByte = *buffer; 
```

`*buffer`为了澄清起见， and之间没有区别`buffer[0]`，因为后者实际上只是 的简写`*(buffer + 0*sizeof(char))`，并且任何编译器都足够聪明，可以用`*(buffer+0)`then替换它`*buffer`。因此，选择实际上是在您使用它的上下文中最清楚的那个，而不是每个选项的效率。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-11T20:20:31.003

```
char *buffer = {'h','e','l','l','o','\0'}; 
```

或者：

```
char *buffer = "hello"; 
```

或者：

```
char buffer[6] = {'h','e','l','l','o','\0'}; 
```

并获取第一个字节：

```
char firstChar = buffer[0]; 
```

或者：

```
char firstChar = *buffer; // since the buffer pointer points to the first element in the array 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T20:23:21.793

如果您决心进行微优化，您应该知道在这个千年中制造的每个编译器都应该为“c = *buffer”和“c = buffer[0]”生成完全相同的机器代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T20:20:19.163

```
char first = someCharPtr[0]; 
```

或者

```
char first = *someCharPtr; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T20:57:12.333

正如对几个人提到的内容的澄清 - 即：

```
buffer[0] 
```

相当于

```
*(buffer + 0*sizeof(char)) 
```

如果您假设那是文字 C 代码（即不是伪代码），这在技术上是不正确的，尽管这就是编译器正在为您做的事情。

因为指针运算，当你将一个整数加到一个指针上时，它会自动乘以`sizeof(*pointer)`，所以它真的应该是：

```
*(buffer + 0) 
```

虽然，因为`sizeof(char)`定义为 1，但在这种情况下它实际上是等价的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T20:17:31.383

```
char* c_ptr;
char first_char;

first_char = c_ptr[0]; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T20:32:41.240

适用于 x86 平台...

```
char firstByte;

__asm {
   mov al, [buffer]
   mov [firstByte], al
} 
```

# c# - 您可以从 WCF 通道堆栈中获取服务方法的名称吗？

> ID：538564
> 
> 赞同：0
> 
> 时间：2009-02-11T20:16:56.347
> 
> 标签：c#, .net, wcf, web-services

编写自定义通道时，如何获取将被调用的服务方法的名称。

例如，如果操作合约如下所示，我如何知道是否`Method1`或`Method2`正在被调用？

```
[OperationContract]
void Method1( int data );

[OperationContract]
void Method2( int data ); 
```

通道本身并没有对 Message 执行任何主要功能，它只是添加了一些额外的数据。我正在寻找的是根据被调用的方法（或者更具体地说，如果它被某些东西装饰）来自定义添加到通道中的额外数据。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T20:34:27.257

如果您正在创建传输通道，那么这完全取决于您。您有责任接收传入的字节并将其转换为一条消息，然后将其推送到通道堆栈中。

如果您正在创建协议通道，您可以访问 OperationContext（它应该在那时设置）并检查 IncomingMessageHeaders 属性并获取操作标头。这是用于映射到 OperationContract 的内容。

你到底想在这里做什么，你想在什么时候做？您想创建什么样的频道？您的问题没有足够的信息来真正给出答案。

# c# - 对数据源为 oracle db 的 gridview 中的列进行排序

> ID：538570
> 
> 赞同：1
> 
> 时间：2009-02-11T20:17:54.130
> 
> 标签：c#, asp.net, gridview, sorting

谁能告诉函数在 c#asp.net 中对 gridview 的列进行排序。

gridview 数据绑定到 oracle 数据库。我想单击列的标题对数据进行排序。我不知道如何引用标题本身是使用 gridview_sorting 方法的 sender 参数吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:41:06.850

在 gridview 控件中将 AllowSorting 属性设置为 true

```
<asp:GridView runat="server" ID="gvItems" AllowSorting="true" ...> 
```

在要排序的列的 HeaderTemplate 中，将 SortExpression 属性设置为模板绑定到的字段，如果您不使用 HeaderTemplate 并使用 BoundField，则还应该有 SortExpression 属性

```
<asp:TemplateField SortExpression="ItemDescription" HeaderText="Item">... 
```

实现 OnSorting 方法

在 OnSorting 内部使用第二个参数 (GridViewSortEventArgs) 来了解排序表达式是什么并重新绑定您的 gridview

```
protected void gv_Sorting(object sender, GridViewSortEventArgs e)
{
     string fieldToSortOn = e.SortExpression;

     //implement sort logic on datasource...
} 
```

这应该给你一个好的开始

# asp.net-mvc - 是否有官方的 ASP.NET MVC 参考/示例应用程序？

> ID：538574
> 
> 赞同：6
> 
> 时间：2009-02-11T20:18:17.357
> 
> 标签：asp.net-mvc

我正在努力为 ASP.NET MVC 找到一个好的参考应用程序。通过“参考”，我特指以 Microsoft 认可的方式扩展框架的所有功能的应用程序，例如：

*   母版页
*   部分视图
*   强类型模型
*   验证
*   自定义路线
*   ETC...

那里的开源示例（[CodeCampServer](http://code.google.com/p/codecampserver/)、[SutekiShop](http://code.google.com/p/sutekishop/)）要么显着增加了基础框架，要么不使用所有内置功能。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T20:23:03.587

您看过 Rob Connery 的 MVC Storefront 网络广播系列吗？

[http://www.asp.net/learn/mvc-videos/#MVCStorefrontStarterKit](http://www.asp.net/learn/mvc-videos/#MVCStorefrontStarterKit)

源代码：

[http://www.codeplex.com/mvcsamples/](http://www.codeplex.com/mvcsamples/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T20:32:52.860

我在这里问了或多或少相同的问题：[哪些项目是 ASP.NET MVC 的最佳实践示例？](https://stackoverflow.com/questions/499319/what-are-some-projects-which-are-examples-of-best-pratices-for-asp-net-mvc)

至于官方，最接近的是提到的 Rob Connery。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T23:10:47.100

这不是官方的，但您可以查看 Kigg： http: [//www.codeplex.com/Kigg](http://www.codeplex.com/Kigg)

这是一个相当大的 Asp.net MVC Digg 克隆，其中包含一些不错的代码。在[dotnetshoutout.com上使用](http://dotnetshoutout.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-29T18:40:01.050

我会考虑 Nerd Dinner MVC 参考应用程序：http: [//nerddinner.codeplex.com/](http://nerddinner.codeplex.com/)对于刚开始的人

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-10T13:49:15.207

虽然这可能有点晚了，但我相信 ASP.net 团队希望人们开始使用[MVC 音乐商店](http://www.asp.net/mvc/tutorials/mvc-music-store-part-1)作为官方 mvc 参考示例。Music Store 应用程序使用 Razor 视图引擎和 Entity Framework 的代码优先方法（也演示了数据库优先）以及依赖注入、测试驱动开发、jQuery 集成以及获取和使用 NuGet 包的示例。

第二个参考示例似乎更接近事物的前沿，由 Patterns and Practices 人员提供。这称为[Silk 项目](http://silk.codeplex.com/)，它利用 HTML5、CSS3 和 ECMAScript 5 等最新 Web 标准以及 jQuery、Internet Explorer 9 和 ASP.NET MVC3 等现代 Web 技术。

这些一起可能会向您展示最新的 ASP.net MVC 开发以及一些非常简洁的想法和示例。

# c# - Java 和 C# 正则表达式是否兼容？

> ID：538579
> 
> 赞同：45
> 
> 时间：2009-02-11T20:18:50.087
> 
> 标签：c#, java, .net, regex

两种语言都声称使用 Perl 风格的正则表达式。如果我让一种语言测试正则表达式的有效性，它会在另一种语言中工作吗？正则表达式语法在哪里不同？

这里的用例是一个 C# (.NET) UI 与最终的 Java 后端实现对话，后者将使用正则表达式来匹配数据。

请注意，我只需要担心匹配，而不是提取匹配数据的部分。

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2009-02-13T09:36:20.583

有很多（很多）差异。

### 字符类

1.  字符类减法`[abc-[cde]]`
    *   .NET**是 (2.0)**
    *   Java：通过字符类交集和否定模拟`[abc&&[^cde]]`：）
2.  字符类交集`[abc&&[cde]]`
    *   .NET：通过字符类减法和否定来模拟`[abc-[^cde]]`：）
    *   是**的**
3.  `\p{Alpha}`POSIX 字符类
    *   .NET**没有**
    *   Java**是 (US-ASCII)**
4.  在`(?x)`模式^([`COMMENTS`](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#COMMENTS)/[`IgnorePatternWhitespace`](http://msdn.microsoft.com/en-us/library/yd1hzczs%28v=vs.110%29.aspx))下，字符类中的空格（U+0020）是*显着*的。
    *   .NET**是的**
    *   爪哇**没有**
5.  [Unicode 类别](http://en.wikipedia.org/wiki/Unicode_character_property#General_Category)（L、M、N、P、S、Z、C）
    *   .NET **YES**：`\p{L}`仅表单
    *   是**的**：
        *   从 Java 5: `\pL`, `\p{L}`,`\p{IsL}`
        *   从 Java 7: `\p{general_category=L}`,`\p{gc=L}`
6.  [Unicode 类别](http://en.wikipedia.org/wiki/Unicode_character_property#General_Category)（Lu、Ll、Lt、...）
    *   .NET **YES**：`\p{Lu}`仅表单
    *   是**的**：
        *   从 Java 5: `\p{Lu}`,`\p{IsLu}`
        *   从 Java 7: `\p{general_category=Lu}`,`\p{gc=Lu}`
7.  [统一码块](http://en.wikipedia.org/wiki/Unicode_block)
    *   .NET**是**：`\p{IsBasicLatin}`仅。（[支持的命名块](http://msdn.microsoft.com/en-us/library/20bw873z%28v=vs.110%29.aspx#SupportedNamedBlocks)）
    *   Java **YES**：（块的名称是自由大小写的）
        *   从 Java 5 开始：`\p{InBasicLatin}`
        *   从 Java 7: `\p{block=BasicLatin}`,`\p{blk=BasicLatin}`
8.  所有长块名称中都允许有空格和下划线（例如`BasicLatin`可以写成`Basic_Latin`or `Basic Latin`）
    *   .NET**没有**
    *   Java**是**（Java 5）

### 量词

1.  `?+`, `*+`, `++`and `{m,n}+`(占有量词)
    *   .NET**没有**
    *   是**的**

### 引述

1.  `\Q...\E`转义一串元字符
    *   .NET**没有**
    *   是**的**
2.  `\Q...\E`转义一串字符类元字符（在字符集中）
    *   .NET**没有**
    *   是**的**

### 匹配构造

1.  条件匹配`(?(?=regex)then|else)`, `(?(regex)then|else)`,`(?(1)then|else)`或`(?(group)then|else)`
    *   .NET**是的**
    *   爪哇**没有**
2.  命名捕获组和命名反向引用
    *   .NET**是的**：
        *   捕获组：`(?<name>regex)`或`(?'name'regex)`
        *   反向引用：`\k<name>`或`\k'name'`
    *   Java**是**（[Java 7](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#group(java.lang.String))）：
        *   捕获组：`(?<name>regex)`
        *   反向引用：`\k<name>`
3.  多个捕获组可以具有相同的名称
    *   .NET**是的**
    *   Java **NO** (Java 7)
4.  平衡组定义`(?<name1-name2>regex)`或`(?'name1-name2'subexpression)`
    *   .NET**是的**
    *   爪哇**没有**

### 断言

1.  `(?<=text)`（正面回看）
    *   .NET**可变宽度**
    *   Java**明显宽度**
2.  `(?<!text)`（消极的后视）
    *   .NET**可变宽度**
    *   Java**明显宽度**

### 模式选项/标志

1.  [`ExplicitCapture`](http://msdn.microsoft.com/en-us/library/yd1hzczs%28v=vs.110%29.aspx)选项`(?n)`
    *   .NET**是的**
    *   爪哇**没有**

### 各种各样的

1.  `(?#comment)`内联评论
    *   .NET**是的**
    *   爪哇**没有**

### 参考

*   [regular-expressions.info - 不同正则表达式风格的比较](http://www.regular-expressions.info/refflavors.html)
*   [MSDN 库参考 - .NET Framework 4.5 - 正则表达式语言](http://msdn.microsoft.com/en-us/library/az24scfc(v=vs.110).aspx)
*   [模式（Java 平台 SE 7）](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:27:49.423

查看：[http](http://www.regular-expressions.info/refflavors.html) ://www.regular-expressions.info/refflavors.html 该网站上有大量正则表达式信息，并且有一个很好的图表详细说明了 java 和 .net 之间的差异。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-11T20:20:57.180

c# regex 对命名组有自己的约定`(?<name>)`。我不知道任何其他差异。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T20:35:33.323

.NET Regex 支持计数，因此您可以匹配嵌套括号，这通常是您无法使用正则表达式执行的操作。根据 Mastering Regular Expressions，这是为数不多的实现之一，所以这可能会有所不同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-11T20:49:40.370

Java 使用标准 Perl 类型的正则表达式以及 POSIX 正则表达式。查看有关正则表达式的 C# 文档，看起来 Java 具有所有 C# 正则表达式语法，但反之则不然。

自己比较一下：[Java](http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html)： [C#：](http://msdn.microsoft.com/en-us/library/1400241x.aspx)

**编辑：** [目前，没有其他正则表达式支持微软的命名捕获版本。](http://www.regular-expressions.info/named.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-03-01T07:08:52.310

根据我的经验：

**Java 7 正则表达式与 .NET 2.0 正则表达式相比：**

*   不支持组名中的下划线符号

*   不支持具有相同名称（在相同正则表达式中）的组（尽管它在使用“或”的表达式中可能非常有用！）

*   没有捕获任何内容的组具有空字符串的值`null`而不是*空字符串*

*   索引为 0 的组还包含整个匹配项（与 .NET 中相同）但不包含在`groupCount()`

*   *替换表达式中的组反向引用*也用美元符号（例如 $1）表示，但如果相同的表达式包含美元符号作为行尾标记 - 那么反向引用美元应该被转义（\$），否则在 Java我们得到“非法组引用”错误

*   行尾符号 ($) 表现为贪婪。例如，考虑以下表达式（给出 Java 字符串）：“bla(bla(?:$|\r\n))+)?$”。此处不会捕获最后一行文本！要捕获它，我们必须将“$”替换为“\z”。

*   没有“显式捕获”模式。

*   空字符串不满足 ^.{0}$ 模式。

*   符号“-”在方括号内使用时必须转义。也就是说，模式“[a-z++-]+”在 Java 中不匹配字符串“f+gh”，但在 .NET 中匹配。为了在 Java 中匹配，模式应该看起来像（Java-string is given）：“[a-z+\-]+”。

注意：“（Java-string is given）”——只是为了解释表达式中的双重转义。

# java - 是否可以在 java 中使用 xpath 来获取包含 HTML 的 cdata 节点的内容

> ID：538581
> 
> 赞同：0
> 
> 时间：2009-02-11T20:19:13.097
> 
> 标签：java, xpath

例子...

```
<xml>
<level1>
<level2>
<![CDATA[ Release Date: 11/20/09 <br />View Trailer ]]>
</level2>
</level1>
</xml> 
```

当我使用 inFeed.getXpath().evaluate("xml/level1/level2", myNodeList);

我收到“发布日期：2009 年 11 月 20 日查看预告片”

我的印象是，CDATA 的全部意义在于它保留了你想扔在那里的任何胡言乱语。我是否使用了错误的 xpath 表达式？还是只是接近这一切都是错误的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T20:45:05.313

不知道我在做什么与你不同，但对我来说

```
public class XpathFun
{
    public static void main(String[] args) throws Exception
    {
        String xml = "<xml><level1><level2><![CDATA[ Release Date: 11/20/09 <br />View Trailer ]]></level2></level1></xml>";
        InputSource inputSource = new InputSource(new ByteArrayInputStream(xml.getBytes()));
        System.out.println(XPathFactory.newInstance().newXPath().evaluate("xml/level1/level2", inputSource));
    }
} 
```

结果是：

```
Release Date: 11/20/09 <br />View Trailer 
```

# .net - SQL Server 报告服务定价

> ID：538594
> 
> 赞同：1
> 
> 时间：2009-02-11T20:22:24.680
> 
> 标签：.net, sql, reporting-services, reporting, service

我正在尝试了解客户将报告服务报告部署到网络的定价要求。他们是否必须购买任何类型的特殊报表服务器许可证才能部署报表，或者是否包含在 SQL 2005 的标准版本中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:46:45.917

我不熟悉 MS Licensing，但我假设它是最小的，如果不是免费的话。我假设这是因为[带有高级工具的 MS SQL Server 2005 Express 中](http://www.microsoft.com/downloads/details.aspx?FamilyId=5b5528b9-13e1-4db9-a3fc-82116d598c3d&displaylang=en)包含 SSRS。[我可以使用带有高级工具的 MS SQL Server 2005 Express 版本](http://www.microsoft.com/downloads/details.aspx?FamilyId=5b5528b9-13e1-4db9-a3fc-82116d598c3d&displaylang=en)免费构建报告服务器系统。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T20:41:22.700

我很确定 Reporting Services 2005 包含在标准 SQL Server 2005 许可证中。分析和集成服务也是如此。

# ruby-on-rails - 哪些 Rails 插件是好的、稳定的并且*真正*增强您的代码？

> ID：538600
> 
> 赞同：6
> 
> 时间：2009-02-11T20:23:21.853
> 
> 标签：ruby-on-rails, ruby, plugins

任何人都有一个既*稳定*又为您提供足够功能值得额外支持的 Rails 插件列表？

## 编辑：

我最感兴趣的是最好、最完整的插件列表，所以我可以在下次启动 Rails 应用程序时使用它。我目前不需要特定的插件。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-11T23:46:50.023

您可以使用[bort](http://github.com/fudgestudios/bort/tree/master)作为参考

> **已安装插件**
> 
> Bort 附带了一些已安装并已设置的常用插件。
> 
> **RESTful 身份验证**
> 
> RESTful 身份验证已设置。路由以及邮件程序和观察者都已设置。设置了忘记密码，因此您不必为每个项目都设置它。
> 
> AASM 插件已预先安装。RESTful 身份验证也设置为使用用户激活。
> 
> **用户角色**
> 
> Bort 现在带有 Tim Harper 的角色要求。默认管理员角色与默认管理员用户一起预定义。有关管理员登录详细信息，请参阅迁移。
> 
> **开放身份验证**
> 
> 从 0.3 开始，Bort 具有与 RESTful 身份验证集成的 Open ID。麾！
> 
> **将分页**
> 
> 我们几乎在我们使用的每个项目中都使用 will_paginate，所以 Bort 预装了它。
> 
> **Rspec & Rspec-rails**
> 
> 你应该测试你的代码，所以 Bort 已经安装了 Rspec 和 Rspec-rails，所以你准备好了。
> 
> **异常通知器**
> 
> 你不希望你的应用程序崩溃和烧毁，所以已经安装了异常通知程序，让你知道什么时候一切都变糟了。
> 
> **资产打包器**
> 
> 打包您的 css/javascript，这样您就不会同时向用户发送 143 个文件。减少加载时间并节省带宽。

p / s：同意@eric，细节

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T20:54:38.270

[restful_authentication](http://github.com/technoweenie/restful-authentication/tree/master)用于登录、注销、注册。

用于文件上传的[回形针。](http://github.com/thoughtbot/paperclip/tree/master)

[rspec](http://github.com/dchelimsky/rspec/tree/master)和[shoulda](http://github.com/thoughtbot/shoulda/tree/master)进行测试。

您能否更具体地了解您要查找的内容？有很多很棒的插件可以完成很多不同的任务，很难猜出适合你的插件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T20:25:58.540

尝试资源控制器。[http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special](http://jamesgolick.com/2007/10/19/introducing-resource_controller-focus-on-what-makes-your-controller-special)

它严重耗尽了你的 RESTful 控制器。并且是我遇到的唯一可行的实现多态动作的方法。

还有很多其他的好东西。试试看。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T13:15:42.800

我可以想象你为什么这么问。我曾经在一个使用 20 多个插件的项目中工作。当然，它在早期加速了开发，但后来调试变得困难。此外，更新到新版本的 Rails 是一个漫长的过程。

我的建议是，在对插件的工作原理和所涉及的权衡有合理的了解之前，不要开始使用插件。对于小型插件，您可能应该阅读源代码。对于较大的，请查看其他人对它们的评价，上次更新插件的时间等。

要扫描*流行的*插件，请参阅[最流行的 github 项目](http://github.com/popular/forked)。其中不少是 Rails 插件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-05T03:18:18.710

对我来说，[Haml](http://haml.hamptoncatlin.com/)很棒。它并不适合所有人，但如果它与您一起点击，您会喜欢它。留出 30 分钟，试一试。它将我的观点中的混乱减少了大约 50%。

使用 Rails 2.1+ 的 gem 依赖项很容易安装：

```
# environment.rb
config.gem 'haml' 
```

然后：

```
rake gems:install 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-16T16:18:01.870

[Ruby Trends](http://rubytrends.com/)是检查最流行的插件/宝石/书籍/实践的好地方。它类似于 StackOverflow（即，向上/向下投票插件），但更细粒度并且具有搜索/过滤的能力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T08:14:43.783

我的 Rails 时间我成功地使用了[http://github.com/mbleigh/acts-as-taggable-on/tree/master](http://github.com/mbleigh/acts-as-taggable-on/tree/master)。

# groovy - Groovy 中闭包参数的默认值

> ID：538603
> 
> 赞同：0
> 
> 时间：2009-02-11T20:23:55.580
> 
> 标签：groovy, default-value, closures

有没有办法在 Groovy 中使用带有闭包的默认参数值？

这是我到目前为止所尝试的：

```
class Persona {
    String name

    Persona( String name ) {
        this.name = name
    }

    String salute( String salute = "Hola" ) {
        salute + ' ' + this.name
    }

}

Persona.metaClass.salute2 = { 
    String salute = "Hola" ->
        salute + ' ' + name
}

p = new Persona( 'john' )

print p.salute()
print p.salute2() 
```

这给了我以下结果：

```
Hola johnnull john 
```

似乎调用`salute2()`忽略了敬礼默认值`"Hola"`。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T22:32:55.803

您的代码使用 Groovy 1.6-RC2 可以正常工作。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-11T20:46:45.887

我不相信 Groovy 有直接的方法来做你所要求的。

模拟这种情况的方法是让“salute2”成为一个在其中定义另一个闭包的闭包（当前连接“salute”和“name”变量的闭包，其中“salute”是一个闭包参数），然后调用那个关闭，发送值“Hola”。

# c++ - 使用 C++ 和 Linux 的高分辨率计时器？

> ID：538609
> 
> 赞同：46
> 
> 时间：2009-02-11T20:24:54.097
> 
> 标签：c++, linux, timer

在 Windows 下，有一些方便的功能，例如`QueryPerformanceCounter`创建`mmsystem.h`高分辨率计时器。Linux有类似的东西吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-11T20:29:53.210

之前在这里被[问过](https://stackoverflow.com/questions/464618/whats-the-equivalent-of-windows-queryperformancecounter-on-osx)——但基本上，你可以使用一个 boost ptime 函数，或者一个 POSIX clock_gettime() 函数，它可以达到基本相同的目的。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-11T20:30:45.613

对于 Linux（和 BSD），您想使用[clock_gettime()](http://opengroup.org/onlinepubs/007908799/xsh/clock_gettime.html)。

```
#include <sys/time.h>

int main()
{
   timespec ts;
   // clock_gettime(CLOCK_MONOTONIC, &ts); // Works on FreeBSD
   clock_gettime(CLOCK_REALTIME, &ts); // Works on Linux
} 
```

请参阅：[此答案](https://stackoverflow.com/questions/275004/c-timer-function-to-provide-time-in-nano-seconds/275231#275231)以获取更多信息

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-01-21T16:54:13.690

这是一个描述如何在 Linux 和 Windows 上进行高分辨率计时的链接......不，不要使用 RTSC。

[https://web.archive.org/web/20160330004242/http://tdistler.com/2010/06/27/high-performance-timing-on-linux-windows](https://web.archive.org/web/20160330004242/http://tdistler.com/2010/06/27/high-performance-timing-on-linux-windows)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-08-17T18:48:53.213

对于 C++11，使用`std::chrono::high_resolution_clock`.

例子：

```
#include <iostream>
#include <chrono>
typedef std::chrono::high_resolution_clock Clock;

int main()
{
    auto t1 = Clock::now();
    auto t2 = Clock::now();
    std::cout << "Delta t2-t1: " 
              << std::chrono::duration_cast<std::chrono::nanoseconds>(t2 - t1).count()
              << " nanoseconds" << std::endl;
} 
```

输出：

```
Delta t2-t1: 131 nanoseconds 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T20:28:48.580

我只有这个链接： [http ://www.mjmwired.net/kernel/Documentation/rtc.txt](http://www.mjmwired.net/kernel/Documentation/rtc.txt)

我很确定 RTC 是您正在寻找的东西。

**编辑**

其他答案似乎比我的更便携。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-04T21:44:02.060

在我看来，没有比 Qt 的[QTime](http://doc.qt.nokia.com/latest/qtime.html)类更易于使用的跨平台计时器了。

# c++ - STL typedef 的可移植性如何？

> ID：538623
> 
> 赞同：0
> 
> 时间：2009-02-11T20:28:38.720
> 
> 标签：c++, stl

以下代码是否可移植？

```
template<typename In>
struct input_sequence_range : public pair<In,In> {
    input_sequence_range(In first, In last) : pair<In,In>(first, last) { }
};

template<typename Arr>
input_sequence_range<Arr*> iseq(Arr* a,
                                typename iterator_traits<Arr*>::difference_type n)
{
    return input_sequence_range<Arr*>(a, a + n);
}

template<typename Iter>
input_sequence_range<Iter> iseq(Iter first, Iter last)
{
    return input_sequence_range<Iter>(first, last);
} 
```

具体来说，我质疑在 std::iterator_traits<>::difference_type 上重载的可移植性。如果将其类型化为 int* （尽管这可能很奇怪；我认为标准并未禁止这样做），那么为 int 数组调用 iseq() 将是模棱两可的。

关于 iterator_traits<> typedefs 的标准保证是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T20:42:13.277

`difference_type`必须是整数类型，所以`int*`被淘汰了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T20:34:54.010

根据 Josuttis 的说法，您*应该*使用 typedef 以更灵活和更通用。他的所有示例都是从“这里有一个快速的方法”开始的，导致了基于 STL typedef 的示例。

# c# - 以下代码段有多糟糕？

> ID：538640
> 
> 赞同：1
> 
> 时间：2009-02-11T20:33:08.837
> 
> 标签：c#, windows, windows-mobile, mobile, delegates

我的问题很简单：下面的代码片段有多糟糕？你会*怎么*做？

```
CancelEventHandler _windowClosing;
private CancelEventHandler WindowClosing 
{
  set
  {
    clearEventHandlerList();
    this.Closing += value;
    _windowClosing = value;

    /*
     * if calling the method with null parameters,
     * it will set up itself as the primary control on the Window
     */
    _windowClosing(null,null);
  }
  get
  {
    return _windowClosing;
  }
}

private readonly CancelEventHandler[] CONTROLS = null;
private int current = 0;

public InitializerForm()
{
  InitializeComponent();

  /*
   * these are the handlers for the different controls,
   * in the order of appereance to the user
   */
  STATES = new CancelEventHandler[] { handler1, handler2, etc. };

  WindowClosing = CONTROLS[0];
}

private void clearEventHandlerList()
{
  foreach (CancelEventHandler c in CONTROLS)
  {
    this.Closing -= c;
  }
}

private void handler1(object obj, CancelEventArgs e)
{
  if (obj == null)
  {
    //hide every other control, but this one, also set up if necessary
  }
  else
  {
    //do something

    WindowClosing = CONTROLS[++current]; // set the next control to show

    e.Cancel = true;
  }
} 
```

关键是代码不会关闭表单，而是在其上显示另一个组件，并设置处理方式（这是移动平台，因此单击顶部的确定按钮会生成关闭事件）。这是因为一个接一个地向用户显示多个表单（4 个或 5 个）会使应用程序闪烁，也很烦人，而仅替换组件则更加顺畅。这个模型有效，但看起来很讨厌，我想要一种更干净的方法来处理这个问题。

**更新：** 我更新了代码示例，使变量名有点说话。尽管如此，我相信这很糟糕，（a）但不确定有多少，更重要的是，（b）如何做得更好。

**更新2：** 所以，看起来代码还是有点神秘。

现在问题出在：我向用户展示了一个表单，该表单指示他用几种语言做什么。他继续单击窗口上的“确定”。接下来，我问他的语言，然后像这样的几个问题（他/她的 GPS 在哪里等）。在他回答完问题后（每个问题不应该超过几秒钟），我给他看一个启动画面（同时我在一个单独的线程中加载东西），上面有一张图片。一个接一个地显示这些表单会使整个应用程序启动缓慢，并且充满 UI 滞后。

以下是我为解决滞后问题所做的工作：我将窗口的内容放入面板中，然后将这些面板一个接一个地放置，并隐藏除应该对用户可见的每个面板之外的每个面板。（`current`变量）每个窗口做不同的事情，所以我需要`closing`另外更改窗口事件的处理程序。在此代码中，启用面板的部分与处理窗口关闭事件的部分位于相同的功能（ 、 等）中`handler1`。`handler2`如果参数是`null`，则执行前者，如果不是（这意味着它是由用户触发的），则执行后者。

我需要一个可扩展的解决方案，以便我可以随时插入和删除对话框（函数的顺序和指针存储在`CONTROLS`字段中，如果你真的理解的话，这似乎很方便。虽然它是更改表单的全部内容绝非易事，应该有一种更简单的方法，以及更好的方法，这就是我正在寻找的。

我希望这次我能解释一下这个模型是如何工作的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T20:57:46.920

我认为理论上可能使该代码更令人愉快地转移注意力、危险地顽皮、快活地危险、愉快地冒险和不加注意的异想天开，但这需要一些认真的思考。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T20:56:54.333

不知何故，你的代码让我想哭，对不起。我读了两遍，我所知道的就是它“doesStuff”和“STATES”。

如果您真的需要对此有所帮助，则必须先自己动手...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T19:15:05.910

使用，XML！它是人类可读的！

更严重的是——

似乎您正在尝试创建某种配置向导，所以我将从研究开始。关于您的特定解决方案，我通常*非常*强烈反对“分层面板”方法。我这样做是因为我维护由发现这种方法的人编写的应用程序，或者相关的“选项卡控件上的隐藏选项卡”方法，这是一个好主意。不是，维护者会在未来几年诅咒你的名字。

话虽如此，还有哪些替代方案？好吧，另一种选择是您已经忽略了它，因为它的“闪烁”。我想说，一般来说，对于快速而肮脏的应用程序来说，闪烁并不是什么大问题。例如，确保在关闭旧窗口之前调用新窗口可能是个好主意。（我假设这是可能的，我还没有在移动设备上开发过。）

另一种可能性可能是分层面板的不那么邪恶的版本。不要将六个面板放入一个表单中，而是为每个向导页面创建一个单独的用户控件，然后将用户控件添加/删除到包含的表单中。这可以避免您的闪烁，并且将证明更容易维护，因为每个页面都在不同的控件中。这也可能会简化任何后续的“后退”按钮功能并使您的数据结构更自然地定义，因为这些用户控件将与特定的逻辑数据位相关联。它仍然不理想，但对于一次性解决方案来说可能已经足够了。

第三种技术，如果您预见到随着产品的成熟而进行*大量的*向导修改，则可能是通过以更合乎逻辑/声明性的方式（例如通过 XML）定义用户控件来概括用户控件的创建。如果您基于 XML 动态生成合理的控件，那么修改面板可能就像深入您的 XML 并执行以下操作一样简单：

```
<Questions>
    <Question type="Text"> <!-- generate a textbox for the answer field -->
        Favorite Color:
    </Question>
    <Question type="Number" range="0-255"> <!-- Maybe this is a spinner -->
        The answer to life, the universe, and everything:
    </Question>
</Questions> 
```

这只是我的想法，对于任何一次性应用程序来说***完全是多余的，但这是一种可能性。***

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T05:51:33.390

现在，让我警告这一点，说这可能有效，但它可能不是您真正问题的答案 - 当您有很多表单时，UI 缓慢且无响应。真正的答案可能是继续执行所有单独的表单，但让每个表单在用户盯着第一个表单时将其子表单加载到后台线程中。

但是假设您仍然对此有所了解，我将首先创建一个单独的类来处理面板堆叠/层次结构。称它为 PanelManager。您将实例化 PanelManager 并将其与主窗体相关联，然后将面板添加到其中（可能键入字符串）并设置顺序。在主窗体中，让关闭处理程序调用 PanelManager.CloseCurrentPanel()，如果没有更多面板要显示，那么是时候关闭主窗体了。

伪代码的时间！这是该课程的一个快速想法，我将留给您实现它：

```
public class PanelManager {
// constructor
public PanelManager (Form ownerForm);

// short-cut properties
public Panel this[int idx]
{ get; set; }

public int Index
{ get; set; }

// main functionality

public int AddPanel (Panel p);
public void SetPanelOrder (Panel p, int idx);
public void RemovePanel (Panel p);
public void RemovePanelAt (int idx);

// shows the first Panel
public void Show ();

// shows Panel[idx]
public void Show (int idx);

// adds the panel to the top of the stack and displays it
// returns the index of the panel
public int AddPanelAndShow (Panel p);

// hides the current panel, displays the one underneath it
// returns false if there are no more panels
public bool HideCurrentPanel ();
} 
```

在主窗体的构造函数中，通过 new PanelManager (this) 对其进行实例化，然后在关闭事件处理程序中，调用 panelManager.HideCurrentPanel ()，然后确定之后是否需要关闭它。

# svn - Subversion 在存储大量二进制文件方面有多好？

> ID：538643
> 
> 赞同：38
> 
> 时间：2009-02-11T20:34:41.313
> 
> 标签：svn, documentation, content-management-system

我正在寻找一个放置几 GB 文件的地方（主要是`.doc`和`.xls`）。我的团队已经设置了一个 Subversion 服务器来管理我们创建的文档，所以如果可能的话，我更愿意使用它。Subversion 将如何处理所有这些额外的东西？其中大部分是遗留信息，并且永远只有一个版本，但有可能会更新一些文档。

我被警告过，SVN 并不是特别多的大二进制文件友好。我很谨慎地尝试它来查看它是否有效，因为即使我后来删除它们，它们也将始终存在于存储库历史记录中。

有什么选择吗？我们需要评论和/或标记文档的能力，但我们可以使用类似 Delicious 的服务与 SVN（或类似）中文档的 URL 相结合。

**后来** 我不再担心二进制文件的差异，因为如上所述，它们不会有太大变化。如果他们这样做，我可以稍微麻烦一些——它并不比 SharePoint 差。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-14T03:56:27.507

在我以前的公司，我们设置 Subversion 来存储 CAD 文件。高达 100 MB 的文件存储在 Subversion 中。如果很多人向 Subversion 网络服务器“添加”大文件可能会成为瓶颈。但是，增量提交完全没问题。

Subversion 存储了“二进制增量”。事实上，在服务器端，二进制文件和文本文件在存储“增量”时的处理方式完全相同。检查页面[http://subversion.tigris.org/svn_1.4_releasenotes.html](http://subversion.tigris.org/svn_1.4_releasenotes.html)上的“二进制增量编码改进”部分。它明确表示“ Subversion 使用 xdelta 算法来计算***字节字符串之间的****差异***”（而不是“字符”字符串'）。**

 **只是为了实验，我存储了 10 版本的 CAD（CATIA 零件文件）。每个版本我都对部分进行了微小的修改，然后检查服务器端存储库的大小。大约 10 个修订版的总大小约为 1.2 倍（x - 是原始文件大小）。

记得设置 svn:needs-lock 属性。根据我的经验，最好的方法是使用“自动道具”来设置基于文件扩展名的 svn:needs-lock。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-11T20:39:26.823

大量大二进制文件和大量二进制文件之间存在差异。

根据我的经验，SVN 可以处理数百兆字节的单个二进制文件。我看到的唯一问题开始出现在大约 1 GB 左右的单个文件中。由于神秘和未知的原因导致操作失败，可能是 SVN 无法处理与网络相关的问题。

我不知道任何与二进制文件数量相关的 SVN 问题，除了它们缺乏合并能力以及二进制文件通常不能有效地存储为增量（SVN 可以使用增量）的事实。

所以;

*   1000 个 1MB 文件 = 很好。
*   100 个 10MB 文件 = 很好
*   10 100MB 文件 = 很好
*   1 >1000MB 文件 = 不是一个好主意。

我希望您的文件大小适合其中的一个好类别:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-14T11:49:39.613

我们正是为此构建了我们的[颠覆](http://www.versionsapp.com)客户端，因为我们做了真正需要版本控制的大型设计/咨询工作。我们从来没有遇到过任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T20:43:06.207

这取决于文件的更新频率。它对合并二进制文件无能为力，因此每次发生冲突时都会感到痛苦。否则它只是存储和检索，虽然它不如文本好，但它仍然可以处理得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T20:53:39.207

我个人将 Mercurial 用于此类任务。我已经用它来存储数百场媒体。是的，它占用了一些磁盘空间，但磁盘空间很便宜。使用 Mercurial，您还可以获得分发它的好处，因此进行“结帐”或按照 Mercurial 中已知的克隆，您将获得整个 repo，而不仅仅是快照。如果您的服务器死了，那么您仍在营业。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-02-11T22:05:55.307

从我所见，与 Subversion 相比，Git 非常快，而且我听说它比 Mercurial 快一些，但只是快了一点。但是，我没有专门用大型或大量二进制文件对其进行测试。

话虽如此，Git 跟踪更改的方式，我想它在处理二进制文件方面非常有效。

不过，我可以肯定地说；一旦我习惯了 Git，我就不会选择回到 Subversion。当我必须使用 Subversion 存储库时，我仍然通过 git-svn 使用 Git。通过这种方式，我获得了分布式版本控制的所有优势，但仍然非常支持将提交推送回中央 Subversion 存储库。

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-02-11T20:39:43.733

好吧，在 Subversion 中存储所有内容会占用大量空间，我会告诉你这么多。Subversion 不会像存储文本文件那样通过 delta 存储二进制文件。它可能会占用与仅在硬盘驱动器上存储一堆二进制文件以及存储库一样多的空间。

您可以在服务器端 tiddlywiki 将 URL 存储到 Subversion 中的文档。

如果它们主要是 .doc 和 .xls 文件，还有微软的 Sharepoint。

# ruby - 如何在模板文件中包含元数据？

> ID：538650
> 
> 赞同：1
> 
> 时间：2009-02-11T20:37:47.983
> 
> 标签：ruby, metadata, yaml, erb, webby

我有一个通过 erb 过滤模板文件的系统。使用约定优于配置，输出文件在镜像输入文件的文件层次结构中创建。许多文件具有相同的名称，我能够使用目录来区分它们。

该计划一直有效，直到我需要将附加信息与每个文件相关联。所以我在每个目录中创建了一个带有元数据的 YAML 文件。现在我既有约定***又有***配置。呸。

然后我学习了[Webby](http://webby.rubyforge.org)，以及它在每个模板文件顶部包含 YAML 元数据部分的方式。它们看起来像这样：

```
---
title: Baxter the Dog
filter: textile
---
All the best little blogs use Webby. 
```

如果我可以实现这样的标头，我可以放弃我的层次结构和单独的 YAML 文件。Webby 的实现非常通用，实现了一个新的 MetaFile 类，它将标题与“真实文本”分开，但它似乎比我需要的要复杂。

将元数据放在 erb 评论中似乎很好——它会被 erb 自动忽略，但我不确定如何访问评论数据。

```
<%#
title: Baxter the Dog
%> 
```

有没有办法访问 erb 评论？或者也许是不同的方法？我的很多模板都做了一堆 erb 的事情，但如果它使其余的更容易，我可以在单独的步骤中运行 erb。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:47:27.847

如果您也将内容转储为 YAML 怎么样。大概元数据只是一个转储到 YAML 的哈希。您可以将内容作为字符串附加到同一文件的第二个 YAML 文档中：-

```
---
title: Baxter the Dog
filter: textile
--- |
Content line 1
Content line 2
Content line 3 
```

倾销很简单：-

```
File.open('file.txt', 'w') do |output|
  YAML.dump(metadata, output)
  YAML.dump(content, output)
end 
```

加载很简单：-

```
File.open('file.txt') do |input|
  stream = YAML.load_stream(input)
  metadata, content = stream.documents
end 
```

Note that the pipe character appears in the YAML [so that newlines in the content string are preserved](http://www.yaml.org/YAML_for_ruby.html#single_ending_newline).

# c++ - 如何在 C++ 中使用 GLUT / OpenGL 绘制文本？

> ID：538661
> 
> 赞同：24
> 
> 时间：2009-02-11T20:40:04.170
> 
> 标签：c++, opengl, text, glut

如何使用 GLUT / OpenGL 绘图函数在屏幕上绘制文本字符串？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-11T20:45:05.547

使用 GLUT 绘制字符串有两种方法

[glutStrokeString](https://linux.die.net/man/3/glutstrokestring)将以 3D 形式绘制文本

[![替代文字](https://i.stack.imgur.com/5CSHu.gif)](https://i.stack.imgur.com/5CSHu.gif)
[（来源：[uwa.edu.au](http://local.wasp.uwa.edu.au/~pbourke/oldstuff/glut/opengl4.gif)）]

和[glutBitmapString](https://linux.die.net/man/3/glutbitmapstring)将绘制*面向*用户的文本

[![替代文字](https://i.stack.imgur.com/bl4TG.png)](https://i.stack.imgur.com/bl4TG.png)
[（来源：[sourceforge.net](http://openglut.sourceforge.net/openglut_fonts.png)）]

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-11T20:49:16.143

```
void RenderString(float x, float y, void *font, const char* string, RGB const& rgb)
{  
  char *c;

  glColor3f(rgb.r, rgb.g, rgb.b); 
  glRasterPos2f(x, y);

  glutBitmapString(font, string);
} 
```

你可以这样称呼它；

```
RenderString(0.0f, 0.0f, GLUT_BITMAP_TIMES_ROMAN_24, "Hello", RGB(1.0f, 0.0f, 0.0f)); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-11T20:51:22.240

[如果根据epatel 的回答](https://stackoverflow.com/questions/538661/how-do-i-draw-text-with-glut-opengl-in-c/538691#538691)，您不喜欢 GLUT 附带的内置笔触字体或位图字体，则必须推出自己的解决方案。

[NeHe](http://nehe.gamedev.net)有一些很好的教程（以及完整的示例代码）：

*   [第 13 课 - 位图字体](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=13)
*   [第 14 课 - 轮廓字体](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=14)
*   [第 15 课 - 纹理映射轮廓字体](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=15)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T20:44:46.827

它通常有点讨厌而且不简单。试试这个工具：

[http://students.cs.byu.edu/~bfish/glfontdl.php](http://students.cs.byu.edu/~bfish/glfontdl.php)

# shell - 使用 sed，如何打印一行的前 'N' 个字符？

> ID：538664
> 
> 赞同：135
> 
> 时间：2009-02-11T20:40:23.500
> 
> 标签：shell, sed, grep

使用`sed`什么是单行来打印前*n 个字符*？我正在执行以下操作：

```
grep -G 'defn -test.*' OctaneFullTest.clj  | sed .... 
```

* * *

## 回答 #1

> 赞同：250
> 
> 时间：2009-02-11T20:42:17.690

不要使用`sed`，使用`cut`：

```
grep .... | cut -c 1-N 
```

如果您必须使用`sed`：

```
grep ... | sed -e 's/^\(.\{12\}\).*/\1/' 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2011-06-02T10:22:58.630

```
colrm x 
```

例如，如果您需要前 100 个字符：

```
cat file |colrm 101 
```

它已经存在多年并且在大多数 linux 和 bsd（肯定是 freebsd）中，通常是默认的。我不记得曾经需要打字`apt-get install colrm`。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-12-14T07:46:58.433

也不必使用 grep

一个例子：

```
sed -n '/searchwords/{s/^\(.\{12\}\).*/\1/g;p}' file 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-11T20:48:40.030

严格使用 sed：

```
grep ... | sed -e 's/^\(.\{N\}\).*$/\1/' 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-12-20T22:43:40.730

要打印前 N 个字符，您可以删除直到行尾的 N+1 个字符：

```
$ sed 's/.//5g' <<< "defn-test"
defn 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2020-01-08T21:51:49.957

**头**呢？

```
echo alonglineoftext | head -c 9 
```

# python - 将 timedelta 格式化为字符串

> ID：538666
> 
> 赞同：380
> 
> 时间：2009-02-11T20:40:43.810
> 
> 标签：python, string, datetime, format, timedelta

我在格式化`datetime.timedelta`对象时遇到问题。

这就是我想要做的事情：我有一个对象列表，对象类的成员之一是 timedelta 对象，它显示事件的持续时间。我想以小时：分钟的格式显示该持续时间。

我已经尝试了多种方法来做到这一点，但我遇到了困难。我目前的方法是为返回小时和分钟的对象添加方法到类。我可以通过将 timedelta.seconds 除以 3600 并四舍五入来获得小时数。我无法获得剩余的秒数并将其转换为分钟。

顺便说一句，我正在使用带有 Django 模板的 Google AppEngine 进行演示。

* * *

## 回答 #1

> 赞同：269
> 
> 时间：2009-02-11T20:52:24.577

您可以使用 str() 将 timedelta 转换为字符串。这是一个例子：

```
import datetime
start = datetime.datetime(2009,2,10,14,00)
end   = datetime.datetime(2009,2,10,16,00)
delta = end-start
print(str(delta))
# prints 2:00:00 
```

* * *

## 回答 #2

> 赞同：231
> 
> 时间：2009-02-11T23:34:33.550

`.seconds`如您所知，您可以通过访问属性从 timedelta 对象中获取 total_seconds 。

Python 提供了内置函数`divmod()`，它允许：

```
s = 13420
hours, remainder = divmod(s, 3600)
minutes, seconds = divmod(remainder, 60)
print '{:02}:{:02}:{:02}'.format(int(hours), int(minutes), int(seconds))
# result: 03:43:40 
```

或者您可以使用模数和减法的组合转换为小时和余数：

```
# arbitrary number of seconds
s = 13420
# hours
hours = s // 3600 
# remaining seconds
s = s - (hours * 3600)
# minutes
minutes = s // 60
# remaining seconds
seconds = s - (minutes * 60)
# total time
print '{:02}:{:02}:{:02}'.format(int(hours), int(minutes), int(seconds))
# result: 03:43:40 
```

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2009-02-11T20:44:39.417

```
>>> str(datetime.timedelta(hours=10.56))
10:33:36

>>> td = datetime.timedelta(hours=10.505) # any timedelta object
>>> ':'.join(str(td).split(':')[:2])
10:30 
```

`timedelta`将对象传递给`str()`函数调用与我们简单键入时使用的相同格式代码`print td`。由于您不想要秒，我们可以用冒号（3 部分）拆分字符串，然后将其与前 2 部分重新组合在一起。

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2012-12-07T02:24:53.560

```
def td_format(td_object):
    seconds = int(td_object.total_seconds())
    periods = [
        ('year',        60*60*24*365),
        ('month',       60*60*24*30),
        ('day',         60*60*24),
        ('hour',        60*60),
        ('minute',      60),
        ('second',      1)
    ]

    strings=[]
    for period_name, period_seconds in periods:
        if seconds > period_seconds:
            period_value , seconds = divmod(seconds, period_seconds)
            has_s = 's' if period_value > 1 else ''
            strings.append("%s %s%s" % (period_value, period_name, has_s))

    return ", ".join(strings) 
```

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2016-11-17T16:30:26.513

我个人为此使用该[`humanize`](https://pypi.python.org/pypi/humanize)库：

```
>>> import datetime
>>> humanize.naturalday(datetime.datetime.now())
'today'
>>> humanize.naturalday(datetime.datetime.now() - datetime.timedelta(days=1))
'yesterday'
>>> humanize.naturalday(datetime.date(2007, 6, 5))
'Jun 05'
>>> humanize.naturaldate(datetime.date(2007, 6, 5))
'Jun 05 2007'
>>> humanize.naturaltime(datetime.datetime.now() - datetime.timedelta(seconds=1))
'a second ago'
>>> humanize.naturaltime(datetime.datetime.now() - datetime.timedelta(seconds=3600))
'an hour ago' 
```

当然，它并不能*准确地*为您提供您正在寻找的答案（这确实是`str(timeA - timeB)`，但我发现一旦您超过几个小时，显示就会很快变得不可读。`humanize`支持更大的值，即人类可读，并且也很好地本地化。

显然，它受到 Django`contrib.humanize`模块的启发，所以既然您使用的是 Django，那么您可能应该使用它。

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2017-02-18T20:20:22.340

这是一个通用函数，用于将`timedelta`对象或常规数字（以秒或分钟等形式）转换为格式良好的字符串。我对一个重复的问题采取了[mpounsett 的精彩回答](https://stackoverflow.com/a/17847006/5405967)，使其更加灵活，提高了可读性，并添加了文档。

您会发现这是迄今为止最灵活的答案，因为它允许您：

1.  即时自定义字符串格式，而不是硬编码。
2.  省略某些时间间隔没有问题（参见下面的示例）。

**功能：**

```
from string import Formatter
from datetime import timedelta

def strfdelta(tdelta, fmt='{D:02}d {H:02}h {M:02}m {S:02}s', inputtype='timedelta'):
    """Convert a datetime.timedelta object or a regular number to a custom-
    formatted string, just like the stftime() method does for datetime.datetime
    objects.

    The fmt argument allows custom formatting to be specified.  Fields can 
    include seconds, minutes, hours, days, and weeks.  Each field is optional.

    Some examples:
        '{D:02}d {H:02}h {M:02}m {S:02}s' --> '05d 08h 04m 02s' (default)
        '{W}w {D}d {H}:{M:02}:{S:02}'     --> '4w 5d 8:04:02'
        '{D:2}d {H:2}:{M:02}:{S:02}'      --> ' 5d  8:04:02'
        '{H}h {S}s'                       --> '72h 800s'

    The inputtype argument allows tdelta to be a regular number instead of the  
    default, which is a datetime.timedelta object.  Valid inputtype strings: 
        's', 'seconds', 
        'm', 'minutes', 
        'h', 'hours', 
        'd', 'days', 
        'w', 'weeks'
    """

    # Convert tdelta to integer seconds.
    if inputtype == 'timedelta':
        remainder = int(tdelta.total_seconds())
    elif inputtype in ['s', 'seconds']:
        remainder = int(tdelta)
    elif inputtype in ['m', 'minutes']:
        remainder = int(tdelta)*60
    elif inputtype in ['h', 'hours']:
        remainder = int(tdelta)*3600
    elif inputtype in ['d', 'days']:
        remainder = int(tdelta)*86400
    elif inputtype in ['w', 'weeks']:
        remainder = int(tdelta)*604800

    f = Formatter()
    desired_fields = [field_tuple[1] for field_tuple in f.parse(fmt)]
    possible_fields = ('W', 'D', 'H', 'M', 'S')
    constants = {'W': 604800, 'D': 86400, 'H': 3600, 'M': 60, 'S': 1}
    values = {}
    for field in possible_fields:
        if field in desired_fields and field in constants:
            values[field], remainder = divmod(remainder, constants[field])
    return f.format(fmt, **values) 
```

**演示：**

```
>>> td = timedelta(days=2, hours=3, minutes=5, seconds=8, microseconds=340)

>>> print strfdelta(td)
02d 03h 05m 08s

>>> print strfdelta(td, '{D}d {H}:{M:02}:{S:02}')
2d 3:05:08

>>> print strfdelta(td, '{D:2}d {H:2}:{M:02}:{S:02}')
 2d  3:05:08

>>> print strfdelta(td, '{H}h {S}s')
51h 308s

>>> print strfdelta(12304, inputtype='s')
00d 03h 25m 04s

>>> print strfdelta(620, '{H}:{M:02}', 'm')
10:20

>>> print strfdelta(49, '{D}d {H}h', 'h')
2d 1h 
```

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2013-06-19T15:41:24.767

他已经有一个 timedelta 对象，为什么不使用它的内置方法 total_seconds() 将其转换为秒，然后使用 divmod() 获取小时和分钟？

```
hours, remainder = divmod(myTimeDelta.total_seconds(), 3600)
minutes, seconds = divmod(remainder, 60)

# Formatted only for hours and minutes as requested
print '%s:%s' % (hours, minutes) 
```

无论时间增量是偶数天还是数年，这都有效。

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2015-01-30T18:24:06.243

我知道这是一个老问题，但我用`datetime.utcfromtimestamp()`这个。它需要秒数并返回一个`datetime`可以像任何其他`datetime`.

```
duration = datetime.utcfromtimestamp(end - begin)
print duration.strftime('%H:%M') 
```

只要您在时间部分保持在合法范围内，这应该可以工作，即它不会返回 1234:35，因为小时数 <= 23。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2015-02-25T22:53:28.840

我会在这里认真考虑奥卡姆剃刀方法：

```
td = str(timedelta).split('.')[0] 
```

这将返回一个没有微秒的字符串

如果要重新生成 datetime.timedelta 对象，只需执行以下操作：

```
h,m,s = re.split(':', td)
new_delta = datetime.timedelta(hours=int(h),minutes=int(m),seconds=int(s)) 
```

2年了，我喜欢这种语言！

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2013-01-09T22:16:26.950

提问者想要一个比典型格式更好的格式：

```
 >>> import datetime
  >>> datetime.timedelta(seconds=41000)
  datetime.timedelta(0, 41000)
  >>> str(datetime.timedelta(seconds=41000))
  '11:23:20'
  >>> str(datetime.timedelta(seconds=4102.33))
  '1:08:22.330000'
  >>> str(datetime.timedelta(seconds=413302.33))
  '4 days, 18:48:22.330000' 
```

所以，实际上有两种格式，一种是天数为 0 并且被省略，另一种是文本“n days, h:m:s”。但是，秒可能有分数，并且打印输出中没有前导零，所以列很乱。

这是我的日常，如果你喜欢的话：

```
def printNiceTimeDelta(stime, etime):
    delay = datetime.timedelta(seconds=(etime - stime))
    if (delay.days > 0):
        out = str(delay).replace(" days, ", ":")
    else:
        out = "0:" + str(delay)
    outAr = out.split(':')
    outAr = ["%02d" % (int(float(x))) for x in outAr]
    out   = ":".join(outAr)
    return out 
```

这会以 dd:hh:mm:ss 格式返回输出：

```
00:00:00:15
00:00:00:19
02:01:31:40
02:01:32:22 
```

我确实考虑过为此增加几年，但这留给读者作为练习，因为输出在 1 年以上是安全的：

```
>>> str(datetime.timedelta(seconds=99999999))
'1157 days, 9:46:39' 
```

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2018-06-21T05:49:25.087

我使用`humanfriendly`python库来做到这一点，效果很好。

```
import humanfriendly
from datetime import timedelta
delta = timedelta(seconds = 321)
humanfriendly.format_timespan(delta)

'5 minutes and 21 seconds' 
```

可在[https://pypi.org/project/humanfriendly/](https://pypi.org/project/humanfriendly/)

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2009-10-29T14:23:22.417

我的`datetime.timedelta`物品超过了一天。所以这里还有一个问题。上面的所有讨论都假设不到一天。A`timedelta`实际上是天、秒和微秒的元组。上面的讨论应该`td.seconds`像 joe 一样使用，但如果你有几天，它不包含在 seconds 值中。

我在 2 个日期时间和打印天数和小时数之间得到一个时间跨度。

```
span = currentdt - previousdt
print '%d,%d\n' % (span.days,span.seconds/3600) 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2020-07-03T16:20:26.193

我有一个功能：

```
def period(delta, pattern):
    d = {'d': delta.days}
    d['h'], rem = divmod(delta.seconds, 3600)
    d['m'], d['s'] = divmod(rem, 60)
    return pattern.format(**d) 
```

例子：

```
>>> td = timedelta(seconds=123456789)
>>> period(td, "{d} days {h}:{m}:{s}")
'1428 days 21:33:9'
>>> period(td, "{h} hours, {m} minutes and {s} seconds, {d} days")
'21 hours, 33 minutes and 9 seconds, 1428 days' 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2020-12-03T21:22:41.073

也许：

```
>>> import datetime
>>> dt0 = datetime.datetime(1,1,1)
>>> td = datetime.timedelta(minutes=34, hours=12, seconds=56)
>>> (dt0+td).strftime('%X')
'12:34:56'
>>> (dt0+td).strftime('%M:%S')
'34:56'
>>> (dt0+td).strftime('%H:%M')
'12:34'
>>> 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-02-11T20:52:18.180

按照上面乔的示例值，我将使用模算术运算符，因此：

```
td = datetime.timedelta(hours=10.56)
td_str = "%d:%d" % (td.seconds/3600, td.seconds%3600/60) 
```

请注意，Python 中的整数除法默认向下舍入；如果您想更明确，请酌情使用 math.floor() 或 math.ceil()。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2013-09-29T05:21:26.497

```
def seconds_to_time_left_string(total_seconds):
    s = int(total_seconds)
    years = s // 31104000
    if years > 1:
        return '%d years' % years
    s = s - (years * 31104000)
    months = s // 2592000
    if years == 1:
        r = 'one year'
        if months > 0:
            r += ' and %d months' % months
        return r
    if months > 1:
        return '%d months' % months
    s = s - (months * 2592000)
    days = s // 86400
    if months == 1:
        r = 'one month'
        if days > 0:
            r += ' and %d days' % days
        return r
    if days > 1:
        return '%d days' % days
    s = s - (days * 86400)
    hours = s // 3600
    if days == 1:
        r = 'one day'
        if hours > 0:
            r += ' and %d hours' % hours
        return r 
    s = s - (hours * 3600)
    minutes = s // 60
    seconds = s - (minutes * 60)
    if hours >= 6:
        return '%d hours' % hours
    if hours >= 1:
        r = '%d hours' % hours
        if hours == 1:
            r = 'one hour'
        if minutes > 0:
            r += ' and %d minutes' % minutes
        return r
    if minutes == 1:
        r = 'one minute'
        if seconds > 0:
            r += ' and %d seconds' % seconds
        return r
    if minutes == 0:
        return '%d seconds' % seconds
    if seconds == 0:
        return '%d minutes' % minutes
    return '%d minutes and %d seconds' % (minutes, seconds)

for i in range(10):
    print pow(8, i), seconds_to_time_left_string(pow(8, i))

Output:
1 1 seconds
8 8 seconds
64 one minute and 4 seconds
512 8 minutes and 32 seconds
4096 one hour and 8 minutes
32768 9 hours
262144 3 days
2097152 24 days
16777216 6 months
134217728 4 years 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2019-10-09T01:23:02.963

针对此问题的直接模板过滤器。内置函数 int() 从不四舍五入。F-Strings（即 f''）需要 python 3.6。

```
@app_template_filter()
def diffTime(end, start):
    diff = (end - start).total_seconds()
    d = int(diff / 86400)
    h = int((diff - (d * 86400)) / 3600)
    m = int((diff - (d * 86400 + h * 3600)) / 60)
    s = int((diff - (d * 86400 + h * 3600 + m *60)))
    if d > 0:
        fdiff = f'{d}d {h}h {m}m {s}s'
    elif h > 0:
        fdiff = f'{h}h {m}m {s}s'
    elif m > 0:
        fdiff = f'{m}m {s}s'
    else:
        fdiff = f'{s}s'
    return fdiff 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2020-04-26T06:53:32.550

一个班轮。由于 timedeltas 不提供 datetime 的 strftime，因此将 timedelta 带回 datetime，并使用 stftime。

这不仅可以实现 OP 要求的格式 Hours:Minutes，现在您可以利用 datetime 的 strftime 的完整格式功能，如果您的要求更改为另一种表示。

```
import datetime
td = datetime.timedelta(hours=2, minutes=10, seconds=5)
print(td)
print(datetime.datetime.strftime(datetime.datetime.strptime(str(td), "%H:%M:%S"), "%H:%M"))

Output:
2:10:05
02:10 
```

这也解决了时间增量被格式化为字符串为 H:MM:SS 而不是 HH:MM:SS 的烦恼，这导致我遇到了这个问题，以及我分享的解决方案。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2014-05-10T14:21:19.857

我在工作中加班计算的输出也有类似的问题。该值应始终以 HH:MM 显示，即使它大于 1 天并且该值可能为负数。我结合了一些显示的解决方案，也许其他人发现这个解决方案很有用。我意识到，如果 timedelta 值为负，则使用 divmod 方法显示的大多数解决方案都不能开箱即用：

```
def td2HHMMstr(td):
  '''Convert timedelta objects to a HH:MM string with (+/-) sign'''
  if td < datetime.timedelta(seconds=0):
    sign='-'
    td = -td
  else:
    sign = ''
  tdhours, rem = divmod(td.total_seconds(), 3600)
  tdminutes, rem = divmod(rem, 60)
  tdstr = '{}{:}:{:02d}'.format(sign, int(tdhours), int(tdminutes))
  return tdstr 
```

timedelta 到 HH:MM 字符串：

```
td2HHMMstr(datetime.timedelta(hours=1, minutes=45))
'1:54'

td2HHMMstr(datetime.timedelta(days=2, hours=3, minutes=2))
'51:02'

td2HHMMstr(datetime.timedelta(hours=-3, minutes=-2))
'-3:02'

td2HHMMstr(datetime.timedelta(days=-35, hours=-3, minutes=-2))
'-843:02' 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2018-05-11T15:37:33.293

```
import datetime
hours = datetime.timedelta(hours=16, minutes=30)
print((datetime.datetime(1,1,1) + hours).strftime('%H:%M')) 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2016-09-26T13:41:45.897

```
from django.utils.translation import ngettext

def localize_timedelta(delta):
    ret = []
    num_years = int(delta.days / 365)
    if num_years > 0:
        delta -= timedelta(days=num_years * 365)
        ret.append(ngettext('%d year', '%d years', num_years) % num_years)

    if delta.days > 0:
        ret.append(ngettext('%d day', '%d days', delta.days) % delta.days)

    num_hours = int(delta.seconds / 3600)
    if num_hours > 0:
        delta -= timedelta(hours=num_hours)
        ret.append(ngettext('%d hour', '%d hours', num_hours) % num_hours)

    num_minutes = int(delta.seconds / 60)
    if num_minutes > 0:
        ret.append(ngettext('%d minute', '%d minutes', num_minutes) % num_minutes)

    return ' '.join(ret) 
```

这将产生：

```
>>> from datetime import timedelta
>>> localize_timedelta(timedelta(days=3660, minutes=500))
'10 years 10 days 8 hours 20 minutes' 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2020-07-31T19:33:19.753

我继续[MarredCheese 的回答](https://stackoverflow.com/a/42320260/11998874)并添加了`year`,`month`和`millicesond``microsecond`

除了 之外，所有数字都被格式化为整数，因此[可以自定义](https://docs.python.org/3.8/library/string.html)`second`秒的小数部分。

@kfmfe04 要求几分之一秒，所以我发布了这个解决方案

里面`main`有一些例子。

```
from string import Formatter
from datetime import timedelta

def strfdelta(tdelta, fmt='{D:02}d {H:02}h {M:02}m {S:02.0f}s', inputtype='timedelta'):
    """Convert a datetime.timedelta object or a regular number to a custom-
    formatted string, just like the stftime() method does for datetime.datetime
    objects.

    The fmt argument allows custom formatting to be specified.  Fields can 
    include seconds, minutes, hours, days, and weeks.  Each field is optional.

    Some examples:
        '{D:02}d {H:02}h {M:02}m {S:02.0f}s' --> '05d 08h 04m 02s' (default)
        '{W}w {D}d {H}:{M:02}:{S:02.0f}'     --> '4w 5d 8:04:02'
        '{D:2}d {H:2}:{M:02}:{S:02.0f}'      --> ' 5d  8:04:02'
        '{H}h {S:.0f}s'                       --> '72h 800s'

    The inputtype argument allows tdelta to be a regular number instead of the  
    default, which is a datetime.timedelta object.  Valid inputtype strings: 
        's', 'seconds', 
        'm', 'minutes', 
        'h', 'hours', 
        'd', 'days', 
        'w', 'weeks'
    """

    # Convert tdelta to integer seconds.
    if inputtype == 'timedelta':
        remainder = tdelta.total_seconds()
    elif inputtype in ['s', 'seconds']:
        remainder = float(tdelta)
    elif inputtype in ['m', 'minutes']:
        remainder = float(tdelta)*60
    elif inputtype in ['h', 'hours']:
        remainder = float(tdelta)*3600
    elif inputtype in ['d', 'days']:
        remainder = float(tdelta)*86400
    elif inputtype in ['w', 'weeks']:
        remainder = float(tdelta)*604800

    f = Formatter()
    desired_fields = [field_tuple[1] for field_tuple in f.parse(fmt)]
    possible_fields = ('Y','m','W', 'D', 'H', 'M', 'S', 'mS', 'µS')
    constants = {'Y':86400*365.24,'m': 86400*30.44 ,'W': 604800, 'D': 86400, 'H': 3600, 'M': 60, 'S': 1, 'mS': 1/pow(10,3) , 'µS':1/pow(10,6)}
    values = {}
    for field in possible_fields:
        if field in desired_fields and field in constants:
            Quotient, remainder = divmod(remainder, constants[field])
            values[field] = int(Quotient) if field != 'S' else Quotient + remainder
    return f.format(fmt, **values)

if __name__ == "__main__":
    td = timedelta(days=717, hours=3, minutes=5, seconds=8, microseconds=3549)
    print(strfdelta(td,'{Y} years {m} months {W} weeks {D} days {H:02}:{M:02}:{S:02}'))  
    print(strfdelta(td,'{m} months {W} weeks {D} days {H:02}:{M:02}:{S:02.4f}'))  
    td = timedelta( seconds=8, microseconds=8549)
    print(strfdelta(td,'{S} seconds {mS} milliseconds {µS} microseconds'))  
    print(strfdelta(td,'{S:.0f} seconds {mS} milliseconds {µS} microseconds'))  
    print(strfdelta(pow(10,7),inputtype='s')) 
```

输出：

```
1 years 11 months 2 weeks 3 days 01:09:56.00354900211096
23 months 2 weeks 3 days 00:12:20.0035
8.008549 seconds 8 milliseconds 549 microseconds
8 seconds 8 milliseconds 549 microseconds
115d 17h 46m 40s 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-05-18T21:14:14.357

如果你碰巧有`IPython`你的包（你应该），它有（到目前为止，无论如何）一个非常好的持续时间格式化程序（以浮点秒为单位）。这在各个地方都有使用，例如`%%time`细胞魔法。我喜欢它在短时间内产生的格式：

```
>>> from IPython.core.magics.execution import _format_time
>>> 
>>> for v in range(-9, 10, 2):
...     dt = 1.25 * 10**v
...     print(_format_time(dt))

1.25 ns
125 ns
12.5 µs
1.25 ms
125 ms
12.5 s
20min 50s
1d 10h 43min 20s
144d 16h 13min 20s
14467d 14h 13min 20s 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2020-06-30T13:48:32.137

这是一个字符串化 timedelta.total_seconds() 的函数。它适用于 python 2 和 3。

```
def strf_interval(seconds):
    days, remainder = divmod(seconds, 86400)
    hours, remainder = divmod(remainder, 3600)
    minutes, seconds = divmod(remainder, 60)
    return '{} {} {} {}'.format(
            "" if int(days) == 0 else str(int(days)) + ' days',
            "" if int(hours) == 0 else str(int(hours)) + ' hours',
            "" if int(minutes) == 0 else str(int(minutes))  + ' mins',
            "" if int(seconds) == 0 else str(int(seconds))  + ' secs'
        ) 
```

示例输出：

```
>>> print(strf_interval(1))
   1 secs
>>> print(strf_interval(100))
  1 mins 40 secs
>>> print(strf_interval(1000))
  16 mins 40 secs
>>> print(strf_interval(10000))
 2 hours 46 mins 40 secs
>>> print(strf_interval(100000))
1 days 3 hours 46 mins 40 secs 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-03-03T08:34:33.867

请检查此功能 - 它将 timedelta 对象转换为字符串 'HH:MM:SS'

```
def format_timedelta(td):
    hours, remainder = divmod(td.total_seconds(), 3600)
    minutes, seconds = divmod(remainder, 60)
    hours, minutes, seconds = int(hours), int(minutes), int(seconds)
    if hours < 10:
        hours = '0%s' % int(hours)
    if minutes < 10:
        minutes = '0%s' % minutes
    if seconds < 10:
        seconds = '0%s' % seconds
    return '%s:%s:%s' % (hours, minutes, seconds) 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2017-11-21T05:24:25.423

如果您已经有一个 timedelta obj，那么只需将该 obj 转换为字符串。删除字符串的最后 3 个字符并打印。这将截断秒部分并以小时：分钟的格式打印其余部分。

```
t = str(timedeltaobj) 

print t[:-3] 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-10-08T07:37:22.433

timedelta 到字符串，用于打印运行时间信息。

```
def strfdelta_round(tdelta, round_period='second'):
  """timedelta to string,  use for measure running time
  attend period from days downto smaller period, round to minimum period
  omit zero value period  
  """
  period_names = ('day', 'hour', 'minute', 'second', 'millisecond')
  if round_period not in period_names:
    raise Exception(f'round_period "{round_period}" invalid, should be one of {",".join(period_names)}')
  period_seconds = (86400, 3600, 60, 1, 1/pow(10,3))
  period_desc = ('days', 'hours', 'mins', 'secs', 'msecs')
  round_i = period_names.index(round_period)

  s = ''
  remainder = tdelta.total_seconds()
  for i in range(len(period_names)):
    q, remainder = divmod(remainder, period_seconds[i])
    if int(q)>0:
      if not len(s)==0:
        s += ' '
      s += f'{q:.0f} {period_desc[i]}'
    if i==round_i:
      break
    if i==round_i+1:
      s += f'{remainder} {period_desc[round_i]}'
      break

  return s 
```

例如自动省略零前导期：

```
>>> td = timedelta(days=0, hours=2, minutes=5, seconds=8, microseconds=3549)
>>> strfdelta_round(td, 'second')
'2 hours 5 mins 8 secs' 
```

或省略中间零期：

```
>>> td = timedelta(days=2, hours=0, minutes=5, seconds=8, microseconds=3549)
>>> strfdelta_round(td, 'millisecond')
'2 days 5 mins 8 secs 3 msecs' 
```

或四舍五入到分钟，省略以下分钟：

```
>>> td = timedelta(days=1, hours=2, minutes=5, seconds=8, microseconds=3549)
>>> strfdelta_round(td, 'minute')
'1 days 2 hours 5 mins' 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-02-17T20:27:49.467

我想这样做，所以写了一个简单的函数。它对我很有用，而且用途广泛（支持年到微秒，以及任何粒度级别，例如，您可以在“2 天 4 小时 48 分钟”和“2 天 4 小时”和“2 天 4.8 小时”之间进行选择'， ETC。

```
def pretty_print_timedelta(t, max_components=None, max_decimal_places=2):
''' 
Print a pretty string for a timedelta. 
For example datetime.timedelta(days=2, seconds=17280) will be printed as '2 days, 4 hours, 48 minutes'. Setting max_components to e.g. 1 will change this to '2.2 days', where the 
number of decimal points can also be set. 
'''
time_scales = [timedelta(days=365), timedelta(days=1), timedelta(hours=1), timedelta(minutes=1), timedelta(seconds=1), timedelta(microseconds=1000), timedelta(microseconds=1)]
time_scale_names_dict = {timedelta(days=365): 'year',  
                         timedelta(days=1): 'day', 
                         timedelta(hours=1): 'hour', 
                         timedelta(minutes=1): 'minute', 
                         timedelta(seconds=1): 'second', 
                         timedelta(microseconds=1000): 'millisecond', 
                         timedelta(microseconds=1): 'microsecond'}
count = 0
txt = ''
first = True
for scale in time_scales:
    if t >= scale: 
        count += 1
        if count == max_components:
            n = t / scale
        else:
            n = int(t / scale)

        t -= n*scale

        n_txt = str(round(n, max_decimal_places))
        if n_txt[-2:]=='.0': n_txt = n_txt[:-2]
        txt += '{}{} {}{}'.format('' if first else ', ', n_txt, time_scale_names_dict[scale], 's' if n>1 else '', )
        if first:
            first = False

if len(txt) == 0: 
    txt = 'none'
return txt 
```

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2020-12-13T03:57:03.683

我建议以下方法，以便我们可以使用标准格式化功能，[`pandas.Timestamp.strftime`](https://docs.python.org/3/library/datetime.html)！

```
from pandas import Timestamp, Timedelta

(Timedelta("2 hours 30 min") + Timestamp("00:00:00")).strftime("%H:%M") 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2021-09-08T07:55:02.360

```
# Format seconds to days, hours, minutes and seconds string
def ptime(seconds):
if(seconds >= 86400):
    d = seconds // 86400 # // floor division
    return (f"{round(d)}d") + ptime(seconds - d * 86400)
else:
    if(seconds >= 3600):
        h = seconds // 3600 
        return (f"{round(h)}h") + ptime(seconds - h * 3600)
    else:
        if(seconds >= 60):
            m = seconds // 60
            return(f"{round(m)}m" + ptime(seconds - m * 60))
        else:
            if (seconds > 0):
                return(f"{round(seconds)}s")
            else:
                return("") 
```

* * *

## 回答 #31

> 赞同：-3
> 
> 时间：2013-07-21T13:01:00.220

```
t1 = datetime.datetime.strptime(StartTime, "%H:%M:%S %d-%m-%y")

t2 = datetime.datetime.strptime(EndTime, "%H:%M:%S %d-%m-%y")

return str(t2-t1) 
```

因此对于：

```
StartTime = '15:28:53 21-07-13'
EndTime = '15:32:40 21-07-13' 
```

返回：

```
'0:03:47' 
```

* * *

## 回答 #32

> 赞同：-13
> 
> 时间：2009-02-11T21:11:26.623

感谢大家的帮助。我吸收了你的许多想法并将它们放在一起，让我知道你的想法。

我在类中添加了两个方法，如下所示：

```
def hours(self):
    retval = ""
    if self.totalTime:
        hoursfloat = self.totalTime.seconds / 3600
        retval = round(hoursfloat)
    return retval

def minutes(self):
    retval = ""
    if self.totalTime:
        minutesfloat = self.totalTime.seconds / 60
        hoursAsMinutes = self.hours() * 60
        retval = round(minutesfloat - hoursAsMinutes)
    return retval 
```

在我的 django 中，我使用了这个（sum 是对象，它在字典中）：

```
<td>{{ sum.0 }}</td>    
<td>{{ sum.1.hours|stringformat:"d" }}:{{ sum.1.minutes|stringformat:"#02.0d" }}</td> 
```

# testing - 实例化一个用于测试的类

> ID：538668
> 
> 赞同：0
> 
> 时间：2009-02-11T20:40:52.750
> 
> 标签：testing, tdd, inversion-of-control

我需要测试属于服务类的方法。这个服务类在构造函数中有几个依赖，一些被这个方法使用，一些没有。如果我们不应该使用 DI 容器进行单元测试，那么实例化服务类的最佳方法是什么？

```
var service = new ServiceClass(new Repository1(), new Repository2(), new ServiceClass2(), etc.); 
```

这很难阅读，而且似乎有很多代码只是为了测试一种方法。当其中一些依赖项有自己的依赖项时，事情就会变得非常混乱。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T20:49:11.107

您真的应该考虑使用模拟框架将您的测试与实际的依赖对象隔离开来。我假设您使用 C#（来自`var`关键字），所以我将举一个来自 RhinoMock 的示例。

```
var respository1 = MockRepository.GenerateMock<Repository1>();
repository1.Expect( r => r.SomeMethod() ).Return( someValue );

var repository2 = MockRepository.GenerateMock<Repository2>();
repository2.Expect( r => r.Method2() ).Return( someValue );

 ...

var service = new Service( repository1, repository2, ... );

repository1.VerifyAllExpectations();
repository2.VerifyAllExpectations(); 
```

使用这种机制，您可以控制模拟对象如何响应您的测试类，并将您的测试代码与相关依赖项隔离开来。您还可以通过验证您设置的期望是否已满足（调用）来测试您的测试类是否与它所依赖的类正确交互。

至于构造函数中的参数数量，请考虑提供一个不带参数的默认构造函数，并为依赖项提供公共设置器。然后，您可以使用 C# 3.0 中的便利机制来定义它们。

```
var service = new Service {
    Repository1 = repository1,
    Repository2 = repository2,
    ...
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T20:46:34.280

[http://www.myjavatools.com/cuecards/refactoring.html](http://www.myjavatools.com/cuecards/refactoring.html)

> 构造函数→工厂方法
> 
> 如果您想要的不仅仅是简单的构造

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T20:47:16.087

有时（尤其是在测试代码时）一些代码重新格式化可以解决问题。尽管

```
var service = new ServiceClass(new Repository1(), new Repository2(), new ServiceClass2()); 
```

绝对难以阅读，这个：

```
var service = new ServiceClass(
    new Repository1(), 
    new Repository2(), 
    new ServiceClass2()
); 
```

似乎好一点（至少对我来说）。

# gwt - 基本的 GWT 异步调用误区

> ID：538669
> 
> 赞同：0
> 
> 时间：2009-02-11T20:41:06.117
> 
> 标签：gwt

我似乎对 GWT 异步调用的工作方式和/或小部件在收到回调后如何更新存在一些根本性的误解。

我已经创建了两个接口以及实现，它们似乎正在相互通信。我根据在使用 eclipse 调试器单步执行时观察到的合理外观数据做出此声明：`result`下面的 onSuccess 方法中的变量包含我期望的内容，并且我尝试填充的网格最终被`results`退出时的数据填充从循环。但是，当`onSuccess`调用返回时，我的 GUI 中不会根据`uhpScrollPanel.setWidget(uhpGrid)`调用显示任何网格，并且不会引发任何类型的异常。

我一定是忽略了一些明显的东西，有没有人知道在哪里看？

```
 final ScrollPanel uhpScrollPanel = new ScrollPanel();
    uhpVert.add(uhpScrollPanel);
    uhpScrollPanel.setSize("100%", "100%");

    //build and populate grid
    UpdateHistoryServiceAsync uhpService = UpdateHistoryService.Util.getInstance();

    uhpService.getUpdateHistory(new AsyncCallback<List<UpdateHistoryEntryBean>>() {

        public void onFailure(Throwable caught) {
            System.out.println("OnFailure");
            caught.printStackTrace();

            final Label uhpErrorLabel = new Label("Server Unable to Grab History...");
            uhpScrollPanel.setWidget(uhpErrorLabel);
            uhpErrorLabel.setSize("100%", "100%");

        }

        public void onSuccess(List<UpdateHistoryEntryBean> result) {
            int length = result.size();

            final Grid uhpGrid = new Grid();
            uhpScrollPanel.setWidget(uhpGrid);
            uhpGrid.setBorderWidth(1);
            uhpGrid.setSize("100%", "100%");
            uhpGrid.resize(length, 3);

            int i = 0;
            for (UpdateHistoryEntryBean entry : result) {
                uhpGrid.setText(i, 0, String.valueOf(entry.getSourceId()));
                uhpGrid.setText(i, 1, entry.getTitle());
                uhpGrid.setText(i, 2, entry.getBody());
                i++;
            }
        }

    }); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T21:07:35.540

您的`onSuccess()`方法定义不正确，作为它接收的参数`Object`，您必须在之后对其进行向下转换。

意思是，签名应该是：

```
public void onSuccess(Object result) 
```

之后，您可以像这样显式地向下转换您知道已返回的对象：

```
List<UpdateHistoryEntryBean> resultList = (List<UpdateHistoryEntryBean>) result; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T21:09:28.750

事实证明，快速修复是将网格添加到 VerticalPanel 而不是 ScrollPanel。现在的问题变成了 - 为什么这很重要，我们如何解决这个困境？

# hyperlink - SWT 链接文本与 >

> ID：538673
> 
> 赞同：1
> 
> 时间：2009-02-11T20:41:48.377
> 
> 标签：hyperlink, swt

我正在尝试使用文本创建一个 SWT 链接，因此它如下所示

<这是链接>

**此处为链接**的文本是实际链接，尖括号不是链接的一部分。

我可以接近以下代码：

```
link.setText("<a><this is the link></a>"); 
```

但是，我只想将文本作为链接，而不包括 < 和 >。我以为我可以通过这样做来做到这一点：

```
link.setText("<<a>this is the link</a>>"); 
```

但是当我这样做时 - 我失去了结局>。谁能想到如何让 > 回来（没有它成为链接的一部分？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T20:44:53.330

您正在测试哪个版本的 SWT？当我为 Link 运行第一个 SWT[示例片段](http://www.eclipse.org/swt/snippets/#link)时，将文本替换为您的示例

```
link.setText("<<a>this is the link</a>>"); 
```

然后我看到了我相信你想看到的。这是使用 SWT 3.3.2。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-05T23:03:31.253

这似乎可以解决问题：

```
link.setText("<<a>this is the link</a>> >"); 
```

# java - 如何将 Google Adsense 放入 GWT

> ID：538674
> 
> 赞同：10
> 
> 时间：2009-02-11T20:42:01.340
> 
> 标签：java, gwt, adsense

有谁知道如何将 Google Adsense 广告放入 GWT 网络应用程序中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T21:14:12.980

根据[AdSense 上的这个帖子](http://groups.google.com/group/adsense-help-troubleshooting/browse_thread/thread/632a7d4cf3d2e06/da4e75482cc5c027)：

> 短版，您不能通过 Ajax 使用 Adsense 而不违反计划政策/t&c
> 
> 长版...
> 
> 通过 xmlhttp 调用传递的广告代码不会呈现，它只是被视为文本（因此，responseText）。执行js代码的唯一方法是使用“responseXML”加上“exec()”命令。
> 
> 例如...
> 
> 如果您的 xml 包含以下内容：
> 
> 这是来自外部文件的内容 javascript 代码在这里
> 
> 您将使用 ajax_obj.responseXML 分配一个变量（例如称为 page_data），通过解析器运行 XML 并运行
> 
> exec（此处来自 XML 的 js 变量或行）；
> 
> 从 Adsense 的角度来看并没有真正的帮助，但它就是这样做的。

还值得一提的是[为什么我抛弃了 GWT](http://www.onthoo.com/blog/programming/2008/02/why-i-dumped-gwt.html)：

> 另一个问题是我的 AdSense 横幅。由于页面上的内容不多，因此横幅有时会偏离主题。一个更大的问题是，当人们搜索不同的关键字时，横幅保持不变（因为 ajax 刷新不会触发 adsense 刷新）。我通过使用页面刷新而不是 ajax 调用进行搜索来解决这个问题。该网站的 ajax 部分仅限于排序、分面、i18n 和显示提示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T19:32:47.583

您可以将来自 Adsense 的 javascript 代码放在 GWT 开头的单个 HTML 页面中。这样广告就不会显示在与 GTW 相同的区域，而是显示在 GWT 代码的上方/下方。对于广告，可能还可以。

这个例子在应用程序上方放置了一个baner：

```
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>www.javaoracleblog.com</title>
    <script type="text/javascript" language="javascript" src="com.javaoracleblog.aggregator.nocache.js"></script>
  </head>
  <body>
<script type="text/javascript"..
ADsense code here 
</script>
    <!-- OPTIONAL: include this if you want history support -->
    <iframe src="javascript:''" id="__gwt_historyFrame" tabIndex='-1' style="position:absolute;width:0;height:0;border:0"></iframe>
  </body>
</html> 
```

为了向 Google WT 表明可以信任 Google adsense 的站点，您需要将正则表达式匹配 URL 添加到 -whitelist 命令行参数。

请注意，这可能无法解决上述“我为什么抛弃 GWT”文章中描述的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T14:34:18.400

你可以看看我对 InfoQ的[采访。](http://www.infoq.com/articles/progwt)它包括我书中的一个示例章节，它恰好是关于 SEO 的。

这不是微不足道的，但我认为本章中的解决方案让 GWT 在 SEO 很重要的环境中很好地工作。基本的解决方案是实现我称之为“引导”的东西。这意味着您的页面获取通常会在 GWT-RPC 请求中遇到的信息并将它们序列化到页面中。然后，GWT 小部件在没有 RPC 请求的情况下加载此信息。当您的页面将信息序列化为 JavaScript 时，也很容易将 <noscript> 写入可用于 SEO 的页面。

请查看此处包含的 PDF：[InfoQ GWT](http://www.infoq.com/articles/progwt)，其中包含所有细节。整个示例项目在这里：[google code](http://code.google.com/p/tocollege-net/) with source on github。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-19T09:27:29.473

如果您真的希望 AdSense 有点“内部”GWT，我会使用 Frame 小部件。基本上，Frame 小部件会在您的 GWT 代码中生成一个 <iframe ...>。首先，我认为 iframe，呃！但是 <iframe> 标记仍然是[HTML5 规范](http://www.w3.org/TR/html5-diff/)的一部分，甚至已经被一些似乎正是为了这个“沙盒”目的而存在的属性扩展了。并且使用相应的 CSS 样式，您的 <iframe> 周围不会有任何滚动条。

这是实际的解决方案：

你应该把

```
<ui:style>
    .sponsor {
    border: 0em;
    width: 20em;
    height: 6em;
    float: right;
    display: inline;
    }
</ui:style>
<g:HTMLPanel>
    <g:Frame ui:field="sponsor" url="issue/extern/Google-AdSense.html" styleName="{style.sponsor}"/>
</g:HTMLPanel> 
```

进入你的[*.ui.xml*](http://code.google.com/p/loxal/source/browse/Lox/src/org/loxal/lox/service/issue/client/Header.ui.xml?spec=svnfc42cd1384513d9a394334b2d12fb4531a428db6&r=d4313215307c66c15cb0f155670d0a678e2ae3d1)*文件和相应的逻辑*[.java](http://code.google.com/p/loxal/source/browse/Lox/src/org/loxal/lox/service/issue/client/Header.java?spec=svnfc42cd1384513d9a394334b2d12fb4531a428db6&r=d4313215307c66c15cb0f155670d0a678e2ae3d1)文件：

```
@UiField
    Frame sponsor; 
```

此外，您应该将实际的 Google AdSense 代码（<script> 内容）放入 GWT 公用文件夹内的单独 HTML 文件中，在本例中，该文件称为*Google-AdSense.html*，位于公用文件夹内的*extern**文件*夹内。**在这种情况下，问题**（在 Frame *url*属性中）是 GWT 输出文件夹。

 ****[它的外观如下](http://lox.loxal.org)：右上角的广告。

顺便说一句，这也是将 Google Analytics 代码嵌入 GWT 的方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-31T17:33:18.433

这是我的做法。我在这里有一个演示和源代码：[http ://code.google.com/p/gwt-examples/wiki/DemoGwtAdsene](http://code.google.com/p/gwt-examples/wiki/DemoGwtAdsene)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-23T12:58:53.363

如果您在创建主机页面时要小心，您可以同时使用 AdSense 和 GWT，而无需使用框架或其他技巧。

关键是将您的 AdSense 代码包含在主机页面中，然后操作包含广告的 dom 元素，但**不要将**其与页面分离。因此，只要不更改 dom 结构，您就可以将广告重新定位到其他 gwt 代码的正文中。

如果您确实分离并重新附加包含的 dom 元素，那么它似乎可以在 Chrome 和 Firefox 中工作，但 IE 将显示一个空白区域。我最初尝试将广告 DIV 元素移动到 DockLayoutPanel 中，并认为一切都很好，直到我在 IE 中进行了迟到的测试。

所以这没关系：

```
Element element = Document.get().getElmentById("ad");
element.getStyle().setPosition(ABSOLUTE);
element.getStyle().setTop(20, PX); 
```

但这不是：

```
myPanel.add(ElementWrapper.wrap(element)); 
```

因为将一个小部件添加到另一个小部件会重新成为它的父级。

这意味着您不能使用任何内置的 LayoutPanel 内容来保存您的广告 div，因为 Layout 无法包装现有元素（它在其构造函数中创建自己的 DIV）。您也许可以修改布局面板的内容，以便它包装一个元素并且不会重新设置它的父级......但我还没有尝试过。

我已经在 IE6+、Chrome 和 Firefox 中测试了结果。缺点是除非您加载新页面，否则您无法刷新广告。但在我的例子中，GWT 被用来增强 html 页面，所以这不是问题。无论如何...用户是否更有可能点击不同的广告而不是他们多次阅读的广告？不确定它是否如此重要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-13T18:59:55.817

我可以使用 DFP Small Business + Async Publisher tag + AdSense 集成来做到这一点：

这是代码：

在您的主机页面上，放置您的发布商标签，例如：

```
 <head>
        <script type="text/javascript" src="http://www.googletagservices.com/tag/js/gpt.js"></script>
            <script type="text/javascript">
              var slot1 = googletag.defineUnit('/XXXX/ca-pub-YYYYYYYYYYYYYYY/transaction', [468, 60], 'div-gpt-ad-ZZZZZZZ-0').addService(googletag.pubads());
              googletag.pubads().enableSingleRequest();
              googletag.enableServices();
            </script>

...
    </head> 
```

我用 uiBinder 创建了一个视图，其中一个 div 的头部指定了 id，如下所示：

```
 <g:HTMLPanel height="62px" width="100%">

            <div id='div-gpt-ad-ZZZZZZZ-0' style='width:470px; height:60px;'>
            </div>
    </g:HTMLPanel> 
```

在视图的 onLoad() 方法中，初始化广告，如下所示：

```
@Override
protected void onLoad() {

    setupAd();
}

public static native void setupAd() /*-{
    $wnd.googletag.cmd.push(function() {$wnd.googletag.display('div-gpt-ad-ZZZZZZZ-0')});
}-*/; 
```

要刷新广告，只需为 head 指定的插槽调用刷新广告：

```
public static native void refreshAd() /*-{
    $wnd.googletag.pubads().refresh([$wnd.slot1]);
}-*/; 
```

就这样！

有关发布商代码的详细信息，请查看： http: [//support.google.com/dfp_sb/bin/answer.py ?hl=en&answer=1649768](http://support.google.com/dfp_sb/bin/answer.py?hl=en&answer=1649768)

现在我正在努力了解如何让 AdSense 机器人抓取我的 ajax 应用程序。我已经实现了 Ajax Crawling 方案：

[https://developers.google.com/webmasters/ajax-crawling/docs/getting-started](https://developers.google.com/webmasters/ajax-crawling/docs/getting-started)

但我从 AdSense 论坛获得的信息表明，AdSense 机器人（Mediapartners-Google）不适用于“转义片段”Ajax 方案。有人知道谷歌是否计划在这方面取得任何进展吗？

这将这种方法限制为仅提供基于兴趣的广告，因为基于上下文的广告服务依赖于 ajax 抓取方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T23:06:31.853

Google 的 AdSense 机器人会抓取您的网页以确定要投放的广告。因此，您不应该将 AdSense 放置在主要包含动态内容的网页上。它不会很好地工作。

也许您应该研究其他广告程序？

# iphone - 仪器 - 目标过早终止而无法收集数据

> ID：538678
> 
> 赞同：1
> 
> 时间：2009-02-11T20:42:38.563
> 
> 标签：iphone, profiling, instruments

我正在使用我的 iPhone 作为开发设备。每当我在 iPhone 上使用 Instruments 运行应用程序（Instruments->Launch Executable->my app）时，该应用程序都会启动，但我会收到 Instruments 主题中提到的错误。

我已尝试从 xcode 中删除该设备并再次将其添加为开发设备，但我仍然遇到相同的错误。有人可以告诉我如何解决这个问题。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-14T08:12:07.907

做了一个新的证书供应配置文件例程并将捆绑标识符更改为读取 myAppId.somethingForTheStar.${PRODUCT_NAME:identifier}

此外，如果您在 TextEdit 中打开 mobileprovision 并搜索

```
<key>get-task-allow</key> 
```

如果密钥的值为**true**，请确保在您的 Entitlements.plist 文件中选中该选项（尽管 Apple 开发人员门户网站说它应该未选中 - 理想情况下应该是，如果您的 mobileprovision 文件希望它被选中，请保持选中）

奇怪的是，我必须使用 Entitlements.plist 并检查“get-task-allow”以检查 Debug 配置文件，并取消选中 Distribution profile 以使各个配置文件正常工作！

希望对某人有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:47:57.993

会正常崩溃吗？还是只使用仪器？

我对仪器和应用程序安装有很多奇怪之处，只有完全恢复 iPhone/iPod Touch 才能解决这些问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-17T02:59:25.390

我让它只与我的**开发**配置文件一起工作，这不是我的分发配置文件。

`get-task-allow`我还确保我在项目和目标中具有相同的配置文件并打开`Entitlements.plist`

它有时仍然无法正常工作，然后我重新启动 xcode 拔下/插入我的 iphone，清理目标并通过 Xcode 从 Xcode 运行`Start with Performance Tool`仪器

顺便说一下，XCode 3.1 / SDK 3.0。希望使用 SDK 3.1（我现在正在下载）不会那么痛苦。

哦，是的，我的应用程序有时会在“CPU Sampler”期间崩溃，我认为这与仪器有关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T23:54:53.880

确保您正在编译为调试而不是发布

还要确保您对项目和目标都使用开发配置文件

# iphone - 我有这个声明的泄漏吗？

> ID：538694
> 
> 赞同：3
> 
> 时间：2009-02-11T20:45:43.250
> 
> 标签：iphone, objective-c, cocoa-touch, memory-management

声明是：

```
//Pass the copy onto the child controller
self.childController.theFoodFacilityCopy = [self.theFoodFacility copy]; 
```

我的财产设置为：

```
@property (nonatomic, retain) FoodFacility *theFoodFacilityCopy; 
```

我认为我有泄漏的原因是因为`copy`保留了值，然后我的点语法属性也保留了值。双重保留。

写上述语句的正确方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-11T20:53:41.377

是的，你那里确实有泄漏。

```
SomeClass *someObj = [self.theFoodFacility copy];
self.childController.theFoodFacilityCopy = someObj;
[someObj release]; 
```

这也反映了初始化对象的推荐方法：

```
SomeClass *someObj = [[SomeClass alloc] init];
self.someProperty = someObj;
[someObj release]; 
```

在这两种情况下，第一行都返回一个保留计数为 1 的对象，之后您对其进行相同的处理。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:06:07.493

正如其他人所说，这确实是一个泄漏。如果您希望以这种方式使用副本，则很可能您的属性应该被声明为副本，并且合成访问器将为您完成工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:01:32.793

你说的对。最干净的方法是

```
id temp = [self.theFoodFacitlity copy];
self.childController.theFoodFacilityCopy = temp;
[temp release] 
```

您想大量阅读[有关内存管理的苹果网站，](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)直到这些规则成为第二天性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T22:59:08.657

这样做与仅将属性设置为复制相比有什么优势？

```
@property (nonatomic, copy) FoodFacility *theFoodFacilityCopy; 
```

# c# - 如何在c#中使用DateTime获取下个月相同的时间和日期

> ID：538695
> 
> 赞同：2
> 
> 时间：2009-02-11T20:45:44.797
> 
> 标签：c#, datetime

我有 ac# DateTime 对象，我需要将它增加一个月。

例子：

```
input           output
-------------------------------
Jan 12, 2005    Feb 12, 2005
Feb 28, 2009    Mar 28, 2009
Dec 31, 2009    Jan 31, 2010
Jan 29, 2000    Feb 29, 2000
Jan 29, 2100    Error: no Feb 29, 2100 
```

做这个的最好方式是什么。

我的第一个想法（除了一些内置代码）是从片段中构造一个新的 DateTime 并自己处理滚动到年份

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T20:51:08.917

这是一个完整的程序，显示了问题中给出的示例。如果真的不应该这样调用，您可能希望在 OneMonthAfter 中使用异常。

```
using System;
using System.Net;

public class Test
{
    static void Main(string[] args)
    {
        Check(new DateTime(2005, 1, 12));
        Check(new DateTime(2009, 2, 28));
        Check(new DateTime(2009, 12, 31));
        Check(new DateTime(2000, 1, 29));
        Check(new DateTime(2100, 1, 29));
    }

    static void Check(DateTime date)
    {
        DateTime? next = OneMonthAfter(date);
        Console.WriteLine("{0} {1}", date,
                          next == null ? (object) "Error" : next);
    }

    static DateTime? OneMonthAfter(DateTime date)
    {
        DateTime ret = date.AddMonths(1);
        if (ret.Day != date.Day)
        {
            // Or throw an exception
            return null;
        }
        return ret;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T20:56:50.823

```
using System;

public static class Test
{
    public static void Main()
    {
        string[] dates = { "Jan 12, 2005", "Feb 28, 2009", "Dec 31, 2009", "Jan 29, 2000", "Jan 29, 2100" };
        foreach (string date in dates)
        {
            DateTime t1 = DateTime.Parse(date);
            DateTime t2 = t1.AddMonths(1);
            if (t1.Day != t2.Day)
                Console.WriteLine("Error: no " + t2.ToString("MMM") + " " + t1.Day + ", " + t2.Year);
            else
                Console.WriteLine(t2.ToString("MMM dd, yyyy"));
        }
        Console.ReadLine();   
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-26T19:09:57.547

这对我有用：

```
 DateTime d = DateTime.Now;
    d.AddMonths(1); 
```

# sharepoint - SharePoint 保留页面属性和 WebPart

> ID：538697
> 
> 赞同：1
> 
> 时间：2009-02-11T20:46:38.663
> 
> 标签：sharepoint

嗨，我想知道是否可以在 sharepoint 中保存页面。我想保存默认页面，并将其复制到镜像服务器上。我希望 Web 部件位于同一位置，并且 Web 部件的属性保持不变。有什么建议么？谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:46:51.293

您还可以考虑使用[SharePoint 内容部署](http://blogs.msdn.com/sharepoint/archive/2006/05/02/588140.aspx)，该部署旨在将页面从主站点推送到克隆站点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T02:23:24.517

您可以在 SharePoint Designer 中查看页面并将其与其页面布局取消关联。这会将页面的内容带入 Designer。然后，您可以将其复制到另一个文件。然而，这充满了问题：

1.  不会复制任何依赖列表和相对 url。您必须手动移动它。
2.  通过将页面与其布局分离，您实际上会减慢页面的检索速度。由于这也必须在目标页面上完成，因此两个页面都会变慢。

我发现导出站点然后将其导入目标站点总是更好。

我不宽恕这个产品，因为我没有使用它，但你也可以尝试：- [http://www.softlow.com/windows/business/management/free/web-part-page-cloner-for-sharepoint .html](http://www.softlow.com/windows/business/management/free/web-part-page-cloner-for-sharepoint.html)

# c# - 为什么 GetHashCode 不是 .NET 中的 HashCode 之类的属性

> ID：538708
> 
> 赞同：10
> 
> 时间：2009-02-11T20:49:27.517
> 
> 标签：c#, .net, hashcode

为什么 GetHashCode 不是 .NET 中的 HashCode 之类的属性？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-11T20:51:49.273

可能是因为它需要计算，并且将其作为属性公开可能意味着哈希码已经免费提供。

*编辑：* 关于此的指南：[属性与方法](http://msdn.microsoft.com/en-us/library/bzwdh01d(VS.71).aspx#cpconpropertyusageguidelinesanchor1)

“该操作非常昂贵，以至于您希望与用户沟通，他们应该考虑缓存结果。”

也许 GetHashCode 在某些情况下已经足够昂贵了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T21:08:51.107

我不认为有什么好的理由。的任何实现都`GetHashCode`应该足够快以放入属性中。也就是说，.Net 框架中有[很多设计缺陷](https://stackoverflow.com/questions/411906/c-net-design-flaws)，有的很小，有的很严重。这个好像很小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-28T15:09:15.250

通常不可能为一个类定义一个 HashCode，因为：

> 例如，类的对象没有明确定义的身份概念。

因此，通常使 GetHashCode() 方法抛出 NotImplementedException。如果 HashCode 是一个属性，这当然会出现各种问题，因为大多数人（和调试器）认为获取属性的值总是有效的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-02T11:07:37.010

除了一个属性只不过是一个 getter 和一个 setter 方法之外，从设计的角度来看，一个属性不应该包含除了初始化或验证之外的任何计算，例如：

```
private object _obj;
public object Obj
{
  get
  {
    if(_obj == null)
    {
      _obj = new object();
    }
    return _obj;
  }
  set
  {
    if(value == badvalue)
    {
      throw new ArgumentException("value");
    }
    _obj = value;
  }
} 
```

GetHashCode() 不包含大量计算，但它可以包含如此长时间运行的操作（只是因为它可以以复杂的方式计算对象的哈希码），这就是为什么它是方法而不是属性的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T21:11:05.220

仅当它们背后的计算非常快或缓存时才应使用属性

除了大多数时候，属性中唯一的逻辑应该是验证

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-11T21:14:12.810

您必须记住，.NET Framework 旨在通过多种语言进行访问。

理论上，您可以创建一个无法正确覆盖属性的编译器。虽然这会产生一个非常糟糕的编译器，但它不一定是非法的。（记住属性只是一些元数据的方法）

# .net - 为什么我不应该使用 GAC？

> ID：538710
> 
> 赞同：24
> 
> 时间：2009-02-11T20:49:44.367
> 
> 标签：.net, gac

沿着 stackoverflow 这条线提出了一些问题，例如 [使用 GAC 的优点和缺点是什么](https://stackoverflow.com/questions/23578/what-are-the-advantages-and-disadvantages-of-using-the-gac) 以及[何时以及何时不安装到 GAC 中？](https://stackoverflow.com/questions/498361/when-and-when-not-to-install-into-the-gac)并且有几个人在网络[示例](http://flimflan.com/blog/WhenShouldIUseTheGAC.aspx)上问过它。对于不使用 GAC，我没有任何令人信服的论据。我确信我很天真，但似乎使用 GAC 比不使用它有更多好处（例如性能和版本控制问题）。

**为什么我不应该使用 GAC？**

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-11T21:04:33.533

Chris Sells 给出[了尽可能避免 GAC 的最佳理由](http://sellsbrothers.com/12503)：

> 这归结为任何用于更新的共享点，无论是 COM CLSID、windows\system32 还是 GAC，都是危险的，应该避免。这就是为什么首选的 .NET 部署方案是“xcopy 部署”的原因，即拥有您自己的每个 DLL 的私有副本，您可以将其与应用程序的其余部分一起测试和部署。
> 
> “啊哈！” 你说。“GAC 支持程序集的多个版本！当 foo.dll 更新到 v1.1 时，v1.0 就在它旁边，这样您的应用程序*就不会*中断！” 当然，这绝对是真的。但如果是这样，你又何必在意呢？我的意思是，如果有一个新的程序集可用，但您的应用程序没有选择它，它有什么区别？
> 
> “啊哈！，你说。“我可以将发布者策略与我的程序集一起放入 GAC，以便应用程序*自动*更新！ ，你要承担一项艰巨的责任：确保接近 0% 的应用程序，无论你是否知道，都不会崩溃。这是一项了不起的责任，需要 MS 数百人年才能完成.NET Framework 的每个新版本。即使进行了数百人年的测试，我们仍然无法始终正确。如果这是您愿意承担的测试责任，我很佩服您。就个人而言，我没有道德上的毅力来承担这个负担。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:00:11.547

我们有一个应用程序在任何给定时间加载了 50 多个 .NET 程序集，并且我们不使用 GAC。如果您必须同时运行多个版本的应用程序，我认为 GAC 最有用，每个版本都需要加载同一共享库的不同版本。

即使那样，如果两个应用程序版本位于不同的目录中，那么只要您将它们的二进制文件分开，您仍然不需要 GAC。

我一直觉得它对于制作 SDK/API 的人来说更有用，因为他们的 SDK 的不同版本可以由多个应用程序加载并和谐相处。因此，如果您在这条船上，那么 GAC 可能是有意义的。

有一些边缘案例需要 GAC（我认为 .NET COM+ 组件在某些情况下需要在 GAC 中），但我认为这些只是一小部分案例。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T20:56:44.690

如果您希望对应用程序进行较少干扰的部署。通过仅安装在您的应用程序目录中，您可以非常轻松地复制部署和清理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T20:57:45.563

如果您有一个不占用大量资源的小型应用程序，那么我不想将文件安装到 GAC 中。

它会创建另一个依赖项，我需要在卸载时检查它，并且过去曾对滥用注册表的程序表示过很多悲痛。

调试/维护也会更容易一些，因为您可以轻松验证所有适当的库是否都在应用程序的可执行路径中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-11T21:19:26.447

我问过类似的问题（[我真的需要使用全局程序集缓存（GAC）吗？](https://stackoverflow.com/questions/313842/do-i-ever-really-need-to-use-the-global-assembly-cache-gac)）

最好的答案是“GAC 仅在您注册要重用的库时才有用。”

换句话说，**如果您不打算在不同应用程序之间共享库，请不要使用它**。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-16T11:53:22.853

GAC有什么用？

i) 您可以在一台机器上存储同一个程序集的多个版本并并排执行它们。ii) 将相同的组件存储在机器上的多个位置使用额外的不需要的存储空间。将它们放在一个位置可以降低成本。iii) 在机器上提供程序集变得更简单，因为您只需更新一个位置（GAC），而不是搜索存储在机器上的程序集的多个实例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-11T20:51:47.963

有时在托管网站上，您无法控制 GAC，并且某些托管服务提供商不允许您将任何程序集安装到 GAC 中。我以前遇到过这种情况，这是一个巨大的痛苦。

# c++ - 如何删除 STD::List 中最接近某个 x,y 的“点”对象？

> ID：538711
> 
> 赞同：4
> 
> 时间：2009-02-11T20:49:47.297
> 
> 标签：c++, list, pointers, distance

我有一个点类，如：

```
class Point {
public:
    int x, y;
    Point(int x1, int y1)
    {
        x = x1;
        y = y1;
    }
}; 
```

和点列表：

```
std::list <Point> pointList;
std::list <Point>::iterator iter; 
```

我正在向我的 pointList 推送点数（尽管如果尚未推送任何点数，该列表可能还没有包含点数）。

我有两个问题：

**如何从列表中删除与某个任意 (x, y) 的最近点？**

假设我有 x,y (5,12)，我想在列表中找到最接近该点的点并将其从 STD::List 中删除。

我知道我必须使用距离公式，并且必须使用迭代器遍历列表，但是我在概念化如何在遍历列表时跟踪哪个点最接近时遇到了一些麻烦.

**如何返回给定（x，y）的x半径内的点数组或列表？**

类似于最后一个问题，除了我需要一个指向给定（x，y）半径内的“点”对象的指针列表。另外，我应该返回一个数组还是一个列表？

如果有人可以帮助我，我仍然在 C++ 中苦苦挣扎，我很感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T21:02:07.660

在循环遍历列表时，使用 std::list::iterator 变量来跟踪最近点。当您到达列表末尾时，它将包含最近的点，可用于擦除该项目。

```
void erase_closest_point(const list<Point>& pointList, const Point& point)
{
    if (!pointList.empty())
    {
        list<Point>::iterator closestPoint = pointList.begin();
        float closestDistance = sqrt(pow(point.x - closestPoint->x, 2) +
                                     pow(point.y - closestPoint->y, 2));

        // for each point in the list
        for (list<Point>::iterator it = closestPoint + 1;
             it != pointList.end(); ++it)
        {
            const float distance = sqrt(pow(point.x - it->x, 2) +
                                        pow(point.y - it->y, 2));

            // is the point closer than the previous best?
            if (distance < closestDistance)
            {
                // replace it as the new best
                closestPoint = it;
                closestDistance = distance
            }
        }

        pointList.erase(closestPoint);
    }
} 
```

在给定点的半径内构建点列表是类似的。请注意，一个空的半径列表通过引用传递给函数。通过引用将点添加到列表中将消除在按值返回向量时复制所有点的需要。

```
void find_points_within_radius(vector<Point>& radiusListOutput,
                               const list<Point>& pointList,
                               const Point& center, float radius)
{
    // for each point in the list
    for (list<Point>::iterator it = pointList.begin();
         it != pointList.end(); ++it)
    {
        const float distance = sqrt(pow(center.x - it->x, 2) +
                                    pow(center.y - it->y, 2));

        // if the distance from the point is within the radius
        if (distance > radius)
        {
            // add the point to the new list
            radiusListOutput.push_back(*it);
        }
    }
} 
```

在以下情况下再次使用副本：

```
struct RadiusChecker {
    RadiusChecker(const Point& center, float radius)
        : center_(center), radius_(radius) {}

    bool operator()(const Point& p)
    {
        const float distance = sqrt(pow(center_.x - p.x, 2) +
                                    pow(center_.y - p.y, 2));
        return distance < radius_;
    }

private:
    const Point& center_;
    float radius_;
};

void find_points_within_radius(vector<Point>& radiusListOutput,
                               const list<Point>& pointList,
                               const Point& center, float radius)
{
    radiusListOutput.reserve(pointList.size());
    remove_copy_if(pointList.begin(), pointList.end(),
                   radiusListOutput.begin(),
                   RadiusChecker(center, radius));
} 
```

*请注意，如果您需要额外的性能，可以删除**sqrt ，因为幅度的平方同样适用于这些比较。**此外，如果您真的想提高性能而不是考虑允许像[四叉树](http://en.wikipedia.org/wiki/Quadtree)这样的场景分区的数据结构。第一个问题与[碰撞检测](http://en.wikipedia.org/wiki/Collision_detection)密切相关，并且有大量关于该主题的有价值信息可用。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T20:59:35.497

你对它应该如何制作是正确的。只需遍历列表中的所有项目并跟踪已经找到的最小距离，以及您在两个变量中找到的最近点，如果问题如此，请确保您不将点与自身匹配。然后只需删除您找到的点。

这究竟是如何制作的，留作练习。

如果要从另一个点获取给定半径内的点列表，请迭代该列表并构建第二个列表，该列表仅包含指定范围内的点。

同样，它是如何在代码中生成的，留给您作为练习。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T22:02:01.400

您可以使用 STL 和[Boost.Iterators](http://www.boost.org/doc/libs/1_38_0/libs/iterator/doc/index.html)和[Boost.Bind](http://www.boost.org/doc/libs/1_38_0/libs/bind/bind.html)的组合来执行此操作——为了您的方便，我将解决您的问题的整个源代码粘贴到此处：

```
#include <list>
#include <cmath>
#include <boost/iterator/transform_iterator.hpp>
#include <boost/bind.hpp>
#include <cassert>

using namespace std;
using namespace boost;

struct Point {
    int x, y;
    Point() : x(0), y(0) {}
    Point(int x1, int y1) : x(x1), y(y1) {}
    Point(Point const & other) : x(other.x), y(other.y) {}
    Point & operator=(Point rhs) { rhs.swap(*this); return *this; }
    void swap(Point & other) { std::swap(other.x, x); std::swap(other.y, y); }
};

double point_distance(Point const & first, Point const & second) {
    double x1 = first.x;
    double x2 = second.x;
    double y1 = first.y;
    double y2 = second.y;
    return sqrt( ((x2 - x1) * (x2 -x1)) + ((y2 - y1) * (y2 - y1)) );
}

int main(int argc, char * argv[]) {
    list<Point> points;
    points.push_back(Point(1, 1));
    points.push_back(Point(2, 2));
    points.push_back(Point(3, 3));
    Point source(0, 0);
    list<Point>::const_iterator closest = 
        min_element(
                make_transform_iterator(
                    points.begin(),
                    bind(point_distance, source, _1)
                    ),
                make_transform_iterator(
                    points.end(),
                    bind(point_distance, source, _1)
                    )
                ).base();
    assert(closest == points.begin());
    return 0;
} 
```

解决方案的核心是使用`point_distance`函数变换迭代器变换列表中的每个元素，然后从所有距离中获取最小距离。您可以在遍历列表时执行此操作，最后进入`transform_iterator`以获取基本迭代器（使用`base()`成员函数）。

现在你有了那个迭代器，你可以`assert(closest == points.begin())`用`points.erase(closest)`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T21:03:38.590

您必须保留迭代器以在之后将其删除。

```
std::list<Point>::iterator closest;
std::list<Point>::iterator it = pointList.begin();
double min_dist=dist(your_point, *it);
++it;
for (; it != pointList.end(); ++it)
{
        double actual_dist = dist(your_point, *it);
        if (actual_dist < min_dist)
        {
                min_dist = actual_dist;
                closest = it;
        }
}

pointList.erase(closest); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T21:19:54.853

我同意以前的解决方案，只是想添加另一个想法。尽管您的 Point 类不是很大，因此副本并不是真正的问题，但您可以考虑将 Point* 用于您的列表。这样，当您创建第二个列表时，您将存储指向同一类的指针。这样做的缺点是，如果您从多个列表中删除而没有管理所有创建点的“主”，则如果您没有删除基础类或意外删除仍然存在的类，则可能会造成内存泄漏在另一个列表中使用。不过，需要考虑的事情取决于您的系统如何发展。

# c# - 解析器错误消息：文件“/TestSite/Default.aspx.cs”不存在

> ID：538719
> 
> 赞同：31
> 
> 时间：2009-02-11T20:52:06.933
> 
> 标签：c#, asp.net

短篇故事。这个站点是由我的一个朋友创建的，他不太了解 C# 或 asp。并且最初是在 VS 2k3 中创建的。当我将其转换为 VS 2k8 时，这些错误开始出现，我还设法解决了其他编译​​问题（似乎已发布到 VS 2k8 想要的设计文件）

得到的错误信息：

> 解析服务此请求所需的资源时出错。请查看以下特定的解析错误详细信息并适当地修改您的源文件。
> 
> 解析器错误消息：文件“/TestSite/Default.aspx.cs”不存在。
> 
> 源错误：
> 
> 第 1 行： `<%@ Page Language="C#" MasterPageFile="~/Site.master" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="GuildStats._Default" %>`
> 
> 第 2 行：
> 
> 第 3 行： `<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="Server">`

默认值.aspx.cs

```
namespace GuildStats
{
    public partial class _Default : System.Web.UI.Page
    { 
```

默认值.aspx

```
<%@ Page Language="C#" MasterPageFile="~/Site.master" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="GuildStats._Default" %> 
```

站点.master.cs

```
namespace GuildStats
{
    public partial class Site : System.Web.UI.MasterPage { }
} 
```

站点主

```
<%@ Master Language="C#" AutoEventWireup="true" CodeFile="Site.master.cs" Inherits="GuildStats.Site" %> 
```

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-02-11T21:11:00.680

在`Default.aspx`更改`CodeFile`为`CodeBehind`. 您可能必须对`Site.master`.

请参阅：[CodeFile 和 Code-Behind](http://www.ddj.com/windows/187202007)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-01-31T09:14:00.750

网站项目使用 CodeFile，Web 应用程序项目使用 CodeBehind。CodeFile 需要源文件，它是在页面加载时动态编译的，CodeBehind 需要编译后的代码。

我的猜测是，当您将项目类型从 WebApp 更改为网站或反之亦然时，就会产生您的问题。如果这样做，您必须手动更改现有文件中的指令，新文件将自动具有正确的指令。

# c# - 是否有一个 IDictionary 实现，在缺少键时，返回默认值而不是抛出？

> ID：538729
> 
> 赞同：150
> 
> 时间：2009-02-11T20:54:33.357
> 
> 标签：c#, .net, hash, dictionary

如果缺少键，索引器`Dictionary`会引发异常。是否有一个实现`IDictionary`，而不是返回`default(T)`？

我知道该`TryGetValue()`方法，但这不可能与 LINQ 一起使用。

这会有效地做我需要的吗？：

```
myDict.FirstOrDefault(a => a.Key == someKeyKalue); 
```

我不认为它会因为我认为它会迭代键而不是使用哈希查找。

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2009-02-11T20:58:26.403

确实，这根本没有效率。

根据评论，在 .Net Core 2+ / NetStandard 2.1+ / Net 5 中，[MS 添加了扩展方法`GetValueOrDefault()`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions.getvalueordefault?view=netstandard-2.1)

对于早期版本，您可以自己编写扩展方法：

```
public static TValue GetValueOrDefault<TKey,TValue>
    (this IDictionary<TKey, TValue> dictionary, TKey key)
{
    TValue ret;
    // Ignore return value
    dictionary.TryGetValue(key, out ret);
    return ret;
} 
```

或者使用 C# 7.1：

```
public static TValue GetValueOrDefault<TKey,TValue>
    (this IDictionary<TKey, TValue> dictionary, TKey key) =>
    dictionary.TryGetValue(key, out var ret) ? ret : default; 
```

这使用：

*   表达式主体方法 (C# 6)
*   输出变量 (C# 7.0)
*   默认文字 (C# 7.1)

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2019-01-10T06:32:30.497

如果您使用的是 .NET Core 2 或更高版本 (C# 7.x)，则会引入[CollectionExtensions](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions?view=netcore-2.2)类，如果字典中没有键，您可以使用[GetValueOrDefault方法获取默认值。](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions.getvalueordefault?view=netcore-2.2#System_Collections_Generic_CollectionExtensions_GetValueOrDefault__2_System_Collections_Generic_IReadOnlyDictionary___0___1____0_)

```
Dictionary<string, string> colorData = new Dictionary<string, string>();
string color = colorData.GetValueOrDefault("colorId", string.Empty); 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-09-20T06:25:20.787

携带这些扩展方法可以帮助..

```
public static V GetValueOrDefault<K, V>(this IDictionary<K, V> dict, K key)
{
    return dict.GetValueOrDefault(key, default(V));
}

public static V GetValueOrDefault<K, V>(this IDictionary<K, V> dict, K key, V defVal)
{
    return dict.GetValueOrDefault(key, () => defVal);
}

public static V GetValueOrDefault<K, V>(this IDictionary<K, V> dict, K key, Func<V> defValSelector)
{
    V value;
    return dict.TryGetValue(key, out value) ? value : defValSelector();
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-06-30T07:40:31.210

`Collections.Specialized.StringDictionary`在查找缺失键的值时提供非异常结果。默认情况下它也不区分大小写。

### 注意事项

它只对它的特殊用途有效，并且——在泛型之前被设计——如果你需要查看整个集合，它没有一个很好的枚举器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-10-02T16:24:31.953

如果您使用的是 .Net Core，则可以使用[CollectionExtensions.GetValueOrDefault](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions.getvalueordefault?view=netcore-3.0)方法。这与接受的答案中提供的实现相同。

```
public static TValue GetValueOrDefault<TKey,TValue> (
   this System.Collections.Generic.IReadOnlyDictionary<TKey,TValue> dictionary,
   TKey key); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-10-05T16:32:55.213

```
public class DefaultIndexerDictionary<TKey, TValue> : IDictionary<TKey, TValue>
{
    private IDictionary<TKey, TValue> _dict = new Dictionary<TKey, TValue>();

    public TValue this[TKey key]
    {
        get
        {
            TValue val;
            if (!TryGetValue(key, out val))
                return default(TValue);
            return val;
        }

        set { _dict[key] = value; }
    }

    public ICollection<TKey> Keys => _dict.Keys;

    public ICollection<TValue> Values => _dict.Values;

    public int Count => _dict.Count;

    public bool IsReadOnly => _dict.IsReadOnly;

    public void Add(TKey key, TValue value)
    {
        _dict.Add(key, value);
    }

    public void Add(KeyValuePair<TKey, TValue> item)
    {
        _dict.Add(item);
    }

    public void Clear()
    {
        _dict.Clear();
    }

    public bool Contains(KeyValuePair<TKey, TValue> item)
    {
        return _dict.Contains(item);
    }

    public bool ContainsKey(TKey key)
    {
        return _dict.ContainsKey(key);
    }

    public void CopyTo(KeyValuePair<TKey, TValue>[] array, int arrayIndex)
    {
        _dict.CopyTo(array, arrayIndex);
    }

    public IEnumerator<KeyValuePair<TKey, TValue>> GetEnumerator()
    {
        return _dict.GetEnumerator();
    }

    public bool Remove(TKey key)
    {
        return _dict.Remove(key);
    }

    public bool Remove(KeyValuePair<TKey, TValue> item)
    {
        return _dict.Remove(item);
    }

    public bool TryGetValue(TKey key, out TValue value)
    {
        return _dict.TryGetValue(key, out value);
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return _dict.GetEnumerator();
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-15T15:38:27.917

可以为字典的键查找功能定义一个接口。我可能会将其定义为：

```
Interface IKeyLookup(Of Out TValue)
  Function Contains(Key As Object)
  Function GetValueIfExists(Key As Object) As TValue
  Function GetValueIfExists(Key As Object, ByRef Succeeded As Boolean) As TValue
End Interface

Interface IKeyLookup(Of In TKey, Out TValue)
  Inherits IKeyLookup(Of Out TValue)
  Function Contains(Key As TKey)
  Function GetValue(Key As TKey) As TValue
  Function GetValueIfExists(Key As TKey) As TValue
  Function GetValueIfExists(Key As TKey, ByRef Succeeded As Boolean) As TValue
End Interface 
```

具有非泛型键的版本将允许使用使用非结构键类型的代码的代码允许任意键变化，这对于泛型类型参数是不可能的。不应允许将可变对象`Dictionary(Of Cat, String)`用作可变对象，`Dictionary(Of Animal, String)`因为后者允许`SomeDictionaryOfCat.Add(FionaTheFish, "Fiona")`. `Dictionary(Of Cat, String)`但是使用 mutable作为 immutable并没有错`Dictionary(Of Animal, String)`，因为`SomeDictionaryOfCat.Contains(FionaTheFish)`它应该被认为是一个格式完美的表达式（它应该返回`false`，而不必搜索字典，对于任何不是 type 的东西`Cat`）。

不幸的是，能够实际使用这样一个接口的唯一方法是将一个`Dictionary`对象包装在一个实现该接口的类中。但是，根据您正在做的事情，这样的界面和它所允许的差异可能会让您付出努力。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-07T02:07:24.583

如果您使用的是 ASP.NET MVC，则可以利用 RouteValueDictionary 类来完成这项工作。

```
public object this[string key]
{
  get
  {
    object obj;
    this.TryGetValue(key, out obj);
    return obj;
  }
  set
  {
    this._dictionary[key] = value;
  }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-05-10T04:30:22.210

**我使用封装创建了一个行为与STL 映射**非常相似的 IDictionary ，适用于那些熟悉 C++ 的人。对于那些不是：

*   如果键不存在，则下面 SafeDictionary 中的 indexer get {} 返回默认值，***并将***该键添加到具有默认值的字典中。这通常是所需的行为，因为您正在查找最终会出现或很有可能出现的项目。
*   方法 Add(TK key, TV val) 的行为类似于 AddOrUpdate 方法，替换存在的值（如果存在）而不是抛出。我不明白为什么 m$ 没有 AddOrUpdate 方法，并且认为在非常常见的情况下抛出错误是个好主意。

***TL/DR - SafeDictionary 的编写是为了在任何情况下都不会抛出异常，除了不正常的场景***，例如计算机内存不足（或着火）。它通过将 Add 替换为 AddOrUpdate 行为并返回默认值而不是从索引器中抛出 NotFoundException 来实现这一点。

这是代码：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

public class SafeDictionary<TK, TD>: IDictionary<TK, TD> {
    Dictionary<TK, TD> _underlying = new Dictionary<TK, TD>();
    public ICollection<TK> Keys => _underlying.Keys;
    public ICollection<TD> Values => _underlying.Values;
    public int Count => _underlying.Count;
    public bool IsReadOnly => false;

    public TD this[TK index] {
        get {
            TD data;
            if (_underlying.TryGetValue(index, out data)) {
                return data;
            }
            _underlying[index] = default(TD);
            return default(TD);
        }
        set {
            _underlying[index] = value;
        }
    }

    public void CopyTo(KeyValuePair<TK, TD>[] array, int arrayIndex) {
        Array.Copy(_underlying.ToArray(), 0, array, arrayIndex,
            Math.Min(array.Length - arrayIndex, _underlying.Count));
    }

    public void Add(TK key, TD value) {
        _underlying[key] = value;
    }

    public void Add(KeyValuePair<TK, TD> item) {
        _underlying[item.Key] = item.Value;
    }

    public void Clear() {
        _underlying.Clear();
    }

    public bool Contains(KeyValuePair<TK, TD> item) {
        return _underlying.Contains(item);
    }

    public bool ContainsKey(TK key) {
        return _underlying.ContainsKey(key);
    }

    public IEnumerator<KeyValuePair<TK, TD>> GetEnumerator() {
        return _underlying.GetEnumerator();
    }

    public bool Remove(TK key) {
        return _underlying.Remove(key);
    }

    public bool Remove(KeyValuePair<TK, TD> item) {
        return _underlying.Remove(item.Key);
    }

    public bool TryGetValue(TK key, out TD value) {
        return _underlying.TryGetValue(key, out value);
    }

    IEnumerator IEnumerable.GetEnumerator() {
        return _underlying.GetEnumerator();
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-07-13T16:25:14.200

从 .NET core 2.0 开始，您可以使用：

```
myDict.GetValueOrDefault(someKeyKalue) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-06T07:33:48.360

使用条件运算符检查键是否存在`ContainsKey`然后返回正常检索的值或默认值的单行程序怎么样？

```
var myValue = myDictionary.ContainsKey(myKey) ? myDictionary[myKey] : myDefaultValue; 
```

无需实现支持默认值的新 Dictionary 类，只需将查找语句替换为上面的短行即可。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-11-16T00:15:40.487

这是用于 C# 7.1 世界的@JonSkeet 版本，它还允许传入可选的默认值：

```
public static TV GetValueOrDefault<TK, TV>(this IDictionary<TK, TV> dict, TK key, TV defaultValue = default) => dict.TryGetValue(key, out TV value) ? value : defaultValue; 
```

使用两个函数来优化您想要返回的情况可能会更有效`default(TV)`：

```
public static TV GetValueOrDefault<TK, TV>(this IDictionary<TK, TV> dict, TK key, TV defaultValue) => dict.TryGetValue(key, out TV value) ? value : defaultValue;
public static TV GetValueOrDefault2<TK, TV>(this IDictionary<TK, TV> dict, TK key) {
    dict.TryGetValue(key, out TV value);
    return value;
} 
```

不幸的是，C#（还没有？）没有逗号运算符（或 C# 6 提出的分号运算符），因此对于其中一个重载，您必须有一个实际的函数体（喘气！）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-01-12T12:20:18.583

这个问题有助于确认这里`TryGetValue`扮演的`FirstOrDefault`角色。

我想提到的一个有趣的 C# 7 特性是[out variables](https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/)特性，如果您将 C# 6 中的[空条件运算符](https://msdn.microsoft.com/en-us/magazine/dn802602.aspx)添加到等式中，您的代码可能会更加简单，无需额外的扩展方法。

```
var dic = new Dictionary<string, MyClass>();
dic.TryGetValue("Test", out var item);
item?.DoSomething(); 
```

这样做的缺点是你不能像这样内联地做所有事情；

```
dic.TryGetValue("Test", out var item)?.DoSomething(); 
```

如果我们需要/想要这样做，我们应该编写一种类似 Jon 的扩展方法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-08-01T09:02:52.467

`TryGetValue`如果它是，则检查并返回默认值可能是单行的`false`。

```
 Dictionary<string, int> myDic = new Dictionary<string, int>() { { "One", 1 }, { "Four", 4} };
 string myKey = "One"
 int value = myDic.TryGetValue(myKey, out value) ? value : 100; 
```

`myKey = "One"`=>`value = 1`

`myKey = "two"`=>`value = 100`

`myKey = "Four"`=>`value = 4`

[在线尝试](https://repl.it/@aryanfirouzyan/Dictionary-Default-Value)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-17T13:56:58.613

## 现代答案

从 .NET Core 2.0 开始，有一个带有 2 个重载的内置扩展方法：

```
TValue GetValueOrDefault<TKey,TValue>(TKey)
TValue GetValueOrDefault<TKey,TValue>(TKey, TValue) 
```

用法：

```
var dict = new Dictionary<string, int>();

dict.GetValueOrDefault("foo");     // 0: the datatype's default
dict.GetValueOrDefault("foo", 2);  // 2: the specified default 
```

当然，第一个版本返回`null`可空类型。

有关更多详细信息，请参阅[文档](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.collectionextensions.getvalueordefault)。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2021-09-14T19:45:06.837

一般来说，我会支持[Jon Skeet的](https://stackoverflow.com/users/22656/jon-skeet)[答案](https://stackoverflow.com/a/538751/56984)，但是我更喜欢一个可以将默认值作为参数的实现：

```
public static TValue GetValueOrDefault<TKey, TValue> (this IDictionary<TKey, TValue> dictionary, TKey key, TValue defaultValue)
{
    if (dictionary.ContainsKey(key))
        return dictionary[key];
    else
        return defaultValue;
} 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2009-02-11T20:58:05.453

不，因为否则当键存在但存储空值时，您怎么知道区别？这可能很重要。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2020-12-19T03:19:09.030

在 .NET 5 核心中，GetValueOrDefault 扩展是开箱即用的。

```
public static TValue? GetValueOrDefault<TKey, TValue>(this IReadOnlyDictionary<TKey, TValue> dictionary, TKey key); 
```

# c++ - 寻找散列函数 /Ordered Int/ 到 /Shuffled Int/

> ID：538738
> 
> 赞同：4
> 
> 时间：2009-02-11T20:57:01.413
> 
> 标签：c++, algorithm, hash

我正在寻找可以将有序整数索引值更改为随机哈希索引的恒定时间算法。如果它是可逆的，那就太好了。我需要每个索引的哈希键都是唯一的。我知道这可以通过在大文件中查找表格来完成。IE 创建所有整数的有序集，然后随机打乱它们并以随机顺序写入文件。然后，您可以在需要时将它们读回。但这需要寻找一个大文件。我想知道是否有一种简单的方法可以根据需要使用伪随机生成器来创建序列？

[使用 PRNG 生成改组的范围，而不是](https://stackoverflow.com/questions/464476/generating-shuffled-range-using-a-prng-rather-than-shuffling)通过 [erikkallen的线性反馈移位寄存器来改组](https://stackoverflow.com/users/47161/erikkallen)[答案](https://stackoverflow.com/questions/464476/generating-shuffled-range-using-a-prng-rather-than-shuffling/515755#515755)，这看起来是正确的事情。我刚刚尝试过，但它会产生重复和孔洞。

问候大卫艾伦芬奇

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T04:16:07.320

现在的问题是您是否需要一个真正随机的映射，或者只是一个“弱”排列。假设后者，如果您在 2 的补码算术上使用无符号 32 位整数（例如），乘以任何奇数是双射和可逆映射。当然 XOR 也是如此，因此您可以尝试使用的一个简单模式是，例如

```
unsigned int hash(int x) {
   return (((x ^ 0xf7f7f7f7) * 0x8364abf7) ^ 0xf00bf00b) * 0xf81bc437;
} 
```

数字没有什么神奇之处。所以你可以改变它们，它们甚至可以是随机的。唯一的问题是被乘数必须是奇数。而且您必须使用回滚计算（忽略溢出）。这可以倒过来。要进行反演，您需要能够计算正确的互补被乘数 A 和 B，之后反演是

```
unsigned int rhash(int h) {
    return (((x * B) ^ 0xf00bf00b) * A) ^ 0xf7f7f7f7;
} 
```

您可以用数学方法计算 A 和 B，但对您来说更容易的事情就是运行一个循环并搜索它们（即离线后）。

该方程使用与乘法混合的 XOR 来使映射非线性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T21:33:14.590

您可以尝试建立一个合适的[Feistel 网络](http://en.wikipedia.org/wiki/Feistel_cipher)。这些通常用于加密（例如 DES），但至少有 64 位，因此您可能需要自己构建一个适合您需要的。它们在构造上是可逆的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:19:55.120

假设您的目标是将分组值分布在整个范围内，
似乎以某种预定义的顺序对位进行洗牌可能会奏效。
即给定 8 位 ABCDEFGH，将它们排列为 EGDBHCFA 或一些这样的模式。

代码只是一个简单的掩码、移位和添加序列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T21:26:10.127

嗯...根据您是否有很多数字，您可以使用普通的 stl 列表，并按“随机”标准对其进行排序

```
bool
nonsort(int i, int j)
{
    return  random() & 31 >16 ? true : false;
}

std::list<int> li;
// insert elements
li.sort(nonsort); 
```

然后，您可以使用普通迭代器获取所有整数。请记住使用 srand() 使用时间或任何其他伪随机值初始化随机数。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-13T15:40:44.717

对于这组约束，确实没有解决方案。将 32 位无符号散列到 32 位无符号的尝试会给您带来冲突，除非您执行一些简单的操作，例如 1 对 1 映射。每个数字都是它自己的哈希值。

# sql-server - 在数据库中存储时间 (hh:mm) 的最佳方式

> ID：538739
> 
> 赞同：116
> 
> 时间：2009-02-11T20:57:04.300
> 
> 标签：sql-server, database, database-design, datetime

我想将时间存储在数据库表中，但只需要存储小时和分钟。我知道我可以只使用 DATETIME 并忽略日期的其他组成部分，但是在不存储超出我实际需要的信息的情况下，最好的方法是什么？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-02-11T20:59:01.003

您可以将其存储为午夜过后分钟数的整数：

例如。

```
0 = 00:00 
60 = 01:00
252 = 04:12 
```

但是，您需要编写一些代码来重构时间，但这应该不难。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-02-11T21:00:31.063

如果您使用的是 SQL Server 2008+，请考虑[`TIME`](http://msdn.microsoft.com/en-us/library/bb677243.aspx)数据类型。包含更多使用示例的[SQLTeam 文章。](http://www.sqlteam.com/article/using-the-time-data-type-in-sql-server-2008)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2012-04-06T02:42:22.377

> DATETIME 开始 DATETIME 结束

我恳请您改用*两个 DATETIME 值*，标记为*event_start*和*event_end*。

**时间是一项复杂的业务**

世界上大部分地区现在已经对大多数测量采用了基于denery的度量系统，无论是对还是错。总的来说这很好，因为至少我们都同意 ag 是毫升，是立方厘米。至少大致如此。公制有很多缺陷，但至少它在国际上一直存在缺陷。

然而，随着时间的推移，我们有；1000 毫秒一秒，60 秒到一分钟，60 分钟到一小时，每半天 12 小时，每月大约 30 天，每个月甚至每年都会有所不同，每个国家/地区的时间都与其他国家/地区不同，每个国家/地区的时间格式化方式各不相同。

要消化的东西很多，但总之这么复杂的场景不可能有一个简单的解决方案。

**有些角落可以被削减，但有些角落最好不要**

尽管这里的最佳答案表明您在午夜后存储整数分钟似乎非常合理，但我已经学会避免这样做很困难。

实现两个 DATETIME 值的原因是为了提高准确性、分辨率和反馈。

当设计产生不良结果时，这些都非常方便。

**我存储的数据是否超出了要求？**

最初似乎存储的信息比我需要的多，但有充分的理由接受这一打击。

从长远来看，存储这些额外信息几乎总能节省我的时间和精力，因为我不可避免地发现，当有人被告知某件事花了多长时间时，他们也会想知道事件发生的时间和地点。

**这是一个巨大的星球**

过去，我一直因忽视这个星球上除了我自己的国家之外还有其他国家而感到内疚。这在当时似乎是个好主意，但这总是会导致问题、头痛和后来的时间浪费。始终考虑所有时区。

**C＃**

DateTime 很好地呈现为 C# 中的字符串。ToString(string Format) 方法紧凑且易于阅读。

例如

```
new TimeSpan(EventStart.Ticks - EventEnd.Ticks).ToString("h'h 'm'm 's's'") 
```

**SQL 服务器**

此外，如果您正在阅读与应用程序界面分开的数据库，那么 dateTimes 很容易一目了然，并且对它们执行计算也很简单。

例如

```
SELECT DATEDIFF(MINUTE, event_start, event_end) 
```

**ISO8601日期标准**

如果使用 SQLite，那么你没有这个，所以改为使用文本字段并将其存储为 ISO8601 格式，例如。

“2013-01-27T12:30:00+0000”

笔记：

*   这使用 24 小时制*

*   ISO8601 的时间偏移（或 +0000）部分直接映射到 GPS 坐标的经度值（不考虑夏令时或全国范围）。

例如

```
TimeOffset=(±Longitude.24)/360 
```

...其中±指东或西方向。

因此，值得考虑是否值得将经度、纬度和高度与数据一起存储。这会因应用而异。

*   ISO8601 是一种国际格式。

*   wiki 非常适合在[http://en.wikipedia.org/wiki/ISO_8601](http://en.wikipedia.org/wiki/ISO_8601)获取更多详细信息。

*   日期和时间以国际时间存储，并且根据时间存储在世界上的哪个位置记录偏移量。

根据我的经验，总是需要存储完整的日期和时间，无论我是否认为在我开始项目时存在。ISO8601 是一种非常好的、面向未来的方法。

**免费提供额外建议**

将事件像链一样组合在一起也是值得的。例如，如果记录一场比赛，整个赛事可以按racer、race_circuit、circuit_checkpoints 和circuit_laps 分组。

根据我的经验，确定谁存储了记录也是明智之举。作为通过触发器填充的单独表或作为原始表中的附加列。

**你投入的越多，你得到的越多**

我完全理解希望尽可能节省空间的愿望，但我很少会以丢失信息为代价这样做。

正如标题所说，数据库的一条经验法则是，数据库只能告诉你它所拥有的数据，而且回溯历史数据以填补空白可能会非常昂贵。

解决方案是第一次正确处理。这当然说起来容易做起来难，但是您现在应该对有效的数据库设计有更深入的了解，并且随后有很大的机会在第一时间把它做好。

您的初始设计越好，以后的维修成本就越低。

我只说这一切，因为如果我能回到过去，那么当我到达那里时，我会告诉自己。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-11T21:15:14.070

只需存储常规日期时间并忽略其他所有内容。当您可以只加载一个日期时间时，为什么还要花额外的时间编写代码来加载、操作它并将其转换为日期时间？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-11T21:01:41.280

因为如果你在 SQL Server 2008 上你没有提到它，你可以使用 time 数据类型，否则使用自午夜以来的分钟数

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-14T09:13:14.967

SQL Server 实际上将时间存储为一天的分数。例如，1 整天 = 值 1。12 小时的值是 0.5。

如果您想在不使用 DATETIME 类型的情况下存储时间值，则以十进制形式存储时间将适合该需要，同时还可以简单地转换为 DATETIME。

例如：

```
SELECT CAST(0.5 AS DATETIME)
--1900-01-01 12:00:00.000 
```

将值存储为 DECIMAL(9,9) 将消耗 5 个字节。但是，如果精度不是最重要的，那么 REAL 将只消耗 4 个字节。在这两种情况下，聚合计算（即平均时间）可以很容易地根据数值计算，但不能根据数据/时间类型计算。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-11T20:59:02.410

我会将它们转换为整数（HH*3600 + MM*60），并以这种方式存储。存储空间小，仍然很容易使用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-11T21:21:44.133

如果您使用 MySQL，请使用 TIME 字段类型和 TIME 附带的相关功能。

00:00:00 是标准的 Unix 时间格式。

如果您必须回顾并手动查看表格，整数可能比实际时间戳更令人困惑。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-11T20:59:52.173

尝试小日期时​​间。它可能不会给您想要的东西，但它会帮助您满足您未来在日期/时间操作方面的需求。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-11T21:07:21.047

你确定你只需要小时和分钟吗？如果你想用它做任何有意义的事情（比如计算两个这样的数据点之间的时间跨度），没有关于时区的信息，DST 可能会给出不正确的结果。时区可能不适用于您的情况，但 DST 肯定会。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-14T10:35:23.490

我们将其存储为 24 小时制，而不是午夜后的分钟，作为 SMALLINT。

09:12 = 912 14:15 = 1415

当转换回“人类可读形式”时，我们只需从右边插入一个冒号“：”两个字符。如果需要，请在左侧填充零。以各种方式保存数学，并使用更少的字节（与 varchar 相比），并强制该值是数字（而不是字母数字）

虽然很愚蠢......在MS SQL中应该有一个TIME数据类型已经很多年了恕我直言......

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-10-20T09:22:40.540

我认为您要的是一个将分钟存储为数字的变量。这可以通过不同类型的整数变量来完成：

```
SELECT 9823754987598 AS MinutesInput 
```

然后，在您的程序中，您可以通过计算以您想要的形式简单地查看它：

```
long MinutesInAnHour = 60;

long MinutesInADay = MinutesInAnHour * 24;

long MinutesInAWeek = MinutesInADay * 7;

long MinutesCalc = long.Parse(rdr["MinutesInput"].toString()); //BigInt converts to long. rdr is an SqlDataReader.   

long Weeks = MinutesCalc / MinutesInAWeek;

MinutesCalc -= Weeks * MinutesInAWeek;

long Days = MinutesCalc / MinutesInADay;

MinutesCalc -= Days * MinutesInADay;

long Hours = MinutesCalc / MinutesInAnHour;

MinutesCalc -= Hours * MinutesInAnHour;

long Minutes = MinutesCalc; 
```

当您要求使用效率时，就会出现问题。但是，如果您的时间很短，那么**只需使用可为空的 BigInt 来存储您的分钟值。**

null 值表示尚未记录时间。

现在，我将以往返外太空的形式进行说明。

不幸的是，一个表列只能存储一种类型。因此，您需要根据需要为每种类型创建一个新表。

例如：

*   如果 MinutesInput = **0** .. **255**则使用**TinyInt**（如上所述转换）。

*   如果 MinutesInput = **256** .. **131071**则使用**SmallInt**（注意：SmallInt 的最小值为 -32,768。因此，在存储和检索值时取反并添加 32768 以在转换之前使用全范围）。

*   如果 MinutesInput = **131072** .. **8589934591**则使用**Int**（注意：必要时取反并添加 2147483648）。

*   如果 MinutesInput = **8589934592** .. **36893488147419103231**然后使用**BigInt** （注意：根据需要添加和否定 9223372036854775808）。

*   如果 MinutesInput > **36893488147419103231**那么我个人会根据需要使用 VARCHAR(X) 增加 X，因为 char 是一个字节。我将不得不在以后重新访问这个答案以完整地描述这个（或者也许其他 stackoverflowee 可以完成这个答案）。

由于每个值无疑都需要一个唯一的键，因此只有在存储的值范围介于非常小（接近 0 分钟）和非常高（大于 8589934591）之间的良好混合时，数据库的效率才会显现出来。

在存储的值实际达到大于 36893488147419103231 的数字之前，您还不如使用一个 BigInt 列来表示您的分钟数，因为您不需要在唯一标识符上浪费一个 Int 和另一个 int 来存储分钟值。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-06-15T10:37:32.247

正如 Kristen 建议的那样，以 UTC 格式节省时间可以提供更好的帮助。

确保您使用的是 24 小时制，因为在 UTC 中没有使用上午或下午的子午线。

**例子：**

*   凌晨 4 点 12 分 - 0412
*   上午 10:12 - 1012
*   下午 2 点 28 分 - 1428
*   晚上 11:56 - 2356

它仍然更喜欢使用标准的四位数格式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-06-17T13:49:48.977

存储`ticks`为`long`/ `bigint`，当前以毫秒为单位。通过查看值可以找到更新的`TimeSpan.TicksPerSecond`值。

大多数数据库都有一个 DateTime 类型，它在幕后自动将时间存储为刻度，但在某些数据库（例如 SqlLite）的情况下，存储刻度可以是一种存储日期的方法。

大多数语言都允许从`Ticks`→ `TimeSpan`→轻松转换`Ticks`。

**例子**

在 C# 中，代码将是：

```
long TimeAsTicks = TimeAsTimeSpan.Ticks;

TimeAsTimeSpan = TimeSpan.FromTicks(TimeAsTicks); 
```

但请注意，因为在 SqlLite 的情况下，它只提供少量不同的类型，它们是；`INT`,`REAL`并且`VARCHAR`有必要将刻度数存储为一个字符串或两个`INT`单元格的组合。这是因为 an`INT`是 32 位有符号数，而`BIGINT`64 位有符号数。

**笔记**

然而，我个人的偏好是将日期和时间存储为`ISO8601`字符串。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-08-12T19:26:08.970

恕我直言，最佳解决方案在某种程度上取决于您如何在数据库的其余部分（以及应用程序的其余部分）中存储时间

就我个人而言，我曾使用 SQLite 并尝试始终使用[unix 时间戳](https://www.wikiwand.com/en/Unix_time)来存储绝对时间，因此在处理一天中的时间（如您所要求的那样）时，我会按照 Glen Solsberry 在他的回答中所写的操作并存储自午夜以来的秒数

当采用这种通用方法时，如果我在任何地方都使用相同的标准，那么阅读代码的人（包括我！）就不会那么困惑了

# c# - ObjectDataSource 可以有超过 1 个排序表达式吗？

> ID：538741
> 
> 赞同：0
> 
> 时间：2009-02-11T20:57:16.547
> 
> 标签：c#, asp.net

一个可以`ObjectDataSource`有多个`SortExpression's`吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:04:51.850

好吧，在任何给定时间你只能有 1 个排序表达式，但你可以对多个字段进行排序：

> .Sort = "column1 asc, column2 asc"

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T21:05:29.647

这可能不会直接回答您的问题我倾向于在将物理对象绑定到任何利用 List<>.Sort 或 LINQ .OrderBy 的东西之前对它们进行所有预排序，除此之外，我会将所有排序留给客户端，例如使用 JQuery对物理 html 表进行排序。

> ID：538745
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# .net - What libraries are available for manipulating super large images in .Net

> ID：538746
> 
> 赞同：4
> 
> 时间：2009-02-11T20:58:00.087
> 
> 标签：.net, bitmap, large-files, freeimage

I have some really large files for example 320 MB tif file with 14000 X 9000 pixels.

The operations I need to perform are basically scaling the images to get smaller versions of it and breaking the image into tiles.

My code works fine with small files and I use the .Net `Bitmap` objects but I will occasionally get Out of Memory exceptions for larger files.

I've tried using the FreeImage libraries `FreeImageBitmap` but have the same problems.

I'm using something like the following to scale the image:

```
using (Graphics g = Graphics.FromImage((Image)result))
{
   g.DrawImage(
      source,
      xOffset, yOffset,
      source.Width * scale, source.Height * scale
   );
} 
```

Ideally I'd like a third party library to do all the hardwork, but if you have any tips or resources with more information I would appreciate it.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T21:06:55.103

[AForge](http://code.google.com/p/aforge/) is meant to be very good!

# .net - 我可以在代码隐藏中获得风格的关键吗？(WPF)

> ID：538750
> 
> 赞同：12
> 
> 时间：2009-02-11T20:58:10.100
> 
> 标签：.net, wpf, styles

如果我有以下代码：

```
Style defaultStyle = (Style)FindResource("MyTestStyle"); 
```

有没有办法获取样式的名称（即反向查找）？就像是：

```
string name = defaultStyle.SomeMagicLookUpFunction() 
```

其中名称将评估为“MyTestStyle”。

这可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-11T23:48:05.357

我创建了一个小的帮助类，它使用一个方法来执行您需要的反向查找。

```
public static class ResourceHelper
{
    static public string FindNameFromResource(ResourceDictionary dictionary, object resourceItem)
    {
        foreach (object key in dictionary.Keys)
        {
            if (dictionary[key] == resourceItem)
            {
                return key.ToString();
            }
        }

        return null;
    }
} 
```

您可以使用以下方法调用它

```
string name = ResourceHelper.FindNameFromResource(this.Resources, defaultStyle); 
```

每个`FrameworkElement`人都有自己的`.Resources`字典，使用“this”假设您在正确的位置定义 MyTestStyle。如果需要，您可以向静态类添加更多方法以递归遍历窗口中的所有字典（应用程序？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-13T17:38:47.487

因为我使用 MergedDictionaries，所以我必须稍微更改上面的示例以使其适合我。如果上面的例子给你 0 个结果，试试这个：

```
 //Called by FindNameFromResource(aControl.Style) 
    static public string FindNameFromResource(object resourceItem) 
    {

        foreach (ResourceDictionary dictionary in App.Current.Resources.MergedDictionaries)
        {
            foreach (object key in dictionary.Keys)
            {
                if (dictionary[key] == resourceItem)
                {
                    return key.ToString();
                }
            }
        }
        return null;
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T22:16:30.133

如果不搜索资源字典，我认为这是不可能的，因为 x:Key 是 XAML 标记语法的一部分，并且当您引用 Style 或 DataTemplate 或您检索到的任何内容时没有相关性。

[查看关于x:Key](http://msdn.microsoft.com/en-us/library/ms742804.aspx)的 MSDN 文档

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-11T22:37:27.773

[可能不使用 Style 对象，但如果您在包含您的样式的 ResourceDictionary 中](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.resources.aspx)四处寻找，您可以获得 x:Key。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-29T11:31:37.537

IF 语句需要比较字符串如下

```
 public static class ResourceHelper
    {
        static public string FindNameFromResource(ResourceDictionary dictionary, object resourceItem)
        {
            foreach (object key in dictionary.Keys)
            {
                if (key.Equals(resourceItem))
                {
                    return key.ToString();
                }
            }

            return null;
        } 
```

# java - Java相当于寄存器int？

> ID：538752
> 
> 赞同：7
> 
> 时间：2009-02-11T20:58:43.500
> 
> 标签：java, c, cpu-registers

在 C 中，我可以为变量分配寄存器，例如：

```
register int i = 0; 
```

我知道 Java 是一种解释性语言，并且与 CPU 有许多抽象。

是否有任何机制可用于请求（如果架构不允许，那又怎样）我的变量保留在寄存器中而不是移动到缓存或主内存？

我不认为有什么办法，但我之前一直很惊喜。

谢谢，

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-11T21:00:33.090

`register`在 C 中没有将变量注册。它只是给编译器一个提示，将它放入寄存器可能会很好。

在 Java 中没有等价物。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:00:51.967

如果它在很短的空间内使用得足够多，使其成为寄存器 int 是值得的，那么热点编译器应该能够自己解决这个问题。

事实上，热点编译器应该能够比 C/C++ 编译器做得更好，因为它有更多的信息可以使用。C/C++ 编译器必须猜测；HotSpot 可以测量。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-11T21:01:25.150

Java 中没有等价物。即使在 C 语言中，也不能保证变量会存储在寄存器中，编译器可以随意忽略它。

在 Java 中，该方法将被解释，直到热点 JIT 启发式地确定它需要编译。对于已编译的代码，它使用着色算法将变量和临时值分配给寄存器，或者在寄存器溢出的情况下写入/写入 RAM。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-11T21:00:58.097

不，没有办法在 Java 中请求这个。但是，您可以做一些事情来阻止使用寄存器，例如将`volatile`修饰符应用于成员变量。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-11T22:19:26.957

> 我知道 Java 是一种解释性语言，并且与 CPU 有许多抽象。

你几乎在那里回答了你自己的问题:-)

但说真的，一般来说，尽可能清晰和简单地编写代码，JVM 会尽其所能正确处理您的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T21:23:29.767

您可以创建一个名为 @register 的注解，但 JVM 肯定会忽略它。例如

```
@register int i = 0; 
```

# maven-2 - 关于 Maven 2 的几个问题

> ID：538762
> 
> 赞同：1
> 
> 时间：2009-02-11T21:00:19.113
> 
> 标签：maven-2, maven-plugin

我对 Maven 2 有一些疑问，希望有人能为我解决问题：

1.  对此做了一个新线程（链接：[Maven 2 plugin, build + surefire](https://stackoverflow.com/questions/540697/maven-2-plugin-build-surfire)）

2.  是否可以使用 diffrend 值多次定义配置文件（例如使用 diffrend 配置文件）并全部激活这些配置文件？我试过一次，似乎只有一个配置文件被实际执行。

3.  这个解决方案是常见的还是值得推荐的：我有几个项目在他们的 pom 中有很多东西两次（意味着项目 a 有一些报告插件和项目 b 相同），我现在创建一个新项目，它被打包为 pom 并执行我的项目共有的所有东西，让它们从这个父 pom 继承。我实际上认为这很好，因为它使我的 pom 文件更薄，但另一方面，我有一个父项目，它只是一个 pom 文件。

4.  有人对 Maven + Selenium 有经验吗？我已经尝试过 mavenium、ant task selenese 和 maven 插件来执行我的测试......坦率地说，他们中的每个人都给我带来了麻烦。总而言之，蚂蚁 selenese 是真正工作的人……有点。我觉得我使用了错误的 jar 文件或者不知道我真正需要什么（我认为获得 java-client-driver 就可以了，我也需要 seleneium-server 或 rc 吗？）

我希望我可以用 4 个问题创建一个线程（至少它们都是关于 maven 2 的）。提前感谢您的回复。

库库达斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:43:28.870

下次请单独提问。

1.  我无法回答。我不确定我是否理解这个问题。

2.  不同的配置文件可以包含给定插件的不同值。通常，如果您将它们全部激活，则只有其中一个会获胜。

3.  建议仅使用 Pom 父 pom。实际上，它们是保持理智的唯一方法。

4.  我们在运行 selenium 方面有丰富的经验，但只彻底使用了surefire-plugin（和 jetty-plugin），因为我们所有的测试都是基于 junit 的。它真的很好用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T04:37:31.383

Maven 中的配置文件是附加的。从命令行，您可以像此示例一样进行调用以激活两个配置文件：

```
mvn package -Pprofile1,profile2 
```

# installation - 如何为 .NET 开发设置 virtualbox

> ID：538775
> 
> 赞同：4
> 
> 时间：2009-02-11T21:01:33.447
> 
> 标签：installation, virtualization, virtualbox

我正在尝试在虚拟机中运行我的开发工具，并且想知道关于设置这样一个环境的任何提示

一些细节：

*   我正在使用 VirtualBox。
*   我的主机是 WindowsXP
*   我希望在 VM 中安装 Vista。
*   我将需要 VS 2008 以及它附带的所有标准东西
*   我需要 CodeRush、Refactor Pro!、Testdriven.Net、ASP MVC 和其他一些小插件的空间
*   我会将所有代码放在主机上的共享目录中，因此没有代码会直接在 VM 上

我有一些具体问题：

*   我应该为虚拟硬盘分配多少空间？我在第一次尝试时为它设置了 12GB，但在标准的 VS2008 安装（一直失败）之后，我只剩下 500 MB
*   我应该为 VM 分配多少基本内存？
*   还有其他提示/技巧/建议吗？我还没有完全确定这个过程的任何部分（尽管我很确定我想试试 Vista）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:11:26.933

我不完全确定 VirtualBox，但我已经设置了很多 VMWare 安装。

磁盘空间是那里唯一真正的问题，因为扩展很痛苦。但是，如果您设置 80G，它不会立即使用所有这些；它会根据需要扩展。希望 VirtualBox 是类似的，在这种情况下分配尽可能多的你需要。80G是我通常会去的，

对于内存，1G 通常就足够了，尽管您应该检查开发应用程序的最低要求。VMWare 会从主机中获取所有这些内容，而不管需要如何，因此您需要平衡主机需求与您的（可能是多个）虚拟机之间的关系。

另一个提示，摆脱虚拟机中多余的硬件。我总是抛弃软盘、声卡和一切并非绝对必要的东西。对于您的开发，您需要网络、CD/DVD。RAM 和磁盘，其他的可能不多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T21:22:36.987

我会在VM中使用WindowsXP。内存和磁盘的重量要轻得多。1-2Gb 的内存对于 XP 开发来说是很好的，但如果你需要运行 Vista，我会推荐更多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:07:38.037

如果您遇到空间困难，请改用 Virtual PC。它也是免费的，与 VirtualBox 一样快，并且允许您将可扩展磁盘映像用于 VM 驱动器。

JSYK，Vista 在虚拟机中真的很烂。

我发现分配给 VM（对于 XP）的 1GB 内存足以用于开发和测试。使用 Vista，我会加倍。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T00:56:03.807

```
* How much room should I allot for the virtual hard drive? I set up 12GB for it on the first attempt but after a standard VS2008 install (which kept failing) I would have been left with only 500 MB 
```

我认为您至少需要 40-80GB 来安装 Vista 和所有开发工具。多一点总比少一点好。如果空间不足，您总是可以挂载额外的虚拟磁盘（我忘记了 VirtualBox 是否可以做到这一点）。

```
* How much base memory should I allot for the VM? 
```

基础应该是 2GB。但是，如果您关闭所有不需要的东西，您就可以少花钱。幸运的是，这很容易在虚拟机中更改。

```
* Any other tips/tricks/advice? I'm not completely settled on any part of the process (though I'm pretty sure I would like to try Vista) 
```

如果您打算使用 Vista，您应该关闭所有不需要的服务、索引、系统还原。同时关闭所有效果。不要使用 Aero（尽管不要认为它在虚拟机中被激活）。

正如其他人所说，Vista 在虚拟机中并不是一个很好的操作系统。我已经在 Virtual PC 和 Virtual Box 中尝试过，但都没有运行良好。Virtual Box 对我来说更快，但我仍然不会使用 Vista。我会在虚拟机中使用 XP pro。但是，如果 Vista 适合您，那就太好了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-06T18:28:48.227

多年后看这个，这是我目前的设置：

主持人：

*   Ubuntu 64 位（虽然 Windows 7 工作得很好）
*   确保启用 CPU 虚拟化（通常默认启用，但可能需要在 BIOS 中调整）
*   用于 USB 设备支持的 Virtual Box 扩展包
*   2 个硬盘驱动器，通过一个硬盘驱动器盒和一个快速 100GB 的 SSD 在我的笔记本电脑的 DVD 插槽中存储一个大存储空间，我的 Ubuntu 和主 VM 所在的位置

客人：

*   Windows 7的
*   VS 2010，还有很多其他的东西
*   注意拥有正确版本的Guest Additions（总是在升级vbox版本后安装）
*   共享我的主机的 ~/Downloads 文件夹以便于传输文件
*   2 个虚拟磁盘
    *   常规一个动态分配给 50GB，通常与操作系统和所有软件保持在 30GB 左右
    *   一个较小的 5GB 用于代码。这个设置为可共享模式，因为所有代码都在源代码控制中，我不想在这个驱动器上使用快照，我想将它附加到其他虚拟机。[阅读手册对此非常有帮助](http://www.virtualbox.org/manual/ch05.html#hdimagewrites)。

我也没有发现快照非常有用，实际上在和解过程中它们被炸毁了。我经常使用 vbox 管理器将我的主磁盘克隆到我的存储硬盘以进行备份。

总体而言，SSD 是使此设置起作用的巨大变化。多年来，我一直在使用速度较慢的硬盘，并且不断遇到问题，我必须恢复虚拟机才能从中恢复，现在 99% 的时间都在压缩。

# exception - 如何防止捕获的异常在黑莓应用程序中报告为未捕获？

> ID：538778
> 
> 赞同：2
> 
> 时间：2009-02-11T21:02:15.567
> 
> 标签：exception, blackberry, java-me

编辑：这仅适用于模拟器，但我仍然想知道是否有解决方案。

我在黑莓应用程序中有一些代码在某个时刻捕获异常，在 catch 块中进行一些处理，然后重新抛出异常，该异常在调用堆栈的更高位置被捕获。但是，即使我稍后确实捕获了它，我仍然会在模拟器上看到一条错误消息，以及设备日志中的 jvm 104 错误。当我已经捕捉到它抱怨的异常时，我还需要做些什么来抑制这个错误屏幕的显示吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T21:20:16.070

您是否尝试过 JDE 首选项菜单、模拟器选项卡、调试子选项卡？那里有一个标记为“当异常被catch（Throwable）捕获时不要停止执行”的选项。也许那样做？（这假设您从 JDE 启动模拟器）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T03:42:21.363

你真的在做一个catch（Throwable）吗？正如 Marc 所说，这将显示在模拟器的错误日志中。RIM 不鼓励在性能受到影响时以这种方式做事（我会避免抱怨他们的 JVM 设计），因此这可能是通过以不同方式捕获事物来解决此问题的另一个原因（例如，不是 Throwable，而是更具体的异常类型- 除非你真的需要那个堆栈跟踪）。

# asp.net - IsAjaxRequest is always false after upgrade to RC MVC

> ID：538780
> 
> 赞同：1
> 
> 时间：2009-02-11T21:03:19.933
> 
> 标签：asp.net, asp.net-mvc, ajax

I updated the AJAX scripts and assembly referenced as per release notes. However, IsAjaxRequest still always returns false despite it actually being such a request. How do I resolve this?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T08:53:37.497

据我了解，您正在使用 MS Ajax 库。您也应该更新您的 MicrosoftMvcAjax.js。它被改变了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T19:22:16.750

我使用 RC1 更新没有问题...作为测试，我将此操作添加到 Home Controller

```
public ActionResult Test()
{
    ifRequest.IsAjaxRequest())
        return PartialView();
    return new EmptyResult();
} 
```

这到 Home/Index.aspx 文件

测试目标已创建 Views/Home/Test.ascx

```
</br>This is a test 
```

并将 Ajax Javascript 文件添加到母版页

* * *

作为对评论的回应，我在 Index.aspx 中添加了一个 AjaxForm 并且它起作用了

```
<%@ Page Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %>

<asp:Content ID="indexHead" ContentPlaceHolderID="head" runat="server">
    <title>Home Page</title>
</asp:Content>

<asp:Content ID="indexContent" ContentPlaceHolderID="MainContent" runat="server">
    <h2><%= Html.Encode(ViewData["Message"]) %></h2>
    <p>
        To learn more about ASP.NET MVC visit <a href="http://asp.net/mvc" title="ASP.NET MVC Website">http://asp.net/mvc</a>.
    </p>

    <%= Ajax.ActionLink("Test", "Test", new AjaxOptions{ UpdateTargetId="TestTarget", InsertionMode=InsertionMode.InsertAfter} ) %>
    <div id="TestTarget">Test Target</div>

    <% using(Ajax.BeginForm("Test", new AjaxOptions{ UpdateTargetId="TestTarget", InsertionMode=InsertionMode.InsertAfter} ) ){%>

    <button type="submit" >click me</button>

    <% } %>
</asp:Content> 
```

# qt - qt Embedded 中的窗口化如何工作？

> ID：538783
> 
> 赞同：2
> 
> 时间：2009-02-11T21:03:55.563
> 
> 标签：qt, qtembedded

窗口如何在嵌入式 qt 中工作，其中 Qt 直接绘制到帧缓冲区而不是通过单独的窗口系统？我可以同时运行多个程序吗？我是否得到合成和小 [x] 按钮、最大化等等？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T23:42:12.620

您需要运行一个应用程序作为服务器来提供窗口管理功能；例如，通过在运行时在命令行中传递 -qws 选项。

任何其他应用程序都作为客户端运行。有关详细信息，请参阅此页面：

[http://doc.qt.digia.com/4.5/qt-embedded-running.html](http://doc.qt.digia.com/4.5/qt-embedded-running.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:01:22.380

你问的是它是如何工作的？如果你想要一个基本的概述，可以把它想象成 Linux 上的 X-windows 服务器，其中帧缓冲区绘制边框、装饰等，只有 Qt 库被编译为更直接地使用帧缓冲区而不是它们X-windows 服务器。程序也可以覆盖帧缓冲区的各个方面，而不需要由窗口服务器进行更改。但是，对于您使用 Qt 进行的大部分 UI 工作，您将使用与常规桌面版本完全相同的某些类（QDialog 等）。它们只是由不同的底层绘制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-03T09:21:58.650

从 Qt 文档：

> Qt for Embedded Linux 应用程序需要一个正在运行的服务器应用程序，或者是服务器应用程序本身。通过使用 QApplication::GuiServer 类型构造 QApplication 对象，或使用 -qws 命令行选项运行应用程序，任何 Qt for Embedded Linux 应用程序都可以成为服务器应用程序。

所以你可以`QApplication::GuiServer` 作为第三个参数传递给`QApplication`构造函数来拥有一个服务器：

```
QApplication app( argc, argv, QApplication::GuiServer ); 
```

或将`-qws`参数传递给应用程序以将其作为服务器运行：

```
./MyApp -qws 
```

其他应用程序应作为客户端运行。

# eclipse - Tomcat 未在 Eclipse 上显示

> ID：538784
> 
> 赞同：2
> 
> 时间：2009-02-11T21:04:26.810
> 
> 标签：eclipse, tomcat, eclipse-plugin

我正在尝试为 Eclipse 安装 tomcat sysdeo 插件，但在我进入插件的设置/配置部分之前遇到了一些问题。

当我运行我的 Eclipse 时，在 Preferences 下，我没有看到 tomcat 部分。除了下载 tomcat，我知道我在这里缺少一些步骤来在 Eclipse 上显示它。

有谁知道我在这里想念什么？我只想在 Preferences 下查看 tomcat，以便我可以通过 Eclipse 更改或设置配置内容。

谢谢！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T22:06:44.523

你在这里使用什么版本的eclipse？

如果这是 eclipse3.4 或 3.5Mx，我建议下载[tomcatPluginV321.zip](http://www.eclipsetotale.com/tomcatPlugin.html)并将其解压缩到您的`[eclipse]`^((*))`\dropins\`目录中（dropins，而不是插件：由于[p2 更新系统](http://wiki.eclipse.org/Equinox_p2_Getting_Started)，请勿将外部插件放入插件目录中——比如本[教程建议](http://www.eclipse-blog.org/eclipse-ide/tomcat-in-eclipse-sysdeo-tomcat-plug-in.html)- 总是丢弃）

^(( `*`)) `[eclipse]`是 eclipse 的安装目录，包含`eclipse.exe`.

然后你应该有：

```
[eclipse]\dropins\com.sysdeo.eclipse.tomcat_3.2.1\... 
```

重新启动（即使没有`-clean`选项），你应该有它：主菜单栏上的 tomcat 菜单。

我刚刚做到了，并且“它只是有效” ^(TM)

[![替代文字](https://i.stack.imgur.com/frI6J.png)](https://i.stack.imgur.com/frI6J.png)
[（来源：[eclipse-blog.org](https://www.eclipse-blog.org/wp-content/uploads/2007/04/tomcat-options.PNG)）]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T04:31:12.853

好的。发现我的 Eclipse 出了点问题。

我不得不下载新版本的 Eclipse 并再次安装插件。

之后一切正常。

感谢帮助 ：）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:14:57.097

安装插件后，您应该使用`-clean`参数重新启动eclipse。也许不这样做会导致您的安装不完整。

# sql-server-2000 - 如何只获取查询结果的第二、第三、第四或第五行？（SQL SERVER 2000）

> ID：538788
> 
> 赞同：1
> 
> 时间：2009-02-11T21:05:10.693
> 
> 标签：sql-server-2000

我需要一个建议，甚至是一个解决方案，如何只获得第二、第三行的高性能查询结果。我知道可能存在 row_number（SQL Server 2005 或更高版本）但不适用于 SQL Server 2000 :-(

我第一次尝试获得第五行是：
SELECT TOP 1 col
FROM (SELECT TOP 5 col
FROM table
ORDER BY col) q
ORDER BY col DESC

我试着解释我的要求：在我的桌子上可以有最大值。一人5排。但是，如果这个人只存在 4 行，我的上述查询会得到错误的结果。

有什么建议么？

任何帮助将不胜感激！

Thx 前锋，最好的问候安德烈亚斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T21:07:26.367

可能最好和最快的方法是在数据读取器中选择前 5 个，然后根据需要将下一个读入内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T21:40:54.587

要获得第 5 行，您可以使用多个子查询，例如：

```
select top 1 MyCol from MyTable
where MyCol = 
(
    select top 1 MyCol from 
    (
        select top 5 MyCol from MyTable order by MyCol
    ) t order by MyCol desc
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:59:53.183

如果我理解正确，例如，如果实际上有第 5 行，您只希望返回该行。在这种情况下，您可以这样做：

```
SELECT TOP 1 col
FROM (
    SELECT TOP 5 col
    FROM table
    where (SELECT COUNT(*) FROM table) >= 5
    ORDER BY col
) q
ORDER BY col DESC 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:28:51.643

这个应该做...

```
CREATE PROCEDURE [dbo].[sp_UpdateSkills]
AS
BEGIN
    set nocount on

    declare @UserID int
    declare @Skill varchar(1)
    declare @SkillCount int

    declare @Skill1 varchar(1)
    declare @Skill2 varchar(1)
    declare @Skill3 varchar(1)
    declare @Skill4 varchar(1)
    declare @Skill5 varchar(1)

    declare csrUser cursor for
        select distinct UserID
        from dbo.tblSkills1
        order by 1

    open csrUser

    fetch next from csrUser into @UserID
    while (@@fetch_status = 0)
    begin
        declare csrSkill cursor for
            select Skill
            from dbo.tblSkills1
            where UserID = @UserID
            order by Skill

        set @SkillCount = 1
        set @Skill1 = null
        set @Skill2 = null
        set @Skill3 = null
        set @Skill4 = null
        set @Skill5 = null

        open csrSkill

        fetch next from csrSkill into @Skill
        while (@@fetch_status = 0 and @SkillCount < 6)
        begin
            print @UserID
            print @Skill

            if (@SkillCount = 1)
                set @Skill1 = @Skill
            else if (@SkillCount = 2)
                set @Skill2 = @Skill
            else if (@SkillCount = 3)
                set @Skill3 = @Skill
            else if (@SkillCount = 4)
                set @Skill4 = @Skill
            else if (@SkillCount = 5)
                set @Skill5 = @Skill

            set @SkillCount = @SkillCount + 1

            fetch next from csrSkill into @Skill
        end

        close csrSkill
        deallocate csrSkill

        insert into tblSkills2
        (UserID, Skill1, Skill2, Skill3, Skill4, Skill5)
        values
        (@UserID, @Skill1, @Skill2, @Skill3, @Skill4, @Skill5)

        fetch next from csrUser into @UserID
    end

    close csrUser
    deallocate csrUser
END 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-07T08:39:55.223

这是另一个例子。这个使用带有标识列的临时表。

```
SELECT TOP 5 IDENTITY(int) as id, col
  INTO #t
  FROM table
 ORDER BY col

SELECT col FROM #t WHERE id = 5

DROP TABLE #t 
```

# ruby-on-rails - In Rails, how can I ensure users enter form data in correct order?

> ID：538789
> 
> 赞同：0
> 
> 时间：2009-02-11T21:05:26.887
> 
> 标签：ruby-on-rails, ajax

I have a Rails app with a model whose fields are dates which are checkpoints for a certain process.

I want to prevent the user entering a date for the nth checkpoint until they have entered a date for the (n-1)th.

Obviously, I can validate in the model to make sure that no dates are missing (and that dates are in chronological order) but this seems unsatisfactory. Ideally, the nth field should not be visible on the form until the (n-1)th field has been completed (and perhaps a 'next' button has been clicked.

I don't know much about AJAX other than having used it for adding comments on a blog, but it seems it might be useful in this problem. I'm going to take a look at it over the next few days, but I would appreciate it if anybody could give me some pointers.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T21:10:27.670

Either disable or hide all of the inputs except for the first one. As the user completes each input, use an Ajax call to validate it and then display/enable the next one. Once all the inputs are complete, then display/enable the save/continue button.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T21:29:56.843

根据您的描述，它可能是有限状态机的一个很好的用例。使用当前的“状态”来确定要在表单上显示哪些日期输入字段。

参见[Github：rubyist/aasm](http://github.com/rubyist/aasm/tree/master)

# ruby-on-rails - Legacy Schema 和动态查找（Ruby on Rails）

> ID：538793
> 
> 赞同：3
> 
> 时间：2009-02-11T21:06:52.437
> 
> 标签：ruby-on-rails, ruby, activerecord

我正在尝试在遗留数据库上放置一个导轨面。它是旧的 Sybase 11 数据库安装。我得到了一个使用 unixODBC 和 FreeTDS 工作的 ODBC 连接。我也在使用 activerecord-odbc-adapter gem。

到目前为止，我必须使用 set_table_name 和 set_primary_key 才能使其正常工作。但是，动态 find_by 方法都不起作用。我总是得到一个方法丢失错误。此外，通过关联查找也无法正常工作，出现相同的错误。模型上的正常发现工作，但我希望我能简写其中的一些。

我是因为它是一个遗留数据库，还是我可以做或检查以使其工作？

如果可以的话，那将为我节省一些编写 SQL 的工作。

谢谢你。

编辑：

控制台输出：

```
Person.find_by_last_name("Smith")

NoMethodError: undefined method `find_by_last_name' for Person(Table doesn't exist):Class
    from /opt/ruby-enterprise-1.8.6-20090201/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/base.rb:1778:in `method_missing'
    from (irb):1

Person.find(:first, :conditions => { :last_name => "Smith" })

#<Person Person_ID: <redacted>, Title: "Mr.", First_Name: "Aaron", Middle_Name: "Michael", Last_Name: "Smith", Suffix: nil, Preferred_Name: nil 
```

进一步编辑：

我做了一个疯狂的猜测并将 Last_Name 大写。那返回了一些东西。看来我将不得不这样做。我仍然不知道关联部分将如何工作。这仍然是一个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T05:00:38.960

您的问题是查找器区分大小写。我的旧数据库也有同样的问题。

试试这个看它的工作：

```
Person.find_by_Last_Name("Smith") 
```

这应该够了吧。

我有我写的代码来解决这样的问题。这是 ActiveRecord 的一个小猴子补丁，您可以将其插入到您想要修改的特定模型中。

```
module ActiveRecord
  class Base
    # Indicates whether field names should be lowercased for legacy databse fields.
    # If true, the field Product_Name will be +product_name+. If false, it will remain +Product_Name+.
    # This is false, by default.
    cattr_accessor :downcase_legacy_field_names, :instance_writer => false
    @@downcase_legacy_field_names = false
  end
end 
```

上面的代码在 ActiveRecord 上创建了一个名为 downcase_legacy_field_names 的新访问器。它默认为假。当此访问器在模型顶部设置为 true 时，它​​将触发下面的代码。

```
# set all accessor methods to lowercase (underscore)
# add set_columns_to_lower to each model that needs it 
class << ActiveRecord::Base

    # Returns a hash of all the methods added to query each of the columns in the table with the name of the method as the key
    # and true as the value. This makes it possible to do O(1) lookups in respond_to? to check if a given method for attribute
    # is available.
    def column_methods_hash #:nodoc:
      @dynamic_methods_hash ||= column_names.inject(Hash.new(false)) do |methods, attr|

        attr_final = downcase_legacy_field_names ? attr.to_s.downcase : attr

        attr_name = attr_final
        methods[attr_final.to_sym]       = attr_name
        methods["#{attr_final}=".to_sym] = attr_name
        methods["#{attr_final}?".to_sym] = attr_name
        methods["#{attr_final}_before_type_cast".to_sym] = attr_name
        methods
      end
    end

   # adapted from: http://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas
    def downcase_legacy_field_methods
      column_names.each do |name|
       next if name == primary_key
       a = name.to_s.underscore

       define_method(a.to_sym) do
         read_attribute(name)
       end

       define_method("#{a}=".to_sym) do |value|
         write_attribute(name, value)
       end

       define_method("#{a}?".to_sym) do
         self.send("#{name}?".to_sym)
       end

      end
    end

end 

ActiveRecord::Base.downcase_legacy_field_names = true 
```

此代码改编自：[http ://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas](http://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas)

我们正在`column_methods_hash`重写 ActiveRecord 方法。此方法用于生成在运行时为您的数据库模型创建的方法名称列表。我们不想在流程的早期覆盖任何内容，因为我们会弄乱 ActiveRecord 将我们的动态查找器（和其他方法）转换为旧数据库的适当 SQL 语句的能力。

第二种方法`downcase_legacy_field_methods`是一种新方法，它实际上将生成小写方法将执行的代码。

以上所有代码都修补了 ActiveRecord。这是一个猴子补丁，因此在加载 ActiveRecord 后的任何地方都可能需要它。我在 environment.rb 中有我的。

修补 ActiveRecord 后，您还需要执行一个步骤。在您的遗留数据库模型的顶部，您需要有一行`downcase_legacy_field_methods`. 它应该看起来像这样：

```
class LegacyDatabaseModel < ActiveRecord::Base
  downcase_legacy_field_methods

  def cubits_to_feet
    #conversion code goes here
  end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T09:27:45.940

我在没有命名约定的旧版 SQL Server 数据库中遇到了类似的问题，并且在代码隐藏页面中嵌入了 SQL 的大量 ASP.net 代码等。这使我们无法修改现有的 ASP.net 应用程序，而不是我想要的无论如何都要这样做。

这种数据库结构对 Rails 来说非常痛苦，我们认为由于表名都是单数，我们可以重命名所有表和列以与 Rails 保持一致，然后创建反映 ASP.net 原始表/列结构的视图应用。

这使我们能够对新重命名的表进行更改，包括添加新字段等，同时将遗留应用程序与这些数据库结构更改隔离开来。

这个解决方案显然不适用于所有人，但事实证明它对我们来说非常成功。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:45:55.760

这是否有效：

```
User.find(:all, :conditions => ['name = ?', "bob"]) 
```

......虽然这不是？

```
User.find_all_by_name("bob") 
```

（这应该在评论中，但我是新手，还不能评论：）堆栈跟踪将帮助我深入了解发生了什么。您使用的是什么版本的导轨？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-03T23:04:45.803

这篇文章对我帮助很大，我将它形式化为一个插件：http: [//github.com/reidmix/legacy_mappings](http://github.com/reidmix/legacy_mappings)我想分享。点击通过，看起来 url 被编码了。

# c# - SQL Server 日期函数

> ID：538803
> 
> 赞同：2
> 
> 时间：2009-02-11T21:08:49.360
> 
> 标签：c#, sql-server, .net-3.5, bindingsource

当我将它添加到我的 where 子句时：

```
DueDate <= getDate() AND DueDate IS NOT null 
```

我得到一个不错的小故障，上面写着：无法创建子：System.Reflection.TargetInvocationException：调用的目标已引发异常。---> System.Data.EvaluateException：表达式包含未定义的函数调用 getDate()。

知道我做错了什么吗？

* * *

**更新** 使用中的代码：

```
private string getFilter(int mode) {
    String filter = "";
    if ((ALL_WORK_ORDERS & mode) == 0) {
        if ((mode & OUTSTANDING_WORK_ORDERS) == OUTSTANDING_WORK_ORDERS) {
            filter += "DueDate <= getDate() AND DueDate IS NOT null OR";
        }
        if ((mode & COMPLETED_WORK_ORDERS) == COMPLETED_WORK_ORDERS) {
            filter += " FinishedDate IS NOT  null";
        }
    }

    filter = filter.Trim();
    if (filter.EndsWith("OR")) {
        filter = filter.Remove(filter.Length - 2);
    }

    return filter;
} 
```

它在这里被使用：

```
tblWorkOrderBindingSource.Filter = getFilter(mode); 
```

在表中，DueDate 是日期时间类型。

**旁注：** 我可以跑

```
SELECT [ID]
      ,[WorkDesc]
      ,[DueDate]
  FROM [RentalEase].[dbo].[tblWorkOrder]
WHERE [DueDate] <= getDate() AND [DueDate] IS NOT null 
```

在 MS SQL Server Management Studio Express 中没有问题。

* * *

## 最终解决方案

```
 private string getFilter(int mode) {
        String filter = "";
        if ((ALL_WORK_ORDERS & mode) == 0) {
            if ((mode & OUTSTANDING_WORK_ORDERS) == OUTSTANDING_WORK_ORDERS) {
                filter += "DueDate <= #" + DateTime.Now.ToShortDateString() + "# AND DueDate IS NOT null  AND FinishedDate IS null OR";
            }
            if ((mode & COMPLETED_WORK_ORDERS) == COMPLETED_WORK_ORDERS) {
                filter += " FinishedDate IS NOT null";
            }
        }

        filter = filter.Trim();
        if (filter.EndsWith("OR")) {
            filter = filter.Remove(filter.Length - 2);
        }

        return filter;
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-11T21:40:10.873

异常很清楚这里出了什么问题。您正在指定一个方法 getdate，它不能在过滤器表达式中使用。请参阅有关 DataColumn 类的 Expression 属性的文档，了解什么是有效的，什么是无效的：

[http://msdn.microsoft.com/en-us/library/system.data.datacolumn.expression.aspx](http://msdn.microsoft.com/en-us/library/system.data.datacolumn.expression.aspx)

话虽如此，您需要将日期连接到过滤器中，而不是 getdate（调用 DateTime 结构上的静态 Now 属性以获取当前日期）。上面的链接将向您展示如何正确格式化日期（您不能只按照凯利的回答中的说明进行操作，尽管该答案大部分都是这样）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T21:36:44.267

你有没有尝试过

```
filter += "DueDate <= #" + DateTime.Now + "# AND DueDate is not Null" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:21:18.517

> System.Reflection.TargetInvocationException

此消息并非来自 Sql Server。我认为您实际上是在该字符串中编写 C# 并在运行时针对 .net 类型（而不是表定义）对其进行编译/解释。

此外，SQLServer 2005 与 || 存在问题。和 ＆＆...

```
SELECT CASE WHEN 1=1 && 3=3 THEN 1 ELSE 0 END
--Incorrect syntax near '&'.

SELECT CASE WHEN 1=1 || 3=0 THEN 1 ELSE 0 END
--Incorrect syntax near '|'. 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T21:12:58.367

那应该是T-SQL吗？试试这个

```
DueDate <= getDate() 
AND  DueDate IS NOT null 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T21:18:00.367

如果这应该是 sql 则**"||"** 不是**"OR"**的符号，**"&&"**不是**AND**的符号。

```
filter += "DueDate <= GetDate() AND DueDate is not NULL OR "; 
```

# asp.net - Is it possible to get a master page from my parent Virtual directory/ application/

> ID：538808
> 
> 赞同：1
> 
> 时间：2009-02-11T21:09:25.473
> 
> 标签：asp.net, master-pages

I have a virtual directory inside of my main virtual directory in IIS.

can i reference the parent application and reference its master page? If yes, how?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:24:15.017

出于所有意图和目的，不，这是不可能的。ASP.NET 不会在其 AppDomain 之外执行 ASPX/ASCX/MASTER。我建议您使用您的解决方案走不同的路线（例如，编译成通用 dll）

**编辑：**要问的一个潜在问题是您是否需要虚拟目录。是什么让你首先选择将它们分开？

除此之外，您可能*会*通过编写自己的虚拟路径提供程序来伪造它，但这会导致世界受到伤害（基类未编译等）。

我建议您选择最简单的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-10T00:18:42.720

令我惊讶的是，这是可能的——如果您创建一个指向父应用程序中的母版页文件夹的虚拟目录。例如：

*   /parentApp - 父级的根目录
*   /parentApp/Master - 父级的母版页
*   /parentApp/childApp - 子应用程序
*   /parentApp/childApp/Master - 指向 /parentApp/Master 的虚拟目录

使用此设置，这可以在您的孩子 web.config 中工作：

```
<pages masterPageFile="~/Master/Default.master"> 
```

我假设在 @Page 指令中对其他母版页的引用会起作用，但我还没有尝试过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:21:54.180

不，出于安全考虑，我认为这是不可能的。

# c++ - 如何在 C++/OpenGL 中获取当前鼠标位置？

> ID：538810
> 
> 赞同：3
> 
> 时间：2009-02-11T21:09:51.400
> 
> 标签：c++, opengl, mouse, glut

我知道当用户点击鼠标时我可以使用鼠标回调函数，但是如果我想知道当前的 x/y 位置而不需要用户点击怎么办？

我是否必须使用在任何鼠标移动时调用的不同回调并自己跟踪 x/y，或者是否有可以在 GLUT/OpenGL 中调用的函数来获取它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-11T21:12:01.737

注册一个 glutPassiveMotionFunc 回调函数

查看有关[回调的信息](http://titanium.mountunion.edu/cs/cs480/sp07/glutcallbackhints.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T21:16:33.257

您需要使用 glutMotionFunc/glutPassiveMotionFunc 回调来跟踪独立于鼠标点击的鼠标移动。

[7.6 glutMotionFunc、glutPassiveMotionFunc](http://www.opengl.org/resources/libraries/glut/spec3/node51.html#SECTION00086000000000000000)

# log4net - 限制来自 smtpappender (log4Net) 的电子邮件

> ID：538813
> 
> 赞同：8
> 
> 时间：2009-02-11T21:10:23.707
> 
> 标签：log4net

我正在寻找一种方法来限制 SmtpAppender 以限制在定义的时间跨度内多次发生相同错误的情况下发送的电子邮件数量。

我不知道这是否可能，任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-24T10:15:03.663

我没有尝试过这个扩展的 SMTP 附加程序，但它似乎是你需要的。

[http://mail-archives.apache.org/mod_mbox/logging-log4net-user/200804.mbox/%3C6D3CA9B0BEA31640B4E6338360C847400223ECCB@entdc1ms02.corp.gomez.com%3E](http://mail-archives.apache.org/mod_mbox/logging-log4net-user/200804.mbox/%3C6D3CA9B0BEA31640B4E6338360C847400223ECCB@entdc1ms02.corp.gomez.com%3E)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T02:31:55.603

您总是可以扩展`SmtpAppender`以实现您需要的功能。

喜欢这个[示例帖子](https://stackoverflow.com/a/2410218/74585)。

# javascript - 如何在 IE6/7 中防止表格“弯曲”

> ID：538826
> 
> 赞同：0
> 
> 时间：2009-02-11T21:13:05.777
> 
> 标签：javascript, ajax, internet-explorer, client-side

我有一些具有“查看详细信息”功能的表格数据，这些数据会触发 ajax 调用以将一些新元素附加到 DOM（通常我在所选行和 innerHTML 之后插入另一个 TR 或使用 colspan 附加到 TD 内。

我的问题是，在 IE6/7 中我的列 flex。目前我没有每列的“静态”宽度，并希望尽可能避免这种情况。

有什么建议可以避免这种“弯曲”吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T21:18:02.113

这里的这个技巧是使用有点深奥的`table-layout:fixed`规则

像这样使用它：

```
table {table-layout:fixed} 
```

您还应该为`<td>`s 指定明确的列宽。

规则说“这个表格的`table-layout:fixed`单元格宽度取决于我所说的，而不是单元格中的实际内容”。这通常很有用，因为浏览器可以在收到第一个`<tr>`. 否则，浏览器必须先接收整个表格，然后才能计算列宽。但是，在您的情况下，保持绝对列宽也很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T21:16:47.997

表格根据内容动态调整大小。这就是他们的本性。在呈现表格时，您总是可以读取表格的“自然”列宽，然后在调用 Ajax 之前应用一种样式来锁定该形状。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T21:17:26.310

当您说 flex 时，您的意思是调整大小吗？请记住，如果您要更改 DOM 中的任何内容并重新绘制，其行为将类似于它首次将项目呈现到页面时。我在表格中看到的最好结果是清除它们的容器，构建表格然后将其附加到容器中。

如果您因为没有通过类、样式或属性声明静态宽度而谈论列调整自己的大小 - 那么列将根据其内容调整自己的大小。

# sitemap - 您如何通过代码通知 Google 有更新的站点地图？

> ID：538839
> 
> 赞同：16
> 
> 时间：2009-02-11T21:15:48.467
> 
> 标签：sitemap, google-search-console

在此 Google 帮助页面上：

[https://www.google.com/webmasters/tools/docs/en/sitemap-generator.html#submitting](https://www.google.com/webmasters/tools/docs/en/sitemap-generator.html#submitting)

谷歌提到有一种方法可以使用 HTTP 请求通知他们更新的站点地图。

当您单击该链接时，它会将您带到此页面：

[http://www.google.com/support/webmasters/bin/answer.py?answer=34592&topic=8482&hl=en#ping](http://www.google.com/support/webmasters/bin/answer.py?answer=34592&topic=8482&hl=en#ping)

但是没有关于在哪里 ping 什么请求的信息。

有谁知道这个地址是什么，需要什么参数？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-11T21:21:44.693

[http://www.google.com/webmasters/sitemaps/ping?sitemap=](http://www.google.com/webmasters/sitemaps/ping?sitemap=)*您的站点地图的 URL 编码 URL*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-11-18T02:11:40.153

最简单的解决方案：`file_get_contents("https://www.google.com/webmasters/tools/ping?sitemap={$sitemap}");`

这将适用于每个主要的托管服务提供商。如果你想要可选的错误报告，这里是一个开始：

```
$data = file_get_contents("https://www.google.com/webmasters/tools/ping?sitemap={$sitemap}");
$status = ( strpos($data,"Sitemap Notification Received") !== false ) ? "OK" : "ERROR";
echo "Submitting Google Sitemap: {$status}\n"; 
```

至于您应该多久执行一次，只要您的网站可以处理来自 Google 机器人的额外流量而不会减慢速度，您就应该在每次进行更改时执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-04-19T06:23:37.523

谷歌有完整的程序来通知他们更新站点更新，包括如何使用 http 请求（谷歌官方方法）和使用他们的提要进行 ping。在此处阅读官方文档 [https://webmasters.googleblog.com/2014/10/best-practices-for-xml-sitemaps-rssatom.html](https://webmasters.googleblog.com/2014/10/best-practices-for-xml-sitemaps-rssatom.html)

希望有帮助:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-27T16:01:40.220

请参阅[http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=34609](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=34609)

# regex - Emacs - Lisp 中的正则表达式需要双重转义 - 为什么？

> ID：538842
> 
> 赞同：24
> 
> 时间：2009-02-11T21:17:11.350
> 
> 标签：regex, emacs, elisp

我一直在玩emacs lisp，我想写一个小函数来进行正则表达式搜索和替换。我花了很长时间让正则表达式正常工作，因为我没有意识到在编写 lisp 代码时所有特殊字符都需要双重转义（但在交互式使用 query-replace-regexp 时不需要！）。

因此，例如，交互式地使用 query-replace-regexp 您可以使用

```
^\(.*\)[\t]-.*$ 
```

但是在编写 elisp 代码时，您需要像这样对所有内容进行双重转义：

```
^\\(.*\\)[\t]-.*$ 
```

[我终于在 Steve Yegge 的一篇文章](http://steve.yegge.googlepages.com/effective-emacs#item9)中找到了对此的参考，但我想知道是否有人知道这是为什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-11T21:25:04.000

这是因为您需要转义字符串中的反斜杠。如果你不逃避`\(`字符串中的反斜杠，结果只是`(`

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-11T22:35:47.997

您已经有了答案，但是在 Emacs 中创建正则表达式的内置助手是 re-builder。

```
M-x re-builder 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-11T21:47:32.603

scottfrazier 是正确的，读取字符串时解析一个转义，创建正则表达式时解析另一个。这很容易记住，但它可能会变得很痛苦，尤其是当您尝试匹配文字反斜杠“\”时。您最终不得不执行四次 '\\\\' 因为您必须使用双斜杠来匹配初始字符串解析和正则表达式解析中的斜杠。

当你在 Stack Overflow 上写下这个问题时，你必须使用[8 个斜线](https://stackoverflow.com/revisions/viewmarkup/711214)，因为 Markdown 也使用斜线作为转义字符。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-11T23:24:43.807

FWIW，`emacs-lisp-mode`将字体化特殊表达（喜欢 `\\(`和`\\)`为你）。然后你可以改变面孔是突出的东西。

（它们是`font-lock-regexp-grouping-construct`和`font-lock-regexp-grouping-backslash`）

# asp.net - ASP.net and Using Frameworks / Libraries / Methodologies

> ID：538844
> 
> 赞同：0
> 
> 时间：2009-02-11T21:17:56.543
> 
> 标签：asp.net, jquery, asp.net-mvc, blueprint-css

I have built several personal sites and now I and going to rebuild an existing one. I want to standardize on jQuery and Blueprint CSS.

I used to use a Master page for everything but that does not seem to match real well with something like Blueprint. Not to mention the pain of the master page renaming of the controls ids and applying them in js.

Kinda just looking for suggestions on how to use newer libraries / frameworks / methodologies on the new asp.net site.

Should I ditch Master pages altogether?

Should I stop creating my pages with VS page creator GUI and move to building most or all the html and server objects in code dynamically?

Should I look at ASP.net MVC as well?

Any other suggestions appreciated.

Thanks, Erik

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T21:24:36.700

如果您继续使用 MasterPages，则可以从客户端 jQuery 引用您的服务器控件，例如：

$('#<%= MyControl.UniqueID %>')。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T21:38:32.127

如果您打算尝试使用这些框架，我会看看 ASP.NET MVC。它允许对 HTML 进行更好的控制。

ASP.NET 控件并不总是呈现最简单的标记，这会使使用其他框架的过程复杂化。

# ruby-on-rails - 使用 Apache 和 Mongrel 部署 Ruby on Rails

> ID：538850
> 
> 赞同：0
> 
> 时间：2009-02-11T21:19:13.530
> 
> 标签：ruby-on-rails, deployment, apache2, mongrel

我对 ruby​​ on rails 和 web 开发还很陌生。这是我的设置，我从这个链接[http://tonyrose023.blogspot.com/2007/01/multiple-rails-apps-with-mongrel.html](http://tonyrose023.blogspot.com/2007/01/multiple-rails-apps-with-mongrel.html) 我在 Apache2 上使用 Mongrel 集群运行多个 Rails 应用程序。

[http://services.abc.edu/app1](http://services.abc.edu/app1) [http://services.abc.edu/app2](http://services.abc.edu/app2) [http://services.abc.edu/app3](http://services.abc.edu/app3)

这就是我的“虚拟主机”（/etc/apache2/sites-availabe/services.abc.edu）文件的样子

```
--------------
<Proxy balancer://app1> 
BalancerMember http://services.abc.edu:8000 
BalancerMember http://services.abc.edu:8001 
BalancerMember http://services.abc.edu:8002
Order deny,allow
Deny from all
Allow from all
</Proxy>

<Proxy balancer://app2>
BalancerMember http://services.abc.edu:8004
BalancerMember http://services.abc.edu:8005
Order deny,allow
Deny from all
Allow from all
</Proxy>

<Proxy balancer://app3>
BalancerMember http://services.abc.edu:8006
BalancerMember http://services.abc.edu:8007
Order deny,allow
Deny from all
Allow from all
</Proxy>

<VirtualHost *:80>
    ServerName services.abc.edu
    DocumentRoot /home/joe/projects/app1/public

<Directory "/home/joe/projects/app1/public"> 
Options FollowSymLinks 
AllowOverride None 
Order allow,deny 
Allow from all 
</Directory> 

<Directory "/home/joe/projects/app2/public"> 
Options FollowSymLinks 
AllowOverride None 
Order allow,deny 
Allow from all 
</Directory> 

<Directory "/home/joe/projects/app3/public">
Options FollowSymLinks
AllowOverride None
Order allow,deny
Allow from all
</Directory>

RewriteEngine On 

# Rewrite index to check for static 
#RewriteRule ^/$ /index.html [QSA] 
# Rewrite to check for Rails cached page 
RewriteRule ^([^.]+)$ $1.html [QSA] 
# Redirect all non-static requests to cluster 
RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f 
#RewriteRule ^/(.*)$ balancer://mongrel_cluster%{REQUEST_URI} [P,QSA,L] 

RewriteRule ^/app1(.*)$ balancer://app1%{REQUEST_URI} [P,QSA,L]
RewriteRule ^/app2(.*)$ balancer://app2%{REQUEST_URI} [P,QSA,L]
RewriteRule ^/app3(.*)$ balancer://app3%{REQUEST_URI} [P,QSA,L]

</VirtualHost>
----------------------------------------- 
```

我的问题是

1）如果有人可以评论我的设置并提供任何建议，那就太好了。

2）如您所见，我有一个 DocumentRoot，尽管现在所有 3 个应用程序都可以使用，因为它们使用相同的图像，但我认为将来我需要为每个应用程序设置 DocumentRoot

3) 我需要让应用程序安全运行，因此我需要使用 SSL（端口 443）运行它，并且我需要一些帮助以使其使用 SSL 运行。任何指针都会有所帮助，因为我从未安装过证书。我创建了 csr 和密钥，并且随身携带了证书。我正在研究下一步是什么。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T21:31:59.333

我建议你调查一下[Passenger](http://www.modrails.com/)。它非常容易设置，让 Rails 应用程序共享内存，消除管理杂种集群的负担，并且几乎不需要配置。您只需要一个特殊的“config.ru”文件，其中包含一个[RackUp 配置](http://www.modrails.com/documentation/Users%20guide.html#_rackup_specifications_for_various_web_frameworks)和一个指向 Apache 中设置的 RAILS_ROOT/public 的 DocumentRoot。

在 mongrel 中运行多个应用程序的问题在于，您需要为每个应用程序单独创建一个 mongrel 实例。

至于您的 SSL 问题，我发现在[Nginx](http://nginx.net/)中为我的网站的某些部分设置 SSL 非常容易。我不记得如何在 Apache 中做到这一点，但很可能有一些[很好的 howtos](http://www.sitepoint.com/article/securing-apache-2-server-ssl/)。

# c++ - 节点的迭代层次结构 - 访问者和复合？

> ID：538856
> 
> 赞同：8
> 
> 时间：2009-02-11T21:20:57.630
> 
> 标签：c++, oop, design-patterns, composite, visitor-pattern

假设我有一个节点集合，稍后用于我的 Renderer 类。然后我有一个可以访问节点或整个集合的访问者类。这很简单，因为我的节点集合只是 std::list 的包装器，几乎没有额外的方法。

问题是我想要一个树状结构的节点（而不是简单的列表），所以一个节点可以有一个父节点和 n 个子节点。这会很方便，因为我希望能够将一个节点传递给我的渲染器并渲染该节点“下方”的所有内容。答案可能是复合。

如何同时使用访客和复合？我读过它通常是一个很好的组合，但我的实现看起来很糟糕......我错过了某事。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T21:55:56.017

我为我们的系统实现了一些非常相似的东西。我想要一种方法来组合几何对象的层次结构并将它们渲染到体积中。我使用复合模式来组成我的描述（根是节点，然后派生的子节点是复合节点（节点列表）。

CompositeNode 有方法 accept() 接受访问者 (Visitor)，然后在 accept() 中执行访问者->访问 (this)。

因此，您的访问者层次结构具有作为 NodeVisitor 的基类和派生访问者，如 RenderVisitor（呈现对象）、ReportVisitor（将节点信息转储到文本中）。您的基类需要同时接受基本节点类型和专用节点类型。

所以是的，组合有效，我有工作代码，但我同意设计比你在网上阅读的内容（维基或玩具示例）需要更多的努力。

希望这可以帮助

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T23:31:37.097

这是一个简单的例子：

```
struct NodeVisitor;

struct Node
{
  virtual ~Node() {}
  virtual void accept(NodeVisitor &v);
};

struct CompositeNode : public Node
{
  virtual void accept(NodeVisitor &v);
  std::list<NodePtr> nodes_;
};

struct NodeVisitor
{
  virtual ~NodeVisitor() {}
  virtual void visit(Node &n) = 0;
  virtual void visit(CompositeNode &cn)
  {
    for(std::list<NodePtr>::iterator it = cn.nodes_.begin(), end = cn.nodes_.end(); it != end; ++it)
    {
      (*it)->accept(*this);
    }
  }
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-04T15:18:01.373

如果您希望您的访问者也知道树的结构（例如，它正在访问的深度或从树根开始的路径），您可以考虑使用分层访问者模式。这在[c2.com wiki上的描述有些冗长](http://c2.com/cgi/wiki?HierarchicalVisitorPattern)

它还展示了如何跳过“无趣”的分支。

# iphone - 一个笔尖，不同的资产。捆绑？

> ID：538859
> 
> 赞同：11
> 
> 时间：2009-02-11T21:21:42.370
> 
> 标签：iphone, cocoa-touch, xcode, interface-builder, target

我有一个 iPhone 应用程序，它具有不同的皮肤风格，具有不同的艺术资产和声音，但代码都是相同的。

我已经设置了多个目标，但我遇到的问题是我必须有一组不同的 UIBuilder nib 文件，每个目标每个视图一个，设置为指向该目标的正确艺术。

这有点令人沮丧，因为如果我对一个 nib 文件进行更改，我必须在所有其他 nib 文件中手动进行相同的更改、相同的连接等。我还为不同的皮肤添加了不同名称的所有资产，这样它们就不会在项目中发生冲突。所以，如果我有目标 A 和 B，我有`a_main_menu.png`, `b_main_menu.png`... `a_FooViewController.xib`, `b_FooViewController.xib`... 等等。

有没有办法制作一个指向具有相同名称的资产的 nib 文件，但它们位于......嗯，不同的捆绑包中？这就是捆绑包的用途吗？我可以想象在我的代码中修复这样的东西（可能在加载之前在笔尖中搜索并替换 A 为 B 甚至可能已经足够好了），虽然我还没有尝试过，但这很难看。

对于我的第一组应用程序来说，这是一个易于管理的策略（尽管远非最佳），但随着我的东西变得越来越复杂，让我的构建器文件保持同步变得非常困难，而且这不是一种非常干燥的工作方式。除了放弃 uibuilder 并在代码中创建我的视图之外，还有更好的方法吗？

如果这在 xcode/builder 级别上工作会很好，所以 builder 会尊重我当前的目标并在我工作时展示该目标的艺术......但我也许可以没有它，就像我可以选择运行时当前的一组艺术作品，我只能在 builder 中使用一组作品。我也可以使用一组笔尖，通过一个目标并在构建之前手动替换所有艺术作品，但这也不是很好。

最好的情况是，如果我可以混合使用这两种策略——例如，如果我有一个目标，它具有多个视图中的一个视图，而必须以不同的方式布局……但这是可选的。

我在问正确的问题吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-21T16:35:57.330

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T22:44:55.213

Assuming that each app only needed one skin at a time, and that you are creating multiple apps with different themes, I would create a branch in my source control and then replace the necesary assets. You keep a master branch with all default assets and then you merge code changes from the master into your skinned branches keeping everything in sync.

Git makes this super easy.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-21T15:17:12.700

我认为最好的选择是使用 git 之类的东西。

如果您使用 git，您可以拥有一个包含主源代码和逻辑的主分支，并拥有针对应用程序的每种特定风格具有不同数据/图像集的子分支。在这个解决方案中，XCode 甚至不知道发生了什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-18T10:47:41.023

这对我有用：

1个项目。2个目标a，b。a、b 的 2 个图像文件夹。

controller.m 及其 nib 文件适用于这两个目标。

为目标 a 和 b 的图像创建单独的文件系统文件夹。

将一个图像文件夹导入到目标 a（“将文件添加到 xy”->“添加到目标 a/b”），另一个到目标 b。确保使用“为添加的文件夹创建组”选项。不要选择“文件夹引用”选项。

当我构建目标 a 时，我得到一个包含文件夹 a 中图像的应用程序；当我为 b 构建时，它使用文件夹 b 来保存图片。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-21T15:30:12.143

我认为这就是 viewDidLoad 的用途，要自定义更多，在这里您可以更改图像路径。

# php - 在 PHP 中获取子类的名称

> ID：538863
> 
> 赞同：1
> 
> 时间：2009-02-11T21:22:08.140
> 
> 标签：php, oop

假设我正在构建一个基类，子类将对其进行扩展。所以一个基类被调用`Base`，子类可以是`Child1`,`Child2`等等。

在基类的构造函数中，如何获取 Child1/Child2 的值？

这都是使用PHP

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-11T21:26:15.090

只需调用[get_class](http://php.net/get_class) ($this) - 但是请注意，基类方法在根据哪个派生类使用它来改变其行为方面并没有真正的业务。这就是派生类的全部意义:)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-11T21:27:45.287

基类真的不应该依赖于子类的信息——

要回答您的问题：

```
class base {
    public function __construct() {
        print "Class:" . get_class($this) . "\n";
    }
}

class child extends base{
    public function __construct() {
        parent::__construct();
    }
}
$c = new child(); 
```

仅供将来参考——这可以使用 get_call_class() 在静态上下文中实现，但这仅在 PHP >= 5.3 中可用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:23:49.883

编辑：不知道`get_class`，忽略这个；）

您可以尝试`__CLASS__`，但它可能无法正常工作。

解决方法可能是将类名指定为基类的属性。

**编辑：**这不起作用（我使用了以下代码）construct() { echo __CLASS; } }

```
class b extends a {}

$b = new b; 
```

我建议将 $b 的名称作为参数传递给 A，例如：

```
<?php
class a {
    protected $name;
    public function __construct() {
        echo $this->name;
    }
}

class b extends a {
    protected $name = __CLASS__;
}

$b = new b; 
```

# html - 您如何存档整个网站以供离线查看？

> ID：538865
> 
> 赞同：57
> 
> 时间：2009-02-11T21:22:16.470
> 
> 标签：html, web-crawler, archive

实际上，我们已经多次为客户烧录我们的 asp.net 网站的静态/存档副本。到目前为止，我们一直在使用[WebZip](http://www.spidersoft.com/)，但我们遇到了无数的崩溃问题，下载的页面没有正确重新链接等等。

我们基本上需要一个应用程序来抓取和下载我们的 asp.net 网站上所有内容（页面、图像、文档、css 等）的静态副本，然后处理下载的页面，以便可以在没有互联网连接的情况下在本地浏览它们（摆脱链接中的绝对网址等）。白痴证明越多越好。这似乎是一个非常常见且（相对）简单的过程，但我尝试了其他一些应用程序并且真的不为所动

有没有人推荐的存档软件？有没有人愿意分享一个非常简单的过程？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-02-11T21:25:46.120

你可以使用[wget](http://www.gnu.org/software/wget/)：

```
wget -m -k -K -E http://url/of/web/site 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-02-11T21:34:20.733

在 Windows 中，您可以查看[HTTrack](http://www.httrack.com/)。它非常可配置，允许您设置下载速度。但是您可以将它指向一个网站并运行它，而无需任何配置。

以我的经验，它是一个非常好的工具并且运行良好。我喜欢 HTTrack 的一些地方是：

*   开源许可证
*   恢复停止的下载
*   可以更新现有存档
*   您可以在下载时将其配置为非攻击性，这样就不会浪费您的带宽和站点的带宽。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-11-02T01:07:05.693

[hartator](https://github.com/hartator)的[Wayback Machine 下载](https://github.com/hartator/wayback-machine-downloader)器既简单又快速。

[通过 Ruby 安装，然后使用来自Internet Archive](https://archive.org/)的所需域和可选时间戳运行。

```
sudo gem install wayback_machine_downloader
mkdir example
cd example
wayback_machine_downloader http://example.com --timestamp 19700101000000 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-11T21:26:07.977

我在 OSX上使用[Blue Crab ，在 Windows 上使用](http://www.apple.com/downloads/macosx/internet_utilities/bluecrab.html)[WebCopier](http://www.download.com/WebCopier/3000-2377_4-10028393.html?tag=mncol;pop)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-11T21:26:28.457

wget -r -k

...并调查其余的选项。我希望您已遵循以下准则：[http](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html) ://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html ，因此您的所有资源对于 GET 请求都是安全的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T21:25:26.510

我只是使用：`wget -m <url>`。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-04-24T14:24:45.773

对于 OS X 用户，我发现在[这里](https://ricks-apps.com/)找到的 sitesucker 应用程序运行良好，无需配置任何东西，但它跟随链接的深度。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-03-09T18:23:45.087

如果您的客户正在归档合规性问题，您希望确保可以对内容进行身份验证。列出的选项适合简单查看，但它们在法律上是不可接受的。在这种情况下，您正在寻找时间戳和数字签名。如果你自己做会复杂得多。我建议使用[PageFreezer 之](https://www.pagefreezer.com/)类的服务。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-11T21:58:38.710

我已经使用 HTTrack 好几年了。它可以处理所有页面间链接等。我唯一的抱怨是我还没有找到一个很好的方法来很好地将它限制在一个子站点上。例如，如果我想归档一个网站 www.foo.com/steve，它可能会跟随指向 www.foo.com/rowe 的链接并将其归档。否则很棒。高度可配置且可靠。

# java - 如果私有帮助方法可以是静态的，那么它们是否应该是静态的

> ID：538870
> 
> 赞同：214
> 
> 时间：2009-02-11T21:24:32.597
> 
> 标签：java, static, methods, static-methods

假设我有一个设计为实例化的类。我在类中有几个私有的“帮助器”方法，它们不需要访问任何类成员，并且只对它们的参数进行操作，返回结果。

```
public class Example {
   private Something member;

   public double compute() {
       double total = 0;
       total += computeOne(member);
       total += computeMore(member);
       return total;         
   }

   private double computeOne(Something arg) { ... }
   private double computeMore(Something arg) {... } 
} 
```

是否有任何特殊的理由来指定`computeOne`和`computeMore`作为静态方法 - 或者有任何特殊的理由不这样做？

将它们保留为非静态当然是最容易的，即使它们当然可以是静态的而不会引起任何问题。

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2009-02-11T21:33:45.087

我更喜欢这样的辅助方法`private static`；这将使读者清楚他们不会修改对象的状态。我的 IDE 还会以斜体显示对静态方法的调用，因此我无需查看签名即可知道该方法是静态的。

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2009-02-11T21:32:53.607

由于静态方法无法访问`this`. 我认为它对速度没有任何影响（如果有的话，它可能太小而无法整体产生影响）。

我会让它们成为静态的，因为如果可能的话，我通常会这样做。但这只是我。

* * *

**编辑：**这个答案一直被低估，可能是因为关于字节码大小的未经证实的断言。所以我会实际运行一个测试。

```
class TestBytecodeSize {
    private void doSomething(int arg) { }
    private static void doSomethingStatic(int arg) { }
    public static void main(String[] args) {
        // do it twice both ways
        doSomethingStatic(0);
        doSomethingStatic(0);
        TestBytecodeSize t = new TestBytecodeSize();
        t.doSomething(0);
        t.doSomething(0);
    }
} 
```

字节码（用 检索`javap -c -private TestBytecodeSize`）：

```
Compiled from "TestBytecodeSize.java"
class TestBytecodeSize extends java.lang.Object{
TestBytecodeSize();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

private void doSomething(int);
  Code:
   0:   return

private static void doSomethingStatic(int);
  Code:
   0:   return

public static void main(java.lang.String[]);
  Code:
   0:   iconst_0
   1:   invokestatic    #2; //Method doSomethingStatic:(I)V
   4:   iconst_0
   5:   invokestatic    #2; //Method doSomethingStatic:(I)V
   8:   new     #3; //class TestBytecodeSize
   11:  dup
   12:  invokespecial   #4; //Method "<init>":()V
   15:  astore_1
   16:  aload_1
   17:  iconst_0
   18:  invokespecial   #5; //Method doSomething:(I)V
   21:  aload_1
   22:  iconst_0
   23:  invokespecial   #5; //Method doSomething:(I)V
   26:  return

} 
```

调用静态方法需要两个字节码（byteops？）：（`iconst_0`用于参数）和`invokestatic`.
调用非静态方法需要三个：（`aload_1`对于`TestBytecodeSize`对象，我想）、`iconst_0`（对于参数）和`invokespecial`. （请注意，如果这些不是私有方法，它会`invokevirtual`代替`invokespecial`；请参阅[JLS §7.7 Invoking Methods](http://java.sun.com/docs/books/jvms/second_edition/html/Compiling.doc.html#14787)。）

`invokestatic`现在，正如我所说，除了需要少一个字节码的事实之外，我不认为这两者之间的性能会有很大差异。`invokestatic`并且`invokespecial`都应该比 快一点`invokevirtual`，因为它们都使用静态绑定而不是动态绑定，但我不知道其中一个是否比另一个快。我也找不到任何好的参考资料。我能找到的最接近的是[这篇 1997 JavaWorld article](http://www.javaworld.com/javaworld/jw-06-1997/jw-06-hood.html)，它基本上重申了我刚才所说的内容：

> 最快的指令很可能是`invokespecial`and `invokestatic`，因为这些指令调用的方法是静态绑定的。当 JVM 解析这些指令的符号引用并将其替换为直接引用时，该直接引用可能包含指向实际字节码的指针。

但自 1997 年以来，许多事情都发生了变化。

所以总而言之......我想我仍然坚持我之前所说的。速度不应该是选择一个而不是另一个的理由，因为它充其量只是一个微优化。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-11T21:30:56.683

我个人的偏好是将它们声明为静态，因为它们是无国籍的明确标志。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-02-11T21:55:55.627

答案是……这取决于。

如果 member 是特定于您正在处理的对象的实例变量，那么为什么将它作为参数传递呢？

例如：

```
public class Example {
   private Something member;

   public double compute() {
       double total = 0;
       total += computeOne();
       total += computeMore();
       return total;         
   }

   private double computeOne() { /* Process member here */ }
   private double computeMore() { /* Process member here */ } 
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-11T23:55:07.103

您可能想要声明静态辅助方法的一个原因是您是否需要在类构造函数“之前”`this`或`super`. 例如：

```
public class MyClass extends SomeOtherClass { 
    public MyClass(String arg) {
       super(recoverInt(arg));
    }

    private static int recoverInt(String arg) {
       return Integer.parseInt(arg.substring(arg.length() - 1));
    }
} 
```

这是一个人为的例子，但`recoverInt`在这种情况下显然不能成为实例方法。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-02-11T21:35:00.107

我真的想不出私有静态方法的明显优势。话虽如此，使它们成为非静态也没有特定的优势。这主要是一个表示问题：您可能希望使它们成为静态以清楚地强调它们没有改变对象的事实。

对于具有不同访问权限的方法，我认为有两个主要论点：

*   可以在不创建对象实例的情况下调用静态方法，这很有用
*   静态方法不能被继承，如果您需要多态（但与私有方法无关），这可能是个问题。

除此之外，差异非常小，我强烈怀疑传递给实例方法的额外 this 指针是否会产生显着差异。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-09-05T13:00:24.290

正确答案是：

任何不从字段中获取任何信息并且不将任何信息放入字段中的方法不必是实例方法。任何不使用或更改其类或对象中的任何字段的方法也可能是静态方法。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-12T00:28:18.333

> *或者有什么特别的理由不[将它们声明为静态的]？*

是的。

通过将它们保留为实例方法，您可以稍后提供不同的实现。

这听起来可能很愚蠢（实际上，如果这些方法仅由您在 50 行程序中使用），但在更大的应用程序或其他人使用的库中，您可能会决定选择更好的实现，但不要想要破坏现有的代码。

因此，您创建一个子类并在新版本中返回它，并且由于这些方法被声明为实例方法，您只需让多态性完成它的工作。

此外，出于同样的原因，您可以从将构造函数设为私有并提供静态工厂方法中受益。

因此，我的建议是将它们保留为实例方法，并尽可能避免使用静态方法。
利用语言提供的活力。

看这里有一些相关的视频：[如何设计一个好的 API 及其重要性](http://www.youtube.com/watch?v=aAb7hSCtvGw)

虽然它与“静态 vs 实例”方法的讨论没有直接关系，但它触及了 API 设计中的一些有趣点。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-11T21:43:30.913

如果该方法基本上只是一个永远不会使用状态信息的子例程，则将其声明为静态。

这允许它在其他静态方法或类初始化中使用，即：

```
public class Example {
   //...

   //Only possible if computeOne is static
   public final static double COMPUTED_ONE = computeOne(new Something("1"));

   //...
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-04-25T14:02:26.443

**使用静态方法的一个问题是它会使对象在单元测试**中更难使用。Mockito 不能为静态方法创建模拟，并且您不能创建该方法的子类实现。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-11T21:34:33.977

静态/非静态问题归结为“我真的需要使用此类的对象”吗？

那么，您是否在不同方法之间传递对象？对象是否包含在静态方法上下文之外有用的信息？如果您将两种方式都使用，是否有任何理由不定义两种方式？

如果您处于这种两难境地，在我看来，您拥有该方法所需的所有数据，这些数据都在对象之外的代码中浮动。这是你想要的吗？每次都将数据收集到一个对象中会更容易吗？您可能只是对致力于单一模型感到矛盾。如果您可以使用一种方式完成所有操作，请选择静态或非静态并继续使用。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-11T21:48:08.407

在这种情况下，我的偏好是 make`computeOne`和`computeMore`static 方法。原因：封装。可以访问您的类的实现的代码越少越好。

在您给出的示例中，您声明`computeOne`并且`computeMore`不需要访问类的内部，那么为什么要让类的维护者有机会干预内部。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-12T04:20:31.397

我想澄清其他发帖人所说的一些事情，因为它提供了错误的信息。

首先，由于这些方法是私有的，即使您将它们声明为静态，您也无法在此类之外访问它们。其次，它们是私有的，因此您甚至不能在子类中覆盖，因此静态或非静态没有任何区别。第三，也可以从类的构造函数中调用非静态私有方法，它不必是静态的。

现在来回答您的问题，如果应将私有辅助方法定义为静态或非静态。我将使用史蒂夫的回答，因为将私有方法标记为静态表明此方法是无状态的，因为我在编码时也遵循此规则。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2012-11-07T07:10:47.420

根据经验，我会说这种私有方法往往是相当普遍和可重用的。

我认为首先要做的是询问该方法在当前类上下文之外是否有用。如果是这样，我会完全按照每个人的建议去做，并将这个方法作为静态方法提取到某个 utils 类中，希望有人在执行完全相同的事情之前检查它。

这种通用的私有方法是项目中大部分代码重复的来源，因为每个开发人员都在她需要使用的地方独立地重新发明它们。因此，这些方法的集中化是一条可行的路。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-11T21:39:30.143

更具体地说，对于您给出的示例，定义这些方法的目的似乎是在您阅读它时更清楚代码而不是功能（它们*被*定义为私有）。在这种情况下，使用 static 真的对您没有任何帮助，因为 static 的目的是公开类功能。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-23T14:35:38.290

一个原因是，在其他条件相同的情况下，静态方法调用应该更快。静态方法不能是虚拟的，并且不采用隐式 this 引用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-11-25T05:57:31.343

正如很多人所说，让它成为一个***静态***的！这是我遵循的经验法则：如果您认为该方法只是一个*数学函数*，即它是无状态的，不涉及任何实例变量（=> 方法中没有蓝色变量 [in eclipse]），结果对于“n”次调用，该方法将是相同的（当然，使用相同的参数），然后将该方法标记为 STATIC。

如果您认为此方法对其他类有用，则将其移至 Util 类，否则，将该方法作为私有方法放在同一类中。（最小化可访问性）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-11-25T06:29:42.587

题外话：我会将辅助方法保留在一个独立的实用程序/辅助类中，其中只有静态方法。

在使用时使用辅助方法（阅读“同一类”）的问题在于，下线的人可能只是选择在同一个地方发布他们自己不相关的辅助方法

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-08-05T06:47:18.767

```
class Whatever {

    public static varType myVar = initializeClassVariable();

    private static varType initializeClassVariable() {

        //initialization code goes here
    }
} 
```

私有静态方法的优点是，如果您需要重新初始化类变量，它们可以在以后重用。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-10-25T07:07:55.030

1.  如果没有静态修饰符，您将无法确定该方法是无状态的，而无需额外分析，这在您（重新）编写该方法时可以轻松完成。

2.  然后“静态”修饰符可能会为您提供有关重构的想法，以及其他人可能认为无用的其他内容。例如将方法移动到某个实用程序类或将其转换为成员方法..

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-02-11T21:51:38.897

我会将它们声明为静态以将它们标记为无状态。

Java 对于不导出的小操作没有更好的机制，所以我认为私有静态是可以接受的。

# java - 在 GWT 启动时启动后台线程

> ID：538872
> 
> 赞同：4
> 
> 时间：2009-02-11T21:24:37.073
> 
> 标签：java, multithreading, gwt

我有一个显示由 JFreeChart 呈现的一些图表的 GWT 应用程序。每隔几分钟，页面就会刷新一次，这会导致应用程序生成新的图表。（换句话说，整个图表生成过程由客户端请求引导。）这样做的问题是多个客户端访问同一服务器会导致生成图表的多个请求，但是由于所有用户的图表都是相同的，真的没有理由这样做。我想在后台线程中预渲染图表，这将在应用程序启动时启动，然后根据请求将已经渲染的图表提供给客户端。

我在 GWT 中看不到任何“认可”的方式来在服务器启动时执行您自己的代码。我能想到的唯一方法是创建一个在启动时由应用程序容器加载的 servlet，并在 init() 方法中启动图表生成线程。

有没有更优选的方法来做到这一点？

注意：假设它是真的，“否”是一个完全可以接受的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T00:37:05.520

回答您的问题：不。GWT 是一种前端技术，而 GWT 中唯一跨越这条线的是 RPC 机制。您可以做到的唯一“GWT”类型方法是在用户第一次请求图表文件时检查图表文件是否存在，如果不存在则生成它们。这意味着使用文件系统来检查它是否已经创建。

更好的方法是按照你说的做，例如：配置你的 web 项目以在启动时启动课程。您可以在 web.xml 中执行此操作，如下所述：

[http://wiki.metawerx.net/wiki/Web.xml.LoadOnStartup](http://wiki.metawerx.net/wiki/Web.xml.LoadOnStartup)

下面是 Stripes 如何做到这一点的示例：

```
<servlet>
        <servlet-name>StripesDispatcher</servlet-name>
        <servlet-class>net.sourceforge.stripes.controller.DispatcherServlet</servlet-class>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>StripesDispatcher</servlet-name>
        <url-pattern>*.action</url-pattern>
    </servlet-mapping> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-31T22:34:53.970

我不同意您应该将代码放在 servlet 初始化中以创建这些线程。当 Web 应用程序停止时，您将无法控制何时销毁这些线程。此外，当您再次启动 Web 应用程序时，它是否会再次创建这些线程？

更好的是使用名为 contextInitialized 的 J2EE ServletContextListener 事件来创建线程，并使用 contextDestroyed 事件来销毁线程。这还允许您控制线程销毁并在销毁线程之前等待线程中的代码完成执行。

看起来这解释了它是如何工作的： [http ://www.java-tips.org/java-ee-tips/java-servlet/how-to-work-with-servletcontextlistener.html](http://www.java-tips.org/java-ee-tips/java-servlet/how-to-work-with-servletcontextlistener.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T11:24:39.800

首先，我不同意之前的海报，即 GWT 只是一种前端技术，因为该框架包括用于异步构建和调用服务的所有内容。例如，参见 RemoteServiceServlet 和用法。GWT 提供客户端和服务器端组件。

话虽如此，GWT 似乎并没有专门的启动类型 servlet。但是，由于后端是基于 servlet 的，为了保持一致性，我倾向于使用启动 servlet（在 google 中搜索[Loading Servlets on Startup](http://www.google.com/search?hl=en&q=loading+servlet+on+startup&btnG=Google+Search&aq=0&oq=loading+servlet)），并让它在启动时生成图表，然后根据需要定期生成图表.

另一种选择是有一个定期重新构建图表的 cron 作业，直接或通过调用私有服务。

无论哪种方式，客户端请求都将只检索预先生成的图表。生成新图表时，只需将其替换旧图表即可，这样用户就不会出现明显的延迟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T13:14:50.660

GWT 是一个前端框架。我确实有一些特定的服务器组件，但这些仅用于序列化/反序列化客户端的请求。请记住，前端是 JavaScript，后端是 java。因此，服务器组件将 JavaScript 对象转换为它的 java 表示形式。如果您查看您的代码，您会注意到 GWT RemoteServiceServlet 只是继承了标准“javax.servlet.http.HttpServlet”，就像任何 servlet 一样。它只是实现了自己的 doPost 和 doGet 方法来进行序列化。

话虽如此，您的问题可能适用于许多其他框架。它不依赖于 GWT。您只需要配置您的 servlet 容器以在启动时启动 GWT RemoteServiceServlet。servlet 可以具有所有客户端使用的静态缓存并提供相同的图表。然后，您可以在启动时启动第二个线程，定期更新线程。

# python - 在 Python 中将 S3 数据并行/异步下载到 EC2 中？

> ID：538875
> 
> 赞同：2
> 
> 时间：2009-02-11T21:25:10.350
> 
> 标签：python, amazon-s3, amazon-ec2

我在 S3 中存储了需要分析的大型数据文件。每批由约 50 个文件组成，每个文件都可以独立分析。

我想将 S3 数据的并行下载设置到 EC2 实例中，并设置触发器以启动每个下载文件的分析过程。

是否有任何库可以处理异步下载，在完整模型上触发？

如果没有，我正在考虑使用 pyprocessing 设置多个下载进程，每个下载进程都将下载并分析文件的单个片段。这听起来合理还是有更好的选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-13T20:37:58.317

回答我自己的问题后，我最终对 Amazon S3 python 库进行了简单的修改，让您可以分块下载文件或逐行读取文件。[在这里可用](http://parand.com/say/index.php/2009/03/13/python-s3-library-for-chunked-streaming-download/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T21:28:41.743

听起来您正在寻找[twisted](http://twistedmatrix.com/trac/)：

“Twisted 是一个事件驱动的网络引擎，用 Python 编写并获得 MIT 许可。”

[http://twistedmatrix.com/trac/](http://twistedmatrix.com/trac/)

我已经在很多异步项目中使用了 twisted python，这些项目既涉及通过 Internet 进行通信，也涉及到子进程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:30:34.203

我不知道已经存在的任何东西可以完全满足您的需求，但即使不是，它也应该相当容易与 Python 放在一起。对于线程方法，您可以查看这个[**Python 配方**](http://code.activestate.com/recipes/284631/)，它执行多线程 HTTP 下载以测试下载镜像。

**编辑**：我发现很少有软件包可以为您完成大部分工作并且是您正在寻找的

*   [**蜘蛛**](http://pypi.python.org/pypi/spider.py/0.5)
*   [**收获人**](http://pypi.python.org/pypi/HarvestMan/1.4.6%20final/)

# java - Linux 中的 java.lang.UnsatisfiedLinkError

> ID：538886
> 
> 赞同：4
> 
> 时间：2009-02-11T21:26:32.873
> 
> 标签：java, linux, java-native-interface, native

我已经设法进入一台 linux 机器来尝试[这个答案中建议的 HotKey 库。](https://stackoverflow.com/questions/79658/react-on-global-hotkey-in-a-java-program-on-windows-linux-mac/202272#202272)

我已经编译了示例代码，现在我运行程序并收到以下消息：

```
[oracle@machine jxgrabkey-0.2.1_i386]$ java -classpath lib/JXGrabKey.jar: 示例 JXGrabKeyTest

线程“main”中的异常**java.lang.UnsatisfiedLinkError：** /home/oracle/javasample/jxgrabkey-0.2.1_i386/lib/libJXGrabKey.so：/usr/lib/libstdc++.so.6：版本`GLIBCXX_3。 4.9' 未找到（/home/oracle/javasample/jxgrabkey-0.2.1_i386/lib/libJXGrabKey.so 需要）
   在 java.lang.Runtime._load(libgcj.so.7rh)
   在 java.lang.Runtime.load(libgcj.so.7rh)
   在 java.lang.System.load(libgcj.so.7rh)
   在 JXGrabKeyTest.main(JXGrabKeyTest.java:17)

```

我知道如何在 Windows 中处理这个问题（只需将 DLL 添加到 PATH env var 中），但我对 linux 不太确定。

我读过一些关于 LD_LIBRARY_PATH 和其他一些环境变量的东西，但我可以让它工作。

有什么建议吗？

**编辑**

在 mmyers 的支持下确定问题并阅读[此线程](http://www.linuxquestions.org/questions/linux-newbie-8/usrliblibstdc.so.6-version-glibcxx3.4.9-not-found-required-by-.example1-604625/)和[其他](http://ubuntuforums.org/showthread.php?t=666744).

我可以告诉：

我的系统是：Linux 2.6.18-53.el5

我的 GCC 版本是（是）：

gcc-c++-4.1.2-14.el5

gcc-gfortran-4.1.2-14.el5

libgcc-4.1.2-14.el5

gcc-4.1.2-14.el5

问题是我需要 gcc 4.2.0

Aaand 显然我的系统没有 gcc 4.2.0。

我想我将不得不等待它来或作者在以前的版本中重新编译它。

mmyers，非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-11T21:30:07.450

你试过了`-Djava.library.path=/path/to/library`吗？

**编辑：**重新阅读错误消息，在我看来，您正在加载的本机库正在尝试链接到 glibc 版本 3.4.9，这显然没有安装。你能检查一下你有什么版本的 glibc 吗？您正在运行什么 Linux 发行版？

**EDIT2：**问题似乎缩小到 libstdc++。我即将达到我的知识边缘，但[这个线程](http://ubuntuforums.org/showthread.php?t=666744)可能有用。它建议升级到 gcc 4.2；从评论中，您似乎拥有 4.1.2 版本。如果这不起作用，请告诉我。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T18:04:19.023

subes，JXGrabKey 在这里开发...

我自己对这个错误了解不多，但你对 gcc 和/或 libstdc++ 的领导应该是正确的

我个人使用的是 Ubuntu 8.10 atm 附带的 gcc 版本。我总是坚持使用最新发布的版本。

当前版本：g++ (Ubuntu 4.3.2-1ubuntu12) 4.3.2

我的机器上安装了以下 libstdc++ 软件包： [http://packages.ubuntu.com/intrepid/libstdc++5](http://packages.ubuntu.com/intrepid/libstdc++5) [http://packages.ubuntu.com/intrepid/libstdc++6](http://packages.ubuntu.com/intrepid/libstdc++6)

希望这会有所帮助，如果您发现任何有用的信息，请告诉我。:) 也许我必须用旧版本的 gcc 编译 jxgrabkey 才能发布，所以它向下兼容？有没有人有明智的建议？^^

# jquery - 将 JQGrid 与 WCF Web 服务结合使用

> ID：538891
> 
> 赞同：4
> 
> 时间：2009-02-11T21:27:53.120
> 
> 标签：jquery, wcf, jqgrid

我正在尝试从我的 ASP.NET 2.0 WebForms 应用程序中运行的 WCF Web 服务获取 JQGrid 的数据。问题是 WCF Web 服务希望将数据格式化为 JSON 字符串，而 JQGrid 正在执行 HTTP Post 并将其作为 Content-Type: application/x-www-form-urlencoded 传递。

尽管返回给 JQGrid 的数据格式似乎有多种选择（它接受 JSON、XML 和其他格式），但似乎没有办法改变将输入传递给 Web 服务的方式。

所以我试图弄清楚如何调整 WCF 服务以便它接受

```
Content-Type: application/x-www-form-urlencoded 
```

而不是

```
Content-Type:"application/json; charset=utf-8" 
```

当我使用 JQuery 进行测试以使用 url 编码发送 Ajax 请求时（如图所示）：

```
$.ajax({
    type: "POST",
    url: "../Services/DocLookups.svc/DoWork",
    data: 'FirstName=Howard&LastName=Pinsley',
    contentType: "Content-Type: application/x-www-form-urlencoded",
    dataType: "json",
    success: function(msg) {
        alert(msg.d);
    }
}); 
```

通话失败。使用 Fiddler 检查流量，我发现服务器返回的错误：

```
{"ExceptionDetail":{"HelpLink":null,"InnerException":null,"Message":
"The incoming message has an unexpected message format 'Raw'. The expected
message formats for the operation are 'Xml', 'Json'. This can be because 
a WebContentTypeMapper has not been configured on the binding. 
See the documentation of WebContentTypeMapper for more details."... 
```

请注意，此代码确实有效，因为编码不同

```
$.ajax({
    type: "POST",
    url: "../Services/DocLookups.svc/DoWork",
    data: '{"FirstName":"Howard", "LastName":"Pinsley"}',
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function(msg) {
        alert(msg.d);
    }
}); 
```

在服务器上，服务如下所示：

```
[ServiceContract(Namespace = "")]
[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]
[ServiceBehavior(IncludeExceptionDetailInFaults = true)]
public class DocLookups {
    // Add [WebGet] attribute to use HTTP GET

    [OperationContract]
    public string DoWork(string FirstName, string LastName) {
        return "Your name is " + LastName + ", " + FirstName;
    }
} 
```

我的 web.config 包含：

```
<system.serviceModel>
  <behaviors>
   <endpointBehaviors>
    <behavior name="DocLookupsAspNetAjaxBehavior">
     <enableWebScript />
    </behavior>
   </endpointBehaviors>
  </behaviors>
  <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />
  <services>
   <service name="DocLookups">
    <endpoint address="" behaviorConfiguration="DocLookupsAspNetAjaxBehavior"
     binding="webHttpBinding" contract="DocLookups" />
   </service>
  </services>
</system.serviceModel> 
```

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T21:54:29.903

如果您无法控制 ajax 调用，我建议您创建 Interceptor 来覆盖 Content-Type Header。

```
public class ContentTypeOverrideInterceptor : RequestInterceptor
{
    public string ContentTypeOverride { get; set; }

    public ContentTypeOverrideInterceptor(string contentTypeOverride) : base(true)
    {
        this.ContentTypeOverride = contentTypeOverride;
    }

    public override void ProcessRequest(ref RequestContext requestContext)
    {
        if (requestContext == null || requestContext.RequestMessage == null)
        {
            return;
        }
        Message message = requestContext.RequestMessage;
        HttpRequestMessageProperty reqProp = (HttpRequestMessageProperty)message.Properties[HttpRequestMessageProperty.Name];
        reqProp.Headers["Content-Type"] = ContentTypeOverride;
    }
} 
```

然后，如果您查看 .svc 文件，您将看到 AppServiceHostFactory 类将其更改为包含拦截器

```
class AppServiceHostFactory : ServiceHostFactory
{
    protected override ServiceHost CreateServiceHost(Type serviceType, Uri[] baseAddresses)
    {
        var host = new WebServiceHost2(serviceType, true, baseAddresses);
        host.Interceptors.Add(new ContentTypeOverrideInterceptor("application/json; charset=utf-8"));
        return host;
    }
} 
```

那应该为你做。

## 更新

如评论中所述，上述方法适用于 WCF REST Starter Kit。如果您仅使用常规 WCF 服务，则必须创建 IOperationBehavior 并将其附加到您的服务。这是行为属性的代码

```
public class WebContentTypeAttribute : Attribute, IOperationBehavior, IDispatchMessageFormatter
{
    private IDispatchMessageFormatter innerFormatter;
    public string ContentTypeOverride { get; set; }

    public WebContentTypeAttribute(string contentTypeOverride)
    {
        this.ContentTypeOverride = contentTypeOverride;
    }

    // IOperationBehavior
    public void Validate(OperationDescription operationDescription)
    {

    }

    public void ApplyDispatchBehavior(OperationDescription operationDescription, DispatchOperation dispatchOperation)
    {
        innerFormatter = dispatchOperation.Formatter;
        dispatchOperation.Formatter = this;
    }

    public void ApplyClientBehavior(OperationDescription operationDescription, ClientOperation clientOperation)
    {

    }

    public void AddBindingParameters(OperationDescription operationDescription, BindingParameterCollection bindingParameters)
    {

    }

    // IDispatchMessageFormatter
    public void DeserializeRequest(Message message, object[] parameters)
    {
        if (message == null)
            return;

        if (string.IsNullOrEmpty(ContentTypeOverride))
            return;

        var httpRequest = (HttpRequestMessageProperty)message.Properties[HttpRequestMessageProperty.Name];
        httpRequest.Headers["Content-Type"] = ContentTypeOverride;
    }

    public Message SerializeReply(MessageVersion messageVersion, object[] parameters, object result)
    {
        return innerFormatter.SerializeReply(messageVersion, parameters, result);
    }
} 
```

而且您必须修改您的服务合同，使其看起来像这样

```
[OperationContract]
[WebContentType("application/json; charset=utf-8")]
public string DoWork(string FirstName, string LastName)
{
    return "Your name is " + LastName + ", " + FirstName;
} 
```

## 链接

正如您在此处所要求的，一些链接描述了这些 WCF 扩展

*   [IOperationBehavior 接口](http://msdn.microsoft.com/en-us/library/system.servicemodel.description.ioperationbehavior.aspx)
*   [IDispatchMessageFormatter 接口](http://msdn.microsoft.com/en-us/library/system.servicemodel.dispatcher.idispatchmessageformatter.aspx)
*   [如何实现 IDispatchMessageFormatter](http://weblogs.asp.net/vardi/archive/2008/06/18/how-to-get-implementation-of-idispatchmessageformatter.aspx)
*   [WCF 可扩展性 - 插入自定义消息处理逻辑](http://blogs.msdn.com/mahjayar/archive/2007/03/14/wcf-extensibility-plugging-in-custom-message-processing-logic.aspx)

# httpd.conf - 为什么我的 部分变量有时仅在 mod_perl 下可用？

> ID：538892
> 
> 赞同：1
> 
> 时间：2009-02-11T21:27:56.193
> 
> 标签：httpd.conf, mod-perl2

在 httpd.conf 我有：

```
<Perl>
   $MyPackage::foo = { ... };
</Perl> 
```

根据文档，由于它是合格的，因此应该保留在我的 perl 脚本中，这些脚本与 modperl 处理程序一起运行。有时他们会这样做。但是我需要做的就是触摸 MyPackage.pm，突然之间 $MyPackage::foo 现在是 undef。重新启动 Web 服务器，它再次工作。

有人能止住我的眼泪吗？

我最好的猜测是，当解析 .conf 时，该块只运行一次，然后一个新线程拾取重新加载的文件。但是为什么它不是每个线程运行一次呢？除了 $ENV 和每个服务器只加载一次然后复制到所有解释器的自定义指令之外，我是否可以使用其他东西？（我可能在这里最后使用了错误的术语，但你明白了。）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T21:30:23.363

我在打字时发现了这一点，但我想我会分享一下，以防它拯救了其他人我刚拔掉的头发。

最简单的解决方案是将 .conf 中的作用域变量重命名为您实际未使用的名称：

```
<Perl>
    $MyPackageConfig::foo = { ... };
</Perl> 
```

...然后让您的实际包裹拿起它：

```
package MyPackage;
our $foo = $MyPackageConfig::foo; 
```

当我测试它时，这似乎一直有效。

# asp.net - SSRS 2005 - 配置用户身份验证/授权

> ID：538894
> 
> 赞同：4
> 
> 时间：2009-02-11T21:28:35.427
> 
> 标签：asp.net, security, reporting-services

我创建了一个 ASP.NET 2.0 Web 应用程序，并希望将 SSRS 2005 用于报告目的。

Web 应用程序使用表单身份验证和自定义角色进行授权。我已创建报告并将其部署到我们的 SQL Server 2005 机器上。

我有两个选项可以将报告集成到我的应用程序中：

1.  从我的应用程序中链接到 SSRS。该链接将具有指定的参数和选项。我确保该链接仅向授权用户显示，并且它链接到具有适当参数的正确报告。

2.  使用 ReportViewer 控件并使用它显示报告。所有处理将由 SSRS 完成

但是，我不确定在 Reporting Services 框中的 IIS 中配置安全性的最佳方法。目前它设置为 Windows 集成身份验证。报告服务也有我的用户名和浏览器角色。

并非我的应用程序的所有用户都有 AD 登录。该应用程序也在互联网上，我不想过多地打开 SSRS。同时，我希望它对我们的用户来说是无缝的，因为我不希望 SSRS 提示输入用户名和密码。

实现这一目标的最佳方法是什么？我应该创建一个虚拟 AD 用户，然后使用它在 ASP.NET 应用程序和 SSRS 之间进行通信吗？如果不是这样，实现我需要的一切的最简单方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T22:13:25.083

We communicate with the SSRS using the web service interface and with the Report Viewer control using the same AD account for all users. As for permissions we have custom access list that the asp.net page checks before serving the report to the user. This is attached to the username. We have kept the SSRS box off the internet and only way for the user to access is thorugh the application so access list control is enough.

For Report View Control we had to create a custom credential class for passing the AD username and password that inherited from **IReportServerCredentials**. AD username and password is kept in a xml file.

Hope this helps.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T02:13:50.920

+1 法赫德

除了使用 IReportServerCredentials 接口外，还可以使用 ReportServerConnection 的一个实例并将其分配给报表查看器控件。我们将用户名、密码和域（如果需要）存储在 web.config 文件中。

```
ReportServerConnection credentials = new ReportServerConnection('username', 'password');
ReportViewer1.ServerReport.ReportServerCredentials = credentials; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-19T14:28:51.280

我们最近将 SSRS (SQL Server 2008 R2) 的 SSO 身份验证方法与使用表单身份验证的自定义 Web 应用程序集成。我发现这两篇文章非常有用，并概述了我们为完成 SSO 解决方案需要做的所有事情。

[Reporting Services 单点登录 (SSO) 身份验证 - 第 1 部分](http://blogs.msdn.com/b/cliffgreen/archive/2011/03/29/reporting-services-single-sign-on-sso-authentication-part-1.aspx)

[Reporting Services 单点登录 (SSO) 身份验证 - 第 2 部分](http://blogs.msdn.com/b/cliffgreen/archive/2011/04/06/reporting-services-single-sign-on-sso-authentication-part-2.aspx)

以下是基本步骤，但我建议您完整阅读这些文章：

1.  创建您的验证管理器，它将处理特定于您的系统的身份验证
2.  为 SSRS 创建您的登录页面（我们的页面，如示例，只需调用 LogonUser，然后重定向到报告管理器） - 只有当您想使用 SSRS 的报告管理器时才需要这样做
3.  将 ReportingService2010 和 ReportExecution2005 服务添加到您的项目后，您需要围绕它们创建一个代理包装器并覆盖 GetWebRequest 和 GetWebResponse 方法，以便在 SSRS 和您的应用程序之间传递 SSRS 身份验证票证。
4.  创建实现 IAuthenticationExtension 和 IAuthorizationExtension 的自定义身份验证模块（请参阅第 2 部分）
5.  配置 SSRS 以使用您的自定义表单身份验证模块
6.  如果您想使用报表管理器，那么您需要确保配置 SSRS 报表管理器来处理您的应用程序授权票证：[配置报表管理器以传递自定义身份验证 Cookie](http://technet.microsoft.com/en-us/library/ms345241.aspx)

完成这些步骤后，您可以使用 Report Manager 或直接在应用程序中实现 Web 服务。

# java - 使用 Google Web Toolkit 播放声音通知

> ID：538898
> 
> 赞同：6
> 
> 时间：2009-02-11T21:29:23.333
> 
> 标签：java, javascript, gwt, audio

是否可以使用将被翻译为 Javascript 的 Google Web Toolkit 播放声音通知？谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-02-10T05:23:00.213

从 GWT 2.2 开始，您可以使用以下方式播放音频：`com.google.gwt.media.client.Audio`class。

API：http: [//google-web-toolkit.googlecode.com/svn/javadoc/2.2/com/google/gwt/media/client/Audio.html](http://google-web-toolkit.googlecode.com/svn/javadoc/2.2/com/google/gwt/media/client/Audio.html)

样本：

```
private Audio mistakeAudio;

{
    mistakeAudio = Audio.createIfSupported();
    mistakeAudio.setSrc("style/failure.wav");
}

public void mistakeSound(){
    mistakeAudio.play();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T02:44:01.220

尝试使用这个库：[http ://code.google.com/p/gwt-voices/](http://code.google.com/p/gwt-voices/)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-11T23:51:56.690

是的，有可能，[scriptaculous（一个 js 库）有一个 sound.js](http://wiki.github.com/madrobby/scriptaculous/sound)，它是如何做到这一点的一个例子。[源代码](http://github.com/madrobby/scriptaculous/blob/4b49fd8884920d4ee760b0194431f4f433f878df/src/sound.js)不到 50 行。

# vmware - 那些使用虚拟化的人，免费的vmware服务器适合程序员吗？

> ID：538904
> 
> 赞同：7
> 
> 时间：2009-02-11T21:31:02.207
> 
> 标签：vmware

免费的vmware服务器软件适合程序员吗？

我对免费服务器版本和付费工作站版本有点困惑。

服务器版本到底是什么？我可以在我的桌面上运行它吗？

我已经通过 MS alerady 安装了 virtualPC，但也想看看 vm。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-12T00:04:07.080

虚拟化可用于以下方面：

*   构建可能使您的主机崩溃的代码。使虚拟机崩溃？只需重新启动它。
*   测试安装程序。在安装程序之前拍摄快照，完成后恢复到快照。您的程序曾经存在的所有痕迹都消失了，您可以稍后再试。
*   让第二台机器运行与主机不同的操作系统。我运行 Mac 笔记本电脑，但保留了 Linux VM 和我们产品设备的 VM 可用于开发和测试。

免费服务器：

*   用于配置和管理机器的笨拙的基于 Web 的界面
*   慢速远程显示（因为它甚至在本地机器上也通过 http 传输到客户端）
*   每台机器一个快照
*   自由！！！
*   作为系统服务运行，因此机器在后台运行，而无需在桌面上打开任何窗口

工作站：

*   改进的本地界面
*   更快的本地显示
*   DirectX 和 OpenGL 支持（基本），因此您实际上可以玩一些 Windows 游戏或在 VM 中使用 AutoCad 之类的东西
*   机器的许多快照，能够切割和更改/合并特定的快照
*   作为前台应用程序运行，因此您可以打开 VMWare 窗口来启动和管理机器。在 Linux 上，至少您可以关闭界面并让机器继续运行。Windows 上没试过。
*   昂贵

辛：

*   如果很高兴拥有一台 Linux 主机，那么它在运行受支持的操作系统方面会非常快。Linux 和一些 BSD 现在具有 Xen 挂钩，因此它们可以轻松地进行 para-virt。
*   可以运行完全虚拟化的机器，因此支持 Windows 和其他未打补丁的操作系统

虚拟盒子：

*   自由的
*   有Sun的支持（这是好事吗？你可以决定）
*   功能上类似于 VM Workstation

漆木：

*   自由的
*   猪找出网络设置
*   非常可配置
*   如果您正在进行 PPC 或 Arm 开发，可以“模拟”非 X86 机器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T21:37:59.523

抱歉，它并没有真正回答您的问题，但我个人选择使用[VirtualBox](http://www.virtualbox.org/)而不是 VMWare，部分原因是您遇到的确切问题。试图弄清楚我被允许使用哪些 VMWare 产品以及我被允许如何使用它们会比在 VirtualBox 中设置所有东西花费更多的时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T21:41:31.497

VMware Server 可以在桌面上运行，但您可能需要 Workstation 版本的原因如下：

*   它支持使用 Visual Studio 或 Eclipse 在 VM 中进行调试。

*   它具有更好、更快的用户界面。VMware Server 过去带有一个可用的控制台程序，但版本 2 带有一个基于浏览器的 UI。

*   在最新版本中，您可以让 VM 中的窗口直接显示在桌面上。

服务器版本的一个好处是它作为服务运行，因此您可以让虚拟机在后台自动启动，甚至在您登录之前。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T21:43:37.310

VMware Server 作为服务运行，因此更适合于类似服务器的任务。在与主机上的硬件接口时，它也受到更多限制，例如 USB 支持是最近才添加的，我相信仅限于两个设备。

VMware 服务器还具有 (IMO) 所有 VMware 产品中最差的配置和管理界面，因为它被设计为远程管理并且是基于 Web 的。

相反，您可能想尝试免费的 VMware Player，它可以运行任何 VMware 虚拟机。它的功能与 VMware 工作站基本相同，限制是 Player 无法创建新的虚拟机。这是您很少做的事情，但是还有其他方法可以创建新机器。谷歌搜索“创建 VMware 虚拟机”会给你很多选择。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T21:40:45.507

VMWare Server 很棒，我用它来区分需要不同设置的不同项目，如果你需要不同的环境设置并且你的机器有足够的资源，我会推荐它。

VMWare ESX 不是免费的，因此不适合您。
VMWare ESXi 是免费的，但不能在操作系统安装之上运行，因此可能不适合您。

VMWare Player 播放虚拟机...但我不熟悉它。（见其他回复）。

VMWare Workstation 仅免费使用 30 天。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T02:59:57.360

VMWare Workstation 为您提供（在免费版本之上）

*   多显示器支持（您可以在 2、3、4 个显示器上运行 VM）
*   记录/回放调试
*   多个快照
*   DirecX/3D 支持

我还要查看[https://stackoverflow.com/questions/66317/which-is-the-best-vm-program-for-a-programmer](https://stackoverflow.com/questions/66317/which-is-the-best-vm-program-for-a-programmer)

虚拟化现在是一种商品化产品，基本的简单软件是免费的并且可以完成这项工作。如果您日复一日地在商业级别上进行软件开发，那么您将非常欣赏 Workstation 中的高级功能。

购买 VMWare Workstation 许可证非常物有所值，与您为 Visual Studio、Windows 和您最有可能使用的所有其他软件支付的费用相比，这只是杯水车薪。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T10:21:03.107

对于以后发现此线程的人，还值得补充的是，VMware Server 仅支持（阅读：仅安装在）*服务器*操作系统上。我尝试在 Vista 上安装它，但它不起作用。我很确定它也不会在 XP 上安装。这可能会排除它在开发机器上的使用。

我使用 VMware Server 和 Workstation，它们都是很棒的产品。我的 Android 开发环境位于 Workstation VM 中，这对我来说非常有效。我还在 XP VM 中运行了一些旧游戏，发现图形支持非常好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T23:30:08.753

我曾讨论过要获得 MS 或 VMWare 的“免费”版本，但决定挥霍一下 189 美元的 VMWare 工作站——不得不说它可能是我花过的最便宜的钱。该工具很棒，并且立即启动并运行。

我不敢相信我等了这么久才在我的开发机器上设置虚拟化。一旦你使用它，你就不会想你花了超过 5 分钟的钱。

我想我的观点是不要让少量的钱成为你选择或使用什么的决定因素。该软件为您提供的灵活性可能价值数千美元。如果您能找到适合您需求的免费工具，请务必使用它。但是，对于 189 美元，您将获得令人难以置信的物超所值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-11T21:46:17.817

以前版本的 vmware 服务器使用与工作站版本相同的 UI（它似乎支持除快照之外的所有内容）。

不幸的是，当前版本的 vmware 服务器已切换到基于 Web 浏览器的 UI，这对于设置虚拟服务器的用途非常有用，但对于进行开发工作来说有点笨拙。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-11T23:13:47.983

我在我的开发机器上使用 VMWare Server 2 在 Server 2003 中运行 VS2008 和 WSS 来开发 Sharepoint Web 部件。

我确信这样的设置还有其他用途，但对于我的需要，它完全足够了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-11T21:36:09.917

是的，您可以在桌面上免费使用（我相信是 ESX）服务器，如果您进行多平台开发，我会推荐它。

例如，您需要在 linux 32 位和 64 位中测试您的应用程序，也许还需要在 solaris 和 windows 中测试。

您应该注意的一件事是正确配置所有内容。如果您不这样做，您可能最终不得不等待几分钟才能完全启动您的操作系统，因为它会加载各种驱动程序，并且可能会在启动时加载机器。

用作创建自己的图像的工具也很好，例如模仿您的生产环境。上次我检查时，VM 播放器无法做到这一点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-11T21:42:29.823

我使用[Parallels](http://www.parallels.com/computing/)和 VirtualPC。

Win 桌面和 OS X 桌面上的 Parallels，以及在 Server 2003 上运行多个 linux 构建（全无头）的 Virtual PC。免费的 VMWare 很好，但我知道它有一些限制。当大多数其他 VM 立即开箱即用时，我刚刚发现 VM 是一个设置和配置的婊子。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-11T21:44:49.070

Vmware 服务器主要在后台运行，并带有一个 Web 界面供您控制虚拟机。

从那里您可以通过浏览器插件打开远程控制台，该插件能够执行您需要它执行的大多数操作。（虽然奇怪地缺少 ctrl-alt-del 按钮）服务器中没有硬件加速支持。

Workstation 在用户模式下运行，因此您在登录后启动它。它作为应用程序而不是服务运行。如果您需要经常回滚更改，它还支持多个快照。服务器只允许每个主机一个快照。

* * *

就个人而言，我在 VirtualBox 中有一个 WinXP VM，过去一年我一直在使用它进行开发。VBox 在 Linux 中支持无缝模式，这是我选择它而不是 VMWare 的主要原因。我相信 VMWare Fusion 在 Mac 主机上为 Linux 或 Windows 提供无缝模式，但据我所知，它们在 Linux 或 Windows 主机上不支持这种模式。

到目前为止它运行良好，只有一个警告：**备份您的虚拟磁盘！**特别是如果您要玩快照。并在虚拟环境之外设置源代码控制系统，以便在虚拟磁盘无法访问时获取代码。

# c# - 如何获取 Listview 的标题高度

> ID：538906
> 
> 赞同：12
> 
> 时间：2009-02-11T21:31:19.960
> 
> 标签：c#, .net, winforms, listview

有人可以告诉我如何获取 ListView 的标题高度吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-11T21:44:49.723

这可能有点hacky，但你可以这样做：

```
listView.Items[0].Bounds.Top 
```

这仅在列表中只有一项时才有效。因此，您可能希望在第一次创建列表时临时添加一个并保留高度值。

否则，您可以随时使用：

```
listView.TopItem.Bounds.Top 
```

随时进行测试，但您仍然需要列表中的至少一项。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-11T21:57:42.500

这是使用 Win32 互操作调用获取列表视图标题高度的方法。

```
[Serializable, StructLayout(LayoutKind.Sequential)]
public struct RECT 
{
    public int Left;
    public int Top;
    public int Right;
    public int Bottom;
}

const long LVM_FIRST = 0x1000;
const long LVM_GETHEADER = (LVM_FIRST + 31);

[DllImport("user32.dll", EntryPoint="SendMessage")]
private static extern IntPtr SendMessage(IntPtr hwnd, long wMsg, long wParam, long lParam);

[DllImport("user32.dll")]
private static extern bool GetWindowRect(HandleRef hwnd, out RECT lpRect);

RECT rc = new RECT();
IntPtr hwnd = SendMessage(ListView1.Handle, LVM_GETHEADER, 0, 0);
if (hwnd != null) 
{
    if (GetWindowRect(new HandleRef(null, hwnd), out rc)) 
    {
        int headerHeight = rc.Bottom - rc.Top;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-01-09T22:44:49.170

@Phaedrus

..很久很久以前.. 但是： **PInvokeStackImbalance**被称为

SendMessage 的签名是（long != Uint32）：

```
LRESULT WINAPI SendMessage(
    _In_  HWND hWnd,
    _In_  UINT Msg,
    _In_  WPARAM wParam,
    _In_  LPARAM lParam
) 
```

全部更改为：

```
const UInt32 LVM_FIRST = 0x1000;
const UInt32 LVM_GETHEADER = (LVM_FIRST + 31);

[Serializable, System.Runtime.InteropServices.StructLayout(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct RECT
{
    public int Left;
    public int Top;
    public int Right;
    public int Bottom;
}

[System.Runtime.InteropServices.DllImport("user32.dll", CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    static extern IntPtr SendMessage(IntPtr hWnd, UInt32 Msg, IntPtr wParam, IntPtr lParam);
[System.Runtime.InteropServices.DllImport("user32.dll")]
private static extern bool GetWindowRect(System.Runtime.InteropServices.HandleRef hwnd, out RECT lpRect);

int youtFuncToGetHeaderHeight()
{
    RECT rc = new RECT();
    IntPtr hwnd = SendMessage((IntPtr)this.Handle, LVM_GETHEADER, IntPtr.Zero, IntPtr.Zero);
    if (hwnd != null)
    {
        if (GetWindowRect(new System.Runtime.InteropServices.HandleRef(null, hwnd), out rc))
        {
            int headerHeight = rc.Bottom - rc.Top;
        }
    }
    return -1;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-22T13:18:15.927

验证这在我的 Win32++ 应用程序中有效：

```
CHeader* hdr = GetHeader();
CRect rcHdr = hdr->GetWindowRect(); 
```

标题高度为 rcHdr.Height()

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-12T12:47:12.463

正确代码：

```
 [Serializable, StructLayout(LayoutKind.Sequential)]
    public struct RECT 
    {
        public int Left;
        public int Top;
        public int Right;
        public int Bottom;
    }

    const int LVM_FIRST = 0x1000;
    const int LVM_GETHEADER = (LVM_FIRST + 31);

    [DllImport("user32.dll", EntryPoint="SendMessage")]
    private static extern IntPtr SendMessage(IntPtr hwnd, int wMsg, IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll")]
    private static extern bool GetWindowRect(HandleRef hwnd, out RECT lpRect);

    RECT rc = new RECT();
    IntPtr hwnd = SendMessage(ListView1.Handle, LVM_GETHEADER, 0, 0);
    if (hwnd != null) 
    {
        if (GetWindowRect(new HandleRef(null, hwnd), out rc)) 
        {
            int headerHeight = rc.Bottom - rc.Top;
        }
    } 
```

# php - 我可以停止 CakePHP 获取查询的所有行吗？

> ID：538921
> 
> 赞同：2
> 
> 时间：2009-02-11T21:34:59.140
> 
> 标签：php, mysql, database, cakephp

我正在使用带有 $modelName->find(...) 调用的 CakePHP 来选择相当多的行（可能是数百行）

通常，在 PHP/MySQL 中这当然不是问题，因为您在 while 循环中获取它们。但是，CakePHP 将所有行加载到一个耗尽内存限制的数组中。

有没有办法使用 $modelName->find(...) 构造但返回一个迭代器来按需获取每一行？

谢谢，大卫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-03T20:52:54.287

如果您的问题是由模型的关系引起的，您可以通过以下方式减少递归：

$模型名->递归=-1；

那么你只会得到当前模型的数据，没有任何关系。

遍历所有记录，您将能够以递归 > 0 再次查询它们的关系

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-08T20:51:04.153

这是可用于一次处理几行表的代码

```
 $limit = 10;
    $loop_no = 0;
    do {
        $handles = $this->SocialChannelHandle->find('all', array(
            'fields' => array('brand_id', 'handle'),
            'conditions' => array('social_channel_id' => $facebook['SocialChannel']['id']),
            'limit'  => $limit,
            'offset' => $limit * $loop_no,
            'order'  => 'id asc',
            'recursive' => -1)
        );
        $loop_no++;
    } while (count($handles) == $limit); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T22:51:43.293

不，开箱即用的 Cake PHP（以及一般的 ActiveRecord）不支持迭代这样的结果集。如果您有一个实际需要表的*所有*记录的用例，那么使用原始 SQL 可能会更好。（或重新考虑您的用例）。

您也可以（并且可能已经考虑过）使用某种偏移量，并多次调用 ->find。如果您采用这种方法，请不要忘记按某个字段对结果集进行排序，以确保获得确定性的结果。当您关闭 ORDER BY 时，数据库似乎只返回已排序的行。我没有亲自尝试过，从多个查询的角度来看它似乎效率低下，但这是值得尝试的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T21:43:41.397

如果您使用存储过程来生成查询，那么模拟分页行为以一次获取查询段可能是一个好主意。在这种情况下，您将向存储过程发送两个额外参数，用于起始行索引和“page”-size，并返回调整 select 语句以仅检索 row_index + 1 和 row_index + page_size 之间的那些记录。

这都可以放入一个额外的循环层中，所以你得到一个新的段，然后在其中遍历该段中的每一行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T22:13:41.590

由于您的模型关系，您可能还会获得如此多的数据。对于您的 someModel->find() 调用，还有多少其他模型与 someModel 相关？

我在一个典型的共享托管服务器上使用了至少 1000 行的数组，没有内存问题。

更新：如果您不希望返回相关模型，您可以简单地使用 Containable 行为。因此，如果您尝试查找所有帖子但不想要评论，您可以使用 $this->Post->contain() 语法仅返回帖子记录。Containable 是必须使用 $actAs 参数添加到模型中的行为，$actAs = array('Containable');

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T22:22:22.833

我知道您正在寻找从查找条件返回的迭代器，但是如何使用带有可变偏移量的 LIMIT 子句（例如，您希望一次返回的行数）？这可能会带来一些并发问题，但如果您还包括 ORDER BY id 子句，您应该会在返回的行中看到一致的行为。然后，在您的循环中，只需重复发出 find(...) 查询。

这显然不是迭代器的优雅解决方案，但我想重复发出请求以返回更多行的开销将通过一次检索多行（在 Cake 中）与节省的成本相平衡.

最后，如果您真的在寻找性能，那么我认为 CakePHP 可能不是您的理想之选。随着新版本的发布，它的速度正在提高，但我相信它在性能方面仍然明显落后于其他框架。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T22:24:08.600

我想这是不可能的，因为 CakePHP 正在动态构建一个表示您的数据库实体关系的多维数组。这应该在获取所有查询行之后完成，以便 CakePHP 知道所有可能的相关实体。

例子：

为了构建相应的多维数组，需要获取 3 行：

```
第1条
  |
  -- 评论 1
  |
  -- 评论 2
  |
  -- 评论 3

```

查询结果（1..n）：

```
文章 | 评论
-----------------
1 | 1
-----------------
1 | 2
-----------------
1 | 3

```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T20:14:41.697

您可以为查找请求添加限制。我现在没有时间写一个完整的答案。我稍后会更新它。

不，据我所知，当您在 mysql 或普通驱动程序中发出请求时。无论如何，它将返回您选择的所有元素。因此，如果您对内存限制有疑问，它可能在其他地方。您可以为一定数量的行添加限制。如果您的表有多个依赖项，但您不需要加载每个外键，则可以使用“包含”属性仅加载您需要的内容。

你能给我们描述一下你的桌子吗？以及您要选择的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-04T00:07:03.493

您可以使用递归参数（[用于 Model#find 的 API](http://api.cakephp.org/class/model#method-Modelfind)）限制 find 方法调用，也可以即时取消绑定模型关联并减少检索的数据量（即时[创建和销毁关联](http://book.cakephp.org/view/86/Creating-and-Destroying-Associations-on-the-Fly)）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-04-24T11:11:23.200

已经有一段时间了，但是自从搜索中出现这个问题以来，我想提一下实际上有一种内置的方法可以做到这一点。就像是：

```
$page = 1;
$limit = 100;
while ($posts = $this->Post->find('all', array(
   'conditions' => ...,
   'page' => $page,
   'limit' => $limit,
   ...
))) {
    foreach ($posts as $post) {
        ...deal with one row...
    }
    $page++;
} 
```

将通过数据集进行分页，尽管由于查询在每个 while 循环中重新执行，因此会带来一些性能损失。

（未测试）

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-04-18T15:25:22.987

Ruby On rails 可以更好地处理这个问题。默认行为是不包含任何其他表，除非您使用 :include => :table_name 然后它会即时生成连接。

它没有理由不能做到这一点，只是没有。

# sql-server-2005 - 部署多维数据集时 Visual Studio 挂起

> ID：538924
> 
> 赞同：1
> 
> 时间：2009-02-11T21:35:51.290
> 
> 标签：sql-server-2005, visual-studio-2005, olap

我在 Visual Studio 2005 中遇到了一个 Analysis Services 项目的问题。我的项目总是构建，但只是偶尔部署。没有报告错误，VS 只是挂起。这是我的第一个分析服务项目，所以我希望有一些我只是缺少的明显的东西。

这是我有一个已成功部署的多维数据集的情况。

然后我进行一些更改，例如，向维度添加层次结构。当我尝试再次部署时 VS 挂起。我必须重新启动 Analysis Services 才能重新获得对 VS 的控制权，这样我才能将其关闭。在项目最终部署之前，我有时会重新启动所有内容，有时会重新启动两次或更多次。我所做的任何更改都会发生这种情况，这种行为似乎没有模式。

有时我必须在重新启动所有内容之前从 Analysis Services 中删除多维数据集才能成功部署。

此外，我已经成功部署了多维数据集，然后成功地重新处理了一个维度，然后当我在 SQL Server Management Studio 中打开一个查询窗口时，它说它可以找到任何多维数据集。

作为测试，我已经成功部署了一个多维数据集。然后我在 Analysis Services 中将其删除并尝试重新部署它，而不对多维数据集进行任何更改，只是为了具有上述相同的行为。

VS只是无缘无故挂起，所以我不知道从哪里开始寻找问题。

像设置维度属性的 NameColumn 一样简单的更改需要 15-20 分钟。正如您可以想象的那样，这需要我花费数小时的时间，因此我将非常感谢任何人可以给我的任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-18T11:52:41.330

有点晚了:-(

有时我们会遇到同样的问题。AS 在部署期间挂起，我们使用了 SQL Server Profiler，并且我们看到没有执行任何活动。我们发现增加高级参数“Processing thread pool max threads”可以解决。

我还发现了这个有用的链接：

[http://blogs.msdn.com/psssql/archive/2007/01/16/processing-appears-to-stall-or-become-sluggish-on-multi-processor-machines-running-analysis-services-2005。 aspx](http://blogs.msdn.com/psssql/archive/2007/01/16/processing-appears-to-stall-or-become-sluggish-on-multi-processor-machines-running-analysis-services-2005.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-12T11:26:32.777

我有同样的问题，但我解决了

1.查找哪个分区卡住了 2\. 将 DSV 中的直接命名查询表中的分区查询替换为底层 SQL 查询（即我有 'VQuery' 并替换为 'SELECT x,y from...。 '（只是从 DSV 命名查询复制） 3.重新处理分区需要几秒钟

同样在我的情况下，增加最大线程池并没有解决问题，实际上使问题变得更糟。

我最初离开了这些配置更改，但我很快意识到有时（随机）我在处理来自 SSIS 或直接在多维数据集中的多维数据集/维度时遇到“查询处理器无法启动必要的线程资源......”错误。

我按照以下建议通过将最大线程数减少 50% 来解决这个问题：

[http://social.msdn.microsoft.com/Forums/sqlserver/en-US/d4458d55-54d3-48d1-aa44-dafe34f92560/the-query-processor-could-not-start-the-necessary-thread-resources-用于并行查询执行](http://social.msdn.microsoft.com/Forums/sqlserver/en-US/d4458d55-54d3-48d1-aa44-dafe34f92560/the-query-processor-could-not-start-the-necessary-thread-resources-for-parallel-query-execution)

摘录：“*蒂姆，请尝试将两个实例上的 MaxThreads 减少 50% 并检查您的问题是否会得到解决。* ”

我希望这可以帮助其他人避免浪费 4 个小时，因为这是我的情况！:)

丹尼尔马乔。dani@wakufuro.com

# c# - Windows 服务自动停止

> ID：538925
> 
> 赞同：32
> 
> 时间：2009-02-11T21:35:54.597
> 
> 标签：c#, .net, windows-services

我创建了一个 Window 服务并让它在 localsystem 帐户下自动运行，当服务启动时它会为我触发此消息然后停止

> 本地计算机上的 [服务名称] 服务启动然后停止。如果某些服务没有被其他服务或程序使用，它们会自动停止。

有什么问题和解决方案是什么？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-11T21:39:33.793

要么您没有在 OnStart 方法上启动任何线程来执行工作，要么您的 OnStart 方法中引发了异常。

如果抛出异常，它将出现在 Windows 事件日志中。在任何情况下，Windows 事件日志都是一个不错的起点。

通常 OnStart 方法如下所示：

```
Thread _thread;

protected override void OnStart(string[] args)
{
    // Comment in to debug
    // Debugger.Break()

    // Do initial setup and initialization
    Setup();

    // Kick off a thread to do work
    _thread = new Thread(new MyClass().MyMethod)
    _thread.Start();

    // Exit this method to indicate the service has started
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:39:36.600

这个特定的错误消息意味着它所说的 - 您的服务**已经启动**，但**很快它**由于某种原因退出。好消息是您的服务实际上正在*做某事*，因此您已正确配置可执行文件并作为服务运行。

一旦开始，由于某种原因它正在退出。你需要找出这是为什么。添加一些调试以告诉您它的启动和运行以及已知的退出案例。如果这不能揭示问题，那么添加一些调试以让您知道它仍在运行并从停止时开始向后工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T21:39:58.287

您是否正在追踪任何调试信息？很可能在初始化期间引发了异常。我会追踪你所有的异常并使用 Debugview 来查看它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-25T23:05:53.303

我遇到了类似的问题，**因为我的事件日志已满**并且服务无法写入它们。因此，无法通过在事件查看器中查找消息进行调试。我放了一个 try/catch 并将异常转储到一个文件中。我不得不更改日志上的设置以根据需要而不是每 7 天填写一次，这样就可以启动服务。

当然，对我来说问题的根源是我的 nVidia 驱动程序问题正在淹没我的事件日志，现在我可能在磁盘上跳动，但这是另一个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-11T11:33:40.217

我在启动 JBoss 时遇到了同样的问题，然后我更改了`JAVA_HOME`变量，它对我有用。是 JBoss 版本不支持 1.6，它支持 1.5。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-29T14:54:27.210

也许您需要将服务作为**Local System Account**运行。请参阅[Srinivas Ganaparthi 的这篇文章](http://srinivasganaparthi.blogspot.com/2011/02/service-on-local-computer-started-and.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-20T15:09:13.960

我有类似的问题，在我的情况下，程序只是在 OnStart 方法中崩溃了。它试图读取一些它找不到的文件，但我想任何其他程序崩溃都会给出相同的结果。如果是 Windows 窗体应用程序，您会收到一些错误消息，但这里只是“您的服务启动和停止”

如果您像我一样需要从 Windows Service .exe 所在的目录中读取一些文件，请查看此主题： [获取 Windows 服务的完整路径](https://stackoverflow.com/questions/199961/getting-full-path-for-windows-service)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-05-08T12:29:45.197

就我而言，我的服务中的一个方法被递归调用（因为没有终止条件为真），并且在特定时间后我的服务被停止。

# iphone - OpenGLES 中缺少的函数的替代列表

> ID：538928
> 
> 赞同：6
> 
> 时间：2009-02-11T21:36:15.393
> 
> 标签：iphone, graphics, opengl-es

OpenGL 中存在许多函数，但 OpenGLES 1.1（用于 iPhone）中没有。

是否有列出一些可在 OpenGLES 1.1 中使用的替代功能的列表或资源？

例如：

*   `gluOrtho2D`
*   `glPolygonMode`
*   `glVertex3f`
*   ETC

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T21:48:38.357

“OpenGL ES 1.1.12 差异规范” ( [http://www.khronos.org/registry/gles/specs/1.1/es_cm_spec_1.1.12.pdf](http://www.khronos.org/registry/gles/specs/1.1/es_cm_spec_1.1.12.pdf) ) 列出了 OpenGL ES 1.X 和 OpenGL 1.5 之间的差异。

iPhone 使用 OpenGL ES 1.1

我还建议您列出您调用的 OpenGL 函数并检查 ES 文档以查看它们是否完全/部分支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T21:46:55.647

来自 gluOrtho2D 的手册页

```
DESCRIPTION

gluOrtho2D sets up a two-dimensional orthographic viewing
region. This is equivalent to calling glOrtho with near=-1
and far=1. 
```

您必须使用顶点数组而不是使用 glVertex3f，请参阅[链接](http://www.songho.ca/opengl/gl_vertexarray.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T21:50:11.770

为了简单起见，OpenGLES 标准中删除了许多便利功能，以及低效的折旧功能。

那里主要是为了使常用功能更容易，或者提供常用命令的优化实现。

您给出的 gluOrtho2D 的两个示例只是 glOrtho 的包装，glPolygonMode 可以通过 glTriangle 进行一些预处理来实现。

我不确定列表本身，但如果一个函数不存在，手册页很可能会告诉你它作为包装器的类似函数，或者你可以使用的替代方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T21:43:27.060

您应该能够将[glOrtho](http://www.khronos.org/opengles/documentation/opengles1_0/html/glOrtho.html)替换为 gluOrtho2D。您需要做的唯一额外的事情是设置近距和远距剪裁平面。

看起来 glPolygonMode 似乎不是 OpenGLES 规范的一部分，因为只支持填充三角形。见[这里](http://discussion.forum.nokia.com/forum/showthread.php?t=133606)。

# php - PHP exec() 通过浏览器执行时不会执行 shell 命令

> ID：538939
> 
> 赞同：35
> 
> 时间：2009-02-11T21:40:33.307
> 
> 标签：php, system, exec

我有一个调用 exec() 的 PHP 脚本来执行将 PDF 转换为 JPG 的命令。该命令在 bash 中运行良好。

要抢占您最初的故障排除猜测，请注意以下几点：

*   安全模式 = 关闭
*   包含 PDF 和脚本的目录的权限设置为 777，该目录也是写入 JPG 的位置。
*   我传递给 exec() 的命令明确指向正在使用的二进制文件（例如 /usr/local/bin/convert）。
*   display_errors = 开
*   error_reporting = E_ALL
*   disable_functions = [空白]
*   我正在回显 exec() 的输出，但它什么也没返回。默认情况下运行的命令不返回任何内容。

当我从浏览器调用这个 PHP 脚本（访问[http://www.example.com/script.php](http://www.example.com/script.php)）时， exec() 不执行它的参数。

*重要提示*：我知道我的脚本或构建 bash 命令的方式没有问题，因为从 bash，我可以使用 'php' 执行脚本并且它可以工作（例如，'php script.php' 转换文件）

我也尝试过用 system() 切换 exec()。

最后，我以前曾经遇到过这个问题，但不记得我是如何解决的。

我知道我缺少一些东西，所以我希望其他人也像我一样经历过这个并记得如何解决它！

提前感谢您提供的任何帮助。

亚历克斯

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-02-11T22:00:36.690

添加`2>&1`到命令的末尾以将错误从 stderr 重定向到 stdout。这应该清楚出了什么问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-11T21:44:41.317

只是一些猜测，可能是您的网络服务器进程用户没有这样做的权限。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-11T21:45:34.090

由于它在命令行下工作（将在您自己的用户帐户下），因此在我看来，Web 服务器运行的帐户（通常是“www-data”）对转换程序没有执行权限.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-11T21:46:10.190

您是否考虑过文件权限？在浏览器中，php 在一个用户下运行，但是当您在 bash 中运行它时，它很可能以您的用户权限运行。

这是我要检查的第一件事。

艾米

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-11T21:46:06.883

您的 Apache/webserver 用户是否具有运行 shell 命令的必要权限？

当您从 cl 运行时，您可能会以不同的用户身份运行，这可以解释哪个 cl 有效，但通过浏览器无效。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-04-09T05:08:28.170

Apache 的用户`www-data`需要被授予特权才能使用`sudo`.

1.  运行命令`sudo visudo`。实际上，我们想在`etc/sudoers`.To 中编辑文件。为此，通过`sudo visudo`在终端中使用，它复制（临时）`sudoers`文件进行编辑。
2.  在文件末尾，添加以下内容：-如果我们要使用命令重新启动 Smokeping 并使用 mount 命令进行其他操作，

`www-data ALL=NOPASSWD: /etc/init.d/smokeping/restart, /bin/mount`

（这是假设您希望使用超级用户（root）权限运行`restart`和`mount`命令。）

**但是，如果您希望使用超级用户权限运行每个应用程序，请添加以下内容而不是上面的内容。您可能不想这样做，而不是`ALL`命令，非常危险。**

```
www-data ALL=NOPASSWD: ALL 
```

3.**编辑sudoers文件后（通过`visudo`我们编辑临时文件`sudoers`保存并退出临时文件（visudo）写入`sudoers`文件。（`wq!`）**

4.就是这样，现在`exec()`在你的`xxx.php`脚本中按照以下方式使用。**记住`sudo`在php脚本中使用命令之前使用。**

前任：-

```
exec ("sudo /etc/init.d/smokeping restart 2>&1"); 
```

因此，在您的问题中，将您希望使用的命令添加到`step no (2.)`我添加的内容中，并根据需要更改您的 php 脚本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-19T08:55:36.527

这可能是由于不同的用户通过 Web 服务器运行脚本和通过 bash 运行脚本。

通常，通过服务器调用的脚本/执行程序与用户“www”一样，并且该用户对您的区域没有任何写入权限。但是当您在 bash 中运行脚本时，您确实具有写入权限。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T18:21:28.707

我已经确定这是 ImageMagick 的问题，而不是 PHP。我正在尝试一些修复，如果它们不起作用，我将最终使用一些 PHP 共享库（可能是 imagick）来代替。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-14T15:19:09.140

默认输出设备已更改。

以 www 身份登录（启用后）通过 shell 提供输出，但不通过 php。

# c# - 在 Windows Mobile 6/C# 中监控 WLAN 无线电连接

> ID：538946
> 
> 赞同：1
> 
> 时间：2009-02-11T21:42:16.267
> 
> 标签：c#, compact-framework, wifi, smart-device-framework

我目前正在开发针对 HP IPAQ 210 的应用程序。此应用程序的一部分需要启用/打开 WLAN 无线电以连接到预配置的接入点。我目前正在使用 IPAQ SDK（通过 P/Invoke）来启用 WLAN 无线电，但我无法可靠地确定无线电何时与首选接入点建立连接。我目前正在监视 Microsoft.WindowsMo​​bile.Status.SystemState.WiFiStateConnected 属性，但我更愿意订阅一个事件，以便在建立连接时得到通知。

我在 OpenNETCF 库中浏览了一下，2.3 中似乎有一些有希望的东西，但我们暂时停留在 2.2 上。

是否有可靠的方法来确定连接状态？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:38:28.703

这很丑陋，也不是事件，但如果一切都失败了，您可以尝试通过读取它的注册表项来检查 Wifi 硬件状态：

```
int key = (int)Registry.GetValue("HKEY_LOCAL_MACHINE\\System\\State\\Hardware", "WiFi", -1); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:47:45.853

所以，万一其他人发生这种情况，我发现上面描述的注册表项方法最可靠，但我需要一个更可靠的方法。我已经开始使用 OpenNETCF 2.2 NetworkInformation 库来监控 WirelessZeroConfigInterface 的 CurrentIPAddress 属性。我仍在使用 IPAQUtils 来管理 WLAN 无线电功率（我发现缺少 OpenNETCF 2.2 无线电控制，并且设备只有一个 WiFi 网络条目），但这是我监控接口 IP 地址的方法：

```
NetworkInterface[] netIntfs = NetworkInterface.GetAllNetworkInterfaces();
foreach (NetworkInterface ni in netIntfs)
{
    if (ni is WirelessZeroConfigNetworkInterface)
    {
       wzcni = (WirelessZeroConfigNetworkInterface)ni;
    }
}

while (wzcni.CurrentIpAddress.ToString() == "0.0.0.0" && tryCount < 10)
{
    wzcni.Refresh();
    System.Threading.Thread.Sleep(3000);
    tryCount++;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-14T09:44:21.420

```
System.Windows.Forms.Button Btn = new System.Windows.Forms.Button();
if (flag == true)
{
    for (int i = 0; i < node; i++)
    {
        Btn = new Button();
        Btn.Height = 25;
        Btn.Width =30;
        Btn.ForeColor = Color.Blue;
        Btn.BackColor = Color.Brown;                 
        Btn.AutoSize = false;
        x = rd.Next(130, 800);
        y = rd.Next(130, 500);
        Btn.Location = new Point(x, y);
        Console.WriteLine(x + "," + y);
        Btn.Text = "U" + i.ToString();
        Btn.Name = "U" + i.ToString();
        m_streamWriter.WriteLine("{0} {1} {2}",
                                 Btn.Name.ToString(),
                                 Btn.Location.X.ToString(),
                                 Btn.Location.Y.ToString());
        Btn.Click += new System.EventHandler(this.Btn_Click);
        this.Controls.Add(Btn);                    
    }
    flag = false;
    m_streamWriter.Dispose();
    startConvert();
    get_combo1();                          
} 
```

# c# - 来自 c# 的 USB 笔式驱动器标识符

> ID：538956
> 
> 赞同：1
> 
> 时间：2009-02-11T21:43:57.323
> 
> 标签：c#, usb-drive

我有一个使用 USB 驱动器运行的演示，我想防止有人复制演示的简单情况。我在想我可以得到一些关于 USB 驱动器的特定信息，比如制造、尺寸、固件版本和/或标识符。由于我们将演示放在一起并将其发送出去，因此它可能与驱动器的特定供应商相关联。我可能会使用 c# 来执行此操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-11T21:52:29.037

使用它，您可以获得 USB 棒的序列号，并可以在应用程序中对其进行编码：[如何在 C# 中获取 USB 棒的序列号](https://stackoverflow.com/questions/450009/how-to-get-serial-number-of-usb-stick-in-c)

但无论你做什么，有人可以使用反射器或其他程序并从你的程序中删除该检查。

# database - 在数据库复制/恢复期间删除 transact-sql 中的备份文件

> ID：538979
> 
> 赞同：0
> 
> 时间：2009-02-11T21:49:14.160
> 
> 标签：database, sql-server-2005, tsql, stored-procedures

我有一个数据库的“复制”存储过程。在复制期间，我使用以下内容备份数据库：

```
exec('backup database [' + @source + '] ' + 
      'to disk = N''' + @backupdir + '\copybackup'' ' +
      'with noformat, noinit, name=N''copybackup-full'', ' + 
      'SKIP, NOREWIND, NOUNLOAD,  STATS = 10;'); 
```

然后创建并清空数据库，并恢复到它：

```
exec('create database [' + @dest + '];');

exec('restore database [' + @dest + '] ' + 
      'from disk = N''' + @backupdir + '\copybackup'' ' + 
      'with file = 1, ' +
      'move N''' + @source + ''' to N''' + @dbdir + '\' + @dest + 
                 '.mdf'', ' +
      'move N''' + @source + '_log'' to N''' + @dbdir + '\' + @dest +
                 '_log.ldf'', ' +
      'NOUNLOAD,  REPLACE,  STATS = 10;'); 
```

所以一切都很好。除了，现在我在@backupdir\copybackup 处留下了一个我真的不想要的文件。我该如何摆脱它？

由于这是一个存储过程，我*真的*不想将它全部包装在一个批处理文件或服务器本身上的其他一些小东西中。当我首先创建混乱时，我想在这里从 T-SQL 处理它。我已经浏览了 MS Docs，但没有任何乐趣。（请使用 SQL Server 2005）

想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T21:57:41.580

您将无法直接使用 T-SQL 来执行此操作。如果 T-SQL 有办法删除文件系统上的文件，那将是一件非常糟糕的事情。

如果要将其保留在 SQL Server 中，您有两种选择。很可能安装了 Microsoft 脚本库。您可以使用 sp_OA* 存储过程来创建 Scripting.FileSystemObject 的实例，然后删除该文件。

然而，这是一个坏主意，因为在这种情况下 SQL Server 不能真正保护自己免受恶意代码的侵害，它也不能在服务器进程中规定内存管理。

首选的解决方案是创建一个 CLR 存储过程，该过程将采用您希望删除的文件的路径，然后使用 System.IO 命名空间中的类来删除文件（使用 File 或 FileInfo 类）。

这样，SQL Server 可以沙箱化 CLR 存储过程的执行，并且还可以控制 CLR 的内存管理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-29T04:49:28.703

我尝试使用以下内容：

```
exec sp_addumpdevice 'disk', 'temp backup device', 'temp_backup_device.bak'

BACKUP DATABASE [XXX] TO  [temp backup device] WITH NOFORMAT, NOINIT,  NAME = N'backup', SKIP, NOREWIND, NOUNLOAD,  STATS = 10

RESTORE DATABASE [bububu] FROM  [abcosting temporary backup] WITH  FILE = 1,  KEEP_REPLICATION,  NOUNLOAD,  REPLACE,  STATS = 10

exec sp_dropdevice 'temp backup device', 'delfile' 
```

但是由于一些错误（可能），sp_dropdevice 即使带有'delfile'选项也不会删除基础文件，并且不会报告错误。但它可能适用于您的配置。

# properties - 向 T4 模板添加属性 - 选择服务器、数据库、表

> ID：538988
> 
> 赞同：3
> 
> 时间：2009-02-11T21:50:44.937
> 
> 标签：properties, t4, smo

伙计们，

我想创建一些 T4 模板，用于从数据库生成类文件（每个表大约 7 个）以支持我们的内部 ORM（不要问 - 长篇故事和历史原因.....）

我真正想做的是在我的主 TT 模板上有一个属性，可以直观地选择要为其创建文件的服务器、数据库和表（类似于 CodeSmith 中的表选择器）。

由于这似乎不存在（或者确实存在？），我认为下一个最好的方法是使用三个字符串属性作为服务器、数据库、表名，并使用 SMO 连接到该表并获取我需要的列数据。

我尝试遵循 Oleg Sych 的示例，并提出：

```
<#@ property name="serverName" processor="PropertyProcessor" type="System.String" #>
<#@ property name="databaseName" processor="PropertyProcessor" type="System.String" #>
<#@ property name="tableName" processor="PropertyProcessor" type="System.String" #> 
```

但是如何在我的代码块中引用这些属性，这些属性连接到使用 SMO 指定的服务器来检索数据？

```
<#
    Server server = new Server();
    Database database = new Database(server, "DASECO_DEV");
    Table table = new Table(database, "T_User");
    table.Refresh();
#> 
```

我尝试将 a`<#= serverName #>`放在 Server() 构造函数的括号内 - 但这不起作用:-( 好像我有点卡在这里......如果我无法评估，那么拥有属性有什么意义并使用他们的价值观！:-)

有接盘侠吗？？

马克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T23:26:51.897

这个怎么样？

```
<#    
    Server server = new Server(serverName);    
    Database database = new Database(server, databaseName);    
    Table table = new Table(database, tableName);    
    table.Refresh();
#> 
```

# xml - XSD 出现边界应该在序列还是元素上？

> ID：538989
> 
> 赞同：12
> 
> 时间：2009-02-11T21:50:47.603
> 
> 标签：xml, xsd

如果我有一个包含一个或多个子元素的元素，那么 min/maxoccurs 属性应该在 xsd:sequence 元素、xsd:element 上，还是两者都存在？

```
<xsd:element name="books">
  <xsd:complexType>
    <xsd:sequence minOccurs="1" maxOccurs="unbounded"> <!-- here? -->
      <xsd:element ref="book" minOccurs="1" maxOccurs="unbounded"/> <!-- or here? -->
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-11T22:15:29.917

在几乎所有情况下，您都希望将 min/max 发生在序列内的元素上而不是序列上。使用您的示例：

```
<xsd:element name="books">
  <xsd:complexType>
    <xsd:sequence>
      <xsd:element ref="book" minOccurs="1" maxOccurs="unbounded"/>
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

这是明确的。如果您连续有一系列书籍元素，您可以准确指出是哪个模式项正在生成它们。然而：

```
<xsd:element name="books">
  <xsd:complexType>
    <xsd:sequence minOccurs="1" maxOccurs="unbounded"/>
      <xsd:element ref="book" minOccurs="1" maxOccurs="unbounded"/>
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

在这里，如果你一行有两个 " `book`" 元素，你是一行有两个`sequence`s，还是一个`sequence`有两个`book`元素？这不符合[唯一粒子归属](http://www.w3.org/TR/xmlschema-1/#cos-nonambig)要求。

最后，如果您将 min/max Occurs 放在序列上，然后添加一个附加元素：

```
<xsd:element name="books">
  <xsd:complexType>
    <xsd:sequence minOccurs="1" maxOccurs="unbounded"/>
      <xsd:element ref="book"/>
      <xsd:element ref="ebook"/>
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

那么这可能允许以下 XML，这可能不是您想要的：

```
<books>
  <book/><ebook/><book/><ebook/><book/><ebook/><book/><ebook/>
</books> 
```

而如果你有：

```
<xsd:element name="books">
  <xsd:complexType>
    <xsd:sequence/>
      <xsd:element ref="book" minOccurs="1" maxOccurs="unbounded"/>
      <xsd:element ref="ebook" minOccurs="1" maxOccurs="unbounded"/>
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

那么你的意图就很清楚了：一个或多个`book`元素的序列，后跟一个或多个元素的序列`ebook`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T22:01:41.180

它应该在`<xsd:element>`，恕我直言。

最终将它放在序列上的效果是相同的（对于这种情况）。但是从逻辑的角度来看，你想要表示它是一个*元素序列*，而不是*一排序列，每个序列都包含一个元素*。

将它放在两者上对我来说肯定会感觉不对，尽管对于这种情况，它（再次）不会产生任何实际影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T22:01:27.203

将 maxOccurs 属性放在 <xsd:element> 元素上。

```
<xsd:sequence>
  <xsd:element ref="book" minOccurs="1" maxOccurs="unbounded"/> <!-- here! -->
</xsd:sequence> 
```

# ios - Objective-C 中的常量

> ID：538996
> 
> 赞同：1038
> 
> 时间：2009-02-11T21:52:02.593
> 
> 标签：ios, objective-c, cocoa, nsstring, constants

我正在开发一个[Cocoa](http://en.wikipedia.org/wiki/Cocoa_%28API%29)应用程序，并且我使用常量`NSString`s 作为存储键名的方式来满足我的偏好。

我知道这是一个好主意，因为它可以在必要时轻松更改密钥。
另外，这是整个“将数据与逻辑分开”的概念。

> 无论如何，有没有一种好方法可以为整个应用程序定义一次这些常量？

我确信有一种简单而智能的方法，但现在我的课程只是重新定义他们使用的课程。

* * *

## 回答 #1

> 赞同：1306
> 
> 时间：2009-02-11T22:38:22.200

您应该创建一个头文件，如：

```
// Constants.h
FOUNDATION_EXPORT NSString *const MyFirstConstant;
FOUNDATION_EXPORT NSString *const MySecondConstant;
//etc. 
```

（如果您的代码不会在混合 C/C++ 环境或其他平台上使用，则可以使用 not。`extern`）`FOUNDATION_EXPORT`

您可以将此文件包含在每个使用常量的文件中或项目的预编译头文件中。

您可以在如下文件中定义这些常量`.m`：

```
// Constants.m
NSString *const MyFirstConstant = @"FirstConstant";
NSString *const MySecondConstant = @"SecondConstant"; 
```

`Constants.m`应该添加到您的应用程序/框架的目标中，以便将其链接到最终产品。

使用字符串常量而不是`#define`'d 常量的优点是您可以使用指针比较 ( ) 来测试相等性`stringInstance == MyFirstConstant`，这比字符串比较 ( ) 快得多`[stringInstance isEqualToString:MyFirstConstant]`（并且更易于阅读，IMO）。

* * *

## 回答 #2

> 赞同：282
> 
> 时间：2009-02-11T22:02:13.007

最简单的方法：

```
// Prefs.h
#define PREFS_MY_CONSTANT @"prefs_my_constant" 
```

更好的方法：

```
// Prefs.h
extern NSString * const PREFS_MY_CONSTANT;

// Prefs.m
NSString * const PREFS_MY_CONSTANT = @"prefs_my_constant"; 
```

第二种方法的一个好处是更改常量的值不会导致整个程序的重建。

* * *

## 回答 #3

> 赞同：192
> 
> 时间：2009-02-12T16:28:56.013

还有一件事要提。如果你需要一个非全局常量，你应该使用`static`关键字。

例子

```
// In your *.m file
static NSString * const kNSStringConst = @"const value"; 
```

由于`static`关键字的原因，这个 const 在文件之外是不可见的。

* * *

**[@QuinnTaylor](https://stackoverflow.com/users/120292/quinn-taylor)的小修正：**静态变量在*编译单元*中可见。通常，这是一个单独的 .m 文件（如本例所示），但如果您在包含在其他地方的标头中声明它，它可能会咬您一口，因为编译后会出现链接器错误

* * *

## 回答 #4

> 赞同：117
> 
> 时间：2011-09-18T14:08:45.123

接受的（和正确的）答案说“您可以将此 [Constants.h] 文件...包含在项目的预编译头文件中。”

作为一个新手，如果没有进一步的解释，我很难做到这一点——方法如下：在 YourAppNameHere-Prefix.pch 文件（这是 Xcode 中预编译头文件的默认名称）中，将您的 Constants.h 导入*块**中`#ifdef __OBJC__`*。

```
#ifdef __OBJC__
  #import <UIKit/UIKit.h>
  #import <Foundation/Foundation.h>
  #import "Constants.h"
#endif 
```

另请注意，除了接受的答案中描述的内容外，Constants.h 和 Constants.m 文件中绝对不应包含任何其他内容。（没有接口或实现）。

* * *

## 回答 #5

> 赞同：51
> 
> 时间：2011-12-02T21:53:26.413

我通常使用 Barry Wark 和 Rahul Gupta 发布的方式。

虽然，我不喜欢在 .h 和 .m 文件中重复相同的单词。请注意，在以下示例中，这两个文件中的行几乎相同：

```
// file.h
extern NSString* const MyConst;

//file.m
NSString* const MyConst = @"Lorem ipsum"; 
```

因此，我喜欢做的是使用一些 C 预处理器机器。让我通过例子来解释。

我有一个定义宏的头文件`STR_CONST(name, value)`：

```
// StringConsts.h
#ifdef SYNTHESIZE_CONSTS
# define STR_CONST(name, value) NSString* const name = @ value
#else
# define STR_CONST(name, value) extern NSString* const name
#endif 
```

在我想要定义常量的 .h/.m 对中，我执行以下操作：

```
// myfile.h
#import <StringConsts.h>

STR_CONST(MyConst, "Lorem Ipsum");
STR_CONST(MyOtherConst, "Hello world");

// myfile.m
#define SYNTHESIZE_CONSTS
#import "myfile.h" 
```

等等，我只有 .h 文件中有关常量的所有信息。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2013-01-26T23:15:01.493

我自己有一个标题，专门用于声明用于首选项的常量 NSStrings，如下所示：

```
extern NSString * const PPRememberMusicList;
extern NSString * const PPLoadMusicAtListLoad;
extern NSString * const PPAfterPlayingMusic;
extern NSString * const PPGotoStartupAfterPlaying; 
```

然后在随附的 .m 文件中声明它们：

```
NSString * const PPRememberMusicList = @"Remember Music List";
NSString * const PPLoadMusicAtListLoad = @"Load music when loading list";
NSString * const PPAfterPlayingMusic = @"After playing music";
NSString * const PPGotoStartupAfterPlaying = @"Go to startup pos. after playing"; 
```

这种方法对我很有帮助。

编辑：请注意，如果字符串在多个文件中使用，这效果最好。如果只有一个文件使用它，您可以`#define kNSStringConstant @"Constant NSString"`在使用该字符串的 .m 文件中进行操作。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2011-12-03T00:03:57.827

对@Krizz 的建议稍作修改，以便将常量头文件包含在 PCH 中时它可以正常工作，这是相当正常的。由于原始文件已导入 PCH，因此不会将其重新加载到`.m`文件中，因此您不会得到任何符号，并且链接器也不满意。

但是，以下修改允许它工作。这有点令人费解，但它确实有效。

您将需要**3 个**文件，`.h`其中包含常量定义的文件、`.h`文件和文件，`.m`我将分别使用和。的内容很简单：`ConstantList.h``Constants.h``Constants.m``Constants.h`

```
// Constants.h
#define STR_CONST(name, value) extern NSString* const name
#include "ConstantList.h" 
```

`Constants.m`文件看起来像：

```
// Constants.m
#ifdef STR_CONST
    #undef STR_CONST
#endif
#define STR_CONST(name, value) NSString* const name = @ value
#include "ConstantList.h" 
```

最后，该`ConstantList.h`文件中包含实际的声明，仅此而已：

```
// ConstantList.h
STR_CONST(kMyConstant, "Value");
… 
```

**有几点需要注意：**

1.  为了使用宏，我必须在`.m`文件中**重新** `#undef`定义宏。

2.  我还必须使用**`#include`**而不是`#import`这样才能正常工作并避免编译器看到以前预编译的值。

3.  每当更改任何值时，这将需要重新编译您的 PCH（可能还有整个项目），如果它们像往常一样分开（和复制）则不是这种情况。

希望这对某人有帮助。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2011-09-28T04:37:01.330

```
// Prefs.h
extern NSString * const RAHUL;

// Prefs.m
NSString * const RAHUL = @"rahul"; 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-02-11T22:05:55.773

正如 Abizer 所说，您可以将其放入 PCH 文件中。另一种不太脏的方法是为所有密钥创建一个包含文件，然后将其包含在您使用密钥的文件中，或者将其包含在 PCH 中。将它们放在自己的包含文件中，这至少为您提供了一个查找和定义所有这些常量的地方。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-02-11T21:56:35.860

如果您想要全局常量之类的东西；一种快速而肮脏的方法是将常量声明放入`pch`文件中。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2015-07-25T09:16:57.243

如果你喜欢命名空间常量，你可以利用 struct，[Friday Q&A 2011-08-19: Namespaced Constants and Functions](https://www.mikeash.com/pyblog/friday-qa-2011-08-19-namespaced-constants-and-functions.html)

```
// in the header
extern const struct MANotifyingArrayNotificationsStruct
{
    NSString *didAddObject;
    NSString *didChangeObject;
    NSString *didRemoveObject;
} MANotifyingArrayNotifications;

// in the implementation
const struct MANotifyingArrayNotificationsStruct MANotifyingArrayNotifications = {
    .didAddObject = @"didAddObject",
    .didChangeObject = @"didChangeObject",
    .didRemoveObject = @"didRemoveObject"
}; 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-12-06T09:26:07.943

尝试使用类方法：

```
+(NSString*)theMainTitle
{
    return @"Hello World";
} 
```

我有时会使用它。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-07-16T00:00:35.567

我使用单例类，这样我可以模拟该类并在必要时更改常量以进行测试。常量类如下所示：

```
#import <Foundation/Foundation.h>

@interface iCode_Framework : NSObject

@property (readonly, nonatomic) unsigned int iBufCapacity;
@property (readonly, nonatomic) unsigned int iPort;
@property (readonly, nonatomic) NSString * urlStr;

@end

#import "iCode_Framework.h"

static iCode_Framework * instance;

@implementation iCode_Framework

@dynamic iBufCapacity;
@dynamic iPort;
@dynamic urlStr;

- (unsigned int)iBufCapacity
{
    return 1024u;
};

- (unsigned int)iPort
{
    return 1978u;
};

- (NSString *)urlStr
{
    return @"localhost";
};

+ (void)initialize
{
    if (!instance) {
        instance = [[super allocWithZone:NULL] init];
    }
}

+ (id)allocWithZone:(NSZone * const)notUsed
{
    return instance;
}

@end 
```

并且它是这样使用的（注意使用常量 c 的简写 - 它`[[Constants alloc] init]`每次都节省输入）：

```
#import "iCode_FrameworkTests.h"
#import "iCode_Framework.h"

static iCode_Framework * c; // Shorthand

@implementation iCode_FrameworkTests

+ (void)initialize
{
    c  = [[iCode_Framework alloc] init]; // Used like normal class; easy to mock!
}

- (void)testSingleton
{
    STAssertNotNil(c, nil);
    STAssertEqualObjects(c, [iCode_Framework alloc], nil);
    STAssertEquals(c.iBufCapacity, 1024u, nil);
}

@end 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-01-21T17:17:05.413

如果你想`NSString.newLine;`从目标 c 调用这样的东西，并且你希望它是静态常量，你可以在 swift 中创建这样的东西：

```
public extension NSString {
    @objc public static let newLine = "\n"
} 
```

而且你有很好的可读常量定义，并且可以在你选择的类型中使用，同时限制到类型的上下文。

# java - java.util.Scanner 和维基百科

> ID：538999
> 
> 赞同：0
> 
> 时间：2009-02-11T21:52:42.200
> 
> 标签：java, wikipedia, java.util.scanner

我正在尝试使用 java.util.Scanner 获取维基百科内容并将其用于基于单词的搜索。事实是这一切都很好，但是在阅读一些单词时它会给我带来错误。查看代码并进行一些检查，结果发现有些单词似乎无法识别编码，或者内容不再可读。这是用于获取页面的代码：

// -开始-

```
try {
        connection =  new URL("http://it.wikipedia.org
wiki/"+word).openConnection();
                    Scanner scanner = new Scanner(connection.getInputStream());
        scanner.useDelimiter("\\Z");
        content = scanner.next();
//          if(word.equals("pubblico"))
//              System.out.println(content);
        System.out.println("Doing: "+ word);
//End 
```

意大利维基百科的“pubblico”一词出现了问题。pubblico 上的 println 的结果是这样的（剪切）：ï¿ï¿½]Ksr>ï¿½~E ï¿½1Aï¿½ï¿½ï¿½Eï¿½ER3tHZï¿½4vï¿½ï¿½&PZjtcï¿½¿½ï¿ ½Dï¿½7_|ï¿½ï¿½ï¿½ï¿½=8ï¿½ï¿½Ø}

你知道为什么吗？然而查看页面源和标题是相同的，具有相同的编码......

结果发现内容是压缩的，所以我可以告诉维基百科不要给我发送压缩的页面还是唯一的方法？谢谢你

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T21:58:08.960

尝试使用具有指定字符集的扫描仪：

```
public Scanner(InputStream source, String charsetName) 
```

对于默认构造函数：

> 使用底层平台的默认字符集将流中的字节转换为字符。

[java.sun.com 上的扫描仪](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html#Scanner(java.io.InputStream,%20java.lang.String))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T22:02:35.657

尝试使用 a`Reader`而不是`InputStream`- 我认为它的工作原理是这样的：

```
connection =  new URL("http://it.wikipedia.org/wiki/"+word).openConnection();
String ctype = connection.getContentType();
int csi = ctype.indexOf("charset=");
Scanner scanner;
if (csi > 0)
    scanner = new Scanner(new InputStreamReader(connection.getInputStream(), ctype.substring(csi + 8)));
else
    scanner = new Scanner(new InputStreamReader(connection.getInputStream()));
scanner.useDelimiter("\\Z");
content = scanner.next();
if(word.equals("pubblico"))
    System.out.println(content);
System.out.println("Doing: "+ word); 
```

您也可以直接将字符集传递给 Scanner 构造函数，如另一个答案中所示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-11T22:03:41.397

您需要使用`URLConnection`, 以便您可以确定响应中的[内容类型标头](http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLConnection.html#getContentType())。这应该告诉您在[创建`Scanner`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html#Scanner(java.io.InputStream,%20java.lang.String)).

具体来说，查看内容类型标头的“charset”参数。

* * *

要禁止 gzip 压缩，[请将 accept-encoding 标头设置](http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLConnection.html#setRequestProperty(java.lang.String,%20java.lang.String))为“identity”。有关详细信息，请参阅[HTTP 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:14:44.003

```
connection =  new URL("http://it.wikipedia.org/wiki/"+word).openConnection();
            connection.addRequestProperty("Accept-Encoding","");
            System.out.println(connection.getContentEncoding());
            Scanner scanner = new Scanner(new InputStreamReader(connection.getInputStream()));
            scanner.useDelimiter("\\Z");
            content = new String(scanner.next()); 
```

编码不变。为什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T22:37:04.537

```
connection =  new URL("http://it.wikipedia.org/wiki/"+word).openConnection();
//connection.addRequestProperty("Accept-Encoding","");
//System.out.println(connection.getContentEncoding());

InputStream resultingInputStream = null;       // Stream su cui fluisce la pagina scaricata
String encoding = connection.getContentEncoding();    // Codifica di invio (identity, gzip, inflate)
// Scelta dell'opportuno decompressore per leggere la sorgente
if (connection.getContentEncoding() != null && encoding.equals("gzip")) {
    resultingInputStream = new GZIPInputStream(connection.getInputStream());
}
else if (encoding != null && encoding.equals("deflate")) {
    resultingInputStream = new InflaterInputStream(connection.getInputStream(), new Inflater(true));
}
else {
    resultingInputStream = connection.getInputStream();
}

// Scanner per estrarre dallo stream la pagina per inserirla in una stringa
Scanner scanner = new Scanner(resultingInputStream);
scanner.useDelimiter("\\Z");
content = new String(scanner.next()); 
```

所以有效！******************************