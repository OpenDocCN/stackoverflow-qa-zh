# StackOverflow 问答 000196000-000196999

# asp.net - Visual Studio 中 aspx 页面的设计视图有用吗？

> ID：196001
> 
> 赞同：2
> 
> 时间：2008-10-12T20:27:30.033
> 
> 标签：asp.net, visual-studio, visual-studio-2008

在开发 aspx 页面时，我从未真正发现 Visual Studio 中的设计视图很有用，因此我基本上从不使用它。

我是否遗漏了某些东西，或者它只是那些不是特别有用的功能之一？你使用设计视图吗？如果是这样，你觉得它如何有用？如果不是，为什么不呢？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T21:26:07.873

> Visual Studio 中 aspx 页面的设计视图有用吗？

肯定是，如果您符合这些配置文件之一

*   你不懂 HTML 或 CSS
*   您不在乎您的 HTML 是否可读或有效
*   您不在乎您的网站是否在 IE 以外的任何地方正确呈现
*   当您对此类事情毫无兴趣时，您将被迫建立一个网页。
*   你已经放弃了生活

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-12T21:12:41.907

我只使用它通过双击按钮等在后面的代码中自动生成事件方法。与手动编写相比，它节省了一些时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T20:31:47.730

我不使用它来布局控件，因为它很慢，但他们在 vs2008 中对其进行了改进。我确实发现它可以节省一些时间将用户控件拖到它上面，但更愿意正确地布置控件，因为它会生成一些脏 html。

说我们最近招募了 2 位坚持使用它的开发人员，每个人都自己使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T21:03:47.823

我通常喜欢在真正的浏览器中检查之前快速检查我的 CSS/HTML 是否看起来相当不错。当您只想输入原始 HTML（即编辑 HTML 简历）时，它对于简单的文本操作也很方便。

显然，新的 VS 2008 设计器为 CSS 提供了很多新功能，它们可能值得更详细地研究。它们主要针对 Dreamweaver 式的功能，允许您管理/应用样式和 CSS。

也就是说，我使用的是 VS 2008，几乎可以在允许我同时查看设计和标记的拆分视图下查看它。

祝你好运。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T22:52:08.773

我只使用它在诸如 GridView、DetailsView 和 DataSource 之类的东西上调出 SmartTag，而不是手动生成所有乏味的 BoundField 和 Template 控件。通常，这只是第一次配置。之后我通常手动编辑标记，因为我将一些 BoundFields 转换为我自己的支持不同类型验证的 BoundField 派生类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T16:09:47.307

仅当您尝试以快速方式生成按钮单击事件、以简单方式生成页面生命周期事件或设置演示软件控件（如网格视图、数据源等）时，它才有用。

除此之外，就这样吧。

即使您确实想使用它，也请尽可能使用拆分视图（如 2008 年），因为它会阻止 Microsoft 为您“改进”您的格式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-07-29T10:47:10.953

我使用它，并在 2010 年使用 CssClass 属性在 css 文件中指定一个类。这样它很整洁并且显示良好（在所有浏览器中）如果您使用菜单项等，您可以在您的 cssclass 属性中指定不同的 css 颜色等用于皮肤（也使用主题等）每次 vs 出来我还学习了一些原本不会使用但非常有用的东西，例如 Membership 模型、CreateUser Wizard 等。

# java - 哪个库更适合更快的 Java 应用程序 swt 或 swing？

> ID：196014
> 
> 赞同：10
> 
> 时间：2008-10-12T20:33:01.583
> 
> 标签：java, swing, swt

哪个库更适合更快的 Java 应用程序 swt 或 swing？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-12T23:04:59.637

几年前，Swing 速度很慢，因此开发了 SWT 以在系统上进行本机 API 调用。然而，Swing 的性能有了很大的提高，现在情况已经不是这样了。SWT 是非标准的，而 Swing 是 Java 规范的正式一部分。JavaFX 也将构建在 Swing 之上。除非您的工作需要编写 Eclipse 插件，否则我会使用 Swing。

要查看使用 Swing 开发的真正优秀的应用程序，请查看 Jetbrain 的 Java IDE。您可以试用 30 天。

[http://www.jetbrains.com/idea/](http://www.jetbrains.com/idea/)

当然，Sun 的 Netbeans 也是一个纯 Swing 应用程序，而且它是免费的。

[http://www.netbeans.org/](http://www.netbeans.org/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-13T22:07:41.813

没有缓慢摆动的应用程序。只是写的不好。这也适用于 SWT。由于 Eclipse 核心架构，大多数应用程序做出了更好的响应。在 J6 之前，在无响应期间存在灰色窗口的几个问题，但在摆动 PLAF 中使用完全双缓冲方法完全解决了这个问题。没有更好的 UI 框架。只有更好的编写程序可以适当地使用多线程来避免 UI 无响应。我个人更喜欢 Swing :)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-06T15:28:33.750

今天，这两个框架都很快。我建议检查这些标准：

1.  SWT 比 Swing 更易于使用（尤其是如果这是您的第一个 UI）
2.  Swing 比较老，可以找到更多组件
3.  如果您还使用 JFace，您会发现许多开箱即用的强大小部件（您需要在 Swing 中进行大量额外配置）。
4.  Swing 随处可用，SWT 不可用
5.  SWT 是积极开发的，你有源码，bug 会很快修复。Swing 已经好几年没有被触及了，然后突然出现了 Java 6 的重大更新。如果您对 Swing 有疑问，那么 Sun 可能不在乎。
6.  如果您选择 Swing，请使用[SwingX 之](https://swingx.java.net/)类的框架。这将使您的生活更加简单。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T21:01:46.797

根据维基百科，没有明确的赢家（尽管您可以根据需要进行编辑）。不可避免地，您可以编写基准测试来显示其中一个比另一个快得多。Swing 在 Java 方面有更多的自由来优化。SWT 可以允许在窗口系统中进行更多优化。

可能对性能的更大影响将来自您的应用程序的行为方式。专注于让你的代码干净（并在必要时进行一些分析）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-16T06:07:43.527

“更快”是主观的。两者都可以跑得很快，但是用 Swing 做一些愚蠢的事情来击中自己的脚并让它*感觉*慢更容易。

尽管如此，我发现在代码级别上使用 Swing 比使用 SWT 更容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-14T15:16:08.393

对小部件工具包的技术决策在我看来是薄冰。恕我直言，当涉及到应用程序框架时，您必须交付的工作量相当大，而且更具决定性。我相信唯一支持 SWT 的论点是它是原生的 L&F。另一方面，如今大多数 UI 都倾向于非本地 L&F。您在 Eclipse RCP 应用程序使用表单框架的趋势中清楚地看到了这一点，该框架绘制自定义渐变和部分，并且以任何方式都不是本机界面（这同样适用于 e4，eclipse v4 细化项目）。总而言之，如果 RCP 在您的项目中是一个选项，我会使用 Eclipse RCP（即 SWT）。这个平台的完整性、活力和节奏是无与伦比的。如果不能选择 RCP，那么 Spring RCP 对我来说看起来非常有说服力（它是基于 Swing 的）。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-12T21:09:22.693

多年来，使用 swing 编写的应用程序比使用 SWT 编写的应用程序多。但是SWT在windows上的用户友好性比Swing更胜一筹。但是，也有例外（[http://www.amazon.com/Rich-Client-Programming-Plugging-NetBeans/dp/0132354802](https://rads.stackoverflow.com/amzn/click/com/0132354802)）。

有一个更大的使用 SWT 开发的 RCP 应用程序社区。尽管使用 Netbeans 的 RCP 应用程序没有那么大，但这是相当可观的。

随着 Java 6 UPDATE 10 即将推出，Swing 应用程序的性能应该会相当不错。也就是说，性能改进也可能适用于 SWT 应用程序。

BR，
~A

# algorithm - O（1）中的唯一（非重复）随机数？

> ID：196017
> 
> 赞同：185
> 
> 时间：2008-10-12T20:34:22.297
> 
> 标签：algorithm, math, random, language-agnostic

我想生成 0 到 1000 之间的唯一随机数，这些随机数永远不会重复（即 6 不会出现两次），但这不会诉诸于对先前值进行 O(N) 搜索之类的方法。这可能吗？

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2008-10-12T20:57:02.080

使用值 0-1000 初始化一个包含 1001 个整数的数组，并将变量 max 设置为数组的当前最大索引（从 1000 开始）。选择一个介于 0 和 max 之间的随机数 r，将位置 r 处的数字与位置 max 处的数字交换，然后返回当前位置 max 处的数字。将 max 减 1 并继续。当 max 为 0 时，将 max 设置回数组的大小 - 1 并重新开始，无需重新初始化数组。

**更新：** 虽然我在回答这个问题时自己想出了这个方法，但经过一些研究，我意识到这是一个修改版本的[Fisher-Yates](http://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle)，称为 Durstenfeld-Fisher-Yates 或 Knuth-Fisher-Yates。由于描述可能有点难以理解，我在下面提供了一个示例（使用 11 个元素而不是 1001 个）：

数组从初始化为 array[n] = n 的 11 个元素开始，最大值从 10 开始：

```
+--+--+--+--+--+--+--+--+--+--+--+
| 0| 1| 2| 3| 4| 5| 6| 7| 8| 9|10|
+--+--+--+--+--+--+--+--+--+--+--+
                                ^
                               max 
```

每次迭代时，在 0 和 max 之间选择一个随机数 r，array[r] 和 array[max] 交换，返回新的 array[max]，max 递减：

```
max = 10, r = 3
           +--------------------+
           v                    v
+--+--+--+--+--+--+--+--+--+--+--+
| 0| 1| 2|10| 4| 5| 6| 7| 8| 9| 3|
+--+--+--+--+--+--+--+--+--+--+--+

max = 9, r = 7
                       +-----+
                       v     v
+--+--+--+--+--+--+--+--+--+--+--+
| 0| 1| 2|10| 4| 5| 6| 9| 8| 7: 3|
+--+--+--+--+--+--+--+--+--+--+--+

max = 8, r = 1
     +--------------------+
     v                    v
+--+--+--+--+--+--+--+--+--+--+--+
| 0| 8| 2|10| 4| 5| 6| 9| 1: 7| 3|
+--+--+--+--+--+--+--+--+--+--+--+

max = 7, r = 5
                 +-----+
                 v     v
+--+--+--+--+--+--+--+--+--+--+--+
| 0| 8| 2|10| 4| 9| 6| 5: 1| 7| 3|
+--+--+--+--+--+--+--+--+--+--+--+

... 
```

11次迭代后，数组中的所有数字都被选中，max == 0，数组元素被打乱：

```
+--+--+--+--+--+--+--+--+--+--+--+
| 4|10| 8| 6| 2| 0| 9| 5| 1| 7| 3|
+--+--+--+--+--+--+--+--+--+--+--+ 
```

此时，可以将 max 重置为 10，并且可以继续该过程。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-10-12T20:37:24.413

你可以这样做：

1.  创建一个列表，0..1000。
2.  随机播放列表。（请参阅[Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)了解执行此操作的好方法。）
3.  从打乱的列表中按顺序返回数字。

所以这不需要每次都搜索旧值，但它仍然需要 O(N) 进行初始洗牌。但正如 Nils 在评论中指出的那样，这是摊销 O(1)。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2008-10-14T18:14:59.677

使用[最大线性反馈移位寄存器](http://en.wikipedia.org/wiki/Linear_feedback_shift_register)。

它可以用几行 C 语言来实现，并且在运行时只做几个测试/分支、一点加法和位移。这不是随机的，但它欺骗了大多数人。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2013-04-19T04:33:02.900

您可以使用[Format-Preserving Encryption](http://en.wikipedia.org/wiki/Format-Preserving_Encryption)来加密计数器。您的计数器只是从 0 向上，加密使用您选择的密钥将其转换为您想要的任何基数和宽度的看似随机的值。例如，对于这个问题中的示例：基数 10，宽度 3。

块密码通常具有固定的块大小，例如 64 或 128 位。但是 Format-Preserving Encryption 允许您使用像 AES 这样的标准密码，并使用您想要的任何基数和宽度的更小宽度的密码，并使用一种在密码学上仍然健壮的算法。

保证永远不会发生冲突（因为密码算法创建 1:1 映射）。它也是可逆的（2 路映射），因此您可以获取结果数字并返回您开始使用的计数器值。

这种技术不需要内存来存储洗牌数组等，这在内存有限的系统上可能是一个优势。

[AES-FFX](http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/ffx/ffx-spec.pdf)是一种建议的标准方法来实现这一点。我已经尝试了一些基于 AES-FFX 思想的基本 Python 代码，虽然不完全符合 -[请参阅此处的 Python 代码](https://github.com/cmcqueen/crypto/blob/master/formatpreservingencryption.py)。例如，它可以将计数器加密为看似随机的 7 位十进制数或 16 位数字。如问题所述，这是基数 10、宽度 3 的示例（给出 0 到 999 之间的数字）：

```
000   733
001   374
002   882
003   684
004   593
005   578
006   233
007   811
008   072
009   337
010   119
011   103
012   797
013   257
014   932
015   433
...   ... 
```

要获得不同的非重复伪随机序列，请更改加密密钥。每个加密密钥产生一个不同的非重复伪随机序列。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-10-12T21:46:14.460

您可以使用 A [Linear Congruential Generator](http://en.wikipedia.org/wiki/Linear_congruential_generator)。其中`m`（模数）将是大于 1000 的最接近的素数。当您得到一个超出范围的数字时，只需获取下一个。该序列只会在所有元素都发生后重复，您不必使用表格。但是请注意此生成器的缺点（包括缺乏随机性）。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-06-22T15:11:01.657

对于像 0...1000 这样的小数字，创建一个包含所有数字的列表并对其进行改组非常简单。但是，如果要从中提取的数字集非常大，还有另一种优雅的方法：您可以使用密钥和加密哈希函数构建伪随机排列。请参阅以下 C++-ish 示例伪代码：

```
unsigned randperm(string key, unsigned bits, unsigned index) {
  unsigned half1 =  bits    / 2;
  unsigned half2 = (bits+1) / 2;
  unsigned mask1 = (1 << half1) - 1;
  unsigned mask2 = (1 << half2) - 1;
  for (int round=0; round<5; ++round) {
    unsigned temp = (index >> half1);
    temp = (temp << 4) + round;
    index ^= hash( key + "/" + int2str(temp) ) & mask1;
    index = ((index & mask2) << half1) | ((index >> half2) & mask1);
  }
  return index;
} 
```

在这里，`hash`只是一些任意的伪随机函数，它将一个字符串映射到一个可能很大的无符号整数。该函数`randperm`是 0...pow(2,bits)-1 内所有数字的排列，假设一个固定键。这是从构造中得出的，因为改变变量的每一步`index`都是可逆的。这是受[Feistel 密码](http://en.wikipedia.org/wiki/Feistel_cipher)启发的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-12-19T18:40:35.270

您可以使用此处描述的我的 Xincrol 算法：

[http://openpatent.blogspot.co.il/2013/04/xincrol-unique-and-random-number.html](http://openpatent.blogspot.co.il/2013/04/xincrol-unique-and-random-number.html)

这是一种生成随机但唯一数字的纯算法方法，无需数组、列表、排列或繁重的 CPU 负载。

最新版本还允许设置数字范围，例如，如果我想要 0-1073741821 范围内的唯一随机数。

我实际上已经将它用于

*   MP3 播放器随机播放每首歌曲，但每个专辑/目录仅播放一次
*   逐像素视频帧溶解效果（快速流畅）
*   为签名和标记（隐写术）在图像上创建秘密“噪声”雾
*   用于通过数据库序列化大量 Java 对象的数据对象 ID
*   三重多数内存位保护
*   地址+值加密（每个字节不仅被加密，而且被移动到缓冲区中一个新的加密位置）。这真的让密码分析人员对我很生气:-)
*   纯文本到纯文本加密，用于 SMS、电子邮件等。
*   我的德州扑克计算器 (THC)
*   我的几款游戏用于模拟，“洗牌”，排名
*   更多的

它是开放的，免费的。试试看...

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-12-17T04:22:27.257

我认为[线性同余生成器](https://en.wikipedia.org/wiki/Linear_congruential_generator)将是最简单的解决方案。

[![在此处输入图像描述](https://i.stack.imgur.com/rFB37.png)](https://i.stack.imgur.com/rFB37.png)

***并且对a***、***c***和***m***值只有 3 个限制

1.  ***m***和***c***互质，
2.  ***a-1能被******m***的所有素因子整除
**   *如果***m能被******4***整除，***则a-1能被******4***整除**

 *****PS**该方法已经提到过，但是帖子对常数值有错误的假设。下面的常量应该适用于您的情况

在您的情况下，您可以使用`a = 1002`, `c = 757`,`m = 1001`

```
X = (1002 * X + 757) mod 1001 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-03T05:55:29.303

你甚至不需要一个数组来解决这个问题。

你需要一个位掩码和一个计数器。

将计数器初始化为零并在连续调用时将其递增。将计数器与位掩码（在启动时随机选择或固定）进行异或运算以生成伪随机数。如果不能有超过 1000 的数字，请不要使用超过 9 位的位掩码。（换句话说，位掩码是不大于 511 的整数。）

确保当计数器超过 1000 时，将其重置为零。此时，您可以选择另一个随机位掩码（如果您愿意）以不同的顺序生成相同的数字集。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-08-25T17:49:40.260

这是我使用第一个解决方案的逻辑键入的一些代码。我知道这是“语言不可知论”，但只是想在 C# 中将其作为示例呈现，以防有人正在寻找快速实用的解决方案。

```
// Initialize variables
Random RandomClass = new Random();
int RandArrayNum;
int MaxNumber = 10;
int LastNumInArray;
int PickedNumInArray;
int[] OrderedArray = new int[MaxNumber];      // Ordered Array - set
int[] ShuffledArray = new int[MaxNumber];     // Shuffled Array - not set

// Populate the Ordered Array
for (int i = 0; i < MaxNumber; i++)                  
{
    OrderedArray[i] = i;
    listBox1.Items.Add(OrderedArray[i]);
}

// Execute the Shuffle                
for (int i = MaxNumber - 1; i > 0; i--)
{
    RandArrayNum = RandomClass.Next(i + 1);         // Save random #
    ShuffledArray[i] = OrderedArray[RandArrayNum];  // Populting the array in reverse
    LastNumInArray = OrderedArray[i];               // Save Last Number in Test array
    PickedNumInArray = OrderedArray[RandArrayNum];  // Save Picked Random #
    OrderedArray[i] = PickedNumInArray;             // The number is now moved to the back end
    OrderedArray[RandArrayNum] = LastNumInArray;    // The picked number is moved into position
}

for (int i = 0; i < MaxNumber; i++)                  
{
    listBox2.Items.Add(ShuffledArray[i]);
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-01-19T18:19:36.347

当限制**很高**并且您只想生成几个随机数时，此方法的结果是合适的。

```
#!/usr/bin/perl

($top, $n) = @ARGV; # generate $n integer numbers in [0, $top)

$last = -1;
for $i (0 .. $n-1) {
    $range = $top - $n + $i - $last;
    $r = 1 - rand(1.0)**(1 / ($n - $i));
    $last += int($r * $range + 1);
    print "$last ($r)\n";
} 
```

请注意，数字是按升序生成的，但之后您可以随机播放。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-07-03T11:29:52.957

问题[如何有效地生成介于 0 和上限 N 之间的 K 个非重复整数的列表](https://stackoverflow.com/questions/158716/how-do-you-efficiently-generate-a-list-of-k-non-repeating-integers-between-0-and?noredirect=1&lq=1)被链接为重复项 - 如果您想要每个生成的随机数为 O(1) 的东西（没有 O(n)启动成本））对已接受的答案进行了简单的调整。

创建一个从整数到整数的空无序映射（一个空的有序映射每个元素需要 O(log k)） - 而不是使用初始化数组。如果这是最大值，请将最大值设置为 1000，

1.  选择一个介于 0 和最大值之间的随机数 r。
2.  确保地图元素 r 和 max 都存在于无序地图中。如果它们不存在，则使用等于它们的索引的值创建它们。
3.  交换元素 r 和 max
4.  返回元素最大值并将最大值减 1（如果最大值变为负数，则完成）。
5.  返回步骤 1。

与使用初始化数组相比，唯一的区别是元素的初始化被推迟/跳过——但它会从同一个 PRNG 生成完全相同的数字。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-03T10:25:23.003

您可以使用具有 10 位的良好[伪随机数生成器](http://en.wikipedia.org/wiki/Pseudorandom_number_generator)，然后丢弃 1001 到 1023，留下 0 到 1000。

从[这里](http://en.wikipedia.org/wiki/Linear_feedback_shift_register)我们得到一个 10 位 PRNG 的设计。

*   10 位，反馈多项式 x^10 + x^7 + 1（周期 1023）

*   使用 Galois LFSR 获取快速代码

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-05-23T19:43:18.360

```
public static int[] randN(int n, int min, int max)
{
    if (max <= min)
        throw new ArgumentException("Max need to be greater than Min");
    if (max - min < n)
        throw new ArgumentException("Range needs to be longer than N");

    var r = new Random();

    HashSet<int> set = new HashSet<int>();

    while (set.Count < n)
    {
        var i = r.Next(max - min) + min;
        if (!set.Contains(i))
            set.Add(i);
    }

    return set.ToArray();
} 
```

根据需要，N 个非重复随机数将具有 O(n) 复杂度。
注意：随机应该是静态的，并且应用了线程安全。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-02-22T02:29:42.330

这是一些您可以使用的示例 COBOL 代码。
我可以给你发送 RANDGEN.exe 文件，这样你就可以用它来看看它是否需要你想要的。

```
 IDENTIFICATION DIVISION.
   PROGRAM-ID.  RANDGEN as "ConsoleApplication2.RANDGEN".
   AUTHOR.  Myron D Denson.
   DATE-COMPILED.
  * ************************************************************** 
  *  SUBROUTINE TO GENERATE RANDOM NUMBERS THAT ARE GREATER THAN
  *    ZERO AND LESS OR EQUAL TO THE RANDOM NUMBERS NEEDED WITH NO
  *    DUPLICATIONS.  (CALL "RANDGEN" USING RANDGEN-AREA.)
  *     
  *  CALLING PROGRAM MUST HAVE A COMPARABLE LINKAGE SECTION
  *    AND SET 3 VARIABLES PRIOR TO THE FIRST CALL IN RANDGEN-AREA     
  *
  *    FORMULA CYCLES THROUGH EVERY NUMBER OF 2X2 ONLY ONCE. 
  *    RANDOM-NUMBERS FROM 1 TO RANDOM-NUMBERS-NEEDED ARE CREATED 
  *    AND PASSED BACK TO YOU.
  *
  *  RULES TO USE RANDGEN:
  *
  *    RANDOM-NUMBERS-NEEDED > ZERO 
  *     
  *    COUNT-OF-ACCESSES MUST = ZERO FIRST TIME CALLED.
  *         
  *    RANDOM-NUMBER = ZERO, WILL BUILD A SEED FOR YOU
  *    WHEN COUNT-OF-ACCESSES IS ALSO = 0 
  *     
  *    RANDOM-NUMBER NOT = ZERO, WILL BE NEXT SEED FOR RANDGEN
  *    (RANDOM-NUMBER MUST BE <= RANDOM-NUMBERS-NEEDED)       
  *     
  *    YOU CAN PASS RANDGEN YOUR OWN RANDOM-NUMBER SEED
  *     THE FIRST TIME YOU USE RANDGEN.
  *     
  *    BY PLACING A NUMBER IN RANDOM-NUMBER FIELD
  *      THAT FOLLOWES THESE SIMPLE RULES:
  *        IF COUNT-OF-ACCESSES = ZERO AND 
  *        RANDOM-NUMBER > ZERO AND 
  *        RANDOM-NUMBER <= RANDOM-NUMBERS-NEEDED
  *       
  *    YOU CAN LET RANDGEN BUILD A SEED FOR YOU
  *     
  *      THAT FOLLOWES THESE SIMPLE RULES:
  *        IF COUNT-OF-ACCESSES = ZERO AND 
  *        RANDOM-NUMBER = ZERO AND 
  *        RANDOM-NUMBER-NEEDED > ZERO  
  *         
  *     TO INSURING A DIFFERENT PATTERN OF RANDOM NUMBERS
  *        A LOW-RANGE AND HIGH-RANGE IS USED TO BUILD
  *        RANDOM NUMBERS.
  *        COMPUTE LOW-RANGE =
  *             ((SECONDS * HOURS * MINUTES * MS) / 3).         
  *        A HIGH-RANGE = RANDOM-NUMBERS-NEEDED + LOW-RANGE
  *        AFTER RANDOM-NUMBER-BUILT IS CREATED 
  *        AND IS BETWEEN LOW AND HIGH RANGE
  *        RANDUM-NUMBER = RANDOM-NUMBER-BUILT - LOW-RANGE
  *               
  * **************************************************************         
   ENVIRONMENT DIVISION.
   INPUT-OUTPUT SECTION.
   FILE-CONTROL.
   DATA DIVISION.
   FILE SECTION.
   WORKING-STORAGE SECTION.
   01  WORK-AREA.
       05  X2-POWER                     PIC 9      VALUE 2\. 
       05  2X2                          PIC 9(12)  VALUE 2 COMP-3.
       05  RANDOM-NUMBER-BUILT          PIC 9(12)  COMP.
       05  FIRST-PART                   PIC 9(12)  COMP.
       05  WORKING-NUMBER               PIC 9(12)  COMP.
       05  LOW-RANGE                    PIC 9(12)  VALUE ZERO.
       05  HIGH-RANGE                   PIC 9(12)  VALUE ZERO.
       05  YOU-PROVIDE-SEED             PIC X      VALUE SPACE.
       05  RUN-AGAIN                    PIC X      VALUE SPACE.
       05  PAUSE-FOR-A-SECOND           PIC X      VALUE SPACE.   
   01  SEED-TIME.
       05  HOURS                        PIC 99.
       05  MINUTES                      PIC 99.
       05  SECONDS                      PIC 99.
       05  MS                           PIC 99\. 
  *
  * LINKAGE SECTION.
  *  Not used during testing  
   01  RANDGEN-AREA.
       05  COUNT-OF-ACCESSES            PIC 9(12) VALUE ZERO.
       05  RANDOM-NUMBERS-NEEDED        PIC 9(12) VALUE ZERO.
       05  RANDOM-NUMBER                PIC 9(12) VALUE ZERO.
       05  RANDOM-MSG                   PIC X(60) VALUE SPACE.
  *    
  * PROCEDURE DIVISION USING RANDGEN-AREA.
  * Not used during testing 
  *  
   PROCEDURE DIVISION.
   100-RANDGEN-EDIT-HOUSEKEEPING.
       MOVE SPACE TO RANDOM-MSG. 
       IF RANDOM-NUMBERS-NEEDED = ZERO
         DISPLAY 'RANDOM-NUMBERS-NEEDED ' NO ADVANCING
         ACCEPT RANDOM-NUMBERS-NEEDED.
       IF RANDOM-NUMBERS-NEEDED NOT NUMERIC 
         MOVE 'RANDOM-NUMBERS-NEEDED NOT NUMERIC' TO RANDOM-MSG
           GO TO 900-EXIT-RANDGEN.
       IF RANDOM-NUMBERS-NEEDED = ZERO
         MOVE 'RANDOM-NUMBERS-NEEDED = ZERO' TO RANDOM-MSG
           GO TO 900-EXIT-RANDGEN.
       IF COUNT-OF-ACCESSES NOT NUMERIC
         MOVE 'COUNT-OF-ACCESSES NOT NUMERIC' TO RANDOM-MSG
           GO TO 900-EXIT-RANDGEN.
       IF COUNT-OF-ACCESSES GREATER THAN RANDOM-NUMBERS-NEEDED
         MOVE 'COUNT-OF-ACCESSES > THAT RANDOM-NUMBERS-NEEDED'
           TO RANDOM-MSG
           GO TO 900-EXIT-RANDGEN.
       IF YOU-PROVIDE-SEED = SPACE AND RANDOM-NUMBER = ZERO
         DISPLAY 'DO YOU WANT TO PROVIDE SEED  Y OR N: '
           NO ADVANCING
           ACCEPT YOU-PROVIDE-SEED.  
       IF RANDOM-NUMBER = ZERO AND
          (YOU-PROVIDE-SEED = 'Y' OR 'y')
         DISPLAY 'ENTER SEED ' NO ADVANCING
         ACCEPT RANDOM-NUMBER. 
       IF RANDOM-NUMBER NOT NUMERIC
         MOVE 'RANDOM-NUMBER NOT NUMERIC' TO RANDOM-MSG
         GO TO 900-EXIT-RANDGEN.
   200-RANDGEN-DATA-HOUSEKEEPING.      
       MOVE FUNCTION CURRENT-DATE (9:8) TO SEED-TIME.
       IF COUNT-OF-ACCESSES = ZERO
         COMPUTE LOW-RANGE =
                ((SECONDS * HOURS * MINUTES * MS) / 3).
       COMPUTE RANDOM-NUMBER-BUILT = RANDOM-NUMBER + LOW-RANGE.  
       COMPUTE HIGH-RANGE = RANDOM-NUMBERS-NEEDED + LOW-RANGE.
       MOVE X2-POWER TO 2X2\.             
   300-SET-2X2-DIVISOR.
       IF 2X2 < (HIGH-RANGE + 1) 
          COMPUTE 2X2 = 2X2 * X2-POWER
           GO TO 300-SET-2X2-DIVISOR.    
  * *********************************************************         
  *  IF FIRST TIME THROUGH AND YOU WANT TO BUILD A SEED.    *
  * ********************************************************* 
       IF COUNT-OF-ACCESSES = ZERO AND RANDOM-NUMBER = ZERO
          COMPUTE RANDOM-NUMBER-BUILT =
                ((SECONDS * HOURS * MINUTES * MS) + HIGH-RANGE).
       IF COUNT-OF-ACCESSES = ZERO        
         DISPLAY 'SEED TIME ' SEED-TIME 
               ' RANDOM-NUMBER-BUILT ' RANDOM-NUMBER-BUILT 
               ' LOW-RANGE  ' LOW-RANGE.          
  * *********************************************     
  *    END OF BUILDING A SEED IF YOU WANTED TO  * 
  * *********************************************               
  * ***************************************************
  * THIS PROCESS IS WHERE THE RANDOM-NUMBER IS BUILT  *  
  * ***************************************************   
   400-RANDGEN-FORMULA.
       COMPUTE FIRST-PART = (5 * RANDOM-NUMBER-BUILT) + 7.
       DIVIDE FIRST-PART BY 2X2 GIVING WORKING-NUMBER 
         REMAINDER RANDOM-NUMBER-BUILT. 
       IF RANDOM-NUMBER-BUILT > LOW-RANGE AND
          RANDOM-NUMBER-BUILT < (HIGH-RANGE + 1)
         GO TO 600-RANDGEN-CLEANUP.
       GO TO 400-RANDGEN-FORMULA.
  * *********************************************     
  *    GOOD RANDOM NUMBER HAS BEEN BUILT        *               
  * *********************************************
   600-RANDGEN-CLEANUP.
       ADD 1 TO COUNT-OF-ACCESSES.
       COMPUTE RANDOM-NUMBER = 
            RANDOM-NUMBER-BUILT - LOW-RANGE. 
  * *******************************************************
  * THE NEXT 3 LINE OF CODE ARE FOR TESTING  ON CONSOLE   *  
  * *******************************************************
       DISPLAY RANDOM-NUMBER.
       IF COUNT-OF-ACCESSES < RANDOM-NUMBERS-NEEDED
        GO TO 100-RANDGEN-EDIT-HOUSEKEEPING.     
   900-EXIT-RANDGEN.
       IF RANDOM-MSG NOT = SPACE
        DISPLAY 'RANDOM-MSG: ' RANDOM-MSG.
        MOVE ZERO TO COUNT-OF-ACCESSES RANDOM-NUMBERS-NEEDED RANDOM-NUMBER. 
        MOVE SPACE TO YOU-PROVIDE-SEED RUN-AGAIN.
       DISPLAY 'RUN AGAIN Y OR N '
         NO ADVANCING.
       ACCEPT RUN-AGAIN.
       IF (RUN-AGAIN = 'Y' OR 'y')
         GO TO 100-RANDGEN-EDIT-HOUSEKEEPING.
       ACCEPT PAUSE-FOR-A-SECOND.
       GOBACK. 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-04-27T20:33:16.183

假设您想一遍又一遍地检查已洗牌的列表，而不会在`O(n)`每次重新开始重新洗牌时都有延迟，在这种情况下，我们可以这样做：

1.  创建 2 个列表 A 和 B，从 0 到 1000，占用`2n`空间。

2.  使用 Fisher-Yates 随机播放列表 A 需要`n`时间。

3.  绘制数字时，在另一个列表上执行 1 步 Fisher-Yates 洗牌。

4.  当光标在列表末尾时，切换到另一个列表。

**预处理**

```
cursor = 0

selector = A
other    = B

shuffle(A) 
```

**画**

```
temp = selector[cursor]

swap(other[cursor], other[random])

if cursor == N
then swap(selector, other); cursor = 0
else cursor = cursor + 1

return temp 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-12T20:38:25.660

另一种可能性：

您可以使用一组标志。当它已经被选中时，再拿下一个。

但是，请注意，调用 1000 次后，该功能将永远不会结束，因此您必须做好保护措施。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-06-02T04:32:42.903

这里的大多数答案都不能保证它们不会两次返回相同的数字。这是一个正确的解决方案：

```
int nrrand(void) {
  static int s = 1;
  static int start = -1;
  do {
    s = (s * 1103515245 + 12345) & 1023;
  } while (s >= 1001);
  if (start < 0) start = s;
  else if (s == start) abort();

  return s;
} 
```

我不确定约束是否明确。假设在 1000 个其他输出之后允许重复一个值，但是天真地允许 0 在 0 之后立即跟随，只要它们都出现在 1000 组的末尾和开头。相反，虽然可以保持距离重复之间有 1000 个其他值，这样做会迫使序列每次都以完全相同的方式重播自身，因为没有其他值超出该限制。

这是一种在重复值之前始终保证至少 500 个其他值的方法：

```
int nrrand(void) {
  static int h[1001];
  static int n = -1;

  if (n < 0) {
    int s = 1;
    for (int i = 0; i < 1001; i++) {
      do {
        s = (s * 1103515245 + 12345) & 1023;
      } while (s >= 1001);
      /* If we used `i` rather than `s` then our early results would be poorly distributed. */
      h[i] = s;
    }
    n = 0;
  }

  int i = rand(500);
  if (i != 0) {
      i = (n + i) % 1001;
      int t = h[i];
      h[i] = h[n];
      h[n] = t;
  }
  i = h[n];
  n = (n + 1) % 1001;

  return i;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-11-22T08:26:07.297

当 N 大于 1000 并且您需要抽取 K 个随机样本时，您可以使用包含迄今为止样本的集合。对于每次抽奖，您都使用[拒绝采样](https://en.wikipedia.org/wiki/Rejection_sampling)，这将是一个“几乎”O(1) 操作，因此总运行时间接近 O(K)，存储时间为 O(N)。

当 K “接近” N 时，该算法会发生冲突。这意味着运行时间将比 O(K) 差很多。一个简单的解决方法是颠倒逻辑，以便在 K > N/2 时，记录所有尚未抽取的样本。每次抽取都会从拒绝集中删除一个样本。

拒绝采样的另一个明显问题是它是 O(N) 存储，如果 N 达到数十亿或更多，这是个坏消息。但是，有一种算法可以解决这个问题。这个算法在它的发明者之后被称为维特算法。该算法在[此处](https://getkerf.wordpress.com/2016/03/30/the-best-algorithm-no-one-knows-about/)描述。Vitter 算法的要点是，在每次抽签后，您使用确保均匀采样的特定分布计算随机跳跃。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-03-01T20:42:45.207

[费舍尔·耶茨](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle)

```
for i from n−1 downto 1 do
     j ← random integer such that 0 ≤ j ≤ i
     exchange a[j] and a[i] 
```

它实际上是 O(n-1) 因为你只需要一个交换最后两个
这是 C#

```
public static List<int> FisherYates(int n)
{
    List<int> list = new List<int>(Enumerable.Range(0, n));
    Random rand = new Random();
    int swap;
    int temp;
    for (int i = n - 1; i > 0; i--)
    {
        swap = rand.Next(i + 1);  //.net rand is not inclusive
        if(swap != i)  // it can stay in place - if you force a move it is not a uniform shuffle
        {
            temp = list[i];
            list[i] = list[swap];
            list[swap] = temp;
        }
    }
    return list;
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-10-30T05:02:32.410

请在[https://stackoverflow.com/a/46807110/8794687查看我的回答](https://stackoverflow.com/a/46807110/8794687)

它是最简单的算法之一，平均时间复杂度为*O* ( *s* log *s* )，*s*表示样本大小。还有一些链接到哈希表算法，其复杂性据称为*O* ( *s* )。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2019-11-01T21:32:31.463

有人发布“在 excel 中创建随机数”。我正在使用这个理想。创建一个包含 2 个部分的结构，str.index 和 str.ran；对于 10 个随机数，创建一个包含 10 个结构的数组。将 str.index 设置为 0 到 9，并将 str.ran 设置为不同的随机数。

```
for(i=0;i<10; ++i) {
      arr[i].index = i;
      arr[i].ran   = rand();
} 
```

根据 arr[i].ran 中的值对数组进行排序。str.index 现在是随机顺序。下面是c代码：

```
#include <stdio.h>
#include <stdlib.h>

struct RanStr { int index; int ran;};
struct RanStr arr[10];

int sort_function(const void *a, const void *b);

int main(int argc, char *argv[])
{
   int cnt, i;

   //seed(125);

   for(i=0;i<10; ++i)
   {
      arr[i].ran   = rand();
      arr[i].index = i;
      printf("arr[%d] Initial Order=%2d, random=%d\n", i, arr[i].index, arr[i].ran);
   }

   qsort( (void *)arr, 10, sizeof(arr[0]), sort_function);
   printf("\n===================\n");
   for(i=0;i<10; ++i)
   {
      printf("arr[%d] Random  Order=%2d, random=%d\n", i, arr[i].index, arr[i].ran);
   }

   return 0;
}

int sort_function(const void *a, const void *b)
{
   struct RanStr *a1, *b1;

   a1=(struct RanStr *) a;
   b1=(struct RanStr *) b;

   return( a1->ran - b1->ran );
} 
```

# javascript - JavaScript 滑块

> ID：196020
> 
> 赞同：0
> 
> 时间：2008-10-12T20:36:17.973
> 
> 标签：javascript, slider

我需要为客户的网站创建一个“滑块”。滑块应该允许人们选择他们想要的 x 项目的数量，并显示基于此的价格。奇怪的（ish）部分是价格上涨的比例会随着商品数量的增加而下降：

*   1 件：100 美元
*   2 件：+90 = 190 美元
*   3 件商品：+ 80 = 270 美元
*   4 件商品：+ 70 = 340 美元
*   5 件商品：+ 60 = 400 美元
*   6 件：+ 50 = 450 美元
*   7 件商品：+ 50 = 500 美元

从那时起所有的增加都是+50。这似乎是一个过于简单化的问题，但有谁知道我该怎么做？我几乎没有使用 JavaScript 的经验 :(

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T20:42:18.367

看看雅虎！用户界面。他们有一个滑块小部件：http: [//developer.yahoo.com/yui/slider/](http://developer.yahoo.com/yui/slider/)

以下示例应该可以帮助您入门：http: [//developer.yahoo.com/yui/examples/slider/slider-ticks.html](http://developer.yahoo.com/yui/examples/slider/slider-ticks.html)。

所有 JavaScript 框架（[jQuery](http://docs.jquery.com/UI/Slider)、[MooTools](http://demos.mootools.net/Slider)）似乎都提供了一个滑块。YUI 将为您提供大量控制和加载程序，因此您不必在服务器上托管脚本。请注意，YUI 不会像我提到的其他两个那样使实现变得轻松。

这是一个 MooTools 示例：

```
// First example of http://demos.mootools.net/Slider

<div class="slider" id="myslider">
      <div class="knob" style="position: relative;"/>
    </div> 
```

和 JavaScript：

```
var el = $('myslider'); // The slider graphic
new Slider(el, el.getElement('.knob'), {
    steps: 7,   // There are 7 choices
    range: [1, 7],  // Minimum value is 1, maximum is 7
    onChange: function(value){
        // Calculation of the value goes here
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T20:45:42.057

虽然使用 JS 完成滑块的方法可能有无数种，但我认为计算价格的最简单方法只是在某处硬编码（或列出）它们，然后`else-if`:ing 通过它们。

你*可以*做一个算法，计算`100-(i*10)`前五个项目，`50`其余的，但未来可能比硬列出的方式更难改变。

# javascript - 有没有比 setTimeout 更准确的方法来创建 Javascript 计时器？

> ID：196027
> 
> 赞同：74
> 
> 时间：2008-10-12T20:38:35.707
> 
> 标签：javascript, timer

一直困扰着我的是`setTimeout()`Javascript 中的方法是多么不可预测。

根据我的经验，计时器在很多情况下都非常不准确。不准确，我的意思是实际延迟时间似乎或多或少地变化了 250-500 毫秒。虽然这不是很长的时间，但当使用它来隐藏/显示 UI 元素时，时间可能会很明显。

是否有任何技巧可以确保`setTimeout()`准确执行（无需借助外部 API），或者这是一个失败的原因？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-10-12T21:32:23.833

> 是否有任何技巧可以确保`setTimeout()`准确执行（无需借助外部 API），或者这是一个失败的原因？

没有也没有。你不会得到任何接近完美准确计时器的东西`setTimeout()`- 浏览器没有为此设置。**但是**，您也不需要依赖它来计时。大多数动画库在几年前就发现了这一点：您使用 设置回调，但根据（或等价物）`setTimeout()`的值确定需要做什么。`(new Date()).milliseconds`这使您可以在较新的浏览器中利用更可靠的计时器支持，同时在较旧的浏览器上仍能正常运行。

它还可以让您*避免使用过多的计时器*！这很重要：每个计时器都是一个回调。每个回调执行 JS 代码。在执行 JS 代码时，浏览器事件（包括其他回调）被延迟或丢弃。当回调完成时，额外的回调必须与其他浏览器事件竞争执行的机会。因此，一个处理该间隔内所有待处理任务的计时器将比两个具有重合间隔的计时器执行得更好，并且（对于短超时）比两个具有重叠超时的计时器更好！

总结：停止使用`setTimeout()`实现“一个定时器/一个任务”的设计，使用实时时钟来平滑UI动作。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-03-06T01:52:09.717

.

参考；[http://www.sitepoint.com/creating-accurate-timers-in-javascript/](http://www.sitepoint.com/creating-accurate-timers-in-javascript/)

这个网站大规模地救了我。

您可以使用系统时钟来补偿计时器的不准确性。如果您将计时函数作为一系列 setTimeout 调用运行（每个实例调用下一个实例），那么您所要做的就是准确计算它的不准确程度，并从下一次迭代中减去该差异：

```
var start = new Date().getTime(),  
    time = 0,  
    elapsed = '0.0';  
function instance()  
{  
    time += 100;  
    elapsed = Math.floor(time / 100) / 10;  
    if(Math.round(elapsed) == elapsed) { elapsed += '.0'; }  
    document.title = elapsed;  
    var diff = (new Date().getTime() - start) - time;  
    window.setTimeout(instance, (100 - diff));  
}  
window.setTimeout(instance, 100); 
```

这种方法将最大限度地减少漂移并将误差减少 90% 以上。

解决了我的问题，希望对你有帮助

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-04-19T11:17:51.247

不久前我遇到了类似的问题，并提出了一种结合`requestAnimationFrame`performance.now() 的方法，该方法非常有效。

我现在能够使计时器精确到小数点后 12 位：

```
 window.performance = window.performance || {};
    performance.now = (function() {
        return performance.now       ||
            performance.mozNow    ||
            performance.msNow     ||
            performance.oNow      ||
            performance.webkitNow ||
                function() {
                    //Doh! Crap browser!
                    return new Date().getTime(); 
                };
        })(); 
```

[http://jsfiddle.net/CGWGreen/9pg9L/](http://jsfiddle.net/CGWGreen/9pg9L/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-09-01T10:36:11.683

如果您需要在给定的时间间隔内获得准确的回调，此要点可能会对您有所帮助：

[https://gist.github.com/1185904](https://gist.github.com/1185904)

```
function interval(duration, fn){
  var _this = this
  this.baseline = undefined

  this.run = function(){
    if(_this.baseline === undefined){
      _this.baseline = new Date().getTime()
    }
    fn()
    var end = new Date().getTime()
    _this.baseline += duration

    var nextTick = duration - (end - _this.baseline)
    if(nextTick<0){
      nextTick = 0
    }

    _this.timer = setTimeout(function(){
      _this.run(end)
    }, nextTick)
  }

  this.stop = function(){
    clearTimeout(_this.timer)
  }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-12T23:04:25.880

shog9 的回答几乎就是我要说的，尽管我会添加以下关于 UI 动画/事件的内容：

如果您有一个应该滑动到屏幕上的框，向下扩展，然后淡入其内容，请不要尝试将所有三个事件分开，并定时延迟以使它们一个接一个地触发-使用回调，所以一次第一个事件完成滑动它调用扩展器，一旦完成它调用推子。jQuery 可以轻松做到这一点，我相信其他库也可以。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-01-14T15:38:16.807

**如果您使用`setTimeout()`快速屈服于浏览器**以便它的 UI 线程可以赶上它需要执行的任何任务（例如更新选项卡或不显示长时间运行脚本对话框），那么有一个名为[Efficient的新 API Script Yielding](https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html)，又名，`setImmediate()`它可能对你更好一些。

`setImmediate()`操作与 非常相似`setTimeout()`，但如果浏览器无事可做，它可能会立即运行。在许多使用`setTimeout(..., 16)`or `setTimeout(..., 4)`or的情况下`setTimeout(..., 0)`（即您希望浏览器运行任何未完成的 UI 线程任务而不显示长时间运行脚本对话框），您可以简单地替换您的`setTimeout()`with `setImmediate()`，删除第二个（毫秒）参数。

不同的`setImmediate()`是，它基本上是一个收益；如果浏览器有时间在 UI 线程上执行（例如，更新选项卡），它会在返回回调之前执行此操作。但是，如果浏览器已经全部赶上它的工作，那么指定的回调`setImmediate()`将基本上毫无延迟地运行。

不幸的是，它目前仅在 IE9+ 中受支持，因为其他浏览器供应商对此有所[回击](http://code.google.com/p/chromium/issues/detail?id=146172)。

但是，如果您想使用它并希望其他浏览器在某个时候实现它，那么有一个[很好的 polyfill可用。](https://github.com/NobleJS/setImmediate)

**如果您使用`setTimeout()`动画**，[requestAnimationFrame](http://www.w3.org/TR/animation-timing/)是您最好的选择，因为您的代码将与显示器的刷新率同步运行。

**如果您使用`setTimeout()`较慢的节奏**，例如每 300 毫秒一次，您可以使用类似于 user1213320 建议的解决方案，在该解决方案中，您可以监控从计时器运行的最后一个时间戳开始的时间并补偿任何延迟。一项改进是您可以使用新的[高分辨率时间](http://www.w3.org/TR/hr-time/)接口 (aka `window.performance.now()`) 而不是`Date.now()`获得当前时间大于毫秒的分辨率。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-09-06T14:20:04.327

您需要在目标时间“爬行”。一些试验和错误将是必要的，但在本质上。

设置超时以在所需时间前大约 100 毫秒完成

使超时处理函数像这样：

```
calculate_remaining_time
if remaining_time > 20ms // maybe as much as 50
  re-queue the handler for 10ms time
else
{
  while( remaining_time > 0 ) calculate_remaining_time;
  do_your_thing();
  re-queue the handler for 100ms before the next required time
} 
```

但是你的 while 循环仍然会被其他进程打断，所以它仍然不完美。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-03-08T01:16:33.053

这是一个演示 Shog9 建议的示例。这会在 6 秒内平滑地填充 jquery 进度条，然后在填充后重定向到不同的页面：

```
var TOTAL_SEC = 6;
var FRAMES_PER_SEC = 60;
var percent = 0;
var startTime = new Date().getTime();

setTimeout(updateProgress, 1000 / FRAMES_PER_SEC);

function updateProgress() {
    var currentTime = new Date().getTime();

    // 1000 to convert to milliseconds, and 100 to convert to percentage
    percent = (currentTime - startTime) / (TOTAL_SEC * 1000) * 100;

    $("#progressbar").progressbar({ value: percent });

    if (percent >= 100) {
        window.location = "newLocation.html";
    } else {
        setTimeout(updateProgress, 1000 / FRAMES_PER_SEC);
    }                 
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-12-04T16:33:57.643

这是我为我的一个音乐项目制作的计时器。在所有设备上都准确的计时器。

```
var Timer = function(){
  var framebuffer = 0,
  var msSinceInitialized = 0,
  var timer = this;

  var timeAtLastInterval = new Date().getTime();

  setInterval(function(){
    var frametime = new Date().getTime();
    var timeElapsed = frametime - timeAtLastInterval;
    msSinceInitialized += timeElapsed;
    timeAtLastInterval = frametime;
  },1);

  this.setInterval = function(callback,timeout,arguments) {
    var timeStarted = msSinceInitialized;
    var interval = setInterval(function(){
      var totaltimepassed = msSinceInitialized - timeStarted;
      if (totaltimepassed >= timeout) {
        callback(arguments);
        timeStarted = msSinceInitialized;
      }
    },1);

    return interval;
  }
}

var timer = new Timer();
timer.setInterval(function(){console.log("This timer will not drift."),1000}
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-12T20:45:58.453

讨厌这么说，但我认为没有办法缓解这种情况。不过，我确实认为这取决于客户端系统，因此更快的 javascript 引擎或机器可能会使其*更加*准确。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-12T20:46:54.083

根据我的经验，即使我认为 js 执行的最小合理时间约为 32-33 毫秒，这也是徒劳的。...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-12T20:50:29.910

这里肯定有一个限制。给你一些观点，谷歌刚刚发布的 Chrome 浏览器速度足够快，它可以在 15-20 毫秒内执行 setTimeout(function() {}, 0)，而旧的 Javascript 引擎需要数百毫秒才能执行该函数。尽管 setTimeout 使用毫秒，但目前没有任何 javascript 虚拟机可以以这种精度执行代码。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-12T21:09:09.700

Dan，根据我的经验（包括在 JavaScript 中实现 SMIL2.1 语言，其中时间管理是主题），我可以向您保证，您实际上永远不需要 setTimeout 或 setInterval 的高精度。

然而，重要的是 setTimeout/setInterval 在排队时执行的顺序——而且它总是能完美运行。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-12T22:13:09.430

JavaScript 超时的实际限制是 10-15 毫秒（我不确定你在做什么才能获得 200 毫秒，除非你正在执行 185 毫秒的实际 js 执行）。这是由于 Windows 的标准计时器分辨率为 15 毫秒，唯一做得更好的方法是使用 Windows 的更高分辨率计时器，这是一个系统范围的设置，因此可以与系统上的其他应用程序一起使用，并且还会消耗电池寿命（Chrome 有英特尔在此问题上的错误）。

10-15ms 的事实标准是由于人们在网站上使用 0ms 超时，然后以假设 10-15ms 超时的方式进行编码（例如，js 游戏假设 60fps 但要求 0ms/帧而没有增量逻辑，所以游戏/网站/动画比预期快几个数量级）。考虑到这一点，即使在没有 Windows 计时器问题的平台上，浏览器也会将计时器分辨率限制为 10 毫秒。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-09-29T08:01:50.563

这是我使用的。由于它是 JavaScript，我将发布我的 Frontend 和 node.js 解决方案：

对于两者，我都使用相同的十进制舍入函数，我强烈建议您保持一定的距离，因为原因：

```
const round = (places, number) => +(Math.round(number + `e+${places}`) + `e-${places}`) 
```

`places`- 四舍五入的小数位数，这应该是安全的，并且应该避免浮点数的任何问题（一些数字，如 1.0000000000005~ 可能有问题）。我花时间研究高分辨率计时器提供的四舍五入的最佳方法，转换为毫秒。

`that + symbol`- 它是将操作数转换为数字的一元运算符，几乎等同于`Number()`

> 浏览器

```
const start = performance.now()

// I wonder how long this comment takes to parse

const end = performance.now()

const result = (end - start) + ' ms'

const adjusted = round(2, result) // see above rounding function 
```

> 节点.js

```
// Start timer
const startTimer = () => process.hrtime()

// End timer
const endTimer = (time) => {
    const diff = process.hrtime(time)
    const NS_PER_SEC = 1e9
    const result = (diff[0] * NS_PER_SEC + diff[1])
    const elapsed = Math.round((result * 0.0000010))
    return elapsed
}

// This end timer converts the number from nanoseconds into milliseconds;
// you can find the nanosecond version if you need some seriously high-resolution timers.

const start = startTimer()

// I wonder how long this comment takes to parse

const end = endTimer(start)

console.log(end + ' ms') 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-05-31T11:19:09.310

您可以考虑使用[html5 webaudio 时钟](http://www.sitepoint.com/creating-accurate-timers-in-javascript/)，它使用系统时间来获得更好的准确性

# php - 如何将需要很长时间才能运行的 PHP 脚本拆分成更小的块？

> ID：196029
> 
> 赞同：3
> 
> 时间：2008-10-12T20:39:54.207
> 
> 标签：php

我有一个初始化图片库的 PHP 脚本。它遍历所有图像，检查它们是否被缩略图和水印。

根据 php.ini 设置，我的共享主机帐户只允许我执行每个脚本 30 秒。我无法改变这一点。

我能做些什么来解决这个问题？目前我每 5 张图片刷新一次页面，这可以防止脚本超时，但浏览器会识别出脚本不会完成并给出错误。没关系，但它不是真正的用户友好。

有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T22:51:16.297

也许您应该避免批处理并制作一个代理生成脚本，该脚本*按需*为每个图像执行该过程。

在代理 PHP 脚本中重写转换代码，该脚本检查图像是否已经缩略图，如果没有，则执行需要执行的操作。然后可以使用 加载缩略图或水印文件并将其发送到客户端`fpassthru()`。

您的网页应该只引用代理脚本，例如

```
<img src="/image.php?DSC001.JPG"> 
```

如果您的提供程序支持 Apache/重写，如果缩略图已经创建，您可以通过绕过代理/生成脚本来做更多的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T20:43:38.097

三个想法：

1.  您可以将其卸载到在服务器上运行的脚本（也许是 PHP CLI？）并让您当前的脚本检查进度（仍在运行！稍后再检查！）。

2.  如果 javascript 在您的环境中正常，也许您也可以进行 ajax 调用来处理这个问题。第一个解决方案允许用户继续在网站上四处游荡，但不确定这是否是您的重要考虑因素。

3.  您可以让 PHP 脚本只执行某个批次（例如一次 10 个图像），然后使用进度报告刷新页面并再进行 10 个，而不是基于任意时间的刷新。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T20:51:05.103

获取图像列表，然后遍历它们，例如，您总共可以获得 500 个图像，一次可以拍摄 5 个，完成后输出一个元刷新标签，该标签将在 2 秒内重新加载脚本，例如您当前作为参数的图像编号。

```
<meta http-equiv="refresh" content="2;url=script.php?start=5"> 
```

并且在您的脚本中还检查 $_GET['start'] 是什么，然后从那里继续接下来的 5 张图像，然后输出 start=10 等等……直到您遍历所有这些图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T20:52:34.053

你可以使用[set_time_limit()](http://php.net/set_time_limit)虽然有些主机可能不支持这个，但现在大多数都支持。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T23:27:50.060

您可能还想尝试优化您的脚本。你在你的循环中做的太多了吗？你能把一些东西移出循环吗？你用什么来获取文件列表？有没有更轻量级的方法来做到这一点？这些是你可以问自己关于你的脚本的问题，这样你就可以让整个 shebang 及时运行，而不是把它分开。

Failing that, I agree with Owen's suggestion of using AJAX. When the user kicks the process off you'll output a page as normal and then send back requests to process files out of band and then write status updates to the page as they come in.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T20:51:28.520

那么某种任务列表呢，例如：

1.  第一个脚本列出需要缩略图或水印的图像
2.  第二个脚本检查此列表并执行前 5 个左右（但可以在时间限制内完成许多）并将它们从列表中删除
3.  让步骤 2 中的脚本返回一个值，告诉您列表是否为空，如果不是，则重复步骤 2（使用 ajax 可能最简单）

使用这种方法，整个时间唯一“运行”的是浏览器中的页面，每个脚本只运行 30 秒。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T20:53:28.220

我认为如果每个页面加载时间超过 30 秒，这表明其他事情会出错。你有多少张图片？您是否将水印/缩略图版本存储在磁盘上？如果您不这样做，那么您的答案就是：当然，它可能会占用一些空间，但它会完全避免这个问题，并允许客户端缓存图像。

如果您确定这样做是唯一的方法，请查看[`set_time_limit`](http://au.php.net/set_time_limit)增加脚本运行时间的功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T08:47:59.587

On a shared hosting env, I would not recommend you run a script that might take more than 30 seconds to process and do n't even think about **set_time_limit**. What I would recommend is that you either do your thumbnails and watermarking on picture upload ? or picture request and mark the picture as done so you don't have to do it again. The other option is to run a batch that will process for instance 10 pictures every minute or 10 minutes but run the script via cli in the crontab....

It's a good practice to always know how much resources your script might be using when running a batch script....especially in a shared hosting env....this can affect other users easily.

# visual-studio - 跨 Windows 和 Unix 的代码格式化

> ID：196032
> 
> 赞同：0
> 
> 时间：2008-10-12T20:41:17.417
> 
> 标签：visual-studio, emacs, cross-platform, code-formatting, dos2unix

哪些 Visual Studio 设置和 .emacs 宏提高了在 Windows（在 Visual Studio 中）编写的代码在 Emacs 中仍然看起来不错（反之亦然）的可能性？我最近开始关闭 emacs 中的选项卡（因此选项卡通过空格呈现），这至少使代码看起来相同（但喜欢某些选项卡大小的人不走运）。有没有更好的办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T20:59:25.180

始终*只使用制表符进行缩进*，没有其他问题，没有问题。

任何涉及跨行对齐字符（而不是缩进）的内容都应该使用空格。

只要这样做，人们就可以将他们的标签大小设置为他们喜欢的任何大小，一切都会好起来的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T20:51:27.630

选项卡大小纯粹是个人喜好，但每段代码或项目都应指定要用作标准的选项卡大小。这样，即使有人不喜欢你的标签大小，他们也会知道你的意思是这样，并在任何修复中做同样的事情，希望他们不应该有这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T22:45:18.320

Emacs 对制表符的想法是它们是一种压缩方案，它们的大小始终为 8，并且它们的大小通常与缩进大小不同。这导致它在第一个缩进处缩进 4 个空格，然后在下一个缩进处缩进 1 个制表符，然后在第三个缩进级别缩进 1 个制表符和 4 个空格。

使其与可变大小的选项卡编辑器兼容的选项是将 emacs 设置为空格（就像您所做的那样），或者将其缩进大小设置为 8（这是他们在 linux 内核源代码中所做的），或者寻找emacs 宏文件，使其具有可变大小的选项卡（我在网上看到过，但我没有做书签）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T23:02:10.767

除了使用空格而不是制表符并确保两个编辑环境中的制表符宽度相同之外，我通常将 emacs（因为我更熟悉它）的 c/c++ 模式更改为“bsd”样式。这似乎更接近于 Visual Studio 的默认样式。

从我的 .emacs 自定义设置变量列表中：

```
'(c-default-style (quote ((c-mode . "bsd") (c++-mode . "bsd") (java-mode . "jav
a") (other . "gnu")))) 
```

# java - 如何从 ColdFusion 访问 Java 类的公共静态成员？

> ID：196037
> 
> 赞同：9
> 
> 时间：2008-10-12T20:43:49.703
> 
> 标签：java, coldfusion

如何从 ColdFusion 访问 Java 类的公共静态成员？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-12T21:17:29.590

您运行 createObject 但在运行静态方法之前不调用“init”。例如：

```
<cfset systemObject = createObject("java", "java.lang.System") />
<cfoutput>#systemObject.currentTimeMillis()#</cfoutput> 
```

在这种情况下，“currentTimeMillis()”是 System 类的静态方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-12T19:26:38.967

我还要提到该类必须在 CF 的类路径中。

# xml - 哪个数据库具有最好的 XML 支持？

> ID：196048
> 
> 赞同：5
> 
> 时间：2008-10-12T20:50:44.043
> 
> 标签：xml, database

我有一个每天生成大量 XML 文档（大约 100 万个）的系统，我希望能够存储和索引这些文档，以便例如搜索具有特定字段的所有文档设置为给定值。

我知道基本上有两种类型的 XML 数据库，一种是在传统关系数据库之上提供 XML 支持的一种，一种是“本机”XML 数据库。鉴于我愿意使用其中任何一种，你会推荐什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-12T22:40:35.133

Microsoft SQL Server 支持 XML 列。这不仅仅是对 BLOB/TEXT 的支持。

您可以以非结构化方式使用 XML 列，其中 SQL Server 只会确保它们是正确的 XML。这允许在 SQL Server 中存储任意 XML 文档，但仍确保您处理的是 XML 而不仅仅是任意字节/字符。SQL Server 允许您在此之上使用 XQuery 进行查询。

您还可以使用 XSD 创建符合架构的 XML 列。更有趣的是，SQL Server 允许对 XML 进行索引，以便您的 XPath 查询可以很好地执行。

有关详细信息，请参阅“ [SQL Server 2008 中 XML 的新增功能](http://www.microsoft.com/sqlserver/2008/en/us/wp-sql-2008-whats-new-xml.aspx)”。（尽管大部分 XML 支持存在于 SQL Server 2005 中。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-10-26T23:09:24.803

If you are looking for a native XML db, I definitely suggest Sedna. Brilliant developer support as well.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-03T12:02:03.230

您可能还希望查看[MarkLogic Server](http://www.marklogic.com)或[eXist](http://exist.sourceforge.net)。

如果您的内容量适中（几 GB），那么 eXist 就可以了。除此之外，您可能还想研究 MarkLogic。

您可以下载并查看它们，因为 eXist 是免费的，而且 MarkLogic 有一个社区许可证供您使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-12T21:15:17.363

我不能给你一个好的候选人，但如果你想避免选择一个不好的候选人，请避免使用 Oracle XmlDB。它的速度很慢，而且很糟糕。Oracle 对其 DBMS 进行的最糟糕的扩展之一。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-13T04:15:05.830

支持 PureXML 的 DB2 9.x 是可能的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-13T08:54:01.737

从 DB2 Viper 开始，IBM DB2 开始为 XML 数据存储以及查询 XML 数据提供本机支持。

DB2 旨在优化对 XML 和关系数据的访问，这些功能可用于 C++、.NET、COBOL、Java 和 PHP。

xQuery 是一种用于在 DB2 中查询 xml 数据的新语言

演示查询：

```
create table person(name varchar(20), data xml);

insert into person values('bane', XMLPARSE(DOCUMENT '
<person>
<first-name>Tom</first-name>
<last-name>Hardy</last-name>
<mobile>89898989</mobile>

</person>
' STRIP WHITESPACE))

some simple xQueries

SELECT *
FROM googolplex.person
WHERE xmlexists('$s[person/first-name="bane"]' PASSING person AS "s"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T21:19:33.347

据从事它工作的人说，[monetDB](http://monetdb.cwi.nl/)非常能够处理 xml。基本上，当您想对内容执行 xquery 时，您希望有一些可以正确执行此操作的东西。非常灵活且长度不确定的 XML 文档的结构与 rdbms 的结构根本不同。这意味着需要智能地存储和索引事物。对于传统的 dbms 系统，将 xml 存储为 BLOB（二进制对象）是一种简单的快捷方式。但是 BLOB 通常不被索引，并且主要存在于主数据存储之外。要正确解析 xml，系统必须在存储时进入 xml。MonetDB 显然是这样做的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T00:14:13.837

一定要试试 MS-SQL、Oracle 和其他支持 XQuery 的现有系统。

但是，如果事先知道您需要的基于 XML 的查询，那么将 XML 存储在 BLOB 中并添加一个或两个带有相关 XML 元素副本的索引字段可能会更容易。

# html - 生成 html 时，是否包括换行符和制表符等格式？

> ID：196049
> 
> 赞同：1
> 
> 时间：2008-10-12T20:50:59.223
> 
> 标签：html, code-formatting

有时我`\n`在末尾添加一个，以及`\t`开头的相关数字，有时不是 - 推荐的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T20:52:47.487

这取决于您是否希望 HTML 具有人类可读性。然而，在大多数情况下，我建议生成的标记应该始终是人类可读的，因为它使调试变得更加容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T20:53:18.873

我总是包含\n。原因很简单：有时东西不起作用，我希望能够阅读生成的 HTML 以帮助找到问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T20:54:21.710

这取决于您手动调试 HTML 的频率。如果您需要自己查看它，而不仅仅是浏览器，那么一些基本的格式将使生活变得更轻松。如果你确信你永远不需要看它（就像大多数人看起来的那样），那么你就不需要。我倾向于使用基本缩进进行基本格式化 - 但我对这些事情并不乐观（而且我不得不不止一次地查看这些东西，并且很感激我已经完成了基本格式化）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T20:55:44.547

尽管我这样做是出于习惯，但当您拥有像 Firebug 这样的东西时，根本不需要这样做，它可以向您展示 HTML 树的所有漂亮和漂亮。（虽然它确实向您显示了生成的 HTML，而不是原始 HTML ......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T20:56:22.223

我个人包括这样的字符，因为它使初始调试更容易，尽管为您付出了一些额外代码的代价。如果让人类以后能够阅读它是一个目标，请随意。要记住的另一件事是，大多数开发人员工具可能都能够格式化 HTML 以提高可读性。

尝试考虑您现在正在为自己编写代码的人、将来要维护的其他开发人员或查看 html 的人（他们可能不关心格式）。

祝你好运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T20:59:16.863

我通常发现新行比缩进更重要。如果我的目标是调试期间的可读性，那通常足以有效地阅读代码。如果我的目标是其他人会阅读的输出，我有时会尝试为其添加更多样式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T21:03:53.453

无论如何，在调试自动格式化 HTML 和 CSS 时，我倾向于使用 Firebug，所以我不打扰。但是，我已经编写了工具来创建整洁的选项卡式 HTML。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T21:14:14.917

当我只做 HTML 时，我个人包括 HTML 格式（制表符/换行符），但是当我有一个循环或通常使用脚本 (PHP) 生成 HTML 时，我通常不担心 HTML 格式。我有时会这样做，当我最终得到如此大量的 HTML 时，它会变得不可读。

对我来说最重要的部分是速度——在“正确”格式化的 HTML 中，空格和换行符可以是文件大小的 25%。JavaScript 经常被最小化的原因之一。

# css - 处理多个滚动列的最佳方法

> ID：196053
> 
> 赞同：6
> 
> 时间：2008-10-12T20:52:07.830
> 
> 标签：css

我正在开发一个 Web 应用程序，该应用程序在视觉上由包含四列可变高度内容的正文上方的标题组成。设计之神已将其定为固定高度，主要是因为每一列都可能会变得很长，因此（作为设计师）他们想要具有独立滚动条的 iframe。

四个（潜在的）滚动条已经够糟糕了，但是如果整个页面高度固定为高于浏览器窗口，那么它最终会是五个！在这种情况下，“正常”解决方案当然是将整体页面高度固定在 700 像素左右，以使其具有垂直拟合的“最佳机会”，但由于各种原因，我不想这样做'希望是显而易见的。

所以我的问题是：拥有一个填充可用（垂直空间）且每个列都执行相同操作的主体容器的最佳方法是什么？它甚至实用/可能吗？额外的问题：我可以可靠地为列使用 CSS 溢出属性还是需要讨厌的 iframe？我有很多 CSS 经验，但几乎没有使用百分比尺寸（尤其是在与我需要的标题相结合的像素尺寸时）。此外，它必须符合标准并向后兼容 IE6。

TIA。

编辑：我本身并不是在寻找 CSS 布局解决方案，我的问题是如何满足每列成为正文容器中可能的最大高度和可滚动的需要，而不以像素为单位固定正文的高度 - 除非我绝对需要。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-14T16:23:38.433

我很确定这正是您需要的：[Liquid 4 column layout with fixed height banner and footer](http://www.cssplay.co.uk/layouts/body5.html)

没有 iframe，没有 java 脚本，每列自动填充可用高度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T21:03:32.457

你在谈论这样的事情吗？

```
<div id="head"></div>
<div id="body">
  <div id="col1"></div>
  <div id="col2"></div>
  <div id="col3"></div>
  <div id="col4"></div>
</div> 
```

CSS

```
#body { position: absolute; top: 60px /* height of the header */; bottom: 0px; width: 100%;  }
#body div { position: absolute; top:0; bottom:0 ;width: 25% } 
```

这在 IE6 中可能不起作用，您必须使用 JavaScript：

```
window.onResize = function () {
    // Calculate the height of the body, substract the height of the head and apply to all columns
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T21:58:35.683

在回答您的第二个问题时，只需在 CSS 中设置 height 属性，以确保内容永远不会超过您的要求。您*可以*使用 overflow-y: scroll （不是有效的 CSS 但有效）来强制元素上的滚动条。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T14:29:19.617

`DIV`我已经尝试了各种相互嵌套的元素排列，一个设置为`height:100%`另一个`padding:60px`，我无法找到一种方法让内部元素的有效高度为 100%-60px。问题是百分比高度是指`height`包含元素的属性，而不是高度减去边距和填充。叹。

我必须说我希望 CSS 允许将高度表示为百分比、字体相关和像素单位的总和（或差）（如

```
width: 12em - 2px;
border: 1px solid #FED; /* Total width including border is 12em exactly */ 
```

或者

```
width: 25% - 1em;
margin: 1.25em 1em; 
```

等等，比如带有 fil 单位的 TeX）。

我认为您最好的选择可能是使用一些 JavaScript 来检查横幅的高度并将其从视口的高度中减去，然后适当地设置包含列的框的高度。然后，您将找出设计师使用的屏幕尺寸，并在 CSS 文件中设置硬连线默认值以适合他们的显示器。

# visual-studio - 用MFC画滚动条的小问题

> ID：196059
> 
> 赞同：1
> 
> 时间：2008-10-12T20:54:16.517
> 
> 标签：visual-studio, visual-c++, mfc

在 MFC 应用程序中有一个小的矩形区域与滚动条相交（窗口的右下角）。似乎该区域仅在调整框架大小时才失效。在其他情况下（例如，如果另一个窗口被拖动到它上面），该区域不会重新绘制。

我已经能够在新创建的项目中在 VS 6 和 2008 中重现它。我也看到一些商业应用程序有同样的问题。要重新创建它：

1.  使用 CScrollView 派生视图创建一个新的 SDI 项目。
2.  调整窗口大小以显示两个滚动条。
3.  在该矩形上拖动另一个窗口以查看重绘问题。

任何想法如何摆脱这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T04:22:45.083

一种*解决*方法是捕获**CScrollView的****OnPaint**方法，并在此方法中添加代码以始终绘制客户端窗口的底角。

 **但是这个绘画代码还需要调用**GetDC**来获取一个新的**CDC**，这样它就可以绕过**WM_PAINT**消息传入的**BeginPaint** **CDC的剪切区域。**

 **# vb.net - 默认情况下如何启用 Visual Basic.NET 命名空间？

> ID：196068
> 
> 赞同：3
> 
> 时间：2008-10-12T20:59:06.740
> 
> 标签：vb.net, visual-studio-2008

我来自 C# 背景和 Visual Studio。默认情况下显示命名空间，但在 Visual Basic 中不显示。是否可以选择在 Visual Studio 2008 中显示命名空间？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T21:01:30.683

VB.Net 有一个项目默认命名空间的概念。在项目中创建的任何不包含显式命名空间的文件都将包含在默认命名空间中。

如果您不喜欢这种行为，您可以从项目属性页面禁用它（右键单击项目并选择属性）。转到 Application 选项卡并清除 Root Namespace 文本框。这将迫使您为您定义的每种类型提供命名空间。

# java - 什么是组件

> ID：196087
> 
> 赞同：12
> 
> 时间：2008-10-12T21:06:58.067
> 
> 标签：java, .net, object

我听播客 java posse，在这方面经常讨论组件（注意组件不是（显然）对象）。他们感叹 Java 没有组件这一事实，并与有组件的 .NET 形成对比。组件显然使开发应用程序（不仅仅是 GUI 应用程序）更容易。

我可以从讨论中得出一个组件具有的某些特性，它与解耦有关（用一个组件替换另一个组件只是管道问题）。它与属性有关，它肯定与事件和委托有关。

所以对于问题：

./ 任何人都可以向我解释什么是组件。（以及为什么 java bean 不是组件）。

./谁能解释他们如何帮助发展。

./如果它们非常有用，任何人都可以解释为什么java没有它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T21:19:49.570

软件工程电台有一个关于这个主题的插曲： http: [//se-radio.net/podcast/2008-02/episode-87-software-components](http://se-radio.net/podcast/2008-02/episode-87-software-components)

一般的想法是，软件组件可以以元数据的形式描述它自己的依赖项和服务是什么。我不知道为什么您可能听说 Java 没有组件，因为您当然可以想象 Java 中的架构，其中组件确实通过元数据描述自己。我想这只是Java平台定义本身并没有真正的组件架构。

更新：确实，不需要想象这样的架构，因为正如其他人指出的那样，Java Bean 或 Servlet 肯定可以被视为基于组件的架构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T21:23:41.480

术语组件是 OO 中最模糊和过度使用的术语之一。

大多数人都会同意，一个组件是由一组类组成的，它们一起协作以实现一个或多个接口。其中一个类承担“前端”的角色，即它实现接口但将工作委托给组内的其他类。正如您所说，组件应该可以在系统其余部分不知道的情况下更换。

基于组件的架构的一个很好的例子是 COM。这是一个很好的例子，因为它被大量使用和严格指定。但请注意，对这种架构的需求是基于 C++ 编译和部署模型的不灵活性。

在 Java 中，你可以在不破坏与系统其余部分的二进制兼容性的情况下对一个类做很多事情。所以没有那么多需要构建刚性的、基于组件的架构。但这一切都取决于您如何定义该术语，例如，任何使用依赖注入构建的项目都可以算作“基于组件”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-03-17T21:22:04.017

尽管在 Java 之初，组件的概念多次与 Gui 组件相关，但软件工程中组件的一般意义超出了该概念。

简单地说，**组件就是一个可复用的软件**。就像积木一样，我们将它们结合起来构建一个完整的应用程序。现代环境中软件组件的关键洞察力是**元数据**，它**描述了组件的内容并支持重用**。

1996 年，JDK 1.0 是第一个为组件提供元数据的托管运行时环境。在这种情况下，组件是`.class`包含*字节码*和元数据的文件。然而，根据 Java 规范，**一个`.class`文件只包含一个类型定义**。因此，要将一组类型部署为组件，我们可以使用包含多个`.class`文件的 Jar 存档。

另一方面，在.Net 平台中，它提供了相同的可重用组件思想，一个组件可能包含多个类型定义。在这种情况下，组件（在 .Net 中也称为*程序集*）是一个文件`.dll`或一个`.exe`文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T21:47:12.540

这取决于您所说的“组件”是什么意思。该术语在许多不同的上下文中可能意味着许多不同的事物，因此很容易让人感到困惑。话虽如此，这是我对这个主题的理解：

组件不同于对象（尽管对象通常用于表示和构建组件）。区别在于几件事：

1.  对象往往只是“事物”，而组件是演员。不同之处在于组件是过程的一部分，而对象代表某种抽象概念。
2.  组件有助于确保代码重用和可插入性，因为它们基本上是小的“子程序”（或有时本身就是程序），理想情况下可以适应与其他组件一起工作。
3.  您倾向于在[Erlang](http://www.erlang.org)或[Kamaelia](http://www.kamaelia.org)等“无共享”消息传递系统中看到更多组件，主要是因为这些类型的框架往往最适合面向组件的设计。

面向组件的设计有很多很好的例子，但我的首选是 UNIX。UNIX 背后的基本思想是，它更像是一组旨在协同工作的小程序，而不是由几个更单一的程序组成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T22:02:56.223

软件分为几组。这是Java块。

*   声明。
*   方法函数。多个陈述。
*   班级。多个属性和方法函数。
*   文件。一门或多门课。一个类是文件中的公共类，其他类隐藏在文件中。
*   包裹。多个班级。这些构成了一个层次结构。

“组件”、“层”、“层”和其他哲学分组——通常——是概念性的。VB COM 环境对组件有一种形式主义。其他人都将它们视为只是想法。

bean 是类。单个类可以是一个组件吗？也许。一个组件通常是一堆类。有时只有两个——一个正式的接口和一个实现。

组件可帮助您专注于类、包、分组等的逻辑分组。

由于组件是概念性的，因此每种语言或多或少都有它们。组件的语言形式很少。它们并不是真正需要的。这是你用来构建你的思维的想法或原则。

您可以谨慎地定义一种具有接口和元数据以及许多其他功能的“组件”方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T21:25:00.353

我不特别了解 .NET 组件，但从 Java POV 来看，我会说组件是一些功能单元，应该具有定义的接口/使用原则。虽然 Java 没有组件作为语言概念，但 Java 中有 IMHO 组件。技术组件将是例如：

*   EJB
*   小服务程序

功能组件将是例如：

*   应用程序的自动更新
*   支持对数据模型进行计算的公式机制

架构组件可以是 JAR 文件或 OSGi 包。

当然，总有解释的余地​​；）

# c++ - 当作为函数模板的 T* 参数传递时，使用运算符 T* 强制模板类

> ID：196088
> 
> 赞同：0
> 
> 时间：2008-10-12T21:07:01.187
> 
> 标签：c++, templates, coercion

假设我有一个这样的函数模板：

```
template<class T>
inline
void
doStuff(T* arr)
{
  // stuff that needs to use sizeof(T)
} 
```

然后在另一个`.h`文件中，我有一个模板类`Foo`，它具有：

```
public: operator T*() const; 
```

现在，我意识到这些是不同的 T。但是如果我`Foo<Bar> f`在堆栈上有一个变量，将它强制为*任何*类型的指针的唯一方法就是调用`operator T*()`. 然而，如果 call `doStuff(f)`，GCC 会抱怨`doStuff`不能`Foo<Bar>`自动使用运算符`T*()`强制转换`Bar*`，然后使用`Bar`as专门化函数模板`T`。

我可以做些什么来使用两个模板来完成这项工作吗？或者模板函数的参数必须是真正的指针类型，还是带有强制运算符的模板类被传递给非模板函数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T21:39:03.867

海湾合作委员会是正确的。在模板参数中，只考虑完全匹配，不考虑类型转换。这是因为否则可能必须考虑无限（或至少指数）数量的转换。

如果 Foo<T> 是您要运行的唯一其他模板，最好的解决方案是添加：

```
template<typename T> inline void doStuff(const Foo<T>& arr) {
    doStuff(static_cast<T*>(arr));
} 
```

如果您在使用大量模板时遇到此问题，则应该解决此问题：

```
#include <boost/type_traits/is_convertible.hpp>
#include <boost/utility/enable_if.hpp>
template<template <typename> class T, typename U> inline typename boost::enable_if<typename boost::is_convertible<T<U>, U*>::type>::type doStuff(const T<U>& arr) {
    doStuff(static_cast<U*>(arr));
} 
```

虽然有点冗长;-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T21:40:16.860

这可能值得一试：

```
doStuff<Bar>(f); 
```

我认为这将导致编译器期望 T* 为 Bar* 然后使用 Foo 的运算符 T*() 执行强制转换，但我不能说我已经尝试过了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T00:58:34.153

Leon 的想法可能是最好的。但在紧要关头，您也可以显式调用强制转换运算符：

```
doStuff(static_cast<Bar*>(f)); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-12T21:16:29.390

我不确定为什么转换不起作用，但您可以使用重载来解决问题

```
 template 
inline
void 
doStuff(T& arrRef)
{
  doStuff(&arrRef);
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-12T21:24:34.880

好吧，T* 并不是您认为的与 T 不同的类型。指针是一个类型限定符。我不确定标准对此有何评论，但我会说，由于变量已经是 T 类型，它不会尝试再次转换。如果你想做一些自定义的东西来获取指针，重载 & 运算符。

# linux - 以编程方式将击键发送到 GLUT 应用程序

> ID：196090
> 
> 赞同：0
> 
> 时间：2008-10-12T21:07:43.370
> 
> 标签：linux, opengl, automation, glut

我在我的 linux 机器上运行了一个 OpenGL/GLUT 程序，它可以从各个角度查看 3D 模型并可以截取屏幕截图，并且一切都由键盘控制。我想编写一个以特定方式在模型周围移动的脚本，在每一步都截取屏幕截图。在 Linux 中似乎应该有一种简单的方法可以从脚本向该应用程序发送击键。有谁知道怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T21:23:58.470

获取 GLUT 源代码并使其可远程控制。一种方法是删除轮询键盘的函数并让它轮询套接字。将程序与现有程序与新库链接。

之后，您可以建立与现在可远程控制的程序的连接，并通过您的应用程序以编程方式设置键码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T22:00:30.220

您可以将事件注入 X11 窗口。我认为[xnee](http://manpages.ubuntu.com/manpages/hardy/man1/xnee.html)会为您做到这一点。我认为“检查”（使用 Tk 的功能？）也曾经这样做过。

# java - 如何找出一个类定义了哪些枚举？

> ID：196094
> 
> 赞同：3
> 
> 时间：2008-10-12T21:11:26.920
> 
> 标签：java

我知道我可以通过执行以下操作来获取类的公共静态成员：

`obj.getClass().getFields()`

但这并没有让我得到枚举。我希望能够从 getClass 方法返回的 Class 对象中获取它们。有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-12T21:22:22.683

（变成了一个社区维基，因为它看起来有相当大的扩展空间，例如包括 tackline 的评论。当每个人都可以扩展它时，我只是抄写评论是没有意义的。）

您是指嵌套在顶级类中的枚举吗？如果是这样，请使用`[Class.getDeclaredClasses()](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getDeclaredClasses())`并遍历结果，查看是否有任何嵌套类是枚举。测试每个嵌套类的最简单方法是使用`[Class.isEnum()](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#isEnum())`; 如果您想遍历枚举中的值，那么`[Class.getEnumConstants()](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getEnumConstants())`就是要走的路。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T21:25:47.450

obj.getClass().getEnumConstants()

# validation - 文本区域内的 XHTML 和代码

> ID：196097
> 
> 赞同：5
> 
> 时间：2008-10-12T21:12:55.947
> 
> 标签：validation, xhtml

在我的一个使用 textarea 提交的网站上，我的代码可能会出现以下内容：

```
<textarea><p>text</p></textarea> 
```

验证时（XHTML 1.0 过渡），出现此错误，

```
line 88 column 50 - Error: document type does not allow element "p" here 
```

如果这不是一个有效的方法，那么会发生什么？我可以使用 onload JavaScript 事件来解决问题，但这似乎是不必要的。无论如何这不会影响输出，但我宁愿我的网站验证。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T21:16:34.803

你有什么理由试图把一个`<p>`inside `<textarea>`？正如你发现它是无效的。如果是出于显示目的（即显示代码），则应翻译：

```
<textarea>&lt;p&gt;text&lt;/p&gt;</textarea> 
```

除了验证问题之外，允许显示任意标签（如上未正确编码）可能是一个巨大的安全问题。确保任何用户提供的输入在显示之前都经过了适当的清理，这一点至关重要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T22:03:22.460

CDATA 部分是否适合您？

```
<textarea><![CDATA[
    <p>Blah</p>
]]></textarea> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T21:34:46.233

我是否认为您尝试制作所见即所得的编辑器，例如 TinyMCE？大多数似乎做的是在中使用 HTML 实体`textarea`并通过 JavaScript 将其转换为 HTML。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T21:17:35.253

您可以省略文本区域中的标签，当您需要换行时使用 \n 否则使用`&lt;p&gt;`and`&lt;/p&gt;`代替您的标签。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T21:30:14.557

您可以使用 onload 函数来替换 textarea 内容的开始和结束标记。

```
eg: replace < > with &lt; &gt;

<textarea cols="" rows="">&lt;p&gt;text&lt;/p&gt;</textarea> 
```

<p>文字</p>

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T10:20:26.333

您可以在发布的数据上使用此功能

```
function clean_data($value) {
    if (get_magic_quotes_gpc()) { $value = stripslashes($value); }
    $value = addslashes(htmlentities(trim($value)));
    $value = str_replace("\'", "&#39;", $value);
    $value = str_replace("'", "&#39;", $value);
    $value = str_replace(":", "&#58;", $value);
    return $value;
} 
```

# apache-flex - 弹性媒体框架

> ID：196109
> 
> 赞同：1
> 
> 时间：2008-10-12T21:17:48.123
> 
> 标签：apache-flex, frameworks, media

有人知道 Flex 的良好媒体框架吗？
我希望能够创建不仅可以播放 Flex 框架支持的格式，而且还可以播放其他格式（如 wav、wma、ogg 等）的应用程序。

**编辑 13.10.2008.：**最近在答案部分向我指出，我或许应该重新表述这个问题，所以这里是：我真正想要的是一种在 Flex/Air 应用程序中播放各种媒体格式的方法. Onekidney 发布了一个关于 Ogg/Vorbis 的好答案。有人知道播放其他媒体格式的方法吗？现在不要介意到不同平台的可移植性。便携性会很好，但如果我不能得到它，我可以没有它:-)。
感谢您的回答！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T23:22:15.843

Flex 只是一组在 Flash Player 上运行的库。您只能播放 Flash 内置支持的媒体格式，因此您不会找到一些“媒体框架”来增加对更多格式的支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T13:16:45.207

您可能需要更具体地提出您的问题 - 比如，有没有办法在 Flash 中播放 ogg vorbis？

然后我可以回答，地狱是的！就[在这里](http://drawlogic.com/2008/10/04/as3-fvorbis-flash-ogg-vorbis-player/)。

# php - 为什么我在尝试重命名目录时在 PHP 中得到“权限被拒绝”？

> ID：196114
> 
> 赞同：5
> 
> 时间：2008-10-12T21:20:11.113
> 
> 标签：php, permissions, rename

我将目录修改为 777，与目录内容相同。不过，我收到“权限被拒绝”错误。如果 apache 不是组/所有者，无论文件权限如何，PHP 是否会抛出此错误？这是失败的调用：

```
rename('/correct/path/to/dir/1', '/correct/path/to/dir/2'); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T21:23:32.197

您正在编辑更高级别的目录，因此 PHP 用户需要对该目录具有写入权限。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T21:24:38.437

那可能是因为 apache 不是父目录的所有者。重命名（或移动）文件基本上与创建新文件相同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T21:48:30.837

澄清一下，php只能重命名它拥有实际所有权的目录：

```
-rwxrwxrwx user   user   temp/
-rwxr-xr-x apache apache temp2/
-rw-r--r-- user   user   script.php 
```

假设 script.php 正在尝试重命名这两个目录：

```
// this operation fails as PHP (running as apache) does not own "temp",
// despite having write permissions    
rename('temp', 'temp.bak');

// this operation is successful as PHP owns "temp2"
rename('temp2, 'temp.bak'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T22:03:23.833

可能有助于这些情况的另一件事是尝试实际降低权限。我见过 apache 拒绝应用程序权限做某事的情况，因为它的权限设置得*太高*。我的猜测是，这是为了鼓励良好的安全实践。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T21:23:13.727

尝试运行以下脚本：

```
print_r(posix_getpwuid(getmyuid()));
print_r(pathinfo($YOUR_PATH)); 
```

看看会返回什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-18T19:50:30.127

您必须递归地更改文件夹和其中包含的文件的权限。您需要以 root 用户身份从 ssh 执行此操作，然后运行以下命令：

```
chown -R www-data:www-data /directory/path/to/apply/chown 
```

然后您可以毫无问题地执行 chown 语句。

我在研究，测试了几个小时后发现了这种方式。

请记住，文件夹或 root 所有者文件不能被其他用户操作（删除、重命名、移动、更改属性），而 root 可以在任何用户之上执行此操作。

最好的祝福

# sharepoint - SharePoint 找不到我的自定义 RenderingTemplate

> ID：196115
> 
> 赞同：4
> 
> 时间：2008-10-12T21:20:36.290
> 
> 标签：sharepoint, wss, controltemplates

所以我创建了一个自定义 RenderingTemplate 并将其部署到 CONTROLTEMPLATES\MyControlTemplates\

它基本上规定了我创建的自定义内容类型在显示时应该如何呈现。为此，我添加了这个：

```
<FormTemplates xmlns="http://schemas.microsoft.com/sharepoint/v3/contenttype/forms">
  <Display>CustomDispForm</Display>
</FormTemplates> 
```

但是，当 SharePoint 位于 CONTROLTEMPLATES 的子目录中时，SharePoint 找不到我的自定义 RenderingTemplate。但如果我将它移到 CONTROLTEMPLATES\ SharePoint 的根目录下，就会找到它。

根据文档，SharePoint 也应该查看子目录，但情况似乎并非如此。那么这可能是一个错误吗？我想看看我是否遗漏了什么，因为我真的更喜欢将自定义内容放在 root/<Custom> 目录中。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T20:22:02.353

将控件模板放入自定义目录时，我注意到了相同的行为。你是对的，SharePoint 也应该在默认情况下查看子目录（配置文件中的确切位置目前我不知道）但它似乎没有这样做。

我以编程方式加载了我的模板，也许这也是您的选择？您可以在此处找到更多信息：[http ://www.reversealchemy.net/2008/09/01/loading-sharepoint-templates-from-a-different-location/](http://www.reversealchemy.net/2008/09/01/loading-sharepoint-templates-from-a-different-location/)

问候， 埃里克

# operating-system - 除了 malloc/free 程序是否需要操作系统来提供其他任何东西？

> ID：196136
> 
> 赞同：9
> 
> 时间：2008-10-12T21:32:20.370
> 
> 标签：operating-system, kernel, malloc, heap-memory, osdev

我正在为我正在开发的操作系统设计内核（我实际上将其称为“核心”只是为了不同，但它基本相同）。如果我无法启动并运行多任务、内存管理和其他基本功能，那么操作系统本身的细节就无关紧要了，所以我需要先解决这个问题。我有一些关于设计 malloc 例程的问题。

我认为 malloc() 要么是内核本身的一部分（我倾向于这个）要么是程序的一部分，但我将不得不编写自己的 C 标准库的实现方式，所以我开始写一个malloc。在这方面我的问题实际上相当简单，C（或C++）如何管理它的堆？

我在理论课上一直被教导的是，堆是一块不断扩展的内存，从指定的地址开始，并且在很多意义上表现得像一个堆栈。这样，我知道在全局范围内声明的变量在开头，更多的变量在各自的范围内声明时被“推送”到堆上，超出范围的变量只是留在内存空间中，但是该空间被标记为空闲，因此如果需要，堆可以扩展更多。

我需要知道的是，C 究竟如何以这种方式处理动态扩展堆？编译后的 C 程序是否会自己调用 malloc 例程并处理自己的堆，还是需要为它提供自动扩展空间？另外，C 程序如何知道堆的开始位置？

哦，我知道同样的概念也适用于其他语言，但我希望任何示例都使用 C/C++，因为我最熟悉那种语言。我也不想担心堆栈等其他事情，因为我认为我能够自己处理这样的事情。

所以我想我真正的问题是，除了 malloc/free（它自己处理获取和释放页面等）之外，程序是否需要操作系统来提供其他任何东西？

谢谢！

*编辑*我对 C 如何使用与堆相关的 malloc 比对 malloc 例程本身的实际工作更感兴趣。如果有帮助，我会在 x86 上执行此操作，但 C 是交叉编译器，所以没关系。^_^

进一步编辑：我知道我可能会混淆术语。我被告知“堆”是程序存储诸如全局/局部变量之类的东西的地方。我习惯于在汇编编程中处理“堆栈”，我刚刚意识到我可能是这个意思。我的一些研究表明，“堆”更常用来指代程序为自己分配的总内存，或者操作系统提供的内存页的总数（和顺序）。

那么，考虑到这一点，我该如何处理不断扩大的*堆栈*？（看来我的 C 理论课有点……有缺陷。）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-12T22:03:01.730

`malloc`通常在用户空间的 C 运行时中实现，依赖于特定的 OS 系统调用来映射虚拟内存页面。`malloc`和的工作`free`是管理那些大小固定（通常为 4 KB，但有时更大）的内存页面，并将它们分割成应用程序可以使用的片段。

例如，参见[GNU libc](http://www.gnu.org/software/libc/)实现。

如需更简单的实现，请查看去年的[MIT 操作系统课程。](http://pdos.csail.mit.edu/6.828/2007/)具体来说，请参阅[最终的实验室讲义](http://pdos.lcs.mit.edu/6.828/2007/labs/lab6/lab6-handout.tar.gz)，并查看`lib/malloc.c`. 这段代码使用了课堂上开发的操作系统JOS。它的工作方式是读取页表（由操作系统以只读方式提供），寻找未映射的虚拟地址范围。然后它使用`sys_page_alloc`和`sys_page_unmap`系统调用将页面映射和取消映射到当前进程。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-12T21:40:18.420

有多种方法可以解决这个问题。

大多数情况下，C 程序都有自己的 malloc/free 功能。那个适用于小物体。最初（一旦内存耗尽）内存管理器将向操作系统请求更多内存。执行此操作的传统方法是 unix 变体上的 mmap 和 sbrk（Win32 上的 GlobalAlloc / LocalAlloc）。

我建议您从内存提供者（例如操作系统）的角度看一下[Doug Lea 内存分配器（谷歌：dlmalloc）。](http://g.oswego.edu/dl/html/malloc.html)该分配器在一个非常好的分配器中是一流的，并且具有所有主要操作系统的挂钩。如果您想知道高性能分配器对操作系统的期望，那么这是您的首选代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T22:17:23.417

您是否混淆了堆和堆栈？

我问是因为您提到了“一块不断扩展的内存”、作用域和在声明时将变量推送到堆上。这听起来确实像是您实际上在谈论堆栈。

在最常见的 C 实现中，自动变量的声明如

诠释我;

通常会导致 i 被分配到堆栈上。通常 malloc 不会参与，除非您明确调用它，或者您进行的某些库调用会调用它。

我建议查看 Peter Van Der Linden 的“Expert C Programming”，了解 C 程序通常如何与堆栈和堆一起工作的背景知识。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T23:50:04.447

必读：Knuth - Art of Computer Programming，第 1 卷，第 2 章，第 2.5 节。否则，您可以阅读 Kernighan & Ritchie “The C Programming Language” 来查看实现；或者，您可以阅读 Plauger "The Standard C Library" 来查看另一个实现。

我相信你需要在你的核心内做的事情会与核心外的程序看到的有所不同。特别是，程序的内核内存分配将处理虚拟内存等，而代码之外的程序只是看到内核提供的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T05:38:28.533

阅读有关虚拟内存管理（分页）的信息。它是高度特定于 CPU 的，每个操作系统都专门为每个受支持的 CPU 实施 VM 管理。如果您正在为 x86/amd64 编写操作系统，请阅读它们各自的手册。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T21:38:04.120

通常，C 库根据需要处理`malloc`从操作系统请求内存（通过匿名`mmap`或在旧系统中`sbrk`）的实现。因此，您的内核方面应该通过类似其中一种方式来处理分配整个页面。

然后`malloc`以一种不会过多地分割空闲内存的方式分配内存。*不过，我对这件事*的细节并不太熟悉；但是，我想到了*竞技场一词。*如果我能找到参考，我会更新这篇文章。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-14T06:40:36.803

危险危险！！如果您甚至考虑尝试内核开发，您应该非常清楚您的资源*成本*及其相对有限的可用性......

关于递归的一件事是它非常昂贵（至少在内核领域），您不会看到许多函数被编写为简单地继续运行，否则您的内核会恐慌。

为了强调我的观点，（在 stackoverflow.com 上，呵呵），请查看[NT Debugging 博客](http://blogs.msdn.com/ntdebugging/archive/2008/02/01/kernel-stack-overflows.aspx)中关于内核堆栈溢出的这篇文章，特别是，

> · 在基于 x86 的平台上，内核模式堆栈为**12K**。
> 
> · 在基于 x64 的平台上，内核模式堆栈为**24K**。（基于 x64 的平台包括具有使用 AMD64 架构的处理器和使用 Intel EM64T 架构的处理器的系统）。
> 
> · 在基于 Itanium 的平台上，内核模式堆栈为**32K**，带有**32K** 后备存储。

真的，不是很多。

> ## *普通嫌疑犯*
> 
> * * *
> 
> # 1\. 自由使用堆栈。
> 
> # 2.递归调用函数。

如果您稍微阅读一下该博客，您会发现内核开发对于一组相当独特的问题是多么困难。你的理论课没有错，很简单，很简单。;)

从理论出发 -> 内核开发与*上下文*切换一样重要（也许在混合中保存一些管理程序交互！！）。

无论如何，永远不要假设、验证和测试你的期望。

# sql-server - 有没有办法可以在 sql server 2005 中检索 sa 密码

> ID：196150
> 
> 赞同：6
> 
> 时间：2008-10-12T21:39:02.463
> 
> 标签：sql-server, sql-server-2005, passwords

我只是忘记密码了。谁能帮我找回密码。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-12T21:41:15.923

没有办法找回旧密码。使用集成身份验证以机器或域管理员身份登录 SQL Server 管理控制台，然后您可以更改任何密码（包括 sa）。

再次启动 SQL 服务并使用新创建的登录名（在我的示例中为恢复）通过安全面板转到属性并更改 SA 帐户的密码。

![在此处输入图像描述](https://i.stack.imgur.com/6LttD.png)

现在记下新的 SA 密码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-28T11:23:13.620

等待！

有一种方法可以使用蛮力攻击来检索密码，请查看 codeproject 中的以下工具 [Retrieve SQL Server Password](http://www.codeproject.com/KB/vbscript/SQLServerPasswords.aspx)

* * *

## 如何使用工具找回密码

要检索 SQL Server 用户的密码，请在 SQL 查询分析器中运行以下查询

"Select Password from SysxLogins Where Name = 'XXXX'" 其中 XXXX 是用户

您要检索密码的名称。复制密码字段（哈希代码）和

粘贴到此处（在哈希代码字段中）并单击开始按钮以检索

***我检查了 SQLServer 2000 上的工具，它工作正常。***

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-07T16:21:14.387

如果您在服务器上具有管理 Windows 权限，另一个选项是使用启动参数“-m”以单用户模式启动 SQL Server。这样做，您可以使用 SQLCMD 登录，创建一个新用户并赋予它系统管理员权限。最后，您必须禁用单用户模式，使用新用户登录 SSMS，然后转到安全/登录并更改“sa”用户密码。

您可以查看这篇文章：http: [//v-consult.be/2011/05/26/recover-sa-password-microsoft-sql-server-2008-r2/](http://v-consult.be/2011/05/26/recover-sa-password-microsoft-sql-server-2008-r2/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-02T08:46:08.553

MSSQL 有自己的数据库管理工具，称为“MSSQL Server Management Studio (SSMS)”。以下是使用 SSMS 重置 SA 密码的步骤：

1]打开SSMS管理控制台，会提示输入认证细节，

选择服务器类型：“数据库引擎”，服务器名称：您的 MSSQL 服务器的 IP / 主机名身份验证：Windows 身份验证

将身份验证类型选择为“Windows 身份验证”后，用户名和密码字段将显示为灰色，您无需输入登录详细信息即可登录 SQL Server。仅当您登录到存在 SQL 服务的 RDP 中的同一台服务器时，Windows 身份验证才可行。

2] 进入后，在“对象资源管理器”下展开安全性，然后登录 3] 找到并右键单击用户 SA 并选择属性 4] 在常规部分下，在“密码：”和“确认密码：”前面输入所需的密码5]点击底部的OK。

这是重置 SA 密码而不是使用任何第三方非安全工具的最简单和安全的方法

# java - Sun 错误数据库中的 Java 版本名称

> ID：196170
> 
> 赞同：2
> 
> 时间：2008-10-12T21:52:00.660
> 
> 标签：java

在 [http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6525150](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6525150) 它说 Release Fixed 7(b14), 6u2(b01) (Bug ID:2147561)

6u2 是什么意思？（我假设它是正确的 1.6.0_02 吗？）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T21:54:05.070

是的，发布 6 更新 2。另外，(b01) 是 build 01

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T21:54:41.497

是的。你说的对。:) u2 -> 更新 2

# oracle - Oracle 10gr2：防止任何日期落在星期天？

> ID：196171
> 
> 赞同：1
> 
> 时间：2008-10-12T21:52:43.170
> 
> 标签：oracle, constraints

是否可以使用 CHECK 约束来防止任何日期落在星期日？我不想使用触发器。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T22:05:51.550

是的，检查约束可以检查星期几不是星期日。这是一个例子：

```
create table date_test (entry_date date);

alter table date_test add constraint day_is_not_sunday
      check ( to_char(entry_date,'DAY','NLS_DATE_LANGUAGE = ENGLISH') not like 'SUNDAY%'); 
```

-- SUNDAY 右边有空格，所以需要 like 或 rtrim 来匹配字符串。

```
insert into date_test values(to_date('2008-10-12','YYYY-MM-DD')); --Sunday
insert into date_test values(to_date('2008-10-11','YYYY-MM-DD'));
insert into date_test values(to_date('2008-10-10','YYYY-MM-DD'));
insert into date_test values(to_date('2008-10-09','YYYY-MM-DD'));
insert into date_test values(to_date('2008-10-08','YYYY-MM-DD'));
insert into date_test values(to_date('2008-10-07','YYYY-MM-DD'));
insert into date_test values(to_date('2008-10-06','YYYY-MM-DD')); 
```

当您尝试插入星期天的日期时，它会说：
`ORA-02290: check constraint (SYS.DAY_IS_NOT_SUNDAY) violated`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T22:03:00.077

不确定实际的约束，但您可以使用该功能：

```
TO_CHAR(sysdate, 'D'); 
```

以整数形式获取星期几，然后对其进行小检查

# user-interface - 如何使控件/元素随惯性移动？

> ID：196173
> 
> 赞同：9
> 
> 时间：2008-10-12T21:52:49.113
> 
> 标签：user-interface, look-and-feel

现代 UI 开始在移动时赋予其 UI 元素很好的惯性。选项卡滑入、页面转换，甚至一些列表框和滚动元素对它们都有很好的惯性（例如 iphone）。什么是最好的算法？当它们加速时，不仅仅是重力，然后在它们落位时减速。我尝试了各种公式来加速到最大（终端）速度然后放慢速度，但我没有尝试过“感觉”正确。总感觉有点不对劲。是否有一个标准，或者只是玩各种数字直到它看起来/感觉正确？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-12T22:18:14.817

你在这里谈论两个不同的事情。

一个是动量——当你从拖拽中释放它们时，赋予它们剩余的运动。这只是关于在用户释放物体时记住物体的速度，然后将该速度应用于每一帧的对象，并将每帧的速度降低一定量。如何降低每一帧的速度是您尝试获得正确感觉的方法。

另一件事是缓入和缓出动画。这是关于当您在两个位置之间移动对象时平滑地加速/减速对象，而不仅仅是线性插值。为此，您只需通过 sigmoid 函数输入“时间”值，然后再使用它在两个位置之间插入对象。一个这样的功能是

```
smoothstep(t) = 3*t*t - 2*t*t*t    [0 <= t <= 1] 
```

这为您提供了缓入和缓出行为。但是，您通常只会看到 GUI 中使用的缓出。也就是说，物体开始快速移动，然后缓慢地停在它们的最终位置。为此，您只需使用曲线的右半部分，即。

```
smoothstep_eo(t) = 2*smoothstep((t+1)/2) - 1 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-12T22:41:36.177

Mike F 明白了：您应用时间-位置函数来计算对象相对于时间的位置（不要乱用速度；它仅在您试图找出要使用的算法时才有用。 )

[Robert Penner 的缓动方程和演示](http://www.robertpenner.com/easing/easing_demo.html)非常棒；就像[jQuery 演示](http://gsgd.co.uk/sandbox/jquery/easing/)一样，它们直观地展示了缓动的样子，但它们还为您提供了位置时间图，让您了解其背后的方程式。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T22:52:43.157

您正在寻找的是[插值](http://en.wikipedia.org/wiki/Interpolation)。粗略地说，有些函数从 0 到 1 不等，当缩放和平移时会产生漂亮的运动。这在 Flash 中经常使用，并且有大量示例：（注意：在 Flash 中，插值取名为“补间”，最流行的插值类型称为“缓动”。）

看看这个以获得对运动类型的直观感受： [SparkTable: Visualize Easing Equations](http://www.gskinner.com/blog/archives/2008/05/sparktable_visu.html)。

当应用于运动、缩放、旋转和其他动画时，这些方程可以给人一种动量、摩擦、弹跳或弹性的感觉。有关应用于动画的示例，请查看[Robert Penners 缓动演示](http://www.robertpenner.com/easing/easing_demo.html)。他是最流行的一系列动画函数的作者（我相信Adobe的内置函数都是基于他的）。这种类型的过渡同样适用于 alpha（用于淡入）。

用法有一点方法。easeInOut 开始缓慢，加速和减速。easeOut 开始快并减速（如摩擦），easeIn 开始缓慢并加速（如动量）。根据您想要的感觉选择合适的。然后根据效果强度在 Sine、Expo、Quad 等之间进行选择。其他的很容易通过他们的名字来计算（例如 Bounce 弹跳，Back 走得更远，然后像弹性一样回来）。

这是一个来自流行的 AS3 [Tweener 库的方程的链接。](http://code.google.com/p/tweener/source/browse/trunk/as3/caurina/transitions/Equations.as)您应该能够用 JavaScript（或任何其他语言）轻松地重写这些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T21:56:38.030

它在玩数字。感觉好的就是好的。

多年来，我一直试图自己开发魔法公式。最后，丑陋的黑客总是感觉最好。只要确保你以某种方式正确地计时你的动画，不要依赖某种重绘/刷新率。这些往往会根据操作系统而变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T21:58:31.253

我也不是这方面的专家，但我相信他们是用二次公式完成的，当给定正确的参数时，开始时快或慢，并在接近结束时急剧增加或减少，直到达到某个点。

# c# - LINQ to SQL InsertOnSubmit() 是否受到 SQL 注入攻击？

> ID：196177
> 
> 赞同：0
> 
> 时间：2008-10-12T21:56:05.847
> 
> 标签：c#, .net, linq-to-sql, sql-injection

我有这样的代码：

```
var newMsg = new Msg
{
    Var1 = var1,
    Var2 = var2
};

using (AppDataContext appDataContext = new AppDataContext(ConnectionString))
{
    appDataContext.CClass.InsertOnSubmit(newMsg);
    appDataContext.SubmitChanges();
} 
```

读完[这篇文章后](https://stackoverflow.com/questions/157924/does-linqs-executecommand-provide-protection-from-sql-injection-attacks)，我相信同样的逻辑也适用。

有人认为这会受到 SQL 注入攻击吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T22:04:12.663

您引用的帖子中的第二个答案说：

> LINQ to SQL 使用带参数的*execute_sql 。*

它不会将属性值连接到一个大的 INSERT ... VALUES('...', '...')

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T23:39:55.793

DataContext 的底层操作是通过使用参数化 SQL 的 SqlCommand。

因此，您的插入语句将如下所示：

```
INSERT INTO [MSG] [Var1] = @p1, [Var2] = @p2 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T22:53:40.083

不，但无论如何您都应该验证用户数据。

# grammar - 转变减少冲突

> ID：196179
> 
> 赞同：10
> 
> 时间：2008-10-12T21:58:09.740
> 
> 标签：grammar, conflict, gppg

我在理解我知道没有歧义的语法的移位/减少冲突时遇到问题。该案例是 if else 类型之一，但它不是“悬空 else”问题，因为我有强制 END 子句分隔代码块。

这是 gppg 的语法（它是一个类似于 Bison 的编译器编译器......这不是回声）：

```
%output=program.cs

%start program

%token FOR
%token END
%token THINGS
%token WHILE
%token SET
%token IF
%token ELSEIF
%token ELSE
%%

program : statements
        ;

statements : /*empty */
           | statements stmt
           ;

stmt : flow
     | THINGS
     ;

flow : '#' IF '(' ')' statements else
     ;

else : '#' END
     | '#' ELSE statements '#' END
     | elseifs
     ;

elseifs : elseifs '#' ELSEIF statements else
        | '#' ELSEIF statements else
        ; 
```

这是冲突输出：

```
// Parser Conflict Information for grammar file "program.y"

Shift/Reduce conflict on symbol "'#'", parser will shift
 Reduce 10: else -> elseifs
 Shift "'#'":   State-22 -> State-23
  Items for From-state State 22
    10 else: elseifs .
    -lookahead: '#', THINGS, EOF
    11 elseifs: elseifs . '#' ELSEIF statements else 
  Items for Next-state State 23
    11 elseifs: elseifs '#' . ELSEIF statements else 

// End conflict information for parser 
```

我已经切换了所有内容，并且我确实知道如何解决它，但是该解决方案涉及放弃“elseif”上的左递归以进行右递归。

我已经浏览了我在互联网上找到的关于这个问题的所有稀缺文档（我在最后发布了一些链接），但仍然没有找到一个优雅的解决方案。我知道 ANTLR，我现在不想考虑它。请将您的解决方案限制为 Yacc/Bison 解析器。

我会很欣赏优雅的解决方案，我设法通过消除 /* empty */ 规则和复制所有需要空列表的内容来做到这一点，但在我正在研究的更大的语法中，它最终就像“意大利面条语法综合症”一样。

以下是一些链接：

[http://nitsan.org/~maratb/cs164/bison.html](http://nitsan.org/~maratb/cs164/bison.html)

[http://compilers.iecc.com/comparch/article/98-01-079](http://compilers.iecc.com/comparch/article/98-01-079)

[GPPG，我正在使用的解析器](http://plas.fit.qut.edu.au/gppg/)

[野牛手册](http://www.gnu.org/software/bison/manual/index.html)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-12T23:39:21.253

您修改后的 ELSEIF 规则没有条件标记 - 它名义上应该添加了 '(' 和 ')'。

更严重的是，你现在有一个规则

```
elsebody : else
         | elseifs else
         ; 
```

和

```
elseifs : /* Nothing */
        | elseifs ...something... 
        ; 
```

不需要“无”；它由没有“elseifs”的“elsebody”隐含地照顾。

我非常倾向于使用规则“opt_elseifs”、“opt_else”和“end”：

```
flow : '#' IF '(' ')' statements opt_elseifs opt_else end
     ;

opt_elseifs : /* Nothing */
            | opt_elseifs '#' ELSIF '(' ')' statements 
            ;

opt_else : /* Nothing */
         | '#' ELSE statements
         ;

end : '#' END
    ; 
```

我没有通过解析器生成器运行它，但我发现这相对容易理解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T22:10:20.403

我认为问题出在 elseifs 子句中。

```
elseifs : elseifs '#' ELSEIF statements else
        | '#' ELSEIF statements else
        ; 
```

我认为第一个版本不是必需的，因为 else 子句无论如何都引用 elseifs：

```
else : '#' END
     | '#' ELSE statements '#' END
     | elseifs
     ; 
```

如果你改变 elseifs 会发生什么？：

```
elseifs : '#' ELSEIF statements else
        ; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T00:40:04.190

上面乔纳森的答案似乎是最好的，但由于它不适合你，我有一些建议你可以尝试，这将帮助你调试错误。

首先，您是否考虑过将哈希/锐符号作为令牌本身的一部分（即#END、#IF 等）？这样它们就会被词法分析器取出，这意味着它们不必包含在解析器中。

其次，我会敦促您在不复制任何令牌流的情况下重写规则。（不要重复自己原则的一部分。）所以规则“'#' ELSEIF statements else”应该只存在于该文件中的一个位置（而不是上面的两个）。

最后，我建议您研究 IF/ELSEIF/ELSE 标记的优先级和关联性。我知道你应该能够编写一个不需要这个的解析器，但在这种情况下它可能是你需要的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T22:42:20.730

我仍在切换事情，我最初的问题有一些错误，因为**elseifs**序列最后有一个**else** allways 是错误的。这是对这个问题的另一种看法，这次我遇到了两个班次/减少冲突：

```
flow : '#' IF '(' ')' statements elsebody 
     ;

elsebody : else 
         | elseifs else
         ;

else : '#' ELSE statements '#' END
     | '#' END
     ;

elseifs : /* empty */
        | elseifs '#' ELSEIF statements
        ; 
```

现在的冲突是：

```
// Parser Conflict Information for grammar file "program.y"

Shift/Reduce conflict on symbol "'#'", parser will shift
 Reduce 12: elseifs -> /* empty */
 Shift "'#'":   State-10 -> State-13
  Items for From-state State 10
    7 flow: '#' IF '(' ')' statements . elsebody 
    4 statements: statements . stmt 
  Items for Next-state State 13
    10 else: '#' . ELSE statements '#' END 
    11 else: '#' . END 
    7 flow: '#' . IF '(' ')' statements elsebody 

Shift/Reduce conflict on symbol "'#'", parser will shift
 Reduce 13: elseifs -> elseifs, '#', ELSEIF, statements
 Shift "'#'":   State-24 -> State-6
  Items for From-state State 24
    13 elseifs: elseifs '#' ELSEIF statements .
    -lookahead: '#'
    4 statements: statements . stmt 
  Items for Next-state State 6
    7 flow: '#' . IF '(' ')' statements elsebody 

// End conflict information for parser 
```

空的规则只会加剧我害怕的 gppg。但它们看起来很自然，我一直在尝试。

我已经知道正确的递归解决了*1800 INFORMATION*所说的问题。但我正在寻找一个在**elseifs 子句上使用****左递归**的解决方案。

 *** * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T23:43:57.813

```
elsebody : elseifs else
         | elseifs
         ;

elseifs : /* empty */
        | elseifs '#' ELSEIF statements
        ;

else : '#' ELSE statements '#' END
     ; 
```

我认为这应该离开递归并始终终止。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T04:10:25.183

好的 - 这是 if 块的语法（不是最小的）。我从我拥有的一些代码中挖掘出来（称为 adhoc，基于 Kernighan & Plauger 的“The UNIX Programming Environment”中的 hoc）。此大纲语法与 Yacc 一起编译，没有冲突。

```
%token  NUMBER IF ELSE
%token  ELIF END
%token  THEN
%start program

%%

program
    :   stmtlist
    ;

stmtlist
    :   /* Nothing */
    |   stmtlist stmt
    ;

stmt
    :   ifstmt
    ;

ifstmt
    :   ifcond endif
    |   ifcond else begin
    |   ifcond eliflist begin
    ;

ifcond
    :   ifstart cond then stmtlist
    ;

ifstart
    :   IF
    ;

cond
    :   '(' expr ')'
    ;

then
    :   /* Nothing */
    |   THEN
    ;

endif
    :   END IF begin
    ;

else
    :   ELSE stmtlist END IF
    ;

eliflist
    :   elifblock
    |   elifcond eliflist begin         /* RIGHT RECURSION */
    ;

elifblock
    :   elifcond else begin
    |   elifcond endif
    ;

elifcond
    :   elif cond then stmtlist end
    ;

elif
    :   ELIF
    ;

begin
    :   /* Nothing */
    ;

end
    :   /* Nothing */
    ;

expr
    :   NUMBER
    ;

%% 
```

我使用“NUMBER”作为虚拟元素，而不是 THINGS，我使用 ELIF 而不是 ELSEIF。它包括一个 THEN，但这是可选的。“开始”和“结束”操作用于在生成的程序中获取程序计数器 - 因此应该可以从中删除而不影响它。

我认为我需要使用右递归而不是正常的左递归是有原因的——但我认为这与我使用的代码生成策略有关，而不是其他任何东西。评论中的问号在原文中；我记得我对此并不满意。该计划作为一个整体确实有效 - 这是一个在过去十年左右一直处于搁置状态的项目（嗯......我在 2004 年底和 2005 年初做了一些工作；在此之前，它是 1992 年和 1993 年）。

我没有花时间弄清楚为什么编译时没有冲突，而我之前概述的却没有。我希望它有所帮助。

# html - 从ajax更新页面时如何避免闪烁

> ID：196203
> 
> 赞同：5
> 
> 时间：2008-10-12T22:11:49.230
> 
> 标签：html, ajax

我有一个带有标题的表格，一个带有输入字段的行，一个带有数据的行。[像这样。http://brow.hu/sitegen/stackoverflow_table_example.png](http://brow.hu/sitegen/stackoverflow_table_example.png)

如果有人在输入字段中输入内容，我想使用 ajax 查询过滤数据。收到新表后，我更改了旧表的内容： `div.innerHTML = req.responseText;`它会闪烁。如何避免这种情况？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T22:58:14.393

避免闪烁的一种方法称为双缓冲。在 Ajax 中，这可以简单地通过 2 个 div 占据相同的空间来完成，其中一个样式为“display: none”，另一个为“display: inline”。始终写入不可见的，然后交换显示样式。如果 div 有绝对的定位和大小，绝对没有闪烁的机会，即使没有，也很难做得更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T22:40:20.233

它会闪烁，因为您正在完全替换表……如果您在现有表中添加行或删除行，然后将 AJAX 数据加载到结果表中，它不会闪烁。

# struts - eclipse上的struts设置示例应用程序

> ID：196216
> 
> 赞同：1
> 
> 时间：2008-10-12T22:27:03.007
> 
> 标签：struts, sample

我是 strut/web 编程的新手，我认为通过阅读示例应用程序可以学到很多东西。在 google 上，我在 [http://www.roseindia.net/struts/struts2/struts2tutorial.zip](http://www.roseindia.net/struts/struts2/struts2tutorial.zip)搜索并找到了一个示例应用程序，该教程非常好，它提供了一个示例登录页面。

但是，我无法运行此示例应用程序。我尝试在roseindia.net 网站上发帖，但也没有得到任何帮助。

在服务器启动期间没有记录错误，但是当我尝试打开 helloworld 的链接之一时，输出以下内容

我收到此错误

> 严重：找不到操作或结果没有为操作名称 HelloWorld 映射的操作。- [未知位置]

我的eclipse上这个东西的文件夹结构是

```
/WebContent/WEB-INF/java/net/roseindia/Struts2HelloWorld.java
/WebContent/pages/HelloWorld.jsp
/WebContent/WEB-INF/struts.xml 
```

而在 strut.xml 中，样本有..

```
 <action name="HelloWorld" class="net.roseindia.Struts2HelloWorld">
        <result>/pages/HelloWorld.jsp</result>
    </action> 
```

我怀疑 strut.xml 中的某些内容是错误的？我正在使用 eclipse J2EE 和 tomcat6，我已经尝试在 roseindia 的网站上发帖，但没有得到任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T23:11:17.533

通过阅读示例应用程序，您将学到很多东西。如果您的样品不起作用，那么您的样品可能是错误的。

也许您需要实际的权威文档。请参阅[如何使用 Eclipse 设置基本的 struts 项目](http://struts.apache.org/1.2.4/faqs/eclipse.html)。这是与任何 Eclipse - Struts 文档一样正式的文档。

也许你需要一个更好的例子。请参阅 Struts 社区[项目和示例](http://struts.sourceforge.net/community/examples.html)网站以获取大量示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-28T18:41:16.843

I had the same issue in Eclipse and solved it by changing the output folder of the source folder to:

```
WebContent/WEB-INF/classes 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T23:37:39.400

您将文件命名为“strut.xml”还是“struts.xml”？它应该是后者（尽管您可以根据需要覆盖它）。此外，在 Struts 2 中，struts.xml 文件必须在类路径中，而不是在 WEB-INF 的根目录中。因此，在您的项目中，您应该放入“src”文件夹，以便在部署时进入 WEB-INF/classes。您可以通过将 Web 应用程序“导出”到 WAR 文件并验证它是否进入 WEB-INF/classes 来验证它是否进入了正确的位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-06T21:07:56.633

我刚刚下载了本教程的副本，并将其部署到了 Tomcat 6 中——它可以工作了！

也许自从您上次尝试以来他们已经修复了该错误？或者您配置 Eclipse 的方式可能有问题。

我所做的只是解压缩教程；将目录复制到Tomcat webapps目录中；启动Tomcat；导航到我 PC 上的 Tomcat 管理器页面；并单击指向 struts2tutorial 应用程序的链接。

再试一次...

# python - MySQLdb 执行超时

> ID：196217
> 
> 赞同：2
> 
> 时间：2008-10-12T22:27:58.167
> 
> 标签：python, mysql, timeout

有时在我们的生产环境中，服务（即使用 MySQLdb 的 python 程序）和 mysql 服务器之间的连接不稳定，一些包丢失，一些黑魔法发生并且 MySQLdb.Cursor 对象的 .execute() 永远不会结束（或采取大量的时间结束）。

这非常糟糕，因为它浪费了服务工作线程。有时它会导致工人池耗尽，服务完全停止响应。

所以问题是：有没有办法在给定的时间后中断 MySQLdb.Connection.execute 操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T23:45:47.060

如果通信存在这样的问题，请考虑编写一个“代理”，通过不稳定的连接接收您的 SQL 命令，并通过可靠的通道将它们中继到 MySQL 服务器（可能与 MySQL 服务器在同一个盒子上运行）。这样您就可以完全控制故障检测和重试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T06:57:13.600

您需要准确分析问题所在。如果服务器不存在，MySQL 连接最终应该会超时；TCP keepalives 通常是启用的。您也许可以调整操作系统级别的 TCP 超时。

如果数据库“不稳定”，那么您肯定需要调查如何。数据库似乎不太可能真的是问题，更有可能是两者之间的网络问题。

如果您正在使用（某些）任何类型的状态防火墙，它们可能会丢失一些状态，从而导致原本良好的长期连接失效。

您可能需要考虑更改 MySQL 中的空闲超时参数；否则，长期未使用的连接可能会“过时”，服务器和客户端都认为它还活着，但中间的一些有状态的网络元素已经“忘记”了 TCP 连接。尝试使用这种“陈旧”连接的应用程序在收到错误之前将等待很长时间（但最终应该如此）。

# java - Java Servlet API 会话处理中的自定义 ID

> ID：196221
> 
> 赞同：3
> 
> 时间：2008-10-12T22:33:31.310
> 
> 标签：java, session, web-applications, servlets

是否可以通过 Servlet API 为 HTTP 会话分配自定义 ID？

我知道来自任何应用程序服务器的会话处理，例如 Tomcat，生成唯一 ID 就足够了。但我有基于每个用户和时间的信息的自定义唯一会话 ID，因此不会重复。

我查看了所有关于会话处理的文档，但没有找到我需要的东西。

这是一个项目的要求，所以如果不可能，我需要知道原因（或者它只是不能通过 API 获得？）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T02:01:33.010

If you are using Tomcat, you may be able to create a custom session manager (see [this discussion](http://markmail.org/message/im3wkoeskkgjaphv#query:tomcat%20custom%20session%20Manager+page:1+mid:lgl2bdm26avvjx37+state:results)). You would then have access to the Tomcat [Session](http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/Session.html) object and could call setId.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T00:27:46.320

servlet API 不支持创建您自己的 cookie 值。事实上，它不保证会话是通过 cookie 维护的……它特别指出它们可以通过诸如“URL 重写”之类的机制来维护。它确实保证会话以某种方式维护，并且几乎需要某种唯一 ID，该 ID 被传递给浏览器并返回，但是 Servlet API 中没有为 servlet 代码提供控制使用什么值的机制。我所知道的常见 servlet 容器（例如 Tomcat）也没有提供控制此值的方法。

但是，如果我正确理解您的要求，这对您来说都不是问题。仅仅因为 Tomcat（或您使用的任何 servlet 容器）正在根据其自己的算法创建一个唯一 ID（其中包含诸如加密安全随机数生成器之类的东西，以防止会话 ID 的“猜测”），并不意味着您不能创建一个满足您要求的单独 ID（基于用户和时间，在所有会话中唯一......无论您需要什么）。此 ID 可以存储在会话中（如果这就是您所需要的），也可以存储在浏览器中的单独 cookie 中（如果您需要跨会话维护它）。唯一的影响是浏览器存储了两个 cookie——大多数网站存储的 cookie 比这多得多！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T00:12:47.160

嗯...如果您有生成唯一 ID 的代码，您可以这样做：

```
/** 
 * The String key of the user id attribute.
 */
public static final String USER_ID_KEY = "userIdKey";

// Set the user attribute (createUniqueUserId's parameters and return type are up to you)
httpSession.setAttribute(USER_ID_KEY, createUniqueUserId());

// Retrieve the user attribute later
httpSession.getAttribute(USER_ID_KEY); 
```

HttpSession 接口还提供了一个 getId() 方法，这里有文档说明[（](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/http/HttpSession.html#getId())复制文档供参考）：

> 公共 java.lang.String getId()
> 
> 返回一个字符串，其中包含分配给此会话的唯一标识符。标识符由 servlet 容器分配，并且依赖于实现。
> 
> 返回： 指定分配给此会话的标识符的字符串

# javascript - 组合由多个组件呈现的不同 javascript 对象

> ID：196224
> 
> 赞同：0
> 
> 时间：2008-10-12T22:37:25.013
> 
> 标签：javascript, jsf

我有一个从服务器端渲染器编写/生成 javascript 的组件。该组件可以在同一页面中多次使用。但是，一旦页面被加载，我必须收集页面中这个多个组件编写的所有变量或 JSO。我怎样才能做到这一点，以便我将拥有所有变量或 JSO 的集合？例如，如果这个组件（比如说）在页面中使用了两次，那么它会在客户端/浏览器上发出两个 javascript 块 - var arr1 = new Array['First', 'Second'] 和 var arr2 = new Array['Third' ， '第四']。

为了进行最终渲染，我必须组合这两个数组。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T23:18:24.807

您需要更具体地了解您的问题，也许有一个示例页面，但这里有一些想法。

如果您有一个在页面生成期间编写 JavaScript 的服务器端组件，我每次都会生成一个函数调用，例如：

```
Component_appendArray(['First', 'Second']);
...
Component_appendArray(['Third', 'Fourth']); 
```

然后确保您`Component_appendArray()`在这些调用之前定义了您的函数：

```
var globalArray = [];
function Component_appendArray(array)
{
     globalArray = globalArray.concat(array);
} 
```

最后，`globalArray`应包含：

```
['First', 'Second', 'Third', 'Fourth'] 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T23:28:35.877

虽然我不了解整个场景，但我建议如果您在整个 HTML 中打印出变量以便在页面加载后使用它们，那么您应该使用隐藏的输入字段。我经常看到这种情况，其中变量用于将值传递给页面底部的函数或脚本，但使用隐藏输入字段的值可以让您将所有脚本移出内容区域。它提供了一个更清洁的解决方案。

# security - 安全访问由环境变量标识的目录中的文件？

> ID：196244
> 
> 赞同：3
> 
> 时间：2008-10-12T23:02:09.800
> 
> 标签：security, unix, environment-variables, setuid

任何人都可以指出一些通过环境变量（部分）指定的路径处理文件访问安全性的代码，特别是对于 Unix 及其变体，但 Windows 解决方案也很有趣？

*这是一个很长的问题-我不确定它是否适合 SO 范式。*

考虑这种情况：

**背景：**

*   软件包 PQR 可以安装在用户选择的位置。
*   环境变量 $PQRHOME 用于标识安装目录。
*   默认情况下，$PQRHOME 下的所有程序和文件都属于一个特殊的组 pqrgrp。
*   同样，$PQRHOME 下的所有程序和文件要么属于特殊用户 pqrusr，要么属于用户 root（这些是 SUID 根程序）。
*   一些程序是 SUID pqrusr；还有几个程序是 SGID pqrgrp。
*   大多数目录归pqrusr所有，属于pqrgrp；有些可以属于其他组，并且这些组的成员获得使用该软件的额外权限。
*   许多特权可执行文件必须由不是 pqrgrp 成员的人运行；程序必须通过不直接涉及此问题的神秘规则验证是否允许用户运行它。
*   启动后，一些特权程序必须保留其提升的特权，因为它们是长期运行的守护程序，可能在其生命周期内代表许多用户进行操作。
*   由于各种神秘的原因，这些程序无权将目录更改为 $PQRHOME。

**当前检查：**

*   程序当前检查 $PQRHOME 及其下的关键目录是否“安全”（由 pqrusr 拥有，属于 pqrgrp，没有公共写访问权限）。
*   此后，程序通过环境变量的完整值访问 $PQRHOME 下的文件。
*   特别是，G11N 和 L10N 是通过访问“安全”目录中的文件，并使用从 $PQRHOME 派生的完整路径名加上已知的子结构（例如，$PQRHOME/g11n/en_us/messages.l10n）。

假设 $PQRHOME 的“已安装”值为 /opt/pqr。

**已知攻击：**

*   攻击者设置 PQRHOME=/home/attacker/pqr。
*   这实际上是 /opt/pqr 的符号链接，因此当其中一个 PQR 程序称为 pqr-victim 检查目录时，它具有正确的权限。
*   安全检查成功完成后，攻击者立即更改符号链接，使其指向/home/attacker/bogus-pqr，这显然在攻击者的控制之下。
*   当 pqr-victim 现在访问所谓的安全目录下的文件时，可怕的事情就会发生。

**鉴于 PQR 目前的行为与描述的一样，并且是一个大型程序包（数百万行代码，十多年来针对各种编码标准开发，无论如何这些标准经常被忽略），您将使用什么技术来修复问题？**

*已知的选项包括：*

1.  更改所有格式化调用以使用根据格式字符串检查实际参数的函数，并使用一个额外的参数指示传递给函数的实际类型。（这很棘手，并且由于要更改的格式操作数量众多，因此可能容易出错 - 但如果检查功能本身是合理的，则效果很好。）
2.  建立到 PQRHOME 的直接路径并验证它的安全性（详细信息如下），如果它不安全，则拒绝启动，然后使用直接路径而不是 $PQRHOME 的值（当它们不同时）。（这要求所有使用 $PQRHOME 的文件操作不使用来自 getenv() 的值，而是使用映射路径。例如，这将要求软件确定 /home/attacker/pqr 是 /opt/pqr 的符号链接， /opt/pqr 的路径是安全的，此后，每当文件被引用为 $PQRHOME/some/thing 时，使用的名称将是 /opt/pqr/some/thing 而不是 /home/attacker/pqr/some /thing。这是一个大型代码库 - 修复起来并不简单。）
3.  确保 $PQRHOME 上的所有目录，甚至通过符号链接进行跟踪，都是安全的（再次详细说明如下），如果有任何不安全的地方，软件将拒绝启动。
4.  硬编码软件安装位置的路径。（这对 PQR 不起作用；如果不出意外的话，它会使测试变得很糟糕。对于用户来说，这意味着他们只能安装一个版本，并且升级等需要并行运行。这不适用于 PQR。）

*安全路径的建议标准：*

*   对于每个目录，必须信任所有者。（*理由：所有者可以随时更改权限，因此必须信任所有者不要随意更改破坏软件的安全性。*）
*   对于每个目录，该组必须没有写入权限（因此该组的成员不能修改目录内容）或者该组必须是受信任的。（*理由：如果组成员可以修改目录，那么他们可以破坏软件的安全性，因此他们必须无法更改它，或者必须信任他们不会更改它。*）
*   对于每个目录，“其他人”必须对该目录没有写权限。
*   默认情况下，可以信任用户 root、bin、sys 和 pqrusr（其中 bin 和 sys 存在）。
*   默认情况下，可以信任 GID=0（也称为 root、wheel 或 system）、bin、sys 和 pqrgrp 的组。此外，拥有根目录的组（在 MacOS X 上称为 admin）是可以信任的。

POSIX 函数`realpath()`提供映射服务，将 /home/attacker/pqr 映射到 /opt/pqr；它不进行安全检查，但只需要在已解析的路径上进行。

**那么，以所有这些为背景，是否有任何已知的软件通过模糊相关的回转来确保其安全性？这是不是太偏执了？（如果是这样，为什么 - 你真的确定吗？）**

*编辑：*

感谢您的各种评论。

@S.Lott：攻击（在问题中概述）意味着可以使至少一个 setuid 根程序使用（非特权）用户选择的格式字符串，并且至少可以使程序崩溃，因此很可能可以获得一个根壳。幸运的是，它需要本地 shell 访问；这不是远程攻击。它需要大量的知识才能到达那里，但我认为假设专业知识不“在那里”是不明智的。

所以，我所描述的是一个“格式字符串漏洞”，已知的攻击路径涉及伪造程序，因此尽管它认为它正在访问安全的消息文件，但它实际上会使用消息文件（其中包含格式字符串）受用户控制，不受软件控制。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T23:24:00.270

`$PQRHOME`如果您在解析其真实路径并检查其安全性后写入新值，则选项 2 有效。这样一来，您的代码几乎不需要更改。

就保持 setuid 权限而言，如果您可以进行某种权限分离会有所帮助，以便涉及来自真实用户的输入的任何操作在真实 uid 下运行。然后特权进程和 real-uid 进程使用 a`socketpair`或类似的东西进行交谈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T19:29:21.180

好吧，这**听起来很**偏执，但是否如此取决于您的应用程序在哪个系统上运行以及攻击者可以造成哪些损害。

因此，如果您的用户群可能是敌对的，并且损坏可能非常高，我会选择选项 4，但进行如下修改以消除其缺点。

让我引用两个相关的事情：

1)

> 程序当前检查 $PQRHOME 及其下的关键目录是否“安全”（由 pqrusr 拥有，属于 pqrgrp，没有公共写访问权限）。

2)

> 此后，程序通过环境变量的完整值访问 $PQRHOME 下的文件。

您实际上不需要硬编码完整路径，您可以仅硬编码从 1) 中提到的“程序”到 2) 中提到的文件所在路径的相对路径。

要控制的问题：

a）您必须确保在可执行文件的路径和文件的路径之间没有任何“攻击者可访问”（例如，在符号链接方面）

b）您必须确保可执行文件以可靠的方式检查自己的路径，但这在我所知道的所有 Unix 中都不应该是一个问题（但我不知道所有的 'em 并且我不知道 windows完全）。

* * *

在第三条评论后编辑：

如果您的操作系统支持 /proc，则 syslink /proc/${pid}/exe 是解决问题的最佳方法 b)

* * *

睡后编辑：

安装是一个“安全”的过程吗？如果是这样，您可以（在安装时）创建一个包装脚本。该脚本应该是可执行的但不可写（并且可能既不可读）。它会将 $PQRHOME 环境变量设置为“安全”值，然后调用您的实际程序（它最终也可能会做其他有用的事情）。由于在 UNIX 中，除了正在运行的进程之外，其他任何东西都**不能**更改正在运行的进程的环境变量，因此您是安全的（当然，父进程*可以*在进程启动**之前更改环境变量）。**不过，我不知道这种方法是否适用于 Windows。

# oracle - Oracle 或 DB2 - 谁是商业领域的市场领导者？

> ID：196247
> 
> 赞同：1
> 
> 时间：2008-10-12T23:02:54.290
> 
> 标签：oracle, db2

这两个数据库中哪一个在商业/行业中最受欢迎？我之所以这样问，是因为就直接收入或市场份额而言，我怀疑它们大约是 50-50，因为美国政府对 DB2 很重视。那么，除了政府、军队和学术界，哪个数据库供应商在业务领域的份额最大？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T18:29:47.600

“谎言，该死的谎言和统计数据”。作为一个 DB2 人，我很容易接受。但是，如果您相信来自 Gartner 和其他顾问的统计数据，Oracle 在收入方面领先于 DB2。我认为没有人真正估计过服务器安装的数量，我也不打算这样做，但我可以告诉您，我们的[DB2 Express-C](http://www.ibm.com/db2/express/download.html?S_TACT=LKFREE002&S_CMP=ECDDWW01)产品取得了巨大的成功。这是一个真正的 DB2，但它是免费提供的，也就是说，您不必向 IBM 付费就可以将它用于开发、生产甚至重新分发。您可以以极低的年费（2,995 美元/服务器）获得可选支持和额外功能。这与 MySQL Enterprise 相同。实际上，它便宜 4 美元 :-)

由于您在比较 DB2 和 Oracle，我想我会在我的[http://FreeDB2.com](http://FreeDB2.com)博客上指导您比较 DB2 Express-C 和[Oracle XE 。](http://freedb2.com/2008/06/19/comparing-free-databases-oracle-xe-vs-db2-express-c/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T23:57:54.383

有关来自[Gartner](http://www.gartner.com/)的最新新闻稿，请参见[此处](http://www.sqlmanager.net/en/news/sql/1189)

# asp.net - LINQ to SQL - 您的 DataContext 位于何处？

> ID：196253
> 
> 赞同：26
> 
> 时间：2008-10-12T23:05:36.783
> 
> 标签：asp.net, linq-to-sql

我在数据访问对象库中使用 LINQ to SQL。该库用于 Web（Web 应用程序/Web 服务）和非 Web（Windows 服务）上下文。最初，我将其存储`DataContext`在 current 上，`HttpContext`因为它允许我管理相当小的工作单元（一个 Web 请求）并避免 Web 应用程序中的全局对象。显然，这在 Windows 服务中不起作用。

Rick Strahl 有一篇关于管理`DataContext`生命周期的好文章：[http](http://www.west-wind.com/weblog/posts/246222.aspx) ://www.west-wind.com/weblog/posts/246222.aspx 。不幸的是，我无法决定最好的方法。由于他提到的原因，全局`DataContext`不起作用，每个线程`DataContext`似乎很复杂，并且可能比它的价值更麻烦，并且每个对象实例似乎很挑剔 - 当你将`DataContext`用于创建的对象附加`DAO`到它时你会失去一些优雅，`DAO`所以它可以`update`或`delete`以后-更不用说，这种关系有些令人不快。

有没有人有个人经验表明一种方法比另一种更好？或者更好的是，有没有人有我没有看到的第四种或第五种方法？在哪里存储和管理您的`DataContext`.

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-12T23:14:18.310

我建议遵循[MSDN 文档中关于 DataContext 类](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.aspx)的指南：

> 通常，DataContext 实例旨在持续一个“工作单元”，但是您的应用程序定义了该术语。DataContext 是轻量级的，创建起来并不昂贵。典型的 LINQ to SQL 应用程序在方法范围内创建 DataContext 实例，或者将其作为表示一组相关数据库操作的逻辑集的短期类的成员。

因为`DataContext`is ，我发现在一个方法中的语句中`IDisposable`创建和使用 a 最容易，因此可以正确处理它。`DataContext``using`

另请注意，“不保证任何实例成员都是线程安全的”，因此`DataContext`在多个线程之间共享一个是不明智的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T01:07:45.443

依赖注入。

我们更愿意让我们的业务层不了解 Web 和非 Web 场景。相反，业务逻辑层对象在其构造函数中采用 DataContext 引用，这（显式）允许共享 DataContext 并且（隐式）允许从查询结果共享实体对象，因为它们都来自相同的数据上下文。

DataContexts 还实现了 IDisposable，因此您确实需要管理它们的生命周期。我们所有的 Web 表单都有一个基类，其中一部分是 datacontext 属性（延迟创建）。这样一来，页面上的所有内容都*可以*共享它，这是最常见的情况。上下文在页面的 OnUnload() 事件中手动处理。

* * *

*   您不应该混合来自不同数据上下文的 linq 实体，如果数据上下文已被 Dispose() 处理，则使用 linq 实体通常会遇到麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T23:15:49.773

我正在使用每线程上下文。设置起来很棘手，但它清理了需要与数据库通信的所有内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T23:37:53.817

我在 Web 场景中使用 httpcontext 并在其他所有内容中使用线程上下文。我们构建了一个小框架，以便将数据上下文完全从表示/业务层抽象出来。

# java - Java SE 与 Java EE，大学和职业

> ID：196265
> 
> 赞同：5
> 
> 时间：2008-10-12T23:15:09.850
> 
> 标签：java, jakarta-ee

我目前在大学学习计算机科学，他们主要教授 Java 标准版，我看到在业界使用的不多，而是使用 Java EE。如果我的大学教我 Java SE 而不是 Java EE，这是否会降低我的就业率？

究竟有什么区别？不同的语法？不同的编程方式还是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-13T00:58:07.367

出于所有意图和目的，Java 和 Java SE 是一回事。当您说您正在学习 Java SE 时，这意味着您正在学习 Java、它的语法、特性和标准库。在学习这些技能之前，您无法学习 Java EE。

Java EE 是一组标准，它定义了许多不同的接口和特性，用于构建软件以解决企业级问题。其中包括事务、分布式计算、消息传递、Web 应用程序和资源管理等。所有这些都在托管环境中提供。所有这些都是用 Java 语言编码的，由于软件运行的环境而具有特定的规则和特征。

将学习 Java SE 视为学习驾驶汽车。Java EE 就像学习驾驶 18 轮车，您不需要知道如何从 A 到 B，但如果您必须随身携带 10 吨货物，它肯定会有所帮助 8-)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T23:32:36.230

Java SE 包含标准 Java 库：所有基础、容器、网络、GUI 等。它主要用于桌面应用程序和浏览器小程序。

Java EE 添加了一个服务器框架。当您在服务器中谈论 Java 时，这就是您所指的。这是一个*巨大*的图书馆，有很多很多预先建立的“最佳实践”。在 JIT 还很年轻的时候，Java EE 的高度可扩展设计使它在服务器中非常受欢迎，除了 JVM 的（当时显着的）开销。

我还没有真正使用过 Java EE。但我认为最好先学习Java SE，然后再学习Java EE。这需要更多时间；但可以让你更好地理解什么是语言，什么是框架。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-22T20:45:18.147

> 如果我的大学教我 Java SE 而不是 Java EE，这是否会降低我的就业率？

不，这就是你的大学应该做的：专注于基础。在 Java 的情况下，这主要是指标准版本。

Java EE（*不是*J2EE；请参阅我在问题中的评论）添加了一些服务器端 Java API、规范和库。其中最重要的是[Servlet](http://en.wikipedia.org/wiki/Java_Servlet) API 和[JSP](http://en.wikipedia.org/wiki/JavaServer_Pages)容器规范。但我认为重要的是要知道，即使在服务器端，它仍然主要是关于标准 Java！很有可能您无需学习大多数 Java EE 技术（例如 Enterprise Java Beans (EJB)）就可以进行服务器端 Java 开发，尤其是随着替代的轻量级方法的兴起，例如支持[POJO](http://en.wikipedia.org/wiki/POJO)和[Hibernate](http://www.hibernate.org/)用于持久层。Java EE 的许多部分（如 EJB）肯定早已过了炒作周期的顶峰。您甚至可能不需要完全了解所有“低级” Servlet 和 JSP 内容，因为诸如[Struts](http://struts.apache.org/)、[JSF](http://java.sun.com/javaee/javaserverfaces/)或[Wicket](http://wicket.apache.org/)等高级框架已经变得流行起来。

一个案例研究：我在大学里学习了 Java（和 OO 编程）的基础知识——而关于企业版的知识很少（而且没有任何实际意义）*。*现在我已经作为“Java EE 开发人员”工作了 4 到 5 周，也就是说，做服务器端 Java。我从未真正使用过 EJB 或大多数其他 Java EE 技术。我主要做的是纯Java（即标准版），其中包含一些JSP、Servlet、过滤器等相关的东西（当然还有HTML、JS、CSS等网络技术）；利用*大量*（主要是开源的）第 3 方库，并根据需要获取所有内容。（但是，我计划复习我对 Java EE 的了解，并在某个时候[参加 SCWCD](https://stackoverflow.com/questions/498889/is-the-scwcd-still-worthwhile-and-if-so-how-to-prepare) ——我认为即使 Java SE 有很长的路要走，那也会对我有好处 :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T19:57:28.667

这就是我的看法。

您所知道的编程语言称为 Java。

与大多数其他编程语言一样，它也捆绑了许多标准库。

Java SE 是语言和某些库的结合，使一般应用程序开发成为可能。

Java EE 是另一组库，您可以将其与 Java SE 结合使用来开发企业/Web 应用程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T00:28:42.870

在我看来，大学的真正意义在于教你在基础知识和概念上变得强大，而不一定是教你在工作中需要的确切技能。所以最重要的是，我建议您确保您正在学习企业应用程序需求中的概念（例如事务、消息传递队列/主题等......）但是，如果这真的是您关心的问题，我建议您这样做自学（可能获得课程学分）。另外，试着找一个实习，让你玩一些 Java EE 代码。

当我快要大学毕业时，我也在问自己同样的问题。我现在在 Java EE 环境中工作，并且有一些学习曲线来使用 Java EE 库。我必须同意许多其他人的观点，并说与我从事的其他项目相比，进行企业 Java 开发并不是很有趣，所以你可能想在大学里继续玩得开心，把无聊的事情推迟到你参与的时候的劳动力。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T20:25:37.180

来自[维基百科](http://en.wikipedia.org/wiki/Java_Platform,_Enterprise_Edition)：

> Java 平台（企业版）与 Java 标准版平台 (Java SE) 的不同之处在于它添加了库，这些库提供了部署容错、分布式、多层 Java 软件的功能，主要基于在应用程序服务器上运行的模块化组件.

语法是一样的。你学到的有关 Java SE 的一切都将适用于 Java EE。它只是添加了一堆新的 API，并要求一种非常适合特定类型问题的应用程序设计风格。这类问题（大型、容错、分布式、可扩展、多层……）以及如何解决这些问题才是 Java EE 的真正意义所在，而不是碰巧成为规范一部分的实际 API。

请记住，CS 学位不是职业学位。它旨在教您如何学习和思考，而不是培训您为特定行业利基量身定制的特定技能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T23:30:24.097

Java 语言本身就是 Java 开发的一个方面。使用标准版构建的应用程序可以满足某些需求。如果您只知道标准版，则认为您可以使用企业版“随手拍”，这是一种误解。图书馆创造了语言。尽管 Java EE 的某些方面有其（当之无愧的）批评者，但其中仍有大量功能。即使是有问题的零件仍然在该行业中大量使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T23:18:19.690

Java EE 只是 Java SE（企业库，如 servlet）的超集。学习 Java SE，你最了解 Java EE。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T20:43:00.650

我认为您误解了 Java SE（或“Core Java）”和 Java EE 的关系。

核心 Java 对学习很重要，也是大多数学校都会教给你的。

由于编程围绕使用轮子而不是重新发明轮子进行，因此通常有一些库包含用于完成复杂任务的代码。

例如，一些学校教人们使用随 Java 提供的 AWT 或 Swing 类库来构建 GUI，尽管还有其他选择。

Java EE 虽然由额外的软件支持以在服务器上运行程序，但可以更多地被认为是类和相关服务的库。您仍然不断地使用 Java，您只需使用一个流行且受 Sun 支持的库。您还将看到不属于 Java EE 的 Hibernate 和 Spring。

大多数地方首先要确保您的 Java 是可靠的。当您开始工作时，您将获得使用 Java EE 特定部分的经验。

# c# - 什么是 catamorphism，它可以在 C# 3.0 中实现吗？

> ID：196294
> 
> 赞同：27
> 
> 时间：2008-10-12T23:33:39.877
> 
> 标签：c#, f#, functional-programming, catamorphism, recursion-schemes

我正在尝试了解 catamorphisms，我已经阅读[了 Wikipedia 文章](http://en.wikipedia.org/wiki/Catamorphism)以及*Inside F#*博客上的F [# 主题系列中的前几篇文章。](http://lorgonblog.spaces.live.com/Blog/cns!701679AD17B6D310!256.entry)

 *我知道这是折叠的概括（即，将许多值的结构映射到一个值，包括将值列表映射到另一个列表）。我认为 fold-list 和 fold-tree 是一个典型的例子。

可以使用 LINQ 的`Aggregate`运算符或其他一些高阶方法在 C# 中完成吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-13T01:06:37.070

LINQ`Aggregate()`仅适用于`IEnumerables`. Catamorphisms 通常是指任意数据类型的折叠模式。（下）对`Aggregate()`（下）`IEnumerables`也是如此；两者都是它们各自数据类型的变态。`FoldTree``Trees`

我将[本系列第 4](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!248.entry)部分中的一些代码翻译成 C#。代码如下。请注意，等效的 F# 使用三个小于字符（用于泛型类型参数注释），而此 C# 代码使用超过 60 个。这就是为什么没有人在 C# 中编写此类代码的证据 - 类型注释太多。我提供代码以防它帮助了解 C# 但不了解 F# 的人玩这个。但是 C# 中的代码非常密集，很难理解。

给定二叉树的以下定义：

```
using System;
using System.Collections.Generic;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Shapes;

class Tree<T>   // use null for Leaf
{
    public T Data { get; private set; }
    public Tree<T> Left { get; private set; }
    public Tree<T> Right { get; private set; }
    public Tree(T data, Tree<T> left, Tree<T> rright)
    {
        this.Data = data;
        this.Left = left;
        this.Right = right;
    }

    public static Tree<T> Node<T>(T data, Tree<T> left, Tree<T> right)
    {
        return new Tree<T>(data, left, right);
    }
} 
```

可以折叠树，例如测量两棵树是否有不同的节点：

```
class Tree
{
    public static Tree<int> Tree7 =
        Node(4, Node(2, Node(1, null, null), Node(3, null, null)),
                Node(6, Node(5, null, null), Node(7, null, null)));

    public static R XFoldTree<A, R>(Func<A, R, R, Tree<A>, R> nodeF, Func<Tree<A>, R> leafV, Tree<A> tree)
    {
        return Loop(nodeF, leafV, tree, x => x);
    }

    public static R Loop<A, R>(Func<A, R, R, Tree<A>, R> nodeF, Func<Tree<A>, R> leafV, Tree<A> t, Func<R, R> cont)
    {
        if (t == null)
            return cont(leafV(t));
        else
            return Loop(nodeF, leafV, t.Left, lacc =>
                   Loop(nodeF, leafV, t.Right, racc =>
                   cont(nodeF(t.Data, lacc, racc, t))));
    }

    public static R FoldTree<A, R>(Func<A, R, R, R> nodeF, R leafV, Tree<A> tree)
    {
        return XFoldTree((x, l, r, _) => nodeF(x, l, r), _ => leafV, tree);
    }

    public static Func<Tree<A>, Tree<A>> XNode<A>(A x, Tree<A> l, Tree<A> r)
    {
        return (Tree<A> t) => x.Equals(t.Data) && l == t.Left && r == t.Right ? t : Node(x, l, r);
    }

    // DiffTree: Tree<'a> * Tree<'a> -> Tree<'a * bool> 
    // return second tree with extra bool 
    // the bool signifies whether the Node "ReferenceEquals" the first tree 
    public static Tree<KeyValuePair<A, bool>> DiffTree<A>(Tree<A> tree, Tree<A> tree2)
    {
        return XFoldTree((A x, Func<Tree<A>, Tree<KeyValuePair<A, bool>>> l, Func<Tree<A>, Tree<KeyValuePair<A, bool>>> r, Tree<A> t) => (Tree<A> t2) =>
            Node(new KeyValuePair<A, bool>(t2.Data, object.ReferenceEquals(t, t2)),
                 l(t2.Left), r(t2.Right)),
            x => y => null, tree)(tree2);
    }
} 
```

在第二个示例中，另一棵树的重建方式不同：

```
class Example
{
    // original version recreates entire tree, yuck 
    public static Tree<int> Change5to0(Tree<int> tree)
    {
        return Tree.FoldTree((int x, Tree<int> l, Tree<int> r) => Tree.Node(x == 5 ? 0 : x, l, r), null, tree);
    }

    // here it is with XFold - same as original, only with Xs 
    public static Tree<int> XChange5to0(Tree<int> tree)
    {
        return Tree.XFoldTree((int x, Tree<int> l, Tree<int> r, Tree<int> orig) =>
            Tree.XNode(x == 5 ? 0 : x, l, r)(orig), _ => null, tree);
    }
} 
```

在第三个示例中，折叠一棵树用于绘图：

```
class MyWPFWindow : Window 
{
    void Draw(Canvas canvas, Tree<KeyValuePair<int, bool>> tree)
    {
        // assumes canvas is normalized to 1.0 x 1.0 
        Tree.FoldTree((KeyValuePair<int, bool> kvp, Func<Transform, Transform> l, Func<Transform, Transform> r) => trans =>
        {
            // current node in top half, centered left-to-right 
            var tb = new TextBox();
            tb.Width = 100.0; 
            tb.Height = 100.0;
            tb.FontSize = 70.0;
                // the tree is a "diff tree" where the bool represents 
                // "ReferenceEquals" differences, so color diffs Red 
            tb.Foreground = (kvp.Value ? Brushes.Black : Brushes.Red);
            tb.HorizontalContentAlignment = HorizontalAlignment.Center;
            tb.VerticalContentAlignment = VerticalAlignment.Center;
            tb.RenderTransform = AddT(trans, TranslateT(0.25, 0.0, ScaleT(0.005, 0.005, new TransformGroup())));
            tb.Text = kvp.Key.ToString();
            canvas.Children.Add(tb);
            // left child in bottom-left quadrant 
            l(AddT(trans, TranslateT(0.0, 0.5, ScaleT(0.5, 0.5, new TransformGroup()))));
            // right child in bottom-right quadrant 
            r(AddT(trans, TranslateT(0.5, 0.5, ScaleT(0.5, 0.5, new TransformGroup()))));
            return null;
        }, _ => null, tree)(new TransformGroup());
    }

    public MyWPFWindow(Tree<KeyValuePair<int, bool>> tree)
    {
        var canvas = new Canvas();
        canvas.Width=1.0;
        canvas.Height=1.0;
        canvas.Background = Brushes.Blue;
        canvas.LayoutTransform=new ScaleTransform(200.0, 200.0);
        Draw(canvas, tree);
        this.Content = canvas;
        this.Title = "MyWPFWindow";
        this.SizeToContent = SizeToContent.WidthAndHeight;
    }
    TransformGroup AddT(Transform t, TransformGroup tg) { tg.Children.Add(t); return tg; }
    TransformGroup ScaleT(double x, double y, TransformGroup tg) { tg.Children.Add(new ScaleTransform(x,y)); return tg; }
    TransformGroup TranslateT(double x, double y, TransformGroup tg) { tg.Children.Add(new TranslateTransform(x,y)); return tg; }

    [STAThread]
    static void Main(string[] args)
    {
        var app = new Application();
        //app.Run(new MyWPFWindow(Tree.DiffTree(Tree.Tree7,Example.Change5to0(Tree.Tree7))));
        app.Run(new MyWPFWindow(Tree.DiffTree(Tree.Tree7, Example.XChange5to0(Tree.Tree7))));
    }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T23:47:41.190

我一直在做更多的阅读，包括一篇关于[使用 catamorphisms ("bananas") 进行函数式编程](http://research.microsoft.com/~emeijer/Papers/fpca91.pdf)的 Micorosft 研究论文，似乎***catamorphism***只是指任何接受列表并通常将其分解为单个值的函数 ( `IEnumerable<A> => B`)，像`Max()`,`Min()`和一般情况下 ,`Aggregate()`都将是列表的变态。

我以前的印象是它引用了一种创建可以概括不同折叠的函数的方法，以便它可以折叠树*和*列表。实际上可能仍然存在这样的事情，可能是某种*函子*或*箭头*，但现在这超出了我的理解水平。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-01-13T23:03:53.800

布赖恩在第一段的回答是正确的。但他的代码示例并没有真正反映如何以 C# 风格解决类似问题。考虑一个简单的类`node`：

```
class Node {
  public Node Left;
  public Node Right;
  public int value;
  public Node(int v = 0, Node left = null, Node right = null) {
    value = v;
    Left = left;
    Right = right;
  }
} 
```

有了这个，我们可以在 main 中创建一个树：

```
var Tree = 
    new Node(4,
      new Node(2, 
        new Node(1),
        new Node(3)
      ),
      new Node(6,
        new Node(5),
        new Node(7)
      )
    ); 
```

我们在 的命名空间中定义了一个通用的 fold 函数`Node`：

```
public static R fold<R>(
  Func<int, R, R, R> combine,
  R leaf_value,
  Node tree) {

  if (tree == null) return leaf_value;

  return 
    combine(
      tree.value, 
      fold(combine, leaf_value, tree.Left),
      fold(combine, leaf_value, tree.Right)
    );
} 
```

对于catamorphisms，我们应该指定数据的状态，节点可以是空的，或者有孩子。通用参数决定了我们在这两种情况下做什么。请注意，迭代策略（在本例中为递归）隐藏在 fold 函数中。

现在而不是写：

```
public static int Sum_Tree(Node tree){
  if (tree == null) return 0;
  var accumulated = tree.value;
  accumulated += Sum_Tree(tree.Left);
  accumulated += Sum_Tree(tree.Right);
  return accumulated; 
} 
```

我们可以写

```
public static int sum_tree_fold(Node tree) {
  return Node.fold(
    (x, l, r) => x + l + r,
    0,
    tree
  );
} 
```

优雅，简单，类型检查，可维护等。易于使用`Console.WriteLine(Node.Sum_Tree(Tree));`。

添加新功能很容易：

```
public static List<int> In_Order_fold(Node tree) {
  return Node.fold(
    (x, l, r) => {
      var tree_list = new List<int>();
      tree_list.Add(x);
      tree_list.InsertRange(0, l);
      tree_list.AddRange(r);
      return tree_list;
    },
    new List<int>(),
    tree
  );
}
public static int Height_fold(Node tree) {
  return Node.fold(
    (x, l, r) => 1 + Math.Max(l, r),
    0,
    tree
  );
} 
```

F# 在简洁性类别中胜出，`In_Order_fold`但当该语言提供用于构造和使用列表的专用运算符时，这是意料之中的。

C# 和 F# 之间的巨大差异似乎是由于 F# 使用闭包作为隐式数据结构来触发尾调用优化。Brian 的答案中的示例还考虑了 F# 中的优化，以避开重建树。我不确定 C# 是否支持尾调用优化，也许`In_Order_fold`可以写得更好，但是在讨论 C# 在处理这些 Catamorphisms 时的表现力时，这些点都不相关。

在语言之间翻译代码时，您需要了解该技术的核心思想，然后根据语言的原语来实现该思想。

也许现在您可以说服您的 C# 同事更认真地对待折叠。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-28T12:08:49.897

> 我知道这是折叠的概括（即，将许多值的结构映射到一个值，包括将值列表映射到另一个列表）。

我不会说一个值。它将它映射到另一个结构。

也许一个例子会澄清。让我们说一个列表的总和。

折叠 (\x -> \y -> x + y) 0 [1,2,3,4,5]

现在这将减少到 15。但实际上，它可以被视为映射到一个纯语法结构 1 + 2 + 3 + 4 + 5 + 0。只是编程语言（在上面的例子中，haskell）知道如何将上述句法结构减少到 15。

基本上，变态将一个数据构造函数替换为另一个数据构造函数。在上述列表的情况下，

[1,2,3,4,5] = 1:2:3:4:5:[] （: 是 cons 运算符，[] 是 nil 元素）上面的变态替换 : 用 + 和 [] 用 0 .

它可以推广到任何递归数据类型。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-20T17:03:23.853

布赖恩在他的博客中有很多很棒的帖子。Channel9 也有一个[不错的视频](https://channel9.msdn.com/Shows/Going+Deep/C9-Lectures-Dr-Ralf-Lmmel-Going-Bananas)。.Aggregate() 没有 LINQ 语法糖，所以它是否具有 LINQ Aggregate 方法的定义是否重要？想法当然是一样的。折叠树...首先我们需要一个节点...也许可以使用元组，但这更清楚：

```
public class Node<TData, TLeft, TRight>
{
    public TLeft Left { get; private set; }
    public TRight Right { get; private set; }
    public TData Data { get; private set; }
    public Node(TData x, TLeft l, TRight r){ Data = x; Left = l; Right = r; }
} 
```

然后，在 C# 中我们*可以*创建一个递归类型，即使这很不寻常：

```
public class Tree<T> : Node</* data: */ T, /* left: */ Tree<T>, /* right: */ Tree<T>>
{
    // Normal node:
    public Tree(T data, Tree<T> left, Tree<T> right): base(data, left, right){}
    // No children:
    public Tree(T data) : base(data, null, null) { }
} 
```

现在，我将引用 Brian 的一些代码，稍作 LINQ 风格的修改：

1.  在 C# 中，折叠称为聚合
2.  LINQ 方法是将项目作为第一个参数并带有“this”关键字的扩展方法。
3.  循环可以是私有的

...

```
public static class TreeExtensions
{
    private static R Loop<A, R>(Func<A, R, R, Tree<A>, R> nodeF, Func<Tree<A>, R> leafV, Tree<A> t, Func<R, R> cont)
    {
        if (t == null) return cont(leafV(t));
        return Loop(nodeF, leafV, t.Left, lacc =>
                Loop(nodeF, leafV, t.Right, racc =>
                cont(nodeF(t.Data, lacc, racc, t))));
    }    
    public static R XAggregateTree<A, R>(this Tree<A> tree, Func<A, R, R, Tree<A>, R> nodeF, Func<Tree<A>, R> leafV)
    {
        return Loop(nodeF, leafV, tree, x => x);
    }

    public static R Aggregate<A, R>(this Tree<A> tree, Func<A, R, R, R> nodeF, R leafV)
    {
        return tree.XAggregateTree((x, l, r, _) => nodeF(x, l, r), _ => leafV);
    }
} 
```

现在，用法很像 C# 风格：

```
[TestMethod] // or Console Application:
static void Main(string[] args)
{
    // This is our tree:
    //     4 
    //  2     6 
    // 1 3   5 7 
    var tree7 = new Tree<int>(4, new Tree<int>(2, new Tree<int>(1), new Tree<int>(3)),
                            new Tree<int>(6, new Tree<int>(5), new Tree<int>(7)));

    var sumTree = tree7.Aggregate((x, l, r) => x + l + r, 0);
    Console.WriteLine(sumTree); // 28
    Console.ReadLine();

    var inOrder = tree7.Aggregate((x, l, r) =>
        {
            var tmp = new List<int>(l) {x};
            tmp.AddRange(r);
            return tmp;
        }, new List<int>());
    inOrder.ForEach(Console.WriteLine); // 1 2 3 4 5 6 7
    Console.ReadLine();

    var heightTree = tree7.Aggregate((_, l, r) => 1 + (l>r?l:r), 0);
    Console.WriteLine(heightTree); // 3
    Console.ReadLine();
} 
```

我还是更喜欢F#。

# php - 自定义 php 模板引擎：我终于走上正轨了吗？

> ID：196302
> 
> 赞同：1
> 
> 时间：2008-10-12T23:39:25.840
> 
> 标签：php, xml, template-engine, conceptual

由于我一直迟到回答标记为 php 的问题，我实际上知道答案，我想我会尝试自己问一个问题。

长期以来，我一直在对 php 中的自定义模板引擎进行如此多的完整重写，以至于我想征求意见。

简而言之，这是我迄今为止实现的最重要的部分：

1.  任何 http 请求都会被路由到 handler.php
2.  根据请求的 URL 实例化控制器并调用该控制器上的方法。
3.  控制器方法必须返回一个`IView`兼容的类实例（`IView`定义一个`Render()`方法）
    1.  模板引擎为每个以“服务器端”结尾的命名空间执行一些 xpath`sprintf('//%s:*[@runat="server"]', $namespaceprefix )`
    2.  对于每个找到的标签，它都会查找由标识的 php 类`$tag.localName`并实例化一个并将其附加到原始模板。
    3.  附加后，原始模板节点将被馈送到“ServerTag”，以便它可以正确初始化
    4.  完全完整的 IView 兼容实例被分配给控制器方法中的临时变量。
4.  控制器要求将数据从 Model 类推送到执行一些漂亮的 xpath DOM 替换的视图。
5.  控制器将完全填充的视图返回给`main()`处理程序，处理程序呈现它。

我的模板基于 xml。一个简单的模板目前看起来像：

```
<html xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:red="http://www.theredhead.nl/serverside">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Title will be filed by the View depending on the Controller</title>
    <link rel="stylesheet" type="text/css" href="/Stylesheet/Get/Main/" />
</head>
<body>
    <!-- the entire body may be reset by the view using it, using XPath and DOM functions -->
    <!-- Usually the PageHeader and PageFooter would be put back after clearing the body  -->
    <div id="PageHeader">
        <img src="/Image/Get/theredhead_dot_nl.png" alt="Site Logo" />
    </div>
    <h1>www.theredhead.nl :: Test Template</h1>
    <p>
        Lorum ipsum dolar sit amet. blah blah blah yackadee schmackadee.
    </p>

    <div id="PageFooter">
        Built by
        <br />
        <red:UserProfileLink runat="server" Username="kris" />
    </div>
</body>
</html> 
```

目前，此输出（包括损坏的缩进）：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:red="http://www.theredhead.nl/serverside">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Welcome to my site</title>
    <link rel="stylesheet" type="text/css" href="/Stylesheet/Get/Main/"/>
    <link rel="stylesheet" type="text/css" href="/Stylesheet/Get/Custom/"/>
    <link rel="stylesheet" type="text/css" href="/Stylesheet/Get/Profile/"/>
</head>
<body>
    <!-- the entire body may be reset by the view using it, using XPath and DOM functions -->
    <!-- Usually the PageHeader and PageFooter would be put back after clearing the body  -->
    <div id="PageHeader">
        <img src="/Image/Get/theredhead_dot_nl.png" alt="Site Logo"/>
    </div>
    <h1>www.theredhead.nl :: ModelViewController</h1>
    <p>
        Lorum ipsum dolar sit amet. blah blah blah yackadee schmackadee.
    </p>

    <div id="PageFooter">
        Built by
        <br/>
        <div><div xmlns:profile="http://www.theredhead.nl/profile" class="ProfileBadge" style="font-size : .8em;">
<a style="text-decoration : none; border: none;" href="/Profile/View/kris">
    <img style="float : left;" src="http://www.gravatar.com/avatar/5beeab66d6fe021cbd4daa041330cc86?d=identicon&amp;s=32&amp;r=pg" alt="Gravatar"/>
    &#xA0;Kris
</a>
<br/>
<small>
&#xA0;Rep:&#xA0;1
</small>
</div></div>
    </div>
</body>
</html> 
```

*   我在这里只触及了冰山一角，是的，一旦我对功能感到满意，我将从输出中删除未使用的 xmlns 属性
*   我的 mvc 和核心框架中目前只有 200 多个类
*   我知道现有的解决方案可以做类似的事情，但我想建立自己的。

所以最大的问题是：**你对必备功能有什么意见吗？**

PS如果有人对完整的源代码感兴趣，请发表评论，当我达到合理的开发人员可用性水平时，我将在我的网站上提供它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T09:40:35.673

为什么不直接使用 PHP 作为您的模板系统。PHP是模板系统*。*

`<?php=$variable;?>`仅在 HTML 模板中转储有什么问题？您可以使用 foreach 循环等。只需确保在无法访问您不想要的任何变量的范围内运行它。

自从我的 Java/Struts 噩梦以来，我对像这样过于复杂的模板系统有一种根深蒂固的仇恨。您必须深入研究命名空间、xpath、自定义命名空间和所有这些东西，然后才能只更改您需要的一件事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T23:50:48.983

在我看来，只有 Phil Reif 真正阅读*并*理解了这个问题及其意图。

那些声称 php*是*模板引擎的人，他们忽略了太多的事实，并且让他们自己对可靠框架很重要的现实世界视而不见。

因此，到目前为止，要点必须具有的功能（尚未实现）是：

1.  列表。我将处理那些类似于`<asp:DataGrid>`
2.  验证。将使用验证控件进行处理。正则表达式、比较等
3.  输出是强制有效的 xhtml 1.0，至少在 html 5 沉没之前。
4.  复合自定义控件（基于 xml 模板而不是代码）
5.  inline php code...我正在考虑，`<?php ... ?>`是一个有效的xml DOMProcessingInstruction 节点，但评委们未定。
6.  可配置的全局异常处理。

我已经在网上设置了初稿，所以你可以看看，也许会给我一些巧妙的想法。

顺便说一句，我将在接下来的几天内建立并运行表格。目前它只是设计的初稿（代码和风格方面）

仍然希望这里有更多的输入，你们使用和喜欢什么样的控件？（来自任何框架/语言）

克里斯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T10:32:17.177

这是一篇关于模板引擎的文章：http: [//massassi.com/php/articles/template_engines/](http://massassi.com/php/articles/template_engines/)

你这样做是错的。

# .net - Windows 窗体的进度按钮

> ID：196326
> 
> 赞同：3
> 
> 时间：2008-10-13T00:02:01.177
> 
> 标签：.net, button, progress

.NET 新手在这里...我想在 Windows 窗体中制作一个按钮，显示进度或“冷却”效果。也就是说，当按钮被按下时，它会被禁用。随着某些事件或计时器的进行，该按钮以图形方式显示进度。进度完成后，图形完成并且按钮变为启用状态。在许多游戏中都可以看到类似的效果。

我曾考虑使用内置 Button 类和 GDI+ DrawPath 函数的组合，但复杂性扩展性很差，而且我觉得必须有更简单的方法。

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T00:04:33.467

最简单的方法是创建进度条控件的实例，然后您不需要执行任何自定义编码/自定义绘画。如果您确实需要在按钮控件中显示所有内容，那么您有两个选择。您可以不断更改按钮的 Image 属性或全力以赴并执行按钮的自定义绘制。自定义绘画非常简单，因为您只需要绘制文本以及您想要的任何图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T00:14:28.797

另一种简单的方法可能是让两个控件、一个按钮和一个进度条占据表单上的相同空间。当用户按下按钮时，隐藏按钮并显示进度条。根据需要更新进度条，直到完成任何处理。然后，隐藏进度条并再次显示按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T00:09:07.403

如果您真的需要将它放在按钮上，我会使用自定义绘制事件。

类似于：

```
button += new buttonPaintEvent(buttonPaintEventHandlerMethod); 
```

# c++ - OSX 缺少 memalign

> ID：196329
> 
> 赞同：15
> 
> 时间：2008-10-13T00:03:54.200
> 
> 标签：c++, c, macos, posix

我正在用 C 语言开发一个项目，它需要 memalign()。确实，posix_memalign() 也可以，但是 darwin/OSX 缺少这两个。

有什么好的解决方案可以解决 memalign 的问题？如果我要撕掉 memalign.c 并将其放入我的项目中，我不了解 posix-C 代码的许可——我不想要任何病毒类型的许可 LGPL-ing 我的整个项目。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-13T00:15:21.320

Mac OS X 似乎是[16 字节内存对齐的。](http://www.taybin.com/2007/04/03/macos-x-memory-alignment/)

引自网站：

> 我很难找到关于 MacOS X 内存对齐的明确声明，所以我做了自己的测试。在 10.4/intel 上，堆栈和堆内存都是 16 字节对齐的。所以移植软件的人可以停止寻找 memalign() 和 posix_memalign()。这不是必需的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-04-05T04:48:57.187

### 更新：OSX 现在有`posix_memalign()`

迟到了，但更新版本的 OSX*确实*有`posix_memalign()`. 在与页面边界对齐时，您可能需要这样做。例如：

```
#include <stdlib.h>

char *buffer;
int pagesize;

pagesize = sysconf(_SC_PAGE_SIZE);
if (pagesize == -1) handle_error("sysconf");

if (posix_memalign((void **)&buffer, pagesize, 4 * pagesize) != 0) {
  handle_error("posix_memalign");
} 
```

需要注意的一点是，与 不同的是`memalign()`，`posix_memalign()`它`**buffer`作为参数并返回一个整数错误代码。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-13T00:18:41.970

自己做应该很容易，不是吗？类似于以下内容（未测试）：

```
void *aligned_malloc( size_t size, int align )
{
    void *mem = malloc( size + (align-1) + sizeof(void*) );

    char *amem = ((char*)mem) + sizeof(void*);
    amem += align - ((uintptr)amem & (align - 1));

    ((void**)amem)[-1] = mem;
    return amem;
}

void aligned_free( void *mem )
{
    free( ((void**)mem)[-1] );
} 
```

（感[谢乔纳森莱弗勒](https://stackoverflow.com/questions/196329/osx-lacks-memalign#196394)）

**编辑：** 关于扯掉另一个 memalign 实现，问题不在于许可。相反，您会遇到困难，即任何好的 memalign 实现都将成为堆管理器代码库的组成部分，而不是简单地分层在 malloc/free 之上。因此，将它移植到不同的堆管理器时会遇到严重的麻烦，尤其是当您无法访问它的内部时。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-13T00:31:35.953

为什么您要移植的软件需要 memalign() 或 posix_memalign()？它是否将它用于比 austirg 引用的 16 字节对齐更大的对齐？

我看到 Mike F 发布了一些代码——它看起来比较简洁，尽管我认为 while 循环可能不是最佳的（如果所需的对齐是 1KB，它可能会迭代很多次）。

不：

```
amem += align - ((uintptr)amem & (align - 1)); 
```

一次手术就能到达那里？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T11:20:54.800

从 macosx 手册页：

> malloc()、calloc()、valloc()、realloc() 和 reallocf() 函数分配内存。分配的内存对齐，以便它可以用于任何数据类型，包括 AltiVec 和 SSE 相关类型。free() 函数释放通过前面的分配函数创建的分配。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T00:34:11.300

是的，Mac OS X在**ABI中****确实有 16 字节内存对齐**。您不需要使用 memalign()。如果您的内存要求是 16 倍，那么我不会实现它，也许只是添加一个断言。

 *** * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T00:55:31.273

如果您需要一个任意对齐的 malloc，请查看 x264 的 malloc（git 存储库中的 common/common.c），它为没有 malloc.h 的系统提供了自定义 memalign。它的代码极其微不足道，以至于我什至不认为它具有版权，但是您在看到它之后应该可以轻松地实现自己的代码。

当然，如果你只需要 16 字节对齐，如上所述，它在 OS X ABI 中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-03T08:59:40.697

可能值得建议在您的代码中使用 Doug Lea 的 malloc。[链接文本](http://g.oswego.edu/dl/html/malloc.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-29T03:38:32.380

感谢您的帮助，伙计们......在我的情况下有所帮助（OpenCascade src/Image/Image_PixMap.cxx，OSX10.5.8 PPC）

结合上面的答案，如果不是特别熟悉 malloc 等，这可能会节省一些人的挖掘或灌输希望：

我正在构建的相当大的项目只有一个对 posix_memalign 的引用，事实证明这是一堆不包括 OSX 但确实包括 BORLANDC 的预处理器条件的结果，这证实了其他人认为它是安全的在某些情况下使用 malloc：

```
#if defined(_MSC_VER)
 return (TypePtr )_aligned_malloc (theBytesCount, theAlign);
#elif (defined(__GNUC__) && __GNUC__ >= 4 && __GNUC_MINOR__ >= 1)
 return (TypePtr )     _mm_malloc (theBytesCount, theAlign);
#elif defined(__BORLANDC__)
 return (TypePtr ) malloc (theBytesCount);
#else
 void* aPtr;
 if (posix_memalign (&aPtr, theAlign, theBytesCount))
 {
     aPtr = NULL;
 }
 return (TypePtr )aPtr;
#endif 
```

因此，正如其他人所建议的那样，它可以像使用 malloc 一样简单。

例如这里：在`__BORLANDC__`上面移动条件`__GNUC__`并添加**APPLE**：

```
#elif (defined(__BORLANDC__) || defined(__APPLE__)) //now above `__GNUC__` 
```

注意：我没有*像*上面所说的 OS X 那样检查 BORLANDC 是否使用 16 字节对齐。我也没有验证 PPC OS X 确实如此。然而，这种用法表明这种对齐并不是特别重要。（希望它有效，并且对您的搜索者来说也很容易！）

# database-design - 我应该只在数据库中存储固定大小的数据元素吗？

> ID：196340
> 
> 赞同：0
> 
> 时间：2008-10-13T00:11:35.837
> 
> 标签：database-design

如果存储在数据库的给定字段中的数据量未知，并且可能非常大，我应该将其存储在外部文件中而不是数据库中的字段中吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T00:21:23.773

您是否需要数据的事务语义（提交、回滚）？如果是这样，那么使用外部文件系统会使生活变得非常复杂——使用 DBMS。如果您不需要事务语义，那么文件系统可能是有意义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T00:16:13.427

这就是设计 BLOB 或备注字段类型的原因。他们非常擅长存储可变长度/大型对象。

话虽如此，我仍然会使用文件系统而不是使用数据库来存储某些大型对象。如果对象非常大（每个多 MB），我会考虑将它们放在文件系统上并在数据库中存储一个指针（文件名）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T00:18:44.623

您应该选择能够有效处理大数据的数据库管理系统。数据库系统可以将其存储在数据库文件中或从数据库中链接到的外部文件中。SQL Server 2008 可以透明地做到这两点；不确定其他系统提供什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T00:16:43.130

这取决于你的任务。在 FS 而不是 DB 上存储大数据有利有弊。至于大小，您可以在大多数数据库的字段定义中进行限制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T01:39:12.463

我认为这可能取决于您将如何使用这些数据。例如，如果我正在存储将在网站（Flickr 或类似网站）中使用的图像，我宁愿将图像存储为文件并在数据库中保留参考，而不是将图像数据存储在数据库中并拥有每次通过一些 HTTP 处理程序重构图像数据。另一方面，如果文本存储在数据库中，则需要搜索的大型文档的集合可能会更有用。

# python - 如何检查Python中的字符串是否为ASCII？

> ID：196345
> 
> 赞同：240
> 
> 时间：2008-10-13T00:13:40.013
> 
> 标签：python, string, unicode, ascii

我想检查一个字符串是否为 ASCII 格式。

我知道`ord()`，但是当我尝试时`ord('é')`，我知道了`TypeError: ord() expected a character, but string of length 2 found`。我知道这是由我构建 Python 的方式引起的（如[`ord()`'s documentation](http://docs.python.org/library/functions.html#ord)中所述）。

有没有其他方法可以检查？

* * *

## 回答 #1

> 赞同：276
> 
> 时间：2008-10-13T00:30:32.367

我认为你没有问正确的问题——

python 中的字符串没有对应于“ascii”、utf-8 或任何其他编码的属性。您的字符串的来源（无论您是从文件中读取它，还是从键盘输入等）可能已经在 ascii 中编码了一个 unicode 字符串来生成您的字符串，但这就是您需要寻找答案的地方。

也许你可以问的问题是：“这个字符串是用 ascii 编码一个 unicode 字符串的结果吗？” - 你可以通过尝试回答：

```
try:
    mystring.decode('ascii')
except UnicodeDecodeError:
    print "it was not a ascii-encoded unicode string"
else:
    print "It may have been an ascii-encoded unicode string" 
```

* * *

## 回答 #2

> 赞同：220
> 
> 时间：2008-10-13T00:30:43.257

```
def is_ascii(s):
    return all(ord(c) < 128 for c in s) 
```

* * *

## 回答 #3

> 赞同：174
> 
> 时间：2013-08-23T13:14:49.313

在 Python 3 中，我们可以将字符串编码为 UTF-8，然后检查长度是否保持不变。如果是这样，那么原始字符串是 ASCII。

```
def isascii(s):
    """Check if the characters in string s are in ASCII, U+0-U+7F."""
    return len(s) == len(s.encode()) 
```

要检查，请通过测试字符串：

```
>>> isascii("♥O◘♦♥O◘♦")
False
>>> isascii("Python")
True 
```

* * *

## 回答 #4

> 赞同：129
> 
> 时间：2018-07-02T18:32:22.840

### Python 3.7 中的新功能 ( [bpo32677](https://bugs.python.org/issue32677) )

不再对字符串进行烦人/低效的 ascii 检查，新的内置`str`//方法 -将检查字符串是否为 ascii。`bytes``bytearray`[`.isascii()`](https://docs.python.org/3/library/stdtypes.html#str.isascii)

```
print("is this ascii?".isascii())
# True 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2015-09-02T15:45:04.567

Vincent Marchetti 有正确的想法，但`str.decode`在 Python 3 中已被弃用。在 Python 3 中，您可以使用以下命令进行相同的测试`str.encode`：

```
try:
    mystring.encode('ascii')
except UnicodeEncodeError:
    pass  # string is not ascii
else:
    pass  # string is ascii 
```

请注意，您要捕获的异常也已从 更改`UnicodeDecodeError`为`UnicodeEncodeError`。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-10-14T07:36:59.590

你的问题不正确；您看到的错误不是您如何构建 python 的结果，而是字节字符串和 unicode 字符串之间的混淆。

字节字符串（例如，python 语法中的“foo”或“bar”）是八位字节序列；数字从 0 到 255。Unicode 字符串（例如 u"foo" 或 u'bar'）是 unicode 代码点序列；数字从 0-1112064。但是您似乎对字符 é 感兴趣，它（在您的终端中）是一个表示单个字符的多字节序列。

而不是`ord(u'é')`，试试这个：

```
>>> [ord(x) for x in u'é'] 
```

这会告诉您“é”代表哪个代码点序列。它可能给你 [233]，或者它可能给你 [101, 770]。

而不是`chr()`扭转这一点，有`unichr()`：

```
>>> unichr(233)
u'\xe9' 
```

这个字符实际上可以表示为单个或多个 unicode “代码点”，它们本身表示字素或字符。它要么是“带有重音符号的 e（即代码点 233）”，要么是“e”（代码点 101），然后是“前一个字符的重音符号”（代码点 770）。因此，这个完全相同的字符可能会呈现为 Python 数据结构`u'e\u0301'`或`u'\u00e9'`.

大多数时候你不必关心这个，但如果你迭代一个 unicode 字符串，它可能会成为一个问题，因为迭代是按代码点工作的，而不是按可分解字符工作的。换句话说，`len(u'e\u0301') == 2`和`len(u'\u00e9') == 1`。如果这对您很重要，您可以使用[`unicodedata.normalize`](http://docs.python.org/library/unicodedata.html#unicodedata.normalize).

[Unicode 词汇表](http://unicode.org/glossary/)可以成为理解其中一些问题的有用指南，它指出每个特定术语如何指代文本表示的不同部分，这比许多程序员意识到的要复杂得多。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2011-08-08T20:47:22.390

最近遇到这样的事情 - 以供将来参考

```
import chardet

encoding = chardet.detect(string)
if encoding['encoding'] == 'ascii':
    print 'string is in ascii' 
```

您可以使用：

```
string_ascii = string.decode(encoding['encoding']).encode('ascii') 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-13T16:38:25.517

这样做怎么样？

```
import string

def isAscii(s):
    for c in s:
        if c not in string.ascii_letters:
            return False
    return True 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2012-08-21T23:24:35.620

我在尝试确定如何使用/编码/解码我不确定其编码的字符串（以及如何转义/转换该字符串中的特殊字符）时发现了这个问题。

我的第一步应该是检查字符串的类型——我没有意识到我可以从类型中获得关于其格式的良好数据。 [这个答案非常有帮助，并找到了我问题的真正根源。](https://stackoverflow.com/a/4987367/727541)

如果你变得粗鲁和执着

> UnicodeDecodeError：“ascii”编解码器无法解码位置 263 中的字节 0xc3：序数不在范围内（128）

特别是当你编码时，确保你没有尝试 unicode() 一个已经是 unicode 的字符串——由于某些可怕的原因，你会得到 ascii 编解码器错误。（另请参阅[Python Kitchen recipe](http://packages.python.org/kitchen/unicode-frustrations.html)和[Python 文档](http://docs.python.org/howto/unicode.html)教程，以更好地了解这有多可怕。）

最终我确定我想做的是：

```
escaped_string = unicode(original_string.encode('ascii','xmlcharrefreplace')) 
```

对调试也有帮助的是将我的文件中的默认编码设置为 utf-8（将其放在 python 文件的开头）：

```
# -*- coding: utf-8 -*- 
```

这允许您测试特殊字符 ('àéç')，而不必使用它们的 unicode 转义 (u'\xe0\xe9\xe7')。

```
>>> specials='àéç'
>>> specials.decode('latin-1').encode('ascii','xmlcharrefreplace')
'&#224;&#233;&#231;' 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-05-22T08:48:46.607

要从 Python 2.6（和 Python 3.x）改进 Alexander 的解决方案，您可以使用辅助模块 curses.ascii 并使用 curses.ascii.isascii() 函数或其他各种：[https ://docs.python.org/2.6/图书馆/curses.ascii.html](https://docs.python.org/2.6/library/curses.ascii.html)

```
from curses import ascii

def isascii(s):
    return all(ascii.isascii(c) for c in s) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-13T00:18:25.560

您可以使用接受 Posix 标准 [[:ASCII:]] 定义的正则表达式库。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-14T07:58:08.173

Python 中的字符串 ( `str`-type) 是一系列字节。**无法**仅通过查看字符串来判断这一系列字节是表示 ascii 字符串、8 位字符集中的字符串（如 ISO-8859-1）还是用 UTF-8 或 UTF-16 编码的字符串或其他字符串.

但是，如果您知道使用的编码，那么您可以`decode`将 str 转换为 unicode 字符串，然后使用正则表达式（或循环）来检查它是否包含您关注的范围之外的字符。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-10-28T16:30:33.790

就像@RogerDahl 的[回答](https://stackoverflow.com/a/32869248/623735)`find_all`一样，但通过否定字符类并使用 search 而不是or来短路更有效`match`。

```
>>> import re
>>> re.search('[^\x00-\x7F]', 'Did you catch that \x00?') is not None
False
>>> re.search('[^\x00-\x7F]', 'Did you catch that \xFF?') is not None
True 
```

我想正则表达式对此进行了很好的优化。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-09-30T14:51:52.030

```
import re

def is_ascii(s):
    return bool(re.match(r'[\x00-\x7F]+$', s)) 
```

`+`要将空字符串包含为 ASCII，请将`*`.

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2013-07-07T21:16:00.113

为了防止您的代码崩溃，您可能需要使用 a`try-except`来捕获`TypeErrors`

```
>>> ord("¶")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: ord() expected a character, but string of length 2 found 
```

例如

```
def is_ascii(s):
    try:
        return all(ord(c) < 128 for c in s)
    except TypeError:
        return False 
```

* * *

## 回答 #16

> 赞同：-5
> 
> 时间：2010-07-21T06:34:56.927

我使用以下内容来确定字符串是 ascii 还是 unicode：

```
>> print 'test string'.__class__.__name__
str
>>> print u'test string'.__class__.__name__
unicode
>>> 
```

然后只需使用条件块来定义函数：

```
def is_ascii(input):
    if input.__class__.__name__ == "str":
        return True
    return False 
```

# macos - 使 iTerm 以与其他操作系统相同的方式翻译“元密钥”

> ID：196357
> 
> 赞同：195
> 
> 时间：2008-10-13T00:17:53.483
> 
> 标签：macos, command-line, keyboard-shortcuts

在带有 emacs 键绑定的 bash shell 中，您可以使用 Mf、Mb 等组合键在 shell 提示符上分别向前或向后移动一个单词。通常，元键映射到 Windows 和 Linux 上的 Alt 键。但是，在 iTerm 中，我找不到将这个元键映射到 MacBook Pro 上的 Option 或 Command 键的方法。

似乎在 OS X 中，元键默认映射到 ESC 键。所以你可以在iTerm上使用ESC-f、ESC-b。但是，ESC 键显然不实用。此外，iTerm 确实具有允许您修改元键映射的选项（书签 > 配置文件 > 键盘配置文件 > 全局 > 选项键为...），此设置似乎根本不起作用。

因此，如果有人知道这个问题的解决方案是什么，请告诉我。

我已经升级到最新版本 0.9.6.1012，并且这种行为仍然存在。

**编辑：**对我的问题进行一些澄清。我正在谈论的键绑定是针对 bash shell，而不是在 emacs 中。碰巧的是，默认情况下，bash shell 也使用与 emacs 相同的键绑定。

* * *

## 回答 #1

> 赞同：238
> 
> 时间：2008-10-13T09:27:33.360

`Cmd+.`, `Profiles`,`Keys`并选择`Left option Key acts as: +Esc`。

在 emacs 中为我工作，但我不确定它是否会产生任何其他不良影响。

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2009-01-13T13:12:53.963

转到*书签 > 管理配置文件*。然后选择*Keyboard Profiles > Global*并选择*Option Key 作为 Meta*。这适用于我的版本 0.9.6.1201。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-12-06T05:08:23.843

在菜单栏中 Iterm2 => Preferences => Profiles 选择键选项卡并选择

左 Option 键充当 +Esc

[![在此处输入图像描述](https://i.stack.imgur.com/JjGAb.png)](https://i.stack.imgur.com/JjGAb.png)

在 irssi 也为我工作。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2020-02-05T16:20:59.373

对于**iTerm2**用户[，这个答案](https://stackoverflow.com/a/197092/7837941)只是部分解决了问题。

> `Cmd+.`, `Profiles`,`Keys`并选择`Left option Key acts as: +Esc`。

除此之外，您必须转到**Preferences** ( `Cmd`+ `,`) ➔ **Profiles** ➔ **Keys**并在**Key Mappings**中找到这些**Key Combination**的:[![在此处输入图像描述](https://i.stack.imgur.com/UEWwg.png)](https://i.stack.imgur.com/UEWwg.png)和[![在此处输入图像描述](https://i.stack.imgur.com/s1B8o.png)](https://i.stack.imgur.com/s1B8o.png)。双击每个映射并将其**Action**和**Esc+**更改为以下内容：

[![在此处输入图像描述](https://i.stack.imgur.com/FKOsd.png)](https://i.stack.imgur.com/FKOsd.png)

[![在此处输入图像描述](https://i.stack.imgur.com/JsBxe.png)](https://i.stack.imgur.com/JsBxe.png)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-08-13T21:37:53.950

转到您的 iTerm 首选项，选择“配置文件”，然后选择“键”并在“自然文本编辑”中更改您的预设

[![iTerm 偏好](https://i.stack.imgur.com/lNb2Q.png)](https://i.stack.imgur.com/lNb2Q.png)

它应该在之后立即工作。

它适用于 iTerm 3.3.12 版

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-06T18:33:51.743

在这里进行所有的僵尸复活，但为了后代——

[这篇文章](http://ninjamonkeys.co.za/2007/07/19/iterm-tip-to-get-forward-alt-f-and-backward-alt-b-word-working)让它如你所愿，为 Mb 和 Mf 工作，同时保持 'Option Key as Meta' 设置，这样你就不会牺牲修饰符（我个人有使用 meta 的 vim 映射）。

总之，在您的全局键盘配置文件中，添加两个带有设置的新映射：

1.  作为十六进制代码的键，b 的值为 62，f ( `man ascii`)的值为 66
2.  修饰符作为选项
3.  作为发送转义序列、值 b 或 f 的操作

Terminal.app 中我唯一想念的就是`Opt-Backspace`逐字删除。还有其他解决方法，但我只是想训练自己使用`Ctrl-w`.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-12-31T20:44:23.507

在 iTerm2 中更容易。转到首选项->书签->键盘并选择选项发送+ESC。在 iTerm2 中，您可以分别配置左右选项键，因此如果您需要，请记住更改两者。iTerm2 的链接：[http ://sites.google.com/site/iterm2home/](http://sites.google.com/site/iterm2home/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-07-01T00:13:20.227

转到书签 > 管理配置文件。然后选择键盘配置文件 > 全局并选择选项键作为 +ESC。

在 iTerm Build 0.9.5.0611 和 Build 0.9.6.20090415 中工作

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-09-25T02:46:17.617

我也在stackoverflow上找到了一些解决方案，只需转到键盘配置文件并在“全局”中更改“选项键为”+ESC

这对我来说完美=）顺便说一句，一些iterm补丁也存在在这里：[http ://www.emacswiki.org/emacs/EmacsForMacOS](http://www.emacswiki.org/emacs/EmacsForMacOS)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-13T03:57:39.750

我不了解 iTerm，但您可以在终端中执行此操作。说明可以在这里找到：

[Mac OS X Leopard 上的 Emacs 键绑定](https://stackoverflow.com/questions/162896/emacs-on-mac-os-x-leopard-key-bindings#162907)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-07-18T03:24:00.770

这对我有用：书签>管理配置文件>键盘配置文件>全局/xterm>选项键为+ Esc。有了这个，我可以在 Midnight Commander 中使用 Option+Enter 并且当前选择的文件/目录名称显示在命令字符串中，正如它应该的那样。作为 Meta 的选项键对我不起作用。我的 iTerm 版本是 0.10。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-03-03T19:59:06.340

我在 Meta + Left 或 Meta + Right 上苦苦挣扎。上下文是在 iTerm2 会话中使用的 Emacs 中的击键。

我尝试了 Esc+ 和 Meta 作为左选项键，但没有成功。我尝试使用和不使用十六进制映射。没运气。

但后来我尝试了“使用 CSI u 报告修饰符”。（[此处的文档](https://iterm2.com/documentation-csiu.html)）。这让我可以在 Emacs 中使用 meta + Left 和 meta + right 键，这是我在我的 Linux 机器上的行为。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-10-13T03:15:00.740

尝试“导出 LANG=C”。我不是 emacs 专家，但我发现这使 OS X 上的 emacs 能够将 Option 键识别为 iTerm 中的 Meta 键，

# queue - 如何在 SML/NJ 中使用队列库

> ID：196382
> 
> 赞同：3
> 
> 时间：2008-10-13T00:26:06.480
> 
> 标签：queue, sml, smlnj, ml

我看到 SML/NJ 包含一个队列结构。我不知道如何使用它。如何使用 SML/NJ 提供的附加库？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-01T17:38:26.250

SML '97 没有指定该[`Queue`结构](http://www.smlnj.org/doc/smlnj-lib/Manual/queue.html)，但它存在于 SML/NJ 的顶级环境中。

```
$ sml
新泽西州标准 ML v110.69 [构建：Fri Mar 13 16:02:47 2009]
- 队列.mkQueue();
[自动加载]
[库 $SMLNJ-LIB/Util/smlnj-lib.cm 稳定]
[自动加载完成]
标准输入：1.1-1.17 警告：类型 vars 未泛化，因为
   值限制被实例化为虚拟类型（X1，X2，...）
val it = - : ?.X1 Queue.queue
-

```

你可以`open`一个结构。这可以让您避免`Queue.`在所有内容前面打字。但是，不鼓励在顶层执行此操作，因为它会污染环境并使您所依赖的东西变得不那么明显。（在另一种结构中，我会说在某些情况下它可能是可以接受的。）

```
$ sml
新泽西州标准 ML v110.69 [构建：Fri Mar 13 16:02:47 2009]
- 开放队列；
[自动加载]
[库 $SMLNJ-LIB/Util/smlnj-lib.cm 稳定]
[自动加载完成]
开放队列
  输入'一个队列
  异常出队
  val mkQueue : unit -> '一个队列
  val clear : '一个队列 -> 单元
  val isEmpty : '一个队列 -> bool
  val enqueue : 'a queue * 'a -> unit
  val dequeue : '一个队列 -> 'a
  val next : '一个队列 -> '一个选项
  val delete : 'a queue * ('a -> bool) -> unit
  val head : '一个队列 -> 'a
  val peek : '一个队列 -> '一个选项
  val length : '一个队列-> int
  val 内容：'一个队列->'一个列表
  val app : ('a -> unit) -> 'a queue -> unit
  val map : ('a -> 'b) -> 'a 队列 -> 'b 队列
  val foldl : ('a * 'b -> 'b) -> 'b -> 'a 队列 -> 'b
  val foldr : ('a * 'b -> 'b) -> 'b -> 'a 队列 -> 'b
- mk队列（）；
标准输入：3.1-3.11 警告：类型 vars 未泛化，因为
   值限制被实例化为虚拟类型（X1，X2，...）
val it = - : ?.X1 队列
-

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T23:59:44.810

我没有完整的答案给你，但我可以为你指出正确的方向。您应该使用 SML/NJ 内置的编译管理器 (CM) 进行查找。您可以将其视为 Make for SML。

要使用 SML/NJ 库中的库，您需要将 smlnj-lib.cm 添加到应用程序的 CM 描述文件中。然后，您可以使用该库中的 Queue 等声明。

smlnj 网站上有一些关于[编译管理器](http://www.smlnj.org/doc/CM/index.html)的文档。

希望这至少可以为您指明正确的方向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-24T19:28:10.613

如果要创建整数队列，请使用以下代码。将“int”替换为您想要的数据类型。

```
val que = Queue.mkqueue(): int Queue.queue 
```

其他一切都可以在[这里找到。](http://www.smlnj.org/doc/smlnj-lib/Manual/queue.html)

# c# - 你能在 C# 中写一段 C++ 代码吗？

> ID：196390
> 
> 赞同：3
> 
> 时间：2008-10-13T00:30:28.983
> 
> 标签：c#, .net, c++

我听说你可以在 C# 代码中直接下拉到 C++。这是怎么做到的？还是我听错了？

注意：我不是指 C++/CLI。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T00:32:51.410

您可能正在考虑可以编写看起来很像 C++ 的代码的[`unsafe`块，因为您可以使用指针。](http://msdn.microsoft.com/en-us/library/chfa2zb8(VS.71).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T00:31:54.020

你听错了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-13T01:00:03.167

您可以从 C 下拉到汇编，因为 C 是指令集半不可知汇编。

你可以从 C++ 降到 C，因为 C++ 是 C 加上一些其他的东西，这取决于你的观点，使它变得丑陋或美丽得可怕。

你不能从 C# 降到 C++，因为它们是完全不同的东西。除了花括号和分号语法之外，它们之间没有直接关系。C# 不是 C++ 的超集，也不是它的子集，也不是它的兄弟（但可能是第二个表亲）。

也就是说，C# 提供了在所有抽象级别与外部代码交互的工具，从 Platform-Invoke（调用用 C 编写的函数）到 COM 再到各种其他类型。但 C# 本身与这些东西没有直接关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T00:41:15.903

为什么你需要这样做？您可以引用本机 C 库，但我非常怀疑您是否可以从托管代码中运行本机代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T00:52:45.303

您可以从 .NET 非常轻松地与 COM 对象进行交互。

# c# - 如何从 C# 中的 DLL 中找到基本 url？

> ID：196407
> 
> 赞同：3
> 
> 时间：2008-10-13T00:38:36.203
> 
> 标签：c#, .net, asp.net, url, web-applications

在 C#.NET Web 应用程序调用的 DLL 中，如何找到 Web 应用程序的基本 url？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-13T01:22:50.437

这行得通吗？

```
HttpContext.Current.Request.Url 
```

更新：

要获取基本 URL，您可以使用：

```
HttpContext.Current.Request.Url.GetComponents(UriComponents.SchemeAndServer, UriFormat.Unescaped) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T16:10:40.723

如果它是可能被非 Web 项目引用的程序集，那么您可能希望避免使用 System.Web 命名空间。

我会使用 DannySmurf 的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-19T22:29:33.200

正如亚历山大所说，您可以使用 HttpContext.Current.Request.Url 但如果您不想使用 http://：

```
HttpContext.Current.Request.Url.GetComponents(UriComponents.HostAndPort, UriFormat.Unescaped); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T00:41:40.940

您可以使用 Assembly.GetExecutingAssembly() 来获取 DLL 的程序集对象。

然后，调用 Server.MapPath，传入该程序集的 FullPath 以获取本地根路径。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T01:35:03.890

我想出了这个，虽然我不确定它是否是最好的解决方案：

```
string _baseUrl = String.Empty;
HttpContext httpContext = HttpContext.Current;
if (httpContext != null)
{
    _baseURL = "http://" + HttpContext.Current.Request.Url.Host;
    if (!HttpContext.Current.Request.Url.IsDefaultPort)
    {
        _baseURL += ":" + HttpContext.Current.Request.Url.Port;
    }
} 
```

# sql-server - T/SQL 中的日期范围

> ID：196415
> 
> 赞同：2
> 
> 时间：2008-10-13T00:42:18.973
> 
> 标签：sql-server

对于我正在工作的当前项目，我需要返回基于日期范围的汇总报告。

我有 3 种类型的报告，每年、每月和每天。

为了帮助返回此报告，我需要一个函数来返回一个很大范围内的所有日期时间子范围。

因此，例如，如果我对于 '2006-01-01 11:10:00' 和 '2006-01-05 08:00:00' 之间的所有每日范围，我希望得到以下结果。

```
select * 
from dbo.fnGetDateRanges('d', '2006-01-01 11:10:00', '2006-01-05 08:00:00')  

2006-01-01 11:10:00.000,    2006-01-02 00:00:00.000
2006-01-02 00:00:00.000,    2006-01-03 00:00:00.000
2006-01-03 00:00:00.000,    2006-01-04 00:00:00.000
2006-01-04 00:00:00.000,    2006-01-05 00:00:00.000
2006-01-05 00:00:00.000,    2006-01-05 08:00:00.000 
```

对于“2006-01-01 11:10:00”到“2009-05-05 08:00:00”的年度范围，我预计。

```
select * 
from dbo.fnGetDateRanges('y', '2006-01-01 11:10:00', '2009-05-05 08:00:00') 

2006-01-01 11:10:00.000,    2007-01-01 00:00:00.000
2007-01-01 00:00:00.000,    2008-01-01 00:00:00.000
2008-01-01 00:00:00.000,    2009-01-01 00:00:00.000
2009-01-01 00:00:00.000,    2009-05-05 08:00:00.000 
```

我将如何实现这个功能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T17:44:53.887

静态数字表很有用，单列，比如 8000 行，从 0 到 7999

（未检查）

```
DECLARE @Start smalldatetime, @End smalldatetime, @Diff int

SELECT @Start = '2006-01-01 11:10:00', @End = '2009-05-05 08:00:00', @diff = DATEDIFF(year,@start,@end)

SELECT
   DATEADD(year,N.Number,@Start)
FROM
   dbo.Number N
WHERE
   N.Number <= @diff 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T00:42:48.817

这里有很多技巧，希望对你有用

```
create function dbo.fnGetDateRanges
(
    @type char(1),
    @start datetime,
    @finish datetime
)
returns @ranges table(start datetime, finish datetime)
as 
begin

    declare @from datetime 
    declare @to datetime 
    set @from = @start 

    if @type = 'd'
    begin 
        set @to = dateadd(day, 1,
                convert
                (   datetime,
                    cast(DatePart(d,@start) as varchar) + '/' + cast(DatePart(m,@start) as varchar) + '/' + cast(DatePart(yy,@start) as varchar),
                    103
                )
            )
    end

    if @type = 'm'
    begin
        set @to = dateadd(month, 1, 
            convert
            (   
                datetime,
                '1/' + cast(DatePart(m,@start) as varchar) + '/' + cast(DatePart(yy,@start) as varchar),
                103
            )
        )
    end 

    if @type = 'y'
    begin
        set @to = dateadd(year, 1, 
            convert
            (   
                datetime,
                '1/1/' + cast(DatePart(yy,@start) as varchar),
                103
            )
        )
    end 

    while @to < @finish
    begin 
        insert @ranges values (@from, @to)
        set @from = @to 
        if @type = 'd'
            set @to = dateadd(day, 1, @to)
        if @type = 'm'
            set @to = dateadd(month, 1, @to)
        if @type = 'y'
            set @to = dateadd(year, 1, @to)
    end

    insert @ranges values (@from, @finish)

    return 
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T04:42:24.637

如果您更喜欢基于集合的解决方案，请使用以下链接中所示的策略来生成从 x 到 y 的数值范围。然后，只需使用 DATEADD() 和您自己的自定义限制加入它，以创建天、月、季度、年或其他任何范围。我发现将此范围查询作为视图很有帮助。

[在 SQL 中生成范围](https://stackoverflow.com/questions/166321/sql-query-which-returns-a-table-where-each-row-represents-a-date-in-a-given-ran#167618)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T18:01:19.780

从性能的角度来看，您不会希望使用函数来生成日期范围。对于查询 ( `@myDate > dbo.MyFunc()`) 中的每个评估，该函数都必须完全执行。你最好的选择是建立静态数字表。

现在开始使用数字表......

这是创建整数表的快速方法。（为 Jeff Moden 提供身份技巧的道具）

```
 SELECT TOP 1000000
        IDENTITY(INT,1,1) as N
   INTO dbo.NumbersTable
   FROM Master.dbo.SysColumns 
        Master.dbo.SysColumns 
```

在表格中填充 1000000 个数字不到 2 秒。

现在要解决您的问题，您将需要使用它来构建日期表。下面的示例将从@startDate 开始为每一天创建一个零小时 (12AM) 的表

```
DECLARE @DaysFromStart int
DECLARE @StartDate datetime
SET @StartDate = '10/01/2008'

SET @ DaysFromStart  = (SELECT (DATEDIFF(dd,@StartDate,GETDATE()) + 1))

CREATE TABLE [dbo].[TableOfDates](
    [fld_date] [datetime] NOT NULL,
 CONSTRAINT [PK_TableOfDates] PRIMARY KEY CLUSTERED 
(
    [fld_date] ASC
)WITH FILLFACTOR = 99 ON [PRIMARY]
) ON [PRIMARY]

INSERT INTO
     dbo.TableOfDates
SELECT 
      DATEADD(dd,nums.n - @DaysFromStart ,CAST(FLOOR(CAST(GETDATE() as FLOAT)) as DateTime)) as FLD_Date
FROM #NumbersTable nums

SELECT MIN(FLD_Date) FROM dbo.TableOfDates
SELECT MAX(FLD_Date) FROM dbo.TableOfDates 
```

现在使用 DATEADD/DIFF 的不同组合，您应该能够创建有效执行许多日期范围查询所需的静态表。

# c# - 如何以编程方式确定 MP3 文件是 CBR 还是 VBR？（最好使用c#）

> ID：196418
> 
> 赞同：6
> 
> 时间：2008-10-13T00:44:26.787
> 
> 标签：c#, mp3

我知道许多实用程序可以告诉我 MP3 文件的比特率，但我从未见过可以告诉我 MP3 文件是 VBR（可变比特率 - 文件内的比特率波动）还是CBR（恒定比特率 - 文件中的比特率保持不变）。我的猜测是，大多数程序对找出这一点不感兴趣，因为它涉及到对文件进行一些分析以查看比特率是否发生变化，这会降低速度。

所以，代替寻找实用程序，我想写一个 - 那么我如何以编程方式确定 MP3 文件是 VBR 还是 CBR？我有大约 15,000 个文件要检查，所以我需要自动化这个过程。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T01:02:44.847

MP3 文件本质上是由所谓的帧构建的。每个帧都有一个小的标头，用于存储有关该帧的信息。标头还存储用于帧的比特率。在 CBR 文件中，所有帧都使用相同的比特率，因此每个标头都具有相同的比特率信息。

要检测文件是否使用 VBR，您必须检查文件的每一帧，查看文件头并检查比特率字段是否发生变化。如果是这样，它是一个 VBR MP3。

MP3 格式的完整描述在这里：[http ://www.mpgedit.org/mpgedit/mpeg_format/mpeghdr.htm](http://www.mpgedit.org/mpgedit/mpeg_format/mpeghdr.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T01:02:41.913

检查这个[MP3Header Class](http://www.devhood.com/tutorials/tutorial_details.aspx?tutorial_id=79)，它有一个方法告诉你 mp3 文件是否是 VBR，以及所有 mp3 头信息...

```
...
boolVBitRate = LoadVBRHeader(bytVBitRate);
... 
```

# c# - 使用 SqlBulkCopy 填充非常大的表的最佳方法是什么？

> ID：196420
> 
> 赞同：2
> 
> 时间：2008-10-13T00:45:15.893
> 
> 标签：c#, .net, sql-server, vb.net, sqlbulkcopy

每晚，我需要从 ODBC 源中填充一个 SQL Server 2005 表，其中包含超过 800 万条记录。目前我正在使用来自链接服务器的插入语句，其语法选择类似于：

```
Insert Into SQLStagingTable from Select * from OpenQuery(ODBCSource, 'Select * from SourceTable') 
```

这确实效率低下，需要数小时才能运行。我正在使用类似于[此问题](https://stackoverflow.com/questions/127152/how-to-change-slow-parametrized-inserts-into-fast-bulk-copy-even-from-memory)中的代码的 SqlBulkInsert 代码编写解决方案。

该问题中的代码首先在内存中填充数据表，然后将该数据表传递给 SqlBulkInserts WriteToServer 方法。

如果填充的数据表使用的内存比它正在运行的机器上的可用内存多（在我的情况下是 16GB 内存的服务器），我该怎么办？

我考虑过使用重载的 ODBCDataAdapter[填充](http://msdn.microsoft.com/en-us/library/59wzthcw(VS.80).aspx)方法，该方法允许您仅填充从 x 到 n 的记录（其中 x 是起始索引，n 是要填充的记录数）。然而，这可能是一个比我目前拥有的更慢的解决方案，因为这意味着在源上多次重新运行 select 语句。

我该怎么办？只需一次填充整个内容并让操作系统管理内存？我应该分块填充它吗？还有其他我没有想到的解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T00:54:12.820

最简单的方法是对您的 odbc 数据源使用 ExecuteReader() 并将[IDataReader](http://msdn.microsoft.com/en-us/library/system.data.idatareader.aspx)传递给[WriteToServer(IDataReader)](http://msdn.microsoft.com/en-us/library/434atets.aspx)重载。

大多数数据读取器实现只会将总结果的一小部分保留在内存中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T02:20:38.043

SSIS 表现良好并且非常可调整。以我的经验，800 万行并没有超出它的范围。我的一个较大的 ETL 每天处理 2400 万行，并进行主要的转换和维度数据仓库操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T02:42:00.200

如果您在目标表上有索引，您可能会考虑禁用这些索引，直到插入记录？

# c# - 给定 IntPtr 句柄，更改 Window 背景颜色

> ID：196422
> 
> 赞同：2
> 
> 时间：2008-10-13T00:46:29.370
> 
> 标签：c#, .net, windows, graphics, gdi

在 c# 中，我有一个窗口句柄（一个 IntPtr ），我想更改该窗口的背景颜色。我怎样才能做到这一点？

我可以像这样获取该句柄的 GDI 图形对象：

图形图形 = Graphics.FromHwnd(theHandle);

所以我应该能够以某种方式改变背景颜色？

我还想确保即使在窗口移动、调整大小、重新绘制等之后背景颜色仍然存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T16:23:51.367

我认为没有办法直接使用本机 (C/C++) 窗口（即没有与 Control.BackColor 类似的本机 GDI）来执行此操作。

从 Reflector 中看，Control 似乎使用 BackColor 属性来响应各种[WM_CTLCOLOR](http://msdn.microsoft.com/en-us/library/bb432504.aspx) * 消息（例如 WM_CTLCOLOREDIT）。因此，如果您想更改本机控件的背景颜色，您可能需要对该窗口进行子类化并响应相同的消息。如果本机窗口不是控件，您仍然需要对窗口进行子类化，但您必须改为处理[WM_PAINT](http://msdn.microsoft.com/en-us/library/ms534901(VS.85).aspx)或[WM_ERASEBKGND](http://msdn.microsoft.com/en-us/library/ms648055(VS.85).aspx)。

试试[programmersheaven.com 上的这个线程，](http://www.programmersheaven.com/mb/csharp/216293/216293/subclass-an-unmanged-window-in-c-/?S=B20000)以获取有关如何从C# 子类化本机窗口的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T02:33:33.367

使用 Control.FromHandle 方法创建一个控件类，然后设置属性。

就像是...

```
    控制 someControl = Control.FromHandle(myHandle);
    someControl.BackColor = SystemColors.Black；

```

# error-handling - 正确使用 try .. catch

> ID：196424
> 
> 赞同：6
> 
> 时间：2008-10-13T00:48:12.177
> 
> 标签：error-handling

我应该使用这种抛出错误的方法：

```
if (isset($this->dbfields[$var])) {
    return $this->dbfields[$var];
} else {
    throw new FieldNotFoundException($var);
} 
```

或这种风格：

```
try {
    return $this->dbfields[$var];
} catch (Exception $e) {
    throw new FieldNotFoundException($var);
} 
```

……还是别的什么？

*快速解释代码：* `$this->dbfields`是一个数组。`isset()`检查是否设置了变量，在这种情况下，检查数组元素是否存在。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-13T00:52:08.313

第二个例子不好。正如您所演示的，当您首先要防止异常时，您会花费大量开销来捕获异常。另外，您还假设您知道引发该异常的原因 - 如果有其他异常，例如内存不足或其他什么，即使不是，您也会将其报告为“未找到字段”。

请记住， C++ 和 Java 等语言中的`try`/`catch`非常昂贵，因为它们必须保存和恢复所有状态。另一方面，Python 有非常便宜的异常，它们积极鼓励您使用`try`/`except`进行简单验证。但即便如此，捕捉一切并假装它是一种异常仍然很糟糕。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-13T00:53:41.493

```
//First let's do the checks.
if(!isset($this->dbfields[$var]))
    throw new FieldNotFoundException($var);
//Now we're in the clear!
return $this->dbfields[$var]; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-13T00:52:09.577

在大多数情况下，捕捉“异常”并不是一个好习惯，在您显示的两个中，我会使用选项 1。

捕获所有异常可能会隐藏不同的异常并将其屏蔽为 FileNotFoundException。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T00:53:51.150

我更喜欢第一个，但如果 dbfields[$var] 在您访问不存在的元素时抛出一些合理的东西，那么我宁愿只返回它而不检查。

我不是特别喜欢更改异常类型，除非我有充分的理由——如果你这样做了，请确保尝试保留原始异常和堆栈跟踪。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T00:54:43.957

只需重新阅读您的解释。

我猜你在#1 中的方法将捕获任何可能抛出的异常并简单地返回一个布尔值。我绝对不喜欢大多数时候捕获通用异常，所以＃2不会是我的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T01:08:39.967

“……还是别的什么？”

两者都不是很好，所以其他东西是合适的。

修复版本 2 以捕获正确的异常，而不是所有可能的异常。将其作为选项 3 发布。我将支持捕获特定异常而不是`Exception`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T01:17:46.687

这与语言无关。

Some languages won't throw errors for accessing non-existant fields, and the preferred pattern depends a lot on the implementations of the arrays, tables, objects, etc.

# types - What is a type and effect system?

> ID：196465
> 
> 赞同：15
> 
> 时间：2008-10-13T01:22:52.777
> 
> 标签：types, effects, type-systems, type-theory, effect-systems

The [Wikipedia article on *Effect system*](http://en.wikipedia.org/wiki/Effect_system) is currently just a short stub and I've been wondering for a while as to what is an effect system.

*   Are there any languages that have an effect system in addition to a type system?
*   What would a possible (hypothetical) notation in a **mainstream** language, that you're familiar, with look like with effects?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-13T04:56:49.817

A "type and effect system" describes not only the kinds of values in a program, but the changes in those values. "Typestate" checking is a related idea.

An example might be a type system that tracks file handles: instead of having a function `close` with return type `void`, the type system would record the *effect* of `close` as disposing of the file resource—any attempt to read from or write to the file after calling `close` would become a type error.

I'm not aware of any type and effect system appearing in a mainstream programming language. They have been used to define static analyses (for example, it's quite natural to define an analysis for proper locking/unlocking in terms of effects). As such, effect systems are usually defined using inference schemes rather than concrete syntax. You could imagine a syntax looking something like

```
File open(String name) [+File]; // open creates a new file handle
void close(File f)     [-f]   ; // close destroys f 
```

If you want to learn more, the following papers might be interesting (fair warning: the papers are quite theoretical).

*   [Types for Atomicity: Static Checking and Inference for Java](http://slang.soe.ucsc.edu/cormac/papers/atomic-toplas.pdf). Flanagan, Freund, Lipshin, and Qadeer.
*   [Enforcing High-Level Protocols in Low-Level Software](http://research.microsoft.com/~maf/Papers/pldi01.pdf). Robert DeLine and Manuel Fändrich.
*   [Type and Effect Systems](http://www.cs.ucla.edu/~palsberg/tba/papers/nielson-nielson-csd99.pdf). Nielson and Nielson.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T01:44:17.540

(This is not an authoritative answer; just trying to trawl my memory.)

In a sense, any time you code a 'state monad' in a language, you're using the type system as a potential effect system. So "State" or "IO" in Haskell capture this notion (IO captures a whole lot of other effects as well). I vaguely remember reading papers about various languages that use advanced type systems including things like "dependent types" to control finer-grained management of effects, so that for instance the type/effect system could capture information about which memory locations would be modified in a given data type. This is useful, as it provides ways to make two functions that modify mutually exclusive bits of state be allowed to "commute" (monads don't typically commute, and different monads don't always compose well with one another, which often makes it hard to type (read: assign a static type to) 'reasonable' programs)...

An analogy at a *very* hand-wavy level is how Java has checked exceptions. You express extra information in the type system about certain effects (you can think of an exception as an 'effect' for the purpose of the analogy), but these 'effects' typically leak out all over your program and don't compose well in practice (you end up with a million 'throws' clauses or else resort to lots of unchecked runtime exception types).

I think a lot of research is being done in this area, both for research-y and mainstream-y languages, as the ability to annotate functions with effect information can unlock the compiler's ability to do a number of optimizations, can impact concurrency, and can do great things for various program analyses and tooling. I don't personally have high hopes for it any time soon, though, as I think lots of smart people have been working on it for a long time and there's still very little to show for it.

# java - Cobertura 拒绝承认代码被覆盖

> ID：196468
> 
> 赞同：3
> 
> 时间：2008-10-13T01:32:03.210
> 
> 标签：java, maven-2, code-coverage, cobertura

我正在使用 Maven (2) Cobertura 插件来创建代码覆盖率报告，并且我在方法中使用了以下存根：

```
try {
    System.exit(0);
} catch (final SecurityException exception) {
    exception.printStackTrace();
}
System.err.println("The program never exited!"); 
```

我知道我需要记录异常等，但这不是现在的重点……Cobertura 拒绝承认打印堆栈跟踪后的行已被覆盖。也就是说，`System.err.println`语句之前带有“}”的行没有显示为已覆盖。之前，方法的结尾大括号没有显示为被覆盖，因此`System.err`声明。知道如何说服 cobertura 的 maven 插件，因为该`System.err.println`语句已被涵盖，因此必须涵盖结束大括号？

哦，是的，我使用模拟安全管理器来抛出安全异常，因为这是我发现的让测试在`System.exit`调用后继续执行的最简单方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T01:44:19.363

我会看报道。仔细检查我的测试。请注意，代码确实被覆盖了，不必担心达到 100%。代码覆盖率最好用于查找您可能忽略的测试区域，但只专注于获得 100% 的覆盖率作为目标是一个坏习惯，可能会导致您跳过需要编写的测试，因为您的工具显示100%。将工具用于它可以做的事情，但不要陷入让工具定义你所做的事情的陷阱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-13T02:00:21.767

在 Java 类文件格式中，每个方法都用一个表将代码偏移量映射到行号进行注释。在这种情况下，右大括号不会产生任何字节码，因此它没有被覆盖。这是源代码和字节码之间不完全对应的问题。它应该由覆盖工具处理，将此行识别为非代码。

我知道[艾玛](http://emma.sourceforge.net/)也有类似的问题。[Clover](http://www.atlassian.com/software/clover/)的情况要好得多，但是是商业的（不确定它是否也能处理这种情况）。如果您使用 IDEA，您应该尝试他们的[新覆盖实现](http://www.jetbrains.net/confluence/display/IDEADEV/IDEA+Coverage+Runner)- 它非常好并且正在积极开发中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T01:46:58.890

我有一段时间没有使用 Cobertura（2005 年？），当时看到了这种行为。C# 的 NCover 和 catch/finally 块之后的花括号也存在类似的问题。

我的建议是添加到[这个 Cobertura 错误报告中，详细说明类似的问题](http://sourceforge.net/tracker/index.php?func=detail&aid=1474067&group_id=130558&atid=720015)。此外，请遵循@tvanfosson 的建议，并意识到没有覆盖大括号（实际上并没有成为 JVM 中的任何内容）是您可以忽略的“噪音”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-28T17:44:35.147

我知道这是一个老问题，Cobertura 已经解决了这个问题，但是为了完整起见，“}”上的缺失覆盖是由内部自动“finally”块引起的。

如下所示查看您的代码：

```
try {
    System.exit(0);
} catch (final SecurityException exception) {
    exception.printStackTrace();
} finally {
    // noop
} 
```

幸运的是，某些版本不再发生这种情况。

# php - 自定义模块是在 Drupal 中访问外部 API 的最佳方式吗？

> ID：196471
> 
> 赞同：2
> 
> 时间：2008-10-13T01:34:31.630
> 
> 标签：php, api, drupal

我是扩展 Drupal 的新手，尽管我为其他 CMS 做过类似的事情。有人愿意就从 Drupal 中访问外部 API 的最佳方式分享意见吗？

我需要显示搜索结果、列表和列表摘要等内容。在我阅读 Drupal 时，我认为这意味着我需要同时创建“节点”和“块”。这是正确的吗？从模块教程中我不清楚这是否可以在同一个模块中进行。

感谢您的任何帮助/建议！

更新：我找到了 Stock API 模块，它可以简单地说明我正在尝试做的事情。我将在那之后为我的模块建模。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T01:38:04.540

是的，它们都可以在同一个模块中实现；查阅各种[钩子函数](http://api.drupal.org/api/group/hooks/6)，了解如何在函数中声明节点和块。

还有 PHP 过滤器，它允许您在内容页面上嵌入纯 PHP 代码，并且不需要任何模块开发，但对于任何不重要的事情我不推荐它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T06:15:56.600

安德鲁 - 通常，您会希望将任何类型的重要代码放在外部模块中。除显示代码外，应将其放入与您的主题相关的 template.php 文件中。

如果您想更深入地描述您的项目，我可能会提出更有用的建议。

# sql - 识别 SQL 中的全年和半年数据集

> ID：196480
> 
> 赞同：1
> 
> 时间：2008-10-13T01:39:44.770
> 
> 标签：sql, sql-server-2005, tsql

对于这个特定的练习，我有一个包含两个感兴趣的字段的表：一个 CHAR(3) ID 和一个 DATETIME。ID 标识数据的提交者 - 数千行。DATETIME 也不一定是唯一的。（主键是表的其他字段。）

该表的数据每六个月提交一次。在 12 月，我们会收到来自每个提交者的 7 月至 12 月的数据，而在 6 月，我们会收到 7 月至 6 月的数据。我的任务是编写一个脚本来识别只提交了一半数据的人，或者只在 6 月份提交了 1 月至 6 月数据的人。

...有没有人有办法解决吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T01:58:01.940

根据您的描述，我不会担心查询的效率，因为显然它每年只需要运行两次！

有几种方法可以做到这一点，哪一种“最好”取决于您拥有的数据。您建议的 datediff （关于最大/最小日期值）应该可以工作，另一种选择是只计算每个日期范围内提交的每个记录，例如

```
select * from (
    select T.submitterId,
        (select count(*) 
        from TABLE T1
        where T1.datefield between [july] and [december]
        and T1.submitterId = T.submitterId
        group by T1.submitterId) as JDCount,
        (select count(*)
        from TABLE T2
        where T2.datefield between [december] and [june]
        and T2.submitterId = T.submitterId
        group by T2.submitterId) as DJCount
    from TABLE T) X
where X.JDCount <= 0 OR X.DJCount <= 0 
```

警告：未经测试的查询在我脑海中浮现；你的旅费可能会改变

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T02:41:34.660

出于兴趣，这就是我最终使用的。它基于斯蒂芬的回答，但有一些改编。我还没有声望支持他。:)。

它是每六个月运行一次的较大脚本的一部分，但我们只每十二个月检查一次 - 因此是“如果 FullYear = 1”。我确信有一种更时尚的方式来识别边界日期，但这似乎有效。

```
IF @FullYear = 1 
    BEGIN
        DECLARE @FirstDate AS DATETIME
        DECLARE @LastDayFirstYear AS DATETIME
        DECLARE @SecondYear AS INT
        DECLARE @NewYearsDay AS DATETIME
        DECLARE @LastDate AS DATETIME

        SELECT @FirstDate = MIN(dscdate), @LastDate = MAX(dscdate)
        FROM    TheTable

        SELECT  @SecondYear = DATEPART(yyyy, @FirstDate) + 1
        SELECT  @NewYearsDay = CAST(CAST(@SecondYear AS VARCHAR) 
            + '-01-01' AS DATETIME)

        INSERT  INTO @AuditResults
                SELECT DISTINCT
                    'Submitter missing Jan-Jun data', t.id
                FROM    TheTable t
                WHERE   
                    EXISTS ( 
                        SELECT 1
                        FROM   TheTable t1
                        WHERE  t.id = t1.id 
                            AND t1.date >= @FirstDate
                            AND t1.date < @NewYearsDay )
                    AND NOT EXISTS ( 
                        SELECT 1
                        FROM   TheTable t2
                        WHERE  t2.date >= @NewYearsDay
                        AND t2.date <= @LastDate
                        AND t2.id = t.id
                        GROUP BY t2.id )
                GROUP BY t.id
    END 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T04:36:27.560

后来我意识到我应该检查以确保有*7*月至 12 月和 1 月至 6 月的数据。所以这就是我在 v2 中总结的内容：

```
SELECT  @avgmonths = AVG(x.[count])
FROM    ( SELECT    CAST(COUNT(DISTINCT DATEPART(month,
                                                 DATEADD(month,
                                                         DATEDIFF(month, 0, dscdate),
                                                         0))) AS FLOAT) AS [count]
          FROM      HospDscDate
          GROUP BY  hosp
         ) x

IF @avgmonths > 7 
    SET @months = 12
ELSE 
    SET @months = 6

SELECT  'Submitter missing data for some months' AS [WarningType],
     t.id
FROM    TheTable t
WHERE   EXISTS ( SELECT 1
                 FROM   TheTable t1
                 WHERE  t.id = t1.id
                 HAVING COUNT(DISTINCT DATEPART(month,
                       DATEADD(month, DATEDIFF(month, 0, t1.Date), 0))) < @months )
GROUP BY t.id 
```

# php - 如何在 CakePHP 中编写复杂的查找查询而不使用 `$this->Model->query()`？

> ID：196488
> 
> 赞同：0
> 
> 时间：2008-10-13T01:42:18.353
> 
> 标签：php, mysql, cakephp

嘿，我希望有人对 Cake PHP 有足够的经验来完成这项工作。

我正在做一些目前可以被亲切地称为 twitter 克隆的东西。基本上我有这样的设置。

用户有很多朋友。这是与用户表的多对多关系。它存储在名为friends_users 的链接表中，列有user_id、friend_id。用户是一个包含 user_id 列的表。

然后我有一个与用户相关联的名为tips 的表。一个用户可以有很多提示。

我想找到一种在 Tip 模型上进行查找的方法，该模型返回我传入的用户 ID 拥有的所有提示以及该用户的任何朋友拥有的任何提示。

此 SQL 查询完美运行 -

```
SELECT *
FROM `tips`
JOIN users ON users.id = tips.user_id
JOIN friends_users ON tips.user_id = friends_users.friend_id
WHERE (friends_users.user_id =2 or tips.user_id=2)
LIMIT 0 , 30 
```

这将返回 user#2s Tips 以及 User 2 的朋友的任何人的tips。

现在我怎么能做同样的事情使用`$this->Tip->findxxxxx(user_id)`

我知道`Tip->query`如果需要我可以使用，但我正在努力学习。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T08:52:30.437

如果您在查询结果中只需要一个提示列表，我很想在 2 个查询中执行此操作。第一个查找此用户及其朋友的用户 ID 列表，第二个查找属于这些 ID 中的任何一个的提示。因此，在您的 Tip 模型中：

```
function findTipsByUserAndFriends($userId) {
  //FriendsUser is automagically created by CakePHP "with" association
  $conditions = array('FriendsUser.user_id'=>$userId);
  $fields = 'FriendsUser.friend_id';
  //get a list friend ids for the given user
  $friendIds = $this->Tip->User->FriendsUser->find('list', compact('conditions', 'fields'));
  //get list of all userIds for whom you want the tips
  $userIds = array($userId) + $friendIds;
  $conditions = array('Tip.user_id'=>$userIds);
  $tips = $this->Tip->find('all', compact('conditions'));
  return $tips;
} 
```

请注意，您调用的是自动创建的“FriendsUser”模型上的第一个 find，CakePHP 使用该模型对您的 HABTM friends_users 表进行建模，因此您不需要创建它。

这是未经测试的，因此您可能需要调试其中的一些，但您明白了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-15T09:55:50.823

我建议您使用可包含的，它效果很好。

```
$aCond = array(
            'fields' => array(
                'Discount.*'
            ),
            'contain' => array(
                'Event' => array(
                    'conditions' => array('Event.id' => $iEventId)
                )
            )
        );
$aBulkDiscounts = $this->Discount->find('first', $aCond); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T01:50:09.413

在 CakePHP 中，多对多是“Has And Belongs To Many”（HABTM）。假设您已经正确设置了关系，那么您需要做的是进行两级递归查找，这样您找到的朋友会检索他们的所有朋友，并且这些朋友会加载他们的提示。您可能必须动态绑定/取消绑定模型以防止这些朋友获得他们的朋友（尽管在实践中这可能不是太大的问题）。

必须阅读有关关联的[手动条目。](http://manual.cakephp.org/view/78/Associations-Linking-Models-Together)

# spring - 如何配置spring HandlerExceptionResolver来处理jsp中抛出的NullPointerException？

> ID：196495
> 
> 赞同：10
> 
> 时间：2008-10-13T01:48:01.540
> 
> 标签：spring, jsp, exception-handling

从 jsp 抛出 NullPointerException 例如使用 `<% null.toString(); %>`

此异常不由 HandlerExceptionResolver 处理，而是抛出到 web 容器（tomcat）并转换为`code 500 error`.

如何配置 spring 以在我的 HandlerExceptionResolver 中获取该错误？

细节：

*   Spring 可以配置为处理控制器内部抛出的异常，但不能处理视图抛出的异常。
*   当然，我可以解决 NullPointerException，但我想设计一个解决方案来优雅地解决 Web 应用程序上的任何可能问题，以便向用户显示用户友好的消息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T05:34:39.287

请参阅[HandlerInterceptor](http://static.springframework.org/spring/docs/1.2.x/api/org/springframework/web/servlet/HandlerInterceptor.html)接口。您将需要 afterCompletion 方法。然后，您可以拦截响应，然后设置适当的标头信息以重定向到容器配置的错误网页。没错，Spring 没有此功能，这必须由 web.xml 指定，它确定哪些代码映射到哪些页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T03:24:42.797

我没有使用过这个特定的spring框架，但是文档说

“由对象实现的接口，可以解决处理程序映射或执行期间抛出的异常，在典型情况下是错误视图。实现者通常在应用程序上下文中注册为 bean。

错误视图类似于错误页面 JSP，但可以与任何类型的异常一起使用，包括任何已检查的异常，并具有针对特定处理程序的潜在细粒度映射。”

所以我想，鉴于 NullPointer 扩展了 RuntimeException 框架并不是为了捕捉它而设计的。是否有原因无法直接在控制器中处理异常？

# javascript - 如何将文本文件的内容加载到 javascript 变量中？

> ID：196498
> 
> 赞同：191
> 
> 时间：2008-10-13T01:57:13.627
> 
> 标签：javascript

我的网络应用程序*[http://localhost/foo.txt](http://localhost/foo.txt)*的根目录中有一个文本文件，我想将它加载到 javascript 中的变量中。在 groovy 中我会这样做：

```
def fileContents = 'http://localhost/foo.txt'.toURL().text;
println fileContents; 
```

如何在 javascript 中获得类似的结果？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-10-13T02:02:19.920

XMLHttpRequest，即AJAX，没有XML。

您执行此操作的确切方式取决于您使用的 JavaScript 框架，但如果我们忽略互操作性问题，您的代码将类似于：

```
var client = new XMLHttpRequest();
client.open('GET', '/foo.txt');
client.onreadystatechange = function() {
  alert(client.responseText);
}
client.send(); 
```

不过，通常来说，XMLHttpRequest 并非在所有平台上都可用，所以有些捏造。再一次，您最好的选择是使用像 jQuery 这样的 AJAX 框架。

一个额外的考虑：这只会在 foo.txt 在同一个域上时起作用。如果它在不同的域中，同源安全策略将阻止您读取结果。

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2008-10-13T02:25:39.687

这是我在 jquery 中的做法：

```
jQuery.get('http://localhost/foo.txt', function(data) {
    alert(data);
}); 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2018-04-05T19:31:42.267

## 2019 年更新：使用 Fetch：

```
fetch('http://localhost/foo.txt')
  .then(response => response.text())
  .then((data) => {
    console.log(data)
  }) 
```

[https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2016-08-17T22:54:44.670

如果您只想要文本文件中的常量字符串，则可以将其包含为 JavaScript：

```
// This becomes the content of your foo.txt file
let text = `
My test text goes here!
`;
```

```
<script src="foo.txt"></script>
<script>
  console.log(text);
</script>
```

从文件加载的字符串在加载后可供 JavaScript 访问。`（反引号）字符开始和结束[模板文字](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Template_literals)，允许在文本块中同时使用 " 和 ' 字符。

当您尝试在本地加载文件时，此方法效果很好，因为 Chrome 不允许使用该`file://`方案的 URL 上的 AJAX。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2020-04-13T19:33:26.027

# 2020 年更新：将[Fetch](https://wiki.developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)与 async/await 结合使用

```
const response = await fetch('http://localhost/foo.txt');
const data = await response.text();
console.log(data); 
```

注意`await`只能在一个`async`函数中使用。一个更长的例子可能是

```
async function loadFileAndPrintToConsole(url) {
  try {
    const response = await fetch(url);
    const data = await response.text();
    console.log(data);
  } catch (err) {
    console.error(err);
  }
}

loadFileAndPrintToConsole('https://threejsfundamentals.org/LICENSE');
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2018-04-05T13:35:47.633

这应该适用于几乎所有浏览器：

```
var xhr=new XMLHttpRequest();
xhr.open("GET","https://12Me21.github.io/test.txt");
xhr.onload=function(){
    console.log(xhr.responseText);
}
xhr.send(); 
```

此外，还有新的`Fetch`API：

```
fetch("https://12Me21.github.io/test.txt")
.then( response => response.text() )
.then( text => console.log(text) ) 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-12-22T00:13:00.113

要记住的一件事是 Javascript 在客户端上运行，而不是在服务器上。您不能真正从 Javascript 中的服务器“加载文件”。发生的情况是 Javascript 向服务器发送请求，服务器将请求文件的内容发回。Javascript 如何接收内容？这就是回调函数的用途。在爱德华的情况下，即

```
 client.onreadystatechange = function() { 
```

在 danb 的情况下，它是

```
 function(data) { 
```

每当数据碰巧到达时，都会调用此函数。jQuery 版本隐式使用 Ajax，它只是通过将代码封装在库中来简化编码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-12-27T03:14:38.907

使用 jQuery 时，而不是使用`jQuery.get`，例如

```
jQuery.get("foo.txt", undefined, function(data) {
    alert(data);
}, "html").done(function() {
    alert("second success");
}).fail(function(jqXHR, textStatus) {
    alert(textStatus);
}).always(function() {
    alert("finished");
}); 
```

您可以使用`.load`它为您提供更简洁的形式：

```
$("#myelement").load("foo.txt"); 
```

`.load`您还可以选择加载可以派上用场的部分页面，请参阅[api.jquery.com/load/](http://api.jquery.com/load/)。

# wordpress - 配置 WordPress .htaccess 以查看子文件夹

> ID：196500
> 
> 赞同：16
> 
> 时间：2008-10-13T01:58:07.480
> 
> 标签：wordpress, .htaccess

我有一个 WordPress 安装，其`.htaccess`文件如下所示：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress 
```

我尝试将 WordPress 的新副本安装到单独博客的子目录中，当我尝试查看它时，在根 WordPress 中出现 404 错误。我假设这是因为`.htaccess`文件。

如何更改它以便我可以查看子文件夹？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-11-07T20:46:57.470

为了将来参考，您可能想试试这个：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /blog2/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /blog2/index.php [L]
</IfModule>
# END WordPress 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T02:27:15.237

**编辑#2**：好的，我想我想通了，但它很乱。

修改您的基本 wordpress 安装的 .htaccess 文件，如下所示：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteCond %{REQUEST_URI} !^/blog2/.*
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.php [L]
</IfModule>
# END WordPress 
```

现在，将 wordpress 的新副本加载到“blog2/”中，然后将`wp-config.php`文件复制到其中。编辑“/blog2/wp-config.php”文件并将其更改为`$table_prefix`与您的第一个博客不同的内容。（这会将两个 wordpress 安装到同一个数据库中）。

一旦你这样做了，你应该能够去：

```
http://yourdomain.com/blog2/ 
```

并顺利完成安装。最初的问题是 wordpress 的新副本一直试图使用第一个副本的`wp-config.php`文件。手动将其移过来修复了所有问题。

因为我疯了，我用两份新副本对此进行了测试，写了一些测试文章，并且能够毫无问题地导航，所以它应该可以工作:)

# php - 使用带有页面而不是帖子的 Wordpress LOOP？

> ID：196505
> 
> 赞同：33
> 
> 时间：2008-10-13T02:00:51.110
> 
> 标签：php, wordpress

有没有办法在**Wordpress中使用****THE LOOP**来加载页面而不是帖子？

 **我希望能够查询一组子页面，然后对它使用**THE LOOP**函数调用 - 像`the_permalink()`and之类的东西`the_title()`。

有没有办法做到这一点？我在文档中没有看到任何`query_posts()`内容。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-10-13T04:47:51.303

是的，这是可能的。您可以创建一个新的 WP_Query 对象。做这样的事情：

```
query_posts(array('showposts' => <number_of_pages_to_show>, 'post_parent' => <ID of the parent page>, 'post_type' => 'page'));

while (have_posts()) { the_post();
    /* Do whatever you want to do for every page... */
}

wp_reset_query();  // Restore global post data 
```

**补充**：还有很多其他参数可以与 query_posts 一起使用。一些，但不幸的是不是全部，都列在这里：[http](http://codex.wordpress.org/Template_Tags/query_posts) ://codex.wordpress.org/Template_Tags/query_posts 。至少`post_parent`和更重要*`post_type`*的没有列在那里。我挖掘了来源`./wp-include/query.php`以了解这些。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2014-02-13T08:19:11.423

考虑到这个问题的年龄，我想为任何偶然发现它的人提供一个更新的答案。

我建议避免使用 query_posts。这是我更喜欢的替代方案：

```
$child_pages = new WP_Query( array(
    'post_type'      => 'page', // set the post type to page
    'posts_per_page' => 10, // number of posts (pages) to show
    'post_parent'    => <ID of the parent page>, // enter the post ID of the parent page
    'no_found_rows'  => true, // no pagination necessary so improve efficiency of loop
) );

if ( $child_pages->have_posts() ) : while ( $child_pages->have_posts() ) : $child_pages->the_post();
    // Do whatever you want to do for every page. the_title(), the_permalink(), etc...
endwhile; endif;  

wp_reset_postdata(); 
```

另一种选择是使用 pre_get_posts 过滤器，但这仅适用于需要修改主循环的情况。上述示例在用作辅助循环时效果更好。

进一步阅读：[http ://codex.wordpress.org/Class_Reference/WP_Query](http://codex.wordpress.org/Class_Reference/WP_Query)

# lucene.net - 删除 Lucene.net 中的所有索引

> ID：196509
> 
> 赞同：7
> 
> 时间：2008-10-13T02:02:17.440
> 
> 标签：lucene.net

我想删除**所有**以前创建的索引。我正在使用`Lucene.net`.

我尝试了以下方法：

```
Term term = new Term(); //empty because I want to delete all the indices
IndexReader rdr = IndexReader.Open(_directory);

rdr.DeleteDocuments(term);
rdr.Close(); 
```

但我得到错误。知道该怎么做吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-23T13:55:59.007

删除索引的最佳方法是擦除文件系统目录。但是，如果您不想重新生成索引，最简单的方法是打开一个新的 indexwriter，并将 create 参数设置为 true。它将启动一个新索引，删除现有索引的内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-11-22T09:13:45.227

虽然线程很旧，但我认为最好给出答案..可能对其他人有用。IndexWriter 的 deleteAll() 方法可用于删除所有索引的文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-14T00:11:32.843

正如 Jokin 所说，最简单的方法是删除目录中的所有文件。IE;

```
DirectoryInfo directoryInfo = new DirectoryInfo(@"IndexLocation");
Parallel.ForEach(directoryInfo.GetFiles(), file => {
            file.Delete();
        }); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-15T10:44:23.007

来自[Lucene.Net API 文档](http://lucene.apache.org/lucene.net/docs/2.4.0/)：

> `public static IndexReader Open(Directory);`
> 
> Expert：返回一个读/写 IndexReader 读取给定目录中的索引，并带有自定义 IndexDeletionPolicy。注意：从 3.0 开始，这将返回一个**只读**的IndexReader。如果索引损坏，则引发 CorruptIndexException。如果存在低级 IO 错误，则引发 IOException。

我想你应该试试

```
IndexReader rdr = IndexReader.Open(_directory, true); 
```

# c# - .NET 中有排序的集合类型吗？

> ID：196512
> 
> 赞同：25
> 
> 时间：2008-10-13T02:05:47.307
> 
> 标签：c#, .net, sorting, containers

我正在寻找一个能够将所有物品保持有序的容器。我查看了 SortedList，但这需要一个单独的键，并且不允许重复键。我也可以只使用一个未排序的容器，并在每次插入后对其进行显式排序。

用法：

*   偶尔插入
*   按顺序频繁遍历
*   理想情况下，不要使用与实际对象分开的键，使用比较函数进行排序。
*   需要对等效对象进行稳定排序，但不是必需的。
*   不需要随机访问。

我意识到我可以为自己构建一个平衡的树结构，我只是想知道框架是否已经包含这样一个野兽。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-13T02:25:29.250

您可能想看看[Wintellect Power Collections](http://www.codeplex.com/PowerCollections)。它在 CodePlex 上可用，并且包含很多非常有用的集合。项目中的 OrderedBag 集合正是您要寻找的。它本质上使用[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)来提供非常有效的排序。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-02-07T09:20:43.660

只是为了让[EBarr 的评论](https://stackoverflow.com/questions/196512/is-there-a-sorted-collection-type-in-net/198699#comment10376249_196549)[`SortedSet<T>`](http://msdn.microsoft.com/en-us/library/dd412070%28v=vs.100%29.aspx)作为答案，从 .NET 4.0 开始就有了。当然它是一个集合，这意味着你不能有重复。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-24T08:47:58.783

如果您只想坚持使用标准集合，那么该类的`Sort(IComparer<>)`功能通常会被忽略。`List<>`您需要做的就是创建一个适合`Comparer<>`您的对象。例如：

```
public class PositionDateComparer : IComparer<VehiclePosition>
{
    public int Compare(VehiclePosition x, VehiclePosition y)
    {
        if (x.DateTime == DateTime.MinValue)
        {
            if (y.DateTime == DateTime.MinValue)
            {
                // If x is null and y is null, they're
                // equal. 
                return 0;
            }

            // If x is null and y is not null, y
            // is greater. 
            return -1;
        }

        // If x is not null...
        //
        if (y.DateTime == DateTime.MinValue)
        // ...and y is null, x is greater.
        {
            return 1;
        }

        // ...and y is not null, compare the dates
        //
        if (x.DateTime == y.DateTime)
        {
            // x and y are equal
            return 0;
        }

        if (x.DateTime > y.DateTime)
        {
            // x is greater
            return 1;
        }

        // y is greater
        return -1;
    }
} 
```

`vehiclePositionsList.Sort(new PositionDateComparer())`然后，只要您想在访问列表之前对列表进行排序，只需执行 a即可。我意识到这可能不像每次添加新对象时都会自动排序的容器那么简单，但对于许多人（比如我！）来说，这可能足以成功完成这项工作而无需任何额外的库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-13T02:35:34.220

正如您所提到的，我会扩展您自己的列表类，只需在每次插入后进行排序。由于您的插入不频繁，因此对性能的影响很小，并且无论如何对几乎排序的列表进行排序是很快的。扩展通用列表并覆盖 Add 方法以立即排序。如果性能成为问题，您可以插入到位以节省一些时间。此外，您可以对插入进行排队，以便对要插入的所有值进行一次遍历插入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T19:15:22.270

[正如我今天早些时候在这里](https://stackoverflow.com/questions/198079/where-can-i-learn-about-the-various-types-of-net-lists#198683)提到的，[C5 通用集合库](http://www.itu.dk/research/c5/)为您提供了合适的容器。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-13T02:18:37.360

如果键也是对象的属性，您可以尝试使用`System.Collections.ObjectModel.KeyedCollection<TKey, TItem>`. 它是一个抽象类，但如果您的密钥只是项目的一个属性，那么它的派生非常简单。

* * *

## 回答 #7

> 赞同：-15
> 
> 时间：2008-10-13T03:08:58.913

这是我在 VB6 中用来按字母顺序排序的一个老技巧：使用 System.Windows.Forms ListBox 对象，并将其“Sorted”属性设置为 true。在 C# 中，您可以将任何对象插入到列表框中，它会按对象的 ToString() 值按字母顺序对对象进行排序：

对于类模块：

* * *

使用 System.Windows.Forms；

```
 static void Main(string[] args)
    {
        ListBox sortedList = new ListBox();
        sortedList.Sorted = true;

        sortedList.Items.Add("foo");
        sortedList.Items.Add("bar");
        sortedList.Items.Add(true);
        sortedList.Items.Add(432); 

        foreach (object o in sortedList.Items)
        {
            Console.WriteLine(o);
        }

        Console.ReadKey();
    } 
```

* * *

这将显示：

第432
章
真

# c# - .NET 中的动态控件问题

> ID：196518
> 
> 赞同：15
> 
> 时间：2008-10-13T02:07:56.430
> 
> 标签：c#, asp.net, dynamic, controls, viewstate

动态控制的问题

大家好，

我想创建一些动态控件，并让它们在页面加载时保持其视图状态。很容易，对吧？我所要做的就是在每次页面加载时使用相同的 ID 重新创建控件。但是，这是一个问题 - 在我的 PreRender 事件中，我想清除控件集合，然后使用新值重新创建动态控件。造成这种情况的原因很复杂，我可能要花一页左右的时间来解释我为什么要这样做。所以，为了简洁起见，让我们假设我绝对必须这样做，并且没有其他方法。

在我在 PreRender 事件中重新创建控件后，问题就出现了。重新创建的控件永远不会绑定到视图状态，并且它们的值不会在页面加载时保持不变。我不明白为什么会这样。我已经在我的 OnLoad 事件中重新创建了控件。当我这样做时，只要我每次都使用相同的 ID，新创建的控件就可以很好地绑定到 ViewState。但是，当我尝试在 PreRender 事件中做同样的事情时，它失败了。

无论如何，这是我的示例代码：

命名空间 TestFramework.WebControls {

```
public class ValueLinkButton : LinkButton
{
    public string Value
    {
        get
        {
            return (string)ViewState[ID + "vlbValue"];
        }

        set
        {
            ViewState[ID + "vlbValue"] = value;
        }
    }
}

public class TestControl : WebControl
{
    protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);

        Controls.Clear();

        ValueLinkButton tempLink = null;

        tempLink = new ValueLinkButton();
        tempLink.ID = "valueLinkButton";
        tempLink.Click += new EventHandler(Value_Click);

        if (!Page.IsPostBack)
        {
            tempLink.Value = "old value";
        }

        Controls.Add(tempLink);
    }

    protected override void OnPreRender(EventArgs e)
    {
        base.OnPreRender(e);

        ValueLinkButton tempLink = ((ValueLinkButton)FindControl("valueLinkButton"));  //[CASE 1]

        //ValueLinkButton tempLink = new ValueLinkButton();  [CASE 2]

        tempLink.ID = "valueLinkButton";
        tempLink.Value = "new value";
        tempLink.Text = "Click";            

        Controls.Clear();
        Controls.Add(tempLink);
    }

    void Value_Click(object sender, EventArgs e)
    {
        Page.Response.Write("[" + ((ValueLinkButton)sender).Value + "]");
    }
} 
```

}

因此，让我们检查案例 1，其中 [CASE 1] 旁边的行没有被注释掉，但 [CASE 2] 旁边的行被注释掉了。在这里，一切正常。当我将此控件放在页面上并加载页面时，我看到一个显示“单击”的链接。当我点击链接时，页面输出文本“[new value]”，在下一行，我们看到熟悉的“Click”链接。每次我点击“点击”链接时，我们都会看到同样的事情。到现在为止还挺好。

但是现在让我们检查案例 2，其中 [CASE 1] 旁边的行被注释掉了，但 [CASE 2] 旁边的行没有被注释掉。在这里，我们遇到了问题。当我们加载页面时，我们会看到“点击”链接。但是，当我单击链接时，页面会输出文本“[]”而不是“[新值]”。点击事件正常触发。但是，我分配给控件的 Value 属性的“新值”文本不会保留。再一次，这对我来说有点神秘。为什么，当我在 OnLoad 中重新创建控件时，一切都很好，但当我在 PreRender 中重新创建控件时，值不会被持久化？

我觉得必须有一种方法可以做到这一点。当我在 PreRender 中重新创建控件时，有没有办法将新创建的控件绑定到 ViewState？

我已经为此苦苦挣扎了好几天。您能给我的任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-13T07:56:53.887

只有当控件当前正在跟踪 ViewState 时，ViewState 支持的属性才会持久保存到 ViewState。这是为了使 ViewState 尽可能小而设计的：它应该只包含真正动态的数据。这样做的结果是：

在 Init 事件期间设置的 ViewState 属性*不*支持 ViewState（因为页面尚未开始跟踪 ViewState）。因此，Init 是添加控件和设置 (a) 不会在回发（ID、CssClass...）之间更改的属性以及动态属性的初始值（然后可以通过其余代码中的代码修改）的好地方页面生命周期 - 加载、事件处理程序、PreRender）。

在 Load 或 PreRender 中动态添加控件时，正在跟踪 ViewState。然后，开发人员可以控制为动态添加的控件保留哪些属性，如下所示：

*   在将控件添加到页面的控件树之前设置的属性不会持久保存到 ViewState。您通常在将控件添加到控件树之前设置非动态属性（ID 等）。

*   将控件添加到页面的控件树后设置的属性将持久保存到 ViewState（从 Load 事件之前到 PreRender 事件之后启用 ViewState 跟踪）。

在您的情况下，您的 PreRender 处理程序在将控件添加到页面的控件树之前设置属性。要获得您想要的结果，请在将控件添加到控件树后设置动态属性： 。

```
protected override void OnPreRender(EventArgs e)
{
    base.OnPreRender(e);
    ValueLinkButton tempLink = new ValueLinkButton(); // [CASE 2]        
    tempLink.ID = "valueLinkButton"; // Not persisted to ViewState
    Controls.Clear();
    Controls.Add(tempLink);
    tempLink.Value = "new value";  // Persisted to ViewState
    tempLink.Text = "Click";       // Persisted to ViewState
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T02:58:43.863

正如其他人所说，您需要确保您是通过 Init 方法创建的。要了解有关 ASP.NET 页面生命周期的更多信息，请查看这篇文章：http: [//msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T02:14:54.060

> 我已经在我的 OnLoad 事件中重新创建了控件。

那是你的问题。OnLoad 为时已晚。请改用初始化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T02:20:33.910

感谢您的帮助，但我试过了，但没有任何影响。此外，OnLoad 与 OnInit 一样适用于动态控件，只要您每次都为控件提供相同的 ID。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T02:28:07.263

我相信，一旦您在 PageLoad 中将动态控件添加到页面，ViewState 就会绑定到控件，并且“ViewState 仍然需要绑定”标志（在概念上，不是实际标志）被清除。然后，当您重新创建控件时，现有的 ViewState 将不再绑定。

去年我遇到了类似的事情，只是在我的情况下，我不*希望*ViewState 重新绑定。我的问题是我*没有*重新创建以前的控件，这就是为什么我认为上面的伪标志概念适用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T02:35:29.807

尝试调用`Page.RegisterRequiresControlState()`. 您也可以使用`RequiresControlState()`它来检查它是否已经注册。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T03:08:22.063

ViewState 适用于 Page 及其子对象。[案例 2] 中的新控件尚未添加到页面（或其任何子项）。事实上，在上面的代码中，一旦 OnPreRender 方法结束，对象就会超出范围，并且会被垃圾回收。

如果您必须更换控件，则需要使用 Remove() 方法从其父控件中删除旧控件，并使用 AddAt() 在正确的位置添加新控件。

如果控件是父控件的唯一子控件，则代码将类似于以下内容。

```
ValueLinkButton tempLink = new ValueLinkButton();
Control parent = FindControl("valueLinkButton").Parent;
parent.Remove(FindControl("valueLinkButton"));
parent.AddAt(0, tempLink); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T19:55:25.387

在控件生命周期中调用 SaveViewState 方法之前添加的控件应保持其值。我同意乔的回答。检查此图像

[http://emanish.googlepages.com/Asp.Net2.0Lifecycle.PNG](http://emanish.googlepages.com/Asp.Net2.0Lifecycle.PNG)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-16T13:24:28.520

我昨天发现，您实际上可以通过在 loadviewstateevent 触发后立即加载控件树来使您的应用程序正常工作。如果您覆盖 loadviewstate 事件，调用 mybase.loadviewstate，然后在其后放置您自己的代码以重新生成控件，这些控件的值将在页面加载时可用。在我的一个应用程序中，我使用视图状态字段来保存可用于重新创建这些控件的 ID 或数组信息。

```
Protected Overrides Sub LoadViewState(ByVal savedState As Object)
    MyBase.LoadViewState(savedState)
    If IsPostBack Then
        CreateMyControls()
    End If
End Sub 
```

# php - PHP：提取括号内文本的最佳方法？

> ID：196520
> 
> 赞同：88
> 
> 时间：2008-10-13T02:08:55.400
> 
> 标签：php, parsing, string

提取括号之间的文本集的最佳/最有效方法是什么？假设我想以最有效的方式从字符串“忽略除此（文本）之外的所有内容”中获取字符串“文本”。

到目前为止，我想出的最好的是：

```
$fullString = "ignore everything except this (text)";
$start = strpos('(', $fullString);
$end = strlen($fullString) - strpos(')', $fullString);

$shortString = substr($fullString, $start, $end); 
```

有一个更好的方法吗？我知道通常使用正则表达式往往效率较低，但除非我可以减少函数调用的数量，否则这可能是最好的方法？想法？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-10-13T02:16:39.843

我只是做一个正则表达式并完成它。除非您进行了足够多的迭代以至于它成为一个巨大的性能问题，否则它更容易编码（并且当您回顾它时理解）

```
$text = 'ignore everything except this (text)';
preg_match('#\((.*?)\)#', $text, $match);
print $match[1]; 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-13T02:18:02.713

因此，实际上，您发布的代码不起作用：`substr()'s`参数是 $string、$start 和**$length**，`strpos()'s`参数是`$haystack`, `$needle`。稍作修改：

```
$str = "忽略除此之外的所有内容（文本）";
$start = strpos($str, '(');
$end = strpos($str, ')', $start + 1);
$length = $end - $start;
$result = substr($str, $start + 1, $length - 1);
```

一些微妙之处：我`$start + 1`在 offset 参数中使用了以帮助 PHP`strpos()`在第二个括号上进行搜索时；我们增加一并`$start`减少`$length`以从匹配中排除括号。

`$start`此外，此代码中没有错误检查：`$end`在执行`substr`.

至于使用`strpos/substr`与正则表达式；在性能方面，此代码将击败正则表达式。虽然有点啰嗦。我吃饭和呼吸`strpos/substr`，所以我不太介意，但其他人可能更喜欢正则表达式的紧凑性。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-13T03:34:15.960

使用正则表达式：

```
if( preg_match( '!\(([^\)]+)\)!', $text, $match ) )
    $text = $match[1]; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2020-04-10T04:34:04.610

我认为这是获取字符串中第一个括号之间的单词的最快方法。

```
$string = 'ignore everything except this (text)';
$string = explode(')', (explode('(', $string)[1]))[0];
echo $string; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-01-29T08:22:03.560

这是一个示例代码，用于提取 '[' 和 ']' 之间的所有文本并将其存储为 2 个单独的数组（即一个数组中括号内的文本和另一个数组中括号外的文本）

```
 function extract_text($string)
   {
    $text_outside=array();
    $text_inside=array();
    $t="";
    for($i=0;$i<strlen($string);$i++)
    {
        if($string[$i]=='[')
        {
            $text_outside[]=$t;
            $t="";
            $t1="";
            $i++;
            while($string[$i]!=']')
            {
                $t1.=$string[$i];
                $i++;
            }
            $text_inside[] = $t1;

        }
        else {
            if($string[$i]!=']')
            $t.=$string[$i];
            else {
                continue;
            }

        }
    }
    if($t!="")
    $text_outside[]=$t;

    var_dump($text_outside);
    echo "\n\n";
    var_dump($text_inside);
  } 
```

输出：extract_text("你好，你好吗？"); 将产生：

```
array(1) {
  [0]=>
  string(18) "hello how are you?"
}

array(0) {
} 
```

extract_text("你好 [http://www.google.com/test.mp3] 你好吗？"); 会产生

```
array(2) {
  [0]=>
  string(6) "hello "
  [1]=>
  string(13) " how are you?"
}

array(1) {
  [0]=>
  string(30) "http://www.google.com/test.mp3"
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-05-13T14:08:39.060

已经发布的正则表达式解决方案 -`\((.*?)\)`并且`\(([^\)]+)\)`- 不返回左括号和右括号之间的*最里面*的字符串。如果一个字符串是`Text (abc(xyz 123)`他们[都](https://regex101.com/r/247sJ2/1) [返回](https://regex101.com/r/247sJ2/2)一个`(abc(xyz 123)`作为一个整体匹配，而不是`(xyz 123)`。

如果匹配应包含括号，则匹配括号中的子字符串（用于`preg_match`获取第一个并`preg_match_all`获取所有出现的子字符串）而中间没有其他开括号和右括号的模式是：

```
\([^()]*\) 
```

或者，您想获取不带括号的值：

```
\(([^()]*)\)        // get Group 1 values after a successful call to preg_match_all, see code below
\(\K[^()]*(?=\))    // this and the one below get the values without parentheses as whole matches 
(?<=\()[^()]*(?=\)) // less efficient, not recommended 
```

如果和之间必须至少有 1 个字符，请替换`*`为。`+``(``)`

**详情**：

*   `\(`- 一个左圆括号（必须转义以表示文字括号，因为它在字符类之外使用）
*   `[^()]*`-除and以外的[零个或多个](http://www.regular-expressions.info/repeat.html)字符（请注意这些字符，不必在字符类内部进行转义，也不能用于指定分组并被视为文字括号）`(``)``(``)``(``)`
*   `\)`- 右圆括号（必须转义以表示文字括号，因为它在字符类之外使用）。

`\(\K`替代正则表达式中的部分匹配`(`并从匹配值中省略（使用`\K`匹配重置运算符）。`(?<=\()`是一个正向后视，它要求 a`(`立即出现在当前位置的左侧，但`(`由于后视（环视）模式不消耗，因此不会将 α 添加到匹配值中。`(?=\()`是一个正向前瞻，需要一个`)`字符立即出现在当前位置的右侧。

[PHP代码](https://3v4l.org/mBlbR)：

```
$fullString = 'ignore everything except this (text) and (that (text here))';
if (preg_match_all('~\(([^()]*)\)~', $fullString, $matches)) {
    print_r($matches[0]); // Get whole match values
    print_r($matches[1]); // Get Group 1 values
} 
```

输出：

```
Array ( [0] => (text)  [1] => (text here) )
Array ( [0] => text    [1] => text here   ) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-05-02T03:46:20.767

这个功能可能很有用。

```
 public static function getStringBetween($str,$from,$to, $withFromAndTo = false)
    {
       $sub = substr($str, strpos($str,$from)+strlen($from),strlen($str));
       if ($withFromAndTo)
         return $from . substr($sub,0, strrpos($sub,$to)) . $to;
       else
         return substr($sub,0, strrpos($sub,$to));
    }
    $inputString = "ignore everything except this (text)";
    $outputString = getStringBetween($inputString, '(', ')'));
    echo $outputString; 
    //output will be test

    $outputString = getStringBetween($inputString, '(', ')', true));
    echo $outputString; 
    //output will be (test) 
```

strpos() => 用于查找字符串中第一次出现的位置。

strrpos() => 用于查找字符串中第一次出现的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-04-08T08:21:27.900

```
function getStringsBetween($str, $start='[', $end=']', $with_from_to=true){
$arr = [];
$last_pos = 0;
$last_pos = strpos($str, $start, $last_pos);
while ($last_pos !== false) {
    $t = strpos($str, $end, $last_pos);
    $arr[] = ($with_from_to ? $start : '').substr($str, $last_pos + 1, $t - $last_pos - 1).($with_from_to ? $end : '');
    $last_pos = strpos($str, $start, $last_pos+1);
}
return $arr; } 
```

这是对先前答案的一点改进，它将以数组形式返回所有模式：

getStringsBetween('[T]his[] is [test] string [pattern]') 将返回：

# c# - 如何在 C# 中“覆盖”内部类？

> ID：196521
> 
> 赞同：14
> 
> 时间：2008-10-13T02:08:55.570
> 
> 标签：c#, overriding, internal-class

我想在 System.Web.Script.Services.ScriptHandlerFactory 和内部类中的其他 .NET 内容中自定义一些内容。不幸的是，它是一个内部类。尝试自定义此类中的方法时，我有哪些选择？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T02:13:25.453

您可能会发现[这篇最近的文章](http://blogs.msdn.com/ericlippert/archive/2008/09/26/preventing-third-party-derivation-part-one.aspx)很有启发性。基本上，它说你不能覆盖任何被标记`internal`的东西，并且来源是尽可能权威的。最好的希望是扩展方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T02:26:06.470

internal 关键字表示代码单元（类、方法等）对于它所在的程序集是“公共的”，但对于任何其他程序集是私有的。

因为你不在同一个程序集中，所以你不能做任何事情。如果它不是内部的，则可以在扩展类时在要覆盖的方法上使用 new 关键字（以隐藏原始实现）。

简而言之：你将成为 SOL。

我能想到你唯一能做的就是编写一个代理类，其中你的私有字段之一是你想要扩展的类，你实现它的所有方法并代理它们的调用。这样你仍然可以自定义输出，但你必须让你的类被使用，并且考虑到它被标记为内部，我不确定如果没有一些严重的黑客攻击是可能的。

```
using System;
...
using System.Web.Script.Services

namespace MyGreatCompany.ScriptServices 
{
    public class MyScriptHandlerFactory /* implement all the interfaces */
    {
        private ScriptHandlerFactory internalFactory;
        public MyScriptHandlerFactory()
        {
            internalFactory = new ScriptHandlerFactory();
        }
        ...
    }
} 
```

这*可以*使你想要完成的事情成为可能，但它不会很漂亮。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T02:55:06.913

我相信您可以使用 Reflection 绕过类上的访问修饰符，因此也许您可以使用 Reflection.Emit 来生成从内部类型（但**不是**密封修饰符）继承的类型，尽管我找不到示例这个在线。

这当然适用于访问类的私有成员，并且可能适用于非密封类的继承。但是，如果目标方法还没有被标记为虚拟，它并没有多大帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T06:06:34.187

这取决于装配。这可能会违反某些许可（尽管它类似于某种静态链接），甚至可能使部署成为一场噩梦，但您可以考虑：

*   反编译并将代码复制到您自己的项目中；根据需要修改
*   重新编译/修补程序集并添加“InternalsVisibleToAttribute”

# c++ - 在 C++ 中，使用异常和 try/catch 而不是仅仅返回错误代码有什么好处？

> ID：196522
> 
> 赞同：25
> 
> 时间：2008-10-13T02:11:32.477
> 
> 标签：c++, exception-handling, try-catch

我已经编写 C 和 C++ 很长时间了，到目前为止，我从未使用过异常和 try/catch。使用它而不是让函数返回错误代码有什么好处？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-13T02:23:36.570

可能很明显 - 开发人员可以忽略（或不知道）您的退货状态并继续幸福地不知道某些事情失败了。

需要以某种方式确认异常 - 如果不积极采取措施，就不能默默地忽略它。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-13T03:44:30.290

例外的好处有两个：

*   **他们不能被忽视。** 您必须在某种程度上处理它们，否则它们将终止您的程序。使用错误代码，您必须明确检查它们，否则它们会丢失。

*   **它们可以被忽略。** 如果一个错误不能在一个级别处理，它会自动冒泡到下一个级别，它可以在那里。错误代码必须明确传递，直到它们达到可以处理的级别。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-13T02:17:16.943

优点是您不必在每次可能失败的调用后检查错误代码。但是，为了使其工作，您需要将它与 RAII 类结合起来，以便在堆栈展开时自动清理所有内容。

带有错误消息：

```
int DoSomeThings()
{
    int error = 0;
    HandleA hA;
    error = CreateAObject(&ha);
    if (error)
       goto cleanUpFailedA;

    HandleB hB;
    error = CreateBObjectWithA(hA, &hB);
    if (error)
       goto cleanUpFailedB;

    HandleC hC;
    error = CreateCObjectWithA(hB, &hC);
    if (error)
       goto cleanUpFailedC;

    ...

    cleanUpFailedC:
       DeleteCObject(hC);
    cleanUpFailedB:
       DeleteBObject(hB);
    cleanUpFailedA:
       DeleteAObject(hA);

    return error;
} 
```

有例外和 RAII

```
void DoSomeThings()
{
    RAIIHandleA hA = CreateAObject();
    RAIIHandleB hB = CreateBObjectWithA(hA);
    RAIIHandleC hC = CreateCObjectWithB(hB);
    ...
}

struct RAIIHandleA
{
    HandleA Handle;
    RAIIHandleA(HandleA handle) : Handle(handle) {}
    ~RAIIHandleA() { DeleteAObject(Handle); }
}
... 
```

乍一看，RAII/Exceptions 版本似乎更长，直到您意识到清理代码只需要编写一次（并且有一些方法可以简化它）。但是 DoSomeThings 的第二个版本更加清晰和可维护。

不要尝试在没有 RAII 习语的情况下在 C++ 中使用异常，因为您会泄漏资源和内存。您的所有清理工作都需要在堆栈分配对象的析构函数中完成。

我意识到还有其他方法可以处理错误代码，但它们最终看起来都差不多。如果你放弃了 goto，你最终会重复清理代码。

错误代码的一点是，它们清楚地表明了事情可能在哪里失败，以及它们如何失败。在上面的代码中，您假设事情不会失败（但如果失败，您将受到 RAII 包装器的保护）。但你最终会更少关注可能出错的地方。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-13T02:14:02.410

异常处理很有用，因为它可以很容易地将错误处理代码与为处理程序功能而编写的代码分开。这使得阅读和编写代码更容易。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-13T02:29:40.740

除了提到的其他事情之外，您不能从构造函数返回错误代码。析构函数也可以，但你也应该避免从析构函数中抛出异常。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-13T02:16:39.487

*   在某些情况下*预期会*出现错误情况时返回错误代码
*   在任何情况下都*不会*出现错误情况时抛出异常

在前一种情况下，函数的调用者必须检查预期失败的错误代码；在后一种情况下，异常可以由堆栈上的任何调用者（或默认处理程序）酌情处理

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-13T09:45:41.827

我为此写了一篇博文（[Exceptions make for Elegant Code](http://www.justsoftwaresolutions.co.uk/design/exceptions-make-for-elegant-code.html)），随后发表在[Overload](http://accu.org/index.php/journals/1505)上。实际上，我写这篇文章是为了回应 Joel 在 StackOverflow 播客上所说的话！

无论如何，我坚信在大多数情况下异常比错误代码更可取。我发现使用返回错误代码的函数真的很痛苦：您必须在每次调用后检查错误代码，这可能会破坏调用代码的流程。这也意味着您不能使用重载的运算符，因为无法发出错误信号。

检查错误代码的痛苦意味着人们经常忽略这样做，从而使它们变得毫无意义：至少您必须使用`catch`语句明确忽略异常。

使用 C++ 中的析构函数和 .NET 中的处理器来确保在出现异常时正确释放资源也可以大大简化代码。为了使用错误代码获得相同级别的保护，您要么需要大量`if`语句、大量重复的清理代码，要么需要`goto`在函数末尾调用公共清理块。这些选择都不是令人愉快的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-13T02:20:07.543

[这是](http://en.wikipedia.org/wiki/Python_syntax_and_semantics#Exceptions)对 EAFP（“请求宽恕比许可更容易”）的一个很好的解释，我认为即使它是 Wikipedia 中的 Python 页面也适用于此。使用异常会导致更自然的编码风格，IMO——在许多其他人看来也是如此。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-13T06:20:21.023

当我以前教 C++ 时，我们的标准解释是它们让你避免纠结晴天和雨天的场景。换句话说，您可以编写一个函数，就好像一切正​​常，并最终捕获异常。

如果没有例外，您必须从每个调用中获取一个返回值并确保它仍然是合法的。

当然，一个相关的好处是您不会在异常上“浪费”您的返回值（因此允许应该为 void 的方法为 void），并且还可以从构造函数和析构函数返回错误。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-10T04:50:32.970

[Google 的 C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Exceptions)对 C++ 代码中异常使用的优缺点进行了详尽的分析。它还指出了您应该问的一些更大的问题；即我是否打算将我的代码分发给其他人（他们可能难以与启用异常的代码库集成）？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-13T05:57:47.137

有时您确实必须使用异常来标记异常情况。例如，如果构造函数中出现问题，并且您发现通知调用者这是有意义的，那么您别无选择，只能抛出异常。

另一个例子：有时你的函数没有返回值来表示错误；函数可能返回的任何值都表示成功。

```
int divide(int a, int b)
{
    if( b == 0 )
        // then what?  no integer can be used for an error flag!
    else
        return a / b;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-13T09:53:00.250

您必须承认异常这一事实是正确的，但这也可以使用错误结构来实现。您可以创建一个基本错误类，在其 dtor 中检查是否调用了某个方法（例如 IsOk ）。如果没有，你可以记录一些东西然后退出，或者抛出一个异常，或者引发一个断言，等等......

只在错误对象上调用 IsOk 而不对其做出反应，就相当于编写 catch( ... ) {} 这两个语句都会显示出同样缺乏程序员的善意。

将错误代码传输到正确级别是一个更大的问题。出于传播的唯一原因，您基本上必须使几乎所有方法都返回错误代码。但话又说回来，一个函数或方法应该总是用它可能产生的异常进行注释。所以基本上你有同样的问题，没有接口来支持它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-13T02:43:02.443

正如@Martin 指出的那样，抛出异常会迫使程序员处理错误。例如，不检查返回码是 C 程序中最大的安全漏洞来源之一。异常确保您处理错误（希望如此）并为您的程序提供某种恢复路径。如果您选择忽略异常而不是引入安全漏洞，您的程序就会崩溃。

# directx - MaxTextureRepeat 限制在什么时候发挥作用？

> ID：196554
> 
> 赞同：1
> 
> 时间：2008-10-13T02:27:51.100
> 
> 标签：directx, direct3d, textures, hlsl, shader

在 Direct3D 下执行像素着色器时，MaxTextureRepeat 对纹理坐标施加的限制是否仅在调用纹理查找函数（如 Tex2D()）期间成为问题，或者它们是否会在着色器中访问纹理坐标时发挥作用？

我想知道是否可以通过在纹理坐标上调用 frac() 之类的东西来避免 MaxTextureRepeat 限制，然后再将它们传递给纹理查找函数。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-15T17:16:03.430

纹理坐标具有原生插值器精度。在支持像素着色器 2.0 的硬件上，这至少是 24 位浮点（或者可能是 32 位，不确定）。在内部，像素着色器中的计算必须至少为 24 位浮点。大多数现代 GPU 以 32 位浮点精度运行。

MaxTextureRepeat 是纹理采样硬件的能力。

所以，是的，如果您没有遇到浮点精度限制，那么在采样前限制范围是避免纹理重复限制的一种方法。

然而，当 frac 从 0 变为 1 时，您将获得较大的梯度，因此在这些地方，GPU 将希望使用非常低分辨率的 mip 级别。当然，这可能不是问题，具体取决于您的情况；但这是潜在问题的一点。

# java - Java webservice (soap) 客户端 - 使用证书

> ID：196566
> 
> 赞同：2
> 
> 时间：2008-10-13T02:34:33.863
> 
> 标签：java, web-services, soap, certificate

我正在尝试使用客户端证书通过 ssl 连接到 Web 服务。除了将“javax.net.ssl.keyStore”之类的东西推入 System.properties 之外，是否有一种优雅的方式来做到这一点。

任何指向代码示例的指针都将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-13T04:57:40.910

你可能会从这本书的网站上得到一些样本：http: [//www.manning.com/kanneganti/](http://www.manning.com/kanneganti/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T10:16:36.317

不确定[这](http://blogs.oracle.com/andreas/entry/no_more_unable_to_find)是否完全相关，但仍然如此。此条目描述了在不使用 keytool 的情况下生成证书并将其安装在本地系统上的方法。可能您可以重用（非常简单的）源代码的某些部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T10:30:32.250

您可以将证书安装到系统密钥库中。（位置因平台而异，您需要管理员权限）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-14T09:07:52.697

请参阅我的文章中的示例代码。它显示了如何为 WS 客户端动态地向 HTTPS 服务器提供自定义密钥库。[http://jakubneubauer.wordpress.com/2011/09/06/java-webservice-over-ssl/](http://jakubneubauer.wordpress.com/2011/09/06/java-webservice-over-ssl/)

# html - 我该怎么做 与块元素并排放置？

> ID：196567
> 
> 赞同：11
> 
> 时间：2008-10-13T02:35:00.540
> 
> 标签：html, css

[我在这里](http://www.mylittlepwnage.com/misc/forms-editor.html)有一个模型布局。本质上，有部分、列和字段，它们都写成`<ul>`和`<li>`元素的组合。这是专门为以后的解析而完成的。

HTML 的一个片段：

```
<li class="layout"><span class="type">[Column] </span>
    <ul class="layout-children">
        <li class="field"><span class="type">[Text] </span>A field</li>
        <li class="field"><span class="type">[Text] </span>Another field</li>
        <li class="field"><span class="type">[Text] </span>Yet another field</li>
    </ul>
</li>
<li class="layout"><span class="type">[Column] </span>
    <ul class="layout-children">
        <li class="field"><span class="type">[Text] </span>More fields</li>
        <li class="field"><span class="type">[Text] </span>And one more field</li>
    </ul>
</li> 
```

如果您转到[链接的内容](http://www.mylittlepwnage.com/misc/forms-editor.html)，您会注意到这些列是垂直放置的。我希望柱子并排放置，但我不知道该怎么做。

如果 HTML 没有改变，只有 CSS 会更好。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T02:43:58.493

我刚刚将其添加到您的 CSS 中：

```
ul .section-children li.layout {
    display : inline-block;
} 
```

不幸的是，我不知道现在对 inline-block 的支持有多好。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T02:50:13.257

```
display: -moz-inline-box;
display: inline-block;
*display: inline;
*zoom: 1; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-13T02:39:25.493

在您的`<UL>`标签中使用 css 属性“list-style:none;” 并在`<li>`标签中使用 css 属性“display:inline;” 您将不得不使用填充和边距以使其看起来不错，但这两个属性将使您顺利上路。有关更好的示例，请参阅我的非营利网站：[技术学习](http://technicallylearning.org)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T02:40:26.693

这个怎么样：

```
.layout { float: left; width: 50%; margin: 0; border: 0; padding: 0; /* background: transparent */ }
* html .layout { display: inline } /* IE margin hack */
.field { clear: both } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T02:41:52.493

`display:block`是的，除非您尝试为它们中的每一个指定宽度，否则使用它是不可能让它们并排放置的，但如果是这种情况，只需使用`display:inline`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T03:00:36.027

只是使用内联元素的替代方法，因为 IE 有内联填充问题的历史：

```
.layout-children:after
{
  content: "";
  display: block;
  height: 0px;
  clear: both;
}

.layout-children .field
{
  float: left;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T14:01:21.653

使用`inline`or`inline-block`只会带来麻烦。正如@Dmitry Z 所建议的那样使用浮点数是一个更好的主意（但没有margin hack，这不是必需的）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T17:07:57.097

一个简单的 float: left 将起作用（对宽度进行微调）

```
li {
    margin: .5em 1em;
    padding: .1em;

    font-family: sans-serif;
    list-style-type: none;
    border: 1px #666 solid;
    float: left;
}
#layout-section {
    width: 85%;
} 
```

# c# - 如何查看导致 LINQ to SQL 中的 SubmitChanges 错误的 sql？

> ID：196585
> 
> 赞同：6
> 
> 时间：2008-10-13T02:48:59.623
> 
> 标签：c#, .net, sql, linq, linq-to-sql

我有一些 LINQ to SQL，有时会抛出一个

> “无法在具有唯一索引 'IX_Indexname' 的对象 'dbo.Table' 中插入重复的键行。语句已终止。”

有什么方法可以打开日志记录或至少调试到数据上下文中，以查看在引发错误时正在执行什么 sql？

**更新：** 我应该提到我知道该`GetChangeSet()`方法，我想知道 DataContext 上是否有显示最后执行的 SQL 的属性，或者显示 SQL 的 sql 异常上的属性。

这个错误的奇怪之处在于，在更改集中，只有一个更新，并且唯一更改的字段是日期时间字段，该字段不在导致错误的索引中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-13T03:02:24.107

一个简单的方法是使用[DataContext.Log](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.log.aspx)属性：

```
using (MyDataContext ctx = new MyDataContext())
{
    StringWriter sw = new StringWriter();
    ctx.Log = sw;

    // execute some LINQ to SQL operations...

    string sql = sw.ToString();
    // put a breakpoint here, log it to a file, etc...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T02:54:08.223

当遇到这些类型的问题时，我一直在使用 SQL 分析器。基本上打开探查器，在保存/更新上设置一个断点，清除探查器，然后只运行该语句。从那里我有所有已执行的 SQL，我可以看到生成了什么。[我主要通过 DataServices 执行此操作，因此 .SaveChanges() 是放置断点的非常方便的位置]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T03:10:41.670

编写一个测试来隔离导致所有问题的一段或多段代码。设置 DataContext.Log = Console.Out。使用测试运行程序（NUnit、MSTest 等）运行测试。测试运行程序通常会显示打印到 Console.Out 的任何内容以及测试结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T02:55:35.820

您可以使用 SQL 探查器在 SQL 访问 SQL 服务器时查看它。

如果您想查看更改集中的实际内容，您需要使用：

```
context.GetChangedSet(); 
```

MSDN - [http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.getchangeset.aspx)

然后，您可以在将每个 SQL 语句发送到服务器之前对其进行查看。

最后一点是使用 VS 2008 的能力通过 .NET 框架进行调试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T00:46:36.323

使用 SQL 事件探查器。它是您的朋友，并附带 SQL。您可以查看正在执行的任何 SQL 语句，完全控制过滤。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T01:01:36.590

我必须同意 Bradley Grainger 使用[DataContext.Log](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.log.aspx)属性是查看已执行 sql 的最佳方式。

# c# - 整数格式，填充到给定长度

> ID：196591
> 
> 赞同：14
> 
> 时间：2008-10-13T02:54:23.280
> 
> 标签：c#, string, integer, format

我需要将整数的输出填充到给定的长度。

例如，长度为 4 位，整数 4 的输出是“0004”而不是“4”。如何在 C# 2.0 中做到这一点？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-13T02:57:27.437

使用 string.Format 命令。

```
output = String.Format("{0:0000}", intVariable); 
```

更多详细信息：http: [//msdn.microsoft.com/en-us/library/fht0f5be.aspx](http://msdn.microsoft.com/en-us/library/fht0f5be.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T03:00:48.897

我认为是：intVal.ToString("####");

但是这里有一些[有用的文档](http://msdn.microsoft.com/en-us/library/8wch342y.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-07-26T11:49:32.840

**在现代 .NET 5.0+**（2021 更新）中

```
int myint = 100;
string zeroPadded = $"{myint:d8}";      // "00000100"
string leftPadded = $"{myint,8}";       // "     100"
string rightPadded = $"{myint,-8}";     // "100     " 
```

# .net - 如何使用 Enter 键在字段之间导航

> ID：196603
> 
> 赞同：2
> 
> 时间：2008-10-13T03:00:00.523
> 
> 标签：.net, vb.net, winforms

我的公司有一个用 VB6 编写的大型应用程序，由于历史原因，该应用程序是使用 Enter 键而不是 Tab 键导航的。我不知道 VB6，但我知道他们目前在 Form 的 KeyUp 事件中的一个大选择语句中为每个控件设置焦点，如果它是一个 EnterKey。现在我们开始转换为 .NET，并且必须保持一致，这样用户就不必在某些表单上按 TAB 并在其他表单上按 ENTER。我想编写将自动从字段输入到字段而不是制表符的祖先表单。一位同事告诉我，它在 VB6 中完成的方式不是在 CLICK 事件上而是在 KEYUP 事件上处理按钮。我需要继续这样做，这样我的表单完成后就不会有剩余的 KeyUp 事件传回 VB6。按钮的事件顺序是

1.  button_PreviewKeyDown
2.  button_Click（显然替换了 KeyPress 事件）
3.  form_KeyUp
4.  button_KeyUp

我创建了如下表格：

*   在 ANCESTOR 表单的 KeyUp 事件中，检查它是否是回车键。如果它是一个回车键，并且活动控件不是一个按钮，它会按 Tab 顺序移动到下一个字段。否则它会忽略该键并让控件处理它。如果它是一个按钮，祖先不会假定知道按钮想要控制去哪里，因为这将取决于按钮在“单击”时想要做什么。
*   在 CHILD 窗体的按钮上，click 事件不执行任何操作，并且在 KeyUp 事件和 MouseClick 事件中重复处理。
*   ANCESTOR 表单有一个受保护的布尔值 EatKeyUp，它可以由 CHILD 设置为 True。这在子窗体需要发送 MessageBox 时使用，因为如果用户通过 MessageBox 上的 OK 按钮进入，仍然有一个剩余的 KeyUp 事件将被祖先窗体消耗。

虽然 klugey，这实际上似乎工作。我想知道的是，有没有更好的方法？也许在某个地方我可以告诉我的应用程序“通过表单输入而不是通过选项卡输入”？我使用的事件而不是点击事件是最好的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T03:05:55.907

也许现在您正在转换时间来推动遵守 Windows 标准的想法。

直接回答您的问题，上述机制是一种非常常见的方法，另一种方法是设置表单的关键预览属性并直接在表单中处理。这两种方式都不是一个特别好的解决方案，因为窗口导航根本不打算这样做，

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-02T05:53:20.247

更好的实现是使用表单的 AcceptButton 属性，将其设置为表单上某处的隐藏按钮。然后当用户按下回车键时，按钮被点击，然后在按钮点击事件中你做代码移动到下一个控件。要选择下一个控件，您只需通过项目列表进行选择。

最简单的方法是创建一个基本表单，然后在其中包含按钮和 AcceptButton 逻辑。

# .net - 支持 DPI 和默认字体更改

> ID：196606
> 
> 赞同：27
> 
> 时间：2008-10-13T03:02:13.497
> 
> 标签：.net, winforms, dpi, highdpi

因此，我试图弄清楚 Form 的 AutoScaleMode 属性如何可能有助于支持具有与我的工作开发机器不同的字体或[DPI的系统。](http://en.wikipedia.org/wiki/Dots_per_inch)

从 SDK：

> AutoScaleMode 枚举
> 
> 公共枚举 AutoScaleMode
> 
> ```
> 没有任何  
>    自动缩放被禁用。    
> 字体   
>    控制相对于尺寸的缩放
>    类使用的字体，通常是
>    系统字体。
> Dpi    
>    控制相对于显示分辨率的比例。
>    常见的分辨率是 96 和 120 DPI。
> 
> ```

默认情况下，.NET 2.0 表单使用 AutoScaleMode.Font。

所以我在我的 Windows XP、Tahoma 8 pt、96 DPI 开发机器上设计了一个示例表单。然后我试了一下

*   14 pt Segoe UI 96 DPI 机器
*   14 pt Segoe UI 150 DPI 机器

结果并不令人鼓舞，如您在此屏幕截图中所见：

![](https://uiguidelines.files.wordpress.com/2008/10/comparison-of-form-autoscalemodes-matrix.png)

AutoScaleMode 属性并非旨在启用 .NET 窗体以支持不同的字体或 DPI 设置。那么支持不同字体和 DPI 设置的正确方法**是什么？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T19:31:49.600

正确的方法是缩放控件、表单本身和其中的文本。这听起来很复杂，但布局控件（TableLayoutPanel 和 FlowLayoutPanel）与 AutoSize 属性相结合，大大降低了难度。

# captcha - 更难、更好、更快、更强……基于图像的验证码技术？

> ID：196608
> 
> 赞同：7
> 
> 时间：2008-10-13T03:05:32.820
> 
> 标签：captcha, spam-prevention

有很多非基于图像的验证码想法四处流传。但是老式的方法呢？

好的图像验证码的要素是什么？哪些视觉元素对计算机来说很难，但对人类来说更容易？那些错误，对于计算机来说比对人类来说更容易的元素呢？提高CAPTCHA 生成器*速度*的好技术有哪些？

这是我一直在研究的 CAPCHA 示例。它为两个正弦波生成函数，然后在它们之间拉伸一个文本。它将其放置在从图像池中提取的背景上。 ![基于图像的验证码](https://farm4.static.flickr.com/3178/2936174357_fc9e92b881_m.jpg?iwonderwhollnoticethis)

如何改进？（具体来说，我使用的是 PHP GD。）想到的事情是：

*   更改文本的颜色，可能使其变为多色。
*   添加轻微模糊文本的“划痕”或标记。
*   添加失真，使其也受到水平正弦波的影响。

**什么是一流的图像验证码？**

* * *

编辑：我知道有一些非常有价值的第三方验证码资源。我正在寻找*使*它们变得更好的属性。我想使用自己的验证码，只是为了自我提升。所以，你可以谈论 reCAPTCHA，但这并不是我想要的。

此外，已经提出不仅图像很重要，*体验*也很重要，因此请随时发表评论。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T03:07:25.313

将每个字母/数字制作成图案，即不连接的点。这意味着除了模式识别（他们还没有）之外，计算机无法知道一个点是字母的一部分。然后是通常的扭曲和随机线条。

你如何做到这一点是一个挑战。

编辑：另外，不同形状的图案的奖励积分，并尝试在字符（边缘或整个字符）上使用 alpha 透明度，以便它们与背景合并。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-18T21:25:44.620

**使字母难以分开**。使用类似手写的字体或添加连接字母的线条。减少和随机化字母之间的间距。

**在其他轴上也添加波形失真**。仅在一个轴上的失真可以相对容易地分析和逆转。

**根本不用担心彩色背景**。从其他颜色中自动过滤黑色非常容易。你的背景只会阻碍人类。

不要添加划痕或其他噪音，除非它的厚度与字母相同。去噪算法可以轻松去除比字母更薄的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T03:28:52.820

如果字母的颜色褪色成其他颜色怎么办……例如，5 可以从顶部的黄色开始，然后逐渐变成蓝色或其他颜色。选择的颜色应该是随机的。

使用多色背景可能会使计算机难以拾取背景结束和角色开始的位置。希望人类实际拾取图案不会太困难。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-17T09:03:42.070

您可以在数据库中创建一个验证码表，而不是生成验证码，然后您自己通过在谷歌上搜索良好的验证码图像来创建该表。

所以不用担心“这种生成方法行得通吗？”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T03:11:34.773

我真的很讨厌网站上的 CAPTCHA，它们只是让我烦恼，但如果您想尝试制作一个强大的验证码，请尝试以下操作：

*   无需提交即可获得新图像的能力
*   视障人士的口语版本
*   不均匀的字符

我在一些网站上使用了 Recaptcha，这是一个很好且强大的解决方案。

或者，如果您想对它非常时髦，请查看以下内容：[http ://research.microsoft.com/asirra/](http://research.microsoft.com/asirra/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T03:15:17.403

试图破解验证码的算法是模式匹配器，它们通过几种不同的方式工作：缩放和倾斜他们已经知道的符号，查找和跟踪边缘，以及计算内部孔以提供帮助。如果您可以将字母分成几块，改变字母质量，或在字母上添加粗线条或“划痕”，这些技巧将有所帮助。然而，考虑到我们为此目的提供了[recaptcha](http://recaptcha.net/) ，所有这一切都没有实际意义，而且它是一个很棒的第三方应用程序。此外，验证码将有助于您网站的安全，但不会阻止那些真正受到诱惑的人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T03:20:20.357

警惕 ReCaptcha 的建议。我已经向它提交了几十次错误的输入，并且每次都成功了。有几次我为这两个词提交了错误的输入，而不仅仅是最模糊的词；正如我所说，成功率是 100%。

我还认为基于图像的验证码对用户是不利的，应尽可能避免。基于文本的解决方案的优势在于，您可以根据站点的受众对其进行定制，增加一定程度的隐蔽性，当机器对基于文本的解决方案变得更加精通时，它们可能会绊倒机器。

至少，不要一直使用它：（[来源：][[codinghorror.com](http://www.codinghorror.com/blog/images/word.png)][）][![橙](https://i.stack.imgur.com/cWMJb.png)](https://i.stack.imgur.com/cWMJb.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T06:01:26.460

我喜欢[KittenAuth](http://www.thepcspy.com/kittenauth)和 Microsoft 的[Asirra](http://research.microsoft.com/asirra/)项目的想法。这个想法是，虽然 OCR 最终会演变为打破您的传统验证码，但区分小猫和狗的能力是一个复杂许多数量级的问题，而对人类来说绝对微不足道。

这个解决方案虽然可能是有史以来最性感的验证码想法，但它的局限性在于不容易移植到听力受损的方法中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-26T04:30:08.767

剪切和改组乐队以破坏显示和仅鼠标输入呢？

从你的正弦波变形文本开始，分成水平带，甚至是网格。

这使得光学识别更难，并且可能让你避免那种让人类难以识别验证码的讨厌的背景游戏。

对于您可以在浏览器中依赖本地拖动的站点，而不是输入条目，而是使用洗牌要求用户重新排序作品（只是按照草率的顺序，而不是像其中一个谜题）。或者，如果您想单独使用点击，则可以使用经典的[滑动瓷砖](http://en.wikipedia.org/wiki/Sliding_puzzle)拼图。

请注意，我遇到了一个验证码，您必须在其中识别 N 部卡通中的哪一部有动物成功阻止了我！

[Wellington Gray](http://miscellanea.wellingtongrey.net/2008/04/07/what-hath-captcha-wrought/)很好地总结了 AI CAPTCHA 竞赛。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-09T14:47:21.580

您可以添加一个随机的字体数组，以便 GD 使用不同的字符呈现每个字符。

# java - Java: Triple Curly Bracing

> ID：196610
> 
> 赞同：3
> 
> 时间：2008-10-13T03:06:15.750
> 
> 标签：java, coding-style, folding

I've been given some code with commenting unlike anything I've come across before:

```
//{{{ Imports
import imports;
//}}} 
```

It is the same for each method block,

```
//{{{ above the code block  
//}}} below the code block 
```

Also see: [http://en.wikipedia.org/wiki/Folding_editor](http://en.wikipedia.org/wiki/Folding_editor)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-13T03:12:09.187

A quick search for *"triple curly" comment* suggests it's "[Emacs folding mode](http://www.emacswiki.org/cgi-bin/wiki/FoldingMode)".

Or some other code folding marker in any case.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-13T04:40:26.637

[jEdit](http://www.jedit.org) uses {{{ and }}} to mark "explicit" folds.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T08:29:42.353

Actually, Vim uses those triple braces in comments, too.

Tell the one you got the code from, that folding this way is a [bad idea](https://blog.codinghorror.com/the-problem-with-code-folding/). Vim can set fold points at syntactic folding hints, defined in the highlighting file.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T20:50:14.557

It may also be for some code generators. Some generators allow you to edit generated code, and use markers like that so the generator knows where it can regenerate.

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-13T03:08:12.160

Maybe it's to emphasize a code block?

*shrugs*

# database - 在 ILIKE 查询中转义

> ID：196626
> 
> 赞同：1
> 
> 时间：2008-10-13T03:17:14.777
> 
> 标签：database, postgresql, escaping

我需要做一个查询以搜索以**“Nome % teste \ /”**为前缀的文本。我正在使用以下方式进行查询：

**其中 "name" ILIKE 'Nome a% teste \ /%' ESCAPE 'a'**（使用 a 作为转义字符）。

有一行与此匹配，但此查询不返回任何内容。删除斜线（**'Nome % teste \'**），它可以工作。但我不明白为什么**斜杠**是个问题，因为默认转义是**反斜杠**，我在这个测试中把它改成了**“a” 。**

有什么我想念的吗？（我咨询过TFM）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T03:38:07.887

使用“ESCAPE”说明符

```
WHERE "name" ILIKE 'Nome ~% teste \\/' ESCAPE '~' 
```

[http://www.postgresql.org/docs/8.2/static/functions-matching.html](http://www.postgresql.org/docs/8.2/static/functions-matching.html)

注意：对于字符串解析器，您仍然需要两次 \。

没有 ESCAPE 你需要做

```
WHERE "name" ILIKE 'Nome \% test \\\\/' 
```

（4 \ 代表一个文字 \ ）

* * *

> 谢谢，但我仍然有斜线的原始问题。搜索
> 
> ```
> WHERE "name" ILIKE 'Nome \% test \\\\/%' 
> ```
> 
> 不要给我结果，而
> 
> ```
> WHERE "name" ILIKE 'Nome \% test \\\\%' 
> ```
> 
> （删除了行中存在的斜线）按预期工作。– Kknd

您的字符串可能没有您指定的文字“/”。您之间可能有一个空字符或其他空白字符。或者，您有 / 在不同的字符集中。

我会尝试用它来测试这种可能的情况

```
 WHERE "name" ILIKE 'Nome \% ' AND "name" ~* '\\.{1,10}/' 
```

这将返回有/由某物分隔的行（但不是没有分隔的行）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T03:20:57.827

您是否尝试过像这样使用反斜杠来转义它：

```
where "name" ILIKE 'Nome \% teste \\\/'; 
```

# java - 以相反的顺序打印出任何集合中的项目？

> ID：196628
> 
> 赞同：7
> 
> 时间：2008-10-13T03:20:08.767
> 
> 标签：java, collections

我的*数据结构和使用 Java 解决问题*一书中有以下问题：

> 编写一个例程，使用 Collections API 以相反的顺序打印出任何 Collection 中的项目。不要使用 ListIterator。

我没有把它放在这里，因为我希望有人做我的作业，我似乎无法准确理解它要求我编写什么代码！

当它要求我写一个“例程”时，它是在寻找一个单一的方法吗？我真的不明白如何使单一方法适用于所有各种类型的集合（链表、队列、堆栈）。

如果有人能指导我正确的方向，我将不胜感激。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-13T03:32:06.540

不管问题没有多大意义，因为一半的集合没有固定排序的 gstable 排序（即 TreeSet 或 PriorityQueue），您可以使用以下语句以逆自然顺序打印集合的内容：

```
List temp = new ArrayList(src);
Collections.reverse(temp);
System.out.println(temp); 
```

我本质上是创建一个数组列表，因为列表是唯一可以任意重新排序的结构。您将*src*集合传递给构造函数，该构造函数以集合自然顺序使用*src*的内容来初始化列表。然后将列表传递给*Collections.reverse()*方法，该方法反转列表，最后打印它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T03:29:40.977

首先，我相信它要求你写一个方法。像：

```
void printReverseList(Collection col) {} 
```

然后有很多方法可以做到这一点。例如，仅使用 Collection API，使用 toArray 方法并使用 for 循环从末尾打印出所有项目。有道理？

至于使用 Collection 接口的各种类，它将自动适用于所有这些类，因为它们必须实现该接口（前提是它们以一种理智的方式实现它；）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T03:24:18.023

好吧，您可以有一个基于输入类型委托给其他例程的例程，但是我不确定是否有一个足够通用的集合类型可以包含在一个参数中。我想你可以只使用方法重载（有多个同名的方法，但接受不同的参数）。

从技术上讲，这可以算作 1 个例程（都具有相同的名称）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T03:30:19.290

没有基础 Collection 类吗？

可能值得在这里作为起点：[Collections](https://docs.oracle.com/javase/1.5.0/docs/api/java/util/Collections.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T03:30:48.057

我不太了解 Java，但考虑到“集合 API”，我想所有这些对象都实现了一个接口，您可以以某种方式迭代。我想他们都可以有一个 itemAtIndex( int index ) 和 length() 或者你可以使用的类似方法。

[你可能想读这个。](http://java.sun.com/docs/books/tutorial/collections/intro/index.html)

# c# - 如何使用 UIAutomation 与旧的 ActiveX SSUltraGrid 读取/交互

> ID：196636
> 
> 赞同：1
> 
> 时间：2008-10-13T03:27:42.103
> 
> 标签：c#, com, activex, ui-automation

我正在研究使用 ActiveX 控件的旧 Win32 应用程序的自动化测试。我正在使用使用 Microsoft UIAutomation 的 White（来自 Thougthworks）。我可以找到与控件相关的 AutomationElement，但是如何与之交互呢？

Spy++ 将网格控件视为单个窗口，因此我不能直接与行、列或单元格对话。如何从我的测试代码中与 SSUltraGrid 控件对话？

干杯奈杰尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-05T01:02:33.893

您提到的一些 ActiveX 和其他自定义控件（如 SSUltraGrid）的基本问题是，它们仅显示为一个窗口。因此，除非他们提供的 API 使他们对您的 GUI 自动化工具“友好”，否则您将始终面临这一挑战。当然，许多公司都提供了比以前对 UI 自动化更友好的产品的更新版本……也许升级控件是值得的……

失败了……我工作的测试工程师告诉我的是，当他们遇到这种情况时，如果有众所周知的击键来调用他们想要的活动，他们就会将击键发送到控制窗口。如果他们足够幸运能够将东西放在固定位置，他们甚至可以通过发送鼠标事件而侥幸逃脱。然而，这充其量是冒险的。

# php - 准备好的语句与存储过程

> ID：196652
> 
> 赞同：20
> 
> 时间：2008-10-13T03:41:50.343
> 
> 标签：php, mysql, stored-procedures, prepared-statement

如果您使用的是 php5 和 mysql5，那么使用存储过程相对于准备好的语句有很大的优势吗？（我在某处读到你可能无法从 mysql5 存储过程中获得实质性的性能提升）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-13T04:02:02.300

它们并不是一回事——对于存储过程，您的数据库逻辑驻留在数据库中。如果多次调用准备好的语句，它们基本上可以避免重新解析查询 - 性能优势可能会有很大差异。

使用一种或另一种的选择实际上取决于您的具体情况。我不再使用存储过程，因为我喜欢将所有逻辑放在一个地方。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-05-04T21:40:15.423

存储过程适用于专业级（IE 企业级）应用程序，您可以：

1.  希望让您的数据库工程师优化查询以提高性能
2.  想要将查询的复杂性抽象为简单的 API
3.  希望您的逻辑分发，因为数据库中发生的某些事情可能是您不想向其他方公开的知识产权
4.  希望您的逻辑是分布式的，因为这是分布式、n 层计算的本质
5.  您可能希望数据库工程师或 DBA 在不修改应用程序代码的情况下修改模式（存储过程，通过提供 API 提供抽象层）

还有其他原因。

准备好的陈述更适合在会话中完成的工作。但是，如果您花时间创建准备好的语句，那么您基本上已经完成了创建存储过程所需的一切。不同之处在于存储过程可跨多个会话使用（取决于数据库中的 GRANTS）。

What I can not figure out is that if you have the option for stored proc vs. prepared statement, why you would bother with prepared statements. Most of the SP vs PS discussions seem to focus on what the differences are between them, not on why to use one vs the other. That always appears to boil down to "depends on what you are trying to do." But I haven't seen a well organized description of: use a proc if you need VS use a statement if you need....

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-13T18:25:30.530

存储过程的一些优点：

*   语言之间可移植
*   可以说是简化的界面，有时对于复杂查询，尤其是多查询事务（测试！）
*   通过公开接口而不是表，可用于提高安全性和完整性

存储过程的一些缺点：

*   将业务逻辑放入数据库 - 使设计复杂化，为版本控制和故障排除提供额外的跟踪位置
*   某些情况下的性能损失（测试！）
*   数据库之间的可移植性较差

我认为这个问题不存在单一的通用答案，因为根据情况有利有弊。如果您遵循简单、DRY、测试和避免过早优化等原则，您可能会得到很好的结果。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-13T10:14:54.560

在这里可能不是这种情况或值得一提，但存储过程在它们与语言无关的情况下也是“可移植的”。您可以像使用 PHP 一样从 Java 内部调用数据库上的相同存储过程。因为过程驻留在数据库中，所以可以访问数据库的任何东西都可以以相同的方式查询它们。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T05:27:31.097

存储过程的主要优点是您的数据在应用逻辑之前不会跨越层（在这种情况下它将是 PHP/MySQL 层）。某些查询可能需要多个 select 语句，通过 PHP 完成的速度比在 MySQL 中要慢。

现在，正如[Tobyhede 所](https://stackoverflow.com/questions/196652/prepared-statement-vs-stored-procedure#196678)指出的，将所有逻辑放在一个地方是件好事。但是我从事过使用 PHP 查询所需数据根本不现实的项目。它必须通过存储过程来完成。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-14T10:48:51.947

首先我会说我不喜欢存储过程的想法，我宁愿走准备好的语句路线。在这种特殊情况下，我认为您还将苹果与橙子进行比较……它们都具有完全不同的功能……

如果应用程序是 95% 的数据库驱动，我只会考虑存储过程，只有在数据库中有一些逻辑才有意义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T03:52:21.897

不熟悉 php，但通常存储过程已经“编译”，因此可能会比 sql 语句产生稍快的性能。

尽管从代码管理/部署和单元测试的角度来看，我通常更喜欢坚持使用 SQL。

# html - 任何人都知道将 HTML 表格呈现为图像的好算法吗？

> ID：196656
> 
> 赞同：1
> 
> 时间：2008-10-13T03:45:58.790
> 
> 标签：html, algorithm, image-processing

RFC 1942 中提到了一个标准的两遍算法：[http](http://www.ietf.org/rfc/rfc1942.txt) ://www.ietf.org/rfc/rfc1942.txt但是我还没有看到任何好的实际实现。有人知道吗？我无法在 Mozilla 或 WebKit 代码库中找到任何有用的东西，但我不完全确定该去哪里找。

我想这实际上可能是一个更深层次的问题，必须实际呈现 HTML（表格单元格的内容），但只是为了保持简单 - 将纯文本 HTML 表格作为图像。即使是忽略“作为图像”部分的 HTML 表格渲染算法......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T04:24:10.117

如果可以选择商业工具，请查看：

> [HtmlCapture ActiveX Control V2.0（原名HtmlSnap）](http://www.polestarsoft.com/htmlcapture/)

他们声称的一些功能：

*   **通过调用 SnapHtmlString()，您可以为 html 字符串拍摄快照。**
*   获取由 Microsoft IE 或 Mozilla Firefox 呈现的快照图像。
*   只需调用 SnapUrl() 和 SaveImage()，您就可以将网页快照转换为各种图像，例如 BMP、JPG、JPEG、GIF、PNG、TIF、TGA 和 PCX。
*   将 html 转换为矢量图像格式，如 EMF 和 WMF。
*   自包含 ActiveX 控件，没有第三方依赖项。
*   支持生成图像的自定义 gdi 输出。
*   支持将生成的图像保存到文件和内存中。
*   支持保存全尺寸网页和缩略图。
*   将整个网页的快照拍摄成一张没有滚动条的图像。
*   使用有效的算法制作灰度或黑白图像以保持质量。
*   支持JPEG压缩级别，TIFF和GIF压缩方式选择。
*   支持在图像中设置颜色深度，同时尽可能保持图像质量。
*   根据需要选择性地在网页上保存 activeX、图像、Java 小程序、脚本和视频。
*   在快照请求中发送自定义 cookie、http 标头、凭据。
*   通过代理服务器拍摄网页快照。
*   提供了 30 多个用 VC、C-、Delphi、VB、C++ Builder、Java、JScript、Perl、VBScript、ASP、ASP.net 和 PHP 编写的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T03:51:05.613

由于可以指定单元格大小的各种方式、嵌套在表格中的表格等，html 表格呈现并非微不足道。

如果你想要的只是图像，一个简单的解决方案是 .NET 浏览器控件（基本上是 IE 的 COM 组件）和屏幕捕获功能

如果你想获得一些源来操作，Mozilla 源应该仍然可用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T04:11:51.063

我不确定这是否符合您的限制，但您可以尝试使用 IE 或带有 MSHTML 的 IE 控件和[IHTMLElementRender](http://msdn.microsoft.com/en-us/library/aa752274(VS.85).aspx)接口将表格呈现到设备上下文。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T05:54:22.307

如果您有 XHTML，而不是纯 HTML，您应该能够检索这些单元格的内容以及有关表格结构的信息：colspan、rowspan 等。使用这些信息，您可以使用自己的边框、填充和边距值。

当您还想呈现用户定义的维度时，事情会变得复杂。但是为了检索表数据并绘制它，您可以使用 XML 解析器。PHP的解析器在这里：[http ://ca3.php.net/xml](http://ca3.php.net/xml)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T07:07:54.390

一种接近的工具是：[http ://www.terrainformatica.com/htmlayout/main.whtm](http://www.terrainformatica.com/htmlayout/main.whtm)

这个库提供了一种将渲染的 HTML 捕获到图像的方法，但是它不是开源的（但是免费的！）。希望对一些人有用！

不幸的是，我的应用程序是跨平台的 C/C++，没有 MFC 或平台依赖项（噩梦！）。我希望找到一种用于表格渲染的通用算法。我认为 RFC 中的 2-pass 选项非常接近，所以我可能会深入研究并反对它。如果可以的话，我一定会在博客上发布我的最终解决方案！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T08:31:53.673

看看[Prince XML](http://princexml.com/) - 它是一种将 CSS 样式的 XML（包括 XHTML）文档呈现为 PDF 的商业工具。该工具符合主要的 W3C 标准，如 XHTML 和 CSS2.1。您可以从他们的主页尝试免费的演示版！

由于您想要图像：以编程方式将生成的 PDF 转换为图像应该不是什么大问题。

# c# - 在泛型类型参数上调用静态方法

> ID：196661
> 
> 赞同：115
> 
> 时间：2008-10-13T03:49:43.293
> 
> 标签：c#, generics

我希望做这样的事情，但它在 C# 中似乎是非法的：

```
public Collection MethodThatFetchesSomething<T>()
    where T : SomeBaseClass
{
    return T.StaticMethodOnSomeBaseClassThatReturnsCollection();
} 
```

我得到一个编译时错误：

> “T”是一个“类型参数”，在给定的上下文中是无效的。

给定一个泛型类型参数，我如何在泛型类上调用静态方法？给定约束，静态方法必须可用。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-10-13T08:08:15.877

在这种情况下，您应该直接在约束类型上调用静态方法。C#（和 CLR）不支持虚拟静态方法。所以：

```
T.StaticMethodOnSomeBaseClassThatReturnsCollection 
```

...可以与以下内容没有什么不同：

```
SomeBaseClass.StaticMethodOnSomeBaseClassThatReturnsCollection 
```

遍历泛型类型参数是一种不需要的间接方式，因此不受支持。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-12-02T15:31:21.063

为了详细说明先前的答案，我认为反射更接近您在这里想要的。我可以给出 1001 个你应该或不应该做某事的理由，我会按照你的要求回答你的问题。我认为您应该在泛型参数的类型上调用 GetMethod 方法并从那里开始。例如，对于一个函数：

```
public void doSomething<T>() where T : someParent
{
    List<T> items=(List<T>)typeof(T).GetMethod("fetchAll").Invoke(null,new object[]{});
    //do something with items
} 
```

其中 T 是任何具有静态方法 fetchAll() 的类。

是的，我知道这非常慢，如果 someParent 不强制其所有子类实现 fetchAll 但它回答了所提出的问题，则可能会崩溃。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-13T04:06:16.567

调用这种方法的唯一方法是通过反射，但是，听起来有可能将该功能包装在接口中并使用基于实例的 IoC/工厂/等模式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-13T03:56:22.513

听起来您正在尝试使用泛型来解决 C# 中没有“虚拟静态方法”的事实。

不幸的是，这行不通。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-13T04:03:29.753

~~您应该能够使用反射来做到这一点，如此处[所述](http://blogs.microsoft.co.il/blogs/bursteg/archive/2006/11/15/InvokeStaticGenericMethod.aspx)~~

由于链接失效，我在wayback machine中找到了相关细节：

> 假设您有一个具有静态泛型方法的类：

```
class ClassWithGenericStaticMethod
{
    public static void PrintName<T>(string prefix) where T : class
    {
        Console.WriteLine(prefix + " " + typeof(T).FullName);
    }
} 
```

> 如何使用 reelection 调用此方法？
> 
> 事实证明这很容易……这就是使用反射调用静态泛型方法的方式：

```
// Grabbing the type that has the static generic method
Type typeofClassWithGenericStaticMethod = typeof(ClassWithGenericStaticMethod);

// Grabbing the specific static method
MethodInfo methodInfo = typeofClassWithGenericStaticMethod.GetMethod("PrintName", System.Reflection.BindingFlags.Static | BindingFlags.Public);

// Binding the method info to generic arguments
Type[] genericArguments = new Type[] { typeof(Program) };
MethodInfo genericMethodInfo = methodInfo.MakeGenericMethod(genericArguments);

// Simply invoking the method and passing parameters
// The null parameter is the object to call the method from. Since the method is
// static, pass null.
object returnValue = genericMethodInfo.Invoke(null, new object[] { "hello" }); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-12-28T15:08:38.550

我只是想把它扔在那里，有时代表会根据上下文解决这些问题。

如果您需要将静态方法调用为某种工厂或初始化方法，那么您可以声明一个委托并将静态方法传递给相关的泛型工厂或任何需要此“具有此静态方法的泛型类”的东西。

例如：

```
class Factory<TProduct> where TProduct : new()
{
    public delegate void ProductInitializationMethod(TProduct newProduct);

    private ProductInitializationMethod m_ProductInitializationMethod;

    public Factory(ProductInitializationMethod p_ProductInitializationMethod)
    {
        m_ProductInitializationMethod = p_ProductInitializationMethod;
    }

    public TProduct CreateProduct()
    {
        var prod = new TProduct();
        m_ProductInitializationMethod(prod);
        return prod;
    }
}

class ProductA
{
    public static void InitializeProduct(ProductA newProduct)
    {
        // .. Do something with a new ProductA
    }
}

class ProductB
{
    public static void InitializeProduct(ProductB newProduct)
    {
        // .. Do something with a new ProductA
    }
}

class GenericAndDelegateTest
{
    public static void Main()
    {
        var factoryA = new Factory<ProductA>(ProductA.InitializeProduct);
        var factoryB = new Factory<ProductB>(ProductB.InitializeProduct);

        ProductA prodA = factoryA.CreateProduct();
        ProductB prodB = factoryB.CreateProduct();
    }
} 
```

不幸的是，您不能强制该类具有正确的方法，但您至少可以在编译时强制生成的工厂方法具有它所期望的一切（即具有完全正确签名的初始化方法）。这比运行时反射异常要好。

这种方法也有一些好处，即您可以重用 init 方法，让它们成为实例方法等。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2021-04-03T03:11:44.863

你可以做我所说的代理单例，我已经将它用作一种“静态继承”有一段时间了

```
interface IFoo<T> where T : IFoo<T>, new()
{
    ICollection<T> ReturnsCollection();
}

static class Foo<T> where T : IFoo<T>, new()
{
    private static readonly T value = new();
    public static ICollection<T> ReturnsCollection() => value.ReturnsCollection();
}

// Use case

public ICollection<T> DoSomething<T>() where T : IFoo<T>, new()
{
    return Foo<T>.ReturnsCollection();
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-13T03:53:57.230

到目前为止，你不能。您需要一种方法来告诉编译器 T 具有该方法，而目前还没有办法做到这一点。（许多人正在推动微软扩展通用约束中可以指定的内容，所以也许这在未来是可能的）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-20T16:54:00.897

在这里，我发布了一个有效的示例，这是一种解决方法

```
public interface eInterface {
    void MethodOnSomeBaseClassThatReturnsCollection();
}

public T:SomeBaseClass, eInterface {

   public void MethodOnSomeBaseClassThatReturnsCollection() 
   { StaticMethodOnSomeBaseClassThatReturnsCollection() }

}

public Collection MethodThatFetchesSomething<T>() where T : SomeBaseClass, eInterface
{ 
   return ((eInterface)(new T()).StaticMethodOnSomeBaseClassThatReturnsCollection();
} 
```

# java - 如何在生产中引用来自不同子域（或 CDN）的资产？

> ID：196662
> 
> 赞同：1
> 
> 时间：2008-10-13T03:49:49.143
> 
> 标签：java, deployment, struts2, subdomain, cdn

我在 Ruby 和 Java 领域工作。我受到了[merb-assets](http://github.com/wycats/merb-more/tree/master/merb-assets)项目的启发，该项目提供了各种功能，可以轻松引用位于子域（或 CDN）上的资产（图像、CSS 等）。

我想在 Java 中做同样的事情：

*   在**开发和测试**中，我想使用 JSTL`<c:url>`或 Struts 2 的`<s:url value=""/>`标签来引用资产。
*   但在**生产**中，我想将这些资产中的大部分移到一个单独的子域（或 CDN）中。

是否有任何标记库（或其他方法）可以帮助解决这个问题？每次我插入or标记时，我都不想用`<c:if`和测试来浪费我的观点。`localhost``<img>``<link>`

我正在使用 Struts 2 + JSP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T14:45:06.107

我真的不知道 Struts 2，但我正在考虑一个涉及使用 Maven2 功能的解决方案......所以，如果你确实使用 Maven2 来构建你的应用程序，你可以用资源过滤器解决你的问题和配置文件功能。

资源过滤：您可以要求 Maven2 过滤资源文件（在我们的例子中是 JSP 文件）。过滤器意味着用它们的值替换所有 ${xxx}。这对于将参数（例如 ${domain.url}）替换为您需要的值（“localhost”、“http://...”）很有用。

然后，您定义 2 个配置文件：“开发测试”和“生产”。每个配置文件将为这些资产定义自己的域。例如，在开发测试中，您可以将域定义为“localhost”，在生产中，域将是“http://....”。

我不确定这是否可以解决您的问题，但您可以尝试一下：o）

参考：过滤器资源：[http](http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html) ://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html 配置文件：[http://maven.apache.org/guides/introduction/introduction-to-profiles。 html](http://maven.apache.org/guides/introduction/introduction-to-profiles.html)

# php - 打印发布值

> ID：196664
> 
> 赞同：19
> 
> 时间：2008-10-13T03:51:13.663
> 
> 标签：php

我有一个包含多个字段的表单，出于测试目的，有没有一种方法可以打印出在所有字段中输入的值，而不必单独打印每个值。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-13T03:55:38.333

你应该能够做一个`var_dump($_REQUEST);`

[http://us2.php.net/manual/en/reserved.variables.request.php](http://us2.php.net/manual/en/reserved.variables.request.php)

[http://us2.php.net/manual/en/function.var-dump.php](http://us2.php.net/manual/en/function.var-dump.php)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-13T04:27:52.840

为了获得额外的荣誉，我总是有：

```
function pre($data) {
    print '<pre>' . print_r($data, true) . '</pre>';
} 
```

每当我需要调试一个数组时——这很常见——我只是做 pre($arr); 获得格式良好的转储。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-13T05:26:06.827

`print_r()`/`var_dump()`很简单，可以完成工作。

如果您想要样式/动态选项，请查看[Krumo](http://krumo.sourceforge.net/)：

> [http://krumo.sourceforge.net/](http://krumo.sourceforge.net/)
> 
> *许多开发人员使用`print_r()`和`var_dump()`... Krumo 是一个替代方案：它做同样的工作，但它呈现使用 CSS 和 DHTML 美化的信息。*

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-05-17T09:00:49.523

如果你密切注意`$_POST[]`or`$_GET[]`方法，你会发现它们实际上都是数组。这意味着你可以像处理任何其他数组一样使用它们。

例如，您可以`print_r($_POST)`并且您将看到输入方式的所有内容。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-11-06T11:40:54.007

我基本上使用：

```
echo "<pre>"; print_r($_POST) ;  echo "</pre>"; 
```

它以一种很好的格式打印帖子值。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-04T08:42:07.783

这段 PHP 代码不需要任何关于提交给它的表单中的字段的知识，它只是遍历所有字段，包括多项选择字段（如复选框），并吐出它们的值。

```
<?php
// loop through every form field
while( list( $field, $value ) = each( $_POST )) {
   // display values
   if( is_array( $value )) {
      // if checkbox (or other multiple value fields)
      while( list( $arrayField, $arrayValue ) = each( $value ) {
         echo "<p>" . $arrayValue . "</p>\n";
      }
   } else {
      echo "<p>" . $value . "</p>\n";
   }
}
?> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-13T08:17:02.380

如果您要进行大量调试，我建议您安装[XDebug](http://xdebug.org/)。它使 var_dump 非常漂亮和有用（还为您提供变量的类型和长度）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-09-30T03:56:46.260

这不仅显示了 POST 变量，而且还非常简单。

```
<?php
    phpinfo(INFO_VARIABLES);
?> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T07:10:10.220

除了使用内联调试语句外，您还可以考虑瞬态调试，即您可以使用具有调试功能的 IDE，如 eclipse 或 zend studio。通过这种方式，您可以查看您想要查看的任何变量。

再见！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-01-25T11:23:32.907

使用`pr($_POST);`或者`var_dump($_POST);`
你总是可以显示 var echo 命令：

```
echo ($_POST['value']; 
```

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2013-09-19T10:33:32.257

很简单，

```
phpinfo(); 
```

它以易于阅读的格式包含从表单传递给 PHP 的所有变量的列表。

# jasper-reports - JasperReports 中的外部样式

> ID：196668
> 
> 赞同：23
> 
> 时间：2008-10-13T03:53:45.703
> 
> 标签：jasper-reports, styles

我正在开发一个包含大量报告的系统，这些报告是使用[JasperReports](http://jasperforge.org/plugins/project/project_home.php?group_id=102)生成的。较新的功能之一是您可以定义报告的样式。

从可用的文档中，我相信有一些方法可以让外部文件定义要使用的样式，您可以在 jasper 报告中引用它。这允许多个报告使用单一样式。

我找不到任何关于这是否是实际功能的具体信息，如果是，如何使用它。有谁知道碧玉报告是否可以有外部样式，如果可以，怎么做？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-15T20:47:52.410

使用[JasperReport 模板](http://jasperreports.sourceforge.net/sample.reference/templates/#templates)。JasperReports 模板是一个以 结尾的模板`.jrtx`，可能看起来类似于此 ( `styles.jrtx`)：

```
<?xml version="1.0"?>
<!DOCTYPE jasperTemplate
  PUBLIC "-//JasperReports//DTD Template//EN"
  "http://jasperreports.sourceforge.net/dtds/jaspertemplate.dtd">

<jasperTemplate>
    <style name="Report Title" isDefault="false" hAlign="Center" fontSize="24" isBold="true"/>
    <style name="Heading 1" isDefault="false" fontSize="18" isBold="true"/>
    <style name="Heading 2" isDefault="false" fontSize="14" isBold="true"/>
</jasperTemplate> 
```

然后在您的`.jrxml`文件中，将其作为模板包含在内：

```
...
<template><![CDATA["styles.jrtx"]]></template>
... 
```

iReport 也理解这一点，因此您的样式被导入并正确显示在 iReport 中（尽管我确实注意到有时它不会选择它们，因此需要重新加载或重新编译）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-27T18:14:25.127

您还可以`<template>`通过在运行时使用传递到报告中的参数来避免在元素中指定实际文件名

`<parameter name="TEMPLATE_FILE" isForPrompting="false" class="java.lang.String"/>`

`<template><![CDATA[$P{TEMPLATE_FILE}]]></template>`

其中 $P{TEMPLATE_FILE} 是样式资源的完整路径

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-25T06:20:42.933

我喜欢分享我在 Jasper 报表中使用样式的学习，我认为这对像我这样的报表设计师非常有用，来自 Bilal Siddiqui 的一本名为 JasperReport Development Cookbook 的书。我喜欢这本书，并发现以多种方式展示风格，例如：

*   **创建可重复使用的样式**
    只需在创建新报告时选择“样式”并定义文本、线条和矩形的样式。样式文件将存储为 .jrtx 文件。

*   在您的报告中导入可重复使用的样式在您的报告
    中导入样式时有三个信息块。第1步。样式模板的名称和位置

> ```
> <template><![CDATA["C:\\ BigBoldRedTemplate.jrtx"]]></template> 
> ```

第2步。每次使用样式模板将样式应用于报表元素时，`<reportElement>`都会创建一个标签，如下所示：

```
//style applied to a rectangle
<rectangle radius="10">
    <reportElement style="BigBoldRed" mode="Transparent" x="0" y="0" width="555" height="44"/>
</rectangle>
//style applied to a the text field
<staticText>
        <reportElement style="BigBoldRed" x="0" y="0" width="555" height="66"/>
        <textElement textAlignment="Center" verticalAlignment="Middle"/>
        <text><![CDATA[Monthly Customer Invoices]]></text>
</staticText> 
```

*   **在报表中混合内部样式和可重用样式**

*   **使用 HTML 的力量来设置报表的样式**
    例如，您的文本字段具有以下表达式，其中包含 HTML 标记（即`<li>`），并且您希望 HTML 标记在您的报表设计中起作用：

> ```
> "<li>"+"Invoice # "+$F{InvoiceID}+", "+ 
> ```
> 
> $F{CustomerName}+" 在 "+$F{InvoicePeriod}+" 购买了 "+$F{ProductName}+" (发票价值: \$ "+$F{InvoiceValue}+")"+"

解决方案很简单，只需将文本字段的“标记”属性设置为“样式”即可。

我已获得作者的许可，可以在这篇文章中从他的 JasperReports 食谱中复制代码块。

# file-management - 归档文件

> ID：196669
> 
> 赞同：1
> 
> 时间：2008-10-13T03:53:48.977
> 
> 标签：file-management

我真的很喜欢 gmail 实施存档系统的方式。我可以在添加标签后归档任何文件（如果需要），我可以随时搜索它。Windows/Linux 中是否有任何程序以类似的方式运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T10:54:21.983

当您在 gmail 中“存档”时，您只是删除了一个隐藏标签（“收件箱”）。在您自己的文件系统中做这件事似乎没什么用，因为您实际上并没有“归档”任何东西。祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T22:55:22.653

您可以查看[http://code.google.com/p/xtagfs/](http://code.google.com/p/xtagfs/)，（或者通常搜索“基于标签的文件系统”之类的内容；可能还有更多）。这允许您标记文件，然后获取具有特定标记/标记的所有文件的列表（并且它“感觉”就像一个普通的文件系统）。看起来很像你正在寻找的东西，也许有一些调整。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T06:06:36.243

你可能喜欢谷歌的 GoogleDesktop……它本身没有标签，但它似乎有相当有效的桌面搜索。

# agile - 我们的敏捷计划是标准的吗？

> ID：196673
> 
> 赞同：0
> 
> 时间：2008-10-13T03:55:50.533
> 
> 标签：agile, scrum

我们一直在尝试 Scrum，但现在正在尝试将其形式化为我们自己的敏捷应用程序开发版本。以下是我们当前流程的工作方式。就目前而言，它有两个主要缺点。想了解您是否有类似的方法，以及社区是否对我们目前遇到的障碍有任何实用技巧。

*   Scrum 团队 = 4 名开发人员、2 名 QA、1 名技术作家、1 名 PO（PM）、1 名 Scrum Master（Engg Dir）
*   发布 = 3 个 Sprint
*   冲刺 = 2 周

PO 和客户创建用户故事和相关验收标准的产品积压。
每次迭代开始时的 1 周 Sprint 计划

*   第 1 天# 估算 Sprint 积压并就优先级达成一致
*   第 2-5 天# Scrum 团队讨论故事并处理 Sprint 待办事项中每个故事的详细信息（获取故事的详细信息、流程（如果有）、确定要应用的 UE 指南、UI 项目/字段/小部件的详细信息及其如果需要任何特定的行为，了解验收标准并创建测试）
*   2 周 Sprint，每天 15 分钟 Scrum
*   重复 3 周周期

我们在这方面遇到的两个主要缺点是：

1.  在春季计划周中讨论的细节没有被有效地捕捉并在 wiki 上得到记录。由于在 Scrum 中捕获此类细节没有标准格式，因此在日常 Scrum 中经常浪费时间，或者需要后续会议来进一步了解故事细节。在 sprint 计划中为功能相当复杂的产品捕获故事细节的最佳方法是什么？大多数问题似乎都与 UI 有关，开发人员无法在没有详细模拟的情况下决定如何布局屏幕/字段。
2.  当团队处于 sprint 周期时，您如何预测来自客户的关键漏洞。目前，开发人员必须被拉出来支持这些突然出现的红色帐户问题，从而扰乱了冲刺。

关于我们如何改进这一点的任何意见？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T06:41:34.770

1.  没有“标准”敏捷计划。计划并不重要……计划才是。我的意思是定期调整您的计划以反映实际情况。制定一个计划，让它受到权力的祝福，然后束缚在开发人员身上，这在传统上是行不通的。
2.  如果我没记错的话，冲刺计划不应该超过一天。Scrum 的关键思想之一是您不会花费太多时间进行计划。如果他们这样做了，当你有更好的清晰度时停下来重新召集......不要跋涉。
    *   从客户那里获得优先级的故事集 ~3 小时
    *   开发人员挤在一起估计约 3 小时
    *   显示估计并让客户更改他们的存储桶以反映业务需求（在 sprint 配额内）~rem time。

记录决定：

*   找个好抄写员？可以像 4 个人说话一样快地打字的人.. 在图表等高可见度区域中获得核心陈述/决定.. 或 wiki.. 任何适合您的东西

用户体验研究：

*   尝试流水线化 UX 工作。确保 UX 人员在开发人员开始处理 UI 细节、模拟屏幕、工作流程等方面已经完成了工作。当开发人员正在处理迭代 n 时，UX 正在处理迭代 n+1 的故事。有点困难，但如果 UX 对您造成了很多“颠簸”，则可以完成。

错误职责：

*   一种方法是将所有错误作为下一次迭代的常规积压项。在 sprint 计划期间让客户认可哪些需要加入。
*   如果这不可行，趋势错误流入、修复率和计划。为专用于这些请求的按需修复开发人员保留 x 天。

改进范围： **您需要一个专门的“客户”角色**（或可以为客户提供指导的教练/BA），开发人员可以实时联系。每日 Scrum 会议的时间限制应为 30 分钟，并且不应包括故事“澄清”。坚持 3 个问题 - 你昨天做了什么？今天你在做什么？有什么需要帮助的障碍吗？
负责特定故事的开发人员或子团队应与客户/前台合作，以防*他们在执行特定任务时遇到疑问*. 作为开发工作的一部分，他们负责提取细节。如果有帮助，他们也可以向其他在相关领域工作过的开发人员寻求帮助。与客户一起工作，保持在正确的轨道上。
高温高压

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T04:02:13.953

是的。我注意到，在您的流程中，开发人员没有在倾听/与实际最终用户交谈。这是**失败的秘诀**。您**不能**指望您的“采购订单”能够捕捉到实际用户会表达的所有细微差别。

**开发人员必须与最终用户交谈**。PO 也应该在那里，以**记录发现**的内容。这是我在大多数开发项目中看到的最大问题，开发者与用户的分离。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T04:23:50.603

你为什么要每周召开一次冲刺计划会议？sprint 计划的目标是获得足够的细节，让团队感觉舒适，拥有可以完成的功能并承诺去做。这通常需要不到一天的时间（约 4 小时）。开发人员在冲刺期间及时发现了实际的实施细节。这就是为什么他们能够访问 PO 和用户如此重要的原因。如果您询问在哪里捕获细节，那么您在计划会议上进行了很多设计。细节应该在冲刺期间直接进入代码，因为它们是制定的。

什么是炫耀？PO 在每个 sprint（2 周）结束时查看进度，然后决定业务价值是否足以保证发布。如果有任何关键问题，那么 PO 可能不会发布该 sprint。希望您可以让您的 PO 和用户在功能完成后每天查看产品，从而减少 sprint 结束时出现问题的可能性。

# c# - 您可以在单个项目中混合使用 .net 语言吗？

> ID：196677
> 
> 赞同：18
> 
> 时间：2008-10-13T04:01:23.097
> 
> 标签：c#, .net, f#

您可以在单个项目中混合使用 .net 语言吗？所以预编译，我想调用其他源文件的类和方法。

对于网络和应用程序？

特别是我会对 F# 和 C# 感兴趣。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-13T04:12:39.813

[您可以使用ILMerge](http://www.microsoft.com/downloads/details.aspx?FamilyID=22914587-B4AD-4EAE-87CF-B14AE6A939B0&displaylang=en)和[MSBuild](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)在单个程序集中混合语言。

[这](http://www.hanselman.com/blog/MixingLanguagesInASingleAssemblyInVisualStudioSeamlesslyWithILMergeAndMSBuild.aspx)是一个很好的例子。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-13T05:46:13.493

是的，您可以，但 Visual Studio 不直接支持它。你要做的是将代码编译成网络模块，然后将它们组合成一个程序集。编译器支持生成这些网络模块的“/target:module”选项。

然后，您可以在构建时使用编译器来引用其他网络模块，或使用[Assembly Linker (Al.exe)](http://msdn.microsoft.com/en-us/library/c405shex.aspx)。甚至还有一个 msbuild 任务：[AL (Assembly Linker) Task](http://msdn.microsoft.com/en-us/library/cywecfx9.aspx)。

MSDN 上提供了完整的概述：[如何：构建多文件程序集](http://msdn.microsoft.com/en-us/library/226t7yxe.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-13T04:17:00.693

CMS 提到了一种有趣的方法，但实际上我建议您保持简单，并为 C# 和 F# 代码使用不同的程序集（项目）。C# 和 F# 之间有详细记录的通信点（例如[here](http://research.microsoft.com/fsharp/manual/export-interop.aspx)和[here](http://research.microsoft.com/fsharp/manual/import-interop.aspx)） - 我会推荐它们。C# 和 F# 之间的差异（尤其是 F# 具有不同的运行时！）非常大......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T04:03:42.093

您可以在每个程序集项目（库 DLL）中指定语言并在同一个解决方案中使用其中的几个，但我认为您不能在同一个程序集中混合语言

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T04:15:53.787

您可以在网站项目与编译优先项目中执行此操作：[http ://www.aspnetlibrary.com/articledetails.aspx?article=Use-C-Sharp-and-VB.NET-in-the-same-项目](http://www.aspnetlibrary.com/articledetails.aspx?article=Use-C-Sharp-and-VB.NET-in-the-same-project)。网站的 BuildProvider 即时解析语言元素。

.NET 的[BuilderProvider](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)仍然不可用于非网站项目，因此您对标准应用程序混合 Intellisense 不走运。

# javascript - jQuery获取特定的选项标签文本

> ID：196684
> 
> 赞同：1271
> 
> 时间：2008-10-13T04:06:34.693
> 
> 标签：javascript, jquery, jquery-selectors, html-select

好吧，说我有这个：

```
<select id='list'>
    <option value='1'>Option A</option>
    <option value='2'>Option B</option>
    <option value='3'>Option C</option>
</select> 
```

如果我想在我的值为“2”时获得“选项 B”，选择器会是什么样子？

请注意，这不是询问如何获取*所选*文本值，而是询问其中任何一个，无论是否选中，具体取决于 value 属性。我试过：

```
$("#list[value='2']").text(); 
```

但它不起作用。

* * *

## 回答 #1

> 赞同：1268
> 
> 时间：2009-05-15T15:52:49.007

如果您想获得值为 2 的选项，请使用

```
$("#list option[value='2']").text(); 
```

* * *

如果您想获取当前选择的任何选项，请使用

```
$("#list option:selected").text(); 
```

* * *

## 回答 #2

> 赞同：1141
> 
> 时间：2008-10-13T04:08:03.723

它正在寻找一个 id 的元素，`list`它的属性`value`等于`2`.
你想要的是以下的`option`孩子`list`：

```
$("#list option[value='2']").text() 
```

* * *

## 回答 #3

> 赞同：135
> 
> 时间：2011-07-29T18:55:23.707

这对我来说非常有效，我正在寻找一种使用 MySQL 生成的选项发送两个不同值的方法，以下是通用和动态的：

### `$(this).find("option:selected").text();`

如评论之一所述。有了这个，我能够创建一个动态函数，该函数适用于我想要同时获取值、选项值和文本的所有选择框。

几天前，我注意到当我使用此代码将网站的 jQuery 从 1.6 更新到 1.9 时，这停止工作......可能与另一段代码冲突......无论如何，解决方案是从find() 调用：

```
$(this).find(":selected").text(); 
```

那是我的解决方案……只有在更新 jQuery 后有任何问题时才使用它。

* * *

## 回答 #4

> 赞同：109
> 
> 时间：2011-05-02T12:25:54.453

基于 Paolo 发布的原始 HTML，我想出了以下内容。

```
$("#list").change(function() {
    alert($(this).find("option:selected").text()+' clicked!');
}); 
```

它已经过测试可以在 Internet Explorer 和 Firefox 上运行。

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2010-06-04T14:30:43.497

```
$("#list option:selected").each(function() {
   alert($(this).text());
}); 
```

对于`#list`元素中的多个选定值。

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2012-06-13T03:45:55.690

1.  如果页面上只有一个 select 标签，那么您可以在 id 'list' 中指定 select

    ```
    jQuery("select option[value=2]").text(); 
    ```

2.  获取选定的文本

    ```
    jQuery("select option:selected").text(); 
    ```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2008-10-13T04:08:45.657

尝试以下操作：

```
$("#list option[value=2]").text(); 
```

您的原始代码段不起作用的原因是您的标签是您的`OPTION`标签的子`SELECT`标签，该标签具有`id` `list`.

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2014-07-02T23:15:48.357

这是一个旧问题，有一段时间没有更新，现在正确的方法是使用

```
$("#action").on('change',function() {
    alert($(this).find("option:selected").text()+' clicked!');
}); 
```

我希望这有帮助 ：-）

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2011-03-01T05:44:03.060

我想获得选定的标签。这在 jQuery 1.5.1 中对我有用。

```
$("#list :selected").text(); 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2013-04-03T11:21:19.230

```
$(this).children(":selected").text() 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2017-03-02T09:35:55.250

您可以使用函数获取选定的选项文本`.text();`

你可以这样调用函数：

```
jQuery("select option:selected").text(); 
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2010-05-31T06:38:46.203

```
$("#list [value='2']").text(); 
```

在 id 选择器后面留一个空格。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2011-05-26T19:04:13.223

在使用 .each(function()...): “循环”动态创建的选择元素时`$("option:selected").text();`，并`$(this + " option:selected").text()`没有返回选定的选项文本 - 相反它是空的。

但 Peter Mortensen 的解决方案奏效了：

```
$(this).find("option:selected").text(); 
```

我不知道为什么通常的方式没有成功`.each()`（可能是我自己的错误），但谢谢你，彼得。我知道这不是最初的问题，但我提到它是“针对通过 Google 来的新手”。

`$('#list option:selected").each()`除了我还需要从 select 元素中抓取东西之外，我本来会开始的。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2011-07-11T23:53:18.750

采用：

```
function selected_state(){
    jQuery("#list option").each(function(){
        if(jQuery(this).val() == "2"){
            jQuery(this).attr("selected","selected");
            return false;
        }
    });
}

jQuery(document).ready(function(){
    selected_state();
}); 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2013-11-05T21:57:29.253

我正在寻找通过内部字段名称而不是 ID 获取 val 并从谷歌来到这篇文章，这有助于但没有找到我需要的解决方案，但我得到了解决方案，它是：

因此，这可能会帮助某人使用字段内部名称查找选定值，而不是对 SharePoint 列表使用长 id：

```
var e = $('select[title="IntenalFieldName"] option:selected').text(); 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2015-03-09T05:43:12.080

提示：如果您的值是动态的，您可以使用以下代码：

```
$("#list option[value='"+aDynamicValue+"']").text(); 
```

或者（更好的风格）

```
$("#list option").filter(function() {
     return this.value === aDynamicValue;
}).text(); 
```

如[jQuery 中所述，获取特定的选项标签文本并将动态变量设置为值](https://stackoverflow.com/questions/12135825/jquery-get-specific-option-tag-text-and-placing-dynamic-variable-to-the-value/12135848)

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-02-12T15:36:08.050

我在处理动态转换对象时需要这个答案，而这里的其他方法似乎不起作用：

```
element.options[element.selectedIndex].text 
```

这当然使用[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)对象，而不是使用 nodeValue、childNodes 等来解析其 HTML。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-01-20T14:57:54.380

作为替代解决方案，您还可以使用[jQuery 选择器的上下文部分](http://api.jquery.com/jQuery/#jQuery1)在下拉列表中查找`<option>`元素：`value="2"`

```
$("option[value='2']", "#list").text(); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-01-03T21:04:03.537

我想要一个用于选择多个的动态版本，它将显示右侧选择的内容（希望我能继续阅读并看到`$(this).find`......早些）：

```
<script type="text/javascript">
    $(document).ready(function(){
        $("select[showChoices]").each(function(){
            $(this).after("<span id='spn"+$(this).attr('id')+"' style='border:1px solid black;width:100px;float:left;white-space:nowrap;'>&nbsp;</span>");
            doShowSelected($(this).attr('id'));//shows initial selections
        }).change(function(){
            doShowSelected($(this).attr('id'));//as user makes new selections
        });
    });
    function doShowSelected(inId){
        var aryVals=$("#"+inId).val();
        var selText="";
        for(var i=0; i<aryVals.length; i++){
            var o="#"+inId+" option[value='"+aryVals[i]+"']";
            selText+=$(o).text()+"<br>";
        }
        $("#spn"+inId).html(selText);
    }
</script>
<select style="float:left;" multiple="true" id="mySelect" name="mySelect" showChoices="true">
    <option selected="selected" value=1>opt 1</option>
    <option selected="selected" value=2>opt 2</option>
    <option value=3>opt 3</option>
    <option value=4>opt 4</option>
</select> 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-05-08T09:57:02.383

您可以获得以下方式之一

```
$("#list").find('option').filter('[value=2]').text()

$("#list").find('option[value=2]').text()

$("#list").children('option[value=2]').text()

$("#list option[value='2']").text() 
```

```
$(function(){    

    console.log($("#list").find('option').filter('[value=2]').text());
    console.log($("#list").find('option[value=2]').text());
    console.log($("#list").children('option[value=2]').text());
    console.log($("#list option[value='2']").text());

});
```

```
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<select id='list'>
    <option value='1'>Option A</option>
    <option value='2'>Option B</option>
    <option value='3'>Option C</option>
</select>
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-10-21T14:22:26.287

试试这个：

```
jQuery("#list option[value='2']").text() 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-08-20T14:23:19.213

尝试

```
[...list.options].find(o=> o.value=='2').text 
```

```
let text = [...list.options].find(o=> o.value=='2').text;

console.log(text);
```

```
<select id='list'>
    <option value='1'>Option A</option>
    <option value='2'>Option B</option>
    <option value='3'>Option C</option>
</select>
```

# objective-c - 在清理 ObjC 对象时是否有处理非内存资源的模式？

> ID：196695
> 
> 赞同：4
> 
> 时间：2008-10-13T04:11:39.503
> 
> 标签：objective-c, cocoa

对于具有与非内存资源相关的某些状态的对象，通常会提供一种方法来显式地“完成”该资源。是否有首选的常见做法来处理仍处于“使用我的资源”状态时尝试释放对象的情况？我已经看到了几种不同的方法：

1.  记录程序员犯了一个错误并告诉他们如何调试它（`NSLock`这样做）
2.  让调用者选择资源是由调用者管理还是在释放时放弃（例如`NSFileHandle`）
3.  如果对象未处于预期的最终状态，则引发异常，即断言程序员不会以这种方式使用我的对象
4.  出门时总是打扫卫生。

[GC 文档](http://developer.apple.com/documentation/Cocoa/Conceptual/GarbageCollection/Articles/gcFinalize.html#//apple_ref/doc/uid/TP40002453-SW1)确认与内存管理一起管理其他资源是一个坏主意，并且（但）提供了一个执行 4 的示例，尽管有一些警告。那么有没有人“选择”了一种始终遵循的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T06:38:40.097

由于大多数 Cocoa 框架对象早于垃圾回收，因此您不能假设 NSFileHandle 是最好的方式。我认为这个问题是我们希望为每个场景都遵循一种模式并省去我们做出选择的麻烦的众多问题之一。不幸的是，我认为这是不可能的。您将不得不根据具体情况确定最好的方法。

以下是选择任何选项的理由：

1.  如果自动清理相当安全，但程序确实应该手动进行。
2.  如果您正在编写一个库，并且该资源可能属于或不属于您的对象。
3.  如果无法进行自动清理或存在某种风险。
4.  如果自动清理是微不足道的，不值得打扰任何人手动进行。

# javascript - 将 JavaScript 放在 HTML 文件中的什么位置？

> ID：196702
> 
> 赞同：225
> 
> 时间：2008-10-13T04:19:52.390
> 
> 标签：javascript, html, optimization

假设我有一个相当大的 JavaScript 文件，压缩到大约 100kb 左右。通过文件，我的意思是它是一个外部文件，可以通过链接链接`<script src="...">`，而不是粘贴到 HTML 本身。

将它放在 HTML 中的最佳位置在哪里？

```
<html>
<head>
    <!-- here? -->
    <link rel="stylesheet" href="stylez.css" type="text/css" />
    <!-- here? -->
</head>
<body>
    <!-- here? -->
    <p>All the page content ...</p>
    <!-- or here? -->
</body>
</html> 
```

每个选项之间会有任何功能差异吗？

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2008-10-13T04:34:18.257

雅虎！由于浏览器下载组件的方式，卓越性能团队建议[将脚本放在页面底部。](http://developer.yahoo.com/performance/rules.html#js_bottom)

当然，Levi 的评论“就在你需要它之​​前，并且很快”确实是正确的答案，即“它取决于”。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-10-13T04:24:33.223

它的最佳位置就在您需要它之前，而且很快。

此外，根据您用户的实际位置，使用像 Amazon 的 S3 服务这样的服务可能会帮助用户从物理上比您的服务器更靠近他们的服务器下载它。

你的 js 脚本是 jQuery 还是原型之类的常用库？如果是这样，有很多公司，比如谷歌和雅虎，都有工具可以在分布式网络上为你提供这些文件。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2014-05-05T15:56:16.987

根据经验，放置`<script>`标签的最佳位置是页面底部，就在`</body>`标签之前。像这样的东西：

```
<html>
    <head>
        <title>My awesome page</title>

        <!-- CSS -->
        <link rel="stylesheet" type="text/css" href="...">
        <link rel="stylesheet" type="text/css" href="...">
        <link rel="stylesheet" type="text/css" href="...">
        <link rel="stylesheet" type="text/css" href="...">

    </head>
    <body>
        <!-- Content content content -->

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript" src="..."></script>
        <script type="text/javascript" src="..."></script>
        <script type="text/javascript" src="..."></script>
    </body>
</html> 
```

# **为什么？**

> 脚本引起的问题是它们会阻止并行下载。HTTP/1.1 规范建议浏览器每个主机名并行下载不超过两个组件。如果您从多个主机名提供图像，则可以同时进行两次以上的下载。但是，在下载脚本时，浏览器不会启动任何其他下载，即使在不同的主机名上也是如此。*[更多的...](https://developer.yahoo.com/performance/rules.html)*

# **CSS**

有点离题，但是... 将样式表放在顶部。

> 在 Yahoo! 研究性能时，我们发现将样式表移动到文档 HEAD 会使页面加载速度更快。这是因为将样式表放在 HEAD 中可以让页面逐步呈现。*[更多的...](https://developer.yahoo.com/performance/rules.html)*

# **进一步阅读**

雅虎发布了一个非常酷的指南，列出了加快网站速度的最佳实践。绝对值得一读： [https ://developer.yahoo.com/performance/rules.html](https://developer.yahoo.com/performance/rules.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-13T07:36:41.150

使用 100k 的 Javascript，你永远不应该把它放在文件中。使用外部脚本 Javascript 文件。绝对不可能只在一个 HTML 页面中使用这么多的代码。您可能会问应该在哪里加载 Javascript 文件，因为您已经收到了令人满意的答案。

但我想指出，现代浏览器通常接受**gzip** ped Javascript 文件！`x.js`只需将文件gzip到 ，并在属性`x.js.gz`中指向它。`src`它不适用于本地文件系统，您需要一个网络服务器才能使其工作。但是传输字节的节省可能是巨大的。

我已经在 Firefox 3、MSIE 7、Opera 9 和 Google Chrome 中成功地测试了它。它显然在 Safari 3 中不能以这种方式工作。

有关更多信息，请参阅[此博客文章](http://joseph.randomnetworks.com/archives/2006/07/13/compressed-javascript/)和另一个[非常古老的页面](http://schroepl.net/projekte/mod_gzip/browser.htm)，但它仍然很有用，因为它指出网络服务器可以检测浏览器是否可以接受 gzipped Javascript。如果您的服务器端可以动态选择发送 gzipped 或纯文本，您可以使该页面在所有 Web 浏览器中可用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-16T14:44:15.917

将 javascript 放在顶部看起来更整洁，但从功能上讲，最好是在 HTML 之后。这样，您的 javascript 将不会在加载之前运行并尝试引用 HTML 元素。此类问题通常仅在您通过实际的 Internet 连接加载页面时才变得明显，尤其是在速度较慢的情况下。

您还可以尝试通过添加来自其他 javascript 代码的 header 元素来动态加载 javascript，尽管这仅在您不一直使用所有代码时才有意义。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-16T14:22:33.870

使用[cuzillion](http://stevesouders.com/cuzillion/)，您可以使用不同的方法测试脚本标签的不同位置对页面加载的影响：内联、外部、“HTML 标签”、“document.write”、“JS DOM 元素”、“iframe”和“XHR eval” . 有关差异的说明，请参阅[帮助](http://stevesouders.com/cuzillion/help.php)。它还可以测试样式表、图像和 iframe。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T08:33:56.010

答案取决于您如何使用 javascript 的对象。正如已经指出的那样，在页脚而不是页眉处加载 javascript 文件肯定会提高性能，但应注意所使用的对象的初始化时间要晚于它们在页脚处加载。另一种方法是加载放置在所有文件都可用的文件夹中的“js”文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-02-26T20:14:07.083

脚本应该包含在 body 标记的末尾，因为这样 HTML 将被浏览器解析并在脚本加载之前显示。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T08:51:21.310

就像其他人所说的那样，它很可能应该放在外部文件中。我更喜欢在 <head /> 的末尾包含此类文件。这种方法比机器友好更人性化，但这样我总是知道 JS 在哪里。将脚本文件包含在其他任何地方（恕我直言）是不那么可读的。

我真的需要挤出最后一个毫秒然后你可能应该按照雅虎所说的去做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-18T17:12:28.760

您的 javascript 链接可以位于正文标记的头部或末尾，确实可以通过将链接放在正文标记的末尾来提高性能，但除非性能是一个问题，否则将它们放在头部会更好供人们阅读，并且您知道链接的位置并可以更轻松地引用它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-07-26T11:49:56.080

我想说这实际上取决于你打算用 Javascript 代码实现什么：

*   如果你打算在外部插入你的 JS 脚本，那么最好的位置是在页面的头部
*   如果你打算在智能手机上使用页面，那么页面底部，就在标签之前。
*   但是，如果您计划组合 HTML 和 JS（例如动态创建和填充的 HTML 表），那么您必须将它放在您需要的地方。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-06-05T10:27:59.027

问题的答案取决于。在这种情况下有两种情况，您需要根据您的适当情况做出选择。

**场景 1 - 关键脚本/必须需要的脚本**

如果您使用的脚本对于加载网站很重要，建议将其放在 HTML 文档的顶部，即`<head>`. 一些示例包括 - 应用程序代码、引导程序、字体等。

**场景 2 - 不太重要/分析脚本**

也有使用不影响网站视图的脚本。建议在加载所有重要段后加载此类脚本。答案将是文档的底部，即`<body>`结束标签之前的底部。一些示例包括 - Google 分析、hotjar 等。

**奖金 - 异步/延迟**

您还可以告诉浏览器脚本加载可以与其他脚本同时完成，并且可以使用脚本代码中的 defer / async 参数根据浏览器的选择进行加载。

例如。`<script async src="script.js"></script>`

# javascript - 将正则表达式与 JavaScript 匹配

> ID：196713
> 
> 赞同：1
> 
> 时间：2008-10-13T04:26:53.887
> 
> 标签：javascript, regex

我需要匹配表格中的内容

```
<a href="pic/5" id="piclink"><img src="thumb/5" /></a> 
```

使用 JavaScript 查找数字，在本例中为 5。我不知道如何使用正则表达式，所以我想知道这里是否有人可以帮忙。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T04:48:43.953

只是为了确保您知道发生了什么，您在自己的答案中发布的模式将完全匹配0 到 9 之间的**一位数字。**

如果你想匹配一个或多个数字的整数，你可以试试这个模式

```
/[0-9]+/ 
```

查看[Wikipedia 关于正则表达式的文章](http://en.wikipedia.org/wiki/Regular_expressions)以获得很好的概述。如果您刚开始使用正则表达式可能会让人不知所措，但是一旦您掌握了基本语法，它们就会变得非常有用和强大。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T04:34:04.763

没关系，我用一个简单的方法解决了它

```
'<a href="pic/5" id="piclink"><img src="thumb/5" /></a>'.match(/[0-9]/); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T04:57:04.420

目前尚不清楚一般情况是什么（您的示例中的具体情况是“5”）。如果您尝试提取 URI 路径的最后一段，则可以在不使用正则表达式的情况下实现它：

使用 jQuery（不是必需的，但如果上下文允许，这是一个非常有效的工具）：

```
$('#picklink > img').attr('src').split('/').pop(); 
```

`"$('#picklink > img').attr('src')"`是 jQuery，部分`".split('/').pop();"`是直接的 JavaScript。

# java - 如何让 Cobertura 因代码覆盖率低而无法构建 M2

> ID：196721
> 
> 赞同：9
> 
> 时间：2008-10-13T04:35:31.327
> 
> 标签：java, maven-2, build-automation, code-coverage, cobertura

如果线路或分支覆盖率低于给定阈值，我正在尝试将我的 WAR 项目构建配置为失败。我一直在使用优秀书籍[Java Power Tools](http://oreilly.com/catalog/9780596527938/)第 455 页提供的配置，但没有成功。这是我项目的 Maven 2 POM 的相关片段：

```
<build>
...
<plugins>
  <plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>cobertura-maven-plugin</artifactId>
    <version>2.2</version>
    <configuration>
      <check>
        <!-- Per-class thresholds -->
        <lineRate>80</lineRate>
        <branchRate>80</branchRate>
        <!-- Project-wide thresholds -->
        <totalLineRate>90</totalLineRate>
        <totalBranchRate>90</totalBranchRate>
      </check>
      <executions>
        <execution>
          <goals>
            <goal>clean</goal>
            <goal>check</goal>
          </goals>
        </execution>
        <execution>
          <id>coverage-tests</id>
          <!-- The "verify" phase occurs just before "install" -->
          <phase>verify</phase>
          <goals>
            <goal>clean</goal>
            <goal>check</goal>
          </goals>
        </execution>
      </executions>
      <instrumentation>
        <excludes>
      <exclude>au/**/*Constants.*</exclude>
        </excludes>
        <ignores>
      <ignore>au/**/*Constants.*</ignore>
        </ignores>
      </instrumentation>
    </configuration>
  </plugin>
  ...
</plugins>
...
</build> 
```

正如我所说，覆盖率报告工作正常，问题是如果线路或分支覆盖率低于我指定的阈值，“安装”目标不会失败。有没有人有这个工作，如果有，你的 POM 是什么样的，你使用的是哪个版本的 Cobertura 和 Maven？我正在使用 Maven 2.0.9 和 Cobertura 2.2。

我试过谷歌搜索和阅读 Cobertura 文档，但没有运气（至少可以说后者很少）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-10-24T15:06:37.870

据我所知，*如果`<haltOnFailure>`元素设置为 true 并且任何指定的检查失败，那么 Cobertura 将导致构建失败*，这正是您所要求的。但实际上，`true`如果您未指定此元素，则默认为，因此您**不必**将其添加到您的[配置检查](http://mojo.codehaus.org/cobertura-maven-plugin/usage.html#Check)中。低于任何覆盖率阈值的构建失败是（或至少应该是）默认行为。

**编辑：**我做了一些进一步的测试，`haltOnFailure`似乎在我的环境中按预期工作（Maven 2.2.1。和插件的 2.3、2.2、2.1 版本，即 Linux 上 cobertura 的 1.9.2、1.9、1.8 版本）。我正在用下面的结果更新这个答案。

实际上，我已经`<execution>`在我的 pom.xml 中添加了一个元素。我可能误解了[cobertura:check](http://mojo.codehaus.org/cobertura-maven-plugin/check-mojo.html)的文档中说“*默认绑定到生命周期阶段：`verify`* ”的部分，但是，如果没有该`<execution>`元素，[cobertura:check在我的构建的](http://mojo.codehaus.org/cobertura-maven-plugin/check-mojo.html)*验证*阶段没有被触发。在我用于 cobertura-maven-plugin 的设置下方：

```
<project>
  ...
  <build>
    ...
    <plugins>
      ...
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>cobertura-maven-plugin</artifactId>
        <version>2.3</version>
        <configuration>
          <check>
            <!--<haltOnFailure>true</haltOnFailure>--><!-- optional -->
            <!-- Per-class thresholds -->
            <lineRate>80</lineRate>
            <branchRate>80</branchRate>
            <!-- Project-wide thresholds -->
            <totalLineRate>90</totalLineRate>
            <totalBranchRate>90</totalBranchRate>
          </check>
        </configuration>
        <executions>
          <execution>
            <phase>verify</phase>
            <goals>
              <!--<goal>clean</goal>--><!-- works if uncommented -->
              <goal>check</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project> 
```

在使用上述插件配置修补`mvn clean install`的新生成的 maven 项目（带有 ）上运行时，我得到以下结果：`mvn archetype:create`

```
$ mvn archetype:create -DgroupId=com.mycompany.samples -DartifactId=cobertura-haltonfailure-testcase
...
$ mvn clean install
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building cobertura-haltonfailure-testcase
[INFO]    task-segment: [clean, install]
[INFO] ------------------------------------------------------------------------
[INFO] [clean:clean {execution: default-clean}]
[INFO] Deleting directory /home/pascal/Projects/cobertura-haltonfailure-testcase/target
[INFO] [resources:resources {execution: default-resources}]
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /home/pascal/Projects/cobertura-haltonfailure-testcase/src/main/resources
[INFO] [compiler:compile {execution: default-compile}]
[INFO] Compiling 1 source file to /home/pascal/Projects/cobertura-haltonfailure-testcase/target/classes
[INFO] [resources:testResources {execution: default-testResources}]
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /home/pascal/Projects/cobertura-haltonfailure-testcase/src/test/resources
[INFO] [compiler:testCompile {execution: default-testCompile}]
[INFO] Compiling 1 source file to /home/pascal/Projects/cobertura-haltonfailure-testcase/target/test-classes
[INFO] [surefire:test {execution: default-test}]
[INFO] Surefire report directory: /home/pascal/Projects/cobertura-haltonfailure-testcase/target/surefire-reports

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running com.mycompany.samples.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.09 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] [jar:jar {execution: default-jar}]
[INFO] Building jar: /home/pascal/Projects/cobertura-haltonfailure-testcase/target/cobertura-haltonfailure-testcase-1.0-SNAPSHOT.jar
[INFO] Preparing cobertura:check
[WARNING] Removing: check from forked lifecycle, to prevent recursive invocation.
[INFO] [resources:resources {execution: default-resources}]
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /home/pascal/Projects/cobertura-haltonfailure-testcase/src/main/resources
[INFO] [compiler:compile {execution: default-compile}]
[INFO] Nothing to compile - all classes are up to date
[INFO] [cobertura:instrument {execution: default}]
[INFO] Cobertura 1.9.2 - GNU GPL License (NO WARRANTY) - See COPYRIGHT file
Instrumenting 1 file to /home/pascal/Projects/cobertura-haltonfailure-testcase/target/generated-classes/cobertura
Cobertura: Saved information on 1 classes.
Instrument time: 337ms

[INFO] Instrumentation was successful.
[INFO] [resources:testResources {execution: default-testResources}]
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /home/pascal/Projects/cobertura-haltonfailure-testcase/src/test/resources
[INFO] [compiler:testCompile {execution: default-testCompile}]
[INFO] Nothing to compile - all classes are up to date
[INFO] [surefire:test {execution: default-test}]
[INFO] Surefire report directory: /home/pascal/Projects/cobertura-haltonfailure-testcase/target/surefire-reports

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running com.mycompany.samples.AppTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.098 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] [cobertura:check {execution: default}]
[INFO] Cobertura 1.9.2 - GNU GPL License (NO WARRANTY) - See COPYRIGHT file
Cobertura: Loaded information on 1 classes.

[ERROR] com.mycompany.samples.App failed check. Line coverage rate of 0.0% is below 80.0%
Project failed check. Total line coverage rate of 0.0% is below 90.0%

[INFO] ------------------------------------------------------------------------
[ERROR] BUILD ERROR
[INFO] ------------------------------------------------------------------------
[INFO] Coverage check failed. See messages above.
[INFO] ------------------------------------------------------------------------
[INFO] For more information, run Maven with the -e switch
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 18 seconds
[INFO] Finished at: Sat Oct 24 21:00:39 CEST 2009
[INFO] Final Memory: 17M/70M
[INFO] ------------------------------------------------------------------------
$ 
```

我没有使用 maven 2.0.9 进行测试，但是在我的机器上，`haltOnFailure`生成了 BUILD ERROR 并停止了构建。我看不出与您的插件配置有任何区别，我无法重现您描述的行为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T08:31:11.977

将以下内容添加到 <check/> 配置中。

```
<haltOnFailure>真</haltOnFailure>

```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2018-07-03T12:49:34.870

mvn clean install -Dcobertura.skip=true

# hash - 哈希与数字 id

> ID：196726
> 
> 赞同：9
> 
> 时间：2008-10-13T04:38:47.030
> 
> 标签：hash, web-applications

当创建一个 Web 应用程序以某种方式显示重复实体的唯一标识符（YouTube 上的视频，或像我这样的网站上的书籍部分）时，最好使用统一长度标识符，如哈希或唯一标识符数据库中项目的键（1、2、3 等）。

除了透露一些我认为无关紧要的关于你的应用程序内部的信息之外，为什么使用哈希比只使用唯一 ID 更好？

简而言之：**哪个更适合用作公开显示的唯一标识符 - 哈希值或数据库中的唯一键？**

**编辑**：我再次提出这个问题，因为 Dmitriy 提出了不将命名绑定到 db 特定属性的好处。这种束缚会阻止我将来优化​​/规范化数据库吗？

该平台使用 php/python 和 ISAM /w MySQL。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-06-12T19:11:55.673

除非您试图隐藏内部对象 ID 计数器的状态，否则散列会不必要地缓慢（生成和比较）、不必要的长、不必要的丑陋以及不必要的碰撞能力。GUID 又长又丑，使得它们和哈希一样不适合人类消费。

对于类似库存的东西，只需使用顺序（或分片）计数器。如果您迁移到不同的数据库，您只需将新计数器初始化为至少与现有最大记录 ID 一样大的值。几乎每个数据库服务器都为您提供了执行此操作的方法。

如果您*试图*隐藏计数器的状态，可能是因为您正在计算用户并且不希望竞争对手知道您有多少，我建议避免显示您的内部 ID。如果您坚持显示它们并且不想要散列的缺点，您可以考虑使用最大周期[线性反馈移位寄存器](http://en.wikipedia.org/wiki/LFSR)来生成 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T04:44:05.600

如果我不希望用户能够猜测系列中的下一个 ID，我通常会使用哈希。但是对于您的书籍部分，我会坚持使用数字 ID。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T05:24:07.547

如果由于某种原因需要重建数据库，例如排序发生变化，则最好使用散列。序数会移动——但哈希值会保持不变。

不依赖于你把东西放进盒子里的顺序，而是依赖于东西的属性，看起来……更安全。

但显然要小心碰撞。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-23T05:19:03.723

用哈希你

1.  如有必要，可以自由地将数据库与类似的（或备份）合并
2.  没有做一些可以帮助一些猜测攻击的事情
3.  没有透露更多关于用户的私人信息而不是必要的，例如，如果有人在您当前的数据库登录中看到用户号 2，他们会得到他是老歌的信息。
4.  （前提是您使用长散列或 GUID）如果您被 YouTube 收购并且他们决定集成您的数据库，这将极大地帮助您自己。
5.  帮助自己，以防出现按 GUID 索引的搜索引擎。

请让我们知道过去 6 个月是否让您对这个问题有所了解...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T04:43:37.270

哈希不保证是唯一的，我相信也不保证是一致的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T05:07:08.457

您的用户是否必须记住/使用该值？还是您从安全 POV 中查看？

从安全的角度来看，这无关紧要——因为您不应该仅仅依靠人们不猜测他们不应该看到的东西的不同但有效的 ID 来阻止他们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T05:23:59.983

是的，我认为您不是在寻找哈希 - 您更有可能在寻找 Guid。如果您在 .Net 平台上，请尝试 System.Guid。

但是，不使用 Guid 的最重要原因是性能。对（长）字符串进行数据库连接和查找是非常不理想的。数字很​​快。所以，除非你真的需要它，否则不要这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-23T17:34:32.007

散列的优点是您可以在对数据库执行任何检查它们是否存在之前检查它们是否有效。这可以帮助您抵御使用随机散列的攻击，因为您不需要使用虚假查找来加重数据库的负担。

因此，如果您的哈希具有某种明确定义的格式，例如末尾有校验和，您可以检查它是否正确，而无需访问数据库。

# operating-system - 内核开发中使用的堆栈大小

> ID：196729
> 
> 赞同：9
> 
> 时间：2008-10-13T04:41:28.010
> 
> 标签：operating-system, stack, size, kernel, osdev

我正在开发一个操作系统，而不是编写内核，我正在设计内核。该操作系统针对 x86 架构，而我的目标是针对现代计算机。所需 RAM 的估计数量为 256Mb 或更多。

使每个线程的堆栈在系统上运行的合适大小是多少？我是否应该尝试以这样一种方式设计系统，即如果达到最大长度，堆栈可以自动扩展？

我想如果我没记错的话，RAM 中的一个页面是 4k 或 4096 字节，这对我来说似乎并不多。我绝对可以看到时间，尤其是在使用大量递归时，我希望一次在 RAM 中拥有超过 1000 个整数。现在，真正的解决方案是让程序通过使用`malloc`和管理自己的内存资源来做到这一点，但我真的很想知道用户对此的看法。

4k 是否足以容纳现代计算机程序的堆栈？堆栈应该比那个大吗？堆栈是否应该自动扩展以适应任何类型的大小？从实际开发人员的角度和安全的角度来看，我对此都很感兴趣。

4k对于堆栈来说太大了吗？考虑到正常的程序执行，特别是从 C++ 中的类的角度来看，我注意到好的源代码倾向于`malloc/new`在创建类时提供所需的数据，以最大限度地减少函数调用中抛出的数据。

我什至没有进入的是处理器高速缓存的大小。理想情况下，我认为堆栈将驻留在缓存中以加快速度，我不确定我是否需要实现这一点，或者处理器是否可以为我处理它。我只是打算使用常规无聊的旧 RAM 进行测试。我无法决定。有什么选择？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-13T05:10:57.840

堆栈大小取决于您的线程在做什么。我的建议：

*   在线程创建时将堆栈大小作为参数（不同的线程会做不同的事情，因此需要不同的堆栈大小）
*   为那些不想为指定堆栈大小而烦恼的人提供一个合理的默认值（4K 吸引了我的控制狂，因为它会导致堆栈挥霍，呃，很快得到信号）
*   考虑如何检测和处理堆栈溢出。检测可能很棘手。您可以将保护页（空的）放在堆栈的末尾，这通常会起作用。但是你依靠坏线程的行为不跳过那条护城河并开始污染超越的东西。一般来说，这不会发生......但是，这就是让真正棘手的错误变得艰难的原因。密封机制涉及破解您的编译器以生成堆栈检查代码。至于处理堆栈溢出，您将需要一个专用堆栈，在其上运行有问题的线程（或其守护天使，无论您决定是谁 - 毕竟您是操作系统设计者）将在其上运行。
*   我强烈建议您使用独特的模式标记堆栈的末端，这样当您的线程越过末端时（并且它们总是如此），您至少可以进行事后检查并看到某些东西确实从它的堆。一页 0xDEADBEEF 或类似的东西很方便。

顺便说一句，x86 页面大小通常为 4k，但并非必须如此。您可以选择 64k 甚至更大的尺寸。较大页面的通常原因是避免 TLB 未命中。同样，我会将其设为内核配置或运行时参数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-14T13:03:22.200

在 linux 内核源代码中搜索 KERNEL_STACK_SIZE，您会发现它非常依赖于体系结构 - PAGE_SIZE 或 2*PAGE_SIZE 等（以下只是一些结果 - 删除了许多中间输出）。

```
./arch/cris/include/asm/processor.h:
#define KERNEL_STACK_SIZE PAGE_SIZE

./arch/ia64/include/asm/ptrace.h:
# define KERNEL_STACK_SIZE_ORDER        3
# define KERNEL_STACK_SIZE_ORDER        2
# define KERNEL_STACK_SIZE_ORDER        1
# define KERNEL_STACK_SIZE_ORDER        0
#define IA64_STK_OFFSET         ((1 << KERNEL_STACK_SIZE_ORDER)*PAGE_SIZE)
#define KERNEL_STACK_SIZE       IA64_STK_OFFSET

./arch/ia64/include/asm/mca.h:
    u64 mca_stack[KERNEL_STACK_SIZE/8];
    u64 init_stack[KERNEL_STACK_SIZE/8];

./arch/ia64/include/asm/thread_info.h:
#define THREAD_SIZE         KERNEL_STACK_SIZE

./arch/ia64/include/asm/mca_asm.h:
#define MCA_PT_REGS_OFFSET      ALIGN16(KERNEL_STACK_SIZE-IA64_PT_REGS_SIZE)

./arch/parisc/include/asm/processor.h:
#define KERNEL_STACK_SIZE   (4*PAGE_SIZE)

./arch/xtensa/include/asm/ptrace.h:
#define KERNEL_STACK_SIZE (2 * PAGE_SIZE)

./arch/microblaze/include/asm/processor.h:
# define KERNEL_STACK_SIZE  0x2000 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T05:12:58.147

我会投入两分钱让球滚动：

*   我不确定“典型”堆栈大小是多少。我猜每个线程可能 8 KB，如果一个线程超过这个数量，就抛出一个异常。但是，根据[this](http://msdn.microsoft.com/en-us/library/ms686774(VS.85).aspx)，Windows 的默认保留堆栈大小为每个线程 1MB，但它不会一次全部提交（页面在需要时提交）。此外，您可以在编译时使用编译器指令为给定的 EXE 请求不同的堆栈大小。不确定 Linux 做了什么，但我看到了对 4 KB 堆栈的引用（尽管我认为这可以在编译内核时更改，我不确定默认堆栈大小是多少......）

*   这与第一点有关。您可能希望每个线程可以获得多少堆栈的固定限制。因此，您可能不希望每次线程超过其当前堆栈空间时自动分配更多堆栈空间，因为陷入无限递归的错误程序将耗尽所有可用内存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T06:18:23.880

如果您使用虚拟内存，您确实希望堆栈可增长。强制静态分配堆栈大小，就像在 Qthreads 和 Windows Fibers 这样的用户级线程中很常见，这是一团糟。使用困难，容易崩溃。所有现代操作系统都会动态地增长堆栈，我认为通常是通过在当前堆栈指针下方有一两个写保护的保护页。在那里写入然后告诉操作系统堆栈已低于其分配的空间，并且您在其下方分配一个新的保护页面并使被命中的页面可写。只要没有单个函数分配超过一页的数据，就可以正常工作。或者您可以使用两个或四个保护页来允许更大的堆栈帧。

如果您想要一种控制堆栈大小的方法，并且您的目标是一个真正受控且高效的环境，但不关心与 Linux 等风格相同的编程，请选择每次启动任务的单次执行模型检测到相关事件，运行完成，然后将任何持久数据存储在其任务数据结构中。这样，所有线程都可以共享一个堆栈。用于汽车控制和类似的许多超薄实时操作系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T05:10:09.823

为什么不让堆栈大小成为一个可配置的项目，或者与程序一起存储，或者在一个进程创建另一个进程时指定？

您可以通过多种方式进行配置。

有一条准则指出“0、1 或 n”，这意味着您应该允许对象的零、一个或任意数量（受其他约束，例如内存限制） - 这也适用于对象的大小。

# asp-classic - 从 VBScript 中的 HTTP_Host 变量中提取二级域的最佳方法

> ID：196730
> 
> 赞同：2
> 
> 时间：2008-10-13T04:42:11.253
> 
> 标签：asp-classic, vbscript

我只需要从 request.servervariables("HTTP_HOST") 中提取域的第二级部分，最好的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T05:00:05.100

```
If Len(strHostDomain) > 0 Then      
    aryDomain = Split(strHostDomain,".")

    If uBound(aryDomain) >= 1 Then
        str2ndLevel = aryDomain(uBound(aryDomain)-1)
        strTopLevel = aryDomain(uBound(aryDomain))          
        strDomainOnly = str2ndLevel & "." & strTopLevel
    End If
End If 
```

适用于我需要的东西，但它不处理 .co.uk 或其他具有顶级预期的两个部分的域。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T07:17:33.263

这可以通过正则表达式来解决。

由于`HTTP_HOST`服务器变量只能包含有效的主机名，我们不需要关心*验证*字符串，只需要找出它的结构。因此，正则表达式保持相当简单，但在更广泛的上下文中无法可靠地工作。

该结构`3.2.1`分别用于第三、第二和第一级（顶级）域。

顶级域可以有 2 个以上的字母（如`.com`或`.de`），或者从概念上讲是一个组合，如`.co.uk`. *从技术上讲*，这不再是 TLD，但我认为您对获得`co`许多英国主机名的二级域并不真正感兴趣。

所以我们有

*   可选：各种事物开头（子域），一个点=`^(.*?)\.?`
*   必填：中间一块（二级域），一个点=`(\w+)\.`
*   要求：末尾有一个短位（或两个短位）=`(\w{2,}(?:\.\w{2})?)$`

这三件事将被记录在第 1、2 和 3 组中。

```
Dim re, matches, match

Set re = New RegExp

re.Pattern = "^(.*?)\.?(\w+)\.(\w{2,}(?:\.\w{2})?)$"

Set matches = re.Execute( Request.ServerVariables("HTTP_HOST") )

If matches.Count = 1 Then
  Set match = matches(0)

  ' assuming "images.res.somedomain.co.uk"
  Response.Write match.SubMatches(0) & "<br>" ' will be "images.res"
  Response.Write match.SubMatches(1) & "<br>" ' will be "somedomain"
  Response.Write match.SubMatches(2) & "<br>" ' will be "co.uk"

  ' assuming  "somedomain.com"
  Response.Write match.SubMatches(0) & "<br>" ' will be ""
  Response.Write match.SubMatches(1) & "<br>" ' will be "somedomain"
  Response.Write match.SubMatches(2) & "<br>" ' will be "com"
Else
  ' You have an IP address in HTTP_HOST
End If 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T10:13:29.163

刚刚检查了我租用的服务器空间的子域的差异，http_host 和 server_name 都报告了包括子域在内的域名。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-16T01:48:50.023

由于 HTTP_HOST 标头仅返回域（不包括任何子域），您应该能够执行以下操作：

```
'example: sample.com
'example: sample.co.uk
host = split(request.serverVariables("HTTP_HOST"), ".")
host(0) = "" 'clear the "sample" part

extension = join(host, ".") 'put it back together, ".com" or ".co.uk" 
```

# perl - 如何有效地清空 Perl DBM 文件？

> ID：196732
> 
> 赞同：7
> 
> 时间：2008-10-13T04:42:33.967
> 
> 标签：perl, dbm

我继承了一段代码，其中包含一个清空数据库的代码片段，如下所示：

```
dbmopen (%db,"file.db",0666);
foreach $key (keys %db) {
  delete $db{$key};
}
dbmclose (%db); 
```

这通常没问题，但有时在调用此清理代码之前数据库会变得非常大，并且通常是在用户想要做一些重要的事情时。

有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-13T14:10:33.680

您可以只删除该文件：

```
unlink $file; 
```

由于[dbmopen](http://perldoc.perl.org/functions/dbmopen.html)的第三个参数是文件模式，而不是文件模式，`undef`因此`dbmopen`下次调用时将重新创建文件：

```
dbmopen my %db, $file, 0666; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T05:58:18.633

实际上，一位同事已向我指出了解决方案。你显然可以这样做：

```
dbmopen (%db,"file.db",0666);
%db = ();
dbmclose (%db); 
```

在关闭数据库之前清除散列。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-13T06:50:54.673

这里有另一个答案由于某种原因消失了，但它可能会更快，所以我重新发布它（不确定为什么它被删除）。它涉及取消链接文件以将其删除，然后仅重新创建一个空白数据库文件，如下所示：

```
unlink ("file.db");
dbmopen (%db,"file.db",0666);
dbmclose (%db); 
```

# c++ - 如何将协变返回类型与智能指针一起使用？

> ID：196733
> 
> 赞同：78
> 
> 时间：2008-10-13T04:42:58.380
> 
> 标签：c++, covariance, smart-pointers

我有这样的代码：

```
class RetInterface {...}

class Ret1: public RetInterface {...}

class AInterface
{
  public:
     virtual boost::shared_ptr<RetInterface> get_r() const = 0;
     ...
};

class A1: public AInterface
{
  public:
     boost::shared_ptr<Ret1> get_r() const {...}
     ...
}; 
```

**此代码无法编译。**

在视觉工作室它提出

> C2555：覆盖虚函数返回类型不同且不是协变的

如果我不使用`boost::shared_ptr`但返回原始指针，则代码编译（我理解这是由于 C++ 中的[协变返回类型](http://en.wikipedia.org/wiki/Parameter_covariance#C.2B.2B)）。我可以看到问题是因为不是从`boost::shared_ptr`of派生的。但是我想返回用于其他类，否则我必须在返回后转换返回值。 `Ret1``boost::shared_ptr``RetInterface``boost::shared_ptr``Ret1`

1.  难道我做错了什么？
2.  如果不是，为什么这种语言是这样的——在这种情况下处理智能指针之间的转换应该是可扩展的？是否有理想的解决方法？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-13T09:58:40.397

首先，这确实是它在 C++ 中的工作方式：派生类中的虚函数的返回类型必须与基类中的相同。有一个特殊的例外，返回某个类 X 的引用/指针的函数可以被一个返回指向从 X 派生的类的引用/指针的函数覆盖，但正如您所注意到的，这不允许*智能*指针（例如`shared_ptr`），仅用于普通指针。

如果你的接口`RetInterface`足够全面，那么你就不需要知道调用代码中实际返回的类型。一般来说，无论如何它都没有意义：原因首先`get_r`是一个`virtual`函数，因为您将通过指针或对基类的引用来调用它`AInterface`，在这种情况下，您不知道派生类会是什么类型返回。如果您使用实际`A1`引用调用它，您可以创建一个单独的`get_r1`函数来`A1`满足您的需要。

```
class A1: public AInterface
{
  public:
     boost::shared_ptr<RetInterface> get_r() const
     {
         return get_r1();
     }
     boost::shared_ptr<Ret1> get_r1() const {...}
     ...
}; 
```

或者，您可以使用访问者模式或类似我的[Dynamic Double Dispatch](http://www.ddj.com/dept/cpp/184429055)技术将回调传递给返回的对象，然后该对象可以调用具有正确类型的回调。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2019-06-11T11:24:38.420

[此博客文章](https://www.fluentcpp.com/2017/09/12/how-to-return-a-smart-pointer-and-use-covariance/)中发布了一个简洁的解决方案（来自 Raoul Borges）

在添加对多重继承和抽象方法的支持之前的一段摘录是：

```
template <typename Derived, typename Base>
class clone_inherit<Derived, Base> : public Base
{
public:
   std::unique_ptr<Derived> clone() const
   {
      return std::unique_ptr<Derived>(static_cast<Derived *>(this->clone_impl()));
   }

private:
   virtual clone_inherit * clone_impl() const override
   {
      return new Derived(*this);
   }
};

class concrete: public clone_inherit<concrete, cloneable>
{
};

int main()
{
   std::unique_ptr<concrete> c = std::make_unique<concrete>();
   std::unique_ptr<concrete> cc = c->clone();

   cloneable * p = c.get();
   std::unique_ptr<clonable> pp = p->clone();
} 
```

我鼓励阅读全文。它写得很简单，解释得很好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T04:49:45.013

在 C++ 中重载方法时，您不能更改返回类型（对于非指针、非引用返回类型）。 `A1::get_r`必须返回一个`boost::shared_ptr<RetInterface>`.

安东尼威廉姆斯有一个很好的综合[答案](https://stackoverflow.com/a/197157/25050)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-17T20:19:36.287

这个解决方案怎么样：

```
template<typename Derived, typename Base>
class SharedCovariant : public shared_ptr<Base>
{
public:

typedef Base BaseOf;

SharedCovariant(shared_ptr<Base> & container) :
    shared_ptr<Base>(container)
{
}

shared_ptr<Derived> operator ->()
{
    return boost::dynamic_pointer_cast<Derived>(*this);
}
}; 
```

例如：

```
struct A {};

struct B : A {};

struct Test
{
    shared_ptr<A> get() {return a_; }

    shared_ptr<A> a_;
};

typedef SharedCovariant<B,A> SharedBFromA;

struct TestDerived : Test
{
    SharedBFromA get() { return a_; }
}; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-11T17:27:38.367

这是我的尝试：

```
template<class T>
class Child : public T
{
public:
    typedef T Parent;
};

template<typename _T>
class has_parent
{
private:
    typedef char                        One;
    typedef struct { char array[2]; }   Two;

    template<typename _C>
    static One test(typename _C::Parent *);
    template<typename _C>
    static Two test(...);

public:
    enum { value = (sizeof(test<_T>(nullptr)) == sizeof(One)) };
};

class A
{
public :
   virtual void print() = 0;
};

class B : public Child<A>
{
public:
   void print() override
   {
       printf("toto \n");
   }
};

template<class T, bool hasParent = has_parent<T>::value>
class ICovariantSharedPtr;

template<class T>
class ICovariantSharedPtr<T, true> : public ICovariantSharedPtr<typename T::Parent>
{
public:
   T * get() override = 0;
};

template<class T>
class ICovariantSharedPtr<T, false>
{
public:
    virtual T * get() = 0;
};

template<class T>
class CovariantSharedPtr : public ICovariantSharedPtr<T>
{
public:
    CovariantSharedPtr(){}

    CovariantSharedPtr(std::shared_ptr<T> a_ptr) : m_ptr(std::move(a_ptr)){}

    T * get() final
   {
        return m_ptr.get();
   }
private:
    std::shared_ptr<T> m_ptr;
}; 
```

还有一个小例子：

```
class UseA
{
public:
    virtual ICovariantSharedPtr<A> & GetPtr() = 0;
};

class UseB : public UseA
{
public:
    CovariantSharedPtr<B> & GetPtr() final
    {
        return m_ptrB;
    }
private:
    CovariantSharedPtr<B> m_ptrB = std::make_shared<B>();
};

int _tmain(int argc, _TCHAR* argv[])
{
    UseB b;
    UseA & a = b;
    a.GetPtr().get()->print();
} 
```

说明：

该解决方案意味着元编程和修改协变智能指针中使用的类。

简单的模板结构`Child`在这里绑定类型`Parent`和继承。任何继承自的类`Child<T>`都将继承自`T`并定义`T`为`Parent`. 协变智能指针中使用的类需要定义这种类型。

该类`has_parent`用于在编译时检测一个类是否定义了类型`Parent`。这部分不是我的，我使用了与检测方法是否存在相同的代码（[请参见此处](https://stackoverflow.com/questions/257288/is-it-possible-to-write-a-c-template-to-check-for-a-functions-existence)）

由于我们想要与智能指针的协变，我们希望我们的智能指针模仿现有的类架构。在示例中更容易解释它是如何工作的。

当 a`CovariantSharedPtr<B>`被定义时，它继承自`ICovariantSharedPtr<B>`，它被解释为`ICovariantSharedPtr<B, has_parent<B>::value>`。As`B`继承自`Child<A>`,`has_parent<B>::value`是真的，所以`ICovariantSharedPtr<B>`is`ICovariantSharedPtr<B, true>`并且继承自`ICovariantSharedPtr<B::Parent>`which is `ICovariantSharedPtr<A>`。As`A`没有`Parent`定义，`has_parent<A>::value`是假的，`ICovariantSharedPtr<A>`是`ICovariantSharedPtr<A, false>`并且从无继承。

重点是作为`B`继承自`A`，我们有`ICovariantSharedPtr<B>`继承自`ICovariantSharedPtr<A>`。因此，任何返回指针或引用 on`ICovariantSharedPtr<A>`的方法都可以被返回相同 on 的方法重载`ICovariantSharedPtr<B>`。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-13T05:00:11.043

[福兹先生](https://stackoverflow.com/questions/196733/smart-pointer-and-virtual#196744)回答了您问题的第 1 部分。第 2 部分，它以这种方式工作，因为编译器不知道它是否会在编译时调用 AInterface::get_r 或 A1::get_r - 它需要知道它将获得什么返回值，因此它坚持使用这两种方法返回相同的类型。这是 C++ 规范的一部分。

对于解决方法，如果 A1::get_r 返回一个指向 RetInterface 的指针，则 RetInterface 中的虚拟方法仍将按预期工作，并且在销毁指针时将删除正确的对象。不需要不同的返回类型。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-06-09T13:26:04.450

也许您可以使用 out 参数来解决“与返回的 boost shared_ptrs 的协方差。

```
 void get_r_to(boost::shared_ptr<RetInterface>& ) ... 
```

因为我怀疑调用者可以使用更精致的 shared_ptr 类型作为参数。

# php - 为什么不在 PHP 中使用“受保护”或“私有”？

> ID：196737
> 
> 赞同：7
> 
> 时间：2008-10-13T04:44:51.310
> 
> 标签：php, encapsulation

我一直在使用 Joomla 框架，我注意到他们使用约定来指定私有或受保护的方法（他们`_`在方法名称前加上下划线“”），但他们没有明确声明任何方法`public`，`private`或`protected`. 为什么是这样？跟便携有关系吗？旧版本的 PHP 中是否不提供、`public`或`private`关键字？`protected`

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-13T04:46:06.360

public、private 和 protected 是 PHP5 关键字。不幸的是，PHP4 的安装基数仍然很高（尤其是在共享托管服务中）。

这是一张[漂亮的图片](http://www.nexen.net/images/stories/phpversion/200807/evolution.milieu.png)，显示了 7 月的使用率（法文文本）。**剧透**：遗憾的是，php4 的使用率仍然超过 35%。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-28T23:32:37.297

在这里不使用`private`方法和属性有一些很好的论据：http: [//aperiplus.sourceforge.net/visibility.php](http://aperiplus.sourceforge.net/visibility.php)

包括：使编码和阅读代码更加困难。使重用类和调试更加困难。

无论哪种方式，我都没有被出售，但我希望看到对该文章的知情反驳，如果存在的话。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T20:31:25.063

PHP5 在对象模型中引入了一些重大变化。在支持可见性中，还有其他各种变化。请务必检查：

[PHP 4 类和对象](http://www.php.net/manual/en/language.oop.php)

[PHP 5 类和对象](http://www.php.net/manual/en/language.oop5.php)

# asp.net - 如何在 Visual Studio 中添加 NUnit

> ID：196740
> 
> 赞同：6
> 
> 时间：2008-10-13T04:46:06.643
> 
> 标签：asp.net, visual-studio, nunit

我需要为我的应用程序编写测试用例。我选择了 NUnit。请让我知道如何将 NUnit 添加到我的 Visual Studio IDE。我在哪里可以下载它们？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T04:59:04.510

最好的起点可能是：[http ://testdriven.net/](http://testdriven.net/)

他们有 NUnit 和许多其他可以与各种版本的 Visual Studio 集成的单元测试套件，以及关于它们的一些文档。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-13T06:08:06.257

你的问题有点模棱两可。。

*   您是否有兴趣学习 nunit（在这种情况下，nunit.org 将是与一些关于 TDD/UnitTesting 的书籍一起查看的地方）
*   如果您尝试将 nunit 与 VisualStudio IDE 集成，我将使用[此处](http://www.dev102.com/2008/03/22/3-ways-to-run-nunit-from-visual-studio/)列为 Option#1或 TestDriven.net Option#2的外部可执行方法

# arrays - 你如何在“D”中切片数组？

> ID：196741
> 
> 赞同：2
> 
> 时间：2008-10-13T04:46:41.447
> 
> 标签：arrays, d

如何在“D”中操作数组？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-13T04:54:31.117

[在这里](http://www.digitalmars.com/d/2.0/arrays.html)您可以找到 D 中数组操作的完整参考。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T05:45:48.597

要对数组进行切片，只需使用

```
int[7] a;
int[] b;
b = a[5..7]; 
```

它将 b[0] 设置为 a[5] 并将 b[1] 设置为 a[6]。但请记住，这是对 a 中元素的引用，*而不是*它们的另一个副本。如果您更改 b[0]，这也会影响 a[5]。

如果你想复制，你必须这样做：

```
int[7] a;
int[2] b;
b[0..1] = a[5..7]; 
```

这是因为 b 是一个静态数组；在第一个代码块中，它是动态的（实际上是指向另一个数组中某处的指针）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-06T15:40:23.333

供参考。您还可以使用以下方式复制：

```
int[7] a;
int[] b;
b = a[5..7].dup; 
```

# perl - “select((select(s),$|=1)[0])” 在 Perl 中做了什么？

> ID：196754
> 
> 赞同：35
> 
> 时间：2008-10-13T05:00:53.507
> 
> 标签：perl, select, buffering

我见过一些用 Perl 编写的可怕代码，但我无法理解这个代码：

```
select((select(s),$|=1)[0]) 
```

它在我们用来与服务器通信的一些网络代码中，我认为它与缓冲有关（因为它设置了`$|`）。

但我无法弄清楚为什么会有多个`select`调用或数组引用。谁能帮我吗？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-10-13T05:14:43.260

在 STDOUT 以外的文件句柄上设置 autoflush 是一个讨厌的小习惯。

`select()`获取提供的文件句柄并（基本上）用它替换 STDOUT，并在完成后返回旧的文件句柄。

所以`(select($s),$|=1)`重定向文件句柄（记住`select`返回旧的），并设置自动刷新（`$| = 1`）。它在列表 ( `(...)[0]`) 中执行此操作并返回第一个值（这是`select`调用的结果 - 原始 STDOUT），然后将其传递*回*另一个`select`以恢复原始 STDOUT 文件句柄。呸。

但现在你明白了（好吧，也许；）），改为这样做：

```
use IO::Handle;
$fh->autoflush; 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-13T14:08:51.623

找出任何代码的方法是将其分开。你知道括号内的东西在外面的东西之前发生。这与您弄清楚其他语言中的代码在做什么的方式相同。

那么第一位是：

```
( select(s), $|=1 ) 
```

该列表有两个元素，它们是两个操作的结果：一个选择`s`文件句柄作为默认值，然后一个设置`$|`为真值。这`$|`是每个文件句柄变量之一，仅适用于当前选定的文件句柄（请参阅*The Effective Perler*中的[了解全局变量](http://www.effectiveperlprogramming.com/2010/09/understand-global-variables/)）。最后，您有一个包含两项的列表：先前的默认文件句柄（的结果）和 1。*`select`*

 *下一部分是一个文字列表切片，用于提取索引 0 中的项目：

```
( PREVIOUS_DEFAULT, 1 )[0] 
```

其结果是作为先前默认文件句柄的单个项目。

下一部分获取切片的结果并将其用作另一个调用的参数`select`

```
 select( PREVIOUS_DEFAULT ); 
```

因此，实际上，您已经设置`$|`了文件句柄并最终回到了使用默认文件句柄开始的位置。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-02-18T09:39:19.777

```
select($fh) 
```

选择一个新的默认文件句柄。请参阅[http://perldoc.perl.org/functions/select.html](http://perldoc.perl.org/functions/select.html)

```
(select($fh), $|=1) 
```

打开自动冲洗。请参阅[http://perldoc.perl.org/perlvar.html](http://perldoc.perl.org/perlvar.html)

```
(select($fh), $|=1)[0] 
```

返回此元组的第一个值。

```
select((select($fh), $|=1)[0]) 
```

`select`它，即恢复旧的默认文件句柄。

* * *

相当于

```
$oldfh = select($fh);
$| = 1;
select($oldfh); 
```

意思是

```
use IO::Handle;
$fh->autoflush(1); 
```

如 perldoc 页面所示。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-14T05:38:23.197

在另一个场合，我曾经提出一个更易于理解的版本是这样的：

```
for ( select $fh ) { $| = 1; select $_ } 
```

这保留了紧凑习语的唯一优势，即不需要在周围范围内声明变量。

或者如果你不习惯`$_`，你可以这样写：

```
for my $prevfh ( select $fh ) { $| = 1; select $prevfh } 
```

的范围`$prevfh`仅限于`for`块。（但如果你编写 Perl，你真的没有理由对 . 感到不安`$_`。）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-13T05:14:57.113

在句柄上打开缓冲区刷新`s`然后重新选择当前句柄是非常聪明的代码。

查看`perldoc -f select`更多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-02-18T09:35:06.370

请检查[perldoc -f select](http://perldoc.perl.org/functions/select.html)。的含义`$|`，请查看[perldoc perlvar](http://perldoc.perl.org/perlvar.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-18T09:52:15.087

跳过加载 IO::Handle 是过度优化。

```
use IO::Handle;
$fh->autoflush(1); 
```

更具可读性。

# python - 如何从脚本中搜索 Stack Overflow 问题？

> ID：196755
> 
> 赞同：5
> 
> 时间：2008-10-13T05:03:47.073
> 
> 标签：python, search, scripting, stackexchange-api

给定一串关键字，例如“Python 最佳实践”，我想从 Python 脚本中获取包含该关键字的前 10 个 Stack Overflow 问题，按相关性 (?) 排序。我的目标是最终得到一个元组列表（标题、URL）。

我怎样才能做到这一点？您会考虑改为查询 Google 吗？（你将如何从 Python 中做到这一点？）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T06:33:02.307

```
>>> from urllib import urlencode
>>> params = urlencode({'q': 'python best practices', 'sort': 'relevance'})
>>> params
'q=python+best+practices&sort=relevance'
>>> from urllib2 import urlopen
>>> html = urlopen("http://stackoverflow.com/search?%s" % params).read()
>>> import re
>>> links = re.findall(r'<h3><a href="([^"]*)" class="answer-title">([^<]*)</a></h3>', html)
>>> links
[('/questions/5119/what-are-the-best-rss-feeds-for-programmersdevelopers#5150', 'What are the best RSS feeds for programmers/developers?'), ('/questions/3088/best-ways-to-teach-a-beginner-to-program#13185', 'Best ways to teach a beginner to program?'), ('/questions/13678/textual-versus-graphical-programming-languages#13886', 'Textual versus Graphical Programming Languages'), ('/questions/58968/what-defines-pythonian-or-pythonic#59877', 'What defines &#8220;pythonian&#8221; or &#8220;pythonic&#8221;?'), ('/questions/592/cxoracle-how-do-i-access-oracle-from-python#62392', 'cx_Oracle - How do I access Oracle from Python? '), ('/questions/7170/recommendation-for-straight-forward-python-frameworks#83608', 'Recommendation for straight-forward python frameworks'), ('/questions/100732/why-is-if-not-someobj-better-than-if-someobj-none-in-python#100903', 'Why is if not someobj: better than if someobj == None: in Python?'), ('/questions/132734/presentations-on-switching-from-perl-to-python#134006', 'Presentations on switching from Perl to Python'), ('/questions/136977/after-c-python-or-java#138442', 'After C++ - Python or Java?')]
>>> from urlparse import urljoin
>>> links = [(urljoin('http://stackoverflow.com/', url), title) for url,title in links]
>>> links
[('http://stackoverflow.com/questions/5119/what-are-the-best-rss-feeds-for-programmersdevelopers#5150', 'What are the best RSS feeds for programmers/developers?'), ('http://stackoverflow.com/questions/3088/best-ways-to-teach-a-beginner-to-program#13185', 'Best ways to teach a beginner to program?'), ('http://stackoverflow.com/questions/13678/textual-versus-graphical-programming-languages#13886', 'Textual versus Graphical Programming Languages'), ('http://stackoverflow.com/questions/58968/what-defines-pythonian-or-pythonic#59877', 'What defines &#8220;pythonian&#8221; or &#8220;pythonic&#8221;?'), ('http://stackoverflow.com/questions/592/cxoracle-how-do-i-access-oracle-from-python#62392', 'cx_Oracle - How do I access Oracle from Python? '), ('http://stackoverflow.com/questions/7170/recommendation-for-straight-forward-python-frameworks#83608', 'Recommendation for straight-forward python frameworks'), ('http://stackoverflow.com/questions/100732/why-is-if-not-someobj-better-than-if-someobj-none-in-python#100903', 'Why is if not someobj: better than if someobj == None: in Python?'), ('http://stackoverflow.com/questions/132734/presentations-on-switching-from-perl-to-python#134006', 'Presentations on switching from Perl to Python'), ('http://stackoverflow.com/questions/136977/after-c-python-or-java#138442', 'After C++ - Python or Java?')] 
```

将其转换为函数应该是微不足道的。

**编辑**：哎呀，我会做的......

```
def get_stackoverflow(query):
    import urllib, urllib2, re, urlparse
    params = urllib.urlencode({'q': query, 'sort': 'relevance'})
    html = urllib2.urlopen("http://stackoverflow.com/search?%s" % params).read()
    links = re.findall(r'<h3><a href="([^"]*)" class="answer-title">([^<]*)</a></h3>', html)
    links = [(urlparse.urljoin('http://stackoverflow.com/', url), title) for url,title in links]

    return links 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-13T05:11:39.133

由于 Stackoverflow 已经有了这个功能，您只需要获取搜索结果页面的内容并抓取您需要的信息。以下是按相关性搜索的 URL：

> [https://stackoverflow.com/search?q=python+best+practices&sort=relevance](https://stackoverflow.com/search?q=python+best+practices&sort=relevance)

如果您查看源代码，您会看到每个问题所需的信息都在这样的一行中：

```
<h3><a href="/questions/5119/what-are-the-best-rss-feeds-for-programmersdevelopers#5150" class="answer-title">What are the best RSS feeds for programmers/developers?</a></h3> 
```

因此，您应该能够通过正则表达式搜索该形式的字符串来获得前十个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T05:28:47.460

建议将 REST API 添加到 SO。[http://stackoverflow.uservoice.com/](https://web.archive.org/web/20090219112537/http://stackoverflow.uservoice.com:80/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T05:09:04.007

您可以从有效的 HTTP 请求中筛选返回的 HTML。但这会导致恶业，并失去享受良好睡眠的能力。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T05:46:01.637

我只会使用 Pycurl 将搜索词连接到查询 uri 上。

# php - 在 PHP 中转义 Python 字符串的最佳方法是什么？

> ID：196771
> 
> 赞同：2
> 
> 时间：2008-10-13T05:20:56.667
> 
> 标签：php, python, user-input

我有一个 PHP 应用程序需要输出一个 python 脚本，更具体地说是一堆变量赋值语句，例如。

```
subject_prefix = 'This String From User Input'
msg_footer = """This one too.""" 
```

需要编写subject_prefix等内容以接受用户输入；因此，我需要转义字符串的内容。编写如下内容不会减少它；一旦有人使用引号或换行符或我不知道可能有危险的任何其他内容，我们就会被塞满：

```
echo "subject_prefix = '".$subject_prefix."'\n"; 
```

所以。有任何想法吗？

（由于时间限制，无法用 Python 重写应用程序。：P）

**多年后编辑：**

这是为了在 web 应用程序（用 PHP 编写）和 Mailman（用 Python 编写）之间进行集成。我无法修改后者的安装，所以我需要想出一种方法来用它的语言来管理它的配置。

这也是一个*非常*糟糕的主意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T07:58:38.000

**不要**尝试在 PHP 中编写此函数。您将不可避免地出错，您的应用程序将不可避免地具有任意远程执行漏洞。

首先，考虑您实际解决的是什么问题。我想你只是想从 PHP 到 Python 获取数据。您可能会尝试编写 .ini 文件而不是 .py 文件。Python 有一个出色的 ini 语法解析器[ConfigParser](http://www.python.org/doc/2.5.2/lib/module-ConfigParser.html)。您可以在 PHP 中编写明显且可能不正确的引用函数，如果（阅读：何时）您弄错了，不会发生任何严重的事情。

您还可以编写一个 XML 文件。PHP 和 Python 的 XML 解析器和发射器太多了，我什至无法在此处列出。

如果我**真的**不能让你相信这是一个*糟糕的、糟糕*的想法，那么你至少可以使用 Python 已有的功能来做这样的事情：`repr()`.

这是一个方便的 PHP 函数，它将运行 Python 脚本为您执行此操作：

```
<?php

function py_escape($input) {
    $descriptorspec = array(
        0 => array("pipe", "r"),
        1 => array("pipe", "w")
        );
    $process = proc_open(
        "python -c 'import sys; sys.stdout.write(repr(sys.stdin.read()))'",
        $descriptorspec, $pipes);
    fwrite($pipes[0], $input);
    fclose($pipes[0]);
    $chunk_size = 8192;
    $escaped = fread($pipes[1], $chunk_size);
    if (strlen($escaped) == $chunk_size) {
        // This is important for security.
        die("That string's too big.\n");
    }
    proc_close($process);
    return $escaped;
}

// Example usage:
$x = "string \rfull \nof\t crappy stuff";
print py_escape($x); 
```

该`chunk_size`检查旨在防止攻击导致您的输入最终成为两个非常长的字符串，它们分别看起来像`("hello " + ("." * chunk_size))`和`'; os.system("do bad stuff")`。现在，这种天真的攻击不会完全起作用，因为 Python 不会让单引号字符串在行的中间结束，并且`system()`调用中的那些引号本身也会被引用，但是如果攻击者设法得到一行延续（“\”）到正确的位置并使用类似的东西，`os.system(map(chr, ...))`然后他们可以注入一些将运行的代码。

我选择简单地读取一个块，如果有更多的输出就放弃，而不是继续读取和累积，因为 Python 源文件行长度也有限制；据我所知，这可能是另一个攻击媒介。Python 并非旨在防止任意人在您的系统上编写任意源代码，因此该领域不太可能被审计。

我不得不为这个简单的例子考虑所有这些，这只是另一个例子，说明为什么不应该使用 python 源代码作为数据交换格式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T05:34:47.090

我将从标准化我在 python 中使用的字符串类型开始，以使用三引号字符串 (""")。这应该可以减少输入中的杂散引号引起的问题事件。您仍然需要将其转义为当然，但它应该减少令人担忧的问题的数量。

我为逃避字符串所做的工作在一定程度上取决于我担心被滑入的内容，以及它们再次被打印出来的上下文。如果你只是担心引起问题的引号，你可以简单地检查和出现“””并转义它们。另一方面，如果我担心输入本身是恶意的（而且它是用户输入，所以你可能应该)，然后我会查看诸如 strip_tags() 或其他类似函数之类的选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T07:57:21.467

另一种选择可能是将数据导出为数组或对象为 JSON 字符串，并稍微修改 python 代码以处理新输入。虽然通过 JSON 转义不是 100% 防弹的，但它仍然比自己的转义例程更好。

如果 JSON 字符串格式错误，您将能够处理错误。

有一个 Python 包可以对 JSON 进行编码和解码：[python-json 3.4](http://pypi.python.org/pypi/python-json/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-28T18:47:35.033

我需要对此进行编码以转义“ntriples”格式的字符串，该格式使用[python escaping](http://docs.python.org/reference/lexical_analysis.html#string-literals)。

以下函数采用 utf-8 字符串并将其转义为 python（或 ntriples 格式）返回。如果给出非法的 utf-8 数据，它可能会做一些奇怪的事情。它不了解 xFFFF 之后的 Unicode 字符。它（当前）不将字符串用双引号括起来。

uniord 函数来自 php.net 上的评论。

```
function python_string_escape( $string ) {
    $string = preg_replace( "/\\\\/", "\\\\", $string ); # \\ (first to avoid string re-escaping)
    $string = preg_replace( "/\n/", "\\n", $string ); # \n
    $string = preg_replace( "/\r/", "\\r", $string ); # \r 
    $string = preg_replace( "/\t/", "\\t", $string ); # \t 
    $string = preg_replace( "/\"/", "\\\"", $string ); # \"
    $string = preg_replace( "/([\x{00}-\x{1F}]|[\x{7F}-\x{FFFF}])/ue",
                            "sprintf(\"\\u%04X\",uniord(\"$1\"))",
                            $string );
    return $string;
}

function uniord($c) {
    $h = ord($c{0});
    if ($h <= 0x7F) {
        return $h;
    } else if ($h < 0xC2) {
        return false;
    } else if ($h <= 0xDF) {
        return ($h & 0x1F) << 6 | (ord($c{1}) & 0x3F);
    } else if ($h <= 0xEF) {
        return ($h & 0x0F) << 12 | (ord($c{1}) & 0x3F) << 6 | (ord($c{2}) & 0x3F);
    } else if ($h <= 0xF4) {
        return ($h & 0x0F) << 18 | (ord($c{1}) & 0x3F) << 12 | (ord($c{2}) & 0x3F) << 6 | (ord($c{3}) & 0x3F);
    } else {
        return false;
    }
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-13T05:30:00.610

我建议编写一个带有两个参数的函数：要转义的文本和字符串所在的引号类型。然后，例如，如果引号的类型是单引号，则该函数将转义字符串中的单引号以及任何其他需要转义的字符（反斜杠？）。

```
function escape_string($text, $type) {
    // Escape backslashes for all types of strings?
    $text = str_replace('\\', '\\\\', $text);

    switch($type) {
        case 'single':
            $text = str_replace("'", "\\'", $text);
            break;
        case 'double':
            $text = str_replace('"', '\\"', $text);
            break;
        // etc...
    }

    return $text;
} 
```

我假设对于单引号字符串，您想要转义单引号，而对于双引号字符串，您想要转义双引号......

# python - 在 Ruby/Python 中使用哪个 AES 库？

> ID：196776
> 
> 赞同：2
> 
> 时间：2008-10-13T05:25:29.963
> 
> 标签：python, ruby, encryption, aes

我需要能够在 Ruby 客户端和 Python 服务器之间发送加密数据（反之亦然），并且在使用[ruby​​-aes](http://rubyforge.org/projects/ruby-aes) gem/library 时遇到了问题。该库非常易于使用，但我们在它和 Python 的 pyCrypto AES 库之间传递数据时遇到了麻烦。当这些库是唯一被使用的库时，它们似乎很好，但它们似乎不能很好地跨越语言边界。有任何想法吗？

编辑：我们正在通过 SOAP 进行通信，并且还尝试将二进制数据转换为 base64 无济于事。此外，更重要的是两者之间的加密/解密几乎但不完全相同（例如，长度相差一或解密字符串末尾有额外的垃圾字符）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T13:12:42.890

> （例如，长度相差一或解密字符串末尾有多余的垃圾字符）

我错过了那一点。您的加密/解密没有问题。这听起来像一个填充问题。AES 始终以 128 位块的形式对数据进行编码。如果您的数据长度不是 128 位的倍数，则应在加密之前填充数据，并且在加密后需要删除/忽略填充。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T07:17:02.110

原来发生的事情是 ruby​​-aes 自动填充数据以填充 16 个字符，并在最终字符串的末尾粘贴一个空字符作为分隔符。PyCrypto 要求你做 16 个字符的倍数，这就是我们弄清楚 ruby​​-aes 在做什么的方式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T07:05:19.963

如果没有更多信息，甚至很难猜测发生了什么......

如果我是你，我会在你的 Python 和 Ruby 程序中检查：

1.  键是相同的（显然）。将它们转储为十六进制并比较每个字节。
2.  初始化向量是相同的。这是pyCrypto`IV`中的参数。`AES.new()`也将它们转储为十六进制。
3.  模式是一样的。pyCrypto 中`mode`的参数。`AES.new()`

`IV`pyCrypto 中的and有默认值`mode`，但不要相信它们与 Ruby 实现中的相同。使用一种更简单的模式，例如 CBC。我发现不同的库对复杂模式（例如 PTR）的工作方式有不同的解释。

维基百科有一篇关于如何[分组密码模式](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)的精彩文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T05:42:44.530

有点取决于您传输加密数据的方式。您可能正在用一种语言编写文件，然后尝试从另一种语言中读取它。Python（尤其是在 Windows 上）要求您为二进制文件指定二进制模式。所以在 Python 中，假设你想在那里解密，你应该像这样打开文件：

```
f = open('/path/to/file', 'rb') 
```

“b”表示二进制。如果您要从 Python 将加密数据写入文件：

```
f = open('/path/to/file', 'wb')
f.write(encrypted_data) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-13T13:01:08.483

基本上是 Hugh 上面所说的：检查 IV、密钥大小和链接模式，以确保一切都相同。

独立测试双方，编码一些信息并检查 Ruby 和 Python 是否以相同的方式结束它。您假设问题与加密有关，但它可能只是像发送加密数据一样简单，`puts`其中将随机换行符放入数据中。一旦您确定他们正确加密了数据，请检查您是否收到了您认为您发送的内容。继续一步一步，直到找到破坏数据的阶段。

另外，我建议使用 ruby​​ 标准库中包含的 openssl 库，而不是使用外部 gem。

# search - 如何从 pdf 文档中获取字符偏移信息？

> ID：196788
> 
> 赞同：2
> 
> 时间：2008-10-13T05:32:11.230
> 
> 标签：search, pdf

我正在尝试在网络应用程序中实现 pdf 的搜索结果突出显示。我有原始 pdf 文件和搜索结果中使用的小 png 版本。本质上我正在寻找一个像这样的api：

```
pdf_document.find_offsets('somestring')
# => { top: 501, left: 100, bottom: 520, right: 150 }, { ... another box ... }, ... 
```

我知道可以从 pdf 中获取这些信息，因为 Apple 的 Preview.app 实现了这一点。

需要在 Linux 上运行的东西，理想情况下是开源的。我知道您可以在 Windows 上使用 acrobat 执行此操作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-15T02:39:35.460

[CAM::PDF](http://search.cpan.org/dist/CAM-PDF/)可以很好地完成几何部分，但有时在字符串匹配方面会遇到一些问题。该技术类似于以下经过轻微测试的代码：

```
use CAM::PDF;
my $pdf = CAM::PDF->new('my.pdf') or die $CAM::PDF::errstr;
for my $pagenum (1 .. $pdf->numPages) {
   my $pagetree = $pdf->getPageContentTree($pagenum) or die;
   my @text = $pagetree->traverse('MyRenderer')->getTextBlocks;
   for my $textblock (@text) {
      print "text '$textblock->{str}' at ",
            "($textblock->{left},$textblock->{bottom})\n";
   }
}

package MyRenderer;
use base 'CAM::PDF::GS';

sub new {
   my ($pkg, @args) = @_;
   my $self = $pkg->SUPER::new(@args);
   $self->{refs}->{text} = [];
   return $self;
}
sub getTextBlocks {
   my ($self) = @_;
   return @{$self->{refs}->{text}};
}
sub renderText {
   my ($self, $string, $width) = @_;
   my ($x, $y) = $self->textToDevice(0,0);
   push @{$self->{refs}->{text}}, {
      str => $string,
      left => $x,
      bottom => $y,
      right => $x + $width,
      #top => $y + ???,                                                                                 
   };
   return;
} 
```

输出看起来像这样：

```
text 'E' at (52.08,704.16)
text 'm' at (73.62096,704.16)
text 'p' at (113.58936,704.16)
text 'lo' at (140.49648,704.16)
text 'y' at (181.19904,704.16)
text 'e' at (204.43584,704.16)
text 'e' at (230.93808,704.16)
text ' N' at (257.44032,704.16)
text 'a' at (294.6504,704.16)
text 'm' at (320.772,704.16)
text 'e' at (360.7416,704.16)
text 'Employee Name' at (56.4,124.56)
text 'Employee Title' at (56.4,114.24)
text 'Company Name' at (56.4,103.92) 
```

正如您从该输出中看到的那样，字符串匹配会有点乏味，但几何图形很简单（可能除了字体高度）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T11:20:29.763

我认为您可以使用 Adob​​e Acrobat SDK 来做到这一点，它的 Linux 版本可以[从 Adob​​e 免费下载](http://www.adobe.com/devnet/acrobat/index.html?navID=downloads)。您可以使用它[从 PDF 中提取文本](http://livedocs.adobe.com/acrobat_sdk/9/Acrobat9_HTMLHelp/wwhelp/wwhimpl/common/html/wwhelp.htm?context=Acrobat9_HTMLHelp&file=DevFAQ_UnderstandingSDK.22.22.html)，然后计算出偏移量。然后可以使用[Acrobat XML 突出显示文件](http://www.adobe.com/devnet/pdf/pdfs/HighlightFileFormat.pdf)突出显示 PDF 。这用于指定要突出显示哪些位置的单词，并按如下方式提供给 acrobat：

[http://example.com/a.pdf#xml=http://example.com/highlightfile.xml](http://example.com/a.pdf#xml=http://example.com/highlightfile.xml)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T10:39:46.537

尝试查看 PdfLib TET [http://www.pdflib.com/products/tet/](http://www.pdflib.com/products/tet/)

（它不是免费的）

法布里齐奥

# email - 如何设置我的 Ubuntu VPS 以发送外发邮件？

> ID：196791
> 
> 赞同：12
> 
> 时间：2008-10-13T05:37:11.797
> 
> 标签：email, ubuntu, smtp, postfix-mta, mta

我的 VPS 提供商 (Slicehost) 不提供 SMTP 服务器。我使用 Google Apps 为我的域发送和接收邮件，但我希望能够以编程方式发送电子邮件。

我已经断断续续地在谷歌上搜索这个问题好几个月了，但我似乎无法清楚地了解我需要做什么。我只需要像后缀这样的 MTA 吗？我将其配置为“卫星”还是“互联网”站点？我需要进行任何 DNS 更改吗？如果有一天我想以编程方式接收电子邮件，是否有任何配置选项我应该小心修改？另外，如果我的 VPS 主机**确实**提供了 SMTP 服务器，我现在*不需要*做什么？

谢谢！

**编辑**：我的发现的快速概要：

*   更新`/etc/hosts`并`/etc/hostname`反映 FQDN（例如，`mail.domain.com`或`sub.domain.com`代替`slicename`）
    *   重新启动并验证`hostname -f`
*   设置反向 DNS（由拥有 IP 池的人所有）指向同一个 FQDN
    *   检查 RDNS 是否已通过`dig -x server.ip.address`
*   `sudo aptitude install postfix telnet mailx`
    *   使用**互联网站点**设置
    *   将 FQDN 设置为上面选择的任何内容
*   测试`mail whateveryouremailis@gmail.com`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T07:53:42.083

你看过[这里](http://articles.slicehost.com/search?q=email)吗，在我看来，有很多信息可以开始。我发现[mail-server-slice-setup](http://articles.slicehost.com/2008/9/2/mail-server-slice-setup)信息量很大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T21:09:00.293

根据我的经验，当电子邮件提供商检查垃圾邮件时，他们会检查除内容之外的 5 项主要内容：（当我说域时，我指的是发件人电子邮件地址的域。）

1.  域名的“A”记录（IP）存在
2.  域名的MX记录存在
3.  发件人IP地址的PTR记录（反向查找）是否存在（有时我想也是检查一下PTR记录是否与原域相同的A记录）
4.  该域的 SPF 记录与 IP 号码匹配（这是允许发送该域电子邮件的 IP 号码列表。虽然这对于垃圾邮件过滤来说是一个很好的解决方案，但这不是官方记录，因此并不总是检查。[查看 SPF 设置向导。](http://old.openspf.org/wizard.html)）
5.  服务器的IP段不是黑名单段。

第五个对我来说是个问题。显然，Hotmail、Gmail、Yahoo 等电子邮件提供商会丢弃来自广泛使用的服务器提供商（例如 Amazon EC2）的所有传入电子邮件。在这种情况下，根本无法保证所有外发电子邮件的传送，因此您必须中继来自黑名单段之外的其他 SMTP 服务器的所有外发电子邮件。执行此操作的最简单方法是将 Postfix（或您使用的任何 MTA）配置为自动中继所有电子邮件。如果您进行一些谷歌搜索，您可以找到很多关于此的文章。

如果不是这种情况，那么您只需要一个像 Postfix 这样的简单 MTA，只要正确配置了上面列出的所有必要的 DNS 记录，您发送电子邮件就应该没有问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T22:07:02.283

其他答案提供了有关发送电子邮件机制的信息，但您需要考虑的一件事是您将使用哪个发件人地址，以及您将如何处理退回邮件。

假设您从 sender@example.com 发送电子邮件；然后（正如 Murat Ayfer 指出的），您需要确保您的主机被允许根据 example.com 的 SPF 记录发送邮件。（这可能由 IP 地址配置，也可能不配置——有关详细信息，请参阅[SPF 站点](http://www.openspf.org/)。）如果您负责 example.com 域，那么这应该不是问题。被列为该域的可接受发件人是您的电子邮件通过的重要一步。

您需要担心的下一件事是如何处理退回的电子邮件。如果其他主机收到 example.com 的电子邮件（即 MX 记录指向其他地方），则主要是其他人的问题。（但是请注意，您的应用程序必须准备好在与主机上的邮件服务器的 SMTP 会话期间失败，例如，由于语法无效的电子邮件地址。）但是，如果您决定您将在您的主机，那么您需要担心处理重试邮件、退回邮件、双重退回邮件以及许多其他常规邮件服务器管理。有一些关于[在 Web 应用程序](https://stackoverflow.com/questions/124304/handling-undelivered-emails-in-webapp)中处理未送达电子邮件的信息可能会有所帮助，但我也建议获得一本关于 Postfix 或您决定使用的任何邮件服务器的好书。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T08:16:46.200

只需将 postfix 之类的东西安装为“互联网站点”，您就可以直接从您的 VPS 发送邮件

它应该使用默认设置，但建议您也阅读一些文档/操作方法以正确保护它

# iphone - 有没有办法控制 UITableView scrollToRowAtIndexPath 上的动画？

> ID：196795
> 
> 赞同：7
> 
> 时间：2008-10-13T05:42:57.917
> 
> 标签：iphone, objective-c, cocoa-touch, uitableview

我想修改动画持续时间并附加一个回调，以便在动画完成时调用 scrollToRowAtIndexPath 时调用动画：YES 但我找不到其动画代理的句柄或任何其他方式来做到这一点。

有谁知道这是否可能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-13T14:56:32.510

在您的`TableView delegate`, 实施

`-scrollViewDidEndScrollingAnimation:`

一旦滚动动画完成，这将被调用。

# c# - 从没有页眉/页脚的 Crystal Reports 导出到 Excel

> ID：196817
> 
> 赞同：7
> 
> 时间：2008-10-13T05:59:59.363
> 
> 标签：c#, crystal-reports

只是想知道是否有人有工作代码示例（在 c# 中）用于将水晶报表从 .NET 应用程序导出到 Excel，而没有报表的页眉和页脚。

我正在使用水晶报表 v9 运行时。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T14:29:05.747

要做到这一点，您实际上需要在 Crystal Report 中进行。我的建议是添加一个参数，然后编辑页眉和页脚抑制公式以检查参数。这就是我们实现它的方式。如果有办法从你的代码中做到这一点，我也会有兴趣知道它。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-04-21T16:32:20.297

这是我的 ReportDocument 扩展方法来抑制所有页眉/页脚。我将它用于 Excel 导出。

```
/// <summary>
/// Clears header/footer.
/// </summary>
/// <param name="rpt">The reportdocument</param>
public static void ClearReportHeaderAndFooter(this ReportDocument rpt)
{
    foreach (Section section in rpt.ReportDefinition.Sections)
    {
        if (section.Kind == AreaSectionKind.ReportHeader || section.Kind == AreaSectionKind.ReportFooter || section.Kind == AreaSectionKind.PageFooter || section.Kind == AreaSectionKind.PageHeader)
        {
            section.SectionFormat.EnableSuppress = true;
            section.SectionFormat.BackgroundColor = Color.White;
            foreach (var repO in section.ReportObjects)
            {
                if (repO is ReportObject)
                {
                    var reportObject = repO as ReportObject;
                    reportObject.ObjectFormat.EnableSuppress = true;

                    reportObject.Border.BorderColor = Color.White;
                }
            }
        }
    }
} 
```

像这样使用它：

```
myReportDocument.ClearReportHeaderAndFooter(); 
```

# c - 跨平台编辑器控制

> ID：196820
> 
> 赞同：5
> 
> 时间：2008-10-13T06:02:46.377
> 
> 标签：c, user-interface, editor, cross-platform

我需要一个跨平台的编辑器控件来用作内部工具中的 GUI 部分。控制可能是商业性的，但价格合理。

所需功能：

*   平台：Win32、OS X、Linux
*   UTF-8 支持
*   对文本样式（或至少颜色）的细粒度运行时控制
*   不错的低级纯 C API，没有通常可怕的膨胀
*   不应该阻止我拥有这些功能（即使我必须自己实现它们）：
    *   撤销重做
    *   复制粘贴
    *   上下文菜单，取决于文本中的点击位置
    *   工具栏，取决于文本中的光标位置
    *   侧边栏面板，取决于文本中的光标位置

实际上上面需要的不是简单的控制，而是整个跨平台的GUI库。

丢弃的选项：

*   闪烁和后代
*   FLTK
*   狐狸工具包
*   gtksourceview

**更新：**

注意：我在这里写了一些半写的丢弃推理，我很抱歉。Scintilla 确实可以在 OS X 上运行。但是，如果我理解正确，则 Scintilla 的 API 是 C++ 语言。

用例：

我的用例是编写自定义的“半刚性”逻辑编辑器，用户可以自由地复制粘贴，在他希望的地方添加评论，甚至如果他愿意，甚至可以直接输入文本。但是文本结构是逻辑树的一种严格的自然语言表示（本质上有点像 AST）。我计划编写一些类似智能感知（或类似代码模板）的东西作为主要创作工具（而不是手动输入逻辑）。

顺便说一句，存储格式不是纯文本，而是提到的逻辑树的内部表示（带有注释和空格等元信息）。

所以，我有所有必要的信息来自己渲染所需颜色的文本。我不需要任何外部词法分析器等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T14:14:09.133

正如 John 所写，众所周知，Scintilla 可以在 OS X 上运行。
现在，它不是富文本组件，如果您正在寻找它的话。它是一个源代码编辑器：您不能将任意颜色应用于任意文本段，它使用词法分析器来设置内容样式。

你没有告诉我们你的用例是什么。

[编辑] 感谢您添加用例。

免责声明 1：我不会尝试“出售” Scintilla，我只是尝试向您提供有关我熟悉的组件的信息，希望对您有所帮助... :-D
请注意，[相关站点](http://scintilla.sourceforge.net/ScintillaRelated.html "相关网站")页面列出了许多替代编辑可能有趣的组件（或不有趣，其中很多仅适用于 Win32）。
免责声明 2：我没有在 Win32 平台之外使用 Scintilla 的经验。

但是查看源代码树，我看到了一个 scintilla/macosx 文件夹。除此之外，它还有一个带有 main.cpp 文件的 SciTest 子文件夹。尽管它有扩展，但对我来说，它看起来很像纯 C。因此，它可以作为如何在 C 中使用 Scintilla 的示例。

请注意，在设计上，Scintilla API 非常有限：它最初被用作大多数传统的 Win32 组件，通过向其发送消息。[Scintilla 文档](http://scintilla.sourceforge.net/ScintillaDoc.html "闪烁文档")页面仅列出了这些消息及其参数。main.cpp 示例使用 MacOS X 样式的组件创建窗口，并使用以下行发送命令`scintilla->WndProc(SCI_STYLESETFORE, 0, 0x808080);`

我不会声称它可以满足您的所有需求，甚至不会在 MacOS X 上完美运行，您必须进行试验（或询问改编的作者）才能确定。
此外，Scintilla 不会提供工具栏或侧边栏面板（这更多地属于应用程序本身）。但我认为它可以提供足够的通知来帮助您将这些侧面组件保持在上下文中。
您还需要为您的语法编写一个特定的词法分析器（此处为 C++）。如果你看看其他词法分析器是如何工作的，这并不难。也许你会找到一个足够接近的语言作为起点。
将文档的某些部分设置为只读的功能也许也很有趣，尽管我相信这还没有经过彻底的测试。

HTH。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T06:34:16.017

> 闪烁和后代（无 OS X）

但是，scintilla 确实可以在 OS X 上运行。

* * *

您可以尝试使用 GTK+[`GtkTextView`](http://library.gnome.org/devel/gtk/stable/GtkTextView.html)或 Qt 的[`QTextEdit`](http://doc.trolltech.com/4.4/qtextedit.html).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T01:04:44.973

FLTK 的 TextEditor 小部件就是您所需要的。它简单、直接且易于使用，具有 utf8，您可以轻松拥有文本样式。只需几行，您就可以拥有一个编辑器。检查 /test/editor.cxx 示例。它也可以在 OSX 上完美运行。此外，您需要的所有内容都在此处进行了说明：http: [//www.fltk.org/doc-1.1/editor.html](http://www.fltk.org/doc-1.1/editor.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T20:34:24.090

好吧，您也许可以使用[tk——](http://www.tcl.tk/)文本小部件据说很好且灵活——看看[tcl/tk wiki](http://wiki.tcl.tk/1402)。

或者你可以选择一些嵌入式/游戏工具包（如[Agar](http://libagar.org/)）——但我想，有一个具有编辑功能的文本小部件会更麻烦。

但是说你想做一个跨平台的 C GUI 然后注销 GTK 对我来说似乎浪费了很多时间和精力。您可能最终会切换语言或使用 GTK。

# java - Java 文件输入作为命令行参数

> ID：196824
> 
> 赞同：2
> 
> 时间：2008-10-13T06:07:47.413
> 
> 标签：java, command-line

在 Java 中如何处理从文件输入的信息。例如：假设您有一个文件 input.txt。这个文件的内容是： abcdefghizzzzjklmnop azzbcdefghijklmnop

我希望将信息放入字符串参数数组中，以便以下代码输出“abcdefghizzzzjklmnop”

```
class Test {
    public static void main(String[] args) {
        System.out.println(args[0]);
    }
} 
```

我一直在使用的命令引发了一个数组越界异常。这个命令是：

> > java测试<输入.txt

不过，非基于文件的参数可以正常工作。IE。java Test 你好，和 java Test < input.txt 你好。

更多信息：我尝试将文件内容全部放在一行中，以查看 \n \r 字符是否会搞砸。这似乎没有帮助。

另外，我不能为此使用 bufferedreader 类，因为这是针对学校的程序，并且它必须与我的教授 shell 脚本一起使用。他在课堂上看过这个，但我没有写下来（或者我找不到它）。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-13T06:10:49.590

您应该能够从中读取输入数据`System.in`。

这是一些快速而肮脏的示例代码。`javac Test.java; java Test < Test.java`：

```
class Test
{
    public static void main (String[] args)
    {
        byte[] bytes = new byte[1024];
        try
        {
            while (System.in.available() > 0)
            {
                int read = System.in.read (bytes, 0, 1024);
                System.out.write (bytes, 0, read);
            }
        } catch (Exception e)
        {
            e.printStackTrace ();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T06:13:07.183

似乎任何时候你发布一个关于你的问题的正式问题，你都会弄清楚。

通过“< input.txt”输入文件作为用户输入而不是命令行参数。在我解释了为什么 bufferedreader 类不起作用后不久，我就意识到了这一点。

原来你必须使用缓冲的阅读器类。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-13T06:28:32.037

我不确定为什么要将文件的内容作为命令行参数传递，除非你正在做一些奇怪的测试台。

您可以编写一个脚本来读取您的文件，生成一个临时脚本，在该脚本中您需要遵循 java 命令。

# visual-studio - 用于 Visual C++ 的 ReSharper（或类似的东西）？

> ID：196828
> 
> 赞同：18
> 
> 时间：2008-10-13T06:09:24.367
> 
> 标签：visual-studio, visual-c++, resharper

我看过很多推荐 ReSharper 不幸的是，它在 Visual Studio 中不支持 C++。有什么可以推荐的吗？我已经使用了 Visual Assist，它的工作做得很好，但与 ReSharper 相比，它的功能相当有限。

有什么建议么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-07T23:56:05.300

恕我直言 - [Visual Assist X](http://www.wholetomato.com/)是 C++ 的最佳但昂贵的代码完成/重构工具。VAX 没有 ReSharper for C# 那么多的功能，但它使您的 C++ 编程更轻松、更快速……刚刚查看了 CodeRush - 它与大多数 DevExpress 库和工具一样具有 %% 的优势。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T06:56:29.390

Refactor Pro[可](http://www.devexpress.com/Products/Visual_Studio_Add-in/RefactorCPP/)用于 Visual C++，这将为您提供一些功能。另请查看 CodeRush，我认为它也支持 C++。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-12T09:29:53.930

我尝试了 Refactor Pro 和 Visual Assist/X。它们都没有像 ReSharper 那样让我兴奋。我想这主要是因为 C++ 是一种很难编写自动重构的语言。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T05:37:36.323

解决方案是在 Eclipse 或 NetBeans 中编写代码，但这样的 IDE 不是 Visual Studio。

# java - 在Java中遍历字符串字符的最简单/最好/最正确的方法是什么？

> ID：196830
> 
> 赞同：425
> 
> 时间：2008-10-13T06:10:15.693
> 
> 标签：java, string, iteration, character, tokenize

在 Java 中遍历字符串字符的一些方法是：

1.  使用`StringTokenizer`?
2.  将 a转换`String`为 a`char[]`并对其进行迭代。

什么是最简单/最好/最正确的迭代方式？

* * *

## 回答 #1

> 赞同：443
> 
> 时间：2008-10-13T06:13:16.530

我使用 for 循环来迭代字符串并使用`charAt()`来获取每个字符来检查它。由于 String 是用数组实现的，所以该`charAt()`方法是一个恒定时间的操作。

```
String s = "...stuff...";

for (int i = 0; i < s.length(); i++){
    char c = s.charAt(i);        
    //Process char
} 
```

这就是我会做的。这对我来说似乎是最简单的。

就正确性而言，我不相信这里存在。这完全取决于您的个人风格。

* * *

## 回答 #2

> 赞同：254
> 
> 时间：2008-10-13T08:06:23.943

两种选择

```
for(int i = 0, n = s.length() ; i < n ; i++) { 
    char c = s.charAt(i); 
} 
```

或者

```
for(char c : s.toCharArray()) {
    // process c
} 
```

第一个可能更快，然后第二个可能更具可读性。

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2008-12-11T23:04:09.910

请注意，如果您正在处理 BMP（Unicode[基本多语言平面](http://en.wikipedia.org/wiki/Mapping_of_Unicode_character_planes#Basic_Multilingual_Plane)）之外的字符，即超出 u0000-uFFFF 范围的[代码点，则此处描述的大多数其他技术都会失效。](http://en.wikipedia.org/wiki/Code_point)这只会很少发生，因为在此之外的代码点大多分配给死语言。但除此之外还有一些有用的字符，例如一些用于数学符号的代码点，以及一些用于编码中文专有名称的代码点。

在这种情况下，您的代码将是：

```
String str = "....";
int offset = 0, strLen = str.length();
while (offset < strLen) {
  int curChar = str.codePointAt(offset);
  offset += Character.charCount(curChar);
  // do something with curChar
} 
```

该`Character.charCount(int)`方法需要 Java 5+。

来源： http: [//mindprod.com/jgloss/codepoint.html](http://mindprod.com/jgloss/codepoint.html)

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2017-12-10T06:44:28.680

在**Java 8**中，我们可以将其解决为：

```
String str = "xyz";
str.chars().forEachOrdered(i -> System.out.print((char)i));
str.codePoints().forEachOrdered(i -> System.out.print((char)i)); 
```

chars() 方法返回[doc](https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#chars--)`IntStream`中提到的一个：

> 返回一个 int 流，对该序列中的 char 值进行零扩展。任何映射到代理代码点的字符都会未经解释地传递。如果在读取流时序列发生突变，则结果未定义。

该方法`codePoints()`还返回一个`IntStream`as per doc：

> 从该序列返回代码点值流。序列中遇到的任何代理对都会像 Character.toCodePoint 一样组合，并将结果传递给流。任何其他代码单元，包括普通 BMP 字符、不成对的代理和未定义的代码单元，都被零扩展为 int 值，然后将其传递给流。

**字符和代码点有何不同？**如[本文](https://blogs.oracle.com/darcy/iterating-over-the-codepoints-of-a-string)所述：

> Unicode 3.1 增加了补充字符，使字符总数超过了单个 16 位可以区分的 2^16 = 65536 个字符`char`。因此，`char`值不再与 Unicode 中的基本语义单元具有一对一的映射关系。JDK 5 已更新以支持更大的字符值集。一些新的补充字符不是更改类型的定义，而是由两个值`char`的代理对表示。`char`为了减少命名混淆，将使用代码点来指代代表特定 Unicode 字符的数字，包括补充字符。

**最后为什么`forEachOrdered`而不是`forEach`？**

的行为`forEach`是明确的非确定性的，当`forEachOrdered`为该流的每个元素执行操作时，如果流具有定义的遇到顺序**，则按照流的遇到顺序。**所以`forEach`不保证订单会被保留。另请检查此[问题](https://stackoverflow.com/questions/32797579/foreach-vs-foreachordered-in-java-8-stream)以获取更多信息。

有关**字符、代码点、字形和字形之间的区别，**请检查此[问题](https://stackoverflow.com/questions/27331819/whats-the-difference-between-a-character-a-code-point-a-glyph-and-a-grapheme)。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2008-12-11T21:08:23.387

我同意 StringTokenizer 在这里是矫枉过正的。实际上我尝试了上面的建议并花时间。

我的测试相当简单：创建一个包含大约一百万个字符的 StringBuilder，将其转换为字符串，并在转换为 char 数组 / 使用 CharacterIterator 千次之后使用 charAt() 遍历它们（当然要确保对字符串做一些事情，这样编译器就不能优化整个循环:-)）。

我的 2.6 GHz Powerbook（这是一个 mac :-)）和 JDK 1.5 上的结果：

*   测试 1：charAt + String --> 3138 毫秒
*   测试 2：字符串转换为数组 --> 9568 毫秒
*   测试 3：StringBuilder charAt --> 3536msec
*   测试 4：CharacterIterator 和 String --> 12151msec

由于结果明显不同，最直接的方法似乎也是最快的方法。有趣的是，StringBuilder 的 charAt() 似乎比 String 的慢一点。

顺便说一句，我建议不要使用 CharacterIterator，因为我认为它滥用 '\uFFFF' 字符作为“迭代结束”是一个非常糟糕的黑客行为。在大型项目中，总会有两个人出于两种不同的目的使用相同的 hack，并且代码会非常神秘地崩溃。

这是其中一项测试：

```
 int count = 1000;
    ...

    System.out.println("Test 1: charAt + String");
    long t = System.currentTimeMillis();
    int sum=0;
    for (int i=0; i<count; i++) {
        int len = str.length();
        for (int j=0; j<len; j++) {
            if (str.charAt(j) == 'b')
                sum = sum + 1;
        }
    }
    t = System.currentTimeMillis()-t;
    System.out.println("result: "+ sum + " after " + t + "msec"); 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-10-13T06:38:20.033

为此有一些专门的课程：

```
import java.text.*;

final CharacterIterator it = new StringCharacterIterator(s);
for(char c = it.first(); c != CharacterIterator.DONE; c = it.next()) {
   // process c
   ...
} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2011-03-08T14:30:48.017

如果您的类路径中有[Guava](http://code.google.com/p/guava-libraries/)，则以下是一个非常易读的替代方案。对于这种情况，Guava 甚至有一个相当明智的自定义 List 实现，所以这不应该是低效的。

```
for(char c : Lists.charactersOf(yourString)) {
    // Do whatever you want     
} 
```

更新：正如@Alex 所指出的，Java 8 也[`CharSequence#chars`](https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#chars--)可以使用。甚至类型是 IntStream，所以它可以映射到如下字符：

```
yourString.chars()
        .mapToObj(c -> Character.valueOf((char) c))
        .forEach(c -> System.out.println(c)); // Or whatever you want 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2015-01-06T10:38:56.073

如果您需要遍历 a 的代码点`String`（请参阅此[答案](https://stackoverflow.com/a/361345/3179759)），一种更短/更易读的方法是使用[`CharSequence#codePoints`](http://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#codePoints--)Java 8 中添加的方法：

```
for(int c : string.codePoints().toArray()){
    ...
} 
```

或直接使用流而不是 for 循环：

```
string.codePoints().forEach(c -> ...); 
```

如果[`CharSequence#chars`](http://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#chars--)你想要一个字符流（虽然它是一个`IntStream`，因为没有`CharStream`），还有一个。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-13T06:26:23.960

我不会使用`StringTokenizer`它，因为它是 JDK 中遗留的类之一。

javadoc 说：

> `StringTokenizer`是一个遗留类，出于兼容性原因保留，但不鼓励在新代码中使用它。建议任何寻求此功能的人使用 split 方法`String`或 `java.util.regex`package 代替。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-12-24T10:54:13.777

如果您需要性能，那么您**必须**在您的环境中进行测试。别无退路。

这里示例代码：

```
int tmp = 0;
String s = new String(new byte[64*1024]);
{
    long st = System.nanoTime();
    for(int i = 0, n = s.length(); i < n; i++) {
        tmp += s.charAt(i);
    }
    st = System.nanoTime() - st;
    System.out.println("1 " + st);
}

{
    long st = System.nanoTime();
    char[] ch = s.toCharArray();
    for(int i = 0, n = ch.length; i < n; i++) {
        tmp += ch[i];
    }
    st = System.nanoTime() - st;
    System.out.println("2 " + st);
}
{
    long st = System.nanoTime();
    for(char c : s.toCharArray()) {
        tmp += c;
    }
    st = System.nanoTime() - st;
    System.out.println("3 " + st);
}
System.out.println("" + tmp); 
```

在[Java 在线](http://www.tutorialspoint.com/compile_java_online.php)我得到：

```
1 10349420
2 526130
3 484200
0 
```

在 Android x86 API 17 上，我得到：

```
1 9122107
2 13486911
3 12700778
0 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-13T06:34:57.700

请参阅[Java 教程：字符串](http://java.sun.com/docs/books/tutorial/java/data/strings.html)。

```
public class StringDemo {
    public static void main(String[] args) {
        String palindrome = "Dot saw I was Tod";
        int len = palindrome.length();
        char[] tempCharArray = new char[len];
        char[] charArray = new char[len];

        // put original string in an array of chars
        for (int i = 0; i < len; i++) {
            tempCharArray[i] = palindrome.charAt(i);
        } 

        // reverse array of chars
        for (int j = 0; j < len; j++) {
            charArray[j] = tempCharArray[len - 1 - j];
        }

        String reversePalindrome =  new String(charArray);
        System.out.println(reversePalindrome);
    }
} 
```

将长度放入`int len`并使用`for`循环。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-13T12:24:48.337

StringTokenizer 完全不适合将字符串分解为单个字符的任务。通过`String#split()`使用不匹配的正则表达式，您可以轻松做到这一点，例如：

```
String[] theChars = str.split("|"); 
```

但是 StringTokenizer 不使用正则表达式，并且没有可以指定的分隔符字符串将匹配字符之间的空。*您可以*使用一个可爱的小技巧来完成同样的事情：使用字符串本身作为分隔符字符串（使其中的每个字符成为分隔符）并让它返回分隔符：

```
StringTokenizer st = new StringTokenizer(str, str, true); 
```

但是，我仅出于消除它们的目的而提及这些选项。这两种技术都将原始字符串分解为单字符字符串而不是 char 原语，并且都涉及对象创建和字符串操作形式的大量开销。将其与在 for 循环中调用 charAt() 进行比较，这几乎不会产生任何开销。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-11-05T23:59:27.117

详细说明[这个答案](https://stackoverflow.com/a/361345/99717)和[这个答案](https://stackoverflow.com/a/27796856/99717)。

上面的答案指出了这里的许多解决方案的问题，这些解决方案不按代码点值进行迭代——他们会遇到任何[代理字符](https://en.wikipedia.org/wiki/Universal_Character_Set_characters#Surrogates)的问题。[Java 文档还在这里](https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html)概述了这个问题（参见“Unicode 字符表示”）。无论如何，这里有一些代码使用补充 Unicode 集中的一些实际代理字符，并将它们转换*回*字符串。请注意， .toChars() 返回一个字符数组：如果您正在处理代理项，则必须有两个字符。此代码适用于*任何*Unicode 字符。

```
 String supplementary = "Some Supplementary: ";
    supplementary.codePoints().forEach(cp -> 
            System.out.print(new String(Character.toChars(cp)))); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-15T09:39:00.903

此示例代码将为您提供帮助！

```
import java.util.Comparator;
import java.util.HashMap;
import java.util.Map;
import java.util.TreeMap;

public class Solution {
    public static void main(String[] args) {
        HashMap<String, Integer> map = new HashMap<String, Integer>();
        map.put("a", 10);
        map.put("b", 30);
        map.put("c", 50);
        map.put("d", 40);
        map.put("e", 20);
        System.out.println(map);

        Map sortedMap = sortByValue(map);
        System.out.println(sortedMap);
    }

    public static Map sortByValue(Map unsortedMap) {
        Map sortedMap = new TreeMap(new ValueComparator(unsortedMap));
        sortedMap.putAll(unsortedMap);
        return sortedMap;
    }

}

class ValueComparator implements Comparator {
    Map map;

    public ValueComparator(Map map) {
        this.map = map;
    }

    public int compare(Object keyA, Object keyB) {
        Comparable valueA = (Comparable) map.get(keyA);
        Comparable valueB = (Comparable) map.get(keyB);
        return valueB.compareTo(valueA);
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-05-02T16:26:10.787

所以通常有两种方法可以遍历java中的字符串，这已经被这个线程中的多人回答了，只需添加我的版本首先是使用

```
String s = sc.next() // assuming scanner class is defined above
for(int i=0; i<s.length(); i++){
     s.charAt(i)   // This being the first way and is a constant time operation will hardly add any overhead
  }

char[] str = new char[10];
str = s.toCharArray() // this is another way of doing so and it takes O(n) amount of time for copying contents from your string class to the character array 
```

如果性能受到威胁，那么我建议在恒定时间内使用第一个，如果不是，那么考虑到 java 中字符串类的不变性，使用第二个会让你的工作更容易。

# c# - 带有 WPF 菜单控件的下拉列表

> ID：196840
> 
> 赞同：11
> 
> 时间：2008-10-13T06:23:22.687
> 
> 标签：c#, .net, wpf

我正在寻找一种将 WPF 中的下拉列表添加到菜单的方法。这在 winforms 中非常容易，所以我希望你们专家现在知道在 WPF 中执行此操作。谢谢。

抱歉，如果这是一个不好的问题，那就晚了，我不想去想。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-13T06:41:53.647

将任何 UIElement 添加到任何控件都非常容易，您只需将 Combobox 添加到 Menu 控件并创建菜单，如下所示。

```
<Menu>
    <MenuItem Header="File">
        <MenuItem Header="Open"/>
        <MenuItem Header="Close"/>
        <Separator/>
        <ComboBox Width="85" Height="21.96" />
    </MenuItem>
</Menu> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-13T16:50:34.353

虽然正如 Jobi Joy 所展示的那样，这很容易做到，但我认为它的可用性很差。Menu 控件支持多级菜单项，为了 UI 的一致性，我会沿着这条路线走。

# python - 如何在 Ruby 中模拟 Python 的命名 printf 参数？

> ID：196841
> 
> 赞同：9
> 
> 时间：2008-10-13T06:25:29.937
> 
> 标签：python, ruby, string, printf

在 Python 中，您可以这样做：

```
print "Hi!  I'm %(name)s, and I'm %(age)d years old." % ({"name":"Brian","age":30}) 
```

复制这种行为的最接近、最简单的 Ruby 习语是什么？（请不要对 String 类进行猴子修补。）

**编辑：**这样做的真正好处之一是您可以将预处理的字符串存储在变量中并将其用作“模板”，如下所示：

```
template = "Hi!  I'm %(name)s, and I'm %(age)d years old."
def greet(template,name,age):
    print template % ({"name":name,"age":age}) 
```

这显然是一个微不足道的例子，但是能够存储这样一个字符串以供以后使用有很多实用性。Ruby 的`"Hi! I'm #{name}"`约定大致相似，但直接评估使其不那么通用。

请不要对建议该`#{var}`技术的答案投反对票，因为它们来自此编辑之前。（随机想法内核：如果问题作者将答案标记为“过时”，也许应该保护答案不被投票......？）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-09-24T10:19:55.190

你也可以使用

```
printf "1: %<key1>s 2: %<key2>s\n", {:key1 => "value1", :key2 => "value2"} 
```

或者

```
data = {:key1 => "value1", :key2 => "value2"}
printf "1: %<key1>s 2: %<key2>s\n",  data 
```

或（这需要 ruby​​ 1.9，对于其他示例我不确定）

```
data = {key1: "value1", key2: "value2"}
printf "1: %<key1>s 2: %<key2>s\n", data 
```

这打印

```
1: value1 2: value2 
```

重要限制：使用的哈希键（在我的示例中为*data*）必须是符号。

* * *

对上面示例的注释： `printf`采用一个格式字符串和可选参数。但也有一种`String#%`方法。

以下四个调用具有相同的结果：

```
printf "1: %<key1>s 2: %<key2>s\n" , {:key1 => "value1", :key2 => "value2"}
printf "1: %<key1>s 2: %<key2>s\n" % {:key1 => "value1", :key2 => "value2"}
print  "1: %<key1>s 2: %<key2>s\n" % {:key1 => "value1", :key2 => "value2"}
puts   "1: %<key1>s 2: %<key2>s"   % {:key1 => "value1", :key2 => "value2"} 
```

第二个版本首先使用`String#%`- 方法并将结果发送到`printf`.

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-10-23T09:53:41.590

你这样做：

```
values = {:hello => 'world', :world => 'hello'}
puts "%{world} %{hello}" % values 
```

阅读此内容以获取更多信息： [http ://ruby.runpaint.org/strings#sprintf-hash](http://ruby.runpaint.org/strings#sprintf-hash)

如果您需要更复杂的东西，请阅读 ERB 和 google 模板引擎。如果您需要生成网页、电子邮件等，您会发现使用模板引擎是一种更强大的解决方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-13T06:34:09.293

在 Ruby 中有一些很好的技巧：

```
name = "Peter"
@age = 15 # instance variable
puts "Hi, you are #{name} and your age is #@age" 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-13T19:47:39.537

```
 class Template

  def %(h)
    "Hi!  I'm #{h[:name]}s, and I'm #{h[:age]}d years old."

  end
end 
```

然后调用它

```
t=Template.new
t%({:name => "Peter", :age => 18}) 
```

这不完全是您所要求的，但可以给您一个提示。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-13T06:31:22.217

在 Ruby 中的双引号字符串中，您可以插入 Ruby 表达式的结果，如下所示：

```
puts "Hi!  I'm #{name}, and I'm #{age} years old." 
```

只需在花括号内放置一个表达式即可。（也可以是更复杂的东西，比如#{age + 5}，或#{name + ' ' + last_name}，或函数调用。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-24T09:55:50.270

但是，有效的（同时）是以下方面的东西：

```
d = {"key1" => "value1", "key2" => "value2"}
s = "string to be magically induced with variables, which are \n * %s and \n * %s.\n"
print s%d.values()
# or
print s%[d["key1"], d["key2"]] 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T06:31:53.807

放“嗨！我是 #{name}，我 #{age} 岁。”

# java - 寻找从移动应用程序进行身份验证的安全方法

> ID：196845
> 
> 赞同：0
> 
> 时间：2008-10-13T06:30:01.783
> 
> 标签：java, security, mobile

我继承了一个移动应用程序，它以明文形式发送身份验证凭据（用户 ID/密码）。

我想我有两个选择：a）使用 TLS。b) 编写我自己的身份验证协议。

如果我选择 (b) 我必须遵循哪些关键准则才能使其安全。例如如何避免重放攻击，加密策略。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T06:33:55.050

如果您使用 b)，关键准则是：不要。如果您希望它安全，那就是。

尝试坚持 a)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T22:11:59.573

没有必要编写自己的安全协议，而且是个坏主意。它几乎肯定会有可利用的缺陷。如果您只需要保护登录凭据的机密性，那么您应该使用 SSL/TLS。它还允许您在将来更轻松地升级到基于客户端证书的身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T06:36:48.323

对于（b）我猜你做了一个挑战 - 响应的事情。

服务器生成一个随机字符串，发送给客户端。客户端将其附加到密码并散列整个内容，将散列发送回服务器。服务器执行相同的计算，将结果与从客户端获得的结果进行比较。如果它们匹配，则客户端发送正确的密码。

最明显的漏洞是，如果有人窥探交换双方，他们就可以对密码进行离线字典攻击。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-13T07:30:18.103

对于“安全”的*“您不能因此而被起诉”*和*“受到合理保护”*的定义，对于移动应用程序，您可以假设该线路是安全的，而不是中间人攻击，并且对窃听是开放的. SSL/TLS 听起来是最简单的方法，但这可能取决于您的运营商和目标手机。

如果您无法使 TLS 工作并且您需要自己推出，请使用[Diffie-Hellman](http://en.wikipedia.org/wiki/Diffie-Hellman)密钥交换和已建立的加密库（弹性[城堡军团](http://www.bouncycastle.org/latest_releases.html)有一个符合 J2ME 的轻量级实现。）

# svn - 哪些 Subversion Web 界面有责备功能？

> ID：196857
> 
> 赞同：5
> 
> 时间：2008-10-13T06:34:57.670
> 
> 标签：svn, version-control, blame

我正在寻找一个**颠覆网络客户端**ala [SVN::Web](http://search.cpan.org/dist/SVN-Web/)但我一直认为它具有非常特殊的功能会非常有用。

我想要的是能够找到**哪个修订版负责**文本文件中的某一行（或几行）。通过网络做到这一点的方法会很棒。

有人知道这样的工具吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T06:45:05.777

我使用[WebSVN](http://websvn.tigris.org/)，您可以从那里使用*svn blame* ，您可以看到谁以及何时添加或修改了文件中的每一行代码......

**编辑：**这是一对截图，所以你可以得到一个想法：

![1](https://i.stack.imgur.com/eG0ag.jpg),![2](https://i.stack.imgur.com/9cck2.jpg)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T07:27:46.207

Trac 可以为您做到这一点。查看文件时，页面顶部有一个注释选项，它将使用 ajax 加载文件源左侧下方的栏，给出每行（或块，如果已编辑块）的修订号在一次提交中）

不过，很高兴看到每行都有修订历史。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T07:54:24.373

SVN::Web 界面让您可以访问文件上的 svn blame 注释。

当您查看特定文件时，您应该看到“ **Blame/Annotate** ”作为左上角的链接之一。当您单击它时，您会看到文件的标记更加丰富，其中的块具有交替的颜色。这些描述了属于给定转速的连续块的开始和结束位置。左侧是提交负责给定块的用户的用户名，左侧是链接数字，指示特定块源自的修订版。单击该链接将带您进入修订视图页面，该页面列出了该修订中更改的所有文件，以及文件/更改本身的颜色编码差异。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T12:39:44.423

我们使用[Warehouse](http://www.warehouseapp.com/)，并且对它非常满意。它是用 Ruby on Rails 编写的，所以如果您精通这一点，那么您就遥遥领先。他们也刚刚[开源](http://github.com/entp/warehouse/tree/master)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-15T13:11:24.610

[Tortoise SVN](http://tortoisesvn.tigris.org/)还支持“责备”功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T06:38:24.903

我认为 SVN 具有“责备”功能，可以做类似的事情。不过，我正在黑暗中刺伤。等我快速浏览一下互联网。

你打赌。看看[这个](http://svnbook.red-bean.com/en/1.0/re02.html)。（顺便说一句，我使用子剪辑）

这意味着大多数 web SVN 界面都会有这个功能，因为它并不是什么特别的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-04T21:59:40.567

VisualSVN Server 的 web UI 有一个责备视图。[在https://demo-server.visualsvn.com/!/#asf/blame/r1873567/subversion/trunk/subversion/tests/README?line=34](https://demo-server.visualsvn.com/!/#asf/blame/r1873567/subversion/trunk/subversion/tests/README?line=34)查看演示

在责备视图中，文件中的每一行都包括作者姓名、日期、日志消息和修订号。该视图还具有**Blame previous revision**命令，可帮助导航到较早的修订并检查更改的详细信息。请参阅下面的屏幕截图。

*指责视图概述* [![在此处输入图像描述](https://i.stack.imgur.com/9Znhi.png)](https://i.stack.imgur.com/9Znhi.png)

*日志消息* [![在此处输入图像描述](https://i.stack.imgur.com/iP1vn.png)](https://i.stack.imgur.com/iP1vn.png)

*归咎于先前的修订* [![在此处输入图像描述](https://i.stack.imgur.com/GlwkU.png)](https://i.stack.imgur.com/GlwkU.png)

# asp.net - 使用必填字段验证器更改文本框颜色。请不要扩展器控件

> ID：196859
> 
> 赞同：24
> 
> 时间：2008-10-13T06:35:18.700
> 
> 标签：asp.net, servercontrols, requiredfieldvalidator

每当单击提交按钮时触发其必填字段验证器时，我都需要更改 TextBox 的颜色

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-03-18T18:59:44.163

您可以做的是注册一个 Javascript 函数，该函数将在提交后遍历全局 Page_Validators 数组，您可以适当地设置背景。这样做的好处是您可以在页面上的所有控件上使用它。该函数如下所示：

```
function fnOnUpdateValidators()
{
   for (var i = 0; i < Page_Validators.length; i++)
   {
      var val = Page_Validators[i];
      var ctrl = document.getElementById(val.controltovalidate);
      if (ctrl != null && ctrl.style != null)
      {
         if (!val.isvalid)
            ctrl.style.background = '#FFAAAA';
         else
            ctrl.style.backgroundColor = '';
      }
   }
} 
```

最后一步是使用 OnSubmit 事件注册脚本：

VB.NET：

```
Page.ClientScript.RegisterOnSubmitStatement(Me.GetType, "val", "fnOnUpdateValidators();") 
```

C＃：

```
Page.ClientScript.RegisterOnSubmitStatement(this.GetType(), "val", "fnOnUpdateValidators();"); 
```

您将在后面的所有代码中保持正确的 IsValid 状态，并且它可以与您的所有控件一起使用。

*注意：我从[以下博客](http://codinglifestyle.wordpress.com/2009/09/16/change-background-color-of-invalid-controls-asp-net-validator/)中找到了这个解决方案。我只是想在源博客出现故障的情况下在这里记录它。*

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-08-14T14:13:27.747

您可以非常轻松地覆盖 ASP.NET 的更新已验证字段显示的 javascript 函数。这是一个不错的选择，因为您可以保留现有的字段验证器，而不必编写任何自定义验证逻辑或去寻找要验证的字段。在下面的示例中，我正在从具有类“控制组”的父元素中添加/删除一个“错误”类（因为我使用的是[twitter bootstrap css](http://twitter.github.com/bootstrap/base-css.html?#forms)）：

```
 /**
    * Re-assigns the ASP.NET validation JS function to
    * provide a more flexible approach
    */
    function UpgradeASPNETValidation() {
        if (typeof (Page_ClientValidate) != "undefined") {
            AspValidatorUpdateDisplay = ValidatorUpdateDisplay;
            ValidatorUpdateDisplay = NicerValidatorUpdateDisplay;
        }
    }

    /**
    * This function is called once for each Field Validator, passing in the 
    * Field Validator span, which has helpful properties 'isvalid' (bool) and
    * 'controltovalidate' (string = id of the input field to validate).
    */
    function NicerValidatorUpdateDisplay(val) {
        // Do the default asp.net display of validation errors (remove if you want)
        AspValidatorUpdateDisplay(val);

        // Add our custom display of validation errors
        if (val.isvalid) {
            // do whatever you want for invalid controls
            $('#' + val.controltovalidate).closest('.control-group').removeClass('error');
        } else {
            // reset invalid controls so they display as valid
            $('#' + val.controltovalidate).closest('.control-group').addClass('error');
        }
    }

    // Call UpgradeASPNETValidation after the page has loaded so that it 
    // runs after the standard ASP.NET scripts.
    $(document).ready(UpgradeASPNETValidation); 
```

[这是从这里](https://stackoverflow.com/a/125158/8479)稍微改编的，并从[这些](http://codingboynamedtracy.com/blog/asp-net-form-validation-with-jquery-part-1/) [文章](http://codingboynamedtracy.com/blog/asp-net-form-validation-with-jquery-part-2)中获得了有用的信息。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-13T08:17:17.027

您可以使用 CustomValidator 而不是 RequiredFieldValidator：

**.ASPX**

```
<asp:CustomValidator ID="CustomValidator1" runat="server" ErrorMessage=""
    ControlToValidate="TextBox1" ClientValidationFunction="ValidateTextBox"
    OnServerValidate="CustomValidator1_ServerValidate"
    ValidateEmptyText="True"></asp:CustomValidator>

<asp:TextBox ID="TextBox1" runat="server"></asp:TextBox>

<script src="jquery-1.2.6.js" type="text/javascript"></script>
<script type="text/javascript">
    function ValidateTextBox(source, args)
    {
        var is_valid = $("#TextBox1").val() != "";
        $("#TextBox1").css("background-color", is_valid ? "white" : "red");
        args.IsValid = is_valid;
    }
</script> 
```

**。CS**

```
protected void CustomValidator1_ServerValidate(object source, ServerValidateEventArgs args)
{
    bool is_valid = TextBox1.Text != "";
    TextBox1.BackColor = is_valid ? Color.White : Color.Red;
    args.IsValid = is_valid;
} 
```

客户端和服务器验证函数中的逻辑相同，但客户端函数使用 jQuery 访问文本框值并修改其背景颜色。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-09-15T22:40:50.547

聚会很晚，但以防万一其他人偶然发现这一点并想要一个与 Bootstrap 一起使用的完整答案，我已经采用了上面的所有示例，并制作了一个可以与附加到单个控件的多个验证器一起使用的版本，并将与验证组合作：

```
<script>
    /**
    * Re-assigns the ASP.NET validation JS function to
    * provide a more flexible approach
    */
    function UpgradeASPNETValidation() {
        if (typeof (Page_ClientValidate) != "undefined") {
            AspValidatorUpdateDisplay = ValidatorUpdateDisplay;
            ValidatorUpdateDisplay = NicerValidatorUpdateDisplay;
            AspValidatorValidate = ValidatorValidate;
            ValidatorValidate = NicerValidatorValidate;

            // Remove the error class on each control group before validating
            // Store a reference to the ClientValidate function
            var origValidate = Page_ClientValidate;
            // Override with our custom version
            Page_ClientValidate = function (validationGroup) {
                // Clear all the validation classes for this validation group
                for (var i = 0; i < Page_Validators.length; i++) {
                    if ((typeof(Page_Validators[i].validationGroup) == 'undefined' && !validationGroup) ||
                        Page_Validators[i].validationGroup == validationGroup) {
                        $("#" + Page_Validators[i].controltovalidate).parents('.form-group').each(function () {
                            $(this).removeClass('has-error');
                        });
                    }
                }
                // Call the original function
                origValidate(validationGroup);
            };
        }
    }

    /**
    * This function is called once for each Field Validator, passing in the 
    * Field Validator span, which has helpful properties 'isvalid' (bool) and
    * 'controltovalidate' (string = id of the input field to validate).
    */
    function NicerValidatorUpdateDisplay(val) {
        // Do the default asp.net display of validation errors (remove if you want)
        AspValidatorUpdateDisplay(val);

        // Add our custom display of validation errors
        // IF we should be paying any attention to this validator at all
        if ((typeof (val.enabled) == "undefined" || val.enabled != false) && IsValidationGroupMatch(val, AspValidatorValidating)) {
            if (!val.isvalid) {
                // Set css class for invalid controls
                var t = $('#' + val.controltovalidate).parents('.form-group:first');
                t.addClass('has-error');
            }
        }
    }

    function NicerValidatorValidate(val, validationGroup, event) {
        AspValidatorValidating = validationGroup;
        AspValidatorValidate(val, validationGroup, event);
    }

    // Call UpgradeASPNETValidation after the page has loaded so that it 
    // runs after the standard ASP.NET scripts.
    $(function () {
        UpgradeASPNETValidation();
    });
</script> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-10-12T13:08:24.053

我喜欢 Rory 的回答，但它不适用于 ValidationGroups，当然在我的例子中，我在一个字段上有两个验证器，由两个不同的按钮触发。

问题是如果ValidatorValidate不在当前的ValidationGroup中，ValidatorValidate会将它标记为'isValid'，但是我们的类更改代码并没有注意。这意味着显示不正确（当然IE9似乎不喜欢玩）。

所以为了解决这个问题，我做了以下更改：

```
 /**
    * Re-assigns the ASP.NET validation JS function to
    * provide a more flexible approach
    */
    function UpgradeASPNETValidation() {
        if (typeof (Page_ClientValidate) != "undefined") {
            AspValidatorUpdateDisplay = ValidatorUpdateDisplay;
            ValidatorUpdateDisplay = NicerValidatorUpdateDisplay;
            AspValidatorValidate = ValidatorValidate;
            ValidatorValidate = NicerValidatorValidate;
        }
    }

    /**
    * This function is called once for each Field Validator, passing in the 
    * Field Validator span, which has helpful properties 'isvalid' (bool) and
    * 'controltovalidate' (string = id of the input field to validate).
    */
    function NicerValidatorUpdateDisplay(val) {
        // Do the default asp.net display of validation errors (remove if you want)
        AspValidatorUpdateDisplay(val);

        // Add our custom display of validation errors
        // IF we should be paying any attention to this validator at all
        if ((typeof (val.enabled) == "undefined" || val.enabled != false) && IsValidationGroupMatch(val, AspValidatorValidating)) {
            if (val.isvalid) {
                // do whatever you want for invalid controls
                $('#' + val.controltovalidate).parents('.control-group:first').removeClass('error');
            } else {
                // reset invalid controls so they display as valid
                //$('#' + val.controltovalidate).parents('.control-group:first').addClass('error');
                var t = $('#' + val.controltovalidate).parents('.control-group:first');
                t.addClass('error');
            }
        }
    }

    function NicerValidatorValidate(val, validationGroup, event) {
        AspValidatorValidating = validationGroup;
        AspValidatorValidate(val, validationGroup, event);
    }

    // Call UpgradeASPNETValidation after the page has loaded so that it 
    // runs after the standard ASP.NET scripts.
    $(document).ready(UpgradeASPNETValidation); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-09-01T09:39:23.033

在 CSS 中：

```
 .form-control
        {
            width: 100px;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            color: black;
            background-color: white;
        }
        .form-control-Error
        {
            width: 100px;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            color: #EBB8C4;
            background-color: #F9F2F4
            border: 1px solid #DB7791;
            border-radius: 4px;
        } 
```

在您的页面中：

```
<asp:TextBox ID="txtUserName" runat="server" CssClass="form-control"></asp:TextBox>
 <asp:RequiredFieldValidatorrunat="server"Display="Dynamic" ErrorMessage="PLease Enter UserName" ControlToValidate="txtUserName"></asp:RequiredFieldValidator> 
```

在您上面的页面末尾

```
<script type="text/javascript">
    function WebForm_OnSubmit() {
        if (typeof (ValidatorOnSubmit) == "function" && ValidatorOnSubmit() == false) {
            for (var i in Page_Validators) {
                try {
                    var control = document.getElementById(Page_Validators[i].controltovalidate);
                    if (!Page_Validators[i].isvalid) {
                        control.className = "form-control-Error";
                    } else {
                        control.className = "form-control";
                    }
                } catch (e) { }
            }
            return false;
        }
        return true;
    }
</script> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-03-27T14:00:57.130

我喜欢亚历山大的回答，但希望 javascript 更通用。因此，这是一种使用自定义验证器的错误的通用方法。

```
 function ValidateTextBox(source, args) {
        var cntrl_id = $(source).attr("controltovalidate");
        var cntrl = $("#" + cntrl_id);
        var is_valid = $(cntrl).val() != "";
        is_valid ? $(cntrl).removeClass("error") : $(cntrl).addClass("error");

        args.IsValid = is_valid;
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-08-18T15:32:52.827

我知道这是旧的，但我有另一个来自 Dillie-O 和 Alexander 的修改组合。这使用带有 blur 事件的 jQuery 在验证成功时删除样式。

```
function validateFields() {
    try {
        var count = 0;
        var hasFocus = false;

        for (var i = 0; i < Page_Validators.length; i++) {
            var val = Page_Validators[i];
            var ctrl = document.getElementById(val.controltovalidate);

            validateField(ctrl, val);

            if (!val.isvalid) { count++; }
            if (!val.isvalid && hasFocus === false) {
                ctrl.focus(); hasFocus = true;
            }
        }

        if (count == 0) {
            hasFocus = false;
        }
    }
    catch (err) { }
}

function validateField(ctrl, val)
{
    $(ctrl).blur(function () { validateField(ctrl, val); });

    if (ctrl != null && $(ctrl).is(':disabled') == false) { // && ctrl.style != null
        val.isvalid ? $(ctrl).removeClass("error") : $(ctrl).addClass("error");
    }            

    if ($(ctrl).hasClass('rdfd_') == true) { //This is a RadNumericTextBox
        var rtxt = document.getElementById(val.controltovalidate + '_text');
        val.isvalid ? $(rtxt).removeClass("error") : $(rtxt).addClass("error");
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-31T07:26:52.857

另一种可能性...此代码为控件提供了一个红色边框（或您在 CSS 类中放置的任何内容）以进行验证（适用于下拉列表和文本框，但可以扩展为按钮等...）

首先，我使用**CustomValidator**而不是 RequiredFieldValidator，因为这样您就可以使用 CustomValidator 的**ClientValidationFunction**来更改要验证的控件的 CSS。

例如：当用户忘记填写时更改文本框 MyTextBox 的边框。MyTextBox 控件的 CustomValidator 如下所示：

```
<asp:CustomValidator ID="CustomValidatorMyTextBox" runat="server" ErrorMessage=""
     Display="None" ClientValidationFunction="ValidateInput" 
     ControlToValidate="MyTextBox" ValidateEmptyText="true" 
     ValidationGroup="MyValidationGroup">
     </asp:CustomValidator> 
```

或者它也可以用于需要选择的下拉列表。CustomValidator 看起来与上面相同，但 ControlToValidate 指向下拉列表。

对于客户端脚本，请使用 JQuery。ValidateInput 方法如下所示：

```
 <script type="text/javascript">
    function ValidateInput(source, args)
    {
        var controlName = source.controltovalidate;
        var control = $('#' + controlName);
        if (control.is('input:text')) {
            if (control.val() == "") {
                control.addClass("validation");
                args.IsValid = false;
            }
            else {
                control.removeClass("validation");
                args.IsValid = true;
            }
        }
        else if (control.is('select')) {
            if (control.val() == "-1"[*] ) {
                control.addClass("validation");
                args.IsValid = false;
            }
            else {
                control.removeClass("validation");
                args.IsValid = true;
            }
        }
    }
    </script> 
```

“validation”类是一个 CSS 类，它包含验证器被触发时的标记。它可能看起来像这样：

```
.validation { border: solid 2px red; } 
```

PS：要使边框颜色适用于 IE 中的下拉列表，请在页面标题中添加以下元标记：`<meta http-equiv="X-UA-Compatible" content="IE=edge" />`.

[*]这与RequiredFieldValidator 的“InitialValue”相同。这是用户尚未选择任何内容时默认选择的项目。​</p>

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-01T12:27:02.543

我也喜欢 Alexanders 和 Steves 的回答，但我想要和代码隐藏中的一样。我认为这段代码可能会这样做，但它会根据您的设置而有所不同。我的控件位于内容占位符内。

```
protected void cvPhone_ServerValidate(object source, ServerValidateEventArgs args)
{
    bool is_valid = !string.IsNullOrEmpty(args.Value);
    string control = ((CustomValidator)source).ControlToValidate;
    ((TextBox)this.Master.FindControl("ContentBody").FindControl(control)).CssClass = is_valid ? string.Empty : "inputError";
    args.IsValid = is_valid;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-11-26T14:25:31.517

另一种方式，

```
$(document).ready(function() {
    HighlightControlToValidate();
    $('#<%=btnSave.ClientID %>').click(function() {
        if (typeof (Page_Validators) != "undefined") {
            for (var i = 0; i < Page_Validators.length; i++) {
                if (!Page_Validators[i].isvalid) {
                    $('#' + Page_Validators[i].controltovalidate).css("background", "#f3d74f");
                }
                else {
                    $('#' + Page_Validators[i].controltovalidate).css("background", "white");
                }
            }
        }
    });
}); 
```

参考： http: [//www.codedigest.com/Articles/ASPNET/414_Highlight_Input_Controls_when_Validation_fails_in_AspNet_Validator_controls.aspx](http://www.codedigest.com/Articles/ASPNET/414_Highlight_Input_Controls_when_Validation_fails_in_AspNet_Validator_controls.aspx)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-03-19T10:07:32.123

我为常规的asp.net制作了一个有效的单页机示例，没有.control-group

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>

<!DOCTYPE html>
<!-- http://stackoverflow.com/questions/196859/change-text-box-color-using-required-field-validator-no-extender-controls-pleas -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script>
        /**
  * Re-assigns the ASP.NET validation JS function to
  * provide a more flexible approach
  */
        function UpgradeASPNETValidation() {
            if (typeof (Page_ClientValidate) != "undefined") {
                AspValidatorUpdateDisplay = ValidatorUpdateDisplay;
                ValidatorUpdateDisplay = NicerValidatorUpdateDisplay;
                AspValidatorValidate = ValidatorValidate;
                ValidatorValidate = NicerValidatorValidate;
            }
        }

        /**
        * This function is called once for each Field Validator, passing in the 
        * Field Validator span, which has helpful properties 'isvalid' (bool) and
        * 'controltovalidate' (string = id of the input field to validate).
        */
        function NicerValidatorUpdateDisplay(val) {
            // Do the default asp.net display of validation errors (remove if you want)
            AspValidatorUpdateDisplay(val);

            // Add our custom display of validation errors
            // IF we should be paying any attention to this validator at all
            if ((typeof (val.enabled) == "undefined" || val.enabled != false) && IsValidationGroupMatch(val, AspValidatorValidating)) {
                if (val.isvalid) {
                    // do whatever you want for invalid controls
                    $('#' + val.controltovalidate).removeClass('error');
                } else {
                    // reset invalid controls so they display as valid
                    //$('#' + val.controltovalidate).parents('.control-group:first').addClass('error');
                    var t = $('#' + val.controltovalidate);
                    t.addClass('error');
                }
            }
        }

        function NicerValidatorValidate(val, validationGroup, event) {
            AspValidatorValidating = validationGroup;
            AspValidatorValidate(val, validationGroup, event);
        }

        // Call UpgradeASPNETValidation after the page has loaded so that it 
        // runs after the standard ASP.NET scripts.
        $(document).ready(UpgradeASPNETValidation);
    </script>
    <style>
        .error {
            border: 1px solid red;
        }
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div>

        <asp:TextBox ID="TextBox1" runat="server" ></asp:TextBox>
        <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" ControlToValidate="TextBox1" ErrorMessage="RequiredFieldValidator"></asp:RequiredFieldValidator>
        <asp:Button ID="Button1" runat="server" Text="Button" />

        <br />
        <asp:TextBox ID="TextBox2" runat="server"></asp:TextBox>
        <asp:RegularExpressionValidator ID="RegularExpressionValidator1" runat="server" ControlToValidate="TextBox2" ErrorMessage="RegularExpressionValidator" ValidationExpression="\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*"></asp:RegularExpressionValidator>
        <br />
        <asp:TextBox ID="TextBox3" runat="server"></asp:TextBox>
        <asp:RangeValidator ID="RangeValidator1" runat="server" ControlToValidate="TextBox3" ErrorMessage="RangeValidator" MaximumValue="100" MinimumValue="0"></asp:RangeValidator>

    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-05-30T11:00:06.760

并非完全没有改变用户习惯的控件，但我认为这种方式更容易（不写完整的例子，我认为没有必要）：

ASP.NET：

```
 <asp:TextBox ID="TextBox1" runat="server" ></asp:TextBox>
    <asp:CustomValidator runat="server" ControlToValidate="TextBox1" Display="Dynamic" Text="TextBox1 Not Set" ValidateEmptyText="true" OnServerValidate="ServerValidate" />
    <asp:Button ID="Button1" runat="server" Text="Button" OnClick="Execute" /> 
```

代码：

```
protected void Execute(object sender, EventArgs e)
{
   Page.Validate();
   if (Page.IsValid)
   {
       *some code*
   }
}

protected void ServerValidate(object source, ServerValidateEventArgs args)
{
    CustomValidator cval = source as CustomValidator;
    if (cval == null)
    {
        args.IsValid = false;
        return;
    }

    if (string.IsNullOrEmpty(args.Value))
    {
        args.IsValid = false;
        string _target = cval.ControlToValidate;
        TextBox tb = cval.Parent.FindControl(_target) as TextBox;
        tb.BorderColor = System.Drawing.Color.Red;
    }
    else
    {
        args.IsValid = true;
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-13T07:27:31.153

这里有一些独立的 HTML/JS 可以解决问题：

```
<html>
  <head>
    <script type="text/javascript">
      function mkclr(cntl,clr) {
        document.getElementById(cntl).style.backgroundColor = clr;
      };
    </script>
  </head>
  <body>
    <form>
      <input type="textbox" id="tb1"></input>
      <input type="submit" value="Go"
        onClick="javascript:mkclr('tb1','red');">
      </input>
    </form>
  </body>
</html> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-03-04T11:49:17.443

我必须对史蒂夫的建议进行一些修改才能让我的工作正常，

```
 function ValidateTextBox(source, args) {
    var controlId = document.getElementById(source.controltovalidate).id;
    var control = $("#" + controlId);
    var value = control.val();
    var is_valid = value != "";
    is_valid ? control.removeClass("error") : control.addClass("error");
    args.IsValid = is_valid;
  } 
```

很好的例子，正是我需要的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-03-26T13:57:34.857

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Custemvalidatin.aspx.cs" Inherits="AspDotNetPractice.Custemvalidatin" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script type="text/javascript">
        function vali(source, args) {
            if (document.getElementById(source.controltovalidate).value.length > 0) {
                args.IsValid = true;
                document.getElementById(source.controltovalidate).style.borderColor = 'green';
            }
            else {
                args.IsValid = false;
                document.getElementById(source.controltovalidate).style.borderColor = 'red';
            }

        }
    </script>
</head>
<body>
    <form id="form1" runat="server">
        <div>
            <asp:TextBox ID="TextBox1" Style="border:1px solid gray; width:270px; height:24px ; border-radius:6px;"   runat="server"></asp:TextBox>

            <asp:CustomValidator ID="CustomValidator1" runat="server" ControlToValidate="TextBox1"
                ErrorMessage="Enter First Name" SetFocusOnError="True" Display="Dynamic" ClientValidationFunction="vali" 
                ValidateEmptyText="True" Font-Size="Small" ForeColor="Red">Enter First Name</asp:CustomValidator><br /><br /><br />

            <asp:TextBox ID="TextBox2" Style="border:1px solid gray; width:270px; height:24px ; border-radius:6px;"  runat="server"></asp:TextBox>

            <asp:CustomValidator ID="CustomValidator2" runat="server" ClientValidationFunction="vali"
                ControlToValidate="TextBox2" Display="Dynamic" ErrorMessage="Enter Second Name"
                SetFocusOnError="True" ValidateEmptyText="True" Font-Size="Small" ForeColor="Red">Enter Second Name</asp:CustomValidator><br />
            <br />
            <br />

            <asp:Button ID="Button1" runat="server" Text="Button" />
        </div>
    </form>
</body>
</html> 
```

# python - 有没有更好的方法在 Python 中获取命名的一系列常量（枚举）？

> ID：196876
> 
> 赞同：21
> 
> 时间：2008-10-13T06:43:47.230
> 
> 标签：python

只是看看在 python 中获取命名常量的方法。

```
class constant_list:
    (A_CONSTANT, B_CONSTANT, C_CONSTANT) = range(3) 
```

那么你当然可以这样引用它：

```
constant_list.A_CONSTANT 
```

我想你可以使用字典，使用字符串：

```
constant_dic = {
    "A_CONSTANT" : 1,
    "B_CONSTANT" : 2,
    "C_CONSTANT" : 3,} 
```

并像这样引用它：

```
constant_dic["A_CONSTANT"] 
```

* * *

那么，我的问题很简单。有没有更好的方法来做到这一点？不是说这些是不够的或任何东西，只是好奇 - 我错过了任何其他常见的成语吗？

提前致谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-13T06:48:48.423

对于 2.3 或更高版本：

```
class Enumerate(object):
  def __init__(self, names):
    for number, name in enumerate(names.split()):
      setattr(self, name, number) 
```

要使用：

```
 codes = Enumerate('FOO BAR BAZ') 
```

`codes.BAZ`将是 2 等等。

如果您只有 2.2，请在此之前添加：

```
 from __future__ import generators

 def enumerate(iterable):
   number = 0
   for name in iterable:
     yield number, name
     number += 1 
```

（*这是取自[这里](http://www.velocityreviews.com/forums/t322211-enum-in-python.html)*）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T06:48:36.503

我发现枚举类配方（Active State，[Python Cookbook](http://code.activestate.com/recipes/67107/)）非常有效。

另外它有一个很好的查找功能。

佩夫

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T06:55:39.390

constant_dic 的另一种构造：

```
constants = ["A_CONSTANT", "B_CONSTANT", "C_CONSTANT"]
constant_dic = dict([(c,i) for i, c in enumerate(constants)]) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-13T16:02:05.623

下面的行为就像一个经典的“写在石头上”的 C 枚举——一旦定义，你就不能改变它，你只能读取它的值。你也不能实例化它。您所要做的就是“导入 enum.py”并从 Enum 类派生。

```
# this is enum.py
class EnumException( Exception ):
   pass

class Enum( object ):
   class __metaclass__( type ):
      def __setattr__( cls, name, value ):
         raise EnumException("Can't set Enum class attribute!")
      def __delattr__( cls, name ):
         raise EnumException("Can't delete Enum class attribute!")

   def __init__( self ):
      raise EnumException("Enum cannot be instantiated!") 
```

这是测试代码：

```
# this is testenum.py
from enum import *

class ExampleEnum( Enum ):
   A=1
   B=22
   C=333

if __name__ == '__main__' :

   print "ExampleEnum.A |%s|" % ExampleEnum.A
   print "ExampleEnum.B |%s|" % ExampleEnum.B
   print "ExampleEnum.C |%s|" % ExampleEnum.C
   z = ExampleEnum.A
   if z == ExampleEnum.A:
      print "z is A"

   try:
       ExampleEnum.A = 4   
       print "ExampleEnum.A |%s| FAIL!" % ExampleEnum.A
   except EnumException:
       print "Can't change Enum.A (pass...)"

   try:
       del ExampleEnum.A
   except EnumException:
       print "Can't delete Enum.A (pass...)"

   try:
       bad = ExampleEnum()
   except EnumException:
       print "Can't instantiate Enum (pass...)" 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-18T02:17:01.203

这是我见过的最好的：“Python 中的第一类枚举”

[http://code.activestate.com/recipes/413486/](http://code.activestate.com/recipes/413486/)

它为您提供了一个类，该类包含所有枚举。枚举可以相互比较，但没有任何特定的价值；您不能将它们用作整数值。（我一开始反对这个，因为我习惯了 C 枚举，它们是整数值。但是如果你不能将它用作整数，你不能将它*错误地*用作整数所以总的来说我认为这是一个胜利.) 每个枚举都是一个唯一的对象。您可以打印枚举，可以迭代它们，可以测试枚举值是否“在”枚举中。它非常完整和光滑。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-13T07:17:07.337

在 Python 中，字符串是不可变的，因此它们更适合用于常量而不是数字。在我看来，最好的方法是创建一个将常量保存为字符串的对象：

```
class Enumeration(object):
    def __init__(self, possibilities):
        self.possibilities = set(possibilities.split())

    def all(self):
        return sorted(self.possibilities)

    def __getattr__(self, name):
        if name in self.possibilities:
            return name
        raise AttributeError("Invalid constant: %s" % name) 
```

然后你可以像这样使用它：

```
>>> enum = Enumeration("FOO BAR")
>>> print enum.all()
['BAR', 'FOO']
>>> print enum.FOO
FOO
>>> print enum.FOOBAR
Traceback (most recent call last):
  File "enum.py", line 17, in <module>
    print enum.FOOBAR
  File "enum.py", line 11, in __getattr__
    raise AttributeError("Invalid constant: %s" % name)
AttributeError: Invalid constant: FOOBAR 
```

# asp.net - ASP.net 页面生命周期

> ID：196883
> 
> 赞同：1
> 
> 时间：2008-10-13T06:50:21.617
> 
> 标签：asp.net

我的页面中有一个 ASP.net 页面，我将其作为我的代码隐藏文件。在第一次访问页面时会调用页面 preinit、init、load 方法。在回发时调用 preinit、init、load 方法。

我的问题是 LoadViewstate 和控制状态事件（重写方法）在回发后也没有触发

```
protected override void OnPreInit(EventArgs e)
{
    base.OnPreInit(e);
}
protected override void LoadViewState(object savedState)
{

    base.LoadViewState(savedState);

}

protected override void LoadControlState(object savedState)
{
    base.LoadControlState(savedState);
}
protected void Page_Init(object sender, EventArgs e)
{

}
protected void Page_Load(object sender, EventArgs e)
{
  //  lblName.Text = ViewState["Test"].ToString();
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T07:01:52.077

> 此方法主要由 .NET Framework 基础结构使用，不打算直接从您的代码中使用。但是，控件开发人员可以重写此方法来指定自定义服务器控件如何恢复其视图状态。有关详细信息，请参阅 ASP.NET 状态管理概述。
> 
> LoadViewState 方法恢复在先前的 SaveViewState 请求期间保存的视图状态信息。WebControl 类重写了基本的 LoadViewState 方法来处理 ViewState、Style 和 Attributes 属性。

另请注意

> 控件状态 有时您需要存储控件状态数据以使控件正常工作。例如，如果您编写了一个自定义控件，该控件具有显示不同信息的不同选项卡，为了使该控件按预期工作，控件需要知道在往返之间选择了哪个选项卡。ViewState 属性可用于此目的，**但开发人员可以在页面级别关闭视图状态，从而有效地破坏您的控制。**为了解决这个问题，ASP.NET 页面框架在 ASP.NET 中公开了一个称为控制状态的功能。
> 
> ControlState 属性允许您保留特定于控件的属性信息，并且不能像 ViewState 属性那样关闭。

[Asp.Net 状态管理链接](http://msdn.microsoft.com/en-us/library/75x4ha6s.aspx)

如果您的控件是客户服务器控件，请查看

[iStateManager](http://msdn.microsoft.com/en-us/library/system.web.ui.istatemanager(VS.80).aspx)

对于视图状态的完整概述 - 必须搜索我的书签尝试

[真正理解视图状态](http://weblogs.asp.net/infinitiesloop/archive/2006/08/03/truly-understanding-viewstate.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T07:08:07.743

ASP.NET 优化了这个调用，并且仅当有任何自定义数据写入视图状态时才调用 LoadViewState。

如果您在第一次调用中将某些内容设置为视图状态（例如 ViewState["foo"] = 42;），则 LoadViewState 将在下一个（以及后续）回调中调用。

# matlab - 在 32 位或 64 位 matlab 上运行？

> ID：196885
> 
> 赞同：7
> 
> 时间：2008-10-13T06:52:36.887
> 
> 标签：matlab, 64-bit, 32-bit

如何确定我是在 32 位还是 64 位版本的 matlab 上运行？

我有一些预编译的 mex 文件，它们需要不同的路径，具体取决于 32/64 位 matlab。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T13:36:08.193

32 位与 64 位的问题确实是一个红鲱鱼。如果我理解正确，您想确定需要哪组已编译的 MEX 文件，以便您可以适当地设置路径。为此，您可以使用以下功能`mexext`：

```
>> help mexext
 MEXEXT MEX filename extension for this platform, or all platforms. 
    EXT = MEXEXT returns the MEX-file name extension for the current
    platform. 

    ALLEXT = MEXEXT('all') returns a struct with fields 'arch' and 'ext' 
    describing MEX-file name extensions for all platforms.

    There is a script named mexext.bat on Windows and mexext.sh on UNIX
    that is intended to be used outside MATLAB in makefiles or scripts. Use
    that script instead of explicitly specifying the MEX-file extension in
    a makefile or script. The script is located in $MATLAB\bin.

    See also MEX, MEXDEBUG. 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-18T11:53:10.120

接受 ScottieT812 和 dwj 的建议，我发布了自己的解决方案来获得一些积分。

该函数`computer`返回我正在运行的架构。所以：

```
switch computer
    case 'GLNX86'
        display('32-bit stuff')
    case 'GLNXA64'
        display('64-bit stuff')
    otherwise
        display('Not supported')
end 
```

为我工作

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-15T23:44:31.523

这真的有效吗？你用的是哪个版本的matlab？

据我所知，64 位平台以“64”而不是 86 结尾。从 matlab 网站 [http://www.mathworks.com/access/helpdesk/help/techdoc/ref/computer.html](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/computer.html)我不知道认为计算机将永远返回 GLNXA86 但 GLNXA64 。

所以这个问题特定于 GNU Linux 32 位或 64 位版本。

如果您正在测试任何 64 位平台，那么您可能需要测试最后 2 个字符以找到“64”，即类似

```
if regexp(computer,'..$','match','64'),
   % setup 64bit options
else,
   % 32bit options
end 
```

# java - Java2D 性能问题

> ID：196890
> 
> 赞同：60
> 
> 时间：2008-10-13T06:57:08.030
> 
> 标签：java, java-2d

我在使用 Java2D 时遇到了性能异常。我知道 sun.java2d.opengl VM 参数可以为 2D 启用 3D 加速，但即使使用它也有一些奇怪的问题。

以下是我运行的测试结果：

在 JComponent Image 1 = .bmp 格式，Image 2 = A .png 格式上绘制具有 32x32 像素图块的 25x18 地图

## 没有 -Dsun.java2d.opengl=true

120 FPS 使用 .BMP 图像 1
13 FPS 使用 .PNG 图像 2

## 使用 -Dsun.java2d.opengl=true

12 FPS 使用 .BMP 图像 1
700 FPS 使用 .PNG 图像 2

如果没有加速，我假设我在软件中执行的每个 drawImage() 都会发生某种转换，并且在 .PNG 的情况下会大大降低 FPS。但是，为什么随着加速，结果会发生变化（而且 PNG 实际上执行得更快）？！疯狂！

.BMP 图像 1 被转换为 TYPE_INT_RGB 的图像类型。.PNG 图像 2 被转换为 TYPE_CUSTOM 的图像类型。为了在使用和不使用 opengl 加速的情况下获得一致的速度，我必须创建一个图像类型为 TYPE_INT_ARGB 的新 BufferedImage，并将图像 1 或图像 2 绘制到这个新图像上。

以下是运行的结果：

## 没有 -Dsun.java2d.opengl=true

120 FPS 使用 .BMP 图像 1
120 FPS 使用 .PNG 图像 2

## 使用 -Dsun.java2d.opengl=true

700 FPS 使用 .BMP 图像 1
700 FPS 使用 .PNG 图像 2

我真正的问题是，我可以假设 TYPE_INT_ARGB 将是所有系统和平台的本机图像类型吗？我假设这个值可能不同。有没有办法让我获得本机值，以便我总是可以创建新的 BufferedImages 以获得最佳性能？

提前致谢...

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-13T09:04:29.147

我想我通过研究和整理来自太多 Google 搜索的点点滴滴找到了解决方案。

在这里，评论和所有：

```
private BufferedImage toCompatibleImage(BufferedImage image)
{
    // obtain the current system graphical settings
    GraphicsConfiguration gfxConfig = GraphicsEnvironment.
        getLocalGraphicsEnvironment().getDefaultScreenDevice().
        getDefaultConfiguration();

    /*
     * if image is already compatible and optimized for current system 
     * settings, simply return it
     */
    if (image.getColorModel().equals(gfxConfig.getColorModel()))
        return image;

    // image is not optimized, so create a new image that is
    BufferedImage newImage = gfxConfig.createCompatibleImage(
            image.getWidth(), image.getHeight(), image.getTransparency());

    // get the graphics context of the new image to draw the old image on
    Graphics2D g2d = newImage.createGraphics();

    // actually draw the image and dispose of context no longer needed
    g2d.drawImage(image, 0, 0, null);
    g2d.dispose();

    // return the new optimized image
    return newImage; 
} 
```

在我之前的帖子中，GraphicsConfiguration 保存了在系统上创建优化图像所需的信息。它似乎工作得很好，但我原以为 Java 会自动为你做这件事。显然你不能对 Java 感到太舒服。:) 我想我最终回答了我自己的问题。哦，好吧，希望它能帮助你们中的一些人，我见过尝试将 Java 用于 2D 游戏。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-02-10T04:17:58.793

好吧，这是一篇旧文章，但我想分享一下我对使用 Swing/AWT 直接绘图的发现，而无需使用 BufferedImage。

**直接绘制到int[]**缓冲区时，某些类型的绘图（如 3D）会更好。完成图像后，您可以使用**ImageProducer**实例（如**MemoryImageSource**）来生成图像。我假设您知道如何直接执行绘图，而无需 Graphics/Graphics2 的帮助。

```
 /**
* How to use MemoryImageSource to render images on JPanel
* Example by A.Borges (2015)
*/
public class MyCanvas extends JPanel implements Runnable {

public int pixel[];
public int width;
public int height;
private Image imageBuffer;   
private MemoryImageSource mImageProducer;   
private ColorModel cm;    
private Thread thread;

public MyCanvas() {
    super(true);
    thread = new Thread(this, "MyCanvas Thread");
}

/**
 * Call it after been visible and after resizes.
 */
public void init(){        
    cm = getCompatibleColorModel();
    width = getWidth();
    height = getHeight();
    int screenSize = width * height;
    if(pixel == null || pixel.length < screenSize){
        pixel = new int[screenSize];
    }        
    mImageProducer =  new MemoryImageSource(width, height, cm, pixel,0, width);
    mImageProducer.setAnimated(true);
    mImageProducer.setFullBufferUpdates(true);  
    imageBuffer = Toolkit.getDefaultToolkit().createImage(mImageProducer);        
    if(thread.isInterrupted() || !thread.isAlive()){
        thread.start();
    }
}
/**
* Do your draws in here !!
* pixel is your canvas!
*/
public /* abstract */ void render(){
    // rubisch draw
    int[] p = pixel; // this avoid crash when resizing
    if(p.length != width * height) return;        
    for(int x=0; x < width; x++){
        for(int y=0; y<height; y++){
            int color =  (((x + i) % 255) & 0xFF) << 16; //red
                color |= (((y + j) % 255) & 0xFF) <<  8; //green
                color |= (((y/2 + x/2 - j) % 255) & 0xFF) ;   //blue         
            p[ x + y * width] = color;
        }
    }        
    i += 1;
    j += 1;          
}    
private int i=1,j=256;

@Override
public void run() {
    while (true) {
        // request a JPanel re-drawing
        repaint();                                  
        try {Thread.sleep(5);} catch (InterruptedException e) {}
    }
}

@Override
public void paintComponent(Graphics g) {
    super.paintComponent(g);
    // perform draws on pixels
    render();
    // ask ImageProducer to update image
    mImageProducer.newPixels();            
    // draw it on panel          
    g.drawImage(this.imageBuffer, 0, 0, this);  
}

/**
 * Overrides ImageObserver.imageUpdate.
 * Always return true, assuming that imageBuffer is ready to go when called
 */
@Override
public boolean imageUpdate(Image image, int a, int b, int c, int d, int e) {
    return true;
}
}// end class 
```

**请注意，我们需要MemoryImageSource**和**Image**的唯一实例。不要为每个帧创建新的 Image 或新的 ImageProducer，除非您调整了 JPanel 的大小。请参见上面的**init()**方法。

在渲染线程中，询问**repaint()**。在 Swing 上，**repaint()**将调用被覆盖的**paintComponent()**，它会调用您的**render()**方法，然后要求您的 imageProducer 更新图像。**完成 Image 后，使用Graphics.drawImage()**绘制它。

要获得兼容的 Image，请在创建**Image时使用正确的****ColorModel**。我使用**GraphicsConfiguration.getColorModel()**：

 ****```
/**
 * Get Best Color model available for current screen.
 * @return color model
 */
protected static ColorModel getCompatibleColorModel(){        
    GraphicsConfiguration gfx_config = GraphicsEnvironment.
            getLocalGraphicsEnvironment().getDefaultScreenDevice().
            getDefaultConfiguration();        
    return gfx_config.getColorModel();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T07:01:43.793

我记得当我考虑用 Java 进行图形编程时，内置库很慢。我在 GameDev.Net 上被告知，任何做严肃事情的人都必须使用类似[jogl的东西](http://jogl.dev.java.net/)

# windows - 锁定执行文件：Windows 有，Linux 没有。为什么？

> ID：196897
> 
> 赞同：87
> 
> 时间：2008-10-13T07:05:58.077
> 
> 标签：windows, linux, operating-system, filesystems, locking

我注意到在 Windows 上执行文件（.exe 或 .dll）时，它被锁定并且无法删除、移动或修改。

另一方面，Linux 不会锁定正在执行的文件，您*可以*删除、移动或修改它们。

为什么 Windows 会锁定而 Linux 不锁定？锁定有优势吗？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-13T07:18:01.657

Linux 有一个引用计数机制，所以你可以在文件执行时删除它，只要某个进程（之前打开它的）有一个打开的句柄，它就会继续存在。当您删除该文件时，该文件的目录条目将被删除，因此无法再打开它，但已经使用该文件的进程仍然可以使用它。一旦使用该文件的所有进程终止，该文件将被自动删除。

Windows 没有此功能，因此它被迫锁定文件，直到从它执行的所有进程都完成。

我相信 Linux 的行为更可取。可能有一些深层的架构原因，但我发现最引人注目的主要（也是简单）原因是，在 Windows 中，您有时无法删除文件，您不知道为什么，而您所知道的只是某些进程将其保留在利用。在 Linux 中它永远不会发生。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-13T07:19:06.847

据我所知，linux在运行时*确实会*锁定可执行文件——但是，它会锁定[inode](http://en.wikipedia.org/wiki/Inode)。这意味着您可以删除“文件”，但 inode 仍然在文件系统上，未受影响，您真正删除的只是一个链接。

Unix 程序一直使用这种思考文件系统的方式，创建一个临时文件，打开它，删除名称。您的文件仍然存在，但名称已释放供其他人使用，其他人无法看到它。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-30T10:51:39.140

Linux确实锁定了文件。如果您尝试覆盖正在执行的文件，您将收到“ETXTBUSY”（文本文件忙）。但是，您可以删除该文件，并且内核将在删除最后一次对该文件的引用时删除该文件。（如果机器没有完全关闭，这些文件是检查文件系统时“Deleted inode has zero d-time”消息的原因，它们没有被完全删除，因为正在运行的进程有对它们的引用，现在他们是。）

这有一些主要优点，您可以升级正在运行的进程，方法是删除可执行文件，替换它，然后重新启动进程。甚至 init 也可以像这样升级，替换可执行文件，并向它发送信号，它会自己重新执行（），而无需重新启动。（这通常由您的包管理系统自动完成，作为升级的一部分）

在 Windows 下，替换正在使用的文件似乎很麻烦，通常需要重新启动以确保没有进程正在运行。

可能会有一些问题，例如，如果您有一个非常大的日志文件，并且您将其删除，但忘记告诉正在记录到该文件的进程重新打开该文件，它将保留引用，您会想知道为什么您的磁盘没有突然获得更多可用空间。

你也可以在 linux 下使用这个技巧来处理临时文件。打开文件，将其删除，然后继续使用该文件。当您的进程退出时（无论出于何种原因 - 甚至断电），该文件都将被删除。

lsof 和 fuser 之类的程序（或者只是在 /proc//fd 中查看）可以显示哪些进程打开了不再有名称的文件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-13T09:46:20.840

我认为你对 Windows 太绝对了。通常，它不会为可执行文件的代码部分分配交换空间。相反，它会锁定可执行文件和 DLL。如果再次需要丢弃的代码页，只需重新加载它们。但是使用 /SWAPRUN，这些页面被保存在交换中。这用于 CD 或网络驱动器上的可执行文件。因此，windows 不需要锁定这些文件。

对于 .NET，请查看[Shadow Copy](http://blogs.msdn.com/junfeng/archive/2004/02/09/69919.aspx)。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-13T07:14:24.860

我认为 linux / unix 不使用相同的锁定机制，因为它们是作为多用户系统从头开始构建的——这可能会导致多个用户使用同一个文件，甚至可能出于不同的目的。

锁定有优势吗？好吧，它可能会减少操作系统必须管理的指针数量，但现在节省的数量几乎可以忽略不计。我能想到的锁定的最大优势是：您可以节省一些用户可见的歧义。如果用户 a 正在运行一个二进制文件，而用户 b 将其删除，则实际文件必须保留，直到用户 A 的进程完成。然而，如果用户 B 或任何其他用户在文件系统上查找它，他们将无法找到它 - 但它会继续占用空间。对我来说并不是一个大问题。

我认为在很大程度上这更多是关于与窗口文件系统的向后兼容性的问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-05-16T08:39:03.230

是否应该锁定文件中执行的代码是设计决定，MS 只是决定锁定，因为它在实践中具有明显的优势：这样您就不需要知道哪个应用程序使用哪个版本的哪个代码。这是 Linux 默认行为的一个主要问题，大多数人都忽略了这一点。如果系统范围的库被替换，您将无法轻易知道哪些应用程序使用此类库的代码，大多数情况下您能得到的最好的结果是包管理器知道这些库的一些用户并重新启动它们。但这仅适用于一般且众所周知的事物，例如 Postgres 及其库等。更有趣的场景是，如果您针对某些 3rd 方库开发自己的应用程序并且这些库被替换，因为大多数时候包管理器根本不知道您的应用程序。然后' s 不仅是本机 C 代码等的问题，它几乎可以发生在任何事情上：只需使用带有 mod_perl 的 httpd 和使用包管理器安装的一些 Perl 库，然后让包管理器出于任何原因更新这些 Perl 库。它不会重新启动您的 httpd，只是因为它不知道依赖项。有很多这样的例子，仅仅是因为任何文件都可能包含任何运行时在内存中使用的代码，想想 Java、Python 和所有这些东西。

所以有一个很好的理由认为默认锁定文件可能是一个不错的选择。不过，您无需同意这些理由。

那么MS做了什么？他们只是创建了一个 API，让调用应用程序有机会决定是否应该锁定文件，但他们决定此 API 的默认值是为第一个调用应用程序提供排他锁。[查看有关CreateFile](https://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx)及其`dwShareMode`参数的 API 。这就是为什么您可能无法删除某些应用程序正在使用的文件的原因，它根本不关心您的用例，使用默认值，因此获得了 Windows 对文件的排他锁。

请不要相信有人告诉你一些关于 Windows 不使用 HANDLE 的引用计数或不支持硬链接等的事情，这是完全错误的。几乎每个使用 HANDLE 的 API 都记录了它关于引用计数的行为，您可以轻松地阅读几乎所有关于 NTFS 的文章，它确实支持硬链接并且一直支持。从 Windows Vista 开始，它也支持符号链接，并且通过提供 API 来[读取给定文件的所有内容](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364421%28v=vs.85%29.aspx)等，改进了对硬链接的支持。

此外，您可能只是想看看[Ext4中用于描述文件的结构与](https://ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout#Directory_Entries)[NTFS](https://msdn.microsoft.com/en-us/library/windows/desktop/hh920930(v=vs.85).aspx)中的结构相比，它们有很多共同点。两者都使用范围的概念，它将数据与文件名等属性分开，而索引节点几乎只是一个较旧但类似概念的另一个名称。[甚至 Wikipedia 在其文章](http://en.wikipedia.org/wiki/Extent_%28file_systems%29)中也列出了这两种文件系统。

与网络上的其他操作系统相比，Windows 中的文件锁定确实有很多 FUD，就像碎片整理一样。[只需在Wikipedia](http://en.wikipedia.org/wiki/File_locking)上阅读一些内容，就可以排除其中一些 FUD 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T09:11:16.340

NT 变体具有

打开文件

命令，它将显示哪些进程对哪些文件有句柄。但是，它确实需要启用系统全局标志“维护对象列表”

打开文件/本地/？

告诉您如何执行此操作，并且这样做会导致性能损失。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-21T18:00:47.857

可执行文件在运行时逐渐映射到内存。这意味着可执行文件的某些部分根据需要加载。如果在映射所有部分之前换出文件，则可能会导致严重的不稳定。

# sql - 使用 Visual Studio 2008 编辑 SQL 查询

> ID：196909
> 
> 赞同：2
> 
> 时间：2008-10-13T07:18:18.333
> 
> 标签：sql, visual-studio, editor

请您推荐我使用 Visual Studio 2008 Professional 编辑 SQL 查询的最佳方法吗？

我知道我可以从服务器资源管理器的上下文菜单中打开查询窗口并在 SQL 窗格中编辑文本。但不幸的是，我不允许将查询保存到文件中，并且查找和替换命令在那里不起作用。

或者，我可以在 Visual Studio 编辑器中打开扩展名为 .SQL 的文本文件，以获得语法突出显示和完整的编辑功能，但失去执行脚本的可能性。

现在我将查询文本从一个窗口复制到另一个窗口并返回，但我希望有更好的解决方案。

非常感谢您的建议！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-01T11:29:33.737

当我必须连接到 Sql Server 时，我会使用 NetBeans，因为它具有许多功能，使其比 Visual Studio 更易于使用。其中之一是智能感知，当您有一个表名的别名和许多长字段名时，它非常有用。在 NetBeans 中，连接和连接池的一般处理也更加简洁。我可以继续，但建议自己尝试一下。您几乎肯定需要 Sql Server jdbc 驱动程序，可以从[http://msdn.microsoft.com/en-us/data/aa937724.aspx下载](http://msdn.microsoft.com/en-us/data/aa937724.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T07:24:34.327

哇，你是对的，这是一个真正的痛苦。您是否可以使用 SQL Management Studio 的本地副本（名称可能有误）？您将在 VS 之外，但您仍然可以编辑查询并同时运行它。绝对不是最佳的，但总比没有好。

祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T18:52:00.873

如果在 Visual Studio 的解决方案中创建数据库项目，则可以为该项目设置默认数据库连接。然后可以针对该连接执行数据库项目中包含的任何 *.sql 文件。我通常做的是选择要执行的文本并右键单击它，然后选择“运行选择”。

您可以在解决方案资源管理器的“数据库引用”节点下设置任意数量的数据库连接，然后选择要对其运行查询的连接。

# wiki - 哪个 wiki 会让我在单击其链接时动态创建一个页面？

> ID：196913
> 
> 赞同：3
> 
> 时间：2008-10-13T07:23:34.047
> 
> 标签：wiki, mediawiki, coredump

对于我正在开发的应用程序 (*)，我需要动态生成的页面和静态页面的混合。使用 wiki 会很酷，这样一旦第一次访问动态页面，它就会变成一个静态页面，用户可以像任何其他静态 wiki 页面一样对其进行注释。

换句话说，我想用 a) 生成 wiki 格式的新内容并将其存储在数据库中，然后 b) 解析并显示该文本.

哦，这应该是递归的——创建的页面可能有链接到更动态生成的页面等等。

我将根据其名称生成动态页面（包括任意深度的类别/命名空间信息）。

最后一件事 - 通过批处理脚本预先创建一些动态页面也很好（但不是必需的）（主要是为了性能，因为这些页面可能需要一些时间来生成）。

所以我的问题是哪个 wiki 软件最容易修改/编写插件来做到这一点？

(*) 想象一个 coredump 分析器（想想 gdb），您会看到一个转储列表（可能存储在某个远程机器上）。您单击转储，它会为您提供线程列表。您单击一个线程，它会为您提供堆栈。您单击堆栈帧，它会显示内存。您单击一个内存字，它会显示该地址处的内存页面，依此类推。

当您浏览转储时，您会添加有关您发现的问题的注释，以便以后为您提供帮助或与可能也在查看转储的同事分享。

几个月后，转储可能已经从远程机器上消失了（需要大量空间来归档所有这些转储），但现在您遇到了类似的问题。您将最近转储中的堆栈跟踪中的一个函数名称输入到 wiki 搜索框中，然后检索有关上一次事件的保存信息。

更新：感谢所有答案。我实际上可能会选择 MediaWiki。看起来我可以创建一个[ArticleViewHeader 扩展](http://www.mediawiki.org/wiki/Category:ArticleViewHeader_extensions)，然后可以调用[doEdit](http://organicdesign.co.nz/MediaWiki_code_snippets#Edit_or_create)来创建页面（如果它尚不存在）。有一个[VirtualPage 扩展](http://www.mediawiki.org/wiki/Extension:VirtualPage)似乎可以做类似的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-13T07:37:57.607

我已经看到用[pmwiki](http://www.pmwiki.org/)完成了这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T08:46:50.150

[透视](http://www.high-beyond.com/perspective.aspx?action=view&page=perspective:Welcome)是另一种。这是一个基于 .Net 的开源 wiki。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T08:16:04.987

我觉得[tiddlyWiki](http://www.tiddlywiki.com/)相当有趣

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T10:44:55.530

[Trac](http://trac.edgewall.org)也这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-25T20:24:56.170

Tiddlywiki 是最好的 wiki 之一。以下是如何以编程方式创建一个整洁的

```
var t=store.createTiddler("你好")
如果（！t）返回假；
var txt=t.text+"要 apdsdsddpend 的东西";
var who=config.options.txt用户名；
var when=new Date();
store.saveTiddler(t.title,t.title,txt,who,when,t.tags,t.fields);
```

这将创建一个新的 tiddly，名称为 hello，内容为 ap...

如果您想在添加上述文本后以编辑模式打开 tiddler，请添加此代码

```
     var 标题 = 注释标题；
     story.displayTiddler(null, title);
     config.commands.editTiddler.handler(null, null, title);

```

希望能帮助到你。

tiddywiki 也接受查询字符串

示例： [http](http://www.tiddlywiki.com/#open:HelloThere) ://www.tiddlywiki.com/#open:HelloThere open:title 打开具有指定标题的 tiddler start:safe 切换到安全模式 search:text 搜索指定的文本 tag:text 显示标记为的 tiddler指定标签 newTiddler:title 在编辑模式下打开一个具有指定标题的新 tiddler newJournal:titleFormat 打开一个具有指定 DateFormatString: #newJournal:"YYYY MMM DD" 的新 tiddler

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T07:41:21.280

您的问题的直接答案是：几乎所有开源 Wiki 都应该易于修改 - 选择您最熟悉的（wiki 或语言）。

我知道如果我正确理解了您的问题，[jspwiki](http://www.jspwiki.org)会开箱即用地提供此功能。它目前在 apaches 孵化器中。检查[JspWiki 的 Sandbox](http://sandbox.jspwiki.org)。

# .net - 市场上可用的开源 OCR 工具

> ID：196918
> 
> 赞同：25
> 
> 时间：2008-10-13T07:28:38.060
> 
> 标签：.net, ocr

是否有任何用 .NET 编写的开源 OCR 库，或者用任何语言编写但可以在 ASP.NET 应用程序中使用？或者市场上是否有任何开源 OCR API 可用于将图像转换为表格格式？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-14T10:32:08.563

使用[Tessnet](http://www.pixel-technology.com/freeware/tessnet/)。

Tessnet 是 .NET 2.0 的 tessdll（和[tesseract](http://code.google.com/p/tesseract-ocr/)）的 C++/CLI .NET Wrapper。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T07:34:17.317

有[Tesseract](http://code.google.com/p/tesseract-ocr/)，虽然它没有原生的 .net 绑定，但它非常完整。

“值得一看”的是[OCRopus](http://code.google.com/p/ocropus/) - 一项由 Google 赞助的项目，尚未准备好投入生产。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T09:55:33.723

对于它的价值，还有[GOCR](http://jocr.sourceforge.net/ "GOCR")。没试过。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T07:29:51.960

我相信，Tesseract OCR 是由 HP 开发并开源的。我不确定质量有多好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T10:38:21.423

正如其他人正在编写的那样，Tesseract 是一个很好的开源 OCR 实现。

尽管它很好，但它只是一个 OCR 引擎。它不进行布局检测。如果您的输入不是纯文本，您可能必须自己弄清楚布局。

# visual-c++ - 如何在 Visual C++ 中更改 OutDir 变量？

> ID：196920
> 
> 赞同：13
> 
> 时间：2008-10-13T07:29:34.020
> 
> 标签：visual-c++, linker

在链接器中，二进制目标指定为：

$(OutDir)\$(ProjectName).exe

我查看了所有设置，但看不到 OutDir 的定义位置。我该如何改变？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-13T07:55:28.443

“配置属性”下的“常规”部分中的第一个选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T07:30:27.433

它位于项目属性的第一页

# javascript - 如何确保用户只提交英文文本

> ID：196924
> 
> 赞同：9
> 
> 时间：2008-10-13T07:32:12.953
> 
> 标签：javascript, python, nlp

我正在构建一个涉及自然语言处理的项目，因为 nlp 模块目前只处理英文文本，所以我必须确保用户提交的内容（不长，只有几个单词）是英文的。是否有既定的方法来实现这一目标？首选 Python 或 Javascript 方式。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-13T07:47:57.727

如果内容足够长，我建议对字母进行一些[频率分析。](http://en.wikipedia.org/wiki/Frequency_analysis)

但是对于一些单词，我认为最好的办法是将它们与英语词典进行比较，如果其中一半匹配，则接受输入。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T08:05:26.553

检查[语言识别图表](http://en.wikipedia.org/wiki/Wikipedia:Language_recognition_chart)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-13T07:58:58.390

我认为最有效的方法是要求用户只提交英文文本:)

您可以在文本区域上显示语言选择下拉菜单，并使用英语/其他作为选项。当用户选择“其他”时，禁用文本区域并显示仅支持英语的消息 [目前]。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-13T15:10:05.150

Google has a javascript API that has an implementation of language detection. I've only play tested with it, never used it in production.

[http://code.google.com/apis/ajaxlanguage/documentation/#Detect](http://code.google.com/apis/ajaxlanguage/documentation/#Detect)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-13T08:22:49.450

尝试基于 n-gram 的统计语言识别。这是一个使用这种技术的算法演示的[链接](http://odur.let.rug.nl/~vannoord/TextCat/Demo/)，还有一个描述该算法的论文的链接。试试这个演示，即使在非常短的文本（3-4 个字）上也能表现得很好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-13T09:05:29.443

你已经在做 NLP，如果你的模块不理解文本是什么语言，那么要么模块不工作，要么输入的语言不正确。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-13T07:52:22.240

尝试：

[http://wordlist.sourceforge.net/](http://wordlist.sourceforge.net/)

对于英语单词列表。

您需要注意名称，例如“Canberra”或“Bill Clinton”。这些不会出现在单词列表中。我建议只检查第一个字母是否大写作为第一次尝试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T07:39:52.533

您可以将短语分解为单词并查看字典（您可以下载一些字典，[这](http://wordlist.sourceforge.net/)可能很有趣），但这需要您使用的字典足够好。

它也会因专有名词而失败（例如，我的名字不在字典中）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T09:10:41.007

[Dictionary Switcher](http://en.design-noir.de/mozilla/dictionary-switcher/ "字典切换器") Firefox 扩展有一个选项，可以在我键入时检测正确的字典。
我猜它会根据已安装的字典检查单词，并选择错误较少的单词...

You can't expect all words of the text to be in the dictionary: abbreviations, proper nouns, typos... Beside, some words are common to several languages: a French rock group even made the titles of their disks to have a (different) meaning both in French and in English. So it is a statistical thing: if more than x% of words are found in a good English dictionary, chances are the user types in this language (even if there are mistakes, like probably in this answer, since I am not native English).

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-17T17:40:45.247

也许“[确保用户只提交英文文本 [PHP]](http://valums.com/a/) ”文章会对您有所帮助。代码是用 PHP 编写的，但足够小，可以很容易地重写。

# javascript - 如何从字符串中修剪（）空格？

> ID：196925
> 
> 赞同：41
> 
> 时间：2008-10-13T07:32:19.210
> 
> 标签：javascript, jquery, string, trim

JavaScript 似乎没有本地`trim()`方法。如何使用 JavaScript 修剪字符串开头和结尾的空格？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-30T06:29:19.600

jQuery 的最短形式：

```
string = $.trim(string); 
```

[关联](http://docs.jquery.com/Utilities/jQuery.trim#str)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-13T07:34:14.867

根据[此页面](http://blog.stevenlevithan.com/archives/faster-trim-javascript)，最好的全方位方法是

```
return str.replace(/^\s\s*/, '').replace(/\s\s*$/, ''); 
```

当然，如果您使用的是 jQuery，它会为您提供优化的修剪方法。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2014-05-18T06:18:32.440

我知道这个问题很古老，但现在，Javascript 实际上确实有一个原生的 .trim()

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-30T08:09:14.127

好吧，正如很多人总是说的那样，trim 函数工作得很好，但是如果您不想使用整个框架来执行trim，那么看看它的实现可能会很有用。所以这里是：

```
function( text ) { return (text || "").replace( /^(\s|\u00A0)+|(\s|\u00A0)+$/g, "" );} 
```

与这里已经提出的其他解决方案相比，我在此实现中看到的主要优点是：

*   'g' 标志，允许您对多行字符串执行修剪
*   (text || "") 语法确保函数始终有效，即使传递的参数为 null 或未定义。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-13T07:48:29.440

正如其他一些人已经指出的那样，通常最好使用第三方 JS 库来做这种事情。并不是说 trim() 是一个复杂的函数来构建自己，但是有很多函数不是 JavaScript 原生的，你可能需要并最终自己编写，使用库很快就会变得更具成本效益。

当然，使用 JS 库的另一个好处是作者努力确保这些函数在所有主流浏览器上都能正常工作，这样您就可以对标准接口进行编码，而忘记 Internet Explorer 和所有浏览器之间令人讨厌的差异。其他浏览器。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-13T07:37:15.610

@Pat 的一个稍微小一点的版本。

```
return str.replace( /^\s+|\s+$/g, '' ); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-13T07:39:33.203

对于 ltrim，将锚定在字符串开头的空格替换为空：

```
str2 = str.replace(/^\s+/,''); 
```

对于 rtrim，将锚定在字符串末尾的空格替换为空：

```
str2 = str.replace(/\s+$/,''); 
```

对于修剪：

```
str2 = str.replace(/^\s+|\s+$/g,''); 
```

这些都使用正则表达式来完成实际工作。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-12T22:19:33.017

为什么不直接修改 String 原型呢？为什么不从开源库中窃取修剪功能，就像我在 YUI 中所做的那样？（你真的需要为这个简单的任务加载整个框架吗？）把它们放在一起，你会得到这个：

```
String.prototype.trim = function() {
    try {
        return this.replace(/^\s+|\s+$/g, "");
    } catch(e) {
        return this;
    }
}

var s = " hello ";
alert(s.trim() == "hello"); // displays true 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-10-20T11:12:38.897

使用[Ariel Flesler 的快速修剪功能](http://flesler.blogspot.com/2008/11/fast-trim-function-for-javascript.html)：

```
// Licensed under BSD
function myBestTrim( str ){
 var start = -1,
  end = str.length;
 while( str.charCodeAt(--end) < 33 );
 while( str.charCodeAt(++start) < 33 );
 return str.slice( start, end + 1 );
}; 
```

不过，我的解决方案是这样的（因为 Firefox 3.5 及更高版本中的 String 对象已经有一个[`trim`方法](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/Trim)）：

```
String.prototype.trim = String.prototype.trim || function () {
    var start = -1,
        end   = this.length;

    while( this.charCodeAt(--end) < 33 );
    while( this.charCodeAt(++start) < 33 );

    return this.slice( start, end + 1 );
}; 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-09-22T21:35:40.703

我考虑了一个修剪功能的速度。该函数明显击败了所有 24 个竞争对手（其中许多使用正则表达式）以及 Chrome 和 Chromium(!) 的原生 string.trim()，并且执行速度与 Safari 的 trim() 一样快。测试结果在这里：http: [//jsperf.com/mega-trim-test/7](http://jsperf.com/mega-trim-test/7)

```
function trim27(str) {
  var c;
  for (var i = 0; i < str.length; i++) {
    c = str.charCodeAt(i);
    if (c == 32 || c == 10 || c == 13 || c == 9 || c == 12)
    continue; else break;
  }
  for (var j = str.length - 1; j >= i; j--) {
    c = str.charCodeAt(j);
    if (c == 32 || c == 10 || c == 13 || c == 9 || c == 12)
    continue; else break;
  }
  return str.substring(i, j + 1);
} 
```

该函数修剪字符“\n\r\t\f”，但添加更多空白字符很容易，例如。那些正则表达式用作空格（\s）的那些，只有轻微的性能损失（请参阅[http://jsperf.com/mega-trim-test/8](http://jsperf.com/mega-trim-test/8)）。

编辑：之前的 trim27() 只修剪最常见的字符（“\n\r\t\f”），但为了修剪所有可能的空格，我在下面添加了一个新函数 mytrim()：

```
if (!String.prototype.trim || "\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF".trim() || navigator.userAgent.toString().toLowerCase().indexOf("chrome") != -1)
    var mytrim = function(str) {
        var c;
        for (var i = 0; i < str.length; i++) {
            c = str.charCodeAt(i);
            if (c == 32 || c == 10 || c == 13 || c == 9 || c == 12 || c == 11 || c == 160 || c == 5760 || c == 6158 || c == 8192 || c == 8193 || c == 8194 || c == 8195 || c == 8196 || c == 8197 || c == 8198 || c == 8199 || c == 8200 || c == 8201 || c == 8202 || c == 8232 || c == 8233 || c == 8239 || c == 8287 || c == 12288 || c == 65279)
            continue; else break;
        }
        for (var j = str.length - 1; j >= i; j--) {
            c = str.charCodeAt(j);
            if (c == 32 || c == 10 || c == 13 || c == 9 || c == 12 || c == 11 || c == 160 || c == 5760 || c == 6158 || c == 8192 || c == 8193 || c == 8194 || c == 8195 || c == 8196 || c == 8197 || c == 8198 || c == 8199 || c == 8200 || c == 8201 || c == 8202 || c == 8232 || c == 8233 || c == 8239 || c == 8287 || c == 12288 || c == 65279)
            continue; else break;
        }
        return str.substring(i, j + 1);
    };
    else var mytrim = function(str) {
        return str.trim();
    } 
```

以这种方式使用它：

```
var foo = mytrim(" \n \t Trimmed \f \n "); // foo is now "Trimmed" 
```

上面的 mytrim() 执行以下操作：

*   修剪 26 个不同的空格（[http://perfectionkills.com/whitespace-deviations/](http://perfectionkills.com/whitespace-deviations/)中提到的所有 25 个空格，另外还有 uFEFF，即零宽度无间隔空格。
*   使修剪结果在浏览器中保持一致。
*   如果可用，则使用本机 trim() 并且能够修剪所有 27 个不同的空格。例外是 Chrome 和 Chromium，它们的原生 trim() 都很慢，以至于我们使用自定义的 trim() 而不是原生的。
*   最重要的是：不漂亮也不短，但显然比[http://jsperf.com/mega-trim-test/12](http://jsperf.com/mega-trim-test/12)中的 24 个竞争替代品中的任何一个都快（例外：相当老的 Firefox 3.6.25 in Windows 7 运行 mytrim() 的速度相当慢，原因不明）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-06-17T17:54:34.393

我将它与本机 JavaScript 一起使用

```
// Adding trim function to String object if its not there
if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, '');
  }
} 
```

像这样使用

```
var myString = "                  some text                  ";

alert(myString.trim()); 
```

**例子**

```
// Adding trim function to String object if its not there
if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, '');
  }
}

var str = "      some text              ";
console.log(str.trim());
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-13T07:34:23.837

这么多 JavaScript 问题的答案：jQuery

```
$j.trim(string) 
```

注意：以上假设您的 jQuery 已设置为：

```
<script type="text/javascript">$j = jQuery.noConflict();</script> 
```

这比“$”要明智得多，而且比每次都输入“jQuery”要简单得多。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-08T13:35:21.353

Microsoft .NET 还具有[String.trim](http://msdn.microsoft.com/en-us/library/bb310993.aspx)函数作为 JavaScript 基本类型扩展的一部分。如果您正在编写 ASP.NET 应用程序，则可以使用它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-10-20T11:05:06.810

我用这个。

```
 String.prototype.trim = function() {
        return this.replace(/^\s+|\s+$/g,"");
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-30T06:09:10.000

实际上，对于 jQuery，这似乎是这样的：

```
jQuery.trim(string) 
```

[（参考）](http://docs.jquery.com/Utilities/jQuery.trim#str)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-07-17T02:07:11.170

我用这个：

使用函数。

```
 function trim($) { 
                return (typeof $ == "function" ? $() : $).replace(/[\s]*/g,"")
        }

        code example: 

        trim((function(){ return "a  b"})) // ab

        trim(" a  b") //ab 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-07-17T05:14:00.840

您可以使用以下...

```
function trim(str) {
    try {
        if (str && typeof(str) == 'string') {
            return str.replace(/^\s*|\s*$/g, "");
        } else {
            return '';
        }
    } catch (e) {
        return str;
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-04-11T01:32:10.833

这可能不是最快的，并且可能违反“.trim()”可能真正应该的，但我不喜欢正则表达式（主要是因为要花很多时间才能弄清楚它们的真正含义/所做的）而且我喜欢无论我是否有 jQuery，拥有我知道的东西都会起作用（更不用说正确的版本了，因为我用 jQuery 1.4.2 尝试了 $.trim(myVar) 并且它不起作用），并且将摆脱所有额外的空间，不仅仅是在最后，重建它应该是：

```
function Trim(obj) {
    var coll = "";
    var arrObj = obj.split(' ');

    for (var i=0;i<arrObj.length;i++) {
        if (arrObj[i] == "") {
            arrObj.splice(i,1);  // removes array indices containing spaces
        }
    }
    //alert(arrObj.length);  // should be equal to the number of words
    // Rebuilds with spaces in-between words, but without spaces at the end
    for (var i=0;i<arrObj.length;i++) {
        if (arrObj[i] != "" && i != arrObj.length-1)
            coll += arrObj[i] + " ";
        if (arrObj[i] != "" && i == arrObj.length-1)
            coll += arrObj[i];
    }

    return coll;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-09-22T12:23:39.530

这是一个老问题，但这些都不适合我。我只需要修剪前导和尾随空格，这就是我所做的。我的 div 标签有一个 id = start-date。

```
$("#start-date").text().trim() 
```

# python - 如何在 Python 中检查操作系统是否是 Vista？

> ID：196930
> 
> 赞同：26
> 
> 时间：2008-10-13T07:35:14.507
> 
> 标签：python, windows, windows-vista, wxpython, pywin32

如何以最简单的方式区分 Windows XP 和 Windows Vista，使用 Python 和[pywin32](http://python.net/crew/mhammond/win32/Downloads.html)或[wxPython](http://www.wxpython.org/)？

本质上，如果当前操作系统是 Vista，我需要一个调用将返回 True 的函数：

```
>>> isWindowsVista()
True 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-14T06:10:23.367

Python 有一个可爱的“平台”模块来帮助你。

```
>>> import platform
>>> platform.win32_ver()
('XP', '5.1.2600', 'SP2', 'Multiprocessor Free')
>>> platform.system()
'Windows'
>>> platform.version()
'5.1.2600'
>>> platform.release()
'XP' 
```

注意：如评论中所述，使用旧版本的 python 时可能不会返回正确的值。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-13T07:35:25.130

我找到的最简单的解决方案是这个：

```
import sys

def isWindowsVista():
    '''Return True iff current OS is Windows Vista.'''
    if sys.platform != "win32":
        return False
    import win32api
    VER_NT_WORKSTATION = 1
    version = win32api.GetVersionEx(1)
    if not version or len(version) < 9:
        return False
    return ((version[0] == 6) and 
            (version[1] == 0) and
            (version[8] == VER_NT_WORKSTATION)) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-13T07:55:47.477

Twisted中使用的解决方案，不需要pywin32：

```
def isVista():
    if getattr(sys, "getwindowsversion", None) is not None:
        return sys.getwindowsversion()[0] == 6
    else:
        return False 
```

请注意，它也将匹配 Windows Server 2008。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-09T14:24:42.673

[来自http://www.brunningonline.net/simon/blog/archives/winGuiAuto.py.html](http://www.brunningonline.net/simon/blog/archives/winGuiAuto.py.html)的想法可能会有所帮助，它基本上可以回答您的问题：

```
win_version = {4: "NT", 5: "2K", 6: "XP"}[os.sys.getwindowsversion()[0]]
print "win_version=", win_version 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-04-01T11:30:57.903

```
import platform
if platform.release() == "Vista":
    # Do something. 
```

或者

```
import platform
if "Vista" in platform.release():
    # Do something. 
```

# c# - 反射和泛型类型

> ID：196936
> 
> 赞同：12
> 
> 时间：2008-10-13T07:37:22.460
> 
> 标签：c#, .net, generics, reflection

我正在为类构造函数编写一些代码，该构造函数循环遍历类的所有属性并调用一个通用静态方法，该方法用来自外部 API 的数据填充我的类。所以我把这个作为一个示例类：

```
public class MyClass{
  public string Property1 { get; set; }
  public int Property2 { get; set; }
  public bool Property3 { get; set; }

  public static T DoStuff<T>(string name){
    // get the data for the property from the external API
    // or if there's a problem return 'default(T)'
  }
} 
```

现在在我的构造函数中，我想要这样的东西：

```
public MyClass(){
  var properties = this.GetType().GetProperties();
  foreach(PropertyInfo p in properties){
    p.SetValue(this, DoStuff(p.Name), new object[0]);
  }
} 
```

所以上面的构造函数会抛出一个错误，因为我没有提供泛型类型。

那么如何传入属性的类型呢？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-13T07:44:28.293

你想用 T = 每个属性的类型来调用 DoStuff<T> 吗？在这种情况下，“原样”您将需要使用反射和 MakeGenericMethod - 即

```
var properties = this.GetType().GetProperties();
foreach (PropertyInfo p in properties)
{
    object value = typeof(MyClass)
    .GetMethod("DoStuff")
    .MakeGenericMethod(p.PropertyType)
    .Invoke(null, new object[] { p.Name });
    p.SetValue(this, value, null);
} 
```

然而，这不是很漂亮。在现实中，我想知道是否有更好的选择：

```
static object DoStuff(string name, Type propertyType);
... and then
object value = DoStuff(p.Name, p.PropertyType); 
```

在这个例子中泛型给了你什么？请注意，在反射调用期间，值类型仍然会被装箱等 - 即使这样装箱[也没有您想象的那么糟糕](http://msmvps.com/blogs/jon_skeet/archive/2008/10/08/why-boxing-doesn-t-keep-me-awake-at-nights.aspx)。

最后，在许多情况下，TypeDescriptor.GetProperties() 比 Type.GetProperties() 更合适 - 允许灵活的对象模型等。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-13T07:44:54.863

你的构造函数代码是这样写的吗：

```
public MyClass(){
  var properties = this.GetType().GetProperties();
  foreach(PropertyInfo p in properties){
    p.SetValue(this, DoStuff(p.Name), new object[0]);
  }
} 
```

? 请注意，`DoStuff`而不是`MyClass`.

如果是这样，问题是您在尝试使用泛型时它们确实不适用。泛型的要点（嗯，要点之一）是使用编译时类型安全。在这里你不知道编译时的类型！您可以通过反射调用该方法（获取打开的表单，然后调用[MakeGenericMethod](http://msdn.microsoft.com/en-us/library/system.reflection.methodinfo.makegenericmethod.aspx)）但这很丑陋。

`DoStuff`首先真的需要通用吗？它是从其他地方使用的吗？to 的参数`PropertyInfo.SetValue`只是对象，因此即使您*可以*通用调用该方法，您仍然会得到装箱等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T08:34:45.620

如果你不使用其他地方的 DoStuff，我也建议编写一个非泛型方法。

也许您创建了能够使用 default(T) 的通用方法。要在非泛型方法中替换它，您可以将 Activator.CreateInstance(T) 用于值类型，将 null 用于引用类型：

```
object defaultResult = type.IsValueType ? Activator.CreateInstance(type) : null 
```

# android - Android WebView 是否需要打开外部 URL 的权限？

> ID：196946
> 
> 赞同：24
> 
> 时间：2008-10-13T07:44:54.783
> 
> 标签：android, http, webview

我正在尝试以下示例，但使用外部 URL： [Using WebViews](http://android-developers.blogspot.com/2008/09/using-webviews.html)

该示例展示了如何从 assets 文件夹 ( `file:// url`) 加载 HTML 文件并将其显示在 WebView 中。

但是当我尝试使用外部 URL（如[http://google.com](http://google.com)）时，我总是收到“网站不可用”错误。Android 的内置浏览器能够访问所有外部 URL。

我怀疑它与权限有关，但无法确认。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-13T19:04:01.637

我自己找到了答案。

权限名称是 android.permission.INTERNET。

将以下行添加到 AndroidManifest.xml（直接嵌套在标签中）就可以了：

```
<uses-permission android:name="android.permission.INTERNET"></uses-permission> 
```

该文件还可以通过权限选项卡在 Eclipse 插件中以图形方式进行编辑。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-25T00:16:42.533

这是一个用户权限：

```
<uses-permission android:name="android.permission.INTERNET" /> 
```

# .net - 如何在 Vista (.NET) 中运行不提升

> ID：196949
> 
> 赞同：18
> 
> 时间：2008-10-13T07:47:53.420
> 
> 标签：.net, windows-vista, uac, elevation

我有一个必须以管理员身份运行的应用程序。

该应用程序的一小部分是使用 Process.Start 启动其他应用程序

启动的应用程序也将以管理员身份运行，但我宁愿看到它们以“普通”用户身份运行。

我该如何做到这一点？

/约翰/

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-13T14:28:33.113

WinSafer API 允许以受限用户、普通用户或提升用户身份启动进程。

**样品用法：**

```
CreateSaferProcess(@"calc.exe", "", SaferLevel.NormalUser); 
```

**源代码：**

```
//http://odetocode.com/Blogs/scott/archive/2004/10/28/602.aspx
public static void CreateSaferProcess(String fileName, String arguments, SaferLevel saferLevel)
{
   IntPtr saferLevelHandle = IntPtr.Zero;

   //Create a SaferLevel handle to match what was requested
   if (!WinSafer.SaferCreateLevel(
         SaferLevelScope.User, 
         saferLevel, 
         SaferOpen.Open, 
         out saferLevelHandle, 
         IntPtr.Zero))
   {
      throw new Win32Exception(Marshal.GetLastWin32Error());
   }
   try
   {
      //Generate the access token to use, based on the safer level handle.
      IntPtr hToken = IntPtr.Zero;

      if (!WinSafer.SaferComputeTokenFromLevel(
            saferLevelHandle,  // SAFER Level handle
            IntPtr.Zero,       // NULL is current thread token.
            out hToken,        // Target token
            SaferTokenBehaviour.Default,      // No flags
            IntPtr.Zero))      // Reserved
      {
         throw new Win32Exception(Marshal.GetLastWin32Error());
      }
      try
      {
         //Now that we have a security token, we can lauch the process
         //using the standard CreateProcessAsUser API
         STARTUPINFO si = new STARTUPINFO();
         si.cb = Marshal.SizeOf(si);
         si.lpDesktop = String.Empty;

         PROCESS_INFORMATION pi = new PROCESS_INFORMATION();

         // Spin up the new process
         Boolean bResult = Windows.CreateProcessAsUser(
               hToken,
               fileName,
               arguments,
               IntPtr.Zero, //process attributes
               IntPtr.Zero, //thread attributes
               false, //inherit handles
               0, //CREATE_NEW_CONSOLE
               IntPtr.Zero, //environment
               null, //current directory
               ref si, //startup info
               out pi); //process info

         if (!bResult)
            throw new Win32Exception(Marshal.GetLastWin32Error());

         if (pi.hProcess != IntPtr.Zero)
            Windows.CloseHandle(pi.hProcess);

         if (pi.hThread != IntPtr.Zero)
            Windows.CloseHandle(pi.hThread);
      }
      finally
      {
         if (hToken != IntPtr.Zero)
            Windows.CloseHandle(hToken);
      }
   }
   finally
   {
      WinSafer.SaferCloseLevel(saferLevelHandle);
   }
} 
```

**P/Invoke 声明：**

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;

namespace PInvoke
{
   public class WinSafer
   {
      /// <summary>
      /// The SaferCreateLevel function opens a SAFER_LEVEL_HANDLE.
      /// </summary>
      /// <param name="scopeId">The scope of the level to be created.</param>
      /// <param name="levelId">The level of the handle to be opened.</param>
      /// <param name="openFlags">Must be SaferOpenFlags.Open</param>
      /// <param name="levelHandle">The returned SAFER_LEVEL_HANDLE. When you have finished using the handle, release it by calling the SaferCloseLevel function.</param>
      /// <param name="reserved">This parameter is reserved for future use. IntPtr.Zero</param>
      /// <returns></returns>
      [DllImport("advapi32", SetLastError = true, CallingConvention = CallingConvention.StdCall)]
      public static extern bool SaferCreateLevel(SaferLevelScope scopeId, SaferLevel levelId, SaferOpen openFlags,
            out IntPtr levelHandle, IntPtr reserved);

      /// <summary>
      /// The SaferComputeTokenFromLevel function restricts a token using restrictions specified by a SAFER_LEVEL_HANDLE.
      /// </summary>
      /// <param name="levelHandle">SAFER_LEVEL_HANDLE that contains the restrictions to place on the input token. Do not pass handles with a LevelId of SAFER_LEVELID_FULLYTRUSTED or SAFER_LEVELID_DISALLOWED to this function. This is because SAFER_LEVELID_FULLYTRUSTED is unrestricted and SAFER_LEVELID_DISALLOWED does not contain a token.</param>
      /// <param name="inAccessToken">Token to be restricted. If this parameter is NULL, the token of the current thread will be used. If the current thread does not contain a token, the token of the current process is used.</param>
      /// <param name="outAccessToken">The resulting restricted token.</param>
      /// <param name="flags">Specifies the behavior of the method.</param>
      /// <param name="lpReserved">Reserved for future use. This parameter should be set to IntPtr.EmptyParam.</param>
      /// <returns></returns>
      [DllImport("advapi32", SetLastError = true, CallingConvention = CallingConvention.StdCall)]
      public static extern bool SaferComputeTokenFromLevel(IntPtr levelHandle, IntPtr inAccessToken,
            out IntPtr outAccessToken, SaferTokenBehaviour flags, IntPtr lpReserved);

      /// <summary>
      /// The SaferCloseLevel function closes a SAFER_LEVEL_HANDLE that was opened by using the SaferIdentifyLevel function or the SaferCreateLevel function.</summary>
      /// <param name="levelHandle">The SAFER_LEVEL_HANDLE to be closed.</param>
      /// <returns>TRUE if the function succeeds; otherwise, FALSE. For extended error information, call GetLastWin32Error.</returns>
      [DllImport("advapi32", SetLastError = true, CallingConvention = CallingConvention.StdCall)]
      public static extern bool SaferCloseLevel(IntPtr levelHandle);
   } //class WinSafer

   /// <summary>
   /// Specifies the behaviour of the SaferComputeTokenFromLevel method
   /// </summary>
   public enum SaferTokenBehaviour : uint
   {
      /// <summary></summary>
      Default = 0x0,
      /// <summary>If the OutAccessToken parameter is not more restrictive than the InAccessToken parameter, the OutAccessToken parameter returns NULL.</summary>
      NullIfEqual = 0x1,
      /// <summary></summary>
      CompareOnly = 0x2,
      /// <summary></summary>
      MakeInert = 0x4,
      /// <summary></summary>
      WantFlags = 0x8
   }

   /// <summary>
   /// The level of the handle to be opened.
   /// </summary>
   public enum SaferLevel : uint
   {
      /// <summary>Software will not run, regardless of the user rights of the user.</summary>
      Disallowed = 0,
      /// <summary>Allows programs to execute with access only to resources granted to open well-known groups, blocking access to Administrator and Power User privileges and personally granted rights.</summary>
      Untrusted = 0x1000,
      /// <summary>Software cannot access certain resources, such as cryptographic keys and credentials, regardless of the user rights of the user.</summary>
      Constrained = 0x10000,
      /// <summary>Allows programs to execute as a user that does not have Administrator or Power User user rights. Software can access resources accessible by normal users.</summary>
      NormalUser = 0x20000,
      /// <summary>Software user rights are determined by the user rights of the user.</summary>
      FullyTrusted = 0x40000
   }

   /// <summary>
   /// The scope of the level to be created.
   /// </summary>
   public enum SaferLevelScope : uint
   {
      /// <summary>The created level is scoped by computer.</summary>
      Machine = 1,
      /// <summary>The created level is scoped by user.</summary>
      User = 2
   }

   public enum SaferOpen : uint
   {
      Open = 1
   }
} //namespace PInvoke 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-13T07:55:11.627

来自： http: [//go.microsoft.com/fwlink/ ?LinkId=81232](http://go.microsoft.com/fwlink/?LinkId=81232)

> 一个常见问题是如何从提升的进程启动未提升的应用程序，或者更根本地，如何在运行提升后使用未提升的令牌启动进程。由于没有直接的方法来执行此操作，因此通常可以通过以标准用户身份启动原始应用程序并仅提升应用程序中需要管理权限的那些部分来避免这种情况。这样，始终有一个非提升进程可用于以当前登录的桌面用户身份启动其他应用程序。但是，有时，提升的进程需要让另一个应用程序在未提升的情况下运行。这可以通过使用 Windows Vista 中的任务计划程序来完成。

这是一个如何安排未提升进程的示例（再次来自同一链接）

```
//---------------------------------------------------------------------
//  This file is part of the Microsoft .NET Framework SDK Code Samples.
// 
//  Copyright (C) Microsoft Corporation.  All rights reserved.
// 
//This source code is intended only as a supplement to Microsoft
//Development Tools and/or on-line documentation.  See these other
//materials for detailed information regarding Microsoft code samples.
// 
//THIS CODE AND INFORMATION ARE PROVIDED AS IS WITHOUT WARRANTY OF ANY
//KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
//IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A
//PARTICULAR PURPOSE.
//---------------------------------------------------------------------

/****************************************************************************
* Main.cpp - Sample application for Task Scheduler V2 COMAPI                * Component: Task Scheduler                          
* Copyright (c) 2002 - 2003, Microsoft Corporation 
* This sample creates a task to that launches as the currently logged on deskup user. The task launches as soon as it is registered.                                                             *
****************************************************************************/
#include "stdafx.h"
#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <comdef.h>
#include <comutil.h>
//Include Task header files - Included in Windows Vista Beta-2 SDK from MSDN
#include <taskschd.h>
#include <conio.h>
#include <iostream>
#include <time.h>

using namespace std;

#define CLEANUP \
pRootFolder->Release();\
        pTask->Release();\
        CoUninitialize();

HRESULT CreateMyTask(LPCWSTR, wstring);

void __cdecl wmain(int argc, wchar_t** argv)
{
wstring wstrExecutablePath;
WCHAR taskName[20];
HRESULT result;

if( argc < 2 )
{
printf("\nUsage: LaunchApp yourapp.exe" );
return;
}

// Pick random number for task name
srand((unsigned int) time(NULL));
wsprintf((LPWSTR)taskName, L"Launch %d", rand());

wstrExecutablePath = argv[1];

result = CreateMyTask(taskName, wstrExecutablePath);
printf("\nReturn status:%d\n", result);

}
HRESULT CreateMyTask(LPCWSTR wszTaskName, wstring wstrExecutablePath)
{
    //  ------------------------------------------------------
    //  Initialize COM.
TASK_STATE taskState;
int i;
    HRESULT hr = CoInitializeEx(NULL, COINIT_MULTITHREADED);
    if( FAILED(hr) )
    {
        printf("\nCoInitializeEx failed: %x", hr );
        return 1;
    }

    //  Set general COM security levels.
    hr = CoInitializeSecurity(
        NULL,
        -1,
        NULL,
        NULL,
        RPC_C_AUTHN_LEVEL_PKT_PRIVACY,
        RPC_C_IMP_LEVEL_IMPERSONATE,
        NULL,
        0,
        NULL);

    if( FAILED(hr) )
    {
        printf("\nCoInitializeSecurity failed: %x", hr );
        CoUninitialize();
        return 1;
    }

    //  ------------------------------------------------------
    //  Create an instance of the Task Service. 
    ITaskService *pService = NULL;
    hr = CoCreateInstance( CLSID_TaskScheduler,
                           NULL,
                           CLSCTX_INPROC_SERVER,
                           IID_ITaskService,
                           (void**)&pService );  
    if (FAILED(hr))
    {
        printf("Failed to CoCreate an instance of the TaskService class: %x", hr);
        CoUninitialize();
        return 1;
    }

    //  Connect to the task service.
    hr = pService->Connect(_variant_t(), _variant_t(), _variant_t(), _variant_t());
    if( FAILED(hr) )
    {
        printf("ITaskService::Connect failed: %x", hr );
        pService->Release();
        CoUninitialize();
        return 1;
    }

    //  ------------------------------------------------------
    //  Get the pointer to the root task folder.  This folder will hold the
    //  new task that is registered.
    ITaskFolder *pRootFolder = NULL;
    hr = pService->GetFolder( _bstr_t( L"\\") , &pRootFolder );
    if( FAILED(hr) )
    {
        printf("Cannot get Root Folder pointer: %x", hr );
        pService->Release();
        CoUninitialize();
        return 1;
    }

    //  Check if the same task already exists. If the same task exists, remove it.
    hr = pRootFolder->DeleteTask( _bstr_t( wszTaskName), 0  );

    //  Create the task builder object to create the task.
    ITaskDefinition *pTask = NULL;
    hr = pService->NewTask( 0, &pTask );

    pService->Release();  // COM clean up.  Pointer is no longer used.
    if (FAILED(hr))
    {
        printf("Failed to CoCreate an instance of the TaskService class: %x", hr);
        pRootFolder->Release();
        CoUninitialize();
        return 1;
    }

    //  ------------------------------------------------------
    //  Get the trigger collection to insert the registration trigger.
    ITriggerCollection *pTriggerCollection = NULL;
    hr = pTask->get_Triggers( &pTriggerCollection );
    if( FAILED(hr) )
    {
        printf("\nCannot get trigger collection: %x", hr );
  CLEANUP
        return 1;
    }

    //  Add the registration trigger to the task.
    ITrigger *pTrigger = NULL;

    hr = pTriggerCollection->Create( TASK_TRIGGER_REGISTRATION, &pTrigger );     
    pTriggerCollection->Release();  // COM clean up.  Pointer is no longer used.
    if( FAILED(hr) )
    {
        printf("\nCannot add registration trigger to the Task %x", hr );
        CLEANUP
        return 1;
    }
    pTrigger->Release();

    //  ------------------------------------------------------
    //  Add an Action to the task.     
    IExecAction *pExecAction = NULL;
    IActionCollection *pActionCollection = NULL;

    //  Get the task action collection pointer.
    hr = pTask->get_Actions( &pActionCollection );
    if( FAILED(hr) )
    {
        printf("\nCannot get Task collection pointer: %x", hr );
        CLEANUP
        return 1;
    }

    //  Create the action, specifying that it is an executable action.
    IAction *pAction = NULL;
    hr = pActionCollection->Create( TASK_ACTION_EXEC, &pAction );
    pActionCollection->Release();  // COM clean up.  Pointer is no longer used.
    if( FAILED(hr) )
    {
        printf("\npActionCollection->Create failed: %x", hr );
        CLEANUP
        return 1;
    }

    hr = pAction->QueryInterface( IID_IExecAction, (void**) &pExecAction );
    pAction->Release();
    if( FAILED(hr) )
    {
        printf("\npAction->QueryInterface failed: %x", hr );
        CLEANUP
        return 1;
    }

    //  Set the path of the executable to the user supplied executable.
   hr = pExecAction->put_Path( _bstr_t( wstrExecutablePath.c_str() ) );  

    if( FAILED(hr) )
    {
        printf("\nCannot set path of executable: %x", hr );
        pExecAction->Release();
        CLEANUP
        return 1;
    }
    hr = pExecAction->put_Arguments( _bstr_t( L"" ) );  

   if( FAILED(hr) )
    {
        printf("\nCannot set arguments of executable: %x", hr );
        pExecAction->Release();
        CLEANUP
        return 1;
    }

    //  ------------------------------------------------------
    //  Save the task in the root folder.
    IRegisteredTask *pRegisteredTask = NULL;
    hr = pRootFolder->RegisterTaskDefinition(
            _bstr_t( wszTaskName ),
            pTask,
      TASK_CREATE, 
_variant_t(_bstr_t( L"S-1-5-32-545")),//Well Known SID for \\Builtin\Users group
_variant_t(), 
TASK_LOGON_GROUP,
            _variant_t(L""),
            &pRegisteredTask);
    if( FAILED(hr) )
    {
        printf("\nError saving the Task : %x", hr );
        CLEANUP
        return 1;
    }
    printf("\n Success! Task successfully registered. " );
    for (i=0; i<100; i++)//give 10 seconds for the task to start
{
pRegisteredTask->get_State(&taskState);
if (taskState == TASK_STATE_RUNNING)
{
printf("\nTask is running\n");
break;
}
Sleep(100);
}
if (i>= 100) printf("Task didn't start\n");

    //Delete the task when done
    hr = pRootFolder->DeleteTask(
            _bstr_t( wszTaskName ),
            NULL);
    if( FAILED(hr) )
    {
        printf("\nError deleting the Task : %x", hr );
        CLEANUP
        return 1;
    }

    printf("\n Success! Task successfully deleted. " );

//  Clean up.
    CLEANUP
    CoUninitialize();
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2019-10-27T13:05:18.440

Raymond Chen 在他的博客中谈到了这一点：

[如何从提升的流程中启动未提升的流程，反之亦然？](https://devblogs.microsoft.com/oldnewthing/?p=2643)

在 GitHub 中搜索此代码的 C# 版本，我在 Microsoft 的**Visual Studio 存储库的 Node.js 工具**中找到了以下实现：[SystemUtilities.cs](https://github.com/microsoft/nodejstools/blob/master/Nodejs/Product/Nodejs/SharedProject/SystemUtilities.cs)（`ExecuteProcessUnElevated`函数）。

以防文件消失，这是文件的内容：

```
// Copyright (c) Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0\.  See License.txt in the project root for license information.

using System;
using System.Runtime.InteropServices;

namespace Microsoft.NodejsTools.SharedProject
{
    /// <summary>
    /// Utility for accessing window IShell* interfaces in order to use them to launch a process unelevated
    /// </summary>
    internal class SystemUtility
    {
        /// <summary>
        /// We are elevated and should launch the process unelevated. We can't create the
        /// process directly without it becoming elevated. So to workaround this, we have
        /// explorer do the process creation (explorer is typically running unelevated).
        /// </summary>
        internal static void ExecuteProcessUnElevated(string process, string args, string currentDirectory = "")
        {
            var shellWindows = (IShellWindows)new CShellWindows();

            // Get the desktop window
            object loc = CSIDL_Desktop;
            object unused = new object();
            int hwnd;
            var serviceProvider = (IServiceProvider)shellWindows.FindWindowSW(ref loc, ref unused, SWC_DESKTOP, out hwnd, SWFO_NEEDDISPATCH);

            // Get the shell browser
            var serviceGuid = SID_STopLevelBrowser;
            var interfaceGuid = typeof(IShellBrowser).GUID;
            var shellBrowser = (IShellBrowser)serviceProvider.QueryService(ref serviceGuid, ref interfaceGuid);

            // Get the shell dispatch
            var dispatch = typeof(IDispatch).GUID;
            var folderView = (IShellFolderViewDual)shellBrowser.QueryActiveShellView().GetItemObject(SVGIO_BACKGROUND, ref dispatch);
            var shellDispatch = (IShellDispatch2)folderView.Application;

            // Use the dispatch (which is unelevated) to launch the process for us
            shellDispatch.ShellExecute(process, args, currentDirectory, string.Empty, SW_SHOWNORMAL);
        }

        /// <summary>
        /// Interop definitions
        /// </summary>
        private const int CSIDL_Desktop = 0;
        private const int SWC_DESKTOP = 8;
        private const int SWFO_NEEDDISPATCH = 1;
        private const int SW_SHOWNORMAL = 1;
        private const int SVGIO_BACKGROUND = 0;
        private readonly static Guid SID_STopLevelBrowser = new Guid("4C96BE40-915C-11CF-99D3-00AA004AE837");

        [ComImport]
        [Guid("9BA05972-F6A8-11CF-A442-00A0C90A8F39")]
        [ClassInterfaceAttribute(ClassInterfaceType.None)]
        private class CShellWindows
        {
        }

        [ComImport]
        [Guid("85CB6900-4D95-11CF-960C-0080C7F4EE85")]
        [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
        private interface IShellWindows
        {
            [return: MarshalAs(UnmanagedType.IDispatch)]
            object FindWindowSW([MarshalAs(UnmanagedType.Struct)] ref object pvarloc, [MarshalAs(UnmanagedType.Struct)] ref object pvarlocRoot, int swClass, out int pHWND, int swfwOptions);
        }

        [ComImport]
        [Guid("6d5140c1-7436-11ce-8034-00aa006009fa")]
        [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
        private interface IServiceProvider
        {
            [return: MarshalAs(UnmanagedType.Interface)]
            object QueryService(ref Guid guidService, ref Guid riid);
        }

        [ComImport]
        [Guid("000214E2-0000-0000-C000-000000000046")]
        [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
        private interface IShellBrowser
        {
            void VTableGap01(); // GetWindow
            void VTableGap02(); // ContextSensitiveHelp
            void VTableGap03(); // InsertMenusSB
            void VTableGap04(); // SetMenuSB
            void VTableGap05(); // RemoveMenusSB
            void VTableGap06(); // SetStatusTextSB
            void VTableGap07(); // EnableModelessSB
            void VTableGap08(); // TranslateAcceleratorSB
            void VTableGap09(); // BrowseObject
            void VTableGap10(); // GetViewStateStream
            void VTableGap11(); // GetControlWindow
            void VTableGap12(); // SendControlMsg
            IShellView QueryActiveShellView();
        }

        [ComImport]
        [Guid("000214E3-0000-0000-C000-000000000046")]
        [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
        private interface IShellView
        {
            void VTableGap01(); // GetWindow
            void VTableGap02(); // ContextSensitiveHelp
            void VTableGap03(); // TranslateAcceleratorA
            void VTableGap04(); // EnableModeless
            void VTableGap05(); // UIActivate
            void VTableGap06(); // Refresh
            void VTableGap07(); // CreateViewWindow
            void VTableGap08(); // DestroyViewWindow
            void VTableGap09(); // GetCurrentInfo
            void VTableGap10(); // AddPropertySheetPages
            void VTableGap11(); // SaveViewState
            void VTableGap12(); // SelectItem

            [return: MarshalAs(UnmanagedType.Interface)]
            object GetItemObject(UInt32 aspectOfView, ref Guid riid);
        }

        [ComImport]
        [Guid("00020400-0000-0000-C000-000000000046")]
        [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
        private interface IDispatch
        {
        }

        [ComImport]
        [Guid("E7A1AF80-4D96-11CF-960C-0080C7F4EE85")]
        [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
        private interface IShellFolderViewDual
        {
            object Application { [return: MarshalAs(UnmanagedType.IDispatch)] get; }
        }

        [ComImport]
        [Guid("A4C6892C-3BA9-11D2-9DEA-00C04FB16162")]
        [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
        public interface IShellDispatch2
        {
            void ShellExecute([MarshalAs(UnmanagedType.BStr)] string File, [MarshalAs(UnmanagedType.Struct)] object vArgs, [MarshalAs(UnmanagedType.Struct)] object vDir, [MarshalAs(UnmanagedType.Struct)] object vOperation, [MarshalAs(UnmanagedType.Struct)] object vShow);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-12-26T16:40:48.470

我有同样的要求，我找到了使用 Windows 的任务调度程序服务的解决方案。

因此，首先将[库添加`Task Scheduler Managed Wrapper`](https://taskscheduler.codeplex.com/) [到您的项目](https://www.nuget.org/packages/TaskScheduler/)并使用此代码创建任务，将其配置为以受限用户 ( `td.Principal.RunLevel = TaskRunLevel.LUA;`) 运行，注册任务，运行任务，完成后删除任务。

```
// Get the service on the local machine
using (var ts = new TaskService())
{
     const string taskName = "foo";

     // Create a new task definition and assign properties
     var td = ts.NewTask();
     td.RegistrationInfo.Description = "start foo.exe as limited user";

     // Create an action that will launch foo.exe, with argument bar in workingdir C:\\
     td.Actions.Add(new ExecAction("C:\\foo.exe", "bar", "C:\\"));

     td.Settings.Priority = ProcessPriorityClass.Normal;

     // run with limited token
     td.Principal.RunLevel = TaskRunLevel.LUA;

     td.Settings.AllowDemandStart = true;

     td.Settings.DisallowStartIfOnBatteries = false;

     td.Settings.StopIfGoingOnBatteries = false;

     // Register the task in the root folder
     var ret = ts.RootFolder.RegisterTaskDefinition(taskName, td);

     var fooTask = ts.FindTask(taskName, true);
     if (null != fooTask )
     {
         if (fooTask.Enabled)
         {
             fooTask.Run();

             Thread.Sleep(TimeSpan.FromSeconds(1));

             // find process and wait for Exit
             var processlist = Process.GetProcesses();

             foreach(var theprocess in processlist)
             {
                 if (theprocess.ProcessName != "foo")
                    continue;

                 theprocess.WaitForExit();
                 break;
             }
         }
    }

    // Remove the task we just created
    ts.RootFolder.DeleteTask(taskName);
} 
```

# python - 你能列出函数接收的关键字参数吗？

> ID：196960
> 
> 赞同：116
> 
> 时间：2008-10-13T07:55:18.290
> 
> 标签：python, arguments, introspection

我有一个字典，我需要将键/值作为关键字参数传递.. 例如..

```
d_args = {'kw1': 'value1', 'kw2': 'value2'}
example(**d_args) 
```

这很好用，*但是*如果 d_args dict 中有函数不接受的`example`值，它显然会死掉。假设示例函数定义为`def example(kw2):`

这是一个问题，因为我不控制`d_args`或`example`函数的生成。它们都来自外部模块，并且`example`只接受来自字典的一些关键字参数。

理想情况下我会做

```
parsed_kwargs = feedparser.parse(the_url)
valid_kwargs = get_valid_kwargs(parsed_kwargs, valid_for = PyRSS2Gen.RSS2)
PyRSS2Gen.RSS2(**valid_kwargs) 
```

我可能会从有效的关键字参数列表中过滤字典，但我想知道：**有没有办法以编程方式列出特定函数采用的关键字参数？**

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-10-13T09:02:23.973

比直接检查代码对象并计算变量更好的是使用检查模块。

```
>>> import inspect
>>> def func(a,b,c=42, *args, **kwargs): pass
>>> inspect.getargspec(func)
(['a', 'b', 'c'], 'args', 'kwargs', (42,)) 
```

如果你想知道它是否可以用一组特定的参数调用，你需要没有指定默认值的参数。这些可以通过：

```
def getRequiredArgs(func):
    args, varargs, varkw, defaults = inspect.getargspec(func)
    if defaults:
        args = args[:-len(defaults)]
    return args   # *args and **kwargs are not required, so ignore them. 
```

然后一个函数来告诉你从你的特定字典中缺少什么是：

```
def missingArgs(func, argdict):
    return set(getRequiredArgs(func)).difference(argdict) 
```

同样，要检查无效参数，请使用：

```
def invalidArgs(func, argdict):
    args, varargs, varkw, defaults = inspect.getargspec(func)
    if varkw: return set()  # All accepted
    return set(argdict) - set(args) 
```

因此，如果它是可调用的，那么一个完整的测试是：

```
def isCallableWithArgs(func, argdict):
    return not missingArgs(func, argdict) and not invalidArgs(func, argdict) 
```

（这仅在 python 的 arg 解析方面是好的。显然无法检测到任何运行时检查 kwargs 中的无效值。）

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-13T08:09:15.390

这将打印所有可传递参数的名称，关键字和非关键字：

```
def func(one, two="value"):
    y = one, two
    return y
print func.func_code.co_varnames[:func.func_code.co_argcount] 
```

这是因为首先`co_varnames`始终是参数（接下来是局部变量，`y`如上例所示）。

所以现在你可以有一个功能：

```
def getValidArgs(func, argsDict):
    '''Return dictionary without invalid function arguments.'''
    validArgs = func.func_code.co_varnames[:func.func_code.co_argcount]
    return dict((key, value) for key, value in argsDict.iteritems() 
                if key in validArgs) 
```

然后你可以像这样使用它：

```
>>> func(**getValidArgs(func, args)) 
```

* * *

**编辑**：一个小补充：如果你**真的只需要**一个函数的关键字参数，你可以使用`func_defaults`属性来提取它们：

```
def getValidKwargs(func, argsDict):
    validArgs = func.func_code.co_varnames[:func.func_code.co_argcount]
    kwargsLen = len(func.func_defaults) # number of keyword arguments
    validKwargs = validArgs[-kwargsLen:] # because kwargs are last
    return dict((key, value) for key, value in argsDict.iteritems() 
                if key in validKwargs) 
```

您现在可以使用已知 args 调用您的函数，但提取 kwargs，例如：

```
func(param1, param2, **getValidKwargs(func, kwargsDict)) 
```

这假设在其签名中`func`使用 no`*args`或magic。`**kwargs`

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-07-28T12:01:19.573

对于 Python 3 解决方案，您可以[`inspect.signature`](https://docs.python.org/3/library/inspect.html#inspect.signature)根据您想了解[的参数类型使用和过滤。](https://docs.python.org/3/library/inspect.html#inspect.Parameter.kind)

使用带有位置或关键字、仅关键字、var 位置和 var 关键字参数的示例函数：

```
def spam(a, b=1, *args, c=2, **kwargs):
    print(a, b, args, c, kwargs) 
```

您可以为它创建一个签名对象：

```
from inspect import signature
sig =  signature(spam) 
```

然后使用列表理解进行过滤以找出您需要的详细信息：

```
>>> # positional or keyword
>>> [p.name for p in sig.parameters.values() if p.kind == p.POSITIONAL_OR_KEYWORD]
['a', 'b']
>>> # keyword only
>>> [p.name for p in sig.parameters.values() if p.kind == p.KEYWORD_ONLY]
['c'] 
```

并且，类似地，对于使用`p.VAR_POSITIONAL`和 var 关键字的 var 位置`VAR_KEYWORD`。

此外，您可以在 if 中添加一个子句，通过检查 if `p.default`equals来检查是否存在默认值`p.empty`。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-13T09:32:56.580

在 Python 3.0 中：

```
>>> import inspect
>>> import fileinput
>>> print(inspect.getfullargspec(fileinput.input))
FullArgSpec(args=['files', 'inplace', 'backup', 'bufsize', 'mode', 'openhook'],
varargs=None, varkw=None, defaults=(None, 0, '', 0, 'r', None), kwonlyargs=[], 
kwdefaults=None, annotations={}) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-13T08:20:20.657

扩展 DzinX 的答案：

```
argnames = example.func_code.co_varnames[:func.func_code.co_argcount]
args = dict((key, val) for key,val in d_args.iteritems() if key in argnames)
example(**args) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-06-05T22:55:46.640

只需将其用于函数名称“myfun”：

```
myfun.__code__.co_varnames 
```

# javascript - jQuery UI 在哪里适合 MVC？

> ID：196966
> 
> 赞同：4
> 
> 时间：2008-10-13T07:58:20.827
> 
> 标签：javascript, model-view-controller, jquery-plugins

我需要为我正在构建的 ASP.NET MVC 应用程序开发一个通用的基于 jQuery 的搜索插件，但我无法弄清楚它应该如何适应，或者最佳实践是什么。我想做以下事情：

```
$().ready(function() {
    $('#searchHolder').customSearch('MyApp.Models.User');
}); 
```

只要我在 Models.User 上实现了特定的接口，jQuery 就能够与反射服务对话以通用地构建相关的 UI。

听起来很有趣，但似乎我现在正在从 View 调用 JavaScript，这反过来会执行一些与 View 相关的活动来构建搜索 UI，然后进行搜索并与将要执行的用户交互在那里扔一堆控制器任务。

那么这真的适合哪里呢？有没有一种不同的方式可以构建我的 jQuery 插件，使其更符合 MVC 的理念？*当 MVC在*另一个 MVC 结构中缩小到自己的形式时，它是否可以工作？为了一个插件，我应该忽略这些问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T08:07:57.513

只是为了跟进（我很惊讶没有其他人对此有任何意见），为了保持最佳实践，我选择采用[jTemplates](http://jtemplates.tpython.com/)。

它使我能够从我的服务器端控制器请求一些模型样式的 JSON，并使用类似于我已经在视图中使用的语法来处理它，它现在保持任何所需的 JavaScript UI MVC 兼容。客户端需要从服务器请求 View 模板有一点开销，但是如果这变得太慢，我总是可以牺牲一点，然后将其与初始 JSON 请求一起发送。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T08:46:11.650

在我看来，你想要的是`partials`一个 RoR 术语，所以不确定它们在 ASP.NET MVC 中是否以相同的格式存在。基本上，partial 是在自己的文件中定义的 View 的一部分，可以从任何地方调用。因此，在您的搜索控制器中，您将拉出所要求的模型，进行一些反射以获取数据并将其构造为 JSON，并获取该模型的部分视图。如果您遵循基于模型名称命名部分的约定，您可能会发现它会更容易，从而节省您的任何大`switch`语句或额外的配置文件。

我可能是错的，但听起来你有点担心从 Javascript 调用 Controller 并返回 HTML。这完全没问题，它只是适当地获取 View 并确保您不处理页面的其余部分的情况，只处理该调用所需的内容（为什么 MVC 比 s 好得多`UpdatePanel`！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-14T05:11:34.827

所以我实际上已经对此进行了很多研究，并发现新的官方支持的 jquery 插件 tmpl 可以用作视图引擎。我在[这里写了一个教程](http://www.davidpirek.com/blog/javascript-mvc-view-engine-with-jquerytmpl-js)，如何在 JavaScript 中创建完整的 MVC/MVP 范例

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T08:22:26.283

我不确定我是否理解您要完成的工作，但我会在服务器上构建相关 UI 作为您视图的一部分（例如，作为可以在不同页面上呈现的用户控件），将其设置为 display:none样式并在客户端使用 JQuery 在用户单击某个链接或其他内容时显示它。

之后，插件将使用 $.ajax 将搜索请求发送到您的应用程序，您可以在其中执行相关活动并使用搜索结果呈现部分视图。然后，您的 ajax 代码会拾取它并将其插入到您的文档中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T08:33:18.257

就好像你有两个独立的系统一样，在服务器上有模型、视图和控制器，在客户端（浏览器）上有（Javascript/DOM）模型、视图和控制器。Ajax 只是客户端从服务器请求服务的方法。

# javascript - 使用 JavaScript 将字符串转换为标题大小写

> ID：196972
> 
> 赞同：688
> 
> 时间：2008-10-13T08:05:02.513
> 
> 标签：javascript, title-case

有没有一种简单的方法可以将字符串转换为标题大小写？例如`john smith`变成`John Smith`. 我不是在寻找像[John Resig 的解决方案](http://ejohn.org/blog/title-capitalization-in-javascript/)这样复杂的东西，只是（希望）某种单线或两线。

* * *

## 回答 #1

> 赞同：882
> 
> 时间：2008-10-13T08:18:26.823

尝试这个：

```
function toTitleCase(str) {
  return str.replace(
    /\w\S*/g,
    function(txt) {
      return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    }
  );
}
```

```
<form>
  Input:
  <br /><textarea name="input" onchange="form.output.value=toTitleCase(this.value)" onkeyup="form.output.value=toTitleCase(this.value)"></textarea>
  <br />Output:
  <br /><textarea name="output" readonly onclick="select(this)"></textarea>
</form>
```

* * *

## 回答 #2

> 赞同：246
> 
> 时间：2010-06-16T14:58:43.533

如果 CSS 解决方案满足您的需求，您可以将[text-transform](http://www.w3.org/TR/CSS2/text.html#caps-prop) CSS 样式应用于您的控件：

```
text-transform: capitalize; 
```

请注意，这将转变：
`hello world`到（无变化）`Hello World`
`HELLO WORLD`到（不正确）到（不正确）`HELLO WORLD`
`emily-jane o'brien``Emily-jane O'brien`
`Maria von Trapp``Maria Von Trapp`

* * *

## 回答 #3

> 赞同：219
> 
> 时间：2011-04-07T00:14:49.800

一种稍微优雅的方式，适应 Greg Dean 的功能：

```
String.prototype.toProperCase = function () {
    return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}; 
```

像这样称呼它：

```
"pascal".toProperCase(); 
```

* * *

## 回答 #4

> 赞同：154
> 
> 时间：2014-03-05T09:07:37.420

这是我的版本，IMO 它也很容易理解和优雅。

```
const str = "foo bar baz";
const newStr = str.split(' ')
   .map(w => w[0].toUpperCase() + w.substring(1).toLowerCase())
   .join(' ');
console.log(newStr);
```

* * *

## 回答 #5

> 赞同：113
> 
> 时间：2011-06-25T01:04:11.960

这是我的函数，它转换为标题大小写，但也将定义的首字母缩略词保留为大写字母，将次要单词保留为小写字母：

```
String.prototype.toTitleCase = function() {
  var i, j, str, lowers, uppers;
  str = this.replace(/([^\W_]+[^\s-]*) */g, function(txt) {
    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
  });

  // Certain minor words should be left lowercase unless 
  // they are the first or last words in the string
  lowers = ['A', 'An', 'The', 'And', 'But', 'Or', 'For', 'Nor', 'As', 'At', 
  'By', 'For', 'From', 'In', 'Into', 'Near', 'Of', 'On', 'Onto', 'To', 'With'];
  for (i = 0, j = lowers.length; i < j; i++)
    str = str.replace(new RegExp('\\s' + lowers[i] + '\\s', 'g'), 
      function(txt) {
        return txt.toLowerCase();
      });

  // Certain words such as initialisms or acronyms should be left uppercase
  uppers = ['Id', 'Tv'];
  for (i = 0, j = uppers.length; i < j; i++)
    str = str.replace(new RegExp('\\b' + uppers[i] + '\\b', 'g'), 
      uppers[i].toUpperCase());

  return str;
} 
```

例如：

```
"TO LOGIN TO THIS SITE and watch tv, please enter a valid id:".toTitleCase();
// Returns: "To Login to This Site and Watch TV, Please Enter a Valid ID:" 
```

* * *

## 回答 #6

> 赞同：55
> 
> 时间：2017-10-26T16:36:48.673

与其他答案相比，我更喜欢以下内容。它仅匹配每个单词的第一个字母并将其大写。更简单的代码，更容易阅读和更少的字节。它保留现有的大写字母以防止首字母缩略词失真。但是，您始终可以`toLowerCase()`先调用您的字符串。

```
function title(str) {
  return str.replace(/(^|\s)\S/g, function(t) { return t.toUpperCase() });
} 
```

您可以将其添加到您的字符串原型中，这将允许您执行`'my string'.toTitle()`以下操作：

```
String.prototype.toTitle = function() {
  return this.replace(/(^|\s)\S/g, function(t) { return t.toUpperCase() });
} 
```

**例子：**

```
String.prototype.toTitle = function() {
  return this.replace(/(^|\s)\S/g, function(t) { return t.toUpperCase() });
}

console.log('all lower case ->','all lower case'.toTitle());
console.log('ALL UPPER CASE ->','ALL UPPER CASE'.toTitle());
console.log("I'm a little teapot ->","I'm a little teapot".toTitle());
```

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2016-10-18T15:09:38.183

您可以立即`toLowerCase`输入字符串，然后只`toUpperCase`输入每个单词的第一个字母。变成了一个很简单的 1 班轮：

```
function titleCase(str) {
  return str.toLowerCase().replace(/\b(\w)/g, s => s.toUpperCase());
}

console.log(titleCase('iron man'));
console.log(titleCase('iNcrEdible hulK'));
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2013-12-24T15:17:55.510

```
var result =
  'this is very interesting'.replace(/\b[a-z]/g, (x) => x.toUpperCase())

console.log(result) // This Is Very Interesting
```

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2020-05-18T16:53:38.737

惊讶地看到没有人提到使用 rest 参数。这是一个使用 ES6 Rest 参数的简单单行程序。

```
let str="john smith"
str=str.split(" ").map(([firstChar,...rest])=>firstChar.toUpperCase()+rest.join("").toLowerCase()).join(" ")
console.log(str)
```

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2011-12-19T16:25:25.267

不使用正则表达式仅供参考：

```
String.prototype.toProperCase = function() {
  var words = this.split(' ');
  var results = [];
  for (var i = 0; i < words.length; i++) {
    var letter = words[i].charAt(0).toUpperCase();
    results.push(letter + words[i].slice(1));
  }
  return results.join(' ');
};

console.log(
  'john smith'.toProperCase()
)
```

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2020-11-19T10:56:39.100

# 基准

## TL;博士

这个基准测试的获胜者是普通的 for 循环：

```
function titleize(str) {
    let upper = true
    let newStr = ""
    for (let i = 0, l = str.length; i < l; i++) {
        // Note that you can also check for all kinds of spaces  with
        // str[i].match(/\s/)
        if (str[i] == " ") {
            upper = true
            newStr += str[i]
            continue
        }
        newStr += upper ? str[i].toUpperCase() : str[i].toLowerCase()
        upper = false
    }
    return newStr
}
// NOTE: you could beat that using charcode and string builder I guess. 
```

## 实际基准

我采用了最流行和最独特的答案，并以此[为基准](https://jsben.ch/bDBKL)。

这是我的 MacBook Pro 上的结果：

[![在此处输入图像描述](https://i.stack.imgur.com/Dc4ZU.png)](https://i.stack.imgur.com/Dc4ZU.png)

为了完整起见，这里是使用的函数：

```
str = "the QUICK BrOWn Fox jUMPS oVeR the LAzy doG";
function regex(str) {
  return str.replace(
    /\w\S*/g,
    function(txt) {
      return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    }
  );
}

function split(str) {
  return str.
    split(' ').
    map(w => w[0].toUpperCase() + w.substr(1).toLowerCase()).
    join(' ');
}

function complete(str) {
  var i, j, str, lowers, uppers;
  str = str.replace(/([^\W_]+[^\s-]*) */g, function(txt) {
    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
  });

  // Certain minor words should be left lowercase unless 
  // they are the first or last words in the string
  lowers = ['A', 'An', 'The', 'And', 'But', 'Or', 'For', 'Nor', 'As', 'At', 
  'By', 'For', 'From', 'In', 'Into', 'Near', 'Of', 'On', 'Onto', 'To', 'With'];
  for (i = 0, j = lowers.length; i < j; i++)
    str = str.replace(new RegExp('\\s' + lowers[i] + '\\s', 'g'), 
      function(txt) {
        return txt.toLowerCase();
      });

  // Certain words such as initialisms or acronyms should be left uppercase
  uppers = ['Id', 'Tv'];
  for (i = 0, j = uppers.length; i < j; i++)
    str = str.replace(new RegExp('\\b' + uppers[i] + '\\b', 'g'), 
      uppers[i].toUpperCase());

  return str;
}

function firstLetterOnly(str) {
  return str.replace(/\b(\S)/g, function(t) { return t.toUpperCase(); });
}

function forLoop(str) {
  let upper = true;
  let newStr = "";
  for (let i = 0, l = str.length; i < l; i++) {
    if (str[i] == " ") {
      upper = true;
        newStr += " ";
      continue;
    }
    newStr += upper ? str[i].toUpperCase() : str[i].toLowerCase();
    upper = false;
  }
  return newStr;
} 
```

请注意，我故意没有更改原型，因为我认为这是一种非常糟糕的做法，我认为我们不应该在我们的答案中推广这种做法。这仅适用于小型代码库，前提是您是唯一一个在处理它的人。

如果您想在此基准测试中添加任何其他方法，请评论答案的链接！

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2010-11-13T05:17:59.487

万一你担心那些填充词，你总是可以告诉函数什么不要大写。

```
/**
 * @param String str The text to be converted to titleCase.
 * @param Array glue the words to leave in lowercase. 
 */
var titleCase = function(str, glue){
    glue = (glue) ? glue : ['of', 'for', 'and'];
    return str.replace(/(\w)(\w*)/g, function(_, i, r){
        var j = i.toUpperCase() + (r != null ? r : "");
        return (glue.indexOf(j.toLowerCase())<0)?j:j.toLowerCase();
    });
}; 
```

希望这可以帮助你。

### 编辑

如果你想处理前导胶词，你可以用另外一个变量来跟踪这个：

```
var titleCase = function(str, glue){
    glue = !!glue ? glue : ['of', 'for', 'and', 'a'];
    var first = true;
    return str.replace(/(\w)(\w*)/g, function(_, i, r) {
        var j = i.toUpperCase() + (r != null ? r : '').toLowerCase();
        var result = ((glue.indexOf(j.toLowerCase()) < 0) || first) ? j : j.toLowerCase();
        first = false;
        return result;
    });
}; 
```

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2016-02-28T10:16:42.320

如果上述解决方案中使用的正则表达式让您感到困惑，请尝试以下代码：

```
function titleCase(str) {
  return str.split(' ').map(function(val){ 
    return val.charAt(0).toUpperCase() + val.substr(1).toLowerCase();
  }).join(' ');
} 
```

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2017-10-16T16:17:08.053

**如果您需要语法正确的答案：**

此答案考虑了诸如“of”、“from”、.. 等介词。输出将生成您希望在论文中看到的编辑风格标题。

**toTitleCase 函数**

考虑[此处列出](http://www.superheronation.com/2011/08/16/words-that-should-not-be-capitalized-in-titles/)的语法规则的函数。该函数还合并空格并删除特殊字符（根据您的需要修改正则表达式）

```
const toTitleCase = (str) => {
  const articles = ['a', 'an', 'the'];
  const conjunctions = ['for', 'and', 'nor', 'but', 'or', 'yet', 'so'];
  const prepositions = [
    'with', 'at', 'from', 'into','upon', 'of', 'to', 'in', 'for',
    'on', 'by', 'like', 'over', 'plus', 'but', 'up', 'down', 'off', 'near'
  ];

  // The list of spacial characters can be tweaked here
  const replaceCharsWithSpace = (str) => str.replace(/[^0-9a-z&/\\]/gi, ' ').replace(/(\s\s+)/gi, ' ');
  const capitalizeFirstLetter = (str) => str.charAt(0).toUpperCase() + str.substr(1);
  const normalizeStr = (str) => str.toLowerCase().trim();
  const shouldCapitalize = (word, fullWordList, posWithinStr) => {
    if ((posWithinStr == 0) || (posWithinStr == fullWordList.length - 1)) {
      return true;
    }

    return !(articles.includes(word) || conjunctions.includes(word) || prepositions.includes(word));
  }

  str = replaceCharsWithSpace(str);
  str = normalizeStr(str);

  let words = str.split(' ');
  if (words.length <= 2) { // Strings less than 3 words long should always have first words capitalized
    words = words.map(w => capitalizeFirstLetter(w));
  }
  else {
    for (let i = 0; i < words.length; i++) {
      words[i] = (shouldCapitalize(words[i], words, i) ? capitalizeFirstLetter(words[i], words, i) : words[i]);
    }
  }

  return words.join(' ');
} 
```

**单元测试以确保正确性**

```
import { expect } from 'chai';
import { toTitleCase } from '../../src/lib/stringHelper';

describe('toTitleCase', () => {
  it('Capitalizes first letter of each word irrespective of articles, conjunctions or prepositions if string is no greater than two words long', function(){
    expect(toTitleCase('the dog')).to.equal('The Dog'); // Capitalize articles when only two words long
    expect(toTitleCase('for all')).to.equal('For All'); // Capitalize conjunctions when only two words long
    expect(toTitleCase('with cats')).to.equal('With Cats'); // Capitalize prepositions when only two words long
  });

  it('Always capitalize first and last words in a string irrespective of articles, conjunctions or prepositions', function(){
    expect(toTitleCase('the beautiful dog')).to.equal('The Beautiful Dog');
    expect(toTitleCase('for all the deadly ninjas, be it so')).to.equal('For All the Deadly Ninjas Be It So');
    expect(toTitleCase('with cats and dogs we are near')).to.equal('With Cats and Dogs We Are Near');
  });

  it('Replace special characters with space', function(){
    expect(toTitleCase('[wolves & lions]: be careful')).to.equal('Wolves & Lions Be Careful');
    expect(toTitleCase('wolves & lions, be careful')).to.equal('Wolves & Lions Be Careful');
  });

  it('Trim whitespace at beginning and end', function(){
    expect(toTitleCase(' mario & Luigi superstar saga ')).to.equal('Mario & Luigi Superstar Saga');
  });

  it('articles, conjunctions and prepositions should not be capitalized in strings of 3+ words', function(){
    expect(toTitleCase('The wolf and the lion: a tale of two like animals')).to.equal('The Wolf and the Lion a Tale of Two like Animals');
    expect(toTitleCase('the  three Musketeers  And plus ')).to.equal('The Three Musketeers and Plus');
  });
}); 
```

请注意，我正在从提供的字符串中删除相当多的特殊字符。您将需要调整正则表达式以满足项目的要求。

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2010-02-03T22:22:57.930

我制作的这个函数可以处理姓氏（所以它不是标题大小写），例如“McDonald”或“MacDonald”或“O'Toole”或“D'Orazio”。但是，它不处理带有“van”或“von”的德国或荷兰名称，这些名称通常是小写的......我相信“de”通常也是小写的，例如“Robert de Niro”。这些仍然需要解决。

```
function toProperCase(s)
{
  return s.toLowerCase().replace( /\b((m)(a?c))?(\w)/g,
          function($1, $2, $3, $4, $5) { if($2){return $3.toUpperCase()+$4+$5.toUpperCase();} return $1.toUpperCase(); });
} 
```

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2016-10-27T15:52:59.370

ES 6

```
str.split(' ')
   .map(s => s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase())
   .join(' ') 
```

别的

```
str.split(' ').map(function (s) {
    return s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase();
}).join(' ') 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2016-12-29T11:27:16.273

如果您可以在代码中使用第三方库，那么 lodash 为我们提供了一个帮助函数。

[https://lodash.com/docs/4.17.3#startCase](https://lodash.com/docs/4.17.3#startCase)

```
_.startCase('foo bar');
// => 'Foo Bar'

_.startCase('--foo-bar--');
// => 'Foo Bar'

_.startCase('fooBar');
// => 'Foo Bar'

_.startCase('__FOO_BAR__');
// => 'FOO BAR'
```

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2017-09-30T09:28:55.817

首先，通过空格将其[拆分](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split)`string`为数组：

```
var words = str.split(' '); 
```

然后使用[array.map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map)创建一个包含大写单词的新数组。

```
var capitalized = words.map(function(word) {
    return word.charAt(0).toUpperCase() + word.substring(1, word.length);
}); 
```

然后用空格[加入](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join)新数组：

```
capitalized.join(" "); 
```

```
function titleCase(str) {
  str = str.toLowerCase(); //ensure the HeLlo will become Hello at the end
  var words = str.split(" ");

  var capitalized = words.map(function(word) {
    return word.charAt(0).toUpperCase() + word.substring(1, word.length);
  });
  return capitalized.join(" ");
}

console.log(titleCase("I'm a little tea pot"));
```

**笔记：**

这当然有一个缺点。这只会将每个单词的第一个字母大写。按单词，这意味着它将以空格分隔的每个字符串都视为 1 个单词。

假设你有：

`str = "I'm a little/small tea pot";`

这将产生

> 我是小/*小*茶壶

与预期相比

> 我是一个小/小茶壶

在这种情况下，使用 Regex 和[.replace](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace)就可以了：

**使用 ES6：**

```
const capitalize = str => str.length
  ? str[0].toUpperCase() +
    str.slice(1).toLowerCase()
  : '';

const escape = str => str.replace(/./g, c => `\\${c}`);
const titleCase = (sentence, seps = ' _-/') => {
  let wordPattern = new RegExp(`[^${escape(seps)}]+`, 'g');

  return sentence.replace(wordPattern, capitalize);
};
console.log( titleCase("I'm a little/small tea pot.") );
```

或者没有**ES6**：

```
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.substring(1, str.length).toLowerCase();
}

function titleCase(str) {
  return str.replace(/[^\ \/\-\_]+/g, capitalize);
}

console.log(titleCase("I'm a little/small tea pot."));
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2008-10-13T08:17:39.070

```
var toMatch = "john w. smith";
var result = toMatch.replace(/(\w)(\w*)/g, function (_, i, r) {
      return i.toUpperCase() + (r != null ? r : "");
    }
) 
```

似乎工作......用上面的测试，“快速棕色，狐狸？/jumps/ ^over^ ¡懒惰！狗......”和“C：/程序文件/一些供应商/他们的第二个应用程序/a文件 1.txt”。

如果您想要 2Nd 而不是 2nd，您可以更改为`/([a-z])(\w*)/g`.

第一种形式可以简化为：

```
function toTitleCase(toTransform) {
  return toTransform.replace(/\b([a-z])/g, function (_, initial) {
      return initial.toUpperCase();
  });
} 
```

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2014-07-16T14:59:34.077

这些答案中的大多数似乎都忽略了使用单词边界元字符 (\b) 的可能性。使用它的 Greg Dean 答案的简短版本：

```
function toTitleCase(str)
{
    return str.replace(/\b\w/g, function (txt) { return txt.toUpperCase(); });
} 
```

也适用于像 Jim-Bob 这样的连字符名称。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2017-06-06T09:52:45.213

试试这个，最短的方法：

```
str.replace(/(^[a-z])|(\s+[a-z])/g, txt => txt.toUpperCase()); 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2012-05-16T19:05:54.217

尝试这个

```
String.prototype.toProperCase = function(){
    return this.toLowerCase().replace(/(^[a-z]| [a-z]|-[a-z])/g, 
        function($1){
            return $1.toUpperCase();
        }
    );
}; 
```

例子

```
var str = 'john smith';
str.toProperCase(); 
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2017-07-07T05:01:37.553

我认为最简单的是使用css。

```
function format_str(str) {
    str = str.toLowerCase();
    return '<span style="text-transform: capitalize">'+ str +'</span>';
} 
```

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2019-06-21T08:30:25.190

```
"john f. kennedy".replace(/\b\S/g, t => t.toUpperCase()) 
```

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2020-11-19T10:39:00.610

这是一个非常简单和简洁的 ES6 函数来做到这一点：

```
const titleCase = (str) => {
  return str.replace(/\w\S*/g, (t) => { return t.charAt(0).toUpperCase() + t.substr(1).toLowerCase() });
}

export default titleCase; 
```

很好地包含在一个`utilities`文件夹中，并按如下方式使用：

```
import titleCase from './utilities/titleCase.js';

const string = 'my title & string';

console.log(titleCase(string)); //-> 'My Title & String' 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2016-12-11T16:36:57.053

这是我处理重音字符的函数（对法语很重要！），并且可以打开/关闭对降低异常的处理。希望有帮助。

```
String.prototype.titlecase = function(lang, withLowers = false) {
    var i, string, lowers, uppers;

    string = this.replace(/([^\s:\-'])([^\s:\-']*)/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    }).replace(/Mc(.)/g, function(match, next) {
        return 'Mc' + next.toUpperCase();
    });

    if (withLowers) {
        if (lang == 'EN') {
            lowers = ['A', 'An', 'The', 'At', 'By', 'For', 'In', 'Of', 'On', 'To', 'Up', 'And', 'As', 'But', 'Or', 'Nor', 'Not'];
        }
        else {
            lowers = ['Un', 'Une', 'Le', 'La', 'Les', 'Du', 'De', 'Des', 'À', 'Au', 'Aux', 'Par', 'Pour', 'Dans', 'Sur', 'Et', 'Comme', 'Mais', 'Ou', 'Où', 'Ne', 'Ni', 'Pas'];
        }
        for (i = 0; i < lowers.length; i++) {
            string = string.replace(new RegExp('\\s' + lowers[i] + '\\s', 'g'), function(txt) {
                return txt.toLowerCase();
            });
        }
    }

    uppers = ['Id', 'R&d'];
    for (i = 0; i < uppers.length; i++) {
        string = string.replace(new RegExp('\\b' + uppers[i] + '\\b', 'g'), uppers[i].toUpperCase());
    }

    return string;
} 
```

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2016-06-20T20:31:25.903

用于`/\S+/g`支持变音符号：

```
function toTitleCase(str) {
  return str.replace(/\S+/g, str => str.charAt(0).toUpperCase() + str.substr(1).toLowerCase());
}

console.log(toTitleCase("a city named örebro")); // A City Named Örebro
```

但是：“ **s** unshine ( **y** ellow)” ⇒ “ **S** unshine ( **y** ellow)”

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2018-10-25T12:12:14.250

这是使用 css 的另一个解决方案（和 javascript，如果要转换的文本是大写的）：

**html**

```
<span id='text'>JOHN SMITH</span> 
```

**js**

```
var str = document.getElementById('text').innerHtml;
var return_text = str.toLowerCase(); 
```

**css**

```
#text{text-transform:capitalize;} 
```

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2014-09-30T18:52:16.307

采用“lewax00”解决方案，我创建了这个简单的解决方案，它强制以“w”开头的空格或“w”开始 de word，但无法删除额外的中间空格。

```
"SOFÍA vergara".toLowerCase().replace(/\b(\s\w|^\w)/g, function (txt) { return txt.toUpperCase(); });
```

结果是“Sofía Vergara”。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2020-05-16T20:42:51.123

**将单个单词转换为标题大小写的简单方法**

*使用“切片”方法和字符串连接*

```
str.slice(0, 1).toUpperCase() + str.slice(1, str.length) 
```

*如果要将单词的其余部分小写，请在末尾添加 .toLowerCase()

*使用 ES6 扩展运算符、映射和连接*

```
[...str].map((w, i) => i === 0 ? w[0].toUpperCase() : w).join('') 
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2017-07-18T13:13:45.480

我们一直在办公室进行讨论，我们认为尝试自动更正人们以您希望的当前方式输入姓名的方式可能会出现问题。

我们提出了几种不同类型的自动大写字母分崩离析的案例，这些案例**仅适用于英文名称，每种语言都有其自身的复杂性。**

**将每个名称的第一个字母大写的问题：**

• 不允许输入IBM 等首字母缩写词，会变成Ibm。

• 麦当劳的名字会变成麦当劳，这是不正确的，同样的事情也是麦当劳。

• Marie-Tonks 等双桶名称将变成 Marie-tonks。

• 像O'Connor 这样的名字会变成O'connor。

**对于其中的大多数，您可以编写自定义规则来处理它，但是，这仍然像以前一样与 Acronyms 存在问题，并且您会遇到一个新问题：**

• 添加一个规则来修复Mac 的名称，例如MacDonald，是否会破坏名称，例如Macy 将其变成MacY。

我们提出的唯一永远不会错误的解决方案是将每个字母大写，这是 DBS 似乎也使用的蛮力方法。

因此，如果您想自动化该过程，那么如果没有包含每个名称和单词的字典以及应该如何大写它，那是不可能的，**如果您没有涵盖所有内容的规则，请不要使用它只会惹恼您的用户，并提示想要正确输入姓名的人去其他地方。**

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2019-08-13T23:31:59.247

我的单线解决方案：

```
String.prototype.capitalizeWords = function() {
    return this.split(" ").map(function(ele){ return ele[0].toUpperCase() + ele.slice(1).toLowerCase();}).join(" ");
}; 
```

`capitalizeWords()`然后，您可以在任何字符串上调用该方法。例如：

```
var myS = "this actually works!";
myS.capitalizeWords();

>>> This Actually Works 
```

我的另一个解决方案：

```
function capitalizeFirstLetter(word) {
    return word[0].toUpperCase() + word.slice(1).toLowerCase();
}
String.prototype.capitalizeAllWords = function() {
    var arr = this.split(" ");
    for(var i = 0; i < arr.length; i++) {
        arr[i] = capitalizeFirstLetter(arr[i]);
    }
    return arr.join(" ");
}; 
```

`capitalizeWords()`然后，您可以在任何字符串上调用该方法。例如：

```
var myStr = "this one works too!";
myStr.capitalizeWords();

>>> This One Works Too 
```

*基于 Greg Dean 答案的替代解决方案：*

```
function capitalizeFirstLetter(word) {
    return word[0].toUpperCase() + word.slice(1).toLowerCase();
}
String.prototype.capitalizeWords = function() {
    return this.replace(/\w\S*/g, capitalizeFirstLetter);
}; 
```

`capitalizeWords()`然后，您可以在任何字符串上调用该方法。例如：

```
var myString = "yes and no";
myString.capitalizeWords()

>>> Yes And No 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2020-11-18T12:17:38.667

使用正则表达式的单行，获取`\g`words 的所有起始字符`\b[a-zA-Z]`，并应用`.toUpperCase()`

```
const textString = "Convert string to title case with Javascript.";
const converted = textString.replace(/\b[a-zA-Z]/g, (match) => match.toUpperCase());
console.log(converted)
```

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2020-12-06T11:42:09.403

这是我的回答伙计们，如果您的问题解决了，请发表评论并点赞。

```
function toTitleCase(str) {
  return str.replace(
    /(\w*\W*|\w*)\s*/g,
    function(txt) {
    return(txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase())
    }
  ); 
}
```

```
<form>
  Input:
  <br /><textarea name="input" onchange="form.output.value=toTitleCase(this.value)" onkeyup="form.output.value=toTitleCase(this.value)"></textarea>
  <br />Output:
  <br /><textarea name="output" readonly onclick="select(this)"></textarea>
</form>
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2015-11-19T22:29:38.193

这是基于我对[FreeCodeCamp 的 Bonfire "Title Case" 的](http://www.freecodecamp.com/challenges/bonfire-title-case-a-sentence)解决方案，它要求您首先将给定的字符串转换为全部小写，然后将每个字符转换为大写。

不使用正则表达式：

```
function titleCase(str) {
 return str.toLowerCase().split(' ').map(function(val) { return val.replace(val[0], val[0].toUpperCase()); }).join(' ');
} 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2019-01-09T07:15:56.770

[https://lodash.com/docs/4.17.11#capitalize](https://lodash.com/docs/4.17.11#capitalize)

使用 Lodash 库..!! 更可靠

```
_.capitalize('FRED'); => 'Fred' 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2022-01-12T13:10:12.580

我已经为土耳其语测试了这个解决方案，它也适用于特殊字符。

```
function toTitleCase(str) {
  return str.toLocaleLowerCase().replace(
    /(^|\w)\S*/g,
    (txt) => txt.charAt(0).toLocaleUpperCase() + txt.substring(1),
  )
}

console.log(toTitleCase('İSMAİL HAKKI'))
console.log(toTitleCase('ŞAHMARAN BİNBİR GECE MASALLARI'))
```

因为我有所有大写数据，所以我在开始时添加了“toLocaleLowerCase”。如果你不需要它，你可以丢弃它。

使用语言环境操作对于非英语语言很重要。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2020-04-09T14:16:12.797

我的列表基于三个快速搜索。一个用于不大写的单词列表，一个用于完整的介词列表。

最后一次搜索*建议*介词 5 个或更长的字母应该大写，这是我喜欢的。我的目的是非正式使用。我在他们中留下了“没有”，因为它是与 with 的明显对应物。

所以它将首字母缩略词、标题的第一个字母和大多数单词的第一个字母大写。

它不打算处理大写锁定的单词。我想离开那些人。

```
function camelCase(str) {
  return str.replace(/((?:^|\.)\w|\b(?!(?:a|amid|an|and|anti|as|at|but|but|by|by|down|for|for|for|from|from|in|into|like|near|nor|of|of|off|on|on|onto|or|over|past|per|plus|save|so|than|the|to|to|up|upon|via|with|without|yet)\b)\w)/g, function(character) {
  return character.toUpperCase();
})}

console.log(camelCase('The quick brown fox jumped over the lazy dog, named butter, who was taking a nap outside the u.s. Post Office. The fox jumped so high that NASA saw him on their radar.'));
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2017-06-06T10:19:50.497

对于我们这些害怕正则表达式的人（大声笑）：

```
function titleCase(str)
{
    var words = str.split(" ");
    for ( var i = 0; i < words.length; i++ )
    {
        var j = words[i].charAt(0).toUpperCase();
        words[i] = j + words[i].substr(1);
    }
    return words.join(" ");
}
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2021-05-21T18:10:00.443

您可以将第一个字符大写并与剩余的字符串连接。

```
let str = 'john smith';
let res = str.split(" ");
res.forEach((w, index) => {
    res[index] =  w.charAt(0).toUpperCase().concat(w.slice(1, w.length))
});
res = res.join(" ");
console.log(res);
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2015-04-21T00:28:22.017

这并不短，但这是我最近在学校的一项作业中想到的：

```
var myPoem = 'What is a jQuery but a misunderstood object?'
//What is a jQuery but a misunderstood object? --> What Is A JQuery But A Misunderstood Object?

  //code here
var capitalize = function(str) {
  var strArr = str.split(' ');
  var newArr = [];
  for (var i = 0; i < strArr.length; i++) {
    newArr.push(strArr[i].charAt(0).toUpperCase() + strArr[i].slice(1))
  };
  return newArr.join(' ')  
}

var fixedPoem = capitalize(myPoem);
alert(fixedPoem);
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2015-09-09T17:12:16.447

更简单更高效的版本，具有简单的缓存。

```
 var TITLE_CASE_LOWER_MAP = {
    'a': 1, 'an': 1, 'and': 1, 'as': 1, 'at': 1, 'but': 1, 'by': 1, 'en':1, 'with': 1,
    'for': 1, 'if': 1, 'in': 1, 'of': 1, 'on': 1, 'the': 1, 'to': 1, 'via': 1
  };

  // LEAK/CACHE TODO: evaluate using LRU.
  var TITLE_CASE_CACHE = new Object();

  toTitleCase: function (title) {
    if (!title) return null;

    var result = TITLE_CASE_CACHE[title];
    if (result) {
      return result;
    }

    result = "";
    var split = title.toLowerCase().split(" ");
    for (var i=0; i < split.length; i++) {

      if (i > 0) {
        result += " ";
      }

      var word = split[i];
      if (i == 0 || TITLE_CASE_LOWER_MAP[word] != 1) {
        word = word.substr(0,1).toUpperCase() + word.substr(1);
      }

      result += word;
    }

    TITLE_CASE_CACHE[title] = result;

    return result;
  },
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2016-05-02T20:38:11.290

我对问题的简单易行的版本：

```
 function titlecase(str){
    var arr=[];  
    var str1=str.split(' ');
    for (var i = 0; i < str1.length; i++) {
    var upper= str1[i].charAt(0).toUpperCase()+ str1[i].substr(1);
    arr.push(upper);
     };
      return arr.join(' ');
    }
    titlecase('my name is suryatapa roy'); 
```

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2018-07-15T06:55:06.760

`this is a test`--->`This Is A Test`

```
function capitalize(str) {

  const word = [];

  for (let char of str.split(' ')) {
    word.push(char[0].toUpperCase() + char.slice(1))
  }

  return word.join(' ');

}

console.log(capitalize("this is a test"));
```

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2015-08-06T20:19:40.593

Greg Dean 解决方案的原型解决方案：

```
String.prototype.capitalize = function() {
  return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
} 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2018-03-21T04:33:49.100

有一些很好的答案，但是，很多人使用正则表达式来查找单词，但是，由于某种原因，没有其他人使用正则表达式来替换第一个字符。为了解释，我将提供一个较长的解决方案和一个较短的解决方案。

长解决方案（更具解释性）。通过使用正则表达式`[^\s_\-/]*`，我们可以找到句子中的每个单词。随后，我们可以使用正则表达式`.`来匹配单词中的第一个字符。对这两个都使用正则表达式版本的替换，我们可以像这样更改解决方案：

```
function toUpperCase(str) { return str.toUpperCase(); }
function capitalizeWord(word) { return word.replace(/./, toUpperCase); }
function capitalize(sentence) { return sentence.toLowerCase().replace(/[^\s_\-/]*/g, capitalizeWord); }

console.log(capitalize("hello world")); // Outputs: Hello World
```

对于做同样事情的单个函数，我们嵌套`replace`调用如下：

```
function capitalize(sentence) {
  return sentence.toLowerCase().replace(/[^\s_\-/]*/g, function (word) {
    return word.replace(/./, function (ch) { return ch.toUpperCase(); } );
  } );
}

console.log(capitalize("hello world")); // Outputs: Hello World
```

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2017-06-26T23:33:12.043

这是该问题的紧凑解决方案：

```
function Title_Case(phrase) 
{
  var revised = phrase.charAt(0).toUpperCase();

  for ( var i = 1; i < phrase.length; i++ ) {

    if (phrase.charAt(i - 1) == " ") {
     revised += phrase.charAt(i).toUpperCase(); }
    else {
     revised += phrase.charAt(i).toLowerCase(); }

   }

return revised;
} 
```

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2019-10-18T13:13:28.417

使用 lodash 的解决方案 -

```
import { words, lowerCase, capitalize, endsWith, padEnd } from 'lodash';
const titleCase = string =>
  padEnd(
    words(string, /[^ ]+/g)
      .map(lowerCase)
      .map(capitalize)
      .join(' '),
    string.length,
  ); 
```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2022-01-01T03:13:52.170

吉姆鲍勃 -> 吉姆鲍勃

吉姆/鲍勃 -> 吉姆/鲍勃

jim_bob -> Jim_Bob

不是 -> 不是

École -> École

麦当劳 -> 麦当劳

```
function toTitleCase(str) {
  return str.replace(/\p{L}+('\p{L}+)?/gu, function(txt) {
    return txt.charAt(0).toUpperCase() + txt.slice(1)
  }
} 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2019-02-05T03:15:58.490

约翰史密斯 -> 约翰史密斯

```
'john smith'.replace(/(^\w|\s+\w){1}/g, function(str){ return str.toUpperCase() } ); 
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2016-10-17T15:27:14.907

强大的函数式编程方式`Title Case Function`

**Exaplin 版本**

```
function toTitleCase(input){
    let output = input
        .split(' ')  // 'HOw aRe YOU' => ['HOw' 'aRe' 'YOU']
        .map((letter) => {
            let firstLetter = letter[0].toUpperCase() // H , a , Y  => H , A , Y
            let restLetters = letter.substring(1).toLowerCase() // Ow, Re, OU => ow, re, ou
            return firstLetter + restLetters // conbine together
        })
        .join(' ') //['How' 'Are' 'You'] => 'How Are You'
    return output
} 
```

**实施版本**

```
function toTitleCase(input){
    return input
            .split(' ')
            .map(i => i[0].toUpperCase() + i.substring(1).toLowerCase())
            .join(' ') 
}

toTitleCase('HoW ARe yoU') // reuturn 'How Are You' 
```

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2022-02-02T16:30:50.250

如果您想使用 NPM 库，请查看[`title-case`](https://www.npmjs.com/package/title-case)：

安装：

```
npm install title-case --save 
```

用法：

```
import { titleCase } from "title-case";

titleCase("string"); //=> "String"
titleCase("follow step-by-step instructions"); //=> "Follow Step-by-Step Instructions" 
```

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2012-09-21T15:28:28.360

与 John Resig 的解决方案一样功能齐全，但作为单线：（基于[此 github 项目](https://github.com/gouch/to-title-case)）

```
function toTitleCase(e){var t=/^(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|vs?\.?|via)$/i;return e.replace(/([^\W_]+[^\s-]*) */g,function(e,n,r,i){return r>0&&r+n.length!==i.length&&n.search(t)>-1&&i.charAt(r-2)!==":"&&i.charAt(r-1).search(/[^\s-]/)<0?e.toLowerCase():n.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)})};

console.log( toTitleCase( "ignores mixed case words like iTunes, and allows AT&A and website.com/address etc..." ) ); 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2015-06-08T13:48:36.770

```
function toTitleCase(str) {
  var strnew = "";
  var i = 0;

  for (i = 0; i < str.length; i++) {
    if (i == 0) {
      strnew = strnew + str[i].toUpperCase();
    } else if (i != 0 && str[i - 1] == " ") {
      strnew = strnew + str[i].toUpperCase();
    } else {
      strnew = strnew + str[i];
    }
  }

  alert(strnew);
}

toTitleCase("hello world how are u"); 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2019-12-25T13:22:41.910

我认为您应该尝试使用此功能。

```
var toTitleCase = function (str) {
    str = str.toLowerCase().split(' ');
    for (var i = 0; i < str.length; i++) {
        str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1);
    }
    return str.join(' ');
}; 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2015-07-07T19:53:07.507

这是一条线的解决方案，如果你想转换字符串中的每一个工作，用“”分割字符串，迭代部分并将这个解决方案应用于每个部分，将每个转换的部分添加到一个数组中并用“”加入它。

```
var stringToConvert = 'john';
stringToConvert = stringToConvert.charAt(0).toUpperCase() + Array.prototype.slice.call(stringToConvert, 1).join('');
console.log(stringToConvert);
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2016-02-06T01:36:16.640

```
String.prototype.capitalize = function() {
    return this.toLowerCase().split(' ').map(capFirst).join(' ');
    function capFirst(str) {
        return str.length === 0 ? str : str[0].toUpperCase() + str.substr(1);
    }
} 
```

用法：

```
"hello world".capitalize() 
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2018-09-15T11:30:40.777

实现类似功能的另一种方法如下。

```
formatName(name) {
    let nam = '';
    name.split(' ').map((word, index) => {
        if (index === 0) {
            nam += word.split('').map((l, i) => i === 0 ? l.toUpperCase() : l.toLowerCase()).join('');
        } else {
            nam += ' ' + word.split('').map(l => l.toLowerCase()).join('');
        }
    });
    return nam;
} 
```

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2017-06-21T00:49:23.340

该解决方案在新句子中考虑标点符号、处理引文、将次要单词转换为小写并忽略首字母缩略词或全大写单词。

```
var stopWordsArray = new Array("a", "all", "am", "an", "and", "any", "are", "as", "at", "be", "but", "by", "can", "can't", "did", "didn't", "do", "does", "doesn't", "don't", "else", "for", "get", "gets", "go", "got", "had", "has", "he", "he's", "her", "here", "hers", "hi", "him", "his", "how", "i'd", "i'll", "i'm", "i've", "if", "in", "is", "isn't", "it", "it's", "its", "let", "let's", "may", "me", "my", "no", "of", "off", "on", "our", "ours", "she", "so", "than", "that", "that's", "thats", "the", "their", "theirs", "them", "then", "there", "there's", "these", "they", "they'd", "they'll", "they're", "they've", "this", "those", "to", "too", "try", "until", "us", "want", "wants", "was", "wasn't", "we", "we'd", "we'll", "we're", "we've", "well", "went", "were", "weren't", "what", "what's", "when", "where", "which", "who", "who's", "whose", "why", "will", "with", "won't", "would", "yes", "yet", "you", "you'd", "you'll", "you're", "you've", "your");

// Only significant words are transformed. Handles acronyms and punctuation
String.prototype.toTitleCase = function() {
    var newSentence = true;
    return this.split(/\s+/).map(function(word) {
        if (word == "") { return; }
        var canCapitalise = true;
        // Get the pos of the first alpha char (word might start with " or ')
        var firstAlphaCharPos = word.search(/\w/);
        // Check for uppercase char that is not the first char (might be acronym or all caps)
        if (word.search(/[A-Z]/) > 0) {
            canCapitalise = false;
        } else if (stopWordsArray.indexOf(word) != -1) {
            // Is a stop word and not a new sentence
            word.toLowerCase();
            if (!newSentence) {
                canCapitalise = false;
            }
        }
        // Is this the last word in a sentence?
        newSentence = (word.search(/[\.!\?:]['"]?$/) > 0)? true : false;
        return (canCapitalise)? word.replace(word[firstAlphaCharPos], word[firstAlphaCharPos].toUpperCase()) : word;
    }).join(' ');
}

// Pass a string using dot notation:
alert("A critical examination of Plato's view of the human nature".toTitleCase());
var str = "Ten years on: a study into the effectiveness of NCEA in New Zealand schools";
str.toTitleCase());
str = "\"Where to from here?\" the effectivness of eLearning in childhood education";
alert(str.toTitleCase());

/* Result:
A Critical Examination of Plato's View of the Human Nature.
Ten Years On: A Study Into the Effectiveness of NCEA in New Zealand Schools.
"Where to From Here?" The Effectivness of eLearning in Childhood Education. */ 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2018-09-05T00:58:51.763

一种使用reduce的方法

```
function titleCase(str) {
  const arr = str.split(" ");
  const result = arr.reduce((acc, cur) => {
    const newStr = cur[0].toUpperCase() + cur.slice(1).toLowerCase();
    return acc += `${newStr} `
  },"")
  return result.slice(0, result.length-1);
}
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2018-10-23T15:14:07.303

```
ES-6 way to get title case of a word or entire line.
ex. input = 'hEllo' --> result = 'Hello'
ex. input = 'heLLo woRLd' --> result = 'Hello World'

const getTitleCase = (str) => {
  if(str.toLowerCase().indexOf(' ') > 0) {
    return str.toLowerCase().split(' ').map((word) => {
      return word.replace(word[0], word[0].toUpperCase());
    }).join(' ');
  }
  else {
    return str.slice(0, 1).toUpperCase() + str.slice(1).toLowerCase();
  }
} 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2016-07-28T15:08:41.560

只是要添加到组合中的另一个版本。这还将检查 string.length 是否为 0：

```
String.prototype.toTitleCase = function() {
    var str = this;
    if(!str.length) {
        return "";
    }
    str = str.split(" ");
    for(var i = 0; i < str.length; i++) {
        str[i] = str[i].charAt(0).toUpperCase() + (str[i].substr(1).length ? str[i].substr(1) : '');
    }
    return (str.length ? str.join(" ") : str);
}; 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2015-12-13T14:06:06.223

```
function titleCase(str) {
    str = str.toLowerCase();

    var strArray = str.split(" ");

    for(var i = 0; i < strArray.length; i++){
        strArray[i] = strArray[i].charAt(0).toUpperCase() + strArray[i].substr(1);

    }

    var result = strArray.join(" ");

    //Return the string
    return result;
} 
```

* * *

## 回答 #64

> 赞同：-1
> 
> 时间：2021-07-03T13:52:48.557

我使用正则表达式的答案。

更多细节正则表达式：[https ://regex101.com/r/AgRM3p/1](https://regex101.com/r/AgRM3p/1)

```
function toTitleCase(string = '') {
  const regex = /^[a-z]{0,1}|\s\w/gi;

  string = string.toLowerCase();

  string.match(regex).forEach((char) => {
    string = string.replace(char, char.toUpperCase());
  });

  return string;
}

const input = document.getElementById('fullname');
const button = document.getElementById('button');
const result = document.getElementById('result');

button.addEventListener('click', () => {
  result.innerText = toTitleCase(input.value);
});
```

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
</head>
<body>
    <input type="text" id="fullname">
    <button id="button">click me</button>
    <p id="result">Result here</p>
    <script src="./index.js"></script>
</body>
</html>
```

* * *

## 回答 #65

> 赞同：-1
> 
> 时间：2021-08-03T11:47:50.260

没有正则表达式，没有循环，没有拆分，没有子字符串：

```
String.prototype.toTitleCase = function () { return this.valueOf().toLowerCase().replace(this.valueOf()[0], this.valueOf()[0].toUpperCase()); }

console.log('laiLA'.toTitleCase());
```

* * *

## 回答 #66

> 赞同：-2
> 
> 时间：2016-10-27T14:44:43.660

ES6 一班轮

```
const toTitleCase = string => string.split(' ').map((word) => [word[0].toUpperCase(), ...word.substr(1)].join('')).join(' '); 
```

# c++ - 列表迭代器不可递增

> ID：196976
> 
> 赞同：6
> 
> 时间：2008-10-13T08:07:41.757
> 
> 标签：c++, list, stl, iterator

我有一个使用 Visual Studio 2003 构建的旧项目，最近我用 vs2005 重新编译了它。但是，在运行时，我收到以下错误：

列表迭代器不可递增

我将程序跟踪到此功能：

```
void InputQueue::update()
{
    list<PCB>::iterator iter;
    list<PCB>::iterator iterTemp;
    for(iter = begin(); iter != end(); iter++)
    {
        if(iter->arrivalTime == 0)
        {           
            ReadyQueue::getInstance()->add(*iter);
            iterTemp = iter;
            iter++;
            erase(iterTemp);
        }
    }
} 
```

我不是 C++ 专家，这是 VS 调试器给我的。有人可以向我解释问题是什么吗？

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-13T08:20:07.363

我会将您的循环重写为如下所示：

```
while (iter != end())
{
  if (iter->arrivalTime == 0)
  {
    ReadyQueue::getInstance()->add(*iter);
    iter = erase(iter);
  }
  else
  {
    ++iter;
  }
} 
```

现在您正在正确地循环检查每个索引的列表。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-13T08:17:20.053

请注意，如果`iter->arrivalTime == 0`，则列表迭代器会增加两次：一次是在元素删除之前，一次是在循环结束时。

如果要删除的项目是列表中的最后一项，这显然不能正常工作。我敢说即使在 VS2003 中它也无法正常工作，但 VS2005 会更好地提醒您。:-)

请记住，迭代过去是未定义的行为`end()`。绝对可能发生任何事情，例如程序崩溃或（在这种情况下）错误消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T08:19:32.217

我将省略几行代码以显示问题所在：

```
 for(iter = begin(); iter != end(); iter++) // ***
    {
        if(iter->arrivalTime == 0)
        {                       

                iter++; // ***

        }
    } 
```

在标记为 *** 的两行上，您正在递增迭代器。问题是在两行中的第二行，您没有检查您是否还没有走到容器的末尾。实际上，如果您进入内部循环，您将增加两次，但只检查您是否能够增加一次。

`end()`一种解决方案是在进行第二次增量之前检查[您](https://stackoverflow.com/questions/180516/how-to-filter-items-from-a-stdmap#180616)是否处于这种情况，但同样适用于大多数 STL 容器）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-06T16:31:36.757

根本原因是“list.erase()”会改变迭代器。“for”循环的正确写法：

```
 for (list<CMessage*>::iterator it=que.begin(); it!=que.end(); ++it)
   {
    if(m_type == (*it)->m_type)
    {
        delete *it;
        it=que.erase(it); //"list.erase()" will change the iterator!!!
        if(it==que.end()) break; //Check again!!!
        //still has side effect here. --it?
    }
   } 
```

但它仍然有副作用，所以马克的 while 解决方案将是最好的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T09:32:13.087

如果您得到“列表迭代器不兼容”，可能是因为在您的“ReadyQueue::getInstance()->add(*iter);”中 您正在更改 *iter 中的某些内容，这使得哈希算法返回的擦除值与插入期间不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T08:19:57.910

我相信克里斯是对的。但是，另一个问题可能源于您分配给迭代器的事实。– 列表迭代器是否保证可赋值？不看标准，我不这么认为，因为迭代器的 SGI 文档中没有提到可分配性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T08:26:49.817

这只是一个旁注，但很重要。

我猜你继承自`std::ist<PCB>`. 我必须说：继承以重用功能对我来说并不是很好。但是由于您也在“继承”该项目，因此没有什么可做的......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T09:56:57.607

我可以建议一个更简单的算法吗？

free 函数`std::remove_if`可用于将您的列表划分为 2，匹配或不匹配谓词的元素（即到达时间==0）。它返回分隔范围的迭代器。然后您可以调用`ReadyQueue::getInstance()->add(subrange_begin, subrange_end)` *（您确实有过载，对吗？）*然后擦除子范围。

只是您可以使用 STL 算法而不是编写自己的循环的情况。

# java - 谁能推荐一个Java富文本编辑器？

> ID：196980
> 
> 赞同：34
> 
> 时间：2008-10-13T08:09:54.687
> 
> 标签：java, swing, editor, rtf

富文本编辑器必须用 Java 实现，提供 Swing 支持，最好是开源的。

我希望将它集成到现有的 Java/Swing 应用程序中。

谢谢。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-13T08:51:17.723

这可能不像您所追求的那样直接......但 JTextPane 支持富文本和 HTML。让它*显示*rtf 或 html 很简单，只需在填充内容之前设置编码类型。

至于制作小的“B”和“ *I* ”等样式修改按钮，如果归根结底，在紧要关头，自己制作并不难。想想带有图标集的 JButton。他们的听众像这样获得 JTextPane 的当前选择开始和结束索引位置： `jpane.getSelectionStart()` 或者 `jpane.getSelectionEnd()` 然后在这些位置插入开始和结束 html/rtf 标记。

撤消也很容易——维护一个简单的 Jpanel 字符串内容堆栈，每次用户执行编辑操作时，一个简单的`history.push(jpane.getText())`都会存储状态，撤消按钮就像`jpane.setText(history.pop())`.

我/你可以用 B 制作一个，*我*估计大约 30 分钟后撤消 - 其他按钮（如列表）需要更长的时间，但不会太多。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-04-29T09:59:14.933

尝试基于 Charles Bell 的[MetaPhase 编辑器](http://kenai.com/projects/metaphaseeditor)[`HTMLDocumentEditor`](http://www.artima.com/forums/flat.jsp?forum=1&thread=1276)。它是[LGPL v3](http://www.gnu.org/licenses/lgpl.html)许可的，非常棒，特别是作为使用 的示例，在[此处](https://stackoverflow.com/a/10167091/230513)`StyledEditorKit`讨论。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-13T14:43:55.093

您可以在 Swing 应用程序中嵌入所有开源富文本编辑器的母体：OpenOffice.org 提供了一个“OOBean”，您可以使用它在 Swing 应用程序中嵌入完整的 OpenOffice 实例。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-28T05:49:18.600

我检查了一下，我找不到一个只有一个文本编辑器的 jar 文件。但是，这里有 2 个其他选项

**选项 A**使用 Swing 并自己构建一个。Swing 在 javax.swing.text 中已经包含了很多组件，尽管它仍然需要大量的代码。[我在这里](http://www.artima.com/forums/flat.jsp?forum=1&thread=1276)找到了一个例子

**选项 B**从开源项目中清除代码。我发现 2 个项目具有非常好的 HTML WYSIWYG 类型编辑器，可以提取（两者都包含在几个类中）。

1.  [备忘录](http://memoranda.sourceforge.net/)(GPL)：它的文本编辑或在 net.sf.memoranda.ui.htmleditor.HTMLEditor 中。它是一个 JPanel，只使用一个其他类。
2.  [Ekit](http://www.hexidec.com/ekit.php) (LGPL)：它是一个功能齐全的 WYSIWYG Html 编辑器。它的 com.hexidec.ekit.EkitCore 类是一个 JPanel，看起来相当多用途，尽管它使用了包中的许多其他类。

假设您有预算，还有一堆商业可用:)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-04-29T09:48:59.020

看看[JWord](http://www.pilotltd.com/index_en.jsp?pagenum=90004)或[JRichTextEditor](https://github.com/hoesterholt/JRichTextEditor)

JWord 是一个商业摇摆富文本编辑器，具有表格、分页和 RTF/opendoc/XML 支持。还支持页眉/页脚、多列布局、导出 HTML、SVG、WMF 等。

JRichTextEditor 是一个开源的 Swing 小部件，非常适合做笔记。支持图像，一种简单的 XML 格式存储，导出为 PDF、HTML。不如 JWord 先进，但开源。

可能有帮助。

# php - wordpress - 像在stackoverflow中一样有评论内联ajax

> ID：196993
> 
> 赞同：7
> 
> 时间：2008-10-13T08:19:16.603
> 
> 标签：php, ajax, wordpress, comments

我有一个 wordpress 博客，并希望为人们在 stackoverflow 中添加评论提供相同的用户体验。那里有许多评论 ajax 插件，但我找不到一个可以让您在主页上内联、进入并添加评论而无需先深入到单独的单个帖子页面的工作。

任何人都可以在这里帮助使用 wordpress 插件或 php 代码来执行此操作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-16T01:35:43.357

我永远无法让 AJAXed Wordpress 做我（显然是提问者）想做的事情。

[我使用了一个自定义解决方案，该解决方案利用了一个名为Inline Ajax Comments](http://kashou.net/blog/inline-ajax-comments)的插件。我花了很长时间找到一个下载链接，但这里仍然有效： http: [//kashou.net/files/inline-ajax-comments.zip](http://kashou.net/files/inline-ajax-comments.zip)

在 WordPress 的主题编辑器中，我编辑 index.html。在以下之后：

```
<?php the_content(''); ?> 
```

我添加（当然启用插件之后）：

```
<?php ajax_comments_link(); ?>
<?php ajax_comments_div(); ?> 
```

然后我编辑了插件 PHP 文件本身。我注释掉的代码块如下：

```
if ($comment_count == '1') {
    echo('<span id="show-inline-comments-'. $id .'">  ');
    /*  echo('<a href="javascript:;" id="show-inline-comments-link-'. $id .'" onmouseup="ajaxShowComments('. $id .', \''. $throbberURL .'\', \''. $commentpageURL .'\'); return false;">show comment &raquo;</a>'); 
*/
    echo('</span>');
    echo('<span id="hide-inline-comments-'. $id .'" style="display: none;">  ');
    /*  echo('<a href="#comments-'. $id .'" onmouseup="ajaxHideComments('. $id .', \''. $throbberURL .'\', \''. $commentpageURL .'\'); return true;">&laquo; hide comment</a>'); 
*/
    echo('</span>');
} else if ($comment_count > '1') {
    echo('<span id="show-inline-comments-'. $id .'">  ');
    /*  echo('<a href="javascript:;" id="show-inline-comments-link-'. $id .'" onmouseup="ajaxShowComments('. $id .', \''. $throbberURL .'\', \''. $commentpageURL .'\'); return false;">show comments &raquo;</a>'); 
*/
    echo('</span>');
    echo('<span id="hide-inline-comments-'. $id .'" style="display: none;">  ');
    /*  echo('<a href="#comments-'. $id .'" onmouseup="ajaxHideComments('. $id .', \''. $throbberURL .'\', \''. $commentpageURL .'\'); return true;">&laquo; hide comments</a>'); 
*/
    echo('</span>');
} 
```

IIRC，这就是我所要做的，但如果这对你不起作用，请告诉我。我正在尝试对我自己的解决方案进行逆向工程，因为它似乎也正是您想要做的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T21:44:22.890

我认为[AJAXed Wordpress 可以满足](http://wordpress.org/extend/plugins/ajaxd-wordpress/)您的需求，其中包括：

### [AJAXed WordPress](http://anthologyoi.com/awp)

> AJAXed Wordpress (AWP) 利用 AJAX 和 Wordpress 的力量来改善任何基于 Wordpress 的博客的用户体验、管理能力和设计潜力。它适用于 2.1 - 2.6 的所有 WordPress 版本。
> 
> AWP 的一些功能包括内联加载帖子、**内联评论**、线程评论、AJAX 评论提交、AJAX 导航、实时评论预览等等。AWP 是无限可定制和可扩展的。尽管 AWP 提供了许多功能，但您永远不会被迫使用您不想要的功能。插件的所有方面都可以通过一个管理面板轻松定制。

演示可在此处[http://wordpress.mu/](http://wordpress.mu/)获得，您可以查看内联注释。看起来像你所要求的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-04T13:14:40.213

您可以重新利用[P2](http://wordpress.org/extend/themes/p2)主题中的代码。这是一个写得很好的主题，所以这在很大程度上应该没有任何问题。将所有代码从它们复制`functions.php`到主题的`functions.php`. 将他们的`inc`目录复制`entry.php`到您的主题目录。

替换你的`index.php`

```
 <?php if (have_posts()) : ?> 

    <?php while (have_posts()) : the_post(); ?> 
    <?php /* your themes code must be here */ ?>

  <?php endwhile; ?> 
```

和

```
 <?php if (have_posts()) : ?> 

    <?php while (have_posts()) : the_post(); ?> 
    <?php  require dirname(__FILE__) . '/entry.php'; ?> 

  <?php endwhile; ?> 
```

然后修改entry.php中的css等东西来尝尝。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-02T10:28:22.613

您可能想尝试[Ajax 评论发布](http://wordpress.org/extend/plugins/ajax-comment-posting/)。这个对我有用。

> Wordpress 插件目录中有很多评论相关的插件。但是，如果您只想找到一个简单的评论发布 Ajax 插件，您将找不到任何插件。这就是为什么我开发了一个简单而小（5kB）但功能强大的 Ajax 评论发布 (ACP) 插件。它不仅会在不刷新页面的情况下发布您的评论，而且还会确保您正确填写了所有表单字段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-02T22:13:25.393

您可以使用 1\. AJAX 评论插件（[在 wordpress 上搜索“Ajax 评论”](http://wordpress.org/extend/plugins/search.php?q=ajax+comments)） 2\. 编写您自己的自定义代码。3.使用disqus。

无论您从上面选择哪个选项，您仍然需要在主页上公开评论。这可以通过更改模板的 index.php 来完成（基于您选择的选项），以在显示每个帖子的文本后显示评论。但是，这会增加页面加载时间，并且还会影响主页的设计（加上链接到特定页面将不再具有太大价值）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-03T21:46:04.463

有很多插件可以做到这一点。Ajax Comment Posting 的安装和使用非常简单。正如他们所说：

1.  将插件目录 ajax-comment-posting 上传到 wp-content/plugins 目录。
2.  通过 WordPress 中的“插件”菜单激活插件。
3.  就是这样！

[http://wordpress.org/extend/plugins/ajax-comment-posting/](http://wordpress.org/extend/plugins/ajax-comment-posting/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-10-01T13:44:37.067

我推荐这个[http://wordpress.org/extend/plugins/ajax-comment-posting/](http://wordpress.org/extend/plugins/ajax-comment-posting/)。我希望它有所帮助。*******************