# StackOverflow 问答 000567000-000567999

# php - 意外的 T_ELSEIF

> ID：567002
> 
> 赞同：0
> 
> 时间：2009-02-19T20:30:31.533
> 
> 标签：php, foreach

```
$pages = array("grac", "zamknij", "dolaczyc");
$pagesid = array("showNews", "showThread", "showProfile");

foreach ($pagesid as $page) {
  if (isset($_GET[$page])) {
  include('sobra/'.$page.'.php');
  }
}

// just pages
elseif (in_array($_GET['page'], $pages)) {
include("$_GET[page].php");
}

// error
else include('error.php'); 
```

给出：
*解析错误：语法错误，第 33 行 C:\WAMP\www\sdgag\index.php 中的意外 T_ELSEIF*

我认为这应该可行..问题可能是什么？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T20:31:39.313

elseif 和 else 没有附加到 if，您已将它们放在 foreach 循环块之外。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T20:44:22.563

也许是另一种方法。执行您的逻辑，并确定最终要包含的页面。完成所有逻辑后，包括您确定的页面。

*以下内容未经测试，可能包含错误。让我知道，我会更新代码。*

```
<?php

  // Predefined list of acceptable pages
  $pages = array("one","two","three");
  $pagesid = array("four","five","six");

  // Gather any user-defined page request
  $desPage = trim($_GET["page"]);

  // Assume they are wrong, and need to see error.php
  $pageToLoad = "error.php";

  // If the user request is not empty
  if (!empty($desPage)) {
    if (in_array($desPage,$pages)) {
      $pageToLoad = $desPage . ".php";
    }
  } else {
  // User request is empty, check other variables
    foreach ($pagesid as $pageid) {
      if (isset($_GET[$pageid])) {
        $pageToLoad = $pageid . ".php";
      }
    }
  }

  // Show output page
  include($pageToLoad);

?> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T20:31:30.250

**在 else 之前有一个右括号。**

它应该是：

```
$pages = array("grac", "zamknij", "dolaczyc");
$pagesid = array("showNews", "showThread", "showProfile");

foreach ($pagesid as $page) {
  if (isset($_GET[$page])) {
    include('sobra/'.$page.'.php');
  }
  // just pages
  else if (in_array($_GET['page'], $pages)) {
    include("$_GET[page].php");
  }
  // error
  else include('error.php');
} 
```

**如果您正确缩进源代码，则此类错误会很快出现，您可以自己修复它们。**

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-19T20:39:23.323

```
$pages = array('grac', 'zamknij', 'dolaczyc');
$pagesid = array('showNews', 'showThread', 'showProfile');

foreach ($pagesid as $page) {
  if (isset($_GET[$page])) {
    include('sobra/'.$page.'.php');
  }
  // just pages
  else if (in_array($_GET['page'], $pages)) {
    include($_GET[$page].'.php'); // fixed missing $, restylized to match previous style
  }
  else include('error.php');
} 
```

# iis - 找不到指定的模块 - 经典 asp

> ID：567005
> 
> 赞同：2
> 
> 时间：2009-02-19T20:31:27.630
> 
> 标签：iis

起初，我在这个看似相当简单的项目上已经筋疲力尽了。这个项目是将一个 ASP 应用程序从 Win2K 移动到 windows xp 系统。技术流失显然使这项工作变得相当麻烦。

无论如何......我最新的问题与生硬但神秘的错误有关

“指定的模块无法找到”。

什么模块？

我找到了一个链接，上面说如果我识别模块，我可以使用这个命令：

regsvr32 %systemroot%\System32\xxxx.dll

我的问题是，我如何识别所说的dll？我尝试查看 IIS 日志，但没有看到任何可以确定的内容。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T03:57:14.317

“未找到指定模块”错误可能是因为您的 C:\Windows\ 文件夹中没有 iissuba.dll。Iissuba 是控制 IUSR_machinename 密码的“subauthentication”模块。您可以从安装 IIS 的 CD 或文件夹中提取 iissuba.dl_。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T20:37:40.067

您的站点会碰巧使用 CDONTS 发送电子邮件吗？默认情况下，Windows XP 上不安装 CDONTS - XP 有 CDO。

# c - 如何在 Eclipse 中记录 C 代码（intellisense/javadoc 之类的工具提示）

> ID：567014
> 
> 赞同：3
> 
> 时间：2009-02-19T20:33:05.833
> 
> 标签：c, eclipse, documentation-generation

是否可以在 Eclipse（3.4 w/CDT）中记录 C 代码，以便自动生成和显示类似 JavaDoc/Intellisense 的文档？

例如，在键入函数名称后跟一个“（”时，您会得到第一个参数，其中包含解释该参数含义的工具提示？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T05:04:42.460

据我所知：否（使用 CDT5.0.2）。

你现在拥有的最好的就是他们所说的：**[内容辅助](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.cdt.doc.user/concepts/cdt_c_content_assist.htm)**

[替代文字 http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/images/contentAssist_example.png](http://help.eclipse.org/ganymede/topic/org.eclipse.cdt.doc.user/images/contentAssist_example.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-29T21:27:14.037

你可以查看这个项目： http: [//gna.org/projects/eclox](http://gna.org/projects/eclox)

Eclox 是一个简单的 doxygen eclipse 前端插件。它旨在提供代码文档过程到 eclipse 的苗条和时尚的集成。

功能概述

```
* Graphical edition of doxyfile settings,
* integrated doxygen invokation,
* doxygen outputs logging and
* optional packaged doxygen binaries (for windows and linux). 
```

注册日期：2004 年 2 月 2 日星期一，欧洲中部时间 09:31 许可证：GNU 通用公共许可证 V2 或更高版本

问候

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T22:25:31.357

仅供参考，我已经开始使用 Doxygen 来记录我的代码。这允许以我真正想要的 JavaDoc 语法进行记录，然后 Doxygen 解析源以形成运行良好的各种输出格式（html/xml/chm 等）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-02T22:43:46.610

Linux Tools 项目开始研究这样的帮助工具。目前它将为 Linux 系统库提供帮助，但也有计划将其扩展到例如 doxygen 生成的帮助。

有关演示，请参见： [http ://www.eclipse.org/downloads/download.php?file=/technology/linuxtools/videos/libhoverdemo.ogg](http://www.eclipse.org/downloads/download.php?file=/technology/linuxtools/videos/libhoverdemo.ogg)

# html - 用于 asp.net 的 HTML 压缩器

> ID：567015
> 
> 赞同：4
> 
> 时间：2009-02-19T20:33:17.097
> 
> 标签：html, html-compression

任何人都知道压缩发送到客户端的 HTML 的好方法或工具吗？

我正在考虑仅在生产服务器中压缩 .aspx 文件中的 HTML，所以也许一个这样做的工具是正确的选择。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T20:37:45.370

更好的方法是启用 GZIP，您可以在 IIS 中启用它

[iis6](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/25d2170b-09c0-45fd-8da4-898cf9a7d568.mspx?mfr=true) | [iis7](http://technet.microsoft.com/en-us/library/cc771003.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T20:36:34.063

Telerik 刚刚发布了一个压缩实用程序，作为 RadControls for ASP.NET AJAX 套件的一部分。如果您不是客户，您可以使用他们控件的免费、非定时炸弹试用版来查看它。

查看[这篇文章](http://blogs.telerik.com/VladimirEnchev/Posts/08-12-16/HTTP_Compression_for_your_ASP_NET_AJAX_applications.aspx)和[这篇文章](http://blogs.telerik.com/ToddAnglin/Posts/09-01-28/Optimization_Tips_RadCompression_Module.aspx)了解详情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-13T19:27:03.110

此处有一篇关于[无运行时成本的 ASP.NET 空白清理](http://omari-o.blogspot.com/2009/09/aspnet-white-space-cleaning-with-no.html)的文章。

清除不必要的空白具有压缩数据的效果。

# sql - 高级 SQL 插入

> ID：567035
> 
> 赞同：1
> 
> 时间：2009-02-19T20:37:18.350
> 
> 标签：sql, tsql

我有这个工作正常的查询。它为“Jeff”用户选择行到 SY.UserOptions 表中。

但是，我创建了另一个查询，我想做同样的事情，但针对每个用户。所以我将 SY.Users 添加到查询中，这实际上将 2 个表叠加在一起。但是，它给了我一个我不明白的错误。

```
--This works
SELECT ‘Jeff’, t.Application, t.Task, tl.Description
FROM SY.Tasks t
LEFT OUTER JOIN SY.TaskLevels tl 
ON t.Application = tl.Application And t.Task = tl.Task AND t.DftAccessLevel = tl.AccessLevel

-- This does not work
SELECT u.[User], t.Application, t.Task, tl.Description
FROM SY.Tasks t, SY.Users u
LEFT OUTER JOIN SY.TaskLevels tl 
ON t.Application = tl.Application And t.Task = tl.Task AND t.DftAccessLevel = tl.AccessLevel 
```

--这里是错误

> 消息 4104，级别 16，状态 1，过程 CreateUserOptions，第 15 行 无法绑定多部分标识符“t.Application”。消息 4104，级别 16，状态 1，过程 CreateUserOptions，第 15 行 无法绑定多部分标识符“t.Task”。消息 4104，级别 16，状态 1，过程 CreateUserOptions，第 15 行 无法绑定多部分标识符“t.DftAccessLevel”。

我不能像这样将表相乘并包含一个连接吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T20:44:22.033

您需要一个字段来将用户表连接到任务表。

```
SELECT u.[User], t.Application, t.Task, tl.Description
FROM SY.Tasks t
INNER JOIN SY.Users u --LEFT OUTER if it makes a difference
  ON t.user = u.User --not sure if these fields are available maybe some type of userId?
LEFT OUTER JOIN SY.TaskLevels tl 
  ON t.Application = tl.Application 
  And t.Task = tl.Task AND t.DftAccessLevel = tl.AccessLevel 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T20:45:33.983

这是因为您将 USERS 加入到 TaskLevels 而不是将 Tasks 加入到 TaskLevels。

试试这个：

```
SELECT u.[User], t.Application, t.Task, tl.Description
FROM SY.Users u, SY.Tasks t
LEFT OUTER JOIN SY.TaskLevels tl ON t.Application = tl.Application And t.Task = tl.Task AND t.DftAccessLevel = tl.AccessLevel 
```

不过，这将为您提供具有 (Tasks TaskLevels) 的用户的笛卡尔积。所以每个用户都会有每一项任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T20:47:11.983

我认为问题在于，在第二个查询中，当您加入 SY.Users 表和 SY.TaskLevels 表时，您引用的是 SY.Tasks 表 - 这不是加入的一部分。

切换 Sy.Users 表和 Sy.Tasks 表，您的问题应该得到解决。

# php - 为什么 fgets 挂在 wamp 上的某个 url 上，但在 mamp 上很好？

> ID：567051
> 
> 赞同：1
> 
> 时间：2009-02-19T20:40:03.917
> 
> 标签：php, fgets, freeze

我有一个使用 fopen 和 fgets 读取 RSS 提要的脚本。

当尝试在[http://rss.fok.nl/feeds/nieuws](http://rss.fok.nl/feeds/nieuws)上提供提要时，我的脚本会挂起，直到达到 PHP 的 max_timeout。

事情是：

*   直到今天它都运行良好（在同一个 url 上）。
*   它仍然适用于我的开发 mac MAMP 服务器。
*   它不适用于生产 WAMP 服务器（php 5.2.8）

我试过 fread 没有成功。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T21:51:35.107

好吧，这更像是一种解决方法而不是答案，但我不得不求助于它。我使用以下功能切换到 curl：

```
function curl_get_file_contents($URL)
{
    $c = curl_init();
    curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($c, CURLOPT_URL, $URL);
    $contents = curl_exec($c);
    curl_close($c);

    if ($contents) return $contents;
        else return FALSE;
} 
```

我在这里找到它：http: [//il.php.net/manual/en/function.file-get-contents.php](http://il.php.net/manual/en/function.file-get-contents.php)

顺便说一句，如果有人想更深入地挖掘，根据其他关于 fgets 挂起的报道，它似乎与“feof”或缺乏“feof”有关......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T20:44:12.753

**也许尝试使用wireshark（[Ethereal](http://www.ethereal.com/)）调试您的连接。**这应该给你理由。由于用户代理，网络服务器可能会阻止您的请求。

您可以在 Windows 机器上手动下载文件吗？

# apache-flex - 是否可以从动态类中删除属性？

> ID：567053
> 
> 赞同：5
> 
> 时间：2009-02-19T20:40:35.333
> 
> 标签：apache-flex, actionscript-3, class, actionscript, dynamic

我有一个用于将参数发送到 WebService 的动态 ActionScript 类。其中一些参数始终存在，因此它们是类的公共属性：

```
package
{
    [Bindable]
    public dynamic class WebServiceCriteria
    {
        public var property1:int;

        public var property2:String;

        public var property3:String;

        public var property4:String;
    }
} 
```

但是，我还在运行时添加了可以随时间变化的属性：

```
criteria.runTimeProperty = "1"; 
```

我对使用动态类不是很熟悉，所以我想知道是否可以“删除”新属性。假设下次我调用 WebService 时，我不希望发送该属性——即使是 null。如何在不每次创建新实例的情况下从 Class 实例中删除它？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-19T20:42:55.923

我相信您需要做的就是：

```
delete criteria.runTimeProperty; 
```

或者

```
delete criteria["runTimeProperty"]; 
```

两者都应该做同样的事情。

有关详细信息，请参阅[删除](http://livedocs.adobe.com/flex/3/langref/operators.html#delete)文档。

# visual-studio-2008 - Visual Studio 安装项目，设置路径但在命令窗口中看不到

> ID：567061
> 
> 赞同：0
> 
> 时间：2009-02-19T20:42:35.143
> 
> 标签：visual-studio-2008, environment-variables

我有一个设置项目，其中有一个自定义操作，将目标文件夹添加到路径中。没什么特别的，工作正常，将其添加到路径中。

但是，如果我随后打开一个 cmd 窗口，则它不可用。如果我 psexec 并尝试直接运行文件夹中的某些内容，则找不到。

我注销并再次打开它，它出现在 cmd echo %PATH% 命令中，但这并不是生产中的真正选项。

我可能会通过 psexec 安装 msi，然后我想使用该文件夹中的内容进行第二次调用。

所以

psexec \机器名称 msiexec /I setup.msi /qn psexec \机器名称 exeinabovemsi

我需要做些什么来清除路径吗？安装 msi 后，它就在“我的电脑 -> 属性 -> 高级 -> 环境变量 -> 路径”列表中，只是没有出现新的 cmd 窗口等。

谢谢

艾伦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-27T15:08:40.713

来自[http://support.microsoft.com/kb/104011](http://support.microsoft.com/kb/104011)：

> 但是，请注意，对环境变量的修改不会导致立即更改。例如，如果您在进行更改后启动另一个命令提示符，则环境变量将反映以前（而不是当前）的值。在您注销然后重新登录之前，更改不会生效。
> 
> 要在不必注销的情况下进行这些更改，请将 WM_SETTINGCHANGE 消息广播到系统中的所有窗口，以便任何感兴趣的应用程序（例如 Windows 资源管理器、程序管理器、任务管理器、控制面板等）都可以执行更新。

# java - Java 同步块与 Collections.synchronizedMap

> ID：567068
> 
> 赞同：87
> 
> 时间：2009-02-19T20:44:09.273
> 
> 标签：java, synchronization

以下代码是否设置为正确同步调用`synchronizedMap`？

```
public class MyClass {
  private static Map<String, List<String>> synchronizedMap = Collections.synchronizedMap(new HashMap<String, List<String>>());

  public void doWork(String key) {
    List<String> values = null;
    while ((values = synchronizedMap.remove(key)) != null) {
      //do something with values
    }
  }

  public static void addToMap(String key, String value) {
    synchronized (synchronizedMap) {
      if (synchronizedMap.containsKey(key)) {
        synchronizedMap.get(key).add(value);
      }
      else {
        List<String> valuesList = new ArrayList<String>();
        valuesList.add(value);
        synchronizedMap.put(key, valuesList);
      }
    }
  }
} 
```

据我了解，我需要同步块`addToMap()`以防止另一个线程调用`remove()`或`containsKey()`在我完成调用之前，`put()`但我不需要同步块，因为另一个线程在返回之前`doWork()`无法进入同步块，因为我最初创建了 Map与. 那是对的吗？有一个更好的方法吗？`addToMap()``remove()``Collections.synchronizedMap()`

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-02-19T20:53:46.120

`Collections.synchronizedMap()`保证您要在地图上运行的每个原子操作都会同步。

然而，在地图上运行两个（或更多）操作必须在一个块中同步。所以是的 - 你正在正确同步。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-19T20:52:36.777

如果您使用的是 JDK 6，那么您可能需要查看[ConcurrentHashMap](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html)

请注意该类中的 putIfAbsent 方法。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-19T21:28:35.940

您的代码中*可能*存在细微的错误。

[**更新：** 由于他使用的是 map.remove() 这个描述并不完全有效。我第一次错过了这个事实。:( 感谢问题的作者指出这一点。我将其余部分保留原样，但更改了主要声明以说明*可能*存在错误。]

在**doWork()**中，您以线程安全的方式从 Map 中获取 List 值。但是，之后，您在不安全的情况下访问该列表。例如，一个线程可能正在使用**doWork()**中的列表，而另一个线程在**addToMap()中调用****synchronizedMap.get(key).add(value** ) 。这两个访问不同步。经验法则是集合的线程安全保证不会扩展到它们存储的键或值。

 **您可以通过将同步列表插入到地图中来解决此问题，例如

```
List<String> valuesList = new ArrayList<String>();
valuesList.add(value);
synchronizedMap.put(key, Collections.synchronizedList(valuesList)); // sync'd list 
```

或者，您可以在访问**doWork()**中的列表时在地图上进行同步：

```
 public void doWork(String key) {
    List<String> values = null;
    while ((values = synchronizedMap.remove(key)) != null) {
      synchronized (synchronizedMap) {
          //do something with values
      }
    }
  } 
```

最后一个选项会稍微限制并发性，但 IMO 会更清晰一些。

另外，关于 ConcurrentHashMap 的快速说明。这是一个非常有用的类，但并不总是同步 HashMap 的合适替代品。引用其 Javadocs，

> *在依赖线程安全但不依赖同步细节*的程序中，此类与 Hashtable 完全可互操作。

换句话说， putIfAbsent() 非常适合原子插入，但不能保证映射的其他部分在调用期间不会改变；它只保证原子性。在您的示例程序中，除了 put() 之外，您还依赖（同步的）HashMap 的同步细节。

最后一件事。:) 来自*Java Concurrency in Practice*的这句话总是帮助我设计调试多线程程序。

> 对于可能被多个线程访问的每个可变状态变量，对该变量的所有访问都必须在持有相同的锁的情况下执行。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-09-16T12:29:23.190

是的，您正在正确同步。我将更详细地解释这一点。只有在对 synchronizedMap 对象的方法调用序列中的后续方法调用中必须依赖先前方法调用的结果时，您才必须同步对 synchronizedMap 对象的两个或多个方法调用。让我们看一下这段代码：

```
synchronized (synchronizedMap) {
    if (synchronizedMap.containsKey(key)) {
        synchronizedMap.get(key).add(value);
    }
    else {
        List<String> valuesList = new ArrayList<String>();
        valuesList.add(value);
        synchronizedMap.put(key, valuesList);
    }
} 
```

在这段代码中

```
synchronizedMap.get(key).add(value); 
```

和

```
synchronizedMap.put(key, valuesList); 
```

方法调用依赖于前一个的结果

```
synchronizedMap.containsKey(key) 
```

方法调用。

如果方法调用的顺序未同步，则结果可能是错误的。例如`thread 1`正在执行方法`addToMap()`和`thread 2`正在执行方法对象`doWork()` 上的方法调用顺序`synchronizedMap`可能如下： `Thread 1`已执行方法

```
synchronizedMap.containsKey(key) 
```

结果是“ `true`”。在该操作系统将执行控制切换到`thread 2`并执行之后

```
synchronizedMap.remove(key) 
```

之后，执行控制已切换回`thread 1`并已执行，例如

```
synchronizedMap.get(key).add(value); 
```

相信`synchronizedMap`对象包含`key`并且`NullPointerException`将被抛出，因为`synchronizedMap.get(key)` 将返回`null`。如果对象上的方法调用顺序`synchronizedMap`不依赖于彼此的结果，那么您不需要同步顺序。例如，您不需要同步此序列：

```
synchronizedMap.put(key1, valuesList1);
synchronizedMap.put(key2, valuesList2); 
```

这里

```
synchronizedMap.put(key2, valuesList2); 
```

方法调用不依赖于前面的结果

```
synchronizedMap.put(key1, valuesList1); 
```

方法调用（它不关心是否某个线程在两个方法调用之间进行了干扰，例如删除了`key1`）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T20:53:11.877

这在我看来是正确的。如果我要更改任何内容，我将停止使用 Collections.synchronizedMap() 并以相同的方式同步所有内容，以使其更清晰。

另外，我会更换

```
 if (synchronizedMap.containsKey(key)) {
    synchronizedMap.get(key).add(value);
  }
  else {
    List<String> valuesList = new ArrayList<String>();
    valuesList.add(value);
    synchronizedMap.put(key, valuesList);
  } 
```

和

```
List<String> valuesList = synchronziedMap.get(key);
if (valuesList == null)
{
  valuesList = new ArrayList<String>();
  synchronziedMap.put(key, valuesList);
}
valuesList.add(value); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-09-01T16:07:11.233

您同步的方式是正确的。但是有一个问题

1.  Collection 框架提供的同步包装器确保方法调用即 add/get/contains 将互斥运行。

但是在现实世界中，您通常会在输入值之前查询地图。因此，您需要执行两个操作，因此需要一个同步块。所以你使用它的方式是正确的。然而。

2.  您可以使用 Collection 框架中可用的 Map 的并发实现。'ConcurrentHashMap' 的好处是

一种。它有一个 API 'putIfAbsent'，它可以做同样的事情，但以更有效的方式。

湾。它的效率： dThe CocurrentMap 只是锁定键，因此它不会阻塞整个地图的世界。因为你已经阻止了键和值。

C。您可能已经在代码库中的其他地方传递了您的地图对象的引用，您/Tean 中的其他开发人员最终可能会错误地使用它。即，他可能只是所有 add() 或 get() 而不锁定地图的对象。因此，他的呼叫不会与您的同步块相互排斥。但是使用并发实现可以让您高枕无忧，因为它永远不会被错误地使用/实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T20:53:34.153

查看[Google Collections](http://code.google.com/p/google-collections/) ' `Multimap`，例如[本演示文稿](http://google-collections.googlecode.com/files/google-collections-svgtug-2008-08-06.pdf)的第 28 页。

如果由于某种原因您不能使用该库，请考虑使用`ConcurrentHashMap`而不是`SynchronizedHashMap`; 它有一个漂亮的`putIfAbsent(K,V)`方法，如果元素列表不存在，您可以使用它自动添加元素列表。此外，`CopyOnWriteArrayList`如果您的使用模式允许，请考虑使用地图值。

# php - 负载测试 UI

> ID：567072
> 
> 赞同：5
> 
> 时间：2009-02-19T20:44:38.650
> 
> 标签：php, stress-testing

我一直在开发一个在前端大量使用 AJAX 和动态 JavaScript 的网站，是时候开始压力测试了。但是你如何正确地对需要点击前端几个链接的东西进行压力测试呢？我能够轻松快速地反复访问该网站的每一页的一种方法是将 Google Mini 指向它。但这不会点击链接然后导航模态窗口和类似的东西。

编辑 - 我应该指出该站点是用 PHP5 完成的，并且使用的 JavaScript 库是 jQuery。不确定这是否会有所作为，但觉得知道这可能很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:31:47.383

[JMeter](http://jakarta.apache.org/jmeter/)在这方面做得很好。您可以记录您的会话并根据自己的喜好进行调整。

所谓的“ajax 负载测试”是这个站点上反复出现的主题，并且经常被混淆。因此，让我们直截了当地说：对普通网页进行负载测试和使用 ajax 进行负载测试之间确实没有区别。这一切都归结为离散的请求；他们只是碰巧不是整页刷新。

要记住的一件事是负载测试处理请求的服务器（负载测试）和正在更新的 UI 组件的屏幕性能（您的 javascript 执行情况如何）之间存在明显差异。

简单的负载测试示例：

1.  初始页面加载
2.  登录
3.  导航？
4.  5-10 个“ajax”请求（或任何适合您的应用程序使用模式的请求）
5.  登出

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T20:51:51.723

有一些负载测试工具可以支持 AJAX。例如，WebLoad

[http://www.radview.com/solutions/ajax-load-testing.aspx](http://www.radview.com/solutions/ajax-load-testing.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:15:46.323

你真正想要的是压力测试是服务器处理ajax请求的能力。使用加载工具在“记录”测试时查看请求，然后进行适当的调整。我只用过vs测试版，所以我不能指给你一个低成本的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T17:35:56.897

我在某种程度上不同意内森和弗雷迪。他们是正确的，“AJAX 测试”在发出 HTTP 请求方面确实没有什么不同。但这并不是那么简单。请参阅我在 Ajaxian.com 上关于[为什么负载测试 Ajax 很难](http://ajaxian.com/archives/why-load-testing-ajax-is-hard)的文章。

JMeter、Pylot 和 The Grinder 都是生成 HTTP 请求的好工具（我个人推荐 Pylot）。但在它们的核心，它们并不充当浏览器并处理 JavaScript，这意味着它们所做的只是重播他们在创纪录的时间内看到的流量。如果这些 AJAX 请求对于该会话是唯一的，那么它们可能不适合/不正确地进行大量重播。

事实是，随着更多逻辑被推送到浏览器中，使用传统负载测试工具正确模拟流量变得更加困难（如果不是不可能的话）。

在我的文章中，我举了一个简单的例子，说明当你想要查询 1000 个不同的搜索词（负载测试期间的一个重要目标）时，测试像 Google 主页这样的东西是多么困难。要使用 JMeter/Pylot/Grinder 执行此操作，您实际上最终会以该工具的本机语言重新编写 AJAX 代码的一部分（在您的情况下使用 jQuery）。

如果您的目标是衡量用户感知的响应时间（这可以说是一天结束时最重要的事情），它会变得更加复杂。对于使用 Comet/“Reverse Ajax”（一种长时间保持打开套接字的技术）的非常复杂的应用程序，传统的加载工具根本不起作用。

我的公司 BrowserMob 提供[负载测试服务](http://browsermob.com)，它使用由[Selenium](http://seleniumhq.org)提供支持的 Firefox 浏览器来驱动数百或数千个真实浏览器，允许您测量和计时浏览器中所见视觉元素的性能。我们还支持传统的虚拟用户（盲 HTTP 流量）和模拟浏览器（通过[HtmlUnit](http://htmlunit.sourceforge.net/)）。

综上所述，通常将 BrowserMob 之类的服务与传统负载测试相结合是正确的方法。也就是说，真实的浏览器非常适合进行全保真负载测试，但它们永远不会像“虚拟用户”那样经济，因为它们需要 10-100 倍的 RAM 和 CPU。请参阅我最近关于是否[模拟虚拟用户](http://blog.browsermob.com/2009/02/virtual-users-to-simulate-or-not-to-simulate/)的博文。

希望有帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T23:35:49.387

你可以使用类似[openSTA](http://www.opensta.org/)的东西。

这允许记录与网站的会话，然后通过相对简单的脚本语言进行回放。

您还可以轻松地测试 Web 服务并编写自己的脚本。

它允许您以任何您想要的方式将脚本放在测试中，并配置迭代次数、每次迭代中的用户数、引入每个新用户的加速时间以及每次迭代之间的延迟。将来也可以安排测试。

它是开源和免费的。

它会生成许多报告，这些报告可以保存到电子表格中。然后，我们使用数据透视表轻松分析和绘制结果。

# objective-c - Objective-C 网络 - 最佳实践？

> ID：567073
> 
> 赞同：11
> 
> 时间：2009-02-19T20:44:52.610
> 
> 标签：objective-c, cocoa, networking, communication-protocol

我正在构建一个既有服务器又有客户端的 Objective-C 应用程序。客户端可以向服务器发送更新，而服务器需要能够向每个连接的客户端发送更新。我一直在考虑如何最好地实施这个系统，但我正在征求你的建议。

目前，我在想，当有新的更新可用时，服务器将使用线程将更新依次发送给每个客户端。如果客户端超时，它们将断开连接。我的网络经验很少，所以想请教您的见解。

你认为这个系统会运作良好吗？如果是这样，您对如何进行线程有任何建议？你可以指点我的任何NS课程吗？我在想，一定有某种我可以使用的队列。

还有其他想法吗？

编辑：我不希望客户数量最多超过 50 个左右。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T21:14:31.880

只要客户端和服务器都是 OS X 应用程序并且都可以使用 Cocoa 框架在 Objective-C 中编写，我强烈建议您看看 Cocoa 中的[分布式对象](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/DistrObjects/DistrObjects.html)(DO) 技术。我不会尝试在这里给出分布式对象的教程，只是解释为什么它可能有用......

DO 为您处理异步网络详细信息（您的所有客户端更新都可能发生在单个线程上）。此外，与远程对象（客户端到服务器或反之亦然；一旦建立连接，DO 是双向的）通信的语义与进程内通信非常相似。换句话说，一旦你引用了远程对象（实际上是`NSDistantObject`连接另一端对象的代理），你的客户端代码就可以将消息发送到远程对象，就好像它是本地对象一样：

```
[remoteServer update:client]; 
```

来自客户或

```
[[remoteClientList objectAtIndex:i] update:server]; 
```

从服务器。[在阅读了分布式对象编程指南](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/DistrObjects/DistrObjects.html)后，我将把设置连接和获取 remoteServer 或 remoteClient 引用的详细信息留给您。

使用 DO 的缺点是你依赖于 Cocoa；编写使用分布式对象进行通信的非 Cocoa 客户端或服务器将*非常困难。*如果您可能希望拥有非 Cocoa 客户端或服务器实现，则不应使用 DO。在这种情况下，我会推荐一些简单的东西，有很多跨平台和语言支持。HTTP 上的 REST 风格的 API 是一个不错的选择。查看 Cocoa [URL 加载系统](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html#//apple_ref/doc/uid/20001836)文档以获取有关如何实现 HTTP 请求和响应的信息。查看 Apple 的[CocoaHTTPServer](http://developer.apple.com/samplecode/CocoaHTTPServer/index.html)示例代码或[同名](http://code.google.com/p/cocoahttpserver/)的 code.google.com 项目，了解有关在 Cocoa 代码中实现 HTTP 服务器的信息。

作为最后一个选项，如果您想实现自己的网络协议，可以查看 Cocoa [Stream Programming Guide 。](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/Streams/Streams.html)`NSStream`的子类将让您侦听网络套接字并处理对该套接字的异步读/写。很多人为此目的使用[AsyncSocket 。](http://code.google.com/p/cocoaasyncsocket/)它包装了（较低级别的）CFStream 和 CFSocket，使编写网络代码更加容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T20:51:54.843

当服务器向客户端发送更新时，让一个线程处理所有更新可能会更容易，并且只使用异步套接字。当然，这也取决于您必须与多少客户打交道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T21:40:01.077

苹果开发者方面有几个网络示例。我建议您检查的一个是可以下载的 URLCache。此示例引用 Apple 的文档：

> URLCache 是一个示例 iPhone 应用程序，它演示了如何从 Web 上下载资源，将其存储在应用程序的数据目录中，以及使用资源的本地副本。URLCache 还演示了如何实现几个缓存策略：

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-18T08:49:00.330

[Jens Alfke 的](http://jens.mooseyard.com/)[BLIP](http://bitbucket.org/snej/mynetwork/wiki/Home)协议是一个有趣的选择。[它就像BEEP](http://en.wikipedia.org/wiki/BEEP)的精简版：一个面向消息的网络系统。它基本上为双向消息管道提供了低级抽象，因此您可以专注于在其之上分层您的通信协议。

它有一些有价值的追随者，例如[Marcus Zarra](http://github.com/mzarra)（CoreData 圣经的作者）和 Flying Meat 软件的 Gus Mueller。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T21:17:10.143

我不知道您打算如何设计系统，但通常服务器无法连接到客户端；客户端必须发起通信。客户端的下限为 50 个，您可能不会查看类似 Web 服务器/客户端的实现......

也就是说，基本上有两种方法来处理客户端服务器通信： 1\. 客户端定期轮询服务器以获取更新 2\. 客户端保持与服务器的连接打开，服务器以众所周知的方式响应（如在双方了解它）协议。

# performance - 如何使用性能监视器查看当前用户？

> ID：567076
> 
> 赞同：6
> 
> 时间：2009-02-19T20:45:21.207
> 
> 标签：performance, iis, service, monitor

修补性能监视器，我看到：

*   Web 服务 -> 当前连接
*   Web 服务 -> 获取请求/秒

有没有更好的柜台可以看？或者也许是其他软件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T23:18:37.457

如下图所示，使用 Web Services -> Get Requests/sec 基本上足以满足我的需求。但是，我希望有更详细的东西。

但是考虑到这是免费的，不能免费。

[替代文字 http://eduncan911.com/blog/thumbnail/3-webservers.png](http://eduncan911.com/blog/thumbnail/3-webservers.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-11T16:29:32.043

要监控小型内部网站，您可以查看“当前连接”，也在“Web 服务”对象中。请记住，这是活动连接，而不是用户，单个用户可以打开多个连接。例如，在我的 SharePoint 2010 环境中，每个用户建立 6 个连接。

# c - 在 C 中返回一个指向常量对象的 void 指针

> ID：567098
> 
> 赞同：2
> 
> 时间：2009-02-19T20:53:21.453
> 
> 标签：c, constants, void-pointers

我正在编写一个访问函数，它返回一个指向内部缓冲区的指针，我想向我的函数的用户提示他们不应该更新指向的对象。一个非常人为的例子是：

```
void myAccessFunc(bool string, void* p, size_t* len)
{
  static const char* s = "aha!";
  static const int i = 123;

  if (string) {
     *(char**)p = &s;
     *len = strlen(s);
  }
  else {
     *(int**)p = &i;
     *len = sizeof(i);
  }
}

char* s;
size_t bytes;
myAccessFunc(true,&s, &bytes);
printf("Got '%s'\n", s); 
```

是的，我知道这看起来很古怪。

我要防止的是：

```
char* s;
size_t bytes;
myAccessFunc(true,&s,&bytes);
s[4] = '?'; 
```

我知道我不能完全阻止它，但我至少希望编译器警告提示用户他们不应该这样做。如果他们投了我的指针，那就是他们的问题。是否有 const 和 void 和 * 的某种组合可以做到这一点？我试过类似的东西：

```
void myAccessFunc(bool string, const void** p, size_t* len); 
```

但它似乎消除了指针的无效性，所以调用者必须这样做：

```
const void* p;
size_t bytes;
myAccessFunc(true, &p, &bytes); 
```

或者

```
const char* s;
size_t bytes;
myAccessFunc(true, (const void**)&s, &bytes); 
```

并且不能这样做：

```
const int * ip;
const char* s;
size_t bytes;
myAccessFunc(true, &s, &bytes);
myAccessFunc(false, &i, &bytes); 
```

我终于来了：

```
const void* myAccessFunc(bool string, size_t* len); 
```

如果用户这样做：

```
char* p = myAcccessFunc(true,&bytes); 
```

编译器（至少是 GCC）确实抱怨丢弃了限定符。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T21:03:58.733

最好执行以下操作：

```
const void * myAccessFunc(); 
```

在将指针返回到内部的地方，这比将其作为输出参数传递更自然一些。

如果要将其作为输出参数传递，则需要：

```
void myAccessFunc(const void **p); 
```

这可以防止他们意外地这样做：

```
void *p;  /* error: must be 'const void *p;' */
myAccessFunc(&p); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T21:06:35.250

你有两件事可以做：

*   返回一个 const void*
*   为您的 API 编写一些文档，告诉用户不要修改返回的值

话虽如此，任何决定尝试用这样的指针弄脏的 API 用户都应该得到他们得到的东西：P。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T21:02:17.117

预防是不可能的，因为你可以抛弃 constness。如果您将函数参数设为 const，则必须自己在函数中将其丢弃。你也会对任何使用你的函数的人撒谎，并可能导致各种有趣的错误。

您可以尝试返回一个指针。那么你至少不会违反你自己的 const。不过，在这种情况下，这可能不合适。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T21:14:44.953

返回一个指针是最好的，但如果你*绝对*需要让它成为一个输出参数，你可以使用一个结构作为中介：

```
typedef struct _ptr_holder {
   const void* ptr;
} ptr_holder;

void myAccessFunc( bool string, ptr_holder* ptr ) {
...
}

ptr_holder s;
myAccessFunc(true,&s);
printf("Got '%s'\n", s.ptr); 
```

这很狡猾，但它应该可以解决问题

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T21:06:28.917

所以你想防止通过你返回的指针进行修改？试试这个：

```
const void* myAccessFunc(bool string); 
```

*这有什么问题？如果您要对有效答案投反对票，请发表评论。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-22T23:58:18.677

如果您正在编写一个不想公开某些内部数据结构的 C 库，那么最好走一条额外的*路线*并使用未指定的 struct typedef 隐藏实现。这也称为[不透明类型](http://c-faq.com/struct/opaquetypes.html)

例子：

在`my_interface.h`

```
 #ifndef __MYINTERFACE_H__
 #define __MYINTERFACE_H__

 /* The unspecified struct statement */
 typedef struct s_my_data t_my_data;

 t_my_data  *new_my_data(int someInitializer);
 void        free_my_data(t_my_data *data);
 int         enter_my_data(t_my_data *data, int someDataToEnter);

 const char *return_str_my_data(t_my_data *data);

 #endif /* __MYINTERFACE_H__ */ 
```

在`my_interface.c`

```
 #include <my_interface.h>

 /* Keep struct in .c file */
 struct s_my_data {
     int    length;
     char  *string;
 };

 t_my_data *new_my_data(int someInitializer)
 {
     /* the exercise */
 }

 void free_my_data(t_my_data *data)
 {
     /* the exercise */
 }

 int enter_my_data(t_my_data *data, int someDataToEnter)
 {
     /* the exercise */
 }

 const char *return_str_my_data(t_my_data *data)
 {
     /* the exercise */
 } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-25T23:31:40.270

这是 C 还是 C++？为什么在 int 情况下将指针传递给静态常量？接口可疑。

重载并去掉界面中的布尔值：

```
void myAccessFunc( const char* * const p, size_t* len){
   *p = "blahblahblah";
   *len = 12;
}

void myAccessFunc( const int* * const ppI, size_t* len){
   static const int i = 123;
   *ppI = &i;
   *len = 4;
} 
```

也摆脱了测试。由于用户知道原始功能的真假，因此他知道要使用哪一个。强打字是你的朋友。摆脱类型和指针不一致的错误类...

顺便说一句，传递此类控制标志而不是重载是不可取的，尤其是在小型方法中。

# algorithm - 确定由2个地理点（纬度，经度）形成的线形是否与地理区域（圆）相交的公式？

> ID：567104
> 
> 赞同：1
> 
> 时间：2009-02-19T20:54:36.553
> 
> 标签：algorithm, math, geometry

它不需要非常准确。有谁知道这样做的好方法？

任何帮助深表感谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T20:07:14.897

当您说“它不需要非常准确”时，您并没有说您准备接受的解决方案*有多不准确。*此外，您没有说所考虑的地理区域可能有多大。这两个标准对需要采取的方法有很大的影响。

对于较小的区域（例如几公里），平坦的近似值可能就足够了（例如，墨卡托投影），并且其他一些响应会告诉您如何做到这一点。对于较大的区域，您必须考虑地球的球形度。如果你希望误差小于百分之一左右，你需要考虑地球的偏心率。

出于此答案的目的，我将假设球形近似已经足够好，并且您的点处于足够相似的高度，我们无需担心它们的高度。

您可以使用转换将地理点 (ψ, λ) 转换为笛卡尔地心坐标

> (ψ, λ) → (a cos(ψ) cos(λ), a cos(ψ) sin(λ), a sin(ψ))

其中 a 是地球的平均半径（6,371 公里）。所以让我们假设定义你的线的两个点是 p₀ 和 p₁；那么通过 p₀ 和 p₁ 的最短线是一个大圆，它定义了一个将地球分成两半的平面，法线 n = p₀ × p₁。

![](https://i.stack.imgur.com/4M6s8.png)

现在我们需要找到圆形区域的边界。假设该区域的中心在 c，并且该区域的表面半径为 s。则该区域的直线半径为 r = a sin(s/a)。我们还需要圆形区域的真实中心，c' = c cos(s/a)。（这一点深埋在地下！）

![](https://i.stack.imgur.com/ObTFJ.png)

我们想将两个圆相交并求解交点。不幸的是，由于数值不精确，这个过程很可能永远不会找到任何解决方案，因为不精确的圆会在 3 维上相互错过。所以我建议以下程序：将两个圆的平面相交，得到下图所示的虚线（除非 c' × n = 0 在这种情况下两个圆是平行的，并且 c' = o，其中如果它们重合，否则它们不相交）。然后将线与圆形区域相交。

![](https://i.stack.imgur.com/HjqBk.png)

这个两步过程将问题减少到二维，并保证即使数值不精确使两个圆在 3 维中丢失，也能找到解决方案。

如果您需要比这更高的精度，则可能需要在参考椭球上使用[大地坐标](http://en.wikipedia.org/wiki/Geodetic_system)，例如[WGS 1984](http://earth-info.nga.mil/GandG/publications/tr8350.2/tr8350_2.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T21:15:00.117

我会说[找到离圆心最近的线上的点，](http://local.wasp.uwa.edu.au/~pbourke/geometry/pointline/)然后确定该点是否在圆内（即所讨论的距离小于或等于圆的半径）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T10:35:30.027

解决问题的大纲：假设地球是一个以原点为中心的半径为 1 的球体。将所有三个纬度、经度点转换为 3D 坐标。直线的两点加上原点定义了一个平面；将该平面与以另一点为中心的半径为 d 的球体相交。如果没有平面-球面相交，则答案是该线不与该区域相交。如果存在平面-球面相交，则问题简化为由平面-球面相交定义的圆形区域与该平面上的最短圆弧相交，该平面上位于直线的端点之间并以原点为中心。如果转换为平面的坐标系，这是一个简单的 2D 问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T11:18:15.870

这个问题太模糊，无法准确回答。你是什​​么意思

> 由 2 个地理点（纬度、经度）组成的线形

这可以是一个穿过它们[的大圆](http://mathworld.wolfram.com/GreatCircle.html)（也称为正交线），也可以是球坐标的线性函数（[loxodrome](http://mathworld.wolfram.com/Loxodrome.html)）。

顺便说一句，我假设你的圆圈是球体表面上的一个圆圈，对吧？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T21:29:41.273

假设直线由点 (x1, y1) 和 (x2, y2) 组成，圆的半径为 r，原点为 (0,0)：

计算：发生率 = r^2 * [(x2 - x1)^2 + (y2 - y1)^2] - (x1 * y2 - x2 * y1)^2

然后，根据 Incidence 的值，我们可以确定以下内容： Incidence < 0：无相交 Incidence = 0：相切（圆上 1 点的交点） Incidence > 0：相交

您的圆很可能不在原点 (0,0)，因此要解决此问题，只需在上面的等式中从您的线坐标添加原点坐标。因此，如果圆在 (x3, y3) 处，则上述等式中的 x1 将变为 x1 + x3。同样，y1 将是 y1 + y3，x2 和 y2 也是如此。

有关更多信息，请查看此[链接](http://mathworld.wolfram.com/Circle-LineIntersection.html)

# javascript - jquery - 传递给 $().grep 的函数范围

> ID：567131
> 
> 赞同：1
> 
> 时间：2009-02-19T21:00:13.033
> 
> 标签：javascript, jquery

以下示例中的“myFunction”似乎失去了作用域。

```
$().grep(myArray, myFunction) 
```

通过这个，我的意思是它不再有权访问它定义的范围的“this”，并且“this”成为窗口对象。谁能解释为什么会这样以及是否有一种方便的方法来保留 myFunction 的范围？这个 javascript 闭包的东西让我半途而废，但我试图轻松应对。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:03:42.447

```
$.grep(myArray, function(){
    return myFunction.apply(realScope, arguments);
}); 
```

将“realScope”替换为预期范围 - 您想要的“this”值。

# c# - 我什么时候应该在 C# 中使用“使用”块？

> ID：567138
> 
> 赞同：73
> 
> 时间：2009-02-19T21:02:07.693
> 
> 标签：c#, .net, using

是否存在我应该（或不应该？）使用“使用”块的特殊情况：

```
using(SomeType t = new SomeType()){
    ...
} 
```

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-02-19T21:47:33.820

某些对象在您完成后需要采取一些行动。通常这是因为对象使用了某种需要处理的资源。例如，如果您有一个 File 类的文件对象，并且该对象从文件系统中打开一个文件，则需要再次关闭文件系统中的文件。

如果您只是离开了文件对象，而忘记调用 file.Close() 它不会被清理，直到垃圾收集器 (GC) 运行并发现没有任何东西仍在使用文件对象。垃圾收集器何时运行应该留给公共语言运行时 (CLR) 来决定。如果在您处理完文件后 GC 有一段时间没有运行，则该文件可能会长时间保持打开状态。如果有很多文件对象，或者如果有东西想打开一个文件，但因为你留下的文件对象还在附近，这可能会造成很大的问题。

为了解决这个问题，C# 提供了 IDisposable 接口。这有一种称为 Dispose 的方法。需要一些清理的类实现了这个 Dispose 方法。这为您提供了一种清理任何使用资源的对象的标准方法。有很多类需要调用 Dispose。这样做的问题是代码被对 Dispose 的调用所覆盖，并且它们很难遵循，因为您新建对象并调用 Dispose 以清理它的位置不同。因此，您必须经常查看代码并非常小心地检查是否在正确的位置调用了 Dispose。

为了解决这个问题，C# 引入了 'using' 关键字。您可以在新建对象的位置放置一个“使用”关键字，这样可以确保为您调用 Dispose。它保证无论发生什么都会调用 Dispose ......即使在 using 语句的主体内抛出异常。

因此，当您想确保分配资源的对象将被清理时，您应该使用“使用”。

* * *

using 只能用于在堆栈上声明的对象，即在函数中。它不适用于声明为类成员的对象。对于他们，您必须自己调用 Dispose。您可能必须在您的类中实现 Dispose，以便在它拥有的任何需要它的成员对象上调用 Dispose。

* * *

需要使用的常见对象有：文件、数据库连接、Pen 和 Brush 等图形对象。

* * *

有时，当您希望两个操作一起发生时，也会使用它。例如，如果您想在输入代码块和退出代码块时编写日志语句，您可以编写一个可以像这样使用的日志类：

```
using( Log log = new Log("Doing stuff") )
{
    // Stuff
} 
```

可以让日志类的构造函数写出消息，Dispose方法也可以写出消息。实现终结器 (~Log) 以断言是否未调用 Dispose 方法以确保在“新日志”周围记住“使用”。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2009-02-19T21:04:45.237

当`SomeType`类实现[`IDisposable`](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx).

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-19T21:05:12.570

[`using`](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)只要类型 implements就使用[`IDisposable`](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)，除非您无论如何要将它包装在[`try`/`catch`](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)块中，那么您也可以（取决于您喜欢的外观）使用[`finally`](http://msdn.microsoft.com/en-us/library/dszsf989.aspx)块。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-19T21:48:36.970

*当您应该*发表`using`声明时，我看到许多其他答案。我想解决什么时候特别不应该*有*一个`using`声明：

如果您需要在当前函数范围之外使用您的对象，请不要使用`using`块。很好的例子是返回数据库连接的工厂方法或需要返回数据读取器的方法。在任何一种情况下，如果您使用`using`语句创建对象，它将在方法返回之前被释放，因此在方法之外无法使用。

现在，您仍然希望*确保*这些对象已被释放，因此您可能仍需要在`using`某处声明。只是不要将它包含在实际创建对象的方法中。相反，您可以将函数调用本身包装在一个`using`语句中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T21:05:21.367

当 SomeType 实现 IDisposable 时。

这对开发人员来说是一个线索，即 SomeType 使用需要清理的非托管资源。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-19T21:21:59.040

例子：

```
 using(SqlConnection MyConnection = new SqlConnection("Connection string"))
        {
            MyConnection.Open();

            //...

            // 1\. SQLConnection is a type that implements IDisposable
            // 2\. So you can use MyConnection in a using statement
            // 3\. When using block finishes, it calls Dispose method of 
            // SqlConnection class
            // 4\. In this case, it will probably close the connection to 
            // the database and dispose MyConnection object

        } 
```

您可以创建自己的实现 IDisposable 的对象：

```
public class MyOwnObjectThatImplementsIDisposable : IDisposable
{

    //... some code

    public void Dispose()
    {
        // Put here the code you want to be executed when the
        // using statement finish.
    }
} 
```

因此，您可以在 using 语句中使用 MyOwnObjectThanImplementsIDisposable 类型的对象：

```
 using(MyOwnObjectThatImplementsIDisposable MyObject = new MyOwnObjectThatImplementsIDisposable)
        {

            // When the statement finishes, it calls the 
            // code you´ve writed in Dispose method
            // of MyOwnObjectThatImplementsIDisposable class
        } 
```

希望这可以帮助

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T21:05:46.983

在这种情况下，该`using`语句对于实现 IDisposable 的类型很方便。当代码块退出`using`语句范围时，`Dispose()`被隐式调用。处理要在使用后立即处理的物体时，这是一个好习惯。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-19T23:16:04.527

`using`使用块时应小心使用的一个特定实例是**WCF 服务客户端**。

如[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa355056.aspx)中所述，将 WCF 客户端（确实实现`IDisposable`）包装在一个`using`块中可以掩盖任何导致客户端处于故障状态（如超时或通信问题）的错误。长话短说，当`Dispose()`被调用时，客户端的`Close()`方法会触发，但会抛出错误，因为它处于故障状态。然后，原始异常被第二个异常掩盖。不好。

有各种解决方法，包括 MSDN 文章本身中的一种。其他可以在[IServiceOriented](http://www.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)和[blog.davidbarret.net](http://blog.davidbarrett.net/archive/2007/11.aspx)找到。

我更喜欢最后一种方法，我自己。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-20T03:56:59.547

如果你想要一个摘要规则。任何时候使用 IDisposable 的对象，如果您没有捕获，请使用 using。本质上，使用的是这种模式：

```
try
{
  //instantiate and use object
}
finally
{
  //dispose object
} 
```

如果您不需要捕获，使用可以节省您的打字，这是一件好事。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-19T21:14:53.940

主要规则是： * 当对象实现 IDisposable 接口时使用 USING 语句。

该接口提供了 Dispose 方法，该方法应该释放对象的资源。如果不调用此方法，则对象将一直保留在内存中，因为 CLR 想要执行垃圾回收。如果程序员使用 USING 语句，那么最后对象将被释放，所有资源都将被释放。

尽快释放所有不再使用的资源非常重要。

有关它的更多信息，请访问此链接：[微软](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-19T22:48:14.220

也许值得一提的是，添加“使用” lo C# 语言的根本原因如下：某些资源可能足够稀缺，以至于等待 GC 调用 IDisposable 是没有意义的。例如，数据库连接。如果你使用 try/catch/finally，你不会得到一个悬空的连接，但是连接会一直挂起，直到 GC 没有启动，这可能需要一段时间（如果你没有明确地关闭它）。如果您使用“使用”（请原谅双关语），即使您忘记关闭它并且即使在 using 块内发生了一些异常，您也会立即释放连接。
另一个原因，正如之前的帖子所提到的，程序员并不总是使用 finally 来清理。如果在异常情况下不使用 finally，你最终会导致资源泄漏......</p>

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T21:06:27.433

一种情况是当您想在代码块的开头做某事，然后在代码块的末尾无条件地撤消它（即使有抛出）。

您构建（并在 using 中调用）的一次性类的 ctor 将执行该操作，然后 Dispose 方法将撤消该操作。这通常是我使用它的方式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-19T21:15:55.513

其他人已经提到过“IDisposable”。

但是使用“using”语句时的警告之一是，即使“SomeType”无论如何都会被处理，“using”中抛出的任何异常都不会被捕获。

所以在下面的片段中，

```
using (SomeType t = new SomeType()){
    throw new Exception("thrown within using");
} 
```

`throw new Exception("thrown within using");`不应忽视。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-19T23:00:43.490

如果某些东西实现了，并且如果你想要处理的东西保留在非托管资源（如数据库连接和文件句柄）上， 我还会添加一条`using()`语句。`IDispose`

如果它是一个普通的对象，比如 a `List<T>`，其中 T 就像一个`Customer`包含名称和地址的对象，那么你不需要。垃圾收集器足够聪明，可以为您管理这些。但是垃圾收集器不会将连接返回到连接池或关闭文件句柄。

# reporting-services - 如何在 Reporting Services 中使用多个结果集

> ID：567141
> 
> 赞同：1
> 
> 时间：2009-02-19T21:02:57.877
> 
> 标签：reporting-services, reportingservices-2005, ssrs-2008

我有一个存储过程，它返回与以下类似的多个结果集：

```
ALTER PROCEDURE sp_XXXX 
(
    XXXXXX
)
AS
SET NOCOUNT ON

SELECT XXXXXXX    

IF @@ROWCOUNT = 0
    SELECT     XXXXXXX

RETURN 
```

如果报告有数据，我希望我的报告使用第一个结果集，或者在第一个为空的情况下使用第二个结果集。有什么帮助吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T21:25:33.060

在存储过程中“联合所有”你的两个结果集。如果您需要将它们区分开来，请添加一个派生列来指示原始结果集。

```
select 'ds1' as dataset, *
from table1
union all
select 'ds2' as dataset, *
from table2 
```

再试一次

将结果集 1 转储到临时表中，如果它为空，则仅执行第二个查询。

伪代码：

```
select * into #tempResult 
from table 1

if table1 is empty 

select * from table2 
```

# c++ - 公共继承和 tlb 文件

> ID：567142
> 
> 赞同：1
> 
> 时间：2009-02-19T21:03:09.190
> 
> 标签：c++, inheritance, typelib

假设您有两个程序集（两个 dll）。第一个包含一个名为 Base 的类，第二个包含一个名为 Derived 的类，它公开继承自 Base。

当我在 Visual Studio 2005 中使用 tlb 文件创建 C++ 类时，我得到了 Base 和 Derived 类，但其中一个不是另一个的子类。似乎没有任何 IS-A 关系。是否有一个原因？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:31:58.867

我在这里假设两个程序集通过 COM 相互通信，如果确实如此，那么您是正确的，COM 中没有关于 CLASS 继承的 IS-A 关系，仅关于接口继承.

如果您要定义从 IBase 派生的接口 IBase 和 IDerived，那么您将能够在实现两者的同一对象上将 IDerived 强制转换为 IBase。

# ruby-on-rails - Rails wiki 风格的编辑——纺织还是降价？

> ID：567155
> 
> 赞同：13
> 
> 时间：2009-02-19T21:04:46.003
> 
> 标签：ruby-on-rails

我希望在我们的 Rails Web 应用程序上为我们的用户提供一些 wiki 风格的编辑功能（就像我现在使用的一样*） 。*有没有人对我是否应该使用 Markdown/BlueCloth 或 Textile/RedCloth（或完全其他的东西）有任何意见？

另外，与[这个问题](https://stackoverflow.com/questions/501737/how-do-i-textile-and-sanitize-html)有关，从 XSS 的角度来看，BlueCloth 是否安全？

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-19T21:34:49.140

我发现 Markdown 对人们来说更容易学习（因为它看起来像人们通常如何“设计”纯文本）并且与底层 HTML 的联系不太紧密。Textile 有大量的方法来指定标题和 HTML 类等等——对于一个人的博客很有用，对于一个通用的模板引擎来说就没有那么多了。

对于 Ruby Markdown 支持，我会考虑 RDiscount。但据我所知，Markdown 和 Textile 都没有做任何事情来保护你免受 XSS 的侵害。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T22:49:44.060

我个人更喜欢 Textile，无论是语法还是易用性。即使让 Markdown 工作，我也遇到了很多问题，但 Textile 很快。

我一直在使用带有自定义代码的 Textile，加上这个用于客户端编辑器的[Javascript 文本区域编辑器，它的性能很好。](http://livepipe.net/control/textarea)

Textile 还将许多速记转换为其适当的印刷/语法等价物（即 - 转换为破折号），这对于发布或打印网站来说非常有用，或者只是作为个人喜好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-19T15:58:37.367

实际上，Textile 有一个“受限”模式，可以防止 XSS 攻击。 [纺织品参考手册](http://thresholdstate.com/articles/4312/the-textile-reference-manual#toc_0 "为什么使用纺织品？")

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T22:39:00.157

如果您需要提供该功能，请考虑哪种标记语言具有良好的 WYSIWYG 助手。我为 Textile 找到了[这些](http://blog.aisleten.com/2008/09/11/rails-textile-and-javascript-wysiwyg-roundup/)，但我不知道 Markdown 有什么可用的。

# windows - 在 Windows 下打包具有依赖关系的应用程序

> ID：567158
> 
> 赞同：3
> 
> 时间：2009-02-19T21:05:20.197
> 
> 标签：windows, gtk, gtkmm

我在 Linux 下使用 gtkmm 和 libpcap 编写了一个应用程序。当然，gtkmm 依赖于 GTK+。

将其移植到 Windows 并尝试分发后，我收到的反馈是要安装的依赖项太多。

用户必须先运行 GTK+、gtkmm 和 winpcap 运行时的安装程序，然后才能运行我的小应用程序，这无疑是一种痛苦。

GIMP for Windows 似乎使用了一个安装程序，如果需要，它会启动一个 GTK+ 安装程序，但是对三个不同的库这样做似乎有点过分，尤其是在安装程序大小方面。

有没有更好的方法来分发这个？我相信 winpcap 实际上必须安装一个服务，所以它可能必须运行安装程序，但也许我可以将 GTK+/gtkmm 库捆绑在运行时文件夹中？

我对 Linux 开发比较熟悉，所以我不确定最好的做法是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T20:46:39.640

我强烈建议使用像[Advanced Installer](http://www.advancedinstaller.com/)这样的工具来为您处理这个问题。在 Windows 上制作正确的安装程序确实令人头疼，因此值得您花时间使用 GUI 工具来帮助您。AI（以及其他安装程序，就此而言）可以安装和管理 Windows 服务、先决条件等，从长远来看，通过使用这样的工具来帮助您进行部署，您将节省大量时间。特别是 Advanced Installer 对管理不同的依赖项及其相关版本有很好的支持，它还可以在安装过程中安装本机 Windows 服务。他们有一个免费软件版本，但根据您产品的性质，您可能想要选择其中一个商业版本。

基本上，如果您认真考虑在 Windows 上进行部署，您应该投入时间（可能还有金钱）来制作合适的 MSI 风格的安装程序。不是要打击 NSIS 的人群，而是制作非标准的 Windows 安装程序总是会给开发人员带来更多的工作，给最终用户带来更不舒服的体验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T21:50:16.477

如果您想手动打包 GTKmm 运行时，请参阅gnome.org 上的[此链接](http://live.gnome.org/gtkmm/MSWindows)以获取更多详细信息（请参阅 Redistributing 下）。您还可以使用 /S 标志静默运行 GTKmm 安装程序。

# c++ - 包装器的 C++ 链接器问题

> ID：567160
> 
> 赞同：1
> 
> 时间：2009-02-19T21:05:37.500
> 
> 标签：c++, linker, wrapper

我有一个库 opengl.lib，其中包含所有 opengl 函数的包装函数。这些函数在它们自己的命名空间中声明，以便包装函数可以使用与 opengl 函数相同的名称命名。所以在包装函数内部，opengl 函数是用 ::gl***(); 调用的。

```
opengl.h:
namespace OpenGL {
    void glFunction();
}

opengl.cpp:
void OpenGL::glFunction() {
    ::glFunction();
} 
```

现在的问题是，当我在我的应用程序中使用这个 opengl.lib 并包含我自己的“opengl.h”时，由于某种原因，真正的 opengl 函数被直接调用，而不是我的包装函数。

我已经确定我没有包含任何真正的 opengl.h，所以这一定是某种链接器问题。我该如何解决？我在库路径中也有真正的 opengl 库，否则我的 opengl.lib 中会出现链接器错误，因为它使用了真正的 opengl 函数。所以真正的 opengl 库和我的 opengl.lib 以某种方式混合在一起，链接器决定使用真正的 opengl.lib 而不是我的。

我知道我可以通过将包装函数重命名为其他名称来解决此问题，但我想使用相同的名称。

这个问题与我之前的问题[C++ wrapper with same name?](https://stackoverflow.com/questions/565459/c-wrapper-with-same-name)

我正在使用禁用优化的 Visual C++。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:09:55.557

您的包装纸是否足够薄，可以内联？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T21:23:55.090

实际的 opengl.h 是否与您的包装头文件命名相同？如果是，您可能**在**没有意识到的情况下将其包含在内，因为编译器会在用户定义的路径之前搜索系统路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-18T22:05:57.370

当你构建你的 opengl.lib 时，你应该只需要链接真正的 opengl lib。确保您在使用您自己的库的项目中没有对真正的 opengl 库的任何引用。如果您没有对真实库的任何引用，则无法调用真实函数。完成后，请确保您使用的是正确的命名空间。

```
// Call OpenGL::glFunction();
using namespace OpenGL;
glFunction(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T22:19:58.860

查看预处理的 cpp 文件对于解决此类问题非常有帮助。

在 Visual C++ 中，进入文件的属性，包括您的 opengl.h，在 Preprocessor 中启用“Generate Proprocessed File”选项（/P）

这将生成一个 .i 文件

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-10T22:19:38.137

问题不在于您发布的内容的定义，而在于您的调用。您可以发布有关如何调用该函数的相关代码吗？

`OpenGL::glFunction();`将是我会怎么做，它会工作。

# math - 一种检查 num1 的数字是否是 num2 中的数字而不检查每个数字的方法？

> ID：567165
> 
> 赞同：0
> 
> 时间：2009-02-19T21:06:34.407
> 
> 标签：math, puzzle

假设我猜到了一个彩票号码：

> 1689

彩票的运作方式是，只要数字与实际中奖彩票号码中的数字 1:1 匹配，数字的顺序就无关紧要。

因此，数字 1689 将是一个中奖彩票号码：

> 1896、1698、9816等。

只要您猜中的每个数字都出现在目标号码中，那么您就中了彩票。

有没有数学方法可以做到这一点？

我已经通过 O(N^2) 循环检查每个数字与中奖彩票号码的每个数字（用模数分隔）解决了这个问题。这很好，它有效，但我想知道我是否可以做任何巧妙的数学技巧。

例如，起初......我认为我可能会很棘手，只取两个数字中每个数字的总和和乘积，如果它们匹配，那么你就赢了。

^ 你觉得这样行吗？

~~然而，当我发现彩票猜测：222 和 124 的数字不同但乘积和总和相同时，我很快就反驳了这一点。~~

任何人都知道我可以用来快速确定 num1 中的数字是否与 num2 中的数字匹配的任何数学技巧，而不管顺序如何？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T21:15:04.623

如何遍历每个数字，并计算每个数字出现的次数（进入两个不同的 10 元素数组）？完成总计后，比较每个数字的计数。由于您只查看每个数字一次，因此 O(N)。

代码看起来像：

```
for(int i=0; i<digit_count; i++)
{
   guessCounts[guessDigits[i] - '0']++;
   actualCounts[actualDigits[i] - '0']++;
}

bool winner = true;
for(int i=0; i<10 && winner; i++)
{
   winner &= guessCounts[i] == actualCounts[i];
} 
```

上面的代码假设guessDigits 和actualDigits 都是char 字符串；如果他们持有实际数字，那么您可以跳过该`- '0'`业务。

可能有一些优化可以使这占用更少的空间或更快地终止，但这是 O(N) 方法的一个非常简单的示例。

顺便说一句，正如我在评论中提到的，乘法/求和比较肯定不会因为零而起作用。考虑 0123 和 0222。两种情况下乘积为 0，总和为 6。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-19T21:08:58.553

拆分为数组，排序数组，加入字符串，比较字符串。

（不是数学把戏，我知道）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T21:10:49.517

您可以将数字放入数组中，对数组进行排序，然后逐个元素地比较数组。这将为您提供 O( NlogN ) 复杂度，优于 O( N^2 )。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T21:21:16.093

如果 N 可以变大，那么对数字进行排序就是答案。

因为数字是 0..9，所以您可以在数组 [0..9] 中计算彩票答案的每个数字出现的次数。

要进行比较，您可以为猜测中遇到的每个数字减去 1。当你遇到一个计数已经为 0 的数字时，你知道猜测是不同的。当您通过所有数字时，猜测是相同的（只要猜测的数字与彩票答案一样多）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T21:22:48.947

对于每个数字 d 乘以第 (d+1) 个素数。

这比排序或桶方法更数学但效率更低。其实是变相的bucket方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T21:09:50.547

我会对两个数字的数字进行排序并进行比较。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T21:09:57.380

在存储数字之前对数字进行排序。之后，您的人数将相等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T21:12:04.117

如果您只处理 4 位数字，我认为您不必考虑使用哪种算法。它们的性能大致相同。

222 和 124 的总和也不相同

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T21:13:54.440

您必须考虑，当 n 较小时，效率的顺序无关紧要，常数开始变得更重要。你的数字实际上能有多大？你能达到10位数吗？20？100？如果您的数字只有几位数字，那么 n^2 确实还不错。如果您有数千位数字的字符串，那么您实际上可能需要做一些更聪明的事情，比如排序或分桶。（即数 0、数 1 等）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T21:32:59.660

我从 Yuliy 和 starblue 那里偷了答案（支持他们）

除了 O(1) 之外，分桶是最快的

```
lottonumbers == mynumbers; 
```

排序是 O(nlog2n)

Bucketsort 是一种 O(n) 算法。

因此，您需要做的就是做两次（一次用于您的数字，一次用于目标集），如果数字的数字相加，则它们匹配。在这种情况下，任何类型的排序都是不必要的额外开销。

```
array[10] digits;
while(targetnum > 0)
{
    short currDig = targetnum % 10;
    digits[currDig]++;
    targetnum = targetnum / 10;
}
while(mynum > 0)
{
    short myDig = mynum % 10;
    digits[myDig]--;
    mynum = mynum / 10;
}
for(int i = 0; i < 10; i++)
{
   if(digits[i] == 0)
      continue;
   else
     //FAIL TO MATCH
} 
```

我承认，这不是最漂亮的代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T23:07:44.393

创建一个下标为 [0 .. 9] 的 10 个整数的数组。

将每个元素初始化为不同的素数

将产品设置为 1。

使用数字中的每个数字，在数组中下标，取出质数，然后将乘积乘以它。

这为您提供了与数字顺序无关的独特表示。

对其他号码执行相同的程序。

如果唯一表示匹配，则原始数字匹配。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-20T02:36:37.557

如果不允许重复数字（但不确定是否是这种情况），则使用 10 位二进制数。最高有效位代表数字 9，LSB 代表数字 0。依次处理每个数字，并为找到的每个数字翻转适当的位

所以 1689 将是： 1101000010

和 9816 也将是： 1101000010

如果你是赢家，那么 XOR 或减法将留下 0

这只是一种简单的分桶形式

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-20T04:23:06.507

只是为了好玩，并在正常情况下思考，而不是排序和其他方式，做删除的事情。如果结果字符串为空，则您有赢家！

```
 Dim ticket As String = "1324"
    Dim WinningNumber As String = "4321"

    For Each s As String In WinningNumber.ToCharArray
        ticket = Replace(ticket, s, "", 1, 1)
    Next

    If ticket = "" Then MsgBox("WINNER!")
    If ticket.Length=1 then msgbox "Close but no cigar!" 
```

这也适用于重复数字..

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-02-21T09:13:40.187

一个可爱的解决方案是使用[Zobrist hashing](http://en.wikipedia.org/wiki/Zobrist_hashing)的变体。（是的，我知道这是矫枉过正的，以及概率，但嘿，它是“聪明的”。）

将一个十元素数组初始化`a[0..9]`为随机整数。然后，对于每个数字`d[]`，计算 的总和`a[d[i]]`。如果数字包含相同的数字，则结果数字将相等；*以高概率*（有多少个可能的整数约为 1），反之亦然。

（如果您知道总共最多有 10 位数字，那么您可以使用固定数字 1、10、100，...而不是随机数来保证成功。这是不太伪装的桶排序。 )

# c - 以编程方式查找受 Postgres COPY 影响的行数

> ID：567167
> 
> 赞同：4
> 
> 时间：2009-02-19T21:06:50.927
> 
> 标签：c, postgresql

我正在使用 Postgres 8.2 和用于 ANSI C 的相关 libpq 库。我浏览了文档并没有找到可以为我提供特定信息的内容。

在文档的“COPY”部分中，“输出”是这样描述的：

> 成功完成后，COPY 命令返回形式为
> COPY count
> 的命令标记。计数是复制的行数。

假设 conn 指的是一个有效的 PGconn*，我想我可以使用这样的东西来返回复制的行数：

```
 sprintf(queryString, "COPY table FROM '%s' WITH DELIMITER '|'", 
            tempFileName);
    fprintf(stderr, "COPY all records: %s\n", queryString);
    res = PQexec(conn, queryString);
    bResultErr = (PQresultStatus(res) != PGRES_COMMAND_OK);
    if (bResultErr) {
        PQclear(res);
         fprintf(stderr, "Aborting:DELETE failed: %s\n", 
                 PQerrorMessage(conn));
         PQfinish (conn);
         exit (1);
    } else {
        // Display how many records were COPY'd
        fprintf(stderr, "COPY completed: %d rows imported\n", 
                PQntuples(res));
        PQclear(res);
    } 
```

然而，输出总是“复制完成：0 行导入”，尽管行*已*导入。

我会很感激任何提示

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T21:46:29.970

```
 fprintf(stderr, "COPY completed: %s rows imported\n", PQcmdTuples(res)); 
```

请注意`%s`，它是一个字符串，而不是整数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-30T13:43:29.817

[PQntuples()](http://www.postgresql.org/docs/current/interactive/libpq-exec.html#LIBPQ-EXEC-NONSELECT)返回查询结果的行数，为 0。它返回一个 int 类型。

[PQcmdTuples()](http://www.postgresql.org/docs/current/interactive/libpq-exec.html#LIBPQ-EXEC-NONSELECT)返回受您发出的 sql 命令影响的行数（在本例中为 COPY）。它返回一个 char 类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:21:59.133

我相信你需要使用[PQcmdTuples](http://www.postgresql.org/docs/8.2/static/libpq-exec.html#LIBPQ-EXEC-NONSELECT) () 而不是 PQntuples()。

# sql - scope_identity 与 ident_current

> ID：567171
> 
> 赞同：10
> 
> 时间：2009-02-19T21:08:30.113
> 
> 标签：sql, sql-server, tsql

经过大量研究后，我对应该在 sql 中使用哪个身份跟踪器感到有些困惑。

据我了解，scope_identity 将为我提供从任何表更新的最后一个 id，而 ident_current 将返回指定表中的最后一个 id。

因此，鉴于这些信息，在我看来，最好使用的版本（如果您知道要更新哪个表）是 ident_current。然而，在阅读后，似乎大多数人更喜欢使用 scope_identity。这背后的原因是什么，我的逻辑是否存在缺陷？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-19T21:13:48.170

在那种情况下你需要写表名，如果你决定改变表名会发生什么？然后，您也不能忘记更新您的代码以反映这一点。我总是使用 SCOPE_IDENTITY 除非我需要触发器中发生的插入的 ID，然后我将使用 @@IDENTITY

另外更大的区别是 IDENT_CURRENT 会给你来自另一个执行插入的进程的身份（换句话说，最后从任何用户生成的身份值）所以如果你做了一个插入然后有人在你做 SELECT IDENT_CURRENT 你之前做了一个插入会得到那个人的身份值

另请参阅[获取当前标识值的 6 种不同方法](http://wiki.lessthandot.com/index.php/6_Different_Ways_To_Get_The_Current_Identity_Value)，其中有一些代码解释了当您将触发器放在表上时会发生什么

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-26T00:33:16.980

根据我的阅读，scope_identity()*应该*是正确的答案，但是如果您的插入导致并行查询计划，SQL 2005 和 SQL 2008 中似乎存在一个错误，该错误可能会发挥作用。

请查看以下文章以获取更多详细信息：

[`@@IDENTITY vs SCOPE_IDENTITY() vs IDENT_CURRENT`- 检索最后插入的记录标识](http://blog.sqlauthority.com/2007/03/25/sql-server-identity-vs-scope_identity-vs-ident_current-retrieve-last-inserted-identity-of-record/)

文章：[您应该对并行性感到紧张的六个原因](https://sqlblog.org/2009/03/21/six-reasons-you-should-be-nervous-about-parallelism)

请参阅标题为：***1\. #328811，“`SCOPE_IDENTITY()`有时返回不正确的值”的部分***

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T21:16:13.123

有关详细答案，请参阅[此博文。](http://blog.sqlauthority.com/2007/03/25/sql-server-identity-vs-scope_identity-vs-ident_current-retrieve-last-inserted-identity-of-record/)由于触发器完成了插入，Scope_identity 永远不会返回身份。在表名发生变化的变化世界中使用 ident_current 并不是一个好主意。就像在开发环境中一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-27T15:35:48.097

```
/*
* IDENT_CURRENT returns the last identity value generated for a specific table in any session and any scope.
* @@IDENTITY returns the last identity value generated for any table in the current session, across all scopes.
* SCOPE_IDENTITY returns the last identity value generated for any table in the current session and the current scope.
*/

IF OBJECT_ID(N't6', N'U') IS NOT NULL
    DROP TABLE t6 ;
GO
IF OBJECT_ID(N't7', N'U') IS NOT NULL
    DROP TABLE t7 ;
GO
CREATE TABLE t6 (id INT IDENTITY) ;
CREATE TABLE t7
    (
     id INT IDENTITY(100, 1)
    ) ;
GO
CREATE TRIGGER t6ins ON t6
    FOR INSERT
AS
    BEGIN
        INSERT  t7
                DEFAULT VALUES
    END ;
GO
--End of trigger definition

SELECT  id
FROM    t6 ;
--IDs empty.

SELECT  id
FROM    t7 ;
--ID is empty.

--Do the following in Session 1
INSERT  t6
        DEFAULT VALUES ;
SELECT  @@IDENTITY ;
/*Returns the value 100\. This was inserted by the trigger.*/

SELECT  SCOPE_IDENTITY() ;
/* Returns the value 1\. This was inserted by the
INSERT statement two statements before this query.*/

SELECT  IDENT_CURRENT('t7') ;
/* Returns 100, the value inserted into t7, that is in the trigger.*/

SELECT  IDENT_CURRENT('t6') ;
/* Returns 1, the value inserted into t6 four statements before this query.*/

-- Do the following in Session 2.
SELECT  @@IDENTITY ;
/* Returns NULL because there has been no INSERT action
up to this point in this session.*/

SELECT  SCOPE_IDENTITY() ;
/* Returns NULL because there has been no INSERT action
up to this point in this scope in this session.*/

SELECT  IDENT_CURRENT('t7') ;
/* Returns 100, the last value inserted into t7.*/ 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-04T23:51:32.613

`SELECT IDENT_CURRENT`- 正如您所说，将为您提供特定于表的最后插入的标识值。存在与此相关的问题，一是用户需要有权查看元数据，否则它会返回 NULL，二是您正在硬编码表的名称，如果表名称发生更改，这将导致问题。

最佳实践是将 Scope_Identity 与变量一起使用......看下面的例子

```
 DECLARE @myFirstTableID INT

  DECLARE @mySecondTableID INT

  INSERT INTO MYFirstTable (....) VALUES (.....)

   SELECT @myFirstTableID =SCOPE_IDENTITY()

  INSERT INTO MYSecondTable () VALUES (.....)

   SELECT @mySecondTableID=SCOPE_IDENTITY() 
```

因此，通过在感兴趣的插入语句旁边使用变量和 scope_identity，您可以确保从正确的表中获得正确的标识。享受

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-20T17:16:29.457

该理论说：**要了解竞争条件并且不关心触发器内的插入，您应该使用`SCOPE_IDENTITY()`**BUT ... SCOPE_IDENTITY() （和@@IDENTITY）上存在已知错误，正如在其他回答者上提到和链接的那样. [以下是 Microsoft](http://support.microsoft.com/default.aspx?scid=kb;en-US;2019779)考虑到此错误的解决方法。

下面是文章中最相关的部分。它使用`output`插入的子句：

```
DECLARE @MyNewIdentityValues table(myidvalues int)
declare @A table (ID int primary key)
insert into @A values (1)
declare @B table (ID int primary key identity(1,1), B int not null)
insert into @B values (1)
select
    [RowCount] = @@RowCount,
    [@@IDENTITY] = @@IDENTITY,
    [SCOPE_IDENTITY] = SCOPE_IDENTITY()

set statistics profile on
insert into _ddr_T
output inserted.ID into @MyNewIdentityValues
    select
            b.ID
        from @A a
            left join @B b on b.ID = 1
            left join @B b2 on b2.B = -1

            left join _ddr_T t on t.T = -1

        where not exists (select * from _ddr_T t2 where t2.ID = -1)
set statistics profile off

select
    [RowCount] = @@RowCount,
    [@@IDENTITY] = @@IDENTITY,
    [SCOPE_IDENTITY] = SCOPE_IDENTITY(),
    [IDENT_CURRENT] = IDENT_CURRENT('_ddr_T')
select * from @MyNewIdentityValues
go 
```

# asp.net-ajax - Ajax 脚本管理器和母版页

> ID：567180
> 
> 赞同：9
> 
> 时间：2009-02-19T21:12:18.547
> 
> 标签：asp.net-ajax, master-pages

我正在建立一个新网站并想使用 Ajax 控件。

我是否需要在 MasterPage 和每个内容页面上都放置一个 ScriptManager 控件？或仅在 MasterPage 上？（或仅在内容页面上？）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T21:51:16.260

内容页面或 MasterPages 上只能有一个 ScriptManager 控件。如果您的 MasterPage 上有 ScriptManager 控件，则可以将 ScriptManagerProxy 控件拖放到内容页面上，以使用任何给定的特定 ASP.NET AJAX 功能，例如：

```
<asp:Content ID="Content1" ContentPlaceHolderID="BodyContent" runat="server">
    <asp:ScriptManagerProxy ID="ScriptManagerProxy1" runat="server">
        <Services>
            <asp:ServiceReference Path="~/MyWebServices/YourCoolWebService.asmx" />
        </Services>
    </asp:ScriptManagerProxy>

    <%-- more content stuff goes here --%>
<asp:Content> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T21:14:59.727

您只能拥有一个 ScriptManager。你可以把它放在任何一个上。将它放在母版页上可以省去在内容页上添加它的任务。但是，只有在内容页面中有自定义脚本时，才能在脚本管理器中编写自定义脚本。如下所述，拥有两个 ScriptManager 会在加载页面时引发错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:14:38.527

只是母版页。除非您要使用上面提到的自定义脚本，否则我建议您将其放在母版页上，这样您就不必将其放在要使用 ajax 控件的每个页面上。

如果你同时拥有它，它会抛出一个错误，说你只能有一个脚本管理器/页面

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T21:20:22.990

您在寻找什么功能？[如果您改用jQuery](http://www.jquery.com/)，您可能会做同样多或更多的事情，但占用空间要轻得多，代码性能更好，并且可以更好地控制实际发生的事情。看看这个！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-19T05:34:32.377

jQuery vs ASP.NET AJAX 不是一个“非此即彼的问题”。尽管它们具有重叠的功能，但它们非常不同，我每天都根据任务使用它们。尽可能使用 jQuery - 但是 MS AJAX 添加了大量的 ASP.NET 便利功能。

# java - 一个好的Java 2d 引擎？

> ID：567181
> 
> 赞同：4
> 
> 时间：2009-02-19T21:12:34.677
> 
> 标签：java, graphics, 2d, sprite

有谁知道带有精灵、动画和碰撞处理的 Java 2D 引擎？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T02:41:19.293

JGame 可能是您正在寻找的。

您可能还想查看这个问题（[https://stackoverflow.com/questions/293079/java-2d-game-frameworks](https://stackoverflow.com/questions/293079/java-2d-game-frameworks)），其中包含引擎列表以及对其中一些引擎的一些反馈。希望它有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-02T11:55:48.853

[Slick2D](http://slick.cokeandcode.com/)似乎是一个非常可靠的选择。

它被广泛使用，它基于 OpenGL（通过[LWJGL](http://www.lwjgl.org/)），因此如果您需要它，您可以获得一些相当不错的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-02T12:23:11.390

如果您是第一次使用 Java 进行游戏开发，那么来自[BlueJ制造商的](http://bluej.org/)[Greenfoot将是一个不错的选择。](http://www.greenfoot.org/door)它甚至不是一个易于学习的 API，而是带有完全集成的 Greenfoot 表面的开发环境。

游戏环境是游戏中的[`greenfoot.World`](http://www.greenfoot.org/files/javadoc/greenfoot/World.html)每个元素都是一个[`greenfoot.Actor`](http://www.greenfoot.org/files/javadoc/greenfoot/Actor.html)实例。Actor 类为真正的位图交集 ( [`greeenfoot.Actor.intersects()`](http://www.greenfoot.org/files/javadoc/greenfoot/Actor.html#intersects%28greenfoot.Actor%29)) 提供了一种方法。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T21:26:44.210

*   游戏
*   阿里安

Tangent：你最好从 Java 分支出来。游戏开发行业以 C++/Python 为主，C# 位居第三。

# forms - 如何过滤掉 Oracle Forms 中文本项字段上的字符？

> ID：567195
> 
> 赞同：0
> 
> 时间：2009-02-19T21:14:43.673
> 
> 标签：forms, oracle, oracleforms

我们正在使用 oracle 表单......我们必须保护（或）阻止特殊字符的文本项字段。喜欢（！@#$%^&*）请发送一些指导......在此先感谢......

问候，维杰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T22:51:03.217

哪个版本的表格？

蛮力法：

```
v_prohibited_chars VARCHAR2(100) := '!@#$%^&*';
v_result           VARCHAR2(4000);
...
-- strip prohibited characters
v_result := TRANSLATE(:form_field,'A'||v_prohibited_chars,'A');

-- if anything was stripped, lengths will differ
IF LENGTH(:form_field) <> LENGTH(v_result) THEN
  error...
END IF 
```

如果我正确理解您的评论，您是否希望能够从表单字段中过滤掉特殊字符？

上面的代码做到了这一点，并将结果放在 v_result 中。因此，如果您的输入值为 'ABC#DEF#'，并且您的过滤器掩码是 '!@#$%^&*'，那么在执行 TRANSLATE 后，您的结果将是 'ABCDEF'。然后，您可以将此值重新分配给您的表单字段。如果您只是想默默地剥离字符，您可以跳过 LENGTH 检查，只需将 TRANSLATE 的输出分配回您的表单字段：

```
:form_field := TRANSLATE(:form_field,'A'||v_prohibited_chars,'A'); 
```

TRANSLATE 所做的是将第一个参数中的字符与第二个参数中的字符进行比较。当它找到匹配项时，它将该字符转换为第三个参数中的相应字符。如果第三个参数中没有对应的字符存在于第二个中的一个，则该字符被转换为 NULL。如果字符没有出现在第二个参数中，则保持不变。因此，字符“A”被转换为“A”，而掩码中的所有其他字符都被转换为 NULL。第三个参数不能为 NULL，因此 'A' 到 'A' 的虚拟转换。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T21:26:15.290

当您的文本框作为一些输入文本时，您必须具有验证所有输入的功能。

在该函数上，您有一个无效值范围。该范围以 ASCII 格式表示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T21:41:39.903

您可以使用格式掩码属性，如 999.99

# iis - 经典 Asp 页面错误“访问 OLE 注册表时出错。” （权限，用户？）

> ID：567212
> 
> 赞同：0
> 
> 时间：2009-02-19T21:18:28.457
> 
> 标签：iis

我认为这与权限有关。Web 应用程序的身份验证是“Windows 集成身份验证”。我需要这个，因为该应用程序取决于窗口登录名。

这是错误。

错误类型：错误 '8002801c' 访问 OLE 注册表时出错。

/iisHelp/common/500-100.asp，第 154 行

提前感谢您的任何提示。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-25T23:41:05.773

您使用的是什么版本的 IIS？也许您必须将经过身份验证的用户添加到 IIS_WPG 本地组

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-25T23:55:39.127

使用具有更高权限的帐户。这很可能是权限错误。

# c# - WPF 中是否存在“加载所有子项”事件

> ID：567216
> 
> 赞同：37
> 
> 时间：2009-02-19T21:20:47.873
> 
> 标签：c#, .net, wpf

我正在监听页面的加载事件。该事件首先触发，然后所有的孩子触发他们的加载事件。我需要一个在所有孩子都加载后触发的事件。那存在吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2013-08-03T22:17:04.160

我听到你了。为此，我还缺少 WPF 中的开箱即用解决方案。

有时您希望在加载所有子控件后执行一些代码。

把这个放在父控件的构造函数中

```
Dispatcher.BeginInvoke(DispatcherPriority.Loaded, new Action(() => {code that should be executed after all children are loaded} )); 
```

到现在帮了我几次。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-19T21:53:04.010

`Loaded`是所有孩子都发生过的事件`Initialized`。`AfterLoad`据我所知，没有任何事件。如果可以的话，将孩子的逻辑移到`Initialized`事件中，然后`Loaded`在它们都被初始化之后才会发生。

请参阅[MSDN - 对象生命周期事件](http://msdn.microsoft.com/en-us/library/ms754221.aspx)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-31T08:55:18.587

您还可以使用事件：ContentRendered。

[http://msdn.microsoft.com/en-us/library/ms748948.aspx#Window_Lifetime_Events](http://msdn.microsoft.com/en-us/library/ms748948.aspx#Window_Lifetime_Events)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T22:00:04.820

WPF 无法提供这种事件，因为大多数时候数据正在确定是否将特定子项加载到 VisualTree（例如 DataTemplate 中的 UI 元素）

因此，如果您可以更清楚地解释您的场景，我们可以找到特定的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-22T17:48:54.170

我有同样的问题。@configurator 是对的，如果您遇到此问题，那么我相信这是因为您的子元素有问题。在我的情况下，自定义用户控件所在的子元素。我错误地初始化了它们。我修复了用户控件，一切都很好

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-18T17:28:14.420

选项之一（呈现内容时）：

this.LayoutUpdated += OnLayoutUpdated;

```
private void OnLayoutUpdated(object sender, EventArgs e)
            {
                if (!isInitialized && this.ActualWidth != 0 && this.ActualHeight != 0)
                {
                    isInitialized = true;
                    // Logic here
                }
            }; 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2010-05-20T19:48:29.583

我最终做了一些事情......你的里程可能会有所不同。

```
void WaitForTheKids(Action OnLoaded)
{
  // After your children have been added just wait for the Loaded
  // event to fire for all of them, then call the OnLoaded delegate

  foreach (ContentControl child in Canvas.Children)
  {
    child.Tag = OnLoaded; // Called after children have loaded
    child.Loaded += new RoutedEventHandler(child_Loaded);
  }
}
internal void child_Loaded(object sender, RoutedEventArgs e)
{
  var cc = sender as ContentControl;
  cc.Loaded -= new RoutedEventHandler(child_Loaded);

  foreach (ContentControl ctl in Canvas.Children)
  {
    if (!ctl.IsLoaded)
    {
      return;
    }
  }
  ((Action)cc.Tag)();
} 
```

# apache-flex - 当我为我的 WebService 参数使用动态类时，不包括公共属性

> ID：567217
> 
> 赞同：1
> 
> 时间：2009-02-19T21:20:54.097
> 
> 标签：apache-flex, actionscript-3, web-services, class, actionscript

我有一个动态类，它是一个值对象，用于将参数传递给 WebService。它有两个公共属性：

```
package
{
    [Bindable]
    public dynamic class WebServiceCriteria
    {
        public var property1:String;

        public var property2:String;
    }
} 
```

我在我的应用程序的一部分中设置了这两个属性：

```
var myCriteria:WebServiceCriteria = new WebServiceCriteria();

myCriteria.property1 = "x";

myCriteria.property2 = "y"; 
```

然后我在我的应用程序的另一点添加了其他动态属性：

```
myCriteria.property3 = "z"; 
```

但是，当我将实例作为参数传递给 WebService 时，不会发送原始的两个公共属性（正如我在 Fiddler 中看到的那样），即使它们具有值。但是，我可以在 send() 之前的调试器中将它们视为我的 Class 实例的属性。

```
operation.arguments = {args: myCriteria};

operation.send(); // only property3 is sent 
```

为什么没有发送这两个属性？

下面是发送到 WebService 的 SOAP 请求示例：

```
<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <SOAP-ENV:Body SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
    <intf:webservice_controller xmlns:intf="http://childDir.parentDir">
      <args xsi:type="apachesoap:Map" xmlns:apachesoap="http://xml.apache.org/xml-soap">
        <item>
          <key xsi:type="xsd:string">property1</key>
          <value xsi:type="xsd:string"></value>
        </item>
        <item>
          <key xsi:type="xsd:string">property2</key>
          <value xsi:type="xsd:string"></value>
        </item>
        <item>
          <key xsi:type="xsd:string">property3</key>
          <value xsi:type="xsd:string">z</value>
        </item>
      </args>
    </intf:webservice_controller>
  </SOAP-ENV:Body>
</SOAP-ENV:Envelope> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T20:00:07.427

尝试将此添加到您的构造函数中：

```
package
{
    [Bindable]
    public dynamic class WebServiceCriteria
    {
        public var property1:String;
        public var property2:String;

        function WebServiceCriteria()
        {
             prototype.property1 = null;
             prototype.property2 = null;
        }
    }
} 
```

...似乎只有`Object`s 属性是可枚举的

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T12:51:57.687

此行为记录在 Flex 3.0 手册中。有关详细信息，请参阅[动态类](http://livedocs.adobe.com/flex/3/html/help.html?content=03_Language_and_Syntax_10.html)。直接报价：

> [...]但是，以这种方式创建的方法无法访问 [example] 类的任何私有属性或方法。此外，即使是对 [example] 类的公共属性或方法的引用也必须使用 this 关键字或类名进行限定。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-23T20:47:42.043

我不相信您将能够将对象发送到网络服务。如果要发送对象，则需要使用远程对象。要使用 web 服务，您需要将您的对象转换为某种 xml 或 soap 请求。像

`var myCriteria:WebServiceCriteria = new WebServiceCriteria();`

 `myCriteria.property1 = "x";

myCriteria.property2 = "y";` 

`operation.send(<request> <property1>{myCriteria.property1}</property1> <property2>{myCriteria.property2}</property2> </request>);`

[http://livedocs.adobe.com/flex/3/html/help.html?content=data_intro_2.html](http://livedocs.adobe.com/flex/3/html/help.html?content=data_intro_2.html)

# gis - 寻找好的地理空间图书馆

> ID：567219
> 
> 赞同：4
> 
> 时间：2009-02-19T21:21:45.033
> 
> 标签：gis, geospatial

什么是地理空间功能的好库？我的意思是像

*   地球上两点之间的距离
*   从特定点到给定半径的圆的坐标
*   等等

如果有不同数据库表示地理位置的各种方式的接口，则会有好处。

我是一个地理新手（如果这个问题不明显），所以欢迎指向其他地理定位/地理空间资源的指针。

首选 C++ 和 Python，但欢迎所有指针。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T22:15:32.943

我很喜欢使用[geopy](http://pypi.python.org/pypi/geopy)。这是一个简单的库，可以在许多投影中找到大圆距离。Geopy 还为多个地理编码器（如 Google Maps 和 Microsoft Earth）提供单一界面，为您提供街道地址的坐标。

您可能对PyPi中的[Topic :: Scientific/Engineering :: GIS部分感兴趣。](http://pypi.python.org/pypi?:action=browse&show=all&c=391)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T22:01:10.527

O'Reilly 网站上[一篇有用的文章](http://www.oreillynet.com/pub/a/network/2005/06/10/osgeospatial.html)中的一些函数选项。文章中还有其他选项。

1.  [GEOS](http://trac.osgeo.org/geos/)开源 C++ 几何/拓扑引擎。可能适合你？

2.  [PostGIS](http://postgis.refractions.net/) - 一个 PostgreSQL 数据库，也可以存储几何（空间）数据类型。这在 SQL 数据库环境中提供了类似 GIS 的功能，因此您可以通过 SQL 进行操作。

我不确定不同数据库的接口，但文章提到了许多在不同格式之间转换地理空间数据的库。您可能还对[OGC](http://www.opengeospatial.org/)标准感兴趣。如果您的所有目标数据库都支持[WFS](http://www.opengeospatial.org/standards/wfs)，您应该能够使用完全相同的代码访问它们。编辑：越来越多的 GIS 包支持 WFS，但我认为纯数据库不支持。

编辑：您还可以查看[OSGeo](http://www.osgeo.org/)，它是一项支持开源地理空间内容的合作项目。[FDO](http://fdo.osgeo.org/)可能会为不同的数据库做接口。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T21:31:09.927

如果您使用带或不带导轨的 ruby​​，我会推荐 GeoKit gem：[http ://geokit.rubyforge.org/](http://geokit.rubyforge.org/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-25T23:17:36.147

检查[GDAL/OGR](http://www.gdal.org)这是两个合二为一的库 - [GDAL](http://www.gdal.org)用于栅格数据，[OGR](http://www.gdal.org/ogr/)用于矢量数据。OGR 部分提供 API 来操作几何图形 - 它使用[GEOS](http://trac.osgeo.org/geos/)库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T13:55:40.730

我在看类似的东西，我发现了[Geolocator](http://pypi.python.org/pypi/geolocator/0.1.1 "地理定位器") Library，它提供了一些距离计算功能。

# python - Python中的简单素数生成器

> ID：567222
> 
> 赞同：55
> 
> 时间：2009-02-19T21:22:24.703
> 
> 标签：python, primes

有人可以告诉我这段代码我做错了什么吗？无论如何，它只是打印“计数”。我只想要一个非常简单的素数生成器（没什么花哨的）。

```
import math

def main():
    count = 3
    one = 1
    while one == 1:
        for x in range(2, int(math.sqrt(count) + 1)):
            if count % x == 0: 
                continue
            if count % x != 0:
                print count

        count += 1 
```

* * *

## 回答 #1

> 赞同：189
> 
> 时间：2009-02-20T07:42:03.393

有一些问题：

*   当它没有除以 x 时，为什么要打印出计数？这并不意味着它是素数，它只意味着这个特定的 x 不会除它
*   `continue`移动到下一个循环迭代 - 但你真的想用`break`

这是您的代码，有一些修复，它只打印素数：

```
import math

def main():
    count = 3

    while True:
        isprime = True

        for x in range(2, int(math.sqrt(count) + 1)):
            if count % x == 0: 
                isprime = False
                break

        if isprime:
            print count

        count += 1 
```

正如其他人所建议的那样，对于更有效的素数生成，请参阅 Eratosthenes 筛。这是一个很好的优化实现，有很多评论：

```
# Sieve of Eratosthenes
# Code by David Eppstein, UC Irvine, 28 Feb 2002
# http://code.activestate.com/recipes/117119/

def gen_primes():
    """ Generate an infinite sequence of prime numbers.
    """
    # Maps composites to primes witnessing their compositeness.
    # This is memory efficient, as the sieve is not "run forward"
    # indefinitely, but only as long as required by the current
    # number being tested.
    #
    D = {}

    # The running integer that's checked for primeness
    q = 2

    while True:
        if q not in D:
            # q is a new prime.
            # Yield it and mark its first multiple that isn't
            # already marked in previous iterations
            # 
            yield q
            D[q * q] = [q]
        else:
            # q is composite. D[q] is the list of primes that
            # divide it. Since we've reached q, we no longer
            # need it in the map, but we'll mark the next 
            # multiples of its witnesses to prepare for larger
            # numbers
            # 
            for p in D[q]:
                D.setdefault(p + q, []).append(p)
            del D[q]

        q += 1 
```

请注意，它返回一个生成器。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2015-11-27T07:09:37.373

re 很强大：

```
import re

def isprime(n):
    return re.compile(r'^1?$|^(11+)\1+$').match('1' * n) is None

print [x for x in range(100) if isprime(x)]

###########Output#############
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97] 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-20T08:13:32.957

```
def is_prime(num):
    """Returns True if the number is prime
    else False."""
    if num == 0 or num == 1:
        return False
    for x in range(2, num):
        if num % x == 0:
            return False
    else:
        return True

>> filter(is_prime, range(1, 20))
  [2, 3, 5, 7, 11, 13, 17, 19] 
```

我们将在一个列表中获得最多 20 的所有素数。我本可以使用埃拉托色尼筛，但你说你想要一些非常简单的东西。;)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-04-12T18:28:58.093

```
print [x for x in range(2,100) if not [t for t in range(2,x) if not x%t]] 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-10-21T15:19:17.340

```
def primes(n): # simple sieve of multiples 
   odds = range(3, n+1, 2)
   sieve = set(sum([list(range(q*q, n+1, q+q)) for q in odds], []))
   return [2] + [p for p in odds if p not in sieve]

>>> primes(50)
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47] 
```

测试一个数是否为素数：

```
>>> 541 in primes(541)
True
>>> 543 in primes(543)
False 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-07-04T03:38:20.727

这是一个*简单*的（Python 2.6.2）解决方案......它符合 OP 的原始请求（现在已有六个月大）；并且应该是任何“编程101”课程中完全可以接受的解决方案......因此这篇文章。

```
import math

def isPrime(n):
    for i in range(2, int(math.sqrt(n)+1)):
        if n % i == 0: 
            return False;
    return n>1;

print 2
for n in range(3, 50):
    if isPrime(n):
        print n 
```

这种简单的“蛮力”方法对于现代 PC 上大约 16,000 的数字“足够快”（在我的 2GHz 机器上大约需要 8 秒）。

显然，这可以更有效地完成，通过不重新计算每个偶数的素数，或每个单个数字的 3、5、7 等的每个倍数......参见[Eratosthenes 的筛子](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)（参见上面 eliben 的实现），如果你感觉特别勇敢和/或疯狂，甚至[是阿特金筛子。](http://en.wikipedia.org/wiki/Sieve_of_Atkin)

警告 Emptor：我是 python 菜鸟。请不要把我说的任何话当成福音。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-02-24T13:43:42.667

[SymPy](http://www.sympy.org/)是一个用于符号数学的 Python 库。它提供了几个函数来生成素数。

```
isprime(n)              # Test if n is a prime number (True) or not (False).

primerange(a, b)        # Generate a list of all prime numbers in the range [a, b).
randprime(a, b)         # Return a random prime number in the range [a, b).
primepi(n)              # Return the number of prime numbers less than or equal to n.

prime(nth)              # Return the nth prime, with the primes indexed as prime(1) = 2\. The nth prime is approximately n*log(n) and can never be larger than 2**n.
prevprime(n, ith=1)     # Return the largest prime smaller than n
nextprime(n)            # Return the ith prime greater than n

sieve.primerange(a, b)  # Generate all prime numbers in the range [a, b), implemented as a dynamically growing sieve of Eratosthenes. 
```

这里有些例子。

```
>>> import sympy
>>> 
>>> sympy.isprime(5)
True
>>> list(sympy.primerange(0, 100))
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]
>>> sympy.randprime(0, 100)
83
>>> sympy.randprime(0, 100)
41
>>> sympy.prime(3)
5
>>> sympy.prevprime(50)
47
>>> sympy.nextprime(50)
53
>>> list(sympy.sieve.primerange(0, 100))
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97] 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-07-20T06:59:06.203

这是 Eratosthenes 的 numpy 版本，具有良好的复杂性（低于对长度为 n 的数组进行排序）和矢量化。

```
import numpy as np 
def generate_primes(n):
    is_prime = np.ones(n+1,dtype=bool)
    is_prime[0:2] = False
    for i in range(int(n**0.5)+1):
        if is_prime[i]:
            is_prime[i*2::i]=False
    return np.where(is_prime)[0] 
```

时间：

```
import time    
for i in range(2,10):
    timer =time.time()
    generate_primes(10**i)
    print('n = 10^',i,' time =', round(time.time()-timer,6))

>> n = 10^ 2  time = 5.6e-05
>> n = 10^ 3  time = 6.4e-05
>> n = 10^ 4  time = 0.000114
>> n = 10^ 5  time = 0.000593
>> n = 10^ 6  time = 0.00467
>> n = 10^ 7  time = 0.177758
>> n = 10^ 8  time = 1.701312
>> n = 10^ 9  time = 19.322478 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-04-25T06:36:08.227

python 3（生成素数）

```
from math import sqrt

i = 2
while True:
    for x in range(2, int(sqrt(i) + 1)):
        if i%x==0:
            break
    else:
        print(i)
    i += 1 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-18T20:57:56.670

这是我所拥有的：

```
def is_prime(num):
    if num < 2:         return False
    elif num < 4:       return True
    elif not num % 2:   return False
    elif num < 9:       return True
    elif not num % 3:   return False
    else:
        for n in range(5, int(math.sqrt(num) + 1), 6):
            if not num % n:
                return False
            elif not num % (n + 2):
                return False

    return True 
```

对于大数来说它非常快，因为它只检查已经是素数的数的除数。

现在，如果要生成素数列表，可以执行以下操作：

```
# primes up to 'max'
def primes_max(max):
    yield 2
    for n in range(3, max, 2):
        if is_prime(n):
            yield n

# the first 'count' primes
def primes_count(count):
    counter = 0
    num = 3

    yield 2

    while counter < count:
        if is_prime(num):
            yield num
            counter += 1
        num += 2 
```

为了提高效率，可能需要在此处使用生成器。

仅供参考，而不是说：

```
one = 1
while one == 1:
    # do stuff 
```

你可以简单地说：

```
while 1:
    #do stuff 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-04-27T10:01:25.147

在我看来，最好采用函数式方法，

所以我首先创建一个函数来确定这个数字是否是素数，然后根据需要在循环或其他地方使用它。

```
def isprime(n):
      for x in range(2,n):
        if n%x == 0:
            return False
    return True 
```

然后运行一个简单的列表推导或生成器表达式来获取您的素数列表，

```
[x for x in range(1,100) if isprime(x)] 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-06-03T14:26:17.933

另一个简单的例子，只考虑奇数的简单优化。一切都是用惰性流（python 生成器）完成的。

用法：prime = list(create_prime_iterator(1, 30))

```
import math
import itertools

def create_prime_iterator(rfrom, rto):
    """Create iterator of prime numbers in range [rfrom, rto]"""
    prefix = [2] if rfrom < 3 and rto > 1 else [] # include 2 if it is in range separately as it is a "weird" case of even prime
    odd_rfrom = 3 if rfrom < 3 else make_odd(rfrom) # make rfrom an odd number so that  we can skip all even nubers when searching for primes, also skip 1 as a non prime odd number.
    odd_numbers = (num for num in xrange(odd_rfrom, rto + 1, 2))
    prime_generator = (num for num in odd_numbers if not has_odd_divisor(num))
    return itertools.chain(prefix, prime_generator)

def has_odd_divisor(num):
    """Test whether number is evenly divisable by odd divisor."""
    maxDivisor = int(math.sqrt(num))
    for divisor in xrange(3, maxDivisor + 1, 2):
        if num % divisor == 0:
            return True
    return False

def make_odd(number):
    """Make number odd by adding one to it if it was even, otherwise return it unchanged"""
    return number | 1 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-02-29T17:55:50.193

这是我的实现。我确信有一种更有效的方法，但似乎有效。基本标志使用。

```
def genPrime():
    num = 1
    prime = False
    while True:
        # Loop through all numbers up to num
        for i in range(2, num+1):
            # Check if num has remainder after the modulo of any previous numbers
            if num % i == 0:
                prime = False
                # Num is only prime if no remainder and i is num
                if i == num:
                    prime = True
                break

        if prime:
            yield num
            num += 1
        else:
            num += 1

prime = genPrime()
for _ in range(100):
    print(next(prime)) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-05-29T05:02:23.340

刚刚研究了这个话题，在线程中查找示例并尝试制作我的版本：

```
from collections import defaultdict
# from pprint import pprint

import re

def gen_primes(limit=None):
    """Sieve of Eratosthenes"""
    not_prime = defaultdict(list)
    num = 2
    while limit is None or num <= limit:
        if num in not_prime:
            for prime in not_prime[num]:
                not_prime[prime + num].append(prime)
            del not_prime[num]
        else:  # Prime number
            yield num
            not_prime[num * num] = [num]
        # It's amazing to debug it this way:
        # pprint([num, dict(not_prime)], width=1)
        # input()
        num += 1

def is_prime(num):
    """Check if number is prime based on Sieve of Eratosthenes"""
    return num > 1 and list(gen_primes(limit=num)).pop() == num

def oneliner_is_prime(num):
    """Simple check if number is prime"""
    return num > 1 and not any([num % x == 0 for x in range(2, num)])

def regex_is_prime(num):
    return re.compile(r'^1?$|^(11+)\1+$').match('1' * num) is None

def simple_is_prime(num):
    """Simple check if number is prime
    More efficient than oneliner_is_prime as it breaks the loop
    """
    for x in range(2, num):
        if num % x == 0:
            return False
    return num > 1

def simple_gen_primes(limit=None):
    """Prime number generator based on simple gen"""
    num = 2
    while limit is None or num <= limit:
        if simple_is_prime(num):
            yield num
        num += 1

if __name__ == "__main__":
    less1000primes = list(gen_primes(limit=1000))
    assert less1000primes == list(simple_gen_primes(limit=1000))
    for num in range(1000):
        assert (
            (num in less1000primes)
            == is_prime(num)
            == oneliner_is_prime(num)
            == regex_is_prime(num)
            == simple_is_prime(num)
        )
    print("Primes less than 1000:")
    print(less1000primes)

    from timeit import timeit

    print("\nTimeit:")
    print(
        "gen_primes:",
        timeit(
            "list(gen_primes(limit=1000))",
            setup="from __main__ import gen_primes",
            number=1000,
        ),
    )
    print(
        "simple_gen_primes:",
        timeit(
            "list(simple_gen_primes(limit=1000))",
            setup="from __main__ import simple_gen_primes",
            number=1000,
        ),
    )
    print(
        "is_prime:",
        timeit(
            "[is_prime(num) for num in range(2, 1000)]",
            setup="from __main__ import is_prime",
            number=100,
        ),
    )
    print(
        "oneliner_is_prime:",
        timeit(
            "[oneliner_is_prime(num) for num in range(2, 1000)]",
            setup="from __main__ import oneliner_is_prime",
            number=100,
        ),
    )
    print(
        "regex_is_prime:",
        timeit(
            "[regex_is_prime(num) for num in range(2, 1000)]",
            setup="from __main__ import regex_is_prime",
            number=100,
        ),
    )
    print(
        "simple_is_prime:",
        timeit(
            "[simple_is_prime(num) for num in range(2, 1000)]",
            setup="from __main__ import simple_is_prime",
            number=100,
        ),
    ) 
```

运行此代码的结果显示了有趣的结果：

```
$ python prime_time.py
Primes less than 1000:
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997]

Timeit:
gen_primes: 0.6738066330144648
simple_gen_primes: 4.738092333020177
is_prime: 31.83770858097705
oneliner_is_prime: 3.3708438930043485
regex_is_prime: 8.692703998007346
simple_is_prime: 0.4686249239894096 
```

所以我可以看到我们在这里对不同的问题有正确的答案；素数生成器`gen_primes`看起来是正确的答案；但对于素数检查，该`simple_is_prime`功能更适合。

这行得通，但我总是乐于接受更好的方法来发挥`is_prime`作用。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-19T21:31:30.567

这似乎是家庭作业，所以我会给出提示而不是详细解释。如果我假设错了，请纠正我。

当你看到一个偶数除数时，你做的很好。

但是，只要您看到*一个*不分成的数字，您就会立即打印“计数”。例如，2 不能均匀地分成 9。但这并不能使 9 成为素数。您可能希望继续，直到您确定范围内*没有*数字匹配。

（正如其他人回答的那样，筛子是一种更有效的方法......只是试图帮助你理解为什么这个特定的代码没有做你想做的事）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-19T21:35:36.313

您需要确保所有可能的除数不会均分您正在检查的数字。在这种情况下，您将随时打印您正在检查的数字，只要有一个可能的除数没有均匀地划分数字。

此外，您不想使用 continue 语句，因为当您已经发现数字不是素数时， continue 只会导致它检查下一个可能的除数。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-19T00:37:50.620

您可以使用列表推导以相当优雅的方式创建素数列表。取自[这里：](http://www.secnetix.de/~olli/Python/list_comprehensions.hawk)

```
>>> noprimes = [j for i in range(2, 8) for j in range(i*2, 50, i)]
>>> primes = [x for x in range(2, 50) if x not in noprimes]
>>> print primes
>>> [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-02-12T07:04:00.813

如果你想直接计算素数怎么办：

```
def oprime(n):
counter = 0
b = 1
if n == 1:
    print 2
while counter < n-1:
    b = b + 2
    for a in range(2,b):
        if b % a == 0:
            break
    else:
        counter = counter + 1
        if counter == n-1:
            print b 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-08-03T01:04:57.377

类似于 user107745，但使用 'all' 而不是双重否定（更具可读性，但我认为性能相同）：

```
import math
[x for x in xrange(2,10000) if all(x%t for t in xrange(2,int(math.sqrt(x))+1))] 
```

基本上它迭代 (2, 100) 范围内的 x 并且只选择那些没有 mod == 0 的范围内的所有 t (2,x)

另一种方法可能只是在我们进行时填充素数：

```
primes = set()
def isPrime(x):
  if x in primes:
    return x
  for i in primes:
    if not x % i:
      return None
  else:
    primes.add(x)
    return x

filter(isPrime, range(2,10000)) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-10-22T21:43:20.927

```
import time

maxnum=input("You want the prime number of 1 through....")

n=2
prime=[]
start=time.time()

while n<=maxnum:

    d=2.0
    pr=True
    cntr=0

    while d<n**.5:

        if n%d==0:
            pr=False
        else:
            break
        d=d+1

    if cntr==0:

        prime.append(n)
        #print n

    n=n+1

print "Total time:",time.time()-start 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-02-15T11:18:11.207

对我来说，下面的解决方案看起来简单易懂。

```
import math

def is_prime(num):

    if num < 2:
        return False

    for i in range(2, int(math.sqrt(num) + 1)):
        if num % i == 0:
            return False

return True 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-03-12T01:03:10.173

如果你想找到一个范围内的所有素数，你可以这样做：

```
def is_prime(num):
"""Returns True if the number is prime
else False."""
if num == 0 or num == 1:
    return False
for x in range(2, num):
    if num % x == 0:
        return False
else:
    return True
num = 0
itr = 0
tot = ''
while itr <= 100:
    itr = itr + 1
    num = num + 1
    if is_prime(num) == True:
        print(num)
        tot = tot + ' ' + str(num)
print(tot) 
```

只需添加`while its <=`您的号码即可。
输出：
`2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97 101`

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-06-28T18:21:05.790

使用生成器：

```
def primes(num):
    if 2 <= num:
        yield 2
    for i in range(3, num + 1, 2):
        if all(i % x != 0 for x in range(3, int(math.sqrt(i) + 1))):
            yield i 
```

用法：

```
for i in primes(10):
    print(i) 
```

> 2、3、5、7

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2009-02-19T21:30:06.857

*   continue 语句看起来是错误的。

*   你想从 2 开始，因为 2 是第一个素数。

*   你可以写“while True:”来获得一个无限循环。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2011-04-04T20:00:25.377

```
def check_prime(x):
    if (x < 2): 
       return 0
    elif (x == 2): 
       return 1
    t = range(x)
    for i in t[2:]:
       if (x % i == 0):
            return 0
    return 1 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2013-03-23T13:52:26.823

```
def genPrimes():
    primes = []   # primes generated so far
    last = 1      # last number tried
    while True:
        last += 1
        for p in primes:
            if last % p == 0:
                break
        else:
            primes.append(last)
            yield last 
```

# c# - 断点在视觉工作室中表现异常

> ID：567228
> 
> 赞同：3
> 
> 时间：2009-02-19T21:23:19.117
> 
> 标签：c#, visual-studio, debugging

我在使用 .net 3.1 的 Visual Studio 版本 9.0.30729.1 的调试器上遇到了两个问题

问题一 - 我遇到了断点，F10、F11 不会将我移动到下一条指令。如果我反复按 F10，我最终会跳到下一条指令。我可以在代码的更下方放置另一个断点并执行 F5 以到达下一个断点 - 但我错过了单步执行的能力。

问题二——我打了我的第一个断点，执行 F5 或 F10，程序继续运行而不会停止。

这些问题似乎是半随机发生的。有时，如果我关闭 Visual Studio 并重新启动计算机，它们会自行清理——但并非总是如此。这在我的单元测试中不像在 GUI 应用程序中那样经常发生。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:26:43.540

程序中有很多线程吗？可能是线程 1 中断，你一步，线程 2 在线程 1 刚刚中断的同一点中断

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T21:25:29.580

确保启动调试器后源代码没有更改...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:31:41.423

只是为了咯咯笑，试着关闭我的代码。取消选中（工具 -> 选项 -> 调试器 -> 常规）下的“只是我的代码...”选项

JMC 可能会在您不一定期望的情况下导致奇怪的行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T21:37:05.997

确保您的 .pdb 文件是最新的，否则您正在调试的源和正在运行的源可能不匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T21:43:15.953

尝试通过删除（重命名）Visual Studio 生成的所有文件（*.ncb、*.suo、obj/、bin/ 等）来清理解决方案目录。

# objective-c - 是否可以在 Cocoa 中绑定 null 占位符？

> ID：567233
> 
> 赞同：1
> 
> 时间：2009-02-19T21:25:26.710
> 
> 标签：objective-c, cocoa, cocoa-bindings

`nil`我有一个表格，其中某些单元格将为零，直到用户填写它们，但我希望我可以根据其他部分更改空占位符（即当该单元格的特定值为 时它显示的值）用户已经填写或配置的应用程序。有点像自动完成，但不完全是。

是否可以绑定空占位符值，或者我必须手动模拟这种行为？

*编辑：*
为了澄清，我正在寻找一种解决方案，为单个单元格提供不同的占位符值，而不是单个占位符值应用于整个表格或整个表格列。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T00:09:19.947

占位符值在创建绑定时[作为选项字典的一部分传递。](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/CocoaBindingsRef/Concepts/BindingsOptions.html#//apple_ref/doc/uid/20002304-203776)由于字典中的值不是可以绑定的，因此我认为没有任何“自动”方法可以做到这一点。

# c# - 集成到现有网站的最佳 c# wiki 是什么？

> ID：567236
> 
> 赞同：7
> 
> 时间：2009-02-19T21:25:33.153
> 
> 标签：c#, .net, asp.net, wiki, wiki-engine

我们需要将 wiki 添加到已经存在的网站，但是我们只希望登录用户能够编辑 wiki，并且我们更愿意使用我们自己的身份验证方法。

有没有人有类似的经验或任何关于工作的好 wiki 引擎的建议？

更新：谢谢大家，普遍的共识是ScrewTurn 是最好的Wiki 之一，但是有没有人有将它整合到您自己的网站的经验？

想象一下，您已经完成了基本布局的网站，并且您已经拥有了身份验证系统。

您如何将引擎置于其中，以便您的布局和菜单围绕 wiki 并使用您自己的身份验证系统？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T21:30:01.613

我最近对 ​​ASP.NET wiki 进行了一些评估，我认为最好的一个是[ScrewTurn Wiki](https://stw.codeplex.com/)。

如果您想查看替代方案，可以尝试在[WikiMatrix上进行比较。](http://www.wikimatrix.org)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T21:36:00.900

[如果 Chuck Norris 需要 Wiki， Screwturn Wiki](http://www.screwturn.eu/Wiki.ashx)是他会使用的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T21:32:01.953

我对 Sharepoint wiki 的出色程度感到惊喜（使用 Windows Sharepoint Services - WSS 3.0），但我不知道这个选项是否适合您。不过值得一看... Sharepoint 当然还支持自定义身份验证、强授权框架等。

更新：澄清一下，虽然我不认为 Sharepoint Wiki 在 wiki 方面是最好的，但我的意图是它很好地集成到了 sharepoint 模型中——而且它绝对“足够好”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-20T00:21:42.193

好吧，Screwturn Wiki 曾经是最好的——它变得过于笨拙和复杂。它已经失去了作为简单 WIKI 的地位。在微软似乎资助它之后，我很遗憾升级。我目前正在寻找用其他东西代替它 - 它已成为野兽。

# python - 早期需要学习的 Python 的重要语言特性（习语）有哪些

> ID：567251
> 
> 赞同：19
> 
> 时间：2009-02-19T21:29:50.397
> 
> 标签：python, idioms

我很想知道 StackOverflow 社区认为 Python 的重要语言特性（习语）是什么。将程序员定义为 Pythonic 的功能。

Python (pythonic) 成语 - “代码表达式”是 Python 语言的自然或特征。

**另外，所有 Python 程序员都应该尽早学习哪些习语？**

提前致谢

有关的：

*   [像 Pythonista 一样编写代码：惯用的 Python](http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html)
*   [Python：我错过了什么吗？](https://stackoverflow.com/questions/566865/python-am-i-missing-something)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-19T21:48:42.647

Python是一种可以描述为的语言：

> “规则你可以用一大袋钩子放在手掌中”。

python 中的几乎所有内容都遵循相同的简单标准。一切都是可访问的、可更改的和可调整的。语言级别的元素很少。

以 len(data) 内置函数为例。 `len(data)`通过简单地检查一个`data.__len__()`方法，然后调用它并返回值来工作。这样，`len()`可以在任何实现`__len__()`方法的对象上工作。

* * *

首先了解类型和基本语法：

1.  动态强类型语言
2.  bool、int、float、string、list、tuple、dict、set
3.  语句，缩进，“一切都是对象”
4.  基本功能定义

然后继续学习 python 的工作原理：

1.  导入和模块（非常简单）
2.  蟒蛇路径（sys.path）
3.  `dir()`功能_
4.  `__builtins__`

一旦您了解了如何将各个部分组合在一起，请返回并介绍一些更高级的语言功能：

1.  迭代器
2.  覆盖之类`__len__` 的（有很多这样的）
3.  列表推导和生成器
4.  类和对象（同样，一旦你知道了一些规则，真的很简单）
5.  python继承规则

一旦你对这些项目有一个舒适的水平（关注是什么让它们像 Python），看看更具体的项目：

1.  python中的线程（注意全局解释器锁）
2.  上下文管理器
3.  数据库访问
4.  文件 IO
5.  插座
6.  ETC...

* * *

永远不要忘记**Python 的禅宗**（蒂姆·彼得斯）

```
Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.
Flat is better than nested.
Sparse is better than dense.
Readability counts.
Special cases aren't special enough to break the rules.
Although practicality beats purity.
Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
There should be one-- and preferably only one --obvious way to do it.
Although that way may not be obvious at first unless you're Dutch.
Now is better than never.
Although never is often better than *right* now.
If the implementation is hard to explain, it's a bad idea.
If the implementation is easy to explain, it may be a good idea.
Namespaces are one honking great idea -- let's do more of those! 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T21:36:47.527

该页面涵盖了所有主要的 Python 成语： http: [//python.net/~goodger/projects/pycon/2007/idiomatic/handout.html](http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T22:33:13.587

Python 中的一个重要习惯用法是 docstrings。

每个对象都有一个 __doc__ 属性，可用于获取该对象的帮助。您可以像这样在模块、类、方法和函数上设置 __doc__ 属性：

```
# this is m.py
""" module docstring """

class c:
    """class docstring"""
    def m(self):
        """method docstring"""
        pass

def f(a):
    """function f docstring"""
    return 
```

现在，当您键入`help(m)`等`help(m.f)`时，它将打印文档字符串作为帮助消息。

因为它只是普通对象自省的一部分，所以它可以被 epydoc 等文档生成系统使用，或者被 unittest 用于测试目的。

它也可以用于更非传统（即非惯用）的用途，例如[Dparser](http://www.ibm.com/developerworks/linux/library/l-cpdpars.html?ca=dgr-lnxw82DParser)中的语法。

对我来说更有趣的是，即使**doc**是大多数对象的只读属性，您也可以像这样在任何地方使用它们：

```
x = 5
""" pseudo docstring for x """ 
```

[并且像epydoc](http://epydoc.sourceforge.net/manual-docstring.html)这样的文档工具可以提取它们并正确格式化它们（与保留在代码格式中的普通注释相反。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-19T22:27:08.267

装饰者得到我的投票。你还能在哪里写类似的东西：

```
def trace(num_args=0):
  def wrapper(func):
    def new_f(*a,**k):
      print_args = ''
      if num_args > 0:
        print_args = str.join(',', [str(x) for x in a[0:num_args]])
      print('entering %s(%s)' %(f.__name__,print_args))
      rc = f(*a,**k)
      if rc is not None:
        print('exiting %s(%s)=%s' %(f.__name__,str(rc)))
      else:
        print('exiting %s(%s)' %(f.__name__))
      return rc
    return new_f
  return wrapper

@trace(1)
def factorial(n):
  if n < 2:
    return 1
  return n * factorial(n-1)
factorial(5) 
```

并获得如下输出：

```
entering factorial(5)
entering factorial(4)
entering factorial(3)
entering factorial(2)
entering factorial(1)
entering factorial(0)
exiting factorial(0)=1
exiting factorial(1)=1
exiting factorial(2)=2
exiting factorial(3)=6
exiting factorial(4)=24
exiting factorial(5)=120 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T21:32:59.550

与列表使用相关的所有内容。
理解、生成器等

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-06T00:50:50.520

就个人而言，我真的很喜欢 Python 语法通过使用*indentation*来定义代码块，而不是通过单词“BEGIN”和“END”（如 Microsoft 的 Basic 和 Visual Basic - 我不喜欢这些）或使用 left- 和 right-大括号（如 C、C++、Java、Perl - 我喜欢这些）。

这真的让我感到惊讶，因为尽管缩进对我来说一直很重要，但我并没有对此产生太大的“噪音”——我忍受着它，它被认为是一种能够阅读其他人的技能，“意大利面条“ 代码。此外，我从未听过其他程序员建议将缩进作为语言的一部分。直到 Python！我只希望我首先意识到这个想法。

对我来说，就好像 Python 的语法迫使你编写好的、可读的代码。

好吧，我会离开我的肥皂盒。;-)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-19T21:44:02.237

从更高级的角度来看，了解 Python 如何在内部使用字典。类、函数、模块、引用都只是字典上的属性。一旦理解了这一点，就很容易理解如何打补丁和使用强大的 __gettattr__、__setattr__ 和 __call__ 方法。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-20T00:13:34.983

这是一个可以提供帮助的。有什么区别：

```
[ foo(x) for x in range(0, 5) ][0] 
```

和

```
( foo(x) for x in range(0, 5) ).next() 
```

答案：在第二个例子中，foo 只被调用一次。如果 foo 有副作用，或者用于构造列表的可迭代对象很大，这可能很重要。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-19T21:38:49.643

有两件事让我印象深刻，尤其是 Python 风格，那就是动态类型和 Python 中使用的各种类型的列表，尤其是元组。

Python 对列表的痴迷可以说是 LISP-y，但它有自己独特的风味。像这样的一行：

```
return HandEvaluator.StraightFlush, (PokerCard.longFaces[index + 4], 
  PokerCard.longSuits[flushSuit]), [] 
```

甚至

```
return False, False, False 
```

只是看起来像 Python，没有别的。（从技术上讲，你也会在 Lua 中看到后者，但 Lua 总体上是相当 Pythonic 的。）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-20T03:27:30.307

使用字符串替换：

```
name = "Joe"
age = 12
print "My name is %s, I am %s" % (name, age) 
```

当我不使用 python 编程时，我最怀念的是那种简单的使用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-19T23:57:24.977

另一件你不能足够早开始的事情可能是测试。在这里，特别是 doctests 是通过同时解释代码来测试代码的好方法。

doctests 是一个简单的文本文件，包含一个交互式解释器会话加上这样的文本：

```
Let's instantiate our class::

>>> a=Something(text="yes")
>>> a.text
yes

Now call this method and check the results::

>>> a.canify()
>>> a.text
yes, I can 
```

如果 egatext 返回不同的东西，测试将失败。

doctests 可以在 docstrings 或独立文本文件中，并使用[doctests 模块](http://docs.python.org/library/doctest.html)执行。当然，更知名的单元测试也是可用的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-06-05T17:27:57.417

我认为在线教程和书籍只谈论做事，而不是以最好的方式做事。除了 python 语法，我认为在某些情况下速度很重要。

Python 提供了一种对函数进行基准测试的方法，实际上是两个！！

一种方法是使用`profile`模块，如下所示：

```
import profile

def foo(x, y, z):
    return x**y % z # Just an example.

profile.run('foo(5, 6, 3)') 
```

另一种方法是使用`timeit`模块，如下所示：

```
import timeit

def foo(x, y, z):
    return x**y % z # Can also be 'pow(x, y, z)' which is way faster.

timeit.timeit('foo(5, 6, 3)', 'from __main__ import *', number = 100) 
# timeit.timeit(testcode, setupcode, number = number_of_iterations) 
```

# coldfusion - ColdFusion cfc 方法可以确定自己的名称吗？

> ID：567254
> 
> 赞同：13
> 
> 时间：2009-02-19T21:30:07.107
> 
> 标签：coldfusion, cfc

我正在创建一个 API，并在每个方法中调用一个日志记录方法以进行审计和故障排除。就像是：

```
<cffunction name="isUsernameAvailable">
    <cfset logAccess(request.userid,"isUsernameAvailable")>
    ......
</cffunction> 
```

我想避免手动重复方法名称。有没有办法以编程方式确定它？

我查看了 GetMetaData() 但它只返回有关*组件*的信息（包括所有方法），但没有返回有关当前正在调用的方法的信息。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T01:37:55.827

所以现在有3种方式。

如果您使用的是 ColdFusion 9.0 或更高版本，现在有一个名为 GetFunctionCalledName() 的函数。它会返回你正在寻找的东西。 [http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WS7cc222be8a31a47d-6e8b7083122cebfc8f2-8000.html](http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WS7cc222be8a31a47d-6e8b7083122cebfc8f2-8000.html)

或者

使用 ColdSpring 和面向方面的编程 ( [http://www.coldspringframework.org/coldspring/examples/quickstart/index.cfm?page=aop](http://www.coldspringframework.org/coldspring/examples/quickstart/index.cfm?page=aop) ) 为您处理这个问题。

或者

使用 cfthrow 生成包含信息的堆栈跟踪：

```
<cffunction name="determineFunction" output="FALSE" access="public"  returntype="string" hint="" >
<cfset var functionName ="" />
<cfset var i = 0 />
<cfset var stackTraceArray = "" />
<cftry>
<cfthrow />
<cfcatch type="any">
    <cfset stacktraceArray = ListToArray(Replace(cfcatch.stacktrace, "at ", " | ", "All"), "|") />

    <!---Rip the right rows out of the stacktrace --->
    <cfloop index ="i" to="1" from="#ArrayLen(stackTraceArray)#" step="-1">
        <cfif not findNoCase("runFunction", stackTraceArray[i]) or FindNoCase("determineFunction", stackTraceArray[i])>
            <cfset arrayDeleteAt(stackTraceArray, i) />
        </cfif>
    </cfloop>

    <!---Whittle down the string to the func name --->
    <cfset functionName =GetToken(stacktraceArray[1], 1, ".") />
    <cfset functionName =GetToken(functionName, 2, "$")/>
    <cfset functionName =ReplaceNoCase(functionName, "func", "", "once")/>

    <cfreturn functionName />
</cfcatch>
</cftry></cffunction> 
```

我的建议是使用 getFunctionCalledName，或者如果不在 CF 9 ColdSpring 上，它可能会为您购买一些其他东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T03:42:57.850

我同意 tpryan。ColdSpring 使这变得非常容易。但是，这是另一种选择。您可以解析 CFC 文件本身，而不是解析堆栈跟踪。

```
<cffunction name="foo" displayname="foo" hint="this is just a test function" access="public" returntype="string">
    <cfset var test = getFunctionName(getMetaData().path, getPageContext().getCurrentLineNo()) />
    <cfreturn test />
</cffunction>

<cffunction name="getFunctionName" hint="returns the function name based on the line number" access="public" returntype="string">
    <cfargument name="filepath" type="string" required="true" />
    <cfargument name="linenum" type="any" required="true" />
    <cfset var line = "" />
    <cfset var functionName = "" />
    <cfset var i = 1 />
    <!---- loop over CFC by line ---->
    <cfloop file="#ARGUMENTS.filepath#" index="line">
        <cfif findNoCase('cffunction', line, 1)>
            <cfset functionName = line />
        </cfif>
        <cfif i EQ ARGUMENTS.linenum><cfbreak /></cfif>
        <cfset i++ />
    </cfloop>
    <!---- parse function name ---->
    <cfset functionName = REMatchNoCase("(\bname=[""|'])+[a-z]*[""|']", functionName) />
    <cfset functionName = REMatchNoCase("[""']+[a-z]*[""']", functionName[1]) />
    <cfset functionName = ReReplaceNoCase(functionName[1], "[""']", "", "all") />
    <!---- return success ---->
    <cfreturn functionName />
</cffunction> 
```

以上是为 ColdFusion 8 编写的。CFLOOP 添加了对逐行循环文件的支持（并且不会将整个文件读入内存）。我做了一些比较堆栈跟踪方法和文件解析的测试。在直接从单个 CFM 模板调用的小型 CFC 上，两者的表现同样出色。显然，如果您有非常大的 CFC，则解析方法可能会慢一些。另一方面，如果您有大量堆栈跟踪（例如，如果您使用任何流行的框架），那么文件解析可能会更快。

**-= Viva ColdFusion =-**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T19:28:16.627

我想到了另一种可行的方法。

设置一个 OnMissingMethod 是这样的：

```
<cffunction name="onMissingMethod">
    <cfargument name="missingMethodName" type="string"> 
    <cfargument name="missingMethodNameArguments" type="struct">

    <cfset var tmpReturn = "">
    <cfset var functionToCallName = "Hidden" & Arguments.missingMethodName>
    <cfset arguments.missingMethodArguments.calledMethodName = Arguments.missingMethodName>
    <cfinvoke method="#functionToCallName#" argumentcollection="#Arguments.missingMethodArguments#" returnvariable="tmpReturn" />
    <cfreturn tmpReturn>
</cffunction> 
```

然后用前缀（在本例中为“隐藏”）命名每个常规方法，并将它们标记为私有。所以我最初的例子会变成：

```
<cffunction name="HiddenisUsernameAvailable" access="private">
    <cfset logAccess(request.userid,Arguments.calledMethodName)>
    ......
</cffunction> 
```

现在所有的调用都将被 onMissingMethod 拦截，它将方法名称添加到传递给真实方法的参数中。

我看到的缺点是内省不再正常工作，您必须使用命名参数来调用所有函数。如果您不使用命名参数，则参数将在 missingMethodNameArguments 结构中随机更改顺序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T00:24:34.723

那么你可以试试这个：

```
 <cffunction name="getFunctionName" returntype="any">
        <cfset meta =getMetaData(this)> 
        <cfreturn meta.functions[numberOfFunction].name>
    </cffunction> 
```

我尝试了各种方法，但这是不准确的，因为这些函数似乎是按字母倒序添加到函数数组中的。这似乎是有限的（并没有解决问题）。我想可以调用一些本机 Java 代码，但我需要研究一下。

[This](http://www.simonwhatley.co.uk/the-java-behind-a-coldfusion-array-and-structure)和[This](http://www.jamesnetherton.com/blog/2008/07/08/Reserved-ColdFusion-function-names/)看起来像是对相关内部函数的有趣阅读。

回复：关于冷泉的另一个答案。我发现这篇关于带有冷泉的函数元数据[的深入文章](http://cdscott.blogspot.com/2007/01/unlocking-power-of-cf-metadata.html)。

相关问题：[如何获取在 ColdFusion 中扩展我的组件的名称？](https://stackoverflow.com/questions/363770/how-to-get-the-name-of-the-component-thats-extending-mine-in-coldfusion)

# logging - 如何在 NetBeans 中跟踪包含的 Tomcat 服务器的 webapp 日志？

> ID：567255
> 
> 赞同：2
> 
> 时间：2009-02-19T21:30:22.910
> 
> 标签：logging, netbeans

我正在使用 NetBeans 中包含的 tomcat 服务器运行一个 webapp。NetBeans 在输出窗口中向我显示了 Tomcat 日志，但我还想查看我的 webapp 的日志。这可能吗？我可以配置 NetBeans 来执行此操作吗？到目前为止，我在服务器或项目设置中找不到任何选项...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T21:59:32.090

这取决于您的网络应用程序的日志配置，您是否自己制作了网络应用程序，它是 netbeans webprojects、maven 原型等之一吗？

# iis-7 - 我在哪里捕获和处理 IIS7 中超出的 maxAllowedContentLength？

> ID：567273
> 
> 赞同：14
> 
> 时间：2009-02-19T21:33:19.017
> 
> 标签：iis-7, web-config, http-status-code-404, httpapplication

我有一个 aspx 页面，允许用户上传文件，并且我想将最大文件上传大小限制为 10MB。IIS7、.NET 3.5。我在 web.config 文件中配置了以下内容：

```
<location path="foo.aspx">
    <system.web>
        <!-- maxRequestLength: kbytes, executionTimeout:seconds -->
        <httpRuntime maxRequestLength="10240" executionTimeout="120" />
        <authorization>
            <allow roles="customRole"/>
            <!-- Deny everyone else -->
            <deny users="*"/>
        </authorization>
    </system.web>
    <system.webServer>
        <security>
            <requestFiltering>
                <!-- maxAllowedContentLength: bytes -->
                <requestLimits maxAllowedContentLength="10240000"/>
            </requestFiltering>
        </security>
        <handlers accessPolicy="Read, Script">
            <add name="foo" path="foo.aspx" verb="POST"
               type="System.Web.UI.PageHandlerFactory"
               preCondition="integratedMode" />
        </handlers>       
    </system.webServer>
</location> 
```

我有一个自定义错误处理模块，它实现`IHttpModule`. 我发现当`maxRequestLength`超过时，`HttpApplication.Error`确实会提高。但是，当我玩 时`maxAllowedContentLength`，`HttpApplication.Error`不会引发事件，并且用户会被重定向到 404.13 页面。我已经附加了 Visual Studio，第一次机会异常打开，没有抛出任何异常。

我的第一个想法是在较早的事件中检查标题内容长度——是否有关于我在哪里执行此操作的建议/最佳实践？PostLogRequest？结束请求？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-20T21:31:54.880

在查看[了 IIS 7.0 的 ASP.NET 应用程序生命周期概述](http://msdn.microsoft.com/en-us/library/bb470252.aspx)并进行了我自己的实验之后，我假设请求验证是由 IIS 在引发任何事件之前在内部完成的。

看起来只有 LogRequest、PostLogRequest、EndRequest、PreSendRequestContent 和 PreSendRequestHeaders 在内部验证后引发此错误。

我决定`HttpApplication.EndRequest`在我的自定义错误处理程序中将事件处理程序附加到事件并检查 POST 上的 404.13 状态代码并在我需要处理时进行处理，在我的情况下是重定向到将检查的调用页面`Server.GetLastError()`并向最终用户显示友好的错误。

```
private void application_EndRequest(object sender, EventArgs e)
{
    HttpRequest request = HttpContext.Current.Request;
    HttpResponse response = HttpContext.Current.Response;

    if ((request.HttpMethod == "POST") &&
        (response.StatusCode == 404 && response.SubStatusCode == 13))
    {
        // Clear the response header but do not clear errors and
        // transfer back to requesting page to handle error
        response.ClearHeaders();
        HttpContext.Current.Server.Transfer(
            request.AppRelativeCurrentExecutionFilePath);
    }
} 
```

我欢迎对这种方法和替代方案提供反馈。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-15T05:48:28.220

最简单的方法是在页面本身的 OnError 方法中处理。

*我认为这仅适用于 .NET 4.0，因为 WebEventCode 属性在 .NET 4.0 中被记录为 NEW。*

```
protected override void OnError(EventArgs e)
{
    Exception err = Server.GetLastError();
    if (err is HttpException)
    {
        if ((err as HttpException).WebEventCode == 3004)
        {
            Context.Items["error"] = "File exceeded maximum allowed length.";
            Server.Transfer( Context.Request.Url.LocalPath );
            return;
        }
    }
    base.OnError(e);
}

protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);
    if (!IsPostBack)
    {
        string error = Context.Items["error"] as string;
        if (!string.IsNullOrEmpty( error ))
            showErrorMessage( error );
    }
} 
```

我所做的是：

*   使用 Server.GetLastError 获取最后一个错误
*   检查它是否是“超出最大请求长度”。错误（WebEventCode == 3004）。
*   向 Context.Items 集合添加了一个值，以将请求标记为错误
*   使用 Server.Transfer(Context.Request.Url.LocalPath) 将请求传输回页面本身
*   页面的 OnLoad 方法检查错误标志并显示一条消息（如果存在）

这确保了错误完全在请求的页面上处理，并且该页面能够报告错误。

另请注意，虽然浏览器最终会收到正确的响应，但浏览器可能会花时间上传整个请求，然后再处理服务器的响应并显示它。这种行为可能被定义为 HTTP 协议中服务器/浏览器交互的一部分，因此可能对此无能为力。

# windows - pthread 和 CreateThread 的死锁

> ID：567278
> 
> 赞同：4
> 
> 时间：2009-02-19T21:34:16.817
> 
> 标签：windows, multithreading, pthreads, deadlock

我在 Windows 应用程序中使用 pthreads。我注意到我的程序陷入僵局——快速检查表明发生了以下情况：

线程 1 产生线程 2。线程 2 产生线程 3。线程 2 等待来自线程 3 的互斥锁，该互斥锁未解锁。

所以，我去gdb调试，回溯第三个线程时得到以下信息：

```
Thread 3 (thread 3456.0x880):
#0  0x7c8106e9 in KERNEL32!CreateThread ()
   from /cygdrive/c/WINDOWS/system32/kernel32.dll
Cannot access memory at address 0x131 
```

它在 Windows CreateThread 函数中以某种方式卡住、死锁！显然，当它甚至无法开始执行代码时，它也无法解锁互斥锁。然而，尽管它显然被困在这里，但 pthread_create 返回零（成功）。

让这特别奇怪的是，Linux 上的同一个应用程序没有这样的问题。到底什么会导致线程在创建过程中挂起（！？）但成功返回，就好像它已正确创建一样？

编辑：响应代码请求，这里有一些代码（简化）：

线程的创建：

```
if ( pthread_create( &h->lookahead->thread_handle, NULL, (void *)lookahead_thread, (void *)h->thread[h->param.i_threads] ) )
{
    log( LOG_ERROR, "failed to create lookahead thread\n");
    return ERROR;
}
while ( !h_lookahead->b_thread_active )
    usleep(100);
return SUCCESS; 
```

请注意，它*一直等到 b_thread_active 被设置*，所以不知何故 b_thread_active 被设置了，所以被调用的线程必须做了一些事情......

...这是lookahead_thread函数：

```
void lookahead_thread( mainstruct *h )
{
    h->lookahead->b_thread_active = 1;
    while( !h->lookahead->b_exit_thread && h->lookahead->b_thread_active )
    {
        if ( synch_frame_list_get_size( &h->lookahead->next ) > delay )
            _lookahead_slicetype_decide (h);
        else
            usleep(100);  // Arbitrary number to keep thread from spinning
    }
    while ( synch_frame_list_get_size( &h->lookahead->next ) )
        _lookahead_slicetype_decide (h);
    h->lookahead->b_thread_active = 0;
} 
```

lookahead_slicetype_decide (h); 是线程所做的事情。

互斥体，synch_frame_list_get_size：

```
int   synch_frame_list_get_size( synch_frame_list_t *slist )
{
    int fno = 0;

    pthread_mutex_lock( &slist->mutex );
    while (slist->list[fno]) fno++;
    pthread_mutex_unlock( &slist->mutex );
    return fno;
} 
```

线程2的回溯：

```
Thread 2 (thread 332.0xf18):
#0  0x00478853 in pthread_mutex_lock ()
#1  0x004362e8 in synch_frame_list_get_size (slist=0x3ef3a8)
    at common/frame.c:1078
#2  0x004399e0 in lookahead_thread (h=0xd33150)
    at encoder/lookahead.c:288
#3  0x0047c5ed in ptw32_threadStart@4 ()
#4  0x77c3a3b0 in msvcrt!_endthreadex ()
   from /cygdrive/c/WINDOWS/system32/msvcrt.dll
#5  0x7c80b713 in KERNEL32!GetModuleFileNameA ()
   from /cygdrive/c/WINDOWS/system32/kernel32.dll
#6  0x00000000 in ?? 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T21:45:20.363

我会尝试在线程 2 和线程 3 中仔细检查您的互斥锁。Pthreads 是使用标准 windows api 为 windows 实现的；所以windows和linux版本会有细微的差别。这是一个奇怪的问题，但话又说回来，这在线程中发生了很多。

您能否尝试在线程 2 和线程 3 应该开始的函数中发布代码片段？

**响应代码进行编辑**

你有没有在线程 2 中解锁过互斥锁？*您的跟踪显示它锁定了一个互斥锁，然后创建了一个线程来*完成所有试图锁定互斥锁的工作。我猜在线程 2 返回 SUCESS 之后呢？另外，为什么要使用标志和睡眠，也许用于进程同步的障碍或条件变量可能更健壮。

另一个注意事项，是否 b_thread_active 标志被标记为 volatile？也许编译器正在缓存一些东西以防止它爆发？

# paypal - 您如何将 Paypal IPN 确认连接到用户？

> ID：567282
> 
> 赞同：9
> 
> 时间：2009-02-19T21:35:47.670
> 
> 标签：paypal, paypal-ipn, paypal-subscriptions

我想使用 Paypal 的 IPN 服务来验证我网站的定期订阅费用的付款。您如何将 IPN 确认与您网站中的用户联系起来？

IPN 确认消息有名称、电子邮件、paypal ID、定期付款 ID，但它似乎没有给出唯一标识符，因为我不知道 paypal ID 或定期付款 ID 来自哪里，而且它可能不是微不足道的唯一将用户在其贝宝帐户（或在那里输入）上的姓名/电子邮件与我在我的网站上为他们拥有的姓名/电子邮件匹配（可能有很多 John Smith，此人可能会选择使用不同的电子邮件。）

1) 当我向 Paypal 发送初始付款请求时，我可以在请求他们发回给我的 URL 中附加一个唯一的 UUID，因此如果我为该用户保存该唯一 ID，我可以将该付款确认与该用户匹配发起了它。我做的比现在更难吗？有没有更简单的方法？

2) 另外，对于经常性/订阅费用，贝宝是否总是使用我在初始付款开始时指定的 URL？有没有人有使用 IPN 的定期 Paypal 付款的实际经验，它是否重用了那个唯一的 URL？还是在收到第一笔定期付款后，我是否必须将 Paypal ID 与用户关联？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T21:44:07.603

将唯一数据附加到付款请求几乎是公认的方法。

我没有任何经常性收费的经验。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T22:10:45.823

我最近还使用 Paypal 设置了一些重复付款。

我实际上希望人们在支付订阅费用*后注册为会员，如果他们愿意的话。*因为必须注册为会员可能会给销售过程增加一些摩擦。所以我不会随订阅按钮发送任何用户信息。

我的 IPN 脚本所做的是生成一个与激活表中的 Paypal 订阅 ID 相关联的唯一激活码，然后将此代码发送给支付订阅费用的人，并附上有关如何激活的说明。

在激活时，您需要注册或登录。此时，用户 ID 被添加到 Activations 表中的相关行。

当 EndOfTerm IPN 通知进入 IPN 脚本时，根据 IPN 中给出的 SubscriberID 从 Activations 表中查找 userID。然后我可以对那个用户做任何我需要做的事情来禁用他们的订阅。

IPN 脚本的 URL 始终保持不变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T21:44:03.097

1) 您可以在初始订阅设置中发送一个“item_number”参数，该参数将传回给您。我建议在其中嵌入一个识别令牌。

2）如果您的意思是“返回”参数，不，那是在订阅设置结束时将用户发送到。续订是自动的，不会“ping”该页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-11T16:46:51.253

1) You want to be using the `item_number` parameter. Set this in your HTML form shown to the customer, and it will be returned to you by the paypal IPN, so you can put a database row ID in here, and use it to match up to the right person later.

# c# - 从页面返回动态非 html 内容的最佳方式

> ID：567299
> 
> 赞同：1
> 
> 时间：2009-02-19T21:40:23.090
> 
> 标签：c#, asp.net

我应该首先说我在 .NET 2.0 环境中使用 C# 使用 ASP.NET。特别是，我试图在用户单击链接按钮时生成 csv 下载。我的回发链接在 UpdatePanel 中。过去（在 ajax 之前）要返回非 html 内容，我会使用如下代码：

```
string filename = e.CommandArgument.ToString();//somefile.csv
string fileContents = SomeClass.GetFile(filename);

Response.AddHeader("Content-disposition", 
                   string.Format("attachment; filename={0}", filename));
Response.Write(fileContents); 
```

但是由于内容没有尝试对浏览器进行完全刷新，因此这种技术不起作用。

对于这种情况，有人有更好的方法吗？我遇到的一个限制是我在项目的这一部分中坚持使用 .net 2.0，无法切换到 3.5 来解决这个问题。

ps 我还需要使用动态文件名生成内容

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T21:43:05.563

我将完全避免为此生成回发。相反，您想使用一个完全独立的页面，最好甚至只是一个处理程序 (*.ashx)。然后你可以使用一个普通的超链接，你的旧附件代码就可以正常工作了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T21:43:42.287

在 UpdatePanel 中创建一个服务器端容器（甚至是带有 runat="server" 的 HTML DIV），并在刷新 UpdatePanel 时将 .InnerHtml 或 .InnerText 属性设置为 fileContents 变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T21:49:22.833

这是我用来从多维数组生成 CSV 下载的一些匿名代码。

```
Response.Clear();
Response.ClearHeaders();
Response.ContentType = "application/vnd.ms-excel";
String shippingFileName = "filename.csv";
Response.AddHeader( "Content-Disposition", "attachment; filename=" + shippingFileName );
String[] row = { "Head1", "Head2" .... };
Response.Write( arrayToCSVString( row ) ); // quotes commas, and other formatting niceties

foreach (row in arrayOfRows) Response.Write( arrayToCSVString( row ) );
Response.Flush(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T21:56:57.837

我认为答案是确保 LinkBut​​ton 执行同步操作。我认为乔尔的回答更好，但这样的事情应该适用于回传。

确保 UpdatePanel 的 UpdateMode 设置为“Conditional”并将触发器添加到 Update Panel

```
<asp:UpdatePanel ... UpdateMode="Conditional">
    <ContentTemplate>...</ContentTemplate>
    <Triggers>
        <asp:PostBackTrigger ControlID="CsvLinkButton" />
    </Triggers>
</asp:UpdatePanel> 
```

# security - 用于降低密码安全性和 HDD 空闲空间风险的工具

> ID：567300
> 
> 赞同：0
> 
> 时间：2009-02-19T21:40:49.920
> 
> 标签：security

在底部[在这篇文章](http://www.schneier.com/essay-148.html)有一条关于破解密码的诡异方式的评论。扫描用户的整个硬盘，包括死区、交换空间等，然后尝试所有看起来可能是密码的东西。

**问题：**第 1 部分，是否有任何工具（例如 Live CD）可以扫描未安装的文件系统并将所有可能的内容归零？（注意我是*不是*要查找密码）

这将包括：

*   不属于任何文件的松弛空间
*   文件使用的最后一个块的未使用部分
*   交换空间
*   休眠文件
*   某些类型的二进制文件（如 .DOC）内部的死区

该工具（除了最后一种情况）不会修改可以通过文件系统 API 检测到的任何内容。我是*不是*在寻找块设备查找/替换，而是在寻找不属于文件的所有内容。

第 2 部分，这样的程序有多实用？写作会有多难？文件格式包含未初始化的数据有多常见？

一种（危险且成本高昂）的方法是使用文件系统感知备份工具（仅复制实际数据的工具）备份整个磁盘，将其擦除干净然后恢复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T17:11:31.980

我不明白你的第一个问题（你想修改文件系统吗？为什么？这个死区不正是你想看的地方吗？）

无论如何，[这里有一个这样的工具的例子](http://phihag.de/2009/so/hddpass.c)：

```
#include <stdio.h>
#include <alloca.h>
#include <string.h>
#include <ctype.h>

/* Number of bytes we read at once, >2*maxlen */
#define BUFSIZE (1024*1024)

/* Replace this with a function that tests the passwort consisting of the first len bytes of pw */
int testPassword(const char* pw, int len) {
    /*char* buf = alloca(len+1);
    memcpy(buf, pw,len);
    buf[len] = '\0';
    printf("Testing %s\n", buf);*/

    int rightLen = strlen("secret");
    return len == rightLen && memcmp(pw, "secret", len) == 0;
}

int main(int argc, char* argv[]) {
    int minlen = 5; /* We know the password is at least 5 characters long */
    int maxlen = 7; /* ... and at most 7\. Modify to find longer ones */

    int avlen = 0; /* available length - The number of bytes we already tested and think could belong to a password */
    int i;
    char* curstart;
    char* curp;
    FILE* f;
    size_t bytes_read;
    char* buf = alloca(BUFSIZE+maxlen);

    if (argc != 2) {
        printf ("Usage: %s disk-file\n", argv[0]);
        return 1;
    }

    f = fopen(argv[1], "rb");
    if (f == NULL) {
        printf("Couldn't open %s\n", argv[1]);
        return 2;
    }

    for(;;) {
        /* Copy the rest of the buffer to the front */
        memcpy(buf, buf+BUFSIZE, maxlen);
        bytes_read = fread(buf+maxlen, 1, BUFSIZE, f);

        if (bytes_read == 0) {
            /* Read the whole file */
            break;
        }

        for (curstart = buf;curstart < buf+bytes_read;) {
            for (curp = curstart+avlen;curp < curstart + maxlen;curp++) {
                /* Let's assume the password just contains letters and digits. Use isprint() otherwise. */
                if (!isalnum(*curp)) {
                    curstart = curp + 1;
                    break;
                }
            }
            avlen = curp - curstart;

            if (avlen < minlen) {
                /* Nothing to test here, move along */
                curstart = curp+1;
                avlen = 0;
                continue;
            }

            for (i = minlen;i <= avlen;i++) {
                if (testPassword(curstart, i)) {
                    char* found = alloca(i+1);
                    memcpy(found, curstart, i);
                    found[i] = '\0';
                    printf("Found password: %s\n", found);
                }
            }
            avlen--;
            curstart++;
        }
    }
    fclose(f);

    return 0;
} 
```

安装：

1.  启动 Linux Live CD
2.  将程序复制到`hddpass.c`主目录中的文件
3.  打开终端并输入以下内容
4.  `su || sudo -s`# 让你root，这样你就可以访问硬盘了
5.  `apt-get install -y gcc`# 安装 gcc

    # 这仅适用于 Debian/Ubuntu 等，请检查您的系统文档以了解其他人

6.  `gcc -o hddpass hddpass.c`# 编译。
7.  `./hddpass /dev/`*YOURDISK* # 磁盘通常`sda`在`hda`旧系统上
8.  看输出

[测试](http://phihag.de/2009/so/hddpass-testscript.sh)（以root身份复制到控制台）：

```
gcc -o hddpass hddpass.c

</dev/zero head -c 10000000 >testdisk # Create an empty 10MB file
mkfs.ext2 -F testdisk # Create a file system
rm -rf mountpoint; mkdir -p mountpoint
mount -o loop testdisk mountpoint # needs root rights
</dev/urandom head -c 5000000 >mountpoint/f # Write stuff to the disk
echo asddsasecretads >> mountpoint/f # Write password in our pagefile
# On some file systems, you could even remove the file.
umount testdisk

./hdpass testdisk # prints secret 
```

在 Ubuntu Live CD 上自行测试：

```
# Start a console and type:
wget http://phihag.de/2009/so/hddpass-testscript.sh
sh hddpass-testscript.sh 
```

因此，它相对容易。正如我自己发现的那样，ext2（我使用的文件系统）会覆盖已删除的文件。但是，我很确定某些文件系统不会。页面文件也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T10:15:21.923

> 文件格式包含未初始化的数据有多常见？

越来越少见了，我想。经典的“罪犯”是旧版本的 MS Office 应用程序，它（本质上）将内存转储到磁盘作为其“快速保存”格式。没有序列化，没有选择要转储的内容以及不会将新分配的内存页面归零的内存分配器。这不仅会导致文档先前版本中的多汁内容（因此用户可以使用撤消），而且还会导致来自其他应用程序的多汁片段。

> 写作会有多难？

清除未分配磁盘块的东西不应该那么难。它需要脱机运行或作为内核模块运行，以免干扰正常的文件系统操作，但大多数文件系统都有一个“已分配”/“未分配”结构，这非常简单解析。交换更难，但只要您可以在启动（或关闭）时清除它，它就不会太棘手。清除尾块比较棘手，绝对不是我想尝试在线做的事情，但让它适用于离线清洁应该不会太难。

> 这样的程序有多实用？

取决于你的威胁模型，真的。我想说，一方面，它根本不会给你太多，但另一方面，它绝对有助于防止信息落入坏人之手。但我不能给出一个硬性和快速的答案，

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-26T05:22:30.343

好吧，如果我要为启动 CD 编写代码，我会这样做：

1.  文件为 101 字节，但占用 4096 字节簇。
2.  将文件“A”复制到末尾添加空值的“B”。
3.  删除“A”并覆盖它的（现在未使用的）集群。
4.  再次创建“A”并使用“B”的内容没有尾巴（记住长度）。
5.  删除“B”并覆盖它。

效率不高，需要进行调整以确保您不会尝试复制文件中的第一个（以及完整的）集群。否则，如果没有足够的可用空间，您将遇到缓慢和失败。

有没有开源的工具可以有效地做到这一点？

# c# - 未在自定义凭据上设置 WCF 证书

> ID：567303
> 
> 赞同：2
> 
> 时间：2009-02-19T21:42:30.120
> 
> 标签：c#, .net, wcf, credentials, certificate

我在 WCF 中有一个 ClientCredentials 的自定义实现。ClientCredentials 的两个基本属性是 ClientCertificate 和 ServiceCertificate，如此[处 (MSDN)](http://msdn.microsoft.com/en-us/library/system.servicemodel.description.clientcredentials_properties.aspx)所示。

在我的配置中，我设置了自定义 ClientCredentials，并定义了两个证书：

```
 <endpointBehaviors>
            <behavior name="MyCustomEndpointBehavior">
                <clientCredentials type="MyApp.Security.CentralAuthClientCredentials, MyApp">
                    <clientCertificate findValue="localhost" x509FindType="FindBySubjectName" storeLocation="CurrentUser" storeName="My" />
                    <serviceCertificate>
                        <defaultCertificate findValue="localhost" x509FindType="FindBySubjectName" storeLocation="CurrentUser" storeName="My" />
                        <authentication certificateValidationMode="None" revocationMode="NoCheck" />
                    </serviceCertificate>
                </clientCredentials>
            </behavior>
        </endpointBehaviors> 
```

此配置*完全 100%*使用用户名身份验证。它使用证书来加密消息的用户名和密码。然后我更改为我的自定义 ClientCredentials。

在运行时，以下是在我的 CentralAuthClientCredentials 上设置的属性：

```
this.ClientCertificate = System.ServiceModel.Security.X509CertificateInitiatorClientCredential
this.ClientCertificate.Certificate = null
this.ServiceCertificate = System.ServiceModel.Security.X509CertificateRecipientClientCredential
this.ServiceCertificate.DefaultCertificate = null 
```

那么，为什么配置中定义的客户端和服务默认证书*没有*设置在实际实例化的对象上呢？看起来 WCF 完全忽略了 XML 标记！

是否可以使用一些代码（可能在凭据的构造函数中）从配置中手动获取这些证书？

谢谢你的帮助！

* * *

**更新**

我是个白痴。我想到了。WCF 实际上是使用证书集正确创建了我的实例，但是在我的 wcf 客户端中，我有以下删除/添加系列，我*想*我是从 MSDN 示例中复制的：

```
this.ChannelFactory.Endpoint.Behaviors.Remove<ClientCredentials>();
this.ChannelFactory.Endpoint.Behaviors.Add(new CentralAuthClientCredentials());
return base.Channel.MyServiceMethod(); 
```

删除旧凭据并添加我自己的自定义凭据。然而，这是一个没有设置证书的新实例！哎呀！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T11:39:55.427

为了将其标记为已回答，我添加了自己的解决方案，即从创建新凭据的客户端中删除此代码：

```
this.ChannelFactory.Endpoint.Behaviors.Remove<ClientCredentials>();
this.ChannelFactory.Endpoint.Behaviors.Add(new CentralAuthClientCredentials()); 
```

并使用 WCF 已经设置的那个，而不是在其上调用 Remove()。

# .net - 为什么 dotnet 1.1 不能在 ArrayList.GetRange 之后投下来？

> ID：567314
> 
> 赞同：4
> 
> 时间：2009-02-19T21:44:36.447
> 
> 标签：.net, arrays, casting, arraylist, .net-1.1

我想从 ArrayList 中的值范围创建一个数组，但收到错误“源数组中的至少一个元素无法转换为目标数组类型”。

为什么以下会失败，你会怎么做？

```
int[] ints = new int[] { 1, 2, 3 };
ArrayList list = ArrayList.Adapter(ints);
int[] mints = (int[])list.GetRange(0, 2).ToArray(typeof(int)); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T05:10:23.187

这是 .NET 1.1 中的一个已知错误，已在 .NET 2.0 中修复。

GetRange 的行为在此版本中被破坏。如果您尝试使用 GetRange 返回的 ArrayList 包装器实例的无参数 ToArray() 列出返回值的内容，您将看到它包含空引用和其他不一致的值。

在 BCL 团队博客中查看 2004 年 12 月[此处](http://blogs.msdn.com/bclteam/pages/273454.aspx#273640)和[此处的帖子。](http://blogs.msdn.com/bclteam/pages/273454.aspx#278008)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T21:54:00.153

如果您可以使用数组，也许只是`Array.Copy`：

```
 int[] ints = new int[] { 1, 2, 3 };
    int[] mints = new int[2];
    Array.Copy(ints, 0, mints, 0, 2); 
```

或者，看起来您必须*创建*一个数组并循环/强制转换。

（对于信息，它在 2.0 上“按原样”工作正常 - 尽管你会`List<int>`改用）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T22:12:38.800

这在 DotNet 2.0 中运行良好，所以我建议从比较反汇编的框架代码开始，看看有什么区别。

在 2.0 中，调用 ArrayList.Adapter() 返回一个 ArrayList.IListWrapper（它继承自 ArrayList），它简单地包装了一个 IList（在您的情况下，是一个 int[] 类型的数组）。在 IListWrapper 上调用 ToArray 会在基础数组上调用 IList.CopyTo。

显然这必须在 1.1 中以不同的方式实现，因为它在 2.0 中的设置方式，它不会失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T22:13:05.287

通常，这应该可以工作：

```
(int[])list.GetRange(0, 2).ToArray(typeof(int)); 
```

因为 GetRange 只是返回一个新的 ArrayList。

你确定你的 ArrayList 只包含整数，没有别的吗？

我无法在 .NET 1.1 中对其进行测试，但我认为： - 您的数组列表包含其他类型的元素，然后是 int。- ArrayList.Adapter 方法是问题的始作俑者。

另外，为什么不像这样初始化 ArrayList：

```
ArrayList l = new ArrayList ( new int[] {0, 1, 2, 3, 4, 5}); 
```

?

# c# - 你能通过函数吗 通过 WCF 服务？

> ID：567316
> 
> 赞同：17
> 
> 时间：2009-02-19T21:45:29.583
> 
> 标签：c#, .net, wcf

Func 是一个可序列化的类，但是当我尝试通过服务将它作为参数传递时。我被告知它“不是已知类型”。我已经尝试了[这里](http://blogs.msdn.com/sowmy/archive/2006/06/06/all-about-knowntypes.aspx)的解决方案，但无济于事。

非常感谢那里...

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T21:48:13.973

不，基本上。您不能通过任何`Expression`一个，因为它与`MemberInfo`节点对话。您最好的选择是谓词的字符串表示形式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T21:51:08.710

正在开展工作以启用它。查看 MSDN 代码库上的[表达式树序列化](https://expressiontree.codeplex.com/)项目。

# c++ - 学习 C++ 语言

> ID：567323
> 
> 赞同：2
> 
> 时间：2009-02-19T21:47:02.947
> 
> 标签：c++

我是 .net c# 程序员，但我也想学习 .NET C++。我是 C++ 的初学者。是否有从初学者到专家的任何网站、书籍或视频教程？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T21:55:44.410

没有“.Net c++”之类的东西。

也许您的意思是**C++/CLI**，这是微软的语言规范，旨在取代 C++ 的托管扩展（参见[Wikipedia](http://en.wikipedia.org/w/index.php?title=C%2B%2B/CLI)）。**C++ 的托管扩展**是它的劣等且现已不复存在的祖先 [感谢@dp 的评论]。

在选择学习材料时请记住，C++/CLI 不等于（标准）**C++**编程语言；所以如果你想学习前者，你应该编辑问题标题和标签。

（注意：这不是吹毛求疵，而是为了提供帮助。我认为为每个名称获取正确的想法，为每个概念找到正确的名称，是持续学习的重要因素。当然，如果您搜索网上资料。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T21:48:26.500

我建议从 Bruce Eckel 的[Thinking in C++](http://www.mindview.net/Books/TICPP/ThinkingInCPP2e.html)开始。

它已经存在了一段时间（最新版本 2003），但它提供了一条从初学者到更高级的 C++ 技术和内部的良好途径。如果您想了解更多有关这些基础知识的信息，它还有一些 OO 基础。

（本书的[主下载网站）](http://www.mindviewinc.com/Books/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T21:52:29.907

1.  cprogramming.com
2.  cplusplus.com

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T21:53:39.220

对于初学者，我认为一个好的起点是[C++ Primer](http://books.google.com/books?id=4vRE_Q41ZHEC&dq=c%2B%2B+primer&printsec=frontcover&source=bn&hl=en&ei=PdSdSYvWNYGCtweFvPWGDQ&sa=X&oi=book_result&resnum=6&ct=result)。从那里我会推荐 Scott Meyers 的[Effective C++](https://rads.stackoverflow.com/amzn/click/com/0201924889)书籍。

当然这已经被问过，我只是找不到重复的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T21:52:49.127

[http://www.amazon.co.uk/Accelerated-Practical-Programming-Example-Depth/dp/020170353X/ref=sr_1_4?ie=UTF8&s=books&qid=1235080299&sr=1-4](http://www.amazon.co.uk/Accelerated-Practical-Programming-Example-Depth/dp/020170353X/ref=sr_1_4?ie=UTF8&s=books&qid=1235080299&sr=1-4)

非常适合 c++，你会从你的 c# 中知道 .net

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T00:06:29.383

最大的提示：在 C# 中，您可以使用类来做任何事情，而在 C++ 中，您可以通过函数调用来使用 Win32 API。

1.  google.com 和 msdn.microsoft.com 是您的朋友。
2.  永不放弃。C++ 编写起来更费时，而且更容易出错。
3.  在编写程序时，请寻找可以完成您想要实现的小部分的小示例，并研究它们。

# python - 在网页的 URL 中使用 Python UUID 模块生成的值是否安全？

> ID：567324
> 
> 赞同：4
> 
> 时间：2009-02-19T21:47:29.827
> 
> 标签：python, url, uuid

在网页的 URL 中使用 Python UUID 模块生成的值是否安全？Wnat 将这些 ID 用作 URL 的一部分。是否有任何由 Python UUID 生成的不应该出现在 URL 中的非安全字符？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T21:51:42.110

**始终**对将放入 URL 的数据进行 urlencode是一种很好的做法。那么你就不需要关心 UUID 的细节或者它是否会在未来发生变化。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T21:48:52.040

他们是安全的。有关所有可能的输出格式，请参见[此处](http://docs.python.org/library/uuid.html)。它们都是可读的字符串或整数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-29T18:23:37.967

我主要使用 GUID 作为主键，并且经常需要将它们作为 URL 参数传递。

带有破折号和额外字符的十六进制形式对我来说似乎不必要地长。但我也喜欢表示十六进制数字的字符串非常安全，因为它们不包含可能导致 URL 出现问题的字符。

我使用 url 安全的 base64 字符串而不是十六进制。以下是执行此操作的一些 Python 代码。它不符合任何 UUID/GUID 规范（除了具有所需的随机性）。

```
import base64
import uuid

# get a UUID - URL safe, Base64
def get_a_Uuid():
    r_uuid = base64.urlsafe_b64encode(uuid.uuid4().bytes)
    return r_uuid.replace('=', '') 
```

# javascript - 你在什么时候进行前端优化？

> ID：567331
> 
> 赞同：3
> 
> 时间：2009-02-19T21:48:17.423
> 
> 标签：javascript, css, performance, optimization, caching

我说的是页面/样式表缓存、缩小 javascript 等。

一半的人认为在开发过程中尽早做这些事情会更好，这样我就可以有意识地意识到更现实的速度和响应问题，以及与更类似于将部署到生产中的东西进行交互，但是我大脑的另一半认为在发布之前不做任何事情更有意义，这样我就可以不断地处理在开发过程中尚未优化的原始数据。

在这个问题上有普遍的或传统的智慧吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T21:52:20.907

我最后做了所有的优化。这样我就知道什么时候不能正常工作是因为代码错误。我有时过早地尝试优化事物，并意识到我浪费了一个小时，因为我正在缓存一些东西等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T21:53:14.353

意识到用户大部分时间都在等待前端对象（下载）。您的应用程序可能会在 0.1 秒内生成 html，但用户至少要花费 2 秒等待所有图像等加载。将这些下载时间减少到一个小数字将积极增加用户体验。

通过启用 GZIP 和使用缩小的 javascript 库已经可以完成很多工作。您应该下载并安装 YSlow 并使用适当的缓存标头配置您的网络服务器。仅此一项就可以节省数百毫秒的加载时间。

最后一步是使用 CSS sprite 优化图像数量。其他步骤可以包括最小化 css 和 javascript，但这将获得我已经提到的所有方法中最少的。

总而言之，大部分都可以通过正确配置您的网络服务器来完成，但是精灵应该在开发过程中完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:55:59.853

我喜欢先构建网站，然后使用像[YSlow](http://developer.yahoo.com/yslow/)这样的用户体验分析器在最后进行优化。

[http://developer.yahoo.com/yslow/](http://developer.yahoo.com/yslow/)

我应该补充一点，某种探查器是必不可少的。否则，您将在没有前后数据的情况下进行优化，这并不完全科学（更不用说您将无法量化您所做的改进）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T21:56:26.687

过早的优化是万恶之源:)

尤其是在开发的早期，当优化会干扰您调试代码或理解程序流程的能力时更是如此。

也就是说，至少在设计阶段计划某些优化是很重要的，这样您就不会将自己编码到不再容易实现这些优化的角落（某些类型的内部缓存就是一个很好的例子）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T21:56:50.990

我同意您的前提，即您应该在早期阶段尽可能多地进行优化。它不仅会缩短开发时间（想想：当您发送垃圾邮件时，每次刷新节省 1/2 秒的时间！你已经实现的代码——在重要的东西上。缩小您不会立即修改的所有内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T07:52:30.497

我同意你大脑的另一半所说的“做你必须做的，然后做得更快”。但是对于您所做的任何事情，您必须了解并牢记如何更快地完成。

我看到这种方法的主要问题是，最后它更容易忽略你必须优化的事实，特别是如果一切似乎“足够好”。另一个问题是，如果您没有优化问题的经验，您可能确实会“在角落里编写自己的代码”，这就是事情变得非常丑陋的地方。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T13:48:10.080

我认为这可能是一个很难得到明确答案的地方，因为不同的项目会有不同的要求，这取决于他们在客户端做了多少工作。

我的经验法则可能会更晚而不是更早。只是因为很多典型的前端优化技术（至少我知道的东西）往往相当容易实现。我正在考虑空格剥离和更改http标头等等。因此，我倾向于专注于直接回答您的项目正在解决的问题的工作；一旦以有效的方式解决了这个问题，就可以转移到优化前端响应时间之类的事情上。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-28T19:17:16.213

经过多年的编码，您可以非常清楚地了解性能瓶颈将是什么。

DB Queries JS/Jquery 函数 cfc 的图像 javascripts

通过提前识别瓶颈，当您创建/修改处理这些瓶颈的每个应用程序时，您可以花时间进行调整，知道通过花时间编码，最终会给您带来更好的性能。

通过始终创建最佳代码并了解现实生活中的内容，也倾向于使我们不那么懒惰。

# javascript - Web 编程：摆脱 Javascript 或说服我潜入这个烂摊子

> ID：567340
> 
> 赞同：2
> 
> 时间：2009-02-19T21:50:15.157
> 
> 标签：javascript, client

我正在寻找 Web 编程中客户端 Javascript 的替代方案，因为对我来说这种语言简直糟透了。我的意思是我确实对 jquery 或其他 javascript 框架完成的功能印象深刻，但对我自己来说，用 javascript 编程是一种痛苦。我想在不牺牲功能的情况下替换它。

但我认为没有真正的选择，至少我不知道。

你的建议是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T21:51:42.750

当被驯服时，Javascript 是一个了不起的野兽。学习并爱上它。:)

我也不太确定您对 jQuery 的体验如何，但我是它的忠实粉丝，因为它可以让您非常、非常、轻松地做您想做的事情。就挂在那里。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T21:55:41.913

Javascript 可能很粗糙，因为它在您几乎无法控制的浏览器环境中运行。 [firefox 上的Firebug](http://getfirebug.com/)是一个巨大的帮助。

[Google Web Toolkit](http://code.google.com/webtoolkit/)允许您用 java 编写代码并“编译”为 javascript 。更多信息在这里：[http ://code.google.com/webtoolkit/](http://code.google.com/webtoolkit/)

回到 javascript，最好从小处着手，了解发生了什么。如果你总是从框架开始，那么很难知道它背后的“如何”。但实际上，一旦你处理了一些跨浏览器的错误，这还不算太糟糕！

像任何语言一样，您可以编写“清晰”代码或“不清晰”代码。如果你选择前者，你可以把它从一个痛苦的臀部变成一种乐趣。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T21:53:08.893

如果你有合适的工具来使用它，Javascript 也会变得更容易。比如[jquery](http://jquery.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T21:53:30.437

我的观点是，如果您打算进行 Web 开发，您将无法避免使用 Javascript。当然，您也许可以通过使用 Flash/Flex 来替换某些功能，但无论如何您最终都会与 Javascript 交互。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T21:58:25.883

在意识到必须投入浏览器兼容性、错误修复（他们的，而不是我们的）等方面的巨大资源之后，我多年来一直避免使用 JavaScript。在某些项目中，与实际开发相比，它占用了更多的时间和预算。

我最近再次开始使用它，不是直接使用它，而是通过 jQuery，我对它非常满意。特别是在浏览器兼容性方面。它似乎相当稳定，并且在多个浏览器中运行良好，需要解决的错误最少。.

我真的不认为按照 webdev 所采取的方向，您将能够避免 JavaScript 更长时间。如果你想拥有ajax，甚至只是一个好的动态界面，你需要在客户端做一些工作，而JS目前似乎是IT。

我仍然讨厌在其中工作，但我认为那是因为我避开它太久了，我忘记了如何这样想。

当我拿起它时，它又回到了我身边，我发现它为我能做的事情增加了相当多的力量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T21:52:45.447

我的建议是吸收它并使用 Javascript。有一些很棒的框架可以让你的生活变得更轻松，所以探索吧！

唯一被广泛采用的选项是 Flash。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T21:53:16.317

好吧，看起来你已经有点领先了。jQuery 或其他框架非常强大，可以让您的生活更轻松。我的建议是学习这些框架中的一个或多个，并练习练习。如今，Web 应用程序（至少是我参与的应用程序）实现的前端逻辑与后端逻辑一样多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T21:53:40.203

展望未来，学习像[Flex一样的 RIA](http://www.adobe.com/devnet/flex/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T21:54:40.323

看看 Flash/Flex/Silverlight/Moonlight。我们都知道 Javascript 是一头野兽，需要一些时间来适应。

# vbscript - 在 VBscript 中调用函数时使用 Call 有什么好处吗？

> ID：567341
> 
> 赞同：2
> 
> 时间：2009-02-19T21:50:38.900
> 
> 标签：vbscript

如果答案很明显，请原谅我，因为我已经很长时间没有编写 vbscript 了。

在 vbscript 中调用函数时使用 Call 有什么好处吗？

例如：

```
SomeFunction param1, param2 
```

对比

```
Call SomeFunction (param1, param2) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T21:56:48.337

根据[MSDN](http://msdn.microsoft.com/en-us/library/bx9ceb2w.aspx)的区别-

> 要从另一个过程调用 Sub 过程，请键入过程的名称以及任何所需参数的值，每个参数以逗号分隔。**Call 语句不是必需的，但如果确实使用它，则必须将所有参数括在括号中**。
> 
> 以下示例显示了对 MyProc 过程的两次调用。一种是在代码中使用Call语句；另一个没有。**两者都做同样的事情**。
> 
> ```
> Call MyProc(firstarg, secondarg)
> MyProc firstarg, secondarg 
> ```
> 
> 请注意，如果不使用 Call 语句，则在调用中省略括号。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T21:53:17.677

不，那里没有。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T03:43:39.370

Call 通常用于子例程而不是函数，但无论哪种方式都没有区别。但是，当涉及到函数时，您可以从函数中检索值返回，而子例程则不能。例子

```
result = SomeFunction("param1")

Function SomeFunction(someArg)
SomeFunction = someArg & "Hey There"
End Function 
```

这会将“param1 Hey There”返回到“result”值

```
result = SomeSub("param1")

Sub SomeSub(someArg)
SomeSub = someArg & "Hey There"
End Sub 
```

但在这种情况下，“结果”将没有任何价值，因为子程序无法做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-25T03:49:49.230

这真的取决于你有多喜欢括号。来自 c 家族的背景，没有它们对我来说看起来非常奇怪。

# regex - 如何在 Perl 正则表达式中转义左括号？

> ID：567344
> 
> 赞同：3
> 
> 时间：2009-02-19T21:51:13.733
> 
> 标签：regex, perl, shell, replace

如果我有一个包含一些转义括号的文件，如何使用 Perl 将所有实例替换为未转义的括号？

即转这个：

```
.... foo\(bar .... 
```

进入这个

```
.... foo(bar .... 
```

我尝试了以下但收到此错误消息：

```
perl -pe "s/\\\(/\(/g" ./file
Unmatched ( in regex; marked by <-- HERE in m/\\( <-- HERE / at -e line 1. 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T21:55:01.417

你忘记了反斜杠对 shell 也有一定的意义。尝试使用单引号而不是双引号。（或者将您的脚本放在一个文件中，您无需担心 shell 引用。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T21:55:08.530

嘎。从命令行，不少。元字符解释的层次太多了。

尝试用单引号替换双引号，看看是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T03:15:21.800

[cjm 的](https://stackoverflow.com/users/8355/cjm) [回答](https://stackoverflow.com/questions/567344/how-do-i-unescape-a-left-paren-in-perl/567374#567374)可能是最好的。如果您必须在命令行中执行此操作，请尝试使用[quotemeta()](http://perldoc.perl.org/functions/quotemeta.html)或元[引用转义序列](http://perldoc.perl.org/perlre.html) **(\Q...\E)**。这在 bash 提示符下对我有用：

```
perl -pe "s/\Q\(\E/(/g" ./file 
```

# .net - EntLib 缓存应用程序块的替代方案？

> ID：567352
> 
> 赞同：4
> 
> 时间：2009-02-19T21:52:26.477
> 
> 标签：.net, caching, client

我正在开发一个 Windows 客户端应用程序并想缓存一些数据。这是一个非常简单的场景，基本上只是将一些数据保存在内存中，这样应用程序就可以避免在网络连接中断时崩溃。

我可以推出我自己的缓存解决方案，或者使用 EntLib 缓存块，但在提交之前我正在寻找更多的替代方案。
问题是，我所做的所有搜索都显示：

*   entlib 块（我已经知道）
*   ASP.NET 缓存（我不能使用）
*   Velocity（分布式，需要 Windows 服务才能连接）
*   NCache（也是分布式的，类似于velocity）

当然还有其他一些内存缓存库吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-05-19T00:57:08.303

.Net 4.0 引入了[System.Runtime.Caching](http://msdn.microsoft.com/en-us/library/dd985642.aspx)命名空间。根据 MSDN 文档：[Caching in .NET Framework Applications](http://msdn.microsoft.com/en-us/library/dd997357.aspx) ，建议将其用于内存缓存。它的建模类似于 4.0 之前的 System.Web.Caching 实现，因此 ASP.NET 用户应该相对熟悉它的使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T21:56:09.447

我在 winforms 中完成的任何缓存都是用静态变量完成的，但如果我做一些不平凡的事情，我可能会使用 DI 框架并只使用它的缓存。[http://blogs.conchango.com/owainwragg/archive/2008/10/31/caching-with-castle-windsor.aspx](http://blogs.conchango.com/owainwragg/archive/2008/10/31/caching-with-castle-windsor.aspx)

虽然不是一个完整的解决方案。缓存从 DI 内核返回的对象是有意义的，但不是非常随意的值。

# javascript - Zend_From_File 上传，但文件元素存储在 js 模态窗口中！不工作

> ID：567356
> 
> 赞同：0
> 
> 时间：2009-02-19T21:52:53.323
> 
> 标签：javascript, jquery, file, zend-framework, file-upload

我正在开发一个基于 zend 框架的应用程序，它给我的问题是，当我像这样回显 zend 文件元素时：

```
<div id="add_video" title="Add Video">
    <?php echo $this->form->video_title;?>
    <?php echo $this->form->video_thumb;?>
    <?php echo $this->form->video_video;?>
</div> 
```

我在标题中有这个：

```
<script type="text/javascript" src="/js/jquery-1.3.1.js"></script>
<script type="text/javascript" src="/js/jquery-ui-personalized-1.6rc6.js"></script>
<script>
  $(document).ready(function(){
    $("#add_video").dialog({ autoOpen: false, buttons: { "Ok": function() { $(this).dialog("close"); }}});
  });
</script> 
```

当 sumited zend 框架没有找到该文件时，我执行 print_r($_FILES)，并且数组中没有任何内容，当我删除 javascript 时它再次工作......同样的例子在不使用 zend 框架时工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-13T23:51:49.343

你现在可能已经想通了。但是是的，jqueryui 的模态对话框会生成显示所需的 html 并将其附加到文档的末尾。因此，您需要执行以下任一操作：

1.  让您的整个表单显示在模态对话框中
2.  使用“确定”按钮的返回函数 () 使用 $(this).children('input').each() 将所有输入元素拉到对话框内，并将它们附加到主窗体

# java - 在 log4j 中，有没有办法根据时间戳记录错误？

> ID：567382
> 
> 赞同：0
> 
> 时间：2009-02-19T21:56:01.337
> 
> 标签：java, log4j

log4j 基于级别记录错误。有没有办法根据时间戳记录错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:08:08.437

log4j 可以配置为使用行中的时间戳记录。至少这就是我认为你要问的。

[在您的PatternLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)中使用 %d 。

现在我明白了：log4j 是异步的，所以你的时间戳可能是乱序的。

如果您想要同步日志记录，我相信这是可能的，但速度较慢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T12:36:11.587

如果您使用 log4j 记录到文件，则在创建记录事件时创建时间戳。因此，当调用 (debug, info, ...) 方法时。如果您有多个线程正在运行，则可能是消息未按照与时间戳相同的顺序写入文件。

如果您需要按顺序对日志行进行排序，请使用 JDBC Appender 并记录到数据库。然后您可以查询数据库并按时间戳排序。

# tfs - 如何在 TFS 构建报告中创建自定义部分？

> ID：567383
> 
> 赞同：1
> 
> 时间：2009-02-19T21:56:03.660
> 
> 标签：tfs, msbuild, build-automation, tfsbuild

我知道如何添加自定义[BuildStep](http://msdn.microsoft.com/en-us/library/bb399129.aspx)任务；但是，最好创建一个新部分，类似于“**摘要**”和**“构建步骤”**部分。

我们根据工作空间和目标环境之间的差异，有选择地在成功构建上部署文件。我们确实为我们移动的文件和它们覆盖的文件创建了一个 HTML 和 XML 日志。最好在构建报告中添加一个部分以显示此信息。

像这样的东西：

[图片 http://www.freeimagehosting.net/uploads/71360b417a.png](http://www.freeimagehosting.net/uploads/71360b417a.png)

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T10:11:44.157

目前微软没有提供任何机制来扩展 VS 2008 或 VS 2005 中的构建报告。但是，他们正在对 TFS 2010 的构建报告进行重大更改，我知道该报告的自定义是一个非常需要的功能，但我还不确定那是什么状态。

# vb.net - 什么时候可以在 VB.Net 中使用 GoTo 语句？

> ID：567386
> 
> 赞同：2
> 
> 时间：2009-02-19T21:56:27.543
> 
> 标签：vb.net, goto

我有需要在数据库中创建一堆记录并在出现任何问题时回滚所有记录的过程。我想做的是：

```
Public Structure Result
    Public Success as Boolean
    Public Message as String
End Structure

Private _Repository as IEntityRepository

Public Function SaveOrganization( _
    ByVal organization As rv_o_Organization) As Result
    Dim result = Result.Empty

    _Repository.Connection.Open()
    _Repository.Transaction = _Repository.Connection.BeginTransaction()

    ''//Performs validation then saves it to the database
    ''// using the current transaction
    result = SaveMasterOrganization(organization.MasterOrganization)
    If (Not result.Success) Then
        GoTo somethingBadHappenedButNotAnException
    End If

    ''//Performs validation then saves it to the database
    ''//using the current transaction
    result = SaveOrganziation(dbOrg, organization)
    If (Not result.Success) Then GoTo somethingBadHappenedButNotAnException

somethingBadHappenedButNotAnException:
    _Repository.Transaction.Commit()
    _Repository.Connection.Close()
    Return result
End Sub 
```

这是对 GoTo 语句的正确使用，还是只是非常糟糕的设计？有没有更优雅的解决方案？希望这个样本能够理解这一点

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T21:58:16.617

如果你不得不问，不要这样做。

对于您的特定代码，您可以这样做：

```
Public Function SaveOrganization(ByVal organization As rv_o_Organization) As Result
    Dim result As Result = Result.Empty

    _Repository.Connection.Open()
    _Repository.Transaction = _Repository.Connection.BeginTransaction()

    'Performs validation then saves it to the database 
    'using the current transaction
    result = SaveMasterOrganization(organization.MasterOrganization)

    'Performs validation then saves it to the database 
    'using the current transaction
    If result.Success Then result = SaveOrganziation(dbOrg, organization)

    _Repository.Transaction.Commit()
    _Repository.Connection.Close()
    Return result
End Sub 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T22:10:09.320

Goto 的名声如此糟糕，以至于它会导致其他开发人员立即对您的代码产生不好的看法。即使您可以证明使用 goto 是最好的设计选择 - 您也必须一遍又一遍地向任何看到您的代码的人解释它。

为了自己的名声，千万别做。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T22:00:03.150

真是糟糕的设计。是的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T22:02:04.317

可能有一些极端的情况适用，但几乎毫不含糊地，不，不要使用它。

在这种特定情况下，您应该使用 Using 语句以更好的方式处理此问题。通常，您将创建一个实现 IDisposable 的类（或使用已经实现的类），然后在 Dispose 方法中处理清理。在这种情况下，您将关闭与数据库的连接（显然，它从您的设计中再次重新打开）。

另外，我建议在这里也使用 TransactionScope 类，您可以使用它来确定事务的范围，然后提交它，以及在遇到异常时自动中止。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T22:06:00.080

唯一应该使用 goto 的时候是在没有其他选择的情况下。

找出是否没有其他选择的唯一方法是全部尝试。

在您的特定示例中，您应该使用 try...finally 代替，就像这样（对不起，我只知道 C#）

```
void DoStuff()
{
    Connection connection = new Connection();
    try
    {
        connection.Open()
        if( SomethingBadHappened )
            return;
    }
    finally
    {
        connection.Close();
    }    
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T21:59:25.103

我会非常谨慎地说。每当我不得不考虑使用 GOTO 语句时，我都会尝试重构代码。我能想到的唯一例外是在 vb 中带有 On Error Goto 语句。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T22:02:23.003

goto 本身并没有什么问题，但这并不是一个非常理想的用法。我认为您对异常的定义提出了太高的要求。

只需抛出一个自定义异常并将您的回滚代码放在那里。如果发生真正的异常，我假设您也想回滚，因此您也可以通过这种方式获得双重职责。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T22:24:18.863

Gotos 只是一个实现细节。一个 try/catch 很像一个 goto（一个堆栈间 goto！）如果你愿意，可以用 goto 编写一个 while 循环（或任何构造）。Break 和 early return 语句是所有这些语句中伪装最薄的 goto - 它们是公然的（有些人因为相似而不喜欢它们）

所以从技术上讲，它们并没有什么真正的错误，但它们确实使代码变得更加困难。当您使用循环结构时，您将被绑定到大括号的区域。没有人想知道你实际上要去哪里，搜索或纵横交错。

最重要的是，他们有一个非常糟糕的代表。如果你决定使用一个，即使在最好的情况下，你也必须为你的决定辩护，反对所有读过你的代码的人——而你要保护的那些人中的许多人都不具备这种能力让自己做出判断，所以你在到处鼓励糟糕的代码。

针对您的情况的一种解决方案可能是使用提前返回与 goto 相同的事实（ps。有史以来最糟糕的伪代码）：

```
dbMethod() {
    start transaction
    if(doWriteWorks())
        end Transaction success
    else
        rollback transaction
}
doWriteWorks() {
    validate crap
    try Write crap
    if Fail
        return false
    validate other crap
    try Write other crap
    if Fail
        return false
    return true
} 
```

我认为这种模式可以在 VB 中使用，但自 VB 3 以来（大约在 MS 购买它的时候）我就没有使用过它，所以如果事务以某种方式绑定到执行方法上下文或其他东西，那么我不知道。我知道 MS 倾向于将数据库与代码结构非常紧密地绑定，否则我什至不会考虑这不起作用的可能性......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-12-11T01:10:17.823

我一直在特定的地方使用 goto，例如在 Try Catch 上方，以防您提示用户“重试？，取消”，如果重试则转到 StartMyTask: 并根据最大重试次数增加当前尝试设想。

它们在每个循环中也很方便。

```
For each Items in MyList

 If VaidationCheck1(Item) = false then goto SkipLine
 If ValidationCheck(Item) = false then goto skipline

 'Do some logic here, that can be avoided by skipping it to get better performance.
 'I use then like short circuit operands, why evaluate more than you actually have to?

 SkipLine:
Next 
```

我不会用它们代替函数并制作非常大的长代码块，只是在它们可以真正提供帮助的小地方，主要是为了跳过一些事情。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T22:02:27.730

每次我看到使用 goto 时，简单的重构都可以处理它。我建议永远不要使用它，除非你“知道”你必须使用它

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T22:02:41.523

我很想说永远不会，但我想总有一种情况可能是最好的解决方案。但是，我在过去 20 年左右的时间里没有使用 Goto 语句进行编程，并且无法预见很快就会需要一个。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T22:04:03.797

为什么不将每个函数调用包装在一个 try catch 块中，完成后，如果抛出一个异常，您可以捕获它并关闭连接。这样，您就完全避免了 GOTO 语句。

简而言之，GOTO 语句不是一件好事，除非在不寻常的情况下，即使这样，通常也需要进行重构以避免它。不要忘记，它是早期语言的遗留物，在这种情况下是 BASIC。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-19T22:07:05.787

我会说非常谨慎地使用，因为它通常与引入意大利面条代码有关。尝试使用方法而不是标签。

我认为使用 GOTO 的一个好例子是创建一个通过选择的流程，该流程在 C# 中可用，但在 VB 中不可用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-19T22:14:21.040

go to 语句倾向于使程序流难以理解。我不记得在过去十年中使用过它，除了在 Visual Basic 6 中结合“错误”。

就我而言，您对 go to 的使用是可以接受的，因为程序流程非常清晰。我不认为使用 try ... catch 会改善很多，因为您需要在 go tos 现在所在的位置抛出异常。

但是，格式不是很吸引人:-)

我会将 go to label 的名称更改为其他名称，因为当一切成功时也会到达此位置。clean_up：会很好。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-19T22:20:26.097

嗯，它在 VBscript/ASP 中有一个不错的用途，用于处理错误。我们使用它来将错误处理返回给 ASP，一旦我们完成使用 on error resume next。

在.net？天哪，不！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-06-02T17:39:49.770

每个人都说避免它，但为什么。GOTO 语法是汇编中的跳转语句 - 非常有效。

避免它的主要原因是**代码可读性**。您需要在代码中找到难以观察的 GOTO 标签。

有些人认为这可能会导致内存泄漏，但我看到专家说这在 .NET 中并非如此。

# asp.net - ASP.NET MVC 部分视图和重定向

> ID：567403
> 
> 赞同：1
> 
> 时间：2009-02-19T22:00:20.420
> 
> 标签：asp.net, asp.net-mvc

我有一个名为 Login.ascx 的局部视图，其中包含我的登录框，我在整个站点的许多页面上都包含这些框。当信息正确时它工作正常，但我正在尝试进行验证，所以如果登录信息不正确，我想将用户重定向回他们之前所在的视图，以向他们显示登录错误。什么是正确的说法，回到你来自的观点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T22:08:28.967

如果从任何页面登录失败，我想我会将他们引导到登录视图以查看错误而不是上一页。与另一个页面上的登录控件相比，专用登录页面可能有更多的 UI 空间来显示错误等。话虽如此，您可能希望在 Login 操作中包含 returnUrl 参数，以便在登录实际成功时，将用户引导回他们曾经（或试图到达）的地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T22:07:45.457

听起来，与其问我是如何做到的，不如问自己为什么我要这样做。也许这是一个设计决定而不是技术问题。

虽然如果您真的要为多个登录页面设置一个控制器操作，您可以尝试...

```
return Redirect(Request.UrlReferrer.ToString()); 
```

或者将路由名称保留在 TempData 中，只使用 RedirectToRoute(TempData["LoginRoute"]);

虽然这两种解决方案都有不好的代码气味。

请注意，如果您不检查跨站点注入，则只会引用其他站点。您可能希望对引用 URL 进行一些验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T22:08:01.790

对于内置`Login`方法，`AccountController`有一个名为的参数`returnUrl`，您可以像这样使用它：

```
 Return Redirect(returnUrl); 
```

或者

```
 Return RedirectToAction(returnUrl); 
```

如果您将`returnUrl`参数指定为有效的操作链接。

我最近遇到了类似的问题-您也许可以在[这里](https://stackoverflow.com/questions/505540/how-do-i-specify-a-return-url-for-a-link-to-the-login-form)找到一些东西...

# wpf - WPF RichTextBox 使用行号创建编辑器

> ID：567404
> 
> 赞同：17
> 
> 时间：2009-02-19T22:00:25.927
> 
> 标签：wpf, richtextbox, line-numbers

我正在为特定领域的语言创建一个文本编辑器。我使用 WPF`RichTextBox`作为基本控件。我不知道如何优雅地包含行号。有谁知道任何例子？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-09-20T07:05:08.363

[AvalonEdit](http://www.codeproject.com/KB/edit/AvalonEdit.aspx)是一个很好的工具，它是开源的。我认为它几乎具有 Aqistar 控件的所有功能，例如语法高亮和折叠。易于配置和使用。更多细节可以在[这里](http://wiki.sharpdevelop.net/AvalonEdit.ashx)找到。 ![在此处输入图像描述](https://i.stack.imgur.com/y6t9B.png)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T22:08:52.130

我将创建一个复合控件，左侧有一个堆栈面板控件和文本块，用于处理行号。如果您担心行数和视觉元素过多，那么您可以在虚拟模式下使用 ListBox。

您必须连接 RichTextBox 上的各种事件，以便知道何时更新 ListBox，以及计算每行的高度，但这应该可以通过附加到 RichTextBox 的 FlowDocument 来实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T22:15:01.553

RichText 支持“受保护”（不可编辑）跨度。您可以将行号转储为受保护的文本跨度作为 RTF 流的一部分（当您进行格式化时）。

在 Win Forms 中，您可以使用[RichTextBox.SelectionProtected Property](http://msdn.microsoft.com/en-us/library/system.windows.forms.richtextbox.selectionprotected.aspx)。WPF 必须有类似的东西。

这样，您的所有基线都将是正确的，您无需进行任何额外的思考/编程即可使编辑器正常运行。可编辑的文本将是可编辑的，而行号将是不可编辑的。

唯一的缺点是您必须在每次编辑后重新提交 RTF 流。但我想你已经这样做是为了提供解析格式/错误诊断/任何东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T22:20:54.303

使用 AqiStar 的富文本 WPF 控件怎么样？ [AqiStar.TextBox](http://www.aqistar.com/)

我不为他们工作……我只知道 Oren 在他的 NHibernate Profiler (NHProf) 中使用了这个产品，他似乎很喜欢它。

# sql - 您应该将 SQL 存储过程存储在源代码管理中吗？

> ID：567405
> 
> 赞同：12
> 
> 时间：2009-02-19T22:00:40.870
> 
> 标签：sql, sql-server, stored-procedures, version-control

在开发包含大量存储过程的应用程序时，是否应该将它们存储在某种源代码版本控制系统中（例如源代码安全、TFS、SVN）？如果是这样，为什么？使用 SQL Server Management Studio 是否有一种方便的前端方式来执行此操作？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-19T22:01:49.713

是的。所有代码都应存储在源代码管理中。

简而言之，代码就是代码，错误就会发生。很高兴能够回过头来看看随着时间的推移发生了什么变化并能够回到那些变化。

我们必须手动将其添加到源代码控制系统，但您可以为管理系统的 Sql Server 创建插件。我还没有创建一个自动将它添加到源代码管理，但我想你可以。此外，所有代码都存储在 sql 表中，因此理论上您可以创建一个进程或其他东西来遍历表并检索所有代码并自动提交。

更新：我总是会编写额外的代码来检查代码是否存在以及它是否没有创建填充程序，然后实际的脚本会执行并更改程序。

```
IF NOT EXISTS (SELECT * FROM dbo.sysobjects WHERE 
id = OBJECT_ID(N'[dbo].[SomeStoredProcedure]') AND 
OBJECTPROPERTY(id,N'IsProcedure') = 1)

EXEC sp_executesql N'CREATE PROCEDURE [dbo].[SomeStoredProcedure] AS

SELECT ''SPROC Template'''

GO

SET ANSI_NULLS ON

GO

SET QUOTED_IDENTIFIER ON

GO

 ALTER PROCEDURE SomeStoredProcedure 
```

执行删除并重新创建将删除您为其设置的所有用户权限。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-19T22:06:27.613

**毫无疑问，在整个宇宙中永远没有例外是的！**

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T22:06:21.933

[让您的数据库处于版本控制之下](https://blog.codinghorror.com/get-your-database-under-version-control/)。查看 Scott Allen 的一系列帖子。

*在版本控制方面，数据库通常是二等甚至三等公民。从我所看到的情况来看，在一百万年之内永远不会考虑编写没有版本控制的代码的团队——这是正确的——可能会以某种方式完全忘记围绕他们的应用程序所依赖的关键数据库进行版本控制的需要。我不知道当您的数据库与您的其他代码没有处于完全相同严格的源代码控制级别时，您如何称自己为软件工程师并保持正视。不要让这种情况发生在你身上。让您的数据库处于版本控制之下。*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-19T22:04:28.413

绝对是的。那么问题就变成了如何将它们存储在源代码管理中。您是删除并重新创建存储过程还是只是更改，您是在脚本末尾还是在单独的脚本中添加权限。不久前有一篇关于 Coding Horror 的帖子，关于我觉得有趣的话题。[您的数据库是否处于版本控制之下？](https://blog.codinghorror.com/is-your-database-under-version-control/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T22:04:44.170

我建议您存储它们。你永远不知道什么时候需要回滚，或者挖掘你可能已经删除的逻辑..

这是一种轻松将存储过程抓取到文件中的好方法，您可以将这些文件放入您想要的任何源代码控制中。

[存储过程到 .sql 文件](https://stackoverflow.com/questions/337601/stored-procedures-to-sql-files)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-19T22:34:54.720

存储存储过程是个好主意。虽然它很痛苦。你是如何把所有这些东西都变成颠覆的？您可以手动执行此操作，但它很乏味，最终您根本不执行此操作。

我使用来自[subsonic 项目](http://subsonicproject.com/download/)的工具。

```
sonic.exe version /server servername /db databasename /out outputdirectory 
```

此命令将所有内容保存到 2 个文本文件中。一个包含数据库模式、存储过程、用户帐户、约束和主键。另一个包含数据。

现在您有了这两个文件，您可以使用 subversion(cvs,source safe) 将其移动到源代码控制中。

[有关使用命令行工具 (SubCommander) 的](http://subsonicproject.com/subcommander/using-the-command-line-tool-subcommander/)更多信息

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T22:06:55.270

你当然应该。

在`MS SQL 2008`，您可以[**直接从 Management Studio**](http://msdn.microsoft.com/en-us/library/ms173550.aspx)中进行操作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-19T22:37:53.263

SQL 是代码。所有代码都属于源代码控制。

就这些。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-19T22:13:43.197

绝对地。积极。

一组 SP 是一个接口，可能比结构更改更频繁地被修改。并且由于 SP 包含业务逻辑，因此应将更改存储在版本控制中以跟踪对逻辑的修改和调整。

将这些存储在版本控制中是编码级别组织成熟度的一种表现，也是一种最佳实践。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-19T23:49:49.767

明确地。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T22:02:57.013

你应该。

据我所知，不存在这样的工具来自动化这个过程。至少，五年前，当我考虑建造一个时，似乎没有任何竞争。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T22:03:48.710

我们将过程存储在 Subversion 中，包括 DDL 在内的所有 SQL 代码都应该在某种源代码控制存储库中

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-19T22:04:11.737

就此而言，SP 和表模式都是应受版本控制的资产。在一个完美的世界中，数据库将由脚本构建，包括测试数据，作为 CI 过程的一部分。即使不是这样，拥有数据库/开发人员也是一个很好的模型。通过这种方式，可以在本地沙箱中尝试新想法，而不会影响所有人，一旦测试更改就可以签入。

Management Studio 可以链接到源代码控制，尽管我没有这样做的经验。我们一直将我们的 SP/模式作为文件进行跟踪。Management Studio 可以自动生成更改脚本，这非常有用，因为对于任何有数据的表来说，删除/重新创建表可能过于繁重。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-19T22:04:28.647

SQL procs 也肯定需要与项目中的其余代码相同的版本控制的安全性/好处。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-19T22:06:41.700

正如其他人所说，是的，他们应该是。

我不知道使用 SQL Server Management Studio 执行此操作的简单方法，但如果您还使用 Visual Studio，数据库项目是管理此操作的好方法。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-19T23:31:28.780

如果您喜欢编写自己的脚本工具，SMO 中有一些方法可以生成脚本。

[http://www.sqlteam.com/article/scripting-database-objects-using-smo-updated](http://www.sqlteam.com/article/scripting-database-objects-using-smo-updated)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-19T23:36:57.753

如果您没有将资产管理与源代码控制一起使用，那么我说将所有内容都放入源代码控制中。图片，word文档，整个shebang。不能丢失它，可以随时撤消对它的任何更改，如果任何机器出现故障 - 什么都不会丢失。

# ruby-on-rails - OCIError (ruby on rails)

> ID：567407
> 
> 赞同：0
> 
> 时间：2009-02-19T22:01:13.600
> 
> 标签：ruby-on-rails

我正在使用 rails freeze 1.2.3 来运行 rails 应用程序。因为该应用程序位于远程计算机上，所以我使用 ssh 隧道 (ssh -l -L) 在我的屏幕上显示该应用程序。当我运行它时，它正确提示登录页面，在我输入信息后，我得到了这个错误： OCIError in ServiceController Error while trying to retrieve text for error ORA-12154

我已经在另一台机器上尝试了相同的应用程序，没有使用 freeze（因为该机器的 rails 版本为 1.2.3，而当前的机器版本为 2.0.2）。那是错误的来源吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T22:05:21.860

这是一个 Oracle 错误。听起来您的数据库设置不正确。将错误号 ORA-12154 输入谷歌，你会发现一些有用的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T23:35:33.920

ORA-12154 是经典之作。正如莎拉指出的那样，它与您的 Rails 或 Ruby 本身无关。当 Oracle 客户端无法连接到 oracle 服务器时，会生成 ORA-12154。所以很可能你的设置是错误的：

1.  您的 database.yml，如果您可以使用 tnsping 或 sqlplus（Oracle 客户端工具）进行连接，您可能只需要查看这个。

2.  您的 Oracle 网络设置，尤其是您的 tnsnames.ora 文件（如果我没记错的话，可以在 $ORACLE_HOME/network/admin 中找到）。这可能需要友好的 DBA 提供一些额外的帮助，因为 tnsnames.ora 语法有一些怪癖。检查此链接[链接文本](http://www.dba-oracle.com/t_ora_12154_tns_resolve_service_name.htm)以获取更多信息。

希望有帮助。

# asp.net - 内容页中控件的母版页位置

> ID：567423
> 
> 赞同：0
> 
> 时间：2009-02-19T22:04:00.910
> 
> 标签：asp.net, master-pages

我正在尝试使用母版页重建网站。我复制了旧页面中控件的标记并将它们放在新页面的内容占位符中（在源视图中）。

由于它们是绝对定位的，因此控件不会留在设计视图中的内容占位符内。一切都在源视图中的内容占位符标签之间。

该页面在我运行时有效。就这样放着有什么不对吗？我似乎无法将所有控件拖到设计视图中的内容占位符中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:08:28.433

老实说，我很少使用设计视图。用手打字会更容易、更快捷，这样你就会更习惯这种语言。至于旧内容，您可以将其粘贴到源代码中，当然，除非旧内容中出现错误，否则它应该可以正常工作。设计视图并不总是能准确地显示您的代码，所以我不会太担心。您应该尝试构建页面并确保没有任何小的差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:26:09.640

听起来你在那里真的没有问题。回到编码并玩得开心！***咧嘴笑*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T11:50:48.867

这是我第一次听说有人在 Visual Studio 中使用设计视图。:)

代码是主人......如果代码在内容标签之间，那么它在占位符中。

如果有一种方法可以完全关闭“设计”窗格，那就太好了，因为它几乎毫无价值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-12T14:45:55.610

多年来我一直有同样的问题。是的，我知道，“总是使用源代码视图”和“程序员应该只写代码”。但是有时您只想从工具箱中拖出一个控件，然后在设计视图中将其放在页面上，或者将控件链接到数据源，而无需输入所有内容。

所以，VS中的明显缺陷。使用母版页和内容占位符时，设计视图几乎无法使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T22:07:42.273

由于设计视图只是代码的 GUI 表示，如果代码是正确的，那么你应该没问题。不过，就用户体验而言，我会有点担心。是有实际问题，还是我误解了？

# asp.net - 本地 IIS - 如何禁用传入/传出连接？

> ID：567425
> 
> 赞同：1
> 
> 时间：2009-02-19T22:04:07.167
> 
> 标签：asp.net, iis, iis-5

由于雇主的安全问题，不允许开发团队在他们的开发 PC 上安装 IIS。我想知道是否有办法在本地安装 IIS 并禁止传入/传出连接？开发团队只想利用 IIS 的功能进行开发，而不必担心“安全”漏洞/问题？很长的故事...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:08:41.057

您可以将其绑定到仅限本地地址。

而不是将其绑定到 0 或 *（任何可用地址）将其绑定到 127.0.0.1。这将只允许您的机器访问 IIS，因为它只侦听 IP 127.0.0.1。

更改绑定因版本而异，您使用的是哪个版本？

编辑

对于您想要的 IIS 5/6。

*   右键单击您的站点并转到属性
*   选择网站选项卡
*   在网站标识下单击高级

这应该允许您更改绑定。

确保您拥有的唯一绑定是任何端口上的 127.0.0.1。

# apache - 对整个服务器/域强制 https

> ID：567434
> 
> 赞同：10
> 
> 时间：2009-02-19T22:05:55.133
> 
> 标签：apache, .htaccess, mod-rewrite, https

我正在开发一些只能通过 https 访问的表单。我有一个专用服务器，有自己的证书和所有好东西。

所以我的问题实际上是双重的：

1）。强制每个请求为 https 的最佳方法是什么？有没有比这个 .htacess/mod_rewrite 规则更好的方法：

```
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} 
```

2）。是否有任何潜在的陷阱或不利因素迫使我应该考虑的一切都是https（除了开销，这似乎不是问题）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T22:22:08.357

你所拥有的应该没问题，这就是我使用的：

```
RewriteCond %{HTTPS} !=on
RewriteRule ^/(.*) https://%{SERVER_NAME}/$1 [R,L] 
```

`R`表示它是重定向而不是重写，并且表示`L`重写引擎不应再执行任何重写。

我最初在这里找到了这个：[Httpd Wiki](http://wiki.apache.org/httpd/RewriteSSL)

**编辑：**

我忘了提到`SSLRequireSSL`强制所有请求通过 HTTPS 的指令。详细信息可以在[Apache 文档](http://httpd.apache.org/docs/2.2/mod/mod_ssl.html#sslrequiressl)中找到。

# report - DevExpress - Xtra 报告：组标题/排序不能使用聚合函数

> ID：567448
> 
> 赞同：0
> 
> 时间：2009-02-19T22:08:27.017
> 
> 标签：report, grouping, devexpress

我必须使用第三方应用程序中的 DevExpress 的 Xtra 报告。我有一个显示“状态”的组标题，但按“总和（付款金额）”按总数的降序排列，而不是状态的名称（这是一个要求。）。

组标题：状态详细信息：此状态中的每个项目 | Payment_Amount 组页脚：此状态的 Sum(Payment_Amount)

必须按 Sum(Payment_Amount) 降序对组进行排序。

示例：如果加利福尼亚的付款总额最高，那么它是第一位的，而不是怀俄明州。

如何在分组标题集合中包含 Sum(Payment_Amount)？不能包含文本框的值。不允许将聚合函数放在计算字段的表达式中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-02-08T18:23:48.197

我必须在数据源中包含这些值的总和。报告实际上是根据这些值而不是名称进行分组的。

# c# - 发现内存类型

> ID：567454
> 
> 赞同：0
> 
> 时间：2009-02-19T22:09:25.220
> 
> 标签：c#, memory, wmi

我已经在谷歌上搜索了一段时间，无法发现是否有一种通用方法可以查看给定工作站中使用的内存类型（pc2700、pc3200 等）。有谁知道如何提取这些信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T22:20:57.780

在`WMI`，使用[`Win32_PhysicalMemory`](http://msdn.microsoft.com/en-us/library/aa394347(VS.85).aspx)。

在`Linux`，使用`dmidecode -t memory`。

# delphi - 如何防止 Delphi MDI 应用程序显示最大化子项的标题

> ID：567461
> 
> 赞同：1
> 
> 时间：2009-02-19T22:11:28.380
> 
> 标签：delphi, mdi

如何防止 Delphi MDI 应用程序在 MDI 父窗体的标题中显示当前最大化的 MDI 子窗体的标题？

先感谢您！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T02:19:01.983

没有机会对此进行测试，但是：

在子 OnResize 中，测试 WindowState = wsMaximized。如果是，则设置 Caption := '' 如果不是，请根据需要设置标题 - 您需要记住这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T10:07:31.343

按照 mghie 的建议调整 Gerry 的回答：

```
private
  PreviousState: TWindowState;

procedure TMDIChildForm.FormResize(Sender: TObject);
begin
  if PreviousState = wsMaximized then
    Caption := 'Desired Caption'
  else if WindowState = wsMaximized then
    Caption := '';
  PreviousState := WindowState;
end; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T06:06:52.590

你不能。MDI 是过时的东西，对它的支持已被弃用（实际上，它已经存在多年了）。由于弃用，限制可能永远不会改变。

# visual-studio - Subversion 中代码提升和功能分支的最佳设置？

> ID：567466
> 
> 赞同：2
> 
> 时间：2009-02-19T22:12:32.560
> 
> 标签：visual-studio, svn, version-control, vb6

我们是一个 4 人的团队，几年来并没有远离我们的舒适区，但我们正在成长，并希望与时俱进。我的任务是寻找实现持续集成的最佳方法（自动构建、代码维护分支和新功能等）。我们正在考虑从 SourceSafe 2005 切换到 Subversion 来处理我们的版本控制。根据我的阅读，Subversion 是进行代码升级、分支和分支之间合并的更好选择。我们可能会使用以下产品：

*   VisualSVN 服务器
*   TortoiseSVN（用于与 Windows 资源管理器集成）
*   VisualSVN（用于与 Visual Studio 2005 集成）
*   SVNVB6（用于与 Visual Basic 6 集成）
*   最终建造者

为代码提升和功能分支组织存储库的最佳方式是什么？这是我们当前 SourceSafe 结构的示例：

*   根
    *   Visual Studio 2005 项目
        *   项目名称
            *   解决方案文件、项目文件和代码文件在这里
            *   \垃圾桶
                *   \发布
                    *   在此处编译发布二进制文件
    *   Visual Basic 6 项目
        *   项目名称
            *   项目文件和代码文件在这里
            *   在此处编译的二进制文件（.dll、.exe、.ocx）
    *   文档
        *   文档文件在这里

我们应该这样结构吗？

*   根
    *   分支（每个从树干分支）
        *   开发.FeatureA
        *   开发.FeatureB
        *   测试（使用 FinalBuilder 每晚构建 ???）
        *   生产（使用 FinalBuilder 每晚构建 ???）
        *   Production.BugFixA（反向集成到生产分支、测试分支和主干？？？）
    *   标签
        *   Development.v1（在每次成功构建后标记）
        *   开发.v2
        *   开发.v3
        *   测试.v1
        *   测试.v2
        *   测试.v3
        *   生产.v1
        *   生产.v2
        *   生产.v3
    *   主干（开发代码 - 每晚使用 FinalBuilder 构建）
        *   Visual Studion 2005 项目
            *   项目名称
                *   解决方案文件在这里
                *   项目名称
                    *   项目文件和代码文件在这里
        *   Visual Basic 6 项目
            *   项目名称
                *   项目文件和代码文件在这里

由于我们的大部分软件仍然是 COM (VB6) 并且需要注册（使用 regsvr32），所以二进制文件是否应该受版本控制？当我们需要在不同的分支上工作时（可能具有不同的 COM 兼容性），我们应该如何处理注册/注销组件？

我们离题了吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T08:50:20.610

首先，不要使用顶级主干分支标签，使用每个项目的主干分支标签，如下所示：

```
/Projects
  /CashCowProject
    /branches
    /tags
    /trunk
      /vs
      /doc 
```

这意味着跟踪器工具可以查看[http://svn/Projects/CashCowProject](http://svn/Projects/CashCowProject)并查看该项目的所有活动，而不会获得任何其他项目的任何活动。它还强制您控制项目之间的引用，这意味着您的顶级项目不会在没有主干条目的情况下更改。

当项目相互引用时，使用 svn:externals 从您需要的库项目中提取标签。使用红豆书中描述的供应商分支来处理 3rd 方库，甚至是二进制文件。

在 SVN 中保存库二进制文件是可以的。可能想为此考虑一个单独的存储库，尽管我们不这样做。

对于代码提升，为特定版本保留一个稳定的分支，并且只从主干合并到该分支，然后从该分支进行标记。这将为您提供每个版本中内容的可审核记录。

如果您不打算提取源代码并构建它，您可以将 COM 二进制文件保留在其中。您可以为 tortoise 编写一个升级后脚本，该脚本将注册它找到的任何 COM 对象。

# javascript - 为什么我的 onclick 处理程序找不到它的父节点？

> ID：567469
> 
> 赞同：3
> 
> 时间：2009-02-19T22:13:27.987
> 
> 标签：javascript, html

为什么下面的 onclick 处理程序会触发“elem.parentNode 不是函数”错误？

```
<html>
  <head>
   <script type="text/javascript">
     function getParent(elem) {
       var parent = elem.parentNode();
     }
   </script>
  </head>

  <body>
    <div style="border: solid black 2px">
      <span onclick="getParent(this)">hello</span>
    </div>
  </body>
</html> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T22:16:53.000

你的问题是 parentNode 不是一个函数。尝试删除`()`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T22:18:15.400

parentNode 是一个属性，而不是一个函数。

```
var parent = element.parentNode; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T22:16:55.887

因为`parentNode`不是函数？`elem.parentNode`不带括号试试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T22:18:42.280

它应该是

```
 function getParent(elem) {
   var parent = elem.parentNode;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T22:17:24.530

这*不是*一个函数。这是一个财产。去掉括号。

var parent = elem.parentNode;

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T22:17:39.583

parentNode 是属性而不是函数。删除 () 它应该可以工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T22:17:51.283

parentNode 不是一个函数，它是一个属性。

# java - 用于异步调用的 Apache Camel

> ID：567478
> 
> 赞同：5
> 
> 时间：2009-02-19T22:15:52.270
> 
> 标签：java, asynchronous, jms, messaging, apache-camel

将 Apache Camel 用于异步请求是否有意义？或者我应该使用 JMS 服务器使用简单的 MoM。我不需要任何企业集成模式。

任何帮助都会很有用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-24T11:28:06.593

即使您还没有使用任何企业集成模式（还）——Camel 非常擅长将消息传递到您的应用程序[中，同时隐藏所有中间件 API](http://camel.apache.org/hiding-middleware.html)，同时让您通常只需更改一两个字符串即可轻松地在所有[各种不同的中间件技术](http://camel.apache.org/components.html)之间切换.

例如，查看这些链接以获取更多详细信息

*   [POJO生产](http://camel.apache.org/pojo-producing.html)
*   [POJO 消费](http://camel.apache.org/pojo-consuming.html)
*   [弹簧远程](http://camel.apache.org/spring-remoting.html)

有一个[POJO 消息传递示例](http://camel.apache.org/pojo-messaging-example.html)，它将引导您完全使用 Camel 作为将消息集成到您的 POJO 中的一种方式

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-11T07:49:09.157

添加到其他答案：Camel 还为常见的编程任务提供了许多非常有用的实用程序。

我已经 8 个月没有使用它了，但我将在我的下一个项目中使用它……下周 sprint 0。

也许，我很快也会对最新的骆驼有更多的问题。

快乐编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-02T05:45:40.763

使用 Camel 进行异步调用确实很有意义，尤其是因为它可以干净地处理回调。例如：

```
template.asyncCallback("activemq:queue:longTasks", request, callback); 
```

其中回调是 org.apache.camel.spi.Synchronization 对象，它处理响应和失败条件。

# .net - 连接到 .Net 软件程序并进行交互

> ID：567481
> 
> 赞同：1
> 
> 时间：2009-02-19T22:16:11.897
> 
> 标签：.net, interop, add-on

我不知道怎么会问这个问题，但我想知道是否有一种方法可以访问纯粹用 .Net 编写的正在运行的进程并与其内存空间和活动对象进行交互。

我为 2 个销售点软件包进行插件开发，并试图弄清楚这一点以分析外部窗口中的数据输入。任何信息或见解将不胜感激。

对我要问的问题进行不同的解释...基本上，有没有办法使用 system.diagnostics.processmodule 并获取具有特定名称的正在运行的进程，然后将其实例化为应用程序，然后进行挖掘进入它以找到一个特定的静态对象，并使用它？

- - 额外的 - -

我注意到有人提到了反射......这确实可能是我想要问的......我唯一需要的是“反射”一个过程，找到一个特定的静态类，然后将该类转换为“对象”，所以我可以访问它的属性......也许这更有意义。

不幸的是，我正在尝试使用的程序在一段时间内不会有任何形式的插件架构，并且认为我可以使用某种疯狂的 P/Invoke 或反射想法来做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:25:40.390

查找[.NET 远程处理](http://msdn.microsoft.com/en-us/library/kwdt6w2k(vs.71).aspx)。

简单地说，您可以创建一个窗口服务或控制台应用程序来创建一个对象，一个您创建的自定义对象。然后，您可以在 TCP 端口上注册。

然后你有一个客户端服务器可以访问相同的 TCP 端口，甚至可以在 2 台不同的 PC 上，并与对象交互。

这样做的方法是创建一个客户端对象知道并且服务器实现的接口。

您可以让 2 个控制台应用程序相互通信。这是一个关于如何做到这一点的问题，它并不完全正确，但应该让你指向正确的方向[。](https://stackoverflow.com/questions/451228/how-to-send-input-to-the-console-as-if-the-user-is-typing)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:33:43.287

另一种选择是，如果您不需要实际更改内容而是纯粹寻找统计信息，则可以创建一些自定义性能计数器，然后使用另一个应用程序监控这些计数器。 [监控性能阈值](http://msdn.microsoft.com/en-us/library/wz3d1wc5.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T22:46:51.527

.net 中有一个专门为此设计的命名空间，

```
System.AddIn 
```

您需要添加对 dll 的引用（仅在 .net 3.5 中可用）。你可以使用这个类来开发一个类型安全的插件架构，它支持版本控制和外部代码的隔离。

在 MSDN 上查看一些示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T00:38:42.660

不确定它是否会完全符合您的要求，但如果您正在处理的是 Windows 应用程序， [Hawkeye](http://www.acorns.com.au/Projects/Hawkeye/)会让您在运行时检查和调整 .NET 对象：

[http://www.acorns.com.au/Projects/Hawkeye/](http://www.acorns.com.au/Projects/Hawkeye/)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-19T22:21:42.943

很容易，没有。

但它可以自动化 WinDBG（或其命令行版本），以及 .NET 的 SOS 扩展库，这可能是可能的。

从根本上说，您需要一个专为可扩展性/插件/自动化设计的应用程序。

另一种可能性是利用 .exe 与 .dll 几乎相同的事实，并且有一个应用程序将 exe 加载为类库，然后启动它。反射将是可能的。

# java - LDAP 最佳实践

> ID：567482
> 
> 赞同：5
> 
> 时间：2009-02-19T22:16:16.327
> 
> 标签：java, jakarta-ee, ldap

我对在基于 Java 的 Web 应用程序中使用 LDAP 身份验证的最佳实践感兴趣。在我的应用程序中，我不想存储用户名\密码，只存储一些 id。但是，如果 LDAP 目录中存在任何附加信息（姓名、姓氏），我想检索它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T23:05:01.327

我的团队使用 LDAP 作为一种标准的身份验证方式。基本上，我们将 LDAP 视为任何其他数据库。

要将用户添加到应用程序，您必须从 LDAP 中选择一个或在 LDAP 中创建它；当用户从应用程序中删除时，它会保留在 LDAP 中，但无法访问应用程序。

您基本上只需要在本地存储 LDAP 用户名。您可以每次都从 LDAP 读取 LDAP 数据（电子邮件、部门等），或者以某种方式将其拉入应用程序，尽管从 LDAP 读取数据可能更简单、更智能，因为 LDAP 数据可以更改。当然，如果您需要报告或广泛使用 LDAP 数据，您可能希望从 LDAP 中提取它（手动或使用批处理任务）。

好消息是一旦用户在 LDAP 中被禁用，它会同时在所有应用程序中被禁用；此外，用户在所有应用程序中都具有相同的凭据。在企业环境中，有一堆内部应用程序，这是一个主要优点。不要只为一个应用程序的用户使用 LDAP；在那种情况下没有真正的好处。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-11-02T08:35:21.330

有关 LDAP 的一般最佳实践，请参阅[“LDAP：编程实践”](http://www.ldapguru.info/ldap/ldap-programming-practices.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T23:27:04.877

如果您有多个基于 Web 的应用程序并希望使用 LDAP 身份验证，那么预打包的单点登录解决方案可能比创建自己的 LDAP 身份验证更好。[CAS](http://www.jasig.org/CAS)支持 LDAP 身份验证，可以拉回应用程序所需的数据。

在我的大学里，我们实际上已经将 CAS 实现为针对我们的 Active Directory 服务器的单点登录。我们还利用 CAS 来验证我们的 J2EE 应用程序，并且正在努力使用 CAS 来验证我们的 PHP 应用程序。

我们使用 AD 来保存域的用户。根据用户类型，有特定的 OU。每个用户都有一个唯一的 ID，恰好是他们的学生/员工 ID，因此应用程序可以将其用作其数据库中的主键。我们的 PHP 应用程序有一个数据库驱动的授权方法。J2EE 应用程序的授权来​​自 LDAP 中的一个值。

祝你的申请好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-21T02:57:36.173

那么，您希望用户只输入 ID，然后从 LDAP 中获取其余信息吗？这很容易。

1.  创建 LdapInitial 上下文并连接到 LDAP
2.  搜索 ID（它应该存储为某个属性值）——例如 (&(userid=john)(objectClass=user))——这意味着“userid=john AND objectClass=user”
3.  SearchResult 对象将包含所有属性（或您询问的属性）

一些 LDAP 实现（著名的 MS ActiveDirectory LDAP）不允许您与匿名用户连接。对于那些您需要有技术用户名/密码才能连接的用户。

如上所述，当您有许多应用程序时，LDAP 通常是有意义的。

PS 要感受 LDAP 是什么，请尝试 Apache Directory Studio。

# nunit - NUNIT 忽略了我的测试？为什么？

> ID：567491
> 
> 赞同：12
> 
> 时间：2009-02-19T22:18:08.067
> 
> 标签：nunit

我有一个非常简单的测试类，如下所示。

出于某种原因，我的测试被 GUI 忽略并变成黄色。

我已将框架和运行器更新到 2.4.8，因为我认为这可能是版本之间的差异问题。

```
using System;
using NUnit.Framework;

namespace TestRunner
{
    [TestFixture]
    class TestMe
    {

        [Test]
        public void TestBob()
        {
            Assert.IsTrue(true);
        }
   }
} 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-19T22:21:15.143

您的 TestMe 课程需要公开。

下面是一些关于用 TestFixture 属性标记的类的要求的[文档](http://www.nunit.org/index.php?p=testFixture&r=2.4.8)，讨论了在哪些条件下类可能不被识别为测试夹具。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T22:21:51.587

您没有为您的课程指定访问修饰符；因此，默认情况下您的课程是内部的，NUnit 看不到您的课程。

如果您为包含测试的类指定**公共访问修饰符，那么它应该可以工作：**

```
[TestFixture]
public class TestMe
{
    [Test]
    public void TestBob()
    {
       Assert.AreEqual ("Bob", "Bob");
    }
} 
```

# sql-server-2005 - 你能有从下拉列表到文本框的级联报告参数吗？

> ID：567495
> 
> 赞同：1
> 
> 时间：2009-02-19T22:19:09.157
> 
> 标签：sql-server-2005, reporting-services, cascadingdropdown

我有一个带有三个参数的 SQL Server 2005 Reporting Services 报告，我想在它们之间实现某种依赖关系。

*   第一个参数是 DateRange，它是一个包含不同天数的下拉列表，用于创建从当前日期开始的日期范围。它将有一个“自定义”值，用于标记何时应使用开始和结束日期时间参数。
*   第二个和第三个是日期时间参数，用户输入某种有效的日期时间字符串表示或单击日历框并选择该方式，即“02/20/2009”

我遇到的问题是，我偶然发现的依赖参数的所有材料都显示了级联关系，其中存在基于确定下一个下拉列表的查询的下拉列表。

**如何从使用查询的下拉列表级联到非查询的 DateTime 文本框？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T03:42:13.563

这可能不是您正在寻找的答案，但我通过将报表嵌入网页（使用 ReportViewer 控件）解决了这个（和其他）问题。我使用 AJAX 以在 Reporting Services 中极其困难的方式跨下拉列表级联值，然后将参数传递给代码隐藏中的报告。

我发现这要容易得多，因为我不受如何创建输入控件的限制。不过，YMMV。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T14:04:07.503

将默认值设置为表达式。我相信，默认任何以等号开头的默认值都会强制报告将当前参数视为依赖于当前参数之上的所有参数。

# sql-server - 在源代码管理中部署 SQL Server 脚本的最佳方式是什么？

> ID：567496
> 
> 赞同：1
> 
> 时间：2009-02-19T22:19:15.787
> 
> 标签：sql-server, version-control, deployment

我正在尝试将我们公司的数据库对象存储在源代码管理中。我们将在源代码控制程序中使用 Aldon LM。将我们创建的脚本从源代码控制自动 ***部署***到 SQL Server 环境的最佳方式是什么？

对于我们的 .Net Web 应用程序，我们已将 Aldon 配置为将我们的代码推送到 Web 服务器并运行 MSBuild。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:21:13.770

我们有程序（ant hill pro for one）通过源代码控制系统，检索所有必要的 sql 脚本并将它们编译到一个文件中。每个版本都有一个分支，因此只有该分支的分支才会被拉取。我认为巡航控制可以做同样的事情，但我不知道这是怎么做到的。

然后，我们可以一次执行所有更新，而不必担心会丢失一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:37:43.480

在您的解决方案中打开一个数据库项目以管理所有 SQL 代码，例如存储过程。这有几个优点：

*   您的 SQL 可以像其他 conde 一样受版本控制
*   您可以在多个过程中轻松查找/替换文件操作
*   您可以将 SQL 保存在有意义且系统的文件夹层次结构中

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T22:46:39.497

安装 VS Team System 数据库版，现在包括（可添加到）开发者版。

这有工具可以确定哪些脚本应用于数据库以更新它以匹配参考数据库，并且（如果您的 SCM 与 VS 集成）还将处理跟踪所有这些脚本和项目中的状态。

# .net - 对于被困在 1.1 世界中的 dotnet 3.5 编码器，有什么可以让他们的生活更轻松吗？

> ID：567511
> 
> 赞同：6
> 
> 时间：2009-02-19T22:24:33.373
> 
> 标签：.net, linq, generics, .net-1.1

我必须花费相当多的时间在 dotnet 1.1 上进行开发，而且我相信任何处于类似位置的人都会喜欢，我使用 dotnet 2.0 及更高版本的次数越多，回到早期就越烦人版本。当我想使用泛型并且理想情况下使用 Linq 时，我越来越厌倦了使用 ArrayLists 之类的东西。

任何人都可以推荐任何工具、技术、库或任何东西来帮助使 dotnet 1.1 的生活更容易忍受，特别是参考上面提到的集合处理缺点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T22:28:58.573

我最近加入了一家使用 1.1 进行编码的公司。我决定利用自己的时间将该应用程序移植到 .Net 3.5 并将其呈现给小组。因此，我们即将发布一个在 VS2008 中可以很好打开的 3.5 版本。可能不是您要查找的内容，但这就是我处理相同问题的方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T22:30:54.607

[工具：在http://support.microsoft.com/lifecycle/?p1=1249](http://support.microsoft.com/lifecycle/?p1=1249)只有一个 Microsoft 的 .NET 1.1 Support Liftcycle

这表明 .NET 1.1 已经进入“扩展”（即有限）支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T22:30:09.740

嗯，将您必须维护的 .NET 1.1 应用程序升级到 .NET2.0 不是一种选择吗？

2004 年，我开始开发 .NET 应用程序。这是在 .NET 1.1 中。

去年，我们决定使用 VS.NET 2008 将该应用程序“转换”为 .NET2.0，并且没有遇到任何重大问题。

所有现有代码仍在运行，当必须对项目进行新开发时，我们可以利用所有 .NET2.0 的优势（而且，由于我们使用的是 VS.NET 2008，我们还可以利用 C# 3.0 好东西（自动属性，lambda，...）。

我总是使用“将警告设置为错误”，对于这个项目，我必须禁用此功能，因为 .NET 1.1 框架的某些部分已被标记为“已过时”。尽管这些类仍然有效，但编译器会生成一个警告，指出类 X 已过时，您应该改用类 Y。
但是，这不是一个大问题，因为您可以逐渐响应这些消息并调整您的代码。

# c - 为什么“%.3i”打印前导零？

> ID：567513
> 
> 赞同：1
> 
> 时间：2009-02-19T22:25:37.287
> 
> 标签：c, printf, text-formatting

今天的一些代码有点意外。我在 AIX 上编译它，将警告级别设置为 anal 以查看可能潜伏的恶意问题。从代码中爬出了一些新的东西。

```
 1540-2837 (W) '0' flag is disregarded when combined with 
               precision and 'i' printf format. 
```

在查看了有问题的行之后，我整理了一个小程序来重现它。在几个平台上对其进行测试表明它不是特定于 AIX 的。

下面的第一个 printf 模仿了程序中的内容。

```
#include <stdio.h>    
int main(void)
{
    int x = 3;

    printf("Format 0.3i <%0.3i>\n", x);  // prints 003, and AIX does a warning
    printf("Format  .3i <%.3i>\n", x);   // prints 003, with no warning
    printf("Format   3i <%3i>\n", x);    // prints   3, with no warning.

    return 0;
} 
```

通常，如果需要前导零，“03i”格式会很好地完成这项工作。

**“%.3i”在这里的真正含义是什么？**

**为什么它有它的行为？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T22:29:11.317

.X，其中 x 是一个数字，表示“打印至少 X”位，因此 %.3i 表示至少打印 3 位。如果数字小于 100，则用零填充。

来自[printf 上的文档](http://www.cplusplus.com/reference/clibrary/cstdio/printf.html)

“对于整数说明符 (d, i, o, u, x, X)：precision 指定要写入的最小位数。如果要写入的值小于此数字，则结果用前导零填充。即使结果更长，值也不会被截断。精度为 0 表示不为值 0 写入任何字符。

还有另一个概念，“宽度”（例如“%3i”），它导致输出一定数量的字符（不一定是数字，而指定的 0 用于表示那些字符应该是 0，如在“003”中）而不是空格，如 "3")

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:30:44.153

来自`man 3 printf`：

> 如果使用数字转换（d、i、o、u、x 和 X）给出精度，则忽略 0 标志。

`.`指定精度，因此忽略`0`。至于“为什么？” 其中，您必须询问 C 标准的作者 :)

# java - 为java开发（文件）交换格式

> ID：567516
> 
> 赞同：0
> 
> 时间：2009-02-19T22:26:28.593
> 
> 标签：java, serialization, binary, format

我想提出一种二进制格式，用于以 POF（普通旧文件；））的形式在应用程序实例之间传递数据。

先决条件：

1.  应该是跨平台的
2.  要持久化的信息包括单个 POJO 和任意字节 []（实际上是文件，POJO 将其名称存储在字符串 [] 中）
3.  只需要顺序访问
4.  应该是一种检查数据一致性的方法
5.  应该小而快
6.  应该防止使用存档器+记事本的普通用户修改数据

目前我正在使用 DeflaterOutputStream + OutputStreamWriter 和 InflaterInputStream + InputStreamReader 来保存/恢复使用 XStream 序列化的对象，每个文件一个对象。读取器/写入器使用 UTF8。现在，需要扩展它以支持前面描述的。我对格式的想法：

```
{serialized to XML object}
{delimiter}
{String file name}{delimiter}{byte[] file data}
{delimiter}
{another String file name}{delimiter}{another byte[] file data}
...
{delimiter}
{delimiter}
{MD5 hash for the entire file} 
```

1.  这看起来很正常吗？
2.  您将使用什么作为分隔符以及如何确定它？
3.  在这种情况下计算 MD5 的正确方法是什么？
4.  您建议阅读有关该主题的哪些内容？

TIA。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T08:20:52.373

它看起来很疯狂。

*   为什么要发明一种新的文件格式？
*   为什么要试图阻止只有愚蠢的用户更改文件？
*   为什么使用二进制格式（难以压缩）？
*   为什么使用接收时无法解析的格式？（接收方必须接收整个文件才能对文件采取行动。）
*   XML 已经是一种可压缩的序列化格式。所以你正在序列化一个序列化的格式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T22:30:58.833

模型的序列化（如果您使用 MVC）不是另一种方式吗？如果可能的话，我更喜欢使用语言（或标准库）中的东西，而不是自己动手。我能看到的唯一问题是文件大小可能比你想要的大。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T08:03:50.673

1）这看起来很正常吗？

它看起来相当理智。但是，如果您要发明自己的格式而不是仅仅使用[Java 序列化](http://java.sun.com/developer/technicalArticles/Programming/serialization/)，那么您应该有充分的理由。你有什么好的理由（在某些情况下确实存在）？使用 XStream 的标准原因之一是使结果易于阅读，而二进制格式会立即丢失。您是否有充分的理由使用二进制格式而不是人类可读的格式？请参阅[这个问题](https://stackoverflow.com/questions/568671)，了解为什么人类可读性好（和坏）。

把所有东西都放在一个签名的罐子里不是更容易吗？已经有[标准的 Java 库](http://java.sun.com/docs/books/tutorial/deployment/jar/apiindex.html)和[工具](http://java.sun.com/docs/books/tutorial/deployment/jar/)可以执行此操作，并且您可以获得压缩和验证。

2）您将使用什么作为分隔符以及如何确定它？

我会在块之前显式存储每个块的长度，而不是分隔符。它同样简单，并且可以防止您在分隔符自行出现时将其转义。

3）在这种情况下计算MD5的正确方法是什么？

这里有[示例代码](http://www.java2s.com/Tutorial/Java/0490__Security/MD5MessageDigestyourmessage.htm)，看起来很合理。

4）关于这个主题，你建议阅读什么？

关于序列化的主题？我读过有关 Java 序列化、[JSON](http://www.json.org/)和 XStream 序列化的信息，因此我了解了它们的优缺点，尤其是人类可读文件的好处。我还会查看一个经典的文件格式，例如来自 Microsoft，以了解在每个字节都很重要的时代可能的设计决策，以及这些是如何扩展的。例如：[WAV 文件格式](http://ccrma.stanford.edu/courses/422/projects/WaveFormat/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-21T10:05:59.827

让我们看看这应该很简单。

> *先决条件：*
> 
> *0.应该是跨平台的*
> 
> *1\. 要持久化的信息包括单个 POJO 和任意 byte[]s（实际上是文件，POJO 将其名称存储在 String[] 中）*
> 
> *2\. 只需要顺序访问*
> 
> *3.应该是一种检查数据一致性的方法*
> 
> *4.应该小而快*
> 
> *5.应该防止普通用户使用存档器+记事本修改数据*

好吧，你猜怎么着，你已经拥有它了，它已经内置在平台中了：**[对象序列化](http://java.sun.com/javase/6/docs/technotes/guides/serialization/index.html)**

如果您需要减少在线中发送的数据量并提供自定义序列化（例如，您可以为给定对象仅发送 1,2,3 而不使用属性名称或类似的东西，并以相同的顺序读取它们, ) 你可以以某种方式使用这个[“隐藏功能”](https://stackoverflow.com/questions/15496/hidden-features-of-java/142676#142676)

如果你真的需要它在“纯文本”中，你也可以对其进行编码，它需要几乎相同数量的字节。

例如这个bean：

```
import java.io.*;
public class SimpleBean implements Serializable  { 
    private String website = "http://stackoverflow.com";
    public String toString() { 
        return website;
    }
} 
```

可以这样表示：

```
rO0ABXNyAApTaW1wbGVCZWFuPB4W2ZRCqRICAAFMAAd3ZWJzaXRldAASTGphdmEvbGFuZy9TdHJpbmc7eHB0ABhodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20= 
```

[看到这个答案](https://stackoverflow.com/questions/134492/how-to-serialize-an-object-into-a-string/134918#134918)

此外，如果您需要一个健全的协议，您还可以查看Google 的内部交换格式[Protobuf 。](http://code.google.com/p/protobuf/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T22:36:12.143

您可以使用 zip (rar / 7z / tar.gz / ...) 库。许多存在，大多数都经过良好测试，它可能会为您节省一些时间。

不过可能没那么有趣。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-24T20:33:15.333

我同意这听起来并不像您需要一种新格式或二进制格式。如果您真的想要二进制格式，为什么不首先考虑其中一个：

*   二进制 XML（快速信息集，Bnux）
*   黑森州
*   谷歌数据包缓冲区

但除此之外，许多文本格式也应该可以正常工作（或者可能更好）；更易于调试，广泛的工具支持，压缩到与二进制大致相同的大小（二进制压缩效果很差，并且信息论表明，对于相同的有效信息，可以实现相同的压缩率——这在我的测试中是正确的）。

所以也许还要考虑：

*   Json 效果很好；通过 base64 提供二进制支持（例如，[http://jackson.codehaus.org/](http://jackson.codehaus.org/)）
*   XML 也不错；高效的流解析器，一些支持 base64（[http://woodstox.codehaus.org/](http://woodstox.codehaus.org/)，“org.codehaus.stax2.typed.TypedXMLStreamReader”下的“类型化访问 API”）。

所以听起来你只是想建立自己的东西。作为一种爱好，这没什么错，但如果是这样，你需要这样考虑。这可能不是您正在构建的系统的要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T09:00:11.617

[Bencode](http://en.wikipedia.org/wiki/Bencode)可能是要走的路。

这是 Daniel Spiewak 的[出色实现](http://www.codecommit.com/blog/java/bencode-stream-parsing-in-java)。

不幸的是，bencode 规范不支持 utf8，这对我来说是个大问题。

稍后可能会谈到这一点，但目前 xml 似乎是一个更好的选择（将 blob 序列化为 Map）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T21:02:39.100

也许您可以解释这比使用现有文件格式（如 JAR）更好。

这种类型的大多数标准文件格式只使用 CRC，因为它的计算速度更快。如果要防止故意修改，MD5 更合适。

# java - 基于 HTTPS 的简单 Java Web 服务客户端

> ID：567525
> 
> 赞同：1
> 
> 时间：2009-02-19T22:29:17.387
> 
> 标签：java, xml, web-services, https

我正在通过 HTTPS Web 服务连接到一个简单的 XML 并获得安全异常。我的问题是你是否认为这是因为网络服务器上的证书，所以我应该与服务器管理员交谈，或者我的客户端代码是否应该处理这个问题。我很想听听是否有人遇到并解决了这个问题。解决方案是在客户端还是服务器端找到？下面是例外。

```
Caused by: sun.security.validator.ValidatorException: Violated path length constraints
at sun.security.validator.SimpleValidator.checkBasicConstraints(SimpleValidator.java:243)
at sun.security.validator.SimpleValidator.checkExtensions(SimpleValidator.java:158)
at sun.security.validator.SimpleValidator.engineValidate(SimpleValidator.java:143)
at sun.security.validator.Validator.validate(Validator.java:202)
at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(DashoA12275)
at com.sun.net.ssl.internal.ssl.JsseX509TrustManager.checkServerTrusted(DashoA12275) 
```

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T23:30:58.407

可能值得先用[openssl测试客户端](http://swamp.homelinux.net/blog/index.php/2008/05/15/openssl-s_client/)

```
openssl s_client -connect yourserver.com:443 
```

查看手册页以获取更多选项。

当您使用网络浏览器访问它时会发生什么？Firefox 应该为您提供相当多的有关服务器证书的信息。

虽然在客户端证书身份验证之后看起来不像您，但[此示例](http://vafer.org/blog/20061010073725)确实向您展示了如何使用自定义 SSLSocketFactory。它也可以静态设置 - 如果您无权访问连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:43:55.137

从堆栈跟踪中，我猜这是服务器证书的问题（跟踪源自“checkServerTrusted”调用）。您可能想尝试使用 Firefox 等 Web 浏览器连接到该 URL，以查看是否收到包含更多详细信息的 SSL 错误。

# cpu - 多核架构的出现会影响我作为软件开发人员吗？

> ID：567528
> 
> 赞同：10
> 
> 时间：2009-02-19T22:29:58.710
> 
> 标签：cpu, multicore, paradigms

作为一个主要处理高级编程语言的软件开发人员，我不确定我能做些什么来适当地关注即将到来的多核计算机的普遍存在。我主要编写普通且要求不高的应用程序，但我认为了解是否需要更改任何编程范式甚至语言以掌握未来很重要。

因此，我的问题是：
`How to deal with increasing multicore presence in day-by-day hacking?`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T22:47:19.263

Herb Sutter 在 2005 年写过：[免费午餐结束：软件中向并发的根本转变](http://www.gotw.ca/publications/concurrency-ddj.htm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T23:40:33.753

大多数问题不需要大量的 CPU 时间。确实，单核对于许多用途来说已经足够快了。当您确实发现您的程序太慢时，首先对其进行分析并查看您选择的算法、体系结构和缓存。如果这还不够，请尝试将问题划分为单独的过程。通常这只是为了隔离故障而值得做，这样您就可以了解每个进程的 CPU 和内存使用情况。此外，通常每个进程将在特定内核上运行并充分利用处理器缓存，因此您不必承受保持缓存行一致的大量性能开销。如果您进行多进程设计，但仍然发现问题需要的 CPU 时间比您拥有的机器多，那么您可以很好地扩展它在集群上运行。

在某些情况下，您需要在同一地址空间内使用多个线程，但要注意线程很难正确处理。竞争条件，尤其是在非安全语言中，有时需要数周才能调试；通常，简单地添加跟踪或在调试器下运行将更改足够的时间以隐藏问题。简单地将锁放在任何地方通常意味着您会获得大量的锁定开销，有时还会出现如此多的锁争用，以至于您并没有真正获得您希望的并发优势。即使您拥有正确的锁定，您也需要分析以调整缓存一致性。最终，如果您想真正调整一些高度并发的代码，您最终可能会看到无锁结构和比当前多线程库中的更复杂的锁定方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T22:34:17.763

了解并发的好处和限制（例如 Amdahl 定律）。

因此，您可以在可能的情况下利用将要开放的获得更高性能的唯一途径。在更简单的方法（futures 和任务库）上发生了许多创新工作，并且重新发现了旧工作（函数式语言和不可变数据）。

免费午餐结束了，但这并不意味着没有什么可利用的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T22:34:06.783

一般来说，对线程非常友好。这是一种可怕的并行化机制，但它就是我们所拥有的。

如果您确实使用 .NET，请查看 Parallel Extensions。它们使您可以轻松完成许多并行编程任务。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T22:34:25.580

要从一个核心中受益，您应该考虑并行化您的代码。多线程、不可变类型和最少的同步是您的新朋友。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T22:35:17.637

我认为这将取决于您正在编写什么样的应用程序。

某些应用程序比其他应用程序更受益于它们在多核 cpu 上运行的事实。如果您的应用程序可以从多核事实中受益，那么您应该准备好进行并行。免费午餐结束；也就是说：在过去，当一个新的 cpu 发布时，您的应用程序会变得更快，而您不必在应用程序中付出任何努力来获得额外的速度。现在，要利用多核 cpu 提供的功能，您必须确保您的应用程序可以利用它。那就是：你必须看看哪些任务可以多线程/并发执行，这给表带来了一些问题......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T22:40:59.637

学习 Erlang/F#（取决于您的平台）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-20T06:41:46.423

*   更喜欢不可变的数据结构，它们的使用使软件不仅在并发程序中更容易理解。

*   学习使用您的语言的并发工具（例如 java.util.concurrent、[JCIP](http://jcip.net/)）。

*   学习一门函数式语言（例如[Haskell](http://www.haskell.org/)）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T22:52:46.910

我被问过同样的问题，答案是，“这取决于”。如果你的 Joe Winforms，也许不会那么多。如果您编写的代码必须是高性能的，是的。我可以看到并行编程的最大问题之一是：如果某些东西不能并行化，而你撒谎并告诉运行时并行执行，它不会崩溃，它只会做错事，你会得到垃圾结果并责怪框架。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T23:58:19.043

学习 C 和 C++ 代码的 OpenMP 和 MPI。

OpenMP 也适用于其他语言以及我想的 Fortran。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T00:41:15.773

编写更小的程序。

其他代码语言/风格会让你更好地执行多线程（尽管多线程在任何语言中仍然非常困难），但对于普通开发人员来说，恕我直言，最大的好处是能够同时执行许多较小的程序来完成一些更大的任务。

因此，养成将问题分解为可以随时运行的独立组件的习惯。

您还将构建更多可维护的软件。

# asp.net - 如何在 http 和 https 之间共享 asp.net 会话

> ID：567535
> 
> 赞同：8
> 
> 时间：2009-02-19T22:31:01.533
> 
> 标签：asp.net, ssl, iis-6, https

我读到在 https 连接下运行的页面无法与在常规 http 下运行的另一个页面（或相同的页面）共享 InProc 会话（基于 cookie）。我的站点在 Server 2003、IIS 6 和 .Net 2.0 上运行。

经过一些实验后，似乎在通过 https 连接时在会话中存储数据的页面可以随后访问数据，即使在纯 http 下运行也是如此。

那么，是否有可能或者我应该去寻找 SSL 配置中的缺陷？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-19T22:49:25.653

来自[MSDN](http://msdn.microsoft.com/en-us/library/aa302426.aspx)：

> 当用户在安全区域和公共区域之间来回移动时，ASP.NET 生成的会话 cookie（或 URL，如果您启用了无 cookie 会话状态）以明文形式随它们一起移动，但身份验证 cookie 永远不会通过未加密的 HTTP 传递*只要设置了 Secure cookie 属性，就可以*连接。

`Secure`所以基本上，如果属性设置为，cookie 可以通过 HTTP 和 HTTPS 传递`false`。

我通过将其添加到我的`Global.asax`文件中避免了这个问题：

```
void Session_Start(object sender, EventArgs e) 
{
    if (Request.IsSecureConnection) Response.Cookies["ASP.NET_SessionID"].Secure = false;
} 
```

这意味着如果会话 cookie 是通过 HTTP 创建的，它只能通过 HTTPS 访问。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-11-27T23:00:59.960

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T22:35:13.037

到目前为止，搜索问题并没有引起太多关于它的讨论，仍在寻找。

*编辑*：好的，现在找到一些东西。

是的，如果两组页面都在同一个应用程序/网站中，它似乎可以正常工作。

所以我会继续前进，感到放心。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-09-02T10:09:53.067

如果上述任何解决方案都不起作用，请尝试此操作。经过几天的研究，我已经解决了这个问题。

```
app.UseCookieAuthentication(new CookieAuthenticationOptions
{
    ...
    ...
    CookieSecure = CookieSecureOption.Never
}); 
```

# python - 从 python 脚本以超级用户身份运行命令

> ID：567542
> 
> 赞同：51
> 
> 时间：2009-02-19T22:33:16.440
> 
> 标签：python, subprocess, sudo

因此，我正在尝试使用子进程从 python 脚本中以超级用户身份运行一个进程。在 ipython shell 中类似于

```
proc = subprocess.Popen('sudo apach2ctl restart',
                        shell=True, stdin=subprocess.PIPE,
                        stdout=subprocess.PIPE,
                        stderr=subprocess.PIPE) 
```

工作正常，但只要我把它粘贴到一个脚本中，我就开始得到：`sudo: apach2ctl: command not found`.

我猜这是由于 sudo 在 ubuntu 上处理环境的方式。（我也试过了`sudo -E apche2ctl restart`，`sudo env path=$PATH apache2ctl restart`没用）

所以我的问题基本上是，如果我想以`apache2ctl restart`超级用户身份运行，在需要时提示用户输入超级用户密码，我应该怎么做呢？我无意在脚本中存储密码。

编辑：

我尝试将命令作为字符串传递并标记为列表。在 python 解释器中，我会用一个字符串正确地得到密码提示（在我原来的问题中仍然不能在 python 脚本中工作），一个列表只是给出了 sudo 的帮助屏幕。

编辑2：

所以我收集到的是，虽然当 shell=True 时 Popen 会像字符串一样处理一些命令，但它需要

```
proc = subprocess.Popen(['sudo','/usr/sbin/apache2ctl','restart']) 
```

没有 'shell=True' 让 sudo 工作。

谢谢！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-19T23:11:30.500

尝试：

`subprocess.call(['sudo', 'apach2ctl', 'restart'])`

子进程需要访问真正的 stdin/out/err 才能提示您，并读取您的密码。如果将它们设置为管道，则需要自己将密码输入该管道。

如果你不定义它们，那么它会抓取 sys.stdout 等......

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-19T22:46:38.313

尝试给出 apache2ctl 的完整路径。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2014-07-09T00:06:59.177

另一种方法是让您的用户无密码`sudo user`。

在命令行中键入以下内容：

```
sudo visudo 
```

然后添加以下内容并将其替换为`<username>`您的：

```
<username> ALL=(ALL) NOPASSWD: ALL 
```

这将允许用户执行`sudo`命令而无需询问密码（包括由所述用户启动的应用程序。**虽然这可能是一个安全风险**

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-04-05T10:34:35.960

我将它用于 python 3.5。我是使用**[子](https://docs.python.org/3/library/subprocess.html)**进程模块完成的。使用这样的密码是非常**不安全**的。

subprocess模块将命令作为字符串列表，因此可以使用 split() 预先创建一个列表，[或者](https://docs.python.org/3/library/subprocess.html)**稍后**传递整个列表。阅读文档以获取更多信息。

我们在这里所做的是回显密码，然后使用**管道**通过“-S”参数将其传递给 sudo。

```
#!/usr/bin/env python
import subprocess

sudo_password = 'mysecretpass'
command = 'apach2ctl restart'
command = command.split()

cmd1 = subprocess.Popen(['echo',sudo_password], stdout=subprocess.PIPE)
cmd2 = subprocess.Popen(['sudo','-S'] + command, stdin=cmd1.stdout, stdout=subprocess.PIPE)

output = cmd2.stdout.read().decode() 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-19T22:35:06.687

你必须像这样使用 Popen：

```
cmd = ['sudo', 'apache2ctl', 'restart']
proc = subprocess.Popen(cmd, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE) 
```

它需要一个列表。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-05-29T13:49:24.140

最安全的方法是预先提示输入密码，然后将其输入命令。提示输入密码将避免将密码保存在代码中的任何位置，并且它也不会显示在您的 bash 历史记录中。这是一个例子：

```
from getpass import getpass
from subprocess import Popen, PIPE

password = getpass("Please enter your password: ")
# sudo requires the flag '-S' in order to take input from stdin
proc = Popen("sudo -S apach2ctl restart".split(), stdin=PIPE, stdout=PIPE, stderr=PIPE)
# Popen only accepts byte-arrays so you must encode the string
proc.communicate(password.encode()) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-03-15T16:49:49.427

我尝试了所有解决方案，但没有奏效。想用 Celery 运行长时间运行的任务，但对于这些我需要用 subprocess.call() 运行 sudo chown 命令。

这对我有用：

要添加安全环境变量，请在命令行中键入：

```
export MY_SUDO_PASS="user_password_here" 
```

要测试它是否是工作类型：

```
echo $MY_SUDO_PASS
 > user_password_here 
```

要在系统启动时运行它，请将其添加到此文件的末尾：

```
nano ~/.bashrc 
```

* * *

```
#.bashrc
...
existing_content:

  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi
...

export MY_SUDO_PASS="user_password_here" 
```

* * *

您可以稍后在此处添加所有环境变量密码、用户名、主机等。

如果您的变量已准备好，您可以运行：

更新：

```
echo $MY_SUDO_PASS | sudo -S apt-get update 
```

或者安装午夜指挥官

```
echo $MY_SUDO_PASS | sudo -S apt-get install mc 
```

使用 sudo 启动午夜指挥官

```
echo $MY_SUDO_PASS | sudo -S mc 
```

或从 python shell（或 Django/Celery），以递归方式更改目录所有权：

```
python
>> import subprocess
>> subprocess.call('echo $MY_SUDO_PASS | sudo -S chown -R username_here /home/username_here/folder_to_change_ownership_recursivley', shell=True) 
```

希望能帮助到你。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-07-01T20:22:41.213

要以 root 身份运行命令，并在命令提示符处传递密码，您可以这样做：

```
import subprocess
from getpass import getpass

ls = "sudo -S ls -al".split()
cmd = subprocess.run(
    ls, stdout=subprocess.PIPE, input=getpass("password: "), encoding="ascii",
)
print(cmd.stdout) 
```

对于您的示例，可能是这样的：

```
import subprocess
from getpass import getpass

restart_apache = "sudo /usr/sbin/apache2ctl restart".split()
proc = subprocess.run(
    restart_apache,
    stdout=subprocess.PIPE,
    input=getpass("password: "),
    encoding="ascii",
) 
```

# c# - foreach 的奇怪 lock() 行为

> ID：567546
> 
> 赞同：4
> 
> 时间：2009-02-19T22:34:03.740
> 
> 标签：c#, multithreading

所以，这不是我的代码，并且已经缩短以显示行为，但它给出了非常意想不到的结果。

我在一个类中有两个函数和一个锁

```
object mylock = new object();
List<string> temp = new List<string>();

Func1(string)
{
  lock(mylock)
  {
    temp.Add(string);
  }
}

Func2()
{
  lock(mylock)
  {
    temp.ForEach(p => Func1(p));
  }
} 
```

现在，我知道这没有意义，但是当 Func2 被调用时， Func1 不应该死锁吗？在我们的例子中，它执行。谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T22:35:32.597

不，它不应该陷入僵局。

`Func1`如果它被已经持有锁的人调用，则可以获得锁（如`Func2`）

[MSDN doc for lock](http://msdn.microsoft.com/en-us/library/aa664735(VS.71).aspx)解释：

“在持有互斥锁的同时，在同一个执行线程中执行的代码也可以获取和释放锁。但是，在其他线程中执行的代码在锁被释放之前被阻止获取锁。”

锁的目的是防止**不同的线程**访问同一个资源。 `Func1`并且`Func2`在**同一个线程**上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T22:38:40.763

该`lock`语句（封装`Monitor`类）支持线程内的重入（递归），即您可以嵌套调用，它们使用相同的监视器。

其他锁定方法：

*   `Monitor`- 支持递归
*   `ReaderWriterLock`- 支持递归，但速度慢
*   `ReaderWriterLockSlim`- 支持递归，但不鼓励
*   `EventHandle`( `ManualResetEvent`, `AutoResetEvent`, `Mutex`, `Semaphore`) - 不支持递归

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T22:36:23.220

.NET Monitor 对象（锁使用）是递归的，因此持有锁的线程可以自由地再次进入该锁。

（并非所有锁定结构都是递归的，并且可以针对递归支持提出论据。）

# asp.net-mvc - ASP.NET MVC 视图中的上下文切换？

> ID：567558
> 
> 赞同：0
> 
> 时间：2009-02-19T22:35:58.447
> 
> 标签：asp.net-mvc

在 ASP.NET MVC 视图中使用服务器标记是否有成本？换句话说，当您跳出标记并进入 <% %> 块时，是上下文切换吗？在这种情况下支付的惩罚是多少？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T22:37:36.930

不，编译器将 .aspx 转换为一个类，而标记和表达式只是变成了代码。

它不会在运行时被解释。

PS。前段时间有一篇 MSDN Magazine 文章深入探讨了编译过程，有趣的是看一下使用反射器的编译结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:39:13.523

没有“上下文切换”。

ASP.NET 的工作方式是将页面在服务器端预编译为可执行代码。然后，当请求到来时，该代码将被执行，并且所有服务器标签都将替换为它们将在响应中产生的实际内容。之后将响应发送给用户。

`<% %>`因此，在将 HTML 提供给浏览器之前，您作为标记放置的任何内容都会在服务器上执行。

# css - 如何在 CSS 中执行 IE 条件？

> ID：567561
> 
> 赞同：2
> 
> 时间：2009-02-19T22:36:48.100
> 
> 标签：css

如果我想根据用户正在查看页面的浏览器添加填充，CSS中有没有一种方法可以执行以下操作：

如果 IE 做 padding:5px; else if not IE do padding 10px;

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T22:38:03.513

这是一个很好的参考：[Quirksmode.org Conditional Comments](http://www.quirksmode.org/css/condcom.html)。

尽管控制结构在标记中而不是在 CSS 中，但它实现了您的目标，并且通常被认为是提供特定于浏览器的样式表时的最佳实践。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T22:42:10.913

最佳实践方法是为仅限 IE 的修复提供一个样式表，如下所示：

```
<link rel="stylesheet" href="styles.css" media="screen" type="text/css" />
<!--[if IE]>
<link rel="stylesheet" href="ie-styles.css" media="screen" type="text/css" />
<![endif]--> 
```

然后只需覆盖文件中特定的导致问题的样式`ie-styles.css`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-06-13T12:14:07.547

**针对所有版本的 IE**

```
<!--[if IE]>
<link rel="stylesheet" type="text/css" href="all-ie-only.css" />
<![endif]--> 
```

**定位除 IE 之外的所有内容**

```
<!--[if !IE]><!-->
<link rel="stylesheet" type="text/css" href="not-ie.css" />
<!--<![endif]--> 
```

**仅针对 IE 7**

```
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="ie7.css">
<![endif]--> 
```

**仅针对 IE 6**

```
<!--[if IE 6]>
<link rel="stylesheet" type="text/css" href="ie6.css" />
<![endif]--> 
```

**仅针对 IE 5**

```
<!--[if IE 5]>
<link rel="stylesheet" type="text/css" href="ie5.css" />
<![endif]--> 
```

**仅针对 IE 5.5**

```
<!--[if IE 5.5000]>
<link rel="stylesheet" type="text/css" href="ie55.css" />
<![endif]--> 
```

**目标 IE 6 和更低版本**

```
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="ie6-and-down.css" />
<![endif]-->

<!--[if lte IE 6]>
<link rel="stylesheet" type="text/css" href="ie6-and-down.css" />
<![endif]--> 
```

**目标 IE 7 及更低版本**

```
<!--[if lt IE 8]>
<link rel="stylesheet" type="text/css" href="ie7-and-down.css" />
<![endif]-->

<!--[if lte IE 7]>
<link rel="stylesheet" type="text/css" href="ie7-and-down.css" />
<![endif]--> 
```

**目标 IE 8 和更低版本**

```
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="ie8-and-down.css" />
<![endif]-->

<!--[if lte IE 8]>
<link rel="stylesheet" type="text/css" href="ie8-and-down.css" />
<![endif]--> 
```

**目标 IE 6 和更高版本**

```
<!--[if gt IE 5.5]>
<link rel="stylesheet" type="text/css" href="ie6-and-up.css" />
<![endif]-->

<!--[if gte IE 6]>
<link rel="stylesheet" type="text/css" href="ie6-and-up.css" />
<![endif]--> 
```

**目标 IE 7 和更高版本**

```
<!--[if gt IE 6]>
<link rel="stylesheet" type="text/css" href="ie7-and-up.css" />
<![endif]-->

<!--[if gte IE 7]>
<link rel="stylesheet" type="text/css" href="ie7-and-up.css" />
<![endif]--> 
```

**目标 IE 8 和更高版本**

```
<!--[if gt IE 7]>
<link rel="stylesheet" type="text/css" href="ie8-and-up.css" />
<![endif]-->

<!--[if gte IE 8]>
<link rel="stylesheet" type="text/css" href="ie8-and-up.css" />
<![endif]--> 
```

有关该主题的完整参考，Chris Coyier: [How To Create an IE-Only Stylesheet](http://css-tricks.com/how-to-create-an-ie-only-stylesheet/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T22:48:04.267

如果您不介意代码中的丑陋，可以使用 Holly hack 之类的东西：

```
div { padding:5px; }
* html div { padding:10px; } 
```

有一个简洁的 CSS Zen Garden 示例可以展示两种不同的设计，但我不记得它的名字了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-30T07:56:38.460

尽管 IE 条件只能在 html 中使用，而不能在 CSS 中使用，但您可以在 CSS 文件中使用以下内容进行快速测试/黑客攻击。

```
 p {
   /* all browsers */
   background-color: red; 

   /* for IE7 and below - append a * before the property */
   *background-color: blue; 

   /* for IE6 and below - append a _ before the property */
   _background-color: green;
  } 
```

虽然您可以将其用于您的快速和简短的要求，但我认为，您应该遵循上面 Mark Hurd 对生产级繁重代码给出的建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-06-10T01:27:30.870

这是仅在 CSS中针对**IE 10+的更简洁方法**

```
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {

  /* IE10+ CSS styles go here */

} 
```

（来源：[Phil Newcomer](https://philipnewcomer.net/2014/04/target-internet-explorer-10-11-css/)）

# log4j - Log4J 时间戳

> ID：567566
> 
> 赞同：2
> 
> 时间：2009-02-19T22:37:58.223
> 
> 标签：log4j

貌似timestamp不是按顺序的，意思是按level来记录，能不能按timestamp显示？

2009-02-19 14:47:01,288 调试 [com.catalystwms.core.persistence.TransactionContext]

2009-02-19 14:54:27,429 信息 [com.catalystwms.tms.services.background.purge.PurgeManager]

2009-02-19 14:47:01,288 调试 [com.catalystwms.core.services.ServiceLocator]

请帮我。

谢谢，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T23:03:06.307

您是否将 immediateFlush 设置为 false？

请提供更多信息，很难回答这个问题。您应该包括的内容包括配置文件的详细信息、代码中的日志记录语句等。

# asp.net-mvc - 获取控制器和操作的完全限定 URL？

> ID：567573
> 
> 赞同：6
> 
> 时间：2009-02-19T22:40:01.540
> 
> 标签：asp.net-mvc, routing

获取控制器和操作的完整 URL（包括协议和域）的正确方法是什么？我需要这个才能通过电子邮件发送页面链接。

我希望只使用 Url.Action() 并将其连接到 Request.Url 中的当前服务器主机名。但是，似乎 Url.Action 是上下文相关的，因此如果您已经在同一个控制器中，则不会显示完整路径。

有任何想法吗？

谢谢

詹姆士

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T02:38:36.977

Url.Action() 的重载采用主机名、协议等。调用这些重载之一将生成适合发送电子邮件的完全限定 URL。

# java - Exceptions 有多昂贵

> ID：567579
> 
> 赞同：22
> 
> 时间：2009-02-19T22:41:44.407
> 
> 标签：java, performance, exception

你知道 java 中的异常抛出和处理有多昂贵吗？

我们就团队中异常的实际成本进行了多次讨论。有些人尽可能地避免它们，有些人说使用异常导致的性能损失被高估了。

今天我在我们的软件中发现了以下一段代码：

```
private void doSomething()
{
    try
    {
      doSomethingElse();
    }
    catch(DidNotWorkException e)
    {
       log("A Message");
    }
    goOn();
}
private void doSomethingElse()
{
   if(isSoAndSo())
   {
      throw new DidNotWorkException();
   }
   goOnAgain();
} 
```

与此相比，性能如何

```
private void doSomething()
{
    doSomethingElse();
    goOn();
}
private void doSomethingElse()
{
   if(isSoAndSo())
   {
      log("A Message");
      return;
   }
   goOnAgain();
} 
```

我不想讨论代码美学或任何东西，它只是关于运行时行为！你有真实的经验/测量吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T22:45:42.590

例外不是免费的......所以它们很昂贵:-)

《[Effective Java](http://books.google.com/books?id=ZZOiqZQIbRMC&pg=PA97&sig=JgnunNhNb8MYDcx60Kq4IyHUC58#PPP1,M1) 》一书详细介绍了这一点。

*   第 39 条 仅在例外情况下使用例外。
*   第 40 条 使用可恢复条件的例外

作者发现异常导致在他的机器上使用他的特定 VM 和 OS 组合的测试用例的代码调整慢 70 倍。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-20T03:24:51.263

抛出异常最慢的部分是[填充堆栈跟踪](http://www.javaspecialists.eu/archive/Issue129.html)。

如果您预先创建异常并重新使用它，JIT 可能会将其优化为“[机器级别的 goto](http://blogs.oracle.com/jrose/entry/longjumps_considered_inexpensive) ”。

说了这么多，除非您问题中的代码处于非常紧密的循环中，否则差异将可以忽略不计。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-20T10:54:46.487

关于异常的缓慢部分是构建堆栈跟踪（在 的构造函数中`java.lang.Throwable`），这取决于堆栈深度。投掷本身并不慢。

使用异常来表示失败。性能影响可以忽略不计，堆栈跟踪有助于查明故障原因。

如果您需要控制流的异常（不推荐），并且分析表明异常是瓶颈，则创建一个[`fillInStackTrace()`](http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html#fillInStackTrace())用空实现覆盖的 Exception 子类。或者（或另外）仅实例化一个异常，将其存储在一个字段中并始终抛出相同的实例。

下面通过在[接受的答案中向微基准测试（](https://stackoverflow.com/a/569821/62130)[尽管有缺陷](https://stackoverflow.com/questions/504103/how-do-i-write-a-correct-micro-benchmark-in-java)）添加一种简单的方法来演示没有堆栈跟踪的异常：

```
public class DidNotWorkException extends Exception {
  public Throwable fillInStackTrace() {
      return this;
  }
} 
```

在模式下使用 JVM `-server`（Windows 7 上的版本 1.6.0_24）运行它会导致：

```
Exception:99ms
Boolean:12ms

Exception:92ms
Boolean:11ms 
```

差异很小，在实践中可以忽略不计。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-20T14:52:55.293

我没有费心去阅读异常，但是用你的一些修改过的代码做了一个非常快速的测试，我得出的结论是异常情况比布尔情况慢得多。

我得到以下结果：

```
Exception:20891ms
Boolean:62ms 
```

从这段代码：

```
public class Test {
    public static void main(String args[]) {
            Test t = new Test();
            t.testException();
            t.testBoolean();
    }
    public void testException() {
            long start = System.currentTimeMillis();
            for(long i = 0; i <= 10000000L; ++i)
                    doSomethingException();
            System.out.println("Exception:" + (System.currentTimeMillis()-start) + "ms");
    }
    public void testBoolean() {
            long start = System.currentTimeMillis();
            for(long i = 0; i <= 10000000L; ++i)
                    doSomething();
            System.out.println("Boolean:" + (System.currentTimeMillis()-start) + "ms");
    }

    private void doSomethingException() {
        try {
          doSomethingElseException();
        } catch(DidNotWorkException e) {
           //Msg
        }
    }
    private void doSomethingElseException() throws DidNotWorkException {
       if(!isSoAndSo()) {
          throw new DidNotWorkException();
       }
    }
    private void doSomething() {
        if(!doSomethingElse())
            ;//Msg
    }
    private boolean doSomethingElse() {
       if(!isSoAndSo())
          return false;
       return true;
    }
    private boolean isSoAndSo() { return false; }
    public class DidNotWorkException extends Exception {}
} 
```

我愚蠢地没有很好地阅读我的代码，并且以前有一个错误（多么令人尴尬），如果有人可以三次检查这段代码，我会非常感谢它，以防我老了。

我的规范是：

*   在 1.5.0_16 上编译并运行
*   孙 JVM
*   操作系统SP3
*   英特尔迅驰双核 T7200 (2.00Ghz, 977Mhz)
*   2.00 GB 内存

在我看来，您应该注意到非异常方法不会在 doSomethingElse 中给出日志错误，而是返回一个布尔值，以便调用代码可以处理失败。如果有多个区域可能会失败，则可能需要在内部记录错误或抛出异常。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T22:59:34.647

这本质上是特定于 JVM 的，因此您不应盲目相信给出的任何建议，而应实际衡量您的情况。创建一个“抛出一百万个异常并打印出 System.currentTimeMillis 的差异”来获得一个粗略的想法应该不难。

对于您列出的代码片段，我个人会要求原作者彻底记录他为什么在这里使用异常抛出，因为这不是“最不意外的路径”，这对于以后维护它至关重要。

（每当你以一种令人费解的方式做某事时，你会导致读者做不必要的工作，以便理解你为什么这样做而不是通常的方式 - 我认为作者必须仔细解释为什么工作是合理的这样做是有原因的）。

异常是一个非常非常有用的工具，但只应在必要时使用:)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T22:45:46.443

我没有真正的测量，但抛出异常更昂贵。

好的，这是一个关于 .NET 框架的链接，但我认为这同样适用于 Java：

[例外与表现](http://msdn.microsoft.com/en-us/library/ms229009.aspx)

**也就是说，您应该在适当**的时候毫不犹豫地使用它们。即：不要将它们用于流量控制，而是在发生异常情况时使用它们；你没想到会发生的事情。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-19T22:48:43.550

我认为，如果我们坚持在需要的地方使用异常（异常条件），其好处远远超过您可能付出的任何性能损失。我说可能是因为成本实际上是正在运行的应用程序中抛出异常的频率的函数。
在您给出的示例中，看起来失败并非意外或灾难性的，因此该方法实际上应该返回一个 bool 来表示其成功状态，而不是使用异常，从而使它们成为常规控制流的一部分。
在我参与的少数性能改进工作中，异常的成本相当低。您将花费更多时间来提高常见、高度重复操作的复杂性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-20T08:55:47.337

谢谢大家的回复。

我终于按照 Thorbjørn 的建议编写了一个小测试程序，自己测量性能。结果是：两种变体之间*没有*区别（在性能方面）。

尽管我没有询问代码美学或其他问题，即异常的意图是什么等等。你们中的大多数人也谈到了这个话题。但实际上事情并不总是那么清楚......在所考虑的情况下，代码诞生于很久以前，当时引发异常的情况似乎是一种例外情况。今天库的使用不同，不同应用程序的行为和用法发生了变化，测试覆盖率不是很好，但代码仍然可以完成工作，只是有点太慢了（这就是我要求性能的原因！！）。在那种情况下，我认为应该有充分的理由从 A 更改为 B，在我看来，这不能是“这不是例外的原因！”。

事实证明，日志记录（“一条消息”）（与其他所有发生的事情相比）*非常*昂贵，所以我想，我会摆脱这个。

**编辑**：

测试代码与原始帖子中的代码完全相同，由`testPerfomance()`循环中的方法调用，该方法被 -calls 包围`System.currentTimeMillis()`以获取执行时间......但是：

我现在查看了测试代码，关闭了其他所有内容（日志语句）并循环了比以前多 100 倍的次数，结果证明，当使用 B 而不是原始帖子中的 A 时，您为一百万次调用节省了 4.7 秒。正如罗恩所说`fillStackTrace`，这是最昂贵的部分（+1），如果你覆盖它（如果你不需要它，就像我一样），你可以节省几乎相同的（4.5 秒）。总而言之，在我的情况下它仍然几乎是零差异，因为代码每小时被调用 1000 次，并且测量结果表明我可以在那段时间内节省 4.5 毫秒......

所以，我上面的第一个答案部分有点误导，但我所说的平衡重构的成本效益仍然是正确的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T03:24:09.580

我认为您从稍微错误的角度问这个问题。异常被设计为用于发出**异常情况**的信号，并作为这些情况的**程序流机制**。所以你应该问的问题是，代码的“逻辑”是否要求异常。

异常通常被设计为在它们预期的用途中表现得足够好。如果它们的使用方式使其成为瓶颈，那么最重要的是，这可能表明它们只是被用于“错误的事情”句号——即你所拥有的是一个程序*设计*问题而不是*性能*问题。

相反，如果异常似乎被“用于正确的事情”，那么这可能意味着它也可以执行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T11:10:40.053

假设尝试执行语句 1 和 2 时不会发生异常。这两个示例代码之间是否存在任何性能问题？

如果不是，如果该`DoSomething()`方法必须做**大量**工作（对其他方法的大量调用等）怎么办？

1：

```
try
{
   DoSomething();
}
catch (...)
{
   ...
} 
```

2：

```
DoSomething(); 
```

# java - log4j 输出被抑制？

> ID：567589
> 
> 赞同：1
> 
> 时间：2009-02-19T22:44:57.583
> 
> 标签：java, log4j

我是 log4j 的新手，我似乎无法弄清楚这一点。如果我将 log4j.configuration 设置为一些不存在的垃圾文件，则以下程序将按我的预期工作。但如果我不这样做，它就会保持沉默（除了打印出属性）：

```
package com.example.test;

import org.apache.log4j.*;

public class Log4jExample2 {
    final static Logger logger = Logger.getLogger("test.Log4jExample2");    

    static void kvshow(String[] karray)
    {
        for (String k : karray)
        {
            String v = System.getProperty(k);
            System.out.println(k+"="+v);
        }
    }

    public static void main(String[] args) {
        kvshow(new String[] {"log4j.configuration", "log4j.properties"});
        BasicConfigurator.configure();
        logger.debug("Hello world.");
    }

} 
```

这是一个运行时会话：

```
>java -cp test-20090219.jar com.example.test.Log4jExample2
log4j.configuration=null
log4j.properties=null

>java -cp test-20090219.jar -Dlog4j.configuration=blah.cfg com.example.test.Log4jExample2
log4j.configuration=blah.cfg
log4j.properties=null
0 [main] DEBUG test.Log4jExample2  - Hello world. 
```

我难住了。（同样，没有名为 blah.cfg 的文件，这是我可以让事情正常工作的最简单方法） log4j 从哪里得到它的指令？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:55:07.120

嗯，我有线索......我正在查看 log4j 手册并随机尝试了这个：

```
>java -Dlog4j.debug=true com.example.test.Log4jExample2
log4j: Trying to find [log4j.xml] using context classloader sun.misc.Launcher$AppClassLoader@11b86e7.
log4j: Trying to find [log4j.xml] using sun.misc.Launcher$ExtClassLoader@35ce36 class loader.
log4j: Trying to find [log4j.xml] using ClassLoader.getSystemResource().
log4j: Trying to find [log4j.properties] using context classloader sun.misc.Launcher$AppClassLoader@11b86e7.
log4j: Using URL [jar:file:/C:/appl/Java/jre6u10/lib/ext/bsf.jar!/log4j.properties] for automatic log4j configuration.
log4j: Reading configuration from URL jar:file:/C:/appl/Java/jre6u10/lib/ext/bsf.jar!/log4j.properties
log4j: Parsing for [root] with value=[FATAL, CONSOLE].
log4j: Level token is [FATAL].
log4j: Category root set to FATAL
log4j: Parsing appender named "CONSOLE".
log4j: Parsing layout options for "CONSOLE".
log4j: End of parsing for "CONSOLE".
log4j: Parsed "CONSOLE" options.
log4j: Finished configuring.
log4j.configuration=null
log4j.properties=null 
```

看起来 bean 脚本框架正在覆盖我。

我怎样才能阻止这个？我想要的是，如果没有使用属性文件显式调用 JRE，那么我希望它使用我的 .jar 文件中包含的设置。我尝试将自己的 log4j.properties 文件放在 .jar 文件的根目录中，但这似乎不起作用。

编辑：啊哈！我想我明白了：在第一次使用 Logger.getLogger() 之前，我必须做一个 System.setProperty，比如：

```
static
{
    System.setProperty("log4j.configuration",
    "jar:file:my_jar_file_name_here.jar!/log4j.properties");        
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:52:20.717

[BasicConfigurator](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/BasicConfigurator.html)为 Log4J 设置默认值。因此，当您使用 BasicConfigurator 时，不会读取配置文件。要从属性文件进行配置，请使用[PropertiesConfigurator](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PropertyConfigurator.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-25T17:49:16.423

如果您只是对抑制“No appenders could be found for logger”错误感兴趣，您可以在**src**文件夹中创建一个新文件，将其命名为**log4j.properties**并填写

```
 #Set root logger level to DEBUG and its only appender to A1.
  log4j.rootLogger=WARN, A1
  #A1 is set to be a ConsoleAppender.
  log4j.appender.A1=org.apache.log4j.ConsoleAppender
  #A1 uses PatternLayout.
  log4j.appender.A1.layout=org.apache.log4j.PatternLayout
  log4j.appender.A1.layout.ConversionPattern=%-4r [%t] %-5p %c %x - %m%n 
```

然后保存它。

请注意，这只会抑制上述错误。

# c# - 一个 URL 的 Asp.Net 绝对路径

> ID：567590
> 
> 赞同：49
> 
> 时间：2009-02-19T22:45:17.830
> 
> 标签：c#, asp.net, absolute-path

为了让 web 应用程序更简单地与不同服务器上的另一个应用程序共享文件，我在我的母版页中使用了基本 href 标记。正如许多人所发现的那样，这会破坏网络表单的路径。我有一个工作表单适配器类，但不确定如何获取 url 的绝对路径。目前，我的程序被硬编码为使用类似于：

```
HttpContext Context = HttpContext.Current;
value = "http://localhost" + Context.Request.RawUrl; 
```

值得注意的是，我目前正在我的本地 IIS 服务器上进行测试，因此我尝试使用的很多东西都有一种奇怪的趋势，以便绝对路径不包含域名（我的本地 IIS 不可见外部）。这意味着它不是绝对路径，因此基本 href 会破坏它。

有没有一种很好的方法来处理这个问题，它可以在没有硬编码的情况下在本地工作，但在上传到服务器时也能正常工作？我宁愿避免任何涉及在服务器端副本上做不同事情的事情。

是的，我意识到我可以在本地和服务器上使用单独的 web.config 文件来获取此信息，但这很丑陋并且违反了 DRY。

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-02-19T22:56:48.677

我过去用过这个：

```
// Gets the base url in the following format: 
// "http(s)://domain(:port)/AppPath"
HttpContext.Current.Request.Url.Scheme 
    + "://"
    + HttpContext.Current.Request.Url.Authority 
    + HttpContext.Current.Request.ApplicationPath; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-10-22T15:30:57.480

旧帖子，但这是另一种稍微不那么冗长的方法

```
var baseUri = new Uri(HttpContext.Current.Request.Url, "/"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-11-02T11:47:59.353

我使用了以下功能，它对我的​​客户端和服务器都有效。

```
string surl = string.Format("{0}://{1}",
    HttpContext.Current.Request.Url.Scheme,
    HttpContext.Current.Request.Url.Authority); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-11T20:40:16.890

使用字符串插值：

```
string redirectUri = $"{this.Request.Url.Scheme}://{this.Request.Url.Authority}{this.Request.ApplicationPath}account/signedout"; 
```

根据上下文将 'this' 替换为 'HttpContext' 或 'HttpContext.Current'。

* * *

## 回答 #5

> 赞同：-9
> 
> 时间：2012-05-21T05:27:44.607

代码 ：

```
string loginUrl = Request.Url.GetLeftPart(UriPartial.Authority) + VirtualPathUtility.ToAbsolute("~/") + "Login/Login.aspx?UserName=" + LoggedinUser["UserName"] + "&Password=" + LoggedinUser["Password"]; 
```

# visual-studio-2005 - Bootstrapper：如何在单个 .msi 包中编译应用程序和先决条件？

> ID：567592
> 
> 赞同：3
> 
> 时间：2009-02-19T22:45:38.830
> 
> 标签：visual-studio-2005, windows-installer, bootstrapping

我正在为具有安装先决条件的应用程序创建一个 .msi 包。我正在使用 Visual Studio 2005 Bootstrapper 来完成这项任务。为此，我做了以下操作：找到文件夹 C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\BootStrapper\Packages\ 并为我的先决条件创建了一个文件夹（使其结构与“dotnetfx”相同） ; 创建了“product.xml”和“package.xml”并将它们适当地放置。到目前为止，我保持 xml 文件非常简单以测试安装：

产品.xml

```
<?xml version="1.0" encoding="utf-8"?>
<Product ProductCode="MyPrereq" xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper">
  <PackageFiles CopyAllPackageFiles="false">
    <PackageFile Name="MyPrereq.exe" />
  </PackageFiles>
  <InstallChecks>
  </InstallChecks>
  <Commands Reboot="None">
    <Command PackageFile="MyPrereq.exe" EstimatedInstallSeconds="90">
      <InstallConditions>
      </InstallConditions>
      <ExitCodes>
    <ExitCode Value="0" Result="Success"/>
        <DefaultExitCode Result="Fail" String="GeneralFailure" FormatMessageFromSystem="true" />
      </ExitCodes>
    </Command>
  </Commands>
</Product> 
```

包.xml

```
<?xml version="1.0" encoding="utf-8"?>
<Package Name="MyPrereq" Culture="Culture" xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper">
  <Strings>
    <String Name="Culture">en</String>
    <String Name="DisplayName">MyPrereq</String>
    <String Name="GeneralFailure">A fatal error occurred. The installation failed.</String>
  </Strings>
</Package> 
```

现在我可以从列表中添加先决条件并构建我的设置项目。

问题：

构建输出是“setup.exe”、“MyApp.msi”包，以及名为“MyPrereq”的子文件夹，其中包含“MyPrereq.exe”。

我希望构建创建一个“setup.exe”和一个“MyApp.msi”，其中包含“MyPrereq”，没有其他文件/目录。

我知道 .NET 框架是我的应用程序的另一个先决条件，它包含在同一个 .msi 中，因此应该以某种方式实现。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T22:59:39.310

您可以使用 IExpress（Windows 随附）等工具创建一个自解压安装程序，其中包含单个可执行文件中的所有文件（请参阅[此 SO 发布](https://stackoverflow.com/questions/535966?sort=votes)）。

您不能让 MSI 文件安装其自己的先决条件。首先，因为 Windows Installer 本身是先决条件（并且必须由非 MSI exe 安装），其次因为 Windows Installer 安装是事务性的，不支持 MSI 文件的链式执行。这基本上意味着一个 MSI 安装无法启动另一个 MSI 安装。因此，任何先决条件都必须由单独的引导程序安装（顺便说一下，安装不再是事务性的 - 如果您的 MSI 安装失败，则不会卸载先决条件）。

不过，似乎对引导程序机制存在基本的误解。引导程序目前只能由 Visual Studio 或 MSBuild 生成。Afaik WiX 是不可能的。在 MSBuild 中查找 GenerateBootstrapper 任务（请参阅[此 SO 帖子](https://stackoverflow.com/questions/427775/wix-and-net-framework-pre-requisites)）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T02:58:21.983

我设法用 IExpress 做到了这一点。

但是，必须使用一个小技巧，此处描述 [了为 VS Shell 应用程序创建引导程序](http://www.clariusconsulting.net/blogs/pga/comments/42831.aspx)

> 不幸的是，MSBuild 任务没有提供让配置资源使用在目标目录中找到的先决条件安装程序的选项，因此您必须手动更新相应的资源文件以删除在子目录中查找先决条件的硬编码路径同名。
> 
> *   在 Visual Studio 的资源编辑器中打开 Setup.exe 程序
>     *   双击41文件夹中名为SETUPCFG的资源
>     *   搜索“Vs Shell\”字符串并删除出现的两次
>     *   保存资源文件，Setup.exe 可执行文件将自动更新
>     *   运行 iexpress*   按照 IExpress 向导的步骤创建一个新包，并确保包含以下文件：*   MyVSShellApplication.msi 文件*   Setup.exe 引导程序文件*   vs_shell_isolated.enu.exe 文件

问题是引导程序将先决条件放入子文件夹中，而 IExpress 无法识别子文件夹。在编辑“setup.exe”时也必须小心，第一次尝试时没有正确。

# c# - windows上的mono mkbundle实用程序

> ID：567595
> 
> 赞同：4
> 
> 时间：2009-02-19T22:45:45.507
> 
> 标签：c#, compiler-construction, mono

Mono 实用程序 mkbundle 已经被大量提及，它应该（除其他外）允许您使用使用 Mono 编译的 C# 项目创建捆绑包（独立 .exe）。这在我在 Cygwin 中运行时有效，但是我真正想做的是使用`--deps`选项和`--static`选项来拉入所有依赖项和库，以便它真的是独立的。在 Cygwin 中运行该命令时，它声称`--static`当前平台不支持该命令（我假设它指的是 windows）。那么问题是：

有没有办法解决这个困境？

如果没有，我现在需要携带哪些特定的 .dll 和我的可执行文件才能运行该程序？它似乎没有在单声道网站的任何地方列出。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-03T00:14:47.670

[http://linux.die.net/man/1/mkbundle](http://linux.die.net/man/1/mkbundle)：

> 在 Windows 系统上，必须安装类 Unix 工具链才能使 mkbundle 工作。您可以使用 cygwin 并安装 gcc、gcc-mingw 和软件包。（原文如此）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T10:36:36.273

没有办法在单声道中制作包含所有必要库的跨平台应用程序，因为这些库将依赖于一些特定的非托管库。
这里正确的方法是为您的应用程序创建一个安装程序（例如[使用 wix](http://wix.sourceforge.net/)）并在其中包含一个单声道安装程序。因此，当您安装应用程序时，也会安装单声道。对于 linux，您还需要创建一个安装程序。

# sql-server - SQL 复制“未找到行”错误

> ID：567597
> 
> 赞同：10
> 
> 时间：2009-02-19T22:46:24.943
> 
> 标签：sql-server, replication

我在两个数据库之间运行事务复制。我担心它们会稍微不同步，但我不知道哪些记录受到影响。如果我知道，我可以在订户端手动修复它。

SQL Server 给我这个消息：

> 应用复制命令时，在订阅服务器上未找到该行。（来源：MSSQLServer，错误号：20598）

我环顾四周，试图找出是什么表，甚至更好的是是什么记录导致了问题，但我在任何地方都找不到该信息。

到目前为止，我发现的最详细的数据是：

> 交易序号：0x0003BB0E000001DF000600000000，命令ID：1

但是我如何从中找到表格和行？有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-04-21T05:15:37.330

这为您提供了错误所针对的表

```
use distribution
go

select * from dbo.MSarticles
where article_id in (
    select article_id from MSrepl_commands
    where xact_seqno = 0x0003BB0E000001DF000600000000) 
```

这将为您提供命令（以及命令正在执行的主键（即行））

```
exec sp_browsereplcmds 
@xact_seqno_start = '0x0003BB0E000001DF000600000000', 
@xact_seqno_end = '0x0003BB0E000001DF000600000000' 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-20T04:51:22.163

我将用我最终使用的解决方法来回答我自己的问题。

不幸的是，我无法通过 SQL Server 复制接口（或事件日志）找出导致问题的表。只是没说。

所以接下来我想到的是，“即使出现错误，如果我可以继续复制会怎样？” 你瞧，有办法。事实上，这很容易。有一个特殊的分发代理配置文件称为“数据一致性错误继续”。如果您启用它，那么这些类型的错误将被记录并传递。一旦通过应用事务并可能记录错误（我只遇到两个），那么您可以返回并使用 RedGate SQL 数据比较（或其他一些工具）来比较您的两个数据库，对订阅者进行任何更正，然后再次开始复制运行。

请记住，要使其正常工作，您的发布数据库需要在您区分和修复订阅者数据库的部分过程中保持“安静”。幸运的是，在这种情况下，我拥有了这种奢侈。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T22:50:07.803

如果您的数据库不是太大，我会停止复制，重新创建快照，然后重新开始复制​​。这篇[technet 文章](http://technet.microsoft.com/en-us/library/ms152466.aspx)描述了这些步骤。

如果由于用户意外更改副本上的数据而导致不同步，我将设置必要的权限以防止这种情况发生。

这篇[复制文章](http://www.replicationanswers.com/Transactional.asp)值得一读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-31T20:13:12.743

使用此查询找出不同步的文章：

```
USE [distribution]

select * from dbo . MSarticles 
where article_id IN ( SELECT Article_id from MSrepl_commands 
where xact_seqno = 0x0003BB0E000001DF000600000000) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-08T03:51:07.563

当然，如果您在复制失败时检查错误，它还会告诉您哪条记录有问题，您可以从核心系统中提取该数据并将其插入订阅者。

这比使用 SQL 数据比较跳过错误要好，它会锁定表以进行比较，如果您有数百万行，这可能需要很长时间才能运行。

特里斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-25T14:07:25.770

将配置文件更改为“继续处理数据一致性错误”并不总是有效。显然，它减少或消除了错误，但您不会获得完整的正确数据。它将跳过发生错误的行，因此您无法获得准确的数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-24T19:13:53.813

以下检查解决了我的问题

*   检查所有复制 SQL 代理作业是否正常工作，如果没有启动它们。
    *   在我的情况下，由于阻塞问题，一些 DBA 在几个小时前发生了一些终止会话，因此它被停止了
*   在很短的时间后，订阅中的所有数据都已更新，并且复制监视器中没有其他错误
*   在我的情况下，上述所有查询都没有返回任何内容

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-25T06:44:21.767

当订阅者上不存在特定记录并且在主服务器上为同一记录执行更新或删除命令并且在订阅者上也被复制时，通常会出现此错误。

由于订阅者上不存在此记录，因此复制会引发错误“未找到行”

此错误的解决方法使复制工作恢复到正常运行状态：

我们可以通过以下查询检查发布者的请求是更新还是删除语句：

```
USE [distribution]

SELECT *
FROM   msrepl_commands 
WHERE  publisher_database_id = 1
       AND command_id = 1
       AND xact_seqno = 0x00099979000038D6000100000000 
```

我们可以从上面的查询中得到 artical id 信息，这些信息可以传递给下面的 proc：

```
EXEC Sp_browsereplcmds
  @article_id = 813,
  @command_id = 1,
  @xact_seqno_start = '0x00099979000038D60001',
  @xact_seqno_end = '0x00099979000038D60001',
  @publisher_database_id = 1 
```

上面的查询将提供有关它是更新语句还是删除语句的信息。

1.  在删除语句的情况下

该记录可以直接从 msrepl_commands 对象中删除，以便复制不会对该记录进行重试

```
DELETE FROM msrepl_commands
WHERE  publisher_database_id = 1
       AND command_id =1
       AND xact_seqno = 0x00099979000038D6000100000000 
```

2.  如果是更新声明：

您需要将该记录从发布者数据库手动插入到订阅者数据库：

# visual-studio - 在 Visual Studio 中禁用设计器？

> ID：567606
> 
> 赞同：37
> 
> 时间：2009-02-19T22:47:19.277
> 
> 标签：visual-studio, windows-forms-designer

我正在使用 Visual C# Express 编写 Windows 窗体应用程序，并称我为老派，但我不喜欢设计器。这很麻烦，并且用大量不需要的文件以及不需要的猴子生成的源代码污染了我的项目。

请告诉我有一种方法可以完全关闭它。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-03-02T14:48:22.130

在 UI 类之前添加一个`[System.ComponentModel.DesignerCategory("")]`属性，以避免在双击时激活设计器。

请注意，包括`System.ComponentModel`在文件顶部，然后仅添加属性 as`[DesignerCategory("")]`将不起作用（至少在 Visual Studio 2010/2013 中不起作用）。您必须使用完整的、命名空间限定的属性类型名称。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-19T22:55:02.503

右键单击项目文件并选择打开方式允许您设置打开文件类型的默认值。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-11-26T19:37:06.293

实际上，在 VS2010 中，您只需右键单击您不想在设计器中打开的 .cs 文件*，*选择“Open With..”选项，然后将 CSharp Editor 设为默认值。请注意，表单视图是您更改之前的默认视图。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T13:40:22.800

只是**不要添加“新表单”**，添加到项目新类并从表单类继承他。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-09T13:03:21.990

弗雷德里克，当然你是对的，但事实并非如此。（这个 IJ 想知道）一旦您从任何组件继承，工作室就会尝试在设计器编辑器中打开它。这是视觉工作室的默认行为。

如果您在解决方案资源管理器中双击文件，则会打开一个设计器。因此，如果您总是为刚刚从组件继承但不包含任何可见内容的类获得如此奇怪的设计器，那真的很烦人。

唯一真正帮助我的是设置这个属性：[System.ComponentModel.DesignerCategory("")]

我不知道这个 =) 这么酷的提示！

我只是遇到了部分 MainForm 类的问题。然后它大喊“重复属性”......

这里有人知道避免在某些部分类文件中双击打开设计器的解决方案（编译时没有重复属性错误吗？）

* * *

我想我在 VS2005 中发现了一个小错误...通过在部分表单类上设置 DesignerCategory-Attribute，在保存解决方案资源管理器时会显示一个图标，将文件标识为 ac# 文件（无表单）。

然后我在属性前添加了一个注释 (//) - 它一直在代码视图中打开文件。同样在关闭并重新打开后，它在内部存储为不可设计的表单部分。即使重新打开完整的解决方案。

所以我认为解决方案或项目文件中有任何信息......

...我在 .csproj 文件中找到了这个：...

```
<Compile Include="GUI\VFormMain_Test.cs">
</Compile>
<Compile Include="GUI\VFormMain_Theme.cs">
</Compile>
<Compile Include="Core\VTTEnv.cs" />
<Compile Include="GUI\VFormMain.cs">
  <SubType>form</SubType>
</Compile> 
```

...

Studio 不时更新 - 然后它再次更新了表单文件（doh）......好吧..但可能有一种解决方法可以避免这种情况。

* * *

剪断...最后一次编辑...发现了一些东西：

[http://social.msdn.microsoft.com/Forums/en-US/csharpide/thread/64c77755-b0c1-4447-8ac9-b5a63a681b78](http://social.msdn.microsoft.com/Forums/en-US/csharpide/thread/64c77755-b0c1-4447-8ac9-b5a63a681b78)

（将要在没有设计器的情况下打开的文件命名为 .Designer.cs ）

（是的，你必须命名一些东西来切换它的 LOL ）似乎工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T23:03:18.693

如果您不想使用设计器，那么不要使用它吗？

您可以从头开始创建一个新表单，而无需设计器通过创建一个新的空类来生成任何代码，并让该类继承自`System.Windows.Forms.Form`

然后，VS.NET 可能仍会指示您的类是一个 Form，如果您愿意，您仍然可以在设计器中打开它。（并在其上放置控件）。

# dotnetnuke - 我应该为 DotNetNuke 购买还是构建 Web 服务表单模块？

> ID：567616
> 
> 赞同：2
> 
> 时间：2009-02-19T22:49:42.453
> 
> 标签：dotnetnuke

我对 DNN 还很陌生。我需要启动几十个类似皮肤的站点，所有这些站点最终都必须调用一个允许用户提交信息的 Web 服务。

我想找到一个模块，让我将其指向所述 Web 服务，然后让我定义工作流程（例如在多个页面上填写？）并选择控件（文本框、复选框）来填写要发布到的消息该网络服务。

我见过[Dynamic Forms](http://marketplace.dotnetnuke.com/p-350-dynamic-forms27.aspx)和[Enterprise Forms 之](http://www.longnhi.com/ProductInformation/Benefits/tabid/105/Default.aspx)类的东西，但我找不到任何关于这是否可能的信息。

任何人都知道允许我这样做的模块或可选想法吗？我在编这样的东西吗？没有答案让我想“我会建造它......”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T22:57:08.457

我对 DNN 模块的经验是，它们很少完全适合特定的技术问题。所以我会尝试以下

1）给你提到的工具背后的人发电子邮件

2) 无论如何购买它们，有源代码，并学习结构良好的 DNN 插件的架构 - 节省的时间超过了回报的成本

3）根据这些知识做出决定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T16:41:07.997

约书亚，

目前我不知道有任何表单模块集成到 Web 服务中。

但是，您可能希望查看潜在的扩展现有模块，并简单地更改它的持久性机制，而不是整个自定义解决方案。

# python - 有没有一种pythonic方法可以尝试最多次数？

> ID：567622
> 
> 赞同：98
> 
> 时间：2009-02-19T22:52:01.917
> 
> 标签：python, exception-handling

我有一个 python 脚本，它正在查询共享 linux 主机上的 MySQL 服务器。出于某种原因，对 MySQL 的查询通常会返回“服务器已消失”错误：

```
_mysql_exceptions.OperationalError: (2006, 'MySQL server has gone away') 
```

如果您之后立即再次尝试查询，通常会成功。所以，我想知道在 python 中是否有一种合理的方式来尝试执行查询，如果它失败，再试一次，最多可以尝试固定次数。可能我希望它在完全放弃之前尝试 5 次。

这是我拥有的那种代码：

```
conn = MySQLdb.connect(host, user, password, database)
cursor = conn.cursor()

try:
    cursor.execute(query)
    rows = cursor.fetchall()
    for row in rows:
        # do something with the data
except MySQLdb.Error, e:
    print "MySQL Error %d: %s" % (e.args[0], e.args[1]) 
```

显然，我可以通过在 except 子句中再次尝试来做到这一点，但这非常难看，我觉得必须有一种体面的方法来实现这一点。

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-02-19T23:00:09.917

怎么样：

```
conn = MySQLdb.connect(host, user, password, database)
cursor = conn.cursor()
attempts = 0

while attempts < 3:
    try:
        cursor.execute(query)
        rows = cursor.fetchall()
        for row in rows:
            # do something with the data
        break
    except MySQLdb.Error, e:
        attempts += 1
        print "MySQL Error %d: %s" % (e.args[0], e.args[1]) 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-02-19T23:16:22.047

基于 Dana 的回答，您可能希望以装饰者的身份执行此操作：

```
def retry(howmany):
    def tryIt(func):
        def f():
            attempts = 0
            while attempts < howmany:
                try:
                    return func()
                except:
                    attempts += 1
        return f
    return tryIt 
```

然后...

```
@retry(5)
def the_db_func():
    # [...] 
```

### 使用`decorator`模块的增强版

```
import decorator, time

def retry(howmany, *exception_types, **kwargs):
    timeout = kwargs.get('timeout', 0.0) # seconds
    @decorator.decorator
    def tryIt(func, *fargs, **fkwargs):
        for _ in xrange(howmany):
            try: return func(*fargs, **fkwargs)
            except exception_types or Exception:
                if timeout is not None: time.sleep(timeout)
    return tryIt 
```

然后...

```
@retry(5, MySQLdb.Error, timeout=0.5)
def the_db_func():
    # [...] 
```

[要`decorator`](http://pypi.python.org/pypi/decorator)安装[模块](http://pypi.python.org/pypi/decorator)：

```
$ easy_install decorator 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-06-23T13:19:32.110

**更新：**重试库有一个维护得更好的分支，称为[tenacity](http://tenacity.readthedocs.io/en/latest/)，它支持更多功能并且通常更灵活。

API 略有变化：

```
@retry(stop=stop_after_attempt(7))
def stop_after_7_attempts():
    print("Stopping after 7 attempts")

@retry(wait=wait_fixed(2))
def wait_2_s():
    print("Wait 2 second between retries")

@retry(wait=wait_exponential(multiplier=1, min=4, max=10))
def wait_exponential_1000():
    print("Wait 2^x * 1000 milliseconds between each retry,")
    print("up to 10 seconds, then 10 seconds afterwards") 
```

* * *

是的，有[重试库](https://pypi.python.org/pypi/retrying)，它有一个装饰器，可以实现多种重试逻辑，您可以将它们组合起来：

一些例子：

```
@retry(stop_max_attempt_number=7)
def stop_after_7_attempts():
    print("Stopping after 7 attempts")

@retry(wait_fixed=2000)
def wait_2_s():
    print("Wait 2 second between retries")

@retry(wait_exponential_multiplier=1000, wait_exponential_max=10000)
def wait_exponential_1000():
    print("Wait 2^x * 1000 milliseconds between each retry,")
    print("up to 10 seconds, then 10 seconds afterwards") 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-19T23:43:51.530

```
conn = MySQLdb.connect(host, user, password, database)
cursor = conn.cursor()

for i in range(3):
    try:
        cursor.execute(query)
        rows = cursor.fetchall()
        for row in rows:
            # do something with the data
        break
    except MySQLdb.Error, e:
        print "MySQL Error %d: %s" % (e.args[0], e.args[1]) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-19T23:13:06.890

我会像这样重构它：

```
def callee(cursor):
    cursor.execute(query)
    rows = cursor.fetchall()
    for row in rows:
        # do something with the data

def caller(attempt_count=3, wait_interval=20):
    """:param wait_interval: In seconds."""
    conn = MySQLdb.connect(host, user, password, database)
    cursor = conn.cursor()
    for attempt_number in range(attempt_count):
        try:
            callee(cursor)
        except MySQLdb.Error, e:
            logging.warn("MySQL Error %d: %s", e.args[0], e.args[1])
            time.sleep(wait_interval)
        else:
            break 
```

分解`callee`函数似乎会分解功能，以便轻松查看业务逻辑而不会陷入重试代码中。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-22T13:24:47.860

像 S.Lott 一样，我喜欢一个标志来检查我们是否完成了：

```
conn = MySQLdb.connect(host, user, password, database)
cursor = conn.cursor()

success = False
attempts = 0

while attempts < 3 and not success:
    try:
        cursor.execute(query)
        rows = cursor.fetchall()
        for row in rows:
            # do something with the data
        success = True 
    except MySQLdb.Error, e:
        print "MySQL Error %d: %s" % (e.args[0], e.args[1])
        attempts += 1 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-03-27T11:12:03.903

```
def successful_transaction(transaction):
    try:
        transaction()
        return True
    except SQL...:
        return False

succeeded = any(successful_transaction(transaction)
                for transaction in repeat(transaction, 3)) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-12-04T02:36:31.800

一、定义：

```
def try_three_times(express):
    att = 0
    while att < 3:
        try: return express()
        except: att += 1
    else: return u"FAILED" 
```

2.用途：

```
try_three_times(lambda: do_some_function_or_express()) 
```

我用它来解析 html 上下文。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-07-24T15:53:25.380

您可以使用带有子句的`for`循环以获得最大效果：`else`

```
conn = MySQLdb.connect(host, user, password, database)
cursor = conn.cursor()

for n in range(3):
    try:
        cursor.execute(query)
    except MySQLdb.Error, e:
        print "MySQL Error %d: %s" % (e.args[0], e.args[1])
    else:
        rows = cursor.fetchall()
        for row in rows:
            # do something with the data
        break
else:
    # All attempts failed, raise a real error or whatever 
```

关键是一旦查询成功就跳出循环。`else`只有在没有 .的循环完成时才会触发该子句`break`。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-11T13:57:07.173

这是我的通用解决方案：

```
class TryTimes(object):
    ''' A context-managed coroutine that returns True until a number of tries have been reached. '''

    def __init__(self, times):
        ''' times: Number of retries before failing. '''
        self.times = times
        self.count = 0

    def __next__(self):
        ''' A generator expression that counts up to times. '''
        while self.count < self.times:
            self.count += 1
        yield False

    def __call__(self, *args, **kwargs):
        ''' This allows "o() calls for "o = TryTimes(3)". '''
        return self.__next__().next()

    def __enter__(self):
        ''' Context manager entry, bound to t in "with TryTimes(3) as t" '''
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        ''' Context manager exit. '''
        return False # don't suppress exception 
```

这允许如下代码：

```
with TryTimes(3) as t:
    while t():
        print "Your code to try several times" 
```

也可以：

```
t = TryTimes(3)
while t():
    print "Your code to try several times" 
```

这可以通过以更直观的方式处理异常来改进，我希望。接受建议。

# c++ - 无法通过 C++ 中的隐式转换找到运算符

> ID：567626
> 
> 赞同：3
> 
> 时间：2009-02-19T22:53:15.923
> 
> 标签：c++, type-conversion, operator-keyword, implicit-conversion

在编写一个类以充当堆分配对象的包装器时，我遇到了隐式类型转换的问题，可以简化为这个简单的示例。

在下面的代码中，包装类管理一个堆分配的对象并隐式转换为对该对象的引用。这允许包装器对象作为参数传递给函数 write(...)，因为发生了隐式转换。

但是，当尝试解析对 operator<<(...) 的调用时，编译器会失败，除非进行了显式转换（使用 MSVC8.0、Intel 9.1 和 gcc 4.2.1 编译器进行检查）。

那么，（1）为什么在这种情况下隐式转换会失败？（2）它可能与依赖于参数的查找有关吗？(3) 如果没有明确的演员表，有什么可以做的吗？

```
#include <fstream>

template <typename T>
class wrapper
{
    T* t;
  public:
    explicit wrapper(T * const p) : t(p) { }
    ~wrapper() { delete t; }
    operator T & () const { return *t; }
};

void write(std::ostream& os)
{
    os << "(1) Hello, world!\n";
}

int main()
{
    wrapper<std::ostream> file(new std::ofstream("test.txt"));

    write(file);
    static_cast<std::ostream&>( file ) << "(2) Hello, world!\n";
    // file << "(3) This line doesn't compile!\n";
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T23:11:18.533

它失败了，因为您正在尝试解析`wrapper<T>`不存在的类的运算符。如果你想让它在没有演员表的情况下工作，你可以把这样的东西放在一起：

```
template<typename X> wrapper<T> &operator <<(X &param) const {
    return t << param;
} 
```

不幸的是，我不知道在编译时解决返回类型的方法。幸运的是，在大多数情况下，它与对象的类型相同，包括在这种情况下带有`ostream`.

**编辑：**根据 dash-tom-bang 的建议修改代码。将返回类型更改为`wrapper<T> &`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T23:07:06.610

编译器没有足够的上下文来确定`operator&`将进行有效转换。所以，是的，我认为这与依赖于参数的查找有关：编译器正在寻找一个`operator<<`可以接受非`const` `wrapper<std::ostream>`作为其第一个参数的参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T23:12:25.677

我认为问题与维护一些编译时约束有关。在您的示例中，编译器首先必须找到**所有**可能的运算符<<。然后，对于它们中的每一个，它应该尝试您的对象是否可以自动（直接或间接）转换为每个 operator<< 能够接受的任何类型。

这个测试可能非常复杂，我认为这仅限于提供合理的编译时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T05:47:58.503

经过一些测试，一个更简单的示例确定了问题的根源。编译器无法从 to 的隐式转换中推断出下面的`T`模板参数。`f2(const bar<T>&)``wrapper<bar<int> >``bar<int>&`

```
template <typename T>
class wrapper
{
    T* t;
  public:
    explicit wrapper(T * const p) : t(p) { }
    ~wrapper() { delete t; }
    operator T & () const { return *t; }
};

class foo { };

template <typename T> class bar { };

void f1(const foo& s) { }
template <typename T> void f2(const bar<T>& s) { }
void f3(const bar<int>& s) { }

int main()
{
    wrapper<foo> s1(new foo());
    f1(s1);

    wrapper<bar<int> > s2(new bar<int>());
    //f2(s2); // FAILS
    f2<int>(s2); // OK
    f3(s2);
} 
```

在原始示例中，`std::ostream`实际上是一个`typedef`用于模板化的类`std::basic_ostream<..>`，并且在调用模板化函数时也适用相同的情况`operator<<`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T22:58:53.120

检查插入运算符的签名...我认为他们采用非常量 ostream 引用？

*经 C++03 标准确认*，char* 输出运算符的签名为：

```
template<class charT, class traits>
basic_ostream<charT,traits>& operator<<(basic_ostream<charT,traits>&, const charT*); 
```

这确实需要非常量引用。所以你的转换运算符不匹配。

如评论中所述：这是无关紧要的。

标准中有关于应用转换的各种限制......也许这需要隐式转换（您的运算符，并强制转换为基本类型），而最多应该应用一个。

# sharepoint - SharePoint 和工作流

> ID：567627
> 
> 赞同：1
> 
> 时间：2009-02-19T22:54:34.253
> 
> 标签：sharepoint, moss, workflow

使用 MOSS 2007（这个问题可能也适用于 WSS，但我目前在 MOSS 工作）是否可以在网站集中的每个页面列表上拥有相同的工作流？

我们正在部署一个具有基本 2 阶段审批者工作流程的站点，因此我没有开发自定义站点，只是使用现有的审批者工作流程，但有 2 个审批组按顺序工作（请参阅此博客文章：[http://www.sharepointblogs .com/tommysegoro/archive/2008/08/18/configuring-sharepoint-moss-2007-multi-stage-approval-workflows.aspx](http://www.sharepointblogs.com/tommysegoro/archive/2008/08/18/configuring-sharepoint-moss-2007-multi-stage-approval-workflows.aspx)）。

问题是，当您创建一个发布站点时，它（默认情况下）只有一个审批者工作流程，而不是我想要的那个。

我可以跨网站集和任何子网站集强制执行工作流吗？还是我需要创建自己的站点模板（甚至可以在部署工作流时定义它吗？）？

## 编辑

澄清一下，我希望能够创建一个新的 MOSS 发布站点，该站点对 SharePoint 中开箱即用的标准审批者工作流程进行了一些细微的修改。我不想部署*不同*的工作流程，只需修改现有的。

当您创建发布站点时，您将获得一个“并行审批者”工作流，它将工作流任务分配给一个名为 Approvers 的组，并设置为并行运行工作流任务。我需要更改组（添加一个新组）并将其设置为顺序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T00:13:26.700

您可以创建一个功能，在使用 SPFeatureReceiver 类激活时将第二个工作流添加到页面库，并使用功能装订将该功能装订到现有的发布站点站点定义。

以下是有关使用功能事件接收器和功能装订的 MSDN 帖子：http:
[//msdn.microsoft.com/en-us/library/bb862634.aspx](http://msdn.microsoft.com/en-us/library/bb862634.aspx)
[http://msdn.microsoft.com/en-us/library/bb861862。 aspx](http://msdn.microsoft.com/en-us/library/bb861862.aspx)

# connection-string - 连接字符串可以跨到同一服务器上的其他站点吗？

> ID：567628
> 
> 赞同：0
> 
> 时间：2009-02-19T22:54:34.503
> 
> 标签：connection-string

上周我遇到了一个新问题。由于我的项目的性质和可用预算，我一直在开发的一个小型 Intranet Web 应用程序既是测试服务器又是实时服务器，以及提供页面并且是 sql 服务器。这将至少持续到项目结束主要开发周期。现在该项目有真正的用户，但我正在继续开发，我复制了数据库以有一个安全的副本来处理，不会对实时业务数据和网站的开发副本造成破坏。

一切都很好，直到我在站点的测试副本上发现异常，任何使用 sql 数据源的东西都正确地从测试数据库中提取它的数据，但是任何从后面代码中触发的存储过程中获取它的数据的东西都是拉它的来自实时数据库的数据。

我的困惑来自这样一个事实，即所有存储过程和 sql 数据源最终都指向 web.config 文件中相同的连接字符串设置以知道连接到哪里。我只是根据我是否将最新更改上传到测试站点或实时站点来重命名数据库名称。

我的问题归结为，为什么在每个站点中使用一个连接字符串，我的测试站点会以一种方式访问​​数据，从一个数据库获取数据，而访问另一个从另一个数据库获取数据？

这是我的连接字符串，它们都指向，名称/密码当然会因为明显的原因而改变，但结构是完整的。

```
<add name="db_Connection" connectionString="Data Source=SERVERNAME;Initial Catalog=DATABASE_live;Persist Security Info=False;User ID=USERID;Password=password" providerName="System.Data.SqlClient"/> 
```

我在 appsettings 中添加了一个键来引用数据库连接的名称，因此如果需要，我可以轻松更改它的名称，而无需为 SProc 调用背后的代码编辑数十页。

```
<add key="defaultDB" value="db_Connection" /> 
```

我是否违反了一些我不知道的规则，或者是否还有其他事情需要我注意和更改，以便在我继续开发活动站点时拥有一个真正的测试环境？

**编辑**此项目在 ASP.NET 2.0 VB 中，修复了代码显示。

**找到解决方案**我已经找到了解决方案，感谢您的指点，他们让我在别处寻找。当我将站点复制到不同的位置进行测试时，我忘记更新站点位置的 appsetting 密钥，这导致调用存储过程的以下部分显然从实时站点的 web.config 中获取数据。

```
System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration(pubvar_webConfig) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T00:24:54.783

更改开发数据库上的用户名和密码。如果您的问题仍然存在，那么您可能在其他不知道的地方设置了连接字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T00:19:41.507

通过 IIS 在不同的应用程序池中运行这两个应用程序可能是值得的（如果您还没有或当然！）。这应该消除应用程序级别的测试和生产站点之间的任何并发问题。

恕我直言，具有共享测试/生产环境的独立应用程序池在任何时候都是很好的做法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T00:27:47.633

我会搜索您的解决方案中的所有文件，以确保您没有在某个地方硬编码数据库名称之一。也许在设计器文件中？

# c# - 为什么我只能在调试模式下访问这个 zip 文件？

> ID：567631
> 
> 赞同：0
> 
> 时间：2009-02-19T22:55:07.887
> 
> 标签：c#, asp.net, permissions, zip, impersonation

我遇到了一个对我来说没有多大意义的问题。我有一个 ASP.NET 应用程序可以在调试模式下完美运行，但在正常运行时会引发访问被拒绝错误。我已经为 ASPNET 帐户和应用程序模拟对 webapp 正在调用的文件的完全控制权限的帐户（使用 Process 对象）。

我确定引发错误的文件位于 zip 文件中，并且我正在运行的进程不会在除 zip 文件之外的任何地方查找*它们*。但似乎在我解压缩 zip 文件之前，我无法对其内容设置权限。这对其他人有意义吗？有人知道解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T22:58:58.343

在解压到的文件夹上设置 CREATOR_OWNER 的权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T23:11:58.547

您使用什么库来访问 zip 文件？当不同的线程尝试同时从存档中提取文件时，您可能无法两次打开单个 zip 存档？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T23:54:24.680

哦，拍摄，“拒绝访问”，而不是“拒绝权限”。这个总是抓住我。

“拒绝访问”是指即使您拥有权限也无法打开文件，通常是因为其他人已经打开了该文件。

# ruby-on-rails - 如何在 Ruby on Rails 中获取两个 DateTimes 之间的秒数

> ID：567636
> 
> 赞同：76
> 
> 时间：2009-02-19T22:57:42.047
> 
> 标签：ruby-on-rails, datetime

我有代码可以为员工进行时间跟踪。它会创建一个计数器来向员工显示他们已经打卡了多长时间。

这是当前代码：

```
 start_time = Time.parse(self.settings.first_clock_in)
  total_seconds = Time.now - start_time
  hours = (total_seconds/ 3600).to_i
  minutes = ((total_seconds % 3600) / 60).to_i
  seconds = ((total_seconds % 3600) % 60).to_i 
```

这工作正常。但是由于时间限制在 1970 - 2038 的范围内，我们试图用 DateTimes 替换所有时间使用。我不知道如何获得两个日期时间之间的秒数。减去它们会产生一个我不知道如何解释的 Rational，而减去 Times 会产生以秒为单位的差异。

注意：从 Ruby 1.9.2 开始，时间的硬限制被移除。但是，时间针对 1823-11-12 和 2116-02-20 之间的值进行了优化。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-02-19T23:10:55.180

减去两个 DateTimes 以天为单位返回经过的时间，所以你可以这样做：

```
elapsed_seconds = ((end_time - start_time) * 24 * 60 * 60).to_i 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2010-05-28T20:00:55.827

或者，更易读：

```
diff = datetime_1 - datetime_2
diff * 1.days # => difference in seconds; requires Ruby on Rails 
```

请注意，您或其他一些搜索者可能真正要寻找的是：

```
diff = datetime_1 - datetime_2
Date.day_fraction_to_time(diff) # => [h, m, s, frac_s] 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-02-19T23:08:56.293

您可以使用 将它们转换为浮点数`to_f`，但这会导致通常与浮点数相关的精度损失。如果您只是在整秒钟内转换为整数，那么它不应该大到令人担心。

结果以秒为单位：

```
>> end_time.to_f - start_time.to_f
=> 7.39954495429993

>> (end_time.to_f - start_time.to_f).to_i
=> 7 
```

否则，您可以查看在`to_formatted_s`DateTime 对象上使用并查看是否可以将输出哄骗为`Decimal`类将接受的内容，或者只是将其格式化为纯 Unix 时间作为字符串并调用`to_i`它。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2016-06-21T21:57:52.030

其他人错误地依赖分数或辅助函数。它比这简单得多。DateTime 本身是下面的整数。这是红宝石的方式：

```
stop.to_i - start.to_i 
```

例子：

```
start = Time.now
 => 2016-06-21 14:55:36 -0700
stop = start + 5.seconds
 => 2016-06-21 14:55:41 -0700
stop.to_i - start.to_i
 => 5 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-11-06T01:39:36.430

我正在使用 ruby​​-2.1.4，对我来说，以下工作

```
Time.now - Time.new(2014,11,05,17,30,0) 
```

**给了我以秒**为单位的时差

 **参考：[红宝石文档](http://www.ruby-doc.org/core-2.1.4/Time.html#method-i-2D)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-02-24T14:35:22.350

有一种方法：

`Time.now.minus_with_coercion(10.seconds.ago)`

等于 10。

资料来源：[http ://apidock.com/rails/Time/minus_with_coercion](http://apidock.com/rails/Time/minus_with_coercion)

希望我有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-08-29T09:41:21.480

像这样定义一个Ruby函数，

```
def time_diff(start_time, end_time)
  seconds_diff = (start_time - end_time).to_i.abs

  days = seconds_diff / 86400 
  seconds_diff -= days * 86400

  hours = seconds_diff / 3600  
  seconds_diff -= hours * 3600

  minutes = seconds_diff / 60
  seconds_diff -= minutes * 60

  seconds = seconds_diff

  "#{days} Days #{hours} Hrs #{minutes} Min #{seconds} Sec"
 end 
```

并调用这个函数，

```
time_diff(Time.now, Time.now-4.days-2.hours-1.minutes-53.seconds) 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2016-08-12T15:55:08.127

为什么不使用内置的 "sec" 。这是一个例子：

```
t1 = Time.now.sec 

elapsed_t = Time.now.sec - t1

puts "it took me :  #{elapsed_t} seconds to do something that is useful \n" 
```

# javascript - jQuery 模态窗口从我的表单中删除元素

> ID：567637
> 
> 赞同：10
> 
> 时间：2009-02-19T22:58:32.027
> 
> 标签：javascript, jquery, dom

jQuery，当我使用它创建一个包含表单元素的模式窗口时，它会在我提交表单时取出这些元素。

表格示例：

```
<form enctype="multipart/form-data" action="/system/article/add/" class="from" method="post"> 

    <label for="article_title" class="required">Title:</label> 

    <input class="formfield" id="article_title" name="article_title" value="" type="text"> 

    <label for="url" class="required">Url:</label> 

    <input class="formfield" id="url" name="url" value="" type="text"> 

    <div id="add_photo" style="width: auto;" class="ui-dialog-content ui-widget-content"  title="Add Photo"> 
        <label for="photo_title" class="optional">Photo title:</label> 
        <input class="formfield" id="photo_title" name="photo_title" value="" type="text">
        <label for="photot" class="optional">Photo thumb:</label> 
        <input type="file" name="photot" id="photot" class="formfield">
        <label for="photo_checkbox" class="optional">Include lighbox?</label> 
        <input name="photo_checkbox" value="0" type="hidden"> 
        <input class="checkbox" id="photo_checkbox" name="photo_checkbox" value="1" type="checkbox"> 
        <label for="photo_big" class="optional">Photo:</label> 
        <input type="file" name="photo_big" id="photo_big" class="formfield"> 
    </div>
</form> 
```

JS的例子：

```
<script>
$(document).ready(function(){
    $("#add_photo").dialog({
        autoOpen: false,
        buttons: {
            "Ok": function() {
                $(this).dialog("close");
            }
        }
    });
}); 
```

所以我在通过firebug进行检查时注意到的是jquery实际上删除了我在#add_photo中的表单元素并将它们放在DOM中的表单之外，所以即使在html中模式对话框在我的表单中也很困难，在DOM中它不是。 ...

这就是我遇到问题的原因！

有没有人遇到过类似的问题？

有什么解决办法吗？！非常感谢你！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-20T14:26:47.057

我只是有同样的问题。我通过添加另一个解决了它

```
<div id="beforesubmit" style="display:none"></div> 
```

在表单的末尾（但在内部），然后您必须将其添加到 jQuery：

```
$("form").submit(function() {
    $("#add_photo").prependTo("#beforesubmit");
}); 
```

这将确保在提交表单之前，您的对话框 div 将被放回表单标签之间。多亏了*arnorhs*，我才找到了这个解决方案。

干杯!

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T23:55:13.827

表单需要在 div 内。这就是所有 Dialog 示例中的情况。如果标题和 url 输入不在对话框中，不确定您将如何做到这一点。你不能也把它们放在上面吗？

这不会有问题：

```
<div id="add_photo" style="width: auto;" class="ui-dialog-content ui-widget-content"  title="Add Photo"> 
  <form enctype="multipart/form-data" action="/system/article/add/" class="from" method="post"> 
    <label for="article_title" class="required">Title:</label> 
    <input class="formfield" id="article_title" name="article_title" value="" type="text"> 

    <label for="url" class="required">Url:</label> 
    <input class="formfield" id="url" name="url" value="" type="text"> 

    <label for="photo_title" class="optional">Photo title:</label> 
    <input class="formfield" id="photo_title" name="photo_title" value="" type="text">
    <label for="photot" class="optional">Photo thumb:</label> 
    <input type="file" name="photot" id="photot" class="formfield">
    <label for="photo_checkbox" class="optional">Include lighbox?</label> 
    <input name="photo_checkbox" value="0" type="hidden"> 
    <input class="checkbox" id="photo_checkbox" name="photo_checkbox" value="1" type="checkbox"> 
    <label for="photo_big" class="optional">Photo:</label> 
    <input type="file" name="photo_big" id="photo_big" class="formfield"> 
  </form>
</div> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T00:02:14.713

我不确定您使用的是什么对话框插件，但我怀疑对话框插件正在将 DIV 从表单中拉出并将其放入页面正文中，因此它可以将框带到前面页面，在表单元素之外。

所以换个说法，为了让对话框插件让你的对话框出现在页面上所有内容的前面，它需要从它所在的任何元素中删除它，无论它是一个表单还是其他任何东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T14:12:56.780

[本文](http://mytechworld.officeacuity.com/?p=280)介绍了如何解决您的问题：

> 您会看到，我们在页面中途的内容已经用其他类进行了标记，最重要的是，放置在页面底部紧挨着结束标记之前。为什么这很重要？因为这也意味着您放置在此对话框中的任何 ASP.Net 控件也将出现在页面底部，在页面标记之外。这意味着您将无法在回发时处理它们。
> 
> 解决方案是什么？好吧，有两种选择：
> 
> 1.  将元素移回表单，并在单击按钮时手动提交
> 2.  创建对话框时克隆元素，然后将值克隆回来，触发单击原始按钮（或者，如果您只有一两个值要回传，只需将值分配给 ASP.Net 隐藏字段控件）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-06-23T20:15:15.210

来自[http://blog.coreycoogan.com/2010/12/01/jquerys-dialog-and-form-problems/](http://blog.coreycoogan.com/2010/12/01/jquerys-dialog-and-form-problems/)

通过做将它与表格联系起来`$("mydialog").parent().appendTo($("form:first"))`。

请注意，您必须在您已经打过电话之后再打这个电话`$("mydialog").dialog()`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-01-17T14:57:29.577

[从这个问题](https://stackoverflow.com/questions/22366741/jqueryui-dialog-window-not-inside-my-div-placed-under-body-how-to-keep-inside)的答案中可以看出，jQuery 对话框有一个字段`appendTo`，可用于配置初始化对话框（div-wise）的位置。

这似乎是解决问题的最少忍者解决方法版本。

# c# - 如何最好地为自定义类型实现 Equals？

> ID：567642
> 
> 赞同：42
> 
> 时间：2009-02-19T22:59:36.533
> 
> 标签：c#, .net, class

说一个 Point2 类，以及以下 Equals：

```
public override bool Equals ( object obj )

public bool Equals ( Point2 obj ) 
```

这是有效 C# 3 中显示的内容：

```
public override bool Equals ( object obj )
{
    // STEP 1: Check for null
    if ( obj == null )
    {
        return false;
    }

    // STEP 3: equivalent data types
    if ( this.GetType ( ) != obj.GetType ( ) )
    {
        return false;
    }
    return Equals ( ( Point2 ) obj );
}

public bool Equals ( Point2 obj )
{
    // STEP 1: Check for null if nullable (e.g., a reference type)
    if ( obj == null )
    {
        return false;
    }
    // STEP 2: Check for ReferenceEquals if this is a reference type
    if ( ReferenceEquals ( this, obj ) )
    {
        return true;
    }
    // STEP 4: Possibly check for equivalent hash codes
    if ( this.GetHashCode ( ) != obj.GetHashCode ( ) )
    {
        return false;
    }
    // STEP 5: Check base.Equals if base overrides Equals()
    System.Diagnostics.Debug.Assert (
        base.GetType ( ) != typeof ( object ) );

    if ( !base.Equals ( obj ) )
    {
        return false;
    }

    // STEP 6: Compare identifying fields for equality.
    return ( ( this.X.Equals ( obj.X ) ) && ( this.Y.Equals ( obj.Y ) ) );
} 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-19T23:01:29.510

在接受 obj 的那个中，如果 obj 的类型是 Point2，则调用类型特定的 Equals。在特定类型的 Equals 中，确保所有成员都具有相同的值。

```
public override bool Equals ( object obj )
{
   return Equals(obj as Point2);
}

public bool Equals ( Point2 obj )
{
   return obj != null && obj.X == this.X && obj.Y == this.Y ... 
   // Or whatever you think qualifies as the objects being equal.
} 
```

您可能还应该覆盖 GetHashCode 以确保“相等”的对象具有相同的哈希码。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-19T23:44:15.863

[MSDN 上](https://docs.microsoft.com/en-us/visualstudio/ide/reference/generate-equals-gethashcode-methods)也有一整套指南。你应该好好阅读它们，它既棘手又重要。

我觉得最有帮助的几点：

*   值类型没有标识，因此**`struct Point`**您通常会逐个成员进行比较。

*   引用类型通常具有标识，因此 Equals 测试通常在 ReferenceEquals 处停止（默认值，无需覆盖）。但也有例外，例如 string 和 your **`class Point2`**，其中一个对象没有有用的标识，然后您覆盖 Equality 成员以提供您自己的语义。在这种情况下，请按照指南首先通过 null 和其他类型的案例。

*   `GethashCode()`并且有充分的理由保持`operator==`同步。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-09-26T17:29:41.643

我使用的对我有用的技术如下。请注意，我仅基于单个属性 (Id) 而不是两个值进行比较。根据需要调整

```
using System;
namespace MyNameSpace
{
    public class DomainEntity
    {
        public virtual int Id { get; set; }

        public override bool Equals(object other)
        {
            return Equals(other as DomainEntity);
        }

        public virtual bool Equals(DomainEntity other)
        {
            if (other == null) { return false; }
            if (object.ReferenceEquals(this, other)) { return true; }
            return this.Id == other.Id;
        }

        public override int GetHashCode()
        {
            return this.Id;
        }

        public static bool operator ==(DomainEntity item1, DomainEntity item2)
        {
            if (object.ReferenceEquals(item1, item2)) { return true; }
            if ((object)item1 == null || (object)item2 == null) { return false; }
            return item1.Id == item2.Id;
        }

        public static bool operator !=(DomainEntity item1, DomainEntity item2)
        {
            return !(item1 == item2);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2019-03-16T05:01:39.357

使用 C# 7 和[`is type varname`模式匹配语法](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/is#type)提供了使用以下任一方法`Equals(object)`处理`null`和类型检查的清理：

```
// using strongly-typed overload of Equals
public override bool Equals(object obj) => (obj is Point2 other) && Equals(other);

public bool Equals(Point2 other); 
```

```
// using the == operator (requires != to also be defined)
public override bool Equals(object obj) => (obj is Point2 other) && this == other;

public static bool operator ==(Point2 lhs, Point2 rhs);
public static bool operator !=(Point2 lhs, Point2 rhs); 
```

（显然您需要提供相关方法存根的实现。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T23:02:52.343

*   定义身份的含义。如果引用身份，则默认继承的等于将起作用。
*   如果您需要定义一个值类型（以及因此的值标识）。
*   如果是类类型，但具有值语义，则定义。

您可能希望*同时*覆盖 Equals(object) 并定义 Equals(MyType)，因为后者避免了装箱。并覆盖相等运算符。

.NET Framework 指南书（第 2 版）的覆盖范围更广。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-12T15:37:02.733

还有一个 Fody 插件[Equals.Fody](https://github.com/Fody/Equals)自动生成 Equals() 和 GetHashCode()

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T23:03:26.603

谎言丹尼尔 L 说，

```
public override bool Equals(object obj) {
    Point2 point = obj as Point2; // Point2? if Point2 is a struct
    return point != null && this.Equals(point);
}

public bool Equals(Point2 point) {
    ...
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T23:04:13.683

```
public override bool Equals ( object obj )
{
   // struct
   return obj  is Point2 && Equals (  ( Point2 ) value );
   // class
   //return Equals ( obj as Point2 );
}

public bool Equals ( Point2 obj ) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-11-20T23:52:56.977

其他几个人已经发布了表格的轻微变体......

```
using System;
...
public override bool Equals ( object obj ) {
   return Equals(obj as SomeClass);
}

public bool Equals ( SomeClass someInstance ) {
    return Object.ReferenceEquals( this, someInstance ) 
        || ( !Object.ReferenceEquals( someInstance, null ) 
            && this.Value == someInstance.Value );
}

public static bool operator ==( SomeClass lhs, SomeClass rhs ) {
    if( Object.ReferenceEquals( lhs, null ) ) {
        return Object.ReferenceEquals( rhs, null );
    }
    return lhs.Equals( rhs );
    //OR
    return Object.ReferenceEquals( lhs, rhs )
            || ( !Object.ReferenceEquals( lhs, null ) 
                && !Object.ReferenceEquals( rhs, null )
                && lhs.Value == rhs.Value );
}

public static bool operator !=( SomeClass lhs, SomeClass rhs ) {
    return !( lhs == rhs );
    // OR
    return ( Object.ReferenceEquals( lhs, null ) || !lhs.Equals( rhs ) )
            && !Object.ReferenceEquals( lhs, rhs );
} 
```

试图找到一种方法来实现 operator == 使用 Equals 以避免重复值比较逻辑......没有任何冗余测试（ReferenceEquals 调用 w/相同的参数）或不必要的测试（这在实例中不能为 null.Equals方法）并且没有任何明确的条件（“ifs”）。与其说是有用的东西，不如说是脑筋急转弯。

我能想到的最接近的是这个，但*感觉*好像没有额外的方法应该是可能的:)

```
public bool Equals ( SomeClass someInstance ) {
    return Object.ReferenceEquals( this, someInstance ) 
        || (!Object.ReferenceEquals( someInstance, null ) && EqualsNonNullInstance( someInstance );
}

public static bool operator ==( SomeClass lhs, SomeClass rhs ) {
    return Object.ReferenceEquals( lhs, rhs ) 
    || ( !Object.ReferenceEquals( lhs, null ) && !Object.ReferenceEquals( rhs, null ) && lhs.EqualsNonNullInstance( rhs ) );
}

//super fragile method which returns logical non-sense
protected virtual bool EqualsNonNullInstance ( SomeClass someInstance ) {
    //In practice this would be a more complex method...
    return this.Value == someInstance.Value;
} 
```

记住这一切是多么乏味和容易出错（我几乎可以肯定上面的代码中有一个错误......这仍然很糟糕，因为谁想要子类化一个 Type*只是*为了让相等检查稍微简单一点？），我想我往前走'将只创建一些静态方法来处理所有空检查并接受委托或要求和接口来执行值的比较（真正将 Type 更改为 Type 的唯一部分）。

如果我们可以在需要比较的字段/属性/方法上添加属性并让编译器/运行时处理所有乏味的事情，那就太好了。

还要确保 GetHashCode() 值对于任何 .Equals(object) 返回 true 或可能发生疯狂的事情的实例都是相等的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-12-18T13:30:28.373

覆盖 Equals 的简单且最佳的方法如下所示：

```
public class Person
    {
        public int Age { get; set; }
        public string Name { get; set; }

        public override bool Equals(object other)
        {
            Person otherItem = other as Person;

            if (otherItem == null)
                return false;

            return Age == otherItem.Age && Name == otherItem.Name;
        }
        public override int GetHashCode()
        {
            int hash = 13;
            hash = (hash * 7) + Age.GetHashCode();
            hash = (hash * 7) + Name.GetHashCode();
            return hash;
        }
    } 
```

重写 GetHashCode 方法以允许类型在哈希表中正常工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-03-16T14:39:19.547

我发现这对我有用 - 我让 GetHashCode() 完成所有繁重的工作。

之后，任何两个对象相等当且仅当它们的哈希码相等。

```
 public override int GetHashCode() => <-- IMPLEMENT THIS -->
    public virtual bool Equals(T other) => other?.GetHashCode() == GetHashCode();
    public override bool Equals(object other) => Equals(other as T);
    public static bool operator ==(T item1, T item2) => item1?.GetHashCode() == item2?.GetHashCode();
    public static bool operator !=(T item1, Titem2) => !(item1 == item2); 
```

Wrapper 类的示例，它向 S 类型的密封类添加了一些信息。

```
public class Wrapper<S>
{
    public S obj;

    // Handle obj being null
    public override int GetHashCode() => obj?.GetHashCode() ?? 0;

    // The rest are the same as above
    public virtual bool Equals(Wrapper<S> other) => other?.GetHashCode() == GetHashCode();
    public override bool Equals(object other) => Equals(other as Wrapper<S>);
    public static bool operator ==(Wrapper<S> item1, Wrapper<S> item2) => item1?.GetHashCode() == item2?.GetHashCode();
    public static bool operator !=(Wrapper<S> item1, Wrapper<S> item2) => !(item1 == item2);
} 
```

# powershell - 如何从 PowerShell 中的脚本文件重新加载用户配置文件

> ID：567650
> 
> 赞同：52
> 
> 时间：2009-02-19T23:02:19.007
> 
> 标签：powershell, profile

我想从脚本文件重新加载我的用户配置文件。我认为从脚本文件中获取它的点可以解决问题，但它不起作用：

```
# file.ps1
. $PROFILE
```

但是，如果我从 PowerShell 的解释器中点源它，它确实有效。

**我为什么要这样做？**

每次我更新我的配置文件并想要测试它时，我都会运行这个脚本，所以我想避免重新启动 PowerShell 来刷新环境。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-20T13:48:34.230

如果您想从脚本全局刷新您的个人资料，则必须运行该脚本“点源”。

当您运行脚本时，所有配置文件脚本都在“脚本”范围内运行，并且不会修改您的“全局”范围。

为了让脚本修改您的全局范围，它需要是“点源”或以句点开头。

```
. ./yourrestartscript.ps1 
```

您在“yourrestartscript.ps1”中有您的个人资料脚本“dot-sourced”。您实际上正在做的是告诉“yourrestartscript”在当前范围内运行，并且在该脚本内，您是在告诉 $profile 脚本在脚本的范围内运行。由于脚本的作用域是全局作用域，因此配置文件中的任何变量集或命令都将发生在全局作用域中。

与跑步相比，这并没有给你带来太多优势

```
. $profile 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-03-31T14:59:13.120

因此，您标记为答案的方法可能在 Powershell 命令提示符内有效，但在 PowerShell ISE（对我而言，它提供了卓越的 PowerShell 会话）内无效，并且可能无法在其他 PowerShell 环境中正常工作.

这是一个我已经使用了一段时间的脚本，它在每个环境中都非常适合我。我只是将这个函数放入 ~\Documents\WindowsPowerShell 的 Profile.ps1 中，每当我想重新加载我的配置文件时，我都会对函数进行点源，即

```
. Reload-Profile 
```

这是功能：

```
function Reload-Profile {
    @(
        $Profile.AllUsersAllHosts,
        $Profile.AllUsersCurrentHost,
        $Profile.CurrentUserAllHosts,
        $Profile.CurrentUserCurrentHost
    ) | % {
        if(Test-Path $_){
            Write-Verbose "Running $_"
            . $_
        }
    }    
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-01-16T17:38:36.257

```
& $profile 
```

用于重新加载配置文件。

如果您的配置文件设置了别名或执行失败的导入，那么您将看到错误，因为它们已经在配置文件的先前加载中设置。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T23:27:45.250

你为什么要这样做？

因为它可能会创建重复项（附加到 $env:path）和设置常量/只读对象的问题导致错误。

[最近在microsoft.public.windows.powershell](http://groups.google.co.uk/group/microsoft.public.windows.powershell/browse_frm/thread/879c7ad109c35876?hl=en&q=reset+session+group:microsoft.public.windows.powershell#52ecdfd5ca247c11)上有一个关于此主题的主题。

如果您尝试重置会话的状态，则无法执行此操作，即使使用内部范围 ( `$host.EnterNestedPrompt()`)，因为能够在“所有范围”设置变量/别名/...。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T00:25:04.283

我找到了这个解决方法：

```
#some-script.ps1

#restart profile (open new powershell session)
cmd.exe /c start powershell.exe -c { Set-Location $PWD } -NoExit
Stop-Process -Id $PID
```

更详细的版本：

```
#publish.ps1
# Copy profile files to PowerShell user profile folder and restart PowerShell
# to reflect changes. Try to start from .lnk in the Start Menu or
# fallback to cmd.exe.
# We try the .lnk first because it can have environmental data attached
# to it like fonts, colors, etc.

[System.Reflection.Assembly]::LoadWithPartialName("System.Diagnostics")

$dest = Split-Path $PROFILE -Parent
Copy-Item "*.ps1" $dest -Confirm -Exclude "publish.ps1" 

# 1) Get .lnk to PowerShell
# Locale's Start Menu name?...
$SM = [System.Environment+SpecialFolder]::StartMenu
$CurrentUserStartMenuPath = $([System.Environment]::GetFolderPath($SM))
$StartMenuName = Split-Path $CurrentUserStartMenuPath -Leaf                                 

# Common Start Menu path?...
$CAD = [System.Environment+SpecialFolder]::CommonApplicationData
$allUsersPath = Split-Path $([System.Environment]::GetFolderPath($CAD)) -Parent
$AllUsersStartMenuPath = Join-Path $allUsersPath $StartMenuName

$PSLnkPath = @(Get-ChildItem $AllUsersStartMenuPath, $CurrentUserStartMenuPath `
                                        -Recurse -Include "Windows PowerShell.lnk")

# 2) Restart...
# Is PowerShell available in PATH?
if ( Get-Command "powershell.exe" -ErrorAction SilentlyContinue ) {

    if ($PSLnkPath) {

        $pi = New-Object "System.Diagnostics.ProcessStartInfo"
        $pi.FileName = $PSLnkPath[0]
        $pi.UseShellExecute = $true

        # See "powershell -help" for info on -Command
        $pi.Arguments = "-NoExit -Command Set-Location $PWD"

        [System.Diagnostics.Process]::Start($pi)
    }
    else { 

        # See "powershell -help" for info on -Command
        cmd.exe /c start powershell.exe -Command { Set-Location $PWD } -NoExit
    }
}
else {
    Write-Host -ForegroundColor RED "Powershell not available in PATH."
}

# Let's clean up after ourselves...
Stop-Process -Id $PID 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-07T09:50:11.147

这只是上面 guillermooo 答案中两行脚本的改进，它没有让新的 PowerShell 窗口进入我的正确目录。我相信这是因为 $PWD 是在新的 PowerShell 窗口的上下文中评估的，这不是我们希望 set-location 处理的值。

```
function Restart-Ps {
$cline = "`"/c start powershell.exe -noexit -c `"Set-Location '{0}'" -f $PWD.path
cmd $cline
Stop-Process -Id $PID
} 
```

按理说它不应该工作，因为它吐出的命令行格式不正确，但它似乎可以完成这项工作，这对我来说已经足够了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-12T06:55:08.213

因为几年后我偶然发现了这一点，所以我想补充一点，您可以使用调用运算符：`&`将您的配置文件与默认变量加载到您的配置文件：`$profile`。

因此，如果您的会话以某种方式无法加载您的个人资料（使用 cmder/conemu 发生在我身上），只需键入：

`& $profile`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-08-02T17:32:42.823

我用它来解决需要永远加载的配置文件。

开始运行：

```
powershell_ise -noprofile 
```

然后我运行了这个：

```
function Reload-Profile {
    @(
        $Profile.AllUsersAllHosts,
        $Profile.AllUsersCurrentHost,
        $Profile.CurrentUserAllHosts,
        $Profile.CurrentUserCurrentHost
    ) | % {
        if(Test-Path $_){
            Write-Verbose "Running $_"
            $measure = Measure-Command {. $_}
            "$($measure.TotalSeconds) for $_"
        }
    }    
}

. Reload-Profile 
```

感谢@Winston Fassett 让我更接近于找到我的问题。

# sql - SQL 查询将列结果转换为行

> ID：567655
> 
> 赞同：1
> 
> 时间：2009-02-19T23:03:13.250
> 
> 标签：sql, reporting, service

我正在使用报告服务制作报告图表。但是我的数据看起来像这样：

```
Table1
    C01    C02   C03   C04
    1      2     3     4

I need to do a sql query to return data that looks like this:
    Any_Col_name
    1
    2
    3
    4 
```

我将 MS Reporting Services 与 Oracle DB 一起使用。我无法重组表格。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T23:06:33.257

```
select c01 from table
union all
select c02 from table
union all
select c03 from table
union all
select c04 from table 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T23:20:44.190

如果您使用的是 Oracle 11G 及更高版本，您也可以为此使用 unpivot，它应该比 union all 更有效（没有测试过这个因为我没有 oracle 周围）

```
SELECT Any_Col_name  FROM table   
    UNPIVOT INCLUDE NULLS (Any_Col_name FOR Col IN (C01,C02,C03,C04)) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T23:05:59.107

看看这里。

[http://support.microsoft.com/kb/175574](http://support.microsoft.com/kb/175574)

它描述了如何在 SQL Server 中“旋转”表。我知道你说甲骨文购买你可能会从中收集到一些东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T13:35:57.520

我们已经多次解决了这个问题。您最好的行动计划是编写适当的 PL/SQL 函数，这些函数将遍历所有列，并将它们作为行输出。我说要这样做，因为这可能不是您最后一次使用此功能。

# java - 在 Java / Groovy 中计算经过的时间

> ID：567659
> 
> 赞同：46
> 
> 时间：2009-02-19T23:03:39.957
> 
> 标签：java, date, groovy

我有...

```
 Date start = new Date()

...
...
...

Date stop = new Date() 
```

我想得到这两个日期之间经过的年、月、日、小时、分钟和秒。

--

我会细化这个问题。

我只想得到经过的时间，作为一个绝对的衡量标准，即不考虑闰年，每个月的天数等。

因此，我认为不可能过去几年和几个月，我能得到的只是几天、几小时、几分钟和几秒。

更具体地说，我想告诉某项任务持续了例如

```
20 sec
13 min, 4 sec
2 h, 10 min, 2 sec
4 d, 4 h, 2 min, 2 sec 
```

所以请原谅我不够精确。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2010-05-03T11:01:30.090

我刚刚发现了这个来自 Groovy 的快速解决方案：

```
import groovy.time.TimeCategory 
import groovy.time.TimeDuration

Date start = new Date()

// do something here

Date stop = new Date()

TimeDuration td = TimeCategory.minus( stop, start )
println td 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-02-19T23:21:46.510

您可以使用除法和 mod 完成所有这些操作。

```
long l1 = start.getTime();
long l2 = stop.getTime();
long diff = l2 - l1;

long secondInMillis = 1000;
long minuteInMillis = secondInMillis * 60;
long hourInMillis = minuteInMillis * 60;
long dayInMillis = hourInMillis * 24;

long elapsedDays = diff / dayInMillis;
diff = diff % dayInMillis;
long elapsedHours = diff / hourInMillis;
diff = diff % hourInMillis;
long elapsedMinutes = diff / minuteInMillis;
diff = diff % minuteInMillis;
long elapsedSeconds = diff / secondInMillis; 
```

这应该会给你所有你要求的信息。

编辑：由于人们似乎很困惑，不，这不考虑闰年或夏令时切换之类的事情。这是纯粹的经过**时间**，这是 opensas 所要求的。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-19T23:08:30.520

使用标准的 Date API 并不容易。

您可能想查看[Joda Time](http://joda-time.sourceforge.net/)或[JSR-310](http://today.java.net/pub/a/today/2008/09/18/jsr-310-new-java-date-time-api.html)。

我不是 Joda 的专家，但我认为代码是：

```
Interval interval = new Interval(d1.getTime(), d2.getTime());
Period period = interval.toPeriod();
System.out.printf(
    "%d years, %d months, %d days, %d hours, %d minutes, %d seconds%n", 
    period.getYears(), period.getMonths(), period.getDays(),
    period.getHours(), period.getMinutes(), period.getSeconds()); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-09-21T14:59:29.390

关于JodaTime，我刚刚开始；感谢提出建议的响应者。这是建议的 Joda 代码的更精简版本：

```
Period period = new Period(d1.getTime(), d2.getTime());
System.out.printf(
    "%d years, %d months, %d days, %d hours, %d minutes, %d seconds%n", 
    period.getYears(), period.getMonths(), period.getDays(),
    period.getHours(), period.getMinutes(), period.getSeconds()); 
```

（不确定这是否有助于原始问题，但肯定是搜索者）。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2017-02-18T21:29:10.630

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-02-01T12:16:16.657

实际上，关于上述关于[Joda-Time](http://www.joda.org/joda-time/)的答案。

[使用 Joda-Time 的Period](http://www.joda.org/joda-time/apidocs/org/joda/time/Period.html)类有一种更简单的方法：

```
Period period = new Period(startDate, endDate);
System.out.println(PeriodFormat.getDefault().print(period)); 
```

要自定义输出，请查看[PeriodFormat](http://www.joda.org/joda-time/apidocs/org/joda/time/format/PeriodFormat.html)、[PeriodFormatter](http://www.joda.org/joda-time/apidocs/org/joda/time/format/PeriodFormatter.html)和[PeriodFormatterBuilder](http://www.joda.org/joda-time/apidocs/org/joda/time/format/PeriodFormatterBuilder.html)类。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-05-18T11:33:27.877

好吧，从 Java 1.5 开始，您应该使用[TimeUnit。](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/TimeUnit.html)

这是一个简单明了的例子。我认为在 groovy 中它可能会变短（一如既往）。

```
/**
 * Formats a given {@link Date} to display a since-then timespan.
 * @param created
 * @return String with a format like "3 minutes ago"
 */
public static String getElapsedTime(Date created) {
    long duration = System.currentTimeMillis() - created.getTime();
    long seconds = TimeUnit.MILLISECONDS.toSeconds(duration);
    long days = TimeUnit.MILLISECONDS.toDays(duration);
    long hours = TimeUnit.MILLISECONDS.toHours(duration);
    long minutes = TimeUnit.MILLISECONDS.toMinutes(duration);
    if (days > 0) {
        return days + " days";
    }
    if (hours > 0) {
        return hours + " hrs";
    }
    if (minutes > 0) {
        return minutes + " minutes";
    }

    return seconds + " seconds";
} 
```

哦，请避免多次退货；）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-19T23:15:13.593

嗯，如果我得到你的要求，你想知道如果：

开始 = 2001 年 1 月 1 日，上午 10:00:00.000 和

停止 = 2003 年 1 月 6 日，下午 12:01:00.000

你想要的答案是 2 年 0 个月 5 天 2 小时 1 分钟

不幸的是，这是一个似是而非的答案。如果日期是 1 月 2 日和 1 月 31 日呢？那是29天吗？好的，但是 2 月 2 日到 3 月 2 日是 28 (29) 天，但会被列为 1 个月吗？

在不知道上下文的情况下，除了几秒钟或几天之外的任何时间长度都是可变的，因为月份和年份的长度不同。2 个日期之间的差异应该是静态单位，可以从 stop.getTime() - start.getTime() 轻松计算（以毫秒为单位的差异）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-11-21T20:45:28.120

除了我推荐的上述出色的**JodaTime** [API](http://joda-time.sourceforge.net/)之外，您可以拥有的最佳标准 Java 替代方案是. 使用它很*麻烦*（这是一种轻描淡写的说法......看看这里的单行 JodaTime 示例），但您也可以用它计算经过的时间。重要的关键是您应该使用in 循环来获取年、月和日的经过值，以考虑闰日、年和世纪。您不应该从（毫秒）秒计算它们。**[`java.util.Calendar`](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html)*`Calendar#add()`***

 ***这是一个基本示例：

```
import java.util.Calendar;

public class Test {

    public static void main(String[] args) throws Exception {
        Calendar start = Calendar.getInstance();
        start.set(1978, 2, 26, 12, 35, 0); // Just an example.
        Calendar end = Calendar.getInstance();

        Integer[] elapsed = new Integer[6];
        Calendar clone = (Calendar) start.clone(); // Otherwise changes are been reflected.
        elapsed[0] = elapsed(clone, end, Calendar.YEAR);
        clone.add(Calendar.YEAR, elapsed[0]);
        elapsed[1] = elapsed(clone, end, Calendar.MONTH);
        clone.add(Calendar.MONTH, elapsed[1]);
        elapsed[2] = elapsed(clone, end, Calendar.DATE);
        clone.add(Calendar.DATE, elapsed[2]);
        elapsed[3] = (int) (end.getTimeInMillis() - clone.getTimeInMillis()) / 3600000;
        clone.add(Calendar.HOUR, elapsed[3]);
        elapsed[4] = (int) (end.getTimeInMillis() - clone.getTimeInMillis()) / 60000;
        clone.add(Calendar.MINUTE, elapsed[4]);
        elapsed[5] = (int) (end.getTimeInMillis() - clone.getTimeInMillis()) / 1000;

        System.out.format("%d years, %d months, %d days, %d hours, %d minutes, %d seconds", elapsed);
    }

    private static int elapsed(Calendar before, Calendar after, int field) {
        Calendar clone = (Calendar) before.clone(); // Otherwise changes are been reflected.
        int elapsed = -1;
        while (!clone.after(after)) {
            clone.add(field, 1);
            elapsed++;
        }
        return elapsed;
    }

} 
```

它应该打印我现在的年龄=）

哦，我应该补充一点，您可以“转换”`Date`为`Calendar`使用`Calendar#setTime()`.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-10T18:03:51.237

这很简单; 您应该设置正确的时区

```
import java.util.TimeZone;
import java.util.logging.Logger;

import org.joda.time.DateTimeZone;
import org.joda.time.format.DateTimeFormat;
import org.joda.time.format.DateTimeFormatter;

public class ImportData {

    private final static Logger log = Logger.getLogger(ImportData.class.getName());
    private final static DateTimeFormatter dtf = DateTimeFormat.forPattern("yyyy-MM-dd HH:mm:ss.SSS");
    private final static DateTimeFormatter dtfh = DateTimeFormat.forPattern("HH:mm:ss.SSS");

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) throws Exception {
       TimeZone.setDefault(TimeZone.getTimeZone("Europe/Berlin"));
       DateTimeZone.setDefault(DateTimeZone.forID("Europe/Berlin"));
       // Quotes connection=Quotes.getInstance();
       final long start  = System.currentTimeMillis();
       // do something here ...
       // connection.importTickdata();
       Thread.currentThread().sleep(2000);
       final long end  = System.currentTimeMillis();
       log.info("[start]    " + dtf.print(start));
       log.info("[end]      " + dtf.print(end));
       TimeZone.setDefault(TimeZone.getTimeZone("UTC"));
       DateTimeZone.setDefault(DateTimeZone.forID("UTC"));
       log.info("[duration] " + dtfh.print(end - start));
       // connection.logOff();
       // System.exit(0);
    } 
```

返回：

```
10.11.2010 00:08:12 ImportData 主
信息：[开始] 2010-11-10 00:08:10.306
10.11.2010 00:08:12 ImportData 主
信息：[结束] 2010-11-10 00:08:12.318
10.11.2010 00:08:12 ImportData 主
信息：[持续时间] 00:00:02.012

```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-05-03T23:41:55.720

我通常这样做：

```
def start_time = System.currentTimeMillis()
...
def end_time = System.currentTimeMillis()

println  (end_time - start_time) +' ms' 
```

然后，您可以使用 Duration Groovy 类[http://docs.groovy-lang.org/latest/html/api/groovy/time/Duration.html](http://docs.groovy-lang.org/latest/html/api/groovy/time/Duration.html)将其分解为您想要的任何时间单位。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-08-17T16:09:55.113

```
import groovy.time.TimeCategory
import groovy.time.TimeDuration

time = { closure ->
    use(TimeCategory) {
        def started = new Date()
        def res = closure()
        TimeDuration duration = new Date() - started
        logger.info("Execution duration: " + duration.toMilliseconds() + "ms")
        res
    }
}

time {
    println 'A realy heavy operation here that you want to measure haha'
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-21T19:49:13.383

创建一个 Date 对象是没有意义的，因为它所做的只是包装 System.currentTimeMillis()。getTime() 函数只是解开 Date 对象。我建议你只使用这个函数来获取一个long。

如果您只需要第二精度，这很好。但是，如果您想要亚毫秒精度，请使用 System.nanoTime() 来获取经过时间。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-10-17T11:11:41.150

这是另一个类似的功能，如果不需要，它不会显示天、小时、分钟等，如果需要，请更改其文字。

```
public class ElapsedTime {

    public static void main(String args[]) {

        long start = System.currentTimeMillis();
        start -= (24 * 60 * 60 * 1000 * 2);
        start -= (60 * 60 * 1000 * 2);
        start -= (60 * 1000 * 3);
        start -= (1000 * 55);
        start -= 666;
        long end = System.currentTimeMillis();
        System.out.println(elapsedTime(start, end));

    }

    public static String elapsedTime(long start, long end) {

        String auxRet = "";

        long aux = end - start;
        long days = 0, hours = 0, minutes = 0, seconds = 0, milliseconds = 0;
        // days
        if (aux > 24 * 60 * 60 * 1000) {
            days = aux / (24 * 60 * 60 * 1000);
        }
        aux = aux % (24 * 60 * 60 * 1000);
        // hours
        if (aux > 60 * 60 * 1000) {
            hours = aux / (60 * 60 * 1000);
        }
        aux = aux % (60 * 60 * 1000);
        // minutes
        if (aux > 60 * 1000) {
            minutes = aux / (60 * 1000);
        }
        aux = aux % (60 * 1000);
        // seconds
        if (aux > 1000) {
            seconds = aux / (1000);
        }
        milliseconds = aux % 1000;

        if (days > 0) {
            auxRet = days + " days ";
        }
        if (days != 0 || hours > 0) {
            auxRet += hours + " hours ";
        }
        if (days != 0 || hours != 0 || minutes > 0) {
            auxRet += minutes + " minutes ";
        }
        if (days != 0 || hours != 0 || minutes != 0 || seconds > 0) {
            auxRet += seconds + " seconds ";
        }
        auxRet += milliseconds + " milliseconds ";

        return auxRet;
    }

} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-08-19T17:16:00.970

这是我基于**Sebastian Celis**回答实现的完整功能。再说一次，从他的帖子来看 -*这没有考虑闰年或夏令时切换等因素。纯粹是经过的时间*。

输出是根据我的需要量身定制的。这仅输出三个重要部分。而不是返回

> 4 个月 2 周 3 天 7 小时 28 分 43 秒

它只返回前 3 个块*（请参阅帖子末尾的更多示例运行）*：

> 4个月，2周，3天

这是完整的方法源代码：

```
/**
 * Format milliseconds to elapsed time format
 * 
 * @param time difference in milliseconds
 * @return Human readable string representation - eg. 2 days, 14 hours, 5 minutes
 */
public static String formatTimeElapsedSinceMillisecond(long milisDiff) {
    if(milisDiff<1000){ return "0 second";}

    String formattedTime = "";
    long secondInMillis = 1000;
    long minuteInMillis = secondInMillis * 60;
    long hourInMillis = minuteInMillis * 60;
    long dayInMillis = hourInMillis * 24;
    long weekInMillis = dayInMillis * 7;
    long monthInMillis = dayInMillis * 30;

    int timeElapsed[] = new int[6];
    // Define time units - plural cases are handled inside loop
    String timeElapsedText[] = {"second", "minute", "hour", "day", "week", "month"};
    timeElapsed[5] = (int) (milisDiff / monthInMillis); // months
    milisDiff = milisDiff % monthInMillis;
    timeElapsed[4] = (int) (milisDiff / weekInMillis); // weeks
    milisDiff = milisDiff % weekInMillis;
    timeElapsed[3] = (int) (milisDiff / dayInMillis); // days
    milisDiff = milisDiff % dayInMillis;
    timeElapsed[2] = (int) (milisDiff / hourInMillis); // hours
    milisDiff = milisDiff % hourInMillis;
    timeElapsed[1] = (int) (milisDiff / minuteInMillis); // minutes
    milisDiff = milisDiff % minuteInMillis;
    timeElapsed[0] = (int) (milisDiff / secondInMillis); // seconds

    // Only adds 3 significant high valued units
    for(int i=(timeElapsed.length-1), j=0; i>=0 && j<3; i--){
        // loop from high to low time unit
        if(timeElapsed[i] > 0){
            formattedTime += ((j>0)? ", " :"") 
                + timeElapsed[i] 
                + " " + timeElapsedText[i] 
                + ( (timeElapsed[i]>1)? "s" : "" );
            ++j;
        }
    } // end for - build string

    return formattedTime;
} // end of formatTimeElapsedSinceMillisecond utility method 
```

以下是一些示例测试语句：

```
System.out.println(formatTimeElapsedSinceMillisecond(21432424234L));
// Output: 8 months, 1 week, 1 day

System.out.println(formatTimeElapsedSinceMillisecond(87724294L));
// Output: 1 day, 22 minutes, 4 seconds

System.out.println(formatTimeElapsedSinceMillisecond(123434L));
// Output: 2 minutes, 3 seconds 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2011-01-30T01:21:43.923

这是一个问题，需要制定一种算法来考虑闰年以及除年之外的确切月数和天数。有趣的是，如果只使用一种计量单位，那是多么简单。例如，两天之间的总天数是正确的，与在假设两个十年内计算的月数和年数之后的提醒天数相比。

我目前正在努力从我的 PML 实现中提供它，例如，以以下形式：

```
unemployed <- date.difference[
    From = 2009-07-01, 
    Till = now, 
    YEARS, MONTHS, DAYS
]: yyyy-MM-dd

$$-> *unemployed -> date.translate[ YEARS, MONTHS, DAYS ] -> print["Unemployed for:", .] 
```

当然，这对于精确的利率计算也是有用的和必需的。

# ruby - 检测 ruby 测试方法的覆盖

> ID：567660
> 
> 赞同：3
> 
> 时间：2009-02-19T23:03:48.597
> 
> 标签：ruby, unit-testing, testunit

如果你写一个像这样的测试类

```
class MyTest < Test::Unit::TestCase 
  def setup 
  end

  def test_1 
    flunk
  end

  def test_1 
    assert true
  end
end 
```

第一个 test_1 被忽略。尽管这看起来像一个愚蠢的错误，但它可能发生在复制和粘贴编程中。除了跑步

```
grep test test_me.rb | wc 
```

并将其与测试单元运行的测试数量、使用 rcov 或 heckle 或使用 -w 运行进行比较，您如何检测到此类问题？

另外，有没有办法指定测试方法不应该被覆盖？

**编辑**：被测试的方法有一个带有 6 个左右可能值的参数，测试人员想要测试每个场景。这就是使用复制和粘贴编程的原因。对于这种情况，我可以设想的唯一替代方案是参数和预期值的六元素数组。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T17:44:07.067

您可以利用在`method_added`任何时候将方法添加到类中时都会调用的 Ruby。您应该能够将某些内容放入您包含的模块中，但这里有一个在您的测试类中执行此操作的简单示例。

```
class MyTest < Test::Unit::TestCase

  @@my_tests = []

  def self.method_added(sym)
    raise "#{sym} already defined!" if @@my_tests.include? sym
    @my_tests << sym
  end

  def test_foo_1
  end

  def test_foo_2
  end

  def test_foo_1
  end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T10:00:58.840

> 编辑：被测试的方法有一个带有 6 个左右可能值的参数，测试人员想要测试每个场景。这就是使用复制和粘贴编程的原因。

在这种情况下，我这样做：

```
def test_foo
  test_cases = [
   {:param => 1, :expected => 'whatever is expected'},
   {:param => 2, :expected => 'whatever is expected'},
   {:param => 3, :expected => 'whatever is expected'},
   {:param => 4, :expected => 'whatever is expected'},
   {:param => 5, :expected => 'whatever is expected'},
   {:param => 6, :expected => 'whatever is expected'}
  ]

  for test_case in test_cases
    do_the_test(test_case)
  end
end

def do_the_test(test_case)
  # test code here
end 
```

这完全避免了复制和粘贴，正如已经说过的那样，这是不好的

> 对于这种情况，我可以设想的唯一替代方案是参数和预期值的六元素数组。

确切地！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-21T12:32:20.740

关于 HermanD 的回答，既然这是 Ruby！，您也可以直接在类中执行此操作以创建独特的测试方法：

```
class MyObjectTest < Test::Unit::TestCase
  [
   {:param => 1, :expected => 'whatever is expected'},
   {:param => 2, :expected => 'whatever is expected'},
   {:param => 3, :expected => 'whatever is expected'},
   {:param => 4, :expected => 'whatever is expected'},
   {:param => 5, :expected => 'whatever is expected'},
   {:param => 6, :expected => 'whatever is expected'}
  ].each do |test_case|
    define_method :"test_using_#{test_case[:param]}_should_return_#{params[:expected].underscore}" do
      assert_equal test_case[:expected], MyObject.new.do_something_with(test_case[:param])
    end
  end
end 
```

使用 Rspec（或 Shoulda 的）句子之类的语言感觉更自然：

```
describe MyObject do
   [
   {:param => 1, :expected => 'whatever is expected'},
   {:param => 2, :expected => 'whatever is expected'},
   {:param => 3, :expected => 'whatever is expected'},
   {:param => 4, :expected => 'whatever is expected'},
   {:param => 5, :expected => 'whatever is expected'},
   {:param => 6, :expected => 'whatever is expected'}
  ].each do |test_case|
    it "should return #{test_case[:expected]} when using #{test_case[:param]}" do
      MyObject.new.do_something_with(test_case[:param]).should == test_case[:expected]
    end
  end
end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T23:16:09.303

如果您为测试提供正确的描述性名称，这真的是个问题吗？这是我最近项目中一些测试方法名称的示例：

```
test_should_not_do_html_escaping_for_administrators
test_should_not_be_able_to_create_project_with_company_user_doesnt_own
test_should_be_able_to_edit_own_projects
test_should_not_be_able_to_edit_others_projects 
```

如果您的测试名称足够短，以至于您可以轻松地覆盖或复制它们，那么您可能没有足够描述您在每个测试中实际测试的内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T12:16:54.590

避免复制粘贴编程。如果必须，重新绑定快捷键。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-09T22:49:48.300

gem 版本的 test-unit 能够检测从[2.0.7](http://rubyforge.org/forum/forum.php?forum_id=36565)开始重新定义的测试。

# tfs - TFS 的项目跟踪功能值得使用吗？

> ID：567663
> 
> 赞同：-1
> 
> 时间：2009-02-19T23:05:28.127
> 
> 标签：tfs

目前我们正在使用 SharePoint 进行项目跟踪。我们正在考虑为此使用 TFS，但我们对 TFS 和 SharePoint 不能很好地协同工作感到恼火。例如，您无法在 TFS 中获得从 SharePoint 获得的良好文档版本控制。

您对 TFS 项目跟踪有何看法？您是否发现它足够有用，可以证明被锁定在 Visual Studio/TFS 编辑器中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T23:16:26.133

> 例如，您无法在 TFS 中获得从 SharePoint 获得的良好文档版本控制。

那是什么追踪？任何项目（包括任务和源代码控制）都可以获得完整的版本历史记录？

MS 似乎很重视它（参见[VSTS 团队博客](http://msmvps.com/blogs/vstsblog/)），但它是否适合您的组织是一个完全不同的问题……您当然可以完全自定义工作项定义，然后链接到 Excel 和 Project（即编辑/质量观）。

# silverlight - 我应该如何在 Silverlight 中使用 MVVM 处理每个带有命令模式的控件的多个事件？

> ID：567672
> 
> 赞同：0
> 
> 时间：2009-02-19T23:07:11.523
> 
> 标签：silverlight, mvvm, command

是否有人使用 SLExtensions 命令模式 ( [http://www.codeplex.com/SLExtensions](http://www.codeplex.com/SLExtensions) ) 将命令与 Silverlight 控制事件相关联？从我所见，您只能为每个控件附加一个事件的命令。例如，您只能为按钮添加单击事件、为文本框添加 keydown 事件等。

如果我想为每个控件添加多个事件怎么办？例如，如果我想为按钮的 Click 和 Drop 事件添加命令怎么办。开箱即用似乎没有办法使用 SLExtensions 代码处理此问题。

顺便说一句，这是在模型-视图-视图模型 (MVVM) 上下文中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-22T18:15:40.857

dwynne - 你是绝对正确的。我可以使用您指定的代码处理 drop 事件。但是，我仍然必须在我的代码隐藏中实现事件处理程序，然后从那里调用我的 ViewModel。我试图通过在我的代码隐藏中尝试消除编码事件处理程序来遵守 MVVM。相反，我想通过使用附加的命令将我的 XAML 直接连接到我的 ViewModel。

SLExtensions 库允许您执行此操作，但（根据我的经验）每个控件只允许一个事件（单击按钮，keydown 用于文本框等）。对于任何重要的应用程序，这还不够，您的 MVVM 实现会崩溃。

很抱歉没有使用评论区，但 300 个字符有点限制。StackOverflow 的人——你需要提高这个限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T16:39:19.490

您在 XAML 中连接的事件有点有限，但如果 SLExtensions 不自然支持，则没有什么可以阻止您在代码隐藏/视图模型中执行此操作。

```
if (action == dropped)
{
  Commands.Dropped.Execute();
else
{
  Commands.Clicked.Execute();
} 
```

或者其他什么......如果我误解了你，一些你想做的示例代码会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T13:10:57.877

我不熟悉 SLExtensions，但在 WPF 中，每个控件都有一个命令的限制，这与控件实现相关联。如果您想为另一个事件执行命令，您必须自己连接。但是，有一个解决方案不需要您在后面的代码中进行此接线......附加行为。事实上，Caliburn ( [http://www.codeplex.com/caliburn](http://www.codeplex.com/caliburn) ) 正是用它的“动作”概念做到了这一点。我很长时间没有看过 Caliburn，也不知道它是否与 Silverlight 兼容，但是您当然可以查看 Actions 是如何在那里编码并实现自己的。

# asp.net - ASP.Net 3.5 SP1 机器密钥解密算法自动

> ID：567674
> 
> 赞同：1
> 
> 时间：2009-02-19T23:07:15.970
> 
> 标签：asp.net, machinekey

我在理解 machinekey 上的文档时遇到了一些麻烦。未设置解密属性时，使用什么算法加密/解密表单身份验证票证。我有：

```
<machineKey validationKey="128CharacterKey" decryptionKey="48CharacterKey" validation="3DES"/> 
```

我发现一些文档说如果没有专门设置解密属性，它将使用验证属性中的值。我还发现了一些说它会使用 SHA-1 的东西。还有一篇文章说它将基于decryptionKey中值的大小。

它使用的是哪种算法？

顺便说一句，现在大多数人使用哪种算法 AES、3DES、SHA1 等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T23:21:06.123

> 顺便说一句，现在大多数人使用哪种算法 AES、3DES、SHA1 等？

当然，新应用程序应该避免使用 3DES，而使用 AES 进行对称加密。还应避免使用 SHA1，并至少使用 SHA-256 进行散列。

默认值在[MSDN](http://msdn.microsoft.com/en-us/library/w8h3skw9%28v=vs.100%29.aspx)上：AES 和 SHA1（参见备注部分）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-03T23:57:07.900

您将需要阅读“Professional ASP.NET 3.5 Security, Membership and Role Management with C# and VB”的第 6 章。这是它的 Google 图书版本的链接，应该足够了......

如果您正在构建一个严肃的应用程序，那么您肯定会想要修改它。

[http://books.google.com/books?id=uAnOTcTR8l8C&pg=PA295&lpg=PA295PPA295,M1](http://books.google.com/books?id=uAnOTcTR8l8C&pg=PA295&lpg=PA295PPA295,M1)

# java - Java、C++、Python 和 ObjC 的在线编译器/运行时？

> ID：567682
> 
> 赞同：28
> 
> 时间：2009-02-19T23:10:31.483
> 
> 标签：java, c++, python, compiler-construction, runtime

有谁知道我可以在网上访问的好的在线编译器/运行时（用于 C++、Java、Python、ObjC 等）？

我正在寻找的是可以让我以网络形式输入程序并运行程序并在线查看结果的东西。

（我们暂时不讨论为什么。现在我只想说我并不总是可以访问编译器/运行时，并且启动 IDE 对于测试一些代码片段来说太过分了）

我知道 codepad.org——但我正在寻找更好的东西。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2010-04-02T10:22:05.867

[ideone](http://ideone.com)是更好的东西，但你需要什么特别的advence？

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-19T23:25:07.457

[http://codepad.org/](http://codepad.org/)

> codepad.org 是一个在线编译器/解释器，也是一个简单的协作工具。将您的代码粘贴到下面，codepad 将运行它并为您提供一个短 URL，您可以使用它在聊天或电子邮件中共享它。

语言：

C
C++
D
Haskell
Lua
OCaml
PHP
Perl
纯文本
Python
Ruby
Scheme
Tcl

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-08-17T22:15:28.693

现在，您可以使用[http://sagenb.org](http://sagenb.org)。这是一个免费的开源在线类似 Google Docs 的编程笔记本环境，由我提供（感谢国家科学基金会的慷慨资助）。创建帐户并创建新工作表后，单击标有“Sage”的框（左起第四个）并将其更改为 Python。现在您输入的所有代码都使用 Python 进行评估。主要缺点是该资源有超过 30,000 名用户，因此有时速度很慢。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-22T05:25:01.877

我找到了这个在线 java 编译器和运行器。它可以实时工作，也可以与线程一起工作。惊人的 ！ [http://www.browxy.com](http://www.browxy.com)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T23:18:15.210

对于 C++，您可以尝试[CodeControl](http://www.codecontrol.blogspot.com/2007/08/online-c-c-compiler.html)、[Comeau](http://www.comeaucomputing.com/tryitout/)或[code.vcer.net](http://code.vcer.net/)中的那个。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T00:24:11.307

[这个](http://tryruby.hobix.com/)适合红宝石。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-10-12T03:48:40.463

这是一个开源的：[http](http://codenode.org) ://codenode.org ，它很好地支持 Python 和 Sage，但也旨在支持其他语言，如 Ruby、R 等。可能对 Codenode 的最佳描述是“Google docs 与 Mathematica Notebooks 结合”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T23:17:23.900

CodeIDE 不错： http: [//www.codeide.com/](http://www.codeide.com/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T00:15:26.150

[您可以在这里](http://sqlcourse.com/)练习您的 SQL 。

# windows - 适用于 Windows 的视频捕获 SDK 和框架

> ID：567684
> 
> 赞同：5
> 
> 时间：2009-02-19T23:10:52.327
> 
> 标签：windows, frameworks, sdk, video-capture

我找不到描述 Windows 中视频捕获的所有不同选项的列表。我想将此列表保留给非专有 SDK（即 ImageSource 有自己的 SDK，仅适用于 ImageSource 采集卡）。要设置建议的年龄限制，一切都应该能够在 Windows XP 或更高版本上运行。包括你想要的关于你的建议的尽可能多的信息。只是开始：

1.  [DirectShow](http://msdn.microsoft.com/en-us/library/dd375454%28VS.85%29.aspx)（微软）
2.  [媒体基金会](http://msdn.microsoft.com/en-us/library/ms694197.aspx)（微软）
3.  [LeadTools Multimedia Capture SDK](http://www.leadtools.com/SDK/Multimedia/Multimedia-Capture.htm)（领先技术） - 商业
4.  [视频捕获 SDK](http://www.visioforge.com/video-capture-sdk.html) (visioforge) - 商业
5.  [VideoLAN](http://www.videolan.org/)（VLC 项目）- GPL

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T15:40:32.887

*   [CMU 1394 数码相机驱动程序](http://www.cs.cmu.edu/~iwan/1394/)（卡内基梅隆大学） - 免费
*   [OpenCV](http://opencv.willowgarage.com/wiki/)（开源）- BSD

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-15T10:10:42.880

另一种视频捕获 SDK 是 Datastead：[http ://datastead.com/](http://datastead.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T14:01:51.650

还有几个：

*   [Twain](http://www.twain.org/) - 主要用于扫描仪和类似设备，但也支持某些相机。AFAIK Twain 有自己的许可证并且是免费的。
*   [libdc1394](http://sourceforge.net/projects/libdc1394) - LGPL

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T02:49:02.780

只是为了澄清：

*   [OpenCV1.0](http://opencv.willowgarage.com/wiki/)依赖[vfw](http://en.wikipedia.org/wiki/Video_for_Windows)
*   [OpenCV1.1](http://opencv.willowgarage.com/wiki/)依赖于[videoinput 库](http://muonics.net/school/spring05/videoInput/)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-04T19:31:52.940

还：

*   [Medialooks MPlatform](http://www.medialooks.com/mplatform/) - 用于 24/7 视频记录、时移、同步流媒体等。与 Blackmagic、Deltacast 和 Stream Labs 硬件完全集成；通过 DirectShow 支持的网络摄像头和摄像机。还支持 Windows XP。

# c# - 除了这样，为什么我不能访问受 C# 保护的成员？

> ID：567705
> 
> 赞同：42
> 
> 时间：2009-02-19T23:21:05.513
> 
> 标签：c#, overriding, protected, access-modifiers

这段代码：

```
abstract class C
{
    protected abstract void F(D d);
}

class D : C
{
    protected override void F(D d) { }

    void G(C c)
    {
        c.F(this);
    }
} 
```

生成此错误：

> 无法通过“C”类型的限定符访问受保护的成员“CF(D)”；限定符必须是“D”类型（或派生自它）

他们到底在想什么？（更改该规则会破坏某些东西吗？）除了公开 F 之外，还有其他方法吗？

* * *

编辑：我现在明白了为什么会这样（谢谢[Greg](https://stackoverflow.com/questions/567705/why-cant-i-access-c-protected-members-except-like-this/567732#567732)）但我仍然对理性感到有些困惑；给定：

```
class E : C
{
    protected override void F(D d) { }
} 
```

为什么D*不能*调用 EF？

* * *

错误消息已编辑，因此我可能在其中输入了错字。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-19T23:34:36.467

这不起作用的原因是因为 C# 不允许跨层次调用受保护的方法。假设有一个类`E`也派生自`C`：

```
 C
 / \
D   E 
```

然后，您尝试调用该方法的引用实际上可能是类型的实例，`E`因此该方法可以在运行时解析为`E.F`. 这在 C# 中是不允许的，因为`D`不能调用`E`的受保护方法，因为`E`它位于层次结构的另一个分支中，即

```
var d = new D();
var e = new E();
d.G(e); // oops, now this will call E.F which isn't allowed from D 
```

这是有道理的，因为关键字`protected`意味着成员“[可在其类中和派生类实例中访问](http://msdn.microsoft.com/en-us/library/bcd5672a.aspx)”，而 EF 不是 D 的成员。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-19T23:29:58.707

“protected”关键字意味着只有一个类型和从该类型派生的类型才能访问该成员。D 与 C 没有关系，因此无法访问该成员。

如果您希望能够访问该成员，您有几个选择

*   公开
*   使其成为内部。这将允许任何类型访问同一程序集中的成员（或者如果您添加朋友的其他程序集）
*   从 C 导出 D

**编辑**

在 C# 规范的第 3.5.3 节中提到了这种情况。

不允许这样做的原因是因为它允许跨层次结构调用。想象一下，除了 D 之外，还有另一个名为 E 的 C 基类。如果您的代码可以编译，它将允许 D 访问成员 EF 这种情况在 C# 中是不允许的（我*相信*CLR，但我不相信） t 100% 知道）。

**EDIT2**为什么这很糟糕

警告，这是我的看法

现在允许这样做的原因是它很难推理类的行为。访问修饰符的目标是让开发人员准确控制谁可以访问特定方法。想象下面的课

```
sealed class MyClass : C {
  override F(D d) { ... } 
} 
```

考虑一下如果 F 是一个时间要求严格的函数会发生什么。根据当前的行为，我可以推断我的课程的正确性。毕竟只有两种情况会调用 MyClass.F。

1.  在 C 中调用它的位置
2.  我在 MyClass 中明确调用它的地方

我可以检查这些调用，并就 MyClass 的功能得出一个合理的结论。

现在，如果 C# 确实允许跨层次保护访问，我无法做出这样的保证。完全不同的程序集中的任何人都可以从 C 中派生。然后他们可以随意调用 MyClass.F。这使得完全不可能推理我的课程的正确性。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-19T23:43:08.067

即使 D 继承自 C，D 也无法访问 C 的受保护成员。D 可以访问 D 的受保护（和私有！）成员，因此如果您将 D 的另一个实例而不是 C 放在那里，一切都会正常工作。但正如 Greg 所说，C 可能真的是完全不同的东西，因为编译器不知道 C 到底是什么，它必须阻止 D 访问 D 可能实际上无法访问的东西。

从 C# 编译器的角度解释这一点的一系列帖子：

*   [为什么我不能从派生类访问受保护的成员](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/why-cant-i-access-a-protected-member-from-a-derived-class)
*   [为什么我不能从派生类访问受保护的成员，第二部分：为什么我可以？](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/why-cant-i-access-a-protected-member-from-a-derived-class-part-two-why-can-i)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-06-27T17:08:52.807

可以通过使用静态保护方法绕过此限制：

```
abstract class C
{
    protected abstract void F (D d);

    // Allows calling F cross-hierarchy for any class derived from C
    protected static void F (C c, D d)
    {
        c.F(d);
    }
}

class D : C
{
    protected override void F (D d) { }

    void G (C c)
    {
        // c.F(this);
        F(c, this);
    }
} 
```

从安全的角度来看，这并不完美（任何人都可以从 派生`C`），但是如果您只关心`F`从类的公共接口中隐藏方法，那么`C`这个技巧可能很有用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-03-17T04:32:07.020

简单地说：访问**实例的**受保护成员被视为公共访问，即使您尝试从派生类中这样做。因此，它被拒绝了。

* * *

这里和那里有很多答案，但没有一个让我明白“为什么我不能从孩子那里访问父类的受保护成员”。以上是我在阅读了这些令人困惑的答案后再次查看我的代码后所理解的。

例子：

```
class Parent
{
    protected int foo = 0;
}

// Child extends from Parent
class Child : Parent
{
    public void SomeThing(Parent p)
    {
        // Here we're trying to access an instance's protected member.
        // So doing this...
        var foo = p.foo;
    }
}

// (this class has nothing to do with the previous ones)
class SomeoneElse
{
    public void SomeThing(Parent p)
    {
        // ...is the same as doing this (i.e. public access).
        var foo = p.foo++;
    }
} 
```

你会认为你可以访问，`p.foo`因为你在一个子类中，但你是从一个实例访问它，这就像一个公共访问，所以它被拒绝了。

您可以`protected`从类中访问成员，而不是从实例中访问成员（是的，我们知道这一点）：

```
class Child : Parent
{
    public void SomeThing()
    {
        // I'm allowed to modify parent's protected foo because I'm
        // doing so from within the class.
        foo++;
    }
} 
```

最后，为了完整起见，只有在同一个类中这样做时，您实际上才能访问实例`protected`甚至成员：`private`

```
class Parent
{
    protected int foo = 0;

    private int bar = 0;

    public void SomeThing(Parent p)
    {
        // I'm allowed to access an instance's protected and private
        // members because I'm within Parent accessing a Parent instance
        var foo = p.foo;
        p.bar = 3;
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-20T20:15:06.840

为了理解为什么这种行为是有意义的，让我们考虑一下为什么我们在面向对象的编程语言中需要访问修饰符。我们需要它们**来限制可以使用特定类成员的范围**。这反过来又简化了对用法的搜索。

总结一下：

*   **要查找公共**成员的所有用法，需要搜索**整个项目**（这对于独立开发人员使用的库来说是不够的）
*   **要查找受保护**成员的所有用法，需要搜索**容器类及其所有子类**
*   **要查找私有**成员的所有用法，需要搜索**容器类**。

因此，如果编译器允许以所描述的方式从超类调用受保护的方法，我们最终可能会得到[此答案](https://stackoverflow.com/questions/567705/why-cant-i-access-c-protected-members-except-like-this/567732#567732)中描述的受保护方法的跨层次调用。在这种情况下，必须搜索定义该成员的最父类的所有子类。这将扩大范围。

PS。在 Java 中实现了相同的行为。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-02T13:32:47.420

是的，有可能。我们很可能很快就会有这样的例子。

为此，您必须执行以下操作：

1.  继承默认表单 (EditAppointmentDialog) 并进行自定义（您甚至可以为此使用 winforms 设计器）。

公共部分类 CustomAppointmentEditDialog : EditAppointmentDialog { 私有 RadComboBox cmbShowTimeAs = null;

```
 public CustomAppointmentEditDialog() 
    { 
        InitializeComponent(); 

        this.cmbShowTimeAs = this.Controls["cmbShowTimeAs"] as RadComboBox; 
    } 

    private void chkConfirmed_ToggleStateChanged(object sender, StateChangedEventArgs args) 
    { 
        this.cmbShowTimeAs.SelectedValue = (args.ToggleState == ToggleState.On) ? 
            (int)AppointmentStatus.Busy : (int)AppointmentStatus.Tentative; 
    } 
} 
```

在上面的代码中，我添加了一个额外的复选框，如果未选中，则将约会的状态（显示时间）设置为暂定，如果选中，则将其设置为忙碌。访问组合框的奇怪方式是因为它目前是私有的。这将在即将发布的 2009 年第一季度版本中进行更改。

2.  订阅 RadScheduler 的 AppointmentEditDialogShowing 事件并将默认表单替换为您自定义的表单：

私人 IEditAppointmentDialog 约会EditDialog = null;

```
 protected override void OnLoad(EventArgs e) 
    { 
        base.OnLoad(e); 

        this.radScheduler1.AppointmentEditDialogShowing += new EventHandler<AppointmentEditDialogShowingEventArgs>(radScheduler1_AppointmentEditDialogShowing); 
    } 

    void radScheduler1_AppointmentEditDialogShowing(object sender, Telerik.WinControls.UI.AppointmentEditDialogShowingEventArgs e) 
    { 
        if (this.appointmentEditDialog == null) 
        { 
            this.appointmentEditDialog = new CustomAppointmentEditDialog(); 
        } 
        e.AppointmentEditDialog = this.appointmentEditDialog; 
    } 
```

我希望这有帮助。如果您还有其他问题，请随时给我回信。

# c# - 谷歌图片搜索

> ID：567710
> 
> 赞同：1
> 
> 时间：2009-02-19T23:23:25.463
> 
> 标签：c#, image

在 C# 中，如何提取使用 Google 进行搜索时找到的任何图像的 URL？我正在编写一个小应用程序来获取我翻录的 cd 的艺术作品。我试用了亚马逊服务，但发现我收到的结果不稳定。不过，我不会因为这个简单的小应用程序而费心去学习整个 Amazon API，所以我想试试 Google。

到目前为止，我已经执行了搜索并获得了结果页面的来源，但我不确定如何从中提取 URL。我知道我必须使用正则表达式，但不知道要使用什么表达式。我发现的所有东西似乎都坏了。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T23:25:51.383

尝试使用 HTML 敏捷包。它在抓取内容方面创造了奇迹。

它位于[Codeplex](http://www.codeplex.com/htmlagilitypack)上。

我用它从 so.com上抓取了一个[用户排名列表，我很喜欢它。](http://www.chrisballance.com/so)

它将让您选择一个 html 节点，然后使用 XSLT 查询子节点。

# json - JSON中的重复关键字值

> ID：567720
> 
> 赞同：3
> 
> 时间：2009-02-19T23:27:51.363
> 
> 标签：json, language-agnostic, parsing

在[JSON.org](http://json.org)上，JSON 表示的基本数据结构如下所示

1.  名称/值对的集合，以及
2.  值的有序列表。

我无法在任何地方找到与已经解析为当前对象的成员同名的第二个成员是否应该（a）抛出异常或（b）替换现有成员。

这是在任何地方指定的吗？

现有的解析器如何处理重复的名称？

编辑：我希望为我的解析器定义正确的行为。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T00:14:26.150

JSON 只是 JavaScript 的对象文字符号的一个子集，因此受到相同规则的约束 - 重复键的最新值将覆盖特定对象内该键的任何先前分配的值。考虑为对象属性赋值；稍后的分配将覆盖先前的分配。

为了证明这一点，我在[这里设置了一个示例](http://jsbin.com/amane)。代码显示在页面上，可以看出，消息框的名称为“Barney”。

代码在这里 -

```
$(function() {

    $('#myButton').click(function(e) 

    {

    var myJsonString =  "Person = {'firstName':'Fred','lastName':'Flintstone','firstName':'Barney'}";

    eval("(" + myJsonString + ")");

    alert(Person.firstName);

    });

}); 
```

顺便说一句，我在这里使用了 eval() 以方便使用。由于安全问题，我建议使用 JSON 解析器而不是 eval()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T23:31:34.553

解析器找到的他们的姓被新的替换。它不会产生期望。

它只是一个 Javascript 语法的东西。

```
var json = {};

// lets augment the object
json.one = 1;
json.one = 2; // it gets replaced 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T20:41:51.863

我很确定您列出的两种行为以及其他行为都会被接受（使用第一个，使用其中任何一个）。:-) 也就是说，这种行为在 JSON 规范 POV 中是未定义的。

实际上，我使用的实现要么执行您提到的建议之一，要么“使用第一个”。

所以不，我不会指望特定的行为，因为工具可以选择做什么。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T23:30:08.800

因为 JSON 只是 Javascript 的一个子集，它在很大程度上取决于 Javascript 规范。我个人不知道答案是什么，但我强烈建议尽可能不要依赖这种行为。

# delphi - 如何在 Delphi 中使用旋转的图像制作表单？

> ID：567731
> 
> 赞同：0
> 
> 时间：2009-02-19T23:32:20.433
> 
> 标签：delphi, image

就像我们在网站上看到的那样。我从哪里得到图像？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T23:37:26.083

转到[ajaxload](http://www.ajaxload.info/)生成图像。然后找一个delphi gif图片组件。尝试[在这里](http://delphi.about.com/od/graphics/a/delphigif.htm)开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T04:17:19.030

“旋转图像”通常是动画 GIF。谷歌搜索引号中的短语以了解它们，您还应该找到可以帮助您创建它们的软件。对它们的支持已经包含在 Delphi 中几年了。

如果动画 GIF 不够好，您可以查看 AVI 文件。它们是 Windows 用来显示正在复制的文件、正在扫描的文件夹和其他内容的工具。TAnimate 是支持它们的 Delphi 组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T01:07:48.480

我确实建议在单独的线程中运行您的“工作”。 [AsyncCalls](http://andy.jgknet.de/async)是一个很好的库，可以很好地帮助您轻松到达那里。紧密的循环或阻塞调用可能会导致您的动画看起来跳跃或完全停止。

# .net - 是否可以在.NET 中动态生成一个类？

> ID：567736
> 
> 赞同：0
> 
> 时间：2009-02-19T23:37:53.167
> 
> 标签：.net

我正在使用 [FileHelpers 库][1]

[1]：[http](http://www.filehelpers.com/) ://www.filehelpers.com/处理 Excel 电子表格和 CSV 文件。

FileHelpers 要求用户生成一个类，以便从电子表格中提取与电子表格上的数据完全映射的数据。它带有一个很棒的向导来生成类，而无需手动输入。但是，我想消除这个过程，让用户输入他们想要的字段并自动生成程序使用的类。

是否可以动态生成一个类并在应用程序运行时使用它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T23:40:20.820

当然。查看[System.CodeDom](http://msdn.microsoft.com/en-us/library/system.codedom.aspx)命名空间以获得您需要的工具。CodeDom 能够在运行时生成和加载类，并发出源代码以合并到项目中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T23:42:05.840

是的，但是生成类的原因可能是在编译时检查类型的完整性。您可以使用 Jeffrey 的链接来查找有关在运行时生成类的更多信息，也可以使用 Reflection.Emit。 [http://www.codeproject.com/KB/cs/DynamicCodeGeneration2.aspx](http://www.codeproject.com/KB/cs/DynamicCodeGeneration2.aspx)

# javascript - Scripting.Dictionary 访问方法？

> ID：567737
> 
> 赞同：0
> 
> 时间：2009-02-19T23:38:00.653
> 
> 标签：javascript, dictionary

当一个项目被添加到 Scripting.Dictionary 或在 javascript 中连接一个事件时，是否有访问拦截？

他们是否有访问器方法，例如。设置，获取与否？

```
var test = new ActiveXObject("Scripting.Dictionary");
test("a") = "test"; 
```

设置好后，我需要做更多的任务。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T23:50:03.417

简短的回答是：不，对不起。

但是问题确实出现了，为什么您在 JScript 中使用 Scripting.Dictionary？

```
var test = {};  test["a"] = "test"; 
```

很抱歉，它并没有那么有用，您无法截获 Scripting.Dictionary 或更传统的 Javascript 将对象用作关联数组。

但是，您可能可以构建一个包装其中任何一个的 Javascript 类，这样您就可以自己实现一个事件系统。它的工作量比您希望的要多得多。

# c# - 获取文件关联列表

> ID：567738
> 
> 赞同：1
> 
> 时间：2009-02-19T23:39:06.063
> 
> 标签：c#, .net, winforms

我有一个程序应该以不同的文件格式保存报告，如果有与文件扩展名关联的应用程序，则使用该应用程序打开该文件。

是否可以在 Windows 中获取所有与应用程序相关联的文件扩展名？

我尝试了注册表项 HK_CLASSES_ROOT{extension}，但我查看了一个基本的 windows xp（没有办公室），它仍然有各种扩展的密钥..

* * *

在尝试打开文件之前，我需要知道是否有任何关联，如果关联不存在，那么我需要在文件所在的 Windows 资源管理器中打开文件夹...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T23:42:17.057

您不必获取相关的应用程序。你可以简单地使用

```
System.Diagnostics.Process.Start("fileName.xyz"); 
```

使用关联的应用程序打开文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T23:15:19.140

我过去用过这个：http: [//www.codeproject.com/KB/dotnet/System_File_Association.aspx](http://www.codeproject.com/KB/dotnet/System_File_Association.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T23:50:39.483

看看命令行上的 ASSOC 命令。它可能会为您提供所需的信息。（试试 'assoc /?'，或者只是在 shell 中运行 'assoc'。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-18T17:56:55.593

使用 Powershell，您可以在 HKEY_CLASSES_ROOT 的注册表中列出所有文件扩展名

```
#============================================================================================================================================================ 
# AUTHOR:         metadataconsult@gmail.com 
# WEBSITE:        http://metadataconsulting.blogspot.com 
# 
# SCRIPT NAME:    GetAllFileExtensions.ps1   
# DATE:           17/10/2018  
# VERSION:        1.0.0.0
# 
# SYNPOSIS:       Get all file extensions from registry at HKEY_CLASSES_ROOT  
#
#============================================================================================================================================================ 

#set HKCR hack
New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT
$i=0
Get-ChildItem 'HKCR:\' | ForEach-Object {  

 If($_.name -Match "^HKEY_CLASSES_ROOT\\\..+") {
    $i++
    Write-Host  $_.Name.Replace("HKEY_CLASSES_ROOT\","")
 }

}
"$i file extensions in Registry @ HKEY_CLASSES_ROOT\" 
```

# iphone - 我是否需要制作 Ad Hoc Provisioning Profile 才能在 iPhone 上调试我的应用程序？

> ID：567741
> 
> 赞同：1
> 
> 时间：2009-02-19T23:40:45.577
> 
> 标签：iphone, debugging, adhoc

我想我只是对调试在真实设备上的工作方式一无所知 - 那是怎么做的？我一直在阅读 Apple 关于创建用于分发的配置文件的文档，但我没有找到任何信息来简单地通过 Xcode 调试在我的设备上运行的应用程序。有人可以指出我正确的方向吗？

* * *

**编辑（2/19/09）：** 关于是否需要创建临时配置文件来调试我的应用程序，我得到了相互矛盾的答案。如果我不需要创建临时配置文件，除了为自己准备开发配置文件和证书之外，我还需要做什么来调试我的应用程序？

* * *

**编辑（2/20/09）：** 这个链接，[iPhone Development Guide: Preparing Devices for Development](http://developer.apple.com/iphone/library/documentation/Xcode/Conceptual/iphone_development/128-Managing_Devices/chapter_6_section_3.html#//apple_ref/doc/uid/TP40007959-CH4-SW1)，似乎说你确实需要一个**开发**配置文件来调试设备。在我上次的编辑中，我提到我在是否需要创建临时配置文件方面得到了相互矛盾的答案。答案并不矛盾，我只是不明白临时配置文件和开发配置文件之间的区别。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T19:36:53.690

每当您编写要安装在 iPhone 上的软件时，您需要两件事：密钥和配置文件。密钥标识开发应用程序的人员；它保留在您的计算机上，用于对您构建的应用程序进行签名。该配置文件标识允许哪些设备运行由给定密钥签名的应用程序；它需要安装到设备上。

分发密钥基本上每个公司都有一个，并且仅在您构建一个打算在您的开发团队之外分发的应用程序版本时使用。（App Store 构建*必须*使用分发密钥进行签名。）开发密钥旨在为每个开发人员提供一个，但仅用于在积极开发应用程序时使用。

（如果您是个人开发者，当然，您只有一个开发者密钥和一个分发密钥。在我的机器上，我设置了 Keychain 要求分发密钥的密码，所以即使有人偷了我的笔记本电脑，他们也可以'不要发布危及用户安全的我的一个应用程序的更新。开发人员密钥只能将软件安装到我的个人手机上，没有密码。）

当您在自己的个人设备上进行测试并通过 Xcode 进行安装时，您需要一个开发配置文件和一个开发密钥。此开发配置文件应安装到 Xcode 中，然后将其安装到您的手机上。

当您分发给少数其他人时（例如，用于 Beta 测试，或者如果您编写了专门为特定客户提供的应用程序），您需要一个临时配置文件和一个分发密钥。您需要将临时配置文件与应用程序一起发送给用户。然后，用户可以将配置文件和应用程序都放入 iTunes 并同步他们的手机进行安装。

当您通过 App Store 分发时，您需要 App Store 配置文件和分发密钥。以这种方式构建的构建无法在您控制的任何设备上运行，但 Apple 的提交工具要求它们使用此配置文件构建。

因此，回答您的问题：您需要配置您的设备，但它必须是开发配置文件，而不是临时配置文件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-19T23:47:52.737

不，您不需要 Ad Hoc 配置文件来调试应用程序，您只需要在您的设备上为您自己提供一个开发配置文件和证书。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T23:45:21.430

您需要配置设备，是的。IIRC 您需要使用 Apple 的在线工具，然后使用 Xcode 进行配置，之后您就可以在设备上对其进行调试。

[有关更多信息，请参阅此博客](http://boga.wordpress.com/2008/07/16/debugging-ipod-provision-profilescertificates/)上的第一篇文章。

# vb.net - 计算赢/输百分比

> ID：567743
> 
> 赞同：0
> 
> 时间：2009-02-19T23:41:33.327
> 
> 标签：vb.net

我需要计算赢得比赛和输掉比赛的百分比。我不断收到错误，这让我陷入困境。我已经多次更改我的代码，以至于我真的不记得我开始时的样子。

```
Private Sub btnPercentage_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnPercentage.Click
    Dim team As String
    Dim won, lost, percentage As Integer

    team = CStr(txtTeam.Text)
    won = CInt(txtGamesWon.Text)
    lost = CInt(txtGamesLost.Text)
    percentage = CInt(txtPercent.Text)

    percentage = (won + lost) / 2

    txtPercent.Text = team & " won" & percentage & " of its games." 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T23:46:46.437

在开始编写代码之前，请先在脑海中思考问题。现在这是您的代码的工作方式：

“A 队赢了 5 场比赛输了 3 场，所以它赢球的百分比是 (5 + 3) / 2 = 4%”

作为一名程序员，最重要的一项技能可能是能够将问题分解为计算机执行的步骤，确保在开始编写它们之前找出正确的步骤。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T23:44:32.010

胜率=总胜率/（总胜率+总输数）

出于显示目的，您可能必须将其乘以 100。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T00:07:24.263

```
Dim team as String = txtTeam.Text  
Dim won as Integer = Cint(txtGamesWon.Text)  
Dim lost as Integer = CInt(txtGamesLost.Text)  
Dim percentage as Integer = Cint(won / (won + lost) * 100)  
txtPercent.Text = team & " won " & percentage & "% of its games." 
```

如果你想让它更能抵抗错误的输入，你可以使用 Integer.TryParse 而不是 Cint。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T23:45:36.470

`percentage = (won + lost) / 2`不可能是对的。

不是赢的百分比吗`percentage_won = won / (won + lost)`。

并且损失的百分比`percentage_lost = lost / (won + lost)`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T23:49:17.913

```
percentage = won / (won + lost) 
```

顺便说一句，如果 Visual Studio 不吐槽：

```
Dim won, lost, percentage As Integer 
```

它将作为对象而不是整数变暗。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T00:48:23.573

您在这里的大部分问题甚至都与编程无关。

首先了解计算百分比背后的简单数学是有帮助的。这个应该相对简单，首先在纸上解决。

当我阅读时，我的眼睛开始流血：

```
percentage = (won + lost) / 2. 
```

百分比不应等于比赛场数的一半（尽管许多 MLB 球队会挖掘有该记录）。

# .net - .NET 中的 BigInt 类应该使用什么？

> ID：567753
> 
> 赞同：5
> 
> 时间：2009-02-19T23:45:34.787
> 
> 标签：.net, biginteger

在 BCL 最终发布[System.Numeric.BigInt](http://blogs.msdn.com/bclteam/archive/2008/01/04/where-did-biginteger-go-melitta-andersen.aspx)之前，你们用什么来处理任意精度整数？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T00:10:29.513

你可以在 codeplex 上试试我的：[BigInteger](http://www.codeplex.com/biginteger)

或者这里是另一个：[codeproject](http://www.codeproject.com/KB/cs/biginteger.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T00:34:54.933

F# 有`Microsoft.FSharp.Math.BigInt`和`Microsoft.FSharp.Math.BigNum`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-23T17:52:03.763

此外，[J# 库包括一个 BigInt 类型](https://stackoverflow.com/questions/176775/big-integers-in-c)。

值得庆幸的是，当 BCL 最终发布标准化的 BigInt 时，所有这些都会得到解决。

***更新 2012*** [System.Numberics.BigInteger](http://msdn.microsoft.com/en-us/library/system.numerics.biginteger.aspx)现在包含在 .NET 框架中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T23:51:20.917

看一下

[IronRuby.StandardLibrary.BigDecimal.BigDecimal](http://www.ironruby.net/)

# unix - 如何区分“二进制”和“文本”文件？

> ID：567757
> 
> 赞同：72
> 
> 时间：2009-02-19T23:46:35.437
> 
> 标签：unix, language-agnostic, ascii, binaryfiles, file-format

非正式地，我们大多数人都知道存在“二进制”文件（对象文件、图像、电影、可执行文件、专有文档格式等）和“文本”文件（源代码、XML 文件、HTML 文件、电子邮件等）。

通常，您需要知道文件的内容才能对它做任何有用的事情，并且如果编码是“二进制”或“文本”，这并不重要。当然，文件只是存储数据字节，所以它们都是“二进制”，而“文本”在不知道编码的情况下没有任何意义。然而，谈论“二进制”和“文本”文件仍然很有用，但为了避免用这种不精确的定义冒犯任何人，我将继续使用“吓人”引号。

但是，有各种工具可以处理各种文件，实际上，您希望根据文件是“文本”还是“二进制”来做一些不同的事情。这方面的一个例子是任何在控制台上输出数据的工具。纯“文本”看起来不错，而且很有用。“二进制”数据会弄乱您的终端，而且通常没有用处。GNU grep 在确定是否应该将匹配项输出到控制台时至少使用了这种区别。

所以，问题是，你如何判断一个文件是“文本”还是“二进制”？更进一步的限制是，您如何在 Linux 之类的文件系统上进行判断？我不知道任何指示文件“类型”的文件系统元数据，所以问题进一步变成，通过检查文件的内容，我如何判断它是“文本”还是“二进制”？为简单起见，我们将“文本”限制为可在用户控制台上打印的字符。特别是您将如何*实现*这一点？（我认为这是在这个网站上暗示的，但我想一般来说，指向执行此操作的现有代码是有帮助的，我应该指定），我并不是真的想要我可以使用哪些现有程序来做这。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-02-19T23:54:20.287

您可以使用该`file`命令。它对文件 ( `man file`) 进行了一系列测试，以确定它是二进制文件还是文本文件。如果您需要从 C 中执行此操作，可以查看/借用其源代码。

```
file README
README: ASCII English text, with very long lines

file /bin/bash
/bin/bash: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.2.5, dynamically linked (uses shared libs), stripped 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-19T23:55:50.627

您可以确定文件的[MIME 类型](https://stackoverflow.com/questions/tagged/mime)

```
file --mime FILENAME 
```

简写`file -i`在 Linux 上和`file -I`（大写 i）在 macOS 上（见评论）。

如果以 开头`text/`，则为文本，否则为二进制。唯一的例外是 XML 应用程序。`+xml`您可以通过在文件类型的末尾查找来匹配它们。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-02-20T01:10:00.417

我公司制作的电子表格软件可以读取多种二进制文件格式以及文本文件。

我们首先查看我们识别的[幻数的前几个字节。](http://en.wikipedia.org/wiki/Magic_number_(programming))如果我们无法识别我们读取的任何二进制类型的幻数，那么我们最多查看文件的前 2K 字节，看看它是否看起来是[UTF-8](http://en.wikipedia.org/wiki/UTF-8)、[UTF-16](http://en.wikipedia.org/wiki/UTF-8)或文本文件编码在主机操作系统的当前[代码页中。](http://en.wikipedia.org/wiki/Code_page)如果它没有通过这些测试，我们假设它不是我们可以处理的文件并抛出适当的异常。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-04-24T10:47:00.473

*   列出当前目录/子目录中的文本文件名：

    ```
    grep -rIl '' 
    ```

*   二进制文件：

    ```
    grep -rIL '' 
    ```

*   要检查特定文件：

    ```
    grep -qI '' FILE 
    ```

    那么，退出状态“0”意味着文件是文本；'1' - 二进制。去检查：

    ```
    echo $? 
    ```

*关键选项是这样的：*

> ```
>  -I     Process a binary file as if it did not contain matching data; 
> ```

*其他选项：*

> ```
>  -r, --recursive
>          Read all files under each directory, recursively;
>   -l, --files-with-matches
>          Suppress normal output; instead print the name of each input file from which output would normally have been printed.
>   -L, --files-without-match
>          Suppress normal output; instead print the name of each input file from which no output would normally have been printed.
>   -q, --quiet, --silent
>          Quiet; do not write anything to standard output.  Exit immediately with zero status if any match is found, even if an error was detected. 
> ```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T23:51:10.717

好吧，如果您只是检查整个文件，请查看是否每个字符都可以使用`isprint(c)`. 对于 Unicode，它变得有点复杂。

为了区分 unicode 文本文件，[MSDN 提供了一些关于如何操作的好建议](http://msdn.microsoft.com/en-us/library/dd374101(VS.85).aspx)。

它的要点是首先检查前四个字节：

```
EF BB BF     UTF-8 
FF FE        UTF-16, little endian 
FE FF        UTF-16, big endian 
FF FE 00 00  UTF-32, little endian 
00 00 FE FF  UTF-32, big-endian 
```

那会告诉你编码。然后，您想使用`iswprint(c)`文本文件中的其余字符。对于 UTF-8 和 UTF-16，您需要手动解析数据，因为单个字符可以由可变数量的字节表示。此外，如果你真的是肛门，你会想要使用`iswprint`你的平台上是否可用的语言环境变体。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-01-30T12:00:55.850

Perl 有一个不错的启发式算法。使用`-B`运算符来测试二进制（反之，`-T`测试文本）。这是一个列出文本文件的单行shell：

```
$ find . -type f -print0 | perl -0nE 'say if -f and -s _ and -T _' 
```

（请注意，前面没有美元的下划线是正确的 (RTFM)。）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-05-23T20:59:35.543

这是一个老话题，但也许有人会觉得这很有用。如果您必须在脚本中决定某个文件是否是文件，那么您可以简单地这样做：

```
if file -i $1 | grep -q text;
then 
.
.
fi 
```

这将获得文件类型，并且使用静默 grep 您可以确定它是否为文本。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-06-23T14:24:27.580

您可以使用`libmagic`哪个是 Unix`file`命令行的库版本。

有许多语言的包装器：

*   [Python](https://pypi.python.org/pypi/python-magic/)
*   [。网](http://magic.codeplex.com/)
*   [节点](https://www.npmjs.com/package/mmmagic)
*   [红宝石](https://rubygems.org/gems/magic/)
*   [去](https://github.com/rakyll/magicmime)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-19T23:52:22.430

大多数试图区分差异的程序都使用启发式方法，例如检查文件的前*n*个字节并查看这些字节是否**都**符合“文本”的条件（即，它们是否都在可打印的 ASCII 字符范围内） . 为了更好的区分，在类 UNIX 系统上总是有“文件”命令。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-20T00:59:21.737

一个简单的检查是它是否有`\0`字符。文本文件没有它们。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-20T01:47:57.300

如前所述，*nix 操作系统在文件命令中具有此功能。此命令使用一个配置文件，该文件定义了许多流行文件结构中包含的幻数。

这个名为 magic 的文件历史上存储在 /etc 中，尽管在某些发行版上它可能位于 /usr/share 中。魔术文件定义文件中已知值的偏移量，然后可以检查这些位置以确定文件的类型。

魔术文件的结构和描述可以通过查阅相关手册页（man magic）找到

至于实现，可以在 [file.c](http://rpm.org/api/4.4.2.2/file_8c-source.html)本身中找到，但是确定它是否是可读文本的 file 命令的相关部分如下

```
/* Make sure we are dealing with ascii text before looking for tokens */
    for (i = 0; i < nbytes - 1; i++) {
        if (!isascii(buf[i]) ||
            (iscntrl(buf[i]) && !isspace(buf[i]) &&
             buf[i] != '\b' && buf[i] != '\032' && buf[i] != '\033'
            )
           )
            return 0;   /* not all ASCII */
    } 
```

# oop - 使用具有重叠类的多个库时的最佳实践

> ID：567760
> 
> 赞同：0
> 
> 时间：2009-02-19T23:47:11.317
> 
> 标签：oop

考虑以下任务：

1.  使用库 A 从 KML 文件中读取多边形
2.  使用库 B 将其与另一个多边形相交
3.  使用库 C 计算其面积

每个库都有自己的 Polygon 类，它们都是等价的。使用所有这些类时哪个是最佳实践？在我第一次写这个问题的那一刻，我已经实现了一个将 PolygonA 实例转换为 PolygonB 实例的方法，反之亦然。但我想知道这是否是唯一的方法。

**澄清**所有图书馆都是第三方

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T23:50:04.447

我要么选择一个多边形类并且只使用那个类，要么构建我自己的多边形类来存储它们。

无论如何，请确保您的命名空间被恰当地命名，以便您可以区分两者。

为什么不合并重复的功能？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T00:39:29.773

想到的一个选项是使用复制构造函数定义您自己的多边形类，该构造函数接受其上的其他类型和方法，以从其数据创建其他类型的实例。

```
public class MyPolygon
{
    public MyPolygon(LibAPolygon polygon) { /* copy data */ }
    public LibAPolygon CopyToLibAPolygon() { ... }
    // repeat for each library
} 
```

与您拥有的方法相比，并没有真正提供太多优势。但是，我更喜欢它，因为它标准化了多边形的一种定义，然后根据需要转换为其他定义。或者，只需选择一个现有实现作为您的基础，然后编写方法在它和其他两个之间进行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T00:51:20.353

理想的解决方案很大程度上取决于您的需求，但这里有一个建议。

编写您自己的 Polygon 类，在内部将多边形存储为 PolygonA/PolygonB/PolygonC 之一。您的 Polygon 类将实现 getArea() 和 getIntersection(polygon2) 方法，它们会将内部多边形转换为适当的类型并调用正确的库。

这抽象了您自己的 Polygon 接口背后的库和多边形表示，它只需要实现您实际需要的 API 部分。这将允许您隐藏实现细节，例如您实现了多少翻译（只有 4 个——PolygonA->PolygonB->PolygonC->PolygonA？还是全部 6 个？）以及如何存储多边形（选择一种库类型？使用您自己的表示？将其存储在多个表示中以避免翻译开销？）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T00:52:21.740

如果相关库不提供任何适配器接口，则编写转换通常是唯一的方法。您自己制作的任何适配器最终都必须转换为库的本机表示，才能对几何图形执行任何算法。

另一种选择是创建一个包装类来缓存每个不同的 A/B/C 表示，这样您只需为每个几何图形转换到任何给定库一次。然后您的所有代码只处理包装类，并将适当的表示传递给任何相关算法。翻译可以在实际需要之前及时执行。

如果您使用带有 typedef 和/或命名空间的语言，为每个库的多边形类型创建自己的 typedef 可以让您的生活更轻松。例如，如果每个库只有一个名为“Polygon”的多边形类型，但它被放置在一个特定的命名空间中，那么：

```
typedef A::Polygon APolygon;
typedef B::Polygon BPolygon;
typedef C::Polygon CPolygon; 
```

如果库实际上存在命名冲突，那么这就是一个真正的问题。

# c# - 使用 SmtpClient 时如何保存电子邮件而不是发送？

> ID：567765
> 
> 赞同：51
> 
> 时间：2009-02-19T23:49:45.353
> 
> 标签：c#, .net, email, smtp

我正在使用 SmtpClient 发送带有附件的电子邮件。但是对于某个批次，我们需要以某种方式保存 MailMessage 而不是发送它们。然后我们正在考虑/希望手动将消息上传到用户草稿文件夹。

是否有可能保存这些带有完整附件的邮件（我原以为不可能）。或者将消息上传到用户帐户中的文件夹？

如果有人有这方面的经验，我会非常感谢一些帮助或指点。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-19T23:57:41.370

在 ASP.NET 中进行测试时，我们将电子邮件保存到一个文件夹中，而不是通过电子邮件服务器发送它们。`web.config`也许您可以为您的批次更改这样的设置？

```
<system.net>
  <mailSettings>
    <smtp deliveryMethod="SpecifiedPickupDirectory">
      <specifiedPickupDirectory pickupDirectoryLocation="c:\Temp\mail\"/>
    </smtp>
  </mailSettings>
</system.net> 
```

**附加信息：**

*   [MSDN：<specifiedPickupDirectory> 元素（网络设置）](https://msdn.microsoft.com/en-us/library/ms164241.aspx)
*   [配置 SmtpClient 以将电子邮件放在磁盘上的文件夹中](http://mikehadlow.blogspot.com/2010/01/configuring-smtpclient-to-drop-emails.html)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-12-08T16:19:29.743

除了`SpecifiedPickupDirectory`其他答案的信息外，如果您想确保将电子邮件发送到相对于站点根目录的文件夹 - 在您不知道路径的构建服务器上进行测试时很方便 - 您可以添加快速签入您的电子邮件发送代码：

```
 SmtpClient client = new SmtpClient();
    ...

    // Add "~" support for pickupdirectories.
    if (client.DeliveryMethod == SmtpDeliveryMethod.SpecifiedPickupDirectory && client.PickupDirectoryLocation.StartsWith("~"))
    {
        string root = AppDomain.CurrentDomain.BaseDirectory;
        string pickupRoot = client.PickupDirectoryLocation.Replace("~/", root);
        pickupRoot = pickupRoot.Replace("/",@"\");
        client.PickupDirectoryLocation = pickupRoot;
    } 
```

你的测试看起来像这样（确保你使用 App_Data 以便 IIS 可以写入文件夹）：

```
 // Arrange - get SitePath from AppDomain.Current.BaseDirectory + ..\
    string pickupPath = Path.Combine(SitePath, "App_Data", "TempSmtp");
    if (!Directory.Exists(pickupPath))
        Directory.CreateDirectory(pickupPath);

    foreach (string file in Directory.GetFiles(pickupPath, "*.eml"))
    {
        File.Delete(file);
    }

    // Act (send some emails)

    // Assert
    Assert.That(Directory.GetFiles(pickupPath, "*.eml").Count(), Is.EqualTo(1)); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-20T00:14:38.117

这可以提供帮助 -[将 Save() 功能添加到 Microsoft.Net.Mail.MailMessage](http://www.codeproject.com/KB/IP/smtpclientext.aspx?display=PrintAll&fid=1533533&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2876398)
主要思想是对 MailMessage 进行扩展，即通过反射制作保存方法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-19T23:56:56.410

您可以使用/文件中的`system.net`设置进行配置。`web.config``app.config`

```
<system.net>
  <mailSettings>
    <smtp deliveryMethod="Network">
      <network host="mail.mydomain.com" port="25" />
    </smtp>
    <!-- Use this setting for development
    <smtp deliveryMethod="SpecifiedPickupDirectory">
      <specifiedPickupDirectory pickupDirectoryLocation="C:\Temp" />
    </smtp>
    -->
  </mailSettings>
</system.net> 
```

此外，这里有一个链接，其中包含有关[从 迁移`System.Web.Mail`到`System.Net.Mail`](http://weblogs.asp.net/dfindley/archive/2006/04/23/Migrating-from-System.Web.Mail-to-System.Net.Mail.aspx)的信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-12T20:20:59.623

在某些版本的框架中，还需要添加一个错误作为解决方法。所以完成的版本看起来像：

```
<system.net>
  <mailSettings>
    <smtp deliveryMethod="SpecifiedPickupDirectory">
        <specifiedPickupDirectory pickupDirectoryLocation="c:\Temp\mail\"/>
        <network host="localhost" />
    </smtp>
  </mailSettings>
</system.net> 
```

# c# - 复制我的数组的最快方法是什么？

> ID：567780
> 
> 赞同：4
> 
> 时间：2009-02-19T23:53:20.460
> 
> 标签：c#, arrays, loops, optimization

我正在处理一些 Wave 文件，并让它们从磁盘读取到一个字节数组中。我想将此字节数组中的部分快速复制到另一个缓冲区中以进行中间处理。目前我使用这样的东西：

```
float[] fin;
byte[] buf;
//fill buf code omitted
for(int i=offset; i < size; i++){
  fin[i-offset] = (float) buf[i];  
} 
```

我觉得这是一种缓慢的方法，因为在 for 循环条件和增量中进行的计算与实际主体中的计算一样多。如果在 C# 中有可用的块副本或其他我可以实现块副本的方式，那就太好了。

也许它不是太慢，但它确实看起来需要大量的工作来移动一些数据。这里的“大小”介于 2^10 和 2^14 之间。然后我将“fin”交给 FFT 库，所以这绝不是代码中最慢的部分，也许我在叫错树。

编辑更新：我意识到微优化不是人们应该花时间的地方，我意识到分析是实现整体加速的更好方法，但我知道这段代码处于“热路径”中，必须在下面完成在不同的最终用户架构上花费三分之一秒，以最大限度地减少我们的硬件系统要求。尽管我知道下面的 FFT 代码会更耗时，但我正在寻找可以得到它们的加速器。

Array.Copy 看起来不错，我以前不知道，我认为这次问答已经成功了！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-20T00:03:05.820

还有：

```
Array.Copy
Array.CopyTo 
```

但是这些是否会更快将需要分析。

*但是*请注意，如果您错过了大局，请注意关注微观优化，在现代 PC 上，多级内存缓存的效果可能比复制的一种或另一种方法更大。

编辑：快速检查反射器：上述两种方法都归结为一个通用的本机实现（好）。

请注意 Array.Copy 的文档涵盖了有效的类型转换，值 -> 值扩展转换（如字节到浮点数）应该没问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T00:02:15.150

看看 Array.Copy 它应该更快

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T00:02:40.127

由于您正在从字节转换为浮点数，因此您不会获得任何显着的加速。任何 Array.Copy 或 memcopy 的变体都无法解决这个问题。

唯一可能的收获是将字节值“戳”到浮点数中。我不知道（关于 float 的实现）是否会起作用，老实说我也不想知道。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T23:55:49.957

我不会引用 knuth，但会介绍您的代码。放入一些时间戳并测量事情需要多长时间。然后你可以把时间花在优化上:)

# c++ - C++ 预处理器意外编译错误

> ID：567788
> 
> 赞同：3
> 
> 时间：2009-02-19T23:55:58.723
> 
> 标签：c++, compiler-construction, c-preprocessor

请看以下文件：（它是一个完整的文件）

```
#ifndef TEES_ALGORITHM_LIBRARY_WRAPPER_H
#define TEES_ALGORITHM_LIBRARY_WRAPPER_H

#ifdef _TEES_COMPILE_AS_LIB
#include <dfa\Includes\DFC_algorithms.hpp>
#include <DFA\FuzzyClassifier\FuzzyAlgorithmIntialization\InitFuzzyAlgorithm.hpp>
typedef teesalgorithm::tees_fuzzy_algorithms algorithms_switchyard_class;
#else
#include <DFA\Includes\commercial_algorithms.hpp>
//An incomplete class to hide implementation
class algorithms_switchyard_class;
#endif

class AlgorithmLibraryWrapper {
algorithms_switchyard_class * algorithmPtr_;

typedef teesalgorithm::tees_paramObj paramObj_type;
typedef teesalgorithm::tees_errorObj errorObj_type;  
typedef teesalgorithm::tees_statusObj statusObj_type;
typedef teesalgorithm::tees_dataObj dataObj_type;
typedef teesalgorithm::tees_outputObj outputObj_type;

public:

AlgorithmLibraryWrapper(const std::string& sAlgName, paramObj_type& paramObj,     errorObj_type& errObj, statusObj_type& statusObj, const char* sFilePath);
static bool dataReader(const std::string& sFileName, dataObj_type& dataObj,     errorObj_type& errObj, statusObj_type& statusObj);
bool runalgorithm(const dataObj_type& dataObj, outputObj_type& outObj, errorObj_type& errObj, statusObj_type& statusObj); 
~AlgorithmLibraryWrapper();

};

#ifdef _TEES_USE_COMPILED_ALGORITHM_LIB
#   ifdef _MSC_VER
    #if _MSC_VER < 1400  // If VC 2003
        #ifdef _DEBUG
            #error No AlgorithmLibWrapper libraries compiled for this version of VC
        #else
            #error No AlgorithmLibWrapper libraries compiled for this version of VC
        #endif
    #elif defined(UNDER_CE)  // Win CE
        #ifdef _DEBUG
            #pragma comment( lib, "AlgorithmLibWrapperCEd" )
        #else
            #pragma comment( lib, "AlgorithmLibWrapperCE" )
        #endif
    #else  // If VC 2005
        #ifdef _DEBUG
            #pragma comment( lib, "AlgorithmLibWrapperd" )
        #else
            #pragma comment( lib, "AlgorithmLibWrapper" )
        #endif
    #endif
#endif 
#endif

#endif //TEES_ALGORITHM_LIBRARY_WRAPPER_H 
```

我收到以下错误；我不知道为什么。我也手动计算了预处理器指令。

> AlgorithmLibraryWrapper.hpp:10:1: 未终止#ifdef
> AlgorithmLibraryWrapper.hpp:7:1: 未终止#ifndef

我正在使用糟糕的 vxWorks gcc 编译器。请让我知道是我的错还是编译器的错。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T00:07:53.703

可能问题出在包含的文件中（如果实际上有不平衡的`#if`/ `#endif`s.

我会尝试使用另一个编译器进行预处理。您可以为此使用 gcc，没关系它不会编译。只需获取 gcc（或 MinGW，如果您在 Windows 上）并运行

```
cpp -Iinclude_direcories your_file 
```

或者，如果您不喜欢 gcc，请获取 MSVC Express 版本。同样，您可以预处理甚至无法编译的代码，因此非工作库等没有问题。

大多数编译器都有一个选项，可以为您提供预处理器的输出，以便您检查它在做什么。例如，

```
gcc -E file.c >file.preproc 
```

将为您提供预处理的源代码，以便您检查#if 与 #endif 的平衡。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T00:08:49.690

猜测一下，您从中#include 的文件之一有一个不匹配的#ifdef/#endif 对。您需要查看所有文件（正如预处理器所做的那样），而不仅仅是这个文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T00:48:21.983

正如其他人所指出的，这很可能是由于不匹配的包括警卫。

如果您包含的文件在您的控制之下（即不是第 3 方封闭源代码库的一部分），您可以考虑替换 #ifndef 等。人。使用 #pragma 一次的守卫（用于防止多次包含）。这将消除预处理器指令不匹配的可能性。

需要注意的一点是，[pragma once](http://en.wikipedia.org/wiki/Pragma_once)是非标准的，所以它只有在你的编译器支持的情况下才会起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T03:40:54.097

我尝试使用 vs 6.0 编译您的源代码，但没有收到您提到的错误。正如其他人所说，错误可能来自包含的头文件。为了让我编译你的代码，我需要评论上面的标题。

请检查上述标题一次。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T03:54:56.497

我将通过逐个注释掉部分并尝试确定哪个部分导致错误来调试它。

可能是您的编译器不喜欢嵌套的 #ifdefs 或没有正确解释语法。也许它不喜欢#pragmas。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T05:08:52.527

这是一个很长的镜头，但在您的源文件中，您有以下行：

```
#   ifdef _MSC_VER 
```

`#`' ' 字符和指令名称 ( `ifdef`)之间有空格。这在 C/C++ 中有效；但是，它并不太常见，所以如果奇怪的编译器被它卡住了，我也不会感到很惊讶。

# php - 正则表达式获取括号内的文本

> ID：567790
> 
> 赞同：2
> 
> 时间：2009-02-19T23:56:38.643
> 
> 标签：php, regex

我正在查看一个字符串并试图将所有内容都放在这对括号内。在某些情况下，内容可能会发生变化，最大值和最小值可能不存在。

```
get(max(fieldname1),min(fieldname2),fieldname3)where(something=something) sort(fieldname2 asc) 
```

不保证 where() 和 sort() 存在。
每组和 [EDIT] 之间可能有空格，关键字可能并不总是相同。

```
get(something) where(something)
get(something)where(something) sort(something) 
```

应该使用什么正则表达式模式？实际上，它应该返回：

```
Array (
[0] => max(fieldname1),min(fieldname2),fieldname3
[1] => something=something
[2] => fieldname2 asc
) 
```

我意识到将第一组括号更改为 { 或 [ 可能会解决问题，但我很固执，想通过正则表达式这样做。

编辑我能想到的最好的使用 preg_match_all()

```
/[a-zA-Z0-9_]+\((.*?)\)/ 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T00:11:46.813

您最好使用解析器，例如：

```
$str = 'get(max(fieldname1),min(fieldname2),fieldname3)where(something=something) sort(fieldname2 asc)';
$array = array();
$buffer = '';
$depth = 0;
for ($i=0; $i<strlen($str); $i++) {
    $buffer .= $str[$i];
    switch ($str[$i]) {
        case '(':
            $depth++;
            break;
        case ')':
            $depth--;
            if ($depth === 0) {
                $array[] = $buffer;
                $buffer = '';
            }
            break;
    }
}
var_dump($array); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T00:02:45.180

由于您澄清了这些是可选的，因此我认为这不可能与正则表达式有关。您可以通过将不同的子句（get、where、sort）保留在它们自己的字符串中来实现，但我认为您不能按原样进行。

再次编辑：它在概念上有点类似于昨天的这个问题，这被证明是不可能用正则表达式做的： [Regex for checks if a string has mismatched parentheses?](https://stackoverflow.com/questions/562606/regex-for-checking-if-a-string-has-mismatched-parentheses/562638#562638)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T05:40:44.103

我坐了一会儿，写了一个完整的 FSM 解析器，只是为了感兴趣。

它有一些你不太可能用正则表达式看到的特性（至少在 PHP 下，我可以用 Perl 中的递归正则表达式来做到这一点，但 PHP 不行，它还没有那个特性）。

1.  智能和基于堆栈的括号解析
2.  AnyBracket 支持
3.  模块化的
4.  可扩展。
5.  当语法错误时，它可以告诉你在哪里。

当然，这里有大量代码，其中很多代码对于新程序员来说有点奇怪和复杂，但就它的本质而言，它是非常棒的东西。

它不是成品，只是我拼凑的东西，但它可以工作并且没有我能找到的任何错误。

我在很多地方都“死”了，通常使用异常和诸如此类的东西会更好，因此在推出之前进行清理和重构会更好。

它有相当数量的评论，但我觉得如果我要进一步评论有限状态加工的细节将更难理解。

```
 # Pretty Colour Debug of the tokeniser in action. 
# Uncomment to use. 
function debug( $title, $stream, $msg, $remaining ){ 
#  print chr(27) ."[31m$title" . chr(27) ."[0m\n";
# print chr(27) ."[33min:$stream" . chr(27) ."[0m\n";
#  print chr(27) ."[32m$msg" . chr(27) ."[0m\n";
#  print chr(27) ."[34mstream:$remaining" . chr(27) ."[0m\n\n";
}

# Simple utility to store a captured part of the stream in one place
# and the remainder somewhere else
# Wraps most the regexy stuff 
# Insprired by some Perl Regex Parser I found. 

function get_token( $regex, $input ){ 
  $out = array( 
      'success' => false,
      'match' => '',
      'rest' => ''
  );
  if( !preg_match( '/^' . $regex . '/' , $input, $matches ) ){
    die("Could not match $regex at start of $input ");
    #return $out; # error condition, not matched. 
  }
  $out['match'] = $matches[1];
  $out['rest'] = substr( $input, strlen( $out['match'] ) );
  $out['success'] = true;
  debug( 'Scan For Token: '. $regex , $input, "matched: " . $out['match'] , $out['rest'] );
  return $out;
}

function skip_space( $input ){ 
  return get_token('(\s*)', $input ); 
}

# Given $input and $opener, find 
# the data stream that occurs until the respecive closer. 
# All nested bracket sets must be well balanced. 
# No 'escape code' implementation has been done (yet) 
# Match will contain the contents, 
# Rest will contain unprocessed part of the string
# []{}() and  bracket types are currently supported. 

function close_bracket( $input , $opener ){
  $out = array( 
      'success' => false,
      'match' => '',
      'rest' => ''
  );

  $map = array( '(' => ')', '[' => ']', '{' => '}', chr(60) => '>' );
  $nests = array( $map[$opener] ); 

  while( strlen($input) > 0 ){ 
    $d = get_token( '([^()\[\]{}' . chr(60). '>]*?[()\[\]{}' . chr(60)  . '>])', $input ); 
    $input = $d['rest']; 

    if( !$d['success'] ){  
      debug( 'Scan For ) Bailing ' , $input, "depth: $nests, matched: " . $out['match'] , $out['rest'] );

      $out['match'] .= $d['match'];
      return $out; # error condition, not matched. brackets are imbalanced. 
    }

# Work out which of the 4 bracket types we got, and
# Which orientation it is, and then decide if were going up the tree or down it

    end($nests);
    $tail = substr( $d['match'], -1, 1 );
    if( $tail == current($nests) ){ 
      array_pop( $nests );
    } elseif ( array_key_exists( $tail, $map ) ){ 
      array_push( $nests, $map[$tail] ); 
    } else {
      die ("Error. Bad bracket Matching, unclosed/unbalanced/unmatching bracket sequence: " . $out['match'] . $d['match'] );
    }
    $out['match'] .= $d['match'] ; 
    $out['rest' ]  = $d['rest'];
    debug( 'Scan For ) running' , $input, "depth: $nests, matched: " . $out['match'] , $out['rest'] );

    if ( count($nests) == 0 ){ 
      # Chomp off the tail bracket to just get the body
      $out['match'] = substr( $out['match'] , 0 , -1 );
      $out['success'] = true;
      debug( 'Scan For ) returning ' , $input, "matched: " . $out['match'] , $out['rest'] );
      return $out;
    }
    else { 

    }
  }
  die('Scan for closing ) exhausted buffer while searching. Brackets Missmatched. Fix this: \'' . $out['match'] . '\'');
}

# Given $function_name and $input, expects the form fnname(data) 
# 'data' can be any well balanced bracket sequence 
# also, brackets used for functions in the stream can be any of your choice, 
# as long as you're consistent. fnname[foo] will work. 

function parse_function_body( $input, $function_name ){ 
  $out = array ( 
    'success' => false, 
    'match' => '', 
    'rest' => '', 
  );

  debug( 'Parsing  ' . $function_name . "()", $input, "" , "" );

  $d = get_token( "(" . $function_name . '[({\[' . chr(60) . '])' , $input ); 

  if ( !$d['success'] ){ 
     die("Doom while parsing for function $function_name. Not Where its expected.");
  }

  $e = close_bracket( $d['rest'] , substr($d['match'],-1,1) );

  if ( !$e['success'] ){
    die("Found Imbalanced Brackets while parsing for $function_name, last snapshot was '" . $e['match'] . "'");
    return $out; # inbalanced brackets for function
  }
  $out['success'] = true;
  $out['match'] = $e['match']; 
  $out['rest'] = $e['rest'];
  debug( 'Finished Parsing  ' . $function_name . "()", $input, 'body:'. $out['match'] , $out['rest'] );

  return $out;
}

function  parse_query( $input ){ 

  $eat  = skip_space( $input ); 
  $get = parse_function_body( $eat['rest'] , 'get' ); 
  if ( !$get['success'] ){ 
    die("Get Token Malformed/Missing, instead found '" . $eat['rest'] . "'"); 
  }
  $eat = skip_space( $get['rest'] ); 
  $where = parse_function_body( $eat['rest'], 'where' ); 
  if ( !$where['success'] ){ 
    die("Where Token Malformed/Missing, instead found '" . $eat['rest'] . "'"); 
  }
  $eat = skip_space( $where['rest'] ); 
  $sort = parse_function_body( $eat['rest'], 'sort' ); 
  if( !$sort['success'] ){
    die("Sort Token Malformed/Missing, instead found '" . $eat['rest'] . "'"); 
  }
  return array( 
      'get' => $get['match'],
      'where' => $where['match'], 
      'sort' => $sort['match'], 
      '_Trailing_Data' =>  $sort['rest'],
  );
}

$structure = parse_query("get[max(fieldname1),min(fieldname2),fieldname3]where(something=something) sort(fieldname2 asc)");

print_r($structure);

$structure = parse_query("get(max(fieldname1),min(fieldname2),fieldname3)where(something=something) sort(fieldname2 asc)");

print_r($structure);

$structure = parse_query("get{max(fieldname1),min(fieldname2),fieldname3}where(something=something) sort(fieldname2 asc)");

print_r($structure);

$structure = parse_query("get" . chr(60) . "max(fieldname1),min(fieldname2),fieldname3" . chr(60). "where(something=something) sort(fieldname2 asc)");

print_r($structure); 
```

上面所有的 print_r($structure) 行都应该产生这个：

```
大批
(
    [get] => max(fieldname1),min(fieldname2),fieldname3
    [在哪里] => 某事=某事
    [排序] => fieldname2 asc
    [_Trailing_Data] =>
)

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T00:27:14.560

关于什么？

```
^\s*get\((.*?)\)(?:\s*where\((.*?)\))(?:\s*sort\((.*?)\)\s*)?$ 
```

现在我不相信这会奏效。例如，第一个匹配项（用于获取）可能会超出 where 和 sort 子句。您**可能**可以使用前瞻来处理这个问题，例如：

```
^\s*get\(((?:.(?!sort|where))*?)\)(?:\s*where\(((?:.(?!sort))*?)\))(?:\s*sort\((.*?)\)\s*)?$ 
```

但实际上这是一个非常粗糙的正则表达式，Gumbo 是正确的，因为解析器可以说是更好的方法。对于任何匹配元素的情况都是如此。HTML/XML 是不恰当且经常使用正则表达式的典型案例。在这些情况下情况更糟，因为解析器是免费可用且成熟的。

在这样的情况下有很多情况需要处理：

*   表达式部分的可选性；
*   来自文字的错误信号，例如 get(") sort") 将破坏上述内容；
*   字符转义；
*   嵌套。

Chad 指出了我所说的配对问题，值得重申。假设您有以下 HTML：

```
<div>
  <div></div>
</div> 
```

使用正则表达式不可能获得匹配的标签对（但人们一直在尝试或只是不考虑输入类型）。使您的案例**可能**可行的原因是您有一些可以使用的已知标记：

*   关键字get、where和sort；和
*   字符串的开始和结束。

但老实说，正则表达式不是推荐的方法。

因此，如果您想要一些健壮可靠的东西，请编写一个解析器。这种事情的正则表达式只不过是一个快速而肮脏的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T00:45:57.247

我支持关于正则表达式不适合这样的通用结构的说法。但是，如果括号是平衡的并且不超过两个深度，这些正则表达式可能会有所帮助：

```
(\w+\s*\([^()]*(?:(?:\([^()]*\))[^()]*)*\)\s*) 
```

匹配并捕获单个 xyz(....) 实例，而

```
(\w+\s*\([^()]*(?:(?:\([^()]*\))[^()]*)*\)\s*)+ 
```

匹配所有这些。根据您的语言，您可以使用第二个并解开单个组中的多个捕获。[此参考](http://msdn.microsoft.com/en-us/library/30wbz966(VS.71).aspx)可能会有所帮助。

但是，重复一遍，我不认为正则表达式是一种方式——这就是为什么这个相当严格的解决方案如此丑陋的原因。

* * *

抱歉，刚刚注意到您是 PHP。你可能需要使用这个：

```
(\w+\s*\([^()]*(?:(?:\([^()]*\))[^()]*)*\)\s*)(.*) 
```

把你的线分成（一件）加上（剩下的），然后循环，直到什么都没有。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T00:57:08.390

这是一种非常骇人听闻的做法，可能会做得更好，但只是作为概念证明：

```
get\((max\(.+?\)),(min\(.+?\)),(.+?)\)(where\((.+?=.+?)\)| where\((.+?=.+?)\)|)(sort\((.+?)\)| sort\((.+?)\)|) 
```

匹配数组中的数据位置将根据是否找到信息而改变。[你可以在那里](http://www.rexv.org/)测试它！

# c# - 为类库启用视觉样式

> ID：567795
> 
> 赞同：1
> 
> 时间：2009-02-19T23:57:53.040
> 
> 标签：c#, .net, progress-bar, class-library, visual-styles

当我的项目是类库并且它被加载到没有设置 Application.EnableVisualStyles() 的程序中时，如何启用视觉样式。我已经为此苦苦挣扎了 2 天。这是在 C# 中的（我已经看到了一些旧 C++ 的示例和一些可能适用于 VB 的东西，但是对于 C# 没有任何明确的规定，甚至如果可能的话）。

在创建任何控件之前，我曾尝试从我的类库中运行 Application.EnableVisualStyles()，但似乎需要在 Application.Run() 完成之前完成，并且我无法控制 Application.Run( ) 被调用，因为这将作为插件（VMware 的虚拟基础架构客户端）进入第 3 方应用程序。

我试图创建一个清单文件，在编译类库后，我在清单文件中链接到我的 ProgressBar.dll： mt.exe -manifest ProgressBar.dll.manifest -outputresource:ProgressBar.dll;2

除了这不起作用。如果我创建了一个使用我的 ProgressBar 类库的虚拟应用程序并将清单链接到该应用程序的 exe，那么就会出现视觉样式（基本上它在项目属性的应用程序部分中指定清单文件的方式很长）。

现在我的按钮看起来很难看，但最令人恼火的是 ProgressBar 控件在 Marquee 样式中不起作用。我很快将不得不求助于制作我自己的 Marquee 风格的 ProgressBar，或者只是在它的位置放入一个动画 GIF。关于按钮，我想我可以开始使用 Infragistics 按钮以获得更一致的结果。

请一如既往地感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-20T00:11:54.567

您如何确定调用时尚未创建控件`Application.EnableVisualStyles`？Created 并不一定意味着控件在窗体上也是可见的。

由于您使用的是封闭的第 3 方组件，如果外观和感觉很重要，我会花时间创建自己的控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T02:52:21.497

您必须`OpenThemeData`在控件中使用 Win32 api：

[MSDN：使用 Windows XP 视觉样式](http://msdn.microsoft.com/en-us/library/ms997646.aspx)

# delphi - 如何使一个窗口停留在所有其他窗口下方（“最底部”）

> ID：567804
> 
> 赞同：1
> 
> 时间：2009-02-20T00:02:19.957
> 
> 标签：delphi, winapi

**完全重复**：[如何制作“始终在底部”窗口？](https://stackoverflow.com/questions/527950/how-to-make-always-on-bottom-window)
**相关：** [桌面上的窗口？](https://stackoverflow.com/questions/365094/window-on-desktop)

* * *

我正在 Delphi 中开发一个小型应用程序，它需要表现得像一个 shell（替换）启动板（对于 Windows Embedded）。我有一些图标/按钮可以启动其他应用程序。关键是应用程序需要一直停留在“shell”前面。此外，应用程序是使用简单单击启动的，但如果使用双击（意外），应用程序将落后（“shell”将被聚焦）

由于此应用程序将替换实际的 shell（Explorer），因此它的行为必须与 Explorer 相似……所以它必须一直处于“后台”，并且不应出现在 ALT+TAB 列表中。

我测试了很多*SetWindowPos*与*HWND_BOTTOM*，*SWP_NOACTIVATE*等的组合，但没有成功。

此外，我发现了一些关于此的信息，但它并没有像宣传的那样工作：
[如何始终在后台保持表单（最底部）](http://www.delphifaq.com/faq/delphi/windows_GUI/f499.shtml)

任何提示如何实现所有这些？

**更新：**为了从 ALT-TAB 列表/切换器（和任务栏，但由于我有兴趣创建没有任务栏的外壳替换）隐藏窗口，我发现了以下文章：

[从任务栏中隐藏Delphi 应用程序按钮 从任务栏中](http://delphi.about.com/od/adptips1999/qt/hidefromtaskbar.htm)
[隐藏 Delphi 2007 应用程序按钮（使用 MainFormOnTaskBar）](http://delphi.about.com/od/delphitips2008/qt/hide_taskbutton.htm)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T07:18:06.927

[之前不是问过吗？](https://stackoverflow.com/questions/527950/how-to-make-always-on-bottom-window)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T11:59:06.460

目前尚不清楚您是否正在尝试使您的应用程序在当前外壳之上充当“启动板”，或者您是否正在尝试使您的应用程序成为外壳。

这两者之间有很大的不同。

听起来最后一个选项是您真正想要的，然后任务栏等根本不应该有任何麻烦-它们不会在那里，因为它们是您已替换的旧 shell (explorer.exe) 的一部分。

[SharpEnvironment](http://www.sharpe-shell.org/)是一个用 Delphi 制作的开源 shell 替代品，可能会给您一些提示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T01:55:20.027

我不确定您要达到的确切效果是什么，但我认为您基本上想更改屏幕上的工作区。

您可以使用 Monitor.WorkareaRect 将当前工作区作为 TRect 获取。您可以通过 SystemparametersInfo() 设置它

下面的示例将您的表单变成或多或少类似于 Windows 任务栏的工作方式：

*   无边界
*   总在最前面
*   卡在屏幕底部
*   其他最大化的 Windows 应用程序只会最大化直到我们窗体的顶部。

让我知道这是否是您的意思。

```
procedure TfrmMain.FormCreate(Sender: TObject);
var
  Rect :TRect;
begin
  Height      := 25;
  BorderStyle := bsNone;
  FormStyle   := fsStayOnTop;
  Rect        := Monitor.WorkareaRect;
  Rect.Bottom := Rect.Bottom - Height;
  Left        := Rect.Left;
  Width       := Rect.Right;
  Top         := Rect.Bottom;
  SystemparametersInfo(SPI_SETWORKAREA,0, @Rect,SPIF_SENDCHANGE);
end; 
```

需要记住的一些事项：

*   程序完成后，桌面上的工作区仍将是您设置的方式，因此请记住在终止应用程序之前恢复它。我相信你会弄清楚如何做到这一点。

*   当您调整 Windows 任务栏的大小时，正在运行的应用程序会收到更改通知，并且最大化的应用程序会调整其大小以适应新的工作区。上面的代码似乎没有触发它，所以你可能需要找到一种方法来做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T08:34:25.590

**@dummzeuch** 您提到的解决方案不包含任何代码只是一些建议......另外不处理我也需要解决的ALT-TAB问题（我的窗口不应该出现在ALT-TAB列表中，类似于资源管理器 -作为一个外壳 - 表现）。

**@Wouter** 我需要创建一个shell替换（无边框全屏形式），它需要一直保持在“底部”，类似于常规的Explorer shell（将替换）。所以它应该像你建议的那样保持在底部而不是顶部。

这个“shell”替代品用于我无法使用常规 Explorer shell 的 Windows 嵌入式解决方案。这种外壳形式包括一些“软按钮”（TImage 来模拟图标），用于一些可以从中启动的选定可执行文件。问题是我需要确保外壳始终留在后面，否则它可能会隐藏一些其他应用程序（例如：多次快速单击将启动应用程序但将重新关注外壳的图标，或者在使用ALT 选项卡）。

在这种情况下，我还有一个问题：有什么方法可以等待任何应用程序启动？

我将非常感谢一些代码提示以开始使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-22T01:29:06.207

这是几十年来的 Win32 常见问题解答。参见[专业的 Win32 api 组](http://news://nntp.aioe.org/comp.os.ms-windows.programmer.win32)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-21T12:20:24.500

这是你想要的吗？

```
procedure SetWindowPosToBack(handle: HWND);
begin
  SetWindowPos(Handle,HWND_BOTTOM,0,0,0,0,SWP_NOACTIVATE or SWP_NOMOVE or SWP_NOSIZE);
end; 
```

# objective-c - 在 UIPickerView 而不是 UIView 中响应 touchesBegan

> ID：567805
> 
> 赞同：6
> 
> 时间：2009-02-20T00:02:31.453
> 
> 标签：objective-c, iphone, cocoa-touch, uipickerview

我有一个 UIPickerView 在不使用时会淡出到 20% 的 alpha。我希望用户能够触摸选择器并将其淡入。

如果我在主视图上放置一个 touchesBegan 方法，我可以让它工作，但这仅在用户触摸视图时有效。我尝试对 UIPickerView 进行子类化并在其中设置 touchesBegan，但它没有用。

我猜这与响应者链有关，但似乎无法解决。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-07-15T08:59:17.763

一个多星期以来，我一直在寻找解决这个问题的方法。即使您的问题已经超过一年，我也会回答您，希望这对其他人有所帮助。

抱歉，如果我的语言不是很专业，但我对 Objective-C 和 iPhone 开发还很陌生。

继承 UIpickerView 是正确的方法。但是您必须覆盖该`- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event`方法。这是每当您触摸屏幕时调用的方法，它会返回将对触摸做出反应的视图。换句话说，`touchesBegan:withEvent:`将调用其方法的视图。

UIPickerView 有 9 个子视图！在 UIPickerView 类实现`- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event`中不会返回`self`（这意味着`touchesBegan:withEvent:`您在子类中编写的不会被调用），但会返回一个子视图，即索引 4 处的视图（一个名为 UIPickerTable 的未记录子类）。

诀窍是使`- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event`方法返回`self`，以便您可以控制`touchesBegan:withEvent:`,`touchesMoved:withEvent:`和`touchesEnded:withEvent:`方法。

在这些方法中，为了保持 UIPickerView 的标准功能，您必须记住在 UIPickerTable 子视图上再次调用它们。

我希望这是有道理的。我现在无法编写代码，只要我在家，我就会编辑这个答案并添加一些代码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-05-07T00:24:55.013

这是一些可以满足您要求的代码：

```
@interface TouchDetectionView : UIPickerView {

}
- (UIView *)getNextResponderView:(NSSet *)touches withEvent:(UIEvent *)event;
@end
@implementation TouchDetectionView

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
    UIView * hitTestView = [self getNextResponderView:touches withEvent:event];
    [hitTestView touchesBegan:touches withEvent:event];
}

- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
    UIView * hitTestView = [self getNextResponderView:touches withEvent:event];
    [hitTestView touchesMoved:touches withEvent:event];
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event
{
    UIView * hitTestView = [self getNextResponderView:touches withEvent:event];
    [hitTestView touchesEnded:touches withEvent:event];
}

- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event
{
    UIView * hitTestView = [self getNextResponderView:touches withEvent:event];
    [hitTestView touchesCancelled:touches withEvent:event];
}

- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    return self;
}

- (UIView *)getNextResponderView:(NSSet *)touches withEvent:(UIEvent *)event
{
    UITouch * touch = [touches anyObject];
    CGPoint point = [touch locationInView:self];
    UIView * hitTestView = [super hitTest:point withEvent:event];

    return ( hitTestView == self ) ? nil : hitTestView;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-06T05:34:45.030

以上两个答案都非常有帮助，但我有一个 UIPickerView 嵌套在 UIScrollView 中。当 GUI 存在时，我还在屏幕上的其他地方进行持续渲染。问题是 UIPickerView 在以下情况下不会完全更新：点击未选择的行，移动选择器以使两行跨越选择区域，或拖动一行但手指滑出 UIPickerView。然后直到 UIScrollView 被移动，选择器才会立即更新。这个结果是丑陋的。

问题的原因：我的持续渲染使 UIPickerView 的动画无法获得完成所需的 CPU 周期，从而显示正确的当前选择。我的解决方案——有效——是这样的：在 UIPickerView 中`touchesEnded:withEvent:`，执行一些操作来暂停我的渲染一小会儿。这是代码：

```
#import "SubUIPickerView.h"

@implementation SubUIPickerView

- (void) touchesBegan:(NSSet*)touches withEvent:(UIEvent*)event
{
    [pickerTable touchesBegan:touches withEvent:event];
}

- (void) touchesMoved:(NSSet*)touches withEvent:(UIEvent*)event
{
    [pickerTable touchesMoved:touches withEvent:event];
}

- (void) touchesEnded:(NSSet*)touches withEvent:(UIEvent*)event
{
    [singleton set_secondsPauseRendering:0.5f];  // <-- my code to pause rendering

    [pickerTable touchesEnded:touches withEvent:event];
}

- (void) touchesCancelled:(NSSet*)touches withEvent:(UIEvent*)event
{
    [pickerTable touchesCancelled:touches withEvent:event];
}

- (UIView*) hitTest:(CGPoint)point withEvent:(UIEvent*)event
{
    if (CGRectContainsPoint(self.bounds, point))
    {
        if (pickerTable == nil)
        {
            int nSubviews = self.subviews.count;
            for (int i = 0; i < nSubviews; ++i)
            {
                UIView* view = (UIView*) [self.subviews objectAtIndex:i];
                if ([view isKindOfClass:NSClassFromString(@"UIPickerTable")])
                {
                    pickerTable = (UIPickerTable*) view;
                    break;
                }
            }
        }
        return self;    // i.e., *WE* will respond to the hit and pass it to UIPickerTable, above.
    }
    return [super hitTest:point withEvent:event];
}

@end 
```

然后是标题，SubUIPickerView.h：

```
@class UIPickerTable;

@interface SubUIPickerView : UIPickerView
{
    UIPickerTable*  pickerTable;
}

@end 
```

就像我说的，这行得通。渲染暂停额外 1/2 秒（滑动 UIScrollView 时它已经暂停）允许 UIPickerView 动画完成。使用 NSClassFromString() 意味着您没有使用任何未记录的 API。没有必要弄乱响应者链。感谢 checcco 和 Tylerc230 帮助我提出自己的解决方案！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-04T16:57:35.137

将父视图的 canCancelContentTouches 和 delaysContentTouches 设置为 NO，这对我有用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-02-16T05:20:21.690

找不到最近的，更简单的解决方案，所以我操纵了一些东西来解决我的问题。创建了一个在选取器视图上延伸的不可见按钮。将该按钮与“Touch Down”识别器连接到我的父 UIView。现在可以添加任何功能，当有人触摸选择器视图时，我碰巧需要一个随机选择计时器来失效。不优雅，但它有效。

# java - 在 Tomcat 上运行 Java .war 时出现问题

> ID：567810
> 
> 赞同：1
> 
> 时间：2009-02-20T00:03:40.403
> 
> 标签：java, tomcat, nutch

我正在关注这里的教程：

[http://nutch.sourceforge.net/docs/en/tutorial.html](http://nutch.sourceforge.net/docs/en/tutorial.html)

爬行工作正常，从命令行进行测试搜索也是如此。

当我在将 ROOT.war 移动到位后尝试启动 Tomcat 时（它在启动期间取消归档并创建一个新的 ROOT 文件夹），我得到一个页面，其中包含 500 错误和 Tomcat 日志中的一些错误。

HTTP 状态 500 - 没有配置上下文来处理此请求

```
2009-02-19 15:55:46 WebappLoader[]: Deploy JAR /WEB-INF/lib/xerces-2_6_2.jar to C:\Program Files\Apache Software Foundation\Tomcat 4.1\webapps\ROOT\WEB-INF\lib\xerces-2_6_2.jar
2009-02-19 15:55:47 ContextConfig[] Parse error in default web.xml
org.apache.commons.logging.LogConfigurationException: User-specified log class 'org.apache.commons.logging.impl.Log4JLogger' cannot be found or is not useable.
    at org.apache.commons.digester.Digester.createSAXException(Digester.java:3181)
    at org.apache.commons.digester.Digester.createSAXException(Digester.java:3207)
    at org.apache.commons.digester.Digester.endElement(Digester.java:1225) ............ etc. 
```

所以看起来错误的根源是默认的 web.xml，而不是在 Log4JLogger 中——尽管我对 Java 知之甚少。我没有在 tomcat 目录中编辑 web.xml。

有人知道这里发生了什么吗？

版本/信息：

纽扣 0.9

雄猫 4.1

jre1.5.0_08

jdk1.6.0_12

NUTCH_JAVA_HOME=C:\Program Files\Java\jdk1.6.0_12

JAVA_HOME=C:\Program Files\Java\jdk1.6.0_12

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T06:52:22.153

在 Java 中，应用程序有时依赖第三方库。在这种情况下，您的 Tomcat 安装似乎不包含一个这样的库。从您收到的错误来看，您似乎缺少[Apache Commons Logging](http://commons.apache.org/logging/)库（Java 世界中的一个常用库，恰好没有与 Tomcat 捆绑在一起）。

在 Java 中分发库的典型方法是通过 JAR（Java 存档）文件。简单地说，JAR 文件就是一堆 Java 类，它们被压缩到一个文件中，该文件已从 *.zip 重命名为 *.jar。

要获取 Commons Logging JAR 文件，您可以从[Apache Commons 下载站点](http://commons.apache.org/downloads/download_logging.cgi)下载它。您将需要二进制版本，而不是源版本。如果您碰巧下载了 1.1.1 版（例如），您应该解压缩该`commons-logging-1.1.1-bin.zip`文件。在里面，你会发现一个名为`commons-logging-1.1.1.jar`. 将此 JAR 文件复制到`lib`安装 Tomcat 软件的目录中。在 Tomcat 注意到这个新文件之前，您可能需要重新启动它。

希望下次您尝试使用该应用程序时，您可能会或可能不会收到另一个错误，表明找不到另一个类。在这种情况下，我欢迎您来到 JAR 狩猎的精彩世界！:) 希望该应用程序不需要过多的库，超出 Commons Logging，但我们会看到（考虑到您正在尝试运行 Nutch，我可以预见它需要[Lucene](http://www.apache.org/dyn/closer.cgi/lucene/java/)，所以为此做好准备）。

和 Nutch 一起玩吧！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T06:52:39.720

对我来说，这告诉它找不到本身报告为解析错误的记录器。我猜想表达它的方式有点奇怪或不合时宜。无论如何，我认为您需要将[Commons Logging .jar](http://commons.apache.org/logging/)添加到您的库（`WEB-INF/lib`）并重新启动 Tomcat，然后它应该可以工作。

此外，您的 Tomcat 似乎很古老，如果可能的话，我建议您使用 5.5.x 或 6.x。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T07:36:00.100

如果您发现应用程序中存在所需的 .jar，则解决问题的方法可能是：

1.  停止 Tomcat
2.  转到 %TOMCAT_HOME%/ 擦除里面的所有内容

顾名思义，这个“工作”文件夹包含用于工作的类，有时可以出于任何原因阻止对其中一些文件的访问。当我收到这样的消息时，这是第一件事。大多数时候它的工作...

# linq - 使用 Linq-to-XML 插入，带线程

> ID：567811
> 
> 赞同：3
> 
> 时间：2009-02-20T00:03:45.163
> 
> 标签：linq, multithreading, linq-to-xml

确保线程安全的 Linq-to-XML 编写的最佳方法是什么？

我们最近在我们的 Web 集群上超载，我不得不从我的屁股中提取一个快速的重载.aspx 来捕获电子邮件，以便以后当网站变得更加响应时可以与人们联系。在我短短 5 分钟的匆忙中，我写了这个：

```
private static object LockHandle = new object();

protected override void OnLoad(EventArgs e)
{
  SubmitButton.ServerClick += new EventHandler(SubmitButton_ServerClick);
  base.OnLoad(e);
}

void SubmitButton_ServerClick(object sender, EventArgs e)
{
  string email = Email.Value.Trim();
  if (email.Length > 0)
  {
    Regex regex = new Regex(@"^([\w\-\.]+)@((\[([0-9]{1,3}\.){3}[0-9]{1,3}\])|(([\w\-]+\.)+)([a-zA-Z]{2,4}))$");
    if (regex.IsMatch(email))
    {
      lock (LockHandle)
      {
        try
        {
          string fileName = Server.MapPath("emails.xml");
          XDocument xdoc = XDocument.Load(fileName);
          xdoc.Element("emails").Add(new XElement("email", email));
          xdoc.Save(fileName);
        }
        catch {}
      }

      ResponseText.Text = "Thanks! We'll get back to you.";

    }
  }
} 
```

如果 Linq-to-XML 是线程安全的，我无法查找；所以，理论变成了“让我锁定一个静态对象，这样可以防止多次写入。” 这是最好的方法吗？它甚至需要（Linq-to-Xml 线程安全吗？）。遗憾的是，我的两本 Pro LINQ 和 Linq in Action 书籍并未涉及该主题。

这很好，我们在超载的 20m 中捕获了大量电子邮件。只是想知道是否有更好的方法；或者，如果一开始就锁定它只是矫枉过正。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T00:11:21.963

通常，在 MSDN 上，如果类型或非静态成员未明确标记为线程安全，则不是。一般静态成员应该是。

假设正在遵循 MS 自己的指导方针。

但是，您似乎希望在执行加载/编辑/保存组时保护文件不被更改。如果您维护一个锁，那只有线程安全（如果您直接创建具有适当读/写的 FileSram，然后将其（使用 StreamReader 或 StreamWriter 包装器）传递给 Load 和 Save 方法，这很容易）。

仅使用锁的缺点是文件打开方法（包括那些在对象构造上隐式调用的方法）如果文件被锁定会抛出异常。因此，您可能需要一个锁来避免这种情况（如果您涉及多个进程或应用程序域，则可能需要一个互斥锁）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T00:21:54.137

以这种方式保存文件本质上不是线程安全的，因此使用静态锁句柄很聪明。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T00:12:41.850

我猜 LINQ 对象遵循与任何 .Net SDK 对象相同的线程安全准则：

*   对静态方法的调用不需要跨线程同步
*   对同一个实例对象的调用应该跨线程同步

# apache - Apache2反向代理到需要BasicAuth但希望对用户隐藏的端点

> ID：567814
> 
> 赞同：21
> 
> 时间：2009-02-20T00:05:17.063
> 
> 标签：apache, apache2, reverse-proxy, basic-authentication, mod-proxy

基本上我的情况是我有一个内部网站，需要一个硬编码的用户名和密码才能访问（并且不能关闭，只能更改）。由于各种原因（隐藏端口、简化 url、简化 NAT 等），我通过反向代理公开了这个网站。

~~但是，我想做的是能够使用 Apache 来处理身份验证，以便：~~

1.  我不必给每个人~~一个~~密码
2.  ~~我可以使用 Apache 的 BasicAuth 拥有多个用户名和密码~~

4.  ~~对于内部用户，我不必提示输入密码~~

**编辑：关于更丰富的身份验证的第二部分已移至[新问题](https://stackoverflow.com/questions/580032)**

这或多或少是我现在所拥有的：

```
<VirtualHost *:80>
  ServerName sub.domain.com

  ProxyPass        / http://192.168.1.253:8080/endpoint
  ProxyPassReverse / http://192.168.1.253:8080/endpoint

  # The endpoint has a mandatory password that I want to avoid requiring users to type
  # I.e. something like this would be nice (but does not work)

  # ProxyPass        / http://username:password@192.168.1.253:8080/endpoint
  # ProxyPassReverse / http://username:password@192.168.1.253:8080/endpoint

  # Also need to be able to require a password to access proxy for people outside local subnet
  # However these passwords will be controlled by Apache using BasicAuth, not the ProxyPass endpoint

  # Ideas?
</VirtualHost> 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-20T21:14:42.630

在将任何请求传递到端点之前添加或覆盖授权标头。授权标头可以硬编码，它只是字符串“用户名：密码”的 base-64 编码（不带引号。）

如果尚未完成，请启用 mod_headers 模块。

```
RequestHeader set Authorization "Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==" 
```

要有条件地执行此操作，请启用 mod_setenvif，例如，在本地请求的情况下仍要求主密码：

```
SetEnvIf Remote_Addr "127\.0\.0\.1" localrequest
RequestHeader set Authorization "Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==" env=!localrequest 
```

*   [http://en.wikipedia.org/wiki/Basic_access_authentication](http://en.wikipedia.org/wiki/Basic_access_authentication)
*   [http://httpd.apache.org/docs/2.0/mod/mod_headers.html](http://httpd.apache.org/docs/2.0/mod/mod_headers.html)
*   [http://httpd.apache.org/docs/2.0/mod/mod_setenvif.html](http://httpd.apache.org/docs/2.0/mod/mod_setenvif.html)

**例子**

```
# ALL remote users ALWAYS authenticate against reverse proxy's
#  /www/conf/passwords database
#
<Directory /var/web/pages/secure>
  AuthBasicProvider /www/conf/passwords
  AuthType Basic
  AuthName "Protected Area"
  Require valid-user
</Directory>

# reverse proxy authenticates against master server as:
#  Aladdin:open sesame (Base64 encoded)
#
RequestHeader set Authorization "Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-01-17T20:57:16.537

好吧，我用你的例子来指向两个使用 apache proxypass 的 IP 摄像机。当我使用语法 user:password@camarafeliz3.compufiber.com 并通过 iphone 访问时，我从 safari（iphone 导航器）收到了一条安全消息，因此我更改了示例以与 iPhone 4S 配合使用

```
<Location /camarafeliz1/ >
        # usuario admin password 123456
        ProxyPass         http://192.168.0.39/
        ProxyPassReverse  http://192.168.0.39/
        RequestHeader set Authorization "Basic YWRtaW46MTIzNDU2=="
</Location>
<Location /camarafeliz3/ >
        # usuario admin password 123456
        ProxyPass         http://192.168.0.99/
        ProxyPassReverse  http://192.168.0.99/
        RequestHeader set Authorization "Basic YWRtaW46MTIzNDU2=="
</Location> 
```

由于链接中的用户名和密码，iphone 4s 不再抱怨安全性。

# netbeans - 您在 Netbeans 中创建了哪些有用的宏？

> ID：567815
> 
> 赞同：36
> 
> 时间：2009-02-20T00:06:16.390
> 
> 标签：netbeans, macros

我使用 Netbeans (nightly build) 进行 Ruby on Rails 开发，并且希望增强我的宏。我自己创建了一些：

复制标识符：

```
select-identifier copy-to-clipboard 
```

将剪贴板粘贴到标识符上：

```
select-identifier paste-from-clipboard 
```

双引号元素

```
select-element-next "\"" 
```

单引号元素：

```
select-element-next "'" 
```

但我正在寻找其他有用的，而谷歌什么也没给我。记录宏功能通常不能很好地工作，所以我宁愿自己“编写”宏，但我什至找不到列出哪些命令（如“select-identifier”）实际可用的参考。

那里有任何 Netbeans 宏专家吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-25T08:55:02.027

[这](http://wiki.netbeans.org/FaqEditorMacros)是带有简短说明的宏代码列表。可能对某人有用。

**更新：**用一个指向 Netbeans 站点的旧链接替换旧链接，并在此处包含宏列表。

```
abbrev-debug-line   Debug Filename and Line Number
adjust-caret-bottom Move Insertion Point to Bottom
adjust-caret-center Move Insertion Point to Center
adjust-caret-top    Move Insertion Point to Top
adjust-window-bottom    Scroll Insertion Point to Bottom
adjust-window-center    Scroll Insertion Point to Center
adjust-window-top   Scroll Insertion Point to Top
all-completion-show Show All Code Completion Popup
annotations-cycling Annotations Cycling
beep    Beep
build-popup-menu    Build Popup Menu
build-tool-tip  Build Tool Tip
caret-backward  Insertion Point Backward
caret-begin Insertion Point to Beginning of Document
caret-begin-line    Insertion Point to Beginning of Text on Line
caret-begin-word    Insertion Point to Beginning of Word
caret-down  Insertion Point Down
caret-end   Insertion Point to End of Document
caret-end-line  Insertion Point to End of Line
caret-end-word  Insertion Point to End of Word
caret-forward   Insertion Point Forward
caret-line-first-column Insertion Point to Beginning of Line
caret-next-word caret-next-word
caret-previous-word caret-previous-word
caret-up    Insertion Point Up
collapse-all-code-block-folds   Collapse All Java Code
collapse-all-folds  Collapse All
collapse-all-javadoc-folds  Collapse All Javadoc
collapse-fold   Collapse Fold
comment Comment
complete-line   Complete Line
complete-line-newline   Complete Line and Create New Line
completion-show Show Code Completion Popup
copy-selection-else-line-down   Copy Selection else Line down
copy-selection-else-line-up Copy Selection else Line up
copy-to-clipboard   Copy
cut-to-clipboard    Cut
cut-to-line-begin   Cut from Insertion Point to Line Begining
cut-to-line-end Cut from Insertion Point to Line End
default-typed   Default Typed
delete-next Delete Next Character
delete-previous Delete Previous Character
documentation-show  Show Documentation Popup
dump-view-hierarchy Dump View Hierarchy
expand-all-code-block-folds Expand All Java Code
expand-all-folds    Expand All
expand-all-javadoc-folds    Expand All Javadoc
expand-fold Expand Fold
fast-import Fast Import
find-next   Find Next Occurrence
find-previous   Find Previous Occurrence
find-selection  Find Selection
first-non-white Go to First Non-whitespace Char
fix-imports Fix Imports
format  Format
generate-code   Insert Code
generate-fold-popup Generate Fold Popup
generate-goto-popup Generate Goto Popup
generate-gutter-popup   Margin
goto    Go to Line...
goto-declaration    Go to Declaration
goto-help   Go to Javadoc
goto-implementation Go to Implementation
goto-source Go to Source
goto-super-implementation   Go to Super Implementation
in-place-refactoring    Instant Rename
incremental-search-backward Incremental Search Backward
incremental-search-forward  Incremental Search Forward
insert-break    Insert Newline
insert-date-time    Insert Current Date and Time
insert-tab  Insert Tab
introduce-constant  Introduce Constant...
introduce-field Introduce Field...
introduce-method    Introduce Method...
introduce-variable  Introduce Variable...
java-next-marked-occurrence Navigate to Next Occurrence
java-prev-marked-occurrence Navigate to Previous Occurrence
jump-list-last-edit Last edit
jump-list-next  Forward
jump-list-prev  Back
last-non-white  Go to Last Non-whitespace Char
make-getter Replace Variable With its Getter
make-is Replace Variable With its is* Method
make-setter Replace Variable With its Setter
match-brace Insertion Point to Matching Brace
move-selection-else-line-down   Move Selection else Line down
move-selection-else-line-up Move Selection else Line up
org.openide.actions.PopupAction Show Popup Menu
page-down   Page Down
page-up Page Up
paste-formated  Paste Formatted
paste-from-clipboard    Paste
redo    Redo
reindent-line   Re-indent Current Line or Selection
remove-line Delete Line
remove-line-begin   Delete Preceding Characters in Line
remove-selection    Delete Selection
remove-tab  Delete Tab
remove-trailing-spaces  Remove Trailing Spaces
remove-word-next    remove-word-next
remove-word-previous    remove-word-previous
replace Replace
run-macro   Run Macro
scroll-down Scroll Down
scroll-up   Scroll Up
select-all  Select All
select-element-next Select Next Element
select-element-previous Select Previous Element
select-identifier   Select Identifier
select-line Select Line
select-next-parameter   Select Next Parameter
select-word Select Word
selection-backward  Extend Selection Backward
selection-begin Extend Selection to Beginning of Document
selection-begin-line    Extend Selection to Beginning of Text on Line
selection-begin-word    Extend Selection to Beginning of Word
selection-down  Extend Selection Down
selection-end   Extend Selection to End of Document
selection-end-line  Extend Selection to End of Line
selection-end-word  Extend Selection to End of Word
selection-first-non-white   Extend Selection to First Non-whitespace Char
selection-forward   Extend Selection Forward
selection-last-non-white    Extend Selection to Last Non-whitespace Char
selection-line-first-column Extend Selection to Beginning of Line
selection-match-brace   Extend Selection to Matching Brace
selection-next-word selection-next-word
selection-page-down Extend Selection to Next Page
selection-page-up   Extend Selection to Previous Page
selection-previous-word selection-previous-word
selection-up    Extend Selection Up
shift-line-left Shift Line Left
shift-line-right    Shift Line Right
split-line  Split Line
start-macro-recording   Start Macro Recording
start-new-line  Start New Line
stop-macro-recording    Stop Macro Recording
switch-case Switch Case
to-lower-case   To Lowercase
to-upper-case   To Uppercase
toggle-case-identifier-begin    Switch Capitalization of Identifier
toggle-comment  Toggle Comment
toggle-highlight-search Toggle Highlight Search
toggle-line-numbers Toggle Line Numbers
toggle-non-printable-characters Toggle Non-printable Characters
toggle-toolbar  Toggle Toolbar
toggle-typing-mode  Toggle Typing Mode
tooltip-show    Show Code Completion Tip Popup
uncomment   Uncomment
undo    Undo
word-match-next Next Matching Word
word-match-prev Previous Matching Word 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-07-30T10:35:51.303

我需要用 HTML 标签包围文本片段，但不知道如何快速做到这一点，所以我想出了这个宏：

```
cut-to-clipboard "<strong>" paste-from-clipboard "</strong>" 
```

简单，干净，您可以放置​​任何您想要的标签/文本。给它一个快捷键，比如 Alt+B，你就可以快速插入 HTML

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-11-10T13:15:14.933

对于 php 将分号添加到结束行（“完整行”）
但将光标保持在当前点，这样您就可以继续输入该行的其余部分

```
split-line
caret-down
caret-end-line ";" 
caret-begin-line 
selection-begin-line remove-selection 
delete-previous 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-25T11:19:29.623

这是我的第一个 netbeans 宏。

“回声'<pre>';print_r();die();”

我的快捷键 => Alt+A

为此，您可以使用任何快捷方式

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-03T09:03:34.013

哦，好吧，只是尝试使用netbeans。

我为 netbeans 添加了一个简单的新宏。名称：“scrollup_newline” 代码：插入中断向上滚动

它工作得很好，所以每次我按下回车键，编辑器都会下移一行。这样我就可以编码并在编辑器中间放置插入符号。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-03T20:56:32.560

这是针对 HTML 的。我刚做了：

```
caret-begin-line "<li>" caret-end-line "</li>" caret-down
```

将其映射到 ctrl+shift+L 这是我的第一个 netbeans 宏。稍后也许我可以以某种方式使其适用于整个选择。

编辑：无法弄清楚为选择做这件事，但在最后添加“caret-down”几乎一样好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-28T18:34:40.100

这是我今天写的宏。我非常缺少 PHP 中的“提取方法”或“引入方法”重构，所以我编写了这个宏。我知道这远没有 Java 中的重构复杂，但它可以使用，并且可以节省一些复制/粘贴和编写重复代码。

```
cut-to-clipboard
"$this->UNNAMED_METHOD();"
collapse-fold
caret-end-line caret-backward caret-end-line insert-break
"private function UNNAMED_METHOD() {"insert-break
paste-from-clipboard insert-break 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-03-16T16:29:37.410

此宏插入`-moz-`和`-webkit-`前缀等效的 css3 样式规则：

```
caret-end-line selection-begin-line copy-to-clipboard caret-backward insert-break caret-up "-webkit-" paste-from-clipboard insert-break "-moz-" paste-from-clipboard 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-04-03T16:44:37.087

```
insert-date-time remove-word-previous remove-word-previous 
```

映射到 CTRL+SHIFT+D 以插入短日期，非常有用，因为我喜欢给我的评论/待办事项添加日期，但通常不知道日期！

虽然我觉得 Code Templates 多有用，例如：

```
 // <editor-fold defaultstate="collapsed" desc="${cursor}"> 
```

和

```
 // </editor-fold> 
```

分别映射到 'fold' 然后制表符和 'endfold' 然后制表符。

还

```
JOptionPane.showMessageDialog(null, "${EXP default="Got here"}"); 
```

映射到“jop”然后选项卡很方便。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-27T16:42:07.503

可能不是最有效的，但它可以帮助我大声笑

```
"(() ? : );"
caret-backward
caret-backward
caret-backward
caret-backward
caret-backward
caret-backward
caret-backward
caret-backward 
```

可以看到，这是针对 PHP 快速条件的。然后，这会将光标放在您开始输入条件的位置。无论你把它扔到哪里都很完美。我把它放到 Ctrl+NUMPAD0 以便快速输入访问。我原本有两个标签，但很快就很烦人哈哈

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-11-03T12:33:28.467

我经常喜欢在 JavaScript 中使用逗号作为分隔属性或列表项的第一个字符；像这样：

```
var foo = {
    a : 'a'
    //, b : 'B' //todo: make lcase
    , c : 'c'
}; 
```

有时，我要么忘记这样做，要么有大量文本要更新。为了快速解决这些问题，我将键盘快捷键`C-, C-,`（即在按住 CTRL 键的同时按两次“，”）绑定到：

```
caret-end-line selection-next-word selection-next-word " " caret-backward caret-backward insert-break 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-01-27T15:01:08.897

我发现代码模板非常有用，尤其是这个（用于 HTML）：

```
<${tag}>${cursor}</${tag}> 
```

缩写为“tt”，也可以在代码模板菜单调用时，用自定义标签包围任意文本。

```
<${param_name default="tag"}${cursor}>
${selection}
</${param_name default="tag"}> 
```

这个将用任何标签包围任何东西。选择一些东西，然后 Alt+F3，然后从菜单中选择这个模板。之后键入您想要的标签，例如“div”。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-08-16T21:15:04.473

这是使用 SLF4J 在类中创建静态记录器的代码模板。我将它与“日志”联系起来。

```
private static final ${loggerType type="org.slf4j.Logger" default="Logger" editable="false"} log = ${loggerFactoryType type="org.slf4j.LoggerFactory" default="LoggerFactory" editable="false"}.getLogger(${classType editable="false" currClassName default="getClass()"}.class); 
```

这会生成一个 log.debug 行，我将其绑定到“log”：

```
log.debug("${message}", "${variables}"); 
```

# iphone - CATransform3D 与 CGAffineTransform？

> ID：567829
> 
> 赞同：25
> 
> 时间：2009-02-20T00:12:43.020
> 
> 标签：iphone, cocoa, cocoa-touch, core-animation, core-graphics

两者有什么区别？

我敢肯定，他们各有利弊，在某些情况下他们表现更好。

有比较两者的资源吗？

动画效果更好吗（我想是 CATransform3D）？为什么？

另外我想我在某处读到文本清晰度可能是一个问题，是否更适合缩放文本？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-20T01:09:45.097

正如 MSN 所说，它们用于不同的情况。CGAffineTransform 用于 NSView、UIView 和其他 2-D 核心图形元素的 2-D 操作。

CATransform3D 是一个核心动画结构，可以对 CALayers 进行更复杂的 3-D 操作。CATransform3D 具有与 OpenGL 模型视图矩阵相同的内部结构，当您意识到 Core Animation 是基于 OpenGL 构建的（CALayers 是 OpenGL 纹理的包装器等）时，这是有道理的。我发现这种内部结构的相似性，再加上 Apple 提供的一些不错的辅助函数，可以让你做一些简洁的 OpenGL 优化，正如我在[此处](http://www.sunsetlakesoftware.com/2009/01/13/opengl-es-catransform3d)发布的那样。

在选择使用哪个时，问问自己是要直接在 2-D 空间中使用视图 (CGAffineTransform) 还是使用 3-D 中的底层核心动画层 (CATransform3D)。我更频繁地使用 CATransform3D，但那是因为我花了很多时间在 Core Animation 上。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-20T00:26:46.387

一种用于线性二维变换，另一种用于三维投影变换。至少这是我可以从文档中收集到的。

如果您不需要将 3d 投影到屏幕上，请使用仿射变换。否则，使用 3d 变换。3d 变换本质上是一个 4x4 矩阵，而 2d 仿射矩阵是 3x2。

# javascript - jQuery Flexigrid Resize IE7 中的列损坏

> ID：567830
> 
> 赞同：1
> 
> 时间：2009-02-20T00:13:04.767
> 
> 标签：javascript, jquery, jquery-plugins

在 Firefox 中，调整列大小可以正常工作。但是在ie7中，它已经坏了。

[这是一个](http://markmail.org/message/dyv44u5fjhgylu2r?q=ie7+resize+column+list:com.googlegroups.flexigrid)关于 flexigrid 从 jquery 1.3 中断的线程，我已经尝试了对 flexigrid 代码的建议编辑，没有工作。

我们目前正在使用 jquery 1.3，虽然我已经尝试过 1.3.1 和 1.3.2，但都没有解决问题。

在 ie7 中检查 css 时，我注意到`<div class="cDrag">`（包含用于拖动列的样式的 div）位于我的网格右侧。

有没有人经历过类似的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T00:19:39.337

IE7 在页面顶部需要以下内容：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http:// www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
```

# javascript - 为什么这个 jQuery 动画会上下跳跃？

> ID：567837
> 
> 赞同：0
> 
> 时间：2009-02-20T00:14:53.437
> 
> 标签：javascript, jquery, animation

CSS 或多或少无关紧要。如何停止跳跃？

```
jQuery(function() {
  jQuery("#showquickfind").mouseover(function() {
    jQuery("#quickfind").animate({
      height: "show",
      opacity: "show"
    }, "slow");
    return false;
  });
  jQuery("#quickfind").hover(function() {},
    function() {
      $("#quickfind").animate({
        opacity: 1.0
      }, 1125).slideUp(375);
      return false;
    });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<a href="" id="showquickfind">show me</a>

<div id="quickfind">
  <ul>
    <li>test</li>
    <li>test2</li>
    <li>test3</li>
  </ul>
</div>
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T00:41:35.400

您可能想查看在每个动画命令之前链接[jQuery.stop()](http://docs.jquery.com/Effects/stop#clearQueuegotoEnd)命令。它停止指定元素上所有当前正在运行的动画。IE

```
jQuery("#quickfind").stop().animate({ 
    height:"200px", opacity: 1},"slow"); 
    return false; 
```

您是否有理由使用 jQuery 而不是 jQuery 对象的简写 $？您可以使用 $ jQuery 对象的简写，即使使用其他使用它的库，也可以遵循以下模式 -

```
(function($) {

//Your code here using $ shorthand for jQuery :)

})(jQuery); 
```

这意味着外部函数范围内的 $ 是 jQuery 对象的引用。

[我已在此示例页面上](http://jsbin.com/oluqe)设置了您的代码。如果要编辑它，请在 URL 中添加“/edit”。

另外，您确定“显示”是高度和不透明度的有效值吗？

我的理解是，*高度*需要设置为自动（即包含块的大小）、长度或相对于包含块的百分比，并且*不透明度*应该是介于 0 和 1 之间的值（jQuery 抽象出浏览器之间的差异并将使用合适的不透明度属性，*即*不透明度*或*过滤器：alpha（不透明度））

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T00:39:15.857

你有和我一样的问题。发生的事情是您的悬停事件发生了，快速查找向上滑动，但随后它消失了，所以它再次显示，等等，等等。

我发现让它停止跳跃的唯一方法是在容器元素上设置一个高度，以便它始终保持该高度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T00:50:14.443

您可能想要使用`mouseenter`事件，而不是`mouseover`.

[jQuery 文档](http://docs.jquery.com/Events/mouseover)中描述了不同之处。

> **当指针*移入或移出 child element时，* **Mouseover**会触发，而**mouseenter**不会。**

 **还有示例如何使用它，您必须使用该`bind()`功能。

**编辑**

毕竟最好的解决方案可能是使用[`hover()`](http://docs.jquery.com/Events/hover)，正如 Russ Cam 在评论中提到的那样。

**顺便提一句**

您正在多次注册悬停手柄，每次都经过“show me”链接。

# haskell - 你可以在haskell中使用列表理解一次创建多个列表元素吗？

> ID：567840
> 
> 赞同：6
> 
> 时间：2009-02-20T00:19:36.280
> 
> 标签：haskell, list, list-comprehension

因此，例如，假设我有一个数字列表，并且我想创建一个列表，其中包含每个数字乘以 2 和 3。有没有办法做类似下面的事情，但取回一个数字列表而不是数字列表的列表？

```
mult_nums = [ [(n*2),(n*3)] | n <- [1..5]] 
-- this returns [[2,3],[4,6],[6,9],[8,12],[10,15]]
-- but we want [2,3,4,6,6,9,8,12,10,15] 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-20T03:40:59.027

我发现扩展列表理解使这更容易阅读：

```
[ m | n <- [1..5], m <- [2*n,3*n] ] 
```

准确检查它的作用以及它与其他解决方案的关系可能会有所帮助。让我们将其定义为一个函数：

```
mult lst = [ m | n <- lst, m <- [2*n,3*n] ] 
```

在时尚之后，这[脱糖](http://haskell.org/onlinereport/exps.html#list-comprehensions)到

```
mult' lst = 
    concatMap (\n -> concatMap (\m -> [m]) [2*n,3*n]) lst 
```

表达式`concatMap (\m -> [m])`被包裹`m`在一个列表中以便立即将其展平——它相当于`map id`.

将此与@FunctorSalad 的答案进行比较：

```
mult1 lst = concatMap (\n -> [n*2,n*3]) lst 
```

我们已经优化了`concatMap (\m -> [m])`。

现在@vili 的回答是：

```
mult2 lst = concat [ [(n*2),(n*3)] | n <- lst] 
```

这对：

```
mult2' lst = concat (concatMap (\n -> [[2*n,3*n]]) lst) 
```

与上面的第一个解决方案一样，我们不必要地创建了一个必须删除的列表列表`concat`。

我认为没有使用列表推导的解决方案，但对`mult1`. 我的直觉是，Haskell 编译器通常足够聪明，这无关紧要（或者，`concat`由于惰性评估，不必要的 s 很便宜（而它们在急切的语言中是致命的））。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-20T00:25:29.167

你可以使用连接。

```
concat [ [(n*2),(n*3)] | n <- [1..5]] 
output: [2,3,4,6,6,9,8,12,10,15] 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-20T00:30:42.557

在某些类似的情况下， concatMap 也可以很方便，尽管在这里它并没有太大变化：

```
concatMap (\n -> [n*2,n*3]) [1..5]
```

# java - 字符串分隔的正则表达式

> ID：567851
> 
> 赞同：1
> 
> 时间：2009-02-20T00:23:44.427
> 
> 标签：java, regex, parsing, bbcode

我正在尝试构建一个 bbcode 解析器，但是在弄清楚如何避免匹配过于广泛时遇到了很多问题。例如，我想实现一个 [list] 到这样的转换：

```
\[list\](.*)\[/list\] 
```

将被替换为：

```
<ul>$1</ul> 
```

这很好用，除非我有两个列表，其中正则表达式与第一个列表的开始标记和第二个列表的结束标记匹配。所以这

```
[list]list1[/list] [list]list2[/list] 
```

变成这样：

```
<ul>list1[/list] [list]list2</ul> 
```

这会产生非常丑陋的输出。关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T00:27:00.647

您使用的方法可能最终不是一个特别好的方法，但要解决该特定问题，只需更改为非贪婪匹配：

```
\[list\](.*?)\[\/list\] 
```

请注意，这种方式会遇到嵌套列表而不是背靠背列表的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T01:32:24.810

如果您正在做的不仅仅是轻量级的 hack，而是更永久的东西，您可能希望转向真正的解析器。Java 中的正则表达式特别慢（即使使用预编译模式）并且匹配嵌套结构（尤其是*不同的*嵌套结构，如 "foo [u][i] bar [s]baz[/s][/i][/u]" ）将成为皇家的痛苦。

相反，请尝试使用基于状态的解析器，它会反复将您的句子分成“foo”/（u）/“[i] bar [s]baz[/s][/i][/u]”等部分，并且维护一组在遇到匹配构造分隔符时翻转的状态。

# c# - FormsIdentity.Ticket.UserData 和身份验证ticket.UserData 保持同步

> ID：567858
> 
> 赞同：2
> 
> 时间：2009-02-20T00:25:23.707
> 
> 标签：c#, asp.net, forms-authentication

在我的 asp.net 网站上。我将一些数据放入表单身份验证票的 UserData 部分。稍后我可以使用

```
(FormsIdentity)(HttpContext.Current.User.Identity).Ticket.UserData 
```

我的问题是 - 只要身份验证票有效，这些数据是否总是在 FormsIdentity.Ticket.UserData 中可用？还是我最终需要在身份验证票证中同步 FormsIdentity.Ticket.UserData 和 UserData？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T20:36:50.100

是的，它是用身份验证票加密的，所以只要使用同一张票，它就会在那里。编辑：如果您要更改数据，则需要签发新的身份验证票。

# c# - 使用脚本关闭 IE“弹出”窗口

> ID：567867
> 
> 赞同：0
> 
> 时间：2009-02-20T00:33:55.107
> 
> 标签：c#, asp.net, internet-explorer, asp.net-ajax

是否可以禁用“您正在查看的网页正在尝试关闭窗口。您要关闭它吗？”？

我知道这是多年病毒和恶意脚本活动的产物，但是在合法的应用程序代码（ASP.NET）中，有什么方法可以将您的应用程序“注册”为应用程序，或者您可以传递的标志一个 IE 弹出窗口，以便它在关闭时不会显示？

我正在使用的代码是从后面的 C# 代码中完成的：

```
ClientScript.RegisterClientScriptBlock(GetType(), "save", Utils.MakeScriptBlock("window.close();")); 
```

Utils.MakeScriptBlock 只是一个功能，可以满足您的期望。它“注入”一个带有代码的 <script...> 标记...

可能无法解决这个问题，否则所有脚本小子都会使用该技巧，但我想我会问，因为我不能成为唯一使用简单 IE“弹出窗口”作为（伪）模态的人对话框。

此代码发生在我的 ButtonSave_Click() 例程中，在一切都通过验证等之后......

****编辑****
仅供参考，以下是单击添加按钮时打开弹出窗口的代码：

这是在 Page_Init()...

```
ButtonAdd.Attributes.Add("onclick", "window.open('Add.aspx', 'ADD_WINDOW', 'scrollbars=no,width=550,height=550,location=no,menubar=no,resizable=yes,directories=no,status=no,toolbar=no'); return false;"); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T00:36:23.570

如果窗口是由您的脚本打开的，您可以在不弹出窗口的情况下关闭窗口。这有帮助吗？

**编辑：** 您已经用脚本打开了窗口。将您的客户端脚本更改为调用 self.close()。

```
ClientScript.RegisterClientScriptBlock(GetType(), "save", Utils.MakeScriptBlock("self.close();")); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T00:36:11.137

我相信不会。正如您所说，有助于防止恶意软件。

到底浏览器不知道你不是邪恶的。有关类似的想法，请参阅 RFC 3514。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T00:37:24.067

我非常怀疑这对您来说是可能的 - 听起来像是用户必须在他们的 IE 设置中专门禁用的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T00:54:50.767

如果用户打开了浏览器窗口，则不能关闭它；但是如果窗口是通过脚本打开的，你可以。听起来您只需要一个初始页面，用户从“单击此处开始”链接开始，您可以从该页面打开网站主要部分的新窗口；当他们都完成后，关闭弹出窗口，他们会留下他们的初始浏览器窗口，并显示“单击此处开始”消息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T09:12:41.523

奇怪，但我发现了

```
<script type="text/javascript">
function closeWindow()
{
    window.close();
    return false;
}
</script> 
```

然后打电话

```
return closeWindow(); 
```

通常会解决这个问题。

# .net - 实现使用规范来确定要创建的对象类型的工厂

> ID：567868
> 
> 赞同：3
> 
> 时间：2009-02-20T00:34:26.133
> 
> 标签：.net, design-patterns, reflection, factory, specification-pattern

这主要是一个思想实验。所以这一切都是示例代码。我的目标是使用规范模式来消除工厂内大量的条件代码。因此，对于这个示例，我有一个 StatusData 对象，我想获得一个适合它的 IStatusUpdate 实现。

我有以下一组测试：

```
 [TestMethod]
    public void Factory_Interface_Should_Return_IStatusUpdate()
    {
      var factory = MockRepository.GenerateMock<IUpdateFactory<StatusData>>();
      var obj = MockRepository.GenerateStub<IStatusUpdate>();

      var data = new StatusData();
      factory.Stub(x => x.Get(data)).Return(obj);

      var item = factory.Get(data);

      Assert.IsInstanceOfType(item, typeof(IStatusUpdate));
    }

    [TestMethod]
    public void StatusUpdateFactory_Should_Return_IStatusUpdate()
    {
      var factory = new StatusUpdateFactory();
      var data = new StatusData();

      var item = factory.Get(data);

      Assert.IsInstanceOfType(item, typeof(IStatusUpdate));   
    }

    [TestMethod]
    public void StatusUpdateFactory_Should_Return_NewStatusUpdate_When_Status_Is_New()
    {
      var data = new StatusData(Status.New);
      var factory = new StatusUpdateFactory();

      var item = factory.Get(data);

      Assert.IsInstanceOfType(item, typeof(NewStatusUpdate));
    } 
```

到目前为止，我的工厂实现如下所示：

```
public class StatusUpdateFactory:IUpdateFactory<StatusData>
  {
    public IStatusUpdate Get(StatusData item)
    {
      IList<ISpecification<StatusData>> specs = GetSpecifications();

      foreach (var spec in specs)
      {
        if (spec.IsSatisfiedBy(item))
          //how do I do this?
           return new NewStatusUpdate();

      }
      return null;
    }

    private IList<ISpecification<StatusData>> GetSpecifications()
    {
      var returnList = new List<ISpecification<StatusData>>();
      var specTypes = this.GetType().Assembly.GetTypes()
                        .Where(z => z.IsInstanceOfType(typeof(ISpecification<StatusData>)))
                        .ToList();

      specTypes.ForEach(x => returnList.Add(Activator.CreateInstance(x) as ISpecification<StatusData>));

      return returnList;

    }
  } 
```

一旦我发现了状态对象满足的规范，我就会失败，我如何将该规范映射到实现 IStatusUpdate 的类型。我很难过。

有人正确地建议我需要将规范映射到 IStatusUpdate 实现者。这种映射似乎是工厂的责任，把它挂在规范之外闻起来像是违反了 SRP。我可以创建一个具有该职责的 Mapper 类，但这似乎不是很通用，并且还提出了如何将映射器映射到规范的问题。

我在这里仍然缺少一个小飞跃。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T00:46:30.350

如果我理解正确，你想要，给定一个实现 ISpecification 的对象，你想要一个实现 IStatusUpdate 的对象吗？

在您的示例中，这些类型均未定义，因此我不知道您可以使用它们之间是否存在任何关系。

但是您可能需要一些工厂来保存代码，或者需要一个 ISpecification.GetUpdate() 方法来创建对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T00:58:49.383

所以我假设我们真的专注于这组线：

```
if (spec.IsSatisfiedBy(item))
          return new NewStatusUpdate(); 
```

我假设你问的是如何以目前的形式做到这一点。似乎项目应该支持

```
interface ISpecSupport<T>
{
    bool ItemSpecsContain(ISpecification<T> spec);
} 
```

然后 spec.IsSatisfiedBy 方法可以接受这个接口类型并运行该方法。

换句话说，我想我是说该对象应该对它的内容进行某种描述（就规格而言）。我猜这是某种列表，但我不确定。我相信你可能已经想到了这一点，所以如果你能添加任何有用的东西。

此外，您可以像这样重新排列它，而不是上面的：

```
if (item.Satisfies(spec))
    return new NewStatusUpdate(); 
```

这样，您就不必使用备受诟病的访问者模式（我认为这就是我之前所描述的）。它更直接，因为该项目似乎拥有规范，这样您就允许该项目决定它是否符合规范。

如果您不希望将此逻辑保存在对象中（我会理解）并且您正在使用某种属性包（或者您对反射很酷），您可以使用独立规范深入了解对象的细节验证器。实际上，一个独立的验证者一开始可能不是一个坏主意。我不太确定知道规格是否与项目匹配的能力是否应该由单个规格保留。

# mysql - 网站用户的权限

> ID：567870
> 
> 赞同：0
> 
> 时间：2009-02-20T00:36:07.050
> 
> 标签：mysql, permissions, roles

我正在一个网站上工作，每个用户都可以拥有多个角色/权限，例如基本登录、订购产品、管理其他用户等等。除此之外，还有商店，每个商店可以有多个用户管理它。每个商店也有它自己的一组权限。

我很困惑自己，不确定如何最好地在数据库中表示这一点。现在我在想：

用户角色 users_roles 商店 stores_users

但是，我是否也应该拥有 stores_roles 和 stores_users_roles 表来跟踪商店的单独权限，还是应该将角色限制在单个“角色”表中？

我原本以为只有一个角色表，但是在多个商店中拥有角色的用户呢？即，如果用户被赋予“商店产品更新”的角色，则需要某种方法来确定这是指哪个商店。store_users_roles 表可以通过 store_id 字段解决此问题，因此用户可以对商店 #42 进行“商店产品更新”和“商店产品删除”，而对商店 #84 进行“商店产品更新”。

我希望我在这里有意义。

## 编辑

信息很有帮助，谢谢大家。显然我有一些想法要做。这只是我正在进行的一个有趣的项目，但 RBAC 一直是我想更好地理解的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T02:13:49.827

现在这对您来说可能很明显，但是基于角色*的*[访问控制](http://en.wikipedia.org/wiki/Role-based_access_control)很难。我的建议是，不要尝试自己编写，除非您希望该部分占用您希望花在“很酷的东西”上的所有时间。

 *有很多灵活的、经过全面测试的授权库实现了 RBAC（有时被错误地标记为 ACL），我的建议是找到一个适合您的需求并使用它。除非您是轮子极客，否则不要重新发明轮子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T00:50:10.683

在我看来，如果我有权在一组商店中担任某些角色，那么我可能在每个商店中都拥有相同的权限。因此，拥有一个角色表可能就足够了。所以“joe”可以做“商店产品更新”和“商店产品删除”，然后有一个 user_stores 表来列出他可以访问的商店。假设对于整个列表，他将在所有商店中拥有相同的权限。

如果业务规则是这样的，他可以在一个商店中更新和删除，但在另一个商店中只能更新，不能删除，那么您将不得不变得更复杂。

根据我的经验，您通常会被告知您需要很大的灵活性，然后一旦实施，就没有人使用它。GUI 变得非常复杂，难以管理。

如果 GUI 确实变得复杂，我建议您从商店的角度以及用户的角度来看它。换句话说，与其选择用户，然后选择他们拥有什么权限以及他们可以访问哪些商店，不如先选择一个商店，然后选择哪些用户可以访问该商店中的哪些角色*可能更简单。*取决于我猜有多少用户和多少商店。在过去的一个项目中，我发现用一种方法比另一种方法容易得多*。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T01:06:53.497

你的模型在我看来不错。我认为您需要的唯一修改是角色的粒度。现在，你的角色只是一个操作。

但首先，您需要一个 store_role 表、一个解决多对多关系 b/wa 角色的联合表和一个 store。即，一个商店可以有多个角色，一个角色可以在多个商店中完成。

例如：StoreA 可以创建、更新、删除客户。并且可以在StoreA、StoreB 和StoreC 中删除客户。

接下来，您可以自由地将用户关联到 user_store_roles 表中的 store_role_id。

现在，一个 user_store_role 记录将有一个 user_id 和一个 store_role_id：

一个集合

SELECT * FROM USER_STORE_ROLE WHERE user_id = @userID

返回用户在所有商店中允许的所有操作。

对于特定商店中用户角色的集合，将上述内容与 user_store 表进行内部连接，添加类似的 WHERE 部分

其中 STORE_ROLE.store_id = @storeID

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T00:56:17.860

`store_id`在`user_roles`桌子上放一个。

如果这是 Rails，用户模型将`have_many :stores, :through => :roles`

# java - 如何在 OS X 中使用 Java 找到用户的“文档”文件夹？

> ID：567874
> 
> 赞同：7
> 
> 时间：2009-02-20T00:37:39.217
> 
> 标签：java, macos

我想在用户的“文档”文件夹中创建一个目录，但到目前为止我只知道如何获取用户的主目录：

```
javax.swing.JFileChooser fr = new javax.swing.JFileChooser();
javax.swing.filechooser.FileSystemView fw = fr.getFileSystemView();
this.userDirectory = fw.getDefaultDirectory(); 
```

在 Windows 中，上面的代码返回“我的文档”目录，这很好，新文档应该去那里。在 OS X 上，它只返回主目录。

将“文档”添加到返回的路径会导致本地化问题。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T05:57:36.840

您想使用 Apple 的 eio.FileManager 扩展：

```
 static public String documentsDirectory()
            throws java.io.FileNotFoundException {
        // From CarbonCore/Folders.h
        final String kDocumentsDirectory = "docs";
        return com.apple.eio.FileManager.findFolder(
            com.apple.eio.FileManager.kUserDomain,
            com.apple.eio.FileManager.OSTypeToInt(kDocumentsDirectory)
        );
    } 
```

[文档](http://developer.apple.com/documentation/Java/Reference/1.5.0/appledoc/api)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T00:51:50.367

System.getProperty("user.home")+File.separator+"Documents";

不用担心本地化，看：

```
macb:Documents laullon$ pwd
/Users/laullon/Documents 
```

我的 OS X 是西班牙语的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-20T01:25:54.873

在 Mac 上（据我所知，所有最近的 10.x 变体）“我的文档”目录位于（从根目录）：
/Users/<用户名>/Documents
因此它位于用户的主目录。

# python - 如何在 Python 中处理命令行参数？

> ID：567879
> 
> 赞同：29
> 
> 时间：2009-02-20T00:41:02.203
> 
> 标签：python, command-line, command-line-arguments

如果我期望像 001 或 999 之类的东西（让我们这次将期望限制在 001...999 范围内），并且通过的其他参数很少，并且想忽略任何意外，那么处理命令行参数的简单表达式是什么？ ?

我知道，例如，如果我需要确定是否在参数之间传递了“调试”，它会是这样的：

```
if 'debug' in argv[1:]:
  print 'Will be running in debug mode.' 
```

如何确定009或575是否通过？

所有这些都是预期的电话：

```
python script.py
python script.py 011
python script.py 256 debug
python script.py 391 xls
python script.py 999 debug pdf 
```

在这一点上，我不在乎这样的电话：

```
python script.py 001 002 245 568
python script.py some unexpected argument
python script.py 0001
python script.py 02 
```

...第一个 - 因为不止一个“数字”参数；第二——因为……嗯，出乎意料的争论；第三和第四 - 因为非 3 位参数。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-20T01:02:40.420

正如其他人回答的那样， optparse 是最好的选择，但如果您只想快速编写代码，请尝试以下操作：

```
import sys, re

first_re = re.compile(r'^\d{3}$')

if len(sys.argv) > 1:

    if first_re.match(sys.argv[1]):
        print "Primary argument is : ", sys.argv[1]
    else:
        raise ValueError("First argument should be ...")

    args = sys.argv[2:]

else:

    args = ()

# ... anywhere in code ...

if 'debug' in args:
    print 'debug flag'

if 'xls' in args:
    print 'xls flag' 
```

**编辑**：这是一个 optparse 示例，因为很多人在回答 optparse 时没有真正解释原因，或者解释您必须更改哪些内容才能使其正常工作。

使用 optparse 的主要原因是它为您以后的扩展提供了更大的灵活性，并在命令行上为您提供了更多的灵活性。换句话说，您的选项可以按任何顺序出现，并且使用消息会自动生成。但是，要使其与 optparse 一起使用，您需要更改规范以将“-”或“--”放在可选参数的前面，并且您需要允许所有参数按任意顺序排列。

所以这里有一个使用 optparse 的例子：

```
import sys, re, optparse

first_re = re.compile(r'^\d{3}$')

parser = optparse.OptionParser()
parser.set_defaults(debug=False,xls=False)
parser.add_option('--debug', action='store_true', dest='debug')
parser.add_option('--xls', action='store_true', dest='xls')
(options, args) = parser.parse_args()

if len(args) == 1:
    if first_re.match(args[0]):
        print "Primary argument is : ", args[0]
    else:
        raise ValueError("First argument should be ...")
elif len(args) > 1:
    raise ValueError("Too many command line arguments")

if options.debug:
    print 'debug flag'

if options.xls:
    print 'xls flag' 
```

optparse 和您的规范的区别在于，现在您可以使用如下命令行：

```
python script.py --debug --xls 001 
```

您可以通过调用 parser.add_option() 轻松添加新选项

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-20T00:51:36.873

看看[optparse](http://docs.python.org/library/optparse.html)模块。自己处理 sys.argv 对于非常简单的东西来说很好，但它很快就会失控。

请注意，如果您可以稍微更改参数格式，您可能会发现 optparse 更易于使用；例如`debug`用`--debug`and`xls`替换`--xls`or `--output=xls`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T00:54:06.087

[optparse](http://docs.python.org/library/optparse.html)是解析命令行的最佳朋友。还要查看[argparse](http://argparse.python-hosting.com/)；不过，它不在标准库中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T01:55:06.970

如果您想实现实际的命令行开关，请看一下[getopt](http://docs.python.org/library/getopt.html)。使用起来也非常简单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T05:02:44.397

Van Gale 在对论点使用正则表达式时在很大程度上是正确的。但是，在使用 optparse 时，并非绝对有必要将所有内容都设为选项，它将 sys.argv 拆分为选项和参数，具体取决于前面是否有“-”或“--”。一些示例代码仅通过参数：

```
import sys
import optparse

claParser = optparse.OptionParser()
claParser.add_option(
(opts, args) = claParser.parse_args()
if (len(args) >= 1):
  print "Arguments:"
  for arg in args:
    print "  " + arg
else:
  print "No arguments"
sys.exit(0) 
```

是的，args 数组的解析方式与 sys.argv 的解析方式非常相似，但添加了在需要时轻松添加选项的功能。有关 optparse 的更多信息，请查看 [相关的 Python 文档](http://docs.python.org/library/optparse.html)。

# lucene - 使用 Lucene 的提示/建议

> ID：567882
> 
> 赞同：4
> 
> 时间：2009-02-20T00:45:53.937
> 
> 标签：lucene, lucene.net

我正在使用 asp.net 3.5 开发工作门户 我使用 Lucene 实现工作和简历搜索功能。想知道关于 Lucene 性能优化、可扩展性等方面的提示/建议。

万分感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-21T10:43:53.620

您应该记住的一件事是，在大型安装中集群或复制 lucene 索引非常困难，例如故障转移场景或分布式系统。因此，您应该有一种复制索引作业或整个数据库的好方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:04:49.617

如果您使用排序，请注意比较器的大小。当使用排序时，对于搜索器返回的每个文档，都会为 Sort 对象中的每个 SortField 存储一个比较器对象。根据文档的大小和要排序的字段数量，这可能会让人头疼。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T12:17:52.963

我在这里记录了我如何使用 Lucene.NET（在 BugTracker.NET 中）：

[http://www.ifdefined.com/blog/post/2009/02/Full-Text-Search-in-ASPNET-using-LuceneNET.aspx](http://www.ifdefined.com/blog/post/2009/02/Full-Text-Search-in-ASPNET-using-LuceneNET.aspx)

# c# - 如何创建一个可以使用 GUI *或 * 作为 C# 中的 Windows 服务运行的 Windows 应用程序？

> ID：567890
> 
> 赞同：1
> 
> 时间：2009-02-20T00:49:04.647
> 
> 标签：c#, windows-services

我想使用 C# 创建一个应用程序...：

*   可以作为 Windows 应用程序运行，带有 GUI（它将指示进度、状态等）

    或者

*   可以作为 Windows 服务运行，无需 GUI

可能吗？有人可以让我开始吗？

我想另一种选择是我可以创建一个 Windows 服务，然后创建一个单独的 GUI 应用程序，该应用程序可以轮询 Windows 服务以从中获取数据（进度、状态等）。

在那种情况下...如何从我的 GUI 应用程序中从 Windows 服务中获取数据？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-20T01:00:40.987

我正在做与您要求的类似的事情。我已经对其进行了编程，因此如果您将命令行参数“/form”发送到可执行文件，它将弹出一个 Windows 窗体，而不是作为服务运行。

至于运行后台作业本身，在这两种情况下，您都需要执行某种线程（可能使用计时器）来完成工作并将状态异步报告回您的表单。这将是一个关于创建线程 GUI 应用程序的完全不同的讨论主题。

“表单或服务”代码如下所示：

```
static class Program
{
    /// <summary>
    /// The main entry point for the application.
    /// </summary>
    private static void Main(string[] args)
    {
        if (args.Length > 0 && args[0] == "/form")
        {
            var form = new MainForm();
            Application.Run(form);
            return;
        }

        var ServicesToRun = new ServiceBase[]
            {
                new BackgroundService()
            };

        ServiceBase.Run(ServicesToRun);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T02:27:34.693

我从来没有做过可以作为 Windows 服务或 GUI 运行的应用程序，但是我们有很多应用程序，您可以使用编译器标志在控制台应用程序和 Windows 服务之间切换。（我刚刚看到了 cmd 行 arg 的答案——这可能会更好！）

然后我们通常只使用编译器标志在两者之间切换。这是一个例子......我没有完全考虑到这一点，但它可能会给你一个开始：

```
#define RUN_AS_SERVICE

using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using System.ServiceProcess;

namespace WindowsFormsApplication1
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
#if RUN_AS_SERVICE

            System.ServiceProcess.ServiceBase[] ServicesToRun;
            ServicesToRun = new System.ServiceProcess.ServiceBase[]
            {
                new MyService()
            };
            System.ServiceProcess.ServiceBase.Run(ServicesToRun);
#else
            // Run as GUI
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
#endif
        }
    }
    public class MyService : ServiceBase
    {
        protected override void OnStart(string[] args)
        {
            // Start your service
        }

        protected override void OnStop()
        {
            // Stop your service
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T02:36:20.380

在库中构建实际应用程序。然后，您可以添加任何您想要的 UI（我松散地说，因为服务并不是真正的 UI）。只要您将应用程序视为 Windows 应用程序和服务应用程序，您就是在开发两个应用程序。如果您将应用程序视为它解决的业务问题，那么您会想到 Windows 窗体 UI 和服务 UI，这更符合您的需求。

虽然这听起来很合理，但您会惊讶于有多少应用程序需要完全覆盖才能成为不同的 UI 类型。感谢你的提问。它让我相信我正在写的这本书是有必要的。:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T01:00:58.723

您应该选择后一种选择。创建您的服务，然后创建一个单独的 GUI 应用程序。框架中已经为您提供了执行所有这些操作的大部分管道。看看 ServiceController 类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T02:31:03.263

我看到了这个帖子，它可能会为您提供更多信息

[如何编写我也可以作为 winforms 程序运行的 c# 服务？](https://stackoverflow.com/questions/421516/how-to-write-c-service-that-i-can-also-run-as-a-winforms-program)

# .net - 使用 Linqdatasource 和 groupby 属性

> ID：567895
> 
> 赞同：3
> 
> 时间：2009-02-20T00:50:30.120
> 
> 标签：.net, linq, linqdatasource, group-by

我有一个 Linqdatasource，它将表中的记录分组：按名为 SubmitTo 的字段路由。我的选择语句是这样的——“new（key as SubmitTo, Count() as Count, it as Routings）”。现在 SubmitTo 字段只是一个外键引用 table:Department 中的主键，它有一个字段:DeptName 与部门的全名。将 linqdatasource 绑定到 gridview 后，如何引用该字段：DeptName？我尝试了“Department.DeptName”，但它不起作用。我尝试在不使用 groupby 的情况下限制 linqdatasource，并且参考“Department.DeptName”有效。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-02-03T13:53:19.110

你能用这个吗？

`new (key as SubmitTo, key.DeptName as DeptName, Count() as Count, it as Routings)`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T12:43:18.070

我能想到的最简单的答案是加入表格，然后分组`Department.DeptName`而不是`SubmitTo`字段。我不知道是否有更简单的方法。

# windows - windows帮助：应用程序无法正确初始化（0x80000003）

> ID：567897
> 
> 赞同：1
> 
> 时间：2009-02-20T00:51:01.227
> 
> 标签：windows

我正在尝试构建一个包含 Lua 组件以及与 Lua 共享库的链接的 Windows 服务。我正在使用 MinGW 在 Eclipse/CDT 中构建代码。它构建得很好，但是当我运行它时，我得到“ `Application failed to Initialize Properly (0x80000003). Click OK to terminate`”。

我正在寻找可能发生的事情的线索。一个 Hello World 程序编译并运行良好，所以没有基本的环境问题（我希望！）。顺便说一句，我在 XP Home 上运行。

更新：

好的，通过一些猜测，我已经弄清楚发生了什么，并认为我会发布这个以帮助可能遇到类似问题的其他人 - 我认为我在运行时链接到的 lua DLL 是与我构建的版本不同的版本。我猜这导致应用程序初始化失败。当我让它们成为同一个文件时，事情就开始起作用了。我还没有研究为什么这会导致应用程序初始化失败，但我猜某些符号位于不同的地址或其他什么地方？或者可能是 DLL 是用不同的工具链构建的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T00:56:26.893

这可能是由于没有访问应用程序所需的 DLL 的权限造成的。您是作为管理员还是管理员组成员登录？

尝试以管理员身份登录以查看问题是否消失。这将有助于确定这是否是权限问题，然后您可以进一步探索。

您也可以尝试使用[Dependency Walker](http://www.dependencywalker.com) (depends.exe) 来查看这是否突出了任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-22T07:27:28.207

此问题的原因是尝试在 Windows XP 中运行 DOS 程序或 16 位程序 要在 Windows XP 中运行 DOS 程序或 16 位环境 要这样做，请转到 Start ， Run 并键入 gpedit.msc 然后转到：用户配置管理模板开始​​菜单和任务栏并双击添加“在单独的内存空间中运行”复选框到运行对话框选择启用然后确定。如果问题没有解决，我们将不得不禁用 Dr Watson，执行以下操作：转到 Start Programs Accessories System Tools System Information 然后转到 Tools Dr Watson 或转到 Start ，运行并键入 drwtsn32 并禁用：Dump所有线程上下文并创建故障转储文件并按：确定

然后重启你的电脑.......然后你就可以在Windows xp中运行任何运行Dos或16位的游戏或程序了。

# c# - 如何获取主机的主 IP 地址？

> ID：567905
> 
> 赞同：3
> 
> 时间：2009-02-20T00:52:56.247
> 
> 标签：c#, networking

调用以下命令会返回所有 IP 地址的列表。

```
Dns.GetHostAddresses(Dns.GetHostName()) 
```

有时，根据机器配置，这可能会给您返回多个 IP。所以问题是，如何确定哪个是主 IP 地址？你列举了网卡吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-20T00:53:58.490

没有“主要”IP 地址之类的东西。

路由表根据目标 IP 地址（以及扩展的网络接口，它本身可以是虚拟的或物理的）确定使用哪个向外的 IP 地址。

如果要查看路由表，请使用[IP Helper API](http://msdn.microsoft.com/en-us/library/aa366073(VS.85).aspx)。

# c# - 为什么 C# ProcessStartInfoRedirectStandardOutput 会导致 xcopy 进程失败

> ID：567912
> 
> 赞同：8
> 
> 时间：2009-02-20T00:56:16.830
> 
> 标签：c#, .net, ruby, batch-file

这有点痛苦，因为我现在没有代码在我面前，但我会尝试解释。

我有一个简单的 C# 应用程序，它启动了一个 Ruby 脚本（它做了一些其他的事情，所以它会生成一个批处理文件并执行它）。

我正在使用 C# 进程对象，并设置了以下 redirectstandardoutput = true redirectstandarderror = true UseShellExecute = false CreateNoWindow = true （那里有可爱的向后逻辑！）

然后，我为错误和输出流创建两个线程并轮询 ReadLine()，等待它们都完成，然后再调用 WaitForExit()。

现在，无论我做什么，当我重定向输出时，我的 Ruby 脚本都无法调用 system("xcopy...") 命令（没有生成错误，只是不会复制）。它也不会复制我要求它复制的其他文件。

如果我将两个流都指向一个线程，其中一个，只重定向其中一个并调用 ReadToEnd()，就会发生这种情况。

仅当我将 redirectstandardoutput 和 redirectstandarderror 设置为 false 时，它​​才能正常工作。

我在这里完全不知所措。我想也许输出流被填满了，但我无法想象为什么我要调用 ReadLine （我需要读取行，所以我可以解析每一行并且只将相关的行呈现给最终用户）。我还认为从线程 C# 进程调用 dos 命令可能会导致问题。

有谁知道这里可能发生了什么？我应该说我在 VS .net 2005 上，我认为它是 .Net Framework 2.0。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T04:57:48.950

[MSDN 论坛上](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/ab3c0cc7-83c2-4a86-9188-40588b7d1a52/)有一个晦涩的帖子似乎表明 XCOPY 本身可能存在故障——如果您重定向 XCOPY 的 STDOUT，您还必须重定向 STDIN。

（*注意：我将其标记为社区 wiki，因此了解 ruby​​ 的人可以编写一些示例代码来为 system() 重定向 STDIN*）

# c - 查询完整的 DNS 记录

> ID：567920
> 
> 赞同：2
> 
> 时间：2009-02-20T01:00:44.213
> 
> 标签：c, linux, sockets, dns

我使用 C gcc 在 *nix 中进行了很多编程。我知道如何做一个基本的 gethostbyname()。但是，如果我想删除整个 DNS 记录怎么办。更重要的是，我是否缺少允许您指定要提取的特定记录的功能？还是我需要通过 UDP 套接字手动执行此操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T01:08:58.767

不，在标准 C 或 POSIX 中没有这样的函数（甚至 gethostbyname 函数，与您可能认为的相反，它不是用于查询 DNS 的函数 - 它可以使用任何其他方式来获取地址，例如 /etc/hosts或 mDNS，无论如何）。

您可能想查看一些特定于 DNS 的库，例如[ldns](http://nlnetlabs.nl/projects/ldns/doc/tutorial1_mx.html)、libbind 或 libdjbdns。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-15T11:38:10.243

另请参阅[执行直接 DNS 查找的代码](https://stackoverflow.com/questions/907528/code-to-do-a-direct-dns-lookup)。

# c# - 如何让两个线程将特定时间戳插入表中？

> ID：567924
> 
> 赞同：0
> 
> 时间：2009-02-20T01:03:00.323
> 
> 标签：c#, database, multithreading, concurrency

我创建了两个（或更多）线程来将数据插入数据库的表中。插入时，有一个字段`CreatedDateTime`，当然，它存储记录创建的日期时间。

对于一种情况，我希望线程保持同步，以便它们的`CreatedDateTime`字段具有完全相同的值。使用多线程进行测试时，通常我有不同的毫秒数......

我想在我的系统中测试不同的场景，例如：

*   1) 恰好同时插入记录冲突。
*   2) 记录排序/选择问题。
*   3) 数据库连接池的问题。
*   4）多个用户（数百）同时访问的问题。

可能还有其他我没有在这里列出的测试用例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T01:16:40.400

是的，就是这样。即使出于某种自然原因，您的线程将在完全相同的时间启动，它们很快就会因为它们之间的资源争用而失步（至少，访问数据库表或 DBMS 服务器进程）。

如果它们大部分时间保持一致（即，从不超过几毫秒），只需为 CreatedDateTime 字段选择不同的“分辨率”。将其放入最接近的 10^秒（或秒）而不是毫秒。或者以其他方式使用固定值。

否则，请意识到这是完全正常的行为。

而且，正如 BC 在评论中指出的那样，您可能会误解“同步”一词的使用。它用于（在 Java 中，我希望 C# 类似）以确保两个线程不会同时访问相同的资源。实际上，它几乎可以保证线程不会在您理解该术语的含义时保持同步（我个人认为您的定义就英语用法而言是正确的（同时发生的事情），但是某些计算机语言已经取代了定义自己的目的）。

如果您正在测试特定时间戳进入数据库时​​会发生什么，则不能依靠按特定顺序和特定时间安排的线程“表现自己”。您确实需要以某种方式虚拟化数据，否则就像试图将果冻钉在树上（或训练猫）。

一种解决方案是不使用诸如`getCurrentTime()`或`now()`但使用一组具有已知时间戳的特定插入。根据您的实际架构，这可能会很困难（例如，如果您只是调用一个 API，它本身会获取当前时间戳到毫秒分辨率）。

如果您控制填充时间戳列的实际 SQL，则需要将其更改为使用预先计算的值，而不是`now()`其等价物。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T01:29:43.990

如果您想在插入的多行上具有相同的时间戳；您应该创建一个 SQL 线程，该线程将在一个查询中执行多行插入，这将允许您获得相同的时间戳。除此之外，我同意其他所有人的观点，除非您要插入在应用程序中看到的时间戳并共享要插入的时间戳，否则您无法通过多线程获得高分辨率的精确时间戳。当然，这将线程的警告问题抛到了窗外。这就像说，我要共享这些数据，但我不想使用互斥锁，因为一旦它遇到 lock()，它们就会阻止另一个线程处理。

# windows - 使用 WiX 生成和安装 Typelib

> ID：567925
> 
> 赞同：25
> 
> 时间：2009-02-20T01:03:50.650
> 
> 标签：windows, wix, windows-installer, typelib

在[询问了 Visual Studio 为注册 COM 库做了什么](https://stackoverflow.com/questions/543995/replicating-visual-studio-com-registration-with-a-wix-installer)之后，很明显 VS 为 COM 注册做了两件事：

1.  注册 COM 库
2.  创建并注册类型库

Visual Studio 似乎使用 regasm.exe 进行此注册。对于第一部分（直接 COM 注册），使用`tallow`or `heat`（WiX 2.0 或 WiX 3.0）似乎可以正确获取所有基本 COM 注册信息。

但是，tallow/heat 似乎没有做的是设置类型库安装。可以使用 WiX 安装程序和 regasm.exe 创建自定义操作来执行此操作，但对于基于 Microsoft 安装程序的安装程序，调用自定义操作并不是最佳实践。

经过进一步研究，看起来 msi 具有在安装时生成类型库的能力。事实上，WiX 似乎对它有直接的支持！在文件元素中，您可以添加[Typelib](http://wix.sourceforge.net/manual-wix3/wix_xsd_typelib.htm)元素。事实上，[这里关于 wix 的一篇文章有​​一个使用](http://chenhaoyork.spaces.live.com/blog/cns!C0B4F9D80B744CD!135.entry)[Interface](http://wix.sourceforge.net/manual-wix3/wix_xsd_interface.htm)元素填充 TypeLib 元素的示例。

Interface 元素似乎至少有两个必需的属性：

1.  ID
2.  姓名

[Larry Osterman 谈到了需要为 TypeLib 注册的接口的其他部分，](http://blogs.msdn.com/larryosterman/archive/2006/01/09/510856.aspx)这个接口条目似乎照顾了各个部分。Larry 说我们需要将 ProxyStubClassId32 指定为“{00020424-0000-0000-C000-000000000046}”，因此我们可以轻松添加它。

从那里去哪里以及为各种界面元素填写什么让我很难过。我已经继续并将 TypeLib 元素添加到我的 wix 文件中，并且它成功编译。不过，我对如何设置界面元素有点无能为力。我们需要做什么才能正确填写 TypeLib 元素，我可以使用哪些应用程序或工具来获取它？

wcoenen 下面的答案看起来很有希望......我要试一试。

更新：在下面发布我的最终解决方案作为答案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-06T01:32:22.667

这是懒人解决这个问题的方法：`heat`从 WiX 3.0 开始使用。

如果您有一个自动生成并通过 regasm 安装的类型库，`heat`可以将 .tlb 作为参数

```
heat file c:\my\path\to\my.tlb -out tlb.wxs 
```

它将生成您需要注册的所有类型库和接口元素。这不会解决需要提前知道它们的问题，也不会解决在程序集版本更改时 GUID 更改的问题（即使界面没有 - 这是您唯一的一次）重新应该改变它）但它会让你中途到达那里。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T10:42:10.420

以下技巧可以帮助收集任何注册表更改并将它们转换为 wxs 文件，包括您所追求的 typelib 元素。

1.  首先，将您的注册表恢复到未注册类型库的状态：

    ```
    c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\regasm.exe /tlb /u mylib.dll 
    ```

2.  将注册表的这种干净状态导出到 hklm-before.reg：

    ```
    c:\WINDOWS\system32\reg.exe export HKLM hklm-before.reg 
    ```

3.  再次注册类型库：

    ```
    c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\regasm.exe /tlb mylib.dll 
    ```

4.  将注册表的新状态导出到 hklm-after.reg：

    ```
    c:\WINDOWS\system32\reg.exe export HKLM hklm-after.reg 
    ```

5.  现在我们有两个文本文件，hklm-before.reg 和 hklm-after.reg。**创建一个 diff.reg 文件**，该文件仅包含这些之间的相关差异。您可以使用差异工具轻松找到差异。我喜欢使用 TortoiseSVN 中包含的差异工具，因为我已经每天都在使用它。（由于文本编码问题，WinDiff 在这种情况下似乎无法正常工作。）

6.  我们现在可以通过调用命令将 diff.reg 转换为`heat.exe`.wxs `reg`。（需要 wix 3.5 或更高版本。）

    ```
    heat reg diff.reg -out typelib.wxs 
    ```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T21:28:13.950

它看起来像注册一个类型库，*最好*的方法是生成您自己的 IDL 或 ODL 文件，其中将包含您的 GUID。直接从程序集生成的类型库 [i] 依赖于[/i] 程序集版本号：GUID 是基于该信息生成的，即使接口没有更改。Visual Studio 使用 regasm 注册和生成类型库。在此之下，它使用了一个 Win32 调用 RegisterTypeLib。使用 typelib 元素似乎做了类似的事情。不好。

然而！手动创建类型库很痛苦。可以通过另一种方式获得这些 GUID：将它们从类型库中挖掘出来并自己创建元素。

Larry Osterman 拥有所需的信息：需要设置某些注册表项。您可以使用 Registry 表执行这些操作（在 Wix3 中，这意味着 RegistryValue 元素。）这里的技巧是获取 GUID：任何旧的 GUID 都不起作用。通常，获取 GUID 只需查看库的 IDL（您编写了自己的 IDL，对吗？:)）。

如果您没有编写 IDL 或 ODL 文件来编译到类型库中，它们仍然存在于文件中。Microsoft 提供了几个方便的工具：[LoadTypeLibEx](https://stackoverflow.com/questions/567925/typelib-generation-and-installation-with-wix)和 ITypeLib 接口。通过这些接口，您可以浏览类型库并获取各种信息。我们如何浏览图书馆？

我只是看看 Regasm 是如何做到的！稍后快速反汇编，我们发现 regasm 也是用 C# 编写的。荣耀日。我启动了一个项目，稍后使用一些 using 语句和一个 PInvoke，我们有：

```
using System.Runtime.InteropServices;          // for struct marshaling 
using System.Runtime.InteropServices.ComTypes; // for the ITypeLib + related types

// TYPELIBATTR lives in two places: Interop and ComTypes, but the one
// in Interop is deprecated.
using TYPELIBATTR = System.Runtime.InteropServices.ComTypes.TYPELIBATTR; 

/// <summary>
/// The registry kind enumeration for LoadTypeLibEx.  This must be made
/// here, since it doesn't exist anywhere else in C# afaik.  This is found
/// here: http://msdn.microsoft.com/en-us/library/ms221159.aspx
/// </summary>
enum REGKIND
{
    REGKIND_DEFAULT,
    REGKIND_REGISTER,
    REGKIND_NONE
}

// and this is how we get the library.
[DllImport("oleaut32.dll", CharSet = CharSet.Unicode, PreserveSig = false)]
  private static extern void LoadTypeLibEx(string strTypeLibName, REGKIND regKind, out ITypeLib TypeLib); 
```

哇！一旦我们有了这个，我们必须导航结构。这是与非托管资源的交互，所以准备好`Marshal`周围的东西。

```
ITypeLib lib = null;
LoadTypeLibEx(Value, REGKIND.REGKIND_NONE, out lib);
IntPtr libInfoPtr = IntPtr.Zero;
lib.GetLibAttr(out libInfoPtr);
TYPELIBATTR libInfo = 
    (TYPELIBATTR) Marshal.PtrToStructure(libInfoPtr, typeof(TYPELIBATTR));
int typeCount = lib.GetTypeInfoCount();
for (int i = 0; i < typeCount; ++i)
{
    ITypeInfo info;
    lib.GetTypeInfo(i, out info);
    IntPtr typeDescrPtr = IntPtr.Zero;
    info.GetTypeAttr(out typeDescrPtr);
    TYPELIBATTR type =
        (TYPELIBATTR)Marshal.PtrToStructure(typeDescrPtr, typeof(TYPELIBATTR));
    // get GUID, other info from the specific type
}

lib.ReleaseTLibAttr(libInfoPtr);
libInfoPtr = IntPtr.Zero; 
```

唷。因此，您必须编写一些代码来提取信息。完成后，您必须[按照 Larry Osterman](http://blogs.msdn.com/larryosterman/archive/2006/01/09/510856.aspx)的规定将该信息填写到 Registy Entries 中。

当然，您可以通过简单地编写自己的 IDL 文件来避免该步骤。痛苦中的选择：由你决定！

# c# - 方法的优先顺序？

> ID：567927
> 
> 赞同：3
> 
> 时间：2009-02-20T01:06:25.230
> 
> 标签：c#, listbox, operator-precedence, method-call

说我有两种方法。一种是由列表框中所选索引更改触发的方法。第二种方法有助于清除所有文本框、将列表框索引设置为 -1 并设置焦点。

问题：

方法二执行时，在代码中将列表框的选定索引更改为-1，从而触发第一种方法的事件触发器。方法 2 是否暂停它自己的执行并将进程转移到事件，然后在方法 1 完成后返回到它的工作......或者方法 2 是否完成其整个代码块然后转移到方法 1，因为所选索引发生了变化？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-20T01:53:12.467

第一种情况。

让我们暂时搁置线程，特别是因为它们不涉及您的场景。

你在谈论属性和方法，但在这一切之下，它都只是函数。当一个函数调用另一个函数时，程序中的控制权转移到被调用函数。当该函数完成运行时，控制*返回*到调用它的位置。无论函数调用更多函数的深度如何，您的程序都会自动记住它需要返回的位置。`*`

当您的第二个函数设置索引时，真正发生的是编译器将属性设置操作转换为函数调用。（属性最终只是函数的“语法糖”。）该函数调用了一堆对场景不重要的其他函数，除了其中一个是调用“索引更改”事件处理程序的函数。它看到您有一个与该事件关联的方法，并调用您的第一个方法。

您的第一个方法运行，当它完成时，它返回到“调用索引更改事件处理程序”函数。最终，该函数和所有其他不重要的函数完成运行（可能在按顺序进行更多函数调用之后），并且“设置索引属性”函数将控制权返回给您的第二个方法。

您可以向自己证明您的第一个建议是它的工作原理。在您的第一个方法中显示一个消息框，并在您设置 index 属性的第二种方法中的点*之后显示另一个消息框。*（使用不同的消息！）您应该看到第一条消息出现，在您关闭消息框后，您应该看到第二条消息出现，从而表明第二个方法在第一个方法运行时没有继续执行。

`*`有一个限制，但除非您的程序中存在错误，否则它很少会被击中*。*当你有太多的嵌套函数调用时，会发生*堆栈溢出*。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T01:16:28.250

您可以探索第三种选择：它们也可以同时*运行*！如果我正确理解您的问题，方法 2 将由索引更改事件触发。在 C# Windows 窗体应用程序中，此其他事件将在单独的执行线程中发生。

探索的概念：线程。

我希望这能为您探索知识提供一个起点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T02:47:10.653

假设没有多线程情况，事件将在方法执行结束之前触发。如果您想看到这一点，请使用 .NET 语言对您建议的内容进行编码并检查生成的 Il。您可以使用 ILDASM 或 Reflector 完成此操作，甚至可以创建自己的 relfletion 应用程序。您确实必须足够了解 IL 的语法才能看到分支，但这并不难，只要您了解编程概念即可。

Rob 已将其标记为“语法糖”，我对此表示同意。这确实是一个编译器技巧，但我想它属于常用的“语法糖”标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T01:15:55.737

我假设有问题的语言是 c#，因此你有一种支持多线程的语言。如果您不想担心线程（如果考虑到用户体验，这将是一个坏主意），您可以在一个线程中运行您的 GUI 并具有相同的行为，除非组件创建自己的线程（这会有点虽然很奇怪）。如果要实现事件的异步（并行）执行，则需要让事件在其自己的线程中触发。

回答您的问题：如果您不使用多个线程，则事件触发的方法将排队。当您在某些程序中看到 GUI 响应缓慢时，就会发生这种情况。

希望它能解决问题并欢迎另一个新人:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T01:43:16.967

我自己是初学者，也许我可以提供帮助。Method2会开火，然后选择选择时，方法1会做他的事情，然后Method2将继续。

如果您当时不希望 Method1 触发，您可能想要执行以下操作：（真正的伪代码）

```
Method2(object sender, System.EventArgs e)
{
  //Unsubscribe Method1 from ListboxEvent
  Listbox.OnSelectionChange -= Method1;

  ... Stuff Method2 actually does ...

  Manualy call Method1 if you want it to fire

  //Subscribe Method1 from ListboxEvent
  Listbox.OnSelectionChange += Method1;
} 
```

它可能不是最佳的（也许是一些最佳实践......）但由于缺乏更好的解释，至少您有一些信息可以帮助您搜索。希望能帮助到你！

# compact-framework - WinCE CF 2.0 的 .cab 创建者

> ID：567929
> 
> 赞同：1
> 
> 时间：2009-02-20T01:06:42.890
> 
> 标签：compact-framework, cab

所以我在 Visual Studio 中创建了一个 cab 文件，一切都很好。我正在使用带有 WinCE 4.0 的 HP 瘦客户端

但有一件事，我的设备上有一个名为 Program Files 的文件夹，硬盘上有一个名为 Program Files 的文件夹。

现在，每次重新启动机器时，我的设备内存都会自行重置。不幸的是，VS 2008 不允许我更改 cab 安装程序的路径。

关于如何改变路径的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:20:48.867

我已经想通了：任何时候您希望在不同的路径中安装应用程序时，请使用自定义文件夹，而不是 Programs 或 Program Files。

看起来 InstallDir 不能在没有黑客的情况下进行修改。我在 Cab 项目中使用了自定义文件夹并指定了我希望安装此应用程序的路径；有效。

# asp.net - 使用 asp.net CreateUserWizard 时用户何时进行身份验证

> ID：567932
> 
> 赞同：0
> 
> 时间：2009-02-20T01:06:57.350
> 
> 标签：asp.net, forms-authentication, createuserwizard

我正在使用 asp.net CreateUserWizard，并且我有 LoginCreatedUser=true。我还有一个方法的 CreateUserWizard 控件的“OnCreatedUser”属性，并认为此时会创建身份验证票，但事实并非如此。

**身份验证票证 (Request.Cookies[".ASPXAUTH"]) 究竟何时填充？**

我需要知道，以便在注册期间我可以修改 UserData 并将其添加到身份验证票中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:24:00.060

在执行以下操作之前，我已经这样做了：

1.  在 CreateUserWizard_CreatedUser 事件中，您知道用户已创建，因此将用户名保存到 HttpContext.Items 数组。
2.  在页面的 PreRender() 事件中检查 HttpContext.Items 中的用户名（它将在 CreatedUser() 步骤之后运行）。如果它在那里覆盖您的身份验证票

要对此进行测试，请确保您稍后解密身份验证票并检查 UserData。在我自己的项目中，这就是我处理用户在注册时登录并将他们的一些信息注入身份验证票的 UserData 的方式。

# visual-studio - Visual Studio 2008 不必要的项目构建

> ID：567939
> 
> 赞同：29
> 
> 时间：2009-02-20T01:10:01.463
> 
> 标签：visual-studio, build

我有一个 C# 项目，其中包括一个 exe 和 11 个库文件。exe引用所有库，lib1可能引用lib2、lib3、lib4等。

如果我对 lib1 中的一个类进行更改并构建解决方案，我假设只有 lib1 和 exe 需要更改。但是，如果我想运行解决方案，所有的 dll 和 exe 都在构建中。

如果依赖项没有被更改，有没有办法阻止它们被构建？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-22T00:34:22.957

关键是这句话吗？*“但是，如果我想运行解决方案*，所有 dll 和 exe 都在构建中”

*当您运行*单个项目时， Visual Studio 将始终尝试构建所有内容，即使该项目不依赖于所有内容。但是，可以更改此选择。转到工具|选项|项目和解决方案|构建和运行并选中“仅在运行时构建启动项目和依赖项”框。然后当你按下 F5 时，VS 只会构建你的启动项目和它所依赖的 DLL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-04-16T07:53:48.017

我只是用我的 VS 项目“修复”了同样的问题。Visual Studio 总是进行重建，即使没有改变任何东西。我的解决方案：一个 cs 文件有一个未来的时间戳（2015 年，这是我的错）。我打开文件，保存它，我的问题解决了！！！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T01:13:57.943

您可以取消选中[解决方案配置](http://msdn.microsoft.com/en-us/library/bb166577.aspx)中指定项目的构建选项：

[![解决方案属性](https://i.stack.imgur.com/8UxCy.gif)](https://i.stack.imgur.com/8UxCy.gif)
[（来源：[microsoft.com](http://i.msdn.microsoft.com/Bb166577.vsSolutionCfg(en-us,VS.90).gif)）]

您可以创建自己的解决方案配置来构建特定的项目配置...

[![构建配置](https://i.stack.imgur.com/zozwi.gif)](https://i.stack.imgur.com/zozwi.gif)
[（来源：[microsoft.com](http://i.msdn.microsoft.com/Bb166577.vsConfigManager(en-us,VS.90).gif)）]

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T01:23:35.080

我不确定是否有办法避免构建依赖项。您可以在此处找到一些信息，例如将 copylocal 设置为 false 并将 dll 放在公共目录中。

[优化 Visual Studio 解决方案构建 - 将 DLL 文件放在哪里？](https://stackoverflow.com/questions/488043/optimizing-visual-studio-solution-build-where-to-put-dll-files)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-22T00:42:16.433

我们实际上在我当前的项目中遇到了这个问题，在我们的场景中，甚至运行单元测试（没有任何代码更改）都会导致重新编译。检查您的构建配置的“平台”。

如果您使用的是“任何 CPU”，那么由于某种原因，它会重建所有项目，而不管更改如何。尝试使用特定于处理器的构建，即 x86 或 x64（使用特定于您机器的机器架构的平台）。为我们工作的 x86 版本。

[![替代文字](https://i.stack.imgur.com/14DXg.png)](https://i.stack.imgur.com/14DXg.png)
[（来源：[episerver.com](http://labs.episerver.com/Global/xmlrpc/111856/2008/06/24/image_26.png)）]

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-22T00:43:10.860

我们在工作中遇到了类似的问题。在构建后事件中，我们手动将清单嵌入到 bin 目录的输出中。Visual Studio 正在从 obj 目录（未修改）复制项目引用。时间戳差异触发了不必要的重建。

如果您的构建后事件修改了项目输出，则要么修改 bin 和 obj 目录中的输出，要么将 bin 目录中的修改后的输出复制到 obj 目录中的输出之上。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T00:22:33.920

现在，在我这么说之后，一些螺旋桨头会出现并反驳我，但是没有办法从 Visual Studio 中做你想做的事情。在 VS 之外有一种方法可以做到这一点，但首先，我有一个问题：

你到底为什么要这样做？也许您正试图节省 CPU 周期或节省编译时间，但如果您按照您的建议行事，您会突然发现自己处于一个绝妙的位置，可以一枪打死自己。如果您有一个依赖于库 2 的库 1，并且只有库 2 发生了更改，您可能认为只构建更改后的库是可以的，但是其中一天您将对库 2 进行更改，这将破坏库 1，如果没有库 2 的构建，您将无法在编译中捕获它。所以以我的拙见，不要这样做。

这在 VS2005 和 2008 中不起作用的原因是因为 VS 使用 MSBuild。MSBuild 针对项目文件运行，它将检查项目的引用并首先构建所有引用的项目（如果它们的源已更改），然后再构建目标项目。您可以通过从命令行针对一个未更改但引用的项目已更改的项目运行 MSBuild 来自行测试。例子：

msbuild ClassLibrary4.csproj

其中 ClassLibrary4 没有更改，但它引用了已更改的 ClassLibrary5。MSBuild 将首先构建 lib 5，然后再构建 4，即使您没有提到 5。

绕过所有这些故障保护的唯一方法是直接使用编译器，而不是通过 MSBuild。丑陋，丑陋，但仅此而已。基本上，您将不得不以某种形式重新实现 MSBuild，以便做您想做的事情。

这不值得。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-28T18:45:23.837

查看[以下站点](http://petesbloggerama.blogspot.com/2007/12/visual-studio-difference-between-build.html)以获取有关何时构建项目以及构建和重建之间差异的更多详细信息。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-23T19:09:32.683

我也遇到了这个问题，并且在 Windows 7 x64、VS2008 SP1 上构建时注意到了这些警告消息：

cl : 命令行警告 D9038 : /ZI 在这个平台上不受支持；改为启用 /Zi

cl : 命令行警告 D9007 : '/Gm' 需要 '/Zi'; 选项被忽略

我将项目属性更改为：

C/C++ -> 常规 -> 调试信息格式 = /Zi

C/C++ -> 代码生成 -> 启用最小构建 = 否

重建后，我将它们都切换回来，并且依赖关系再次正常工作。但在此之前，再多的清理、重建或完全删除输出目录都无法修复它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T01:29:18.343

我不认为你可以在 VS 中开箱即用。您需要此加载项 [http://workspacewhiz.com/](http://workspacewhiz.com/)

它不是免费的，但您可以在购买前对其进行评估。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T02:42:01.040

是的，从解决方案中排除不变的位。我这样说是有一点需要注意的，因为您可以通过一种方式进行编译，其中更改的库的内部版本号的更改可能会导致非构建的部分中断。只要您不破坏接口，情况就不应该如此，但这很常见，因为大多数开发人员不了解 .NET 世界中的接口。它来自不必编写 IDL。:-)

至于解决方案中的 X 项目，不，您无法阻止它们构建，因为系统发现依赖项已更改。

顺便说一句，您应该查看您的项目并弄清楚为什么您的 UI 项目（假设它是 UI）引用与其他所有内容相同的库。一个好的依赖模型将显示应该分解为数据对象或域对象的类（我假设常见的依赖是某种数据对象或域对象，当然，但这很常见）。如果公共依赖不是域/数据对象，那么在大多数情况下我会重新考虑我的架构。通常，您应该能够创建从 UI 到数据的路径，而不需要非行为对象以外的常见依赖项。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-28T18:31:53.007

不确定处理这个问题的好方法，但在过去，如果我有一两个项目不断重建，并且假设我不会在其中工作，我会为他们关闭构建过程。

右键单击 sln，选择配置管理器并取消选中复选框。不完美，但在 Visual Studio 不正常时工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-06-14T17:51:52.757

如果您继续遇到此问题，可能是由于项目中列出但不存在的计算依赖项（如标题）丢失或过期。

在迁移到新版本后（例如：从 2012 年到 2013 年），这种情况在我身上尤其常见，因为 VS 可能在转换中重新计算了依赖项，或者您正在迁移到新位置。

快速检查是从解决方案资源管理器中双击违规项目中的每个文件。如果您发现文件不存在，那就是您的问题。

一个简单的丢失文件失败：您可能在源和目标之间有更复杂的构建日期关系。您可以使用实用程序找出触发构建的前端测试。要获取该信息，您可以启用详细 CPS 日志记录。请参阅：Andrew Arnott - 启用 C++ 和 Javascript 项目系统跟踪 ( [http://blogs.msdn.com/b/vsproject/archive/2009/07/21/enable-c-project-system-logging.aspx](http://blogs.msdn.com/b/vsproject/archive/2009/07/21/enable-c-project-system-logging.aspx) )。我使用 DebugView 选项。在您需要时提供宝贵的工具。

（这是一个 C# 特定的问题，但不同的帖子被合并为相同的）

# c# - 如何在 C# 中以编程方式搜索 PDF 文档

> ID：567951
> 
> 赞同：22
> 
> 时间：2009-02-20T01:20:14.823
> 
> 标签：c#, .net, search, pdf

我需要搜索 pdf 文件以查看是否存在某个字符串。有问题的字符串肯定被编码为文本（即它不是图像或任何东西）。我试过只搜索文件，就好像它是纯文本一样，但这不起作用。

是否有可能做到这一点？是否有任何用于 .net2.0 的库可以为我从 pdf 文件中提取/解码所有文本？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-20T01:26:46.150

那里有一些图书馆可用。查看[http://www.codeproject.com/KB/cs/PDFToText.aspx](http://www.codeproject.com/KB/cs/PDFToText.aspx) 和[http://itextsharp.sourceforge.net/](http://itextsharp.sourceforge.net/)

这需要一点努力，但这是可能的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-21T22:13:20.263

您可以使用[Docotic.Pdf 库](https://bitmiracle.com/pdf-library/)来搜索 PDF 文件中的文本。

这是一个示例代码：

```
static void searchForText(string path, string text)
{
    using (PdfDocument pdf = new PdfDocument(path))
    {
        for (int i = 0; i < pdf.Pages.Count; i++)
        {
            string pageText = pdf.Pages[i].GetText();
            int index = pageText.IndexOf(text, 0, StringComparison.CurrentCultureIgnoreCase);
            if (index != -1)
                Console.WriteLine("'{0}' found on page {1}", text, i);
        }
    }
} 
```

该库还可以从整个文档或任何文档页面中[提取格式化和纯文本。](https://bitmiracle.com/blog/extract-text-from-pdf-in-net)

免责声明：我为图书馆供应商 Bit Miracle 工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-29T11:30:32.327

在绝大多数情况下，无法通过在记事本中打开 PDF 来直接搜索其内容——即使在少数情况下（取决于 PDF 的构建方式），您也只能由于 PDF 内部处理文本的方式，搜索单个单词。

我的公司有一个商业解决方案，可以让您从 PDF 文件中提取文本。我在下面为您提供了一些示例代码，[如本页所示](http://help.quickpdflibrary.com/questions/381/find-a-specific-word-in-a-pdf-file)，它演示了如何在 PDF 文件中的文本中搜索特定字符串。

```
using System;
using System.IO;
using QuickPDFDLL0718;

namespace QPLConsoleApp
{
    public class QPL
    {
        public static void Main()
        {
            // This example uses the DLL edition of Quick PDF Library
            // Create an instance of the class and give it the path to the DLL
            PDFLibrary QP = new PDFLibrary("QuickPDFDLL0718.dll");

            // Check if the DLL was loaded successfully
            if (QP.LibraryLoaded())
            {
                // Insert license key here / Check the license key
                if (QP.UnlockKey("...") == 1)
                {
                    QP.LoadFromFile(@"C:\Program Files\Quick PDF Library\DLL\GettingStarted.pdf");

                    int iPageCount = QP.PageCount();
                    int PageNumber = 1;
                    int MatchesFound = 0;

                    while (PageNumber <= iPageCount)
                    {
                        QP.SelectPage(PageNumber);
                        string PageText = QP.GetPageText(3);

                        using (StreamWriter TempFile = new StreamWriter(QP.GetTempPath() + "temp" + PageNumber + ".txt"))
                        {
                            TempFile.Write(PageText);
                        }

                        string[] lines = File.ReadAllLines(QP.GetTempPath() + "temp" + PageNumber + ".txt");
                        string[][] grid = new string[lines.Length][];

                        for (int i = 0; i < lines.Length; i++)
                        {
                            grid[i] = lines[i].Split(',');
                        }

                        foreach (string[] line in grid)
                        {
                            string FindMatch = line[11];

                            // Update this string to the word that you're searching for.
                            // It can be one or more words (i.e. "sunday" or "last sunday".

                            if (FindMatch.Contains("characters"))
                            {
                                Console.WriteLine("Success! Word match found on page: " + PageNumber);
                                MatchesFound++;
                            }
                        }
                        PageNumber++;
                    }

                    if (MatchesFound == 0)
                    {
                        Console.WriteLine("Sorry! No matches found.");
                    }
                    else
                    {
                        Console.WriteLine();
                        Console.WriteLine("Total: " + MatchesFound + " matches found!");
                    }
                    Console.ReadLine();
                }
            }
        }
    }
} 
```

# c# - C# ISynchronizeInvoke 问题

> ID：567953
> 
> 赞同：2
> 
> 时间：2009-02-20T01:22:48.890
> 
> 标签：c#, timer, mcisendstring

冒着听起来像个菜鸟的风险，我如何在 System.Timers.Timer 上实现 ISynchronizeInvoke？

我有一个调用 mciSendString 的类（没有 UI）。我有一个应该轮询当前状态的计时器。课堂上的所有调用都有效，但不是来自 timers elapsed 事件的调用。我已经追踪到它在不同的线程上，但我没有比这更进一步。我想我需要在与该类相同的线程上调用一个委托，但我还没有任何运气来完成它。

代码示例：

```
 [DllImport("winmm.dll")]
    private static extern Int32 mciSendString(string command, StringBuilder buffer, Int32 bufferSize, IntPtr hwndCallback);

    public cPlayer()
    {
        tmrPoll = new System.Timers.Timer(1000);
        tmrPoll.Enabled = false;
        tmrPoll.Elapsed += new ElapsedEventHandler(tmrPoll_tick);
    }

    public void tmrPoll_tick(object source, ElapsedEventArgs e)
    {
        Poll();
    }

    private void Poll()
    {
        Console.WriteLine(System.Threading.Thread.CurrentThread.ManagedThreadId.ToString());
        tmrPoll.Stop();
        int res = 0;

        res = mciSendString("status MediaFile position", _sbBuffer, _sbBuffer.Capacity, IntPtr.Zero);
        if (res == 0) _position = int.Parse(_sbBuffer.ToString());
        if (res == 0)
        {
            Console.WriteLine("Position = " + _sbBuffer.ToString());
        } else {
            Console.WriteLine("Failed:  Error " + res.ToString());
        }

        res = mciSendString("status MediaFile length", _sbBuffer, _sbBuffer.Capacity, IntPtr.Zero);
        if (res == 0) Console.WriteLine("Length = " + _sbBuffer.ToString());
        if (res == 0) _length = int.Parse(_sbBuffer.ToString());

        res = mciSendString("status MediaFile mode", _sbBuffer, _sbBuffer.Capacity, IntPtr.Zero);
        if (res == 0) Console.WriteLine("Mode = " + _sbBuffer.ToString());
    }

    private void SendCommand(string cmd)
    {
        mciSendString(cmd, null, 0, IntPtr.Zero);
        Poll();

    } 
```

为了澄清起见，如果我从 SendCommand 调用（无论它是什么，播放、停止等），它会起作用，并且 Poll() 的结果是我所期望的。当计时器触发时，结果 (res) 是 263，即`MCIERR_INVALID_DEVICE_NAME`. 失败调用的 threadID 与成功调用的不同，这就是为什么我认为我需要使用 ISynchronizeInvoke。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T04:17:11.323

我在msdn论坛上得到了答案。有人给我留言，其中包含 codeplex ( [nito.async](http://www.codeplex.com/NitoAsync) ) 的链接。我使用 GenericSynchronizingObject 来完成工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T01:32:30.660

你得到的错误代码是什么？我想它的一部分与 hwndCallback 参数有关，但是没有看到任何代码示例，很难说。

但是，您不需要在这里实现 ISynchronizeInvoke。如果要为回调传递窗口句柄，则可能必须调用它。在这种情况下，您需要在实现 ISynchronizeInvoke 的托管表示上调用 Invoke 方法。换句话说，您从中获得句柄的控件/表单。

# c# - C# 原始套接字端口转发

> ID：567954
> 
> 赞同：4
> 
> 时间：2009-02-20T01:22:51.620
> 
> 标签：c#, networking, sockets, portforwarding

我正在尝试创建一个简单的 C# 应用程序来进行端口转发，并且需要知道如何使用 IP_HDRINCL 套接字选项来尝试伪造接收端以认为连接确实是到源的。任何示例将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-22T13:16:14.847

```
sock = new Socket( AddressFamily.InterNetwork, SocketType.Raw, ProtocolType.IP );
sock.Bind( new IPEndPoint( IPAddress.Parse( "10.25.2.148" ), 0 ) );
sock.SetSocketOption( SocketOptionLevel.IP, SocketOptionName.HeaderIncluded, 1 );   
byte[] trueBytes = new byte[] { 1, 0, 0, 0 };
byte[] outBytes = new byte[] { 0, 0, 0, 0 };
sock.IOControl( IOControlCode.ReceiveAll, trueBytes, outBytes );
sock.BeginReceive( data, 0, data.Length, SocketFlags.None, new AsyncCallback( OnReceive ), null ); 
```

唯一的问题是我已经能够成功地从这样的原始套接字接收数据（包括 IP 标头）但不能发送它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-09-17T18:47:29.077

由于恶意软件严重滥用原始套接字，较新版本的 Windows 限制了原始套接字的使用。

引用自[MSDN](http://msdn.microsoft.com/en-us/library/ms740548%28VS.85%29.aspx)

> 在 Windows 7、Windows Vista 和带有 Service Pack 2 (SP2) 的 Windows XP 上，通过原始套接字发送流量的能力受到以下几种方式的限制：
> 
> *   TCP 数据不能通过原始套接字发送。
> *   无法通过原始套接字发送具有无效源地址的 UDP 数据报。任何传出 UDP 数据报的 IP 源地址必须存在于网络接口上，否则数据报将被丢弃。进行此更改是为了限制恶意代码创建分布式拒绝服务攻击的能力，并限制发送欺骗数据包（具有伪造源 IP 地址的 TCP/IP 数据包）的能力。
> *   不允许使用 IPPROTO_TCP 协议的原始套接字调用绑定函数。 **注意** 对于其他协议（例如，IPPROTO_IP、IPPROTO_UDP 或 IPPROTO_SCTP）允许使用原始套接字的绑定函数。
> 
> 上述限制不适用于 Windows Server 2008 R2、Windows Server 2008、Windows Server 2003 或 Windows XP SP2 之前的操作系统版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T12:55:28.250

> IP_HDRINCL

.NET 的 Socket 类型确实支持 RAW，并且`SocketOptionName.HeaderIncluded`可以与`Socket.SetSocketOption`.

您可能希望使用 Reflector 仔细检查 .NET 实现与枚举值是否一致。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-17T18:40:45.113

我找到了这个网站，但不确定代码的效果如何：http: [//www.winsocketdotnetworkprogramming.com/clientserversocketnetworkcommunication8h.html](http://www.winsocketdotnetworkprogramming.com/clientserversocketnetworkcommunication8h.html)

# javascript - IE 6 和多个按钮元素都发送它们的名称和值

> ID：567958
> 
> 赞同：2
> 
> 时间：2009-02-20T01:25:01.833
> 
> 标签：javascript, php, internet-explorer, internet-explorer-6

在表单中使用多个按钮元素时，我意识到 IE7 发送的是 innerHTML 而不是按钮的值。我想一切都很好，我只需将我的 PHP 代码更改为此

```
<?php

if (isset($_POST['button-name'])) {
   add_product_to_cart(2);
}

?> 
```

现在，我的老朋友 IE6 在令人讨厌的方面又进了一步。无论我点击哪一个，它都会发送所有按钮元素。例如，我有 3 个名为“mint”、“near-mint”和“standard”的按钮元素。快速`print_r($_POST)`告诉我所有 3 个名称都已提交。

我猜想补救这将是一些 JavaScript，不是最优雅的情况，但我可以想象仍然使用 IE6 的普通用户还不够聪明，无法关闭他们的 JavaScript。

我该如何补救？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T01:56:23.503

我在[http://www.codecomments.com/JavaScript/message756646.html找到了解决方案](http://www.codecomments.com/JavaScript/message756646.html)

所有归功于该页面上的作者。

根据请求，这是代码

```
function buttonfix(){
var buttons = document.getElementsByTagName('button');
for (var i=0; i<buttons.length; i++) {
buttons[i].onclick = function () {
for(j=0; j<this.form.elements.length; j++)
if( this.form.elements[j].tagName == 'BUTTON' )
this.form.elements[j].disabled = true;
this.disabled=false;
}
}
}
window.attachEvent("onload", buttonfix); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-07T09:17:23.633

这是 Internet Explorer 中的一个已知错误。

[http://www.dev-archive.net/articles/forms/multiple-submit-buttons.html](http://www.dev-archive.net/articles/forms/multiple-submit-buttons.html)描述了一种不依赖于 JavaScript 的解决方法。

它归结为“使用`<input>`并且不要设计您的按钮以使其标签需要简单文本以外的任何内容”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-07T09:07:55.447

一个解决方案是在您的页面中使用`<input type="button">`and`<input type="submit">`而不是`<button type="button">`and `<button>`。

**更新：**如果您将`button`元素更改为`input`元素，您应该能够使用带有以下选择器的 jQuery 找到它们：

```
var buttons = $('input[type=submit], input[type=button]'); 
```

# c# - LINQ 表达式返回属性值？

> ID：567963
> 
> 赞同：23
> 
> 时间：2009-02-20T01:27:22.527
> 
> 标签：c#, linq, linq-to-sql, lambda, expression

我正在尝试创建一个通用函数来帮助我使用 LINQ to SQL 从本地列表中选择数千条记录。SQL Server（至少 2005 年）将查询限制为 2100 个参数，我想选择更多的记录。

这是一个很好的示例用法：

```
var some_product_numbers = new int[] { 1,2,3 ... 9999 };

Products.SelectByParameterList(some_product_numbers, p => p.ProductNumber); 
```

这是我的（非工作）实现：

```
public static IEnumerable<T> SelectByParameterList<T, PropertyType>(Table<T> items, 

IEnumerable<PropertyType> parameterList, Expression<Func<T, PropertyType>> property) where T : class
{
    var groups = parameterList
        .Select((Parameter, index) =>
            new
            {
                GroupID = index / 2000, //2000 parameters per request
                Parameter
            }
        )
        .GroupBy(x => x.GroupID)
        .AsEnumerable();

    var results = groups
    .Select(g => new { Group = g, Parameters = g.Select(x => x.Parameter) } )
    .SelectMany(g => 
        /* THIS PART FAILS MISERABLY */
        items.Where(item => g.Parameters.Contains(property.Compile()(item)))
    );

    return results;
} 
```

我见过很多使用表达式构建谓词的例子。在这种情况下，我只想执行委托以返回当前 ProductNumber 的值。或者更确切地说，我想把它翻译成 SQL 查询（它在非通用形式下工作得很好）。

我知道编译表达式只会让我回到第一方（将委托作为 Func 传递），但我不确定如何将参数传递给“未编译”表达式。

谢谢你的帮助！

**** 编辑：** 让我进一步澄清：

这是我想概括的一个工作示例：

```
var local_refill_ids = Refills.Select(r => r.Id).Take(20).ToArray();

var groups = local_refill_ids
    .Select((Parameter, index) =>
        new
        {
            GroupID = index / 5, //5 parameters per request
            Parameter
        }
    )
    .GroupBy(x => x.GroupID)
    .AsEnumerable();

var results = groups
.Select(g => new { Group = g, Parameters = g.Select(x => x.Parameter) } )
.SelectMany(g => 
    Refills.Where(r => g.Parameters.Contains(r.Id))
)
.ToArray()
; 
```

此 SQL 代码中的结果：

```
SELECT [t0].[Id], ... [t0].[Version]
FROM [Refill] AS [t0]
WHERE [t0].[Id] IN (@p0, @p1, @p2, @p3, @p4)

... That query 4 more times (20 / 5 = 4) 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-20T08:49:22.903

我想出了一种将查询分块的方法——即你给它 4000 个值，所以它可能会执行 4 个请求，每个请求 1000 个；带有完整的罗斯文示例。请注意，这可能不适用于实体框架，因为`Expression.Invoke`- 但在 LINQ to SQL 上很好：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;

namespace ConsoleApplication5 {
    /// SAMPLE USAGE
    class Program {
        static void Main(string[] args) {
            // get some ids to play with...
            string[] ids;
            using(var ctx = new DataClasses1DataContext()) {
                ids = ctx.Customers.Select(x => x.CustomerID)
                    .Take(100).ToArray();
            }

            // now do our fun select - using a deliberately small
            // batch size to prove it...
            using (var ctx = new DataClasses1DataContext()) {
                ctx.Log = Console.Out;
                foreach(var cust in ctx.Customers
                        .InRange(x => x.CustomerID, 5, ids)) {
                    Console.WriteLine(cust.CompanyName);
                }
            }
        }
    }

    /// THIS IS THE INTERESTING BIT
    public static class QueryableChunked {
        public static IEnumerable<T> InRange<T, TValue>(
                this IQueryable<T> source,
                Expression<Func<T, TValue>> selector,
                int blockSize,
                IEnumerable<TValue> values) {
            MethodInfo method = null;
            foreach(MethodInfo tmp in typeof(Enumerable).GetMethods(
                    BindingFlags.Public | BindingFlags.Static)) {
                if(tmp.Name == "Contains" && tmp.IsGenericMethodDefinition
                        && tmp.GetParameters().Length == 2) {
                    method = tmp.MakeGenericMethod(typeof (TValue));
                    break;
                }
            }
            if(method==null) throw new InvalidOperationException(
                "Unable to locate Contains");
            foreach(TValue[] block in values.GetBlocks(blockSize)) {
                var row = Expression.Parameter(typeof (T), "row");
                var member = Expression.Invoke(selector, row);
                var keys = Expression.Constant(block, typeof (TValue[]));
                var predicate = Expression.Call(method, keys, member);
                var lambda = Expression.Lambda<Func<T,bool>>(
                      predicate, row);
                foreach(T record in source.Where(lambda)) {
                    yield return record;
                }
            }
        }
        public static IEnumerable<T[]> GetBlocks<T>(
                this IEnumerable<T> source, int blockSize) {
            List<T> list = new List<T>(blockSize);
            foreach(T item in source) {
                list.Add(item);
                if(list.Count == blockSize) {
                    yield return list.ToArray();
                    list.Clear();
                }
            }
            if(list.Count > 0) {
                yield return list.ToArray();
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T16:01:23.227

最简单的方法：使用[LINQKit](http://www.albahari.com/nutshell/linqkit.aspx)（免费、非限制性许可）

代码的工作版本：

```
public static IEnumerable<T> SelectByParameterList<T, PropertyType>(this Table<T> items, IEnumerable<PropertyType> parameterList, Expression<Func<T, PropertyType>> propertySelector, int blockSize) where T : class
{
    var groups = parameterList
        .Select((Parameter, index) =>
            new
            {
                GroupID = index / blockSize, //# of parameters per request
                Parameter
            }
        )
        .GroupBy(x => x.GroupID)
        .AsEnumerable();

    var selector = LinqKit.Linq.Expr(propertySelector);

    var results = groups
    .Select(g => new { Group = g, Parameters = g.Select(x => x.Parameter) } )
    .SelectMany(g => 
        /* AsExpandable() extension method requires LinqKit DLL */
        items.AsExpandable().Where(item => g.Parameters.Contains(selector.Invoke(item)))
    );

    return results;
} 
```

示例用法：

```
 Guid[] local_refill_ids = Refills.Select(r => r.Id).Take(20).ToArray();

    IEnumerable<Refill> results = Refills.SelectByParameterList(local_refill_ids, r => r.Id, 10); //runs 2 SQL queries with 10 parameters each 
```

再次感谢你的帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T04:34:42.280

LINQ-to-SQL 仍然通过标准 SQL 参数工作，因此编写一个花哨的表达式不会有帮助。这里有 3 个常用选项：

*   将 id 打包到（例如）csv/tsv 中；作为 a 传递`varchar(max)`并使用 udf 将其（在服务器上）拆分为表变量；加入表变量
*   在 SQL Server 2008 中使用表值参数
*   在服务器上有一个表，您可以将 id 推送到其中（可能通过 SqlBulkCopy）（可能使用“会话 guid”或类似的）；加入这个表

第一个是最简单的；获得“拆分 csv udf”是微不足道的（只需搜索它）。将 udf 拖到数据上下文中并从那里使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-13T10:22:14.550

传递`IQuerable`给`Contains`函数而不是列表或数组。请看下面的例子

```
var df_handsets = db.DataFeed_Handsets.Where(m => m.LaunchDate != null).
                  Select(m => m.Name);
var Make = (from m in db.MobilePhones
    where (m.IsDeleted != true || m.IsDeleted == null)
        && df_handsets.Contains(m.Name)
    orderby m.Make
    select new { Value = m.Make, Text = m.Make }).Distinct(); 
```

当您传递列表或数组时，它以参数的形式传递，当列表项计数大于 2100 时，它会超过计数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-07T16:38:59.753

您可以创建自己的 QueryProvider

```
public class QueryProvider : IQueryProvider
{
    // Translates LINQ query to SQL.
    private readonly Func<IQueryable, DbCommand> _translator;

    // Executes the translated SQL and retrieves results.
    private readonly Func<Type, string, object[], IEnumerable> _executor;

    public QueryProvider(
        Func<IQueryable, DbCommand> translator,
        Func<Type, string, object[], IEnumerable> executor)
    {

        this._translator = translator;
        this._executor = executor;
    }

    #region IQueryProvider Members

    public IQueryable<TElement> CreateQuery<TElement>(Expression expression)
    {
        return new Queryable<TElement>(this, expression);
    }

    public IQueryable CreateQuery(Expression expression)
    {
        throw new NotImplementedException();
    }

    public TResult Execute<TResult>(Expression expression)
    {
        bool isCollection = typeof(TResult).IsGenericType &&
            typeof(TResult).GetGenericTypeDefinition() == typeof(IEnumerable<>);
        var itemType = isCollection
            // TResult is an IEnumerable`1 collection.
            ? typeof(TResult).GetGenericArguments().Single()
            // TResult is not an IEnumerable`1 collection, but a single item.
            : typeof(TResult);
        var queryable = Activator.CreateInstance(
            typeof(Queryable<>).MakeGenericType(itemType), this, expression) as IQueryable;

        IEnumerable queryResult;

        // Translates LINQ query to SQL.
        using (var command = this._translator(queryable))
        {
            var parameters = command.Parameters.OfType<DbParameter>()
                .Select(parameter => parameter)
                .ToList();

            var query = command.CommandText;
            var newParameters = GetNewParameterList(ref query, parameters);

            queryResult = _executor(itemType,query,newParameters);
        }

        return isCollection
            ? (TResult)queryResult // Returns an IEnumerable`1 collection.
            : queryResult.OfType<TResult>()
                         .SingleOrDefault(); // Returns a single item.
    }       

    public object Execute(Expression expression)
    {
        throw new NotImplementedException();
    }

    #endregion

     private static object[] GetNewParameterList(ref string query, List<DbParameter> parameters)
    {
        var newParameters = new List<DbParameter>(parameters);

        foreach (var dbParameter in parameters.Where(p => p.DbType == System.Data.DbType.Int32))
        {
            var name = dbParameter.ParameterName;
            var value = dbParameter.Value != null ? dbParameter.Value.ToString() : "NULL";
            var pattern = String.Format("{0}[^0-9]", dbParameter.ParameterName);
            query = Regex.Replace(query, pattern, match => value + match.Value.Replace(name, ""));
            newParameters.Remove(dbParameter);
        }

        for (var i = 0; i < newParameters.Count; i++)
        {
            var parameter = newParameters[i];
            var oldName = parameter.ParameterName;
            var pattern = String.Format("{0}[^0-9]", oldName);
            var newName = "@p" + i;
            query = Regex.Replace(query, pattern, match => newName + match.Value.Replace(oldName, ""));
        }      

        return newParameters.Select(x => x.Value).ToArray();
    }
}

    static void Main(string[] args)
    {
        using (var dc=new DataContext())
        {
            var provider = new QueryProvider(dc.GetCommand, dc.ExecuteQuery);

            var serviceIds = Enumerable.Range(1, 2200).ToArray();

            var tasks = new Queryable<Task>(provider, dc.Tasks).Where(x => serviceIds.Contains(x.ServiceId) && x.CreatorId==37 && x.Creator.Name=="12312").ToArray();

        }

    } 
```

# c++ - C++：大整数

> ID：567969
> 
> 赞同：4
> 
> 时间：2009-02-20T01:32:34.480
> 
> 标签：c++, flex-lexer

我正在编写一个词法分析器作为编译器项目的一部分，我需要检测一个整数是否大于 int 可以容纳的整数，以便打印错误。是否有适合此目的的大整数 C++ 标准库？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-20T01:46:10.767

用于将数字字符串转换为整数的标准 C 库函数应该检测超出范围的数字，并将 errno 设置为 ERANGE 以指示问题。看[这里](http://www.fhi-berlin.mpg.de/th/locserv/alphas/DOCS/HTML/MAN/MAN3/0104____.HTM)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-20T01:47:17.537

您可能可以使用 libgmp。但是，我认为出于您的目的，这只是不必要的。

例如，如果您将数字解析为 32 位无符号整数，则

1.  解析第一个最多 9 个十进制数（即 floor(32*log(2)/log(10)）。如果没有更多，则该数字是可以的。
2.  取下一个数字。如果你得到的数字 / 10 不等于上一步的数字，那么这个数字就是坏的。
3.  如果您有更多数字（例如，超过 9+1），则数字不好。
4.  否则数字是好的。

请务必跳过任何前导零等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T02:19:23.620

libgmp 是一个通用的解决方案，虽然可能有点重量级。

对于轻量级的词法分析器，您可以将其视为字符串；修剪前导零，如果超过10位，则太长；如果较短则没关系，如果正好是 10 位，则字符串与最大值 2^31=2147483648 或 2^32=4294967296 进行比较。请记住，-2^31 是合法值，但 2^31 不是。还要记住八进制和十六进制常量的语法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T03:52:25.613

**对于所有建议atoi的人：**

*   我的 atoi() 实现没有设置 errno。
*   我的 atoi() 实现不会在溢出时返回 INT_MIN 或 INT_MAX。
*   我们不能依赖符号反转。考虑 0x4000...0。
    *   *2 并设置负位。
    *   *4 且值为 0。
    *   使用以 10 为底的数字，我们的下一个数字将乘以 10。

这都是胡说八道。除非您的词法分析器正在解析数字数据，否则请停止**过早的优化**。它只会导致悲伤。

这种方法可能效率低下，但*足以*满足您的需求：

```
const char * p = "1234567890123";
int i = atoi( p );

ostringstream o;
o << i;
return o.str() == p; 
```

或者，利用堆栈：

```
const char * p = "1234567890123";
int i = atoi( p );

char buffer [ 12 ];
snprintf( buffer, 12, "%d", i );
return strcmp(buffer,p) == 0; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T03:11:28.597

这个怎么样。使用 atol，并检查溢出和下溢。

```
#include <iostream>
#include <string>

using namespace std;

main()
{
    string str;
    cin >> str;
    int i = atol(str.c_str());
    if (i == INT_MIN && str != "-2147483648") {
        cout << "Underflow" << endl;
    } else if (i == INT_MAX && str != "2147483647") {
        cout << "Overflow" << endl;
    } else {
        cout << "In range" << endl;
    }   
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T01:42:50.650

如果您希望能够处理此类数字，您可能需要查看[**GMP 。**](http://gmplib.org/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T01:49:45.487

在您的词法分析器中，当您解析整数字符串时，您必须在添加每个新数字之前乘以 10（假设您从左到右解析）。如果该运行总计突然变为负数，则您已经超出了整数的精度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T10:38:15.420

如果您的语言（如 C）支持表达式的编译时评估，那么您可能也需要考虑这一点。

像这样的东西：

```
#define N 2147483643  // This is 2^31-5, i.e. close to the limit.

int toobig = N + N; 
```

GCC 会捕捉到这一点，说“警告：表达式中的整数溢出”，但当然没有个别文字溢出。这可能超出了您的要求，只是想我会指出它是该部门真正的编译器需要的东西。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-20T01:44:48.367

您可以分别检查该数字是高于还是低于 INT_MAX 或 INT_MIN。你需要`#include <limits.h>`

# html - CSS 布局问题

> ID：567970
> 
> 赞同：0
> 
> 时间：2009-02-20T01:33:09.130
> 
> 标签：html, css

在[此网页](http://chaletsdesbouleaux.com/)的顶部，主要内容区域（白色背景）中有两个元素：图像和徽标框。

徽标框向右浮动，并且图像具有足够大的右边距以容纳徽标框和一点填充。但是，如果您使浏览器窗口足够窄，则徽标框会滑到图像下方。我想要发生的是，两者之间的水平空间减少到至少 6 个像素，并且如果浏览器窗口变得更窄，则会出现水平滚动条。

有什么方法可以在不采用完全“冻结”布局的情况下实现这一点，即在主要内容区域设置固定宽度？

谢谢，唐

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T01:40:21.640

css`min-width`属性可以满足您的需求。但在 IE 6 中不起作用。为此，如果确实有必要，一些 JavaScript 可以提供帮助。

将白色 DIV 设置`min-width`为图像大小 + 边框。

# php - 如何使用 /htdocs 目录结构中的文件设置 SVN

> ID：567971
> 
> 赞同：3
> 
> 时间：2009-02-20T01:34:47.580
> 
> 标签：php, svn, apache, version-control

我在处理 php 文件时如何设置 Subversion 时遇到了一个小问题。我将所有文件存储在 c:\www[nameOfProject]\htdocs 并为每个项目设置虚拟主机。（c:\www\project1\htdocs\index.php 映射到[http://localhost/project1/index.php](http://localhost/project1/index.php)）。

你们如何处理使用SVN？假设我有 c:\svnrepos\，这是我为每个项目存储每个 repo 的地方。现在理想情况下，我想从 c:\svnrepos\project1 到 c:\www\project1 的存储库中签出对吗？但是文档说要对一个空目录执行此操作，但是如何在不先将其移动到其他地方的情况下预览我的代码呢？

谢谢你们的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T02:20:19.873

有效地做到这一点的一种方法是通过将主干检出到 c:\www\preview\project1 并在那里使用适当的虚拟主机或不同的 url 对其进行测试来进行开发。

当您开始工作时，您将检查各种版本的主干。当转移到您的“真实”主机/网址成熟时，您

1.  创建一个分支或标签来反映这一点（如branchs/rel.1），并且
2.  签出（svn co）分支到 c:\www\project1\htdocs

之后，您可以在分支/rel.1 下进行紧急错误修复，并将它们合并回主干下正在进行的工作。当另一个版本准备好时，您

1.  创建另一个分支（例如，branchs/rel.2），然后
2.  切换（svn switch）c:\www\project1\htdocs 到新分支

这样，您可以防止您的开发干扰实际服务，并且如果您遇到问题，还可以切换回早期版本。

对于更复杂但更紧急的错误修复，您可以

1.  将您的开发作为主干签入
2.  将 c:\www\preview\project1 切换到当前发布分支
3.  修复并测试 c:\www\preview\project1 中的错误，根据需要提交
4.  满意后，进行最后的签入，然后在 c:\www\project1\htdocs 上进行 svn 更新
5.  将c:\www\preview\project1切换回trunk，继续开发

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T01:57:15.467

空目录并不意味着 c:。

因此，您可以安全地在 c:\svnrepos\project1 拥有一个存储库，然后签出到 c:\www\project1 以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T02:07:17.597

你可以做你想做的。如果您的 repo 在 at`c:\svnrepos\project1`那么您可以检查一个新的工作副本到`c:\www\project1`，它确实应该是空的。

> 如何预览我的代码...？

通过将代码签出到其他目录来预览代码。例如，`c:\www\preview\project1`通过设置适当的虚拟主机将其签出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-20T02:21:35.987

如果您已经签出了应用程序的一个实例，`C:\www\project1`并且您想预览自签出后所做的一些更改而不更改现有应用程序，那么是的，您需要创建一个新的空目录来签出文件into （或者你可以将现有的移动到`C:\www\project1`其他地方，创建一个新的 empty `C:\www\project1`，然后签出）

但是，如果您不需要同时提供新的更改和应用程序的原始版本，您可以随时使用 SVN 使用`C:\www\project1`您所做的更改来更新工作副本。如果您不喜欢它们，只需将该工作副本恢复为早期版本即可。

# ruby-on-rails - Ruby 类成员变量现在可以了吗？

> ID：567978
> 
> 赞同：5
> 
> 时间：2009-02-20T01:39:09.020
> 
> 标签：ruby-on-rails, ruby, multithreading, thread-safety

去年五月在波特兰的 Railsconf 上，我参加了一个演讲，有人认为，在 Rails 中，Ruby 类成员变量，如 @@foo，是危险的，因为它们本质上是非线程安全的。

之后我研究了这个问题，但我从来没有找到一个真正充实这个问题的链接。我将不胜感激指向一篇关于 Rails 和线程的好文章，该文章真正涉及到类成员问题。另外，很高兴知道 Rail 2+ 和 Yarv 在这方面是如何改变的。

## 编辑：

也许我对演示文稿的记忆模糊不清，但我记得@@foo 的问题超出了通常的警告，即必须严格控制任何共享变量访问。我知道 Ruby 代码本身存在内存泄漏，不久前已修复。我正在寻找有关 Ruby 共享变量和多任务处理的文章链接，越深入越好。*目前我不使用类变量来做任何事情，但是在某些情况下能够使用它们会很好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-20T02:26:37.520

任何共享的可变状态本质上都是线程不安全的。您需要锁定所有访问以确保一切安全，并确保一切都是可重入的。 `@@foo`尤其糟糕，因为任何子类都可以访问该变量，因此更难审计代码。Rails 2+ 只是通过审核所有内容并确保在必要时使用互斥锁和其他同步原语来“解决”这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T12:27:24.893

我认为它们和以往一样好，但在可能多次加载类的 Rails 环境中仍需谨慎使用（例如，如果您使用 mongrel，则每个 mongrel 一次），因此类成员变量可以在这些过程中独立变化。

我认为[Ruby 1.9 中 @@ 变量的作用域发生了变化](http://eigenclass.org/hiki.rb?Changes+in+Ruby+1.9#l38)，这可能应该被考虑在内 - 我们总有一天会在那里。

你有什么特别的用途吗？我以为我最近需要一个，但事实证明这是我对这个主题的（粗略）理解的一个错误——我真正需要的是类上的一个实例变量。（我正在构建一个模块来扩展一个类，以便我可以添加一些 AR 风格的声明性宏优点。）

# windows - 是否有免费的“添加连接”或“SQL 连接”对话框？

> ID：567981
> 
> 赞同：8
> 
> 时间：2009-02-20T01:42:20.073
> 
> 标签：windows, winforms, dialog

我喜欢服务器资源管理器窗口中 Visual Studio 中的“添加连接”或“SQL 连接”对话框。我也喜欢 CodeSmith 中的那个。我想在我的 Windows 应用程序中拥有相同的对话框或类似功能。

我需要它来处理 SQL Server 和 SQL Server Express 数据库文件 (*.mdf)。

我的客户安装了 .NET 3.5 SP1 和 SQL Server 2008 Express。

这是我可以使用的系统对话框吗？有没有类似的开源对话框？谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-03-03T13:28:41.540

我正在寻找那个，似乎微软已经发布了 Visual Studio 连接对话框的源代码，以便它可以在 VS 之外使用：

[http://code.msdn.microsoft.com/Connection](http://code.msdn.microsoft.com/Connection)

我刚试过，效果很好：）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T01:56:20.273

给你：
**SQL 连接对话框**
[http://www.codeproject.com/KB/vb/SQL_Connection_Dialog.aspx](http://www.codeproject.com/KB/vb/SQL_Connection_Dialog.aspx)

**编辑：**
似乎上面的示例使用的是不允许重新分发的 MSDASC.DataLinks.ui。

有使 MSDASC.DataLinks ui 可分发的请求： [http ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=291885](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=291885)

所以它只有在最终用户安装了 VS 时才有效。还不够好。我不会删除此答案，因为如果您想制作自己的对话框，该项目仍然是一个好的开始。

**编辑 2：**
**有关该主题的更多信息：从您自己的代码**[http://www.mztools.com/articles/2007/MZ2007011.aspx](http://www.mztools.com/articles/2007/MZ2007011.aspx) 和 [http://www.clariusconsulting.net/](http://www.clariusconsulting.net/blogs/kzu/archive/2006/03/01/ReferenceRelativePath.aspx)
中使用 Visual Studio 2005 的“选择数据源”对话框[博客/kzu/archive/2006/03/01/ReferenceRelativePath.aspx](http://www.clariusconsulting.net/blogs/kzu/archive/2006/03/01/ReferenceRelativePath.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T01:44:45.327

你必须自己实现它。它是 VS.NET 安装的一部分，如果您要访问它，我相信 EULA 将要求您在每台运行它的机器上获得 VS.NET 许可证。

话虽如此，您必须自己实施。不幸的是，当查询开源添加连接对话框时，谷歌什么也没找到。

# java - Java API 是否设计不佳，为什么？

> ID：567987
> 
> 赞同：3
> 
> 时间：2009-02-20T01:45:26.713
> 
> 标签：java, api

我听说过很多，Java API 设计得很糟糕。你同意吗？如果同意，怎么做？我知道日历/日期 API 存在重大问题。集合 api 需要使用大量样板代码。File/IO API 在某些方面可能很复杂。

但是，这是否适用于所有国家？以及哪些版本的 Java？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-20T01:57:25.763

简而言之，Java API 是可以的。

更长的答案是，一些 API 在 Java 版本中经历了更改，有时甚至是重大更改，并且可能包含奇怪的部分。例如，日期有很多不推荐使用的方法。尽管如此，重要的是这些 API**确实存在**。Java 的标准库非常强大，您可以在其中找到几乎任何东西的 API（可能并不总是完美的 API，但已经足够好了）。

PS下次有人出这样的说法，问他一生中自己设计了多少种语言。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-20T02:16:00.790

Java 并不是一个设计不佳的 API。Java 是在不完全了解当前最佳实践的时候制作的。许多实现都是以现在不受欢迎的方式完成的。从那时起，为了整合更好的技术和实践，已经做了很多工作。这就是为什么有很多不推荐使用的代码。

[令人惊叹的《 Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)》一书中谈到了这些东西。Bloch 谈到了在最初实施过程中所犯的一些“错误”，以及他们如何努力解决这些错误。如果您是一名认真的 Java 开发人员并且还没有查看 Effective Java，我强烈推荐它。（实际上我推荐了[Bloch 的所有 3 本书。](http://en.wikipedia.org/wiki/Joshua_Bloch)他是一位出色的作家，对 Java 有透彻的了解。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T02:14:56.673

[《 Effective Java](http://books.google.com/books?id=ZZOiqZQIbRMC&pg=PA97&sig=JgnunNhNb8MYDcx60Kq4IyHUC58#PPP1,M1)》一书中介绍了一些“Java API 不好” 。

API 的某些部分，例如 java.util.Date 显然设计得很差（从 JDK 1.1 开始，除了几个方法外，所有方法都被弃用了）。

还有一些其他的事情，比如 JDK 1.0 的某些类缺少接口（这是因为创建时没有接口之类的东西（接口是在 1.0 之前但在 0.0 之后添加的）。

有些事情没有“正确”完成，因为约定是在 JDK 1.1 之后出现的，由于 JavaBeans 和使用的命名约定，AWT 发生了许多变化）。

在语言更改之前，还有一些其他事情是不可能的，例如枚举和泛型。

很多API都很好。其中一些是穷人。JDK 1.0 中的早期内容显然是为 HotJava（全 Java 网络浏览器）编写的，并没有真正考虑到一般消费。

可以肯定地说，API 越旧，它就越“差”。较新的 API 是根据之前的知识设计的。这也跨越了语言——Java（取决于你的意见）比 C++ 更好。C ++（取决于您的意见）比C等更好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-20T02:34:41.757

Java 是旧的（它起源于 90 年代初，尽管直到 1995 年左右才发布到 1.0）并且任何旧的 API 都有你可以批评的东西。并不是说它们本身很糟糕。它们只是他们时代的产物，而这种哲学现在被认为是不好的（通常有充分的理由，但并非总是如此）。

要解决您提出的问题：

*   日期很糟糕，因为它是可变的。不可变的日期类会更干净（日历也有同样的问题）；
*   String 上的公共构造函数充其量是有问题的。关于这是否是一个问题存在一些分歧。在我看来，这不是一个大问题。
*   java.io.* 类让我想起了 C++ iostream 库，因为它们是我认为历史证明不是成功（如果不是失败的话）的实验。只需查看将文本文件读入字符串所必须编写的代码。大多数其他语言都有一个标准调用可以做到这一点。

还有其他一些：

*   1.2 之前的集合是有问题的。Josh Bloch（以 Effective Java 闻名）是 1.2 中 Java Collections 框架更改的架构师。这是一个巨大的改变，包括所有类的接口、抽象实现等；
*   java.util.Properties 扩展了 Hashtable。这是当时产品的经典例子。在 90 年代，对象框架倾向于从某些东西继承。现在的趋势是（正确地）组合而不是继承，但 10 到 15 年前情况并非如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-20T02:03:35.327

您可能会争辩说它“设计不佳”，因为如果他们现在必须重新做，它的作者会以不同的方式构建它。然而，多年来，他们做出了值得称赞的努力，试图充分利用它。然而，事后看来是 20/20。

Java API 与任何必须“在运行时进化”的库都有相同的问题。

自从 Java 首次问世以来已经有很多年了，许多关于语言和库的设计决策已经演变。但是，向后兼容的需求一直限制着 API 和对其的更改。

可用性问题有很多具体的例子（过去几年我一直在研究它们），但话说回来，很少有 API 是完美的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-20T01:57:54.593

我不会说所有这些都设计得很糟糕。主要问题是向后兼容性，人们仍然希望可以使用早已弃用的功能，因此不必更改 10 年前编写的代码。这使得 API 相当大，并且通常允许多种方式来做同样的事情，而不清楚哪一种更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-20T02:18:10.503

> *Java API 是否设计不佳，为什么？*

不

因为，虽然它并不完美，但糟糕的 API 的数量远远少于刚刚好的部分！

无论如何，你真的应该问这个，你直接从谁那里听到的，否则这将是在我的国家被称为“坏电话”（否则这是一个很棒的儿童游戏:)）按摩链中的每个节点都会修改信息微妙，最后是这样的：

我不喜欢 java.util.Calendar

可能最终达到

Java API 完全被破坏了，设计者应该被监禁。

当然中间还有一个“消息转换”！！！

:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T02:19:49.047

就像任何存在了一段时间的东西一样，它会变得陈旧。与 .NET 一样，Sun 等人也试图保持新鲜感。但是，时间使一切停滞不前，尤其是考虑到您无法更改界面，只能添加，因为更改会破坏事物。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T06:45:50.517

**不，** Java API 对于大多数部分来说都很棒，但其中一些部分只是烂掉了。每个人都使用日期和日历作为示例*（这是强制性的[joda-time](http://joda-time.sourceforge.net/)链接）*，但我也会使用 XML API（本机/W3C 的 API，因为现在有几个）作为一个很好的例子：The issue with that part of the API 是它不能按预期工作并且不符合 API 的其余部分。

Also one important factor with Java API is that it's consistent and not just within itself but within versions and platforms *(with the exception of AWT)* and I sure haven't hit any magical spot with Java API yet which would've changed/broken something when doing a version switch.

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-02-20T01:59:59.580

我在 1995 年左右开始使用 Java API。任何这么旧的 API 都很容易受到批评。

要回答为什么的问题：

*   Java 引入枚举为时已晚 - 如果 API 从一开始就有枚举，它会更好。
*   WORA（一次编写，到处运行）- 或者正如一些人所说的“编写一次，到处调试”。当您的目标是最不常见的恶魔时，要制作一个出色的 API 是非常困难的。没有“真正的”Windows、Mac、Unix 或 Linux 开发人员会对 Java 感到满意。

# asp.net - 导航菜单 - 渲染分隔管道字符

> ID：567988
> 
> 赞同：1
> 
> 时间：2009-02-20T01:45:43.653
> 
> 标签：asp.net, html, algorithm, user-interface

我有一个 web 控件，顶部显示了一些链接，例如：

```
Link 1 | Link 2 | Link 3 
```

目前它们都是一个 asp:Hyperlink。`Is there a clever solution for rendering out the dividing pipe characters?`

目前它们在包含的占位符内。我们无法对始终出现的给定链接做出任何保证。我不想要一个非常大的 if 语句，而且我不愿意纯粹在代码隐藏中呈现所有链接......

**[更新]**

感谢您指出 CSS 是要走的路。这当然让事情变得更容易了。当然，我们确实需要一个跨浏览器的解决方案。

HTML 列表（*<ul>*和*<li>*）结构很有效，因为**first-child** / **last-child**属性负责列表的末尾。*注意*：这些是自动的 - 您不必在标记中指定它们。

因为我们只需要管道符号，所以我使用了边框属性。如果你愿意，你可以使用**margin-left** + **background** image CSS 属性来代替图像间隔。

我们的解决方案：

*HTML：*

```
<ul class="navMenu">
    <li><a href="...">Link 1</a></li>
    <li><a href="...">Link 2</a></li>
    <li><a href="...">Link 2</a></li>
</ul> 
```

*CSS：*

```
ul.navMenu li
{
    display: inline;
    margin-left: 0;
}

ul.navMenu a
{
    border-left: solid 1px #333333;
    padding-left: 0.4em;
    padding-right: 0.4em;
}

ul.navMenu li.first-child a
{
    border-left: none 0;
    padding-left: 0;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T02:07:33.947

不幸的是， `a + a`CSS 解决方案并不适用于所有浏览器。

我通常将我的列表标记为：

```
<ul>
    <li class="first-child"><a href="#">Link 1</a></li>
    <li><a href="#">Link 2</a></li>
    <li class="last-child"><a href="#">Link 3</a></li>
</ul> 
```

这不仅提供了更好的 JavaScript 钩子，而且您可以自定义最左边/最右边的元素以关闭边框或根据需要调整填充。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T07:19:32.697

CSS 和/或 JQuery 方法效果很好。有时你真的可能只是想要`<a></a> | <a></a> | <a></a>`。

看看几个服务器端控件可能是值得您花时间的。根据您获得链接的位置（您说可能缺少一些链接？）您可以只使用一个控件，它有一个可以放置 | 的位置。如果链接丢失取决于谁登录和某种用户角色，也许你可以使用站点地图 + 控件，它也有一个 .

# mysql - 这个查询有什么问题？EXPLAIN 对我来说很好

> ID：567991
> 
> 赞同：5
> 
> 时间：2009-02-20T01:47:00.377
> 
> 标签：mysql, optimization, performance

我正在浏览一个应用程序并尝试优化一些查询，但我真的很努力解决其中的一些问题。这是一个例子：

```
选择“项目”。* , `来源`。* , `关键字`。* , `作者` . *
从`项目`作为`项目`
加入 `sources` AS `Source` ON (`Item`.`source_id` = `Source`.`id`)
加入 `authors` AS `Author` ON (`Item`.`author_id` = `Author`.`id`)
加入`items_keywords` AS `ItemsKeyword` ON (`Item`.`id` = `ItemsKeyword`.`item_id`)
加入 `keywords` AS `Keyword` ON (`Keyword`.`id` = `ItemsKeyword`.`keyword_id`)
加入 `keywords_profiles` AS `KeywordsProfile` ON (`Keyword`.`id` = `KeywordsProfile`.`keyword_id`)
加入 `profiles` AS `Profile` ON (`Profile`.`id` = `KeywordsProfile`.`profile_id`)
WHERE `KeywordsProfile`.`profile_id` IN ( 17 )
GROUP BY `Item`.`id`
ORDER BY `Item`.`timestamp` DESC , `Item`.`id` DESC
限制 0 , 20;

```

这需要 10-30 秒...在引用的表中，大约有 500k 作者行，以及大约 750k 项目和 items_keywords 行。其他所有内容都少于 500 行。

这是解释输出：http: [//img.skitch.com/20090220-fb52wd7jf58x41ikfxaws96xjn.jpg](http://img.skitch.com/20090220-fb52wd7jf58x41ikfxaws96xjn.jpg)

解释对我来说相对较新，但我一行一行地经历了这一点，一切似乎都很好。不知道我还能做什么，因为我对所有内容都有索引......我错过了什么？

它所在的服务器在 slicehost 上只是一个 256 切片，但它上面没有运行其他任何东西，并且 CPU 在运行之前为 0%。然而，它仍然在这个查询上摇摆不定。有任何想法吗？

编辑：一些进一步的信息；让这真正令人沮丧的一件事是，如果我重复运行这个查询，它只需要不到 0.1 秒。我假设这是由于查询缓存造成的，但如果我在它之前运行 RESET QUERY CACHE，它仍然运行得非常快。只有在我稍等片刻或运行其他一些查询后，10-30 秒的时间才会返回。所有的表都是 MyISAM ......这是否表明 MySQL 正在将内容加载到内存中，这就是为什么它在一段时间内运行得这么快的原因？

编辑2：非常感谢大家的帮助...更新...我将所有内容简化为：

```
选择 i.id
从项目 AS i
按 i.timestamp DESC、i.id DESC 排序
限制 0、20；

```

尽管数据库中只有 750k 条记录，但始终需要 5-6 秒。一旦我删除了 ORDER BY 子句的第二列，它几乎是即时的。这里显然发生了几件事，但是当我将查询缩减为：

```
选择 i.id
从项目 AS i
加入 items_keywords AS ik ON (i.id = ik.item_id)
加入关键字 AS k ON ( k.id = ik.keyword_id )
加入keywords_profiles AS kp ON (k.id = kp.keyword_id)
在哪里 kp.profile_id (139)
按 i.timestamp DESC 排序
限制 20；

```

它仍然需要 10 多秒......我还能做什么？

小小的好奇：在解释中， items_keywords 的 rows 列始终为 1544，无论我在查询中使用什么 profile_id。它不应该根据与该配置文件关联的项目数量而改变吗？

编辑3：好的，这越来越荒谬了:)。如果我完全放弃 ORDER BY 子句，事情会非常迅速，临时表/文件排序从解释中消失。item.timestamp 列上当前有一个索引，但由于某种原因它没有被使用吗？我以为我只记得每个表只使用一个索引或其他什么东西？我应该在此查询引用的项目表上的所有列（source_id、author_id、时间戳等）上创建一个多列索引吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T01:56:08.293

看起来不错，其中的每一行都`explain`使用某种索引。一个可能的担忧是`filesort`位。尝试在没有`order by`子句的情况下运行查询，看看是否可以改善它。

然后，我要做的是逐渐取出每个`join`，直到你（希望）获得巨大的速度提升，然后专注于为什么会发生这种情况。

我提到的原因`filesort`是因为我在输出中的任何地方都看不到时间戳的提及`explain`（即使它是您的主要排序标准） - 它可能需要完整的非索引排序。

更新#1：

基于编辑#2，查询：

```
SELECT i.id
    FROM items AS i
    ORDER BY i.timestamp DESC, i.id DESC
    LIMIT 0, 20; 
```

需要 5-6 秒。这太可恶了。`TIMESTAMP`尝试在两者上创建一个复合索引`ID`，看看是否可以改善它：

```
create index timestamp_id on items(timestamp,id);
select id from items order by timestamp desc,id desc limit 0,20;
select id from items order by timestamp,id limit 0,20;
select id from items order by timestamp desc,id desc;
select id from items order by timestamp,id; 
```

在其中一项测试中，我省略了降序位（如果索引的顺序相反，DB2 有时不使用索引）。另一种变化是取消限制，以防影响它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-20T02:44:11.517

试试这个，看看它是怎么做的：

```
SELECT i.*, s.*, k.*, a.*
FROM items AS i
 JOIN sources AS s ON (i.source_id = s.id)
 JOIN authors AS a ON (i.author_id = a.id)
 JOIN items_keywords AS ik ON (i.id = ik.item_id)
 JOIN keywords AS k ON (k.id = ik.keyword_id)
WHERE k.id IN (SELECT kp.keyword_id
           FROM keywords_profiles AS kp
           WHERE kp.profile_id IN (17))
ORDER BY i.timestamp DESC, i.id DESC
LIMIT 0, 20; 
```

我将几个联接分解为一个不相关的子查询，因此您不必`GROUP BY`将结果映射到不同的行。

实际上，`i.id`在我的示例中，您可能仍然会得到多行，这取决于有多少关键字映射到给定项目以及`profile_id`17 个。

您的`filesort`EXPLAIN 报告中的报告可能是由于不同字段的组合`GROUP BY`和使用造成的。`ORDER BY`

我同意@ʞɔıu 的回答，即加速可能是因为密钥缓存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T11:17:28.290

为了让您的查询快速运行，您需要：

1.  创建索引：`CREATE INDEX ix_timestamp_id ON items (timestamp, id)`

    *   确保 是`id`on `sources`，`authors`并且`keywords`是主键。
    *   强制 MySQL 将此索引用于项目，并`NESTED LOOP`为其他项目执行连接：

        解释扩展选择`Item`.*, `Source`. * , `Keyword`. * , `Author`. * 从`items`AS `Item`FORCE INDEX FOR ORDER BY (ix_timestamp_id) JOIN `items_keywords`AS `ItemsKeyword`FORCE INDEX (ix_item_keyword) ON ( `Item`. `id`= `ItemsKeyword`. `item_id`AND `ItemsKeyword`. `keyword_id`IN ( SELECT `keyword_id` FROM `keywords_profiles`AS `KeywordsProfile`FORCE INDEX (ix_keyword_profile) WHERE `KeywordsProfile`. `profile_id`= 17 ) ) JOIN `sources`AS `Source`FORCE INDEX (primary) ON ( `Item`. `source_id`= `Source`. `id`) 加入`authors`作为`Author`强制索引（主要）打开（`Item`. `author_id`= `Author`. `id`）加入`keywords`作为`Keyword`强制索引（主要）打开（`Keyword`. `id`= `ItemsKeyword`.`keyword_id`) ORDER BY `Item`.timestamp DESC, `Item`.id DESC LIMIT 0, 20

如您所见，我们摆脱了`GROUP BY`，将子查询推送到`JOIN`条件中并强制`PRIMARY KEY`s 用于连接。

这就是我们如何确保将`NESTED LOOPS`with`items`作为前导表用于所有连接。

因此：

```
1, 'PRIMARY', 'Item', 'index', '', 'ix_timestamp_id', '12', '', 20, 2622845.00, ''
1, 'PRIMARY', '作者', 'eq_ref', 'PRIMARY', 'PRIMARY', '4', 'test.Item.author_id', 1, 100.00, ''
1, 'PRIMARY', '来源', 'eq_ref', 'PRIMARY', 'PRIMARY', '4', 'test.Item.source_id', 1, 100.00, ''
1, 'PRIMARY', 'ItemsKeyword', 'ref', 'PRIMARY', 'PRIMARY', '4', 'test.Item.id', 1, 100.00, '使用where; 使用索引'
1, 'PRIMARY', '关键字', 'eq_ref', 'PRIMARY', 'PRIMARY', '4', 'test.ItemsKeyword.keyword_id', 1, 100.00, ''
2, 'DEPENDENT SUBQUERY', 'KeywordsProfile', 'unique_subquery', 'PRIMARY', 'PRIMARY', '8', 'func,const', 1, 100.00, '使用索引；使用哪里'

```

，当我们运行它时，我们得到

```
20 rows fetched in 0,0038s (0,0019s) 
```

有`500k`in `items`、`600k`in `items_keywords`、`512`in`keywords`和`512`value in `keywords_profiles`（都带有 profile `17`）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T03:35:00.273

查看问题评论中的[paste.org](http://pastie.org/395196)链接：

*   你正在`items.source_id int(4)`加入`sources.id int(16)`
*   也`items.id int(16)`到`itemskeywords.item_id int(11)`

在这些情况下，我看不出两个字段具有不同宽度的任何充分理由

我意识到这些只是显示宽度，并且列可以存储的实际数字范围仅由 INT 部分确定，但 MySQL 6.0[参考手册](http://dev.mysql.com/doc/refman/6.0/en/numeric-types.html)说：

> 请注意，如果您在整数列中存储大于显示宽度的值，当 MySQL 为一些复杂的连接生成临时表时，您可能会遇到问题，因为在这些情况下，MySQL 假定数据适合原始列宽。

从您引用的粗略数据来看，您似乎没有超出任何 ID 列的显示宽度。尽管只是为了消除另一个可能的错误，但您也可以整理这些不一致之处。

如果您不需要显示宽度，您也可以完全删除它们

**编辑：**

我会大胆猜测，数据库的原始作者可能认为这`int(4)`意味着“最多 4 位的整数”，而实际上它的意思是“显示 -2147483648 和 2147482647 之间的整数，至少显示 4 个字符，如果需要，左填充空格是”

`authors.refreshed int(20)`像这样的定义`items.timestamp int(30)`真的没有意义，因为只能有 10 位数字加上`int`. 甚至一个`bigint`不能超过20个字符。也许原作者认为`int(4)`类似于`varchar(4)`？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T01:59:19.567

我建议您对查询运行分析器，然后您可以查看每个子查询花费了多长时间以及时间消耗在哪里。如果您有 phpmyadmin，这是一个简单的复选框，您需要检查才能获得此功能，但我猜您也可以从 mysql 终端应用程序手动获取它。我以前没有见过这个解释的东西，如果它实际上是我在 phpmyadmin 中习惯的分析，我为胡说八道道歉。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T02:10:47.900

GROUP BY 子句的作用是什么？SELECT 中没有聚合函数，因此 GROUP BY 应该是不必要的

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T02:26:00.187

一些事情要尝试：

1.  尽量不要从所有表中选择所有列，而只选择您需要的内容。这可能会排除使用覆盖索引（在额外列中查找使用索引），并且通常会吸收大量不必要的 IO。
2.  该文件排序看起来有点麻烦。尝试删除 order by 并将其替换为 order by null - group by 在mysql中隐式排序，因此您必须按 null 排序才能删除该隐式排序。
3.  尝试在项目 (timestamp, id) 或 (id, timestamp) 上添加索引。可能会对那个文件排序做点什么（你永远不知道）。
4.  为什么要按项目 ID 分组？并且不选择任何聚合列？如果您按列分组，然后选择（更少排序）其他一些非聚合列，那么这些列的值将或多或少地被任意选择。除非，对于这个查询，item id 是否总是唯一的，在这种情况下 group by 将不会完成任何事情。
5.  最后，根据我的经验，如果你给它太多的连接来尝试优化，mysql 有时会莫名其妙地发疯。试着弄清楚是否有某种方法你不必像那样一次做这么多的连接，即如果可以的话，把它分成多个查询。
6.  *让这真正令人沮丧的一件事是，如果我重复运行这个查询，它只需要不到 0.1 秒。我假设这是由于查询缓存*- 在 SELECT 关键字之后添加 SQL_NO_CACHE 以禁用每个查询的查询缓存的使用
7.  *所有的表都是 MyISAM ......这是否表明 MySQL 正在将内容加载到内存中，这就是为什么它在一段时间内运行得这么快*- MyISAM 使用键缓冲区并且只在内存中缓存索引数据，并依赖操作系统来缓存非索引数据。与 Innodb 不同，它将所有内容都缓存在缓冲池中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T02:30:58.973

您是否有可能因为文件系统 I/O 而遇到问题？EXPLAIN 显示必须从`ItemsKeyword`表中提取 1544 行。如果您必须为每个磁盘访问磁盘，则总共会增加大约 10-15 秒的运行时间（假设因为您在虚拟机上，所以寻道时间较长）。通常，这些表缓存在 RAM 中，或者数据存储在足够近的磁盘上，可以组合读取。但是，您在具有 256MB 内存的 VM 上运行，因此您可能没有可以缓存的内存备用，如果您的表文件碎片足够多，您可能会使查询性能下降这么多。

您可能通过在服务器上运行类似`pidstat -d 1`或`iostat 1`在另一个 shell 中的东西来了解查询期间 I/O 发生了什么。

编辑：通过查看在（`ItemsKeyword`. `item_id`, `ItemsKeyword`. `keyword_id`）上添加索引的查询，如果我的理论是正确的，那么它应该是对`ItemsKeyword`表的查找问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T02:52:36.490

MySQL 将很多内容加载到不同的缓存中，包括索引和查询。此外，您的操作系统将保留一个文件系统缓存，以便在重复执行时加快您的查询速度。

需要考虑的一件事是 MySQL 在此类查询期间如何创建临时表。正如您在解释中看到的，正在创建一个临时表，可能用于对结果进行排序。一般情况下，MySQL 会在内存中创建这些临时表，除非有 2 个条件。首先，如果它们超过 MySQL 设置中设置的最大大小（最大临时表大小或堆大小 - 检查 mysqlperformanceblogs.com 以获取有关这些设置的更多信息）。第二个也是更重要的一个是：

*   在查询中选择文本或 blob 表时，将始终在磁盘上创建临时表。

如果您的服务器正在执行任何操作，这可能会对性能造成重大影响，甚至会导致 i/o 瓶颈。

检查您的任何列是否属于此数据类型。如果是，您可以尝试重写查询，以便不创建临时表（我认为分组依据总是导致它们），或者尝试不选择这些。另一种策略是将其分解为几个较小的查询，这些查询可能会在很短的时间内执行。

祝你好运！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-20T05:58:37.167

我可能完全错了，但是当你改变时会发生什么

```
WHERE kp.profile_id IN (139) 
```

至

```
WHERE kp.profile_id = 139 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T20:43:58.210

尝试这个：

```
SELECT i.id
FROM ((items AS i
   INNER JOIN items_keywords AS ik ON ( i.id = ik.item_id ))
   INNER JOIN keywords AS k ON ( k.id = ik.keyword_id ))
   INNER JOIN keywords_profiles AS kp ON ( k.id = kp.keyword_id AND kp.profile_id = 139)
ORDER BY i.timestamp DESC
LIMIT 20; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-14T13:56:02.337

尝试您的表的备份副本。之后将原始表重命名为其他表，将新表重命名为原始表，然后使用新命名但旧命名的表重试...

或者您可以尝试修复表格，但这并不总是有帮助。

编辑：伙计，这是一个老问题......

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-20T01:55:23.803

问题似乎是它必须在尝试执行 where 子句之前对每个表进行完全连接。这可能会导致每个表有 500k 行，您正在查看它在内存中填充的数百万行。我会尝试将 JOINS 更改为 LEFT JOINS USING ()。

# sharepoint - SharePoint 2007 网站模板内容类型

> ID：567994
> 
> 赞同：2
> 
> 时间：2009-02-20T01:49:10.713
> 
> 标签：sharepoint, sharepoint-2007, content-type, sitetemplate

我是 SharePoint 开发的新手。我们创建了一个基本站点模板，并使用该模板在同一服务器上的其他位置启动新站点。这工作正常，但新创建的站点似乎“扁平化”了在原始站点中创建的自定义内容类型。我认为有一种方法可以保持原始内容类型继承的完整性，以帮助支持对新站点进行任何必要的修改。他们仍然可以进行修改，但需要更长的时间，因为您必须单独访问每个列表。有谁知道如何解决这个问题或知道一个更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T07:28:09.260

您遇到的问题是从原始网站集移动到另一个网站集。站点模板不存储站点的完整定义 - 仅存储与基础站点定义的差异。从一个网站集移动到另一个网站集，您将丢失基础网站定义并遇到诸如丢失内容类型之类的问题。

站点模板和站点定义是您可以进行的两个单独的自定义。您需要根据您的要求来决定哪个是最好的。

**网站模板**

专业人士：

*   通过 SharePoint 界面轻松创建和重用
*   最终用户的理想选择
*   站点模板是对基础默认站点定义的自定义

缺点：

*   对基础网站定义的依赖意味着 SharePoint 更新可能会破坏您的网站模板
*   性能不佳，因为修改保存在数据库中并从数据库中读取并在每个请求上编译
*   有限的自定义选项

**站点定义**

专业人士：

*   更难创建：涉及编码 XML
*   由开发人员和网站管理员制作
*   独立于 SharePoint 默认网站定义，因此不受 SharePoint 更新的影响
*   无限的定制选项

缺点：

*   部署时难以修改
*   可以缓存在文件系统上，因此加载速度很快

查看[Google](http://www.google.com.au/search?hl=en&rlz=1C1GGLS_en-USAU292AU303&q=sharepoint+2007+create+)以获取有关创建自定义站点定义的信息。

希望这可以帮助！

强尼

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T13:47:55.407

执行此操作的最佳方法是创建一个站点定义，其中内容类型位于范围为场的功能范围内。

蒂姆

# java - Maven 可以收集项目的所有依赖 JAR 以帮助部署应用程序吗？

> ID：567996
> 
> 赞同：55
> 
> 时间：2009-02-20T01:50:37.900
> 
> 标签：java, deployment, maven-2, desktop-application

我刚开始使用[Maven](http://en.wikipedia.org/wiki/Apache_Maven)（真的是在评估它），我需要能够为我的应用程序快速生成一个[JAR](http://en.wikipedia.org/wiki/JAR_file)文件和一个包含所有依赖项（例如 lib）的目录，以便我可以部署这两个以独立的方式运行。使用正确的清单生成 JAR 文件很容易，但我不知道如何让 Maven 将当前项目的依赖项复制到`lib`我可以部署的目录中。

因为这是一个独立的 Java 应用程序，所以我对部署到 Maven 存储库*不*感兴趣，这也相当简单，或者至少很容易在 google 上搜索。

除了将依赖的 JAR 文件复制到某个指定的目录*之外*，我已经发现了如何做所有事情。这是我正在寻找的工作流程：

```
$ mvn clean
$ mvn package
$ cp -r target/{lib,myApp.jar} installLocation 
```

然后，无论我`myApp.jar`的.`installLocation``$CLASSPATH`

尝试抢占一些答案：

*   我确实有一个 Main-class: 设置，它工作正常。
*   我还在 MANIFEST.MF 中设置了类路径，这也很好。
*   我已经找到了如何使用`<classpathPrefix>`和`<classpathMavenRepositoryLayout>`完成这项工作——但仅限于我的机器上。（通过`<classpathPrefix>${settings.localRepository}</classpathPrefix>`：）

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-02-20T04:03:42.747

您要调查的是[Maven 的依赖插件](http://maven.apache.org/plugins/maven-dependency-plugin "Maven 依赖插件")。在 pom.xml 中添加类似于以下内容的内容：

```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-dependency-plugin</artifactId>
    <configuration>
        <outputDirectory>
            ${project.build.directory}
        </outputDirectory>
    </configuration>
</plugin> 
```

然后运行`mvn clean dependency:copy-dependencies`复制执行复制。将此与[程序集插件](http://maven.apache.org/plugins/maven-assembly-plugin/ "Maven 组装插件")结合使用，您可以将所有内容打包到一个自包含的存档中以进行分发。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-02-01T22:32:54.327

我不关心 Shade 插件，因为它将所有 jar 中的所有包滚动在一起。

要包含所有外部库，您可以使用上面提到的依赖插件。

这个例子将在“package”阶段之前在“target/classes”下创建一个“lib”目录。

```
<插件>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-dependency-plugin</artifactId>
  <版本>2.6</版本>
  <执行>
    <执行>
      <id>复制依赖项</id>
      <phase>准备包</phase>
      <目标>
        <goal>复制依赖</goal>
      </目标>
      <配置>
        <outputDirectory>目标/类/lib</outputDirectory>
        <overWriteIfNewer>真</overWriteIfNewer>
        <excludeGroupIds>
          junit,org.hamcrest,org.mockito,org.powermock,${project.groupId}
        </excludeGroupIds>
      </配置>
    </执行>
    <执行>
      <phase>生成源</phase>
      <目标>
        <目标>来源</目标>
      </目标>
    </执行>
  </执行>
  <配置>
    <verbose>真</verbose>
    <detail>真</detail>
    <outputDirectory>${project.build.directory}</outputDirectory>
  </配置>
</插件>

```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-12-16T09:03:46.677

看看 maven 的依赖插件，特别是 copy-dependencies 目标。使用部分描述了如何做你想要的。

要从命令行执行此操作，只需执行以下操作：

```
$ mvn dependency:copy-dependencies -DoutputDirectory=OUTPUT_DIR 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-20T21:44:33.103

还有一个是[appassembler 插件](http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/)
我喜欢它的地方是它以可以使用的形式打包应用程序（使用 .bat 文件等）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-20T02:58:23.247

它肯定可以。您需要使用可以通过添加来完成的[阴影插件](http://maven.apache.org/plugins/maven-shade-plugin/)

```
 <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-shade-plugin</artifactId>
        <version>1.3-SNAPSHOT</version>
        <configuration>
          <!-- put your configurations here -->
        </configuration>
      </plugin> 
```

到你的项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-17T15:05:53.880

使用**maven.repo.local**可以收集所有 jar，但是，它们被收集到具有 maven 层次结构 (.m2) 的目录中。

```
mvn install -Dmaven.repo.local=./pick/some/folder 
```

然后您可以收集它们（在 Linux 上）：

```
mkdir flat-repo
find ./pick/some/folder -type f -name "*.jar" | xargs -I'{}' cp '{}' flat-repo/ 
```

# python - 防止 BeautifulSoup 将我的 XML 标记转换为小写

> ID：567999
> 
> 赞同：10
> 
> 时间：2009-02-20T01:52:26.383
> 
> 标签：python, xml, beautifulsoup

我正在使用 BeautifulStoneSoup 来解析 XML 文档并更改一些属性。我注意到它会自动将所有 XML 标记转换为小写。例如，我的源文件包含`<DocData>`BeautifulSoup 转换为`<docdata>`.

这似乎引起了问题，因为我将修改后的 XML 文档提供给的程序似乎不接受小写版本。有没有办法在 BeautifulSoup 中防止这种行为？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T02:37:40.207

不，这不是内置选项。不过，来源非常简单。看起来您想更改 Tag 中 encodedName 的值。`__str__.`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2020-03-17T10:02:17.143

*   简单的答案
    *   更改（默认`html.parser`）为**xml**解析器
        *   代码：`soup = BeautifulSoup(yourXmlStr, 'xml')`
*   详细说明
    *   在另一篇文章中参考[我的答案](https://stackoverflow.com/questions/891690/can-i-change-beautifulsoups-behavior-regarding-converting-xml-tags-to-lowercase/60719967#60719967)**********