# StackOverflow 问答 000373000-000373999

# ruby - 更好的 ruby markdown 解释器？

> ID：373002
> 
> 赞同：73
> 
> 时间：2008-12-16T22:26:09.533
> 
> 标签：ruby, markdown

我正在尝试找到可以在 rakefile 中使用的降价解释器类/模块。

到目前为止，我已经找到[了 maruku](http://maruku.rubyforge.org/)，但我对 beta 版本有点警惕。

有人对maruku有任何问题吗？或者，您知道更好的选择吗？

* * *

## 回答 #1

> 赞同：314
> 
> 时间：2008-12-17T01:59:36.123

我每天使用 Maruku 处理 100,000 - 200,000 个文档。主要是论坛帖子，但我也将它用于大型文档，如 wiki 页面。Maruku 比 BlueCloth 快得多，并且不会阻塞大型文档。这都是 Ruby，虽然代码不是特别容易扩展和增强，但它是可行的。我们在 Markdown 方言中有一些调整和附加功能。

如果你想要**纯 Ruby**的东西，我绝对推荐 Maruku。

对于那里**最快的选择**，您可能需要 RDiscount。胆量是在 C 中实现的。

另请参阅：Ryan Tomayko 博客上的“[超越 BlueCloth ”。](http://tomayko.com/writings/ruby-markdown-libraries-real-cheap-for-you-two-for-price-of-one)Ryan 的帖子包括以下 100 次降价测试迭代的基准测试：

```
BlueCloth: 13.029987s total time, 00.130300s average
   Maruku: 08.424132s total time, 00.084241s average
RDiscount: 00.082019s total time, 00.000820s average 
```

### 2009 年 8 月更新

BlueCloth2 已发布 ( [http://www.deveiate.org/projects/BlueCloth](http://www.deveiate.org/projects/BlueCloth) ) 它的速度与 RDiscount 相当，因为它基于 RDiscount - 它不是纯 Ruby。

（[谢谢吉姆](https://stackoverflow.com/users/63828/jim-soho)）

### 2009 年 11 月更新

[Kramdown 1.0 刚刚发布](http://kramdown.rubyforge.org/)。我还没有尝试过，但它是一个纯 Ruby Markdown 解析器，声称比 Maruku 快 5 倍。

### 2011 年 4 月更新

自 2010 年 6 月以来，Maruku 没有看到任何提交。您可能希望改为查看 Kramdown。

一个非纯 Ruby 的新快速选项：GitHub 发布了基于 libupskirt 的 Redcarpet：[https ://github.com/blog/832-rolling-out-the-redcarpet](https://github.com/blog/832-rolling-out-the-redcarpet)

### 2013 年 8 月更新

Kramdown 仍然是一个非常健康的项目（基于最近的提交、未解决的问题、拉取请求）并且是纯 Ruby Markdown 引擎的绝佳选择 [https://github.com/gettalong/kramdown](https://github.com/gettalong/kramdown)

对于不需要或想要纯 Ruby 的人来说，Redcarpet 可能仍然是最常用和积极维护的选项。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-01-17T17:22:21.617

[http://ruby-toolbox.com/categories/markup_processors.html](http://ruby-toolbox.com/categories/markup_processors.html)上的列表将是开始寻找的好地方。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-01-17T17:42:43.707

[RDiscount](https://github.com/rtomayko/rdiscount)快速且易于使用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-16T22:37:07.687

试试[RDiscount](http://github.com/rtomayko/rdiscount/tree/master)。BlueCloth 很慢而且有问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-09T22:34:41.120

casey 给出的答案中的基准使用 BlueCloth 1\. BlueCloth 2 这些天是最快的：http: [//www.deveiate.org/projects/BlueCloth](http://www.deveiate.org/projects/BlueCloth)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-16T22:30:08.823

我相信[BlueCloth](http://www.deveiate.org/projects/BlueCloth/)是最突出的一种。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-06-17T03:57:12.377

看起来很多这些答案已经过时了。

到目前为止（2013 年夏季）我在那里发现的最好的东西是 Redcarpet gem：[https ://github.com/vmg/redcarpet](https://github.com/vmg/redcarpet)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-15T07:11:34.180

为确保您获得 BlueCloth 2，请按如下方式安装：

```
gem install bluecloth 
```

请注意，“bluecloth”应该全部小写，而不是驼峰式。

来源：[http ://rubygems.org/gems/bluecloth](http://rubygems.org/gems/bluecloth)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-06T03:54:56.277

如果你需要一个公平的例子来说明如何在 rakefile 中使用 Kramdown 之类的东西，那么 github 上有一个 repo，其中包含 markdown.md 中的代码和文章，可以通过 Ruby 代码语法突出显示但也可以转换为 html。（我宁愿关闭行号）

如果有人知道如何关闭行号默认值，请告诉我们。

无论如何，链接是[https://github.com/elm-city-craftworks/practicing-ruby-manuscripts](https://github.com/elm-city-craftworks/practicing-ruby-manuscripts)

# c++ - MFC编辑框-每次击键多个字符？

> ID：373012
> 
> 赞同：1
> 
> 时间：2008-12-16T22:29:34.690
> 
> 标签：c++, mfc, editcontrol

我正在尝试使用 Visual C++ 在 MFC 中创建一个简单的对话框。我的问题是，当我在屏幕上看到对话框并尝试输入编辑框字段时，如果我输入字母“a”一次，它在编辑框中显示为“aaaaaaaaaaaa”（即 12 a）。此外，如果我尝试使用箭头键在框中导航，克拉一次移动 12 个字符。

这不仅仅是显示错误，因为编辑框的输出仍然是“aaaaaaaaaaaa”。

我会发布代码，但实际上没有可发布的。我使用 Visual Studio 中的工具箱添加了编辑框，并在我的类中为其分配了一个变量，因此这不是任何类型的特殊编辑框。

如果有人对可能发生的事情有任何想法，将不胜感激。不幸的是，我不知道从哪里开始。

一如既往地感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-08T00:37:33.360

要对此进行调试，请将 PreTranslateMessage 函数添加到您的对话框中，并准确查看 keydown 被处理了多少次。

```
BOOL DialogName::PreTranslateMessage(MSG* pMsg)
{

    if(pMsg->message==WM_KEYDOWN)
    {
        // TODO: see what is going on here
        return TRUE; //do not dispatch this message, so keydown will have no effect
    }

    return CDialog::PreTranslateMessage(pMsg);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T21:01:50.173

出于某种原因，这让人们想起了早期与 MFC 斗争的模糊记忆。你有没有寻找过相互递归？我*永远*在应用程序的某个位中做某事，该应用程序发送了一条消息（我不知道），该消息被称为第一种方法的另一种方法接收...

我的猜测是，它是那些打额头的人之一。它给了我一种我无法具体化的似曾相识的唠叨感。

如果是相互递归，你应该能够在调用堆栈中看到它，如果你能找到合适的断点位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T23:29:43.840

您是否在 PreTranslateMessage() 函数或应用程序的其他任何地方捕获任何事件，例如 WM_KEYUP？

如果您覆盖了键盘事件的默认处理，它可能会导致您看到的症状。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-05T16:05:20.070

这是否发生在新项目中，或者您可以在新项目中重新创建此问题？这将有助于辨别它是您在代码中完成的，还是您的安装。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-29T13:45:21.270

我在我的 WinXp 64 操作系统中安装了 service pack 2，我的问题得到了解决:)

# ssms - SQL Studio - “修改存储过程”脚本错误

> ID：373015
> 
> 赞同：1
> 
> 时间：2008-12-16T22:30:48.573
> 
> 标签：ssms

在 MS SQL Server Management Studio 2005 中：

如果您将工具|选项|脚本|“包含 IF NOT EXISTS 子句”设置为 true，则修改存储过程将创建一个甚至无法正常工作的奇怪脚本。它看起来像下面这样：（省略号用于简洁）

```
 SET QUOTED_IDENTIFIER ON
 GO
 IF NOT EXISTS [...]
 BEGIN
 EXEC dbo.sp_executesql @statement = N'
 ALTER procedure [dbo].[p_Procedure]
 [...]
 '
 END 
```

这显然不起作用，因为调用 ALTER 语句的唯一方法是存储过程不存在。

因此问题是：**有没有办法改变这个生成的代码**？某个地方的模板（这似乎与模板工具中的构建无关）？

（对此行为的轻微解释：编写 CREATE 语句的脚本会生成相同的代码，其中 IF NOT EXISTS 更有意义）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T23:15:02.493

MS-feedback 网站上有一些关于此主题的问题。这里有一个：

[https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=260519](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=260519)

以下是对该问题的一条评论（来自上面链接的页面底部）：

> 在 SQL2000 中，方法是如果存在，则 DROP 后跟 CREATE。这完美无瑕，涵盖了所有情况。它非常好，以至于我们在这个脚本模型的基础上构建了我们的部署。自从 SQl2005 进入我们的世界以来，我们已经有了手动的、繁琐的变通方法来替换在迁移到 SQL2000 过程中丢失的自动脚本。
> 
> 请务必阅读 If exists, DROP 后跟 CREATE approac。这条路很棒

# mysql - 在 MySQL 中对大表（>10.000.000 行）中的列进行通配符搜索

> ID：373017
> 
> 赞同：2
> 
> 时间：2008-12-16T22:32:40.363
> 
> 标签：mysql, search, wildcard

您将使用哪些技术来实现对 MySql 中一个非常大的表的列中的内容的搜索？例如，假设您有 10.000.000 封电子邮件存储在数据库的一个表中，并且想要实现主题搜索，这将使我能够搜索电子邮件主题中存在的一个或多个单词。如果用户搜索“圣诞圣诞老人”，您应该会找到一封电子邮件，其中包含“圣诞老人今年圣诞节拜访我们”和“圣诞节，圣诞老人将永远出现”等主题。

我的想法是处理主题中的所有单词（去除所有数字、特殊符号、逗号等）并将每个单词保存在索引表中，其中我在单词列上有一个唯一索引。然后我会通过多对多关系表将其链接到电子邮件表。

有没有更好的方法在非常大的表上执行通配符搜索？

是否有数据库本身支持这种搜索？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-16T22:44:00.167

如果您使用 MyISAM 作为存储引擎，则可以使用 FULLTEXT 索引。但是，一般来说，MySQL 对文本搜索不是很好。

更好的选择是使用专用的文本索引解决方案，例如[Lucene](http://lucene.apache.org/java/docs/)或[Sphinx](http://www.sphinxsearch.com/)。我个人推荐 Sphinx - 它与 PHP 和 MySQL 有很好的集成，并且非常非常快（甚至可以用来加速普通查询 - 执行非常快速的分组和排序）。

维基百科有一个很好的不同索引引擎列表 -[这里](http://en.wikipedia.org/wiki/Free_text_search#Text_retrieval_software)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T22:40:19.410

MySQL 的 MyISAM 表支持[`FULLTEXT`](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)索引，这有助于这种搜索。

但这并不是用于此类搜索的最快技术。而且你不能对存储在 InnoDB 表中的数据使用它。

我听说过一些关于[Sphinx Search](http://www.sphinxsearch.com/)的好消息，但我还没有使用它。

这是另一个关于狮身人面像的博客：http: [//capttofu.livejournal.com/13037.html](http://capttofu.livejournal.com/13037.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-18T03:20:40.420

虽然 mysql 全文索引是可能的，但我怀疑我会考虑使用设计为像[Lucene](http://lucene.apache.org/java/docs/)这样的搜索引擎的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T22:35:20.170

这听起来像是 SQL Server 支持的全文搜索。

但是您的想法通常是合理的。您正在有效地提前计算表上的“索引”以加快搜索速度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T22:36:07.360

检查MySQL 文档中的“[全文搜索”（AFAIK，所有当前的 DBMS 都支持这个）](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-16T22:41:45.493

你想看看`MATCH...AGAINST`函数。

参见，例如：[使用 MySQL 全文搜索](http://devzone.zend.com/node/view/id/1304)

# asp.net-mvc - ASP.NET MVC 中的 Windows Live ID

> ID：373018
> 
> 赞同：5
> 
> 时间：2008-12-16T22:32:50.423
> 
> 标签：asp.net-mvc, authentication, windows-live-id, windows-live

有人知道有没有办法在您的 ASP.NET MVC 站点中实现 Windows Live ID 身份验证。有一些关于 OpenID 实现的信息，它使用了一些库。那么有没有办法实现 Live ID 或尚不支持。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T23:30:22.040

与会员资格相同： [http ://www.eggheadcafe.com/tutorials/aspnet/48857836-0c72-4efb-9d29-fbcb8e17ef3a/integrate-windows-live-id.aspx](http://www.eggheadcafe.com/tutorials/aspnet/48857836-0c72-4efb-9d29-fbcb8e17ef3a/integrate-windows-live-id.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-23T06:21:26.553

实际上这是一个有效的商业案例，我已经让它与 asp.net mvc 一起使用。我使用了 Filip 发布的 sdk 示例代码，并创建了一个处理身份验证响应的控制器。我遇到的唯一问题是在 Windows Live 应用程序验证过程中。我无法让验证过程与 mvc 站点一起使用。在上传网站之前，我必须进行验证。见：[链接文字](http://forums.asp.net/t/1623751.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-03T01:21:31.933

更新信息在

我认为它完全独立于 mvc 或 webforms。

Windows Live Messenger Connect 开发人员指南 [http://msdn.microsoft.com/en-us/library/hh243641.aspx](http://msdn.microsoft.com/en-us/library/hh243641.aspx)

# python - 使用 Python 在 Mac OS X 中查找当前活动窗口

> ID：373020
> 
> 赞同：25
> 
> 时间：2008-12-16T22:33:02.513
> 
> 标签：python, objective-c, cocoa, macos

有没有办法在 Mac OS X 上使用 Python 在给定时间查找当前活动窗口的应用程序名称？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-17T00:44:22.220

这应该有效：

```
#!/usr/bin/python

from AppKit import NSWorkspace
activeAppName = NSWorkspace.sharedWorkspace().activeApplication()['NSApplicationName']
print activeAppName 
```

仅适用于 Leopard 或 Tiger 如果您安装了 PyObjC 并且恰好在第一行指向正确的 python 二进制文件（如果您安装了通用 MacPython 则不是这种情况，您可能想在 Tiger 上执行此操作）。但是 Peter 对 Carbon 方法的回答可能会快很多，因为在 Python 中从 AppKit 导入任何东西需要一段时间，或者更准确地说，在 Python 进程中第一次从 AppKit 导入一些东西需要一段时间。

如果您在 PyObjC 应用程序中需要它，我所描述的将工作得很好而且很快，因为您只体验一次导入 AppKit 的延迟。如果您需要它作为命令行工具工作，您会注意到性能下降。如果这与您相关，您最好使用 Peter 的代码作为起点，在 Xcode 中构建一个 10 行的 Foundation 命令行工具。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2014-08-09T00:20:52.200

已接受答案中的方法在 OS X 10.7+ 中已弃用。当前推荐的版本如下：

```
from AppKit import NSWorkspace
active_app_name = NSWorkspace.sharedWorkspace().frontmostApplication().localizedName()
print(active_app_name) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-16T23:52:06.147

首先，您想要窗口还是应用程序名称？这不是 Windows——Mac OS X 上的一个应用程序进程可以有多个窗口。（此外，Windows 几年来也是如此，尽管我不知道 API 是什么样子的。）

第二，碳还是可可？

要在 Cocoa 中获取活动窗口：

```
window = NSApp.mainWindow() 
```

要在 Cocoa 中获取进程的名称：

```
appName = NSProcessInfo.processInfo().processName() 
```

**编辑：**哦，我想我知道你想要什么。最前面的进程的名称，对吧？

我认为在 Cocoa 中没有办法做到这一点，但这里是如何在 C 中的 Carbon 中做到这一点：

```
ProcessSerialNumber psn = { 0L, 0L };
OSStatus err = GetFrontProcess(&psn);
/*error check*/

CFStringRef processName = NULL;
err = CopyProcessName(&psn, &processName);
/*error check*/ 
```

完成后请记住`CFRelease(processName)`。

我不确定这在 Python 中会是什么样子，或者是否有可能。Python 没有指针，这很棘手。

我知道 PyObjC 会将后一个参数转换为`CopyProcessName`into `err, processName = CopyProcessName(…)`，但是 Carbon 绑定不依赖于 PyObjC （它们是核心 Python 2 的一部分），而且我不确定你对 PSN 做了什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-03T20:04:07.227

我需要一个 Python 脚本中的当前最前面的应用程序，它可以很好地在我的屏幕上排列窗口（请参阅 参考资料[`move_window`](https://github.com/SirVer/move_window)）。

当然，完全归功于彼得！但这是完整的程序：

```
#include <Carbon/Carbon.h>

int main(int, char) {
    ProcessSerialNumber psn = { 0L, 0L };
    OSStatus err = GetFrontProcess(&psn);

    CFStringRef processName = NULL;
    err = CopyProcessName(&psn, &processName);
    printf("%s\n", CFStringGetCStringPtr(processName, NULL));
    CFRelease(processName);
} 
```

构建`gcc -framework Carbon filename.c`

# .net - 无法获取数据做 Gridview

> ID：373022
> 
> 赞同：0
> 
> 时间：2008-12-16T22:33:41.750
> 
> 标签：.net, asp.net, vb.net

我正在尝试将数据集检索到 Gridview，但我的 Gridview 中没有任何行。我究竟做错了什么？

页面代码

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    CType(Master, AreaTrabalho).AlteraTitulo = "Projectos"

    Using oSQL As New clsSQL(System.Configuration.ConfigurationManager.AppSettings("ConnectionString1"))
        If oSQL.OpenConnection Then
            oSQL.ToDataGrid(Me.GridView1, "Select * from users")
        End If
    End Using
End Sub 
```

用于获取数据的类函数

```
Public Function ToDataGrid(ByVal oDataGrid As GridView, _
                           ByVal sQuery As String, _
                  Optional ByVal sTable As String = "") As Boolean
    Try

        Dim objDataSet As New Data.DataSet
        'Preenche o dataset
        objDataSet = ToDataSet(sQuery, sTable)

        oDataGrid.DataSource = objDataSet.Tables(0)

        objDataSet.Dispose()
        objDataSet = Nothing

        Return True
    Catch ex As Exception
        RaiseEvent OnError("ToDataGrid", ex)
    End Try
End Function

Public Function ToDataSet(ByVal sQuery As String, Optional ByVal sTable As String = "") As Data.DataSet
    Try

        m_objCommand = New SqlCommand(sQuery, m_objConnection)

        Dim objDataSet As New Data.DataSet
        Dim objSqlDataAdapter As SqlDataAdapter = New SqlDataAdapter(m_objCommand)

        'Verifica se foi defenido a tabela
        If sTable = "" Then
            objSqlDataAdapter.Fill(objDataSet)
        Else
            objSqlDataAdapter.Fill(objDataSet, sTable)
        End If

        objSqlDataAdapter.Dispose()
        objSqlDataAdapter = Nothing

        Return objDataSet
    Catch ex As Exception
        RaiseEvent OnError("ToDataSet", ex)
        Return Nothing
    End Try
End Function 
```

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T22:42:48.517

在 ToDataGrid 方法中设置数据源后，您没有在 GridView 上调用[Databind方法：](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datagrid.databind.aspx)

```
oDataGrid.DataBind() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T22:43:01.013

我假设这是一个 webforms 应用程序，如果是这种情况，您需要`GridView.DataBind()`在设置数据源以将数据绑定到网格后调用。

# php - FastCGI: comm with server 是什么意思？

> ID：373027
> 
> 赞同：1
> 
> 时间：2008-12-16T22:34:21.263
> 
> 标签：php, apache, fastcgi

我在 PHP (Drupal) 应用程序中收到此错误：

```
(104)Connection reset by peer: FastCGI: comm with server "/opt/php-5.2.5/bin/php-cgi" aborted: read failed 
```

经常会出现这个错误：

```
FastCGI: incomplete headers (0 bytes) received from server "/opt/php-5.2.5/bin/php-cgi" 
```

PHP 的基本 Apache 配置如下所示：

```
 FastCgiServer /opt/php-5.2.5/bin/php-cgi -initial-env PHP_FCGI_CHILDREN=32
   ScriptAlias /fcgi-bin/php-5.2.5 /opt/php-5.2.5/bin/php-cgi
   <Location /fcgi-bin/php-5.2.5>
     Options +ExecCGI
     SetHandler fastcgi-script
     SetOutputFilter INCLUDES
   </Location>
   # send php5.2-fastcgi handler to our scriptalias
   Action php-5.2.5-fastcgi /fcgi-bin/php-5.2.5 
```

现在，我的基本问题是，“与服务器通信”错误的一般原因是什么？在这种特殊情况下，错误会间歇性出现，但某些页面比其他页面更频繁地生成它。我想知道在调试我的代码时要寻找什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-18T22:27:18.470

在这个特定的问题中，它与我的代码中的一个奇怪的错误有关......似乎某些类型的错误会导致 FastCGI 严重失败，以至于它不会转发底层的 PHP 代码错误。抱歉，对于那些从 Google 访问的人，我没有更多详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T23:33:20.897

你用的是什么字符集？我读到如果他们的应用程序使用不同的字符集，有些人会遇到问题。

看看[这个](http://isearchthenet.com/forums/viewtopic.php?t=622&sid=a5628d8d15d84d5722819264622fd8fc)

抱歉，我找不到更好的结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-21T12:02:02.233

有时它会有所帮助。 `output.buffering = 1`进入你的 php.ini 文件

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-28T21:14:50.043

以上都没有解决我的特定问题，这里有一个很好的[答案](https://stackoverflow.com/questions/18009479/random-php-fastcgi-connection-reset-by-peer-incomplete-headers)！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-12-21T03:34:10.630

我遇到了同样的问题，但是在 python 中，我解决了将脚本的扩展名更改为 .py

```
#.htaccess file
AddHandler fastcgi-script .py 
```

# sql-server - 在 SQL Server 中应彻底评估哪些设置？

> ID：373028
> 
> 赞同：3
> 
> 时间：2008-12-16T22:34:45.147
> 
> 标签：sql-server, sql-server-2005, installation, settings

我无论如何都不是 DBA，但作为 Web 开发人员意味着我必须安装、设置和管理数据库。过去，我只是按照 SQL Server 的默认安装。随着时间的推移，我变得越来越聪明，并且了解到默认安装几乎总是让门打开和泄漏。

那么...**在为我这样的人才安装 SQL Server 2005 时，应该彻底评估哪些关键设置？还是 2008 年？**还是每个设置都“关键”？

有什么好的资源可以指导 SQL Server 2005 的“正确”设置吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T22:42:45.723

每个设置都很关键 - 但我总是仔细检查的是：

1.  身份验证类型 - 集成还是 SQL？如果是 SQL，请确保您输入了一个非常强大的 sa 密码。

2.  服务帐户 - 考虑您想要的帐户。我通常为每个服务分别创建一个域用户，并以最少的权限运行它们。

3.  数据库路径。预先确定您想要系统数据库和用户数据库的位置 - 在安装期间执行此操作比事后决定要容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T22:55:43.967

虽然这在 64 位中已经基本消失，但如果 SQL 是唯一在服务器上运行并且它是 32 位的，我总是确保启用“AWE”。通过这种方式，SQL Server 可以访问服务器拥有的所有内存（在 4GB 服务器中最多 3GB），而不是被限制为正常的 2GB。

我赞同它们都很重要的观点，它们都有不同的目的，所以这是你的环境问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T00:04:39.180

可以使用默认设置接受大多数设置。默认情况下，SQL 2005 已更改为更安全。

请务必按照步骤**准备要使用的帐户**。

您还可以查看您的服务器硬件并尝试将**操作系统、SQL 二进制文件、数据和日志分开到单独的驱动器上**。

[http://msdn.microsoft.com/en-us/library/ms143516.aspx](http://msdn.microsoft.com/en-us/library/ms143516.aspx) - 了解所有有趣的细节。

安装后，您应该设置 dbmail，然后设置维护计划，在备份或维护失败时**通知**您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T00:24:54.677

Books on Line 和其他地方的 Microsoft 文档非常全面和准确。我认为这是微软做的最好的文档。因此，在我在这里写任何东西之前，我会对“RTM”保持严格的态度，相比之下，在任何情况下，这都是不完整的，也没有得到充分的解释。

也就是说，首要任务应该是不伤害。我见过更多不完全理解更改设置的后果导致问题的情况，而不是需要更改默认设置。（注意：这个建议*不适*用于 MySQL，它的默认值是相当随机的恕我直言。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T00:30:35.880

驱动配置！就性能而言，将日志和数据库文件放在哪里绝对是最重要的

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T00:36:45.073

我要检查的第一个设置是服务器的排序规则。这将控制系统数据库的排序规则，并且您应该确保新服务器的排序规则与旧服务器的排序规则相同以避免排序规则错误。理想情况下，您的用户数据库将是相同的排序规则。

如果这两个排序规则不同，并且您将 TempDB 中的 varchar 数据与用户数据库中的 varchar 数据进行比较，则需要指定排序规则。

几乎所有其他设置都可以稍后更改，但服务器排序规则是您坚持使用的设置。（从技术上讲，您可以使用新的排序规则重建系统数据库，但这不值得，并且仍然需要您再次运行安装程序）。

# php - 如何使用 Zend Framework 正确创建域？

> ID：373054
> 
> 赞同：9
> 
> 时间：2008-12-16T22:46:29.413
> 
> 标签：php, zend-framework

不久前我问过[这个问题](https://stackoverflow.com/questions/197939/difference-between-data-access-layer-and-model-in-mvc)，但现在我希望在我的数据库访问层和域层之间实现实际的分离。我还将努力将业务逻辑移入它所属的域并移出控制器脚本。

我正在使用 Zend 框架，它为数据访问层实现了表数据网关和行数据网关模式，但它显然未能真正定义如何构建与数据访问层分离的域层。我考虑过使用域逻辑与数据访问逻辑共存的 Active Record 模式，但我有以下情况至少发生一次，我认为 Active Record 无法处理：

我有一个包含 person_id 和 userType 字段的表“Person”。

每个 userType（admin、buyer、associate、supervisor）都有与之关联的特定业务逻辑，并且所有类型都从 Person 对象继承了一些基本功能。

我不想用仅属于一种用户类型的业务逻辑来膨胀 Row Data Gateway 对象，但我不确定如何构造域层来表示不同类型的用户。例如，我是创建一个包含 PersonGateway 对象的 Person 对象，然后编写将调用传递给网关对象的包装函数，还是编写 Person 对象来扩展 PersonGateway 对象，然后只实现我需要的特定功能？

同样，我通常认为这（部分）是一个工厂问题，我需要一个工厂方法来实例化基于 userType 的正确子类。这仍然是 Zend Framework 的 Zend_Db 类的最佳方法吗？

任何有关如何在 Zend_Db 之上正确创建域模型的建议或教程链接将不胜感激。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-16T23:02:19.773

领域模型不扩展任何东西。它们只是用于封装业务逻辑的普通类。它们可能*使用*数据访问对象，因此类中可能存在`protected`行数据网关对象的实例。对象通常`Row`比对象更接近地表示域的实例`Table`。此外，您始终可以使用'方法获取`Table`对象。`Row``getTable()`

通常 DM 类有一个接口，其中的方法对应于您可以对该类执行的更高级别的操作。但是您不一定要显示所有数据访问操作。

```
class Person {
  // Zend_Db_Table_Row object
  protected $data; 

  public function subscribeToService(Service $service) { ... }

  public function sendMailTo(Person $recipient) { ... }

  public function changePassword($newPassword) { ... }
} 
```

[去年春天](http://karwin.blogspot.com/2008/05/activerecord-does-not-suck.html)我也写了一篇关于这个主题的博客，[最近](http://www.nabble.com/Re%3A-Newbie-quesiton---How-do-queries-that-join-multiple-tables-fit-into-the-model-in-the-MVC-p20962082.html)在 ZF 邮件列表上写了一篇关于它的文章。

至于教程和资源，请尝试[http://domaindrivendesign.org/](http://domaindrivendesign.org/)

# sql-server-2005 - SqlBulkInsert - 如何设置火触发器，检查约束？

> ID：373057
> 
> 赞同：16
> 
> 时间：2008-12-16T22:49:38.487
> 
> 标签：sql-server-2005, ado.net, sqlbulkcopy

我正在使用具有有限权限的数据库用户将 ADO.NET 2.0 SqlBulkCopy 对象从 C# 方法批量插入到 MS SQL 2005 数据库中。当我尝试运行该操作时，我收到错误消息：

> 批量复制失败。用户对表 'theTable' 没有 ALTER TABLE 权限。`'FIRE_TRIGGERS'`如果表具有触发器或 检查约束，但未`'CHECK_CONSTRAINTS'`将批量提示指定为批量复制命令的选项，则需要对批量复制操作的目标表具有 ALTER TABLE 权限。

我阅读了一些文档并使用构造函数创建了大容量复制对象，该构造函数允许我指定此类内容：

```
 SqlBulkCopy bc = new SqlBulkCopy(
        System.Configuration.ConfigurationSettings.AppSettings["ConnectionString"],
        SqlBulkCopyOptions.FireTriggers & SqlBulkCopyOptions.CheckConstraints); 
```

但这并没有改变任何东西 - 我收到与以前相同的错误消息。我尝试摆弄其他一些 SqlBulkCopyOptions 值，但没有运气。我真的认为这会解决问题，我错过了什么吗？

在将表上的 ALTER 授予我的用户后，我测试了该过程，并且操作成功。但是，这不是我的情况的选择。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-17T14:28:14.910

解决了！看起来我需要对标志枚举进行复习。当我应该对它们进行 ORing 时，我正在对枚举值进行按位与运算。

```
SqlBulkCopyOptions.FireTriggers & SqlBulkCopyOptions.CheckConstraints 
```

计算结果为零（相当于 SqlBulkCopyOptions.Default。）

```
SqlBulkCopyOptions.FireTriggers | SqlBulkCopyOptions.CheckConstraints 
```

工作正常并允许批量插入完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T08:18:12.490

仅此而已，对不起

[BULK INSERT](http://msdn.microsoft.com/en-us/library/ms188365(SQL.90).aspx)的 SQL 文档指定了需要 ALTER TABLE 的 3 种情况。你列出了其中的 2 个。是否设置了 KeepIdentity 选项，即使不需要？

另一种选择是表上的触发器已经被禁用，这使问题变得混乱。用于`ALTER TABLE dbo.SomeTable ENABLE TRIGGER ALL`确保启用。

# c# - 在 C# 中实现只读（不可变）对象接口

> ID：373064
> 
> 赞同：4
> 
> 时间：2008-12-16T22:52:30.057
> 
> 标签：c#, interface, abstract-class, immutability, readonly

我的目标是确保在大多数情况下，对象是通过作为完整接口子集的“只读接口”使用的。

*   例如，如果我使用 C++，我将只返回一个`const`对象。
*   在 C# 中，如果我可以通过接口实现这一点，我只会实现一个只读接口并在任何地方使用它。但是，我需要运算符重载，这对于接口是不允许的。这就是为什么我必须使用抽象基类。
*   但是如果我定义了一个抽象基类，我就不能改变派生类型的可访问性。

那么，如何在 C# 中实现我的目标？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T23:20:15.773

如果你把你的写操作放在一个接口中，然后在抽象基类上显式地实现呢？这不是一个 100% 完美的解决方案（您仍然可以将对象强制转换为修改接口），但在大多数情况下，它可以防止任何人意外调用修改方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-16T23:50:18.613

Do you really *need* operator overloading? We are talking about syntactic sugar here. Also, not all .NET languages utilize operator overloading in the same way. So, if you use operator overloading, you are effectively making your code language-specific.

I would implement the read-only interface and drop the operator overloading requirement.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-16T23:14:00.857

您可以通过对象中的状态实现只读行为，并在调用修改方法时抛出异常？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T01:03:57.373

如果有人对我所做的事情感兴趣，我最终选择了一个抽象类而不是接口，并且我确实将方法隐藏在派生类中以获得正确的访问器：

就像，在基础抽象类（只读接口）中：

```
protected double accuracy;
public double Accuracy { get { return accuracy; } } 
```

在派生类中：

```
public new double Accuracy
{
    get { return accuracy; }
    set { accuracy = value; }
} 
```

当然，“new”关键字很难看，但在这种情况下它会为我做。

# python - 列出当前存在的所有类

> ID：373067
> 
> 赞同：2
> 
> 时间：2008-12-16T22:53:42.957
> 
> 标签：python

我正在创建一个简单的 API，它基于 JSON 数据创建类型化类，其中定义了一个强制的“类型”字段。它使用此字符串定义新类型，在 JSON 对象中添加字段，对其进行实例化，然后在实例上填充字段。

我想要做的是允许在使用我的模块的任何应用程序中选择性地预定义这些类型。这样就可以添加在 JSON 对象中找不到的方法和其他特定于应用程序的属性。我想让我的模块检查类型是否已经存在，如果存在，请使用它而不是动态创建类型。它仍会从 JSON 对象添加属性，但会回收现有类型。

我的 JSON 数据是：

```
{
    "type": "Person",
    "firstName": "John",
    "lastName": "Smith",
    "address": {
        "streetAddress": "21 2nd Street",
        "city": "New York",
        "state": "NY",
        "postalCode": 10021
    },
    "phoneNumbers": [
        "212 555-1234",
        "646 555-4567"
    ]
} 
```

到目前为止我的代码（假设 json_object 在这一点上是一个字典）：

```
if not json_object.has_key('type'):
    raise TypeError('JSON stream is missing a "type" attribute.')

##### THIS IS WHERE I WANT TO CHECK IF THE TYPE BY THAT NAME EXISTS ALREADY ####
# create a type definition and add attributes to it
definition = type(json_object['type'], (object,), {})
for key in json_object.keys():
    setattr(definition, key, None)

# instantiate and populate a test object
tester = definition()
for key, value in json_object.iteritems():
    setattr(tester, key, value) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-16T23:06:13.430

如果您想重用之前创建的类型，最好自己缓存它们：

```
json_types = {}
def get_json_type(name):
  try:
    return json_types[name]
  except KeyError:
    json_types[name] = t = type(json_object['type'], (object,), {})
    # any further initialization of t here
    return t

definition = get_json_type(json_object['type'])
tester = definition()
# or: tester = get_json_type(json_object['type'])() 
```

如果要将它们添加到模块命名空间，请执行

```
json_types = globals() 
```

反而。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T23:12:58.860

您可以使用`dir()`来获取当前环境中所有对象的所有名称的列表，并且可以使用`globals()`来获取将这些名称映射到它们的值的字典。因此，要获取属于类的对象列表，您可以执行以下操作：

```
import types
listOfClasses = [cls for cls in globals().values() if type(cls) == types.ClassType] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T22:57:15.383

您可以使用`dir()`：

```
Python 2.5.2 (r252:60911, Oct  5 2008, 19:29:17)
[GCC 4.3.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> dir()
['__builtins__', '__doc__', '__name__']
>>> class Foo:
...     pass
...
>>> dir()
['Foo', '__builtins__', '__doc__', '__name__']
>>> type(eval('Foo'))
<type 'classobj'> 
```

# security - 关于 IE 安全问题，您对 Web 用户社区有什么建议？

> ID：373071
> 
> 赞同：3
> 
> 时间：2008-12-16T22:55:49.567
> 
> 标签：security, internet-explorer

也许不是直接与编程相关，但绝对与产品/商业相关。而且我找不到骗子，所以我想我会问。

我在试图找出最好对那些打电话征求意见的人说些什么时遇到了一些麻烦。微软的消息有点令人担忧——基本上，要担心，把所有东西都锁起来，紧紧抓住。我指导的一些人反对这条路线，因为它对他们的浏览体验有什么影响。

“go get Firefox”消息似乎要好一些了。真实的故事是什么，最好的建议是什么？

从现在到 MS 修补它时，它会带来多少实际风险？

编辑：这是我的社区似乎正在阅读的链接...... [WSJ](http://voices.washingtonpost.com/securityfix/2008/12/microsoft_big_security_hole_in.html?nav=rss_blog) [NP](http://network.nationalpost.com/np/blogs/posted/archive/2008/12/16/gaping-security-hole-found-in-internet-explorer-browsing-software.aspx) [BBC](http://news.bbc.co.uk/2/hi/technology/7784908.stm)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-16T22:57:13.637

[切换](http://www.google.com/chrome)到[另一个](http://www.mozilla.com/en-US/firefox/) [浏览器](http://www.opera.com/)，[已经](http://www.apple.com/safari/)。

[Chrome](http://www.google.com/chrome)和[Firefox](http://www.mozilla.com/en-US/firefox/)将是我的前两个选择。Firefox 目前可能是最好的，因为它的历史更长。

在 IE 上防止这种情况的唯一方法是遵循[微软的变通程序](http://www.microsoft.com/technet/security/advisory/961051.mspx)，这会给用户带来巨大的头痛。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T23:29:00.140

*   使用**火狐**
*   使用**NoSript**（如果您想要适当的深度防御）。我可以简单地说 95% 以上的客户端漏洞利用需要 JavaScript，并且 90% 的时间是从 3rd 方网站加载的。因此切换 FF 并使用 NoScript 是一个非常好的解决方案。

> 从现在到 MS 修补它时，它会带来多少实际风险？

如果你看一下 IE 中的 0days，就会有很多，而且 IE 的安全性最差。它也是攻击者最具针对性的应用程序之一，因为它有明显的利润。因此使用 IE 一般不是一个好主意。

如果你必须使用 IE，

*   使用保护模式
*   使用最新的稳定版本
*   保持你的窗户更新
*   以最小特权用户身份运行它
*   使用过程控制和个人防火墙应用程序，例如 Comodo Firewall（过程控制应用程序，如果你能正确使用它们可以解决许多这些问题，但会给用户带来巨大的开销）

以前的IE问题的详细信息，有很多！

*   [http://secunia.com/advisories/product/11/?task=advisories](http://secunia.com/advisories/product/11/?task=advisories) (IE 6)
*   [http://secunia.com/advisories/product/12366/?task=advisories](http://secunia.com/advisories/product/12366/?task=advisories) (IE 7)

您可以通过遵循一些变通办法来通知他们进行修补，但正如您注意到的那样，从长远来看它不会保存它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T23:38:15.550

除了切换浏览器，注意[紧急补丁](http://www.computerworld.com/action/article.do?command=viewArticleBasic&articleId=9123612&source=NLT_PM)——安装它。

# algorithm - 当 BOM（字节顺序标记）丢失时，如何最好地猜测编码？

> ID：373081
> 
> 赞同：29
> 
> 时间：2008-12-16T22:59:25.643
> 
> 标签：algorithm, delphi, encoding, delphi-2009, byte-order-mark

我的程序必须读取使用各种编码的文件。它们可能是 ANSI、UTF-8 或 UTF-16（大端或小端）。

当 BOM（字节顺序标记）在那里时，我没有问题。我知道文件是 UTF-8 还是 UTF-16 BE 或 LE。

我想假设当没有 BOM 文件是 ANSI 时。但我发现我正在处理的文件经常缺少它们的 BOM。因此，没有 BOM 可能意味着文件是 ANSI、UTF-8、UTF-16 BE 或 LE。

当文件没有 BOM 时，扫描某些文件并最准确地猜测编码类型的最佳方法是什么？如果文件是 ANSI，我希望接近 100% 的时间，如果文件是 UTF 格式，我希望接近 100%。

我正在寻找一种通用的算法方法来确定这一点。但我实际上使用的是 Delphi 2009，它知道 Unicode 并且有一个 TEncoding 类，所以特定的东西将是一个奖励。

* * *

回答：

ShreevatsaR 的回答让我在 Google 上搜索“通用编码检测器 delphi”，这让我感到惊讶的是，这篇文章在仅存活了大约 45 分钟后就被列为第一名！那是快速的googlebotting！Stackoverflow 如此迅速地获得第一名也令人惊讶。

Google 中的第二篇文章是 Fred Eaker 撰写的关于[字符编码检测](http://fredeaker.blogspot.com/2007/01/character-encoding-detection.html)的博客文章，其中列出了各种语言的算法。

我在那个页面上发现了 Delphi，它直接把我带到[了 SourceForge 的 Free OpenSource ChsDet Charset Detector，](http://chsdet.sourceforge.net/)它是用 Delphi 编写的，基于 Mozilla 的 i18n 组件。

极好的！感谢所有回答的人（全部 +1），感谢 ShreevatsaR，再次感谢 Stackoverflow，帮助我在不到一个小时的时间内找到答案！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-16T23:36:44.057

Maybe you can shell out to a Python script that uses [Chardet: Universal Encoding Detector](http://chardet.feedparser.org/). It is a reimplementation of the character encoding detection that used by Firefox, and is used by [many different applications](http://diveintomark.org/archives/2008/03/05/upstream). Useful links: [Mozilla's code](http://mxr.mozilla.org/seamonkey/source/extensions/universalchardet/src/base/), [research paper](http://www.mozilla.org/projects/intl/UniversalCharsetDetection.html) it was based on (ironically, my Firefox fails to correctly detect the encoding of that page), [short explanation](http://chardet.feedparser.org/docs/faq.html#faq.impossible), [detailed explanation](http://chardet.feedparser.org/docs/how-it-works.html).

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-16T23:13:36.660

这是[记事本如何做到的](http://www.siao2.com/2007/04/22/2239345.aspx)

您还可以检查[python 通用编码检测器。](http://chardet.feedparser.org/docs/faq.html#faq.what)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-16T23:11:08.710

我的猜测是：

*   首先，检查文件的字节值是否小于 32（制表符/换行符除外）。如果是，则不能是 ANSI 或 UTF-8。因此 - UTF-16。只需要弄清楚字节序。为此，您可能应该使用一些有效的 Unicode 字符代码表。如果遇到无效代码，请尝试其他适合的字节序。如果适合（或不适合），请检查哪个具有较大百分比的字母数字代码。您也可以尝试搜索换行符并从中确定字节顺序。除此之外，我不知道如何检查字节顺序。
*   如果文件不包含小于 32 的值（除了上述空格），它可能是 ANSI 或 UTF-8。尝试将其解析为 UTF-8 并查看是否有任何无效的 Unicode 字符。如果你这样做，它可能是 ANSI。
*   如果您希望文档采用非英语单字节或多字节非 Unicode 编码，那么您就不走运了。您可以做的最好的事情是像 Internet Explorer 这样的东西，它制作字符值的直方图并将其与已知语言的直方图进行比较。它经常工作，但有时也会失败。而且您必须为每种语言拥有一个庞大的字母直方图库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-16T23:10:07.633

ASCII？现代操作系统不再使用 ASCII。它们至少都使用 8 位代码，这意味着它可以是 UTF-8、ISOLatinX、WinLatinX、MacRoman、Shift-JIS 或其他任何代码。

我知道的唯一测试是检查无效的 UTF-8 字符。如果你找到了，那么你就知道它不可能是 UTF-8。UTF-16 可能也是如此。但是当它没有设置 Unicode 时，就很难判断它可能是哪个 Windows 代码页。

我认识的大多数编辑器通过让用户从所有可能的编码列表中选择一个默认值来处理这个问题。

那里有用于检查 UTF 字符有效性的代码。

# sql-server - 为 Web 扩展 SQL Server（单编写器多读取器）

> ID：373082
> 
> 赞同：0
> 
> 时间：2008-12-16T22:59:26.970
> 
> 标签：sql-server, scaling

有没有人有过以多读单写方式扩展 SQL Server 的经验。如果没有，任何人都可以建议他们有经验的阅读密集型 Web 应用程序的合适替代方案

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T05:04:33.223

这可能取决于两件事：

1.  每次写入有多大？
2.  读者需要实时数据吗？

写入时会阻塞读者，但如果每次写入小而快，那么读者就不会注意到。

例如，如果您卸载日终报告，那么您可以将负载分批到单独的服务器上，因为阅读器不需要实时数据。这是有道理的

您的主服务器上的写入必须同步到您的卸载辅助服务器......无论如何这将作为同步过程的一部分阻塞在那里+您添加了开销负载来管理同步。

大多数应用程序的阅读率一直在 95% 以上。例如，更新或删除是先读后写。

我的选择是（可能基于低写入量并且它是一个 Web 应用程序）在数据库服务器中扩展*并*填充尽可能多的 RAM，并为数据库的数据和日志文件使用单独的磁盘路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T23:09:04.500

对于您的方案，我没有任何横向扩展 SQL Server 的经验。但是，对于读取密集型应用程序，我会考虑减少数据库的负载并使用诸如[Memcache](http://www.danga.com/memcached/)或[MS Velocity之类的缓存策略](http://code.msdn.microsoft.com/velocity)

我知道有两种方法：

1.  将整个数据库加载到缓存中并管理缓存中项目的添加和更新。

2.  仅在请求时将项目添加到缓存中，并在执行写入操作时将其删除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T03:49:26.637

某种复制可以解决问题。
[http://msdn.microsoft.com/en-us/library/ms151827.aspx](http://msdn.microsoft.com/en-us/library/ms151827.aspx)

您当然需要更改您的应用程序代码。

有些人使用分区表，将不同的行范围存储在不同的服务器上 - 与视图结合。这对应用程序是不可见的。对于这种做法，我认为是联合会。

通过设计您的数据库、应用程序和服务器配置（SQL 细节 - 数据/日志/系统/sql 二进制文件/tempdb 的位置），您应该能够处理相当不错的负载。如果没有必要，尽量不要使事情复杂化。

# database - 您将为英国数据库使用多少地址字段？

> ID：373084
> 
> 赞同：13
> 
> 时间：2008-12-16T22:59:36.220
> 
> 标签：database, naming-conventions, street-address

大多数数据库中可能都使用地址记录，但我见过许多用于存储它们的字段集略有不同。字段的数量似乎从 3 到 7 不等，有时所有字段都简单地标记为 address1..addressN，其他时候给出特定的含义（城镇、城市等）。

这是英国特有的，尽管我也对世界其他地区的评论持开放态度。在这里，您需要地址的第一行（实际上只是数字）和邮政编码来识别地址 - 其他一切大多是额外的好处。

我目前倾向于：

*   地址1
*   地址2
*   地址 3
*   镇
*   县
*   邮政编码

如果需要，我们可以添加 Country（不太可能）。

你怎么看？这是太少，太多了吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-16T23:22:11.230

邮局建议（[http://www.postoffice.co.uk/portal/po/content1?catId=19100182&mediaId=19100267](http://www.postoffice.co.uk/portal/po/content1?catId=19100182&mediaId=19100267)）7行：

*   收件人姓名
*   公司/组织
*   建筑名称
*   建筑物编号及道路名称
*   地区名称
*   驿站
*   邮政编码

然后他们说如果使用邮政城镇和邮政编码，您不需要包括县名。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T23:32:02.600

[BSI](http://www.bsi-global.com)有 BS 7666 -涵盖所有寻址。我建议你看看那里。

2000版推荐

地址应基于包含以下实体的逻辑数据模型：

1.  可寻址对象，具有子类型：
    *   主要可寻址对象；
    *   次要可寻址对象；
2.  街道;
3.  地点；
4.  镇;
5.  行政区，又名区；
6.  县;
7.  邮政编码。

见： http: [//landregistry.data.gov.uk/def/common/BS7666Address](http://landregistry.data.gov.uk/def/common/BS7666Address)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T23:14:35.880

如果我是你，我会打电话给[Royal Mail](http://www.royalmail.com/)并询问他们……或者在他们的网站上查找邮政编码作为最佳实践。

有不同类型的地址，每种不同类型的结构略有不同。转发分拣办公室的邮政地址结构与带有门牌号的住宅不同。如果房子有名字而不是数字怎么办？有很多因素需要考虑。

自从我搬到加拿大后，我不得不做类似的事情，这比一个简单的住宅地址要复杂得多，通常有：

*   街道号码（如果适用）
*   街道号码后缀（如果适用）
*   房子的名字
*   街道名称
*   街道类型
*   街道方向（如果适用）
*   公寓、联排别墅或其他类型的建筑物/位置的单元号
*   小市镇（村）
*   主要自治市（主要城镇/城市）
*   县
*   邮政编码
*   国家，如果你包括苏格兰、威尔士、北爱尔兰（现在我注意到了爱尔兰）

然后你会得到拥有自己的送货路线、邮政信箱、转发分拣办公室的企业......

它真的很匆忙变得复杂。

最好的选择 - 给 Royal Mail 打个电话，他们应该能够为您提供有关其标准地址模板的信息。

**编辑**：您的 3 字段方法还不错……尤其是。但是，使用您拥有的字段设置，数据清理可能是一个重要问题，您可能需要一个相当复杂的策略来确保输入的地址有效。清理单个专用字段以确保输入正确比从组合字段中解析各种地址标记要容易得多。

获取此信息的另一种更简单的方法是访问 Royal Mail 网站并查看他们的邮政编码查找页面。

在他们的主要邮政编码查找中，他们使用 4 个字段，我猜他们对街道名称/类型字段进行了某种形式的验证。他们将门牌号和名称分开，我猜他们只允许主要城市。我假设县/国家是假设的。如果您打破他们的高级搜索，他们会为您提供两个额外的字段，分别是公寓号码和公司名称。

鉴于某些字段在他们的网站上组合在一起，您必须假设有一定数量的验证以确保输入的数据可以被有效地使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T23:20:32.963

我不知道这是否是最小的（我对此表示怀疑），但我支票簿上的标题说的非常接近：

```
Lloyds TSB
Isle of Man Offshore Centre
Peveril Buildings
Peveril Square
Douglas
Isle of Man
IM99 0XX
United Kingdom 
```

当我尝试将其输入美国银行系统时，这会引起不适。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-07T11:53:57.220

房屋要素

*   子建筑物名称
*   建筑名称
*   建筑编号
*   组织名称
*   部门名称
*   邮政信箱号码

干道元素

*   相关道路名称
*   相关通道描述符
*   主干道名称
*   主干道描述符

地方元素

*   双重依赖的地方
*   依赖地区
*   驿站

邮政编码元素

*   邮政编码

**这个答案可能晚了几年，但它是针对像我这样的人，他们正在寻找有关如何正确格式化邮政地址以便存储在数据库（或类似数据库）和用于打印目的的指导。**

* * *

取自 Royal Mail Doc，下面的链接 - 方便地标题为“***程序员指南***”

*   [PAF用户技术规范](https://www.poweredbypaf.com/wp-content/uploads/2015/02/Latest-Programmers_guide_Edition-7-Version-6.pdf)

第 27 - 42 页对我最有帮助。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-16T23:05:55.490

“英国”很可能也会向爱尔兰开放，并且在某些业务领域会存在法律差异，通常在苏格兰/北爱尔兰/海峡群岛与英格兰和威尔士之间。

简而言之，我会将国家添加到列表中。否则没关系（当然不会更少），当然任何地址都可以从建筑物参考、邮政编码和国家/地区追踪。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2011-12-08T09:42:45.640

我们住在法国的地方只有 3 条线路：-

myname
村庄/地点名称
6 位邮政编码，后跟大写的邮政城镇名称

即使来自英国，这也是所需要的一切

# javascript - 在 JavaScript 中捕获 302 FOUND

> ID：373087
> 
> 赞同：40
> 
> 时间：2008-12-16T23:01:34.487
> 
> 标签：javascript, jquery, ajax, http-status-code-302

我使用 jQuery 向我的服务器发出 AJAX POST 请求，它可以返回状态为 302 的 HTTP 响应。然后 JavaScript 只是向这个 URL 发送 GET 请求，而我想在这个响应中将用户重定向到 URL。这可能吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-10-07T22:34:47.560

由于给出的原因，接受的答案不起作用。我发布了一条评论，其中包含一个问题的链接，该问题描述了一种破解 302 被浏览器透明处理的问题：

[如何在 jQuery Ajax 调用后管理重定向请求](https://stackoverflow.com/questions/199099/how-to-manage-a-redirect-request-after-a-jquery-ajax-call)

但是，这有点肮脏，经过大量挖掘后，我发现了我认为更好的解决方案-使用[JSON](http://en.wikipedia.org/wiki/JSON)。在这种情况下，您可以使对 ajax 请求的所有响应都具有代码 200，并在响应正文中添加某种 JSON 对象，然后您的 ajax 响应处理程序可以以适当的方式使用该对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-10T18:22:01.560

我不这么认为。[W3C](http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/#xmlhttprequest)表示，必须透明地遵循带有某些状态代码（包括 302）的 HTTP 重定向。引用如下：

> 如果响应是 HTTP 重定向（状态代码 301、302、303 或 307），则必须透明地遵循它（除非它违反安全或无限循环预防措施）。任何其他错误（包括 401）必须导致对象使用该错误页面作为响应。

作为一个实验，我尝试从各种浏览器（Firefox 3.5、Chrome、IE8、IE7、IE6）向服务器发出 Ajax 请求，并提供 302 状态代码，并在浏览器的请求对象中显示状态。在每种情况下，它都显示为 200。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-18T18:09:29.820

在我的问题原因是：

我正在使用**localhost/Home/Test**地址来测试页面。**但是使用127.0.0.1/Home/AjaxRequest**作为 url 参数的ajax 请求代码 。当 url 不同时，会发生此错误。

也许它可以帮助某人:)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-09-18T11:27:06.433

与其要求 Javascript 代码处理 302，不如在 302 事件上返回带有自定义错误代码 + 消息的 500

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2008-12-16T23:19:30.020

```
function doAjaxCall() {
   $.ajaxSetup({complete: onRequestCompleted});
   $.get(yourUrl,yourData,yourCallback);
}

function onRequestCompleted(xhr,textStatus) {
   if (xhr.status == 302) {
      location.href = xhr.getResponseHeader("Location");
   }
} 
```

# ruby-on-rails - config/environments/development.rb 中“consider_all_requests_local”的用途？

> ID：373089
> 
> 赞同：98
> 
> 时间：2008-12-16T23:02:32.767
> 
> 标签：ruby-on-rails, ruby

这个 Rails 配置设置的目的是什么...

```
config.action_controller.consider_all_requests_local = true 
```

默认情况下它设置为 true 在`config/environments/development.rb`.

谢谢，

伊森

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-12-16T23:21:23.120

非本地请求会导致用户友好的错误页面。假设来自开发人员的本地请求会看到更有用的错误消息，其中包括行号和回溯。 `consider_all_requests_local`允许您的应用程序显示这些对开发人员友好的消息，即使发出请求的机器是远程的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2018-08-16T08:09:53.733

在开发级别，我们设置：

> 考虑_all_requests_local 设置=真

因为开发人员需要查看显示布局/视图的完整错误，如下图所示。

[![在此处输入图像描述](https://i.stack.imgur.com/s9U2y.png)](https://i.stack.imgur.com/s9U2y.png)

但是在生产级别，我们不需要显示我们的内部编码错误，所以我们设置为 false：

> config.consider_all_requests_local = false

[![在此处输入图像描述](https://i.stack.imgur.com/EpFqw.png)](https://i.stack.imgur.com/EpFqw.png)

# sql-server - SQL Server 视图在更改基础依赖项后显示过时/错误数据

> ID：373093
> 
> 赞同：9
> 
> 时间：2008-12-16T23:06:20.887
> 
> 标签：sql-server, sql-server-2005, view

我们有一个视图（称为 X），它是由其他 2 个视图（称为 Y 和 Z）调用的基本视图。

今天我们对视图 X 进行了更改，之后视图 Y 和 Z 开始带回不正确的数据。当我们在 Management Studio 中运行时`SELECT * FROM Y`（这正是在代码中调用视图的方式），它会返回不正确的数据。但是，当我们运行视图包含的实际 SQL 时，它就很好了。我们尝试了很多方法，直到一位同事建议添加一个空间来查看 X 和 Z，然后运行 ​​Alter，它奏效了。一切恢复正常并运行良好。

我的问题是：MSSQL 是否缓存其视图？如果是这样，你如何强迫他们不要或强迫他们重新编译？

此外，任何关于此的额外阅读都会有所帮助。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-16T23:26:08.477

请参见[sp_refreshview](http://msdn.microsoft.com/en-us/library/ms187821.aspx)命令。

> 更新指定的非模式绑定视图的元数据。由于视图所依赖的底层对象的更改，视图的持久元数据可能会变得过时。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-16T23:19:06.993

SQL Server 不缓存视图数据（至少，不是以您所指的方式）。

如果视图定义包含“SELECT *”，则在创建视图时定义实际的列列表，即“SELECT *”将替换为创建视图时存在的实际列列表。这意味着如果您将列添加到该视图引用的基础表中，则该列将不会出现在视图中。

# optimization - 生产 Web 应用程序每秒的“平均”请求数是多少？

> ID：373098
> 
> 赞同：147
> 
> 时间：2008-12-16T23:10:21.690
> 
> 标签：optimization

就所谓的“快速”而言，我没有参考框架；我一直想知道这个，但从来没有找到一个直接的答案......

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-12-16T23:42:24.573

OpenStreetMap 似乎[每秒有 10-20 个](http://munin.openstreetmap.org/openstreetmap/puff.openstreetmap-lighttpd_accesses.html)

维基百科似乎[每秒 30000 到 70000 个](http://toolserver.org/~leon/stats/reqstats/reqstats-weekly.png)分布在[300 台服务器上](http://meta.wikimedia.org/wiki/Wikimedia_servers)（每台机器每秒 100 到 200 个请求，其中大部分是缓存）

Geograph[每周获得 7000 张图片](http://www.geograph.org.uk/statistics.php)（每 95 秒上传 1 张）

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2011-01-22T22:14:00.853

不确定是否有人仍然感兴趣，但此信息[是关于 Twitter 的](http://lzhuacuo.blog.com/2011/12/28/scaling-twitter-making-twitter-10000-percent-faster/)（[这里也是](http://highscalability.com/blog/2009/6/27/scaling-twitter-making-twitter-10000-percent-faster.html)）：

> # 统计数据
> 
> *   超过 350,000 名用户。实际数字一如既往，非常超级超级绝密。
> *   每秒 600 个请求。
> *   平均每秒 200-300 个连接。每秒达到 800 个连接。
> *   MySQL 每秒处理 2,400 个请求。
> *   180 个 Rails 实例。使用 Mongrel 作为“网络”服务器。
> *   1 个 MySQL 服务器（一个大的 8 核机器）和 1 个从属服务器。从站是只读的，用于统计和报告。
> *   30多个处理零工的流程。
> *   8 台 Sun X4100。
> *   在 Rails 中在 200 毫秒内处理一个请求。
> *   在数据库中花费的平均时间为 50-100 毫秒。
> *   超过 16 GB 的内存缓存。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-16T23:35:19.033

当我转到我的虚拟主机的控制面板时，打开 phpMyAdmin，然后单击“显示 MySQL 运行时信息”，我得到：

> 这个 MySQL 服务器已经运行了 53 天 15 小时 28 分 53 秒。它于 2008 年 10 月 24 日凌晨 04:03 开始​​。
> 
> 查询统计：自启动以来，已向服务器发送了 3,444,378,344 个查询。
> 
> 总计 3,444 M
> 每小时 2.68 M
> 每分钟 44.59 k
> 每秒 743.13

在过去的 53 天里，平均每秒钟有 743 个 mySQL 查询！

我不了解你，但对我来说这很快！非常快！！

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-08-31T19:03:46.367

就个人而言，我喜欢每次都完成的分析......请求/秒和平均时间/请求，并且喜欢看到最大请求时间以及最重要的。如果您每秒有 61 个请求，则很容易翻转，然后您可以将其翻转到 1000ms / 61 个请求。

为了回答您的问题，我们自己进行了一次巨大的负载测试，发现它适用于我们使用的各种亚马逊硬件（最好的价值是 32 位中型 CPU，当它降到 $$/事件/秒时）和我们的请求/秒范围从 29 个请求/秒/节点到 150 个请求/秒/节点。

提供更好的硬件当然会带来更好的结果，但不是最好的投资回报率。无论如何，这篇文章很棒，因为我正在寻找一些相似之处，看看我的号码是否在球场上，并分享我的号码，以防其他人正在寻找。我的装满了我能走的最高点。

注意：由于请求/秒分析（不是 ms/request），我们发现了一个主要的 linux 问题，我们正在尝试解决 linux（我们用 C 和 java 测试服务器）在负载过多时冻结所有对套接字库的调用这似乎很奇怪。完整的帖子实际上可以在这里找到.... [http://ubuntuforums.org/showthread.php?p=11202389](http://ubuntuforums.org/showthread.php?p=11202389)

我们仍在努力解决这个问题，因为它给我们带来了巨大的性能提升，因为我们的测试从 2 分 42 秒变为 1 分 35 秒，因此我们看到了 33% 的性能提升......更不用说， DoS 攻击越糟糕，这些暂停的时间就越长，以至于所有 cpu 都降到零并停止处理......在我看来，服务器处理应该在面对 DoS 时继续，但由于某种原因，它每隔一段时间就会冻结在 Dos 期间有时长达 30 秒！！！

补充：我们发现它实际上是一个 jdk 竞争条件错误....很难在大型集群上隔离，但是当我们运行 1 个服务器 1 个数据节点但其中有 10 个时，我们每次都可以重现它，然后只查看服务器/datanode 它发生在。将 jdk 切换到较早的版本解决了该问题。我相信我们在 jdk1.6.0_26 上。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-16T23:22:41.417

这是一个非常开放的苹果到橘子类型的问题。

您在问 1\. 生产应用程序的平均请求负载 2\. 什么被认为是快速的

这些不一定相关。

您每秒的平均请求数取决于

一种。同时用户数

湾。他们每秒发出的平均页面请求数

C。附加请求的数量（即 ajax 调用等）

至于什么被认为是快速......你的意思是一个网站可以接受多少请求？或者，如果一个硬件每秒可以处理 xyz # 个请求，那么它是否被认为是快速的？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T00:09:44.020

请注意，命中率图将是正弦模式，“高峰时间”可能是用户睡觉时获得率的 2 倍或 3 倍。（当您计划每天在服务器上进行批处理时可能很有用）

您甚至可以在维基百科等“国际”（多语言、本地化）网站上看到效果

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-17T00:24:43.833

每个用户通常少于 2 秒 - 即看到比这慢的响应的用户认为系统很慢。

现在你告诉我你连接了多少用户。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-17T00:30:12.450

如果网站的某些方面突然在新闻中流行起来，您可以搜索“斜线点效应分析”图表，例如[wiki](http://polyscience.org/articles/slashdot-effect-1/)上的[此图表](http://en.wikipedia.org/wiki/File:SlashdotEffectGraph.svg)。

幸存下来的 Web 应用程序往往是那些可以生成静态页面而不是通过处理语言处理每个请求的应用程序。

有一个很棒的视频（我想它可能在 ted.com 上？我想它可能是由 flickr 网络团队提供的？有人知道链接吗？）关于如何在单个服务器之外扩展网站的想法，例如如何在只读和读写服务器的混合之间分配连接，以便为各种类型的用户获得最佳效果。

# asp.net - 多语言网站虚拟目录的最佳方式

> ID：373106
> 
> 赞同：1
> 
> 时间：2008-12-16T23:13:23.853
> 
> 标签：asp.net, globalization, virtual-directory, multilingual

我有一个网站最终将支持 4 种语言和 2 个国家（美国和加拿大，英语和西班牙语）

我想知道设置目录结构的最佳方法是什么？

现在，我有一个名为 site.com 的根站点：

这将带您到一个页面，您可以在其中选择您的国家和语言。

理想情况下，我希望有这样的目录：

```
site.com/ca/en/ (Canada English)
site.com/ca/fr/ (Canada French)
site.com/us/en/ (US English)
site.com/us/es/ (US Spanish) 
```

但这意味着我将在其中放置一个“ca”和一个“us”虚拟目录和语言虚拟目录。这是一种很好的做法，还是我应该做类似的事情：

```
site.com/ca-en/ (Canada English)
site.com/ca-fr/ (Canada French)
site.com/us-en/ (US English)
site.com/us-es/ (US Spanish) 
```

**编辑：我做了以下事情：**

应用程序中有一个虚拟目录：/ca/ 和 /us/。它们都有一个 default.aspx，它只是一个重定向。就我而言，我将他们重定向到他们的英语网站：

例如：site.com/ca/ --> site.com/ca/en/site.com/us/ --> site.com/us/en/

如果输入 site.com，您将被推送到语言选择页面。基本上，我在每个请求中都使用 Global.asax 中的正则表达式来查找语言/文化字符串。

这有以下好处。国家分离。因此，您可以控制 site.com/ca/ 或 site.com/us/，并且能够为每个国家/地区提供一个简单的 URL。

无论如何，虚拟目录 /en/、/fr/ 和 /es/ 都在它们各自国家的物理文件夹中。

所以你有以下内容（虚拟目录以**粗体显示**）：

site.com/ca/en/ （**默认**）**site.com/ca/fr/site.com/us/en/**（**默认**）**site.com/us/es/**

 ****这意味着您需要有五个（相同的）应用程序，除了您可以使用 URL 获取当前语言和国家/地区（并将其指向正确的数据库）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T23:26:32.920

为什么不拥有一个站点并检查客户端设置（request.servervariables / HTTP_ACCEPT_LANGUAGE）以了解要使用的首选语言以及使用 asp.Net 中的内置全球化？

如果根据国家/语言显示完全不同的内容，那么我可以理解为什么要这样分开它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T20:31:16.403

好吧，他们希望每个站点的 URL 都不同。

本质上它实际上是一个站点（出于维护原因），我们正在使用全球化来确定使用哪个连接字符串（不同的数据库，每个数据库中的结构相同）

每次我们发布时，我都会发布到四个位置。相同的应用程序。

使用一个 URL 进行全球化听起来是个好主意，但我认为它不会正确爬取，即使这样做，也不会提供一个好的书签链接。（法国人使用设置为英语的计算机向另一个法国人发送链接）。还有其他含义，但苹果和微软等网站对每种语言/文化使用不同的网址是有原因的。

在每次会话开始时，我都会检查 url，并相应地设置连接字符串。

**最后，我只是在主应用程序中放置了 /ca/ 和 /us/ 目录，为每种语言添加了一些虚拟目录，然后将响应重定向到“选择语言”页面。**

也许不是最好的解决方案，但它似乎正在工作。

这样做的另一个好处是，如果有一些仅适用于一个站点的特殊页面，则只能将其添加到该站点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T21:07:50.417

普遍接受的本地化命名法是语言代码连字符国家代码的 ll-CC。例如：en-US，尽管 en-US 可能是默认的 en-GB 或 en-CA 作为后备... es-MX 等也是值得的。不过，使用子域可能会更好，这将允许在没有复杂负载平衡规则的情况下分解资源。例如：us.en.yoursite.com ...这也允许在 webfarm 环境中更容易地分解服务器。我建议将实际代码与每个站点的设置更改相同以匹配本地化。然后使用您传入文本键的本地化资源，并根据站点的本地化模式解析语言翻译。注意：.Net 和其他平台提供内置的资源本地化选项。

# sql - 如何设计数据库模式以支持使用类别进行标记？

> ID：373126
> 
> 赞同：16
> 
> 时间：2008-12-16T23:18:40.737
> 
> 标签：sql, schema, tags, foreign-keys, entity-attribute-value

我正在尝试类似[Database Design for Tagging](https://stackoverflow.com/questions/48475/database-design-for-tagging)之类的东西，除了我的每个标签都被分组到类别中。

例如，假设我有一个关于车辆的数据库。假设我们实际上对车辆知之甚少，因此我们无法指定所有车辆将具有的列。因此，我们将用信息“标记”车辆。

```
1\. manufacture: Mercedes
   model: SLK32 AMG
   convertible: hardtop

2\. manufacture: Ford
   model: GT90
   production phase: prototype

3\. manufacture: Mazda
   model: MX-5
   convertible: softtop 
```

现在您可以看到所有汽车都标有其制造商和型号，但其他类别并不完全匹配。请注意，一辆车只能有一个类别。IE。一辆车只能有一个制造商。

我想设计一个数据库来支持搜索所有梅赛德斯，或者能够列出所有制造商。

我目前的设计是这样的：

```
vehicles
  int vid
  String vin

vehicleTags
  int vid
  int tid

tags
  int tid
  String tag
  int cid

categories
  int cid
  String category 
```

我有所有正确的主键和外键，除了我无法处理每辆车只能有一个制造商的情况。或者我可以吗？

我可以在vehicleTags 中的复合主键中添加外键约束吗？IE。我可以添加一个约束，使得复合主键 (vid, tid) 只能添加到 vehicleTags 中，前提是在 vehicleTags 中还没有一行，这样对于同一个 vid，在 with 中还没有 tid同一个cid？

我的猜测是否定的。我认为解决这个问题的方法是在vehicleTags中添加一个cid列，并制作新的复合主键（vid，cid）。它看起来像：

```
vehicleTags
  int vid
  int cid
  int tid 
```

这将防止汽车有两个制造商，但现在我已经复制了 tid 在 cid 中的信息。

我的架构应该是什么？

汤姆在我之前的问题中注意到我的数据库模式中的这个问题，[你如何做多对多表外连接？](https://stackoverflow.com/questions/372399/how-do-you-do-many-to-many-table-outer-joins)

**编辑**
我知道在示例中制造确实应该是车辆表中的一列，但假设你不能这样做。这个例子只是一个例子。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-17T00:33:16.530

[这是实体-属性-值](http://en.wikipedia.org/wiki/Entity-attribute-value_model)设计的另一个变体。

一个更容易识别的 EAV 表如下所示：

```
CREATE TABLE vehicleEAV (
  vid        INTEGER,
  attr_name  VARCHAR(20),
  attr_value VARCHAR(100),
  PRIMARY KEY (vid, attr_name),
  FOREIGN KEY (vid) REFERENCES vehicles (vid)
); 
```

有些人强制`attr_name`引用预定义属性名称的查找表，以限制混乱。

您所做的只是将 EAV 表分布在三个表上，但没有改进元数据的顺序：

```
CREATE TABLE vehicleTag (
  vid         INTEGER,
  cid         INTEGER,
  tid         INTEGER,
  PRIMARY KEY (vid, cid),
  FOREIGN KEY (vid) REFERENCES vehicles(vid),
  FOREIGN KEY (cid) REFERENCES categories(cid),
  FOREIGN KEY (tid) REFERENCES tags(tid)
);

CREATE TABLE categories (
  cid        INTEGER PRIMARY KEY,
  category   VARCHAR(20) -- "attr_name"
);

CREATE TABLE tags (
  tid        INTEGER PRIMARY KEY,
  tag        VARCHAR(100) -- "attr_value"
); 
```

如果你打算使用 EAV 设计，你只需要`vehicleTags`和`categories`表。

```
CREATE TABLE vehicleTag (
  vid         INTEGER,
  cid         INTEGER,     -- reference to "attr_name" lookup table
  tag         VARCHAR(100, -- "attr_value"
  PRIMARY KEY (vid, cid),
  FOREIGN KEY (vid) REFERENCES vehicles(vid),
  FOREIGN KEY (cid) REFERENCES categories(cid)
); 
```

但请记住，您*将数据与元数据混合在一起*。您失去了对数据模型应用某些约束的能力。

*   您如何使其中一个类别成为强制性的（常规列使用`NOT NULL`约束）？
*   您如何使用 SQL 数据类型来验证您的某些标记值？你不能，因为你对每个标签值都使用了一个长字符串。这个字符串是否足够长，可以满足您将来需要的每个标签？你说不出来。
*   如何将一些标签限制为一组允许的值（常规表使用查找表的外键）？这是您的“软顶”与“软顶”示例。但是您不能对`tag`列进行约束，因为该约束将应用于其他类别的所有其他标记值。您还可以有效地将发动机尺寸和油漆颜色限制为“软顶”。

SQL 数据库不适用于此模型。做对是非常困难的，查询它变得非常复杂。如果您继续使用 SQL，您最好按照常规方式对表进行建模，每个属性一列。如果您需要“子类型”，则为每个子类型定义一个从属表（[Class-Table Inheritance](http://www.martinfowler.com/eaaCatalog/classTableInheritance.html)），或者使用[Single-Table Inheritance](http://www.martinfowler.com/eaaCatalog/singleTableInheritance.html)。如果每个实体的属性有无限变化，请使用[序列化 LOB](http://www.martinfowler.com/eaaCatalog/serializedLOB.html)。

为这些流动的非关系数据模型设计的另一种技术是语义数据库，将数据存储在[RDF](http://en.wikipedia.org/wiki/Resource_Description_Framework)中并使用[SPARQL](http://en.wikipedia.org/wiki/SPARQL)进行查询。一种免费的解决方案是[RDF4J](https://rdf4j.org)（以前称为 Sesame）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-10-27T11:43:04.120

我需要解决这个确切的问题（相同的通用领域和所有东西——汽车零件）。我发现该问题的最佳解决方案是使用 Lucene/Xapian/Ferret/Sphinx 或您喜欢的任何全文索引器。比 SQL 所能提供的性能要好得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-01-11T18:53:56.357

您描述的不是标签，标签只是值，它们没有关联的键。标签通常实现为字符串列，值是分隔的值列表。

例如 #1，标签字段将包含一个值，例如：

“制造_梅赛德斯，型号_SLK32 AMG，敞篷车_硬顶”

然后，用户通常能够通过一个或多个标签的存在轻松过滤条目。从数据库的角度来看，它本质上是无模式数据。标签有缺点，但它们也避免了使用 EAV 模型带来的极端复杂性。如果你真的需要一个 EAV 模型，也可能值得考虑一个包含 JSON 数据的属性字段。查询起来更痛苦，但仍然没有跨多个表查询 EAV 可怕。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T23:31:59.870

我认为您的解决方案是简单地将制造商列添加到您的车辆表中。这是您知道所有车辆都将具有的属性（即汽车不会自行出现），并且通过将其作为车辆表中的一列，您可以解决每辆车只有一个制造商的问题。这种方法适用于您知道将由所有车辆共享的任何属性。然后，您可以为不通用的其他属性实现标记系统。

因此，从您的示例中，车辆表将类似于：

```
车辆
  视频
  葡萄酒
  制作
  模型

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T23:51:52.107

一种方法是稍微重新考虑您的架构，将标签键标准化为远离值：

```
vehicles
  int vid
  string vin

tags
  int tid
  int cid
  string key

categories
  int cid
  string category

vehicleTags
  int vid
  int tid
  string value 
```

现在你所需要的只是对`vehicleTags(vid, tid)`.

或者，除了简单的外键之外，还有其他方法可以创建约束：根据您的数据库，您是否可以编写自定义约束或插入/更新触发器来强制车辆标签的唯一性？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T16:46:39.830

我需要解决这个确切的问题（相同的通用领域和所有东西——汽车零件）。我发现该问题的最佳解决方案是使用 Lucene/Xapian/Ferret/Sphinx 或您喜欢的任何全文索引器。比 SQL 所能提供的性能要好得多。

这些天来，我几乎从来没有最终构建一个不涉及全文索引器的数据库支持的 Web 应用程序。这个问题和搜索的一般问题经常出现，以至于无法从您的工具箱中省略索引器。

# bash - darcs帮助打破我的外壳

> ID：373134
> 
> 赞同：0
> 
> 时间：2008-12-16T23:20:40.470
> 
> 标签：bash, gentoo, darcs

我刚刚安装了 darcs 2.1.2.2。当我输入 darcs help 时，会出现一些不太像的东西。当我用 q 关闭它时，它会消失，但我没有得到提示，也无法执行任何命令。抄送也不行。我在gentoo上使用bash。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-04T19:06:12.000

我不知道 darcs 是什么，但是当 bash 无法返回到作为管道一部分的某些命令仍在运行的提示时。例如，如果您运行：

```
cmd | less 
```

并且退出较少，但 cmd 并没有因管道损坏而死，然后 cmd 将继续运行，bash 将继续等待，直到它退出。如果它无法访问 tty，它也可能不会响应信号和按键。

您将需要第二个终端来检查并查看在尝试关闭 darcs 后是否有任何进程挂起。有时 Ctrl-Z 或 Ctrl-\ 会在 Ctrl-C 不起作用的地方工作。除了查看 darcs 并弄清楚为什么它没有像应有的那样消失之外，可能没有其他解决方法。如果它确实启动较少，那么在“q”之前键入“>”可能会使其正常退出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T20:25:09.620

在这种情况下（终端搞砸了，看不到你在输入什么）“重置”命令通常会解决问题。

我会用更新的 darcs 再试一次，例如今天发布的 2.3 版。如果问题仍然存在，您可能可以更改此行为 - 请参阅 darcs 手册。否则，#darcs irc 频道上的人们将能够提供帮助。

# c++ - 可以使用哪些技术来加快 C++ 编译时间？

> ID：373142
> 
> 赞同：274
> 
> 时间：2008-12-16T23:25:06.137
> 
> 标签：c++

可以使用哪些技术来加快 C++ 编译时间？

这个问题出现在 Stack Overflow question *[C++ programming style](https://stackoverflow.com/questions/372862)*的一些评论中，我很想听听有什么想法。

我看过一个相关的问题，*[为什么 C++ 编译需要这么长时间？](https://stackoverflow.com/questions/318398)*，但这并没有提供很多解决方案。

* * *

## 回答 #1

> 赞同：266
> 
> 时间：2008-12-16T23:39:29.167

## Language techniques

### Pimpl Idiom

Take a look at the *[Pimpl idiom](https://en.wikipedia.org/wiki/Opaque_pointer)* [here](http://www.gotw.ca/gotw/028.htm), and [here](http://www.gotw.ca/gotw/024.htm), also known as an [opaque pointer](http://en.wikipedia.org/wiki/Opaque_pointer) or handle classes. Not only does it speed up compilation, it also increases exception safety when combined with a [non-throwing swap](http://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Non-throwing_swap) function. The Pimpl idiom lets you reduce the dependencies between headers and reduces the amount of recompilation that needs to be done.

### Forward Declarations

Wherever possible, use [forward declarations](http://www.gotw.ca/publications/mill04.htm). If the compiler only needs to know that `SomeIdentifier` is a struct or a pointer or whatever, don't include the entire definition, forcing the compiler to do more work than it needs to. This can have a cascading effect, making this way slower than they need to be.

The [I/O](http://en.wikipedia.org/wiki/Input/output) streams are particularly known for slowing down builds. If you need them in a header file, try #including `<iosfwd>` instead of `<iostream>` and #include the `<iostream>` header in the implementation file only. The `<iosfwd>` header holds forward declarations only. Unfortunately the other standard headers don't have a respective declarations header.

Prefer pass-by-reference to pass-by-value in function signatures. This will eliminate the need to #include the respective type definitions in the header file and you will only need to forward-declare the type. Of course, prefer const references to non-const references to avoid obscure bugs, but this is an issue for another question.

### Guard Conditions

Use guard conditions to keep header files from being included more than once in a single translation unit.

```
#pragma once
#ifndef filename_h
#define filename_h

// Header declarations / definitions

#endif 
```

By using both the pragma and the ifndef, you get the portability of the plain macro solution, as well as the compilation speed optimization that some compilers can do in the presence of the `pragma once` directive.

### Reduce interdependency

The more modular and less interdependent your code design is in general, the less often you will have to recompile everything. You can also end up reducing the amount of work the compiler has to do on any individual block at the same time, by virtue of the fact that it has less to keep track of.

## Compiler options

### Precompiled Headers

These are used to compile a common section of included headers once for many translation units. The compiler compiles it once, and saves its internal state. That state can then be loaded quickly to get a head start in compiling another file with that same set of headers.

Be careful that you only include rarely changed stuff in the precompiled headers, or you could end up doing full rebuilds more often than necessary. This is a good place for [STL](http://en.wikipedia.org/wiki/Standard_Template_Library) headers and other library include files.

[ccache](http://ccache.samba.org/) is another utility that takes advantage of caching techniques to speed things up.

### Use Parallelism

Many compilers / IDEs support using multiple cores/CPUs to do compilation simultaneously. In [GNU Make](https://en.wikipedia.org/wiki/Make_%28software%29#Derivatives) (usually used with GCC), use the `-j [N]` option. In Visual Studio, there's an option under preferences to allow it to build multiple projects in parallel. You can also use the [`/MP` option](http://msdn.microsoft.com/en-us/library/bb385193.aspx) for file-level paralellism, instead of just project-level paralellism.

Other parallel utilities:

*   [Incredibuild](http://www.xoreax.com/main.htm)
*   [Unity Build](http://buffered.io/posts/the-magic-of-unity-builds/)
*   [distcc](http://distcc.org/)

### Use a Lower Optimization Level

The more the compiler tries to optimize, the harder it has to work.

### Shared Libraries

Moving your less frequently modified code into libraries can reduce compile time. By using shared libraries (`.so` or `.dll`), you can reduce linking time as well.

## Get a Faster Computer

More RAM, faster hard drives (including SSDs), and more CPUs/cores will all make a difference in compilation speed.

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2015-11-12T23:51:27.897

我从事 STAPL 项目，它是一个大量模板化的 C++ 库。有时，我们必须重新审视所有技术以减少编译时间。在这里，我总结了我们使用的技术。其中一些技术已经在上面列出：

## 查找最耗时的部分

尽管符号长度和编译时间之间没有经过证实的相关性，但我们观察到较小的平均符号大小可以提高所有编译器的编译时间。所以你的第一个目标是在你的代码中找到最大的符号。

### 方法 1 - 根据大小对符号进行排序

您可以使用该`nm`命令根据符号的大小列出符号：

```
nm --print-size --size-sort --radix=d YOUR_BINARY 
```

在此命令中`--radix=d`，您可以查看十进制数字的大小（默认为十六进制）。现在通过查看最大的符号，确定是否可以破坏相应的类并尝试通过将非模板部分分解为基类或将类拆分为多个类来重新设计它。

### 方法 2 - 根据长度对符号进行排序

您可以运行常规`nm`命令并将其通过管道传输到您喜欢的脚本（[AWK](http://en.wikipedia.org/wiki/AWK)、[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)等），以根据符号的**长度**对符号进行排序。根据我们的经验，这种方法比方法 1 确定了使候选人更好的最大问题。

### 方法 3 - 使用 Templight

“ [Templight](https://github.com/mikael-s-persson/templight)是一个基于[Clang](http://en.wikipedia.org/wiki/Clang)的工具，用于分析模板实例化的时间和内存消耗，并执行交互式调试会话以深入了解模板实例化过程”。

您可以通过检查[LLVM](http://en.wikipedia.org/wiki/LLVM)和 Clang（[说明](https://github.com/mikael-s-persson/templight#getting-started)）并在其上应用 Templight 补丁来安装 Templight。LLVM 和 Clang 的默认设置是调试和断言，这些会显着影响您的编译时间。似乎 Templight 两者都需要，所以你必须使用默认设置。安装 LLVM 和 Clang 的过程大约需要一个小时左右。

应用补丁后，您可以使用`templight++`安装时指定的构建文件夹中的代码来编译代码。

确保它`templight++`在您的 PATH 中。现在要编译，将以下开关添加到您`CXXFLAGS`的 Makefile 或命令行选项中：

```
CXXFLAGS+=-Xtemplight -profiler -Xtemplight -memory -Xtemplight -ignore-system 
```

或者

```
templight++ -Xtemplight -profiler -Xtemplight -memory -Xtemplight -ignore-system 
```

编译完成后，您将在同一文件夹中生成 .trace.memory.pbf 和 .trace.pbf。要可视化这些跟踪，您可以使用可以将这些跟踪转换为其他格式的[Templight 工具](https://github.com/mikael-s-persson/templight-tools)。按照这些[说明](https://github.com/mikael-s-persson/templight-tools#getting-started)安装 templight-convert。我们通常使用 callgrind 输出。如果您的项目很小，您也可以使用 GraphViz 输出：

```
$ templight-convert --format callgrind YOUR_BINARY --output YOUR_BINARY.trace

$ templight-convert --format graphviz YOUR_BINARY --output YOUR_BINARY.dot 
```

生成的 callgrind 文件可以使用[kcachegrind](http://kcachegrind.sourceforge.net/html/Home.html)打开，您可以在其中跟踪最耗费时间/内存的实例化。

## 减少模板实例化的数量

尽管没有减少模板实例化数量的确切解决方案，但有一些指南可以提供帮助：

### 重构具有多个模板参数的类

例如，如果你有一堂课，

```
template <typename T, typename U>
struct foo { }; 
```

并且都`T`可以`U`有 10 个不同的选项，您已将此类的可能模板实例化增加到 100 个。解决此问题的一种方法是将代码的公共部分抽象为不同的类。另一种方法是使用继承反转（反转类层次结构），但在使用此技术之前请确保您的设计目标没有受到影响。

### 将非模板代码重构为单个翻译单元

使用这种技术，您可以编译一次公共部分，然后将其与您的其他 TU（翻译单元）链接。

### 使用外部模板实例化 (C++11 起)

如果你知道一个类的所有可能的实例，你可以使用这个技术在不同的翻译单元中编译所有的情况。

例如，在：

```
enum class PossibleChoices = {Option1, Option2, Option3}

template <PossibleChoices pc>
struct foo { }; 
```

我们知道这个类可以有三种可能的实例化：

```
template class foo<PossibleChoices::Option1>;
template class foo<PossibleChoices::Option2>;
template class foo<PossibleChoices::Option3>; 
```

将上述内容放在翻译单元中，并在头文件中的类定义下方使用 extern 关键字：

```
extern template class foo<PossibleChoices::Option1>;
extern template class foo<PossibleChoices::Option2>;
extern template class foo<PossibleChoices::Option3>; 
```

如果您使用一组通用的实例化编译不同的测试，这种技术可以节省您的时间。

> 注意：此时 MPICH2 忽略显式实例化，并始终编译所有编译单元中的实例化类。

### 使用统一构建

统一构建背后的整个想法是将您使用的所有 .cc 文件包含在一个文件中，并且只编译该文件一次。使用这种方法，您可以避免重新实例化不同文件的公共部分，如果您的项目包含许多公共文件，您可能还会节省磁盘访问。

例如，假设您有三个文件`foo1.cc`, `foo2.cc`，`foo3.cc`它们都包含`tuple`在[STL](http://en.wikipedia.org/wiki/Standard_Template_Library)中。您可以创建一个`foo-all.cc`看起来像：

```
#include "foo1.cc"
#include "foo2.cc"
#include "foo3.cc" 
```

您只编译此文件一次，并可能减少三个文件之间的常见实例化。通常很难预测改进是否会显着。但是一个明显的事实是，您将在构建中**失去**并行性（您不能再同时编译这三个文件）。

此外，如果这些文件中的任何一个碰巧占用了大量内存，您实际上可能会在编译结束之前耗尽内存。在某些编译器上，例如[GCC](http://en.wikipedia.org/wiki/GNU_Compiler_Collection)，这可能会导致您的编译器因内存不足而出现 ICE（内部编译器错误）。所以除非你知道所有的利弊，否则不要使用这种技术。

### 预编译头文件

预编译头文件 (PCH) 通过将头文件编译为编译器可识别的中间表示形式，可以节省大量编译时间。要生成预编译的头文件，您只需要使用常规编译命令编译头文件。例如，在 GCC 上：

```
$ g++ YOUR_HEADER.hpp 
```

这将在同一文件夹中生成一个`YOUR_HEADER.hpp.gch file`（`.gch`是 GCC 中 PCH 文件的扩展名）。这意味着如果您包含`YOUR_HEADER.hpp`在其他文件中，编译器将使用您的`YOUR_HEADER.hpp.gch`而不是`YOUR_HEADER.hpp`之前的同一文件夹。

这种技术有两个问题：

1.  你必须确保被预编译的头文件是稳定的并且不会改变（[你总是可以改变你的makefile](https://tombarta.wordpress.com/2009/12/12/precompiled-headers-with-gcc/)）
2.  每个编译单元只能包含一个 PCH（在大多数编译器上）。这意味着如果要预编译多个头文件，则必须将它们包含在一个文件中（例如，`all-my-headers.hpp`）。但这意味着您必须在所有地方都包含新文件。幸运的是，GCC 有解决这个问题的方法。使用`-include`并给它新的头文件。您可以使用此技术用逗号分隔不同的文件。

例如：

```
g++ foo.cc -include all-my-headers.hpp 
```

### 使用未命名或匿名命名空间

[未命名的命名空间](http://en.cppreference.com/w/cpp/language/namespace#Unnamed_namespaces)（又名匿名命名空间）可以显着减少生成的二进制文件大小。未命名的命名空间使用内部链接，这意味着在这些命名空间中生成的符号对其他 TU（翻译或编译单元）将不可见。编译器通常为未命名的命名空间生成唯一名称。这意味着如果你有一个文件 foo.hpp：

```
namespace {

template <typename T>
struct foo { };
} // Anonymous namespace
using A = foo<int>; 
```

并且您碰巧将此文件包含在两个 TU 中（两个 .cc 文件并分别编译它们）。这两个 foo 模板实例将不相同。这违反了[单一定义规则](https://en.wikipedia.org/wiki/One_Definition_Rule)(ODR)。出于同样的原因，不鼓励在头文件中使用未命名的命名空间。随意在您的`.cc`文件中使用它们以避免符号出现在您的二进制文件中。在某些情况下，更改文件的所有内部细节`.cc`会导致生成的二进制文件大小减少 10%。

### 更改可见性选项

在较新的编译器中，您可以选择符号在动态共享对象 (DSO) 中可见或不可见。理想情况下，更改可见性可以提高编译器性能、链接时间优化 (LTO) 和生成的二进制大小。如果您查看 GCC 中的 STL 头文件，您会发现它被广泛使用。要启用可见性选择，您需要更改每个函数、每个类、每个变量的代码，更重要的是每个编译器。

借助可见性，您可以从生成的共享对象中隐藏您认为它们是私有的符号。`-visibility`在 GCC 上，您可以通过将 default 或 hidden 传递给编译器的选项来控制符号的可见性。这在某种意义上类似于未命名的命名空间，但以更复杂和侵入性的方式。

如果您想指定每个案例的可见性，您必须将以下属性添加到您的函数、变量和类中：

```
__attribute__((visibility("default"))) void  foo1() { }
__attribute__((visibility("hidden")))  void  foo2() { }
__attribute__((visibility("hidden")))  class foo3   { };
void foo4() { } 
```

GCC 中的默认可见性是 default（public），这意味着如果将上面的内容编译为共享库（`-shared`）方法，则`foo2`类`foo3`在其他 TU 中将不可见（`foo1`并且`foo4`将可见）。如果您使用 then 编译，`-visibility=hidden`则仅`foo1`可见。甚至`foo4`会被隐藏起来。

[您可以在GCC wiki](https://gcc.gnu.org/wiki/Visibility)上阅读有关可见性的更多信息。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-12-16T23:58:48.113

I'd recommend these articles from "Games from Within, Indie Game Design And Programming":

*   [Physical Structure and C++ – Part 1: A First Look](http://gamesfromwithin.com/physical-structure-and-c-part-1-a-first-look)
*   [Physical Structure and C++ – Part 2: Build Times](http://gamesfromwithin.com/physical-structure-and-c-part-2-build-times)
*   [Even More Experiments with Includes](http://gamesfromwithin.com/even-more-experiments-with-includes)
*   [How Incredible Is Incredibuild?](http://gamesfromwithin.com/how-incredible-is-incredibuild)
*   [The Care and Feeding of Pre-Compiled Headers](http://gamesfromwithin.com/the-care-and-feeding-of-pre-compiled-headers)
*   [The Quest for the Perfect Build System](http://gamesfromwithin.com/the-quest-for-the-perfect-build-system)
*   [The Quest for the Perfect Build System (Part 2)](http://gamesfromwithin.com/the-quest-for-the-perfect-build-system-part-2)

Granted, they are pretty old - you'll have to re-test everything with the latest versions (or versions available to you), to get realistic results. Either way, it is a good source for ideas.

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-09-21T08:38:35.513

过去对我来说效果很好的一种技术：不要独立编译多个 C++ 源文件，而是生成一个包含所有其他文件的 C++ 文件，如下所示：

```
// myproject_all.cpp
// Automatically generated file - don't edit this by hand!
#include "main.cpp"
#include "mainwindow.cpp"
#include "filterdialog.cpp"
#include "database.cpp" 
```

当然，这意味着您必须重新编译所有包含的源代码，以防任何源发生更改，因此依赖关系树会变得更糟。但是，将多个源文件编译为一个翻译单元会更快（至少在我使用[MSVC](http://en.wikipedia.org/wiki/Visual_C%2B%2B#32-bit_versions)和 GCC 的实验中）并生成更小的二进制文件。我还怀疑编译器被赋予了更多的优化潜力（因为它可以一次看到更多的代码）。

这种技术在各种情况下都会中断；例如，如果两个或多个源文件声明了同名的全局函数，编译器将退出。不过，我在任何其他答案中都找不到这种技术，这就是我在这里提到它的原因。

值得一提的是，[KDE 项目](http://www.kde.org)自 1999 年以来就使用这种完全相同的技术来构建优化的二进制文件（可能用于发布）。调用了对构建配置脚本的切换`--enable-final`。出于考古兴趣，我挖出了宣布此功能的帖子：[http ://lists.kde.org/?l=kde-devel&m=92722836009368&w=2](http://lists.kde.org/?l=kde-devel&m=92722836009368&w=2)

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-12-16T23:31:12.040

我将链接到我的另一个答案：*[您如何减少 Visual C++ 项目（本机 C++）的编译时间和链接时间？](https://stackoverflow.com/questions/364240/how-do-you-reduce-compile-time-and-linking-time-for-visual-c-projects-native-c#364257)*. 我想补充的另一点，但经常导致问题的是使用预编译的头文件。但是，请仅将它们用于几乎不会更改的部分（如 GUI 工具包标题）。否则，它们将花费您更多的时间而不是最终为您节省的时间。

另一种选择是，当您使用 GNU make 时，打开`-j<N>`选项：

```
 -j [N], --jobs[=N]          Allow N jobs at once; infinite jobs with no arg. 
```

我通常有它，`3`因为我这里有一个双核。然后它将为不同的翻译单元并行运行编译器，前提是它们之间没有依赖关系。链接不能并行完成，因为只有一个链接器进程将所有目标文件链接在一起。

但是链接器本身可以线程化，这就是[ELF](https://en.wikipedia.org/wiki/Executable_and_Linkable_Format)链接器所做的。它是优化的线程化 C++ 代码，据说链接 ELF 对象文件的速度比旧的快很多（实际上包含在[binutils](https://en.wikipedia.org/wiki/GNU_Binutils)中）。[`GNU gold`](http://sourceware.org/ml/binutils/2008-03/msg00162.html) `ld`

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-12-30T03:26:45.437

关于这个主题有一整本书，名为*[Large-Scale C++ Software Design](http://www.informit.com/store/large-scale-c-plus-plus-software-design-9780201633627)*（由 John Lakos 撰写）。

这本书早于模板，因此在那本书的内容中添加了“使用模板也会使编译器变慢”。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-12-16T23:33:48.710

这里有一些：

*   通过启动多重编译作业来使用所有处理器内核（`make -j2`是一个很好的例子）。
*   关闭或降低优化（例如，GCC`-O1`比`-O2`或快得多`-O3`）。
*   使用[预编译头文件](http://en.wikipedia.org/wiki/Precompiled_header)。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-12-17T07:10:53.077

一旦你应用了上面所有的代码技巧（前向声明，将公共头文件中包含的头文件减少到最低限度，使用[Pimpl](https://en.wikipedia.org/wiki/Opaque_pointer)将大部分细节推送到实现文件中......）并且在语言方面没有其他任何东西，请考虑你的构建系统. 如果您使用 Linux，请考虑使用[distcc](https://en.wikipedia.org/wiki/Distcc)（分布式编译器）和[ccache](https://en.wikipedia.org/wiki/Ccache)（缓存编译器）。

第一个，distcc，在本地执行预处理器步骤，然后将输出发送到网络中第一个可用的编译器。它要求网络中所有已配置节点中的编译器和库版本相同。

后者，ccache，是一个编译器缓存。它再次执行预处理器，然后检查内部数据库（保存在本地目录中）是否已经使用相同的编译器参数编译了该预处理器文件。如果是这样，它只会从编译器的第一次运行中弹出二进制文件和输出。

两者可以同时使用，因此如果 ccache 没有本地副本，它可以通过网络将其发送到具有 distcc 的另一个节点，否则它可以直接注入解决方案而无需进一步处理。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-12-16T23:36:51.653

当我从大学毕业时，我看到的第一个真正具有生产价值的 C++ 代码在它们之间定义了标头的地方有这些神秘的 #ifndef ... #endif 指令。我以一种非常幼稚的方式向编写代码的人询问了这些总体性的事情，并被介绍到了大规模编程的世界。

回到正题，使用指令来防止重复的头文件定义是我在减少编译时间时学到的第一件事。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-12-27T14:02:16.857

更多内存。

有人在另一个答案中谈到了 RAM 驱动器。我用[80286](https://en.wikipedia.org/wiki/Intel_80286)和[Turbo C++](https://en.wikipedia.org/wiki/Turbo_C%2B%2B)（显示年龄）做了这个，结果是惊人的。机器崩溃时数据丢失也是如此。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-12-16T23:35:25.510

利用

```
#pragma once 
```

在头文件的顶部，因此如果它们在翻译单元中包含多次，则标题的文本只会被包含和解析一次。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-12-16T23:53:31.760

Use forward declarations where you can. If a class declaration only uses a pointer or reference to a type, you can just forward declare it and include the header for the type in the implementation file.

For example:

```
// T.h
class Class2; // Forward declaration

class T {
public:
    void doSomething(Class2 &c2);
private:
    Class2 *m_Class2Ptr;
};

// T.cpp
#include "Class2.h"
void Class2::doSomething(Class2 &c2) {
    // Whatever you want here
} 
```

Fewer includes means far less work for the preprocessor if you do it enough.

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-12-17T00:21:22.983

You could use [Unity Builds](http://buffered.io/posts/the-magic-of-unity-builds/).

​​</p>

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-02-11T09:17:26.030

不是关于编译时间，而是关于构建时间：

*   如果在处理构建文件时必须重新构建相同的文件，请使用**ccache**

*   使用**ninja-build**而不是 make。我目前正在编译一个包含约 100 个源文件的项目，所有内容都由 ccache 缓存。make 需要 5 分钟，忍者不到 1 分钟。

你可以从 cmake 生成你的 ninja 文件`-GNinja`。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-12-17T00:52:03.840

仅出于完整性考虑：构建可能会很慢，因为构建系统很愚蠢以及编译器需要很长时间才能完成工作。

阅读*[Recursive Make Considered Harmful](http://aegis.sourceforge.net/auug97.pdf)* (PDF)，了解 Unix 环境中有关此主题的讨论。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-12-16T23:28:14.947

[我有一个关于使用 RAM 驱动器](https://stackoverflow.com/questions/354254/ramdrive-for-compiling-is-there-such-a-thing)的想法。事实证明，对于我的项目来说，它毕竟没有太大的不同。但是它们仍然很小。试试看！我很想知道它有多大帮助。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-12-16T23:34:01.143

*   升级你的电脑

    1.  获得四核（或双四核系统）
    2.  获得大量内存。
    3.  使用 RAM 驱动器可大幅减少文件 I/O 延迟。（有些公司生产的 IDE 和 SATA RAM 驱动器就像硬盘驱动器一样）。
*   然后你有所有其他的典型建议

    1.  如果可用，请使用预编译的头文件。
    2.  减少项目各部分之间的耦合量。更改一个头文件通常不需要重新编译整个项目。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-12-17T18:24:58.023

动态链接 (.so) 可以比静态链接 (.a) 快得多。特别是当您的网络驱动器速度较慢时。这是因为您拥有 .a 文件中需要处理和写出的所有代码。此外，需要将更大的可执行文件写入磁盘。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-12-17T05:30:57.787

你在哪里度过你的时间？你受CPU限制吗？内存绑定？磁盘绑定？你能用更多的核心吗？更多内存？你需要RAID吗？您只是想提高当前系统的效率吗？

在 gcc/g++ 下，你看过[ccache](http://ccache.samba.org/)吗？如果您做`make clean; make`很多事情，这可能会有所帮助。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2019-11-25T16:22:34.620

从 Visual Studio 2017 开始，您可以拥有一些关于需要时间的编译器指标。

在项目属性窗口中将这些参数添加到 C/C++ -> 命令行（附加选项）： `/Bt+ /d2cgsummary /d1reportTime`

您可以[在这篇文章](https://aras-p.info/blog/2019/01/21/Another-cool-MSVC-flag-d1reportTime/)中获得更多信息。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2020-08-17T18:54:35.490

首先，我们必须了解 C++ 与其他语言的不同之处。

有人说是 C++ 有太多太多的特性。但是，嘿，有些语言具有更多功能，而且速度远没有那么慢。

有人说重要的是文件的大小。不，源代码行与编译时间无关。

但是等等，怎么可能？更多的代码行应该意味着更长的编译时间，这是什么魔法？

诀窍是很多代码行隐藏在预处理器指令中。是的。一个`#include`就可以毁掉你模块的编译性能。

你看，C++ 没有模块系统。所有`*.cpp`文件都是从头开始编译的。因此，拥有 1000 个 *.cpp 文件意味着将您的项目编译一千次。你有更多吗？太糟糕了。

这就是 C++ 开发人员不愿将类拆分为多个文件的原因。所有这些标题都很难维护。

那么除了使用预编译的头文件、将所有 cpp 文件合并为一个并保持头文件的数量最少之外，我们还能做些什么呢？

C++20 为我们带来了**模块**的初步支持！最终，您将能够忘记`#include`头文件带来的可怕的编译性能。触摸一个文件？只重新编译那个文件！需要编译一个新的结帐？在几秒钟内而不是几分钟和几小时内编译。

C++ 社区应该尽快迁移到 C++20。C++ 编译器开发者应该更加关注这一点，C++ 开发者应该开始测试各种编译器的初步支持，并使用那些支持模块的编译器。这是 C++ 历史上最重要的时刻！

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-12-16T23:28:27.270

如果您有一个多核处理器，Visual Studio（2005 和更高版本）以及[GCC](http://en.wikipedia.org/wiki/GNU_Compiler_Collection)都支持多处理器编译。如果你有硬件，这是可以启用的，当然。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2014-04-29T18:17:59.223

由于搜索延迟很高，网络共享将大大减慢您的构建速度。对于像 Boost 这样的东西，它对我产生了巨大的影响，尽管我们的网络共享驱动器非常快。当我从网络共享切换到本地 SSD 时，编译玩具 Boost 程序的时间从大约 1 分钟缩短到 1 秒。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-12-02T14:29:12.210

在 Linux（可能还有其他一些 *NIX）上，您可以通过不盯着输出并更改为***另一个***TTY 来真正加快编译速度。

这是实验：*[printf 减慢了我的程序](https://stackoverflow.com/questions/1832489)*

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2013-12-16T15:33:27.813

更快的硬盘。

编译器将许多（并且可能是巨大的）文件写入磁盘。使用 SSD 而不是典型的硬盘，编译时间要短得多。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2013-09-06T17:50:05.777

虽然不是“技术”，但我无法弄清楚具有许多源文件的 Win32 项目如何比我的“Hello World”空项目编译得更快。因此，我希望这可以帮助像我这样的人。

在 Visual Studio 中，增加编译时间的一种选择是增量链接 ( */INCREMENTAL* )。它与链接时代码生成 ( */LTCG* ) 不兼容，因此请记住在进行发布构建时禁用增量链接。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-04-27T01:02:15.357

使用动态链接而不是静态链接可以让您的编译器感觉更快。

如果您使用 t Cmake，请激活该属性：

```
set(BUILD_SHARED_LIBS ON) 
```

Build Release，使用静态链接可以获得更多优化。

# ruby - 解码/编码 MIME 标头（base64）的最佳软件包是什么？

> ID：373149
> 
> 赞同：0
> 
> 时间：2008-12-16T23:28:31.107
> 
> 标签：ruby, base64

我正在尝试在 Ruby 中编码/解码 MIME 标头。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T09:08:41.000

Ruby 在核心中有 Base64 方法，只需执行

```
require "base64" 
```

并使用`Base64.decode64`和`Base64.encode64`。[对于quoted-printable，您可以在此处](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/133587)使用以下代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T12:23:46.047

如果 mime 内容与电子邮件有关，您可能还想查看 TMAil ...

[http://tmail.rubyforge.org/](http://tmail.rubyforge.org/)

它有一个很好的方法来解析电子邮件附件和多部分消息等等。

# c# - 如何在工厂中实现构造函数注入？

> ID：373153
> 
> 赞同：4
> 
> 时间：2008-12-16T23:29:36.130
> 
> 标签：c#, design-patterns, dependency-injection, factory

当您使用工厂模式时，如何在运行时将依赖项注入构造函数？

我正在构建具有不同格式的 Foos - boolean、array、freetext、matrix 等。随着我们发现 Foo 的不同用途，该格式列表将会增长。这是我的基本核心域：

```
public interface IFoo
{
    FooFormat Format { get; }
}

public class Foo : IFoo
{
    private FooFormat _format;

    internal Foo(FooFormat format)
    {
        _format = format;
    }

    public FooFormat Format { get { return _format; } }
}

public abstract class FooFormat
{
}

public class DefaultFooFormat : FooFormat
{
}

public class BooleanFooFormat : FooFormat
{
    public IList<bool> Values { get; set; }
}

public class ArrayFooFormat : FooFormat
{
    private IList<string> _values;

    public ArrayFooFormat(IList<string> values)
    {
        _values = values;
    }

    public IList<string> Values { get { return _values; } }
} 
```

IFoo 是为消费者上下文装饰的：

```
public abstract class FooDecorator : IFoo
{
    private IFoo _foo;

    protected FooDecorator(IFoo foo)
    {
        _foo = foo;
    }

    public FooFormat Format
    {
        get { return _foo.Format; }
    }

    protected IFoo foo
    {
        get { return _foo; }
    }
} 
```

我不希望我的消费者直接实例化 Foo ，所以我强迫他们使用工厂：

```
public abstract class FooFactory
{
    protected IFoo Build<T>()
    {
        FooFormat format = GetFormat<T>();
        return new Foo(format);
    }

    private FooFormat GetFormat<T>()
    {
        if (typeof(T) == typeof(ArrayFooFormat)) return new ArrayFooFormat(new List<string>());
        if (typeof(T) == typeof(BooleanFooFormat)) return new BooleanFooFormat();
        return new DefaultFooFormat();
    }
} 
```

即使这样，他们也需要从我的抽象工厂中为他们的特定上下文派生一个工厂。

我专门在 html 上下文中构建 foos，如下所示：

```
public class HtmlFoo : FooDecorator
{
    public HtmlFoo(IFoo foo) : base(foo) { }

    public string ToHtml()
    {
        return "<div>" + this.Format.ToString() + "</div>";
    }
}

public class HtmlFooFactory : FooFactory
{
    public IFoo BuildFoo<T>()
    {
        IFoo foo = Build<T>();
        return new HtmlFoo(foo);
    }
}

public class HtmlFooConsumer
{
    public void DoSomeFoo()
    {
        var factory = new HtmlFooFactory();
        var htmlBooleanFoo = factory.BuildFoo<BooleanFooFormat>();
        var htmlArrayFoo = factory.BuildFoo<ArrayFooFormat>();
    }
} 
```

我的问题出在我的抽象 FooFactory 中：我总是将一个空值列表注入到我的 ArrayFooFormat 中。我希望能够从消费者那里传递一个值列表。对于其他 FooFormats，我想从消费者那里传递正确的构造函数参数。但我想让公共 API 保持简单——我不希望 BuildFoo() 上有一堆重载。

那么如何从 HtmlFooConsumer.DoSomeFoo() 内部将自定义值列表传递给 factory.BuildFoo<T>() 调用？任何想法，stackoverflow大师？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T06:28:25.970

也许您可以按照这些思路做一些事情，将您的抽象 FooFormat 变为 IFooFormat 并且通用 FooFormat 提供了一个传递参数的 Init 方法。

然后一个 Build 的重载允许你传入参数。

```
public interface IFooFormat
{
}

public class FooFormat<TValue> : IFooFormat
{
    private TValue _value;

    public void Init(TValue value)
    {
        _value = value;
    }

    public TValue Value
    {
        get { return _value; }
    }
}

public class ArrayFooFormat : FooFormat<IList<string>> { }

public class BooleanFooFormat : FooFormat<bool> { }

public class DefaultFooFormat : IFooFormat { }

public interface IFoo { }

public class Foo : IFoo
{
    private IFooFormat _format;

    internal Foo(IFooFormat format)
    {
        _format = format;
    }

    public IFooFormat Format { get { return _format; } }
}

public class FooFactory
{
    protected IFoo Build<TFormat, TArg>(TArg arg) where TFormat : FooFormat<TArg>, new()
    {
        TFormat format = new TFormat();
        format.Init(arg);
        return new Foo(format);
    }

    protected IFoo Build<TFormat>() where TFormat : IFooFormat, new()
    {
        return new Foo(new TFormat());
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T09:32:35.053

工厂基本上是静态变量的面向对象版本。我会避免一起使用一个。与其强迫客户使用工厂，也许您可​​以简单地将对象注入到他们的构造函数中，从而避开对工厂的需求。

# linux - 在 *nix 中清空目录最安全的方法是什么？

> ID：373156
> 
> 赞同：6
> 
> 时间：2008-12-16T23:30:31.010
> 
> 标签：linux, unix, command-line

我害怕有一天，我会在我目前使用的命令中放置一个空格或遗漏一些东西：

```
rm -rf ./* 
```

有没有更安全的方法来清空当前目录的内容？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-16T23:40:52.503

最安全的方法是在按 Enter 之前坐在您的手上。

除此之外，您可以创建一个像这样的别名（对于 Bash）

```
别名 rm="pwd;read;rm"

```

这将向您显示您的目录，等待输入，然后删除您使用正确标志指定的内容。您可以通过按 ^C 而不是 Enter 来取消。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T23:52:19.530

这是一种更安全的方法：`ls`首先使用列出将受到影响的文件，然后使用命令行历史记录或历史记录替换来更改`ls`to`rm`并在确信将操作正确的文件后再次执行该命令。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-16T23:46:21.477

如果您想真正安全，可以创建一个简单的别名或 shell 脚本，例如：

mv $1 ~/.recycle/

这只会将你的东西移动到 .recycle 文件夹（你好，Windows！）。

然后设置一个 cron 作业来对该文件夹中超过一周的内容执行 rm -rf 。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-17T00:00:33.413

我认为这是一种合理的方式：

```
find . -maxdepth 1 \! -name . -print0 | xargs -0 rm -rf 
```

它还将处理隐藏的文件和目录。点之后不需要斜杠，这也将消除可能的打字事故`. /`。

现在，如果您担心它会删除什么，只需将其更改为

```
find . -maxdepth 1 \! -name . -print  | less 
```

并查看列表。现在你可以把它放到一个函数中：

```
function enum_files { find . -maxdepth 1 \! -name . "$@"; } 
```

现在您的删除是安全的：

```
enum_files | less                     # view the files
enum_files -print0 | xargs -0 rm -rf  # remove the files 
```

如果您不习惯在文件名中嵌入换行符，则可以省略`-print0`and`-0`参数。但我会使用它们，以防万一:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-16T23:37:58.937

上一级并输入目录名称

```
rm -rf <dir>/* 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-16T23:41:06.247

我使用以下之一：

```
rm -fr .

cd ..; rm -fr name-of-subdirectory 
```

我很少充分地附加到一个我想摆脱其内容但必须保留目录本身的目录。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-16T23:52:05.570

使用 rm -rf 时，我几乎总是使用完全限定的路径。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-21T09:33:47.927

使用[`trash`](http://code.google.com/p/trash-cli/)命令。在 Debian/Ubuntu/etc. 中，它可以从 package 安装`trash-cli`。它适用于文件和目录（因为它实际上是在移动文件，而不是立即删除它）。

`trash`实现了[freedesktop.org 垃圾规范](http://www.freedesktop.org/wiki/Specifications/trash-spec)，与 GNOME 和 KDE 垃圾兼容。

可以使用`restore-trash`同一个包中的文件或通过通常的 GUI 取消删除文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-16T23:33:37.977

您可以随时打开`-i`它会在每个文件上提示您，但这对于大型目录来说真的很耗时。

我总是做`pwd`第一个。

我什至会创建一个别名，以便为我的用户强制提示。我认为 Red Hat 默认会这样做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-16T23:34:17.553

您可以删除“f”开关，它会提示您输入每个文件，以确保您确实要删除它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T00:28:24.060

如果您要做的是炸毁整个目录，那么该操作总是存在一定程度的危险。如果你真的想确保你做的事情是正确的，你总是可以做一个移动操作到某个地方，比如 /tmp，等待一段时间，以确保在“删除”到位的情况下一切正常。然后进入 /tmp 目录并仅使用相对路径进行强制和递归删除操作。另外，在移动中重命名为“delete-directoryname”，以便更容易不出错。

例如我想删除 /opt/folder 所以我这样做：

mv /opt/文件夹 /tmp/删除文件夹

....等待以确保一切正常-也许一分钟，也许一周....

光盘 /tmp

密码

rm -rf 删除文件夹/

执行 rm -rf 最重要的提示是始终使用相对路径。这可以防止您在完成输入之前输入 /。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-17T09:02:43.087

我有 [tcsh] 是有原因的：

```
alias clean  '\rm -i -- "#"* *~'
alias rmo    'rm -- *.o' 
```

它们是我第一次不小心在 * 和 .o 之间放置一个空格时创建的。我只想说，发生的事情不是我预期的……

但情况可能会更糟。早在 90 年代初，我的一个朋友就有一个**~/etc**目录。他想删除它。不幸的是，他输入**了 rm -rf /etc**。不幸的是，他以 root 身份登录。他有一个糟糕的一天！

* * *

作恶：**touch -- '-rf *'**

为了安全起见，请使用**'--'**和**-i**。或者做对一次并创建一个别名！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-03-01T07:43:50.163

这是我在 macOS 上使用的别名。它会在执行之前询问每个 rm 命令。

```
# ~/.profile

function saferm() {
    echo rm "$@" 
    echo "" 
    read -p "* execute rm (y/n)? :  " yesorno

    if [ $yesorno == "y" ]; then
         /bin/rm "$@"
    fi
}

alias srm=saferm
alias rm=srm 
```

# javascript - 如何使用参数传递对函数的引用？

> ID：373157
> 
> 赞同：94
> 
> 时间：2008-12-16T23:30:57.750
> 
> 标签：javascript, pass-by-reference, anonymous-function

> **可能重复：**
> [如何在 JavaScript 函数调用中预设参数？（部分功能应用）](https://stackoverflow.com/questions/321113/how-can-i-pre-set-arguments-in-javascript-function-call-partial-function-appli)

我需要能够**传递对具有给定参数集的函数的引用**。

***这是一个不带****参数*传递引用的示例：

```
var f = function () {
    //Some logic here...
};

var fr = f; //Here I am passing a reference to function 'f', without parameters
fr(); //the 'f' function is invoked, without parameters 
```

现在我需要做的是传递相同的`f`函数，但这次我需要将参数传递给引用。现在，我可以使用匿名函数来执行此操作，并`f`在新创建的函数中使用参数调用该函数，如下所示：

```
var f = function () {
        //Some logic here...
    };

var fr = function (pars) {
    f(pars);
}; //Here I am creating an anonymous function, and invoking f inside it

fr({p : 'a parameter'}); //Invoking the fr function, that will later invoke the f function with parameters 
```

但我的问题是，**有没有办法通过`f`参数传递对函数的直接引用 to `fr`，但不将其包含在匿名函数中？**

*我需要分配什么`fr`以使其在没有参数 ( `fr()`) 的情况下可调用，以便在`fr`调用时执行 f(1,2,3)？*

**[更新]** 我关注了[Jason Bunting](https://stackoverflow.com/questions/373157/javascript-passing-a-reference-to-a-function-with-parameters#373216)[的](https://stackoverflow.com/questions/321113)关于*Partial Function*的回答，他在那里发布的 JavaScript 函数正是我想要的。这是解决方案：

```
function partial(func /*, 0..n args */) {
  var args = Array.prototype.slice.call(arguments).splice(1);
  return function() {
    var allArguments = args.concat(Array.prototype.slice.call(arguments));
    return func.apply(this, allArguments);
  };
} 
```

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-12-16T23:53:44.210

您所追求的称为**部分功能应用程序**。

不要被那些不理解这和咖喱之间细微差别的人所愚弄，它们*是*不同的。

部分函数应用可以用来实现，但*不是*柯里化。[**这是一篇关于差异的博客文章**](http://www.uncarved.com/blog/not_currying.mrk)的引述：

> 在部分应用程序接受一个函数并从中构建一个接受较少参数的函数的情况下，currying 通过组合每个接受一个参数的函数来构建接受多个参数的函数。

这已经得到解答，请参阅此问题以获取答案：[**如何在 JavaScript 函数调用中预设参数？**](https://stackoverflow.com/questions/321113)

例子：

```
var fr = partial(f, 1, 2, 3);

// now, when you invoke fr() it will invoke f(1,2,3)
fr(); 
```

再次，请参阅该问题以获取详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-07T11:51:26.333

您还可以重载函数原型：

```
// partially applies the specified arguments to a function, returning a new function
Function.prototype.curry = function( ) {
    var func = this;
    var slice = Array.prototype.slice;
    var appliedArgs = slice.call( arguments, 0 );

    return function( ) {
        var leftoverArgs = slice.call( arguments, 0 );
        return func.apply( this, appliedArgs.concat( leftoverArgs ) );
    };
};

// can do other fancy things:

// flips the first two arguments of a function
Function.prototype.flip = function( ) {
    var func = this;
    return function( ) {
        var first = arguments[0];
        var second = arguments[1];
        var rest = Array.prototype.slice.call( arguments, 2 );
        var newArgs = [second, first].concat( rest );

        return func.apply( this, newArgs );
    };
};

/*
e.g.

var foo = function( a, b, c, d ) { console.log( a, b, c, d ); }
var iAmA = foo.curry( "I", "am", "a" );
iAmA( "Donkey" );
-> I am a Donkey

var bah = foo.flip( );
bah( 1, 2, 3, 4 );
-> 2 1 3 4
*/ 
```

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2008-12-17T00:07:35.040

以下等效于您的第二个代码块：

```
var f = function () {
        //Some logic here...
    };

var fr = f;

fr(pars); 
```

如果你想真正将一个函数的引用传递给其他函数，你可以这样做：

```
function fiz(x, y, z) {
    return x + y + z;
}

// elsewhere...

function foo(fn, p, q, r) {
    return function () {
        return fn(p, q, r);
    }
}

// finally...

f = foo(fiz, 1, 2, 3);
f(); // returns 6 
```

不过，你几乎肯定最好为这类事情使用框架。

# crystal-reports - 您可以在 Crystal Report 中切换分组吗？

> ID：373168
> 
> 赞同：0
> 
> 时间：2008-12-16T23:34:21.923
> 
> 标签：crystal-reports, grouping, master-detail

是否可以有一个对基础数据进行分组的报告，但您可以通过报告上的按钮或其他内容禁用分组？基本上，我希望有一个分组的“摘要报告”，但随后能够在需要时查看下面的详细信息，而无需单独的报告。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T23:39:03.333

将您的数据放在组页眉和页脚中，然后将详细数据放在详细信息部分。在详细信息部分中，将抑制公式设置为基于报告参数。然后，当您想要详细报告时，将参数作为 false 传递，它不会抑制详细信息部分。您也可以通过这种方式切换组的页眉和页脚。

您无法摆脱分组，但如果您想要类似的东西，您可以使用填充的字段进行分组。如果您想要分组，您可以在此字段中填写您需要分组的数据，如果您需要详细信息，只需将该字段设置为空白，然后取消分组页眉和页脚。

# javascript - 我想使用循环将元素向左移动

> ID：373182
> 
> 赞同：0
> 
> 时间：2008-12-16T23:40:27.200
> 
> 标签：javascript

我敢打赌我有一个基本的问题，但我无法解决两个晚上。我有 1 个“ul”元素，我只希望它每例如 2 秒向左移动任意数量的像素。我要他这样一步一步地移动，然后回到原来的位置，重新开始移动。我被卡住了，我的脚本只会将它移动到最终位置并完成。

```
window.onload = function moveUl(){  
var eUl = document.getElementById('change');  
var eLi = eUl.getElementsByTagName('li');
x = -300;

function move(){
    for(i=0;i< eLi.length;i++){
        eUl.style.marginLeft = i*x+'px'; 
    }
} 
setInterval(move,1000);
} 
```

这是我能想到的最简单的。我知道这个脚本在 1 秒后执行整个循环，但我尝试做这样的事情：将此元素移到左侧，等待，再向左移动等等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T23:54:38.747

如果您希望它滑动，则每次迭代都必须超时。尝试编写一个执行单次移位的函数，然后每 10 毫秒调用一次该函数。您还可以查看像[jQuery](http://www.jquery.com)这样的 Javascript 库，它提供了一个很好的 API 来进行移动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T23:57:47.040

你的意思是这样的吗？

```
window.onload = function moveUl()
{
    var eUl = document.getElementById('change');
    var eLi = eUl.getElementsByTagName('li');

    var delta = 0;
    function move()
    {
        for(i=0;i< eLi.length;i++)
            eUl.style.marginLeft = (-300*i+delta)+'px'; 
        delta -= 100; // Prepares for the next step
        if ( delta == -1000 )
            delta = 0; // Resets after 10 steps
    } 
    setInterval(move,1000);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T23:48:17.230

问题是你不能从你开始的地方回去吗？

为什么不在 move 中添加一个新的 for 循环

```
 for(i=eLi.length; i>0 ;i--){
        eUl.style.marginLeft = i*x+'px'; 
    } 
```

您是否还希望它永远循环，即开始-> 左-> 开始-> 左并再次循环？

# c# - Mathematical function differentiation with C#?

> ID：373186
> 
> 赞同：7
> 
> 时间：2008-12-16T23:41:33.280
> 
> 标签：c#, math, function

I see that I can declare a function with (say)

```
public double Function(double parameter) 
```

but what if I do want to take the derivative of that function?

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-12-17T00:23:47.393

您无法使用计算机程序计算函数的精确导数（除非您正在做符号数学......但这是另一个更复杂的主题）。

有几种方法可以计算函数的*数值*导数。最简单的是居中三点法：

*   取一个小数 h
*   评估 `[f(x+h) - f(x-h)] / 2h`
*   瞧，f'(x) 的近似值，只有两个函数评估

另一种方法是居中五点法：

*   取一个小数 h
*   评估`[f(x-2h) - 8f(x-h) + 8f(x+h) - f(x+2h)] / 12h`
*   瞧，f'(x) 的更好近似，但它需要更多的函数评估

* * *

另一个主题是如何使用 C# 实现这一点。首先，您需要一个代表函数的委托，该函数将实数的子集映射到实数的另一个子集：

```
delegate double RealFunction(double arg); 
```

然后，您需要一个评估导数的路由：

```
public double h = 10e-6; // I'm not sure if this is valid C#, I'm used to C++

static double Derivative(RealFunction f, double arg)
{
    double h2 = h*2;
    return (f(x-h2) - 8*f(x-h) + 8*f(x+h) - f(x+h2)) / (h2*6);
} 
```

如果你想要一个面向对象的实现，你应该创建以下类：

```
interface IFunction
{
    // Since operator () can't be overloaded, we'll use this trick.
    double this[double arg] { get; }
}

class Function : IFunction
{
    RealFunction func;

    public Function(RealFunction func)
    { this.func = func; }

    public double this[double arg]
    { get { return func(arg); } }
}

class Derivative : IFunction
{
    IFunction func;
    public static double h = 10e-6;

    public Derivative(IFunction func)
    { this.func = func; }

    public double this[double arg]
    {
        get
        {
            double h2 = h*2;
            return (
                func[arg - h2] - func[arg + h2] +
                ( func[arg + h]  - func[arg - h] ) * 8
                ) / (h2 * 6);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-16T23:56:27.527

If you're thinking of symbolic manipulation of formulae then you're better off doing your derivations in languages like Maple or Mathematica. They're designed for symbolic computation.

EDIT: If Maple and Mathematica are too expensive for you then there are other options. Wikipedia has a fairly complete listing of computer algebra packages. [http://en.wikipedia.org/wiki/Comparison_of_computer_algebra_systems](http://en.wikipedia.org/wiki/Comparison_of_computer_algebra_systems)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T23:46:58.183

Are you thinking of Lambda Expressions?

Basically you can pass a function into a function.

So think of a Sort on an object. Depending on the nature of the object would help determine how the objects are sorted.

But you can still create a generic sort function then pass in how to compare objects.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-24T07:57:33.433

另一种方法可以是使用众所周知的导数定义来利用扩展方法并相应地计算其近似值。

正如已经提到的，这对于数字方法而不是符号方法来说非常容易：

```
public partial static class IEnumerableExtensions
{
    public static IEnumerable<Double> Derivate1<TSource>(this IEnumerable<TSource> source, Func<TSource, Double> selectorX, Func<TSource, Double> selectorY)
    {
        var enumerator = source.GetEnumerator();

        enumerator.Reset();
        enumerator.MoveNext();

        var itemPrevious = enumerator.Current;
        var itemNext = default(TSource);

        while (enumerator.MoveNext())
        {
            itemNext = enumerator.Current;

            var itemPreviousX = selectorX(itemPrevious);
            var itemPreviousY = selectorY(itemPrevious);

            var itemNextX = selectorX(itemNext);
            var itemNextY = selectorY(itemNext);

            var derivative = (itemNextY - itemPreviousY) / (itemNextX - itemPreviousX);

            yield return derivative;

            itemPrevious = itemNext;
        }
    }
} 
```

或者如果你更喜欢`foreach`时尚

```
public partial static class IEnumerableExtensions
{
     public static IEnumerable<Double> Derivate2<TSource>(IEnumerable<TSource> source, Func<TSource, Double> selectorX, Func<TSource, Double> selectorY)
     {
         var itemPrevious = source.First();

         source = source.Skip(1);

         foreach (var itemNext in source)
         {
             var itemPreviousX = selectorX(itemPrevious);
             var itemPreviousY = selectorY(itemPrevious);

             var itemNextX = selectorX(itemNext);
             var itemNextY = selectorY(itemNext);

             var derivative = (itemNextY - itemPreviousY) / (itemNextX - itemPreviousX);

             yield return derivative;

             itemPrevious = itemNext;
        }
    }
} 
```

您可以重构所有内容，如下所示：

```
public static partial class MathHelpers
{
    public static Double Derivate(Double xPrevious, Double xNext, Double yPrevious, Double yNext)
    {
        var derivative = (yNext - yPrevious)/(xNext - xPrevious);

        return derivative;
    }
}

public static class IEnumerableExtensions
{
     public static IEnumerable<Double> Derivate<TSource>(IEnumerable<TSource> source, Func<TSource, Double> selectorX, Func<TSource, Double> selectorY)
     {
         var itemPrevious = source.First();

         source = source.Skip(1);

         foreach (var itemNext in source)
         {
             var derivative = MathHelpers.Derivate(selectorX(itemPrevious), selectorX(itemNext), selectorY(itemPrevious), selectorY(itemNext));

             yield return derivative;

             itemPrevious = itemNext;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-16T23:55:34.673

If you have written the function, it's already been derived.

And given that it's an int function, I'll assume you don't mean the calculus definition of "derive".

# python - XmlStream.addObserver 中的 XPath 无法正常工作

> ID：373189
> 
> 赞同：1
> 
> 时间：2008-12-16T23:42:35.213
> 
> 标签：python, twisted

我想做的是只对指定的根元素做出反应。例如，如果用户发送如下所示的 XmlStream：

```
<auth>
    <login>user</login>
    <pass>dupa.8</pass>
</auth> 
```

我的方法 ._auth 应该被执行。我已经使用在 connectionMade 方法中调用的 addObserver 方法完成了它。

```
self.addObserver("/auth", self._auth) 
```

AFAIK XPath - 如果我写“/auth”，这意味着我希望我的根元素是“auth”，所以该消息：

```
<longtagislong>
    <auth>...</auth>
</longtagislong> 
```

...应该被拒绝，因为 auth 不是 root。

但是，Twisted 并没有按照我认为的方式工作——我的 _auth 方法在第二条消息出现时执行（树中有 auth 元素），而不是第一条消息——以 auth 元素为根。

所以，我的问题是：如何告诉 Twisted 和 addObserver 方法我只想在根元素的名称是“auth”时做出反应？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T13:40:33.837

好的，我终于得到了答案。这是因为 XmlStream 本身。只要主根元素未关闭，连接就处于活动状态（例如：`<stream/>`）。它里面的所有东西都是 XPath 的根元素，这就是为什么“/auth”意味着`<stream><auth></auth></stream>`.

# java - 什么是类路径地狱，它是否真的是 Java 的问题？

> ID：373193
> 
> 赞同：26
> 
> 时间：2008-12-16T23:44:47.767
> 
> 标签：java, history

什么是类路径地狱，它是否真的是 Java 的问题？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-17T00:05:02.487

类路径地狱是 Java 执行的那种动态链接的不幸结果。

您的程序不是固定实体，而是 JVM 在特定实例中加载的确切类集。

由于解析规则，很有可能在不同平台上甚至在同一个平台上的相同命令行会导致完全不同的结果。

标准库中可能存在差异（非常常见）。库可以相互隐藏（甚至可以使用旧版本而不是新版本）。目录结构可能会弄乱解析。同一个类的不同版本可能会出现在多个库中，并且将使用第一个遇到的版本，等等。由于 Java 按照规范使用第一次遇到的策略，未知的排序依赖关系可能会导致问题。当然，由于这是命令行并且是规范的一部分，因此没有真正的警告。

这仍然是一个问题。例如，在 Mac OS 上，来自 Apple 的可怕支持意味着您的机器最终会使用多个 JVM 和多个 JRE，并且您永远无法轻松地将东西从一个地方转移到另一个地方。如果您有多个针对特定但不同版本的其他库编译的库，您可能会遇到问题等。

然而，这个问题并不是 Java 所固有的。我记得我在 90 年代编写 Windows 时遇到的 DLL 地狱情况。在任何情况下，您必须依靠文件系统中的某些东西来组装您的程序，而不是拥有一个定义明确的可执行文件，这都是一个问题。

不过，这种模式的好处还是很大的，所以我愿意忍受这个地狱。孙这边也有朝着正确方向的台阶。例如，Java6 允许您简单地使用 jar 指定一个目录，而不必枚举它们。

顺便说一句：如果您使用的是使用非默认类加载器的环境，类路径也是一个问题。例如，由于类加载器不兼容，我在 Eclipse 下运行 Hibernate 或 Digester 时遇到了很多问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T00:54:35.507

如果对您的项目有意义，Classpath/jar-hell 有几个逃生舱口：

*   [操作系统](http://en.wikipedia.org/wiki/OSGi)
*   [JarJarLinks](http://code.google.com/p/jarjar/)
*   [NetBeans 模块系统](http://www.antonioshome.net/kitchen/netbeans/nbms-theplatform.php)- 不确定这是否可以在 NetBeans 之外使用
*   其他的？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T00:25:19.480

我认为“类路径地狱”是指 Java 应用程序的类路径只能通过使用 CLASSPATH 环境变量来设置的时间。这导致许多应用程序需要更改全局系统配置（每个操作系统都不同）、应用程序之间的版本冲突以及普遍的混乱。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-12-06T14:53:02.233

这是一个更具体的例子：

> 当两个库（或一个库和应用程序）需要同一个第三个库的不同版本时。如果第三个库的两个版本都使用相同的类名，则无法使用相同的类加载器加载第三个库的两个版本。

在[http://en.wikipedia.org/wiki/Java_Classloader#JAR_hell](http://en.wikipedia.org/wiki/Java_Classloader#JAR_hell)获取更多示例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-16T23:52:58.453

这里有很多好东西[http://mindprod.com/jgloss/classpath.html](http://mindprod.com/jgloss/classpath.html)和[http://java.sun.com/javase/6/docs/technotes/tools/windows/classpath.html](http://java.sun.com/javase/6/docs/technotes/tools/windows/classpath.html)

当我没有设置自己使用-cp时，我只遇到了类路径问题。试图弄清楚你的第三方软件如何设置他们的类路径有时会很痛苦。

# python - 用于 MD5 哈希的 Python 正则表达式

> ID：373194
> 
> 赞同：22
> 
> 时间：2008-12-16T23:45:02.807
> 
> 标签：python, regex, md5

我想出了：

```
re.findall("([a-fA-F\d]*)", data) 
```

但这不是很简单，有没有更好的方法来获取所有 MD5 哈希码？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-12-16T23:51:02.607

好吧，因为 md5 只是一个 32 位十六进制数字的字符串，所以您可以添加到表达式中的只是检查“32 位数字”，也许是这样的？

```
re.findall(r"([a-fA-F\d]{32})", data) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-17T00:31:29.873

在 Python 中使用正则表达式时，您应该几乎总是使用原始字符串语法`r"..."`：

```
re.findall(r"([a-fA-F\d]{32})", data) 
```

这将确保字符串中的反斜杠不会被正常的 Python 转义解释，而是传递给`re.findall`函数，以便它可以`\d`逐字查看。在这种情况下，您很幸运`\d`没有被 Python 转义解释，而是类似的东西`\b`（在 Python 转义和正则表达式中具有完全不同的含义）。

有关更多信息，请参阅[`re`模块文档](http://python.org/doc/2.5/lib/module-re.html)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-18T04:13:35.620

这是比其他一些解决方案更好的方法：

```
re.findall(r'(?i)(?<![a-z0-9])[a-f0-9]{32}(?![a-z0-9])', data) 
```

这确保匹配必须是 32 个十六进制数字字符的字符串，*但不包含在更大的其他字母数字字符字符串中。*对于所有其他解决方案，如果有一个由 37 个连续十六进制组成的字符串，则该模式将匹配前 32 个并将其称为匹配，或者如果有一个由 64 个十六进制组成的字符串，它将把它分成两半并将每一半作为独立的匹配匹配。排除这些是通过lookahead 和lookbehind 断言完成的，它们是非捕获的，不会影响匹配的内容。

还要注意 (?i) 标志，这将使模式不区分大小写，从而节省一点打字，并且将整个模式包装在括号中是多余的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-10T18:52:35.877

这是一个相当迂腐的表达：

```
r"\b([a-f\d]{32}|[A-F\d]{32})\b" 
```

*   字符串长度必须正好为 32 个字符，
*   字符串必须在单词边界（换行符、空格等）之间，
*   alpha 必须全部为小写 af***或***全部为大写 AF，但不能混合。

但是，如果这还不够好，因为您知道获得全数字 MD5 校验和的机会只有 3402823 分之一，而获得全字母数字 MD5 校验和的机会只有 42 万亿分之一，那么您知道我们可能应该对那些有效的总和说 FU，也不接受任何不是字母数字的东西：

```
r"\b(?!^[\d]*$)(?!^[a-fA-F]*$)([a-f\d]{32}|[A-F\d]{32})\b"

00000000000000000000000000000000 # not MD5
01110101001110011101011010101001 # not MD5
ffffffffffffffffffffffffffffffff # not MD5
A32efC32c79823a2123AA8cbDDd3231c # not MD5
affa687a87f8abe90d9b9eba09bdbacb # is MD5
C787AFE9D9E86A6A6C78ACE99CA778EE # is MD5
please like and subscribe to my  # not MD5 
```

是的，我在工作中非常无聊。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-08T21:46:02.433

## 带有示例的 MD5 Python 正则表达式

由于 MD5 正好由 32 个十六进制字符组成，并且有时哈希使用小写字母表示，因此也应该考虑它们。

* * *

下面的示例针对四个不同的字符串进行了测试：

*   有效的小写 MD5 哈希
*   有效的大写 MD5 哈希
*   64 个十六进制字符的字符串（以确保不会发生拆分和匹配）
*   由 37 个十六进制字符组成的字符串（以确保前 32 个字符不匹配）

> 900e3f2dd4efc9892793222d7a1cee4a
> 
> AC905DD4AB2038E5F7EABEAE792AC41B
> 
> 900e3f2dd4efc9892793222d7a1cee4a900e3f2dd4efc9892793222d7a1cee4a
> 
> 900e3f2dd4efc9892793222d7a1cee4a4a4a4

* * *

```
 validHash = re.finditer(r'(?=(\b[A-Fa-f0-9]{32}\b))', datahere)

    result = [match.group(1) for match in validHash]

    if result: 

        print "Valid MD5"

    else:

        print "NOT a Valid MD5" 
```

* * *

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-16T23:51:00.127

“([a-fA-F\d]{32})” 要求它的长度为 32 个字符怎么样？

# python - 使用标准的“关闭”按钮关闭 easygui Python 脚本

> ID：373212
> 
> 赞同：3
> 
> 时间：2008-12-16T23:52:47.033
> 
> 标签：python, user-interface, tkinter, easygui

我创建了一个*非常*简单的应用程序，它提供了一个 easygui entrybox() 并在它接收到用户输入时继续无限循环。

我可以使用取消按钮退出程序，因为这将返回 None，但我也希望能够使用标准的“关闭”按钮退出程序。（即，Windows 窗口的右上角，Mac 窗口的左上角）此按钮当前没有任何作用。

看一下easygui模块，我发现了这一行：

```
root.protocol('WM_DELETE_WINDOW', denyWindowManagerClose ) 
```

这似乎是罪魁祸首。我不是 TKinter 专家，但我可能会弄清楚如何改变这个处理程序以按照我想要的方式行事。

但是，由于我不想弄乱easygui模块，有没有办法从我的主脚本中覆盖这种行为，并让关闭按钮直接关闭程序或返回None？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-23T17:04:00.300

它需要改变 easygui 模块，是的。我会修改的！

** 我已向 EasyGUI 创建者发送了一封电子邮件，解释了这一点 [2009 年 1 月 23 日下午 12:12]

** 我只想说这种变化发生的可能性——如果有的话，我怀疑——非常小。你看，EasyGUI 旨在成为一种创建 GUI 的简单、离散的方式。我认为这个添加不会有任何帮助，特别是因为界面是非常连续的，所以它会让新用户感到困惑。[2009 年 1 月 23 日下午 12:19]

** EasyGUI 创建者在回复我的电子邮件时这样说：

> easygui 对话框永远不应该退出应用程序——它应该将一个值传回给调用者并让调用者决定要做什么。
> 
> 但这是一个有趣的想法。与简单地忽略单击“关闭”图标不同，easygui 框可以返回与单击“取消”按钮返回的值相同的值。我会思考这个。
> 
> ——史蒂夫·弗格

我认为这至少是一种进步。[2:40 PM，2009 年 1 月 23 日]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T00:24:29.373

我现在不知道，但你有没有尝试过这样的事情？：

```
root.protocol('WM_DELETE_WINDOW',  self.quit) 
```

或者

```
root.protocol('WM_DELETE_WINDOW',  self.destroy) 
```

我没试过，但谷歌类似`"Tkinter protocol WM_DELETE_WINDOW"`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-19T22:16:44.587

我找到了一个解决方案，答案在选择框下方，当他定义了一些函数（你可以直接键入找到denyWindowManagerClose）并转到他定义的地方。只需擦除它并将此代码放在它的位置。

```
 def denyWindowManagerClose():
#------------------------------------------------------------------
#  Changed by ProgrammingBR
#  Enables the user to close the window without entering a value
#  Youtube URL: https://www.youtube.com/channel/UCTZh6kWz_iYACNE6Jcy2lhw
#------------------------------------------------------------------
    global __enterboxText
    __enterboxText = None
    boxRoot.quit() 
```

您可以创建一个备份文件，但这适用于所有盒子，除此之外这里给出的建议将不起作用，我尝试了它们。如果你想看我有一个视频（它是葡萄牙语，但你可以关注它）只需转到 youtube 频道，我会尽快上传并在此处发布链接 :)

# .net - Proper way to get a Winforms UI to block with a dialog until some non-user driven event conditioin?

> ID：373214
> 
> 赞同：2
> 
> 时间：2008-12-16T23:53:00.387
> 
> 标签：.net, winforms, multithreading, architecture, timer

I was asking about specifics with this approach earlier today [here](https://stackoverflow.com/questions/372572/how-to-block-the-ui-thread-from-another-thread-or-force-a-form-to-run-within-th) but the confused responses has me wondering if I'm going about this all wrong.

So here's the problem. I need to architect a WinForms application that periodically checks a value from some external service. If it is in a certain state the application is supposed to pop up a modal form blocking the user from interacting with the application until such time that the state changes. The blocked UI should act just like when a form is displayed using ShowDialog(). That is to say the user should not be able to interact with the ui in any way until the dialog is closed (in this case this can only be done by the application).

In my particular application I have the requirement crop up in several instances. For example, at one point the application runs a timer that repeatedly checks the value of a cell in a db table that is constantly being updated by a weighing device. If the value is below a certain threshold the user is prompted to place items on the scale - he or she may not proceed nor interact with the UI until they do so.

Every solution I have tried has been chock full of threading problems. Either the dialog won't block the UI, or the timer will not continue checking the external service or the application cannot close the form when the time comes.

This seems like a fairly standard winforms requirement and there must be a relevant design pattern that does not bring in Windows.Forms.Timer (I like keep it [my views passive](http://codebetter.com/blogs/jeremy.miller/archive/2007/05/30/build-your-own-cab-part-4-the-passive-view.aspx)). How would you do this?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T02:23:27.807

上一篇文章（使用 Join()）阻止了 UI，但也阻止了它的渲染，显示一个空白（白色）窗口，就像应用程序崩溃一样。更好的选择是创建一个自定义模式窗口（用户无法移动或关闭或执行任何操作），其中包含一个事件侦听器，该事件侦听器将在其处理程序中关闭窗口。然后，一旦您的称重设备检测到重量，它就可以触发事件（或以某种方式与您的应用程序、网络服务、ipc 等通信）以通知它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T23:58:50.407

You might want to block the current thread until an other thread do the check in the background. This can be done by joining (`.Join()`) the thread that do the check in the background. This on will block the calling thread until it's over. If I have more time I'll make a snippet code for you, but this might give you an idea.

Here is the code (Form1 and add 2 buttons : Button1 and Button2).

```
public partial class Form1 : Form
{
    Random r = new Random();
    public Form1()
    {
        InitializeComponent();
    }
    Thread tCheck;
    private void Form1_Load(object sender, EventArgs e)
    {
        tCheck = new Thread(new ThreadStart(checkMethod));

    }

    private void button1_Click(object sender, EventArgs e)
    {
        this.Text = r.Next(0, 10).ToString();
        if (tCheck.ThreadState == ThreadState.Stopped)
        {
            this.button1.Text = "Stopped";
        }
    }

    // checks a value from some external service HERE
    private void checkMethod()
    {
        int i =0;
        while(i<20)
        {
            Thread.Sleep(200);
            i++;
        }

    }

    private void button2_Click(object sender, EventArgs e)
    {
        tCheck.Start();
        Thread.Sleep(500);
        tCheck.Join();//blocking the user from interacting with the application until such time that the state changes
    }
} 
```

Click button 2 and the thread will block all until the method with check for external value (this is done for this example will the loop).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T02:12:14.173

终于想出了一个感觉自然且效果很好的解决方案。诀窍最终是阅读[Albahari 线程电子书](http://www.albahari.com/threading/part2.aspx#_ManualResetEvent)并了解 ManualResetEvent。

这是它的工作原理。你在你的类上声明一个 ManualResetEvent 的实例，当你到达你的应用程序应该在调用 resetEvent.WaitOne(timeout) 时阻塞的点时。这会阻塞线程，直到另一个线程（正在检查某些条件调用 resetEvent.Set()。这是我的完整课程。

```
/// <summary>
/// If necessary, resolve the tare for a given transaction by querying the measurement 
/// device and comparing with a threshold.  Will block until an appropriate tare is provided 
/// or a timeout condition is met.
/// </summary>
    public class TareResolver {
    private IDevice _device;
        private IDialogFactory _dialogs;
        private ManualResetEvent _resolvedEvent = new ManualResetEvent(false);
        ICurrentDateTimeFactory _nowFactory;
    ICheckInSettings _settings;
    ITimer _timer;
    private UnitOfMeasureQuantityPair _threshold;
        public TareResolver(IDevice device, IDialogFactory dialogs, ICheckInSettings settings, ICurrentDateTimeFactory nowFactory) {
            _device = device;
            _dialogs = dialogs;
        _settings = settings;
            _nowFactory = nowFactory;
        _timer = new DriverInterface2.Domain.Utilities.Timer(_settings.TarePollFreqeuency);
        _timer.Tick += new Action(_timer_Tick);
    }

    void _timer_Tick() {
        if (ThresholdMet(_device.CurrentValue, _threshold)) 
            _resolvedEvent.Set();
    }

        public virtual UnitOfMeasureQuantityPair Resolve(Transaction transaction) {
        _threshold = _settings.TareThreshold;
            if (!ThresholdMet(_device.CurrentValue, _threshold)) {
                var dialog = _dialogs.GetProvideTareDialog();
                dialog.Show();
            _timer.Start();
            if (!_resolvedEvent.WaitOne(_settings.TakeTareTimeout, false)) {
                _timer.Stop();
                dialog.Hide();
                throw new TimeoutException("Tare provider operation has either been cancelled or has timed out");
            }
            _timer.Stop();
                dialog.Hide();
            }
            return _device.CurrentValue;
        }

        private bool ThresholdMet(UnitOfMeasureQuantityPair val, UnitOfMeasureQuantityPair thresh) {
            if ((thresh == null) || (val >= thresh))
                return true;
            return false;
        }       
    } 
```

# .net - wcf 服务绑定中的相对 url

> ID：373219
> 
> 赞同：10
> 
> 时间：2008-12-16T23:55:17.030
> 
> 标签：.net, wcf, silverlight

我有一个silverlight 控件，它引用了启用silverlight 的wcf 服务。

当我在 silverlight 控件中添加对服务的引用时，它会将以下内容添加到我的 clientconfig 文件中：

```
<configuration>
    <system.serviceModel>
        <bindings>
            <basicHttpBinding>
                <binding name="BasicHttpBinding_DataAccess" maxBufferSize="2147483647"
                    maxReceivedMessageSize="2147483647">
                    <security mode="None" />
                </binding>
            </basicHttpBinding>
        </bindings>
        <client>
            <endpoint address="http://localhost:3097/MyApp/DataAccess.svc"
                binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_DataAccess"
                contract="svcMyService.DataAccess" name="BasicHttpBinding_DataAccess" />
        </client>
    </system.serviceModel>
</configuration> 
```

如何在端点地址中指定相对 url 而不是绝对 url？无论我将 Web 应用程序部署到何处，我都希望它能够工作，而无需编辑 clientconfig 文件，因为 silverlight 组件和 Web 应用程序将始终一起部署。我以为我可以只指定“DataAccess.svc”，但它似乎不喜欢那样。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-17T17:46:48.583

我的解决方案：

我没有使用 devault 构造函数（它使用 ServiceReferences.ClientConfig 文件）来实例化我的代理类，而是使用以下内容：

```
svcMyService.DataAccessClient svcProxy_m;

System.ServiceModel.BasicHttpBinding binding = new System.ServiceModel.BasicHttpBinding();

/*
Create an end point, build a an absolute uri reference by specifing the host address and a relative referece to the service page.
Application.Current.Host.Source will be something like Http://server/app/ClientBin/SilverlightApp.xap"<br/><br/>
Specifying Uri(Application.Current.Host.Source, "../DataAccess.svc")); will return "Http://server/app/DataAccess.svc"
*/

System.ServiceModel.EndpointAddress address = new System.ServiceModel.EndpointAddress(new Uri(Application.Current.Host.Source, "../DataAccess.svc"));

svcProxy_m = new svcMyService.DataAccessClient(binding, address); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T00:29:08.130

您不能在客户端端点配置中使用相对 URI。您可以做的只是向您的代理类添加另一个构造函数，该构造函数将采用某种 URL 参数，您可能可以从另一个配置值或使用 Dns 类方法之一获取这些参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-28T10:37:34.090

我在配置中使用了相对 uri，并且我的 SL4 应用程序可以正常工作。

```
<configuration>
    <system.serviceModel>
        <bindings>
            <basicHttpBinding>
                <binding name="BasicHttpBinding_ICorrectionService" maxBufferSize="2147483647"
                    maxReceivedMessageSize="2147483647" textEncoding="utf-8" transferMode="Buffered">
                    <security mode="None" />
                </binding>
            </basicHttpBinding>
        </bindings>        
        <client>
            <endpoint address="/CorrectionService.svc"
            binding="basicHttpBinding" bindingConfiguration="BasicHttpBinding_ICorrectionService"
            contract="CorrectionService.ICorrectionService" name="BasicHttpBinding_ICorrectionService" />
        </client>        
    </system.serviceModel>
</configuration> 
```

# delphi - 创建二维快速报告

> ID：373229
> 
> 赞同：1
> 
> 时间：2008-12-17T00:01:03.787
> 
> 标签：delphi, delphi-7, quickreports

我想我要求 Quickreport 提供正确类型的报告。

我们有一张简单的桌子，

```
gauge,site,value 
```

Gauge 和 site 是关键字段，（可能有任意数量的 Gauge-Site Pairs）通常最多只有大约 10 个站点。

我们正在寻找一个看起来像这样的报告

```
 site1   site2   site3
gauge1   34      4      45
gauge2   45      6       5
gauge4   34      4      45 
```

剂量谁知道

*   这种报表一般叫什么类型，（所以google可以更多帮助）
*   如果可以的话，是否可以使用 QuickReport 创建这种类型的报告
    ，有什么想法吗？
    如果没有，关于可以使用什么的任何想法？

Delphi7
QuickReports 3.5
NexusDB（不要认为这很重要）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T01:57:25.380

它被称为交叉表。谷歌搜索“交叉表”、“交叉表报告”、“交叉表对象”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T15:46:29.707

也许您可以创建一个 memtable（例如使用 JVCL 套件的 memoryData（免费）），然后打印一个普通报告。

# c# - 检查 SqlDataReader 对象中的列名

> ID：373230
> 
> 赞同：228
> 
> 时间：2008-12-17T00:01:19.670
> 
> 标签：c#, .net, sqldatareader

如何检查`SqlDataReader`对象中是否存在列？在我的数据访问层中，我创建了一个为多个存储过程调用构建相同对象的方法。其中一个存储过程具有其他存储过程未使用的附加列。我想修改该方法以适应每种情况。

我的应用程序是用 C# 编写的。

* * *

## 回答 #1

> 赞同：353
> 
> 时间：2009-05-01T23:51:06.473

```
public static class DataRecordExtensions
{
    public static bool HasColumn(this IDataRecord dr, string columnName)
    {
        for (int i=0; i < dr.FieldCount; i++)
        {
            if (dr.GetName(i).Equals(columnName, StringComparison.InvariantCultureIgnoreCase))
                return true;
        }
        return false;
    }
} 
```

像在其他一些答案中一样将`Exception`s 用于控制逻辑被[认为是不好的做法](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/exception-throwing)并且具有性能成本。它还会将误报发送到#异常抛出的分析器，上帝帮助任何人设置他们的调试器来打破抛出的异常。

GetSchemaTable() 也是许多答案中的另一个建议。这不是检查字段是否存在的首选方式，因为它并非在所有版本中都实现（它是抽象的，并且在某些版本的 dotnetcore 中抛出 NotSupportedException）。[GetSchemaTable 在性能方面也过于矫枉过正，因为如果您查看源代码](https://github.com/microsoft/referencesource/blob/24a17c0c3b23ddeac0926acc13b13c54b650d3be/System.Data/System/Data/SqlClient/SqlDataReader.cs#L422)，它是一个非常繁重的功能。

如果您经常使用循环字段，可能会对性能产生很小的影响，并且您可能需要考虑缓存结果。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-05-01T23:33:23.523

正确的代码是：

```
public static bool HasColumn(DbDataReader Reader, string ColumnName) { 
    foreach (DataRow row in Reader.GetSchemaTable().Rows) { 
        if (row["ColumnName"].ToString() == ColumnName) 
            return true; 
    } //Still here? Column not found. 
    return false; 
} 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2013-12-09T08:06:58.740

在一行中，在 DataReader 检索后使用它：

```
var fieldNames = Enumerable.Range(0, dr.FieldCount).Select(i => dr.GetName(i)).ToArray(); 
```

然后，

```
if (fieldNames.Contains("myField"))
{
    var myFieldValue = dr["myField"];
    ... 
```

**编辑**

不需要加载模式的更高效的单线：

```
var exists = Enumerable.Range(0, dr.FieldCount).Any(i => string.Equals(dr.GetName(i), fieldName, StringComparison.OrdinalIgnoreCase)); 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-12-17T00:12:19.740

我认为您最好的选择是预先在 DataReader 上调用[GetOrdinal("columnName")](http://msdn.microsoft.com/en-us/library/system.data.idatarecord.getordinal.aspx)，并在该列不存在的情况下捕获 IndexOutOfRangeException 。

其实我们来做一个扩展方法：

```
public static bool HasColumn(this IDataRecord r, string columnName)
{
    try
    {
        return r.GetOrdinal(columnName) >= 0;
    }
    catch (IndexOutOfRangeException)
    {
        return false;
    }
} 
```

**编辑**

好的，这篇文章最近开始获得一些反对票，我不能删除它，因为它是公认的答案，所以我要更新它并（我希望）尝试证明使用异常处理是合理的控制流。

[正如Chad Grant](https://stackoverflow.com/questions/373230/check-for-column-name-in-a-sqldatareader-object/813741#813741)所发布的，实现此目的的另一种方法是遍历 DataReader 中的每个字段，并对您要查找的字段名称进行不区分大小写的比较。这将非常有效，并且说实话可能会比我上面的方法更好。当然，我永远不会在性能成为问题的循环中使用上述方法。

我可以想到一种情况，其中 try/GetOrdinal/catch 方法将在循环不起作用的情况下起作用。然而，现在这是一个完全假设的情况，所以这是一个非常站不住脚的理由。无论如何，请耐心等待，看看您的想法。

想象一个允许您为表中的列“别名”的数据库。想象一下，我可以定义一个表，其中包含一个名为“EmployeeName”的列，但也给它一个别名“EmpName”，并且选择任一名称都会返回该列中的数据。跟我到现在？

现在想象一下，该数据库有一个 ADO.NET 提供程序，并且他们为它编写了一个 IDataReader 实现，它考虑了列别名。

现在，`dr.GetName(i)`（如乍得的回答中所使用的）只能返回一个字符串，因此它必须只返回*一个*列上的“别名”。但是，`GetOrdinal("EmpName")`可以使用此提供程序字段的内部实现来检查每个列的别名以查找您要查找的名称。

在这种假设的“列别名”情况下，try/GetOrdinal/catch 方法将是确保您检查结果集中列名称的每个变体的唯一方法。

脆弱？当然。但值得深思。老实说，我更喜欢 IDataRecord 上的“官方” HasColumn 方法。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2012-03-06T19:28:09.670

这是 Jasmin 想法的工作示例：

```
var cols = r.GetSchemaTable().Rows.Cast<DataRow>().Select
    (row => row["ColumnName"] as string).ToList(); 

if (cols.Contains("the column name"))
{

} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2015-06-24T22:32:54.023

以下内容很简单，对我有用：

```
 bool hasMyColumn = (reader.GetSchemaTable().Select("ColumnName = 'MyColumnName'").Count() == 1); 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2015-09-03T20:21:44.563

这对我有用：

```
bool hasColumnName = reader.GetSchemaTable().AsEnumerable().Any(c => c["ColumnName"] == "YOUR_COLUMN_NAME"); 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-05-11T15:50:33.373

我为 Visual Basic 用户编写了这个：

```
Protected Function HasColumnAndValue(ByRef reader As IDataReader, ByVal columnName As String) As Boolean
    For i As Integer = 0 To reader.FieldCount - 1
        If reader.GetName(i).Equals(columnName) Then
            Return Not IsDBNull(reader(columnName))
        End If
    Next

    Return False
End Function 
```

我认为这更强大，用法是：

```
If HasColumnAndValue(reader, "ID_USER") Then
    Me.UserID = reader.GetDecimal(reader.GetOrdinal("ID_USER")).ToString()
End If 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-08-30T19:01:04.403

如果您阅读了这个问题，迈克尔问的是 DataReader，而不是 DataRecord 人。让你的对象正确。

在 DataRecord 上使用 a`r.GetSchemaTable().Columns.Contains(field)`确实有效，但它会返回 BS 列（请参见下面的屏幕截图。）

要查看数据列是否存在并包含 DataReader 中的数据，请使用以下扩展：

```
public static class DataReaderExtensions
{
    /// <summary>
    /// Checks if a column's value is DBNull
    /// </summary>
    /// <param name="dataReader">The data reader</param>
    /// <param name="columnName">The column name</param>
    /// <returns>A bool indicating if the column's value is DBNull</returns>
    public static bool IsDBNull(this IDataReader dataReader, string columnName)
    {
        return dataReader[columnName] == DBNull.Value;
    }

    /// <summary>
    /// Checks if a column exists in a data reader
    /// </summary>
    /// <param name="dataReader">The data reader</param>
    /// <param name="columnName">The column name</param>
    /// <returns>A bool indicating the column exists</returns>
    public static bool ContainsColumn(this IDataReader dataReader, string columnName)
    {
        /// See: http://stackoverflow.com/questions/373230/check-for-column-name-in-a-sqldatareader-object/7248381#7248381
        try
        {
            return dataReader.GetOrdinal(columnName) >= 0;
        }
        catch (IndexOutOfRangeException)
        {
            return false;
        }
    }
} 
```

用法：

```
 public static bool CanCreate(SqlDataReader dataReader)
    {
        return dataReader.ContainsColumn("RoleTemplateId") 
            && !dataReader.IsDBNull("RoleTemplateId");
    } 
```

* * *

调用`r.GetSchemaTable().Columns`DataReader 返回 BS 列：

![在 DataReader 中调用 GetSchemeTable](https://i.stack.imgur.com/TuYCX.png)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2019-09-18T21:43:47.287

**TLDR：**

关于性能和不良做法的说法有很多答案，所以我在这里澄清一下。

返回列数越多，异常路径越快，列数越少，循环路径越快，交叉点在 11 列左右。滚动到底部以查看图表和测试代码。

**完整答案：**

一些顶级答案的代码有效，但这里有一个潜在的争论，即基于逻辑中异常处理的接受及其相关性能的“更好”答案。

为了清除这一点，我认为没有太多关于*捕获*异常的指导。Microsoft 确实有[一些](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/exception-throwing)关于*抛出*异常的指导。他们在那里声明：

> *如果可能，不要*对正常的控制流使用异常。

第一个注意是“如果可能”的宽大处理。更重要的是，描述给出了这样的背景：

> 框架设计者应该设计 API，以便用户可以编写不抛出异常的代码

这意味着，如果您正在编写一个可能被其他人使用的 API，请让他们能够在不使用 try/catch 的情况下导航异常。例如，为您的抛出异常的 Parse 方法提供 TryParse。 **尽管您不应该捕获异常，但这并没有说明任何地方。**

此外，正如另一位用户指出的那样，catch 总是允许按类型过滤，并且最近允许通过[when 子句](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/when)进行进一步过滤。如果我们不应该使用它们，这似乎是对语言功能的浪费。

可以说，抛出异常是有*一定*成本的，而这个成本*可能会*影响重循环中的性能。但是，也可以说，在“连接的应用程序”中，异常的成本可以忽略不计。十多年前对实际成本进行了调查：*[C# 中的异常有多昂贵？](https://stackoverflow.com/questions/891217/how-expensive-are-exceptions-in-c/891230#891230)*

换句话说，数据库连接和查询的成本可能比抛出异常的成本相形见绌。

除此之外，我想确定哪种方法真正更快。正如预期的那样，没有具体的答案。

随着列数的增加，任何在列上循环的代码都会变慢。也可以说任何依赖异常的代码都会变慢，这取决于查询失败的速度。

[接受Chad Grant](https://stackoverflow.com/questions/373230/check-for-column-name-in-a-sqldatareader-object/813741#813741)和[Matt Hamilton](https://stackoverflow.com/questions/373230/check-for-column-name-in-a-sqldatareader-object/373250#373250)的答案，我运行了两种方法，最多有 20 列和高达 50% 的错误率（OP 表示他在不同的存储过程之间使用这两个测试，所以我假设只有两个）。

以下是使用[LINQPad](https://en.wikipedia.org/wiki/LINQPad)绘制的结果：

[![结果 - 系列 1 是循环，2 是异常](https://i.stack.imgur.com/H0gPW.png)](https://i.stack.imgur.com/H0gPW.png)

这里的之字形是每列计数中的故障率（未找到列）。

在较窄的结果集上，循环是一个不错的选择。但是，GetOrdinal/Exception 方法对列数几乎没有那么敏感，并且在 11 列左右开始优于循环方法。

也就是说，我对性能并没有真正的偏好，因为 11 列听起来很合理，因为在整个应用程序中返回的平均列数是合理的。在这两种情况下，我们在这里讨论的都是几分之一毫秒。

但是，从代码简单性和别名支持的角度来看，我可能会选择 GetOrdinal 路线。

这是 LINQPad 形式的测试。随意用自己的方法转发：

```
void Main()
{
    var loopResults = new List<Results>();
    var exceptionResults = new List<Results>();
    var totalRuns = 10000;
    for (var colCount = 1; colCount < 20; colCount++)
    {
        using (var conn = new SqlConnection(@"Data Source=(localdb)\MSSQLLocalDb;Initial Catalog=master;Integrated Security=True;"))
        {
            conn.Open();

            //create a dummy table where we can control the total columns
            var columns = String.Join(",",
                (new int[colCount]).Select((item, i) => $"'{i}' as col{i}")
            );
            var sql = $"select {columns} into #dummyTable";
            var cmd = new SqlCommand(sql,conn);
            cmd.ExecuteNonQuery();

            var cmd2 = new SqlCommand("select * from #dummyTable", conn);

            var reader = cmd2.ExecuteReader();
            reader.Read();

            Func<Func<IDataRecord, String, Boolean>, List<Results>> test = funcToTest =>
            {
                var results = new List<Results>();
                Random r = new Random();
                for (var faultRate = 0.1; faultRate <= 0.5; faultRate += 0.1)
                {
                    Stopwatch stopwatch = new Stopwatch();
                    stopwatch.Start();
                    var faultCount=0;
                    for (var testRun = 0; testRun < totalRuns; testRun++)
                    {
                        if (r.NextDouble() <= faultRate)
                        {
                            faultCount++;
                            if(funcToTest(reader, "colDNE"))
                                throw new ApplicationException("Should have thrown false");
                        }
                        else
                        {
                            for (var col = 0; col < colCount; col++)
                            {
                                if(!funcToTest(reader, $"col{col}"))
                                    throw new ApplicationException("Should have thrown true");
                            }
                        }
                    }
                    stopwatch.Stop();
                    results.Add(new UserQuery.Results{
                        ColumnCount = colCount,
                        TargetNotFoundRate = faultRate,
                        NotFoundRate = faultCount * 1.0f / totalRuns,
                        TotalTime=stopwatch.Elapsed
                    });
                }
                return results;
            };
            loopResults.AddRange(test(HasColumnLoop));

            exceptionResults.AddRange(test(HasColumnException));

        }

    }
    "Loop".Dump();
    loopResults.Dump();

    "Exception".Dump();
    exceptionResults.Dump();

    var combinedResults = loopResults.Join(exceptionResults,l => l.ResultKey, e=> e.ResultKey, (l, e) => new{ResultKey = l.ResultKey, LoopResult=l.TotalTime, ExceptionResult=e.TotalTime});
    combinedResults.Dump();
    combinedResults
        .Chart(r => r.ResultKey, r => r.LoopResult.Milliseconds * 1.0 / totalRuns, LINQPad.Util.SeriesType.Line)
        .AddYSeries(r => r.ExceptionResult.Milliseconds * 1.0 / totalRuns, LINQPad.Util.SeriesType.Line)
        .Dump();
}
public static bool HasColumnLoop(IDataRecord dr, string columnName)
{
    for (int i = 0; i < dr.FieldCount; i++)
    {
        if (dr.GetName(i).Equals(columnName, StringComparison.InvariantCultureIgnoreCase))
            return true;
    }
    return false;
}

public static bool HasColumnException(IDataRecord r, string columnName)
{
    try
    {
        return r.GetOrdinal(columnName) >= 0;
    }
    catch (IndexOutOfRangeException)
    {
        return false;
    }
}

public class Results
{
    public double NotFoundRate { get; set; }
    public double TargetNotFoundRate { get; set; }
    public int ColumnCount { get; set; }
    public double ResultKey {get => ColumnCount + TargetNotFoundRate;}
    public TimeSpan TotalTime { get; set; }

} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-03-13T00:58:50.083

这是已接受答案的单行 LINQ 版本：

```
Enumerable.Range(0, reader.FieldCount).Any(i => reader.GetName(i) == "COLUMN_NAME_GOES_HERE") 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-04-24T11:33:23.167

这是 Jasmine 在一行中的解决方案......（还有一个，虽然很简单！）：

```
reader.GetSchemaTable().Select("ColumnName='MyCol'").Length > 0; 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-05-09T09:28:21.210

```
Hashtable ht = new Hashtable();

Hashtable CreateColumnHash(SqlDataReader dr)
{
    ht = new Hashtable();
    for (int i = 0; i < dr.FieldCount; i++)
    {
        ht.Add(dr.GetName(i), dr.GetName(i));
    }
    return ht;
}

bool ValidateColumn(string ColumnName)
{
    return ht.Contains(ColumnName);
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-12-17T12:52:26.507

为了使您的代码保持健壮和干净，请使用单个扩展函数，如下所示：

```
 Public Module Extensions

        <Extension()>
        Public Function HasColumn(r As SqlDataReader, columnName As String) As Boolean

            Return If(String.IsNullOrEmpty(columnName) OrElse r.FieldCount = 0, False, Enumerable.Range(0, r.FieldCount).Select(Function(i) r.GetName(i)).Contains(columnName, StringComparer.OrdinalIgnoreCase))

        End Function

    End Module 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-04-28T04:55:14.943

此代码纠正了 Levitikon 的代码问题：（改编自：[1]：http: [//msdn.microsoft.com/en-us/library/system.data.datatablereader.getschematable.aspx](http://msdn.microsoft.com/en-us/library/system.data.datatablereader.getschematable.aspx)）

```
public List<string> GetColumnNames(SqlDataReader r)
{
    List<string> ColumnNames = new List<string>();
    DataTable schemaTable = r.GetSchemaTable();
    DataRow row = schemaTable.Rows[0];
    foreach (DataColumn col in schemaTable.Columns)
    {
        if (col.ColumnName == "ColumnName") 
        { 
            ColumnNames.Add(row[col.Ordinal].ToString()); 
            break; 
        }
    }
    return ColumnNames;
} 
```

从表中获取所有这些无用的列名而不是列名的原因......是因为您正在获取架构列的名称（即架构表的列名）

注意：这似乎只返回第一列的名称......

编辑：更正了返回所有列名称的代码，但**您不能使用 SqlDataReader 来执行此操作**

```
public List<string> ExecuteColumnNamesReader(string command, List<SqlParameter> Params)
{
    List<string> ColumnNames = new List<string>();
    SqlDataAdapter da = new SqlDataAdapter();
    string connection = ""; // your sql connection string
    SqlCommand sqlComm = new SqlCommand(command, connection);
    foreach (SqlParameter p in Params) { sqlComm.Parameters.Add(p); }
    da.SelectCommand = sqlComm;
    DataTable dt = new DataTable();
    da.Fill(dt);
    DataRow row = dt.Rows[0];
    for (int ordinal = 0; ordinal < dt.Columns.Count; ordinal++)
    {
        string column_name = dt.Columns[ordinal].ColumnName;
        ColumnNames.Add(column_name);
    }
    return ColumnNames; // you can then call .Contains("name") on the returned collection
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-04-22T07:07:53.787

我也没有`GetSchemaTable`去上班，直到我找到[了这条路](http://www.pcreview.co.uk/forums/showpost.php?s=7db84afd9f0d5fc0ba6991ad61702c85&p=3581074&postcount=2)。

基本上我这样做：

```
Dim myView As DataView = dr.GetSchemaTable().DefaultView
myView.RowFilter = "ColumnName = 'ColumnToBeChecked'"

If myView.Count > 0 AndAlso dr.GetOrdinal("ColumnToBeChecked") <> -1 Then
  obj.ColumnToBeChecked = ColumnFromDb(dr, "ColumnToBeChecked")
End If 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-03-09T23:12:29.260

```
public static bool DataViewColumnExists(DataView dv, string columnName)
{
    return DataTableColumnExists(dv.Table, columnName);
}

public static bool DataTableColumnExists(DataTable dt, string columnName)
{
    string DebugTrace = "Utils::DataTableColumnExists(" + dt.ToString() + ")";
    try
    {
        return dt.Columns.Contains(columnName);
    }
    catch (Exception ex)
    {
        throw new MyExceptionHandler(ex, DebugTrace);
    }
} 
```

`Columns.Contains`顺便说一句，不区分大小写。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-08-18T07:43:02.433

在您的特定情况下（所有过程都有相同的列，除了一个有额外的一列），检查阅读器的*FieldCount*属性以区分它们会更好更快。

```
const int NormalColCount = .....
if(reader.FieldCount > NormalColCount)
{
    // Do something special
} 
```

您还可以（出于性能原因）将此解决方案与解决方案迭代解决方案混合。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-05-14T19:40:44.300

我的数据访问类需要向后兼容，因此我可能会尝试访问数据库中尚不存在的版本中的列。我们返回了一些相当大的数据集，因此我不喜欢必须为每个属性迭代 DataReader 列集合的扩展方法。

我有一个实用程序类，它创建一个列的私有列表，然后有一个通用方法尝试根据列名和输出参数类型解析值。

```
private List<string> _lstString;

public void GetValueByParameter<T>(IDataReader dr, string parameterName, out T returnValue)
{
    returnValue = default(T);

    if (!_lstString.Contains(parameterName))
    {
        Logger.Instance.LogVerbose(this, "missing parameter: " + parameterName);
        return;
    }

    try
    {
        if (dr[parameterName] != null && [parameterName] != DBNull.Value)
            returnValue = (T)dr[parameterName];
    }
    catch (Exception ex)
    {
        Logger.Instance.LogException(this, ex);
    }
}

/// <summary>
/// Reset the global list of columns to reflect the fields in the IDataReader
/// </summary>
/// <param name="dr">The IDataReader being acted upon</param>
/// <param name="NextResult">Advances IDataReader to next result</param>
public void ResetSchemaTable(IDataReader dr, bool nextResult)
{
    if (nextResult)
        dr.NextResult();

    _lstString = new List<string>();

    using (DataTable dataTableSchema = dr.GetSchemaTable())
    {
        if (dataTableSchema != null)
        {
            foreach (DataRow row in dataTableSchema.Rows)
            {
                _lstString.Add(row[dataTableSchema.Columns["ColumnName"]].ToString());
            }
        }
    }
} 
```

然后我可以像这样调用我的代码

```
using (var dr = ExecuteReader(databaseCommand))
{
    int? outInt;
    string outString;

    Utility.ResetSchemaTable(dr, false);        
    while (dr.Read())
    {
        Utility.GetValueByParameter(dr, "SomeColumn", out outInt);
        if (outInt.HasValue) myIntField = outInt.Value;
    }

    Utility.ResetSchemaTable(dr, true);
    while (dr.Read())
    {
        Utility.GetValueByParameter(dr, "AnotherColumn", out outString);
        if (!string.IsNullOrEmpty(outString)) myIntField = outString;
    }
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-11-13T18:46:53.107

整个问题的关键在[这里](https://referencesource.microsoft.com/#System.Data/fx/src/data/System/Data/Common/FieldNameLookup.cs,e5864d2bc96964b9)：

```
if (-1 == index) {
    throw ADP.IndexOutOfRange(fieldName);
} 
```

如果引用的三行（当前为第 72、73 和 74 行）被取出，那么您可以轻松检查`-1`以确定该列是否不存在。

在确保本机性能的同时解决此问题的唯一方法是使用`Reflection`基于实现，如下所示：

用途：

```
using System;
using System.Data;
using System.Reflection;
using System.Data.SqlClient;
using System.Linq;
using System.Web.Compilation; // I'm not sure what the .NET Core equivalent to BuildManager.cs 
```

基于反射的扩展方法：

```
/// Gets the column ordinal, given the name of the column.
/// </summary>
/// <param name="reader"></param>
/// <param name="name">The name of the column.</param>
/// <returns> The zero-based column ordinal. -1 if the column does not exist.</returns>
public static int GetOrdinalSoft(this SqlDataReader reader, string name)
{
    try
    {
        // Note that "Statistics" will not be accounted for in this implemenation
        // If you have SqlConnection.StatisticsEnabled set to true (the default is false), you probably don't want to use this method
        // All of the following logic is inspired by the actual implementation of the framework:
        // https://referencesource.microsoft.com/#System.Data/fx/src/data/System/Data/SqlClient/SqlDataReader.cs,d66096b6f57cac74
        if (name == null)
            throw new ArgumentNullException("fieldName");

        Type sqlDataReaderType = typeof(SqlDataReader);
        object fieldNameLookup = sqlDataReaderType.GetField("_fieldNameLookup", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(reader);
        Type fieldNameLookupType;
        if (fieldNameLookup == null)
        {
            MethodInfo checkMetaDataIsReady = sqlDataReaderType.GetRuntimeMethods().First(x => x.Name == "CheckMetaDataIsReady" && x.GetParameters().Length == 0);
            checkMetaDataIsReady.Invoke(reader, null);
            fieldNameLookupType = BuildManager.GetType("System.Data.ProviderBase.FieldNameLookup", true, false);
            ConstructorInfo ctor = fieldNameLookupType.GetConstructor(new[] { typeof(SqlDataReader), typeof(int) });
            fieldNameLookup = ctor.Invoke(new object[] { reader, sqlDataReaderType.GetField("_defaultLCID", BindingFlags.NonPublic | BindingFlags.Instance).GetValue(reader) });
        }
        else
            fieldNameLookupType = fieldNameLookup.GetType();

        MethodInfo indexOf = fieldNameLookupType.GetMethod("IndexOf", BindingFlags.Public | BindingFlags.Instance, null, new Type[] { typeof(string) }, null);

        return (int)indexOf.Invoke(fieldNameLookup, new object[] { name });
    }
    catch
    {
        // .NET Implemenation might have changed, revert back to the classic solution.
        if (reader.FieldCount > 11) // Performance observation by b_levitt
        {
            try
            {
                return reader.GetOrdinal(name);
            }
            catch
            {
                return -1;
            }
        }
        else
        {
            var exists = Enumerable.Range(0, reader.FieldCount).Any(i => string.Equals(reader.GetName(i), name, StringComparison.OrdinalIgnoreCase));
            if (exists)
                return reader.GetOrdinal(name);
            else
                return -1;
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2008-12-17T00:27:43.283

如果您想要列列表并且您不想遇到异常，您也可以在 DataReader 上调用[GetSchemaTable() ...](http://support.microsoft.com/kb/310107)

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2011-01-12T16:18:05.827

采用：

```
if (dr.GetSchemaTable().Columns.Contains("accounttype"))
   do something
else
   do something 
```

在循环中它可能不会那么有效。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2018-05-02T01:33:54.757

虽然没有公开公开的方法，但在依赖的内部类`System.Data.ProviderBase.FieldNameLookup`中确实存在方法。`SqlDataReader`

为了访问它并获得本机性能，您必须使用 ILGenerator 在运行时创建一个方法。以下代码将使您可以直接访问`int IndexOf(string fieldName)`该类`System.Data.ProviderBase.FieldNameLookup`以及执行簿记，`SqlDataReader.GetOrdinal()`这样就不会产生副作用。生成的代码镜像现有的`SqlDataReader.GetOrdinal()`，除了它调用`FieldNameLookup.IndexOf()`而不是`FieldNameLookup.GetOrdinal()`. 该`GetOrdinal()`方法调用`IndexOf()`函数并在返回时抛出异常`-1`，因此我们绕过该行为。

```
using System;
using System.Data;
using System.Data.SqlClient;
using System.Reflection;
using System.Reflection.Emit;

public static class SqlDataReaderExtensions {

   private delegate int IndexOfDelegate(SqlDataReader reader, string name);
   private static IndexOfDelegate IndexOf;

   public static int GetColumnIndex(this SqlDataReader reader, string name) {
      return name == null ? -1 : IndexOf(reader, name);
   }

   public static bool ContainsColumn(this SqlDataReader reader, string name) {
      return name != null && IndexOf(reader, name) >= 0;
   }

   static SqlDataReaderExtensions() {
      Type typeSqlDataReader = typeof(SqlDataReader);
      Type typeSqlStatistics = typeSqlDataReader.Assembly.GetType("System.Data.SqlClient.SqlStatistics", true);
      Type typeFieldNameLookup = typeSqlDataReader.Assembly.GetType("System.Data.ProviderBase.FieldNameLookup", true);

      BindingFlags staticflags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.IgnoreCase | BindingFlags.Static;
      BindingFlags instflags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.IgnoreCase | BindingFlags.Instance;

      DynamicMethod dynmethod = new DynamicMethod("SqlDataReader_IndexOf", typeof(int), new Type[2]{ typeSqlDataReader, typeof(string) }, true);
      ILGenerator gen = dynmethod.GetILGenerator();
      gen.DeclareLocal(typeSqlStatistics);
      gen.DeclareLocal(typeof(int));

      // SqlStatistics statistics = (SqlStatistics) null;
      gen.Emit(OpCodes.Ldnull);
      gen.Emit(OpCodes.Stloc_0);
      // try {
      gen.BeginExceptionBlock();
      //    statistics = SqlStatistics.StartTimer(this.Statistics);
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Call, typeSqlDataReader.GetProperty("Statistics", instflags | BindingFlags.GetProperty, null, typeSqlStatistics, Type.EmptyTypes, null).GetMethod);
      gen.Emit(OpCodes.Call, typeSqlStatistics.GetMethod("StartTimer", staticflags | BindingFlags.InvokeMethod, null, new Type[] { typeSqlStatistics }, null));
      gen.Emit(OpCodes.Stloc_0); //statistics
      //    if(this._fieldNameLookup == null) {
      Label branchTarget = gen.DefineLabel();
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Ldfld, typeSqlDataReader.GetField("_fieldNameLookup", instflags | BindingFlags.GetField));
      gen.Emit(OpCodes.Brtrue_S, branchTarget);
      //       this.CheckMetaDataIsReady();
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Call, typeSqlDataReader.GetMethod("CheckMetaDataIsReady", instflags | BindingFlags.InvokeMethod, null, Type.EmptyTypes, null));
      //       this._fieldNameLookup = new FieldNameLookup((IDataRecord)this, this._defaultLCID);
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Ldfld, typeSqlDataReader.GetField("_defaultLCID", instflags | BindingFlags.GetField));
      gen.Emit(OpCodes.Newobj, typeFieldNameLookup.GetConstructor(instflags, null, new Type[] { typeof(IDataReader), typeof(int) }, null));
      gen.Emit(OpCodes.Stfld, typeSqlDataReader.GetField("_fieldNameLookup", instflags | BindingFlags.SetField));
      //    }
      gen.MarkLabel(branchTarget);
      gen.Emit(OpCodes.Ldarg_0); //this
      gen.Emit(OpCodes.Ldfld, typeSqlDataReader.GetField("_fieldNameLookup", instflags | BindingFlags.GetField));
      gen.Emit(OpCodes.Ldarg_1); //name
      gen.Emit(OpCodes.Call, typeFieldNameLookup.GetMethod("IndexOf", instflags | BindingFlags.InvokeMethod, null, new Type[] { typeof(string) }, null));
      gen.Emit(OpCodes.Stloc_1); //int output
      Label leaveProtectedRegion = gen.DefineLabel();
      gen.Emit(OpCodes.Leave_S, leaveProtectedRegion);
      // } finally {
      gen.BeginFaultBlock();
      //    SqlStatistics.StopTimer(statistics);
      gen.Emit(OpCodes.Ldloc_0); //statistics
      gen.Emit(OpCodes.Call, typeSqlStatistics.GetMethod("StopTimer", staticflags | BindingFlags.InvokeMethod, null, new Type[] { typeSqlStatistics }, null));
      // }
      gen.EndExceptionBlock();
      gen.MarkLabel(leaveProtectedRegion);
      gen.Emit(OpCodes.Ldloc_1);
      gen.Emit(OpCodes.Ret);

      IndexOf = (IndexOfDelegate)dynmethod.CreateDelegate(typeof(IndexOfDelegate));
   }

} 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2019-06-14T00:03:58.430

这对我有用：

```
public static class DataRecordExtensions
{
    public static bool HasColumn(IDataReader dataReader, string columnName)
    {
        dataReader.GetSchemaTable().DefaultView.RowFilter = $"ColumnName= '{columnName}'";
        return (dataReader.GetSchemaTable().DefaultView.Count > 0);
    }
} 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2019-10-16T06:30:41.587

采用：

```
if(Enumerable.Range(0,reader.FieldCount).Select(reader.GetName).Contains("columName"))
{
     employee.EmployeeId= Utility.ConvertReaderToLong(reader["EmployeeId"]);
} 
```

您可以从*[Can You get the column names from a SqlDataReader? 获得更多详细信息？](https://stackoverflow.com/questions/681653/can-you-get-the-column-names-from-a-sqldatareader)*.

# c# - C# How do I use "||" in combination with "!="?

> ID：373233
> 
> 赞同：1
> 
> 时间：2008-12-17T00:04:01.333
> 
> 标签：c#

Why does adding an "||" OR between 2 "!=" not work for me?

When 'name' is "test" or "test2" my if statement doesn't work if I've used 2 "!=" but if I use just one it does, please tell me why.

```
if (col.Name != "test" || col.Name != "test2")
 {
  MessageBox.Show("No" + col.Name.ToString()); //This shows "No test" and "No test2"
 }
  else
 {
  MessageBox.Show("YES " + col.Name.ToString()); //does not reach here
 } 
```

this works with no "||".

```
if (col.Name != "test")
 {
  MessageBox.Show("No" + col.Name.ToString());
 }
  else
 {
  MessageBox.Show("YES " + col.Name.ToString()); //Shows "YES test"
 } 
```

Thanks all

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-17T00:06:56.943

try this:

```
col.Name != "test" && col.Name != "test2" 
```

think about it... "if the number is not 1, or the number is not 2" will always be true, since no number is both 1 *and* 2 to makes both halves false. Now extend this to strings.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-17T00:10:20.213

It works, but it's not what you want.

```
col.Name != "test" || col.Name != "test2" 
```

**always returns true**, since if col.Name is "test", it's *not* "test2", so you have "false || true" => true. If col.Name is "test2", you get "true || false". If it's anything else, it evaluates to "true || true".

I can't be sure exactly what you want to do, but you probably need an and (`&&`) between them.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-17T00:10:21.320

You need to do a AND and not a OR :)

Pseudo code:

if string1 not equal test AND not equal test2 than do...

Here is the version corrected :

```
if (col.Name != "test" && col.Name != "test2")
{
  MessageBox.Show("No" + col.Name.ToString()); //This shows "No test" and "No test2"
}
else
{
  MessageBox.Show("YES " + col.Name.ToString()); //does not reach here
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-17T00:10:57.963

You're using OR, consider the truth table:

```
p          q        p || q
true      true      true
true      false     true
false     true      true
false     false     false 
```

You should use AND for the desired behavior...

# perforce - 如何获取我的本地变更列表并将其发送给 Perforce 中的其他人？

> ID：373234
> 
> 赞同：15
> 
> 时间：2008-12-17T00:04:08.087
> 
> 标签：perforce

如何获取我的本地变更列表并将其发送给 Perforce 中的其他人？更具体地说，我想将未提交的更改从本地挂起的更改列表发送到另一个用户的挂起更改列表。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-17T01:53:25.433

```
set P4DIFF=C:\cygwin\bin\diff.exe
p4 diff -du -c 12345 > patch-to-head.diff

# On Other machine
patch -p1 < patch-to-head.diff 
```

我可能在那里的 env var 上错了，您可能需要对 diff 文件进行一些修复，但一般的想法是您生成一个 GNU Unified Diff，您可以将其发送给可以使用 GNU 补丁的人来应用它.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-02-04T20:42:32.797

P4 现在在 2009.2 中原生支持搁置操作。客户端和服务器都需要至少 2009.2 才能使用它。

[http://blog.perforce.com/blog/?p=1872](http://blog.perforce.com/blog/?p=1872)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-07-28T17:43:58.903

搁置待处理的更改列表 YOUCHANGE：

```
p4 shelve [-c YOURCHANGE] 
```

然后另一个用户执行以下操作：

```
p4 unshelve -s YOURCHANGE [-c THEIRCHANGE] 
```

在任何一种情况下，都可以省略“-c”参数以使用默认更改列表。在这种`p4 shelve`情况下，这意味着将创建一个新的更改列表，并将默认更改列表中的文件搁置到其中；在这种`p4 unshelve`情况下，这意味着您的更改列表中搁置的文件将被取消搁置到其他用户的默认更改列表中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-15T13:05:28.373

不确定您到底要做什么，但您可能还想考虑[P4_Shelve](http://public.perforce.com/wiki/P4_Shelve)。它允许您将大量未决更改放在虚拟架子上，然后稍后再将它们取回。根据您通过向其他人发送更改列表来实现的确切目标，这可以提供部分答案。

从 P4Shelve 站点链接的 P4Tar[可能](http://public.perforce.com/wiki/P4tar)也很有用 - 它在客户端完成所有打包工作，因此您只需留下一个可以发送给其他人的文件。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-07-28T15:04:42.347

Perforce 2016，osx。待处理变更列表的差异：

```
mac:src user$ cl=123456 && p4 diff -du $( p4 files @=$cl | sed s/#.*// ) > $cl.diff 
```

输出：123456.diff

应用补丁：

```
mac:src user$ patch -p0 < 123456.diff 
```

# linux - Linux how do I put double quotes around a file before piping it to tar?

> ID：373243
> 
> 赞同：4
> 
> 时间：2008-12-17T00:08:40.763
> 
> 标签：linux, shell, pipe, tar

I use ls to obtain my filename which has white space so it looks something like:

`my file with whitespace.tar.bz2`

I want to pipe this to tar similar to:

```
ls | grep mysearchstring | tar xvjf 
```

How can I insert double quotes before piping it to tar?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T00:34:01.287

一个很好的工具是 find 和 xargs。例如，您可以使用：

```
find . -name '*.tar.bz2' -print0 | xargs -0 -n1 tar xjf 
```

正如pixelbeat建议的那样，您也可以像这样使用shell：

```
for archive in *.tar.bz2; do tar xvjf "$archive"; done 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T08:27:01.567

外壳通配符扩展有什么问题？（假设只有一个文件名。）

```
% tar -cvf   *mysearchstring*
% tar -xvf   *mysearchstring* 
```

当然，匹配 *mysearchstring* 的文件名会有空格。但是 shell [tcsh,bash] 会将该文件名（**包括其空格**）分配给 tar 的单个参数。

您可以使用简单的 C 或 C++ 程序来验证这一点。例如：

```
#include <iostream>
using namespace std;
int main( int argc, char **argv )
{
  cout << "argc = " << argc << endl;
  for ( int i = 0;  i < argc;  i ++ )
    cout << "argv[" << i << "] = \"" << argv[i] << "\"" << endl;
  return 0;
} 
```

试试看： **./a.out *foo***

这就是 CSH 有 :q [quoted wordlist] 选项的原因...

例如 [tcsh]

```
foreach FILE ( *mysearchstring* )
    tar -xvf $FILE:q
end 
```

或者*tar -xvf "$FILE"*而不是*tar -xvf $FILE:q*，如果您愿意的话。

* * *

如果你真的必须使用*ls* ...

使用*ls*通过任何管道传输将每行输出一个文件名。使用*tr*我们可以将换行符转换为任何其他字符，例如 null。 *xargs*可以接收以空字符结尾的字符串。这规避了空间问题。使用*-n1*将克服多文件问题。

例如：\ls | grep 我的搜索字符串 | tr '\012' '\0' | xargs --null -n1 焦油 -xvf

**但我不相信*tar*可以像 OP 那样容纳来自标准输入的多个 tar 文件......**

# php - Zend 框架中如何设计领域层对象来表示多个对象和单个对象？

> ID：373244
> 
> 赞同：6
> 
> 时间：2008-12-17T00:09:29.137
> 
> 标签：php, zend-framework, orm

我正在努力在 Zend Framework 中创建一个与数据访问层分开的域层。数据访问层由两个主要对象组成，一个表数据网关和一个行数据网关。根据 Bill Karwin 对[这个早先问题](https://stackoverflow.com/questions/373054/how-to-properly-create-domain-using-zend-framework)的回复，我现在为我的域 Person 对象提供了以下代码：

```
class Model_Row_Person
{
    protected $_gateway;

    public function __construct(Zend_Db_Table_Row $gateway)
    {
        $this->_gateway = $gateway;
    }

    public function login($userName, $password)
    {

    }

    public function setPassword($password)
    {

    }
} 
```

但是，这仅适用于单个行。我还需要创建一个可以表示整个表的域对象，并且（可能）可以用来遍历表中的所有人员并返回适当类型的人员（管理员、买家等）对象以供使用。基本上，我设想如下：

```
class Model_Table_Person implements SeekableIterator, Countable, ArrayAccess
{
    protected $_gateway;

    public function __construct(Model_DbTable_Person $gateway)
    {
        $this->_gateway = $gateway;
    }

    public function current()
    {
        $current = $this->_gateway->fetchRow($this->_pointer);

        return $this->_getUser($current);
    }

    private function _getUser(Zend_Db_Table_Row $current)
    {
        switch($current->userType)
        {
            case 'admin':
                return new Model_Row_Administrator($current);
                break;
            case 'associate':
                return new Model_Row_Associate($current);
                break;
        }
    }
} 
```

这是处理这个特定问题的好/坏方法吗？我应该对整体设计进行哪些改进或调整？

提前感谢您的评论和批评。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T01:33:24.570

我记得您将使用域模型类来完全隐藏您使用数据库表进行持久性的事实。所以传递一个 Table 对象或一个 Row 对象应该完全在幕后：

```
<?php
require_once 'Zend/Loader.php';
Zend_Loader::registerAutoload();

$db = Zend_Db::factory('mysqli', array('dbname'=>'test',
    'username'=>'root', 'password'=>'xxxx'));
Zend_Db_Table_Abstract::setDefaultAdapter($db);

class Table_Person extends Zend_Db_Table_Abstract
{
    protected $_name = 'person';
}

class Model_Person
{
    /** @var Zend_Db_Table */
    protected static $table = null;

    /** @var Zend_Db_Table_Row */
    protected $person;

    public static function init() {
        if (self::$table == null) {
            self::$table = new Table_Person();
        }
    }

    protected static function factory(Zend_Db_Table_Row $personRow) {
        $personClass = 'Model_Person_' . ucfirst($personRow->person_type);
        return new $personClass($personRow);
    }

    public static function get($id) {
        self::init();
        $personRow = self::$table->find($id)->current();
        return self::factory($personRow);
    }

    public static function getCollection() {
        self::init();
        $personRowset = self::$table->fetchAll();
        $personArray = array();
        foreach ($personRowset as $person) {
            $personArray[] = self::factory($person);
        }
        return $personArray;
    }

    // protected constructor can only be called from this class, e.g. factory()
    protected function __construct(Zend_Db_Table_Row $personRow) {
        $this->person = $personRow;
    }

    public function login($password) {
        if ($this->person->password_hash ==
            hash('sha256', $this->person->password_salt . $password)) {
            return true;
        } else {
            return false;
        }

    }

    public function setPassword($newPassword) {
        $this->person->password_hash = hash('sha256',
            $this->person->password_salt . $newPassword);
        $this->person->save();
    }
}

class Model_Person_Admin extends Model_Person { }
class Model_Person_Associate extends Model_Person { }

$person = Model_Person::get(1);
print "Got object of type ".get_class($person)."\n";
$person->setPassword('potrzebie');

$people = Model_Person::getCollection();
print "Got ".count($people)." people objects:\n";
foreach ($people as $i => $person) {
    print "\t$i: ".get_class($person)."\n";
} 
```

> “我认为静态方法不好，这就是为什么我试图将表级方法创建为实例方法。”

我不接受任何总是不好的笼统声明`static`，或者单身总是不好的，或者`goto`总是不好的，或者你有什么。做出如此明确声明的人正在寻求过度简化问题。适当地使用语言工具，它们会对你有好处。

也就是说，当您选择一种语言结构时，通常会进行权衡，它使某些事情变得更容易，而做其他事情则变得更难。人们经常指出`static`难以编写单元测试代码，而且 PHP 在静态和子类化方面存在一些令人讨厌的缺陷。但也有一些优势，正如我们在这段代码中看到的那样。您必须根据具体情况自行判断优点是否大于缺点。

> “Zend 框架会支持 Finder 类吗？”

我不认为这是必要的。

> “您将 find 方法重命名为模型类中的 get 是否有特殊原因？”

我命名该方法`get()`只是为了区别于`find()`. “getter”范式与 OO 接口相关联，而“finders”传统上与数据库相关联。我们正在尝试设计域模型以假装不涉及数据库。

> “你会继续使用相同的逻辑来实现特定的 getBy 和 getCollectionBy 方法吗？”

我反对创建一个泛型`getBy()`方法，因为它很容易接受一个泛型 SQL 表达式，然后逐字传递给数据访问对象。这将我们的域模型的使用与底层数据库表示相结合。

# c - 带有类型或变量的 sizeof

> ID：373252
> 
> 赞同：25
> 
> 时间：2008-12-17T00:13:34.183
> 
> 标签：c, coding-style, sizeof

最近看到有人赞扬另一个用户使用 sizeof var 而不是 sizeof(type)。我一直认为这只是一种风格选择。有什么显着差异吗？例如，带有 f 和 ff 的行被认为比带有 g 和 gg 的行更好：

```
 typedef struct _foo {} foo;

 foo *f = malloc(count * sizeof f);
 foo *g = malloc(sizeof(foo) * count);

 foo **ff = malloc(count * sizeof *ff);
 foo **gg = malloc(sizeof(foo*) * count); 
```

在我看来，第一组只是风格问题。但是在第二对行中，额外的第二个 * 很容易被混淆为乘法。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-17T00:17:13.787

如果变量的类型改变了，如果变量是参数而不是类型，则不需要改变 sizeof。

关于@icepack 的评论：类型与变量名称更改的可能性或可​​能性不是问题。想象一下变量名被用作 sizeof 的参数，然后再更改。在最好的情况下，重构重命名操作会更改所有出现的事件并且不会引入错误。在最坏的情况下，一个 sizeof 的实例会丢失，编译器会抱怨并修复它。如果类型改变了，你就完成了，在 sizeof 语句中没有错误的可能性。

现在想象类型是 sizeof 的参数。如果变量的类型发生了变化，除了检查之外没有其他方法可以找到与该变量相关的所有 sizeof。您可以搜索，但您将获得相同类型的 sizeof 的所有不相关使用的命中。如果遗漏了一个，由于大小不匹配，您将遇到运行时问题，这要查找起来要麻烦得多。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-17T00:59:25.293

除了史蒂夫所说的，让我补充一点， sizeof 不评估它的操作数。所以你可以自由地做任何事情。您不仅可以使用尚未初始化的变量，还可以取消引用空指针、调用未定义但仅声明的函数以及执行任何其他类型的操作。我鼓励你总是使用表达式版本，因为史蒂夫解释得很清楚。

还要考虑到有时类型名真的很长而且不可读，想想指向函数的指针（尤其是在 C++ 中）。而不是写`sizeof(my_long_type<weird, stuff>)`你只是做`sizeof t`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-22T05:21:56.133

您可能会发现这些之间几乎没有区别：

```
foo **ff = malloc(count * sizeof *ff);
foo **gg = malloc(sizeof(foo*) * count); 
```

..但是如果分配不在声明附近怎么办？如果我遇到这样的一行：

```
ff = realloc(ff, count * sizeof *ff); 
```

那么我有理由相信这条线是正确的，甚至不记得`ff`. 但是，如果我看到这个：

```
ff = realloc(ff, count * sizeof(foo *)); 
```

那么我可能会有些怀疑，需要查一下类型`ff`才能让我放心。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T00:25:45.097

f 和 ff 行肯定比 g 和 gg 差。`sizeof f`是指针大小，因为 f 是一个点。为了使它们等效，您必须编写`sizeof *f`（或者，为了更好的易读性，`sizeof(*f)`）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-19T07:17:27.883

我倾向于`sizeof(type)`在内存分配中使用，但`sizeof(variable)`在使用局部或全局变量时总是如此。尽管如此，始终使用变量名的建议是有智慧的。

我还进行了长时间的讨论（有时相当活跃，并且持续了几天——我们最终同意在这个问题上存在分歧）关于是否可以使用`sizeof(variable)`或是否必须使用`sizeof variable`；也就是说，括号是否将参数括起来是否重要`sizeof`。我从来没有遇到过`sizeof(variable)`对`sizeof`. 我的同事同样坚持括号不能与变量一起使用。不知何故，带括号和不带括号的符号之间存在/曾经是有价值的区别。我没有被说服——我不希望被说服。

在完全不同的策略上，关于以下几点`sizeof`：

*   如果您使用 C99 和 VLA - 可变长度数组 - 那么`sizeof(vla)`它不是编译时常量。谨防！
*   C 预处理器不明白`sizeof`哪个是麻烦但合乎逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T03:37:24.007

取变量的大小可能会产生意想不到的结果。当变量是数组时， sizeof(array) 将返回数组的大小，而不是单个元素的大小或指针的大小。获取指针的大小将返回指针的大小。但是由于数组在传递时通常表示为指针，所以事情会变得混乱。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-20T11:09:58.280

业务逻辑定义您的选择。

1.  如果您的代码引用了一个特定的变量并且没有这个变量，那么您的代码就没有意义 - 选择`sizeof(var)`

2.  如果您的代码处理一组具有特定类型的变量 - 选择`sizeof(type)`。通常，如果您有一个`typedef`定义许多变量的变量，您需要根据它们的类型（例如序列化）以不同的方式处理这些变量。您可能不知道这些变量中的哪些将保留在未来的代码版本中，因此选择类型作为参数在逻辑上是正确的。即使更改此类`typedef`也不会影响您的`sizeof`线路。

# linq - 如何使用 LINQ 计算字符串数组中的单词？

> ID：373253
> 
> 赞同：3
> 
> 时间：2008-12-17T00:15:13.930
> 
> 标签：linq

给定一个像 {"one two", "three 四五"} 这样的数组，你如何使用 LINQ 计算其中包含的单词总数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T00:19:02.223

你可以用 SelectMany 做到这一点：

```
var stringArray = new[] {"one two", "three four five"};
var numWords = stringArray.SelectMany(segment => segment.Split(' ')).Count(); 
```

[SelectMany](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.selectmany.aspx)将生成的序列展平为一个序列，然后为字符串数组的每个项目投影一个空格分割......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T00:28:42.920

我认为 Sum 更具可读性：

```
var list = new string[] { "1", "2", "3 4 5" };
var count = list.Sum(words => words.Split().Length); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T00:33:16.593

或者，如果您想使用 C# 语言扩展：

```
var words = (from line in new[] { "one two", "three four five" }
             from word in line.Split(' ', StringSplitOptions.RemoveEmptyEntries)
             select word).Count(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T00:39:23.587

不是问题的答案（即使用 LINQ 获取数组中的组合字数），但要添加相关信息，您可以使用 strings.split 和 strings.join 执行相同操作：

C＃：

```
string[] StringArray = { "one two", "three four five" }; 
int NumWords = Strings.Split(Strings.Join(StringArray)).Length; 
```

VB.Net：

```
 Dim StringArray() As String = {"one two", "three four five"}
    Dim NumWords As Integer = Split(Join(StringArray)).Length 
```

# php - 隐藏没有产品 magento 的类别

> ID：373257
> 
> 赞同：3
> 
> 时间：2008-12-17T00:17:38.590
> 
> 标签：php, html, magento, e-commerce

我有许多使用主站点的相同根类别的站点。添加的每个产品都会添加到它添加到的站点（哇。）以及主站点。但是，我希望每个站点的类别仅在该站点上有产品时出现。

如果我有：

```
Category1
Category2
Category3 
```

但是Site1只有Category1和Category2的产品，Site2和Site3有Category2和Category3的产品；我只希望 Category1/2 出现在 Site1 上，只有 Category2/3 只出现在 Site2 和 Site3 上。

但是，因为 Site1/2/3 中的所有产品也都添加到了主站点；主站点将列出 Category1/2/3。

没有产品直接添加到主站点。它只是用作其他站点的存储库。

现在，如果没有真正简单的方法来启用此功能（我敢肯定），是否会像编写我自己的主题一样简单，该主题列出了仅在显示模板的网站上有产品的类别？

我不是 Magento 使用的技术的新手。所以编写自定义代码是没有问题的。但是，我不希望对其进行太多编辑，以便将来使用更高版本的 Magento 升级我的代码库会更容易。

谢谢，
-纳尔逊

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T11:43:44.630

好吧，您可以做的是，使用集合（通过模型）创建自己的助手，然后根据产品数量过滤集合。

只是一个粗略的草稿，但我在另一个与 magento 相关的问题中发布了一些代码：[Magento products by categories](https://stackoverflow.com/questions/272818/magento-products-by-categories)。您可以看到它添加产品数量的方式和时间，完成后我会再次过滤。

我不认为这在性能方面非常“出色”，因此您*可以*编写自己的模型类，扩展它并添加默认过滤器，或者直接快捷地访问数据库，而不是使用它们的模型类。

只要您留在皮肤/模板中，更新就没有更大的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-08T18:34:53.510

这是隐藏可能对您有帮助的类别的简单解决方案。

top.phtml 文件的原始内容应如下所示。

```
<?php $_menu = $this->renderCategoriesMenuHtml(0,'level-top') ?>
<?php if($_menu): ?>
<div>
    <ul id="nav">
        <?php echo $_menu ?>
    </ul>
</div>
<?php endif ?> 
```

用下面的代码替换上面的代码。

```
<?php $_menu = ''?>
<?php $excludeCat = array(); ?>
<?php foreach ($this->getStoreCategories() as $_category): ?>
    <?php if($_category->getProductCount() <=0) {
          $excludeCat[] = $_category->getId(); 
    }
    ?>
    <?php $_menu .= $this->drawItem($_category) ?>
<?php endforeach ?>
<?php if ($_menu): ?>
<div>
    <ul id="nav">
    <?php foreach ($this->getStoreCategories() as $_category): ?>
    <?php if (!in_array($_category->getId(), $excludeCat)) : ?> <?php echo $this->drawItem($_category) ?>
    <?php endif; ?>
    <?php endforeach ?>
    </ul>
</div>
<?php endif; ?> 
```

# language-agnostic - 计算 n iid 指数随机变量之和的 95% 置信区间

> ID：373258
> 
> 赞同：1
> 
> 时间：2008-12-17T00:18:36.420
> 
> 标签：language-agnostic, math, statistics

事实上，让我们推广到一个`c`置信区间。设公共速率参数为`a`。（请注意，具有速率参数的指数分布的均值`a`是`1/a`。）

首先找到`n`此类 iid 随机变量之和的 cdf。使用它来计算`c`总和的置信区间。请注意，总和的最大似然估计 (MLE) 是`n/a`，即，`n`乘以单次平局的平均值。

背景：这出现在我正在编写的一个程序中，该程序通过随机样本进行时间估计。如果我根据泊松过程抽取样本（即样本之间的间隙呈指数分布）并且`n`它们发生在活动 X 期间，那么对活动 X 的持续时间有什么好的估计？我很确定答案就是这个问题的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T05:55:11.280

正如 John D. Cook 暗示的那样，iid 指数随机变量的总和具有伽马分布。
这是具有速率参数 a 的 n 个指数随机变量之和的 cdf（用 Mathematica 表示）：

```
F[x_] := 1 - GammaRegularized[n, a*x]; 
```

[http://mathworld.wolfram.com/RegularizedGammaFunction.html](http://mathworld.wolfram.com/RegularizedGammaFunction.html)

逆 cdf 为：

```
Fi[p_] := InverseGammaRegularized[n, 1 - p]/a; 
```

则 c 置信区间为

```
ci[c_, a_, n_] := {Fi[a, n, (1-c)/2], Fi[a, n, c+(1-c)/2]} 
```

以下是一些代码，用于凭经验验证上述内容是否正确：

```
(* Random draw from an exponential distribution given rate param. *)
getGap[a_] := -1/a*Log[RandomReal[]]

betw[x_, {a_, b_}] := Boole[a <= x <= b]

c = .95;
a = 1/.75;
n = 40;
ci0 = ci[c, a, n];
N@Mean@Table[betw[Sum[getGap[a], {n}], ci0], {100000}]

----> 0.94995 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T02:13:23.600

提示：独立指数随机变量之和是一个伽马随机变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T06:22:22.130

我会使用[Chernoff bound](http://en.wikipedia.org/wiki/Chernoff's_inequality)，您可以从中即兴创作一个区间，因为该表达式非常可概括，并且您可以解决有界范围错误 < 0.05 的时间。

Chernoff 界几乎是您可以在不知道太多矩生成函数的情况下对 iid 变量获得的最强界。

# performance - glGetError hangs for several seconds

> ID：373261
> 
> 赞同：1
> 
> 时间：2008-12-17T00:19:50.693
> 
> 标签：performance, opengl, nvidia

I am developing an OpenGL application and I am seeing some strange things happen. The machine I am testing with is equipped with an NVidia Quadro FX 4600 and it is running RHEL WS 4.3 x86_64 (kernel 2.6.9-34.ELsmp).

I've stepped through the application with a debugger and I've noticed that it is hanging on OpenGL calls that are receiving information from the OpenGL API: i.e. - glGetError, glIsEnabled, etc. Each time it hangs up, the system is unresponsive for 3-4 seconds.

Another thing that is interesting is that if this same code is run on RHEL 4.5 (Kernel 2.6.9-67.ELsmp), it runs completely fine. The same code also runs perfectly on Windows XP. All machines are using the exact same hardware:

*   PNY nVidia Quadro FX4600 768mb PCI Express
*   Dual Intel Xeon DP Quad Core E5345 2.33hz
*   4096 MB 667 MHz Fully Buffered DDR2
*   Super Micro X7DAL-E Intel 5000X Chipset Dual Xeon Motherboard
*   Enermax Liberty 620 watt Power Supply

I have upgraded to the latest 64bit drivers: Version 177.82, Release Date: Nov 12, 2008 and the result is the exact same.

Does anyone have any idea what could be causing the system to hang on these OpenGL calls?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T16:39:51.973

It appears that this is an issue with less-than-perfect NVidia drivers for Linux. Upgrading to a newer kernel appears to help. If I am forced to use this dated kernel, there are some things that I've tried that seem to help.

Defining the `__GL_YIELD` environment variable to `"NOTHING"` prior to starting X seems to increase stability with this older kernel. [http://us.download.nvidia.com/XFree86/Linux-x86_64/177.82/README/chapter-11.html](http://us.download.nvidia.com/XFree86/Linux-x86_64/177.82/README/chapter-11.html)

I've also tried disabling Triple Buffering and Flipping.

I've also found that [these forums](http://www.nvnews.net/vbulletin/forumdisplay.php?f=14) are very helpful for Linux/NVidia problems. Just do a search for "linux crash"

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T01:26:27.360

You may be able to dig deeper by using a system profiler like [Sysprof](http://www.daimi.au.dk/~sandmann/sysprof/) or [OProfile](http://oprofile.sourceforge.net/news/). Do other OpenGL applications using these calls exhibit similar behavior?

# language-agnostic - 如何使用 +-*/ 实现 XOR？

> ID：373262
> 
> 赞同：12
> 
> 时间：2008-12-17T00:20:22.797
> 
> 标签：language-agnostic, bit-manipulation, xor

如何仅使用基本算术运算来实现 XOR 操作（在两个 32 位整数上）？依次除以2的每个幂后是否必须按位进行，还是有捷径？我并不关心执行速度，而是关心最简单、最短的代码。

**编辑：** 这不是家庭作业，而是在[hacker.org](http://www.hacker.org)上提出的一个谜语。关键是在基于堆栈的虚拟机上实现 XOR，操作非常有限（类似于[Brainfuck](http://en.wikipedia.org/wiki/Brainfuck)语言，是的 - 没有 shift 或 mod）。使用该虚拟机是困难的部分，尽管通过一种简短而简单的算法当然会变得更容易。

虽然 FryGuy 的解决方案很聪明，但我将不得不采用我最初的理想（类似于 litb 的解决方案），因为在那种环境中也很难使用比较。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-17T02:04:36.020

我会用简单的方法来做：

```
uint xor(uint a, uint b):    

uint ret = 0;
uint fact = 0x80000000;
while (fact > 0)
{
    if ((a >= fact || b >= fact) && (a < fact || b < fact))
        ret += fact;

    if (a >= fact)
        a -= fact;
    if (b >= fact)
        b -= fact;

    fact /= 2;
}
return ret; 
```

可能有更简单的方法，但我不知道。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-17T00:45:35.383

我不知道这是否违背了您的问题的要点，但是您可以使用 AND、OR 和 NOT 实现 XOR，如下所示：

```
uint xor(uint a, uint b) {
   return (a | b) & ~(a & b);
} 
```

在英语中，那是“a or b, but not a and b”，它精确地映射到 XOR 的定义。

当然，我并没有严格遵守您只使用算术运算符的规定，但至少这是一个简单、易于理解的重新实现。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-17T00:32:32.587

对不起，我只知道直截了当的头脑：

```
uint32_t mod_op(uint32_t a, uint32_t b) {
    uint32_t int_div = a / b;
    return a - (b * int_div);
}

uint32_t xor_op(uint32_t a, uint32_t b) {
    uint32_t n = 1u;
    uint32_t result = 0u;
    while(a != 0 || b != 0) {
        // or just: result += n * mod_op(a - b, 2);
        if(mod_op(a, 2) != mod_op(b, 2)) {
            result += n;
        }
        a /= 2;
        b /= 2;
        n *= 2;
    }
    return result;
} 
```

可以使用注释中的替代方法代替 if 以避免分支。但是话又说回来，解决方案也不是很快，而且看起来很奇怪:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T01:02:25.070

如果你有 AND 会更容易，因为

A OR B = A + B - (A AND B)

A XOR B = A + B - 2(A AND B)

```
int customxor(int a, int b)
{
    return a + b - 2*(a & b);
} 
```

# xsd - 寻找代表购物车“订单”的 XSD

> ID：373266
> 
> 赞同：4
> 
> 时间：2008-12-17T00:23:52.633
> 
> 标签：xsd, schema

我正在尝试创建一个表示购物车“订单”的 XML 模式

我希望这可以完全抽象出我的购物车的实现——并最终支持合作伙伴使用此模式向我们发送订单。（是的，我正计划将此模式集成到我们现有的购物车中）

它将包含原始订单商品、重复运输商品和特定领域的商品。我很有能力建造这个，但我想知道是否有很多这样的东西，我至少可以以此为基础。

我知道像这样的某些模式元素有标准，但我已经忘记了哪些是最好的/标准以及如何扩展它们等。

显然，如果我希望合作伙伴向我发送“订单”，我想使用一个标准（如果存在）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T03:39:35.017

您想要 XML 还是 XSD？对于 XSD，您可以使用[Microsoft 的](http://msdn.microsoft.com/en-us/library/x6c1kb0s(VS.71).aspx)基于 XML 文档的 XSD 生成器生成一个。

如果您想要一个可以表示“订单”的通用 XML 文档，这里有一个。

```
<?xml version="1.0"?>
    <Order>
 <Date>2003/07/04</Date>
 <CustomerId>123</CustomerId>
 <CustomerName>Acme Alpha</CustomerName>

   <Item>
 <ItemId> 987</ItemId>
 <ItemName>Coupler</ItemName>
 <Quantity>5</Quantity>
 </Item>

<Item>
 <ItemId>654</ItemId>
 <ItemName>Connector</ItemName>
 <Quantity unit="12">3</Quantity>
 </Item>

<Item>  
 <ItemId>579</ItemId>
 <ItemName>Clasp</ItemName>
 <Quantity>1</Quantity>
 </Item>

</Order> 
```

从[这里](http://infocenter.sybase.com/help/topic/com.sybase.help.ase_15.0.xmlb/html/xmlb/xmlb6.htm)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-11T09:00:59.380

UBL（通用商业语言）定义了商业文档（采购订单、发票等）的模式。它是 OASIS 标准，请参阅：

[http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=ubl](http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=ubl)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T05:48:40.200

如果您正在寻找有关如何构建购物车的想法：购物车的
[数据库表结构](https://stackoverflow.com/questions/360959/database-table-structure-for-shopping-cart)

# perl - 为什么 EPIC eclipse 插件在“解释错误/警告”中不显示任何信息？

> ID：373282
> 
> 赞同：3
> 
> 时间：2008-12-17T00:29:29.720
> 
> 标签：perl, eclipse, plugins, epic

我使用 Eclipse 的“EPIC”插件进行 Perl 开发，但在“解释错误/警告”视图中根本没有任何信息，即使我有一些编译错误。我是否需要做任何特别的事情才能让 EPIC 在该视图中显示有用的信息？那到底是为了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T09:07:27.103

视图不会自动填充。正如[用户指南所说](http://www.epic-ide.org/guide/ch05s02.php)（顺便说一句，这很好），您必须右键单击警告/错误并从上下文菜单中选择“解释错误/警告”。您必须单击图标，而不是产生错误的代码。

该视图将为您提供比错误消息或警告本身更多的详细信息和建议。

# php - PHP：向 Eclipse 控制台发送消息/记录日志？

> ID：373287
> 
> 赞同：2
> 
> 时间：2008-12-17T00:31:42.073
> 
> 标签：php, eclipse, logging, console

是否可以将消息从 PHP 脚本发送到 Eclipse 中的控制台？有没有人尝试过这个？我对控制台的工作原理不是很熟悉，所以我不确定是否有与之通信的标准化方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-29T23:16:00.200

如果你看...

主菜单 -> 运行 -> 外部工具 -> 打开外部工具对话框。

在那里我设置了 PHP Codesniffer 与以下...

*   名称：代码嗅探器
*   位置：/usr/bin/phpcs
*   工作目录：${workspace_loc}
*   参数：--standard=${resource_loc}

它将代码嗅探器作为外部工具运行，它返回的所有消息都出现在控制台中。设置完成后，单击向下箭头并选择“Code Sniffer”，然后外部程序（在本例中为代码嗅探器）输出的任何内容都将在 Eclipse 控制台中。

如果你这样设置...

*   名称：PHP
*   位置：/usr/bin/phpcs
*   工作目录：${workspace_loc}
*   参数：${workspace_loc}${resource_path}

它只会在 CLI 模式下运行 php，如果你使用 Wilco 的代码（上图）运行它，你会得到。

```
Hello World 
```

在终端。

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-09T16:02:34.357

您所做的任何回声或打印都应自动转到控制台。然而，这在很长一段时间内都是非常不可靠的。请投票以修复此错误：

[https://bugs.eclipse.org/bugs/show_bug.cgi?id=282997](https://bugs.eclipse.org/bugs/show_bug.cgi?id=282997)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T15:52:08.347

默认情况下，Eclipse 外部工具启动的所有输出都会发送到控制台，因此如果您使用外部工具启动器执行 PHP 脚本，则脚本的任何输出都将发送到控制台。

例如：

```
<?php

echo "Hello World\n";

?> 
```

将“Hello World”发送到控制台。

# digital-certificate - 数字证书：如何使用将 .cer 文件导入 .truststore 文件？

> ID：373295
> 
> 赞同：97
> 
> 时间：2008-12-17T00:33:53.910
> 
> 标签：digital-certificate, truststore

有没有人遇到过他们必须处理 .truststore 文件的地方？并知道如何将 .cer 导入 .truststore 文件？

我不确定是否必须使用 Java Keytool 或 Linux 命令（例如 openssl 命令）。

谢谢

* * *

## 回答 #1

> 赞同：208
> 
> 时间：2008-12-17T00:42:22.957

```
# Copy the certificate into the directory Java_home\Jre\Lib\Security
# Change your directory to Java_home\Jre\Lib\Security>
# Import the certificate to a trust store.

keytool -import -alias ca -file somecert.cer -keystore cacerts -storepass changeit [Return]

Trust this certificate: [Yes] 
```

changeit 是默认的信任库密码

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2012-05-23T20:34:44.917

除了使用`sed`过滤掉证书，您还可以通过管道`openssl s_client`输出`openssl x509 -out certfile.txt`，例如：

```
echo "" | openssl s_client -connect my.server.com:443 -showcerts 2>/dev/null | openssl x509 -out certfile.txt 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-09-14T20:24:48.153

将 .cer 文件导入信任库的方式与从 Firefox 导出导入 .crt 文件的方式相同。

您不必输入密钥库的别名和密码，只需键入：

```
keytool -v -import -file somefile.crt  -alias somecrt -keystore my-cacerts 
```

最好使用 Java 安装 (jre\lib\security\cacerts) 中已经存在的 cacerts 文件，因为它包含安全的“流行”证书。

*关于 cer 和 crt 的差异的更新（只是为了澄清）* 根据[Apache with SSL - 如何将 CER 转换为 CRT 证书？](https://stackoverflow.com/questions/642284/apache-with-ssl-how-to-convert-cer-to-crt-certificates)和用户@Spawnrider

> CER 是二进制形式的 X.509 证书，DER 编码。
> CRT 是二进制 X.509 证书，封装在文本（base-64）编码中。
> 它不是相同的编码。

# .net - 我将使用什么 API 调用来更改笔记本电脑 (.NET) 的亮度？

> ID：373297
> 
> 赞同：9
> 
> 时间：2008-12-17T00:34:18.027
> 
> 标签：.net, winapi, api, brightness

我在索尼笔记本电脑上安装了 Windows Server 2008，但亮度控制不起作用。我想写一个程序来让我改变它。

目前我要做的就是打开电源控制面板，点击高级设置，并通过这么多 UAC 框进行战斗，任何人看着我一定会认为我完全疯了。

我只想要一个简单的小程序来做，但我不知道要调用什么 API

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-28T18:15:40.440

我在 MSDN 中查找了[John Rudy到](https://stackoverflow.com/questions/373297/what-api-call-would-i-use-to-change-brightness-of-laptop-net/373308#373308)[WmiSetBrightness](http://msdn.microsoft.com/en-us/library/aa394549.aspx)的链接并得出了以下结论：

```
ManagementClass mclass = new ManagementClass("WmiMonitorBrightnessMethods");
mclass.Scope = new ManagementScope(@"\\.\root\wmi");
ManagementObjectCollection instances = mclass.GetInstances();

// I assume you get one instance per monitor
foreach(ManagementObject instance in instances)
{
    ulong timeout = 1; // in seconds
    ushort brightness = 50; // in percent
    object[] args = new object[] { timeout, brightness };
    instance.InvokeMethod("WmiSetBrightness", args);
} 
```

注意：`ManagementClass`, `ManagementObjectCollection`, 和`ManagementObject`所有实现`IDisposable`。您应该调用`Dispose()`或使用“ `using`”来避免资源泄漏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T00:42:05.810

这只是远景：

[http://msdn.microsoft.com/en-us/library/ms775232.aspx](http://msdn.microsoft.com/en-us/library/ms775232.aspx)

在使用 SetMonitorBrightness 设置其亮度之前，您需要使用 GetPhysicalMonitorsFromHMONITOR 识别显示器。我怀疑以前没有人在.net 中做过，所以你可能需要编写自己的互操作。该 api 似乎并不特别困难，因此您应该能够很容易地做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T00:43:12.067

据我所知，没有用于此的托管 (.NET) API。但是，对于 Vista，有可通过互操作使用的非托管 API。请参阅 MSDN：[监视器配置 API](http://msdn.microsoft.com/en-us/library/ms775232.aspx)和[WmiSetBrightness](http://msdn.microsoft.com/en-us/library/aa394549.aspx)。

可能有一些可管理的方式来达到 WmiSetBrightness 方法，但我不知道它们。

如果您不在 Vista 或 Server 2008 上，那么您将进入一个不愉快的世界：软件配置必须直接通过显示器驱动程序完成。根据您上面提到的 UAC，我怀疑您的情况并非如此，但下一个人可能想知道。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T00:53:31.937

这里只是一个头脑风暴者......在笔记本电脑上，您可以使用键盘上的一些组合键来更改亮度。如果您只想使其更暗/更亮而不必将其设置为特定值，则应该可以发送这些按键。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T00:50:05.670

要添加到 DaEagles 的答案，[http:](http://www.pinvoke.net/) //www.pinvoke.net/站点可以成为在 .Net 中使用 win32-apis 时的救命稻草。如果该信息不存在，请在您为 .Net 成功进行互操作后添加。

# c# - 如何在从 .Include 实体框架查询返回的数据上指定 where 子句？

> ID：373303
> 
> 赞同：1
> 
> 时间：2008-12-17T00:40:45.410
> 
> 标签：c#, entity-framework

给定以下数据库表层次结构：

```
Region
------
RegionId
RegionName

Country
-------
CountryId
RegionId
CountryName

Destination
-----------
DestinationId
CountryId
DestinationName

Venue
-----
VenueId
DestinationId
VenueName 
```

我有以下实体框架查询：

```
var result = from region in context.Region.Include("Country.Destination.Venue") 
select region 
```

这将返回所有表中的所有行（外连接）

是否可以引入 where 子句，以便仅包含场所不为空的行（或使用内部连接）？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T03:52:39.967

尝试这个。它应该返回您正在寻找的结果：仅具有相应地点的区域。

```
 var result = from region in context.Region.Include(Country.Destination.Venue)
                 let v = (from ctry in region.Country
                         join dest in context.Destination
                         on ctry.CountryId
                         equals dest.CountryId
                         into destGroup
                         from dests in destGroup
                         join ven in context.Venue
                         on dests.DestinationId
                         equals ven.DestinationId
                         into venGroup
                         select ctry).Any()
                 where v == true
                 select region; 
```

# javascript - setTimeout的使用——如何传递参数？

> ID：373305
> 
> 赞同：0
> 
> 时间：2008-12-17T00:41:43.363
> 
> 标签：javascript, settimeout

我正在尝试开发在幻灯片之间暂停的幻灯片。所以我正在尝试使用 setTimeout 语句，如下所示。这是为了将 2.jpg 替换为 1.jpg，在单击按钮时暂停 10 秒。但它现在确实有效。谁能帮我。谢谢。

```
<html>
<head>
<script type="text/javascript">
var t;
function swap(newImage) {
  var fileName=newImage.toString()+".jpg"
  document.slideshow.src=fileName
  t=setTimeout("swap()",10000)
}
</script>
</head>  
<body> 
  <img name="slideshow" src="1.jpg" width="450" height="335" />
  <br /><br />
  <input type="button" onClick="swap('2')" value="Change image" /> 
  <br /><br />
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T00:58:45.497

这里有几件事是错误的。首先，不建议在[setTimeout](https://developer.mozilla.org/en/DOM/window.setTimeout)的第一个参数中对其进行 eval 的传递代码。最好传递一个回调：

```
 setTimeout(function() { swap(); },10000);
 //Or
 setTimeout(swap,10000); //Passing the actual function as the callback 
```

其次，您在超时内调用不带参数的 swap() 方法。它应该传入一个新的图像文件名（可能通过声明一个文件名数组），或者检查是否设置了参数。

```
function swap(newImage,element) { 
   if(newImage) {
       var fileName = newImage.toString()+".jpg"; 
       element.src = fileName;
   }
   t=setTimeout(this,10000) 
} 
```

这个函数在第一次运行后显然不会做任何事情（因为没有提供新的图像文件名）。使用数组，您可以遍历多个文件名：

```
var images = ['1.jpg','2.jpg','3.jpg'];
var slideshow = function(element, images, index) {
   if(!index || ( (index + 1) > images.length) ) index = 0;
   element.src = images[index];
   t = setTimeout(function(){
       slideshow(element, images, index + 1);
   },10000) 
};

//Fetch the image element the slideshow is running on
var element = document.slideshow; 
slideshow(element, images); 
```

这将继续在数组中的图像之间切换，直到取消超时。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T00:48:46.000

您的交换函数需要一个参数，因此它不适用于 setTimeout。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-17T05:14:14.717

不需要 Javascript 来制作幻灯片。您所要做的就是将每个图像放入一个单独的页面，然后将这一行添加到 <head> 部分中每个页面的顶部：

```
<meta http-equiv="refresh" content="10;url=NextPage.html"/> 
```

“10”是进入下一页之前等待的秒数，“NextPage.html”是指向包含下一个要显示的图像的页面的链接。

# architecture - 您认为哪些架构观点是您整体软件设计的一部分？

> ID：373309
> 
> 赞同：0
> 
> 时间：2008-12-17T00:44:02.407
> 
> 标签：architecture

当有人使用术语 XXX 架构时，我倾向于畏缩。它通常表明我可能没有考虑另一个架构学科或观点。您正在考虑哪些架构观点，您是否有任何好的资源来获取有关它们的信息？

我希望这可以帮助其他正在通过建筑专业工作的人。

*   生存能力
*   绩效管理
*   运营监控与管理
*   服务导向
*   TOGAF 定义了许多服务质量属性

很抱歉编辑，但你的答案是正确的，我认为这个问题需要改进。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T04:31:03.587

架构和架构决策主要是关于系统的“非功能性”需求；*步伐*RoadWarrier，但他提到的每一件事都是架构决策的后果，而不是独立于自身。（证明：是什么导致了在这些领域中的任何一个特定选择？总是需要满足一些非功能性需求。）

考虑到这一点，这是一个两部分的问题。首先，您需要确定哪些 NFR 很重要。最好使用严格的方法对它们进行特定说明，例如，不要只说“高度可用”，而是说“系统必须可用 (MTTF/(MTTF+MTTR)) 99.99%，最长的单次中断时间是4 分钟。”

其次，您需要考虑哪些视图将帮助您进行设计以满足这些要求*并证明您的决定*是正确的。根据您要求的严格程度，这可能是从白板框图到正式模拟研究的任何内容。

在*业务*领域中，例如在 Web 界面上可用的 IT 系统中，您可能希望：

*   可靠性（MMTF）
*   可用性（MTTF/（MTTF+MTTR））
*   可扩展性（系统必须能够在 72 小时内以 X 成本增加 10% 的容量）
*   容量（系统必须维持 100 万活跃用户）
*   吞吐量（系统必须平均每秒处理 100 个事务，σ=2.5 tps）
*   响应时间（在测试负载下用户必须在 ≤ 2 秒内收到完整页面）
*   安全性（这里的指标本身就是一个话题）

如果您要指定性能等特性，您还应该描述*工作负载*，即用户数据的大小、Web 请求的到达率等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T00:55:29.857

*   可测试性
*   可扩展性
*   容错
*   性能下降（优雅地，一个希望）
*   可升级性（硬件和软件）

顺便说一句，这些都是我喜欢企业服务总线 (ESB) 的原因！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T02:50:11.577

**编辑**：由于问题的重点发生了变化，我将答案编辑如下。

**架构**和**架构师**是重度重载的术语。首先，您需要指定您是在谈论软件公司（软件是产品/服务）还是业务线公司（软件支持产品/服务）。

还有自上而下的架构视图（从组织的角度来看很重要）与自下而上的视图（从项目需求的角度来看很重要）。

在一家大型业务线公司中，从自上而下（组织）的角度来看，架构通常是这样划分的：

*   [领域](http://en.wikipedia.org/wiki/Business_architecture)架构，有时也称为业务架构。例如，了解商品交易流程和相关的 IT 系统。
*   [数据](http://en.wikipedia.org/wiki/Data_architecture)架构。例如，理解对存储中的数据和运动中的数据的描述；数据存储、数据组和数据项的描述；以及这些数据工件到数据质量、应用程序和位置的映射。
*   [技术](http://en.wikipedia.org/wiki/Technical_architecture)架构。例如，了解企业、解决方案或系统的技术基础架构的结构和行为。

从自下而上（需求）的角度来看，我的架构区域如下所示：

*   正确使用中间件——松耦合、容错、目标特定的转换、点对点杀等。
*   尽可能多地识别和设计和解。
*   尽可能多地识别和设计出双键。
*   识别和设计尽可能多的手动流程。
*   识别和设计任何最终用户计算解决方案 - 例如 Access 数据库、Excel 电子表格。
*   识别并设计出任何最终用户对“答案”的编辑——在所有工作完成后获取信息，然后对其进行编辑。
*   调查完整的数据生命周期：谁拥有它，谁丰富它，谁分发它，单一版本的真相，消除对账。
*   识别性能和可扩展性指标，针对多个数据配置文件测试风险区域。
*   识别实时与批处理过程和接口，并在可行的情况下消除批处理依赖性。
*   尽可能整合到单个平台，以及单个与多个实例。
*   能够在合理的时间范围内快速处理新的普通业务和新的复杂业务。
*   确定明确的支持模型，尤其是在必要时跨区域。
*   状态维护和恢复——日常处理和接口故障的恢复情况。
*   BCP/DR 要求和功能、一般容错、WAN 依赖性。
*   哪里可以降低项目风险？
*   安全性、最终用户和开发人员访问、围绕生产的铁环。
*   有哪些 MI 报告设施？
*   尽可能强调简单，系统退役。

# exception - 我如何区分真正的特殊情况和常规的不良情况？

> ID：373312
> 
> 赞同：1
> 
> 时间：2008-12-17T00:45:44.120
> 
> 标签：exception

许多开发人员说只有在真正异常的情况下才抛出异常。其中之一是如果我要写入的外部硬盘驱动器未打开（因此不是连接/注册的驱动器）。但是，有些情况很难判断它们是否真的异常。

例如，为文件夹路径输入字符串但未找到。在这种情况下，如果有任何输入无法找到（例如集合中的名称未找到），是否最好只返回错误消息和一些操作？

例如

```
public void Find(string name)
{
    if(Names.contains(name)
    {
        string s = Names.get(name);
    }

    if(!Names.contains(string name)
    {
        throw new ???Exception;
    }
} 
```

或者做一些类似显示弹出窗口并优雅地处理情况的事情？

在 else 或 if 语句中抛出异常是否明智？查看有关异常处理的代码异味列表会给我带来很多好处。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T00:53:22.963

一般来说，它是这样工作的：

如果您可以不受干扰地处理这种情况，请这样做。（文件不存在，但其输入对于继续操作不是必需的 [首选项、可选配置等]）

如果您需要用户干预，请询问他们。（文件不存在，但您需要它才能继续操作）

如果这是用户无法解决的问题（内存不足、硬件故障等），则抛出异常。

每个地方对细节都有自己的标准，但我发现上面的标准一般都可以。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T00:53:25.087

1.  如果您的代码可以从异常中恢复，请执行此操作
2.  如果要求客户检查预期的轻微异常的返回值是可以接受的，请这样做 - 这是一个判断调用，见下文
3.  在所有其他情况下，抛出异常（或不捕获被调用方法的异常）

对于第二种情况，minor 和 expected 是高度上下文相关的

恕我直言，不要对控制流使用异常，但在所有其他情况下，你可能会更安全地抛出它们

请注意，一些“优化”建议告诉您检查条件而不是依赖异常，例如文件未找到，但实际上您仍然应该期待异常，因为文件可能被删除或移动到检查语句之间存在和试图打开文件的语句！

总结：一般来说，抛出异常是最安全的做法。当然，直接警告或询问用户应该*只*在用户界面代码中完成！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T00:54:30.247

如果有什么可以做的，应该使用异常，但是检测到它的代码不知道该怎么做。

# html - 如何转义 HTML 块中的所有内容

> ID：373324
> 
> 赞同：9
> 
> 时间：2008-12-17T00:51:40.380
> 
> 标签：html, escaping

我似乎记得有一个 HTML 标签，除了匹配的结束标签外，它里面的所有东西都被完全转义了。有点像[`<plaintext>`](http://www.htmlref.com/reference/AppA/tag_plaintext.htm)，但没有从根本上破坏。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-17T00:56:53.037

<xmp> 是您要查找的标签：

```
<xmp>some stuff <tags></tags> too</xmp> 
```

但是，由于它已被贬低，你能得到的最好的就是 <pre>。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T05:36:38.290

你需要使用`<pre><code> ... </code></pre>`.

`<xmp>`已弃用，不应使用。请参阅[http://www.htmlcodetutorial.com/_XMP.html](http://www.htmlcodetutorial.com/_XMP.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T01:24:01.733

还有 XML [CDATA](http://www.w3schools.com/XML/xml_cdata.asp)：

```
<![CDATA[stuff that is <tag>never</tag> parsed]]> 
```

这是否适用于 HTML 文档可能取决于浏览器。但是，它当然应该在 XHTML 文档中工作。

# java - 使用来自 Eclipse 的参数调用 Java 主方法

> ID：373328
> 
> 赞同：33
> 
> 时间：2008-12-17T00:53:27.550
> 
> 标签：java, eclipse, main-method

*在开发期间（以及调试），直接从 Eclipse 内部运行 Java 类的public static void main(String[] argv)* 方法（使用 Run As 上下文菜单）非常有用。

是否有类似的快速方法来指定运行的命令行参数？我现在要做的是转到“运行对话框”，单击各种设置到选项卡，我可以在其中指定 VM 和程序参数并在那里输入它们。步骤太多，而且我不想将更永久的运行时配置设置与一次性调用参数混合在一起。我想要的是在某处选中一个框（或有一个单独的菜单项“使用命令行作为 Java 应用程序运行”），然后每次都提示输入命令行（有很好的历史记录）。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-17T14:47:17.337

这个答案基于 Eclipse 3.4，但应该适用于旧版本的 Eclipse。

选择 Run As... 时，进入运行配置。

在您的 Java 运行配置的 Arguments 选项卡上，配置变量 ${string_prompt} 以显示（您可以单击变量来获取它，或复制它以直接设置它）。

每次使用该运行配置时（命名好以便以后使用），系统都会提示您输入命令行参数。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-17T10:54:44.077

uri是错误的，有一种方法可以直接在Eclipse的main方法中添加参数，但是参数不会很灵活（允许一些动态参数）。这是您需要做的：

1.  按原样运行一次课程。
2.  去`Run -> Run configurations...`
3.  从左侧列表中，从列表下方的列表中选择您的课程，`Java Application`或者通过输入其名称来过滤框。
4.  选择参数选项卡并将您的参数写入`Program arguments`框。以防万一不清楚，它们是用空格分隔的，所以`"a b c"`（不带引号）意味着您将参数 a、b 和 c 传递给您的程序。
5.  就像在步骤 1 中一样再次运行您的课程。

但是，我确实建议使用 JUnit/wrapper 类，就像 Uri 所说的那样，因为这样可以比这样做更好地控制实际参数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-04-10T20:52:58.067

如果您的字符串参数中有空格，请执行以下操作：

运行 > 运行配置 > Java 应用程序 > 参数 > 程序参数

1.  用引号将您的字符串参数括起来
2.  用空格或换行分隔每个参数

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T01:01:05.803

AFAIK 在 Eclipse 中没有为此的内置机制。

您可以获得的最接近的方法是创建一个包装器，提示您输入这些值并调用（硬编码的）main。只要您不清除终止的进程，您就会获得执行历史记录。对此有两种变体，要么使用 JUNit，要么使用注入或参数，以便您的包装器始终连接到其主类的正确类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T10:30:19.540

我不确定你的用途是什么，但我发现通常我使用不超过几个命令行参数很方便，因此每个场景都有一个运行配置，我只需从运行历史记录中选择我想要的一个。

IMO，您建议的功能似乎有点矫枉过正。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T11:21:24.943

另一个想法：

将所有参数放在一个属性文件中（一个参数 = 此文件中的一个属性），然后在您的 main 方法中，加载此文件（使用`Properties.load(*fileInputStream*)`）。因此，如果您想修改一个参数，您只需要编辑您的 args.properties 文件，然后启动您的应用程序而无需执行更多步骤...

当然，这仅用于开发目的，但如果您必须经常更改论点，这将非常有帮助......

# asp.net - 类型和系统未定义 JavaScript 错误

> ID：373331
> 
> 赞同：1
> 
> 时间：2008-12-17T00:54:28.453
> 
> 标签：asp.net, javascript, wcf, asp.net-ajax

我正在尝试遵循启用 AJAX 的 WCF 服务的简单示例，例如： [http ://www.pluralsight.com/community/blogs/fritz/archive/2008/01/31/50121.aspx](http://www.pluralsight.com/community/blogs/fritz/archive/2008/01/31/50121.aspx)

我收到 JavaScript 错误 Type not defined 和 Sys not defined。这是否意味着这些 .axd 事物之一存在问题？或者是其他东西？如何解决 Ajax 脚本的问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T01:05:14.237

行。我想我得到了这个。

将此添加到我的 web.config

```
<httpHandlers>
<add verb="GET,HEAD" path="ScriptResource.axd"           
     type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" validate="false"/>    
</httpHandlers> 
```

# python - 如何在 Python 中获得类似 Cron 的调度程序？

> ID：373335
> 
> 赞同：431
> 
> 时间：2008-12-17T00:56:31.180
> 
> 标签：python, cron, scheduled-tasks

我正在寻找一个 Python 库，它将提供`at`和`cron`喜欢的功能。

我很想有一个纯 Python 解决方案，而不是依赖安装在盒子上的工具；这样我就可以在没有 cron 的机器上运行。

对于那些不熟悉`cron`: 的人，您可以根据如下表达式安排任务：

```
 0 2 * * 7 /usr/bin/run-backup # run the backups at 0200 on Every Sunday
 0 9-17/2 * * 1-5 /usr/bin/purge-temps # run the purge temps command, every 2 hours between 9am and 5pm on Mondays to Fridays. 
```

cron 时间表达式语法不太重要，但我希望有这种灵活性的东西。

如果没有开箱即用的东西为我做这件事，任何关于构建块的建议都将不胜感激。

**编辑** 我对启动进程不感兴趣，只是用 Python - python 函数编写的“工作”。出于必要，我认为这将是一个不同的线程，但不是在不同的过程中。

为此，我正在寻找 cron 时间表达式的表现力，但在 Python 中。

Cron*已经*存在很多年了，但我试图尽可能地便携。我不能依赖它的存在。

* * *

## 回答 #1

> 赞同：736
> 
> 时间：2013-05-28T07:48:31.313

如果您正在寻找轻量级的结帐[时间表](https://github.com/dbader/schedule)：

```
import schedule
import time

def job():
    print("I'm working...")

schedule.every(10).minutes.do(job)
schedule.every().hour.do(job)
schedule.every().day.at("10:30").do(job)

while 1:
    schedule.run_pending()
    time.sleep(1) 
```

*披露*：我是那个图书馆的作者。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-12-17T10:48:11.547

您可以只使用普通的 Python 参数传递语法来指定您的 crontab。例如，假设我们定义一个 Event 类如下：

```
from datetime import datetime, timedelta
import time

# Some utility classes / functions first
class AllMatch(set):
    """Universal set - match everything"""
    def __contains__(self, item): return True

allMatch = AllMatch()

def conv_to_set(obj):  # Allow single integer to be provided
    if isinstance(obj, (int,long)):
        return set([obj])  # Single item
    if not isinstance(obj, set):
        obj = set(obj)
    return obj

# The actual Event class
class Event(object):
    def __init__(self, action, min=allMatch, hour=allMatch, 
                       day=allMatch, month=allMatch, dow=allMatch, 
                       args=(), kwargs={}):
        self.mins = conv_to_set(min)
        self.hours= conv_to_set(hour)
        self.days = conv_to_set(day)
        self.months = conv_to_set(month)
        self.dow = conv_to_set(dow)
        self.action = action
        self.args = args
        self.kwargs = kwargs

    def matchtime(self, t):
        """Return True if this event should trigger at the specified datetime"""
        return ((t.minute     in self.mins) and
                (t.hour       in self.hours) and
                (t.day        in self.days) and
                (t.month      in self.months) and
                (t.weekday()  in self.dow))

    def check(self, t):
        if self.matchtime(t):
            self.action(*self.args, **self.kwargs) 
```

（注：未经彻底测试）

然后你的 CronTab 可以用普通的 python 语法指定为：

```
c = CronTab(
  Event(perform_backup, 0, 2, dow=6 ),
  Event(purge_temps, 0, range(9,18,2), dow=range(0,5))
) 
```

通过这种方式，您可以获得 Python 参数机制的全部功能（混合位置参数和关键字参数，并且可以将符号名称用于星期和月份的名称）

CronTab 类将被定义为简单地以分钟为增量休眠，并在每个事件上调用 check()。（不过，夏令时/时区可能有一些微妙之处需要提防）。这是一个快速实现：

```
class CronTab(object):
    def __init__(self, *events):
        self.events = events

    def run(self):
        t=datetime(*datetime.now().timetuple()[:5])
        while 1:
            for e in self.events:
                e.check(t)

            t += timedelta(minutes=1)
            while datetime.now() < t:
                time.sleep((t - datetime.now()).seconds) 
```

需要注意的几件事：Python 的工作日/月份是零索引（与 cron 不同），并且该范围不包括最后一个元素，因此像“1-5”这样的语法变成了 range(0,5) - 即 [0,1,2, 3,4]。如果您更喜欢 cron 语法，那么解析它应该不会太难。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-06-01T02:01:21.337

或多或少与上面相同，但同时使用 gevent :)

```
"""Gevent based crontab implementation"""

from datetime import datetime, timedelta
import gevent

# Some utility classes / functions first
def conv_to_set(obj):
    """Converts to set allowing single integer to be provided"""

    if isinstance(obj, (int, long)):
        return set([obj])  # Single item
    if not isinstance(obj, set):
        obj = set(obj)
    return obj

class AllMatch(set):
    """Universal set - match everything"""
    def __contains__(self, item): 
        return True

allMatch = AllMatch()

class Event(object):
    """The Actual Event Class"""

    def __init__(self, action, minute=allMatch, hour=allMatch, 
                       day=allMatch, month=allMatch, daysofweek=allMatch, 
                       args=(), kwargs={}):
        self.mins = conv_to_set(minute)
        self.hours = conv_to_set(hour)
        self.days = conv_to_set(day)
        self.months = conv_to_set(month)
        self.daysofweek = conv_to_set(daysofweek)
        self.action = action
        self.args = args
        self.kwargs = kwargs

    def matchtime(self, t1):
        """Return True if this event should trigger at the specified datetime"""
        return ((t1.minute     in self.mins) and
                (t1.hour       in self.hours) and
                (t1.day        in self.days) and
                (t1.month      in self.months) and
                (t1.weekday()  in self.daysofweek))

    def check(self, t):
        """Check and run action if needed"""

        if self.matchtime(t):
            self.action(*self.args, **self.kwargs)

class CronTab(object):
    """The crontab implementation"""

    def __init__(self, *events):
        self.events = events

    def _check(self):
        """Check all events in separate greenlets"""

        t1 = datetime(*datetime.now().timetuple()[:5])
        for event in self.events:
            gevent.spawn(event.check, t1)

        t1 += timedelta(minutes=1)
        s1 = (t1 - datetime.now()).seconds + 1
        print "Checking again in %s seconds" % s1
        job = gevent.spawn_later(s1, self._check)

    def run(self):
        """Run the cron forever"""

        self._check()
        while True:
            gevent.sleep(60)

import os 
def test_task():
    """Just an example that sends a bell and asd to all terminals"""

    os.system('echo asd | wall')  

cron = CronTab(
  Event(test_task, 22, 1 ),
  Event(test_task, 0, range(9,18,2), daysofweek=range(0,5)),
)
cron.run() 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-03-06T22:06:16.663

列出的解决方案都没有尝试解析复杂的 cron 计划字符串。所以，这是我的版本，使用[croniter](https://github.com/taichino/croniter)。基本要点：

```
schedule = "*/5 * * * *" # Run every five minutes

nextRunTime = getNextCronRunTime(schedule)
while True:
     roundedDownTime = roundDownTime()
     if (roundedDownTime == nextRunTime):
         ####################################
         ### Do your periodic thing here. ###
         ####################################
         nextRunTime = getNextCronRunTime(schedule)
     elif (roundedDownTime > nextRunTime):
         # We missed an execution. Error. Re initialize.
         nextRunTime = getNextCronRunTime(schedule)
     sleepTillTopOfNextMinute() 
```

辅助例程：

```
from croniter import croniter
from datetime import datetime, timedelta

# Round time down to the top of the previous minute
def roundDownTime(dt=None, dateDelta=timedelta(minutes=1)):
    roundTo = dateDelta.total_seconds()
    if dt == None : dt = datetime.now()
    seconds = (dt - dt.min).seconds
    rounding = (seconds+roundTo/2) // roundTo * roundTo
    return dt + timedelta(0,rounding-seconds,-dt.microsecond)

# Get next run time from now, based on schedule specified by cron string
def getNextCronRunTime(schedule):
    return croniter(schedule, datetime.now()).get_next(datetime)

# Sleep till the top of the next minute
def sleepTillTopOfNextMinute():
    t = datetime.utcnow()
    sleeptime = 60 - (t.second + t.microsecond/1000000.0)
    time.sleep(sleeptime) 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-17T05:45:01.550

没有“纯 python”方法可以做到这一点，因为其他一些进程必须启动 python 才能运行您的解决方案。每个平台都会有一种或二十种不同的方式来启动流程并监控其进度。在 unix 平台上，cron 是旧标准。在 Mac OS X 上还有 launchd，它结合了类似 cron 的启动和看门狗功能，如果你想要的话，可以让你的进程保持活力。一旦 python 运行，您就可以使用[sched 模块](http://docs.python.org/library/sched.html "预定的")来安排任务。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-04-01T18:47:25.760

我知道有很多答案，但另一种解决方案可能是使用**decorators**。这是每天在特定时间重复功能的示例。使用这种方式的一个很酷的想法是，您只需将*语法糖*添加到您要调度的函数中：

```
@repeatEveryDay(hour=6, minutes=30)
def sayHello(name):
    print(f"Hello {name}")

sayHello("Bob") # Now this function will be invoked every day at 6.30 a.m 
```

装饰器看起来像：

```
def repeatEveryDay(hour, minutes=0, seconds=0):
    """
    Decorator that will run the decorated function everyday at that hour, minutes and seconds.
    :param hour: 0-24
    :param minutes: 0-60 (Optional)
    :param seconds: 0-60 (Optional)
    """
    def decoratorRepeat(func):

        @functools.wraps(func)
        def wrapperRepeat(*args, **kwargs):

            def getLocalTime():
                return datetime.datetime.fromtimestamp(time.mktime(time.localtime()))

            # Get the datetime of the first function call
            td = datetime.timedelta(seconds=15)
            if wrapperRepeat.nextSent == None:
                now = getLocalTime()
                wrapperRepeat.nextSent = datetime.datetime(now.year, now.month, now.day, hour, minutes, seconds)
                if wrapperRepeat.nextSent < now:
                    wrapperRepeat.nextSent += td

            # Waiting till next day
            while getLocalTime() < wrapperRepeat.nextSent:
                time.sleep(1)

            # Call the function
            func(*args, **kwargs)

            # Get the datetime of the next function call
            wrapperRepeat.nextSent += td
            wrapperRepeat(*args, **kwargs)

        wrapperRepeat.nextSent = None
        return wrapperRepeat

    return decoratorRepeat 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-06-16T15:00:51.250

我喜欢[pycron](https://github.com/kipe/pycron)包如何解决这个问题。

```
import pycron
import time

while True:
    if pycron.is_now('0 2 * * 0'):   # True Every Sunday at 02:00
        print('running backup')
        time.sleep(60)               # The process should take at least 60 sec
                                     # to avoid running twice in one minute
    else:
        time.sleep(15)               # Check again in 15 seconds 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-09-10T22:51:04.903

另一个简单的解决方案是：

```
from aqcron import At
from time import sleep
from datetime import datetime

# Event scheduling
event_1 = At( second=5 )
event_2 = At( second=[0,20,40] )

while True:
    now = datetime.now()

    # Event check
    if now in event_1: print "event_1"
    if now in event_2: print "event_2"

    sleep(1) 
```

类 aqcron.At 是：

```
# aqcron.py

class At(object):
    def __init__(self, year=None,    month=None,
                 day=None,     weekday=None,
                 hour=None,    minute=None,
                 second=None):
        loc = locals()
        loc.pop("self")
        self.at = dict((k, v) for k, v in loc.iteritems() if v != None)

    def __contains__(self, now):
        for k in self.at.keys():
            try:
                if not getattr(now, k) in self.at[k]: return False
            except TypeError:
                if self.at[k] != getattr(now, k): return False
        return True 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-17T01:01:33.917

我不知道这样的东西是否已经存在。使用时间、日期时间和/或日历模块编写自己的模块很容易，请参阅[http://docs.python.org/library/time.html](http://docs.python.org/library/time.html)

python解决方案的唯一问题是您的工作需要始终运行，并且可能在重新启动后自动“复活”，您**确实**需要依赖系统相关的解决方案。

# syntax - Fortran：行长/追加行 - 但最后有文字？

> ID：373342
> 
> 赞同：1
> 
> 时间：2008-12-17T00:59:21.597
> 
> 标签：syntax, fortran, fortran77

我有一行 Fortran 代码，其中包含一些文本。我正在更改文本，这使得 Fortran 的代码行太长，所以我使用“a”将它分成两行。

曾是：

```
 IF (MYVAR .EQ. 1) THEN
    WRITE(iott,'(A) (A)') 'ABC=', SOMEVAR 
```

变成：

```
 IF (MYVAR .EQ. 1) THEN
    WRITE(iott,'(A) (A)') 'ABC DEF GHI JK
a ' // 'L=', SOMEVAR 
```

我的问题是，在新行（以 'a' 开头）上，'a' 和第一个 ' 之间的空格是否被附加到字符串中？还是我需要 ' 作为旁边的字符 a 以防止额外的空白？

如您所知，我不习惯 Fortran ......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T03:46:54.660

如果您担心超过 72 列的限制，那么我假设您使用的是 Fortran 77。Fortran 77 的语法要求您从第 7 列开始，但连续行除外，它需要在第 6 列中使用续行符。我使用下面的方法告诉我一个语句要延续多少行（第一行只是为了显示列）：

```
!234567890
      write(*,*)"Lorem Ipsum",
     1 " Foo",
     2 " Bar" 
```

这将打印：

```
Lorem Ipsum Foo Bar 
```

您不必担心引号中没有的空格。无论如何，所有空格都会在 Fortran 中被压缩。

[学习如何使用格式](http://www.stanford.edu/class/me200c/tutorial_77/17_format.html)语句是值得的。它们可以使输出更容易。它有点类似于 printf 语句，如果您来自 C 语言。您指定具有不同类型参数的格式，然后提供变量或文字来填写该格式。

不要担心您没有使用当今最热门的新语言。你可以从 Fortran 甚至 Fortran 77 中学到很多东西，如果使用得当，Fortran 甚至可以很优雅。我已经看到 Fortran 77 好像是一种面向对象的语言一样编写，并带有动态内存。我喜欢说，“old.ne.bad”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T01:38:20.580

对我来说，记住 FORTRAN 的旧列要求已经太久了（它们甚至可能不像以前那样严格）。

但是 - 这不是快速测试运行会直接告诉你的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T01:50:56.593

1.  是的，the`a`是一个延续字符，基本上它只是意味着将这一行的其余部分从延续字符（第 6 列，对吗？）开始附加到上一行。
2.  您的 Fortran 编译器可能有一个选项来打开“自由格式”输入，而不是使用“固定格式”输入。使用它，您将不必担心行长。
3.  如果您的 Fortran 编译器早于 F90 —— 我认为自由格式输入功能是在那时开始的，您有我的哀悼。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T01:52:53.127

@迈克乙：

在理想的世界中是的，但在这种情况下，代码是在一台机器上开发的，并提交给构建服务器，该服务器具有可用于构建的适当的第 3 方软件/SDK/许可证。构建也不是很快。

# java - 使用 Maven 来自 WSDL 的简单（独立）Java SOAP Web 服务客户端

> ID：373350
> 
> 赞同：13
> 
> 时间：2008-12-17T01:03:05.613
> 
> 标签：java, web-services, maven-2, soap, wsdl

我希望生成一个简单的独立 Java 客户端，它将调用 SOAP Web 服务，给定一个 wsdl。当我说简单和独立时，我的意思是一旦我完成了，我希望能够做类似的事情

```
import my.generated.nonsense;

public static void main(String[] args) {
    Client client = new Client();
    client.getSomething();
} 
```

最近我在其他一些项目上与 Maven 一起度过了愉快的时光，我想继续这样做，所以我打算在这里使用它。我不希望该工具生成任何允许我执行上述操作的类。

最近有人做过这个并且可以推荐一个 ws 库和 Maven 插件吗？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T06:55:07.400

看看 CXF 和它的 Maven[插件](http://www.opendocs.net/apache/cxf/2.0/maven-integration-and-plugin.html)。CXF 会生成与您类似的代码（当然 Web 服务可能会失败，您应该添加异常处理）。请记住，尽管 SOAP Web 服务是一个复杂的主题，并且生成的代码中的简单性可能并不总是可取的。使用默认设置生成客户端可能不适用于某些客户端。然后，您需要调整代码生成的配置和/或添加代码来处理它。CXF 适用于简单/默认客户端和更复杂的客户端。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T01:53:07.150

我会推荐[SOAP UI](http://www.soapui.org/)来完成你需要做的事情。您无需编写任何代码 - 您可以从 soap UI 客户端调用 Web 服务。

如果您需要自动进行soap调用，您可以使用maven插件作为构建/部署过程的一部分。有关这里的 Maven 插件的更多信息：http: [//www.soapui.org/Test-Automation/maven-2x.html](http://www.soapui.org/Test-Automation/maven-2x.html)

# windows-vista - 为什么 Windows Vista 64 位默认使用 32 位 cmd.exe？（特定于机器）

> ID：373351
> 
> 赞同：0
> 
> 时间：2008-12-17T01:03:14.410
> 
> 标签：windows-vista, 32bit-64bit, cmd, system32, syswow64

**情况：**

我需要将我们当前的开发环境从 Windows XP 32 位转换为 Windows Vista 64 位 (*)。自然地，我在我们的构建系统中遇到了很多硬编码路径存在问题的地方（例如“ `C:\Program Files`”变成“ `C:\Program Files (x86)`”）。幸运的是，有一个`%ProgramFiles%`环境变量可以根据源进程（32 位或 64 位）映射到正确的目录。所以我用 更新了构建脚本`%ProgramFiles%`，我确信这会结束。

从命令行 ( `C:\Windows\System32\cmd.exe`) 调用构建环境。

**问题：** 在一台特定的机器上（即我工作的开发机器），它`C:\Windows\System32\cmd.exe`实际上是一个 32 位进程，所以脚本找到了目录的`x86`版本，`Program Files`一切都很好。

在我能找到的所有其他 64 位机器（包括我的家用机器）上，`C:\Windows\System32\cmd.exe`都是 64 位版本，而 32 位版本在`C:\Windows\SysWow64\cmd.exe`. 所以构建脚本找不到他们正在寻找的任何东西并且失败了。

我现在明白了，`cmd.exe`如果你需要的话，应该明确调用 32bit ，默认情况下你会得到一个 64bit `cmd.exe`。典型案例`WORKSFORME`...

**问题是**，这不正确的机器发生了什么？为什么我`cmd.exe`在一台机器上默认获得 32 位，而在其他机器上却没有？在所有情况下，我都是`C:\Windows\System32\cmd.exe`从`Start|Run`菜单中显式执行，但*仅在一台机器上*得到不同的结果。都运行相同版本的 Vista 64 位。

有什么想法或见解吗？

(*) 请接受我*必须*这样做。我无权说出我*为什么*要这样做。从头开始重新安装操作系统和一切可能会起作用，但这肯定是矫枉过正。此外，说服我们的 IT 部门提供 Vista 机器已经够难的了！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T01:48:26.007

[如果您从 32 位进程运行 cmd，由于文件重定向 ( http://msdn.microsoft.com/en-us/library/aa384187.aspx](http://msdn.microsoft.com/en-us/library/aa384187.aspx) ) ，您将获得 32 位 cmd 。当您从资源管理器运行 CMD 时，您是否获得了 32 位版本的 CMD？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T20:11:48.860

我终于找到了问题所在，果然很简单：用户错误。资源管理器（它本身是 Windows Vista 64 位上的 64 位进程）默认启动 64 位命令提示符。如果您想要 32 位`CMD.EXE`，则必须显式引用`C:\Windows\SysWoW64\CMD.EXE`.

这在我的系统上运行良好的原因是我在大多数命令行使用中都使用了 Far Manager，它是 32 位的（因此它会启动 32 位命令提示符）。当我验证时，我一定是混淆了 32 位窗口和 64 位窗口（毕竟它们看起来一样！）并问了一个愚蠢的问题。

Die in Sente，问题`%ProgramFiles(x86)%`在于它在 Windows Vista 32 位上不存在，因为那样会更简单。

啊，没有什么比公开发帖更能自欺欺人了……:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T03:35:37.583

`cmd.exe`从两台机器的开始菜单中启动。精确复制：

*   单击开始球
*   键入“ `cmd`”，只出现一个匹配项 ( `c:\windows\system32\cmd.exe`)
*   启动它。

在我的工作机器上，它启动 32 位版本（如任务管理器所示，它已`*32`附加到`Processes`选项卡中的名称）。在我尝试过的所有其他 Vista 64 机器上，这会启动 64 位版本`cmd`，我无法找到对此行为的合理解释。

我还没有检查`explorer.exe`受影响机器上本身是 32 位还是 64 位，也许这是相关的……谢谢你的提示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T00:10:38.317

而不是，无论哪个 cmd.exe 正在运行，是否总`%ProgramFiles%`有一个你想要的地方？`%Programfiles(x86)%`我的 Windows XP 64 位系统都有这个；请原谅我没有花时间启动 Vista 系统。

# iphone - 获取 iPhone 照片曝光信息

> ID：373357
> 
> 赞同：2
> 
> 时间：2008-12-17T01:04:22.770
> 
> 标签：iphone, photography

有什么方法可以获取在 iPhone 上拍摄的照片的曝光设置（光圈、快门速度、ISO）？

在 iPhone 上运行的应用程序可以使用 UIImagePickerController 接口来拍照，但这并没有提供太多关于图片的信息。

在 iPhone 上拍摄的照片的 EXIF 数据包含光圈信息，但不包含快门速度或 ISO。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T03:02:45.747

目前使用 SDK 无法做到这一点。如果您认为需要它，我建议您向 Apple[提交增强请求](http://bugreporter.apple.com)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-30T15:24:40.093

更新，所以来这里的人会知道：

*   在 iOS 4 中，您可以在一定程度上设置曝光/白平衡/对焦。基本上，您可以控制这些参数的模式（自动/连续/固定）和兴趣点。

*   无论如何，如果您正在捕捉静止图像 - 您可以从图像的 exif 信息（实际曝光、快门速度、iso 等）中提取元数据。

HTH 某人，奥德

# .net - 从 Internet 加载依赖程序集是一种好习惯吗？

> ID：373362
> 
> 赞同：1
> 
> 时间：2008-12-17T01:06:15.577
> 
> 标签：.net, deployment, assemblies, dependencies

我知道有几种方法可以部署 .net windows 客户端应用程序：

有[Windows Installer](http://msdn.microsoft.com/en-us/library/aa367449(VS.85).aspx) , [Click Once](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx) , 一个简单的下载 & 运行, 并在 Internet Explorer 中加载 windows 窗体/WCF 应用程序 (不要将后者与 WCF/E - Silverlight RIA 应用程序混淆)

所以...考虑一下真正的 Windows 客户端应用程序——只是为了明确一点：那些在你的文件系统中由 .exe 组成的应用程序——可以从 Internet 加载其部分或全部依赖项是一个好主意吗？

```
<assemblyIdentity 
    name="MyAssembly"
    publicKeyToken="89a956accc8f98e98a9e954a"
    culture="en-US" />
<codeBase 
    version="2.0.0.0"
    href="http://www.contoso.com/MyAssembly.dll" /> <!-- look here --> 
```

显然有一些严重的缺点：必须始终连接，客户端中的[CAS](http://msdn.microsoft.com/en-us/library/930b76w0(VS.71).aspx)配置（互联网依赖项将在[Internet_Zone 代码组](http://msdn.microsoft.com/en-us/library/c5tk9z76(VS.71).aspx)中），更不用说加载时间了。

但我也能想到几个优点。

有哪些问题？有人在实际项目中使用过这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T01:28:16.763

我可以看到在公司 Intranet 环境中执行您的建议，其中自定义应用程序可以与自定义服务器通信，并且每个都可以很好地理解对方。当然，可能存在连接和同步问题，但随着时间的推移，这些问题可能会在某种程度上得到解决。我在一个应用程序对一组后端服务器执行基本 CRUD 任务的情况下完成了此操作，这些服务器对数据库运行命令。诚然，它并没有被给予太多重视，并且有一段时间是某人的宠物项目，但它最终确实做了一些不错的事情。

在互联网环境中，我认为安全问题将是我最大的担忧，因为另一个因素是如果该程序集升级它可能会使应用程序崩溃。对于互联网情况，我认为 Click Once 是我的建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T02:27:34.070

如果您正在加载的程序集是从受信任的提供程序进行数字签名的，那么从安全的角度来看，它应该不会那么糟糕。如果您*真的*信任他们...例如，如果您从一些第三方供应商那里下载程序集，这些供应商可能不会很好地掌握他们的密钥，那么是的，我会谨慎这样做。

# java - 为什么 Java 泛型类型参数不在运行时具体化？

> ID：373363
> 
> 赞同：6
> 
> 时间：2008-12-17T01:06:20.723
> 
> 标签：java, generics

我的理解是，C# 和 java 在泛型方面在某些方面有所不同，其中之一是泛型类型参数在 C#/.NET 中运行时可用，但在 Java 中不可用。为什么 Java 语言设计者会这样做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T01:13:26.623

允许与前泛型字节码的二进制兼容性，从而允许新代码与旧代码交互。

从Java 教程的[类型擦除页面：](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)

> 类型擦除使使用泛型的 Java 应用程序能够保持与在泛型之前创建的 Java 库和应用程序的二进制兼容性。
> 
> [...]
> 
> 存在类型擦除，以便新代码可以继续与旧代码交互。

有关相关问题，请查看[C# vs Java generics](https://stackoverflow.com/questions/355060/c-vs-java-generics)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T01:15:31.970

我记得在《Hardcore Java》一书中读到了一些关于此的内容：

> 在运行时检查集合中的元素的问题是它非常昂贵。效率的顺序只有 O(n)。如果您的收藏中只有 10 个地址，则检查元素很容易。但是，如果集合包含 15,000 个地址，那么每当有人调用 setter 时，您都会产生巨大的开销。
> 
> 另一方面，如果您可以阻止用户在编译时将地址以外的任何内容放入您的集合中，那么您就不必在运行时检查类型。如果他们试图给你一些不是地址的东西，那么编译器将拒绝这个尝试。这正是参数化类型所做的。

然而，“为什么”的问题永远无法真正得到令人满意的回答，因为与人、时间、地点和政治有关的变量太多了。我记得在其他地方读到过，该决定与保持与 Java 字节码中已经完成的事情的方式的兼容性有很大关系。这是同一本书的另一句话：

> 在编译器解决了泛型引入的类型安全之后，它会从类型中删除参数化。因此，该信息在运行时不可用。如 Sun 所述，擦除的目的是允许使用旧版本 JDK 构建的类库能够在 JDK 1.5 虚拟机上运行。

我很好奇，运行时泛型提供了哪些优势？

# c# - 如何在 C# 中使用 UTF-8 以外的代码页写出文本文件？

> ID：373365
> 
> 赞同：55
> 
> 时间：2008-12-17T01:06:41.767
> 
> 标签：c#, encoding, utf-8, iso-8859-1

我想写出一个文本文件。

而不是默认的 UTF-8，我想将其编码为 ISO-8859-1，即代码页 28591。我不知道该怎么做......

我正在用以下非常简单的代码写出我的文件：

```
using (StreamWriter sw = File.CreateText(myfilename))
{
    sw.WriteLine("my text...");
    sw.Close();
} 
```

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-12-17T01:11:43.957

```
using System.IO;
using System.Text;

using (StreamWriter sw = new StreamWriter(File.Open(myfilename, FileMode.Create), Encoding.WhateverYouWant))
{    
    sw.WriteLine("my text...");     
} 
```

获取编码的另一种方法：

```
using System.IO;
using System.Text;

using (var sw  = new StreamWriter(File.Open(@"c:\myfile.txt", FileMode.CreateNew), Encoding.GetEncoding("iso-8859-1"))) {
    sw.WriteLine("my text...");             
} 
```

查看 StreamWriter 构造函数的文档。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-01-03T21:49:52.467

简单的！

```
System.IO.File.WriteAllText(path, text, Encoding.GetEncoding(28591)); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-04-28T16:54:56.847

用 FileStream 包装你的 StreamWriter，这样：

```
string fileName = "test.txt";
string textToAdd = "Example text in file";
Encoding encoding = Encoding.GetEncoding("ISO-8859-1"); //Or any other Encoding

using (FileStream fs = new FileStream(fileName, FileMode.CreateNew))
{
    using (StreamWriter writer = new StreamWriter(fs, encoding))
    {
        writer.Write(textToAdd);
    }
} 
```

[看看 MSDN](http://msdn.microsoft.com/de-de/library/f5f5x7kt%28v=vs.110%29.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-08-30T12:42:05.240

你可以有这样的东西

```
 switch (EncodingFormat.Trim().ToLower())
    {
        case "utf-8":
            File.WriteAllBytes(fileName, ASCIIEncoding.Convert(ASCIIEncoding.ASCII, new UTF8Encoding(false), convertToCSV(result, fileName)));
            break;
        case "utf-8+bom":
            File.WriteAllBytes(fileName, ASCIIEncoding.Convert(ASCIIEncoding.ASCII, new UTF8Encoding(true), convertToCSV(result, fileName)));
            break;
        case "ISO-8859-1":
            File.WriteAllBytes(fileName, ASCIIEncoding.Convert(ASCIIEncoding.ASCII, Encoding.GetEncoding("iso-8859-1"), convertToCSV(result, fileName)));
            break;
        case ..............
    } 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-12-17T01:08:28.410

更改流编写器的编码。这是一个财产。

[http://msdn.microsoft.com/en-us/library/system.io.streamwriter.encoding.aspx](http://msdn.microsoft.com/en-us/library/system.io.streamwriter.encoding.aspx)

所以：

```
sw.Encoding = Encoding.GetEncoding(28591); 
```

在写入流之前。

# compiler-construction - C# Object Initializers 和 v2.0 编译器错误

> ID：373366
> 
> 赞同：0
> 
> 时间：2008-12-17T01:07:23.390
> 
> 标签：compiler-construction, teamcity, csc, object-initializers

我在 TeamCity (v4.0) 中设置我的一个项目时遇到问题，特别是在使用对象初始化器时。

该项目正常构建，但似乎 TeamCity 将构建文件转换为它喜欢的东西（一些 MSBuild 突变），并且在为解决方案的一部分编译代码时，它在看到对象初始化程序时会犹豫不决。

具体的错误是：

```
[11:16:21]: ErrorView.xaml.cs(22, 187): error CS1026: ) expected
[11:16:21]: ErrorView.xaml.cs(22, 208): error CS0116: A namespace does not directly contain members such as fields or methods
[11:16:21]: ErrorView.xaml.cs(27, 16): error CS1518: Expected class, delegate, enum, interface, or struct
[11:16:21]: ErrorView.xaml.cs(35, 16): error CS1518: Expected class, delegate, enum, interface, or struct
[11:16:21]: ErrorView.xaml.cs(46, 91): error CS1031: Type expected
[11:16:21]: ErrorView.xaml.cs(46, 119): error CS0116: A namespace does not directly contain members such as fields or methods
[11:16:21]: ErrorView.xaml.cs(48, 17): error CS1022: Type or namespace definition, or end-of-file expected 
```

当我进一步研究时，问题似乎与使用 v2.0 框架目录中的 CSC 将构建文件转换为 TeamCity 格式有关。

是否可以使用带有 .NET 2.0 编译器的对象初始化程序（.NET 3.0 功能）来编译代码（我认为不会，尽管我可能会遗漏一些东西），如果没有，有没有人知道强制它使用的方法3.0 编译器（如果存在）还是 3.5 编译器？

对于那些感兴趣的人，正在执行的 CSC 命令是：

```
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Csc.exe /noconfig /nowarn:1701,1702 /errorreport:prompt /warn:4 /define:DEBUG;TRACE 
/reference:..\..\..\build\blah.Logging.dll /reference:..\..\..\build\blah.Presentation.Interfaces.dll 
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.VisualBasic.dll /reference:"C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\PresentationCore.dll" 
/reference:"C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\PresentationFramework.dll" 
/reference:"C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\PresentationFramework.Luna.dll" 
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Data.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Design.dll 
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Drawing.dll 
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.dll
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Windows.Forms.dll 
/reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Xml.dll 
/reference:"C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\UIAutomationProvider.dll"
/reference:"C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\WindowsBase.dll" /debug+ /debug:full /filealign:512 
/keyfile:..\..\..\resources\blah.snk /optimize- /out:obj\Debug\blah.dll 
/resource:obj\Debug\blah.UserInterface.Properties.Resources.resources
/resource:obj\Debug\blah.UserInterface.blah.exe.license /target:library 
/win32icon:blah.ico SignalStrengthIndicator.xaml.cs TrayNotifier.xaml.cs ConnectedView.xaml.cs ConnectionProgressView.xaml.cs NetworkPasswordView.xaml.cs 
TrayProgress.xaml.cs NetworkConnectionView.xaml.cs ClassFiles\NetworkTypeConverter.cs 
ClassFiles\SecurityImageConverter.cs ClassFiles\SecurityTooltipConverter.cs 
ClassFiles\SignalStrengthTooltipConverter.cs ClassFiles\SignalVisibilityConverter.cs 
ClassFiles\SynchronizedObservableCollection.cs ConnectionOption.xaml.cs 
DisconnectionProgressView.xaml.cs ErrorView.xaml.cs ..\..\..\config\assemblyversion.cs 
Properties\Resources.Designer.cs Properties\Settings.Designer.cs 
```

谢谢！

更新：我已经部分（阅读：我对此不满意）通过将构建运行程序从 Nant 更改为命令运行程序来解决问题 - 这只是按预期执行了 Nant 构建文件，没有任何操作，尽管反馈级别是不同的。任何其他建议将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T01:50:20.683

您使用的是 sln2005 构建运行器吗？那将使用 2.0 csc。检查您的构建配置并将其更改为 sln2008 运行器（请参阅[http://www.jetbrains.net/confluence/display/TCD4/3.Build+Runners](http://www.jetbrains.net/confluence/display/TCD4/3.Build+Runners)）。那应该使用 3.5 编译器。

如果您使用的是 MSBuild运行器[http://www.jetbrains.net/confluence/display/TCD4/MSBuild](http://www.jetbrains.net/confluence/display/TCD4/MSBuild) ，请检查您是否已在配置页面上将版本号设置为 3.5。

编辑：检查 NAnt 后请参阅[http://www.jetbrains.net/confluence/display/TCD4/NAnt_](http://www.jetbrains.net/confluence/display/TCD4/NAnt_)

它说：“默认情况下，NAnt msbuild 任务使用 MSBuild 2.0（来自 Microsoft .NET Framework 2.0），但是如果您将值为 true 的 teamcity_dotnet_use_msbuild_v35 属性添加到您的NAnt 脚本中的 msbuild 任务。例如："

```
<msbuild project="SimpleEcho.v35.proj">
   <!-- this property enables MSBuild 3.5 -->
   <property name="teamcity_dotnet_use_msbuild_v35" value="true"/>
   ...
 </msbuild> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T13:08:06.573

[对于 NAnt 脚本，可以在构建配置设置 ( http://www.jetbrains.net/confluence/display/TCD4/6.Properties+and+environment+variables](http://www.jetbrains.net/confluence/display/TCD4/6.Properties+and+environment+variables) )中简单地定义系统属性 teamcity_dotnet_use_msbuild_v35以使其运行 msbuild 3.5。

另一方面，如果 NAnt 目标框架设置为 net-3.5（仅适用于 NAnt 0.86 beta 1），则 msbuild 应取自 .NET 3.5 文件夹。

# exception - sqlite3：由于未完成的语句而无法关闭

> ID：373369
> 
> 赞同：3
> 
> 时间：2008-12-17T01:10:57.283
> 
> 标签：exception, sqlite

我有两个 sqlite 连接并执行如下（CMyDatabase 是 sqlite3 的派生类）：

```
CMyDatabase* dbConnection1 = new CMyDatabase;
dbConnection1->OpenDataBase(CQCommon::GetModulePath() + L"test.db");

CMyDatabase* dbConnection2 = new CMyDatabase;
dbConnection2->OpenDataBase(CQCommon::GetModulePath() + L"test.db");

dbConnection2->BeginTrans();
CString updateStr("update ImageAlbumEntry set ImageID = 2 where ID = 1;");
dbConnection2->ExecNoQuery(updateStr);
CString queryStr("select ImageID from ImageAlbumEntry where ID = 1;");
CppSQLite3Query queryResult;
dbConnection2->ExecQuery(queryStr, queryResult);
cout<<queryResult.getIntField(0)<<endl;
dbConnection2->EndTrans(TRUE);

dbConnection2->CloseDataBase();
dbConnection1->CloseDataBase(); 
```

现在当我调用 dbConnection1->CloseDataBase() 时。我遇到了错误，称“由于未完成的声明而无法关闭”。谁能解释问题的原因和解决方法？谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T06:28:48.643

取决于您使用的包装器。我猜你正在使用类似于[cppSQLite3](http://senior.ceng.metu.edu.tr/2006/korsan/API/PapaganAnimationEditor/class_cpp_s_q_lite3_query.html)

如果这是真的，那么你需要发出一个**CppSQLite3Query::finalize**命令来告诉 sqlite3 你已经完成了你的查询。

从[这里的 sqlite3 文档](http://www.sqlite.org/cintro.html)

**sqlite3_finalize()**
这个例程破坏了先前调用 sqlite3_prepare() 创建的准备好的语句。为了避免内存泄漏，必须使用对该例程的调用来销毁每个准备好的语句。

# python - 如何获取给定时区的“午夜”UTC 时间？

> ID：373370
> 
> 赞同：64
> 
> 时间：2008-12-17T01:11:07.640
> 
> 标签：python, datetime, timezone, utc, pytz

我现在能想到的最好的就是这个怪物：

```
>>> datetime.utcnow() \
...   .replace(tzinfo=pytz.UTC) \
...   .astimezone(pytz.timezone("Australia/Melbourne")) \
...   .replace(hour=0,minute=0,second=0,microsecond=0) \
...   .astimezone(pytz.UTC) \
...   .replace(tzinfo=None)
datetime.datetime(2008, 12, 16, 13, 0) 
```

即，在英语中，获取当前时间（UTC），将其转换为其他时区，将时间设置为午夜，然后转换回 UTC。

我不只是使用 now() 或 localtime() 因为这将使用服务器的时区，而不是用户的时区。

我不禁觉得我错过了一些东西，有什么想法吗？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-12-19T18:29:13.297

如果你这样做，我认为你可以减少一些方法调用：

```
>>> from datetime import datetime
>>> datetime.now(pytz.timezone("Australia/Melbourne")) \
            .replace(hour=0, minute=0, second=0, microsecond=0) \
            .astimezone(pytz.utc) 
```

但是......在您的代码中存在比美学更大的问题：它会在切换到夏令时的当天给出错误的结果。

原因是 datetime 构造函数和`replace()`DST 更改都没有考虑在内。

例如：

```
>>> now = datetime(2012, 4, 1, 5, 0, 0, 0, tzinfo=pytz.timezone("Australia/Melbourne"))
>>> print now
2012-04-01 05:00:00+10:00
>>> print now.replace(hour=0)
2012-04-01 00:00:00+10:00 # wrong! midnight was at 2012-04-01 00:00:00+11:00
>>> print datetime(2012, 3, 1, 0, 0, 0, 0, tzinfo=tz)
2012-03-01 00:00:00+10:00 # wrong again! 
```

但是，`tz.localize()`国家的文档：

> 此方法应用于构造本地时间，而不是将 tzinfo 参数传递给日期时间构造函数。

因此，您的问题是这样解决的：

```
>>> import pytz
>>> from datetime import datetime, date, time

>>> tz = pytz.timezone("Australia/Melbourne")
>>> the_date = date(2012, 4, 1) # use date.today() here

>>> midnight_without_tzinfo = datetime.combine(the_date, time())
>>> print midnight_without_tzinfo
2012-04-01 00:00:00

>>> midnight_with_tzinfo = tz.localize(midnight_without_tzinfo)
>>> print midnight_with_tzinfo
2012-04-01 00:00:00+11:00

>>> print midnight_with_tzinfo.astimezone(pytz.utc)
2012-03-31 13:00:00+00:00 
```

但是，不能保证 1582 年之前的日期。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2012-06-27T23:57:46.290

[@hop 的答案](https://stackoverflow.com/a/381788/4279)在夏令时 (DST) 过渡之日是错误的，例如 2012 年 4 月 1 日。要修复它[`tz.localize()`](http://pytz.sourceforge.net/#localized-times-and-date-arithmetic)可以使用：

```
tz = pytz.timezone("Australia/Melbourne")
today = datetime.now(tz).date()
midnight = tz.localize(datetime.combine(today, time(0, 0)), is_dst=None)
utc_dt = midnight.astimezone(pytz.utc) 
```

与评论相同：

```
#!/usr/bin/env python
from datetime import datetime, time
import pytz # pip instal pytz

tz = pytz.timezone("Australia/Melbourne") # choose timezone

# 1\. get correct date for the midnight using given timezone.
today = datetime.now(tz).date()

# 2\. get midnight in the correct timezone (taking into account DST)
#NOTE: tzinfo=None and tz.localize()
# assert that there is no dst transition at midnight (`is_dst=None`)
midnight = tz.localize(datetime.combine(today, time(0, 0)), is_dst=None)

# 3\. convert to UTC (no need to call `utc.normalize()` due to UTC has no 
#    DST transitions)
fmt = '%Y-%m-%d %H:%M:%S %Z%z'
print midnight.astimezone(pytz.utc).strftime(fmt) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-04-26T14:57:32.467

使用 dateutil.tz 比使用 pytz 更直接：

```
>>>import datetime
>>>import dateutil.tz
>>>midnight=(datetime.datetime
             .now(dateutil.tz.gettz('Australia/Melbourne'))
             .replace(hour=0, minute=0, second=0, microsecond=0)
             .astimezone(dateutil.tz.tzutc()))
>>>print(midnight)
2019-04-26 14:00:00+00:00 
```

[tzinfo 文档](https://docs.python.org/3/library/datetime.html#tzinfo-objects)从 Python 3.6 开始推荐使用dateutil.tz。dateutil.tz 中的 tzinfo 对象对 DST 等异常没有问题，无需 pytz 的本地化功能。使用来自 user3850 的示例：

```
>>> now = (datetime.datetime(2012, 4, 1, 5,  
...         tzinfo = dateutil.tz.gettz('Australia/Melbourne'))) 
>>> print(now.replace(hour = 0).astimezone(dateutil.tz.tzutc()))
2012-03-31 13:00:00+00:00 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T01:17:26.223

设置 TZ 环境变量会修改 Python 的日期和时间函数使用的时区。

```
>>> time.gmtime()
(2008, 12, 17, 1, 16, 46, 2, 352, 0)
>>> time.localtime()
(2008, 12, 16, 20, 16, 47, 1, 351, 0)
>>> os.environ['TZ']='Australia/Melbourne'
>>> time.localtime()
(2008, 12, 17, 12, 16, 53, 2, 352, 1) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T01:20:06.827

每个时区都有一个数字，例如 US/Central = -6。这被定义为与 UTC 的小时偏移量。由于 0000 是午夜，您可以简单地使用此偏移量来查找任何时区的时间，当它是午夜 UTC 时。要访问它，我相信您可以使用

```
时间.时区
```

根据[The Python Docs](http://docs.python.org/library/time.html)， time.timezone 实际上给出了这个数字的负值：

> > 时间.时区
> > 
> > > 本地（非 DST）时区的偏移量，以 UTC 以西的秒数为单位（在西欧大部分地区为负，在美国为正，在英国为零）。

因此，如果它是正数（即，如果它是芝加哥的午夜（具有 +6 时区值），那么它就是 6000 = UTC 上午 6 点），您只需使用该数字以小时为单位。

如果该数字为负数，则从 24 中减去。例如，柏林会给出 -1，因此 24 - 1 => 2300 = 晚上 11 点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-27T23:45:18.783

值得注意的是，我们可以调整@jfs 给出的答案以找到明天的午夜或昨天的午夜等。诀窍是在感知时区添加一定天数。这是可行的，因为虽然这通常会增加 24 小时，但有时它可能会根据 DST 问题增加 23 或 25 小时。

```
from datetime import datetime, time, timedelta
import pytz

def midnight_UTC(offset):

    # Construct a timezone object
    tz = pytz.timezone('Australia/Melbourne')

    # Work out today/now as a timezone-aware datetime
    today = datetime.now(tz)

    # Adjust by the offset. Note that that adding 1 day might actually move us 23 or 25
    # hours into the future, depending on daylight savings. This works because the {today}
    # variable is timezone aware
    target_day = today + timedelta(days=1) * offset

    # Discard hours, minutes, seconds and microseconds
    midnight_aware = tz.localize(
        datetime.combine(target_day, time(0, 0, 0, 0)), is_dst=None)

    # Convert to UTC
    midnight_UTC = midnight_aware.astimezone(pytz.utc)

    return midnight_UTC

print("The UTC time of the previous midnight is:", midnight_UTC(0))
print("The UTC time of the upcoming midnight is:", midnight_UTC(1)) 
```

# c# - 你将如何解决这个多态性字符串构建问题

> ID：373380
> 
> 赞同：1
> 
> 时间：2008-12-17T01:17:50.390
> 
> 标签：c#, .net, string, polymorphism

抱歉，标题没有那么明显，如果有人想更改它，请继续。另请注意，我已经问过一个关于这种事情的[问题](https://stackoverflow.com/questions/361742/would-this-be-a-good-case-for-polymorphism)，但这个问题更多的是关于你将如何攻击它，因为我的攻击似乎感觉不对。

我在构建一个字符串以使用另一个问题中的多态方法以正确的顺序发送到 OLE 对象时遇到问题。

OLE 对象只能接受和接收一个字符串，所以我正在做的是围绕所有常用命令构建一个包装器，并为它们提供更多的 .NET 感觉。

我很快遇到的问题是我的包装器必须发送的一些命令很长并且具有可选位，然后突然将一个只设置名称的方法变成了一个大字符串构建方法，if's just to set a name当然，这种情况无处不在，因为有很多命令。

现在，为了拥有一个好的包装器，我希望能够包装字符串构建过程，以便将字符串构建逻辑从包装器本身移到构建器对象中。
我试图通过使用多态性来解决这个问题，当我有一个专门为构建一种类型的命令字符串而设计的**构建器对象类时效果很好。**有关详细信息，请参阅其他帖子。

对不起，我现在要切入正题。

主要问题是必须构建大量命令字符串，这意味着更多的**构建器对象**。
所以我真的很想有一个通用的字符串构建器，它可以从任何命令列表构建一个字符串，但问题是即使用户以错误的顺序设置它们，它们也必须按**正确的顺序排列。**

你会如何处理这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T01:34:32.057

我认为你把事情复杂化了，最终会创建太多的类。

我认为这个问题与其说是构建字符串，不如说是你如何为.net 调用者提供一个漂亮的接口。仅仅因为有很多可能的参数并不意味着你需要为它们创建很多类，至少如果每个参数中的可能变化不是很复杂，即如果值存在或不存在，并且有可选单位。然后你让自己陷入需要知道命令部分需要的顺序等的混乱中。

可能我会为命令的可能参数创建一个类，让调用者设置他们喜欢的任何参数，并让该类负责在一个大的（丑陋的？）字符串连接中生成字符串。

例如，我会从这样的东西开始，然后我会添加一些方法，根据命令不同部分的相似性，重构一些字符串连接是有意义的。

```
class CommandArgs 
{
    private double? _Position_x = null;
    private double? _Position_y = null;
    private String _Position_units = null;
    private double? _Width = null;
    private String _Width_units = null;
    private double? _Height = null;
    private String _Height_units = null;

    // maybe there's a better tuple-like type for this.
    public double[] Position 
    {
         set
         {
             if (value.length != 2) throw new ArgumentException("argh!");
             _Position_x = value[0];
             _Position_y = value[1];
         }
    }
    public string Position_Units
    {
         set
         {
             _Position_Units = value;
         }
    }
    public double Width
         set
         {
             _Width = value;
         }
    }
    public double Height
         set
         {
             _Height = value;
         }
    }
    public string Width_Units
         set
         {
             _Width = value;
         }
    }
    public string Height_Units
         set
         {
             _Height = value;
         }
    }
    // ....
    public override string ToString()
    {
         return 
             ( _Position_x != null ? string.Format(" Position ({0},{1})",_Position_x, _Position_y ) : "" )
             + ( _Height != null ? string.Format(" Height {0}")
                   + ( _Height_Units != null ? string.Format(" Units {0}", _Height_Units) : "" )
             + ( _Width != null ? string.Format(" Width {0}")
                   + ( _Width_Units != null ? string.Format(" Units {0}", _Width_Units) : "" )
         // ...
         ;
    }
} 
```

如果您愿意，您可能希望创建方法而不是属性，因此您可以同时设置值和单位。

我可能会立即使用以下方法重构它：

```
private string FormatUnits(string units)
{
    return units == null ? "" : string.Format(" Units {0}", units);
}
private string FormatSingleValueArgument(string argName, object argValue, string units)
{
    if (argValue == null) return "";
    return string.Format(" {0} {1}", argName, argValue) + FormatUnits(units);
} 
```

使 ToString() 看起来像这样：

```
 return 
             ( _Position_x != null ? string.Format(" Position ({0},{1})",_Position_x, _Position_y ) : "" )
             + FormatSingleValueArgument("Height", _Height, _Height_Units) 
             + FormatSingleValueArgument("Width", _Width, _Width_Units) 
         // ...
         ; 
```

如果有几个类似位置的参数，那么也许可以为类似位置的参数做一个类似的方法。

# python - 地理编码库

> ID：373383
> 
> 赞同：23
> 
> 时间：2008-12-17T01:19:28.060
> 
> 标签：python, api, rest, geocoding

我正在使用 python，我需要将“布卢明顿，印第安纳州”等位置映射到 GPS 坐标，以便测量它们之间的距离。您推荐哪些地理编码库/API？也欢迎其他语言的解决方案。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-17T01:56:53.197

[Geopy](http://code.google.com/p/geopy/)允许您从多种地理编码器（包括 Google、Yahoo、Virtual Earth）中进行选择。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-12-22T21:45:21.790

Google 的网络服务非常易于使用。只需将查询放在 URL 中即可。为了让它更容易/更懒惰，我将无耻地宣传[pygeocoder](http://code.xster.net/pygeocoder)，一个用于谷歌地理编码的 Python 包装器。然后你可以做类似的事情

```
print Geocoder.geocode("Montreal, Canada")[0].coordinates 
```

得到一个带坐标的元组。你也可以做类似的事情

```
Geocoder.geocode("sushi, San Francisco").count 
```

或者

```
Geocoder.geocode("sushi, San Francisco")[0].postal_code 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-17T01:34:24.893

Google Maps API[支持地理编码](http://code.google.com/apis/maps/documentation/services.html#Geocoding)，Python Cookbook 有一个从 Python 访问它的简单[示例](http://code.activestate.com/recipes/498128/)（尽管该配方不直接使用 API，只是简单的 maps.google.com URL）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-17T01:45:43.687

谷歌和微软都有很容易接入的 API。有一些限制，但它们非常慷慨。您可能还想查看[http://geocoder.us/](http://geocoder.us/)。我不知道有任何好的免费地理编码服务（我已经花时间寻找！）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-17T01:21:04.953

你可以看看[GeoLite City](http://www.maxmind.com/app/geolitecity)。它是免费的（GPL），但他们说这不是最准确的。

> 在 25 英里半径范围内，美国在国家一级超过 99.5%，在城市一级超过 79%

这仍然可能适合您，具体取决于您的需求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T03:25:52.080

您可以使用像谷歌地图这样的网络 API 来查找坐标。然后，如果您只需要计算距离（直线），您可以应用[一个公式来获得非常准确的结果。](http://www.movable-type.co.uk/scripts/latlong.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-22T04:02:18.020

[USC WebGIS 地理编码](https://webgis.usc.edu)器( [https://webgis.usc.edu](https://webgis.usc.edu) ) 是免费的。它具有您可以从脚本调用的 API，或者您可以上传和处理数据库（mdb、csv 等）。准确度级别取决于您的地址在哪里。例如，在洛杉矶县可以使用包裹质心，而在该国其他地区只有 TIGER/Lines 可用。参考数据源的覆盖图目前不可用，但正在开发中。一旦完成更多开发，底层工具计划在未来开源。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-22T04:09:10.160

前几天我遇到了[http://www.geonames.org/](http://www.geonames.org/)。您实际上可以下载邮政​​编码的所有数据，包括纬度/经度等，甚至用于商业用途，以节省连接到外部资源的麻烦。我认为你可以对城市名称做同样的事情（邮政编码数据已经有与之关联的 subrub 名称）。

[可以在此处](http://www.movable-type.co.uk/scripts/latlong.html)和[此处（.NET 示例）](http://www.dotnetjunkies.ddj.com/PrintContent.aspx?type=article&id=AE9E07E6-612C-4709-9F20-5BA186A934E1)中找到有关查找“乌鸦飞翔”距离的一些数学运算 - 直接从点到点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-02-09T14:27:37.680

您可以更好地查看 Geopy 模块。它非常值得使用，因为它包含 Google 地图、雅虎地图地理编码器，您可以使用它们来实现地理编码。

# sql - 从 DB2 存储过程中检索返回值

> ID：373386
> 
> 赞同：3
> 
> 时间：2008-12-17T01:21:39.337
> 
> 标签：sql, stored-procedures, db2, return-value

我有一个在 DB2 存储过程中重复的代码块。我想把它分成一个新的过程，我可以用参数调用它并让它返回一个值。

如何创建返回值的过程以及如何从原始过程中调用此过程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T23:22:28.123

是的，只需要一个输出参数。不过，我在手册或谷歌中找不到正确的调用语法。

您可以像这样创建过程：

```
CREATE PROCEDURE myschema.add(IN a INT, IN b INT, OUT c INT)
BEGIN
    SET c = a + b;
END 
```

然后这样称呼它（这是我想不通的）：

```
DECLARE result INT DEFAULT 0;

CALL myschema.add(10, 20, result);

-- result == 30 
```

然后输出最终出现在提供的`result`变量中。您还可以有多个`OUT`参数以及`INOUT`参数。

当然现在看起来很明显。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T08:24:38.700

您从原始过程中调用的过程中的输出参数怎么样？调用 proc 是通过 CALL 命令完成的。它在手册中；）

# visual-studio-2008 - 如何手动生成 Visual Studio 2008 解决方案？

> ID：373387
> 
> 赞同：0
> 
> 时间：2008-12-17T01:22:46.930
> 
> 标签：visual-studio-2008, code-generation

对于我正在做的项目，我需要手动创建一个 .net 项目。我目前正在使用 a`StreamWriter`创建 .sln、.csproj 和 base（暂时为空）类。我也在生成 AssemblyInfo.cs 类。当您创建一个空的 Windows 类库项目时，我已经完全复制了 VS.Net 创建的文件和文件夹结构。

出于某种原因，当我尝试打开 .sln 文件时，什么也没有发生。我可以很好地打开 .csproj 文件，但项目无法编译。我没有收到任何错误消息，只是没有任何反应。我已经检查了我正在创建的所有文件与 Visual Studio 使用 Beyond Compare 创建的文件，它们完全相同，除了项目名称和 GUID。

有谁知道 Visual Studio 在创建项目时是否在幕后做某事？还有什么我可能会丢失的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T02:24:49.287

我会检查您文件的文本编码。我相信 .csproj 文件被编码为 UTF-8，但我可能是错的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T04:40:20.293

戴夫马克尔有正确的答案。

我正在使用以下代码来创建我的文件：

```
StreamWriter sw = File.CreateText(FileName); 
```

这正确创建了文件，但没有正确设置编码。我把它改成这样：

```
FileStream fs = File.Create(FileName);
StreamWriter sw = new StreamWriter(fs, Encoding.UTF8); 
```

而且效果很好。

# c# - 在大型 .NET 项目中实现多语言/全球化的最佳方式

> ID：373388
> 
> 赞同：90
> 
> 时间：2008-12-17T01:23:56.023
> 
> 标签：c#, .net, localization, multilingual

我很快将从事一个大型 c# 项目，并希望从一开始就构建多语言支持。我玩过，可以使用每种语言的单独资源文件使其工作，然后使用资源管理器加载字符串。

还有其他我可以研究的好方法吗？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2016-03-05T11:47:16.440

# 使用带有资源的单独项目

我可以从经验中看出这一点，目前的解决方案包含~~12~~ **24**个项目，其中包括 API、MVC、项目库（核心功能）、WPF、UWP 和 Xamarin。这篇长篇文章值得一读，因为我认为这是最好的方法。借助 VS 工具可轻松导出和导入，以发送给翻译机构或由其他人审阅。

**编辑 02/2018：**仍然很强大，将其转换为 .NET Standard 库甚至可以跨 .NET Framework 和 NET Core 使用它。我添加了一个额外的部分来将其转换为 JSON，例如 angular 可以使用它。

**编辑 2019：**与 Xamarin 一起前进，这仍然适用于所有平台。例如，Xamarin.Forms 也建议使用 resx 文件。（我还没有在 Xamarin.Forms 中开发应用程序，但是文档，这是刚刚开始的详细说明，涵盖了它：[Xamarin.Forms 文档](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/app-fundamentals/localization/text?tabs=windows)）。就像将其转换为 JSON 一样，我们也可以将其转换为 Xamarin.Android 的 .xml 文件。

**编辑 2019 (2)：**从 WPF 升级到 UWP 时，我遇到在 UWP 中他们更喜欢使用另一种文件类型`.resw`，即内容相同但用法不同。我发现了一种不同的方法，在我看来，它比[默认解决方案](https://docs.microsoft.com/en-us/windows/uwp/app-resources/localize-strings-ui-manifest)效果更好。

**编辑 2020：**更新了一些可能需要多语言项目的大型（模块化）项目的建议。

所以，让我们开始吧。

**专业人士**

*   几乎到处都是强类型。
*   在 WPF 中，您不必处理`ResourceDirectories`.
*   据我测试，支持 ASP.NET、类库、WPF、Xamarin、.NET Core、.NET Standard。
*   不需要额外的第三方库。
*   支持文化回退：en-US -> en。
*   不仅后端，还适用于 WPF 的 XAML 和 Xamarin.Forms，适用于 MVC 的 .cshtml。
*   通过更改`Thread.CurrentThread.CurrentCulture`
*   搜索引擎可以抓取不同的语言，用户可以发送或保存特定语言的网址。

**骗局**

*   WPF XAML 有时有问题，新添加的字符串不会直接显示。重建是临时修复（vs2015）。
*   UWP XAML 不显示智能感知建议，并且在设计时不显示文本。
*   告诉我。

**设置**

在您的解决方案中创建语言项目，将其命名为*MyProject.Language*。向其中添加一个名为 Resources 的文件夹，并在该文件夹中创建两个资源文件 (.resx)。一个称为**Resources.resx**，另一个称为**Resources.en.resx**（或特定的 .en-GB.resx）。在我的实现中，我将 NL（荷兰语）语言作为默认语言，所以它在我的第一个文件中，而英语在我的第二个文件中。

设置应如下所示：

[![语言设置项目](https://i.stack.imgur.com/jqeVN.png)](https://i.stack.imgur.com/jqeVN.png)

Resources.resx 的属性必须是： [![特性](https://i.stack.imgur.com/Gl4IL.png)](https://i.stack.imgur.com/Gl4IL.png)

确保将自定义工具命名空间设置为您的项目命名空间。原因是在 WPF 中，您不能`Resources`在 XAML 中引用。

在资源文件中，将访问修饰符设置为 Public：

[![访问修饰符](https://i.stack.imgur.com/uGOMH.png)](https://i.stack.imgur.com/uGOMH.png)

如果你有这么大的应用程序（比如说不同的模块），你可以考虑创建多个像上面这样的项目。在这种情况下，您可以为您的键和资源类添加特定模块的前缀。使用Visual Studio[最好的语言编辑器](https://marketplace.visualstudio.com/items?itemName=TomEnglert.ResXManager)将所有文件合并到一个概览中。

**在另一个项目中使用**

对您的项目的引用：右键单击 References -> Add Reference -> Prjects\Solutions。

在文件中使用命名空间：`using MyProject.Language;`

在后端像这样使用它： `string someText = Resources.orderGeneralError;` 如果还有其他东西称为资源，那么只需放入整个命名空间。

### 在 MVC 中使用

在 MVC 中，您可以随意设置语言，但我使用了参数化 url，可以像这样设置：

**RouteConfig.cs** 下面的其他映射

```
routes.MapRoute(
    name: "Locolized",
    url: "{lang}/{controller}/{action}/{id}",
    constraints: new { lang = @"(\w{2})|(\w{2}-\w{2})" },   // en or en-US
    defaults: new { controller = "shop", action = "index", id = UrlParameter.Optional }
); 
```

**FilterConfig.cs**（可能需要添加，如果需要，添加`FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);`到`Application_start()`方法中`Global.asax`

```
public class FilterConfig
{
    public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
        filters.Add(new ErrorHandler.AiHandleErrorAttribute());
        //filters.Add(new HandleErrorAttribute());
        filters.Add(new LocalizationAttribute("nl-NL"), 0);
    }
} 
```

**本地化属性**

```
public class LocalizationAttribute : ActionFilterAttribute
{
    private string _DefaultLanguage = "nl-NL";
    private string[] allowedLanguages = { "nl", "en" };

    public LocalizationAttribute(string defaultLanguage)
    {
        _DefaultLanguage = defaultLanguage;
    }

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        string lang = (string) filterContext.RouteData.Values["lang"] ?? _DefaultLanguage;
        LanguageHelper.SetLanguage(lang);
    }
} 
```

**LanguageHelper**只是设置文化信息。

```
//fixed number and date format for now, this can be improved.
public static void SetLanguage(LanguageEnum language)
{
    string lang = "";
    switch (language)
    {
        case LanguageEnum.NL:
            lang = "nl-NL";
            break;
        case LanguageEnum.EN:
            lang = "en-GB";
            break;
        case LanguageEnum.DE:
            lang = "de-DE";
            break;
    }
    try
    {
        NumberFormatInfo numberInfo = CultureInfo.CreateSpecificCulture("nl-NL").NumberFormat;
        CultureInfo info = new CultureInfo(lang);
        info.NumberFormat = numberInfo;
        //later, we will if-else the language here
        info.DateTimeFormat.DateSeparator = "/";
        info.DateTimeFormat.ShortDatePattern = "dd/MM/yyyy";
        Thread.CurrentThread.CurrentUICulture = info;
        Thread.CurrentThread.CurrentCulture = info;
    }
    catch (Exception)
    {

    }
} 
```

**.cshtml 中的用法**

```
@using MyProject.Language;
<h3>@Resources.w_home_header</h3> 
```

或者，如果您不想定义 usings，则只需填写整个命名空间，或者您可以在 /Views/web.config 下定义命名空间：

```
<system.web.webPages.razor>
<host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
<pages pageBaseType="System.Web.Mvc.WebViewPage">
  <namespaces>
    ...
    <add namespace="MyProject.Language" />
  </namespaces>
</pages>
</system.web.webPages.razor> 
```

这个mvc实现源码教程：[Awesome tutorial blog](http://www.ryadel.com/en/setup-a-multi-language-website-using-asp-net-mvc/)

**在类库中使用模型**

后端使用也是一样的，只是在属性中使用的一个例子

```
using MyProject.Language;
namespace MyProject.Core.Models
{
    public class RegisterViewModel
    {
        [Required(ErrorMessageResourceName = "accountEmailRequired", ErrorMessageResourceType = typeof(Resources))]
        [EmailAddress]
        [Display(Name = "Email")]
        public string Email { get; set; }
    }
} 
```

如果您有 reshaper，它将自动检查给定的资源名称是否存在。如果您更喜欢类型安全，您可以使用[T4 模板生成枚举](https://stackoverflow.com/a/20419904/2901207)

### 在 WPF 中使用。

当然，添加对您的*MyProject.Language*命名空间的引用，我们知道如何在后端使用它。

在 XAML 中，在 Window 或 UserControl 的标头内，添加一个命名空间引用，`lang`如下所示：

```
<UserControl x:Class="Babywatcher.App.Windows.Views.LoginView"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MyProject.App.Windows.Views"
              xmlns:lang="clr-namespace:MyProject.Language;assembly=MyProject.Language" <!--this one-->
             mc:Ignorable="d" 
            d:DesignHeight="210" d:DesignWidth="300"> 
```

然后，在标签内：

```
 <Label x:Name="lblHeader" Content="{x:Static lang:Resources.w_home_header}" TextBlock.FontSize="20" HorizontalAlignment="Center"/> 
```

由于它是强类型的，因此您确定资源字符串存在。您有时可能需要在安装过程中重新编译项目，WPF 有时会出现新命名空间的错误。

WPF 的另一件事，将语言设置在`App.xaml.cs`. 您可以自己实现（在安装期间选择）或让系统决定。

```
public partial class App : Application
{
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);
        SetLanguageDictionary();
    }

    private void SetLanguageDictionary()
    {
        switch (Thread.CurrentThread.CurrentCulture.ToString())
        {
            case "nl-NL":
                MyProject.Language.Resources.Culture = new System.Globalization.CultureInfo("nl-NL");
                break;
            case "en-GB":
                MyProject.Language.Resources.Culture = new System.Globalization.CultureInfo("en-GB");
                break;
            default://default english because there can be so many different system language, we rather fallback on english in this case.
                MyProject.Language.Resources.Culture = new System.Globalization.CultureInfo("en-GB");
                break;
        }

    }
} 
```

### 在 UWP 中使用

在 UWP 中，Microsoft 使用[此解决方案](https://docs.microsoft.com/en-us/windows/uwp/app-resources/localize-strings-ui-manifest)，这意味着您将需要创建新的资源文件。另外，您也不能重复使用文本，因为他们希望您将`x:Uid`XAML 中的控件设置为资源中的键。在您的资源中，您必须`Example.Text`填写 a`TextBlock`的文本。我根本不喜欢那个解决方案，因为我想重用我的资源文件。最终我想出了以下解决方案。我今天（2019 年 9 月 26 日）才发现这一点，所以如果事实证明这不能按预期工作，我可能会带着其他东西回来。

将此添加到您的项目中：

```
using Windows.UI.Xaml.Resources;

public class MyXamlResourceLoader : CustomXamlResourceLoader
{
    protected override object GetResource(string resourceId, string objectType, string propertyName, string propertyType)
    {
        return MyProject.Language.Resources.ResourceManager.GetString(resourceId);
    }
} 
```

将此添加到`App.xaml.cs`构造函数中：

```
CustomXamlResourceLoader.Current = new MyXamlResourceLoader(); 
```

无论您想在应用程序中的哪个位置，使用它来更改语言：

```
ApplicationLanguages.PrimaryLanguageOverride = "nl";
Frame.Navigate(this.GetType()); 
```

最后一行需要刷新 UI。当我还在做这个项目时，我注意到我需要做 2 次。我可能会在用户第一次启动时选择语言。但由于这将通过 Windows Store 分发，因此语言通常等于系统语言。

然后在 XAML 中使用：

```
<TextBlock Text="{CustomResource ExampleResourceKey}"></TextBlock> 
```

### 在 Angular 中使用它（转换为 JSON）

现在更常见的是像 Angular 这样的框架结合组件，所以没有 cshtml。翻译存储在 json 文件中，我不打算介绍它是如何工作的，我只是强烈推荐[ngx-translate](https://github.com/ngx-translate/core)而不是角度多翻译。因此，如果您想将翻译转换为 JSON 文件，这很容易，我使用 T4 模板脚本将资源文件转换为 json 文件。我建议安装[T4 编辑器](http://t4-editor.tangible-engineering.com/T4-Editor-Visual-T4-Editing.html)以阅读语法并正确使用它，因为您需要进行一些修改。

只有一件事需要注意：不可能生成数据、复制数据、清理数据并为另一种语言生成数据。因此，您必须复制以下代码的次数与您拥有的语言一样多，并更改“//在此处选择语言”之前的条目。目前没有时间解决这个问题，但可能会稍后更新（如果有兴趣）。

*路径：MyProject.Language/T4/CreateLocalizationEN.tt*

```
<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="System.Core" #>
<#@ assembly name="System.Windows.Forms" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System.Resources" #>
<#@ import namespace="System.Collections" #>
<#@ import namespace="System.IO" #>
<#@ import namespace="System.ComponentModel.Design" #>
<#@ output extension=".json" #>
<#

var fileNameNl = "../Resources/Resources.resx";
var fileNameEn = "../Resources/Resources.en.resx";
var fileNameDe = "../Resources/Resources.de.resx";
var fileNameTr = "../Resources/Resources.tr.resx";

var fileResultName = "../T4/CreateLocalizationEN.json";//choose language here
var fileResultPath = Path.Combine(Path.GetDirectoryName(this.Host.ResolvePath("")), "MyProject.Language", fileResultName);
//var fileDestinationPath = "../../MyProject.Web/ClientApp/app/i18n/";

var fileNameDestNl = "nl.json";
var fileNameDestEn = "en.json";
var fileNameDestDe = "de.json";
var fileNameDestTr = "tr.json";

var pathBaseDestination = Directory.GetParent(Directory.GetParent(this.Host.ResolvePath("")).ToString()).ToString();

string[] fileNamesResx = new string[] {fileNameEn }; //choose language here
string[] fileNamesDest = new string[] {fileNameDestEn }; //choose language here

for(int x = 0; x < fileNamesResx.Length; x++)
{
    var currentFileNameResx = fileNamesResx[x];
    var currentFileNameDest = fileNamesDest[x];
    var currentPathResx = Path.Combine(Path.GetDirectoryName(this.Host.ResolvePath("")), "MyProject.Language", currentFileNameResx);
    var currentPathDest =pathBaseDestination + "/MyProject.Web/ClientApp/app/i18n/" + currentFileNameDest;
    using(var reader = new ResXResourceReader(currentPathResx))
    {
        reader.UseResXDataNodes = true;
#>
        {
<#
            foreach(DictionaryEntry entry in reader)
            {
                var name = entry.Key;
                var node = (ResXDataNode)entry.Value;
                var value = node.GetValue((ITypeResolutionService) null); 
                 if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("\n", "");
                 if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("\r", "");
#>
            "<#=name#>": "<#=value#>",
<#

            }
#>
        "WEBSHOP_LASTELEMENT": "just ignore this, for testing purpose"
        }
<#
    }
    File.Copy(fileResultPath, currentPathDest, true);
}

#> 
```

如果您有一个模块化应用程序并且您按照我的建议创建多个语言项目，那么您将必须为每个项目创建一个 T4 文件。确保 json 文件在逻辑上定义，它不必是`en.json`，也可以是`example-en.json`. 要将多个 json 文件与[ngx-translate结合使用，请按照](https://github.com/ngx-translate/core)[此处](https://github.com/ngx-translate/core/issues/199#issuecomment-339084987)的说明进行操作

### 在 Xamarin.Android 中使用

正如上面更新中所解释的，我使用与 Angular/JSON 相同的方法。但是Android使用XML文件，所以我写了一个T4文件来生成那些XML文件。

*路径：MyProject.Language/T4/CreateAppLocalizationEN.tt*

```
#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="System.Core" #>
<#@ assembly name="System.Windows.Forms" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System.Resources" #>
<#@ import namespace="System.Collections" #>
<#@ import namespace="System.IO" #>
<#@ import namespace="System.ComponentModel.Design" #>
<#@ output extension=".xml" #>
<#
var fileName = "../Resources/Resources.en.resx";
var fileResultName = "../T4/CreateAppLocalizationEN.xml";
var fileResultRexPath = Path.Combine(Path.GetDirectoryName(this.Host.ResolvePath("")), "MyProject.Language", fileName);
var fileResultPath = Path.Combine(Path.GetDirectoryName(this.Host.ResolvePath("")), "MyProject.Language", fileResultName);

    var fileNameDest = "strings.xml";

    var pathBaseDestination = Directory.GetParent(Directory.GetParent(this.Host.ResolvePath("")).ToString()).ToString();

    var currentPathDest =pathBaseDestination + "/MyProject.App.AndroidApp/Resources/values-en/" + fileNameDest;

    using(var reader = new ResXResourceReader(fileResultRexPath))
    {
        reader.UseResXDataNodes = true;
        #>
        <resources>
        <#

                foreach(DictionaryEntry entry in reader)
                {
                    var name = entry.Key;
                    //if(!name.ToString().Contains("WEBSHOP_") && !name.ToString().Contains("DASHBOARD_"))//only include keys with these prefixes, or the country ones.
                    //{
                    //  if(name.ToString().Length != 2)
                    //  {
                    //      continue;
                    //  }
                    //}
                    var node = (ResXDataNode)entry.Value;
                    var value = node.GetValue((ITypeResolutionService) null); 
                     if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("\n", "");
                     if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("\r", "");
                     if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("&", "&amp;");
                     if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("<<", "");
                     //if (!String.IsNullOrEmpty(value.ToString())) value = value.ToString().Replace("'", "\'");
#>
              <string name="<#=name#>">"<#=value#>"</string>
<#      
                }
#>
            <string name="WEBSHOP_LASTELEMENT">just ignore this</string>
<#
        #>
        </resources>
        <#
        File.Copy(fileResultPath, currentPathDest, true);
    }

#> 
```

Android 使用`values-xx`文件夹，所以上面是文件夹中的英文`values-en`。但是您还必须生成一个进入`values`文件夹的默认值。只需复制上面的 T4 模板并更改上面代码中的文件夹即可。

好了，您现在可以为所有项目使用一个资源文件。这使得将所有内容导出到排除文档并让某人翻译并再次导入变得非常容易。

特别感谢[这个惊人的 VS 扩展](https://github.com/tom-englert/ResXResourceManager)，它对`resx`文件非常有用。考虑为他的出色工作向他[捐款](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=TQQR8AKGNHELQ)（我与此无关，我只是喜欢扩展）。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-17T01:45:59.363

我见过使用许多不同方法实施的项目，每种方法都有其优点和缺点。

*   一个是在配置文件中完成的（不是我最喜欢的）
*   一个是使用数据库来做的——这工作得很好，但是你知道要维护什么是一件痛苦的事。
*   一个按照您建议的方式使用资源文件，我不得不说这是我最喜欢的方法。
*   最基本的方法是使用一个包含字符串的包含文件 - 丑陋。

我想说您选择的资源方法很有意义。看到其他人的答案也会很有趣，因为我经常想知道是否有更好的方法来做这样的事情。我已经看到很多资源都指向 using resources 方法，包括[在 SO 上的一个](https://stackoverflow.com/questions/119568/best-practice-to-make-a-multi-language-application-in-c-winforms)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-17T04:07:34.727

我认为没有“最好的方法”。这实际上取决于您正在构建的应用程序的技术和类型。

正如其他发帖者所建议的那样，Webapps 可以将信息存储在数据库中，但我建议使用单独的资源文件。那是**与您的源分开的资源文件**。单独的资源文件减少了对相同文件的争用，随着项目的增长，您可能会发现本地化将与业务逻辑分开完成。（程序员和翻译）。

Microsoft WinForm 和 WPF 专家建议使用针对每个区域设置定制的单独资源程序集。

WPF 根据内容调整 UI 元素大小的能力降低了所需的布局工作，例如：（日语单词比英语短得多）。

如果您正在考虑 WPF：[我建议阅读这篇 msdn 文章](http://msdn.microsoft.com/en-us/library/ms788718.aspx) 说实话，我发现 WPF 本地化工具：msbuild、locbaml（可能还有一个 excel 电子表格）使用起来很乏味，但它确实有效。

只是稍微相关的事情：我面临的一个常见问题是集成发送错误消息（通常是英文）而不是错误代码的遗留系统。这会强制对遗留系统进行更改，或者将后端字符串映射到我自己的错误代码，然后再映射到本地化字符串……是的。 **错误代码是本地化的朋友**

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-17T02:47:27.807

+1 数据库

如果对数据库进行更正，您应用程序中的表单甚至可以即时重新翻译。

我们使用了一个系统，其中所有控件都在 XML 文件（每个表单一个）中映射到语言资源 ID，但所有 ID 都在数据库中。

基本上，我们不是让每个控件都保存 ID（实现接口，或使用 VB6 中的 tag 属性），而是使用在 .NET 中通过反射很容易发现控件树的事实。如果 XML 文件丢失，则加载表单时的过程将构建 XML 文件。XML 文件会将控件映射到它们的资源 ID，因此只需填写并映射到数据库即可。这意味着如果某些内容没有被标记，或者如果需要将其拆分为另一个 ID，则无需更改编译后的二进制文件（一些可能用作名词和动词的英语单词可能需要翻译成两个不同的单词在字典中并且不会被重复使用，但在初始分配 ID 时您可能不会发现这一点）。

应用程序更多涉及的唯一情况是使用带有插入点的阶段。

数据库翻译软件是您的基本 CRUD 维护屏幕，具有各种工作流程选项，以方便检查丢失的翻译等。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-12-02T08:51:41.360

我一直在寻找，我发现了这个：

如果您使用 WPF 或 Silverlight，您的方法可能出于多种原因使用[WPF LocalizationExtension 。](http://wpflocalizeextension.codeplex.com/)

它的开源它是免费的（并将保持免费）处于真正稳定的状态

在 Windows 应用程序中，您可以执行以下操作：

```
public partial class App : Application  
{  
     public App()  
     {             
     }  

     protected override void OnStartup(StartupEventArgs e)  
     {  
         Thread.CurrentThread.CurrentCulture = new System.Globalization.CultureInfo("de-DE"); ;  
         Thread.CurrentThread.CurrentUICulture = new System.Globalization.CultureInfo("de-DE"); ;  

          FrameworkElement.LanguageProperty.OverrideMetadata(  
              typeof(FrameworkElement),  
              new FrameworkPropertyMetadata(  
                  XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag)));  
          base.OnStartup(e);  
    }  
} 
```

我认为在 Wep Page 上的方法可能是相同的。

祝你好运！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T08:59:01.067

您可以使用[Sisulizer](http://www.sisulizer.com/)等商业工具。它将为每种语言创建附属程序集。您唯一应该注意的是不要混淆表单类名（如果您使用混淆器）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-17T02:21:47.983

我会使用多个资源文件。配置应该不难。事实上，我最近回答了一个关于设置基于全局语言的资源文件和表单语言资源文件的类似问题。

[Visual Studio 2008 中的本地化](https://stackoverflow.com/questions/355685/localization-in-visual-studio-2008#358402)

我认为至少对于 WinForm 开发来说这是最好的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T03:13:16.147

大多数开源项目为此目的使用[GetText 。](http://gnuwin32.sourceforge.net/packages/gettext.htm)我不知道它是如何以及是否曾经在.Net 项目中使用过。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T08:53:39.767

我们使用自定义提供程序来提供多语言支持，并将所有文本放入数据库表中。它运行良好，只是我们有时在更新数据库中的文本而不更新 Web 应用程序时会遇到缓存问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-17T05:57:55.643

标准资源文件更容易。但是，如果您有任何与语言相关的数据，例如查找表，那么您将不得不管理两个资源集。

我还没有这样做，但在我的下一个项目中，我将实现一个数据库资源提供程序。我在 MSDN 上找到了如何做到这一点：

[http://msdn.microsoft.com/en-us/library/aa905797.aspx](http://msdn.microsoft.com/en-us/library/aa905797.aspx)

我还发现了这个实现：

[DBResource 提供者](http://www.west-wind.com/presentations/wwDbResourceProvider/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-08-27T10:42:55.933

我强烈推荐使用 ResourceDirectories (resx) 和 {x:static} 标记的[ResXManager工具。](https://marketplace.visualstudio.com/items?itemName=TomEnglert.ResXManager)

ResXManager 用作 Visual Studio 或独立应用程序的插件。

# apache-flex - 这个 ActionScript 语法是什么意思？（返回内联对象的语法）

> ID：373395
> 
> 赞同：4
> 
> 时间：2008-12-17T01:26:31.137
> 
> 标签：apache-flex, actionscript-3

我是一名 Java 程序员，现在需要处理 Flex/ActionScript 项目。我从 Flex 3 Cookbook 中获得了一个使用 ITreeDataDesriptor 的示例，但是有一行 actionscript 代码我很难理解。如果有人可以进一步解释这一点，我将不胜感激。

```
public function getData(node:Object, model:Object=null):Object
    {
        if (node is Office) {
            return {children:{label:node.name, label:node.address}};
        }
    } 
```

我不明白的部分是“{children:{label:node.name, label:node.address}}”。Office 只是一个包含两个字符串属性的值对象：名称和地址。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T03:53:26.783

以下返回表达式（根据问题修改）...

```
return {children:{label:node.name, body:node.address}} 
```

...在功能上等同于此代码...

```
var obj:Object = new Object();
obj.children = new Object();
obj.children.label = node.name;
obj.children.body = node.address;
return obj; 
```

问题代码中返回的匿名对象使事情变得复杂，因为它定义了一个属性两次。在这种情况下，使用第一个声明，并忽略后续声明。不会引发编译时或运行时错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T01:50:45.737

我认为在 Java 中你会称之为映射或关联数组。在 Javascript 和 Actionscript 中，您可以这样说来创建具有某些属性的对象：

```
var myobject = {
   'prop1': 100,
   'prop2': {
      'a': 1
   }
}

trace( myobject.prop1 );   // 100
trace( myobject.prop2.a );   // 1 
```

在您的示例中，它只是作为无名对象返回。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T01:51:42.520

```
return {children:{label:node.name, label:node.address}}; 
```

意味着您正在返回一个新对象。{} 是 Object 的构造函数，在这种情况下它是一个 Anonymous 对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T02:00:38.680

谢谢你们俩的快速回复。因此，如果我正确理解您的解释，return 语句将返回一个匿名对象，并且该对象只有一个名为“children”的属性，它又是一个关联数组 - 好的，这是我还不太明白的部分，似乎这个数组中的两个属性都被命名为“标签”，这是允许的吗？

# java - 拍摄优化的 JVM 运行时的快照

> ID：373397
> 
> 赞同：9
> 
> 时间：2008-12-17T01:27:54.987
> 
> 标签：java, optimization, jvm

我知道 JVM 可以在运行时进行一些非常重要的优化，尤其是在 -server 模式下。当然，JVM 需要一段时间才能稳定下来并达到最佳性能。有什么方法可以对这些优化进行快照，以便在您下次运行应用程序时立即应用它们？

“嘿 JVM！优化我的代码做得很好。你能把它写下来给我吗？”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T10:46:21.083

Basically not yet with Sun's VM, but they have it in mind.

See various postings/comments under here:

[http://blogs.oracle.com/fatcatair/category/Java](http://blogs.oracle.com/fatcatair/category/Java)

(Sorry: I can't find quite the right one about retaining stats over restart for immediate C1 compilation of known-hot-at-startup methods.)

But I don't know where all this stuff is right now.

Note that optimisations appropriate in steady-state may well not be appropriate at start-up and might indeed reduce start-up performance, and indeed two runs may not have the same hotspots...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T20:31:45.630

也许这可能会有所帮助：[http://wikis.sun.com/display/HotSpotInternals/PrintAssembly](http://wikis.sun.com/display/HotSpotInternals/PrintAssembly)。

# javascript - 安全、可沙盒化的用户公开编程语言/环境？

> ID：373406
> 
> 赞同：7
> 
> 时间：2008-12-17T01:38:54.417
> 
> 标签：javascript, python, sandbox

除了为我的网站提供 API 之外，我还想为用户提供编写可以在我的服务器上运行的简单脚本的能力。脚本将有权访问用户拥有的对象，并能够操纵、修改和以其他方式处理其数据。

我希望能够在精细级别限制这些脚本占用的资源（例如，最大执行时间应该是 100 毫秒）。我还想确保一个安全的沙箱，这样每个用户只能访问一组有限的数据和资源，并且不能访问磁盘、其他人的数据等。

通常，脚本会非常简单（例如，创建符合特定条件的值的总和或平均值），并且它们通常会在模板中使用（例如，用平均值填充此单元格或 html 元素的值或和）。

理想情况下，我想使用一种众所周知的常用编程语言的沙盒子集，以便用户轻松上手。后端是用 Python 编写的，因此基于 Python 的语言可能会有好处，但我对其他语言和技术持开放态度。由于其简单的性质和常见的可用性，Javascript 也很有吸引力。

这些语言应该支持创建 DSL 和库。

目标受众是基于 Web 的应用程序的一般用户群，不一定是非常技术性的。换句话说，它不是针对具有任何特定编程语言的特定知识的基础。我的期望是一部分用户将创建将被大多数人使用的脚本。

对于语言和技术有什么想法或建议吗？其他人尝试这个的任何例子以及他们遇到的成功和失败？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T01:48:12.713

我为此使用 Lua，但它是针对支持 Lua 的社区。所以我的答案是你的用户是谁？

如果您的用户是内部用户，例如我的情况，并且精通 Python，请使用 Python。但是，如果这是针对万维网的东西，我可能会选择 javascript，因为它是通用语（每个开发人员都知道它，而且很容易上手）。至于引擎……好吧，V8 会很好，但它不是 100% 线程安全的，因为您不能像 SpiderMonkey 那样以无锁方式在同一进程中运行多个引擎。所以你可能想要使用它。此外，由于默认情况下 javascript 是沙盒化的，因此您不必担心在您这边实现太多。

# language-agnostic - 按引用传递与按值传递有什么区别？

> ID：373419
> 
> 赞同：642
> 
> 时间：2008-12-17T01:49:28.563
> 
> 标签：language-agnostic, pass-by-reference, pass-by-value

和有什么区别

1.  通过引用传递的参数
2.  按值传递的参数？

请给我一些例子好吗？

* * *

## 回答 #1

> 赞同：1168
> 
> 时间：2009-01-10T13:28:16.960

首先，**CS 理论中定义的“按值传递与按引用传递”的区别现在已经过时**，因为**最初定义为“按引用传递”的技术已经失宠**并且现在很少使用。¹

**较新的语言²倾向于使用不同（但相似）的一对技术来实现相同的效果**（见下文），这是造成混淆的主要原因。

混淆的第二个来源是，**在“通过引用”中，“引用”的含义比一般术语“引用”更窄**（因为该短语早于它）。

* * *

现在，真实的定义是：

*   当**通过引用传递**参数时，调用者和被调用者**使用相同的变量**作为参数。如果被调用者修改了参数变量，效果对调用者的变量是可见的。

*   当一个参数**通过值传递时**，调用者和被调用者有两个具有相同值的**自变量。**如果被调用者修改了参数变量，则调用者看不到效果。

在这个定义中需要注意的是：

*   **这里的“变量”是指调用者的（局部或全局）变量本身**——即，如果我通过引用传递一个局部变量并分配给它，我将更改调用者的变量本身，而不是它所指向的任何东西，如果它是一个指针.

    *   这现在被认为是不好的做法（作为隐式依赖）。因此，**几乎所有较新的语言都完全或几乎完全是按值传递的。**引用传递现在主要以“输出/输入参数”的形式用于函数不能返回多个值的语言中。
*   **“引用传递”中“引用”的含义**。与一般的“参考”术语不同的是，**这个“参考”是暂时的和隐含的。**被调用者基本上得到的是**一个“变量”，它在某种程度上与原始变量“相同”。**实现这种效果的具体方式是无关紧要的（例如，语言还可能公开一些实现细节——地址、指针、取消引用——这都是无关紧要的；如果最终效果是这样，它就是通过引用传递）。

* * *

**现在，在现代语言中，变量往往是“引用类型”**（另一个概念是在“通过引用”之后发明并受到它的启发），即实际的对象数据单独存储在某个地方（通常在堆上），并且只有对它的“引用”才会保存在变量中并作为参数传递。³

**传递这样的引用属于按值传递，**因为变量的值在技术上是引用本身，而不是被引用的对象。但是，**对程序的净影响可能与按值传递或按引用传递相同：**

*   如果引用只是从调用者的变量中获取并作为参数传递，这与传递引用具有相同的效果：如果被引用的对象在被调用者中发生了*变异*，调用者将看到更改。
    *   然而，如果一个持有这个引用的变量被*重新分配，*它将停止指向那个对象，所以对这个变量的任何进一步的操作都会影响它现在指向的任何东西。
*   为了具有与按值传递相同的效果，在某个时间点制作对象的副本。选项包括：
    *   调用者可以在调用之前制作一个私人副本，然后给被调用者一个参考。
    *   在某些语言中，某些对象类型是“不可变的”：对它们的任何似乎改变值的操作实际上都会创建一个全新的对象，而不会影响原始对象。因此，将这种类型的对象作为参数传递总是具有按值传递的效果：如果需要更改，将自动为被调用者制作副本，并且调用者的对象永远不会受到影响。
        *   在函数式语言中，*所有*对象都是不可变的。

如您所见，**这对技术与定义中的技术几乎相同，只是有一定程度的间接性：只需将“变量”替换为“引用对象”即可。**

它们没有商定的名称，这导致了扭曲的解释，例如“在值是引用的情况下按值调用”。1975 年，Barbara Liskov 提出了“ [call-by-object-sharing](https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_sharing) ”（或有时只是“call-by-sharing”）这一术语，尽管它从未完全流行起来。此外，这些短语都没有与原始对平行。难怪旧术语最终在没有更好的东西的情况下被重用，导致混乱。⁴

* * *

**注意**：很长一段时间，这个答案曾经说：

> 假设我想与你分享一个网页。如果我告诉你 URL，我是通过引用传递的。您可以使用该 URL 来查看我可以看到的同一网页。如果该页面发生更改，我们都会看到更改。如果您删除 URL，您所做的只是破坏您对该页面的引用 - 您并没有删除实际页面本身。
> 
> 如果我打印出页面并给您打印输出，我就是按价值传递。您的页面是原始的断开连接的副本。您不会看到任何后续更改，并且您所做的任何更改（例如在打印输出上涂鸦）都不会显示在原始页面上。如果您销毁打印输出，您实际上已经销毁了您的对象副本 - 但原始网页保持不变。

这*几乎是*正确的，*除了*“引用”的更狭义的含义——它既是临时的又是隐含的（它不是必须的，但是显式和/或持久是附加功能，而不是传递引用语义的一部分，如上所述）。一个更接近的类比是给你一份文件的副本，而不是邀请你处理原件。

* * *

¹[除非您使用 Fortran 或 Visual Basic 进行编程，否则这不是默认行为，而且在现代使用的大多数语言中，甚至不可能实现真正的按引用调用。]

²[相当多的老年人也支持它]

³[在几种现代语言中，所有类型都是引用类型。这种方法是由语言 CLU 在 1975 年开创的，此后被许多其他语言采用，包括 Python 和 Ruby。还有更多的语言使用混合方法，其中一些类型是“值类型”，而另一些是“引用类型”——其中包括 C#、Java 和 JavaScript。]

^(4重复使用一个合适的旧术语)[*本身*][并没有什么不好，但必须以某种方式明确每次使用的含义。不这样做正是导致混乱的原因。]

 ** * *

## 回答 #2

> 赞同：173
> 
> 时间：2008-12-17T01:52:47.993

这是一种如何将参数传递给函数的方法。通过引用传递意味着被调用函数的参数将与调用者传递的参数相同（不是值，而是标识 - 变量本身）。按值传递意味着被调用函数的参数将是调用者传递参数的副本。该值将是相同的，但身份 - 变量 - 是不同的。因此，在一种情况下，被调用函数对参数所做的更改会更改传递的参数，而在另一种情况下，只会更改被调用函数中参数的值（这只是一个副本）。匆匆忙忙：

*   Java 仅支持按值传递。始终复制参数，即使在复制对对象的引用时，被调用函数中的参数将指向同一个对象，并且对该对象的更改将在调用者中看到。由于这可能会令人困惑，[因此](https://jonskeet.uk/java/passing.html)Jon Skeet 对此有什么看法。
*   C# 支持按值传递和按引用传递（`ref`在调用者和被调用函数处使用的关键字）。[Jon Skeet在这里](https://jonskeet.uk/csharp/parameters.html)也有一个很好的解释。
*   C++ 支持按值传递和按引用传递（在被调用函数中使用的引用参数类型）。您将在下面找到对此的解释。

代码

由于我的语言是 C++，我将在这里使用它

```
// passes a pointer (called reference in java) to an integer
void call_by_value(int *p) { // :1
    p = NULL;
}

// passes an integer
void call_by_value(int p) { // :2
    p = 42;
}

// passes an integer by reference
void call_by_reference(int & p) { // :3
    p = 42;
}

// this is the java style of passing references. NULL is called "null" there.
void call_by_value_special(int *p) { // :4
    *p = 10; // changes what p points to ("what p references" in java)
    // only changes the value of the parameter, but *not* of 
    // the argument passed by the caller. thus it's pass-by-value:
    p = NULL;
}

int main() {
    int value = 10;
    int * pointer = &value;

    call_by_value(pointer); // :1
    assert(pointer == &value); // pointer was copied

    call_by_value(value); // :2
    assert(value == 10); // value was copied

    call_by_reference(value); // :3
    assert(value == 42); // value was passed by reference

    call_by_value_special(pointer); // :4
    // pointer was copied but what pointer references was changed.
    assert(value == 10 && pointer == &value);
} 
```

Java中的一个例子不会有什么坏处：

```
class Example {
    int value = 0;

    // similar to :4 case in the c++ example
    static void accept_reference(Example e) { // :1
        e.value++; // will change the referenced object
        e = null; // will only change the parameter
    }

    // similar to the :2 case in the c++ example
    static void accept_primitive(int v) { // :2
        v++; // will only change the parameter
    }        

    public static void main(String... args) {
        int value = 0;
        Example ref = new Example(); // reference

        // note what we pass is the reference, not the object. we can't 
        // pass objects. The reference is copied (pass-by-value).
        accept_reference(ref); // :1
        assert ref != null && ref.value == 1;

        // the primitive int variable is copied
        accept_primitive(value); // :2
        assert value == 0;
    }
} 
```

维基百科

[`http://en.wikipedia.org/wiki/Pass_by_reference#Call_by_value`](http://en.wikipedia.org/wiki/Pass_by_reference#Call_by_value)

[`http://en.wikipedia.org/wiki/Pass_by_reference#Call_by_reference`](http://en.wikipedia.org/wiki/Pass_by_reference#Call_by_reference)

这家伙几乎钉了它：

[http://javadude.com/articles/passbyvalue.htm](http://javadude.com/articles/passbyvalue.htm)

* * *

## 回答 #3

> 赞同：104
> 
> 时间：2016-01-24T03:38:14.460

这里的许多答案（尤其是最受好评的答案）实际上是不正确的，因为他们误解了“通过​​引用调用”的真正含义。这是我试图解决问题的尝试。

## TL;博士

用最简单的话来说：

*   *按值调用*意味着您将**值**作为函数参数传递
*   *通过引用调用*意味着您将**变量**作为函数参数传递

用比喻的方式：

*   ***价值调用***是**我在一张纸上写下一些东西然后交给你的地方**。也许它是一个 URL，也许它是战争与和平的完整副本。不管它是什么，它都写在我给你的一张纸上，所以现在它实际上是**你的一张纸**。你现在可以自由地在那张纸上涂鸦，或者用那张纸在其他地方找到一些东西并摆弄它，无论如何。
*   ***参考电话***是当**我给你我的笔记本时，里面写了一些东西**。你可以在我的笔记本上涂鸦（也许我希望你这样做，也许我不想），然后我会保留我的笔记本，无论你在哪里涂鸦。另外，如果你或我写的有关于如何在其他地方找到东西的信息，你或我可以去那里摆弄这些信息。

## “按值调用”和“按引用调用”*不是什么*意思

请注意，这两个概念与***引用类型***的概念（在 Java 中是所有类型的子类型`Object`，在 C# 中是所有`class`类型）或 C 中的***指针类型***的概念（在语义上是等效的）是完全独立和正交的到 Java 的“引用类型”，只是使用不同的语法）。

*引用类型*的概念对应于 URL：它本身既是一条信息，又是对其他信息的*引用*（如果你愿意的话，是一个*指针）。*您可以在不同的地方拥有多个 URL 副本，并且它们不会更改它们都链接到的网站；如果网站更新了，那么每个 URL 副本仍然会导致更新的信息。相反，在任何地方更改 URL 都不会影响该 URL 的任何其他书面副本。

请注意，C++ 有一个“引用”的概念（例如`int&`），它**不像**Java 和 C# 的“引用类型”，而是**像**“引用调用”。Java 和 C# 的“引用类型”以及Python 中的*所有*类型都类似于 C 和 C++ 所称的“指针类型”（例如`int*`）。

* * *

好的，这是更长更正式的解释。

## 术语

首先，我想强调一些重要的术语，以帮助澄清我的答案，并确保我们在使用单词时都指的是相同的想法。（在实践中，我认为对此类主题的绝大多数混淆源于以无法完全传达预期含义的方式使用词语。）

首先，这里有一个使用类似 C 语言的函数声明示例：

```
void foo(int param) {  // line 1
  param += 1;
} 
```

这是调用此函数的示例：

```
void bar() {
  int arg = 1;  // line 2
  foo(arg);     // line 3
} 
```

使用这个例子，我想定义一些重要的术语：

*   `foo`是在第 1 行声明的*函数*（Java 坚持让所有函数都成为方法，但概念是一样的，不失一般性；C 和 C++ 对声明和定义做了区分，这里不再赘述）
*   `param`是 的*形式参数*，`foo`也在第 1 行声明
*   `arg`是一个*变量*，特别是函数的*局部变量*`bar`，在第2行声明和初始化
*   `arg`也是第 3 行特定*调用*的*参数**`foo`*

 *这里有两组非常重要的概念需要区分。第一个是*值*与*变量*：

*   值是对语言中**的表达式求值的结果*****。***例如，在上面的函数中，在 line 之后，表达式具有*value*。**`bar``int arg = 1;``arg` *`1`***
****   ***变量***是值的**容器**。变量可以是可变的（这是大多数类 C 语言的默认设置）、只读的（例如使用 Java`final`或 C# 声明的`readonly`）或深度不可变的（例如使用 C++ 的`const`）。***

 ***要区分的另一对重要概念是*参数*与*参数*：

*   ***参数***（也称为形*参*）是调用者在调用函数时必须提供的变量*。*
*   ***参数***是由函数调用者提供的值*，*以满足该函数的特定形式参数

## 按值调用

在*按值调用中*，函数的形式参数是为函数调用新创建的变量，并使用其参数的*值*进行初始化。

这与使用值初始化任何其他类型的变量的方式完全相同。例如：

```
int arg = 1;
int another_variable = arg; 
```

这里`arg`和`another_variable`是完全独立的变量——它们的值可以相互独立地改变。但是，在`another_variable`声明的那一点，它被初始化为保存与保存相同的值`arg`——即`1`.

由于它们是自变量，因此更改`another_variable`不会影响`arg`：

```
int arg = 1;
int another_variable = arg;
another_variable = 2;

assert arg == 1; // true
assert another_variable == 2; // true 
```

`arg`这与我们上面示例中的和之间的关系完全相同`param`，我将在这里重复对称性：

```
void foo(int param) {
  param += 1;
}

void bar() {
  int arg = 1;
  foo(arg);
} 
```

就像我们这样编写代码一样：

```
// entering function "bar" here
int arg = 1;
// entering function "foo" here
int param = arg;
param += 1;
// exiting function "foo" here
// exiting function "bar" here 
```

也就是说，*按值调用*的定义特征是被调用者（`foo`在这种情况下）接收*值*作为参数，但对于来自调用者的变量（在这种情况下）的这些值有自己的独立*变量。*`bar`

回到我上面的比喻，如果我`bar`和你是`foo`，当我打电话给你时，我会给你一张纸，上面写着一个*值。*你叫那张纸`param`。该值是我在笔记本（我的局部变量）中写入的值的**副本**`arg`，在我调用的变量中。

（顺便说一句：取决于硬件和操作系统，关于如何从另一个函数调用一个函数有各种*调用约定*。调用约定就像我们决定是否将值写在纸上然后交给你，或者如果你有一张我写的纸，或者如果我写在我们俩面前的墙上。这也是一个有趣的主题，但远远超出了这个已经很长的答案的范围。）

## 通过引用调用

在*引用调用中*，函数的形式参数只是调用者作为参数提供的相同变量的*新名称。*

回到我们上面的例子，它相当于：

```
// entering function "bar" here
int arg = 1;
// entering function "foo" here
// aha! I note that "param" is just another name for "arg"
arg /* param */ += 1;
// exiting function "foo" here
// exiting function "bar" here 
```

由于`param`只是另一个名称`arg`- 也就是说，它们是**相同的变量**，因此更改`param`会反映在`arg`. 这是引用调用与值调用不同的根本方式。

很少有语言支持引用调用，但 C++ 可以这样做：

```
void foo(int& param) {
  param += 1;
}

void bar() {
  int arg = 1;
  foo(arg);
} 
```

在这种情况下，`param`它不仅具有与 相同的*值*，`arg`它实际上**是** `arg`（只是名称不同），因此`bar`可以观察到它`arg`已经增加了。

请注意，这**不是**Java、JavaScript、C、Objective-C、Python 或当今几乎任何其他流行语言的工作方式。这意味着这些语言**不是**按引用调用的，而是按值调用的。

## 附录：对象共享调用

如果您所拥有的是*按值调用*，但实际值是*引用类型*或*指针类型*，那么“值”本身并不是很有趣（例如，在 C 中，它只是平台特定大小的整数）——什么是有趣的是该值**指向**什么。

如果该引用类型（即指针）指向的内容是**可变**的，那么可能会产生一个有趣的效果：您可以修改指向的值，并且调用者可以观察到指向的值的变化，即使调用者无法观察到指针本身的变化。

再次借用 URL 的类比，如果我们都关心的是网站而不是 URL，那么我给你一个网站的 URL**副本这一事实并不是特别有趣。**您在 URL 副本上乱涂乱画的事实不会影响我的 URL 副本，这不是我们关心的事情（事实上，在 Java 和 Python 等语言中，“URL”或引用类型值可以'根本不能修改，只有它指向的东西可以）。

Barbara Liskov 在发明 CLU 编程语言（具有这些语义）时，意识到现有术语“按值调用”和“按引用调用”对于描述这种新语言的语义并不是特别有用。于是她发明了一个新名词：[**对象共享调用**](https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_sharing)。

在讨论技术上按值调用的语言时，但使用的常见类型是引用或指针类型（即：几乎所有现代命令式、面向对象或多范式编程语言），我发现它不那么令人困惑简单地避免谈论*按值*调用或*按引用调用*。坚持**通过对象共享调用**（或简单地**通过对象调用**），没有人会感到困惑。:-)

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2016-03-24T19:24:09.067

在理解这两个术语之前，您**必须**了解以下内容。每个对象都有 2 个可以区分它的东西。

*   它的价值。
*   它的地址。

所以如果你说`employee.name = "John"`

知道有两件事`name`。它的值`"John"`也是它在内存中的位置，它是一些十六进制数，可能像这样：`0x7fd5d258dd00`.

根据语言的体系结构或对象的*类型*（类、结构等），您将转移`"John"`或`0x7fd5d258dd00`

传递`"John"`被称为按值传递。传递`0x7fd5d258dd00`被称为通过引用传递。任何指向此内存位置的人都可以访问`"John"`.

有关这方面的更多信息，我建议您阅读有关[取消引用指针](https://stackoverflow.com/a/4955259/5175709)以及[为什么选择结构（值类型）而不是类（引用类型）](https://stackoverflow.com/a/38024319/5175709)

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2008-12-17T02:03:39.750

这是一个例子：

```
#include <iostream>

void by_val(int arg) { arg += 2; }
void by_ref(int&arg) { arg += 2; }

int main()
{
    int x = 0;
    by_val(x); std::cout << x << std::endl;  // prints 0
    by_ref(x); std::cout << x << std::endl;  // prints 2

    int y = 0;
    by_ref(y); std::cout << y << std::endl;  // prints 2
    by_val(y); std::cout << y << std::endl;  // prints 2
} 
```

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2014-11-12T20:07:47.430

最简单的方法是使用 Excel 文件。例如，假设您在单元格 A1 和 B1 中有两个数字 5 和 2，并且您想在第三个单元格中找到它们的总和，例如 A2。您可以通过两种方式做到这一点。

*   通过在此单元格中键入*= 5 + 2***将它们的值传递给单元格 A2**。在这种情况下，如果单元格 A1 或 B1 的值发生变化，则 A2 中的总和保持不变。

**   或者通过键入*= A1 + B1***将单元格 A1 和 B1 的“引用”传递给单元格 A2**。在这种情况下，如果单元格 A1 或 B1 的值发生变化，则 A2 中的总和也会发生变化。* 

 *** * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-12-17T01:53:22.267

通过 ref 传递时，您基本上是在传递一个指向变量的指针。按值传递，您正在传递变量的副本。在基本用法中，这通常意味着通过引用传递对变量的更改将被视为调用方法，而通过值传递它们不会。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-12-17T02:18:41.107

值传递发送存储在您指定的变量中的数据的副本，传递引用发送指向变量本身的直接链接。因此，如果您通过引用传递一个变量，然后在您传递它的块内更改该变量，则原始变量将被更改。如果您只是按值传递，则原始变量将无法被您传递到的块更改，但您将获得调用时它包含的任何内容的副本。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-12-27T22:57:43.387

按值传递 - 函数复制变量并使用副本（因此它不会更改原始变量中的任何内容）

通过引用传递 - 该函数使用原始变量，如果您在另一个函数中更改变量，它也会更改原始变量。

示例（复制并使用/自己尝试并查看）：

```
#include <iostream>

using namespace std;

void funct1(int a){ //pass-by-value
    a = 6; //now "a" is 6 only in funct1, but not in main or anywhere else
}
void funct2(int &a){ //pass-by-reference
    a = 7; //now "a" is 7 both in funct2, main and everywhere else it'll be used
}

int main()
{
    int a = 5;

    funct1(a);
    cout<<endl<<"A is currently "<<a<<endl<<endl; //will output 5
    funct2(a);
    cout<<endl<<"A is currently "<<a<<endl<<endl; //will output 7

    return 0;
} 
```

保持简单，偷看。文字墙可能是一个坏习惯。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-17T03:36:29.673

它们之间的主要区别在于值类型变量存储值，因此在方法调用中指定值类型变量会将该变量值的副本传递给方法。引用类型变量存储对对象的引用，因此将引用类型变量指定为参数会向该方法传递引用该对象的实际引用的副本。即使引用本身是按值传递的，该方法仍然可以使用它接收到的引用来与原始对象进行交互，并可能对其进行修改。类似地，当通过 return 语句从方法返回信息时，该方法返回存储在值类型变量中的值的副本或存储在引用类型变量中的引用的副本。返回引用时，调用方法可以使用该引用与被引用对象进行交互。所以，

在 C# 中，要通过引用传递变量以便被调用的方法可以修改变量的，C# 提供了关键字 ref 和 out。将 ref 关键字应用于参数声明允许您通过引用将变量传递给方法——被调用的方法将能够修改调用者中的原始变量。ref 关键字用于已经在调用方法中初始化的变量。通常，当方法调用包含未初始化的变量作为参数时，编译器会生成错误。在参数前面加上关键字 out 会创建一个输出参数。这向编译器表明参数将通过引用传递给被调用的方法，并且被调用的方法将为调用者中的原始变量分配一个值。如果该方法没有为每个可能的执行路径中的输出参数分配值，则编译器会生成错误。这还可以防止编译器为作为参数传递给方法的未初始化变量生成错误消息。一个方法只能通过 return 语句向其调用者返回一个值，但可以通过指定多个输出（ref 和/或 out）参数来返回多个值。

请参阅此处的 c# 讨论和示例[链接文本](http://msdn.microsoft.com/en-us/library/0f66670z(VS.71).aspx)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2021-12-10T21:00:17.920

看看这张照片：

在第一种情况下（**通过引用传递**），当在函数内部设置或更改变量时，外部变量也会发生变化。

但是在第二种情况下（**按值传递**），更改函数内部的变量对外部变量没有影响。

如需阅读文章，请参阅此[链接](https://blog.penjee.com/passing-by-value-vs-by-reference-java-graphical/)。

[![按引用调用与按值调用](https://blog.penjee.com/wp-content/uploads/2015/02/pass-by-reference-vs-pass-by-value-animation.gif)](https://blog.penjee.com/wp-content/uploads/2015/02/pass-by-reference-vs-pass-by-value-animation.gif)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-12-17T02:10:39.657

例子：

```
class Dog 
{ 
public:
    barkAt( const std::string& pOtherDog ); // const reference
    barkAt( std::string pOtherDog ); // value
}; 
```

`const &`一般是最好的。您不会受到建造和破坏的惩罚。如果引用不是 const，则您的界面暗示它将更改传入的数据。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-01-23T22:05:29.557

如果您不想在将原始变量传递给函数后更改其值，则应使用“**按值传递**”参数构造函数。

然后该函数将只有值，但没有传入变量的地址。如果没有变量的地址，函数内部的代码就无法改变从函数外部看到的变量值。

但是如果你想让函数*能够改变*从外部看到的变量的值，你需要使用**pass by reference**。因为值和地址（引用）都被传入并且在函数内部可用。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-07-27T13:46:03.017

简而言之，按值传递就是它是什么，按引用传递就是它在哪里。

如果你的值是 VAR1 = "Happy Guy!"，你只会看到 "Happy Guy!"。如果 VAR1 更改为“Happy Gal！”，您将不会知道。如果它是通过引用传递的，并且 VAR1 发生了变化，你会的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-06-12T10:15:26.567

pass by value means how to pass value to a function by making use of arguments. in pass by value we copy the data stored in the variable we specify and it is slower than pass by reference bcse t he data is copied . of we make changes in the copied data the original data is not affected. nd in pass by refernce or pass by address we send direct link to the variable itself . or passing pointer to a variable. it is faster bcse less time is consumed

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-04-25T11:49:06.520

**这是一个示例，演示了按值传递 - 指针值 - 引用** 之间的区别：

```
void swap_by_value(int a, int b){
    int temp;

    temp = a;
    a = b;
    b = temp;
}   
void swap_by_pointer(int *a, int *b){
    int temp;

    temp = *a;
    *a = *b;
    *b = temp;
}    
void swap_by_reference(int &a, int &b){
    int temp;

    temp = a;
    a = b;
    b = temp;
}

int main(void){
    int arg1 = 1, arg2 = 2;

    swap_by_value(arg1, arg2);
    cout << arg1 << " " << arg2 << endl;    //prints 1 2

    swap_by_pointer(&arg1, &arg2);
    cout << arg1 << " " << arg2 << endl;    //prints 2 1

    arg1 = 1;                               //reset values
    arg2 = 2;
    swap_by_reference(arg1, arg2);
    cout << arg1 << " " << arg2 << endl;    //prints 2 1
} 
```

“通过引用传递”方法有**一个重要的局限性**。如果一个参数被声明为**通过引用传递**（所以它前面有 & 符号）它对应的**实际参数必须是一个变量**。

引用“按值传递”形式参数的实际参数通常可以**是表达式**，因此它不仅可以使用变量，还可以使用文字甚至函数调用的结果。

该函数不能将值放在变量以外的东西中。它不能为文字分配新值或强制表达式更改其结果。

*PS：您也可以在当前线程中查看 Dylan Beattie 的答案，该答案用简单的文字解释。*

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-08-14T07:24:20.253

问题是“vs”。
并且没有人指出重要的一点。
在传递值时，会占用额外的内存来存储传递的变量值。
在
传递引用时，不会为这些值占用额外的内存。（在某些情况下内存有效）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-01-28T15:37:31.570

**1.按值传递/按值调用**

```
 void printvalue(int x) 
   {
       x = x + 1 ;
       cout << x ;  // 6
   }

   int x = 5;
   printvalue(x);
   cout << x;    // 5 
```

在按值调用中，当您将值传递给`printvalue(x)`即参数`5`时，它被复制到`void printvalue(int x)`。现在，我们有两个不同的值`5`和复制的值`5`，这两个值存储在不同的内存位置。因此，如果您在内部进行任何更改，`void printvalue(int x)`它不会反映回参数。

**2\. 引用传递/引用调用**

```
 void printvalue(int &x) 
   {
      x = x + 1 ;
      cout << x ; // 6
   }

   int x = 5;
   printvalue(x);
   cout << x;   // 6 
```

在引用调用中，只有一个区别。我们使用`&`ie 地址操作符。通过这样做
`void printvalue(int &x)`，我们指的是地址，`x`它告诉我们它都指的是同一个位置。因此，函数内部所做的任何更改都将反映在外部。

既然来了，你也应该知道...

**3\. 按指针传递/按地址调用**

```
 void printvalue(int* x) 
   {
      *x = *x + 1 ;
      cout << *x ; // 6
   }

   int x = 5;
   printvalue(&x);
   cout << x;   // 6 
```

在按地址传递中，指针`int* x`保存传递给它的地址`printvalue(&x)`。因此，函数内部所做的任何更改都将反映在外部。

# oracle - Oracle在触发器中删除之前检查存在

> ID：373421
> 
> 赞同：0
> 
> 时间：2008-12-17T01:50:17.220
> 
> 标签：oracle, exists

我分析了一个休眠生成的 oracle 数据库，发现从单个表中删除一行将触发 1200 多个触发器，以便删除子表中的相关行。触发器都是自动生成的 - 自动删除子行而不先检查是否存在。由于无法预测哪些子表实际上将具有相关行，因此我认为防止触发级联删除向下深入分支完全空肢体的可行解决方案是在尝试之前检查相关行是否存在删除。在其他 dbms 中，我可以在删除之前简单地声明“如果存在......”。在 oracle 中是否有类似的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T03:58:24.247

“从单个表中删除一行将触发 1200 多个触发器”这些语句或行级触发器是什么？如果是后者，它们只会在删除一行时触发。假设您在客户上有一个 BEFORE DELETE 触发器来删除客户订单，并且在订单上有一个 BEFORE DELETE 触发器来删除订单项。如果客户没有订单，并且订单表触发器是行级触发器，那么它不会触发从订单项目中删除。

“在尝试删除之前检查是否存在相关行”可能没有好处。事实上，使用 SELECT 后跟 DELETE 会做更多的工作。

当然，休眠逻辑被打破了。删除会话只会看到（并尝试删除）已提交的事务。如果 FRED 已为客户插入订单，但未提交，则 JOHN 的删除（通过触发器）将看不到它或尝试删除它。但是，它仍然会“成功”并尝试删除父客户。如果您实际上在数据库中启用了外键约束，Oracle 将启动。它会等到 FRED 提交，然后拒绝删除，因为它有一个子项。如果外键约束不存在，则您有一个不存在的客户的订单。这就是为什么您应该在数据库中强制执行这种业务逻辑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T03:32:10.837

如果可能，请适当地修改和设置您的数据库表。- 如果您有一位 DBA 可供您使用，请让一位 DBA 参与进来。

您需要使用[外键约束和级联删除](http://www.techonthenet.com/oracle/foreign_keys/foreign_delete.php)。这消除了对触发器等的需要......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T02:10:54.057

您可以查询特殊的 dba_objects 表：﻿</p>

```
DECLARE 
X    NUMBER;
﻿﻿BEGIN
    SELECT COUNT(*) INTO X FROM DBA_OBJECTS WHERE OBJECT_TYPE = 'TRIGGER' AND OBJECT_NAME = 'YOUR_TRIGGER_NAME_HERE';
    IF X = 0 THEN
        --Trigger doesn't exist, OK to delete...
    END IF;
END; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-14T12:37:50.350

```
select * from Tab where Tname = "TABLENAME" 
```

如果此查询返回任何行，则该表存在，否则不存在。

# .net - 如何使用 MSI (WiX) 将 .NET DLL 安装到 COM+ 应用程序中

> ID：373436
> 
> 赞同：1
> 
> 时间：2008-12-17T01:54:57.223
> 
> 标签：.net, 64-bit, wix, windows-installer, com+

**更新：**看起来这确实是一个 WiX 限制 -[无法添加 64 位 com+ 组件 (3.0.3907.0)](https://sourceforge.net/tracker2/index.php?func=detail&aid=1914217&group_id=105970&atid=642714)

我有一个使用 WiX 2.0 创建的带有 MSI 安装程序的 .NET 应用程序。安装程序创建一个 COM+ 应用程序（除其他外）并将一个 .NET 程序集作为组件安装到该应用程序中。此 DLL 是纯托管的，但它调用可能是 32 位或 64 位的混合 DLL。在 32 位平台上一切正常。然而，在 64 位上，COM+ dllhost.exe 进程作为 32 位运行，随后无法加载本机 DLL。当我查看注册表时，我可以看到 COM+ 组件 DLL 已在 Wow6432Node 键下注册，我认为这就是 dllhost 以 32 位运行的原因。

如果我使用组件服务管理单元来删除和重新添加 DLL，它会在“真实”注册表中正确注册，并且 dllhost 以 64 位启动。我如何让安装程序做同样的事情，即。将其正确注册为 64 位 DLL？我已经将 Package Platform 属性设置为“x64”，并为每个组件设置了 Win64="yes" 属性，但这些似乎没有帮助。

COM+ 组件的 WiX 源代码如下所示：

```
 <Component Id="C_My.Server.dll_ComPlus" Guid="0117c6c5-387a-4b67-9a7f-273d5db3affd" Win64="yes">
        <File Id="F_My.Server.dll_ComPlus" Name="SERVER.DLL" LongName="My.Server.dll" Vital="yes" KeyPath="yes"
              Assembly="no" DiskId="1" Source="..\Server\bin\$(var.Configuration)\" />
        <pca:ComPlusApplication Id="MyServerComPlusApp" Name="My Server" RunForever="yes"
          ApplicationDirectory="[INSTALLDIR]ComPlusConfig" ApplicationAccessChecksEnabled="no"
          Identity="[ComPlusUserName]" Password="[ComPlusPassword]">
          <pca:ComPlusAssembly Id="MyServerComPlusAssembly" DllPath="[#F_My.Server.dll_ComPlus]"
            TlbPath="[#F_My.Server.tlb_ComPlus]" Type=".net" RegisterInCommit="yes">
            <pca:ComPlusComponent Id="CheckInterface" CLSID="d4cf3da5-83ad-4436-b174-eccdb121a9ea" />
          </pca:ComPlusAssembly>
        </pca:ComPlusApplication>
      </Component> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T03:11:47.960

这很可能是 COM+ CustomAction 的缺陷。它现在可能只支持 32 位代码。

# performance - 哪些简单的更改对您的 Delphi 程序进行了最大的改进

> ID：373449
> 
> 赞同：28
> 
> 时间：2008-12-17T02:00:47.867
> 
> 标签：performance, delphi, memory

我有一个 Delphi 2009 程序，它处理大量数据并且需要尽可能快并且不使用太多内存。

通过显着减少执行时间或内存使用，您对 Delphi 代码做了哪些对程序性能影响最大的**简单更改？**

* * *

感谢大家的所有回答。许多很棒的提示。

为了完整起见，我将发布一些关于我发现的 Delphi 优化的重要文章。

在 About.com[开始优化 Delphi 代码之前](http://delphi.about.com/od/objectpascalide/a/beforeoptimize.htm)

速度和大小： About.com 上的[十大技巧](http://delphi.about.com/od/objectpascalide/a/speedsize.htm)

高性能 Delphi 的[代码优化基础](http://effovex.com/OptimalCode/basics.htm)和[Delphi 优化指南，与 Delphi 7 相关，但仍然非常相关。](http://effovex.com/OptimalCode/opguide.htm)

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-17T03:01:31.957

.开始更新；

.结束更新；

;)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-17T06:21:40.947

使用 Delphi Profiling 工具（一些[在这里](https://stackoverflow.com/questions/368938/delphi-profiling-tools)或[这里](https://stackoverflow.com/questions/291631/profiler-and-memory-analysis-tools-for-delphi)）并发现您自己的瓶颈。优化错误的瓶颈是浪费时间。换句话说，如果您在这里应用所有这些建议，但忽略有人在一些非常重要的代码中放置**sleep(1000)**（或类似）的事实是浪费您的时间。 *首先解决您的实际瓶颈。*

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-12-17T10:38:18.587

停止对所有内容使用 TStringList。

TStringList**不是**用于有效存储和处理从简单类型到复杂类型的所有内容的通用数据结构。寻找替代品。我使用[Delphi 容器和算法库](http://sourceforge.net/projects/decal/)（DeCAL，以前称为 SDL）。Julians [EZDSL](http://www.boyet.com/)也应该是一个不错的选择。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-12-17T02:13:27.437

预先分配列表和数组，而不是在每次迭代中增加它们。

就速度而言，这可能对我产生了最大的影响。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-17T02:59:20.013

如果您需要在循环中使用 Application.processmesssages （或类似的），请尝试仅在每第 N 次迭代时调用它。

同样，如果更新进度条，不要每次迭代都更新它。相反，每 x 次迭代将其增加 x 个单位，或者根据时间或作为总任务长度的百分比来缩放更新。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-17T06:39:35.467

1.  快速MM
2.  快速代码（库）
3.  使用高性能数据结构，如哈希表（等）。在许多地方，创建一个循环来为您的数据生成查找哈希表会更快。使用相当多的内存，但它肯定很快。（这可能是最重要的一个，但前两个非常简单，只需很少的努力即可）

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-12-17T08:55:56.063

减少磁盘操作。如果有足够的内存，则将文件完全加载到 RAM 并在内存中执行所有操作。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-17T06:30:28.370

考虑谨慎使用线程。如果您现在不使用线程，请考虑添加一对。如果是，请确保您没有使用太多。如果您在双核或四核计算机上运行（大多数已不再适用），那么适当的线程调整非常重要。

您可以查看[Gabr 的 OmniThread 库](http://otl.17slon.com/)，但有许多正在为 Delphi 开发的线程库。您可以轻松地实现自己的并行来使用匿名类型。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-12-17T07:02:25.077

在你做任何事情之前，确定慢的部分。不要触摸执行速度足够快的工作代码。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-07-29T08:04:32.793

当我开始使用 AsyncCalls 将用于冻结 UI 的单线程应用程序转换为（某种）多线程应用程序时，最大的改进出现了。

尽管 AsyncCalls 可以做更多事情，但我发现它对于这个非常简单的目的很有用。假设您有一个像这样被阻止的子例程：禁用按钮、执行工作、启用按钮。您将“Do Work”部分移动到本地函数（称为 AsyncDoWork），并添加四行代码：

```
var  a: IAsyncCall;    
a := LocalAsyncCall(@AsyncDoWork);  
while (NOT a.Finished) do 
  application.ProcessMessages;  
a.Sync; 
```

这对您的作用是在单独的线程中运行 AsyncDoWork，而您的主线程仍可用于响应 UI（例如拖动窗口或单击 Abort。）当 AsyncDoWork 完成后，代码将继续。因为我把它移到了本地函数，所以所有本地变量都可用，代码不需要更改。

这是一种非常有限的“多线程”类型。具体来说，它是双线程。您必须确保您的 Async 函数和 UI 不会同时访问相同的 VCL 组件或数据结构。（我禁用了除停止按钮之外的所有控件。）

我不使用它来编写新程序。这只是使旧程序更具响应性的一种非常快速简便的方法。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-17T02:28:31.027

使用 tstringlist（或类似的）时，设置“sorted := false”直到需要（如果有的话）。好像不费吹灰之力...

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-17T02:30:17.013

对字符串和数组智能使用 SetLength()。使用 FillChar 或 ZeroMemory 优化初始化。

在堆栈上创建的局部变量（例如记录类型）比堆分配的变量（对象和 New()）更快。

重用对象而不是销毁然后创建。但要确保管理代码比内存管理器快！

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-12-17T06:26:07.177

1.  创建单元测试
2.  验证测试全部通过
3.  分析您的应用程序
4.  重构寻找瓶颈和内存
5.  从第 2 步开始重复（与上一次相比）

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-17T02:56:13.670

检查大量使用的循环是否可以（至少部分）预先计算或使用查找表处理。Trig 函数是这方面的经典，但它也适用于许多其他函数。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-07-29T08:11:15.930

如果您有一个列表，请使用任何内容的动态数组，甚至是如下记录：

这不需要课程，不需要释放并且访问它非常快。即使它需要增长，您也可以这样做 - 见下文。仅在您需要大量改变尺寸的灵活性时`TList`使用。`TStringList`

```
type
  TMyRec = record
    SomeString : string;
    SomeValue : double;
  end;

var
  Data : array of TMyRec;
  I : integer;

..begin
  SetLength( Data, 100 ); // defines the length and CLEARS ALL DATA
  Data[32].SomeString := 'Hello';
  ShowMessage( Data[32] );

  // Grow the list by 1 item.
  I := Length( Data );
  SetLength( Data, I+1 );

..end; 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-12-17T02:10:09.643

将程序逻辑与用户界面分离，重构，然后独立优化最常用、资源最密集的元素。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-17T02:12:10.560

*   关闭调试

*   打开优化

*   删除对您实际不使用的单位的所有引用

*   寻找内存泄漏

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-12-17T06:07:20.787

使用大量断言进行调试，然后在交付代码中将其关闭。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-12-17T06:07:55.903

广泛测试后关闭范围和溢出检查。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-12-17T06:13:11.133

[使用完整的 FastMM](http://hallvards.blogspot.com/2007/05/use-full-fastmm-consider-donating.html)并研究文档和源代码，看看是否可以根据您的规范对其进行调整。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-12-17T06:34:23.120

当我第一次开始使用 Delphi 时，对于一个旧的 BDE 开发，我使用了很多`TQuery`组件。`TTable`在我向他解释我在做什么之后，有人告诉我使用master-detail，这使程序运行得更快。

调用`DisableControls`可以省略不必要的 UI 更新。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-12-17T13:17:54.710

识别记录时，尽可能使用整数进行记录比较。虽然“公司名称”的主键可能看起来合乎逻辑，但生成和存储它的哈希所花费的时间将大大缩短整体搜索时间。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-12-17T06:09:33.030

如果你真的，真的，真的需要轻量化，那么你可以摆脱 VCL。看看[KOL 和 MCK](http://kolmck.net/)。当然，如果您这样做，那么您就是在交易功能以减少占用空间。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-12-17T06:22:51.507

您可以考虑使用运行时包。如果运行的程序不止一个使用相同的包编写，这可能会减少您的内存占用。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-12-17T12:00:44.693

如果您使用线程，请设置它们的处理器亲和性。如果您还没有使用线程，请考虑使用它们，或者如果您的应用程序执行大量 I/O，请查看异步 I/O（完成端口）。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-12-17T13:11:39.167

考虑一下 DBMS 数据库是否真的是完美的选择。如果您只是读取数据而从不更改它，那么平面固定记录文件可以更快地工作，特别是如果数据的路径可以轻松映射（即一个索引）。对固定记录文件进行简单的二进制搜索仍然非常快。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-12-18T21:44:36.947

*   开始更新...结束更新
*   短字符串与字符串
*   使用数组而不是 TStrings 和 TList

但可悲的是，调优和优化可能会给你带来 10% 的改进（这很危险）；重新设计可以给你90%。一旦你真正理解了目标，你通常可以用更好的方式重述问题（以及解决方案）。

干杯

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-04-21T16:10:07.473

检查所有回路，并寻找短路方法。如果您正在寻找特定的东西并在循环中找到它，那么使用 BREAK 命令立即保释......没有意义循环通过其余部分。如果您知道自己没有匹配项，请尽快使用 CONTINUE。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-12-17T06:16:10.753

利用一些[FastCode 项目](http://www.fastcode.dk/fastcodeproject/fastcodeproject/index.htm)代码。它的一部分被合并到 VCL/RTL 中（就像 FastMM 一样），但还有更多你可以使用的！

请注意，他们也有一个正在移动的[新站点](http://www.fastcodeproject.org/)，但它似乎有点不活跃。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-12-17T06:18:13.433

也许利用Andreas [Hausladen的](http://andy.jgknet.de/blog/)[VCL FixPack](http://andy.jgknet.de/blog/?page_id=288)

> VCL Fix Pack 是一个 Delphi 单元，它通过修补原始函数在运行时修复 VCL 和 RTL 错误。如果您希望应用程序中的所有 IDE Fix Pack 修复程序，这个单元就是您所需要的。将单元添加到您的项目（Delphi 和 C++Builder）会自动安装适用于您的 Delphi/C++Builder 版本的补丁。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-12-17T06:24:12.983

考虑硬件问题。如果您确实需要性能，请考虑您的程序和数据库正在运行的硬盘类型。有很多变量，特别是如果您正在运行数据库。RAID 也不总是最好的答案。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-04-21T16:12:14.927

如果您必须进行字符串比较，请使用优化的 STRCOMP 或 TEXTCOMP 函数。对于简单的相等，使用优化的 SAMESTR 和 SAMETEXT 函数。如果您知道情况始终相同，请始终选择 SAMESTR/STRCOMP。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-01-28T05:19:14.267

当 TQuery 可以使用时，避免使用带有查找字段的 TTable。

我有一个在大型数据库中非常慢的报告。它使用了一个带有一堆查找字段的 TTable。我在我的应用程序上挂了一个网络监视器，当我使用查找字段遍历这个 TTable 时，发现大量数据正在流经线路。更改为 TQuery 极大地减少了流量并在速度上产生了巨大差异。

这个建议实际上只是学习用客户端-服务器术语来思考。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2010-03-19T21:53:19.967

运行 SysInternals ProcessExplorer 和 FileMonitor，并从操作系统的角度观察您的应用程序的行为。您会发现意外的磁盘和注册表活动等惊喜。您可能认为您在一次操作中将设置保存到注册表或 .ini 文件中，您可能正在执行 100 次写入。您可能会发现，当您认为您正在执行 3 次写入时，数据库写入需要 30 次写入。其中一些可以通过事务和缓冲等内容进行调整。但直到你首先找到问题所在。当我将我的应用程序通过 U3 认证（闪迪 U3 驱动器有自己的认证）时，我有了这样的“觉醒”。我从来没有通过拥有我的应用程序的 U3 版本赚到很多钱，但这次练习非常值得。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2010-03-20T08:21:30.430

如果可能，请避免使用 thread.synchronize。这会停止一切并等待 VCL 线程。我们将大部分同步更改为使用 thread.queue，它们可以异步完成。匿名方法的使用在这里也有帮助。

# asp.net-mvc - HTML.CheckBox(string) 计算为两个 HTML 元素而不是一个

> ID：373454
> 
> 赞同：5
> 
> 时间：2008-12-17T02:03:26.320
> 
> 标签：asp.net-mvc

编码

```
<%=Html.CheckBox("SendEmail") %> 
```

渲染时计算为两个 HTML 元素

```
<input id="SendEmail" name="SendEmail" type="checkbox" value="true" /> 
<input name="SendEmail" type="hidden" value="false" /> 
```

这是一个错误吗？还是设计使然？如果是设计使然，为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-23T10:05:01.687

今天早上我在从我的 MVC 应用程序的复选框组中检索选定的值时遇到了一些麻烦。我把它发给了我的团队，并认为我会与其他人分享。

当回发复选框的值时，所有浏览器的标准行为是完全忽略回发中未选中的复选框。因此，如果您有一个未选中的复选框，则 Request.Form 中不会显示任何内容。这是大多数开发人员解释的一个众所周知的现象。

在 ASP.Net MVC 中，当您使用 Html.Checkbox 时，它会尝试解决此问题并确保您为未选中的复选框回发了一个值（在本例中为“false”）。这是通过添加一个包含值“false”的隐藏字段来完成的。

例如。

```
<%= Html.CheckBox("Sites", s.Selected, new { value = s.Value })%> 
```

生成 HTML

```
<input id="Sites" name="Sites" type="checkbox" value="1" /><input name="Sites" type="hidden" value="false" /> 
```

这一切都很好，直到您尝试使用复选框组。这不仅仅是一个具有相同名称的复选框，其中值以单个逗号分隔的字符串发送回。如果您将值定义为数组 (string[] Sites)，MVC 可以自动为您拆分此字符串。

这是视图代码：

```
<% foreach(var s in Model) { %>
              <li><%= Html.CheckBox("Sites", s.Selected, new { value = s.Value })%>
              <label><%= s.Name %></label>
              </li>
       <% } %> 
```

适当的控制器动作：

[AcceptVerbs(HttpVerbs.Post)] public ActionResult Edit(int Id, string Name, string SubmissionUrl, string[] Sites)

不幸的是，因为 Html.Checkbox 也产生了这个隐藏字段值，所以结果数组不仅包含选定复选框的值，还包含每个未选中复选框的“假”。你得到一个看起来像这样的数组：

```
[0] 'false'
[1] 'false'
[2] '110'
[3] '50'
[4] 'false' 
```

其中 'false' 表示未选中的复选框，整数是选中的复选框的值。

如果您的复选框的值只有整数，并且想要将结果定义为整数数组，这可能会使您的代码大量丢失，如下所示：

public ActionResult Edit(int Id, string Name, string SubmissionUrl, int[] Sites)

这会导致抛出异常，因为它无法将字符串值“false”转换为整数。

解决方案非常简单，只需避免 Html.Checkbox 并在您的视图代码中手动创建复选框，如下所示：

```
 <% foreach(var s in Model) { %>
          <li><input type="checkbox" name="Sites" value="<%=s.Value%>" <% if (s.Selected) { %>checked="checked"<% } %> />
          <label><%= s.Name %></label>
          </li>
   <% } %> 
```

希望这对其他人有帮助！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T14:10:35.743

当所有其他方法都失败时，请阅读源代码。:) 这是来自 HtmlHelper.cs：

```
 // Render an additional <input type="hidden".../> for checkboxes. This
            // addresses scenarios where unchecked checkboxes are not sent in the request.
            // Sending a hidden input makes it possible to know that the checkbox was present
            // on the page when the request was submitted. 
```

我不确定这有多大用处，但至少您知道其意图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T02:16:41.813

我想我[在网上找到了](http://forums.asp.net/p/1314753/2603373.aspx)与我的问题直接相关的东西。

# python - 在多个不同的字符上拆分字符串

> ID：373459
> 
> 赞同：11
> 
> 时间：2008-12-17T02:06:01.010
> 
> 标签：python, string, split

我想使用一个或多个分隔符来拆分字符串。

例如“a bc”，拆分为“”和“。” 将给出列表 ["a", "b", "c"]。

目前，我在标准库中看不到任何东西可以做到这一点，而且我自己的尝试有点笨拙。例如

```
def my_split(string, split_chars):
    if isinstance(string_L, basestring):
        string_L = [string_L]
    try:
        split_char = split_chars[0]
    except IndexError:
        return string_L

    res = []
    for s in string_L:
        res.extend(s.split(split_char))
    return my_split(res, split_chars[1:])

print my_split("a b.c", [' ', '.']) 
```

可怕！有更好的建议吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-17T02:16:43.560

```
>>> import re
>>> re.split('[ .]', 'a b.c')
['a', 'b', 'c'] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T03:31:13.600

这个用列表中的第一个分隔符替换所有分隔符，然后使用该字符“拆分”。

```
def split(string, divs):
    for d in divs[1:]:
        string = string.replace(d, divs[0])
    return string.split(divs[0]) 
```

输出：

```
>>> split("a b.c", " .")
['a', 'b', 'c']

>>> split("a b.c", ".")
['a b', 'c'] 
```

不过，我确实喜欢那个“是”解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-10-06T17:41:01.830

没有重新的解决方案：

```
from itertools import groupby
sep = ' .,'
s = 'a b.c,d'
print [''.join(g) for k, g in groupby(s, sep.__contains__) if not k] 
```

解释在这里[https://stackoverflow.com/a/19211729/2468006](https://stackoverflow.com/a/19211729/2468006)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-16T10:09:29.883

不是很快，但可以完成工作：

```
def my_split(text, seps):
  for sep in seps:
    text = text.replace(sep, seps[0])
  return text.split(seps[0]) 
```

# c++ - 帮助 C++ 列表擦除功能

> ID：373462
> 
> 赞同：0
> 
> 时间：2008-12-17T02:10:06.320
> 
> 标签：c++, iterator

我正在尝试进行简单的擦除并不断出错。

这是我擦除的代码片段：

```
std::list<Mine*>::iterator iterMines = mines.begin();
for(int i = oldSizeOfMines; i >0 ; i--, iterMines++)
{
    if(player->distanceFrom(*iterMines) < radiusOfOnScreen)
    {
        onScreen.push_back(*iterMines);
        iterMines = onScreen.erase(iterMines);
        iterMines--;
    }
} 
```

我不断收到编译器消息：

```
1>c:\users\owner\desktop\bosconian\code\bosconian\environment.cpp(158) : error C2664: 'std::list<_Ty>::_Iterator<_Secure_validation> std::list<_Ty>::erase(std::list<_Ty>::_Iterator<_Secure_validation>)' : cannot convert parameter 1 from 'std::list<_Ty>::_Iterator<_Secure_validation>' to 'std::list<_Ty>::_Iterator<_Secure_validation>'
1>        with
1>        [
1>            _Ty=SpaceObject *,
1>            _Secure_validation=true
1>        ]
1>        and
1>        [
1>            _Ty=Mine *,
1>            _Secure_validation=true
1>        ]
1>        and
1>        [
1>            _Ty=SpaceObject *,
1>            _Secure_validation=true
1>        ]
1>        No user-defined-conversion operator available that can perform this conversion, or the operator cannot be called 
```

我很困惑，因为我相信我给了它正确的迭代器。

我的是 SpaceObject 的子类（第二代子类）

这有什么关系吗？我将如何解决它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T02:36:27.687

问题是您正试图将地雷的迭代器用作 onScreen 列表中的迭代器。这行不通。

你的意思是调用 mines.erase(iterMines) 而不是 onScreen.erase(iterMines)？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T02:38:07.763

```
std::list<Mine*>::iterator iterMines = mines.begin();
for(int i = oldSizeOfMines; i >0 ; i--, iterMines++)
{
        if(player->distanceFrom(*iterMines) < radiusOfOnScreen)
        {
                onScreen.push_back(*iterMines);
                iterMines = onScreen.erase(iterMines);
                iterMines--;
        }
} 
```

一个真正的问题，一个可能的解决方案：

`erase`将在删除元素之后为您提供下一个迭代器。所以，如果你在开始，抹去，你会得到新的开始。如果您随后递减迭代器，则在开始之前递减。这是无效的。更好地`iterMines++`分解到循环体中：

```
std::list<Mine*>::iterator iterMines = mines.begin();
for(int i = oldSizeOfMines; i >0 ; i--)
{
        if(player->distanceFrom(*iterMines) < radiusOfOnScreen)
        {
                onScreen.push_back(*iterMines);
                iterMines = mines.erase(iterMines); // change to mines!!
        } else { 
            ++iterMines; // better to use ++it instead of it++
        }
} 
```

最好为此使用预增量，因为您永远不知道迭代器在创建自身副本时在幕后做了什么。`++it`将返回新的迭代器，而`it++`将在增量之前返回迭代器的副本。我已经评论了可能的解决方案的部分:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-08T00:43:34.377

# asp.net - 如何使用 Asp.Net 在弹出窗口中生成 HTML

> ID：373488
> 
> 赞同：0
> 
> 时间：2008-12-17T02:24:35.153
> 
> 标签：asp.net, html, popup, report

我从服务器上的一个对象生成了非常简单的 html 报告。我生成 html 代码是`PageLoad`因为我需要从会话中清除该对象，并且不想在用户单击链接按钮后向外部 Web 服务询问数据。

粗略的想法是用户点击页面上的按钮，报告将显示在新窗口中。

正如我所说，我已经生成了 html，`PageLoad`现在存储在服务器的唯一文件中。我还认为我可以将 html 代码隐藏在隐藏控件中。但是如果没有额外的工作，这将无法工作，它将html代码转换为一些无意义的字符串并稍后恢复。

我可以设法通过使用将我的 html 代码显示到当前窗口中`Response.Write(myhtml as string);`

所以我的问题是：

1.  我在哪里可以将我的 html 代码存储在文件系统之外（这对于安全问题很棘手）
2.  如何在单击事件时将我的 htmlcode 显示到新窗口中。我可以用什么方法。

我找到了[此处](http://www.dreamincode.net/forums/showtopic66926.htm)描述的一种可能的解决方案。

**更新：**

只需添加几段代码。它在当前窗口中显示 html 字符串，这不是我想要的。

```
private void InitData(){  
  string filename = DateTime.Now.ToString("yyyyMMdd_HHmmssfff");
  lbtnPrintOutOrder.CommandArgument = filename;
  StreamWriter swXLS = new StreamWriter((MapPath("Files\\")) + filename);

  string message = GetEmail();//get data form session object

  swXLS.Write(message);//save data to file
  swXLS.Close();
}

protected void lbtnPrintOutOrder_Command(object sender, System.Web.UI.WebControls.CommandEventArgs e)
{
   string filePath = (MapPath("Files\\")) + e.CommandArgument.ToString();

  string content;
  using (StreamReader reader = File.OpenText(filePath)) {
     content = reader.ReadToEnd();//get html from file
  }
  Response.Write(content);//load it to current window
  Response.End();
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T16:13:07.273

一个大问题是，为什么需要从 Session 中清除对象？为什么在新窗口中显示字符串之前不能将对象保持在会话中？

您可以在新窗口中打开一个 aspx 页面，使用存储在会话中的字符串对象来输出 html，并在显示 html 后清除会话。

# sql - 在没有的查询的返回中插入日期

> ID：373490
> 
> 赞同：8
> 
> 时间：2008-12-17T02:25:52.827
> 
> 标签：sql, gaps-and-islands

我们正在构建一个查询来计算每天每小时的事件数。大多数日子有几个小时没有任何活动，因此运行查询的地方会显示每小时的活动计数，但存在差距，查询将这些活动排除在外。我们仍然希望显示没有活动的时间并显示零，以便随后可以绘制零值。我们使用的查询看起来像这样……</p>

```
select datepart(Year, dev_time) as Year,
    datepart(Month, dev_time) as Month,
    datepart(Day, dev_time) as Day,
    datepart(Hour, dev_time) as Hour,
    count(tdm_msg) as Total_ACTIVITES
from TCKT_ACT
where tdm_msg = ‘4162′ and dev_time >= DATEADD(day, - 1, GETDATE())
group by datepart(Year, dev_time) ,
    datepart(Month, dev_time) ,
    datepart(Day, dev_time),
    datepart(Hour, dev_time)
order by datepart(Year, dev_time) asc,
    datepart(Month, dev_time) asc,
    datepart(Day, dev_time) asc,
    datepart(Hour, dev_time) asc 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T02:43:25.067

您将以某种方式需要一个包含天数和小时数的表，然后您必须在该表和您的查询之间进行外部连接。这就是我将如何做到的。请注意，此解决方案仅适用于 SQL Server 2005 和 2008。如果您没有这些平台，则必须在数据库中实际创建一个时间表，您可以从中加入：

```
DECLARE @MinDate DATETIME;
SET @MinDate =  CONVERT(varchar, GETDATE(), 101);

WITH times AS (
    SELECT @MinDate as dt, 1 as depth
    UNION ALL
    SELECT DATEADD(hh, depth, @MinDate), 1 + depth as depth
    FROM times
    WHERE DATEADD(hh, depth, @MinDate) <= GETDATE())
SELECT DATEPART(YEAR, t.dt) as [Year],
    DATEPART(MONTH, t.dt) as [Month],
    DATEPART(DAY, t.dt) as [Day],
    DATEPART(HOUR, t.dt) as [Hour],
    COUNT(tdm_msg) as Total_ACTIVITES
FROM times t
LEFT JOIN (SELECT * FROM TCKT_ACT WHERE tdm_msg = '4162' and dev_time >= @MinDate) a
    ON  DATEPART(HOUR, t.dt)  = DATEPART(HOUR, a.dev_time)
    AND MONTH(t.dt) = MONTH(a.dev_time)
    AND DAY(t.dt)   = DAY(a.dev_time)
    AND YEAR(t.dt)  = YEAR(a.dev_time)
GROUP BY DATEPART(YEAR, t.dt) ,
    DATEPART(MONTH, t.dt) ,
    DATEPART(DAY, t.dt),
    DATEPART(HOUR, t.dt)
ORDER BY DATEPART(YEAR, t.dt) asc,
    DATEPART(MONTH, t.dt) asc,
    DATEPART(DAY, t.dt) asc,
    DATEPART(HOUR, t.dt) asc
OPTION (MAXRECURSION 0); /* Just in case you want a longer timespan later on... */ 
```

请注意，顶部的 WITH 语句称为递归公用表表达式，它是生成元素数量相对较少的顺序表的好方法，就像您在这里一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T05:36:30.727

首先，我根据 Dave Markle 描述的递归公共表查询创建了一个表函数（感谢您向我展示这个 Dave！）。这是非常甜蜜的，因为我只需要创建一次函数，就可以使用它来分析任何间隔。

```
if exists (select * from dbo.sysobjects where name = 'fn_daterange') drop function fn_daterange;
go

create function fn_daterange
   (
   @MinDate as datetime,
   @MaxDate as datetime,
   @intval  as datetime
   )
returns table
--**************************************************************************
-- Procedure: fn_daterange()
--    Author: Ron Savage
--      Date: 12/16/2008
--
-- Description:
-- This function takes a starting and ending date and an interval, then
-- returns a table of all the dates in that range at the specified interval.
--
-- Change History:
-- Date        Init. Description
-- 12/16/2008  RS    Created.
-- **************************************************************************
as
return
   WITH times (startdate, enddate, intervl) AS
      (
      SELECT @MinDate as startdate, @MinDate + @intval - .0000001 as enddate, @intval as intervl
         UNION ALL
      SELECT startdate + intervl as startdate, enddate + intervl as enddate, intervl as intervl
      FROM times
      WHERE startdate + intervl <= @MaxDate
      )
   select startdate, enddate from times;

go 
```

因此，如果您完全从该函数中进行选择，您会得到一个时间间隔表，如下所示：

**fn_daterange('12/14/2008 10:00:00', '12/14/2008 20:00:00', '01:00:00' )**

返回：

```
startdate               enddate                 intervl                 
----------------------- ----------------------- ----------------------- 
2008-12-14 10:00:00.000 2008-12-14 10:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 11:00:00.000 2008-12-14 11:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 12:00:00.000 2008-12-14 12:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 13:00:00.000 2008-12-14 13:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 14:00:00.000 2008-12-14 14:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 15:00:00.000 2008-12-14 15:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 16:00:00.000 2008-12-14 16:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 17:00:00.000 2008-12-14 17:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 18:00:00.000 2008-12-14 18:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 19:00:00.000 2008-12-14 19:59:59.997 1900-01-01 01:00:00.000 
2008-12-14 20:00:00.000 2008-12-14 20:59:59.997 1900-01-01 01:00:00.000 
```

然后我制作了一个事件数据示例表：

```
 eventdate               eventnote            
    ----------------------- -------------------- 
    2008-12-14 10:01:00.000 oo! an event!        
    2008-12-14 10:01:00.000 oo! an event!        
    2008-12-14 10:01:00.000 oo! an event!        
    2008-12-14 10:01:00.000 oo! an event!        
    2008-12-14 10:23:00.000 oo! an event!        
    2008-12-14 10:23:00.000 oo! an event!        
    2008-12-14 10:23:00.000 oo! an event!        
    2008-12-14 11:23:00.000 oo! an event!        
    2008-12-14 11:23:00.000 oo! an event!        
    2008-12-14 11:23:00.000 oo! an event!        
    2008-12-14 11:23:00.000 oo! an event!        
    2008-12-14 11:23:00.000 oo! an event!        
    2008-12-14 14:23:00.000 oo! an event!        
    2008-12-14 14:23:00.000 oo! an event!        
    2008-12-14 14:23:00.000 oo! an event!        
    2008-12-14 19:23:00.000 oo! an event!        
    2008-12-14 19:23:00.000 oo! an event!        
    2008-12-14 19:23:00.000 oo! an event!        
    2008-12-14 19:23:00.000 oo! an event!        
    2008-12-14 19:00:00.000 oo! an event!        
    2008-12-14 19:00:00.000 oo! an event!        
    2008-12-14 19:00:00.000 oo! an event!        

    22 Row(s) affected 
```

然后我用 LEFT OUTER JOIN 将它们连接在一起，如下所示：

```
select
   dr.startdate,
   dr.enddate,
   count(me.eventdate) as eventcount
from
   fn_daterange('12/14/2008 10:00:00', '12/14/2008 20:00:00', '01:00:00' ) dr

   LEFT OUTER JOIN myevents me
      on ( me.eventdate between dr.startdate and dr.enddate)
group by
   dr.startdate,
   dr.enddate

startdate               enddate                 eventcount 
----------------------- ----------------------- ---------- 
2008-12-14 10:00:00.000 2008-12-14 10:59:59.993 7          
2008-12-14 11:00:00.000 2008-12-14 11:59:59.993 5          
2008-12-14 12:00:00.000 2008-12-14 12:59:59.993 0          
2008-12-14 13:00:00.000 2008-12-14 13:59:59.993 0          
2008-12-14 14:00:00.000 2008-12-14 14:59:59.993 3          
2008-12-14 15:00:00.000 2008-12-14 15:59:59.993 0          
2008-12-14 16:00:00.000 2008-12-14 16:59:59.993 0          
2008-12-14 17:00:00.000 2008-12-14 17:59:59.993 0          
2008-12-14 18:00:00.000 2008-12-14 18:59:59.993 0          
2008-12-14 19:00:00.000 2008-12-14 19:59:59.993 7          
2008-12-14 20:00:00.000 2008-12-14 20:59:59.993 0          

11 Row(s) affected 
```

太棒了——我可以在工作中使用它进行各种分析！:-)

感谢 Fred 提出的问题和 Dave 提供的关于常见表查询的信息！

罗恩

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T02:43:49.077

我们在使用一些性能监控软件时遇到了类似的问题，但是，在 DB2/z 大型机商店中，我们坚决反对必须通过 SQL 体操来获得那种结果。众所周知，在检索到的每一行上执行“功能”的 SQL 查询是不可扩展的，如果我们尝试使用它们，DBA 会嘲笑我们。

相反，我们发现重构数据库模式以在每行中包含事件计数更容易（显然我们的 DBA 不介意使用更多的磁盘空间，只是更多的 CPU grunt）。在您的情况下，这将添加一个名为的列`tdm_quant`，您将为插入的每一行（即每个事件）设置为 1。

然后，您的查询的第五个字段从 更改`count(tdm_msg)`为`sum(tdm_quant)`将达到相同的结果。

除此之外，您可以插入一个特殊记录（每小时一次，或每天开始时的 24 个，或者如果您愿意，可以在 1 月 1 日填充整个年份），其中该`tdm_quant`字段设置为零。为零时，这些记录不会影响，`sum(tdm_quant)`但您会得到您想要的行为，一天中的**每个**小时都会返回一行，该行将为零，因为`Total_ACTIVITIES`该小时内没有发生任何事件。

您的查询的其余部分不需要更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T02:47:56.477

听起来您可以使用另一个包含数字 1 到 24 的表来使用“左外连接”...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T03:29:53.350

这里的基本答案涉及左外连接（LOJ）和显式`COUNT(column)`，因为它不计算空值，但 COUNT(*) 计算所有行。困难的部分是生成一个表来进行 LOJ。WITH 子句和递归解决方案适用于许多 DBMS（显然是 MS SQL Server，而且几乎可以肯定是 DB2 —— 也可能是其他 DBMS）。

许多 DBMS 支持临时表和存储过程；该组合可用于使用日期/时间字段的一组适当值填充表，然后针对该表执行 LOJ（或更准确地说，FROM temp_table LEFT OUTER JOIN main_table ...）。不那么整洁，但适用于大多数地方。

# flash - Flash Remoting 可以通过 HTTP (Squid) 代理服务器运行吗

> ID：373500
> 
> 赞同：0
> 
> 时间：2008-12-17T02:34:25.680
> 
> 标签：flash, remoting, reverse-proxy, squid

我有一个网络想通过 HTTP 使用 Flash Remoting 数据格式传送数据。我们让 Squid 作为反向代理/加速器工作，是否存在通过 Squid 运行此流量的任何已知问题。我们会将该特定 URL 配置为不被缓存。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T04:16:11.590

如果 Squid 没有缓存该 URL 或修改请求或响应，我认为它不太可能导致任何问题。这就是重点，对吧？这是一个很大的，如果...

很高兴你控制了鱿鱼。这样，如果出现问题，您可以相对快速地更改配置。依靠外部控制的 squid 不抓取您的应用程序将是一个潜在的故障点。

# mp3 - 是否有任何认真的努力对亚马逊 MP3 商店 azn 文件格式进行逆向工程？

> ID：373501
> 
> 赞同：2
> 
> 时间：2008-12-17T02:34:28.393
> 
> 标签：mp3, reverse-engineering, amazon

自从亚马逊 MP3 商店在英国推出以来，我真的很想为我的手机编写一个下载器应用程序，这样我就可以随时随地购买 mp3 并轻松收听它们。但是，首先我需要对它提供给下载器应用程序的亚马逊 .azn 文件格式进行逆向工程。外层很明显，它只是简单的 base 64 编码。然而，下一层更神秘一些。据我所知，它并没有放气，也没有任何其他明显的压缩算法。

我将尝试一些技巧，看看我是否可以使用下载器应用程序本身来帮助我解决这个问题，但我想知道我是否正在复制其他人在互联网一个不起眼的角落完成的工作？任何人都知道以前参与过的任何工作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-10T08:31:12.817

这并不难

base-64 编码的单 DES CBC

常量键 29ab9d18b2449e315e72

固定 IV 5e72d79a11b34fee

圣诞快乐

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T05:43:47.030

无论如何，我很可能已经回答了我自己的问题。该软件将 OpenSSL 用于各种事情，包括 BIO base 64 解码。我相信内层实际上是加密的（wtf？）但是，虽然下载器的 Windows 版本静态链接到 OpenSSL，但 Linux 版本动态链接到它。这应该意味着我不仅知道二进制文件从导入表中导入了哪些函数，而且我应该能够简单地向它抛出一个检测版本的 OpenSSL 并让它打印出我需要的所有参数。哇哈哈哈。对不起，邪恶的天才时刻。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-06T11:36:25.510

有一个免费软件项目可以从亚马逊下载 mp3 专辑。在 playlist.c 他们解密 amz 文件：[http ://code.google.com/p/clamz/](http://code.google.com/p/clamz/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T03:45:36.550

在这里要小心——我不确定英国执行了什么样的法律，但在美国，试图规避版权保护计划（在本例中为数字版权管理）是违反 DCMA 的。

话虽如此，如果您这样做只是为了个人/学术用途，我怀疑有人会介意。尽管如此，这些都不应该被解释为法律建议。

# deployment - 从 VS 2005 部署到 RS 2008 的 Reporting Services 部署问题

> ID：373507
> 
> 赞同：3
> 
> 时间：2008-12-17T02:39:45.620
> 
> 标签：deployment, reporting-services, datasource

我有一份在开发预览中完美运行的报告。但是当我部署时，我收到以下错误：

在开发环境中显示的错误是：

> 错误 4 找不到数据源“myDataSource”。c:\reporting services projects\reports\rest_of_path\my_report.rdl 0 0

在报告服务方面，它显示的错误是：

> 数据源连接信息已被删除。(rsInvalidDataSourceReference)

数据源本身部署得很好，并且它存在于服务器上，因此它“找不到”它是没有意义的。到底是怎么回事？

* * *

Ps 我找到了一种通过手动分配部署中丢失的数据源链接来使其在服务器上工作的方法。但我宁愿不必在每次部署新报告时都这样做。

1.  转到报告管理器（http:///reports/pages/Folder.aspx）
2.  单击您有报告的文件夹
3.  你将被引导到内容选项卡，你会在右上角找到显示详细信息
4.  点击显示详情
5.  签入特定报告并单击与其对应的编辑按钮
6.  转到属性选项卡并单击它
7.  你会在左侧找到一个菜单，点击数据源链接
8.  在那里你会找到为 A 共享数据源（默认情况下）选择的单选按钮和一个浏览按钮。
9.  单击浏览按钮，您将找到数据源和报告文件夹的树形结构。
10.  选择数据源文件夹中的数据源，然后选择确定。（来自[http://social.msdn.microsoft.com/forums/en-US/sqlreportingservices/thread/622dc981-4378-4331-b2fc-e377660464df/](http://social.msdn.microsoft.com/forums/en-US/sqlreportingservices/thread/622dc981-4378-4331-b2fc-e377660464df/)上的帖子）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T03:07:54.893

您是否升级了报告文件？RDL 规范在 2005 年和 2008 年之间发生了变化，如果您的目标是 2008，则需要确保您使用的是 2008 兼容工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-09T23:14:09.153

我让它与 2005 一起工作，为了使它工作，我必须更改数据源以使用 OLE DB 和 Sql Server Native Client 10.0。另一个奇怪的怪癖是数据源的名称中不能有空格。然后我不得不重新分配报告以使用没有空格的新数据源，然后 2005 rdl 在 2008 服务器上工作。

# javascript - CouchDB + Datamapper + View = 无 ID

> ID：373516
> 
> 赞同：1
> 
> 时间：2008-12-17T02:47:55.900
> 
> 标签：javascript, ruby, couchdb, datamapper

我正在使用 couchdbx v. 0.8.1 和 datamapper 0.9.8。我写了一些简单的视图，从其他示例中复制了一些。如果我用浏览器查询视图，它们会返回 id。如果我在 ruby​​ 中使用 datamapper 查询它们，我不会得到任何 id。我已经用谷歌搜索了好几天，一直在 IRC 上查看沙发和 datamapper 谷歌组。我试过降级我的datamapper和couchdb。没有什么。还有其他人遇到这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T10:22:48.433

I see that there is a couchdb adapter for datamapper (dm-couchdb-adapter), but I'm not familiar with it. Are you sure that you need to be using an ORM for accessing CouchDB? There are a few ruby libraries that may be better suited to accessing CouchDB, e.g. [CouchRest](http://github.com/jchris/couchrest/tree/master).

You should note that the Google group for CouchDB is now dead. You should try asking on the mailing list users@couchdb.apache.org. These are the archives: [Graduated](http://mail-archives.apache.org/mod_mbox/couchdb-user/); [Incubator](http://mail-archives.apache.org/mod_mbox/incubator-couchdb-user/) There are plenty of people there that have experience using CouchDB with Ruby and should be able to point you in the right direction.

# java - 如何在 java 中使用本地 HTTPS URL？

> ID：373518
> 
> 赞同：9
> 
> 时间：2008-12-17T02:48:22.530
> 
> 标签：java, https, certificate

使用 Java URL 类，我可以连接到外部`HTTPS`服务器（例如我们的生产站点），但是使用本地 URL 我得到以下异常。

```
"SunCertPathBuilderException: unable to find valid certification path to requested target". 
```

如何获得有效的认证路径？

编辑：我没有使用此 URL 直接创建连接，而是将 URL 传递给`itext` `PDFReader`，然后出现连接问题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-13T19:08:45.573

这是我的解决方案，它结合了该线程中的一些想法，并与来自网络的代码一起使用。我所做的只是调用这个函数，它为 HttpsURLConnection 设置了默认的信任管理器和主机名验证器。这对某些人来说可能是不可取的，因为它会影响所有 HttpsURLConnections，但我只是在编写一个简单的代理，所以它对我有用。

```
private void setTrustAllCerts() throws Exception
{
    TrustManager[] trustAllCerts = new TrustManager[]{
        new X509TrustManager() {
            public java.security.cert.X509Certificate[] getAcceptedIssuers() {
                return null;
            }
            public void checkClientTrusted( java.security.cert.X509Certificate[] certs, String authType ) { }
            public void checkServerTrusted( java.security.cert.X509Certificate[] certs, String authType ) { }
        }
    };

    // Install the all-trusting trust manager
    try {
        SSLContext sc = SSLContext.getInstance( "SSL" );
        sc.init( null, trustAllCerts, new java.security.SecureRandom() );
        HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
        HttpsURLConnection.setDefaultHostnameVerifier( 
            new HostnameVerifier() {
                public boolean verify(String urlHostName, SSLSession session) {
                    return true;
                }
            });
    }
    catch ( Exception e ) {
        //We can not recover from this exception.
        e.printStackTrace();
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T03:00:52.507

您可能需要设置一个[`HostnameVerifier`](http://java.sun.com/j2se/1.5.0/docs/api/javax/net/ssl/HostnameVerifier.html). 在连接之前，您需要将其添加到连接对象中

```
HttpsURLConnection conn = (HttpsURLConnection) url.openConnection();
conn.setHostnameVerifier(new HostnameVerifier() {
  public boolean verify(String hostname, SSLSession session) {
    // check hostname/session
    return true;
  }
});
conn.connect();
// read/write... 
```

如果您需要，肯定有一些实现。您可能还想查看[HttpClient](http://hc.apache.org/httpclient-3.x/)项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T07:06:17.533

要查看的另一件事是`TrustManager`您正在使用。该错误消息表明服务器提供的证书未由受信任的根签名。由于您无法直接控制所创建的 SSL 套接字，因此我认为最好的办法是使用已使用服务器证书链[的根 CA 设置的证书来](http://java.sun.com/javase/6/docs/api/javax/net/ssl/TrustManagerFactory.html#init(java.security.KeyStore))[初始化](http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLContext.html#init(javax.net.ssl.KeyManager[],%20javax.net.ssl.TrustManager[],%20java.security.SecureRandom))您自己`SSLContext`的套接字。然后将此上下文设置为[默认值](http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLContext.html#setDefault(javax.net.ssl.SSLContext))。`TrustManager`

这是假设您使用的是 Java 6。Java 5 中的 API 受到更多限制。您可以获得 default `SSLSocketFactory`，但没有标准的设置方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T02:56:01.687

它抱怨的问题是，当您创建 SSL 连接时，服务器必须向客户端提供有效的证书。您可以在 Java 中编写一个适当的端点（我认为 HTTPServerSocket 会这样做），但它需要一些黑客来设置它。使用可正确处理 SSL 的任何东西（Apache、lighttp 等）设置本地 Web 服务器可能更容易，并使用 openssl 工具创建自签名证书。

更新

这是 Java Almanac 中的一个示例。[http://www.exampledepot.com/egs/javax.net.ssl/Server.html](http://www.exampledepot.com/egs/javax.net.ssl/Server.html)

SSL 服务器套接字需要将发送给客户端进行身份验证的证书。证书必须包含在必须明确指定其位置的密钥库中（没有默认值）。在示例之后，我们将描述如何创建和指定要使用的 SSL 服务器套接字的密钥库。

```
try {
    int port = 443;
    ServerSocketFactory ssocketFactory = SSLServerSocketFactory.getDefault();
    ServerSocket ssocket = ssocketFactory.createServerSocket(port);

    // Listen for connections
    Socket socket = ssocket.accept();

    // Create streams to securely send and receive data to the client
    InputStream in = socket.getInputStream();
    OutputStream out = socket.getOutputStream();

    // Read from in and write to out...

    // Close the socket
    in.close();
    out.close();
} catch(IOException e) {
} 
```

使用 javax.net.ssl.keyStore 系统属性指定证书的密钥库：

```
> java -Djavax.net.ssl.keyStore=mySrvKeystore -Djavax.net.ssl.keyStorePassword=123456 MyServer 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T14:43:39.217

它还可以帮助您[使用“keytool”实用程序将 localhost 服务器正在使用的证书（我假设它是自签名的）添加到 JVM 的](http://docs.oracle.com/javase/7/docs/technotes/tools/solaris/keytool.html)[密钥库](http://mindprod.com/jgloss/keystore.html)中。这应该有告诉JVM“你可以信任这个证书”的效果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T23:55:59.790

我最终运行了一个静态方法（仅在 dev 上），它安装了一个非常信任的 TrustManager（接受所有内容），并且还添加了一个始终返回 true 的 hostnameVerifier（感谢[sblundy](https://stackoverflow.com/users/4893/sblundy)）。

# perl - 如何写出或读入 Perl 散列的数组？

> ID：373520
> 
> 赞同：4
> 
> 时间：2008-12-17T02:50:33.570
> 
> 标签：perl, arrays, hash

我在 Perl 中有一个程序，我正在研究需要多个键的地方，以及一种为每个键提供多个值的方法，然后根据是否读取它们并将它们写入外部文件key 匹配用户输入标准输入的内容。我浏览了几个站点，发现信息在读取数组的哈希值时有些有用，但不能将它们写出来，而且我还需要能够在外部文件中添加到数组中。

这可能吗？

编辑：有没有办法可以用初学者 Perl 来完成？我是初学者。数组的散列似乎是使其工作的最佳方法，但我真正需要的是一种方法来显示同一个键的多个值，同时只显示一次键。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-17T03:13:21.107

查看[Data::Dumper](http://search.cpan.org/~ilyam/Data-Dumper-2.121/)。

例如，这个微观脚本：

```
#!/bin/perl -w
use strict;
use Data::Dumper;

my(%hash);

$hash{key1} = [ 1, "b", "c" ];
$hash{key2} = [ 4.56, "g", "2008-12-16 19:10 -08:00" ];

print Dumper(\%hash); 
```

生成此输出，可以清楚地对其进行编辑：

```
$VAR1 = {
          'key2' => [
                      '4.56',
                      'g',
                      '2008-12-16 19:10 -08:00'
                    ],
          'key1' => [
                      1,
                      'b',
                      'c'
                    ]
        }; 
```

它也可以被评估以将数据读回程序。

* * *

扩展示例以显示读入和打印出...请注意，代码位于两个主要块中，块之间唯一的共同变量是文件名。

```
#!/bin/perl -w
use strict;
use Data::Dumper;
use FileHandle;

my $file = "data.out";

{
    my(%hash);

    $hash{key1} = [ 1, "b", "c" ];
    $hash{key2} = [ 4.56, "g", "2008-12-16 19:10 -08:00" ];

    my $str = Data::Dumper->Dump([ \%hash ], [ '$hashref' ]);
    print "Output: $str";

    my($out) = new FileHandle ">$file";
    print $out $str;
    close $out;
}

{
    my($in) = new FileHandle "<$file";
    local($/) = "";
    my($str) = <$in>;
    close $in;

    print "Input: $str";

    my($hashref);
    eval $str;
    my(%hash) = %$hashref;

    foreach my $key (sort keys %hash)
    {
        print "$key: @{$hash{$key}}\n";
    }
} 
```

该脚本的输出是：

```
Output: $hashref = {
         'key2' => [
                     '4.56',
                     'g',
                     '2008-12-16 19:10 -08:00'
                   ],
         'key1' => [
                     1,
                     'b',
                     'c'
                   ]
       };
Input: $hashref = {
         'key2' => [
                     '4.56',
                     'g',
                     '2008-12-16 19:10 -08:00'
                   ],
         'key1' => [
                     1,
                     'b',
                     'c'
                   ]
       };
key1: 1 b c
key2: 4.56 g 2008-12-16 19:10 -08:00 
```

* * *

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T15:29:54.863

既然您提到了存储和检索数据，我建议结合使用[Data::Dumper](http://search.cpan.org/~ilyam/Data-Dumper-2.121/Dumper.pm)和[Storable](http://search.cpan.org/~ams/Storable-2.18/Storable.pm)。例如：

```
use Data::Dumper;
use Storable;
my %test = (this => ['that', 'the', 'other'],
            that => ['this', 'the', 'other']
            ); 
```

Data::Dumper 是为最终用户显示此数据的好方法：

```
warn Dumper(\%test); 
```

但是对于存储和检索，Storable 使这变得非常容易：

```
# Save the hash to a file:
store \%test, 'file.txt';
# Retrieve the hash from the file.
my $testref = retrieve('file.txt'); 
```

检索后，您应该会发现自己拥有原始数据的 hashref。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T03:05:05.507

查看模块[XML::Simple](http://search.cpan.org/dist/XML-Simple/lib/XML/Simple.pm)。它有函数 XMLout 将任意项的散列转换为 XML，然后有一个函数 XMLin 执行相反的操作。

# ruby-on-rails - 从外部 ruby 脚本添加记录

> ID：373524
> 
> 赞同：2
> 
> 时间：2008-12-17T02:52:14.410
> 
> 标签：ruby-on-rails, ruby

从外部脚本向数据库添加记录的最佳方法是什么。我想使用 activerecord 但我不确定如何在 rails 目录结构之外这样做。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T03:30:07.050

您可以在 ruby​​ 中使用 activerecord。假设您已经安装了所需的数据库驱动程序。你可以做类似的事情

```
require 'activerecord'

ActiveRecord::Base.establish_connection(
  :adapter => 'your_database_adapter',
  :host => 'your_host',
  :username => 'username'
  :password => 'password',
  :port => 'port_number'
) 
```

建立数据库连接。由于您想将记录添加到数据库中，我假设架构已经存在。然后你只需做

```
class ModelName < ActiveRecord::Base
  has_many :modelz
end

class Modelz < ActiveRecord::Base
  belongs_to :model_name
end 
```

你已经准备好了。（没错，一旦建立数据库连接，您就可以使用活动记录在 Rails 中做任何事情，甚至在模型之间建立关系）您可以对刚刚创建的模型类的对象做任何您想做的事情。喜欢，

```
ModelName.find(:all)

@model = ModelName.new
@model.user_id = rand(10)
@model.save 
```

等等等等

如果您没有适当的架构，请不要惊慌。您可以在建立数据库连接后通过嵌入与以下类似的代码来创建它。

```
ActiveRecord::Schema.define do
  create_table :sometable do |table|
    table.integer :int1, :int2
    table.string :str1, :str2
  end

  create_table :yetanothertable do |table|
    table.integer :anotherint
    table.text :sometext
  end
end 
```

这应该可以正常工作。这里给出的代码是一个示例，在语法上可能并不完美。[这也应该有所帮助。](http://snippets.dzone.com/posts/show/3097)但是，模式定义是用旧的 rails 方式完成的。

# silverlight - silverlight：反射效果

> ID：373528
> 
> 赞同：1
> 
> 时间：2008-12-17T02:56:39.050
> 
> 标签：silverlight

我在 silverlight 中看到了使用 2 种方法中的 1 种实现效果的示例：

1.  两个图像对象，都显示相同的图像，但底部的一个将其旋转 180 度并应用渐变图像不透明度
2.  一个 MediaElement 对象和一个 VideoBrush 元素。

我有一系列路径对象、矩形等，我想对其应用反射效果。除了手动复制我的对象并旋转它们之外，还有更优雅的解决方案吗？不幸的是，VideoBrush 对象仅适用于 MediaElement 对象，但我还能使用其他东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T03:09:54.733

不是在 Silverlight 中，在 WPF 中你有一个 VisualBrush 可以帮助解决这个问题，但 Silverlight 在版本 2 中没有。不过要清楚一点，它不是旋转，它是 ScaleTransform 上的负 ScaleY。最简单的方法是将所有内容放入 UserControl，然后使用两个 UserControl，其中一个具有 ScaleTransform 和 OpacityMask。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T03:35:43.497

举一个很好的例子，请参阅 Mike Snow 的以下博客文章。

[http://silverlight.net/blogs/msnow/archive/2008/09/04/silverlight-tip-of-the-day-36-how-to-create-reflections-and-shadows-for-images-and-文本.aspx](http://silverlight.net/blogs/msnow/archive/2008/09/04/silverlight-tip-of-the-day-36-how-to-create-reflections-and-shadows-for-images-and-text.aspx)

# vb.net - 在运行时更改绑定数据集的连接字符串

> ID：373535
> 
> 赞同：0
> 
> 时间：2008-12-17T03:02:16.417
> 
> 标签：vb.net

是否可以在运行时更改绑定数据集的连接字符串？

我在我的笔记本电脑上创建了一个应用程序，我的连接的服务器主机是 localhost，但是当我将它部署到另一台计算机上时，我希望我的应用程序到驻留在另一台服务器中的数据库。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T03:07:25.737

如果您选择将连接字符串存储在设置文件中，这是可能的。您必须覆盖连接字符串的 getter。有关 C# 的完整说明，请参阅[此页面](http://www.csharpbydesign.com/2008/01/overriding-dataset-settings-co.html)。您应该能够采用相同的概念并将其移植到 VB。

# asp.net - 为什么 App_Offline 一开始加载 dll 就无法工作？

> ID：373540
> 
> 赞同：10
> 
> 时间：2008-12-17T03:06:05.850
> 
> 标签：asp.net, iis, app-offline.htm

谁能帮我解决这个问题。在生产站点 app_offline.htm 仅在您开始上传 dll 之前有效。一旦您开始上传 dll，它就会抛出以下错误“无法加载文件或程序集 'SubSonic' 或其依赖项之一。 **该进程无法访问该文件，因为它正在被另一个进程使用。** 现在这清楚地表明 IIS 仍在试图为 aspx 页面提供服务？？我在这里有什么遗漏吗？？任何帮助将不胜感激。我花了几个小时谷歌搜索，但无济于事。提前致谢。Manisha

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T21:23:43.397

我听说有人在 app_offline.htm 文件中没有足够的内容时会遇到问题。

用几百 kb 的 Lorem Ipsum 文本填充它，看看是否有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T03:23:51.070

好的，这可能不是您的问题，但如果这是第一次发生，您可能需要重新启动计算机。有时一个进程因 .dll 上的锁定而死，因此在解锁之前您不能再使用它（因此需要重新启动操作系统）。

另一个可能的问题是 .dll 或其依赖的 .dll 不在您的路径或正确的文件夹中。

先看看这两个。

# c# - 如何在 LINQ 中对单个连接中的多个字段进行连接

> ID：373541
> 
> 赞同：283
> 
> 时间：2008-12-17T03:06:43.553
> 
> 标签：c#, linq, join

我需要执行一个 LINQ2DataSet 查询，该查询对多个字段进行连接（如

```
var result = from x in entity
join y in entity2 
       on x.field1 = y.field1 
and 
          x.field2 = y.field2 
```

我还没有找到一个合适的解决方案（我可以将额外的约束添加到 where 子句，但这远非一个合适的解决方案，或者使用[这个](https://stackoverflow.com/questions/345427/linq-to-sql-join-multiple-columns-from-the-same-table)解决方案，但假设一个等值连接）。

在 LINQ 中是否可以在单个连接中连接多个字段？

**编辑**

```
var result = from x in entity
             join y in entity2
             on new { x.field1, x.field2 } equals new { y.field1, y.field2 } 
```

是我在上面假设等值连接时引用的解决方案。

进一步**编辑**

为了回答关于我的原始示例是等值连接的批评，我承认，我目前的要求是等值连接，并且我已经采用了上面提到的解决方案。

但是，我正在尝试了解我拥有/应该使用 LINQ 的可能性和最佳实践。我很快将需要使用表 ID 进行日期范围查询连接，并且只是先发制人，看起来我必须在 where 子句中添加日期范围。

一如既往地感谢您提供的所有建议和意见

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-12-17T03:11:02.780

```
var result = from x in entity
   join y in entity2 on new { x.field1, x.field2 } equals new { y.field1, y.field2 } 
```

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2014-10-13T22:01:55.920

```
var result = from x in entity1
             join y in entity2
             on new { X1= x.field1, X2= x.field2 } equals new { X1=y.field1, X2= y.field2 } 
```

如果两个实体中的列名不同，则需要执行此操作。

* * *

## 回答 #3

> 赞同：94
> 
> 时间：2008-12-17T06:32:32.360

匿名类型的解决方案应该可以正常工作。LINQ*只能*表示等值连接（无论如何都带有连接子句），实际上这就是您所说的，无论如何您都希望根据原始查询来表达。

如果您出于某种特定原因不喜欢匿名类型的版本，则应说明该原因。

如果您想做的不是您最初要求的事情，请举例说明您*真正*想做的事情。

编辑：回应问题中的编辑：是的，要进行“日期范围”连接，您需要改用 where 子句。它们在语义上实际上是等价的，所以这只是可用优化的问题。Equijoins 通过创建基于内部序列的查找来提供简单的优化（在 LINQ to Objects 中，其中包括 LINQ to DataSets） - 将其视为从键到与该键匹配的条目序列的哈希表。

使用日期范围执行此操作有些困难。但是，根据您所说的“日期范围连接”的确切含义，您可能可以做*类似*的事情- 如果您计划创建日期的“带”（例如每年一个），以便两个条目出现在同一年（但不是同一天）应该匹配，那么您只需使用该带作为键即可。如果它更复杂，例如连接的一侧提供一个范围，而连接的另一侧提供一个日期，如果它在该范围内匹配，则最好使用`where`子句处理（在一秒钟后`from`条款）IMO。您可以通过订购一侧或另一侧来更有效地找到匹配项来做一些特别时髦的魔法，但这将是很多工作 - 我只会在检查性能是否存在问题后才会做那种事情。

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2014-03-04T15:53:04.407

只需使用等效的方法链语法完成此操作：

```
entity.Join(entity2, x => new {x.Field1, x.Field2},
                     y => new {y.Field1, y.Field2}, (x, y) => x); 
```

而最后一个参数`(x, y) => x`是您选择的（在上述情况下，我们选择`x`）。

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2015-12-09T10:30:34.857

我认为一个更具可读性和灵活性的选择是使用 Where 函数：

```
var result = from x in entity1
             from y in entity2
                 .Where(y => y.field1 == x.field1 && y.field2 == x.field2) 
```

这也允许通过附加 .DefaultIfEmpty() 轻松地从内连接更改为左连接。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-08-22T05:08:16.793

```
var result = from x in entity
             join y in entity2
             on new { X1= x.field1, X2= x.field2 } equals new { X1=y.field1, X2= y.field2 }
             select new 
             {
               /// Columns
              }; 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-12-17T06:01:14.293

你可以做类似（下）的事情

```
var query = from p in context.T1

        join q in context.T2

        on

        new { p.Col1, p.Col2 }

        equals

         new { q.Col1, q.Col2 }

        select new {p...., q......}; 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-17T03:58:41.280

使用连接运算符，您只能执行等值连接。可以使用其他运算符构造其他类型的连接。我不确定您尝试使用这些方法或更改 where 子句是否更容易进行确切的连接。可以在[此处](http://msdn.microsoft.com/en-us/library/bb311040.aspx)找到有关 join 子句的文档。MSDN 有[一篇关于连接操作](http://msdn.microsoft.com/en-us/library/bb397908.aspx)的文章，其中包含指向其他连接示例的多个链接。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-12-02T02:56:08.690

如果实体中的字段名称不同

```
var result = from x in entity
   join y in entity2 on 
          new {
                field1=   x.field1,
               field2 =  x.field2 
             } 
          equals
         new { 
                field1= y.field1,
                field2=  y.myfield
              }
select new {x,y}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-04-16T09:41:58.067

作为一个完整的方法链，如下所示：

```
lista.SelectMany(a => listb.Where(xi => b.Id == a.Id && b.Total != a.Total),
                (a, b) => new ResultItem
                {
                    Id = a.Id,
                    ATotal = a.Total,
                    BTotal = b.Total
                }).ToList(); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-08-28T13:40:51.100

我使用元组来做到这一点，这是两列的示例：

```
 var list= list1.Join(list2,
                       e1 => (e1.val1,e1.val2),
                       e2 => (e2.val1,e2.val2),
                       (e1, e2) => e1).ToList(); 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-09-12T02:13:51.153

```
from d in db.CourseDispatches
                             join du in db.DispatchUsers on d.id equals du.dispatch_id
                             join u in db.Users on du.user_id equals u.id
                             join fr in db.Forumreports on (d.course_id + '_' + du.user_id)  equals  (fr.course_id + '_'+ fr.uid) 
```

这对我有用

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2017-09-01T19:22:29.103

声明一个 Class(Type) 来保存你想要加入的元素。在下面的示例中声明**JoinElement**

```
 public class **JoinElement**
{
    public int? Id { get; set; }
    public string Name { get; set; }

}

results = from course in courseQueryable.AsQueryable()
                  join agency in agencyQueryable.AsQueryable()
                   on new **JoinElement**() { Id = course.CourseAgencyId, Name = course.CourseDeveloper } 
                   equals new **JoinElement**() { Id = agency.CourseAgencyId, Name = "D" } into temp1 
```

# silverlight - 如何使用 Silverlight 检查缓存中的图像

> ID：373570
> 
> 赞同：2
> 
> 时间：2008-12-17T03:27:18.707
> 
> 标签：silverlight, caching

我正在使用 Silverlight 创建一个基本的图像浏览应用程序。根据用户的连接速度，某些图像在单击缩略图后可能需要一些时间才能显示。我想在下载时显示一个进度条。我已经完成了这部分。

但是，如果图像已经在缓存中（查看以前的图像），我宁愿不要让进度条闪烁然后消失。有没有办法在显示进度条之前查看特定文件是否在缓存中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T03:48:51.410

想了一会儿，我确实想出了一个解决方案，虽然这不是我原本打算的。

我正在使用 WebClient 类来获取我的图像文件。我附加到 DownloadProgressChanged 事件。如果图像已经下载，则 ProgressPercentage 立即为 100。

因此，我没有在调用 OpenReadAsync 时使 ProgressBar 可见并在触发 Completed 事件时使其不可见，而是在 DownloadProgressChanged 事件处理程序中设置可见性。

# sql-server - 几何列：STGeomFromText 和 SRID（什么是 SRID？）

> ID：373589
> 
> 赞同：28
> 
> 时间：2008-12-17T03:37:52.710
> 
> 标签：sql-server, sql-server-2008, geometry

我正在使用 SQL Server 2008 中的新地理列和 STGeomFromText 函数。这是我的代码（适用于 AdventureWorks2008）

```
DECLARE @region geography;
set @region = geography::STGeomFromText('POLYGON((
        -80.0 50.0, -90.0 50.0,
        -90.0 25.0, -80.0 25.0,
        -80.0 50.0))', 4326);

SELECT @region; 
```

我的问题是关于代码中的 4326 。它应该是一个空间参考 ID。当我去 MSDN 时，它并没有太多内容。如果我将值更改为 56，我会收到一条错误消息，告诉我该值必须在 sys.spatial_reference_systems 表中。

您可以通过执行以下命令查看该表：

```
select * from sys.spatial_reference_systems 
```

该表中有一个 well_known_text 列，但它并没有告诉我太多。4326 的值为：

```
GEOGCS["WGS 84", DATUM["World Geodetic System 1984", ELLIPSOID["WGS 84", 6378137, 298.257223563]], PRIMEM["Greenwich", 0], UNIT["Degree", 0.0174532925199433]] 
```

谁能给我解释一下这个谜？什么是 SRID？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-18T19:33:06.777

所以我昨天最后和一个前军人交谈，他是一名雷达/测绘专家。基本上，他确切地知道那个数字（4326）是什么，它来自哪里，以及它为什么在那里。

它是计算地理的行业标准。问题是地球不是一个完美的球体（它在中间凸出），而 SRID 4326 说明了这一点。

正如我所说，表 sys.spatial_reference_systems 列出了所有代码及其内容。但简短的版本是你真的只会使用 4326 除非你有一个非常具体的理由来使用不同的东西。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-17T13:03:17.080

[SRID = 空间参考标识符](http://en.wikipedia.org/wiki/SRID)

坐标必须使用相同的 SRID 才能进行比较。否则你最终会比较公里和英里。或类似的东西。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-01T18:21:35.377

有很多系统可以绘制地球地图。例如，您想映射美国的某个州。您可以将最东南点设置为 0,0，并根据该点映射所有其他空间坐标。另一方面，您可能想要映射一些跨越整个地图的空间数据。在任何情况下，您都必须选择某个点作为 0,0。此外，您必须选择某种测量单位：英里/公里/度/其他更适合您的神奇单位。多年来，开发了许多这样的系统。每个都有自己的零点，自己的坐标，关于地球是否平坦的规则。SRID 或 SRS 是此类系统的 id。使用此 id，您可以将一个系统中表示的点映射到另一个系统，尽管有时它涉及一些非常复杂的数学。

大约 4326 SRID。它也称为“WGS 84”（[http://en.wikipedia.org/wiki/World_Geodetic_System](http://en.wikipedia.org/wiki/World_Geodetic_System)）系统。这是表示球形（非平面）地球上的点的最常见系统。它使用度、分、秒表示法，其 x 和 y 坐标通常称为纬度和经度。

最常用的非球面地球投影称为 UTM。你可以在这里阅读：[http ://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system](http://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system)

无论如何，只要您没有从一个系统到另一个系统进行任何空间转换，您就不会真正关心您的数据使用的系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-28T04:44:47.753

我发现这个网站：[http](http://spatialreference.org/ref/epsg/4326/) ://spatialreference.org/ref/epsg/4326/非常有助于理解您打算使用的 SRID。它提供了一个方便的地图、一些边界框信息和其他链接。

对于其他 SRID，只需将 URL 末尾的数字更改为您想要的数字。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-25T14:19:53.113

返回的距离取决于您为地理类型定义的[“空间参考标识符 (SRID)” 。](http://technet.microsoft.com/en-us/library/bb964707.aspx)

在下面的示例中，使用了 4336的默认[SRID ，请参见](http://technet.microsoft.com/en-us/library/bb964707.aspx)[STGeomFromText](http://msdn.microsoft.com/en-us/library/bb933823.aspx)的第二个参数。这意味着返回的距离以米为单位，您可以通过查询目录视图[spatial_reference_systems](http://technet.microsoft.com/en-us/library/bb964707.aspx)来找到它，即`select srs.unit_of_measure from sys.spatial_reference_systems as srs where srs.spatial_reference_id = 4326`

作为[STGeomFromText](http://msdn.microsoft.com/en-us/library/bb933823.aspx)的替代方法，您可以使用[parse](http://msdn.microsoft.com/en-us/library/bb933824.aspx)，它假定[SRID](http://technet.microsoft.com/en-us/library/bb964707.aspx)为 4326，您不必明确指定一个。

计算两点之间的距离时，您必须对两种地理类型使用相同的[SRID](http://technet.microsoft.com/en-us/library/bb964707.aspx)，否则会出错。例子：

```
DECLARE @address1 GEOGRAPHY
DECLARE @address2 GEOGRAPHY
DECLARE @distance float
SET @address1 = GEOGRAPHY::STGeomFromText ('point(53.046908 -2.991673)',4326)
SET @address2 = GEOGRAPHY::STGeomFromText ('point(51.500152 -0.126236)',4326)
SET @distance = @address1.STDistance(@address2)
SELECT @distance --this is the distance in meters 
```

# language-agnostic - 什么时候使用调解器设计模式

> ID：373598
> 
> 赞同：14
> 
> 时间：2008-12-17T03:46:01.633
> 
> 标签：language-agnostic, design-patterns, mediator

正如标题所述，您何时会推荐使用[中介者设计模式](http://en.wikipedia.org/wiki/Mediator_pattern)，您认为它在哪里使用不正确？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-17T04:04:31.097

**当对象通信的复杂性**开始**阻碍对象的可重用性**时，使用中介。这种类型的复杂性经常出现在视图实例中，尽​​管它实际上可能在任何地方。

误用调解器可能会破坏调解器的同事类的接口。

谈论滥用模式似乎有点有趣。如果您的实现遵循该模式，那么您已经使用了该模式。否则，你没有。换句话说，如果您的调解员正在做其他事情，那么它可能不是调解员。模式是由它们所做的，它们实际上是什么来定义的。事物的名称只是标签。

要问自己的真正问题是，您对模式的实现是否实现了该模式对您的设计的承诺。中介者模式旨在在复杂的对象间通信变得难以管理时对其进行封装。如果它没有做到这一点，或者没有做得很好，你可以说中介被滥用了。在某些时候，它变成了一种价值判断。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T03:59:46.943

我用它来处理摇摆应用程序。

当我构建一个 GUI 时，我不喜欢每个控件相互了解，因为这需要子类化。

相反，我有一个包含侦听器和小部件的 Main 对象，并让它在不同的控件、按钮、文本字段等之间进行调解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T04:37:46.070

中介也基本上是事件泵。GUI 和游戏中非常常见的模式。

此外，我之前使用过调解器在非常不同的系统和遗留框架之间进行通信。

# asp.net-mvc - 如何传递特殊字符以便 ASP.NET MVC 可以正确处理查询字符串数据？

> ID：373599
> 
> 赞同：15
> 
> 时间：2008-12-17T03:46:44.380
> 
> 标签：asp.net-mvc

我正在使用这样的路线：

```
routes.MapRoute("Invoice-New-NewCustomer",
    "Invoice/New/Customer/New/{*name}",
    new { controller = "Customer", action = "NewInvoice" },
    new { name = @"[^\.]*" }); 
```

有一个动作可以处理这条路线：

```
public ActionResult NewInvoice(string name)
{
    AddClientSideValidation();
    CustomerViewData viewData = GetNewViewData();
    viewData.InvoiceId = "0";
    viewData.Customer.Name = name;
    return View("New", viewData);
} 
```

当我调用`return RedirectToAction("NewInvoice", "Customer", new {name});`并且 name 等于“The C# Guy”时，“name”参数被截断为“The C”。

所以我的问题是：用 ASP.NET MVC 处理这种特殊字符的最佳方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-31T19:07:36.050

好的，不幸的是，我确认这是ASP.NET 路由中*的*一个已知问题。问题在于，在路由的深处，我们在转义 Uri 的路由参数时使用了 Uri.EscapeString。但是，该方法不会转义“#”字符。

请注意，# 字符（又名 Octothorpe）在技术上是错误的字符。C♯该语言实际上是一个“C”，后跟一个夏普符号，如音乐：[http://en.wikipedia.org/wiki/Sharp_(music)](http://en.wikipedia.org/wiki/Sharp_(music))

如果您使用尖锐的标志，那可能会解决这个问题。:P

另一个解决方案，因为大多数人都想使用八叉树，是为此路由编写一个自定义路由，并在获得虚拟路径路径后，使用将 # 编码为 %23 的 HttpUtility.UrlEncode 对 # 符号进行编码。

作为后续，我想向您指出这篇博客文章，其中讨论了传递其他“无效”字符。[http://haacked.com/archive/2010/04/29/allowing-reserved-filenames-in-URLs.aspx](http://haacked.com/archive/2010/04/29/allowing-reserved-filenames-in-URLs.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T04:16:06.520

网址编码！更改链接，使其对特殊字符进行编码。

```
Server.URLencode(strURL) 
```

C# 将变为“c%23”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T19:23:53.270

在我的机器上工作。这是我为创建最简单的示例所做的工作。

```
//Global.asax.cs

using System.Web.Mvc;
using System.Web.Routing;

namespace MvcApplication4 {
  public class MvcApplication : System.Web.HttpApplication {
    public static void RegisterRoutes(RouteCollection routes) {
      routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

      routes.MapRoute(
        "Default",                        // Route name
        "{controller}/{action}/{id}",               // URL with parameters
        new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
      );

      routes.MapRoute("Invoice-New-NewCustomer",
            "Invoice/New/Customer/New/{*name}",
            new { controller = "Customer", action = "NewInvoice" },
            new { name = @"[^\.]*" });
    }

    protected void Application_Start() {
      RegisterRoutes(RouteTable.Routes);
    }
  }
}

//HomeController.cs
using System.Web.Mvc;

namespace MvcApplication4.Controllers {
  [HandleError]
  public class HomeController : Controller {
    public ActionResult Index() {
      return RedirectToAction("NewInvoice", "Customer", new { name = "The C# Guy" });
    }
  }
}

//CustomerController.cs
using System.Web.Mvc;

namespace MvcApplication4.Controllers {
    public class CustomerController : Controller {
        public string NewInvoice(string name) {
            return name;
        }
    }
} 
```

然后我启动了我的应用程序并导航到 /home/index。重定向发生了，我在浏览器中看到了“The C# Guy”。

# c# - 如何在 ASP.NET 和 C# 中加载下拉列表？

> ID：373605
> 
> 赞同：8
> 
> 时间：2008-12-17T03:49:27.540
> 
> 标签：c#, asp.net

如何在 asp.net 和 c# 中加载下拉列表？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-17T03:55:51.130

您也可以以声明方式执行此操作：

```
<asp:DropDownList runat="server" ID="yourDDL">
    <asp:ListItem Text="Add something" Value="theValue" />
</asp:DropDownList> 
```

您还可以对它们进行数据绑定：

```
yourDDL.DataSource = YourIEnumberableObject;
yourDDL.DataBind(); 
```

编辑：如评论中所述，您还可以以编程方式添加项目：

```
yourDDL.Items.Add(YourSelectListItem); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T05:02:45.660

使用 Gortok 的示例，您还可以将列表数据绑定到下拉列表

```
List<Employee> ListOfEmployees = New List<Employees>();

DropDownList DropDownList1 = new DropDownList();

DropDownList1.DataSource = ListOfEmployees ;
DropDownList1.DataTextField = "TextFieldToBeDisplayed";
DropDownList1.DataValueField = "ValueFieldForLookup";

DropDownList1.DataBind(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T03:52:08.080

哇...相当快到那里...

`DropDownLists`有一个项目集合，您调用该集合的 Add 方法。

```
DropDownList1.Items.Add( "what you are adding" ); 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-17T03:58:13.187

如果你有一个员工对象的集合，你可以像这样添加它们：

```
List<Employee> ListOfEmployees = New List<Employees>();

DropDownList DropDownList1 = new DropDownList();

foreach (Employee employee in ListOfEmployees) {
DropDownList1.Items.Add(employee.Name);
} 
```

# javascript - 在 MVC 中防止循环事件的优雅方法？

> ID：373615
> 
> 赞同：7
> 
> 时间：2008-12-17T03:58:02.703
> 
> 标签：javascript, model-view-controller, design-patterns, event-handling

**这个问题，简而言之：**

在 MVC 中，您如何区分复选框单击（或选择框或列表框更改）与人类含义“控制器，修改模型”，以及复选框单击（或选择框或列表框更改）与控制器含义“我”我更新视图，因为模型已经改变”？

* * *

**这个例子：**

我有一个 JS 应用程序（都是一个大的 HTML+JS 页面；它后面有一个服务器，并且 AJAX 正在运行，但这对示例并不重要）它具有由“边缘”连接的“顶点”的概念。UI 允许您在地图上添加和删除顶点，并启用或禁用顶点对之间的边。

有两种方法可以禁用从顶点 A 到顶点 B 的边：

1.  单击边缘，使“边缘详细信息”窗口为您提供“禁用此边缘”按钮；或者
2.  单击顶点 A（或 B）以使“顶点详细信息”窗口为您提供附近顶点的清单，您可以从中取消选中顶点 B（或 A）。

以下是 MVC 的底层工作原理（*但请参阅这篇文章的末尾以获取更新，我在其中纠正了我理解的问题*）：

*   模型：顶点对象列表和边对象列表。
*   视图：一个 GMaps UI，带有标记和折线，加上复选框和按钮以及“顶点详细信息”和“边缘详细信息”DIV。
*   控制器：
    *   当复选框和按钮上的事件触发时更新模型的 JS 函数；和
    *   当模型上的事件触发时更新视图的 JS 函数。

**这是具体的不雅**：

1.  用户将 Vertex Details Window 聚焦在 Vertex A 上，Edge Details Window 聚焦在从 Vertex A 到 Vertex B 的边上。
2.  用户在边缘详细信息窗口中单击“禁用此边缘”。
3.  控制器函数 1 获取点击事件，并在 Edge 模型对象上调用 disable()。
4.  Edge 模型对象触发“我刚刚被禁用”事件。
5.  控制器功能 2 收到“我刚刚被禁用”事件，并且
    1.  重新绘制边缘详细信息窗口以显示“我已禁用！” 和
    2.  **在顶点详细信息窗口中取消选中顶点 B。**
        1.  **废话！**这会再次触发控制器功能 1，它正在侦听意味着边缘被禁用的 UI 事件！

所以有一个不必要的模型的重新更新，以及视图的重新更新。在更复杂的视图中，事件触发事件触发事件，这可能会导致数十个无关更新！

* * *

**更新：一个很好的答案。**

我有点误解了 MVC。如上所述，我不只有一个视图：我有几个视图到几个模型中。特别是，我有一个特定节点的边缘复选框列表视图，以及一个单独的“详细窗口样式”边缘视图。

此外，我不应该让一个控制器函数在模型更改时更新所有视图：每个视图都应该在模型更改时*自行*修改。

因此，如果每个视图都在模型上注册“状态更新”事件，并且每个视图在收到这些事件后自行更新，那么我的循环事件问题的答案就是：

**复选框列表视图将在模型状态更改后更新复选框时禁用复选框事件。**

现在，如果用户通过 Edge Detail 窗口禁用 Edge，Controller 会更新 Edge Model，checkbox-list View 会收到更新通知，并且 checkbox-list View 足够聪明，可以在更改状态的同时使复选框事件静音适当的复选框。

这比我原来的解决方案更可口，其中一个控制器更新所有视图——因此必须知道哪些视图需要特别注意和馈送以避免循环。相反，只有带有麻烦的 UI 元素的单个 View 必须处理该问题。

感谢那些回答我问题的人！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-18T09:25:04.600

只是回顾一下 MVC 模型。视图通常应自行更新。它是这样工作的：控制器更改模型的状态，模型向其视图发送更新，视图从模型中拉入新状态并更新自己。虽然控制器和视图通常是捆绑在一起的（即在图形表示中向下钻取数据），但它们永远不应该直接交互，只能通过模型​​进行交互。这当然是一般的。

所以更新视图的 JS 函数实际上并不是控制器，这是一个重要的区别。它们应该被视为您观点的一部分。这可能对手头的问题没有帮助，但我认为值得指出。

您也不能删除您的模型，我假设您的意思是您正在*从*模型中删除某些内容，因为如果没有模型支持，则实际上没有视图或控制器可以存在（或处于功能状态）。

不是 JS 代码骑师，也没有使用过 gmap，我真的不明白问题出在哪里。更改复选框（选中属性）的状态是否会触发 onClick() 事件？它真的不应该恕我直言，但也许他们以这种方式实现了它，否则您可以将控制器附加到 onClick() 并向复选框添加一些逻辑（或者，这是 JS，在某处的函数中）以更改复选框状态. 如果这不可能，选项 1 和 2 绝对是您最好的选择。

## 另外：用户与视图交互

那么当用户想要与视图交互时会发生什么？通常，一个小部件将同时包含视图和控制器。复选框有一个视图（您可以查看它是否被选中）和一个控制器（您可以单击它）。当您单击复选框时，原则上应发生以下情况：

*   复选框控制器接收事件
*   复选框控制器更改此复选框在模型中表示的值的状态
*   模型更新监听器（包括复选框）
*   复选框更新其外观以反映该值已更改

第一步，控制器如何接收事件在某种程度上取决于语言，但在 OOP 语言中，它可能是附加到此特定小部件上的用户界面事件的侦听器对象，该小部件要么是控制器，要么通知控制器用户交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T18:53:55.047

这是困难的一个。如果我理解正确，问题的产生是因为您在模型上公开了点击处理程序，并且模型的点击事件被控制器捕获。控制器更新视图，然后切换相同的事件。

从我的角度来看，我认为控制器将自己附加到 Edge 的 Click 事件是不合适的，因为它暴露了太多关于 Edge 如何实现和使用的细节。控制器不关心 Edge 的使用方式或任何其他实现细节。

事实上，规范的 MVC 风格根本不需要控制器挂钩*任何*模型事件，通常是因为模型的状态不会被视图或任何其他控制器改变。模型不需要通知控制器它已被更改。

要解决您的问题，您应该将 View 的接口定义为具有单一方法，例如 ToggleEdge：

```
 public interface GraphView
{
    event Action ToggleEdge;
} 
```

很想创建两个方法，EdgeClicked 和 CheckboxClicked，但坚持这样的两个独立方法违反了封装原则。它向您的 Controller 或任何其他想要挂钩这些事件的人公开了太多的实现细节。请记住，Controller 只关心 View 的状态是否发生了变化，而不关心它是*如何*变化的。

在用户界面上实现 View 界面时，应注意确保从*一个*位置调用 ToggleEdge 事件。您可以通过在视图中挂钩 Edge.Clicked 事件并使用它来切换您的复选框来做到这一点；这使您的复选框负责将 Toggle vent 提升到控制器：

```
 public class UI : UserControl, GraphView
{
    public event Action ToggleEdge;

    void OnToggleEdge(Edge edge)
    {
        if (ToggleEdge != null)
            ToggleEdge(edge);
    }

    protected void Edge_Clicked(object sender, EventArgs e)
    {
        CheckBox chkbox = FindCheckBoxThatCorrespondsToEdge((Edge)sender);
        chkbox.Checked = !chkbox.Checked;    
    }

    protected void chkEdge_CheckChanged(object sender, EventArgs e)
    {
        Edge edge = FindEdgeThatCorrespondsToCheckbox((CheckBox)sender);
        OnToggleEdge(edge);
    }
} 
```

您可以说 View 现在对其实现了解太多了：它知道边缘和复选框从根本上是相连的。也许这是另一个 hack，但它可能会被忽略，因为“UI 逻辑”需要保持 View 的显示同步。

# database - 如何设计一个数据库来存储随时间的变化？

> ID：373623
> 
> 赞同：3
> 
> 时间：2008-12-17T04:04:13.813
> 
> 标签：database, database-design

该数据库将存储孩子的列表。但问题是，他们将每天测量一次体重。如何存储更改，以便轻松查询它们的实际重量以及一天、一周和一个月的重量变化？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T04:10:11.507

我会想到以下内容：

```
table kid
    int pkey(id)
    text name

table weight
    date when
    int kidid fkey(kid.id)
    int weight
    int pkey(id) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T04:11:06.357

您需要“子”表和“权重”表之间的一对多关系。

```
Child Table
-----------
ID (Generated) (PK)
Name 

WeightTable
-----------
ID (Generated) (PK)
Date
Weight
ChildID (FK) 
```

这里已经很晚了，我想我让它变得比我需要的更复杂；而且我有理由确定您可以在孩子和体重之间进行一对多。每次给孩子称重时，都要重新输入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T04:30:11.733

您可能还想设置一些仅显示当前权重的视图（基本存储的选择操作），或其他常见查询的视图，从而将实现与用户隔离。

现在，如果这是我，并且我有大量的孩子要跟踪，我可能会保留一个缓存表，其中包含频繁查询的结果，但这可能有点矫枉过正。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T04:11:08.807

两张桌子。第一个，比如说孩子，应该有一个 id 列和每个孩子的信息，比如名字、年龄等。第二个应该叫做 childrenweights。每行包含三件事。children 表中孩子的 id、体重和测量时间。然后你可以使用 sql 查询 children_weights 表来选择一个孩子的权重范围，比如从 1 月 1 日开始到 1 月 8 日结束，然后对它们做任何事情。或者您甚至可以让 sql 查询只返回其平均值或总和。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T04:52:30.503

## 子表

ID（生成）（PK）

文字名称

浮动初始重量

## 重量表

ID（生成）（PK）

日期 日期

浮动 ChangeInWeight

ChildID (FK Child.ID)

* * *

仅在 ChangeInWeight <> 0 时存储。

使用 WeightTable 关系中的日期范围查询 Sum(ChangeInWeight) 以查找变体，并将上述 IntitalWeight + Variation 查询为 Actualweight。

# configuration - 用于应用程序配置的单例

> ID：373626
> 
> 赞同：31
> 
> 时间：2008-12-17T04:06:33.683
> 
> 标签：configuration, singleton

到目前为止，在我的所有项目中，我都使用单例模式来访问整个应用程序中的应用程序配置。最近我看到很多关于不使用单例模式的文章，因为这种模式不提高可测试性，而且它隐藏了组件依赖。我的问题是存储应用程序配置的最佳方式是什么，它可以在整个应用程序中轻松访问，而无需在整个应用程序中传递配置对象？

提前致谢

马杜

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-17T04:19:11.707

我认为应用程序配置是单例模式的一个很好的使用。我倾向于自己使用它来避免每次我想访问它时都必须重新读取配置，因为我喜欢让配置成为强类型（即，不必每次都转换非字符串值）。我通常在我的 Singleton 中构建一些后门方法以支持可测试性——即注入 XML 配置的能力，以便我可以在测试中设置它，以及销毁 Singleton 以便在需要时重新创建它的能力。通常这些是我通过反射访问的私有方法，因此它们对公共接口隐藏。

**编辑**我们生活和学习。虽然我认为应用程序配置是使用 Singleton 的少数几个地方之一，但我不再这样做了。`Lazy<T>`通常，现在，我将使用配置属性的静态支持字段创建接口和标准类实现。这使我能够为每个属性提供“初始化一次”行为，并具有更好的可测试性设计。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-18T22:32:28.350

使用依赖注入将单个配置对象注入到任何需要它的类中。通过这种方式，您可以使用模拟配置进行测试或任何您想要的......您不会明确地出去并获得需要使用配置文件初始化的东西。使用依赖注入，您也不会传递对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T04:19:41.927

对于这种特定情况，我将创建一个配置对象并将其传递给需要它的人。

由于它是配置，它应该只在应用程序的某些部分使用，不一定应该是无所不在的。

但是，如果您在使用它们时没有遇到任何问题，并且不想那么努力地对其进行测试，那么您应该像今天一样继续使用它们。

阅读关于为什么它们被认为是有害的讨论。我认为大多数问题出现在单身人士持有大量资源时。

对于应用程序配置，我认为保持原样是安全的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T02:34:02.390

单例模式似乎是要走的路。这是我写的一个对我很有效的[`Setting`类。](https://stackoverflow.com/questions/577782/where-to-store-configuration-information/597835#597835)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-18T12:18:00.643

如果任何组件依赖于可以在运行时更改的配置（例如小部件的主题支持），您需要提供一些回调或信号机制来通知更改的配置。这就是为什么在创建时仅将所需的参数传递给组件（如颜色）是不够的。您还需要从组件内部提供对配置的访问（将完整的配置传递给组件），或者创建一个组件工厂来存储对配置及其所有创建的组件的引用，以便最终应用更改。

前者有一个很大的缺点，它会使构造函数混乱或破坏界面，尽管它可能是原型设计最快的。如果您考虑“得墨忒耳定律”，这是一个很大的否定，因为它违反了封装。后者的优点是组件保持其特定的接口，组件只取它们需要的东西，并且作为奖励，为您提供了重构的中心位置（工厂）。从长远来看，代码维护可能会受益于工厂模式。

此外，即使工厂是单例，它也可能在比配置单例少得多的地方使用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-03-04T19:43:29.030

这是使用[Castale.Core >> DictionaryAdapter 和 StructureMap完成的示例](http://www.gears4.net/blog/archive/3/application-configuration)

# language-agnostic - 设计模式滥用的例子

> ID：373636
> 
> 赞同：1
> 
> 时间：2008-12-17T04:11:31.723
> 
> 标签：language-agnostic, design-patterns

设计模式很棒，因为它们将一种潜在的复杂技术提炼成惯用的东西。通常只是它有一个名字这一事实有助于沟通和理解。

缺点是更容易尝试将它们用作灵丹妙药，将它们应用于每种情况而无需考虑其背后的动机，并花点时间考虑给定模式是否真的适合这种情况。

与[这个问题](https://stackoverflow.com/questions/251778/misused-design-patterns)不同，我不是在寻找*经常*被滥用的设计模式，但我希望看到一些真正可靠的设计模式被滥用的例子。我正在寻找有人“错过了重点”并应用了错误的模式，甚至实施得很糟糕的情况。

重点是我希望能够强调设计模式不是禁用批判性分析的借口。另外，我想强调不仅要了解模式是什么，还要*了解**为什么*它们通常是一种好方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T04:33:54.737

我有一个我维护的应用程序，它使用提供者模式来处理几乎所有事情——几乎不需要。多层次的继承也是如此。例如，有一个由抽象 BaseDataProvider 实现的数据提供者接口，而后者又由 SqlDataProvider 扩展。在每个层次结构中，每种类型只有一个具体实现。显然，开发人员获得了一份关于实现企业架构的 Microsoft 文档，并且由于很多人使用这个应用程序，因此决定它需要所有的灵活性来支持多个数据库、多个企业目录和多个日历系统，即使我们只使用 MS SQL Server 、Active Directory 和 Exchange。

最重要的是，凭据、url 和路径等配置项在所有地方都进行了硬编码，并覆盖了通过参数传递给更抽象类的数据。更改此应用程序很像在毛衣上拉线。你拉得越多，事情就会变得越复杂，最终你会改变整个代码来做一些应该很简单的事情。

我正在慢慢地重写它——部分是因为代码很糟糕，部分是因为它实际上是三个应用程序合二为一，甚至根本不需要其中一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T04:38:28.003

嗯，分享一点经验。在 C# 中，我有一个非常酷的设计，它使用了很多模式。我真的使用了很多模式，所以为了让故事简短，我不会一一列举。但是，当我用真实数据进行实际测试时，10^6 个对象并没有用我漂亮的设计“顺利运行”。通过分析它，我只是看到所有那些很好的多态类、代理等的间接级别都太多了。所以我想我可以用更好的模式重写它以提高效率，但我没有时间，所以我实际上在程序上破解了它，直到现在，好吧，它的工作方式更好......叹息，悲伤的故事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T15:00:05.830

我见过一个 asp.net 应用程序，其中（当时初级，现在相当有能力）开发人员设法有效地使他的代码隐藏单身人士认为每个页面都是独一无二的，这在他的本地机器上工作得非常出色，直到测试人员为之奋斗控制登录屏幕。

纯粹是对“独特”范围的误解和渴望使用这些设计模式的东西。

# python - 在 Paramiko 中运行交互式命令

> ID：373639
> 
> 赞同：47
> 
> 时间：2008-12-17T04:16:02.090
> 
> 标签：python, ssh, paramiko

我正在尝试通过 paramiko 运行交互式命令。cmd 执行尝试提示输入密码，但我不知道如何通过 paramiko 的 exec_command 提供密码并且执行挂起。如果 cmd 执行需要交互输入，有没有办法将值发送到终端？

```
ssh = paramiko.SSHClient()
ssh.connect(server, username=username, password=password)
ssh_stdin, ssh_stdout, ssh_stderr = ssh.exec_command("psql -U factory -d factory -f /tmp/data.sql") 
```

有谁知道如何解决这个问题？谢谢你。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-17T07:12:19.363

完整的 paramiko 发行版附带了很多很好的[演示](https://github.com/paramiko/paramiko/tree/master/demos)。

在 demos 子目录中，`demo.py`并`interactive.py`有完整的交互式 TTY 示例，这可能对您的情况来说太过分了。

在上面的示例中，`ssh_stdin`它就像一个标准的 Python 文件对象，`ssh_stdin.write`所以只要通道仍然打开就应该可以工作。

我从来不需要写信给标准输入，但文档建议一旦命令退出通道就会关闭，因此使用标准`stdin.write`方法发送密码可能不起作用。通道本身有较低级别的 paramiko 命令，可为您提供更多控制 - 请查看该[`SSHClient.exec_command`](http://docs.paramiko.org/en/2.4/api/client.html#paramiko.client.SSHClient.exec_command)方法是如何实现所有血腥细节的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-09-14T19:58:35.053

[我在尝试使用ssh](https://github.com/bitprophet/ssh/)（Paramiko 的一个分支）进行交互式 ssh 会话时遇到了同样的问题。

我翻遍了，发现了这篇文章：

**更新链接**（链接生成 404 之前的最后一个版本）：[http ://web.archive.org/web/20170912043432/http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely -不同的/](http://web.archive.org/web/20170912043432/http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/)

要继续您的示例，您可以这样做

```
ssh_stdin, ssh_stdout, ssh_stderr = ssh.exec_command("psql -U factory -d factory -f /tmp/data.sql")
ssh_stdin.write('password\n')
ssh_stdin.flush()
output = ssh_stdout.read() 
```

这篇文章更深入，描述了一个围绕 exec_command 的完全交互式的 shell。我发现这比源代码中的示例更容易使用。

**原文链接**：http: [//jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/](http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-06-22T18:51:33.310

您需要 Pexpect 来获得两全其美的效果（expect 和 ssh 包装器）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-09-28T07:39:47.537

```
ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh.connect(server_IP,22,username, password)

stdin, stdout, stderr = ssh.exec_command('/Users/lteue/Downloads/uecontrol-CXC_173_6456-R32A01/uecontrol.sh -host localhost ')
alldata = ""
while not stdout.channel.exit_status_ready():
   solo_line = ""        
   # Print stdout data when available
   if stdout.channel.recv_ready():
      # Retrieve the first 1024 bytes
      solo_line = stdout.channel.recv(1024) 
      alldata += solo_line
   if(cmp(solo_line,'uec> ') ==0 ):    #Change Conditionals to your code here  
     if num_of_input == 0 :
      data_buffer = ""    
      for cmd in commandList :
       #print cmd
       stdin.channel.send(cmd)        # send input commmand 1
      num_of_input += 1
     if num_of_input == 1 :
      stdin.channel.send('q \n')      # send input commmand 2 , in my code is exit the interactive session, the connect will close.
      num_of_input += 1 
print alldata
ssh.close() 
```

如果直接使用而不检查 stdout.channel.recv_ready(): 为什么 stdout.read() 会挂起，而 stdout.channel.exit_status_ready():

就我而言，在远程服务器上运行命令后，会话正在等待用户输入，输入“q”后，它将关闭连接。但在输入 'q' 之前，stdout.read() 将等待 EOF，如果缓冲区较大，似乎此方法不起作用。

*   **我在 while 中尝试了 stdout.read(1) ，它有效
    我在 while 中尝试了 stdout.readline() ，它也有效。
    stdin, stdout, stderr = ssh.exec_command('/Users/lteue/Downloads/uecontrol')
    stdout.read() 将挂起**

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-17T05:44:53.377

我不熟悉 paramiko，但这可能有效：

```
ssh_stdin.write('input value')
ssh_stdin.flush() 
```

有关标准输入的信息：

[http://docs.python.org/library/sys.html?highlight=stdin#sys.stdin](http://docs.python.org/library/sys.html?highlight=stdin#sys.stdin)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-30T08:28:50.450

看看例子并以类似的方式做

（来自[http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/](http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/)）：

```
 ssh.connect('127.0.0.1', username='jesse', 
        password='lol')
    stdin, stdout, stderr = ssh.exec_command(
        "sudo dmesg")
    stdin.write('lol\n')
    stdin.flush()
    data = stdout.read.splitlines()
    for line in data:
        if line.split(':')[0] == 'AirPort':
            print line 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-24T22:13:07.253

您可以使用此方法发送您想要的任何确认消息，例如“OK”或密码。这是我的示例解决方案：

```
def SpecialConfirmation(command, message, reply):
    net_connect.config_mode()    # To enter config mode
    net_connect.remote_conn.sendall(str(command)+'\n' )
    time.sleep(3)
    output = net_connect.remote_conn.recv(65535).decode('utf-8')
    ReplyAppend=''
    if str(message) in output:
        for i in range(0,(len(reply))):
            ReplyAppend+=str(reply[i])+'\n'
        net_connect.remote_conn.sendall(ReplyAppend)
        output = net_connect.remote_conn.recv(65535).decode('utf-8') 
    print (output)
    return output

CryptoPkiEnroll=['','','no','no','yes']

output=SpecialConfirmation ('crypto pki enroll TCA','Password' , CryptoPkiEnroll )
print (output) 
```

# css - CSS - 使页面居中 - 然后使页面高度为 100%

> ID：373643
> 
> 赞同：7
> 
> 时间：2008-12-17T04:18:38.573
> 
> 标签：css

我正在尝试使页面居中，然后使其`100%`高度。我有一个名为“内容”的 div 作为 HTML 页面中所有元素的父元素。接下来我需要做什么？我想远离任何 CSS 黑客。这目前在 IE7 中有效，但在 Firefox 3 中无效。

**编辑：**我添加了高度：`100%`; 这`#content`就是使它在 IE 中工作的原因。火狐还是没有解决。

到目前为止，我的样式表是：

```
html, body
{
    width: 100%;
    height: 100%;
}

body
{
    background-color: #000;
    text-align: center; 
    margin-top: 0px;
    margin-left: auto;
    margin-right: auto; 
} 

#content
{
    position: relative; 
    text-align: left;
    background-color: #fff;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0px;
    width: 840px;
    height: 100%;
    padding: 0px 5px 5px 5px;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T13:43:30.040

要使内容居中，请将其放在具有固定宽度（重要！）并且具有`margin: auto;`

除非您使用 javascript，否则没有跨浏览器可以让您的 div 具有 100% 的高度。如果您迫切需要此功能并愿意使用 javascript，则可以通过将其设置为窗口高度来动态设置内容的高度。我从来没有这样做过，所以我不会告诉你具体是怎么做的，但是通过谷歌搜索应该很容易找到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T22:34:41.217

啊啊！想我现在明白了。这适用于 Firefox 3 和 IE7。稍后我将在其他一些浏览器上进行测试。我仍然需要弄清楚在我的内容周围添加一些填充。

这需要我的页面上有这个层次结构

```
html  
|__正文  
     |__div id=容器  
         |__div id=内容  

```

```
 html
    {
        height: 100%;
    }

    body
    {
        height: 100%;
        margin: 0px;
        padding: 0px;
    }

    #container
    {
        position: absolute;
        text-align: center; 
        background-color: #000;
        width: 100%;
        height: 100%;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;    
    } 

    #content
    {
        text-align: left;
        background-color: #fff;
        margin: 0px auto;
        width: 830px; /* padding thing I'm working on */
        height: 100%;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T00:54:11.620

这在 Firefox 3 和 Safari 3 中适用于我。无法访问 IE。

```
html{
  position:absolute;
  top:0;
  bottom:-1px;
  left:0;
  right:0;
  height:100%;
  text-align:center;
}
body{
  text-align:left;
  margin-left:auto;
  margin-right:auto;
  margin-top:0;
  min-height:100%;
  min-width:30em;
  max-width:50em;
  width:expression("40em");/*IE doesn't support max/min width*/
  padding:0 1em 0 1em;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T04:58:05.530

```
body
{
    background-color: #000;
    text-align: center; 
    margin-top: 0px;
    margin-left: auto;
    margin-right: auto; 
} 

#content
{
    text-align: left;
    background-color: #fff;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0px;
    width: 90%;
    height: 100%;
    padding: 0px 5px 5px 5px;
} 
```

尝试这个。这将起作用。删除 html,body 选择器，您不需要它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-09T16:05:42.640

这应该做得更好。
没有额外的标记和/或 id。不需要 javascript 和/或 css 中的表达式。
应该在所有浏览器上都能正常工作。

```
<style>

html 
{
 background-color:red; 
 margin:0;
 padding:0;
 border:0px;       
}

body{
 background-color:yellow;
 position:absolute;
 left:-400px; /* 50% of content width */
 width:800px; /* your content width */
 margin-left:50%;
 margin-top:0;
 margin-bottom:0;
 top:0;
 bottom:0;
 border:0;
 padding:0
}
</style> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-17T04:22:42.467

为了使页面居中，我通常只是将内容 div 放在中心标签中，因为 margin-left/right:auto 确实不适用于所有版本的 IE。

为了使页面成为整个高度，您可以通过几种方式伪造它。我最喜欢的是为 ​​body 标签创建一个水平居中但垂直平铺的背景图像，这样主 div 就会有白色背景。不过，您可能仍然有一个页脚，因此您可以将其定位为 bottom:0 并且应该将其保持在底部并为您提供一个内容 div，该 div 似乎延伸到整个页面。

# git - git存档vs cp -R

> ID：373656
> 
> 赞同：4
> 
> 时间：2008-12-17T04:26:32.207
> 
> 标签：git, capistrano, vlad-deployer

如果我有一个 git 存储库的克隆作为远程服务器上的缓存副本，用于 capistrano/vlad 样式部署，是否更好做 A）

```
git archive --format=tar origin/master | (cd #{destination} && tar xf -) 
```

或 B)

```
cp -R cached-copy #{destination} && rm -Rf #{destination}/.git 
```

为了澄清，存储库已经在远程服务器上，我只想在部署期间将特定版本复制到同一服务器上的发布目录。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T05:10:59.483

我会说实际上

```
rsync -avP /local/repo/* server:/remote/repo 
```

只要可以**跳过 repo 中的所有 dot 文件**，它就可以工作，而不仅仅是`.git`. 如果您只想跳过，*则* `.git`需要该`-f`选项和手册页。

我喜欢[rsync](http://samba.anu.edu.au/rsync/)。效果很好，大多数时候你可以像使用 scp 一样使用它！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T04:51:16.883

**一种）**

您节省了传输 .git 目录的网络开销，该目录可能非常大，具体取决于当前 HEAD 中没有多少历史记录和对象。

如果您想在远程端拥有一个实际的 git 存储库，您最好推送到一个真正的存储库并且只需要更改增量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-18T02:01:04.433

**两者都不！**

一个更好的方法是：

*   `git fetch`你的缓存
*   将缓存克隆到当前目录（`--no-checkout`启用选项）
*   签出你想要的提交。

当您进行本地克隆时，Git 使用硬链接。这意味着，在您修改文件之前，您不会修改文件，您可以拥有 1,000 个部署，并且（实际上）只使用您需要的空间。这种方式也可以更快地归档或 rsync。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T04:53:54.540

也有人可能已经为您编写了您的代码。

[vigetlab的`capistrano_rsync_with_remote_cache`](http://github.com/vigetlabs/capistrano_rsync_with_remote_cache/tree/master)

我将它与 Subversion 一起使用，它对我来说效果很好。

# c++ - 需要一个好的非托管 C++ OCX 示例

> ID：373662
> 
> 赞同：1
> 
> 时间：2008-12-17T04:32:20.120
> 
> 标签：c++, ocx

我需要一个非常简单明了的示例来说明如何在非托管 C++ 代码中创建 OCX。理想情况下，我想在 Office 中使用它，但任何容器（即 VB6、.NET WinForms）都应该是好的。

我无法看到如何向 OCX 画布添加控件...我已经看到了从 OCX 的加载事件中打开对话框的示例...但这不是我想要的...我需要 OCX 中的 GUI本身。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T06:21:33.160

你看过[这个微软教程](http://msdn.microsoft.com/en-us/library/aa136657.aspx)吗？它使用 MFC。如果要创建无窗口控件，则需要使用 ATL。

# .net - WPF FlowDocument 段落内联长度

> ID：373663
> 
> 赞同：2
> 
> 时间：2008-12-17T04:33:49.667
> 
> 标签：.net, wpf, flowdocument

使用 FlowDocument 控件时，WPF Document.Paragraph 对象是否有任何限制？

当我向段落添加超过 450 行的段落时，我的 FlowDocument 变为空白。我在 MSDN 文档中找不到任何关于 max 的内容。长度等

任何想法为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T10:21:58.250

当 IsOptimalParagraphEnabled 设置为 False 时，此问题已得到解决。然后将显示内容。

似乎此属性会导致大段落出现问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T16:55:57.280

我做了一个快速测试并在一个段落中添加了 10000 次运行，FlowDocument 似乎可以很好地显示它们（尽管计算页数需要一些时间）：

```
Paragraph p = new Paragraph();
for (int i = 0; i < 10000; i++)
{
    p.Inlines.Add(new Run(String.Format("({0}) Sphinx of black quartz, judge my vow! ", i)));
}
wnd.Content = new FlowDocument(p); 
```

您添加到段落中的行有什么特别之处吗？

# safari - 我在 Chrome 中测试过，我需要在 Safari 中测试吗？

> ID：373665
> 
> 赞同：12
> 
> 时间：2008-12-17T04:34:02.160
> 
> 标签：safari, google-chrome, webkit

我在 Chrome 中测试过，我需要在 Safari 中测试吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-17T04:39:41.447

我注意到 Safari 处理亚洲字符比 Chrome 更好。Chrome 和 Safari 也依赖相同的 Webkit 来渲染页面，但它们的 Javascript 引擎完全不同，因此如果您在页面中使用 Javascript，则需要同时检查两者。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-17T04:43:50.940

[Browsershots](http://www.browsershots.org/)将向您发送几乎所有浏览器中的页面屏幕截图。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-17T04:40:56.500

Safari 使用“mac”字体，但 Chrome 会使用“Windows”字体。我注意到有时使用像 Arial 这样的字体会出现问题，它在 firefox/chrome/ie 中显示得很好，但在 Safari 上，它可能会导致换行，因为字体稍大一些。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-17T04:36:57.193

是的，但仅适用于您的字体和 JavaScript。

我注意到 Safari 上的一些默认字体比 Chrome 小，而且 Chrome 使用 V8 JavaScript 引擎，这给一些人带来了问题，特别是如果你有很多表单逻辑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T04:38:23.870

是的。

哦，你想要更多的细节？简单地说，Chrome 和 Safari 在它们的实现中有很多不同的特性，而 Safari 的使用非常广泛。如果您希望公众，尤其是我们这些在 Mac 上工作的人使用您的应用程序，那么您应该在 Safari 浏览器中进行测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T04:40:08.687

是的，即使 safari 和 chrome 使用的是 webkit，但使用的 webkit 的两个版本也有很大不同。所以你需要休息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T04:39:30.327

总而言之，不。你不能假设因为它适用于一个，它肯定会在所有情况下都适用于另一个。当然，在 99% 的情况下，它可能是相同的——但 99% 不是 100%——至少，这不是我上次检查的时候。如果你愿意，可以叫我迂腐的混蛋。

# .net - ASP.NET InnerXml 自动/错误地将属性文本附加到标签

> ID：373671
> 
> 赞同：1
> 
> 时间：2008-12-17T04:37:46.820
> 
> 标签：.net, asp.net, xml, .net-2.0

所以我有一些以下格式的XML：

```
<somenode>
    <html xmlns="http://www.w3.org/1999/xhtml">
        <head>
            <title/>
        </head>
        <body>
            <p>P one</p>
            <p>Another p</p>
        </body>
    </html>
</somenode> 
```

里面有一些 html，我认为这不是问题，因为它只会被视为 xml。

我正在尝试选择 <body> 标记的内容 (InnerXml)。但是，使用

```
xmlDoc.SelectSingleNode("somenode/html/body") 
```

返回`null`，并使用

```
xmlDoc.GetElementsByTagName("body")[0].InnerXml 
```

给出 InnerXml - 但每个 <p> 都`xmlns="http://www.w3.org/1999/xhtml"`附加到它 - 所以结果看起来像：

```
<p xmlns="http://www.w3.org/1999/xhtml">P one</p><p xmlns="http://www.w3.org/1999/xhtml">Another p</p> 
```

任何人都可以对此有所了解吗？似乎是一些非常奇怪的行为，任何帮助将不胜感激。我只使用 ASP.net 2.0，所以很遗憾尝试 linq 不是一种选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-17T05:06:15.200

由于该`<html>`元素将默认命名空间定义为[http://www.w3.org/1999/xhtml](http://www.w3.org/1999/xhtml)。默认情况下，其中所有没有命名空间前缀的元素都具有相同的命名空间。

由于 body 标记的内容是 2 个独立的`<p>`元素，它们都得到了声明。如果您的元素中有其他元素`<p>`，则它们将没有声明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T06:23:29.960

您的 xpath 表达式未指定默认命名空间。怎么样：

```
XmlNamespaceManager nsMgr = new XmlNamespaceManager(xmlDoc.NameTable);
nsMgr.AddNamespace("xhtml", "http://www.w3.org/1999/xhtml");

XmlNode node = xmlDoc.SelectSingleNode("somenode/xhtml:html/xhtml:body", nsMgr); 
```

# parsing - 是否有众所周知的算法来推断解析器规则的“返回类型”？

> ID：373680
> 
> 赞同：0
> 
> 时间：2008-12-17T04:39:56.610
> 
> 标签：parsing, type-inference, type-systems

给定一个语法和附加的动作代码，是否有任何标准解决方案来推断每个产生式需要产生什么类型（因此，调用产生式应该期望从中得到什么类型）？

我正在考虑使用类似于 c#`var`语法的 OO 程序和操作代码（但我不是在寻找特定于 c# 的东西）。

如果不是函数重载和递归语法，这将是相当简单的。

像这样的情况会出现问题：

```
Foo ::= 
    Bar Baz { return Fig(Bar, Baz); }
    Foo Pit { return Pop(Foo, Pit); } // typeof(foo) = fn(typeof(Foo)) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T05:19:47.170

如果您使用函数式语言编写代码，这很容易；标准的 Hindley-Milner 类型推断效果很好。 **不要这样做**。在我的支持 Icon、c 和标准 ML 的 EBNF 解析器生成器（从未发布，但可根据要求提供源代码）中，我实际上**实现了**您所询问的标准 ML 后端的想法：所有类型都被推断出来。 **由此产生的语法几乎无法调试。**

如果您将**重载**混入其中，结果只会**更难调试**。（没错！这就是！比不可能更难！比无穷大！超过我的就寝时间！）如果你真的想自己尝试，欢迎使用[我的代码](http://www.cs.tufts.edu/~nr/drop/ebnf-dist.icn)。（你没有；我从未发布它是有原因的。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T05:24:00.080

语法动作的返回值实际上与局部变量没有什么不同，因此您应该能够使用 C# 类型推断来完成这项工作。有关如何实现 C# 类型推断的一些见解，请参阅[本文。](http://lambda-the-ultimate.org/node/2234)

进行类型推断的标准方法是[Hindley-Milner 算法](http://en.wikipedia.org/wiki/Type_inference)，但它不能处理开箱即用的重载。

请注意，即使是类型推断语言的解析器生成器通常也不会推断语法动作的类型。例如，[ocamlyacc](http://caml.inria.fr/pub/docs/manual-ocaml/manual026.html)需要类型注释。Haskell的[Happy](http://www.haskell.org/happy/)解析器生成器可以[推断类型](http://www.haskell.org/happy/doc/html/sec-type-signatures.html)，但似乎不鼓励这种做法。这可能表明推断语法中的类型很困难，或者是一个坏主意，或者两者兼而有之。

[更新] Norman Ramsey 非常喜欢，他受益于痛苦的经历。

# .net - 使用 HttpWebRequest 和 HttpWebResponse 通过 HTTP POST 从 .NET 进行 Django 身份验证

> ID：373687
> 
> 赞同：3
> 
> 时间：2008-12-17T04:44:27.443
> 
> 标签：.net, django, authentication, httpwebrequest, httpwebresponse

我正在.NET 中创建一个应用程序，它将作为我已经部署的 Django 应用程序的第二个 UI。对于某些操作，用户需要对自己进行身份验证（作为 Django 用户）。我使用了一种超级简单的方法来做到这一点（为简单起见，没有加密凭据）：-

步骤 1\. 我创建了一个 django 视图，它通过两个 HTTP GET 参数接受用户名和密码，并将它们作为关键字参数传递给 django.contrib.auth.authenticate()。请看下面的代码：

```
    def authentication_api(request, raw_1, raw_2):
        用户=验证（用户名=raw_1，密码=raw_2）
        如果用户不是无：
            如果 user.is_active：
                返回 HttpResponse("正确", mimetype="text/plain")
            别的：
                返回 HttpResponse("disabled", mimetype="text/plain")
        别的：
            返回 HttpResponse("不正确", mimetype="text/plain")
```

第 2 步。我在 .NET 中使用以下代码调用它。下面的 'strAuthURL' 代表一个简单的 django URL 映射到上面的 django 视图：

```
    昏暗请求 As HttpWebRequest = CType(WebRequest.Create(strAuthURL), HttpWebRequest)
    昏暗响应 As HttpWebResponse = CType(request.GetResponse(), HttpWebResponse)
    Dim reader As StreamReader = New StreamReader(response.GetResponseStream())
    暗淡结果 As String = reader.ReadToEnd()
    HttpWResp.Close()
```

这完美无缺，尽管它只不过是一个概念验证。

现在我想通过 HTTP POST 做到这一点，所以我做了以下事情： -

我为使用 POST 数据进行身份验证创建了一个 django 视图

```
    def post_authentication_api（请求）：
        如果 request.method == 'POST'：
            用户 = 验证（用户名=request.POST['username']，密码=request.POST['password']）
            如果用户不是无：
                如果 user.is_active：
                    返回 HttpResponse("正确", mimetype="text/plain")
                别的：
                    返回 HttpResponse("disabled", mimetype="text/plain")
            别的：
                返回 HttpResponse("不正确", mimetype="text/plain")
```

`I have tested this using restclient and this view works as expected. However I can't get it to work from the .NET code below:`

```
    昏暗请求 As HttpWebRequest = CType(WebRequest.Create(strAuthURL), HttpWebRequest)
    request.ContentType = "应用程序/x-www-form-urlencoded"
    request.Method = "POST"
    暗淡编码作为新的 UnicodeEncoding
    Dim postData As String = "username=" & m_username & "&password=" & m_password
    将 postBytes 调暗为 Byte() = encoding.GetBytes(postData)
    request.ContentLength = postBytes.Length
    尝试
        将 postStream 调暗为 Stream = request.GetRequestStream()
        postStream.Write(postBytes, 0, postBytes.Length)
        postStream.Close()
        昏暗响应 As HttpWebResponse = CType(request.GetResponse(), HttpWebResponse)
        将 responseStream 调暗为新 StreamReader(response.GetResponseStream(), UnicodeEncoding.Unicode)
        结果 = responseStream.ReadToEnd()
        响应。关闭（）
    抓住前任作为例外
        MessageBox.Show(ex.ToString)
    结束尝试
```

服务器给我一个 500 内部服务器错误。我的猜测是 POST 请求未在 .NET 中正确设置。所以我基本上需要一些关于如何从 .NET 调用 django 视图发送 POST 数据的指导。

谢谢，厘米

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T05:26:13.507

在我看来还可以。我建议使用 Wireshark 查看您的 restclient 在标头中发送的内容，并查看您的应用在标头中发送的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T22:45:38.153

如果您没有在两个站点之间进行任何会话共享，并且 .Net 站点可以访问 Django 应用程序的数据库，您可以直接对数据库进行身份验证。 [这个](https://stackoverflow.com/questions/269713/using-python-to-authenticate-against-raw-username-hash-salt-in-db-created-by-as)问题是关于如何从 Python 到 .Net，但是当你的哈希值不完全匹配时，它应该可以帮助你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T23:24:45.733

它现在正在工作。HTTP 标头没有问题，问题的根源是以下几行：

```
    暗淡编码作为新的 UnicodeEncoding
    .
    将 postBytes 调暗为 Byte() = encoding.GetBytes(postData)
```

本质上，这会导致数据流在字符字节之间具有空字节。这当然不是 Django 身份验证在参数中所期望的。更改为 ASCIIEncoding 解决了这个问题。

> > 在我看来还可以。我建议使用 Wireshark 查看您的 restclient 在标头中发送的内容，并查看您的应用在标头中发送的内容。

这使我走上了解决此问题的正确道路。我尝试使用 Wireshark，但随后使用了似乎更适合这项工作的 HTTP 调试器。

正确的工具可以节省一小时！

# sql - 使用 SQL 报告服务的受密码保护的 PDF/Excel 报告

> ID：373718
> 
> 赞同：1
> 
> 时间：2008-12-17T05:13:47.137
> 
> 标签：sql, reporting-services, password-protection

我正在使用 SQL Reporting services 2005 生成报告。当用户将报告导出为 excel 或 pdf 时，我需要使用密码保护报告（pdf 和 excel）。

有什么方法可以保护报告。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T05:39:36.727

简短的回答是，您不能从 SSRS 2005 提供的 PDF 呈现扩展（从 Web UI 或以编程方式从 SSRS Web 服务）执行此操作。但是，您可以创建自己的渲染扩展插件来提供此功能。以下是一些可能有助于您入门的链接：

[介绍渲染扩展](http://msdn.microsoft.com/en-us/library/ms154606(SQL.90).aspx) [Microsoft SQL Server 2005：Reporting Services](http://www.microsoft.com/Sqlserver/2005/en/us/reporting-services.aspx)

您可以使用 COTS 库、一些开源代码或您自己的自定义代码来创建受密码保护的 PDF 文件，然后将其包装到 SSRS 2005 的自定义渲染扩展中。然而，在我看来，这将是一个相对的困难的任务。快速的谷歌搜索没有给我任何明显的渲染扩展，可能会提供你正在寻找的功能。

# javascript - 通过 .htaccess 进行 Javascript 压缩？

> ID：373725
> 
> 赞同：9
> 
> 时间：2008-12-17T05:22:25.543
> 
> 标签：javascript, apache, .htaccess

我正在使用 Apache。

我正在使用 .htaccess 文件中的以下指令动态地自动压缩我的 HTML 和 CSS 文件。

```
# Enable ETag
FileETag MTime Size

# Set expiration header
ExpiresActive on
ExpiresDefault "access plus 1 year"
ExpiresByType image/gif A2592000
ExpiresByType image/png A2592000
ExpiresByType image/jpeg A2592000
ExpiresByType text/css A2592000
ExpiresByType text/javascript A2592000
ExpiresByType text/js A2592000

# Compress some text file types
AddOutputFilterByType DEFLATE text/html text/css text/xml application/x-javascript text/javascript text/js

# Deactivate compression for buggy browsers
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html 
```

但是，当我使用 Firefox 的 Firebug 插件时，我注意到我的 javascript 文件没有被压缩（只有我的 HTML 和 CSS 文件是）。

**任何想法为什么我的 JavaScript 文件没有被 Apache 动态压缩？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-17T06:09:00.020

我想通了，看起来我需要它：

```
AddOutputFilterByType DEFLATE text/html text/plain text/css text/xml application/x-javascript text/javascript application/javascript 
```

让 javascript 压缩/gzip

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T05:37:54.140

您是否在 Apache 中声明了 text/javascript MIME 类型？例如，如果您的服务器配置指向`mime.types`具有以下之一的文件：

```
TypesConfig /private/etc/apache2/mime.types 
```

然后所述文件应包含以下行：

```
application/javascript              js 
```

否则，您应该在某处看到其中之一：

```
AddType application/javascript .js 
```

至少，这是我的第一个猜测，如果 HTML 和 CSS 文件被压缩而 JavaScript 文件没有被压缩。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-10-01T10:32:02.053

试着把你的声明放在不同的行上。这是我的一个 .htaccess 文件的相关部分，它可以按需要运行。如果您将脚本保存在单独的目录中（例如 /js），那么该文件也应该在该目录中。

```
AddOutputFilterByType DEFLATE text/plain

AddOutputFilterByType DEFLATE text/html

AddOutputFilterByType DEFLATE text/xml

AddOutputFilterByType DEFLATE text/css

AddOutputFilterByType DEFLATE text/javascript

AddOutputFilterByType DEFLATE text/js

AddOutputFilterByType DEFLATE application/xml

AddOutputFilterByType DEFLATE application/xhtml+xml

AddOutputFilterByType DEFLATE application/rss+xml

AddOutputFilterByType DEFLATE application/javascript

AddOutputFilterByType DEFLATE application/x-javascript 
```

# ruby-on-rails - 覆盖 ActiveRecord 属性方法

> ID：373731
> 
> 赞同：153
> 
> 时间：2008-12-17T05:31:46.290
> 
> 标签：ruby-on-rails, oop, activerecord

我正在谈论的一个例子：

```
class Person < ActiveRecord::Base
  def name=(name)
    super(name.capitalize)
  end
  def name
    super().downcase  # not sure why you'd do this; this is just an example
  end
end 
```

这似乎可行，但我刚刚阅读了[ActiveRecord::Base 文档](http://rails.rubyonrails.com/classes/ActiveRecord/Base.html)中关于覆盖属性方法的部分，它建议使用`read_attribute`and`write_attribute`方法。我认为我在上面的示例中所做的事情一定有问题；否则，他们为什么会祝福这些方法是覆盖属性方法的“正确方法”？他们还强迫一个更丑陋的成语，所以一定有充分的理由......

我真正的问题：这个例子有问题吗？

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2008-12-18T22:35:53.693

与 Gareth 的评论相呼应……您的代码将无法正常工作。应该这样重写：

```
def name=(name)
  write_attribute(:name, name.capitalize)
end

def name
  read_attribute(:name).downcase  # No test for nil?
end 
```

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2009-06-24T13:44:04.180

作为 Aaron Longwell 答案的扩展，您还可以使用“哈希表示法”来访问具有覆盖访问器和修改器的属性：

```
def name=(name)
  self[:name] = name.capitalize
end

def name
  self[:name].downcase
end 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-01-22T15:33:05.107

[在http://errtheblog.com/posts/18-accessor-missing](http://errtheblog.com/posts/18-accessor-missing)上有一些关于这个主题的重要信息。

总而言之，ActiveRecord 确实正确处理了对 ActiveRecord 属性访问器的超级调用。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-07-03T05:09:52.823

我有一个 rails 插件，它可以像你期望的那样让属性覆盖与 super 一起工作。你可以在[github](http://github.com/chriseppstein/has_overrides)上找到它。

安装：

```
./script/plugin install git://github.com/chriseppstein/has_overrides.git 
```

要使用：

```
class Post < ActiveRecord::Base

  has_overrides

  module Overrides
    # put your getter and setter overrides in this module.
    def title=(t)
      super(t.titleize)
    end
  end
end 
```

一旦你完成了这些事情就会起作用：

```
$ ./script/console 
Loading development environment (Rails 2.3.2)
>> post = Post.new(:title => "a simple title")
=> #<Post id: nil, title: "A Simple Title", body: nil, created_at: nil, updated_at: nil>
>> post.title = "another simple title"
=> "another simple title"
>> post.title
=> "Another Simple Title"
>> post.update_attributes(:title => "updated title")
=> true
>> post.title
=> "Updated Title"
>> post.update_attribute(:title, "singly updated title")
=> true
>> post.title
=> "Singly Updated Title" 
```

# visual-c++ - 在 VC++ 6.0 和 MFC 中处理滚动条

> ID：373744
> 
> 赞同：0
> 
> 时间：2008-12-17T05:45:04.157
> 
> 标签：visual-c++, scrollbar, visual-c++-6

Hai 在vc++6.0 MFC中，我连接了一个串口，同时在编辑框（IDC_EDIT1）中读取和显示数据（我想显示日期和时间），

我的问题是我在编辑框中使用了垂直滚动条。每当我显示新数据时，垂直滚动条就会向上移动；它必须向下（向下滚动），

写好的代码：

```
CString temp;
    static CString dat;
    static CString tim;

    if (dat != m_date || tim != m_time)
    {
        temp = "\r\n-------------------------------------------------------------------------------------------------\r\n\r\n";
        temp = temp + "Date: ";
        temp = temp + m_date;
        temp = temp + "\t\t\t";
        temp = temp + "Time: ";
        temp = temp + m_time;
        temp = temp + "\r\n-------------------------------------------------------------------------------------------------";
    }

    dat = m_date;
    tim = m_time;

    temp = temp + "\r\n\r\n";
    temp = temp + m_sensorname +"\t\t";
    temp = temp + m_value + "\t\t";
    temp = temp + m_units;

    if (m_datalog_id ==0x01)
        m_pdialog->m_editlog1= m_pdialog->m_editlog1 + temp;
    else if(m_datalog_id==0x02)
        m_pdialog->m_editlog2 = m_pdialog->m_editlog2 + temp;
    else
        return;

    m_pdialog->UpdateData(false); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T05:56:00.983

将文本写入编辑控件后，调用`IDC_EDIT1.ScrollToCaret()`. 这会将其向下滚动到新行所在的底部。

# .net - Linq 验证不可为空的属性

> ID：373757
> 
> 赞同：1
> 
> 时间：2008-12-17T05:58:07.997
> 
> 标签：.net, linq

我有包含不可为空的字符串属性的 Linq 实体。我想迭代属性，也许在部分`OnValidate`方法中，如果它们为空，则将这些属性设置为空字符串。

如果不按名称为每个属性显式编写代码，我该如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T12:04:13.043

这不是您所要求的，但另一种方法是使用 OnCreated 事件并将属性设置为 string.empty 在该事件已被触发时。

这显然适用于实体的所有用途，我不确定这种方法在您的情况下是否足够。

# php - 安全可靠地将文件路径转换为 url

> ID：373761
> 
> 赞同：2
> 
> 时间：2008-12-17T06:02:28.333
> 
> 标签：php, security, url, robustness

我正在使用 php，并且我有以下代码将绝对路径转换为 ​​url。

```
function make_url($path, $secure = false){
    return (!$secure ? 'http://' : 'https://').str_replace($_SERVER['DOCUMENT_ROOT'], $_SERVER['HTTP_HOST'], $path);
} 
```

我的问题基本上是，在位置和服务器之间可移植的安全性/可靠性方面，有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T08:23:11.170

我不认为安全性会受到影响，仅仅因为这是一个 url，正在打印到浏览器......可能发生的最糟糕的情况是暴露文件的完整目录路径，并可能创建一个损坏的链接。

附带说明一下，如果这是在 HTML 文档中打印的，我假设您正在通过 htmlentities 之类的东西传递输出......以防万一输入 $path 包含类似 [script] 标记 (XSS) 的东西。

不过，为了让它更可靠一点，我不建议在“DOCUMENT_ROOT”上进行匹配，因为有时它要么未设置，要么不匹配（例如，当 Apache 重写规则开始妨碍时）。

如果我要重写它，我会简单地确保始终打印“HTTP_HOST”......

```
function make_url($path, $secure = false){
    return (!$secure ? 'http://' : 'https://').$_SERVER['HTTP_HOST'].str_replace($_SERVER['DOCUMENT_ROOT'], '', $path);
} 
```

...如果可能的话，更新调用代码以便它只是通过路径，所以我什至不需要考虑删除'DOCUMENT_ROOT'（即如果路径与'DOCUMENT_ROOT'不匹配会发生什么）.. .

```
function make_url($path, $secure = false){
    return (!$secure ? 'http://' : 'https://').$_SERVER['HTTP_HOST'].$path;
} 
```

哪个确实留下了问题......为什么有这个功能？

在我的网站上，我只是在脚本执行开始时定义了一个变量，它设置：

```
$GLOBALS['webDomain'] = 'http://' . (isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : '');
$GLOBALS['webDomainSSL'] = $GLOBALS['webDomain']; 
```

我在哪里使用 GLOBALS 以便可以在任何地方访问它（例如在函数中）......但你可能还想考虑制作一个常量（定义），如果你知道这个值不会改变（我有时会在稍后更改这些值站点范围的配置文件，例如，如果我有网站的 HTTPS/SSL 证书）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T15:28:38.793

[HTTP_HOST 变量不是一个可靠或安全的值](http://shiflett.org/blog/2006/mar/server-name-versus-http-host)，因为它也是由客户端发送的。所以一定要在使用它之前验证它的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T00:41:25.610

我认为这是错误的做法。

HTML 中的 URL 支持相对位置。也就是说，您`<A href="filename.php">link</a>`可以引用在其 URL 中与当前页面具有相同路径的页面。您还可以`<a href="/dir/filename.php">link</a>`提供指向同一网站的完整路径。这两个技巧意味着您的网站代码实际上并不需要知道它在哪里提供有效的 URL。

也就是说，您可能需要一些技巧，以便您可以拥有一个网站`http://www.example.com/dev/site.php`和另一个网站`http://www.example.com/testing/site.php`。您需要一些代码来确定正在使用哪个目录前缀，但您可以使用配置值来执行此操作。我的意思是属于该（子）站点配置的值，而不是版本控制的代码！

# c++ - C++ - 未解析的外部符号

> ID：373762
> 
> 赞同：2
> 
> 时间：2008-12-17T06:04:13.960
> 
> 标签：c++, class, linker, external-dependencies

简单的说：

富.h：

```
#include "bar.h"
class foo {
private:
    bar it;
    void DoIt();
} 
```

酒吧.h：

```
class bar {
public:
    void Test();
} 
```

foo.cpp：

```
void foo::DoIt() {
    it.Test();
} 
```

这将导致：

> 错误 LNK2001：未解析的外部符号

为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T06:07:09.523

您还没有为`bar::Test()`方法编写代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T06:06:20.227

我很笨！我确实在类定义中定义了 Test() 但实际上并没有现有的 Test() 函数:(

对不起。

# javascript - 在为系统编写 Web 后端时，代码在没有 Javascript 的情况下仍然可以工作是否重要？

> ID：373768
> 
> 赞同：5
> 
> 时间：2008-12-17T06:08:40.787
> 
> 标签：javascript, xhtml

期望使用后端的用户启用 Javascript 可以吗？

我想我会得到的答案是“这取决于你的目标用户”。我正在开发一个有趣的系统，希望能被其他人使用。我想听听其他开发后端系统的人的意见，他们决定做什么，为什么？

SEO 我不关心，语义也没有那么重要。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T06:54:04.703

我个人希望故障转移，但在某些情况下（特别是低调的网站、内部网、电子学习内容）你可以假设 JS。

大多数情况下，您甚至可以使用简单的“您需要 JS / 这对 JS 更有效”，我认为这已经足够好了，但是在某些情况下我会要求真正的故障转移：

*   .gov 或其他公共服务网站（法律要求）

*   网络技术公司的网站（你需要证明你有能力做到这一点）

*   非常高流量的网站（其中 3% 的非 JS 用户成为一个很高的绝对数字）

*   移动设备的网站（或页面）（其中大多数没有可靠的 JS）

一般来说，提供*某种*noscript 相当容易，那么为什么不这样做呢？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T06:41:16.227

如果它是为了好玩，请继续并需要 javascript。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T07:07:15.893

考虑到 3 点：

1.  后端意味着只有少数人会访问它们（而且他们都可能也有网络知识，例如知道什么是 javascript 以及如何启用它）
2.  SEO并不重要
3.  这是为了好玩

我会说没关系。:)

[anakata 也](https://stackoverflow.com/questions/373768/when-writing-a-web-backend-for-a-system-is-it-important-the-code-can-still-work#373838)提供了很好的见解。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T07:07:56.920

我向您推荐 Jeff Atwood 的这篇[文章](https://blog.codinghorror.com/secrets-of-the-javascript-ninjas/)。其中的重要断言是，您可以预期 javascript 将在浏览器中按预期工作。今天的安全风险也较低。所以我想说现在可以安全地忽略不启用 javascript 的客户端。如果你想攻击用户，javascript 会带来明显的优势。

我能想到的唯一例外是移动网站。尽管移动浏览器变得更好并且确实支持 javascript，但额外的下载带宽和小屏幕使 js 不太适合。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T08:13:44.947

这实际上取决于您的应用程序及其目标受众。您是否关心用户的可访问性（残疾人可以使用该网站），您是否希望您的网站在 JavaScript 支持有限的各种移动浏览器上运行？我会尝试构建站点，以便它可以在没有 CSS 或 JavaScript 的情况下优雅地降级。那是除非你的网站是非常动态的，比如一个文字处理器，如果没有 JavaScript，它根本就无法工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T08:48:18.187

是的，这主要取决于您的目标用户。无论前端是什么，后端都必须是防弹的。至少，它应该确保没有人可以通过禁用 javascript 来破解或弄得一团糟。服务器端过滤/验证对安全性很重要，而客户端验证和交互性对可用性很重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T09:30:51.017

我认为基于 Web 的后端/CMS 需要 Javascript 并非不合理，因为您的目标用户可能是一个相当小且非常具体的群体。

到目前为止，我工作过的所有 CMS 系统都需要它。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-17T06:42:36.847

只要您的应用程序将提供的功能是通用的，我会说依赖 Javascript 是安全的。我管理的其中一个站点在美好的一天会收到约 35,000 次紫外线。我认为可以公平地说，我们接触到了各种各样的浏览器和操作系统组合。根据我们的统计数据，大约 97% 的用户启用了 Javascript。

如果它可以在没有 Javascript 的情况下优雅地失败，我会选择那个解决方案，但我不会因为你每天*可能*会失去几个人而失眠。

# linux - Linux 使用 grep 打印文件名和前 n 个字符

> ID：373774
> 
> 赞同：2
> 
> 时间：2008-12-17T06:12:37.657
> 
> 标签：linux, grep

如何使用 grep 执行搜索，当找到匹配项时，将打印文件名以及该文件中的前 n 个字符？请注意，这`n`是一个可以指定的参数，与前 n 个字符是否实际包含匹配字符串无关。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T06:32:18.333

```
grep -l pattern *.txt | 
    while read line; do 
        echo -n "$line: "; 
        head -c $n "$line"; 
        echo; 
     done 
```

如果您想查看第一行而不是字节，请更改`-c`为。`-n``n`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T06:20:35.457

您需要将 grep 的输出通过管道传输到 sed 以完成您想要的操作。这是一个例子：

```
grep mypattern *.txt | sed 's/^\([^:]*:.......\).*/\1/' 
```

点数是要打印的字符数。许多版本的 sed 通常提供一个选项，例如 -r (GNU/Linux) 和 -E (FreeBSD)，允许您使用现代风格的正则表达式。这样可以以数字方式指定要打印的字符数。

```
N=7
grep mypattern *.txt /dev/null | sed -r "s/^([^:]*:.{$N}).*/\1/" 
```

请注意，此解决方案比其他人提出的调用多个进程的解决方案要高效得多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T06:29:33.707

很少有工具可以打印“n 个字符”而不是“n 行”。你确定你真的想要字符而不是线条吗？整个事情可能最好在 Perl 中完成。如指定（使用`grep`），我们可以这样做：

```
pattern="$1"
shift
n="$2"
shift
grep -l "$pattern" "$@" |
while read file
do
    echo "$file:" $(dd if="$file" count=${n}c)
done 
```

引号周围`$file`正确保留文件名中的多个空格。我们可以讨论命令行的用法，目前（假设命令名是' `ngrep`'）：

```
 ngrep pattern n [file ...] 
```

* * *

我注意到@litb 使用了 ' `head -c $n`'; 这比`dd`我使用的命令更整洁。可能有一些系统没有`head`（但它们非常陈旧）。我注意到POSIX版本`head`只支持`-n`和行数；该`-c`选项可能是 GNU 扩展。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T08:00:39.640

这里有两个想法：

1）如果效率不是问题（就像那样会发生），你可以在每个文件上运行*grep后检查**$status* [csh] 。例如：（对于**N**个字符**= 25**。）

 *****```
foreach FILE ( file1 file2 ... fileN )
  grep targetToMatch  ${FILE} > /dev/null
  if ( $status == 0 ) then
     echo -n "${FILE}:  "
     head -c25 ${FILE}
  endif
end 
```

2) GNU [FSF]*头部*包含一个*--verbose* *[-v]*开关。它还提供*--null*，以容纳带有空格的文件名。还有*'--'*来处理像*"-c"*这样的文件名。所以你可以这样做：

```
grep --null -l targetToMatch -- file1 file2 ... fileN |
xargs --null head -v -c25 -- 
```

# c# - 监控使用统计——它是如何完成的？

> ID：373776
> 
> 赞同：5
> 
> 时间：2008-12-17T06:14:40.633
> 
> 标签：c#, aop, usage-statistics

Windows、Firefox 或 Google Chrome 都监控使用统计数据并分析发送给它们的崩溃报告。我正在考虑在我的应用程序中实现相同的功能。

当然，在应用程序中添加大量日志语句很容易，但这是我想要避免的方法，因为我不希望我的代码在函数中有太多的横切关注点。我正在考虑使用 AOP 来做这件事，但在此之前我想知道其他人是如何首先实现这个功能的。

有人有什么建议吗？

澄清：我正在开发桌面应用程序，不涉及任何 RDBMS

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T22:40:13.060

Joel 有一篇关于此类的博客文章 - 他的应用程序陷阱崩溃，然后联系他的服务器并提供一些详细信息。我认为他会检查重复项并将它们扔掉。这是一个很棒的系统，当我阅读它时给我留下了深刻的印象。

[http://www.fogcreek.com/FogBugz/docs/30/UsingFogBUGZtoGetCrashRep.html](http://www.fogcreek.com/FogBugz/docs/30/UsingFogBUGZtoGetCrashRep.html)

我们在我所在的一个地方做了这个，那里有一个公共服务器来接收数据。我不是数据库专家，也没有我在公共互联网上控制的服务器。不幸的是，我的个人项目还没有这个很棒的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T09:18:55.940

在“调试 .Net 2.0 应用程序”中，John Robbins（Wintellect 的）写了大量关于如何生成和调试崩溃报告（实际上是 windbg/SOS 迷你转储）的文章。他的 Superassert 类包含生成这些的代码。但请注意 - 正确设置需要付出很多努力：符号服务器、源服务器以及对 VS2005 和 windbg 的良好了解。然而，他的书将指导您完成整个过程。

关于使用统计，我经常将其与授权联系起来，即用户有权执行特定任务。过于简单地说，这可能是这样的方法（ApplicationActions 是一个枚举）：

```
public static bool HasPermission( ApplicationActions action )
{
    // Validate user has permission.
    // Log request and result.
} 
```

可以将此方法添加到单例 SercurityService 类中。正如我所说，这过于简单，但应该表明我所考虑的服务类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T22:34:53.570

我将快速浏览一下作为企业库一部分的日志记录应用程序块。它提供了大量您需要的东西，并且维护得很好。查看一些可用的场景和示例，我想你会找到你喜欢的。

[http://msdn.microsoft.com/en-us/library/cc309506.aspx](http://msdn.microsoft.com/en-us/library/cc309506.aspx)

# c# - 如何在 WPF ListBox 中禁用水平滚动？

> ID：373778
> 
> 赞同：129
> 
> 时间：2008-12-17T06:16:56.150
> 
> 标签：c#, .net, wpf, visual-studio, listbox

这似乎是一个荒谬的简单问题，但 Google 和 Stack Overflow 搜索却一无所获。当项目占用的水平空间多于框中可用的水平空间时，如何禁用 WPF [ListBox中的水平滚动？](https://docs.microsoft.com/en-gb/dotnet/api/system.windows.controls.listbox)

* * *

## 回答 #1

> 赞同：284
> 
> 时间：2008-12-17T06:21:31.087

在 XAML 中：

```
<ListBox ScrollViewer.HorizontalScrollBarVisibility="Disabled" /> 
```

在 C# 中：

```
myListBox.SetValue(
    ScrollViewer.HorizontalScrollBarVisibilityProperty,
    ScrollBarVisibility.Disabled); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-11-27T13:13:22.890

如果您从代码隐藏创建了列表框并希望在 XAML 中进行更改：

```
<UserControl.Resources>
    <Style TargetType="{x:Type ListBox}" x:Key="{x:Type ListBox}" >
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden" />
    </Style>
</UserControl.Resources> 
```

# .net - 我们可以在 Fluent NHibernate 中自定义主键列的名称吗？

> ID：373787
> 
> 赞同：1
> 
> 时间：2008-12-17T06:22:36.623
> 
> 标签：.net, nhibernate, fluent-nhibernate, nhibernate-mapping

当我在 Fluent NHibernate 中工作时，我感到非常惊讶。我得到了具有主键列名称的旧数据库与域模型中的属性不同。我确信我可以使用这个映射文件：

```
<class name="Person">
  <id name="Id" column="CommentId">
      <generator class="native"/>
  </id>
  <property name="Description" type="String" />
</class> 
```

但是我如何在 Fluent NHibernate 映射中真正得到这个映射呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T07:35:17.850

以下 Fluent-NHibernate 映射：

```
public class PersonMap : ClassMap<Person>
{
    public PersonMap()
    {
        Id(x => x.Id, "CommentId")
            .GeneratedBy.Native();

        Map(x => x.Description);
    }
} 
```

生成此 XML 映射：

```
 <class name="Person" table="[Person]" xmlns="urn:nhibernate-mapping-2.2">
    <id name="Id" column="CommentId" type="Int32">
      <generator class="native" />
    </id>
    <property name="Description" column="Description" length="100" type="String">
      <column name="Description" />
    </property>
  </class> 
```

# objective-c - 全屏 UIView，顶部有状态栏和导航栏覆盖

> ID：373791
> 
> 赞同：51
> 
> 时间：2008-12-17T06:23:53.343
> 
> 标签：objective-c, iphone

实现 UIView 顶部的状态栏和导航栏的正确方法是什么？

[替代文字 http://img.skitch.com/20081217-t78sdixk37hqgdh1ia2fgec4st.png](http://img.skitch.com/20081217-t78sdixk37hqgdh1ia2fgec4st.png)

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-06-18T20:14:10.977

只需在视图控制器中设置“想要全屏布局”。这为我解决了问题。

```
self.wantsFullScreenLayout = YES; 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-17T15:50:21.453

在上面的截图中，有一个半透明的状态栏和一个半透明的导航栏。

状态栏设置使用

```
[[UIApplication sharedApplication] setStatusBarStyle: UIStatusBarStyleBlackTranslucent]; 
```

导航栏设置使用

```
theNavigationController.navigationBar.barStyle = UIBarStyleBlackTranslucent; 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-11-04T17:33:26.750

如果您在导航控制器中有一个视图控制器，并且您想隐藏状态栏以使您的 viewController 的视图全屏显示，您可以随时调用：

```
[self.navigationController.view setNeedsLayout]; 
```

隐藏状态栏后。但我个人认为

```
[self setWantsFullScreenLayout:YES]; 
```

是更好的方法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-01T13:19:15.723

我想出的最好方法是：当使用包含导航控制器的“复杂”标签栏层次结构时，一个“详细”视图是全屏视图。

在将标签栏控制器的视图添加到窗口之前的应用程序委托中，我添加了以下内容：

```
tabBarController.view.frame = [[UIScreen mainScreen] bounds]; 
```

这将使标签栏控制器覆盖整个屏幕，甚至在状态栏区域下方。我不得不将几个视图的高度偏移到 +20px，尤其是导航栏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T09:28:33.983

设置状态栏样式为黑色半透明，导航栏样式为黑色半透明。如果您使用的是基于导航的应用程序，请在 MainWindow.xib 中检查状态栏是否隐藏和导航栏是否隐藏复选框。

当用户触摸屏幕时，启动计时器以查看这是单击还是双击。如果单击，则使状态栏和导航栏隐藏 = NO。一旦用户活动停止，再次启动计时器。在一段时间没有活动后，将它们再次隐藏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-24T07:09:38.050

步骤 1 在 plist 中将 UIViewControllerBasedStatusBarAppearance 设置为 No

然后在完成启动选项中添加以下代码

```
if ([[[UIDevice currentDevice] systemVersion] floatValue] >= 7) {

   [application setStatusBarStyle:UIStatusBarStyleLightContent];

    self.window.clipsToBounds =YES;

    self.window.frame =  CGRectMake(0,20,self.window.frame.size.width,self.window.frame.size.height-20);
} 
```

请按照对我有用的代码

# concurrency - 招聘经理希望开发人员理解哪些并发编程概念？

> ID：373794
> 
> 赞同：6
> 
> 时间：2008-12-17T06:27:06.787
> 
> 标签：concurrency

当我聘请开发人员担任一般中高级 Web 应用程序开发职位时，我通常希望他们了解核心并发编程概念，例如活性与安全性、竞争条件、线程同步和死锁。我不确定是否将诸如 fork/join、等待/通知、锁排序、内存模型基础（只是基础知识）等主题作为每个经验丰富的开发人员都应该知道的一部分，或者这些主题是否是主题这更适合半专家（即有意识地决定比普通开发人员了解更多并发编程的开发人员）。

我很想听听你的想法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T08:54:38.750

我倾向于认为，在这个时间点上，任何深度的并发编程仍然是一项专业技能。许多人会声称通过学习知道它，但许多人在应用时也会把它弄得一团糟。

除了列出的注意事项之外，我还将查看资源影响以及使用进程、线程和纤程的各种开销。在某些情况下，例如移动设备，过多的多线程可能会产生严重的性能影响。这可能导致多线程代码的可移植性问题。

我想如果我在这种情况下面试候选人，我会使用一个真实世界的例子，而不是触及可以从教科书中逐字引用的更笼统的话题。我说这是我自己完成了相当多的多线程工作并记得前几次我搞砸了多么糟糕。许多人可以谈论谈话......;）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T06:38:26.653

我知道所有这些主题，但我研究过它们。我也认识很多不知道这些的称职的高级程序员。因此，除非您期望这些程序员积极使用这些概念，否则没有理由拒绝一个完美的候选人，因为他们不了解并发的各个方面

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-18T01:02:33.257

真正的问题是：

这对他们将要开发的代码有什么影响？

您应该知道您正在招聘的开发职位需要知道哪些概念才能从事他们将负责的项目。

与编程世界中的任何事情一样。魔鬼在细节中，你不可能知道一切。如果您正在招聘 Java 职位，您会期望他们了解 Perl 吗？

此外，现阶段的并发性虽然在广义理论中得到了很好的描述，但很大程度上依赖于实现和平台。AIX 机器上 Perl 中的并发与 C++ Winforms 应用程序中的并发不同。他们可以掌握世界上所有的理论，但如果工作需要，那么他们也应该对他们期望使用它的平台有深入的了解。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T05:27:53.777

我经常采访并发相关职位的人，我寻找三个一般方面：

1.  对您列出的核心概念的一般理解（与语言无关）
2.  对 Java 并发库和原语的特定理解（特定于他们将要做的工作）
3.  能够以合理的方式设计并发问题的解决方案。

我认为＃1是一个要求（对于我的职位）。我认为＃2很高兴。如果他们理解它并且可以用 pthread 或任何其他库来描述它，那么学习最新的 Java 并发库就不是什么大问题了（这些概念是困难的部分）。＃3倾向于将员工与可能的员工分开。

Per your question, I wouldn't consider fork/join to be known by almost anyone, esp someone applying for a web app developer position. I would look for developers to have experience with some (but not all) of those topics. Most developers I've interviewed have not used the Java 5+ concurrency libs at all but they can typically describe things like data race or deadlock.

# .net - 如何通过 .NET Framework 源代码进行调试？

> ID：373796
> 
> 赞同：21
> 
> 时间：2008-12-17T06:28:19.187
> 
> 标签：.net, visual-studio-2008, debugging

我已按照[http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)中概述的步骤启用源.NET Framework 的调试，我过去曾让它工作。现在我使用的是 .NET 3.5 SP1，它似乎已经停止工作。除了我刚才提到的博客条目中的步骤之外，我还可以采取哪些特殊步骤来使源代码调试再次工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-28T22:00:10.307

这在最新的 GDR 中已损坏，Microsoft 需要修复它

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-09T07:47:29.010

当我升级到 .NET 3.5 sp1 时，我遇到了同样的问题。sp1 版本似乎非常简化。现在您只需选中“启用 .NET 框架源步进”（它会自动取消选中“仅启用我的代码”）。您不必再更改“符号”设置中的任何内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T06:39:07.213

您可能需要刷新下载的符号。在符号设置对话框中，您指定缓存符号的缓存目录。由于您已经升级了 .NET 框架，因此缓存在那里的符号很可能是较旧的符号，它们不能与较新的 dll 一起使用。只需清除您的目录，然后再次下载 .NET 3.5 SP1 的符号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-20T17:52:09.053

当我第一次遵循这些步骤时，调试对我不起作用。我删除了符号目录并从 Options -> Debugging -> Symbols 中删除了所有设置，它起作用了。

*   取消选中“仅启用我的代码”
*   选中“启用 .NET Framework 源单步执行”
*   勾选“启用源服务器支持”
*   不要在 Debugging -> Symbols 中添加任何内容

在带有 Visual Studio 2008 SP1 的 Windows 7 x64 上运行良好。

# shell - 用于查找两个文件中共有行的 Shell 命令

> ID：373810
> 
> 赞同：210
> 
> 时间：2008-12-17T06:36:55.330
> 
> 标签：shell, command-line

我确定我曾经找到一个 shell 命令，它可以打印两个或多个文件的公共行。它叫什么名字？

它比 . 简单得多[`diff`](https://linux.die.net/man/1/diff)。

* * *

## 回答 #1

> 赞同：260
> 
> 时间：2008-12-17T06:40:58.020

您正在寻找的命令是[`comm`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/comm.html). 例如：-

```
comm -12 1.sorted.txt 2.sorted.txt 
```

这里：

**-1**：抑制第 1 列（1.sorted.txt 独有的行）

**-2**：抑制第 2 列（2.sorted.txt 独有的行）

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2014-07-20T13:57:34.367

要轻松地将**comm**命令应用于**未排序**的文件，请使用 Bash 的[进程替换](http://www.gnu.org/software/bash/manual/bash.html#Process-Substitution)：

```
$ bash --version
GNU bash, version 3.2.51(1)-release
Copyright (C) 2007 Free Software Foundation, Inc.
$ cat > abc
123
567
132
$ cat > def
132
777
321 
```

所以文件 abc 和 def 有一行共同点，一行是“132”。在未排序的文件上使用**comm ：**

```
$ comm abc def
123
    132
567
132
    777
    321
$ comm -12 abc def # No output! The common line is not found
$ 
```

最后一行没有输出，公共行没有被发现。

现在对已排序的文件使用**comm ，使用进程替换对文件进行排序：**

```
$ comm <( sort abc ) <( sort def )
123
            132
    321
567
    777
$ comm -12 <( sort abc ) <( sort def )
132 
```

现在我们得到了 132 行！

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2014-10-11T21:50:39.493

为了补充 Perl 单行，这里是它的`awk`等价物：

```
awk 'NR==FNR{arr[$0];next} $0 in arr' file1 file2 
```

这将从`file1`数组中读取所有行`arr[]`，然后检查其中的每一行`file2`是否已经存在于数组中（即`file1`）。找到的行将按照它们在 中出现的顺序打印`file2`。请注意，比较`in arr`使用从`file2`索引到数组的整行，因此它只会报告整行的完全匹配。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-12-17T06:41:40.000

也许你的意思是`comm`？

> 逐行比较已排序的文件 FILE1 和 FILE2。
> 
> 在没有选项的情况下，生成三列输出。第一列包含 FILE1 唯一的行，第二列包含 FILE2 唯一的行，第三列包含两个文件共有的行。

找到这些信息的秘诀是信息页面。对于 GNU 程序，它们比手册页要详细得多。尝试一下`info coreutils`，它会列出所有有用的小工具。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2015-01-20T17:21:16.990

尽管

```
grep -v -f 1.txt 2.txt > 3.txt 
```

为您提供两个文件的差异（2.txt 中的内容而不是 1.txt 中的内容），您可以轻松地执行

```
grep -f 1.txt 2.txt > 3.txt 
```

收集所有常见的行，这应该为您的问题提供简单的解决方案。如果您对文件进行了排序，那么您仍然应该接受`comm`。问候！

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-07-21T11:14:14.773

如果这两个文件还没有排序，你可以使用：

```
comm -12 <(sort a.txt) <(sort b.txt) 
```

它会起作用，避免在`comm: file 2 is not in sorted order` 执行时出现错误消息`comm -12 a.txt b.txt`。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-07-17T15:05:36.287

```
perl -ne 'print if ($seen{$_} .= @ARGV) =~ /10$/'  file1 file2 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-08-14T10:16:56.697

```
awk 'NR==FNR{a[$1]++;next} a[$1] ' file1 file2 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-03-20T09:05:42.327

在有限版本的 Linux 上（比如我正在研究的[QNAP](https://en.wikipedia.org/wiki/QNAP_Systems#Product_overview) ( [NAS )）：](https://en.wikipedia.org/wiki/Network-attached_storage)

*   *通讯*不存在
*   `grep -f file1 file2`可能会导致@ChristopherSchultz 所说的一些问题，并且使用`grep -F -f file1 file2`速度非常慢（超过 5 分钟 - 未完成 - 使用以下方法对超过 20 MB 的文件超过 2-3 秒）

所以这就是我所做的：

```
sort file1 > file1.sorted
sort file2 > file2.sorted

diff file1.sorted file2.sorted | grep "<" | sed 's/^< *//' > files.diff
diff file1.sorted files.diff | grep "<" | sed 's/^< *//' > files.same.sorted 
```

如果`files.same.sorted`应与原始的顺序相同，则添加此行以获得与 file1 相同的顺序：

```
awk 'FNR==NR {a[$0]=$0; next}; $0 in a {print a[$0]}' files.same.sorted file1 > files.same 
```

或者，对于与 file2 相同的顺序：

```
awk 'FNR==NR {a[$0]=$0; next}; $0 in a {print a[$0]}' files.same.sorted file2 > files.same 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-11-08T14:33:07.897

有关如何对多个文件执行此操作，请参阅*[Find matching lines across many files](https://stackoverflow.com/a/19861397/2585303)*的链接答案。

* * *

结合这两个答案（[答案 1](https://stackoverflow.com/a/12247194/2585303)和[答案 2](https://stackoverflow.com/a/746495/2585303)），我认为您无需对文件进行排序即可获得所需的结果：

```
#!/bin/bash
ans="matching_lines"

for file1 in *
do 
    for file2 in *
        do 
            if  [ "$file1" != "$ans" ] && [ "$file2" != "$ans" ] && [ "$file1" != "$file2" ] ; then
                echo "Comparing: $file1 $file2 ..." >> $ans
                perl -ne 'print if ($seen{$_} .= @ARGV) =~ /10$/' $file1 $file2 >> $ans
            fi
         done 
done 
```

只需保存它，赋予它执行权限 ( `chmod +x compareFiles.sh`) 并运行它。它将获取当前工作目录中存在的所有文件，并将进行全部比较，并将结果留在“matching_lines”文件中。

需要改进的地方：

*   跳过目录
*   避免将所有文件比较两次（file1 vs file2 和 file2 vs file1）。
*   也许在匹配字符串旁边添加行号

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2013-09-01T09:34:41.773

```
rm file3.txt

cat file1.out | while read line1
do
        cat file2.out | while read line2
        do
                if [[ $line1 == $line2 ]]; then
                        echo $line1 >>file3.out
                fi
        done
done 
```

这应该这样做。

# git - 使用 Git 将文件回滚到更早的版本

> ID：373812
> 
> 赞同：207
> 
> 时间：2008-12-17T06:37:49.040
> 
> 标签：git

Git中有没有办法回滚到文件的更早版本？我可以使用 REVERT 回滚到之前的版本，但是如果我想回到之前的版本怎么办？

# linq - 使用实体框架批量插入/更新

> ID：373826
> 
> 赞同：4
> 
> 时间：2008-12-17T06:44:51.383
> 
> 标签：linq, entity-framework

1.  我有一个标签表，其架构仅包含 ID 和名称（唯一）。现在，从 GUI 用户可以输入 BlogPost 的标签。保存数据后，标签存储在字符串（名称）数组中，我想将名称尚不存在的标签添加到标签表中并忽略名称已存在的标签并返回所有标签实体的列表（包括现有的和新增的）。如何在 Entity Framework 中通过 1 个 SQL 往返执行此操作？

2.  对于返回的标签，我想将它们关联到要添加的 BlogPost 对象（它只是被实例化并且尚未通过 EF 存储在 DB 中）。是否仍然可以将此步骤与 1 次单次往返中的 #1 结合使用，或者我必须发出另一个查询？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T14:02:37.647

我不相信实体框架（目前）根本不进行批量插入。因此，如果您必须将 DB 往返次数保持在如此低的水平，您可能不得不使用存储过程或数据库触发器。幸运的是，实体框架支持返回实体类型的存储过程。MSDN 上有关于此的文档。您可以创建一个接受标签字符串列表并返回标签实体实例的过程。或者，您可以将 VARCHAR 列添加到您的 post 表中以获取分隔的标签列表，并在触发器中对其进行解析。

# erp - 有人用过无代码软件开发系统吗？

> ID：373831
> 
> 赞同：4
> 
> 时间：2008-12-17T06:49:36.710
> 
> 标签：erp, mda

我找到了一个目前可以免费使用和开发的软件开发系统。

该系统完全无代码，可以使用其 GUI 和一点 MDA 轻松开发面向业务的应用程序。该网站是： http: [//www.codeless.com/](http://www.codeless.com/)

但不幸的是，它是荷兰语。

我想知道有没有人用过这个产品？

这种方法和产品的效率如何？

可以开发无代码应用程序吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-17T07:36:08.377

我看过这个网站，但故事非常模糊。

对于大多数不会说荷兰语的人，我翻译了以下文本：

> Klaar voor de toekomst！
> 
> Stel dat u 超过 20 jaar nog steeds dezelfde 软件 zou kunnen gebruiken als nu。Toekomstmuziek? Nou，欢迎来到 uw toekomst dan。想要 Codeless Technology ontwikkelt 软件 zonder code die simpelweg niet veroudert。
> 
> 在 Codeless uit komt te zien 中的门“逆向工程” kunnen wij u laten zien hoe uw software-pakket er。En door gebruik te maken van interfaces, kunnen we bepaalde delen van uw systeem vervangen zonder dat er een Big Bang implementation noodzakelijk is。
> 
> Wij hebben een manier gevonden om onze software voor altijd mee te laten gaan。Omdat we het simpelweg zonde van uw tijd vinden om telkens opnieuw uw bedrijfsprocessen te moeten uitleggen aan een nieuwe ICT-leveranceer。
> 
> Uw 系统是完美的 aangelsloten op uw bedrijfsprocessen。En dat terwijl u de nieuwste technologieën snel en voordelig in kunt zetten om zo concurrentievoordeel te behalen。Natuurlijk moet u updaten。Maar 遇到了 de software die u nu door ons laat bouwen，bent u gegarandeerd klaar voor de toekomst！

这转化为：

> 为未来做好准备！
> 
> 想象一下，您在 20 年内使用相同的软件。不可能的？不，欢迎来到你的未来。因为无代码技术创造了没有代码的软件，不会老化。
> 
> 通过“逆向工程”，我们向您展示您在 Codeless 中的软件。通过使用接口，我们可以替换您系统的某些部分，而无需大爆炸实现。
> 
> 我们找到了一种让我们的软件永远持续下去的方法，因为我们认为一次又一次地向您的 ICT 供应商解释您的业务流程是在浪费您的时间。
> 
> 您的系统与您的业务流程完美连接。而且您仍然可以快速轻松地使用最新技术，从而在竞争对手中占据优势。当然，您仍然需要更新。但使用我们的软件，您可以保证为未来做好准备。

看起来他们开发了一种使用现有系统并使用旧系统作为指导创建新系统的产品。无需编写代码。这看起来很棒，但我有严重的疑问。

我的第一个问题：如果他们这么优秀，为什么他们的网站不是英文的？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T07:53:46.533

我对这个特定的产品并不熟悉，但我对无代码开发的“理论”（例如它）有些熟悉。

编程语言的原语存在是有原因的。因此，“无代码”或“基于鼠标”的开发系统有一种趋势，即逐渐积累与编程语言原语相对应的特性：类似于函数调用（用于重用设计部分）、函数内参数的引用，循环的事物，条件分支，将多个动作聚合成单个动作的事物，进行算术或字符串运算的事物等。到那时，它们最终会遇到与所有开发系统相同的问题，这些问题都源于用户在寻找更复杂的问题来解决时挑战极限。因此，他们需要重构和其他优秀的 IDE 风格的功能来帮助他们管理复杂性——到那时，“无代码”

我们甚至在使用文本源编程语言中的一组新原语“重新开始”的许多尝试中都看到了这种趋势。Haskell 并没有真正消除程序化、有状态的编码。它有一种模仿这些功能的方法，尝起来非常真实——因为如果没有，用户会尝试自己模拟它并弄错。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T07:57:13.280

我在他们的网站上做了一些阅读。

在我看来，他们为您构建了软件，声称您可以毫不费力地扩展这些软件。我没有看到他们声称您可以在不使用代码的情况下使用他们的软件来构建自己的软件。他们的理念用他们的话来说：

> Maatwerksoftware, die nooit veroudert, die u zelf kunt onderhouden én uitbreiden en die bovendien wordt gemaakt waar u bij staat。

那是：

> 根据您的要求构建的软件，永不过时，您可以自己维护，并且在您观看的同时制作。

我的结论是他们建造了它，而不是你。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-10T00:21:26.207

我见过的“无代码”或“图形”系统的结果总是最终不会降低真正的复杂性，缺点是没有协作，无法进行差异/补丁，无法进行版本比较，难以放入源代码控制等

简而言之，只是没有经过深思熟虑。

我敢打赌，它们也不能很好地扩展到大型数据集。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T07:37:26.457

我使用了[C Control](http://translate.google.com/translate?u=http%3A%2F%2Fwww.c-control.de&langpair=de|en&hl=de&ie=UTF-8)微控制器的可视化开发工具。尽管可以使用底层语言 (BASIC) 的几乎所有功能，但它发现这是浪费时间。“鼠标编码”简单循环比编写简单的 BASIC 代码花费的时间更长。

在我开始编码和开发的第一步中，我尝试了其他产品（主要是游戏创建者），但它们总是要么缺乏通常在编码语言中可用的功能，要么使用起来很慢。

但在过去几年中，我注意到越来越多的人不再愿意阅读他们第一次阅读时无法理解的（自然）文本。只是一个从属条款，他们不想继续。

所以我想这种无代码开发工具是有市场的，因为你可以很容易地得到结果，而且学习曲线要​​低得多。我使用的大多数工具都是不言自明的。

恕我直言，无代码开发环境最适合

*   初学者
*   不想学习编码的人

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T08:31:29.750

这种方法看起来很棒，值得考虑。即使它仍处于实验阶段：[http ://subtextual.org/subtext2.html](http://subtextual.org/subtext2.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-18T15:19:28.060

Encanvas is completely codeless. It was originally created back in the day to author enterprise-grade situational applications but in the last decade has been used to build anything from spreadsheet replacement type apps to regional traffic systems, business intelligence platforms and eLearning applications.

encanvas doesn't come cheap. It's engineered to enable IT teams to move away from coding and comes with all of the tools you'd expect including cloud deployment.

encanvas is built on .net.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-10T00:10:03.297

在考虑无代码软件时，会想到诸如[Scratch 或 Lego MindStorms 之类的东西。](http://www.newscientist.com/blog/technology/2007/05/coding-made-simple.html)但这似乎是在帮助某人编写代码，而不是 100% 无代码。我认为这就是它必须工作的方式，以免受到如此限制。随着时间的推移，就像所有语言/API 一样，它会得到改进，越来越多的人会拿出自己的编码块桶，使其更加通用。不管发生什么，尽管我总是希望有一种方法来调整所有生成的代码，就像一个所见即所得的 HTML 编辑器一样。一开始会很困难，但随着时间的推移只会变得更好。但无论如何，手工编码永远是至高无上的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-09T22:38:19.363

80 年代后期有 Borland 的 ObectVision。

[您可以从废弃软件站点](http://vetusware.com/download/Borland%20ObjectVision%202.1/?id=3424)下载副本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-11T13:14:06.553

回复geocar的帖子..（不能再回复我自己的帖子了）

很难说与其他 I4GL 的区别是什么，因为我不知道那里的所有工具，但让我这样说。如果将 Codeless 与 MS CRM 4.0 和 Microsoft M 进行比较，您认为 I4GL 工具的区别是什么？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T07:51:53.947

我已经测试了版本 1，当前版本是 2。但是由于没有可用的英文文档，我对如何按照我们的要求继续构建我们的应用程序感到有点困惑。

不过，提供的样品看起来令人印象深刻。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-17T08:06:35.243

只是我的两分钱，无代码开发背后的想法不仅适用于初学者/不想学习编码的人，还可以用来教年幼的孩子编程，并将其用作讲故事的媒介。

当然，我指的是[爱丽丝](http://www.alice.org/)。

它有它的市场，但我不认为它会取代传统的编程（例如，在键盘上打字），因为它很笨重。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-17T08:11:55.450

对这类产品的适当立场是极端怀疑。我清楚地记得这...

[最后一个](http://teblog.typepad.com/david_tebbutt/2007/07/the-last-one-pe.html)

这是一款于 1981 年发布的产品（！），它声称通过无代码生成商业应用程序使程序员变得多余。

也就是说，我目前正在使用无代码开发环境 - [Wirefusion](http://www.demicron.com/wirefusion/) - 来生成 3D 交互式 Java 小程序。它非常好，但它针对的是定义非常明确的域，甚至存在一些问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-22T17:09:19.333

证据就在布丁里；我不明白为什么这个伯纳德删除了我们是谁。如果 15 年来一直试图做同样事情的亿万富翁、前微软大师查尔斯西蒙尼在这里发表评论，他会被删除吗？David Roth，Simparel, Inc. 首席远见者。 Simparel dot com 的 David.Roth。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-22T17:31:17.610

我的老板有一种无需编写代码即可生成应用程序的好方法。他有一个自动程序员（我）为他编写。他使用特定领域的语言，并获得了一个工作应用程序。任何做同样工作的东西都必须和那个一样聪明（或愚蠢）。

在传达需求时，会使用符号语言，无论是键盘点击、鼠标点击还是任何其他形式的输入。

如果一种语言能很好地映射到用户概念并且允许误解或不一致的空间很小，那么它就是一种很好的领域特定语言。

尝试找到更好的领域特定语言是件好事。
如果你没有一个，那么尝试出售一个是不好的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-02-08T16:58:32.907

> 所以我想这种无代码开发工具是有市场的，因为你可以很容易地得到结果，而且学习曲线要​​低得多。我使用的大多数工具都是不言自明的。
> 
> 恕我直言，无代码开发环境最适合
> 
> 不想学习编码的初学者

确实如此 - 并且是由neaComponents 无代码开发平台完成的。

看看针对这些用户的 www.clearString.com

大卫

# lambda - 什么是 lambda，什么是示例实现？

> ID：373832
> 
> 赞同：6
> 
> 时间：2008-12-17T06:49:49.733
> 
> 标签：lambda

我对编程相当陌生，在阅读大量 lambda 概念的同时，不断出现这种概念，但我很难弄清楚它实际上是什么，以及如何实现它将使我的编程生活变得更好。那么首先，什么是 lambda，其次它是如何实现的？

感谢所有发帖的人。正如评论中提到的，这是重复的，但是这里有很多很棒的答案，我想为社区保留它们，所以我将它变成了社区帖子。这是另一个问题的链接：

[什么是 lambda（函数）？](https://stackoverflow.com/questions/16501/what-is-a-lambda-function)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-17T09:27:47.903

Lambda 很难捕捉，但一旦你描绘了它们，你就无法理解为什么以前没有得到它。

## lamdba 是匿名函数

Lambda 是普通函数，**唯一的区别是你没有给它们命名。**

要理解这一点，您必须首先知道，当您创建一个函数时，代码存储在内存中的一个只有计算机知道的地址。

所以当你做这样的事情时：

```
function Foo ()
{
 /* your code here */
} 
```

您真正要做的是将名称“Foo”绑定到内存中代码的地址。

现在，还有另一种访问地址的方法：**引用**（和指针，但让我们跳过这个讨厌的家伙）

嗯，一个 lambda 函数是一个没有名字的函数，所以它只能通过它的引用来访问。

## 你如何使用它们？

创建 lambda 函数时，*通常只计划使用一次。*

一步一步的过程通常是：

1.  创建函数
2.  获取参考
3.  将引用传递到将要使用的地方

最后，引用丢失，因此函数被自动销毁。

典型的用例是回调函数。您在一行中声明、创建和传递函数，因此很方便。

## 来自真实单词的示例

在 Python 中，您可以在列表推导中使用 lambda：

```
/* create a list of functions */
function_list = [(lambda x : number_to_add + x) for number_to_add in range(0, 10) ] 
```

在 Javascript 中，您通常将一个函数传递给其他函数。使用 JQuery 的示例：

```
 $("img").each(

 /* here we pass a function without any name to the "each()" method   */

 function(i){  his.src = "test"   i   ".jpg"; }

 ); 
```

## 你最好知道的事情

*   一些语言，如 Javascript 或 Lisp，大量使用 lambda。这可能是出于文化原因，但函数式编程范式往往会导致 lambda 狂热。

*   长 lambdas 使代码难以阅读。这就是为什么某些语言限制了 lambdas 的可能性，例如不允许在其中使用“if”语句的 Python。

*   Lambda 只是普通函数。无论您在哪里使用，都可以使用普通函数。这只是编码风格的问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-17T06:54:39.147

lambda 是函数的内联描述。它起源于函数式编程语言，而现在支持类似它的其他语言的数量正在增长。这个名字来自一个叫做 Lambda 演算的数学东西，它影响了函数式编程语言（例如 Lisp），而 lambdas 的想法也来自它。

您的问题取决于您正在谈论的编程语言。例如，在 F# 中，您将使用`fun x -> x * x`来表示

```
int myfunction(int x) { return x * x; } 
```

在 C# 中，您将使用`x => x * x`来表示相同的函数。它的使用方式以及您可以用它做什么几乎取决于您使用的语言。

谈到 C#，关于它们的伟大之处在于能够将它们解析为*表达式树*。lambda 表达式可以用作代码，如**委托**（大致是函数指针）或表达式树中的数据。将它们用作表达式树，使 LINQ to SQL 等库能够使用表达式创建 SQL 语句，以便提交到服务器并获得适当的结果。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-17T07:53:47.937

Lambda 是一种创建匿名函数或闭包的方法。在命令式语言（和函数式语言）中，它等效于允许嵌套函数，其中**内部函数可以访问**封闭函数的局部变量和参数。它在函数式语言中的关键字`lambda`,甚至;下找到`fun`。在 Smalltalk 中它被称为*块*。它也存在于大多数脚本语言中，例如 Perl、Python、Lua 等。`fn``\`

 *关于**没有**lambda 的唯一语言是

*   没有嵌套函数的语言，例如标准 C 或图标

*   具有二等嵌套函数的语言——一个函数不能从函数返回，不能存储在全局变量中，也不能存储在堆分配的数据结构中。该语言家族包括 Pascal 及其在 Modula、Ada 和 CLU 家族中的后代。

Lambda 对程序员和编译器编写者具有重要意义：**不再可能将所有局部变量存储在堆栈上**。相反，可以**捕获**一些变量并将其存储在堆分配的闭包中。请注意，**当您编写 lambda 时，您正在编写分配**。

示例：最简单的函数之一是组合（Haskell 语法）：

```
compose f g = \x -> f (g x) 
```

这表示`compose`接受两个函数`f`和`g`作为参数，它返回一个匿名函数，该函数接受它的参数，`x`然后应用到. 的应用程序创建一个**分配在堆上的闭包，该闭包**存储 和 的值以及指向 lambda 主体代码的指针。在 lambda 很常见的语言中，例如 Haskell、ML、Caml 和 Scheme，已经花费了大量的精力来**使分配速度非常快**`g``f``x``compose`**`f``g`**. 一些脚本语言，比如 Lua，有不寻常的实现，它们使非 lambda 的情况与命令式语言中的情况相同，同时也使 lambda 相当快。Lambda 在 Smalltalk 中也很快，它也被**设计为在堆上分配大量对象**。在改进了 lambda 的语言中，例如 Perl 或 Java（内部类与 lambda 相关），费用可能相对高得多。****

 ****一般来说，如果一种语言在设计时考虑到了 lambda，那么您可以随心所欲地使用它们。尤其是在 ML、Caml、Scheme、Haskell 中，**即使是匿名函数也非常便宜**——大量使用它们！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-17T06:58:11.527

*lambda*在编程世界中的意思是一个匿名函数，可以像其他普通变量一样传递和返回。所谓的函数式语言内置了它们，但最近有越来越多的语言支持它们，因为它们允许编写可重用的代码。例如，用下一版本的 C++ 编写：

```
// write this once...
int transform_values(int * values, int n, function<int(int)> f) {
    for(int i = 0; i < n; i++)
        values[i] = f(values[i]);
}

int values[] = { 1, 2, 3, 4 };
// ... then call it to double the values in an array
transform_values(values, 4, [](int v) { return v * 2; }); 
```

它在 C# 和其他支持 lambda 的语言中看起来确实很相似。现在有“闭”字。这意味着 lambda 可以*捕获*局部变量并在计算结果时使用它们：

```
int local_variable = 5;
int values[] = { 1, 2, 3, 4 };
// ... then call it to multiply the values in an array
transform_values(values, 4, [=](int v) { return v * local_variable; }); 
```

该变量`local_variable`现在被捕获在闭包内，并且可以在其中使用。变量也可以通过闭包来更新。Lambda 是函数式语言的基本构建块。这是haskell中的一个例子：

```
map (\x -> x * 2) [1, 2, 3, 4] 
```

将执行与上面的 C++ 代码相同的操作。它使用给定函数（此处为 lambda）将列表中的值映射到结果列表中。使用 haskell，您可以很好地看到使用的语法如何映射到[Lambda 演算](http://en.wikipedia.org/wiki/Lambda_calculus)的数学概念。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-17T06:53:53.220

Lambda 是[lambda calculus](http://en.wikipedia.org/wiki/Lambda_calculus)，但我认为人们可以将它与[闭包](http://en.wikipedia.org/wiki/Closure_%28computer_science%29)一词互换使用。请参阅[什么是闭包？](https://stackoverflow.com/questions/36636/what-is-a-closure)

Ruby 的实现很容易理解并且非常强大。在下面的代码`times`方法中，接受大括号之间的代码块并调用它`HEIGHT`。您可以定义接受代码块并实现循环构造的类似方法。

```
@cells = []
HEIGHT.times { @cells << empty_row } 
```

我想如果有一个参数会更有趣。

```
5.times { |i| puts i, " " } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T06:53:53.253

Lambda 对不同的语言有不同的含义。我在 python 的上下文中了解它们，但我听说 python 与其他语言有不同的方法。

本质上，在 python 中，lambda 是一个匿名函数，只能由一个表达式组成，并返回其结果。

我知道在其他语言中，它们是更通用的匿名函数，没有单一表达式的限制，但我不确定细节。

一个匿名函数，就是它听起来的样子。一个没有名字的函数。例如，它们经常用作事件处理程序，或者您需要一个简单的回调函数但又不想弄乱命名空间的任何情况。

# java - Java 的最佳 XML 解析器

> ID：373833
> 
> 赞同：395
> 
> 时间：2008-12-17T06:52:16.330
> 
> 标签：java, xml, parsing

我需要阅读较小的（最多几 MB，UTF-8 编码）XML 文件，四处寻找各种元素和属性，也许修改一些并将 XML 再次写回磁盘（最好使用漂亮的缩进格式） .

什么是满足我需求的最佳 XML 解析器？有很多可供选择。我知道的一些是：

*   [JDOM](http://www.jdom.org/)
*   [伍德斯托克斯](http://wiki.fasterxml.com/WoodstoxHome)
*   [XOM](http://xom.nu/)
*   [dom4j](http://dom4j.sourceforge.net/)
*   [VTD-XML](http://vtd-xml.sourceforge.net/)
*   [Xerces-J](http://xerces.apache.org/xerces-j/)
*   [赤红](http://xml.apache.org/crimson/)

当然还有 JDK 中的那个（我使用的是 Java 6）。我对 Xerces 很熟悉，但觉得它很笨重。

建议？

* * *

## 回答 #1

> 赞同：260
> 
> 时间：2008-12-17T08:02:28.933

我认为您不应该考虑任何特定的解析器实现。[用于 XML 处理的 Java API](http://en.wikipedia.org/wiki/JAXP)允许您以标准方式使用任何符合标准的解析器实现。代码应该更易于移植，当您意识到特定解析器已经过时，您可以用另一个替换它而无需更改代码行（如果您做得正确的话）。

基本上以标准方式处理 XML 的方式有以下三种：

*   [SAX](http://en.wikipedia.org/wiki/Simple_API_for_XML)这是最简单的 API。您可以通过定义一个 Handler 类来读取 XML，该类在 XML 以串行方式处理时接收元素/属性中的数据。如果您只打算读取一些属性/元素和/或写回一些值（您的情况），它会更快更简单。
*   [DOM](http://en.wikipedia.org/wiki/Document_Object_Model)此方法创建一个对象树，允许您随机修改/访问它，因此它更适合复杂的 XML 操作和处理。
*   [StAX](http://en.wikipedia.org/wiki/StAX)它位于 SAX 和 DOM 之间的路径中间。您只需编写代码以在处理数据时从您感兴趣的解析器中提取数据。

忘记诸如 JDOM 或 Apache 之类的专有 API（即[Apache Xerces XMLSerializer](http://xerces.apache.org/xerces-j/apiDocs/org/apache/xml/serialize/XMLSerializer.html)），因为它们会将您绑定到可以及时发展或失去向后兼容性的特定实现，这将使您在将来想要升级到时更改代码新版本的 JDOM 或您使用的任何解析器。如果您坚持 Java 标准 API（使用工厂和接口），您的代码将更加模块化和可维护。

没有必要说所有（我没有检查所有，但我几乎可以肯定）建议的解析器都符合 JAXP 实现，因此从技术上讲，您可以使用所有，无论哪种。

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2011-04-14T15:35:04.290

这是对 DOM、SAX、StAX 和 TrAX 的一个很好的比较（来源：http: [//download.oracle.com/docs/cd/E17802_01/webservices/webservices/docs/1.6/tutorial/doc/SJSXP2.html](http://download.oracle.com/docs/cd/E17802_01/webservices/webservices/docs/1.6/tutorial/doc/SJSXP2.html)）

> **特征 StAX SAX DOM TrAX**

**API 类型**                Pull,streaming Push,streaming 内存树 XSLT 规则

**易用性**          高 中 高 中

**XPath 功能**   否 否 是 是

**CPU 和内存**     好 好 不一样 不一样

**仅转发**        是 是 否 否

**读取 XML**              是 是 是 是

**写入 XML**              是 否 是 是

**CRUD**                      否 否 是 否

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2008-12-17T08:04:54.420

如果速度和内存都没有问题，*dom4j*是一个非常好的选择。如果您需要速度，使用像*Woodstox*这样的 StAX 解析器是正确的方法，但是您必须编写更多代码才能完成工作，并且您必须习惯于在流中处理 XML。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-07-23T19:07:32.520

简单的 XML [http://simple.sourceforge.net/](http://simple.sourceforge.net/)非常容易（反）序列化对象。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-18T01:32:15.833

除了 SAX 和 DOM 之外，还可以使用 XMLStreamReader 进行 STaX 解析，XMLStreamReader 是一个 xml 拉解析器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-17T07:11:56.600

我发现 dom4j 是处理 XML 的工具。尤其是与 Xerces 相比。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-18T01:42:47.390

我不建议您这样做，因为您的应用程序中有很多“思考”，但使用 XSLT 可能比 Java 操作更好（并且使用 XSLT 到字节码的编译可能更快）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-18T01:33:36.253

如果您不太关心性能，我是 Apache Digester 的忠实粉丝，因为它本质上允许您直接从 XML 映射到 Java Bean。

否则，您必须先解析，然后再构造对象。

# groovy - 备用 groovysh.profile 脚本

> ID：373837
> 
> 赞同：1
> 
> 时间：2008-12-17T06:53:58.323
> 
> 标签：groovy

有没有办法在命令行覆盖`groovysh.profile`/`groovysh.rc`文件的位置？例如

```
GROOVYSH_RC=one_time_groovysh_rc groovysh 
```

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T01:02:54.317

在查看 Groovysh.groovy 的源代码时，它调用了这个方法：

```
File getUserStateDirectory() {
    def userHome = new File(System.getProperty('user.home'))
    def dir = new File(userHome, '.groovy')
    return dir.canonicalFile
} 
```

看起来您可以设置“user.home”属性来更改根目录，但它仍然需要该目录中的 .groovy (-Duser.home="/foo")。

# ldap - LDAP Authentication using CGI+TCL

> ID：373852
> 
> 赞同：1
> 
> 时间：2008-12-17T07:01:27.043
> 
> 标签：ldap, cgi, tcl

How can I authenticate a user with LDAP using CGI/TCL stack?

Please provide a sample code-snippet if possible.

* * *

I am using an Apache Web Server on RHEL 5.0; AD exists on a remote Win2003 server.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T07:30:38.793

Here's the [ldap package](http://tcllib.sourceforge.net/doc/ldap.html). You first bind using some "bind user" who can see everyone. You then search for the user based on some attribute like e-mail address or [sAMAccountName](http://msdn.microsoft.com/en-us/library/ms679635.aspx). If the user exists, bind again using the given password and the full path of the user.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T17:51:06.810

Here is an example that will connect to an ldap server and retrieve all of the info ldap has about an email address:

```
package require ldap
set sEmailAddress "user@example.com"

set handle [::ldap::connect example.com 3268]
ldap::bind $handle

set result [::ldap::search $handle "dc=example,dc=com" "(mail=$sEmailAddress)" {sAMAccountName}]

foreach {object attributes} $result {
  foreach {name val} $attributes {
    puts "$name\t$val"
  }
} 
```

# .net - 在进入编辑模式时捕获第一个字符 - DataGridView 中的自定义编辑控件

> ID：373856
> 
> 赞同：4
> 
> 时间：2008-12-17T07:06:36.970
> 
> 标签：.net, winforms, datagridview

我在 a 中托管了一个自定义编辑控件，`DataGridView`据记录，它是 a`TextBox`和`Button`一起在 a 中`UserControl`。我继承`DataGridViewColumn`了新列和`DataGridViewTextBoxCell`新单元格。

正常情况`DataGridViewTextBoxCell`下，如果您在单元格获得焦点时按下某个键，它将进入编辑模式**，**您键入的字符将出现在`TextBoxEditingControl`. 但是，在我继承的单元格中，按键没有传递任何值。（事实上​​，您必须手动传递当前单元格值，`InitializeEditingControl`否则根本不会显示任何内容。）因此，您键入的第一个字符（开始编辑模式的字符）丢失了。

我已经尝试过`OnKeyPress`,`OnKeyDown`和`OnKeyUp`in ，`DataGridViewCell`但他们从未被调用过。`KeyEntersEditMode`但是，似乎确实被调用了，并且仅在它检查按下的键时才被调用，因此这可能是一个不错的起点。那么问题就变成了如何将 KeyEventArgs 转换为`char`. 这对于字母和数字来说是微不足道的，但由于并非所有键盘都是平等的，因此处理其他键充其量是混乱和复杂的。如果有一个转换器类可以自动执行此操作，请赐教。

有没有其他人遇到过这个问题或找到了一个好的解决方法？

注意：此问题适用于`EditMode`设置为 的任何变体时`EditOnKeystroke`。设置为`EditOnEnter`对我的项目来说是一个有效的解决方法，但我也想模拟默认行为`TextBoxEditingControl`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-09T10:27:40.630

尝试将用户控件的 KeyPreview 设置为 true。然后检查启动编辑过程的键是否会触发 keydown，即使对于用户控件也是如此。如果是这样，您可以在文本控件进入编辑模式后简单地存储和分配字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-01T06:31:36.700

我的解决方案是覆盖`OnKeyPress`自定义`UserControl`.

```
protected override void OnKeyPress(KeyPressEventArgs e)
{
  _textBox.Text = e.KeyChar.ToString();
  _textBox.SelectionStart = 1;
  _textBox.SelectionLength = 0;
  base.OnKeyPress(e);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-31T12:59:25.980

Hi Today I had the same problem. My solution is to override KeyEntersEditMode in CustomCell and put there some algorithm to convert or to determine if a character is valid for passing to the editing control. Then I store this value as a private variable. I override the InitializeEditingControl method and use my stored value as the initial value for the control. After using it I set it to null so that later nothing would use it.

```
 private string startString;
public override bool KeyEntersEditMode(KeyEventArgs e)
{
    var result = base.KeyEntersEditMode(e);
    if (e.KeyData == Keys.D1)
    {
        startString = "1";
    }
    return result;
}

public override void InitializeEditingControl(int rowIndex, object initialFormattedValue, DataGridViewCellStyle dataGridViewCellStyle)
{
    if(startString != null)
    {
        initialFormattedValue = startString;
        startString = null;
    }
    base.InitializeEditingControl(rowIndex, initialFormattedValue, dataGridViewCellStyle);
    var c = this.DataGridView.EditingControl as MyEditingControl;
    string initialFormattedValueStr = initialFormattedValue as string;
    if (initialFormattedValueStr == null)
    {
        c.Text = string.Empty;
    }
    else
    {
        c.Text = initialFormattedValueStr;
        c.SelectionStart = initialFormattedValueStr.Length;
    }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-24T22:29:07.290

要将第一个字符放入 TextBox，请执行以下操作：

1) 添加“Imports System.Runtime.InteropServices”或者如果你喜欢 C# 可以使用

2) 在 user32.dll 中添加到 SendMessage 的映射

```
VB.Net example:
<DllImport("user32.dll", SetLastError:=True, CharSet:=CharSet.Auto)> _
Private Shared Function SendMessage(ByVal hWnd As IntPtr, ByVal Msg As Integer, ByVal wParam As IntPtr, ByVal lParam As IntPtr) As IntPtr
End Function

C# example:
[DllImport("USER32.DLL", CharSet = System.Runtime.InteropServices.CharSet.Auto)]
private static extern IntPtr SendMessage(IntPtr hWnd, int msg, IntPtr wParam, IntPtr lParam); 
```

3) 将密钥从 UserControl 重定向到您的 TextBox

```
Protected Overrides Function ProcessKeyEventArgs(ByRef m As System.Windows.Forms.Message) As Boolean
    SendMessage(Me.ComboBox.Handle, m.Msg, m.WParam, m.LParam)
    Return True
End Function

protected override bool ProcessKeyEventArgs(ref Message m)
{
    SendMessage(textBox.Handle, m.Msg, m.WParam, m.LParam);
    return true;
} 
```

4）[微软页面上有示例，这里有DataGridViewNumericUpDown](http://msdn.microsoft.com/en-us/library/aa730881%28v=vs.80%29.aspx)，下载源代码。

5) 完成。

# asp.net - 将无序列表项（ul）并排浮动

> ID：373863
> 
> 赞同：1
> 
> 时间：2008-12-17T07:08:32.083
> 
> 标签：asp.net, html, css, stylesheet

我想并排放置两个子无序列表。他们有类名 L 和 R

这是 HTML 标记的相关部分。

```
<ul class="SearchResult">
<li class="Pagination">
<a id="lnkPageNumber_top_1" class="ACTIVE" onclick="ShowPage(this.id);" style="cursor: pointer;">1</a>
<a id="lnkPageNumber_top_2" onclick="ShowPage(this.id);" style="cursor: pointer;">2</a>
</li>
<li>
<ul class="L">
<li style="border: medium none ;">
</li>
<li class="Pagination">
<a id="lnkImagePageNumber_1" class="ACTIVE" onclick="ShowImage(this.id);" style="cursor: pointer;">1</a>
<a id="lnkImagePageNumber_2" onclick="ShowImage(this.id);" style="cursor: pointer;">2</a>
<a id="lnkImagePageNumber_3" onclick="ShowImage(this.id);" style="cursor: pointer;">3</a>
<a id="lnkImagePageNumber_4" onclick="ShowImage(this.id);" style="cursor: pointer;">4</a>
</li>
</ul>
<ul class="R">
<li class="T">Rose Villa</li>
<li>
<span>
<strong>Price</strong>
: Rs. 2,000,000
</span>
</li>
<li>
<strong>Features</strong>
:
<img height="16" width="16" src="bed.png" alt="Beds:" title="Bedrooms"/>
3
<img height="16" width="16" src="bath.png" alt="Baths:" title="Bathrooms"/>
3
</li>
</ul>
</li>
</ul> 
```

应用的样式表是这个

```
ul.SearchResult { width:100%; list-style:none; }
ul.SearchResult li { margin:2px; height:200px; border:solid 1px #B5D335;clear:left; }
ul.SearchResult img { padding:0px; margin:0px; width:235px; height:156px; border:none }
ul.SearchResult li.Pagination { padding:5px; height:auto; }
ul.SearchResult li.Pagination a { color:#669900; font-weight:bold; }
ul.SearchResult li.Pagination a:hover { color:#FF9900; }
ul.SearchResult li.Pagination a.ACTIVE { color:#FF9900; border:solid 1px #B5D335; padding-left:3px; padding-right:3px; }
ul.SearchResult li ul {float:left; list-style:none; }
ul.SearchResult li ul.L { width:245px;} /* Set as Television set BG */
ul.SearchResult li ul.R { width:292px;}
ul.SearchResult li ul li { padding:3px; border:none; height:auto; border-bottom:dotted 1px #C9C9C9; }
ul.SearchResult li ul li.T { text-transform:uppercase; color:#44962A; font-weight:bold }
ul.SearchResult li ul li span { display:table-cell; min-width:125px; width:auto; }
ul.SearchResult li ul li a { color:#44962A; }
ul.SearchResult li ul li a:hover { color:#FF9900; } 
```

但是并排对齐根本不起作用。有什么问题？H？PS：是的，我[在列表项中看到了浮动 div，](https://stackoverflow.com/questions/93625/float-divs) 其中提到了它的 DIV，这里提到了 ul。“clear:left”是否适用于机器人？

对于 CSS 专家来说，这可能是重复的帖子，但我不是。所以请多多包涵[:)]

编辑说明：- 要详细解释这些内容，请使用图像 [替代文本 http://www.yetanothercoder.com/img.jpg](http://www.yetanothercoder.com/img.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T10:34:59.390

在您的 UL 中添加 clear:none 应该对其进行排序，因此：

```
ul.SearchResult li ul {float:left; clear:none; list-style:none; } 
```

浮动将定位元素，但要让其他元素定位在它旁边，而不是在它下面，你需要应用 clear:none :)

希望这可以帮助！

# linq-to-sql - 对存储在 LinqToSql 连接表中的父子关系进行建模的最佳方法是什么？

> ID：373865
> 
> 赞同：0
> 
> 时间：2008-12-17T07:10:45.357
> 
> 标签：linq-to-sql

为了简化我目前的情况，假设我有 2 个表（旧的所以不能接触架构以更好地使用 Linq）

```
node
Columns: key_field1, key_field2, [lots of other fields]

node_children
Columns: parent_key_field1, parent_key_field2, child_key_field1, child_key_field2 
```

node_children 类似于 Rails 中的 has_and_belongs_to_many 连接表...除了两个 id 引用同一个表。

理想情况下，我希望有一个具有子属性的节点类，它返回正确的列表？结果应该等同于

```
select * from node 
join node_children 
on node.key_field1 = node_children.child_key_field1 and node.key_field2 = node_children.child_key_field2
where node_children.parent_key_field1 = @paramX and node_children.parent_key_field2 = @paramY 
```

在 Linq to Sql 中对此进行建模的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T14:26:43.857

This is what I came up with (works too!)
Open up the ORM generated Node class MyDatabase.cs

```
partial class Node
{
  public IEnumerable<Node> Children
  {
    get
    {
      MyDatabaseDataContext dc = new MyDatabaseDataContext();
      return from link in this.ChildLinks
          join node in dc.Nodes on new { Site = link.child_key_field1, ID = link.child_key_field2 } equals new { Site = node.key_field1, ID = node.key_field2 }
          select node;

    }
  }
} 
```

*   The ORM designer automatically adds an association between the two tables. I renamed the property on the Node class to ChildLinks.
*   (This drove me up the wall for a couple of hours) For the LINQ join to work with composite keys, you need the **Name as well as Order** of each part to match. See [How to: Join by Using Composite Keys](http://msdn.microsoft.com/en-us/library/bb907099.aspx)

One of these days, I'm gonna complete the LINQ Getting Started set of articles :)

# c# - C#：如何在 Windows 应用程序中从 webbrowser 读取数据

> ID：373872
> 
> 赞同：4
> 
> 时间：2008-12-17T07:13:18.517
> 
> 标签：c#, http

**首先，我正在做一个 Windows 应用程序。不是网络应用程序。**

现在我正在应用程序将 SMS（短消息）从系统发送到移动设备。

在这里，我使用 http URL 来推送具有参数 To（数字）和 Msg（测试消息）的消息。

在形成 URL 之后，比如

[http://333.33.33.33:3333/csms/PushURL.cgi?USERNAME=xxxx&PASSWORD=xxxx&MOBILENO=919962391144&MESSAGE=TestMessage&TYPE=0&CONTENT_TYPE=text](http://333.33.33.33:3333/csms/PushURL.cgi?USERNAME=xxxx&PASSWORD=xxxx&MOBILENO=919962391144&MESSAGE=TestMessage&TYPE=0&CONTENT_TYPE=text) ;

这里我提到 3 代表 IP 地址，X 代表密码和用户 ID，因为它是保密的。

发送此 URL 后，我在浏览器窗口中收到一些文本，例如“消息发送成功”。

只是我想阅读文本并存储在数据库中。

我的问题是：我如何从网络浏览器中读取文本。

请抱住我！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T07:17:52.970

使用 .NET，请参阅[WebClient 类](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)- 提供用于向由 URI 标识的资源发送数据和从其接收数据的常用方法。

在这里见过几次，例如[下载网页的最快 c# 代码](https://stackoverflow.com/questions/26233/fastest-c-code-to-download-a-web-page)

**编辑**：`System.Net.WebClient`该类未连接到 Web 应用程序，可以在控制台或 winforms 应用程序中轻松使用。MSDN 链接中的 C# 示例是一个独立的控制台应用程序（编译并运行它以检查）：

```
using System;
using System.Net;
using System.IO;

public class Test
{
public static void Main (string[] args)
{
    if (args == null || args.Length == 0)
    {
        throw new ApplicationException ("Specify the URI of the resource to retrieve.");
    }
    WebClient client = new WebClient ();

    client.Headers.Add ("user-agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; .NET CLR 1.0.3705;)");

    Stream data = client.OpenRead (args[0]);
    StreamReader reader = new StreamReader (data);
    string s = reader.ReadToEnd ();
    Console.WriteLine (s);
    data.Close ();
    reader.Close ();
} 
```

}

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T07:17:15.047

这是来自 Microsoft 的[WebClient 类](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)的代码。

```
using System;
using System.Net;
using System.IO;

public class Test
{
    public static void Main (string[] args)
    {
        if (args == null || args.Length == 0)
        {
            throw new ApplicationException ("Specify the URI of the resource to retrieve.");
        }
        WebClient client = new WebClient ();

        // Add a user agent header in case the 
        // requested URI contains a query.

        client.Headers.Add ("user-agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; .NET CLR 1.0.3705;)");

        Stream data = client.OpenRead (args[0]);
        StreamReader reader = new StreamReader (data);
        string s = reader.ReadToEnd ();
        Console.WriteLine (s);
        data.Close ();
        reader.Close ();
    }
} 
```

# c# - 检查是否正在进行拖放

> ID：373873
> 
> 赞同：3
> 
> 时间：2008-12-17T07:14:45.783
> 
> 标签：c#, winforms, drag-and-drop

有没有办法检查拖放是否正在进行？一些可以检查的方法或win32 api？我知道我可以设置 AllowDrop 并使用事件，但在这种情况下它不起作用。基本上我想用代码检查是否正在进行**任何**拖放。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T19:27:41.433

我有一个类似的问题，我自己回答了（经过几个小时搞砸了）请参阅 -[我如何判断拖放是否已在 Winforms 中结束？](https://stackoverflow.com/questions/480156/how-do-i-tell-if-a-drag-drop-has-ended-in-winforms).

基本上，如果您按照earwicker 的建议进行操作，则需要在 DoDragDrop 调用附近开始拖放时设置标志。如果 QueryContinueDragEventArgs 指示删除或取消，您将需要在 DragDrop 事件和 QueryContinueDrag 中取消设置标志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T13:43:15.303

QueryContinueDrag 事件处理程序[http://msdn.microsoft.com/en-us/library/system.windows.forms.control.querycontinuedrag.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.querycontinuedrag.aspx)怎么样？您可以将处理程序挂钩到任何控件并检查是否有正在进行的拖放操作，然后如果需要取消它。

哎呀，对不起，我刚刚看到我之前的那个人已经提到了这一点。我坏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T07:35:36.833

GetCapture [API 函数](http://msdn.microsoft.com/en-us/library/ms646257(VS.85).aspx)可能是一个好的开始。基本上，当拖动操作开始时，源窗口“捕获”鼠标，这意味着即使鼠标离开窗口，它仍然会接收所有鼠标事件。

但是，应用程序也可以出于其他原因捕获鼠标，因此这不是 100% 可靠的。您可以尝试一下，看看它对您的效果如何。由于应用程序自己进行拖放处理，因此无法确定到底发生了什么。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-17T08:03:11.600

假设它只是在您自己的代码的上下文中，您可以识别代码中发生拖放的所有位置，并在操作期间将全局布尔标志设置为 true，然后在完成后返回 false。

那么下一个问题是，如何在您的应用程序中启动拖放操作？

# reporting-services - 针对 SQL Server 2000 安装 RS2008

> ID：373879
> 
> 赞同：1
> 
> 时间：2008-12-17T07:20:13.870
> 
> 标签：reporting-services, sql-server-2000, ssrs-2008

是否有机会针对 SQL Server 2000 实例安装 Reporting Services 2008？文档明确指出仅支持 SQL Server 2005 或 2008，但我认为无论如何我都应该询问绕过此限制的方法。

我应该提一下，我不是在谈论我的报告的数据源（它是一个远程数据源，可以是任何类型的 sql server）。我对报表服务器存储其内容的数据库感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-18T01:59:05.093

不，reportserver 和 reportservertempdb 需要 2005 或 2008。您可以从 2000 实例获取报表的数据，但您的报告服务数据库需要是 2005 或 2008。

请参阅：http: [//msdn.microsoft.com/en-us/library/ms157285.aspx](http://msdn.microsoft.com/en-us/library/ms157285.aspx)并阅读有关数据库服务器版本要求的部分

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T01:57:36.220

我不知道这是否可行，但是报告服务还取决于 SQL Server 代理服务（用于订阅）以及关系数据库，因此两者都需要兼容。如果您拥有 Reporting Services 2008，那么您（或您的组织）必须拥有某种 SQL Server 2008 许可证，因此我不明白您为什么要这样做，因为您可以安装 SQL 2008 数据库引擎来支持您的报表服务器（在同一台服务器上，否则您将需要额外的许可证）。

请记住，自 2008 年 4 月起，SQL Server 2000 不再受到 Microsoft 的主流支持，因此您应尽可能避免使用此版本实施新的基础架构或功能。您在上面描述的配置，即使您让它工作，也将不受 Microsoft 以及可能所有 ISV 和合作伙伴的支持。

# javascript - 使用 Javascript 禁用浏览器窗口的后退按钮

> ID：373880
> 
> 赞同：-1
> 
> 时间：2008-12-17T07:20:50.360
> 
> 标签：javascript

> **可能重复：**
> [禁用浏览器上的后退按钮](https://stackoverflow.com/questions/87422/disabling-back-button-on-the-browser)

嗨伙计们，我需要禁用浏览器窗口的后退按钮。当我点击后退按钮时，我需要使用警报或其他方式显示一条消息。任何人都可以帮助我

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T07:29:01.653

你不能让用户停留在你的页面上，但是你可以先给出一个是/否的提示。

阅读周围[有没有办法确定浏览器窗口已关闭？](https://stackoverflow.com/questions/261083/is-there-a-way-to-determine-that-the-browser-window-was-closed)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T07:24:31.817

简短的回答：不要。

如果您必须这样做，则设计有问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T07:30:47.530

当网页这样做时，我讨厌它。我建议先用另一种方法来处理您的页面的可用性。

# vba - 如何在 Outlook 2007 中将主题字段设为必填项？

> ID：373881
> 
> 赞同：1
> 
> 时间：2008-12-17T07:21:05.320
> 
> 标签：vba, outlook

我总是忘记在电子邮件中写主题，所以我想让主题字段成为必填项。你能帮我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T07:53:34.647

```
Private Sub Application_ItemSend(ByVal Item As Object, ByRef Cancel As Boolean)

  If Item.Subject = "" Then
    Item.Subject = InputBox("Please do not always forget the subject!")
  End If

  If Item.Subject = "" Then
    MsgBox "Won't send this without a subject."
    Cancel = True
  End If
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-17T15:39:19.480

我有一个类似的例程，它只是检查我是否提到了附件这个词，如果我想取消发送，它会提示我，我必须输入：

项目显示

这样我就可以去添加附件了。这样你就可以用一个消息框提示添加主题......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T13:25:35.600

```
Do While Item.Subject = ""
Item.Subject = InputBox("..")
Loop 
```

# asp.net - 在 Page_Load 之前处理事件

> ID：373885
> 
> 赞同：8
> 
> 时间：2008-12-17T07:24:10.087
> 
> 标签：asp.net, page-lifecycle, pageload

我有一个 asp.net 网页，其中包含在页面的 Page-Load 事件中处理的大量代码。我在页面上还有一个下拉框，应该使用新值重新加载页面，但我想在处理整个页面加载代码之前获取这个新值。我试图了解 ASP.NET 页面生命周期。

我应该将页面加载代码移到以后的事件中，还是有办法在页面加载事件开始之前获取下拉列表值的值？

TIA

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-17T08:02:48.183

我会使用 Page_PreLoad 而不是 Page_Init，因为它是在处理完所有回发数据之后引发的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T07:38:39.997

尝试 Page_Init

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T07:58:53.527

如前所述， Page_Init 是您想要的。但我恳请您使您的页面尽可能松散耦合。看看初学者的 MVP 模式。此外，请确保您的大部分逻辑都在您的域对象中。

Page_Load 事件中不应有太多代码。如果有，它应该被分解成简洁的方法，这样你就不会有疯狂的代码。

# ms-access - MSAccess：SELECT INTO NewTable 剪切长文本

> ID：373888
> 
> 赞同：2
> 
> 时间：2008-12-17T07:27:00.970
> 
> 标签：ms-access

当我使用（在 MS Access 2003 SP3 中）时：

```
SELECT * INTO NewTable FROM SomeQuery; 
```

MEMO 字段被转换为 TEXT 字段（限制为 255 个字符），因此较长的文本会被剪切。

查询本身的输出很好，没有被截断；仅在创建的新表中剪切文本。

更新：我设法将问题集中在查询中的 IIF 语句上。当我删除 IIF 时，新表包含 MEMO 字段，但在 IIF 中，相同的字段显示为 TEXT。奇怪的是，即使在使用 IIF 时，查询输出也会完整显示长字符串。只有当它被“复制”到新表（通过 INTO 语句）时，文本才会被剪切。

您知道 IIF 可能对 MEMO 字段造成的任何问题吗？

谢谢您的回答。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T07:33:14.187

您在这里有避免任何备忘录字段截断的[当前解决方法。](http://allenbrowne.com/ser-63.html)

在您的情况下，这可能是查询的属性表的结果，包括“ `set Unique`”值到是（强制比较备忘录字段，触发截断）或字段的格式属性，例如强制以大写字母显示（`>`）或小写 ( `<`)。

* * *

您使用的是什么 Access，您将文档保存为什么格式？

在 Access 2000 兼容格式中，单元格为[Excel5.0/95 格式](http://support.microsoft.com/kb/208801)：最多 255 个字符。

您是否有任何其他（非备忘录）字段具有冗长的值，您可以尝试选择，看看它是否也被截断？

* * *

如果输出正常，但新表中的导出确实截断了备注字段，您能否检查以下内容：

[在高级下的导出对话框中](http://www.access-programmers.co.uk/forums/archive/index.php/t-108089.html)，即使看起来您只能包含名称，但如果您非常小心地单击以展开未出现的列，您可以将数据类型更改为备忘录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T02:23:41.127

我刚刚在 A2K3 中测试了一个制作表并附加了一个备注字段。我可以毫不费力地将完整数据附加到备忘录字段。

也许您可以发布用于填充表的查询的 SQL。如果您正在对可以做到的备忘录字段进行排序（或分组），因为对备忘录字段进行排序应该会将它们截断为 255 个字符（尽管在测试中我只是在 A2K3 SP3 上运行了所有最新的 SP3 后补丁，仅排序不会截断，但 GROUP BY 会截断）。

另一个问题是，通常不建议在生产应用程序中使用 Make Table 查询。任何重复发生的事情以至于您为其编程确实应该附加到预定义的表中，而不是替换现有的表。一方面，预定义的表可以在其上定义索引，这使得在填充后使用起来更加高效。当然，您必须在添加新数据之前删除现有记录，但在索引方面的好处是相当大的。而且，是的，您可以在每次运行 Make Table 查询时重新定义索引，但是，如果删除现有数据太麻烦，那么为新创建的表添加索引不是*更多的工作吗？*

我几乎从不使用 Make Table 查询，除非我正在处理我正在为其他目的按摩的数据。您最终会在目标表中使用哪些数据类型并不总是可预测的，因为它部分取决于源表中的数据。仅这一点就使得在大多数情况下使用它们是不可取的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T11:06:44.287

2003年的SP3臭名昭著，可能与此有关。有一个修补程序：

[http://support.microsoft.com/default.aspx/kb/945674](http://support.microsoft.com/default.aspx/kb/945674)

# jsp - 无法使用 Apache Tomcat 将简单的类/包导入简单的 JSP 页面

> ID：373895
> 
> 赞同：0
> 
> 时间：2008-12-17T07:33:01.957
> 
> 标签：jsp, class, tomcat, import, package

有人可以指导我使用 Tomcat 在 JSP 中加载类或包的过程吗？

我认为这可能只是 Tomcat 设置问题：我的 JSP 文件运行良好，无需导入或使用 dbpool 或 dbpooljar。我已经尝试了许多其他人类似问题的建议，但没有任何运气。任何帮助将不胜感激！

我的类/包放在 web-inf/classes 中（以及其他地方）

```
package dbpooljar;
public class DBPool
{   
   public DBPool()
   {
     System.out.println("dbpool evidence!");
   }
 } 
```

我的编译命令

```
javac "C:\website\apache-tomcat-6.0.18\webapps\ROOT\WEB-INF\classes\dbpool.java"
jar cf "C:\website\apache-tomcat-6.0.18\webapps\ROOT\WEB-INF\classes\dbpooljar.jar" DBPool.java 
```

我的*index.jsp*

```
<%@ page import="java.sql.*,java.util.List,java.util.ArrayList,DBPool" %>

<html>
  <body>
    Getting Length of a String
    <%
        String s1 = "Length of a String!";
        out.println("\"" + s1 + "\"" + " is  of   "  +  s1.length() +   " characters ");
        DBPool test=new DBPool();
    %>
  </body>
</html> 
```

最后是我的可怕错误（当我尝试不同的事情时）

```
An error occurred at line: 9 in the generated java file
The import DBPool cannot be resolved 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T12:50:56.650

您已输入

[%@ page import="java.sql.*,java.util.List,java.util.ArrayList, **DBPool** " %]

但

```
package dbpooljar;
public class DBPool { ... 
```

因此，应该是

[%@ page import="java.sql.*,java.util.List,java.util.ArrayList, **dbpooljar.DBPool** " %]

另外，您的 java 文件应位于名为 WEB-INF/classes/dbpooljar 的目录中，或者如果您坚持打包 jar 文件，请将 jar 文件放在 WEB-INF/lib

当然，尖括号“[”和“]”是正确的 xml 括号“<”和“>”——我在这里保留它们是为了能够使用粗体字体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T19:33:44.003

我不了解 Windows，但在 linux 中有一个文件（/usr/share/tomcat5/conf/jkconfig.manifest），您可以编辑它以将特定的 jar 添加到正在运行的 tomcat 实例中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-21T17:05:03.503

我知道这个问题很老，但我想我还是会给出答案。

Tomcat现在的工作方式，至少在你的WEB-INF目录下应该有两个文件夹，一个叫classes，一个叫lib。据我了解，.class 文件位于 WEB-INF/classes 中，.jar 文件位于 WEB-INF/lib 中。此外，如果您要将 .class 文件声明为包中，则它需要位于适当的目录中；在您的情况下，这意味着它应该位于 WEB-INF/classes/dbpooljar/DBPool.class。

希望对某人有所帮助。

# c++ - 为什么 stdafx.h 以它的方式工作？

> ID：373900
> 
> 赞同：11
> 
> 时间：2008-12-17T07:35:41.937
> 
> 标签：c++, visual-studio, precompiled-headers, stdafx.h

像往常一样，当我的大脑在弄乱我自己无法弄清楚的事情时，我会向你们寻求帮助:)

这次我一直想知道为什么 stdafx.h 会这样工作？据我了解，它做了两件事：

*   包括我们 *可能*（？）使用并且很少更改的标准标题
*   在不再预编译代码时用作编译器书签。

现在，这两件事对我来说似乎是两个非常不同的任务，我想知道他们为什么不做两个单独的步骤来照顾它们？对我来说，让#pragma-command 来做书签似乎是合理的，并且可以选择在 windows.h 的行中添加一个头文件来包含常用的头文件......这让我进入了我的下一个要点：为什么我们被迫通过 stdafx.h 包含常用的标头？就个人而言，我不知道我使用的任何经常使用的标头，我还没有为自己做包含 - 但也许这些标头对于 .dll 生成是必需的？

提前谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T08:08:56.457

stdafx.h 是让 Visual Studio 执行预编译标头的一种方法。这是一种易于使用、易于自动生成的方法，适用于较小的应用程序，但可能会导致较大的复杂应用程序出现问题，因为它有效地鼓励使用单个头文件，这可能会导致组件之间的耦合否则是独立的。如果***仅***用于系统头文件，它往往没问题，但随着项目规模和复杂性的增长，很容易将其他头文件放入其中，然后突然更改任何头文件会导致重新编译项目中的所有内容。

看这里：[有没有办法在 VC++ 中使用预编译的头文件而不需要 stdafx.h？](https://stackoverflow.com/questions/290034/is-there-a-way-to-use-pre-compiled-headers-in-vc-without-requiring-stdafxh#293219)有关替代方法的详细信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T07:37:47.890

您不必强制使用“stdafx.h”。您可以在项目属性中（或在创建项目时）选中使用预编译的标头，您将不再需要`stdafx.h`。

编译器使用它作为线索，以便能够在一个文件中分别预编译最常用的头`.pch`文件以减少编译时间（不必每次都编译它）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T07:42:22.140

它可以缩短编译时间，因为其中的内容总是首先编译（请参阅下面引用中的详细信息）：

> stdafx.h 是一个描述标准系统和项目特定包含文件的文件，这些文件经常使用但几乎从未更改过。
> 
> 兼容的编译器将预编译此文件以减少总体编译时间。**Visual C++ 不会编译 `#include "stdafx.h"`源文件中的**任何内容，除非编译选项 /Yu'stdafx.h' 未选中（默认情况下）；它假定源代码中直到并包括该行的所有代码都已编译。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2008-12-17T07:37:20.187

这将有助于减少长时间的编译。

# javascript - 可以在 Javascript 中从头开始构建文本编辑器吗？

> ID：373908
> 
> 赞同：2
> 
> 时间：2008-12-17T07:40:22.380
> 
> 标签：javascript, editor

我知道 Javascript WYSIWYG 编辑器使用浏览器的内置编辑器模式来运行，但这会带来各种问题。

是否可以在 JS 中从头开始构建编辑器，就像 Buzzword 人使用 flash/flex 所做的那样？我最近看到了[这篇博](http://manishjethani.com/blog/2008/04/13/how-does-buzzword-work/)文，我只是想知道这是否可以使用 Javascript 构建（至少在中等程度上）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T07:57:51.890

这取决于您所说的“从头开始”是什么意思。[Google Docs](http://docs.google.com/)提供了一个非常好的 JS 文本编辑器。你是这个意思吗 ？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-10T09:06:59.360

[阿特伍德定律](http://www.codinghorror.com/blog/2009/08/all-programming-is-web-programming.html)：

> 任何可以用 JavaScript 编写的应用程序，最终都会用 JavaScript 编写。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T08:05:16.213

当然你可以做到，而且不是很困难。但在重新发明轮子之前，请先看看所有现有的。他们中的许多人写得非常好并且是开源的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T08:24:25.800

几乎任何事情都可以用 JavaScript 完成。你有基本的构建工具——你可以拦截所有的鼠标事件和几乎所有的键盘事件。您可以使用 GIF 动画来模拟插入符号。更棘手的部分可能是测量文本的大小，以便您可以将插入符号放置在需要的位置。我不确定你怎么能做到这一点。但如果你弄清楚了，其余的都是可行的。尽管它确实需要大量的轮子改造代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-17T08:26:50.583

让我想起了我以前做过的一个小实验......我基本上试图通过简单地听 DIV 上的按键并将它们作为新节点插入 DIV 来创建一个原始编辑器。所以想象一下，每个字符都会被包裹在一个标签中！它确实奏效了。但是，一旦到达几段，节点插入和删除就会变得相当缓慢。你会输入一个字符，它只会在稍微延迟之后出现，这根本无法接受，最终我只是放弃了。无论如何，这只是我想尝试的随机事物..

回到您的问题，我想知道这是否可以单独在 JS 中复制，因为坦率地说，与 JS 相比，闪存具有更出色的原始处理能力。即使它在技术上是可行的，我怀疑它是否足够快以实际运作良好。我的两分钱！

# vb.net - 如何在打开之前检查 MS Access DB 是否受密码保护

> ID：373912
> 
> 赞同：0
> 
> 时间：2008-12-17T07:43:50.717
> 
> 标签：vb.net, ms-access

在打开数据库之前，谁能帮我检查一下 MS Access 数据库是否受密码保护。

与 Excel 一样，我们在**vb.net中有“** **ProtectContents** ”只读布尔属性

 **谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-20T18:29:52.890

我不能这样的功能。如果您不想打开数据连接并捕获由此产生的错误，您可以随时在文件中测试以下内容。

根据我的研究，密码存储在 mdb 文件中的 0x42 位置。在未加密的 office 2003 mdb 文件中，字节 0x42 和 0x43 似乎设置为 0xFC 0x60。您可能希望在打开文件之前测试这两个字节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T18:41:40.150

此线程似乎与[尝试释放对象时打开的 msaccess.exe有关](https://stackoverflow.com/questions/380805/msaccessexe-opens-while-trying-to-release-the-object)

# c# - 设置用户控件的父级可防止其透明

> ID：373913
> 
> 赞同：5
> 
> 时间：2008-12-17T07:46:49.993
> 
> 标签：c#, winforms, user-controls, transparency

我创建了一个简单的用户控件，它是手动创建的，例如

```
MyUserControl ctrl = new MyUserControl(); 
```

该控件被设计为具有*BackColor = Color.Transparent*并且工作正常，直到我将控件的*Parent*设置为一个窗体，此时它变成窗体的颜色。

可能听起来像是透明的，但它的作用是隐藏表单上存在的所有控件。我不是 100% 确定它的控件获得了纯色背景或当我连接它时发生的其他事情，这会阻止其他控件显示。

基本上如果你这样做

*   创建表单
*   在上面放一个按钮
*   在按钮的单击处理程序中，您执行以下操作

例子

```
MyUserControl ctrl = new MyUserControl();
ctrl.Parent = this;
ctrl.BackColor = Color.Transparent;
ctrl.Size = this.Parent.ClientRectangle.Size;
ctrl.Location = this.Parent.ClientRectangle.Location;
ctrl.BringToFront();
ctrl.Show(); 
```

基本上我希望用户控件覆盖整个表单，同时在表单上显示底层控件（因此是透明背景）。我不想将它添加到表单控件集合中，因为它并不真正属于表单，它只是显示在其他所有内容之上

我尝试做同样的事情，但没有设置父级，但是控件根本没有显示。

谢谢！

编辑：如果我覆盖用户控件中的 OnPaintBackground 方法并阻止绘制背景，那么它可以工作，但是这会与使用 DrawImage 在控件中绘制的 PNG 图像的透明部分混淆，这是有道理的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T08:15:23.230

Windows Forms doesn't really support transparent controls.
You can work around this limitation by overriding the CreateParams property of the control and setting a custom style (look it up on google).
Further you have to override the painting of your control so that not only your control but also the parent control is redrawn. The reason is that the background must be painted before your control paints itself.
Finally you should override the OnPaintBackground method, as you have done, to make sure no background is painted.

Quite clumsy, and not perfect, but it should work.

# oracle - 灾难恢复后 Oracle 序列会发生什么？

> ID：373914
> 
> 赞同：4
> 
> 时间：2008-12-17T07:47:27.090
> 
> 标签：oracle, sequence, fallback

假设必须在灾难后恢复 Oracle 实例。序列是否会重置为初始状态或上次保存的状态，或者是否保留了缓存值？

非常感谢你。:-)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-17T13:38:33.047

序列值存储在 SYSTEM.SEQ$ （我认为）表中，并且在内存中维护要使用的下一个值的缓存，该缓存的大小取决于序列的 CACHE 值。

当缓存耗尽时，SEQ$ 表被更新为一个新值（以一种不一致的方式——即，没有应用用户会话的事务控制），接下来从内存中读取 100 个值（如果 CACHE=100） .

假设您正在使用缓存大小为 20 的序列。当您从序列中选择某个值（例如 1400）时，SEQ$ 表会更新为值 1420。即使您回滚事务，SEQ$在使用下一个 20 个序列值之前仍然具有该值，此时 SEQ$ 被更新为 1440。如果您刚刚使用了值 1423 并且发生了实例崩溃，那么当系统重新启动要从中读取的下一个值序列将是 1440。

所以，是的，序列的完整性将被保留，并且不会“重新发布”号码。请注意，这同样适用于正常关闭——当您重新启动时，您将在上面的示例中获得一个新值 1440。由于这个原因，序列在实践中不能保证没有间隙（也因为使用一个值然后回滚不会将该值恢复到缓存中）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T08:40:21.510

并不是说我对此有任何经验，但我非常假设恢复到一致的系统更改编号状态也会将序列返回到最后保存的状态。就恢复而言，其他任何事情都将毫无用处。

至于缓存的值，即使实例以有序的方式关闭（*），这些值也会（可能）丢失：实例将多个序列值缓存在内存（SGA）中，而不是每次都进入数据库。实例保留的未使用序列值可能会“消失”，从而在序列中留下空白。

(*) 8i 文档提到这可能发生在并行实例 (RAC) 中，在这种情况下，序列甚至可能不是严格递增的（但仍然是唯一的），10g 文档说它发生在实例失败的情况下。

# open-source - 是否有任何适用于 x86 的开源实时操作系统？

> ID：373917
> 
> 赞同：14
> 
> 时间：2008-12-17T07:51:15.743
> 
> 标签：open-source, x86, x86-64, rtos

是否有任何开源实时操作系统？我听说过实时 Linux，但大多数实现似乎真的是一个专有的 RTOS（你必须付费），它将 Linux 作为一个进程运行——与 Ardence 的 RTX 实时系统在 Windows 上工作的方式非常相似。

编辑：我应该澄清一下，我正在寻找与多核 x86 系列 CPU 一起使用的 RTOS。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-17T08:04:30.583

FreeRTOS，它提供了底层内核。我在一些嵌入式应用程序中使用过它，它看起来很强大。但是，这实际上取决于您的应用程序。

[http://www.freertos.org/](http://www.freertos.org/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-17T07:52:58.173

查看[eCos](http://ecos.sourceware.org/)免费、开源和实时操作系统。（支持x86，不确定多核）

[RTLinux](http://www.rtlinuxfree.com/)也可用

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T20:27:19.927

eCos 是免费的（但您可以获得付费支持）。它支持 Intel x86 架构。它支持多处理器系统。根据您的时间要求，我对实时 Linux 系统的体验并不好。虽然平均响应时间可能不错，但我见过几天内最坏的情况可能是 10 倍甚至 100 倍。我想这部分取决于驱动程序的质量，部分取决于调度程序本身。

但我想这归结为您的系统需要硬实时还是软实时，时间限制是什么，您需要运行什么样的应用程序。以及您需要的简化开发系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-05T20:33:05.283

Linux 内核有硬实时扩展。您可能想检查其中的一些。

很好的例子是 RTAI 和 LXRT

[瑞泰](https://www.rtai.org/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-20T23:38:49.767

OpenSolaris 具有实时功能，但是如果您决定将其用于实时开发，则应注意：几乎所有 I/O 都可能导致内核中的优先级反转（低优先级系统工作线程可能会饿死并导致高优先级要阻塞的线程，例如在 STREAMS 代码中）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-04T09:06:00.450

我也一直在使用 FreeRTOS 操作系统，它可以根据修改后的 GNU 许可证、付费商业许可证版本或昂贵的安全认证版本 (SafeRTOS) 免费提供

从网站上有一个 x86 端口，如下所示

# x86

```
* Supported processor families: Any x86 compatible running in Real mode only, plus a Win32 simulator
* Supported tools: Open Watcom, Borland, Paradigm, plus Visual Studio for the WIN32 simulator 
```

该操作系统为任务提供具有队列、信号量和优先级设置的抢先式或协作式任务调度。它不提供与其他更大的操作系统实现（如 Linux）一起提供的 I/O 或文件库函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-22T07:44:24.110

您的具体要求是什么？也许您可以使用 vanilla Linux——它不提供实时保证，但可能已经足够好了。有些人发现它并不像实时供应商试图做出的那样糟糕。

Vanilla Linux 也有不同的调度策略，但很少有人知道这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-03T15:40:17.590

BeRTOS 看起来很有趣。但对于 x86，它支持“仅模拟器”。不知道为什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-17T07:55:56.607

[Prex](http://prex.sourceforge.net/)在 BSD 许可下。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-17T07:59:25.943

有[S.Ha.RK](http://shark.sssup.it/)项目。它适用于 x86 CPU，但我不知道它是否可以处理 CPU 的所有内核。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T08:08:31.183

好吧，这不是开源的，但是您知道 Windows CE 是一个硬实时操作系统并且它确实有一个 x86 端口吗？但是我不知道它是否可以支持多核 CPU。如果它是一个商业项目，你绝对应该考虑它。

还有[MicroC/OS-II](http://en.wikipedia.org/wiki/MicroC/OS-II)，它有一个 x86 端口，但和上面一样，我不知道它是否支持多核。它对非商业应用是免费的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-20T08:19:37.377

正如其他人已经提到的，Linux 有实时扩展。看看 xenomai.org。

我不太确定多处理器问题。你到底想在你的多个处理器上做什么？

# c# - c# (WinForms-App) 导出DataSet到Excel

> ID：373925
> 
> 赞同：25
> 
> 时间：2008-12-17T07:54:32.770
> 
> 标签：c#, winforms, excel, dataset, export

我需要一个解决方案来将数据集导出到没有任何 asp 代码的 excel 文件（HttpResonpsne ...），但我没有找到一个很好的例子来做到这一点......

最好提前感谢

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-17T08:13:32.467

我创建了一个将`DataGridView`or导出`DataTable`到 Excel 文件的类。您可能可以对其进行一些更改以使其使用您的`DataSet`代替（迭代`DataTables`其中）。它还做了一些你也可以扩展的基本格式。

要使用它，只需调用 ExcelExport，并指定文件名以及导出后是否自动打开文件。我也可以让它们成为扩展方法，但我没有。随意地。

请注意，Excel 文件可以保存为美化的 XML 文档，这就是利用它。

编辑：这曾经使用 vanilla `StreamWriter`，但正如所指出的，在许多情况下，事情不会被正确转义。现在它使用 a `XmlWriter`，它将为您进行转义。

该类`ExcelWriter`包装了一个`XmlWriter`. 我没有打扰，但您可能需要做更多的错误检查，以确保您不能在开始一行之前写入单元格数据，等等。代码如下。

```
public class ExcelWriter : IDisposable
{
    private XmlWriter _writer;

    public enum CellStyle { General, Number, Currency, DateTime, ShortDate };

    public void WriteStartDocument()
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteProcessingInstruction("mso-application", "progid=\"Excel.Sheet\"");
        _writer.WriteStartElement("ss", "Workbook", "urn:schemas-microsoft-com:office:spreadsheet");
         WriteExcelStyles();
   }

    public void WriteEndDocument()
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteEndElement();
    }

    private void WriteExcelStyleElement(CellStyle style)
    {
        _writer.WriteStartElement("Style", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteAttributeString("ID", "urn:schemas-microsoft-com:office:spreadsheet", style.ToString());
        _writer.WriteEndElement();
    }

    private void WriteExcelStyleElement(CellStyle style, string NumberFormat)
    {
        _writer.WriteStartElement("Style", "urn:schemas-microsoft-com:office:spreadsheet");

        _writer.WriteAttributeString("ID", "urn:schemas-microsoft-com:office:spreadsheet", style.ToString());
        _writer.WriteStartElement("NumberFormat", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteAttributeString("Format", "urn:schemas-microsoft-com:office:spreadsheet", NumberFormat);
        _writer.WriteEndElement();

        _writer.WriteEndElement();

    }

    private void WriteExcelStyles()
    {
        _writer.WriteStartElement("Styles", "urn:schemas-microsoft-com:office:spreadsheet");

        WriteExcelStyleElement(CellStyle.General);
        WriteExcelStyleElement(CellStyle.Number, "General Number");
        WriteExcelStyleElement(CellStyle.DateTime, "General Date");
        WriteExcelStyleElement(CellStyle.Currency, "Currency");
        WriteExcelStyleElement(CellStyle.ShortDate, "Short Date");

        _writer.WriteEndElement();
    }

    public void WriteStartWorksheet(string name)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteStartElement("Worksheet", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteAttributeString("Name", "urn:schemas-microsoft-com:office:spreadsheet", name);
        _writer.WriteStartElement("Table", "urn:schemas-microsoft-com:office:spreadsheet");
    }

    public void WriteEndWorksheet()
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteEndElement();
        _writer.WriteEndElement();
    }

    public ExcelWriter(string outputFileName)
    {
        XmlWriterSettings settings = new XmlWriterSettings();
        settings.Indent = true;
        _writer = XmlWriter.Create(outputFileName, settings);
    }

    public void Close()
    {
        if (_writer == null) throw new InvalidOperationException("Already closed.");

        _writer.Close();
        _writer = null;
    }

    public void WriteExcelColumnDefinition(int columnWidth)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteStartElement("Column", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteStartAttribute("Width", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteValue(columnWidth);
        _writer.WriteEndAttribute();
        _writer.WriteEndElement();
    }

    public void WriteExcelUnstyledCell(string value)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteStartElement("Cell", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteStartElement("Data", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteAttributeString("Type", "urn:schemas-microsoft-com:office:spreadsheet", "String");
        _writer.WriteValue(value);
        _writer.WriteEndElement();
        _writer.WriteEndElement();
    }

    public void WriteStartRow()
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteStartElement("Row", "urn:schemas-microsoft-com:office:spreadsheet");
    }

    public void WriteEndRow()
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteEndElement();
    }

    public void WriteExcelStyledCell(object value, CellStyle style)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        _writer.WriteStartElement("Cell", "urn:schemas-microsoft-com:office:spreadsheet");
        _writer.WriteAttributeString("StyleID", "urn:schemas-microsoft-com:office:spreadsheet", style.ToString());
        _writer.WriteStartElement("Data", "urn:schemas-microsoft-com:office:spreadsheet");
        switch (style)
        {
            case CellStyle.General:
                _writer.WriteAttributeString("Type", "urn:schemas-microsoft-com:office:spreadsheet", "String");
                break;
            case CellStyle.Number:
            case CellStyle.Currency:
                _writer.WriteAttributeString("Type", "urn:schemas-microsoft-com:office:spreadsheet", "Number");
                break;
            case CellStyle.ShortDate:
            case CellStyle.DateTime:
                _writer.WriteAttributeString("Type", "urn:schemas-microsoft-com:office:spreadsheet", "DateTime");
                break;
        }
        _writer.WriteValue(value);
        //  tag += String.Format("{1}\"><ss:Data ss:Type=\"DateTime\">{0:yyyy\\-MM\\-dd\\THH\\:mm\\:ss\\.fff}</ss:Data>", value,

        _writer.WriteEndElement();
        _writer.WriteEndElement();
    }

    public void WriteExcelAutoStyledCell(object value)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");

        //write the <ss:Cell> and <ss:Data> tags for something
        if (value is Int16 || value is Int32 || value is Int64 || value is SByte ||
            value is UInt16 || value is UInt32 || value is UInt64 || value is Byte)
        {
            WriteExcelStyledCell(value, CellStyle.Number);
        }
        else if (value is Single || value is Double || value is Decimal) //we'll assume it's a currency
        {
            WriteExcelStyledCell(value, CellStyle.Currency);
        }
        else if (value is DateTime)
        {
            //check if there's no time information and use the appropriate style
            WriteExcelStyledCell(value, ((DateTime)value).TimeOfDay.CompareTo(new TimeSpan(0, 0, 0, 0, 0)) == 0 ? CellStyle.ShortDate : CellStyle.DateTime);
        }
        else
        {
            WriteExcelStyledCell(value, CellStyle.General);
        }
    }

    #region IDisposable Members

    public void Dispose()
    {
        if (_writer == null)
            return;

        _writer.Close();
        _writer = null;
    }

    #endregion
} 
```

然后您可以`DataTable`使用以下命令导出您的：

```
public static void ExcelExport(DataTable data, String fileName, bool openAfter)
{
    //export a DataTable to Excel
    DialogResult retry = DialogResult.Retry;

    while (retry == DialogResult.Retry)
    {
        try
        {
            using (ExcelWriter writer = new ExcelWriter(fileName))
            {
                writer.WriteStartDocument();

                // Write the worksheet contents
                writer.WriteStartWorksheet("Sheet1");

                //Write header row
                writer.WriteStartRow();
                foreach (DataColumn col in data.Columns)
                    writer.WriteExcelUnstyledCell(col.Caption);
                writer.WriteEndRow();

                //write data
                foreach (DataRow row in data.Rows)
                {
                    writer.WriteStartRow();
                    foreach (object o in row.ItemArray)
                    {
                        writer.WriteExcelAutoStyledCell(o);
                    }
                    writer.WriteEndRow();
                }

                // Close up the document
                writer.WriteEndWorksheet();
                writer.WriteEndDocument();
                writer.Close();
                if (openAfter)
                    OpenFile(fileName);
                retry = DialogResult.Cancel;
            }
        }
        catch (Exception myException)
        {
            retry = MessageBox.Show(myException.Message, "Excel Export", MessageBoxButtons.RetryCancel, MessageBoxIcon.Asterisk);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-01T13:04:48.670

以下站点演示了如何将 DataSet（或 DataTable 或 List<>）导出到“**真正**的”Excel 2007 .xlsx 文件中。

它使用*OpenXML*库，因此您**无需**在服务器上安装 Excel。

[C# ExportToExcel 库](https://www.codeproject.com/Articles/692121/Csharp-Export-data-to-Excel-using-OpenXML-librarie)

所有源代码都是**免费**提供的，以及在 ASP.NET、ASP.NET Core 2+ 或常规 C# 中使用它的说明。

添加到您自己的应用程序*非常*容易，您只需调用一个函数，传入一个 Excel 文件名和您的数据源：

```
DataSet ds = CreateSampleData();
string excelFilename = "C:\\Sample.xlsx";
CreateExcelFile.CreateExcelDocument(ds, excelFilename); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T08:18:41.367

在 .NET 应用程序中创建 excel 文件是很常见的，类似的问题已经被问过好几次了。例如[这里](https://stackoverflow.com/questions/236185/aspnet-web-server-control-that-generates-html-and-excel#236254)和[这里](https://stackoverflow.com/questions/15828/reading-excel-files-from-c#261566)。最后一个问题询问有关阅读 excel 文件的问题，但大多数建议的解决方案应该可以双向工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-05T04:21:46.507

```
using XL = Microsoft.Office.Interop.Excel;
using System.Reflection;

public static void Datasource(DataTable dt)
{
    XL.Application oXL;
    XL._Workbook oWB;
    XL._Worksheet oSheet;
    XL.Range oRng;

    try
    {
        oXL = new XL.Application();
        Application.DoEvents();
        oXL.Visible = false;

        //Get a new workbook.
        oWB = (XL._Workbook)(oXL.Workbooks.Add(Missing.Value));
        oSheet = (XL._Worksheet)oWB.ActiveSheet;

        //System.Data.DataTable dtGridData=ds.Tables[0];

        int iRow = 2;
        if (dt.Rows.Count > 0)
        {
            for (int j = 0; j < dt.Columns.Count; j++)
            {
                oSheet.Cells[1, j + 1] = dt.Columns[j].ColumnName;
            }

            // For each row, print the values of each column.
            for (int rowNo = 0; rowNo < dt.Rows.Count; rowNo++)
            {
                for (int colNo = 0; colNo < dt.Columns.Count; colNo++)
                {
                    oSheet.Cells[iRow, colNo + 1] = dt.Rows[rowNo][colNo].ToString();
                }
                iRow++;
            }
            iRow++;
        }
        oRng = oSheet.get_Range("A1", "IV1");
        oRng.EntireColumn.AutoFit();
        oXL.Visible = true;
    }
    catch (Exception theException)
    {
        throw theException;
    }
    finally
    {
        oXL = null;
        oWB = null;
        oSheet = null;
        oRng = null;
    }
} 
```

从 Excel 导入数据表：

```
 DataTable dtTable = new DataTable();
 DataColumn col = new DataColumn("Rfid");
 dtTable.Columns.Add(col);
 DataRow drRow;

 Microsoft.Office.Interop.Excel.Application ExcelObj =
        new Microsoft.Office.Interop.Excel.Application();
 Microsoft.Office.Interop.Excel.Workbook theWorkbook =
            ExcelObj.Workbooks.Open(txt_FilePath.Text, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
                                    Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
                                    Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing);
 Microsoft.Office.Interop.Excel.Sheets sheets = theWorkbook.Worksheets;
 try
 {
     for (int sht = 1; sht <= sheets.Count; sht++)
     {
          Microsoft.Office.Interop.Excel.Worksheet worksheet =
                    (Microsoft.Office.Interop.Excel.Worksheet)sheets.get_Item(sht);

          for (int i = 2; i <= worksheet.UsedRange.Rows.Count; i++)
          {
              Microsoft.Office.Interop.Excel.Range range = worksheet.get_Range("A" + i.ToString(), "B" + i.ToString());
              System.Array myvalues = (System.Array)range.Cells.Value2;
              String name = Convert.ToString(myvalues.GetValue(1, 1));
              if (string.IsNullOrEmpty(name) == false)
              {
                  drRow = dtTable.NewRow();
                  drRow["Rfid"] = name;
                  dtTable.Rows.Add(drRow);
              }
          }
              Marshal.ReleaseComObject(worksheet);
              worksheet = null;
        }
    return dtTable;
}
catch
{
    throw;
}
finally
{
   // Marshal.ReleaseComObject(worksheet);
    Marshal.ReleaseComObject(sheets);
    Marshal.ReleaseComObject(theWorkbook);
    Marshal.ReleaseComObject(ExcelObj);
    //worksheet = null;
    sheets = null;
    theWorkbook = null;
    ExcelObj = null;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-15T17:59:24.320

这是一个非常有用的最佳答案的帖子，但我发现它缺乏，因为没有简单的方法将 XML 文件导入回数据表。我最终不得不自己写，并想我会在这里分享它，以防其他人在同一条船上（谷歌在这方面非常无助）：

```
public static DataTable ImportExcelXML(string Filename)
    {
        //create a new dataset to load in the XML file
        DataSet DS = new DataSet();
        //Read the XML file into the dataset
        DS.ReadXml(Filename);
        //Create a new datatable to store the raw Data
        DataTable Raw = new DataTable();
        //assign the raw data from the file to the datatable
        Raw = DS.Tables["Data"];
        //count the number of columns in the XML file
        int ColumnNumber = Raw.Columns.Count;
        //create a datatable to store formatted Import Data
        DataTable ImportData = new DataTable();
        //create a string list to store the cell data of each row
        List<string> RowData = new List<string>();
        //loop through each row in the raw data table
        for (int Counter = 0; Counter < Raw.Rows.Count; Counter++)
        {
            //if the data in the row is a colum header
            if (Counter < ColumnNumber)
            {
                //add the column name to our formatted datatable
                ImportData.Columns.Add(Raw.Rows[Counter].ItemArray.GetValue(1).ToString());
            }
            else
            {
                //if the row # (1 row = 1 cell from the excel file) from the raw datatable is divisable evenly by the number of columns in the formated import datatable AND this is not the 1st row of the raw table data after the headers
                if ((Counter % ColumnNumber == 0) && (Counter != ColumnNumber))
                {
                    //add the row we just built to the formatted import datatable
                    ImportData.Rows.Add(GenerateRow(ImportData, RowData));
                    //clear rowdata list in preperation for the next row
                    RowData.Clear();
                }
                //add the current cell data value from the raw datatable to the string list of cell values for the next row to be added to the formatted input datatable
                RowData.Add(Raw.Rows[Counter].ItemArray.GetValue(1).ToString());
            }
        }
        //add the final row
        ImportData.Rows.Add(GenerateRow(ImportData, RowData));

        return ImportData;
    }

    public static DataRow GenerateRow(DataTable ImportData, List<string> RowData)
    {
        //create a counter to keep track of the column position during row composition
        int ColumnPosition = 0;
        //make a new datarow based on the schema of the formated import datatable
        DataRow NewRow = ImportData.NewRow();
        //for each string cell value collected for the RowData list for this row
        foreach (string CellData in RowData)
        {
            //add the cell value to the new datarow
            NewRow[ImportData.Columns[ColumnPosition].ColumnName] = CellData;
            //incriment column position in the new row
            ColumnPosition++;
        }
        //return the generated row
        return NewRow;
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-15T11:15:01.893

代码有空值问题。

```
 public void WriteExcelAutoStyledCell(object value)
    {
        //solve null values
        if (value is DBNull) return; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-12-09T14:22:40.250

我会将此添加到评论中，但我是新手，所以我无法发表评论。使用 lc. 的解决方案，我添加了另一个函数来测试字符串中的无效 XML 字符。当我导出到 excel 时，有时会发现导致导出失败的字符。

您将需要修改 lc 代码中的功能之一。

```
public void WriteExcelAutoStyledCell(object value)
    {
        if (_writer == null) throw new InvalidOperationException("Cannot write after closing.");
        string newValue = string.Empty;

        try
        {
            //write the <ss:Cell> and <ss:Data> tags for something
            if (value is Int16 || value is Int32 || value is Int64 || value is SByte ||
                value is UInt16 || value is UInt32 || value is UInt64 || value is Byte)
            {
                WriteExcelStyledCell(value, CellStyle.Number);
            }
            else if (value is Single || value is Double || value is Decimal) //we'll assume it's a currency
            {
                WriteExcelStyledCell(value, CellStyle.Currency);
            }
            else if (value is DateTime)
            {
                //check if there's no time information and use the appropriate style
                WriteExcelStyledCell(value, ((DateTime)value).TimeOfDay.CompareTo(new TimeSpan(0, 0, 0, 0, 0)) == 0 ? CellStyle.ShortDate : CellStyle.DateTime);
            }
            else
            {
                newValue = CheckXmlCompatibleValues(value.ToString()).ToString();
                WriteExcelStyledCell(newValue, CellStyle.General);
            }
        }
        catch (Exception thisException)
        {
            throw new InvalidOperationException(thisException.Message.ToString());
        }
    } 
```

并将此功能添加到“ExcelWriter”类

```
public string CheckXmlCompatibleValues(string value)
    {
        string newValue = string.Empty;
        bool found = false;

        foreach (char c in value)
        {
            if (XmlConvert.IsXmlChar(c))
                newValue += c.ToString();
            else
                found = true;
        }

        return newValue.ToString();
    } 
```

lc。感谢您的代码！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-02-10T20:35:35.523

Microsoft 有一个用于导入/导出 Excel 文件的内置解决方案。它不是最直接的库，但通常比上面列出的其他库更好。

执行此操作所需的库包含在 Office 中，可以在 Microsoft.Office.Interop.Excel 的框架程序集列表下找到。

这是一些示例代码：

```
using Excel = Microsoft.Office.Interop.Excel;

Excel.Application app = new Excel.Application();

//Open existing workbook
//Excel.Workbook workbook = xlApp.Workbooks.Open(fileName);

//Create new workbook
Excel.Workbook workbook = app.Workbooks.Add();

Excel.Worksheet worksheet = workbook.ActiveSheet;

worksheet.Cells[1,1] = "Hello world!"; // Indexes start at 1, because Excel
workbook.SaveAs("C:\\MyWorkbook.xlsx");
workbook.Close();
app.Quit(); 
```

# c# - 如何使用 IEnumerable 接口，同时让 XMLSerializer 不使用 GetEnumerator()？

> ID：373968
> 
> 赞同：0
> 
> 时间：2008-12-17T08:20:40.457
> 
> 标签：c#, .net, xml-serialization, ienumerable

我有一个类可以解析非常大的文件（无法放入内存），我目前正在使用 IEnumerable 接口来使用 foreach，因此我可以轻松地逐行获取文件的解析内容。目前，我正在尝试使用 XMLSerializer 将其写入文件。它坚持枚举类，在我的例子中，这意味着将大的、已解析的文件内容转储到 XML。无论如何（hackish 或优雅）使用这个接口并且仍然从 XMLSerializer 中获得“预期”的功能？

（我只称其为“预期的”，因为如果我实现一些集合接口而不是 IEnumerable，这似乎是预期的结果。也许我的 IEnumerable 和集合的概念完全不合时宜。:()

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T08:31:11.840

好吧，您可以实施`IXmlSerializable`并获得完全控制权。设置是什么并不完全清楚（没有伪代码） - 有时`[XmlIgnore]`会有所帮助，但在这种情况下，如果没有你所拥有的示例以及你想要/不想要的东西，我不确定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T01:41:49.137

我设法解决了这个问题，而无需更改我的设计。我的代码都没有依赖 IEnumerable 接口，只是 IEnumerable GetEnumerator() 的实现（显然 foreach 不检查是否实现了 IEnumerable）。只需在类声明中注释掉接口就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T08:29:39.563

在我看来，您的问题可以通过使用更紧密的封装来解决。

听起来好像您正在使用同一个类从文件中加载数据，并存储该数据的内存表示。如果是这种情况，您可以（并且可能*应该*）将该功能移动到两个类中。然后只序列化“内存中”类。

# internet-explorer - 在没有用户交互的情况下向 IE 添加 SSL 证书

> ID：373985
> 
> 赞同：2
> 
> 时间：2008-12-17T08:31:27.923
> 
> 标签：internet-explorer, ssl, automation, certificate

不久前，我使用 Apache 和 PHP/MySQL 在我的域服务器上设置了我公司的本地（非 Internet）客户端数据库。

我最近决定将其设置为使用 SSL 连接而不是标准 HTTP 连接。（我知道，我应该从一开始就拥有，但那是另一回事）。

我已经成功设置了我的服务器和我的证书，但是由于我很便宜并且没有支付“认证”SSL 签名者的费用，IE 会弹出一个关于不是有效证书的恼人对话框。我已经想出了如何在单台计算机上添加证书（参见：[http](http://www.99main.com/webmail-ssl-ie.shtml) ://www.99main.com/webmail-ssl-ie.shtml ），但我有大约 10 台计算机并且不想安装它对于每个用户（我每年只在现场大约 6-7 次，而且通常不在工作时间，所以我无法指导每个用户）。

所以我想知道的是如何做到这一点，以便 IE 不会弹出一个对话框，说我的证书没有由可靠的权威机构签署，而不需要（物理地）访问每台计算机。我觉得最有前途的方式是使用命令行脚本或 reg-hack 导入证书。当然，我欢迎任何其他实现我的目标的方法（有没有办法伪造经过认证的签名机构？等等）

如果这不可能，有没有办法为计算机上的所有帐户（已登录或未登录的帐户）注册证书。

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-17T08:57:36.327

我同意 Oli 的观点——对于这个价格来说，这是一个真正的便宜货。

除此之外，没有用户干预，网站无法自动安装证书。那会有点违背证书的全部目的，不是吗？;)

您可以制作各种命令行脚本来为用户导入证书，但无论如何都必须有人在该计算机上运行它们。

另一种方法是为您的用户提供指向安装证书的分步图解手册的链接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T09:29:24.827

通过网站安装 SSL 证书绝对是不可能的，这是一件好事。

如果您的 PC 是在域中构建的，那么您可能可以通过组策略来执行此操作，'不过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T08:35:55.060

在我看来，购买签名证书比编写脚本将证书添加到所有受信任的计算机（就花费时间而言）要便宜。

他们在 GoDaddy 上每年只需 30 美元……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T09:23:46.633

如果您可以使用管理员帐户远程访问所有现场计算机 - 您可以在它们上安装证书。

除此之外 - IE 将始终警告未签名的证书，任何远程禁用它的方法都将是一个**严重**的安全漏洞。伪造经过认证的签名机构需要破解 RSA，这似乎是可能的，但需要花费大量时间（如几个世纪）。

所以：只有当您可以远程访问所有这些计算机时，您才能让 IE 停止抱怨您的证书。我相信所有可用的解决方案都需要更改配置（安装证书、引入一些可提供证书的受信任域控制器等）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T14:12:12.953

我听说过 certmgr.exe（但完全没有经验）

相关链接： http: [//msdn.microsoft.com/de-de/library/e78byta0 (VS.80).aspx](http://msdn.microsoft.com/de-de/library/e78byta0(VS.80).aspx)

它似乎是 .NET 3.5 软件开发工具包的一部分。在仅将 .NET 3.5 作为运行时的系统上，它不可用。

# architecture - 最佳实践 - 编码前设计

> ID：373988
> 
> 赞同：44
> 
> 时间：2008-12-17T08:34:32.677
> 
> 标签：architecture

我很好奇你们怎么看？（我的意思是一种思维方式）在开始编码之前了解您的库、系统、框架等的设计架构。

我最近发现自己对自己所做的事情感到痛苦，几乎每次我想从头开始一切..

我以前做过设计，在纸上画了一些方案并想象它会如何工作，但也许我做错了？

例如，您如何决定需要哪些接口，或者如何以最佳方式连接所有内容？

（前几天有个问题，朋友问我前段时间做了什么，我不是只给他一个文件，而是给了他大约3-4个文件，那是因为他们是以某种方式连接..但我认为不是正确的:)所以这是我的设计错误..)

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-17T11:16:42.160

我通常在纸/白板上对问题域进行足够的分析，以便对问题域有足够的了解，然后开始编写代码。我很少在纸上画实现或类图。我发现实现更好设计的一项关键技术是不要过于依赖您编写的代码。如果我不喜欢它，我会删除、重命名、移动和随机播放它，直到它对我想要解决的问题表达出足够好的解决方案。听起来很容易？一点也不！但是使用好的“编码”工具，实际上编写代码并不是主要的工作。写一些，重构，删除，再写……

好的设计几乎从来没有好的开始。**它发展到很好。**接受这一点会使小步骤的工作变得更容易，而不会因为设计不“完美”而感到沮丧。但是，为了使此过程起作用，您必须具备良好的设计技能。关键是，即使是优秀的设计师也不是第一次就做好了。

很多时候，当我开始时，我以为我理解了问题域，但我没有。然后我回到白板，与某人交谈或阅读问题域，如果我意识到我对它的理解不够好。然后我回到代码。

这是一个非常迭代的过程。

在处理程序员的思维方式时要问的一个有趣问题是，他们是如何发展自己的思维方式的。就个人而言，我的思维方式多年来一直在发展，但有几件事对我开发软件的方式产生了深远的影响。其中最重要的是与专业设计师一起设计软件。没有什么比与伟大的设计师一起迭代更能影响我了。另一个影响我思考方式的事件已经并且仍然影响着我的思考方式，那就是回顾我一段时间前编写的软件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-17T08:39:06.223

对于面向对象的方法，我发现稍微远离用户界面，专注于系统中将存在哪些实体（对象），以及哪些属性和操作是适当的，通常是一个好主意。

在白板或大纸上绘图，使用不同的颜色来识别各种特征也是一个好主意。便利贴也是可视化模型的好方法。

即使我花了很多时间非常仔细地考虑一个设计，我也总是在我去的时候改变它。所以请记住，当您决定如何记录您的设计时，您的设计会发生变化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-17T08:41:10.073

我主要从一盒卡片开始，然后写下我想要建模的领域的概念。有时我会为此使用思维导图。

看看利益相关者，以及他们想要完成的事情。从那里开始很重要，因为它可以让您正确地确定优先级（即不是在最有趣的技术部分，而是在具有最大商业价值的部分）

对设计的思考大多写在测试中。写在实现它的代码之前。从利益相关者的最终目标开始，从那里倒退到开始（时间倒置）。这样可以确保您专注于什么，而不是如何。对象之间的交互比对象属性更重要。

另一部分主要在白板上。如今，紧凑型数码相机已成为标准设备。

在你拥有三个需要它的实现之前做一个框架是一种不好的做法。如果必须，请为重大的接口（和实现）更改做好准备。

看：

*   [http://www.robvens.nl/en/articles/computers/29-time-inversion-pattern](http://www.robvens.nl/en/articles/computers/29-time-inversion-pattern)
*   [http://www.robvens.nl/en/articles/computers/28-active-passive-pattern](http://www.robvens.nl/en/articles/computers/28-active-passive-pattern)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-17T08:43:28.227

我通常会花 2 到 4 个小时来设计我的应用程序，然后将其写在笔记本上。

然后我开始编码，每次事情变得复杂时（因为有些东西不在正确的地方）我重构。将一个类移动到另一个包，或提取方法等。当“设计”感觉正确时，我可以继续。

这样我就避免了经常发生在我身上的“分析瘫痪”。很多时候，当我预先设计过度时，我最终没有使用一些工件。

因此，我采用了这种更“敏捷”的方法。

快速草拟设计并在运行中“优化”（通过重构）。

当然，这对于小型应用程序是可能的（2 - 4 周长）

我建议您阅读这篇文章： Martin Fowler 的[设计是否已死](http://martinfowler.com/articles/designDead.html)。有点长，但值得一读。

**编辑**

附加链接 [（略微偏离主题） Joshua Bloch] [如何设计一个好的 API 以及它为何重要](http://www.google.com/search?q=How+To+Design+A+Good+API+and+Why+it+Matters)。当你的 API 有受众时，谈论设计的相关性。总结，从尽可能私人开始，然后从那里成长。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-17T08:53:14.417

它必须是一种平衡。

如果您尝试在白板上使用大量图片预先设计所有内容，那么在实际编写代码时您可能会错过一些细节。

如果您开始对系统的一小部分进行破解，您可能会忽略“大局”并最终得到糟糕的设计。

在查看库时，您希望它们尽可能地可重用。*因此，对于初始设计，请考虑您已经知道的库的预期用途中*最普遍的情况——在这个阶段不要太担心未来可能永远不会发生的假设用途。当您了解更多并发现设计问题时，使用单元测试和重构对该设计进行编码。

尽量少把关于图书馆用户的具体知识放入图书馆本身。然后，幸运的是，您最终会得到一些可重复使用的东西，并且下次不会自动想要从头开始。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-17T09:07:08.443

我遵循一个非常松散的 Rational Unified Process 版本。

首先从一份愿景文档开始，该文档清楚地说明您正在尝试做什么，您正在为谁做这件事，也许还有一些关于提议的方法/算法的关键细节。它不需要花哨，甚至可以是一个简单系统的单行代码“一个预测中奖彩票号码的系统，仅供个人使用，基于霍格沃茨学校的最新研究。”，对于更复杂的系统，它可以大约五页，但没有更多。这不是设计，更像是一个愿望清单。

然后做一些用例/故事。这些应该是与外部世界的所有交互的简单自然语言文本描述。极简主义是这里的关键；用例的目的是识别所有需要的功能，并且只识别需要的功能。我还发现这是大多数创造力发生的地方。

一个用例可能开始于：

```
  用户按下“魔术”按钮。
  系统显示下周中奖号码。
  用户记下号码。
  用户购买彩票。
  彩票开奖号码。
  用户索赔钱
  彩票支付。

```

经过大量工作后，它最终变成： -

```
  用户按下“魔术”按钮
  系统选择下周号码。
  系统登录彩票系统。
  系统输入中奖号码。
  彩票选择中奖号码。
  彩票将奖金转移到用户帐户。
  用户花钱。

```

一旦你完成了你的用例，你就可以启动你的开发环境，各种类和交互就会到位。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-17T08:39:20.810

虽然不是您问题的完整答案，但我有时会找到参与项目的最简单方法，因为它是找到一小部分孤立的功能来开始和工作，同时还要考虑更大的图景。

这样一来，您就不会过于关注每一分钟的细节，并且可以提高工作效率并给自己留出喘息的空间，以便清楚地了解您需要做什么。

就像我说的，不是答案。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-17T08:42:08.057

问题是当你开始一个新项目时，它往往是新的（现在不是很明显）。一般来说，一个人不会立即理解新事物，除非您是一位非常专业的顾问一遍又一遍地做完全相同的事情，这听起来有点怪...

因为您不可避免地对您制作的系统不熟悉，所以您的设计和代码不会在第一次时就完美无缺，因此您需要重复设计和重构代码，直到它准备就绪。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-17T16:33:35.547

我更喜欢自下而上的设计。如果没有适当的应用程序框架，我倾向于先组装或构建它。一个好的应用程序框架是可移植的和应用程序无关的，主要解决横切问题。它通常包含诸如日志记录、异常处理、验证助手、扩展方法等内容。

从那里开始，我喜欢采用主要的 DDD（领域驱动设计）方法。如果需要，采访业务用户以构建领域模型。处理完域模型和后续的 DAL（数据访问层）后，我将转到业务逻辑层 (BLL)。

我个人尽量远离前端实现，因为这绝对不是我的强项。我喜欢单元测试的绝对原因之一是我可以专注于核心功能，并且能够测试该功能而不会跳入过早的界面决策。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-17T08:40:57.997

开放式问题。答案几乎和海报一样多。1）看很多软件工程书籍。一些人认为好的设计，其余的都是小菜一碟。这是一个直截了当的谎言 2) 看看不同的框架是多么具有侵入性，你最好以预期的方式使用它们，否则你最好再次实现这些东西以满足你的需要 3) 设计需要像任何写作一样不断变化。你看到这些句子，但你觉得它们不完全适合。所以你重写它。因此，每个设计都必须考虑到事情在您编写设计时看起来是不同的。

问候弗里德里希

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T10:10:40.953

在做任何像游戏开发这样的重大项目时，我倾向于从一开始就尝试仔细地构建我的代码并制作非功能性的虚拟函数和类。如有必要，我从主代码文件中将所有内容拆分为其他模块和子模块中的类。例如; 我的主代码页将只包含对我的主模块的类初始化程序的包含和调用。这是我现在用 Python 制作的游戏的 init.py 示例；

从 commonheaders 导入 *

```
if arguements.debug:
    debug.init()

try:
    graphics.init()
    sound.init()
    physics.init()
    input.init()
    loop.start("scene1")
except Exception, e:
    print "Error!"
    print e 
```

它非常简单且易于理解，但我最喜欢它的是它在各个主要代码方面之间提供了非常明确的分离。如果我对图形课上的某些事情感到沮丧，我可以在声音课或其他事情上工作以完成其他事情，并让图形暂时脱离我的脑海，直到乌云散去。在所有类 init() 调用中都有可选的参数，例如图形的宽度/高度，但我通常将它们放在外面，要么在 commonheaders.py 文件中设置它们，要么通过命令行开关设置它们。

我尽量不让我的任何模块超过大约 100 行，然后再考虑我可以剪下什么并放入它自己的模块中。它使一切变得更加干净，并且当它像这样拆分时更容易找到您要查找的内容。我之前曾与各种开源项目合作过，之前曾在数万行中看到过单个模块……有太多冗余代码可以很容易地卸载到辅助函数中。我会在必要时使用注释，但我会尽量保持我的代码结构，使您甚至不需要阅读注释。

我真的很喜欢从一开始就构建非功能性框架，因为它可以很容易地看到还需要做什么以及在结构方面可以改进什么。最好不要匆忙编写数千行代码，然后才发现有一种更优雅、更实用的方法，需要对代码进行全面重组。***********************