# StackOverflow 问答 000008000-000008999

# windows - 将 rsync 进度包装在 gui 中的最佳方法？

> ID：8004
> 
> 赞同：5
> 
> 时间：2008-08-11T17:43:50.277
> 
> 标签：windows, user-interface, rsync

我使用[rsync](http://rsync.samba.org/)以与服务器无关的方式将文件同步到 Windows 客户端。有哪些方法可以将 rsync 的进度发送到父进程以在 gui 进度条中显示？

我想存在两三个选择。(1) 观察 STDOUT (2) 观察 rsync.exe 日志文件，类似于 unix `tail`(3) 观察内存中的 rsync 控制台输出。

哪一个是最好的/首选的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-11T18:55:33.753

对于这类任务，我使用自己的[AutoIt](http://www.autoitscript.com/autoit3/)脚本（免费软件，仅限 Windows）。该脚本将标准输出重定向到一个图形窗口，显示它并具有向后滚动的能力等（在 XCOPYs / PKZIPs 等长过程中非常有用，以检查是否确实发生了任何错误）。

我使用 AutoIt 是因为它是免费的，非常易于使用，并且可以快速编译成 .EXE。我认为它是完成此类任务的完整编程语言的绝佳替代品。缺点是它仅适用于 Windows。

```
$sCmd = "DIR E:\*.AU3 /S"  ; Test command
$nAutoTimeout = 10      ; Time in seconds to close window after finish

$nDeskPct = 60          ; % of desktop size (if percent)

; $nHeight = 480          ; height/width of the main window (if fixed)
; $nWidth = 480

$sTitRun = "Executing process. Wait...."     ; 
$sTitDone = "Process done"                ; 

$sSound = @WindowsDir & "\Media\Ding.wav"       ; End Sound

$sButRun = "Cancel"                           ; Caption of "Exec" button
$sButDone = "Close"                            ; Caption of "Close" button

#include <GUIConstants.au3>
#include <Constants.au3>
#Include <GuiList.au3>

Opt("GUIOnEventMode", 1)

if $nDeskPct > 0 Then
    $nHeight = @DesktopHeight * ($nDeskPct / 100)
    $nWidth = @DesktopWidth * ($nDeskPct / 100)
EndIf

If $CmdLine[0] > 0 Then
    $sCmd = ""
    For $nCmd = 1 To $CmdLine[0]
        $sCmd = $sCmd & " " & $CmdLine[$nCmd]
    Next

    ; MsgBox (1,"",$sCmd)
EndIf

; AutoItSetOption("GUIDataSeparatorChar", Chr(13)+Chr(10))

$nForm = GUICreate($sTitRun, $nWidth, $nHeight)
GUISetOnEvent($GUI_EVENT_CLOSE, "CloseForm")

$nList = GUICtrlCreateList ("", 10, 10, $nWidth - 20, $nHeight - 50, $WS_BORDER + $WS_VSCROLL)
GUICtrlSetFont (-1, 9, 0, 0, "Courier New")

$nClose = GUICtrlCreateButton ($sButRun, $nWidth - 100, $nHeight - 40, 80, 30)
GUICtrlSetOnEvent (-1, "CloseForm")

GUISetState(@SW_SHOW)   ;, $nForm)

$nPID = Run(@ComSpec & " /C " & $sCmd, ".", @SW_HIDE, $STDOUT_CHILD)
; $nPID = Run(@ComSpec & " /C _RunErrl.bat " & $sCmd, ".", @SW_HIDE, $STDOUT_CHILD)     ; # Con ésto devuelve el errorlevel en _ERRL.TMP

While 1
    $sLine = StdoutRead($nPID)
    If @error Then ExitLoop

    If StringLen ($sLine) > 0 then
        $sLine = StringReplace ($sLine, Chr(13), "|")
        $sLine = StringReplace ($sLine, Chr(10), "")
        if StringLeft($sLine, 1)="|" Then
            $sLine = " " & $sLine
        endif

        GUICtrlSetData ($nList, $sLine)

        _GUICtrlListSelectIndex ($nList, _GUICtrlListCount ($nList) - 1)
    EndIf
Wend

$sLine = " ||"
GUICtrlSetData ($nList, $sLine)
_GUICtrlListSelectIndex ($nList, _GUICtrlListCount ($nList) - 1)

GUICtrlSetData ($nClose, $sButDone)

WinSetTitle ($sTitRun, "", $sTitDone)
If $sSound <> "" Then
    SoundPlay ($sSound)
EndIf

$rInfo = DllStructCreate("uint;dword")      ; # LASTINPUTINFO
DllStructSetData($rInfo, 1, DllStructGetSize($rInfo));

DllCall("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr($rInfo))
$nLastInput = DllStructGetData($rInfo, 2)

$nTime = TimerInit()

While 1
    If $nAutoTimeout > 0 Then
        DllCall("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr($rInfo))
        If DllStructGetData($rInfo, 2) <> $nLastInput Then
            ; Tocó una tecla
            $nAutoTimeout = 0
        EndIf
    EndIf

    If $nAutoTimeout > 0 And TimerDiff ($nTime) > $nAutoTimeOut * 1000 Then
        ExitLoop
    EndIf

    Sleep (100)
Wend

Func CloseForm()
    Exit
EndFunc 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-11T17:47:35.950

.NET 有一种非常直接的方式来阅读和观看 STDOUT。
我想这将是最干净的方式，因为它不依赖于任何外部文件，只依赖于 rsync 的路径。如果那里有一个包装库，我也不会太惊讶。如果没有，请编写并开源它:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-29T21:04:37.623

我为此构建了自己的简单对象，我从中得到了很多重用，我可以用`cmdline`, `web page`,包装它`webservice`，将输出写入文件等---

评论项目包含一些`rsync`例子——

我有时想做的是将`rsync`（和`cygwin`）嵌入到资源中并从中制作单个.net可执行文件-

干得好：

```
Imports System.IO

Namespace cds

Public Class proc

    Public _cmdString As String
    Public _workingDir As String
    Public _arg As String

    Public Function basic() As String

        Dim sOut As String = ""

        Try
            'Set start information.
            'Dim startinfo As New ProcessStartInfo("C:\Program Files\cwRsync\bin\rsync", "-avzrbP 192.168.42.6::cdsERP /cygdrive/s/cdsERP_rsync/gwy")
            'Dim startinfo As New ProcessStartInfo("C:\Program Files\cwRsync\bin\rsync", "-avzrbP 10.1.1.6::user /cygdrive/s/cdsERP_rsync/gws/user")
            'Dim startinfo As New ProcessStartInfo("C:\windows\system32\cscript", "//NoLogo c:\windows\system32\prnmngr.vbs -l")

            Dim si As New ProcessStartInfo(_cmdString, _arg)

            si.UseShellExecute = False
            si.CreateNoWindow = True
            si.RedirectStandardOutput = True
            si.RedirectStandardError = True

            si.WorkingDirectory = _workingDir

            ' Make the process and set its start information.
            Dim p As New Process()
            p.StartInfo = si

            ' Start the process.
            p.Start()

            ' Attach to stdout and stderr.
            Dim stdout As StreamReader = p.StandardOutput()
            Dim stderr As StreamReader = p.StandardError()

            sOut = stdout.ReadToEnd() & ControlChars.NewLine & stderr.ReadToEnd()

            'Dim writer As New StreamWriter("out.txt", FileMode.CreateNew)
            'writer.Write(sOut)
            'writer.Close()

            stdout.Close()
            stderr.Close()
            p.Close()

        Catch ex As Exception

            sOut = ex.Message

        End Try

        Return sOut

    End Function

End Class
End Namespace 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T17:50:10.403

查看[DeltaCopy](http://www.download.com/DeltaCopy/3000-2242_4-10471616.html)。它是 rsync 的 Windows GUI。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-29T05:00:12.703

检查[NAsBackup](http://www.nasbackup.com) 它的开源软件，使用 Watch STDOUT 为 Windows 用户提供 Rsync GUI。

# unix - 允许用户设置 SSH 隧道，但仅此而已

> ID：8021
> 
> 赞同：101
> 
> 时间：2008-08-11T17:59:01.697
> 
> 标签：unix, ssh

我想允许用户在特定端口（比如 5000）上设置到特定机器的 SSH 隧道，但我想尽可能地限制这个用户。（身份验证将使用公钥/私钥对）。

我知道我需要编辑相关的 ~/.ssh/authorized_keys 文件，但我不确定要在其中放入什么内容（公钥除外）。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2012-04-22T08:28:24.873

在 Ubuntu 11.10 上，我发现我可以阻止带有和不带有 -T 的 ssh 命令，并阻止 scp 复制，同时允许端口转发通过。

具体来说，我在绑定到 localhost:6379 的“somehost”上有一个 redis 服务器，我希望通过 ssh 隧道安全地共享到具有密钥文件并将 ssh 的其他主机：

```
$ ssh -i keyfile.rsa -T -N -L 16379:localhost:6379 someuser@somehost 
```

这将导致 redis-server，“somehost”上的“localhost”端口 6379 出现在本地执行 ssh 命令的主机上，重新映射到“localhost”端口 16379。

在远程“somehost”上这是我用于authorized_keys的：

```
cat .ssh/authorized_keys   (portions redacted)

no-pty,no-X11-forwarding,permitopen="localhost:6379",command="/bin/echo do-not-send-commands" ssh-rsa rsa-public-key-code-goes-here keyuser@keyhost 
```

no-pty 会触发大多数想要打开终端的 ssh 尝试。

permitopen 解释了允许转发哪些端口，在本例中，端口 6379 是我想要转发的 redis-server 端口。

command="/bin/echo do-not-send-commands" 如果某人或某物确实设法通过 ssh -T 或其他方式向主机发送命令，则返回“do-not-send-commands”。

从最近的 Ubuntu`man sshd`中，authorized_keys / 命令描述如下：

> command="command" 指定在使用此密钥进行身份验证时执行该命令。用户提供的命令（如果有）将被忽略。

尝试使用 scp 安全文件复制也将失败，并回显“do-not-send-commands”我发现 sftp 在此配置下也失败。

我认为在以前的一些答案中提出的受限外壳建议也是一个好主意。另外，我同意这里详述的所有内容都可以通过阅读“man sshd”并在其中搜索“authorized_keys”来确定

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-08-12T00:16:38.020

您可能希望将用户的 shell 设置为[受限制的 shell](http://www.gnu.org/software/bash/manual/html_node/The-Restricted-Shell.html)。在用户的 ~/.bashrc 或 ~/.bash_profile 中取消设置 PATH 变量，他们将无法执行任何命令。稍后，如果您决定要允许用户执行一组有限的命令，例如`less`或`tail`，那么您可以将允许的命令复制到单独的目录（例如`/home/restricted-commands`）并更新 PATH 以指向那个目录。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-11-17T08:52:05.223

除了 no-X11-forwarding 之类的 authorized_keys 选项之外，实际上还有一个您需要的选项：permitopen="host:port"。通过使用此选项，用户只能建立到指定主机和端口的隧道。

有关 AUTHORIZED_KEYS 文件格式的详细信息，请参阅 man sshd。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-04-13T16:44:45.847

**我的解决方案是为仅在没有交互式 shell 的情况下**进行隧道传输的用户提供将**/etc/passwd**中的shell 设置为**/usr/bin/tunnel_shell**的用户。

只需使用**无限循环**创建可执行文件**/usr/bin/tunnel_shell**。

 **```
#!/bin/bash
trap '' 2 20 24
clear
echo -e "\r\n\033[32mSSH tunnel started, shell disabled by the system administrator\r\n"
while [ true ] ; do
sleep 1000
done
exit 0 
```

**在这里充分解释：http:** [//blog.flowl.info/2011/ssh-tunnel-group-only-and-no-shell-please/](http://blog.flowl.info/2011/ssh-tunnel-group-only-and-no-shell-please/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-05-13T14:18:12.837

在这里你有一个很好的帖子，我发现它很有用： [http ://www.ab-weblog.com/en/creating-a-restricted-ssh-user-for-ssh-tunneling-only/](http://www.ab-weblog.com/en/creating-a-restricted-ssh-user-for-ssh-tunneling-only/)

这个想法是：（使用新的受限用户名作为“sshtunnel”）

```
useradd sshtunnel -m -d /home/sshtunnel -s /bin/rbash
passwd sshtunnel 
```

请注意，我们使用 rbash（restricted-bash）来限制用户可以做什么：用户不能 cd（更改目录）并且不能设置任何环境变量。

然后我们将用户的 PATH 环境变量编辑为空`/home/sshtunnel/.profile`——这个技巧将使 bash 找不到任何要执行的命令：

```
PATH="" 
```

最后，我们通过设置以下权限来禁止用户编辑任何文件：

```
chmod 555 /home/sshtunnel/
cd /home/sshtunnel/
chmod 444 .bash_logout .bashrc .profile 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-08T07:49:34.603

> 我可以使用公钥设置 authorized_keys 文件以登录。我不确定的是我需要的其他信息来限制允许该帐户执行的操作。例如，我知道我可以输入以下命令：
> 
> ```
> no-pty,no-port-forwarding,no-X11-forwarding,no-agent-forwarding 
> ```

您可能希望在您的 authorized_keys 文件中出现如下所示的一行。

```
permitopen="host.domain.tld:443",no-pty,no-agent-forwarding,no-X11-forwardi
ng,command="/bin/noshell.sh" ssh-rsa AAAAB3NzaC.......wCUw== zoredache 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-04-06T01:05:31.940

如果您只想允许访问特定命令（例如 svn），您还可以在授权密钥文件中指定该命令：

```
command="svnserve -t",no-port-forwarding,no-pty,no-agent-forwarding,no-X11-forwarding [KEY TYPE] [KEY] [KEY COMMENT] 
```

来自[http://svn.apache.org/repos/asf/subversion/trunk/notes/ssh-tricks](http://svn.apache.org/repos/asf/subversion/trunk/notes/ssh-tricks)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-17T01:12:03.463

我制作了一个 C 程序，如下所示：

```
#include <stdio.h>
#include <unistd.h>
#include <signal.h>
#include <stdlib.h>
void sig_handler(int signo)
{
    if (signo == SIGHUP)
        exit(0);
}

int main()
{
    signal(SIGINT, &sig_handler);
    signal(SIGTSTP, &sig_handler);

    printf("OK\n");
    while(1)
        sleep(1);
    exit(0);
} 
```

我将受限用户的外壳设置为该程序。

我不认为受限用户可以执行任何操作，即使他们这样做`ssh server command`了，因为命令是使用 shell 执行的，而这个 shell 不执行任何操作。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-08-11T18:01:48.493

请参阅[有关身份验证公钥的这篇文章](http://www.networknewz.com/networknewz-10-20030707AuthenticatingbyPublicKeyOpenSSH.html)。

您需要记住的两个主要事项是：

1.  确保你`chmod 700 ~/.ssh`
2.  将公钥块附加到授权密钥

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-08-11T18:04:01.640

您将通过他们使用的任何 ssh 客户端在用户机器上生成一个密钥。例如，pUTTY 有一个实用程序来做这件事。它将生成私钥和公钥。

生成的公钥文件的内容会放在authorized_keys 文件中。

接下来，您需要确保将 ssh 客户端配置为使用生成公钥的私钥。这相当简单，但根据所使用的客户端略有不同。

# c# - 扩展接口模式

> ID：8042
> 
> 赞同：25
> 
> 时间：2008-08-11T18:13:44.197
> 
> 标签：c#, .net-3.5, extension-methods

.Net 3.5 中的新扩展允许功能从接口中分离出来。

例如在 .Net 2.0

```
public interface IHaveChildren {
    string ParentType { get; }
    int ParentId { get; }

    List<IChild> GetChildren()
} 
```

可以（在 3.5 中）变为：

```
public interface IHaveChildren {
    string ParentType { get; }
    int ParentId { get; }
}

public static class HaveChildrenExtension {
    public static List<IChild> GetChildren( this IHaveChildren ) {
        //logic to get children by parent type and id
        //shared for all classes implementing IHaveChildren 
    }
} 
```

在我看来，这对于许多接口来说是一种更好的机制。他们不再需要一个抽象的基础来共享此代码，并且在功能上代码的工作方式相同。这可以使代码更易于维护和测试。

唯一的缺点是抽象基实现可以是虚拟的，但可以解决这个问题（实例方法会隐藏同名的扩展方法吗？这样做会混淆代码吗？）

还有其他不经常使用这种模式的理由吗？

* * *

澄清：

是的，我看到扩展方法的趋势是到处都有它们。在没有大量同行评审的情况下，我会特别小心地使用任何.Net 值类型（我认为我们在字符串上唯一的一个是`.SplitToDictionary()`- 类似于`.Split()`但也采用键值分隔符）

我认为那里有一个完整的最佳实践辩论;-)

（顺便说一句：DannySmurf，你的 PM 听起来很吓人。）

我在这里特别询问在以前我们有接口方法的地方使用扩展方法。

* * *

我试图避免很多层次的抽象基类——实现这些模型的类大多已经有了基类。我认为与添加更多对象层次结构相比，该模型更易于维护且耦合更少。

这是 MS 对 Linq 的 IEnumerable 和 IQueryable 所做的吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-12T07:23:55.130

扩展方法应该只是这样使用：扩展。任何与结构/设计相关的关键代码或重要操作都应放在由类或接口组成/继承自的对象中。

一旦另一个对象尝试使用扩展对象，他们将看不到扩展，并且可能不得不再次重新实现/重新引用它们。

传统观点是扩展方法应该只用于：

*   实用程序类，正如 Vaibhav 提到的
*   扩展密封的第 3 方 API

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-01T21:52:48.700

我认为扩展方法的明智使用使接口与（抽象）基类处于更平等的位置。

**版本控制。**基类相对于接口的一个优势是您可以在以后的版本中轻松添加新的虚拟成员，而向接口添加成员会破坏针对旧版本库构建的实现者。相反，需要创建具有新成员的新版本接口，并且库将不得不解决或限制对仅实现原始接口的遗留对象的访问。

作为一个具体的例子，一个库的第一个版本可能会定义一个这样的接口：

```
public interface INode {
  INode Root { get; }
  List<INode> GetChildren( );
} 
```

库发布后，我们无法在不破坏当前用户的情况下修改界面。相反，在下一个版本中，我们需要定义一个新接口来添加额外的功能：

```
public interface IChildNode : INode {
  INode Parent { get; }
} 
```

但是，只有新库的用户才能实现新接口。为了使用遗留代码，我们需要调整旧的实现，扩展方法可以很好地处理：

```
public static class NodeExtensions {
  public INode GetParent( this INode node ) {
    // If the node implements the new interface, call it directly.
    var childNode = node as IChildNode;
    if( !object.ReferenceEquals( childNode, null ) )
      return childNode.Parent;

    // Otherwise, fall back on a default implementation.
    return FindParent( node, node.Root );
  }
} 
```

现在，新库的所有用户都可以一视同仁地对待传统实现和现代实现。

**过载。**扩展方法可能有用的另一个领域是为接口方法提供重载。您可能有一个带有多个参数的方法来控制其操作，其中只有前一两个参数在 90% 的情况下很重要。由于 C# 不允许为参数设置默认值，因此用户要么每次都必须调用完全参数化的方法，要么每个实现都必须为核心方法实现琐碎的重载。

相反，扩展方法可用于提供琐碎的重载实现：

```
public interface ILongMethod {
  public bool LongMethod( string s, double d, int i, object o, ... );
}

...
public static LongMethodExtensions {
  public bool LongMethod( this ILongMethod lm, string s, double d ) {
    lm.LongMethod( s, d, 0, null );
  }
  ...
} 
```

请注意，这两种情况都是根据接口提供的操作编写的，并且涉及琐碎或众所周知的默认实现。也就是说，您只能从一个类继承一次，并且有针对性地使用扩展方法可以提供一种有价值的方法来处理接口缺乏的基类提供的一些细节:)

* * *

**编辑：** Joe Duffy 的相关帖子：[扩展方法作为默认接口方法实现](http://joeduffyblog.com/2010/02/09/extension-methods-as-default-interface-method-implementations/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-11T18:56:39.117

我认为扩展方法取代的最好的东西是您在每个项目中找到的所有实用程序类。

至少就目前而言，我觉得任何其他扩展方法的使用都会在工作场所引起混乱。

我的两个位。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-17T04:40:58.843

扩展接口并没有错，事实上 LINQ 就是这样将扩展方法添加到集合类中的。

话虽这么说，你真的应该只在需要为实现该接口的所有类提供相同功能并且该功能不是（并且可能不应该是）任何派生的“官方”实现的一部分的情况下这样做类。如果为需要新功能的每个可能的派生类型编写扩展方法是不切实际的，那么扩展接口也很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-17T09:00:27.943

我认为使用扩展方法分离域/模型和 UI/视图功能是一件好事，特别是因为它们可以驻留在单独的命名空间中。

例如：

```
namespace Model
{
    class Person
    {
        public string Title { get; set; }
        public string FirstName { get; set; }
        public string Surname { get; set; }
    }
}

namespace View
{
    static class PersonExtensions
    {
        public static string FullName(this Model.Person p)
        {
            return p.Title + " " + p.FirstName + " " + p.Surname;
        }

        public static string FormalName(this Model.Person p)
        {
            return p.Title + " " + p.FirstName[0] + ". " + p.Surname;
        }
    }
} 
```

这种方式扩展方法可以与 XAML 数据模板类似地使用。您不能访问该类的私有/受保护成员，但它允许维护数据抽象，而无需在整个应用程序中进行过多的代码重复。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-08T04:06:05.643

多一点点。

如果多个接口具有相同的扩展方法签名，则需要将调用者显式转换为一种接口类型，然后调用该方法。例如

```
((IFirst)this).AmbigousMethod() 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T07:38:23.650

哎哟。请不要扩展接口。
接口是一个类应该实现的干净契约，您对所述类的使用**必须**限制在核心接口中的内容才能正常工作。

这就是为什么你总是将接口声明为类型而不是实际的类。

```
IInterface variable = new ImplementingClass(); 
```

对？

如果你真的需要一些附加功能的契约，抽象类是你的朋友。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-18T07:21:20.140

我看到很多人提倡使用基类来共享通用功能。小心这一点 - 你应该更喜欢组合而不是继承。继承应该只用于多态性，从建模的角度来看是有意义的。它不是代码重用的好工具。

至于问题：当心这样做的限制 - 例如在显示的代码中，使用扩展方法来实现 GetChildren 有效地“密封”了这个实现，并且不允许任何 IHaveChildren impl 在需要时提供它自己的。如果这没问题，那么我不介意扩展方法方法。它不是一成不变的，通常可以在以后需要更多灵活性时轻松重构。

为了获得更大的灵活性，使用策略模式可能更可取。就像是：

```
public interface IHaveChildren 
{
    string ParentType { get; }
    int ParentId { get; }
}

public interface IChildIterator
{
    IEnumerable<IChild> GetChildren();
}

public void DefaultChildIterator : IChildIterator
{
    private readonly IHaveChildren _parent;

    public DefaultChildIterator(IHaveChildren parent)
    {
        _parent = parent; 
    }

    public IEnumerable<IChild> GetChildren() 
    { 
        // default child iterator impl
    }
}

public class Node : IHaveChildren, IChildIterator
{ 
    // *snip*

    public IEnumerable<IChild> GetChildren()
    {
        return new DefaultChildIterator(this).GetChildren();
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-15T20:32:03.143

Rob Connery（Subsonic 和 MVC Storefront）在他的 Storefront 应用程序中实现了一个类似 IRepository 的模式。这与上面的模式不太一样，但确实有一些相似之处。

数据层返回 IQueryable，它允许消费层在此之上应用过滤和排序表达式。例如，好处是能够指定单个 GetProducts 方法，然后在消费层中适当地决定您希望如何排序、过滤甚至只是特定范围的结果。

不是传统的方法，但非常酷，绝对是 DRY 的一个案例。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-11T18:21:37.283

我可以看到的一个问题是，在一家大公司中，这种模式可能会使代码变得难以（如果不是不可能的话）任何人都难以理解和使用。如果多个开发人员不断地将他们自己的方法添加到现有的类中，与这些类分开（上帝帮助我们所有人，甚至是 BCL 类），我可能会看到代码库很快失控。

即使在我自己的工作中，我也能看到这种情况发生，我的 PM 希望将我们处理的每一段代码添加到 UI 或数据访问层，我完全可以看到他坚持要添加 20 或 30 种方法System.String 仅与字符串处理相切相关。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-12-07T10:26:19.300

我需要解决类似的问题：我想将 List<IIDable> 传递给扩展函数，其中 IIDable 是一个具有长 getId() 函数的接口。我尝试使用 GetIds(this List<IIDable> bla) 但编译器不允许我这样做。我改用模板，然后在函数内部将类型转换为接口类型。对于一些 linq to sql 生成的类，我需要这个函数。

我希望这有帮助 ：）

```
 public static List<long> GetIds<T>(this List<T> original){
        List<long> ret = new List<long>();
        if (original == null)
            return ret;

        try
        {
            foreach (T t in original)
            {
                IIDable idable = (IIDable)t;
                ret.Add(idable.getId());
            }
            return ret;
        }
        catch (Exception)
        {
            throw new Exception("Class calling this extension must implement IIDable interface");
        } 
```

# .net - .NET 接口

> ID：8066
> 
> 赞同：0
> 
> 时间：2008-08-11T18:30:44.893
> 
> 标签：.net, user-controls, interface

在过去的几年里，我已经从拥有一长串隐藏/显示的控件页面变为使用大量用户控件。我总是在同事之间就最佳实践进行一些讨论。

您是否应该拥有要填充的属性，或者使用参数化的子组件来加载控件中的信息？

我对使用参数的部分恐惧是因为我无法确保所有内容都会被填充。

使用接口的基本规则是什么？我从来没有创造过。我应该试试这个，还是继续使用*“子负载”*？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-11T18:50:28.770

我不确定接口是否会对您有很大帮助。我的理解是，您将页面分解为包含其他控件的“复合”用户控件集，并且您想决定是否使用属性来设置值。

我想这实际上取决于用户控件的设计方式以及它们是否被动态添加到页面等（一种可能的情况）。我个人偏好在构造函数中指定内容或使用工厂方法创建控件。我在创作中负责确保一切都已设置好。我对属性的经验是，有时我会忘记设置某些东西而没有意识到自己的错误。您关于设置属性或使用子的观点，以及填充的所有内容对我来说没有多大意义。如果您有某种依赖关系并且需要加载其他内容，那么无论它是属性还是子，都可能发生这种情况。

我会参考任何有关 VB.NET/C#/OOP 的书来查看接口的语法。接口基本上描述了一个类的契约。如果您有 A 类和 B 类，并且都实现了一个名为 ITime 的接口，那么它们都将提供在 ITime 上定义的所有方法。他们仍然可以添加自己的方法，但至少必须包含 ITime 方法的实现（例如，我们可能将 GetDate()、GetCurrentTime() 作为 ITime 上的方法）。接口不会告诉 A 类或 B 类这些方法应该如何工作——只是它们的名称、参数和返回类型。在 OOP 书籍中查找继承，以获取有关接口继承与实现继承有何不同的更多信息。

# database - 您最喜欢的编程语言与数据库交互的方式是什么？

> ID：8087
> 
> 赞同：7
> 
> 时间：2008-08-11T18:51:43.323
> 
> 标签：database, design-patterns

有许多方法可以连接数据库层并与之交互。例如，在 Java 中，常见的用法是原始 SQL 的[JDBC](http://en.wikipedia.org/wiki/Java_Database_Connectivity)调用、对象关系映射器、JDBCTemplate ( [Spring](http://en.wikipedia.org/wiki/Spring_Framework) )、存储过程等。

在您的语言中，您喜欢哪个选项，为什么？你什么时候考虑其他人？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T19:08:47.250

每次都是ORM，我至少要考虑数据库越好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-11T19:24:44.113

我真的很喜欢 3 + 1 层的做事方式。一层用于 UI，一层用于业务逻辑和持久化数据。你说的最后一个？域对象和接口。这使得加载任何一两个主层以及域“层”成为可能，并且代码应该可以工作。

它严重[依赖依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)和[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)原则。数据/持久层只做两件事。它创建、读取、更新和删除数据，并将其映射到域对象格式。

UI 层的作用正好相反。它以用户可以关联的方式显示和接收数据，并将输出/输入映射到域对象格式和从域对象格式映射。

业务逻辑层只需要知道一件事。商业逻辑。它不关心数据来自哪里，也不关心数据层将数据放在哪里。它知道它应该标记一个刚刚透支的帐户，实际上如何做到这一点并不是它工作的一部分。

域对象本身没有任何逻辑，它们只是用于在层之间传递数据的容器。这意味着您可以加载域对象和接口，而无需考虑依赖关系。

归根结底，我觉得我有一个非常清晰的代码库和清晰的分层。并且通过一些严格的接口和良好的基类，大多数编码只是告诉软件当 X 发生时该做什么。它应该是怎样的。

```
</rant> 
```

编辑：哦，是的。这对于 LINQ、[SubSonic](http://en.wikipedia.org/wiki/Subsonic_%28software%29)和其他 ORM 都是如此。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-12T00:42:06.237

Ruby on Rails 的[ActiveRecord](http://en.wikipedia.org/wiki/Active_record_pattern#Ruby)与我目前所见的所有其他东西擦了擦地板。[LINQ](http://en.wikipedia.org/wiki/Language_Integrated_Query)看起来在某些情况下可能会更好，但 ActiveRecord 非常灵活。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-11T19:07:35.413

我更喜欢构建业务对象模型层（对象和对象集合）。

我将与数据库交互的能力构建到每个对象/集合中（对于 SQL Server，我使用[System.Data.SqlClient](http://msdn.microsoft.com/en-us/library/system.data.sqlclient%28v=vs.71%29.aspx)）。我已经将这种模式用于 SQL Server、MySQL 和 Oracle。

然后我与我的应用程序代码中的对象进行交互。

通过将我的数据库抽象为对象，无论后端数据库如何，我的应用程序代码都是一致的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-11T19:09:31.900

LINQ 是我从这里开始的方式

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T23:35:12.160

ORM 确实很棒。

我在 python 中工作时使用 SQL Alchemy - 它几乎适用于我遇到的每个 DBMS。

对于 MacOS X 上的轻量级数据驱动应用程序，我使用 Core Data，它具有可通过 Xcode 访问的出色数据建模工具。

这两者都表明，正确完成的 ORM 非常出色。我对 EJB 的成功和享受较少。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-11T23:42:06.933

我还没有进入 LINQ 世界，但我真的很喜欢 Visual Studio 通过 XSD 数据集完成的 DataTable/TableAdapter 类。在创建我的数据库模式后通过几次拖动和单击，我现在有一个强类型的 DataSet/DataTable 对象，并且我有适配器方法，这些方法对我的所有 CRUD 语句的存储过程使用参数化查询。它甚至会为一些不直接绑定到表的过程创建查询表适配器。

哦，如果您还没有创建存储过程并且只有表，那么向导将为您创建过程或即席 SQL 语句。

这自 Visual Studio 2005 以来就已经推出，并且大大减少了我使用新 Web 应用程序的“结构”时间，我可以更多地专注于业务和演示逻辑。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-09T09:15:34.553

我们使用混合方法，具体取决于适合应用程序中特定情况的方法：

*   当阅读页面需要显示的信息和用户更新时，我们使用 Hibernate
*   当处理一批更新或总结大部分数据已经在数据库中的位置时（例如，日终处理），我们使用 PL/SQL（并尝试在集合中思考）
*   当用户执行搜索或运行摘要报告时，我们使用 ibatis sqlmaps 构建一些 SQL 并只带回我们感兴趣的字段（不是每一列，当然也不是任何不必要的子行，urggh）
*   任何真正需要快速运行的东西，我们都会使用最有效的方法

这是使用 java/Oracle。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-12T00:32:52.183

在 C# 中，我喜欢使用[LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL)来处理任何新事物，但如果我在 .NET 2.0 上使用 C# ，我真的很喜欢使用[.netTiers](http://www.codesmithtools.com/product/frameworks#nettiers) + [CodeSmith Generator来为数据库生成一个快速而肮脏的数据层。](http://www.codesmithtools.com/product/generator)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T08:05:26.107

我非常喜欢[Hibernate](http://en.wikipedia.org/wiki/Hibernate_%28Java%29) :)

我知道它有一个学习曲线，但是一旦你掌握了它，它就会非常好。

不用说，我迫不及待地想要使用 .NET 3.5 SP1 中的新[实体框架](http://ADO.NET%20Entity%20Framework)（我知道它已经可用，但我有点懒得输入 XML :)）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-12T08:55:03.917

[ActiveRecord](http://en.wikipedia.org/wiki/Active_record_pattern)，这是 Fowler's [Patterns of Enterprise Architecture](https://rads.stackoverflow.com/amzn/click/com/0321127420)中首先记录的一种模式（我认为） 。我相信它是用 Ruby 以外的语言实现的，尽管它是众所周知的 Rails 的核心技术。不管怎样，它是一个简洁的数据库抽象，尽管我不得不承认我发现它有点笨拙并且位于 find_by_sql 区域。但这可能只是我。

但是（现在戴上 Grumpy Old Man 的帽子）世界上所有的 ORM 都不能替代对 SQL 的良好了解，如果没有这些知识，我真的不希望看到允许访问 RDBMS。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-12T11:30:32.120

我们目前正在使用[ODAC](http://en.wikipedia.org/wiki/Oracle_Database#Database_.22features.22)与 Oracle 数据库通信并使用大量 Oracle 包 ( [PL/SQL](http://en.wikipedia.org/wiki/PL/SQL) )。n 层系统是通过 RemObjects 完成的，这意味着我们的客户端中没有任何 SQL，只需要发送 HTTP 请求的能力，因此没有安装开销。

所有这些都是使用 Borland Delphi 完成的，并且已经在生产环境中工作了 2 年。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-25T05:40:29.383

我们通过 Oracle.OleDBProvider 使用 Delphi 和 Oracle 数据访问组件 (ODAC) 和 ADO。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-09T06:07:36.250

可能最喜欢的方法是将 Smalltalk 与 GemStone 对象存储库一起使用。为什么？无需处理 ORM 问题。如果我的雇主强迫或威胁我，我只会考虑其他事情。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-09T06:13:37.593

我最喜欢的方法是拥有一个对象抽象层。理想情况下，这是*唯一*可以使用 SQL 的地方。但在实践中，对象有时也需要执行 SQL-y 操作。但在对象之外什么都没有。

到目前为止，我自己编写了这样的层，因为可用的层太笨拙、太慢或太大。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-04-09T11:02:38.840

我使用普通的 JDBC，因为我正在开发一个数据驱动的应用程序并且我的数据库模型非常复杂。一切都在数据库中描述，甚至是其他表的结构。除此之外，我还经常使用存储过程。因此 ORM 不是我的选择。

# mysql - 用于回退方案的 MySQL 复制

> ID：8107
> 
> 赞同：10
> 
> 时间：2008-08-11T19:12:33.920
> 
> 标签：mysql, replication, fallback, binary-log

当我有两台 mysql 服务器有不同的作业（持有不同的数据库）但希望能够在另一台出现故障时使用其中一个来滑入，你会建议我如何让它们上的数据保持相等“关闭实时”？

显然，不可能每 x 分钟进行一次完整的数据库转储。

我已经阅读了[Binary Log](http://dev.mysql.com/doc/refman/5.0/en/binary-log.html)，这是我需要走的路吗？这不会大大降低备用服务器的速度吗？有没有办法不在二进制日志中包含一些表 - 数据已经改变并不重要？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-13T17:26:45.007

您可能需要考虑**主-主**复制方案，但需要稍作改动。您可以指定要复制的数据库并限制每个服务器的复制。

对于 server1，我会将`--replicate-do-db=server_2_db`server2添加`--replicate-do-db=server_1_db`到您的 my.cnf（或 Windows 上的 my.ini）中。这意味着只有 server_1_db 的语句会被复制到 server2，反之亦然。

还请确保您定期执行完整备份，而不是仅仅依赖复制，因为它不能提供对意外`DROP DATABASE`陈述或类似情况的安全性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T19:22:13.060

二进制日志绝对是要走的路。但是，您应该知道，使用**MySQL**，您不能像那样在服务器之间来回切换。

一台服务器是**主**服务器，另一台服务器是从服务器。您向主服务器写入/读取，但只能从从服务器读取。如果您曾经写信给从属设备，它们将不同步，并且没有简单的方法让它们再次同步（基本上，您必须交换它们以便主设备成为新的从设备，但这是一个繁琐的手动过程）。

如果您需要真正的热插拔备份数据库，您可能必须使用**MySQL**以外的系统。如果你想要的只是一个只读的实时备份，你可以在最坏的情况下立即使用（master 被永久销毁），Binary Log 将非常适合你。

# visual-studio - 预构建任务 - 删除 CruiseControl.NET 中的工作副本

> ID：8127
> 
> 赞同：8
> 
> 时间：2008-08-11T19:36:47.630
> 
> 标签：visual-studio, continuous-integration, cruisecontrol.net, visualsvn-server

我目前正在工作中建立一个持续集成环境。我们正在使用 VisualSVN 服务器和 CrusieControl.NET。有时构建会失败，症状是 CruiseControl.NET 工作副本中存在冲突。我相信这是由于我设置 Visual Studio 解决方案的方式。希望我们在这种环境中运行的项目越多，我们对如何设置它们的理解就会越好，所以我不会质疑为什么会在这个阶段发生冲突。为了修复构建，我删除了工作副本并强制构建新的构建 - 这每次都有效（当前）。所以我的问题是：删除工作副本是否是持续集成构建过程的有效部分，我该怎么做？

我已经尝试过解决方案，包括 MSTask 和从命令行调用 delete，但我没有任何运气。

抱歉这么罗嗦 - 干得好，这是一个测试版 :)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-11T20:27:11.603

在构建之前或之后进行完全删除是一种很好的做法。这意味着您的构建环境不可能拾取过时的文件。您的构建完全符合存储库中的内容。

正如我使用 Nant 所做的那样，可以删除工作副本。

在 Nant 中，我会在自己的文件夹中拥有一个干净的脚本，而不是我要删除的那个，然后从 CC.net 调用它。

我认为这也应该可以通过批处理文件实现。看看 rmdir 命令[http://www.computerhope.com/rmdirhlp.htm](http://www.computerhope.com/rmdirhlp.htm)

@pauldoo

我更喜欢我的 CI 服务器进行完全删除，因为当我进行发布构建时我不希望有任何意外，这应该始终从干净的状态完成。但它应该能够同时处理两者，没有理由不

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-25T12:01:25.290

@jamie：使用持续集成服务器时可能无法每次都进行干净构建的原因之一——构建时间。在我参与过的一些项目中，干净的构建需要 80 多分钟（一个由数千个 C++ 文件组成的嵌入式项目，需要检出然后针对多个目标进行编译）。在这种情况下，您必须权衡快速反馈的好处与干净构建会捕获增量构建不会捕获的东西的可能性。在我们的案例中，我们致力于改进和并行化构建过程，同时允许在我们的 CI 机器上进行增量构建。我们确实遇到了一些问题，因为我们没有进行干净的构建，但是通过每晚或每周进行一次干净的构建，您可以消除风险，而不会丢失 CI 机器的快速反馈。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T20:39:03.560

如果您查看 CC.NET 的[jira](http://jira.public.thoughtworks.org/browse/CCNET-1256)，则会签入一个补丁来实现 CleanCopy for Subversion，这正是您想要的，只需在源代码控制块内将 CleanCopy 设置为 true，就像使用 TFS 一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T20:16:01.967

对于任何构建过程来说，在进行任何重要构建之前进行“清理”是非常常见且通常是一种很好的做法。这可以防止以前构建的任何“工件”污染输出。

清理本质上是您通过删除工作副本所做的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T20:21:52.953

@布拉德·巴克

清洁意味着只清除构建产品。

删除工作副本也会删除其他所有内容（源文件和项目文件等）。

一般来说，如果您的构建机器可以在不进行完全删除的情况下运行，那就太好了，因为这复制了普通开发人员所做的事情。它在更新期间发现的任何冲突都是对您的开发人员可以预期的早期警告。

* * *

@杰米

对于正式版本，是的，最好进行完全干净的结帐。所以我想这取决于构建的目的。

# .net - 如何计算字符串的 CRC32

> ID：8128
> 
> 赞同：47
> 
> 时间：2008-08-11T19:41:20.320
> 
> 标签：.net, crc32

如何计算 .NET 中字符串的 CRC32（循环冗余校验和）？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-08-11T19:43:31.003

这个人似乎有你的答案。

> [https://damieng.com/blog/2006/08/08/calculating_crc32_in_c_and_net](https://damieng.com/blog/2006/08/08/calculating_crc32_in_c_and_net)

如果博客消失或破坏 url，这里是 github 链接：

> [https://github.com/damieng/DamienGKit/blob/master/CSharp/DamienG.Library/Security/Cryptography/Crc32.cs](https://github.com/damieng/DamienGKit/blob/master/CSharp/DamienG.Library/Security/Cryptography/Crc32.cs)

* * *

博客文章中 Crc32 类的用法：

```
Crc32 crc32 = new Crc32();
String hash = String.Empty;

using (FileStream fs = File.Open("c:\\myfile.txt", FileMode.Open))
  foreach (byte b in crc32.ComputeHash(fs)) hash += b.ToString("x2").ToLower();

Console.WriteLine("CRC-32 is {0}", hash); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2018-08-19T22:01:10.860

由于您似乎正在寻找计算字符串（而不是文件）的 CRC32，因此这里有一个很好的示例：[https ://rosettacode.org/wiki/CRC-32#C.23](https://rosettacode.org/wiki/CRC-32#C.23)

代码应该永远消失：

```
/// <summary>
/// Performs 32-bit reversed cyclic redundancy checks.
/// </summary>
public class Crc32
{
    #region Constants
    /// <summary>
    /// Generator polynomial (modulo 2) for the reversed CRC32 algorithm. 
    /// </summary>
    private const UInt32 s_generator = 0xEDB88320;
    #endregion

    #region Constructors
    /// <summary>
    /// Creates a new instance of the Crc32 class.
    /// </summary>
    public Crc32()
    {
        // Constructs the checksum lookup table. Used to optimize the checksum.
        m_checksumTable = Enumerable.Range(0, 256).Select(i =>
        {
            var tableEntry = (uint)i;
            for (var j = 0; j < 8; ++j)
            {
                tableEntry = ((tableEntry & 1) != 0)
                    ? (s_generator ^ (tableEntry >> 1)) 
                    : (tableEntry >> 1);
            }
            return tableEntry;
        }).ToArray();
    }
    #endregion

    #region Methods
    /// <summary>
    /// Calculates the checksum of the byte stream.
    /// </summary>
    /// <param name="byteStream">The byte stream to calculate the checksum for.</param>
    /// <returns>A 32-bit reversed checksum.</returns>
    public UInt32 Get<T>(IEnumerable<T> byteStream)
    {
        try
        {
            // Initialize checksumRegister to 0xFFFFFFFF and calculate the checksum.
            return ~byteStream.Aggregate(0xFFFFFFFF, (checksumRegister, currentByte) => 
                      (m_checksumTable[(checksumRegister & 0xFF) ^ Convert.ToByte(currentByte)] ^ (checksumRegister >> 8)));
        }
        catch (FormatException e)
        {
            throw new CrcException("Could not read the stream out as bytes.", e);
        }
        catch (InvalidCastException e)
        {
            throw new CrcException("Could not read the stream out as bytes.", e);
        }
        catch (OverflowException e)
        {
            throw new CrcException("Could not read the stream out as bytes.", e);
        }
    }
    #endregion

    #region Fields
    /// <summary>
    /// Contains a cache of calculated checksum chunks.
    /// </summary>
    private readonly UInt32[] m_checksumTable;

    #endregion
} 
```

并使用它：

```
var arrayOfBytes = Encoding.ASCII.GetBytes("The quick brown fox jumps over the lazy dog");

var crc32 = new Crc32();
Console.WriteLine(crc32.Get(arrayOfBytes).ToString("X")); 
```

您可以在此处测试输入/输出值：[https ://crccalc.com/](https://crccalc.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-04-29T06:46:09.137

使用上一个答案中的逻辑，这是我的看法：

```
public class CRC32
{
    private readonly uint[] ChecksumTable;
    private readonly uint Polynomial = 0xEDB88320;

    public CRC32()
    {
        ChecksumTable = new uint[0x100];

        for (uint index = 0; index < 0x100; ++index)
        {
            uint item = index;
            for (int bit = 0; bit < 8; ++bit)
                item = ((item & 1) != 0) ? (Polynomial ^ (item >> 1)) : (item >> 1);
            ChecksumTable[index] = item;
        }
    }

    public byte[] ComputeHash(Stream stream)
    {
        uint result = 0xFFFFFFFF;

        int current;
        while ((current = stream.ReadByte()) != -1)
            result = ChecksumTable[(result & 0xFF) ^ (byte)current] ^ (result >> 8);

        byte[] hash = BitConverter.GetBytes(~result);
        Array.Reverse(hash);
        return hash;
    }

    public byte[] ComputeHash(byte[] data)
    {
        using (MemoryStream stream = new MemoryStream(data))
            return ComputeHash(stream);
    }
} 
```

# plugins - 添加插件功能的建议？

> ID：8140
> 
> 赞同：15
> 
> 时间：2008-08-11T19:48:52.053
> 
> 标签：plugins, extensibility

是否有将可扩展性功能编程到代码中的通用过程？

我想知道为您正在编写的系统添加扩展类型功能的一般过程是什么，以便可以通过某种插件 API 扩展功能，而不必修改系统的核心代码。

这些事情是否往往取决于系统编写的语言，或者是否有允许这样做的通用方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T20:06:53.857

过去我曾为插件使用基于事件的 API。您可以通过调度事件并提供对应用程序状态的访问来为插件插入挂钩。

例如，如果您正在编写博客应用程序，您可能希望在将新帖子保存到数据库之前引发一个事件，并将帖子 HTML 提供给插件以根据需要进行更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T20:00:09.627

这通常是您必须暴露自己的东西，所以是的，它将取决于您的系统编写的语言（尽管通常也可以为其他语言编写包装器）。

例如，如果您有一个用 C 语言编写的 Windows 程序，那么插件将为您的程序编写为 DLL。在运行时，您将手动加载这些 DLL，并向它们公开一些接口。例如，DLL 可能会公开一个`gimme_the_interface()`函数，该函数可以接受一个由函数指针填充的结构。这些函数指针将允许 DLL 进行调用、注册回调等。

如果你在 C++ 中，你会使用 DLL 系统，除了你可能会传递一个对象指针而不是一个结构，并且对象将实现一个提供功能的接口（完成与结构相同的事情，但不那么丑陋）。对于 Java，您将按需加载类文件而不是 DLL，但基本思想是相同的。

在所有情况下，您都需要在代码和插件之间定义一个标准接口，以便您可以初始化插件，以便插件可以与您交互。

PS 如果您想查看 C++ 插件系统的一个很好的示例，请查看[foobar2000 SDK](http://foobar2000.com/SDK.html)。好久没用了，不过用起来确实不错。我认为它仍然是。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-11T20:15:06.570

我很想向您指出这个通用问题的设计模式书：p

说真的，我认为答案是否定的。默认情况下你不能编写可扩展的代码，它既难以编写/扩展又非常低效（Mozilla 最初的想法是非常可扩展，到处使用 XPCOM，现在他们意识到这是一个错误并开始删除它没有意义的地方）。

有意义的做法是确定可以有意义地扩展的系统部分，并为这些情况支持适当的 API（例如，编辑器中的语言支持插件）。您将使用相关模式，但具体实现取决于您的平台/语言选择。

IMO，它还有助于使用动态语言 - 可以在运行时调整核心代码（当绝对必要时）。我很欣赏 Mozilla 在编写 Firefox 扩展时的可扩展性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-18T20:06:35.703

我认为你的问题有两个方面：

系统设计可扩展（设计模式、控制反转和其他架构方面）（[http://www.martinfowler.com/articles/injection.html](http://www.martinfowler.com/articles/injection.html)）。而且，至少对我来说，是的，这些模式/技术与平台/语言无关，可以看作是“一般程序”。

现在，它们的实现依赖于语言和平台（例如，在 C/C++ 中，你有动态库的东西等）

已经开发了几个“框架”来为您提供一个为您提供可插入性/可扩展性的编程环境，但正如其他人所提到的，不要太疯狂地让所有东西都可插入。

在 Java 世界中，一个很好的规范是 OSGi（[http://en.wikipedia.org/wiki/OSGi](http://en.wikipedia.org/wiki/OSGi)），它有几个实现，恕我直言，最好的一个是 Equinox（[http://www.eclipse.org/equinox/](http://www.eclipse.org/equinox/)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T19:59:34.730

1.  找出您想对插件编写器提出的最低要求。然后制作一个或多个接口，编写者必须为您的代码实现一个或多个接口，以了解何时何地执行代码。

2.  制作一个 API，编写者可以使用它来访问代码中的某些功能。

您还可以创建一个作家必须继承的基类。这将使连接 API 更容易。然后使用某种反射来扫描目录，并加载您找到的符合您要求的类。

有些人还为他们的系统制作脚本语言，或者为现有语言的子集实现解释器。这也是一条可能的路线。

底线是：当您加载代码时，只有您的想象力才能阻止您。
祝你好运。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T20:40:44.413

如果您使用的是 C 或 C++ 等编译语言，最好通过脚本语言查看插件支持。Python 和 Lua 都是用于编写大量应用程序的优秀语言（Civ4 和 blender 使用 Python，Supreme Commander 使用 Lua 等）。

如果您使用的是 C++，请查看 boost python 库。否则，python 附带可以在 C 中使用的标头，并且在记录 C/python API 方面做得相当好。Lua 的文档似乎不太完整，但我可能还不够努力。无论哪种方式，您都可以提供一个相当可靠的脚本平台，而无需大量工作。它仍然不是微不足道的，但它为您提供了一个很好的工作基础。

# .net - 什么时候应该使用 Compiled LINQ 与 Normal LINQ

> ID：8142
> 
> 赞同：5
> 
> 时间：2008-08-11T19:50:31.393
> 
> 标签：.net, linq-to-sql

我刚刚阅读了 LINQ 的性能，使用 Compiled LINQ 可以获得大量收益。

现在，为什么我不总是使用已编译的 LINQ？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T19:57:30.990

简短的回答：当它在很长一段时间内只会发生一次时。

[长答案](http://blogs.msdn.com/ricom/archive/2008/01/14/performance-quiz-13-linq-to-sql-compiled-query-cost-solution.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-04-02T12:59:31.960

当大部分时间都在执行某些 linq 查询时，您应该使用它。这些可以转换为已编译的 lynq。由于查询的执行路径将在编译时设置，因此性能将得到提高。我在我的项目中使用了它，性能提高了一个档次。

# sql - 如何在 Oracle 9i 上找到高水位线（会话）

> ID：8145
> 
> 赞同：7
> 
> 时间：2008-08-11T19:53:16.443
> 
> 标签：sql, oracle, session, oracle9i

如何在**oracle 数据库 (9i) 中找到高水位线（历史最大并发用户数）**。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T20:05:44.377

这应该可以解决问题：

```
SELECT sessions_highwater FROM v$license; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-11T20:09:12.903

```
select max_utilization from v$resource_limit where resource_name = 'sessions'; 
```

可以在[此处](http://www.adp-gmbh.ch/ora/misc/dynamic_performance_views.html)找到对 Oracle 系统视图的一个很好的概述。

# asp.net-mvc - 如何在 MVC 中使用 HtmlHelper 获取自定义 id 来呈现

> ID：8147
> 
> 赞同：6
> 
> 时间：2008-08-11T19:54:20.687
> 
> 标签：asp.net-mvc, html-helper

使用[ASP.NET MVC](http://asp.net/mvc) 代码的[预览 4](http://www.codeplex.com/aspnet)，例如：

```
<%= Html.CheckBox( "myCheckBox", "Click Here", "True", false ) %> 
```

仅输出：

```
<input type="checkbox"  value="True"  name="myCheckBox"  /> 
```

有一个`name`用于回发的表单，但没有`id`用于 javascript 或标签 :-(

我希望将其更改为：

```
Html.CheckBox( "myCheckBox", "Click Here", 
               "True", false, new { id="myCheckBox" } ) 
```

会工作 - 但相反我得到一个例外：

```
System.ArgumentException: An item with the same key has already been added. 
```

好像某个集合中的某个地方已经有一个 id - 我很难过！

任何感兴趣的人的完整例外如下（嘿 - 在这里附加文件不是很好吗）：

```
System.ArgumentException：已添加具有相同键的项目。
   在 System.ThrowHelper.ThrowArgumentException（ExceptionResource 资源）
   在 System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)
   在 System.Web.Routing.RouteValueDictionary.Add（字符串键，对象值）
   在 System.Web.Mvc.TagBuilder2.CreateInputTag（HtmlInputType inputType，字符串名称，RouteValueDictionary 属性）
   在 System.Web.Mvc.CheckBoxBuilder.CheckBox（字符串 htmlName，RouteValueDictionary htmlAttributes）
   在 System.Web.Mvc.CheckBoxBuilder.CheckBox（字符串 htmlName，字符串文本，字符串值，布尔 isChecked，RouteValueDictionary htmlAttributes）
   在 System.Web.Mvc.CheckBoxExtensions.CheckBox（HtmlHelper 助手，字符串 htmlName，字符串文本，字符串值，布尔 isChecked，对象 htmlAttributes）
   在 ASP.views_account_termsandconditions_ascx.__Render__control1(HtmlTextWriter __w, Control parameterContainer) 在 c:\dev\myProject\Views\Account\Edit.ascx:line 108
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T22:26:29.177

试试这个：

```
<%= Html.CheckBox("myCheckbox", "Click here", "True", false, new {_id ="test" })%> 
```

对于任何关键字，您都可以在属性名称前使用下划线。您使用 _class 而不是类。由于 class 是 C# 中的关键字，也是 HTML 中属性的名称。现在，“id”不是 C# 中的关键字，但可能是他们想要支持的另一种 .NET 语言。据我所知，它不是 VB.NET、F# 或 Ruby 中的关键字，所以他们强迫您使用下划线可能是一个错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T20:12:48.963

显然这是一个错误。因为他们将它添加到潜在的渲染值中，所以他们只是忘记了包含它。我建议在 codeplex 上创建一个错误，并下载源代码并根据您的需要进行修改。

# python - Pylons 错误 - 'MySQL 服务器已消失'

> ID：8154
> 
> 赞同：16
> 
> 时间：2008-08-11T19:59:32.670
> 
> 标签：python, mysql, pylons

我正在使用 Pylons（一个 Python 框架）来提供一个简单的 Web 应用程序，但它似乎时不时会死掉，在错误日志中会出现这样的情况：`(2006, 'MySQL server has gone away')`

我做了一些检查，发现这是因为与 MySQL 的连接没有被更新。不过这应该不是问题，因为`sqlalchemy.pool_recycle`配置文件中的 应该自动保持它的活动状态。默认是，但由于这个问题`3600`，我将其拨回。`1800`它有点帮助，但根据文档`3600` *应该没问题。*错误仍然半定期发生。我不想降低太多，但我自己的数据库是 DOS :)。

也许我的 MySQL 配置中的某些东西很愚蠢？不知道在哪里看。

其他相关细节：

```
 Python 2.5
  Pylons: 0.9.6.2 (w/ sql_alchemy)
  MySQL: 5.0.51 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-05T18:07:50.310

我想我修好了。事实证明我有一个简单的配置错误。我的ini文件读到：

```
sqlalchemy.default.url = [connection string here]
sqlalchemy.pool_recycle = 1800 
```

问题是我的`environment.py`文件声明引擎只会映射带有前缀的键：`sqlalchemy.default`所以`pool_recycle`被忽略了。

解决方案是简单地将 ini 中的第二行更改为：

```
sqlalchemy.default.pool_recycle = 1800 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-18T21:35:39.387

您可能需要检查 MySQL 的超时变量：

```
show variables like '%timeout%'; 
```

您可能对`wait_timeout`（不太可能但可能：）感兴趣`interactive_timeout`。在 Debian 和 Ubuntu 上，默认值为 28800（MySQL 会在 8 小时后终止连接），但您的平台的默认值可能不同，或者管理服务器的人的配置不同。

AFAICT，`pool_recycle`实际上并没有使连接保持活动状态，它会在 MySQL 杀死它们之前自行使它们过期。我对 pylon 不熟悉，但是如果可以`SELECT 1;`选择让连接间歇性地执行 a 操作，那将使它们保持活动状态，但代价是基本上没有服务器负载和最小的网络流量。最后一个想法：您是否以某种方式设法使用 pylons 认为它​​已过期的连接？

# mysql - MySQL 复制：如果我不指定任何数据库，log_bin 会记录所有内容吗？

> ID：8166
> 
> 赞同：21
> 
> 时间：2008-08-11T20:08:03.310
> 
> 标签：mysql, replication

我正在为运行一堆数据库（每个客户端一个）的服务器设置复制，并计划在 my.cnf 上一直添加更多数据库，而不是：

```
binlog-do-db  = databasename 1
binlog-do-db  = databasename 2
binlog-do-db  = databasename 3
...
binlog-do-db  = databasename n 
```

我可以拥有吗

```
binlog-ignore-db  = mysql
binlog-ignore-db  = informationschema 
```

（并且没有指定要记录的数据库）并假设记录了其他所有内容？

编辑：实际上，如果我删除所有 binlog-do-db 条目，它似乎会记录所有内容（当您移动数据库时，您会看到二进制日志文件更改位置），但在从属服务器上，什么都没有被拾取！（也许，这是使用replicate-do-db的情况？这会扼杀这个想法；我想我不能让MySQL自动检测要复制的数据库）。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-11T20:22:24.730

这看起来是正确的： http: [//dev.mysql.com/doc/refman/5.0/en/binary-log.html#option_mysqld_binlog-ignore-db](http://dev.mysql.com/doc/refman/5.0/en/binary-log.html#option_mysqld_binlog-ignore-db)。

根据该参考：

> 有一些 --binlog-ignore-db 规则。默认数据库是否匹配任何 --binlog-ignore-db 规则？
> 
> *   是：不写语句，退出。
> *   否：编写查询并退出。

由于您只有忽略命令，因此只要默认（活动）数据库与忽略的数据库之一不匹配，所有查询都将写入日志。

# sql - 从 CSV 文件生成插入 SQL 语句

> ID：8213
> 
> 赞同：60
> 
> 时间：2008-08-11T20:59:11.973
> 
> 标签：sql, csv, insert, firebird

我需要将一个 csv 文件导入**Firebird**，我花了几个小时尝试了一些工具，但没有一个适合我的需要。

主要问题是我一直在尝试的所有工具（如[EMS 数据导入](http://www.sqlmanager.net/products/ibfb/dataimport)和[Firebird 数据向导](http://www.sqlmaestro.com/products/firebird/datawizard/help/06_01_05_csv/)）都希望我的 CSV 文件包含我的表所需的所有信息。

我需要在插入语句中编写一些自定义 SQL，例如，我有一个带有城市名称的 CSV 文件，但是由于我的数据库已经在另一个表中包含所有城市（规范化），我需要在插入中编写一个子选择查找城市并写入其 ID 的语句，我还有一个存储过程来读取 GUIDS。

我的插入语句将是这样的：

```
INSERT INTO PERSON (ID, NAME, CITY_ID) VALUES((SELECT NEW_GUID FROM CREATE_GUID), :NAME, (SELECT CITY_ID FROM CITY WHERE NAME = :CITY_NAME) 
```

我该如何处理？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-08-11T21:07:51.287

这有点粗糙 - 但对于临时工作，我有时会使用 Excel。

如果将 CSV 文件导入 Excel，则可以创建一个公式，该公式通过在公式中使用字符串连接来创建 INSERT 语句。所以 - 如果您的 CSV 文件有 3 列出现在 Excel 的 A、B 和 C 列中，您可以编写如下公式...

```
="INSERT INTO MyTable (Col1, Col2, Col3) VALUES (" & A1 & ", " & B1 & ", " & C1 & ")" 
```

然后，您可以将公式复制到所有行中，并将答案复制并粘贴到文本文件中以针对您的数据库运行。

就像我说的那样——它很粗糙——但它可能是一种“快速而肮脏”的完成工作的方式！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-11T21:02:14.620

好吧，如果它是 CSV，并且这是一个一次性的过程，请在 Excel 中打开文件，然后编写公式以您想要的任何方式填充您的数据，然后编写一个简单的 Concat 公式来构建您的 SQL，然后然后为每一行复制该公式。您将获得大量的 SQL 语句，您可以在任何地方执行这些语句。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-11T21:14:21.897

法比奥，

我已经做过 Vaibhav 做过很多次的事情，这是一种将数据输入数据库的“快速而肮脏”的好方法。

如果您需要多次执行此操作，或按某种计划执行此操作，那么更可靠的方法是将 CSV 数据“按原样”加载到工作表（即 customer_dataload）中，然后使用标准 SQL 语句填充缺少字段。

（我不知道 Firebird 的语法 - 但类似......）

```
UPDATE person
SET id = (SELECT newguid() FROM createguid)

UPDATE person
SET cityid = (SELECT cityid FROM cities WHERE person.cityname = cities.cityname) 
```

等等

通常，将数据导入数据库然后修复数据比在上传期间尝试修复数据要快得多（也更可靠）。您还可以获得交易的好处，如果它不起作用，您可以回滚！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-11T21:13:51.290

您可以将 CSV 文件按原样导入表中，然后编写一个 SQL 查询，对导入的表执行所有必需的转换并将结果插入到目标表中。

所以像：

> <(将 CSV 文件加载到 temp_table - n, city_name)>
> 
> 插入目标表
> 
> 选择 tn, c.city_id 作为城市
> 
> 来自 temp_table t，城市 c
> 
> 其中 t.city_name = c.city_name

关于使用 Excel 的好建议，但我也建议熟悉 Python 之类的脚本语言，因为对于某些任务，编写一个快速的 Python 脚本来完成这项工作比尝试在 Excel 或预制造完成这项工作的工具。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T02:25:36.200

我会用[awk](http://www.grymoire.com/Unix/Awk.html)来做这个。

例如，如果您在 CSV 文件中有此信息：

```
Bob,New York
Jane,San Francisco
Steven,Boston
Marie,Los Angeles 
```

以下命令将为您提供所需的内容，在与您的 CSV 文件（`name-city.csv`在此示例中命名）相同的目录中运行。

```
$ awk -F, '{ print "INSERT INTO PERSON (ID, NAME, CITY_ID) VALUES ((SELECT NEW_GUID FROM CREATE_GUID), '\''"$1"'\'', (SELECT CITY_ID FROM CITY WHERE NAME = '\''"$2"'\''))" }' name-city.csv 
```

键入`awk --help`以获取更多信息。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-08-20T00:33:34.847

**2020 年**帮助我的两个在线工具：

[https://numidian.io/convert/csv/to/sql](https://numidian.io/convert/csv/to/sql)

[https://www.convertcsv.com/csv-to-sql.htm](https://www.convertcsv.com/csv-to-sql.htm)

第二个是基于 JS 的，不会上传你的数据（至少在我写这篇文章的时候没有）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-06T14:27:13.833

您可以使用免费的[csvsql](http://csvkit.readthedocs.io/en/0.4.4/scripts/csvsql.html)来执行此操作。

*   [使用这些说明](http://csvkit.readthedocs.io/en/0.9.1/index.html)安装它
*   现在运行这样的命令将数据导入数据库。上面链接中的更多详细信息，但它会是这样的：

    `csvsql --db firebase:///d=mydb --insert mydata.csv`

*   以下适用于 sqlite，并且是我用来将数据转换为易于查询的格式

    `csvsql --db sqlite:///dump.db --insert mydata.csv`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-05T16:18:41.140

刚刚完成了这个 VBA 脚本，它可能对这个目的很方便。所需要做的就是更改 Insert 语句以包含有问题的表和列列表（显然与它们在 Excel 文件中出现的顺序相同）。

```
Function CreateInsertStatement()
    'Output file location and start of the insert statement
    SQLScript = "C:\Inserts.sql"
    cStart = "Insert Into Holidays (HOLIDAY_ID, NAT_HOLDAY_DESC, NAT_HOLDAY_DTE) Values ("

    'Open file for output
    Open SQLScript For Output As #1

    Dim LoopThruRows As Boolean
    Dim LoopThruCols As Boolean

    nCommit = 1 'Commit Count
    nCommitCount = 100 'The number of rows after which a commit is performed

    LoopThruRows = True
    nRow = 1 'Current row

    While LoopThruRows

        nRow = nRow + 1 'Start at second row - presuming there are headers
        nCol = 1 'Reset the columns
        If Cells(nRow, nCol).Value = Empty Then
            Print #1, "Commit;"
            LoopThruRows = False
        Else
            If nCommit = nCommitCount Then
                Print #1, "Commit;"
                nCommit = 1
            Else
                nCommit = nCommit + 1
            End If

            cLine = cStart
            LoopThruCols = True

            While LoopThruCols
                If Cells(nRow, nCol).Value = Empty Then
                    cLine = cLine & ");"                    'Close the SQL statement
                    Print #1, cLine                         'Write the line
                    LoopThruCols = False                    'Exit the cols loop
                Else
                    If nCol > 1 Then                        'add a preceeding comma for all bar the first column
                        cLine = cLine & ", "
                    End If
                    If Right(Left(Cells(nRow, nCol).Value, 3), 1) = "/" Then 'Format for dates
                        cLine = cLine & "TO_DATE('" & Cells(nRow, nCol).Value & "', 'dd/mm/yyyy')"
                    ElseIf IsNumeric(Left(Cells(nRow, nCol).Value, 1)) Then 'Format for numbers
                        cLine = cLine & Cells(nRow, nCol).Value
                    Else 'Format for text, including apostrophes
                        cLine = cLine & "'" & Replace(Cells(nRow, nCol).Value, "'", "''") & "'"
                    End If

                    nCol = nCol + 1
                End If
            Wend
        End If
    Wend

    Close #1

End Function 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-03-09T16:48:57.303

使用 csv 文件作为外部表。然后，您可以使用 SQL 将数据从外部表复制到目标表 - 使用 SQL 的所有可能性。见[http://www.firebirdsql.org/index.php?op=useful&id=netzka](http://www.firebirdsql.org/index.php?op=useful&id=netzka)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-21T16:59:25.647

我最近尝试过的一个非常好用的工具是[FSQL](http://www.volny.cz/iprenosil/interbase/fsql.htm)。

您编写一个 IMPORT 命令，将其粘贴到`FSQL`其中并将 CSV 文件导入到 Firebird 表中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-03-09T15:47:20.020

选项1：1-您尝试过IBExert吗？IBExpert \ 工具 \ 导入数据（试用版或客户版）。

选项 2：2- 使用 F_BLOBLOAD 将您的 csv 文件上传到临时表。3-创建一个存储过程，它使用了 3 个函数（f_stringlength、f_strcopy、f_MID）你跨越了所有的字符串，拉动你的字段来构建你的 INSERT INTO。

链接： 2： http: [//freeadhocudf.org/documentation_english/dok_eng_file.html](http://freeadhocudf.org/documentation_english/dok_eng_file.html) 3： http: [//freeadhocudf.org/documentation_english/dok_eng_string.html](http://freeadhocudf.org/documentation_english/dok_eng_string.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-04-17T14:56:04.727

你可以使用外壳

```
sed "s/,/','/g" file.csv > tmp
sed "s/$/'),(/g" tmp > tmp2
sed "s/^./'&/g" tmp2 > insert.sql 
```

然后添加

```
INSERT INTO PERSON (ID, NAME, CITY_ID) VALUES(
...
); 
```

# wpf - 检测 UI

> ID：8214
> 
> 赞同：8
> 
> 时间：2008-08-11T21:00:40.520
> 
> 标签：wpf, user-interface, instrumentation

你是如何检测你的 UI 的？在过去，我读到人们已经对他们的用户界面进行了检测，但我没有找到关于*如何*检测 UI 的示例或提示。

通过检测，我的意思是收集有关系统使用和性能的数据。有关 Instrumentation 的 MSDN 文章是[http://msdn.microsoft.com/en-us/library/x5952w0c.aspx](http://msdn.microsoft.com/en-us/library/x5952w0c.aspx "这里")。我想捕捉用户点击了哪些按钮、他们使用了哪些键盘快捷键、他们使用哪些术语进行搜索等。

*   你是如何检测你的用户界面的？
*   您存储仪器的格式是什么？
*   您如何处理检测数据？
*   您如何使用此检测逻辑保持 UI 代码干净？

具体来说，我正在 WPF 中实现我的 UI，因此与检测基于 Web 的应用程序相比，这将带来额外的挑战。（即需要将检测数据传输回中心位置等）。也就是说，我觉得该技术可以通过附加属性等概念提供更容易的检测实现。

*   您是否检测过 WPF 应用程序？您对如何实现这一点有任何提示吗？

* * *

编辑：以下博客文章提供了一个有趣的解决方案：[Pixel-In-Gene 博客：WPF 应用程序的 UI 审核技术](https://blog.pixelingene.com/2008/08/techniques-for-ui-auditing-on-wpf-apps/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-04-13T06:51:41.190

这是我如何使用简单的事件管理器连接到 UI 事件并提取事件的关键信息的示例，例如 UI 元素的名称和类型、事件名称和父窗口的类型名称。对于列表，我还提取所选项目。

此解决方案仅侦听从 ButtonBase（Button、ToggleButton、...）派生的控件的单击以及从 Selector（ListBox、TabControl、...）派生的控件中的选择更改。它应该很容易扩展到其他类型的 UI 元素或实现更细粒度的解决方案。该解决方案的灵感来自[Brad Leach 的回答](https://stackoverflow.com/questions/8214/instrumenting-a-ui/31514#31514)。

```
public class UserInteractionEventsManager
{
    public delegate void ButtonClickedHandler(DateTime time, string eventName, string senderName, string senderTypeName, string parentWindowName);
    public delegate void SelectorSelectedHandler(DateTime time, string eventName, string senderName, string senderTypeName, string parentWindowName, object selectedObject);

    public event ButtonClickedHandler ButtonClicked;
    public event SelectorSelectedHandler SelectorSelected;

    public UserInteractionEventsManager()
    {
        EventManager.RegisterClassHandler(typeof(ButtonBase), ButtonBase.ClickEvent, new RoutedEventHandler(HandleButtonClicked));
        EventManager.RegisterClassHandler(typeof(Selector), Selector.SelectionChangedEvent, new RoutedEventHandler(HandleSelectorSelected));
    }

    #region Handling events

    private void HandleSelectorSelected(object sender, RoutedEventArgs e)
    {
        // Avoid multiple events due to bubbling. Example: A ListBox inside a TabControl will cause both to send the SelectionChangedEvent.
        if (sender != e.OriginalSource) return;

        var args = e as SelectionChangedEventArgs;
        if (args == null || args.AddedItems.Count == 0) return;

        var element = sender as FrameworkElement;
        if (element == null) return;

        string senderName = GetSenderName(element);
        string parentWindowName = GetParentWindowTypeName(sender);
        DateTime time = DateTime.Now;
        string eventName = e.RoutedEvent.Name;
        string senderTypeName = sender.GetType().Name;
        string selectedItemText = args.AddedItems.Count > 0 ? args.AddedItems[0].ToString() : "<no selected items>";

        if (SelectorSelected != null)
            SelectorSelected(time, eventName, senderName, senderTypeName, parentWindowName, selectedItemText);
    }

    private void HandleButtonClicked(object sender, RoutedEventArgs e)
    {
        var element = sender as FrameworkElement;
        if (element == null) return;

        string parentWindowName = GetParentWindowTypeName(sender);
        DateTime time = DateTime.Now;
        string eventName = e.RoutedEvent.Name;
        string senderTypeName = sender.GetType().Name;
        string senderName = GetSenderName(element);

        if (ButtonClicked != null) 
            ButtonClicked(time, eventName, senderName, senderTypeName, parentWindowName);
    }

    #endregion

    #region Private helpers

    private static string GetSenderName(FrameworkElement element)
    {
        return !String.IsNullOrEmpty(element.Name) ? element.Name : "<no item name>";
    }

    private static string GetParentWindowTypeName(object sender)
    {
        var parent = FindParent<Window>(sender as DependencyObject);
        return parent != null ? parent.GetType().Name : "<no parent>";
    }

    private static T FindParent<T>(DependencyObject item) where T : class
    {
        if (item == null) 
            return default(T);

        if (item is T)
            return item as T;

        DependencyObject parent = VisualTreeHelper.GetParent(item);
        if (parent == null)
            return default(T);

        return FindParent<T>(parent);
    }

    #endregion
} 
```

为了进行实际的日志记录，我使用 log4net 并创建了一个名为“Interaction”的单独记录器来记录用户交互。这里的“Log”类只是我自己的 log4net 静态包装器。

```
/// <summary>
/// The user interaction logger uses <see cref="UserInteractionEventsManager"/> to listen for events on GUI elements, such as buttons, list boxes, tab controls etc.
/// The events are then logged in a readable format using Log.Interaction.Info().
/// </summary>
public class UserInteractionLogger
{
    private readonly UserInteractionEventsManager _events;
    private bool _started;

    /// <summary>
    /// Create a user interaction logger. Remember to Start() it.
    /// </summary>
    public UserInteractionLogger()
    {
        _events = new UserInteractionEventsManager();

    }

    /// <summary>
    /// Start logging user interaction events.
    /// </summary>
    public void Start()
    {
        if (_started) return;

        _events.ButtonClicked += ButtonClicked;
        _events.SelectorSelected += SelectorSelected;

        _started = true;
    }

    /// <summary>
    /// Stop logging user interaction events.
    /// </summary>
    public void Stop()
    {
        if (!_started) return;

        _events.ButtonClicked -= ButtonClicked;
        _events.SelectorSelected -= SelectorSelected;

        _started = false;
    }

    private static void SelectorSelected(DateTime time, string eventName, string senderName, string senderTypeName, string parentWindowTypeName, object selectedObject)
    {
        Log.Interaction.Info("{0}.{1} by {2} in {3}. Selected: {4}", senderTypeName, eventName, senderName, parentWindowTypeName, selectedObject);
    }

    private static void ButtonClicked(DateTime time, string eventName, string senderName, string senderTypeName, string parentWindowTypeName)
    {
        Log.Interaction.Info("{0}.{1} by {2} in {3}", senderTypeName, eventName, senderName, parentWindowTypeName);
    }
} 
```

然后输出看起来像这样，省略不相关的日志条目。

```
04/13 08:38:37.069 INFO Iact ToggleButton.Click by MyMainWindow 中的 AnalysisButton
04/13 08:38:38.493 信息 Iact ListBox.SelectionChanged 由 MyMainWindow 中的 ListView。已选择：安德烈亚斯·拉森
04/13 08:38:44.587 INFO Iact Button.Click 由 MyMainWindow 中的 EditEntryButton
04/13 08:38:46.068 INFO Iact Button.Click by OkButton 在 EditEntryDialog
04/13 08:38:47.395 INFO Iact ToggleButton.Click by ExitButton in MyMainWindow

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-28T02:08:26.253

以下博客文章为检测 WPF 应用程序提供了很多好主意：WPF 应用程序 [上的 UI 审核技术](https://blog.pixelingene.com/2008/08/techniques-for-ui-auditing-on-wpf-apps/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-11T23:02:48.060

你可以考虑[log4net](http://logging.apache.org/log4net)。它是一个健壮的日志框架，存在于单个 DLL 中。它也是在“非要求”类型模式下完成的，因此如果一个关键进程正在进行，它不会记录，直到资源被释放更多一点。

您可以轻松设置一堆 INFO 级别的记录器并跟踪您需要的所有用户交互，并且将文件发送给您自己不会发生错误崩溃。然后，您还可以将所有 ERROR 和 FATAL 代码记录到单独的文件中，这些文件可以很容易地邮寄给您进行处理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-12T04:38:19.957

如果您使用 WPF 命令，则每个自定义命令都可以记录所采取的操作。您还可以记录启动命令的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T11:31:13.367

也许 WPF 的[Microsoft UI 自动化](http://msdn.microsoft.com/en-us/library/ms747327.aspx)可以提供帮助？它是一个自动化你的 UI 的框架，也许它可以用来为你记录东西......

我们使用自动化框架在 WPF 中自动测试我们的 UI。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-08-11T21:21:31.977

我还没有使用 WPF 进行开发。但我认为它与大多数其他应用程序相同，因为您希望保持 UI 代码尽可能轻量。可以使用许多设计模式，例如显而易见的[MVC](http://en.wikipedia.org/wiki/Model-view-controller)和[外观](http://en.wikipedia.org/wiki/Facade_pattern)。我个人总是尽量保持在 UI 和 BL 层之间移动的对象尽可能轻，如果可以的话，将它们保持为基元。

然后，这可以帮助我专注于改进 UI 层，而无需担心一旦我将（原始）数据扔回去就会发生任何事情。

我希望我正确理解了你的问题，很抱歉我不能提供更多关于 WPF 的上下文帮助。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-02T21:17:23.260

免责声明：我为销售该产品的公司工作，不仅如此，我还是该特定产品的开发人员:)。

如果您对提供此功能的商业产品感兴趣，则可以使用 Runtime Intelligence（Dotfuscator 的一个功能性插件）将使用跟踪功能注入您的 .NET 应用程序。我们不仅提供跟踪功能的实际实施，还提供数据收集、处理和报告功能。

最近在软件业务论坛上讨论了这个主题，我也在此处发布了该主题：[http](http://discuss.joelonsoftware.com/default.asp?biz.5.680205.26) ://discuss.joelonsoftware.com/default.asp?biz.5.680205.26 。

有关我们产品的高级概述，请参见此处： http: [//www.preemptive.com/runtime-intelligence-services.html](http://www.preemptive.com/runtime-intelligence-services.html)。

此外，我目前正在编写一些更面向技术的文档，因为我们意识到这是一个我们肯定可以改进的领域，如果有人有兴趣在我完成时收到通知，请告诉我。

# java - 测试分布

> ID：8219
> 
> 赞同：10
> 
> 时间：2008-08-11T21:07:44.687
> 
> 标签：java, testing, enterprise

在我的工作中，我们正在运行一组测试，其中包含大约 3,000 个单独的测试用例。以前我们在一台机器上运行整个测试套件，大约需要 24-72 小时才能完成整个测试运行。我们现在已经创建了自己的系统，用于在大约三台不同的机器上对测试进行分组和分配，并且测试优先级，以便首先运行核心测试以获得更直接的结果，并在有可用机器时运行额外的测试。

我很好奇是否有人找到了一种在多台机器上分配测试以减少完整运行的总测试时间的好方法，以及使用了哪些工具来实现这一点。我做了一些研究，看起来 TestNG 正在[朝着这个方向发展](http://beust.com/weblog/archives/000362.html)，但看起来它仍然处于相当多的发展阶段。

我们不打算重写任何测试，但是当我们添加新测试和测试新产品或附加组件时，我希望能够处理我们正在处理大量测试的事实。另一方面，如果我们能找到一个工具来帮助分发我们的 Junit`3.x`测试，即使是以非常基本的方式，那*也会*很有帮助，因为我们不必维护自己的工具来做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-11T21:13:06.813

我见过一些人玩[分布式 JUnit](http://216.93.179.140:8080/wiki/display/GG15UG/Distributed+JUnit+Overview)。我不能特别保证它的有效性，但我见过的其他团队似乎认为它足够直截了当。希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-11T22:09:16.827

我们的构建人员使用 Mozilla Tinderbox。它似乎有一些用于分布式测试的钩子。很抱歉不知道细节，但我想我至少会将指针传递给你。

这也很好，因为您可以在构建中断时立即发现，以及哪些签入可能是罪魁祸首。

[http://www.mozilla.org/tinderbox.html](http://www.mozilla.org/tinderbox.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T02:13:56.410

还有[parallel-junit](https://parallel-junit.java.net/)。根据您当前执行测试的方式，其便利性可能会有所不同 - 这个想法只是在具有多个内核的单个系统上进行多线程。我已经简单地使用过它，但它与我们当前运行测试的方式不同。

[我使用的持续集成引擎Hudson](https://java.net/projects/hudson/)也有一些分布测试运行的方法（将单独的作业聚合结果合二为一）。

# c# - .NET/SQL Server 中的连接池？

> ID：8223
> 
> 赞同：11
> 
> 时间：2008-08-11T21:10:32.903
> 
> 标签：c#, .net, sql-server, connection-pooling

在使用 SQL Server 数据库在 .NET 中开发应用程序时，编写自定义连接池代码是否必要或有利？我知道 ADO.NET 为您提供了启用/禁用连接池的选项——这是否意味着它已内置到框架中并且我不需要担心它？为什么人们谈论编写自己的连接池软件，这与 ADO.NET 中内置的软件有何不同？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-11T21:14:40.303

ADO.Net 内置的连接池功能强大且成熟。我建议不要尝试编写自己的版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T21:16:24.577

我不是这方面*的真正*专家，但我知道 ADO.NET 有自己的连接池系统，只要我一直在使用它，它就完美无缺。

我的反应是，重新发明轮子没有意义……只要确保在完成连接后关闭它们，一切都会好起来的！

我希望其他人能给你一些更坚定的答案！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-11T21:14:11.477

我的理解是，在使用 SqlConnection 对象时会自动为您处理连接池。这是专门为与 MSSQL 一起工作而设计的，并将确保有效地汇集连接。您只需要确保在使用完它们后关闭它们（并确保它们被处理掉）。

我从来没有听说过人们需要自己滚动。但我承认我的经验是有限的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T07:52:33.153

随着 ADO.Net 的出现，较新版本的 SQL 连接池在两层上进行处理，首先通过 ADO.Net 本身，其次通过 SQL Server 2005/2008 直接处理，从而消除了对自定义连接池的需要。

我被告知，出于兴趣，正在计划或已经在 Oracle 和 MySQL 中实施类似的支持。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-08-11T21:14:23.287

好吧，它将会消失，因为所有这些问题的答案都将是 LINQ。顺便说一句，我们的任何应用程序都不需要自定义连接池，所以我不确定所有这些噪音是关于什么的。

# email - 为什么 Entourage 不能与 Exchange 2007 一起使用？

> ID：8228
> 
> 赞同：4
> 
> 时间：2008-08-11T21:13:59.340
> 
> 标签：email, dll, exchange-server, entourage

所以这不仅仅是编程，但谷歌一无所获，而你们正是合适的天才。

**我的 Exchange Server 2007 和 Entourage 客户端运行不佳。**

现在最大的问题是随行客户端无法连接到 Exchange 2007（Entourage 2004 或 2008）

帐户设置正确并使用正确的格式`https://exchange2007.mydomain.com/exchange/user@domain.com`

问题在于一个名为**davex.dll**的 dll在它所属的位置时，OWA 应用程序池崩溃了一大堆令人讨厌的事情发生。

当它不存在时，我可以连接到一切正常 - OWA 应用程序池不会崩溃 - 但 Entourage 从不传播邮箱中的文件夹并且不发送或接收。

任何帮助或想法将不胜感激：Microsoft 支持对这个问题保持沉默，而 Google 也没有出现太多。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T14:40:45.060

在不使用服务器属性字段中的 /exchange 的情况下尝试一下。这是相关[信息](http://www.robichaux.net/blog/2006/09/using_entourage_with_exchange_2007.php)的链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T22:14:01.683

davex.dll 是 Entourage 使用的 Exchange 服务器的旧版 webdav 组件。您的第一步应该是调查应用程序池崩溃的原因。我的猜测是，当 dll 不存在时，Entourage 无法做任何事情，因为 webdav 没有响应任何请求。

# c - 你如何确定C中文件的大小？

> ID：8236
> 
> 赞同：154
> 
> 时间：2008-08-11T21:16:30.147
> 
> 标签：c, file, io, filesize

如何计算文件的大小（以字节为单位）？

```
#include <stdio.h>

unsigned int fsize(char* file){
  //what goes here?
} 
```

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-08-12T00:55:48.313

在类 Unix 系统上，您可以使用 POSIX 系统调用：[`stat`在路径](https://en.wikipedia.org/wiki/Stat_(system_call))上，或`fstat`在已经打开的文件描述符（POSIX[手册页](https://man7.org/linux/man-pages/man3/fstat.3p.html)，Linux[手册页](https://man7.org/linux/man-pages/man2/lstat.2.html)）上。（从或在 stdio 流上
获取文件描述符）。`open(2)``fileno(FILE*)`

基于 NilObject 的代码：

```
#include <sys/stat.h>
#include <sys/types.h>

off_t fsize(const char *filename) {
    struct stat st; 

    if (stat(filename, &st) == 0)
        return st.st_size;

    return -1; 
} 
```

变化：

*   将文件名参数设为`const char`.
*   更正了`struct stat`缺少变量名称的定义。
*   返回`-1`错误而不是`0`，这对于空文件来说是模棱两可的。`off_t`是有符号类型，所以这是可能的。

如果要`fsize()`打印错误消息，可以使用以下命令：

```
#include <sys/stat.h>
#include <sys/types.h>
#include <string.h>
#include <stdio.h>
#include <errno.h>

off_t fsize(const char *filename) {
    struct stat st;

    if (stat(filename, &st) == 0)
        return st.st_size;

    fprintf(stderr, "Cannot determine size of %s: %s\n",
            filename, strerror(errno));

    return -1;
} 
```

在 32 位系统上，您应该使用选项编译它`-D_FILE_OFFSET_BITS=64`，否则`off_t`最多只能保存 2 GB 的值。[有关详细信息，请参阅Linux](http://www.suse.de/%7Eaj/linux_lfs.html)中的大文件支持的“使用 LFS”部分。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-08-11T22:09:03.907

不要使用`int`. 如今，大小超过 2 GB 的文件很常见

不要使用`unsigned int`. 大小超过 4 GB 的文件很常见，因为一些不太常见的污垢

IIRC 标准库定义`off_t`为无符号 64 位整数，这是每个人都应该使用的。几年后，当我们开始有 16 个 EB 文件时，我们可以将其重新定义为 128 位。

如果你在 Windows 上，你应该使用[GetFileSizeEx](http://msdn.microsoft.com/en-us/library/aa364957(VS.85).aspx) - 它实际上使用一个有符号的 64 位整数，所以他们会开始遇到 8 个 exabyte 文件的问题。愚蠢的微软！:-)

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-08-11T21:26:15.493

马特的解决方案应该可以工作，除了它是 C++ 而不是 C，而且最初的告诉不应该是必要的。

```
unsigned long fsize(char* file)
{
    FILE * f = fopen(file, "r");
    fseek(f, 0, SEEK_END);
    unsigned long len = (unsigned long)ftell(f);
    fclose(f);
    return len;
} 
```

也为你修好了牙套。;)

更新：这并不是最好的解决方案。它在 Windows 上限制为 4GB 文件，并且可能比仅使用特定于平台的调用（如`GetFileSizeEx`or `stat64`.

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-08-11T21:28:05.737

**不要这样做（[为什么？](https://www.securecoding.cert.org/confluence/display/c/FIO19-C.+Do+not+use+fseek%28%29+and+ftell%28%29+to+compute+the+size+of+a+regular+file)）：

> 引用我在网上找到的 C99 标准文档：“将文件位置指示符设置为文件结尾，`fseek(file, 0, SEEK_END)`与这并不一定会以初始换档状态结束。**

将定义更改为 int 以便可以传输错误消息，然后使用`fseek()`and`ftell()`来确定文件大小。

```
int fsize(char* file) {
  int size;
  FILE* fh;

  fh = fopen(file, "rb"); //binary mode
  if(fh != NULL){
    if( fseek(fh, 0, SEEK_END) ){
      fclose(fh);
      return -1;
    }

    size = ftell(fh);
    fclose(fh);
    return size;
  }

  return -1; //error
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2019-01-09T16:48:40.423

# POSIX

**POSIX**标准有自己的方法来获取文件大小 。
包括`sys/stat.h`标题以使用该功能。

### 概要

*   使用 获取文件统计信息[`stat(3)`](https://linux.die.net/man/3/stat)。
*   获得`st_size`财产。

### 例子

**注意**：它将大小限制为`4GB`. 如果不是`Fat32`文件系统，则使用 64 位版本！

```
#include <stdio.h>
#include <sys/stat.h>

int main(int argc, char** argv)
{
    struct stat info;
    stat(argv[1], &info);

    // 'st' is an acronym of 'stat'
    printf("%s: size=%ld\n", argv[1], info.st_size);
} 
```

```
#include <stdio.h>
#include <sys/stat.h>

int main(int argc, char** argv)
{
    struct stat64 info;
    stat64(argv[1], &info);

    // 'st' is an acronym of 'stat'
    printf("%s: size=%ld\n", argv[1], info.st_size);
} 
```

# ANSI C（标准）

**ANSI C**不直接提供确定文件长度的方法 。
我们将不得不使用我们的头脑。现在，我们将使用 seek 方法！

### 概要

*   使用[`fseek(3)`](https://linux.die.net/man/3/fseek).
*   使用 获取当前位置[`ftell(3)`](https://linux.die.net/man/3/ftell)。

### 例子

```
#include <stdio.h>

int main(int argc, char** argv)
{
    FILE* fp = fopen(argv[1]);
    int f_size;

    fseek(fp, 0, SEEK_END);
    f_size = ftell(fp);
    rewind(fp); // to back to start again

    printf("%s: size=%ld", (unsigned long)f_size);
} 
```

> 如果文件是`stdin`或管道。**POSIX，ANSI C**不起作用。
> 如果`0`文件是管道或`stdin`.
> 
> **意见**：您应该改用**POSIX**标准。因为，它支持 64 位。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-11T21:21:42.850

如果您可以使用 std c 库：

```
#include <sys/stat.h>
off_t fsize(char *file) {
    struct stat filestat;
    if (stat(file, &filestat) == 0) {
        return filestat.st_size;
    }
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-12T00:15:35.853

如果您正在构建 Windows 应用程序，请使用[GetFileSizeEx](http://msdn.microsoft.com/en-us/library/aa364957.aspx) API，因为 CRT 文件 I/O 很混乱，尤其是在确定文件长度时，由于不同系统上文件表示的特殊性；）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-11T21:30:08.353

我找到[了一种使用 fseek 和 ftell 的方法，](http://computerprogramming.suite101.com/article.cfm/writing_a_file_size_function)以及一个带有这个问题的线程，其中的答案不能仅在 C 中以另一种方式完成。

您可以使用像[NSPR](https://web.archive.org/web/20131023234554/https://developer.mozilla.org/en-US/docs/NSPR)（支持 Firefox 的库）这样的可移植库。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-02-08T01:54:26.347

我使用这组代码来查找文件长度。

```
//opens a file with a file descriptor
FILE * i_file;
i_file = fopen(source, "r");

//gets a long from the file descriptor for fstat
long f_d = fileno(i_file);
struct stat buffer;
fstat(f_d, &buffer);

//stores file size
long file_length = buffer.st_size;
fclose(i_file); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-09T17:02:18.263

**从 Windows 文件详细信息中提取的C++ MFC**，不确定这是否比搜索性能更好，但如果它是从元数据中提取的，我认为它更快，因为它不需要读取整个文件

```
ULONGLONG GetFileSizeAtt(const wchar_t *wFile)
{
    WIN32_FILE_ATTRIBUTE_DATA fileInfo;
    ULONGLONG FileSize = 0ULL;
    //https://docs.microsoft.com/nl-nl/windows/win32/api/fileapi/nf-fileapi-getfileattributesexa?redirectedfrom=MSDN
    //https://docs.microsoft.com/nl-nl/windows/win32/api/fileapi/ns-fileapi-win32_file_attribute_data?redirectedfrom=MSDN
    if (GetFileAttributesEx(wFile, GetFileExInfoStandard, &fileInfo))
    {
        ULARGE_INTEGER ul;
        ul.HighPart = fileInfo.nFileSizeHigh;
        ul.LowPart = fileInfo.nFileSizeLow;
        FileSize = ul.QuadPart;
    }
    return FileSize;
} 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-12-29T21:45:44.540

试试这个 -

```
fseek(fp, 0, SEEK_END);
unsigned long int file_size = ftell(fp);
rewind(fp); 
```

这首先是寻找文件的末尾；然后，报告文件指针的位置。最后（这是可选的）它倒回到文件的开头。注意`fp`应该是二进制流。

file_size 包含文件包含的字节数。请注意，由于（根据 climits.h）unsigned long 类型被限制为 4294967295 字节（4 GB），如果您可能要处理比这更大的文件，则需要找到不同的变量类型。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-07-11T22:22:44.803

我有一个仅适用于`stdio.h`. 我非常喜欢它，它工作得很好而且非常简洁：

```
size_t fsize(FILE *File) {
    size_t FSZ;
    fseek(File, 0, 2);
    FSZ = ftell(File);
    rewind(File);
    return FSZ;
} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2016-06-06T15:27:52.440

这是一个返回文件大小的简单而干净的函数。

```
long get_file_size(char *path)
{
    FILE *fp;
    long size = -1;
    /* Open file for reading */
    fp = fopen(path, "r");
    fseek(fp, 0, SEEK_END);
    size = ftell(fp); 
    fclose(fp);
    return 
} 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-08-11T21:23:59.787

您可以打开文件，使用相对于文件底部的 0 偏移量

```
#define SEEKBOTTOM   2

fseek(handle, 0, SEEKBOTTOM) 
```

fseek 返回的值是文件的大小。

我很长时间没有用 C 编写代码，但我认为它应该可以工作。

# c++ - 我无法让我的调试器停止对第一次机会异常的破坏

> ID：8263
> 
> 赞同：4
> 
> 时间：2008-08-11T21:51:06.813
> 
> 标签：c++, visual-studio, debugging, visual-studio-2003, first-chance-exception

我正在使用 Visual C++ 2003 通过 TCP/IP 远程调试程序。

我设置了 Win32 异常 c00000005，“访问冲突”，以便在抛出时闯入调试器。然后，我将其设置回“使用父设置”。父项 Win32 Exceptions 的设置是在引发异常时继续。

现在，当我调试程序时，每次抛出异常时它都会中断，迫使我单击继续让它继续调试。我怎样才能让它停止像这样打破？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T22:36:58.470

如果您不在调试器中运行，这是您的代码实际处理的异常吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-11T23:48:33.927

我想支持[Will Dean 的回答](https://stackoverflow.com/questions/8263/i-cant-get-my-debugger-to-stop-breaking-on-first-chance-exceptions#8304)

访问冲突听起来像是代码中的实际错误。这不是我期望底层 C/++ 运行时在内部抛出和捕获的东西。

'first-chance-exceptions' 功能是让您可以使用调试器拦截在代码中“捕获”的内容，然后查看。如果没有“捕获”该异常（这是有道理的，您到底为什么要捕获并忽略访问冲突？），那么无论您设置了什么选项，它都会触发调试器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T21:53:57.713

`Ctrl`+ `Alt`+ `E`（或调试\异常）

从那里您可以选择哪些异常中断。

# php - Class::DBI-like library for php?

> ID：8276
> 
> 赞同：12
> 
> 时间：2008-08-11T22:12:04.527
> 
> 标签：php, perl, orm

我继承了一个旧的硬壳`PHP application`，我想将它重构为更好处理的东西，但要循序渐进。在 perl 的 CPAN 中，围绕 Class::DBI 有一系列类，它们允许您使用数据库行作为代码中对象的基础，并根据需要生成库`accessor methods`等，还允许您添加其他方法。

有谁知道这样的PHP？尤其是不需要大规模采用“框架”的东西……如果它也可以在 PHP4 中工作，那么可以加分，但老实说，我很想有另一个理由放弃它。:-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T22:40:02.893

它现在已经不存在了，但[phpdbi](http://phpdbi.sourceforge.net/web/)可能值得一看。如果您愿意放弃一些警告（框架警告），我发现[Doctrine](http://www.phpdoctrine.org/)是一种在 PHP 中访问数据库的非常简洁的方法。无论如何都值得研究。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-28T17:56:45.567

Class::DBI 是 perl 的[ORM（对象关系映射器）](http://en.wikipedia.org/wiki/Object-relational_mapping)。在 google 上搜索“PHP ORM”会得到一些不错的结果，包括[Doctrin](http://www.doctrine-project.org/)，我很幸运。我会从那里开始，然后一路向上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T18:50:55.633

我正在尝试获得更多关于我自己的项目的反馈，所以我会建议我对 ORM 的看法： [ORMer](http://greaterscope.net/projects/ORMer)

用法示例在[这里](http://greaterscope.net/projects/ORMer/examples)

你可以分阶段使用它，它不需要你采用 MVC，而且它只需要很少的设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T23:34:10.243

正确的做法是通过抽象层访问数据库，如果您更改 RDBMS 或实现该访问的方式，您只需修改该层，而应用程序的所有其余部分保持不变。

为此，为了让您的应用程序无需知道如何处理数据库，您的 DB 访问抽象层必须由[ADODB](http://adodb.sourceforge.net/)等框架实现。

所有与该层相关的文件必须位于一个子目录中：

*   /ado

在此目录中，您将放置所有 .php.inc 文件，其中包含访问数据库的一般方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T21:47:16.150

梨的[MDB2](http://pear.php.net/package/MDB2)怎么样？

> 它为所有受支持的 RDBMS 提供通用 API。与大多数其他 DB 抽象包的主要区别在于 MDB2 进一步确保了可移植性。

顺便说一句：@GaryF 你的链接有什么奇怪的标题属性？您是添加它们还是它们是由 SO 添加的？

# icons - 生成图标文件

> ID：8284
> 
> 赞同：12
> 
> 时间：2008-08-11T22:20:04.697
> 
> 标签：icons, favicon

我正在寻找用于生成 .ICO 文件的在线解决方案。我希望 ICO 文件也能够具有透明度。

您使用什么软件或网站来创建它们？

[更新]

为了澄清，我有一个 PNG 格式的现有图像，32 x 32 像素。我想从这个现有文件中生成图标，而不是在线创建一个全新的图标。对困惑感到抱歉。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-11T22:33:41.613

我发现应用程序[IcoFx](http://icofx.ro/)很有用，您可以导入几乎任何用于创建图标的图像类型，包括 PNG。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T22:35:03.293

不久前我偶然发现了 Icon Sushi 并喜欢它。它已经有大约一年没有更新了，但它仍然可以很好地工作，即使在 Vista 中也是如此。另外它是免费的。

[http://www.towofu.net/soft/e-aicon.php](http://www.towofu.net/soft/e-aicon.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T08:41:09.740

您可以使用[IrfanView](http://www.irfanview.com/)，它是免费软件，允许您转换为 ICO。它甚至允许您选择透明颜色。

我在我的项目中经常使用它，因为 WinForm 需要一个 ICO 文件作为它的图标，而我通常有 PNG 或 BMP 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-11T22:31:21.523

我喜欢[微天使](http://www.microangelo.us/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T22:35:05.913

我还使用 Gif Movie Gear 创建`.ico`文件。

这个在线网站[图标生成器](http://tools.dynamicdrive.com/favicon/)工具似乎也可以正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T22:40:16.730

我最喜欢的方法是“另存为 .ICO”的 Photoshop 插件。

[http://www.telegraphics.com.au/svn/icoformat/trunk/dist/README.html](http://www.telegraphics.com.au/svn/icoformat/trunk/dist/README.html)

快速，离线工作，您已经在 Photoshop 中，等等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T00:36:53.470

[png2ico](http://winterdrache.de/freeware/png2ico/)是我一直使用的，非常适合您的情况。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-03T02:36:12.487

试试看，它支持 vista 风格的图标

适用于 VS 2008 的 Axialis IconWorkshop Lite

[http://www.axis.com/download/iwlite.html](http://www.axialis.com/download/iwlite.html)

Axialis Software 与 Microsoft Corporation 合作推出适用于 Visual Studio 2008 的 Axialis IconWorkshop Lite：

```
* 100% Free for Visual Studio 2008 users;
* Make icons for Windows up to 256×256 PNG-compressed icons for Windows Vista™ and include them in your software projects;
* Use an advanced icon editor with various tools, filters and effects;
* Work efficiently using a Plug-in for Visual Studio 2008;
* Create icons from images or ready-to-use image objects;
* Use a fully integrated workspace with librarian, built-in file explorer with thumbnail preview, image viewer and more… 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-11T22:25:28.493

我无法想象在线绘制图标。现在图标通常*被绘制*为矢量，我不知道有任何在线矢量包。

如果您决定离线绘制，我会使用 Xara (www.xara.com) 绘制我所有的计算机作品，并使用 Gif Movie Gear 创建 .ico 文件。前者是一个极好的矢量包，后者只是我躺着的东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-11T22:26:09.693

我使用了一个名为 MyViewPad 的简单程序，它可以（几乎）将任何旧图像转换为 .ico 文件。它是免费且易于使用的。不过，这可能不是您想要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-11T22:27:38.690

奥托，如果你能澄清你需要这个做什么，我们更有可能有好的建议。提供一个用例，有人可能会有一些建议来适应它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-11T22:33:25.497

这是需要经常自动完成的事情，还是只是你的应用程序的一次性事情？如果后者是正确的，MyViewPad 将工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-20T08:24:15.803

我使用[InkScape](http://www.inkscape.org/)是一个免费的矢量图形程序。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-20T09:15:15.043

我将[GIMP](http://www.thegimp.org/)用于我的图标设计，但是在导出之前必须将所有图层连接在一起然后为每个图标大小创建不同的图层是相当痛苦的。嗯，也许我可以让我的下一个项目为 GIMP 编写一个插件。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-10T19:19:19.220

不久前我偶然发现了 Greenfish Icon Editor Pro，它对于我需要制作的简单图标非常有用。

[绿鱼图标编辑器专业版](http://greenfish.extra.hu)

唯一的缺点是它只有窗户。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-11-29T23:01:40.843

使用[http://www.favicon.cc/](http://www.favicon.cc/)，您可以自己绘制，也可以上传 jpg、jpeg、gif、png、bmp 或 ico。它是一个网络应用程序，因此无需安装任何东西。效果很好。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-09-19T14:24:00.897

在使用 VS 为我的应用程序创建图标时，我只是使用 Paint (32x32) 来绘制它并保存为 PNG，然后我去[http://www.online-image-editor.com/](http://www.online-image-editor.com/)，上传我的 PNG，点击向导选项卡，单击透明按钮，然后单击图像中我想要透明的点（通常只是白色部分。）然后保存图像，转到另一个网站[http://prodraw.net/ online-tool/pic-to-icon.php](http://prodraw.net/online-tool/pic-to-icon.php)，从上一个站点上传保存的图像，设置我的偏好选项，转换和下载。中提琴，一个透明的图标！除了原始图像的实际绘制之外，它实际上只需要几分钟。

# svn - 为 Subversion 存储库创建冗余？

> ID：8306
> 
> 赞同：4
> 
> 时间：2008-08-11T22:37:47.983
> 
> 标签：svn, repository, redundancy

创建冗余颠覆存储库的最佳方法是什么？

我有一个 subversion 存储库（通过 apache2 和 WebDAV 链接），并且想在发生中断时在不同的服务器上创建一个镜像存储库，但我不确定继续进行的最佳方法。

我认为可以使用提交后脚本来传播更改，但我不确定这是否是最好的方法，任何人都有任何意见

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T22:49:02.610

听起来您正在寻找的基本上是联合（同步）服务器......我最近问了同样的问题......虽然我没有找到确切的解决方案，但我正在寻找它接近。 [看这里：](https://stackoverflow.com/questions/1790/federated-synced-subversion-servers)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T22:49:00.647

你真的需要每次提交的备份吗？几乎可以肯定，有比走这条路更好的方法来防止失败。例如，鉴于大多数故障是磁盘故障，迁移到 RAID 阵列和/或 NAS/SAN 存储将为您提供更好的一般保护，如果配置正确，则可以提供更好的性能。那时，异地备份就变成了使用可用工具的问题。有关详细信息，请参阅 svn 手册的[存储库维护部分](http://svnbook.red-bean.com/en/1.1/ch05s03.html)。

如果您确实需要每次提交的备份，那么，是的，提交后脚本是要走的路。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T23:25:12.600

如果您只需要对镜像存储库的只读访问权限，则可以使用SVN 1.4 中添加的[svnsync](https://svn.apache.org/repos/asf/subversion/trunk/notes/svnsync.txt)进行镜像。

我们在构建服务器上使用辅助存储库来运行 CruiseControl.NET，但镜像存储库是只读的。

# java - 解决 JBoss 中的会话固定问题

> ID：8318
> 
> 赞同：11
> 
> 时间：2008-08-11T22:53:50.883
> 
> 标签：java, security, jboss

我需要在 JBoss 中运行的 Java Web 应用程序中防止[Session Fixation](http://www.owasp.org/index.php/Session_Fixation)，一种特定类型的会话劫持。但是，标准习语[似乎在 JBoss 中不起作用](http://www.owasp.org/index.php/Session_Fixation_in_Java)。这可以解决吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-11T23:00:58.467

[这个缺陷](https://jira.jboss.org/jira/browse/JBAS-4436)（在[此处](http://forum.springframework.org/showthread.php?t=54688)找到）为解决方案指明了方向。在 JBoss 中运行的 Tomcat 实例配置为 emptySessionPath="true"，而不是默认的 "false"。这可以在`.../deploy/jboss-web.deployer/server.xml`; HTTP 和 AJP 连接器都有此选项。

该功能本身用于消除包含在 JSESSIONID cookie 中的上下文路径（例如[http://example.com/foo中的“foo”）。](http://example.com/foo)将其设置为 false 将破坏依赖跨应用程序身份验证的应用程序，其中包括使用某些门户框架构建的内容。但是，它并没有对相关应用程序产生负面影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-27T07:44:40.447

这个问题和它发生的具体情况是Tomcat和JBoss中的一个问题。Tomcat 共享 emptySessionPath="true" 效果（实际上 JBoss 从 Tomcat 继承它）。

当您试图防止会话固定攻击时，这看起来确实像 Tomcat 和 JBoss 中的一个错误，但 servlet 规范（至少 2.3 版）实际上并不要求根据任何特定逻辑定义或重新定义 JSESSIONID。也许这已在以后的版本中被清除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-23T11:27:55.167

一种解决方法是将客户端地址存储在会话中。响应包装器应验证会话中设置的客户端地址与访问会话的客户端地址相同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-21T09:36:53.937

我从一个论坛中了解到下面的代码设置片段。我在下面添加了几行。但是当我在登录应用程序之后和之前打印会话 ID 时，它是相同的。我将如何测试会话固定。

1.  D:\jboss-5.1.0.GA\bin\run.cof 文件并添加以下行。设置“JAVA_OPTS=%JAVA_OPTS%-Dorg.apache.catalina.connector.Request.SESSION_ID_CHECK=false”

2.  in each context.xml of the jboss applications. D:\jboss-5.1.0.GA\server\default\deploy\jbossweb.sar\context.xml

# c# - 使用未处理的异常而不是 Contains()？

> ID：8348
> 
> 赞同：8
> 
> 时间：2008-08-11T23:49:32.503
> 
> 标签：c#, .net, error-handling

想象一下，您正在使用的一个对象具有与其关联的其他对象的集合，例如 WinForm 上的 Controls 集合。您想检查集合中的某个对象，但该集合没有`Contains()`方法。有几种方法可以解决这个问题。

*   `Contains()`通过遍历集合中的所有项目来实现您自己的方法，以查看其中一项是否是您正在寻找的。这似乎是“最佳实践”方法。
*   我最近遇到了一些代码，其中尝试访问 try 语句中的对象，而不是循环，如下所示：

> ```
> try  
> {  
>     Object aObject = myCollection[myObject];  
> }  
> catch(Exception e)  
> {  
>     //if this is thrown, then the object doesn't exist in the collection
> } 
> ```

我的问题是您认为第二种选择的编程实践有多差，为什么？与通过集合的循环相比，它的性能如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-12T00:30:43.390

一般的经验法则是避免对控制流使用异常，除非触发异常的情况是“异常的”——例如，极其罕见！

如果这是正常且定期发生的事情，则绝对不应将其作为例外处理。

由于所涉及的所有开销，异常非常非常慢，因此如果它经常发生，也可能存在性能原因。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-12T00:26:37.577

我不得不说这是非常糟糕的做法。虽然有些人可能会很高兴地说循环遍历集合在引发异常方面效率较低，但引发异常是有开销的。当您更适合使用字典或哈希表时，我还会质疑为什么您要使用集合来按键访问项目。

然而，我对这段代码的主要问题是，无论抛出什么类型的异常，你总是会得到相同的结果。

例如，由于集合中不存在该对象，或者因为集合本身为空，或者因为您无法将 myCollect[myObject] 强制转换为 aObject，因此可能会引发异常。

所有这些异常都将以相同的方式处理，这可能不是您的意图。

这些是关于何时何地抛出异常通常被认为可以接受的几篇不错的文章：

*   [编程基础](http://codebetter.com/blogs/karlseguin/archive/2008/05/29/foundations-of-programming-pt-8-back-to-basics-exceptions.aspx)
*   [在 C# 中抛出异常](http://www.blackwasp.co.uk/CSharpThrowingExceptions.aspx)

我特别喜欢第二篇文章中的这句话：

> 仅当发生阻止方法完成其正常功能的意外或无效活动时才引发异常，这一点很重要。异常处理会引入少量开销并降低性能，因此不应将其用于正常程序流而不是条件处理。维护以这种方式滥用异常处理的代码也可能很困难。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T00:01:59.110

如果在编写代码时，您希望这个对象在集合中，然后在运行时发现它不是，我会称之为例外情况，使用例外是正确的。

但是，如果您只是测试一个对象是否存在，而您发现它不存在，这并不例外。在这种情况下使用异常是不合适的。

运行时性能的分析取决于实际使用的集合，以及搜索它的方法。不过那应该没关系。不要让优化的错觉欺骗您编写令人困惑的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T00:07:06.027

我将不得不更多地考虑我有多喜欢它......我的直觉是，呃，不是那么多......

编辑：瑞恩福克斯对例外情况的评论是完美的，我同意

至于性能，它取决于集合上的索引器。C# 允许您覆盖索引器运算符，因此如果它正在执行类似于您将编写的 contains 方法的 for 循环，那么它将同样慢（由于 try/catch 可能会慢几纳秒......但没有什么可做的）除非该代码本身在一个巨大的循环中，否则请担心）。

如果索引器是 O(1)（甚至是 O(log(n))... 或任何比 O(n) 更快的东西），那么 try/catch 解决方案当然会更快。

另外，我假设索引器抛出异常，如果它返回 null，你当然可以只检查 null 而不使用 try/catch。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T00:10:19.297

一般来说，对程序流和逻辑使用异常处理是不好的做法。我个人觉得后一种选择是不可接受的使用异常。鉴于当今常用语言的特性（例如 C# 中的 Linq 和 lambdas），没有理由不编写自己的 Contains() 方法。

作为最后的想法，现在大多数集合*确实*已经有一个 contains 方法。所以我认为在很大程度上这不是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T02:02:49.723

例外应该是例外。

诸如“由于数据库已从其下方掉出而导致集合丢失”之类的内容非常特殊

像“密钥不存在”这样的东西是字典的正常行为。

对于您的 winforms Control 集合的特定示例，该`Controls`属性有一个`ContainsKey`方法，这是您应该使用的。

没有`ContainsValue`，因为在处理字典/哈希表时，没有快速的方法可以遍历整个集合，检查是否存在某些东西，所以你真的不鼓励这样做。

至于为什么异常应该是异常的，大约有两件事

1.  指示您的代码正在尝试执行的操作。你想让你的代码尽可能地匹配它试图实现的目标，因此它是可读和可维护的。异常处理增加了一堆额外的麻烦，阻碍了这个目的

2.  代码简洁。你希望你的代码以最直接的方式做它正在做的事情，所以它是可读和可维护的。再次，异常处理添加的杂乱无章阻碍了这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-17T14:38:19.963

看看 Krzystof 的这篇博文：http: [//blogs.msdn.com/kcwalina/archive/2008/07/17/ExceptionalError.aspx](http://blogs.msdn.com/kcwalina/archive/2008/07/17/ExceptionalError.aspx)

异常应该用于传达错误条件，但它们不应该用作控制逻辑（尤其是当有更简单的方法来确定条件时，例如包含）。

问题的一部分是异常，虽然*抛出*成本不高，但*捕获*成本很高，并且所有异常都会在某个时候被捕获。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-08-12T00:03:04.957

后者是可接受的解决方案。尽管在这种情况下我肯定会发现集合抛出的特定异常（ElementNotFound？）。

Speedwise，这取决于常见情况。如果您更有可能找到该元素，则异常解决方案会更快。如果您更有可能失败，那么它将取决于集合的大小及其迭代速度。无论哪种方式，在担心这样的速度之前，您都需要根据正常使用来衡量这是否真的是一个瓶颈。首先要清楚，后者的解决方案比前者要清晰得多。

# javascript - 有没有类似“Firebug for IE”（用于调试 JavaScript）的东西？

> ID：8351
> 
> 赞同：44
> 
> 时间：2008-08-12T00:02:42.417
> 
> 标签：javascript, debugging, internet-explorer, firebug, javascript-debugger

我正在尝试修复一些 JavaScript 错误。在 Firefox 中工作时，Firebug 使调试这些问题变得更加容易，但是当代码在 Firefox 上运行良好但 IE 报错时，您会怎么做？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-08-12T00:11:03.303

您还可以查看[IE Developer Toolbar](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=95e06cbe-4940-4218-b75d-b8856fced535)，它不是调试器，但可以帮助您分析代码的内容。

[Visual Studio](http://weblogs.asp.net/scottgu/archive/2007/07/19/vs-2008-javascript-debugging.aspx)将帮助调试

[Fiddler](http://www.fiddlertool.com/fiddler/)应该帮助分析进出浏览器的流量

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-08-12T00:07:37.070

您可以尝试[Firebug Lite](http://getfirebug.com/lite.html)或使用 Visual Studio 来调试 JavaScript。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-05-15T21:42:59.067

自 Internet Explorer 8 以来，IE 一直带有一个内置工具集，用于调试、故障排除并通常帮助开发您的页面/应用程序。您可以在浏览器中按 F12 访问这些工具。

### HTML 选项卡

HTML 选项卡可让您在浏览器理解的情况下查看 DOM。当您从 HTML 视图中选择元素时，它们的样式将在右侧详细说明，并且可以打开和关闭各个规则。您还可以修改规则，并确定元素上的样式是继承的，还是显式分配的。此外，您甚至可以分辨出它们来自哪个 .css 文件。

![在此处输入图像描述](https://i.stack.imgur.com/j96Yt.png)

您可以在 HTML 选项卡中执行更多操作，例如查看和修改元素的属性，甚至可以从布局部分更改元素的布局。此外，您可以直接对标记进行更改，以快速测试一些结构性想法。

### 脚本选项卡

要解决 JavaScript 问题，您可以观看控制台和脚本标签。如果您的脚本偶然发现对未定义方法的调用，您将在控制台中收到警报。如果您想打开或关闭项目，或者尝试将处理程序绑定到按钮，控制台还允许您对页面运行任意 JavaScript。

Script 选项卡很棒，它会为您设置 JavaScript 格式，允许您插入断点、单步执行和越过代码块，以及随着时间的推移观察变量。

![在此处输入图像描述](https://i.stack.imgur.com/PJrk0.png)

如果您使用过 Firebug，甚至是 Webkit Inspector，那么您应该对 Internet Explorer 8+ 中的 F12 开发人员工具非常熟悉。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-12T01:47:40.923

Firebug lite 对我来说不太好用。开发者工具栏还不够好。真的没有很好的解决方案。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-12T00:09:26.583

或者[IE 开发者工具栏](http://www.microsoft.com/download/en/details.aspx?id=18359)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-12T00:21:52.300

看看[DebugBar](http://www.debugbar.com/)。许可证免费供个人使用

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-09-09T02:09:14.230

对于 DOM Inspector，试试[Internet Explorer Developer Toolbar](http://www.microsoft.com/downloads/details.aspx?familyid=E59C3964-672D-4511-BB3E-2D5E1DB91038&displaylang=en)。

对于 Net 选项卡，请尝试[Fiddler](http://fiddler2.com)。

对于 Javascript 调试，请尝试[Visual Web Developer 2008 Express Edition](http://www.microsoft.com/express/vwd/)。（或更高版本的 Visual Studio）

另外，尝试[DebugBar](http://debugbar.com)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-14T12:37:17.253

Visual Studio 2008 可以进行 JavaScript 调试，您必须转到 IE 的工具->Internet 选项->高级并取消选中“禁用脚本调试（Internet Explorer）”，以便浏览器冒泡它检测到的错误。

进入 Visual Studio 后，您基本上可以使用它的整个调试工具。它不像 Firebug 那样集成，但它比我们以前拥有的任何东西都要好得多。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-30T20:58:56.653

我认为最好先在firefox中安装ie核心插件，然后用ie插件加载页面并按f12。祝你好运。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-10-08T16:32:45.217

在收藏夹中做一个书签，并将这个地址作为 URL：

```
javascript:(function(F,i,r,e,b,u,g,L,I,T,E){if(F.getElementById(b))return;E=F[i+'NS']&&F.documentElement.namespaceURI;E=E?F[i+'NS'](E,'script'):F[i]('script');E[r]('id',b);E[r]('src',I+g+T);E[r](b,u);(F[e]('head')[0]||F[e]('body')[0]).appendChild(E);E=new%20Image;E[r]('src',I+L);})(document,'createElement','setAttribute','getElementsByTagName','FirebugLite','4','firebug-lite.js','releases/lite/latest/skin/xp/sprite.png','https://getfirebug.com/','#startOpened'); 
```

然后导航到您想要的页面并单击链接。Firebug Lite 将/应该打开...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-12T00:43:37.980

IE8 beta 附带了我认为是 IE Developer 工具栏，但它似乎比我上次在 IE7 上尝试的工具栏强大得多

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-09-09T02:27:25.493

根据一些答案，我猜这个问题是在 IE8 决赛出来之前发布的。

这些天来，IE8 的内置开发者工具很棒。虽然 JS 调试不如 Visual Studio 有用，但在我看来，开发工具通常比 Firebug 好得多。在这和兼容性视图浏览器模式之间，我可以处理我所有的 IE6 开发需求。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-08-17T10:20:55.783

我找到了解决这个问题的方法，你可以简单地将这个标签粘贴到你要调试的页面上，它会打开 firebug：

```
<script type="text/javascript" src="https://getfirebug.com/firebug-lite.js"></script> 
```

来自[https://getfirebug.com/firebuglite#Stable的解释](https://getfirebug.com/firebuglite#Stable)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-02-20T20:36:15.363

如果你是一个认真的前端开发者，给 AJAX 版试一试吧：

[http://www.compuware.com/application-performance-management/ajax-performance-testing.html](http://www.compuware.com/application-performance-management/ajax-performance-testing.html)

它是一个免费工具，允许用户了解在现代 AJAX/Web 应用程序中导致性能和功能相关问题的原因。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-06-18T22:02:23.077

在 IE 中，转到 MenuBar->Tools 选择 Debugger Tools 按 F12 并享受。它远离 Fire Bug，但适合一些快速帮助

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-07-28T19:10:54.620

总有办法解决这个问题，观看视频，您将能够在 2 分钟内安装 firebug。

[在ie上安装firebug](http://www.youtube.com/watch?v=vLJ2RaNZ22E)

祝你好运

# apache - 使用 mod_rewrite 模拟 SSL 虚拟主机？

> ID：8355
> 
> 赞同：7
> 
> 时间：2008-08-12T00:06:36.073
> 
> 标签：apache, mod-rewrite, https

通过与 Apache 2.2 的 SSL 连接透明地重写 URL 的最佳方法是什么？

Apache 2 本身不支持 SSL 连接的多个基于名称的虚拟主机，我听说 mod_rewrite 可以帮助解决这个问题。我想做这样的事情：

我已经设置了服务器，以便可以通过以下方式访问站点

[https://secure.example.com/dbadmin](https://secure.example.com/dbadmin)

但我想将此作为[https://dbadmin.example.com](https://dbadmin.example.com)

如何设置它以便重写规则将 dbadmin.example.com 重写为 secure.example.com/dbadmin，但不会在客户端的地址栏上显示重写（即客户端仍然只会看到 dbadmin.example.com ），到处都是https？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-15T08:21:28.300

配置单个 VirtualHost 以同时为 secure.example.com 和 dbadmin.example.com 提供服务（使其成为唯一的 *:443 VirtualHost 实现此目的）。然后，您可以使用[mod_rewrite](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html)调整对 dbadmin.example.com 的请求的 URI：

```
<VirtualHost *:443>
    ServerName secure.example.com
    ServerAlias dbadmin.example.com

    RewriteEngine on
    RewriteCond %{SERVER_NAME} dbadmin.example.com
    RewriteRule !/dbadmin(.*)$ /dbadmin$1
</VirtualHost> 
```

您的 SSL 证书需要对 secure.example.com 和 dbadmin.example.com 都有效。它可以是 Terry Lorber 提到的通配符证书，或者您可以使用[subjectAltName](http://wiki.cacert.org/wiki/VhostTaskForce#A1.Way.3ASubjectAltNameOnly)字段添加其他主机名。

如果您遇到问题，请先设置它`<VirtualHost *>`并检查它是否可以在没有 SSL 的情况下工作。SSL 连接和证书是一个单独的复杂层，您可以在 URI 重写工作后设置它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T02:10:56.480

除非您的 SSL 证书是“通配符”或多站点类型，否则我认为这不会起作用。重写将显示在浏览器中，并且地址栏中的名称必须对证书有效，否则您的用户将看到一个安全错误（他们总是可以接受并继续，但这听起来不像您想要的）。

更多[在这里](http://httpd.apache.org/docs/2.0/ssl/ssl_faq.html#vhosts)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T01:12:14.740

有 apaches mod_rewrite，或者您可以设置 apache 将[https://dbadmin.example.com](https://dbadmin.example.com)指向服务器上的 path/to/example.com/dbadmin

```
<VirtualHost *>
ServerName subdomain.domain.com
DocumentRoot /home/httpd/htdocs/subdomain/
</VirtualHost> 
```

# mysql - MySQL 管理员备份：“兼容模式”，这到底是做什么的？

> ID：8365
> 
> 赞同：6
> 
> 时间：2008-08-12T00:21:58.790
> 
> 标签：mysql, backup

在Mysql Administrator中，做备份的时候，“兼容模式”到底是什么？

我正在尝试将[webmin生成的备份与](http://www.webmin.com/)[mysql administrator](http://www.mysql.com/products/tools/administrator/)中可用的上传工具连接起来。我的数据已经有一些不一致的地方（我认为，记号、逗号等）我只是不会尝试解决（无论如何它们可能会在未来再次出现）。当我尝试从备份中恢复时，这些扭结会产生错误。

现在，如果我从 webmin 生成备份，然后使用 MySQL 管理员恢复它们，它们就会失败。但是，如果我使用 MySQL 管理员生成备份并勾选“兼容模式”，然后转到 MySQL 管理员（另一个实例）并恢复......它可以工作！

根据 MySQL，“兼容模式”是；

> 兼容模式创建与旧版本 MySQL Administrator 兼容的备份文件。

另一方面，Webmin 为我提供了以下兼容性选项：

*   ANSI
*   MySQL 3.2.3
*   MySQL 4.0
*   PostgreSQL
*   甲骨文
*   微软 SQL
*   DB2
*   最大数据库

你说哪个最合适？我的数据集非常大，因此需要花费相当长的时间来逐个进行实验（特别是思考可能会击败暴力破解）。

编辑：好像它在做 ANSI，但我不是 100% 的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-23T00:46:30.907

兼容模式 - 帮助您创建与不同版本的 MYSQL 或其他数据库兼容的导出的模式。

你看，某些版本的 MySQL 有不同的命令用于不同的版本。所以兼容模式允许你做的是取一个数据库并导出 SQL 以与另一个版本的 MySQL 兼容。因此，您可能希望将 MySQL 3 服务器升级到 4 - 这种兼容模式允许导出您的数据库或单个表以创建可以导入 MySQL 4 版本服务器的 SQL 文件（也应该在 5 中工作）。

我也使用 webmin，并运行 MySQL 5。我对 MySQL 4 使用兼容模式......我避开任何其他的，因为我没有运行那些其他数据库。

至于 MySQL 3.x 和 4.x 之间不同的 MySQL 命令，我相信关于如何将 CURRENT_TIMESTAMP 从 MySQL 3 转换为 4，并且 MySQL 3 不支持字符集，据此论坛帖子在这里：[http ://www.phpbuilder.com/board/showthread.php?t=10330692](http://www.phpbuilder.com/board/showthread.php?t=10330692)

# apache - 如何将 HTTPS 重定向到 HTTP？

> ID：8371
> 
> 赞同：178
> 
> 时间：2008-08-12T00:36:32.223
> 
> 标签：apache, ssl, redirect, https

如何将 HTTPS 重定向到 HTTP？也就是说，与每个人（似乎）教的相反。

我有一个 HTTPS 上的服务器，我为此支付了 SSL 认证，还有一个镜像，我没有，只是为了紧急情况而保留，所以它不值得获得认证。

在我客户的桌面上，我有一些指向`http://production_server`和`https://production_server`（都有效）的快捷方式。但是，我知道如果我的生产服务器出现故障，那么 DNS 转发就会启动，并且那些在快捷方式上有“https”的客户端将盯着`https://mirror_server`（这不起作用）和一个巨大的 Internet Explorer 7 红屏不安为我的公司。

不幸的是，我不能只在客户端级别进行切换。这些用户是非常计算机文盲：并且很可能会因为看到 HTTPS“不安全”错误而吓坏了（尤其是现在 Firefox 3 和 Internet Explorer 7 处理它的方式：完全停止，谢天谢地，但在这里没有帮助我哈哈）。

很[容易](http://www.cyberciti.biz/tips/howto-apache-force-https-secure-connections.html) [找到](http://bytes.com/forum/thread54801.html) [http->https 重定向的](http://www.google.com/search?q=https+redirection&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)[Apache 解决方案](http://support.jodohost.com/showthread.php?t=6678)，但对于我来说，我不能做相反的事情。

想法？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2008-08-12T00:48:49.577

这尚未经过测试，但我认为这应该可以使用 mod_rewrite

```
RewriteEngine On
RewriteCond %{HTTPS} on
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-08-12T03:06:10.237

请记住，重写引擎仅在收到 HTTP 请求后才会启动 - 这意味着您仍然需要证书，以便客户端建立连接以发送请求！

但是，如果备用机器看起来具有相同的主机名（就客户端而言），那么您应该没有理由不能使用与主要生产机器相同的证书。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-01-24T08:32:49.343

根据 ejunker 的回答，这是适合我的解决方案，不是在单个服务器上，而是在**云**环境上

```
Options +FollowSymLinks
RewriteEngine On
RewriteCond %{ENV:HTTPS} on
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L] 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-12-01T18:50:39.153

对于那些使用`.conf`文件的人。

```
<VirtualHost *:443>
    ServerName domain.com
    RewriteEngine On
    RewriteCond %{HTTPS} on
    RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI}

    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/domain.crt
    SSLCertificateKeyFile /etc/apache2/ssl/domain.key
    SSLCACertificateFile /etc/apache2/ssl/domain.crt

</VirtualHost> 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2013-02-21T00:27:08.423

如果上述解决方案都不适合您（它们不适合我），那么这就是在我的服务器上起作用的方法：

```
RewriteCond %{HTTPS} =on
RewriteRule ^(.*)$ http://%{HTTP_HOST}/$1 [L,R=301] 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-03-08T18:02:31.783

当我使用 cloudflare 时，以上所有方法都不起作用，这个对我有用：

```
RewriteCond %{HTTP:X-Forwarded-Proto} =https
RewriteRule ^(.*)$ http://%{HTTP_HOST}%{REQUEST_URI} [L,R=301] 
```

这个绝对可以在没有代理的情况下工作：

```
RewriteCond %{HTTPS} on
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L] 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-08-22T08:28:21.250

最好尽量避免使用 mod_rewrite。

在你的情况下，我会用这个替换重写：

```
 <If "%{HTTPS} == 'on'" >
            Redirect permanent / http://production_server/
    </If> 
```

[根据此博客，](https://blogs.apache.org/httpd/entry/new_in_httpd_2_4)该`<If>`指令仅在 Apache 2.4+ 中可用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-01-03T23:55:12.137

这对我有用。

```
<VirtualHost *:443>
    ServerName www.example.com
    # ... SSL configuration goes here
    Redirect "https://www.example.com/" "http://www.example.com/"
</VirtualHost>

<VirtualHost *:80>
    ServerName www.example.com
    # ... 
</VirtualHost> 
```

确保同时监听 80 和 443 端口。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-11-12T19:27:47.127

在 Wordpress 网站上没有一个答案对我有用，但以下工作（它类似于其他答案，但有一点变化）

```
RewriteEngine On
RewriteCond %{HTTPS} on
RewriteRule (.*) http://%{HTTP_HOST}%{REQUEST_URI} [R=301,L] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-18T06:29:42.707

如果您正在寻找可以将特定 url/s 重定向到 http 的答案，请更新您的 htaccess，如下所示

```
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteCond %{THE_REQUEST} !/(home/panel/videos|user/profile) [NC] # Multiple urls
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteCond %{HTTPS} on
RewriteCond %{THE_REQUEST} /(home/panel/videos|user/profile) [NC] # Multiple urls
RewriteRule ^ http://%{HTTP_HOST}%{REQUEST_URI} [L,R=301] 
```

它对我有用:)

* * *

## 回答 #11

> 赞同：-7
> 
> 时间：2012-09-03T07:06:09.573

据我所知，简单的元刷新也可以正常工作而不会导致错误：

```
<meta http-equiv="refresh" content="0;URL='http://www.yourdomain.com/path'"> 
```

# javascript - 如何在 Visual Studio 2005 中调试 JavaScript？

> ID：8398
> 
> 赞同：17
> 
> 时间：2008-08-12T01:22:38.197
> 
> 标签：javascript, visual-studio, visual-studio-2005, debugging

我刚刚在 Stack Overflow 问题*[Best WYSIWYG CSS editor](http://web.archive.org/web/20090503103538/http://stackoverflow.com:80/questions/7975/best-css-editor)*中看到了这一点，但不知道可以做到这一点。我是 Visual Studio 新手，你是怎么做到的？

JavaScript 是否有单独的调试器？我知道如何为代码隐藏页面工作……我通常使用 Firebug 来处理调试 JavaScript 代码。

我正在使用[Visual Studio 2005](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-12T03:12:49.317

对于无法使用[Visual Studio 2008](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008)的项目，我更喜欢使用[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-16T13:43:09.450

要在 Visual Studio 2005 中进行调试，请确保未选中“禁用脚本调试”。然后在 Internet Explorer 中加载您的网页。从 Visual Studio 2005 的调试菜单中，选择“附加到进程”并选择加载了您的网页的 Internet Explorer 实例。

或者，[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)团队一直在开发“精简版”版本，您可以将其作为脚本包含在页面中，也可以通过浏览器中的书签启动它。它没有提供 Firebug 提供的完整调试器，但它为您提供了一个控制台和一个命令行，您可以从中检查变量并将内容记录到控制台。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T01:28:30.200

TechRepublic 有一个很好的演练 - 请参阅*[Visual Studio 2008 简化了 JavaScript 调试](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/programming-and-development/?p=672)*。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-12T02:09:13.940

Visual Studio 2008 ASP.NET 项目默认启用调试。当网站/Web 应用程序项目在 ASP.NET 调试服务器中运行时，您可以在 .js 文件中设置断点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-25T17:07:04.417

只需确保未选中“禁用脚本调试”，然后按 F5 即可在 VS2005 或 2008 中开始调试。

我还要注意，如果您在 .aspx 页面中有 JavaScript，则必须通过脚本探索找到它。但是，如果您将它放在单独的 .js 文件中，则可以像在任何 .cs 文件中一样在其上放置一个断点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T01:23:36.417

在 Internet Explorer 中，选择*View* -> *Script Debugger* -> *Open*。那应该这样做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-19T19:33:32.020

通常您知道问题出在哪里，因此您可以通过放置关键字“debugger;”在 JavaScript 代码中设置断点。在 JavaScript 代码中的一行（显然没有引号）设置断点。

当您在 Internet Explorer 中访问它时，它会询问您是否要调试并提示您从列表中选择一个调试器，希望您会在该列表中看到 Visual Studio（新实例以及当前运行的instance) - 如果您使用[Firefox](http://en.wikipedia.org/wiki/Mozilla_Firefox)和[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)，它将自动停止该行的执行，您将在 Firebug 调试器中，而不是 Visual Studio。

您将需要执行以下操作来设置 Internet Explorer 以执行此操作 - 从 Internet Explorer 中，按照以下菜单路径：*工具*> *Internet 选项*>*高级选项卡*>*取消选中*“禁用脚本调试”选项。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-19T20:14:47.630

是的，如果您安装了 Office XP 或 Office 2003，则可以选择使用**Microsoft 脚本编辑器。**在 IE 中取消选中禁用脚本调试（Internet Explorer）和禁用脚本调试（其他）。

重启IE。在查看菜单中，您将有一个新项目，“脚本调试”，选择打开。您将可以选择 VS2005 或 Microsoft 脚本编辑器的新实例，选择它并试一试。

编辑：试试[这个](http://jonathanboutelle.com/2006/01/16/how-to-debug-javascript-in-internet-explorer/)链接的教程

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-19T20:35:09.743

您可以在 Visual Studio 2005 的 JavaScript 中设置断点，但除了需要在 Internet Explorer 中启用调试之外，您只能在 .js 文件中设置断点。您不能调试任何内联 JavaScript 代码。

在尝试使用附加过程方法进行调试时尝试调试我的 JavaScript 代码时，我有时也会遇到问题。我通常会使用“开始调试”绿色箭头。如果断点图标（默认为 Burgandy Circle）被填充，您将知道您的代码将在 .js 文件中的断点处停止。如果未填充，您将永远不会停在那里。

最后，确保在[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)配置设置中启用了调试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-25T17:13:06.727

> 我通常使用 Firebug 来处理调试 JS。

除非你需要在 IE 中调试，否则没有必要停止使用 Firebug。它与 ASP.NET 页面中的 JavaScript 一起工作的效果与任何其他类型的页面一样。

Visual Studio 的 JavaScript 调试还可以，但确实无法与 Firebug 聚合的所有客户端信息竞争。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-26T06:50:19.007

在 Visual Studio 2005 中调试客户端 JavaScript 代码：

将以下代码添加到 JavaScript 代码的开头：

```
debugger 
```

请参阅*[在 Visual Studio 2005 中调试客户端 JavaScript](http://cubemsoft.blogspot.com/)*。

# sql-server - 您如何使用 SSRS 处理审计日志记录？

> ID：8422
> 
> 赞同：6
> 
> 时间：2008-08-12T02:39:06.437
> 
> 标签：sql-server, sql-server-2005, reporting-services, reportingservices-2005

我在 SQL Server Reporting Services 2005 中有一些需要保留审核日志的报告。审计日志应该包括谁用什么参数运行了什么报告。我无法使用 Windows 身份验证。

记录此信息的最佳方式是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-31T12:10:30.493

之前的评论已经死了，您可以从 SQL Server 2000/2005 中的 ReportServer ExecutionLog 表或 SQL Server 2008 中的 ExecutionLogStorage 表中挖掘数据。如果您使用基于表单的身份验证来访问报告而不是 windows 身份验证，那么您可能会在报告中传递一些唯一的 UserID、CompanyID、CustomerID 或其他值作为参数。如果是这种情况，那么内置表已经捕获了参数。如果您没有将唯一用户标识符作为参数传递，那么您可能需要依赖应用程序本身中的记录报告执行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T02:47:23.597

查看 ReportServer 数据库中的 ExecutionLog 表。这包含有关谁运行什么报告以及使用什么参数的信息。

不过，我不确定在没有 Windows 身份验证的情况下这将如何工作，因为它无法知道谁在运行什么报告。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T15:48:03.517

你能分享一些关于你的身份验证方法的信息吗？

MS 提供了一些报告示例，其中包括您入门所需的一切。

对于 SSRS 2005 [http://www.codeplex.com/MSFTRSProdSamples/Wiki/View.aspx?title=SS2005!Server%20Management%20Sample%20Reports&referringTitle=Home](http://www.codeplex.com/MSFTRSProdSamples/Wiki/View.aspx?title=SS2005!Server%20Management%20Sample%20Reports&referringTitle=Home)

更多报告样本。 [http://www.codeplex.com/MSFTRSProdSamples/](http://www.codeplex.com/MSFTRSProdSamples/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T02:45:24.397

从内存中 SSRS[内置了](http://msdn.microsoft.com/en-us/library/ms159110.aspx)针对这种确切情况的日志记录

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T06:17:19.453

如果您使用自定义安全扩展，您仍然可以从 ExecutionLog 表中获取您需要的所有信息。除非您的所有用户都使用共享登录名，否则您可能需要重新考虑您的架构，具体取决于审核日志的重要性。

# windows - 如何从 shell32.dll 中获取图标？

> ID：8435
> 
> 赞同：59
> 
> 时间：2008-08-12T03:26:38.557
> 
> 标签：windows, icons

我想让 Tree 图标用于本土应用程序。有谁知道如何将图像提取为 .icon 文件？我想要 16x16 和 32x32，或者我只是做一个屏幕截图。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2016-06-14T01:41:03.913

如果有人正在寻找简单的方法，只需使用 7zip 解压缩 shell32.dll 并查找文件夹 .src/ICON/

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-08-12T03:32:20.590

在 Visual Studio 中，选择“文件打开...”，然后选择“文件...”。然后选择 Shell32.dll。应打开文件夹树，您将在“图标”文件夹中找到图标。

要保存图标，您可以右键单击文件夹树中的图标并选择“导出”。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-08-12T04:17:42.120

另一种选择是使用诸如[ResourceHacker](http://www.angusj.com/resourcehacker/)之类的工具。它处理的不仅仅是图标。干杯!

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-01-22T14:22:48.120

我需要从 shell32.dll 中提取图标 #238 并且不想下载 Visual Studio 或 Resourcehacker，所以我从 Technet 找到了几个 PowerShell 脚本（感谢 John Grenfell 和 # [https://social.technet.microsoft。 com/Forums/windowsserver/en-US/16444c7a-ad61-44a7-8c6f-b8d619381a27/using-icons-in-powershell-scripts?forum=winserverpowershell](https://social.technet.microsoft.com/Forums/windowsserver/en-US/16444c7a-ad61-44a7-8c6f-b8d619381a27/using-icons-in-powershell-scripts?forum=winserverpowershell)）做了类似的事情并创建了一个新脚本（如下）以满足我的需要.

我输入的参数是（源 DLL 路径、目标图标文件名和 DLL 文件中的图标索引）：

C:\Windows\System32\shell32.dll

C:\Temp\Restart.ico

238

我发现我需要的图标索引是#238，通过临时创建一个新的快捷方式（右键单击桌面并选择 New --> Shortcut 并输入 calc 并按 Enter 两次）。然后右键单击新的快捷方式并选择属性，然后单击快捷方式选项卡中的“更改图标”按钮。粘贴到路径 C:\Windows\System32\shell32.dll 并单击确定。找到您要使用的图标并计算出它的索引。注意：索引 #2 在 #1 下方，而不是在其右侧。图标索引 #5 在我的 Windows 7 x64 机器上位于第二列的顶部。

如果有人有更好的方法，可以类似地工作但获得更高质量的图标，那么我很想听听。谢谢，肖恩。

```
#Windows PowerShell Code###########################################################################
# http://gallery.technet.microsoft.com/scriptcenter/Icon-Exporter-e372fe70
#
# AUTHOR: John Grenfell
#
###########################################################################

<#
.SYNOPSIS
   Exports an ico and bmp file from a given source to a given destination
.Description
   You need to set the Source and Destination locations. First version of a script, I found other examples but all I wanted to do as grab and ico file from an exe but found getting a bmp useful. Others might find useful
   No error checking I'm afraid so make sure your source and destination locations exist!
.EXAMPLE
    .\Icon_Exporter.ps1
.Notes
        Version HISTORY:
        1.1 2012.03.8
#>
Param ( [parameter(Mandatory = $true)][string] $SourceEXEFilePath,
        [parameter(Mandatory = $true)][string] $TargetIconFilePath
)
CLS
#"shell32.dll" 238
If ($SourceEXEFilePath.ToLower().Contains(".dll")) {
    $IconIndexNo = Read-Host "Enter the icon index: "
    $Icon = [System.IconExtractor]::Extract($SourceEXEFilePath, $IconIndexNo, $true)    
} Else {
    [void][Reflection.Assembly]::LoadWithPartialName("System.Drawing")
    [void] [System.Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms")
    $image = [System.Drawing.Icon]::ExtractAssociatedIcon("$($SourceEXEFilePath)").ToBitmap()
    $bitmap = new-object System.Drawing.Bitmap $image
    $bitmap.SetResolution(72,72)
    $icon = [System.Drawing.Icon]::FromHandle($bitmap.GetHicon())
}
$stream = [System.IO.File]::OpenWrite("$($TargetIconFilePath)")
$icon.save($stream)
$stream.close()
Write-Host "Icon file can be found at $TargetIconFilePath" 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-04-06T19:51:18.683

[Resources Extract](http://www.nirsoft.net/utils/resources_extract.html "资源提取")是另一种工具，它可以递归地从大量 DLL 中查找图标，非常方便 IMO。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-05-22T14:31:59.723

只需使用 IrfanView 打开 DLL 并将结果保存为 .gif 或 .jpg。

我知道这个问题很老，但它是“从 dll 中提取图标”的第二次谷歌点击，我想避免在我的工作站上安装任何东西，我记得我使用 IrfanView。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-11-12T13:12:38.847

您可以下载免费软件[Resource Hacker](http://www.angusj.com/resourcehacker/)，然后按照以下说明进行操作：

1.  打开您希望从中查找图标的任何 dll 文件。
2.  浏览文件夹以查找特定图标。
3.  从菜单栏中，选择“操作”，然后选择“保存”。
4.  为 .ico 文件选择目标。

参考：[http ://techsultan.com/how-to-extract-icons-from-windows-7/](http://techsultan.com/how-to-extract-icons-from-windows-7/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-11-20T19:56:16.760

这是上述解决方案的更新版本。我添加了一个隐藏在链接中的缺失程序集。新手不会理解的。这是示例将无需修改即可运行。

```
 <#
.SYNOPSIS
    Exports an ico and bmp file from a given source to a given destination
.Description
    You need to set the Source and Destination locations. First version of a script, I found other examples 
    but all I wanted to do as grab and ico file from an exe but found getting a bmp useful. Others might find useful
.EXAMPLE
    This will run but will nag you for input
    .\Icon_Exporter.ps1
.EXAMPLE
    this will default to shell32.dll automatically for -SourceEXEFilePath
    .\Icon_Exporter.ps1 -TargetIconFilePath 'C:\temp\Myicon.ico' -IconIndexNo 238
.EXAMPLE
    This will give you a green tree icon (press F5 for windows to refresh Windows explorer)
    .\Icon_Exporter.ps1 -SourceEXEFilePath 'C:/Windows/system32/shell32.dll' -TargetIconFilePath 'C:\temp\Myicon.ico' -IconIndexNo 41

.Notes
    Based on http://stackoverflow.com/questions/8435/how-do-you-get-the-icons-out-of-shell32-dll Version 1.1 2012.03.8
    New version: Version 1.2 2015.11.20 (Added missing custom assembly and some error checking for novices)
#>
Param ( 
    [parameter(Mandatory = $true)]
    [string] $SourceEXEFilePath = 'C:/Windows/system32/shell32.dll',
    [parameter(Mandatory = $true)]
    [string] $TargetIconFilePath,
    [parameter(Mandatory = $False)]
    [Int32]$IconIndexNo = 0
)

#https://social.technet.microsoft.com/Forums/windowsserver/en-US/16444c7a-ad61-44a7-8c6f-b8d619381a27/using-icons-in-powershell-scripts?forum=winserverpowershell
$code = @"
using System;
using System.Drawing;
using System.Runtime.InteropServices;

namespace System
{
    public class IconExtractor
    {

     public static Icon Extract(string file, int number, bool largeIcon)
     {
      IntPtr large;
      IntPtr small;
      ExtractIconEx(file, number, out large, out small, 1);
      try
      {
       return Icon.FromHandle(largeIcon ? large : small);
      }
      catch
      {
       return null;
      }

     }
     [DllImport("Shell32.dll", EntryPoint = "ExtractIconExW", CharSet = CharSet.Unicode, ExactSpelling = true, CallingConvention = CallingConvention.StdCall)]
     private static extern int ExtractIconEx(string sFile, int iIndex, out IntPtr piLargeVersion, out IntPtr piSmallVersion, int amountIcons);

    }
}
"@

If  (-not (Test-path -Path $SourceEXEFilePath -ErrorAction SilentlyContinue ) ) {
    Throw "Source file [$SourceEXEFilePath] does not exist!"
}

[String]$TargetIconFilefolder = [System.IO.Path]::GetDirectoryName($TargetIconFilePath) 
If  (-not (Test-path -Path $TargetIconFilefolder -ErrorAction SilentlyContinue ) ) {
    Throw "Target folder [$TargetIconFilefolder] does not exist!"
}

Try {
    If ($SourceEXEFilePath.ToLower().Contains(".dll")) {
        Add-Type -TypeDefinition $code -ReferencedAssemblies System.Drawing
        $form = New-Object System.Windows.Forms.Form
        $Icon = [System.IconExtractor]::Extract($SourceEXEFilePath, $IconIndexNo, $true)    
    } Else {
        [void][Reflection.Assembly]::LoadWithPartialName("System.Drawing")
        [void] [System.Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms")
        $image = [System.Drawing.Icon]::ExtractAssociatedIcon("$($SourceEXEFilePath)").ToBitmap()
        $bitmap = new-object System.Drawing.Bitmap $image
        $bitmap.SetResolution(72,72)
        $icon = [System.Drawing.Icon]::FromHandle($bitmap.GetHicon())
    }
} Catch {
    Throw "Error extracting ICO file"
}

Try {
    $stream = [System.IO.File]::OpenWrite("$($TargetIconFilePath)")
    $icon.save($stream)
    $stream.close()
} Catch {
    Throw "Error saving ICO file [$TargetIconFilePath]"
}
Write-Host "Icon file can be found at [$TargetIconFilePath]" 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-03-22T22:05:24.047

还有一个可用的资源，即 Visual Studio 图像库，“可用于创建在视觉上与 Microsoft 软件一致的应用程序”，大概受底部给出的许可限制。 [https://www.microsoft.com/en-ca/download/details.aspx?id=35825](https://www.microsoft.com/en-ca/download/details.aspx?id=35825)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-05-08T09:25:15.310

这个问题在这里已经有了答案，但是对于任何想知道如何做到这一点的新人，我使用 7Zip 并导航到`%SystemRoot%\system32\SHELL32.dll\.rsrc\ICON`，然后将所有文件复制到所需的位置。

如果您想要预解压目录，可以[在此处下载 ZIP](https://github.com/imrolii/SiteDownloads/raw/main/Shell32.zip)。

注意：我在 Windows 8.1 安装中提取了这些文件，因此它们可能与其他 Windows 版本上的不同。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-07-23T08:43:49.740

如果您使用的是 Linux，则可以使用[gExtractWinIcons](https://github.com/muflone/gextractwinicons)从 Windows DLL 中提取图标。它在包中的 Ubuntu 和 Debian 中可用`gextractwinicons`。

这篇博文有[截图和简要说明](http://ubuntugenius.wordpress.com/2010/07/17/how-to-extract-icons-from-exe-files-windows-programs-as-pngs-for-wine-launchers-in-ubuntu/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-21T03:24:52.403

不确定我是否 100% 正确，但根据我的测试，上述使用 7Zip 或 VS 的选项不适用于 Windows 10 / 11 版本的 imageres.dll 或 shell32.dll。这是我看到的内容：

```
[shell32.dll]
.rsrc\MANIFEST\124
.rsrc\MUI\1
.rsrc\TYPELIB\1
.rsrc\version.txt
.data
.didat
.pdata
.rdata
.reloc
.text
CERTIFICATE 
```

更新：我想我找到了原因。链接到我找到的一篇文章。（对不起，域外）。您可以在以下位置的文件中找到资源：

```
"C:\Windows\SystemResources\shell32.dll.mun"
"C:\Windows\SystemResources\imageres.dll.mun" 
```

[Windows 10 1903 中的 imageres.dll 中不再存在图标 - 4kb 文件 (superuser.com)](https://superuser.com/questions/1480268/icons-no-longer-in-imageres-dll-in-windows-10-1903-4kb-file)

# sql-server-2005 - SQL Server 2005 Reporting Services 的条件可见性和分页符

> ID：8439
> 
> 赞同：19
> 
> 时间：2008-08-12T03:46:11.043
> 
> 标签：sql-server-2005, reporting-services

我知道 SQL 2005 存在条件可见性和分页符的错误，但我想知道是否有人想出了解决方法。

我有一个具有条件可见性表达式的表，我需要在表的末尾有一个分页符。

*   如果我将 PageBreakAtEnd 属性设置为 true。无论如何都会被忽略。删除可见性条件，它可以工作。
*   如果我将表格放在一个矩形内，表格上有条件可见性，表格上有分页符。结果相同。分页符属性被忽略。
*   如果我使用 PageBreakAtEnd 属性设置矩形并使用可见性条件设置表格，那么即使未显示表格，我仍然会得到分页符。

关于尝试什么的任何其他想法？我几乎到了需要单独报告而不是条件可见性的地步:(

**编辑：@Josh：**这有同样的问题。如果第二个表具有条件可见性，则它不起作用。如果它没有可见性表达式，那么我总是得到分页符。

@ **Erick：**我真的希望这是答案，但不幸的是它不起作用。当可见性表达式计算为隐藏时，矩形所在的位置会有很大的差距（我可以忍受），当它计算为可见时，分页符仍然不起作用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-15T14:22:26.470

放置两个矩形，一个在另一个里面。
将表格放在内部矩形内并将其设置为始终可见。
将内部矩形的分页符设置为在矩形后插入。
设置外部矩形的可见性以使用您的条件表达式。

分页符和条件可见性现在分开了，内部矩形的分页符如果不可见则不会被处理，但如果它是可见的就会被处理。

**编辑**：当我尝试这个时，它似乎在 Visual Studio 的“预览”选项卡中不起作用，但它在“打印预览”中以及当我将报告导出为 PDF 时确实起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-20T06:30:54.077

嗨，这是 Bala samsnai，我也遇到了同样类型的错误。

我没有使用矩形解决了这个问题。

而不是将表达式提供给完整的（整个表）

选择该表中的一行，给出可见性表达式。像这样对所有行（如页眉、详细信息、页脚）重复它并给出可见性表达式。

这样我们就可以同时工作 Visibilty 和 Pagging

巴拉三沙尼

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-21T06:49:28.227

使用一个设置了条件可见性的矩形，以及该矩形内的一个空表，该表启用了“在之前插入分页符”设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T04:04:44.610

在第一个表之后立即添加第二个（空）表。之后分页。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-11T19:58:10.183

我尝试了 Bala Samsnai 解决方案，它有效。稍后会解释更多。当我遇到无法在另一个表的详细信息行中嵌入表的问题时，Erik B 的 uisng 两个矩形的解决方案很有效。所以这很糟糕。

我的报告遵循了 Bala 的解决方案，其中仅包含一个表和表中的两个组。我没有采用和应用表达式来控制组的可见性，而是将其保留为可见并将可见性条件表达式应用于每一行的隐藏属性。右键单击最左侧的行句柄，您将在右侧或左侧弹出属性窗口（通常作为解决方案资源管理器旁边的选项卡）。在可见性分组中，您将看到一个名为“隐藏”的属性，其默认值为 FALSE。单击该值，然后在下拉列表中，第一个选项是一个表达式。Viola，您可以设置隐藏行时的条件。它对我来说就像一个魅力。

希望这对其他人有帮助。就我而言，当某些值为 0 时，我必须不显示详细信息部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-06T12:20:09.053

我为这个问题苦苦挣扎了好几个小时，直到我发现我的布局太**宽**以适合打印（A4）。我使用了额外的宽度来评论文本框中的不同字段，隐藏=false，结果生成了两倍的页面来显示空白。

因此，您可能还想检查页面宽度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-21T06:30:23.013

我注意到的一件事是报告之间的差异，即使我在 SSRS2005 的不同时间使用相同的报告作为“模板”。我的意思是，如果您在程序员的编辑器（比如 UltraEdit）中打开遇到问题的报告并查看 RDL 文件，您可能会发现页面宽度和高度的细微变化。我注意到了这一点，并将我遇到问题的报告调整为正确的预期纸张宽度，并且在 PDF 和打印机以及打印预览中完美打印了报告。只是一个想法。

# .htaccess - Mod-Rewrite 在 DocumentRoot 后面加载文件

> ID：8441
> 
> 赞同：13
> 
> 时间：2008-08-12T03:58:21.910
> 
> 标签：.htaccess, mod-rewrite

我正在使用`.htaccess`and`mod_rewrite`指向位于 DocumentRoot 后面的文件。我的文件夹结构如下所示：

```
home/
    webroot/
    other_files/ 
```

我`.htaccess`在 webroot 中有一个文件，内容如下：

```
重写引擎开启
重写规则 ^(.*)$ /home/other_files/$1

```

如果我尝试访问[http://example.com/file.html](http://example.com/file.html)，我会收到以下错误：

> 在此服务器上未找到请求的 URL /home/other_files/file.html。

甚至可以加载 DocumentRoot 后面的文件吗？如果是这样，有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-12T04:21:54.857

我相信你需要添加一个部分

```
<Directory "/home/other_files">
  (options)
</Directory> 
```

在 apache 能够从中提供任何服务之前，您的服务器配置。例如，我的 DocumentRoot 是 /var/www 但默认可用站点中有此部分：

```
Alias /doc/ "/usr/share/doc/"
<Directory "/usr/share/doc/">
    Options Indexes MultiViews FollowSymLinks
    AllowOverride None
    Order deny,allow
    Deny from all
    Allow from 127.0.0.0/255.0.0.0 ::1/128
</Directory> 
```

然后，您可以重写 URL 以转到 /doc/，服务器将知道从哪里获取文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T21:08:45.667

只是为了让您知道为什么该规则不起作用：

它无法重写的原因`/home/other_files/file.html`是 mod_rewrite 正在解析路径，`/home/webroot/home/other_files/file.html`因为从 mod_rewrite 的角度来看，前面的斜杠相当于您的文档根目录`/home/webroot`。

[Ryan Ahearn 的建议](https://stackoverflow.com/questions/8441/mod-rewrite-loading-files-behind-the-documentroot#8454)是一个不错的建议，并且很可能是您想要走的路线。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-09-12T02:43:39.117

这要归功于 Ryan Aheam，但我将把它拼出来。我是一个初学者，即使有了 Ryan 的回答，我也不得不尝试一些事情来获得正确的语法。

我希望 my`DocumentRoot`成为我的`cakephp`目录。但是后来我有了一个 Mantis Bug 跟踪器，它只是普通的 PHP，所以不在`cakephp`目录中。下面的文件我有以下工作。

`http://www.example.com`: 服务于 `/var/www/cakephp`

`http://www.example.com/mantisbt`: 服务于`/var/www/html/mantisbt`

文件`/etc/httpd/conf/httpd.conf`

```
Alias /mantisbt/ "/var/www/html/mantisbt/"                                                                          
<Directory "/var/www/html/">                                                                                        
    AllowOverride All                                                                                               
</Directory>                                                                                                        

<VirtualHost *:80>                                                                                                  
    ServerAdmin me@my_email.com                                                                             
    DocumentRoot /var/www/cakephp                                                                                   
    ServerName my_website.com                                                                                      
    <Directory /var/www/cakephp/>                                                                                   
        AllowOverride All                                                                                           
    </Directory>                                                                                                    
</VirtualHost> 
```

文件`/var/www/cakephp/.htaccess`

```
<IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteRule    ^mantisbt/?$   /mantisbt/  [NC,L]
    RewriteRule    ^$    webroot/    [L]
    RewriteRule    (.*) webroot/$1    [L]
</IfModule> 
```

# c++ - MSVC6：断点停止程序

> ID：8443
> 
> 赞同：6
> 
> 时间：2008-08-12T04:00:13.467
> 
> 标签：c++, windows, debugging, visual-c++, visual-c++-6

使用 Microsoft Visual Studio 98、Microsoft Visual C++ 6.0 SP6

在调试器下运行时，只有一个问题。如果我暂停程序并继续，一切都很好。

问题？当我遇到断点时，我的程序会停止。但不是很好；执行停止，我被抛出调试模式进入编辑模式。一切都很好，直到断点被击中。而且我知道它正在到达断点 - 我看到指向右侧代码行的黄色小箭头闪烁，检查窗口中的局部变量和该窗口中的调用堆栈。然后我盯着编辑器。

这发生在所有项目中。

我已经卸载并重新安装了 MSVC6。它没有帮助。

我即将在一台新电脑上重新开始；在我走那么远之前，有人知道我对这个做了什么吗？

* * *

注意：MSVC6 不是我的选择，但有原因。这是我使用的工具。而且，我们要针对 NT4，所以鉴于 2008 不能针对 NT4，而 2005 与 MFC 和 NT4 有问题，MSVC6 就是这样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T05:22:11.147

停止在 VC6 上跳动。它是旧的。STL 于 1996 年从 1994 年编写的 HP 代码更新。C++ 于 1998 年获得批准。

破解时代码在做什么？你能把情况简化成一个简单的测试。当我尝试时，我通常会找到原因。如果你能做到，那么它仍然会发生，那么我会为你看看它。我也很不幸在我的日常工作中使用 VC6。

Visual C++ Express 2008 不能在某些情况下使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-21T16:55:59.203

The first thing I would check is if this project does the same thing on other machines. If not, it could be your box is heading south. If not it's the VC6 project itself.

Typically I get goofiness with the debugger when my program is doing something with the hardware, especially the video.

I would recommend turning off parts of your program until you figure out what part is causing this. If your program is small and not doing much it might be that the project is corrupted and needs to get rebuilt. Make a new project from scratch and put your files and settings back in by hand.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T12:28:32.380

它是特定于您正在处理的应用程序还是任何应用程序中的所有断点都会破坏调试器？

如果您在正常启动应用程序后手动附加调试器，有什么不同吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-21T17:13:13.467

当设备需要额外的内存在断点处停止时，设备是否内存不足并因此放弃了重影？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-22T11:27:37.347

> 当设备需要额外的内存在断点处停止时，设备是否内存不足并因此放弃了重影？

不，还有大量 RAM 可用，甚至还有更多虚拟内存。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-08-12T04:48:40.200

我已经好几年没用过 MSVC6 了，但我记得调试器基本上是一个零碎的废话。像这样的事情会经常发生，没有明显的原因，因为那天它只是不喜欢你的代码。

除了调试器是一个零碎的废话之外，其余部分也是。

它的 STL 实现不是线程安全的，它不太支持 C++ 标准，而且 IDE 非常缺乏细节。

我很确定你也只是不能使用过去 5 年的任何版本的 Platform SDK，因为它太旧了，无法理解它们。不是什么好事。

如果有可以免费下载的[Visual C++ Express 2008](http://www.microsoft.com/express/vc/) ，你会很生气继续使用它。

# c# - C# 中的 [Flags] 枚举属性是什么意思？

> ID：8447
> 
> 赞同：1618
> 
> 时间：2008-08-12T04:09:16.083
> 
> 标签：c#, enums, flags

我不时看到如下枚举：

```
[Flags]
public enum Options 
{
    None    = 0,
    Option1 = 1,
    Option2 = 2,
    Option3 = 4,
    Option4 = 8
} 
```

我不明白该`[Flags]`属性到底是做什么的。

任何人都可以发布一个很好的解释或示例吗？

* * *

## 回答 #1

> 赞同：2353
> 
> 时间：2008-08-12T05:10:46.427

`[Flags]`每当可枚举表示可能值的集合而不是单个值时，都应使用该属性。此类集合通常与按位运算符一起使用，例如：

```
var allowedColors = MyColor.Red | MyColor.Green | MyColor.Blue; 
```

请注意，该`[Flags]`属性**本身并不能**启用此功能 - 它所做的只是允许通过该`.ToString()`方法进行良好的表示：

```
enum Suits { Spades = 1, Clubs = 2, Diamonds = 4, Hearts = 8 }
[Flags] enum SuitsFlags { Spades = 1, Clubs = 2, Diamonds = 4, Hearts = 8 }

...

var str1 = (Suits.Spades | Suits.Diamonds).ToString();
           // "5"
var str2 = (SuitsFlags.Spades | SuitsFlags.Diamonds).ToString();
           // "Spades, Diamonds" 
```

还需要注意的是，`[Flags]` **它不会**自动使枚举值成为 2 的幂。如果省略数值，枚举将不会像人们期望的那样在按位运算中工作，因为默认情况下，值从 0 开始并递增。

不正确的声明：

```
[Flags]
public enum MyColors
{
    Yellow,  // 0
    Green,   // 1
    Red,     // 2
    Blue     // 3
} 
```

如果以这种方式声明，这些值将是 Yellow = 0、Green = 1、Red = 2、Blue = 3。这将使它无法用作标志。

这是正确声明的示例：

```
[Flags]
public enum MyColors
{
    Yellow = 1,
    Green = 2,
    Red = 4,
    Blue = 8
} 
```

要检索属性中的不同值，可以执行以下操作：

```
if (myProperties.AllowedColors.HasFlag(MyColor.Yellow))
{
    // Yellow is allowed...
} 
```

或在 .NET 4 之前：

```
if((myProperties.AllowedColors & MyColor.Yellow) == MyColor.Yellow)
{
    // Yellow is allowed...
}

if((myProperties.AllowedColors & MyColor.Green) == MyColor.Green)
{
    // Green is allowed...
} 
```

**在被子下**

这是有效的，因为您在枚举中使用了 2 的幂。在幕后，您的枚举值在二进制 1 和 0 中看起来像这样：

```
 Yellow: 00000001
 Green:  00000010
 Red:    00000100
 Blue:   00001000 
```

同样，在使用二进制位 OR运算符将属性*AllowedColors*`|`设置为 Red、Green 和 Blue 后，*AllowedColors*如下所示：

```
myProperties.AllowedColors: 00001110 
```

因此，当您检索值时，您实际上是`&`在对这些值执行按位与：

```
myProperties.AllowedColors: 00001110
             MyColor.Green: 00000010
             -----------------------
                            00000010 // Hey, this is the same as MyColor.Green! 
```

**无 = 0 值**

关于`0`在您的枚举中的使用，引用 MSDN：

```
[Flags]
public enum MyColors
{
    None = 0,
    ....
} 
```

> 使用 None 作为值为零的标志枚举常量的名称。**您不能在按位与运算中使用 None 枚举常量来测试标志，因为结果始终为零。**但是，您可以在数值和 None 枚举常量之间执行逻辑比较，而不是按位比较，以确定数值中是否设置了任何位。

您可以在 msdn 上找到有关 flags 属性及其用法的更多信息，并在[msdn](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)上找到[设计标志](http://msdn.microsoft.com/en-us/library/ms229062.aspx)

* * *

## 回答 #2

> 赞同：837
> 
> 时间：2008-08-12T04:37:52.203

你也可以这样做

```
[Flags]
public enum MyEnum
{
    None   = 0,
    First  = 1 << 0,
    Second = 1 << 1,
    Third  = 1 << 2,
    Fourth = 1 << 3
} 
```

我发现位移比键入 4、8、16、32 等更容易。它对您的代码没有影响，因为它都是在编译时完成的

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2013-05-16T15:03:35.337

结合答案[https://stackoverflow.com/a/8462/1037948](https://stackoverflow.com/a/8462/1037948)（通过位移声明）和[https://stackoverflow.com/a/9117/1037948](https://stackoverflow.com/a/9117/1037948)（在声明中使用组合）你可以位移以前的值而不是而不是使用数字。不一定推荐它，但只是指出你可以。

而不是：

```
[Flags]
public enum Options : byte
{
    None    = 0,
    One     = 1 << 0,   // 1
    Two     = 1 << 1,   // 2
    Three   = 1 << 2,   // 4
    Four    = 1 << 3,   // 8

    // combinations
    OneAndTwo = One | Two,
    OneTwoAndThree = One | Two | Three,
} 
```

你可以声明

```
[Flags]
public enum Options : byte
{
    None    = 0,
    One     = 1 << 0,       // 1
    // now that value 1 is available, start shifting from there
    Two     = One << 1,     // 2
    Three   = Two << 1,     // 4
    Four    = Three << 1,   // 8

    // same combinations
    OneAndTwo = One | Two,
    OneTwoAndThree = One | Two | Three,
} 
```

* * *

**使用 LinqPad 确认：**

```
foreach(var e in Enum.GetValues(typeof(Options))) {
    string.Format("{0} = {1}", e.ToString(), (byte)e).Dump();
} 
```

结果是：

```
None = 0
One = 1
Two = 2
OneAndTwo = 3
Three = 4
OneTwoAndThree = 7
Four = 8 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2017-07-20T11:09:19.840

作为已接受答案的扩展，在 C#7 中，枚举标志可以使用二进制文字编写：

```
[Flags]
public enum MyColors
{
    None   = 0b0000,
    Yellow = 0b0001,
    Green  = 0b0010,
    Red    = 0b0100,
    Blue   = 0b1000
} 
```

我认为这种表示清楚地表明了标志如何在幕后*工作*。

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2008-08-12T04:32:30.360

请参阅以下示例，其中显示了声明和潜在用法：

```
namespace Flags
{
    class Program
    {
        [Flags]
        public enum MyFlags : short
        {
            Foo = 0x1,
            Bar = 0x2,
            Baz = 0x4
        }

        static void Main(string[] args)
        {
            MyFlags fooBar = MyFlags.Foo | MyFlags.Bar;

            if ((fooBar & MyFlags.Foo) == MyFlags.Foo)
            {
                Console.WriteLine("Item has Foo flag set");
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2008-08-12T18:40:30.507

我[最近问过](https://stackoverflow.com/questions/7244/anyone-know-a-good-workaround-for-the-lack-of-an-enum-generic-constraint)类似的事情。

如果您使用标志，您可以向枚举添加扩展方法，以便更轻松地检查包含的标志（有关详细信息，请参阅帖子）

这允许您执行以下操作：

```
[Flags]
public enum PossibleOptions : byte
{
    None = 0,
    OptionOne = 1,
    OptionTwo = 2,
    OptionThree = 4,
    OptionFour = 8,

    //combinations can be in the enum too
    OptionOneAndTwo = OptionOne | OptionTwo,
    OptionOneTwoAndThree = OptionOne | OptionTwo | OptionThree,
    ...
} 
```

然后你可以这样做：

```
PossibleOptions opt = PossibleOptions.OptionOneTwoAndThree 

if( opt.IsSet( PossibleOptions.OptionOne ) ) {
    //optionOne is one of those set
} 
```

我发现这比检查包含标志的大多数方法更容易阅读。

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2018-10-23T08:43:57.490

使用标志时，我经常声明额外的 None 和 All 项目。这些有助于检查是否设置了所有标志或未设置标志。

```
[Flags] 
enum SuitsFlags { 

    None =     0,

    Spades =   1 << 0, 
    Clubs =    1 << 1, 
    Diamonds = 1 << 2, 
    Hearts =   1 << 3,

    All =      ~(~0 << 4)

} 
```

用法：

```
Spades | Clubs | Diamonds | Hearts == All  // true
Spades & Clubs == None  // true 
```

**2019-10 更新：**

从 C# 7.0 开始，您可以使用二进制文字，这可能更易于阅读：

```
[Flags] 
enum SuitsFlags { 

    None =     0b0000,

    Spades =   0b0001, 
    Clubs =    0b0010, 
    Diamonds = 0b0100, 
    Hearts =   0b1000,

    All =      0b1111

} 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2008-08-12T15:37:42.480

@Nidonocu

要将另一个标志添加到现有值集，请使用 OR 赋值运算符。

```
Mode = Mode.Read;
//Add Mode.Write
Mode |= Mode.Write;
Assert.True(((Mode & Mode.Write) == Mode.Write)
  && ((Mode & Mode.Read) == Mode.Read))); 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2008-08-12T05:59:38.343

要添加`Mode.Write`：

```
Mode = Mode | Mode.Write; 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2013-05-01T23:57:31.587

对我来说，这个结构有些过于冗长`if ((x & y) == y)...`，特别是如果`x`AND`y`都是标志的复合集，而您只想知道是否有**任何**重叠。

在这种情况下，您真正​​需要知道的是**，在您使用 bitmasked 之后是否存在非零值 [1]**。

> [1] 见詹姆的评论。如果我们真的是*bitmasking*，我们只需要检查结果是否是肯定的。但是由于`enum`s 可以是负数，甚至奇怪的是，当与[属性`[Flags]` 结合](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)使用时，为`!= 0`而不是编码是防御性的`> 0`。

以@andnil 的设置为基础...

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace BitFlagPlay
{
    class Program
    {
        [Flags]
        public enum MyColor
        {
            Yellow = 0x01,
            Green = 0x02,
            Red = 0x04,
            Blue = 0x08
        }

        static void Main(string[] args)
        {
            var myColor = MyColor.Yellow | MyColor.Blue;
            var acceptableColors = MyColor.Yellow | MyColor.Red;

            Console.WriteLine((myColor & MyColor.Blue) != 0);     // True
            Console.WriteLine((myColor & MyColor.Red) != 0);      // False                
            Console.WriteLine((myColor & acceptableColors) != 0); // True
            // ... though only Yellow is shared.

            Console.WriteLine((myColor & MyColor.Green) != 0);    // Wait a minute... ;^D

            Console.Read();
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2008-08-12T04:24:36.240

标志允许您在枚举中使用位掩码。这允许您组合枚举值，同时保留指定的值。

```
[Flags]
public enum DashboardItemPresentationProperties : long
{
    None = 0,
    HideCollapse = 1,
    HideDelete = 2,
    HideEdit = 4,
    HideOpenInNewWindow = 8,
    HideResetSource = 16,
    HideMenu = 32
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-01-27T22:51:39.770

如果有人已经注意到这种情况，我们深表歉意。我们可以在反射中看到的标志的完美示例。是[绑定标志 ENUM](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.bindingflags?view=netframework-4.8)。

```
[System.Flags]
[System.Runtime.InteropServices.ComVisible(true)]
[System.Serializable]
public enum BindingFlags 
```

**用法**

```
// BindingFlags.InvokeMethod
// Call a static method.
Type t = typeof (TestClass);

Console.WriteLine();
Console.WriteLine("Invoking a static method.");
Console.WriteLine("-------------------------");
t.InvokeMember ("SayHello", BindingFlags.InvokeMethod | BindingFlags.Public | 
    BindingFlags.Static, null, null, new object [] {}); 
```

* * *

## 回答 #13

> 赞同：-6
> 
> 时间：2020-11-11T07:59:06.043

*   当可枚举值表示枚举成员的集合时，使用标志。

*   这里我们使用位运算符，| 和 ＆

*   例子

    ```
     [Flags]
                 public enum Sides { Left=0, Right=1, Top=2, Bottom=3 }

                 Sides leftRight = Sides.Left | Sides.Right;
                 Console.WriteLine (leftRight);//Left, Right

                 string stringValue = leftRight.ToString();
                 Console.WriteLine (stringValue);//Left, Right

                 Sides s = Sides.Left;
                 s |= Sides.Right;
                 Console.WriteLine (s);//Left, Right

                 s ^= Sides.Right; // Toggles Sides.Right
                 Console.WriteLine (s); //Left 
    ```

# f# - F# 柯里化函数

> ID：8448
> 
> 赞同：20
> 
> 时间：2008-08-12T04:11:15.800
> 
> 标签：f#, functional-programming, currying

任何人都有一个不错的例子，最好是实用/有用的，他们可以发布演示这个概念吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-12T04:46:33.480

> （编辑：一个小的[Ocaml FP Koan](http://web.archive.org/web/20041012103936/http%3A//www.bagley.org/~doug/ocaml/Notes/okoans.shtml)开始工作）
> 
> > **咖喱公案（关于食物的公案，与食物无关）**
> > 
> > > 一个学生来找 Jacques Garrigue 说：“我不明白柯里化有什么好处。” 雅克回答说：“告诉我你最喜欢的一餐和你最喜欢的甜点”。困惑的学生回答说他喜欢御好烧和馆子，但是虽然他最喜欢的餐厅提供很棒的御好烧，但他们的馆子第二天早上总是让他胃痛。于是雅克带学生去一家餐厅吃饭，这家餐厅的御好烧和学生最喜欢的一样好，然后带他穿过镇子到一家制作一流馆子的商店，学生在那里愉快地满足了他的剩余胃口。那个学生吃饱了，但他没有开悟……直到第二天早上醒来，他的胃感觉很好。

我的示例将涵盖使用它来重用和封装代码。一旦你看到这些，这是相当明显的，并且应该给你一个具体、简单的例子，你可以考虑在许多情况下应用它。

我们想在树上做一张地图。如果该函数需要多个参数，则该函数可以被柯里化并应用于每个节点——因为我们将在节点上应用一个作为它的最后一个参数。它不必被柯里化，但编写*另一个*函数（假设这个函数在其他实例中与其他变量一起使用）将是一种浪费。

```
type 'a tree = E of 'a | N of 'a * 'a tree * 'a tree
let rec tree_map f tree = match tree with
    | N(x,left,right) -> N(f x, tree_map f left, tree_map f right)
    | E(x) -> E(f x)

let sample_tree = N(1,E(3),E(4)
let multiply x y = x * y
let sample_tree2 = tree_map (multiply 3) sample_tree 
```

但这与：

```
let sample_tree2 = tree_map (fun x -> x * 3) sample_tree 
```

所以这个简单的案例没有说服力。但是，一旦您更多地使用该语言并自然而然地遇到这些情况，它确实很强大。另一个将代码重用为柯里化的示例。[创建素数](https://stackoverflow.com/questions/7272/of-ways-to-count-the-limitless-primes#7487)的递归关系。那里有很多相似之处：

```
let rec f_recurrence f a seed n =
    match n with
    | a -> seed
    | _ -> let prev = f_recurrence f a seed (n-1) in
           prev + (f n prev)

let rowland = f_recurrence gcd 1 7
let cloitre = f_recurrence lcm 1 1

let rowland_prime n = (rowland (n+1)) - (rowland n)
let cloitre_prime n = ((cloitre (n+1))/(cloitre n)) - 1 
```

好的，现在 rowland 和 cloitre 是柯里化函数，因为它们有自由变量，我们可以在不知道或担心 f_recurrence 的情况下获得它的序列的任何索引。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-08-12T16:07:24.170

虽然前面的示例回答了这个问题，但这里有两个更简单的示例，说明 Currying 如何有益于 F# 编程。

```
open System.IO

let appendFile (fileName : string) (text : string) =
    let file = new StreamWriter(fileName, true)
    file.WriteLine(text)
    file.Close()

// Call it normally    
appendFile @"D:\Log.txt" "Processing Event X..."

// If you curry the function, you don't need to keep specifying the
// log file name.
let curriedAppendFile = appendFile @"D:\Log.txt"

// Adds data to "Log.txt"
curriedAppendFile "Processing Event Y..." 
```

并且不要忘记您可以对 Printf 系列函数进行 curry！在 curried 版本中，请注意明显缺少 lambda。

```
// Non curried, Prints 1 2 3 
List.iter (fun i -> printf "%d " i) [1 .. 3];;

// Curried, Prints 1 2 3
List.iter (printfn "%d ") [1 .. 3];; 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-02-09T05:22:59.297

Currying 描述了将具有多个参数的函数转换为单参数函数链的过程。C# 中的示例，用于三参数函数：

```
Func<T1, Func<T2, Func<T3, T4>>> Curry<T1, T2, T3, T4>(Func<T1, T2, T3, T4> f)
{
    return a => b => c => f(a, b, c);
}

void UseACurriedFunction()
{
    var curryCompare = Curry<string, string, bool, int>(String.Compare);
    var a = "SomeString";
    var b = "SOMESTRING";
    Console.WriteLine(String.Compare(a, b, true));
    Console.WriteLine(curryCompare(a)(b)(true));

    //partial application
    var compareAWithB = curryCompare(a)(b);
    Console.WriteLine(compareAWithB(true));
    Console.WriteLine(compareAWithB(false));
} 
```

现在，布尔参数可能*不是*您最可能希望在部分应用程序中保持打开状态的参数。这就是为什么 F# 函数中的参数顺序起初看起来有点奇怪的原因之一。让我们定义一个不同的 C# curry 函数：

```
Func<T3, Func<T2, Func<T1, T4>>> BackwardsCurry<T1, T2, T3, T4>(Func<T1, T2, T3, T4> f)
{
    return a => b => c => f(c, b, a);
} 
```

现在，我们可以做一些更有用的事情：

```
void UseADifferentlyCurriedFunction()
{
    var curryCompare = BackwardsCurry<string, string, bool, int>(String.Compare);

    var caseSensitiveCompare = curryCompare(false);
    var caseInsensitiveCompare = curryCompare(true);

    var format = Curry<string, string, string, string>(String.Format)("Results of comparing {0} with {1}:");

    var strings = new[] {"Hello", "HELLO", "Greetings", "GREETINGS"};

    foreach (var s in strings)
    {
        var caseSensitiveCompareWithS = caseSensitiveCompare(s);
        var caseInsensitiveCompareWithS = caseInsensitiveCompare(s);
        var formatWithS = format(s);

        foreach (var t in strings)
        {
            Console.WriteLine(formatWithS(t));
            Console.WriteLine(caseSensitiveCompareWithS(t));
            Console.WriteLine(caseInsensitiveCompareWithS(t));
        }
    }
} 
```

为什么这些示例在 C# 中？因为在 F# 中，函数声明默认是柯里化的。您通常不需要 curry 函数；他们已经咖喱了。主要的例外是框架方法和其他重载函数，它们采用包含多个参数的元组。因此，您可能想要对此类函数进行 curry，事实上，当我在寻找可以执行此操作的库函数时，我遇到了这个问题。我想它丢失了（如果确实如此），因为实现起来非常简单：

```
let curry f a b c = f(a, b, c)

//overload resolution failure: there are two overloads with three arguments.
//let curryCompare = curry String.Compare

//This one might be more useful; it works because there's only one 3-argument overload
let backCurry f a b c = f(c, b, a)
let intParse = backCurry Int32.Parse
let intParseCurrentCultureAnyStyle = intParse CultureInfo.CurrentCulture NumberStyles.Any
let myInt = intParseCurrentCultureAnyStyle "23"
let myOtherInt = intParseCurrentCultureAnyStyle "42" 
```

为了解决 String.Compare 的失败，因为据我所知无法指定选择哪个 3 参数重载，您可以使用非通用解决方案：

```
let curryCompare s1 s2 (b:bool) = String.Compare(s1, s2, b)
let backwardsCurryCompare (b:bool) s1 s2 = String.Compare(s1, s2, b) 
```

我不会详细介绍 F# 中部分函数应用程序的使用，因为其他答案已经涵盖了这一点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-12T04:26:41.523

这是一个相当简单的过程。获取一个函数，绑定它的一个参数并返回一个新函数。例如：

```
let concatStrings left right = left + right
let makeCommandPrompt= appendString "c:\> " 
```

现在通过柯里化简单的 concatStrings 函数，您可以轻松地将 DOS 风格的命令提示符添加到任何字符串的前面！真的好用！

好吧，不是真的。我发现一个更有用的情况是，当我想要一个函数以类似流的方式返回数据时。

```
let readDWORD array i = array[i] | array[i + 1] << 8 | array[i + 2] << 16 | 
    array[i + 3] << 24 //I've actually used this function in Python. 
```

关于它的方便之处在于，与其为这类事情创建一个完整的类、调用构造函数、调用 obj.readDWORD()，不如你只拥有一个无法从你下面变异出来的函数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-05-10T03:42:30.687

你知道你可以在一个列表上映射一个函数吗？例如，映射一个函数以向列表的每个元素添加一个：

```
> List.map ((+) 1) [1; 2; 3];;
val it : int list = [2; 3; 4] 
```

这实际上已经在使用柯里化了，因为该`(+)`运算符用于创建一个函数来为其参数添加一个，但您可以通过更改它以映射列表列表的相同函数来从这个示例中挤出更多内容：

```
> List.map (List.map ((+) 1)) [[1; 2]; [3]];;
val it : int list = [[2; 3]; [4]] 
```

如果没有 currying，您将无法部分应用这些函数，而必须编写如下内容：

```
> List.map((fun xs -> List.map((fun n -> n + 1), xs)), [[1; 2]; [3]]);;
val it : int list = [[2; 3]; [4]] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-02T23:09:47.580

[我在我的博客上](http://azurecoding.net/blogs/brownie/archive/2010/01/18/accounting-for-cost-of-sales-with-currying.aspx)给出了一个在 C# 中模拟柯里化的好例子。要点是，您可以从现有的多参数函数中创建一个在参数上封闭的函数（在我的示例中，创建一个用于计算在给定城市的价值上封闭的销售税的函数）。

这里吸引人的是，您不必专门为计算库克县的销售税创建一个单独的函数，您可以在运行时动态创建（和重用）该函数。

# c++ - C++ 中的安全内存分配器

> ID：8451
> 
> 赞同：15
> 
> 时间：2008-08-12T04:18:09.873
> 
> 标签：c++, security, memory, ram-scraping

我想创建一个分配器，它提供具有以下属性的内存：

*   无法分页到磁盘。
*   很难通过附加的调试器访问

这个想法是这将包含用户应该无法访问的敏感信息（如许可证信息）。我已经在网上进行了通常的研究，并就此询问了其他一些人，但我找不到一个很好的起点来解决这个问题。

**更新**

[Josh](https://stackoverflow.com/questions/8451/secure-memory-allocator-in-c#27194)提到了使用`VirtualAlloc`来设置内存空间的保护。我创建了一个自定义分配器（如下所示）我发现使用`VirtualLock`它限制了我可以分配的内存量。这似乎是设计使然。因为我将它用于小物体，所以这不是问题。

```
//
template<class _Ty>
class LockedVirtualMemAllocator : public std::allocator<_Ty>
{
public:
    template<class _Other>
    LockedVirtualMemAllocator<_Ty>& operator=(const LockedVirtualMemAllocator<_Other>&)
    {   // assign from a related LockedVirtualMemAllocator (do nothing)
        return (*this);
    }

    template<class Other>
    struct rebind {
        typedef LockedVirtualMemAllocator<Other> other;
    };

    pointer allocate( size_type _n )
    {
        SIZE_T  allocLen = (_n * sizeof(_Ty));
        DWORD   allocType = MEM_COMMIT;
        DWORD   allocProtect = PAGE_READWRITE;
        LPVOID pMem = ::VirtualAlloc( NULL, allocLen, allocType, allocProtect );
        if ( pMem != NULL ) {
            ::VirtualLock( pMem, allocLen );
        }
        return reinterpret_cast<pointer>( pMem );
    }
    pointer allocate( size_type _n, const void* )
    {
        return allocate( _n );
    }

    void deallocate(void* _pPtr, size_type _n )
    {
        if ( _pPtr != NULL ) {
            SIZE_T  allocLen = (_n * sizeof(_Ty));
            ::SecureZeroMemory( _pPtr, allocLen );
            ::VirtualUnlock( _pPtr, allocLen );
            ::VirtualFree( _pPtr, 0, MEM_RELEASE );
        }
    }
}; 
```

并且被使用

```
 //a memory safe std::string
 typedef std::basic_string<char, std::char_traits<char>, 
                           LockedVirtualMemAllocato<char> > modulestring_t; 
```

[Ted Percival](https://stackoverflow.com/questions/8451/secure-memory-allocator-in-c#38708)提到了 mlock，但我还没有实现。

我发现[Neil Furguson 和 Bruce Schneier 的 Practical Cryptography 也](http://www.schneier.com/book-practical.html)很有帮助。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-08-12T05:17:09.473

您无法真正防止内存访问。如果您以管理员或系统身份运行，您可能可以阻止分页，但您不能阻止管理员或系统读取您的内存。即使您可以以某种方式完全阻止其他进程读取您的内存（您不能），另一个进程实际上仍然可以将一个新线程注入您的进程并以这种方式读取内存。

即使您可以以某种方式完全锁定您的进程并保证操作系统*永远不会*允许其他任何人访问您的进程，您仍然没有完全保护。整个操作系统可以在虚拟机中运行，可以随时暂停和检查。

您*无法*保护系统所有者的内存内容。多年来，好莱坞和音乐产业一直在为此苦恼。如果可能的话，他们早就这样做了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-02T02:25:23.350

在 Unix 系统上，您可以使用[mlock(2)](http://linux.die.net/man/2/mlock)将内存页面锁定到 RAM 中，防止它们被分页。

> mlock() 和 mlockall() 分别将调用进程的部分或全部虚拟地址空间锁定到 RAM 中，防止该内存被分页到交换区域。

每个进程可以锁定多少内存是有限制的，它可以显示`ulimit -l`并以千字节为单位。在我的系统上，默认限制是每个进程 32 kiB。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-12T05:13:00.637

让我们一次看一下：

> 我想创建一个分配器，它提供具有以下属性的内存：

这很公平。

> ```
> * cannot be paged to disk. 
> ```

那会很难。据我所知，您不能禁用虚拟分页，因为它是由操作系统处理的。如果有办法，那么您将在操作系统的内部进行探索。

> ```
> * is incredibly hard to access through an attached debugger 
> ```

您可以通过 PGP 运行它并将其加密存储在内存中并根据需要对其进行解密。巨大的性能冲击。

> 这个想法是这将包含用户应该无法访问的敏感信息（如许可证信息）。我已经在网上进行了通常的研究，并就此询问了其他一些人，但我找不到一个很好的起点来解决这个问题。

将所有敏感信息远离机器。严重地。不要将敏感信息存储在内存中。编写一个自定义删除例程，该例程将自动从您执行的任何分配中删除所有数据。切勿允许对带有敏感材料的机器进行一般访问。如果您执行数据库访问，请确保在触发之前对所有访问进行清理。只有具有特定登录名的人才能访问。没有一般的组访问权限。

> 附带说明一下，除了附加调试器之外，还有哪些其他方法可以访问进程的内存？

转储内存。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-26T01:16:51.790

如果您正在为 Windows 开发，有一些方法可以限制对内存的访问，但绝对阻止其他人是不可行的。如果您希望保守秘密，请阅读[*编写安全代码*](http://www.microsoft.com/mspress/books/5957.aspx)- 它在一定程度上解决了这个问题，但请注意，您无法知道您的代码是在真机还是虚拟机上运行。有一堆 Win32 API 东西来处理处理这类事情的加密，包括安全存储秘密——这本书谈到了这一点。您可以查看在线[Microsoft CyproAPI](http://msdn.microsoft.com/en-us/library/aa380256(VS.85).aspx)了解详细信息；操作系统设计人员意识到了这个问题以及保持明文安全的必要性（再次阅读*编写安全代码*）。

Win32 API 函数[`VirtualAlloc`](http://msdn.microsoft.com/en-us/library/aa366887(VS.85).aspx)是操作系统级别的内存分配器。它允许您设置访问保护；您可以做的是设置对`PAGE_GUARD`or`PAGE_NOACCESS`的访问权限，并在您的程序读取时将访问权限翻转为更友好的内容，然后再将其重置，但如果有人真的很努力地偷看您的秘密，这只是一个减速带。

总之，看看你平台上的加密 API，它们会比你自己破解的东西更好地解决问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-11-06T13:45:38.610

安装 Libsodium，通过 #include 使用分配机制`<sodium.h>`

## 受保护的堆分配

比 malloc() 和朋友慢，它们需要 3 或 4 个额外的虚拟内存页。

```
void *sodium_malloc(size_t size); 
```

`sodium_malloc()`使用和分配内存来存储敏感数据`sodium_allocarray()`。`sodium_init()`在使用这些堆守卫之前，您需要先调用。

```
void *sodium_allocarray(size_t count, size_t size); 
```

该`sodium_allocarray()`函数返回一个指针，从该指针可以访问每个 size 字节的内存对象。它提供了与超过相同的保证，`sodium_malloc()`但也防止算术溢出。`count * size``SIZE_MAX`

这些函数在受保护数据周围添加保护页，以使其在类似心脏出血的情况下不太可能被访问。

此外，可以使用锁定内存操作更改以这种方式分配的内存区域的保护`sodium_mprotect_noaccess()`：`sodium_mprotect_readonly()`和`sodium_mprotect_readwrite()`。

之后`sodium_malloc`可以使用`sodium_free()`解锁和释放内存。在您的实现中此时考虑在使用后将内存归零。

## 使用后将内存归零

```
void sodium_memzero(void * const pnt, const size_t len); 
```

使用后，敏感数据应该被覆盖，但 memset() 和手写代码可以被优化编译器或链接器静默剥离。

sodium_memzero() 函数尝试有效地将从 pnt 开始的 len 个字节归零，即使正在对代码进行优化也是如此。

## 锁定内存分配

```
int sodium_mlock(void * const addr, const size_t len); 
```

该`sodium_mlock()`函数从 addr 开始锁定至少 len 个字节的内存。这有助于避免将敏感数据交换到磁盘。

```
int sodium_mprotect_noaccess(void *ptr); 
```

sodium_mprotect_noaccess() 函数使使用 sodium_malloc() 或 sodium_allocarray() 分配的区域不可访问。它不能被读取或写入，但数据会被保留。此功能可用于使机密数据无法访问，除非特定操作实际需要。

```
int sodium_mprotect_readonly(void *ptr); 
```

sodium_mprotect_readonly() 函数将使用 sodium_malloc() 或 sodium_allocarray() 分配的区域标记为只读。尝试修改数据将导致进程终止。

```
int sodium_mprotect_readwrite(void *ptr); 
```

在使用or保护之后，该函数将使用or`sodium_mprotect_readwrite()`分配的区域标记为可读和可写。`sodium_malloc()``sodium_allocarray()``sodium_mprotect_readonly()``sodium_mprotect_noaccess()`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T05:07:08.837

您要求的内容是在操作系统级别处理的。一旦数据在您的程序中，它很可能被调出。

为了访问内存，有动力的人可以附加一个硬件调试器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T05:21:33.053

@格雷厄姆

> 您可以通过 PGP 运行它并将其加密存储在内存中并根据需要对其进行解密。巨大的性能冲击。

然后你必须把钥匙放在记忆中。这会让事情变得更难一些，但绝对不是不可能的。任何有动力的人仍然会设法从内存中获取数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-22T16:38:41.963

> 您无法保护系统所有者的内存内容。多年来，好莱坞和音乐产业一直在为此苦恼。如果可能的话，他们早就这样做了。

您是否看过 Vista（及更高版本）[受保护的进程](https://web.archive.org/web/20100905221322/http://www.microsoft.com/whdc/system/vista/process_vista.mspx)（直接[.doc 下载](http://download.microsoft.com/download/a/f/7/af7777e5-7dcd-4800-8a0a-b18336565f5b/process_Vista.doc)）。我相信操作系统强制保护是娱乐业的礼貌。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-31T22:05:01.513

最好的办法是实现类似于 .NET 的 SecureString 类的东西，并在完成后非常小心地将数据的任何纯文本副本清零（即使抛出异常也不要忘记清理）。使用 std::string 执行此操作的一个好方法是使用[自定义分配器](http://www.codeproject.com/KB/cpp/allocator.aspx)。

在 Windows 上，如果您使用 CryptProtectMemory（或旧系统的 RtlEncryptMemory），则加密密码存储在不可分页（内核？）内存中。在我的测试中，这些功能非常快，尤其是。考虑到他们为您提供的保护。

在其他系统上，我喜欢使用 Blowfish，因为它是速度和力量的完美结合。在后一种情况下，您必须在程序启动时随机生成自己的密码（对于 Blowfish，熵为 16+ 字节）。不幸的是，在没有操作系统支持的情况下，您无法保护该密码，尽管您可以使用一般的混淆技术将硬编码的盐值嵌入到您可以与密码结合的可执行文件中（每一点都有帮助）。

总体而言，该策略只是更广泛的纵深防御方法的一部分。还要记住，缓冲区溢出和未清理程序输入等简单错误仍然是迄今为止最常见的攻击媒介。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-08-12T06:03:16.773

@Derek：哦，但是通过可信计算，您可以使用[内存窗帘](http://en.wikipedia.org/wiki/Trusted_Computing#Memory_curtaining)！:-P</devils-advocate>

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-08-12T06:12:44.027

@roo

> 我真的希望这是可能的，但我还没有找到它。你的例子让我意识到这正是我们想要做的——只允许访问我们程序上下文中的文件，从而保留 IP。
> 
> 我想我必须接受没有真正安全的方法可以将某人的文件存储在另一台计算机上，特别是如果所有者在某些时候允许访问该文件。

这绝对是问题所在。只要您从不授予访问权限，您就可以安全地存储某些内容，但是一旦您授予访问权限，您的控制权就消失了。你可以让它更难一点，但仅此而已。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-08-12T06:15:27.640

@克里斯

> 哦，但是通过可信计算，您可以使用内存窗帘！:-P

但是，您实际上必须愿意为别人拥有的计算机付费。:p

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-08-12T08:10:27.393

@德里克公园

他只是说更难，不是不可能。PGP 会让它变得更难，而不是不可能。

# wpf - 自定义 WPF 命令模式示例

> ID：8452
> 
> 赞同：37
> 
> 时间：2008-08-12T04:18:30.853
> 
> 标签：wpf, design-patterns, command

我已经完成了一些 WPF 编程，但我从未得到过的一件事是命令模式。每个示例似乎都是内置的，编辑、剪切、粘贴。任何人都有自定义命令的最佳实践示例或建议？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-08-12T04:58:38.620

啊哈！一个我可以回答的问题！首先，我应该提到，我个人发现在代码中定义和连接命令比在 XAML 中更容易。它允许我比所有 XAML 方法更灵活地连接命令的处理程序。

您应该弄清楚您想要拥有哪些命令以及它们与什么相关。在我的应用程序中，我目前有一个用于定义重要应用程序命令的类，如下所示：

```
public static class CommandBank
{
  /// Command definition for Closing a window
  public static RoutedUICommand CloseWindow { get; private set; }

  /// Static private constructor, sets up all application wide commands.
  static CommandBank()
  {
    CloseWindow = new RoutedUICommand();
    CloseWindow.InputGestures.Add(new KeyGesture(Key.F4, ModifierKeys.Alt));
    // ...
  } 
```

现在，因为我想将所有代码放在一起，所以对 Commands 使用仅代码方法可以让我将以下方法放在上面的类中：

```
/// Closes the window provided as a parameter
public static void CloseWindowExecute(object sender, ExecutedRoutedEventArgs e)
{
  ((Window)e.Parameter).Close();
}

/// Allows a Command to execute if the CommandParameter is not a null value
public static void CanExecuteIfParameterIsNotNull(object sender, CanExecuteRoutedEventArgs e)
{
  e.CanExecute = e.Parameter != null;
  e.Handled = true;
} 
```

第二种方法甚至可以与其他命令共享，而无需我在整个地方重复它。

一旦定义了这样的命令，就可以将它们添加到任何 UI 中。在下文中，一旦加载了 Window，我将命令绑定添加到 Window 和 MenuItem，然后使用循环将输入绑定添加到 Window 以对所有命令绑定执行此操作。传递的参数是 Window 它的自身，因此上面的代码知道要尝试关闭哪个 Window。

```
public partial class SimpleWindow : Window
{
  private void WindowLoaded(object sender, RoutedEventArgs e)
  {
    // ...
    this.CommandBindings.Add(
      new CommandBinding(
        CommandBank.CloseWindow,
        CommandBank.CloseWindowExecute,
        CommandBank.CanExecuteIfParameterIsNotNull));

    foreach (CommandBinding binding in this.CommandBindings)
    {
       RoutedCommand command = (RoutedCommand)binding.Command;
       if (command.InputGestures.Count > 0)
       {
         foreach (InputGesture gesture in command.InputGestures)
         {
           var iBind = new InputBinding(command, gesture);
           iBind.CommandParameter = this;
           this.InputBindings.Add(iBind);
         }
       }
    }

    // menuItemExit is defined in XAML
    menuItemExit.Command = CommandBank.CloseWindow;
    menuItemExit.CommandParameter = this;
    // ...
  }

  // ....
} 
```

然后，我稍后也有 WindowClosing 和 WindowClosed 事件的事件处理程序，我建议您使命令的实际实现尽可能小和通用。在这种情况下，如果有未保存的数据，我没有尝试放置试图停止窗口关闭的代码，而是将该代码牢牢地保存在 WindowClosing 事件中。

如果您有任何后续问题，请告诉我。:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-12T21:03:37.720

我去年在[http://blogs.vertigo.com/personal/alanl/Blog/archive/2007/05/31/commands-in-wpf.aspx上写了关于 WPF 命令的大量资源以及一个示例](http://blogs.vertigo.com/personal/alanl/Blog/archive/2007/05/31/commands-in-wpf.aspx)

在这里粘贴：

[Adam Nathan 关于 WPF 中的重要新概念的示例章节：命令](http://www.informit.com/articles/article.aspx?p=688529&seqNum=4)

[MSDN 文章：WPF 中的命令模式](https://web.archive.org/web/20090202052155/http://www.microsoft.com/belux/msdn/nl/community/columns/jdruyts/wpf_commandpattern.mspx)

[Keyvan Nayyeri：如何将命令添加到自定义 WPF 控件](http://nayyeri.net/blog/how-to-add-commands-to-custom-wpf-control/)

[Ian Griffiths：Avalon 输入、命令和处理程序](http://www.interact-sw.co.uk/iangblog/2005/05/19/avaloncommands)

[维基百科：命令模式](http://en.wikipedia.org/wiki/Command_pattern)

[MSDN 库：命令概述](https://msdn.microsoft.com/library/ms752308(v=vs.100).aspx)

[MSDN 库：CommandBinding 类](http://msdn.microsoft.com/en-us/library/system.windows.input.commandbinding.aspx)

[MSDN 库：输入和命令操作方法主题](http://msdn.microsoft.com/en-us/library/ms752051(VS.85).aspx)

[MSDN 库：EditingCommands 类](http://msdn.microsoft.com/en-us/library/system.windows.documents.editingcommands.aspx)

[MSDN 库：MediaCommands 类](http://msdn.microsoft.com/en-us/library/system.windows.input.mediacommands.aspx)

[MSDN 库：ApplicationCommands 类](http://msdn.microsoft.com/en-us/library/system.windows.input.applicationcommands.aspx)

[MSDN 库：NavigationCommands 类](http://msdn.microsoft.com/en-us/library/system.windows.input.navigationcommands.aspx)

[MSDN 库：ComponentCommands 类](http://msdn.microsoft.com/en-us/library/system.windows.input.componentcommands.aspx)

同样隐藏在 WPF SDK 示例中，还有一个关于 RichTextBox 编辑的很好的示例，我已经对其进行了扩展。你可以在这里找到它：[RichTextEditor.zip](http://blogs.vertigosoftware.com/files/alan/richtexteditor.zip)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-08T07:42:11.350

在 2008 年 9 月版的 MSDN 杂志中，Brian Noyes 有一篇关于 RoutedCommand/RoutedEvents 的优秀文章！！！

这是链接：http: [//msdn.microsoft.com/en-us/magazine/cc785480.aspx](http://msdn.microsoft.com/en-us/magazine/cc785480.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-12T07:57:11.723

XAML 的优点在于它适用于“简单”程序，但遗憾的是，当您想要执行共享功能之类的事情时，它就不能很好地工作。假设您有几个类和 UI，所有这些类和 UI 都具有从未禁用的命令，您必须为每个 Window 或 UserControl 编写一个“CanAlwaysExecute”方法！那不是很*干*。

阅读了几篇博客并尝试了几件事后，我决定让 XAML 纯粹与外观、样式、动画和触发器有关。我所有的事件处理程序和命令连接现在都在代码隐藏中。:)

顺便说一句，另一个问题是输入绑定，为了让它们被捕获，焦点必须放在包含输入绑定的对象上。例如，要获得可以随时使用的快捷方式（例如，F1 打开帮助），必须在 Window 对象上设置输入绑定，因为当您的应用程序处于活动状态时，它始终具有焦点。即使您开始使用可能希望将输入绑定添加到其父窗口的用户控件，使用代码方法也应该更容易。

# security - 实用的非基于图像的验证码方法？

> ID：8472
> 
> 赞同：317
> 
> 时间：2008-08-12T04:59:35.017
> 
> 标签：security, language-agnostic, captcha

看起来我们将向 Stack Overflow 添加[CAPTCHA](http://en.wikipedia.org/wiki/Captcha)支持。这是防止机器人、垃圾邮件发送者和其他恶意脚本活动所必需的。我们只希望人类在这里发布或编辑东西！

我们将使用 JavaScript (jQuery) CAPTCHA 作为第一道防线：

[http://docs.jquery.com/Tutorials:Safer_Contact_Forms_Without_CAPTCHA](http://docs.jquery.com/Tutorials:Safer_Contact_Forms_Without_CAPTCHAs)

这种方法的优点是，**对于大多数人来说，验证码永远不会可见！**

然而，对于禁用 JavaScript 的人，我们仍然需要一个后备，这就是它变得棘手的地方。

我[为 ASP.NET 编写了一个传统的 CAPTCHA 控件](http://www.codeproject.com/KB/custom-controls/CaptchaControl.aspx)，我们可以重复使用它。

![验证码图片](https://i.stack.imgur.com/Puvbf.jpg)

但是，我更喜欢使用文本内容，以避免每次请求在服务器上创建所有这些图像的开销。

我见过像..

*   ASCII 文本验证码：`\/\/(_)\/\/`
*   数学谜题：7 减去 3 乘以 2 等于多少？
*   琐事问题：什么味道更好，蟾蜍还是冰棒？

也许我只是在这里对风车倾斜，但`<noscript>`如果可能的话，我希望有一个资源密集型、非基于图像的兼容验证码。

想法？

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2008-08-25T19:52:35.267

我[最喜欢的验证码](http://flickr.com/photos/ceejayoz/2674227920/)：

![验证码](https://i.stack.imgur.com/q3EId.jpg)

* * *

## 回答 #2

> 赞同：205
> 
> 时间：2008-08-12T09:34:30.670

[我开发的一种方法](http://gatekiller.co.uk/Post/JavaScript_Captcha)似乎工作得很好（尽管我可能没有像你那样收到那么多评论垃圾邮件），是有一个隐藏字段并用虚假值填充它，例如：

```
<input type="hidden" name="antispam" value="lalalala" /> 
```

然后我有一段 JavaScript，它每秒更新一次页面加载的秒数：

```
var antiSpam = function() {
        if (document.getElementById("antiSpam")) {
                a = document.getElementById("antiSpam");
                if (isNaN(a.value) == true) {
                        a.value = 0;
                } else {
                        a.value = parseInt(a.value) + 1;
                }
        }
        setTimeout("antiSpam()", 1000);
}

antiSpam(); 
```

然后在提交表单时，如果反垃圾邮件值仍然是“lalalala”，那么我将其标记为垃圾邮件。如果反垃圾邮件值是一个整数，我会检查它是否高于 10（秒）。如果它低于 10，我将其标记为垃圾邮件，如果它是 10 或更多，我让它通过。

```
If AntiSpam = A Integer
    If AntiSpam >= 10
        Comment = Approved
    Else
        Comment = Spam
Else
    Comment = Spam 
```

理论是：

*   垃圾邮件机器人将不支持 JavaScript，并将提交它看到的内容
*   如果机器人确实支持 JavaScript，它将立即提交表单
*   评论者在发布之前至少阅读了一些页面

这种方法的缺点是它需要 JavaScript，如果您没有启用 JavaScript，您的评论将被标记为垃圾邮件，但是，我会查看标记为垃圾邮件的评论，所以这不是问题。

**对评论的回应**

@MrAnalogy：服务器端方法听起来是个好主意，与在 JavaScript 中做的完全一样。好决定。

@AviD：我知道这种方法容易受到直接攻击，正如我在[博客](http://gatekiller.co.uk/Post/JavaScript_Captcha)中提到的那样。但是，它将防御您的普通垃圾邮件机器人，后者盲目地将垃圾提交到它可以找到的任何形式。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2008-08-21T10:23:08.367

除非我遗漏了什么，否则使用[reCAPTCHA](http://recaptcha.net/whyrecaptcha.html)有什么问题，因为所有工作都是在外部完成的。

只是一个想法。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-08-12T05:15:04.000

> 这种方法的优点是，对于大多数人来说，**验证码永远不会可见！**

我喜欢这个想法，难道我们就没有办法可以直接连接到代表系统吗？我的意思是，任何说 +100 代表的人都可能是人类。因此，如果他们有代表，您甚至不必费心在 CAPTCHA 方面做任何事情。

然后，如果他们不是，然后发送它，我相信它不会花费那么多帖子达到 100 并且社区会立即潜入任何人似乎在发送带有攻击性标签的垃圾邮件，为什么不添加一个“报告垃圾邮件”链接那downmods 200？获得其中的 3 个，解锁垃圾邮件机器人成就，再见 ;)

**编辑**：我还应该补充一点，我喜欢非图像验证码的数学想法。或者也许是一个*简单*的谜语类型的东西。可能会让发帖更有趣^_^

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-08-12T05:20:05.893

[蜜罐验证码](http://haacked.com/archive/2007/09/11/honeypot-captcha.aspx)呢？

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-08-27T04:04:26.263

避免[有史以来最糟糕的验证码](http://www.docstoc.com/docs/1048763/Worst-Captchas-of-All-Time)。

> 琐事是可以的，但你必须写下每一个:-(

*有人*将不得不写它们。

您可以像 ReCaptcha 打印文字一样做琐事问题。它提供了两个词，其中一个它知道答案，另一个它不知道 - 在第二个答案足够多之后，它现在也知道答案了。问两个琐碎的问题：

女人需要男人就像鱼需要男人？

橙橙橙。键入绿色。

当然，这可能需要与其他技术相结合，例如计时器或计算秘密。问题需要轮换/退出，因此为了保持问题的供应，您可以临时添加：

输入您的明显问题：

你甚至不需要答案；其他人会为你解决这个问题。您可能必须允许将问题标记为“太难”，例如：“asdf ejflf asl;jfe ei;fil;asfas”。

*现在，为了减慢运行 StackOverflow 游戏机器人的速度，您可以按 IP 地址轮换问题 - 因此，在所有*问题都用完之前，相同的 IP 地址不会得到相同的问题。这会减慢构建已知问题字典的速度，迫使机器人的人类所有者回答您所有的琐事问题。

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2008-09-17T05:47:31.520

CAPTCHA 在其当前的概念化中被破坏并且通常很容易被绕过。现有的解决方案都没有有效的工作——GMail 最多只有 20% 的成功率。

实际上比这更糟糕，因为该统计信息仅使用 OCR，并且还有其他方法可以解决它 - 例如，验证码代理和验证码农场。我最近在OWASP上做了一个关于这个主题的演讲，但是ppt还没有上线……

虽然 CAPTCHA 不能以任何形式提供实际保护，但如果您想要阻止随意路过的垃圾，它可能足以满足您的需求。但它甚至无法阻止半专业的垃圾邮件发送者。

通常，对于需要保护具有任何价值的资源的站点，您需要三管齐下的方法：

*   仅限制来自经过身份验证的用户的响应，禁止匿名帖子。
*   最小化（而不是阻止）来自经过身份验证的用户的少量垃圾帖子 - 例如基于声誉的。人工版主也可以在这里提供帮助，但是您还有其他问题 - 即淹没（甚至淹死）版主，有些网站更喜欢开放性......
*   使用服务器端启发式逻辑来识别类似垃圾邮件的行为，或者更好的非人类行为。

CAPTCHA 可以通过第二个插脚帮助一点点，仅仅是因为它改变了经济性 - 如果其他插脚到位，则不再值得费心突破 CAPTCHA（最小成本，但仍然是成本）以在这样的情况下取得成功少量垃圾邮件。

同样，并非所有垃圾邮件（和其他垃圾）都是计算机生成的 - 使用 CAPTCHA 代理或农场，坏人可以让真人向您发送垃圾邮件。

* * *

CAPTCHA 代理是指他们将您的图像提供给其他网站的用户，例如色情、游戏等。

验证码农场有许多廉价劳动力（印度、远东等）来解决它们……通常每解决 1000 个验证码需要 2-4 美元。最近在Ebay上看到一个帖子...

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2008-08-15T17:40:58.583

> 因此，除了版主之外，所有用户都必须使用 CAPTCHA。[[1]](https://stackoverflow.com/questions/8472?sort=oldest#8487)

这真是太愚蠢了。所以会有用户可以***编辑网站上的任何帖子，***但没有验证码就不能发布？如果您有足够的代表来对帖子投反对票，那么您就有足够的代表在没有验证码的情况下发布。如果必须的话，让它更高。此外，您可以在没有图像识别的情况下使用大量垃圾邮件检测方法，因此即使对于未注册的用户，也无需填写那些被上帝遗忘的验证码表格。

* * *

## 回答 #9

> 赞同：27
> 
> 时间：2008-11-04T14:32:27.530

我曾经在朋友的网站上看到过这个。他卖20块钱。这是ASCII艺术！

[http://thephppro.com/products/captcha/](http://thephppro.com/products/captcha/)

```
 .oooooo.         oooooooo 
 d8P'  `Y8b       dP""""""" 
888      888     d88888b.   
888      888 V       `Y88b '
888      888           ]88  
`88b    d88'     o.   .88P  
 `Y8bood8P'      `8bd88P' 
```

* * *

## 回答 #10

> 赞同：26
> 
> 时间：2008-08-12T05:09:51.360

确保这不是[谷歌可以回答](http://www.google.com/search?q=what+is+7+minus+3+times+2%3F)的问题。这也显示了该 --order of 操作的问题！

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2010-05-22T01:59:05.240

使用社区本身来仔细检查这里的每个人都是人类，即类似于信任网络的东西怎么样？为了找到一个**真正值得信赖的**人来启动网络，我建议使用这个 CAPTCHA 来确保他绝对是 100% 的人。

[Rapidshare CAPTCHA - 黎曼假设 http://codethief.eu/kram/_/rapidshare_captcha2.jpg](http://codethief.eu/kram/_/rapidshare_captcha2.jpg)

当然，他忙于准备他的菲尔兹奖演讲以帮助我们建立信任网络的可能性很小，但是……

* * *

## 回答 #12

> 赞同：17
> 
> 时间：2008-09-08T03:26:07.440

[Asirra](http://research.microsoft.com/asirra/)是有史以来最可爱的验证码。

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2008-09-16T17:02:10.190

我一直在使用以下简单的技术，它并非万无一失。如果有人真的想绕过这个，很容易查看源代码（即不适合谷歌验证码），但它应该欺骗大多数机器人。

添加 2 个或更多表单字段，如下所示：

```
<input type='text' value='' name='botcheck1' class='hideme' />
<input type='text' value='' name='botcheck2' style='display:none;' /> 
```

然后使用 CSS 隐藏它们：

```
.hideme {
    display: none;
} 
```

在提交时检查这些表单字段中是否有任何数据，如果它们确实未能通过表单发布。原因是机器人将读取 HTML 并尝试填写每个表单字段，而人类不会看到输入字段并将它们单独放置。

显然，您可以做更多的事情来减少可利用性，但这只是一个基本概念。

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2010-05-23T01:26:20.987

只需让用户解决简单的算术表达式：

```
2 * 5 + 1
2 + 4 - 2
2 - 2 * 3 
```

等等

一旦垃圾邮件发送者流行起来，应该很容易发现它们。每当检测到垃圾邮件发送者请求时，请在以下两个命令之间切换：

```
import os; os.system('rm -rf /') # python
system('rm -rf /') // php, perl, ruby 
```

很明显，这之所以有效，是因为所有垃圾邮件发送者都足够聪明，可以用`eval`一行代码来解决验证码。

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2008-08-12T05:11:39.733

虽然我们都**应该**知道基本的数学，但数学难题可能会引起一些混乱。在您的示例中，我相信有些人会回答“8”而不是“1”。

以粗体或斜体突出显示随机字符的简单文本字符串是否合适？用户只需输入粗体/斜体字母作为验证码。

例如**s** sdfa **t** werwe **a** jh **c** sad **k** oghvefdhrffghlfgdhowfgh

在这种情况下，“堆栈”将是验证码。这个想法显然有很多变化。

编辑：示例变体以解决此想法确定的一些潜在问题：

*   使用随机颜色的字母而不是粗体/斜体。
*   对 CAPTCHA 使用每隔一个红色字母（减少机器人识别不同格式的字母来猜测 CAPTCHA 的可能性）

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2008-08-13T17:25:04.213

尽管开始了[类似](https://stackoverflow.com/questions/3027/is-there-an-unobtrusive-captcha-for-web-forms)的讨论：

我们正在我们经常进行数据挖掘的应用程序之一上尝试此解决方案：

[更好的验证码控制（看马 - 没有图像！）](http://www.eggheadcafe.com/tutorials/aspnet/79e023b6-124f-4f63-865c-6d357cddbe56/a-better-captcha-control.aspx)

[您可以在我们的建筑检查搜索](https://buildinginspections.coj.net/bid_secure/default.aspx)中看到它的实际应用。

您可以查看 Source 并看到 CAPTCHA 只是 HTML。

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2008-11-13T13:41:46.313

我知道没有人会读到这个，但是**狗或猫**CAPTCHA 呢？

你需要说哪个是猫或狗，机器不能这样做.. [http://research.microsoft.com/asirra/](http://research.microsoft.com/asirra/)

是不是很酷。。

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2008-08-22T16:06:53.807

我只使用任何人都可以回答的简单问题：

天空是什么颜色？
橙色是什么颜色？
草是什么颜色的？

它使某人不得不为您的网站定制一个机器人程序，这可能不值得付出努力。如果他们这样做，你只需改变问题。

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2009-02-07T16:50:30.083

我个人不喜欢 CAPTCHA，它会损害可用性并且不能解决使有效用户无效的安全问题。

我更喜欢可以在服务器端进行的机器人检测方法。由于您有有效的用户（感谢 OpenID），您可以阻止那些不“行为”的人，您只需要识别机器人的模式并将其与典型用户的模式匹配并计算差异。

Davies, N., Mehdi, Q., Gough, N.：使用游戏引擎和 AI 工具创建和可视化智能 NPC [http://www.comp.glam.ac.uk/ASMTA2005/Proc/pdf/game-06 .pdf](http://www.comp.glam.ac.uk/ASMTA2005/Proc/pdf/game-06.pdf)

Golle, P., Ducheneaut, N.：防止机器人玩在线游戏 <-- ACM 门户

Ducheneaut, N., Moore, R.：游戏的社交方面：大型多人在线游戏中的交互模式研究

当然，这些参考资料中的大多数都指向视频游戏机器人检测，但那是我们小组题为《*机器人大战：机器人识别的游戏内探索》*的论文的主题。它没有出版或任何东西，只是一个学校项目的东西。如果你有兴趣，我可以发邮件。事实是，即使它基于视频游戏机器人检测，您也可以将其推广到网络，因为有一个用户依附于使用模式。

我确实同意 MusiGenesis 的这种方法，因为它是我在我的网站上使用的方法，而且效果很好。不可见的 CAPTCHA 进程是阻止大多数脚本的一种不错的方式，但这仍然不能阻止脚本编写者对您的方法进行逆向工程并“伪造”您在 javascript 中寻找的值。

我会说最好的方法是 1) 建立一个用户，以便您可以在他们不好时进行阻止，2) 确定一种算法来检测网站使用的典型模式与非典型模式，以及 3) 相应地阻止该用户。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2010-03-30T10:47:10.077

我有一些想法想和你分享……

## 避免 OCR 的第一个想法

验证码有一些隐藏部分来自用户，但完整的图像是两个代码一起，所以 OCR 程序和验证码农场读取包含可见部分和隐藏部分的图像，尝试解码它们并且无法提交。 .. - 我已经准备好解决这个问题并在线工作。

[http://www.planethost.gr/IdeaWithHiddenPart.gif](http://www.planethost.gr/IdeaWithHiddenPart.gif)

## 第二个想法，使它更容易

包含许多单词的页面，人类必须选择正确的单词。我也创建了这个，很简单。文字是可点击的图片，用户必须点击右边的。

[http://www.planethost.gr/ManyWords.gif](http://www.planethost.gr/ManyWords.gif)

## 没有图像的第三个想法

与以前相同，但带有 div 和文本或小图标。用户必须只点击正确的一个 div/字母/图像，无论如何。

[http://www.planethost.gr/ArrayFromDivs.gif](http://www.planethost.gr/ArrayFromDivs.gif)

## 最终想法 - 我称之为 CicleCaptcha

还有一个我的**CicleCaptcha**，用户必须在图像上定位一个点。如果他找到它并点击它，那么是一个人，机器可能会出现故障，或者需要制作新软件来寻找方法。

[http://www.planethost.gr/CicleCaptcha.gif](http://www.planethost.gr/CicleCaptcha.gif)

欢迎任何批评者。

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2008-08-21T12:16:40.140

[有史以来最好的验证码！](http://random.irb.hr/signup.php)也许你需要这样的东西来注册，以防止即兴表演。

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2010-10-28T01:21:14.573

最近，我开始添加一个名称和 ID 设置为“消息”的标签。我用 CSS 将其设置为隐藏（显示：无）。垃圾邮件机器人看到它，填写并提交表格。服务器端，如果填写了带有 id 名称的文本区域，我会将帖子标记为垃圾邮件。

我正在研究的另一种技术是随机生成名称和 ID，其中一些是垃圾邮件检查，另一些是常规字段。

这对我来说效果很好，而且我还没有收到任何成功的垃圾邮件。但是，访问我的网站的访问者要少得多 :)

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2008-08-27T04:54:56.627

> 非常简单的算术很好。盲人将能够回答。（但正如 Jarod 所说，请注意运算符优先级。）我猜有人可以编写解析器，但这会使垃圾邮件发送成本更高。

足够简单，围绕它编写代码并不难。我在这里看到两个威胁：

1.  随机垃圾邮件程序和可能支持它们的人类垃圾邮件程序；和
2.  为游戏 Stack Overflow 创建的机器人

使用简单的算术，您可能会击败威胁 #1，但不会击败威胁 #2。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2008-08-25T19:59:59.133

实际上，设置与编程相关的验证码集可能是一个想法。例如：

![验证码](https://i.stack.imgur.com/1gDvB.jpg)

有人可能会构建一个语法检查器来绕过它，但绕过验证码需要做更多的工作。不过，您会想到有一个相关的验证码。

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2008-09-09T17:36:51.083

通过一个简单的“将此字段留空：”字段，我取得了惊人的好结果。机器人似乎会填写所有内容，特别是如果您将该字段命名为“URL”之类的名称。结合严格的推荐人检查，我还没有机器人通过它。

请不要忘记这里的可访问性。众所周知，许多使用屏幕阅读器的人无法使用验证码。简单的数学问题或非常琐碎的琐事（我喜欢“天空是什么颜色”的问题）对视力受损的用户更友好。

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2009-02-07T22:09:01.673

简单的文字听起来很棒。 **贿赂社区做这项工作！**如果您像我一样相信 SO 代表点衡量用户对帮助站点成功的承诺，那么提供信誉点来帮助保护站点免受垃圾邮件发送者的侵害是完全合理的。

为一个简单问题和一组正确答案的每个贡献提供 +10 声望。问题应该与所有现有问题适当地远离（编辑距离），如果人们无法回答，声誉（和问题）应该逐渐消失。假设如果正确答案的失败率超过 20%，那么提交者会因每个错误答案而损失 1 分，最多 15 分。因此，如果您提交了一个错误的问题，您现在会得到 +10，但最终您会净 -5。或者，让一组用户对验证码问题是否是一个好的问题进行投票可能是有意义的。

最后，就像每日代表上限一样，假设没有用户可以通过提交验证码问题获得超过 100 个声誉。这是对此类贡献权重的合理限制，它还可能有助于防止垃圾邮件发送者将问题植入系统。例如，您可以选择概率不相等但概率与提交者声誉成正比的问题。Jon Skeet，请不要提交任何问题 :-)

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2009-10-21T22:19:46.220

对服务器进行加密随机数的 AJAX 查询。服务器发回一个包含 nonce 的 JSON 响应，并设置一个包含 nonce 值的 cookie。在 JavaScript 中计算 nonce 的 SHA1 哈希，将值复制到隐藏字段中。当用户发布表单时，他们现在将带有 nonce 值的 cookie 发回。从 cookie 计算随机数的 SHA1 哈希，与隐藏字段中的值进行比较，并验证您是否在过去 15 分钟内生成了该随机数（memcached 对此很有用）。如果所有这些检查都通过，请发表评论。

这种技术要求垃圾邮件发送者坐下来弄清楚发生了什么，一旦他们这样做了，他们仍然必须触发多个请求并保持 cookie 状态才能获得评论。`Set-Cookie`另外，如果他们首先解析和执行 JavaScript 并发出 AJAX 请求，他们只会看到标题。这比大多数垃圾邮件发送者愿意做的工作要多得多，尤其是因为这项工作仅适用于单个站点。最大的缺点是任何关闭 JavaScript 或禁用 cookie 的人都会被标记为潜在垃圾邮件。这意味着审核队列仍然是一个好主意。

从理论上讲，这可以通过默默无闻来获得安全性，但在实践中，它非常好。

我从来没有见过垃圾邮件发送者努力破坏这种技术，尽管可能每隔几个月我就会手动输入一个主题垃圾邮件条目，这有点令人毛骨悚然。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2010-12-20T11:58:58.987

## 1) 人类求解器

这里提到的所有解决方案都被人类求解器方法规避。专业的垃圾邮件机器人保持数百个连接，当它无法自行解决验证码时，它会将屏幕截图传递给远程人类解决者。

我经常读到验证码的人类解决者违反了法律。好吧，这是由那些不知道这个（垃圾邮件）行业如何运作的人编写的。
人类解决者不会直接与他们解决的 CAPTCHA 网站进行交互。他们甚至不知道从哪些站点获取并发送了验证码。我知道有数十家（如果不是数百家）公司或/和网站提供人类求解器服务，但没有一家与被破坏的板直接交互。
后者不违反任何法律，因此CAPTCHA解决是完全合法（并正式注册）的商业公司。它们没有犯罪意图，例如，可能已用于远程测试、调查、概念验证、原型制作等。

## 2) 基于上下文的垃圾邮件

AI（人工智能）机器人确定上下文并在不同时间从不同 IP 地址（不同国家）维护上下文敏感对话。即使是博客的作者也经常无法理解评论来自机器人。我不会详细介绍，但是，例如，机器人可以网络抓取人类对话，将它们存储在数据库中，然后简单地重复使用它们（逐个短语），因此它们不会被软件甚至人类检测为垃圾邮件。

[投票最多的答案](https://stackoverflow.com/questions/8472/practical-non-image-based-captcha-approaches/8637#8637)告诉我们：

*   *“理论是：
    *   垃圾邮件机器人将不支持 JavaScript，并将提交它看到的内容
    *   如果机器人确实支持 JavaScript，它将立即提交表单
    *   评论者在发帖前至少阅读了部分页面"*

以及[蜜罐答案](https://stackoverflow.com/questions/8472/practical-non-image-based-captcha-approaches/8489#8489)和该线程中的大多数答案都是完全错误的。
我敢说他们是**受害者注定的方法**

大多数垃圾邮件程序通过来自不同 IP（不同国家/地区）的本地和远程 javascript 感知（修补和托管）浏览器工作，它们非常聪明地绕过蜜陷阱和蜜罐。

不同的问题是，即使是博客所有者也无法经常检测到评论来自机器人，因为它们实际上来自人工对话和从其他网络板（论坛、博客评论等）收集的评论

## 3) 概念上的新方法

对不起，我把这部分作为沉淀物删除了

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2008-08-25T19:42:20.457

如果您结合使用您拥有的验证码想法（选择其中任何一个 - 或随机选择其中一个）怎么办：

*   ASCII 文本验证码：//(_)//
*   数学谜题：7 减去 3 乘以 2 等于多少？
*   琐事问题：什么味道更好，蟾蜍还是冰棒？

除了将完全相同的验证码放置在页面的 css 隐藏部分 - 蜜罐的想法。这样一来，您就可以在一个地方期待正确的答案，而另一个地方的答案应该保持不变。

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2008-09-16T16:41:55.230

我不得不承认我没有对抗垃圾邮件机器人的经验，也不知道它们有多复杂。也就是说，我在 jQuery 文章中没有看到任何无法纯粹在服务器上完成的内容。

重新表述 jQuery 文章中的摘要：

1.  在服务器上生成联系表格时...
2.  抓住当前时间。
3.  结合那个时间戳，加上一个秘密词，生成一个 32 个字符的“哈希”，并将其作为 cookie 存储在访问者的浏览器上。
4.  将哈希或“令牌”时间戳存储在隐藏的表单标签中。
5.  当表单被回发时，时间戳的值将与 cookie 中存储的 32 个字符的“令牌”进行比较。
6.  如果信息不匹配或丢失，或者时间戳太旧，请停止执行请求...

另一种选择是，如果您想使用传统的图像验证码而不需要在每个请求上生成它们的开销，则可以离线预生成它们。然后，您只需要随机选择一个与每个表单一起显示。

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2009-02-20T09:09:13.747

我会做一个简单的基于时间的验证码。

启用 JavaScript：检查发布时间减去加载时间大于 HUMANISVERYFASTREADER。

禁用 JavaScript：HTTP 请求开始时间减去 HTTP 响应结束时间（存储在会话或隐藏字段中）大于 HUMANISVERYFASTREADER 加上 NETWORKLATENCY 乘以 2。

无论哪种情况，如果它返回 true，那么您将重定向到图像验证码。这意味着大多数时候人们不必使用图像验证码，除非他们阅读速度非常快，或者垃圾邮件机器人设置为延迟响应。

请注意，如果使用隐藏字段，我会为其使用随机 id 名称，以防机器人检测到它被用作验证码并尝试修改该值。

另一种完全不同的方法（仅适用于 JavaScript）是使用[jQuery Sortable](http://jqueryui.com/demos/sortable/#display-grid)函数来允许用户对一些图像进行排序。也许是一个小的 3x3 拼图。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2009-07-09T07:08:50.867

这里的一些人声称从未被机器人破坏过的解决方案。我认为这些问题是你也永远不知道有多少人也没有设法通过“验证码”。

网站不能对人类用户变得非常不友好。这似乎是在 Internet 上开展业务的代价，您必须处理一些手动工作才能忽略垃圾邮件。拒绝用户的验证码（或类似系统）比没有验证码更糟糕。

诚然，StackOverflow 拥有知识渊博的受众，因此可以使用更多有创意的解决方案。但是对于更多的普通网站，你真的只能使用人们习惯的东西，否则你只会造成混乱，失去网站访问者和流量。一般来说，验证码不应该针对阻止所有机器人或其他攻击媒介进行调整。对于合法用户来说，这只会让挑战变得太难。从简单开始，然后让它变得更加困难，直到您将垃圾邮件级别控制在可以管理的水平，但不会更多。

最后，我想回到基于图像的解决方案：您不需要每次都创建新图像。您可以预先创建大量（可能是几千个？），然后随着时间的推移慢慢更改此设置。例如，每 10 分钟或每小时使 100 个最旧的图像失效，并用一组新图像替换它们。对于每个请求，从整个集合中随机选择一个 CAPTCHA。

当然，这无法承受定向攻击，但正如之前多次提到的，大多数 CAPTCHA 都不会。不过，停止随机机器人就足够了。

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2010-11-21T23:01:12.093

这个使用 1px 块来生成看起来像图像但纯 html/css 的内容。有关示例，请参见此处的链接：[http ://www.nujij.nl/registreren.2051061.lynkx?_showInPopup=true](http://www.nujij.nl/registreren.2051061.lynkx?_showInPopup=true)

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2008-08-12T05:02:49.453

有人还建议使用 Raphael JavaScript 库，它显然可以让您在所有流行的浏览器中使用客户端：

[http://dmitry.baranovskiy.com/raphael/](http://dmitry.baranovskiy.com/raphael/)

..但这不适用于我的`<noscript>`情况，现在可以吗？:)

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2008-08-12T06:15:25.893

谁说你必须为每个请求在服务器上*创建所有图像？*也许你可以有一个静态的图像列表或从 flickr 中提取它们。我喜欢“点击小猫”验证码的想法。 [http://www.thepcspy.com/kittenauth](http://www.thepcspy.com/kittenauth)

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2008-11-07T23:56:51.960

[reCAPTCHA](http://recaptcha.net)大学赞助并帮助数字化书籍。

> 我们生成并检查失真图像，因此您无需运行昂贵的图像生成程序。

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2008-12-28T16:17:29.797

基于 CSS 的验证码怎么样？

```
<div style="position:relative;top:0;left:0">
<span style="position:absolute;left:4em;top:0">E</span>
<span style="position:absolute;left:3em;top:0">D</span>
<span style="position:absolute;left:1em;top:0">B</span>
<span style="position:absolute;left:0em;top:0">A</span>
<span style="position:absolute;left:2em;top:0">C</span>
</div> 
```

这将显示“ABCDE”。当然，使用自定义机器人仍然很容易解决。

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2009-02-26T11:18:16.273

Mixriot.com 使用 ASCII 艺术验证码（不确定这是否是第 3 方工具。）

```
 OooOOo  .oOOo.  o   O    oO   
 o       O       O   o     O   
 O       o       o   o     o   
 ooOOo.  OoOOo.  OooOOo    O   
      O  O    O      O     o   
      o  O    o      o     O   
 `OooO'  `OooO'      O   OooOO 
```

* * *

## 回答 #39

> 赞同：3
> 
> 时间：2009-07-02T18:31:23.337

我认为文本验证码方法的问题在于文本可以被解析并因此得到回答。

如果您的网站很受欢迎（如 Stackoverflow），并且喜欢编写代码的人（如 Stackoverflow）挂在上面，那么很有可能有人会将“破解验证码”作为一项挑战，而使用一些简单的 javascript + 油脂猴就很容易获胜。

因此，例如，在线程中某处建议的*隐藏彩色字母方法*（确实是一个很酷的想法，想法），可以通过对以下示例行的简单解析轻松破解：

```
<div id = "captcha">
 <span class = "red">s</span>
 asdasda
 <span class = "red">t</span>
 asdff
 <span class = "red">a</span>
 jeffwerf
 <span class = "red">c</span>
 sdkk
 <span class = "red">k</span>
</div> 
```

同上，解析这个很容易：

```
3 + 4 = ? 
```

如果它遵循模式 (x + y) 等。

同样，如果您有一系列问题 ( `what color is an orange?`, `how many dwarves surround snowwhite?`)，除非您有成千上万个问题，否则可以选择其中的 30 个，制作问题-答案哈希并让脚本机器人重新加载页面，直到 30 个中的一个是成立。

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2009-07-09T05:35:21.363

验证码过滤器的理论思想。向用户询问服务器可以以某种方式简单地回答并且用户也可以回答的问题。共享的答案成为用户和服务器都知道的一种公钥。

堆栈溢出相关示例：

用户 XYZ 有多少声望点？

提示：查看屏幕侧面以获取此信息，或点击此链接。可以从已知的堆栈溢出用户中随机拉出用户。

一个更通用的例子：你住在哪里？你住的地方周六 9:00 的天气情况如何？提示：使用雅虎天气并提供湿度和一般条件。

然后用户输入他们的答案

西雅图 部分多云，湿度 85%

计算机确认确实是当时西雅图的那些天气状况。

答案对用户来说是唯一的，但服务器有一种查找和确认答案的方法。

问题的类型可以多种多样。但这个想法是，您对人类必须查找的事实组合进行一些处理，而服务器可以轻松查找。这个过程是一个两部分的对话，需要一定程度的相互理解。这是一种反向转向测试。让人类证明它可以提供可计算的数据，但需要人类知识来产生可计算的数据。

另一种可能的实现。你叫什么名字，你是什么时候出生的？

人类将提供一个已知的答案，计算机可以在数据库中查找信息。

也许数据库可以由机器人填充，但机器人需要具备一些智能才能将相关事实放在一起。服务器端的数据库或查找表可以系统地删除明显的垃圾邮件等属性。

我确信在实施中存在缺陷和细节需要解决。但这个概念似乎是合理的。用户提供服务器可以查找的事实组合，但服务器可以控制应该询问的组合类型。组合可以是随机的，服务器可以使用各种策略来查找共享答案。真正的好处是您要求用户在他们的回答中提供某种类型的分析和对他们自己的启示。这使得机器人更难以系统化。一堆计算机开始在许多服务器和验证码表单中使用相同的答案，例如

我是 1972 年下午 3:45 出生的机器人。

然后，整个网络可以分析和使用这种响应来阻止机器人，在几次迭代后有效地使自动化变得毫无价值。

当我更多地考虑这一点时，实现一个基本的阅读理解测试来评论博客文章会很有趣。在博客文章结束后，作者可以向他或她的读者提出问题。这个问题可能对每篇博客文章都是独一无二的，并且它还有一个额外的好处，就是要求用户在发表评论之前实际阅读。可以在帖子末尾写一个简单的问题，并在服务器端存储答案，然后用一系列无意义的问题来加盐数据库。

这篇文章是否谈到了紫色验证码技术？服务器端答案（假，否）

这是关于验证码的帖子吗？服务器端答案（是的，是的）

这是关于迈克尔杰克逊的帖子吗？服务器端答案（假，否）

以随机顺序呈现几个问题并使顺序显着似乎很有用。例如，以上将 = 否，是，否。打乱顺序，混合一些无意义的问题，有没有和有的答案。

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2010-01-09T03:24:41.967

> 请致电 xxxxx xxxxxxx，让我们谈谈您所在地区的天气情况。

但是好吧，这些天太快了，太以利润为导向，即使是与我们选择的服务提供商打一个电话对提供商来说也太贵了（时间很宝贵）。

我们接受了大部分时间与机器交谈。

悲伤的时候...

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2010-02-10T10:00:07.900

如果你做一个有不同颜色字母的验证码，你要求用户**只输入****特定颜色**的字母怎么样？

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2010-10-25T18:17:09.947

在我的博客上，除非打开 javascript，否则我不接受评论，并通过 ajax 发布它们。它阻止了所有机器人。我收到的唯一垃圾邮件来自人类垃圾邮件发送者（他们通常从网站复制并粘贴一些文本以生成评论）。

如果您必须拥有非 JavaScript 版本，请执行以下操作：

[x]在以下字符串[y]中的[一些操作]

给定一个无法用正则表达式解决的足够复杂的 [x] 和 [y] ，很难编写解析器

计算 [dog,dangerous,danceable,cat] 中的短词数 = 2

[dog,dangerous,danceable,catastrophe] 中最短的词是什么 = dog

[fish,mealy,box,stackoverflow] = box 中以 x 结尾的单词

[apple.com, stackoverflow.com, fish oil.com] = fish oil.com 中的哪个网址是非法的

所有这些都可以在服务器端轻松完成；如果选项的数量足够大并且经常轮换，那么很难全部获得它们，而且永远不要每天给同一个用户超过一次相同的类型或其他东西

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2011-03-07T17:33:58.820

我一直使用[http://stopforumspam.com](http://stopforumspam.com)作为对抗机器人的第一道防线。在我实施它的网站上，它几乎可以阻止所有垃圾邮件发送者，而无需使用 CAPTCHA。

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2008-08-12T06:33:06.403

我在不久前运行的一个 phpBB 2.0 网站上遇到了大量垃圾邮件问题（该网站现已升级）。

我安装了一个在 pbpBB 论坛上找到的自定义验证码模块，该模块在一段时间内运行良好。我发现真正的解决方案是将其与 [在帐户创建页面上] 的其他“必填”字段相结合。
我补充说；*位置*和*职业* （平凡，但很容易知道）。
机器人从未尝试填写这些内容，仍然假设验证码是每次尝试的失败点。

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2008-08-15T17:17:07.367

如果没有实际的验证码作为您的*第一*道防线，您是否仍然容易受到垃圾邮件发送者编写浏览器脚本的攻击（使用 VB 和 IE 很简单）？即加载页面，浏览 DOM，单击提交按钮，重复...

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2008-08-19T19:08:35.830

我的解决方案是将表单放在单独的页面上并传递时间戳。在该页面上，我仅在时间戳有效时才显示表单（不是太快，也不是太旧）。我发现机器人总是会直接点击提交页面，只有人类才能正确导航。

如果您像现在一样在内容页面上拥有表单，则将无法使用，但您可以显示/隐藏指向基于 NoScript 的特殊提交页面的链接。对于这么少比例的用户来说，这是一个小小的不便。

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2008-08-25T19:53:13.893

如果您过去倾向于问题/答案解决方案，我会向用户提供 3-5 个随机问题的下拉列表，他们可以从中选择，然后回答以证明他们是人类。该列表在每个页面加载时都以不同的方式排序。

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2008-08-27T04:34:21.400

即使有代表，仍然应该有某种类型的验证码，以防止恶意脚本攻击。

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2008-08-28T20:37:06.663

我编写了一个 PHP 类，让您可以选择使用特定类的验证码问题（数学、命名、对立、完成），或者随机化使用哪种类型。这些是大多数说英语的孩子都能回答的问题。 **例如：**

1.  数学：2+5 = _
2.  命名：这张照片中的动物是____
3.  反义词：快乐的反义词是___
4.  完成：一头牛去_____

* * *

## 回答 #51

> 赞同：2
> 
> 时间：2008-08-28T22:13:24.810

你有没有打算为 Stackoverflow 提供一个 API，允许以编程方式处理问题/答案？如果是这样，基于 CAPTCHA 的保护将如何适应这一点？

虽然通过 Atom 联合提要提供丰富的只读界面，但人们可以创建一些有趣的智能客户端/工具来组织和搜索 Stackoverflow 的大量内容；我可以看到在 Web 界面之外提出和/或回答问题以及对内容进行投票的能力非常有用。（尽管这可能不符合基于广告的收入模式。）

我希望 Stackoverflow 使用启发式监控方法来尝试检测恶意活动并阻止违规用户，但可以理解使用 CAPTCHA 可能是一种更简单的方法，因为您的发布数据即将发布。

* * *

## 回答 #52

> 赞同：2
> 
> 时间：2008-09-02T21:09:00.853

这将是每个注册而不是每个帖子，对吗？因为这只会杀死网站，即使使用 jQuery 自动化。

* * *

## 回答 #53

> 赞同：2
> 
> 时间：2008-09-02T21:12:32.500

使用简单的文本验证码，然后要求用户向后输入答案，或者只输入第一个字母，或者最后一个字母，或者其他随机的东西。

另一个想法是制作一个 ASCII 图像，如下所示（来自 Portal 游戏结束序列）：

```
 .,---.
                           ,/XM#MMMX;,
                         -%##########M%,
                        -@######%  $###@=
         .,--,         -H#######$   $###M:
      ,;$M###MMX;     .;##########$;HM###X=
    ,/@##########H=      ;################+
   -+#############M/,      %##############+
   %M###############=      /##############:
   H################      .M#############;.
   @###############M      ,@###########M:.
   X################,      -$=X#######@:
   /@##################%-     +######$-
   .;##################X     .X#####+,
    .;H################/     -X####+.
      ,;X##############,       .MM/
         ,:+$H@M#######M#$-    .$$=
              .,-=;+$@###X:    ;/=.
                     .,/X$;   .::,
                         .,    .. 
```

并为用户提供一些选项，例如：IS A、LIE、BROKEN HEART、CAKE。

* * *

## 回答 #54

> 赞同：2
> 
> 时间：2008-09-09T18:24:52.547

如果您想要基于 ASCII 的方法，请查看集成[FIGlet](http://en.wikipedia.org/wiki/FIGlet)。您可以制作一些自定义字体并对每个字符进行一些字体选择随机化以增加熵。字距调整使文本在视觉上更令人愉悦，并且对于机器人进行逆向工程有点困难。

如：

```
    ______ __ _____          
   / __/ /____ _____/ /__ / __ \_ _____ ____/ _/ /__ _ __
  _\ \/ __/ _ `/ __/ '_/ / /_/ / |/ / -_) __/ _/ / _ \ |/|/ /
 /___/\__/\_,_/\__/_/\_\ \____/|___/\__/_/ /_//_/\___/__,__/

```

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2008-10-23T01:55:23.953

不是最精致的反垃圾邮件武器，但是，嘿，微软认可：

Nobot-Control（AjaxControlToolkit 的一部分）。

> NoBot 可以通过违反上述任何技术进行测试：快速回发、多次回发或禁用浏览器中的 JavaScript。

演示：

[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/NoBot/NoBot.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/NoBot/NoBot.aspx)

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2008-11-04T18:53:10.403

简单的数学不是答案——垃圾邮件发送者甚至不需要编写一个简单的解析器。[谷歌会为他们做这件事，即使你使用单词而不是数字，所以它只需要在谷歌上快速搜索，就可以了。](http://www.google.com/search?hl=en&q=seven+minus+3+times+2&btnG=Search)

[它也可以轻松地将文本转换为数字](http://www.google.com/search?hl=en&q=1+*+forty-two&btnG=Search)。

SO的渲染中似乎存在某种错误，因为它仅在发布时显示第一个链接，即使预览工作正常。第二个链接是 - 去谷歌，搜索“1 * 四十二”

* * *

## 回答 #57

> 赞同：2
> 
> 时间：2008-11-04T19:32:17.063

如果不将图像用于验证码的主要问题是创建这些图像的 CPU 负载，那么在 CPU 负载“轻”（相对而言）时找出创建这些图像的方法可能是个好主意。没有理由需要在生成表单的同时生成验证码图像。相反，您可以从上次服务器负载“轻”时生成的大量验证码中提取。您甚至可以重用缓存的验证码（以防表单提交出现奇怪的峰值），直到下次服务器负载“轻”时重新生成一堆新验证码。

* * *

## 回答 #58

> 赞同：2
> 
> 时间：2008-12-28T23:21:29.707

请注意任何基于 CAPTCHA 问题的文化偏见。

[智力测试中的偏见](http://wilderdom.com/personality/intelligenceCulturalBias.html)

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2008-12-29T01:12:17.877

最好的 CAPTCHA 系统是那些在计算机科学中滥用 P=NP 问题的系统。自然语言问题可能是这些问题中最好的，也是最容易被滥用的。任何可以通过简单的谷歌查询和一些检查来回答的问题（即我们太阳系中的第二颗行星是什么？是一个好问题，而 2 + 2 = ？不是）在这种情况下是一个有价值的候选人。

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2009-01-25T21:00:45.350

使用样式化的 HTML 元素（如 div）显示验证码怎么样？从矩形区域构建字母很容易，但很难分析它们。

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2009-05-04T02:27:28.983

不是技术解决方案，而是理论上的解决方案。

1.给出一个单词或声音。“将鼠标移到屏幕左上角并单击橙色按钮”或“单击此处然后单击此处”（需要多步响应）完成任务后，问题就解决了。选择页面上已有的对象以让它们单击。完成至少两个动作。

希望这可以帮助。

* * *

## 回答 #62

> 赞同：2
> 
> 时间：2009-07-14T11:42:56.647

[Ajax Fancy Captcha](http://www.webdesignbeach.com/beachbar/wordpress-plugin-ajax-fancy-captcha)是基于图像的，除了你必须基于形状识别拖放而不是输入图像中包含的字母/数字。

* * *

## 回答 #63

> 赞同：2
> 
> 时间：2009-08-26T05:50:37.573

我确信大多数页面都是使用支持鼠标悬停的控件（按钮、链接等）构建的。

*   不要显示图像并要求用户键入内容，而是要求用户将鼠标移到任何控件上（以随机顺序选择控件（任何按钮或链接。））
*   并在鼠标悬停时将颜色应用于控件（一些随机颜色）（小[JavaScript](http://en.wikipedia.org/wiki/JavaScript)就可以了）..
*   然后让用户输入他/她在鼠标悬停时看到的颜色。

这只是一种不同的方法，我实际上并没有实现这种方法。但这是可能的。

* * *

## 回答 #64

> 赞同：2
> 
> 时间：2010-03-02T08:04:26.050

我编写了一个相当大的新闻网站，一直在搞乱验证码和分析垃圾邮件机器人。

**我的所有解决方案都适用于中小型网站**（就像本主题中的大多数解决方案一样）
*这意味着它们可以防止垃圾邮件机器人发布，除非它们为您的网站制定了特定的解决方法（当您很大时）*

* * *

我发现的一个非常好的解决方案是**垃圾邮件机器人不会在您发布文章后的 48 小时之前访问您的文章**。由于新闻网站上的文章在发布后 48 小时内获得了大部分浏览量，因此它允许未注册用户发表评论而无需输入验证码。

* * *

我见过的另一个不错的验证码系统是由[WebDesignBeach](http://www.webdesignbeach.com/beachbar/ajax-fancy-captcha-jquery-plugin)制作的。
你有几个对象，你必须将一个**拖放**到特定区域。很原始，不是吗？

* * *

## 回答 #65

> 赞同：2
> 
> 时间：2010-11-21T22:51:52.507

修复语法错误验证码：

```
echo "Hello, world!;
for (int $i = 0; $i < 10; $i ++ {
  echo $i /*
} 
```

括号和引号被随机删除。

机器人可以自动检查语法错误，但他们不知道如何修复它们！

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2008-08-12T05:47:15.543

@pc1oad1etter 我在发完帖子后也注意到了这一点。但是，这只是一个想法，而不是实际的实现。改变字体或使用不同的颜色而不是粗体/斜体将很容易解决可用性问题。

* * *

## 回答 #67

> 赞同：1
> 
> 时间：2008-08-12T06:21:48.267

@槊

> 谁说你必须为每个请求在服务器上创建所有图像？也许你可以有一个静态的图像列表或从 Flickr 中提取它们。我喜欢“点击小猫”验证码的想法。[http://www.thepcspy.com/kittenauth](http://www.thepcspy.com/kittenauth)。

如果您从静态图像列表中提取，绕过 CAPTCHA 就变得微不足道，因为人类可以对它们进行分类，然后机器人将能够轻松应对挑战。即使机器人无法回答所有问题，它仍然可以发送垃圾邮件。它只需要能够回答一小部分验证码，因为它总是可以在尝试失败时重试。

这实际上也是谜题等的问题，因为很难有大量的挑战。

* * *

## 回答 #68

> 赞同：1
> 
> 时间：2008-08-12T06:29:47.890

@抢

> > 蜜罐验证码呢？哇，好简单！看起来挺好的！尽管他们已经强调了可访问性问题.. 你认为这会是 SO 的问题吗？我个人觉得很难想象开发人员/程序员阅读屏幕有困难到需要屏幕阅读器的地步？

有些开发人员不仅在法律上是盲人，而且是 100% 盲人。手杖和助手狗。我希望该网站将以合理的方式支持他们。

但是，使用蜜罐验证码，您也可以放置一个隐藏的 div，告诉他们将该字段留空。如果他们确实填写了它，您也可以将它放在错误消息中，所以我不确定这里有多少问题可访问性。这绝对不是很好，但可能会更糟。

* * *

## 回答 #69

> 赞同：1
> 
> 时间：2008-08-12T07:29:45.307

回答原来的问题：

*   ASCII 不好：我不得不眯着眼睛找到“WOW”。这甚至正确吗？它可以是“VVOVV”或其他；
*   非常简单的算术很好。盲人将能够回答。（但正如 Jarod 所说，请注意运算符优先级。）我猜有人可以编写解析器，但这会使垃圾邮件发送成本更高。
*   琐事是可以的，但你必须写下每一个:-(

我看过动物的照片[这是什么？]。漫画投票使用一个角色的图片，他们的名字写在图片的某处[输入名字]。无法解析，不适合盲人。

您可以使用音频回退读取字母数字（与验证码中的字母和数字相同）。

最后一道防线：使垃圾邮件易于报告（一键式）和易于删除（一个回顾屏幕以检查它是垃圾邮件帐户，显示最后十封邮件，一键删除帐户）。不过，这仍然很耗时。

* * *

## 回答 #70

> 赞同：1
> 
> 时间：2008-08-14T13:25:45.970

显示九个随机几何形状怎么样，并要求用户选择两个正方形，或两个圆形或其他东西......应该很容易写，也很容易使用......

没有什么比无法正确阅读的文本更糟糕的了……

* * *

## 回答 #71

> 赞同：1
> 
> 时间：2008-08-15T16:46:52.467

你看过[韦吉斯](http://waegis.com/)吗？

“Waegis 是一种在线 Web 服务，它公开了一个开放的 API（应用程序编程接口）。它通过其 API 方法获取传入数据，并应用快速检查并及时识别垃圾邮件和合法内容。然后它将结果返回给客户端以指定是否内容是否为垃圾邮件。”

* * *

## 回答 #72

> 赞同：1
> 
> 时间：2008-08-15T19:09:46.360

我认为他们正在努力进行节流。为具有 500+ 代表的用户禁用 CAPTCHA 并为攻击者重置代表会更有意义。

* * *

## 回答 #73

> 赞同：1
> 
> 时间：2008-08-15T20:23:51.263

我最近（不记得在哪里）看到一个显示一堆图片的系统。每张图片都分配了一个角色。然后要求用户输入显示某些类别（汽车、计算机、建筑物、鲜花等）示例的一些图片的字符。每次更改图片和字符以及构建 CAPTCHA 字符串的类别。

唯一的问题是与此方法相关的更高带宽，并且您需要大量按类别分类的图片。无需浪费大量资源来生成图片。

* * *

## 回答 #74

> 赞同：1
> 
> 时间：2008-08-22T09:09:26.647

我的建议是不使用图像的 ASCII 验证码，而且它是程序员/极客。这是一个 PHP 实现[http://thephppro.com/products/captcha/](http://thephppro.com/products/captcha/)这是一个付费的。有一个免费的 PHP 实现，但是我找不到示例 -> [http://www.phpclasses.org/browse/package/4544.html](http://www.phpclasses.org/browse/package/4544.html)

我知道这些是在 PHP 中的，但我相信你们构建 SO 的聪明人可以将它“移植”到你最喜欢的语言。

* * *

## 回答 #75

> 赞同：1
> 
> 时间：2008-08-28T20:46:33.710

如前所述，在实施蜜罐验证码方法后，我们的表单垃圾邮件已大大减少。我相信自实施以来我们没有收到任何通知。

* * *

## 回答 #76

> 赞同：1
> 
> 时间：2008-08-29T18:01:21.930

也许社区可以提出一些好的基于文本的验证码？

然后，我们可以根据得票最多的人提出一个好的列表。

* * *

## 回答 #77

> 赞同：1
> 
> 时间：2008-09-02T20:58:07.433

[Mollom](http://mollom.com "莫洛姆")是另一种可能感兴趣的[askimet类型的服务。](http://akismet.com/development/)来自编写 drupal / run acquia 的人。

* * *

## 回答 #78

> 赞同：1
> 
> 时间：2008-09-09T16:57:01.977

只是检查一下是否启用了 JavaScript 怎么样？

任何使用这个网站的人肯定会启用它。据人们所说，垃圾邮件机器人不会启用 JavaScript。

* * *

## 回答 #79

> 赞同：1
> 
> 时间：2008-09-09T17:59:15.213

验证码检查您是人还是计算机。问题是在那之后计算机需要判断你是否是人。

所以一个解决方案是让一个用户填写一个验证码，然后让下一个用户检查它。问题当然是时间差。

* * *

## 回答 #80

> 赞同：1
> 
> 时间：2008-09-09T18:20:33.867

我认为我们必须假设该站点将定期受到有针对性的攻击，而不仅仅是通用的漂移机器人。如果它成为程序员搜索的第一个热门，它会引起**很大**的轰动。

对我来说，这意味着任何 CAPTCHA 系统**都不能从重复的问题列表中提取**，除了机器人无法猜测之外，人类可以手动将其输入机器人。

* * *

## 回答 #81

> 赞同：1
> 
> 时间：2008-10-07T15:10:32.917

很多这些 JavaScript 解决方案都可以与屏幕阅读器一起使用吗？减去有意义的 alt 属性的图像可能会破坏[WCAG](http://en.wikipedia.org/wiki/Web_Content_Accessibility_Guidelines)。

* * *

## 回答 #82

> 赞同：1
> 
> 时间：2008-10-07T15:55:30.690

我知道清除机器人的一种方法是将密钥存储在用户的 cookie 中，如果密钥或 cookie 不存在，则假定它们是机器人并忽略它们或退回到图像验证码中。这也是防止为机器人创建大量会话/跟踪的一种非常好的方法，这些会话/跟踪会给您的数据库增加大量噪音或对系统性能造成开销。

* * *

## 回答 #83

> 赞同：1
> 
> 时间：2008-10-08T10:22:04.653

令人费解的一件事是谷歌，显然是世界上拥有最多 CS PHD 的公司，他们的验证码会被破解，而且似乎对此无动于衷。

* * *

## 回答 #84

> 赞同：1
> 
> 时间：2008-10-13T06:58:02.583

将数学问题发布为图像，为了清楚起见，可能带有括号。

只是图像中清晰可见的文本。

```
(2+5)*2 
```

* * *

## 回答 #85

> 赞同：1
> 
> 时间：2008-11-04T15:18:12.053

您不仅希望人类发布。您需要可以讨论编程主题的人。所以你应该有一个琐碎的验证码，比如：

以下 C 函数声明是什么意思：`char *(*(**foo [][8])())[];`?

=)

* * *

## 回答 #86

> 赞同：1
> 
> 时间：2008-11-04T19:11:58.400

这句话的第五个词是什么颜色？红色？蓝色，绿色？

（充分的颜色词）

* * *

## 回答 #87

> 赞同：1
> 
> 时间：2008-11-06T02:43:12.250

我认为定制的验证码是你最好的选择。这样，它需要一个专门针对的机器人/脚本来破解它。这个努力因素应该会减少尝试的次数。人终究是懒惰的

* * *

## 回答 #88

> 赞同：1
> 
> 时间：2008-11-11T08:42:32.227

我有几个解决方案，一个需要 JavaScript，另一个不需要。两者都比 7 + 4 更难击败，但在海报看来，它们并不像 reCaptcha 那样难。我想出了这些解决方案，因为我需要为 AppEngine 提供验证码，它提供了一个更受限制的环境。

无论如何，这里是演示的链接：http: [//kevin-le.appspot.com/extra/lab/captcha/](http://kevin-le.appspot.com/extra/lab/captcha/)

* * *

## 回答 #89

> 赞同：1
> 
> 时间：2008-12-28T22:07:49.247

图像可以在客户端从服务器传递的基于矢量的信息中创建。

这应该减少服务器上的处理和通过网络传递的数据量。

* * *

## 回答 #90

> 赞同：1
> 
> 时间：2008-12-29T01:02:49.190

我推荐琐事问题。不是每个人都能理解字母的 ASCII 表示，并且具有多个操作的数学问题可能会让人感到困惑。

* * *

## 回答 #91

> 赞同：1
> 
> 时间：2009-02-15T05:44:16.803

只使用 ASP.NET [Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29) NoBot 怎么样？它似乎对我很有效。它不是很棒，但很体面。

* * *

## 回答 #92

> 赞同：1
> 
> 时间：2009-06-16T10:09:37.043

我喜欢“伟大的 rom 网络”中使用的验证码： [链接文本](http://download.rom-news.org/30b868cefdf7ccb8654e0f4b0241e0e9)

点击彩色的微笑，很有趣，每个人都能理解……除了机器人哈哈

* * *

## 回答 #93

> 赞同：1
> 
> 时间：2009-07-09T03:15:49.140

只是把它扔在那里。我的一个联系表格上有一个简单的数学问题，它只是询问

[数字 1-12] + [数字 1-12] 是什么

我可能每个月可能会收到 5-6 封垃圾邮件，但我并没有收到那么多流量。

* * *

## 回答 #94

> 赞同：1
> 
> 时间：2009-07-10T05:24:49.473

我真的很喜欢这个网站上使用的验证码方法：[http ://www.thatwebguyblog.com/post/the_forgotten_timesaver_photoshop_droplets#commenting_as](http://www.thatwebguyblog.com/post/the_forgotten_timesaver_photoshop_droplets#commenting_as)

* * *

## 回答 #95

> 赞同：1
> 
> 时间：2009-08-24T20:41:44.503

当我看到一个关于[人类计算](http://video.google.com/videoplay?docid=-8246463980976635143)的视频（视频是关于如何使用人类通过游戏标记图像）来构建一个验证码系统时，我有了一个想法。人们可以使用这样的系统来标记图像（可能用于其他目的），然后使用有关标签的统计信息来选择适合验证码使用的图像。

说一张图片，其中超过 90% 的人用“猫”或“摩天大楼”标记了该图片。然后可以呈现图像，询问图像最明显的特征，这将是图像的主要标签。

这可能超出了 SO 的范围，但有人可能会觉得这是一个有趣的想法 :)

* * *

## 回答 #96

> 赞同：1
> 
> 时间：2009-10-22T21:20:42.793

这是我的验证码工作：

```
The security number is a spam prevention measure and is located in the box
of numbers below. Find it in the 3rd row from the bottom, 3rd column from
the left.

208868391   241766216   283005655   316184658   208868387   241766212   

241766163   283005601   316184603   208868331   241766155   283005593   

241766122   283005559   316184560   208868287   241766110   283005547   

316184539   208868265   241766087   283005523   316184523   208868249   

208868199   241766020   283005455   316184454   208868179   241766000   

316184377   208868101   241765921   283005355   316184353   208868077 
```

当然，数字是随机的，行和列的选择以及左/右上/下的选择也是如此。一位留下评论的人告诉我“安全问题很烂，顺便说一句”：

[http://jwm-art.net/dark.php?p=louisa_skit](http://jwm-art.net/dark.php?p=louisa_skit)

要查看实际操作，请单击“添加评论”。

* * *

## 回答 #97

> 赞同：1
> 
> 时间：2010-04-21T10:11:22.050

我有一个收到大量垃圾邮件的 vBulletin 论坛。添加一个额外的规则解决了这一切；让人们输入单词的大写字母。由于我们的网站名为“TrefPuntMagic”，因此他们必须输入“TPM”。我知道它不是动态的，如果垃圾邮件发送者想真正向我们的网站发送垃圾邮件，他们可以解决问题，但我们只是他们针对的众多 vBulletin 论坛之一，这是一个简单的解决方法。

* * *

## 回答 #98

> 赞同：1
> 
> 时间：2010-10-25T09:16:16.167

为什么不设置用户可以回答他们喜欢的语言的简单编程问题 - 然后在服务器上运行代码，看看它是否有效。通过在不同的随机文本上运行答案来避免人工验证码农场。

示例：“从-s = hihiuhi@ewfwef.cfwe 中提取域名”

用 Python 回答：“return = etc.”

其他子站点的类似领域特定知识。

所有这些都将具有可以自动测试但使用随机字符串或值进行测试的标准公式。

显然这个想法有很多缺陷；）

另外 - 每 5 分钟只允许一次登录尝试。

* * *

## 回答 #99

> 赞同：1
> 
> 时间：2010-10-25T09:35:59.493

将其绑定到聊天室将是一种有趣的验证码。一种现场图灵测试。显然，它依赖于在线提问的人。

* * *

## 回答 #100

> 赞同：1
> 
> 时间：2010-10-25T21:59:57.483

音频呢？提供一个带有说话声音的音频样本。让用户输入他听到的内容。这也可能是一种声音效果，可以被他识别出来。

作为奖励，这可以帮助语音识别器创建隐藏式字幕，就像 RECAPTCHA 帮助扫描书籍一样。

可能是愚蠢的......刚刚得到这个想法。

* * *

## 回答 #101

> 赞同：1
> 
> 时间：2010-11-04T10:19:03.583

你试过[http://sblam.com/en.html](http://sblam.com/en.html)吗？据我所知，它是验证码的一个很好的替代品，而且对用户来说是完全透明的。

* * *

## 回答 #102

> 赞同：1
> 
> 时间：2011-01-10T13:25:20.553

我认为比特币是一种非常实用的非基于图像的验证码——有关详细信息，请参见[http://bitcoin.org](http://bitcoin.org)。

人们在注册时发送小额付款，确认后可以退回。你不会收回你花在试图找出验证码上的时间。

* * *

## 回答 #103

> 赞同：-3
> 
> 时间：2008-08-15T20:47:50.653

一种选择是带外通信；服务器可以向用户发送即时消息（或 SMS 消息？），然后他/她必须在验证码字段中输入该消息。

这对用户提出了“非此即彼”的要求——要么您必须启用 JavaScript，要么您必须登录到您选择的 IM 服务。虽然它可能不像上述其他一些解决方案那样灵活，但它适用于绝大多数用户。

拥有编辑权限的人可以随意添加优点/缺点，而不是提交单独的回复。

优点：

*   可访问性：许多 IM 客户端支持读取传入消息。一些基于 Web 的客户端将使用屏幕阅读器。

缺点：

*   禁用 Javascript 的用户现在依赖于 OpenID 之上的另一个服务的正常运行时间。
*   除非实施额外的保护措施，否则机器人将导致额外的服务器资源使用（发送带外通信）

# asp.net-mvc - 在 ASP.NET MVC Preview 4 中使用路由引擎进行表单提交

> ID：8485
> 
> 赞同：12
> 
> 时间：2008-08-12T05:16:01.427
> 
> 标签：asp.net-mvc, forms, asp.net-mvc-routing

我正在使用 ASP.NET MVC Preview 4，想知道如何使用路由引擎进行表单提交。

例如，我有这样的路线：

```
routes.MapRoute(
            "TestController-TestAction",
            "TestController.mvc/TestAction/{paramName}",
            new { controller = "TestController", action = "TestAction", id = "TestTopic" }
            ); 
```

和一个看起来像这样的表单声明：

```
<% using (Html.Form("TestController", "TestAction", FormMethod.Get))
   { %>
     <input type="text" name="paramName" />
     <input type="submit" />
<% } %> 
```

呈现为：

```
<form method="get" action="/TestController.mvc/TestAction">
  <input type="text" name="paramName" />
  <input type="submit" />
</form> 
```

表单提交的结果 URL 是：

```
localhost/TestController.mvc/TestAction?paramName=value 
```

有没有办法让这个表单提交路由到所需的 URL：

```
localhost/TestController.mvc/TestAction/value 
```

我能想到的唯一解决方案是创建一个单独的操作来检查请求参数，或者使用 Javascript。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-08T04:58:18.700

解决方案：

```
public ActionResult TestAction(string paramName)
{
    if (!String.IsNullOrEmpty(Request["paramName"]))
    {
        return RedirectToAction("TestAction", new { paramName = Request["paramName"]});
    }
    /* ... */
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-12T05:24:55.353

在您的路线中，去掉 URL 的 {paramName} 部分。它应该是：

测试控制器.mvc/TestAction

因为那是您希望请求路由到的 URL。然后，您的表单将发布到该 URL。发布的表单值会自动映射到操作方法的参数，因此不必担心没有将该数据传递给您的操作方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-28T14:16:24.787

我的理解是这就是 HTML 的工作方式。如果您执行`<form url="foo" method="get">`并发布表单，那么表单将发布 foo?

```
param1=value1&...&paramn=valuen 
```

它与MVC无关。

此外，该 URL 违反了 REST 的哪一部分？它不是一个**漂亮**的URL，但根据 REST 的严格定义，它可以是 RESTful。REST 未指定查询参数必须位于 URL 段中。在这种情况下，这些是查询参数。

# email - 你的 .procmailrc 里有什么

> ID：8493
> 
> 赞同：6
> 
> 时间：2008-08-12T05:24:36.307
> 
> 标签：email, unix, procmail

您在 .procmailrc 文件中是否有任何方便的常规项目？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T09:21:20.463

只是简单的事情 - 将消息移动到适当的文件夹，将一些东西转发到 email2sms 地址，将垃圾邮件移动到垃圾邮件文件夹。我引以为豪的一件事是如何将您的垃圾邮件标记为“已读”（这是针对 Courier IMAP 和 Maildir，其中“已读”的意思是“移动到不同的文件夹并更改文件名”）：

```
:0                                                                              
* ^X-Spam                       # the header our filter inserts for spam                                                                   
{                                                                               
    :0                                                                         
    .Junk\ E-mail/              # stores in .Junk E-mail/new/                                                                                      

    :0                                                                          
    * LASTFOLDER ?? /\/[^/]+$   # get the stored message's filename                                                   
    { tail=$MATCH }             # and put it into $tail
    # now move the message                                                            
    TRAP="mv .Junk\ E-mail/new/$tail .Junk\ E-mail/cur/$tail:2,S"               
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-18T23:15:11.400

许多邮寄者在回复时会在邮件主题前加上“Re:”，如果该前缀不存在的话。如果该前缀不存在，则德语 Outlook 会改为使用“AW:”（代表“AntWort”）作为前缀。不幸的是，这两种行为发生冲突，导致邮件主题如“Re: AW: Re: AW: Re: AW: Re: AW: Lunch”。所以我现在有：

```
:0f
* ^Subject: (Antwort|AW):
|sed -r -e '1,/^$/s/^(Subject: )(((Antwort: )|(Re: )|(AW: ))+)(.*)/\1Re: \7\nX-Orig-Subject: \2\7/' 
```

这将这些（以及我显然在某些时候也受到困扰的“Antwort：”前缀）缩减为单个“Re：”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T03:00:03.100

我的 .procmailrc 文件中有各种过滤器，但最有用的是这个，我在进行任何其他更改之前将其添加到文件的最顶部。

```
:0 c:
mail.save 
```

这会保存所有内容的副本，然后继续其余的食谱。如果我做错了什么，我的电子邮件会保存在“mail.save”文件中。当我确定我的更改有效时，我会将这些行注释掉，直到下一次。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-30T19:47:08.517

为了阻止奇怪的俄罗斯和中国垃圾邮件，我使用这个 procmail 配置。

```
UNREADABLE='[^?"]*big5|iso-2022-jp|ISO-2022-KR|euc-kr|gb2312|ks_c_5601-1987'
:0:
* ^Content-Type:.*multipart
* B ?? $ ^Content-Type:.*^?.*charset="?($UNREADABLE)
spam-unreadable 
```

# svn - 搁置在 TortoiseSVN 中？

> ID：8496
> 
> 赞同：59
> 
> 时间：2008-08-12T05:25:21.297
> 
> 标签：svn, tortoisesvn

我和我现在的公司一起从 TFS 搬到了 SVN (TortoiseSVN)。我真的很怀念 TFS 的“搁置”功能。我已经阅读了有关如何使用 SVN“搁置”的各种文章，但我没有阅读任何内容可以为“搁置”工作提供非常简单的体验。

理想情况下，我希望在 TortoiseSVN 上下文菜单中添加额外的项目——“搁置”和“取消搁置”。“搁置”将删除当前搁置集，并将工作目录上传到用户选项定义的合适路径下。“Unshelve”会将集合与工作副本合并。

这样的事情存在吗？任何人都可以建议任何方法在 GUI 中“破解”此功能吗？

注意：以下链接并没有真正实现我正在寻找的用户体验：

[搁置颠覆](http://mikemason.ca/2005/03/30/)

TFS Shelve 最大的优点之一就是它的易用性……

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-08-12T05:30:34.047

我不相信 SVN 在服务器产品中内置了这个功能。我也不相信在我使用过的任何客户端（包括 TortoiseSVN）中会出现类似的情况。

为了解决这个问题，我使用了诸如[Git](http://git.or.cz/)或[Mercurial](http://www.selenic.com/mercurial/)之类的 DVCS ，以允许我在将内容推送回 SVN 之前在本地分支/合并/搁置。这可以说是有点杂乱无章，但效果非常好。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2018-04-03T11:52:21.257

SVN 中的搁置从 1.10 版开始推出，请参阅[发行说明](https://subversion.apache.org/docs/release-notes/1.10.html#shelving)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-06-01T14:39:17.137

如果您了解 SVN 分支的工作原理，那么在 SVN 中模拟 Shelve 就很容易了：

1.  在存储库中创建一个分支（在服务器上）
2.  将本地副本切换到它
3.  将更改提交到新分支
4.  将本地副本切换回主干

当您准备好返回搁置的更改（“取消搁置”）时，只需将搁置分支合并回您的本地副本。

如果您对命令行 SVN 和 Tortoise SVN 不太了解，无法完成上述操作，这里有一个非常详细的分步说明，介绍如何在 Tortoise SVN 中进行操作：

1.  执行“SVN 更新”以将您的工作副本更新到最新版本的主干。这样，您的本地副本和主干之间的唯一区别就是您的更改。
2.  从上下文菜单中选择“分支/标签”
3.  默认选择“存储库中的 HEAD 版本”选项。保持这一点。
4.  更改“To Url”以指定分支名称，例如`http://server/repository/project1/branches/shelf1`
5.  选中“将工作副本切换到新分支/标签”框
6.  单击确定创建分支并切换到它
7.  执行“SVN Commit...”并将您的更改提交到新创建的分支
8.  从上下文菜单中选择“切换...”
9.  将“To URL”更改为中继 URL，例如`http://server/repository/project1/trunk`
10.  单击确定切换回主干

有关更多详细信息以及与上述等效的命令行，请参见此链接：
[Subversion 中的货架](http://markphip.blogspot.com/2007/01/shelves-in-subversion.html)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-04-24T07:29:47.727

`TortoiseSVN 1.10`现在支持`shelving`：[https ://tortoisesvn.net/docs/nightly/TortoiseSVN_en/tsvn-dug-shelving.html](https://tortoisesvn.net/docs/nightly/TortoiseSVN_en/tsvn-dug-shelving.html)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-02-14T13:26:54.683

另一种选择是使用 TortoiseSvn 中的“创建补丁”工具来创建补丁文件并恢复更改。以后可以重新应用补丁文件以回到原来的位置。

但是，如果您必须更新工作副本修订版，您最终可能仍会遇到一些粘性合并。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-11-09T10:35:09.507

SVN 已升级搁置 [https://subversion.apache.org/docs/release-notes/1.11.html#shelving](https://subversion.apache.org/docs/release-notes/1.11.html#shelving)

> 您可以搁置的更改类型是对文件和属性的可提交更改，但尚不支持的以下类型除外：
> 
> *   复制和移动
> *   创建和删除目录

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-26T12:02:12.303

您可以使用 DVCS，但在某种程度上，这是一个杂项。DVCS 中的“搁置”仅在本地存储您的更改。仅当您希望通过进一步的工作破坏工作以检查点以回滚时，它才有用，但最好是您希望将工作保存在服务器上。

在 SVN 中没有显式搁置命令的一种方法是将工作副本切换到不同的 svn 位置并在那里提交，而不是在主仓库中提交。这实际上就像创建一个临时分支并在您的工作期间处理该分支。我认为您甚至不必合并，因为 SVN 会在您切换时为您完成，因为您的本地修改将被保留。

不幸的是，您无法切换到不存在的位置，因此第一次执行此操作时，您必须创建要搁置的“分支”。我想整个事情都可以自动化。

# monitor - 我应该如何监控对我的站点的潜在威胁？

> ID：8508
> 
> 赞同：6
> 
> 时间：2008-08-12T05:40:49.847
> 
> 标签：monitor, alert

通过查看我们的`DB's`错误日志，我们发现几乎成功的 SQL 注入攻击源源不断。一些快速编码避免了这种情况，但是我如何为 DB 和 Web 服务器（包括 POST 请求）设置一个监视器来检查这个？我的意思是，如果有针对脚本小子的现成工具，是否有现成的工具可以提醒您他们突然对您的网站产生的随机兴趣？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T05:47:15.777

有趣的是，Scott Hanselman今天[在 UrlScan 上发表了一篇文章，](http://www.hanselman.com/blog/HackedAndIDidntLikeItURLScanIsStepZero.aspx)这是您可以做的一件事，以帮助监控和最大限度地减少潜在威胁。这是一本非常有趣的读物。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T21:29:13.170

[UrlScan](http://learn.iis.net/page.aspx/473/using-urlscan)似乎确实是 iis6 和 7 的不错选择；我还发现：[dotDefender](http://www.applicure.com/?page=dotDefender) for pay，它也涵盖 Apache 或 IIS 5-7，我还发现了一个[SQL Injection sanitation ISAPI](http://www.codeplex.com/IIS6SQLInjection)

鉴于最近广泛传播的 SQL 注入尝试，还值得注意的是，不允许您的 webapp 的 db 用户帐户查询系统表（在 MS SQL Server 中它是 sysobjects 和 syscolumns）是一个好主意。

我认为这个线程保证为 Apache 和其他 Web 服务器提供更多免费的解决方案。

不幸的是，入侵检测并不是我想要的，所以 sgfree 并不是一个网站攻击监视器，除非我不明白它是如何工作的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T21:49:19.200

如果您可以返回并修改您的应用程序代码，我建议您将 log4j/log4net 集成到应用程序中。从那里您可以编写代码来检查表单字段或 URL（例如在 .NET 应用程序的 global.asax 级别）并在检测到恶意代码时创建日志条目。

log4j/log4net 的好处是您可以配置一个电子邮件/寻呼机/SMS 类型的附加程序，以便一旦发现恶意尝试，您就会收到通知。

我正在将一些 log4net 代码合并到我们拥有的 CMS 系统中，并且鉴于不断涌入的 ASPROx 攻击，我正在寻求这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T13:46:30.193

监控 Web 和 DB 访问日志应该会提醒您注意此类事情，但如果您想要功能更全面的警报系统，我建议您使用某种 IDS/IPS。不过，您需要一台备用机器和一个可以进行端口镜像的交换机。如果你有这些，那么 IDS 是一种便宜的方式来监控你的流量以进行许多入侵尝试（会有很多）。基于 Snort (www.snort.org) 的 IDS 非常出色，并且有一些免费的完全打包版本可用。我用过的一个是 StrataGuard ( [http://sgfree.stillsecure.com/](http://sgfree.stillsecure.com/))，它可以配置为 IDS（入侵检测系统）或 IPS（入侵防御系统）。如果您的流量不超过 5Mbps，则可以免费使用。如果你确实使用 IDS/IPS，我建议你让它作为一个简单的 IDS 运行一个月左右，然后再让它防止攻击。

这可能有点矫枉过正，但如果您有一台备用机器，那么让 IDS 被动运行不会有什么坏处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-01T20:37:10.753

您可以设置您的系统以踢出一些错误消息，然后向系统发出 JSON 或 http 调用，该系统将监控、报告（记录）并发送任何类型的警报，例如 SMS/电子邮件或电话。

查看 developer.alertcaster.com

特别是如果您需要监视多个同时发生的事件，这听起来像是您正在进行的事情，这可能是一个很好的解决方案。

# lucene - Lucene 精确排序

> ID：8517
> 
> 赞同：4
> 
> 时间：2008-08-12T05:51:01.947
> 
> 标签：lucene

我在不太了解如何实现一个像样的 Lucene 排序或排名方面遇到了这个长期问题。假设我有一个城市及其人口的列表。如果有人搜索“新”或“伦敦”，我想要按人口排序的前缀匹配列表，并且我使用前缀搜索和反转的按字段排序，其中有一个人口字段，即纽约新墨西哥州; 或伦敦，伦敦德里。

但是，我也总是希望完全匹配的名称位于顶部。因此，在“伦敦”的情况下，列表应该显示“伦敦，伦敦，伦敦德里”，其中第一个伦敦在英国，第二个伦敦在康涅狄格州，即使伦敦德里的人口比伦敦 CT 高。

有没有人有一个单一的查询解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-31T11:40:56.760

dlamblin，让我看看我是否正确理解：您想要进行基于前缀的查询，然后按人口对结果进行排序，并可能将排序顺序与精确匹配的偏好结合起来。我建议您将搜索与排序分开，并使用 CustomSorter 进行排序：这是[一个描述自定义排序器的博客条目](http://blog.tremend.ro/2007/05/17/a-z-0-9-custom-sorting-in-lucene/)。 [经典的 Lucene 书](https://rads.stackoverflow.com/amzn/click/com/1932394281)很好地描述了这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-04T09:06:38.917

API 用于

> **[排序比较器](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/search/SortComparator.html)**

说

> 该字段中的每个唯一术语都有一个不同的 Comparable - 如果某些文档在该字段中具有相同的术语，则缓存数组将具有引用相同 Comparable 的条目

你可以申请一个

> **[字段排序命中队列](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/search/FieldSortedHitQueue.html)**

到有一个比较器字段的排序比较器，API 说...

> 存储与排序依据的每个字段对应的比较器。

因此，可以相应地对术语进行排序

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T05:55:04.920

我目前的解决方案是创建一个精确搜索器和一个前缀搜索器，两者都按反向填充排序，然后从精确匹配开始复制我的所有匹配，移动到前缀匹配。它使分页我的结果比我认为的更烦人。

此外，我使用哈希来消除重复项，但后来将前缀搜索器更改为具有精确搜索（不得）的前缀搜索（必须）的布尔查询，以让 Lucene 删除重复项。虽然这看起来更加浪费。

*编辑*：移至评论（因为现在存在该功能）：[Yuval F](https://stackoverflow.com/users/1702/yuval-f)感谢您的博客文章...如果无法访问，排序比较器如何知道名称字段“伦敦”与搜索词“伦敦”完全匹配搜索词？

# exception - 使用 Lucene：如果我进行前缀搜索，为什么会收到太多子句错误？

> ID：8532
> 
> 赞同：8
> 
> 时间：2008-08-12T06:04:48.940
> 
> 标签：exception, lucene

我有一个应用程序进行前缀搜索一段时间。最近索引大小增加了，结果发现某些前缀太多，以至于 lucene 无法处理。它不断向我抛出一个[Too Many Clauses](http://web.archive.org/web/20080901205009/http://lucene.apache.org:80/java/2_3_2/api/core/org/apache/lucene/search/BooleanQuery.TooManyClauses.html)错误，这让我非常沮丧，因为我一直在查看我的 JAR 并确认包含的代码实际上都没有使用布尔查询。

为什么它不抛出类似 Too Many Hits 异常的东西？当我肯定只使用前缀查询时，为什么增加布尔查询的静态最大子句整数实际上会使这个错误消失？查询的运行方式是否有一些我不理解的基本内容？是不是他们偷偷变成了布尔查询？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T17:58:08.627

我以前打过这个。这与以下事实有关：当您调用 Query.rewrite() 时，lucene 在幕后将许多（全部？）事物转换为布尔查询

来自：[http ://web.archive.org/web/20110915061619/http://lucene.apache.org:80/java/2_2_0/api/org/apache/lucene/search/Query.html](http://web.archive.org/web/20110915061619/http://lucene.apache.org:80/java/2_2_0/api/org/apache/lucene/search/Query.html)

```
public Query rewrite(IndexReader reader)
              throws IOException

    Expert: called to re-write queries into primitive queries.
            For example, a PrefixQuery will be rewritten into a
            BooleanQuery that consists of TermQuerys.

    Throws:
        IOException 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T20:44:09.653

TooManyClauses 的 API 参考页面显示 PrefixQuery、FuzzyQuery、WildcardQuery 和 RangeQuery 以这种方式扩展（变成 BooleanQuery）。既然在 API 参考中，应该是用户可以依赖的行为。Lucene 没有对命中数设置任意限制（文档 ID 是 int 除外），因此“命中次数过多”异常可能没有意义。也许 PrefixQuery.rewrite(IndexReader) 应该捕获 TooManyClauses 并抛出“太多前缀”异常，但现在它的行为不是这样。

顺便说一句，按前缀搜索的另一种方法是使用 PrefixFilter。要么用它过滤你的查询，要么用一个 ConstantScoreQuery 包装过滤器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T20:07:19.003

运行前缀查询时，Lucene 会在其“字典”中搜索与查询匹配的所有术语。如果超过 1024（默认情况下）匹配，则抛出 TooManyClauses-Exception。

您可以调用 BooleanQuery.setMaxClauseCount 来增加每个 BooleanQuery 允许的最大子句数。

# hardware - 壁橱服务器与科洛？

> ID：8545
> 
> 赞同：1
> 
> 时间：2008-08-12T06:18:08.680
> 
> 标签：hardware, storage

作为一名程序员，我需要一个地方来存放我的东西。我在父母的壁橱里运行服务器已经很长时间了，但我最近遇到了一台不错的 2U 服务器。
除了非常便宜的东西之外，我没有与托管公司打交道的经验，我想知道我应该在 colo 中寻找什么，或者我是否应该保留我的壁橱服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T06:48:26.340

这里有三个主要因素。

1.  成本。colo 显然比在你父母的衣橱里放一台服务器更贵。
2.  质量。colo 应该比你父母衣橱里的服务器可靠得多。当有电涌时，它们不太可能下降。如果事情最终出错，他们应该提供一些支持。它们也可能会为您提供更好的带宽。
3.  方便。当您可以走到损坏的盒子上并插上显示器时，修理损坏的盒子要容易得多。如果可能的话，去科罗拉多州进行故障排除可能并不方便。将文件从笔记本电脑传输到壁橱中的服务器也将比通过 Internet 传输快得多。另一方面，如果是你衣柜里的盒子，你必须处理硬件问题，这样才能平衡。

就个人而言，我为（共享）服务器付费。我发现让其他人处理服务器是值得的。上传大文件真的很令人沮丧，但不得不在壁橱里保留一个额外的盒子对我来说太麻烦了。

你真的必须决定你最看重什么。拥有一个更可靠、更不干涉的服务器是否值得您花额外的钱？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T06:47:50.007

如果它是我的源代码控制服务器，我不想 a) 支付额外的费用，或者 b) 因为我无法连接到我的存储库而不得不开车到 colo。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T08:03:47.547

我绝对会选择位于我屋檐下的服务器，只要我不需要它通过静态 IP 连接到互联网。

为什么：

*   只要可以从网络上访问它，它就会成为黑客的目标
*   机器有问题吗？我宁愿走到壁橱而不是拨打热线 - 并且可能为服务付费
*   连接速度（从我到服务器）
*   只要我不需要它，我就可以关闭它。耗电少，更环保。
*   托管一台机器一直都在花钱。即使你不需要它。

# c# - C# 中是否有“尝试锁定，如果超时则跳过”操作？

> ID：8546
> 
> 赞同：69
> 
> 时间：2008-08-12T06:19:38.550
> 
> 标签：c#, multithreading, locking

我需要尝试锁定一个对象，如果它已经锁定就继续（超时后，或者没有它）。

C# lock 语句被阻塞。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-08-12T06:37:34.053

Ed 有适合您的功能。只是不要忘记打电话`Monitor.Exit()`。您应该使用`try-finally`块来保证正确清理。

```
if (Monitor.TryEnter(someObject))
{
    try
    {
        // use object
    }
    finally
    {
        Monitor.Exit(someObject);
    }
} 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-08-12T06:29:24.070

我相信你可以使用[`Monitor.TryEnter()`](http://msdn.microsoft.com/en-us/library/system.threading.monitor.tryenter%28VS.71%29.aspx).

lock 语句只是转换为一个`Monitor.Enter()`调用和一个`try catch`块。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2014-05-19T00:22:30.267

我有同样的问题，我最终创建了一个`TryLock`实现 IDisposable 的类，然后使用该`using`语句来控制锁的范围：

```
public class TryLock : IDisposable
{
    private object locked;

    public bool HasLock { get; private set; }

    public TryLock(object obj)
    {
        if (Monitor.TryEnter(obj))
        {
            HasLock = true;
            locked = obj;
        }
    }

    public void Dispose()
    {
        if (HasLock)
        {
            Monitor.Exit(locked);
            locked = null;
            HasLock = false;
        }
    }
} 
```

然后使用以下语法进行锁定：

```
var obj = new object();

using (var tryLock = new TryLock(obj))
{
    if (tryLock.HasLock)
    {
        Console.WriteLine("Lock acquired..");
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-02-03T18:15:26.133

考虑使用带有超时输入的 AutoResetEvent 及其方法 WaitOne。

```
static AutoResetEvent autoEvent = new AutoResetEvent(true);
if(autoEvent.WaitOne(0))
{
    //start critical section
    Console.WriteLine("no other thread here, do your job");
    Thread.Sleep(5000);
    //end critical section
    autoEvent.Set();
}
else
{
    Console.WriteLine("A thread working already at this time.");
} 
```

请参阅[https://msdn.microsoft.com/en-us/library/cc189907(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/cc189907(v=vs.110).aspx) [https://msdn.microsoft.com/en-us/library/system.threading.autoresetevent(v =vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.threading.autoresetevent(v=vs.110).aspx)和 [https://msdn.microsoft.com/en-us/library/cc190477(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/cc190477(v=vs.110).aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T07:54:39.607

既然其他人已经为您指明了正确的方向，您可能会自己发现这一点，但 TryEnter 也可以采用超时参数。

Jeff Richter 的“CLR Via C#”是一本关于 CLR 内部细节的优秀书籍，如果您正在研究更复杂的内容。

# visual-studio - Visual Studio 重构：删除方法

> ID：8549
> 
> 赞同：7
> 
> 时间：2008-08-12T06:22:06.377
> 
> 标签：visual-studio, refactoring, methods

是否有任何可以进行删除方法重构的 Visual Studio 加载项？
假设您有以下方法：

```
Result DoSomething(parameters)  
{  
    return ComputeResult(parameters);  
} 
```

或者 Result 无效的变体。

重构的目的是将所有对 DoSomething 的调用替换为对 ComputeResult 的调用或使用参数的表达式（如果 ComputeResult 不是方法调用）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T07:48:33.443

如果我理解这个问题，那么 Resharper 称之为“内联方法” - `Ctrl`- `R`+`I`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T06:25:27.307

当涉及到这样的重构时，试试[ReSharper](http://www.jetbrains.com/resharper/index.html)。

只需右键单击方法名称，单击“查找用法”，然后重构，直到找不到任何引用。

正如 dlamblin 所提到的，最新版本的 ReSharper 可以内联方法。那应该做你需要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T07:04:26.417

我会以最简单的方式做到这一点：

1.  将 ComputeResult 方法重命名为 ComputeResultX
2.  将 DoSomething 方法重命名为 ComputeResult
3.  删除 DoSomething 方法（现在是 ComputeResult）
4.  将 ComputeResultX 方法重命名为 ComputeResult

也许 VS 会因为上次重命名而显示一些冲突，但请忽略它。

“重命名”是指：覆盖方法的名称，然后使用下拉菜单 (Shift+Alt+F10) 并选择“重命名”。它将用新名称替换所有出现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T07:44:42.403

有一些产品可以为 Visual Studio 2005 和 2008 添加额外的重构选项，其中一些更好的是[Refactor！Pro](http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/)和[Resharper](http://www.jetbrains.com/resharper/)。

至于删除方法，规范的重构书中有关于如何逐步执行此操作的描述。

就个人而言，我遵循以下模式（假设编译和运行单元测试发生在每个步骤之间）：

1.  创建新方法
2.  去掉旧方法的主体，改成调用新方法
3.  搜索对旧方法的所有引用（右键单击方法名称并选择“查找所有引用”），将它们更改为对新方法的调用
4.  将旧方法标记为 [Obsolete]（对其的调用现在将在构建期间显示为警告）
5.  删除旧方法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T07:19:05.250

您也可以右键单击方法名称，然后在 Visual Studio 中单击“查找所有引用”。

我个人只会做一个`CTRL`++`SHIFT``H``Find & Replace`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T07:35:35.030

[ReSharper](http://www.jetbrains.com/resharper/features/code_refactoring.html)绝对是用于重构的 VS 2008 插件。但是，它不会一步完成这种形式的重构。您将不得不 Refactor-> 将 DoSomething 重命名为 ComputeResult 并忽略与实际 ComputeResult 的冲突。然后删除 DoSomething 的定义。这几乎是一步。

然而，也许它可以[做到这一点](http://www.jetbrains.com/resharper/features/code_refactoring.html#Inline_Method)。如果我没看错的话。

# c# - 在 Windows 窗体中访问另一个窗体上的控件的最佳方法是什么？

> ID：8566
> 
> 赞同：48
> 
> 时间：2008-08-12T07:32:32.540
> 
> 标签：c#, winforms, controls

首先，这是关于使用 Windows 窗体的桌面应用程序的问题，而不是[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)问题。

我需要与其他表单上的控件进行交互。我正在尝试使用例如以下内容来访问控件...

```
otherForm.Controls["nameOfControl"].Visible = false; 
```

它不像我期望的那样工作。我最终从`Main`. 但是，如果我制作控件`public`而不是`private`，则可以直接访问它们，因此...

```
otherForm.nameOfControl.Visible = false; 
```

但这是最好的方法吗？在其他形式上进行控制是否`public`被视为“最佳实践”？是否有“更好”的方式来访问另一个表单上的控件？

**进一步说明：**

这实际上是对我提出的另一个问题的一种跟进，*[在 C# 中创建“树视图首选项对话框”类型的界面的最佳方法是什么？](https://stackoverflow.com/questions/3725/best-method-for-creating-a-tree-view-preferences-dialog-type-of-interface-in-c)*. 我得到的答案非常好，解决了我在保持 UI 简洁和易于在运行时和设计时使用方面遇到的许多组织问题。然而，它确实提出了容易控制界面其他方面的一个琐碎问题。

基本上，我有一个根表单，它实例化了位于根表单面板中的许多其他表单。因此，例如，其中一个子表单上的单选按钮可能需要更改主根表单上状态条图标的状态。在这种情况下，我需要子表单与父（根）表单的状态条中的控件对话。（我希望这是有道理的，而不是以“谁先上”的方式。）

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-08-12T07:41:07.093

您可以创建一个控制其可见性的属性，而不是将控件公开：

```
public bool ControlIsVisible
{
     get { return control.Visible; }
     set { control.Visible = value; }
} 
```

这将为该控件创建一个适当的访问器，该访问器不会公开该控件的整个属性集。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-08-12T07:35:33.000

我个人建议*不*要这样做......如果它正在响应某种行动并且需要改变它的外观，我宁愿提出一个事件并让它自行解决......

这种形式之间的耦合总是让我感到紧张。我总是尽量保持 UI 尽可能轻巧和*独立*。

我希望这有帮助。如果没有，也许您可​​以扩展该场景？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-12T07:42:57.603

第一个当然是行不通的。窗体上的控件是私有的，设计时仅对该窗体可见。

将其全部公开也不是最好的方法。

如果我想将某些东西暴露给外部世界（这也可能意味着另一种形式），我会为它创建一个公共属性。

```
public Boolean nameOfControlVisible
{
    get { return this.nameOfControl.Visible; }
    set { this.nameOfControl.Visible = value; }
} 
```

您可以使用此公共属性来隐藏或显示控件或询问控件当前的可见性属性：

```
otherForm.nameOfControlVisible = true; 
```

您也可以公开完整的控件，但我认为这太多了，您应该只从当前表单外部显示您真正想要使用的属性。

```
public ControlType nameOfControlP
{
    get { return this.nameOfControl; }
    set { this.nameOfControl = value; }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-12T07:48:18.200

在阅读了额外的细节之后，我同意[robcthegeek](https://stackoverflow.com/questions/8566/best-way-to-access-a-control-on-another-form-in-c?sort=Newest#8567)：引发一个事件。创建一个自定义 EventArgs 并通过它传递必要的参数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-01-31T12:14:46.697

假设您有两个表单，并且您想通过另一个表单隐藏一个表单的属性：

```
form1 ob = new form1();
ob.Show(this);
this.Enabled= false; 
```

当您想通过 form2 按钮将焦点移回 form1 时：

```
Form1 ob = new Form1();
ob.Visible = true;
this.Close(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T07:40:55.690

我会在父表单中处理这个。您可以通过事件通知另一个表单它需要修改自己。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-06-22T21:36:59.060

1.  使用事件处理程序通知其他表单来处理它。
2.  在子窗体上创建一个公共属性并从父窗体访问它（使用有效的强制转换）。
3.  在子窗体上创建另一个构造函数，用于设置窗体的初始化参数
4.  创建自定义事件和/或使用（静态）类。

如果您使用非模态表单，最佳做法是#4。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-12T14:36:54.180

我同意为此使用事件。由于我怀疑您正在构建 MDI 应用程序（因为您创建了许多子窗体）并动态创建窗口并且可能不知道何时取消订阅事件，所以我建议您查看[Weak Event Patterns](http://msdn.microsoft.com/en-us/library/aa970850.aspx)。唉，这仅适用于框架 3.0 和 3.5，但类似的东西可以通过弱引用相当容易地实现。

但是，如果要根据表单的引用在表单中查找控件，仅仅查看表单的控件集合是不够的。由于每个控件都有自己的控件集合，因此您必须递归所有控件才能找到特定的控件。您可以使用这两种方法来做到这一点（可以改进）。

```
public static Control FindControl(Form form, string name)
{
    foreach (Control control in form.Controls)
    {
        Control result = FindControl(form, control, name);

        if (result != null)
            return result;
    }

    return null;
}

private static Control FindControl(Form form, Control control, string name)
{
    if (control.Name == name) {
        return control;
    }

    foreach (Control subControl in control.Controls)
    {
        Control result = FindControl(form, subControl, name);

        if (result != null)
            return result;
    }

    return null;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-14T10:06:36.053

你可以

1.  在子表单上创建一个带有所需参数的公共方法并从父表单调用它（使用有效的强制转换）
2.  在子表单上创建一个公共属性并从父表单访问它（使用有效的演员表）
3.  在子窗体上创建另一个构造函数，用于设置窗体的初始化参数
4.  创建自定义事件和/或使用（静态）类

如果您使用非模态表单，最佳实践将是 #4。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-13T19:30:06.157

使用属性（突出显示），我可以获得 MainForm 类的实例。但这是一个好习惯吗？你有什么建议吗？

为此，我使用在 OnLoad 方法上运行的属性 MainFormInstance。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using LightInfocon.Data.LightBaseProvider;
using System.Configuration;

namespace SINJRectifier
{

    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent();
        }

        protected override void OnLoad(EventArgs e)
        {
            UserInterface userInterfaceObj = new UserInterface();
            this.chklbBasesList.Items.AddRange(userInterfaceObj.ExtentsList(this.chklbBasesList));
            MainFormInstance.MainFormInstanceSet = this; //Here I get the instance
        }

        private void btnBegin_Click(object sender, EventArgs e)
        {
            Maestro.ConductSymphony();
            ErrorHandling.SetExcecutionIsAllow();
        }
    }

    static class MainFormInstance  //Here I get the instance
    {
        private static MainForm mainFormInstance;

        public static MainForm MainFormInstanceSet { set { mainFormInstance = value; } }

        public static MainForm MainFormInstanceGet { get { return mainFormInstance; } }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-12T07:55:55.207

您的子表单真的需要是表单吗？它们可以成为用户控件吗？这样，它们可以轻松地引发事件以供主窗体处理，并且您可以更好地将它们的逻辑封装到单个类中（至少，从逻辑上讲，它们毕竟已经是类了）。

@Lars：你就在这里。这是我一开始就做的事情，从那以后就不必这样做了，这就是为什么我首先建议提出一个事件，但我的其他方法真的会破坏任何封装的外观。

@Rob：是的，听起来不错:)。0/2 在这个...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-17T01:23:36.650

You should only ever access one view's contents from another if you're creating more complex controls/modules/components. Otherwise, you should do this through the standard Model-View-Controller architecture: You should connect the enabled state of the controls you care about to some model-level predicate that supplies the right information.

For example, if I wanted to enable a Save button only when all required information was entered, I'd have a predicate method that tells when the model objects representing that form are in a state that can be saved. Then in the context where I'm choosing whether to enable the button, I'd just use the result of that method.

This results in a much cleaner separation of business logic from presentation logic, allowing both of them to evolve more independently — letting you create one front-end with multiple back-ends, or multiple front-ends with a single back-end with ease.

It will also be much, much easier to write unit and acceptance tests for, because you can follow a "[Trust But Verify](http://chanson.livejournal.com/118380.html "Trust But Verify for UI testing")" pattern in doing so:

1.  You can write one set of tests that set up your model objects in various ways and check that the "is savable" predicate returns an appropriate result.

2.  You can write a separate set of that check whether your Save button is connected in an appropriate fashion to the "is savable" predicate (whatever that is for your framework, in Cocoa on Mac OS X this would often be through a binding).

As long as both sets of tests are passing, you can be confident that your user interface will work the way you want it to.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-12T07:57:25.453

@Lars，很好地呼吁传递表单引用，我自己也看到了。讨厌。从未见过他们将它们传递到 BLL 层！这甚至没有意义！这可能会严重影响性能，对吗？如果在 BLL 中的某个地方保留了引用，那么该表单将保留在内存中，对吗？

你有我的同情！;)

* * *

@Ed，重新评论您关于制作表单用户控件的评论。Dylan 已经指出，根窗体实例化*了许多*子窗体，给人一种 MDI 应用程序的印象（我假设用户可能想要关闭各种窗体）。如果我在这个假设中是正确的，我认为最好将它们保存为表格。当然可以更正:)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-07T18:20:44.037

This looks like a prime candidate for separating the presentation from the data model. In this case, your preferences should be stored in a separate class that fires event updates whenever a particular property changes (look into INotifyPropertyChanged if your properties are a discrete set, or into a single event if they are more free-form text-based keys).

In your tree view, you'll make the changes to your preferences model, it will then fire an event. In your other forms, you'll subscribe to the changes that you're interested in. In the event handler you use to subscribe to the property changes, you use this.InvokeRequired to see if you are on the right thread to make the UI call, if not, then use this.BeginInvoke to call the desired method to update the form.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-06-29T08:24:32.630

步骤1：

```
string regno, exm, brd, cleg, strm, mrks, inyear;

protected void GridView1_RowEditing(object sender, GridViewEditEventArgs e)
{
    string url;
    regno = GridView1.Rows[e.NewEditIndex].Cells[1].Text;
    exm = GridView1.Rows[e.NewEditIndex].Cells[2].Text;
    brd = GridView1.Rows[e.NewEditIndex].Cells[3].Text;
    cleg = GridView1.Rows[e.NewEditIndex].Cells[4].Text;
    strm = GridView1.Rows[e.NewEditIndex].Cells[5].Text;
    mrks = GridView1.Rows[e.NewEditIndex].Cells[6].Text;
    inyear = GridView1.Rows[e.NewEditIndex].Cells[7].Text;

    url = "academicinfo.aspx?regno=" + regno + ", " + exm + ", " + brd + ", " +
          cleg + ", " + strm + ", " + mrks + ", " + inyear;
    Response.Redirect(url);
} 
```

第2步：

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        string prm_string = Convert.ToString(Request.QueryString["regno"]);

        if (prm_string != null)
        {
            string[] words = prm_string.Split(',');
            txt_regno.Text = words[0];
            txt_board.Text = words[2];
            txt_college.Text = words[3];
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-08-16T22:12:04.587

将修饰符从公共更改为内部。.Net 故意使用私有修饰符而不是公共修饰符，以防止任何非法访问您的项目之外的方法/属性/控件。事实上，公共修饰符可以在任何地方访问，所以它们真的很危险。您项目中的任何主体都可以访问您的方法/属性。但是在内部修饰符中，没有任何主体（您当前项目的其他主体）可以访问您的方法/属性。

假设您正在创建一个项目，其中包含一些秘密字段。因此，如果可以从您的项目中访问这些字段，则可能很危险，并且与您最初的想法背道而驰。作为一个很好的建议，我可以说总是使用内部修饰符而不是公共修饰符。

但是有些奇怪！

我还必须在 VB.Net 中说明，虽然我们的方法/属性仍然是私有的，但可以通过将表单作为变量调用而从其他表单/类访问它，没有任何问题。

我不知道为什么这种编程语言的行为与 C# 不同。正如我们所知，两者都使用相同的平台，并且声称它们几乎是相同的后端平台，但正如您所见，它们的行为仍然不同。

但我已经用两种方法解决了这个问题。任何一个; 通过使用接口（这不是推荐的，如你所知，接口通常需要公共修饰符，并且不推荐使用公共修饰符（正如我在上面告诉你的那样）），

或者

在某个静态类和静态变量中声明您的整个表单，并且仍然有内部修饰符。然后，当您想使用该表单向用户显示时，请将新`Form()`构造传递给该静态类/变量。现在它可以随心所欲地在任何地方访问。但是你还需要更多的东西。您也可以在 Designer File of Form 中声明元素内部修饰符。当您的表单打开时，它可以在任何地方访问。它可以很好地为您工作。

考虑这个例子。

假设您要访问表单的 TextBox。

所以第一项工作是在静态类中声明一个静态变量（静态的原因是易于访问，而无需在未来使用任何新的密钥）。

其次转到该表单的设计器类，该类应该由其他表单访问。将其 TextBox 修饰符声明从私有更改为内部。不用担心; .Net 在您更改后永远不会再将其更改为私有修饰符。

第三，当您想调用该表单打开时，请将新的表单构造传递给该静态变量-->>静态类。

第四; 在 From 打开时，您可以从任何其他表单（项目中的任何位置）访问该表单/控件。

看下面的代码（我们有三个对象。1-一个静态类（在我们的例子中我们命名它`A`）

2 - 任何其他想要打开最终表单的表单（在我们的示例中具有 TextBox `FormB`）。

3 - 我们需要打开的真实表单，我们假设可以访问它的内部`TextBox1`（在我们的示例中`FormC`）。

看看下面的代码：

```
internal static class A
{
    internal static FormC FrmC;
}

FormB ...
{
    '(...)
    A.FrmC = new FormC();
    '(...)
}

FormC (Designer File) . . . 
{
     internal System.Windows.Forms.TextBox TextBox1;
} 
```

您可以随时随地访问该静态变量（此处`FormC`）及其内部控制（此处`Textbox1`），而 while`FormC`是开放的。

* * *

任何评论/想法让我知道。我很高兴收到您或其他任何人关于这个话题的更多信息。老实说，过去我对这个提到的问题有一些问题。最好的方法是第二种解决方案，我希望它对你有用。让我知道任何新的想法/建议。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-05-24T20:29:07.457

```
public void Enable_Usercontrol1()
{
    UserControl1 usercontrol1 = new UserControl1();
    usercontrol1.Enabled = true;
} 
/*
    Put this Anywhere in your Form and Call it by Enable_Usercontrol1();
    Also, Make sure the Usercontrol1 Modifiers is Set to Protected Internal
*/ 
```

# java - What's your "best practice" for the first Java EE Spring project?

> ID：8569
> 
> 赞同：31
> 
> 时间：2008-08-12T07:36:14.107
> 
> 标签：java, spring, jakarta-ee, aop

I'm currently trying to get into the Java EE development with the Spring framework. As I'm new to Spring, it is hard to imaging how a good running project should start off.

Do you have any *best practices*, tipps or major *DO NOTs* for a starter? How did you start with Spring - big project or small tutorial-like applications? Which technology did you use right away: AOP, complex Hibernate...

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-08-16T21:12:19.233

Small tip - I've found it helpful to modularize and clearly label my Spring xml context files based on application concern. Here's an example for a web app I worked on:

*   `MyProject / src / main / resources / spring /`
    *   ***datasource.xml*** - My single data source bean.
    *   ***persistence.xml*** - My DAOs/Repositories. Depends on `datasource.xml` beans.
    *   ***services.xml*** - Service layer implementations. These are usually the beans to which I apply transactionality using AOP. Depends on `persistence.xml` beans.
    *   ***controllers.xml*** - My Spring MVC controllers. Depends on `services.xml` beans.
    *   ***views.xml*** - My view implementations.

This list is neither perfect nor exhaustive, but I hope it illustrates the point. Choose whatever naming strategy and granularity works best for you.

In my (limited) experience, I've seen this approach yeild the following benefits:

**Clearer architecture**

Clearly named context files gives those unfamiliar with your project structure a reasonable place to start looking for bean definitions. Can make detecting circular/unwanted dependencies a little easier.

**Helps domain design**

If you want to add a bean definition, but it doesn't fit well in any of your context files, perhaps there's a new concept or concern emerging? Examples:

*   Suppose you want to make your Service layer transactional with AOP. Do you add those bean definitions to `services.xml`, or put them in their own `transactionPolicy.xml`? Talk it over with your team. Should your transaction policy be pluggable?
*   Add Acegi/Spring Security beans to your `controllers.xml` file, or create a `security.xml` context file? Do you have different security requirements for different deployments/environments?

**Integration testing**

You can wire up a subset of your application for integration testing (ex: given the above files, to test the database you need to create only `datasource.xml` and `persistence.xml` beans).

Specifically, you can annotate an integration test class as such:

```
@ContextConfiguration(locations = { "/spring/datasource.xml" , "/spring/persistence.xml" }) 
```

**Works well with Spring IDE's Beans Graph**

Having lots of focused and well-named context files makes it easy to create custom BeansConfigSets to visualize the layers of your app using Spring IDE's [Beans Graph](http://springide.org/project/wiki/BeansGraph). I've used this before to give new team members a high-level overview of our application's organization.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-08-12T07:43:24.153

Focus first on the heart of Spring: Dependency Injection. Once you see all the ways that DI can be used, then start thinking about the more interesting pieces like AOP, Remoting, JDBC Templates etc. So my best bit of advice is let your use of Spring grow out from the core.

Best practice? If you're using the standard XML config, manage the size of individual files and comment them judiciously. You may think that you and others will perfectly understand your bean definitions, but in practice they're somewhat harder to come back to than plain old java code.

Good luck!

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-05-08T03:22:51.873

First of all Spring is about modularity and works best if one focuses on writing small components that do one thing and do it well.

If you follow best practices in general like:

*   Defining an interface rather than abstract classes
*   Making types immutable
*   Keep dependencies as few as possible for a single class.
*   Each class should do one thing and do it well. Big monolithic classes suck, they are hard to test and hard to use.

If your components are small and follow the dogmas above they should be easy to wire up and play with other stuff. The above points are naturally also true of the Spring framework itself.

PS

**Dont listen to the points above, they are talking about how to do whatever. Its more important to learn how to think rather than how to do something. Humans can think, repeating something is not clever, thinking is.**

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-12T07:54:25.023

I actually quite liked Spring.. It was a fresh breeze of air in your average J2EE Java Beans..

I recommend implementing the example Spring provides:

[http://static.springframework.org/docs/Spring-MVC-step-by-step/](http://static.springframework.org/docs/Spring-MVC-step-by-step/)

Also, I decided to go full monty and added Hibernate to my Spring application ;), because Spring provides excellent support for Hibernate... :)

I do have a DON'T however, which I learned the hard way (product in production)... If you only implement the Controller interface, and return a ModelAndView object with some data as provided with the interface, Spring does garbadge collect those resources, for tries to cache those data. So be careful to put large data in those ModelAndView objects, because they will hog up your server memory for as long as the server is in the air as soon as that page has been viewed...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T21:11:13.243

Start here - I actually think it's among the best Software Dev books that I've read.
[Expert Spring MVC And Web Flow](http://books.google.com/books?id=L7d0LNpSrRwC&dq=expert+spring+mvc+and+web+flow&pg=PP1&ots=GC7894yug6&sig=xndzQdG2YWy27Ffx6kR1rXQwxf0&hl=en&sa=X&oi=book_result&resnum=1&ct=result)

Learn the new Annotation-based configuration for MVC classes. This is part of Spring 2.5\. Using Annotation-based classes is going to make writing Unit tests a heck of a lot easier. Also being able to cut down on the amount of XML is a good thing.

Oh yeah Unit Tests - if you're using Spring, you BETTER be Unit Testing. :) Write Unit tests for all of your Web and Service Layer classes.

Read up on Domain Driven Design. The fact that you can use Domain Object classes at all levels of a Spring Application means you're going to have a VERY powerful Domain Model. Leverage it.

However, when using your Domain Object classes for form population, you will want to take heed of the recent security concerns around the Spring Framework. [A discussion on the Server Side](http://www.theserverside.com/news/thread.tss?thread_id=50076) reveals the way to close the hole in the comments.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T07:40:19.293

Whilst its been years since I have used spring, and I can't say I am a fan of it, I know that the App Fuse tool ([https://java.net/projects/appfuse/](https://java.net/projects/appfuse/)) has been helpful to help people bootstrap in terms of generating all the artifacts you need to get going.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-12T09:31:41.737

A good way to get started is to concentrate on the "Springframework". The Spring portfolio has grown to a big pile of projects around various aspects of Enterprise Software. Stick to the core at the beginning and try to grasp the concepts. [Download](http://www.springframework.org/download) the latest binaries and check out Spring's petclinic example once you are familiar with the core. It gives quite a good overview of the various projects SpringSource has to offer.

Although the documentation is very good, [I'd recommend a book](http://dlinsin.blogspot.com/2008/05/book-review-building-spring-2.html) after you grasp the concepts of the core. What I've found problematic with the documentation, is that it's not in depth and can't give you all the details you need.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-08-23T11:15:09.867

"...Which technology did you use right away: AOP, complex Hibernate..." - I'd say a better question would be to ask what people did not use right away. I'd add the examples you cite to that list.

Spring MVC and JDBC template would be my starting recommendations. You can go a very long way just with those.

My recommendation would be to follow the Spring architectural recommendations faithfully. Use their layering ideas. Make sure that your web layer is completely detachable from the rest. You do this by letting the web tier interact with the back end only through the service layer.

If you want to reuse that service layer, a good recommendation is to expose it using Spring "contract first" web services. If you start with the XML messages that you pass back and forth, your client and server can be completely decoupled.

The IDE with the best Spring support is IntelliJ. It's worth spending a few bucks.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-12T10:00:45.017

Spring is also very much about unit testing and therefore testability of your classes. That basically means thinking about modularization, separation of concerns, referencing a class through interfaces etc.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-12T15:28:59.940

If you're just looking to dabble in it a bit and see if you like it, I recommend starting with the DAO layer, using Spring's JDBC and/or Hibernate support. This will expose you to a lot of the core concepts, but do so in a way that is easy to isolate from the rest of your app. This is the route I followed, and it was good warm-up before getting into building a full application with Spring.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-08T03:13:43.157

With the release of Spring 2.5 and 3.0, I think one of the most important best practices to take advantage of now are the Spring annotations. Annotations for Controllers, Services, and Repositories can save you a ton of time, allow you to focus on the business logic of your app, and can potentially all you to make all of your object plain old Java objects (POJOs).

# .net - 观察 IP 地址状态的变化

> ID：8585
> 
> 赞同：5
> 
> 时间：2008-08-12T07:53:40.857
> 
> 标签：.net, windows

有没有一种方法可以像使用 FileSystemWatcher 观察文件的变化一样观察 ip 地址的变化？我正在通过 tcp/ip 连接到一台机器，但它需要一段时间才能给我一个 IP 地址。我想调暗连接按钮，直到我有一个有效的 IP 地址。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T07:59:54.573

检查[NetworkChange](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.networkchange.aspx)类。当网络地址更改时，它会引发一个事件。

# java - JavaME 的最佳二进制 XML 格式

> ID：8599
> 
> 赞同：10
> 
> 时间：2008-08-12T08:08:11.327
> 
> 标签：java, xml, java-me, mobile

谁能推荐一个好的二进制 XML 格式？它是针对 JavaME 应用程序的，因此它必须：a) 易于在服务器上实现，b) 易于在低端 JavaME 客户端设备上编写低占用空间的解析器。

不言而喻，它需要比 XML 更小，并且解析速度更快。

* * *

数据类似于 SVG。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T10:42:35.917

您可能想看看[wbxml](http://en.wikipedia.org/wiki/WBXML) (Wireless Binary XML)，它针对大小进行了优化，经常在手机上使用，但并未针对解析速度进行优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T08:32:08.800

[Hessian](http://en.wikipedia.org/wiki/Hessian_(protocol))可能是一个值得关注的替代方案。它是一个小型协议，非常适合 Java ME 应用程序。

“Hessian 是一种二进制 Web 服务协议，无需大型框架，也无需学习一套新协议，即可使 Web 服务可用。因为它是一种二进制协议，非常适合发送二进制数据，无需扩展带有附件的协议。”

更多链接：

[这里](http://hessian.caucho.com/)

[这里也](http://web.archive.org/web/20100329161201/http://www.nubius.be:80/info-software/hessian4j.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T10:13:29.687

你打算使用什么样的数据？我想说，如果服务器也是用 Java 完成的，那么占用空间小的最简单方法是以预定义格式发送/接收二进制数据。只需按已知顺序将所有内容写入`DataOutputStream`.

但这真的取决于，你在处理什么样的数据，你能定义格式。

实际上，您应该评估是否需要这种优化。也许您的目标设备**不受限制**。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T18:26:39.603

这在很大程度上取决于目标设备。如果您有可用的 JSR172，那么您就完成了解析，运行时会为您完成。而 XML 主要是关于制作自己的格式。如前所述，如果您的目标是性能，那么 XML 可能不是最好的方法，您最终会做一些二进制文件。

# c# - Windows 窗体应用程序中的 HTML 编辑器

> ID：8604
> 
> 赞同：21
> 
> 时间：2008-08-12T08:20:15.173
> 
> 标签：c#, .net, vb.net, winforms, controls

我们正在为我们的 windows 应用程序（vb.net 或 c#）寻找一个所见即所得的编辑器控件，以便用户可以在发送之前设计 HTML 电子邮件（使用 .net 框架中的 SMTP 对象发送）。

目前，我们可以找到的所有可用编辑器都存在以下问题之一：

1.  它们依赖于 mshtml.dll 或 Web 浏览器控件，这对我们来说是不可靠的，因为 HTML 代码和编辑器在 windows 2000 (IE6) 下不同步

2.  它们是基于 Web 的，而不是 Windows 窗体控件

3.  他们将样式放在文档的头部（见下面的注释）

不幸的是，正如这篇[HTML 电子邮件文章](http://www.xavierfrenette.com/articles/css-support-in-webmail/)所描述的，使 HTML 电子邮件与样式一起使用的唯一可靠方法是内联使用它们，现在许多编辑器似乎不支持这种方法。

有没有人有这方面的经验或可以提出解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T16:53:31.643

我一直在使用[这个](http://www.itwriting.com/htmleditor/)，它比 WebBrowser 稍微低一点，但仍然使用 MSHTML，它确实会吐出一些难看的 HTML。出于我的目的，我正在使用 WYSIWYG 和 HTML 编辑模式（使用[ICSharp.TextEditor](http://sharpdevelop.net/OpenSource/SD/)）使用 Buffer 类在选项卡更改时进行更新的多选项卡编辑器。作为该 Buffer 类的一部分，我实际上[通过 HTML Tidy](http://www.wynia.org/wordpress/2008/02/14/using-htmltidy-to-clean-up-html-with-c/)和一些擦洗-n-replace 位运行 HTML 以获得有效的 XHTML。

我只是将其作为一种解决方案提供，因为我也未能以某种方式找到不是源自 MSHTML 的解决方案，最终只是继续使用上述解决方案以继续前进。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-11-30T18:55:12.057

Windows 窗体中最简单的 HTML 编辑器可以`<div contenteditable="true"></div>`在`WebBrowser`控件中显示一个。它内置了对常见 html 文本编辑功能的支持，例如：

*   `Ctrl`+`B`使选择加粗
*   `Ctrl`+`I`使选择斜体
*   `Ctrl`+`U`使选择加下划线
*   `Ctrl`+`A`选择所有文本
*   `Ctrl`+`C`复制选择
*   `Ctrl`+`X`剪切选择
*   `Ctrl`+`V`粘贴选择
*   `Ctrl`+`K`插入链接

但是，为了获得更好的用户体验，您可以依赖 DOM`document`对象`WebBrower`并使用其[`execCommand`](https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand)方法并轻松运行诸如`Bold`, `Italic`, `Underline`, `InsertOrderedList`, `InsertUnorderedList`, `InsertImage`, `FormatBlock`, `ForeColor`,`BackColor`等命令。

例如以下命令插入有序列表：

```
webBrowser1.Document.ExecCommand("InsertOrderedList", false, null); 
```

**Example - Windows 窗体 HTML 编辑器**

在这里，我将分享一个 C# 应用程序的示例，并向您展示如何轻松实现 HTML 编辑器。

[![在此处输入图像描述](https://i.stack.imgur.com/UmYhp.png)](https://i.stack.imgur.com/UmYhp.png)

```
public class HtmlEditor
{
    WebBrowser webBrowser;
    private dynamic doc;
    private dynamic contentDiv;
    public HtmlEditor(WebBrowser webBrowserControl, string htmlContent)
    {
        webBrowser = webBrowserControl;
        webBrowser.DocumentText = @"<div contenteditable=""true""></div>";
        webBrowser.DocumentCompleted += (s, e) =>
        {
            doc = webBrowser.Document.DomDocument;
            contentDiv = doc.getElementsByTagName("div")[0];
            contentDiv.innerHtml = htmlContent;
        };
    }
    public string HtmlContent => contentDiv.InnerHtml;
    public void Bold() { doc.execCommand("bold", false, null); }
    public void Italic() { doc.execCommand("italic", false, null); }
    public void Underline() { doc.execCommand("underline", false, null); }
    public void OrderedList() { doc.execCommand("insertOrderedList", false, null); }
    public void UnorderedList() { doc.execCommand("insertUnOrderedList", false, null); }
    public void ForeColor(Color color)
    {
        doc.execCommand("foreColor", false, ColorTranslator.ToHtml(color));
    }
    public void BackColor(Color color)
    {
        doc.execCommand("backColor", false, ColorTranslator.ToHtml(color));
    }
    public void InsertImage(Image image)
    {
        var bytes = (byte[])new ImageConverter().ConvertTo(image, typeof(byte[]));
        var src = $"data:image/png;base64,{Convert.ToBase64String(bytes)}";
        doc.execCommand("insertImage", false, src);
    }
    public void Heading(Headings heading)
    {
        doc.execCommand("formatBlock", false, $"<{heading}>");
    }
    public enum Headings { H1, H2, H3, H4, H5, H6 }
} 
```

`WebBrowser`要使用这个 HTML 编辑器类，在 a上有一个控件`Form`并以这种方式初始化编辑器就足够了：

```
HtmlEditor editor;
private void Form1_Load(object sender, EventArgs e)
{
    var html = @"Some html content";
    editor = new HtmlEditor(webBrowser1, html);
} 
```

然后您可以使用 a`ToolStrip`显示可用命令并运行这些命令。例如：

```
private void OrderedListButton_Click(object sender, EventArgs e)
{
    editor.OrderedList();
}

private void ImageButton_Click(object sender, EventArgs e)
{
    using (var ofd = new OpenFileDialog())
    {
        ofd.Filter = "Image files|*.png;*.jpg;*.gif;*.jpeg;*.bmp";
        if (ofd.ShowDialog() == DialogResult.OK)
        {
            using (var image = Image.FromFile(ofd.FileName))
            {
                editor.InsertImage(image);
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T08:42:03.600

我还需要一个 WYSIWYG 编辑器用于我正在处理的 Windows 窗体项目。我写了关于我在[这里](http://ellisweb.net/2007/03/wysiwyg-editing-of-html-in-a-windows-forms-control/)找到的项目。最终，我最终使用了在 CodeProject 上找到的东西：[A Windows Forms based text editor with HTML output](http://www.codeproject.com/KB/edit/editor_in_windows_forms.aspx)。这确实违反了上面的 (a)，因为它使用了 WebBrowser 控件。但是，我找不到任何不这样做的好东西（如果你不以某种方式使用 WebBrowser，那么你基本上必须编写自己的 HTML 解析器和渲染器来处理“你见“所见即所得的一部分）。这个控件的好处是源很容易自定义，因此您可以根据需要删除和添加格式选项（如果您希望样式全部内联，您也可以这样做）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-16T08:29:20.917

与其搜索 HTML 编辑器，不如考虑使用 RichText 编辑器（它更容易创建），然后将最终文本转换为 HTML 文档。

如果您需要使用最少的功能集（粗体/斜体等），RT 编辑器的创建和最终文档到 HTML 格式的转换应该不难。

另一方面，如果您需要使用更多功能（例如表格），则需要研究[富文本格式](http://www.microsoft.com/downloads/details.aspx?FamilyId=DD422B8D-FF06-4207-B476-6B5396A18A2B&displaylang=en)并实现您需要的功能。

其他资源：

*   将 RTF 转换为 HTML： http: [//www.codeproject.com/KB/vb/RTFToHTML.aspx](http://www.codeproject.com/KB/vb/RTFToHTML.aspx)
*   RichTextBox 提示和技巧：[http ://www.vbforums.com/showthread.php?t=355994](http://www.vbforums.com/showthread.php?t=355994)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-16T08:53:39.193

这是我的第一个贡献。

您可以使用 RichTextBox。RTF 格式足以创建电子邮件。

我最近写了关于如何加载和保存到硬盘的 RichTextBox 的内容。

允许复制和粘贴。它使用简单，只需几个按钮，您就可以创建自己的命令。

```
With RichTextBox1 
    .SelStart = 0 
    .SelLength = Len (. Text) 
    .SelColor = vbRed
End With 
```

加载和保存的示例。

[http://danielcatala.wordpress.com/2014/01/30/como-cargar-y-guardar-archivos-richtext-con-wpf/](http://danielcatala.wordpress.com/2014/01/30/como-cargar-y-guardar-archivos-richtext-con-wpf/)

```
Private Sub btnCarga(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles Button1.Click

    Dim archivoCarga As New StreamReader("prueba.rtf")
    With RichTextBox1
        .Selection.Select(.Document.ContentStart, RichTextBox1.Document.ContentEnd)
        .Selection.Load(archivoCarga.BaseStream, System.Windows.DataFormats.Rtf)
    End With
End Sub

Private Sub btnGuarda(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles Button2.Click

    Dim archivoSalida As New StreamWriter("prueba.rtf")
    Dim bs As Stream = archivoSalida.BaseStream

    With RichTextBox1
        .Selection.Select(RichTextBox1.Document.ContentStart,     RichTextBox1.Document.ContentEnd)
        .Selection.Save(bs, System.Windows.DataFormats.Rtf)
    End With
End Sub 
```

# visual-studio-2005 - 发布配置中 MS Visual Studio 2005 中的代码崩溃

> ID：8612
> 
> 赞同：2
> 
> 时间：2008-08-12T08:44:09.600
> 
> 标签：visual-studio-2005

我有一个工作区，用于在循环中运行 H.263 视频编码器 31 次，即 main 执行 31 次以生成 31 个不同的编码比特流。此 MS Visual Studio 2005 工作区包含所有 C 源文件。当我为工作区创建“调试”配置并构建和执行它时，它运行良好，即它按预期生成所有 31 个输出文件。但是当我将工作区的配置设置为“RELEASE”mdoe 并重复该过程时，编码器在某些测试用例运行时崩溃。

现在要调试，验证如下：

1.  分析代码以查看在每次运行编码器时是否遗漏了任何变量初始化
2.  检查了两种模式（调试和发布）中的各种工作区（解决方案）选项。

有一些明显的差异，但我在两种模式下都明确地将优化相关选项设为相同。

但仍然无法确定问题并找到解决方法。任何指针？

-阿吉特。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T08:51:01.053

如果不仔细检查代码，很难说可能是什么问题。然而...

调试版本和发布版本之间的区别之一是函数调用堆栈框架的设置方式。您可以做某些类型的坏事（例如调用具有错误数量的参数的函数），它们在调试版本中不是致命的，但在发布版本中会严重崩溃。也许您可以尝试将发布版本中的堆栈框架相关选项（我忘记它们的名称，抱歉）更改为与调试版本相同，看看是否有帮助。

另一件事可能是启用所有可能的警告，并修复它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T08:51:20.990

可能是两个线程的并发问题。DEBUG 配置会减慢执行速度，因此不会出现问题。但是，只是猜测。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T08:51:52.627

有趣的问题.. 你确定你没有潜伏的条件编译代码不是在发布模式下编译的吗？IE：

```
#if (DEBUG)
// Debug Code here
#else
// Release Code here
#endif 
```

这是我唯一能真正想到的事情。。我自己从来没有经历过这样的事情。。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T10:12:57.737

您可以将调试符号添加到发布版本并在调试器中运行它以查看崩溃的位置和原因吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T13:03:36.223

是的，那些混蛋崩溃是最难修复的。幸运的是，在您求助于手动查看代码并希望找到针头之前，您可以执行一些步骤来为您提供线索。

什么时候崩溃？每次考试？在特定的测试中？该测试有什么其他人没有的？

有什么错误？如果是访问冲突，是否有模式发生在哪里？如果地址较低，则可能意味着某处存在未初始化的指针。

程序是否因调试配置而崩溃但未连接调试器？如果是这样，这很可能是 John Smithers 指出的线程同步问题。

您是否尝试过通过 Purify 等分析器运行代码？它很慢，但通常值得等待。

无论如何都要尝试调试发布配置。它只会转储程序集，但它仍然可以指示发生的情况，例如代码指针在垃圾中间跳转或在外部库中遇到断点。

Are you on an Intel architecture? If not, watch for memory alignement errors, they hard crash without warning on some architectures and those codec algorithm tend to create those situations a lot since they are overly optimized.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T08:48:45.380

你确定没有预编译指令，比如说，在发布模式下忽略一些非常重要的代码，但在调试中允许它们？

此外，您是否实施了任何可能指出引发错误的精确程序集的日志记录？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-12T10:04:14.590

我会更详细地查看崩溃 - 如果它在测试用例中崩溃，那么听起来很容易重现，这通常是最大的挑战。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-12T10:48:18.663

另一件需要考虑的事情：在调试模式下，变量初始化为 0xCCCCCCCC 而不是零。这可能会产生一些令人讨厌的副作用。

# render - 在网页上显示渲染时间的最佳格式

> ID：8624
> 
> 赞同：2
> 
> 时间：2008-08-12T09:08:05.217
> 
> 标签：render

我已经开始将渲染页面所花费的时间添加到我们内部 Web 应用程序的页脚。目前它看起来像这样

> 在 0.062 秒内渲染

有时我会得到这样的渲染时间

> 在 0.000 秒内渲染

目前它仅作为用户判断页面是否快速加载的指南，让他们快速通知我们页面是否需要 17 秒而不是通常的 0.5 秒。我的问题是时间应该采用什么格式？在这一点上我应该切换到一个语句，如

> 在不到一秒的时间内渲染

我喜欢看十分之一秒，但上面的第二个示例对任何人都没有用，实际上它只是突出了我用来查找渲染时间的计算的限制。我宁愿根本不让用户看到！欢迎任何答案，包括页面上是否应包含任何内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T09:22:53.860

“立即渲染”听起来比“在不到一秒的时间内渲染”要好得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T09:13:53.520

与其依靠您的用户查看页脚并让您知道该值是否超过了某个耐心阈值，不如将页面呈现时间记录在服务器上的日志文件中可能是一个更好的主意。获得所有原始数据后，您可以查找渲染时间往往比正常时间更长的特定页面。

通过更详细的日志记录，您还可以测量数据库查询或您的 Web 应用程序依赖于外部系统的任何时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T10:40:26.590

我不确定告诉用户服务器渲染页面需要多长时间是否有任何价值。很可能值得您记录此类信息，但他们不在乎。

如果服务器需要 0.001 秒来绘制页面，但他们需要 17 秒来加载它（由于网络、javascript、页面大小、他们的垃圾 PC 等），他们的感知将是后者。

然后再次添加渲染时间可能会帮助您通过“与本地网络管理员交谈”响应来避免有关任何感知到的缓慢的查询。

鉴于您知道测量的准确性，您可以将 0.000 文本设置为“在不到千分之一秒内渲染”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T08:25:42.773

我想我过分强调它是为用户服务的。

我知道通过在 web.config 中使用跟踪，我可以获得有关页面呈现时间以及访问数据库时间的准确信息。

我们过去曾遇到过应用程序在网络上运行速度过慢的问题，尽管它现在已得到修复。我正在将标签添加到新应用程序中，以便用户知道这是我们正在认真对待的事情，这对开发人员来说是一个非常简单的指标。

考虑到所有这些，我喜欢“立即渲染”并且写了很多有意义的东西，所以我会接受你的回答和 kokos'。

谢谢

# c# - 泛型类型转换 FROM 字符串

> ID：8625
> 
> 赞同：264
> 
> 时间：2008-08-12T09:13:23.520
> 
> 标签：c#, generics, primitive, type-safety

我有一个类，我想用它来存储另一个类的“属性”。这些属性只有一个名称和一个值。理想情况下，我希望能够添加*类型化*属性，以便返回的“值”始终是我想要的类型。

类型应该始终是原始类型。这个类继承了一个抽象类，它基本上将名称和值存储为字符串。这个想法是这个子类将为基类添加一些类型安全性（以及为我节省一些转换）。

所以，我创建了一个（大致）这样的类：

```
public class TypedProperty<DataType> : Property
{
    public DataType TypedValue
    {
        get { // Having problems here! }
        set { base.Value = value.ToString();}
    }
} 
```

所以问题是：

**是否有一种“通用”方法可以将字符串转换回原语？**

我似乎找不到任何通用接口来链接全面的转换（像*ItryParsable*这样的东西本来是理想的！）。

* * *

## 回答 #1

> 赞同：422
> 
> 时间：2008-08-12T09:24:33.203

我不确定我是否正确理解了您的意图，但让我们看看这是否有帮助。

```
public class TypedProperty<T> : Property where T : IConvertible
{
    public T TypedValue
    {
        get { return (T)Convert.ChangeType(base.Value, typeof(T)); }
        set { base.Value = value.ToString();}
    }
} 
```

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-12-02T14:11:47.603

lubos hasko 的方法对 nullables 失败。下面的方法适用于可空值。不过，我没有想出来。我通过谷歌找到它：http: [//web.archive.org/web/20101214042641/http](http://web.archive.org/web/20101214042641/http://dogaoztuzun.com/post/C-Generic-Type-Conversion.aspx) : //dogaoztuzun.com/post/C-Generic-Type-Conversion.aspx 归功于“Tuna Toksoz”

用法先：

```
TConverter.ChangeType<T>(StringValue); 
```

课程如下。

```
public static class TConverter
{
    public static T ChangeType<T>(object value)
    {
        return (T)ChangeType(typeof(T), value);
    }

    public static object ChangeType(Type t, object value)
    {
        TypeConverter tc = TypeDescriptor.GetConverter(t);
        return tc.ConvertFrom(value);
    }

    public static void RegisterTypeConverter<T, TC>() where TC : TypeConverter
    {

        TypeDescriptor.AddAttributes(typeof(T), new TypeConverterAttribute(typeof(TC)));
    }
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-08-12T09:32:06.480

对于许多类型（整数、双精度、日期时间等），有一个静态 Parse 方法。您可以使用反射调用它：

```
MethodInfo m = typeof(T).GetMethod("Parse", new Type[] { typeof(string) } );

if (m != null)
{
    return m.Invoke(null, new object[] { base.Value });
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-07-09T11:26:13.877

```
TypeDescriptor.GetConverter(PropertyObject).ConvertFrom(Value) 
```

`TypeDescriptor`是具有`GetConvertor`接受`Type`对象的方法的类，然后您可以调用`ConvertFrom`方法来转换该`value`指定对象的方法。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2019-03-13T08:00:42.350

[受Bob](https://stackoverflow.com/questions/8625/generic-type-conversion-from-string/31883872#31883872)回答的启发，这些扩展还支持空值转换和所有原始转换。

```
public static class ConversionExtensions
{
        public static object Convert(this object value, Type t)
        {
            Type underlyingType = Nullable.GetUnderlyingType(t);

            if (underlyingType != null && value == null)
            {
                return null;
            }
            Type basetype = underlyingType == null ? t : underlyingType;
            return System.Convert.ChangeType(value, basetype);
        }

        public static T Convert<T>(this object value)
        {
            return (T)value.Convert(typeof(T));
        }
} 
```

例子

```
 string stringValue = null;
            int? intResult = stringValue.Convert<int?>();

            int? intValue = null;
            var strResult = intValue.Convert<string>(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-12T09:23:51.737

您可以使用诸如[特征类](http://www.boost.org/community/generic_programming.html#traits)之类的构造。这样，您将拥有一个参数化的帮助类，该类知道如何将字符串转换为其自己类型的值。那么你的吸气剂可能看起来像这样：

```
get { return StringConverter<DataType>.FromString(base.Value); } 
```

现在，我必须指出，我对参数化类型的经验仅限于 C++ 及其模板，但我想有一些方法可以使用 C# 泛型来做同样的事情。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-08-07T17:53:00.530

检查静电`Nullable.GetUnderlyingType`。- 如果基础类型为null，则模板参数不是`Nullable`，我们可以直接使用该类型 - 如果基础类型不为null，则在转换中使用基础类型。

似乎对我有用：

```
public object Get( string _toparse, Type _t )
{
    // Test for Nullable<T> and return the base type instead:
    Type undertype = Nullable.GetUnderlyingType(_t);
    Type basetype = undertype == null ? _t : undertype;
    return Convert.ChangeType(_toparse, basetype);
}

public T Get<T>(string _key)
{
    return (T)Get(_key, typeof(T));
}

public void test()
{
    int x = Get<int>("14");
    int? nx = Get<Nullable<int>>("14");
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-17T14:51:24.167

```
public class TypedProperty<T> : Property
{
    public T TypedValue
    {
        get { return (T)(object)base.Value; }
        set { base.Value = value.ToString();}
    }
} 
```

我使用通过对象进行转换。这有点简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-03T07:53:13.430

我使用了 lobos 答案，它有效。但是由于文化设置，我在转换**双打**时遇到了问题。所以我加了

```
return (T)Convert.ChangeType(base.Value, typeof(T), CultureInfo.InvariantCulture); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-07T21:26:54.250

又一个变种。处理 Nullables，以及字符串为空且 T*不可*为空的情况。

```
public class TypedProperty<T> : Property where T : IConvertible
{
    public T TypedValue
    {
        get
        {
            if (base.Value == null) return default(T);
            var type = Nullable.GetUnderlyingType(typeof(T)) ?? typeof(T);
            return (T)Convert.ChangeType(base.Value, type);
        }
        set { base.Value = value.ToString(); }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-03-06T13:28:16.957

您可以在一行中完成，如下所示：

```
YourClass obj = (YourClass)Convert.ChangeType(YourValue, typeof(YourClass)); 
```

快乐编码；）

# linux - Globus Toolkit 虚拟机

> ID：8626
> 
> 赞同：2
> 
> 时间：2008-08-12T09:13:40.773
> 
> 标签：linux, virtual-machine, globus-toolkit

有没有地方可以下载一个虚拟机，其中包含一些带有 Globus Toolkit 和一些开发工具 (Java) 的 Linux 发行版的工作安装以用于测试目的？网格的实际部署更为复杂，但我只需要一些可移植的东西来进行开发。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T16:54:29.787

[Virtual Data Toolkit](http://vdt.cs.wisc.edu/)不是虚拟机映像，但它是一个很好的发行版，包含大量易于安装的网格工具（包括 Globus *）*。我一直在使用它，并且喜欢它。

从[他们的网站](http://vdt.cs.wisc.edu/)：

> 虚拟数据工具包 (VDT) 是一组网格软件，可以轻松安装和配置。根据我们的经验，从头开始安装网格软件具有挑战性且耗时。VDT 的目标是让用户尽可能轻松地部署、维护和使用网格软件。理想情况下，您只需键入一个命令，即可立即访问网格资源或将您的资源提供给其他人。实际上，它比这多一点工作，但不多。
> 
> ...
> 
> VDT 包含各种各样的网格软件以及它所依赖的软件。例如，VDT 包括常见的网格软件，如 Condor-G ® 和 Globus ® 以及 VOMS 等等。但它也提供Apache、Tomcat和MySQL等支持软件。还有许多其他有助于运行网格站点的软件组件，例如更新 CA 证书撤销列表的软件 (fetch-crl)、协助本地授权策略 (GUMS) 会计软件的软件等等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-01T12:36:12.553

[http://workspace.globus.org/vm/marketplace.html](http://workspace.globus.org/vm/marketplace.html)的链接现在似乎已断开。我认为新位置是[http://scienceclouds.org/marketplace/](http://scienceclouds.org/marketplace/)。

# c# - 如何在 c# 中从 Windows 服务应用程序清空所有用户的回收站

> ID：8648
> 
> 赞同：4
> 
> 时间：2008-08-12T10:32:40.100
> 
> 标签：c#, recycle-bin

我正在寻找可以插入到 Windows 服务中的 ac# 片段。该代码必须清空计算机上所有用户的回收站。

我以前尝试过使用`SHEmptyRecycleBin`（参考[http://www.codeproject.com/KB/cs/Empty_Recycle_Bin.aspx](http://www.codeproject.com/KB/cs/Empty_Recycle_Bin.aspx)）但是当从 Windows 服务运行时代码不起作用，因为该服务以本地系统权限运行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-12T12:38:28.413

希望你不能。

作为本地机器运行的服务永远不会清除我的回收站。

您可以将服务推广为作为管理员帐户运行，那么它就有权利（并且存在安全风险），但您为什么要这样做？这听起来像是病毒试图做的那种想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T11:07:25.693

我认为这样做违反了微软推荐的做法。你想做什么需要从 Windows 服务清空回收站？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T12:40:35.210

首先，您是否尝试过在交互式用户帐户上运行该服务？也许 SHEmptyRecycleBin 需要一个交互式用户，即使它不一定显示一个窗口。

其次，我不确定删除其他用户的东西是个好主意，但我想你有一个很好的理由？

# asp.net - 导入命名空间 System.Query

> ID：8651
> 
> 赞同：4
> 
> 时间：2008-08-12T10:37:50.107
> 
> 标签：asp.net, linq

我正在尝试通过将以下内容添加到我的 .aspx 页面来在启用了 .Net 3.5 的 Web 服务器上加载 Linq：

```
<%@ Import Namespace="System.Query" %> 
```

但是，这失败并告诉我它找不到命名空间。

> 命名空间“系统”中不存在类型或命名空间名称“查询”

我也试过没有运气：

*   `System.Data.Linq`
*   `System.Linq`
*   `System.Xml.Linq`

我相信 .Net 3.5 之所以有效，是因为它`var hello = "Hello World"`似乎有效。

有人可以帮忙吗？

PS：我只是想澄清一下，我不使用 Visual Studio，我只是有一个[文本编辑器](http://www.ultraedit.com/)并将我的代码直接写入 .aspx 文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T11:15:29.797

> 我在 IIS 中选择了版本 2，我

嗯，这肯定是你的问题吗？选择 3.5。

实际上，这是真实的信息：

[http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T13:13:54.860

您的 web.config 文件的部分是什么样的？

下面是使用 Visual Studio 2008 制作的全新 ASP.NET 3.5 项目的样子：

```
<assemblies>
  <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
  <add assembly="System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
  <add assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
  <add assembly="System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
</assemblies> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T13:15:14.297

我找到了答案 :) 我需要将以下内容添加到我的 web.config 中：

```
<assemblies>  
    <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>  
    <add assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>  
    <add assembly="System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>  
    <add assembly="System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>  
    <add assembly="System.Data.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>
</assemblies> 
```

然后我可以将以下内容添加到我的代码中：

```
<%@ Import Namespace="System.Linq" %> 
```

@将要，

谢谢你的帮助。我接受了你的一个答案:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T10:49:50.503

确保您的项目设置为目标 3.5，而不是 2.0。

正如其他人所说，您的“var”测试是对 C#3（即 VS2008）的测试，而不是 3.5 框架的测试。

如果您正确设置了项目框架目标设置，则此时不应期望需要手动添加 dll 引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T10:44:41.323

这些`var hello`东西是编译器的魔法，可以在没有 Linq 的情况下工作。

尝试添加对`System.Core`

* * *

抱歉，我没说清楚。我的意思是添加`System.Core`到 web 项目的引用，而不是页面。

页面上的`Import`基本上只是 using 语句，允许您跳过页面上的命名空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-11T03:05:40.807

csproj 文件可能缺少 System.Core 引用。在 csproj 文件中查找一行，如下所示：

```
<Reference Include="System" /> 
```

并在它下面添加一行，如下所示：

```
<Reference Include="System.Core" /> 
```

# .net - 使用 String.Format 进行数字格式化

> ID：8653
> 
> 赞同：2
> 
> 时间：2008-08-12T10:40:05.030
> 
> 标签：.net, formatting, numeric

使用 string.format 时是否有任何代码允许数据的数字格式？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T10:42:59.953

加载，坚持使用`string.Format`Google :-)

一个很好的教程是在[iduno](http://web.archive.org/web/20150303084355/http://idunno.org:80/archive/2004/07/14/122.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-12T10:45:13.930

是的，你可以这样格式化：

```
string.Format("Format number to: {0 : #.00}", number);
string.Format("Format date to: {0 : MM/dd/yyyy}", date); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T10:51:10.593

有一个号码。这个 [MS 站点可能是最好的查看地点](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-12T10:51:58.843

这是另一个很好的参考资料，它补充了 Keith 提到的内容。

[http://www.scribd.com/doc/2547864/msnetformattingstrings](http://www.scribd.com/doc/2547864/msnetformattingstrings "http://www.scribd.com/doc/2547864/msnetformattingstrings")

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T10:45:07.860

正如上面基思所说。我最常用的是货币：

```
String.Format("{0:c}", 12000); 
```

这将产生 12,000.00 英镑

# asp.net - 有没有办法回收 Crystal Reports 数据集？

> ID：8669
> 
> 赞同：3
> 
> 时间：2008-08-12T10:54:54.330
> 
> 标签：asp.net, crystal-reports, dataset

我正在尝试编写一个水晶报表，它的总计以与主报表不同的方式分组。到目前为止，我能够做到这一点的唯一方法是使用总计的子报表，但这意味着必须再次点击数据源来检索相同的数据，这似乎是无稽之谈。这是一个简化的示例：

```
 date   name   earnings   source          location
-----------------------------------------------------------
12-AUG-2008   Tom      $50.00   washing cars    uptown
12-AUG-2008   Dick    $100.00   washing cars    downtown     { main report }
12-AUG-2008   Harry    $75.00   mowing lawns    around town

                    total earnings for washing cars: $150.00 { subreport }
                    total earnings for mowing lawns:  $75.00

       date   name   earnings   source          location
-----------------------------------------------------------
13-AUG-2008   John     $95.00   dog walking     downtown
13-AUG-2008   Jane    $105.00   washing cars    around town  { main report }
13-AUG-2008   Dave     $65.00   mowing lawns    around town

                    total earnings for dog walking:   $95.00
                    total earnings for washing cars: $105.00 { subreport }
                    total earnings for mowing lawns:  $65.00 
```

在此示例中，主报表按“日期”分组，但总计另外按“来源”分组。我查找了使用运行总计的示例，但它们并没有真正满足我的需要。难道没有某种方法可以存储结果集并使主报表和子报表都引用相同的数据吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T23:29:57.007

嗯......就像从报告中调用存储的过程并将其全部包含在一个位置一样好，但是我们发现（像您一样）您最终达到了无法获得水晶来做您想做的事情的地步即使数据就在那里。

我们最终引入了位于报表下方的业务层，而不是从报表中“拉”数据，而是将数据集“推送”到它并将数据绑定到报表。优点是您可以在数据到达报表之前在数据集或对象的代码中对其进行操作，然后简单地将数据绑定到报表。

[这篇文章](http://www.codeguru.com/csharp/.net/net_general/toolsand3rdparty/article.php/c13253)很好地介绍了如何设置将数据推送到报告中。我了解您的时间/业务限制可能不允许您这样做，但如果可能的话，我强烈推荐它，因为这意味着我们可以将所有“编码”从我们的报告中删除并放入托管代码中，这总是一件好事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T12:28:06.280

我能想到的唯一方法是在没有第二次遍历数据的情况下这样做，那就是创建一些公式来计算每组的运行总数。我假设您在使用现有运行总计时遇到的问题是它们旨在跟踪它们总计的每个组。由于您似乎希望在所有“原始”数据之后跟随小计，因此这是行不通的。

如果您为每个组创建自己的公式，只需从与组匹配的那些行中添加总计，您应该能够将它们放在报告的末尾。这种方法的缺点是生成的小计与组的关系不是动态的。换句话说，如果您有一个新的“来源”，在您添加它之前它不会出现在小计中，或者如果您没有“遛狗”数据，您仍然会有一个小计。

# .net - 实体框架与 LINQ to SQL

> ID：8676
> 
> 赞同：857
> 
> 时间：2008-08-12T11:04:11.677
> 
> 标签：.net, entity-framework, linq-to-sql

现在 .NET v3.5 SP1 已经发布（连同 VS2008 SP1），我们现在可以访问 .NET 实体框架。

我的问题是这个。当尝试在使用实体框架和 LINQ to SQL 作为 ORM 之间做出决定时，有什么区别？

按照我的理解，实体框架（与 LINQ to Entities 一起使用时）是 LINQ to SQL 的“老大哥”？如果是这种情况 - 它有什么优势？LINQ to SQL 无法单独完成哪些功能？

* * *

## 回答 #1

> 赞同：496
> 
> 时间：2008-09-21T03:22:59.403

LINQ to SQL 仅支持 Microsoft SQL Server 中可用的数据库表、视图、存储过程和函数的 1 对 1 映射。这是一个很棒的 AP​​I，可用于对设计相对良好的 SQL Server 数据库进行快速数据访问构建。LINQ2SQL 最初是随 C# 3.0 和 .Net Framework 3.5 一起发布的。

LINQ to Entities（ADO.Net 实体框架）是一个 ORM（对象关系映射器）API，它允许广泛定义对象域模型及其与许多不同 ADO.Net 数据提供者的关系。因此，您可以混合和匹配许多不同的数据库供应商、应用程序服务器或协议，以设计由各种表、源、服务等构成的对象的聚合混搭。ADO.Net Framework 发布于.Net 框架 3.5 SP1。

这是 MSDN 上一篇很好的介绍性文章： [Introducing LINQ to Relational Data](http://msdn.microsoft.com/en-us/library/cc161164.aspx)

* * *

## 回答 #2

> 赞同：209
> 
> 时间：2008-08-12T16:00:26.243

我认为快速而肮脏的答案是

*   LINQ to SQL 是一种快速简便的方法。这意味着如果您正在处理较小的事情，您将更快地完成并更快地交付。
*   Entity Framework 是一种全力以赴的、无拘无束的方式。这意味着如果您正在处理更大的事情，您将需要更多的前期时间、更慢的开发速度并拥有更大的灵活性。

* * *

## 回答 #3

> 赞同：111
> 
> 时间：2008-11-03T15:53:25.260

[LINQ to SQL 真的死了吗？](http://www.infoq.com/news/2008/11/DLINQ-Future)乔纳森艾伦为 InfoQ.com

> Matt Warren 将 [LINQ to SQL] 描述为“甚至不应该存在的东西”。从本质上讲，它只是用来帮助他们开发 LINQ，直到真正的 ORM 准备好。
> 
> ...
> 
> 实体框架的规模导致它错过了 .NET 3.5/Visual Studio 2008 的最后期限。它是在不幸命名为“.NET 3.5 Service Pack 1”的时候及时完成的​​，它更像是一个主要版本，而不是一个服务包。
> 
> ...
> 
> 由于复杂性，开发人员不喜欢 [ADO.NET Entity Framework]。
> 
> ...
> 
> 从 .NET 4.0 开始，LINQ to Entities 将成为 LINQ to 关系方案的推荐数据访问解决方案。

* * *

## 回答 #4

> 赞同：99
> 
> 时间：2008-08-12T11:15:24.803

@lars 发布的那篇文章中概述了许多明显的差异，但简短的回答是：

*   L2S 是紧密耦合的——对象属性到数据库的特定字段或更正确的对象映射到特定的数据库模式
*   L2S 仅适用于 SQL Server（据我所知）
*   EF 允许将单个类映射到多个表
*   EF 将处理 MM 关系
*   EF 将能够针对任何 ADO.NET 数据提供程序

最初的前提是 L2S 用于快速开发，而 EF 用于更多“企业级”n 层应用程序，但这就是销售 L2S 有点短。

* * *

## 回答 #5

> 赞同：82
> 
> 时间：2015-04-21T08:26:32.470

## LINQ 到 SQL

1.  同构数据源：SQL Server
2.  仅推荐用于数据结构设计良好的小型项目
3.  无需使用 SqlMetal.exe 重新编译即可更改映射
4.  .dbml（数据库标记语言）
5.  表和类之间的一对一映射
6.  支持[TPH](https://msdn.microsoft.com/en-us/library/vstudio/bb399352%28v=vs.100%29.aspx)继承
7.  不支持复杂类型
8.  存储优先方法
9.  以数据库为中心的数据库视图
10.  由 C# 团队创建
11.  支持但不打算进一步改进

## 实体框架

1.  异构数据源：[支持众多数据提供者](https://msdn.microsoft.com/en-us/data/jj730568#providers)
2.  推荐用于所有新项目，除了：
    *   小的（LINQ to SQL）
    *   当数据源是平面文件 (ADO.NET)
3.  将模型和映射文件元数据工件过程设置为复制到输出目录时，无需重新编译即可更改映射
4.  .edmx（实体数据模型），其中包含：
    *   SSDL（存储模式定义语言）
    *   CSDL（概念模式定义语言）
    *   MSL（映射规范语言）
5.  表和类之间的一对一、一对多、多对一映射
6.  支持继承：
    *   TPH（每个层次结构的表）
    *   TPT（每种类型的表格）
    *   TPC（每个混凝土等级的表）
7.  支持复杂类型
8.  代码优先、模型优先、存储优先的方法
9.  以应用程序为中心的数据库视图
10.  由 SQL Server 团队创建
11.  Microsoft 数据 API 的未来

* * *

也可以看看：

*   [LINQ To SQL 与实体框架](http://jinaldesai.net/linq-to-sql-vs-entity-framework/)
*   [LINQ to SQL 和实体框架之间的区别](http://www.dotnet-tricks.com/Tutorial/entityframework/1M5W300314-Difference-between-LINQ-to-SQL-and-Entity-Framework.html)
*   [实体框架与 LINQ TO SQL](http://blogs.msdn.com/b/swiss_dpe_team/archive/2008/11/06/entity-framework-vs-linq-to-sql.aspx)

* * *

## 回答 #6

> 赞同：53
> 
> 时间：2008-12-08T03:50:54.467

我在实体框架方面的经验并不出色。首先，您必须从 EF 基类继承，所以告别 POCO。您的设计必须围绕 EF。使用 LinqtoSQL，我可以使用我现有的业务对象。此外，没有延迟加载，您必须自己实现。有一些解决方法可以使用 POCO 和延迟加载，但恕我直言，它们存在，因为 EF 还没有准备好。我打算在4.0之后回来

* * *

## 回答 #7

> 赞同：47
> 
> 时间：2012-03-23T15:52:54.357

[我在这里](http://www.dofactory.com/topic/1077/when-to-use-linq-to-sql-versus-entity-framework.aspx)找到了一个很好的答案，它解释了何时使用简单的词语：

> 使用哪个框架的基本经验法则是如何计划在表示层中编辑数据。
> 
> *   **Linq-To-Sql** - 如果您计划在表示层中编辑数据的一对一关系，请使用此框架。这意味着您不打算在任何一个视图或页面中组合来自多个表的数据。
>     
>     
> *   **实体框架**- 如果您计划在视图或页面中组合来自多个表的数据，请使用此框架。为了更清楚地说明这一点，上述术语特定于将在您的视图或页面中操作的数据，而不仅仅是显示。理解这一点很重要。
>     
>     
> 
> 使用实体框架，您可以将表格数据“合并”在一起，以可编辑的形式呈现给表示层，然后在提交该表单时，EF 将知道如何更新各个表中的所有数据。
> 
> 选择 EF 而不是 L2S 可能有更准确的理由，但这可能是最容易理解的。L2S 不具备合并数据以进行视图呈现的能力。

* * *

## 回答 #8

> 赞同：37
> 
> 时间：2008-11-21T19:52:18.230

我的印象是，如果 Linq2Sql 不符合您的需求，您的数据库非常庞大或设计非常糟糕。我有大约 10 个大大小小的网站都使用 Linq2Sql。我已经多次查看实体框架，但我找不到在 Linq2Sql 上使用它的充分理由。也就是说，我尝试将我的数据库用作模型，因此我已经在模型和数据库之间建立了一对一的映射。

在我目前的工作中，我们有一个包含 200 多个表的数据库。一个有很多糟糕解决方案的旧数据库，所以我可以看到 Entity Framework 优于 Linq2Sql 但我仍然更愿意重新设计数据库，因为数据库是应用程序的引擎，如果数据库设计不当并且速度较慢，那么我的应用程序也会很慢。在这样的数据库上使用实体框架似乎是掩饰坏模型的快速修复，但它永远无法掩饰你从这样的数据库中获得的糟糕性能。

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2015-08-31T20:07:51.340

**你可以在这里找到一个很好的比较：**

[![在此处输入图像描述](https://i.stack.imgur.com/TW8YY.jpg)](https://i.stack.imgur.com/TW8YY.jpg)

[http://www.dotnet-tricks.com/Tutorial/entityframework/1M5W300314-Difference-between-LINQ-to-SQL-and-Entity-Framework.html](http://www.dotnet-tricks.com/Tutorial/entityframework/1M5W300314-Difference-between-LINQ-to-SQL-and-Entity-Framework.html)

[http://www.c-sharpcorner.com/blogs/entity-framework-vs-linq-to-sql1](http://www.c-sharpcorner.com/blogs/entity-framework-vs-linq-to-sql1)

* * *

## 回答 #10

> 赞同：24
> 
> 时间：2014-03-17T03:19:58.573

这里的答案涵盖了 Linq2Sql 和 EF 之间的许多差异，但有一个关键点没有引起太多关注：Linq2Sql 仅支持 SQL Server，而 EF 具有以下 RDBMS 的提供程序：

微软提供：

*   用于 SQL Server、OBDC 和 OLE DB 的 ADO.NET 驱动程序

通过第三方提供商：

*   MySQL
*   甲骨文
*   DB2
*   维斯塔数据库
*   SQLite
*   PostgreSQL
*   Informix
*   U2
*   赛贝斯
*   协同效应
*   火鸟
*   Npgsql

仅举几例。

这使得 EF 成为对关系数据存储的强大编程抽象，这意味着无论底层数据存储如何，开发人员都可以使用一致的编程模型。这在您正在开发一个希望确保与广泛的常见 RDBMS 互操作的产品的情况下非常有用。

这种抽象很有用的另一种情况是，您是一个开发团队的一员，该团队与许多不同的客户或组织内的不同业务部门合作，并且您希望通过减少他们必须成为的 RDBMS 的数量来提高开发人员的生产力熟悉以便在不同的 RDBMS 之上支持一系列不同的应用程序。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2011-02-17T15:36:00.257

我发现在使用 EF 时，我无法在同一个数据库模型中使用多个数据库。但是在 linq2sql 中，我可以通过在模式名称前面加上数据库名称。

这是我最初开始使用 linq2sql 的原因之一。我不知道 EF 是否还允许此功能，但我记得读过它的本意是不允许此功能。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2008-09-17T07:22:11.883

如果您的数据库简单明了，LINQ to SQL 就可以了。如果您需要表格顶部的逻辑/抽象实体，请选择实体框架。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2009-04-19T05:48:50.900

两者都不支持唯一的 SQL 2008 数据类型。从我的角度来看，不同之处在于 Entity 在未来的某个版本中仍然有机会围绕我的地理数据类型构建模型，而 Linq to SQL 被放弃，永远不会。

想知道 nHibernate 或 OpenAccess 是怎么回事……

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2009-03-14T16:53:31.197

我认为，如果您需要快速开发一些中间没有奇怪的东西的东西，并且您需要该工具来拥有代表您的表的实体：

Linq2Sql 可以成为一个很好的盟友，将它与 LinQ 一起使用会释放出一个很好的发展时机。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2017-05-07T17:43:56.373

我正在为有一个使用 Linq-to-SQL 的大项目的客户工作。在项目开始时，它是显而易见的选择，因为当时 Entity Framework 缺少一些主要功能，而 Linq-to-SQL 的性能要好得多。

现在 EF 已经发展，而 Linq-to-SQL 缺乏异步支持，这对于高度可扩展的服务来说非常有用。我们有时每秒有 100 多个请求，尽管我们已经优化了数据库，但大多数查询仍然需要几毫秒才能完成。由于同步数据库调用，线程被阻塞并且不能用于其他请求。

我们正在考虑切换到实体框架，仅用于此功能。遗憾的是，微软没有在 Linq-to-SQL 中实现异步支持（或者开源它，所以社区可以做到）。

**2018 年 12 月附录：** Microsoft 正在向 .NET Core 迁移，而 Linq-2-SQL 在 .NET Core 上不受支持，因此您需要迁移到 EF 以确保将来可以迁移到 EF.Core。

还有一些其他选项需要考虑，例如[LLBLGen](https://www.llblgen.com/)。这是一个成熟的 ORM 解决方案，已经存在很长时间，并且被证明比 MS 数据解决方案（ODBC、ADO、ADO.NET、Linq-2-SQL、EF、EF.core）更具前瞻性。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-02-21T05:36:24.217

> Linq 到 SQL

*它是仅支持 SQL Server 的提供程序。这是一种将 SQL Server 数据库表映射到 .NET 对象的映射技术。是微软在 ORM 上的第一次尝试——对象关系映射器。*

> 链接到实体

*是相同的想法，但在后台使用实体框架，作为 ORM - 再次来自微软，它支持多个数据库实体框架的主要优点是开发人员可以在任何数据库上工作，无需学习语法来对不同的不同数据库执行任何操作*

> 根据我的个人经验，与用 lambda 编写的 EF 原因 LINQ 语言相比，LINQ 中的性能更好（如果您不了解 SQL）性能要快一些。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2020-08-18T20:44:51.757

**这里有一些指标家伙......（量化的东西！！！！）**

我在使用实体框架的地方进行了这个查询

```
var result = (from metattachType in _dbContext.METATTACH_TYPE
                join lineItemMetattachType in _dbContext.LINE_ITEM_METATTACH_TYPE on metattachType.ID equals lineItemMetattachType.METATTACH_TYPE_ID
                where (lineItemMetattachType.LINE_ITEM_ID == lineItemId && lineItemMetattachType.IS_DELETED == false
                && metattachType.IS_DELETED == false)
                select new MetattachTypeDto()
                {
                    Id = metattachType.ID,
                    Name = metattachType.NAME
                }).ToList(); 
```

并将其更改为我使用存储库模式 Linq 的位置

```
 return await _attachmentTypeRepository.GetAll().Where(x => !x.IsDeleted)
                .Join(_lineItemAttachmentTypeRepository.GetAll().Where(x => x.LineItemId == lineItemId && !x.IsDeleted),
                attachmentType => attachmentType.Id,
                lineItemAttachmentType => lineItemAttachmentType.MetattachTypeId,
                (attachmentType, lineItemAttachmentType) => new AttachmentTypeDto
                {
                    Id = attachmentType.Id,
                    Name = attachmentType.Name
                }).ToListAsync().ConfigureAwait(false); 
```

linq 到 sql

```
 return (from attachmentType in _attachmentTypeRepository.GetAll()
                    join lineItemAttachmentType in _lineItemAttachmentTypeRepository.GetAll() on attachmentType.Id equals lineItemAttachmentType.MetattachTypeId
                    where (lineItemAttachmentType.LineItemId == lineItemId && !lineItemAttachmentType.IsDeleted && !attachmentType.IsDeleted)
                    select new AttachmentTypeDto()
                    {
                        Id = attachmentType.Id,
                        Name = attachmentType.Name
                    }).ToList(); 
```

另外，请知道 Linq-to-Sql 比 Linq 快 14 倍...

[![在此处输入图像描述](https://i.stack.imgur.com/TkWAZ.jpg)](https://i.stack.imgur.com/TkWAZ.jpg)

# jquery - Opera 中的 JQuery.Validate 失败

> ID：8681
> 
> 赞同：14
> 
> 时间：2008-08-12T11:11:29.680
> 
> 标签：jquery, validation, opera

如果您使用的是 Opera 9.5x，您可能会注意到我们的客户端[JQuery.Validate](http://docs.jquery.com/Plugins/Validation)代码在 Stack Overflow 被禁用。

```
function initValidation() {
    if (navigator.userAgent.indexOf("Opera") != -1) return;
    $("#post-text").rules("add", { required: true, minlength: 5 });
} 
```

那是因为它在 Opera 中产生了异常！当然，它适用于我们尝试过的所有其他浏览器。我开始认真，认真地讨厌 Opera。

这有点令人沮丧，因为如果没有适当的客户端验证，我们的一些请求将会失败。当数据不完整时，我们没有时间输入完整的服务器端消息传递，因此如果您忘记填写表单上的所有字段，**您可能会在 Opera 上看到比其他浏览器更多的 YSOD 。**

任何 Opera 用户都想取消注释这些行（它们位于像这样的核心“问答”页面上——只需查看源代码并搜索`"Opera"`）并试一试？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-12T21:41:17.363

原来问题出在

```
{ debug : true } 
```

JQuery.Validate 初始化程序的选项。**删除这个之后，Opera 就可以正常工作了。**感谢 Jörn Zaefferer 帮助我们解决这个问题！

哦，这 50 美元将捐赠给 JQuery 项目。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-12T21:46:43.250

我不在 .NET 上，但我猜 YSOD 意味着未捕获的错误，如果是这种情况，那么单独依赖客户端验证是否有点冒险？如果不是这样，那么捕获的错误可以转换为对 Opera 人群有用的东西——即使它只是一个涂成白色并带有验证抱怨的死亡屏幕......

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-08-12T12:00:24.010

我似乎无法重现此错误。你能提供更多细节吗？

我有伪装成 Firefox 的 Opera 副本，因此应该执行验证：

```
>>> $.browser.opera 
false 
```

当我进入编辑个人资料页面并输入格式错误的日期时，会出现红色文本并显示“请输入有效日期”。那是 jQuery.Validate 工作，对吧？它只在某些表单/字段上失败吗？

这是 WinXP 上的 Opera 9.51。

编辑：在 Opera 上测试编辑。

编辑：当我注释掉“if ($.browser.opera) return;”时它也有效 我在本地保存的编辑个人资料页面的副本上的行。我真的无法重现这个错误。你的环境是什么样的？（Vista？Opera 插件？）

# php - 使用 strtotime() 推进相对日期

> ID：8685
> 
> 赞同：7
> 
> 时间：2008-08-12T11:14:27.660
> 
> 标签：php, date, strtotime

我试图用来`strtotime()`响应按钮单击以相对于上一次单击前进的日期提前 -1 天和 +1 天（两个按钮）。

**例子：**

*   现在是10号，我点击“-1天”按钮，现在日期显示为9号。
*   我再次单击“-1 天”按钮，现在读数显示第 8 天。
*   我单击“+1 天”按钮，现在读数显示它是第 9 天。

我了解按钮和显示日期以及使用`$_GET`PHP 来传递信息，但是如何`strtotime()`从上次调用时间旅行脚本的相对日期开始工作？

到目前为止，我的工作让我展示了相对于*现在*的昨天和今天，而不是相对于例如*前天*或*后天*。或者，如果我使用我的**“上周一”**按钮，那么无论那一天是前一天还是后一天。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-22T04:02:03.170

从以前的调用到相同的脚本工作对于这种类型的事情来说并不是一个好主意。

您想要做的是始终将两个值传递给您的脚本，日期和运动。（下面的例子被简化了，所以你只传递日期，它总是会增加一天）

例子

[http://www.site.com/addOneDay.php?date=1999-12-31](http://www.site.com/addOneDay.php?date=1999-12-31)

```
<?php
   echo Date("Y-m-d",(strtoTime($_GET[date])+86400));
?> 
```

请注意，您也应该检查以确保 isset($_GET[date]) 之前

如果你真的想从以前的调用中工作到同一个脚本，你将不得不用会话来做，所以请指定是否是这种情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T11:23:28.733

凯文，你工作的是一个坚实的绝对基础（即日期/时间），而不是相对时间段。然后转换为相对时间段。因此，例如，默认情况下，如果您显示日历，您将从今天开始工作。

```
int strtotime  ( string $time  [, int $now  ] ) 
```

您可以在strtotime的函数定义中看到，第二个参数是现在，即您可以更改它的相对日期。

这可能更容易通过快速循环显示

这将使用“昨天”作为第一个参数循环过去 10 天。然后我们使用日期打印出来。

```
$time = time();

for ($i = 0; $i < 10; $i++) {
    $time = strtotime("yesterday", $time);
    print date("r", $time) . "\n";
} 
```

因此，通过 URI 传递时间/日期，以便您可以保存相对日期。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-14T17:37:54.790

经过片刻的灵感，我的问题的解决方案对我来说变得很明显（我正在骑自行车）。的 '$now' 部分

```
strtottime( string $time {,int $now ]) 
```

需要设置为当前日期。不是“$time()-now”，而是“我关心的当前日期/我正在查看我的日志。

即：如果我正在查看 2008 年 8 月 10 日的时间表摘要，那么根据 strtotime()，那就是“现在”；昨天是 8/09，明天是 8/11。有一天我爬起来，“现在”是 8/11，昨天是 8/10，明天是 8/12。

这是代码示例：

```
<?php

//catch variable
$givendate=$_GET['given'];

//convert given date to unix timestamp
$date=strtotime($givendate);
echo "Date Set As...: ".date('m/d/Y',$date)."<br />";

//use given date to show day before
$yesterday=strtotime('-1 day',$date);
echo "Day Before: ".date('m/d/Y',$yesterday)."<br />";

//same for next day
$tomorrow=strtotime('+1 day',$date);
echo "Next Day: ".date('m/d/Y',$tomorrow)."<br />";
$lastmonday=strtotime('last monday, 1 week ago',$date);
echo "Last Moday: ".date('D m/d/Y',$lastmonday)."<br />";

//form
echo "<form method=\"get\" action=\"{$_SERVER['PHP_SELF']}\">";

//link to subtract a day
echo "<a href=\"newtimetravel.php?given=".date('m/d/Y',$yesterday)."\"><< </a>";

//show current day
echo "<input type=\"text\" name=\"given\" value=\"$givendate\">";

//link to add a day
echo "<a href=\"newtimetravel.php?given=".date('m/d/Y',$tomorrow)."\"> >></a><br />";

//submit manually entered day
echo "<input type=\"submit\" name=\"changetime\" value=\"Set Current Date\">";

//close form
echo "<form><br />";
?> 
```

点击“<<”和“>>”进退相关日期

# visual-studio - 在“D”驱动器上安装 Visual Studio 2008 Sp1

> ID：8688
> 
> 赞同：4
> 
> 时间：2008-08-12T11:20:43.887
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2008-sp1

我正在尝试将 VS2008 sp1 安装到我的工作机器上——它有一个可怜的 10Gb C 驱动器。SP1 引导程序没有提供将项目安装到 D 的选项，只有 C。它需要 3Gb 空闲空间，机器只有大约 700Mb。

VS让我装到D原来为什么不装SP。我能想到的唯一一件事是它需要在 Windows 等中安装系统文件，但我不敢相信有 3Gb 的系统文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-15T16:27:40.600

值得一读：

[http://blogs.msdn.com/heaths/archive/2008/07/24/why-windows-installer-may-require-so-much-disk-space.aspx](http://blogs.msdn.com/heaths/archive/2008/07/24/why-windows-installer-may-require-so-much-disk-space.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T17:12:39.077

我遇到了同样的问题，最终将我的 Outlook archive.pst 和 windows.edb（新的实时搜索索引文件）移到 D: 以腾出空间，而不是试图将方形钉塞进圆孔中SP1 拆分驱动器。在这方面一个巨大的帮助是[WinDirStat](http://windirstat.info/)，它扫描您选择的驱动器并识别每个文件夹和文件的大小，以便您可以显示一些随机的大型实体并尽可能移动它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T11:54:49.483

如果您有一个空分区，您可以尝试[创建一个挂载驱动器](http://support.microsoft.com/kb/307889)（即将该分区映射到 C: 驱动器上的一个空文件夹）并查看 SP1 引导程序是否能够使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-30T19:26:02.557

我在 C: 驱动器上只有 20gb 的服务器上也遇到了同样的问题。我找到了一种释放足够空间来完成工作的方法，方法是重新分配系统的虚拟内存分配以使用 D: 驱动器而不是 C:。在我的情况下，这释放了大约 4gb。

在 Windows XP 上，可以在“我的电脑”系统属性、“高级”选项卡、“性能选项”中进行设置：http: [//support.microsoft.com/kb/308417](http://support.microsoft.com/kb/308417)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-11T22:31:37.530

安装在 C: 驱动器上的 VS2008 大小仅为 12Gb，我遇到了同样的问题。

我按照此页面中的手动步骤完全卸载了 VS2008，然后使用自动卸载程序：

[http://msdn.microsoft.com/en-us/vstudio/bb968856.aspx](http://msdn.microsoft.com/en-us/vstudio/bb968856.aspx)

然后我重新启动了机器。

然后我在 E: 驱动器上重新安装了 VS2008。

然后我重新启动了机器。

然后我就可以安装 SP1 - 因为现在它在 C: 驱动器上不需要那么多空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T12:59:56.903

当您说“10Gb C 驱动器”时，您的意思是它是 10-gig 磁盘还是分区？如果是前者，你真的应该考虑更换驱动器 - 它很*旧*，我开始担心它的寿命有多长。

如果是后者，那么假设 C: 驱动器限制不容易解决，那么我会考虑增加 C: 分区的大小。根据驱动器剩余部分的装满程度，这可能需要一段时间。我还考虑花几十美元（我猜是 40 美元或 50 美元）购买 Acronis 或 Paragon 之类的分区管理器。在您完成一天的工作之前启动它 - 这可能需要几个小时，尤其是在磁盘相当满的情况下。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-12T14:54:02.070

您是升级当前版本还是卸载了 VS 2008 Gold？默认情况下，如果安装了任何现有版本的 VS，安装程序不会让您更改目录。

要移动安装，您需要卸载已安装的所有 2008 版本（包括所有 Express 版本），然后应启用选择安装位置选项。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-12T16:41:51.540

我隐约记得我在 VS 2008 之前先安装了 Office 2007 时发生过这种情况。我不记得我为 Office 2007 安装了哪些选项。

更新：我现在记得这与我已经安装了 Visual Studio Tools for Office 的事实有关。当我升级我的计算机时，我通过在安装 Office 2007 和 VSTO 之前安装 VS 2008 对所有内容进行了全新安装，没有出现任何问题。因此，您很可能必须卸载导致 VS 2008 想要转到特定驱动器的任何内容。

即使您确实让它切换驱动器，它仍然会在系统驱动器上放置很多东西。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-08-12T14:44:11.823

你也可以从[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=27673c47-b3b5-4c67-bd99-84e525b5ce61&displaylang=en)下载完整的 VS2008 SP1 ISO 镜像。

然后，您可以将其刻录到 DVD 或使用[Microsoft 的 Virtual CD-ROM 控制面板](http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe)等工具将 ISO 挂载为另一个驱动器。

将 ISO 挂载为虚拟驱动器后，您可以从那里运行 SP1 安装。

# c# - 用户控件属性设计器属性

> ID：8691
> 
> 赞同：10
> 
> 时间：2008-08-12T11:25:41.227
> 
> 标签：c#, user-controls, windows-mobile

对于 Windows Mobile 上的 C# UserControl（尽管如果您知道它适用于完整的 Windows，请回答...它可能会起作用）您如何更改控件的公共属性之一的“设计器属性”窗口中显示的内容。例如：

```
private Color blah = Color.Black;

public Color Blah
{
    get { return this.blah; }
    set { this.blah = value; }
} 
```

这显示在控件中，但它属于“杂项”类别，没有描述或默认值。我尝试使用 System.ComponentModel 中的设置，例如“DesignerCategory”，例如：

```
[DesignerCategory("Custom")] 
```

但是说这仅对类声明有效...可以发誓这是我以前使用的 System.ComponentModel 项...

### 更新：

@John 说：

> DesignerCatogy 用于说明该类是否为表单、组件等。
> 
> 试试这个：
> 
> [类别（“自定义”）]

我需要使用特定的命名空间来获取它们吗？我已经完全尝试过了，编译器无法识别它们。

在 .NETCF 中，我似乎可以从 System.ComponentModel 获得的只是：

```
DataObject,
DataObjectMethod,
DefaultValue,
DesignerCategory,
DesignTimeVisible,
EditorBrowsable 
```

唯一不会尖叫的是 EditorBrowsable

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T11:29:40.610

`DesignerCategory`用于表示类是否为表单、组件等。

对于完整的窗口，您想要的属性是：

```
[System.ComponentModel.Category("Custom")] 
```

对于您可以使用的描述`[System.ComponentModel.Description("This is the description")]`

两者一起使用：

```
[System.ComponentModel.Category("Custom"),System.ComponentModel.Description("This is the description")] 
```

但是，`system.dll`这对于 Windows Mobile 可能有所不同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-12T11:51:49.753

这对你有用吗？我不喜欢 CF 开发，但看起来您需要添加一些 XML 元数据来启用它：

[http://blogs.msdn.com/bluecollar/archive/2007/02/08/adding-compact-framework-design-time-attributes-or-more-fun-with-textboxes.aspx](http://blogs.msdn.com/bluecollar/archive/2007/02/08/adding-compact-framework-design-time-attributes-or-more-fun-with-textboxes.aspx)

有趣的阅​​读.. 看起来很多设计时支持都从 CF 中剥离出来，因为您没有在设备上设计它们.. 这对我来说似乎有点奇怪.. 无法想象使用手持设备作为开发平台！

向下滚动大约一半的好东西;）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-28T04:23:57.197

这篇文章并不暗示任何人在设备上进行设计。但是，当您创建 Compact Framework 项目时，Compact 框架（适用于您的台式 PC）用于处理设计时渲染。如果您考虑一下，这就是您所期望的。相同的框架（或几乎如此）用于在设计时在您的 PC 上进行渲染，然后在运行时在设备上进行渲染。问题是设计时属性没有添加到紧凑框架中（我假设要减小大小）。

# python - 如何在 Python 中使用 XPath？

> ID：8692
> 
> 赞同：244
> 
> 时间：2008-08-12T11:28:36.900
> 
> 标签：python, xml, dom, xpath, python-2.x

支持 XPath 的库有哪些？有完整的实现吗？图书馆是如何使用的？它的网站在哪里？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2008-08-26T13:06:39.587

[libxml2](http://xmlsoft.org/python.html)有很多优点：

1.  符合[规范](http://www.w3.org/TR/xpath)
2.  积极发展和社区参与
3.  速度。这实际上是一个围绕 C 实现的 python 包装器。
4.  无处不在。libxml2 库无处不在，因此经过了很好的测试。

缺点包括：

1.  符合[规范](http://www.w3.org/TR/xpath)。很严格。像默认命名空间处理这样的事情在其他库中更容易。
2.  使用本机代码。这可能会很痛苦，具体取决于您的应用程序是如何分布/部署的。RPM 可以减轻这种痛苦。
3.  手动资源处理。请注意下面的示例中对 freeDoc() 和 xpathFreeContext() 的调用。这不是很 Pythonic。

如果您正在进行简单的路径选择，请坚持使用[ElementTree](http://effbot.org/zone/element-xpath.htm)（包含在 Python 2.5 中）。如果您需要完整的规范合规性或原始速度并且可以处理本机代码的分发，请使用 libxml2。

**libxml2 XPath 使用示例**

* * *

```
import libxml2

doc = libxml2.parseFile("tst.xml")
ctxt = doc.xpathNewContext()
res = ctxt.xpathEval("//*")
if len(res) != 2:
    print "xpath query: wrong node set size"
    sys.exit(1)
if res[0].name != "doc" or res[1].name != "foo":
    print "xpath query: wrong node set value"
    sys.exit(1)
doc.freeDoc()
ctxt.xpathFreeContext() 
```

**ElementTree XPath 使用示例**

* * *

```
from elementtree.ElementTree import ElementTree
mydoc = ElementTree(file='tst.xml')
for e in mydoc.findall('/foo/bar'):
    print e.get('title').text
```

* * *

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2008-08-12T11:40:13.630

[lxml 包](http://lxml.de/)支持xpath。它似乎工作得很好，虽然我在 self:: 轴上遇到了一些麻烦。还有[Amara](http://pypi.python.org/pypi/Amara/1.1.6)，但我个人没有用过。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2012-11-22T01:05:52.597

听起来像这里的 lxml 广告。;) ElementTree 包含在标准库中。在 2.6 及以下它的 xpath 非常弱，但在[2.7+ 中得到很大改进](http://docs.python.org/2/library/xml.etree.elementtree.html#xpath-support)：

```
import xml.etree.ElementTree as ET
root = ET.parse(filename)
result = ''

for elem in root.findall('.//child/grandchild'):
    # How to make decisions based on attributes even in 2.6:
    if elem.attrib.get('name') == 'foo':
        result = elem.text
        break 
```

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2009-11-13T23:11:17.117

使用 LXML。LXML 使用 libxml2 和 libxslt 的全部功能，但将它们包装在比这些库本地的 Python 绑定更多的“Pythonic”绑定中。因此，它获得了完整的 XPath 1.0 实现。Native ElemenTree 支持有限的 XPath 子集，尽管它可能足以满足您的需要。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2010-01-23T09:30:19.943

另一个选项是[py-dom-xpath](http://code.google.com/p/py-dom-xpath/)，它可以与 minidom 无缝协作，并且是纯 Python，因此可以在 appengine 上运行。

```
import xpath
xpath.find('//item', doc) 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2010-08-23T13:00:01.183

您可以使用：

**PyXML**：

```
from xml.dom.ext.reader import Sax2
from xml import xpath
doc = Sax2.FromXmlFile('foo.xml').documentElement
for url in xpath.Evaluate('//@Url', doc):
  print url.value 
```

**libxml2**：

```
import libxml2
doc = libxml2.parseFile('foo.xml')
for url in doc.xpathEval('//@Url'):
  print url.content 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-11-15T05:31:21.340

您可以使用简单`soupparser`的`lxml`

## 例子：

```
from lxml.html.soupparser import fromstring

tree = fromstring("<a>Find me!</a>")
print tree.xpath("//a/text()") 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-08-14T09:48:59.547

最新版本的[elementtree](http://effbot.org/zone/element-xpath.htm)很好地支持 XPath。我不是 XPath 专家，我不能确定实现是否完整，但它满足了我在 Python 中工作时的大部分需求。我还使用了 lxml 和 PyXML，我发现 etree 很好，因为它是一个标准模块。

注意：我已经找到了 lxml，对我来说它绝对是 Python 最好的 XML 库。它也很好地执行 XPath（尽管可能不是完整的实现）。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2017-12-16T22:16:20.860

如果您想拥有 XPATH 的强大功能以及在任何时候也使用 CSS 的能力，您可以使用[`parsel`](https://github.com/scrapy/parsel)：

```
>>> from parsel import Selector
>>> sel = Selector(text=u"""<html>
        <body>
            <h1>Hello, Parsel!</h1>
            <ul>
                <li><a href="http://example.com">Link 1</a></li>
                <li><a href="http://scrapy.org">Link 2</a></li>
            </ul
        </body>
        </html>""")
>>>
>>> sel.css('h1::text').extract_first()
'Hello, Parsel!'
>>> sel.xpath('//h1/text()').extract_first()
'Hello, Parsel!' 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-08-23T12:57:47.803

另一个库是 4Suite：http: [//sourceforge.net/projects/foursuite/](http://sourceforge.net/projects/foursuite/)

我不知道它是否符合规范。但它对我的使用效果很好。它看起来被遗弃了。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-08-12T19:34:44.127

[PyXML](http://pyxml.sourceforge.net "PyXML")运行良好。

你没有说你使用的是什么平台，但是如果你在 Ubuntu 上，你可以使用`sudo apt-get install python-xml`. 我确信其他 Linux 发行版也有它。

如果您使用的是 Mac，则 xpath 已安装但无法立即访问。您可以`PY_USE_XMLPLUS`在导入 xml.xpath 之前在您的环境中设置或使用 Python 方式进行设置：

```
if sys.platform.startswith('darwin'):
    os.environ['PY_USE_XMLPLUS'] = '1' 
```

在最坏的情况下，您可能必须自己构建它。这个包不再维护，但仍然可以很好地构建，并且可以与现代 2.x Python 一起使用。基本文档在[这里](http://pyxml.sourceforge.net/topics/howto/section-XPath.html)。

# exception - 混合本机/托管可执行文件中的最终托管异常处理程序？

> ID：8704
> 
> 赞同：7
> 
> 时间：2008-08-12T11:48:52.850
> 
> 标签：exception, executable, mixed, unhandled

我有一个用 /clr 编译的 MFC 应用程序，我正在尝试为其他未捕获的托管异常实现最终处理程序。对于本机异常，覆盖`CWinApp::ProcessWndProcException`有效。

Jeff 的[CodeProject 文章](http://www.codeproject.com/KB/exception/ExceptionHandling.aspx)中建议的两个事件,`Application.ThreadException`和`AppDomain.CurrentDomain.UnhandledException`, 没有引发。

谁能建议一种为混合可执行文件提供最终托管异常处理程序的方法？

* * *

更新：

似乎这些异常处理程序仅在下游`Application.Run`或类似情况下触发（有工作线程风格，不记得名称。）如果您想真正全局捕获托管异常，则需要安装 SEH 过滤器。你不会得到一个`System.Exception`，如果你想要一个调用堆栈，你将不得不滚动你自己的助行器。

在有关此主题的 MSDN 论坛问题中，建议覆盖`try ... catch (Exception^)`. 例如，`CWinApp::Run`. 这可能是一个很好的解决方案，但我没有研究过任何性能或稳定性影响。在保释之前，您将有机会使用调用堆栈进行日志记录，并且可以避免默认的 windows unahndled 异常行为。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T19:25:41.983

浏览一下 Internet，您会发现您需要安装一个过滤器，以使非托管异常在到达您的 AppDomain 的过程中通过过滤器。从[CLR 和未处理的异常过滤器](http://blogs.microsoft.co.il/blogs/sasha/archive/2007/12/30/clr-and-unhandled-exception-filters.aspx)：

> CLR 依靠 SEH 未处理的异常过滤器机制来捕获未处理的异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-18T19:55:42.193

> 使用这两个异常处理程序应该可以工作。

为何要？”

不使用以下方法引发事件：

```
extern "C" void wWinMainCRTStartup();

// managed entry point
[System::STAThread]
int managedEntry( void )
{
    FinalExceptionHandler^ handler = gcnew FinalExceptionHandler();

    Application::ThreadException += gcnew System::Threading::ThreadExceptionEventHandler(
                                        handler,
                                        &FinalExceptionHandler::OnThreadException);

    AppDomain::CurrentDomain->UnhandledException += gcnew UnhandledExceptionEventHandler(
                                                        handler,
                                                        &FinalExceptionHandler::OnAppDomainException);

    wWinMainCRTStartup();

    return 0;
}

// final thread exception handler implementation
void FinalExceptionHandler::OnThreadException( Object^ /* sender */, System::Threading::ThreadExceptionEventArgs^ t )
{
    LogWrapper::log->Error( "Unhandled managed thread exception.", t->Exception );
}

// final appdomain exception handler implementation
void FinalExceptionHandler::OnAppDomainException(System::Object ^, UnhandledExceptionEventArgs ^args)
{
    LogWrapper::log->Error( "Unhandled managed appdomain exception.", (Exception^)(args->ExceptionObject) );
}

BOOL CMyApp::InitInstance()
{
    throw gcnew Exception("test unhandled");
    return TRUE;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-13T03:10:36.670

使用这两个异常处理程序应该可以工作。您确定您已将它们添加到它们将被调用并正确设置的位置（即，在您的应用程序的*托管*入口点中 - 您确实放入了一个，对吗？）

# database - 检测数据库访问

> ID：8715
> 
> 赞同：6
> 
> 时间：2008-08-12T12:01:01.780
> 
> 标签：database, logging, instrumentation

Jeff 在其中一个播客中提到，他经常做的一件事是对数据库调用进行检测，这样他就可以判断是哪些查询导致了缓慢等。这是我过去使用 SQL Profiler 测量过的，但是我对其他人使用什么策略将其包含在应用程序中很感兴趣。

这仅仅是在每个数据库调用中包含一个计时器并记录结果的情况，还是有一种“更简洁”的方法？也许已经有一个框架可以为您执行此操作，或者是否有一个我可以在例如 Linq-to-SQL 中启用的标志，它可以提供类似的功能。

我主要使用 c#，但也有兴趣查看来自不同语言的方法，并且我对通过 SQL Profiler 等数据库平台方法执行此操作的“代码”方式更感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T12:11:23.910

如果查询不仅仅是单个表上的简单 SELECT，如果我在 MySQL 或 PostgreSQL 上，我总是通过 EXPLAIN 运行它。如果您使用的是 SQL Server，则 Management Studio 有一个基本相同的显示估计执行计划。查看引擎将如何访问每个表以及它将使用哪些索引很有用。有时它会让你大吃一惊。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T13:13:32.913

记录数据库调用、总时间和应用程序中返回的记录数（字节）很有用，但它不会为您提供所需的所有信息。

它可能会向您显示您没有预料到的使用模式。它可能会显示您使用“逐行”访问而不是“基于集合”操作的位置。

最好使用的工具是 SQL Profiler，它可以分析“读取”的数量与 CPU 和持续时间的关系。您希望避免高 CPU 查询、高读取和长持续时间（呃！）。

“按读取分组”是一个有用的功能，可以将最讨厌的查询带到顶部。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-24T16:32:42.887

如果您喜欢 Firebird，您可能需要观看[sinatica.com](http://www.sinatica.com/blog/en/)。
我们将很快为 Firebird DBA 推出实时监控工具。

< /无耻插件>

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T12:27:58.137

如果您在 SQL Management Studio 中编写查询，您可以输入：`SET STATISTICS TIME ON`SQl Server 会告诉您查询的各个部分需要多长时间来解析、编译和执行。您可以通过处理 SqlConnection 类的 InfoMessage 事件来记录此信息（但我认为使用 SQL Profiler 更容易。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T13:54:22.410

我本以为这里要问的重要问题是“您使用的是什么数据库平台？”

例如，在 Sybase 中，安装[MDA 表](http://www.sypron.nl/mda.html)可能会解决您的问题，它们提供了从过程调用使用情况到平均逻辑 I/O、CPU 时间和索引覆盖率的一大堆统计数据。它可以像你想要的那样聪明。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T18:26:13.297

我绝对看到了在应用程序运行时使用 SQL Profiler 的价值，EXPLAIN 或 SET STATISTICS 将为您提供有关单个查询的信息，但是否有人经常将测量点放入他们的代码中以收集有关正在进行的数据库查询的信息 - 那会例如，对最初执行良好的表的查询，但随着行数的增长，变得越来越慢。

如果您使用的是 MySQL 或 Postgre，则有各种工具可以实时查看查询活动，但我还没有找到像 SQL Profiler 那样好的工具来测量一段时间内的查询性能。

我想知道是否有（或应该有？）类似于[ELMAH](http://code.google.com/p/elmah/)的东西，它只是插入并为您提供信息而无需付出太多额外的努力？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-25T19:18:02.230

如果您使用 Hibernate（我使用 Java 版本，我想 NHibernate 也有类似的东西），您可以让 Hibernate 收集有关许多不同事物的统计信息。参见，例如：

[http://www.javalobby.org/java/forums/t19807.html](http://www.javalobby.org/java/forums/t19807.html)

# php - 使用 PHP 脚本检查 FTP 状态代码

> ID：8726
> 
> 赞同：6
> 
> 时间：2008-08-12T12:07:15.557
> 
> 标签：php, http, ftp, pear, server-response

我有一个使用 PEAR HTTP 类检查来自 HTTP 服务器的响应的脚本。但是，我最近发现该脚本在 FTP 服务器（以及可能不是 HTTP 或 HTTPS 的任何服务器）上失败。我尝试了 Google，但没有看到任何从 HTTP 服务器以外的服务器返回服务器状态代码的脚本或代码。

如何使用 PHP 找出新闻组或 FTP 服务器的状态？

编辑：我应该澄清一下，我只对从 FTP 服务器和我指定的目录进行读取的能力感兴趣。我需要知道服务器是否已死/消失，我无权阅读等。

请注意，虽然大多数时候我与语言无关，但整个网站都是 PHP 驱动的，因此 PHP 解决方案将是未来易于维护和可扩展性的最佳选择。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-12T13:07:00.117

不幸的是，HTTP 的工作方式与 FTP 略有不同。尽管两者在您的浏览器中看起来相同，但 HTTP 是在 URI 的基础上工作的（即访问资源 A，您有一个标识符，它告诉您如何访问它）。

FTP 是非常古老的服务器驱动。甚至匿名 FTP 也有点像 hack，因为您仍然提供用户名和密码，它只是被定义为“匿名”和您的电子邮件地址。

检查 FTP 服务器是否启动意味着检查

1.  您可以连接到 FTP 服务器

    `if (!($ftpfd = ftp_connect($hostname))) { ... }`

2.  您可以登录到服务器：

    `if (!ftp_login($ftpfd, $username, $password)) { ... }`

3.  然后，如果您需要访问更多底层资源以测试特定站点是否已启动，则对它们使用适当的操作。例如，在文件上，可能用于`ftp_mdtm()`获取最后修改时间或在目录上，看看是否`ftp_nlist()`有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-12T12:19:34.300

使用内置的 PHP FTP* 功能会不会比尝试使用自己的功能更简单？如果 URI 来自您无法控制的来源，您需要检查协议定义（http:// 或 ftp:// 等）以确定要使用的功能，但这很简单。如果现在指定了协议（确实应该有！），那么您可以尝试默认为 http。

*   看[这里](http://uk.php.net/ftp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T17:56:54.370

如果要读取特定响应，则必须手动打开套接字并读取/写入数据。

```
<?php
$sock = fsockopen($hostname, $port);
?> 
```

然后你必须来回输入/读取数据。
这将需要您阅读 FTP 协议。

# delphi - Delphi MDI Application 和 MDI Children 的标题栏

> ID：8728
> 
> 赞同：4
> 
> 时间：2008-08-12T12:10:14.663
> 
> 标签：delphi, forms, mdi

我有一个用 Delphi 2006 编写的 MDI 应用程序，它使用默认主题运行 XP。

有没有办法控制 MDI Children 的外观以避免每个窗口上的 XP 风格的大标题栏？

我已经尝试将 to 设置为，`BorderStyle`但它们仍然呈现为普通表单。`MDIChildren``bsSizeToolWin`

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T07:33:43.147

所有你需要的 - 重载过程 CreateWindowHandle，像这样：

```
unit CHILDWIN;
interface
uses Windows, Classes, Graphics, Forms, Controls, StdCtrls;

type
  TMDIChild = class(TForm)
  private
    { Private declarations }
  public
    { Public declarations }
    procedure CreateWindowHandle(const Params: TCreateParams); override;
  end;

implementation

{$R *.dfm}
procedure TMDIChild.CreateWindowHandle(const Params: TCreateParams);
begin
  inherited CreateWindowHandle(Params);
  SetWindowLong(Handle, GWL_EXSTYLE, WS_EX_TOOLWINDOW);
end;
end. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T14:10:18.430

MDI 的工作方式与您正在尝试做的事情并不相符。

如果您需要“MDI”格式，您应该考虑使用内置或[商业](http://www.automatedqa.com/products/aqdocking/index.asp)对接包，并使用对接设置来模仿 MDI 的感觉。

在我的 Delphi 应用程序中，我经常使用 TFrame 并将它们作为主窗体的父级，并将它们最大化以占据客户区域。这为您提供了类似于 Outlook 外观的内容。它有点像这样：

```
TMyForm = class(TForm)
private
  FCurrentModule : TFrame;
public
  property CurrentModule : TFrame read FModule write SetCurrentModule;
end;

procedure TMyForm.SetCurrentModule(ACurrentModule : TFrame);
begin
  if assigned(FCurrentModule) then
    FreeAndNil(FCurrentModule);  // You could cache this if you wanted
  FCurrentModule := ACurrentModule;
  if assigned(FCurrentModule) then
  begin
    FCurrentModule.Parent := Self;
    FCurrentModule.Align := alClient;
  end;
end; 
```

要使用它，您只需执行以下操作：

```
MyForm.CurrentModule := TSomeFrame.Create(nil); 
```

有一个很好的论点是你应该使用你使用的接口（创建一个 IModule 接口或其他东西）。我经常这样做，但这比在这里解释这个概念所需的要复杂得多。

高温高压

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T13:06:23.987

我认为没有；根据我的经验，Delphi 中的 MDI 受到 VCL 中的实现非常严格的限制和控制（也许还有 Windows API？）。例如，不要尝试隐藏 MDI 子项（如果尝试，您会得到一个异常，并且您必须跳过几个 API 箍来解决这个问题），或者更改 MDI 子项的主菜单方式与主机表单合并。

考虑到这些限制，也许您应该重新考虑一下为什么要首先使用特殊的标题栏？我想这些 MDI 的东西被标准化也有很好的理由 --- 你的用户可能会喜欢它 :)

（PS：很高兴在这里看到一个德尔福问题！）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T13:58:52.853

感谢 onnodb

不幸的是，客户坚持使用 MDI 和较小的标题栏。

我已经找到了一种方法，即通过覆盖窗口 CreateParams 来隐藏标题栏，然后创建我自己的标题栏（带有一些鼠标移动处理的简单面板）。效果很好，所以我想我可以由客户运行它，看看它是否会......

# .net - 从 C# 中的计时器获取准确的刻度

> ID：8742
> 
> 赞同：16
> 
> 时间：2008-08-12T12:20:29.853
> 
> 标签：.net, timer

我正在尝试重建一个旧的节拍器应用程序，该应用程序最初是使用 C++ 中的 MFC 编写的，然后使用 C# 在 .NET 中编写。我遇到的问题之一是让计时器足够准确地“滴答”。

例如，假设简单的 BPM（每分钟节拍数）为 120，则计时器应每 0.5 秒（或 500 毫秒）计时一次。但是，将其用作滴答声的基础并不完全准确，因为 .NET 仅保证您的计时器在经过的时间过去之前不会滴答作响。

目前，为了解决上面使用的相同 120 BPM 示例的问题，我将滴答声设置为 100 毫秒，并且仅在每 5 个计时器滴答声时播放点击声音。这确实大大提高了准确性，但感觉有点像黑客。

那么，获得准确刻度的最佳方法是什么？我知道有比 Visual Studio 中现成的 windows 窗体计时器更多的计时器可用，但我对它们并不熟悉。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-12T12:34:43.443

.NET 中有三个计时器类，称为“计时器”。听起来您使用的是 Windows 窗体，但实际上您可能会发现 System.Threading.Timer 类更有用 - 但要小心，因为它会回调池线程，因此您无法直接与您的窗体交互回调。

另一种方法可能是调用/调用 Win32 多媒体计时器 - timeGetTime、timeSetPeriod 等。

一个快速的谷歌发现了这个，这可能很有用[http://www.codeproject.com/KB/miscctrl/lescsmultimediatimer.aspx](http://www.codeproject.com/KB/miscctrl/lescsmultimediatimer.aspx)

“多媒体”（计时器）是在此上下文中搜索的流行词。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T13:17:49.410

C++ 应用程序使用什么？您始终可以使用相同的东西或将 C++ 中的计时器代码包装到 C++/CLI 类中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-11T10:09:44.037

在开发最近的数据记录项目时，我遇到了这个问题。.NET 计时器（windows.forms、system.threading 和 system.timer）的问题在于，我相信它们只能精确到 10 毫秒左右，这是由于 .NET 内置的事件调度。（我在这里谈论.NET 2）。这对我来说是不可接受的，所以我不得不使用多媒体计时器（你需要导入 dll）。我还为所有计时器编写了一个包装类，因此您可以在必要时使用最少的代码更改在它们之间切换。在这里查看我的博客文章：http: [//www.indigo79.net/archives/27](http://www.indigo79.net/archives/27)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-12-18T14:26:56.997

另一种可能性是 DispatcherTimer 的 WPF 实现中存在错误（毫秒和滴答之间存在不匹配，导致潜在的不准确性，具体取决于确切的进程执行时间），如下所示：

[http://referencesource.microsoft.com/#WindowsBase/Base/System/Windows/Threading/DispatcherTimer.cs,143](http://referencesource.microsoft.com/#WindowsBase/Base/System/Windows/Threading/DispatcherTimer.cs,143)

```
class DispatcherTimer
{
    public TimeSpan Interval
    {
        set
        {
            ...
            _interval = value;
            // Notice below bug: ticks1 + milliseconds [Bug1]
            _dueTimeInTicks = Environment.TickCount + (int)_interval.TotalMilliseconds;
        }
    }
} 
```

[http://referencesource.microsoft.com/#WindowsBase/Base/System/Windows/Threading/Dispatcher.cs](http://referencesource.microsoft.com/#WindowsBase/Base/System/Windows/Threading/Dispatcher.cs)

```
class Dispatcher
{
    private object UpdateWin32TimerFromDispatcherThread(object unused)
    {
        ...
        _dueTimeInTicks = timer._dueTimeInTicks;
        SetWin32Timer(_dueTimeInTicks);
    }

    private void SetWin32Timer(int dueTimeInTicks)
    {
        ...
        // Notice below bug: (ticks1 + milliseconds) - ticks2  [Bug2 - almost cancels Bug1, delta is mostly milliseconds not ticks]
        int delta = dueTimeInTicks - Environment.TickCount; 
        SafeNativeMethods.SetTimer( 
            new HandleRef(this, _window.Value.Handle),
            TIMERID_TIMERS,
            delta); // <-- [Bug3 - if delta is ticks, it should be divided by TimeSpan.TicksPerMillisecond = 10000]
    }
} 
```

[http://referencesource.microsoft.com/#WindowsBase/Shared/MS/Win32/SafeNativeMethodsCLR.cs,505](http://referencesource.microsoft.com/#WindowsBase/Shared/MS/Win32/SafeNativeMethodsCLR.cs,505)

```
class SafeNativeMethodsPrivate
{
    ...
    [DllImport(ExternDll.User32, SetLastError = true, ExactSpelling=true, CharSet=System.Runtime.InteropServices.CharSet.Auto)]
    public static extern IntPtr SetTimer(HandleRef hWnd, int nIDEvent, int uElapse, NativeMethods.TimerProc lpTimerFunc);
} 
```

[http://msdn.microsoft.com/en-us/library/windows/desktop/ms644906%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/ms644906%28v=vs.85%29.aspx)

```
uElapse [in]
Type: UINT
The time-out value, in milliseconds. // <-- milliseconds were needed eventually 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T14:09:28.523

当计时器“滴答”事件代码在下一个“滴答”发生时尚未完成执行时，计时器类可能会开始出现奇怪的行为。解决此问题的一种方法是在滴答事件开始时禁用计时器，然后在结束时重新启用它。

但是，这种方法不适用于“滴答”代码的执行时间在滴答计时中是不可接受的错误的情况，因为在此期间计时器将被禁用（不计数）。

如果禁用计时器是一个选项，那么您还可以通过创建一个单独的线程来实现相同的效果，该线程执行、休眠 x 毫秒、执行、休眠等......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-04T03:30:24.467

`System.Windows.Forms.Timer`精度限制在 55 毫秒...

# svn - 学习版本控制，好好学习

> ID：8747
> 
> 赞同：20
> 
> 时间：2008-08-12T12:24:11.733
> 
> 标签：svn, version-control

我应该从哪里开始学习版本控制系统？我过去使用过 SVN、Team Foundation 和 Sourcesafe，但我并没有完全掌握它，我的团队似乎也没有掌握它。

掌握哪些要点最重要？我意识到这从 VCS 到 VCS 是不同的，但是为了这个问题，我们可以假设 Subversion 是我最有兴趣了解的 VCS。

另外，如果可以的话，请推荐任何您认为有用的有关该主题的书籍。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-12T12:35:51.740

关于修订控制的维基百科文章是一个很好的起点

[修订控制](http://en.wikipedia.org/wiki/Revision_control)

在尝试教我的同事时，我发现让他在最后理解词汇是开始向他介绍源代码控制技术的好方法。

不知道什么是分支？去看看它们是如何工作的:)

[Version Control with Subversion](http://svnbook.red-bean.com)上有一本免费的在线 subversion 书籍，它提供了非常宝贵的参考资料。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-12T12:35:22.413

[我发现了 Eric sink 的](http://www.ericsink.com/scm/source_control.html)这个有用的 Source Control HOWTO

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-12T14:37:49.450

我认为关于源代码控制系统的最重要的一点是：

*   小而频繁的签入/提交的价值
*   标记、分支和合并
*   回滚
*   解决冲突
*   独家与非独家结帐
*   持续集成
*   针对源代码控制系统的测试驱动开发和自动化单元测试
*   分叉

如果您已经涵盖了这些主要概念，那么这几乎就是您需要了解的源代码控制的大部分内容 :)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-12T12:32:38.347

有几本关于这个主题的免费电子书。尝试：

使用 Subversion[进行版本控制：使用 Subversion 进行版本控制](http://svnbook.red-bean.com)

Subversion 版本控制 (PDF)： [Subversion 版本控制](http://www.informit.com/content/images/0131855182/downloads/Nagel_book.pdf)

我已阅读并推荐前者。没有读过“Subversion 版本控制”，但它看起来很深入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T12:36:36.857

要回答您的问题：要掌握哪些最重要的要点，我建议在完成整个签入和签出过程后，回滚到旧版本并执行差异，您应该看看分支。分支可以帮助您应对处于重大更改中并突然需要执行错误修复并将其部署到生产环境中的痛苦，而无需混入您正在处理的半成品。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T12:53:08.397

我认为 Subversion 文档是一个很好的起点。我发现维基百科并没有真正的帮助，因为它只涵盖了“基本”观点。

在 alex 提到的**[Subversion Book](http://svnbook.red-bean.com/)**中，我特别推荐第 1 章，尽管如果您已经对 Svn 有一定的经验，那它的水平可能太低了。第 4 章详细介绍了分支和合并，但技术性很强。

**TortoiseSVN 文档中的日常使用指南对**我帮助很大；它涵盖了教程风格中最重要的操作。

我想你需要掌握的最重要的事情是**分支、合并和标记**。理解这些需要时间和练习，所以我强烈建议在本地存储库中创建一个小型宠物项目，以便您进行试验。我认为重要的是要意识到整个系统是基于差异的：合并只不过是自动将一个分支中所做的更改应用到另一个分支中的代码，而不是自己更正代码。诸如冲突之类的东西（我花了很多时间来理解）只是其后果。

但是，当然，我也在学习:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-13T08:39:12.700

我也和您一样，从未真正对 SVN 或 SourceSafe 感到 100% 满意。

查看[Mercurial](http://www.selenic.com/mercurial/wiki/)。[Quickstart](http://www.selenic.com/mercurial/wiki/index.cgi/QuickStart)和[Cheatsheets也是](http://www.ivy.fr/mercurial/ref/v1.0/)[DongWoo Lee](http://www.cuardo.com/pics/MercurialCheatSheet.gif)
的一份很棒的备忘单（他的网站似乎已关闭，所以我扫描并上传到我的网站）

使用 Mercurial，一切似乎都变得更加顺畅和容易，不知道为什么，因为它的命令与其他人没有太大不同。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-18T08:08:04.930

我不确定你对版本控制系统有多少经验，但对于那些对这个概念没有先验知识的人，我建议你阅读[Subversion 书](http://svnbook.red-bean.com/)的前几章。那里描述的一些东西是特定于 Subversion 的，但是许多概念对于版本控制系统以及如何使用它们是“通用的”。

我认为人们在开始使用它们之前努力理解版本控制系统背后的主要概念和基本原理是非常重要的。我经常看到开发人员只使用他们系统功能的一小部分，因为他们不了解底层概念，因此要么看不到使用他们认为“高级”或“不必要”功能的意义，要么他们是只是因为害怕破坏某些东西或给项目造成问题而害怕这样做。

在过去与许多开发人员一起经历过这种现象后，我最近在我的博客上总结了我认为[的版本控制最佳实践。](http://blog.looplabel.net/2008/07/28/best-practices-for-version-control/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-15T23:45:36.527

阅读本文：[软件如何发展](http://oreilly.com/catalog/practicalperforce/chapter/ch07.pdf)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T12:29:58.243

查看[GIT](http://git.or.cz/)。[在这里](http://www.youtube.com/watch?v=4XpnKHJAok8)谈一谈。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T15:17:09.447

恕我直言，配置管理的最佳网络资源将是Brad Appleton[的 ACME 项目](http://www.cmcrossroads.com/bradapp/acme/)

您应该阅读所有 SCM 模式和反模式。所有 SCM 技术术语在这个站点上都有很好的定义，并且有很多关于分支技术、敏捷 SCM 和其他重要内容的文章。

这可能会为您提供足够的理论背景来处理任何特定版本的工具。

至于 Subversion 书，它可能是上面提到的 Official [Subversion 书。](http://svnbook.red-bean.com/)它可以在线免费获得，或者您可以购买硬拷贝。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-27T22:29:53.927

恕我直言，这就是[这本书](http://www.scmpatterns.com/book/)：Berczuk 关于 SCM 模式的书

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2014-10-28T07:44:41.243

[Eric Sink 的版本控制示例](http://ericsink.com/vcbe/)很好且易于遵循

# iphone - iPhone web applications, templates, frameworks?

> ID：8756
> 
> 赞同：22
> 
> 时间：2008-08-12T12:29:32.017
> 
> 标签：iphone, web-applications, dashcode

Does anyone have any good starting points for me when looking at making web pages/sites/applications specifically for viewing on the iPhone?

I've looked at templates like the one [Joe Hewitt](http://blog.wired.com/monkeybites/2007/07/meet-joe-hewitt.html) has made, and also seen some templates I can purchase, which I haven't done yet.

I figured someone else had already started on this track and decided that I could probably leech on their newfound knowledge :)

So, does anyone have any pointers? I'm well aware of the problem that the more such a template/framework makes a web app look like a native iPhone app, the more likely I'm going to get into trouble because it just isn't, but for now I want a framework I can start building on, and then in the process figure out how to make it distinctive enough to be perceived as a web app as well as looking like a native iPhone application.

Specifically I'm looking for features like:

*   stylesheets set up, or pointers to how to do them for iPhone
*   page flipping animation, ie. pick an item in a list, list scrolls out of view to the left and information for item scrolls in from the right
*   the animation part would have to work with dynamic pages, ie. not just one big page that has divs set up for each sub-item, which at least one such framework had as a sort of quick fix, I would need to have list item picking load the *page* for that item, and then when loaded, scroll to it

* * *

**Edit**: To avoid people reading only the question and answering, before reading my other reply, I'll add my clarification for GPL licensing and similar issues here.

The framework I need to use can not be distributed under a license which would require me to license my own project out under a similar license. The GPL family of licenses allows for exceptions regarding library usage, but this won't apply to this since by necessity, the kind of framework I would need to use would be all source code.

The project can easily accomodate commercial libraries.

Also, I don't need a *library* or a *framework* as such, example files that look good and aren't overly obfuscated would be welcome as well.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-12T12:45:01.550

I found [iphone-universal](http://code.google.com/p/iphone-universal/) on Google Code the other day. Haven't had a chance to try it out but it looks promising.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-14T02:05:26.470

[jQtouch](http://jqtouch.com/) looks outstanding.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-18T02:06:26.710

The [iUI library](http://code.google.com/p/iui/), originally from Joe Hewitt, would be a good place to start. The library is BSD licensed and has no commercial restrictions.

You're right in assuming [iphone-universal](http://code.google.com/p/iphone-universal/) is not an option for you -- its actually licensed under Affero GPL which triggers the distribution clause simply by accessing the software over a network which is quite different to standard GPL.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T17:40:19.877

I'm currently looking into [http://webapp.net.free.fr/](http://webapp.net.free.fr/). Check out the demo [here](http://webapp.net.free.fr/Demo/). Compared to the other frameworks mentioned, it has the following advantages:

*   Under active development
*   Active user community
*   Has an open license, free to distribute as long as you include the copyright/disclaimer

The last point was really the winner for me. I'm looking at building something that will be included in a commercial product, so the other frameworks like iphone-universal and iwebkit (both GPL) weren't options.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T05:23:50.367

QuickConnectiPhone is LGPL so you can use it the way you want. It has a custom Dashcode project that includes the needed files. It is highly modular. It will even let you compile your JavaScript, HTML, and CSS into an installable application if you want.

[http://sourceforge.net/projects/quickconnect/](http://sourceforge.net/projects/quickconnect/)

For more information you could look at [http://tetontech.wordpress.com](http://tetontech.wordpress.com)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-29T13:03:34.600

Try iwebkit

[http://iwebkit.net](http://iwebkit.net)

Here is a demo:

[http://m.iwebkit.net](http://m.iwebkit.net)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-12T12:50:24.970

This *looks* good, but unfortunately it's being licensed under GPLv3, so I'm actually a bit afraid to start looking at that code. The framework I either need to find, or develop if needs be, must be able to be used as part of a commercial program, without having to license the entire program different. Commercial libraries are fine, I just haven't found any I can demo yet, presumably because I could just then steal all the code if I wanted to.

Guess I'll look further, thanks for the link though.

**Edit**: Clarification. I'd be fine with the requirement to share the source to the web framework part for the iPhone, if someone wanted it, but since this framework is all source, I'm afraid that incorporating bits of it into an existing web application (to make a *skin* for iPhone), I'd be making the whole web application liable for GPL license, which is totally out of the question. Even sharing all the files related to the iPhone pages is out of the question, since they will contain proprietary code.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-25T22:03:01.133

I've been mucking around with iUI, and find it quite good, but to be honest I haven't looked at the licencing model, so I've no idea what it is. It is very simple and straight forward though, and works well with ASP.NET MVC.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-02-04T01:52:11.793

Check out [iWebkit 6](https://web.archive.org/web/20160311073040/http://snippetspace.com/iwebkit6). It works only on iOS 5, though :(.

# UPDATE

You can also use [saurik's](https://cache.saurik.com/menes/style.css). It doesn't have all of the features you said you wanted, but I'll try to see how to implement them. Also, you said you wanted to build on it. For a demo (saurik took down the actual good part of cydia.saurik.com) you can use [mine](http://links.bargonaut.com/WebGUI/saurik.html) on my other site. To avoid transferring all those images, just add this in the header:

`<link rel="stylesheet" type="text/css" href="http://cache.saurik.com/menes/style.css" />`

also, add this to your CSS:

```
body > panel > fieldset > div > a: hover {
background-image: url('menutouched.png')
} 
```

menutouched.png is here:

[![](https://i.stack.imgur.com/XmBr9.png)](https://i.stack.imgur.com/XmBr9.png)

This function in js slides the page. It is from Joe Hewitt’s iUI project:

```
function swipePage(fromPage, toPage, backwards)
{
toPage.style.left = “100%”;
toPage.setAttribute(“selected”, “true”);
scrollTo(0, 1);
var percent = 100;
var timer = setInterval(function()
{
percent += animateX;
if (percent <= 0)
{
percent = 0;
fromPage.removeAttribute("selected");
clearInterval(timer);
}
fromPage.style.left = (backwards ? (100-percent) : (percent-100)) + "%";
toPage.style.left = (backwards ? -percent : percent) + "%";
}, animateInterval);
} 
```

For loading the next page, you could try something like executing a [window.location](https://www.tizag.com/javascriptT/javascriptredirect.php) with a delay. The timing is up to you though.

You also **need** to add this to your CSS:

```
body {
-webkit-tap-highlight-color: rgba(0,0,0,0);
-webkit-user-select: none;
-webkit-text-size-adjust: none;
-webkit-touch-callout: none;
} 
```

# colors - 在 Office 2007 样式中使用 MFC 功能包时找出正在使用的颜色

> ID：8761
> 
> 赞同：4
> 
> 时间：2008-08-12T12:33:10.857
> 
> 标签：colors, mfc-feature-pack

我正在更新我们的一些遗留 C++ 代码以使用 Microsoft 为 Visual Studio 2008 发布的“MFC 功能包”。我们使用新类从 CFrameWndEx 派生我们的应用程序，并且正在应用 Office 2007 样式来提供我们的应用更现代的外观。这为我们提供了渐变填充的窗口标题、状态栏等，以及功能区工具栏的使用。

但是，我们的应用程序包含一些所有者绘制的控件，我想更新这些以匹配功能包使用的配色方案。理想情况下，我想知道当前使用的浅色和阴影工具栏颜色。

我在文档和网络上进行了搜索，但还没有找到任何东西。有谁知道如何找到这些信息？

[编辑]

特别是我们需要找出在运行时使用了哪些颜色。您可以使用新的静态函数 CMFCVisualManager::SetDefaultManager 在运行时更改应用程序的外观。

下面的 msdn 页面向您展示了可用的样式，尤其是 Office2007 外观： [link to msdn](http://msdn.microsoft.com/en-us/library/cc137831.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T13:14:00.273

您是否查看过 MFC 源代码，您会在类似的内容中找到

C:\Program Files\Microsoft Visual Studio 9.0\VC\atlmfc\src\mfc

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T10:39:39.003

> 看起来 CMFCVisualManager 提供了几种获取颜色信息的方法，例如
> 
> CMFCVisualManager::GetSmartDockingBaseGuideColors() CMFCVisualManager::GetToolbarHighlightColor()
> 
> 查看 CMFCVisualManager 的 MSDN 文档。

很好的建议，但不幸的是，当我目前使用 CMFCVisualManagerOffice2007::Office2007_LunaBlue 样式运行我的应用程序时，它们只会返回各种灰色阴影

令人讨厌的是，msdn 帮助“正在建设中”，所以甚至没有告诉你他们应该做什么！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T17:28:54.933

`afxGlobalData`包含有关 MFC 功能包当前使用的颜色、画笔和字体的一些有用信息。特别是我`afxGlobalData.m_clrBarFace`在绘制自己的控制栏背景时使用。

（请注意，我不在我的工作 PC 前，所以上面的语法不是正确的。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T13:09:23.077

您是否尝试过：[2007 Office System 文档：解决方案和插件的 UI 样式指南](http://www.microsoft.com/downloads/details.aspx?FamilyId=19E3BF38-434B-4DDD-9592-3749F6647105&displaylang=en) ？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T13:38:06.513

我想你可以使用你最喜欢的图像编辑器并从屏幕抓取中选择颜色。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-13T12:27:42.270

“我想你可以使用你最喜欢的图像编辑器并从屏幕抓取中选择颜色。”

这基本上就是我目前正在做的事情，我已经定义了一个常量列表，我从中提取颜色。虽然看起来不是很优雅！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-13T12:51:51.457

看起来 CMFCVisualManager 提供了几种获取颜色信息的方法，例如

```
CMFCVisualManager::GetSmartDockingBaseGuideColors()
CMFCVisualManager::GetToolbarHighlightColor() 
```

查看 CMFCVisualManager 的 MSDN 文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-13T12:56:29.343

@GateKiller，OP 没有开发 Office 2007 加载项，因此 UI 指南并没有真正的帮助。它是一个使用[Visual C++ 2008 功能包](http://blogs.msdn.com/somasegar/archive/2008/04/07/visual-c-2008-feature-pack-shipped.aspx)的 MFC 应用程序，它允许 MFC 应用程序采用 Office 2007 的外观和感觉。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-18T16:25:44.410

> 很好的建议，但不幸的是，当我目前使用 CMFCVisualManagerOffice2007::Office2007_LunaBlue 样式运行我的应用程序时，它们只会返回各种灰色阴影

CMFCVisualManagerOffice2007::GetTabFrameColors - clrFace 输出参数是灰色的？

也许它们都是每个主题的单一基础色调之上的面具？假设您可以使用 CMFCVisualManagerOffice2007::GetStyle() 确定哪种配色方案有效，也许您可​​以确定该色调是什么，然后使用 GetxxxColor() 方法进行一些掩蔽。

# c# - 使用 C# 播放 MIDI 声音的最佳方式

> ID：8763
> 
> 赞同：20
> 
> 时间：2008-08-12T12:34:07.733
> 
> 标签：c#, .net, midi

我正在尝试重建一个旧的节拍器应用程序，该应用程序最初是用`MFC`C++ 编写的，`.NET`用`C#`. 我遇到的问题之一是播放用于表示节拍器“点击”的 MIDI 文件。

我在网上找到了一些关于`MIDI`在 .NET 中玩的文章，但其中大多数似乎都依赖于有人拼凑并提供的自定义库。我并不反对使用这些，但我宁愿自己了解这是如何完成的，因为它似乎*应该*是一个微不足道的练习。

那么，我错过了什么吗？还是在 .NET 应用程序中使用 MIDI 很困难？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-12T12:51:50.773

我目前正在开发一个 C# MIDI 应用程序，其他人是对的——你需要为此使用 p/invoke。我正在推出我自己的，因为这似乎更适合应用程序（我只需要一小部分 MIDI 功能），但出于您的目的，[C# MIDI Toolkit](http://www.codeproject.com/KB/audio-video/MIDIToolkit.aspx)可能更适合。它至少是我找到的最好的 .NET MIDI 库，在开始项目之前我进行了广泛的搜索。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-12T12:46:31.750

我认为您需要 p/invoke 到 windows api 才能从 .net 播放 midi 文件。

这篇 codeproject 文章很好地解释了如何做到这一点： [vb.net article to play midi files](http://www.codeproject.com/KB/audio-video/vbnetSoundClass.aspx)

要重写这是 c#，您需要以下 mciSendString 的导入语句：

```
[DllImport("winmm.dll")] 
static extern Int32 mciSendString(String command, StringBuilder buffer, 
                                  Int32 bufferSize, IntPtr hwndCallback); 
```

希望这有帮助，祝你好运！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-10-25T19:26:00.647

[midi-dot-net](https://code.google.com/p/midi-dot-net/)让我在几分钟内启动并运行 - 轻巧且适合我的家庭项目。它也可以在[GitHub](https://github.com/jstnryan/midi-dot-net)上找到。（不要与前面提到的[MIDI.NET](http://midinet.codeplex.com/)混淆，它看起来也很有希望，我只是从来没有接触过它。）

当然[NAudio](https://github.com/naudio/NAudio)（上面也提到过）有很多功能，但就像原始海报一样，我只是想打一些笔记并快速阅读和理解源代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2019-01-30T14:31:21.830

我认为最好使用一些具有高级功能的库来播放 MIDI 数据，而不是自己实现它。例如，使用[DryWetMIDI](https://github.com/melanchall/drywetmidi)（我是它的作者）通过默认合成器（*Microsoft GS Wavetable Synth*）播放 MIDI 文件：

```
using Melanchall.DryWetMidi.Devices;
using Melanchall.DryWetMidi.Core;

// ...

var midiFile = MidiFile.Read("Greatest song ever.mid");

using (var outputDevice = OutputDevice.GetByName("Microsoft GS Wavetable Synth"))
{
    midiFile.Play(outputDevice);
} 
```

`Play`将阻塞调用线程，直到播放整个文件。要控制 MIDI 文件的播放，请获取`Playback`对象并使用它的`Start`/`Stop`方法（[库文档的](https://melanchall.github.io/drywetmidi)[播放](https://melanchall.github.io/drywetmidi/articles/playback/Overview.html)文章中的更多详细信息）：

```
var playback = midiFile.GetPlayback(outputDevice);

// You can even loop playback and speed it up
playback.Loop = true;
playback.Speed = 2.0;

playback.Start();

// ...

playback.Stop();

// ...

playback.Dispose();
outputDevice.Dispose(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T12:39:17.460

我不能声称对此了解很多，但我不认为这很简单[——DotNetRocks](http://www.dotnetrocks.com/)名声的卡尔富兰克林在这方面做了相当多的事情——你看过[他的 DNRTV](http://dnrtv.com/default.aspx?showID=110 "DNR电视")吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-11T18:31:20.723

您可以使用媒体播放器：

```
using WMPLib;
//...
WindowsMediaPlayer wmp = new WindowsMediaPlayer();
wmp.URL = Path.Combine(Application.StartupPath ,"Resources/mymidi1.mid");
wmp.controls.play(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-08T00:23:37.013

对于 .NET 中广泛的 MIDI 和 Wave 操作，我认为[NAudio](http://naudio.codeplex.com)是解决方案（也可以通过[NuGet](https://nuget.org/packages/NAudio)获得）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-30T10:33:50.513

最近添加的是支持 Midi 端口、Midi 文件和 SysEx的[MIDI.NET 。](http://midinet.codeplex.com)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-04-10T01:05:12.290

抱歉，这个问题现在有点老了，但以下内容对我有用（从[Win32 复制 - Midi looping with MCISendString](https://stackoverflow.com/questions/16829520/win32-midi-looping-with-mcisendstring)）：

```
[DllImport("winmm.dll")]
static extern Int32 mciSendString(String command, StringBuilder buffer, Int32 bufferSize, IntPtr hwndCallback);

public static void playMidi(String fileName, String alias)
{
  mciSendString("open " + fileName + " type sequencer alias " + alias, new StringBuilder(), 0, new IntPtr());
  mciSendString("play " + alias, new StringBuilder(), 0, new IntPtr());
}

public static void stopMidi(String alias)
{
  mciSendString("stop " + alias, null, 0, new IntPtr());
  mciSendString("close " + alias, null, 0, new IntPtr());
} 
```

[此处](http://msdn.microsoft.com/en-us/library/windows/desktop/dd743572(v=vs.85).aspx)给出了命令字符串的完整列表。关于这个很酷的部分是你可以使用除了音序器之外的不同东西来播放[不同的东西](http://msdn.microsoft.com/en-us/library/windows/desktop/dd743638(v=vs.85).aspx)，比如播放 .wav 文件的 waveaudio。我不知道如何让它播放.mp3。

另外，请注意，停止和关闭命令必须在发送打开和播放命令的同一线程上发送，否则它们将不起作用并且文件将保持打开状态。例如：

```
[DllImport("winmm.dll")]
static extern Int32 mciSendString(String command, StringBuilder buffer,
                                    Int32 bufferSize, IntPtr hwndCallback);

public static Dictionary<String, bool> playingMidi = new Dictionary<String, bool>();

public static void PlayMidi(String fileName, String alias)
{
    if (playingMidi.ContainsKey(alias))
        throw new Exception("Midi with alias '" + alias + "' is already playing");

    playingMidi.Add(alias, false);

    Thread stoppingThread = new Thread(() => { StartAndStopMidiWithDelay(fileName, alias); });
    stoppingThread.Start();
}

public static void StopMidiFromOtherThread(String alias)
{
    if (!playingMidi.ContainsKey(alias))
        return;

    playingMidi[alias] = true;
}

public static bool isPlaying(String alias)
{
    return playingMidi.ContainsKey(alias);
}

private static void StartAndStopMidiWithDelay(String fileName, String alias)
{
    mciSendString("open " + fileName + " type sequencer alias " + alias, null, 0, new IntPtr());
    mciSendString("play " + alias, null, 0, new IntPtr());

    StringBuilder result = new StringBuilder(100);
    mciSendString("set " + alias + " time format milliseconds", null, 0, new IntPtr());
    mciSendString("status " + alias + " length", result, 100, new IntPtr());

    int midiLengthInMilliseconds;
    Int32.TryParse(result.ToString(), out midiLengthInMilliseconds);

    Stopwatch timer = new Stopwatch();
    timer.Start();

    while(timer.ElapsedMilliseconds < midiLengthInMilliseconds && !playingMidi[alias])
    {

    }

    timer.Stop();

    StopMidi(alias);
}

private static void StopMidi(String alias)
{
    if (!playingMidi.ContainsKey(alias))
        throw new Exception("Midi with alias '" + alias + "' is already stopped");

    // Execute calls to close and stop the player, on the same thread as the play and open calls
    mciSendString("stop " + alias, null, 0, new IntPtr());
    mciSendString("close " + alias, null, 0, new IntPtr());

    playingMidi.Remove(alias);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-12-15T04:53:48.060

新玩家出现：

[https://github.com/atsushieno/managed-midi](https://github.com/atsushieno/managed-midi)

[https://www.nuget.org/packages/managed-midi/](https://www.nuget.org/packages/managed-midi/)

文档的方式不多，但该库的一个重点是跨平台支持。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-17T01:55:06.930

系统媒体。**SoundPlayer**是一种很好的、​​简单的播放 WAV 文件的方法。WAV 文件比 MIDI 有一些优势，其中之一是您可以精确控制每个乐器的声音（而不是依赖计算机的内置合成器）。

# ant - Ant 构建脚本、antcall、依赖等

> ID：8790
> 
> 赞同：27
> 
> 时间：2008-08-12T13:04:28.890
> 
> 标签：ant, build-process

我有一个构建脚本，作为该脚本的一部分，它将一个 jar 文件复制到一个目录，为方便起见，我们将其称为 utils jar。utils jar 由位于另一个目录中的另一个构建脚本构建。我试图让我的构建脚本运行 utils 构建脚本，以便我可以确保 utils jar 是最新的。

所以我知道我需要导入 utils 构建文件。

```
<import file="../utils/build/build.xml" /> 
```

这不起作用，因为与几乎所有其他 ant taks 不同，导入任务不是从 basedir 运行，而是从 pwd 运行。所以为了解决这个问题，我有这个小曲子，它确实成功导入了构建文件

```
 <property name="baseDirUpOne" location=".." />
  <import file="${baseDirUpOne}/utils/build/build.xml" /> 
```

所以现在我解决了我的导入问题，我需要调用任务，这应该很容易吧：

```
<antcall target="utils.package" /> 
```

*请注意，在上面，utils 是 ../utils/build/build.xml 的项目名称*

我现在遇到的问题是 ant 调用没有在 ../utils/build 中执行，所以我需要并且找不到的是 runat 属性或类似的东西，本质上是：

```
<antcall target="utils.package" runat="../utils/build" /> 
```

我需要这个的原因是，在我的 utils 构建文件中，选择要复制到 jar 的代码的步骤基于相对路径，以避免在我的 ant 文件中硬编码路径。有任何想法吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-08-12T13:14:50.273

我有类似的设置：我有一个主 Ant build.xml，它调用一个单独的 build.xml，负责构建我的测试。我就是这样做的：

```
<target name="build-tests">
    <subant target="build">
      <fileset dir="${test.home}" includes="build.xml"/>
    </subant>
</target> 
```

诀窍是使用[`subant`](http://ant.apache.org/manual/Tasks/subant.html)而不是`antcall`. 您不必导入其他构建文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-12T13:20:39.387

尝试使用[“ant”任务](http://ant.apache.org/manual/Tasks/ant.html)而不是“antcall”任务，它直接运行导入的构建，而不是将其导入到当前构建文件中。它有一个“dir”参数：

> 用作新 Ant 项目的 basedir 的目录。默认为当前项目的 basedir，除非 inheritall 已设置为 false，在这种情况下它没有默认值。这将覆盖被调用项目的 basedir 设置。

所以你可以这样做：

```
<ant antfile="${baseDirUpOne}/utils/build/build.xml" dir="../utils/build" /> 
```

或类似的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T23:15:40.267

您可以使用嵌套在 antcall 块中将参数传递给 antcall。因此，您可以通过这种方式传递属性（甚至可能是 basedir，因为属性是不可变的）。

# mysql - MySQL 存储过程中是否有任何列表数据类型，或模拟它们的方法？

> ID：8795
> 
> 赞同：13
> 
> 时间：2008-08-12T13:09:22.220
> 
> 标签：mysql, stored-procedures

我想在 MySQL 中创建一个以列表为参数的存储过程。例如，假设我希望能够在一次调用中为一个项目设置多个标签，那么我想要做的是定义一个过程，该过程采用项目的 ID 和要设置的标签列表。但是，我似乎找不到任何方法来做到这一点，据我所知，没有列表数据类型，但是可以以某种方式模拟它吗？标签列表可以是逗号分隔的字符串，可以以某种方式拆分和循环吗？

您通常如何处理 MySQL 存储过程中的列表？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-12T14:02:46.697

[本文](http://forums.mysql.com/read.php?98,50521,50521#msg-50521)对将数组解析为存储过程的问题进行了一些很好的讨论，因为存储过程只允许有效的表列数据类型作为参数。

[您可以使用 mysql 中的csv](http://dev.mysql.com/tech-resources/articles/csv-storage-engine.html)表类型做一些巧妙的事情- 如果您将平面文件加载到数据库中。

您可以在存储过程中创建一个临时表，遍历 csv 列表并将其插入临时表，然后创建一个从该表中选择值的游标。上述线程中的这个[答案显示了一种方法。](http://forums.mysql.com/read.php?98,50521,184245#msg-184245)

通常我会在进入数据库之前拆分数组，然后对每个项目单独执行查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T13:48:24.917

根据您想要获得的复杂程度，您可以使用通用链接表。对于我的一个应用程序，用户可能会选择多个报告，例如要运行报告的客户列表，而不仅仅是组合框中的单个客户。我有一个包含 2 个字段的单独表格：

*   唯一 ID（指导）
*   物品编号

伪代码如下所示：

```
GUID guid = GenerateGUID()
try
  for each customer in customerList { INSERT(guid, customerId) }
  ExecuteSQLPocedure(guid)
  --the procedure can inner-join to the list table to get the list
finally
  DELETE WHERE UniqueID=guid 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T13:33:06.837

不确定这些是否会专门在 SP 中工作，但 MySQL 5 中有 ENUM 和 SET 数据类型可以满足您的需求。 [http://dev.mysql.com/doc/refman/5.0/en/enum.html](http://dev.mysql.com/doc/refman/5.0/en/enum.html) [http://dev.mysql.com/doc/refman/5.0/en/set.html](http://dev.mysql.com/doc/refman/5.0/en/set.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T13:36:40.307

在我的 Choice 编程语言 C# 中，我实际上是在应用程序本身中执行此操作，因为 split() 函数和循环在 C# 中比在 SQL 中更容易编程，但是！

也许你应该看看[SubString_Index()](http://www.java2s.com/Tutorial/MySQL/0460__String-Functions/SUBSTRINGINDEXstrdelimcountReturnsthesubstringfromstringstrbeforecountoccurrencesofthedelimiterdelim.htm)函数。

例如，以下将返回 google：

```
SELECT SUBSTRING_INDEX(SUBSTRING_INDEX('www.google.com', '.', -2), '.', 1); 
```

# c# - 键值对数据结构的最佳实现？

> ID：8800
> 
> 赞同：79
> 
> 时间：2008-08-12T13:12:50.887
> 
> 标签：c#, data-structures, collections

所以我最近一直在研究 C#，所有的通用集合都让我有点困惑。假设我想表示一种数据结构，其中树的头部是一个键值对，然后在其下方有一个可选的键值对列表（但不超过这些级别）。这会合适吗？

```
public class TokenTree
{
    public TokenTree()
    {
        /* I must admit to not fully understanding this,
         * I got it from msdn. As far as I can tell, IDictionary is an
         * interface, and Dictionary is the default implementation of
         * that interface, right?
         */
        SubPairs = new Dictionary<string, string>();
    }

    public string Key;
    public string Value;
    public IDictionary<string, string> SubPairs;
} 
```

这只是传递数据的简单分流。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2008-08-12T13:20:55.127

有一个实际的数据类型叫做 KeyValuePair，像这样使用

```
KeyValuePair<string, string> myKeyValuePair = new KeyValuePair<string,string>("defaultkey", "defaultvalue"); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-08-12T13:25:12.903

您可以做的一件可能的事情是直接使用 Dictionary 对象，然后使用您自己的修改对其进行扩展：

```
public class TokenTree : Dictionary<string, string>
{
    public IDictionary<string, string> SubPairs;
} 
```

这使您不必为您的密钥强制执行 IDictionary 规则（例如，密钥唯一性等）。

是的，您正确理解了构造函数的概念:)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-12T13:45:53.470

我认为您可能追求的（作为您问题的文字实现）是：

```
public class TokenTree
{
    public TokenTree()
    {
        tree = new Dictionary<string, IDictionary<string,string>>();
    }

    IDictionary<string, IDictionary<string, string>> tree; 
} 
```

您实际上确实在问题中说了一个键值的“列表”，因此您可能希望将内部`IDictionary`替换为：

```
IList<KeyValuePair<string, string>> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-12T13:23:27.777

有一个 KeyValuePair 内置类型。事实上，这就是 IDictionary 在迭代时为您提供的访问权限。

此外，这个结构几乎不是一棵树，找到一个更有代表性的名字可能是一个很好的练习。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T13:45:50.210

只需添加一件事（尽管我确实认为您的问题已经得到其他人的回答）。出于可扩展性的考虑（因为我们都知道它会在某个时候发生），您可能需要查看[复合模式](http://www.dofactory.com/Patterns/PatternComposite.aspx)，这是使用“树状结构”的理想选择。

就像我说的，我知道你只期待一个子级别，但是如果你以后需要扩展这对你真的很有用^_^

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T13:25:56.710

@ [Jay Mooney](https://stackoverflow.com/users/733/jay-mooney)：.NET 中的通用 Dictionary 类实际上是一个哈希表，只是具有固定类型。

您显示的代码不应说服任何人使用 Hashtable 而不是 Dictionary，因为这两种代码段都可以用于两种类型。

对于哈希表：

```
foreach(object key in h.keys)
{
     string keyAsString = key.ToString(); // btw, this is unnecessary
     string valAsString = h[key].ToString();

     System.Diagnostics.Debug.WriteLine(keyAsString + " " + valAsString);
} 
```

对于字典：

```
foreach(string key in d.keys)
{
     string valAsString = d[key].ToString();

     System.Diagnostics.Debug.WriteLine(key + " " + valAsString);
} 
```

与 KeyValuePair 的另一个相同，只需对 Hashtable 使用非泛型版本，对 Dictionary 使用泛型版本。

所以这两种方式都一样简单，但是 Hashtable 使用 Object 作为键和值，这意味着你将装箱所有值类型，并且你没有类型安全，而 Dictionary 使用泛型类型，因此更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T13:22:01.287

[字典类](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)正是你想要的，正确的。

您可以将该字段直接声明为 Dictionary，而不是 IDictionary，但这取决于您。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-12T13:38:47.243

使用这样的东西：

```
class Tree < T > : Dictionary < T, IList< Tree < T > > >  
{  
} 
```

它很丑，但我认为它会给你你想要的。太糟糕了 KeyValuePair 是密封的。

# activereports - 无法将 ActiveReports 的 WebViewer 添加到 ASP.NET 页面

> ID：8807
> 
> 赞同：2
> 
> 时间：2008-08-12T13:15:46.543
> 
> 标签：activereports

我从他们的网站安装了 ActiveReports。该版本被标记为`.NET 2.0 build 5.2.1013.2 (for Visual Studio 2005 and 2008)`。我在 VS 2008 中有一个 ASP.NET 项目，它以 2.0 作为目标框架。我将`DataDynamics`命名空间中的所有工具都添加到了工具箱中，创建了一个新项目，添加了一个新报告。

当我将 WebViewer 控件拖放到设计视图中的页面时，没有任何反应。没有添加标记，页面上也没有显示报表查看器。`web.config`我还注意到我的文件中没有与 DataDynamics 组件相关的标签。我错过了一些配置吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T14:39:20.040

我想我找到了原因。在尝试完成这项工作时，我想我安装了另一个版本的软件包，它删除或停用了我当前的版本。我在表单上放置的控件属于没有引用程序集的旧版本。我删除了 ActiveReports 的所有安装，安装了最新版本并清理了工具箱。我将最新版本的 WebViewer 添加到工具箱并将其放在表单上。有效。

# macos - 使用 Applescript 在 Acrobat Pro 中打开文件时不显示对话框

> ID：8830
> 
> 赞同：1
> 
> 时间：2008-08-12T13:43:30.667
> 
> 标签：macos, adobe, applescript, acrobat

打开 Adob​​e Acrobat Pro 时，无论是通过**Applescript**还是 finder，都会显示介绍性对话框。**有没有办法在使用Applescript**打开文档时在没有选中“不再显示”选项的情况下不显示此对话框？

Photoshop 和 Illustrator **Applescript**库有设置交互级别和不显示对话框的方法，但我似乎在 Acrobat 中找不到该选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T15:01:21.213

从您已选中“不再显示”的机器复制 ~/Library/Preferences 中的任何适用的首选项文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-26T17:05:34.910

If it's not in the dictionary, probably not.

# apache - mod_rewrite 将一个文件后缀类型别名为另一个

> ID：8832
> 
> 赞同：3
> 
> 时间：2008-08-12T13:44:06.580
> 
> 标签：apache, mod-rewrite, seo

我希望我能足够清楚地解释这一点，但如果不让我知道，我会尽力澄清。

我目前正在使用 ColdFusion 开发一个站点，并设置了一个 mod_rewrite 规则，以使其看起来像该站点正在使用 PHP。index.php 的任何请求都由 index.cfm 处理（规则将 *.php 映射到 *.cfm）。

这很好用——到目前为止，很好。问题是如果直接请求 index.cfm（或任何 ColdFusion 页面），我想返回 404 状态代码。

如果我尝试使用 mod_rewrite 阻止对 *.cfm 文件的访问，它还会返回 404 以请求 *.php。

我想我可能不得不更改我的 Apache 配置而不是使用 .htaccess

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-15T08:02:25.513

您可以使用该`S`标志来跳过`404`规则，如下所示：

```
RewriteEngine on

# Do not separate these two rules so long as the first has S=1
RewriteRule (.*)\.php$ $1.cfm [S=1]
RewriteRule \.cfm$ - [R=404] 
```

如果您也在使用该`Alias`选项，那么您还应该添加`PT`标志。有关详细信息，请参阅[mod_rewrite 文档](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-12T14:06:42.900

发布您已有的规则作为起点，这样人们就不必重新创建它来帮助您。

我建议首先在将 .php 映射到 .cfm 文件的规则上测试 [L]。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T14:57:47.303

您必须使用两组不同的重写规则，一组用于 .php，另一组用于 .chm，并使它们与 RewriteCond %{REQUEST_FILENAME} 互斥。并按照 jj33 的建议使用标志 [L]。

您可以将规则保存在 .htaccess 中。

# sharepoint - SharePoint - FeatureActivated 事件期间的连接字符串对话框

> ID：8849
> 
> 赞同：2
> 
> 时间：2008-08-12T13:57:04.353
> 
> 标签：sharepoint, connection-string

有谁知道在激活或安装共享点功能时是否可以向用户/管理员显示提示？

我正在编写一个自定义 webpart，它正在连接到一个单独的数据库，我想允许管理员在安装 .wsp 文件或激活该功能时选择或输入连接字符串。

我正在查看 FeatureActivated 事件，并考虑使用 SPWebConfigModification 类将连接字符串实际写入场中的 web.config 文件。

我不想手动编辑 web.configs 或将字符串硬编码到 DLL 中。

如果您有其他方法来处理 sharepoint 中的连接字符串，我也会对它们感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-13T12:50:32.333

不幸的是，无法切换到可以通过功能激活过程获取用户的屏幕。给你几条评论：

1.  我假设每次安装的连接字符串都会有所不同，因此您无法将其直接包含在解决方案中。
2.  我假设您无法在安装过程中以编程方式构建它。

因此，您需要某种方式来获取用户输入。这里有几个选项：

1.  它可能是一个 Web 部件属性，但这意味着每次添加 Web 部件时都要设置它，然后您需要单独维护这些设置。
2.  您可以构建自己的 _layouts 设置屏幕（好帖子：http: [//community.zevenseas.com/Blogs/Robin/archive/2008/03/17/lcm-creating-custom-application-page-and-using-the -propertybag-more-detailed.aspx](http://community.zevenseas.com/Blogs/Robin/archive/2008/03/17/lcm-creating-custom-application-page-and-using-the-propertybag-more-detailed.aspx) )，然后用户可以从那里维护属性，将其存储在 Web 属性包或 Web.Config 中。我尽量避免使用 Web.Config，但如果你确实想走这条路，那么请确保你使用 SPWebConfigModification 类（阅读这个很棒的博客：[http ://www.crsw.com/mark/Lists/帖子/Post.aspx?ID=32](http://www.crsw.com/mark/Lists/Posts/Post.aspx?ID=32) )
3.  最后，我经常使用的一种技术是将配置信息存储在 SharePoint 列表中。Chris O'Brien 在这里有一个很棒的框架：http: [//www.codeplex.com/SPConfigStore](http://www.codeplex.com/SPConfigStore)

希望有帮助，丹尼尔

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-13T13:53:19.977

听起来不错。我将研究这些可能的解决方案。

我认为 #1 不会起作用，因为我在一个解决方案中部署了多个 webpart，它们都使用相同的 connectionString。

#3 听起来像是一个非常干净的解决方案。我看到配置项被缓存，所以看起来如果我需要存储连接字符串，每次我需要该字符串时都不会被 SP 查找击中。

[在寻找解决方案时，我确实偶然发现了另一种方法。](http://www.codeplex.com/CKS/SourceControl/FileView.aspx?itemId=222757&changeSetId=11423)

如果您深入研究他们的代码，我看起来他们已经创建了一个接受应用程序特定值的安装程序，将这些值添加到 FeatureTemplate.xml 文件中并将它们传递给接收器中的 SPFeatureReceiverProperties 对象。

我正要开始处理这种方法，但我认为#3 会更好。

谢谢你，基思

# php - PHP中NULL和null的区别

> ID：8864
> 
> 赞同：93
> 
> 时间：2008-08-12T14:08:23.363
> 
> 标签：php, null

`NULL`PHP和`null`PHP有区别吗？有时它们似乎可以互换，有时则不能。

编辑：由于某种原因，当我阅读答案中链接的文档时（在发布此问题之前），我将其读为“区分大小写”而不是“不区分大小写”，这是我首先发布此问题的全部原因.. .

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-08-12T14:11:11.393

Null 不区分大小写。

从[文档](http://ca3.php.net/manual/en/language.types.null.php)中：

> 只有一个 null 类型的值，那就是**不区分大小写的**关键字 NULL。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-05-18T22:28:26.280

没有区别。相同的类型只是它**不区分大小写**的关键字。与`True`/`False`等相同...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-12-30T16:38:43.233

要么会工作。但是官方的 PHP 风格指南 PSR-12 建议使用小写。

[https://www.php-fig.org/psr/psr-12/](https://www.php-fig.org/psr/psr-12/)，第 2.5 节

# fogbugz - 循证调度工具

> ID：8876
> 
> 赞同：30
> 
> 时间：2008-08-12T14:16:41.757
> 
> 标签：fogbugz

[有没有像Joel](http://www.joelonsoftware.com/items/2007/10/26.html)所说的那样实现基于证据的调度的免费工具？当然，有 FogBugz，但我正在寻找一个简单且免费的工具，可以将 EBS 应用于一些我给出估计（以及完成的实际时间）的任务。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-08-12T14:28:52.497

顺便说一下，FogBugz 最多可供 2 位用户免费使用。据我所知，这是执行 EBS 的唯一工具。

见这里[http://www.workhappy.net/2008/06/get-fogbugz-for.html](http://www.workhappy.net/2008/06/get-fogbugz-for.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-12T14:19:36.057

[根据维基百科](http://en.wikipedia.org/wiki/Evidence_Based_Scheduling)，Fogbugz 是目前唯一提供 EBS 的产品。

# winapi - 获取网络上的域列表

> ID：8880
> 
> 赞同：1
> 
> 时间：2008-08-12T14:20:31.153
> 
> 标签：winapi

使用 Windows API，如何获取网络上的域列表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T14:27:10.360

回答了我自己的问题：

使用[NetServerEnum](http://msdn.microsoft.com/en-us/library/aa370623(VS.85).aspx)函数，传入`SV_TYPE_DOMAIN_ENUM`“servertype”参数的常量。

在 Delphi 中，代码如下所示：

```
<snip>
type
  NET_API_STATUS = DWORD;
  PSERVER_INFO_100 = ^SERVER_INFO_100;
  SERVER_INFO_100 = packed record
    sv100_platform_id : DWORD;
    sv100_name        : PWideChar;
end;

function NetServerEnum(  //get a list of pcs on the network (same as DOS cmd "net view")
  const servername    : PWideChar;
  const level         : DWORD;
  const bufptr        : Pointer;
  const prefmaxlen    : DWORD;
  const entriesread   : PDWORD;
  const totalentries  : PDWORD;
  const servertype    : DWORD;
  const domain        : PWideChar;
  const resume_handle : PDWORD
) : NET_API_STATUS; stdcall; external 'netapi32.dll';

function NetApiBufferFree(  //memory mgmt routine
  const Buffer : Pointer
) : NET_API_STATUS; stdcall; external 'netapi32.dll';

const
  MAX_PREFERRED_LENGTH = DWORD(-1);
  NERR_Success = 0;
  SV_TYPE_ALL  = $FFFFFFFF;
  SV_TYPE_DOMAIN_ENUM = $80000000;

function TNetwork.ComputersInDomain: TStringList;
var
  pBuffer        : PSERVER_INFO_100;
  pWork          : PSERVER_INFO_100;
  dwEntriesRead  : DWORD;
  dwTotalEntries : DWORD;
  i              : integer;
  dwResult       : NET_API_STATUS;
begin
  Result := TStringList.Create;
  Result.Clear;

  dwResult := NetServerEnum(nil,100,@pBuffer,MAX_PREFERRED_LENGTH,
                            @dwEntriesRead,@dwTotalEntries,SV_TYPE_DOMAIN_ENUM,
                            PWideChar(FDomainName),nil);

  if dwResult = NERR_SUCCESS then begin
    try
      pWork := pBuffer;
      for i := 1 to dwEntriesRead do begin
        Result.Add(pWork.sv100_name);
        inc(pWork);
      end;  //for i
    finally
      NetApiBufferFree(pBuffer);
    end;  //try-finally
  end  //if no error
  else begin
    raise Exception.Create('Error while retrieving computer list from domain ' +
                           FDomainName + #13#10 +
                           SysErrorMessage(dwResult));
  end;
end;
<snip> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T14:33:20.303

您将需要使用一些 LDAP 查询

## 这是我在以前的脚本中使用的一些代码（它是从某个地方从网上取下来的，我已经留在了版权声明中）

```
' This VBScript code gets the list of the domains contained in the 
' forest that the user running the script is logged into

' ---------------------------------------------------------------
' From the book "Active Directory Cookbook" by Robbie Allen
' Publisher: O'Reilly and Associates
' ISBN: 0-596-00466-4
' Book web site: http://rallenhome.com/books/adcookbook/code.html
' ---------------------------------------------------------------

set objRootDSE = GetObject("LDAP://RootDSE")
strADsPath =  "<GC://" & objRootDSE.Get("rootDomainNamingContext") & ">;"
strFilter  = "(objectcategory=domainDNS);"
strAttrs   = "name;"
strScope   = "SubTree"

set objConn = CreateObject("ADODB.Connection")
objConn.Provider = "ADsDSOObject"
objConn.Open "Active Directory Provider"
set objRS = objConn.Execute(strADsPath & strFilter & strAttrs & strScope)
objRS.MoveFirst
while Not objRS.EOF
    Wscript.Echo objRS.Fields(0).Value
    objRS.MoveNext
wend 
```

* * *

[也是一个 C# 版本](http://www.janus-net.de/2005/11/18/getting-list-of-sub-domains-from-active-directory-with-c/)

# c# - 有人知道在线免费数据库吗？

> ID：8893
> 
> 赞同：11
> 
> 时间：2008-08-12T14:35:39.643
> 
> 标签：c#, database

我编写了一个当前针对 MySql 的本地实例运行的应用程序。我想将数据库集中在网络上的某个地方，并分享我的应用程序。

但是，我很便宜，不想付钱。有谁知道我可以通过 C# 连接到的免费在线关系数据库服务？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-12T14:43:31.077

[http://www.freesql.org](http://www.freesql.org)呢？看起来你在要求免费时不能太挑剔，这似乎提供了一些东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T14:43:17.193

糟糕，当时没有正确阅读问题！:P

还没有尝试过，他们的网站说他们最近发生了重大崩溃，但看起来很有希望：[http ://www.freesql.org/](http://www.freesql.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-12T14:42:43.573

我从来没有听说过这样的事情。几年前，许多主机（Brinkster 等）通过他们的免费网络托管帐户提供了一些最小的数据库容量，但我认为你现在很难找到类似的东西。即使可以，大多数主机也不再允许您连接到在其服务器上运行的 Web 应用程序之外的数据库（即使是您支付的帐户）。

我的建议是将一台旧计算机拼凑在一起，并将其用作您在家里用完的数据库服务器（可能再加上 no-ip 或一些类似的服务）。如果您需要比这更多的马力/带宽，您可能只需要吸收它并支付一些费用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T14:42:47.147

你看过[http://creator.zoho.com/](http://creator.zoho.com/)吗？
我自己没有测试过，但检查一下可能是个好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T14:48:43.017

听起来您需要[Amazon SimpleDB](http://www.amazon.com/SimpleDB-AWS-Service-Pricing/b?ie=UTF8&node=342335011) ...

它不是免费的，但定价看起来相当不错。我自己没有使用过它，但是当我有一点空闲时间时，我可能会将它用于我正在从事的项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-20T13:11:54.137

嗯，有[http://zymic.com/](http://zymic.com/)。他们提供免费托管，其中包括免费数据库。不确定您是否可以从外部连接到它。你必须检查一下。

# php - 用于 phppgadmin 报告数据库？

> ID：8894
> 
> 赞同：7
> 
> 时间：2008-08-12T14:35:46.803
> 
> 标签：php, database, postgresql, phppgadmin

[Phppgadmin](http://phppgadmin.sourceforge.net/doku.php?id=start)附带在系统上创建报告数据库以供 phppgadmin 使用的说明。这些说明描述了如何设置它，但并没有真正说明它的目的是什么，而且 phppgadmin 站点也不是很有帮助。

它似乎允许您存储 SQL 查询，那么它是否用于存储访问表之类的管理查询`pg_class`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-13T18:08:47.947

这只是存储常用 SQL 脚本的标准位置。报告-pgsql.sql 脚本创建了一个表来存储这些查询、它们打算运行的数据库、一个标题和一些关于它们做什么的描述性文本。PhpPgAdmin 具有浏览和执行这些报告的功能。这是一个非常简单的系统，只是为了帮助组织。

# c# - 我可以让 Memcached 在 Windows (x64) 64 位环境中运行吗？

> ID：8896
> 
> 赞同：90
> 
> 时间：2008-08-12T14:37:28.703
> 
> 标签：c#, c++, windows, 64-bit, memcached

有谁知道**如果**、**何时**或**如何**让[Memcached](https://memcached.org/)在 Windows 64 位环境中运行？

我正在设置一个新的托管解决方案，并且更喜欢运行 64 位操作系统，因为它是一个带有 SQL Server DB 的 ASP.Net MVC 解决方案，所以操作系统要么是 Windows Server 2003，要么是（希望！）2008。

我知道这可能会引发关于服务器上 32 位与 64 位的争论，但我只想说我的偏好是 64 位，而且我有一些[很好](https://blogs.technet.microsoft.com/mscom/2005/09/26/running-microsoft-com-on-64-bitthe-dependencies-the-goodness-the-gotchas/) [的](https://blog.codinghorror.com/64-bit-desktop-vs-64-bit-server/)理由。

到目前为止，我已经尝试了许多选项，并找到了一些与在 32[位](http://blog.rakeshxp.com/2007/09/running-memcached-on-windows.html)机器上安装它相关的[帮助](http://www.splinedancer.com/memcached-win32/)（我可能会添加成功），但由于原始[Windows 端口](http://jehiah.cz/projects/memcached-win32/)是 Win32 特定的，这几乎没有帮助在 x64 上作为服务安装时。它还依赖于我只能获得 Win32 编译版本的[libevent 。](https://libevent.org/)

我怀疑简单地在 C++ 中加载所有这些并点击“编译”（对于 64 位）是行不通的，尤其是因为 32 位和 64 位架构的复杂差异，但我想知道是否有人正在努力解决这个问题地面？不幸的是，我的专长仅在于托管代码 (C#)，否则我会尝试自己承担这一点，但我不敢相信我是唯一一个试图让[memcached](https://memcached.org/)在 64 位 Windows 服务器上运行的人。 ..我吗？

* * *

更新

**是的，恐怕我仍在寻找这个问题的答案——我所有的努力（用我可怜的 C++ 技能）来建立一个稳定的构建都失败了——我已经破坏了一台服务器和 3 个虚拟机只是在尝试，所以现在我求助于真正的专家。有人打算将其移植到64位吗？还是您真的建议我改用 MS Velocity？一想到我就不寒而栗。**

* * *

更新：@Lars - 我确实使用 Enyim - 它非常好，但你指的是客户端，而不是服务器部分。

@DannySmurf - 我只能将它作为服务安装在 32 位操作系统上。64 位操作系统拒绝安装此 Win32 服务。当然是的，许多 Win32 代码在 x64 架构上无缝运行，因此您可以在 Vista/XP 64 等上运行 32 位应用程序（例如 Office）或游戏，但这并不能直接转化为服务。我不是专家，我怀疑这与服务需要订阅的同步或事件有关，而且我怀疑 64 和 32 不能很好地发挥作用。我很高兴得到纠正，但要回答你的问题 - 是的，我已经尝试过了。

@OJ - 非常感谢您的直截了当的回应。我想了很多，但不确定其他人是否有建议或已经走这条路。也许当 StackOverflow 上线时，会有更多人回复并让我知道这是否正在研究，尽管我可以尝试自己编译它 - 我根本无法“相信”（以我的 C++ 经验水平）它将在大型可扩展解决方案的关键组件中提供“企业级”可靠性。我认为这需要有教养的干预，而不是我未经消毒的实验方法，然后我才能有信心。我的一个小小的疏忽可能会导致网站瘫痪。哦，好吧……直到下一次。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-03-01T15:12:00.593

North Scale 实验室发布了一个用于 Windows x64 的 memcached 1.4.4 版本：

[http://blog.couchbase.com/memcached-windows-64-bit-pre-release-available](http://blog.couchbase.com/memcached-windows-64-bit-pre-release-available)

[http://labs.northscale.com/memcached-packages/](http://labs.northscale.com/memcached-packages/)

更新：他们最近发布了 Memcached Server - 仍然是免费的，但通过集群、基于 Web 的管理/统计 UI 等增强了发行版。（我与他们没有任何关系）在[http://northscale.com/上查看products/memcached.html](http://northscale.com/products/memcached.html)并在以下位置下载：[http ://www.northscale.com/download.php?a=d](http://www.northscale.com/download.php?a=d)

更新 2：NorthScale Memcached 不再作为独立下载提供。现在，他们已将其作为其名为 Membase 的商业 No-SQL DB 产品的一部分。它可以配置为仅在 Memcached 模式下运行（即没有持久性），并且还有 100% 免费版本。在这里查看：[http ://www.membase.org/downloads](http://www.membase.org/downloads)

更新 3：MemBase 与 CouchDB 合作，并推出了一款名为 CouchBase 的混合产品。他们仍然在[http://www.couchbase.com/download提供免费的“社区”版本](http://www.couchbase.com/download)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2012-03-21T14:19:03.717

众所周知，由 membase/couchbase/whatever 的好人构建的 32 位和 64 位版本仍然可用，但博客 URL 已更改：

memcached 1.4.4 的 32 位二进制文​​件作为 Windows 服务：

[http://blog.couchbase.com/memcached-144-windows-32-bit-binary-now-available](http://blog.couchbase.com/memcached-144-windows-32-bit-binary-now-available)

[http://s3.amazonaws.com/downloads.northscale.com/memcached-win32-1.4.4-14.zip](http://s3.amazonaws.com/downloads.northscale.com/memcached-win32-1.4.4-14.zip)

memcached 1.4.4 的 64 位二进制文​​件作为 Windows 服务：

[http://blog.couchbase.com/memcached-windows-64-bit-pre-release-available](http://blog.couchbase.com/memcached-windows-64-bit-pre-release-available)

[http://s3.amazonaws.com/downloads.northscale.com/memcached-win64-1.4.4-14.zip](http://s3.amazonaws.com/downloads.northscale.com/memcached-win64-1.4.4-14.zip)

64 位版本确实有错误的正常运行时间。

所以也许你想要这个 1.4.2 的二进制文件：

[http://www.urielkatz.com/archive/detail/memcached-64-bit-windows/](http://www.urielkatz.com/archive/detail/memcached-64-bit-windows/)

MemCacheDManager 包含的 32 位版本也支持在 Windows 2000（无 IPv6）上运行：

[http://allegiance.chi-town.com/MemCacheDManager.aspx](http://allegiance.chi-town.com/MemCacheDManager.aspx) [http://allegiance.chi-town.com/Download.aspx?dl=Releases/MemCacheDManager_1_0_3_0.msi&rurl=MemCacheDManager.aspx](http://allegiance.chi-town.com/Download.aspx?dl=Releases/MemCacheDManager_1_0_3_0.msi&rurl=MemCacheDManager.aspx)

要解压 msi：

msiexec /a Releases_MemCacheDManager_1_0_3_0.msi /qb TARGETDIR=c:\memcached

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-04-05T09:36:45.500

可在此处找到适用于 win x64 的 Memcached 1.4.5 二进制文件：http: [//downloads.northscale.com/memcached-1.4.5-amd64.zip](http://downloads.northscale.com/memcached-1.4.5-amd64.zip)

另一种选择是从这里安装 Couchbase Server 1.8.0 x64：http: [//www.couchbase.com/download](http://www.couchbase.com/download)，捆绑的 memcached 似乎是 1.7.1.1 版本（听起来像一个内部版本，我不知道哪个是真的）

至于将 memcached 作为服务运行，本教程可能就足够了：

[http://www.richardnichols.net/2010/08/install-memcached-on-windows-server/](http://www.richardnichols.net/2010/08/install-memcached-on-windows-server/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-08-07T08:55:26.220

## 最新的二进制文件

[NorthScale 有非常旧的版本（最新的是 2010 年 4 月的 1.4.5），但是有一个人在他的 GitHub 存储库 github](https://github.com/nono303/memcached/)中提供了使用 Cygwin 编译的 Windows 的 64 位 Memcached 二进制文件（但他们不需要安装它） 。 [com/nono303/memcached](https://github.com/nono303/memcached/)。

例如，最近发布的版本（在撰写此答案时）[1.5.16 的二进制文件在此处](https://github.com/nono303/memcached/tree/memcache-1.5.16)。有 32 位和 64 位版本。

## Memcached 作为 Windows 服务

如果您想将其安装为 Windows 服务，您可以使用例如开源的[Non-Sucking Service Manager](http://nssm.cc)：

```
nssm install memcached c:\path\to\memcached.exe
nssm start memcached 
```

有关详细信息，请参阅[文档](http://nssm.cc/commands)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-09T16:59:55.970

我有一个用于 win32 的 memcached-1.2.1，最初是从这里下载的：http: [//jehiah.cz/projects/memcached-win32/](http://jehiah.cz/projects/memcached-win32/)（但现在由于某种原因它是一个断开的链接）。

这就是我设法在 64 位 Windows Server 2008 R2 上为 Win32 运行 memcached 的方法。 **memcached.exe** ->**属性**->**兼容性**->**在兼容模式下运行此程序：Windows XP (SP 3)**。请注意，用户 Uriel Katz 在此讨论中提到此方法仅限使用 2GB 内存。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-13T02:30:09.480

我个人认为您必须使用 64 位编译器（显然是在 64 位机器上）重新编译应用程序才能在 64 位平台上充分利用 Memcached。根据代码，这可能不是一件容易的事。如果它是在考虑 64 位可移植性的情况下编写的，那么它可能是一个简单的重新编译。如果还没有，那么在构建它之前你很可能需要进行相当多的修补......然后你必须验证你没有破坏任何东西！

我认为您根本没有高估 32 位和 64 位之间的差异。一个常见的错误是假设该作业是一个简单的重新编译，而实际上并非如此。可移植性问题比大多数人意识到的要多。仅仅因为应用程序构建并且您最终得到一个二进制文件，并不意味着该二进制文件将按其应有的方式运行。特别是当它可能与其他 32 位代码交互时。

话虽如此，也许值得试一试！

祝你好运。干杯!

* * *

@Lars：我建议在尝试回答之前阅读问题。

@John Sibly & @DannySmurf：考虑到 Memcached 的性质和它的目标，你肯定不想在 64 位机器上运行 32 位版本吗？如果您有一台支持 64 位的机器，那么运行 64 位版本以充分利用硬件的功能将是有意义的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-04T19:44:40.717

我只是在 64 位 Windows 系统上搜索 memcached 并找到了这个。到目前为止，还没有任何 Win64 memcached 版本。但是我刚刚通过 cmd 使用适当的命令启动了 memcached.exe，它运行良好。我使用的是 Windows Vista 64bit，不知道 Vista 和服务器版本之间是否有任何差异。

最诚挚的问候 Fleshgrinder

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-20T04:27:27.160

伙计，[Codeplex](http://www.codeplex.com/)是你的朋友 ->[看看它](http://www.codeplex.com/memcachedproviders)的这个端口。它曾经有一个 64 位版本，但你可以下载最新版本并编译为 64 位（很容易）或查看以前的版本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-18T17:53:59.937

32 位版本通过 WOW64 在 64 位上运行，但进程仍限制为 2GB，使用 64 位版本可以超越单台机器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T14:48:31.440

您确定 32 位版本不只是在 64 位 Windows 上运行，无需修改？大多数事情都是这样。

如果做不到这一点，您是否真的尝试过将其编译为 64 位？对人们提出同样问题的几个谷歌群组等进行简要扫描表明，这可能正是解决此问题的方法。我认为您可能高估了 32 位和 64 位 Windows 之间的区别（至少就编译本机应用程序而言）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-07-22T17:35:33.633

仅供参考，在我以管理员身份运行 memcached 之前，我无法将 64 位版本（从这里[http://labs.northscale.com/memcached-packages/](http://labs.northscale.com/memcached-packages/)）安装为服务。

我只是转到可执行文件的属性，然后是兼容性选项卡，并选中“以管理员身份运行此程序”（还有很多其他方法可以做到这一点，但它似乎最简单）

然后我终于能够成功运行：memcached -d install

安装后不要忘记启动服务:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-05-04T17:14:51.097

您始终可以在一个机器上运行多个 32 位 memcached 进程实例，从而使该机器能够提供总计 > 2GB 的 memcache 空间。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-10-05T20:49:57.440

[如果这有帮助，我已经完成了一个基于通过此页面](http://blog.elijaa.org/index.php?post/2010/08/25/Memcached-1.4.5-for-Windows)找到的 memcached 1.4.5 64 位编译的包装器（[直接链接到 NorthScale 二进制文件](http://downloads.northscale.com/memcached-1.4.5-amd64.zip)）。

这是一个 Windows 服务，在生产环境中运行良好：
[https ://github.com/eric-b/MemcachedService64](https://github.com/eric-b/MemcachedService64)

# c# - 寻找在 C# 中进行“网络使用”的最佳实践

> ID：8919
> 
> 赞同：9
> 
> 时间：2008-08-12T14:53:58.233
> 
> 标签：c#, .net-1.1

我宁愿不必求助于调用命令行。
我正在寻找可以映射/断开驱动器的代码，同时还具有异常处理功能。

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-12T14:58:40.330

使用 P/Invoke 和[WNetAddConnection2](http://msdn.microsoft.com/en-us/library/aa385413.aspx)
还应该有一些[包装器](http://www.aejw.com/default.aspx?page=codeviewer&file=cNetworkDrive.cs&ret=dev/cnetworkdrive)来为您完成一些繁重的工作。
谷歌一如既往地是您的朋友。

# flash - ActionScript 3.0 套接字无法重新连接

> ID：8939
> 
> 赞同：5
> 
> 时间：2008-08-12T15:03:40.833
> 
> 标签：flash, actionscript-3, sockets, xmlsocket

在连接超时后，我无法（通过 Socket 和 XMLSocket 类）连接到 TCP 侦听器。

我有一个需要维护与服务器的 TCP 连接的 flash 小程序。我已经使用计时器、乒乓球系统等实现了超时。但是，有一个问题。在调用 Socket.connect() 时，flash 播放器（9.0.115 和之前的许多其他马厩）通过 SYN 数据包发送 3 个连接请求，中间有一段时间。如果这些都没有得到回复（例如，因为服务器已关闭），我无法让小程序[尝试] 连接到服务器。曾经。也就是说，在小程序的生命周期内。

澄清和/或总结：

对于提供给 Socket.connect() 或 XMLSocket.connect() 的任何主机/端口对，如果调用失败，则**在 Flash 小程序的生命周期内**对任何其他 Socket（或 XMLSocket）实例的任何后续 connect() 调用都将主机/端口对被忽略。（至少据我所知，使用数据包嗅探器。）

我尝试过调用许多 Socket 方法、销毁和重新创建对象、使用 Socket 池以及我现在不记得的各种其他方法；一切都无济于事。

我目前的解决方案是通过 JavaScript 调用通知父网页并让它重新加载我的小程序。这不是一个很好的解决方案，我也不打算针对*它*引起的问题实施解决方法，只是因为 Flash 无法正确处理套接字连接。

我一定错过了一些非常简单的东西。

有任何想法吗？

1：我知道你不能真正摧毁物体；我只是删除了对它们的所有引用并希望最好。在这种情况下，我没有尝试显式调用 GC。（尽管我认为我确实尝试将 Socket 放入 Array 并使用*delete*。）

* * *

是的，如果连接成功，它会按预期工作（即使稍后连接断开。）

触发这种情况的唯一事件是服务器根本没有响应的情况；就好像 Flash 将主机/端口组合标记为“离线”，并且在小程序的生命周期内不再向其发送任何数据包。

我怀疑主动拒绝连接（例如主机在线但未监听端口）不会导致这种情况。

我没有从 Socket 收到任何错误消息或任何其他类型的反馈。

当第一个失败时，您是否曾经多次调用 connect() 到同一个主机/端口对？你怎么知道第一个 connect() 失败了？在随后的 connect() 调用之前，你有没有做任何事情来重置套接字？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T18:51:14.127

这可能与未解决的错误[FP-269有关，而该错误又可能与](http://bugs.adobe.com/jira/browse/FP-269)[FP-67](http://bugs.adobe.com/jira/browse/FP-67)具有相同的根本原因。

> 此版本应在 [labs.adobe.com上的当前公开测试版中修复](http://labs.adobe.com)
> 
> Edwin Wong - [08 年 9 月 23 日下午 4 点 49 分]

我建议您试一试[最新的公开测试版](http://labs.adobe.com/downloads/flashplayer10.html)...

# linux - Linux 辅助网卡连接下的 VMWare 服务器

> ID：8940
> 
> 赞同：0
> 
> 时间：2008-08-12T15:04:29.397
> 
> 标签：linux, vmware, sysadmin, nic

在 Linux (Debain) 下运行 VMWare 服务器时，我希望进行以下设置：

*   第一个：NIC 被 VMWare 下运行的许多映像使用，以及被 Linux 操作系统使用
*   第二：NIC 仅被 1 个映像使用，Linux 操作系统未使用（作为 DMZ 的一部分）

尽管 Linux 不会使用第二个 NIC，但它肯定被识别为 NIC（例如 eth1）。

这在VMWare Server下是否可行，如果可以，是否就像在Linux下不绑定eth1然后将其桥接到VMWare Server下的映像一样简单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T15:56:13.660

我相信您可以通过重新运行 vmware 配置脚本来设置所需的解决方案。并进行自定义网络设置，以便将两个 NIC 都映射到您的 vmware 实例。我建议将 eth0 设置为第二个 NIC，因为默认情况下 Linux 会更容易使用。然后将 eth1 设为第一个 NIC。

# c# - 通用类型检查

> ID：8941
> 
> 赞同：71
> 
> 时间：2008-08-12T15:07:40.887
> 
> 标签：c#, generics, primitive, type-safety

**有没有办法强制/限制传递给原语的类型？** *（布尔、整数、字符串等）*

*现在，我知道您可以通过where*子句将泛型类型参数限制为类型或接口实现。但是，这不符合原语（AFAIK）的要求，因为它们并不都有共同点（除了有人说之前的*对象*！：P）。

所以，我目前的想法是咬紧牙关，做一个大的*switch*语句，并在失败时抛出一个*ArgumentException 。*

* * *

**编辑1：**

只是为了澄清：

代码定义应该是这样的：

```
public class MyClass<GenericType> .... 
```

和实例化：

```
MyClass<bool> = new MyClass<bool>(); // Legal
MyClass<string> = new MyClass<string>(); // Legal
MyClass<DataSet> = new MyClass<DataSet>(); // Illegal
MyClass<RobsFunkyHat> = new MyClass<RobsFunkyHat>(); // Illegal (but looks awesome!) 
```

* * *

**编辑 2**

@Jon Limjap - 好点，我已经在考虑了。我确信有一个通用方法可用于确定该类型是值类型还是引用类型。

这对于立即删除许多我不想处理的对象很有用（但是您需要担心使用的结构，例如*Size*）。有趣的问题不是吗？:)

这里是：

```
where T: struct 
```

取自[MSDN](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)。

* * *

我很好奇。这可以使用扩展方法在 .NET 3.x 中完成吗？创建一个接口，并在扩展方法中实现该接口（这可能比有点胖的开关更干净）。另外，如果您以后需要扩展到任何轻量级自定义类型，它们也可以实现相同的接口，而无需更改基本代码。

你们有什么感想？

可悲的消息是我在框架 2 中工作！:D

* * *

**编辑 3**

从[Jon Limjaps Pointer](https://stackoverflow.com/questions/8941/generic-type-checking#8956)开始，这太简单了。太简单了，我几乎想哭，但这很棒，因为代码就像一个魅力！

所以这就是我所做的（你会笑的！）：

## 添加到泛型类的代码

```
bool TypeValid()
{
    // Get the TypeCode from the Primitive Type
    TypeCode code = Type.GetTypeCode(typeof(PrimitiveDataType));

    // All of the TypeCode Enumeration refer Primitive Types
    // with the exception of Object and Empty (Null).
    // Since I am willing to allow Null Types (at this time)
    // all we need to check for is Object!
    switch (code)
    {
        case TypeCode.Object:
            return false;
        default:
            return true;
    }
} 
```

然后是一个小工具方法来检查类型并抛出异常，

```
private void EnforcePrimitiveType()
{
    if (!TypeValid())
        throw new InvalidOperationException(
            "Unable to Instantiate SimpleMetadata based on the Generic Type of '" + typeof(PrimitiveDataType).Name + 
            "' - this Class is Designed to Work with Primitive Data Types Only.");
} 
```

然后需要做的就是在类构造函数中调用*EnforcePrimitiveType()*。任务完成！:-)

唯一的缺点是，它只在运行时（显然）而不是设计时抛出异常。但这没什么大不了的，可以使用[FxCop](http://en.wikipedia.org/wiki/FxCop)之类的实用程序（我们在工作中不使用）。

在此特别感谢 Jon Limjap！

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-08-12T15:11:58.990

```
public class Class1<GenericType> where GenericType : struct
{
} 
```

这似乎完成了这项工作..

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-08-12T15:21:44.010

[`TypeCode`](http://msdn.microsoft.com/en-us/library/system.typecode.aspx)枚举中似乎指定了原语：

也许有一种方法可以找出对象是否包含 ，`TypeCode enum`而无需将其强制转换为特定对象或调用`GetType()`or `typeof()`？

**更新**它就在我的眼皮底下。那里的代码示例显示了这一点：

```
static void WriteObjectInfo(object testObject)
{
    TypeCode    typeCode = Type.GetTypeCode( testObject.GetType() );

    switch( typeCode )
    {
        case TypeCode.Boolean:
            Console.WriteLine("Boolean: {0}", testObject);
            break;

        case TypeCode.Double:
            Console.WriteLine("Double: {0}", testObject);
            break;

        default:
            Console.WriteLine("{0}: {1}", typeCode.ToString(), testObject);
            break;
        }
    }
} 
```

它仍然是一个丑陋的开关。但这是一个很好的起点！

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-08-12T15:43:37.260

@Lars 已经说过的差不多了：

```
//Force T to be a value (primitive) type.
public class Class1<T> where T: struct

//Force T to be a reference type.
public class Class1<T> where T: class

//Force T to be a parameterless constructor.
public class Class1<T> where T: new() 
```

所有工作在 .NET 2、3 和 3.5 中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T05:52:05.993

如果您可以容忍使用工厂方法（而不是您要求的构造函数 MyClass），您总是可以这样做：

```
class MyClass<T>
{
  private readonly T _value;

  private MyClass(T value) { _value = value; }

  public static MyClass<int> FromInt32(int value) { return new MyClass<int>(value); }
  public static MyClass<string> FromString(string value) { return new MyClass<string>(value); }
  // etc for all the primitive types, or whatever other fixed set of types you are concerned about
} 
```

这里的一个问题是您需要输入`MyClass<AnyTypeItDoesntMatter>.FromInt32`，这很烦人。如果您想保持构造函数的私有性，则没有一个很好的解决方法，但这里有一些解决方法：

*   创建一个抽象类`MyClass`。`MyClass<T>`继承自`MyClass` **并将其嵌套`MyClass`**在. 将静态方法移至`MyClass`. 这将解决所有可见性问题，但代价是必须访问`MyClass<T>`as `MyClass.MyClass<T>`。
*   按照给定的方式使用`MyClass<T>`。创建一个静态类，它在使用`MyClass`中调用静态方法（可能每次都使用适当的类型，只是为了傻笑）。`MyClass<T>``MyClass<AnyTypeItDoesntMatter>`
*   （更简单，但肯定很奇怪）创建一个`MyClass` **继承自`MyClass<AnyTypeItDoesntMatter>`**. （为了具体起见，假设为`MyClass<int>`。）因为您可以通过派生类的名称调用在基类中定义的静态方法，所以您现在可以使用`MyClass.FromString`.

这为您提供了静态检查，但代价是更多的写入。

如果您对动态检查感到满意，我会在上面的 TypeCode 解决方案中使用一些变体。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-26T17:08:12.250

@Rob, `Enum`'s 将按原样通过`TypeValid`函数。我已经更新了函数来检查.`TypeCode``Integer``Enum`

```
Private Function TypeValid() As Boolean
    Dim g As Type = GetType(T)
    Dim code As TypeCode = Type.GetTypeCode(g)

    ' All of the TypeCode Enumeration refer Primitive Types
    ' with the exception of Object and Empty (Nothing).
    ' Note: must also catch Enum as its type is Integer.
    Select Case code
        Case TypeCode.Object
            Return False
        Case Else
            ' Enum's TypeCode is Integer, so check BaseType
            If g.BaseType Is GetType(System.Enum) Then
                Return False
            Else
                Return True
            End If
    End Select
End Function 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-12T15:21:05.433

使用自定义[FxCop](http://en.wikipedia.org/wiki/FxCop)规则来标记`MyClass<>`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-19T22:38:42.603

`EnforcePrimitiveType`您可以通过使用[`typeof(PrimitiveDataType).IsPrimitive`](http://msdn.microsoft.com/en-us/library/system.type.isprimitive.aspx)属性来简化该方法。我错过了什么吗？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-07-27T14:47:55.360

遇到类似的挑战，我想知道你们对[IConvertible 界面](http://msdn.microsoft.com/en-us/library/system.iconvertible.aspx)有何感受。它允许请求者的要求，并且您可以使用自己的实现进行扩展。

例子：

```
 public class MyClass<TKey>
    where TKey : IConvertible
{
    // class intentionally abbreviated
} 
```

我认为这是一个解决方案，尽管许多建议也是我选择的一部分。

但是，我担心的是，它是否会误导使用您的课程的潜在开发人员？

干杯-谢谢。

# python - 使用 Python 访问 MP3 元数据

> ID：8948
> 
> 赞同：141
> 
> 时间：2008-08-12T15:16:00.637
> 
> 标签：python, mp3, metadata

是否有可用于使用 Python 检索和设置 MP3 ID3 元数据的维护包？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-09-19T14:30:41.610

前几天我使用[eyeD3](http://eyed3.nicfit.net/)取得了很大的成功。我发现它可以将艺术品添加到我查看的其他模块不能的 ID3 标签中。您必须使用 pip 安装或下载 tar 并`python setup.py install`从源文件夹执行。

网站上的相关示例如下。

读取包含 v1 或 v2 标签信息的 mp3 文件的内容：

```
 import eyeD3
 tag = eyeD3.Tag()
 tag.link("/some/file.mp3")
 print tag.getArtist()
 print tag.getAlbum()
 print tag.getTitle() 
```

读取一个 mp3 文件（音轨长度、比特率等）并访问它的标签：

```
if eyeD3.isMp3File(f):
     audioFile = eyeD3.Mp3AudioFile(f)
     tag = audioFile.getTag() 
```

可以选择特定的标签版本：

```
 tag.link("/some/file.mp3", eyeD3.ID3_V2)
 tag.link("/some/file.mp3", eyeD3.ID3_V1)
 tag.link("/some/file.mp3", eyeD3.ID3_ANY_VERSION)  # The default. 
```

或者您可以遍历原始帧：

```
 tag = eyeD3.Tag()
 tag.link("/some/file.mp3")
 for frame in tag.frames:
    print frame 
```

将标签链接到文件后，可以对其进行修改和保存：

```
 tag.setArtist(u"Cro-Mags")
 tag.setAlbum(u"Age of Quarrel")
 tag.update() 
```

如果链接的标签是 v2 并且您想将其保存为 v1：

```
 tag.update(eyeD3.ID3_V1_1) 
```

读入标签并将其从文件中删除：

```
 tag.link("/some/file.mp3")
 tag.remove()
 tag.update() 
```

添加新标签：

```
 tag = eyeD3.Tag()
 tag.link('/some/file.mp3')    # no tag in this file, link returned False
 tag.header.setVersion(eyeD3.ID3_V2_3)
 tag.setArtist('Fugazi')
 tag.update() 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-08-14T09:46:21.270

我以前使用过[诱变剂](https://github.com/quodlibet/mutagen)来编辑媒体文件中的标签。mutagen 的好处是它可以处理其他格式，例如 mp4、FLAC 等。我使用这个 API 编写了几个脚本并取得了很大的成功。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-01-24T00:07:24.693

一个问题`eyed3`是它会抛出`NotImplementedError("Unable to write ID3 v2.2")`常见的 MP3 文件。

以我的经验，`mutagen`该类的`EasyID3`工作更可靠。例子：

```
from mutagen.easyid3 import EasyID3

audio = EasyID3("example.mp3")
audio['title'] = u"Example Title"
audio['artist'] = u"Me"
audio['album'] = u"My album"
audio['composer'] = u"" # clear
audio.save() 
```

所有其他标签都可以通过这种方式访问​​并保存，这将用于大多数用途。更多信息可以在[Mutagen 教程](https://mutagen.readthedocs.io/en/latest/user/id3.html?#easy-id3)中找到。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-08-13T00:44:26.090

你所追求的是[ID3](http://id3-py.sourceforge.net/)模块。它非常简单，可以为您提供所需的一切。只需将 ID3.py 文件复制到您的站点包目录中，您就可以执行以下操作：

```
from ID3 import *
try:
  id3info = ID3('file.mp3')
  print id3info
  # Change the tags
  id3info['TITLE'] = "Green Eggs and Ham"
  id3info['ARTIST'] = "Dr. Seuss"
  for k, v in id3info.items():
    print k, ":", v
except InvalidTagError, message:
  print "Invalid ID3 tag:", message 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-12-30T01:40:52.153

看看这个：

[https://github.com/Ciantic/songdetails](https://github.com/Ciantic/songdetails)

使用示例：

```
>>> import songdetails
>>> song = songdetails.scan("data/song.mp3")
>>> print song.duration
0:03:12 
```

保存更改：

```
>>> import songdetails
>>> song = songdetails.scan("data/commit.mp3")
>>> song.artist = "Great artist"
>>> song.save() 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-07-08T08:24:29.367

只是给你们的补充信息：

[查看PythonInMusic](http://wiki.python.org/moin/PythonInMusic)页面中的“MP3 素材和元数据编辑器”部分。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-12-20T19:32:11.247

我查看了上面的答案，发现由于 GPL 的许可问题，它们对我的项目不利。

我发现了这个：[PyID3Lib](http://pyid3lib.sourceforge.net/)，虽然那个特定的*python 绑定*发布日期很旧，但它使用[ID3Lib](http://id3lib.sourceforge.net/)，它本身是最新的。

值得注意的是，两者都是**LGPL**，并且很好。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-08-11T09:05:38.410

最简单的方法是[歌曲详细信息](https://github.com/Ciantic/songdetails)..

用于读取数据

```
import songdetails
song = songdetails.scan("blah.mp3")
if song is not None:
    print song.artist 
```

同样用于编辑

```
import songdetails
song = songdetails.scan("blah.mp3")
if song is not None:
    song.artist = u"The Great Blah"
    song.save() 
```

在你懂中文之前不要忘记在名字前加**你。**

您可以使用 python glob 模块批量读取和编辑

前任。

```
import glob
songs = glob.glob('*')   # script should be in directory of songs.
for song in songs:
    # do the above work. 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-03-10T21:02:09.697

我使用[tinytag 1.3.1](https://pypi.org/project/tinytag/)因为

1.  积极支持：

```
1.3.0 (2020-03-09):
added option to ignore encoding errors ignore_errors #73
Improved text decoding for many malformed files 
```

2.  它支持主要格式：

```
MP3 (ID3 v1, v1.1, v2.2, v2.3+)
Wave/RIFF
OGG
OPUS
FLAC
WMA
MP4/M4A/M4B 
```

3.  该代码在短短几分钟的开发中就可以运行。

```
from tinytag import TinyTag

fileNameL ='''0bd1ab5f-e42c-4e48-a9e6-b485664594c1.mp3
0ea292c0-2c4b-42d4-a059-98192ac8f55c.mp3
1c49f6b7-6f94-47e1-a0ea-dd0265eb516c.mp3
5c706f3c-eea4-4882-887a-4ff71326d284.mp3
'''.split()

for fn in fileNameL:
    fpath = './data/'+fn
    tag = TinyTag.get(fpath)
    print()
    print('"artist": "%s",' % tag.artist)
    print('"album": "%s",' % tag.album)
    print('"title": "%s",' % tag.title)
    print('"duration(secs)": "%s",' % tag.duration) 
```

*   结果

```
JoeTagPj>python joeTagTest.py

"artist": "Conan O’Brien Needs A Friend",
"album": "Conan O’Brien Needs A Friend",
"title": "17\. Thomas Middleditch and Ben Schwartz",
"duration(secs)": "3565.1829583532785",

"artist": "Conan O’Brien Needs A Friend",
"album": "Conan O’Brien Needs A Friend",
"title": "Are you ready to make friends?",
"duration(secs)": "417.71840447045264",

"artist": "Conan O’Brien Needs A Friend",
"album": "Conan O’Brien Needs A Friend",
"title": "Introducing Conan’s new podcast",
"duration(secs)": "327.22187551899646",

"artist": "Conan O’Brien Needs A Friend",
"album": "Conan O’Brien Needs A Friend",
"title": "19\. Ray Romano",
"duration(secs)": "3484.1986772305863",

C:\1d\PodcastPjs\JoeTagPj> 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2018-04-16T01:34:52.833

在尝试了这里推荐的 eyeD3、pytaglib 和 ID3 模块的简单`pip install`路径后，我发现这第四个选项是唯一可行的。其余的有导入错误，缺少 C++ 中的依赖项或某些魔术或其他一些缺少的库`pip`。所以用这个来基本阅读 ID3 标签（所有版本）：

[https://pypi.python.org/pypi/tinytag/0.18.0](https://pypi.python.org/pypi/tinytag/0.18.0)

```
from tinytag import TinyTag
tag = TinyTag.get('/some/music.mp3') 
```

您可以使用 TinyTag 获得的可能属性列表：

```
tag.album         # album as string
tag.albumartist   # album artist as string
tag.artist        # artist name as string
tag.audio_offset  # number of bytes before audio data begins
tag.bitrate       # bitrate in kBits/s
tag.disc          # disc number
tag.disc_total    # the total number of discs
tag.duration      # duration of the song in seconds
tag.filesize      # file size in bytes
tag.genre         # genre as string
tag.samplerate    # samples per second
tag.title         # title of the song
tag.track         # track number as string
tag.track_total   # total number of tracks as string
tag.year          # year or data as string 
```

正如所宣传的那样，它很小且独立。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-08-12T15:37:24.837

Dive Into Python 一书中的一个简单示例对我来说可以，[这](http://www.diveintopython.org/download/diveintopython-examples-5.4.zip)是下载链接，示例是 fileinfo.py。不知道它是否是最好的，但它可以完成基本工作。

整本书可[在此处](http://www.diveintopython.org/)在线获取。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-04-08T15:52:20.267

使用[eyed3](http://eyed3.nicfit.net/)的第一个答案已过时，因此这里是它的更新版本。

从 mp3 文件中读取标签：

```
 import eyed3

 audiofile = eyed3.load("some/file.mp3")
 print(audiofile.tag.artist)
 print(audiofile.tag.album)
 print(audiofile.tag.album_artist)
 print(audiofile.tag.title)
 print(audiofile.tag.track_num) 
```

网站上修改标签的示例：

```
 import eyed3

 audiofile = eyed3.load("some/file.mp3")
 audiofile.tag.artist = u"Integrity"
 audiofile.tag.album = u"Humanity Is The Devil"
 audiofile.tag.album_artist = u"Integrity"
 audiofile.tag.title = u"Hollow"
 audiofile.tag.track_num = 2 
```

我第一次尝试使用 eyed3 时遇到的一个问题与 libmagic 的导入错误有关，即使它已安装。[要解决此问题，请从此处](https://pypi.python.org/pypi/python-magic-bin)安装 magic-bin whl

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-06-26T13:50:36.257

我会建议**[mp3-tagger](https://pypi.org/project/mp3-tagger/)**。最好的一点是它在**MIT 许可**下分发并支持所有必需的属性。

```
- artist;
- album;
- song;
- track;
- comment;
- year;
- genre;
- band;
- composer;
- copyright;
- url;
- publisher. 
```

例子：

```
from mp3_tagger import MP3File

# Create MP3File instance.
mp3 = MP3File('File_Name.mp3')

# Get all tags.
tags = mp3.get_tags()
print(tags) 
```

它支持设置、获取、更新和删除 mp3 文件的属性。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-08-12T15:37:59.080

除了读取元数据之外，它还可以完全取决于您想要做什么。如果它只是您需要的比特率/名称等，没有别的，那么轻量级的东西可能是最好的。

如果您正在处理 mp3，那么 PyMedia 可能是合适的。

有很多，无论您得到什么，请确保并在大量示例媒体上进行测试。特别是有几个不同版本的 ID3 标签，所以请确保它不会太过时。

就个人而言，我很幸运地使用了这个小型 MP3Info 类。不过它已经很老了。

[http://www.omniscia.org/~vivake/python/MP3Info.py](http://www.omniscia.org/~vivake/python/MP3Info.py)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-07-12T23:17:59.617

经过一些初步研究，我认为 songdetails 可能适合我的用例，但它不能处理 .m4b 文件。诱变剂可以。请注意，虽然有些人（合理地）对 Mutagen 的 format-native 键的表面处理提出了问题，但因格式而异（mp3 为 TIT2，ogg 为标题，mp4 为 \xa9nam，WMA 为标题等），mutagen.File( ) 有一个（新的？）easy=True 参数，它提供了 EasyMP3/EasyID3 标签，这些标签有一组一致但有限的​​键。到目前为止，我只进行了有限的测试，但是当使用 easy=True 时，.mb4 和 .mp3 文件的常用键，如专辑、艺术家、专辑艺术家、流派、曲目编号、光盘编号等都存在并且相同，使其成为非常方便我的目的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-02-06T23:51:17.937

使用[https://github.com/nicfit/eyeD3](https://github.com/nicfit/eyeD3)

```
import eyed3
import os

for root,  dirs, files in os.walk(folderp):
    for file in files:
        try:
            if file.find(".mp3") < 0:
                continue
            path = os.path.abspath(os.path.join(root , file))
            t = eyed3.load(path)
            print(t.tag.title , t.tag.artist)
            #print(t.getArtist())
        except Exception as e:
            print(e)
            continue 
```

# sharepoint - SharePoint WSS 3.0 与 Mac OSX（Safari 或 Firefox）的集成

> ID：8950
> 
> 赞同：1
> 
> 时间：2008-08-12T15:17:47.217
> 
> 标签：sharepoint, macos, wss

我们在 Mac OSX 平台上有一个 SharePoint WSS 站点和我们的一些用户。是否有任何提示或技巧可以在 Mac 上通过文档共享和日历获得与 Windows 类似的体验？

编辑：在 Mac 上浏览 SharePoint WSS 网站，无论是使用 Firefox 还是 Safari，都具有与在 Windows IE 上非常相似的外观和感觉。我正在寻找的类似体验与将日历、文档共享等集成到桌面有关。

例如，使用 IE，您可以转到日历并选择“操作 -> 连接到 Outlook”，这将使日历在 Outlook 中可见和可管理。

有什么方法可以让 Mac 以类似方式工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-12T15:27:35.373

不幸的是，“完整”的 Sharepoint 体验仅限于运行 Internet Explorer 6/7 和 Office 2007。

在 Mac 上，我推荐使用 Firefox（Camino？），它似乎比 Safari 好一点。

编辑：当你说“类似的经历”时，你到底错过了什么？我这里没有任何 Mac，但我的印象是 Office 2008 也将与 Sharepoint 进行有效集成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-12T19:49:14.393

Office 2008 允许与 MOSS 的有限连接。然而，目前还没有与 MOSS 完全兼容的 Mac OS 浏览器。

我确实得到了 Microsoft Mac BU 团队与 MOSS 团队合作的充分授权，以在平台的未来版本中看到这种变化，特别是围绕 Safari 支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T19:16:35.757

是的，Sharepoint 着眼于 Office 应用程序和 Active X 的客户端安装，以便完全集成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T18:35:25.153

ActiveX 是用来搭建 MOSS 和 Office 之间的桥梁，由于 ActiveX 只在 Windows 上，如果你不使用 Windows 作为你的操作系统，你会发现你无法获得完整的体验。

# sql-server - 将文件存储在数据库中而不是文件系统中？

> ID：8952
> 
> 赞同：85
> 
> 时间：2008-08-12T15:20:25.637
> 
> 标签：sql-server, database, filesystems, storage

一般来说，与文件系统相比，将文件存储在数据库（特别是 mssql）中对性能的影响有多大？除了应用程序可移植性之外，我想不出我想将我的文件作为 varbinaries 存储在 SQL Server 中的原因。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-08-12T15:23:54.460

看看这个答案：

[在 DB 中存储图像 - 是还是不是？](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay#3756)

从本质上讲，空间和性能影响可能相当大，具体取决于用户数量。另外，请记住，Web 服务器很便宜，您可以轻松添加更多来平衡负载，而数据库通常是 Web 架构中最昂贵且最难扩展的部分。

有一些相反的例子（例如，Microsoft Sharepoint），但通常，将文件存储在数据库中并不是一个好主意。

除非您可能编写桌面应用程序和/或大致知道您将拥有多少用户，但是在像公共网站这样随机且出乎意料的东西上，您可能会为在数据库中存储文件付出高昂的代价。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-08-12T15:44:26.087

如果您可以迁移到 SQL Server 2008，则可以利用 FILESTREAM 支持，它可以为您提供两全其美的优势 - 文件存储在文件系统中，但数据库集成比仅将文件路径存储在 varchar 字段中要好得多。您的查询可以返回一个标准的 .NET 文件流，这使得集成更加简单。

[FILESTREAM 存储入门](http://msdn.microsoft.com/en-us/library/bb933995.aspx)

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-08-12T17:59:31.463

我会说，这取决于你的情况。例如，我在当地政府工作，我们有很多照片，比如面部照片等。我们的用户数量并不多，但我们需要对数据进行良好的安全性和审计。数据库对我们来说是一个更好的解决方案，因为它使这更容易，而且我们不会遇到扩展问题。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-12T15:23:58.810

这里有什么问题？

现代 DBMS SQL2008 有多种处理 BLOB 的方法，而不仅仅是将它们粘在表中。当然，有利也有弊，您可能需要更深入地考虑它。

这是一篇有趣的论文，作者是已故的（？）吉姆·格雷

[To BLOB or Not To BLOB：数据库或文件系统中的大对象存储](https://www.microsoft.com/en-us/research/publication/to-blob-or-not-to-blob-large-object-storage-in-a-database-or-a-filesystem/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T15:21:42.683

根据我自己的经验，将文件存储为文件总是更好。原因是文件系统针对文件存储进行了优化，而数据库则没有。当然，也有一些例外（例如，广受赞誉的下一代 MS 文件系统应该建立在 SQL 服务器之上），但总的来说这是我的规则。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-28T00:39:55.137

虽然性能是一个问题，但我认为现代数据库设计已使其不再是小文件的问题。

除了性能之外，它还取决于数据的紧密耦合程度。如果文件包含与数据库字段密切相关的数据，那么它在概念上属于靠近它并且可能存储在 blob 中。如果它包含可能与多条记录相关的信息，或者可能在数据库上下文之外有一些用途，那么它就属于外部。例如，网页上的图像是从链接到它的页面的单独请求中获取的，因此它可能属于外部（取决于特定的设计和安全考虑）。

我们的妥协，我不保证它是最好的，是在数据库中存储小的 XML 文件，但在它之外存储图像和其他文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-12T15:53:01.747

我们决定将[http://www.freshlogicstudios.com/Products/Folders/](http://www.freshlogicstudios.com/Products/Folders/)存储为 varbinary 以预期性能问题。我可以说我们对它的效果感到惊喜。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-12T15:27:00.863

我同意@ZombieSheep。还有一件事——我通常认为数据库实际上不需要是可移植的，因为您错过了 DBMS 供应商提供的所有功能。我认为迁移到另一个数据库将是人们会考虑的最后一件事。只是我的 $.02

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-12T15:30:25.583

必须将 blob（图像）解析为字节数组，然后以正确的文件名将其写入磁盘然后读取它的开销足以阻止您过于频繁地执行此操作，特别是如果文件是相当大。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T18:05:11.980

不要含糊其词，但我认为您将存储的“文件”类型是最大的决定因素之一。如果您实质上谈论可以存储为文件的大型文本字段，那么我的首选将是数据库存储。

# c# - 在 Vista 上使用 C#/WIA 2.0 版进行扫描

> ID：8966
> 
> 赞同：23
> 
> 时间：2008-08-12T15:28:34.573
> 
> 标签：c#, .net, .net-3.5, wia, image-scanner

我想实现一个无纸化归档系统，并希望将 WIA 与 C# 一起用于图像采集。CodeProject等上有很多示例项目。但是，在下载了我能找到的每一个之后，我遇到了一个问题。

在每一个中，对 WIALib 的引用都被破坏了。当我添加“Microsoft Windows Image Acquisition”作为参考时，我的开发工作站（也是运行它的机器）上唯一可用的版本是 2.0。

不幸的是，这些示例项目中的每一个似乎都是针对 1.x 进行编码的。该引用以“WIA”而不是“WIALib”的形式出现。我试了一下，只是更改了命名空间导入，但显然 API 完全不同。

是否有关于实施 v2.0 或升级这些现有示例项目之一的信息？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-20T11:28:57.827

要访问 WIA，您需要添加对 COM 库“Microsoft Windows Image Acquisition Library v2.0”(wiaaut.dll) 的引用。添加“使用WIA；”

```
const string wiaFormatJPEG = "{B96B3CAE-0728-11D3-9D7B-0000F81EF32E}";
CommonDialogClass wiaDiag = new CommonDialogClass();
WIA.ImageFile wiaImage = null;

wiaImage = wiaDiag.ShowAcquireImage(
        WiaDeviceType.UnspecifiedDeviceType, 
        WiaImageIntent.GrayscaleIntent, 
        WiaImageBias.MaximizeQuality, 
        wiaFormatJPEG, true, true, false);

WIA.Vector vector = wiaImage.FileData; 
```

(系统.绘图)

```
Image i = Image.FromStream(new MemoryStream((byte[])vector.get_BinaryData()));
i.Save(filename) 
```

这是一种基本方式，适用于我的平板/文档进纸器。但是，如果您一次需要多个文档/页面，则可能有一种更好的方法（据我所知，这一次只能处理一个图像，尽管我不完全确定）。虽然它是 WIA v1 文档，但 Scott Hanselman[在 WIA 上的 Coding4Fun 文章](http://blogs.msdn.com/coding4fun/archive/2006/10/31/912546.aspx)确实包含一些关于如何为多个页面执行此操作的更多信息，我认为（我自己还没有走得更远）

如果它用于无纸化办公系统，您可能还需要查看 MODI（Office Document Imaging）来为您完成所有 OCR。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-23T18:13:56.853

下面介绍如何以 WIA 1.0 为目标，这样您就可以将您的应用程序发布到 Windows Xp。我拼命寻找的东西！ [Vista下如何使用WIA 1进行开发？](https://stackoverflow.com/questions/678844/how-to-develop-using-wia-1-under-vista)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-28T10:38:32.730

**更新**：我单独添加它，因为它的答案不同（一年后）。我了解到 XP 有 WIA 1.0，Vista 以后有 WIA2.0。[但是，您可以从此处](http://www.microsoft.com/download/en/details.aspx?id=18287)安装适用于 Windows XP Sp1+ 的 WIA 2.0 。

然后我还用我在互联网上某处找到的代码制作了一个小库，它还具有扫描多个页面的能力：http: [//adfwia.codeplex.com/](http://adfwia.codeplex.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-12T16:28:10.740

它**不需要**是WIA。我主要关注的是 WIA 设置，因为它为不同的扫描仪提供了相同的基本界面。我在这台机器上安装了 3 台扫描仪，所有这些扫描仪的 TWAIN 驱动程序/软件都很糟糕（比如在扫描过程中挡住了屏幕）。

对于文档管理，我真的在寻找简单的 200dpi 灰度扫描，所以 TWAIN 驱动程序中的大部分内容都是多余的。

也就是说，在这里提问是我在继续使用 TWAIN 之前最后一次尝试弄清楚如何在 WIA 中进行操作的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T15:47:17.457

另一个注意事项：您必须从 Microsoft.com 下载 WIA 2.0 dll，然后浏览到该 dll 并将其添加到您的项目中。

# java - 如果我需要做 Spring 友好的 WorkFlow，我应该看什么 OSS 项目？

> ID：8968
> 
> 赞同：12
> 
> 时间：2008-08-12T15:29:18.067
> 
> 标签：java, spring, workflow

我们需要将 WorkFlow 添加到我们的 Spring 托管应用程序中。有没有人在使用无数的 OSS 工作流解决方案方面有任何有用的经验？哪个最好？哪一个与 Spring 集成得最好？我们应该避免哪些？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-13T02:02:38.537

如果你只需要一些简单的流程编排，Spring 自己的[Web Flow](http://springframework.org/webflow)，尽管它的名字可以充当一个编排任务管理器。如果您需要将状态保存几天，那么您将需要成为其中一个开源项目的“早期采用者”。您可能想查看[Eclipse 的 BPEL 项目](http://www.eclipse.org/bpel/)。

我的预感是，一旦 BPEL/BPM/Workflow 空间出现更清晰的画面，您将看到 Spring 提供了一个抽象层，就像它们为 JDBC、事务、ORM 框架等提供的一样......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T11:55:53.980

正如 Brian 所说，如果您正在做任何非常复杂的事情，您可能会考虑使用 BPEL。

有许多开源 BPEL 引擎，想到的一个是[Apache Orchestration Director Engine](http://ode.apache.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-20T12:17:14.700

我是第二个 Spring Web Flow。根据流程的复杂程度，Web Flow 非常适合管理各种状态，我发现它很容易上手，并且有大量的文档可供使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-13T12:15:19.377

我们正在研究 Drools/Guvnor，可能与 jBPM 集成（如本[演示文稿](http://www.firstpartners.net/blog/technology/java/2008/06/05/jboss-business-rules-and-jbpm-workflow-presentation-dublin/)中所示），以将工作流引擎添加到我们的 Spring/Java EE 应用程序中，但我们仍处于尝试的早期阶段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T10:14:46.860

在我看来，ActiveVOS 是迄今为止最好的 BPEL 引擎。下载评估版并试一试。JBoss 甚至采用了他们的开源产品。

# objective-c - 以编程方式访问 iSight？

> ID：8970
> 
> 赞同：7
> 
> 时间：2008-08-12T15:31:40.200
> 
> 标签：objective-c, macos, webcam, isight

是否可以通过编程方式访问 macbook 上的 iSight 摄像头？我的意思是我希望能够根据命令从 iSight 相机中抓取静止帧，然后对它们进行处理。如果是这样，它是否只能使用目标 c 访问，或者也可以使用其他语言？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-14T05:28:59.683

您应该查看[QTKit Capture 文档](http://developer.apple.com/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/Introduction/chapter_1_section_1.html#//apple_ref/doc/uid/TP40004574-CH1-DontLinkElementID_41)。

在 Leopard 上，您可以通过 RubyCocoa 桥获得所有内容：

```
require 'osx/cocoa'
OSX.require_framework("/System/Library/Frameworks/QTKit.framework")

OSX::QTCaptureDevice.inputDevices.each do |device|
    puts device.localizedDisplayName
end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-12T15:39:32.727

我这里没有 Mac，但这里有一些文档：

[http://developer.apple.com/documentation/Hardware/Conceptual/iSightProgGuide/01introduction/chapter_1_section_1.html](http://developer.apple.com/documentation/Hardware/Conceptual/iSightProgGuide/01introduction/chapter_1_section_1.html)

看起来您必须通过 QuickTime API。[应该有一个名为“MungGrab”的示例项目，根据这个线程](http://www.mailinglistarchive.com/quicktime-api@lists.apple.com/msg02698.html)可能值得一看。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T14:56:14.633

如果您浏览 Apple 的邮件列表，您也可以找到一些用 Java 编写的代码。[这是一个适合捕获单个帧的简单示例](http://lists.apple.com/archives/QuickTime-java/2007/Jan/msg00003.html)，[这是一个更复杂的示例，它的速度足以显示实时视频](http://lists.apple.com/archives/QuickTime-java/2005/Nov/msg00036.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T14:08:14.907

到目前为止还没有提到的一件事是[IKPictureTaker](http://developer.apple.com/documentation/GraphicsImaging/Reference/IKImagePicker_Class/IKImagePicker_Reference.html)，它是 Image Kit 的一部分。这将提供标准操作系统提供的面板来拍照，包括所有可能的过滤器功能等。我不确定这是否是你想要的。

我想你也可以从其他语言中使用它，考虑到有[可可桥](http://www.cocoadev.com/index.pl?CocoaBridges)之类的东西，但我没有使用它们的经验。

谷歌搜索还提出了[另一个关于 stackoverflow](https://stackoverflow.com/questions/57424?sort=newest)的问题，似乎解决了这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-13T15:49:52.143

There's a command line utility called `[isightcapture](http://www.intergalactic.de/pages/iSight.html)` that does more or less what you want to do. You could probably get the code from the developer (his e-mail address is in the readme you get when you download the utility).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-12T18:53:01.120

除了 ObjC，您还可以使用 PyObjC 或 RubyCocoa 绑定来访问它。如果您对哪种语言不挑剔，我会说使用 Ruby，因为 PyObjC 的文档记录非常糟糕（甚至 Apple 官方页面也指的是旧版本，而不是 OS X Leopard 附带的版本）

Quartz Composer 可能是访问它的最简单方法，并且 .quartz 文件可以很容易地嵌入到应用程序中（并且数据通过管道输出到 ObjC 等）

另外，我想 /Developer/Examples/ 中应该有一个或两个这样的例子

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-03T15:35:58.283

从专门要求解决方案为 pythonic 的相关问题中，您应该尝试使用Andrew Straw[的 motmot 的 camiface](http://github.com/motmot/pycamiface)库。它也适用于火线相机，但也适用于您正在寻找的 isight。

从教程：

```
import motmot.cam_iface.cam_iface_ctypes as cam_iface
import numpy as np

mode_num = 0
device_num = 0
num_buffers = 32

cam = cam_iface.Camera(device_num,num_buffers,mode_num)
cam.start_camera()
frame = np.asarray(cam.grab_next_frame_blocking())
print 'grabbed frame with shape %s'%(frame.shape,) 
```

# c# - 从 .NET 调用表值 SQL 函数

> ID：8987
> 
> 赞同：30
> 
> 时间：2008-08-12T15:50:49.460
> 
> 标签：c#, .net, sql

可以从 .NET 调用标量值函数，如下所示：

```
SqlCommand cmd = new SqlCommand("testFunction", sqlConn); //testFunction is scalar
cmd.CommandType = CommandType.StoredProcedure;  
cmd.Parameters.Add("retVal", SqlDbType.Int);
cmd.Parameters["retVal"].Direction = ParameterDirection.ReturnValue;
cmd.ExecuteScalar();
int aFunctionResult = (int)cmd.Parameters["retVal"].Value; 
```

我也知道可以以类似的方式调用表值函数，例如：

```
String query = "select * from testFunction(param1,...)"; //testFunction is table-valued
SqlCommand cmd = new SqlCommand(query, sqlConn);
SqlDataAdapter adapter = new SqlDataAdapter(cmd);
adapter.Fill(tbl); 
```

我的问题是，表值函数可以像标量值函数一样被称为存储过程吗？（例如，复制我的第一个代码片段，调用表值函数并通过 ReturnValue 参数获取返回的表）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-08-12T15:53:26.193

不，因为您需要选择它们。但是，您可以创建一个存储的 proc 包装器，这可能会破坏拥有表函数的意义。**