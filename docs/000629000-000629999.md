# StackOverflow 问答 000629000-000629999

# c# - 我可以像使用 LINQ to SQL 一样使用实体框架吗？

> ID：629002
> 
> 赞同：3
> 
> 时间：2009-03-10T05:16:36.260
> 
> 标签：c#, linq-to-sql, entity-framework, linq-to-entities

我已经开始尝试使用 LINQ to SQL，我所做的基本上是使用 LINQ 映射装饰器创建类 - 从而选择我想要合并到我的类中的 db 表模式的哪些部分。

一个简单的例子：

```
private DateTime? _LocalCopyTimestamp = (DateTime)SqlDateTime.MinValue;
[Column(Name = "recaLocalCopyTimestamp", Storage = "_LocalCopyTimestamp", CanBeNull = true)]
public DateTime? LocalCopyTimestamp
{
    get
    {
        return this._LocalCopyTimestamp;
    }
    set
    {
        this._LocalCopyTimestamp = value;
    }
} 
```

由于项目限制（处理模式更改的方式以及因为存在现有的数据库模式并且它有点过于有机和不严格），我没有使用并且不愿意求助于建模工具

有没有办法让实体框架具有这种灵活性，而不必包含架构信息文件和/或许多不同的代码文件？

然后我是否还可以创建“使用”多个基础表的类？

谁能指出我有关此的文档？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T11:56:39.840

您请求的功能（编写 C# 类并从中生成模型）被实体框架团队称为“[模型优先](http://blogs.msdn.com/efdesign/archive/2008/09/10/model-first.aspx)”。它在实体框架的当前发布版本中不存在，但它是下一个版本的计划功能。如果您观看[PDC 的 Entity Framework 演讲](http://mschnlnine.vo.llnwd.net/d1/pdc08/WMV-HQ/TL20.wmv)，您可以看到此新功能的演示。在当前版本中，您不必编写“许多”映射文件，但您确实需要一个（EDMX 文件），而且它必须是 XML。

是的，您可以创建使用多个基础表的实体类。这称为“[实体拆分](http://blogs.microsoft.co.il/blogs/gilf/archive/2009/03/06/entity-splitting-in-entity-framework.aspx)”。链接中的分步说明。通常，您会发现实体框架支持比 LINQ to SQL 更复杂的映射方案。

恐怕我不得不完全不同意 Marc 关于在不使用设计器的情况下编写 EDMX 的观点。在不使用设计器的情况下编写 EDMX 不仅是可能的，而且对于超出某一方面的项目，这几乎是不可避免的。对此有几点看法：

1.  For most of the early history (pre-RTM; "[ObjectSpaces](http://msdn.microsoft.com/en-us/library/ms971512.aspx)") of the Entity Framework, writing the XML files manually was the only way to use the tool. The designer is a recent feature, and is considerably less stable than the Entity Framework itself.
2.  There are certain Entity Framework features, such as complex types, which are not supported in the designer at all.
3.  Certain mapping scenarios, such as not mapping individual columns, or mapping tables without a foreign key relationship, which may be necessary for legacy databases, are not supported in the designer.
4.  As I mentioned in (1) the designer is quite a bit buggier than the Entity Framework itself. So on larger projects you will probably end up having to clean up after the designer's mistakes.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T05:26:47.563

Entity Framework 使用 EDM 对数据进行建模；这是一组 3 个复杂的模式文件（存储、概念、映射），最常作为资源存储在项目中（通过使用单个 EDMX 文件生成所有 3 个模式文件的设计器）。

它不支持此信息的属性类。编写 EDM 的唯一明智方法是通过设计器（本质上是您不喜欢的建模工具）。

重新对“使用”多个基础表进行分类；是的，概念层的单个实体框架实体（即类）可以跨越多个存储表。这对于一些继承示例特别有用，但也可以（IIRC）被平面模型使用。您可以通过存储层和概念层之间的“映射”（最常见；在设计器的选项卡上）来执行此操作。

# eclipse-plugin - Eclipse RCP：编辑器加载后如何显示消息对话框？

> ID：629012
> 
> 赞同：2
> 
> 时间：2009-03-10T05:23:46.180
> 
> 标签：eclipse-plugin, eclipse-rcp

我在单击树节点时从视图中打开编辑器。现在，当编辑器加载和控件显示给用户时，我想根据编辑器上存在的某些值向用户显示一个警告消息对话框。

我尝试将警告对话框放在编辑器的 createPartControl 方法的末尾。根据所需功能双击树节点时出现对话框。但是，问题是当对话框出现时，编辑器上的控件还不可见。只有当我关闭对话框时才会显示编辑器控件。

我希望它反过来发生。即首先显示编辑器控件，然后出现警告对话框。我应该做些什么改变才能达到这个效果？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T07:33:30.550

您可能希望以异步方式调用该**[MessageDialog](http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/dialogs/MessageDialog.html)**，让编辑器有机会完成自身，[如此消息](http://dev.eclipse.org/newslists/news.eclipse.modeling.gmf/msg10448.html)中所建议的那样。

> 在可运行的 asyncExec() 中显示警告对话框将确保编辑器的初始化都以正确的顺序发生。

因此，类似（未测试）此代码可能会起作用：

```
getSite().getShell().getDisplay().asyncExec
    (new Runnable() {
        public void run() {
            MessageDialog.openWarning(getSite().getShell(),"wrong","no)
        }
    });
} 
```

此[MapEditor](http://www.koders.com/java/fid16CEACC7A2EAD4975C92DBB12EAF9AF43779C75C.aspx?s=MessageDialog+asyncExec#L84)类中的其他一些示例，其中 MessageDialog 通过等待结果的 asyncExec 显示：

[PlatformGIS.syncInDisplayThread](http://www.koders.com/java/fid44A42D796DDBCEDAD77C7F080FA650D92C14CFBC.aspx?s=syncInDisplayThread#L243)

# c++ - array[100] = {0} 如何将整个数组设置为 0？

> ID：629017
> 
> 赞同：142
> 
> 时间：2009-03-10T05:25:42.247
> 
> 标签：c++, c, compiler-construction

编译器如何填充值`char array[100] = {0};`？它背后的魔力是什么？

我想知道内部编译器是如何初始化的。

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-03-10T05:56:42.560

这不是魔术。

此代码在 C 中的行为在 C 规范的第 6.7.8.21 节（C 规范的[在线草案](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf)）中进行了描述：对于没有指定值的元素，编译器将指针初始化为 NULL 并将算术类型初始化为零（并递归地将其应用于聚合）。

此代码在 C++ 中的行为在 C++ 规范的第 8.5.1.7 节（C++ 规范[的在线草案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3797.pdf#subsection.8.5.1)）中进行了描述：编译器聚合初始化没有指定值的元素。

另外，请注意，在 C++（但不是 C）中，您可以使用空的初始化列表，导致编译器聚合初始化数组的所有元素：

```
char array[100] = {}; 
```

至于当你这样做时编译器可能会生成什么样的代码，看看这个问题：[Strange assembly from array 0-initialization](https://stackoverflow.com/questions/531477/strange-assembly-from-array-0-initialization/531490)

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-10T05:30:02.017

实现取决于编译器开发人员。

如果您的问题是“这样的声明会发生什么” - 编译器会将第一个数组元素设置为您提供的值（0），而所有其他元素将设置为零，因为它是省略数组元素的默认值。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-10T06:07:57.027

如果您的编译器是 GCC，您还可以使用以下语法：

```
int array[256] = {[0 ... 255] = 0}; 
```

请查看 [http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Designated-Inits.html#Designated-Inits](http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Designated-Inits.html#Designated-Inits)，并注意这是**编译器特定**的功能。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-03-10T10:05:45.067

这取决于你把这个初始化放在哪里。

如果数组是静态的，如

```
char array[100] = {0};

int main(void)
{
...
} 
```

然后是编译器在程序的数据段中保留 100 个 0 字节。在这种情况下，您可以省略初始化程序。

如果您的阵列是自动的，那么这是另一回事。

```
int foo(void)
{
char array[100] = {0};
...
} 
```

在这种情况下，每次调用 foo 函数时，您都会有一个隐藏的 memset。

上面的代码等价于

```
int foo(void)
{ 
char array[100];

memset(array, 0, sizeof(array));
....
} 
```

如果您省略初始化程序，您的数组将包含随机数据（堆栈的数据）。

如果您的本地数组被声明为静态的，如

```
int foo(void)
{ 
static char array[100] = {0};
...
} 
```

那么它在技术上与第一个相同。

# c++ - 将vc6移植到vc2005/vc2008的优势？

> ID：629018
> 
> 赞同：1
> 
> 时间：2009-03-10T05:26:34.177
> 
> 标签：c++, visual-studio-2008, visual-studio-2005, visual-c++-6, porting

我要求我的团队将我们的 vc6 应用程序移植到 vc2005，他们准备分配一些时间来做同样的事情。现在他们需要知道移植的优势是什么。

我不认为他们真正理解遵守标准意味着什么。

帮我列出做移植的优势。

我面临的问题是

1)标准容器不支持调试

2）不能使用boost库

3）我们使用了大量的查询生成，但使用了类型不安全的 CString 格式函数

4）很多时间都花在解决 vc6 问题上，比如有 >>

```
vector<vector<int>> 
```

>>之间没有空格

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T08:45:11.703

**好处：**

*   **更多符合标准的编译器。**这是一件好事，因为它将更容易移植到另一个平台（如果你想这样做的话）。这也意味着您可以在标准中而不是在微软的文档中查找内容。最后，您将不得不在该功能的某个时刻升级您的编译器。越早做，工作量就越少。

*   **MS 不支持。**新的 SDK 不起作用。64位不工作。而且我不认为他们还在修复错误。

*   **更好的IDE。**就个人而言，我真的更喜欢标签而不是 MDI。我还认为配置 Visual Studio（创建自定义快捷方式、菜单栏等）要容易得多。当然这是主观的。查看特快版，看看您是否同意。

*   **更好的插件支持。**有些插件不适用于 VC6。

**缺点：**

*   **到港所需的时间。**这在很大程度上取决于您拥有什么样的代码。如果您的代码大量使用不符合标准的 VC6 功能，则可能需要一些时间。正如安德鲁所说，如果您要维护一个旧的遗留项目，那可能不值得。

*   **性能更差。**如果您在非常旧的计算机上进行开发，Visual Studio 可能会太慢。

*   **成本**我只是快速浏览了一下，Visual Studio 许可证似乎比 VC6 的许可证贵一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T06:34:25.340

为什么选择VC2005？如果您打算花时间（和测试！）从 VC6 升级，为什么不瞄准 VC2008？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T05:46:29.403

如果您正在维护一个遗留项目，那么移植可能没有优势。简单地转换项目和修复编译器问题可能需要数周的时间并引入不稳定。

如果您正在积极开发产品，那么主要优势是您将不再使用超过八年的产品 - 这显然是一件好事。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T05:56:36.320

*   较新版本的 Windows SDK 不适用于 VC6 - 如果您想使用最新的 Windows 功能，则需要更新的编译器。
*   据说后来的编译器更符合标准。对不起，我不能更具体。我确实知道 VC6 生成大量编译器警告只是为了使用标准模板类。
*   如果您使用任何使用后来的编译器编译的外部库，则需要使用兼容的东西。

为艰难的过渡做好准备 - IDE 与它们应有的不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T05:35:44.077

确保应用程序与不同版本的基础平台完全兼容。并纠正由此发现的任何错误，以便为最终用户提供足够的自由来使用他自己的基础平台版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T09:25:14.197

我并不是说您不应该转换，而是要说明您的具体观点：

> 1)标准容器不支持调试

我一直使用带有 VC++ 6 的标准容器来调试代码。你这里有什么问题？

> 2）不能使用boost库

真的。你可能会发现你可以使用一些更简单的东西。

> 3）很多时间都花在解决 vc6 问题上，比如有 >>
> 
> [不能让 SO 停止破坏这个，nb]
> 
> >>之间没有空格

嗯，这是一个*语法错误*（至少在 VC++6 理解的 C++ 版本中）并且会被标记为这样。如果您的团队在这类事情上花费“大量时间”，那么您需要另一个团队。

**编辑：**

> 3）我们使用了大量的查询生成，但使用了类型不安全的 CString 格式函数

在 VS2005 下它同样是类型不安全的。我不明白为什么这是移植的原因。如果您想要类型安全，请使用标准 C++ I/O 机制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T05:51:32.073

如果您的团队看不到任何优势并且您无法解释任何优势，您为什么要求他们这样做？

听起来你只是为了它而移植。

# apache-flex - 如何生成表格（ ) 动态地在 flex 中？

> ID：629021
> 
> 赞同：0
> 
> 时间：2009-03-10T05:28:31.410
> 
> 标签：apache-flex

我需要从我从 httpservice 获取的 xml 文件中生成一个 mx:form。

我还需要预先填写从表单本身获得的数据。

有人可以给我一个示例代码吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T12:52:42.013

您显然必须对此进行扩展，但这就是我构建动态表单的方式..

```
 import mx.controls.TextInput;
        import mx.containers.FormItem;
        import mx.containers.Form;
        private var fxml:XML = 
        <form>
            <fields>
                <field type="text" label="name" default="gary"/>
                <field type="text" label="surname" default="benade"/>
            </fields>
        </form>

        private function init():void
        {
            var form:Form = new Form();
            form.setStyle("backgroundColor", 0xFFFFFF);
            for each( var xml:XML in fxml..field)
            { 
                switch( xml.@type.toString())
                {
                    case "text":
                        var fi:FormItem = new FormItem();
                        fi.label = xml.@label;
                        var ti:TextInput = new TextInput();
                        ti.text = xml.@default.toString();
                        fi.addChild( ti);                           
                        form.addChild( fi);
                    break;
                    case "int":
                    break;
                }
            }               
            this.addChild( form);
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-10T12:40:04.270

```
<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx"
               creationComplete="handleCreationComplete()">

    <fx:Declarations>
        <fx:XML id="formdata">
            <userinfoform>
                <user>
                    <firstname inputtype="TextInput" formlabel="First Name" required="true">true</firstname>
                    <lastname inputtype="TextInput" formlabel="Last Name" required="true">true</lastname>
                    <Middlename inputtype="TextInput" formlabel="Middle Name" required="false">true</Middlename>
                    <nickname inputtype="TextInput" formlabel="Nick Name" required="false">false</nickname>
                    <combobox inputtype="ComboBox" formlabel="Gender" required="true">Male,Female</combobox>
                    <type inputtype="ComboBox" formlabel="Type" required="false">Book,Cds,Games</type>
                    <radioButtonGroup inputtype="RadioButtonGroup" formlabel="Gender" required="false">
                    <radiobutton inputtype="RadioButton" formlabel="Gender" required="true">Male</radiobutton>
                    <radiobutton inputtype="RadioButton" formlabel="Gender" required="true">Female</radiobutton>
                    </radioButtonGroup>    

                </user>
            </userinfoform>
        </fx:XML>
    </fx:Declarations>
    `enter code here`<fx:Script>
        <![CDATA[
            import flashx.textLayout.events.SelectionEvent;

            import mx.collections.ArrayCollection;

            import mx.core.UIComponent;
            import mx.events.ItemClickEvent;
            import mx.events.ValidationResultEvent;
            import mx.rpc.events.FaultEvent;
            import mx.rpc.events.ResultEvent;
            import mx.validators.NumberValidator;
            import mx.validators.StringValidator;

            import spark.components.ComboBox;
            import spark.components.DropDownList;
            import spark.components.RadioButton;
            import spark.components.RadioButtonGroup;
            import spark.components.TextArea;
            import spark.components.Form;
            import spark.components.FormItem;
            import spark.components.TextInput;
            import spark.components.RadioButtonGroup;
            import spark.components.RadioButton;

            private function handleCreationComplete():void
            {
                //Below line can be used for XML from an external source
                //XMLService.send();

                buildForm(new XML(formdata));
            }

            private function errorHandler(evt:FaultEvent):void
            {
                //Alert.show("Error: " + evt.fault.message);
            }

            private function resultHandler(evt:ResultEvent):void
            {                
                buildForm(new XML(evt.result));
            }

            private function buildForm(xml:XML):void
            {
                var lst:XMLList = xml.children();

                for(var i:int = 0; i < lst.length(); i++)
                {
                    var x:XMLList = lst[i].children();

                    for(var j:int = 0; j < x.length(); j++)
                    {
                        if(x[j].@inputtype == 'TextInput')
                        {
                            var frmItem:FormItem = new FormItem();
                            //frmItem.direction = "horizontal";
                            frmItem.label = x[j].@formlabel;
                            // make sure boolean is pasrsed to a string before assigned
                            // to required property of the formitem
                            var validString : String = x[j].@required;
                            var valid : Boolean = (validString == "true");
                            frmItem.required = valid;

                            var tb:TextInput = new TextInput();
                            tb.text = x[j];
                            frmItem.addElement(tb);

                            userInfoForm.addElement(frmItem);
                        }
                        else if(x[j].@inputtype == 'ComboBox')
                        {

                            var frmItemCB:FormItem = new FormItem();
                            //frmItemCB.direction = "horizontal";
                            frmItemCB.label = x[j].@formlabel;
                            // make sure boolean is pasrsed to a string before assigned
                            // to required property of the formitem
                            var validString : String = x[j].@required;
                            var valid : Boolean = (validString == "true");
                            frmItemCB.required = valid;

                            // make sure the string is split, assigned to an array, and parsed
                            // to an arraycollection to assgn it as dataprovider for dropdownlist
                            var str:String = x[j];
                            var arr:Array = str.split(",");
                            var arrcol:ArrayCollection = new ArrayCollection();

                            for(var k:int = 0; k < arr.length; k++)
                            {
                                var obj:Object = {name:arr[k]}
                                arrcol.addItem(obj);
                            }

                            var cb:DropDownList = new DropDownList();
                            cb.dataProvider = arrcol;
                            cb.labelField = "name";
                            frmItemCB.addElement(cb);

                            userInfoForm.addElement(frmItemCB);
                        }
                        else if(x[j].@inputtype == 'RadioButtonGroup')
                        {

                            var frmItemRB:FormItem = new FormItem();
                            //frmItemRB.direction = "horizontal";
                            frmItemRB.label = x[j].@formlabel;
                            // make sure boolean is pasrsed to a string before assigned
                            // to required property of the formitem
                            var validString : String = x[j].@required;
                            var valid : Boolean = (validString == "true");
                            frmItemRB.required = valid;    

                            var frmItemRB1:FormItem = new FormItem();
                            frmItemRB1.addElement(label);

                            var y:XMLList = x[j].children();
                            var radioGroup = new RadioButtonGroup();
                            radioGroup.addEventListener(ItemClickEvent.ITEM_CLICK,
                                radioGroup_itemClick);
                            for(var l:int = 0; l < y.length(); l++)
                            {                                
                                var rb = new RadioButton();
                                rb.label = y[l];
                                rb.group = radioGroup;

                                frmItemRB.addElement(rb);                                    

                                userInfoForm.addElement(frmItemRB);
                            }
                        }                            
                    }
                }
            }
            public var label:TextInput = new TextInput();
            private function radioGroup_itemClick(evt:ItemClickEvent):void {

                label.text = evt.label ;
            }
            /**
             * Helper function that returns all the fields for a
             * given form. Pass in requiredOnly = true if you only want
             * the required fields.
             */
            private function getFields(form:Form, requiredOnly:Boolean=false):Array
            {
                var a:Array = [];
            return a;
            }

            /**
             * Validates all fields in a given form.
             */
            private function validateForm(form:Form):Boolean
            {
                // reset the flag
                var _isValid:Boolean = true;
                var _notValid:Boolean = false;

                // populate the fields - if your fields aren't dynamic put this in creationComplete
                var fields:Array = getFields(form, true);

                for each(var source:UIComponent in fields)
                {
                    // create a simple string validator
                    var stringValidator:StringValidator = new StringValidator();
                    stringValidator.minLength = 2;
                    stringValidator.source = source;
                    stringValidator.property = "text";
                    stringValidator.requiredFieldError = "This field is required!!!";

                    var numberValidator:NumberValidator = new NumberValidator();
                    numberValidator.minValue = 0;
                    numberValidator.source = source;
                    numberValidator.property = "text";
                    numberValidator.lowerThanMinError = "This field is required!!!";

                    var rbValidator:StringValidator = new StringValidator();
                    rbValidator.minLength = 1;
                    rbValidator.maxLength = 80;
                    rbValidator.source = source;
                    rbValidator.property = "selectedValue";
                    rbValidator.requiredFieldError = "This field is required!!!";

                    var result:ValidationResultEvent;
                    //var radiogroup:spark.components.RadioButtonGroup = new spark.components.RadioButtonGroup;
                    // typical validation, but check to this checks for any different
                    // types of UIComponent here
                    if (source is TextInput)
                        result = stringValidator.validate(TextInput(source).text)
                    else if (source is TextArea)
                        result = stringValidator.validate(TextArea(source).text)                        
                    else if (source is DropDownList)
                        result = numberValidator.validate(DropDownList(source).selectedIndex)
                    //else if (source is Label)
                        //result = stringValidator.validate(Label(source).text)
                    //if(source is spark.components.RadioButton)
                    //result = numberValidator.validate(mx.controls.RadioButton(source))

                    // if the source is valid, then mark the form as valid
                    _isValid = (result.type == ValidationResultEvent.VALID) && _isValid;                        
                }                    
                return _isValid;
            }

            protected function submitButton_clickHandler(event:MouseEvent):void
            {
                if(validateForm(userInfoForm) == true)
                {
                    //Alert.show("Proceed Genius!!!","Alert");
                }
                else
                {
                    //Alert.show("Open ur eyes and fill the form properly u morron!!!","Morron");
                }
            }

        ]]>
    </fx:Script>

    <fx:Declarations>
        <!--Below line can be used for XML from an external source-->
        <!--<mx:HTTPService fault="errorHandler(event)" id="XMLService" resultFormat="e4x" url="formdata.xml" result="resultHandler(event)" />-->
    </fx:Declarations>

    <s:VGroup  width="100%">
        <s:Form id="userInfoForm"  />
        <s:Button label="Submit" id="submitButton" click="submitButton_clickHandler(event)"/>    
    </s:VGroup>

</s:View> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T13:30:26.603

Check this out: [MXMLLoader](http://www.dreaminginflash.com/2008/04/24/the-mxmlloader-class-dynamic-load-mxml/comment-page-1/) for Flex 3\. HTH.

# asp.net - ASP.NET 自动部署到远程 ftp 服务器

> ID：629024
> 
> 赞同：2
> 
> 时间：2009-03-10T05:30:34.090
> 
> 标签：asp.net, asp.net-mvc, deployment, automated-deploy

有谁知道使用 SFTP 自动部署到远程服务器的任何好的解决方案？我特别想将一个 asp.net mvc 网站部署到 mosso。每次使用 SFTP 客户端时，我都可以手动执行此操作，但更愿意使用自动化（且一致）的方式来执行此操作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-02-12T05:41:04.873

我写了一篇非常详细的博客文章，使用 TeamCity 和 Web 部署项目来自动化构建和部署，作为初学者在这里：

[http://www.diaryofaninja.com/blog/2010/05/09/automated-site-deployments-with-teamcity-deployment-projects-amp-svn](http://www.diaryofaninja.com/blog/2010/05/09/automated-site-deployments-with-teamcity-deployment-projects-amp-svn)

然后我添加到此以显示 FTP 添加

[http://www.diaryofaninja.com/blog/2010/09/21/continuous-integration-tip-1-ndash-ftp-deployment](http://www.diaryofaninja.com/blog/2010/09/21/continuous-integration-tip-1-ndash-ftp-deployment)

一个基本的流程非常简单：

*   使用我从我的 SVN 存储库下载的 teamcity 构建服务器
*   我构建站点并将其部署到构建服务器上的本地文件夹
*   我启动了一个支持脚本的命令行 FTP 客户端，称为
*   WinSCP 使用 MSBUILD 任务执行 (http://winscp.net/)
*   上传我的所有网站内容
*   有[插入饮料]的选择

然后我确保我只部署我的 SVN 存储库的主干，并在合并之前开发和测试分支中的所有内容 - 这样只有经过测试的东西才会被部署。将自动化测试添加到您的构建周期中，您将获得天作之合。

一些很棒的免费工具是：

*   [Visual Studio Web 部署项目](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=89F2C4F5-5D3A-49B6-BCAD-F776C6EDFA63&amp%3Bdisplaylang=en)
*   [TeamCity（对 20 个以下的构建配置免费）](http://www.jetbrains.com/teamcity/)
*   [竹子](http://www.atlassian.com/software/bamboo/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T06:10:13.543

[.NET 解决方案下的部署工具](https://stackoverflow.com/questions/416573/deployment-tools-under-net-solutions) [自动部署资源](https://stackoverflow.com/questions/231283/automatic-deployment-resources)

# java - GWT 托管模式：连接到 127.0.0.1

> ID：629026
> 
> 赞同：0
> 
> 时间：2009-03-10T05:30:58.380
> 
> 标签：java, gwt

我最近在测试以托管模式运行的 GWT 应用程序时开始看到挂起。它挂起消息“连接到 127.0.0.1”

唯一的解决方案是停止并重新启动几次。有没有其他人看过这个？

如果是这样，关于原因的任何想法？我想知道它是否是防火墙块。我正在使用区域警报。如果您也看到此问题，请在此问题中添加评论，提及您使用的防火墙 - 也许会出现一种模式。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-11T16:42:05.510

你用的是 Mac 吗？

也许你受到这个问题的影响：

[http://code.google.com/p/googleappengine/issues/detail?id=4712](http://code.google.com/p/googleappengine/issues/detail?id=4712)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-11T16:47:24.193

以我的经验，这种事情通常是防火墙问题 - 关闭 zonealarm，然后确保 Windows 防火墙没有再次启动（并非闻所未闻！）如果这有效，那么只需添加一个规则以允许 GWT 充当服务器/通过 localhost 连接（在 java.exe 上添加规则应该可以工作。）如果不是，您能否确认您已尝试关闭防火墙？

# getter - 在类方法中使用 getter

> ID：629029
> 
> 赞同：19
> 
> 时间：2009-03-10T05:32:32.230
> 
> 标签：getter

如果您有一个具有一些普通 get/set 属性的类，是否有任何理由在类方法中使用 getter，或者您应该只使用私有成员变量？我认为关于setter（验证逻辑？）可能会有更多争论，但我想知道getter。

例如（在 Java 中）- 是否有任何理由使用选项 2？：

```
public class Something
{
    private int messageId;
    public int getMessageId() { return this.messageId; }
    public void setMessage(int messageId) { this.messageId = messageId; }

    public void doSomething()
    {
        // Option 1:
        doSomethingWithMessageId(messageId);

        // Option 2:
        doSomethingWithMessageId(getMessageId());
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T06:01:50.833

一般来说，Java 程序员在使用 getter 方法方面往往非常一致。我对多种语言进行编程，但对此并不一致；）

我会说，只要您*不*制作吸气剂，就可以使用原始变量 - 用于*私有*变量。当你制作一个吸气剂时，你应该只使用它。当我为私有字段创建 getter 时，我的 IDE 建议它在我引入 getter 时自动为我替换原始字段访问。切换到使用 getter 只需几次击键（并且没有任何引入错误的机会），所以我倾向于延迟它直到我需要它。

当然，如果你想要 getter-injection 之类的东西，某些类型的代理和子类化框架，如 hibernate，你必须使用 getter！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-10T05:35:44.780

使用 getter，您不会意外修改变量 :) 此外，如果您同时使用 getter 和“原始”变量，您的代码可能会混淆。

此外，如果您使用继承并在子类中重新定义 getter 方法，则使用 getter 的方法将正常工作，而使用原始变量的方法则不会。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T05:38:38.453

如果您在任何地方都使用 getter 方法 - 并且将来对 getMessageId() 的所有调用执行代码搜索，您会找到所有这些方法，而如果您使用了私有方法，您可能会错过一些。

此外，如果在 setter 方法中引入了逻辑，您不必担心为它更改超过 1 个位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T07:20:32.517

如果您分配给属性的值是已知的或经过验证的值，您可以安全地直接使用私有变量。（也许在某些特殊情况下，很明显为什么会不好。）您是否这样做更多的是品味或风格问题。这也不是性能问题，因为如果 getter 或 setter 足够简单，编译器将内联它。

如果类不知道该值，则应使用该属性对其进行设置，这样您就可以保护该属性免受非法值的影响。

这是一个示例（在 C# 中）：

```
public class Something {

   private string _value;

   public string Value {
      get {
         return _value;
      }
      set {
         if (value == null) throw new ArgumentNullException();
         _value = value;
      }
   }

   public Something() {
      // using a known value
      _value = "undefined";
   }

   public Something(string initValue) {
      // using an unknown value
      Value = initValue;
   }

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T07:23:37.080

如果您使用 getter，您将确保在对其应用任何逻辑/决策后获得该值。这可能不是您的典型情况，但如果是这样，您会为此感谢自己。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-19T18:46:33.140

除非我有一个特定的用例可以直接在封闭类中使用内部字段，否则我一直认为以与公开访问相同的方式访问该字段很重要。如果需要通过 getter 方法或属性向字段添加一些后处理，这可以确保全面的返回值的一致性。如果您出于某种原因想要原始值，我觉得访问原始字段非常好。

通常情况下，getter 封装是简单的样板代码——除了字段值本身，您很可能不会返回任何内容。但是，如果您可能希望在未来某个时间点更改数据的呈现方式，那么您必须在内部进行的重构就更少了。

# vb.net - VB.NET 中的合并运算符和条件运算符

> ID：629036
> 
> 赞同：21
> 
> 时间：2009-03-10T05:35:35.497
> 
> 标签：vb.net, conditional-operator, null-coalescing-operator

> **可能重复：**
> [VB.NET 中是否有条件三元运算符？](https://stackoverflow.com/questions/576431/is-there-a-conditional-ternary-operator-in-vb-net)

我们可以像在 C# 中一样在 VB.NET 中使用 Coalesce 运算符（??）和条件三元运算符（:) 吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-10T05:52:18.327

我认为您可以使用内联 if 语句来接近：

```
//C#
int x = a ? b : c;

'VB.Net
Dim x as Integer = If(a, b, c) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-03-06T10:19:18.140

```
Sub Main()
    Dim x, z As Object
    Dim y As Nullable(Of Integer)
    z = "1243"

    Dim c As Object = Coalesce(x, y, z)
End Sub

Private Function Coalesce(ByVal ParamArray x As Object())
    Return x.First(Function(y) Not IsNothing(y))
End Function 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-04T09:13:38.547

仅供参考，用于 String 的 Coalesce 运算符

```
Private Function Coalesce(ByVal ParamArray Parameters As String()) As String
    For Each Parameter As String In Parameters
        If Not Parameter Is Nothing Then
            Return Parameter
        End If
    Next
    Return Nothing
End Function 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2010-09-16T17:01:14.920

如果应该是 IIf

`Dim x as Integer=IIf(a,b,c)`

# ruby-on-rails - 如何将模块包含到类中以使模块覆盖类？

> ID：629047
> 
> 赞同：4
> 
> 时间：2009-03-10T05:43:36.710
> 
> 标签：ruby-on-rails, ruby

有没有办法将模块包含到类中，以便模块的方法覆盖类的方法？例如：

```
module UpcasedName
  def name
    @name.upcase
  end
end

class User
  attr_accessor :name
  include UpcasedName
end

u = User.new
u.name = 'john'
puts u.name # outputs 'john', not 'JOHN' 
```

在上面的示例中，u.name 是“john”，而不是“JOHN”。我知道如果我扩展用户对象而不是将模块包含到类中，这将起作用

```
module UpcasedName
  def name
    @name.upcase
  end
end

class User
  attr_accessor :name
end

u = User.new
u.name = 'john'
u.extend UpcasedName
puts u.name # outputs 'JOHN' 
```

但是，我想在类级别包含模块，而不是对象级别。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T06:48:49.767

现在有几种方法可以做到这一点。那么第一个也是最基本的将是使用来自 ActiveSupport 的 alias_method_chain

```
require 'activesupport'

module UpcasedName
  def self.included( base )
    base.alias_method_chain :name, :upcase
  end

  def name_with_upcase
    @name.upcase
  end
end

class User
  attr_accessor :name
  include UpcasedName
end

u = User.new
u.name = 'john'
puts u.name 
```

您发布的方法实际上与 Bruce Williams 的方法在这里发布的方法相似：http: [//www.codefluency.com/articles/2009/01/03/wrapping-a-method-in-ruby](http://www.codefluency.com/articles/2009/01/03/wrapping-a-method-in-ruby)

如果你真的对此很执着，你可以按照 Yehuda Katz 在这里发布的方法：http: [//yehudakatz.com/2009/01/18/other-ways-to-wrap-a-method/](http://yehudakatz.com/2009/01/18/other-ways-to-wrap-a-method/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T06:51:53.100

包含类似于从另一个类继承，因为您包含模块的类的方法优先于包含的方法。你甚至可以在你的类中调用 super 来访问模块中的方法：

```
class User
  attr_accessor :name
  def name
    super
  end
  include UpcasedName
end

u = User.new
u.name = 'john'
puts u.name # outputs 'JOHN' 
```

这是一篇关于它的文章：[在 Ruby 中包含与扩展](http://neeraj.name/blog/articles/585-include-vs-extend-in-ruby)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T07:58:33.273

根据 ucron 的回答，可以在没有 activesupport 的情况下执行此操作，如下所示：

```
module UpcasedName
  def self.included(base)
    base.send :alias_method, :name_without_feature, :name
    base.send :alias_method, :name, :name_with_upcase
  end

  def name_with_upcase
    @name.upcase
  end
end

class User
  attr_accessor :name
  include UpcasedName
end

u = User.new
u.name = 'john'
puts u.name 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T12:55:35.913

这里的问题是`attr_accessor`创建了一个覆盖 UpcasedName.name 方法的 User.name 方法，因此一种解决方案是使用`attr_writer`：

```
module UpcasedName
  def name
    @name.upcase
  end
end

class User
  attr_writer :name
  include UpcasedName
end

u = User.new
u.name = 'john'
puts u.name # outputs 'JOHN' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-09T18:33:03.683

它可能并不总是一种选择，但我认为最好将类的方法移动到它自己的模块中并将该模块混合回类中。这对我来说感觉更干净。

[http://gist.github.com/515856](http://gist.github.com/515856)

# git - Git Svn dcommit 错误 - 重新启动提交

> ID：629048
> 
> 赞同：22
> 
> 时间：2009-03-10T05:44:05.320
> 
> 标签：git, git-svn

上周，在周末离开城镇之前，我对当地的分支机构进行了一些更改。今天早上，我想将所有这些更改提交到公司的 Svn 存储库，但我在一个文件中遇到了合并冲突：

> 提交期间的合并冲突：您的文件或目录“build.properties.sample”可能已过期：版本资源与事务中的资源不对应。请求的版本资源已过期（需要更新），或者请求的版本资源比事务根更新（重新启动提交）。

我不确定我*为什么*会得到这个，但在尝试 dcommit 之前，我做了一个**git svn rebase**。那“覆盖”了我的提交。为了从中恢复，我做了一个**git reset --hard HEAD@{1}**。现在我的工作副本似乎在我期望的位置，但我不知道如何克服合并冲突；实际上我找不到任何需要解决的冲突。

任何想法将不胜感激。

**编辑：**只是想指定我在本地工作。我有一个引用 svn/trunk （远程分支）的主干本地分支。我所有的工作都是在本地主干上完成的：

```
$ git branch
  maint-1.0.x
  master
  * trunk
$ git branch -r
  svn/maintenance/my-project-1.0.0
  svn/trunk 
```

同样，**git log**当前在我的本地主干上显示了自上次使用 Svn ID 提交以来的 10 次提交。

希望这能回答几个问题。

再次感谢。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-10T06:00:20.460

你应该已经创建了一个本地分支，并完成了工作，然后当你回来时，你更新 master，rebase 到本地分支，合并回 master 然后 dcommit。

所以我会尝试复制更改，以备份它们。

从 has svn 同步点创建一个本地分支，在其中合并您的更改。然后撤出 master 分支中的更改，获取，rebase 到分支，从本地分支合并，修复任何冲突，然后 dcommit。

```
$ git checkout -b backup    # create a local backup branch with all your work
$ git checkout master   
$ git checkout -b backup2   # 2nd copy just to be safe
$ git checkout master
$ git reset --hard <this is the revision of the last svn-id> # clean up master to make the svn merge easier
$ git svn fetch    # this should update to the current version on the svn server
$ git rebase master backup  # may get a conflict here, fix and commit
... # after conflict is fixed and commited
$ git checkout master 
$ git merge backup --ff  # merge in your local commits
$ git svn dcommit        # push back to the svn 
```

[您可以在此处](http://utsl.gen.nz/talks/git-svn/intro.html)获取更多信息

您可能感兴趣的另一个[答案。](https://stackoverflow.com/questions/604399/how-do-you-push-only-some-of-your-local-git-commits/604504#604504)

## git-svn 工作流文章

[文章](http://andy.delcambre.com/2008/03/04/git-svn-workflow.html)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-10T13:30:51.347

非常感谢 VonC 和 sfassen 对我的非凡耐心，解决方案自己解决了。我不知道如何或为什么，但也许我最初的变基没有奏效。为了解决它，我最终再次变基。从我当地的主干分支：

```
$ git co -b backup  # backup the commits to my local trunk
$ git co trunk      # return to the local trunk
$ git svn rebase    # rebase the trunk from the Svn server
$ git br -d backup  # delete the backup branch 
```

当然，关键是这次变基起作用了。我不知道为什么当我第一次这样做时它不起作用，但我不能让时钟倒退，所以我不会纠缠于此。

再次感谢大家的建议和对新手的耐心。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-10T06:41:12.143

为了完成[sfossen](https://stackoverflow.com/users/64657/sfossen)的[出色回答](https://stackoverflow.com/questions/629048/git-svn-dcommit-error-restart-the-commit/629067#629067)，这里有一些细节：

使用`git-svn`，默认情况下您会获得一个名为 master 的本地分支。你不应该对它做任何工作，只用 svn 主干分支保持它是最新的：

*   **`git svn fetch`**从本地主干分支上的 svn 主干分支获取历史记录：它不会将这些修改应用于您的工作目录
*   **`git checkout master`** 打开主干分支（仅当您在另一个分支上时）
*   **`git rebase trunk`**使主干与主干同步。

但是，您的所有修改都应该在另一个本地分支上完成（让我们称之为`local-devel`）。

*   **`git branch local-devel`**
*   **`git checkout local-devel`**

如果您有紧急修复工作要做：

*   **`git checkout master`**: 在 master() 上切换，
*   **`git svn fetch`**&&**`git rebase trunk`**用 svn trunk 更新它
*   **`git branch fastfix && git checkout fastfix`**, 分支
*   修复错误，编译，测试，
*   **`git commit -a`**：本地提交，
*   **`git svn dcommit`**更新对远程 svn repo 的修改
*   **`git checkout master && git rebase trunk`**: 再次更新master
*   **`git branch -D fastfix`**：删除修补程序分支
*   **`git checkout local-devel && git rebase master`**: 回到 dev，在 master 上完成的更新历史在你的 dev 分支上重播

一开始有点麻烦，但比`svn diff`在稍后应用的文件中要舒服得多。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-06-12T18:56:49.930

我也有类似的情况。我正在做`git svn dcommit`一个糟糕的网络连接，它在某个时候失败了。我发现问题是由于 Subversion 存储库已经有一个新的提交，但本地 git-svn 对应方认为提交不在 SVN 中。此处其他答案的解决方案没有帮助，但是这样做：

```
git svn reset -r <last_svn_commit_git_was_aware_of>
git svn fetch
git svn rebase 
```

在此之后，我终于能够做到`git svn dcommit`没有任何错误。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T15:52:02.490

我打算发表评论，但认为这值得更多关注......

`git svn rebase`应该重写你的提交*。*从描述和评论中，我得到的印象是，在您重新设置基准后，您将旧的提交重新置于顶部。必须用不冲突的较新版本替换提交。

为了避免不得不深入研究 reflog，您可能希望养成在执行`git svn dcommit`. dcommit 成功后，删除标签。如果标记失败，您可以执行 a`git reset --hard`后跟 a `git merge <tag>`。重新运行您的 rebase 以恢复您的历史记录，重新标记并再次重新提交。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-07-07T21:10:00.950

我在几个地方读到，使用 git svn 使用单独的分支是不好的做法。与 git 提交有关的东西没有像您期望的那样显示在 svn 中。

[来自http://progit.org/book/ch8-1.html](http://progit.org/book/ch8-1.html)的以下答案似乎是最干净的方法：

```
git svn rebase
git svn dcommit 
```

我也尝试了上面最受欢迎的选项，但它并不总是对我有用，因为 git rebase 不会回滚以匹配上游的 svn，而只是回到最后一个 git commit。

# nhibernate - NHibernate 记录并连续执行两次查询

> ID：629050
> 
> 赞同：3
> 
> 时间：2009-03-10T05:46:14.397
> 
> 标签：nhibernate, fluent-nhibernate

我在 SQL Server Express 2008 上使用：NHibernate、NHibernate.Linq 和 Fluent NHibernate。我正在使用引用属性上的谓词选择一个实体（多一个映射）。我有 fetch=join、unique=true、lazy-load=false。我启用了 log4net 日志，当执行任何此类查询时，它会记录两个相同的 SQL 查询。运行查询返回一行，当我尝试使用 IQueryable.Single 扩展方法时，它会抛出异常，指出返回的行不止一行。我还尝试使用具有相同结果的标准 IQuery.UniqueResult 方法运行查询，它最终记录并实际运行两次查询，然后抛出一个异常，指出有多行，但是在管理工作室中运行实际查询仅返回一个结果。当我禁用日志记录时，我收到同样的错误。

实体和映射声明如下（隐含适当的访问修饰符和成员类型变化）

```
class User
{
    int ID;
    string UserName;
}

class Client
{
    int ID;
    User User;
    Person Person;
    Address Address;
}

class UserMap : ClassMap<User>
{
    public UserMap()
    {
       Id(x => x.ID);
       Map(x => x.UserName);
    }
}

class ClientMap : ClassMap<Client>
{
    public ClientMap()
    {
       Id(x => x.ID);
       References(x => x.User).Unique();
       ...
    }
} 
```

然后我调用如下查询：

```
ISession s = GetNHibernateSession();

...

var client = s.Linq<Client>().SingleOrDefault(x => x.User.ID = 17);

or

var client = s.Linq<Client>().Where(x => x.User.ID = 17);

or

var client = s.CreateQuery("from Client as c where c.User.ID = 17").UniqueResult<Client>(); 
```

在所有情况下都执行两个相同的查询。当我启用延迟加载时，客户端再次使用两个查询加载，但是在访问成员（例如 Person）时，只执行一个附加查询。

这可能是 Fluent 生成不正确映射的结果吗？或者 NHibernate 没有正确使用 SQL Server Express 版本？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-11T23:49:49.883

问题是由我声明的另一个映射引起的。我有一个从 Client 继承的类，它有一个关联的映射。这就是导致 NHibernate 查询两次的原因。我注意到这一点是因为在使用 Linq() 时它返回了子类，而不是 Client 本身。这个继承和映射的特殊实例是我的设计缺陷，是整个问题的根源！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T08:58:43.737

NHibernate 对 SQL Express 没有任何问题，我已经相当广泛地使用了它。同样，Fluent NHibernate 不太可能在这个简单的场景中生成无效的映射（但并非闻所未闻）。

在黑暗中开枪，但我相信 NHibernate 将名称 Id 保留为标识符名称，因此当它在查询中看到 Id 时，它知道只查看外键而不是实际连接的实体。也许您对 ID 而不是 Id 的命名是把它扔掉了？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T09:24:41.553

您可以尝试使用出色的[NHibernate](http://nhprof.com/)分析器来更详细地了解正在发生的事情。它带有 30 天的试用许可证，而在 Beta 版中，完整的许可证费用有折扣

# django-models - 从对象查询中返回一个很好的标点字符串

> ID：629053
> 
> 赞同：0
> 
> 时间：2009-03-10T05:51:55.740
> 
> 标签：django-models

在我的 django 应用程序中，尤其是在管理方面，我对我的模型做了一些定义：

```
def get_flora(self):
    return self.flora.all()

def targeted_flora(self):
    return u"%s" % (self.get_flora()) 
```

虽然flora 是ManyToManyField，但有时也会使用ForeignKey 字段。

我这样做是为了为模型提供一个实用的“获取”功能，然后第二个定义是为 django admin 提供一个更友好的字段名称来填充表格/列表视图。

这里可能有一个两部分的问题：1\. 这是一个很好的工作流程/方法来做这些事情，以及 2\. admin 中的结果字符串输出看起来像：

```
[<Species: pittosporum>, <Species: pinus radiata>] 
```

自然而然，但是如何使它看起来像：

```
pittosporum & pinus radiata 
```

或者，如果有三个；

```
pittosporum, pinus radiata & erharta ercta 
```

超级感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T06:09:58.927

听起来你想要这样的东西：

```
def targeted_flora(self):
  names= [f.name for f in self.get_flora()] # or however you get a floras name
  if len(names) == 1:
    return names[0]
  else:
    return ', '.join(names[:-1]) + ' & ' + names[-1] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T03:37:51.763

顺便说一句，这有效：

```
def punctuated_object_list(objects, field):
    if field:
        field_list = [getattr(f, field) for f in objects]
    else:
        field_list = [str(f) for f in objects]

    if len(field_list) > 0:
        if len(field_list) == 1:
            return field_list[0]
        else:
            return ', '.join(field_list[:-1]) + ' & ' + field_list[-1]
    else:
        return u'' 
```

# ios - iPhone：团队代理以外的开发人员能否构建应用程序以进行分发

> ID：629057
> 
> 赞同：55
> 
> 时间：2009-03-10T05:53:48.887
> 
> 标签：ios, iphone

我有一个公司的 iphone 开发帐户。

根据文档，仅允许团队代理提交分发证书并下载分发配置文件。

1.  一个团队只能有 1 个团队代理吗？

此外，如果是这种情况，有没有办法让多个开发人员选择构建应用程序的分布式版本？

我有另一位开发人员想构建应用程序并将其提交到 iTunes。我试着给他分发证书和分发配置文件。当他将它们拖放到xcode中并检查windows->organize时，它会抱怨

“在您的钥匙串中找不到与此配置文件匹配的身份分配”

所以这让我相信我需要在他的机器上获取我的钥匙链凭据。我尝试导出私钥并将其提供给他，但他无法安装它。

还有什么我可以做的吗？

老实说，如果苹果希望一个开发人员负责为一家公司构建所有应用程序，那我真的很傻。希望我错了，并且有一种方法可以让多个开发人员访问构建应用程序的发行版。

谢谢

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2010-09-07T11:19:28.047

注意：这个过程在 XCode 4 中得到了极大的简化（尽管我没有亲自测试过），通过 Organizer 窗口（Developer Profile 部分）导入和导出开发人员配置文件。

这就是我让它工作的方式。

1) 以代理身份登录 iOS Provisioning Portal。

2) 执行分发证书签名请求/配置文件的制作过程：http: [//developer.apple.com/iphone/manage/distribution/index.action](http://developer.apple.com/iphone/manage/distribution/index.action)。这些说明非常长，但非常清晰和必要。

3）特别注意该页面上的“获取您的iOS分发证书”>“保存您的私钥并转移到其他系统”部分。它描述了如何生成和保存代理的 .p12 文件。

4) 现在在会员中心邀请其他开发者加入团队：[https ://developer.apple.com/membercenter/index.action#invitations](https://developer.apple.com/membercenter/index.action#invitations)

5) 返回 iOS 配置门户，下载应用程序的分发证书（证书 > 分发（选项卡））。应命名为“distribution_identity.cer”

6) 现在下载 Distribution Provisioning Profile (Provisioning > Distribution (tab))。应该命名为“whatever_you_named_it.mobileprovision”

7) 将这两个文件与代理的 .p12 文件一起通过电子邮件发送到您的另一台开发人员机器。

8）在开发者的机器上，双击distribution_identity.cer文件，它应该会加载到Keychain Access中

9) 将 .p12 文件拖到 Keychain 中，它应该会自动将身份放在证书下

10) 将whatever_you_named_it.mobileprovision 文件拖到XCode 中。

11) 在每个 Project 和 Build 的 Info 窗口中，将 Code Signing Identity 设置为现在应该可用的“iPhone Distribution - Your Company”标识。

希望有帮助。抢

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-09-19T15:29:15.563

只是另一个一步一步的教程，但略有不同，证书已经安装在团队的代理钥匙串中，所以它解释了如何从钥匙串中导出 .p12 文件：

[如何共享一个 ios 分发证书](http://www.ironpaper.com/webintel/articles/how-to-share-an-ios-distribution-certificate/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T06:03:47.503

您绝对应该能够在您同事的机器上使用分发证书和配置文件构建您的应用程序。

您确定分发证书和配置文件安装正确吗？如果您可以使用开发证书而不是部署证书构建应用程序，请检查以确保所有内容都正确安装在钥匙串中，并且在活动目标的设置中选择了正确的配置文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T06:08:59.193

你可以用这种方式复制私钥，但这真的很不安全：

**给他你的 login.keychain 文件（位于 ~/Library/Keychains/），让他用 Keychain.app 打开它，并让他把你的私钥拖到他的 login.keychain 中。**

苹果还说你应该保护好你的私钥，如果你需要重新安装系统，请确保备份 login.keychain 文件。

# disk - 独特的 DVD 信息？

> ID：629061
> 
> 赞同：2
> 
> 时间：2009-03-10T05:56:25.900
> 
> 标签：disk, dvd, identification

我想知道，是否有某种类型的光盘 ID 可以用来在我的数据库中搜索以查看该光盘是否已被扫描？所有光盘都是由我创建的，通常在 Windows 上刻录。

-edit- 我可以比较写入时间和卷标以查看光盘是否已被扫描，但我注意到如果我放入某些商业光盘，字段为空白或错误​​导致许多误报（我曾经将时间设置为未来，我不知道人们是否想在我的应用程序中将商业光盘上的文件内容存档）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T06:52:04.177

请查看 [http://wiki.dvdlookup.org/index.php?title=Disc_Identification](http://wiki.dvdlookup.org/index.php?title=Disc_Identification)

# replication - 订阅者数据库到发布者数据库

> ID：629076
> 
> 赞同：0
> 
> 时间：2009-03-10T06:05:23.600
> 
> 标签：replication, publish-subscribe

如果事务复制数据库的发布者端由于某种原因与其备份一起出现故障，我将如何以最小的影响和时间让订阅者数据库再次成为发布者。

据我目前了解，订阅者数据库加载了复制所需的触发器和视图

TIA戈帕尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T06:40:09.523

简短的回答是：你不能轻易做到。

您需要专家帮助（尤其是因为您没有备份），而不仅仅是您可能在此处收到的（尽管很好）答案。

# c# - 在 C# 中使用指针进行调试

> ID：629079
> 
> 赞同：3
> 
> 时间：2009-03-10T06:06:16.407
> 
> 标签：c#, pointers

当我用 C/C++ 编程时，我经常在跟踪中包含指针值。这有助于关联跟踪消息之间的对象。在 C# 中，我没有可以跟踪的可用指针值。可追溯的对象 ID 有什么好的替代品吗？

我不知道如何获取底层内存地址，但即使我这样做也无济于事，因为 GC 可以移动对象。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T07:07:05.450

提示：在 Visual Studio 中，您可以在 locals/watch 窗口中右键单击对象，然后选择“Make Object ID”为对象赋予唯一标记。

[http://blogs.msdn.com/saraford/archive/2008/09/16/did-you-know-how-to-create-an-object-id-to-keep-track-of-your-objects- 314.aspx](http://blogs.msdn.com/saraford/archive/2008/09/16/did-you-know-how-to-create-an-object-id-to-keep-track-of-your-objects-314.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T06:14:20.803

使用 Object.GetHashCode()。可以从所有对象访问 GetHashCode() 方法，因为 C# 中的每个类都派生自 Object。但是只有在调用 Object.GetHashCode() 并且它的结果以某种方式用于为用户定义的类生成哈希码时，它才保证是唯一的。请注意，这并不是绝对保证您最终可能会为多个对象获得相同的哈希码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T06:27:45.403

添加一个在每次构造函数调用时递增的类变量。将此类变量作为您自己的索引分配给该类。

```
class foo
{
  private static int counter;
  private int instance_counter;

  public Foo()
  {
    instance_counter = counter;
    counter++;
  }

  public string toString()
  {
    return "Foo "+instance_counter.toString();
  }
} 
```

可能无法开箱即用，我这里没有编译器。

# c++ - 带有 GUID 的未解析外部符号 _CLSID_ScenicIntentUIFramework

> ID：629085
> 
> 赞同：2
> 
> 时间：2009-03-10T06:09:01.110
> 
> 标签：c++, windows, windows-7, sdk, ribbon

我正在尝试在 Visual Studio 中构建功能区应用程序，但出现链接器错误。查看标题后，我注意到 CLSID_ScenicIntentFramework 被定义为 extern const CLSID。我的想法是，我似乎无法弄清楚我需要链接到哪个库（或我需要导入的其他标头？）。

我也非常感谢一些帮助。

后记：我注意到除了风景意图.h，还有一个风景意图.idl，但是如果我将它包含到我的项目中，我会遇到很多错误。有没有合适的方法来包含 idl 文件，这能解决我的问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T08:15:46.143

通常，您需要链接到一个导入库（.lib 文件），其中包含您正在使用的库的类 ID 和接口 ID 的定义。或者，您可以使用`__uuidof`可以获取属性对象（类或接口）的关联 GUID 的关键字。

```
__uuidof(ScenicIntentFramework) // this should be the same thing 
```

# c# - 关于类的GetType的C#问题

> ID：629087
> 
> 赞同：3
> 
> 时间：2009-03-10T06:09:38.287
> 
> 标签：c#

我有一个程序集 asdf.dll，它有一个类“Class1”。

如何获得 Class1 的类型？

```
string a = "Class1"; //Class1 is the name of class in asdf.dll
string typeString = typeof(Class1).FullName; // here I only have the string Class1 and not Class Class1
AssemblyName assemblyName = AssemblyName.GetAssemblyName("asdf.dll");
Type type = Type.GetType(typeString + ", " + assemblyName); 
```

如何从包含类名的字符串中获取类的类型？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T06:42:50.453

```
Type t = Type.GetType("MyDll.MyClass,Mydll") 
```

其中 MyDll.MyClass 是您想要的班级/表格的班级位置。Mydll 是您的 dll 名称。你想打电话给哪个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T06:16:50.233

`typeof(Class1).FullName`已经是完全限定名称。

尝试只传递它，或者改用 Type.Name 属性。

# sql-server-2005 - 提高 sql server 查询响应时间

> ID：629096
> 
> 赞同：3
> 
> 时间：2009-03-10T06:14:57.820
> 
> 标签：sql-server-2005, performance

我有一个表，其中包含大约 400 000 条记录，并且在内联网网站的主页上被调用。在高峰期，我们可以有 300-400 个并发用户。SQL Profiler 工具提供以下输出。

*   中央处理器：406
*   读取：32446
*   持续时间：397

我已经索引了“where”子句中涉及的字段。有没有办法再提高响应时间？

需要做些什么来减少磁盘读取？

服务器配置：Windows 2003 64 位、SQL Server 2005 64 位 SP2、.NET 2.0。

在下面添加了查询和表定义。为了简单起见，我没有在这里添加大约 40 个字段。where 子句中不使用那些主要是 varchar 的字段。他们只是在那里显示在页面上。有一些字段 (5-6) 当前未使用，但我将它们留在查询中，因为稍后将需要它们。那我现在应该把它们取下来吗？这会改善响应时间吗？

**询问**

```
SELECT 
    u.[PeopleKey], 
    u.[EnterpriseId],   
    u.[PersonnelNbr],   
    u.LastName,   
    u.FirstName,   
    u.MiddleName,    
    cc.WorkForceCd AS CareerCounselorWorkForceCd,                     
    cc.WorkForceDesc AS CareerCounselorWorkForceDesc,                    
    cc.WorkGroupCd AS CareerCounselorWorkGroupCd,                   
    cc.WorkGroupDesc AS CareerCounselorWorkGroupDesc,                 
    cc.CareerLevelCd As CareerCounselorCareerLevelCd,               
    cc.CareerLevelDesc AS CareerCounselorCareerLevel,             
    CL.NextLevelCD as  nextCareerLevelCd
FROM 
    [User] u 
    LEFT JOIN [User] cc ON 
        u.[CareerCounselorPeopleKey] = cc.PersonnelNbr  
    Left JOIN [CareerLevel] CLON 
        u.WorkForceCd= CL.WorkForceCd AND 
        u.CareerLevelCd = CL.LevelCd
WHERE 
    u.PeopleKey = <integer> 
```

**[职业水平]**

```
ID  int 4 [Primary Key - clustered index]
Description varchar 150
WorkforceCd varchar 4
LevelCD varchar     10
NextLevelCD varchar 10 
```

**[用户]**

```
PeopleKey   int 4 [Primary Key - clustered index]
EnterpriseId    varchar 50 [non clustered index]
PersonnelNbr    varchar 8 [non clustered index]
FirstName   varchar 40
LastName    varchar 40
MiddleName  varchar 40
CareerCounselorPeopleKey    int 4
CareerCounselorPersonnelNbr varchar 8
CareerCounselorName varchar 50
CapabilityCd    varchar 5
CapabilityDesc  varchar 25
WorkforceCd varchar 4
WorkForceDesc   varchar 40
WorkGroupCd varchar 4
WorkGroupDesc   varchar 50
CareerLevelCd   varchar 10
CareerLevelDesc varchar 50 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T06:30:12.013

您可以发布表架构和索引定义吗？你的查询是什么样的？

读取量会暗示大量 I/O 操作 - 因此可能是由于您的表和索引设置和/或您的查询方式，即使您有索引，它们也没有被使用。

您是否定期对数据库运行维护计划？例如，当索引碎片太高时，您的索引是否会重新组织和/或重建？

您总是可以使用 SQL 的 Database Tuning Advisor 来尝试并获取有关如何优化某些查询的提示 - 或者更好的是，使用 SQL Trace 收集一些实际使用数据并分析这些数据以进行潜在的调整步骤。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T06:21:53.890

你的数据库有多大，你在那个盒子上有多少内存？

您提到了“where”子句中涉及的字段的索引……您的索引列的设置顺序是否与您的 where 子句列的顺序相同？

如果您在 sql management studio 中运行查询执行计划，您是否会看到任何表扫描（您想要查找）。如果您看到扫描，则可能缺少索引。

你的主键/聚集索引是什么？您可以切换查找以使用聚集索引吗？这始终是您获取数据的最快途径。

希望有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T08:03:31.803

查看[SQL Server 性能仪表板](http://www.microsoft.com/downloads/details.aspx?FamilyId=1d3a4a0d-7e0c-4730-8204-e419218c1efc&displaylang=en)。如果你有明显的问题，他们会出现在那里。

此外，您不应该只添加索引而不分析查询执行计划（并查看它在寻找什么）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-03T13:31:53.370

加入 Left On - 所有这些列： ON u.[CareerCounselorPeopleKey] = cc.PersonnelNbr Left JOIN [CareerLevel] CL ON u。**WorkForceCd** = CL。**WorkForceCd** 和你。**CareerLevelCd** = CL。**水平镉**

就像您的 WHERE 子句一样，ON 子句用于明显的关键关系！

所以胖标记的列也必须被索引......

# iphone - MPMoviePlayerController retainCount 从 1 到 3 到 2。然后挂起我的应用程序

> ID：629100
> 
> 赞同：2
> 
> 时间：2009-03-10T06:19:27.547
> 
> 标签：iphone, ios-simulator, mpmovieplayercontroller

在模拟器中，我使用此处描述的方法加载我的电影： [https ://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#VIDEO-INITIATE_VIDEO_PLAYBACK_IN_MY_CODE](https://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#VIDEO-INITIATE_VIDEO_PLAYBACK_IN_MY_CODE)

我正在做一个 NSLog 以在播放调用之前/之后以及通知中的发布调用之前/之后显示 retainCount。计数：1 [播放前] 3 [播放后] 3 [发布前] 2 [发布后]

到那时，模拟器就挂了。

我做错了什么，还是每次您想播放与模拟器不兼容的电影时使用不同的 URL 的方法？

# permissions - 更新通过 JungleDisk 上传的 Amazon S3 文件的权限

> ID：629102
> 
> 赞同：5
> 
> 时间：2009-03-10T06:20:58.227
> 
> 标签：permissions, amazon-s3, jungledisk

我开始使用 Jungle Disk 将文件上传到对应于 Cloudfront 分发的 Amazon S3 存储桶。即我可以通过 http:// URL 访问它，并且我使用 Amazon 作为 CDN。

我面临的问题是 Jungle Disk 没有对文件设置“读取”权限，所以当我在浏览器中访问相应的 URL 时，我会收到一个亚马逊`'AccessDenied'`错误。如果我使用 BucketExplorer 之类的工具来设置 ACL，那么该 URL 现在会返回 200。

我真的很喜欢将文件拖到网络驱动器的简单性。JungleDisk 是我发现的最好的程序，可以可靠地执行此操作而不会绊倒自己并感到困惑。但是，它似乎没有使文件可读的选项。

我真的不想使用不同的工具（特别是如果我必须购买它）来更改权限 - 无论如何这似乎真的很慢，因为它们通常似乎遍历整个目录结构。

JungleDisk 提供了某种“网络访问”——但这是一项付费功能，我不确定它是否有效。

S3 似乎没有向下传播权限，这确实很痛苦。

我正在考虑编写一个手动工具来遍历我的树并将所有内容设置为“读取”，但如果这是其他人已经解决的问题，我宁愿不这样做。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T20:28:27.590

*免责声明：*我是这个工具的开发者，但我认为它可能会回答你的问题。

如果您在 Windows 上，您可以使用[CloudBerry Explorer](http://cloudberrylab.com/) Amazon S3 客户端。它支持大多数 Amazon S3 和 CloudFront 功能，并且是免费软件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T06:41:12.080

我使用[Transmit](http://www.panic.com/transmit) Mac 应用程序来修改已使用 JungleDisk 上传的文件的权限。如果您正在寻找更跨平台的解决方案，Firefox 的[S3Fox](http://www.s3fox.net)浏览器插件声称也能够修改 S3 文件的权限。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-13T08:12:32.007

如果您需要基于 Web 的工具，可以使用[S3fm](http://s3.amazonaws.com/s3fm/index.html)，免费的在线 Amazon S3 文件管理器。

它是一个在您的浏览器中运行的纯 Ajax 应用程序，不需要与第三方网站共享您的凭据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-12T10:40:47.767

如果你需要一个可靠的跨平台工具来处理权限，你可以看看[CrossFTP Pro](http://www.crossftp.com/)。它还支持大多数 Amazon S3 和 CloudFront 功能。

# .net - 在 Datagridview 中启用和禁用单元格

> ID：629107
> 
> 赞同：24
> 
> 时间：2009-03-10T06:25:50.383
> 
> 标签：.net, datagridview

我正在使用 DataGridView 控件来显示一些数据。我需要根据网格中的一些值动态启用一些数据并禁用一些数据。

谁能告诉我该怎么做？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2011-03-13T18:41:50.200

要“禁用”一个单元格，它必须是只读的并且以某种方式变灰。此函数启用/禁用 DataGridViewCell：

```
 /// <summary>
    /// Toggles the "enabled" status of a cell in a DataGridView. There is no native
    /// support for disabling a cell, hence the need for this method. The disabled state
    /// means that the cell is read-only and grayed out.
    /// </summary>
    /// <param name="dc">Cell to enable/disable</param>
    /// <param name="enabled">Whether the cell is enabled or disabled</param>
    private void enableCell(DataGridViewCell dc, bool enabled) {
        //toggle read-only state
        dc.ReadOnly = !enabled;
        if (enabled)
        {
            //restore cell style to the default value
            dc.Style.BackColor = dc.OwningColumn.DefaultCellStyle.BackColor;
            dc.Style.ForeColor = dc.OwningColumn.DefaultCellStyle.ForeColor;
        }
        else { 
            //gray out the cell
            dc.Style.BackColor = Color.LightGray;
            dc.Style.ForeColor = Color.DarkGray;
        }
    } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-10T07:14:23.217

您可以将特定行或单元格设置为只读，因此用户无法更改该值。你是这个意思吗？

```
dataGridView1.Rows[0].ReadOnly = true;
dataGridView1.Rows[1].Cells[2].ReadOnly = true; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-05-24T13:45:52.790

## Step 1:

```
type form load : -
For i = 0 to Datagridview.columns.count -1
   if i <> 1 then //restricted columns, 'i' is Your column index
    Datagridview.Columns(i).ReadOnly = True
   end if
Next 
```

## Step 2

```
type Cellbeginedit
Datagridview.BeginEdit(True) 
```

# .net - 你如何组织你的资源文件？

> ID：629108
> 
> 赞同：8
> 
> 时间：2009-03-10T06:27:39.257
> 
> 标签：.net, asp.net, localization

我们希望在 ASP.NET 应用程序中使用资源文件 (.resx) 来存储本地化值。我们要存储的站点中可能总共有数千个字符串。

是否有将值组织到一个或多个资源文件中的最佳实践？您是否将所有值保存在一个文件中？您是否根据主题分为多个资源文件？也许网站的公共值有一个公共资源文件，即“Ok”、“Continue”等？

似乎将所有资源存储在一个文件中将难以维护。

有什么建议么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T06:37:20.170

是的，在中等大小或更大的应用程序中，单个文件似乎是一个糟糕的选择:-)

我们基本上使用这种方法：

*   每个网络表单都有自己的本地资源，用于按钮、标签等
*   有许多按主题组织的全球资源——例如“是”、“否”等内容的“一般”资源；一个用于在整个地方不断弹出的错误消息，依此类推——一些基于使用区域的全球资源
*   任何其他代码（更多的业务代码而不是背后的 ASPX/ASCX 代码）都有自己的资源文件

但是，在拥有大量文件与拥有太多条目的文件之间始终是一种平衡行为：-)

马克

# svn - 事后有没有办法将svn历史导入git？

> ID：629111
> 
> 赞同：7
> 
> 时间：2009-03-10T06:28:57.820
> 
> 标签：svn, git, github, git-svn

我已经签出了一个 svn 只读存储库（svn co 而不是 git svn）。我使用 git 进行了一些更改和提交，然后将其推送到 github。

此时，git 并没有来自 svn 的所有历史记录。我想知道此时是否有办法提取和导入它。

各种 git-svn 指南展示了如何导入一个干净的 repo 并传输历史，但不是我能找到的已经在使用的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T08:05:22.127

为了完成[Thilo](https://stackoverflow.com/users/14955/thilo)的[好答案](https://stackoverflow.com/questions/629111/is-there-a-way-to-import-svn-history-into-git-after-the-fact/629187#629187)，一旦您将 svn 存储库导入到 git 中，您可以使用脚本将该 git 存储库添加到您的存储库中，如**[合并不相关的 git 分支中所述](http://wingolog.org/archives/2008/10/14/merging-in-unrelated-git-branches)**

```
#!/bin/bash

set -e

if test -z "$2" -o -n "$3"; then
    echo "usage: $0 REPO BRANCHNAME" >&2
    exit 1
fi

repo=$1
branch=$2

git fetch "$repo" "$branch"

head=$(git rev-parse HEAD)
fetched=$(git rev-parse FETCH_HEAD)
headref=$(git rev-parse --symbolic-full-name HEAD)

git checkout $fetched .

tree=$(git write-tree)

newhead=$(echo "merged in branch '$branch' from $repo" | git commit-tree $tree -p $head -p $fetched)
git-update-ref $headref $newhead $head
git reset --hard $headref 
```

其他方法包括：

*   尝试“简单”**`git pull REPO BRANCH`**
*   **[使用 git 嫁接通过在 .git/info/grafts 创建一个文本文件来恢复 svn 合并历史记录](http://community.livejournal.com/evan_tech/255341.html)**，其中每一行包含一个提交 ID，后跟其父级。此后，您的本地存储库将就好像该提交实际上是父母双方的后代一样。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T07:15:48.190

[您可能必须将 svn 导入到一个新的git](http://git-scm.com/docs/git-rebase)存储库中，合并两个存储库（只需将它们添加在一起，它可能会抱怨它们不相关），然后重新调整您对导入历史所做的更改。

# apache2 - 使用 Apache2 在同一服务器端口上托管多个域

> ID：629114
> 
> 赞同：2
> 
> 时间：2009-03-10T06:31:39.293
> 
> 标签：apache2, multiple-domains, hostheaders

如何通过 webmin 或命令行（我正在使用 RHEL5 Linux）配置 Apache2，以便我可以在同一端口上的同一服务器上拥有多个域，但在不同的子目录中？

例如，尝试在同一台服务器的端口 80（默认端口）上检测 homerentals.ws 和 homerepair.ws。我知道我的 DNS 保存了这两个地址，并且网络点击当前进入了同一个测试页面。现在我需要的只是让网络点击进入一个子目录，但不显示这个子目录。例如，我*不*希望人们去[http://homerentals.ws](http://homerentals.ws)并被重定向回[http://homerentals.ws/homerentals/](http://homerentals.ws/homerentals/)。相反，[http://homerentals.ws](http://homerentals.ws)将转到 /var/www/html/homerentals，而[http://homerepair.ws](http://homerepair.ws)将转到 var/www/html/homerepair，但在 URL 中看起来没有任何不同。

在 IIS 上，我用主机头检测做过一次。但我不知道如何通过 webmin 或文件编辑在 RHEL5 Linux 上执行此操作。我被困住了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T07:27:29.037

您描述的功能称为虚拟主机。查看[Apache 的文档](http://httpd.apache.org/docs/2.4/vhosts/examples.html)。一般来说，你需要编辑 /etc/apache2/httpd.conf 文件才能使事情发生（也许可以通过 webmin 编辑，但我不熟悉它）。

# cookies - 在 CGI 应用程序的 cookie 中处理 UTF-8 字符的规则？

> ID：629115
> 
> 赞同：2
> 
> 时间：2009-03-10T06:31:40.433
> 
> 标签：cookies, utf-8

我被告知在放置 cookie 之前始终对 UTF-8 字符串进行 URL 编码。因此，当 CGI 应用程序读取此 cookie 时，它​​必须对字符串进行 URL 解码以获取原始 UTF-8 字符串。

这是在 cookie 中处理 UTF-8 字符的正确方法吗？

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T16:30:29.480

没有一种标准方案可以将 Unicode 字符封装到 cookie 中。

对 UTF-8 表示进行 URL 编码无疑是一种常见且明智的做法，尤其是因为它可以很容易地从 JavaScript 读取为 Unicode 字符串（使用 decodeURIComponent）。但是，如果您愿意，没有理由不能选择其他方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T07:15:15.930

通常，这是最简单的方法，您可以进行另一种二进制编码，不确定 base64 是否包含保留字符... %uXXXX 其中 XXXX 是十六进制 unicode 值最合适。

# c# - 将图像上传到服务器中的文件夹时拒绝访问路径

> ID：629118
> 
> 赞同：1
> 
> 时间：2009-03-10T06:32:57.140
> 
> 标签：c#

当您要在服务器中的指定文件夹上上传文件时出现错误。在这里，我将在 storeimg 文件夹中上传 P6100083.jpg。当我要上传时，我收到以下错误：

访问路径`'C:\inetpub\vhosts\bookmygroups.com\httpdocs\storeimg\P6100083.jpg' is denied.`

任何人都可以帮助我...如何使用权限和使用...

我的代码在上传图片时

```
if (FileUpload1.HasFile)
{           
    float fileSize = FileUpload1.PostedFile.ContentLength;
    float floatConverttoKB = fileSize / 1024;
    float floatConverttoMB = floatConverttoKB / 1024;
    string DirName = "storeimg";
    string savepath = Server.MapPath(DirName + "/");
    DirectoryInfo dir = new DirectoryInfo(savepath);
    // string savepath = "C:\\Documents and Settings\\ssis3\\My Documents\\Visual Studio 2005\\WebSites\\finalbookgroups\\" + DirName + "\\";

    if (fileSize < 4194304)
    {
        string filename = Server.HtmlEncode(FileUpload1.FileName);
        string extension = System.IO.Path.GetExtension(filename).ToUpper();

        if (extension.Equals(".jpg") || extension.Equals(".JPG") || extension.Equals(".JPEG") || extension.Equals(".GIF"))
        {            
            savepath += filename;                       
            FileUpload1.SaveAs(savepath);
        }
    }
} 
```

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-22T15:24:25.020

我没有成功让我的上传或对文件系统的任何写入操作在 IIS7 上工作。

仍然收到错误：访问路径被拒绝。

我的 AppPool 在网络服务下运行。我已经授予各种帐户完全控制权（网络服务、网络、IIS_IUSR、管理员、用户、每个人），多次重新启动网络服务，研究了所有 IIS7 设置，谷歌搜索了两个小时，但没有任何效果。

IIS7 和 WS2008 很烂。对不起这个词。有人可以帮忙吗？

我只是想补充一下：我注意到在上传的目标文件夹的属性中有一个名为“只读（仅适用于文件夹中的文件）”的复选框，并且它已被选中。它不能取消选中，取消选中并单击确定按钮后返回选中。是 IIS7 保护它吗？

编辑此消息以添加解决方案：我的管理员已关闭我们服务器上愚蠢的 UAC“安全确认功能”，重新启动机器，它现在可以工作了。不需要“网络服务”或任何其他 IIS 使用的帐户的“写入”访问权限。当使用集成身份验证访问 ASP.NET Web 应用程序中的文件系统并在其 web.confing 中将模拟设置为 true 时，文件系统似乎由经过身份验证的最终用户的帐户访问，而不是由网络服务帐户访问AppPool 在其下运行。（很多人告诉您设置网络服务权限，但事实并非如此。）因此，您需要为您的特定文件夹上的最终用户（通常是域用户：“域\域用户”）设置“写入”权限。

哦，是的，上面提到的“只读（仅适用于文件夹中的文件）”复选框似乎没有任何效果。然而微软表示“某些程序可能在写入此类文件夹时出现问题，您应该使用命令行语句“attrib -r -s”来摆脱只读属性”——但它不起作用。它将留在那里检查为灰色。但不要担心。微软每天都变得越来越傻。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T08:02:46.080

死了，这是一个服务器问题。

您需要验证您的应用程序池底层用户是否具有对该目录的写入权限。

如果您使用 IIS7，您将拥有一项新功能，可帮助您向该用户提供自定义写入，而无需更改用户。

看这个链接： http: [//www.adopenstatic.com/cs/blogs/ken/archive/2008/01/29/15759.aspx](http://www.adopenstatic.com/cs/blogs/ken/archive/2008/01/29/15759.aspx)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T06:36:48.143

这是服务器问题。确保您拥有写入文件的必要权限。

顺便说一句，由于您要求`ToUpper()`扩展，因此没有理由测试`".jpg"`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-10T09:19:37.733

首先检查权限是否启用，如果没有，然后转到该文件夹​​，该文件夹必须用于包含文件，然后右键单击文件夹，然后将显示文件夹属性，然后单击安全性，将显示多个用户用户必须是允许的，然后单击允许，所有权限都将被激活。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-22T23:21:04.250

如果您使用的是 Plesk Panel，请转至 Plesk Panel 的文件管理器。列出“httpdocs”中的文件和文件夹。每个文件和文件夹的最右侧都有一个锁定图标。单击“storeimg”文件夹更改权限。单击高级按钮。授予这些权限：

*   Plesk IIS WP 用户 (IWPD_214(your_login_name))
*   Plesk IIS WP 用户 (IWPD_214(your_login_name))

然后单击确定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-10T09:35:03.337

首先，确保您的代码在本地运行良好（我假设您已经完成了一些事情）。

然后部署到您的 TEST 或 UAT 环境。如果您在那里遇到问题，那么这是一个配置问题。确保运行您网站的应用程序池的服务帐户有权访问该文件夹。

请使用 C# 方法`Path.Combine()`来构建您的路径并避免前导或尾随 / 和 \ 的问题。

# regex - 这个 Squid 正则表达式过滤规则是如何工作的？

> ID：629122
> 
> 赞同：0
> 
> 时间：2009-03-10T06:34:16.293
> 
> 标签：regex, filter, squid

在我们的 Squid 服务器上，管理员设置了一个新的正则表达式规则：

```
^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+ 
```

我知道它代表 IP 地址，但它允许所有 URL 通过，只有 ping 外部地址已停止。UltraSurf 等隧道软件也已停止连接到服务器。Skype 也无法连接。

请解释这是如何工作的！谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T06:36:56.503

我不确定您对 Squid 服务器的特定问题，但这是正则表达式的作用：

`[0-9]+`表示“任何数字一次或多次”，因此它匹配一个以数字开头一次或多次，后跟一个点，后跟一个数字一次或多次，然后是一个点，然后是一个数字的字符串或多次，然后是点，然后是数字一次或多次......然后是其他任何东西。本质上，它匹配任何 IP 地址，因此它不会过滤掉任何东西。它还将匹配甚至不是有效 IP 地址的东西，例如`123456.123456.123456.123456`or`1.1.1.1`或`125.252.252.252asdf`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T07:04:48.373

Paolo 已经很好地解释了 Regex 的含义！如前所述，当前使用的正则表达式太弱（或者我应该说太严格了！）

如果您想要一个更好的正则表达式来匹配 IP 地址，请参阅[此页面](http://regexlib.com/Search.aspx?k=ip+address&c=-1&m=5&ps=20)。

# asp.net - 我的 VB.NET 网站挂了很长时间，然后什么也没有显示

> ID：629140
> 
> 赞同：0
> 
> 时间：2009-03-10T06:43:20.110
> 
> 标签：asp.net, vb.net

好的，这是我最近在进行的一个项目中遇到的一个奇怪问题。

有时，我的网站会停止运行，每当访问 ASP 页面时，浏览器都会挂起几分钟，然后才会显示一个格式正确且标签中没有任何内容的 HTML 页面。每当不止一个人试图访问一个 ASP 页面时，似乎就会发生这种情况，但我并不肯定它与这些条件无关。

让我强调一下，访问目录/HTML 页面/其他文件时不会出现此问题。只有 ASP 页是问题所在。我正在使用 lunarpages 作为主机。

我的问题是：有没有人有过此类问题的经验，如果有，有什么方法可以缓解它？

提前致谢 - 如果我能提供更多相关信息，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T07:09:42.480

听起来这可能是您的 Web 服务器的问题。您是否安装了正确版本的 .Net？您的 Web 服务器是否设置为托管 Asp.Net？

# c++ - 为什么相同数据类型的位域与混合数据类型的位域相比具有较小的大小

> ID：629141
> 
> 赞同：6
> 
> 时间：2009-03-10T06:44:08.873
> 
> 标签：c++, c, bit-fields

我很想知道为什么具有相同数据类型的位字段比混合数据类型占用更少的大小。

```
struct xyz 
{ 
  int x : 1; 
  int y : 1; 
  int z : 1; 
}; 

struct abc 
{ 
  char x : 1; 
  int y : 1; 
  bool z : 1; 
}; 
```

sizeof(xyz) = 4 sizeof(abc) = 12。

我正在使用 VS 2005，64 位 x86 机器。

一点机器/编译器级别的答案会很棒。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T06:51:42.833

结盟。

您的编译器将以对您的架构有意义的方式对齐变量。在您的情况下，`char`,`int`和`bool`是不同的大小，因此它将通过该信息而不是您的位字段提示。

在[这个问题](https://stackoverflow.com/questions/119123/why-does-the-sizeof-operator-return-a-size-larger-for-a-structure-than-the-tota)上就此事进行了一些讨论。

解决方案是向编译器发出`#pragma`指令或`__attributes__`指示它忽略对齐优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T07:04:00.323

C 标准（1999 版，§6.7.2.1，第 102 页，第 10 点）这样说：

> 实现可以分配任何大到足以容纳位字段的可寻址存储单元。如果有足够的空间剩余，紧跟在结构中另一个位域之后的位域将被打包到同一单元的相邻位中。

似乎没有任何措辞允许包装受字段类型的影响。因此，我会得出结论，这是一个编译器错误。

gcc 在任何一种情况下都会在 Linux 下的 32 位和 64 位机器上生成一个 4 字节的结构。我没有VS，无法测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-25T20:10:55.497

这是编译器错误或某些代码错误。结构中分配的所有位总是试图定义 sizeof 最高的数据类型。例如，在 struct xyz sizeof 最高数据类型是 4 即 int。对于第二个结构 abc 以类似的方式，对于 int，最高数据类型大小为 4。

好像我们改变结构变量如下： struct abc { char a:1; 字符 b:1; 布尔 c:1; };

sizeof(abc) 将是 1 而不是 4。由于大小最高数据类型为 1，并且所有位都适合 1 字节的 char。

可以通过更改结构中的数据类型来执行各种测试。

基于旧结构的输出链接：访问[http://codepad.org/6j5z2CEX](http://codepad.org/6j5z2CEX)

基于我定义的上述结构的输出链接：访问[http://codepad.org/fqF9Ob8W](http://codepad.org/fqF9Ob8W)

为了避免 sizeof 结构的此类问题，我们将使用 #pragma pack 宏正确打包结构。

# c# - 如何写入主 exe 的 .config userSettings 部分？

> ID：629143
> 
> 赞同：6
> 
> 时间：2009-03-10T06:46:22.880
> 
> 标签：c#, .net, configuration, settings, config

.NET 2.0 中是否有任何支持的 API 用于**写入****主 exe 的 .config 文件**的**userSettings**部分？

 **场景是：

Winforms 2.0 应用程序。

我有一个具有用户级别范围的设置（数据库连接字符串，如果您需要知道的话）。这意味着当用户保存设置的值时，每个用户都有一个由 .net 创建的*用户.config 文件。*

对于首次运行应用程序的新用户，应用程序的主 exe 的 .config 文件在用户设置部分包含默认值。此部分由 Visual Studio 在项目属性的“设置”选项卡中创建设置时创建。

现在，我想允许计算机中的任何管理员用户能够更改新用户的默认值。只有管​​理员才有此选项，因为普通用户无论如何都没有写入主 exe 的 .config 文件的权限。

我找到了如何将用户设置写入用户的 .config 文件，以及如何写入主 .config 文件的 appSettings 部分。但是当我试图找出如何写入主 .config 的 userSettings 部分时，我的谷歌搜索失败了

我唯一的机会是失败回到 System.Xml 并在 XmlDocument 中手动加载 .config 吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T20:37:06.343

经过一番研究，我想出了这个解决方案。它有点低级，但仍然通过 .NET 配置 API 而无需手动解析 .config 文件。

```
static void SaveUserSettingDefault(string clientSectionName, string settingName, object settingValue)
{
    System.Configuration.Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);

    // find section group
    ConfigurationSectionGroup group = config.SectionGroups[@"userSettings"];
    if (group == null) return;

    // find client section
    ClientSettingsSection clientSection = group.Sections[clientSectionName] as ClientSettingsSection;
    if (clientSection == null) return;

    // find setting element
    SettingElement settingElement = null;
    foreach (SettingElement s in clientSection.Settings)
    {
        if (s.Name == settingName)
        {
            settingElement = s;
            break;
        }
    }
    if (settingElement == null) return;

    // remove the current value
    clientSection.Settings.Remove(settingElement);

    // change the value
    settingElement.Value.ValueXml.InnerText = settingValue.ToString();

    // add the setting
    clientSection.Settings.Add(settingElement);

    // save changes
    config.Save(ConfigurationSaveMode.Full);
} 
```

给定具有以下内容的 .config：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="MyAssembly.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" requirePermission="false" />
        </sectionGroup>
    </configSections>
    <userSettings>
        <MyAssembly.Properties.Settings>
            <setting name="SqlConnectionString" serializeAs="String">
                <value>Server=(local);Database=myDatabase;Integrated Security=true;</value>
            </setting>
        </MyAssembly.Properties.Settings>
    </userSettings>
</configuration> 
```

你会像这样使用它：

```
if (RunningAsAdmin) // save value in main exe's config file
{
    SaveUserSettingDefault(@"MyAssembly.Properties.Settings", @"SQLConnectionString", theNewConnectionString);
}
else // save setting in user's config file
{
    Settings.Default. SQLConnectionString = theNewConnectionString;
    Settings.Default.Save();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T09:53:47.420

我认为是的 - 手动写入 .config 文件是唯一的方法。或者您可以让管理员自己编辑 .config 文件。

# wordpress - 是否有完全独立安装的 WordPress 博客的多博客管理界面？

> ID：629147
> 
> 赞同：3
> 
> 时间：2009-03-10T06:49:48.720
> 
> 标签：wordpress, blogs

我是 10-20 个独立 WordPress 博客的管理员，单独登录所有这些博客对我来说是一个很大的痛苦。是否有某种界面允许我对所有这些进行单点登录管理，就像在[WordPress MU](http://en.wikipedia.org/wiki/WordPress#Multi-blogging)保护伞下一样？

如果是这样，它叫什么？我什至不知道我会用什么词来搜索这个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T07:21:32.030

我还没有尝试过，但[Virtual Multiblog](http://striderweb.com/nerdaphernalia/features/virtual-multiblog/)可能会解决您的问题。

或者，尝试搜索词：

> wordpress + 多博客

谷歌往往会根据您的原籍国来改变结果，所以我不确定我找到的是你会找到的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-13T04:10:42.387

我听说过很多关于[http://managewp.com/的好消息](http://managewp.com/)

但是，我相信 WordPress 会在下一个版本中实现某种多博客支持系统，因此您可能希望等到它下降后再为 ManageWP 之类的服务支付一些现金。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T13:33:31.590

If it's just managing posts & pages and a few other items, a blogging client might be the way to go. WordPress provides a good starter list of programs - [http://codex.wordpress.org/Weblog_Client](http://codex.wordpress.org/Weblog_Client)

# java - sendRedirect 或 request Dispatch 更高效？

> ID：629152
> 
> 赞同：3
> 
> 时间：2009-03-10T06:53:16.373
> 
> 标签：java, jsp, servlets

SendRedirect 还是 requestdispatch ？哪个应该更优先？哪个更高效？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T07:02:10.780

他们做两件非常不同的事情，所以你不能只决定效率。

发送重定向会将浏览器发送到不同的 URL。该 URL 将对浏览器可见。你可能想要也可能不想要。例如，在 POST 之后，您可能应该重定向到 GET 页面，以避免在不重新发布的情况下无法重新加载结果页面。另一方面，您不能重定向到只能从 servlet 容器内部访问的“页面”。

分派更“有效”，因为没有额外的往返，但它只适用于相同的 Web 应用程序上下文（或者如果你这样设置，最多在同一个 servlet 容器中）。此外，用户最初用于访问页面的 URL 将与链中稍后调用的 servlet 不同，这可能会造成混淆。分派模式通常用于在实际请求之前或之后进行额外处理（代替 ServletFilter），或用于错误页面。

您可以使用调度传递请求属性，但只能在重定向上查询参数。您不能重定向为 POST（因此您可以附加到它的数据量是有限的）。重定向中的所有查询参数对用户都是可见的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-06-20T10:16:05.333

使用转发是有效的，因为它比发送重定向更快，如果我们需要将控制转移到不同的域，应该使用重定向。

当我们调用转发请求时，请求被发送到服务器上的另一个资源，而客户端不会被告知另一个资源将处理该请求。这个过程完全发生在 Web 容器中。另一方面，当调用 sendRedirect 方法时，它会导致 Web 容器返回到浏览器，指示应该请求新的 URL。因为浏览器发出一个全新的请求，所以在重定向发生之前存储为请求属性的任何对象都将丢失。这种额外的往返使重定向比转发慢。

# javascript - 使用 jQuery 让这些数据在 Javascript 事件处理程序中持久存在的最佳方法是什么

> ID：629158
> 
> 赞同：0
> 
> 时间：2009-03-10T06:56:55.053
> 
> 标签：javascript, jquery

我的代码旨在用动态按钮替换单选按钮，并允许单击标签和新的动态单选元素来切换隐藏状态与 CSS 单选框。

我需要发送`questions.checkAnswer()`三个参数，这些参数是在这些启动循环中定义的。但是，一旦循环完成迭代，我总是会得到最后一个值。过去，我创建了虚拟元素和其他感觉不合适的东西来存储“临时”贵重物品以充当 Javascript 的信息挂钩。

这是我到目前为止所拥有的

```
init: function() {
        // set up handlers

       moduleIndex = $('input[name=module]').val();

       $('#questions-form ul').each(function() {

            questionIndex = $('fieldset').index($(this).parents('fieldset'));

            $('li', this).each(function() {

                answerIndex = $('li', $(this).parent()).index(this);

                prettyRadio = $('<span class="pretty-radio">' + (answerIndex + 1) + '</span>');

                radio = $('input[type=radio]', this);

                radio.after(prettyRadio);

                $(radio).bind('change', function() {
                    $('.pretty-radio', $(this).parent().parent()).removeClass('selected');

                    $(this).next('.pretty-radio').addClass('selected');

                    questions.checkAnswer(moduleIndex, questionIndex, answerIndex);

                });

                prettyRadio.bind('click', function() {

                    $('.pretty-radio', $(this).parent().parent()).removeClass('selected');

                    $(this).addClass('selected').prev('input').attr({checked: true});

                });

                $('label', this).bind('click', function() { 

                    $(radio).trigger('change');
                    questions.checkAnswer(moduleIndex, questionIndex, answerIndex);

                    $(this).prev('input').attr({checked: true});

                });

            });

       }); 
```

*   用 Javascript 添加一个假装属性是不是很糟糕，例如，`<li module="1" question="0" answer="6">`
*   我是否应该将信息存储在 rel 属性中并将其与连字符连接起来，并在需要时将其分解？
*   你是如何解决这个问题的？
*   我愿意接受任何使我的 Javascript 代码更好的想法。

谢谢大家的时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T08:45:56.727

添加自定义属性并不是世界末日。事实上，在许多情况下，这是最不坏的方法。但是，如果我必须这样做，我会在属性前面加上“data-”，以便它符合[HTML5 规范的自定义属性](http://ejohn.org/blog/html-5-data-attributes/)以实现前向兼容性。这样，当您想要获得 HTML5 兼容时，您就不必担心升级。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T07:07:16.900

你需要说'var questionIndex'等，否则你的'变量'是窗口的属性并具有全局范围......

关于自定义属性，我过去肯定做过，如果可以的话，我会尽量避免它。如果您使用文本区域和输入标签等交互式元素执行此操作，某些 CMS 和主题系统有时会感到不满意，并且可能会将它们删除。

最后 $(a,b) 与 $(b).find(a) 相同。有些人更喜欢第二种形式，因为它在你所做的事情上更明确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T09:42:27.260

如果自定义属性的分配完全是客户端的，则必须使用 jQuery 数据解决此问题，如下所示：

$("#yourLiID").data({ module:1, question:0, answer:6 });

有关完整文档，请参见[此处](http://docs.jquery.com/Core/data)

# windows - Perl 脚本如何知道它自己的内存占用？

> ID：629161
> 
> 赞同：8
> 
> 时间：2009-03-10T06:58:24.097
> 
> 标签：windows, linux, perl, macos, memory

我有一个长时间运行的 Perl 脚本，我想让它知道（并报告）它正在使用多少内存。我想在 Linux 和 Windows 上都有这些信息，如果可能的话，在 Mac OS X 上也有。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T07:13:57.290

这些 Perl 模块可以帮助您：

*   Windows：[Win32::进程::内存](http://search.cpan.org/dist/Win32-Process-Memory/)
*   Linux（可能还有 Mac OSX）：[Linux::Smaps](http://search.cpan.org/dist/Linux-Smaps/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T07:15:23.213

这将向您展示如何：

[http://perldoc.perl.org/Devel/Peek.html](http://perldoc.perl.org/Devel/Peek.html)

此外，[http ://perldoc.perl.org/perlguts.html](http://perldoc.perl.org/perlguts.html)

以及 perldebug 和 perldebguts 的手册页。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-02-19T23:43:50.047

这是一种快速而肮脏的方法，最重要的是无 CPAN。它适用于任何提供 /proc 文件系统的操作系统，即 Linux 和 Unix 衍生产品，包括 Mac OS X，以及 Windows 下的 Cygwin：

```
perl -e 'print qx{ grep VmSize /proc/$$/status };' 
```

# .net - 如何绑定没有强类型属性的自定义类

> ID：629166
> 
> 赞同：2
> 
> 时间：2009-03-10T07:06:37.557
> 
> 标签：.net, asp.net, vb.net, data-binding

**大家好，这是我的要求：**

我需要一个只有一个公共属性而没有公共方法的简单类（最终的类会更复杂，但为了测试这就是我所需要的）

该属性是“ **Item** ”，并采用“ **String** ”作为参数。它根据参数返回一个“**字符串”。**

然后我希望能够将此对象的实例添加到**List**或**Array**，然后将其绑定到**Repeater**或**ListView** ...

...最重要的是，我希望能够通过 Eval 函数引用我的简单类中的值：

**<%# Eval("**SomeIDString** ") %>**.

**这是我的问题：**

1.  **除非我将Item**属性声明为**Default**属性，否则我根本无法绑定……为什么？

2.  当我使用“ **Eval** ”时，在“[某些属性] 不存在”行中出现错误。确实没有，因为所有内容都是通过**Item**属性访问的。如果我将“ **Eval** ”替换为“ **Container.DataItem** ”，它就会起作用。

那么，有没有办法使用**Eval**而不是**Container.DataItem**？我宁愿不让我的类继承任何其他类，因为我想让它远离多余的属性和/或方法。

我需要实现哪些接口？

另外，我想使用**Eval**的原因是，我想尽可能简单地使用这个 Class，所以编码器不需要担心特殊情况。我只是希望它能够工作，就像**DataTable**类一样，但实现更简单、更轻量级。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T08:12:09.007

关于这个安迪的教程太多了！你找过/搜索过它们吗？

您所说的是您只想创建一个对象（类）并将其用作数据控件的数据源，如果您不想在代码中执行操作，则始终可以使用 ObjectDataSource。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T10:01:53.347

您的问题源于使用参数化属性（也就是使用字符串参数的属性）。参数化属性通常只有在它们是默认属性并公开某个对象的索引集合时才有意义。（参见[C# 索引器](http://msdn.microsoft.com/en-us/library/6x16t2tx(VS.80).aspx)） C# 只允许对索引器进行参数化，而 VB 对此限制更为宽松。

假设一个类如下：

```
Public Class TempClass
  Private strItem As New StringDictionary()

  Public Property Item(ByVal s As String) As String
    Get
      Return strItem(s)
    End Get
    Set(ByVal value As String)
      strItem(s) = value
    End Set
  End Property
End Class 
```

Eval 函数需要有效公共属性的名称。当您使用参数化属性时，签名不同于您可以在 Eval 函数中指定的签名。如果您使用以下语法：

```
<asp:Label ID="lbl1" runat="server" Text='<%#Eval("Item(""a"")")%>' /> 
```

......它没有解决。

您的解决方案是三重的：

一种。评估为什么需要将此属性参数化。如果它传递了一个可以从集合中查找的键，这对我来说是有意义的。

湾。不要使用 Eval 关键字，而是使用扩展语法并手动执行转换：

```
<asp:Label ID="lbl1" runat="server" Text='<%#CType(Container.DataItem, MyCustomClass).Item("a") %>' /> 
```

C。还要考虑如何将不同的密钥传递给中继器中的每条记录。如果接受整数索引，这可能是理想的，以便我们可以将其链接到转发器的行号。将上面的类修改如下：

```
Public Class TempClass
  Private strItems(3) As String

  Public Sub New()
    strItems(0) = "x"
    strItems(1) = "y"
    strItems(2) = "z"
  End Sub

  Public Property Items(ByVal i As Integer) As String
Get
      Return strItems(i)
End Get
Set(ByVal value As String)
      strItems(i) = value
End Set
  End Property
End Class 
```

然后我们可以在数组中渲染适当的项目，如下所示：

```
<asp:Label ID="lbl1" runat="server" Text='<%#CType(Container.DataItem, TempClass).Items(Container.ItemIndex) %>' /> 
```

**根据要求编辑：**

* * *

d) 类修改为使用默认属性：

```
Default Public Property Item(ByVal s As String) As String
  Get
    Return strItem(s)
  End Get
  Set(ByVal value As String)
    strItem(s) = value
  End Set
End Property 
```

数据绑定现在变为：

```
<span><%#Eval("(a)")%></span>
<asp:Label ID="lbl2" runat="server" Text='<%#Eval("(b)")%>' /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T07:46:12.343

除非您使用对象数据源，否则您不能在类上使用 Eval。

```
"Databinding methods such as Eval(), XPath(), and Bind() can only be used in the context of a databound control." 
```

# captcha - 在文章的 50% 之后实施验证码

> ID：629170
> 
> 赞同：2
> 
> 时间：2009-03-10T07:07:46.463
> 
> 标签：captcha

我们计划将大量商业研究报告和文章从我们的内部网放到互联网上。但是，我们不希望其他人复制内容并自行托管。

我读到了 CAPTCHA 的保护，想知道这是否可能。读者应该能够免费阅读 50% 的文章，然后输入验证码以阅读文章的其余部分 [这样我们让那些模仿者的生活变得不那么艰难]

关于如何实现这一点的任何指示？内容是 HTML 和 Perl、PHP 的编程经验。如果需要，可以雇用其他人。

此外，搜索引擎会抓取文章的一半，并想知道它是否会因为无法破解验证码而无法抓取文章的其余部分而惩罚该网站？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T08:07:11.547

Recaptcha 提供了一个非常好的验证码服务 - [http://recaptcha.net/](http://recaptcha.net/)

有一个 PHP 类可用于完成所有艰苦的工作。

重要的是要记住，搜索引擎无法解决验证码，因此它们只会索引报告的前半部分。只要这半部分主要包含正确的关键词，就不会造成大问题。不要犯“检测”搜索引擎并向普通用户显示不同内容的错误，因为主要搜索引擎认为这是垃圾邮件。

另一种解决方案是使用像 Copyscape ( [http://www.copyscape.com/](http://www.copyscape.com/) ) 这样的服务来保护您的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:07:15.950

我知道这不是您要问的，但请考虑到 CAPTCHA 普遍存在问题，并且不会保护您的内容。你说前半段是免费的，那你是不是打算收下半段？CAPTCHA 在这里根本帮不上你的忙……

但即使你只是想阻止自动抓取，CAPTCHA 仍然无法解决问题。看看[我对另一个验证码问题的回答](https://stackoverflow.com/questions/8472/practical-non-image-based-captcha-approaches/80365#80365)……或者你可以直接看我去年在[OWASP上](http://www.owasp.org/)[展示的 ppt 。](http://www.owasp.org/images/6/66/2008-09-14_OWASP_Israel_2008.ppt)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T16:53:30.500

如前所述， [reCAPTCHA](http://recaptcha.net/)是一个很好的方法。

看看CPAN 上的[Captcha::reCAPTCHA](http://search.cpan.org/dist/Captcha-reCAPTCHA/)，根据CPAN[评级](http://search.cpan.org)[评论](http://cpanratings.perl.org)“ [开箱即用”](http://cpanratings.perl.org/dist/Captcha-reCAPTCHA)

如果您想要验证码，那么在 CPAN 上有[很多模块可以执行此](http://search.cpan.org/search?query=CAPTCHA&mode=all)操作；-)

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T07:32:08.963

> 读者应该能够免费阅读 50% 的文章，之后应输入验证码以阅读文章的其余部分

让您的 PHP 程序员输出 50% 的文章。在底部，添加验证码。如果用户输入了正确的验证码，则输出 100% 的文章。

> 关于如何实现这一点的任何指示？内容是 HTML 和 Perl、PHP 的编程经验。如果需要，可以雇用其他人。

作为一名 PHP 程序员，我使用[http://www.phpcaptcha.org](http://www.phpcaptcha.org)来实现验证码。

> 此外，搜索引擎会抓取文章的一半，并想知道它是否会因为无法破解验证码而无法抓取文章的其余部分而惩罚该网站？

不，它不会惩罚您，但该特定部分不会显示在搜索结果中。

# multithreading - 如何在VC++中使用线程和队列

> ID：629172
> 
> 赞同：3
> 
> 时间：2009-03-10T07:09:12.200
> 
> 标签：multithreading, visual-c++

我想使用两个队列，其中第一个队列将数据推送到队列，第二个线程将从队列中删除数据。有人可以帮我在 VC++ 中实现这个吗？

我是线程和队列的新手。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T07:30:08.843

这是生产者/消费者问题，这是C++ 中的一种[实现](http://www.linuxtopia.org/online_books/programming_books/c++_practical_programming/c++_practical_programming_284.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T07:36:47.203

这是一些指针和一些示例代码：

```
std::queue<int> data; // the queue
boost::mutex access; // a mutex for synchronising access to the queue
boost::condition cond; // a condition variable for communicating the queue state

bool empty()
{
  return data.empty();
}

void thread1() // the consumer thread
{
  while (true)
  {
    boost::mutex::scoped_lock lock(access);
    cond.wait(lock, empty);
    while (!empty())
    {
      int datum=data.top();
      data.pop();

      // do something with the data
    }
  }
}

void thread2() // the producer thread
{
  while (true)
  {
    boost::mutex::scoped_lock lock(access);
    data.push_back(1); // guaranteed random by a fair dice roll
    cond.notify_one();        
  }
}

int main()
{
  boost::thread t1(thread1);
  boost::thread t2(thread2);
  t1.join();
  t2.join();

  return 0;
} 
```

我使用了来自[STL的](http://www.sgi.com/tech/stl/)[队列](http://www.sgi.com/tech/stl/queue.html)和来自[Boost](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)库的[线程](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)、[条件变量](http://www.boost.org/doc/libs/1_38_0/doc/html/thread/synchronization.html#thread.synchronization.condvar_ref)和[互斥锁。](http://www.boost.org/doc/libs/1_38_0/doc/html/thread/synchronization.html#thread.synchronization.mutex_types)boost 中的内容与[几年后标准 C++ 库中的内容差不多，](http://en.wikipedia.org/wiki/C%2B%2B0x)[因此熟悉它是件好事](http://en.wikipedia.org/wiki/C%2B%2B0x#Threading_facilities)。

我只输入了代码，我没有办法测试它。你可能会发现错误。这是一件好事，线程代码很难，最好的方法是大量练习。

# c# - 从列表转换 到数组 T[]

> ID：629178
> 
> 赞同：78
> 
> 时间：2009-03-10T07:13:48.257
> 
> 标签：c#, .net, arrays, linq, list

有没有一种将强类型转换为`List<T>`相同类型的数组的捷径，例如：`List<MyClass>`到`MyClass[]`？

简而言之，我的意思是一个方法调用，或者至少短于：

```
MyClass[] myArray = new MyClass[list.Count];
int i = 0;
foreach (MyClass myClass in list)
{
    myArray[i++] = myClass;
} 
```

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2009-03-10T07:17:27.517

尝试使用

```
MyClass[] myArray = list.ToArray(); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-10T07:18:45.437

```
List<int> list = new List<int>();
int[] intList = list.ToArray(); 
```

这是你的解决方案吗？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T07:18:08.637

`ToArray()`上使用`List<T>`。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-10T07:19:26.607

```
list.ToArray() 
```

会做的。有关详细信息，请参见[此处](http://msdn.microsoft.com/nl-nl/library/x303t819.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-05-03T12:26:05.153

您可以简单地使用`ToArray()`扩展方法

例子：

```
Person p1 = new Person() { Name = "Person 1", Age = 27 };
Person p2 = new Person() { Name = "Person 2", Age = 31 };

List<Person> people = new List<Person> { p1, p2 };

var array = people.ToArray(); 
```

[根据文档](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.toarray?view=netframework-4.8)

> 使用 复制元素`Array.Copy()`，这是一个 O(n) 操作，其中 n 是计数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-05T12:21:35.600

一种可以避免的解决方案，它使用多个 CPU 内核并预计运行速度更快，但它的执行速度却慢了大约 5 倍：

```
list.AsParallel().ToArray(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2019-09-02T02:38:47.533

通过使用多个处理器核心，HPCsharp nuget 包提供了两倍的速度：

```
list.ToArrayPar(); 
```

# sql - SQL 查询 - 返回连接表的前两条记录的连接

> ID：629183
> 
> 赞同：7
> 
> 时间：2009-03-10T07:14:30.440
> 
> 标签：sql, sql-server, join

我有两张桌子：

**病人**

*   pkPatientId
*   名
*   姓

**患者状态**

*   pkPatientStatusId
*   fkPatientId
*   状态码
*   开始日期
*   结束日期

**Patient** -> **PatientStatus**是一对多的关系。

我想知道是否有可能在 SQL 中执行一个仅返回每个患者的前两个​​ PatientStatus 记录的连接。如果仅存在一个 PatientStatus 记录，则不应在结果中返回该记录。

我的查询的正常连接是：

```
SELECT FROM Patient p INNER JOIN PatientStatus ps ON p.pkPatientId = ps.fkPatientId
ORDER BY ps.fkPatientId, ps.StartDate 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T11:57:00.277

如果您使用的是 SQL Server 2005 或更高版本，CTE 可能是您最好的选择，但如果您想要与其他平台更兼容的东西，这应该可行：

```
SELECT
     P.pkPatientID,
     P.FirstName,
     P.LastName,
     PS1.StatusCode AS FirstStatusCode,
     PS1.StartDate AS FirstStatusStartDate,
     PS1.EndDate AS FirstStatusEndDate,
     PS2.StatusCode AS SecondStatusCode,
     PS2.StartDate AS SecondStatusStartDate,
     PS2.EndDate AS SecondStatusEndDate
FROM
     Patient P
INNER JOIN PatientStatus PS1 ON
     PS1.fkPatientID = P.pkPatientID
INNER JOIN PatientStatus PS2 ON
     PS2.fkPatientID = P.pkPatientID AND
     PS2.StartDate > PS1.StartDate
LEFT OUTER JOIN PatientStatus PS3 ON
     PS3.fkPatientID = P.pkPatientID AND
     PS3.StartDate < PS1.StartDate
LEFT OUTER JOIN PatientStatus PS4 ON
     PS4.fkPatientID = P.pkPatientID AND
     PS4.StartDate > PS1.StartDate AND
     PS4.StartDate < PS2.StartDate
WHERE
     PS3.pkPatientStatusID IS NULL AND
     PS4.pkPatientStatusID IS NULL 
```

对我来说，你想要前两个状态而不是后两个状态似乎有点奇怪，但我假设你知道你想要什么。

如果您获得更好的性能，您也可以使用 WHERE NOT EXISTS 代替 PS3 和 PS4 连接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T09:03:51.783

这是我的尝试 - 由于使用了公共表表达式，它应该适用于 SQL Server 2005 和 SQL Server 2008（在 SQL Server 2008 上测试）：

```
WITH CTE AS
(
    SELECT  fkPatientId
          , StatusCode
          -- add more columns here
          , ROW_NUMBER() OVER
    (
    PARTITION BY fkPatientId ORDER BY fkPatientId desc) AS [Row_Number] 
    from PatientStatus
    where fkPatientId in
    (
        select fkPatientId
        from PatientStatus
        group by fkPatientId
        having COUNT(*) >= 2
    )
)
SELECT p.pkPatientId,
    p.FirstName,
    CTE.StatusCode  
FROM [Patient] as p
    INNER JOIN CTE
        ON p.[pkPatientId] = CTE.fkPatientId
WHERE CTE.[Row_Number] = 1 
or CTE.[Row_Number] = 2 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T07:51:18.387

编辑：以下两种解决方案都要求`PatientStatus.StartDate`在每个患者中都是独一无二的。

传统方式（SQL Server 2000 兼容）：

```
SELECT 
  p.pkPatientId,
  p.FirstName,
  p.Surname,
  ps.StatusCode,
  ps.StartDate,
  ps.EndDate
FROM 
  Patient p 
  INNER JOIN PatientStatus ps ON 
    p.pkPatientId = ps.fkPatientId
    AND ps.StartDate IN (
      SELECT TOP 2 StartDate 
      FROM     PatientStatus 
      WHERE    fkPatientId = ps.fkPatientId
      ORDER BY StartDate  /* DESC (to switch between first/last records) */
    )
WHERE 
  EXISTS (
    SELECT   1 
    FROM     PatientStatus
    WHERE    fkPatientId = p.pkPatientId
    GROUP BY fkPatientId
    HAVING   COUNT(*) >= 2
  )
ORDER BY 
  ps.fkPatientId, 
  ps.StartDate 
```

一个更有趣的选择（您必须尝试比较它的性能）：

```
SELECT 
  p.pkPatientId,
  p.FirstName,
  p.Surname,
  ps.StatusCode,
  ps.StartDate,
  ps.EndDate
FROM 
  Patient p 
  INNER JOIN PatientStatus ps ON p.pkPatientId = ps.fkPatientId
WHERE
  /* the "2" is the maximum number of rows returned */
  2 > (
    SELECT 
      COUNT(*)
    FROM 
      Patient p_i 
      INNER JOIN PatientStatus ps_i ON p_i.pkPatientId = ps_i.fkPatientId
    WHERE
      ps_i.fkPatientId = ps.fkPatientId
      AND ps_i.StartDate < ps.StartDate
      /* switch between "<" and ">" to get the first/last rows */
  )
  AND EXISTS (
    SELECT   1 
    FROM     PatientStatus
    WHERE    fkPatientId = p.pkPatientId
    GROUP BY fkPatientId
    HAVING   COUNT(*) >= 2
  )
ORDER BY 
  ps.fkPatientId, 
  ps.StartDate 
```

旁注：对于 MySQL，后一个查询可能是唯一的选择——直到子查询支持 LIMIT。

`PatientStatus`编辑：我添加了一个排除只有一条记录的患者的条件。（感谢您的提示，[瑞恩](https://stackoverflow.com/questions/629183/sql-query-join-that-returns-the-first-two-records-of-joining-table/629311#629311)！）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T07:42:00.763

我没有尝试，但这可以工作；

```
SELECT /*(your select columns here)*/, row_number() over(ORDER BY ps.fkPatientId, ps.StartDate) as rownumber FROM Patient p INNER JOIN PatientStatus ps ON p.pkPatientId = ps.fkPatientId
where rownumber between 1 and 2 
```

如果这不起作用，请参阅[此](http://msdn.microsoft.com/en-us/library/ms186734.aspx)链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T08:22:01.917

将此 WHERE 子句添加到 Tomalak 的第一个解决方案的外部查询将防止返回少于 2 条状态记录的患者。您也可以在第二个查询的 WHERE 子句中“和”它以获得相同的结果。

```
WHERE pkPatientId IN (
    SELECT pkPatientID 
    FROM Patient JOIN PatientStatus ON pkPatientId = fkPatientId
    GROUP BY pkPatientID HAVING Count(*) >= 2
) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T09:15:33.253

检查您的服务器是否支持窗口函数：

```
SELECT * 
FROM Patient p
LEFT JOIN PatientStatus ps ON p.pkPatientId = ps.fkPatientId
QUALIFY ROW_NUMBER() OVER (PARTITION BY ps.fkPatientId ORDER BY ps.StartDate) < 3 
```

另一种可能适用于 SQL Server 2005：

```
SELECT * FROM Patient p
LEFT JOIN ( 
    SELECT *, ROW_NUMBER(PARTITION BY fsPatientId ORDER by StartDate) rn
    FROM PatientStatus) ps
ON p.pkPatientId = ps.fkPatientID 
and ps.rn < 3 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T07:52:08.320

这是我将如何处理这个问题：

```
-- Patients with at least 2 status records
with PatientsWithEnoughRecords as (
    select fkPatientId
        from PatientStatus as ps
        group by 
            fkPatientId
        having
            count(*) >= 2
)
select top 2 *
    from PatientsWithEnoughRecords as er 
        left join PatientStatus as ps on
            er.fkPatientId = ps.fkPatientId
    order by StartDate asc 
```

我不确定是什么决定了您案例中的“前”两个状态记录，所以我假设您想要最早的两个**`StartDate`**。修改最后一个 **`order by`**子句以获取您感兴趣的记录。

**编辑**：SQL Server 2000 不支持 CTE，因此该解决方案确实只能在 2005 年及以后的版本中直接使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T08:17:04.470

丑陋，但是这个不依赖 StartDate 的唯一性并且适用于 SQL 2000

```
select * 
from Patient p 
join PatientStatus ps on p.pkPatientId=ps.fkPatientId
where pkPatientStatusId in (
 select top 2 pkPatientStatusId 
 from PatientStatus 
 where fkPatientId=ps.fkPatientId 
 order by StartDate
) and pkPatientId in (
 select fkPatientId
 from PatientStatus
 group by fkPatientId
 having count(*)>=2
) 
```

# c# - 设计多类型对象的最佳方法

> ID：629189
> 
> 赞同：4
> 
> 时间：2009-03-10T07:16:55.363
> 
> 标签：c#, generics, type-safety

假设我有一个数据对象，但这个对象可以保存几种类型的数据之一。

```
class Foo
{
    int intFoo;
    double doubleFoo;
    string stringFoo;
} 
```

现在，我想创建一个访问器。获取此数据的某种方式。显然，我可以创建多个访问器：

```
public int GetIntFoo();
public double GetDoubleFoo();
public string GetStringFoo(); 
```

或者我可以创建多个属性

```
public int IntFoo { get; set; }
public double DoubleFoo { get; set; }
public string StringFoo { get; set; } 
```

我不认为这是一个非常好的设计。它要求客户端代码比它应该更关心类型。更重要的是，我真的只需要这个类的一个值，上面将允许同时分配每种类型中的一个。不好。

一种选择是使用泛型。

```
class Foo<T>
{
    public T TheFoo { get; set; }
} 
```

但是，这不会创建 Foo，它会创建 Foo<T>。每个都有不同的类型，所以我不能真正将它们用作相同的类型。

我可以从 FooBase 派生 Foo<T>，然后将它们全部视为 FooBase，但随后我又回到了访问数据的问题上。

一个不同的泛型选项是使用这样的东西：

```
class Foo
{
    string stringRepresentationOfFoo;
    public T GetFoo<T>() { return /* code to convert string to type */ }
} 
```

当然，问题是任何类型的 T 都可以通过，坦率地说，它有点忙。

我也可以将值装箱并返回一个对象，但是没有类型安全性。

理想情况下，我希望对所有 Foo 都一视同仁，但我希望类型安全，这样如果没有 StringFoo，我什至无法编译对 StringFoo 的引用。

```
Foo foo = new Foo("Foo");
string sFoo = foo.Value;  // succeeds.
&nbsp;
Foo foo = new Foo(0);
int iFoo = foo.Value; // succeeds
string sFoo = foo.Value; // compile error 
```

也许这甚至是不可能的......我必须做出一些妥协，但也许我错过了一些东西。

有任何想法吗？

编辑：

好的，正如丹尼尔指出的那样，运行时类型的编译时检查是不切实际的。

在这里做我想做的事情的最佳选择是什么？即，对所有 Foo 都一视同仁，但仍然有一个相对健全的访问机制？

编辑2：

我不想将值转换为不同的类型。我想为该值返回正确的类型。也就是说，如果它是双精度的，我不想返回一个 int。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T11:52:17.510

将变量作为参数传递给 get 怎么样？像这样：

```
int i = foo.get(i); 
```

然后在你的课堂上，你会有类似的东西：

```
public int get(int p) {
    if(this.type != INTEGER) throw new RuntimeException("Data type mismatch");
    return this.intVal;
}

public float get(float p) {
    if(this.type != FLOAT) throw new RuntimeException("Data type mismatch");
    return this.floatVal;
} 
```

这种类型检查由内而外：不是检查 foo 持有什么类型，而是让 foo 检查你想要的类型。如果它可以为您提供该类型，那么它会提供，否则它会引发运行时异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T07:26:14.717

我认为这行不通（给你你想要的编译器错误）

你想要这个做什么：

```
Foo bar = (new Random()).Next(2) == 0 ? new Foo("bar") : new Foo(1);
int baz = bar.Value; 
```

那是编译器错误吗？

我认为“一视同仁”（至少按照您描述的方式）和“编译时错误”将是相互排斥的。

无论如何，我认为“最好的方法”将是泛型和继承之间的妥协。你可以定义一个`Foo<T>`Foo 的子类；那么你仍然可以拥有`Foo`.

```
abstract public class Foo
{
  // Common implementation

  abstract public object ObjectValue { get; }
}

public class Foo<T> : Foo
{
   public Foo(T initialValue)
   {
      Value = initialValue;
   }

   public T Value { get; set; }

   public object ObjectValue
   { 
      get { return Value; }
   }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T07:51:07.997

许多系统使用辅助方法来返回备用类型，就像 .net 框架基础对象具有 ToString() 方法一样

为每个对象选择最佳基类型，并为其他情况提供 To 方法

例如

```
class Foo{
    public Int32 Value { get; set; }
    public Byte ToByte() { return Convert.ToByte(Value); }
    public Double ToDouble() { return (Double)Value; }
    public new String ToString() { return Value.ToString("#,###"); }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T07:43:29.857

一件事是将任何类型存储在类的内部状态中，另一件事是将其暴露在外部。当你编写一个类时，你实际上是在为它的行为声明一个契约。您编写它的方式将极大地影响使用该类时客户端代码的外观。

例如，通过实现[IConvertible](http://msdn.microsoft.com/en-us/library/system.iconvertible.aspx)接口，您声明您的类型可以转换为任何 CLR 类型作为等效值。

我还看到了使用 Value 类来存储计算结果的实现，这些结果可以表示字符串、双精度、整数或布尔值。但是，问题是客户端代码必须检查枚举 {String, Integer, Double, Boolean} 的 Value.Type 属性，然后转换 Value.Value 属性（由 Value 类作为 Object 类型从外部公开) 或使用特定的 ValueString、ValueDouble、ValueInt、ValueBoolean getter。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T07:46:38.240

为什么不只使用`string`,`double`和`int`？

* * *

在收集有关信息后：如何使用`object`？无论如何，您将不得不检查类型等。为了帮助您，您可以使用`is`and`as`运算符。还有[Enumerable.Cast Method](http://msdn.microsoft.com/en-us/library/bb341406.aspx)，甚至更好的是[Enumerable.OfType Method](http://msdn.microsoft.com/en-us/library/bb360913.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T08:52:13.543

实际上，这门课的目的是什么？最大的问题似乎是设计至少打破了 SRP（单一责任原则）。

尽管如此，如果我没看错，您希望在容器中存储一些值，将容器传递给客户端并以类型安全的方式检索该值。

通过这种方法，您可以使用您的建议，即

```
namespace Project1 {
public class Class1 {
    static int Main(string[] args) {
        Foo a = new Foo();
        a.SetValue(4);
        Console.WriteLine(a.GetValue<int>());

        Foo b = new Foo();
        a.SetValue("String");
        Console.WriteLine(a.GetValue<string>());

        Console.ReadLine();

        return 0;
    }
}

class Foo {
    private object value; // watch out for boxing here!
    public void SetValue(object value) {
        this.value = value;
    }

    public T GetValue<T>() {
        object val = this.value;
        if (val == null) { return default(T); } // or throw if you prefer
        try {
            return (T)val;
        }
        catch (Exception) {
            return default(T);
            // cast failed, return default(T) or throw
        }
    }
}
} 
```

但是，在那种情况下，为什么不简单地将数据作为对象传递并自己进行转换呢？

根据您的需要，您还可以尝试“C# 中的 PHP”：

```
namespace Project1 {
public class Class1 {
    static int Main(string[] args) {
        MyInt a = 1;
        MyInt b = "2";

        Console.WriteLine(a + b); // writes 3

        Console.ReadLine();

        return 0;
    }
}

class MyInt {
    private int value;

    public static implicit operator int(MyInt container) {
        return container.value;
    }

    public static implicit operator MyInt(int value) {
        MyInt myInt = new MyInt();
        myInt.value = value;
        return myInt ;
    }

    public static implicit operator MyInt(string stringedInt) {
        MyInt myInt = new MyInt();
        myInt.value = int.Parse(stringedInt);
        return myInt;
    }
}
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T10:58:46.640

对不起，我只是不买你的前提。如果数据都具有相同的目的，那么它们都应该具有相同的类型。考虑一个用于保存当前温度的类，由几个 Web 服务之一返回。所有服务都返回摄氏温度。但是一个以 int 形式返回，一个以 double 形式返回，一个以字符串形式返回。

这不是三种不同的类型 - 它是一种类型 - 双。您只需将非双精度返回转换为双精度，这就是温度（或者可能是浮点数）。

一般来说，如果你对一件事有多种表示，那么它仍然是一件事，而不是多件事。将多个表示转换为一个。

# java - 犀牛怎么了？它是否仍在积极开发中？

> ID：629194
> 
> 赞同：8
> 
> 时间：2009-03-10T07:18:37.043
> 
> 标签：java, rhino, scripting-language

最后一次发布是在 2008 年 3 月 6 日。这是怎么回事？它是否仍在积极开发中？有替代品吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T07:42:11.637

Rhino 的略微修改版本（1.6r2）是[Java 6 的一部分，](http://www.onjava.com/pub/a/onjava/2006/04/26/mustang-meets-rhino-java-se-6-scripting.html)除此之外，根据我的测试，Rhino 的功能非常完整，因此真的没有任何东西可以继续开发，显然它也没有错误还。

我想说 Rhino 是那些真正完成的稀有库之一。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T22:09:17.113

根据上周在[http://groups.google.com/group/mozilla.dev.tech.js-engine.rhino/topics上的帖子](http://groups.google.com/group/mozilla.dev.tech.js-engine.rhino/topics)

```
On Mar 9, 11:45 am, Rhino user <anupama.jo...@gmail.com> wrote:

> Does  anybody has any tentative dates for 1.7R2 release?

I need to look at https://bugzilla.mozilla.org/show_bug.cgi?id=482203
but other than that it is ready to go. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T07:35:14.307

这个问题最好在相关新闻组提出：mozilla.dev.tech.js-engine。[或者通过邮件发送给Mozilla 网站上提到](http://www.mozilla.org/owners.html)的负责开发人员之一。

但是，如果您发现了，请在此处发布答案。我也很感兴趣。

# winapi - Win32 VERSIONINFO 资源中的 URL？

> ID：629199
> 
> 赞同：1
> 
> 时间：2009-03-10T07:21:24.433
> 
> 标签：winapi, versioning, versioninfo

我们的一位经理决定我们的 EXE/DLL 文件（在 VERSIONINFO 资源中）中的 CompanyName 应该包含我们的 URL（例如“OurCompany - [http://www.ourcompany.com](http://www.ourcompany.com) ”）。

我认为这是一个坏主意，因为它可能会导致意想不到的后果。它也冒犯了我的审美，因为该字段不调用 CompanyNameAndUrl，而且我们的公司名称不是 URL。

我对吗？我怎样才能说服他他错了？我应该在哪里放置一个 URL 以使其出现在 Windows 的版本信息中。

我错了吗？

更新：二进制文件是数字签名的，所以 URL 在那里可见。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T07:41:58.830

本案例中的权威答案和示例应该来自微软：

[版本信息资源 (Windows)](http://msdn.microsoft.com/en-us/library/aa381058.aspx)

> **CompanyName**：生成文件的公司，例如“Microsoft Corporation”或“Standard Microsystems Corporation, Inc.” 此字符串是必需的。

很少有人会查看可执行文件或 DLL 的属性；在那些这样做的人中，我猜 95% 的人都知道如何通过 Google 搜索*ProductName*以了解更多信息。我在我的 PC 上检查了来自不同供应商的多个文件，但没有一个文件包含 URL。

但是，如果必须，总有*评论*字段...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T07:48:53.493

添加到 MaxVT 的评论 - 使用不可点击的完整 URL 是**如此**上个世纪。

IMO：这不会有什么坏处，可能没人会看到它，而且有时你不得不让你的经理觉得他们在控制某事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T08:10:32.083

如果你真的想要一个与你的模块相关联的 URL，为什么不附加一个数字签名呢？这样，您和客户就会获得额外的好处，即知道文件未被篡改，并且默认查看器会将 URL 显示为可点击的链接。

# mysql - 从 csv 导入时 mysql 出错

> ID：629204
> 
> 赞同：1
> 
> 时间：2009-03-10T07:22:26.053
> 
> 标签：mysql, load-data-infile

这是我的命令行查询。

```
mysql> load data local infile "c:\\re\\30-11-08.csv" 
into table powerdata(Date, DG1, DG2, DG3, Dg4, DG5, ChillerPanel1, 
    ChillerPanel2, ChillerPanel3, ChillerPanel4,1st_Floor, 2nd_Floor, 
    3rd_Floor, 4th_Floor, UPS1, UPS2, UPS3, UPS4, UPS5,Server_Power, 
    Cooling_Power) 
    fields terminated by ',' lines terminated by '\n'
set Dateformat=str_to_date(Date, '%m/%d/%Y' '%H:%i:%s'); 
```

> ERROR 1064 (42000)：您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册以获取正确的语法，以便在 'fields terminate by ',' lines 以 '\n'set Dateformat=str_to_date(Date' at line 1 附近使用

我不知道错误在哪里！谁能帮我？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T08:01:52.307

我想“set Dateformat=”部分导致了这个问题。您的列名为“日期”，因此该部分应如下所示：

```
set Date = str_to_date(@datevar, 'your format') 
```

[另请参阅手册](http://dev.mysql.com/doc/refman/5.0/en/load-data.html)中的以下代码示例：

```
LOAD DATA INFILE 'file.txt'
  INTO TABLE t1
  (column1, @var1)
  SET column2 = @var1/100; 
```

顺便说一句：在 MySQL 5.0.3 之前，不支持 SET 子句。

# c++ - 需要帮助以使用 GDI+ 显示日语文本，而无需在 Windows XP 中安装东亚语言包

> ID：629205
> 
> 赞同：3
> 
> 时间：2009-03-10T07:22:45.270
> 
> 标签：c++, windows, winapi, unicode, gdi+

我正在编写一个日语测验程序，我不想要求人们安装适用于 Windows XP 的东亚语言包。我正在使用 GDI+ 来绘制文本。我尝试下载免费的 Unicode 字体并使用它来绘制文本。我在我的电脑上测试了它（安装了东亚包），它使用下载的字体正确显示了日文字符，但在另一台没有语言包的电脑上它不起作用。

我正在寻找有关如何完成这项工作的建议。该程序非常简单，仅使用 Win32 API、GDI+ 和 STL 用 C++ 编写。如果可能的话，我想只使用这些库。我确实有 UNICODE #defined。

我基本上用于绘制文本的代码粘贴在下面：

```
#include <gdiplus.h>
using namespace Gdiplus ;

Graphics * gi ;

PrivateFontCollection _fonts ;
_fonts.AddFontFile(fontFilename) ;
Font * currentFont = new Font(fontName, fontSize, FontStyleRegular, UnitPoint, &_fonts) ;

std::wstring text = L"Some text" ;
gi->DrawString(text.c_str(), (INT)text.size(), currentFont, rectangle, &format, &brush) ; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:29:27.283

解决方案相当简单。由于您不想发布字体，并且您不能指望任何可用的字体，您将不得不发布您想要使用的所有字符的图像。我建议使用 PNG，因为 JPEG 是针对照片的（很多小的渐变）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T01:40:45.423

我错了。如果您的字体包含日文字符，即使没有安装东亚语言包，它也会在 Windows XP 中正确显示。

如果您安装了东亚语言包并且您的字体不支持日文字符，Windows 将在它认为最接近您的字体的两种字体中进行选择。这使我认为我使用的字体包括日文字符，因为当我在字体和系统字体之间切换时，它会改变字符的绘制方式。

微软有一个免费安装的日文字体，叫做[Meiryo Collection Version 5.00](http://www.microsoft.com/downloads/details.aspx?FamilyID=f7d758d2-46ff-4c55-92f2-69ae834ac928&displaylang=en)。还有一个[页面](http://www.wazu.jp/gallery/Fonts_Japanese.html)列出了更多日文字体，列出的字体的唯一问题是许可不明确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T20:15:34.267

还有一种名为 Lucida Sans Unicode 的字体可能有助于缓解问题。

# .net - AssemblyInfo 属性如何映射到 Win32 VERSIONINFO？

> ID：629206
> 
> 赞同：9
> 
> 时间：2009-03-10T07:23:07.907
> 
> 标签：.net, versioning, versioninfo

当您查看包含 VERSIONINFO 资源的二进制文件的属性时，Windows 会添加一个显示该信息的“版本”选项卡。

是否有一个 .NET 程序集属性映射到哪个 VERSIONINFO 字段的列表，以便我们可以轻松地为我们的 .NET 程序集控制这些属性？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-10T13:03:36.310

**关于“固定信息”：**

PRODUCTVERSION 和 FILEVERSION 分别从`[AssemblyInformationalVersion]`和 设置`[AssemblyFileVersion]`。

FILEOS、FILETYPE 最有可能由编译器设置。

**关于[Var 文件信息](http://msdn.microsoft.com/en-us/library/aa381057(VS.85).aspx)**

`[AssemblyCulture]`映射到“翻译”（我猜！）

**关于[字符串文件信息](http://msdn.microsoft.com/en-us/library/aa381049(VS.85).aspx)**

`[AssemblyCompany]`映射到“CompanyName”
`[AssemblyDescription]`映射到“Comments”
`[AssemblyFileVersion]`映射到“FileVersion”
`[AssemblyTitle]`映射到“FileDescription”
`[AssemblyInformationalVersion]`映射到“ProductVersion”
`[AssemblyProduct]`映射到“ProductName”
`[AssemblyCopyright]`映射到“LegalCopyright”

我认为“InternalName”和“OriginalFile”分别设置为DLL或EXE的名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T08:49:39.307

我相信该[`[AssemblyFileVersion]`](http://msdn.microsoft.com/en-us/library/system.reflection.assemblyfileversionattribute.aspx)属性（除其他外）会这样做 - 例如：

```
[assembly:AssemblyFileVersion("1.2.3.4")] 
```

您应该可以`AssemblyInfo.cs`在 IDE 生成的默认文件中找到此设置；如果没有，请自己声明（如上）。

您可能还想大体上查看项目属性中的“装配信息...”对话框，该对话框提供对此和其他内容的访问。

# windows - 当我的程序运行时，防止 Windows 进入睡眠状态？

> ID：629240
> 
> 赞同：40
> 
> 时间：2009-03-10T07:41:42.497
> 
> 标签：windows, winapi, sleep

当我的程序运行时，我必须阻止 Windows 进入睡眠状态。

而且我不仅想阻止睡眠定时器，如果我按下睡眠按钮或以任何其他方式主动告诉计算机睡眠，我还想取消睡眠事件。因此 SetThreadExecutionState 是不够的。

或者......我实际上不必完全阻止睡眠，只需将其延迟 5-10 秒以让我的程序完成任务。

（我知道这是不好的程序行为，但仅供个人使用。）

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2014-01-08T12:48:48.583

在考虑[了vim的回答之后](https://stackoverflow.com/a/16086508/3090544)

> “使用 PowerCreateRequest、PowerSetRequest 和 PowerClearRequest 函数是首选方法。”

[使用msdn](http://msdn.microsoft.com/en-us/library/windows/hardware/gg463205.aspx)上链接的 AvailabilityRequests.docx很难进入它（阅读太多），我在网上搜索了一个基于 PowerCreateRequest的[c#中的具体示例，并找到了](/questions/tagged/c%23 "显示标记为“c#”的问题")[http://go4answers.webhost4life.com /Example/problem-monitor-wakeup-service-windows7-12092.aspx](http://go4answers.webhost4life.com/Example/problem-monitor-wakeup-service-windows7-12092.aspx) [编辑 2016 - 不再可用]

复制并适应我的需要（从[msdn](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724211%28v=vs.85%29.aspx)复制的 CloseHandle 的 PInvoke ）：

```
using System.Runtime.InteropServices;

    #region prevent screensaver, display dimming and automatically sleeping
    POWER_REQUEST_CONTEXT _PowerRequestContext;
    IntPtr _PowerRequest; //HANDLE

    // Availability Request Functions
    [DllImport("kernel32.dll")]
    static extern IntPtr PowerCreateRequest(ref POWER_REQUEST_CONTEXT Context);

    [DllImport("kernel32.dll")]
    static extern bool PowerSetRequest(IntPtr PowerRequestHandle, PowerRequestType RequestType);

    [DllImport("kernel32.dll")]
    static extern bool PowerClearRequest(IntPtr PowerRequestHandle, PowerRequestType RequestType);

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true, ExactSpelling = true)]
    internal static extern int CloseHandle(IntPtr hObject);

    // Availablity Request Enumerations and Constants
    enum PowerRequestType
    {
        PowerRequestDisplayRequired = 0,
        PowerRequestSystemRequired,
        PowerRequestAwayModeRequired,
        PowerRequestMaximum
    }

    const int POWER_REQUEST_CONTEXT_VERSION = 0;
    const int POWER_REQUEST_CONTEXT_SIMPLE_STRING = 0x1;
    const int POWER_REQUEST_CONTEXT_DETAILED_STRING = 0x2;

    // Availablity Request Structures
    // Note:  Windows defines the POWER_REQUEST_CONTEXT structure with an
    // internal union of SimpleReasonString and Detailed information.
    // To avoid runtime interop issues, this version of 
    // POWER_REQUEST_CONTEXT only supports SimpleReasonString.  
    // To use the detailed information,
    // define the PowerCreateRequest function with the first 
    // parameter of type POWER_REQUEST_CONTEXT_DETAILED.
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct POWER_REQUEST_CONTEXT
    {
        public UInt32 Version;
        public UInt32 Flags;
        [MarshalAs(UnmanagedType.LPWStr)]
        public string
            SimpleReasonString;
    }

    [StructLayout(LayoutKind.Sequential)]
    public struct PowerRequestContextDetailedInformation
    {
        public IntPtr LocalizedReasonModule;
        public UInt32 LocalizedReasonId;
        public UInt32 ReasonStringCount;
        [MarshalAs(UnmanagedType.LPWStr)]
        public string[] ReasonStrings;
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct POWER_REQUEST_CONTEXT_DETAILED
    {
        public UInt32 Version;
        public UInt32 Flags;
        public PowerRequestContextDetailedInformation DetailedInformation;
    }
    #endregion

    /// <summary>
    /// Prevent screensaver, display dimming and power saving. This function wraps PInvokes on Win32 API. 
    /// </summary>
    /// <param name="enableConstantDisplayAndPower">True to get a constant display and power - False to clear the settings</param>
    private void EnableConstantDisplayAndPower(bool enableConstantDisplayAndPower)
    {
        if (enableConstantDisplayAndPower)
        {
            // Set up the diagnostic string
            _PowerRequestContext.Version = POWER_REQUEST_CONTEXT_VERSION;
            _PowerRequestContext.Flags = POWER_REQUEST_CONTEXT_SIMPLE_STRING;
            _PowerRequestContext.SimpleReasonString = "Continuous measurement"; // your reason for changing the power settings;

            // Create the request, get a handle
            _PowerRequest = PowerCreateRequest(ref _PowerRequestContext);

            // Set the request
            PowerSetRequest(_PowerRequest, PowerRequestType.PowerRequestSystemRequired);
            PowerSetRequest(_PowerRequest, PowerRequestType.PowerRequestDisplayRequired);
        }
        else
        {
            // Clear the request
            PowerClearRequest(_PowerRequest, PowerRequestType.PowerRequestSystemRequired);
            PowerClearRequest(_PowerRequest, PowerRequestType.PowerRequestDisplayRequired);

            CloseHandle(_PowerRequest);
        }
    } 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-10T08:06:42.373

我在通过 USB 连接的硬件设备上遇到了这样的问题。XP /Vista 会在...中间休眠/休眠...太好了，当它恢复时它可以继续。如果硬件仍然连接！！！用户有随时拉出电缆的习惯。

你需要处理 XP 和 Vista

在 XP 下捕获 WM_POWERBROADCAST 并寻找 PBT_APMQUERYSUSPEND wparam。

```
 // See if bit 1 is set, this means that you can send a deny while we are busy
   if (message.LParam & 0x1)
   {
      // send the deny message
      return BROADCAST_QUERY_DENY;
   } // if
   else
   {
      return TRUE;
   } // else 
```

在 Vista 下像这样使用 SetThreadExecutionState

```
// try this for vista, it will fail on XP
if (SetThreadExecutionState(ES_CONTINUOUS | ES_SYSTEM_REQUIRED | ES_AWAYMODE_REQUIRED) == NULL)
{
   // try XP variant as well just to make sure 
   SetThreadExecutionState(ES_CONTINUOUS | ES_SYSTEM_REQUIRED);
}  // if 
```

当您的应用程序完成后将其恢复正常

```
// set state back to normal
SetThreadExecutionState(ES_CONTINUOUS); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-04-18T15:03:35.627

使用 PowerCreateRequest、PowerSetRequest 和 PowerClearRequest 函数是首选方法。详细信息和示例代码（C/C#）在[http://msdn.microsoft.com/en-us/library/windows/hardware/gg463205.aspx](http://msdn.microsoft.com/en-us/library/windows/hardware/gg463205.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2021-04-12T10:49:48.027

设置 wsc = CreateObject("WScript.Shell")

执行 WScript.Sleep (60*1000) wsc.SendKeys ("{SCROLLLOCK 2}") 循环

- 将上述代码放入记事本并将文件另存为 .vbs 并双击该文件

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T07:51:13.487

相同的技术适用于防止应使用屏幕保护程序。请参阅[以编程方式阻止 Windows 屏幕保护程序启动](https://stackoverflow.com/questions/463813/programmatically-prevent-windows-screensaver-from-starting)。

请注意，某些安全设置可以覆盖此设置（强制计算机在特定时间后锁定为一）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T07:48:43.633

如果它进入睡眠状态，如何唤醒它？

[http://www.enterprisenetworksandservers.com/monthly/art.php?1049](http://www.enterprisenetworksandservers.com/monthly/art.php?1049)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-28T11:28:44.570

[下面是我使用vim 建议](https://stackoverflow.com/a/16086508/67824)`SetThreadExecutionState`的现代电源可用性请求 API（取代）的尝试。

我正在使用我遇到的一个不错的 P/Invoke NuGet，[Vanara.PInvoke.Kernel32](https://www.nuget.org/packages/Vanara.PInvoke.Kernel32/)：

```
using Vanara.PInvoke;
using static Vanara.PInvoke.Kernel32;

// create request object
using var request = PowerCreateRequest(new REASON_CONTEXT("App FOO is working"));
if (request.IsInvalid)
{
    throw new InvalidOperationException(
       $"Could not create power availability request: {Win32Error.GetLastError()}");
}

// send request
if (!PowerSetRequest(request, POWER_REQUEST_TYPE.PowerRequestSystemRequired))
{
    throw new InvalidOperationException(
       $"Could not send power availability request: {Win32Error.GetLastError()}");
}

// do stuff that required the machine to be up
Console.WriteLine("Doing stuff...");
await Task.Delay(5000);

// clear request
if (!PowerClearRequest(request, POWER_REQUEST_TYPE.PowerRequestSystemRequired))
{
    Console.WriteLine(
      "WARNING: Could not clear power availability request: {0}",
      Win32Error.GetLastError());
} 
```

`powercfg /requests`您可以通过从管理终端发出来查看您的请求。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-10-06T10:31:12.973

如果您需要一个在您的应用程序运行之前应该可以工作的显示器，请尝试设置“ES_DISPLAY_REQUIRED”而不是离开模式：

```
SetThreadExecutionState(ES_CONTINUOUS | ES_SYSTEM_REQUIRED | ES_DISPLAY_REQUIRED); 
```

完成应用程序后，请确保清除所有其他标志。

```
SetThreadExecutionState(ES_CONTINUOUS); 
```

# java - MSSQL中浮点字段中的NaN值

> ID：629257
> 
> 赞同：0
> 
> 时间：2009-03-10T07:48:25.960
> 
> 标签：java, sql-server, nan

我正在开发一个 java 应用程序，使用 double 类型来保存 unitprice、qty 等的值。我发现 MSSQL 中显示的一些值是 NAN，当我尝试重用它时会抛出无限错误。这太不合理了，我可以保存它但不能再使用它了！我认为 MSSQL 中的 NAN 值在它首次出现在 java 中时必须是有效的，所以我可以保存。这个问题是如何以及何时发生的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T07:49:22.930

你不应该**使用**double 或 float 来存储价格。请改用十进制。Double 和 float 数据类型并不是很精确。

FLOAT 和 REAL 数据类型都是用于浮点数值数据的近似数字数据类型。浮点数据是近似的；并非数据类型范围内的所有值都可以精确表示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T08:26:30.000

NaN 值通常是除以零的结果——这将是我要检查的第一件事。

# nhibernate - Fluent NHibernate 对象化关系映射

> ID：629284
> 
> 赞同：1
> 
> 时间：2009-03-10T08:05:40.973
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping, many-to-many

寻找有关如何配置 NHibernate 以支持我的场景的答案，即具有对象化关系的多对多映射。

我有一组 Person:s 与其他 Person:s 的关系。每个关系都有一个属性，指定它们具有什么类型的关系。在 RDB 中，这是通过使用具有在该表中指定的关系类型的多对多表来完成的，然后可以通过允许更多类型来扩展模型，例如“亲密朋友”和“主要敌人”。

我希望能够查询一个 Person 对象以按类型返回所有​​相关的 Person

```
<IList>Person myEnemies =  myPerson.getRelatedPersons(relationType.Enemy) 
```

或者

```
<IList>Person myFriends = myPerson.getRelatedPersons(relationType.Friend) 
```

另一个（不太可扩展的）解决方案是在类中静态指定存在哪些其他关系：

```
public class Person   
{   
  public virtual int Id { get; private set; }   
  public virtual string FirstName { get; set; }   
  public virtual string LastName { get; set; }   
  public virtual IList<Person> Friends { get; set; }   
  public virtual IList<Person> Enemies { get; set; }   
} 
```

现在我**必须使用**带有“Person”表和“PersonPerson”表的遗留数据库。“PersonPerson”表将关系类型保存为整数。

我试图使用如下语法来做到这一点，但到目前为止没有成功......

```
// How to specify type=1  here?
HasManyToMany(x => x.Friends).WithTableName("Person_Person"); 

// How to specify type=2  here?
HasManyToMany(x => x.Enemies).WithTableName("Person_Person"); 
```

关于使用（流利的）NHibernate 映射这个的任何提示/解决方案？

BR

/詹斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T09:05:05.097

您所说的第一个示例听起来像是您需要研究继承映射，但我不确定这将如何与所涉及的额外表一起使用。

第二个示例您应该能够使用 Where 子句。

```
HasManyToMany(x => x.Friends)
  .WithTableName("Person_Person")
  .Where("type = 2"); 
```

# jquery - 我将css添加到head标签的末尾

> ID：629297
> 
> 赞同：1
> 
> 时间：2009-03-10T08:13:07.053
> 
> 标签：jquery, css

我想将css添加到head标签，当用户在keyup的这个文本框中添加背景图像url时，它应该反映页面，就像我的页面上有文本框一样，css是在body背景的head标签中创建的。正文标签的css已成功添加到head标签的开头，但对页面背景没有影响:(。

问题是我可以在 head 标签的末尾添加 css 吗？它会改变我的身体背景吗？

我正在使用 jquery 执行此操作，请帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T09:24:50.923

使用下面的代码和语法得到解决方案。

可以添加多个 class 和 id 选择器来更改页面的完整布局。

它只会改变背景图像

```
$("head").append("<style type=\"text/css\" charset=\"utf-8\">body{background:url("+yourimage variable +") top repeat-x;}"); 
```

并且可以使用下面添加多个 css 类

```
$("head").append("<style type=\"text/css\" charset=\"utf-8\">body{background:url("+bgimg+") top repeat-x;}#modulebasicInfo{background:#000;}"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T08:19:38.550

你不能直接用jQuery直接改变css属性吗？

```
 $(document).ready(function(){   
      ("body").css({'background-color' : 'yellow'});
 }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T08:20:47.113

head 标签包含页面的元信息。它不是可视的，因此向其添加 css 将无效。

jQuery 在运行时不会向 head 标签添加任何内容，它会操作浏览器创建的 DOM 树。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T08:27:35.023

检查你的css，在添加你想要添加的css后，你可能正在通过链接的样式表重置背景颜色......

将它添加到 head 标签的末尾将允许它正确覆盖 CSS 样式表中的设置。

# com - 从 ASP.Net 页面获取屏幕截图

> ID：629298
> 
> 赞同：5
> 
> 时间：2009-03-10T08:13:46.430
> 
> 标签：com, web, activex, screenshot

我有一个 ASP.Net 页面，该页面有一个按钮，当单击该按钮时，我想截取用户 PC 的屏幕截图并将其发送到服务器。

我可以编写某种侦听器程序以在服务器上运行以接受接收这些图像的请求。我有点朦胧的地方是让用户的PC发送屏幕截图的最佳方式。这需要通过为 ASP.Net 页面编写某种 Active X 控件来完成吗？如果可能，它需要跨浏览器和操作系统。

只是在正确方向上的一点，我应该使用哪些技术会很棒。如果可能的话，我宁愿自己编写此功能，也不愿使用开箱即用的解决方案，因为我可以看到将来可能会扩展此功能。WebEx 或 copilot 之类的东西如何管理这个？

谢谢

加文

编辑：为了清楚起见，我不是试图从用户 PC 窃取信息，他们必须允许此功能，更多的是从支持的角度来看，因此当客户遇到问题时，他们可以发送页面的屏幕截图他们在。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T08:23:05.190

如果它需要跨浏览器，你应该看看Java（小程序）。这听起来可能很老套，但我认为这是你最好的选择。ActiveX 仅适用于 windows/IE ;)

对于初学者，看看这个非常相似的问题：[有没有办法使用 Java 截取屏幕截图并将其保存到某种图像？](https://stackoverflow.com/questions/58305/java-is-there-a-way-to-take-a-screenshot-using-java-and-save-it-to-some-sort-of)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T08:23:44.673

ActiveX 可以工作。我怀疑您也可以在 Silverlight、Flash 或 Java 小程序中做一些事情（这将更适合跨浏览器）。

至于 copilot，它在每个用户下载并运行的独立可执行文件中运行。所以它并不局限于典型的浏览器限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T08:29:15.610

它只是您想要快照的网页吗？

然后，您可以从 javascript 文档对象访问呈现为 html 的整个页面，并将其与浏览器类型等一起发送到 Web 服务。无需安装 ActiveX :-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-21T12:16:08.750

我使用 WebsitesScreenshot 组件来捕获网站截图或缩略图。这个 .NET 组件非常易于使用。我喜欢这个组件。 [http://www.websitesscreenshot.com/](http://www.websitesscreenshot.com/)

示例代码：

```
WebsitesScreenshot.WebsitesScreenshot _Obj;
_Obj = new WebsitesScreenshot.WebsitesScreenshot();

WebsitesScreenshot.WebsitesScreenshot.Result _Result;
_Result = _Obj.CaptureWebpage("http://www.msn.com");

if (_Result == WebsitesScreenshot.WebsitesScreenshot.Result.Captured)
{
    _Obj.ImageWidth = 200;
    _Obj.ImageHeight = 300;
    _Obj.ImageFormat = WebsitesScreenshot.WebsitesScreenshot.ImageFormats.PNG;
    _Obj.SaveImage("c:\\msn.png");
}
_Obj.Dispose(); 
```

# asp.net - 如何在 Log4Net 中输出 XML

> ID：629302
> 
> 赞同：1
> 
> 时间：2009-03-10T08:15:39.140
> 
> 标签：asp.net, xml, log4net

我在我的 3.5 SP1 Web 项目下使用 Log4Net，我需要知道如何（读取 Log4Net）将日志文件创建为 xml 文件而不是文本，逐行...

我认为这可能是一件容易的事情，但是......我找不到申请的诀窍:(

**谢谢**。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T08:27:35.303

您可以使用 xml 布局（[http://logging.apache.org/log4net/release/sdk/log4net.Layout.XmlLayout.html](http://logging.apache.org/log4net/release/sdk/log4net.Layout.XmlLayout.html)），但是不会生成格式良好的 xml 文件，根节点将丢失。因此，您需要先添加根节点，然后再在任何支持 xml 的工具中打开它。

# java - 处理发生时动态刷新 JTextArea？

> ID：629315
> 
> 赞同：24
> 
> 时间：2009-03-10T08:23:21.023
> 
> 标签：java, multithreading, swing

我正在尝试创建一个非常简单的 Swing UI，当处理发生在后台时，它通过 JTextArea 将信息记录到屏幕上。当用户单击按钮时，我希望每次调用：

```
textArea.append(someString + "\n"); 
```

立即显示在 UI 中。

目前，JTextArea 不会显示所有日志信息，直到单击按钮后处理完成。如何让它动态刷新？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-10-17T08:32:41.233

试试这个：

```
jTextArea.update(jTextArea.getGraphics()); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-10T12:57:59.960

我的应用程序遇到了同样的问题。我的应用程序有一个“运行”按钮，它执行一些操作并将结果输出到 JTextArea。我不得不从线程调用该方法。这就是我所做的。

我有几个可以完成的操作单选按钮，然后是一个“运行”按钮来执行该特定操作。我有一个名为验证的操作。因此，当我选中该单选按钮并单击“运行”按钮时，它会调用方法 validate()。所以我先把这个方法放到了一个实现Runnable的内部类中

```
class ValidateThread implements Runnable {
    public void run() {
        validate();
    }
} 
```

然后我在“运行”按钮的 ActionListener 中调用了这个线程

```
runButton.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent ae) {
        // Some code checked on some radio buttons
        if(radioButton.isSelected()) {
            if(radioButton.getText().equals("VALIDATE")) {
               Runnable runnable = new ValidateThread();
               Thread thread = new Thread(runnable);
               thread.start();
            }
        }
    }

}); 
```

瞧！输出现在发送到 JTextArea。

现在，您会注意到 JTextArea 不会随着文本向下滚动。所以你需要像这样设置插入符号的位置

```
textArea.setCaretPosition(textArea.getText().length() - 1); 
```

现在，当数据添加到 JTextArea 时，它将始终向下滚动。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T09:30:38.460

正如其他人所说，这需要多线程。看看[Swing 中的并发](http://java.sun.com/docs/books/tutorial/uiswing/concurrency/index.html)。

一种解决方案是使用 SwingWorker 实现处理。doInBackground 方法将实现处理，您将调用 publish 方法，并将字符串作为参数附加。然后，您的 SwingWorker 将覆盖 process 方法以获取 String 参数并将其附加到文本区域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-29T13:31:08.920

很抱歉回答 4 年前发布的这个问题，但我有另一个对我有用的解决方案。我只是使用指针来更新`JTextArea`：

```
//JScrollPane variable pane initialized with JTextArea area
//We will update area with new text
JTextArea temp = (JTextArea) pane.getViewPort().getView();
//new text to add
JTextArea c = new JTextArea();
c.append("text \n)";
//update through pointers
temp = c;
pane.validate(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T08:24:55.433

为此，您需要多线程。准备好冒险了吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T08:38:19.473

如果它是多线程，你需要试试这个！ [http://www.devarticles.com/c/a/Java/Multithreading-in-Java/](http://www.devarticles.com/c/a/Java/Multithreading-in-Java/)

# c# - 如何将 PDFBox 与 Asp.Net 结合使用以使用 c# 解析 pdf 文件？

> ID：629327
> 
> 赞同：1
> 
> 时间：2009-03-10T08:31:04.937
> 
> 标签：c#, asp.net, pdf

我最近下载了 PDFBox，我试图弄清楚如何在 Asp.Net 中用它解析 pdf 文件，但无济于事，事实上，我什至不知道从哪里开始。有没有人能够在 asp.net 中做到这一点（最好是 C#）？

有没有其他方法可以在 Asp.Net 中解析 PDF 中的文本？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-03-14T19:31:25.703

看看这个： http: [//naspinski.net/post/ParsingReading-a-PDF-file-with-C-and-AspNet-to-text.aspx](http://naspinski.net/post/ParsingReading-a-PDF-file-with-C-and-AspNet-to-text.aspx)

# asp.net - ASP.NET：计时器和滚动位置

> ID：629331
> 
> 赞同：3
> 
> 时间：2009-03-10T08:36:37.030
> 
> 标签：asp.net, ajax

在更新面板中有一个计时器。它不断刷新（大约每 2.5 秒）。如果它在滚动时刷新，它将滚动位置设置回部分更新之前的位置:(

我使用的是 ASP.NET 3.5，MaintainScrollPositionOnPostback 设置为 false（即使设置为 true，行为也不会改变）。

不知道为什么会发生这种情况，但可用性很烦人......

亲切的问候，萨沙

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T22:26:29.170

我们有一个类似的问题，异步回发会将用户重置到一个非常长的页面的顶部。我们在找到以下代码后解决了它：[http ://forums.asp.net/t/1047815.aspx](http://forums.asp.net/t/1047815.aspx)

我们在页面上的 ScriptManager**之后在页面上插入了以下 javascript。**

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
</asp:ScriptManager>

<script type="text/javascript">
    var prm = Sys.WebForms.PageRequestManager.getInstance();
    prm.add_beginRequest(beginRequest);

    function beginRequest() {
        prm._scrollPosition = null;
    }
</script> 
```

这使得回发不会在回发返回时重置用户滚动位置。

我不确定这是否正是您遇到的问题。您还可以查看这篇文章：[Reset scroll position after Async postback - ASP.NET](https://stackoverflow.com/questions/616210/reset-scroll-position-after-async-postback-asp-net)，其中讨论了在回发发生后设置滚动位置的更可靠的方法。

# .net - WPF DataTemplate 在按钮按下时运行功能？

> ID：629337
> 
> 赞同：1
> 
> 时间：2009-03-10T08:45:30.627
> 
> 标签：.net, wpf, datatemplate

那么问题说明了一切？我有一个带有按钮的 DataTemplate 有什么方法可以运行一个函数，或者如何告诉对象按下了按钮？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T08:49:45.687

给按钮 ax:name ，您可以在按钮事件 'sender' 或 e.source 参数中看到该名称

```
var source = sender as FrameworkElement; // Or whatever real control it is
var parent = source.parent; // Get parent control(s)
var dataContext = source.DataContext; // Get databinding context 
```

# c# - Expression.Call 重载之间的区别？

> ID：629342
> 
> 赞同：7
> 
> 时间：2009-03-10T08:49:03.957
> 
> 标签：c#, linq, linq-to-sql, lambda

我试图为 LINQ2SQL 查询动态创建 Where 谓词：

```
...Where(SqlMethods.Like(r.Name, "%A%") ||
         SqlMethods.Like(r.Name, "%B%") ||
         SqlMethods.Like(r.Name, "%C%") || ...) 
```

A、B、C 等来自某个数组。所以我尝试了以下方法：

```
var roleExpression = Expression.Parameter(typeof(Role), r);
var nameExpression = Expression.Property(roleExpression, "Name");
var termExpression = Expression.Constant("%" + term[i] + "%");
var likeExpression = Expression.Call(
    typeof(SqlMethods), "Like",
    new[] { typeof(string), typeof(string) }, nameExpression, termExpression); 
```

但是，最后一行失败并显示消息*No method 'Like' on type 'System.Data.Linq.SqlClient.SqlMethods' is compatible with the provided arguments*。

所以我尝试了以下行：

```
var likeExpression = Expression.Call(null,
    typeof(SqlMethods).GetMethod("Like", new[] { typeof(string), typeof(string) }),
    nameExpression, searchTermExpression) 
```

这行得通。但是，我不明白这两行之间有什么区别。在我看来，他们应该提供相同的结果。

谁能解释一下？

亲切的问候，
罗纳德·维尔登伯格

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T08:57:27.743

我相信该`Type[]`参数是针对*泛型类型参数*的- 即您试图调用：

```
SqlMethods.Like<string,string>(...); // note the <string,string> 
```

尝试传递一个空的`Type[]`.

* * *

编辑重新混淆（评论）；我的观点是：您不应该为参数指定**任何内容**`Type[]`。空数组或 null 都可以；例如：

```
var likeExpression = Expression.Call(
    typeof(SqlMethods), "Like", null, nameExpression, termExpression); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T12:23:29.167

您可以使用 Joseph Albahari 和 Ben Albahari 的[PredicateBuilder](http://www.albahari.com/nutshell/predicatebuilder.aspx)类来构建您的 where 谓词

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-19T19:52:12.070

答案是下一个：

```
Expression.Call(Nothing, GetType(System.Data.Linq.SqlClient.SqlMethods).GetMethod("Like", New Type() {GetType(String), GetType(String)}), New Expression() {left, right}) 
```

# database - 更多数据是否意味着更慢的查询？

> ID：629364
> 
> 赞同：8
> 
> 时间：2009-03-10T08:57:13.140
> 
> 标签：database, performance

假设我有一个表有 1000 行，而另一个表具有相同的结构/索引但有 1000 万条记录。大表上 CRUD 操作的性能会比小表慢吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T09:29:09.337

取决于数据库引擎，但通常是的，它会更慢，只是因为您必须遍历索引才能找到数据。如果您进行全局更新，它也会变慢，这仅仅是因为您正在更改更多数据。

数据库也经常调整为快速写入或快速读取 - 在第二种情况下，您必须更新索引，这需要更多时间，一旦它很大。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T13:00:37.597

这取决于很多因素，几乎不可能说出来。示例：数据库引擎将数据存储为具有指向字符串的指针的行。出于某种原因，您的 10M 行表仅包含四个不同的字符串。所以你有 10M 指向四个字符串的指针。

用另一个字符串替换一个字符串的更新实际上只会用另一个字符串替换一个字符串；指针将是相同的。也不需要更新索引。无论您有多少行，速度都一样。

除非删除只是将字符串标记为“已删除”，否则删除会更慢。一段时间后运行的清理过程实际上会清理表。但是作为数据库的用户，您不会注意到：删除会立即返回。

Select 会更慢，因为它必须返回更多数据。返回第一行之前的时间很大程度上取决于引擎设计和您的查询。针对 10M 表且索引选择良好的编写良好的查询可能比针对 1K 表且索引错误的查询要快。这取决于服务器上的 RAM 量（也许它可以将整个数据库保存在 RAM 中）、磁盘速度（具有许多可以并行工作的磁盘的 RAID 阵列与具有少量 RAM 和单个磁盘的慢速 PC）。

插入通常较慢，因为您将在 10M 表上拥有更多（和更大）的索引，但如果您没有索引，向 10M 表添加单行通常与添加到小表一样快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T09:01:59.947

这取决于。平均而言，创建、删除和更新会稍微慢一些，因为索引结构更有可能需要重新组织。此外，如果经常从数据库系统请求更多数据，那么您尝试访问的数据不太可能缓存在 RAM 中并且必须从硬盘读取。但是这些差异对于修改查询应该不是很重要。

不过，获取/阅读肯定会更慢。很明显，必须获取、过滤、排序和分组大量数据比处理少量数据要慢。如果您正在处理的数据太大而无法放入机器的 RAM，则尤其如此。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T22:35:07.870

没有索引（或顺序），插入、更新和删除在页面访问方面应该没有显着差异（不包括定位页面时间，这受 SQL 类型和内存缓存大小等影响很大）

索引的类型和数量以及您使用的 SQL 产品会**产生**明显的影响

在顺序键上只有一个整数索引的 10M 行表对于 1000 行和 10M 行的执行非常相似，因为每次插入或删除只会更改一个索引页（99.9% 的时间使用全页索引），并且更新将没有索引变化。10M 行的索引页将适合大多数服务器的缓存

但是 varchar(50) 属性上的索引与 1000 行相比，10M 行可能会慢很多倍，但这是大型索引的成本

不过，1000 万行并不需要太多担心。如果您的行长度为 100 字节，那么整个表将适合 <2GB 的 RAM

如果您担心性能添加更多 RAM，它比尝试手动优化数据库便宜

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T22:43:37.600

当然，但我不确定这是没有任何上下文的非常有用的信息。出于应用程序设计的目的，它通常是您最不关心的问题之一，因为有很多方法可以处理它，而且通常没有很多具有成本效益的替代方案。

你为什么要问？

# .net - Graphics.FromHwnd(IntPtr.Zero) 返回 null，为什么？

> ID：629365
> 
> 赞同：0
> 
> 时间：2009-03-10T08:57:18.413
> 
> 标签：.net, winforms, gdi, devexpress

我目前正在调查我的应用程序中的第 3 方组件 (DevExpress) 的问题。[我的问题与这篇DevExpress 知识库文章](http://www.devexpress.com/Support/Center/p/CB60653.aspx)非常相似。我得到相同的异常，但堆栈跟踪更少。所以我使用 .NET Reflector 来找出在这种情况下可能为 null 的对象，唯一可以为 null 的对象是 Graphics。这是使用 Graphics.FromHwnd(IntPtr.Zero) 创建的。因为我对 GDI 没有广泛的了解，所以我想知道是否有人可以告诉我这可能返回 null 的可能场景......

我试图在 Windows 超出 GDI 句柄的情况下重现它，但随后我得到一个“句柄不足”的情况 - 至少有一次异常，这不是我正在调查的问题的情况

蒂亚，马丁

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-30T03:28:10.430

首先，您正在使用该`IntPtr`结构并将其初始化为零。然后将此句柄传递给 Graphics 类。除非您有一个带有 的窗口，否则`handle == 0`值`null`正是我所期望的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-30T03:34:40.797

据我回忆，HWND 为 0（实际上是 IntPtr.Zero）是当前用户会话桌面的句柄。它可用于衡量系统的各种指标，它应该是 Graphics.FromHwnd 的有效值。

但是，GDI+ 漏洞百出，与它的 .NET 集成非常不稳定，您的代码或 DevExpress 很可能没有任何问题，只是使用了 GDI+。

# asp.net - 从网站中删除框架的解决方案

> ID：629372
> 
> 赞同：0
> 
> 时间：2009-03-10T09:00:53.443
> 
> 标签：asp.net, html, iframe, frames

目前我正在与一个有框架集的预订网站合作。

比方说，40% 来自它自己的网站，因此可以轻松更改为无框架网站。

然而，实际的预订流程来自另一个网站（也由我们维护），并且旨在“生活”它自己，因此第 3 方网站也可以购买/使用预订流程。

现在我的老板想要减少它的框架，但我发现正确嵌入预订流程存在问题，因为我根本不想碰它。

处理它的最佳方法是什么？

*   仅将 iframe 用于预订流程
*   在服务器端解决它到网络请求预订引擎并更改链接或类似的东西。
*   使用 AJAX？但这会影响我认为的很多代码。
*   更好的解决方案？

当然还有时间/金钱问题，但我现在认为这是理所当然的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T09:07:18.907

如果您正在处理另一个站点，最快的方法是使用 IFrame。

它的缺点是，将其高度设置为与其中的内容相同可能是一个技巧，但如果你能解决这个问题，你应该清楚。

仅供参考，我已经成功地将弹出式购买流程（heh PPP）转换为一个非常受欢迎的购买网站的 IFrame：P

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T09:07:16.613

还有两个建议：

1.  使预订引擎“可换肤”，因此不需要使用框架
2.  将 API 添加到可以在服务器端使用的预订引擎（几乎是您上面的第二个选项，但比抓取 HTML 更干净）

我在大量使用 iframe 时看到的问题是，我自己也发现了一个问题，那就是知道它必须呈现的内容的大小。iframe 不会根据其内容调整大小，您必须指定固定的宽度和高度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T09:09:36.530

我知道现在使用框架有一种禁忌，但是在这个网站上，它有什么问题吗？它会给你带来真正的麻烦吗？

由于预订网站应该保持原样，我要么坚持框架，要么使用 iframe。

使用服务器端或 ajax 请求然后解析 html 是自找麻烦。如果预订网站的界面有一点点变化怎么办？

您是否曾用网络服务扩展预订网站？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T09:11:14.153

如果这两个站点存在于不同的域或协议上（预订似乎很可能是 https），那么一个简单的 AJAX 解决方案就出来了，无论如何你都会被简化为代理。

修改 HTML 输出会给您带来大量错误，并且在返回的过程中再次需要代理。

iframe 将满足您的需求，但由于 x 域问题，将流程再次返回到主页可能会出现问题。

考虑到所有事情，我通常希望辅助预订服务*是一项服务*，并且我会在服务器端与之交互。实际上，它需要以一种或另一种方式拥有 API，Web 服务将是我想象的最干净的前进方式。

# regex - 多字节字符串的正则表达式字边界

> ID：629377
> 
> 赞同：3
> 
> 时间：2009-03-10T09:04:06.277
> 
> 标签：regex, unicode

我在我的搜索应用程序上使用 posix c 正则表达式库（regcomp/regexec）。我的应用程序支持不同的语言，包括使用多字节字符的语言。我在使用字边界元字符 (\b) 时遇到问题。对于单字节字符串，它工作得很好，例如：

"\bpaper\b" 匹配 "paper"

但是，如果正则表达式和查询字符串是多字节的，它似乎不能正常工作，例如：

"\b 文件\b" 不匹配"

我错过了什么吗？任何帮助将不胜感激。

要求的信息：

*   编程语言：C
*   正则表达式库：GNU C (regex.h)

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T15:58:02.100

> 如果正则表达式和查询字符串是多字节的，它似乎不能正常工作

在这种情况下，什么是“多字节”？编码为 UTF-8 字节的字符串？特定于语言环境的多字节编码，例如 GB？

如果您不是在本机处理宽（Unicode）字符串，那么除了检测它们的存在之外，您不能期望对非 ASCII 字符有更多的支持。POSIX 正则表达式没有为 ASCII 范围之外的字节指定任何字符类，因此它不知道可以考虑“\xe7\xb4\x99”（“纸”的 UTF-8 表示）中的任何字节单词字母；因此它看不到单词边界。

Unicode 中字母或单词的构成是一个比简单的 ASCII 正则表达式更复杂的问题。（显然，什么构成了中文中的“单词”本身是有争议的。）如果您只想检测普通的旧空格，您可以明确地这样做：

```
(\s|^)紙張(\s|$) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T09:08:59.620

我认为这取决于您使用的库/编程语言以及您的 RegExp 库的配置。可能您必须打开多字节支持，告诉库您正在使用哪种字符编码或相应地编辑区域设置。\b 或 \w 等一些特殊操作取决于这些设置。

# c# - 去除所有 HTML 标记和格式 (RegEx)

> ID：629382
> 
> 赞同：2
> 
> 时间：2009-03-10T09:08:51.133
> 
> 标签：c#, asp.net

我有想要即时修改的 RSS 提要，我只需要文本（和换行符），因此必须删除其他所有内容（所有图像、样式、链接）

如何使用 ASP.NET c# 轻松做到这一点

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T15:22:18.677

正则表达式无法解析 XML。不要使用正则表达式来解析 XML。不要通过围棋。不要收取 200 英镑。

您需要一个合适的 XML 解析器。将 RSS 加载到[XMLDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)中，然后使用[innerText](http://msdn.microsoft.com/en-us/library/system.xml.xmlnode.innertext.aspx)仅获取文本内容。

请注意，即使您从 RSS 中提取了描述内容，它也可以包含活动的 HTML。那是：

```
<description> &lt;em&gt;Fish&lt;/em&gt; &amp;amp; chips </description> 
```

可以，当正确解析为 XML 然后读取为文本时，可以为您提供文字字符串：

```
<em>Fish</em> &amp; chips 
```

或者，标记：

> *炸鱼*薯条

RSS 的有趣之处在于您并不真正知道哪个是正确的。在 RSS 2.0 中，它是明确的 HTML 标记（第二种情况）；在其他版本中没有指定。通常，您应该假设描述*可以*包含实体编码的 HTML 标记，如果您想进一步从最终文本中去除这些标记，则需要第二个解析步骤。

（不幸的是，由于这是遗留的 HTML 而不是 XML，因此更难解析；正则表达式将比解析 XML 更无用。.NET 中没有内置的 HTML 解析器，但有第三方[HTML Agility Pack](http://html-agility-pack.net/?z=codeplex)等库。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T10:06:08.170

```
string pattern = @"<(.|\n)*?>";
return Regex.Replace(htmlString, pattern, string.Empty); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:10:24.433

小心 - 你不想假设你收到的 html 格式正确：

```
public static string ClearHTMLTagsFromString(string htmlString)
{
    string regEx = @"\<[^\<\>]*\>";
    string tagless = Regex.Replace(htmlString, regEx, string.Empty);

    // remove rogue leftovers
    tagless = tagless.Replace("<", string.Empty).Replace(">", string.Empty);

    return tagless;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T11:33:44.920

我在 JavaScript 中以与上述相同的方式为项目执行此操作：

```
var thisText = '';
thisText = document.getElementById('textToStrip').value;
var re = new RegExp('<(.|\\n)*?>', 'igm');
thisText = thisText.replace(re, ''); 
```

# java - 如何通知用户桌面应用程序的重要事件？

> ID：629388
> 
> 赞同：3
> 
> 时间：2009-03-10T09:10:02.440
> 
> 标签：java, winapi, swing, usability, java-native-interface

除了 MS Office 等其他软件外，我们的客户还使用我们的软件（Java Swing 应用程序开始使用 Webstart）来完成他的工作。有时，他必须毫不拖延地在我们的软件中处理重要事件。客户希望有一个突出的通知。现在他可能正在使用 Excel，所以弹出一个消息框是不够的（尽管任务栏中的条目会闪烁）。

我们需要一些类似于 Outlook 通知程序的机制，即始终可见但不会窃取焦点的弹出窗口。通知程序应一直显示，直到消息的原因消失（用户已解决问题）或用户已关闭消息（如在 Outlook 中）。此外，我们希望显示一个托盘图标并可能播放声音。

我已经尝试过 Java6 java.awt.SystemTray 以及 JDIC（版本 0.9，因为我们已经在该项目的类路径中拥有该库）等价物，但我没有找到设置 TrayIcon.displayMessage 超时的方法方法，并且消息似乎并不总是最重要的。

除了 JNI 之外，还有其他选择来实现所请求的行为吗？

如果 JNI 是唯一的选择，并且由于 Windows 是我们客户的唯一平台，那么 Outlook 通知程序是 Outlook 唯一的功能，还是可以通过 Windows API 自由使用？

或者还有哪些其他选项可以通知用户要在一个软件中执行的重要任务，而不会妨碍他在另一个软件中完成当前任务。因此，系统模式对话框是没有选择的！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T11:22:55.007

尝试在您的 JFrame/JWindow 上使用[setAlwaysOnTop 。](http://java.sun.com/javase/6/docs/api/java/awt/Window.html#setAlwaysOnTop(boolean))

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T10:36:18.503

对于 OS X，显而易见的答案是使用[Growl](http://growl.info/)。但是有一个小项目在 Windows 环境中提供类似的服务。它被称为[咆哮](http://www.fullphat.net/)。这可能会给你一个新的尝试选择。

缺点：您必须在客户端的机器上安装一个工具。根据您的描述，我假设您在公司工作场所有一组已定义的用户，对吧？因此，尽管如此，这可能是可以接受的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T10:54:05.530

使用托盘：您使用哪个组件来显示消息（JPopup、JDialog、JFrame、JWindow）？

无论您使用哪种方式，请尝试使其无法聚焦（覆盖`isFocusable`方法）并调用`toFront`.

也让我知道结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T10:59:38.683

如果您有预算，请考虑获得[JIDE](http://www.jidesoft.com/)的许可证。JIDE 有一个警报弹出窗口，其设计看起来与 Outlook 弹出窗口/警报小部件完全一样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T14:30:15.370

这是一个例子：

```
class AlertWindow extends Window implements MouseListener
{
    AlertWindow(JFrame frame)
    {
        super(frame);
        this.setAlwaysOnTop(true);
        this.setFocusable(false);
        this.setSize(200, 200);
        this.setLocation(500, 0);
        this.setBackground(Color.BLACK);
        addMouseListener(this);

        try {
            Class<?> awtUtilitiesClass = Class.forName("com.sun.awt.AWTUtilities");
            Method mSetWindowOpacity = awtUtilitiesClass.getMethod("setWindowOpacity", Window.class, float.class);
            mSetWindowOpacity.invoke(null, this, Float.valueOf(0.50f));
        } catch (NoSuchMethodException ex) {
            ex.printStackTrace();
        } catch (SecurityException ex) {
            ex.printStackTrace();
        } catch (ClassNotFoundException ex) {
            ex.printStackTrace();
        } catch (IllegalAccessException ex) {
            ex.printStackTrace();
        } catch (IllegalArgumentException ex) {
            ex.printStackTrace();
        } catch (InvocationTargetException ex) {
            ex.printStackTrace();
        }
    }

    public void mouseClicked(MouseEvent e)
    {
        this.setVisible(false);
    }

    public void mousePressed(MouseEvent e)
    {
    }

    public void mouseReleased(MouseEvent e)
    {
    }

    public void mouseEntered(MouseEvent e)
    {
    }

    public void mouseExited(MouseEvent e)
    {
    }
} 
```

# svn - 如何在大型团队中保护 i18n 捆绑包的完整性？

> ID：629390
> 
> 赞同：0
> 
> 时间：2009-03-10T09:10:21.877
> 
> 标签：svn, internationalization

我们使用 Subversion 来管理我们的项目文件，包括整个项目中突变率最高的接缝管理的消息包。

开发人员经常在 diff 合并期间读过一行并意外还原一些更改，这通常会在测试过程中溜走。

您采用了哪些实践来确保捆绑包的完整性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T09:16:05.373

您没有提到如何找出破坏捆绑完整性的人。但我猜你可以说出来。我会对破坏构建的人给予这两种惩罚：

*   进行测试以确保中断的原因不会再次发生。
*   构建 X 额外数量的测试。这使他们更熟悉代码并提高构建的可测试性。

# language-agnostic - 您期望的项目经理/团队负责人最重要的品质是什么？

> ID：629391
> 
> 赞同：4
> 
> 时间：2009-03-10T09:10:29.473
> 
> 标签：language-agnostic, project-management

只需阅读[Joel 的软件 - 如何成为项目经理](http://www.joelonsoftware.com/items/2009/03/09.html)。

在他的文章中，他为项目经理指出了不同的事情。

> *   ...（实际上，拥有 14 年的编程经验，您可能知道的太多，无法成为一名优秀的用户倡导者
> *   ...赢得程序员的尊重，让他们承认你是对的
> *   ...作为项目经理，它有助于自己编写代码
> *   ...在任何辩论中表现出智慧、思想开放和公平

作为投票给这个问题的完美观众，你是怎么想的。您认为项目经理的哪些特质

1.  必不可少
2.  不太重要
3.  不必要
4.  不工作

具有。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T09:31:29.457

IMO PM 最重要的技能是保护开发人员免受工作政治的影响。如果客户（无论是内部客户还是外部客户）干扰了开发人员的生产力，那么 PM 就没有做好他们的工作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-10T10:46:40.413

我想说的是，在开发人员遇到问题之前从他们的道路上消除障碍的能力是这种管理类型中最重要的一个方面。

拥有清晰、定义明确的开发路径可以让开发人员无需切换或停止即可找到他们的流程状态。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T09:12:14.383

了解软件估算不是最后期限的项目经理。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-10T16:34:36.223

根据我的经验，项目经理和团队负责人不是同一个人。事实上，在我从事 IT 的 15 年中，我从未有过项目经理担任我的团队负责人。

要回答您的问题，我在**团队负责人中**寻找什么：

*   同情
*   同情
*   业务知识
*   了解我们正在使用的技术
*   耐心
*   良好的指导技巧
*   良好的聆听技巧

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-10T09:34:11.103

在我看来，一个好的项目经理/团队领导能够充当客户、管理层和开发人员之间的油脂，在需要时为每一方（不仅仅是管理层）辩护，并处理阻碍项目前进的障碍，以便开发人员可以集中精力关于发展。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T12:39:54.387

一个我喜欢的很好的管理方法是 MBWA（不要与 MBA 混为一谈）。这意味着通过四处走动进行管理。听起来可能有点奇怪，但想想……

看看这个链接（作为许多可用的链接之一）：[http ://www.businesstown.com/people/communication-walking.asp](http://www.businesstown.com/people/communication-walking.asp)

...当然，这不适用于每个经理和项目...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T16:23:24.770

我不想告诉你这个，但最重要的属性是他们的沟通能力；把手放下。如果他们不能很好地沟通，他们就无法消除障碍，也无法在利益相关者和行动者之间进行转换。

沟通之后是组织/计划能力和工具知识；当然还有领域知识（BS检测器，以及对项目的一般理解，而不必问......一直都是什么。）

没有这三样东西，你就处于劣势。

因此，我同意 Joel 的观点，即具有编程背景对于项目经理/项目经理来说是必不可少的——尤其是对于软件等无形的东西。但是，您必须有 10 年或 15 年的经验吗？不，在地板上呆了几年应该足够让你明白。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T10:23:01.563

辨别好坏的能力，我们随便称之为“质量”。其他一切都随之而来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-10T16:31:21.163

队长：

*   沟通
*   领导/推动团队的能力（很多人不能）
*   能够编码和理解任何团队成员编写的任何代码
*   永远不应该对他的经验水平撒谎（我目前的情况，不能相信他做出的决定是正确的......）

# windows - 在 .NET2.0 windows 应用程序中实现键盘快捷键

> ID：629407
> 
> 赞同：0
> 
> 时间：2009-03-10T09:17:46.947
> 
> 标签：windows, .net-2.0, keyboard-shortcuts

是否有任何框架可用于在 .NET2.0 Windows 应用程序中实现键盘快捷键？另外，在执行此操作时应注意哪些最佳实践？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T10:03:43.620

尽管没有明显的方法可以为不在菜单中的命令提供加速键，但添加这些并不是很难。有五个基本步骤：

*定义加速器枚举。*

```
private enum Accelerators { Unspecified = 0, Home, Save, Print, Logout }; 
```

*创建一个哈希表以包含枚举值。*

```
Hashtable _accelHash() =  new Hashtable(); 
```

*创建一个类来表示加速键。*

*使用 Keys 枚举加载表。*

```
_accelHash.Add(new AcceleratorKey(Keys.Alt|Keys.H),
                                  Accelerators.Home);
_accelHash.Add(new AcceleratorKey(Keys.Alt|Keys.S),
                                  Accelerators.Save);
_accelHash.Add(new AcceleratorKey(Keys.Alt|Keys.P),
                                  Accelerators.Print);
_accelHash.Add(new AcceleratorKey(Keys.Alt|Keys.X),
                                  Accelerators.Logout); 
```

*最后，重写 ProcessCmdKey 并使用 switch 语句调度到正确的方法。*

```
protected override bool ProcessCmdKey(ref Message msg,
                                      Keys keyData)
{
    ...
} 
```

或者，对于稍微复杂的方法，您可以将哈希表映射到您想要调用的方法的委托，只要它们都具有相同的方法签名。

[这是一篇简短的文章](http://www.codeguru.com/columns/experts/article.php/c4639)，更详细地概述了上述步骤。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T10:04:11.093

实现快捷键的一种常见方法是在键盘事件中检测它们，例如 KeyDown 或 KeyUp。

例子

```
public void Form1_KeyUp(object sender,KeyEventArgs e)
{
if (e.Control && e.KeyData==Keys.A)
{
//handle ctrl+a
} 
```

# css - CSS IE7 慢覆盖

> ID：629408
> 
> 赞同：0
> 
> 时间：2009-03-10T09:17:54.997
> 
> 标签：css, internet-explorer-7, overlay

当我按下一个按钮时，会出现一个叠加层。在 Firefox 中，覆盖速度很快，没什么特别的。但在 IE7 中，覆盖非常慢。我想知道为什么？

这是我的CSS：

```
.DocOverlayShow
{
    background: url("/Graphics/overlay bg.png");
    top:0px; 
    left:0px; 
    width:100%; 
    position:fixed; 
    padding:10px; 
}
.DocAddCommentBox
{
    color: #000;
    margin:0 auto;
    margin-top: 200px;
    width: 650px;
} 
```

当我点击一个按钮时，覆盖被激活。IE 中的一切工作正常，但覆盖太慢了。有什么想法怎么来的？

编辑：当我使用不透明度和过滤器时，这个 div 上的所有内容也是透明的。这是我不想要的。在覆盖 div 我有另一个 div (DocAddCommentBox)。这个 div 可能没有透明度。我该如何解决这个问题？

编辑：解决方案：

```
.DocOverlayShow
{
    background-color: #0057C3;
    Opacity:0.5;
    filter: alpha(opacity=50); /*IE*/
    top:0px; 
    left:0px; 
    width:100%; 
    height: 100px;
    position:fixed; 
    padding:10px; 
    z-index: 1000;
}
.DocAddCommentBox
{
    background-color: #DBDBDB;
    color: #000;
    position: fixed;
    margin:0 auto;
    margin-top: 150px;
    width: 450px;
    z-index:2000;
} 
```

在html中我使用过：

```
<div class="DocOverlayShow"></div>
<div class="DocAddCommentBox">Content</div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T09:22:44.093

您的 overlay.png 是否具有 Alpha 通道/透明度？如果是这样，请在没有透明度的情况下尝试。从记忆中，IE 在渲染这些东西时速度非常慢。

我要做的是使用 CSS 来实现透明度。

像这样设置不透明度：

```
Opacity:0.5; 
```

不幸的是，IE 不支持它，所以我们还必须使用自定义 IE 属性：

```
filter: alpha(opacity=50); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-31T09:37:58.623

你不需要 opacity 语法，你需要做的就是让你的透明图像大于 1px 或 2px，最小 20px 就可以了。主要是，带有背景重复的图像，特别是那些有很多重复以填充空白空间的图像，它们会使您的 IE7 比其他图像慢得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:05:00.187

这是我在项目中使用的叠加层的 CSS：

```
#siteol {
  position: absolute;
  z-index:10000;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  background-color: #000;
  opacity: 0.7;
}

<!--[if IE]>
/* style for IE */
<style type="text/css">
#siteol  {
  filter: alpha(opacity=70);
}
</style>
<![endif]--> 
```

只是摆脱PNG。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-19T20:36:43.473

我遇到了完全相同的问题，并且以下解决方案完美地工作，而无需使用额外的不透明度属性。它仍然需要 IE 使用过滤器，但对我来说感觉更干净。

```
background-color: rgba(244, 244, 244, 0.6);
filter: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#7ff4f4f4', EndColorStr='#7ff4f4f4'); 
```

可以在下面找到对 IE 过滤器渐变技巧和不在背景上使用不透明度属性的好处的一个很好的解释

[http://robertnyman.com/2010/01/11/css-background-transparency-without-affecting-child-elements-through-rgba-and-filters/](http://robertnyman.com/2010/01/11/css-background-transparency-without-affecting-child-elements-through-rgba-and-filters/)

# ios - 如何在 iPhone 上绘制透明笔触（或清除图像的一部分）

> ID：629409
> 
> 赞同：19
> 
> 时间：2009-03-10T09:18:14.293
> 
> 标签：ios, objective-c, draw, touches

我有一个小应用程序，允许用户用手指在屏幕上绘图。通过创建一个和各种功能，我有一个`UIImageView`用户绘制的地方。我主要用函数画笔画/线条`CGContextRef``CG draw``CGContextAddLineToPoint`

现在我的问题是：用户可以绘制各种颜色的线条。我想让他能够使用`"rubber"`工具删除到目前为止绘制的图像的某些部分，用手指。我最初通过使用白色作为笔划（使用`CGContextSetRGBStrokeColor`函数设置）来做到这一点，但它没有成功......因为我后来发现`UIImage`实际上`UIImageView`有一个透明背景，而不是白色......所以我会最终得到一个带有白线的透明图像！

无论如何设置`"transparent"`笔触颜色还是有任何其他方法可以清除`CGContextRef`用户手指下的内容，当他移动它时？谢谢

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2010-04-27T18:29:18.497

这可以解决问题：

```
CGContextSetBlendMode(context, kCGBlendModeClear) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-04T05:33:40.077

我最终使用了 Bresenham 的线算法（回想起以前我必须编写自己的图形例程的日子）......

```
- (void) contextEraseLine:(CGContextRef) ctx from:(CGPoint)startPoint to:(CGPoint) endPoint withThickness:(int)thickness {
    int x, cx, deltax, xstep,
    y, cy, deltay, ystep,
    error, st, dupe;

    int x0, y0, x1, y1;

    x0 = startPoint.x;
    y0 = startPoint.y;
    x1 = endPoint.x;
    y1 = endPoint.y;

    // find largest delta for pixel steps
    st = (abs(y1 - y0) > abs(x1 - x0));

    // if deltay > deltax then swap x,y
    if (st) {
        (x0 ^= y0); (y0 ^= x0); (x0 ^= y0); // swap(x0, y0);
        (x1 ^= y1); (y1 ^= x1); (x1 ^= y1); // swap(x1, y1);
    }

    deltax = abs(x1 - x0);
    deltay = abs(y1 - y0);
    error  = (deltax / 2);
    y = y0;

    if (x0 > x1) { xstep = -1; }
    else         { xstep =  1; }

    if (y0 > y1) { ystep = -1; }
    else         { ystep =  1; }

    for ((x = x0); (x != (x1 + xstep)); (x += xstep))
    {
        (cx = x); (cy = y); // copy of x, copy of y

        // if x,y swapped above, swap them back now
        if (st) { (cx ^= cy); (cy ^= cx); (cx ^= cy); }

        (dupe = 0); // initialize no dupe

        if(!dupe) { // if not a dupe, write it out
            //NSLog(@"(%2d, %2d)", cx, cy);

            CGContextClearRect(ctx, CGRectMake(cx, cy, thickness, thickness));

    }

        (error -= deltay); // converge toward end of line

        if (error < 0) { // not done yet
            (y += ystep);
            (error += deltax);
        }
    }
} 
```

呸！要创建一条（有点）笨重的橡皮擦线，还有很长的路要走。

要使用它，请执行以下操作：

```
- (void)eraseStart {
    // erase lines
    UIGraphicsBeginImageContext(drawingBoard.size);
    ctx = UIGraphicsGetCurrentContext();
    CGContextDrawImage(ctx,CGRectMake(0,0,drawingBoard.size.width, drawingBoard.size.height),[drawingBoard CGImage]); 
}

- (void)eraseEnd {
    drawingBoard = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    [drawingView removeFromSuperview];
    [drawingView release];

    drawingView = [[UIImageView alloc] initWithImage:drawingBoard];
    drawingView.frame = CGRectMake(intEtchX, intEtchY, intEtchWidth, intEtchHeight);

    [self.view addSubview:drawingView];
} 
```

这假设您已经创建了一个绘图视图 (UIImageView) 和绘图板 (UIImage)。

然后，要擦除一行，只需执行以下操作：

```
CGContextRef ctx = UIGraphicsGetCurrentContext();
[self eraseStart];
[self contextEraseLine:ctx from:CGPointMake (x1, y1) to:CGPointMake (x2, y2) withThickness:10];
[self eraseEnd]; 
```

（用适当的值替换 x1、y1、x2 和 y2）...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-30T20:59:24.487

我试过使用：

```
CGContextSetStrokeColorWithColor (myContext, [[UIColor clearColor] CGColor]); 
```

但这不起作用，因为它似乎是在上下文之上用一种不可见的颜色“绘制”（和不可见的颜色+它正在绘制的任何颜色=它正在绘制的颜色）。

我找到的唯一解决方案（不是最佳的）是：

```
CGContextClearRect (myContext, CGRectMake(x, y, width, height)); 
```

不幸的是，这意味着您必须跟踪一系列矩形并自己生成线条......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-28T14:01:08.453

如果您想通过触摸擦除图像，这是我的代码....不推荐的 unerase 部分可以正常工作，但速度稍慢。

```
func addNewPathToImage(){
    print("Start erasing or not erasing")

    UIGraphicsBeginImageContextWithOptions(TopImageUIImageView.bounds.size, false, UIScreen.main.scale) // or 0 for the scale

//My image is aspect fit so I need to get rect

    let aspect = TopImageUIImageView.image!.size.width / TopImageUIImageView.image!.size.height
    let viewRatio = TopImageUIImageView.bounds.size.width / TopImageUIImageView.bounds.size.height

    if aspect < viewRatio {
        let scale = TopImageUIImageView.bounds.size.height / TopImageUIImageView.image!.size.height
        let width = scale * TopImageUIImageView.image!.size.width
        let topLeftX = (TopImageUIImageView.bounds.size.width - width) * 0.5
        rect = CGRect(x: topLeftX, y: 0, width: width, height: TopImageUIImageView.bounds.size.height)
    }
    else {
        let scale = TopImageUIImageView.bounds.size.width / TopImageUIImageView.image!.size.width
        let height = scale * TopImageUIImageView.image!.size.height
        let topLeftY = (TopImageUIImageView.bounds.size.height - height) * 0.5
        rect = CGRect(x: 0.0, y: topLeftY, width: TopImageUIImageView.bounds.size.width, height: height)
    }
    ////
    context = UIGraphicsGetCurrentContext()
    TopImageUIImageView.image?.draw(in: rect)
    context?.setLineCap(.round)
    context?.setLineWidth(brushSize)

    if isErasing == true {

        context?.setShadow(offset: CGSize(width: 0, height: 0), blur: blurNumber)
        context?.setStrokeColor(UIColor.white.cgColor)
        context?.setBlendMode(.clear)

    }else{

        print("test the unerase image .... ?")
        context?.setStrokeColor(UIColor.init(patternImage: topImage.af_imageAspectScaled(toFit: CGSize(width: TopImageUIImageView.bounds.size.width, height: TopImageUIImageView.bounds.size.height))).cgColor)

    }

   // I am using these because I am using touch to define what to erase 
        context?.move(to: CGPoint(x: lastTouch.x, y: lastTouch.y))
        context?.addLine(to: CGPoint(x: currentTouch.x, y: currentTouch.y))
        context?.strokePath()
        context?.closePath() // when add this line or the "context?.beginPath" get ERROR CGContextClosePath: no current point.
        print("close the path")

        //get your image 
        let image = UIGraphicsGetImageFromCurrentImageContext()
        UIGraphicsEndImageContext()
        TopImageUIImageView.image = image

} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2011-08-24T15:25:09.580

```
//erase part
if(mouseSwiped)
{

//**************Working Code*************// 

UIGraphicsBeginImageContext(frontImage.frame.size);
[frontImage.image drawInRect:CGRectMake(0, 0, frontImage.frame.size.width, frontImage.frame.size.height)];
CGContextSetLineCap(UIGraphicsGetCurrentContext(),kCGImageAlphaNone); //kCGImageAlphaPremultipliedLast);
CGContextSetLineWidth(UIGraphicsGetCurrentContext(), 10);
CGContextSetRGBStrokeColor(UIGraphicsGetCurrentContext(), 1, 0, 0, 10);
CGContextBeginPath(UIGraphicsGetCurrentContext());
CGContextMoveToPoint(UIGraphicsGetCurrentContext(), lastPoint.x, lastPoint.y);
CGContextClearRect (UIGraphicsGetCurrentContext(), CGRectMake(lastPoint.x, lastPoint.y, 10, 10));
CGContextStrokePath(UIGraphicsGetCurrentContext());
frontImage.image = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();

lastPoint = currentPoint;

mouseMoved++;

if (mouseMoved == 10) 
{
    mouseMoved = 0;
}
} 
```

* * *

## 回答 #6

> 赞同：-13
> 
> 时间：2009-03-10T14:07:26.173

```
UIColor *clearColor = [UIColor clearColor]; 
```

# visual-studio-2005 - Visual Studios 2005 中的匹配括号

> ID：629410
> 
> 赞同：2
> 
> 时间：2009-03-10T09:18:29.253
> 
> 标签：visual-studio-2005

在为 linux 进行开发时，我有一个 vim 文件，它可以更改匹配括号的颜色。

例如，给定以下行：

```
if( (foo / 12 == 4) && arr[i] == 2 ) {}
```

打开和关闭 if 语句的括号可能是红色的，保存 foo 语句的括号可能是蓝色的，保存数组索引的括号可能是绿色的，大括号是浅棕色的。

这样的工具使复杂的控制语句更容易理解，而手动查看匹配内容的日子已经过去了。

VS 2005 中是否有此类功能的选项？我无法为提供此类功能的任何工具付费，因此如果有内置选项或免费插件，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T09:29:25.467

我不知道究竟有什么东西可以做到这一点，但我会提请您注意内置的功能。当您键入可以匹配的字符（例如近括号）时，它会简要突出显示匹配特点。组合键 ctrl-] 将带您在匹配的字符之间。

# c# - 什么时候图书馆应该被称为“Linq-something”或“something-Linq”？

> ID：629411
> 
> 赞同：3
> 
> 时间：2009-03-10T09:18:47.787
> 
> 标签：c#, .net, linq, extension-methods

我只是查看了其中一个具有命名模式“something-Linq”的库，希望获得更多关于如何以优雅的方式构建表达式树的知识 - 并且感到失望。因为我能找到的只是扩展 IEnumerable 的方法——当然是使用“普通”C# 代码。

现在我有这个问题： IEnumerable 的非表达式扩展真的证明库的名称中有“Linq”吗？还是作者只是在大肆宣传，试图为他的 IEnumerable 扩展库获得更多下载，而当在库的名称中看到“Linq”时，我期待 IQueryable 和表达式是正确的？

编辑：

我认为 Linq-to-... 和 something-Linq 库之间存在差异。恕我直言 Linq-to-... 是 linq 提供程序库，something-Linq 是 linq 扩展。我认为 Linq 提供程序库可以选择是否在其结果中公开 IQueryable 或 IEnumerable - linq 扩展没有这种选择。就我而言，他们必须能够使用这两种提供程序库。这对我来说意味着所有 linq 扩展都必须提供 Queryable 和 Enumerable 扩展。

编辑2：

乔恩和我在他的回答评论中进行了非常热烈的讨论。我自愿创建了一篇博文，希望能澄清一些事情： [绘制 LINQ 的未知水域](http://saftsack.fs.uni-bayreuth.de/~dun3/archives/mapping-the-unchartered-waters-of-linq/253.html)

编辑3：

对于任何对讨论感兴趣的人——我真的鼓励你去我的博客文章。跳过帖子本身，因为它很可怕 - 直接进入 Jon 的讨论和解释。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T09:26:56.487

LINQ 对我来说并不意味着表达式树。它意味着以 LINQ 的一般风格进行数据访问。LINQ to Objects 中没有任何表达式树，但绝对是 LINQ IMO。

LINQ to XML 有点似是而非——它实际上只是一个`IEnumerable<T>`以各种方式公开的 XML API，既作为输入又作为输出。这意味着它与 LINQ to Objects 一起工作得非常好，但它本身并没有实现任何标准运算符。但是，您通常*将*它与 LINQ to Objects 一起使用，结果是“类似 LINQ”的代码，所以我想这还不错。

对于非表达式扩展被称为 LINQ-to-whatever，我当然没有任何问题——事实上，考虑到我的[MoreLINQ](http://code.google.com/p/morelinq/)和[Push LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)项目，这种立场是虚伪的。

对我来说有两个主要问题：

*   API 是关于数据访问和处理的吗？
*   它是否试图使访问/处理流畅，理想情况下（但不一定）符合查询表达式模式，以启用 VB9 和 C#3 的语言特性来帮助编写可读代码？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T09:20:40.590

简答：**营销噱头**

人们使用术语“Linq-something”或“something-linq”作为营销噱头，让客户/开发人员了解库是什么。这节省了营销人员（或文档开发人员）解释库功能的时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T09:40:30.200

LINQ 对每个人都意味着不同的东西（当它被用来标记所有东西时必然会发生）：

*   通过在嵌入式 DSL 中表达查询来访问数据库的便捷方式。
*   支持在运行时分析和转换代码的语言特性。
*   使用受惰性函数式编程语言启发的技术单元处理列表。
*   使用...同上处理*任何事情。*

到目前为止（对我而言）其中最有用的是函数式编程部分，但我只是将其称为函数式编程以避免混淆。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:10:20.187

与 Linq 相关的一切都只是“普通”的 C# 代码，主要是 IEnumerable 的扩展。

编辑： StackOverflow 似乎想隐藏我实际上在上面说的 IEnumerable < T >。它与 Linq 不兼容！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T09:25:01.950

是的，大量炒作似乎是游戏的名称

“以优雅的方式构建表达式树”也是矛盾的

好的 LINQ 的好例子并不多

Linq to Sharepoint 项目总比没有好

[http://linqtosharepoint.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=8713](http://linqtosharepoint.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=8713)

# c# - 在 C# 上使用缓存（包括 VB 代码）

> ID：629412
> 
> 赞同：0
> 
> 时间：2009-03-10T09:20:27.720
> 
> 标签：c#, asp.net

如何以与以下 VB 代码类似的方式使用 Web 服务器缓存：

```
 ////  FindData() returns real data
   //// FindCached() returns from cache (kept 20 minute)

    Protected Function RegisterCachedData(ByVal id As String) As Integer
        Dim onCacheRemove As CacheItemRemovedCallback
        onCacheRemove = New CacheItemRemovedCallback(AddressOf Me.CheckCallback)
        Cache.Insert("AverageData", FindData(1), Nothing, DateTime.Now.AddMinutes(20), TimeSpan.Zero, 1, onCacheRemove)
    End Function

    Sub CheckCallback(ByVal str As String, ByVal obj As Object, ByVal reason As CacheItemRemovedReason)
        RegisterCachedData(0)
    End Sub

   Protected Function FindCached() As Integer
        If Cache.Get("AverageData") Is Nothing Then RegisterCachedData(0)
        Return Cache.Get("AverageData")
    End Function 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T09:23:28.320

Asp.Net 就是 Asp.Net，不管你使用什么语言。你可以用 VB.Net 做的事情也可以用 C# 来做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T09:33:17.110

一样的方法。这应该这样做：

```
protected int RegisterCachedData(string id) {
   CacheItemRemovedCallback onCacheRemove;
   onCacheRemove = new CacheItemRemovedCallback(CheckCallback);
   Cache.Insert("AverageData", FindData(1), null, DateTime.Now.AddMinutes(20), TimeSpan.Zero, 1, onCacheRemove);
}

void CheckCallback(string str, object obj, CacheItemRemovedReason reason) {
   RegisterCachedData("0");
}

protected int FindCached() {
   if (Cache.Get("AverageData") == null) RegisterCachedData("0");
   return Cache.Get("AverageData");
} 
```

# c# - 添加参考

> ID：629414
> 
> 赞同：1
> 
> 时间：2009-03-10T09:20:47.110
> 
> 标签：c#

如何以编程方式将程序集 (DLL) 添加为 C# 项目中的引用？我需要在运行时添加引用。

考虑如果我的项目使用另一个类库 (DLL)，那么我需要将该 DLL 作为引用添加到我的项目中。我怎样才能在运行时做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T09:33:30.387

我猜你想在运行时加载一个类型？您可以使用 Assembly.Load 和反射来执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:14:54.417

可能您想从另一个 .dll 中的类中获取[类型信息](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)，然后[创建](http://msdn.microsoft.com/en-us/library/wccyzw83.aspx)该类的对象实例。

```
var lateBindingType = Type.GetType("Name.Of.The.Class,NameOfDll");
var instance = Activator.CreateInstance(lateBindingType); 
```

在对 Type.GetType 的调用中，您使用[完全限定的类型名称](http://msdn.microsoft.com/en-us/library/yfsftwz6.aspx)。

# .net - ORM 之于 RDBMS 就像 xxx 之于 OLAP 多维数据集？xxx存在吗？

> ID：629425
> 
> 赞同：5
> 
> 时间：2009-03-10T09:25:24.743
> 
> 标签：.net, orm, rdbms, olap

是否有用于查询 OLAP 多维数据集/数据仓库的 ORM 类比？我对 .NET 世界特别感兴趣，但通常对任何事情都感兴趣；-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T17:17:01.723

我已经启动了一个开源项目 Kona，以包装 ADOMD.Net 库，并尝试将 ADOMD.Net 带入 21 世纪。您可以在[http://www.codeplex.com/kona](http://www.codeplex.com/kona)获取它，但它确实需要更多的爱和关注。

将 lambdas 转换为 MDX 的任务并不小，所以我什至还没有尝试过。我试图鼓励 MSFT 编写一个 LINQ to MDX 提供程序，但考虑到实际上很少有 .Net 开发人员正在尝试使用 OLAP/SSAS（在 SSRS 空间之外），我认为这对任何人来说都不会很高目前的优先级列表。但这并不意味着停止尝试。我一直在本地用户组和 Code Camp 上做“.Net Guy 的 BI”演讲，试图传播爱。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T22:10:51.873

ADOMD 将让您自己动手。我还没有看到任何好的库，它可以为结果集提供简单的 API，可能是由于 Analysis Services 和 MDX 的性质？

[http://msdn.microsoft.com/en-us/library/ms123483.aspx](http://msdn.microsoft.com/en-us/library/ms123483.aspx)

我一直在寻找更好的，所以如果有人有任何解决方案，我会全力以赴。目前，为了快速开发，我正在使用 SQL Server 通过链接服务器将 MDX 查询发送到 SSAS，然后将其作为 SQL Server 的存储过程输出返回，因为任何人都可以处理它。我遇到的问题是缺乏调试，如果行丢失它错误，所以尝试/捕获特定错误号，如果没有则重新抛出。

# c# - 为 C# 安装 coderush 后实现界面功能消失

> ID：629427
> 
> 赞同：0
> 
> 时间：2009-03-10T09:26:08.283
> 
> 标签：c#, visual-studio, coderush

在看到一些关于 CodeRush C# 的好建议后，我决定试一试。安装后，加载 VS2008SP1 需要更长的时间

但更糟糕的是，许多默认功能消失了所有`ctrl +`功能都消失了。没有更多的*实现接口*:(

卸载它，加载时间恢复正常，图标仍在闪屏，`ctrl +`功能仍然损坏。我已经感觉到裤子里的蚂蚁了！:@

我觉得还有更多。有人可以向我解释出了什么问题吗？

卸载在我的硬盘上留下了一个 dll。删除它，在 Visual Studio 中重置我的设置。重新启动并恢复正常。不知道出了什么问题，也不知道究竟是什么解决了它。在那个炸弹壳上，我要关闭这个条目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T13:27:35.723

Coderush installs it's own keystroke manager which sits above the IDE's keystroke selection. The Coderush keystroke management system is in theory more context sensitive than its VS counterpart. This means that Coderush will intercept everything but will pass the keystrokes on to VS if it's context requirements are not met.

You can view the keystrokes which Coderush has specific bindings for through the DevExpress menu..

They are available from DevExpress\Options....IDE\Shortcuts..

Also you can disable or reassign any of these which get in your way.

Could you please detail the specific Keystroke(s) you are having difficulty with?

If you would like some extended help with Coderush (And this offer is good for anyone), feel free to email me (RoryBecker@Gmail.com) and I'll do my best to help you.

I don't work for DevExpress but do have a day-job (for now :P), but if I can help then I will.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T10:09:51.937

关闭 Visual Studio 的所有实例并尝试通过从 Start->Run 运行“devenv /ResetSettings”来重置 VisualStudio

**记住：**在重置 Visual Studio 之前备份您当前的设置

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T09:48:23.097

尝试在 Visual Studio 中重置您的键绑定。我不能为 CodeRush 说话，但 ReSharper 在覆盖它们之前会询问。

# c++ - 如何在 C++ 中初始化嵌套结构？

> ID：629433
> 
> 赞同：14
> 
> 时间：2009-03-10T09:28:21.630
> 
> 标签：c++, data-structures, initialization, nested, structure

我在一个程序中创建了几个不同的结构。我现在有一个带有嵌套结构的结构，但是我无法弄清楚如何正确初始化它们。下面列出了这些结构。

```
/***POINT STRUCTURE***/
struct Point{
    float x;                    //x coord of point
    float y;                    //y coord of point
};

/***Bounding Box STRUCTURE***/
struct BoundingBox{
    Point ymax, ymin, xmax, xmin;
};

/***PLAYER STRUCTURE***/
struct Player{
    vector<float> x;            //players xcoords
    vector<float> y;            //players ycoords
    BoundingBox box;
    float red,green,blue;       //red, green, blue colour values
    float r_leg, l_leg;         //velocity of players right and left legs
    int poly[3];                //number of points per polygon (3 polygons)
    bool up,down;               
}; 
```

然后我尝试初始化一个名为 player 的新创建的 Player 结构。

```
//Creates player, usings vectors copy and iterator constructors
Player player = { 
vector<float>(xcords,xcords + (sizeof(xcords) / sizeof(float)) ), //xcords of player
vector<float>(ycords,ycords + (sizeof(ycords) / sizeof(float)) ), //ycoords of playe
box.ymax = 5;               //create bounding box
box.ymin = 1;
box.xmax = 5;
box.xmin = 1;
1,1,1,                      //red, green, blue
0.0f,0.0f,                  //r_leg,l_leg
{4,4,4},                    //number points per polygon
true,false};                //up, down 
```

这会导致几个不同的错误，关于 box. 在“。”之前说明该框没有明确的标识符并且缺少结构或语法。

然后我尝试创建一个 Player 结构并初始化它的成员，如下所示：

```
Player bob;
bob.r_leg = 1; 
```

但这会导致更多错误，因为编译器认为 bob 没有标识符或缺少某些语法。

我用谷歌搜索了这个问题，但没有找到任何文章向我展示如何在（父）结构中初始化嵌套结构的许多不同成员。对此主题的任何帮助将不胜感激:-) !!!

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-10T09:35:58.820

您通常使用以下命令对其进行初始化`{ ... }`：

```
Player player = { 
  vector<float>(xcords,xcords + (sizeof(xcords) / sizeof(float)) ),
  vector<float>(ycords,ycords + (sizeof(ycords) / sizeof(float)) ),
  5, 1, 5, 1, 5, 1, 5, 1, 
  1.0f,1.0f,1.0f,                         //red, green, blue
  0.0f,0.0f,                              //r_leg,l_leg
  {4,4,4},                                //number points per polygon
  true,false
}; 
```

现在，这是使用“大括号省略”。一些编译器对此提出警告，即使它是完全标准的，因为它可能会使读者感到困惑。最好添加大括号，这样就很清楚在哪里初始化了什么：

```
Player player = { 
  vector<float>(xcords,xcords + (sizeof(xcords) / sizeof(float)) ),
  vector<float>(ycords,ycords + (sizeof(ycords) / sizeof(float)) ),
  { { 5, 1 }, { 5, 1 }, { 5, 1 }, { 5, 1 } }, 
  1.0f, 1.0f, 1.0f,               //red, green, blue
  0.0f, 0.0f,                     //r_leg,l_leg
  { 4, 4, 4 },                    //number points per polygon
  true, false
}; 
```

如果您只想初始化`x`点的成员，则可以通过省略其他初始化程序来实现。聚合（数组，结构）中的剩余元素将被初始化为“正确”值 - 因此，a`NULL`用于指针，a`false`用于 bool，零用于 int 等等，并且大致使用用户定义类型的构造函数。初始化点的行看起来像这样

```
{ { 5 }, { 5 }, { 5 }, { 5 } }, 
```

现在您可以看到使用大括号省略的危险。如果您向结构添加一些成员，所有初始化程序都会“分开”它们应该初始化的实际元素，并且它们可能会意外地碰到其他元素。所以你最好总是在适当的地方使用大括号。

不过考虑使用构造函数。我刚刚完成了您的代码，展示了如何使用大括号括起来的初始化程序来完成它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T09:30:26.667

您可以将默认值添加到结构中，如下所示：

```
struct Point{
   Point() : x(0), y(0)
     { };

   float x;
   float y;
}; 
```

或者

```
struct Point{
   Point() 
     { 
       x = 0;
       y = 0;
     };

   float x;
   float y;
}; 
```

要在构造过程中添加这些值，请向构造函数添加参数，如下所示：

```
struct Point{
   Point(float x, float y) 
     { 
       this->x = x;
       this->y = y;
     };

   float x;
   float y;
}; 
```

并用这些实例化它们：

```
Point Pos(10, 10);
Point *Pos = new Point(10, 10); 
```

这也适用于您的其他数据结构。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T09:48:14.750

看起来边界框应该只包含浮点数，而不是点？

这就是说这可能有效：

```
Player player = { 
vector<float>(xcords,xcords + (sizeof(xcords) / sizeof(float)) ), //xcords of player
vector<float>(ycords,ycords + (sizeof(ycords) / sizeof(float)) ), //ycoords of playe
{{1.0,5.0},{1.0,5.0},{1.0,5.0},{1.0,5.0}},
1,1,1,                                          //red, green, blue
0.0f,0.0f,                              //r_leg,l_leg
{4,4,4},                                //number points per polygon
true,false}; 
```

（未经测试）...

# c# - YouTube API 集成 ASP.NET - 单页上传视频

> ID：629435
> 
> 赞同：6
> 
> 时间：2009-03-10T09:29:10.913
> 
> 标签：c#, asp.net, youtube-api

我们正在尝试使用 Google YouTube API 直接通过浏览器将视频从我们的网站上传到 YouTube。

该 API 分两步工作，第一步我们需要创建一个包含所有元数据（如标题、标签、描述、类别等）的 Video 对象。然后我们需要向 YouTube 发送带有此对象的请求并生成一个 Token 对象作为回应。这个令牌对象有一个令牌值和一个令牌 URL 作为它的成员。

在第二步中，他们建议我们应该创建一个将 action 属性设置为 Token URL 的表单。这个表单应该有一个文件上传控件和一个以 Token Value 作为其值的隐藏字段。发布此表单后，它会将视频上传到 YouTube。

如果我们将其作为一个两步过程，首先向用户询问元数据，然后将他们重定向到第二页以进行实际视频上传，这将非常有效。但是，我们试图在一个页面中完成此操作，向用户显示为一个步骤。

我们有一个 MasterPage，其中指定了“aspnetForm”，因此我们不能拥有另一个具有`runat='server'`属性的表单。

我们已经尝试使用 JavaScript/code-behind 修改 aspnetFrom 的 action 属性，但无论我们做什么，它都保持不变。

我们还尝试放置另一个嵌套表单，在收到来自 YouTube 的第一个带有令牌的响应后，其动作标签将设置在按钮单击事件上。但即使这样也行不通，因为在调用此方法时还没有创建表单。

我们已经尝试了几种方法，但似乎都没有奏效。任何关于此的建议都会很棒。

如果您还有任何问题要清楚地了解情况..请告诉我..

* * *

更新：

谢谢你们的回应。

我们稍微改变了业务逻辑来解决这个问题。很久以前，我现在还没有寻找解决方案..

然而，这个问题仍然是开放的，并得到了回应。我真的很感谢所有的帮助，因此，将把这个问题留给任何进一步的讨论。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-11T10:08:10.800

[http://code.google.com/apis/youtube/2.0/developers_guide_dotnet.html#Direct_Upload](http://code.google.com/apis/youtube/2.0/developers_guide_dotnet.html#Direct_Upload)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-21T10:10:08.220

我将创建一个向用户显示的表单，其中包含元数据的文本字段和视频的文件上传控件。

然后在处理回发的代码中，您可以将元数据提交到 YouTube API 以获取令牌值。

然后，您制作一个[HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)，并将令牌值传递到对象的`Create`方法中，并将属性设置为. 然后，您添加上传的视频（有关详细信息，请参阅[evil 博士对“使用 HTTPWebrequest（multipart/form-data）上传文件”的回答](https://stackoverflow.com/questions/566462/upload-files-with-httpwebrequest-multipart-form-data/567460#567460)），当您调用时，您的文件将被提交。`WebRequest``Method``Post``GetResponse()`

需要注意的事项：

1.  `ScriptTimeout`：如果您允许您的用户将大文件上传到 YouTube - 如果您需要一段时间才能传输它，那么您的脚本可能会过早终止。
2.  带宽：您将同时上传到您的服务器，然后上传到 YouTube - 通过允许用户在两​​步过程中直接上传到 YouTube，您永远不会接触视频，它永远不会靠近您的服务器 -这对您或您的托管服务提供商来说可能是个问题 - 例如，我的主机不会在我的每月带宽中计算通过 FTP 的流量，但确实包括通过网站上传/下载的文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T14:31:42.050

您可以以编程方式发布到 YouTube 表单。我最近修改了[http://www.codeproject.com/KB/cs/uploadfileex.aspx](http://www.codeproject.com/KB/cs/uploadfileex.aspx)上的示例，以编写一些代码，将文件发布到第三方网站作为夜间工作。

这会影响性能，因为文件必须先上传到您的服务器，然后再上传到 YouTube，而不是直接上传到 YouTube，但这是一种选择。

# database - 大数据量的数据库选择？

> ID：629445
> 
> 赞同：41
> 
> 时间：2009-03-10T09:34:40.557
> 
> 标签：database, data-warehouse, evaluation

我即将开始一个应该有一个相当大的数据库的新项目。

表的数量不会很大（<15），大部分数据（99％）将包含在一个大表中，几乎是插入/只读（无更新）。

一张表中的数据量估计会以**每天 500.000 条记录的**速度增长，我们应该至少保留**1 年**的数据，以便能够进行各种报告。

需要有（只读）**复制**数据库作为备份/故障转移，并且可能用于在高峰时间卸载报告。

我对那种大型数据库没有第一手经验，所以我问那些拥有哪个数据库的数据库是这种情况下的最佳选择。我知道**Oracle**是安全的选择，但如果有人有类似设置的**Postgresql**或**Mysql经验，我会更感兴趣。**

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-10T15:02:16.523

我在每天看到 100K-2M 新行的环境中使用 PostgreSQL，大多数都添加到一个表中。但是，这些行往往会减少为样本，然后在几天内删除，所以我不能谈论超过 ~100M 行的长期性能。

我发现插入性能非常合理，特别是如果您使用批量复制。查询性能很好，虽然计划者做出的选择有时让我感到困惑；特别是在执行 JOIN/EXISTS 时。我们的数据库需要定期维护（VACUUM/ANALYZE）以保持其平稳运行。我可以通过更仔细地优化 autovacuum 和其他设置来避免其中的一些问题，如果你不做很多 DELETE，这不是什么大问题。总的来说，我觉得在某些方面配置和维护起来比应有的要困难得多。

我没有使用 Oracle，MySQL 仅用于小数据集，因此无法比较性能。但 PostgreSQL 确实*适用*于大型数据集。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-10T10:05:23.227

您有“[数据仓库工具包](http://books.google.com/books?id=2OCbq8Azdm8C&dq=data+warehouse+toolkit&printsec=frontcover&source=bn&hl=en&ei=Xjq2SavALcyatwe-nYm3CQ&sa=X&oi=book_result&resnum=4&ct=result)”的副本吗？

那里的建议是执行以下操作。

1.  将事实（可测量的、数字的）值与限定或组织这些事实的维度分开。一张大桌子并不是最好的主意。它是一个主导设计的事实表，加上许多小维度表，以允许对事实进行“切片和切块”。

2.  将事实保存在简单的平面文件中，直到您想要进行 SQL 样式的报告。不要创建和备份数据库。创建和备份文件；仅为必须从 SQL 执行的报告加载数据库。

3.  在可能的情况下创建摘要或额外数据集市以进行分析。在某些情况下，您可能需要将整个内容加载到数据库中。如果您的文件反映了您的表设计，那么所有数据库都有批量加载器工具，可以从文件中填充和索引 SQL 表。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T09:36:42.453

Google 的[BigTable 数据库](http://en.wikipedia.org/wiki/BigTable)和[Hadoop](http://en.wikipedia.org/wiki/Hadoop)是两个可以处理大量数据的数据库引擎。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-10T10:00:07.343

关于 Google BigTable 的一些有趣的观点是......

Bigtable 与 DBMS

*   查询速度快
*   **无连接，无 SQL 支持**，面向列的数据库
*   使用一个 Bigtable 而不是拥有许多规范化表
*   在传统观点中甚至不在 1NF 中
*   旨在支持历史查询时间戳字段 => 这个网页昨天是什么样子的？
*   数据压缩更容易——行稀疏

正如您提到的，我强调了联接和无 SQL 支持，您将需要运行一系列报告。如果你在哪里使用它，我不知道有多少（如果有的话）没有能力这样做会对你运行报告产生影响。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-10T10:43:17.910

数据量（每年 2 亿条记录）并不是很大，应该与任何标准数据库引擎一起使用。

如果您不需要有关它的实时报告，则该案例会更容易。我会在其他服务器上镜像和预聚合数据，例如每日批处理。就像 S.Lott 建议的那样，您可能想阅读有关数据仓库的信息。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-10T09:41:26.203

我们将[Firebird](http://www.firebirdsql.org)用于一个非常庞大的数据库（现在保存数据超过 30 年）并且它的扩展性非常好。

最好的一点是您有要配置的属性，但与 Oracle 不同的是，您安装它并且它运行良好，无需在使用之前开始配置。

# session-variables - 如何使用 java 将 SendEnv 变量发送到 sftp 会话

> ID：629446
> 
> 赞同：2
> 
> 时间：2009-03-10T09:34:46.733
> 
> 标签：session-variables

我想将`SendEnv`变量发送到`sftp session`使用 java 代码。

我怎样才能使用java实现这一点？可以使用命令提示符完成，如下所示：

```
export RDIR=4
sftp -o SendEnv=RDIR user@<hostname> 
```

# ruby - 耙字符串替换文件

> ID：629447
> 
> 赞同：1
> 
> 时间：2009-03-10T09:35:10.803
> 
> 标签：ruby, rake

Rake 是否内置了用于替换文件中的字符串等内容，或者最好在“sh”中使用 bash 命令，还是使用 Ruby 自己的文件操作功能？

问候，

克里斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:49:04.817

Rake 没有提供任何关于字符串替换的特殊功能，但它是一个 Ruby 脚本；你可以在任何其他脚本中使用任何你可以使用的东西。用 Ruby 做这件事是否比使用其他工具更好是选择最适合这项工作的工具的问题。

但请记住，如果您计划分发源代码并使用外部工具，那么这些工具将成为您软件的依赖项。如果你需要一些不寻常的东西来构建，那么你自己重写它可能是值得的。

# c# - 来自 ReadOnlyCollection 的对象 []

> ID：629453
> 
> 赞同：1
> 
> 时间：2009-03-10T09:39:53.290
> 
> 标签：c#, arrays, generics, object, readonly-collection

我有一个通过反射调用最终得到的对象：

`object readOnlyCollectionObject = propertyInfo.GetValue(someEntity, null);`

我知道这个对象是一个通用的 ReadOnlycollection。它可能是`ReadOnlyCollection<Cat>`,`ReadOnlyCollection<Dog>`等。为了论证起见，让我们说它是`ReadOnlyCollection<T>`.

即使 Dog 派生自一个对象，我也知道 a`ReadOnlyCollection<Dog>`不是派生自 a `ReadOnlyCollection<object>`。所以即使我使用反射调用CopyTo方法我仍然需要知道ReadOnlyCollection的具体类型，这是我想要避免的。

我想知道如何将所有元素作为对象引用数组从 ReadOnlyCollection 中取出，而无需知道`ReadOnlyCollection<T>`.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T11:47:02.640

许多其他答案都提到了 Cast() 和 ToArray，它们的类型都有问题。正如您所说，您不会知道您的属性将实现哪个专门的 IEnumerable。但是，您可以确定它们都将实现非泛型 ICollection 接口。

```
ICollection readOnlyCollectionObject = (ICollection)propertyInfo.GetValue(someEntity, null);
object[] objs = new ArrayList(readOnlyCollectionObject).ToArray(); 
```

或者

```
ICollection readOnlyCollectionObject = (ICollection)propertyInfo.GetValue(someEntity, null);
object[] objs = new object[readOnlyCollectionObject.Count];
for (int i = 0; i < readOnlyCollectionObject.Count; i++)
    objs[i] = readOnlyCollectionObject[i]; 
```

编辑：忘记将演员表从 IEnumerable 更新为 ICollection

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T09:47:37.950

好吧，您可以在*只读集合上使用*[Cast](http://msdn.microsoft.com/en-us/library/bb341406.aspx)扩展方法，然后将其转换为对象数组，但基于 c# 数组是*协变*的事实，您可以简单地执行以下操作：

 **```
object[] objs = myReadOnlyCollection.ToArray(); 
```

*（编辑）*

正如 Pop Catalin 所提到的，唯一有效`T`的是引用类型。否则使用 Cast 方法。

*（编辑2）*

你对问题的更新改变了很多事情......我认为你想要做的事情是不可能的。您想在*编译时*强制转换为仅在*运行时*可用的显式类型。在这种情况下，您必须访问集合的唯一方法是使用反射。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T09:48:05.517

```
 var myArray = readOnlyCollection.Cast<object>().ToArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T09:49:23.203

将您的集合转换为对象列表，然后调用 ToArray()：

```
ReadOnlyCollection<string> s;
object[] o = s.Cast<object>().ToArray(); 
```

由于扩展方法，仅适用于 C# 3.5。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-10T09:48:20.117

您想要收藏的深层克隆吗？如果您想深度克隆，请尝试以下代码进行内存深度克隆：

```
// deep copy in separeate memory space
public object Clone()
{
    MemoryStream ms = new MemoryStream();
    BinaryFormatter bf = new BinaryFormatter();
    bf.Serialize(ms, this);
    ms.Position = 0;
    object obj = bf.Deserialize(ms);
    ms.Close();
    return obj;
} 
```

# .net - 我应该如何优化我的 .net 代码中的多个调用到一个简单的存储过程？

> ID：629455
> 
> 赞同：2
> 
> 时间：2009-03-10T09:40:38.373
> 
> 标签：.net, sql, optimization, stored-procedures

我有一个非常简单的存储过程：

```
create procedure spFoo(v varchar(50))
as 
insert into tbFoo select v 
```

我有 50 个值要插入 tbFoo，这意味着在我的 c# 代码中我调用 spFoo 50 次。这是一种非常低效的方法，特别是如果我的程序和数据库之间存在一些滞后。

在这种情况下你通常会怎么做？

我正在使用 SQL Server 2008，但它可能不相关。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T09:58:31.480

如果您的问题是尝试传入多行，那么从 SQL Server 2008 开始，您将拥有一个新的参数类型[Table-Valued](https://msdn.microsoft.com/en-us/library/bb510489(SQL.100).aspx)。它允许您通过结构化类型的 .NET SQLParamter 将 .Net 数据表直接传递到存储过程中。

```
tvpParam.SqlDbType = SqlDbType.Structured 
```

但是，如果问题是您尝试填充的 1 行中有 50 列，那么您最好将它们全部作为单独的参数传递并更改过程，而不是尝试使用代码或 T-SQL 变得光滑。

有一篇很好的[文章](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/table-valued-parameters)演示了如何在 SQL Server 中以及通过 C# 和 VB.Net 中的 .NET 使用表值参数。希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T09:47:45.143

实际上，SQL Server 2008 的一个很酷的特性是[表值参数](http://msdn.microsoft.com/en-us/library/bb510489.aspx)。

设置：

```
create type fooTableType as table (v varchar(50));
go 

create proc spFoo(@t fooTableType readonly) as
  insert into tbFoo(v) select v from @t
go 
```

然后你的 C# 代码生成：

```
declare @t as fooTableType
insert @t(v) values('beyond'),('all'),('recognition')
exec spFoo(@t) 
```

这是一些粗略的 C# 代码：

```
using (SqlCommand cmd=new SqlCommand()) {
  StringBuilder sql = new StringBuilder();
  for(int i=0; i<50; i++) {
    sql.AppendFormat(",(@v{i})",i);
    cmd.Parameters.AddWithValue("@v"+i.ToString(),values[i]);
  }
  cmd.CommandText = "declare @t as fooTableType; insert @t(v) values" +
                    sql.ToString().Substr(1) + "; exec spFoo(@t);"
  cmd.CommandType = CommandType.Text;
  cmd.Connection = myConnection;
  cmd.ExecuteNonQuery();
} 
```

我通常同意这种优化不是绝对必要的。也许它是强迫症，但我不能把它作为 cmd.ExecuteNonQuery() 的循环。

查看 CertifiedCrazy 的[答案](https://stackoverflow.com/questions/629455/how-should-i-optimize-multiple-calls-in-my-net-code-to-a-trivial-stored-procedur/629504#629504)以获得更简洁的 C# 代码版本。

另请注意，此技术仅限于 2100 个总参数 - 这是底层 TDS 协议的限制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T09:45:35.147

实际上，这里有什么低效的？如果您不想使用任何类型的 BULK INSERT，则必须调用它 50 次。不过，如果您使用准备好的语句，并且在每次运行时只替换参数值，它应该会运行得非常快。

此外，50 次插入/sp 调用实际上不算什么。直接去吧。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T09:45:15.397

这取决于这是否是性能瓶颈。
如果不是，我不会担心。

如果是，您可以将所有 50 个项目传递给一个存储过程，例如一个字符串。
然后存储过程可以拆分出这些值，然后根据需要调用您的创建过程。
因此，您将调用 SQL 一次，它会执行 50 次插入。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T09:53:41.070

通过创建参数@v0 到@v49 来批量调用，所以它只是1 次网络往返：

```
using (var cmd = new SqlCommand()) {
   for (int i = 0; i < 50; i++) {
      string paramName = "@v" + i.ToString();
      cmd.CommandText += string.Format("EXEC spFoo " + paramName + ";");
      cmd.Parameters.AddWithValue(paramName, values[i]);
   }

   cmd.ExecuteNonQuery();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-25T16:03:00.307

我将列表构造为 xml 字符串并将其传递给存储的过程。在 SQL 2005 中，它具有很好的 xml 功能来解析 xml 并进行批量插入。

查看这篇文章： [使用 XML 参数将列表传递给 SQL Server 2005](http://weblogs.asp.net/jgalloway/archive/2007/02/16/passing-lists-to-sql-server-2005-with-xml-parameters.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T09:47:33.723

将要插入的值作为 XML 参数传递。然后，您可以使用 XPath 查询批量插入数据。

# c# - C# 在运行时找不到库

> ID：629459
> 
> 赞同：1
> 
> 时间：2009-03-10T09:43:42.797
> 
> 标签：c#, reference, runtime, local

我有一个使用 dll 的 C# 项目。我将 dll 添加到项目引用中，并将属性 Copy Local 设置为 False（我不想拥有该 dll 的本地副本）。

编译看起来不错，但是当我尝试运行 C# 应用程序时，它找不到 dll。

我在哪里可以告诉项目在运行时在哪里寻找库？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T09:57:00.893

看看[这篇](http://msdn.microsoft.com/en-us/library/823z9h8w(VS.80).aspx)MSDN 文章。这是关于**<probing>**元素的。

> 指定公共语言运行时在加载程序集时要搜索的应用程序基子目录。

这允许您告诉应用程序它可以在哪里查找默认 /bin 文件夹以外的程序集。
*请注意，它会查找“子目录”，因此它不能是完全不同的文件夹。它必须驻留在您的应用程序基础文件夹中。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T09:52:28.267

使用[Fusion Log Viewer](http://msdn.microsoft.com/en-us/library/e74a18c4(vs.71).aspx)跟踪解决程序集的问题。

如果您不想拥有 DLL 的本地副本，则必须将其放在全局程序集缓存 (GAC) 中，或者将[程序集重定向](http://msdn.microsoft.com/en-us/library/2fc472t2(vs.71).aspx)指令添加到您的 app.config 或 machine.config。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T10:07:25.140

为什么要将项目引用的 copylocal 设置为 false？不建议这样做。

观察两者之间的区别：

1.  编译时汇编解析
2.  运行时程序集解析

GAC 程序集**始终**是运行时解析的。GAC 程序集默认是共享程序集（考虑重用）。

编译时解析用于完成构建。尽可能使用项目引用（在您的解决方案中使用程序集）。当您不负责构建要使用的程序集并且这些程序集不在您的解决方案中时，请使用文件引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T11:43:01.887

如果您不想自己分发第三方 dll，您可以：

1) 说明要求并假设 dll 将安装在 GAC 中。它在大多数情况下都不起作用，并且在本地拥有程序集是有目的的：如果某些系统范围的更新与您的依赖项混淆，您的应用程序不应该中断。

2）咬紧牙关，用你自己的分发第三方dll。

3) 如果这样做是合法的（注意第三方 dll 的许可条款），请使用[IL Merge](http://www.microsoft.com/Downloads/details.aspx?familyid=22914587-B4AD-4EAE-87CF-B14AE6A939B0&displaylang=en)静态链接您的程序集（您自己的和任何第三方）。使用 ILMerge，您最终可以拥有一个包含所有引用的程序集。您仅在打包部署时合并（有自定义的 msbuild/NAnt 任务为您执行此操作），在 VS 中进行开发时，您只需像以前一样继续做（引用程序集）。ILMerge 在很多项目中被用于拥有一个独立的、紧凑的可执行文件（想到 LinqPad）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T09:47:19.700

如果将 CopyToLocal 设置为 false，则将该程序集安装在[GAC](http://msdn.microsoft.com/en-us/library/yf1d93sz(VS.71).aspx)中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T09:54:10.947

要引用此 dll，需要将其复制到本地或 GAC（全局程序集缓存）中。拥有本地副本是首选方式，因此我建议将本地副本切换为 true。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T09:57:12.937

应用程序将在与可执行文件相同的路径和 path-env 中查找 .dll。但正如 BtBh 所说：如果你把这个程序集放在 GAC 中，只使用关闭开关。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T11:21:08.397

为什么将所有外部程序集与您制作的程序集一起复制是错误的？

您可以使用 XCOPY 部署，以便所有程序集驻留在 1 个位置。

部署组件的另一种方法是将它们全部打包在 1 个安装包 (MSI) 中。

# nhibernate - 奇怪的 linq 到休眠问题，来自“System.Int32”的无效转换

> ID：629480
> 
> 赞同：12
> 
> 时间：2009-03-10T09:49:29.880
> 
> 标签：nhibernate, linq-to-nhibernate

在以下代码中调用 Get 可以正常工作：

```
public class ContractService : IContractService
{
    private readonly IRepository<Contract> repository;

    public ContractService(IRepository<Contract> repository)
    {
        this.repository = repository;
    }

    public Contract Get(int contractId)
    {
        return repository.Query().Where(x => x.Id == contractId).FirstOrDefault();
    } 
```

但是当我这样做时：

```
public class ContractService : CRUDService<Contract>, IContractService
{
    public ContractService(IRepository<Contract> repository) : base(repository)
    {
    }
}

public class CRUDService<TEntity> : ICRUDService<TEntity> where TEntity : IEntity
{
    protected readonly IRepository<TEntity> repository;

    public CRUDService(IRepository<TEntity> repository)
    {
        this.repository = repository;
    }

    public TEntity Get(int id)
    {
        var entities = this.repository.Query().Where(s => s.Id == id);
        return entities.FirstOrDefault();
    } 
```

get 方法中的“实体”在您迭代它时会引发异常：

```
Invalid cast from 'System.Int32' to 'TEntity' (where TEntity is the type name) 
```

有人知道为什么吗？

编辑：这是不同的表达方式：

在泛型版本（顶部）中，它似乎出于某种原因试图转换 x，这一定是因为泛型：s

```
{value(NHibernate.Linq.Query`1[Contract]).Where(x => (Convert(x).Id = value(CRUDService`1+<>c__DisplayClass0[Contract]).Id)).FirstOrDefault()}

{value(NHibernate.Linq.Query`1[Contract]).Where(x => (x.Id = value(ContractService+<>c__DisplayClass2).Id)).FirstOrDefault()} 
```

（为清楚起见省略了命名空间）

第二次编辑：似乎是当它尝试在 IEntity 和实例类型（TEntity）之间进行转换时

这是 IEntity：

```
public interface IEntity
{
    int Id { get; }
} 
```

第三次编辑：似乎是导致 AssociationVisitor 无法正确访问表达式树并转换“Convert(x).Id”的 Convert(x)

第四次编辑：我们走了，有人已经发现了这个错误[https://nhibernate.jira.com/browse/NHLQ-11](https://nhibernate.jira.com/browse/NHLQ-11)！

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T16:21:22.670

我认为问题在于 Linq/NHibernate 试图将 IEntity.Id 映射到表列而不是 TEntity.Id。我在 LinqToSql 存储库实现中遇到了这个问题。解决方法是使用如下表达式：

```
private static Expression<Func<TEntity, bool>> GetFindExpression(string propertyName, object value)
{
    ParameterExpression parameterExpression = Expression.Parameter(typeof (TEntity), "id");
    MemberExpression propertyExpression = Expression.Property(parameterExpression, propertyName);

    Expression bodyExpression = Expression.Equal(propertyExpression, Expression.Constant(value));

    return Expression.Lambda<Func<TEntity, bool>>(bodyExpression, parameterExpression);
} 
```

所以这会将 Get(id) 更改为：

```
public TEntity Get(int id)
{
    var entities = Query.Where(GetFindExpression("Id", id));
    return entities.FirstOrDefault();
} 
```

**更新：**

如果您不想处理表达式（它们可能很棘手！），您可以使用 Scott Guthrie 在此处描述的动态 LINQ 库： [http ://weblogs.asp.net/scottgu/archive/2008/01/ 07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

这会将 Get(id) 更改为：

```
public TEntity Get(int id)
{
    var entities = Query.Where("Id = @0", id);
    return entities.FirstOrDefault();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T06:49:56.627

我有同样的问题 ：（

以下不起作用。

```
public override T Load(int id)
{
    return (from t in _sessionFactory.Session.Linq<T>()
            where t.ID == id 
            select t).SingleOrDefault();
} 
```

下面就可以了！

```
public override Product Load(int id)
{
    return (from t in _sessionFactory.Session.Linq<Product>()
            where t.ID == id
            select t).SingleOrDefault();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T19:23:45.743

我过去遇到过这种情况，通常归结为您正在阅读的数据库表中的字段格式不兼容。就像布尔值不转换为整数一样。

检查表中的字段类型并确保它们兼容。也许您的 Id 列是 BIGINT？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-07T10:44:36.603

该错误已报告但尚未修复：

[https://nhibernate.jira.com/browse/NHLQ-11](https://nhibernate.jira.com/browse/NHLQ-11)

我发布了一个简单的测试用例来重现它。

让我们希望它尽快得到解决！

# apache - 使用 Apache 进行负载均衡路由

> ID：629482
> 
> 赞同：1
> 
> 时间：2009-03-10T09:49:54.513
> 
> 标签：apache, mod-rewrite

我的应用程序有两个内部部分：

1.  上传部分网址：`%URI%/upload/%action%`
2.  登录部分网址：`%URL%/Login/%action%`

登录部分的代码位于一台服务器上`5.123.12.1`，而上传的代码位于另一台服务器上`5.123.12.2`。

在服务器路由之后，将有更多与请求参数或操作参数相关的路由。

如何在两台机器的 Apache 配置文件中构造 mod-rewrite 和 mod-cond 的规则，以便进行路由？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T20:54:25.487

对于您的设置，我将在另一个作为前端运行的 Apache 服务器上使用以下内容。

```
<VirtualHost *:80>
  ServerName    your.domain.com
  RewriteEngine on
  ProxyPreserveHost on
  ProxyPassReverse /    http://5.123.12.1/
  ProxyPassReverse /    http://5.123.12.2/

  RewriteRule ^/Login(.*)   http://5.123.12.1/Login$1 [P,L]
  RewriteRule ^/upload(.*)  http://5.123.12.2/upload$1 [P,L]

</VirtualHost> 
```

这是假设您启用了 mod_rewrite。我不确定您是否可以在重写规则中使用 IP 地址，因此您可能必须为您列出的两台服务器设置一个内部主机名。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T01:29:15.383

您最好使用一些专用的负载平衡软件，例如 HAProxy 或 Perlbal。优点是您可以在多个后端服务器上平衡对同一 URL 的请求。

如果做不到这一点，Apache 有一个名为 mod_proxy_balancer 的平衡器模块：

```
<Proxy balancer://mycluster>
 BalancerMember http://192.168.1.50:80
 BalancerMember http://192.168.1.51:80
</Proxy>
ProxyPass /test balancer://mycluster/ 
```

# javascript - 当面板已经渲染到其他 div 时，如何将面板重新渲染到不同的 div

> ID：629487
> 
> 赞同：0
> 
> 时间：2009-03-10T09:53:24.130
> 
> 标签：javascript, extjs, updatepanel

我创建了一个 Ext.Panel 对象，它正确呈现给我页面上的指定 div 元素。

我想将面板对象底层元素（以前呈现的 div 元素）替换为另一个将动态识别的 div。

这里我不想通过指定标识的 div 元素再次创建 Panel 对象，我需要利用现有的面板对象，并且需要在标识的 div 存在的地方显示面板。

任何人都可以帮助我解决这个问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T03:27:58.167

如果您将面板创建为自定义扩展，并使用它自己的命名空间：

```
Ext.namespace('My.Panel');

My.Panel.SomePanel = Ext.extends(Ext.Panel,{
    // Your custom panel configuration here
    itemId:'myPanel'
});

Ext.reg('mypanel',My.Panel.SomePanel); 
```

然后，您可以在需要时创建面板，甚至可以通过您注册的 xtype 引用它：

```
var myWin = new Ext.Window({
    title:'Some Title',
    height: 300,
    width: 300,
    items:[{
        xtype: 'mypanel',
        data: someData
    }]
});

var myTabs = new Ext.TabPanel({
    title: 'Some Tab Panel',
    activeTab: 0,
    items:[{
        xtype: 'mypanel',
        title: 'SomePanel number 1'
    }]
}); 
```

# c# - 如何动态更改 MasterPage 上 aspnetForm 的 Action 属性

> ID：629488
> 
> 赞同：7
> 
> 时间：2009-03-10T09:53:31.197
> 
> 标签：c#, asp.net, javascript

我们正在尝试动态修改母版页中主 ASP.NET 表单的 Action 属性。

该页面有一个单选按钮，用户选择其中一个选项并单击提交，在回发时，根据选择应该设置表单的操作属性并且应该自动再次提交表单。

我们试图用 JavaScript 来做同样的事情。

```
document.forms[0].action = "option1.aspx";
document.forms[0].submit(); 
```

但这似乎不起作用，对动作属性没有影响。

如果我们不使用母版页，这可以通过使用轻松实现

```
this.Form.Action = "option1.aspx";
ClientScript.RegisterStartupScript(this.GetType(),"test1",
    "document.form[0].submit();",true); 
```

可悲的是，我们无法删除母版页..有关如何实现这一点的任何指针..？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T09:59:13.430

这是我读过的他们希望他们没有做过的事情。Form 标记将其操作属性硬编码。您必须使用控制适配器才能在运行时控制其构造。当我需要回发 URL 是我创建的重写 URL 时，我特别将它用于 URL 重写。Scott Gu 为它编写了代码，你可以在这里找到它：

[http://www.scottgu.com/blogposts/urlrewrite/UrlRewrite_HttpModule1.zip](http://www.scottgu.com/blogposts/urlrewrite/UrlRewrite_HttpModule1.zip)

以及文章地址：

[http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx](http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T00:31:40.617

表单是否需要将值传递给结果页面？如果没有，为什么不直接使用 Response.Redirect 到正确的页面？例如，假设您正在使用名为*lstOptions*的 RadioButtonList ：

```
protected void btnSubmit_Click(object sender, EventArgs ags) {
        switch (lstOptions.SelectedValue) {
            case "option1":
                Response.Redirect("~/option1.apsx");
                break;
            //etc
        }
} 
```

如果您必须传递这些值，为什么还要触发回帖？听起来你可以通过使用 javascript 来完成你想要的。例如，假设您的表单名为*form1*并且您的单选按钮的名称为*options*：

```
<input type="submit" value="Submit" onclick="javascript:submitForm()" />

<script type="text/javascript">
   function submitForm() {
      for (var i=0; i < document.form1.options.length; i++) {
         if (document.form1.options[i].checked) {
            document.forms[0].action = "option" + i + ".aspx";
            document.forms[0].submit();
         }
      }
   }
</script> 
```

# c# - 如何在 ASP.NET 2.0 中将图像放大到正常大小

> ID：629501
> 
> 赞同：0
> 
> 时间：2009-03-10T09:57:35.260
> 
> 标签：c#, asp.net, sql-server, vb.net, asp.net-2.0

*   我的用户上传了一张图片，图片被保存到我的 SQl Server 数据库中
*   我的用户在大小为 150 像素 x 150 像素的普通图像 WebControl 中查看页面上的图片 - 示例可以在[http://www.erate.co.za/CompanyProfile.aspx?ID=112](http://www.erate.co.za/CompanyProfile.aspx?ID=112)中找到- 美国国旗是图片 i我在谈论。

如果用户上传 300 像素 x 200 像素的图片，该图像在我的静态 150 像素 x 150 像素图像框中会看起来很有趣。知道如何显示图像以使其不会模糊吗？

此外，当用户单击 150 像素 x 150 像素的图像时，如何在屏幕上显示某种形式的弹出窗口，显示数据库中图片的实际大小。

注意：我不希望图像静态大小增加，因为这会完全弄乱我的页面布局和外观。它必须是某种形式的弹出窗口或其他东西。我以前看过的东西我觉得真的很酷。用户单击小图像，然后在屏幕中间出现一个带有图片实际大小的弹出窗口，页面上的所有内容都被禁用，直到用户单击关闭按钮。这可以在 ASP.NET 2.0 中完成吗？或者类似的东西？

问候艾蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:46:43.420

使用固定宽度/高度的缩略图。

您可以即时调整实际图像（存储在数据库中）的大小。

因此，您的缩略图大小始终为 150 像素 x 150 像素。存储在数据库中的实际图像（宽度/高度）会有所不同。

您首先显示调整大小的缩略图列表，当您单击缩略图项目时，这些缩略图会在弹出窗口中显示完整图像。

“缩略图”图像的代码：

```
 byte[] getResizedImage(String path, int width, int height)
        {
            try
            {
                Bitmap imgIn = new Bitmap(path);

                //Scale
                double y = imgIn.Height;
                double x = imgIn.Width;
                double factor = 1;
                if (width > 0)
                {
                    factor = width / x;
                }
                else if (height > 0)
                {
                    factor = height / y;
                }

                System.IO.MemoryStream outStream = new System.IO.MemoryStream();
                Bitmap imgOut = new Bitmap((int)(x * factor), (int)(y * factor));
                Graphics g = Graphics.FromImage(imgOut);
                g.Clear(Color.White);
                g.DrawImage(imgIn, new Rectangle(0, 0, (int)(factor * x), (int)(factor * y)), new Rectangle(0, 0, (int)x, (int)y), GraphicsUnit.Pixel);
                imgOut.Save(outStream, ImageFormat.Jpeg);

                return outStream.ToArray();

            }
            catch (Exception)
            {
...
            }

        } 
```

此示例在 Web 服务器文件系统上使用 .jpg 图像，但可以进行调整以适应存储在数据库中的任何图像/类型。

莫伊布莱。

编辑：固定图像格式

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T10:01:47.027

看看这个模态弹出的例子；

[http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx)

# database - 将大量数据流存储到数据库中时的资源使用情况

> ID：629503
> 
> 赞同：1
> 
> 时间：2009-03-10T09:58:20.997
> 
> 标签：database, performance

首先，我对数据库一无所知，所以如果这是一个愚蠢的问题，请原谅我。

我的公司正在通过 TCP 接收大量位置数据。每个数据包由几个浮点数和一个时间戳组成。我们的任务是将数据存储到在现代 PC 上运行的数据库 (MS SQL Server 2005) 中。

每个 blob 大约有 20 个字节。最多有 1000 个发件人，每个发件人每秒发送大约 25 个包。

一台普通的 PC 是否能够处理如此大量的数据？如果不是，如何处理这个问题？我们是否应该为每个发件人设置一台专用 PC？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T10:12:29.683

所以要了解您的要求：
您希望每秒最多插入 25 000 次
您希望存储最多 20 个字节 * 1000 个发件人 * 25 个数据包 * 60 秒 * 60 分钟 * 24 小时 = 43.2 GB / 天。

有几件事：

*   这是一个非常大量的数据。
*   普通的 PC 无法处理这个问题，您需要一个功能强大的服务器和非常大的磁盘阵列来处理这个问题。
*   您打算如何处理您的数据？如果要处理它，您可能需要查看数据仓库等。

最后，这不是您的专业领域，对于这种规模的项目，您需要专家。
找一个，即使是短期咨询。

# java - Java Swing 1.6 到 1.5

> ID：629506
> 
> 赞同：2
> 
> 时间：2009-03-10T09:59:00.717
> 
> 标签：java, swing

是否可以将使用 Java 1.6 中的 Swing 开发的 UI 移植到 Java 1.5 而无需重新全部重写？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T10:26:08.140

只是为了详细说明duffymo所说的：

Java 被设计为向后兼容。即，如果你在 1.5 中编写了一些东西，你可以在 1.6 中运行它。当然，这是有限制的（例如，新的保留字如*assert* break it）但总的来说它工作得很好。

如果你走另一条路，那就更危险了。您当然不需要重写所有代码，但您可能使用了自 1.6 起才提供的功能。这些特征可以是新类或现有类的新方法。

另一件事是二进制代码级别。你可以设置你的编译器运行 1.6 来创建 1.5 甚至 1.4 的代码。

**但**请注意，您的 1.6 编译器肯定会针对 1.6 rt.jar 进行编译。这意味着在您使用 1.5 实际运行或编译代码之前，您不会注意到缺少的类或方法。

设置合规级别仅意味着 1.5 JRE 将*理解*代码，而不是所有“默认”类都可用。

我对 1.6 的细节没有任何经验，但我认为虽然 1.5 添加了许多新的语言功能（并非全部与 1.4 兼容），但 1.6 更像是一个维护版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T10:03:56.100

如果您只使用了两者之间共有的功能，我会说是的。它应该是向后兼容的。添加 JDK 6 特定功能的那一刻，您必须将其删除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:25:08.790

由于 Swing 在过去十年中没有太大变化，因此您应该不会遇到很多问题。Java 6 也没有比 Java 5 更多的新特性（主要是内部清理）。

我建议尝试使用 Java 5 编译您的应用程序并运行它。它可能开箱即用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T00:58:32.850

如果您想确保您的代码在 1.5 环境中运行，请将您的 IDE 设置为针对 1.5 JDK 构建，这样您就不会无意中使用任何新 API。

# xml - 将 MSXML DOMDocument 转换为 SqlDbType.Xml ADO.NET 参数的值

> ID：629508
> 
> 赞同：0
> 
> 时间：2009-03-10T09:59:16.440
> 
> 标签：xml, msxml, sqldbtype

我有一个存储过程，它接受从一些 .NET/ADO.NET 代码调用的 xml 参数 (SqlDbType.Xml)。我已经通过使用 System.XML.XMLReader 从文件中读取一些测试 XML 的测试工具对此进行了测试；

```
Dim xmlParam As SqlParameter = New SqlParameter("@xml", SqlDbType.Xml)
xmlParam.Value = New SqlTypes.SqlXml(XmlReader.Create(txtXMLFile.Text))
.Parameters.Add(xmlParam) 
```

在此代码要进入的应用程序中，实际的 XML 在一个 VB6 对象中，在一个 MSXML2.DOMDocument40 对象中（VB6 项目引用 MSXML4）我已经研究了如何将 MSXML.DOMDocument40 从 VB6 编组到 .NET - 在事实上，.NET 项目已经引用了 MSXML4，所以这一切都很好。现在我需要做的就是正确转换它，以便它可以传递到存储的过程中。

System.XML.XMLReader 有许多采用流对象的重载，我想知道是否可以在 MSXML 对象之上创建一个流？或者如果我可以将 MSXML 转换为 .NET XML 类型，然后可以使用？

显然性能将是一个考虑因素，但目前我只需要弄清楚如何以任何方式做到这一点！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T10:33:55.827

更好的主意是根本不混合 MSXML 和 .NET。

如果必须，则从 MSXML 对象获取 xml 字符串，并在字符串上创建 XmlReader，或者将字符串加载到 XmlDocument 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T10:39:52.507

MSXML DOM 将保存到任何实现 COM IStream 接口的地方，因此如果您能找到映射到 .NET 流的实现，您应该能够相当有效地实现这一目标。

# asp.net - 日期时间转换

> ID：629513
> 
> 赞同：1
> 
> 时间：2009-03-10T10:01:22.177
> 
> 标签：asp.net, vb.net, datetime

我想转换`mm/dd/yyyy`为`dd/mm/yyyy`. 我的应用程序是带有 VB 的 asp.NET。我尝试了以下代码

```
DateTime.Parse(oldDate.ToString("dd\mm\yyyy")) 
```

但是得到了错误：

```
"The string was not recognized as a valid dateTime. There is an unknown word starting at index 2" 
```

任何人都可以给出适当的代码吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T10:05:12.323

在 VB 中：

```
Dim dt As DateTime = _
    DateTime.ParseExact(oldDate, "MM/dd/yyyy", CultureInfo.InvariantCulture)

' and then if you want to format it in dd/MM/yyyy format
Dim s As String = dt.ToString("dd/MM/yyyy") 
```

在 C# 中：

```
DateTime dt =
    DateTime.ParseExact(oldDate, "MM/dd/yyyy", CultureInfo.InvariantCulture);

// and then if you want to format it in dd/MM/yyyy format
string s = dt.ToString("dd/MM/yyyy"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T20:05:06.050

如果 oldDate 是 DateTime 那么你需要做的就是

```
 Dim oldDate As DateTime = DateTime.Now

    Dim odS As String 'old date as string
    odS = oldDate.ToString("ddMMyyyy").Insert(4, "\").Insert(2, "\") 
```

更改字符串格式不会更改 DateTime。DateTime 是数字，而不是字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:03:57.223

您应该转义 \ 字符。

# winforms - windows安装程序可以默认程序使用XP兼容模式吗？

> ID：629514
> 
> 赞同：1
> 
> 时间：2009-03-10T10:01:44.297
> 
> 标签：winforms, visual-studio-2008, windows-installer, windows-vista, c#-2.0

客户在使用我们编写的应用程序时遇到问题，但只有在他在 Vista 中运行时才会出现问题。但是，如果他在 XP 兼容模式下运行它，它就可以正常工作。当我们深入了解 Vista 问题时，是否可以更新我们的安装程序（使用 .net 2.0 的应用程序的 Visual Studio 2008 Windows 窗体安装程序），以便安装的程序将自动使用兼容模式？他不希望他的用户必须手动更新设置。

非常感谢，

亚当。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T10:07:38.887

一个相关[的 winamp 论坛帖子](http://forums.winamp.com/showthread.php?threadid=260715)（*Vista：使安装的应用程序在 XP 兼容模式下运行*）建议设置以下注册表项：

```
HKCU "Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers" "[full application path goes here]" "WINXPSP2" 
```

我还没有验证这一点，但我假设 XP 兼容模式的使用是存储在注册表中的设置，所以我建议使用[**ProcMon**](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)来查看手动应用设置时更改了哪些键。

最后让您的安装程序添加正确的密钥。然而，不言而喻，从长远来看，您应该解决根本问题。

# javascript - 从 XSD 以编程方式生成的 XML 编辑器需要 Javascript 库

> ID：629517
> 
> 赞同：1
> 
> 时间：2009-03-10T10:02:17.027
> 
> 标签：javascript, xml, xforms

我想创建一个基于 Web 的界面来配置系统。我的系统配置是使用 XML 定义的，我有一个 XML 模式。我正在寻找一个 Java 库，它采用这种模式并自动创建一个漂亮的基于 Web 的界面，用于查看和编辑 XML 配置文档。

如果这个库允许扩展和隐藏复合元素，当然可以确保生成的 XML 与 XSD 兼容，那就太好了。

我应该在这里的某个地方使用 Xform 吗？

问候

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T10:20:15.470

看看[Xopus](http://xopus.com)。它是一个用 Javascript 编写的基于浏览器的 XML 编辑器。它需要一个 XML 文档、一个 XML 模式和一个 XSLT 作为输入。

Xopus 面向非技术用户，将根据指定的 XML 模式禁用/隐藏所有会使文档无效的 UI 选项。

XSLT 用于创建所见即所得的编辑视图。[通过使用Xopus DOM API](http://xopus.com/documentation/developer-guide/reference/xopus-api.html)动态设置 XSLT 参数，可以轻松地扩展和隐藏文档的某些部分。

# php - 如何使用 Python 将 HTTP POST 值发送到（PHP）页面？

> ID：629518
> 
> 赞同：1
> 
> 时间：2009-03-10T10:02:22.050
> 
> 标签：php, python, post

我有一个有 1 个文本框的 PHP 页面，当我按下提交按钮时。我的 SQL 将把这个产品名称存储到我的数据库中。我的问题是；是否可以使用要求 1 个值的 Python 脚本发送/发布产品名称，然后使用我的 PHP 页面将其发送到我的数据库？谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T10:05:27.160

查看 urllib 和 urllib2 模块。

[http://docs.python.org/library/urllib2.html](http://docs.python.org/library/urllib2.html)

[http://docs.python.org/library/urllib.html](http://docs.python.org/library/urllib.html)

只需使用所需数据创建一个 Request 对象。然后从您的 PHP 服务读取响应。

[http://docs.python.org/library/urllib2.html#urllib2.Request](http://docs.python.org/library/urllib2.html#urllib2.Request)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T13:15:45.657

在使用 python 测试或自动化网站时，我喜欢使用斜纹。Twill 是一种自动处理 cookie 的工具，可以读取 HTML 表单并提交它们。

例如，如果您在网页上有一个表单，您可以想象使用以下代码：

```
from twill import commands
commands.go('http://example.com/create_product')
commands.formvalue('formname', 'product', 'new value')
commands.submit() 
```

这将加载表单、填写值并提交。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T10:06:08.797

是的。[urllib2](http://docs.python.org/library/urllib2.html)是一种很好的 Python 方式来形成/发送 HTTP 请求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T21:16:00.183

我发现[http://www.voidspace.org.uk/python/articles/urllib2.shtml](http://www.voidspace.org.uk/python/articles/urllib2.shtml)是一个很好的关于 urllib2 的信息来源，这可能是完成这项工作的最佳工具。

```
import urllib
import urllib2

url = 'http://www.someserver.com/cgi-bin/register.cgi'
user_agent = 'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'
values = {'name' : 'Michael Foord',
          'location' : 'Northampton',
          'language' : 'Python' }
headers = { 'User-Agent' : user_agent }

data = urllib.urlencode(values)
req = urllib2.Request(url, data, headers)
response = urllib2.urlopen(req)
the_page = response.read() 
```

编码实际上是使用 urllib 完成的，它支持 HTTP POST。还有一种使用 GET 的方法，您必须将数据传递到 urlencode。

不过不要忘记调用 read() ，否则请求将无法完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-01-03T11:46:53.717

我个人更喜欢使用**Requests**。作为总结，这是一个*为人类构建的 Python 的 HTTP 库*。

为了快速解决问题，与其深入研究 HTTP，**Requests**会是更好的选择。（是的，我的意思是与*urllib*或*socket*相比）

例如，一个使用用户数据发送 POST 请求的 python 文件：

```
import requests
userdata = {"firstname": "Smith", "lastname": "Ayasaki", "password": "123456"}
resp = requests.post('http://example.com/test.php', data = userdata) 
```

以下 text.php 处理此请求：

```
$firstname = htmlspecialchars($_POST["firstname"]);
$lastname = htmlspecialchars($_POST["lastname"]);
$password = htmlspecialchars($_POST["password"]);
echo "FIRSTNAME: $firstname  LASTNAME: $lastname  PW: $password"; 
```

最后，响应文本（python 中的 resp.content）将如下所示：

> 名字：史密斯姓氏：绫崎密码：123456

*   一个简单的快速入门：[http ://docs.python-requests.org/en/latest/user/quickstart/](http://docs.python-requests.org/en/latest/user/quickstart/)
*   另一个推荐**Requests**的答案：[Sending data using POST in Python to PHP](https://stackoverflow.com/questions/4214231/sending-data-using-post-in-python-to-php/29492097#29492097)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-11T11:40:35.750

只是[@antileet](https://stackoverflow.com/questions/629518/how-do-i-send-a-http-post-value-to-a-php-page-using-python/632312#632312)程序的一个附录，如果您尝试使用类似 Web 服务的有效负载执行 HTTP POST 请求，它的工作原理类似，但您只是省略了 urlencode 步骤；IE

```
import urllib, urllib2

payload = """
<?xml version='1.0'?>
<web_service_request>
    <short_order>Spam</short_order>
    <short_order>Eggs</short_order>
</web_service_request>
""".strip()
query_string_values = {'test': 1}
uri = 'http://example.com'

# You can still encode values in the query string, even though
# it's a POST request. Nice to have this when your payload is
# a chunk of text.
if query_string_values:
    uri = ''.join([uri, '/?', urllib.urlencode(query_string_values)])
req = urllib2.Request(uri, data=payload)
assert req.get_method() == 'POST'
response = urllib2.urlopen(req)
print 'Response:', response.read() 
```

# vb.net - DataGridView 列顺序似乎不起作用

> ID：629521
> 
> 赞同：6
> 
> 时间：2009-03-10T10:03:22.623
> 
> 标签：vb.net, datagridview

我有一个绑定到业务对象列表的 DataGridView：

```
Dim template As New IncidentTemplate
Dim temps As List(Of IncidentTemplate) = template.LoadAll
Dim bs As New BindingSource

If Not temps Is Nothing Then

   bs.DataSource = temps
   Me.dgvTemplates.DataSource = bs

End If 
```

然后我添加了一个未绑定的按钮列并使一些绑定的列不可见：

```
 Dim BtnCol As New DataGridViewButtonColumn
        With BtnCol
            .Name = "Edit"
            .Text = "Edit"
            .HeaderText = String.Empty
            .ToolTipText = "Edit this Template"
            .UseColumnTextForButtonValue = True
        End With

        .Columns.Add(BtnCol)
        BtnCol = Nothing

        For Each col As DataGridViewColumn In Me.dgvTemplates.Columns

               Select Case col.Name

                Case "Name"
                    col.DisplayIndex = 0
                    col.FillWeight = 100
                    col.Visible = True

                Case "Description"
                    col.DisplayIndex = 1
                    col.FillWeight = 100
                    col.Visible = True

                Case "Created"
                    col.DisplayIndex = 3
                    col.HeaderText = "Created On"
                    col.DefaultCellStyle.Format = "d"
                    col.FillWeight = 75
                    col.Visible = True

                Case "CreatedBy"
                    col.DisplayIndex = 2
                    col.HeaderText = "Created By"
                    col.FillWeight = 75
                    col.Visible = True

                Case "Edit"
                    col.DisplayIndex = 4
                    col.HeaderText = ""
                    col.FillWeight = 30
                    col.Visible = True

                Case Else
                    col.Visible = False

            End Select

        Next 
```

这似乎工作得相当好，除非无论我做什么按钮列（编辑）总是显示在其他列的中间而不是最后。我已经尝试了 DGV.Columns.Add 和 DGV.Columns.Insert 以及设置列的 DisplayIndex（这适用于所有其他列），但我无法使按钮列显示在正确的位置。我也尝试在设置其余列之前和之后添加按钮列，但这似乎没有区别谁能建议我做错了什么？这让我疯狂....

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-11-27T18:35:26.660

我在寻找解决类似问题时偶然发现了您的帖子。我终于按照你提到的（使用`DisplayIndex`属性）并将`AutoGenerateColumns`属性设置`DataGridView`为false来追踪它。这个属性在设计器中是不可见的，所以我只是将它添加到我的表单的构造函数中。请务必在为网格设置数据源之前执行此操作。

希望这可以帮助...

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-10-01T16:04:59.473

AutoCreateColumn 是问题所在。以下文章给出了如何修复它的示例。

从[DataDridView DisplayOrder 不工作](http://www.internetworkconsulting.net/content/datadridview-displayorder-not-working)

> 在数据网格视图中设置列的 DisplayIndex 时，某些列出现乱序。为了解决这个问题，我必须在设置数据源之前将 AutoGenerateColumns 设置为 true，之后设置为 FALSE。
> 
> 例如：

```
dgvReservedStalls.AutoGenerateColumns = True
dgvReservedStalls.DataSource = clsReservedStalls.LoadDataTable()
dgvReservedStalls.AutoGenerateColumns = False 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-05-21T20:36:59.377

同样的问题，搜索了一段时间后，我发现通过按升序设置 DisplayIndexes 可以为我解决问题。

这是违反直觉的，因为它是一个数字，但我仍然必须按顺序设置它们。

这有效：

```
With customersDataGridView
    .Columns("ContactName").DisplayIndex = 0
    .Columns("ContactTitle").DisplayIndex = 1
    .Columns("City").DisplayIndex = 2
    .Columns("Country").DisplayIndex = 3
    .Columns("CompanyName").DisplayIndex = 4
End With 
```

虽然这没有：

```
With customersDataGridView
    .Columns("ContactName").DisplayIndex = 0
    .Columns("CompanyName").DisplayIndex = 4
    .Columns("Country").DisplayIndex = 3
    .Columns("ContactTitle").DisplayIndex = 1
    .Columns("City").DisplayIndex = 2
End With 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-26T02:58:15.963

我尝试了上述解决方案但没有成功。然后我找到了这篇文章：它让一切变得更好。

[http://msdn.microsoft.com/en-us/library/vstudio/wkfe535h(v=vs.100).aspx?cs-save-lang=1&cs-lang=vb#code-snippet-1](http://msdn.microsoft.com/en-us/library/vstudio/wkfe535h(v=vs.100).aspx?cs-save-lang=1&cs-lang=vb#code-snippet-1)

# python - 如何在 Django 中查询为 GROUP BY？

> ID：629551
> 
> 赞同：430
> 
> 时间：2009-03-10T10:10:30.390
> 
> 标签：python, django, django-models

我查询一个模型：

```
Members.objects.all() 
```

它返回：

```
Eric, Salesman, X-Shop
Freddie, Manager, X2-Shop
Teddy, Salesman, X2-Shop
Sean, Manager, X2-Shop 
```

我想知道`group_by`向我的数据库发起查询的最佳 Django 方法，例如：

```
Members.objects.all().group_by('designation') 
```

当然，这是行不通的。我知道我们可以做一些技巧`django/db/models/query.py`，但我只是想知道如何在不打补丁的情况下做到这一点。

* * *

## 回答 #1

> 赞同：642
> 
> 时间：2009-03-10T11:08:28.070

如果您打算进行聚合，您可以使用[ORM 的聚合功能](http://docs.djangoproject.com/en/stable/topics/db/aggregation/#topics-db-aggregation)：

```
from django.db.models import Count
result = (Members.objects
    .values('designation')
    .annotate(dcount=Count('designation'))
    .order_by()
) 
```

这会导致类似的查询

```
SELECT designation, COUNT(designation) AS dcount
FROM members GROUP BY designation 
```

并且输出将是形式

```
[{'designation': 'Salesman', 'dcount': 2}, 
 {'designation': 'Manager', 'dcount': 2}] 
```

如果不包含`order_by()`，如果默认排序不是您所期望的，您可能会得到不正确的结果。

如果要在结果中包含多个字段，只需将它们作为参数添加到`values`，例如：

```
 .values('designation', 'first_name', 'last_name') 
```

### 参考：

*   Django 文档：[`values()`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#django.db.models.query.QuerySet.values)、[`annotate()`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#django.db.models.query.QuerySet.annotate)和[`Count`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#django.db.models.Count)
*   Django 文档：[Aggregation](https://docs.djangoproject.com/en/stable/topics/db/aggregation)，特别是标题为“[与默认排序的交互”或`order_by()`](https://docs.djangoproject.com/en/stable/topics/db/aggregation/#interaction-with-default-ordering-or-order-by)

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-03-10T10:30:44.227

一个简单的解决方案，但不是正确的方法是使用[原始 SQL](http://docs.djangoproject.com/en/dev/topics/db/sql/#topics-db-sql)：

```
results = Members.objects.raw('SELECT * FROM myapp_members GROUP BY designation') 
```

另一种解决方案是使用该`group_by`属性：

```
query = Members.objects.all().query
query.group_by = ['designation']
results = QuerySet(query=query, model=Members) 
```

您现在可以遍历 results 变量以检索结果。请注意，`group_by`未记录在案，可能会在 Django 的未来版本中进行更改。

而且...为什么要使用`group_by`？如果您不使用聚合，则可以使用`order_by`来实现相似的结果。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2017-11-15T23:08:06.237

您还可以使用`regroup`模板标签按属性分组。从文档：

```
cities = [
    {'name': 'Mumbai', 'population': '19,000,000', 'country': 'India'},
    {'name': 'Calcutta', 'population': '15,000,000', 'country': 'India'},
    {'name': 'New York', 'population': '20,000,000', 'country': 'USA'},
    {'name': 'Chicago', 'population': '7,000,000', 'country': 'USA'},
    {'name': 'Tokyo', 'population': '33,000,000', 'country': 'Japan'},
]

...

{% regroup cities by country as countries_list %}

<ul>
    {% for country in countries_list %}
        <li>{{ country.grouper }}
            <ul>
            {% for city in country.list %}
                <li>{{ city.name }}: {{ city.population }}</li>
            {% endfor %}
            </ul>
        </li>
    {% endfor %}
</ul> 
```

看起来像这样：

*   印度
    *   孟买：19,000,000
    *   加尔各答：15,000,000
*   美国
    *   纽约：20,000,000
    *   芝加哥：7,000,000
*   日本
    *   东京：33,000,000

`QuerySet`我相信它也适用于s。

来源：[https ://docs.djangoproject.com/en/2.1/ref/templates/builtins/#regroup](https://docs.djangoproject.com/en/2.1/ref/templates/builtins/#regroup)

编辑：请注意，如果您的字典列表未按键排序，则该`regroup`标签*不会*像您期望的那样工作。它迭代地工作。因此，在将列表（或查询集）传递给`regroup`标签之前，请按 grouper 的键对列表（或查询集）进行排序。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-11-12T18:06:20.910

**Django 不支持自由分组查询**。我以非常糟糕的方式学习它。ORM 并非旨在支持您想要做的事情，而不使用自定义 SQL。您仅限于：

*   RAW sql（即 MyModel.objects.raw()）
*   `cr.execute`句子（以及对结果的手工解析）。
*   `.annotate()`（按句子分组在 .annotate() 的子模型中执行，例如聚合 lines_count=Count('lines'))）。

您可以通过查询集`qs`调用`qs.query.group_by = ['field1', 'field2', ...]`，但如果您不知道您正在编辑什么查询并且不能保证它会工作并且不会破坏 QuerySet 对象的内部结构，那么这是有风险的。此外，它是一个内部（未记录的）API，您不应该直接访问，否则代码将不再与未来的 Django 版本兼容。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-09-29T15:33:31.957

以下模块允许您对 Django 模型进行分组，并在结果中仍然使用 QuerySet：[https ://github.com/kako-nawao/django-group-by](https://github.com/kako-nawao/django-group-by)

例如：

```
from django_group_by import GroupByMixin

class BookQuerySet(QuerySet, GroupByMixin):
    pass

class Book(Model):
    title = TextField(...)
    author = ForeignKey(User, ...)
    shop = ForeignKey(Shop, ...)
    price = DecimalField(...) 
```

* * *

```
class GroupedBookListView(PaginationMixin, ListView):
    template_name = 'book/books.html'
    model = Book
    paginate_by = 100

    def get_queryset(self):
        return Book.objects.group_by('title', 'author').annotate(
            shop_count=Count('shop'), price_avg=Avg('price')).order_by(
            'name', 'author').distinct()

    def get_context_data(self, **kwargs):
        return super().get_context_data(total_count=self.get_queryset().count(), **kwargs) 
```

'书/books.html'

```
<ul>
{% for book in object_list %}
    <li>
        <h2>{{ book.title }}</td>
        <p>{{ book.author.last_name }}, {{ book.author.first_name }}</p>
        <p>{{ book.shop_count }}</p>
        <p>{{ book.price_avg }}</p>
    </li>
{% endfor %}
</ul> 
```

`annotate`/基本 Django 查询的区别在于`aggregate`使用相关字段的属性，例如`book.author.last_name`.

如果您需要已分组的实例的 PK，请添加以下注解：

```
.annotate(pks=ArrayAgg('id')) 
```

注意：`ArrayAgg`是 Postgres 特定的功能，从 Django 1.9 开始可用：[https ://docs.djangoproject.com/en/3.2/ref/contrib/postgres/aggregates/#arrayagg](https://docs.djangoproject.com/en/3.2/ref/contrib/postgres/aggregates/#arrayagg)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-10T10:24:57.097

您需要执行此代码段中示例的自定义 SQL：

[通过子查询自定义 SQL](http://www.djangosnippets.org/snippets/236/)

或者在在线 Django 文档中显示的自定义管理器中：

[添加额外的 Manager 方法](http://docs.djangoproject.com/en/dev/topics/db/managers/#adding-extra-manager-methods)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-11-07T10:11:06.610

[文档](https://docs.djangoproject.com/en/stable/topics/db/aggregation/#values)说您可以使用值对查询集进行分组。

```
class Travel(models.Model):
    interest = models.ForeignKey(Interest)
    user = models.ForeignKey(User)
    time = models.DateTimeField(auto_now_add=True)

# Find the travel and group by the interest:

>>> Travel.objects.values('interest').annotate(Count('user'))
<QuerySet [{'interest': 5, 'user__count': 2}, {'interest': 6, 'user__count': 1}]>
# the interest(id=5) had been visited for 2 times, 
# and the interest(id=6) had only been visited for 1 time.

>>> Travel.objects.values('interest').annotate(Count('user', distinct=True)) 
<QuerySet [{'interest': 5, 'user__count': 1}, {'interest': 6, 'user__count': 1}]>
# the interest(id=5) had been visited by only one person (but this person had 
#  visited the interest for 2 times 
```

您可以使用以下代码找到所有书籍并按名称对它们进行分组：

```
Book.objects.values('name').annotate(Count('id')).order_by() # ensure you add the order_by() 
```

[你可以在这里](https://github.com/ramwin/django_reference/blob/master/models_action%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C.md#groupby)观看一些备忘单。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2021-08-27T10:29:24.637

您也可以直接使用内置的 pythons `itertools.groupby`：

```
from itertools import groupby

designation_key_func = lambda member: member.designation
queryset = Members.objects.all().select_related("designation")

for designation, member_group in groupby(queryset, designation_key_func):
    print(f"{designation} : {list(member_group)}") 
```

在我看来，不需要原始 sql、子查询、第三方库或模板标签，而且是 Python 和显式的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-03-02T11:26:03.597

换句话说，如果您只需要基于某个字段“删除重复项”，否则只需按原样查询 ORM 对象，我想出了以下解决方法：

```
from django.db.models import OuterRef, Exists

qs = Members.objects.all()
qs = qs.annotate(is_duplicate=Exists(
    Members.objects.filter(
        id__lt=OuterRef('id'),
        designation=OuterRef('designation')))
qs = qs.filter(is_duplicate=False) 
```

所以，基本上我们只是`is_duplicate`通过使用一些方便的过滤（可能会根据您的模型和要求而有所不同）来注释值，然后简单地使用该字段来过滤掉重复项。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-02T11:38:59.830

如果您想要模型对象，而不仅仅是普通值或字典，您可以执行以下操作：

```
members = Member.objects.filter(foobar=True)
designations = Designation.objects.filter(member__in=members).order_by('pk').distinct() 
```

替换`member__in`为您的型号名称的小写版本，后跟`__in`. 例如，如果您的型号名称是`Car`，请使用`car__in`。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-11-18T05:24:31.610

这有点复杂，但是让提问者只用一次 DB 命中就能得到他/她的期望。

```
from django.db.models import Subquery, OuterRef

member_qs = Members.objects.filter(
    pk__in = Members.objects.values('designation').distinct().annotate(
        pk = Subquery(
          Members.objects.filter(
            designation= OuterRef("designation")
        )
        .order_by("pk") # you can set other column, e.g. -pk, create_date...
        .values("pk")[:1]
        ) 
    )
   .values_list("pk", flat=True)
) 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2018-09-24T03:51:14.080

```
from django.db.models import Sum
Members.objects.annotate(total=Sum(designation)) 
```

首先你需要导入 Sum 然后..

# javascript - 当面板已经渲染到其他 div 时，如何将面板重新渲染到不同的 div

> ID：629553
> 
> 赞同：0
> 
> 时间：2009-03-10T10:12:08.000
> 
> 标签：javascript, extjs, updatepanel, rendering, panel

我创建了一个 Ext.Panel 对象，它正确呈现给我页面上的指定 div 元素。

我想将面板对象底层元素（以前呈现的 div 元素）替换为另一个将动态识别的 div。

这里我不想通过指定标识的 div 元素再次创建 Panel 对象，我需要利用现有的面板对象，并且需要在标识的 div 存在的地方显示面板。

任何人都可以帮助我解决这个问题。

谢谢文卡特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:01:04.520

如果您将面板创建为自定义扩展，并使用它自己的命名空间：

```
Ext.namespace('My.Panel');

My.Panel.SomePanel = Ext.extends(Ext.Panel,{
    // Your custom panel configuration here
    itemId:'myPanel'
});

Ext.reg('mypanel',My.Panel.SomePanel); 
```

然后，您可以在需要时创建面板，甚至可以通过您注册的 xtype 引用它：

```
var myWin = new Ext.Window({
    title:'Some Title',
    height: 300,
    width: 300,
    items:[{
        xtype: 'mypanel',
        data: someData
    }]
});

var myTabs = new Ext.TabPanel({
    title: 'Some Tab Panel',
    activeTab: 0,
    items:[{
        xtype: 'mypanel',
        title: 'SomePanel number 1'
    }]
}); 
```

# java - 如何从类中检索不推荐使用的方法列表

> ID：629557
> 
> 赞同：0
> 
> 时间：2009-03-10T10:12:52.523
> 
> 标签：java, eclipse, javadoc

如何从类中检索不推荐使用的方法列表。

我需要列出已标记为已弃用的方法，以便将类传递给文档。

我真的不想将每个方法及其 javadoc 复制并粘贴到单独的文件中，是否可以通过 javadoc 工具或通过 eclipse 来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T10:17:11.373

实际上 javadoc 会自动生成一个 deprecated-list.html 页面。只需运行 javadoc，看看是否是您需要的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T10:23:55.257

这将获取指定类的所有方法：

```
public class DumpMethods {
  public static void main(String args[])
  {
    try {
      Class c = Class.forName(args[0]);
      Method m[] = c.getDeclaredMethods();
      for (int i = 0; i < m.length; i++)
      System.out.println(m[i].toString());
    }
    catch (Throwable e) {
      System.err.println(e);
    }
  }
} 
```

要获取已弃用的方法，对于每种方法，请执行以下操作：

```
Method method = ... //obtain method object
Annotation[] annotations = method.getDeclaredAnnotations();

for(Annotation annotation : annotations){
    if(annotation instanceof DeprecatedAnnotation){
        // It's deprecated.
    }
} 
```

# c++ - 一个奇怪的内存泄漏问题

> ID：629559
> 
> 赞同：0
> 
> 时间：2009-03-10T10:13:57.450
> 
> 标签：c++, memory-leaks, activex, ocx

我使用一个 ActiveX 控件，它只是一个 HTTP 处理程序。它发出一个 HTTP 请求，获取响应并向用户触发一个事件。当用户没有请求时，ActiveX 控件几乎处于休眠状态。它只是等待用户请求发送另一个 HTTP 请求。

只要 OCX 所在的窗口没有改变（失去焦点、获得焦点等），内存就会保持平静。对于上述每个操作，我都会丢失大约 400 个字节。

我应该在哪里寻找可能的泄漏？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:25:13.130

假设 HTTP 字符串是通过`BSTR`s 传递的，您可能会遇到[`BSTR`缓存](http://support.microsoft.com/kb/139071)。要进行验证，您需要将环境变量设置`OANOCACHE`为 1 或`OaSetNoCache()`直接调用。环境变量应该更容易测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T11:15:18.490

寻找可以检测到这种泄漏的现成分析工具（甚至 VC 中的调试模式也可以选择跟踪泄漏的分配）。

# eclipse - 连接到 CVS 时出错

> ID：629561
> 
> 赞同：0
> 
> 时间：2009-03-10T10:15:47.960
> 
> 标签：eclipse, ssl, proxy, connection, cvs

我尝试通过 Eclipse 连接到 CVS。输入（主机，存储库路径，用户，密码）并单击完成后，它给了我以下错误：

> 验证位置时出错：“无法连接到：pserver:username@host:/CVS/Myproject:I/O 发生异常：ProxyHTTP：java.IOEXCEPTION：代理错误（不允许指定的套接字层 (SSL) 端口。ISA 服务器未配置为允许来自此端口的 SSL 请求。大多数 Web 浏览器使用端口 443 进行 SSL 请求。）“

我能做什么 ？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-06-12T03:57:38.177

如果您需要通过代理服务器访问 Web，但使用不应通过代理访问的内部 CVS 服务器，您可以将 CVS 服务器添加到 Eclipse 的*代理绕过列表*。

为此，请转到 Windows→首选项→常规→网络连接，然后单击“添加主机”。您可能希望使用通配符来指定所有内部服务器，例如`*.mycompany.com.au`或`163.189.*`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T10:37:41.620

显然你的代理服务器有问题。尝试在 Eclipse 中禁用代理设置或让您的系统管理员修复代理服务器配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-13T21:55:36.497

在我的特殊情况下，我解决了这个问题：windows -> preferences -> network connections 并设置**Active Provider = Direct**

一旦我修改了这个，我就可以查看代码。

# javascript - 原型/Scriptaculous：选择段落组（ ) 通过点击它们

> ID：629564
> 
> 赞同：1
> 
> 时间：2009-03-10T10:16:51.080
> 
> 标签：javascript, ruby-on-rails, dom, prototypejs, scriptaculous

给出了段落列表（`<p>`）。一旦用户点击段落A，段落A的类别就变为“已激活”。现在用户选择段落 B 并且 A 和 B 之间的所有段落都将其类更改为“已激活”。

通过再次单击 B，只有 A 保持“活动”类。

通过单击 A，A 和 B 之间的所有段落（包括 A 和 B）中的“活动”类将被删除。

不可能“停用” A 和 B 之间的任何段落。A 和 B 之间的选择应该始终是所选段落的不间断列表。

谁能给我一个关于如何使用 Prototype/Scriptaculous 实现这一点的提示？该应用程序是在 Rails 中实现的，因此 RJS 中的任何提示都将更加感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T17:15:49.433

假设您的段落位于名为“info”的包装 div 中：（我尚未对其进行测试，但它会是这样的）

```
$('info').select('P').each(function(element) {
    Event.observe(element,'click',function(event){
        flipIt(event)
    })
})

function flipIt(evt) {  
    var element = evt.element();
    if($(element).hasClassName('active')) {
        $(element).removeClassName('active')
    }
    else {
        $(element).addClassName('active')
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T09:48:48.017

我已经测试了下面的代码，它可以满足您的需求，尽管它有点复杂。它的关键是将段落保存在一个数组中，这是使用 Prototype 的[$$](http://www.prototypejs.org/api/utility#method-$$)函数实现的。

```
<style type="text/css">
  .activated {
    background-color: yellow;
  }
</style>
.
.
.
<div id="container">
  <p>This is paragraph 1.</p>
  <p>This is paragraph 2.</p>
  <p>This is paragraph 3.</p>
  <p>This is paragraph 4.</p>
  <p>This is paragraph 5.</p>
  <p>This is paragraph 6.</p>
</div>
<script type="text/javascript">
  Event.observe(document, "dom:loaded", function() {
    var paragraphs = $$("#container p");
    paragraphs.each(function(paragraph, index) {
      paragraph.observe("click", function(event) {

        // A clicked; toggle activated class on A
        if (index == 0) {
          toggleStyle(paragraphs[0]);

          // A clicked; remove activated class from A + 1 through to B
          // if present
          for (var i = 1; i <= paragraphs.length; i++) {
            if (paragraphs[i] && paragraphs[i].hasClassName("activated")) {
              paragraphs[i].removeClassName("activated");
            }
          }
        }

        // A + 1 clicked; toggle activated class on A + 1
        if (index > 0 && paragraphs[0].hasClassName("activated")) {
          for (var i = 1; i <= index; i++) {
            toggleStyle(paragraphs[i]);
          }
        }
      });
    });
  });

  function toggleStyle(paragraph) {
    if (paragraph.hasClassName("activated")) {
      paragraph.removeClassName("activated");
    } else {
      paragraph.addClassName("activated");
    }
  }
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T10:23:52.160

试试这个

```
<!DOCTYPE HTMP PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
 <head>
  <%= javascript_include_tag :defaults %>
 </head>
 <body>

<style type="text/css">
  .active {
    background-color: maroon;
  }
</style>

<div id="info">
<p>
1 ald fhasdfd sfhjfh afhd fhasjfhjsdah fadfhasd<br/>
fasdhfhsdf ajhajkfh dfhdasjf fhdasf asdf<br/>
asdfh hsdjkhf dhfasdfh asdjfkdhfjkasd<br/>
fsdhf jksdhf sdfjkh asfsdf asdfasdfasdh<br/>
</p>
<p>
2 ald fhasdfd sfhjfh afhd fhasjfhjsdah fadfhasd<br>
fasdhfhsdf ajhajkfh dfhdasjf fhdasf asdf<br/>
asdfh hsdjkhf dhfasdfh asdjfkdhfjkasd<br/>
fsdhf jksdhf sdfjkh asfsdf asdfasdfasdh<br/>
</p>
<p>
3 ald fhasdfd sfhjfh afhd fhasjfhjsdah fadfhasd<br>
fasdhfhsdf ajhajkfh dfhdasjf fhdasf asdf<br/>
asdfh hsdjkhf dhfasdfh asdjfkdhfjkasd<br/>
fsdhf jksdhf sdfjkh asfsdf asdfasdfasdh<br/>
</p>
<p>
4 ald fhasdfd sfhjfh afhd fhasjfhjsdah fadfhasd<br>
fasdhfhsdf ajhajkfh dfhdasjf fhdasf asdf<br/>
asdfh hsdjkhf dhfasdfh asdjfkdhfjkasd<br/>
fsdhf jksdhf sdfjkh asfsdf asdfasdfasdh<br/>
</p>
</div>
<%javascript_tag :defer => 'defer' do -%>
  $('info').select('P').each(function(element) {
    Event.observe(element,'click',function(event){
        flipIt(event)
    })
})

function flipIt(evt) {

    var element = evt.element();
    var all = $('info').select('P');
    var first = -1;
    var last = -1;
    var clicked = 0;
    for ( i=0;i<all.size();i++ ) {
         if( all[i].hasClassName('active') && first == -1   )
           first = i;
         if( all[i].hasClassName('active') && first != i  )
           last = i;
         if ( all[i] == element){
              clicked = i;
          }
    }
   if ( first == clicked && last == -1 ){
        all[clicked].removeClassName('active');
       return;

}
   if ( first  == -1 && last == -1 ) {
        all[clicked].addClassName('active');
        return;
}
   if ( last < clicked  && first != -1 ){
      for (i=first;i<=clicked;i++)
        all[i].addClassName('active');
      return;
   }
   if (last == clicked && first != -1 ) {
      for (i=first+1;i<=clicked;i++)
        all[i].removeClassName('active');
    return; }
}

<%end%>
 </body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T16:00:16.440

好的，与此同时，在同事的帮助下，我想出了一个自己的答案来解决这个问题：

```
<script type="text/javascript">
    // holds paragraph A (first selected paragraph)
    var a_selected = null;
    // holds paragraph B (second selected paragraph)
    var b_selected = null;
    // holds all 'active' paragraphs
    var selected_paras = [];

    function class_flipper_init() {
        // reset paragraphs A and B
        a_selected = null;
        b_selected = null;
        var paragraphs = $$("#foobar p");
        paragraphs.each(function(paragraph, index) {
            // if user clicks on a paragraph
            paragraph.observe("click", function(event) {
                // if A and B are 'active': reset everything.
                if(b_selected != null) {
                    selected_paras.each(function(i) {
                        toggleStyle(i);
                    })
                    a_selected = null
                    b_selected = null
                    return
                }
                // if A is 'active'
                if(a_selected != null) {
                    // if A is 'active' and selected B is below A:
                    // select all paragraphs between A and B
                    if(a_selected < index) {
                        b_selected = index;
                        for (var i = a_selected + 1; i <= index; i++ ) {
                            toggleStyle(paragraphs[i])
                        }
                    }
                    // if A is 'active' and selected B is above A: 
                    // select all paragraphs between A and B
                    else if(a_selected > index) {
                        b_selected = index;
                        for (var i = a_selected - 1; i >= index; i-- ) {
                            toggleStyle(paragraphs[i])
                        }
                    }
                    // if A == B
                    else {
                        toggleStyle(paragraph)
                        a_selected = null
                    }
                }
                // if A is selected
                else {
                    a_selected = index;
                    toggleStyle(paragraph)
                }
            });
        });
    }

    function toggleStyle(paragraph) {
        // remove active class
        if (paragraph.hasClassName("active")) {
            paragraph.removeClassName("active");
            selected_paras = selected_paras.without(paragraph)
        } 
        // set active class
        else {
            paragraph.addClassName("active");
            selected_paras.push(paragraph)
        }
    }
</script> 
```

`class_flipper_init()`每次加载页面（或者在我的情况下是某个部分）时都会调用它。

请不要犹豫，提交用“纯” RJS 或更优雅的方式编写的解决方案。:-)

# ruby-on-rails - 我如何使用 attribute_fu 并以不同的方式处理第一个元素？

> ID：629572
> 
> 赞同：1
> 
> 时间：2009-03-10T10:19:15.253
> 
> 标签：ruby-on-rails

我正在使用`attribute_fu`rails 2.2，我想以不同于其他元素的方式处理第一个嵌套元素，这意味着我想渲染不同的部分或将参数传递给现有的部分。

那可能吗 ？

谢谢， 塞萨尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:07:01.240

我找到了自己问题的答案！

对于那些遇到同样问题的人：您可以像将其传递给普通渲染一样传递本地哈希：partial，如下所示：

```
<%= f.render_associated_form(@your_model, :locals => {:var => value}) %> 
```

问候， 塞萨尔

# regex - 为什么正则表达式不能使用关键字而不是字符？

> ID：629573
> 
> 赞同：12
> 
> 时间：2009-03-10T10:19:25.520
> 
> 标签：regex, language-design

好吧，我几乎不了解 RegEx 基础知识，但为什么他们不能将其设计为使用关键字（如 SQL）而不是一些神秘的通配符和符号？

由于 RegEx 在运行时被解释/解析，是为了性能吗？（未编译）

或者也许是为了写作速度？考虑到当您学习一些“简单”的字符组合时，键入 1 个字符而不是关键字会变得更容易？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-10T10:32:26.640

你真的想要*这个*？

```
Pattern findGamesPattern = Pattern.With.Literal(@"<div")
    .WhiteSpace.Repeat.ZeroOrMore
    .Literal(@"class=""game""").WhiteSpace.Repeat.ZeroOrMore.Literal(@"id=""")
    .NamedGroup("gameId", Pattern.With.Digit.Repeat.OneOrMore)
    .Literal(@"-game""")
    .NamedGroup("content", Pattern.With.Anything.Repeat.Lazy.ZeroOrMore)
    .Literal(@"<!--gameStatus")
    .WhiteSpace.Repeat.ZeroOrMore.Literal("=").WhiteSpace.Repeat.ZeroOrMore
    .NamedGroup("gameState", Pattern.With.Digit.Repeat.OneOrMore)
    .Literal("-->"); 
```

好的，但这[是你的葬礼](https://blog.codinghorror.com/embracing-languages-inside-languages/)，伙计。

在此处下载执行此操作的库：http:
[//flimflan.com/blog/ReadableRegularExpressions.aspx](http://flimflan.com/blog/ReadableRegularExpressions.aspx)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-10T10:30:05.103

正则表达式具有数学（实际上是语言理论）背景，其编码方式有点像**数学公式**。您可以通过一组规则来定义它们，例如

*   每个字符都是一个正则表达式，代表它自己
*   if `a`and`b`是正则表达式，then`a?`和`a|b`and`ab`也是正则表达式
*   ...

使用基于关键字的语言对于简单的正则表达式来说是一个很大的负担。大多数时候，您只会使用简单的文本字符串作为搜索模式：

```
grep -R 'main' *.c 
```

或者可能是非常简单的模式：

```
grep -c ':-[)(]' seidl.txt 
```

一旦你习惯了正则表达式，这种语法就会非常清晰和精确。在更复杂的情况下，您可能会使用其他东西，因为大型正则表达式显然难以阅读。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-15T17:52:57.070

Perl 6 在正则表达式的可读性方面迈出了革命性的一步。考虑以下形式的地址：100 E Main St Springfield MA 01234

这是一个可读性适中的 Perl 5 兼容正则表达式来解析它（许多极端情况未处理）：

```
 m/
     ([1-9]\d*)\s+
     ((?:N|S|E|W)\s+)?
     (\w+(?:\s+\w+)*)\s+
     (ave|ln|st|rd)\s+
     ([:alpha:]+(?:\s+[:alpha:]+)*)\s+
     ([A-Z]{2})\s+
     (\d{5}(?:-\d{4})?)
  /ix; 
```

这个 Perl 6 正则表达式具有相同的行为：

```
grammar USMailAddress {
     rule  TOP { <addr> <city> <state> <zip> }

     rule  addr { <[1..9]>\d* <direction>?
                  <streetname> <streettype> }
     token direction { N | S | E | W }
     token streetname { \w+ [ \s+ \w+ ]* }
     token streettype {:i ave | ln | rd | st }
     token city { <alpha> [ \s+ <alpha> ]* }
     token state { <[A..Z]>**{2} }
     token zip { \d**{5} [ - \d**{4} ]? }
  } 
```

Perl 6 语法是一个类，标记都是可调用的方法。像这样使用它：

```
if $addr ~~ m/^<USMailAddress::TOP>$/ {
     say "$<city>, $<state>";
} 
```

这个例子来自[我](http://chrisdolan.net/frozenperl/rakudo-grammars.html)在[Frozen Perl 2009](http://www.frozen-perl.org/mpw2009/)研讨会上的一次演讲。Perl 6 的 Rakudo 实现已经足够完整，以至于这个例子在今天仍然有效。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-10T10:34:54.640

好吧，如果您有关键字，您如何轻松地将它们与实际匹配的文本区分开来？你将如何处理空格？

原文公司：A 部门：B

标准正则表达式：

```
Company:\s+(.+)\s+Dept.:\s+(.+) 
```

甚至：

```
Company: (.+) Dept. (.+) 
```

关键字正则表达式（真的很努力没有得到一个稻草人......）

```
"Company:" whitespace.oneplus group(any.oneplus) whitespace.oneplus "Dept.:" whitespace.oneplus group(any.oneplus) 
```

或简化：

```
"Company:" space group(any.oneplus) space "Dept.:" space group(any.oneplus) 
```

不，这可能不会更好。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-10T10:27:46.997

因为它对应于形式语言理论并且是数学符号。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-10T10:20:15.547

这是 Perl 的错……！

实际上，更具体地说，正则表达式来自早期的 Unix 开发，当时更加重视简洁的语法。存储、处理时间、物理终端等都非常有限，与今天不同。

[维基百科上正则表达式的历史](http://en.wikipedia.org/wiki/Regular_expression#History)解释了更多。

Regex 有替代品，但我不确定是否真的流行起来。

编辑：由 John Saunders 更正：正则表达式由 Unix*普及*，但首先由[QED](http://en.wikipedia.org/wiki/QED_(text_editor))编辑器实现。同样的设计约束也适用于早期的系统。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-10T10:27:57.917

实际上，不，世界并不是从 Unix 开始的。如果您阅读 Wikipedia 文章，您会看到

> 在 1950 年代，数学家 Stephen Cole Kleene 使用称为正则集的数学符号描述了这些模型。SNOBOL 语言是模式匹配的早期实现，但与正则表达式不同。Ken Thompson 将 Kleene 的符号构建到编辑器 QED 中，作为匹配文本文件中模式的一种手段。他后来将此功能添加到 Unix 编辑器中，最终导致流行的搜索工具 grep 使用正则表达式

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-10T10:29:22.983

这比 PERL 早得多。[Wikipedia 关于正则表达式的条目将正](http://en.wikipedia.org/wiki/Regular_expression#History)则表达式的第一个实现归功于 UNIX 名人的 Ken Thompson，他在 QED 和[ed](http://en.wikipedia.org/wiki/Ed_(text_editor))编辑器中实现了它们。我猜这些命令出于性能原因有短名称，但在客户端之前。[Mastering Regular Expressions](http://regex.info/)是一本关于正则表达式的好书，它提供了注释正则表达式（使用 /x 标志）的选项，使其更易于阅读和理解。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-10T10:25:33.943

因为正则表达式的想法——就像许多源自 UNIX 的东西一样——是它们很简洁，有利于简洁而不是可读性。这实际上是一件好事。我最终编写了 15 行长的正则表达式（根据我更好的判断）。如果它有一个冗长的语法，它就不是一个正则表达式，它是一个程序。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-10T10:26:59.040

实现正则表达式的“冗长”形式实际上非常容易——请[在此处](https://stackoverflow.com/questions/500839/regular-expression-compiler/500945#500945)查看我的答案。简而言之：编写一些返回正则表达式字符串的函数（并在必要时获取参数）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-10T11:16:11.967

我认为关键字不会带来任何好处。正则表达式本身很复杂，但也非常强大。

我认为更令人困惑的是，每个支持库都发明了自己的语法，而不是使用（或扩展）经典的 Perl 正则表达式（例如 \1、$1、{1}、... 用于替换和更多示例）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-10T11:51:43.987

我知道它以错误的方式回答你的问题，但[RegExBuddy](http://www.regexbuddy.com/)有一个功能可以用简单的英语解释你的正则表达式。这可能会使它更容易学习。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-15T18:20:11.683

如果您使用的语言支持[Posix 正则表达式](http://www.regular-expressions.info/posixbrackets.html)，您可以使用它们。

一个例子：

```
\d 
```

将与

```
[:digit:] 
```

括号符号在匹配的内容上更加清晰。我仍然会学习“神秘的通配符和符号，因为您仍然会在其他人的代码中看到它们并且需要理解它们。

[在 regular-expressions.info's page 的表格中](http://www.regular-expressions.info/posixbrackets.html)有更多示例。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-01T15:43:36.297

由于某种原因，我之前的答案被删除了。无论如何，我认为 ruby​​ 正则表达式机器符合要求，在[http://www.rubyregexp.sf.net](http://www.rubyregexp.sf.net)。这是我自己的项目，但我认为它应该可以工作。

# asp.net-mvc - MVC 表单集合

> ID：629601
> 
> 赞同：2
> 
> 时间：2009-03-10T10:31:34.927
> 
> 标签：asp.net-mvc

在 .Net 术语中，“FormCollection”表示“表单”的“集合”，“System.Windows.Forms.FormCollection”是 System.Windows.Forms.Form 的集合

在 ASP.Net MVC 中，“FormCollection”有点令人困惑。

它是网页中所有提交“表格”的集合吗？

（或）它是特定形式的输入控件的集合吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T10:35:38.647

它是 POST 请求中指定的所有输入值的集合（可能是**单个**表单中的所有输入值）。

同样，`QueryStringCollection`保存 GET 请求中指定的所有输入值。

# c# - 在 UI 线程上异步调用同步方法

> ID：629610
> 
> 赞同：1
> 
> 时间：2009-03-10T10:34:30.053
> 
> 标签：c#, multithreading, asynchronous

我编写了一个检查 POP3 帐户的类，我希望它在 UI 线程以外的线程上执行。

为此，我选择了异步路由。

为了从 pop3delegate.BeginInvoke(null,null) 获取结果，我需要调用 EndInvoke，但在 UI 线程块中执行此操作会导致 UI 不可用。

我可以使用 IAsyncResult 对象并检查 IsComplete 属性，但这涉及放入一个检查循环，这反过来又锁定了 UI。

我正在寻找的是一种从 POP3 类中获取完成百分比或某种状态的方法，这反过来会更新 UI 并允许 UI 可用于执行其他任务。我还需要在某个时候调用 EndInvoke 方法，以捕获工作线程上抛出的任何异常。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T10:38:25.863

尝试使用 BackgroundWorker 类，它旨在完全满足您的需求。

有关 msdn 的示例和更多详细信息：http: [//msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T10:38:48.013

试试[Backgroundworker](https://stackoverflow.com/questions/74880/delegating-a-task-in-and-getting-notified-when-it-completes-in-c)类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:38:58.950

使用 BackgroundWorker。它还为您省去了在 UI 和后台 trheads 之间来回编组数据的麻烦，并且它允许进度通知和取消。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T10:54:49.020

使用事件和线程池

```
var asyncResult = pop3delegate.BeginInvoke(null,null);
ThreadPool.RegisterWaitForSingleObject(
    asyncResult.WaitHandle, FunctionToCallWhenDone, null, TimeSpan.Infinite, true); 
```

这将在数​​据到达时调用您的 FunctionToCallWhenDone。您还使用 ThreadPool 应该比创建自己的线程便宜。但是，正如 Kurt Schelfthout 所指出的，您必须执行类似 uielement.Invoke(()=>{some code}) 之类的操作来更改 UI。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T12:49:30.960

您不需要阻塞或循环，您可以简单地传递一个回调方法（委托）作为 BeginInvoke 调用的第一个参数，在这里您可以调用 EndInvoke 流程异常等。

```
private delegate int LongRunningTaskHandler();
static void Main(string[] args) {
    LongRunningTaskHandler handler = LongRunningTask;
    handler.BeginInvoke(MyCallBack, null);
    Console.ReadLine();
}
private static void MyCallBack(IAsyncResult ar) {
    var result = (LongRunningTaskHandler)((AsyncResult) ar).AsyncDelegate;
    Console.WriteLine(result.EndInvoke(ar));
}
public static int LongRunningTask()
{
    Thread.Sleep(5000);
    return 42;
} 
```

# javascript - 如何使用javascript获取div中的子节点

> ID：629614
> 
> 赞同：29
> 
> 时间：2009-03-10T10:35:34.497
> 
> 标签：javascript, get

以下是我的 div 的结构：

```
<div id="ctl00_ContentPlaceHolder1_Jobs_dlItems_ctl01_a"
    onmouseup="checkMultipleSelection(this,event);">
       <table cellpadding="0" cellspacing="0" border="0" width="100%">
           <tr>
              <td style="width:50px; text-align:left;">09:15 AM</td>
              <td style="width:50px; text-align:left;">Item001</td>
              <td style="width:50px; text-align:left;">10</td>
              <td style="width:50px; text-align:left;">Address1</td>
              <td style="width:50px; text-align:left;">46545465</td>
              <td style="width:50px; text-align:left;">ref1</td>
           </tr>
       </table>
</div> 
```

现在，如果我有 div 的 id，我如何使用 JavaScript 获取这个 div 的时间和地址？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-10T10:38:22.227

```
var tds = document.getElementById("ctl00_ContentPlaceHolder1_Jobs_dlItems_ctl01_a").getElementsByTagName("td");
time = tds[0].firstChild.value;
address = tds[3].firstChild.value; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T12:57:15.157

如果你给你的表一个唯一的 id，它更容易：

```
<div id="ctl00_ContentPlaceHolder1_Jobs_dlItems_ctl01_a"
    onmouseup="checkMultipleSelection(this,event);">
       <table id="ctl00_ContentPlaceHolder1_Jobs_dlItems_ctl01_a_table" 
              cellpadding="0" cellspacing="0" border="0" width="100%">
           <tr>
              <td style="width:50px; text-align:left;">09:15 AM</td>
              <td style="width:50px; text-align:left;">Item001</td>
              <td style="width:50px; text-align:left;">10</td>
              <td style="width:50px; text-align:left;">Address1</td>
              <td style="width:50px; text-align:left;">46545465</td>
              <td style="width:50px; text-align:left;">ref1</td>
           </tr>
       </table>
</div>

var multiselect = 
    document.getElementById(
               'ctl00_ContentPlaceHolder1_Jobs_dlItems_ctl01_a_table'
            ).rows[0].cells,
    timeXaddr = [multiselect[0].innerHTML, multiselect[2].innerHTML];

//=> timeXaddr now an array containing ['09:15 AM', 'Address1']; 
```

# c# - 如何将字符串转换为“iso-8859-1”？

> ID：629617
> 
> 赞同：13
> 
> 时间：2009-03-10T10:36:04.310
> 
> 标签：c#, asp.net

如何将 UTF-8 字符串转换为 ISO-8859-1 字符串？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-10T10:39:49.307

尝试：

```
 System.Text.Encoding iso_8859_1 = System.Text.Encoding.GetEncoding("iso-8859-1");
        System.Text.Encoding utf_8 = System.Text.Encoding.UTF8;

        // Unicode string.
        string s_unicode = "abcéabc";

        // Convert to ISO-8859-1 bytes.
        byte[] isoBytes = iso_8859_1.GetBytes(s_unicode);

        // Convert to UTF-8.
        byte[] utf8Bytes = System.Text.Encoding.Convert(iso_8859_1, utf_8, isoBytes); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T10:38:23.507

.NET 字符串在内部都是 UTF-16。`System.String`.NET中没有编码的 UTF-8 或 ISO-8859-1 。要在特定编码使用`System.Text.Encoding`类中获取字符串的二进制表示：

```
byte[] bytes = Encoding.GetEncoding("iso-8859-1").GetBytes("hello world"); 
```

# oop - CLOS 中的插槽

> ID：629631
> 
> 赞同：6
> 
> 时间：2009-03-10T10:40:47.060
> 
> 标签：oop, common-lisp

任何 CL'er 可以解释一下 CLOS 中的“插槽”吗？我发现很难理解插槽名称后面的部分。那是在：

(defclass foo () (data1 :initarg foo))

“initarg”和其他类似的东西是什么意思？我正在重新阅读手册。所以，如果你们中的任何人能向像我这样的外行解释一下，我将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T12:21:35.617

你的例子有点错误。它一定要是：

```
(defclass foo ()
   ((data1 :initarg foo))) 
```

请注意添加的括号以指示插槽描述列表。

DEFCLASS 采用插槽列表。因此，我们有两个插槽：

```
(defclass foo ()
   ((data1 :initarg :data1arg
           :initform (random 1.0) 
           :type number
           :documentation "doc here"
           :accessor foo-data1-acc)
    (data2 :initarg :data2arg))) 
```

DATA1 是插槽的名称。在这之后你会发现成对的 :keyword 值。

:INITARG 告诉你 MAKE-INSTANCE 的参数是什么。(make-instance 'foo :data1arg 10) ; 创建对象并将插槽 data1 设置为 10。通常您应该使用关键字符号（如 :data1arg 此处）。

:INITFORM 在创建对象时默认设置槽。像： (make-instance 'foo) ; 创建对象。插槽设置为 initform 的值。

:TYPE 指定插槽对象的类型。

:DOCUMENTATION 只是一个用于文档的字符串。

:ACCESSOR 指定一个函数来读取和写入插槽。

```
(foo-data1-acc some-foo-object-here)             ; read
(setf (foo-data1-acc some-foo-object-here) 7)    ; write 
```

请注意，您可以按任何顺序编写对，还可以指定多个访问器函数。还有 :READER 和 :WRITER 函数。

使用 CLOS，您可以在 DEFCLASS 宏中指定所有内容。这些东西不会像 defstruct 那样自动生成，它的符号更短。

DEFCLASS 的描述在这里：[DEFCLASS](http://www.lispworks.com/documentation/HyperSpec/Body/m_defcla.htm)。 [简短的 CLOS 介绍](http://www.aiai.ed.ac.uk/~jeff/clos-guide.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:35:04.120

在插槽规范中，一般语法是 ( *slot-name* [ *slot-option* *option-value* ]...)。本质上的权威参考是[defclass 上的 HyperSpec 页面](http://www.lispworks.com/documentation/HyperSpec/Body/m_defcla.htm#defclass)，但简而言之：

**:reader**读取槽值的函数
**:writer**写入槽值的函数
**:accessor**读取和（通过 SETF）设置槽值的函数
**:initarg**设置槽值的符号制作实例

还有更多，但该列表是我最常用的四个（实际上，我主要使用 :initarg 和 :accessor 或 :reader 之一）。

# ruby-on-rails - 如何使用 Net::HTTP::Post 将 XML 发布到 RESTFUL Web 服务？

> ID：629632
> 
> 赞同：14
> 
> 时间：2009-03-10T10:41:37.417
> 
> 标签：ruby-on-rails, xml, ruby, post, rest

我无法让它工作，所以任何帮助将不胜感激！基本上，request.body 包含 Web 服务的有效 XML，如下所示：

```
<somedata>
<name>Test Name 1</name>
<description>Some data for Unit testing</description>
</somedata> 
```

...但服务返回空 XML。请注意，返回的 id 字段表明它确实命中了数据库，但 name 和 description 字段为 nil：

```
<somedata>
<id type='integer'>1</id>
<name nil='true'></name>
<description nil='true'></description>
</somedata> 
```

我已经使用 Poster 手动测试了 RESTFUL 服务，它工作正常。

这是代码：

```
url = URI.parse('http://localhost:3000/someservice/')
request = Net::HTTP::Post.new(url.path)
request.body = "<?xml version='1.0' encoding='UTF-8'?><somedata><name>Test Name 1</name><description>Some data for Unit testing</description></somedata>"
response = Net::HTTP.start(url.host, url.port) {|http| http.request(request)}

#Note this test PASSES!
assert_equal '201 Created', response.get_fields('Status')[0] 
```

有没有人知道为什么 XML 帖子中的数据没有被持久化？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T10:56:46.833

在对服务一无所知的情况下，这只是一个猜测，但是……服务是否需要 Poster 设置的特定标头而您不是？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T02:57:23.123

如果我是你，我会使用[Wireshark](http://www.wireshark.org/)、[tcpflow](http://www.circlemud.org/~jelson/software/tcpflow/)或其他一些嗅探器来查看海报和你的应用正在发送的确切数据，并确保它们是相同的。我见过对最奇怪的东西敏感的服务，比如空格或用户代理。

# xslt - 如何使用 XSLT 从平面 XML 列表构建树？

> ID：629638
> 
> 赞同：6
> 
> 时间：2009-03-10T10:49:01.750
> 
> 标签：xslt, tree

我使用了一个极简的 MVC 框架，其中**PHP 控制器**将**DOM 模型**交给**XSLT 视图**（cf [okapi](http://okapi.liip.ch/)）。

为了构建导航树，我在 MYSQL 中使用了嵌套集。这样，我最终得到了一个如下所示的模型 XML：

```
<tree>
    <node>
        <name>root</name>
        <depth>0</depth>
    </node>
    <node>
        <name>TELEVISIONS</name>
        <depth>1</depth>
    </node>
    <node>
        <name>TUBE</name>
        <depth>2</depth>
    </node>
    <node>
        <name>LCD</name>
        <depth>2</depth>
    </node>
    <node>
        <name>PLASMA</name>
        <depth>2</depth>
    </node>
    <node>
        <name>PORTABLE ELECTRONICS</name>
        <depth>1</depth>
    </node>
    <node>
        <name>MP3 PLAYERS</name>
        <depth>2</depth>
    </node>
    <node>
        <name>FLASH</name>
        <depth>3</depth>
    </node>
    <node>
        <name>CD PLAYERS</name>
        <depth>2</depth>
    </node>
    <node>
        <name>2 WAY RADIOS</name>
        <depth>2</depth>
    </node>
</tree> 
```

它表示以下结构：

*   根
    *   电视
        *   管子
        *   液晶显示器
        *   等离子体
    *   便携式电子产品
        *   MP3 播放器
            *   闪光
        *   CD 播放器
        *   2路收音机

如何使用 XSLT 将此平面 XML 列表转换为嵌套的 HTML 列表？

PS：这是[在 MySQL 中管理分层数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)的示例树。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T10:56:02.047

这种形式的平面列表在 xslt 中很难使用，因为您需要找到下一个分组的位置等。您可以使用不同的 xml 吗？例如，使用平面 xml：

```
<?xml version="1.0" encoding="utf-8" ?>
<tree>
  <node key="0">root</node>
  <node key="1" parent="0">TELEVISIONS</node>
  <node key="2" parent="1">TUBE</node>
  <node key="3" parent="1">LCD</node>
  <node key="4" parent="1">PLASMA</node>
  <node key="5" parent="0">PORTABLE ELECTRONICS</node>
  <node key="6" parent="5">MP3 PLAYERS</node>
  <node key="7" parent="6">FLASH</node>
  <node key="8" parent="5">CD PLAYERS</node>
  <node key="9" parent="5">2 WAY RADIOS</node>
</tree> 
```

它变得微不足道（非常有效）：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:key name="nodeChildren" match="/tree/node" use="@parent"/>
  <xsl:template match="tree">
    <ul>
      <xsl:apply-templates select="node[not(@parent)]"/>
    </ul>
  </xsl:template>
  <xsl:template match="node">
    <li>
      <xsl:value-of select="."/>
      <ul>
        <xsl:apply-templates select="key('nodeChildren',@key)"/>
      </ul>
    </li>
  </xsl:template>
</xsl:stylesheet> 
```

这是一个选择吗？

当然，如果您将 xml 构建为层次结构，那就更容易了；-p

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-23T13:26:13.067

非常有帮助！

一个建议是移动模板内的 < ul > 会删除空的 ul。

```
<xsl:template match="tree">
      <xsl:apply-templates select="node[not(@parent)]"/>
  </xsl:template>
<xsl:template match="node">
   <ul>
    <li>
      <xsl:value-of select="."/>
      <xsl:apply-templates select="key('nodeChildren',@key)"/>  
    </li>
   </ul>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:01:12.683

在 XSLT 2.0 中，使用新的分组功能会相当容易。

在 XSLT 1.0 中，它稍微复杂一些，但这是可行的：

```
<xsl:template match="/tree">
    <xhtml>
        <head/>
        <body>
            <ul>
                <xsl:apply-templates select="node[depth='0']"/>
                </ul>
            </body>
        </xhtml>
    </xsl:template>

<xsl:template match="node">
    <xsl:variable name="thisNodeId" select="generate-id(.)"/>
    <xsl:variable name="depth" select="depth"/>
    <xsl:variable name="descendants">
        <xsl:apply-templates select="following-sibling::node[depth = $depth + 1][preceding-sibling::node[depth = $depth][1]/generate-id() = $thisNodeId]"/>
        </xsl:variable>
    <li>
        <xsl:value-of select="name"/>
        </li>
    <xsl:if test="$descendants/*">
        <ul>
            <xsl:copy-of select="$descendants"/>
            </ul>
        </xsl:if>
    </xsl:template> 
```

问题的核心是又长又丑的“后代”变量，它在当前节点之后查找具有大于当前深度的“深度”子节点的节点，而不是在另一个具有相同深度的节点之后当前深度（因为如果它们是，它们将是该节点的子节点而不是当前节点）。

顺便说一句，您的示例结果中有一个错误：“FLASH”应该是“MP3 PLAYERS”的孩子而不是兄弟姐妹。

编辑

事实上（正如评论中提到的），在“纯”XSLT 1.0 中这不起作用有两个原因：路径表达式错误地使用了 generate-id()，并且不能在路径表达式中使用“结果树片段”。

这是一个正确的 XSLT 1.0 版本的“节点”模板（使用 Saxon 6.5 成功测试），它不使用 EXSLT 或 XSLT 1.1：

```
<xsl:template match="node">
    <xsl:variable name="thisNodeId" select="generate-id(.)"/>
    <xsl:variable name="depth" select="depth"/>
    <xsl:variable name="descendants">
        <xsl:apply-templates select="following-sibling::node[depth = $depth + 1][generate-id(preceding-sibling::node[depth = $depth][1]) = $thisNodeId]"/>
        </xsl:variable>
    <xsl:variable name="descendantsNb">
        <xsl:value-of select="count(following-sibling::node[depth = $depth + 1][generate-id(preceding-sibling::node[depth = $depth][1]) = $thisNodeId])"/>
        </xsl:variable>
    <li>
        <xsl:value-of select="name"/>
        </li>
    <xsl:if test="$descendantsNb &gt; 0">
        <ul>
            <xsl:copy-of select="$descendants"/>
            </ul>
        </xsl:if>
    </xsl:template> 
```

当然，应该考虑重复的路径表达式，但是没有将“结果树片段”转换为可以实际处理的XML的能力，我不知道是否可能？（当然，编写自定义函数可以解决问题，但是使用 EXSLT 会简单得多）

底线：如果可以，请使用 XSLT 1.1 或 EXSLT！

第二次编辑

为了避免重复路径表达式，您也可以完全忘记测试，这只会导致一些空白，您可以将其留在结果中或后期处理以消除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T10:57:18.813

您实际上并没有说过您希望 html 输出看起来像什么，但我可以告诉您，从 XSLT 的角度来看，如果您也是，从平面结构到树将是复杂且昂贵的基于项目在树中的位置及其与兄弟姐妹的关系。

提供属性/节点***比***提供.`<parent>``<depth>`

# .net - 如何从 .net 应用程序中搜索 Excel 中的值？

> ID：629639
> 
> 赞同：0
> 
> 时间：2009-03-10T10:49:14.307
> 
> 标签：.net, excel

我必须从 excel 中搜索超过 5000 条记录的值。

在 windows .net 应用程序中完成此任务的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:38:13.287

由于您正在尝试搜索 thro' 5000 条记录，我假设您必须尝试搜索 thro' 值。您可以使用互操作 API 中的“Range.Find”来执行此操作。

```
private void OpenExcelFile()
{
     Excel.Application exlApp = new Microsoft.Office.Interop.Excel.Application();

    if (exlApp == null)
    {
        MessageBox.Show("Excel app object could not be created");
    }
    else
    {

        exlFileSelector.FileName = @"*.xls";

        if (exlFileSelector.ShowDialog() == DialogResult.OK)
        {
            Excel.Workbook wrkBook = exlApp.Workbooks.Open(exlFileSelector.FileName, 0, true, 5, "", "", true, Excel.XlPlatform.xlWindows, "\t", false, false, 0, true, true, true);
            Excel.Sheets sheetList = wrkBook.Sheets;

            Excel.Range search = exlApp.get_Range("A1", "C5");
            search.Find("FindMe", null, Excel.XlFindLookIn.xlValues, Excel.XlLookAt.xlWhole, Excel.XlSearchOrder.xlByRows, Excel.XlSearchDirection.xlNext, false, null, null); 
        }
    }
} 
```

**进一步阅读：** [如何：在工作表范围内搜索文本](http://msdn.microsoft.com/en-us/library/e4x1k99a.aspx?ppud=4)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T13:52:16.317

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)是一个与 Excel 兼容的 .NET 电子表格组件，它支持类似于 Excel 的 Find API 的 Find API。您可以搜索值或公式，或计算公式，然后根据需要搜索结果。这是一个简短的示例，它加载工作簿并找到以“John”开头的第一个单元格：

```
// Open an xlsx workbook (can also open xls).
IWorkbook workbook = Factory.GetWorkbook(@"C:\tmp\Data.xlsx");

// Find the first cell which starts with "John".
IRange foundCell = workbook.Worksheets["Sheet1"].Cells.Find("John*", null,
    FindLookIn.Values, LookAt.Whole, SearchOrder.ByColumns, SearchDirection.Next, true);
if (foundCell != null)
    Console.WriteLine("found {0} in cell {1}", foundCell.Text, foundCell.Address); 
```

[您可以在此处](https://www.spreadsheetgear.com/downloads/register.aspx)下载免费评估。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:57:55.927

您的值是由电子表格的公式之一产生的计算值，还是实际的预定值？

如果是后者，您可以将电子表格保存为 XML 并适当地解析它们，
或者
根据您可用的索引技术，您可能能够对它们进行索引，然后搜索索引并找到适当的值。
（这将是我的首选方法，现在我已经想到了。）

如果是前者，我能想到的唯一选择是使用 InterOp 库打开每个库并使用 API。

# .net - .Net 默认代理设置

> ID：629641
> 
> 赞同：0
> 
> 时间：2009-03-10T10:50:24.133
> 
> 标签：.net, web-services, configuration, defaultproxy

如果我有一个需要调用 Web 服务的客户端应用程序。如果我在 app.config 文件中将默认代理属性设置为 true 或 false，我想知道利弊和影响？谢谢！

这是我正在谈论的财产。

[http://msdn.microsoft.com/en-us/library/kd3cf2ex.aspx](http://msdn.microsoft.com/en-us/library/kd3cf2ex.aspx)

问候，乔治

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T10:57:26.723

此设置也可以在机器范围的.net配置文件中设置（如果在两个地方都配置了，则以您的app.config设置为准）请注意，如果您处于部分信任环境中，则无法设置此设置（所以谨防单击一次部署）

话虽如此，如果您设置了设置，所有 http 和 https 调用都将使用默认的 Internet 代理。这与其他网络连接（例如 tcp）无关，即使您已在 Internet 选项中配置了 socks 服务器

如果没有设置默认代理，则该设置没有影响，因此使用它通常是一个好主意（除非您想显式绕过代理并进行直接连接）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T10:59:12.240

您可能会遇到没有默认代理服务器但您无法直接连接的情况，例如在公司防火墙内运行的无人值守 Windows 服务中，或者当有人没有设置 Internet Explorer 时。出于这个原因，我将默认行为作为使用默认代理，但在配置文件中有一个属性允许用户覆盖它。

默认代理服务器存储在注册表中：

```
HKEY_LOCAL_MACHINE\ SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\WinHttpSettings 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T11:23:10.450

我个人会在客户端应用程序中将其设置为设置/选项对话框，以便用户可以获取默认值，或者使用用户名和密码设置自己的代理服务器。这样就没有出错的余地。

# asp.net - 无法使用开发服务器运行 ASP.NET Web 应用程序

> ID：629644
> 
> 赞同：3
> 
> 时间：2009-03-10T10:51:34.927
> 
> 标签：asp.net, networking, webserver

我的开发机器（Vista）工作了一年多，然后突然（没有明确安装任何东西）我无法使用 ASP.NET 开发服务器运行网站。

开发Web服务器启动正常，但IE无法显示页面：

> Internet Explorer 无法显示 Firefox 显示的网页 - 连接失败，尝试联系时连接被拒绝 `localhost:49447`。

这是我到目前为止所尝试的：

*   禁用防火墙
*   停止防病毒
*   停止 Windows Defender

当我停止使用所有服务`MSConfig`并再次尝试时，它起作用了。但是，这会禁用大部分服务，因此不是一个可行的长期解决方案。

停止所有服务后，我尝试一一启动服务，以找出导致问题的服务。

这些是步骤和结果：

1.  我发现 DNS 客户端服务引起了问题。
2.  所以我启动了所有其他人并停止了 DNS 客户端服务，但随后网络位置感知服务开始导致问题

3.  我停止了 DNS 客户端服务和网络位置感知并启动了所有其他服务，但 btu 再次导致问题。

显然，这有一些共同的和基本的东西。

我对网络了解不多。有人可以指导我正确的方向吗？

> 注意：我发现另一个人从今天早上开始遇到同样的问题。看起来它可能与 Windows 更新有关！有没有人和我一样受到影响？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-10T16:22:53.600

我可以通过执行以下操作在我的计算机上解决此问题：

我的主机文件包含 localhost 条目的这一行，这是 Vista 附带的主机文件的方式，我从未修改过这一行 ::1 localhost

将“::1 localhost”替换为：127.0.0.1 localhost

“::1 localhost”对我来说已经工作了一年多，直到今天早上。Windows Defender 安装了两个更新，一个昨天和一个今天早上，我猜测其中一个更新中的某些内容导致此条目不再工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T02:45:47.987

我已经解决了这个问题。

问题的出现是因为主机文件中的条目以某种方式为 localhost 删除了。

您必须在保存在 System32/etc 文件夹中的主机文件中添加条目。

只需在文件末尾添加即可。

127.0.0.1 本地主机。

保存此文件并尝试从 cmd 提示符 ping localhost。

我认为这将解决您的问题。

现在尝试运行您的网站。

祝一切顺利.............

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T10:54:08.430

如果停止所有服务使其运行，请尝试一次停止一项。最终你会发现它是哪一个。

希望有人会从经验中知道它是什么，但如果不是，您可以自己找到它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T13:14:48.170

听起来您有代理服务器问题 - 您检查过吗？

> [KB886388 - 当您浏览本地 Web 应用程序时，您可能会收到“无法连接到 Web 服务器”错误消息](http://support.microsoft.com/kb/886388)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T21:26:39.610

我今晚也开始遇到这个问题，以为我昨天安装了一个Windows更新包。
我正在运行 VS 2008（9.0.30729.1 SP）和 Vista Ultimate SP1（32 位）。

用 127.0.0.1 替换 localhost 对我有用。
[http://localhost:49227/testsite/Default.aspx](http://localhost:49227/testsite/Default.aspx)
[http://127.0.0.1:49227/testsite/Default.aspx](http://127.0.0.1:49227/testsite/Default.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T22:25:24.620

我有同样的问题。昨晚在我的网站上工作，一分钟该网站在浏览器中工作，下一分钟它无法连接到本地主机。

将 localhost 替换为 127.0.0.1 对我有用。我对asp.net还是没有经验，有没有你改的文件

[http://localhost:49227/testsite/Default.aspx](http://localhost:49227/testsite/Default.aspx)到

[http://127.0.0.1:49227/testsite/Default.aspx](http://127.0.0.1:49227/testsite/Default.aspx)

因为我只是在浏览器中更改网址

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T02:01:30.510

这个也对我有用。我所做的是：

1.  转到我的项目的属性页。
2.  然后在开始选项下，查找服务器，而不是“使用默认 Web 服务器”，我将其更改为“使用自定义服务器”。
3.  在基本 URL 中键入[http://127.0.0.1:49227/MyProject/ 。](http://127.0.0.1:49227/MyProject/)

就是这样。它使用此链接自动打开站点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-13T16:48:52.457

使用visual studio 2008 express的同样问题

将“localhost”更改为“127.0.0.1”，页面出现了。这个问题似乎对internet explorer和firefox有影响

Opera 没有发现这个问题 :-)

格茨

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-01T17:51:27.637

将“localhost”更改为“127.0.0.1”对我也很有效。

但只是为了澄清不熟悉 vista 的人，这里是更改的准则：

1.  浏览开始 -> 所有程序 -> 附件
2.  右键单击“记事本”并选择“以管理员身份运行”
3.  在 UAC 提示中单击“继续”
4.  单击文件-> 打开
5.  浏览到“C:\Windows\System32\Drivers\etc”
6.  将文件过滤器下拉框从“文本文档（*.txt）”更改为“所有文件（* .*）”
7.  选择“主机”并单击“打开”
8.  进行必要的更改并关闭记事本。提示时保存。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-15T17:51:32.517

问题的出现是因为主机文件中的条目以某种方式为 localhost 删除了。

您必须在保存在`System32/etc`文件夹中的主机文件中添加条目。

只需在文件末尾添加即可。

`127.0.0.1 localhost`.

保存此文件并尝试从 cmd 提示符 ping localhost。

# algorithm - 如何验证新加坡 FIN？

> ID：629664
> 
> 赞同：5
> 
> 时间：2009-03-10T10:57:43.010
> 
> 标签：algorithm, validation

任何人都可以提供一种算法来验证新加坡的 FIN 吗？

我知道使用新加坡身份证，我可以通过模 11 对其进行验证，然后将结果与查找表进行比较，但找不到类似的 FIN 查找表。

我也不确定模 11 是否是正确的验证方法。

我知道政府以 400 美元的价格出售一种算法，但也许有人知道更便宜的方法。

c# 实现的奖励积分。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-05-12T06:12:52.423

再次在 PHP 中

```
function isNricValid ($theNric) {

    $multiples = array( 2, 7, 6, 5, 4, 3, 2 );

    if (!$theNric || $theNric == '')
    {
        return false;
    }

    if (strlen($theNric) != 9)
    {
        return false;
    }

    $total = 0;
    $count = 0;
    $numericNric = 0;

    $first = $theNric[0];
    $last = $theNric[strlen($theNric) - 1];

    if ($first != 'S' && $first != 'T')
    {
        return false;
    }

    $numericNric = substr($theNric, 1, strlen($theNric) - 2);

    if (!is_numeric ($numericNric)) {
        return false;
    }

    while ($numericNric != 0)
    {
        $total += ($numericNric % 10) * $multiples[sizeof($multiples) - (1 + $count++)];

        $numericNric /= 10;
        $numericNric = floor($numericNric);
    }

    $outputs = '';
    if (strcmp($first, "S") == 0)
    {
        $outputs = array( 'J', 'Z', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A' );
    }
    else
    {   
        $outputs = array( 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'J', 'Z', 'I', 'H' );
    }

    return $last == $outputs[$total % 11];

}

function isFinValid ($fin)
{
    $multiples = array( 2, 7, 6, 5, 4, 3, 2 );
    if (!$fin || $fin == '')
    {
        return false;
    }

    if (strlen($fin) != 9)
    {
        return false;
    }

    $total = 0;
    $count = 0;
    $numericNric = 0;
    $first = $fin[0];
    $last = $fin[strlen($fin) - 1];

    if ($first != 'F' && $first != 'G')
    {
        return false;
    }

    $numericNric = substr($fin, 1, strlen($fin) - 2);

    if (!is_numeric ($numericNric)) {
        return false;
    }

    while ($numericNric != 0)
    {
        $total += ($numericNric % 10) * $multiples[sizeof($multiples) - (1 + $count++)];

        $numericNric /= 10;
        $numericNric = floor($numericNric);
    }

    $outputs = array();

    if (strcmp($first, 'F') == 0)
    {
        $outputs = array( 'X', 'W', 'U', 'T', 'R', 'Q', 'P', 'N', 'M', 'L', 'K' );
    }
    else
    {
        $outputs = array( 'R', 'Q', 'P', 'N', 'M', 'L', 'K', 'X', 'W', 'U', 'T' );
    }

    return $last == $outputs[$total % 11];
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-05-11T05:10:44.830

这是用 JavaScript 编写的类似代码

```
var nric = [];

nric.multiples = [ 2, 7, 6, 5, 4, 3, 2 ];

nric.isNricValid = function (theNric) {

    if (!theNric || theNric == '')
    {
        return false;
    }

    if (theNric.length != 9)
    {
        return false;
    }

    var total = 0
        , count = 0
        , numericNric;
    var first = theNric[0]
        , last = theNric[theNric.length - 1];

    if (first != 'S' && first != 'T')
    {
        return false;
    }

    numericNric = theNric.substr(1, theNric.length - 2);

    if (isNaN(numericNric)) {
        return false
    }

    while (numericNric != 0)
    {
        total += (numericNric % 10) * nric.multiples[nric.multiples.length - (1 + count++)];

        numericNric /= 10;
        numericNric = Math.floor(numericNric);
    }

    var outputs;
    if (first == 'S')
    {
        outputs = [ 'J', 'Z', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A' ];
    }
    else
    {
        outputs = [ 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'J', 'Z', 'I', 'H' ];
    }

    return last == outputs[total % 11];

}

nric.isFinValid = function(fin)
{
    if (!fin || fin == '')
    {
        return false;
    }

    if (fin.length != 9)
    {
        return false;
    }

    var total = 0
        , count = 0
        , numericNric;
    var first = fin[0]
        , last = fin[fin.length - 1];

    if (first != 'F' && first != 'G')
    {
        return false;
    }

   numericNric = fin.substr(1, fin.length - 2);

    if (isNaN(numericNric)) {
        return false;
    }

    while (numericNric != 0)
    {
        total += (numericNric % 10) * nric.multiples[nric.multiples.length - (1 + count++)];

        numericNric /= 10;
        numericNric = Math.floor(numericNric);
    }

    var outputs;
    if (first == 'F')
    {
        outputs = [ 'X', 'W', 'U', 'T', 'R', 'Q', 'P', 'N', 'M', 'L', 'K' ];
    }
    else
    {
        outputs = [ 'R', 'Q', 'P', 'N', 'M', 'L', 'K', 'X', 'W', 'U', 'T' ];
    }

    return last == outputs[total % 11];
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-11T01:29:16.563

经过一番搜索，我找到了一种验证它们的方法。这并不一定意味着 FIN 有效，只是它在有效范围内。

我基于[http://www.ngiam.net/NRIC/ppframe.htm的算法](http://www.ngiam.net/NRIC/ppframe.htm)

我还提供了一种类似的检查 NRIC 的方法，因为我认为任何遇到这种情况并对其中一个感兴趣的人也会对另一个感兴趣。

希望这对某人有帮助！

```
 private static readonly int[] Multiples = { 2, 7, 6, 5, 4, 3, 2 };

    public static bool IsNricValid(string nric)
    {
        if (string.IsNullOrEmpty(nric))
        {
            return false;
        }

        //  check length
        if (nric.Length != 9)
        {
            return false;
        }

        int total = 0
            , count = 0
            , numericNric;
        char first = nric[0]
            , last = nric[nric.Length - 1];

        if (first != 'S' && first != 'T')
        {
            return false;
        }

        if (!int.TryParse(nric.Substring(1, nric.Length - 2), out numericNric))
        {
            return false;
        }

        while (numericNric != 0)
        {
            total += numericNric % 10 * Multiples[Multiples.Length - (1 + count++)];

            numericNric /= 10;
        }

        char[] outputs;
        if (first == 'S')
        {
            outputs = new char[] { 'J', 'Z', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A' };
        }
        else
        {
            outputs = new char[] { 'G', 'F', 'E', 'D', 'C', 'B', 'A', 'J', 'Z', 'I', 'H' };
        }

        return last == outputs[total % 11];

    }

    public static bool IsFinValid(string fin)
    {
        if (string.IsNullOrEmpty(fin))
        {
            return false;
        }

        //  check length
        if (fin.Length != 9)
        {
            return false;
        }

        int total = 0
            , count = 0
            , numericNric;
        char first = fin[0]
            , last = fin[fin.Length - 1];

        if (first != 'F' && first != 'G')
        {
            return false;
        }

        if (!int.TryParse(fin.Substring(1, fin.Length - 2), out numericNric))
        {
            return false;
        }

        while (numericNric != 0)
        {
            total += numericNric % 10 * Multiples[Multiples.Length - (1 + count++)];

            numericNric /= 10;
        }

        char[] outputs;
        if (first == 'F')
        {
            outputs = new char[] { 'X', 'W', 'U', 'T', 'R', 'Q', 'P', 'N', 'M', 'L', 'K' };
        }
        else
        {
            outputs = new char[] { 'R', 'Q', 'P', 'N', 'M', 'L', 'K', 'X', 'W', 'U', 'T' };
        }

        return last == outputs[total % 11];
    } 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-04-16T13:10:00.700

以下是 NRIC 和 FIN 算法的 URL。

[http://www.arjun.com.np/blog/all-about-nric-number-in-singapore/](http://www.arjun.com.np/blog/all-about-nric-number-in-singapore/)

```
public class NRIC_FIN {

    public static void main(String[] args) {

        String idNumber = "T123d121J";
        String NRIC = idNumber.toUpperCase();
        String number;
        int sum = 0;
        if (NRIC.length() != 9) {
            System.out.println("must be 9 digits..");
            return;
        }

        number = NRIC.substring(1, 8);

        if (!isNAN(at(number, 0)))
            sum += valueOf(at(number, 0)) * 2;
        if (!isNAN(at(number, 1)))
            sum += valueOf(at(number, 1)) * 7;
        if (!isNAN(at(number, 2)))
            sum += valueOf(at(number, 2)) * 6;
        if (!isNAN(at(number, 3)))
            sum += valueOf(at(number, 3)) * 5;
        if (!isNAN(at(number, 4)))
            sum += valueOf(at(number, 4)) * 4;
        if (!isNAN(at(number, 5)))
            sum += valueOf(at(number, 5)) * 3;
        if (!isNAN(at(number, 6)))
            sum += valueOf(at(number, 6)) * 2;

        if (NRIC.charAt(0) == 'T' || NRIC.charAt(0) == 'G') {
            sum += 4;
        }

        char checkChar = NRIC.charAt(8);

        double p = 11 - (sum % 11);

        if (NRIC.charAt(0) == 'S' || NRIC.charAt(0) == 'T') {

            if ((p == 1 && checkChar == 'A') || (p == 2 && checkChar == 'B')
                    || (p == 3 && checkChar == 'C')
                    || (p == 4 && checkChar == 'D')
                    || (p == 5 && checkChar == 'E')
                    || (p == 6 && checkChar == 'F')
                    || (p == 7 && checkChar == 'G')
                    || (p == 8 && checkChar == 'H')
                    || (p == 9 && checkChar == 'I')
                    || (p == 10 && checkChar == 'Z')
                    || (p == 11 && checkChar == 'J')) {
                System.out.println("true...NRIC");
            }
        }

        if (NRIC.charAt(0) == 'F' || NRIC.charAt(0) == 'G') {
            if ((p == 1 && checkChar == 'K') || (p == 2 && checkChar == 'M')
                    || (p == 3 && checkChar == 'L')
                    || (p == 4 && checkChar == 'N')
                    || (p == 5 && checkChar == 'P')
                    || (p == 6 && checkChar == 'Q')
                    || (p == 7 && checkChar == 'R')
                    || (p == 8 && checkChar == 'T')
                    || (p == 9 && checkChar == 'U')
                    || (p == 10 && checkChar == 'W')
                    || (p == 11 && checkChar == 'X')) {
                System.out.println("true ...FIN");
            }

        }
        System.out.println("flase ...");
    }

    public static boolean isNAN(char c) {
        return !Character.isDigit(c);
    }

    public static int valueOf(char c) {
        return (((int) c) - 48);
    }

    public static char at(String from, int index) {
        return from.charAt(index);
    }
} 
```

# c# - c#：Type.GetType 从 exe 类型字符串上的 dll 调用

> ID：629666
> 
> 赞同：2
> 
> 时间：2009-03-10T10:58:12.697
> 
> 标签：c#, .net, reflection

我在*XmlSer.dll中有以下类*

```
namespace xmlser
{
        public class XmlSer
        {
                public Type test(string s)
                {
                    return Type.GetType(s);
                }

        //...other code

        }
} 
```

*以及MyApp.exe*中的以下代码，它将*XmlSer.dll*作为参考链接

```
namespace MyApp
{
    public class TestClass
    {
        public int f1 = 1;
        public float f2 = 2.34f;
        public double f3 = 3.14;
        public string f4 = "ciao";
    }

    class MainClass
    {

        public static void Main(string[] args)
        {
            TestClass tc = new TestClass();
            XmlSer ser = new XmlSer();
            Console.WriteLine(ser.test("MyApp.TestClass")!=null);
        }
} 
```

运行 MyApp.exe 我得到*false*，这意味着*XmlSer的**ser*实例无法获取*Testclass*的类型（结果为*null*）。将*XmlSer*类直接放在*MyApp.exe*代码中，我正确地获得了*TestClass*的类型。

 ***在网上查了一下，发现问题与程序集有关。这意味着 .exe 的程序集对*XmlSer.test*方法不可见，因此它无法解析*TestClass*的类型。

如何解决维护*XmlSer.dll*中的*XmlSer*和*MyApp.exe*中的*MyApp.MainClass*的问题？

谢谢。

亚历山德罗

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T11:07:31.847

由于两者不在同一个程序集中，您可能需要在类型字符串中包含程序集名称：

```
Console.WriteLine(ser.test("MyApp.TestClass, MyApp")!=null); 
```

* * *

如果您只想序列化任意对象，则可以执行以下操作：

```
public static class Serialization
{
    public static void Serialize(object o, Stream output)
    {
        var serializer = new XmlSerializer(o.GetType());
        serializer.Serialize(output, o);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T11:05:52.787

不确定，但也许试试 ser.Test("MyApp.TestClass, MyApp")？

编辑：显然 MyApp 不是 XmlSer

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T15:27:45.700

我找到了一个确定的解决方案。我只是获取从应用程序加载的所有程序集的向量。然后在每个程序集中我调用 Type.GetType 直到我得到一个有效的类型。通过这种方式，无论程序集如何，您都可以获得加载到进程空间中的每种类型。

下面是函数的代码。

```
public static Type GetGlobalType(string s)
        {
            Type t=null;
            Assembly[] av = AppDomain.CurrentDomain.GetAssemblies();
            foreach (Assembly a in av)
            {
                t=Type.GetType(s + "," + a.GetName());
                if (t != null)
                    break;
            }
            return t;
        } 
```

干杯:)

亚历山德罗

# c# - 为什么在 C# 中删除未使用的 using 指令？

> ID：629667
> 
> 赞同：123
> 
> 时间：2009-03-10T10:58:31.603
> 
> 标签：c#, .net, using

我想知道是否有任何原因（除了整理源代码）为什么开发人员使用`Usings`Visual Studio 2008 中的“删除未使用”功能？

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-03-10T11:03:01.857

有几个原因你想把它们拿出来。

*   这是毫无意义。他们没有增加任何价值。
*   这很令人困惑。该命名空间使用了什么？
*   如果你不这样做，那么`using`随着你的代码随着时间的推移而变化，你将逐渐积累毫无意义的语句。
*   静态分析较慢。
*   代码编译速度较慢。

另一方面，留下它们的理由并不多。我想您可以省去删除它们的麻烦。但如果你那么懒惰，你就有更大的问题！

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-10T11:23:44.180

我想说的恰恰相反——删除不需要的、不必要的 using 语句非常有帮助。

想象一下，您必须在 3、6、9 个月后返回您的代码 - 或者其他人必须接管您的代码并维护它。

如果您有一长串不需要的 using 语句，那么查看代码可能会非常混乱。如果该名称空间中没有使用任何内容，为什么要在其中使用？

我想就专业环境中的长期可维护性而言，我强烈建议让您的代码尽可能干净——这包括从中倾倒不必要的东西。更少的混乱等于更少的混乱，因此更高的可维护性。

马克

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-10-09T17:32:06.363

除了已经给出的原因之外，它还可以防止不必要的命名冲突。考虑这个文件：

```
using System.IO;
using System.Windows.Shapes;

namespace LicenseTester
{
    public static class Example
    {
        private static string temporaryPath = Path.GetTempFileName();
    }
} 
```

此代码无法编译，因为命名空间 System.IO 和 System.Windows.Shapes 都包含一个名为 Path 的类。我们可以通过使用完整的类路径来修复它，

```
 private static string temporaryPath = System.IO.Path.GetTempFileName(); 
```

或者我们可以简单地删除该行`using System.Windows.Shapes;`。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-08T05:35:51.287

IntelliSense 弹出窗口中的选项较少（特别是在命名空间包含大量扩展方法时）。

理论上 IntelliSense 也应该更快。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-09-17T14:06:41.027

在我看来，这是一个非常明智的问题，而回答的人却以相当轻率的方式对待这个问题。

我想说对源代码的任何更改都需要证明是合理的。这些变化可能会产生隐性成本，提出问题的人希望了解这一点。他们没有要求被称为“懒惰”，正如一个人所暗示的那样。

我刚刚开始使用 ReSharper，它开始对我负责的项目发出警告和样式提示。其中包括删除了多余的 using 指令，还有多余的限定符、大写等等。我的直觉是整理代码并解决所有提示，但我的业务负责人警告我不要进行不合理的更改。

我们使用自动构建过程，因此对我们的 SVN 存储库的任何更改都会产生我们无法链接到项目/错误/问题的更改，并且会触发自动构建和发布，而不会对以前的版本进行任何功能更改。

如果我们考虑删除冗余限定符，这可能会给开发人员造成混淆，因为我们的域和数据层中的类仅由限定符来区分。

如果我看一下正确使用不恰当的大写字母（即 ABCD -> Abcd），那么我必须考虑到 ReSharper 不会重构我们使用该引用类名的任何 Xml 文件。

因此，遵循这些提示并不像看起来那么简单，应该受到尊重。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-06-23T16:27:01.617

删除它们。更少的代码查看和思考可以节省时间和混乱。我希望更多的人能保持简单、整洁和整洁。这就像在你的房间里有脏衬衫和裤子。它很丑，你必须想知道它为什么在那里。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-10T11:01:25.340

代码编译得更快。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-03-03T09:22:43.887

最近我有了另一个原因，为什么删除未使用的导入非常有用和重要。

假设您有两个程序集，其中一个引用另一个（现在让我们调用第一个`A`和被引用的`B`）。现在，当您在 A 中有依赖于 B 的代码时，一切都很好。然而，在您的开发过程中的某个阶段，您注意到您实际上不再需要该代码，但您将 using 语句留在原处。现在，您不仅有一个无意义的`using`-directive，而且还有一个在过时的指令中没有使用的**程序集引用。**`B`这首先增加了编译所需的时间`A`，因为`B`也必须加载。

因此，这不仅是关于更清洁和更易于阅读的代码的问题，而且也是在生产代码中维护程序集引用的问题，其中并非所有引用的程序集*都存在*。

最后，在我们的示例中，我们必须将 B 和 A 一起发送，尽管 B 没有在 A 中的任何地方使用，而是在 - 部分中使用`using`。这将极大地影响*加载*程序集时的*运行时*性能。`A`

 ** * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-11-15T23:55:41.003

它还有助于防止错误的循环依赖，假设您在删除未使用的使用后还能够从项目中删除一些 dll/项目引用。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-02-26T02:57:43.537

至少在理论上，如果给你一个 C# .cs 文件（或任何单个程序源代码文件），你应该能够查看代码并创建一个模拟它需要的一切的环境。通过一些编译/解析技术，您甚至可以创建一个工具来自动完成它。如果您至少记住了这一点，那么您可以确保您理解代码文件所说的所有内容。

现在考虑一下，如果给你一个 .cs 文件，其中包含 1000 个`using`指令，而实际上只使用了 10 个指令。每当您查看引用外部世界的代码中新引入的符号时，您都必须通过这 1000 行来弄清楚它是什么。这显然减慢了上述过程。因此，如果您可以将它们减少到 10 个，那将会有所帮助！

在我看来，C#`using`指令非常弱，因为你不能指定单个泛型符号而不会丢失泛型，并且你不能使用`using`别名指令来使用扩展方法。在 Java、Python 和 Haskell 等其他语言中情况并非如此，在这些语言中，您能够（几乎）准确地指定您想要从外部世界获得什么。但即便如此，我还是建议尽可能使用`using`别名。

# ruby - 你如何覆盖 ruby 大小写相等运算符？(===)

> ID：629669
> 
> 赞同：6
> 
> 时间：2009-03-10T10:58:58.450
> 
> 标签：ruby, overloading

我有一个类，我想在 case 语句中与字符串和符号进行比较，所以我认为我只是为我的类覆盖了 ===() 方法，所有这些都是黄金。但是，我的 ===() 方法在 case 语句期间永远不会被调用。有任何想法吗？

这是一些示例代码，以及 irb 会话中发生的情况：

```
class A
   def initialize(x)
      @x=x #note this isn't even required for this example
   end
   def ===(other)
      puts "in ==="
      return true
   end
end 
```

> irb(main):010:0> a=A.new("hi")
> => #
> irb(main):011:0> case a
> irb(main):012:1> when "hi" then 1
> irb( main):013:1> else 2
> irb(main):014:1> end
> => 2

（它从不打印消息，无论如何都应该返回 true）请注意，理想情况下我想做一个

```
def ===(other)
          #puts "in ==="
          return @x.===(other)
end 
```

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T11:19:23.970

'case' 关键字之后的表达式是 === 表达式的右侧，而 'when' 关键字之后的表达式是表达式的左侧。因此，被调用的方法是 String.===，而不是 A.===。

反转比较的快速方法：

```
class Revcomp
    def initialize(obj)
        @obj = obj
    end

    def ===(other)
        other === @obj
    end

    def self.rev(obj)
        Revcomp.new(obj)
    end
end

class Test
    def ===(other)
        puts "here"
    end
end

t = Test.new

case t
when Revcomp.rev("abc")
    puts "there"
else
    puts "somewhere"
end 
```

# javascript - 如何从 Greasemonkey 脚本中截获 XMLHttpRequests？

> ID：629671
> 
> 赞同：52
> 
> 时间：2009-03-10T10:59:06.657
> 
> 标签：javascript, ajax, greasemonkey

我想使用 Greasemonkey 捕获 AJAX 请求的内容。

有人知道怎么做这个吗？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2015-03-27T04:35:55.920

接受的答案几乎是正确的，但它可能会有所改进：

```
(function(open) {
    XMLHttpRequest.prototype.open = function() {
        this.addEventListener("readystatechange", function() {
            console.log(this.readyState);
        }, false);
        open.apply(this, arguments);
    };
})(XMLHttpRequest.prototype.open); 
```

更喜欢使用 apply + arguments 而不是 call，因为这样您就不必明确知道所有提供给 open 的参数，这些参数可能会改变！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T11:20:09.960

修改 XMLHttpRequest.prototype.open 或 send 方法如何设置自己的回调并调用原始方法？回调可以做它的事情，然后调用回调指定的原始代码。

换句话说：

```
XMLHttpRequest.prototype.realOpen = XMLHttpRequest.prototype.open;

var myOpen = function(method, url, async, user, password) {
    //do whatever mucking around you want here, e.g.
    //changing the onload callback to your own version

    //call original
    this.realOpen (method, url, async, user, password);
}  

//ensure all XMLHttpRequests use our custom open method
XMLHttpRequest.prototype.open = myOpen ; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-01-27T17:04:24.650

在 Chrome 55 和 Firefox 50.1.0 中测试

在我的例子中，我想修改 responseText，它在 Firefox 中是一个只读属性，所以我必须包装整个 XMLHttpRequest 对象。我还没有实现整个 API（特别是 responseType），但它足以用于我拥有的所有库。

用法：

```
 XHRProxy.addInterceptor(function(method, url, responseText, status) {
        if (url.endsWith('.html') || url.endsWith('.htm')) {
            return "<!-- HTML! -->" + responseText;
        }
    }); 
```

代码：

```
(function(window) {

    var OriginalXHR = XMLHttpRequest;

    var XHRProxy = function() {
        this.xhr = new OriginalXHR();

        function delegate(prop) {
            Object.defineProperty(this, prop, {
                get: function() {
                    return this.xhr[prop];
                },
                set: function(value) {
                    this.xhr.timeout = value;
                }
            });
        }
        delegate.call(this, 'timeout');
        delegate.call(this, 'responseType');
        delegate.call(this, 'withCredentials');
        delegate.call(this, 'onerror');
        delegate.call(this, 'onabort');
        delegate.call(this, 'onloadstart');
        delegate.call(this, 'onloadend');
        delegate.call(this, 'onprogress');
    };
    XHRProxy.prototype.open = function(method, url, async, username, password) {
        var ctx = this;

        function applyInterceptors(src) {
            ctx.responseText = ctx.xhr.responseText;
            for (var i=0; i < XHRProxy.interceptors.length; i++) {
                var applied = XHRProxy.interceptors[i](method, url, ctx.responseText, ctx.xhr.status);
                if (applied !== undefined) {
                    ctx.responseText = applied;
                }
            }
        }
        function setProps() {
            ctx.readyState = ctx.xhr.readyState;
            ctx.responseText = ctx.xhr.responseText;
            ctx.responseURL = ctx.xhr.responseURL;
            ctx.responseXML = ctx.xhr.responseXML;
            ctx.status = ctx.xhr.status;
            ctx.statusText = ctx.xhr.statusText;
        }

        this.xhr.open(method, url, async, username, password);

        this.xhr.onload = function(evt) {
            if (ctx.onload) {
                setProps();

                if (ctx.xhr.readyState === 4) {
                     applyInterceptors();
                }
                return ctx.onload(evt);
            }
        };
        this.xhr.onreadystatechange = function (evt) {
            if (ctx.onreadystatechange) {
                setProps();

                if (ctx.xhr.readyState === 4) {
                     applyInterceptors();
                }
                return ctx.onreadystatechange(evt);
            }
        };
    };
    XHRProxy.prototype.addEventListener = function(event, fn) {
        return this.xhr.addEventListener(event, fn);
    };
    XHRProxy.prototype.send = function(data) {
        return this.xhr.send(data);
    };
    XHRProxy.prototype.abort = function() {
        return this.xhr.abort();
    };
    XHRProxy.prototype.getAllResponseHeaders = function() {
        return this.xhr.getAllResponseHeaders();
    };
    XHRProxy.prototype.getResponseHeader = function(header) {
        return this.xhr.getResponseHeader(header);
    };
    XHRProxy.prototype.setRequestHeader = function(header, value) {
        return this.xhr.setRequestHeader(header, value);
    };
    XHRProxy.prototype.overrideMimeType = function(mimetype) {
        return this.xhr.overrideMimeType(mimetype);
    };

    XHRProxy.interceptors = [];
    XHRProxy.addInterceptor = function(fn) {
        this.interceptors.push(fn);
    };

    window.XMLHttpRequest = XHRProxy;

})(window); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:30:57.517

您可以用包装器替换文档中的 unsafeWindow.XMLHttpRequest 对象。一点代码（未测试）：

```
var oldFunction = unsafeWindow.XMLHttpRequest;
unsafeWindow.XMLHttpRequest = function() {
  alert("Hijacked! XHR was constructed.");
  var xhr = oldFunction();
  return {
    open: function(method, url, async, user, password) {
      alert("Hijacked! xhr.open().");
      return xhr.open(method, url, async, user, password);
    }
    // TODO: include other xhr methods and properties
  };
}; 
```

但这有一个小问题：Greasemonkey 脚本在页面加载*后*执行，因此页面可以在其加载序列期间使用或存储原始 XMLHttpRequest 对象，因此在脚本执行之前发出的请求或使用真正的 XMLHttpRequest 对象将不会被跟踪由你的脚本。我无法解决这个限制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-12T11:15:35.247

基于提出的解决方案，我实现了可用于打字稿解决方案的“xhr-extensions.ts”文件。如何使用：

1.  将带有代码的文件添加到您的解决方案中

2.  像这样导入

    ```
    import { XhrSubscription, subscribToXhr } from "your-path/xhr-extensions"; 
    ```

3.  像这样订阅

    ```
    const subscription = subscribeToXhr(xhr => {
      if (xhr.status != 200) return;
      ... do something here.
    }); 
    ```

4.  当您不再需要订阅时取消订阅

    ```
    subscription.unsubscribe(); 
    ```

“xhr-extensions.ts”文件的内容

```
 export class XhrSubscription {

      constructor(
        private callback: (xhr: XMLHttpRequest) => void
      ) { }

      next(xhr: XMLHttpRequest): void {
        return this.callback(xhr);
      }

      unsubscribe(): void {
        subscriptions = subscriptions.filter(s => s != this);
      }
    }

    let subscriptions: XhrSubscription[] = [];

    export function subscribeToXhr(callback: (xhr: XMLHttpRequest) => void): XhrSubscription {
      const subscription = new XhrSubscription(callback);
      subscriptions.push(subscription);
      return subscription;
    }

    (function (open) {
      XMLHttpRequest.prototype.open = function () {
        this.addEventListener("readystatechange", () => {
          subscriptions.forEach(s => s.next(this));
        }, false);
        return open.apply(this, arguments);
      };
    })(XMLHttpRequest.prototype.open); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-10T11:02:26.570

不确定您是否可以使用greasemonkey，但如果您创建一个扩展，那么您可以使用观察者服务和http-on-examine-response 观察者。

# .net - 如何查明 .NET 程序集是否使用 TRACE 或 DEBUG 标志编译

> ID：629674
> 
> 赞同：10
> 
> 时间：2009-03-10T11:01:02.050
> 
> 标签：.net, assemblies, trace, release-mode

有什么方法可以在不修改程序集的情况下找出程序集是否已使用 TRACE 或 DEBUG 标志集进行编译？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T17:19:49.547

唯一最好的方法是检查编译的程序集本身。Rotem Bloom[在这里](http://www.codeplex.com/AssemblyInformation)找到了一个非常有用的工具，称为“.NET 程序集信息” 。安装后，它会关联 .dll 文件以自行打开。安装后，您只需双击程序集即可打开它，它将为您提供程序集详细信息，如下面的屏幕商店中所示。在那里您可以确定它是否已调试编译。

[替代文字 http://ruchitsurati.net/myfiles/asm_info.jpg](http://ruchitsurati.net/myfiles/asm_info.jpg)

[![替代文字](https://i.stack.imgur.com/5nERA.png)](https://i.stack.imgur.com/5nERA.png)
[（来源：[ruchitsurati.net](http://ruchitsurati.net/myfiles/release_assembly.PNG)）]

链接文本：http : [//www.codeplex.com/AssemblyInformation](http://www.codeplex.com/AssemblyInformation)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T11:48:14.993

[如何以编程方式检测程序集是否在调试或发布模式下编译，](http://www.hanselman.com/blog/HowToProgrammaticallyDetectIfAnAssemblyIsCompiledInDebugOrReleaseMode.aspx)来自 Scott Hanselman。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T11:09:41.700

```
static bool IsDebug(){
 bool rv = false;
 #if DEBUG
 rv = true;
 #endif
 return rv;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:19:56.777

可能没有通用的方法。但是，您可以查找对命名空间的引用`Assert`和`Debug`来自`System.Diagnostics`命名空间的引用。这些的存在将表明已设置 DEBUG 标志。

`Trace`TRACE 标志也是如此。

显然，如果源代码不使用这些命名空间中的类型，这将不起作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-08T18:39:16.533

上面提到的“IsDebug”应用程序实际上有一个错误，它没有反映正确的 DubuggableAttributes。它错误地假定如果 DebuggableAttribute 存在，则程序集不是 JIT 优化的。我在我的博客上提供了正确的实现：

**[如何判断程序集是调试还是发布](http://dave-black.blogspot.com/2011/12/how-to-tell-if-assembly-is-debug-or.html)**

# c# - 如何response.write bytearray？

> ID：629675
> 
> 赞同：42
> 
> 时间：2009-03-10T11:01:11.660
> 
> 标签：c#, asp.net

这不起作用：

```
byte[] tgtBytes = ...

Response.Write(tgtBytes); 
```

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-03-10T11:05:49.837

您可能正在寻找：

```
Response.BinaryWrite(tgtBytes); 
```

MSDN 文档[在这里](http://msdn.microsoft.com/en-us/library/ms524318.aspx)。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-10T11:04:13.773

```
Response.OutputStream.Write(tgtBytes, 0, tgtBytes.Length); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T11:03:54.460

如果要输出十六进制值

```
byte[] tgtBytes = ...
foreach (byte b in tgtBytes)
    Response.Write("{0:2x}", b); 
```

还是你想做的；

```
Response.Write(System.Text.Encoding.ASCII.GetString(tgtBytes)); 
```

将字节转换为 ASCII 文本并输出字符串。

# sql - SQL Server 未配置数据访问

> ID：629677
> 
> 赞同：30
> 
> 时间：2009-03-10T11:02:18.207
> 
> 标签：sql, sql-server, tsql, vb6

我正在从 VB 6 应用程序运行 SQL Server 2005 数据库。我通过 ODBC DSN 连接到数据库。

我将运行 SQL 服务器默认实例的计算机从“软件”重命名为“IT”。然后我运行`sp_dropserver`和`sp_addserver`存储过程来重命名实例。

在重新启动 SQL Server 服务时，服务器能够获取新的 SQL Server 名称。

将 ODBC 数据源名称配置为新名称后，连接正常。我能够运行我的应用程序并通过 ADO 记录集读取记录。但是我无法使用该`.Update`方法更新任何记录集。我收到以下错误...`SQL Server not configured for data access`

如何在重命名的服务器实例上启用数据访问？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-11T15:30:29.037

[如何：重命名承载 SQL Server 2005 独立实例的计算机](http://msdn.microsoft.com/en-us/library/ms143799(SQL.90).aspx)

您应该能够运行它，但**不能**针对任何链接服务器。它不是链接服务器。这是本地的。

```
EXEC sp_serveroption 'YourServer', 'DATA ACCESS', TRUE 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-04-15T11:30:04.720

只需转到链接服务器属性>服务器选项>数据访问-> true

适用于 SQL Server 2014。

问候

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-11-15T10:56:01.813

有了这个

```
use master
go

exec sp_serveroption 'server name', 'data access', 'true'
go 
```

为复制生成的链接服务器仍然显示相同的错误

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-06-04T14:02:42.603

我只是想补充一下之前的答案，至少在我这里的情况下，我需要在这两个地方启用数据访问。

例如：

有服务器 A 和服务器 B

在服务器 A 上，我有一个链接服务器 LB，它将我从服务器 A 链接到服务器 B

我需要执行以下操作：

-- 在服务器 A 上

```
exec sp_serveroption 'LB', 'data access', 'true' 
```

-- 在服务器 B

```
exec sp_serveroption 'B', 'data access', 'true' 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-10-13T11:54:22.910

我刚刚遇到这个错误，发现它是由于我试图对本地服务器运行 OpenQuery 引起的（doh！）。将服务器名称更改为实际链接服务器的名称解决了我的问题。

# visual-studio - Visual Studio 插件 - “文件处于僵尸状态”错误

> ID：629682
> 
> 赞同：1
> 
> 时间：2009-03-10T11:05:16.080
> 
> 标签：visual-studio, visual-studio-addins

我正在构建一个视觉工作室插件。我复制一个解决方案并对其内部的文件和文件夹结构执行各种操作。然后我将它加载到 Visual Studio 并继续加载预定义文件的列表，但是当我这样做时，我得到一个异常和一条消息，指出文件无法访问，因为它们处于僵尸状态。

这是我在 Connect.cs 中打开和加载的代码

```
 public void OpenCodeFile(String file)
    {
        try
        {
            _applicationObject.Documents.Open(file, Constants.vsViewKindCode, false);
        }
        catch (System.Exception e)
        {
            System.Console.Out.WriteLine(e.Message);
        }
    }

    public void OpenSolution(String file)
    {
        _applicationObject.Solution.Open(file);
    }

    private DTE2 _applicationObject;
    private AddIn _addInInstance; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T13:19:10.110

我用以下代码解决了我的问题：

```
 public void OpenCodeFile(String file)
    {
        try
        {
            _applicationObject.ExecuteCommand("File.OpenFile", file);
        }
        catch (System.Exception e)
        {
            System.Console.Out.WriteLine(e.Message);
        }
    } 
```

# php - 使用 php 删除记录的安全方法

> ID：629695
> 
> 赞同：0
> 
> 时间：2009-03-10T11:09:52.260
> 
> 标签：php, ajax, security

我有以下代码片段从给定主键的数据库中删除记录。这通过 AJAX 请求通过 GET 调用。任何要检查我的 JavaScript 的人都可以计算出 URL 并删除任意记录。我能做些什么来防止这种情况发生？

不使用GET？

使用会话？

```
if($cmd=="deleterec") {
    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";
    if ($delRecord = $con->prepare($deleteQuery)) {
        $delRecord->bind_param("s", $pk);
        $delRecord->execute();
        $delRecord->close();
        echo "true";
    } else {
        echo "false";
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T11:47:37.803

不使用 GET 不会改变任何事情。在您到达代码中的这一点之前，您必须使用会话来管理“访问控制”。

也就是说，当发出 AJAX 请求时，您应该在实际执行之前通过会话确认允许发出请求的人进行删除。

考虑一下如何以“非 AJAX”方式检查权限并在此处执行相同的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T11:32:55.140

您可以为您的记录提供一个非顺序的随机唯一 ID，以便在 AJAX 请求中使用。

虽然应该很容易集成到您当前的系统中，但仍然不是最安全的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T11:39:41.863

1.  使用 post 而不是 get
2.  在将执行此操作的任何形式中嵌入隐藏的唯一 ID，并检查返回的 ID 是否已由您发出
3.  混淆 URL/参数名称
4.  为行生成唯一的 ID，并且不要将它们暴露在外部，因此攻击者无法选择要删除的行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:40:36.867

好吧，如果不是每个人都可以删除记录，请确保此记录有密码，因此只有授权用户才能删除。让自己登录，然后在页面上添加一个“删除”按钮，然后在 PHP 端确保用户在处理命令时获得授权。

哦，是的，确保您始终通过 POST 传递一个确认值来验证，而不仅仅是一个 GET 参数，这是最佳实践，即使对于授权用户也是如此。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T12:14:23.543

您的问题有两个重要方面。

授权用户是否应该能够删除他们认为合适的任何记录？如果是这种情况，您的问题是确保请求来自授权用户。在这种情况下，使用 PHP 的会话是确保发出请求的是经过身份验证的用户的一种方法。当然，对于所有技术，您必须确保以正确的方式使用 PHP 会话。有很多关于那个mather的文章。[PHPsec.org 在这里有一个](http://phpsec.org/projects/guide/4.html)。

如果用户无法删除任何行，除了进行身份验证和会话之外，您还需要检查代码以验证该用户是否可以删除被删除的记录。现在这高度依赖于您的应用程序。例如，在项目管理软件中，可以允许删除与一个项目相关的任务，但不能删除与另一个项目相关的任务。这是您的业务逻辑的一部分。

最好的办法是同时执行这两项检查。一，您的应用程序必须验证进行删除的用户是否是有效用户并且被允许删除（使用 php 会话实现非常简单），二确保用户可以根据某种形式的所有权删除特定记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T11:17:00.153

不要通过 Ajax公开[CRUD方法。](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-02T14:02:10.873

如果用户被授权并允许删除，您必须在删除记录之前检查。

# python - 使用 Django 部署 Google Analytics

> ID：629696
> 
> 赞同：38
> 
> 时间：2009-03-10T11:09:57.003
> 
> 标签：python, django, deployment, google-analytics

我们即将部署一个新的 Django 网站，我们希望使用 Google Analytics 来跟踪网站上的流量。但是，我们不希望开发实例上的所有点击都有助于 Google Analytics 统计。

我们有几种方法可以解决这个问题：

*   在 settings.py 中有一个配置选项，基本模板使用它来决定是否包含适当的`<script>`元素，
*   在部署到生产服务器之前维护一个我们拉入的分支，我们确保它包括`<script>`元素，
*   使用 Google Analytics 阻止对 127.0.0.1 或 localhost 的点击，或者
*   别的东西。

第一个选项似乎是最明智的，但我不确定是否是。例如，我们是否必须开始将一个`google_analytics`变量传递给我们所有的视图？

你怎么认为？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-03-10T11:17:08.330

首先，创建一种让您的开发和生产服务器从不同文件（例如 dev.py 和 prod.py）中提取设置的方法。有很多方法可以做到这一点。

然后，创建一个设置，`GOOGLE_ANALYTICS_KEY`. 在 dev.py 中将其设置为空字符串。在 prod.py 中，将其设置为您的密钥，例如“UA-124465-1”。创建一个[上下文处理器](http://docs.djangoproject.com/en/dev/ref/templates/api/#writing-your-own-context-processors)以将此设置添加到您的所有模板上下文中`GOOGLE_ANALYTICS_KEY`，或者直接添加您的设置模块。然后，在您的模板中，使用它有条件地包含您的分析代码：

```
{% if settings.GOOGLE_ANALYTICS_KEY %}
<script> blah blah {{settings.GOOGLE_ANALYTICS_KEY}} blah blah </script>
{% endif %} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-10-13T12:45:30.047

聚会有点晚了，但有一个可重用的 Django 应用程序，名为[django-google-analytics](http://github.com/montylounge/django-google-analytics)。最简单的使用方法是：

1.  将`google_analytics`应用程序添加到您`INSTALLED_APPS`的`settings.py`.
2.  在您的基本模板中，通常是 a `base.html`，在最顶部插入此标签：`{% load analytics %}`
3.  在同一模板中，在结束正文标记之前插入以下代码：`{% analytics "UA-xxxxxx-x" %}`这`UA-xxxxxx-x`是您的域的唯一 Google Analytics（分析）代码。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-09-16T16:12:53.713

我的解决方案采用与 Ned 的首选答案类似的方法，但将分析代码分离到自己的模板中。我更喜欢这个，所以我可以将模板从一个项目复制到另一个项目。

这是我的 context_processor 文件中的一个片段：

```
from django.conf import settings
from django.template.loader import render_to_string

def analytics(request):
    """
    Returns analytics code.
    """
    if not settings.DEBUG:
        return { 'analytics_code': render_to_string("analytics/analytics.html", { 'google_analytics_key: settings.GOOGLE_ANALYTICS_KEY }) }
    else:
        return { 'analytics_code': "" } 
```

当然，您需要告诉 Django 将其包含在您的上下文中。在您的 settings.py 文件中，包括：

```
TEMPLATE_CONTEXT_PROCESSORS = (
    ...
    "context_processors.analytics",
) 
```

我将其设置为仅在 DEBUG 设置为 False 时才包含分析代码，但您可能更愿意将其关闭其他内容，也许完全是一个新设置。我认为 DEBUG 是一个很好的默认设置，因为它假设您在调试/开发时不想跟踪任何命中。

使用您的 Google Analytics Key 创建设置：

```
GOOGLE_ANALYTICS_KEY = "UA-1234567-8" 
```

创建一个名为“analytics/analytics.html”的模板，其中包括以下内容：

```
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("{{ google_analytics_key }}");
pageTracker._trackPageview();
} catch(err) {}</script> 
```

最后，就在 base.html 模板的结束标记之前，添加以下内容：

```
{{ analytics_code }} 
```

现在，只有当 DEBUG=False 时才会包含您的分析代码。否则，将不包含任何内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-07-09T17:49:45.653

所有这些其他解决方案可能都有效，但现在它们都过大了，因为您可以轻松地在 Google Analytics 中设置过滤器来过滤掉所有不是来自您的生产网站或网站的流量。请参阅GA 帮助中的[创建/管理配置文件过滤器。](http://support.google.com/analytics/bin/answer.py?hl=en&answer=1034823)没有代码的解决方案只会让每个人的生活更轻松。

**注意**：有两个警告

1.  这不适用于实时过滤，因为没有过滤器应用于实时（截至 2012 年 7 月——检查他们的文档）
2.  您必须是拥有 Google Analytics（分析）帐户的管理员才能进行设置

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-12-22T14:36:12.640

另一种简单的方法。在`settings.py`中，勾选`debug`为`True`，然后添加：

```
INTERNAL_IPS = (
    '127.0.0.1',
    'localhost',
) 
```

然后你可以在你的模板中使用这样的东西：

```
{% if not debug %}
<script> blah blah </script>
{% endif %} 
```

如果要更改为生产，请设置`debug`为`False`。

参考： http: [//www.djangobook.com/en/2.0/chapter09.html](http://www.djangobook.com/en/2.0/chapter09.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T12:19:36.837

我基本同意 Ned，尽管我有一个名为 IS_LIVE_SITE 的设置，它可以切换分析代码、广告和其他一些东西。通过这种方式，我可以将所有键保持在颠覆状态（因为查找它们很痛苦）并且仍然可以轻松地打开或关闭它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-11T01:48:06.363

无需将脚本标签直接包含在您的 html 中，只需更改分析 javascript，使其仅在 href 不包含您的产品站点名称时运行。这将在没有任何额外配置的情况下工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-10T11:18:58.417

您有模板上下文处理器，可用于将值传递给所有模板，而无需更新所有视图。

[http://docs.djangoproject.com/en/dev/ref/settings/#template-context-processors](http://docs.djangoproject.com/en/dev/ref/settings/#template-context-processors)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-03-25T22:16:43.070

大家好，这是一篇很老的帖子。但是由于我花了一些时间搜索一些仍在积极维护的可重用应用程序，所以我想分享我发现的内容：

[https://github.com/jcassee/django-analytical](https://github.com/jcassee/django-analytical)

该项目仍在积极维护中，不需要将 ID 添加到数据库中（我认为如果每个站点有一个项目会更好），因此无论环境是开发还是生产环境，它都在代码中裸露。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-20T01:51:04.173

这是我解决它的简单方法：

如果您还没有，请在您的项目中创建一个名为“utils”的应用程序。请参阅[这些说明](http://ygamretuta.me/2011/03/08/django-creating-a-custom-template-context-processor/)。

但是，请遵循此方法以包括除项目设置之外的所有全局上下文处理器。这似乎是一种更好的做法。以下是[说明](http://blog.madpython.com/2010/04/07/django-context-processors-best-practice/)。

因此，在创建“utils”应用程序后，在 /utils 中创建一个名为 context_processors.py 的文件，如下所示：

```
from django.conf import settings

def googleanalytics(request):
    return {
        'google_tracking_id' : settings.GOOGLE_TRACKING_ID,
    } 
```

在您的 settings.py 文件中，添加以下内容：

```
import django.conf.global_settings as DEFAULT_SETTINGS

TEMPLATE_CONTEXT_PROCESSORS = DEFAULT_SETTINGS.TEMPLATE_CONTEXT_PROCESSORS + (
     'utils.context_processors.googleanalytics', 
```

)

希望这可以帮助！

# .net - 如何访问应用程序级对象（即记录器、容器、工作单元）？

> ID：629697
> 
> 赞同：1
> 
> 时间：2009-03-10T11:10:11.870
> 
> 标签：.net

设置和保留这些“全局”对象的最佳实践是什么？

我遇到过这个问题几次

*   ORM 会话对象（来自 DevExpress 的 XPO）

*   IOC 容器 (Microsoft.Unity)

*   记录器（来自 The Object Guy）

关于如何处理这个问题，我提出了三个选项：

1.  **依赖注入**。这对我来说看起来非常麻烦，我觉得每个类都被几乎所有类都会使用的额外三个 getter/setter 膨胀。另一方面，它摆脱了对全局变量的恐惧，并使代码位之间的依赖性降低。

2.  **创建一个**可设置一次并返回保留对象的静态类（例如 ContainerKeeper）。我知道这类似于单例，我应该使用单例。

3.  **使用单例模式**。我已经阅读了一些关于使用单例以及它们有多糟糕等的讨论，所以坦率地说，我不确定在这些情况下使用一个会破坏多少良好的 OO 设计原则。

所以我的问题改写为：

还有其他选择吗，我是否完全偏离了轨道？你会怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T11:20:34.343

我通常使用依赖注入，这将是选项 1。但我通常使用属性而不是使用构造函数参数进行注入。这清理了我的构造函数。我使用 Castle Windsor 作为 IoC 容器。它允许我将设置代码从构造函数移动到 Initialize 方法，在我实现 IInitializable 接口时设置所有依赖项后调用该方法。但我的猜测是 Unity 也支持这样的东西。

选项 2 和 3 不是最佳选择。通过调用静态，您可以将代码与它所依赖的类的实现联系起来。注入它们只会将您的代码与依赖项的接口联系起来。

* * *

您确实需要容器对象。但通常只在最高级别。依赖关系等的依赖关系会自动解决，温莎城堡会这样做，我很确定统一也会这样做。我通常不会将 IoC 容器用于需要动态构建的对象，因此我通常不需要对较低级别的容器进行引用。当我确实需要这个时，有一些技巧可以让容器将自身注入到依赖它的类中。得为此写一篇博文。完成后我会告诉你的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T12:25:00.567

我会将它们放在您自己设计的接口后面并调用全局实例。这样你就不会被束缚在那个特定的实现上。您清楚地定义了这些服务正在使用的内容。最后避免让这些类变得混乱。

就像任何事情一样，这是一个判断电话。确保您所做的全球化是真正的全球服务。例如，Logger 绝对是一个不错的选择。

# parameters - Common Lisp：使用 &rest 参数

> ID：629699
> 
> 赞同：14
> 
> 时间：2009-03-10T11:10:26.473
> 
> 标签：parameters, lisp, common-lisp

谁能告诉我如何使用存储在 &rest 指定的值中的参数。

我已经阅读了很多，似乎作者只知道如何列出所有参数。

```
(defun test (a &rest b) b) 
```

这很高兴看到，但并不是那么有用。

到目前为止，我发现的最好的方法是使用 first、second 等来获取您正在寻找的参数。

```
(defun test (a &rest b)
    (first b)) 
```

我注意到这个方法在第十个参数处停止工作，但规范（根据我读过的内容）支持至少 50 个。即使我使用 50 个参数的可能性很小，我想知道如何访问它们。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T11:14:44.013

休息参数只是一个列表。您可以使用普通的列表操作来处理它。

```
(defun test (a &rest b))
  (dolist (s b)
    (when (> s 1)
      (print s)
      (do-something-else b))) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T11:26:56.073

FIRST、SECOND 等访问函数是 CAR/CDR 或 NTH 之上的“只是”实用函数。所以，我想，您的具体问题的答案是“使用 NTH 或 ELT”（或构建您自己的特定访问函数）。

如果需要，可以将 ELEVENTH 定义为：

> （defun第十一（名单）（第n 10名单））

然而，我发现，当我想要处理 0 件或更多件事情时，我主要使用 &REST 参数，而不是真正关心给定参数在 &REST 列表中的具体位置。这通常需要使用 LOOP、DO 或 DOLIST 来遍历参数并对每个参数做一些事情；MAP 系列或（偶尔）REDUCE。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T12:00:07.040

其实这个功能很有用。你只需要尝试一下。

```
CL-USER 1 > (defun test (a &rest b) b)
TEST

CL-USER 2 > (test 1 2 3 4)
(2 3 4) 
```

所以你看到 B 只是一个参数列表。所以每个列表和序列操作都适用。没有什么魔法。有访问第 N 个元素的函数、删除元素的函数等。

在 Common Lisp HyperSpec 中列出了相关函数：

[14\. 康塞斯词典](http://www.lispworks.com/documentation/HyperSpec/Body/c_conses.htm)

[17\. 序列字典](http://www.lispworks.com/documentation/HyperSpec/Body/c_sequen.htm)

有关基本的 Lisp 教程，请查看 Touretzky 的书：

[Common Lisp：符号计算的简单介绍](http://www.cs.cmu.edu/~dst/LispBook/index.html)

这本书可以 PDF 和 Postscript 下载。它教授基本的 Common Lisp。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T13:41:44.160

您还可以使用解构绑定：

```
(defun my-function (&rest arguments)
  (destructuring-bind (a b &rest c) arguments
    (format nil "~A,~A followed with ~A" a b c)))

CL-USER> (my-function 1 2 "Give" 'me "more" 'arguments!!)
==> "1,2 followed with (Give ME more ARGUMENTS!!)" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-28T20:44:27.567

我只是有一个递归迭代来遍历它们，我猜 dolist 更好，但我喜欢使用老式的方式

# windows - 多个进程写入单个日志文件

> ID：629710
> 
> 赞同：4
> 
> 时间：2009-03-10T11:16:08.707
> 
> 标签：windows, iis, logging

这旨在成为一个轻量级的通用解决方案，尽管问题当前出在 IIS CGI 应用程序上，该应用程序需要记录事件的时间线（第二个解决方案），以解决稍后请求在较早请求之前在 MySQL 数据库中结束的情况！

因此，它归结为在单个文本文件中记录调试语句。

我可以编写一个管理队列的服务，如该线程中所建议的那样： [Issue writing to single file in Web service in .NET](https://stackoverflow.com/questions/119548/problem-in-writing-to-single-file-in-web-service-in-net) but deploy the service on each machine is a pain

或者我可以使用全局互斥锁，但这需要每个实例为每次写入打开和关闭文件

或者我可以使用一个数据库来为我处理这个问题，但是使用 MySQL 之类的数据库来尝试解决自身的时间线问题是没有意义的。SQLite 是另一种可能性，但这个线程

[http://www.perlmonks.org/?node_id=672403](http://www.perlmonks.org/?node_id=672403)

暗示这也不是一个好的选择。

我真的在寻找一种简单的方法，就像为每个进程写入单个文件并通过计划的应用程序将它们合并起来一样直截了当。我不想过度设计它，也不想花一周时间来实现它。它只是偶尔需要。

建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T11:21:05.730

首先尝试最简单的解决方案 - 每次写入日志都会打开和关闭文件。如果您遇到此问题（您可能不会），请寻找其他解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T12:14:51.060

您可以使用文件锁定。锁定文件以进行写入，写入消息，解锁。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T11:31:38.887

我的建议是保持性能，然后考虑异步日志记录。为什么不使用 UDP 将您的数据日志信息发送到服务侦听端口并写入日志文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:38:27.543

我还建议使用某种中央记录器，可以由每个进程以异步方式调用。如果通信是 UDP 或 RPC 或其他任何实现细节。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-25T21:39:04.377

即使认为这是一个旧帖子，有没有人知道为什么不使用以下概念：

1.  创建/打开共享模式为 FILE_SHARE_WRITE 的文件。
2.  有一个命名的全局互斥体，并打开它。
3.  每当需要写入文件时，首先锁定互斥体，然后写入文件。

有输入吗？

# c# - 如何为应用程序设置 C# 库路径？

> ID：629712
> 
> 赞同：11
> 
> 时间：2009-03-10T11:16:31.480
> 
> 标签：c#, .net, gac, distribution

我有使用 dll 的 C# 应用程序。当我尝试运行应用程序时，它找不到 dll，除非它位于同一目录或 GAC 中。我不想将它放在同一个目录中，也不想将它安装到 GAC。有什么方法可以告诉应用程序在哪里寻找库？（例如，如果我想将应用程序分发给客户并且他们想使用自己的应用程序来使用 dll。）

添加：

我想要这个文件结构：

MainFolder：库，应用程序

库：lib.dll

应用程序：app1.exe

我不想将它复制到 GAC 或在文件夹 Applications 中包含 lib.dll。可能吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T11:21:35.853

我建议您的客户的应用程序复制他们在自己的目录中使用的 dll。

VB6 用于在应用程序之间共享 dll，我们有一个术语：[DLL Hell](http://en.wikipedia.org/wiki/DLL_hell)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T11:18:10.197

遵循[MSDN 上的此指南：指定程序集的位置](http://msdn.microsoft.com/en-us/library/4191fzwb.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-10T11:39:30.927

在你的主要：

```
 AppDomain.CurrentDomain.AssemblyResolve += (s,e)=>{
    var filename = new AssemblyName(e.Name).Name;
    var path = string.format(@"C:\path\to\assembly\{0}.dll",  filename);
    return Assembly.LoadFrom(path);
 }; 
```

添加一些异常处理

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T11:22:44.773

正如您之前问题的答案所说，该 DLL 必须位于 GAC 或应用程序的目录或子目录中。

如果您的客户想要使用 DLL 编写他们自己的应用程序，您应该将其安装在 GAC 中或让他​​们也复制 DLL。拥有库的多个副本*听起来*不是一件好事，但它确实是：这意味着您可以将一个副本升级到不同的版本而不会破坏其他所有内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-06T06:48:37.123

没有 GAC 也是可能的，但程序集必须是强命名的，并且您必须在版本或 publickeytoken 更改时对 app.config 进行更改。这就是我在 \ 中的主程序，在 \Shared 中的共享库。和一个我想在 \SDK 中分离的子程序，它使用 ..\Shared 作为程序集。

```
<runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <probing privatePath="shared" />
      <dependentAssembly>
         <assemblyIdentity name="protobuf-net" publicKeyToken="257b51d87d2e4d67" />
         <codeBase version="1.0.0.282" href="../protobuf-net.dll"/>
       </dependentAssembly>
       <dependentAssembly>
         <assemblyIdentity name="SevenUpdate.Base" publicKeyToken="5d1aea1de74f122c" />
         <codeBase version="11.5.4.0" href="../SevenUpdate.Base.dll"/>
       </dependentAssembly>
       <dependentAssembly>
         <assemblyIdentity name="SharpBits.Base" publicKeyToken="5d1aea1de74f122c" />
         <codeBase version="11.5.5.0" href="../SharpBits.Base.dll"/>
       </dependentAssembly>
       <dependentAssembly>
         <assemblyIdentity name="System.Windows" publicKeyToken="5d1aea1de74f122c" />
         <codeBase version="11.5.5.0" href="../System.Windows.dll"/>
       </dependentAssembly>
       <dependentAssembly>
         <assemblyIdentity name="WPFLocalizeExtension" publicKeyToken="5d1aea1de74f122c" />
         <codeBase version="11.5.5.0" href="../WPFLocalizeExtension.dll"/>
       </dependentAssembly>
    </assemblyBinding>
  </runtime> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T11:20:44.467

就像我在回答您上一个问题时所说的那样：

在 app.config 或 machine.config 中使用[程序集重定向说明。](http://msdn.microsoft.com/en-us/library/2fc472t2(vs.71).aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T11:31:10.323

您可以记录，然后查看框架尝试加载程序集的操作。这使得诊断装配负载错误变得非常容易。

执行这两个操作的工具是“FUSLOGVW.exe”（Fusion Log Viewer，Fusion 是加载程序的名称）并包含在 SDK 中。

# asp.net - 将 ASP.NET 页面作为 HTML 页面中的控件托管？

> ID：629716
> 
> 赞同：0
> 
> 时间：2009-03-10T11:17:20.607
> 
> 标签：asp.net, controls

这听起来像是“你为什么要那样做？” 有点问题，但这里有..

我有一个非常简单的 ASP.NET 页面，它通过分页简单地呈现出大约 10 行的单列网格。

目前，我需要（由于一些技术限制）基本上在基本 HTML 页面上的 IFRAME 中托管 ASP.NET 页面。它当然有效，尽管我想知道是否有更好的方法？

出于某种原因，我在想像silverlight（我最终可能会使用）这样的东西是一个容器..或其他一些ActiveX类型的控件..

希望这足以解释？

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:22:16.523

您也许可以使用 XmlHttpRequest 将 ASP.NET 页面上的内容提取到 HTML 元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:43:31.027

你是对的，这几乎是一种“你为什么要这样做”的事情。但是，我们都知道，由于经理不了解杰克开发网站等方面的知识，您并不总是可以控制自己想做的事情 :) 因为我一直处于类似的位置并被迫这样做几乎完全相同。

无论如何，我相信你这样做的方式是最简单的方式。您可能需要注意的唯一一件事（我不知道您是否从不同的域运行，因为问题没有指定）是跨域脚本。例如，如果您的 ASP.NET 页面位于 www.myaspdomain.com 而您的 HTML 页面位于 www.myhtmldomain.com，则跨域脚本或 IFRAME 和 ASP.NET 页面之间的脚本可能会导致一些有趣的错误（功能？）因为这样的脚本打开了安全漏洞，因此现在大部分都被阻止了。

# asp.net - 带会话的 NHibernate 线程安全

> ID：629719
> 
> 赞同：12
> 
> 时间：2009-03-10T11:18:22.490
> 
> 标签：asp.net, nhibernate, thread-safety, httpcontext

我已经使用 NHibernate 一段时间了，并且不时发现如果我尝试同时请求两个页面（或尽可能接近），它偶尔会出错。所以我认为这是因为我的会话管理不是线程安全的。

我以为这是我的课，所以我尝试使用与这篇博文不同的方法[http://pwigle.wordpress.com/2008/11/21/nhibernate-session-handling-in-aspnet-the-easy-way/](http://pwigle.wordpress.com/2008/11/21/nhibernate-session-handling-in-aspnet-the-easy-way/)但是我仍然遇到同样的问题。我得到的实际错误是：

```
Server Error in '/AvvioCMS' Application.
failed to lazily initialize a collection, no session or session was closed
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: NHibernate.LazyInitializationException: failed to lazily initialize a collection, no session or session was closed 
```

要么打开要么没有打开数据读取器，但这是罪魁祸首。

我把我的会话管理课程放在下面，有人能发现我为什么会遇到这些问题吗？

```
public interface IUnitOfWorkDataStore
{
    object this[string key] { get; set; }
}

    public static Configuration Init(IUnitOfWorkDataStore storage, Assembly[] assemblies)
    {
        if (storage == null)
            throw new Exception("storage mechanism was null but must be provided");

        Configuration cfg = ConfigureNHibernate(string.Empty);
        foreach (Assembly assembly in assemblies)
        {
            cfg.AddMappingsFromAssembly(assembly);
        }

        SessionFactory = cfg.BuildSessionFactory();
        ContextDataStore = storage;

        return cfg;
    }

    public static ISessionFactory SessionFactory { get; set; }
    public static ISession StoredSession
    {
        get
        {
            return (ISession)ContextDataStore[NHibernateSession.CDS_NHibernateSession];
        }
        set
        {
            ContextDataStore[NHibernateSession.CDS_NHibernateSession] = value;
        }
    }

    public const string CDS_NHibernateSession = "NHibernateSession";
    public const string CDS_IDbConnection = "IDbConnection";

    public static IUnitOfWorkDataStore ContextDataStore { get; set; }

    private static object locker = new object();
    public static ISession Current 
    {
        get 
        {
            ISession session = StoredSession;

            if (session == null) 
            {
                lock (locker)
                {
                    if (DBConnection != null)
                        session = SessionFactory.OpenSession(DBConnection);
                    else
                        session = SessionFactory.OpenSession();

                    StoredSession = session;
                }
            }

            return session;
        }
        set
        {
            StoredSession = value;
        }
    }

    public static IDbConnection DBConnection
    {
        get
        {
            return (IDbConnection)ContextDataStore[NHibernateSession.CDS_IDbConnection];
        }
        set
        {
            ContextDataStore[NHibernateSession.CDS_IDbConnection] = value;
        }
    }

} 
```

我正在使用的实际商店是这样的：

```
public class HttpContextDataStore : IUnitOfWorkDataStore
{
    public object this[string key]
    {
        get { return HttpContext.Current.Items[key]; }
        set { HttpContext.Current.Items[key] = value; }
    }
} 
```

我在 Application_Start 上初始化 SessionFactory：

```
NHibernateSession.Init(new HttpContextDataStore(), new Assembly[] { 
                typeof(MappedClass).Assembly}); 
```

**更新**

谢谢你的建议。我尝试了一些不同的方法来尝试简化代码，但我仍然遇到相同的问题，我可能知道原因。

我在需要时为每个请求创建会话，但在我的 global.asax 中，我正在处理 Application_EndRequest 上的会话。但是，当我在加载页面结束时进行调试时，我发现 Application_EndRequest 被多次触发。我认为该事件只假设在请求结束时触发一次，但如果不是，并且其他一些项目正在尝试使用 Session （这是错误所抱怨的），无论出于什么奇怪的原因可能是我的问题，会话仍然是线程安全的，它只是被提前处理掉了。

有人有什么想法吗？我做了一个谷歌，看到 VS 开发服务器确实会导致这样的问题，但我是通过 IIS 运行它。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-10T19:37:44.460

虽然我还没有看到你的整个代码库或你试图解决的问题，但重新思考你如何使用 NHibernate 可能是正确的。从[文档](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/transactions.html)中：

> 在创建 NHibernate 会话时，您应该遵守以下做法：
> 
> *   切勿为每个数据库连接创建多个并发 ISession 或 ITransaction 实例。
>     
>     
> *   在为每个数据库的每个事务创建多个 ISession 时要格外小心。ISession 本身会跟踪对加载对象所做的更新，因此不同的 ISession 可能会看到陈旧的数据。
>     
>     
> *   **ISession*不是*线程安全的！**永远不要在两个并发线程中访问同一个 ISession。ISession 通常只是一个*单一的工作单元*！

最后一点与我所说的最相关（在多线程环境的情况下也很重要）。一个 ISession 应该被用于一个小的原子操作，然后被释放。同样来自文档：

> ISessionFactory 是一个创建成本高、线程安全的对象，旨在由所有应用程序线程共享。ISession 是一个廉价的、非线程安全的对象，应该为单个业务流程使用一次，然后丢弃。

结合这两个想法，而不是存储 ISession 本身，存储会话工厂，因为那是“大”对象。然后，您可以使用类似 SessionManager.GetSession() 作为包装器从会话存储中检索工厂并实例化会话并将其用于一项操作。

该问题在 ASP.NET 应用程序的上下文中也不太明显。您正在静态地确定 ISession 对象的范围，这意味着它在 AppDomain 中共享。如果在该 AppDomain 的生命周期内创建了两个不同的页面请求并同时执行，那么您现在有两个页面（不同的线程）接触同一个 ISession，这是*不安全*的。

基本上，与其尝试尽可能长时间地保持会话，不如尝试尽快摆脱​​它们，看看是否有更好的结果。

编辑：

好的，我可以看到你想用这个去哪里。听起来您正在尝试实现 Open Session In View 模式，并且您可以采取几种不同的路线：

如果添加另一个框架不是问题，请查看类似[Spring.NET](http://www.springframework.net)的内容。它是模块化的，所以你不必使用整个东西，你可以只使用 NHibernate 辅助模块。它支持视图模式中的打开会话。[此处](http://www.springframework.net/doc-latest/reference/html/orm.html)的文档（标题 21.2.10。“Web 会话管理”）。

如果您想自己动手，请查看 Bill McCafferty 发布的这个代码项目：[“NHibernate Best Practices”](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)。最后，他描述了通过自定义 IHttpModule 实现该模式。我还在 Internet 上看到了关于在没有 IHttpModule 的情况下实现该模式的帖子，但这可能是您一直在尝试的。

我通常的模式（也许你已经在这里跳过了）首先使用框架。它消除了很多头痛。如果它太慢或不符合我的需求，那么我会尝试调整配置或自定义它。只有在那之后我才尝试推出自己的，但 YMMV。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T13:28:42.023

我不能确定（因为我是一个 Java Hibernate 人）在 NHibernate 中，但在 hibernate 中，Session 对象在设计上不是线程安全的。您应该打开和关闭一个会话，并且永远不要让它超出当前线程的范围。

我确信诸如“打开会话视图”之类的模式已经在.Net 的某个地方实现了。

另一个有趣的问题是当您在会话中放置一个休眠实体时。这里的问题是它所附加的会话将在请求完成时关闭（或应该关闭）。如果您希望导航任何未加载的关联，则必须将实体重新附加到新的（休眠）会话。如果两个请求同时尝试执行此操作，这本身会导致一个新问题，因为如果您尝试将实体附加到两个会话，则会发生某些事情。

希望这可以帮助。加雷斯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-20T10:15:21.783

问题最终是我的控制反转库没有正确管理在 HTTP 上下文中创建的对象，因此我获得了对该上下文不可用的对象的引用。这是使用 Ninject 1.0，一旦我更新到 Ninject 2.0（测试版），问题就解决了。

# java - 用Java中的正则表达式链接文本

> ID：629721
> 
> 赞同：7
> 
> 时间：2009-03-10T11:19:00.600
> 
> 标签：java, regex

我在 Java webapp 中有一个所见即所得的文本区域。用户可以输入文本并为其设置样式或粘贴一些已经 HTML 格式的文本。

我想要做的是*链接*文本。这意味着，将文本中所有可能的 URL 转换为它们的“工作对应物”，即添加 <a href="...">...</a>。

当我只有纯文本时，此解决方案**有效：**

```
String r = "http(s)?://([\\w+?\\.\\w+])+([a-zA-Z0-9\\~\\!\\@\\#\\$\\%\\^\\&amp;\\*\\(\\)_\\-\\=\\+\\\\\\/\\?\\.\\:\\;\\'\\,]*)?";
Pattern pattern = Pattern.compile(r, Pattern.DOTALL | Pattern.UNIX_LINES | Pattern.CASE_INSENSITIVE);
Matcher matcher = pattern.matcher(comment);
comment = matcher.replaceAll("<a href=\"$0\">$0</a>"); // group 0 is the whole expression 
```

但问题是当有一些已经格式化的文本时，即它*已经*有 <a href="...">...</a> 标记。

因此，我正在寻找某种方式让模式在找到*两个 HTML 标记 (< a>) 之间*的文本时*不匹配*。我已经读过这可以通过[前瞻](http://www.regular-expressions.info/lookaround.html)或[后视](http://www.lexemetech.com/2007/10/zero-width-negative-lookbehind.html)来实现，但我仍然无法使其工作。我确定我做错了，因为正则表达式仍然匹配。是的，我一直在玩/调试组，将 $0 更改为 $1 等。

 *有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T11:49:44.630

你很亲密。您可以像这样使用“消极的后视”：

```
(?<!href=")http:// etc 
```

所有以 href 开头的结果都将被忽略。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:47:27.133

如果您想使用正则表达式，（尽管我认为首先解析为 XML/HTML 更健壮）我认为先行或后行是有意义的。第一个刺可能是在你的正则表达式的末尾添加这个：

```
(?!</a>) 
```

含义：如果之后有一个结束标签，则不匹配。（当然，这可以永远调整。）但这并不好用，因为给定字符串

```
<a href="...">http://example.com/</a> 
```

此正则表达式将尝试匹配“ [http://example.com/](http://example.com/) ”，由于前瞻（正如我们希望的那样）而失败，然后*回溯*贪婪的限定符以匹配“ [http://example.com](http://example.com) ”相反，它后面没有。

您可以通过在 +、* 和 ? 上使用[所有格限定符来解决后一个问题。](http://www.regular-expressions.info/possessive.html)运营商 - 只需在他们后面加上 +。这可以防止他们回溯。出于性能原因，这可能也很好。

这对我有用（注意三个额外的+）：

```
String r = "http(s)?://([\\w+?\\.\\w+])++([a-zA-Z0-9\\~\\!\\@\\#\\$\\%\\^\\&amp;\\*\\(\\)_\\-\\=\\+\\\\\\/\\?\\.\\:\\;\\'\\,]*+)?+(?!</a>)"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T11:58:42.190

如果你真的想用正则表达式来做，比：

```
 String r = "(?<![=\"\\/>])http(s)?://([\\w+?\\.\\w+])+([a-zA-Z0-9\\~\\!\\@\\#\\$\\%\\^\\&amp;\\*\\(\\)_\\-\\=\\+\\\\\\/\\?\\.\\:\\;\\'\\,]*)?"; 
```

例如，检查 URL 没有跟随 =" 或 />

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T11:40:52.343

也许 html 解析会更适合您（例如[htmlparser](http://htmlparser.sourceforge.net/)）。然后你可以有 html 节点，并且只在文本中而不是在属性中“链接化”链接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T11:42:00.953

如果你必须自己动手，至少看看 Markdown 的开源实现中使用的算法/模式，例如[MarkdownJ](http://github.com/myabc/markdownj/tree/master)。

# javascript - jQuery：在已选择的元素中选择一个元素

> ID：629730
> 
> 赞同：1
> 
> 时间：2009-03-10T11:21:15.620
> 
> 标签：javascript, jquery, dom

例如：

```
$("table tr").click( function(event)
{
   //Say, here i want get the data of td element where its class name="special"
}); 
```

有什么方法可以在单击事件中选择一个元素，即上面附加元素下的一个元素`$("table tr")`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T11:29:15.850

在这种特定情况下，您可以这样做：

```
$("table tr").click( function(event)
{
   $(this).children('td.special').whatEverYouNeed();
}); 
```

一般来说，您需要使用`find()`：

```
$("table tr").click( function(event)
{
   $(this).find('td.special').whatEverYouNeed();
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T11:26:58.303

就像是

```
$(this).find(".special").html(); 
```

我认为那行得通

# c# - 从 DataGrid 获取数据

> ID：629734
> 
> 赞同：2
> 
> 时间：2009-03-10T11:22:32.560
> 
> 标签：c#, .net, datagrid

我正在用一些值填充一个 C# DataGrid，当我单击它时，我想从一个单元格中检索一个值。我该如何使用 .NET 1.1 框架来做到这一点？

datagridview1 在 .net1.1 中不可用

仅适用于 Windows 应用程序

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:47:24.977

如果您谈论的是 web/ASP.Net 1.1 DataGrid：

1.  用于`myDataGrid.Items`获取一行
2.  用于`row.Cells[x]`获取该行中的列
3.  用于`(TextBox)cell.FindControl("TextBox1")`获取单元格内的控件

有关详细信息，请参阅[在 ASP.NET 中从 DataGrid 访问控件的值](http://www.jigar.net/articles/viewhtmlcontent4.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T12:03:27.530

以下工作是否有效：

```
string strCell = (string)dataGridView1.CurrentCell.Value; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-06-14T14:07:07.273

[这是http://www.jigar.net/articles/viewhtmlcontent4.aspx](http://www.jigar.net/articles/viewhtmlcontent4.aspx)的摘录，也可以在 Eric Lathrop 的回答中找到链接。这涵盖了大多数常见场景。

请记住，在以下示例中，`dataGridItem`是 的别名`MyDataGrid.Items[x]`，其中 x 是（行）索引。这是因为以下示例使用了 foreach 循环，所以如果略读请记住这一点。

> **遍历DataGrid 的**
> 行 我们必须遍历 DataGrid 的行来获取该行中控件的值，所以让我们先这样做。DataGrid 控件有一个名为 Items 的属性，它是对象 DataGridItem 的集合，它表示 DataGrid 控件中的单个项，我们可以按照这六个步骤使用此属性来遍历 DataGrid 行。
> 
> ```
> foreach(DataGridItem dataGridItem in MyDataGrid.Items){ 
> 
> } 
> ```
> 
> **从 DataGrid 中的绑定列中获取值**
> 
> 我们的第一列是绑定列，我们需要获取写入该列的值。DataGridItem 有一个名为 Cells 的属性，它是代表行的单元格的 TableCell 对象的集合。TableCell 的 Text 属性为我们提供了写入该特定单元格的值。
> 
> ```
> //Get name from cell[0] 
> String Name = dataGridItem.Cells[0].Text; 
> ```
> 
> **在 DataGrid 中获取 TextBox 控件的值**现在我们的第二列包含一个 TextBox 控件，我们需要获取该对象的 Text 属性。我们使用 DataGridItem 的 FindControl 方法来获取 TextBox 的引用。
> 
> ```
> //Get text from textbox in cell[1] 
> String Age = 
> ((TextBox)dataGridItem.FindControl("AgeField")).Text; 
> ```
> 
> **从 DataGrid 中的 CheckBox 控件中获取值**
> 
> DataGrid 中的第三列包含一个 CheckBox Web 控件，我们需要检查该控件的 Checked 属性是真还是假。
> 
> ```
> //Get Checked property of Checkbox control 
> bool IsGraduate = 
> ((CheckBox)dataGridItem.FindControl
> ("IsGraduateField")).Checked; 
> ```
> 
> **从 DataGrid 中的 CheckBoxList Web 控件获取值**
> 
> 这种情况与前一种情况不同，因为 CheckBoxList 可能返回多于一个选定的值。我们必须遍历 CheckBoxList 项目以检查用户是否选择了特定项目。
> 
> ```
> // Get Values from CheckBoxList 
> String Skills = ""; 
> foreach(ListItem item in 
> ((CheckBoxList)dataGridItem.FindControl("CheckBoxList1")).Items) 
> { 
>   if (item.Selected){ 
>       Skills += item.Value + ","; 
>   } 
> } 
> Skills = Skills.TrimEnd(','); 
> ```
> 
> **从 DataGrid 中的 RadioButtonList Web 控件获取值**
> 
> 我们使用 DataGridItem 的 FindControl 方法获取 RadioButtonList 的引用，然后使用 RadioButtonList 的 SelectedItem 属性从 RadioButtonList 中获取选定项。
> 
> ```
> //Get RadioButtonList Selected text 
> String Experience = 
> ((RadioButtonList)dataGridItem.FindControl("RadioButtonList1"))
>     .SelectedItem.Text; 
> ```
> 
> **从 DataGrid 中的 DropDownList Web 控件获取值**
> 
> 这类似于 RadioButtonList。我使用这个控件只是为了表明它与任何其他 ListControls 的工作方式相同。同样，您可以像使用 CheckBoxList 控件一样使用 ListBox Web 控件。
> 
> ```
> //Get DropDownList Selected text 
> String Degree = 
> ((DropDownList)dataGridItem.
> FindControl("DropDownList1")).SelectedItem.Text; 
> ```

# c++ - 如何从 IStream 初始化 IMimeMessage 对象

> ID：629741
> 
> 赞同：0
> 
> 时间：2009-03-10T11:24:48.607
> 
> 标签：c++, com, mime

给定一个使用例如 MimeOleCreateMessage 函数创建的空 MimeMessage，我如何从包含完整消息文本的 IStream / 数据缓冲区初始化它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T13:16:39.133

如果我没记错 MimeOleCreateMessage 返回的 IMimeMessage 支持 IPersistStream 流，那么您有 Load & Save 方法。

# encryption - 创建加密日志文件

> ID：629755
> 
> 赞同：9
> 
> 时间：2009-03-10T11:31:12.943
> 
> 标签：encryption, logging

我正在创建一个客户端应用程序，该应用程序需要创建用户活动日志，但由于各种原因，该日志不能是人类可读的。

目前对于我的开发，我正在创建一个看起来像这样的纯文本日志：

```
12/03/2009 08:34:21 -> User 'Bob' logged in
12/03/2009 08:34:28 -> Navigated to config page
12/03/2009 08:34:32 -> Option x changed to y 
```

当我部署我的应用程序时，日志不能是纯文本，所以所有文本都必须加密。这似乎并不容易实现，因为我需要在添加每个条目时动态更新日志文件。

我正在考虑的方法是创建一个二进制文件，单独加密每个日志条目，然后将其附加到二进制文件中，并在每个条目之间进行适当的分界。

有谁知道解决这个问题的任何常用方法，我相信必须有更好的解决方案！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-10T21:12:23.560

不要像其他发布者建议的那样单独加密单个日志条目并将它们写入文件，因为攻击者很容易能够识别日志文件中的模式。请参阅[块密码模式 Wikipedia 条目](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)以了解有关此问题的更多信息。

![原来的](https://upload.wikimedia.org/wikipedia/commons/5/56/Tux.jpg) ![使用 ECB 模式加密](https://upload.wikimedia.org/wikipedia/commons/f/f0/Tux_ecb.jpg) ![使用其他模式加密](https://upload.wikimedia.org/wikipedia/commons/a/a0/Tux_secure.jpg)

相反，请确保日志条目的加密取决于先前的日志条目。尽管这有一些缺点（您无法解密单个日志条目，因为您总是需要解密整个文件），但它使加密更加强大。对于我们自己的日志库[SmartInspect](http://www.gurock.com/products/smartinspect/)，我们使用 AES 加密和 CBC 模式来避免模式问题。如果商业解决方案合适，请随意尝试SmartInspect [。](http://www.gurock.com/products/smartinspect/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-10T11:35:05.930

这真的不是我的事，我很容易承认，但你不能单独加密每个条目，然后将其附加到日志文件中吗？如果您不加密时间戳，您可以轻松找到您正在寻找的条目并在需要时解密这些条目。

我的观点主要是，将单个加密条目附加到文件不一定需要将二进制条目附加到二进制文件。使用（例如）gpg 加密会产生 ascii 乱码，可以附加到 ascii 文件中。那能解决你的问题吗？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T11:54:47.677

FWIW，有一次我需要一个加密的记录器，我使用对称密钥（出于性能原因）来加密实际的日志条目。

然后，对称的“日志文件密钥”在公钥下加密并存储在日志文件的开头，单独的日志阅读器使用私钥解密“日志文件密钥”并读取条目。

整个过程是使用 log4j 和 XML 日志文件格式（使读者更容易解析）实现的，并且每次滚动日志文件时都会生成一个新的“日志文件密钥”。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-10T11:37:46.250

假设您正在使用某种日志框架，例如[log4j](http://logging.apache.org/log4j/)等，那么您应该能够创建一个自定义实现[Appender](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/Appender.html)（或类似）来加密每个条目，正如@wzzrd 所建议的那样。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T12:55:16.110

我不清楚你关心的是安全还是工具。

一个简单的实现是连接流加密器。流加密器维护自己的状态并且可以动态加密。

```
StreamEncryptor<AES_128> encryptor;
encryptor.connectSink(new std::ofstream("app.log"));
encryptor.write(line);
encryptor.write(line2);
... 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-10-08T23:27:54.300

非常老的问题，我相信科技界已经取得了很大进展，但 FWIW Bruce Schneier 和 John Kelsey 写了一篇关于如何做到这一点的论文： [https ://www.schneier.com/paper-auditlogs.html](https://www.schneier.com/paper-auditlogs.html)

如果托管日志/审计文件的系统受到威胁，上下文不仅是安全性的，而且还可以防止现有日志文件数据的损坏或更改。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-10T12:16:34.597

我想知道你写什么样的应用程序。病毒还是特洛伊木马？反正 ...

单独加密每个条目，将其转换为某个字符串（例如 Base64），然后将该字符串记录为“消息”。

这使您可以保持文件的某些部分可读，并且只加密重要部分。

请注意，这枚硬币还有另一面：如果您创建一个完全加密的文件并向用户询问，她无法知道您将从该文件中学到什么。因此，您应该尽可能少地加密（密码、IP 地址、客户数据），以便法律部门能够验证哪些数据正在离开。

更好的方法是对日志文件使用混淆器。这只是用“XXX”替换某些模式。您仍然可以看到发生了什么，并且当您需要特定数据时，您可以提出要求。

[编辑] 这个故事有更多的含义，你乍一看会想到。这实际上意味着用户看不到文件中的内容。“用户”不一定包括“破解者”。破解者将专注于加密文件（因为它们可能更重要）。这就是那句老话的原因：一旦有人进入机器，就没有办法阻止他在上面做任何事情。或者换一种说法：仅仅因为你不知道怎么做并不意味着其他人也不知道。如果你认为你没有什么可隐瞒的，那你就没有考虑过自己。

此外，还有责任问题。比如说，在您获得日志副本后，一些数据在 Internet 上泄漏。由于用户不知道日志文件中的内容，您如何在法庭上证明您不是泄密者？老板可以要求日志文件来监控他们的棋子，要求对其进行编码，这样农民就不会注意到并抱怨它（或者起诉，败类！）。

或者从一个完全不同的角度来看：如果没有日志文件，就没有人可以滥用它。仅在紧急情况下启用调试怎么样？我已将 log4j 配置为将最后 200 条日志消息保存在缓冲区中。如果记录了错误，我将 200 条消息转储到日志中。理由：我真的不在乎白天发生了什么。我只关心错误。使用 JMX，可以很简单地将调试级别设置为 ERROR 并在运行时在需要更多详细信息时远程降低它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-10T12:31:08.243

单独加密每个日志条目会大大降低密文的安全性，尤其是因为您使用的是非常可预测的明文。

以下是您可以执行的操作：

1.  使用对称加密（最好是 AES）
2.  选择一个随机的主密钥
3.  选择一个安全窗口（5 分钟、10 分钟等）

然后，在每个窗口的开头（每 5 分钟、每 10 分钟等）选择一个随机临时密钥

使用临时密钥分别加密每个日志项并附加到临时日志文件。

当窗口关闭时（预定时间结束），使用临时密钥解密每个元素，使用主密钥解密主日志文件，合并文件，并使用主密钥加密。

然后，选择一个新的临时密钥并继续。

此外，每次轮换主日志文件（每天、每周等）时，都要更改主密钥。

这应该提供足够的安全性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-10T12:26:05.417

对于 .Net，请参阅 Microsoft 应用程序块以获取日志和加密功能：http: [//msdn.microsoft.com/en-us/library/dd203099.aspx](http://msdn.microsoft.com/en-us/library/dd203099.aspx)

我会在每个条目之间使用适当的分界线将加密的日志条目附加到一个平面文本文件中，以便解密工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-09-22T05:38:32.583

我和你有同样的需求。一些叫做“maybeWeCouldStealAVa”的人在： [How to append to AES encrypted file](https://stackoverflow.com/questions/10283637/how-to-append-to-aes-encrypted-file)中写了一个很好的实现，但是这会受到不可刷新的影响 - 每次刷新消息时都必须关闭并重新打开文件，以确保不会丢失任何事物。

所以我写了我自己的类来做到这一点：

```
import javax.crypto.*;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.io.*;
import java.security.*;

public class FlushableCipherOutputStream extends OutputStream
{
    private static int HEADER_LENGTH = 16;

    private SecretKeySpec key;
    private RandomAccessFile seekableFile;
    private boolean flushGoesStraightToDisk;
    private Cipher cipher;
    private boolean needToRestoreCipherState;

    /** the buffer holding one byte of incoming data */
    private byte[] ibuffer = new byte[1];

    /** the buffer holding data ready to be written out */
    private byte[] obuffer;

    /** Each time you call 'flush()', the data will be written to the operating system level, immediately available
     * for other processes to read. However this is not the same as writing to disk, which might save you some
     * data if there's a sudden loss of power to the computer. To protect against that, set 'flushGoesStraightToDisk=true'.
     * Most people set that to 'false'. */
    public FlushableCipherOutputStream(String fnm, SecretKeySpec _key, boolean append, boolean _flushGoesStraightToDisk)
            throws IOException
    {
        this(new File(fnm), _key, append,_flushGoesStraightToDisk);
    }

    public FlushableCipherOutputStream(File file, SecretKeySpec _key, boolean append, boolean _flushGoesStraightToDisk)
            throws IOException
    {
        super();

        if (! append)
            file.delete();
        seekableFile = new RandomAccessFile(file,"rw");
        flushGoesStraightToDisk = _flushGoesStraightToDisk;
        key = _key;

        try {
            cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");

            byte[] iv = new byte[16];
            byte[] headerBytes = new byte[HEADER_LENGTH];
            long fileLen = seekableFile.length();
            if (fileLen % 16L != 0L) {
                throw new IllegalArgumentException("Invalid file length (not a multiple of block size)");
            } else if (fileLen == 0L) {
                // new file

                // You can write a 16 byte file header here, including some file format number to represent the
                // encryption format, in case you need to change the key or algorithm. E.g. "100" = v1.0.0
                headerBytes[0] = 100;
                seekableFile.write(headerBytes);

                // Now appending the first IV
                SecureRandom sr = new SecureRandom();
                sr.nextBytes(iv);
                seekableFile.write(iv);
                cipher.init(Cipher.ENCRYPT_MODE, key, new IvParameterSpec(iv));
            } else if (fileLen <= 16 + HEADER_LENGTH) {
                throw new IllegalArgumentException("Invalid file length (need 2 blocks for iv and data)");
            } else {
                // file length is at least 2 blocks
                needToRestoreCipherState = true;
            }
        } catch (InvalidKeyException e) {
            throw new IOException(e.getMessage());
        } catch (NoSuchAlgorithmException e) {
            throw new IOException(e.getMessage());
        } catch (NoSuchPaddingException e) {
            throw new IOException(e.getMessage());
        } catch (InvalidAlgorithmParameterException e) {
            throw new IOException(e.getMessage());
        }
    }

    /**
     * Writes one _byte_ to this output stream.
     */
    public void write(int b) throws IOException {
        if (needToRestoreCipherState)
            restoreStateOfCipher();
        ibuffer[0] = (byte) b;
        obuffer = cipher.update(ibuffer, 0, 1);
        if (obuffer != null) {
            seekableFile.write(obuffer);
            obuffer = null;
        }
    }

    /** Writes a byte array to this output stream. */
    public void write(byte data[]) throws IOException {
        write(data, 0, data.length);
    }

    /**
     * Writes <code>len</code> bytes from the specified byte array
     * starting at offset <code>off</code> to this output stream.
     *
     * @param      data     the data.
     * @param      off   the start offset in the data.
     * @param      len   the number of bytes to write.
     */
    public void write(byte data[], int off, int len) throws IOException
    {
        if (needToRestoreCipherState)
            restoreStateOfCipher();
        obuffer = cipher.update(data, off, len);
        if (obuffer != null) {
            seekableFile.write(obuffer);
            obuffer = null;
        }
    }

    /** The tricky stuff happens here. We finalise the cipher, write it out, but then rewind the
     * stream so that we can add more bytes without padding. */
    public void flush() throws IOException
    {
        try {
            if (needToRestoreCipherState)
                return; // It must have already been flushed.
            byte[] obuffer = cipher.doFinal();
            if (obuffer != null) {
                seekableFile.write(obuffer);
                if (flushGoesStraightToDisk)
                    seekableFile.getFD().sync();
                needToRestoreCipherState = true;
            }
        } catch (IllegalBlockSizeException e) {
            throw new IOException("Illegal block");
        } catch (BadPaddingException e) {
            throw new IOException("Bad padding");
        }
    }

    private void restoreStateOfCipher() throws IOException
    {
        try {
            // I wish there was a more direct way to snapshot a Cipher object, but it seems there's not.
            needToRestoreCipherState = false;
            byte[] iv = cipher.getIV(); // To help avoid garbage, re-use the old one if present.
            if (iv == null)
                iv = new byte[16];
            seekableFile.seek(seekableFile.length() - 32);
            seekableFile.read(iv);
            byte[] lastBlockEnc = new byte[16];
            seekableFile.read(lastBlockEnc);
            cipher.init(Cipher.DECRYPT_MODE, key, new IvParameterSpec(iv));
            byte[] lastBlock = cipher.doFinal(lastBlockEnc);
            seekableFile.seek(seekableFile.length() - 16);
            cipher.init(Cipher.ENCRYPT_MODE, key, new IvParameterSpec(iv));
            byte[] out = cipher.update(lastBlock);
            assert out == null || out.length == 0;
        } catch (Exception e) {
            throw new IOException("Unable to restore cipher state");
        }
    }

    public void close() throws IOException
    {
        flush();
        seekableFile.close();
    }
} 
```

这是一个使用它的例子：

```
import org.junit.Test;
import javax.crypto.Cipher;
import javax.crypto.CipherInputStream;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.io.*;
import java.io.BufferedWriter;

public class TestFlushableCipher {
    private static byte[] keyBytes = new byte[] {
            // Change these numbers, lest other StackOverflow readers can decrypt your files.
            -53, 93, 59, 108, -34, 17, -72, -33, 126, 93, -62, -50, 106, -44, 17, 55
    };
    private static SecretKeySpec key = new SecretKeySpec(keyBytes,"AES");
    private static int HEADER_LENGTH = 16;

    private static BufferedWriter flushableEncryptedBufferedWriter(File file, boolean append) throws Exception
    {
        FlushableCipherOutputStream fcos = new FlushableCipherOutputStream(file, key, append, false);
        return new BufferedWriter(new OutputStreamWriter(fcos, "UTF-8"));
    }

    private static InputStream readerEncryptedByteStream(File file) throws Exception
    {
        FileInputStream fin = new FileInputStream(file);
        byte[] iv = new byte[16];
        byte[] headerBytes = new byte[HEADER_LENGTH];
        if (fin.read(headerBytes) < HEADER_LENGTH)
            throw new IllegalArgumentException("Invalid file length (failed to read file header)");
        if (headerBytes[0] != 100)
            throw new IllegalArgumentException("The file header does not conform to our encrypted format.");
        if (fin.read(iv) < 16) {
            throw new IllegalArgumentException("Invalid file length (needs a full block for iv)");
        }
        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
        cipher.init(Cipher.DECRYPT_MODE, key, new IvParameterSpec(iv));
        return new CipherInputStream(fin,cipher);
    }

    private static BufferedReader readerEncrypted(File file) throws Exception
    {
        InputStream cis = readerEncryptedByteStream(file);
        return new BufferedReader(new InputStreamReader(cis));
    }

    @Test
    public void test() throws Exception {
        File zfilename = new File("c:\\WebEdvalData\\log.x");

        BufferedWriter cos = flushableEncryptedBufferedWriter(zfilename, false);
        cos.append("Sunny ");
        cos.append("and green.  \n");
        cos.close();

        int spaces=0;
        for (int i = 0; i<10; i++) {
            cos = flushableEncryptedBufferedWriter(zfilename, true);
            for (int j=0; j < 2; j++) {
                cos.append("Karelia and Tapiola" + i);
                for (int k=0; k < spaces; k++)
                    cos.append(" ");
                spaces++;
                cos.append("and other nice things.  \n");
                cos.flush();
                tail(zfilename);
            }
            cos.close();
        }

        BufferedReader cis = readerEncrypted(zfilename);
        String msg;
        while ((msg=cis.readLine()) != null) {
            System.out.println(msg);
        }
        cis.close();
    }

    private void tail(File filename) throws Exception
    {
        BufferedReader infile = readerEncrypted(filename);
        String last = null, secondLast = null;
        do {
            String msg = infile.readLine();
            if (msg == null)
                break;
            if (! msg.startsWith("}")) {
                secondLast = last;
                last = msg;
            }
        } while (true);
        if (secondLast != null)
            System.out.println(secondLast);
        System.out.println(last);
        System.out.println();
    }
} 
```

# visual-studio - 如何在 Visual Studio 中为自定义库项目 C# 生成多部件装配（每个文件夹）？

> ID：629758
> 
> 赞同：2
> 
> 时间：2009-03-10T11:33:01.253
> 
> 标签：visual-studio

我们可以添加预构建操作或一些编译器开关吗？

目前，我的解决方案中有太多项目。我想添加新模块并将它们编译成单独的程序集。我正在寻找可以避免为每个程序集添加新项目的选项。

我正在使用 Visual Studio 2005。

此外，值得了解 2008 年是否在该领域具有更好的功能。

**编辑#1：**有两个开发团队在这个项目上工作，我们希望将模块大致分为两个垂直方向并保持组件分开，以便正在进行的补丁（发布后）不与两个垂直方向的功能重叠，并且测试足迹被最小化。

目前该解决方案有大约 8 个项目，我们需要为第二个团队设置结构以开始开发。

> 我不想最终在解决方案中添加 5 或 6 个新项目，而是在现有项目中创建文件夹，以便为新团队或一些简单的方法分离代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T11:38:48.743

不，Visual Studio 仍然是“每个程序集一个项目”。你真的需要有那么多不同的程序集吗？

您也许可以编写自己的构建规则，从单个项目创建多个程序集，但我怀疑这将导致 Visual Studio 变得非常混乱的痛苦世界。

如果您可以向我们提供有关您为什么需要大量程序集的更多详细信息，我们也许可以帮助您提出不同的解决方案。

编辑：阅读您更新的问题后，听起来您最好只在源代码控制中处理两个分支，并适当地合并到主干（并*从*主干更新）。或者，如果两个团队真的在处理代码的独立部分，那么单独的项目确实*是*最好的解决方案。

Visual Studio 的问题之一（IMO）是项目中的文件被明确列出 - 这意味着项目文件成为大的合并瓶颈。我更喜欢 Eclipse 模型，其中源路径下的任何源文件都隐式包含在构建中（除非您明确*排除*它）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T11:51:16.763

Visual Studio 2005 和 2008 都不允许您创建多文件程序集。但是，您可以使用“/addmodule:ModuleName”开关在命令行运行 C# 编译器，它会执行您想要的操作。有关 csc 命令行用法的一般详细信息，请参阅[本文](http://msdn.microsoft.com/en-us/library/ms379563(VS.80).aspx)。有关 /addmodule 开关的描述，请参[见此](http://msdn.microsoft.com/en-us/library/ms379563(VS.80).aspx#csharpcompiler_topic10)。

但是，这就是说，您很可能在这里采取了非最佳方法。在正常情况下，您不必因为项目太多而创建多文件程序集。提供有关您的一般问题的更多详细信息，以便人们可以就此提出建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:59:55.070

到目前为止，我会听取您的建议-如果您发现自己提出这样的问题，则可能有一个更深层次的设计问题被忽略了-但如果您真的*必须*按照您的建议去做，那么您有几个选项。您可以破解项目文件以允许您将文件编译成单独的程序集：项目文件是一个 msbuild 文件，因此您可以使用它做很多事情。此外，您可以简单地*使用*msbuild 文件来构建您的项目和解决方案。或者您可以完全使用不同的构建系统——NAnt 就是一个例子。

这些建议的可能问题是它们不适用于您的工作环境。开始破解团队中其他人使用的项目文件，或者只是决定使用您的自定义 msbuild 文件构建这个或那个解决方案是没有好处的。使用单个自定义 msbuild 文件或 NAnt 之类的东西来构建您的项目有很多很好的理由，但如果它不是根据决策影响的每个人的输入做出的，它总是错误的决定。

# javascript - 为 Ajax 应用程序启用返回/fwd 键事件

> ID：629765
> 
> 赞同：4
> 
> 时间：2009-03-10T11:35:35.960
> 
> 标签：javascript, url-rewriting, dom-events, hashchange

我有一个在 AJAX 上工作的应用程序。但是我想在其中具有导航功能。为了欺骗 url，我正在更改 location.hash，以生成 URL。但是如果我使用 back/fwd，只有 url 改变，但页面不会重新加载。如何覆盖`hstory.back`以重新加载页面。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T11:54:18.550

除了连续轮询来实现这种行为之外，我不知道有任何其他方式。一个实现可能如下所示：

```
var lastHash = '';

function pollHash() {
    if(lastHash !== location.hash) {
        lastHash = location.hash;
        // hash has changed, so do stuff:
        alert(lastHash);
    }
}

setInterval(pollHash, 100); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T11:46:33.907

你不能准确地捕捉到 back 事件，但是这些问题中的大部分都已经解决了——而且也是一件好事，这是一个*难题*。

看一下[非常简单的历史](http://code.google.com/p/reallysimplehistory/)（又名 RSH），然后实现它或通过它来了解它是如何工作的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-28T17:01:42.097

这个问题的答案与我对这些问题的答案或多或少相同：

*   [如何在 URL 中显示 Ajax 请求？](https://stackoverflow.com/questions/3205900/how-to-show-ajax-requests-in-url/3276206#3276206)
*   [Gmail 如何在富 JavaScript 中处理后退/前进？](https://stackoverflow.com/questions/3460041/how-does-gmail-handle-back-forward-in-rich-javascript/3460269#3460269)

总而言之，您可能想要查看的两个项目解释了整个 hashchange 过程并将其与 ajax 一起使用：

*   [jQuery 历史](http://www.balupton.com/projects/jquery-history)（使用哈希来管理您的页面状态并绑定到更改以更新您的页面）。

*   [jQuery Ajaxy](http://www.balupton.com/projects/jquery-ajaxy)（jQuery History 的 ajax 扩展，允许完整的 ajax 网站，同时完全不显眼并且可以优雅地降解）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-09T02:07:54.847

balupton的答案真的很棒。

但是您还有另一个 jQuery 插件来处理您的 ajax 请求，它是[address](http://www.asual.com/jquery/address/)。

# mysql - 从 MySQL 5.0 迁移到 5.1 的原因

> ID：629769
> 
> 赞同：2
> 
> 时间：2009-03-10T11:38:19.743
> 
> 标签：mysql, database, migrate

我正在使用一个相当繁忙的 MySQL 5.0 数据库。我迁移到 MySQL 5.1 的主要原因是什么？值得麻烦吗？

我使用 VS2008/.NET 3.5 服务器在 Windows 2008 服务器上作为 MySQL 集群运行。

到目前为止，感谢您的回答。更具体地说 - 我正在寻找答案，例如 Quanssnoi 的答案，列出了对他最重要的功能，而不是我当然阅读的 MySQL 功能列表的链接。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T11:40:03.203

我的首要原因是[**分区**](http://dev.mysql.com/doc/refman/5.1/en/partitioning.html)和[**XPath 支持**](http://dev.mysql.com/doc/refman/5.1/en/xml-functions.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T11:43:51.680

对我来说，最重要的新特性是基于行的复制。

以下是 MySQL 5.1 中的新功能列表： MySQL 5.1 中的新功能[如果](http://dev.mysql.com/doc/refman/5.1/en/mysql-nutshell.html)您不打算利用这些新功能，并且您有一个在 MySQL 5.0 上运行的生产系统，那么迁移到 MySQL 5.1 可能不值得麻烦。

另一方面，MySQL 6.0（仍处于 Alpha 阶段）带来了[一系列新功能](http://dev.mysql.com/doc/refman/6.0/en/mysql-nutshell.html)，包括 utf16 和 utf32 支持，以及一个名为[Falcon](http://dev.mysql.com/doc/refman/6.0/en/se-falcon.html)的新存储引擎。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T11:55:32.183

我注意到 DB 转储和转储加载在 5.1 中工作得更好（5.0 存在向后兼容性注释的问题）。请注意，我指的不是模式备份，而是转储（不同的东西）。

# asp.net - 一个调用方法如何存在于另一个页面的页面中？

> ID：629772
> 
> 赞同：1
> 
> 时间：2009-03-10T11:39:27.540
> 
> 标签：asp.net, asp.net-ajax

我正在处理一个页面，其中以模态方式打开其他页面。我需要调用 opener 页面中存在的函数来更新其中的某些控件。

我正在使用 window.open 打开另一个窗口，但在这种情况下，打开页面的 Page.PreviousPage 为空。

我正在使用

```
<%@ PreviousPageType VirtualPath="~/PreviousPage.aspx" %> 
```

参考上一页。

有什么建议么？

仅供参考：所有 aspx 页面都支持 AJAX。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T11:53:13.640

您不能在`Page`类后面的代码中调用方法来更新显示的页面中的控件。该类的实例`Page`仅在页面呈现时存在，一旦页面显示在浏览器中，该`Page`对象就不再存在。

PreviousPage 属性在您从一个页面发布到另一个页面时使用，但它不包含`Page`用于呈现页面的对象，它包含一个`Page`根本不会用于呈现任何内容的重新创建的对象。您只能使用它根据发布的信息从字段中读取信息。

如果您想更新打开器页面，您必须在客户端使用 Javascript () 进行更新，或者重新加载页面以便服务器端代码可以重新填充它。它们的结合是使用 AJAX 来更新页面。

编辑：
例如，您可以使用 Javascript 访问开启器并更改元素的内容：

```
window.opener.document.getElementById('Info').innerHTML = 'updated'; 
```

您还可以在打开页面中调用 Javascript 函数：

```
window.opener.doSomething('data'); 
```

这为您提供了更多可能性，例如进行 AJAX 调用以从服务器加载数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:09:49.607

您可以使用 javascript 将父页面提交回服务器。您可以使用 javascript 中的 window.opener 函数来访问父页面。

# vb6 - vb6 在运行时使用背景中的标签更改 SSTab 的颜色

> ID：629776
> 
> 赞同：2
> 
> 时间：2009-03-10T11:40:03.500
> 
> 标签：vb6

我正在尝试更新旧的 VB6 应用程序。我正在努力在运行时更改 SSTab 控件的背景色。

我知道我不能只将背景色设置为所需的颜色。

在设计时，我在每个选项卡上创建了一个标签，然后将标签调整为 sstab 尺寸。然后我设置标签背景色。这工作正常。

但是，我真正想要做的是在运行时执行此操作，这样如果将来在表单上添加新的选项卡控件，我就不需要每次在设计时手动执行此操作。

如果有人能指出我在运行时在 SSTab 控件的每个选项卡上创建和显示标签的正确方向，我将不胜感激？

我没有在所有选项卡上都有框架，所以我不想使用框架容器来保存标签。我宁愿在运行时将标签放在选项卡容器上。

谢谢，我期待您的回复。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T12:37:33.457

正如 svinto 所说，您可以将新控件加载到控件数组中，但除此之外还有更多内容。

首先，新控件不可见，因此您必须设置 .Visible=True 您还需要在创建控件之前设置当前选项卡以使其位于该选项卡上。

假设您在第一个选项卡上已经有了第一个标签：

```
For i = 1 To Me.SSTab1.Tabs - 1
    Me.SSTab1.Tab = i
    Load lblOne(i)
    lblOne(i).Visible = True
Next 
```

此外，这在 Form_Load 事件中不起作用，但在 Form_Activate 中起作用

还有另一种从头开始创建标签的方法，而不是使用控件数组，这可能会更好，因为您不需要将第一个标签添加到表单中：

```
Private Sub Form_Activate()
    Dim lbl() As Label
    Dim i As Integer
    Dim name As String

   ReDim lbl(SSTab1.Tabs - 1)
   For i = 0 To Me.SSTab1.Tabs - 1
        Me.SSTab1.Tab = i
        name = "MyLabel" & CStr(i)
        Set lbl(i) = Form1.Controls.Add("VB.Label", name)
        Set lbl(i).Container = Me.SSTab1
        lbl(i).Visible = True
        lbl(i).Caption = name
        lbl(i).Move 40, 345
        lbl(i).BackColor = vbGreen
    Next
End Sub 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T11:44:56.530

在设计时创建一个标签，并将其索引设置为 0。稍后您可以`Load labelname(newindex)`创建更多标签实例。创建后定位它们，设置背景颜色，你就完成了。

# java - 如何将格式化的 (\n \t) 文本传递给 java 命令行

> ID：629778
> 
> 赞同：2
> 
> 时间：2009-03-10T11:40:43.000
> 
> 标签：java, batch-file

我需要在命令行中传递一个格式化字符串，以便输入文本以 JFrame 格式显示：

```
Hello
The sun is shinning! 
```

如何在 Windows 批处理文件中添加“\n”？

```
java -cp . Test "Hello\nThe sun is shinning!" 
```

我无法更改程序，它希望将字符串作为命令行参数显示在 TextBox 中，并且我想传递多行。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T11:54:47.910

我不认为这是可能的。

请记住，" `\n`" 转义序列只能被 Java 编译器识别，否则没有任何意义。

因此，您在这里遇到的是 Windows 批处理文件语言问题，据我所知，无法将嵌入式 NL 放入 Windows 的参数中。

但是，您*可以*做的是解决`\n`上面提到的 " " 问题，并且实际上让您的代码识别转义序列：

```
param = param.replaceAll("\\n", "\n"); 
```

反斜杠字符在第一个字符串中被引用两次，因为您实际上想要匹配文字反斜杠字符。

Apache Commons 库中还有一个函数可以执行此操作：

```
import org.apache.commons.lang.*;
param = StringEscapeUtils.unescapeJava(param); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T12:28:51.370

这有点难看，但你应该可以使用`echo`and来做到这一点`&&`。
尝试这个：

```
java -cp . Test (echo Hello&&echo The sun is shining!) 
```

选项卡不需要转义 - 您可以将其直接放入批处理文件中。

# sql-server-2005-express - 如何在 Management Studio 的 MS SQL 2005 存储过程模板中设置默认作者姓名？

> ID：629783
> 
> 赞同：2
> 
> 时间：2009-03-10T11:43:18.920
> 
> 标签：sql-server-2005-express

在 MS SQL Server Management Studio Express 中，当我通过右键单击“可编程性”文件夹下的“存储过程”文件夹创建存储过程时，是否可以将默认作者姓名设置为我的姓名？如果我不必在创建新存储过程时不断更新它，那将节省我很多时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T11:46:50.660

您好，您可以通过查看->模板资源管理器->展开存储过程来完全编辑 Management Studio 模板中显示的内容。

# java - 如何在 JUnit 3 中自定义异常处理行为？

> ID：629793
> 
> 赞同：3
> 
> 时间：2009-03-10T11:45:51.397
> 
> 标签：java, unit-testing, exception, junit

我想使用 JUnit 3 实现异常检查（如在 JUnit 4 中）。例如，我希望能够编写如下测试：

```
public void testMyExceptionThrown() throws Exception {
    shouldThrow(MyException.class);

    doSomethingThatMightThrowMyException();
} 
```

当且仅当抛出 MyException 时，这应该成功。JUnit 中有 ExceptionTestCase 类，但我想要每个 test* 方法可以决定使用或不使用的东西。实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-10T12:06:37.180

解决方案：

```
public void testMyExceptionThrown() throws Exception {
    try {
      doSomethingThatMightThrowMyException();
      fail("Expected Exception MyException");
    } catch(MyException e) {
      // do nothing, it's OK
    }
} 
```

适合你的想法吗？

另请查看[此线程](http://www.javalobby.org/java/forums/t91320.html)，其中有人为 JUnit3 创建了代理解决方案，这似乎是解决您的问题的另一种可能性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-22T16:06:32.373

无需实现您自己的解决方案，因为已经有一个可以与 JUnit3（和任何其他测试框架）一起使用的解决方案：[catch-exception](http://code.google.com/p/catch-exception/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:06:42.187

最简单的方法是使用 Execute Around 习惯用法来抽象出您通常会编写的 try-catch。

更复杂的是要注意这`TestCase`只是一个`Test`. 我忘记了细节，但我们可以覆盖测试的执行（框架最初通过`run(TestResult)`在 中指定的调用`Test`）。在那个覆盖中，我们可以根据 Execute Around 放置 try-catch。该`testXxx`方法应该调用一个 set 方法来安装预期的异常类型。

# java - Random.nextGaussian() 的问题

> ID：629798
> 
> 赞同：7
> 
> 时间：2009-03-10T11:47:03.937
> 
> 标签：java, random

Random.nextGaussian() 应该给出平均值为 0 和标准偏差为 1 的随机数。它生成的许多数超出了 [-1,+1] 的范围。我该如何设置，使其仅在 -1 到 1 的范围内给出正态分布的随机数。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-10T11:55:16.613

平均值为 0，标准差为 1 的高斯分布意味着分布的平均值为 0，大约 70% 的总体位于 [-1, 1] 范围内。忽略你范围之外的数字——它们在两边形成大约 16% 的边缘。

`mean=0`也许更好的解决方案是使用和生成分布`std.dev=0.5`。这将为您提供大约 96% 的值在 [-1, 1] 范围内的分布。

一个更好的解决方案是像上面一样向后工作并使用大约的想法。99.7% 的值在 3-sigma 范围内：使用 a `std.dev = 1/3`。这几乎会使您获得的不那么有用的值的数量无效。当你得到一个，省略它。

当然，如果您正在研究数学密集型产品，那么所有这些都没有任何价值。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-10T11:54:12.687

正态分布不是包含任意远离均值但概率越来越小的数字吗？可能是您的欲望（正常且仅限于特定范围）不兼容。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T11:53:04.310

正态分布给出了一个非零（但“变得非常小”）的概率，无论你给出什么方差，你都会看到 [-1, +1] 之外的值 - 你只是有效地挤压曲线。

您可以使用一个小的方差，然后通过一个地图运行结果，该地图将小于 -1 到 -1 的任何内容以及大于 1 到 1 的任何内容都裁剪掉，但它（严格来说）不再是正态分布。

出于兴趣，你需要这个分布做什么？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T12:05:04.983

带有您的参数的高斯分布。is 的密度为 e^(-x^2/2)。通常它的形式是 e^(linear(x)+linear(x^2)) 这意味着无论你给它什么设置，你都有可能得到非常大和非常小的数字。
您可能正在寻找其他发行版。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T11:56:15.800

1.0 的标准差意味着许多值将位于 [-1,1] 范围之外。

如果你需要保持在这个范围内，你应该使用另一种方法，也许是 nextDouble()。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-01-25T19:51:08.187

此代码将向控制台显示随机高斯数的*计数（一行 10 个），然后显示一些统计数据（最低、最高和平均）。*

如果您尝试使用较小的*计数*，随机数可能在 [-1.0 ... +1.0] 范围内，平均值可能在 [-0.1 ... +0.1] 范围内。但是，如果*计数*高于 10.000，随机数可能会落在 [-4.0 ... +4.0] 范围内（两端可能会出现更不可能的数字），尽管平均值可能在 [-0.001 ... +0.001] 范围内（更接近于 0）。

```
public static void main(String[] args) {
    int count = 20_000; // Generated random numbers
    double lowest = 0;  // For statistics
    double highest = 0;
    double average = 0;
    Random random = new Random();

    for (int i = 0; i < count; ++i) {
        double gaussian = random.nextGaussian();
        average += gaussian;
        lowest = Math.min(gaussian, lowest);
        highest = Math.max(gaussian, highest);
        if (i%10 == 0) { // New line
            System.out.println();
        }
        System.out.printf("%10.4f", gaussian);
    }
    // Display statistics
    System.out.println("\n\nNumber of generated random values following Gaussian distribution: " + count);
    System.out.printf("\nLowest value:  %10.4f\nHighest value: %10.4f\nAverage:       %10.4f", lowest, highest, (average/count));
} 
```

# sql - 使用 ASSL 脚本部署/创建 Analysis Services 数据库

> ID：629799
> 
> 赞同：0
> 
> 时间：2009-03-10T11:47:14.077
> 
> 标签：sql, sql-server, ssas, olap

我正在尝试使用 ASSL 脚本部署为 Analysis Services 数据库。

我可以在管理工作室中使用“script as”创建脚本。但我不知道如何运行这个脚本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:04:23.630

在管理工作室中找到了答案，新的 XMLA 查询完成了这项工作。

# tsql - 在 Business Objects Desktop Intelligence (BO Deski) 中格式化时间跨度

> ID：629802
> 
> 赞同：0
> 
> 时间：2009-03-10T11:47:38.210
> 
> 标签：tsql, reporting, business-objects, timespan

谁能告诉我如何以人类可读的形式（例如 1d 5h 2m 13s）格式化给定的秒数（例如 16742 秒）

*   使用 BO 字段公式
    或
*   从 T-SQL SELECT 语句中（其中 Duration as Seconds 来自 SUM 聚合）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T22:23:43.727

我个人会为此制作一个 TSQL 函数。以下是您可以调整的示例：

```
IF(OBJECT_ID('FN_STRING_TO_TIME', 'FN') IS NOT NULL)
    DROP FUNCTION FN_STRING_TO_TIME
GO

CREATE FUNCTION dbo.FN_STRING_TO_TIME( 

    -- Seconds to convert
    @pSeconds   INT
)
RETURNS VARCHAR(12)
---------------------------------------------------------------------------------------
-- Developer:       Linus Brimstedt
-- Date:        2009-03-17
--
-- Function:        Returns the given seconds in H:MM:SS format
--          
-- Output:          String in format H:MM:SS
--          
---------------------------------------------------------------------------------------
BEGIN

-----------------------------
-- Variables
-----------------------------

    DECLARE @output     VARCHAR(30) -- Describe the variables

    DECLARE @minutes    INT
    DECLARE @hours      INT

-----------------------------
-- Implementation
-----------------------------

    SET @minutes = @pSeconds / 60
    SET @pSeconds = @pSeconds % 60

    SET @hours = @minutes / 60
    SET @minutes = @minutes % 60

-----------------------------
-- Return output
-----------------------------
    RETURN  CAST(@hours AS VARCHAR) + ':'
    +   dbo.FN_STRING_LPAD(@minutes, 2, '0') + ':'
    +   dbo.FN_STRING_LPAD(@pSeconds, 2, '0') 
END
GO

-- Test
DECLARE @seconds    INT
,   @got        VARCHAR(12)
,   @expected   VARCHAR(12)

SELECT  @seconds = 67
,   @expected = '0:01:07'
SET @got = dbo.FN_STRING_TO_TIME(@seconds)

IF(@got != @expected)
    RAISERROR('FN_STRING_TO_TIME(%d) returned bad value: Expected: %s, got %s', 11, 11, @seconds, @expected, @got)

SELECT  @seconds = 60 * 60 * 7 + 60 * 14 + 34
,   @expected = '7:14:34'
SET @got = dbo.FN_STRING_TO_TIME(@seconds)

IF(@got != @expected)
    RAISERROR('FN_STRING_TO_TIME(%d) returned bad value: Expected: %s, got %s', 11, 11, @seconds, @expected, @got) 
```

干杯/L

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-08T03:04:19.627

我已经使用 Deski 和四个变量完成了它。从小时测量开始，创建一些变量，在下面我的年变量是 vYears，我的月变量是 vMonths，我的天变量是 vDays，我的小时变量是 vHours。

vYears 使用以下计算：

```
=Floor(Sum(<Hours Billed by Date Billed>/24)/365.25) 
```

vWeeks 使用以下计算：

```
=Floor(Sum((Sum(<Hours Billed by Date Billed>/24)/365.25)-<vYears>)*365.25/7) 
```

vDays 使用以下计算：

```
=Floor(Sum(Sum((Sum(<Hours Billed by Date Billed>/24)/365.25)-<vYears>)*365.25/7-<vWeeks>)*52/24) 
```

vHours 使用以下计算：

```
=Truncate(Sum((Sum(Sum((Sum(<Hours Billed by Date Billed>/24)/365)-<vYears>)*365/7-<vWeeks>)*52/24-<vDays>)*24) , 2) 
```

然后我可以通过执行以下操作来输出这些变量：

```
=<vYears>+" Years "+<vWeeks>+" Weeks "+<vDays>+" Days "+<vHours>+" Hours" 
```

如果您需要更多信息，请不要犹豫。

谢谢，

马特

# java - 什么是最高效的 Java Collections 库？

> ID：629804
> 
> 赞同：137
> 
> 时间：2009-03-10T11:48:07.240
> 
> 标签：java, collections

什么是最高效的 Java Collections 库？

几年前，我做了很多 Java，当时的印象是[trove](http://trove4j.sourceforge.net/)是最好的（最有效的）Java Collections 实现。[但是当我阅读“最有用的免费 Java 库？](https://stackoverflow.com/questions/130095/most-useful-free-java-libraries) ”这个问题的答案时，我注意到几乎没有提到[trove 。](http://trove4j.sourceforge.net/)那么现在哪个 Java Collections 库最好呢？

**更新：**为了澄清，我主要想知道当我必须在哈希表等中存储数百万个条目时使用什么库（需要一个小的运行时和内存占用）。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-03-10T22:23:50.333

`int`问题是（现在）关于在 Map 中存储大量数据，这些数据可以使用原始类型（如 ）来表示。在我看来，这里的一些答案非常具有误导性。让我们看看为什么。

我修改了[trove](http://trove4j.sourceforge.net/index.html)的基准测试来测量运行时和内存消耗。我还在这个基准测试中添加了[PCJ](http://pcj.sourceforge.net/)，这是另一个原始类型的集合库（我广泛使用它）。“官方”的 trove 基准没有将 IntIntMaps 与 Java Collection 进行比较`Map<Integer, Integer>`，从技术角度来看，存储`Integers`和存储可能`ints`并不相同。但是用户可能不关心这个技术细节，他想要`ints`有效地存储可表示的数据。

首先是代码的相关部分：

```
new Operation() {

     private long usedMem() {
        System.gc();
        return Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();
     }

     // trove
     public void ours() {
        long mem = usedMem();
        TIntIntHashMap ours = new TIntIntHashMap(SET_SIZE);
        for ( int i = dataset.size(); i-- > 0; ) {
           ours.put(i, i);
        }
        mem = usedMem() - mem;
        System.err.println("trove " + mem + " bytes");
        ours.clear();
     }

     public void pcj() {
        long mem = usedMem();
        IntKeyIntMap map = new IntKeyIntOpenHashMap(SET_SIZE);
        for ( int i = dataset.size(); i-- > 0; ) {
           map.put(i, i);
        }
        mem = usedMem() - mem;
        System.err.println("pcj " + mem + " bytes");
        map.clear();
     }

     // java collections
     public void theirs() {
        long mem = usedMem();
        Map<Integer, Integer> map = new HashMap<Integer, Integer>(SET_SIZE);
        for ( int i = dataset.size(); i-- > 0; ) {
           map.put(i, i);
        }
        mem = usedMem() - mem;
        System.err.println("java " + mem + " bytes");
        map.clear();
     } 
```

我认为数据是原始的`ints`，这看起来很理智。但这意味着 java util 的运行时惩罚，因为自动装箱，这对于原始集合框架来说不是必需的。

`gc()`WinXP、jdk1.6.0_10 上的运行时结果（当然没有调用）：

```
                      100000 个 put 操作 100000 个包含操作
Java 集合 1938 毫秒 203 毫秒
宝库 234 毫秒 125 毫秒
电脑 516 毫秒 94 毫秒

```

虽然这可能看起来很激烈，但这不是使用这样一个框架的原因。

原因是内存性能。包含 100000`int`个条目的 Map 的结果：

```
java 集合在 6644536 和 7168840 字节之间波动
宝库 1853296 字节
pcj 1866112 字节

```

与原始集合框架相比，Java 集合需要**三倍以上的内存。**也就是说，您可以在内存中保留三倍的数据，而无需使用磁盘 IO，这会大大降低运行时性能。这很重要。阅读[highscalability](http://highscalability.com/)以找出原因。

以我的经验，高内存消耗是 Java 最大的性能问题，这当然也会导致运行时性能更差。原始集合框架可以在这里真正提供帮助。

所以：不，java.util 不是答案。在询问效率时，向 Java 集合“添加功能”并不是重点。此外，现代 JDK 集合“甚至**不**胜过专门的 Trove 集合”。

免责声明：这里的基准测试远非完整，也不是完美的。这是为了让我明白这一点，我在许多项目中都经历过。**如果**您使用大量数据，原始集合足以容忍可疑的 API 。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2009-03-10T11:59:46.650

从检查来看，Trove 似乎只是一个原始类型的集合库——它并不是要在 JDK 中的普通集合上添加很多功能。

就个人而言（而且我有偏见）我喜欢[Guava](https://github.com/google/guava)（包括以前的 Google Java Collections 项目）。它以一种至少相当有效的方式使各种任务（包括集合）变得更加容易。鉴于集合操作很少在我的代码中形成瓶颈（根据我的经验），这比集合 API“更好”，它可能更有效但不会使我的代码具有可读性。

鉴于 Trove 和 Guava 之间的重叠几乎为零，也许您可​​以澄清您实际从收藏库中寻找的内容。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2012-02-10T00:52:11.517

我知道这是一篇旧帖子，这里有很多答案。但是，就建议图书馆而言，上面的答案是肤浅的并且过于简化了。没有一个库在此处提供的各种基准测试中表现出色。我得出的唯一结论是，如果您关心性能和内存，特别是处理原始类型，那么看看非 jdk 替代品就更值得了。

就基准机制和所涵盖的库而言，这是一个更合理的分析。 [这](http://mail-archives.apache.org/mod_mbox/mahout-dev/201103.mbox/%3CAANLkTimgGKApQd=FtBA-bXpr+=b8W-Fg0axC5aUAED6Z@mail.gmail.com%3E)是 mahout 开发人员列表中的一个线程。

涵盖的库是

*   高压PC
*   特罗夫
*   快速实用程序
*   Mahout (柯尔特)
*   Java 集合

*2015 年 6 月更新*：不幸的是，原始基准不再可用，而且有点过时。 [这](http://java-performance.info/hashmap-overview-jdk-fastutil-goldman-sachs-hppc-koloboke-trove-january-2015/)是其他人完成的相当近期（2015 年 1 月）的基准测试。它不像原始链接那样全面，也没有交互式探索工具。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-10T13:07:41.853

正如其他评论家所注意到的那样，“高效”的定义撒下了一张大网。然而，还没有人提到[Javolution 库](http://javolution.org/)。

一些亮点：

*   Javolution 类很快，非常快（例如，O[Log(n)] 中的文本插入/删除，而不是标准 StringBuffer/StringBuilder 的 O[n]）。
*   所有 Javolution 类都是硬实时兼容的，并且具有高度确定性的行为（在微秒范围内）。此外（与标准库不同），Javolution 是 RTSJ 安全的（与 Java 实时扩展一起使用时不会发生内存冲突或内存泄漏）。
*   Javolution 的实时集合类（地图、列表、表格和集合）可以用来代替大多数标准集合类并提供附加功能。
*   Javolution 集合提供并发保证，使并行算法的实现更容易。

Javolution 发行版包含一个基准套件，因此您可以查看它们如何与其他库/内置集合相比较。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-10T15:47:36.477

一些要考虑的集合库：

*   java.util 中的 Java 集合
*   [特罗夫](http://trove4j.sourceforge.net/)
*   [谷歌收藏](http://code.google.com/p/google-collections/)库
*   [Apache Commons 集合](http://commons.apache.org/collections/)
*   来自 Cliff Click[的大规模库](http://sourceforge.net/projects/high-scale-lib)
*   Doug Lea 的[集合](http://gee.cs.oswego.edu/dl/classes/collections/index.html)库 - 不再受支持，大部分在 JDK 中重建

我首先会接触到 JDK 集合库。它涵盖了您需要做的最常见的事情，显然您已经可以使用它。

Google Collections 可能是 JDK 之外最好的高质量库。它被大量使用并得到很好的支持。

Apache Commons Collections 比较老，有点受“厨师太多”问题的困扰，但也有很多有用的东西。

Trove 为原始键/值等情况提供了非常专业的集合。如今，我们发现在现代 JDK 以及 Java 5+ 集合和并发用例中，JDK 集合的性能甚至胜过专门的 Trove 集合。

如果您有真正的高并发用例，您绝对应该检查大型库中的 NonBlockingHashMap 之类的东西，这是一个无锁实现，如果您有正确的用例，它可以踩在 ConcurrentHashMap 上。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-10T12:05:09.243

**`java.util`**

很抱歉，答案很明显，但对于大多数用途，默认的[Java 集合](http://java.sun.com/javase/6/docs/technotes/guides/collections/overview.html)绰绰有余。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-12T00:54:58.417

要在地图中存储数百万`String`，请查看[http://code.google.com/p/flatmap](http://code.google.com/p/flatmap)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-04-02T22:47:01.457

我是[source-forge 上快乐收藏的快乐收藏开发者](http://sourceforge.net/projects/happy-guys/files/)

1.  基于事件的集合
2.  不可修改
3.  排序列表
4.  缓存

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-10T12:13:04.903

`java.util.concurrent`如果您计划在多个线程中使用 HashMap，则应提及[ConcurrentHashMap](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html) 以及包。由于这是标准 java 的一部分，因此内存占用很小。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-10T12:35:04.677

取决于我们如何定义“高效”。

每个数据结构都有自己的 Big-Oh 行为，用于读取、写入、迭代、内存占用等。一个库中的链表可能与其他库中的链表相同。并且哈希映射读取 O(1) 比链表 O(n) 更快。

> 但是当我阅读“最有用的免费 Java 库？”这个问题的答案时。我注意到几乎没有提到 trove。

这听起来不像“最有效的”。对我来说，这听起来像是“最受欢迎的”。

只是一些反馈——我从未听说过它，也不知道有谁用过它。JDK、Google 或 Apache Commons 中内置的集合对我来说是众所周知的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-10T12:59:20.750

Trove 提供了一些优势。

*   更小的内存占用，它不使用 Map.Entry 对象
*   您可以使用散列策略而不是键来映射映射，这可以节省内存，并且意味着您无需在每次想要将对象缓存在一组新属性上时都定义新键
*   它具有原始集合类型
*   认为它有某种形式的内部迭代器

也就是说，自从编写 trove 以来，已经做了很多工作来改进 jdk 集合。

不过，正是哈希策略使它对我很有吸引力……谷歌搜索并阅读他们的概述。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-10T16:42:11.480

如果您想在哈希表中存储数百万条记录，您很可能会遇到内存问题。例如，当我尝试使用 230 万个 String 对象创建地图时，这发生在我身上。我选择了[BerkeleyDB](http://www.oracle.com/technology/products/berkeley-db/index.html)，它非常成熟且性能良好。他们有一个封装了 Collections API 的 Java API，因此您可以轻松创建任意大的地图，而内存占用很少。虽然访问会更慢（因为它存储在磁盘上）。

**后续问题**：是否有一个体面（且高效）、维护良好的不可变集合库？Clojure 对此有很好的支持，如果 Java 有类似的东西就好了。

# cygwin - cygwin中的循环挂载

> ID：629827
> 
> 赞同：5
> 
> 时间：2009-03-10T11:56:49.137
> 
> 标签：cygwin

可以在cygwin中进行循环安装吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-08-12T18:03:42.963

不幸的是，您不能，但您可以使用其他命令行工具进行访问，如下所示。

如果您更喜欢命令行，您可以在 Windows 下使用 FileDisk（适用于 Win32 和 Win64），但它需要安装驱动程序。

另一个选项是[ImDisk](http://www.ltr-data.se/opencode.html/)（同样适用于 Win32 和 Win64）。它既是命令行又是 GUI；位于控制面板中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T14:40:47.247

看[这里](https://stackoverflow.com/questions/122767/mount-floppy-image-in-cygwin)

减少额外的搜索：

[虚拟软驱](http://chitchat.at.infoseek.co.jp/vmware/vfd.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-08T01:11:30.113

当然可以，但它只是不叫那个！Cygwin 中的`mount`命令被严重削弱，以至于它甚至不配取这个名字。至少在过去，这可能是有充分理由的。只有在引入 Windows 8 及更高版本时，ISO 映像才能在没有额外工具的情况下自动安装，使用非黑客的仅限 Windows 命令。

对于其他/旧版本的 windows，有一种补丁叫做： [Windows ISO mount (Virtual CD-ROM Control Panel)](http://www.microsoft.com/en-us/download/details.aspx?id=38780)

但是，有很多开源工具可以从 GUI 或命令行有效地执行相同的操作。这些工具通常支持所有最常见的文件系统格式，例如：`EXT2/3/4, ReiserFS, HFS, HFS+, NTFS, FAT, exFAT, UFS2`等。问题是没有一个独特的命令行工具可以做到这一切。[ImDisk](http://reboot.pro/files/file/284-imdisk-toolkit/)（如上所述）非常好，因为它提供了一种可以包含几乎任何东西的 RAM 磁盘。其他适用于 CMD 的流行工具有：虚拟克隆驱动器 (VCD)、[ext2fsd](http://sourceforge.net/projects/ext2fsd/)、[wincdemu](http://sourceforge.net/projects/wincdemu/)、[fs-driver](http://www.fs-driver.org/)。

因此，有了所有这些，您应该能够`mount`为您的 Cygwin 设置编写一个很好的包装器。（当您提交时，请随时将其提交给 Cygwin 开发人员。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T12:11:26.637

不可以。您必须使用虚拟软盘驱动器等 Windows 原生解决方案。

# apache - wget -k 在 Windows 和 Linux 上以不同方式转换文件

> ID：629831
> 
> 赞同：5
> 
> 时间：2009-03-10T11:59:27.323
> 
> 标签：apache, wget

我有适用于 windows 和 linux 的**GNU Wget 1.10.2并且****-k**选项在这两者上的行为不同。

> -k, --convert-links 使下载的 HTML 中的链接指向本地文件。

在 Windows 上它产生：

```
www.example.com/index.html
www.example.com/index.html@page=about
www.example.com/index.html@page=contact
www.example.com/index.html@page=sitemap

```

在linux上它产生：

```
www.example.com/index.html
www.example.com/index.html?page=about
www.example.com/index.html?page=contact
www.example.com/index.html?page=sitemap

```

这在 linux 中是有问题的，因为当我通过 Apache 提供镜像时，它不会区分 4 个生成的页面，因为问号 ( **?** ) 字符之后的部分用作文件的查询字符串。

关于如何控制它的任何想法？

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-10T12:01:29.860

您不能在 NTFS 或 FAT32 的文件名中使用问号 (?)。这就是 wget 使用 at 符号 (@) 的原因。

在 Linux 中，大多数文件系统只禁止使用斜杠 (/)，因此 wget 使用问号（因为它是 URI 的一部分）。

您可以使用`--restrict-file-names=unix`或强制执行任一行为`--restrict-file-names=windows`。

从 wget 文档：

> 当模式设置为“unix”时，Wget 会转义字符 '/' 和 0-31 和 128-159 范围内的控制字符。这是类 Unix 操作系统的默认设置。
> 
> 当模式设置为“windows”时，Wget 会转义字符'\'、'|'、'/'、':'、'?'、'"'、'*'、'<'、'>'、以及控制字符在 0-31 和 128-159 范围内。除此之外，Windows 模式下的 Wget 使用 '+' 代替 ':' 来分隔本地文件名中的主机和端口，并使用 '@' 代替“？” 将文件名的查询部分与其余部分分开。因此，在 Unix 模式下将保存为 '<code>www.xemacs.org:4300/search.pl?input=blah' 的 URL 将保存为 ' <code>www.xemacs.org+4300/search.pl@input=blah' 在 Windows 模式下。此模式是 Windows 上的默认模式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T15:06:42.457

> 这在 linux 中是有问题的，因为当我通过 Apache 提供镜像时，它不会区分 4 个生成的页面，因为问号 (?) 字符之后的部分用作文件的查询字符串。

要在 URL 路径部分中包含问号，您可以对其进行转义：

```
www.example.com/index.html%3Fpage=about 
```

--convert-links 应该为你做这个，我想——如果不是，可能是一个错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T12:08:10.203

看[`--restrict-file-names=windows`](http://www.gnu.org/software/wget/manual/wget.html#index-Windows-file-names-60)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-06-09T14:48:07.883

> 这在 linux 中是有问题的，因为当我通过 Apache 提供镜像时，它不会区分 4 个生成的页面，因为问号 (?) 字符之后的部分用作文件的查询字符串。

如果已经太晚了，这个 sed 命令帮助了我：

```
find . -type f -name "*html*" -exec sed -i -r 's/(src|href)=(["\x27])(.*?)(\?)(.*?)\2/\1=\2\3%3F\5\2/g' {} + 
```

它取代 ? 在带有 %3F 的 href= 或 src= 标记中。（\x27 是单个刻度）

# asp.net - 在 asp.net 中捕获表单帖子 - VS2008

> ID：629834
> 
> 赞同：1
> 
> 时间：2009-03-10T11:59:57.290
> 
> 标签：asp.net

我有第 3 方通过表单发布提交数据。我想在没有实际操作的情况下捕获帖子的内容

```
Request[FormElementName"].ToString() 
```

对于我期待的每一个元素

Request 对象中是否有一些方法/属性可以让我捕获整个表单帖子？类似的东西

```
Request.RawUrl.ToString() 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:04:40.383

该`Request.Form`属性返回一个包含所有已发布参数的 NameValueCollection。

你可以做一些简单的事情：

```
NameValueCollection nvc = Request.Form;
foreach (string key in nvc.AllKeys)
{
  Debug.WriteLine("Key - " + key);
  Debug.WriteLine("Value - " + nvc[key]);
  Debug.WriteLine("---");
} 
```

**编辑：**如果您还需要查询 QueryString 值，请`Request.Params`以相同的方式使用该属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T12:03:01.760

**您可以通过Page.Request.Form**集合获取所有已发布的元素。

# visual-studio - Delphi（.NET）的最佳替代IDE是什么

> ID：629837
> 
> 赞同：14
> 
> 时间：2009-03-10T12:01:08.520
> 
> 标签：visual-studio, delphi, debugging, emacs, ide

我在 Delphi 2007（win32 和 .Net）中工作，但 CodeGear IDE 经常让我烦恼，所以如果可能的话，我想找一个替代品。

我们有一个构建脚本，所以我可以从命令行编译，而且我很少做任何 GUI 设计，所以我唯一需要的是一个文本编辑器（带有语法突出显示、自动完成/智能感知......）。

我想使用 Visual Studio 或 Emacs，但不知道在这些环境中处理 Delphi 代码的可行性。特别是调试 - 即使我不使用 Delphi IDE 进行编辑，它还能充当我的调试器吗？

有没有人有脱离RAD工作室的经历？

PS 我知道新的 Delphi Prism 但这不能解决我的问题 - 我仍然需要在 vanilla Delphi 中工作并使用 Delphi 2007 编译器。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-11T05:45:24.763

您可以做的一件事是加入[GExperts](http://www.gexperts.org/)让您的生活更美好。 [（来源：][[gexperts.org](http://www.gexperts.org/tour/procedure%20list.png)][）][![替代文字](https://i.stack.imgur.com/YHN4w.png)](https://i.stack.imgur.com/YHN4w.png)

[![替代文字](https://i.stack.imgur.com/Vu8bb.png)](https://i.stack.imgur.com/Vu8bb.png)
[（来源：[gexperts.org](http://www.gexperts.org/tour/grep%20results.png)）]

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T12:48:51.993

Emacs 似乎有一个[Delphi 编辑模式](http://www.emacswiki.org/emacs/DelphiMode)，如果你想启动和运行，这可能是一个很好的起点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-11T08:16:28.317

您当然可以在 Delphi IDE 之外编辑源文件。当您切换回 IDE 时，它会注意到文件已在其外部更改，并询问您是否重新加载它们（如果它们当前在编辑器中打开）。如果您从未在 IDE 中进行编辑，这是一件安全的事情，但为了避免出现确认，最好在您在 emacs 中编辑源文件时根本不要在 Delphi 编辑器中打开源文件。

即使您使用自定义构建脚本并从 emacs 构建项目，您仍然应该保持项目文件是最新的。当您在 IDE 中使用调试器时，它通常会首先编译项目。为了让它始终有效（即使是视觉形式或框架继承），正确的项目文件至关重要。当您在搜索/浏览路径中的不同目录中有多个具有相同名称的源文件，或者如果您的搜索/浏览路径中没有所有源目录时，调试也很重要。

无论您使用什么工具来编辑或更改源文件，请确保在所有行中始终使用 DOS 样式 CR+LF 行尾（*\r\n*，*#13#10*），仅作为 LF （*\n*，*#10* ) 容易混淆 IDE - 您会注意到调试器中的蓝点与源代码行不同步，并且编译器错误行号是错误的。在源文件上使用*sed*或*awk*可以节省大量时间，但请务必使用为 Win32 编译的工具，而不是（例如）cygwin 环境提供的工具。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-11T08:40:18.353

我知道名为[Lazarus](http://www.lazarus.freepascal.org/)的 FreePascal 编辑器是一个不错的替代品。

虽然它与 VCL 不兼容，但它只适用于新项目。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-12T10:38:26.627

如果您的主要问题是 Delphi 2007 IDE 的低速，请使用[DelphiSpeedUp](http://andy.jgknet.de/blog/?page_id=8)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T13:07:40.137

如果你有 Delphi 2009 并且不烦你，试试[Andy 的 IDE Compiler Plugin 1.0](http://andy.jgknet.de/blog/?page_id=160)
它可以用来用 Delphi 2009 编译一个 Delphi 2007 项目。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-10T13:08:32.587

我使用 CodeFactor，但不幸的是它不再可用。

Delphi 2009 是一个相当大的改进，甚至超过了 Delphi 2007，所以如果你有办法，那可能会有很大帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-08-07T08:17:48.237

请参阅 codefactor2.com 上的免费 OPEditII [该页面不再可用，而是显示垃圾邮件] 这听起来像是后期 codefactor 的免费和更新版本。值得一提的是，它在 Windows 7 64 位下运行起来就像一个魅力，而且速度非常快，集成了 Delphi 代码解析器。所以你有一个类浏览器、代码完成、从接口到实现的代码导航，以及很多代码重构工具。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-10T12:14:11.797

看看[Multi Edit——](http://www.multiedit.com/)它是一个很棒的编辑器，并且支持 Borland 产品

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-10T23:42:59.050

你应该试试[Semware](http://www.semware.com/)的 TSEPro（又名 QEdit）。它支持该语言，一个非常强大的宏系统，并支持从编辑器内部通过 bcc32 进行编译。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-10T12:17:37.607

一种选择是[EditPad Pro](http://www.editpadpro.com/editdelphi.html)。我没有尝试过该产品，但我知道供应商是可靠的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-12T00:13:54.707

[ConText](http://www.contexteditor.org/)或[EditPad Pro](http://www.editpadpro.com/editdelphi.html)都为 Delphi 代码提供语法突出显示，许多其他程序员编辑器也是如此（尽管他们有时称其为 Pascal）。不过这两种我都用过，而且效果很好。当我想打开代码片段或示例时，我会使用它们。

它们都有一个很好的特性，就是能够将特定命令与某些文件类型相关联。因此，您可以将 Delphi 命令行编译器或构建脚本与源文件相关联，以允许您从那里构建、运行单元测试等。我对其他命令行编译器也做过类似的事情，但坦率地说，我真的很喜欢 Delphi IDE，所以没有必要尝试替换它。

# database - 在 Web 应用程序中修改标签。最佳实践

> ID：629857
> 
> 赞同：0
> 
> 时间：2009-03-10T12:08:46.503
> 
> 标签：database, schema, web-applications, tags

当在文本框中并排显示时，系统是否有一种有效的方法来更新项目的标签，类似于 StackOverflow？

在我的网络应用程序中，各个项目都有标签，我在标签表和项目表之间使用链接表来保持一些正常性。

这里讨论了数据库模式： [是否有一个公认的理想的标记模式](https://stackoverflow.com/questions/172648/is-there-an-agreed-ideal-schema-for-tagging) 和这里： [如何设计数据库模式以支持使用类别进行标记？](https://stackoverflow.com/questions/373126/how-to-design-a-database-schema-to-support-tagging-with-categories)

在每次修改项目时，很容易删除与项目关联的所有标签，然后根据文本框的内容（标签由空格分隔）将它们重新添加到数据库中。

但是，即使用户没有进行任何更改，这也可能意味着 2/3 的数据库调用。

我还考虑过根本不允许修改标签。在编辑时，我可以通过每个标签向用户显示一个小十字，允许他们通过 AJAX 调用删除该项目。

但是，这种解决方案在修改单个标签中的拼写错误等情况下不会方便用户。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T12:31:32.363

再想一想，我想我将有一个函数来创建标签字符串以显示在更新表单上。

如果在更新时，我要再次调用该函数并比较字符串，至少我可以通过单个 db 调用过滤掉标签根本没有更改的位置。

然后，只有标签不同，我才能进行更新。

效率会不会很高？

# visual-studio - Visual Studio 2005 测试工具是否包含模拟工具？

> ID：629864
> 
> 赞同：1
> 
> 时间：2009-03-10T12:12:09.350
> 
> 标签：visual-studio, unit-testing, mocking

我正在使用 VSTS 2005，虽然单元测试工具相当简单，但我想知道是否有任何形式的模拟支持。我讨厌不得不手动进行模拟，因为这会导致很多（主要是生成的）样板代码。

我有一条来自 The Powers That Be 的法令，第三方模拟库不是一种选择。我很确定这意味着我将用手嘲弄，但人们总是可以希望的。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T12:14:05.040

不，没有支持。您需要为此使用 3rd 方工具（哎呀猜你不能）我的意思是您需要手动完成...抱歉成为坏消息的承担者

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:39:22.250

在生产代码中要求没有第三方库可能是一个合理的要求（我不同意），但是禁止您在单元测试中使用第三方（通常是免费的）库似乎很疯狂。开发您自己的模拟框架，除非您有现有需求没有充分解决的需求，否则会浪费宝贵的开发人员时间。你应该花时间编写测试和代码来完成你的业务目的，并花最少的时间编写辅助软件来帮助你做到这一点。

我知道有些人觉得所有的模拟框架都是邪恶的，你应该总是手动模拟。这是一个不同的论点，有一些有效的观点，尽管我不在那个阵营。但是，如果问题是您可以使用 MS 模拟框架（至少目前还不存在）或根本没有框架，那有点愚蠢。单元测试中使用的模拟框架不会损害您的生产代码。

请随时与**The Powers That Be** ™分享我的回应

# c++ - 哪个版本的 GNU GCC 支持 TR1 外部模板？

> ID：629865
> 
> 赞同：4
> 
> 时间：2009-03-10T12:12:13.500
> 
> 标签：c++, gcc, external, tr1

最早支持[外部模板的](http://gcc.gnu.org/ml/gcc-help/2008-06/msg00159.html)[GNU GCC](http://gcc.gnu.org/) (g++) 版本是什么？例如，4.0 版是否已经支持？`TR1`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T12:40:00.453

[您可以在此处](http://gcc.gnu.org/projects/cxx0x.html)找到支持的 C++-0x 功能列表和支持它们的 G++ 版本。列中有一个简单的“是”，所以我假设它们在 4.3 或更早版本中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-03T17:37:04.290

根据理查德的回答，这个功能显然来自 gcc，（根据[文档](http://gcc.gnu.org/onlinedocs/gcc-3.2.3/gcc/Template-Instantiation.html#Template%20Instantiation)）它至少从 gcc 3.2.3 就已经存在。

# database - 数据库表的草稿版本

> ID：629873
> 
> 赞同：7
> 
> 时间：2009-03-10T12:15:02.073
> 
> 标签：database, design-patterns, database-design

我有一个带有报告表的数据库。此表代表报表数据，并具有约束条件。现在该应用程序被消防员使用，他们可能不得不逃跑并扑灭一些火灾。所以在为这张表填写数据的过程中，他们可能不得不跑掉。我们所做的是，当会话结束时，我们将数据保存到草稿表中，在这里我们只是序列化对象图，没有约束（因为我们无法知道一切是否处于有效状态）。当消防员稍后想要提取数据时，我们只需再次提取草稿即可。

这很好用！然而，消防员现在希望能够搜索表格和草稿表。所以在这里我想可能将所有数据（包括草稿）存储到一个我搜索的表中，所以我不必合并来自两个表的搜索..

草稿是否有某种数据库模式？我想要的是一种无约束（草稿模式）和有约束（最终模式）存储数据的模式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:20:16.150

我不知道这是否有资格作为一种模式，但我认为最干净的方法是创建一个视图，将两个表合并并对其进行搜索。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:19:10.393

我不知道草稿的数据库模式，但如果您需要验证并简单地在两个表上搜索，我建议您保留单独的表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:25:32.890

使用简单的解决方案：创建一个视图，它只是两个表的并集（这应该是相当简单的，因为我认为它们都具有（几乎）相同的结构），然后如果他们想要的话，将其作为源运行搜索包括两者。

我实际上不会在任何时候合并完整数据和草稿数据：错误和意外使用未经验证的数据的可能性似乎很大。

您目前不会在英国为 IRS 开发接口，对吗？如果没有，听起来 DK 已经为这个问题寻求了类似的（原则上）解决方案（我曾经为英国消防和救援服务工作）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-19T23:00:40.867

我对这个问题想了很久很久，这是我的答案：

1.  将草稿及其对应的已验证实体存储在同一个表中。有一个 is_draft 列

2.  使用 is_draft=1 关闭触发器中的验证并检查约束，或您的 ORM 验证规则

3.  您的许多字段必须可以为空或具有默认值

这有几个优点：

1.  草稿及其对应的已验证实体存储在同一个表中

2.  草稿及其对应的已验证实体*具有相同的 id*。为什么这很重要？

假设您开始为客户报价。保存。它有一个 id。您正在网络浏览器 /quotes/id/55 中查看它。您开始编辑该报价，删除所需的值，因为它是错误的。您必须去隔壁查找它，但您想保存它。身份证号码不应该改变。

如果人们在同一个文档上进行协作，并且如果它进出有效状态，它的 id 会不断变化，这也会让人们感到困惑。

# bash - 无法从我的服务器 scp 到我的计算机

> ID：629874
> 
> 赞同：3
> 
> 时间：2009-03-10T12:15:23.587
> 
> 标签：bash, scp

以下代码不起作用

```
scp /home/username/public_html/site/pictures/* myUsernameAtMyMac@myIpAddress:/home/Masi/Desktop/ 
```

我的 Mac 防火墙中有“仅允许基本服务”。

你怎么能解决这个问题？

**[编辑]**

在允许的服务列表中有“远程登录”后，我收到以下错误。**我还允许“所有用户”。**

```
scp favicon.ico Masi@11.111.11.111:/home/Masi/Dropbox/
ssh: connect to host 11.111.11.111 port 22: Connection timed out
lost connection 
```

**[编辑]** 我尝试通过以下命令从另一台 Macbook 登录到我的计算机失败

```
ssh Masi@11.111.11.111 
```

我收到操作超时错误。

我曾经设法使用上述命令从我的服务器连接到我的计算机，但连接很快就超时了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T12:26:55.133

您需要在 Mac 的防火墙配置中将 SSH 服务添加到允许的应用程序，并将防火墙设置更改为“设置特定服务和应用程序的访问权限”。

将防火墙设置为“仅允许基本服务”。阻止与您机器上运行的服务的传入连接。

另请参阅 Apple 支持网站：[http ://docs.info.apple.com/article.html?path=Mac/10.5/en/11783.html](http://docs.info.apple.com/article.html?path=Mac/10.5/en/11783.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:19:32.110

scp 命令本身没问题。

至于你的问题，不可能用给出的信息说。能ping通机器吗？尝试使用“-v”开关进行 ssh，以查看您是否获得有关连接过程的更多相关信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T13:20:37.987

使用您的 Mac 尝试此命令。无需任何防火墙修改或路由器设置即可工作。

```
scp yourUsernameAtYourServer@YourServer:/home/username/public_html/site/pictures/* /home/Masi/Desktop/ 
```

如果您使用 NAT 获得更多连接到互联网的盒子，则此方法不起作用。Mac 的 IP 在家庭网络之外不可见。在这种情况下，您必须向路由器添加端口转发规则。

```
myUsernameAtMyMac@myIpAddress 
```

# sql - SQL Server 2000 命令禁用用户帐户

> ID：629875
> 
> 赞同：2
> 
> 时间：2009-03-10T12:16:19.433
> 
> 标签：sql, sql-server, sql-server-2000

我需要禁用 sql server 2000 版中的一些用户帐户。以下 sql 命令给了我一个“'Login' 附近的语法错误”错误。用户名有效且拼写正确，所以我想知道 2000 版的命令语法是否不同。

```
ALTER LOGIN exampleuser DISABLE 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T12:20:32.200

SQL Server 2000 没有 ALTER LOGIN 语句。因此，为了能够禁用登录，您必须改为调用 sp_denylogin 过程。

```
EXEC sp_denylogin 'exampleuser' 
```

或者

```
EXEC sp_revokelogin 'exampleuser' 
```

要再次授予他们访问权限，您应该使用

```
EXEC sp_grantlogin 'exampleuser' 
```

*注意：* `sp_denylogin`，`sp_revokelogin`并且`sp_grantlogin`仅适用于 Windows 帐户和组。

为了能够拒绝纯 SQL Server 登录，似乎唯一的选择是完全删除该登录

```
EXEC sp_droplogin 'exampleuser' 
```

但要再次启用它，它需要重新创建

```
EXEC sp_addlogin 'exampleuser', 'examplepassword' 
```

**或者只是删除对当前**数据库的登录访问

```
EXEC sp_revokedbaccess 'exampleuser' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T12:32:42.360

sp_revokelogin 将删除登录条目。然而，这个过程已经被[弃用](http://msdn.microsoft.com/en-us/library/ms188784.aspx) ，支持[drop login 。](http://msdn.microsoft.com/en-us/library/ms188012.aspx)

但请注意，这两个都不会禁用用户，而是*删除*登录。

您的 ALTER LOGIN 方法是正确的

```
ALTER LOGIN exampleuser DISABLE; 
```

至少适用于 sql server 2008。

# linq-to-sql - 奇怪的 linq2sql/let 错误？

> ID：629878
> 
> 赞同：0
> 
> 时间：2009-03-10T12:16:54.050
> 
> 标签：linq-to-sql

有人可以解释为什么存在以下 linq 查询...

```
(from e in db.Clients
                    let
                        log = (from f in db.CreditsafeLogs where f.Vat.Equals(e.VAT) orderby f.Sent descending select f).FirstOrDefault()
                    where
                        e.DeleteFlag.Equals("n") &&
                        e.Active == true &&
                        log != null &&
                        log.Approved == false
                    select e.Id) 
```

编译，但在运行时会破坏应用程序（即使它从未被调用），虽然它是等价的

```
Clients
   .Select (
      e => 
         new  
         {
            e = e, 
            log = CreditsafeLogs
               .Where (f => f.Vat.Equals (e.VAT))
               .OrderByDescending (f => f.Sent)
               .FirstOrDefault ()
         }
   )
   .Where (
      temp0 => 
            (((temp0.e.DeleteFlag.Equals ("n") && (temp0.e.Active == (Boolean?)True)) && 
                  (temp0.log != null)
               ) && 
               (temp0.log.Approved == False)
            )
   )
   .Select (temp0 => temp0.e.Id) 
```

工作正常？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:25:20.473

既然我们没有办法重现它，你能定义“破坏应用程序”吗？你能引用错误信息吗？有关信息，我偶尔会看到表达式编译器对可空性做出可疑的决定 - 更多信息请参见[此处](https://stackoverflow.com/questions/586097/compare-nullable-types-in-linq-to-sql/586109#586109)。这可能是相关的，但如果没有错误消息就不可能说。

# fitnesse - 我可以为 FitNesse 测试表单元格添加颜色吗？

> ID：629881
> 
> 赞同：2
> 
> 时间：2009-03-10T12:18:08.870
> 
> 标签：fitnesse

我希望能够为 FitNesse 表格单元格（有时是整行）添加彩色背景以增强其可读性。如果在运行测试页面时这些颜色被覆盖，我很高兴。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T12:30:40.243

您可以通过使用

!style_(文本)

威吉特。其中 (text) 是您定义的某个 css 类的名称。您可以在[Fitnesse.org](http://www.fitnesse.org)上查看[格式化 Fitnesse wiki 页面的各种选项](http://www.fitnesse.org/FitNesse.QuickReferenceGuide#CharacterFORMATTING)

编辑：看起来样式widgit仅用于格式化不在夹具表中的文本。例如：

```
!|Store Data Dictionary Table|VALUE_SET_VALUE|
|!style_strike(ValueSetID)|Code|Label|
|MCODESET|1|RESPONSE1|
|MCODESET|2|RESPONSE2|
|MCODESET|3|RESPONSE3|
|MCODESET|4|RESPONSE4| 
```

不将 ValueSetId 的样式设置为罢工类。但是删除 ! 从表本身就像这样确实有效：

```
|Store Data Dictionary Table|VALUE_SET_VALUE|
|!style_strike(ValueSetID)|Code|Label|
|MCODESET|1|RESPONSE1|
|MCODESET|2|RESPONSE2|
|MCODESET|3|RESPONSE3|
|MCODESET|4|RESPONSE4| 
```

您也可以尝试像这样直接应用样式：

```
!|Store Data Dictionary Table|VALUE_SET_VALUE|
|!-<span class="strike">ValueSetID</span>-!|Code|Label|
|MCODESET|1|RESPONSE1|
|MCODESET|2|RESPONSE2|
|MCODESET|3|RESPONSE3|
|MCODESET|4|RESPONSE4| 
```

这使用了输出 HTML 标签的 widgit。我尝试将它应用于该行，但它不起作用:(您可能必须标记每个单独的元素。

# asp.net-mvc - 将参数传递给 ASP.NET MVC 中的 Action 方法

> ID：629889
> 
> 赞同：1
> 
> 时间：2009-03-10T12:20:03.810
> 
> 标签：asp.net-mvc

谁能告诉我如何编写一个操作方法来处理来自具有以下输入元素的表单的数据？
<input type="checkbox" name="check[1]" />
<input type="checkbox" name="check[3]" />
方括号中的数字不是数组索引，但可以是 ID，例如，我不知道表单会有多少这样的输入字段。还是从表单中传递此类数据更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:23:17.640

```
public ActionResult Foo(IEnumerable<string> check)
{ 
```

...然后将 ID 放入输入的 value 属性中。您将获得已检查输入的 ID 列表。

如果您的 ID 恰好采用该格式，您可以将 IEnumerable 更改为 IEnumerable 或 IEnumerable。MVC 框架将为您转换它。

# c++ - 功能级链接（VC++ 中的 /Gy 开关）- 它有什么用？

> ID：629894
> 
> 赞同：29
> 
> 时间：2009-03-10T12:22:56.453
> 
> 标签：c++, optimization, visual-c++, linker

在大型 VS 解决方案（200 个 VC 项目）中使用此开关有什么好处？

据我了解，这主要影响生成的二进制文件的大小；但除了较小的二进制文件之外，FLL 是否也有助于减少项目之间的依赖关系？

FLL 通常如何影响构建时间？

我也很欣赏有关 VC 中 FLL 的有根据的解释。[MSDN](http://msdn.microsoft.com/en-us/library/xsa71f43(VS.80).aspx)的解释非常简短。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-10T12:46:29.830

由于您链接了 MSDN 的解释，因此您知道 /Gy 确保所有功能都打包在它们自己的 COMDAT 中。这样做的主要优点是，如果您有相同的功能，链接器可以将它们全部折叠成一段实际的代码（“COMDAT 折叠”）。当您有许多相同的功能时，这可能会产生非常大的影响，当您编写大量使用模板的现代 C++ 时，通常会出现这种情况。

除了由于 COMDAT 折叠和消除未引用的 COMDAT 导致生成的可执行文件的大小较小之外，/Gy 没有其他影响。具体来说，它无助于减少项目间的依赖关系。

代价是编译时间略有增加（类似于其他优化器标志）。通常不是你会注意到的东西。

# sql-server - 如何设置 SQL Server 复制使用的网络适配器？

> ID：629907
> 
> 赞同：0
> 
> 时间：2009-03-10T12:26:55.867
> 
> 标签：sql-server, database, sql-server-2005, replication

我有 2 台运行 SQL Server 2005 的服务器，它们之间设置了合并复制。

每台服务器都连接到楼宇网络，但它们也有一根交叉电缆将它们连接起来，从而创建一个专用网络。

**如何配置合并复制以使其使用专用网络而不是建筑物网络？**

专用网络不属于任何域，但构建网络可能有也可能没有域，具体取决于客户端。

我尝试使用专用网络 IP 地址设置复制，但某些存储过程仅适用于 Windows 服务器名称。我想服务器名称可以通过任一网络解析，并且我想防止复制流量在建筑物网络上发送。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:45:47.180

我不知道这是否可行，但值得一试。

*   确保交叉电缆设置为机器之间的私有子网。与每个端点关联的 IP 地址必须有一个公共前缀，该前缀不同于建筑物网络的前缀。例如，将一个端点设置为 192.168.24.1，将另一个端点设置为 192.168.24.2，并将两个端点的子网掩码设置为 255.255.255.0。

*   将这些 IP 地址添加到主机文件 \WINDOWS\system32\drivers\etc\hosts。确保您使用与现有名称不同的服务器名称。我在下面使用了 server1 和 server2。

    192.168.24.1 服务器1

    192.168.24.2 服务器2

测试使用

```
 ping server1
   ping server2 
```

以确保他们可以互相交谈。

使用 server1 和 server2 名称来配置复制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T16:06:23.140

这是一个猜测。也许 SQL 没有在那个 IP 上监听。

转到 SQL Server 配置管理器 > SQL2005 网络配置 > TCP/IP 属性 > 为本地网络添加 IP(x)

SQL 还会在启动时的日志中说明它正在侦听的 IP/端口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T17:12:20.270

[thinkcube 的回答](https://stackoverflow.com/questions/629907/how-to-set-network-adapter-used-by-sql-server-replication/629974#629974)是正确的，除了我想在这里分享的一个细节，以防人们不阅读评论：

> 确保您使用与现有名称不同的服务器名称。

我需要在主机文件中使用**相同的服务器名称。**这是因为发布者需要 Windows 服务器名称，而订阅者则可以使用其他名称。

由于[windows 首先查看 hosts 文件](http://support.microsoft.com/kb/172218)，因此将使用 IP 地址（在专用网络上），但发布者仍会看到正确的名称。

# c# - 变量/类型声明默认为私有

> ID：629910
> 
> 赞同：1
> 
> 时间：2009-03-10T12:29:28.920
> 
> 标签：c#, declaration

有没有办法让变量/方法/类声明的默认访问修饰符公开？

我认为默认情况下，类声明是私有的，是吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-10T12:31:38.650

您无法更改默认值。它们默认为最严格的。

顶级类型的默认可访问性（对于该类型）是`internal`. 嵌套类型的默认可访问性（对于该类型）是`private`. 成员的默认可访问性是私有的。

唯一不是最严格的时候是自动实现属性的显式部分，您可以通过添加修饰符使其*更具*限制性：

```
public int Foo {get;private set;} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T12:34:36.067

一般规则是默认值是您可以指定的最私密的访问级别。唯一的*细微*变化是当您使属性的一部分（通常是 setter）比属性的其余部分更私有时。

能够更改默认值会让维护您的代码的人感到非常困惑。有很多人争辩说你永远不应该使用默认值，总是明确地指定可见性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T12:31:42.097

是的，所有类型成员都是私有的。但是，不，这是无法改变的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T12:36:52.863

您无法更改其他答案正确指示的行为

但是你可以编辑你的类模板文件，这样每次你从你的解决方案资源管理器中添加一个类时，`public`关键字都会作为你新添加的类的前缀。

请参阅[此处](http://www.thecodinghumanist.com/Content/HowToEditVSTemplates.aspx)以编辑 Visual Studio 模板

# c# - 令人费解......为什么我在 ASP.NET MVC 中的大多数链接都附加了 Length=4 ？

> ID：629913
> 
> 赞同：8
> 
> 时间：2009-03-10T12:31:01.193
> 
> 标签：c#, html, asp.net-mvc

为什么下面的代码：

```
<%= Html.ActionLink("[Click Here For More +]", "Work", "Home", new { @class = "more" }) %> 
```

呈现为：

```
<a class="more" href="/Home/Work?Length=4">[Click Here For More +]</a> 
```

“Length=4”是从哪里来的？

更新

如果我删除`new { @class = "more" }`，我不会得到那个 Length=4 参数。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-10T12:49:29.557

我以前也有过这种情况。如果您查看实际使用的过载，它可能不是您想要的。

尝试...

```
<%= Html.ActionLink("[Click Here For More +]", "Work", "Home", null, new { @class = "more" }) %> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T12:47:24.070

我查看了 ActionLink 的重载并将代码更改为：

```
 <%= Html.ActionLink("[Click Here For More +]", "Work", "Home", null, new { @class = "more" }) %> 
```

为路由值添加了“null”。这似乎有效。不确定这可能会产生什么影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T12:39:17.460

您的一条路线中是否有“长度”的默认值？如果选择了错误的路由，请使用 Html.RouteLink 而不是 ActionLink。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T12:39:47.413

看起来像一个 DebuggerVisualizer 属性！但这不应该浮出水面。

无论如何，'Length=4' 看起来很像一个数组（有 4 个元素）。使用调试器寻找罪魁祸首。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T03:52:52.980

length=4 问题已经出现了几次。罪魁祸首通常是一条糟糕的路线，无论是在定义中还是在我使用的链接中。

我已经养成了总是先仔细检查这些的习惯。

# php - 为什么要避免使用 LAMP 托管的 Python 的 CGI？

> ID：629919
> 
> 赞同：23
> 
> 时间：2009-03-10T12:32:06.853
> 
> 标签：php, python, .htaccess, cgi

我已经使用 PHP 多年了。最近我看到很多论坛帖子说**PHP 已经过时**，现代编程语言更容易、更安全等等。

所以，我决定**开始学习 Python**。由于我习惯使用 PHP，因此我刚开始通过上传 .htaccess 文件来构建页面：

```
addtype text/html py
addhandler cgi-script .py 
```

然后，我的示例页面如下所示：

```
#!/usr/bin/python
打印“内容类型：文本/html\n\n”
打印“html标签，更多的东西，等等。”

```

这工作正常。但是，我在一篇文章中看到一条评论说**CGI 不是使用 Python 的最佳方式**。当然，它没有提到什么*是*最好的方法。

**为什么使用 CGI 不是使用 Python 的最佳方式？什么是替代方案？**

有**没有其他方法**可以建立一个简单的 Python 站点？我应该在 .htaccess 和 .py 文件之外查看一些完全不同的范例吗？

### 有关的

*   [Python 中不同 Web 编程方法的优缺点](https://stackoverflow.com/questions/43709/pros-and-cons-of-different-approaches-to-web-programming-in-python)
*   [什么是好的轻量级 Python MVC 框架？](https://stackoverflow.com/questions/68986/whats-a-good-lightweight-python-mvc-framework)（尤其是[@Kevin Dangoor 的回答](https://stackoverflow.com/questions/68986/whats-a-good-lightweight-python-mvc-framework/83263#83263)）
*   [如何在不依赖框架的情况下使用 python 进行 Web 开发？](https://stackoverflow.com/questions/596729/how-do-i-use-python-for-web-development-without-relying-on-a-framework)
*   [Python Web 框架 - 不是 App 框架或 CMS 框架](https://stackoverflow.com/questions/490210/python-web-framework-not-app-framework-or-cms-framework)
*   [Python网络编程](https://stackoverflow.com/questions/581038/python-web-programming)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-10T12:35:50.293

经典 CGI 根本不是使用任何东西的最佳方式。使用经典的 CGI 服务器必须**为每个请求生成一个新进程**。

至于 Python，您几乎没有其他选择：

*   [`mod_wsgi`](http://code.google.com/p/modwsgi/)
*   [`mod_python`](http://modpython.org/)
*   [快速cgi](http://pypi.python.org/pypi/python-fastcgi)
*   独立 Python Web 服务器（[内置](http://docs.python.org/library/simplehttpserver.html)、[CherryPy](http://www.cherrypy.org/)、[Tracd](http://trac.edgewall.org/wiki/TracStandalone)）
*   非标准端口和[`mod_proxy`](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html)Apache 中的独立 Python Web 服务器

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-10T14:27:20.650

> 为什么使用 CGI 不是使用 Python 的最佳方式？

我会稍微支持 CGI。这对开发环境有好处。

连接起来很简单，您不必担心模块重新加载问题。自然性能很糟糕，但对于开发人员来说，你不在乎。

当然，您应该真正写入 WSGI 接口而不是直接写入 CGI。然后，您可以使用以下命令通过 CGI 进行部署：

```
wsgiref.handlers.CGIHandler().run(application) 
```

并使用相同的应用程序对象通过 mod_wsgi 部署在速度很重要的生产环境中您喜欢的其他任何其他 WSGI 服务器（以及您希望它尽可能接近生产的测试环境）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-10T12:35:41.540

[**mod_wsgi**](http://code.djangoproject.com/wiki/django_apache_and_mod_wsgi)是正确的选择。它几乎在所有方面都优于 CGI。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T12:38:39.117

真的，这只是一个效率问题——CGI 为每个请求生成一个全新的进程，这对于它的作用来说是相当重量级的。

PHP 也可以通过 CGI 运行，但 mod_php 将解释器嵌入到 apache 中。正如 Yuval 所说，有一个[mod_python和](http://www.modpython.org/)[mod_wsgi](http://code.google.com/p/modwsgi/)可以完成同样的工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T12:42:36.703

除了其他人提出的建议之外，您应该真正考虑使用某种框架。您可以并且应该使用[FastCGI](http://www.fastcgi.com/)、 mod_python 或 mod_wsgi，但它们并不是真正打算让您直接编写代码。我可以建议以下之一吗？

*   [django](http://www.djangoproject.com)（我最喜欢的实际应用程序）
*   [塔架](http://pylonshq.com/)
*   [cherrypy](http://www.cherrypy.org/) （我最喜欢的不太实用的应用程序）
*   [网页.py](http://webpy.org/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T12:52:07.290

Python 文档中有一个页面描述[了各种可能性的优缺点](http://docs.python.org/howto/webservers.html)。

**mod_python**

> (...) 这些就是为什么在编写新程序时应该避免使用 mod_python 的原因。

**WSGI**

> *Web 服务器网关接口*或简称 WSGI 是目前 Python Web 编程的最佳方式。虽然它对编写框架的程序员来说很棒，但普通人不需要直接接触它。

**FastCGI 和其他东西**

> 如今，FastCGI 从未直接使用过。

# ado.net - ado.net 类型数据集行的有效更新

> ID：629921
> 
> 赞同：1
> 
> 时间：2009-03-10T12:32:58.287
> 
> 标签：ado.net, strongly-typed-dataset

Ado.net 是否检查是否需要以下更新？

例如，具有 TOWN 列的 ADDRESS 表。

检索 TOWN 值为“Leeds”的 ADDRESS 行

在更新代码 ADDRESS.TOWN 设置为 "Leeds" ，即它实际上没有改变。

我们调用了 Set 方法或赋值，因此 RowState 被更改为已修改。

适配器是否将非更改传递给数据库，或者框架是否足够聪明以计算出它不需要？

如果是这样，这会影响数据库事务日志吗？

我是不是太担心了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T14:05:15.737

当我对此进行测试时，它**确实**调用了数据库的更新。

重申一下，我加载了一个类型化的 DataTable 并检索了一个类型化的 DataRow，将一个属性设置为相同的值，然后在类型化的 DataRow 上调用类型化的 TableAdapter 的 Update 方法。我在 SQL Server Profiler 中看到正在发送更新，即使它在逻辑上不需要。

# asp.net - 什么是完整的 ASP.net 开发环境？

> ID：629923
> 
> 赞同：5
> 
> 时间：2009-03-10T12:33:15.120
> 
> 标签：asp.net

我假设今天 ASP.net Web 开发的基本设置是：

1.  Windows Vista（或 XP）
2.  视觉工作室 2008
3.  SQL 服务器 2005
4.  IIS 7
5.  .net 框架 v3.5

那么，您总是安装哪些工具、插件、库等组合来提高您的生产力并支持您的开发？

对我来说，它总是：

*   [Ubuntu LAMP 服务器](http://www.ubuntu.com/)
*   [颠覆](http://subversion.tigris.org/)
*   [TRAC](http://trac.edgewall.org/)
*   [asp.net AJAX 工具包](http://www.asp.net/Ajax/ajaxcontroltoolkit/)
*   [jQuery](http://jquery.com/)
*   [JQuery 智能感知](http://weblogs.asp.net/bleroy/archive/2009/02/06/vsdoc-for-jquery-1-3-1-now-available.aspx)
*   [免费文本框](http://freetextbox.com/)
*   [萤火虫](http://getfirebug.com/)
*   [TortoiseSVN](http://tortoisesvn.tigris.org/)
*   [记事本++](http://notepad-plus.sourceforge.net/uk/site.htm)
*   [赛格温](http://www.cygwin.com/)

我很想知道您今天的“完整”开发环境是什么样的。

编辑 - 添加了一些我忘记的工具，并使其成为社区 wiki。感谢所有的答案！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-10T12:39:20.080

基本款，加

*   [TortoiseSVN](http://tortoisesvn.tigris.org/)
*   [AnkhSVN](http://ankhsvn.open.collab.net/)
*   [电源命令](http://code.msdn.microsoft.com/PowerCommands)
*   [jQuery](http://jquery.com/)
*   一些各种 JQuery 插件
*   [FCK 编辑](http://www.fckeditor.net/)器
*   AJAX 工具包
*   MySQL 我也有 SQL Sever 2005
*   [WinMerge](http://winmerge.org/)
*   [油漆.NET](http://www.getpaint.net/)
*   [记事本2](http://www.flos-freeware.ch/notepad2.html)
*   [小精灵](http://www.nattyware.com/pixie.php)
*   [星形 UML](http://staruml.sourceforge.net/en/)
*   [片段设计器](http://www.codeplex.com/SnippetDesigner)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T12:55:44.677

基本优点：

*   锐器
*   颠覆
*   AJAX 工具包
*   FCK编辑器
*   反射器
*   重新运动（[重新运动](http://www.re-motion.org/)）
*   测试驱动的.Net
*   HTTPWatch
*   点网跟踪
*   [健身](http://fitnesse.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T13:13:20.967

唔。与上面类似

专业：

*   XP / Windows Server 2003 (IIS 6)
*   VS2008 标准
*   SQL 服务器 2005
*   单元
*   jQuery
*   TinyMCE
*   视觉源安全（eeek!!）
*   SQL 效果清晰
*   幽灵医生
*   提琴手
*   [超越比较](http://www.scootersoftware.com/)（最好的）

亲自：

*   维斯塔/Ubuntu
*   mysql 5
*   VS2008 / 单声道开发
*   颠覆

我怎么会忘记，.NET 反射器

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-30T14:02:53.647

*   Windows Vista（请让Win7像人们说的那样好）
*   IIS 7
*   .Net 3.5
*   对比 2008
*   源齿轮
*   CruiseControl（刚刚安装并喜欢它）
*   Resharper（不能没有）
*   StyleCop（刚开始用，很痛苦，但最终会得到回报）
*   FxCop（见 StyleCop 评论）
*   Firebug（起初被抵制......不知道为什么）
*   Telerik Ajax Suite（价格昂贵且臃肿......但看起来很漂亮）
*   Notepad++（快速无痛）
*   免费 SMTP 服务器（Vista 上没有 SMTP 服务器）
*   Nunit（喜欢它......希望我是一位大师并且会越来越多地使用）
*   Reflector（“那么……聪明人是怎么做到的……”）
*   CAT.NET（远离恶人）
*   利他林（“感谢制造者”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T12:39:25.730

Windows XP Visual Studio 2005 和 2008 SQL 服务器 2005 IIS 6 .NET Framework 3.5

*   ASP.NET AJAX 工具包
*   [ComponentArt WebUI 组件](http://www.componentart.com)
*   [基本日期选择器](http://www.basicdatepicker.com)
*   [锐化器](http://jetbrains.com/resharper)
*   RedGate Software 的[SQL 工具带](http://www.red-gate.com)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T13:25:52.123

基础加：

*   [WinMerge](http://winmerge.org/)
*   [CodeSmith Pro](http://www.codesmithtools.com/)（主要用于[NetTiers 模板](http://nettiers.com/)）
*   一些[Red Gate](http://www.red-gate.com/)工具（SQL Compare v.useful）
*   .NET Reflector（现在也来自 RedGate）
*   [颠覆](http://subversion.tigris.org/)/ [TortoiseSVN](http://tortoisesvn.net/)
*   Firefox 的[Web 开发者插件](https://addons.mozilla.org/en-US/firefox/addon/60)
*   [提琴手](http://www.fiddlertool.com/fiddler/)

＆WinAmp :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T13:43:24.250

这是我的基本设置：

*   视窗 XP 专业版 SP3
*   IIS 5.1
*   .Net 2.0、3.0 和 3.5
*   对比 2008
*   Subversion（新代码），Viusal SourceSafe（旧代码）
*   巡航控制
*   锐器
*   蚂蚁

流程概述点

*   敏捷
*   Scrum
*   经验值
*   TDD

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-30T14:20:02.793

添加到您的基础知识

*   NUnit 框架
*   温莎城堡（控制反转容器）
*   NHibernate ORM 与 Fluent NHibernate
*   Resharper TestDriven.net NBehave（用于 BDD 风格的单元测试）
*   颠覆
*   Tortoise SVN（用于颠覆的 windows 集成）
*   Visual SVN（用于 VS 集成，用于 subversion 和 subversion 服务器管理）
*   城堡验证器
*   萤火虫
*   Team City（用于持续集成）
*   Rhino Mocks（用于模拟和存根）
*   JQuery 和各种插件
*   Rake 用于自动构建新项目和 NANT 用于遗留项目
*   红门 SQL Compaire 和 SQL Data Compaire（移动数据库必不可少）
*   Auto Mapper（将域模型转换为数据传输对象）
*   用于记录的 Log4Net

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-15T06:12:01.923

基本的，加上：

*   超级预览
*   用于 linq to sql 的 LinqPad
*   DbDeploy（数据库版本控制）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-15T06:19:35.013

平台

*   视窗服务器 2008 x64
*   IIS 7
*   网络平台安装程序
*   PHP
*   .NET 2.0、3.0、3.5 SP1
*   IE8（JS 控制台很棒！）+ Firefox（FireBug）
*   SQL Server 2008

开发

*   视觉工作室 2008 SP1
*   锐化器 4
*   TFS 和/或 SourceGear Vault
*   记事本++
*   .NET 反射器
*   ASP.NET AJAX 控件工具包
*   jQuery（没有它就活不下去）

共享点

*   MOSS 2007（企业版）（SP2）
*   共享设计器 2007
*   Stramit CAML 查看器
*   U2U CAMLBuilder
*   VSeWSS 1.3
*   WSPBuilder
*   Telerik RadEditor 用于 SharePoint
*   jQuery（没有它就活不下去）

# oop - 最佳实践：是否在子构造函数中将子节点添加到父节点？

> ID：629926
> 
> 赞同：7
> 
> 时间：2009-03-10T12:34:38.360
> 
> 标签：oop

我正在使用一些代码，在子构造函数中将子节点添加到它的父节点。代码看起来像这样：

班级：

```
class Node1 {
  public Node1(Node1 parent, String name) {
     if(parent != null) {
       parent.add(this);
     }
     this.parent = parent;
  }

  private void add(Node1 child) {
    children.add(child);
  }
} 
```

用法：

```
Node1 parent = new Node1(null, "parent");
Node1 child1 = new Node1(parent, "child1");
Node1 child2 = new Node1(parent, "child2"); 
```

通过以这种方式实现它，类的用户`Node1`不必显式地将子节点（更少的代码）添加到它的父节点，并且您保证了子节点有一个父节点。

我个人不会这样写，但更像如下：

```
class Node2 {
  public Node2(String name) {
  }

  public void add(Node2 child) {
    children.add(child);
    child.setParent(this);
  }
}

Node2 parent = new Node2("parent");
Node2 child1 = new Node2("child1");
parent.add(child1);
Node2 child2 = new Node2("child2");
parent.add(child2); 
```

所以我的问题是，按照 Class 中所示的方式实现它是一个好主意，`Node1`还是有任何反对意见？或者没有争论为什么一个比另一个更好？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-10T12:40:22.997

我个人不喜欢第一个示例，因为您要添加一个尚未“准备好”的节点（因为构造函数尚未完成执行）。在大多数情况下它可以正常工作，但在极端情况下，您可能会遇到很难找到的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T12:43:26.483

我将使用第二种情况，因为以后我将能够添加子项，但不仅仅是在构造函数中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T12:39:34.590

我认为这两种实现都可以。

问题更多的是你将如何使用这个类：你是先创建一个节点列表，然后开始添加它们的关系，还是像在你的示例中那样以有序的方式进行？

第二种解决方案提供了更大的灵活性，而且如果您想将 Node1 用作超类，则不必绑定到构造函数签名。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T12:52:21.830

我不喜欢第一种情况——父对象只是被传入就被神奇地修改了——你必须阅读代码或文档才能意识到这种情况正在发生。仅传入父级仅意味着子级知道父级 - 而不是将子级也添加到父级的内部列表中。

第二个例子更好。您还可以从“添加”操作中返回子项以允许操作链接，例如：

```
Node2 child = parent.add(new Node2()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T12:52:58.440

为了方便起见，我认为没有理由不将这两种方法结合起来：

```
class Node1 {
  public Node1(String name, Node1 parent = null) {
    this.name = name;
    // etc., do initialization

    if(parent != null)
      parent.add(this);
  }

  private void add(Node1 child) {
    child.setParent(this);
    children.add(child);
  }
} 
```

请注意， setParent() 应该在子级已经拥有其父级集时抛出异常，或者从前父级的子级列表中正确删除自己。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T12:44:52.500

如果您从 TreeNode 类派生 Node ，那么您将自动获得您的第二个实现。您可以将“自定义”树节点添加到常规 Treeview 类。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T13:10:44.467

首先，您的第一个示例中的坏处是： **if(parent != null) {** 需要进行此检查，因为您应该有机会创建树的根，但是两态参数看起来很难看。

另外，首先您的样本不好，因为执行隐式操作（将子添加到传递的父级）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-10T13:48:53.707

只有当父节点和子节点绝对必要时，我才更喜欢实现#1。在这种情况下，客户端代码很可能会省略对 Node1.add(Node1 child) 的调用，从而导致稍后出错。

否则我更喜欢实现#2，因为这样的用法更清楚

```
Node1 parent = new Node1();
Node1 child = new Node1();
parent.add(child); 
```

# c# - WPF 和 Silverlight 应用程序有什么区别？

> ID：629927
> 
> 赞同：26
> 
> 时间：2009-03-10T12:35:03.010
> 
> 标签：c#, wpf, silverlight

WPF 和 Silverlight 应用程序有什么区别？他们是一样的吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-10T12:38:55.013

WPF 基于桌面 CLR，它是 CLR 的*完整*版本。

Silverlight 基于一个更小、更紧凑的 CLR，它提供了出色的体验，但没有完整的 CLR 功能。它还有一个小得多的 BCL 版本。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-10T12:37:00.430

WPF 本质上是 Winforms 的替代品，因为它是一个基于 .Net (3+) 平台的桌面应用程序平台。

Silverlight 表示通过浏览器插件交付的 WPF 子集，与 Flash/Flex 非常相似。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T12:39:21.377

Silverlight 是 WPF 的子集。曾经它被称为 WPF/E（WPF 无处不在）。事实上，基本框架是相似的，但并不相同。

有关详细信息，请参阅：[Silverlight“WPF/E”第一步：简单模拟时钟入门，简介 - 什么是 WPF/E？](http://dotnetslackers.com/articles/silverlight/SilverlightFirstStepsAnalogClock.aspx)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-10-15T08:32:15.623

Silverlight 是 Microsoft 用于构建下一代 Web 客户端应用程序 (WPF) 的最新开发平台，是 Microsoft 用于构建下一代 Windows 客户端应用程序的最新开发平台

Silverlight 一般被认为是 WPF 的子集，是 XAML WPF 一般被认为是 .NET Framework 的子集

Silverlight 支持 Windows 客户端用户的跨操作系统、跨浏览器、跨设备 WPF。

为了在客户端机器上运行 Silverlight 应用程序，我们需要在客户端机器上安装一次 WPF 的 Silverlight 软件，另一方面，不支持任何插件机制；相反，我们需要安装一个完整的 WPF 客户端应用程序

Silverlight 应用程序托管在网络服务器和网页中。WPF 应用程序可以部署为独立的应用程序，

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T12:38:12.627

> Silverlight（代号 WPF/E）是一个跨平台、跨浏览器的浏览器插件，其中包含基于 WPF 的技术（包括 XAML）[17]，可为包括 Windows 在内的多个操作系统提供视频、矢量图形和动画等功能Vista、Windows XP 和 Mac OS X，以及 Microsoft 认可的用于 Linux 发行版的第 3 方开发人员的工作端口。[18] 具体来说，它目前作为 Mozilla Firefox、Internet Explorer 6 及更高版本和 Apple Safari 的附加组件提供。Silverlight 和 WPF 仅共享 XAML 表示层。

[维基](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-07T23:51:02.693

Silverlight 是 WPF 的一个子集，因此功能较少，但更便携。WPF 既可以在浏览器中运行，也可以作为 Windows 中的 WinForms 样式应用程序运行，而 Silverlight 只能在浏览器中运行。WPF 旨在在 Windows 系统上运行，而 Silverlight 在 Windows 或 Mac 上运行，也可以通过 Moonlight 在 Linux 上运行。

如果对何时使用每个人感到困惑，我发现一个有用的博客可以更好地解释这一点：http: [//blogs.msdn.com/b/jennifer/archive/2008/05/06/when-should-i-use-wpf-vs -silverlight.aspx](http://blogs.msdn.com/b/jennifer/archive/2008/05/06/when-should-i-use-wpf-vs-silverlight.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-05T22:41:43.873

A detailed comparison can be found here: [http://wpfslguidance.codeplex.com/](http://wpfslguidance.codeplex.com/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-02T04:43:02.820

wpf 是窗口应用程序，Silverlight 是 Web 应用程序

# windows - IT 问题：两个具有相同网关指标的 NIC

> ID：629931
> 
> 赞同：0
> 
> 时间：2009-03-10T12:36:25.703
> 
> 标签：windows, networking, windows-vista

带有 SP1 的 Windows Vista 商业版

我的 Vista Business SP1 机器上有两个 NIC - 一个 NIC 连接到我们的公司网络，另一个 NIC 连接到专用网络。两个网络都使用 DHCP，专用网络从 LinkSys WRT54G 获取它的地址（不用作路由器 - 只是一个带 DHCP 的交换机）。

我遇到的问题是两个网络最终在路由表中都有一个具有相同度量的 0.0.0.0 条目。因此，无论何时我尝试访问互联网（应该始终通过公司网络），我都有 50-50 的机会真正成功。

我怎样才能防止这种情况发生？

谢谢....

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:44:15.297

我认为您最简单的解决方案是在您的专用网络上为您的 NIC 分配一个静态 IP。分配静态 IP 时，不要指定网关地址。

我可能是错的，但我不认为 WRT54G 可以修改为不通过 DHCP 提供网关。

# sql-server - MS-SQL：将一种列类型的所有实例转换为另一种？

> ID：629941
> 
> 赞同：0
> 
> 时间：2009-03-10T12:38:40.800
> 
> 标签：sql-server, database, tsql

我有一个 SQL Server 2008 数据库，其中包含大约 40 个表。它们中的大多数至少包含几`varchar`列，我想将其中的每一列转换为`nvarchar`（相同长度）。还想将一些`text`字段转换为`nvarchar(MAX)`. 有没有一种简单直接的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:49:57.327

这似乎与以下问题非常相似：

[用于将数据库列从 varchar 更新为 nvarchar 的 SQL Server 脚本...](https://stackoverflow.com/questions/179987/sql-server-script-to-update-database-columns-from-varchar-to-nvarchar-if-not-al)

希望这可以帮助！

# sql - 执行查询时出现“IN”问题

> ID：629946
> 
> 赞同：0
> 
> 时间：2009-03-10T12:39:21.720
> 
> 标签：sql, mysql

我正在尝试根据员工的代码和部门搜索员工。

我使用具有 1200 个员工代码的 IN 运算符触发了一个查询。当我执行查询时，出现异常（“IN 中允许最多 1000 条记录”）。

谁能帮我解决这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-10T12:45:00.957

将这些记录上传到临时表并使用连接几乎肯定会快得多。事实上，解析器必须为 IN 构建一个巨大的条件树。

注意：我不知道 MYSQL 是否支持 Oracle 或 SQLServer 的事务级临时表，但即使是“真实”表也应该更快，特别是如果创建一次并重用。当然，还有许多变量，例如批量插入该表的能力、写入事务日志的成本等。

重读您的问题：您从哪里获得这些员工代码？你可以从表中获取它们或加入吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:46:38.630

许多 DBMS 不允许像这样的查询

```
SELECT * FROM table WHERE col IN (...) 
```

列表中有超过 1,000 个值。也许可以使用少于 1,000 个值的块将其拆分：

```
SELECT * FROM table WHERE col IN (...) OR col IN (...) 
```

或者

```
SELECT * FROM table WHERE col IN (...)
UNION
SELECT * FROM table WHERE col IN (...) 
```

（尽管它没有意义并且不太可能起作用）。

否则，您应该将值存储在临时表中并改用 JOIN。您从哪里获得 1,200 个代码——它们碰巧不在同一个数据库中？:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T12:46:25.493

创建一个（临时）表，其中将包含您的员工代码，填写它，然后像这样查询：

```
SELECT *
FROM mytable
WHERE empcode IN (SELECT mycode FROM temptable) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T13:28:47.623

创建一个内存临时表（仅限小型表），填充存储过程结果。对临时表执行带有连接的选择。删除临时表。

```
CREATE TEMPORARY TABLE ENGINE=MEMORY tmp AS 
  SELECT code FROM employee; // in-memory temporary table (small tables)

SELECT col1, col2 FROM table 
    INNER JOIN tmp ON table.code = tmp.code; // join faster than subquery

DROP TEMPORARY TABLE tmp; // cleanup temporary table 
```

# c# - “参数无效”异常加载 System.Drawing.Image

> ID：629955
> 
> 赞同：36
> 
> 时间：2009-03-10T12:40:46.333
> 
> 标签：c#, image, stream, argumentexception

为什么我的代码中出现“参数无效”异常：

```
MemoryStream ms = new MemoryStream(byteArrayIn);
System.Drawing.Image returnImage = System.Drawing.Image.FromStream(ms); 
```

的长度`byteArrayIn`是 169014。尽管其中没有任何值大于 255，但我得到了这个异常。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-08-20T03:33:15.590

我遇到了同样的问题，显然现在已经解决了，尽管这个和其他一些 gdi+ 异常非常具有误导性，但我发现实际上问题是发送到 Bitmap 构造函数的参数无效。我有这个代码：

```
using (System.IO.FileStream fs = new System.IO.FileStream(inputImage, System.IO.FileMode.Open, System.IO.FileAccess.ReadWrite))
{
    try
    {
        using (Bitmap bitmap = (Bitmap)Image.FromStream(fs, true, false))
        {
            try
            {
                bitmap.Save(OutputImage + ".bmp", System.Drawing.Imaging.ImageFormat.Bmp);
                GC.Collect();
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
    }
    catch (ArgumentException aex)
    {
        throw new Exception("The file received from the Map Server is not a valid jpeg image", aex);
    }
} 
```

以下行导致错误：

```
Bitmap bitmap = (Bitmap)Image.FromStream(fs, true, false) 
```

文件流是根据从地图服务器下载的文件构建的。我的应用程序错误地发送了获取图像的请求，并且服务器返回了带有 jpg 扩展名的内容，但实际上是一个 html，告诉我发生了错误。所以我正在拍摄这张图片并尝试用它构建一个位图。修复是为了控制/验证有效 jpeg 图像的图像。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-10T12:48:18.827

我的猜测是`byteArrayIn`不包含有效的图像数据。

请提供更多信息：

*   哪一行代码抛出异常？
*   消息是什么？
*   你从哪里得到`byteArrayIn`的，你确定它应该包含一个有效的图像吗？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-01-14T20:48:13.513

```
byte[] fileData = null;
using (var binaryReader = new BinaryReader(Request.Files[0].InputStream))
{
    fileData = binaryReader.ReadBytes(Request.Files[0].ContentLength);
}
ImageConverter imageConverter = new System.Drawing.ImageConverter();
System.Drawing.Image image = imageConverter.ConvertFrom(fileData) as System.Drawing.Image;
image.Save(imageFullPath, System.Drawing.Imaging.ImageFormat.Jpeg); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-09T23:28:44.433

抛出的“参数无效”异常`Image.FromStream()`告诉您流不是“有效”或“公认”格式。观察内存流，尤其是当您从文件中获取各种字节偏移量时。

```
// 1\. Create a junk memory stream, pass it to Image.FromStream and 
// get the "parameter is not valid":
MemoryStream ms = new MemoryStream(new Byte[] {0x00, 0x01, 0x02});
System.Drawing.Image returnImage = System.Drawing.Image.FromStream(ms);`

// 2\. Create a junk memory stream, pass it to Image.FromStream
// without verification:
MemoryStream ms = new MemoryStream(new Byte[] {0x00, 0x01, 0x02});
System.Drawing.Image returnImage = System.Drawing.Image.FromStream(ms, false, true); 
```

示例 2 将起作用，请注意 useEmbeddedColorManagement 必须为 false 才能使 validateImageData 有效。

通过将内存流转储到文件并检查内容可能是最容易调试的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-10T12:43:33.143

哪一行抛出异常？`new MemoryStream(...)`? _ 还是`Image.FromStream(...)`？什么是`byteArrayIn`？是`byte[]`吗？我之所以问，是因为“而且其中没有任何价值不大于 255”的评论——这对于`byte[]`.

作为一个更明显的问题：二进制文件实际上是否包含合理格式的图像？

例如，以下（虽然不是很好的代码）可以正常工作：

```
 byte[] data = File.ReadAllBytes(@"d:\extn.png"); // not a good idea...
    MemoryStream ms = new MemoryStream(data);
    Image img = Image.FromStream(ms);
    Console.WriteLine(img.Width);
    Console.WriteLine(img.Height); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-05T07:57:47.213

此错误是由二进制数据插入缓冲区引起的。要解决此问题，您应该在代码中插入一条语句。

这个声明是：

```
obj_FileStream.Read(Img, 0, Convert.ToInt32(obj_FileStream.Length)); 
```

例子：

```
FileStream obj_FileStream = new FileStream(str_ImagePath, FileMode.OpenOrCreate, FileAccess.Read);
Byte[] Img = new Byte[obj_FileStream.Length];
obj_FileStream.Read(Img, 0, Convert.ToInt32(obj_FileStream.Length));         
dt_NewsFeedByRow.Rows[0][6] = Img; 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2012-05-08T09:39:44.890

给出的所有解决方案都不起作用..不要只专注于检索部分。luk 在图像的插入。我犯了同样的错误。我从硬盘中提取图像并将其保存到数据库中。问题在于插入命令。看看我的错误代码..：

```
 public bool convertImage()
    {
        try
        {
            MemoryStream ms = new MemoryStream();
            pictureBox1.Image.Save(ms, ImageFormat.Jpeg);
            photo = new byte[ms.Length];
            ms.Position = 0;
            ms.Read(photo, 0, photo.Length);
            return true;
        }
        catch
        {
            MessageBox.Show("image can not be converted");
            return false;
        }
    }
    public void insertImage()
    {
       // SqlConnection con = new SqlConnection();
        try
        {
            cs.Close();
            cs.Open();
            da.UpdateCommand = new SqlCommand("UPDATE All_students SET disco = " +photo+" WHERE Reg_no = '" + Convert.ToString(textBox1.Text)+ "'", cs);
            da.UpdateCommand.ExecuteNonQuery();
            cs.Close();
            cs.Open();
            int i = da.UpdateCommand.ExecuteNonQuery();
            if (i > 0)
            {
                MessageBox.Show("Successfully Inserted...");
            }

        }
        catch
        {
            MessageBox.Show("Error in Connection");
        }
        cs.Close();
    } 
```

上面的代码显示成功插入......但实际上它以错误数据类型的形式保存图像......而数据类型必须bt“图像”......所以我改进了代码......

```
 public bool convertImage()
    {
        try
        {
            MemoryStream ms = new MemoryStream();
            pictureBox1.Image.Save(ms, ImageFormat.Jpeg);
            photo = new byte[ms.Length];
            ms.Position = 0;
            ms.Read(photo, 0, photo.Length);
            return true;
        }
        catch
        {
            MessageBox.Show("image can not be converted");
            return false;
        }
    }
    public void insertImage()
    {
       // SqlConnection con = new SqlConnection();
        try
        {
            cs.Close();
            cs.Open();
            //THIS WHERE THE CODE MUST BE CHANGED>>>>>>>>>>>>>>

            da.UpdateCommand = new SqlCommand("UPDATE All_students SET disco = @img WHERE Reg_no = '" + Convert.ToString(textBox1.Text)+ "'", cs);
            da.UpdateCommand.Parameters.Add("@img", SqlDbType.Image);//CHANGED TO IMAGE DATATYPE...
            da.UpdateCommand.Parameters["@img"].Value = photo;
            da.UpdateCommand.ExecuteNonQuery();
            cs.Close();
            cs.Open();
            int i = da.UpdateCommand.ExecuteNonQuery();
            if (i > 0)
            {
                MessageBox.Show("Successfully Inserted...");
            }

        }
        catch
        {
            MessageBox.Show("Error in Connection");
        }
        cs.Close();
    } 
```

100% 保证在检索过程中不会出现 PARAMETER NOT VALID 错误......已解决！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！ ！！！！！！

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2013-02-06T20:52:04.133

Most of the time when this happens it is bad data in the SQL column. This is the proper way to insert into an image column:

```
INSERT INTO [TableX] (ImgColumn) VALUES (
(SELECT * FROM OPENROWSET(BULK N'C:\....\Picture 010.png', SINGLE_BLOB) as tempimg)) 
```

Most people do it incorrectly this way:

```
INSERT INTO [TableX] (ImgColumn) VALUES ('C:\....\Picture 010.png')) 
```

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2017-06-25T21:55:29.057

只需按照此将值插入数据库

//连接字符串

```
 con.Open();

sqlQuery = "INSERT INTO [dbo].[Client] ([Client_ID],[Client_Name],[Phone],[Address],[Image]) VALUES('" + txtClientID.Text + "','" + txtClientName.Text + "','" + txtPhoneno.Text + "','" + txtaddress.Text + "',@image)";

                cmd = new SqlCommand(sqlQuery, con);
                cmd.Parameters.Add("@image", SqlDbType.Image);
                cmd.Parameters["@image"].Value = img;
            //img is a byte object
           ** /*MemoryStream ms = new MemoryStream();
            pictureBox1.Image.Save(ms,pictureBox1.Image.RawFormat);
            byte[] img = ms.ToArray();*/**

                cmd.ExecuteNonQuery();
                con.Close(); 
```

# asp.net - JavaScript 触发 - vb.net api 调用的反映？

> ID：629956
> 
> 赞同：0
> 
> 时间：2009-03-10T12:41:52.103
> 
> 标签：asp.net, javascript, reflection, system.reflection

您可以使用 javascript 代码的反射调用 vb.net api 函数吗？

我刚开始玩反射，我有这段代码可以工作，我想把它改成一个 javascript 页面。

```
Dim RawPlugin As Reflection.Assembly
RawPlugin = Reflection.Assembly.LoadFrom("C:\Inetpub\wwwroot\demo\MasterApplication\getSession\bin\Debug\getSession.dll")

Dim Instance As Object
Instance = RawPlugin.CreateInstance("getSession.class1", True, _
   Reflection.BindingFlags.Default, Nothing, Nothing, Nothing, Nothing)

theValue = Instance.getSessionValue(Session).ToString 
```

有谁知道这是否可能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T12:59:00.860

客户端代码不直接与服务器端代码对话。如果您要查找的信息在用户的页面请求之间不受影响，那么您有两个选择：将服务器端值与页面请求一起输出到客户端（因此它的值在页面上的 JavaScript 变量内），或者让它成为一个ajax调用。如果信息可能在页面请求之间过时，那么您唯一的选择是从 ajax 调用返回值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T13:16:44.407

在 ASP.Net 中，.Net 代码在您的 Web 服务器上运行。Javascript 在用户计算机上的浏览器中运行。该用户甚至可能没有*Windows*，更不用说 .Net 运行时了。

就此而言，您的用户甚至可能没有启用 javascript。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T12:57:04.297

不，您不能直接从javascript使用反射或任何.Net。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-10T13:37:45.683

解决方案：

你可以使用ajax创建回调，调用一个aspx页面，在页面加载时运行后面的代码，然后在.net中创建反射，然后将最终结果传回javascript端，这行得通，我知道确实...但是这意味着在项目内部您需要有回调页面（如果有任何更改需要编译）。

我想我需要做的是[使用 JavaScript ajax 调用执行反射的回调页面]

# sql-server - 基于任意数据源的报告（列的数量和名称可能会发生变化）

> ID：629957
> 
> 赞同：0
> 
> 时间：2009-03-10T12:41:59.310
> 
> 标签：sql-server, visual-studio, reporting

我需要从给定数据库中导出任意表的所有列的数据（包括外键的 GUID 等技术）。我想按照[这里的建议使用](https://stackoverflow.com/questions/138203/how-to-generate-a-pdf-from-an-embedded-report-definition-without-server-or-ui)[LocalReport](http://msdn.microsoft.com/en-us/library/microsoft.reporting.winforms.localreport.aspx)类，但我想不出如何为任意数据源设置报告（甚至列的数量和名称可能会改变）。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T23:31:40.810

报告生成器（sql adhoc 报告）之类的东西是否适合您的需求？

似乎您需要一份报告才能处理任何数据库中的任何表。这些东西在 sql 报告中似乎是“硬编码”的。

如果你要让它工作，我希望它是通过使用代码来生成报告定义，我不知道该怎么做。

# c++ - 如何在执行 ./configure 时设置 ccshared=-fPIC？

> ID：629961
> 
> 赞同：23
> 
> 时间：2009-03-10T12:42:42.460
> 
> 标签：c++, makefile, g++

我正在尝试在[RHEL 5 上为](http://en.wikipedia.org/wiki/Red_Hat_Enterprise_Linux)[QGIS](http://en.wikipedia.org/wiki/Quantum_GIS)构建 Python 2.6 。在制作 QGIS 期间，我收到以下错误：

```
Linking CXX shared library libqgispython.so
/usr/bin/ld: /usr/local/lib/python2.6/config/libpython2.6.a(abstract.o): relocation R_X86_64_32 against `a local symbol' can not be used when making a shared object; recompile with -fPIC
/usr/local/lib/python2.6/config/libpython2.6.a: could not read symbols: Bad value
collect2: ld returned 1 exit status
make[2]: *** [src/python/libqgispython.so.1.0] Error 1
make[1]: *** [src/python/CMakeFiles/qgispython.dir/all] Error 2
make: *** [all] Error 2 
```

我从这个错误中得出的结论是我需要使用一些标志构建 Python 2.6 `-fPIC`，. 好的，所以我在`configure.in`文件中找到了它，但它检查了几个条件，并根据这些条件分配`-fPIC`给`CCSHARED`标志。

我所做的是，在检查了所有条件后，我添加了以下行以故意使用`CCSHARED`as `-fPIC`。

```
CCSHARED="-fPIC"; 
```

但它没有工作..

配置时如何指定我要设置`CCSHARED`为`-fPIC`？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-11T22:59:18.867

运行配置`--enable-shared`。然后`-fPIC`将作为共享标志的一部分包含在内。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2016-12-19T20:50:47.590

当我遇到此错误时，以下内容对我有用：

```
make clean
./configure CFLAGS=-fPIC CXXFLAGS=-fPIC 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-12T01:17:55.803

我通过在 Makefile 中添加after`-fPIC`来实现它。`CC= gcc -pthread``CC= gcc -pthread -fPIC`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-10T12:45:57.023

1.  运行`./configure --help`，可能通过管道连接到 grep PIC，以查看是否有启用此选项的选项
2.  在运行配置之前尝试设置环境变量，例如 CCSHARED="-fPIC" ./configure （作为单个命令，假设 bash）

如果这些都不起作用，您需要阅读配置代码并更好地了解它测试的条件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-22T07:47:22.633

如其他地方所述，使用 --enable-shared 运行配置应该导致 -fPIC 包含在编译器标志中。但是，如果您尝试使用例如“make -j8”进行并行构建，您可能仍然会看到“无法读取符号”错误。我在 RHEL 5.2 上遇到了同样的错误，只有当我从 make 调用中删除“-j8”时它才消失......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T12:44:50.583

不是`CCFLAGS`吗？（已经有一段时间没有来到世界的那一边了。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-19T06:08:17.060

使用 ./config --prefix=/software/bea/openssl/100c --openssldir=/software/bea/openssl/100c/ssl shared -fPIC 重建 openssl

然后它也有用。它给了 /usr/bin/ld: 链接失败。我们之前修改了make文件中的链接部分，它是gcc -Wall -shared -o pwutil.so asciihex.o base64.o bitutils.o dict.o gen_rand.o key_schedule.o md5c.o pdg2_ecb.o pwutils.o random_data .o hexutils.o des3crypt.o blowcrypt.o /software/bea/openssl/1.0.0c/lib/libcrypto.a

在使用共享选项和 fPIC 重建后，我们将 libcrypto.a 更改为 libcrypto.so

gcc -Wall -shared -o pwutil.so asciihex.o base64.o bitutils.o dict.o gen_rand.o key_schedule.o md5c.o pdg2_ecb.o pwutils.o random_data.o hexutils.o des3crypt.o blowcrypt.o /软件/bea/openssl/1.0.0c/lib/libcrypto.so

它奏效了

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-31T21:18:47.603

下面有一个通过fPIC来配置的[例子](https://github.com/devopscenter/docker-stack/blob/master/python/Dockerfile#L29)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-02-10T03:41:40.863

我得到了它的工作：

```
./configure --enable-shared --enable-pic 
```

# sql - 如何删除 SQL Server 中的重复数据？

> ID：629973
> 
> 赞同：0
> 
> 时间：2009-03-10T12:45:27.570
> 
> 标签：sql, sql-server

我有 sql 表，但是，一些值增加了不止一次，我需要删除其中一个。你能给我一个简单的查询吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-10T12:49:04.817

从[这里](http://blog.sqlauthority.com/2007/03/01/sql-server-delete-duplicate-records-rows/)。如果您还没有唯一标识每一行的“ID”字段，则需要创建一个以使其正常工作（您始终可以在完成后删除该列）：

```
DELETE
FROM MyTable
WHERE ID NOT IN
(
SELECT MAX(ID)
FROM MyTable
GROUP BY DuplicateColumn1, DuplicateColumn2, DuplicateColumn2) 
```

另外，在这个网站上搜索“删除重复行 sql server”，你会发现这个问题已经在这里回答了很多次。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T12:52:02.890

```
DECLARE @Duplicates TABLE (AValue VARCHAR(32))

INSERT INTO @Duplicates VALUES ('No Duplicate')
INSERT INTO @Duplicates VALUES ('Duplicate')
INSERT INTO @Duplicates VALUES ('Duplicate')

SELECT ID = IDENTITY(INT, 1, 1), * 
INTO #Duplicates
FROM @Duplicates

DELETE FROM #Duplicates
FROM #Duplicates d
     INNER JOIN (
       SELECT ID = MIN(ID)
       FROM #Duplicates
       GROUP BY AValue
       HAVING COUNT(*) > 1
      ) id ON id.ID = d.ID

DELETE FROM @Duplicates

INSERT INTO @Duplicates
SELECT AValue FROM #Duplicates

DROP TABLE #Duplicates

SELECT * FROM @Duplicates 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-16T14:25:52.417

```
;WITH tempTable AS   
    (  
            SELECT ROW_NUMBER() OVER (PARTITION BY Column1 ORDER BY Column2 ) AS rownumber,*   
            FROM @Table  
    )  
    DELETE FROM tempTable WHERE rownumber > 1 
```

这取自答案之一中提到的文章链接，但只是为了将来某个时候拯救某人..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T12:49:53.083

用途：
设置 RowCount 1

然后运行你的删除 sql

这将删除 1 行，无论是否有多行匹配。

然后关闭查询窗口，或使用 Set RowCount 0 重置它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T12:52:58.147

*   创建具有相同架构的临时表
*   插入到临时表中 SELECT DISTINCT * FROM oldtable
*   从旧表中删除
*   插入旧表 SELECT * FROM 临时表
*   下降诱惑

不要忘记：

*   重构您的表以防止这种情况再次发生

# database - 将数据保存为一组具有公共键和类型的键值对的选项

> ID：629984
> 
> 赞同：1
> 
> 时间：2009-03-10T12:47:29.017
> 
> 标签：database, persistence, agile

我正在考虑编写另一个框架以更轻松地开发“bread'n'butter”应用程序的想法（例如创建一个具有 N 个字段的类，免费获得一个编辑器以及 DB 持久性）。

所有数据模型都可以转换为[Entity-Attribute-Value](http://en.wikipedia.org/wiki/Entity-attribute-value_model)形式：

```
TYPE VARCHAR(32)
ID LONG INT
NAME VARCHAR(32)
VALUE VARCHAR(64000) 
```

可能有第二个表用于非常大的字段，所以我会在 VALUE 列中保留对 BLOB 表中条目的引用。如果我有心情，我可以为每个值类型创建一个表（因此 int 将是 INTEGER，避免所有转换问题），我可以使用一个表来定义有效的类型等。

这将有效地让我不必担心数据库设计，因为没有数据库设计。数据库可以通过使用简单的更新来适应我的模型中的任何变化。我什至可以拥有具有附加字段的同一类的实例。

缺点是对于每个对象，我需要读取 N 行，或者我需要从构建包含 N 个子查询的复杂查询开始。

这个事情谁有经验？有没有人以这种方式实施过更大的系统？除了普通的 SQL 之外，还有哪些其他选项可以持久化数据？我特别想听听敏捷系统很容易适应模型的变化或允许“修补”模型（通常，一个实例会有一个名字，但对于某些人，我还想添加评论） . 或者有没有人遇到过post-SQL？下一个伟大的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:54:05.100

我没有使用它，但是您尝试做的事情听起来像[CouchDB](http://couchdb.apache.org/)。在重新发明轮子之前，您可能想看看那里......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T13:27:44.007

This approach is used by [Amazon SimpleDB](http://aws.amazon.com/simpledb/). You define *domains* and each domains has rows with a bunch of key/value pairs in it. This data is known as 'semi-structured'.

This approach has some strengths. Like your idea, you do not need to define a database schema. You can introduce new tables ad-hoc, new columns on a per-row basis, and even have columns that have more than one value (instead of creating a has_many relationship with an extra table). If your schema changes, you can introduce these changes transitionally rather than force migration.

On the other hand, you're throwing away decades of development on the relational model. You will hemorrhage speed because your indexing will either be too general or non-existent. Aggregate operations (groups, joins) will be extremely slow. Query optimisation will be difficult, etc.

Both Amazon SimpleDB and [Apache CouchDB](http://couchdb.apache.org/) deal with this issue by making their databases highly distributed. While this ensures reliability and redundancy, it has its own set of problems, such as conflict resolution and out-of-date data.

From your question you seem dead set on an 'agile' methods, so I would recommend one of those two DB engines (depending on whether you'd rather pay Amazon - albeit not much - or build your own setup). They both allow a completely dynamic database schema. Just beware of the pitfalls.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T12:53:28.423

看看 XML 数据库（如[eXist](http://exist.sourceforge.net/)）。您可以通过修改 xml 架构轻松更改“数据模型”。您可以使用强大的查询语言，如 XPath 和 XQuery。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T12:54:48.907

我从未将整个应用程序基于此原则，但在几乎所有应用程序中，我确实使用某种形式的键值对集合来处理特定实体需要一些其他实体不需要的其他属性的极端情况。

我基本上序列化字典并将其与我的实体数据一起存储在数据库中。当我必须处理一些太模糊而无法保证对整个模型进行更改时，这就是我用于后期制作修补的方法。

使用键值对数据，我也确实存储了类型，因此我可以自动呈现适当的 HTML 控件。我只有基本类型：文本、多行、RTF、复选框、数字和日期。

# iis - 使用 IIS 对 Tomcat 服务器进行负载平衡

> ID：629986
> 
> 赞同：1
> 
> 时间：2009-03-10T12:47:57.143
> 
> 标签：iis, tomcat, load-balancing

有没有人有使用 IIS 和基于基本网络的循环连接负载平衡 tomcat 服务器（在单独的物理机上）的经验？如果是这样，您可以提供的任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:57:01.677

您可以为此使用 tomcat 的 isapi_redirect 模块。我的 wiki 上有一个小的[配置手册](http://boplicity.nl/confluence/display/Tomcat/Running+Tomcat+behind+IIS)。

# c# - SEO：自定义站点地图提供程序与静态 web.sitemap 文件

> ID：629988
> 
> 赞同：1
> 
> 时间：2009-03-10T12:48:26.660
> 
> 标签：c#, asp.net, seo, sitemap

我们使用自定义站点地图提供程序从递归数据库表中填充 ASP.Net 应用程序的菜单控件，因此不使用静态 xml web.sitemap 文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<siteMap xmlns="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0" >
    <siteMapNode url="" title=""  description="">
        <siteMapNode url="" title=""  description="" />
        <siteMapNode url="" title=""  description="" />
    </siteMapNode>
</siteMap> 
```

出于 SEO 优化的原因，即使应用程序甚至不使用 web.sitemap 文件，将 customsitemap 提供者的项目导出到 web.sitemap 文件中是否有用？

如果它确实对 SEO 产生了积极影响，那么使用什么方法将 sitemapprovider 项目以正确的格式放入 xml 文件中？

你会怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T12:54:18.830

我不确定除了 asp.net 本身之外还有什么特别关心 asp.net 的站点地图。至于转换成无限多的 SEO 快乐[（谷歌）站点地图模式](http://www.sitemaps.org/protocol.php)- 这是 XSLT 设计的工作类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T13:11:30.253

我会在那里第二个 anakata。Google 不会关心您的 asp.net 站点地图文件。您需要创建一个符合[站点地图规范](http://www.sitemaps.org/protocol.php)的。XSLT 将是从现有站点地图创建它的绝佳解决方案。

另外，请记住，如果您有很多链接（超过 50,000 个 URL 或超过 10MB 的站点地图），您将需要使用包含多个站点地图的特殊站点地图索引。

为确保您的站点地图被搜索引擎找到，请在您的 robots.txt 文件中添加对它的引用：

```
Sitemap: <sitemap_location> 
```

您还可以使用[Google 的网站管理员工具](http://www.google.com/webmasters/)让他们了解您的站点地图。这通常会帮助您的网站更快地被索引，并提供有关您网站的大量重要信息（损坏的站点地图链接、pagerank 统计信息等）。雅虎也有一个类似的工具，叫做[站点浏览](https://siteexplorer.search.yahoo.com/)器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-20T23:23:33.250

您已经创建了我正在寻找的东西——一个用于创建面包屑菜单的数据库站点地图提供程序。可以分享一下你是怎么做到的吗？以及您是如何实施的？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-08T02:21:23.000

很可能公开您可以提交给搜索引擎的站点地图将有助于 SEO（多少取决于您的页面的可访问性）。

这是一个演示动态创建搜索引擎站点地图的链接：http: [//www.blackbeltcoder.com/Articles/asp/dynamic-sitemaps-in-asp-net](http://www.blackbeltcoder.com/Articles/asp/dynamic-sitemaps-in-asp-net)。

为了将此技术与您现有的 ASP.NET 站点地图相结合，您可能需要加载 ASP.NET 站点地图，然后使用该数据填充搜索引擎站点地图。

# design-patterns - What is the name of this factory type pattern and how do I represent it in UML?

> ID：629997
> 
> 赞同：1
> 
> 时间：2009-03-10T12:51:35.293
> 
> 标签：design-patterns, uml, factory

Example: I have several types, e.g. Wheel, Brake, Engine, Clutch, AutoBox, ManualBox, ElectricWindow, RearParkingSensor, HeatedSeats. These will all inherit a ICarPart marker interface (could be an attribute (java annotation), but doesn't matter at this stage).

I then write my Car class that can represent all car types, e.g.

```
class Car
{
    string Name;
    DateTime creationDate;
    string ID;

    IList<ICarPart> parts;
} 
```

I then write a factory to create cars. The factory could refer to some XML which is an ingredients list for different car types. E.g. (and please ignore format, this is just for illustration):

```
<ExpensiveCar>
  <Name>Expensive Car</Name>
  <Parts>
    <HeatedSeats/>
    <Wheel count=4/>
    <RearParkingSensor/>
    <ElectricWindow type=FrontAndBack/>
  </Parts>
</ExpensiveCar> 
```

The factory would parse this ingredients list and create the car object. New car types would be available to the system providing the parts had been coded and the ingredient list XML written.

Questions:

1.  What is this pattern called? Or is it just multiple patterns combined?
2.  Is any of this an antipattern?
3.  How do I represent this in a UML? I could do a class diagram for the parts and for the base car class. How would I show the instances of that class that are currently supported and the parts they have?

Thanks in advance. If any of this is unclear please comment and I'll amend/udpate/provide more details.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T12:56:57.153

> What is this pattern called? Or is it just multiple patterns combines?

You have the [factory method](http://en.wikipedia.org/wiki/Factory_method_pattern#C.2B.2B) pattern (creating car objects) and good-old composition (creating a car out of wheel, seat etc). The latter is a variation of composition.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T13:33:17.283

I think this may be the Abstract Factory Pattern, as you want the set of parts to be compatible with each other. You probably don't want truck tires on a compact car's wheels.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T09:54:10.093

> 1.  What is this pattern called? Or is it just multiple patterns combined?

The pattern described is the [Builder](http://www.google.co.uk/search?source=ig&hl=en&rlz=&q=Builder+Pattern&meta=lr%3D) Pattern. The builder pattern builds complex objects from a set of simpler parts. Sometimes the objects built by the builder pattern are [Composite](http://www.google.co.uk/search?hl=en&q=Composite+Pattern&btnG=Search&meta=) Objects (though not neccessarily in the question's case).

The builder pattern is often demonstrated using hard coded ingredients lists, though there is nothing in the pattern that requires this, nor does there seem to be a specific pattern documented describing the "ingredients list" approach.

> 2.  Is any of this an antipattern?

No

> 3.  How do I represent this in a UML?

Probably by:

1.  Define the class diagram showing the parts as classes as well as the Car class. Show that each part class implements the ICarPart interface.
2.  Perhaps on a seperate (but linked) class diagram show named instances of the car class using the UML instance notation. The instance class representation allows you to specify the values that attributes have in that class, e.g.

> ```
> ------------------------------------------
> |ExpensiveCar : Car                      |
> ------------------------------------------
> |parts = {                               |  
> |HeatedSeats,                            |
> |Wheel (count = 4),                      |
> |RearParkingSensor,                      |
> |ElectricWindows (type = FrontAndBack) } |
> ------------------------------------------ 
> ```

Note that because this is an instance the text "ExpensiveCar : Car" should be underlined but SO doesn't allow me to do this.

The notation I've used here to initialise an array with parts isn't great and might not be the best approach. Perhaps an alternative would be to add a UML note containing the actual XML. The important thing is that a client can see what makes an expensive car and so can a programmer.

# python - BeautifulSoup 给了我 unicode+html 符号，而不是直接的 unicode。这是错误还是误解？

> ID：629999
> 
> 赞同：5
> 
> 时间：2009-03-10T12:52:00.440
> 
> 标签：python, html, unicode, beautifulsoup

我正在使用 BeautifulSoup 来抓取网站。该网站的页面在我的浏览器中呈现良好：

> 国际乐施会的报告题为“越位！ [http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271](http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271)

特别是，单引号和双引号看起来很好。它们看起来是 html 符号而不是 ascii，但奇怪的是，当我在 FF3 中查看源代码时，它们似乎是正常的 ascii。

不幸的是，当我刮擦时，我得到了这样的东西

> u'Oxfam International\xe2€™s报告题为\xe2€œ越位！

哎呀，我的意思是：

```
u'Oxfam International\xe2€™s report entitled \xe2€œOffside! 
```

页面的元数据指示“iso-88959-1”编码。我尝试了不同的编码，使用了 unicode->ascii 和 html->ascii 第三方函数，并查看了 MS/iso-8859-1 的差异，但事实是 ™ 与单引号，我似乎无法将 unicode+htmlsymbol 组合转换为正确的 ascii 或 html 符号——在我有限的知识中，这就是我寻求帮助的原因。

我会很高兴使用 ascii 双引号，“或”

以下问题是我担心还有其他有趣的符号解码不正确。

```
\xe2€™ 
```

下面是一些 python 来重现我所看到的，然后是我尝试过的东西。

```
import twill
from twill import get_browser
from twill.commands import go

from BeautifulSoup import BeautifulSoup as BSoup

url = 'http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271'
twill.commands.go(url)
soup = BSoup(twill.commands.get_browser().get_html())
ps = soup.body("p")
p = ps[52]

>>> p         
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeEncodeError: 'ascii' codec can't encode character u'\xe2' in position 22: ordinal not in range(128)

>>> p.string
u'Oxfam International\xe2€™s report entitled \xe2€œOffside!<elided>\r\n' 
```

[http://groups.google.com/group/comp.lang.python/browse_frm/thread/9b7bb3f621b4b8e4/3b00a890cf3a5e46?q=htmlentitydefs&rnum=3&hl=en#3b00a890cf3a5e46](http://groups.google.com/group/comp.lang.python/browse_frm/thread/9b7bb3f621b4b8e4/3b00a890cf3a5e46?q=htmlentitydefs&rnum=3&hl=en#3b00a890cf3a5e46)

[http://www.fourmilab.ch/webtools/demoroniser/](http://www.fourmilab.ch/webtools/demoroniser/)

[http://www.crummy.com/software/BeautifulSoup/documentation.html](http://www.crummy.com/software/BeautifulSoup/documentation.html)

[http://www.cs.tut.fi/~jkorpela/www/windows-chars.html](http://www.cs.tut.fi/~jkorpela/www/windows-chars.html)

```
>>> AsciiDammit.asciiDammit(p.decode())
u'<p>Oxfam International\xe2€™s report entitled \xe2€œOffside!

>>> handle_html_entities(p.decode())
u'<p>Oxfam International\xe2\u20ac\u2122s report entitled \xe2\u20ac\u0153Offside! 

>>> unicodedata.normalize('NFKC', p.decode()).encode('ascii','ignore')
'<p>Oxfam International€™s report entitled €œOffside!

>>> htmlStripEscapes(p.string)
u'Oxfam International\xe2TMs report entitled \xe2Offside! 
```

编辑：

我尝试过使用不同的 BS 解析器：

```
import html5lib
bsoup_parser = html5lib.HTMLParser(tree=html5lib.treebuilders.getTreeBuilder("beautifulsoup"))
soup = bsoup_parser.parse(twill.commands.get_browser().get_html())
ps = soup.body("p")
ps[55].decode() 
```

这给了我这个

```
u'<p>Oxfam International\xe2\u20ac\u2122s report entitled \xe2\u20ac\u0153Offside! 
```

最好的案例解码似乎给了我相同的结果：

```
unicodedata.normalize('NFKC', p.decode()).encode('ascii','ignore')
'<p>Oxfam InternationalTMs report entitled Offside! 
```

编辑2：

我正在运行带有 FF 3.0.7 和 Firebug 的 Mac OS X 4

Python 2.5（哇，不敢相信我没有从一开始就说明这一点）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-10T13:15:41.757

这是一个严重混乱的页面，编码方式:-)

你的方法根本没有什么问题。我可能倾向于在将其传递给 BeautifulSoup 之前进行转换，只是因为我很挑剔：

```
import urllib
html = urllib.urlopen('http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271').read()
h = html.decode('iso-8859-1')
soup = BeautifulSoup(h) 
```

在这种情况下，页面的元标记与编码有关。该页面实际上是 utf-8 ... Firefox 的页面信息揭示了真正的编码，您实际上可以在服务器返回的响应标头中看到这个字符集：

```
curl -i http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271
HTTP/1.1 200 OK
Connection: close
Date: Tue, 10 Mar 2009 13:14:29 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
Set-Cookie: COMPANYID=271;path=/
Content-Language: en-US
Content-Type: text/html; charset=UTF-8 
```

如果您使用“utf-8”进行解码，它将对您有用（或者，至少对我有用）：

```
import urllib
html = urllib.urlopen('http://www.coopamerica.org/programs/responsibleshopper/company.cfm?id=271').read()
h = html.decode('utf-8')
soup = BeautifulSoup(h)
ps = soup.body("p")
p = ps[52]
print p 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T13:21:42.193

它实际上是 UTF-8 错误编码为 CP1252：

```
>>> print u'Oxfam International\xe2€™s report entitled \xe2€œOffside!'.encode('cp1252').decode('utf8')
Oxfam International’s report entitled “Offside! 
```*********