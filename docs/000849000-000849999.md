# StackOverflow 问答 000849000-000849999

# c# - 如何使用 LINQ 从字符串中选择标记？

> ID：849001
> 
> 赞同：3
> 
> 时间：2009-05-11T16:50:01.560
> 
> 标签：c#, linq

我想从字符串中选择一个标记，如果它存在于字符串中，我已经得到了以下内容，但我不确定它为什么不能编译：

```
IList<string> tokens = _animals.Split(';');

Func<string, bool> f1 = str => str.Contains("Dog");
Func<string, Func<string, bool>, string> f2 = str => Equals(f1, true);

var selected = tokens.Select(f2); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T16:54:06.623

我想你只是想要这个。

```
var selected = tokens.Where(str => str.Contains("Dog")); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T16:53:23.223

你真的需要 LINQ 来做到这一点吗？为什么你可以做这样的事情：

```
_animals.Contains("Dog") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:56:24.187

或者用文字

```
var selected = from token in tokens where token.Contains("Dog") select token; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:58:38.050

试试这个

```
 var result = (from p in tokens where p.Contains("Dog") select p); 
```

# c# - 为什么我无法访问属于不同类型成员的事件的成员？

> ID：849004
> 
> 赞同：4
> 
> 时间：2009-05-11T16:50:39.810
> 
> 标签：c#, events, delegates

> 注意：这是受[WebBrowser 事件属性的启发？](https://stackoverflow.com/questions/848757/webbrowser-event-properties/848766#848766)

为什么我可以访问`MulticastDelegate`声明事件的类型内的事件成员，但不能访问它之外的成员？

例如：

```
using System;

class Bar
{
    public static event Action evt;
}

class Program
{
    static event Action foo;
    static Bar bar;

    static void Main()
    {
        // this works
        Delegate[] first = foo.GetInvocationList();

        // This does not compile and generates the following
        // error:
        //
        // The event 'Bar.evt' can only appear on the 
        // left hand side of += or -= (except when used 
        // from within the type 'Bar')
        Delegate[] second = bar.evt.GetInvocationList();
    }
} 
```

我觉得这是我没有看到的非常简单的事情。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T16:54:01.647

事件不会公开字段及其值 - 它只是公开订阅方法和取消订阅方法，类似于属性公开 getter 和 setter 的方式。

在课堂之外，您对事件*所*能做的就是订阅或取消订阅。这就是它的目的——用于封装。

有关更多信息，请参阅我的[活动文章](http://pobox.com/~skeet/csharp/events.html)。

# linq-to-sql - 如何在不知道其类型的情况下在 C# 3.0 中返回 IQueryable？

> ID：849009
> 
> 赞同：3
> 
> 时间：2009-05-11T16:51:50.137
> 
> 标签：linq-to-sql, iqueryable

我有一种执行查询 SQL 的方法（我正在使用 Linq to SQL，但我必须执行经典的 SQL 查询），但我不知道将从哪个表/实体生成此查询。

所以，我在想，因为我不知道查询将从哪个表生成，我不知道我的 IQueryable 的类型，对吗？

但我不知道如何退货`IQueryable`？我试图返回`<T>`，但它不起作用。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-21T15:46:52.650

您可以在内部构建`IQueryable<T>`一个方法，然后将该方法设为通用。如果您这样做了，那么您将能够`IQueryable<T>`直接返回，并且 C# 编译器可以使用类型推断来确定`T`编译时的内容。这实际上是大多数 Linq 运算符的构建方式，除了它们是作为扩展方法实现的。

例如，考虑删除列表中该类型默认值的任何方法：

```
public static IQueryable<T> FilterDefaults<T>(IQueryable<T> theSet)
{
    IQueryable<T> query =
        from t in theSet
        where t != default(T)
        select t;

    return query;
} 
```

现在，当您在 C# 中调用它时，您可以`<T>`省略因为类型推断可以`T`在编译时计算出仍然是强类型：

```
string[] myStrs = { "ABC", null, "", "123", null, "XYZ" };
var theFilteredStrs = FilterDefaults(myStrs);
// should represent the sequence: "ABC", "", "123", "XYZ"
// note null is missing because default(string) is null

int[] myNums = { -1, 0, 3, 0, 42 };
var theFilteredNums = FilterDefaults(myNums);
// should represent the sequence: -1, 3, 42
// note 0 is missing because default(int) is 0 
```

这是一个仅使用基本类型的简单示例，但该想法对于任何 LINQ 使用（包括 LINQ-to-SQL）都是相同的，这是 LINQ 的强大功能。它并不关心您最终是要使用 LINQ-to-SQL 还是只是 LINQ-to-Objects。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:03:25.173

你不能像你发现的那样。由于您不知道类型，因此无法返回泛型 Generic（即 List），这是您正在做的唯一其他选择（也可以随时返回强 Linq 到 Sql 类型的子集）是创建自己的类型（即.. Class 或 Struct）并填充 List 并返回...我猜您对要返回的列有所了解，因此应该不会太难。

希望这有助于标签

# sharepoint - 如何将分页添加到共享点 DataFormWebPart？

> ID：849010
> 
> 赞同：1
> 
> 时间：2009-05-11T16:51:50.153
> 
> 标签：sharepoint, web-parts, paging

我正在共享点发布站点中创建新闻文章存档。用户可以浏览或搜索存档。浏览是文章日期标题的简单列表。我正在使用 DataFormWebPart 来显示页面（文章）的内容。由于有数千篇文章，我想在一页上显示大约 50 篇。我在 DataFormWebPart 上看不到内置分页。我正在寻求有关添加分页的正确方法的指导。我觉得 XSL 模板是合适的起点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-11T19:08:47.053

XSL 模板是您需要开始的地方。除非您正在处理多个数据源，否则在 SharePoint Designer (SPD) 中将列表设置为新 DataFormWebPart 上的数据源将创建一个带有分页的 XSL 模板（默认为 10 项）。然后，如果您想修改外观或操作，您可以查看和编辑 XSL。在初始 XSL 模板之后，查看浏览器或 SPD 中的 webpart 属性。还有一些您可能想要更改的其他设置（例如异步）。分页在技术上适用于多个数据源，但它仅适用于父数据源。如果子数量很大，则通常太大而无法在 SPD 中看到分页控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:54:41.083

如果您在“设计”模式下使用共享点设计器查看页面，则可以单击常用任务箭头 ( > ) 并自定义数据视图属性。

其中一个选项卡将是关于“分页”的，您可以设置每页有多少项目。

希望这可以帮助！

# visual-studio - LINQ to SQL、存储过程和方法窗格（更像是方法 PAIN！）

> ID：849026
> 
> 赞同：0
> 
> 时间：2009-05-11T16:56:20.037
> 
> 标签：visual-studio, linq, linq-to-sql

我是 LINQ 新手，遇到了一个小问题。我创建了一个 DBML 文件并将我的所有表拖到设计图面上。现在，当我尝试将存储过程拖到方法窗格时，Visual Studio 想了一会儿，然后什么也没做。我的方法未显示在方法窗格中。

幕后是否发生了一些错误？如果是这样，我该如何解决它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T17:42:17.323

LINQ to SQL 设计器可能无法确定存储过程的架构，尤其是在您使用临时表的情况下。尝试将存储过程更改为仅从相关表中进行选择，将其映射到设计器中（通过拖动正确的表顶部），然后将过程更改回原始代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:43:40.207

我自己试过这个。我使用了 VS2008 SP1，将我的数据库中的每个表拖到类窗格中，然后他们添加了。然后我拖入了一个存储过程。处理 SP 确实比处理表格花费了更长的时间，但该方法在我的方法窗格中显示没有问题。您的存储过程可能无法使用可用的元数据为其成功创建方法。

我做对了吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-05T14:37:03.390

杰普，我有同样的问题。我的错是我试图添加到窗格的存储过程有一个返回结果，其中包含地理数据类型。LinQ2SQL 设计器尚不支持此功能。

您可以做些什么来测试您返回的数据类型（如果您使用一些特殊的数据类型），将它们作为参数添加到您的存储过程中。设计师会报错。

例如尝试将以下存储过程添加到窗格将产生错误：

```
CREATE PROCEDURE test
(
    @GeographicLocation geography
)
AS
BEGIN
END; 
```

# jquery - 使用jQuery拖放后如何获取坐标位置？

> ID：849030
> 
> 赞同：41
> 
> 时间：2009-05-11T16:57:29.893
> 
> 标签：jquery, drag-and-drop, save, position

使用jQuery拖放后如何获取坐标位置？我想将坐标保存到数据库中，以便下次访问时，该项目将位于该位置。比如x：520px，y：300px？

编辑：

我是 PHP 和 mysql 程序员 :)

那里有教程吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-13T12:43:37.233

我刚刚做了类似的事情（如果我理解正确的话）。

我使用了 jQuery 1.3.2 中包含的函数 position()。

只是做了一个复制粘贴和一个快速的调整......但应该给你的想法。

```
// Make images draggable.
$(".item").draggable({

    // Find original position of dragged image.
    start: function(event, ui) {

        // Show start dragged position of image.
        var Startpos = $(this).position();
        $("div#start").text("START: \nLeft: "+ Startpos.left + "\nTop: " + Startpos.top);
    },

    // Find position where image is dropped.
    stop: function(event, ui) {

        // Show dropped position.
        var Stoppos = $(this).position();
        $("div#stop").text("STOP: \nLeft: "+ Stoppos.left + "\nTop: " + Stoppos.top);
    }
});

<div id="container">
    <img id="productid_1" src="images/pic1.jpg" class="item" alt="" title="" />
    <img id="productid_2" src="images/pic2.jpg" class="item" alt="" title="" />
    <img id="productid_3" src="images/pic3.jpg" class="item" alt="" title="" />
</div>

<div id="start">Waiting for dragging the image get started...</div>
<div id="stop">Waiting image getting dropped...</div> 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-03-24T16:22:06.393

有同样的问题。接下来是我的解决方案：

```
$("#element").droppable({
    drop: function( event, ui ) {

        // position of the draggable minus position of the droppable
        // relative to the document
        var $newPosX = ui.offset.left - $(this).offset().left;
        var $newPosY = ui.offset.top - $(this).offset().top;

    }
}); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-12-19T03:24:55.800

以上都不适合我。

这是我的解决方案 - 效果很好：

```
$dropTarget.droppable({
    drop: function( event, ui ) {

    // Get mouse position relative to drop target: 
    var dropPositionX = event.pageX - $(this).offset().left;
    var dropPositionY = event.pageY - $(this).offset().top;
    // Get mouse offset relative to dragged item:
    var dragItemOffsetX = event.offsetX;
    var dragItemOffsetY = event.offsetY;
    // Get position of dragged item relative to drop target:
    var dragItemPositionX = dropPositionX-dragItemOffsetX;
    var dragItemPositionY = dropPositionY-dragItemOffsetY;

    alert('DROPPED IT AT ' + dragItemPositionX + ', ' + dragItemPositionY); 
```

（基于此处给出的部分解决方案：[https](https://stackoverflow.com/a/10429969/165673) ://stackoverflow.com/a/10429969/165673 ）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-11-30T05:57:50.920

这对我有用：

```
$("#element1").droppable(
{
    drop: function(event, ui)
    {
        var currentPos = ui.helper.position();
            alert("left="+parseInt(currentPos.left)+" top="+parseInt(currentPos.top));
    }
}); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-11T17:08:48.517

我会从这样的事情[开始](http://www.webresourcesdepot.com/dynamic-dragn-drop-with-jquery-and-php)。然后更新它以使用[位置插件](http://docs.jquery.com/Plugins/dimensions/position) ，这应该可以让你到达你想去的地方。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-07T16:03:12.717

如果你正在监听dragstop或其他事件，原始位置应该是一个ui参数：

```
dragstop: function(event, ui) {
    var originalPosition = ui.originalPosition;
} 
```

否则，我相信获得它的唯一方法是：

```
draggable.data("draggable").originalPosition 
```

draggable 是您正在拖动的对象。第二个版本不能保证在 jQuery 的未来版本中工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-04-16T06:19:21.563

```
$(function() 
  {
    $( "#element" ).draggable({ snap: ".ui-widget-header",grid: [ 1, 1 ]});
  });
    $(document).ready(function() {
        $("#element").draggable({ 
                containment: '#snaptarget', 
                scroll: false
         }).mousemove(function(){
                var coord = $(this).position();
                var width = $(this).width();
               var height = $(this).height();
                $("p.position").text( "(" + coord.left + "," + coord.top + ")" );
                $("p.size").text( "(" + width + "," + height + ")" );
         }).mouseup(function(){
                var coord = $(this).position();
                var width = $(this).width();
                var height = $(this).height();
                $.post('/test/layout_view.php', {x: coord.left, y: coord.top, w: width, h: height});

                });
        });
```

```
#element {background:#666;border:1px #000 solid;cursor:move;height:110px;width:110px;padding:10px 10px 10px 10px;}
#snaptarget { height:610px; width:1000px;}
.draggable { width: 90px; height: 80px; float: left; margin: 0 0 0 0; font-size: .9em; }
.wrapper
{ 
background-image:linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
height:100%;
background-size:45px 45px;
border: 1px solid black;
background-color: #434343;
margin: 20px 0px 0px 20px;
}
```

```
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Layout</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="../themes/default/css/test4.css" type="text/css" charset="utf-8"/>
    <script src="../themes/default/js/layout.js"></script>
  </head>
<body>
    <div id="snaptarget" class="wrapper">
        <div id="element" class="draggable ui-widget-content">
          <p class="position"></p>
          <p class="size"></p>
        </div>
    </div> 
    <div></div>
</body>
</html>
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-03-14T12:23:58.283

我需要保存开始位置和结束位置。这项工作对我来说：

```
 $('.object').draggable({
        stop: function(ev, ui){
            var position = ui.position;
            var originalPosition = ui.originalPosition;
        }
    }); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-10-11T18:50:10.933

Cudos 接受的答案很棒。然而，Draggable 模块也有一个“拖动”事件，它告诉你拖动时的位置。因此，除了“开始”和“停止”之外，您还可以在 Draggable 对象中添加以下事件：

```
 // Drag current position of dragged image.
    drag: function(event, ui) {

        // Show the current dragged position of image
        var currentPos = $(this).position();
        $("div#xpos").text("CURRENT: \nLeft: " + currentPos.left + "\nTop: " + currentPos.top);

    } 
```

# mysql - fmt:formatDate 和 timeZone

> ID：849038
> 
> 赞同：0
> 
> 时间：2009-05-11T17:00:04.647
> 
> 标签：mysql, timezone, jstl

我在 Mysql 数据库中有字段类型为*datetime*。

例如，我使用下一个 Java 代码存储付款日期：

```
payment.setCreatedOn(new Date(System.currentTimeMillis())); 
```

在我的视图层中，我使用[fmt:formatDate](http://java.sun.com/products/jsp/jstl/1.1/docs/tlddocs/fmt/formatDate.html)来格式化日期：

```
<fmt:formatDate value="${payment.createdOn}" pattern="EEE, dd MMM yyyy HH:mm:ss"/> 
```

我的服务器在伦敦，我的应用程序的用户在维也纳。时间显示延迟可能是因为不同的时区。我可以在 fmt:formatDate 中使用*timeZone参数。*

> timeZone：表示格式化时间的时区。

在谷歌搜索后，我认为*Europe/Vienna*的值对*timeZone*参数有效。

有谁知道是否有任何有效时区字符串的列表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-18T14:18:59.783

塞尔吉奥 - 我敢肯定你早​​就找到了它......

这是[Olson 数据库](http://www.twinsun.com/tz/tz-link.htm)或“zoneinfo”的主页，它是 TZ 信息的权威来源。

这是一个[不错的 wiki](http://twiki.org/cgi-bin/xtra/tzdatepick.html)用于浏览区域。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-15T01:18:41.673

这是 IBM JDK 的列表，有点过时但有完整列表：

[http://publib.boulder.ibm.com/infocenter/wsdoc400/v6r0/index.jsp?topic=/com.ibm.websphere.iseries.doc/info/ae/ae/adrtzval.htm](http://publib.boulder.ibm.com/infocenter/wsdoc400/v6r0/index.jsp?topic=/com.ibm.websphere.iseries.doc/info/ae/ae/adrtzval.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-08T08:00:32.417

您需要使用国际时间（UTC/Zulu）添加以下调度客户端时间使用，例如“GMT+1”。请参阅此示例。

将此参数作为参数放在您的服务器中以设置 UTC 时间使用，在这种情况下适用于 tomcat：

**-Duser.timezone="UTC"**

```
/* Java */      

@RequestMapping(value = "/web", method = { RequestMethod.POST, RequestMethod.GET })
public String web(Model model, HttpSession session, Locale locale) {

    Date today = new Date();
    model.addAttribute("currentTime", today);
    model.addAttribute("timezone", "GMT+1");

    return "web";
} 
```

要显示日期，请选择您想要的模式（属性）

```
/* JSP web */

<fmt:timeZone value="${timezone}">
<spring:message code="date_format_dateMin" var="pattern"/>
<fmt:formatDate value="${currentTime}" timeZone="${timezone}" pattern="${pattern}" var="searchFormated" />
<span class="innerLabel">${searchFormated}</span>   
</fmt:timeZone>

/* Properties */

date_format_dateMin=yyyy/MM/dd HH:mm
date_format=yyyy/MM/dd HH:mm:ss    
date_format2=yyyy/MM/dd
date_format3_js=yy/mm/dd
date_format4_time=HH:mm
date_format4=dd/MM/yyyy HH:mm:ss 
```

# visual-studio-2008 - Visual Studio 可以使用默认配置重新生成 WCF 服务 Web.config 文件吗？

> ID：849039
> 
> 赞同：0
> 
> 时间：2009-05-11T17:00:09.047
> 
> 标签：visual-studio-2008, wcf

在 WCF 服务项目中创建新服务时，Visual Studio 会自动将配置信息放入服务的 web.config 文件中。无论如何，是否可以使用新的 Web 配置文件和服务项目中的现有服务类来复制此行为？有时，服务的 web.config 似乎由于用户错误或 Visual Studio 怪癖而被破坏。最好删除服务的 web.config 并获得一个新的，使用相同的默认配置自动配置，就好像在 VS 中创建了一个新的服务类一样。

有没有办法做到这一点？

编辑：我指的是服务的 web.config 文件而不是客户端 web.config/app.config。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T17:17:23.293

当然 - 您可以针对您的服务运行命令行实用程序`svcutil.exe`（直接使用 URL 或 WSDL 作为文件）。默认情况下，这将生成一个`output.config`配置文件，其中包含该部分中所有必要的设置`<system.serviceModel>`。只需复制并粘贴到您的新的或现有的 web.config 中。

马克

编辑：从下面的评论来看，在服务器端配置的情况下答案是否定的。

# hibernate - 一对多映射//如何映射遗留表的关联（Hibernate）

> ID：849040
> 
> 赞同：1
> 
> 时间：2009-05-11T17:00:11.777
> 
> 标签：hibernate, database-design, orm

我有两个遗留数据库表，以简化方式布局，如下所示：

```
MASTER                        SLAVE
ident                         ident
sName                         sName
sNumber                       sNumber
sDesc                         sValue
-----                         ------
Java Class 'ScenarioMaster'   Java Class 'ScenarioSlave' 
```

每行通过列都有一个代理索引，但和`ident`之间没有关系。但是，对于该表，一对 sName/sNumber 的唯一性是正确的。因此，这将是一个可能且有意义的复合键（我知道那些是邪恶的）。`MASTER.key``SLAVE.key``MASTER`

实际上，存在 1:n 关系，这意味着每`MASTER`行引用表中的*n*行`SLAVE`。鉴于上面的列描述，可能的人口可能是

```
MASTER                        SLAVE
100                           42
'labl'                        'labl'
1                             1
'some label'                  0.1
                              43
                             'labl'
                              1
                              0.2 
```

现在，使用 hibernate，我如何在我的 java 类中反映这种关系？在`ScenarioMaster`我会声明一个带有公共 getter/setter 的 Set 或 List

```
private List<ScenarioSlave> slaves = new ArrayList<ScenarioSlave>(); 
```

的休眠映射`ScenarioMaster`可能包含

```
<bag name="slaves" cascade="all">
    <key>
        <column name="sName" not-null="true"/>
        <column name="sNumber" not-null="true"/>
    </key>
    <one-to-many class="ScenarioSlave"/>
</bag> 
```

但是，这会在`ScenarioMaster`使用`session.saveOrUpdate(scenarioMaster)`.

```
// create master scn and slave slv      
scn.addSlave(slv);  
session.saveOrUpdate(scn);

    Hibernate: 
        update
            SLAVE
        set
            sNumber=?,
            sName=?,
            sValue=?
        where
            sName=? 
            and sNumber=?
    Hibernate: 
        update
            SLAVE
        set
            sName=null,
            sNumber=null 
        where
            sName=? 
            and sNumber=? 
```

我究竟做错了什么？第二次更新来自哪里？我想这与 sName/sNumber 不是`ScenarioSlave`. 我不太明白，为什么。

请注意，sName/sNumber 参数确实指向有效值，并且`ScenarioMaster`我想通过其持久化的实例实际上在List中`saveOrUpdate`有一个非空`ScenarioSlave`实例。`slaves`

**编辑**：使用此映射将复合键推迟到单独的类

```
<composite-id name="keyId" class="ScenarioKeyId">
    <key-property name="name" access="field" column="sName"
        type="string" length="20"/>
    <key-property name="number" access="field" column="sNumber"
        type="long"/>
</composite-id> 
```

我真的不想创建一个将*'labl'，1*`NAMENUMBER_KEY`映射到*'key_labl1'之*类的表，然后可以将其用作休眠。我想，这就是 hibernate 所做的（不使用实际的表）。**`id`**

 *** * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T17:15:50.050

根据我的经验，Hibernate 不适用于复合键。就我所见，这是 Hibernate 的一个主要问题。过去我通过避免使用“纯”复合键来解决它；也就是说，我为复合键表提供了一个唯一的 ID 列，然后 Hibernate 可以对其进行处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T21:49:18.717

我试了一下（一定喜欢[Apache Derby](http://db.apache.org/derby/)）假装，两个表都没有复合 ID。然后我发现，该`SET ... = null`声明很可能是为了使`slave`列表成员无效。

```
create table MASTER(
   ident numeric(10) not null, -- key column
   name char(20) not null,
   number numeric(10) not null,
   descr char(64) not null
);

create table SLAVE(
   ident numeric(10) not null, -- key column
   name char(20) not null,
   number numeric(10)   ,      -- foreign key f. MASTER.ident
   value float not null
); 
```

这是我的测试代码。我将主类密钥的生成器设置为`assigned`.

```
 Master master = new Master();
        master.setIdent(Integer.valueOf(0));
        master.setName("name");
        master.setNumber(42);
        master.setDescr("name/42 descr");
        Slave slv = new Slave("name", 42, 0.001);
        master.addSlave(slv);
        theSession.beginTransaction();
        theSession.saveOrUpdate(master);
        theSession.getTransaction().commit(); 
```

然后，允许行`NULL`中的值`SLAVE.number`，我得到

```
Hibernate: 
    update
        SLAVE 
    set
        number=null 
    where
        number=?
Hibernate: 
    update
        SLAVE 
    set
        number=? 
    where
        ident=? 
```

现在我只需要弄清楚如何实际删除过时的行，`SLAVE`而不是将外键列设置为`NULL`...

# c++ - 在 C++ 中实现“app.exe -指令文件”表示法

> ID：849042
> 
> 赞同：1
> 
> 时间：2009-05-11T17:00:45.287
> 
> 标签：c++, command-line-arguments

我的数据结构类有一个项目，它是一个使用二叉树和其他东西工作的文件压缩器。我们需要使用命令行中的以下说明“压缩”和“解压缩”任何给定文件：

压缩： *compressor.exe -zip file.whatever*

解压： *compressor.exe -unzip file.zip*

我们正在用**C++ 编程**。我使用 IDE Code::Blocks 并在 Windows 中使用 GCC 进行编译。

我的问题是：你是**如何实现的？？！！**如何让你的 .exe 在命令行中接收这些参数，然后按照你想要的方式执行它们？

另外，如果我希望该实现在 Linux 中编译，有什么特别需要注意的吗？

谢谢你的帮助

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T17:03:33.627

您可能希望在编程文本中查找`main`函数的签名，即程序的入口点。这就是您可以提取这些命令行参数的地方。

我不想比这更详细，因为这显然是任务的关键点，如果我发现自己和你一起工作，我希望你能够自己解决这类问题一旦你收到适当的轻推。:)

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T17:11:09.387

我记得，Single UNIX Specification / POSIX 在 unistd.h 中定义了[getopt](http://www.opengroup.org/onlinepubs/000095399/functions/getopt.html)来为您处理参数解析。虽然这是一个 C 函数，但它也应该在 C++ 中工作。

除了 getopt_long（在 getopt.h 中）之外，GNU GLIBC[还具有此功能，以支持 GNU 的扩展 --style 。](http://www.gnu.org/software/hello/manual/libc/Getopt.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:06:14.010

Lo logré，我明白了！

**我现在对如何在main()函数中使用****argc**和**argv[ ]**参数有了基本的了解（我*一直*想知道它们有什么用处……）。例如，如果我输入命令行：

 ****压缩器.exe -解压文件.zip*

然后：

*   argc 在 '3' 中初始化（行中的参数数量）
*   argv[0] == "compressor.exe" (应用程序名称)
*   argv[1] == "-解压缩"
*   argv[2] == "file.zip"

Greg（不是'Creg'，对不起=P）和Bemrose，谢谢你们的帮助！^^

# c# - 将新节点添加到 xml 末尾的最快方法？

> ID：849043
> 
> 赞同：7
> 
> 时间：2009-05-11T17:01:39.527
> 
> 标签：c#, .net, xml

我有一个大 xml 文件（大约 10 MB），结构简单：

```
<Errors>
   <Error>.......</Error>
   <Error>.......</Error>
   <Error>.......</Error>
   <Error>.......</Error>
   <Error>.......</Error>
</Errors> 
```

我的需要是在 </Errors> 标记之前的末尾添加一个新节点 <Error> 。在.net 中实现这一目标的最快方法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T18:28:24.083

您需要使用 XML 包含技术。

您的 error.xml （不会改变，只是一个存根。由 XML 解析器用来读取）：

```
<?xml version="1.0"?>
<!DOCTYPE logfile [
<!ENTITY logrows    
 SYSTEM "errorrows.txt">
]>
<Errors>
&logrows;
</Errors> 
```

您的 errorrows.txt 文件（更改，xml 解析器不理解它）：

```
<Error>....</Error>
<Error>....</Error>
<Error>....</Error> 
```

然后，向 errorrows.txt 添加一个条目：

```
using (StreamWriter sw = File.AppendText("logerrors.txt"))
{
    XmlTextWriter xtw = new XmlTextWriter(sw);

    xtw.WriteStartElement("Error");
    // ... write error messge here
    xtw.Close();
} 
```

或者您甚至可以使用 .NET 3.5 XElement，并将文本附加到`StreamWriter`：

```
using (StreamWriter sw = File.AppendText("logerrors.txt"))
{
    XElement element = new XElement("Error");
    // ... write error messge here
    sw.WriteLine(element.ToString());
} 
```

另请参阅[Microsoft 的文章修改大型 XML 文件的有效技术](http://msdn.microsoft.com/en-us/library/aa302289.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T17:08:02.543

首先，我会取消 System.Xml.XmlDocument 的资格，因为[它是一个 DOM](http://en.wikipedia.org/wiki/Document_Object_Model)，需要在内存中解析和构建整个树，然后才能附加到它。这意味着您的 10 MB 文本将超过 10 MB 的内存。这意味着它是“内存密集型”和“耗时”的。

其次，我会取消 System.Xml.XmlReader 的资格，因为它[需要先解析整个文件](http://en.wikipedia.org/wiki/Simple_API_for_XML)，然后才能到达可以追加的时间点。您必须将 XmlReader 复制到 XmlWriter 中，因为您无法修改它。这需要先在内存中复制您的 XML，然后才能附加到它。

XmlDocument 和 XmlReader 更快的解决方案是字符串操作（它有自己的内存问题）：

```
string xml = @"<Errors><error />...<error /></Errors>";
int idx = xml.LastIndexOf("</Errors>");

xml = xml.Substring(0, idx) + "<error>new error</error></Errors>"; 
```

切掉结束标签，添加新错误，然后重新添加结束标签。

我想你可能会为此发疯，并将你的文件截断 9 个字符并附加到它上面。不必读取文件并让操作系统优化页面加载（只需加载最后一个块或其他内容）。

```
System.IO.FileStream fs = System.IO.File.Open("log.xml", System.IO.FileMode.Open, System.IO.FileAccess.ReadWrite);
fs.Seek(-("</Errors>".Length), System.IO.SeekOrigin.End);
fs.Write("<error>new error</error></Errors>");
fs.Close(); 
```

如果您的文件为空或仅包含“<Errors></Errors>”，这将遇到问题，这两者都可以通过检查长度轻松处理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T17:12:38.557

最快的方法可能是直接文件访问。

```
using (StreamWriter file = File.AppendText("my.log"))
{
    file.BaseStream.Seek(-"</Errors>".Length, SeekOrigin.End);
    file.Write("   <Error>New error message.</Error></Errors>");
} 
```

但是您会丢失所有不错的 XML 功能，并且可能很容易损坏文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T17:14:45.950

我会使用 XmlDocument 或 XDocument 来加载您的文件，然后相应地对其进行操作。

然后，我将研究在内存中缓存此 XmlDocument 的可能性，以便您可以快速访问该文件。

你需要什么速度？您是否已经遇到了性能瓶颈，或者您正在期待一个？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T17:05:16.293

最快的方法可能是使用 读取文件[`XmlReader`](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader(VS.80).aspx)，并简单地将每个读取节点复制到一个新流中，[`XmlWriter`](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.aspx)当您到达遇到结束`</Errors>`标记的位置时，您只需要在继续`<Error>`之前输出您的附加元素“读取和复制”循环。这种方式不可避免地比将整个文档读入 DOM（`XmlDocument`类）更难，但对于大型 XML 文件来说，*要*快得多。诚然，使用`StreamReader`/`StreamWriter`会更快一些，但在代码中使用起来非常可怕。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T17:06:09.240

您的 XML 文件在代码中是如何表示的？您使用 System.XML 类吗？在这种情况下，您可以使用 XMLDocument.AppendChild。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T17:17:23.543

试试这个：

```
 var doc = new XmlDocument();
        doc.LoadXml("<Errors><error>This is my first error</error></Errors>");

        XmlNode root = doc.DocumentElement;

        //Create a new node.
        XmlElement elem = doc.CreateElement("error");
        elem.InnerText = "This is my error";

        //Add the node to the document.
        if (root != null) root.AppendChild(elem);

        doc.Save(Console.Out);
        Console.ReadLine(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T17:37:55.880

下面是如何在 C 中做到这一点，.NET 应该是类似的。

游戏是简单地跳转到文件的末尾，跳过标签，追加新的错误行，然后写一个新的标签。

```
#include <stdio.h>
#include <string.h>
#include <errno.h>

int main(int argc, char** argv) {
        FILE *f;

        // Open the file
        f = fopen("log.xml", "r+");

        // Small buffer to determine length of \n (1 on Unix, 2 on PC)
        // You could always simply hard code this if you don't plan on 
        // porting to Unix.
        char nlbuf[10];
        sprintf(nlbuf, "\n");

        // How long is our end tag?
        long offset = strlen("</Errors>");

        // Add in an \n char.
        offset += strlen(nlbuf);

        // Seek to the END OF FILE, and then GO BACK the end tag and newline
        // so we use a NEGATIVE offset.
        fseek(f, offset * -1, SEEK_END);

        // Print out your new error line
        fprintf(f, "<Error>New error line</Error>\n");

        // Print out new ending tag.
        fprintf(f, "</Errors>\n");

        // Close and you're done
        fclose(f);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T19:22:04.570

使用基于字符串的技术（例如查找文件末尾，然后向后移动结束标签的长度）容易受到文档结构中意外但完全合法的变化的影响。

该文档可以以任意数量的空格结尾，以选择您最可能遇到的问题。它也可以以任意数量的评论或处理指令结束。如果顶层元素没有命名会发生什么`Error`？

这是使用字符串操作完全无法检测到的情况：

```
<Error xmlns="not_your_namespace">
   ...
</Error> 
```

如果您使用 an`XmlReader`来处理 XML，虽然它可能不如寻找 EOF 快，但它还允许您处理所有这些可能的异常情况。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-03-11T12:51:59.110

我尝试使用其他答案建议的代码，但遇到了一个问题，有时在我的字符串上调用 .length 与字符串的字节数不同，因此我不一致地丢失字符。我修改它以获取字节数。

```
var endTag = "</Errors>";
var nodeText = GetNodeText();
using (FileStream file = File.Open("my.log", FileMode.Open, FileAccess.ReadWrite))
{
    file.BaseStream.Seek(-(Encoding.UTF8.GetByteCount(endTag)), SeekOrigin.End);
    fileStream.Write(Encoding.UTF8.GetBytes(nodeText), 0, Encoding.UTF8.GetByteCount(nodeText));
    fileStream.Write(Encoding.UTF8.GetBytes(endTag), 0, Encoding.UTF8.GetByteCount(endTag));
} 
```

# c# - 你可以在编译过程中只包含某些表格吗

> ID：849046
> 
> 赞同：3
> 
> 时间：2009-05-11T17:02:54.907
> 
> 标签：c#, .net, conditional-compilation

我们正在开发一个应用程序的两个版本。不是应用程序的精简版和标准版的意义上，其中一个版本将具有有限的功能等。我们实际上将在应用程序中显示不同类型的信息，具体取决于版本（这是我描述它的最佳方式涉及太多细节）。

为了区分我们考虑使用条件属性和#if 指令的两个版本的应用程序（如果有任何其他选项或比这两个更好的方法，我愿意提供建议）。经过一些研究和辩论，我们决定使用#if 方法，因为这不会在编译过程中包含不必要的代码（而条件属性只会删除对不满足条件的方法的调用，但仍然包括方法......如果我没记错的话）。我意识到这两者并不相互排斥，所以如果需要，我们总是可以混合搭配。

无论如何......我们现在想知道的是，是否有一种方法可以在编译期间**仅**包含某些 Windows 窗体，具体取决于我们正在编译的应用程序的版本。我们已经拆分了所有的逻辑，所以表单实际上只是表单，其中只有很少的代码（主要是调用处理所有业务逻辑的表单管理器类）。表单管理器类将包含其中的一些#if 语句，因此代码可以在应用程序的两个版本中重用，只要可能（而不是创建两个类并在类上放置条件属性......虽然也许这是我们应该考虑的）。

有人知道这样做的好方法吗？

TIA

更新：

只是我们实际决定做的一个仅供参考。我们将不同版本的表单放入单独的命名空间中，然后只需要在管理所有表单的类顶部的命名空间 using 语句周围使用 #if 语句。工作很顺利，而且工作量很小。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T17:12:19.197

另一种方法是使用 OO 继承：将两个版本共有的功能放在超类中，然后创建单独的子类，为每个版本定义超类的特化。

然后，您可以将您的超类[es] 构建为共享库，并在单独的程序集中（引用公共共享库）构建每个专门的子类。

这样做不使用条件编译或条件构建选项。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T19:54:52.460

我用图书馆项目来做这件事。我制作了另一个项目（.csproj），然后将现有源包含到该项目中。在 VS2008 中，右键单击新项目，单击 add Existing Item... 然后*不单击 Add*，而是使用选择箭头选择“Add as Link”。

**Add as Link**不会复制源模块，而是将对现有源的引用包含到新项目中。这样您就可以拥有 N 个项目，每个项目都有不同的源模块组合。我将它与通用模块源中的#if 语句一起使用，以生成不同版本的库。

[添加现有项目 http://www.freeimagehosting.net/uploads/th.eff09391e9.png](http://www.freeimagehosting.net/uploads/th.eff09391e9.png) [完整图片](http://www.freeimagehosting.net/image.php?eff09391e9.png)

[添加为链接 http://www.freeimagehosting.net/uploads/th.f12b764887.png](http://www.freeimagehosting.net/uploads/th.f12b764887.png) [完整图片](http://www.freeimagehosting.net/image.php?f12b764887.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T17:19:32.913

ChrisW 建议的解决方案可能是正确的方法。但是，它可能会对您的设计进行很多更改，所以这里有另一个：不要为同一个项目设置多个配置，而是使用相同的源创建另一个项目。为此，最简单的方法是创建 .csproj 文件的副本并将其包含在解决方案中

# java - Java Struts 1：从一个动作到另一个动作。通过 ActionForm 传递数据

> ID：849051
> 
> 赞同：15
> 
> 时间：2009-05-11T17:05:05.730
> 
> 标签：java, struts-1

我们一直在尝试从一个动作重定向到另一个动作，希望数据能够在相应的`ActionForm`bean 之间传递。第一个动作接收来自浏览器的请求，打印一个数据字段，并将其转发给另一个动作，该动作打印相同的字段并重定向到 JSP。

问题是`ActionTo`打印了一个不正确的值——它`commonInt`的默认值是`0`, 而我们期望的是`35`。

这是一个代表性的例子：

```
public class ActionFrom extends DispatchableAction{

    public ActionForward send(ActionMapping mapping, ActionForm form, HttpServletRequest request,HttpServletResponse response){
        FormA formA = (FormA)form;

        formA.commonInt = 35;
        System.out.println("sent: "+formA.commonInt);
        return mapping.findForward("send");
    }
}

public class ActionTo extends DispatchableAction{

    public ActionForward recv(ActionMapping mapping, ActionForm form, HttpServletRequest request,HttpServletResponse response){
        FormB formB = (FormB)form;

        System.out.println("recv= "+formB.commonInt);

        return mapping.findForward("send");
    }
} 
```

actionForms 是：

```
public class FormA extends ActionForm {
    public int intA;
    public int commonInt;
}

public class FormB extends ActionForm{
    public int intB;
    public int commonInt;
} 
```

映射：

```
<action path="/from" type="EXPERIMENT.ActionFrom" name="formA" scope="request"
      input="something.jsp" parameter="dispatch" unknown="false" validate="false">
 <forward  name="send" path="/to.do?dispatch=recv" redirect="false"/>
</action>

 <action path="/to" type="EXPERIMENT.ActionTo" name="formB"  scope="request"
      input="something.jsp" parameter="dispatch" unknown="false" validate="false">
      <forward name="send" path="/login.do"  redirect="false"/>
 </action> 
```

有没有办法做到这一点？或者两种形式应该是一样的？

我们尝试的解决方法是通过请求传递东西，但它可能会变得庞大而混乱。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-02-18T21:24:06.557

Tom，使用您的解决方案并结合Vincent Ramdhanie 建议的[ActionRedirect](http://struts.apache.org/1.x/apidocs/org/apache/struts/action/ActionRedirect.html)，我也得到了您想要的。

代码就这么简单，它允许您为每个操作设置单独的表单。

```
ActionRedirect redirect = new ActionRedirect(mapping.findForward("send"));
redirect.addParameter("commonInt", formA.getCommonInt());
return redirect; 
```

```
formB.setCommonInt(request.getParameter("commonInt")); 
```

这最终节省了我的时间并帮助我不必努力直接在 JSP 中更改它，这将是可怕的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T17:12:04.580

实现这一点的方法是对两个操作使用相同的操作表单。您需要两种不同的动作形式是否有特定的原因？如果不尝试将第二个动作映射修改为 name="formA" 并且动作本身使用 FormA 而不是 FormB。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T06:20:31.753

听起来这可能会变得混乱，我会保持简单并使用`ActionForm`only 来存储`Request`数据。

```
public class FormA extends ActionForm {
    public int intA;
    public int commonInt;
} 
```

一旦`Request`提交了数据，就可以直接将数据从会话中取出`ActionForm`并将其填充到会话中的某个位置，或者直接或放入会话中的数据持有者中以维护此类信息。

```
public class ActionTo extends DispatchableAction {
  public ActionForward recv(ActionMapping mapping, ActionForm form, HttpServletRequest request,HttpServletResponse response) {
    FormA form = (FormA)form;

    DataHolder dataHolder = request.getSession().getAttribute("dataHolder");
    dataHolder.setCommonInt(commonInt);
    dataHolder.setIntA(intA);

    return mapping.findForward("send");
  }
} 
```

理想情况下，如果您没有在 Struts 1 上投入大量资金，我会看看 Struts 2。

# svn - 是否可以在没有 SVN 客户端的情况下签入文件或将文件添加到 SVN 存储库？

> ID：849054
> 
> 赞同：2
> 
> 时间：2009-05-11T17:05:20.833
> 
> 标签：svn, upload, client, commit, add

是否可以在没有 SVN 客户端的情况下签入文件或将文件添加到 SVN 存储库？使用浏览器，我能够使用 Apache 访问 SVN 服务器上的文件。如果我在某台计算机上没有 SVN 客户端，我可以添加文件（并提交），例如通过浏览器的“上传文件”功能吗？能够这样做可能很方便。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T17:09:49.733

Apache + SVN 使用 WebDav 访问存储库。您可以使用标准 Web 浏览器浏览存储库的原因是标准 GET 命令获取 svn 文件的列表（和文件）。要添加和提交到存储库，它使用非标准 HTTP 对话的不同命令。

最重要的是，您需要一个支持 SVN 的浏览器才能完成您的要求。我相信实际上有一个 Firefox 插件可以添加这种支持（“颠覆菜单”或类似的东西），但我从未使用过它，因此无法保证它的有用性。

**更新：**它实际上被称为“TortoiseSVN 菜单”，并与您计算机上已经安装的 TortoiseSVN 相关联，所以它不像我想的那样工作。

**更新 2：**如果您对 WebDav 命令感兴趣，我在[http://svn.apache.org/repos/asf/subversion/trunk/notes/http-and-webdav/的文档中找到了详细说明它们的使用webdav 协议](http://svn.apache.org/repos/asf/subversion/trunk/notes/http-and-webdav/webdav-protocol)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:26:49.237

您正在寻找的是[Autoversioning](http://svnbook.red-bean.com/en/1.5/svn.webdav.autoversioning.html)，通过这种方法，用户可以像使用常规网络共享一样使用存储库。更改将自动提交。自然地，您会失去提交评论以及一次形成多个文件的有意义提交的任何能力。

我从未真正使用过该功能。我不认为我会喜欢它。

# mysql - 狮身人面像的mysql查询

> ID：849055
> 
> 赞同：0
> 
> 时间：2009-05-11T17:05:23.407
> 
> 标签：mysql

不知道该怎么做。查询不需要快速执行……它是用于狮身人面像索引的……但它需要包含所有用于搜索的数据。

这是表结构：

```
person
- main_id
- name

person_attritubes
- attribute_id
- name (example: hair, eyes, height)

person_details
- main_id
- attribute_id
- value (example: blond, brown, blue, green, 5'6", 6'5") 
```

如何在一个查询中将所有 person_attritubes.name 作为列，将 person_details.value 作为这些列的行？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T12:57:16.797

找到了另一个解决方案。

is 查询是针对 sphinx 索引的，因此可以将详细信息连接到一列中以进行文本搜索。

```
SELECT 
person.main_id AS id, name,
GROUP_CONCAT(person_details.value SEPARATOR ' ') AS content 
FROM person
INNER JOIN person_details ON (person.main_id = person_details.main_id)
GROUP BY person_details.main_id 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:35:50.440

多次加入 person_details 表。不过，您需要知道属性 ID。

```
SELECT ...,pd1.value AS hair, pd2.value AS eyes FROM person p, person_details pd1, person_details pd2 WHERE p.main_id=pd1.main_id AND pd1.attribute_id=[id for hair] AND p.main_id=pd2.main_id AND pd2.attribute_id=[id for eyes] ...etc... 
```

# python - 是否可以加速 python IO？

> ID：849058
> 
> 赞同：13
> 
> 时间：2009-05-11T17:06:46.837
> 
> 标签：python, linux, performance, text-files

考虑这个 python 程序：

```
import sys

lc = 0
for line in open(sys.argv[1]):
    lc = lc + 1

print lc, sys.argv[1] 
```

在我的 6GB 文本文件上运行它，大约需要 2 分钟。

问题：**有可能走得更快吗？**

请注意，以下情况需要相同的时间：

```
wc -l myfile.txt 
```

所以，我怀疑我的问题的答案只是一个简单的“不”。

另请注意，我的真实程序正在做一些比仅仅计算行数更有趣的事情，所以请给出一个通用的答案，**而不是**行数技巧（比如在文件中保留行数元数据）

PS：我标记了“linux”这个问题，因为我只对特定于 linux 的答案感兴趣。随意给出与操作系统无关的，甚至是其他操作系统的答案，如果你有的话。

另请参阅[后续问题](https://stackoverflow.com/questions/860893/is-python-automagically-parallelizing-io-and-cpu-or-memory-bound-sections)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T19:24:57.657

**把硬件扔到问题上。**

正如 gs 所指出的，您的瓶颈是硬盘传输率。所以，不，你不能用更好的算法来改善你的时间，但你可以买一个更快的硬盘。

**编辑：** gs 的另一个优点；您还可以使用[RAID](http://en.wikipedia.org/wiki/Redundant_array_of_independent_disks)配置来提高速度。这可以通过[硬件](http://www.pcguide.com/ref/hdd/perf/raid/conf/ctrlHardware-c.html)或软件（例如[OS X](http://www.frozennorth.org/C2011481421/E20060221212020/index.html)、[Linux](http://linux-raid.osdl.org/index.php/Linux_Raid)、[Windows Server](http://www.techotopia.com/index.php/Creating_and_Managing_Windows_Server_2008_Striped_(RAID_0)_Volumes)等）来完成。

* * *

**控制方程**

`(Amount to transfer) / (transfer rate) = (time to transfer)`

`(6000 MB) / (60 MB/s) = 100 seconds`

`(6000 MB) / (125 MB/s) = 48 seconds`

* * *

**硬件解决方案**

[ioDrive Duo](http://www.computerworld.com/action/article.do?command=viewArticleBasic&taxonomyName=storage&articleId=9129644&taxonomyId=19&intsrc=kc_top)据说是企业环境中最快的解决方案，“将于 2009 年 4 月上市”。

或者您可以查看 WD Velociraptor 硬盘驱动器 (10,000 rpm)。

此外，我听说 Seagate [Cheetah](http://www.seagate.com/docs/pdf/datasheet/disc/ds_cheetah_15k_5.pdf)是一个不错的选择（15,000 rpm 和持续 125MB/s 的传输速率）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T20:06:39.007

诀窍不是让电子移动得更快（这很难做到），而是在单位时间内完成更多的工作。

首先，确保您读取的 6GB 文件受 I/O 限制，而不是 CPU 限制。

如果它受 I/O 限制，请考虑“扇出”设计模式。

*   一个父进程产生了一堆子进程。

*   父级读取 6Gb 文件，并通过写入子级的 STDIN 管道将行发送给子级。6GB 读取时间将保持不变。行处理应尽可能少地涉及父处理。应该使用非常简单的过滤器或计数。

    管道是用于通信的内存通道。它是一个具有读取器和写入器的共享缓冲区。

*   每个孩子从 STDIN 读取一行，并做适当的工作。每个孩子可能应该编写一个简单的磁盘文件，其中包含最终（汇总，减少）结果。稍后，可以合并这些文件中的结果。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T17:22:22.740

**简单的“不”。**

您几乎已经达到了最大磁盘速度。

我的意思是，您可以[映射](http://docs.python.org/library/mmap.html)文件，或者以二进制块的形式读取它，然后使用`.count('\n')`或其他东西。但这不太可能带来重大改进。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-11T18:53:41.153

您无法获得比最大磁盘读取速度更快的速度。

为了达到最大磁盘速度，您可以使用以下两个技巧：

1.  用大缓冲区读入文件。这可以“手动”编码，也可以简单地使用 io.BufferedReader （在 python2.6+ 中可用）。
2.  在另一个线程中并行计算换行符。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-11T17:30:53.160

如果假设磁盘可以读取 60MB/s，则需要 6000 / 60 = 100 秒，即 1 分 40 秒。我不认为你可以更快，因为磁盘是瓶颈。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T17:33:33.610

正如其他人所说 - “不”

几乎所有的时间都花在等待 IO 上。如果这是您需要多次执行的操作，*并且*您有一台具有大量内存的机器，则可以将文件保存在内存中。如果您的机器有 16GB 的内存，那么 /dev/shm 将有 8GB 可用。

另一种选择：如果你有多台机器，这个问题很容易并行化。将它拆分到多台机器之间，每台机器都计算换行符，然后添加结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-14T00:54:28.877

读取整个 6gb 文件大约需要 2 分钟。你可以对算法或操作系统做很多事情来加快速度。我认为你有两个选择：

1.  花钱解决问题并获得更好的硬件。如果这个项目适合你的工作，这可能是最好的选择。

2.  不要阅读整个文件。我不知道您要对数据做什么，所以也许您别无选择，只能阅读整个内容。另一方面，如果您正在扫描整个文件以查找特定内容，那么在开始时将一些元数据放在那里可能会有所帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T18:55:30.730

请注意，Python I/O 是用 C 实现的，因此进一步加速它的运气并不好。

# php - 文件访问速度与数据库访问速度

> ID：849061
> 
> 赞同：25
> 
> 时间：2009-05-11T17:08:13.543
> 
> 标签：php, database, file-io

我正在用 php 开发的网站在查看的每个页面上都会发出许多 MySQL 数据库请求。尽管许多是具有适当设计的索引的小请求。我不知道是否值得为这些页面开发缓存脚本。

1.  文件 I/O 通常比数据库请求快吗？这取决于服务器吗？有没有办法测试每个服务器可以处理多少个？

2.  其中一个页面检查数据库中的文件名，然后检查服务器以查看它是否存在，然后决定显示什么。我认为这会从缓存的页面视图中受益？

此外，如果有关于这个主题的任何其他信息，您可以转发给我，我们将不胜感激。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T23:22:11.700

如果您正在进行大量读取访问（查找文件名等），您可能会受益于[memcached](http://us2.php.net/memcached)。您可以将“最热门”（最近创建的、最近使用的，取决于您的应用程序）数据存储在内存中，然后仅在缓存未命中时查询数据库（可能还有文件）。内存访问比数据库或文件快得多。

如果您需要大量写入访问，那么数据库就是您的最佳选择。如果您使用 MySQL，请使用 InnoDB 表或其他支持行级锁定的引擎。这将避免人们在其他人写作时阻塞（或者更糟糕的是，无论如何都要写作）。

但最终，这取决于数据。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-11T17:31:15.687

这取决于数据的结构、数据量和更改频率。

如果您的数据量相对较少，相对静态的数据具有相对简单的关系，那么平面文件就是适合这项工作的工具。

当数据之间的连接更复杂时，关系数据库就会出现。对于基本的“查找表”，它们可能有点矫枉过正。

但是，如果数据不断变化，那么使用数据库而不是手动处理配置管理会更容易 - 对于大量数据，使用平面文件，您会遇到额外的问题，即如何找到您需要的一点，高效。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T17:24:23.577

这实际上取决于许多因素。如果你有一个快速的数据库，在 RAM 中缓存了很多数据，或者有一个快速的 RAID 系统，那么很可能你会从 Web 服务器上的简单文件系统缓存中获益良多。还要考虑可扩展性。在高工作负载下，简单的缓存机制可能很容易成为瓶颈，而数据库设计得很好，可以处理高工作负载。
如果请求不多，并且您（或操作系统）能够将缓存保留在 RAM 中，则您可能会获得一些性能。但是现在问题来了，是否真的有必要在低工作负载下执行缓存。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T18:12:51.487

从简单的性能角度来看，调整数据库服务器而不使数据访问逻辑与中间文件缓存复杂化更为明智。如果结果是可缓存的，一个好的数据库服务器会自己进行缓存。（我不确定mysql的情况是什么）。

如果您有性能问题，您应该分析页面以查看真正的瓶颈。即使您像我一样喜欢优化代码，从长远来看，将更强大/更多的硬件放入等式中也会更便宜。

如果您仍需要使用缓存，请考虑使用现有解决方案，例如 memcached。

# flash - 动态创建 Photo-Flow（类似 itune 的导航） - 任何免费或简单的方法来做到这一点？

> ID：849063
> 
> 赞同：2
> 
> 时间：2009-05-11T17:08:40.500
> 
> 标签：flash, actionscript-3

我想知道是否有关于如何制作像[本](http://www.cvcf.com/sermons/)网站顶部一样的照片流的免费脚本或简单教程。

它类似于 iTunes 专辑导航的工作方式。

到目前为止，我发现的只是[这个非免费的照片流](http://www.flashloaded.com/flashcomponents/photoflow/)。我想知道这是否可以在不付任何钱的情况下完成。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T17:39:22.897

您要搜索的是“封面流”。使用 pv3d 构建自己非常容易——这里有一个教程：http://labs.blitzagency.com/?p=314[和](http://labs.blitzagency.com/?p=314)一些 flex 组件： http: [//dougmccune.com/blog/2007/11/03/盖流弹性组件/](http://dougmccune.com/blog/2007/11/03/coverflow-flex-component/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:09:22.100

升级到 CS4 并使用内置的 3D 效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-22T06:43:42.353

我想你可能想看看这个小部件：Smile Widgets - Runway

**类似小部件.org/runway**

它是在 BSD 许可下发布的。

他们拥有的其他小部件也很有趣！微笑小工具

**类似小部件.org**

从他们的网站：

> 这是麻省理工学院 Simile 项目的开源“衍生产品”。在这里，我们提供免费的开源 Web 小部件，主要用于数据可视化。它们由开源开发人员社区随着时间的推移进行维护和改进。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-22T07:53:23.450

您可以放弃 Flash 并使用 JavaScript 实现 Cover Flow 效果。使用 jQuery 或其他库查看[Apple Cover-flow 效果？](https://stackoverflow.com/questions/67207/apple-cover-flow-effect-using-jquery-or-other-library).

史蒂夫

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T07:58:03.487

我在我工作的网站上使用了一个名为 MooFlow 的网站：

[http://www.ownnzproperty.co.nz/](http://www.ownnzproperty.co.nz/)

[http://www.outcut.de/MooFlow/MooFlow.html](http://www.outcut.de/MooFlow/MooFlow.html)

对我来说似乎还不错

需要 Mootools Javascript 框架

# web-services - 如何在 Delphi 中设置 SOAP 元素的属性？

> ID：849068
> 
> 赞同：3
> 
> 时间：2009-05-11T17:09:15.927
> 
> 标签：web-services, delphi, soap, attributes, delphi-2009

在 SOAP 客户端请求中，标头需要以下行：

```
<NS2:Header Name="Foo">Bar<NS2:Header> 
```

所以我写了一个有两个字符串属性的类：

*   Content 属性 - 用于元素的值（“Bar”）
*   Name 属性 - 用于属性的值（“Foo”）

Name 属性的 AS_ATTRIBUTE 标志应该表明它是一个 XML“属性”。

```
 Header = class(TSoapHeader)
   private
     FContent: string;
     FName: string;
   published
     property Content: string read FContent write FContent;
     property Name: string read FName write FName stored AS_ATTRIBUTE;
   end; 
```

并注册

```
 RemClassRegistry.RegisterXSClass(Header, MY_URI);
   RemClassRegistry.RegisterSerializeOptions(Header, [xoLiteralParam, 
xoSimpleTypeWrapper]); 
```

xoLiteralTypWrapper 选项指示该类应仅“包装”元素中的值 Content 属性，而不应为其添加嵌套元素。

对于 Name := "Foo" 和 Content := "Bar"，这将是 SOAP 请求中的结果 XML 代码：

```
<NS2:Header Name="Foo">
   <Content xsi:type="xsd:string">Bar</Content>
</NS2:Header> 
```

该属性位于正确的位置，但内容值位于不应出现在此处的嵌套标记中。如果我从类定义中删除 Name 属性，则 Content 属性将作为元素内容看起来不错，如下所示：

```
<NS2:Header>Bar</NS2:Header> 
```

看起来这两个要求之间有冲突——如果我有属性，我不会得到 xoSimpleTypeWrapper 样式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-06T20:50:56.133

我没有尝试过，所以这是一个猜测。尝试覆盖 ObjectToSOAP 和 SOAPToObject 方法。在帮助文件中它说

> 重写 ObjectToSOAP 以自定义应用程序将 TSOAPHeader 后代转换为其 SOAP 表示的方式。

同样，我没有在编译器上尝试过，但它可能如下所示：

```
function Header.ObjectToSOAP(RootNode, ParentNode: IXMLNode; 
  const ObjConverter: IObjConverter; const Name, URI: InvString; 
  ObjConvOpts: TObjectConvertOptions; out RefID: InvString): IXMLNode;  
begin 
  ObjConvOpts := ObjConvOpts + [ocoDontSerializeProps]; 
  Result := inherited ObjectToSOAP(RootNode, ParentNode, ObjConverter, Name, URI, ObjConvOpts, RefID); 
  Result.Text := FContent; 
  Result.Attributes['Name'] := FName;
end; 
```

# linq - LINQ 与 DataTable.Select - 如何获得相同的结果？

> ID：849073
> 
> 赞同：0
> 
> 时间：2009-05-11T17:10:39.637
> 
> 标签：linq, linq-to-sql

我正在尝试将直接（断开连接的）DataSet.DataTable.Select 重写为 LINQ 以进行文本搜索：

```
string search = "ProductNo like '%" + searchpattern + 
    "%' OR ProductName like '%" + searchpattern + 
    "%' OR Description like '%" + searchpattern +  "%'";

DataSetProducts.sk_productsRow[] dsp = (DataSetProducts.sk_productsRow[])dsProducts.sk_products.Select(search, sort); 
```

这真的很快。但是，如果我在 LINQ 中重新制定它：

```
productlist = from prds in dsProducts.sk_products.AsEnumerable()
    where (prds.Field<string>("productno").Contains(searchpattern) || 
           prds.Field<string>("productname").Contains(searchpattern) || 
           prds.Field<string>("description").Contains(searchpattern))
    select prds; 
```

由于文本操作，它变得非常慢，并且返回的行数要少得多。如何以相同的速度获得相同的结果？我的表中只有约 1000 条记录。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T17:20:08.047

至于为什么它返回更少的行，这是一个区分大小写的问题吗？（即“like”默认不区分大小写；“Contains”默认区分大小写）

如果您在 LINQ to SQL 数据库上下文中运行，请使用 System.Data.Linq.SqlClient.SqlMethods.Like 操作而不是 String.Contains。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T04:48:49.560

我自己从未使用过它，但也许[i4o - 索引 LINQ](http://www.codeplex.com/i4o)可能有助于加快速度......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:20:09.887

您在执行 LINQ 查询与断开连接的数据集时看到速度差异的原因是数据集已经在内存中，而 LINQ 查询是在使用时执行的。

除此之外，如果您还没有安装[LINQ Visualizer](http://weblogs.asp.net/scottgu/archive/2007/07/31/linq-to-sql-debug-visualizer.aspx)，它将向您显示实际正在执行的查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T17:37:57.033

愚蠢的问题，但是 .AsEnumerable() 是否必要？到目前为止，我只对 Linq2Sql 有经验，但我通常会尽可能长时间地将事物视为 AsQueryable，以避免“加载数据集，然后立即将其再次过滤”的情况。

# sql - 在 SQL 中计算给定月份的第一个工作日

> ID：849075
> 
> 赞同：2
> 
> 时间：2009-05-11T17:11:21.197
> 
> 标签：sql, date-arithmetic

我必须计算在一个月的前“N”天支付的所有发票。我有两张桌子

. INVOICE：有发票信息。唯一重要的字段称为“datePayment”

. HOLYDAYS：这是一个单列表。此表中的条目采用“2009-01-01”、2009-05-01 等形式。

我也应该考虑周六和周日（这可能不是问题，因为我可以在 Hollidays 表中插入这些日子，以便在必要时将它们视为 hollidays）

问题是计算哪个是“支付限额”。

```
select count(*) from invoice 
where datePayment  < PAYMENTLIMIT 
```

我的问题是如何计算这个 PAYMENTLIMIT。其中 PAYMENTLIMIT 是“每个月的第五个工作日”。

查询应在 Mysql 和 Oracle 下运行，因此应使用标准 SQL。

有什么提示吗？

编辑为了与问题的标题一致，伪查询应如下所示：

```
select count(*) from invoice 
where datePayment  < FIRST_WORKING_DAY + N 
```

那么问题可以简化为计算每个月的FIRST_WORKING_DAY。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T17:30:45.940

您可以查找一个月中的第一个日期，其中日期不在假期表中并且日期不是周末：

```
select min(datePayment), datepart(mm, datePayment)
from invoices
where datepart(dw, datePayment) not in (1,7) --day of week
and not exists (select holiday from holidays where holiday = datePayment)
group by datepart(mm, datePayment) --monthnr 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:29:34.770

像这样的东西可能会起作用：

```
create function dbo.GetFirstWorkdayOfMonth(@Year INT, @Month INT)
returns DATETIME
as begin
    declare @firstOfMonth VARCHAR(20)
    SET @firstOfMonth = CAST(@Year AS VARCHAR(4)) + '-' + CAST(@Month AS VARCHAR) + '-01'

    declare @currDate DATETIME 
    set @currDate = CAST(@firstOfMonth as DATETIME)

    declare @weekday INT
    set @weekday = DATEPART(weekday, @currdate)

    -- 7 = saturday, 1 = sunday
    while @weekday = 1 OR @weekday = 7
    begin
        set @currDate = DATEADD(DAY, 1, @currDate)
        set @weekday = DATEPART(weekday, @currdate)
    end

    return @currdate
end 
```

我不能 100% 确定“工作日”数字是固定的还是可能取决于 SQL Server 上的区域设置。一探究竟！

马克

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T10:17:42.127

我们使用日历表方法，而不是排除天数的假期表：应用程序每天需要一行（30 年跨度适中的 11K 行）。所以它不仅有一个`is_weekday`专栏，它还有其他与企业相关的东西，例如`julianized_date`。这样，每个可能的日期都会有一个现成的值，`first_working_day_this_month`并且发现它涉及一个简单的查找（SQL 产品往往会针对它进行优化！），而不是每次都在运行中“计算”它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T17:29:49.857

我们的应用程序中有日期表（填充了数十年的所有日期和日期部分），允许各种“缺失”日期操作，例如（在伪 sql 中）：

```
select min(ourdates.datevalue)
from ourdates
where ourdates.year=<given year> and ourdates.month=<given month>
    and ourdates.isworkday
    and not exists (
        select * from holidays
        where holidays.datevalue=ourdates.datevalue
    ) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T17:31:09.230

好的，在第一次尝试时，您可以将以下代码放入 UDF 中，并将年份和月份作为变量传递。然后它可以返回 TestDate，它是该月的第一个工作日。

```
DECLARE @Month INT
DECLARE @Year INT

SELECT @Month = 5
SELECT @Year = 2009

DECLARE @FirstDate DATETIME
SELECT @FirstDate = CONVERT(varchar(4), @Year) + '-' + CONVERT(varchar(2), @Month) + '-' + '01 00:00:00.000'

DROP TABLE #HOLIDAYS
CREATE TABLE #HOLIDAYS (HOLIDAY DateTime)

INSERT INTO #HOLIDAYS VALUES('2009-01-01 00:00:00.000')
INSERT INTO #HOLIDAYS VALUES('2009-05-01 00:00:00.000')

DECLARE @DateFound BIT
SELECT @DateFound = 0
WHILE(@DateFound = 0)
BEGIN
    IF(
        DATEPART(dw, @FirstDate) = 1
        OR
        DATEPART(dw, @FirstDate) = 1
        OR
        EXISTS(SELECT * FROM #HOLIDAYS WHERE HOLIDAY = @FirstDate)
    )
    BEGIN
        SET @FirstDate = DATEADD(dd, 1, @FirstDate)
    END
    ELSE
    BEGIN
        SET @DateFound = 1
    END
END

SELECT @FirstDate 
```

不过，我不喜欢这个解决方案的事情是，如果您的假期表包含一个月中的所有日子，则会出现无限循环。（您可以检查循环是否仍在查看正确的月份）它依赖于相等的日期，例如所有时间都在 00:00:00。最后，我使用字符串连接计算过去一个月的第一天的方式是一种捷径。有更好的方法可以找到该月的实际第一天。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-12T07:49:42.837

获取 2009 年每个月的前 N ​​个工作日：

```
select * from invoices as x
where 
    datePayment between '2009-01-01' and '2009-12-31'

    and exists
    ( 
        select             
                 1
        from invoices
        where
            -- exclude holidays and sunday saturday...
            (
                datepart(dw, datePayment) not in (1,7) -- day of week

                /*
                -- Postgresql and Oracle have programmer-friendly IN clause
                and 
                (datepart(yyyy,datePayment), datepart(mm,datePayment))
                not in (select hyear, hday from holidays) 
                */

                -- this is the MSSQL equivalent of programmer-friendly IN
                and 
                not exists
                (
                    select * from holidays
                    where 
                        hyear = datepart(yyyy,datePayment)
                        and hmonth = datepart(mm, datePayment)
                )                                
            )
            -- ...exclude holidays and sunday saturday

            -- get the month of x datePayment
            and                 
            (datepart(yyyy, datePayment) = datepart(yyyy, x.datePayment)
             and datepart(mm, datePayment) = datepart(mm, x.datePayment)) 

        group by 
            datepart(yyyy, datePayment), datepart(mm, datePayment)    

        having 
            x.datePayment < MIN(datePayment) + @N -- up to N working days
    ) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-08-06T08:26:47.183

返回当月的第一个星期一

```
SELECT DATEADD(
    WEEK,
    DATEDIFF( --x weeks between 1900-01-01 (Monday) and inner result
        WEEK,
        0, --1900-01-01
        DATEADD( --inner result
            DAY,
            6 - DATEPART(DAY, GETDATE()),
            GETDATE()
        )
    ),
    0 --1900-01-01 (Monday)
) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-24T14:55:16.240

```
select if(weekday('yyyy-mm-01') < 5,'yyyy-mm-01',if(weekday('yyyy-mm-02') < 5,'yyyy-mm-02','yyyy-mm-03')) 
```

周六和周日是 5、6，因此您只需两张支票即可获得第一个工作日

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-11-24T15:47:30.833

```
SELECT DATEADD(day, DATEDIFF (day, 0, DATEADD (month, DATEDIFF (month, 0, GETDATE()), 0)  -1)/7*7 + 7, 0); 
```

# security - 如何在不使用 CAPTCHA 组件的情况下防止批量漏洞扫描？

> ID：849077
> 
> 赞同：4
> 
> 时间：2009-05-11T17:11:48.263
> 
> 标签：security

如何防止表单被 XSSME、SQLinjectMe（这两个是免费的 Firefox 插件）、Accunetix Web Scanner 等大型漏洞扫描程序扫描？

这些“网络漏洞扫描程序”可以捕获包含所有字段的表单副本，并在几分钟内发送数千个测试，在字段中引入各种恶意字符串。

即使您很好地清理了您的输入，服务器中的速度响应也会延迟，有时如果表单发送电子邮件，您将在接收方邮箱中收到数千封电子邮件。我知道减少此问题的一种方法是使用 CAPTCHA 组件，但有时这种组件对于某些类型的表单来说太多了并且会延迟用户响应（例如登录/密码表单）。

有什么建议吗？

提前感谢，对不起我的英语！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T17:21:57.437

嗯，如果这是一个主要问题，您可以添加一个服务器端提交率限制器。当有人提交表单时，将一些关于他们的 IP 地址和提交表单的时间的信息存储在数据库中。然后，每当有人提交表单时，检查数据库以查看自该 IP 地址上次提交表单以来是否已经“足够长”。即使是像 10 秒这样相当短的等待也会严重减慢这种自动探测的速度。该数据库可以每天/每小时/每天自动清除，您无需长时间保留数据。

当然，可以访问僵尸网络的人可以避免这个限制器，但是如果您的站点受到大型僵尸网络的攻击，您可能会遇到比这更大的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:20:50.947

你能做的只有这么多......“有志者事竟成”，你希望用户做的任何事情都可以被自动化和滥用。你需要在开发时找到一个中间值，并加入一些可能使滥用变得更难的东西。

您可以做的一件事是使用哈希对表单进行签名，例如，如果表单用于向其他用户发送消息，您可以这样做：

```
hash = md5(userid + action + salt) 
```

那么当你实际处理你会做的响应时

```
if (hash == md5(userid + action + salt)) 
```

这可以防止滥用者注入 1000 个用户 ID 并轻松地向您的系统发送垃圾邮件。它只是攻击者跳过的另一个循环。

我很想听听其他人的技巧。验证码应该用于注册等入口点。上面的方法应该用于对特定事物（消息传递、投票等）的操作。

您也可以创建一个标记系统，并且用户在 X 时间内执行 X 次可能看起来可疑的任何操作都会标记用户，并让他们执行验证码（一旦他们输入验证码，他们就不再被标记）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T17:24:34.280

除了其他人提供的限速解决方案之外，您可能还希望在敏感页面和表单上实现一些日志记录或审核，以确保您的限速确实有效。它可能很简单，例如记录每个 IP 的请求计数。然后，您可以向自己发送每小时或每天的摘要以密切关注事情，而无需反复检查您的网站。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T18:25:46.130

这个问题与其他关于验证码的问题并不完全一样，但我认为如果你还没有阅读它们，那么阅读它们是值得的。“Honey Pot Captcha”听起来可能对你有用。

*   [实用的非基于图像的验证码方法？](https://stackoverflow.com/questions/8472/practical-non-image-based-captcha-approaches)
*   [可以做些什么来防止类似论坛的应用程序中的垃圾邮件？](https://stackoverflow.com/questions/221674/what-can-be-done-to-prevent-spam-in-forum-like-apps)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T00:06:05.910

查看所有答案，我为我的案例定制了一个解决方案，每个答案都有一点：

我再次检查了已知漏洞扫描程序的行为。他们一次加载页面，并使用收集的信息开始提交它，使用恶意脚本更改字段的内容，以验证某些类型的漏洞。

但是：如果我们在表格上签名呢？如何？使用存储在 Session 对象中的随机内容创建隐藏字段。如果该值被提交超过 n 次，我们只需再次创建它。我们只需要检查它是否匹配，以及它是否不只是采取我们想要的行动。

但我们还可以做得更好：为什么要随机更改字段的名称，而不是更改字段的值？是的，随机更改字段名称并将其存储在会话对象中可能是一个更棘手的解决方案，因为表单总是不同的，漏洞扫描程序只加载一次。如果我们没有为具有存储名称的字段输入输入，那么我们就不会处理表单。

我认为这可以节省大量的 CPU 周期。我正在使用问题中提到的漏洞扫描程序进行一些测试，并且效果很好！

好吧，**非常感谢你们所有人**，正如之前所说，这个解决方案是用每个答案的一点点做出的。

# text-editor - 我应该在 VIM 中使用什么折叠？

> ID：849084
> 
> 赞同：7
> 
> 时间：2009-05-11T17:14:00.287
> 
> 标签：text-editor, vim

我通常在 VIM 中编辑 RUBY 文件。我希望方法（def...end）折叠。你能帮我定义折叠语法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-11T18:49:30.287

假设您已经安装了 Ruby 语法高亮设置并开始工作，请使用`syntax`折叠模式：

```
set foldmethod=syntax 
```

这会给你在`class`..`end`和`def`..`end`等上的弃牌。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:54:43.273

我喜欢让所有东西都默认折叠，这里可以让你调整一大堆与折叠相关的东西。我主要做 Perl 和 C++ 编码，我发现它很好用。折叠和展开映射到空格键。

这是我在 vimrc 中的内容：

```
 " Folding stuff
  hi Folded guibg=red guifg=Red cterm=bold ctermbg=DarkGrey ctermfg=lightblue
  hi FoldColumn guibg=grey78 gui=Bold guifg=DarkBlue
  set foldcolumn=2
  set foldclose=
  set foldmethod=indent
  set foldnestmax=10
  set foldlevel=0
  set fillchars=vert:\|,fold:\
  set foldminlines=1
 " Toggle fold state between closed and opened.
  "
  " If there is no fold at current line, just moves forward.
  " If it is present, reverse it's state.
  fu! ToggleFold()
     if foldlevel('.') == 0
         normal! l
     else
         if foldclosed('.') < 0
             . foldclose
         else
             . foldopen
         endif
     endif
     echo
  endf

" Map this function to Space key.
  noremap <space> :call ToggleFold()<CR> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:07:40.003

我认为您将光标放在第一行，然后是 zfnj，其中 n 是要折叠的行数（所以要折叠 10 行，您需要 zf10j）。我认为它也会识别语法，所以就像在 PHP 中我做 zf} 折叠到右括号一样。我不使用 Ruby 编写代码，所以我不知道这是否适用于 Ruby。

从那时起，要切换，zo 将打开，zc 将关闭。

# javascript - 使用 javascript ping webapp 以保持会话打开

> ID：849088
> 
> 赞同：21
> 
> 时间：2009-05-11T17:16:06.557
> 
> 标签：javascript, session, greasemonkey

我正在编写一个greasemonkey 脚本以在我用于工作的webapp 上保持会话打开。您将使用哪个 javascript 命令与服务器创建一些反馈并确保会话不会失败，而不必打扰用户完全刷新页面？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-11T18:47:30.993

我已经使用以下方法解决了这个问题：

```
function keepAlive() {
    var httpRequest = new XMLHttpRequest();
    httpRequest.open('GET', "/restricted_file_url");
    httpRequest.send(null);
}

setInterval(keepAlive, 840000);  //My session expires at 15 minutes 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:22:57.590

## 第二选择

如果您绝对坚持使用 Greasemonkey，`element.click()`那么提交 XMLHTTPrequest 的任何事件上的任何方法都应该这样做。

## 第一选择

如果您愿意使用不需要您编写 Greasemonkey 脚本的解决方案：

[ReloadEvery 3.0.0，作者 Jaap Haitsma](https://addons.mozilla.org/en-US/firefox/addon/115)

这会每隔几秒或几分钟重新加载一次网页。该功能可通过上下文菜单（右键单击网页时获得的菜单）或通过重新加载按钮上的下拉菜单访问。

这不是您所要求的，但除非您只是想提高您的 javascript 技能，否则这可能是解决您的问题的最直接的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-08-30T19:04:36.940

使用 Jesse 的回答中的一些提示，这是完整的代码。

您将需要`@match`使用您网站的域更新参数

```
// ==UserScript==
// @name         Auto session extender
// @namespace    http://obive.net/
// @version      0.2
// @description  Automatically extend server-side session
// @author       Charlie Hayes
// @match        http://obive.net/
// @grant   GM_getValue
// @grant   GM_setValue
// @noframes
// ==/UserScript==

(function() {
    'use strict';

    console.log('The session for this site will be extended automatically via userscript.');

    var minute = 60*1000;
    var refreshTime = 15 * minute;

    var iframe = document.createElement("iframe");
    iframe.style.width = 0;
    iframe.style.height=0;

    var loc = window.location;
    var src = loc.protocol +'//' + loc.host + loc.pathname;
    src += loc.search ? (loc.search + '&') : '?';
    src +=  'sessionextendercachebuster=';

    var reloadIframe = function(){
        var time = new Date().getTime();
        var lastRefresh = GM_getValue('lastRefresh');
        var timeSinceLastRefresh = time - lastRefresh;
        if (!lastRefresh || timeSinceLastRefresh > refreshTime - minute) {
            console.log('Auto-extending session');
            iframe.src = src + time;
            GM_setValue('lastRefresh',time);
            setTimeout(reloadIframe, refreshTime);

            setTimeout(function(){
                // Unload the iframe contents since it might be taking a lot of memory
                iframe.src='about:blank';
            },10000);
        }else{
            console.log('Another tab/window probably refreshed the session, waiting a bit longer');
            setTimeout(reloadIframe, refreshTime - timeSinceLastRefresh - minute);
        }
    };
    setTimeout(reloadIframe, refreshTime);
    document.body.appendChild(iframe);
})(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T17:42:49.600

如果你想编写 JavaScript 来解决这个问题（其他答案要容易得多，我建议你走更简单的路线），这就是我要做的：

*   调用 document.createElement("iframe") 创建一个 iframe
*   将 iframe 的大小设置为 0x0，style.display = "none"，将 ID 设置为某个值，并将 src 属性设置为站点上将扩展您的会话的页面
*   使用 document.body.appendChild 将 iframe 添加到页面
*   使用 setTimeout 刷新 iFrame 使用 window.frames['iframeID'].location.reload(true); 并调用 setTimeout 再次刷新页面。

看看其他答案是否可行，因为使用 JavaScript 似乎比它的价值更麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T17:26:13.060

我绝对可以推荐 dreftymac 建议的解决方案！

如果您不想担心记住单击 reloadevery 选项，那么您的油脂猴子脚本很简单

```
window.location.href = window.location.href 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T17:26:36.867

*这是假设您* ***不*** *想像其他人建议的那样保持页面不断刷新。*

通常，如果您只是想对服务器进行 ping 操作，您可能最好执行一些操作，例如使用您知道远程服务器上存在的图像，并检查它的高度 - 从而产生流量。

**但是**，您的问题（我认为）需要访问网站的某些有限区域，以保持会话处于活动状态......在这种情况下（以及您无法直接 ping 的事实），找到一个页面是“受限制的”并进行 Ajax 调用或类似调用。不要引用我的话，因为我绝不是 JavaScript 专家......只是抛出一个潜在的解决方案。

# authentication - salesforce.com 中的密钥身份验证

> ID：849089
> 
> 赞同：0
> 
> 时间：2009-05-11T17:17:08.613
> 
> 标签：authentication, salesforce

有没有一种好方法可以对从 Salesforce 应用程序到我自己的 Web 服务器的 http 查询进行密钥身份验证？换句话说，我想给每家安装我们应用程序的公司自己的密钥。然后，应用程序对我们的服务器进行的每个 http 调用（无论是 json 还是指向托管 iframe 的链接）都将如下所示：

```
groupid = groupid 
param1 = value1
param2 = value2
signParam = signValue 
```

在哪里`signValue = md5("groupid=groupid,param1=value1,param2=value2,secretKey"`

然后，当我收到查询时，我还会计算签名以确保它匹配，然后再在我们的 Web 服务器上执行任何操作。问题是，我不知道如何为每个安装我们应用程序的公司分配和存储密钥（也就是说，让他们在安装中存储密钥）。

有没有我想念的好方法？如果这在 Salesforce 中是不可能的，那么在您自己的服务器中执行操作之前，您还如何验证 Web 查询？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:24:43.580

与其尝试在 salesforce 端跟踪它，不如让 salesforce 端将用户 sessionId 发送到您的 web 服务，然后您可以使用 API 验证 sessionId 获取有关用户的详细信息，并在本地检查特定用户/组织是否已获得许可. developerforce wiki 上有一些关于使用这种方法的文章。

# silverlight-3.0 - 在 Silverlight MVVM RIA 服务应用程序中放置业务规则的最佳位置在哪里？

> ID：849099
> 
> 赞同：3
> 
> 时间：2009-05-11T17:19:22.243
> 
> 标签：silverlight-3.0, mvvm, wcf-ria-services, business-logic

在 RIA Silverlight 应用程序中放置业务规则的最佳位置在哪里？

我认为域服务将是一个好地方，只是它似乎只与客户端层共享数据。我不认为 ViewModel 是一个好主意，因为我们应该在服务器层有业务规则。

在共享代码中？*.shared.cs?

您将业务规则放在哪里？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T20:30:24.833

您是否尝试过扩展 EF 部分类？EF 类的属性在客户端和服务器上都可用。我不确定这是否是做事的“正确”方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T18:43:04.363

对于 RIA 服务，您的业务逻辑应该在域服务中。

你能举个例子说明这对你来说是个问题吗？

编辑：查看本文档的第 3.3 节：http: [//download.microsoft.com/download/F/B/8/FB8CA635-296B-487F-965C-8148F08B5319/riaservicesoverviewpreview.pdf](http://download.microsoft.com/download/F/B/8/FB8CA635-296B-487F-965C-8148F08B5319/riaservicesoverviewpreview.pdf)

# c# - 什么意思：“客户端异步框架”

> ID：849115
> 
> 赞同：1
> 
> 时间：2009-05-11T17:23:18.230
> 
> 标签：c#, .net, multithreading, asynchronous

我正在查看一份要求了解以下内容的职位：“客户端异步框架”。对于 Microsoft 技术，特别是 .NET 框架，这意味着什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T17:24:41.253

这就是通常所说的[AJAX](http://en.wikipedia.org/wiki/Ajax_(programming))。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T17:24:57.477

我认为它指的是 AJAX 技术，例如[ASP.NET Ajax](http://www.asp.net/ajax/)和[jQuery](http://docs.jquery.com/Ajax)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T17:31:21.757

我会想象在客户端运行的任何东西（或至少一种技术），并且我会在网络上假设：Ajax（jQuery、Prototype、ASP.NET AJAX 等）、Silverlight、Flash、Java FX 等。 .

# firefox - 在 Firefox 中使用 Selenium 时，如何禁用图像和 Flash 加载？

> ID：849116
> 
> 赞同：1
> 
> 时间：2009-05-11T17:23:30.863
> 
> 标签：firefox, nunit, selenium, firefox-3

在 Firefox 3 中通过 Selenium RC 运行 selenium 测试时，启动运行测试的 Firefox 实例始终显示图像，即使我已将 Firefox 3 设置为不显示图像。

有谁知道如何禁用加载图像？

我还想禁止在测试页面上加载 Flash。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T23:21:21.690

当您从命令行启动 selenium RC 时，您可以提供 -firefoxProfileTemplate 的命令行参数，其中 dir 是您希望使用的 Firefox 配置文件的位置。例子：

*java -jar selenium-server.jar -firefoxProfileTemplate "C:\Documents and Settings\YOUR_USERNAME\Application Data\Mozilla\Firefox\Profiles\gj4zmzhp.default"*

然后，您可以使用任何您认为合适的方式配置 Firefox 配置文件。要禁用 Flash，您可以转到 Firefox 中的**工具->附加组件**，然后在**插件**选项卡中禁用**Shockwave Flash**插件。

# windows-mobile - .NET CF 3.5 中的 HttpWebRequest 和 SSL

> ID：849117
> 
> 赞同：2
> 
> 时间：2009-05-11T17:23:36.933
> 
> 标签：windows-mobile, ssl, compact-framework, httpwebrequest, httpwebresponse

我们在 .NET CF 3.5 / Windows Mobile 6 中调用了一些非常简单的 JSON Web 服务，看来我们遇到了这个错误：http: [//blogs.msdn.com/andrewarnottms/archive/2007/ 11/19/why-net-compact-framework-fails-to-call-some-https-web-servers.aspx](http://blogs.msdn.com/andrewarnottms/archive/2007/11/19/why-net-compact-framework-fails-to-call-some-https-web-servers.aspx)

真的快两年后了，这还没有解决吗？似乎是一个很常见的场景，从 .NET CF 3.5 调用安全 Web 服务。 **必须有一些解决方法。任何人都知道是否有解决此问题的方法或解决方法？**

这是我们用来进行调用的代码：

```
private string GetJsonResponse(string command, Dictionary<string, string> parameters)
{
    string requestUri = BuildRequestUri(command, parameters);

    HttpWebRequest webRequest = (HttpWebRequest)HttpWebRequest.Create(requestUri);
    webRequest.AllowWriteStreamBuffering = true;

    cookieManager.PublishCookies(webRequest);
    HttpWebResponse webResponse = (HttpWebResponse)webRequest.GetResponse();

    string jsonResponse = string.Empty;

    using (StreamReader streamReader = new StreamReader(webResponse.GetResponseStream()))
    {
        jsonResponse = streamReader.ReadToEnd();
    }

    webResponse.Close();

    return jsonResponse;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T17:37:47.473

没有发布的修复程序，没有。我相信微软计划在不久的将来对 3.5 进行修复，以便与 Platform Builder QFE 一起发布，但这对 2.0 用户的好处为零，而且我不确定它如何影响不使用 Platform Builder 的 WinMo 开发人员（他们'我们尚未就 CF 的一般可用性 SP 版本发布任何公告）。

解决方法仍然是您引用的博客条目中概述的那些。例如，我们实现了一个全新的基于 SSL 的 Socket（包括将 SSL 库移植到 CF）来绕过它。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2010-11-03T00:58:55.750

你检查 OpenNETCF。有一个免费的社区版。[http://www.opennetcf.com/Products/SmartDeviceFramework/tabid/65/Default.aspx](http://www.opennetcf.com/Products/SmartDeviceFramework/tabid/65/Default.aspx)

# web - 什么工具可以直观地映射现有网站？

> ID：849124
> 
> 赞同：2
> 
> 时间：2009-05-11T17:24:53.187
> 
> 标签：web, sitemap

几个月前，我使用了一个工具来扫描指定的网站并创建网站页面链接的视觉层次结构。它还用适当的屏幕截图表示每个页面。

有谁知道这是什么工具？或者可能具有相同基本功能的东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T17:28:49.280

**刮一下，我找到了**！ [InfoRapid 的知识](http://www.inforapid.de/html/knowledgemapeng.htm) 它产生像谷歌这样的视觉站点地图：

![](https://web.archive.org/web/20070220104638/http://upload.wikimedia.org/wikipedia/en/2/20/Sitemap_google.jpg)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:29:36.860

您可以使用 ：

*   视觉
*   首页

[这里](https://stackoverflow.com/questions/318563/generating-a-visual-site-map-of-an-existing-site)也有类似的问题

# jquery - 如何根据下拉列表是否有选项显示标签？

> ID：849126
> 
> 赞同：1
> 
> 时间：2009-05-11T17:25:08.163
> 
> 标签：jquery, select

我有一个通过外部公司提供的 Javascript 函数填充的下拉列表。它基本上检查输入是否属于有效的邮政编码类型，然后将可能的地址返回到下拉列表中。

一旦下拉列表有一些选项，即找到一些地址并将其填充到选择中，我就如何显示一条小消息。

我试过这个：

```
$(function() {
  function showmsg() {
    if ($("#selectaddress").length > 1)
      $('#buttonhint2').slideDown('normal');
  }
  $("#btnFind").click(showmsg)
}); 
```

但它什么也没做。我对这一切都是新手，所以我不确定我是否在吠叫正确的树。非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:00:47.337

好吧，您可能必须等到该外部函数实际运行其代码。我对这个函数或它在哪里运行一无所知，所以我帮不了你太多。如果它为您提供了一种方法来给它一个回调函数，只需将您拥有的“showmsg”函数传递给它（并在吉米提到的文档就绪语句之外编写）。

如果它不允许回调函数参数并且您知道它在页面加载时运行，您可以将 showmsg 函数延迟 500 毫秒或其他时间。这可能会为第一个脚本运行提供充足的时间（但是，你会想玩这个，直到你做对了）。如果第一个函数使用 AJAX 检索数据，那么您可能需要重新考虑使用该函数或简单地修改此第三方函数（如果许可证允许）以添加回调功能。

您可以将脚本设置为延迟，如下所示：

```
$(function() {
    setTimeout(function() {
        if ($("#selectaddress option").length > 0) {    
            $('#buttonhint2').slideDown('normal');  
        }
    },500);
}); 
```

此外，不要认为您需要检查选择框中的**选项**数量，而不是页面上的选择框数量。而且您之前至少检查了*两个*选项，我提供的脚本检查了至少 1 个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:38:53.477

尝试将您的函数 showmsg() 移到准备好的文档之外：

```
function showmsg() {
  if ($("#selectaddress").length > 1)      
    $('#buttonhint2').slideDown('normal');  
} 
$(function() {   
   $("#btnFind").click(showmsg)
}); 
```

# ruby-on-rails - mod_rails 或 Phusion Passenger 最终是 Ruby on Rails 部署的答案吗？

> ID：849130
> 
> 赞同：14
> 
> 时间：2009-05-11T17:26:44.947
> 
> 标签：ruby-on-rails, ruby, passenger, mod-rails, phusion

我从一些书中读到，Phusion Passenger 是轻松部署 Ruby on Rails 的答案。但是我朋友说先是Apache+一堆Mongrel，然后是lighttpd，然后是nginx，现在是Passenger，好像没完没了……

他还说他使用了使用Passenger的dreamhost，有时他看到他的请求没有得到处理。

所以我想知道Passenger是否是RoR部署的最终答案？您是否使用它并使用“ab”命令来测试站点是否运行良好？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-11T17:48:17.937

简短的回答：是的。

LONG答案：YEEEEEEEEEEEEEESSSSSSSSSSSSSSSS。

说真的，Phusion Passenger 和 Ruby Enterprise Edition 几乎消除了将 Rails 应用程序投入生产的所有痛苦。以前的方法，包括运行一套 Mongrel，需要围绕启动、停止和回收由乘客透明处理的侦听器进程或通过简单的 Apache（或 nginx）配置选项进行大量设置。并且 REE 的互补垃圾收集器意味着分叉一个新的侦听器使用更少的内存，并且启动速度更快（在乘客的“智能”产卵模式下）。

编辑：@srboisvert 提出了一个很好的观点；乘客不是 RoR 部署的最终答案，但目前它是我最喜欢的。有一天，在解决了很多工程难题之后，主流的 Ruby 可能会从使用多进程模型托管 RoR 转向单进程模型，这将比使用Passenger 更容易管理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T21:17:19.703

这是迄今为止最好的解决方案。我开始使用 FCGI 进行部署，这很痛苦。然后是杂种，情况好多了。然后是 mod_rails，它好多了。

还有很多大型酷应用程序正在迁移到 mod_rails，包括一些 37signals，所以你知道这很好。

我将以 DHH 的一句话作为结尾：

> Phusion Passenger 的一体式解决方案
> 
> 一旦您完成了极其简单的安装，您将获得一个 Apache，它同时充当 Web 服务器、负载平衡器、应用程序服务器和进程观察器。您只需放入您的应用程序并在您想要弹回它时触摸 tmp/restart.txt，然后 bam，您就可以启动并运行了。
> 
> 但不知何故，Passenger 的信息接收速度有点慢。已经有大量的大型网站正在运行它。包括 Shopify、MTV、Geni、Yammer，我们将很快完成第一个 Ta-da 列表，然后希望之后能很快完成 37signals 套件的其余部分。
> 
> 因此，尽管仍然有理由运行您自己的手动配置的自定义多层设置，就像有些人因为他们的细节而回避 mod_php，但我认为我们最终确定了一个默认答案。不需要您真正考虑 Rails 应用程序的第一次部署。开箱即用的东西。即使那个盒子是共享主机！
> 
> 总之，Rails 不再难以部署。Phusion Passenger 让它变得非常简单。

（[通过](http://www.loudthinking.com/posts/30-myth-1-rails-is-hard-to-deploy)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T18:20:41.363

是的，它是最简单、最快和最有效的解决方案。在最近的版本中解决了诸如 soap4r 等 gem 的许多问题之后，Passenger 现在是部署问题的答案。

我们在一个平衡的环境中运行 Apache/mod_rails，HAProxy 在 2 个服务器前。它比我们之前使用 Mongrel/Aapache 的设置更可靠。

很容易控制

*   在 Apache 中运行的乘客进程的数量
*   每个应用程序运行的乘客进程数量
*   所有这一切都无需调整大量配置文件，如 mod_proxy、Apache。
*   设置一个虚拟主机并向您的 Apache 配置添加 3 行基本上足以让它运行

马特

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T19:53:53.380

最终答案？没有什么是最终的答案。

我会说乘客是当前的答案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-11T22:55:31.557

是的。自从几周前发布 2.2.0 以来，我一直在 Apache 前面运行 Nginx/Passenger 来解决仍然需要 PHP 的任何问题。尤其是 Ruby 企业版，它接近了我所说的“完美”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T22:06:58.513

我猜现在人们会坚持使用 mod_rails 很多年。模块真的很好。配置非常简单。很难用更好的解决方案代替它。类似于 mod_php。唯一缺少的关键组件：Windows 端口。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T20:32:23.707

在某些情况下（企业等），[JVM](http://blog.headius.com/2009/04/apache-jruby-rails-glassfish-easy.html)也是一个不错的选择。

# python - 如何限制 Django 模型中数值字段的最大值？

> ID：849142
> 
> 赞同：202
> 
> 时间：2009-05-11T17:29:57.330
> 
> 标签：python, django, django-models, numbers

Django 有各种可用于模型的数字字段，例如[DecimalField](http://docs.djangoproject.com/en/dev/ref/models/fields/#decimalfield)和[PositiveIntegerField](http://docs.djangoproject.com/en/dev/ref/models/fields/#positiveintegerfield)。虽然前者可以限制存储的小数位数和存储的字符总数，但有没有办法限制它只存储*一定*范围内的数字，例如 0.0-5.0 ？

如果做不到这一点，有没有办法限制 PositiveIntegerField 只存储例如最多 50 个数字？

***更新：现在 Bug 6845[已经关闭](http://code.djangoproject.com/ticket/6845#comment:71)，这个 StackOverflow 问题可能没有实际意义。- sampablokuper***

* * *

## 回答 #1

> 赞同：445
> 
> 时间：2012-08-19T13:32:39.440

你可以使用[Django 的内置验证器](https://docs.djangoproject.com/en/dev/ref/validators/#built-in-validators)——</p>

```
from django.db.models import IntegerField, Model
from django.core.validators import MaxValueValidator, MinValueValidator

class CoolModelBro(Model):
    limited_integer_field = IntegerField(
        default=1,
        validators=[
            MaxValueValidator(100),
            MinValueValidator(1)
        ]
     ) 
```

**编辑**：直接使用模型时，请确保在保存模型之前调用模型[full_clean](https://docs.djangoproject.com/en/2.2/ref/models/instances/#django.db.models.Model.full_clean)方法以触发验证器。使用时`ModelForm`不需要这样做，因为表单会自动执行此操作。

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2009-05-11T18:31:21.033

您还可以创建自定义模型字段类型 - 请参阅[http://docs.djangoproject.com/en/dev/howto/custom-model-fields/#howto-custom-model-fields](http://docs.djangoproject.com/en/dev/howto/custom-model-fields/#howto-custom-model-fields)

在这种情况下，您可以“继承”内置 IntegerField 并覆盖其验证逻辑。

我越想这个，我意识到这对许多 Django 应用程序有多么有用。也许 IntegerRangeField 类型可以作为补丁提交给 Django 开发人员考虑添加到主干。

这对我有用：

```
from django.db import models

class IntegerRangeField(models.IntegerField):
    def __init__(self, verbose_name=None, name=None, min_value=None, max_value=None, **kwargs):
        self.min_value, self.max_value = min_value, max_value
        models.IntegerField.__init__(self, verbose_name, name, **kwargs)
    def formfield(self, **kwargs):
        defaults = {'min_value': self.min_value, 'max_value':self.max_value}
        defaults.update(kwargs)
        return super(IntegerRangeField, self).formfield(**defaults) 
```

然后在您的模型类中，您将像这样使用它（字段是您放置上述代码的模块）：

```
size = fields.IntegerRangeField(min_value=1, max_value=50) 
```

OR 对于负数和正数范围（如振荡器范围）：

```
size = fields.IntegerRangeField(min_value=-100, max_value=100) 
```

如果可以像这样使用范围运算符调用它，那将是非常酷的：

```
size = fields.IntegerRangeField(range(1, 50)) 
```

但是，这将需要更多代码，因为您可以指定一个“跳过”参数 - range(1, 50, 2) - 不过这个想法很有趣......

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2012-08-19T13:54:25.240

```
from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator

size = models.IntegerField(validators=[MinValueValidator(0),
                                       MaxValueValidator(5)]) 
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2010-10-28T21:38:25.917

我遇到了同样的问题；这是我的解决方案：

```
SCORE_CHOICES = zip( range(1,n), range(1,n) )
score = models.IntegerField(choices=SCORE_CHOICES, blank=True) 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-05-11T17:39:52.023

有两种方法可以做到这一点。一种是使用表单验证，永远不要让用户输入超过 50 的任何数字。[表单验证文档](http://docs.djangoproject.com/en/dev/ref/forms/validation/)。

如果过程中没有用户参与，或者您没有使用表单输入数据，那么您将不得不重写模型的`save`方法以引发异常或限制进入字段的数据。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-17T20:45:53.383

如果您想要一些额外的灵活性并且不想更改模型字段，这是最好的解决方案。只需添加这个自定义验证器：

```
#Imports
from django.core.exceptions import ValidationError      

class validate_range_or_null(object):
    compare = lambda self, a, b, c: a > c or a < b
    clean = lambda self, x: x
    message = ('Ensure this value is between %(limit_min)s and %(limit_max)s (it is %(show_value)s).')
    code = 'limit_value'

    def __init__(self, limit_min, limit_max):
        self.limit_min = limit_min
        self.limit_max = limit_max

    def __call__(self, value):
        cleaned = self.clean(value)
        params = {'limit_min': self.limit_min, 'limit_max': self.limit_max, 'show_value': cleaned}
        if value:  # make it optional, remove it to make required, or make required on the model
            if self.compare(cleaned, self.limit_min, self.limit_max):
                raise ValidationError(self.message, code=self.code, params=params) 
```

它可以这样使用：

```
class YourModel(models.Model):

    ....
    no_dependents = models.PositiveSmallIntegerField("How many dependants?", blank=True, null=True, default=0, validators=[validate_range_or_null(1,100)]) 
```

两个参数是 max 和 min，它允许空值。如果您愿意，您可以自定义验证器，方法是去掉标记的 if 语句或将模型中的字段更改为 blank=False、null=False。这当然需要迁移。

注意：我必须添加验证器，因为 Django 不验证 PositiveSmallIntegerField 上的范围，而是为该字段创建一个 smallint（在 postgres 中），如果指定的数字超出范围，则会出现 DB 错误。

希望这会有所帮助 :) 更多关于[Django 中的验证器](https://docs.djangoproject.com/en/1.7/ref/validators/)。

PS。我的答案基于 django.core.validators 中的 BaseValidator，但除了代码之外，一切都不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-03-13T10:32:33.840

在forms.py

```
Class FloatForm(forms.ModelForm):

    class Meta:
        model = Float
        fields = ('name','country', 'city', 'point', 'year')

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.fields['point'] = forms.FloatField(max_value=100, min_value=1) 
```

# sql - 在 SQL Server Management Studio（2005 或更高版本）中连接不同的 Windows 用户

> ID：849149
> 
> 赞同：358
> 
> 时间：2009-05-11T17:31:21.540
> 
> 标签：sql, sql-server-2008

SQL Server Management Studio 2005（或更高版本）中是否可以更改 Windows 身份验证用户（就像在 SQL Server 2000 和更早版本中一样）？

这是常规连接属性对话框（请注意选择 Windows 身份验证时显示为灰色的 UID/PWD）：

![对话](https://i.stack.imgur.com/ontH5.png)

仅供参考 - 一种解决方法是使用`runas`，但我正在寻找一种解决方案，使我能够跨多个服务器（以及跨多个域）使用多个 Windows 帐户。

* * *

## 回答 #1

> 赞同：445
> 
> 时间：2010-01-20T06:15:19.470

虽然无法在单个 SSMS 实例中以不同用户的身份连接到多个服务器，但您正在寻找的是以下 RUNAS 语法：

```
runas /netonly /user:domain\username program.exe 
```

当您使用“/netonly”开关时，即使没有设置信任，您也可以使用您当前不是其成员的域上的远程凭据登录。它只是告诉 runas 凭据将用于访问远程资源 - 应用程序以当前登录用户的身份与本地计算机交互，并以您已提供其凭据的用户身份与远程计算机交互。

您仍然需要运行多个 SSMS 实例，但至少您可以在每个实例中连接为不同的 Windows 用户。

* * *

例如：`runas /netonly /user:domain\username ssms.exe`

* * *

## 回答 #2

> 赞同：178
> 
> 时间：2011-10-03T19:14:12.457

按住`shift`并右键单击 SQL Server Mangement studion 图标。您可以以其他 Windows 帐户用户身份运行。

* * *

## 回答 #3

> 赞同：131
> 
> 时间：2009-09-17T14:56:39.520

我发现的另一种方法是转到“开始”>“控制面板”>“存储的用户名和密码”（Windows 7 中的管理工具>凭据管理器）并添加您将与“runas”命令一起使用的域帐户.

然后，在 SQL Management Studio 2005 中，只需选择“Windows 身份验证”并输入您要连接的服务器（即使您可以看到灰色的用户仍然是本地用户）......它就可以了！

不要问我为什么！:)

编辑：确保在凭据管理器中的服务器名称后包含“：1433”，否则可能由于不信任域而无法连接。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2014-11-06T20:18:55.110

这些答案都没有满足我的需要：使用与我在本地计算机上登录的域帐户不同的域帐户登录到远程服务器，并且它是跨 vpn 的客户端域。我不想在他们的领域！

相反，在连接到服务器对话框中，选择“Windows 身份验证”，单击“选项”按钮，然后在“附加连接参数”选项卡上，输入

```
user id=domain\user;password=password 
```

SSMS 不会记住，但它会连接到该帐户。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-09-29T20:36:02.253

该`runas /netonly /user:domain\username program.exe`命令仅对我有用`Windows 10`

*   将其保存为批处理文件
*   以管理员身份运行它，

当以普通用户身份运行命令批处理时，我得到了一些用户在之前的评论中提到的错误密码问题。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-05-23T11:13:28.203

对于 Windows 10：转到 Sql Management Studio 图标，或菜单中的快捷方式：右键单击 > 选择打开文件位置

[![在此处输入图像描述](https://i.stack.imgur.com/eXk2n.png)](https://i.stack.imgur.com/eXk2n.png)

按住 Shift 并右键单击文件夹中的快捷方式或 ssms.exe 文件。按住 shift 会给你一个额外的选项“以不同的用户身份运行”：

[![在此处输入图像描述](https://i.stack.imgur.com/FjEML.png)](https://i.stack.imgur.com/FjEML.png)

这将弹出一个登录框，您可以输入您希望会话在其下运行的凭据。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2018-03-24T02:55:20.687

一点 powershell 魔法就可以了：

```
cmdkey /add:"SERVER:1433" /user:"DOMAIN\USERNAME" /pass:"PASSWORD" 
```

然后只需选择Windows身份验证

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-11T18:32:54.403

有很多地方有人可能想要部署这种场景，但由于集成身份验证的工作方式，这是不可能的。

正如 gbn 所提到的，集成身份验证使用与您的 Windows 身份相对应的特殊令牌。有一种称为“模拟”的编码实践（可能由 Run As... 命令使用）允许您以另一个 Windows 用户的身份有效地执行活动，但实际上并没有办法任意充当不同的用户（à la Linux）在 Windows 应用程序中除此之外。

如果您确实需要跨多个域管理多台服务器，您可以考虑以下方法之一：

1.  在您的域之间设置[域信任](http://technet.microsoft.com/en-us/library/cc961481.aspx)，以便您的帐户可以访问信任域中的计算机
2.  在您需要管理的所有服务器上配置 SQL 用户（使用混合身份验证），以便您可以通过这种方式登录；显然，如果您必须在某个时候更改所有密码，这可能会引入一些安全问题并造成维护噩梦。

希望这会有所帮助！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-07-07T16:18:09.977

有没有人尝试过没有参数的“普通”runas？那些 /netonly /savcecred 所有这些听起来都模棱两可，对我来说完全是胡说八道。

```
C:\Windows\System32\runas.exe /user:DOMAINX\OtherUser02 "C:\Program Files (x86)\Microsoft SQL Server Management Studio 18\Common7\IDE\ssms.exe" 
```

这工作得很好。无论如何，runas 都会要求您输入用户密码。只需键入它并符合安全审计要求。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-05-11T18:39:10.477

实现您想要的唯一方法是通过右键单击快捷方式并使用“运行方式”功能打开多个 SSMS 实例。

# jquery - JQuery在提交之前需要复选框和单选按钮

> ID：849155
> 
> 赞同：11
> 
> 时间：2009-05-11T17:36:22.140
> 
> 标签：jquery, forms, validation

我很难弄清楚这一点。3 多个小时以来一直在研究用于 JQuery 验证的示例和工具。

我要做的就是要求选中一个复选框和一个单选按钮，但我不在乎需要哪个。

```
<form id="form1" action="/controller/action" method="post">
    <div class="checkbox"><input type="checkbox" name="box1" class="cBox" /><label for="box1" class="label">Box1</label></div>
    <div class="checkbox"><input type="checkbox" name="Box2" class="cBox" /><label for="Box2" class="label">Box2</label></div>
    <div class="checkbox"><input type="checkbox" name="Box3" class="cBox" /><label for="Box3" class="label">Box3</label></div>
    <div class="radio"><input type="radio" name="print" value="Radio1" class="rad" /><label class="label">Radio1</label></div>
    <div class="radio"><input type="radio" name="print" value="Radio2" class="rad" /><label class="label">Radio2</label></div>
    <div class="radio"><input type="radio" name="print" value="Radio3" class="rad" /><label class="label">Radio3</label></div>
    <input type="submit" value="Submit" />
</form> 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-11T17:49:32.867

为此，您必须使用[`:checked`](http://docs.jquery.com/Selectors/checked)选择器。虽然 JP 的回答很好，但我可能会这样做：

```
$('#form1').submit(function() {
    if ($('input:checkbox', this).is(':checked') &&
        $('input:radio', this).is(':checked')) {
        // everything's fine...
    } else {
        alert('Please select something!');
        return false;
    }
}); 
```

几点注意事项：

*   我认为使用该[`is`](http://docs.jquery.com/Is)函数会更好，该函数返回选择器的布尔值。
*   You can use [`:radio`](http://docs.jquery.com/Selectors/radio) and [`:checkbox`](http://docs.jquery.com/Selectors/checkbox) as a shortcut for selecting all radios and checkboxes in a form. However, [according to the jQuery manual](http://docs.jquery.com/Selectors/checkbox), it is bad practice to use these selectors without specifying `input` before them, as they evaluate to `*:checkbox` and `*:radio` otherwise, which are very slow selectors.
*   By passing `this` as the second argument we are [specifying a context](http://docs.jquery.com/Core/jQuery#expressioncontext) for the search, and thus are only searching for checkboxes and radio inputs inside the current form. Without it we might get false positives if there happens to be another form in the page.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:43:46.977

```
$('#form1').submit(function(){
    if ($(':checkbox:checked', this)[0] && $(':radio:checked', this)[0]) {
        // everything's fine...
    } else {
        alert('Please select something!');
        return false;
    }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-31T04:20:57.177

This worked for me in my case where I want to require users to check a checkbox in order to submit a form.

```
$(document).ready(function(){
        $('#yourinput').required = true;
}); 
```

# c# - 数据中继器中的标签文本

> ID：849156
> 
> 赞同：0
> 
> 时间：2009-05-11T17:36:47.583
> 
> 标签：c#, label, web-controls, datarepeater

当我能够绑定数据并写入我的 html 页面时，我正在尝试在我的数据中继器中使用标签。

```
<asp:Label ID="lblID" runat="server"><%# DataBinder.Eval(Container.DataItem, "ID")%></asp:Label> 
```

效果很好。

当我尝试获取文本值时，我得到“”。

标签 lblcurrentID = ri.FindControl("lblID") 作为标签；

结果：lblcurrentID.text = ""

相同的代码适用于我在数据中继器中的下拉列表。我想知道这是否与将标签转换为跨度标签有关。

```
<span id="template6_middlecontent1mAzoaNominationApproval0_dataReaper_ctl01_lblID">2009040100000888213</span> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-19T15:36:54.493

我以前遇到过这个问题，我不记得实际上找到了解决问题的方法，作为一种变通方法，我使用 an`<asp:HiddenField>`来为我保留信息：

```
<asp:HiddenField runat="server" id="hiddenId" value='<%# Eval("Id") %>' /> 
```

请注意 ' 而不是 " 包装 Eval 语句顺便说一句，.NET 在为服务器控件分配值时很麻烦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-22T15:10:31.393

**你需要绑定 lblD.Text 的值**不喜欢

<%# DataBinder.Eval(Container.DataItem, "ID")%>

# mfc - 单文档项目结构

> ID：849157
> 
> 赞同：0
> 
> 时间：2009-05-11T17:36:59.783
> 
> 标签：mfc

我之前曾询问过访问项目中存在的成员变量的正确方法。在项目中，我有 CWinapp 派生类、CMainFrm 类、不同视图类的列表。但是，目前，我在 CWinApp 派生类中实例化了不同用户定义类的实例，而其余类使用从 AfxGetApp() 函数获得的指针，然后访问不同的用户定义类。MFC 新闻组上的一些社区成员告诉我，这是一个非常糟糕的设计（即父级不应该知道有关应用程序类、视图类或文档类的任何内容）。但是，我不确定如何在不使用这种设计的情况下访问各种用户定义的类。很高兴听到一些建议，因为我对 MFC 不够熟悉，无法提出适当的搜索词。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T12:09:07.493

“（即父级不应该知道任何关于应用程序类、视图类或文档类的信息）”

我不确定我是否理解这句话，这里的“父母”是什么意思？

无论如何，在我看来，您描述的设计并不是真正的问题。这是一个权衡：您是将这些类传递给所有需要它们的函数，使它们的使用和 API 复杂化，还是像您正在做的那样将它们存储为一种全局变量？这取决于访问的数据以及访问频率。许多地方需要的数据也可以是“全球性的”。

有多种方法可以使数据“全局”：使其成为 CWinApp（即您的 CWinApp 派生类）或 CMainFrame 的成员，或者您是否创建一个实际的“全局变量”，或者您是否创建一个单例， ...

全局变量的问题是很难弄清楚谁在何时何地访问它。如果您将数据作为 CWinApp 的成员，您可以通过访问器函数访问它并从那里跟踪访问（通过日志消息、断点等），在我看来，这可以缓解与全局变量相关的大多数问题。我现在通常做的是使用 Loki 单例。

作为解耦问题，在您的帖子中说明的不让数据成为 CWinApp 成员的原因是（在您提出它的上下文中）有点奇怪 imo。如果某些类需要访问，它们无论如何都需要知道这些数据结构，并且它们的存储位置无关紧要。也许只是因为我不知道你的设计细节。

# actionscript-3 - 如何在 actionscript 中创建动态变量 vbox

> ID：849159
> 
> 赞同：0
> 
> 时间：2009-05-11T17:37:09.313
> 
> 标签：actionscript-3, dynamic, variables

我必须在每个循环中创建几个 vbox-es。现在我想做这样的事情。

formsArray["vb"+counter] = new VBox; formsArray["vb"+counter].visible = true;

添加标签等

我无法让这件事发挥作用。有人知道如何为我的 vbox-es 创建动态变量名吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T17:47:29.280

首先，要使用关联数组，您需要使用 Object 而不是 Array（也许您已经是，那么没关系）。

您可以通过以下方式实现您想要做的事情：

```
var vbox:VBox;
var formsArray:Object = new Object();
var counter:int = 0;

for each(<statement>)
{
    vbox = new VBox();
    formsArray[("vb" + counter.toString())] = vbox;
    counter++;
} 
```

VBox 的 visible 属性是`true`默认的，所以不需要显式设置它。

**回答评论中的其他问题：**

你真的不需要使用动态引用来做你想做的事。您最好为此创建一个自定义组件，扩展 VBox 类，方法是创建一个以 VBox 作为根标记的新 MXML 类。这些方面的东西：

```
<mx:VBox ... >

    <mx:Button ... click="btnClickHandler()"/>
    <mx:Script>
        <![CDATA[

            // Toggles visibility of the VBox
            private function btnClickHandler():void
            {
                 visible = !visible;
            }

        ]]>
    </mx:Script>

</mx:VBox> 
```

然后，您可以根据需要实例化尽可能多的自定义 VBox:es。但是，使 VBox 不可见也会使包含的按钮不可见，从而难以再次单击它。:) 你可能想解决这个问题。无论如何，我希望这将为您指明正确的方向。

# javascript - 跳进javascript？

> ID：849166
> 
> 赞同：2
> 
> 时间：2009-05-11T17:37:58.080
> 
> 标签：javascript, frameworks, debugging

### 复制：

> *   [哪个 JavaScript 框架最适合 Web 开发？](https://stackoverflow.com/questions/70946/which-javascript-framework-is-best-for-web-development)
> *   [JavaScript 调试器](https://stackoverflow.com/questions/103155/javascript-debugger)
> *   [其他...](https://stackoverflow.com/search?q=%5Bjavascript%5D+debugger)
> *   [还有更多...](https://stackoverflow.com/search?q=%5Bjavascript%5D+framework)

* * *

我想学习 javascript，但首先很高兴知道那里最好的工具。比如什么是最好的框架工作、调试器、调试方法？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T17:40:55.313

如果你获得了 Firefox 3，然后获得了 Firebug 扩展，那将是最好的开始，不过，它附带的 IE8 的 Web 开发者插件也很不错。

一旦你有了它，你就可以设置断点并更好地解决 javascript 问题。

如果您正在学习 javascript，那么我建议您不要使用框架，而是学习如何在没有任何框架的情况下做您想做的事情，那么，如果您选择一个，您将能够更好地判断它们。

但是，如果您必须使用一个，那么 jQuery 可能是您开始使用的最佳框架。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T17:39:28.577

最好的调试器是[Firebug](http://getfirebug.com/)，一个 Firefox 插件。我不知道没有它我会做什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T17:42:06.437

我个人使用

jQuery 作为我的框架

和 FireBug（一个 firefox 扩展）来调试我的 javascript 和 dom

firebug 还带有一个控制台，因此您可以输出到控制台而不是警报

```
console.log('info');
console.dir({one:1,two:2}); 
```

非常有用:) firebug 也可以让你使用断点

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T17:39:58.107

最佳框架[JQuery](http://jquery.com/)。

最佳调试器[Fire Bug](http://getfirebug.com/)

最佳编辑器，这将是个人喜好，但我使用 Visual Studios。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T17:44:44.713

比如什么是最好的框架工作、调试器、调试方法？

*   框架：[jQuery](http://jquery.com)
*   调试器：[Firebug](http://getfirebug.com)（firefox 插件）
*   调试方法：再次Firebug。单步执行或 console.log。

# c++ - std::vector 元素是否保证是连续的？

> ID：849168
> 
> 赞同：126
> 
> 时间：2009-05-11T17:38:05.037
> 
> 标签：c++, vector, standards

我的问题很简单：`std::vector`元素是否保证是连续的？换句话说，我可以将指向 a 的第一个元素的指针`std::vector`用作 C 数组吗？

如果我没记错的话，C++ 标准并没有做出这样的保证。但是，`std::vector`如果元素不连续，则几乎不可能满足这些要求。

有人可以澄清一下吗？

例子：

```
std::vector<int> values;
// ... fill up values

if( !values.empty() )
{
    int *array = &values[0];
    for( int i = 0; i < values.size(); ++i )
    {
        int v = array[i];
        // do something with 'v'
    }
} 
```

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2009-05-11T17:42:47.057

这在 C++98 标准中被遗漏，但后来作为 TR 的一部分添加。即将发布的 C++0x 标准当然会将此作为要求。

来自 n2798（C++0x 草案）：

> **23.2.6 类模板向量【向量】**
> 
> 1 向量是支持随机访问迭代器的序列容器。此外，它还支持（摊销）恒定时间的最后插入和擦除操作；在中间插入和擦除需要线性时间。存储管理是自动处理的，但可以给出提示以提高效率。向量的元素是连续存储的，这意味着如果 v 是一个向量，其中 T 是除 bool 之外的某种类型，那么对于所有 0 <= n < v，它都遵循恒等式 &v[n] == &v[0] + n 。尺寸（）​​。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-05-11T17:42:11.723

正如其他答案所指出的那样，向量的内容保证是连续的（布尔的怪异除外）。

我想添加的评论是，如果您对向量执行插入或删除操作，这可能导致向量重新分配其内存，那么您将导致所有保存的指针和迭代器无效。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-11T17:40:56.873

该标准确实保证 a`vector`在内存中是连续的，并且`&a[0]`可以传递给`C`需要数组的函数。

这个规则的例外是`vector<bool>`它只使用一个位，`bool`因此尽管它确实有连续的内存，但它不能用作一个`bool*`（这被广泛认为是错误的优化和错误）。

顺便说一句，你为什么不使用迭代器？这就是他们的目的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-12T03:23:10.167

正如其他人已经说过的那样，`vector`内部使用了一个连续的对象数组。只要调用任何非常量成员函数 IIRC，指向该数组的指针都应被视为无效。

但是，有一个例外！！

`vector<bool>`有一个专门的实现，旨在节省空间，因此每个 bool 只使用一位。底层数组不是一个连续的 bool 数组，并且数组算术`vector<bool>`不能正常工作`vector<T>`。

（我想这也可能适用于向量的任何特化，因为我们总是可以实现一个新的。但是，`std::vector<bool>`它是唯一的，错误的，标准的特化，简单的指针算术不起作用。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-12-08T19:52:12.697

我找到了这个线程，因为我有一个用例，其中使用连续内存的向量是一个优势。

我正在学习如何在 OpenGL 中使用顶点缓冲区对象。我创建了一个包装类来包含缓冲区逻辑，所以我需要做的就是传递一个浮点数组和一些配置值来创建缓冲区。我希望能够根据用户输入从函数生成缓冲区，因此在编译时长度是未知的。做这样的事情将是最简单的解决方案：

```
void generate(std::vector<float> v)
{
  float f = generate_next_float();
  v.push_back(f);
} 
```

现在我可以将向量的浮点数作为数组传递给 OpenGL 的缓冲区相关函数。这也消除了使用 sizeof 来确定数组长度的需要。

这比分配一个巨大的数组来存储浮点数并希望我把它做得足够大，或者用连续存储创建我自己的动态数组要好得多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-11T17:39:18.263

是的， std::vector 的元素保证是连续的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-11T17:41:47.403

[cplusplus.com：](http://www.cplusplus.com/reference/stl/vector/)

> 向量容器被实现为动态数组；与常规数组一样，向量容器的元素存储在连续的存储位置，这意味着不仅可以使用迭代器访问它们的元素，还可以使用指向元素的常规指针的偏移量来访问它们的元素。

# php - 递归跟踪深度

> ID：849169
> 
> 赞同：2
> 
> 时间：2009-05-11T17:38:10.310
> 
> 标签：php, recursion

如果不清楚，请耐心等待；我很难完全解决这个问题（因此我在这里寻求帮助）。

我有一个看起来像这样的数组：

```
Array
(
[DimA1] => Array
    (
        [DimB1] => Array
            (
                [DimC1] => Array
                    (
                        [value1] => 13708
                        [value2] => 4.5
                    )

                [DimC2] => Array
                    (
                        [value1] => 1846
                        [value2] => 15.8
                    )

            )

        [DimB2] => Array
            (
                [DimC1] => Array
                    (
                        [value1] => 18166
                        [value2] => 6.4
                    )
            )
[DimA2] => Array
    (
        ....... etc 
```

我需要遍历这个数组，当我到达 value1 和 value2 时，我需要做一些数据库插入。在这个时间点，我需要知道我当前正在单步执行哪些数组，并将它们的键名用作我的数据库插入的一部分。

我目前的解决方案如下所示：

```
public function recurseCounts($array,$dims = array()) {
    foreach ($array as $key => $value) {
        $dims[] = $key;
        if (isset($value['value1']) || isset($value['value2'])) {
            print_r($value); // For debugging...
            print_r($dims); // For debugging...
                            // DB Logic to insert dimensions in to DB here
                            // DB Logic to insert values in to DB here
            array_pop($dims);
        } else {
            $this->recurseCounts($value,$dims);
        }
    }
} 
```

这一直有效，直到循环到达 DimB2，这就是事情开始变得古怪的地方。

关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T17:56:01.420

你总是添加到 $dims。

$dims 现在会去：

```
DimA1
DimA1, DimB1
DimA1, DimB1, DimC1
DimA1, DimB1, DimC2
DimA1, DimB1, DimB2
DimA1, DimB1, DimB2, DimC1
DimA1, DimB1, DimB2, DimC2 
```

如果您将 array_pop 移到外部，则应该没问题。

```
public function recurseCounts($array,$dims = array()) {
    foreach ($array as $key => $value) {
            $dims[] = $key;
            if (isset($value['value1']) || isset($value['value2'])) {
                    print_r($value); // For debugging...
                    print_r($dims); // For debugging...
                        // DB Logic to insert dimensions in to DB here
                        // DB Logic to insert values in to DB here
            } else {
                    $this->recurseCounts($value,$dims);
            }
            array_pop($dims);
    } 
```

}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:43:27.087

您需要跟踪元素的完整路径，因为深度“C”的键是相同的：

```
public function recurseCounts($array,$dims = array(),$path = '') {
        foreach ($array as $key => $value) {
                $dims[] = ($path ? $Path.'_' : '').$key; // Add the full path (separated by '_')
                if (isset($value['value1']) || isset($value['value2'])) {
                        print_r($value); // For debugging...
                        print_r($dims); // For debugging...
                            // DB Logic to insert dimensions in to DB here
                            // DB Logic to insert values in to DB here
                        array_pop($dims);
                } else {
                        $this->recurseCounts($value,$dims,end($depth)); // pass it on
                }
        }
} 
```

# python - 获取用于在 OS X 上启动应用程序包的文档名称

> ID：849172
> 
> 赞同：2
> 
> 时间：2009-05-11T17:39:09.577
> 
> 标签：python, macos

在编写 OS X Bundle 应用程序 (.app) 时，如何获取导致应用程序启动的文档的名称？

假设我已将 .abcd 与 MyApp 相关联，当我单击 foo.abcd MyApp 时启动。如何从 MyApp 中获取 foo.abcd？（命令行参数仅包含进程 ID）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:01:57.103

通常，这些是通过*Apple Events*处理的。具体来说，您的应用程序将收到一个*打开文档*事件。您将如何处理它取决于您正在编写的应用程序类型。

如果您正在编写一个基于文档的应用程序，这很容易：文档控制器接收到一条`openDocumentWithContentsOfURL:display:error:`消息（或`openDocumentWithContentsOfFile:display:`对于之前的 Tiger 系统），并将[相应地处理它](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSDocumentController_Class/Reference/Reference.html#//apple_ref/occ/instm/NSDocumentController/openDocumentWithContentsOfURL:display:error:)。

对于不基于文档的 Cocoa 应用程序，将向应用程序委托发送`application:openFiles:`消息。如果代理没有对此做出响应，它将尝试发送其他消息，直到代理响应一个（按此`openTempFile:`顺序）。`openFiles:``openFile:`

[这是](http://developer.apple.com/documentation/Cocoa/Conceptual/ScriptableCocoaApplications/SApps_handle_AEs/SAppsHandleAEs.html#//apple_ref/doc/uid/20001239-1119823)在 Cocoa 中处理 Open Apple 事件的文档。

对于 Carbon 应用程序，我真的不记得细节（自从我编写 Carbon 代码以来已经有一段时间了），但如果我没记错的话，你会为`kAEOpenDocuments`带有`AEInstallEventHandler()`. 有关更多详细信息，请参阅[文档](http://developer.apple.com/documentation/Carbon/Reference/Apple_Event_Manager/Reference/reference.html#//apple_ref/c/func/AEInstallEventHandler)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T00:01:38.313

看起来您需要一个 GUI 工具包，[idlelib/macosxSupport.py中有一个示例](http://svn.python.org/view/python/trunk/Lib/idlelib/macosxSupport.py?revision=HEAD&view=markup)

```
def doOpenFile(*args):
    for fn in args:
        flist.open(fn)

# The command below is a hook in aquatk that is called whenever the app
# receives a file open event. The callback can have multiple arguments,
# one for every file that should be opened.
root.createcommand("::tk::mac::OpenDocument", doOpenFile) 
```

Qt 也对此[提供支持](http://doc.trolltech.com/qq/qq18-macfeatures.html)。

# c# - 如何将 2 个数据集表结果放在一个 GridView 列中？

> ID：849176
> 
> 赞同：0
> 
> 时间：2009-05-11T17:39:33.833
> 
> 标签：c#, .net, asp.net, html

我有两个来自数据集的结果。我想将两个结果都添加到一个 gridview 列中。我不想在后面的代码中合并。还有另一种方法吗？

```
<asp:TemplateField HeaderText="Entered Date" SortExpression="Date">
                    <ItemTemplate>
                    <div style="text-align: center;">
                        <asp:Label ID="Label3" runat="server" Text='<%# formatDisplayDate(Eval("Date").ToString()) %>'></asp:Label>
                    </div>
                    </ItemTemplate>                    
                </asp:TemplateField> 
```

现在我会返回“04/04/2009”。我想返回“04/04/2009-PASSED”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T17:43:52.110

你有没有尝试过：

```
formatDisplayDate(Eval("Date").ToString()) & "-" & Eval("OtherField").ToString() 
```

如果这不起作用，您应该能够为组合行设置一个 TemplateField，如下所示：

```
<asp:TemplateField HeaderText="CombinedFieldName" SortExpression="CombinedFieldName">
    <ItemTemplate>
       <asp:Label ID="Label1" runat="server" 
       Text='<%# DataBinder.Eval(Container,"DataItem.FirstField") %>' >
       </asp:Label>
       -
       <asp:Label ID="Label2" runat="server" 
       Text='<%# DataBinder.Eval(Container,"DataItem.SecondField") %>' >
       </asp:Label>
        </ItemTemplate>
</asp:TemplateField> 
```

也就是说 - 如果可能的话，在数据库操作中进行字段连接通常效率更高。我还没有测试过，但我认为在 SELECT 中连接会最快，然后在代码隐藏中的数据集中连接，然后在 ASP.Net 页面上组合它们会最慢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:19:48.690

另一种选择是使用 DataColumn.Expression 属性在 DataTable 中创建一个计算列

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T22:09:27.683

我的第一个问题是你为什么不想合并后面的代码？绑定到控件的内容越多，放入该控件视图状态的数据就越多。

@Gary.Ray 有一个非常好的解决方案，但您可能会发现更好的方法是使用 linq 从现有数据集中构建单个数据对象，这样您只包含您需要的内容，并且数据更容易隔离，想想这里的单一责任模式，如果您可以将处理获取数据的代码移动到只处理获取数据的地方，那么您的应用程序将来会很容易维护。

# c# - 如何在 Gtk.TreeView 中捕捉点击？

> ID：849184
> 
> 赞同：4
> 
> 时间：2009-05-11T17:41:17.530
> 
> 标签：c#, gtk, gtk#, gtktreeview

我试图在 TreeView 的空白区域中捕获双击事件以创建新节点。不幸的是，标准方式不起作用。我尝试将 ButtonPressEvent 附加到 TreeView 和托管 TV 的 ScrolledWindow。我的函数没有任何回调。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T18:17:53.600

您需要在处理程序上使用 GLib.ConnectBeforeAttribute 来处理 TreeView.ButtonPressEvent，否则小部件将在内部处理事件并且不会调用您的处理程序。

例子：

```
[GLib.ConnectBefore]
void OnTreeViewButtonPressEvent(object sender, ButtonPressEventArgs e)
{
    if (e.Type == Gdk.EventType.TwoButtonPress)
    {
        // double click
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-06T22:54:03.950

[http://old.nabble.com/CellRenderer-editable-on-double-click-td24975510.html](http://old.nabble.com/CellRenderer-editable-on-double-click-td24975510.html)

```
self.treeview.connect("button-press-event",self.cell_clicked)

def cell_clicked(self, widget, event):
     if event.button == 1 and event.type == gtk.gdk.BUTTON_PRESS:
        print "Double clicked on cell" 
```

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-05-11T17:49:08.937

我认为 Treeview 有自己的窗口。

获取窗口句柄，然后 SendMessage(treeview->Getsafehwnd() , tvi_root, tvichildren)

以上发送信息仅供您理解。

# windows-vista - 将我的应用程序添加到 Vista 的开始搜索

> ID：849198
> 
> 赞同：0
> 
> 时间：2009-05-11T17:44:07.803
> 
> 标签：windows-vista

这不是编程问题。但是这个问题一直困扰着我一段时间。

您知道当您开始在 Vista 开始菜单中的开始搜索框中键入时，应用程序会出现在您可以从中选择它们的列表中。我的问题是如何添加我的应用程序以便它们出现在该列表中。

例如：我使用来自[Sysinternals](http://technet.microsoft.com/en-us/sysinternals/default.aspx)的许多应用程序，例如 Process Explorer、AutoRun 等。我想通过开始输入来启动它们，并且一旦它们出现在列表中就启动应用程序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T17:47:43.227

如果您在安装的开始菜单项中添加它们，那么当您的用户在那里键入时，Vista 将过滤它们。一个简单的事情是在你的开始项目列表中右键单击拖动一个可执行文件，然后说在此处创建快捷方式。

# linux - 为什么我无法启动 Openfire？

> ID：849199
> 
> 赞同：2
> 
> 时间：2009-05-11T17:44:14.123
> 
> 标签：linux, installation

我无法让 Openfire 正常工作。我做了以下事情：

> ```
> [root@jiaoyou logs]# which java
> /usr/bin/java 
> ```

我已经运行了这个命令：

```
ln -s /usr/bin/java /opt/openfire/jre/bin/java 
```

但是在启动 Openfire 时，它​​仍然说：

```
cannot run command `/opt/openfire/jre/bin/java': No such file or directory 
```

这似乎是一个权限问题，但我不知道如何解决。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-23T04:35:19.527

在 CentOS6 64 位中，使用以下命令为我解决了这个问题：

```
cd /opt/openfire/jre/bin
cp java java.bak
rm java
ln -s /usr/bin/java java
service openfire start 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-04T08:13:50.103

如果你在 64 位机器上，你应该为 32 位架构安装 zlib 包。

对于 Redhat/Centos，使用：

百胜安装 -y zlib.i686

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T17:50:36.703

/usr/bin/java 只是一个运行实际二进制文件的 shell 脚本。如果您没有正确设置 JAVA_HOME 环境变量，那么如果通过这样的符号链接调用，它可能无法找到二进制文件。

要记住的另一件事是，即使您没有安装 Sun JRE，某些 Linux 发行版也会将 /usr/bin/java 放在适当的位置。不要费心尝试使用 GNU 版本的 Java，它是垃圾。你知道是否安装了 Sun JRE 吗？“java -version”告诉你什么？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-30T04:17:42.743

我认为正确的答案是使用正确的命令来启动 openfire。我发现“service openfire start”实际上不起作用。

我尝试了上述从 opt/openfire/jre/bin 中删除 java 可执行文件的方法，所做的只是迫​​使我重新配置所有当前的 openfire 设置。感谢上帝，我制作了那个 java.bak 文件。

我相信停止|开始|重新启动的正确方法是从 /opt/openfire/bin 并运行 ./openfire start 或从任何地方“/opt/openfire/bin/openfire start”

至少这对我有用。

# asp.net - 如何从 System.Web.HttpPostedFileBase 转换为 System.Web.HttpPostedFile？

> ID：849200
> 
> 赞同：13
> 
> 时间：2009-05-11T17:44:15.870
> 
> 标签：asp.net, asp.net-mvc, vb.net

在尝试在 Scott Hanselman 的博客上实现 MVC 文件上传[示例时。](http://www.hanselman.com/blog/ABackToBasicsCaseStudyImplementingHTTPFileUploadWithASPNETMVCIncludingTestsAndMocks.aspx)我遇到了这个示例代码的麻烦：

```
foreach (string file in Request.Files)
{
   HttpPostedFile hpf = Request.Files[file] as HttpPostedFile;
   if (hpf.ContentLength == 0)
      continue;
   string savedFileName = Path.Combine(
      AppDomain.CurrentDomain.BaseDirectory, 
      Path.GetFileName(hpf.FileName));
   hpf.SaveAs(savedFileName);
} 
```

我将其转换为 VB.NET：

```
For Each file As String In Request.Files
    Dim hpf As HttpPostedFile = TryCast(Request.Files(file), HttpPostedFile)
    If hpf.ContentLength = 0 Then
        Continue For
    End If
    Dim savedFileName As String = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, Path.GetFileName(hpf.FileName))
    hpf.SaveAs(savedFileName)
Next 
```

但我从编译器得到一个无效的强制转换异常：

```
Value of type 'System.Web.HttpPostedFileBase' cannot be converted to 'System.Web.HttpPostedFile'. 
```

Hanselman 在 2008 年 6 月 27 日发布了他的示例，我认为它当时有效。MSDN 没有任何类似的例子，那么给出了什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-11T17:52:44.157

只需将其用作 HttpPostedFileBase。该框架使用 HttpPostedFileWrapper 将 HttpPostedFile 转换为 HttpPostedFileBase 的对象。HttpPostedFile 是那些难以进行单元测试的密封类之一。我怀疑在编写示例后的某个时间，他们应用了包装器代码来提高在 MVC 框架中测试（使用 HttpPostedFileBase）控制器的能力。对控制器上的 HttpContext、HttpRequest 和 HttpReponse 属性进行了类似的操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T17:48:57.470

要使用的正确类型是 HttpPostedFileBase。

```
HttpPostedFileBase hpf = Request.Files[file]; 
```

# c# - 如何为闭源类型的所有属性注入自定义 UITypeEditor？

> ID：849202
> 
> 赞同：9
> 
> 时间：2009-05-11T17:45:17.117
> 
> 标签：c#, .net, propertygrid, uitypeeditor

我想避免在我为其编写自定义 UITypeEditor 的特定类型的每个实例上放置 EditorAttribute。

我无法在类型上放置 EditorAttribute，因为我无法修改源。

我引用了将要使用的唯一 PropertyGrid 实例。

我可以告诉 PropertyGrid 实例（或所有实例）在遇到特定类型时使用自定义 UITypeEditor 吗？

[这](http://msdn.microsoft.com/en-us/magazine/cc163804.aspx)是一篇 MSDN 文章，提供了如何在 .NET 2.0 或更高版本中执行此操作的起点。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-11T19:56:38.697

您通常可以在运行时通过`TypeDescriptor.AddAttributes`. 例如（该`Bar`属性应显示“...”，显示“正在编辑！”）：

```
using System;
using System.ComponentModel;
using System.Drawing.Design;
using System.Windows.Forms;

class Foo
{
    public Foo() { Bar = new Bar(); }
    public Bar Bar { get; set; }
}
class Bar
{
    public string Value { get; set; }
}

class BarEditor : UITypeEditor
{
    public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext context)
    {
        return UITypeEditorEditStyle.Modal;
    }
    public override object EditValue(ITypeDescriptorContext context, IServiceProvider provider, object value)
    {
        MessageBox.Show("Editing!");
        return base.EditValue(context, provider, value);
    }
}
static class Program
{
    [STAThread]
    static void Main()
    {
        TypeDescriptor.AddAttributes(typeof(Bar),
            new EditorAttribute(typeof(BarEditor), typeof(UITypeEditor)));
        Application.EnableVisualStyles();
        Application.Run(new Form { Controls = { new PropertyGrid { SelectedObject = new Foo() } } });
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-25T16:06:51.880

Marc 的解决方案直言将 EditorAttribute 应用于全局的 Bar 类型。如果您有一个微妙的性格，您可能宁愿注释特定实例的属性。唉，这是不可能的 `TypeDescriptor.AddAttributes`

我的解决方案是编写一个 wrapper `ViewModel<T>`，它从 T 复制属性，用额外的属性注释一些。假设我们有一个`datum`报表类型的变量，我们会像这样使用它

```
 var pretty = ViewModel<Report>.DressUp(datum);
        pretty.PropertyAttributeReplacements[typeof(Smiley)] = new List<Attribute>() { new EditorAttribute(typeof(SmileyEditor),typeof(UITypeEditor))};
        propertyGrid1.SelectedObject = pretty; 
```

在哪里`ViewModel<T>`定义：

```
public class ViewModel<T> : CustomTypeDescriptor
{
    private T _instance;
    private ICustomTypeDescriptor _originalDescriptor;
    public ViewModel(T instance, ICustomTypeDescriptor originalDescriptor) : base(originalDescriptor)
    {
        _instance = instance;
        _originalDescriptor = originalDescriptor;
        PropertyAttributeReplacements = new Dictionary<Type,IList<Attribute>>();
    }

    public static ViewModel<T> DressUp(T instance)
    {
        return new ViewModel<T>(instance, TypeDescriptor.GetProvider(instance).GetTypeDescriptor(instance));
    }

    /// <summary>
    /// Most useful for changing EditorAttribute and TypeConvertorAttribute
    /// </summary>
    public IDictionary<Type,IList<Attribute>> PropertyAttributeReplacements {get; set; } 

    public override PropertyDescriptorCollection GetProperties (Attribute[] attributes)
    {
        var properties = base.GetProperties(attributes).Cast<PropertyDescriptor>();

        var bettered = properties.Select(pd =>
            {
                if (PropertyAttributeReplacements.ContainsKey(pd.PropertyType))
                {
                    return TypeDescriptor.CreateProperty(typeof(T), pd, PropertyAttributeReplacements[pd.PropertyType].ToArray());
                }
                else
                {
                    return pd;
                }
            });
        return new PropertyDescriptorCollection(bettered.ToArray());
    }

    public override PropertyDescriptorCollection GetProperties()
    {
        return GetProperties(null);
    }
} 
```

如上所述，这会替换特定类型的属性，但如果您需要更高的分辨率，可以按名称替换属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:51:02.363

只需将[Editor 属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorattribute.aspx)添加到您的类。

# php - 使用 PHP 从 Windows 应用程序获取输出

> ID：849203
> 
> 赞同：0
> 
> 时间：2009-05-11T17:46:03.870
> 
> 标签：php, windows

我的老板有一个他编写的 Windows 应用程序。它不是一个 Windows 控制台应用程序，而是一个 Windows GUI 应用程序。我们当然有源代码，但他不希望它成为控制台应用程序。他希望它仍然是一个常规的 GUI 应用程序。

问题是，他希望能够从 PHP 调用它，向它传递参数，并让应用程序将信息返回给调用 PHP 脚本。我可以轻松调用 Windows 控制台应用程序并读取输出。我什至可以调用 VBS 脚本并从中获取输出。

但是，我们不知道如何让常规 Windows 应用程序将数据输出到调用 php 脚本，而无需将输出写入文本文件并从 php.ini 中读取。

有没有人能够做到这一点？如果是这样，怎么做？

提前致谢。

艾米

* * *

编辑添加：显然，老板把这段代码放在他的应用程序中：

```
BOOL bConsole = AllocConsole();
 HANDLE hOutput = GetStdHandle(STD_OUTPUT_HANDLE);
 DWORD dwCharsWritten = 0;
 string sS3Path = sCommandLine.substr(sCommandLine.find("S3://") + 5);
 string sMessage = "S3 Path: " + sS3Path;

 BOOL bWritten = WriteConsole(hOutput, sMessage.c_str(), sMessage.size(), &dwCharsWritten, NULL); 
```

但是，php 没有看到他正在写入此控制台的信息。我们尝试了 exec 和 shell_exec 无济于事。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T17:52:57.867

这里最好的方法是添加一个命令行开关，这将使您的应用程序在指定时表现得像控制台应用程序，否则是 GUI。

除非通过标准输出或文件发送输出，否则无法从 GUI 应用程序检索信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:05:27.303

最好的方法是正确地重新构建 Windows GUI 应用程序中的逻辑，使其作为 COM 组件公开。GUI 应用程序和 PHP 脚本都可以调用 COM 组件，并使用相同的逻辑。

在这种情况下，数据交换不需要也可能不应该通过文本进行。您可以通过设置和读取 COM 组件上的类型属性来进行数据交换。

这就是 COM 的用途。PHP 当然有一个成熟的库，用于在 Windows 上调用 COM 组件。

从 Web 应用程序调用 GUI 应用程序是一个非常糟糕的主意。你在问这样做的问题。COM 方法更受欢迎。

更新：[PHP COM 文档](http://us3.php.net/manual/en/ref.com.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-09T21:37:32.817

我们的最终解决方案是让我的老板修改他的 Windows 应用程序。他能够从应用程序中写入控制台，然后我们可以将输出读取到该控制台。

艾米

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:06:51.887

您可以将参数传递给 win 表单应用程序，就像传递给命令行应用程序一样。在 main 方法中使用 arguments 参数。

这将需要对您的 winforms 应用程序进行一些修改，但它允许您从 php 调用 exe，并传入一些参数。

我不确定您的业务需求是什么，但理想情况下，应用程序是用业务域和 GUI 分开编写的，因为您很可能不需要此 cmd 行进程来拥有 winforms 应用程序的所有功能，而是从某些输入产生正确的输出，在不重写任何业务逻辑的情况下实现应用程序的 cmd 版本应该没什么大不了的。

# iphone - 将在线视频流式传输到 iphone 时出现问题

> ID：849204
> 
> 赞同：1
> 
> 时间：2009-05-11T17:46:07.473
> 
> 标签：iphone, video-streaming

我们有一个完整的视频目录，我们希望将其流式传输到 iphone 以便在移动中显示，这将在 iphone 的 safari 浏览器中完成。

由于某种原因，我无法在网上找到任何像样的东西来展示这是如何完成的，我们将视频转换为 iphone 可以看到的格式 .m4v 和 .3gp（均使用 quicktime 转换）

但我不确定如何将视频嵌入网页中，以便 iphone 可以在内置的快速播放器中打开它们。

我尝试了下面的代码，但 safari 返回一个错误，指出“safari 无法下载此文件”

```
<script src="AC_QuickTime.js" language="JavaScript" type="text/javascript"></script> 
<script language="javascript"> 
<!-- 
var ua = navigator.userAgent ;
if (ua.indexOf("iPhone") > 0) document.location.replace("iolliecell.3gp");
self.moveTo(0,0);
self.resizeTo(screen.width,window.screen.availHeight);
//-->
</script> 

<script language="javascript"> 
QT_WriteOBJECT('ollie.mp4', '100%','95%', '', 'autoplay', 'true', 'bgcolor', 'black', 'scale', 'aspect');
</script> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:10:35.670

据我所知，只要它使用某种编解码器（m4v 应该没问题），您就不必做任何事情来使其兼容。iPhone 会相应地处理嵌入标签。将会发生的是它将显示视频区域和该区域中间的播放按钮。单击视频将全屏打开视频播放器。电影结束后，它会返回网页。我将尝试在 Apple 的文档中找到讨论此问题的内容。

[编辑：Apple 在此处](http://developer.apple.com/safari/library/codinghowtos/Mobile/GraphicsMediaAndVisualEffects/index.html)提供有关 Safari 中媒体的信息。希望这可以帮助。

编辑2：这基本上就是你所需要的。

```
<embed src="poster.jpg" href="movie.m4v" type="video/x-m4v" /> 
```

除了点击播放“movie.m4v”外，它还会在网页上显示“poster.jpg”，而不是我之前提到的灰色框。

如果您要为 iPhone 设计 Web 应用程序，您需要注册一个 ADC 帐户。它是免费的，它使您可以访问诸如此类的文档。虽然我发送给您的链接涉及如何添加预览图像，但它引用了更详细的指南，其中讨论了支持的编解码器、使用的比特率、服务器配置等问题。

您可以通过在任何 iPhone/iPod Touch 上访问相关网站并查看其外观来验证此功能是否有效。您甚至可以使用 iPhone 模拟器来执行此操作（也可以免费下载）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T17:54:05.603

您不能在 iPhone 上嵌入视频，只有视频播放器可以“播放视频”，并且需要全屏访问。

# language-agnostic - 点到线段的最短距离

> ID：849211
> 
> 赞同：407
> 
> 时间：2009-05-11T17:47:52.930
> 
> 标签：language-agnostic, geometry, distance, line-segment

我需要一个基本函数来找到点和线段之间的最短距离。随意用您想要的任何语言编写解决方案；我可以把它翻译成我正在使用的（Javascript）。

编辑：我的线段由两个端点定义。所以我的线段`AB`是由两个点`A (x1,y1)`和定义的`B (x2,y2)`。我试图找到这条线段和一个点之间的距离`C (x3,y3)`。我的几何技能生疏了，所以我看到的例子令人困惑，我很抱歉承认。

* * *

## 回答 #1

> 赞同：490
> 
> 时间：2009-10-01T03:18:20.550

~~Eli，您确定的代码不正确。靠近线段所在的线但远离线段一端的点将在靠近线段时被错误地判断。~~ *更新：提到的错误答案不再被接受。*

这是一些正确的代码，用 C++ 编写。它假定一个类 2D-vector `class vec2 {float x,y;}`，本质上，具有加法、减法、缩放等运算符，以及距离和点积函数（即`x1 x2 + y1 y2`）。

```
float minimum_distance(vec2 v, vec2 w, vec2 p) {
  // Return minimum distance between line segment vw and point p
  const float l2 = length_squared(v, w);  // i.e. |w-v|^2 -  avoid a sqrt
  if (l2 == 0.0) return distance(p, v);   // v == w case
  // Consider the line extending the segment, parameterized as v + t (w - v).
  // We find projection of point p onto the line. 
  // It falls where t = [(p-v) . (w-v)] / |w-v|^2
  // We clamp t from [0,1] to handle points outside the segment vw.
  const float t = max(0, min(1, dot(p - v, w - v) / l2));
  const vec2 projection = v + t * (w - v);  // Projection falls on the segment
  return distance(p, projection);
} 
```

编辑：我需要一个 Javascript 实现，所以在这里，没有依赖项（或注释，但它是上述的直接端口）。点表示为具有`x`和`y`属性的对象。

```
function sqr(x) { return x * x }
function dist2(v, w) { return sqr(v.x - w.x) + sqr(v.y - w.y) }
function distToSegmentSquared(p, v, w) {
  var l2 = dist2(v, w);
  if (l2 == 0) return dist2(p, v);
  var t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
  t = Math.max(0, Math.min(1, t));
  return dist2(p, { x: v.x + t * (w.x - v.x),
                    y: v.y + t * (w.y - v.y) });
}
function distToSegment(p, v, w) { return Math.sqrt(distToSegmentSquared(p, v, w)); } 
```

编辑 2：我需要一个 Java 版本，但更重要的是，我需要 3d 而不是 2d。

```
float dist_to_segment_squared(float px, float py, float pz, float lx1, float ly1, float lz1, float lx2, float ly2, float lz2) {
  float line_dist = dist_sq(lx1, ly1, lz1, lx2, ly2, lz2);
  if (line_dist == 0) return dist_sq(px, py, pz, lx1, ly1, lz1);
  float t = ((px - lx1) * (lx2 - lx1) + (py - ly1) * (ly2 - ly1) + (pz - lz1) * (lz2 - lz1)) / line_dist;
  t = constrain(t, 0, 1);
  return dist_sq(px, py, pz, lx1 + t * (lx2 - lx1), ly1 + t * (ly2 - ly1), lz1 + t * (lz2 - lz1));
} 
```

这里，在函数参数中，`<px,py,pz>`是有问题的点，线段有端点`<lx1,ly1,lz1>`和`<lx2,ly2,lz2>`。该函数`dist_sq`（假定存在）找到两点之间距离的平方。

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2011-07-28T03:54:19.413

这是 Javascript 中最简单的完整代码。

x, y 是您的目标点，x1, y1 到 x2, y2 是您的线段。

更新：修复评论中的 0 长度行问题。

```
function pDistance(x, y, x1, y1, x2, y2) {

  var A = x - x1;
  var B = y - y1;
  var C = x2 - x1;
  var D = y2 - y1;

  var dot = A * C + B * D;
  var len_sq = C * C + D * D;
  var param = -1;
  if (len_sq != 0) //in case of 0 length line
      param = dot / len_sq;

  var xx, yy;

  if (param < 0) {
    xx = x1;
    yy = y1;
  }
  else if (param > 1) {
    xx = x2;
    yy = y2;
  }
  else {
    xx = x1 + param * C;
    yy = y1 + param * D;
  }

  var dx = x - xx;
  var dy = y - yy;
  return Math.sqrt(dx * dx + dy * dy);
} 
```

[![帮助可视化解决方案的图像](https://i.stack.imgur.com/sXc2j.png)](https://i.stack.imgur.com/sXc2j.png)

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2010-02-10T00:20:10.263

这是为 FINITE LINE SEGMENTS 实现的，而不是像这里的大多数其他函数那样的无限线（这就是我做这个的原因）。

[Paul Bourke 理论的实施](http://paulbourke.net/geometry/pointlineplane/)。

**Python：**

```
def dist(x1, y1, x2, y2, x3, y3): # x3,y3 is the point
    px = x2-x1
    py = y2-y1

    norm = px*px + py*py

    u =  ((x3 - x1) * px + (y3 - y1) * py) / float(norm)

    if u > 1:
        u = 1
    elif u < 0:
        u = 0

    x = x1 + u * px
    y = y1 + u * py

    dx = x - x3
    dy = y - y3

    # Note: If the actual distance does not matter,
    # if you only want to compare what this function
    # returns to other results of this function, you
    # can just return the squared distance instead
    # (i.e. remove the sqrt) to gain a little performance

    dist = (dx*dx + dy*dy)**.5

    return dist 
```

**AS3：**

```
public static function segmentDistToPoint(segA:Point, segB:Point, p:Point):Number
{
    var p2:Point = new Point(segB.x - segA.x, segB.y - segA.y);
    var something:Number = p2.x*p2.x + p2.y*p2.y;
    var u:Number = ((p.x - segA.x) * p2.x + (p.y - segA.y) * p2.y) / something;

    if (u > 1)
        u = 1;
    else if (u < 0)
        u = 0;

    var x:Number = segA.x + u * p2.x;
    var y:Number = segA.y + u * p2.y;

    var dx:Number = x - p.x;
    var dy:Number = y - p.y;

    var dist:Number = Math.sqrt(dx*dx + dy*dy);

    return dist;
} 
```

**爪哇**

```
private double shortestDistance(float x1,float y1,float x2,float y2,float x3,float y3)
    {
        float px=x2-x1;
        float py=y2-y1;
        float temp=(px*px)+(py*py);
        float u=((x3 - x1) * px + (y3 - y1) * py) / (temp);
        if(u>1){
            u=1;
        }
        else if(u<0){
            u=0;
        }
        float x = x1 + u * px;
        float y = y1 + u * py;

        float dx = x - x3;
        float dy = y - y3;
        double dist = Math.sqrt(dx*dx + dy*dy);
        return dist;

    } 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2010-12-15T08:20:49.013

在我自己的问题线程[中，如何在 C、C#/.NET 2.0 或 Java 的所有情况下计算点和线段之间的最短 2D 距离？](https://stackoverflow.com/questions/4438244/how-to-calculate-shortest-2d-distance-between-a-point-and-a-line-segment-in-all-c)当我找到一个 C# 答案时，我被要求在此处输入：所以在这里，从[http://www.topcoder.com/tc?d1=tutorials&d2=geometry1&module=Static](http://www.topcoder.com/tc?d1=tutorials&d2=geometry1&module=Static)修改：

```
//Compute the dot product AB . BC
private double DotProduct(double[] pointA, double[] pointB, double[] pointC)
{
    double[] AB = new double[2];
    double[] BC = new double[2];
    AB[0] = pointB[0] - pointA[0];
    AB[1] = pointB[1] - pointA[1];
    BC[0] = pointC[0] - pointB[0];
    BC[1] = pointC[1] - pointB[1];
    double dot = AB[0] * BC[0] + AB[1] * BC[1];

    return dot;
}

//Compute the cross product AB x AC
private double CrossProduct(double[] pointA, double[] pointB, double[] pointC)
{
    double[] AB = new double[2];
    double[] AC = new double[2];
    AB[0] = pointB[0] - pointA[0];
    AB[1] = pointB[1] - pointA[1];
    AC[0] = pointC[0] - pointA[0];
    AC[1] = pointC[1] - pointA[1];
    double cross = AB[0] * AC[1] - AB[1] * AC[0];

    return cross;
}

//Compute the distance from A to B
double Distance(double[] pointA, double[] pointB)
{
    double d1 = pointA[0] - pointB[0];
    double d2 = pointA[1] - pointB[1];

    return Math.Sqrt(d1 * d1 + d2 * d2);
}

//Compute the distance from AB to C
//if isSegment is true, AB is a segment, not a line.
double LineToPointDistance2D(double[] pointA, double[] pointB, double[] pointC, 
    bool isSegment)
{
    double dist = CrossProduct(pointA, pointB, pointC) / Distance(pointA, pointB);
    if (isSegment)
    {
        double dot1 = DotProduct(pointA, pointB, pointC);
        if (dot1 > 0) 
            return Distance(pointB, pointC);

        double dot2 = DotProduct(pointB, pointA, pointC);
        if (dot2 > 0) 
            return Distance(pointA, pointC);
    }
    return Math.Abs(dist);
} 
```

我@SO 不回答而是提出问题，所以我希望我不会因为某些原因而获得百万反对票，而是构建评论家。我只是想（并被鼓励）分享其他人的想法，因为这个线程中的解决方案要么使用一些异国语言（Fortran，Mathematica），要么被某人标记为有缺陷。对我来说唯一有用的一个（由 Grumdrig 编写）是用 C++ 编写的，没有人将其标记为错误。但它缺少被调用的方法（点等）。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2012-06-23T20:02:22.767

对于任何感兴趣的人，这里是 Joshua 的 Javascript 代码到 Objective-C 的简单转换：

```
- (double)distanceToPoint:(CGPoint)p fromLineSegmentBetween:(CGPoint)l1 and:(CGPoint)l2
{
    double A = p.x - l1.x;
    double B = p.y - l1.y;
    double C = l2.x - l1.x;
    double D = l2.y - l1.y;

    double dot = A * C + B * D;
    double len_sq = C * C + D * D;
    double param = dot / len_sq;

    double xx, yy;

    if (param < 0 || (l1.x == l2.x && l1.y == l2.y)) {
        xx = l1.x;
        yy = l1.y;
    }
    else if (param > 1) {
        xx = l2.x;
        yy = l2.y;
    }
    else {
        xx = l1.x + param * C;
        yy = l1.y + param * D;
    }

    double dx = p.x - xx;
    double dy = p.y - yy;

    return sqrtf(dx * dx + dy * dy);
} 
```

我需要这个解决方案，`MKMapPoint`所以我会分享它以防其他人需要它。只是一些小的变化，这将返回以米为单位的距离：

```
- (double)distanceToPoint:(MKMapPoint)p fromLineSegmentBetween:(MKMapPoint)l1 and:(MKMapPoint)l2
{
    double A = p.x - l1.x;
    double B = p.y - l1.y;
    double C = l2.x - l1.x;
    double D = l2.y - l1.y;

    double dot = A * C + B * D;
    double len_sq = C * C + D * D;
    double param = dot / len_sq;

    double xx, yy;

    if (param < 0 || (l1.x == l2.x && l1.y == l2.y)) {
        xx = l1.x;
        yy = l1.y;
    }
    else if (param > 1) {
        xx = l2.x;
        yy = l2.y;
    }
    else {
        xx = l1.x + param * C;
        yy = l1.y + param * D;
    }

    return MKMetersBetweenMapPoints(p, MKMapPointMake(xx, yy));
} 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2013-09-29T16:04:46.327

在 F# 中，从点到和`c`之间的线段的距离由下式给出：`a``b`

```
let pointToLineSegmentDistance (a: Vector, b: Vector) (c: Vector) =
  let d = b - a
  let s = d.Length
  let lambda = (c - a) * d / s
  let p = (lambda |> max 0.0 |> min s) * d / s
  (a + p - c).Length 
```

向量`d`从`a`到`b`沿线段。的点积给出`d/s`了`c-a`无限线和点之间最接近点的参数`c`。`min`and`max`函数用于将该参数限制在范围内，`0..s`使该点位于`a`和之间`b`。最后，长度是线段上到最近点`a+p-c`的距离。`c`

示例使用：

```
pointToLineSegmentDistance (Vector(0.0, 0.0), Vector(1.0, 0.0)) (Vector(-1.0, 1.0)) 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2010-11-12T14:54:47.080

## 在数学中

它使用线段的参数描述，并将点投影到线段定义的线中。当参数在线段中从 0 变为 1 时，如果投影超出此范围，我们将计算到相应端点的距离，而不是与线段垂直的直线。

```
Clear["Global`*"];
 distance[{start_, end_}, pt_] := 
   Module[{param},
   param = ((pt - start).(end - start))/Norm[end - start]^2; (*parameter. the "."
                                                       here means vector product*)

   Which[
    param < 0, EuclideanDistance[start, pt],                 (*If outside bounds*)
    param > 1, EuclideanDistance[end, pt],
    True, EuclideanDistance[pt, start + param (end - start)] (*Normal distance*)
    ]
   ]; 
```

绘图结果：

```
Plot3D[distance[{{0, 0}, {1, 0}}, {xp, yp}], {xp, -1, 2}, {yp, -1, 2}] 
```

![替代文字](https://i.stack.imgur.com/twl62.png)

绘制那些比**截止距离**更近的点：

![替代文字](https://i.stack.imgur.com/W6lDO.png)

等高线图：

![在此处输入图像描述](https://i.stack.imgur.com/ri01L.png)

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-05-13T04:56:24.500

嘿，我昨天刚写的。它在 Actionscript 3.0 中，基本上是 Javascript，尽管您可能没有相同的 Point 类。

```
//st = start of line segment
//b = the line segment (as in: st + b = end of line segment)
//pt = point to test
//Returns distance from point to line segment.  
//Note: nearest point on the segment to the test point is right there if we ever need it
public static function linePointDist( st:Point, b:Point, pt:Point ):Number
{
    var nearestPt:Point; //closest point on seqment to pt

    var keyDot:Number = dot( b, pt.subtract( st ) ); //key dot product
    var bLenSq:Number = dot( b, b ); //Segment length squared

    if( keyDot <= 0 )  //pt is "behind" st, use st
    {
        nearestPt = st  
    }
    else if( keyDot >= bLenSq ) //pt is "past" end of segment, use end (notice we are saving twin sqrts here cuz)
    {
        nearestPt = st.add(b);
    }
    else //pt is inside segment, reuse keyDot and bLenSq to get percent of seqment to move in to find closest point
    {
        var keyDotToPctOfB:Number = keyDot/bLenSq; //REM dot product comes squared
        var partOfB:Point = new Point( b.x * keyDotToPctOfB, b.y * keyDotToPctOfB );
        nearestPt = st.add(partOfB);
    }

    var dist:Number = (pt.subtract(nearestPt)).length;

    return dist;
} 
```

此外，这里有一个非常完整且可读的问题讨论：[notejot.com](http://notejot.com/2008/09/distance-from-point-to-line-segment-in-2d/)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2012-08-29T19:59:04.507

对于懒惰的人，这是我上面 @Grumdrig 解决方案的 Objective-C 端口：

```
CGFloat sqr(CGFloat x) { return x*x; }
CGFloat dist2(CGPoint v, CGPoint w) { return sqr(v.x - w.x) + sqr(v.y - w.y); }
CGFloat distanceToSegmentSquared(CGPoint p, CGPoint v, CGPoint w)
{
    CGFloat l2 = dist2(v, w);
    if (l2 == 0.0f) return dist2(p, v);

    CGFloat t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
    if (t < 0.0f) return dist2(p, v);
    if (t > 1.0f) return dist2(p, w);
    return dist2(p, CGPointMake(v.x + t * (w.x - v.x), v.y + t * (w.y - v.y)));
}
CGFloat distanceToSegment(CGPoint point, CGPoint segmentPointV, CGPoint segmentPointW)
{
    return sqrtf(distanceToSegmentSquared(point, segmentPointV, segmentPointW));
} 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-05-14T18:56:09.277

无法抗拒用python对其进行编码:)

```
from math import sqrt, fabs
def pdis(a, b, c):
    t = b[0]-a[0], b[1]-a[1]           # Vector ab
    dd = sqrt(t[0]**2+t[1]**2)         # Length of ab
    t = t[0]/dd, t[1]/dd               # unit vector of ab
    n = -t[1], t[0]                    # normal unit vector to ab
    ac = c[0]-a[0], c[1]-a[1]          # vector ac
    return fabs(ac[0]*n[0]+ac[1]*n[1]) # Projection of ac to n (the minimum distance)

print pdis((1,1), (2,2), (2,0))        # Example (answer is 1.414) 
```

同上 fortran :)

```
real function pdis(a, b, c)
    real, dimension(0:1), intent(in) :: a, b, c
    real, dimension(0:1) :: t, n, ac
    real :: dd
    t = b - a                          ! Vector ab
    dd = sqrt(t(0)**2+t(1)**2)         ! Length of ab
    t = t/dd                           ! unit vector of ab
    n = (/-t(1), t(0)/)                ! normal unit vector to ab
    ac = c - a                         ! vector ac
    pdis = abs(ac(0)*n(0)+ac(1)*n(1))  ! Projection of ac to n (the minimum distance)
end function pdis

program test
    print *, pdis((/1.0,1.0/), (/2.0,2.0/), (/2.0,0.0/))   ! Example (answer is 1.414)
end program test 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2013-11-18T22:37:58.430

使用反正切的一条线解决方案：

想法是将**A**移动到 (0, 0) 并顺时针旋转三角形以使**C**位于 X 轴上，当这种情况发生时，**By**将是距离。

![](https://i.stack.imgur.com/X4FoK.png)

1.  角度 = Atan(Cy - Ay, Cx - Ax);
2.  b 角度 = Atan(By - Ay, Bx - Ax);
3.  AB 长度 = Sqrt( (Bx - Ax)^2 + (By - Ay)^2 )
4.  By = Sin ( bAngle - aAngle) * ABLength

C＃

```
public double Distance(Point a, Point b, Point c)
{
    // normalize points
    Point cn = new Point(c.X - a.X, c.Y - a.Y);
    Point bn = new Point(b.X - a.X, b.Y - a.Y);

    double angle = Math.Atan2(bn.Y, bn.X) - Math.Atan2(cn.Y, cn.X);
    double abLength = Math.Sqrt(bn.X*bn.X + bn.Y*bn.Y);

    return Math.Sin(angle)*abLength;
} 
```

一行C#（要转成SQL）

```
double distance = Math.Sin(Math.Atan2(b.Y - a.Y, b.X - a.X) - Math.Atan2(c.Y - a.Y, c.X - a.X)) * Math.Sqrt((b.X - a.X) * (b.X - a.X) + (b.Y - a.Y) * (b.Y - a.Y)) 
```

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2012-06-08T22:10:46.980

这是 Grumdrig 解决方案的更完整说明。此版本还返回最近点本身。

```
#include "stdio.h"
#include "math.h"

class Vec2
{
public:
    float _x;
    float _y;

    Vec2()
    {
        _x = 0;
        _y = 0;
    }

    Vec2( const float x, const float y )
    {
        _x = x;
        _y = y;
    }

    Vec2 operator+( const Vec2 &v ) const
    {
        return Vec2( this->_x + v._x, this->_y + v._y );
    }

    Vec2 operator-( const Vec2 &v ) const
    {
        return Vec2( this->_x - v._x, this->_y - v._y );
    }

    Vec2 operator*( const float f ) const
    {
        return Vec2( this->_x * f, this->_y * f );
    }

    float DistanceToSquared( const Vec2 p ) const
    {
        const float dX = p._x - this->_x;
        const float dY = p._y - this->_y;

        return dX * dX + dY * dY;
    }

    float DistanceTo( const Vec2 p ) const
    {
        return sqrt( this->DistanceToSquared( p ) );
    }

    float DotProduct( const Vec2 p ) const
    {
        return this->_x * p._x + this->_y * p._y;
    }
};

// return minimum distance between line segment vw and point p, and the closest point on the line segment, q
float DistanceFromLineSegmentToPoint( const Vec2 v, const Vec2 w, const Vec2 p, Vec2 * const q )
{
    const float distSq = v.DistanceToSquared( w ); // i.e. |w-v|^2 ... avoid a sqrt
    if ( distSq == 0.0 )
    {
        // v == w case
        (*q) = v;

        return v.DistanceTo( p );
    }

    // consider the line extending the segment, parameterized as v + t (w - v)
    // we find projection of point p onto the line
    // it falls where t = [(p-v) . (w-v)] / |w-v|^2

    const float t = ( p - v ).DotProduct( w - v ) / distSq;
    if ( t < 0.0 )
    {
        // beyond the v end of the segment
        (*q) = v;

        return v.DistanceTo( p );
    }
    else if ( t > 1.0 )
    {
        // beyond the w end of the segment
        (*q) = w;

        return w.DistanceTo( p );
    }

    // projection falls on the segment
    const Vec2 projection = v + ( ( w - v ) * t );

    (*q) = projection;

    return p.DistanceTo( projection );
}

float DistanceFromLineSegmentToPoint( float segmentX1, float segmentY1, float segmentX2, float segmentY2, float pX, float pY, float *qX, float *qY )
{
    Vec2 q;

    float distance = DistanceFromLineSegmentToPoint( Vec2( segmentX1, segmentY1 ), Vec2( segmentX2, segmentY2 ), Vec2( pX, pY ), &q );

    (*qX) = q._x;
    (*qY) = q._y;

    return distance;
}

void TestDistanceFromLineSegmentToPoint( float segmentX1, float segmentY1, float segmentX2, float segmentY2, float pX, float pY )
{
    float qX;
    float qY;
    float d = DistanceFromLineSegmentToPoint( segmentX1, segmentY1, segmentX2, segmentY2, pX, pY, &qX, &qY );
    printf( "line segment = ( ( %f, %f ), ( %f, %f ) ), p = ( %f, %f ), distance = %f, q = ( %f, %f )\n",
            segmentX1, segmentY1, segmentX2, segmentY2, pX, pY, d, qX, qY );
}

void TestDistanceFromLineSegmentToPoint()
{
    TestDistanceFromLineSegmentToPoint( 0, 0, 1, 1, 1, 0 );
    TestDistanceFromLineSegmentToPoint( 0, 0, 20, 10, 5, 4 );
    TestDistanceFromLineSegmentToPoint( 0, 0, 20, 10, 30, 15 );
    TestDistanceFromLineSegmentToPoint( 0, 0, 20, 10, -30, 15 );
    TestDistanceFromLineSegmentToPoint( 0, 0, 10, 0, 5, 1 );
    TestDistanceFromLineSegmentToPoint( 0, 0, 0, 10, 1, 5 );
} 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-07-11T00:30:56.243

考虑对上述 Grumdrig 答案的修改。很多时候你会发现浮点不精确会导致问题。我在下面的版本中使用双打，但您可以轻松更改为浮点数。重要的部分是它使用 epsilon 来处理“slop”。此外，您会多次想知道交叉点发生在哪里，或者是否发生过。如果返回的 t < 0.0 或 > 1.0，则没有发生碰撞。然而，即使没有发生碰撞，很多时候你会想知道线段上离 P 最近的点在哪里，因此我使用 qx 和 qy 来返回这个位置。

```
double PointSegmentDistanceSquared( double px, double py,
                                    double p1x, double p1y,
                                    double p2x, double p2y,
                                    double& t,
                                    double& qx, double& qy)
{
    static const double kMinSegmentLenSquared = 0.00000001;  // adjust to suit.  If you use float, you'll probably want something like 0.000001f
    static const double kEpsilon = 1.0E-14;  // adjust to suit.  If you use floats, you'll probably want something like 1E-7f
    double dx = p2x - p1x;
    double dy = p2y - p1y;
    double dp1x = px - p1x;
    double dp1y = py - p1y;
    const double segLenSquared = (dx * dx) + (dy * dy);
    if (segLenSquared >= -kMinSegmentLenSquared && segLenSquared <= kMinSegmentLenSquared)
    {
        // segment is a point.
        qx = p1x;
        qy = p1y;
        t = 0.0;
        return ((dp1x * dp1x) + (dp1y * dp1y));
    }
    else
    {
        // Project a line from p to the segment [p1,p2].  By considering the line
        // extending the segment, parameterized as p1 + (t * (p2 - p1)),
        // we find projection of point p onto the line. 
        // It falls where t = [(p - p1) . (p2 - p1)] / |p2 - p1|^2
        t = ((dp1x * dx) + (dp1y * dy)) / segLenSquared;
        if (t < kEpsilon)
        {
            // intersects at or to the "left" of first segment vertex (p1x, p1y).  If t is approximately 0.0, then
            // intersection is at p1\.  If t is less than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t > -kEpsilon)
            {
                // intersects at 1st segment vertex
                t = 0.0;
            }
            // set our 'intersection' point to p1.
            qx = p1x;
            qy = p1y;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then qx would be (p1x + (t * dx)) and qy would be (p1y + (t * dy)).
        }
        else if (t > (1.0 - kEpsilon))
        {
            // intersects at or to the "right" of second segment vertex (p2x, p2y).  If t is approximately 1.0, then
            // intersection is at p2\.  If t is greater than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t < (1.0 + kEpsilon))
            {
                // intersects at 2nd segment vertex
                t = 1.0;
            }
            // set our 'intersection' point to p2.
            qx = p2x;
            qy = p2y;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then qx would be (p1x + (t * dx)) and qy would be (p1y + (t * dy)).
        }
        else
        {
            // The projection of the point to the point on the segment that is perpendicular succeeded and the point
            // is 'within' the bounds of the segment.  Set the intersection point as that projected point.
            qx = p1x + (t * dx);
            qy = p1y + (t * dy);
        }
        // return the squared distance from p to the intersection point.  Note that we return the squared distance
        // as an optimization because many times you just need to compare relative distances and the squared values
        // works fine for that.  If you want the ACTUAL distance, just take the square root of this value.
        double dpqx = px - qx;
        double dpqy = py - qy;
        return ((dpqx * dpqx) + (dpqy * dpqy));
    }
} 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2009-05-11T17:57:41.230

我假设你想找到**最短的**点与线段之间的距离；为此，您需要找到与穿过您的点的线段 (lineB) 垂直的线 (lineA)，确定该线 (lineA) 与穿过线段的线 (lineB) 之间的交点; 如果该点在您的线段的两点之间，那么距离就是您的点与您刚刚找到的点之间的距离，即 lineA 和 lineB 的交点；如果该点不在线段的两点之间，则需要获取点与线段两端较近者之间的距离；这可以通过取点和线段的两个点之间的平方距离（避免平方根）来轻松完成；无论哪个更接近，取那个的平方根。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2014-08-11T00:38:40.003

Grumdrig 的 C++/JavaScript 实现对我非常有用，因此我提供了一个我正在使用的 Python 直接端口。完整的代码在[这里](https://gist.github.com/irees/be5e56e7c9b16d78a351)。

```
class Point(object):
  def __init__(self, x, y):
    self.x = float(x)
    self.y = float(y)

def square(x):
  return x * x

def distance_squared(v, w):
  return square(v.x - w.x) + square(v.y - w.y)

def distance_point_segment_squared(p, v, w):
  # Segment length squared, |w-v|^2
  d2 = distance_squared(v, w) 
  if d2 == 0: 
    # v == w, return distance to v
    return distance_squared(p, v)
  # Consider the line extending the segment, parameterized as v + t (w - v).
  # We find projection of point p onto the line.
  # It falls where t = [(p-v) . (w-v)] / |w-v|^2
  t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / d2;
  if t < 0:
    # Beyond v end of the segment
    return distance_squared(p, v)
  elif t > 1.0:
    # Beyond w end of the segment
    return distance_squared(p, w)
  else:
    # Projection falls on the segment.
    proj = Point(v.x + t * (w.x - v.x), v.y + t * (w.y - v.y))
    # print proj.x, proj.y
    return distance_squared(p, proj) 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2012-05-16T07:27:47.567

现在我的解决方案也是......（Javascript）

它非常快，因为我尽量避免使用任何 Math.pow 函数。

如您所见，在函数的末尾我有线的距离。

*代码来自 lib [http://www.draw2d.org/graphiti/jsdoc/#!/example](http://www.draw2d.org/graphiti/jsdoc/#!/example)*

```
/**
 * Static util function to determine is a point(px,py) on the line(x1,y1,x2,y2)
 * A simple hit test.
 * 
 * @return {boolean}
 * @static
 * @private
 * @param {Number} coronaWidth the accepted corona for the hit test
 * @param {Number} X1 x coordinate of the start point of the line
 * @param {Number} Y1 y coordinate of the start point of the line
 * @param {Number} X2 x coordinate of the end point of the line
 * @param {Number} Y2 y coordinate of the end point of the line
 * @param {Number} px x coordinate of the point to test
 * @param {Number} py y coordinate of the point to test
 **/
graphiti.shape.basic.Line.hit= function( coronaWidth, X1, Y1,  X2,  Y2, px, py)
{
  // Adjust vectors relative to X1,Y1
  // X2,Y2 becomes relative vector from X1,Y1 to end of segment
  X2 -= X1;
  Y2 -= Y1;
  // px,py becomes relative vector from X1,Y1 to test point
  px -= X1;
  py -= Y1;
  var dotprod = px * X2 + py * Y2;
  var projlenSq;
  if (dotprod <= 0.0) {
      // px,py is on the side of X1,Y1 away from X2,Y2
      // distance to segment is length of px,py vector
      // "length of its (clipped) projection" is now 0.0
      projlenSq = 0.0;
  } else {
      // switch to backwards vectors relative to X2,Y2
      // X2,Y2 are already the negative of X1,Y1=>X2,Y2
      // to get px,py to be the negative of px,py=>X2,Y2
      // the dot product of two negated vectors is the same
      // as the dot product of the two normal vectors
      px = X2 - px;
      py = Y2 - py;
      dotprod = px * X2 + py * Y2;
      if (dotprod <= 0.0) {
          // px,py is on the side of X2,Y2 away from X1,Y1
          // distance to segment is length of (backwards) px,py vector
          // "length of its (clipped) projection" is now 0.0
          projlenSq = 0.0;
      } else {
          // px,py is between X1,Y1 and X2,Y2
          // dotprod is the length of the px,py vector
          // projected on the X2,Y2=>X1,Y1 vector times the
          // length of the X2,Y2=>X1,Y1 vector
          projlenSq = dotprod * dotprod / (X2 * X2 + Y2 * Y2);
      }
  }
    // Distance to line is now the length of the relative point
    // vector minus the length of its projection onto the line
    // (which is zero if the projection falls outside the range
    //  of the line segment).
    var lenSq = px * px + py * py - projlenSq;
    if (lenSq < 0) {
        lenSq = 0;
    }
    return Math.sqrt(lenSq)<coronaWidth;
}; 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2015-01-02T03:33:07.533

这里使用的是 Swift

```
 /* Distance from a point (p1) to line l1 l2 */
func distanceFromPoint(p: CGPoint, toLineSegment l1: CGPoint, and l2: CGPoint) -> CGFloat {
    let A = p.x - l1.x
    let B = p.y - l1.y
    let C = l2.x - l1.x
    let D = l2.y - l1.y

    let dot = A * C + B * D
    let len_sq = C * C + D * D
    let param = dot / len_sq

    var xx, yy: CGFloat

    if param < 0 || (l1.x == l2.x && l1.y == l2.y) {
        xx = l1.x
        yy = l1.y
    } else if param > 1 {
        xx = l2.x
        yy = l2.y
    } else {
        xx = l1.x + param * C
        yy = l1.y + param * D
    }

    let dx = p.x - xx
    let dy = p.y - yy

    return sqrt(dx * dx + dy * dy)
} 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-02-28T06:17:25.497

Matlab 代码，如果他们调用不带参数的函数，则带有内置的“自检”：

```
function r = distPointToLineSegment( xy0, xy1, xyP )
% r = distPointToLineSegment( xy0, xy1, xyP )

if( nargin < 3 )
    selfTest();
    r=0;
else
    vx = xy0(1)-xyP(1);
    vy = xy0(2)-xyP(2);
    ux = xy1(1)-xy0(1);
    uy = xy1(2)-xy0(2);
    lenSqr= (ux*ux+uy*uy);
    detP= -vx*ux + -vy*uy;

    if( detP < 0 )
        r = norm(xy0-xyP,2);
    elseif( detP > lenSqr )
        r = norm(xy1-xyP,2);
    else
        r = abs(ux*vy-uy*vx)/sqrt(lenSqr);
    end
end

    function selfTest()
        %#ok<*NASGU>
        disp(['invalid args, distPointToLineSegment running (recursive)  self-test...']);

        ptA = [1;1]; ptB = [-1;-1];
        ptC = [1/2;1/2];  % on the line
        ptD = [-2;-1.5];  % too far from line segment
        ptE = [1/2;0];    % should be same as perpendicular distance to line
        ptF = [1.5;1.5];      % along the A-B but outside of the segment

        distCtoAB = distPointToLineSegment(ptA,ptB,ptC)
        distDtoAB = distPointToLineSegment(ptA,ptB,ptD)
        distEtoAB = distPointToLineSegment(ptA,ptB,ptE)
        distFtoAB = distPointToLineSegment(ptA,ptB,ptF)
        figure(1); clf;
        circle = @(x, y, r, c) rectangle('Position', [x-r, y-r, 2*r, 2*r], ...
            'Curvature', [1 1], 'EdgeColor', c);
        plot([ptA(1) ptB(1)],[ptA(2) ptB(2)],'r-x'); hold on;
        plot(ptC(1),ptC(2),'b+'); circle(ptC(1),ptC(2), 0.5e-1, 'b');
        plot(ptD(1),ptD(2),'g+'); circle(ptD(1),ptD(2), distDtoAB, 'g');
        plot(ptE(1),ptE(2),'k+'); circle(ptE(1),ptE(2), distEtoAB, 'k');
        plot(ptF(1),ptF(2),'m+'); circle(ptF(1),ptF(2), distFtoAB, 'm');
        hold off;
        axis([-3 3 -3 3]); axis equal;
    end

end 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2016-03-04T17:17:51.183

**C＃**

改编自[@Grumdrig](https://stackoverflow.com/a/1501725/365102)

```
public static double MinimumDistanceToLineSegment(this Point p,
    Line line)
{
    var v = line.StartPoint;
    var w = line.EndPoint;

    double lengthSquared = DistanceSquared(v, w);

    if (lengthSquared == 0.0)
        return Distance(p, v);

    double t = Math.Max(0, Math.Min(1, DotProduct(p - v, w - v) / lengthSquared));
    var projection = v + t * (w - v);

    return Distance(p, projection);
}

public static double Distance(Point a, Point b)
{
    return Math.Sqrt(DistanceSquared(a, b));
}

public static double DistanceSquared(Point a, Point b)
{
    var d = a - b;
    return DotProduct(d, d);
}

public static double DotProduct(Point a, Point b)
{
    return (a.X * b.X) + (a.Y * b.Y);
} 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2013-04-01T06:53:55.653

看起来 StackOverflow 上的其他人几乎都提供了答案（到目前为止有 23 个答案），所以这是我对 C# 的贡献。这主要基于 M. Katz 的回答，而 M. Katz 又基于 Grumdrig 的回答。

```
 public struct MyVector
   {
      private readonly double _x, _y;

      // Constructor
      public MyVector(double x, double y)
      {
         _x = x;
         _y = y;
      }

      // Distance from this point to another point, squared
      private double DistanceSquared(MyVector otherPoint)
      {
         double dx = otherPoint._x - this._x;
         double dy = otherPoint._y - this._y;
         return dx * dx + dy * dy;
      }

      // Find the distance from this point to a line segment (which is not the same as from this 
      //  point to anywhere on an infinite line). Also returns the closest point.
      public double DistanceToLineSegment(MyVector lineSegmentPoint1, MyVector lineSegmentPoint2,
                                          out MyVector closestPoint)
      {
         return Math.Sqrt(DistanceToLineSegmentSquared(lineSegmentPoint1, lineSegmentPoint2, 
                          out closestPoint));
      }

      // Same as above, but avoid using Sqrt(), saves a new nanoseconds in cases where you only want 
      //  to compare several distances to find the smallest or largest, but don't need the distance
      public double DistanceToLineSegmentSquared(MyVector lineSegmentPoint1, 
                                              MyVector lineSegmentPoint2, out MyVector closestPoint)
      {
         // Compute length of line segment (squared) and handle special case of coincident points
         double segmentLengthSquared = lineSegmentPoint1.DistanceSquared(lineSegmentPoint2);
         if (segmentLengthSquared < 1E-7f)  // Arbitrary "close enough for government work" value
         {
            closestPoint = lineSegmentPoint1;
            return this.DistanceSquared(closestPoint);
         }

         // Use the magic formula to compute the "projection" of this point on the infinite line
         MyVector lineSegment = lineSegmentPoint2 - lineSegmentPoint1;
         double t = (this - lineSegmentPoint1).DotProduct(lineSegment) / segmentLengthSquared;

         // Handle the two cases where the projection is not on the line segment, and the case where 
         //  the projection is on the segment
         if (t <= 0)
            closestPoint = lineSegmentPoint1;
         else if (t >= 1)
            closestPoint = lineSegmentPoint2;
         else 
            closestPoint = lineSegmentPoint1 + (lineSegment * t);
         return this.DistanceSquared(closestPoint);
      }

      public double DotProduct(MyVector otherVector)
      {
         return this._x * otherVector._x + this._y * otherVector._y;
      }

      public static MyVector operator +(MyVector leftVector, MyVector rightVector)
      {
         return new MyVector(leftVector._x + rightVector._x, leftVector._y + rightVector._y);
      }

      public static MyVector operator -(MyVector leftVector, MyVector rightVector)
      {
         return new MyVector(leftVector._x - rightVector._x, leftVector._y - rightVector._y);
      }

      public static MyVector operator *(MyVector aVector, double aScalar)
      {
         return new MyVector(aVector._x * aScalar, aVector._y * aScalar);
      }

      // Added using ReSharper due to CodeAnalysis nagging

      public bool Equals(MyVector other)
      {
         return _x.Equals(other._x) && _y.Equals(other._y);
      }

      public override bool Equals(object obj)
      {
         if (ReferenceEquals(null, obj)) return false;
         return obj is MyVector && Equals((MyVector) obj);
      }

      public override int GetHashCode()
      {
         unchecked
         {
            return (_x.GetHashCode()*397) ^ _y.GetHashCode();
         }
      }

      public static bool operator ==(MyVector left, MyVector right)
      {
         return left.Equals(right);
      }

      public static bool operator !=(MyVector left, MyVector right)
      {
         return !left.Equals(right);
      }
   } 
```

这是一个小测试程序。

```
 public static class JustTesting
   {
      public static void Main()
      {
         Stopwatch stopwatch = new Stopwatch();
         stopwatch.Start();

         for (int i = 0; i < 10000000; i++)
         {
            TestIt(1, 0, 0, 0, 1, 1, 0.70710678118654757);
            TestIt(5, 4, 0, 0, 20, 10, 1.3416407864998738);
            TestIt(30, 15, 0, 0, 20, 10, 11.180339887498949);
            TestIt(-30, 15, 0, 0, 20, 10, 33.541019662496844);
            TestIt(5, 1, 0, 0, 10, 0, 1.0);
            TestIt(1, 5, 0, 0, 0, 10, 1.0);
         }

         stopwatch.Stop();
         TimeSpan timeSpan = stopwatch.Elapsed;
      }

      private static void TestIt(float aPointX, float aPointY, 
                                 float lineSegmentPoint1X, float lineSegmentPoint1Y, 
                                 float lineSegmentPoint2X, float lineSegmentPoint2Y, 
                                 double expectedAnswer)
      {
         // Katz
         double d1 = DistanceFromPointToLineSegment(new MyVector(aPointX, aPointY), 
                                              new MyVector(lineSegmentPoint1X, lineSegmentPoint1Y), 
                                              new MyVector(lineSegmentPoint2X, lineSegmentPoint2Y));
         Debug.Assert(d1 == expectedAnswer);

         /*
         // Katz using squared distance
         double d2 = DistanceFromPointToLineSegmentSquared(new MyVector(aPointX, aPointY), 
                                              new MyVector(lineSegmentPoint1X, lineSegmentPoint1Y), 
                                              new MyVector(lineSegmentPoint2X, lineSegmentPoint2Y));
         Debug.Assert(Math.Abs(d2 - expectedAnswer * expectedAnswer) < 1E-7f);
          */

         /*
         // Matti (optimized)
         double d3 = FloatVector.DistanceToLineSegment(new PointF(aPointX, aPointY), 
                                                new PointF(lineSegmentPoint1X, lineSegmentPoint1Y), 
                                                new PointF(lineSegmentPoint2X, lineSegmentPoint2Y));
         Debug.Assert(Math.Abs(d3 - expectedAnswer) < 1E-7f);
          */
      }

      private static double DistanceFromPointToLineSegment(MyVector aPoint, 
                                             MyVector lineSegmentPoint1, MyVector lineSegmentPoint2)
      {
         MyVector closestPoint;  // Not used
         return aPoint.DistanceToLineSegment(lineSegmentPoint1, lineSegmentPoint2, 
                                             out closestPoint);
      }

      private static double DistanceFromPointToLineSegmentSquared(MyVector aPoint, 
                                             MyVector lineSegmentPoint1, MyVector lineSegmentPoint2)
      {
         MyVector closestPoint;  // Not used
         return aPoint.DistanceToLineSegmentSquared(lineSegmentPoint1, lineSegmentPoint2, 
                                                    out closestPoint);
      }
   } 
```

如您所见，我尝试测量使用避免 Sqrt() 方法的版本和普通版本之间的差异。我的测试表明您可能可以节省大约 2.5%，但我什至不确定 - 各种测试运行中的变化具有相同的数量级。我还尝试测量了 Matti 发布的版本（加上明显的优化），该版本似乎比基于 Katz/Grumdrig 代码的版本慢了大约 4%。

编辑：顺便说一句，我还尝试测量一种方法，该方法使用叉积（和 Sqrt()）找到到无限线（不是线段）的距离，它的速度大约提高了 32%。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2012-10-17T04:46:09.570

用 t-sql 编码

点是 (@px, @py) 线段从 (@ax, @ay) 到 (@bx, @by)

```
create function fn_sqr (@NumberToSquare decimal(18,10)) 
returns decimal(18,10)
as 
begin
    declare @Result decimal(18,10)
    set @Result = @NumberToSquare * @NumberToSquare
    return @Result
end
go

create function fn_Distance(@ax decimal (18,10) , @ay decimal (18,10), @bx decimal(18,10),  @by decimal(18,10)) 
returns decimal(18,10)
as
begin
    declare @Result decimal(18,10)
    set @Result = (select dbo.fn_sqr(@ax - @bx) + dbo.fn_sqr(@ay - @by) )
    return @Result
end
go

create function fn_DistanceToSegmentSquared(@px decimal(18,10), @py decimal(18,10), @ax decimal(18,10), @ay decimal(18,10), @bx decimal(18,10), @by decimal(18,10)) 
returns decimal(18,10)
as 
begin
    declare @l2 decimal(18,10)
    set @l2 = (select dbo.fn_Distance(@ax, @ay, @bx, @by))
    if @l2 = 0
        return dbo.fn_Distance(@px, @py, @ax, @ay)
    declare @t decimal(18,10)
    set @t = ((@px - @ax) * (@bx - @ax) + (@py - @ay) * (@by - @ay)) / @l2
    if (@t < 0) 
        return dbo.fn_Distance(@px, @py, @ax, @ay);
    if (@t > 1) 
        return dbo.fn_Distance(@px, @py, @bx, @by);
    return dbo.fn_Distance(@px, @py,  @ax + @t * (@bx - @ax),  @ay + @t * (@by - @ay))
end
go

create function fn_DistanceToSegment(@px decimal(18,10), @py decimal(18,10), @ax decimal(18,10), @ay decimal(18,10), @bx decimal(18,10), @by decimal(18,10)) 
returns decimal(18,10)
as 
begin
    return sqrt(dbo.fn_DistanceToSegmentSquared(@px, @py , @ax , @ay , @bx , @by ))
end
go

--example execution for distance from a point at (6,1) to line segment that runs from (4,2) to (2,1)
select dbo.fn_DistanceToSegment(6, 1, 4, 2, 2, 1) 
--result = 2.2360679775

--example execution for distance from a point at (-3,-2) to line segment that runs from (0,-2) to (-2,1)
select dbo.fn_DistanceToSegment(-3, -2, 0, -2, -2, 1) 
--result = 2.4961508830

--example execution for distance from a point at (0,-2) to line segment that runs from (0,-2) to (-2,1)
select dbo.fn_DistanceToSegment(0,-2, 0, -2, -2, 1) 
--result = 0.0000000000 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-03-24T19:20:57.320

这是 devnullicus 的 C++ 版本转换为 C#。对于我的实施，我需要知道交点并找到他的解决方案运作良好。

```
public static bool PointSegmentDistanceSquared(PointF point, PointF lineStart, PointF lineEnd, out double distance, out PointF intersectPoint)
{
    const double kMinSegmentLenSquared = 0.00000001; // adjust to suit.  If you use float, you'll probably want something like 0.000001f
    const double kEpsilon = 1.0E-14; // adjust to suit.  If you use floats, you'll probably want something like 1E-7f
    double dX = lineEnd.X - lineStart.X;
    double dY = lineEnd.Y - lineStart.Y;
    double dp1X = point.X - lineStart.X;
    double dp1Y = point.Y - lineStart.Y;
    double segLenSquared = (dX * dX) + (dY * dY);
    double t = 0.0;

    if (segLenSquared >= -kMinSegmentLenSquared && segLenSquared <= kMinSegmentLenSquared)
    {
        // segment is a point.
        intersectPoint = lineStart;
        t = 0.0;
        distance = ((dp1X * dp1X) + (dp1Y * dp1Y));
    }
    else
    {
        // Project a line from p to the segment [p1,p2].  By considering the line
        // extending the segment, parameterized as p1 + (t * (p2 - p1)),
        // we find projection of point p onto the line. 
        // It falls where t = [(p - p1) . (p2 - p1)] / |p2 - p1|^2
        t = ((dp1X * dX) + (dp1Y * dY)) / segLenSquared;
        if (t < kEpsilon)
        {
            // intersects at or to the "left" of first segment vertex (lineStart.X, lineStart.Y).  If t is approximately 0.0, then
            // intersection is at p1\.  If t is less than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t > -kEpsilon)
            {
                // intersects at 1st segment vertex
                t = 0.0;
            }
            // set our 'intersection' point to p1.
            intersectPoint = lineStart;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then intersectPoint.X would be (lineStart.X + (t * dx)) and intersectPoint.Y would be (lineStart.Y + (t * dy)).
        }
        else if (t > (1.0 - kEpsilon))
        {
            // intersects at or to the "right" of second segment vertex (lineEnd.X, lineEnd.Y).  If t is approximately 1.0, then
            // intersection is at p2\.  If t is greater than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t < (1.0 + kEpsilon))
            {
                // intersects at 2nd segment vertex
                t = 1.0;
            }
            // set our 'intersection' point to p2.
            intersectPoint = lineEnd;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then intersectPoint.X would be (lineStart.X + (t * dx)) and intersectPoint.Y would be (lineStart.Y + (t * dy)).
        }
        else
        {
            // The projection of the point to the point on the segment that is perpendicular succeeded and the point
            // is 'within' the bounds of the segment.  Set the intersection point as that projected point.
            intersectPoint = new PointF((float)(lineStart.X + (t * dX)), (float)(lineStart.Y + (t * dY)));
        }
        // return the squared distance from p to the intersection point.  Note that we return the squared distance
        // as an optimization because many times you just need to compare relative distances and the squared values
        // works fine for that.  If you want the ACTUAL distance, just take the square root of this value.
        double dpqX = point.X - intersectPoint.X;
        double dpqY = point.Y - intersectPoint.Y;

        distance = ((dpqX * dpqX) + (dpqY * dpqY));
    }

    return true;
} 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2018-02-12T16:16:33.157

**2D 和 3D 解决方案**

考虑改变基，使得线段变为`(0, 0, 0)-(d, 0, 0)`点`(u, v, 0)`。最短距离出现在该平面上，由下式给出

```
 u ≤ 0 -> d(A, C)
0 ≤ u ≤ d -> |v|
d ≤ u     -> d(B, C) 
```

（到端点之一或到支撑线的距离，取决于对线的投影。等距离轨迹由两个半圆和两个线段组成。）

[![在此处输入图像描述](https://i.stack.imgur.com/Fz3zg.png)](https://i.stack.imgur.com/Fz3zg.png)

在上面的表达式中，d 是线段 AB 的长度，u、v 分别是 AB/d（AB 方向的单位向量）和 AC 的标量积和叉积（模量）。因此在矢量上，

```
AB.AC ≤ 0             -> |AC|
    0 ≤ AB.AC ≤ AB²   -> |ABxAC|/|AB|
          AB² ≤ AB.AC -> |BC| 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-06-25T17:15:21.103

接受的答案不起作用（例如，0,0 和 (-10,2,10,2) 之间的距离应该是 2）。

这是有效的代码：

```
 def dist2line2(x,y,line):
     x1,y1,x2,y2=line
     vx = x1 - x
     vy = y1 - y
     ux = x2-x1
     uy = y2-y1
     length = ux * ux + uy * uy
     det = (-vx * ux) + (-vy * uy) #//if this is < 0 or > length then its outside the line segment
     if det < 0:
       return (x1 - x)**2 + (y1 - y)**2
     if det > length:
       return (x2 - x)**2 + (y2 - y)**2
     det = ux * vy - uy * vx
     return det**2 / length
   def dist2line(x,y,line): return math.sqrt(dist2line2(x,y,line)) 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2012-09-06T03:35:30.827

基于 Joshua 的 Javascript 的 AutoHotkeys 版本：

```
plDist(x, y, x1, y1, x2, y2) {
    A:= x - x1
    B:= y - y1
    C:= x2 - x1
    D:= y2 - y1

    dot:= A*C + B*D
    sqLen:= C*C + D*D
    param:= dot / sqLen

    if (param < 0 || ((x1 = x2) && (y1 = y2))) {
        xx:= x1
        yy:= y1
    } else if (param > 1) {
        xx:= x2
        yy:= y2
    } else {
        xx:= x1 + param*C
        yy:= y1 + param*D
    }

    dx:= x - xx
    dy:= y - yy

    return sqrt(dx*dx + dy*dy)
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2012-04-18T08:25:23.470

请参阅以下网站中的 Matlab GEOMETRY 工具箱：http: [//people.sc.fsu.edu/~jburkardt/m_src/geometry/geometry.html](http://people.sc.fsu.edu/~jburkardt/m_src/geometry/geometry.html)

ctrl+f 并键入“segment”以查找线段相关功能。函数“segment_point_dist_2d.m”和“segment_point_dist_3d.m”是您需要的。

GEOMETRY 代码有 C 版本和 C++ 版本以及 FORTRAN77 版本和 FORTRAN90 版本和 MATLAB 版本。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2015-09-27T23:55:35.017

WPF版本：

```
public class LineSegment
{
    private readonly Vector _offset;
    private readonly Vector _vector;

    public LineSegment(Point start, Point end)
    {
        _offset = (Vector)start;
        _vector = (Vector)(end - _offset);
    }

    public double DistanceTo(Point pt)
    {
        var v = (Vector)pt - _offset;

        // first, find a projection point on the segment in parametric form (0..1)
        var p = (v * _vector) / _vector.LengthSquared;

        // and limit it so it lays inside the segment
        p = Math.Min(Math.Max(p, 0), 1);

        // now, find the distance from that point to our point
        return (_vector * p - v).Length;
    }
} 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2015-09-02T16:48:20.853

在这里没有看到 Java 实现，所以我将 Javascript 函数从接受的答案翻译为 Java 代码：

```
static double sqr(double x) {
    return x * x;
}
static double dist2(DoublePoint v, DoublePoint w) {
    return sqr(v.x - w.x) + sqr(v.y - w.y);
}
static double distToSegmentSquared(DoublePoint p, DoublePoint v, DoublePoint w) {
    double l2 = dist2(v, w);
    if (l2 == 0) return dist2(p, v);
    double t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
    if (t < 0) return dist2(p, v);
    if (t > 1) return dist2(p, w);
    return dist2(p, new DoublePoint(
            v.x + t * (w.x - v.x),
            v.y + t * (w.y - v.y)
    ));
}
static double distToSegment(DoublePoint p, DoublePoint v, DoublePoint w) {
    return Math.sqrt(distToSegmentSquared(p, v, w));
}
static class DoublePoint {
    public double x;
    public double y;

    public DoublePoint(double x, double y) {
        this.x = x;
        this.y = y;
    }
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2016-11-08T15:53:15.023

我制作了一个交互式 Desmos 图来演示如何实现这一点：

[https://www.desmos.com/calculator/kswrm8ddum](https://www.desmos.com/calculator/kswrm8ddum)

红点是A，绿点是B，C点是蓝。您可以拖动图表中的点来查看值的变化。在左边，值's'是线段的参数（即s = 0 表示A 点，s = 1 表示B 点）。值“d”是从第三点到通过 A 和 B 的线的距离。

编辑：

有趣的小见解：坐标(s,d)是坐标系中第三个点C的坐标，其中AB为单位x轴，单位y轴垂直于AB。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2012-05-17T16:56:22.950

Here is same thing as the C++ answer but ported to pascal. The order of the point parameter has changed to suit my code but is the same thing.

```
function Dot(const p1, p2: PointF): double;
begin
  Result := p1.x * p2.x + p1.y * p2.y;
end;
function SubPoint(const p1, p2: PointF): PointF;
begin
  result.x := p1.x - p2.x;
  result.y := p1.y - p2.y;
end;

function ShortestDistance2(const p,v,w : PointF) : double;
var
  l2,t : double;
  projection,tt: PointF;
begin
  // Return minimum distance between line segment vw and point p
  //l2 := length_squared(v, w);  // i.e. |w-v|^2 -  avoid a sqrt
  l2 := Distance(v,w);
  l2 := MPower(l2,2);
  if (l2 = 0.0) then begin
    result:= Distance(p, v);   // v == w case
    exit;
  end;
  // Consider the line extending the segment, parameterized as v + t (w - v).
  // We find projection of point p onto the line.
  // It falls where t = [(p-v) . (w-v)] / |w-v|^2
  t := Dot(SubPoint(p,v),SubPoint(w,v)) / l2;
  if (t < 0.0) then begin
    result := Distance(p, v);       // Beyond the 'v' end of the segment
    exit;
  end
  else if (t > 1.0) then begin
    result := Distance(p, w);  // Beyond the 'w' end of the segment
    exit;
  end;
  //projection := v + t * (w - v);  // Projection falls on the segment
  tt.x := v.x + t * (w.x - v.x);
  tt.y := v.y + t * (w.y - v.y);
  result := Distance(p, tt);
end; 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2013-04-23T17:42:47.393

```
%Matlab solution by Tim from Cody
function ans=distP2S(x0,y0,x1,y1,x2,y2)
% Point is x0,y0
z=complex(x0-x1,y0-y1);
complex(x2-x1,y2-y1);
abs(z-ans*min(1,max(0,real(z/ans)))); 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-05-13T13:29:54.817

这是我最终编写的代码。此代码假定点以 的形式定义`{x:5, y:7}`。请注意，这不是绝对最有效的方法，但它是我能想到的最简单、最容易理解的代码。

```
// a, b, and c in the code below are all points

function distance(a, b)
{
    var dx = a.x - b.x;
    var dy = a.y - b.y;
    return Math.sqrt(dx*dx + dy*dy);
}

function Segment(a, b)
{
    var ab = {
        x: b.x - a.x,
        y: b.y - a.y
    };
    var length = distance(a, b);

    function cross(c) {
        return ab.x * (c.y-a.y) - ab.y * (c.x-a.x);
    };

    this.distanceFrom = function(c) {
        return Math.min(distance(a,c),
                        distance(b,c),
                        Math.abs(cross(c) / length));
    };
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2014-01-27T17:59:09.877

该算法基于找到指定线与包含指定点的正交线的交点，并计算其距离。如果是线段，我们必须检查交点是否在线段的点之间，如果不是，则最小距离在指定点和线段的端点之一之间。这是一个 C# 实现。

```
Double Distance(Point a, Point b)
{
    double xdiff = a.X - b.X, ydiff = a.Y - b.Y;
    return Math.Sqrt((long)xdiff * xdiff + (long)ydiff * ydiff);
}

Boolean IsBetween(double x, double a, double b)
{
    return ((a <= b && x >= a && x <= b) || (a > b && x <= a && x >= b));
}

Double GetDistance(Point pt, Point pt1, Point pt2, out Point intersection)
{
    Double a, x, y, R;

    if (pt1.X != pt2.X) {
        a = (double)(pt2.Y - pt1.Y) / (pt2.X - pt1.X);
        x = (a * (pt.Y - pt1.Y) + a * a * pt1.X + pt.X) / (a * a + 1);
        y = a * x + pt1.Y - a * pt1.X; }
    else { x = pt1.X;  y = pt.Y; }

    if (IsBetween(x, pt1.X, pt2.X) && IsBetween(y, pt1.Y, pt2.Y)) {
        intersection = new Point((int)x, (int)y);
        R = Distance(intersection, pt); }
    else {
        double d1 = Distance(pt, pt1), d2 = Distance(pt, pt2);
        if (d1 < d2) { intersection = pt1; R = d1; }
        else { intersection = pt2; R = d2; }}

    return R;
} 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2011-08-31T04:41:32.167

上述功能不适用于垂直线。这是一个运行良好的功能！与点 p1、p2 连线。CheckPoint 是 p；

```
public float DistanceOfPointToLine2(PointF p1, PointF p2, PointF p)
{
  //          (y1-y2)x + (x2-x1)y + (x1y2-x2y1)
  //d(P,L) = --------------------------------
  //         sqrt( (x2-x1)pow2 + (y2-y1)pow2 )

  double ch = (p1.Y - p2.Y) * p.X + (p2.X - p1.X) * p.Y + (p1.X * p2.Y - p2.X * p1.Y);
  double del = Math.Sqrt(Math.Pow(p2.X - p1.X, 2) + Math.Pow(p2.Y - p1.Y, 2));
  double d = ch / del;
  return (float)d;
} 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2019-02-18T09:58:43.273

这是一个基于向量数学的；该解决方案也适用于更高的维度*，并且*还报告交点（在线段上）。

```
def dist(x1,y1,x2,y2,px,py):
    a = np.array([[x1,y1]]).T
    b = np.array([[x2,y2]]).T
    x = np.array([[px,py]]).T
    tp = (np.dot(x.T, b) - np.dot(a.T, b)) / np.dot(b.T, b)
    tp = tp[0][0]
    tmp = x - (a + tp*b)
    d = np.sqrt(np.dot(tmp.T,tmp)[0][0])
    return d, a+tp*b

x1,y1=2.,2.
x2,y2=5.,5.
px,py=4.,1.

d, inters = dist(x1,y1, x2,y2, px,py)
print (d)
print (inters) 
```

结果是

```
2.1213203435596424
[[2.5]
 [2.5]] 
```

数学在这里解释

[https://brilliant.org/wiki/distance-between-point-and-line/](https://brilliant.org/wiki/distance-between-point-and-line/)

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2019-09-08T20:46:53.357

飞镖和颤振的解决方案：

```
import 'dart:math' as math;
 class Utils {
   static double shortestDistance(Point p1, Point p2, Point p3){
      double px = p2.x - p1.x;
      double py = p2.y - p1.y;
      double temp = (px*px) + (py*py);
      double u = ((p3.x - p1.x)*px + (p3.y - p1.y)* py) /temp;
      if(u>1){
        u=1;
      }
      else if(u<0){
        u=0;
      }
      double x = p1.x + u*px;
      double y = p1.y + u*py;
      double dx = x - p3.x;
      double dy = y - p3.y;
      double dist = math.sqrt(dx*dx+dy*dy);
      return dist;
   }
}

class Point {
  double x;
  double y;
  Point(this.x, this.y);
} 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2017-11-21T23:54:56.057

GLSL 版本：

```
// line (a -> b ) point p[enter image description here][1]
float distanceToLine(vec2 a, vec2 b, vec2 p) {
    float aside = dot((p - a),(b - a));
    if(aside< 0.0) return length(p-a);
    float bside = dot((p - b),(a - b));
    if(bside< 0.0) return length(p-b);
    vec2 pointOnLine = (bside*a + aside*b)/pow(length(a-b),2.0);
    return length(p - pointOnLine);
} 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2018-11-06T16:32:27.200

二维坐标数组的 Python Numpy 实现：

```
import numpy as np

def dist2d(p1, p2, coords):
    ''' Distance from points to a finite line btwn p1 -> p2 '''
    assert coords.ndim == 2 and coords.shape[1] == 2, 'coords is not 2 dim'
    dp = p2 - p1
    st = dp[0]**2 + dp[1]**2
    u = ((coords[:, 0] - p1[0]) * dp[0] + (coords[:, 1] - p1[1]) * dp[1]) / st

    u[u > 1.] = 1.
    u[u < 0.] = 0.

    dx = (p1[0] + u * dp[0]) - coords[:, 0]
    dy = (p1[1] + u * dp[1]) - coords[:, 1]

    return np.sqrt(dx**2 + dy**2)

# Usage:
p1 = np.array([0., 0.])
p2 = np.array([0., 10.])

# List of coordinates
coords = np.array(
    [[0., 0.],
     [5., 5.],
     [10., 10.],
     [20., 20.]
     ])

d = dist2d(p1, p2, coords)

# Single coordinate
coord = np.array([25., 25.])
d = dist2d(p1, p2, coord[np.newaxis, :]) 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2014-07-23T14:34:28.450

A little cleaner solution in JavaScript based on this [formula](http://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line): ![enter image description here](https://i.stack.imgur.com/qKwEU.png)

```
distToSegment: function (point, linePointA, linePointB){

    var x0 = point.X;
    var y0 = point.Y;

    var x1 = linePointA.X;
    var y1 = linePointA.Y;

    var x2 = linePointB.X;
    var y2 = linePointB.Y;

    var Dx = (x2 - x1);
    var Dy = (y2 - y1);

    var numerator = Math.abs(Dy*x0 - Dx*y0 - x1*y2 + x2*y1);
    var denominator = Math.sqrt(Dx*Dx + Dy*Dy);
    if (denominator == 0) {
        return this.dist2(point, linePointA);
    }

    return numerator/denominator;

} 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2013-04-23T19:13:48.660

Matlab直接Grumdrig实现

```
function ans=distP2S(px,py,vx,vy,wx,wy)
% [px py vx vy wx wy]
  t=( (px-vx)*(wx-vx)+(py-vy)*(wy-vy) )/idist(vx,wx,vy,wy)^2;
  [idist(px,vx,py,vy) idist(px,vx+t*(wx-vx),py,vy+t*(wy-vy)) idist(px,wx,py,wy) ];
  ans(1+(t>0)+(t>1)); % <0 0<=t<=1 t>1     
 end

function d=idist(a,b,c,d)
 d=abs(a-b+1i*(c-d));
end 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2013-09-09T11:29:10.633

刚刚遇到这个，并认为我会添加一个 Lua 实现。它假设点以表格 {x=xVal, y=yVal} 的形式给出，而线或线段由包含两个点的表格给出（参见下面的示例）：

```
function distance( P1, P2 )
    return math.sqrt((P1.x-P2.x)^2 + (P1.y-P2.y)^2)
end

-- Returns false if the point lies beyond the reaches of the segment
function distPointToSegment( line, P )
    if line[1].x == line[2].x and line[1].y == line[2].y then
        print("Error: Not a line!")
        return false
    end

    local d = distance( line[1], line[2] )

    local t = ((P.x - line[1].x)*(line[2].x - line[1].x) + (P.y - line[1].y)*(line[2].y - line[1].y))/(d^2)

    local projection = {}
    projection.x = line[1].x + t*(line[2].x-line[1].x)
    projection.y = line[1].y + t*(line[2].y-line[1].y)

    if t >= 0 and t <= 1 then   -- within line segment?
        return distance( projection, {x=P.x, y=P.y} )
    else
        return false
    end
end

-- Returns value even if point is further down the line (outside segment)
function distPointToLine( line, P )
    if line[1].x == line[2].x and line[1].y == line[2].y then
        print("Error: Not a line!")
        return false
    end

    local d = distance( line[1], line[2] )

    local t = ((P.x - line[1].x)*(line[2].x - line[1].x) + (P.y - line[1].y)*(line[2].y - line[1].y))/(d^2)

    local projection = {}
    projection.x = line[1].x + t*(line[2].x-line[1].x)
    projection.y = line[1].y + t*(line[2].y-line[1].y)

    return distance( projection, {x=P.x, y=P.y} )
end 
```

示例用法：

```
local P1 = {x = 0, y = 0}
local P2 = {x = 10, y = 10}
local line = { P1, P2 }
local P3 = {x = 7, y = 15}
print(distPointToLine( line, P3 ))  -- prints 5.6568542494924
print(distPointToSegment( line, P3 )) -- prints false 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2013-07-22T02:15:06.163

如果它是一条无限线，而不是线段，最简单的方法是（在 ruby​​ 中），其中 mx + b 是线， (x1, y1) 是已知点

```
(y1 - mx1 - b).abs / Math.sqrt(m**2 + 1) 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2015-05-26T02:25:04.400

想在 GLSL 中执行此操作，但如果可能，最好避免所有这些条件。使用 clamp() 可以避免两种端点情况：

```
// find closest point to P on line segment AB:
vec3 closest_point_on_line_segment(in vec3 P, in vec3 A, in vec3 B) {
    vec3 AP = P - A, AB = B - A;
    float l = dot(AB, AB);
    if (l <= 0.0000001) return A;    // A and B are practically the same
    return AP - AB*clamp(dot(AP, AB)/l, 0.0, 1.0);  // do the projection
} 
```

如果您可以确定 A 和 B 永远不会彼此非常接近，则可以将其简化为删除 if()。事实上，即使 A 和 B*相同*，我的 GPU 仍然使用这个无条件版本给出正确的结果（但这是使用 OpenGL 4.1 之前的版本，其中 GLSL 除以零是未定义的）：

```
// find closest point to P on line segment AB:
vec3 closest_point_on_line_segment(in vec3 P, in vec3 A, in vec3 B) {
    vec3 AP = P - A, AB = B - A;
    return AP - AB*clamp(dot(AP, AB)/dot(AB, AB), 0.0, 1.0);
} 
```

计算距离很简单——GLSL 提供了一个 distance() 函数，你可以在这个最近点和 P 上使用它。

灵感来自[Iñigo Quilez 的胶囊距离函数代码](http://iquilezles.org/www/articles/distfunctions/distfunctions.htm)

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2021-10-17T15:57:23.853

Lua 解决方案

```
-- distance from point (px, py) to line segment (x1, y1, x2, y2)
function distPointToLine(px,py,x1,y1,x2,y2) -- point, start and end of the segment
    local dx,dy = x2-x1,y2-y1
    local length = math.sqrt(dx*dx+dy*dy)
    dx,dy = dx/length,dy/length -- normalization
    local p = dx*(px-x1)+dy*(py-y1)
    if p < 0 then
        dx,dy = px-x1,py-y1
        return math.sqrt(dx*dx+dy*dy), x1, y1 -- distance, nearest point
    elseif p > length then
        dx,dy = px-x2,py-y2
        return math.sqrt(dx*dx+dy*dy), x2, y2 -- distance, nearest point
    end
    return math.abs(dy*(px-x1)-dx*(py-y1)), x1+dx*p, y1+dy*p -- distance, nearest point
end 
```

对于折线（具有两个以上线段的线）：

```
-- if the (poly-)line has several segments, just iterate through all of them:
function nearest_sector_in_line (x, y, line)
    local x1, y1, x2, y2, min_dist
    local ax,ay = line[1], line[2]
    for j = 3, #line-1, 2 do
        local bx,by = line[j], line[j+1]
        local dist = distPointToLine(x,y,ax,ay,bx,by)
        if not min_dist or dist < min_dist then
            min_dist = dist
            x1, y1, x2, y2 = ax,ay,bx,by
        end
        ax, ay = bx, by
    end
    return x1, y1, x2, y2
end 
```

例子：

```
-- call it:
local x1, y1, x2, y2 = nearest_sector_in_line (7, 4, {0,0, 10,0, 10,10, 0,10}) 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2018-03-14T01:30:58.757

用于 3D 线段和点的 Eigen C++ 版本

```
// Return minimum distance between line segment: head--->tail and point
double MinimumDistance(Eigen::Vector3d head, Eigen::Vector3d tail,Eigen::Vector3d point)
{
    double l2 = std::pow((head - tail).norm(),2);
    if(l2 ==0.0) return (head - point).norm();// head == tail case

    // Consider the line extending the segment, parameterized as head + t (tail - point).
    // We find projection of point onto the line.
    // It falls where t = [(point-head) . (tail-head)] / |tail-head|^2
    // We clamp t from [0,1] to handle points outside the segment head--->tail.

    double t = max(0,min(1,(point-head).dot(tail-head)/l2));
    Eigen::Vector3d projection = head + t*(tail-head);

    return (point - projection).norm();
} 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2016-07-11T21:07:41.680

**Lua：** 查找线段（不是整条线）和点之间的最小距离

```
function solveLinearEquation(A1,B1,C1,A2,B2,C2)
--it is the implitaion of a method of solving linear equations in x and y
  local f1 = B1*C2 -B2*C1
  local f2 = A2*C1-A1*C2
  local f3 = A1*B2 -A2*B1
  return {x= f1/f3, y= f2/f3}
end

function pointLiesOnLine(x,y,x1,y1,x2,y2)
  local dx1 = x-x1
  local  dy1 = y-y1
  local dx2 = x-x2
  local  dy2 = y-y2
  local crossProduct = dy1*dx2 -dx1*dy2

if crossProduct ~= 0  then  return  false
else
  if ((x1>=x) and (x>=x2)) or ((x2>=x) and (x>=x1)) then
    if ((y1>=y) and (y>=y2)) or ((y2>=y) and (y>=y1)) then
      return true
    else return false end
  else  return false end
end
end

function dist(x1,y1,x2,y2)
  local dx = x1-x2
  local dy = y1-y2
  return math.sqrt(dx*dx + dy* dy)
 end

function findMinDistBetnPointAndLine(x1,y1,x2,y2,x3,y3)
-- finds the min  distance between (x3,y3) and line (x1,y2)--(x2,y2)
   local A2,B2,C2,A1,B1,C1
   local dx = y2-y1
   local dy = x2-x1
   if dx == 0 then A2=1 B2=0 C2=-x3 A1=0 B1=1 C1=-y1 
   elseif dy == 0 then A2=0 B2=1 C2=-y3 A1=1 B1=0 C1=-x1
   else
      local m1 = dy/dx
      local m2 = -1/m1
      A2=m2 B2=-1 C2=y3-m2*x3 A1=m1 B1=-1 C1=y1-m1*x1
   end
 local intsecPoint= solveLinearEquation(A1,B1,C1,A2,B2,C2)
if pointLiesOnLine(intsecPoint.x, intsecPoint.y,x1,y1,x2,y2) then
   return dist(intsecPoint.x, intsecPoint.y, x3,y3)
 else
   return math.min(dist(x3,y3,x1,y1),dist(x3,y3,x2,y2))
end
end 
```

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2017-09-06T13:47:08.687

在使用几何的 javascript 中：

```
var a = { x:20, y:20};//start segment    
var b = { x:40, y:30};//end segment   
var c = { x:37, y:14};//point   

// magnitude from a to c    
var ac = Math.sqrt( Math.pow( ( a.x - c.x ), 2 ) + Math.pow( ( a.y - c.y ), 2) );    
// magnitude from b to c   
var bc = Math.sqrt( Math.pow( ( b.x - c.x ), 2 ) + Math.pow( ( b.y - c.y ), 2 ) );    
// magnitude from a to b (base)     
var ab = Math.sqrt( Math.pow( ( a.x - b.x ), 2 ) + Math.pow( ( a.y - b.y ), 2 ) );    
 // perimeter of triangle     
var p = ac + bc + ab;    
 // area of the triangle    
var area = Math.sqrt( p/2 * ( p/2 - ac) * ( p/2 - bc ) * ( p/2 - ab ) );    
 // height of the triangle = distance    
var h = ( area * 2 ) / ab;    
console.log ("height: " + h); 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2017-02-02T16:16:44.613

# 在 R 中

```
 #distance beetween segment ab and point c in 2D space
getDistance_ort_2 <- function(a, b, c){
  #go to complex numbers
  A<-c(a[1]+1i*a[2],b[1]+1i*b[2])
  q=c[1]+1i*c[2]

  #function to get coefficients of line (ab)
  getAlphaBeta <- function(A)
  { a<-Re(A[2])-Re(A[1])
    b<-Im(A[2])-Im(A[1])
    ab<-as.numeric()
    ab[1] <- -Re(A[1])*b/a+Im(A[1])
    ab[2] <-b/a
    if(Im(A[1])==Im(A[2])) ab<- c(Im(A[1]),0)
    if(Re(A[1])==Re(A[2])) ab <- NA
    return(ab)
  }

  #function to get coefficients of line ortogonal to line (ab) which goes through point q
  getAlphaBeta_ort<-function(A,q)
  { ab <- getAlphaBeta(A) 
  coef<-c(Re(q)/ab[2]+Im(q),-1/ab[2])
  if(Re(A[1])==Re(A[2])) coef<-c(Im(q),0)
  return(coef)
  }

  #function to get coordinates of interception point 
  #between line (ab) and its ortogonal which goes through point q
  getIntersection_ort <- function(A, q){
    A.ab <- getAlphaBeta(A)
    q.ab <- getAlphaBeta_ort(A,q)
    if (!is.na(A.ab[1])&A.ab[2]==0) {
      x<-Re(q)
      y<-Im(A[1])}
    if (is.na(A.ab[1])) {
      x<-Re(A[1])
      y<-Im(q)
    } 
    if (!is.na(A.ab[1])&A.ab[2]!=0) {
      x <- (q.ab[1] - A.ab[1])/(A.ab[2] - q.ab[2])
      y <- q.ab[1] + q.ab[2]*x}
    xy <- x + 1i*y  
    return(xy)
  }

  intersect<-getIntersection_ort(A,q)
  if ((Mod(A[1]-intersect)+Mod(A[2]-intersect))>Mod(A[1]-A[2])) {dist<-min(Mod(A[1]-q),Mod(A[2]-q))
  } else dist<-Mod(q-intersect)
  return(dist)
} 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2020-04-26T11:06:31.823

**[http://paulbourke.net/geometry/pointlineplane/source.c的](http://paulbourke.net/geometry/pointlineplane/source.c)**快速**实现**

 **```
 static func magnitude(p1: CGPoint, p2: CGPoint) -> CGFloat {
        let vector = CGPoint(x: p2.x - p1.x, y: p2.y - p1.y)
        return sqrt(pow(vector.x, 2) + pow(vector.y, 2))
    }

    /// http://paulbourke.net/geometry/pointlineplane/
    /// http://paulbourke.net/geometry/pointlineplane/source.c
    static func pointDistanceToLine(point: CGPoint, lineStart: CGPoint, lineEnd: CGPoint) -> CGFloat? {

        let lineMag = magnitude(p1: lineEnd, p2: lineStart)
        let u = (((point.x - lineStart.x) * (lineEnd.x - lineStart.x)) +
                ((point.y - lineStart.y) * (lineEnd.y - lineStart.y))) /
                (lineMag * lineMag)

        if u < 0 || u > 1 {
            // closest point does not fall within the line segment
            return nil
        }

        let intersectionX = lineStart.x + u * (lineEnd.x - lineStart.x)
        let intersectionY = lineStart.y + u * (lineEnd.y - lineStart.y)

        return magnitude(p1: point, p2: CGPoint(x: intersectionX, y: intersectionY))
    } 
```

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2018-03-18T07:15:30.880

这是基于上面约书亚回答的函数的自包含 Delphi / Pascal 版本。将 TPoint 用于 VCL 屏幕图形，但应易于根据需要进行调整。

```
function DistancePtToSegment( pt, pt1, pt2: TPoint): double;
var
   a, b, c, d: double;
   len_sq: double;
   param: double;
   xx, yy: double;
   dx, dy: double;
begin
   a := pt.x - pt1.x;
   b := pt.y - pt1.y;
   c := pt2.x - pt1.x;
   d := pt2.y - pt1.y;

   len_sq := (c * c) + (d * d);
   param := -1;

   if (len_sq <> 0) then
   begin
      param := ((a * c) + (b * d)) / len_sq;
   end;

   if param < 0 then
   begin
      xx := pt1.x;
      yy := pt1.y;
   end
   else if param > 1 then
   begin
      xx := pt2.x;
      yy := pt2.y;
   end
   else begin
      xx := pt1.x + param * c;
      yy := pt1.y + param * d;
   end;

   dx := pt.x - xx;
   dy := pt.y - yy;
   result := sqrt( (dx * dx) + (dy * dy))
end; 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2016-01-05T19:33:47.107

与[此答案](https://stackoverflow.com/a/6853926/407108)相同，但在 Visual Basic 中除外。使其可用作 Microsoft Excel 和 VBA/宏中的用户定义函数。

该函数返回从点 (x,y) 到由 (x1,y1) 和 (x2,y2) 定义的线段的最近距离

```
Function DistanceToSegment(x As Double, y As Double, x1 As Double, y1 As Double, x2 As Double, y2 As Double)

  Dim A As Double
  A = x - x1
  Dim B As Double
  B = y - y1
  Dim C  As Double
  C = x2 - x1
  Dim D As Double
  D = y2 - y1

  Dim dot As Double
  dot = A * C + B * D
  Dim len_sq As Double
  len_sq = C * C + D * D
  Dim param As Double
  param = -1

  If (len_sq <> 0) Then
      param = dot / len_sq
  End If

  Dim xx As Double
  Dim yy As Double

  If (param < 0) Then
    xx = x1
    yy = y1
  ElseIf (param > 1) Then
    xx = x2
    yy = y2
  Else
    xx = x1 + param * C
    yy = y1 + param * D
  End If

  Dim dx As Double
  dx = x - xx
  Dim dy As Double
  dy = y - yy

  DistanceToSegment = Math.Sqr(dx * dx + dy * dy)

End Function 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2016-09-28T06:44:10.380

此答案基于[接受的答案](https://stackoverflow.com/a/1501725/2624876)的 JavaScript 解决方案。它主要只是格式更好，函数名称更长，当然函数语法更短，因为它在 ES6 + CoffeeScript 中。

## JavaScript 版本 (ES6)

```
distanceSquared = (v, w)=> Math.pow(v.x - w.x, 2) + Math.pow(v.y - w.y, 2);
distance = (v, w)=> Math.sqrt(distanceSquared(v, w));

distanceToLineSegmentSquared = (p, v, w)=> {
    l2 = distanceSquared(v, w);
    if (l2 === 0) {
        return distanceSquared(p, v);
    }
    t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
    t = Math.max(0, Math.min(1, t));
    return distanceSquared(p, {
        x: v.x + t * (w.x - v.x),
        y: v.y + t * (w.y - v.y)
    });
}
distanceToLineSegment = (p, v, w)=> {
    return Math.sqrt(distanceToLineSegmentSquared(p, v));
} 
```

## CoffeeScript 版本

```
distanceSquared = (v, w)-> (v.x - w.x) ** 2 + (v.y - w.y) ** 2
distance = (v, w)-> Math.sqrt(distanceSquared(v, w))

distanceToLineSegmentSquared = (p, v, w)->
    l2 = distanceSquared(v, w)
    return distanceSquared(p, v) if l2 is 0
    t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2
    t = Math.max(0, Math.min(1, t))
    distanceSquared(p, {
        x: v.x + t * (w.x - v.x)
        y: v.y + t * (w.y - v.y)
    })

distanceToLineSegment = (p, v, w)->
    Math.sqrt(distanceToLineSegmentSquared(p, v, w)) 
```

* * *

## 回答 #53

> 赞同：-1
> 
> 时间：2021-04-17T19:16:37.553

我需要一个 Godot (GDscript) 实现，所以我根据[grumdrig](https://stackoverflow.com/questions/849211/shortest-distance-between-a-point-and-a-line-segment/1501725#1501725)接受的答案写了一个：

```
func minimum_distance(v: Vector2, w: Vector2, p: Vector2):
    # Return minimum distance between line segment vw and point p
    var l2: float = (v - w).length_squared()  # i.e. |w-v|^2 -  avoid a sqrt
    if l2 == 0.0:
        return p.distance_to(v) # v == w case

    # Consider the line extending the segment, parameterized as v + t (w - v).
    # We find projection of point p onto the line.
    # It falls where t = [(p-v) . (w-v)] / |w-v|^2
    # We clamp t from [0,1] to handle points outside the segment vw.
    var t: float = max(0, min(1, (p - v).dot(w - v) / l2))
    var projection: Vector2 = v + t * (w - v)  # Projection falls on the segment

    return p.distance_to(projection) 
```

* * *

## 回答 #54

> 赞同：-1
> 
> 时间：2020-09-02T13:19:52.503

这是 HSQLDB 的 SQL 实现：

```
CREATE FUNCTION dist_to_segment(px double, py double, vx double, vy double, wx double, wy double)
  RETURNS double
BEGIN atomic
   declare l2 double;
   declare t double;
   declare nx double;
   declare ny double;
   set l2 =(vx - wx)*(vx - wx) + (vy - wy)*(vy - wy);
   IF l2 = 0 THEN
     RETURN sqrt((vx - px)*(vx - px) + (vy - py)*(vy - py));
   ELSE
     set t = ((px - vx) * (wx - vx) + (py - vy) * (wy - vy)) / l2;
     set t = GREATEST(0, LEAST(1, t));
     set nx=vx + t * (wx - vx);
     set ny=vy + t * (wy - vy);
     RETURN sqrt((nx - px)*(nx - px) + (ny - py)*(ny - py));
   END IF;
END; 
```

Postgres 的实现：

```
CREATE FUNCTION dist_to_segment(px numeric, py numeric, vx numeric, vy numeric, wx numeric, wy numeric)
  RETURNS numeric
AS $$
   declare l2 numeric;
   declare t numeric;
   declare nx numeric;
   declare ny numeric;
BEGIN 
   l2 := (vx - wx)*(vx - wx) + (vy - wy)*(vy - wy);
   IF l2 = 0 THEN
     RETURN sqrt((vx - px)*(vx - px) + (vy - py)*(vy - py));
   ELSE
     t := ((px - vx) * (wx - vx) + (py - vy) * (wy - vy)) / l2;
     t := GREATEST(0, LEAST(1, t));
     nx := vx + t * (wx - vx);
     ny := vy + t * (wy - vy);
     RETURN sqrt((nx - px)*(nx - px) + (ny - py)*(ny - py));
   END IF;
END;
$$ LANGUAGE plpgsql; 
```

# asp.net-mvc - 在 ASP.NET MVC 中创建模型

> ID：849216
> 
> 赞同：8
> 
> 时间：2009-05-11T17:48:29.670
> 
> 标签：asp.net-mvc, database, linq, ado.net, models

我刚刚在 ASP.Net MVC 中使用 LINQ to Entities 开始了一个项目，我想知道是否有一种很好、干净的方法来定义模型，为我在数据库中创建适当的表。我最熟悉 Django（就 MVC 框架而言）并且正在寻找 .Net 等价物，`models.py`以便我可以对所有内容进行版本控制。有任何想法吗？如果它有某种形式的模式迁移、la django-evolution 等，那就更好了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T14:42:27.773

我想你想做的就是把问题转过来。实体可以从数据库中自动生成，因此问题只是使用 .NET 机制来维护您的数据库模式。由于您没有使用这些其他解决方案所需的 NHibernate，因此我建议使用[MigratorDotNet](http://code.google.com/p/migratordotnet/)。MigratorDotNet 使用与 Ruby on Rails 迁移完全相同的想法：

1.  您的数据库会跟踪其版本
2.  每次您希望更改架构时，您都会编写一个小类来处理升级（以及可选的降级）
3.  为这些类分配执行顺序
4.  如果数据库不是最新的，只需按顺序执行类的升级方法

由于您只会在编译时重新生成实体，因此我建议您运行迁移脚本，然后重新生成实体，作为构建过程的一部分。MigratorDotNet 已经带有[一个 MSBuildTarget](http://code.google.com/p/migratordotnet/wiki/MSBuildTarget)，添加它只需要点击几下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:14:05.193

另一种选择是将 NHibernate 与[FluentNhibernate](http://fluentnhibernate.org)一起使用，它将根据约定自动映射您的模型。您还可以覆盖映射以根据需要对其进行调整。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:51:23.283

[Castle Project 活动记录是一个很好的方法。](http://www.castleproject.org/activerecord/index.html)

如果提供类似于 ruby​​ on rails active record 的功能。

# iphone - iPhone - 是否可以在 UIWebView 中隐藏本机滚动条？

> ID：849225
> 
> 赞同：18
> 
> 时间：2009-05-11T17:49:28.483
> 
> 标签：iphone, uiwebview

我想隐藏滚动 UIWebView 时出现的本机滚动条/滚动条，但仍保持滚动功能不变。这可能吗？

提前致谢，

威廉

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2013-07-04T12:52:17.240

看来这个问题需要**一个更新的答案**：

您可以直接访问与 Web 视图关联的滚动视图。（只读）在 iOS 5.0 及以上版本中。我认为开发人员不应该支持 iOS 5.0 之前的任何东西，除非在特殊情况下。

**来自 Apple 开发者文档。**

```
@property(nonatomic, readonly, retain) UIScrollView *scrollView
Discussion
Your application can access the scroll view if it wants to customize the scrolling behavior of the web view.

Availability
Available in iOS 5.0 and later.
Declared In
UIWebView.h 
```

现在你可以**直接写**这样的东西：

```
webView.scrollView.showsHorizontalScrollIndicator = NO;
webView.scrollView.showsVerticalScrollIndicator = NO; 
```

**无需转到 webView 的子视图。**

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-11T20:29:47.673

`UIWebView`不直接继承自`UIScrollView`，但您可以在子视图`UIScrollView`上使用属性：`UIWebView`

```
[(UIScrollView*)[webview.subviews objectAtIndex:0] setShowsHorizontalScrollIndicator:NO];
[(UIScrollView*)[webview.subviews objectAtIndex:0] setShowsVerticalScrollIndicator:NO]; 
```

不知道这是否可以接受，但它构建得很好，我认为它应该可以工作。如果这对您有用，请报告。

[还可以考虑在bugreport.apple.com](http://bugreport.apple.com)上向 Apple 提交功能请求，以将此属性添加到未来的`UIWebView`实现中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-03-21T16:22:22.820

这样做：

```
for (id subview in self.myWebView.subviews) {
    if ([[subview class] isSubclassOfClass: [UIScrollView class]]) {
        ((UIScrollView *)subview).bounces = NO; 
        ((UIScrollView *)subview).showsVerticalScrollIndicator = NO;    
        ((UIScrollView *)subview).showsHorizontalScrollIndicator = NO;  
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-05-06T10:56:52.260

在斯威夫特：

```
 webView.scrollView.showsHorizontalScrollIndicator = false
    webView.scrollView.showsVerticalScrollIndicator = false 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-09-01T10:50:15.070

如果有人正在寻找 swift 解决方案，那么下面是**swift 3.0的代码**

```
yourWebView.scrollView.showsHorizontalScrollIndicator = false
yourWebView.scrollView.showsVerticalScrollIndicator = false 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-03-11T18:05:51.657

这里似乎有一个答案的开始：

[http://discussions.apple.com/thread.jspa?threadID=1781730](http://discussions.apple.com/thread.jspa?threadID=1781730)

如果您禁用用户交互，这似乎会删除滚动条（如果您显示的网页不超过屏幕高度，这可能没问题）。

似乎还描述了一种 javascript hack，但我没有掌握它：/（但是，您需要访问您尝试显示的网页，这可能不是您的情况....）

# php - 基于array1合并两个数组

> ID：849227
> 
> 赞同：0
> 
> 时间：2009-05-11T17:49:40.620
> 
> 标签：php, arrays

我正在尝试为设置的 array1 的值**合并两个数组**

```
Array1 ( [0] => false [1] => 200 )
Array2 ( [0] => true [1] => 80 [2] => 60 [3] => 75 [4] => 50 [5] => 0 [6] => 0 [7] => 30 [8] => 40 ) 
```

例如结果数组：

```
Array3 ( [0] => false [1] => 200 [2] => 60 [3] => 75 [4] => 50 [5] => 0 [6] => 0 [7] => 30 [8] => 40 ) 
```

什么是处理这个问题的有效方法。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:05:28.580

使用数组联合运算符。

```
$array3 = $array1 + $array2; 
```

# silverlight - 寻找绑定到表的 silverlight 树控制示例

> ID：849228
> 
> 赞同：0
> 
> 时间：2009-05-11T17:50:34.253
> 
> 标签：silverlight, silverlight-2.0

我找不到绑定到数据库表的 silverlight 2 树控件的示例。我有一个带有 ID 和 ParentID 列的表，我用它来填充 Windows 窗体中的树控件。我想对 silverlight 树控件执行相同的操作，但我找不到任何有关如何执行此操作的示例。大多数样本都有硬编码的节点。我不需要任何关于如何 wcf 数据表的建议，我非常了解那部分。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T07:43:33.090

我自己没有使用树控件，但我快速搜索了一下，发现以下站点[Populating Silverlight TreeView from WCF Service with LINQ to SQL](http://www.telerik.com/support/kb/silverlight/general/populating-treeview.aspx)

但是，它确实使用自定义类来存储数据，然后使用 LINQ to SQL 从数据表中提取数据以手动构建树视图。

希望这可以帮助

# php - PHP中的上传进度条

> ID：849237
> 
> 赞同：82
> 
> 时间：2009-05-11T17:51:24.220
> 
> 标签：php, upload, progress-bar

有谁知道如何在php中获取上传进度条？我正在尝试为相册上传器编写代码。我想在照片上传时显示一个进度条。

我对 php 相当陌生，所以我对它一无所知。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2010-10-16T23:06:22.163

这是迄今为止（经过数小时的谷歌搜索和尝试脚本）我发现的最简单的设置和最好的上传器

[https://github.com/FineUploader/fine-uploader](https://github.com/FineUploader/fine-uploader)

它不需要 APC 或任何其他外部 PHP 库，我可以在共享主机上获得文件进度反馈，并且它声称支持 html5 拖放（个人未经测试）和多个文件上传。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-01-21T18:44:17.227

如果您安装了[APC](http://php.net/apc)，它有一个用于上传进度的回调挂钩。

Rasmus Lerdorf（PHP 的创建者）有一个使用 YUI 的[示例](http://progphp.com/progress.php)（哦，这里是[PHP 源代码](http://progphp.com/progress.phps)）。

请参阅[此处的文档](http://php.net/manual/en/apc.configuration.php#ini.apc.rfc1867)。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-11T17:54:02.407

我很抱歉地说，据我所知，由于 PHP 的工作方式，纯 PHP 上传进度条，甚至是 PHP/Javascript 上传进度条是不可能的。您最好的选择是使用某种形式的 Flash 上传器。

AFAIK 这是因为在填充所有超全局变量（包括 $_FILES）之前不会执行您的脚本。当您的 PHP 脚本被调用时，文件已完全上传。

编辑：这不再是真的。那是在 2010 年。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-11-13T14:53:22.250

一种对我很有效的 PHP-ish (5.2+) & no-Flash 方式：

首先，请参阅[这篇](http://www.php.net/manual/en/features.file-upload.php#71564)文章，解释如何启动并运行“uploadprogress”扩展。

然后，在包含您从中上传文件的表单的页面中，创建以下 iframe：

```
<iframe id="progress_iframe" src="" style="display:none;" scrolling="no" frameborder="0"></iframe> 
```

接下来，将此代码添加到您的“提交”按钮：

```
onclick="function set() { f=document.getElementById('progress_iframe'); f.style.display='block'; f.src='uploadprogress.php?id=<?=$upload_id?>';} setTimeout(set);" 
```

现在您的表单中有一个隐藏的 iframe，当您单击“提交”开始上传文件时，它会显示并显示 uploadprogress.php 的内容。$upload_id 必须与您在表单中用作隐藏字段“UPLOAD_IDENTIFIER”的值相同。

uploadprogress.php 本身看起来像这样（修复并根据您的需要进行调整）：

```
<html>
<head>
<META HTTP-EQUIV='REFRESH' CONTENT='1;URL=?id=<?=$_GET['id']?>'>
</head>
<body>
Upload progress:<br />
<?php
    if(!$_GET['id']) die;
    $info = uploadprogress_get_info($_GET['id']);
    $kbytes_total = round($info['bytes_total'] / 1024);
    $kbytes_uploaded = round($info['bytes_uploaded'] / 1024);
    echo $kbytes_uploaded.'/'.$kbytes_total.' KB';
?>
</body>
</html> 
```

请注意，这是每秒自刷新一次。如果你愿意的话，你当然可以在这里添加一些漂亮的视觉进度条（比如 2 个嵌套的不同颜色的 <div>）。带有上传进度的 iframe 自然只在上传过程中工作，一旦提交表单并且浏览器重新加载到下一页，它的可见生命就结束了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-11-20T13:29:24.003

上传进度条的实现很简单，不需要任何额外的 PHP 扩展、JavaScript 或 Flash。但是**您需要 PHP 5.4 和更新版本**。

[`session.upload_progress.enabled`](http://php.net/manual/en/session.configuration.php#ini.session.upload-progress.enabled)您必须通过将指令设置为`On`in来启用上传进度信息的收集`php.ini`。

然后在任何其他文件输入*之前*向 HTML 上传表单添加隐藏输入。该隐藏输入的HTML 属性`name`应与[`session.upload_progress.name`](http://php.net/manual/en/session.configuration.php#ini.session.upload-progress.name)from指令的值相同`php.ini`（最终以 开头[`session.upload_progress.prefix`](http://php.net/manual/en/session.configuration.php#ini.session.upload-progress.prefix)）。该`value`属性取决于您，它将用作会话密钥的一部分。

HTML 表单可能如下所示：

```
<form action="upload.php" method="POST" enctype="multipart/form-data">
   <input type="hidden" name="<?php echo ini_get('session.upload_progress.prefix').ini_get('session.upload_progress.name'); ?>" value="myupload" />
   <input type="file" name="file1" />
   <input type="submit" />
</form> 
```

当您发送此表单时，PHP 应在`$_SESSION`超全局结构中创建一个新键，该键将填充上传状态信息。键是连接的`name`并且`value`是隐藏输入的。

在 PHP 中，您可以查看填充的上传信息：

```
var_dump($_SESSION[
    ini_get('session.upload_progress.prefix')
   .ini_get('session.upload_progress.name')
   .'_myupload'
]); 
```

输出将类似于以下内容：

```
$_SESSION["upload_progress_myupload"] = array(
  "start_time" => 1234567890,   // The request time
  "content_length" => 57343257, // POST content length
  "bytes_processed" => 54321,   // Amount of bytes received and processed
  "done" => false,              // true when the POST handler has finished, successfully or not
  "files" => array(
    0 => array(
      "field_name" => "file1",    // Name of the <input /> field
      // The following 3 elements equals those in $_FILES
      "name" => "filename.ext",
      "tmp_name" => "/tmp/phpxxxxxx",
      "error" => 0,
      "done" => false,            // True when the POST handler has finished handling this file
      "start_time" => 1234567890, // When this file has started to be processed
      "bytes_processed" => 54321, // Number of bytes received and processed for this file
    )
  )
); 
```

有创建进度条所需的所有信息——如果上传仍在进行中，您将获得信息、总共要传输多少字节以及已经传输了多少字节的信息。

为了向用户展示上传进度，除了上传脚本之外，编写另一个 PHP 脚本，它只会查看会话中的上传信息并以 JSON 格式返回。可以使用 AJAX 和呈现给用户的信息定期调用此脚本，例如每秒调用一次。

您甚至可以通过将 设置为 来取消`$_SESSION[$key]['cancel_upload']`上传`true`。

有关详细信息、附加设置和用户评论，请参阅[PHP 手册](http://php.net/manual/en/session.upload-progress.php)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-10T13:16:03.973

Gears 和 HTML5 在对象中有一个进度事件，`HttpRequest`用于通过 AJAX 提交文件上传。

[http://developer.mozilla.org/en/Using_files_from_web_applications](http://developer.mozilla.org/en/Using_files_from_web_applications)

其他人已经回答的其他选项是：

1.  基于 Flash 的上传器。
2.  基于 Java 的上传器。
3.  对 Web 服务器的第二个[彗星式](http://en.wikipedia.org/wiki/Comet_(programming))请求或报告接收数据大小的脚本。一些像 Lighttpd 这样的网络服务器提供了在进程内执行此操作的模块，以节省调用外部脚本或进程的开销。

从技术上讲，还有第四个选项，类似于 YouTube 上传，使用 Gears 或 HTML5，您可以使用 blob 将文件拆分为小块并单独上传每个块。完成每个块后，您可以更新进度状态。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-05-14T07:18:59.033

另一个上传者完整的JS：http: [//developers.sirika.com/mfu/](http://developers.sirika.com/mfu/ "http://developers.sirika.com/mfu/")

*   它是免费的（BSD许可证）
*   国际化
*   跨浏览器兼容
*   您可以选择是否安装 APC（underterminate 进度条 VS 确定进度条）
*   可定制的外观，因为它使用了 dojo 模板机制。您可以根据您的 css 在 te 模板中添加您的类/ID

玩得开心

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-03-24T22:05:13.673

HTML5 引入了一个[文件上传 api](http://www.matlus.com/html5-file-upload-with-progress/)，允许您监控文件上传的进度，但对于较旧的浏览器，有一个专门用于监控文件上传并提供有关它们的信息的框架[。](http://www.plupload.com/index.php)加上它有很多回调，所以它可以在所有浏览器上工作

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-11T17:56:33.743

您需要使用 Javascript 来创建进度条。一个简单的 Google 搜索让我看到了这篇文章：[WebAppers Simple Javascript Progress Bar with CSS](http://www.webappers.com/2007/07/31/webappers-simple-ajax-progress-bar-with-css/)。

[Dojo 文件上传进度条小部件](http://ajaxian.com/archives/dojo-file-upload-progress-bar-widget)是使用 Dojo Javascript 框架的另一个选项。

编辑：假设您上传了大量图像（例如相册），并将它们发布到您的 PHP 脚本，您可以使用 javascript 从帖子中读取结果并根据上传的图像数量更新进度条/ 图像总数。这具有仅在每个帖子完成后才更新的副作用。[在此处](http://mentaljetsam.wordpress.com/2008/06/02/using-javascript-to-post-data-between-pages/)查看有关如何使用 JS 发布的一些信息。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-11T18:06:41.683

可以做一个php/ajax进度条。（查看 pear 中的 Html_Ajax 库）。但是，这需要将自定义模块安装到 php.ini 中。

其他方法需要使用 iframe，php 通过 iframe 查看已上传的文件量。然而，这种隐藏的 iframe 可能会被某些浏览器插件阻止，因为隐藏的 iframe 通常用于向用户计算机发送恶意数据。

如果您无法控制服务器，最好的办法是使用某种形式的 flash 进度条。

# c++ - 如何解决“错误 LNK2019：未解析的外部符号”？

> ID：849238
> 
> 赞同：16
> 
> 时间：2009-05-11T17:51:42.770
> 
> 标签：c++, visual-c++, linker, static-libraries

我有我正在处理的这个 MFC 应用程序，它需要有一个嵌入式数据库。因此，我为它寻找一个光滑、快速的“可嵌入”数据库，并偶然发现了 SQLite。

我用它创建了一个数据库，并用 Visual Studio 2008 创建了一个静态库项目。该库项目将用于另一个主项目。

在库项目中，我创建了一个`DBClass`带有方法的类`AddFeedToDB(CFeed f)`。库项目使用`.lib`来自 codeproject ( `cppsqlite3.lib`) 的文件。

编译静态库时，没有检测到错误，但是当我尝试在主项目中使用库项目文件时，出现以下类型的错误：

```
error LNK2019: unresolved external symbol "public:void __thiscall
   CppSQLite3DB::close(void)" (?close@CppSQLite3DB@@QAEXXZ 
   referenced in function "public: int __thiscall
   CTalkingFeedsDB::AddFeedToDB(class CFeed,char const*)" (?
   AddFeedToDB@CTalkingFeedsDB@@QAEHVCFeed@@PDB@Z 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-06-28T12:39:00.093

我知道这个问题已经有 2 年了……但我在这里遇到了同样的情况。添加了所有头文件...添加了lib目录..并继续出现此错误。所以我手动将 lib 添加到配置属性 -> 链接器 -> 输入 -> 附加依赖项中，所有这些都对我有用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-12T19:37:06.113

在我身上不止一次发生过，我认为符号`XXX`(ie `?close@CppSQLite3DB@@QAEXXZ`)*在*导入库中，而实际符号是`__impXXX`(ie `__imp?close@CppSQLite3DB@@QAEXXZ`)。

然后在编译步骤中找到链接器错误的原因：编译器将生成`?close@CppSQLite3DB@@QAEXXZ`要导入的符号，它*应该*在哪里生成`__imp?close@CppSQLite3DB@@QAEXXZ`. 这通常意味着函数声明本身没有`__declspec( dllimport )`. 这可能是由于某些未定义的预处理器符号引起的。或者`__declspec`根本不存在...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-05-05T08:38:59.297

不知道是不是你的情况，但是 imp 前缀可能意味着你正在 Win32 项目中编译 x64 库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T19:41:32.817

编译器和链接器不会将一个库链接到另一个库（除非一个是 DLL）。您需要在主项目中指定这两个库（cppsqlite3.lib 和您自己的静态库）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T18:02:17.667

您需要将 codeproject SQLite lib 链接到您的可执行文件，或者将源文件直接包含在您的项目中。（你做了哪一个？）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T20:02:42.493

我会按照以下步骤操作：

1.  考虑一下您希望导出符号的库或 .obj 文件。

2.  检查它是否*确实*导出了那个符号（检查字符）。有时，调用约定不同。

3.  检查链接器是否知道您希望包含该符号的库 - 首先检查“附加库”，然后检查是否实际找到该库（我主要通过使用来自 sysinternals 的 filemon.exe 来执行此操作，并查找链接.exe 打开 lib 文件。）

想了想，你可能会发现你的库项目并*不会*导出所寻找的函数。该函数位于数据库库中。您应该将该库添加到您的主项目中。将它添加到您的静态库项目中是没有用的。

# svn - Subversion - 添加文本文件 - 文件状态 A (bin)

> ID：849239
> 
> 赞同：16
> 
> 时间：2009-05-11T17:51:46.950
> 
> 标签：svn

我不知道为什么我在文件状态中得到 (bin) - 我检查了文件并且没有特殊字符。添加和提交工作并且文件可能很好，但我只是觉得这很奇怪。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-11T18:00:02.677

来自[http://subversion.apache.org/faq.html#binary-files](http://subversion.apache.org/faq.html#binary-files)

> Subversion 将以下文件视为文本：
> 
> *   没有 svn:mime-type 的文件
> *   svn:mime 类型以“text/”开头的文件
> *   svn:mime-type 等于 "image/x-xbitmap" 的文件
> *   svn:mime-type 等于 "image/x-xpixmap" 的文件
> 
> 所有其他文件都被视为二进制文件，这意味着 Subversion 将：
> 
> *   在 svn update 或 svn merge 期间不尝试将接收到的更改与本地更改自动合并
> *   不显示差异作为 svn diff 的一部分
> *   不显示 svn blame 的逐行归属

检查您的文件扩展名/关联的 mime 类型。`svn:mime-type`您可以通过在 the 上执行一个不同于系统关联的 mime 类型的 propset 来强制它为文本。

# c# - 是否有将 ANSI C 代码转换为 C# 的工具？

> ID：849240
> 
> 赞同：5
> 
> 时间：2009-05-11T17:52:14.953
> 
> 标签：c#, c

我需要将一些 ANSI C 代码导入我正在处理的项目中。由于我不想进入的原因，我想将代码重构为 C#，而不是尝试包装原始代码。我可能需要几天的时间才能完成这项工作，但在我开始之前，是否有一个自动化工具可以帮助我完成大部分工作？我是个小气鬼，我所做的工作是无偿的，所以请只使用免费工具。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T18:38:38.700

如果手动重构“仅”需要几天时间，那将得到我的投票。根据 C 代码正在做什么以及它是如何编写的（指针、自定义库等），自动转换器可能只会弄得一团糟。解开这些混乱可能是一项比手工转换更大的任务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T22:52:46.147

GCC有一个实验性的[CLI 后端和前端](http://gcc.gnu.org/projects/cli.html)。它已经能够将 C 程序的子集编译成 CIL，即 CLR 运行的字节码。

（该网页使代码看起来好像只开发了几个月，然后从那时起就被忽略了，但它已经过时了；[ST Microelectronics](http://www.st.com/)正在继续维护和开发。）

您没有具体说明*为什么*需要 C 到 C# 转换器，但如果您只想让 C 和 C# 在没有 P/Invoke 或 COM 的情况下一起使用，它可能就足够了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:03:45.730

设置、清理、重构和简单地制作转换后的代码（如果甚至有可用的转换器）可能需要数周或数月的时间，因此您最好继续手动重写.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T03:55:57.663

从将现有代码编译为托管 C++ aka C++/CLI 开始可能是有意义的。假设一切顺利，那么你就有了一个可工作的、可测试的基础来构建。将关键特性移动到它们自己的类中，并根据需要一路重写为 C#。

# c# - C#剥离/转换一个或多个字符

> ID：849245
> 
> 赞同：4
> 
> 时间：2009-05-11T17:53:53.000
> 
> 标签：c#, parsing, character, strip

有没有一种快速的方法（无需显式循环遍历字符串中的每个字符）并剥离或保留它。在 Visual FoxPro 中，有一个函数 CHRTRAN() 做得很好。它以 1:1 的字符替换，但如果在替代位置没有字符，则将其从最终字符串中剥离。前任

CHRTRAN( "这将是一个测试", "it", "X" )

将返回

“ThXs wXll be a es”

注意原来的“i”被转换成“X”，小写的“t”被去掉了。

我查看了类似意图的替换，但没有看到任何替换的选项。

我正在寻找一些通用例程来验证具有不同类型输入限制的多个数据来源。一些数据可能来自外部来源，因此我需要测试的不仅仅是文本框输入验证。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T17:56:44.493

您只需要几次调用[String.Replace()](http://msdn.microsoft.com/en-us/library/system.string.replace.aspx)。

```
string s = "This will be a test";
s = s.Replace("i", "X");
s = s.Replace("t", ""); 
```

请注意，Replace()*返回*一个新字符串。它不会改变字符串本身。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T17:59:11.023

这是你想要的吗？

```
"This will be a test".Replace("i", "X").Replace("t", String.Empty) 
```

这是该函数的一个简单实现- 如果字符串包含并且非常混乱，则`CHRTRAN`它不起作用。`\0`您可以使用循环编写一个更好的，但我只是想尝试使用 LINQ。

```
public static String ChrTran(String input, String source, String destination)
{
    return source.Aggregate(
        input,
        (current, symbol) => current.Replace(
            symbol,
            destination.ElementAtOrDefault(source.IndexOf(symbol))),
        preResult => preResult.Replace("\0", String.Empty));
} 
```

你可以使用它。

```
// Returns "ThXs wXll be a es"
String output = ChrTran("This will be a test", "it", "X"); 
```

只是为了有一个干净的解决方案 - 在没有 LINQ 的情况下也一样，并且也适用于这些案例，并且由于使用 a但不会修改输入，`\0`它几乎就位。`StringBuilder`

```
public static String ChrTran(String input, String source, String destination)
{
    StringBuilder result = new StringBuilder(input);

    Int32 minLength = Math.Min(source.Length, destination.Length);

    for (Int32 i = 0; i < minLength; i++)
    {
        result.Replace(source[i], destination[i]);
    }

    for (Int32 i = minLength; i < searchPattern.Length; i++)
    {
        result.Replace(source[i].ToString(), String.Empty);
    }

    return result.ToString();
} 
```

缺少空引用处理。

受到 tvanfosson 解决方案的启发，我再次尝试了 LINQ。

```
public static String ChrTran(String input, String source, String destination)
{
    return new String(input.
        Where(symbol =>
            !source.Contains(symbol) ||
            source.IndexOf(symbol) < destination.Length).
        Select(symbol =>
            source.Contains(symbol)
                ? destination[source.IndexOf(symbol)]
                : symbol).
        ToArray());
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-13T01:47:51.023

这是我的最终功能，并且可以按预期完美运行。

```
public static String ChrTran(String ToBeCleaned, 
                             String ChangeThese, 
                             String IntoThese)
{
   String CurRepl = String.Empty;
   for (int lnI = 0; lnI < ChangeThese.Length; lnI++)
   {
      if (lnI < IntoThese.Length)
         CurRepl = IntoThese.Substring(lnI, 1);
      else
         CurRepl = String.Empty;

      ToBeCleaned = ToBeCleaned.Replace(ChangeThese.Substring(lnI, 1), CurRepl);
   }
   return ToBeCleaned;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-11T19:38:26.387

在这种情况下，我认为使用 LINQ 会使事情变得过于复杂。这很简单，也很重要：

```
private static string Translate(string input, string from, string to)
{
    StringBuilder sb = new StringBuilder();
    foreach (char ch in input)
    {
        int i = from.IndexOf(ch);
        if (from.IndexOf(ch) < 0)
        {
            sb.Append(ch);
        }
        else
        {
            if (i >= 0 && i < to.Length)
            {
                sb.Append(to[i]);
            }
        }
    }
    return sb.ToString();
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-11T17:59:11.680

要“替换为空”，只需替换为空字符串即可。这会给你：

```
String str = "This will be a test";
str = str.Replace("i", "X");
str = str.Replace("t",""); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-11T18:20:51.473

作为字符串扩展的更通用的版本。像其他人一样，这不会进行适当的翻译，因为字符串在 C# 中是不可变的，而是返回一个带有指定替换的新字符串。

```
public static class StringExtensions
{
    public static string Translate( this string source, string from, string to )
    {
        if (string.IsNullOrEmpty( source ) || string.IsNullOrEmpty( from ))
        {
            return source;
        }

        return string.Join( "", source.ToCharArray()
                                   .Select( c => Translate( c, from, to ) )
                                   .Where( c => c != null )
                                   .ToArray() );
    }

    private static string Translate( char c, string from, string to )
    {
        int i = from != null ? from.IndexOf( c ) : -1;
        if (i >= 0)
        {
            return (to != null && to.Length > i)
                      ? to[i].ToString()
                      : null;
        }
        else
        {
            return c.ToString();
        }
    }
} 
```

# .net - 如何将 .net XML 文档保存到带有 & 的路径

> ID：849253
> 
> 赞同：0
> 
> 时间：2009-05-11T17:55:16.680
> 
> 标签：.net, encoding, string

我正在[使用 Save (string) function 将](http://msdn.microsoft.com/en-us/library/dw229a22.aspx)XMLDocument 对象保存到磁盘。当我这样做时，我收到“找不到路径的一部分”错误。

我尝试将字符传递为“&”、“&”、“%26”、“\26”和“\38”。我错过了什么？请注意，我不是在谈论文件的*内容*——而是文件名。

```
Dim todocument As New Xml.XmlDocument
todocument.LoadXml(fromXml.OuterXml)
todocument.Save(toPath) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T18:02:21.737

& （和号）放在文件名/路径中是完全合法的。2 件事要检查。

1.  确保目标文件夹在那里
2.  尝试将其保存到文件流对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:08:40.760

我的特殊问题不是 & 没有被编码——我在路径中的 '\' 被编码并且它们不应该被编码。

# java - 在 ANTLR 2.7 中构建 C# 示例需要帮助

> ID：849255
> 
> 赞同：1
> 
> 时间：2009-05-11T17:55:49.207
> 
> 标签：java, nant, antlr

我需要构建 ANTLR v 2.7.7 附带的 CSHARP V1 示例。

命令：
D:\Comp\antlr\examples\csharp\csharp_v1>nant

我得到以下输出：

 ``D:\Comp\antlr\examples\csharp\csharp_v1>D:\Comp\nant\bin\nant NAnt 0.85 (Build 0.85.2478.0; release; 10/14/2006) Copyright (C) 2001-2006 Gerry Shaw [http://nant.sourceforge.net](http://nant.sourceforge.net)

Buildfile: file:///D:/Comp/antlr/examples/csharp/csharp_v1/csharp_v1.build Target framework: Microsoft .NET Framework 2.0 Target(s) specified: test

[tstamp] Monday, May 11, 2009 11:21:20 PM. [echo] Building project: 'CSharp v1 Grammar Sample for ANTLR' generate: [exec] java.lang.NoClassDefFoundError: antlr/Tool [exec] Caused by: java.lang.ClassNotFoundException: antlr.Tool [exec] at java.net.URLClassLoader$1.run(Unknown Source) [exec] at java.security.AccessController.doPrivileged(Native Method) [exec] at java.net.URLClassLoader.findClass(Unknown Source) [exec] at java.lang.ClassLoader.loadClass(Unknown Source) [exec] at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source) [exec] at java.lang.ClassLoader.loadClass(Unknown Source) [exec] at java.lang.ClassLoader.loadClassInternal(Unknown Source) [exec] Could not find the main class: antlr.Tool. Program will exit. [exec] Exception in thread "main"

BUILD FAILED - 0 non-fatal error(s), 11 warning(s)

D:\Comp\antlr\examples\csharp\csharp_v1\csharp_v1.build(52,10): External Program Failed: java.exe (return code was 1)

Total time: 0.2 seconds.`  `我让 nANT 在其他版本中正常工作。

我不是 java 人...任何帮助都会有所帮助。

亲切的问候，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T22:48:25.443

查看 make 文件 csharp_v1.build。

在第 10 行将其更改为：

`<property name="antlr.dir" value="..\..\.."/>`

至

`<property name="antlr.dir" value="..\..\..\antlr.jar"/>`

# jquery - Pikachoose jquery 幻灯片放映插件在 IE 中不起作用

> ID：849262
> 
> 赞同：0
> 
> 时间：2009-05-11T17:57:17.127
> 
> 标签：jquery

我正在使用 pikachoose 一个用于图片幻灯片放映的 jquery 插件，但它在 IE 6,7 中不起作用。

[这是链接](http://pwiser.com/pikame/pikachoose_test.html)。

我想使用`user_thumbs`Pikachoose 的选项，它在 FF 中可以正常工作，但在 IE 6、7 中不行。请帮忙。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-25T19:33:11.463

您是否尝试过更新您的 Pikachoose 版本？我注意到您使用的是 2009 年 4 月 1 日的一个。他已经更新了它，最近的版本是从 2010 年 5 月 11 日开始的。你可以在这里下载。[http://pikachoose.com/下载](http://pikachoose.com/download)3.2版

# git - 你需要创建一个分支来检查一个特定的 git 版本吗？

> ID：849265
> 
> 赞同：22
> 
> 时间：2009-05-11T17:57:28.780
> 
> 标签：git

我想做的一件常见的事情是将我的工作副本恢复到特定的修订版，进行一些测试，然后将其带回我当前主人的脑海中。过去，我天真地做了一个“git checkout hash”，结果却迷失了方向。从那以后我了解到我可以创建一个分支并检查它，切换回并删除该分支，但是对于简单的检查来说感觉步骤太多了。用 SVN 的话来说，有没有办法快速还原，然后快速回到 git 中的树干尖端？

**编辑：**我认为我的困惑源于这样一个事实，即当我签出一个哈希然后 git log 时，我没有看到在签出哈希之后发生的变化（这是合理的，当你想到它时）。但是公认的答案是正确的；“git checkout branch”会将头部恢复到前一个分支。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-12T00:33:21.740

假设你已经在一个分支上（你应该总是为了你想要保留的更改），你可以这样做

```
git checkout <revision to check out> 
```

这将使您脱离您正在处理的主题分支（无分支），其中工作副本直接引用提交 ID 而不是正常的分支名称。

然后向后移动，只需：

```
git checkout <old branch name> 
```

一个有用的想法是： git checkout 从不改变分支；它只是改变你的工作副本当前正在查看的内容（即 HEAD），它可能是一个分支（在这种情况下，提交将更新分支）或随机提交哈希。

因此，只要您想要保留的更改位于分支上，您就不必担心 git checkout 会丢失它们。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-06-06T13:36:48.540

您可以在要签出的特定提交处创建一个分支（来自手册页）

```
git branch [--set-upstream | --track | --no-track] [-l] [-f] <branchname> [<start-point>] 
```

所以填写`<start-point>`你希望你的新分支`<branchname>`开始的SHA1，你不会让你的“头”与扩展的分支分离。

您可能还需要做其他事情来将一些工作文件保持在您想要的状态......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T20:43:24.050

是的，您可以按照您的描述使用“git checkout”访问任意修订。但是，如果您要求任意修订而不是分支，那么 git 将没有任何明显的方法来跟踪您所做的更改。您可以通过查阅 reflog（“git reflog show”）来查看您之前的位置 - 但一般来说，您之前应该在一个分支上，所以大概只是想用“git checkout master”或类似的东西改回那个分支。

请注意，此方法不会自动处理您工作区中未提交的更改——在分支之间移动之前提交或存储您的更改，或者在您移动时使用“git checkout -m”携带它们（并准备好处理如果您进行的更改不是微不足道的，则合并冲突）。

我认为最近的 git 版本引入了“我上次搬家之前在哪里”的简写“@{-1}”，在这种情况下，这实际上可能是你想要的。（我没有使用它，只是在发行说明中阅读它）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T18:13:32.780

如果您希望 Git 显示某行更改的提示，则需要对其进行分支或标记。但即使您不创建分支，也不会丢失任何提交。它作为垃圾节点保留在存储库中（即无法通过任何分支或标签访问），并且仅在您执行“git gc”的几天/几周后被删除。

因此，如果您想轻松访问更改，最好创建一个临时分支并在那里工作。如果你在一个分支之外提交然后签出另一个分支，那么你需要使用命令“git reflog”或查看日志（“.git/logs”目录）来找出更改的哈希值是什么你输了。当您知道哈希时，您可以执行“git checkout hash”或“git checkout -b new_branch hash”并恢复小费。

# scala - 如何创建具有类类型参数的地图

> ID：849267
> 
> 赞同：0
> 
> 时间：2009-05-11T17:57:49.187
> 
> 标签：scala

我正在尝试做这样的事情：

```
import scala.swing

class componentMapper {

     val map = Map[Class[_], Componenet]()

     def apply(c: Class[_], component: Component) = map += (c -> componenet)

}

class Render extends ComponentMapper {

     def getRenderer(value: AnyRef) = map(value.getClass)

} 
```

这似乎不起作用。我应该为 Class 使用什么类型参数？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T20:24:42.567

我不完全确定核心问题是什么，但它不是类的类型参数。“->”似乎是一些奇怪的类型推断问题。以下编译并正常工作。

```
import scala.swing._

class ComponentMapper {
  var map = Map[Class[_], Component]()
  def apply(c: Class[_], component: Component) = map += ((c, component))
}

class Render extends ComponentMapper {
  def getRenderer(value: AnyRef) = map(value.getClass)
} 
```

请注意，我必须对您的代码进行许多小的更正，才能找到您所说的问题。

我已经提交了一张票，以防万一它是可以修复的：[https](https://lampsvn.epfl.ch/trac/scala/ticket/1974) ://lampsvn.epfl.ch/trac/scala/ticket/1974 。

# sqlite - SQLITE：无法删除未命名的主键

> ID：849269
> 
> 赞同：2
> 
> 时间：2009-05-11T17:58:13.053
> 
> 标签：sqlite

我有一个最初创建的 sqlite 表：

```
PRIMARY KEY (`column`); 
```

我现在需要删除该主键并创建一个新键。创建一个新的很容易，但删除原来的似乎是困难的部分。如果我做

```
.indices  tablename 
```

我没有得到主键。一些程序将主键显示为

```
Indexes: 1
    [] PRIMARY 
```

索引名称通常位于`[]`.

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-21T10:15:16.383

你不能。

```
PRAGMA INDEX_LIST('MyTable'); 
```

会给你一个索引列表。这将包括为主键自动生成的索引，称为`'sqlite_autoindex_MyTable_1'`.

但不幸的是，您不能删除此索引...

```
sqlite> drop index sqlite_autoindex_MyTable_1;
SQL error: index associated with UNIQUE or PRIMARY KEY constraint cannot be dropped 
```

您所能做的就是重新创建没有主键的表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-26T18:10:25.903

I 数据库词汇表；主键是一种索引，其中索引顺序通常会导致原始数据库记录的物理排序。也就是说，任何允许更改主键的数据库引擎都可能会重新排序数据库......所以大多数都不会，操作取决于程序员创建一个脚本来重命名表并创建一个新的。所以如果你想改变PK没有神奇的SQL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T18:09:39.417

```
select * from sqlite_master;
table|x|x|2|CREATE TABLE x (a text, b text, primary key (`a`))
index|sqlite_autoindex_x_1|x|3| 
```

您会看到我的快速 hack 返回的第二行在第二列中包含索引名称，在第三列中包含表名称。试试看这个名字是否有用。

# c# - Castle Active Record：SQL Express 不起作用。SQL 开发人员可以

> ID：849272
> 
> 赞同：0
> 
> 时间：2009-05-11T17:59:07.530
> 
> 标签：c#, sql-server-express, castle-activerecord

几天来，我一直在尝试解决 Castle ActiveRecord 异常。每当我尝试访问数据库时，我都会收到一个 InnerException 值为`"An attempt to attach an auto-named database for file database.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share."`

我正在尝试连接到 SQL Server Express 2005 数据库。我没有任何其他数据库选项，因为学校计算机上只有 SQL Express。

我的连接设置

```
hibernate.connection.driver_class
  NHibernate.Driver.SqlClientDriver

hibernate.dialect

  NHibernate.Dialect.MsSql2005Dialect
hibernate.connection.provider
  NHibernate.Connection.DriverConnectionProvider

hibernate.connection.connection_string
  Data Source=.\SQLExpress;Integrated Security=True;User Instance=True;AttachDBFilename=database.mdf 
```

即使我将 AttachDBFilename 设置为绝对路径，这也无法正常工作。用户实例无效。数据库文件当前位于项目的根目录中，与我的 WinForms 类混合在一起。

使用时

```
hibernate.connection.connection_string
  Data Source=localhost;Initial Catalog=FinalApp;Integrated Security=True;Pooling=False 
```

我在笔记本电脑上执行此操作没有任何问题，但我无法在学校计算机上使用 SQL Server 2005 开发人员版。

根据要求进行全栈跟踪

```
Castle.ActiveRecord.Framework.ActiveRecordException was unhandled
  Message="Could not perform FindAll for Book"
  Source="Castle.ActiveRecord"
  StackTrace:
       at Castle.ActiveRecord.ActiveRecordBase.FindAll(Type targetType, Order[] orders, ICriterion[] criteria) in c:\dev\castle\svn\branches\1.0.x\ActiveRecord\Castle.ActiveRecord\Framework\ActiveRecordBase.cs:line 1022
       at Castle.ActiveRecord.ActiveRecordBase.FindAll(Type targetType) in c:\dev\castle\svn\branches\1.0.x\ActiveRecord\Castle.ActiveRecord\Framework\ActiveRecordBase.cs:line 982
       at Castle.ActiveRecord.ActiveRecordBase`1.FindAll() in c:\dev\castle\svn\branches\1.0.x\ActiveRecord\Castle.ActiveRecord\Framework\ActiveRecordBase.Generic.cs:line 333
       at CSharpFinal.InventoryMain.InventoryMain_Load(Object sender, EventArgs e) in C:\Documents and Settings\Administrator\My Documents\Visual Studio 2005\Projects\CSharpFinal\InventoryMain.cs:line 36
       at System.Windows.Forms.Form.OnLoad(EventArgs e)
       at System.Windows.Forms.Form.OnCreateControl()
       at System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible)
       at System.Windows.Forms.Control.CreateControl()
       at System.Windows.Forms.Control.WmShowWindow(Message& m)
       at System.Windows.Forms.Control.WndProc(Message& m)
       at System.Windows.Forms.ScrollableControl.WndProc(Message& m)
       at System.Windows.Forms.ContainerControl.WndProc(Message& m)
       at System.Windows.Forms.Form.WmShowWindow(Message& m)
       at System.Windows.Forms.Form.WndProc(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m)
       at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)
       at System.Windows.Forms.SafeNativeMethods.ShowWindow(HandleRef hWnd, Int32 nCmdShow)
       at System.Windows.Forms.Control.SetVisibleCore(Boolean value)
       at System.Windows.Forms.Form.SetVisibleCore(Boolean value)
       at System.Windows.Forms.Control.Show()
       at CSharpFinal.Form1.inventoryToolStripMenuItem_Click(Object sender, EventArgs e) in C:\Documents and Settings\Administrator\My Documents\Visual Studio 2005\Projects\CSharpFinal\Form1.cs:line 51
       at System.Windows.Forms.ToolStripItem.RaiseEvent(Object key, EventArgs e)
       at System.Windows.Forms.ToolStripMenuItem.OnClick(EventArgs e)
       at System.Windows.Forms.ToolStripItem.HandleClick(EventArgs e)
       at System.Windows.Forms.ToolStripItem.HandleMouseUp(MouseEventArgs e)
       at System.Windows.Forms.ToolStripItem.FireEventInteractive(EventArgs e, ToolStripItemEventType met)
       at System.Windows.Forms.ToolStripItem.FireEvent(EventArgs e, ToolStripItemEventType met)
       at System.Windows.Forms.ToolStrip.OnMouseUp(MouseEventArgs mea)
       at System.Windows.Forms.ToolStripDropDown.OnMouseUp(MouseEventArgs mea)
       at System.Windows.Forms.Control.WmMouseUp(Message& m, MouseButtons button, Int32 clicks)
       at System.Windows.Forms.Control.WndProc(Message& m)
       at System.Windows.Forms.ScrollableControl.WndProc(Message& m)
       at System.Windows.Forms.ToolStrip.WndProc(Message& m)
       at System.Windows.Forms.ToolStripDropDown.WndProc(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m)
       at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)
       at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG& msg)
       at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)
       at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)
       at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)
       at System.Windows.Forms.Application.Run(Form mainForm)
       at CSharpFinal.Program.Main() in C:\Documents and Settings\Administrator\My Documents\Visual Studio 2005\Projects\CSharpFinal\Program.cs:line 17
       at System.AppDomain.nExecuteAssembly(Assembly assembly, String[] args)
       at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
       at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart()

Castle.ActiveRecord.Framework.ActiveRecordException was unhandled
  Message="Could not create the schema"
  Source="Castle.ActiveRecord"
  StackTrace:
       at Castle.ActiveRecord.ActiveRecordStarter.CreateSchema() in c:\dev\castle\svn\branches\1.0.x\ActiveRecord\Castle.ActiveRecord\Framework\ActiveRecordStarter.cs:line 212
       at CSharpFinal.Form1.reInitializeDatabaseToolStripMenuItem_Click(Object sender, EventArgs e) in C:\Documents and Settings\Administrator\My Documents\Visual Studio 2005\Projects\CSharpFinal\Form1.cs:line 65
       at System.Windows.Forms.ToolStripItem.RaiseEvent(Object key, EventArgs e)
       at System.Windows.Forms.ToolStripMenuItem.OnClick(EventArgs e)
       at System.Windows.Forms.ToolStripItem.HandleClick(EventArgs e)
       at System.Windows.Forms.ToolStripItem.HandleMouseUp(MouseEventArgs e)
       at System.Windows.Forms.ToolStripItem.FireEventInteractive(EventArgs e, ToolStripItemEventType met)
       at System.Windows.Forms.ToolStripItem.FireEvent(EventArgs e, ToolStripItemEventType met)
       at System.Windows.Forms.ToolStrip.OnMouseUp(MouseEventArgs mea)
       at System.Windows.Forms.ToolStripDropDown.OnMouseUp(MouseEventArgs mea)
       at System.Windows.Forms.Control.WmMouseUp(Message& m, MouseButtons button, Int32 clicks)
       at System.Windows.Forms.Control.WndProc(Message& m)
       at System.Windows.Forms.ScrollableControl.WndProc(Message& m)
       at System.Windows.Forms.ToolStrip.WndProc(Message& m)
       at System.Windows.Forms.ToolStripDropDown.WndProc(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m)
       at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m)
       at System.Windows.Forms.NativeWindow.DebuggableCallback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam)
       at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG& msg)
       at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)
       at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)
       at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)
       at System.Windows.Forms.Application.Run(Form mainForm)
       at CSharpFinal.Program.Main() in C:\Documents and Settings\Administrator\My Documents\Visual Studio 2005\Projects\CSharpFinal\Program.cs:line 17
       at System.AppDomain.nExecuteAssembly(Assembly assembly, String[] args)
       at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
       at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart() 
```

`InnerException.Message`是`"An attempt to attach an auto-named database for file database.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share."`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T20:26:14.170

嗯，这是一种猜测，但是您需要指定数据库名称吗？（连接字符串中的初始目录）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:01:34.807

这可能是因为您的 SQL Express 连接字符串正在关闭用户实例。如果您打开用户实例，则 SQL 将在需要时附加数据库，如果没有，它只会打开它。如果您将其关闭，则附加是永久性的。任何再次使用相同连接字符串的尝试都将导致错误，因为数据库已经存在。
因为您没有使用该连接字符串附加数据库，所以您需要先分离数据库，然后才能使用正确的连接字符串。如果您还没有，我建议您下载 SQL Management Studio Express。这将让您看到已附加的数据库并轻松将其分离。

好的，如果这不是问题，SQL Server 可以访问数据库文件吗？它有对该文件夹的权限吗？它通常作为网络服务运行，您可以像任何其他用户一样授予对文件的访问权限。您可以通过授予每个人完全控制权来消除文件权限问题，如果可以解决问题，那么您可以将权限调整为所需的权限。我猜想 SQL 服务器服务帐户将需要 .mdf 文件的修改权限。我不知道它在哪里为用户实例数据库创建 .ldf。它可能需要在与 .mdf 相同的文件夹中创建文件权限。

# physics - 弹跳球不符合能量守恒定律

> ID：849276
> 
> 赞同：3
> 
> 时间：2009-05-11T17:59:44.520
> 
> 标签：physics, simulator, bounce

我目前正忙于为我的 Win32 API 和 c++ 编程课程编写一个小球物理引擎。我已经完成了 GDI backbuffer 渲染器和整个 GUI（还有一些需要调整的东西），但我非常接近完成。最后唯一的大障碍是球对球的碰撞（但我可以自己解决这个问题），但其中最大的问题是球的弹跳。发生了什么是我扔了一个球，它真的掉了，但是一旦它弹起来，它会弹得比我释放它的点高？？？有趣的是，它只有在低于一定高度时才会发生。这部分是物理代码：（如果您需要更多代码或解释，请询问，但如果你们能看看我的代码，我将不胜感激。）

```
#void RunPhysics(OPTIONS &o, vector<BALL*> &b)
{ 
    UINT simspeed = o.iSimSpeed;
    DOUBLE  DT; //Delta T
    BOOL bounce; //for playing sound

    DT= 1/o.REFRESH;

    for(UINT i=0; i<b.size(); i++)
    {
        for(UINT k=0; k<simspeed; k++)
        {           
            bounce=false;

            //handle the X bounce
            if( b.at(i)->rBall.left <= 0 && b.at(i)->dVelocityX < 0 ) //ball bounces against the left wall
            {
                b.at(i)->dVelocityX = b.at(i)->dVelocityX * -1 * b.at(i)->dBounceCof;
                bounce=true;
            }
            else if( b.at(i)->rBall.right >= SCREEN_WIDTH && b.at(i)->dVelocityX > 0) //ball bounces against the right wall
            {           
                b.at(i)->dVelocityX = b.at(i)->dVelocityX * -1 * b.at(i)->dBounceCof;
                bounce=true;
            }
            //handle the Y bounce
            if( b.at(i)->rBall.bottom >= SCREEN_HEIGHT && b.at(i)->dVelocityY > 0 ) //ball bounces against the left wall
            {
                //damping of the ball
                if(b.at(i)->dVelocityY < 2+o.dGravity/o.REFRESH)
                {
                    b.at(i)->dVelocityY = 0;
                }

                //decrease the Velocity of the ball according to the bouncecof
                b.at(i)->dVelocityY = b.at(i)->dVelocityY * -1*b.at(i)->dBounceCof;
                b.at(i)->dVelocityX = b.at(i)->dVelocityX * b.at(i)->dBounceCof;

                bounce=true;
            }

            //gravity
            b.at(i)->dVelocityY += (o.dGravity)/o.REFRESH;
            b.at(i)->pOrigin.y += b.at(i)->dVelocityY + (1/2)*o.dGravity/o.REFRESH*DT*METER; 
            //METER IS DEFINED GLOBALLY AS 100 which is the amount of pixels in a meter

            b.at(i)->pOrigin.x += b.at(i)->dVelocityX/o.REFRESH*METER; 

            b.at(i)->UpdateRect();
        }
    }
    return;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T18:20:58.900

您正在使用欧拉积分方法。您的时间步长 (DT) 可能太大。此外，更新 Y 坐标的行似乎也有错误：

```
 b.at(i)->pOrigin.y += b.at(i)->dVelocityY + (1/2)*o.dGravity/o.REFRESH*DT*METER; 
```

您已经将重力添加到速度，因此您不需要将其添加到位置，并且您没有将速度乘以 DT。它应该是这样的：

```
 b.at(i)->pOrigin.y += b.at(i)->dVelocityY * DT; 
```

此外，对于单位（使用 METER 的方式）似乎有些混淆。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T18:09:58.870

好的，这里有几件事。

你有不同的代码路径来反弹左墙和右墙，但代码是相同的。组合这些代码路径，因为代码是相同的。

至于您的基本问题：我怀疑您的问题源于您在施加任何阻尼力/反弹力之后施加重力的事实。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:26:52.587

你什么时候打电话给 RunPhysics？在计时器循环中？这段代码只是一个近似值，没有精确计算。在 delta t 的短暂间隔内，球已经稍微改变了他的位置和速度，这在您的算法中没有考虑到，并且几乎不会产生错误。您必须计算球落地前的时间并预测变化。

并且重力已经包含在速度中，所以这里不要加两次：

`b.at(i)->pOrigin.y += b.at(i)->dVelocityY + (1/2)*o.dGravity/o.REFRESH*DT*METER;`

顺便说一句：将 b.at(i) 保存在一个临时变量中，这样您就不必在每一行都重新计算它。

```
Ball* CurrentBall = b.at(i); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T21:56:26.263

# 回答！！回答！！回答！！但我忘记了我的其他帐户，所以我无法标记它:-(

感谢所有伟大的回复，它真的帮助了我很多！您给出的答案确实是正确的，我的几个公式是错误的，并且可以进行一些代码优化，但没有一个是真正解决问题的方法。所以我只是拿着一张纸坐下来，开始计算我手动从程序中得到的每个值，花了我大约两个小时：O 但我确实找到了解决问题的方法：问题是当我更新我的速度时（使用更正的代码）我得到一个十进制值，完全没有问题。后来我通过添加速度乘以 Delta T 来增加 Y 中的位置，这是一个非常小的值。结果是需要添加的非常小的值。现在的问题是，如果您在 Win32 中绘制 Elipse()，则该点为 LONG，因此所有十进制值都将丢失。这意味着只有在很长一段时间后，当速度值开始从十进制值中出现时，会发生一些事情，并且除此之外，你丢球越高，结果就越好（我的症状之一）这个问题的解决方案非常简单，增加了一个额外的 DOUBLE我的 Ball 类的值，其中包含我的球的真实位置（包括小数）。在 RenderFrame() 期间，您只需使用 double 的下限或上限值来绘制椭圆，但对于所有计算，您都使用 Double 值。再次感谢您的所有回复，STACKOVERFLOW PEOPLE ROCK！！！向我的 Ball 类添加一个额外的 DOUBLE 值，其中包含我的球的真实位置（包括小数）。在 RenderFrame() 期间，您只需使用 double 的下限或上限值来绘制椭圆，但对于所有计算，您都使用 Double 值。再次感谢您的所有回复，STACKOVERFLOW PEOPLE ROCK！！！向我的 Ball 类添加一个额外的 DOUBLE 值，其中包含我的球的真实位置（包括小数）。在 RenderFrame() 期间，您只需使用 double 的下限或上限值来绘制椭圆，但对于所有计算，您都使用 Double 值。再次感谢您的所有回复，STACKOVERFLOW PEOPLE ROCK！！！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T20:05:25.560

在刚体模拟中，您需要在碰撞瞬间运行积分，然后调整速度以避免碰撞时的穿透，然后恢复积分。掩盖刚体是近似值的事实是一种瞬间的组合。（一个真正的球在碰撞过程中会变形。这很难建模，而且对于大多数目的来说是不必要的。）

您正在结合这两个步骤（整合力和解决碰撞）。对于您展示的简单模拟，在您处理垂直反弹的任何迭代中跳过重力位可能就足够了。

在更高级的模拟中，您将在实际碰撞实例中拆分包含碰撞的任何间隔 (dt)。积分直到碰撞，然后解决碰撞（通过调整速度），然后积分剩余的时间间隔。但这看起来对你的情况来说有点过分了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T18:42:56.837

我不认为你的位置方程是正确的：

```
 b.at(i)->dVelocityY += (o.dGravity)/o.REFRESH; 
```

这是`v=v0+gt`- 看起来不错，虽然我会写`dGravity*DT`而不是`dGravity/REFRESH_FREQ`.

```
 b.at(i)->pOrigin.y += b.at(i)->dVelocityY + (1/2)*o.dGravity/o.REFRESH*DT*METER; 
```

但这似乎不对：它相当于 `p = p0+v + 1/2gt^2`.

*   你应该乘以速度*时间来获得正确的单位
*   您正在按像素/米缩放重力项，而不是速度项。所以这也应该乘以 METER
*   您在更新速度时已经考虑了重力的影响，因此您无需再次添加重力项。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T19:14:52.430

感谢您的快速回复！！！抱歉，我应该更清楚一点，RunPhysics 是在 PeekMessage 之后运行的。我还添加了一个帧限制器，以确保每秒执行的计算不会超过显示器的刷新率。因此，我的 dleta t 是 1 秒除以刷新率。也许我的DT实际上太小无法计算，虽然它是一个double值？？？我的补偿系数是可调的，但从 0.9 开始

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T19:39:14.357

您需要重新计算反弹时的位置，以确保您从墙上的正确位置反弹。

即解决反弹发生的确切时间点，并根据该方向变化（部分进入计算“框架”）计算新的速度/位置，以确保您的球不会越来越多地移动“超出”墙壁在每次反弹。

Wrt time step，您可能想在[这里查看我的答案](https://stackoverflow.com/questions/622604/best-approach-for-game-animation/622626#622626)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T18:10:15.157

如果您的 dBounceCof > 1，那么是的，您的球会弹得更高。我们没有能够回答您的问题的所有价值观。

# internet-explorer - 直接访问时 URL 正确加载，但不能在 IE8 和 Safari 中的 iframe 中加载

> ID：849280
> 
> 赞同：2
> 
> 时间：2009-05-11T18:00:17.700
> 
> 标签：internet-explorer, iframe, safari

我试图模仿 Facebook 的一个非常简单的功能。当您单击某人共享的链接时，您将被带到一个页面，该页面顶部有一个 Facebook 工具栏，而实际页面在 iframe 中加载在它下方。我正在使用的 url 有正在传递的参数，所以它最终是：

```
<iframe src="https://example.com/login.php?uname=uname&pw=pw&key=1234"></iframe> 
```

如果我直接访问 url（在地址栏中），它可以工作，但如果我在 iframe 中这样做，它不会（我被带到网站的主页）。Firefox、Opera 和 Chrome 运行正常，但 IE 不能，令人惊讶的是，Safari 也不能。现在，如果我直接访问 url，然后尝试 iframe 方法，IE 和 Safari 的行为与预期一样，但这不是一个理想的解决方案。

有任何想法吗？我尝试使用 JS 设置 src，但没有运气。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T04:30:24.777

这听起来像是 IE IFrame 由于降低了隐私而拒绝 cookie 的问题。如果是这种情况，这是[这篇文章](https://stackoverflow.com/questions/389456/cookie-blocked-not-saved-in-iframe-in-internet-explorer)的副本，您应该能够使用那里找到的解决方案。

# javascript - Javascript 打破 Firefox？

> ID：849281
> 
> 赞同：1
> 
> 时间：2009-05-11T18:00:34.063
> 
> 标签：javascript, firefox, browser

在过去的 6 个月中，大约 5 次，在复杂的 javascripts 中，我只会在 firefox 中得到一个错误（IE6、7、8、Chrome、Safari、Opera 都很好），而我的 javascript 中没有任何事情发生。

错误控制台中不会有任何消息，根据 Firebug，我所有的脚本都是空白的。强制重新加载和清除缓存没有帮助。发生这种情况时，我通常只是恢复到以前的版本，然后再次开始我的最后一次编辑。

*   它在 Firefox 3 中发生最多。在 FF2 和 FF3.5b 中确实发生了一点，但程度不同。
*   我发现的唯一常见链接是所有更改都涉及修改在 jQuery 的 $(document).ready() 方法中运行的代码。
*   这有两次导致浏览器锁定和崩溃。
*   其他浏览器甚至都没有在错误日志中报告警告。

有没有其他人注意到这种情况发生？有具体原因吗？还是有一些firefox错误负责？

编辑：最新的 Firefox 杀戮变化

从

```
var coord_array = jsc.core.coordsFromId($(e.target).attr("id"));
$("#co-ords").html("X:" + coord_array[0] + " Y:" + coord_array[1]);
jsc.data.last_mouse_over = { x: coord_array[0], y: coord_array[1]}; 
```

到

```
var coord_array = jsc.core.coordsFromId($(e.target).attr("id"));
$("#co-ords").html("X:" + coord_array[0] + " Y:" + coord_array[1]);
var cellX = parseInt(coord_array[0], 10);
var cellY = parseInt(coord_array[1], 10);
jsc.data.last_mouse_over = { x: cellX, y: cellY}; 
```

如您所见，这里没有什么太大的变化。这段代码自己运行良好，没有我的 javascript 的其余部分（除了它使用的函数/数据），它在我测试过的所有其他浏览器中也运行良好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:02:37.400

您是否在 firebug 中启用了控制台？昨晚我遇到了这种问题，在我启用控制台之前什么都没有发生。确实很奇怪。

这是我在我的 JQuery 代码中使用其中一个日志记录功能的时候。

**编辑：**

此外，我最近经历了很多 Firefox 崩溃。似乎最新版本对我来说很容易崩溃。这是在任何网站上，而不仅仅是我自己的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T18:05:33.993

这没有足够的信息来确定 jQuerys $(document).ready() 工作得很好的确切原因。如果您没有收到实际的详细错误，则可能是您的一个对象中的错误。我会用细齿梳来检查我的逻辑，并寻找任何可能导致 X% 时间出错的东西。

此外，您应该在全新安装的 firefox（以及任何其他浏览器）上进行测试，firefox 扩展被授予访问可能与您的网站有关的 DOM 的权限。

# linq - 调用使用 LINQ 返回长选择返回的 SP

> ID：849287
> 
> 赞同：0
> 
> 时间：2009-05-11T18:02:24.780
> 
> 标签：linq, linq-to-sql

我正在使用 linq 调用 SP，SP 返回一个很长的字符串。但是当我收到字符串时，它会被截断。有什么方法可以增加 linq 的返回长度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:08:33.380

这可能不是 LINQ to SQL 的问题。它可能与您如何声明包含存储过程本身内部存储过程输出的变量有关。

另一种可能性可能是在创建 DBML 和实体类之后更改了存储过程变量。换句话说，您可以在 LINQ 中使用 varchar(100)，在存储过程中使用 varchar(200)。如果是这种情况，您需要重新生成 DBML。

# html - 使用居中的弹性块进行困难的页面化妆

> ID：849290
> 
> 赞同：2
> 
> 时间：2009-05-11T18:02:43.813
> 
> 标签：html, css

我有 3 个块：一个包装器，另一个在包装器内。内部块具有相同的大小。

Wrapper 是有弹性的，它的宽度在窗口调整大小时会改变。包装纸内的 2 个块也有弹性。这两个内部块中的每一个都具有 min-width 属性。

当 wrapper 足够宽时，内部块会一个接一个地排成一行。但是当包装器变得太窄时，块被定位在 2 行中。

您可以在下图中看到最终目标：

[替代文字 http://img155.imageshack.us/img155/9006/nessview.png](http://img155.imageshack.us/img155/9006/nessview.png)

重要时刻：正如您在第三个块中看到的那样，当块位于 2 行时，它们在中心对齐。

*问题：是否可以仅*使用html 和 css进行此化妆？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T18:49:41.787

对我来说，这样的东西在 IE 7 和 FF 3 中有效：

```
<div style="width: 49%; min-width: 300px; float: left; background: red;">Test</div>
<div style="width: 50%; min-width: 300px; float: left; background: blue">Test</div> 
```

问题是它在收缩时不会居中对齐，而且 IE 6 讨厌最小宽度。

仍在寻找中心对齐...

**仅限火狐：**

```
<div style="text-align: center">
  <div style="display: inline-block; width: 49%; min-width: 300px; margin: 0 auto; background: red;">Test</div>
  <div style="display: inline-block; width: 50%; min-width: 300px; margin: 0 auto; background: blue;">Test</div>
</div> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T22:46:47.473

如果我正确理解您的问题，您是否希望外盒永远不会变得如此狭窄，以至于里面的两个盒子彼此重叠？

将最小宽度也放在外盒上，这等于两个内盒的最小宽度、填充、边距和边框的总和。您也可以在 IE6 中假装 min-width ，通过这种方式：

```
min-width: 200px;
width: auto!important;
width: 200px; /* The last one will be used by IE6 (as min-width), the !important one by standards compliant browsers */ 
```

也应该使用最小高度。

# c# - 获取所有 (Properties.Resources) 以存储在字典中

> ID：849299
> 
> 赞同：6
> 
> 时间：2009-05-11T18:05:34.040
> 
> 标签：c#, visual-studio

基于 ID，我想自动将图像加载到我的 GUI 中。为此，我希望能够从 Visual Studio 2008 中的 Resources.resx 文件中获取所有图像（使用 C#）。如果我知道它们是什么，我知道我可以一次得到一个：

```
Image myPicture = Properties.Resources.[name of file]; 
```

然而，我正在寻找的是沿着这些路线......

```
foreach(Bitmap myPicture in Properties.Resources) {Do something...} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T21:18:31.137

只需使用 Linq (tm)

```
ResourceManager rm = Properties.Resources.ResourceManager;

ResourceSet rs = rm.GetResourceSet(new CultureInfo("en-US"), true, true);

if (rs != null)
{
   var images = 
     from entry in rs.Cast<DictionaryEntry>() 
     where entry.Value is Image 
     select entry.Value;

   foreach (Image img in images)
   {
     // do your stuff
   } 
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:29:24.467

好的，这似乎有效，但是我欢迎其他答案。

```
ResourceManager rm = Properties.Resources.ResourceManager;

ResourceSet rs = rm.GetResourceSet(new CultureInfo("en-US"), true, true);

if (rs != null)
{
   IDictionaryEnumerator de = rs.GetEnumerator();
   while (de.MoveNext() == true)
   {
      if (de.Entry.Value is Image)
      {
         Bitmap bitMap = de.Entry.Value as Bitmap;
      }
   }
} 
```

# jquery - JQuery：Ajax .load 问题

> ID：849301
> 
> 赞同：3
> 
> 时间：2009-05-11T18:05:57.583
> 
> 标签：jquery, ajax

我有一张最近注册的网络访客表。其中一列是一个简单的“发送电子邮件”链接，我在单击它时使用 Jquery 劫持它，然后将 ajax .load 发送到一个通过电子邮件发送给该人的后端 php 脚本。

我想不通的是如何简单地将点击的链接更改为“已发送！” 它不再是一个链接。

代码是：

```
$(".sendEmail").click(function(){
var element = $(this);
var guest_id = element.attr("id");                                         
$.post("WebGuest_SendEmail.php",{id: guest_id}, function(data) {
    $(this).html(data);  //NOT SURE WHAT TO DO HERE ON SUCCESS.
    });                            
return false;                              
}); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T18:16:00.047

最简单的方法就是用一些文本替换链接。基本上，我们只是在调用锚元素上使用 jQuery replaceWith() 函数。这是一个完整的 HTML 文件的简化示例，用于执行您想要的操作。

```
<script src="lib/jquery.js" type="text/javascript"></script>
<script>
$(document).ready(function() {
  $(".sendEmail").click(function(){
    var element = $(this);
    $.post("test.html", {}, function(data) {
      element.replaceWith("Sent!");    
    });
    return false;
  });
});
</script>

<a href="#" class="sendEmail">click me</a> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T18:46:37.703

我会让用户知道发生了什么，然后告诉他们发生了什么。*所以，告诉他们什么时候发送，*然后告诉他们什么时候发送。

像这样：

```
$(".sendEmail").click(function(){
    var element = $(this);
    var guest_id  = element.attr("id");
    element.replaceWith('Sending...');                                                                               
    $.post("WebGuest_SendEmail.php",{id: guest_id}, function(data) {
        $(this).html(data);  //NOT SURE WHAT TO DO HERE ON SUCCESS.
        element.replaceWith('Sent!');
    });                                                    
    return false;                                                      
}); 
```

当然，如果后端脚本由于某种原因失败，您可能希望恢复到一个。如果您对此技术感兴趣，请告诉我，我将通过最佳实践等更详细地解释这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T18:16:21.247

您可以将链接替换为文本“已发送！”：

```
$(".sendEmail").click(function(){
var element = $(this);
var guest_id = element.attr("id");
element.replaceWith('Sent!');
$.post("WebGuest_SendEmail.php",{id: guest_id}, function(data) {
        $("#container").html(data);  //NOT SURE WHAT TO DO HERE ON SUCCESS.

    });                                                    
return false;                                                      
}); 
```

# git - 如何从多个远程位置拉/推？

> ID：849308
> 
> 赞同：807
> 
> 时间：2009-05-11T18:07:37.580
> 
> 标签：git

**简而言之：**有没有办法让 git repo 推送到远程仓库列表（而不是单个“来源”）并从中拉取？

**长篇：**当我在多台计算机上开发应用程序时，我经常遇到这样一种情况，它们具有不同的连接性——比如在途中使用笔记本电脑，当我在某个位置时使用计算机“A”，另一台计算机“B”而在另一个。此外，笔记本电脑可能仅与“A”或“B”连接，有时两者都连接。

我想要的是让 git 始终“拉”和“推”到它当前可以连接的所有计算机，因此更容易从一台机器跳到另一台机器并继续无缝工作。

* * *

## 回答 #1

> 赞同：837
> 
> 时间：2010-07-07T13:56:36.283

**使用现代版本的`git`!**不再需要手动执行此操作。**请参阅[下面的](https://stackoverflow.com/a/12795747/6908282)[**Malvineous**](https://stackoverflow.com/users/308237/malvineous)的解决方案。**

 **在此转载：

```
git remote set-url origin --push --add <a remote>
git remote set-url origin --push --add <another remote> 
```

* * *

### 原答案：

这是我已经使用了很长一段时间而没有产生不良后果的东西，并由 Linus Torvalds 在[git mailing list](http://marc.info/?l=git&m=116231242118202&w=2 "回复：多个遥控器的 git fetch 失败？")上提出。

**araqnid**的解决方案是将代码*引入*您的存储库的正确解决方案……但是当您像我一样拥有多个等效的权威上游（我将一些更重要的项目克隆到私有上游、GitHub 和 Codaset）时，它每天对每个人进行更改可能会很痛苦。

长话短说，`git remote add`你所有的遥控器都是单独的……然后`git config -e`添加一个合并的遥控器。假设您有这个存储库`config`：

```
[remote "GitHub"]
    url = git@github.com:elliottcable/Paws.o.git
    fetch = +refs/heads/*:refs/remotes/GitHub/*
[branch "Master"]
    remote = GitHub
    merge = refs/heads/Master
[remote "Codaset"]
    url = git@codaset.com:elliottcable/paws-o.git
    fetch = +refs/heads/*:refs/remotes/Codaset/*
[remote "Paws"]
    url = git@github.com:Paws/Paws.o.git
    fetch = +refs/heads/*:refs/remotes/Paws/* 
```

`"Paws"`...要为and创建合并远程`"Codaset"`，我可以在所有这些之后添加以下内容：

```
[remote "Origin"]
    url = git@github.com:Paws/Paws.o.git
    url = git@codaset.com:elliottcable/paws-o.git 
```

完成此操作后，当 I 时`git push Origin Master`，它将依次推送到两者`Paws/Master`，`Codaset/Master`使生活更轻松。

* * *

## 回答 #2

> 赞同：547
> 
> 时间：2009-05-11T20:34:26.233

`git remote`您可以使用以下命令配置多个远程存储库：

```
git remote add alt alt-machine:/path/to/repo 
```

要从所有配置的远程获取并更新跟踪分支，但不合并到`HEAD`，请执行以下操作：

```
git remote update 
```

如果它当前未连接到其中一个遥控器，则会超时或抛出错误，然后继续下一个。您必须从获取的存储库中手动合并，或者`cherry-pick`，取决于您希望如何组织收集更改。

要从 alt 中获取 master 分支并将其拉入当前的 head，请执行以下操作：

```
git pull alt master 
```

所以实际上`git pull`几乎是简写`git pull origin HEAD`（实际上它在配置文件中查找以确定这一点，但你明白了）。

要推送更新，您必须手动对每个 repo 执行此操作。
我认为，推送的设计考虑了中央存储库工作流程。

* * *

## 回答 #3

> 赞同：288
> 
> 时间：2012-10-09T08:20:56.217

自 git 1.8（2012 年 10 月）以来，您可以从命令行执行此操作：

```
git remote set-url origin --push --add user1@repo1
git remote set-url origin --push --add user2@repo2
git remote -v 
```

然后`git push`将推送到 user1@repo1，然后推送到 user2@repo2。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2010-12-25T03:06:25.167

我将这些别名添加到我的 ~/.bashrc 中：

```
alias pushall='for i in `git remote`; do git push $i; done;'
alias pullall='for i in `git remote`; do git pull $i; done;' 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2009-05-16T10:48:39.637

您可以添加遥控器：

```
git remote add a urla
git remote add b urlb 
```

然后更新所有回购做：

```
git remote update 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-11-30T01:20:52.520

`.gitconfig`这是我在别名部分中使用 bash 脚本的示例

```
[alias]
        pushall = "!f(){ for i in `git remote`; do git push $i; done; };f" 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2020-10-24T12:33:12.857

这个答案与之前的答案不同，因为它避免了[git remote](https://git-scm.com/docs/git-remote)命令中**选项**的**不必要和不对称使用`--push`**。这样，两个 URL 在其配置中是对称的。对于持怀疑态度的人，如图所示的 git 配置在*有*与*没有*此选项时看起来会有所不同。`set-url``cat ./.git/config`

 **1.  从第一个 URL 克隆：

```
git clone git@github.com:myuser/myrepo.git 
```

2.  查看当前遥控器：

```
$ git remote -v
origin  git@github.com:myuser/myrepo.git (fetch)
origin  git@github.com:myuser/myrepo.git (push) 
```

3.  **添加第二个遥控器**：

```
git remote set-url --add origin git@gitlab.com:myuser/myrepo.git 
```

3.  确认两个遥控器都列出`push`：

```
$ git remote -v
origin  git@github.com:myuser/myrepo.git (fetch)
origin  git@github.com:myuser/myrepo.git (push)
origin  git@gitlab.com:myuser/myrepo.git (push)

$ git config --local --get-regexp ^remote\..+\.url$
remote.origin.url git@github.com:myuser/myrepo.git
remote.origin.url git@gitlab.com:myuser/myrepo.git 
```

4.  依次推送到所有 URL：

```
git push 
```

* * *

要删除遥控器：

```
git remote set-url --delete origin git@gitlab.com:myuser/myrepo.git 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2017-06-01T17:11:56.447

我将两个单独的 pushurl 添加到 .git configfig 文件中的远程“原点”。当我运行`git push origin "branchName"`时，它将运行并推送到每个 url。不确定是否有更简单的方法来完成此操作，但这对我自己来说可以推送到 Github 源代码并同时推送到 My.visualStudio 源代码。

```
[remote "origin"]
  url = "Main Repo URL"
  fetch = +refs/heads/*:refs/remotes/origin/*
  pushurl = "repo1 URL"
  pushurl = "reop2 URl" 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-03-03T15:20:59.733

我想在 VSO/TFS 中工作，然后在准备好后公开推送到 GitHub。在私有 VSO 中创建的初始存储库。当需要添加到 GitHub 时，我做了：

```
git remote add mygithubrepo https://github.com/jhealy/kinect2.git
git push -f mygithubrepo master 
```

像冠军一样工作......

要进行完整性检查，请发出“git remote -v”以列出与项目关联的存储库。

```
C:\dev\kinect\vso-repo-k2work\FaceNSkinWPF>git remote -v
githubrepo      https://github.com/jhealy/kinect2.git (fetch)
githubrepo      https://github.com/jhealy/kinect2.git (push)
origin  https://devfish.visualstudio.com/DefaultCollection/_git/Kinect2Work (fetch)
origin  https://devfish.visualstudio.com/DefaultCollection/_git/Kinect2Work (push) 
```

简单的方法，为我工作......希望这对某人有所帮助。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-04-17T16:00:06.687

我冒昧地扩展了nona-urbiz 的[答案](https://stackoverflow.com/a/4529147/1009993)；只需将其添加到您的 ~/.bashrc 中：

```
git-pullall () { for RMT in $(git remote); do git pull -v $RMT $1; done; }    
alias git-pullall=git-pullall

git-pushall () { for RMT in $(git remote); do git push -v $RMT $1; done; }
alias git-pushall=git-pushall 
```

用法：

```
git-pullall master

git-pushall master ## or
git-pushall 
```

如果您没有为 git-pullall 提供任何分支参数，那么从非默认遥控器的拉取将失败；保留此行为，因为它类似于 git。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-11-21T15:18:41.383

对于更新遥控器（即`pull`案例），事情变得更加容易。

莱纳斯的声明

> 可悲的是，甚至没有任何方法可以用 git 别名来伪造它。

在[elliottcable 的答案中](https://stackoverflow.com/a/3195446/520162)[Git 邮件列表](http://marc.info/?l=git&m=116231242118202&w=2)中引用的条目中不再正确。

[`git fetch`](https://www.kernel.org/pub/software/scm/git/docs/git-fetch.html)在过去的某个地方学习了`--all`参数，允许一次性获取所有遥控器。

如果不是全部都被请求，可以使用`--multiple`开关来指定多个遥控器或一个组。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-05-11T18:19:59.430

您需要一个脚本来循环它们。Git 不提供“全部推送”。理论上，您可以在多个线程中进行推送，但本机方法不可用。

Fetch 更加复杂，我建议线性进行。

我认为您最好的答案是拥有一台每个人都可以推/拉的机器，如果可能的话。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-12-15T11:03:04.660

使用以下命令为全局 gitconfig(/home/user/.gitconfig) 添加别名。

```
git config --global alias.pushall '!f(){ for var in $(git remote show); do echo "pushing to $var"; git push $var; done; }; f' 
```

一旦你提交代码，我们说

> git 推送

默认推送到原点。在上面的别名之后，我们可以说

> git pushall

并且代码将更新到所有遥控器，包括原始遥控器。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-10-16T22:15:45.767

添加`all`遥控器有点乏味，因为您必须在您使用的每台机器上进行设置。

此外，提供的`bash`和`git` *别名*都假定您将推送到**所有**遥控器。（例如：我在 GitHub 和 GitLab 上维护了一个分支`sshag`。我添加了*上游*远程，但我无权推送它。）

这是一个`git` *别名*，它只推送到带有包含`@`.

```
psall    = "!f() { \
    for R in $(git remote -v | awk '/@.*push/ { print $1 }'); do \
    git push $R $1; \
    done \
    }; f" 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-12-17T11:20:37.777

好吧，如果您正在寻找一种同时推送多个遥控器的方法，那么您可能对 git 有足够的了解。我们在 git 中将远程仓库称为远程仓库。将更改推送到遥控器通常是开发周期的一部分。

有时，您可能需要将更改推送到多个遥控器，例如 GitHub、bitbucket 等。为此，您可以按照给定的说明进行操作。

**列出您现有的遥控器**

您可以使用以下命令列出所有可用的遥控器。

```
git remote -v 
```

假设您还没有配置任何（其他）远程。您可以使用 git 遥控器来执行此操作。

```
git remote add  remote_name  remote_url 
```

例子：

```
git remote add github https//github.com/path/to/repo 
```

通常，我们通过默认来源的远程名称寻址来推送更改，例如`git push origin`. 您可以配置组多个遥控器并为其命名。因此，您通过引用该名称来推送所有这些遥控器。

您可以使用 git remote 或 git config 命令或编辑配置文件来添加多个遥控器。

由于 git 可以对多个遥控器进行分组，您可以按照以下任意一种方式来配置多个遥控器同时推送（无需全部）。

**使用 git remote 添加遥控器**

您可以使用 git remote 将多个远程 URL 设置为单个远程。

如果您还没有名为“all”的遥控器，请使用创建它，`git remote add`然后使用`git remote set-url –add`将新 URL 添加到现有遥控器。

```
git remote add all <remote URL> 
```

然后

```
git remote set-url  -–add  all  <another remote URL> 
```

您可以使用`git remote -v`.

（或者）

**使用 git config 对多个遥控器进行分组**

该`git config`命令用于配置 git 参数。它将`.git/config`根据给定的输入编辑文件。

```
git config –add remote.all.url  https//domain.com/repo.git
git config –add remote.all.url  ssh://user@host/repos/repo.git 
```

注意不带–add 选项的命令将替换现有的远程URL。您可以在 验证更新的配置`.git/config`。

（或者）

`.git/config` 如果您知道配置格式，请编辑文件以添加远程和多个远程 URL。

现在您可以通过引用分配了多个远程 URL 的远程名称来同时推送多个远程。

```
git push all master 
```

您始终可以推送到多个远程存储库，而无需使用正式的 bash 语法对它们进行分组。

```
git push server master && git push github master 
```

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2015-04-27T08:39:56.467

> 添加新的遥控器

```
git remote add upstream https://github.com/example-org/example-repo.git

git remote -vv 
```

> 从多个位置获取

```
git fetch --all 
```

> 推送到位置

```
git push -u upstream/dev 
```

# c++ - 将流对象从主程序传递到类

> ID：849309
> 
> 赞同：4
> 
> 时间：2009-05-11T18:07:48.547
> 
> 标签：c++

这是我想做的事情：
1）在我的主体中打开一个 ofstream 对象。我可以做到这一点没有问题。
2) 将此对象与文件名相关联。没问题。
3) 将此对象传递给一个类并在该类中发送输出。我不能这样做。
这是我的代码。我将不胜感激任何帮助。谢谢！

```
#include <fstream>
#include <iostream>
using namespace std;

typedef class Object
{
public:
 Object(ofstream filein);
} Object;

Object::Object(ofstream filein)
{
 filein << "Success";
}

int main (int argc, char * const argv[])
{
 ofstream outfile;
 outfile.open("../../out.txt");

 Object o(outfile); 

 outfile.close();
 return 0;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T18:10:38.683

您必须通过引用传递流对象：

```
Object::Object( ofstream & filein )
{
 filein << "Success";
} 
```

你为什么在课堂上使用 typedef？它应该如下所示：

```
class Object
{
   public:
     Object(ofstream & filein);
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T19:10:18.320

值得一提的是，在 c++0x 中，您将有其他选择（除了通过引用或指针传递）：

1.  标准：：移动。流是不可复制的，但您可以将它们移动到另一个地方（这取决于流是否会实现移动运算符，但它们可能会）。
2.  唯一的_ptr。流不可复制。使用指针时，会出现资源泄漏的风险。当您希望将流存储在集合中而不是其他任何地方时，使用 shared_ptr 会带来不必要的成本。Unique_ptr 解决了这个问题。您将能够以安全有效的方式将流存储在集合中。

# wpf - Text Will not show for selected Item in ComboBox

> ID：849323
> 
> 赞同：1
> 
> 时间：2009-05-11T18:10:51.117
> 
> 标签：wpf, windows, wpf-controls

I feel really stupid for asking this but I have been thrashing for over 8 hours. How do I get the Selected Item to show its text in my WPF combo box when selected?

![Diplay Options](https://i86.photobucket.com/albums/k83/Aaronls79/DisplayerOptions.jpg)

Above is an option dialog that allows users to select and configure the available tournament displays. The problem is the selected combo box item shows the UserControl instead of the Display name.

**On Window Loaded**:

```
 //_displayer is a private member populated using MEF
        //[ImportMany(typeof (IDisplayer))] 
        //private IEnumerable<IDisplayer> _displayers;
        DisplayTypeComboBox.ItemsSource = _displayers; 
```

**The ComboBox Xaml:**

```
 <ComboBox
     Name="DisplayTypeComboBox"
     Grid.Column="1"
     Grid.ColumnSpan="2"
     Grid.Row="1" 
     IsEditable="False"
     SelectionChanged="DisplayTypeComboBox_SelectionChanged">
        <ComboBox.ItemTemplate>
            <DataTemplate>
                <ComboBoxItem Content="{Binding DisplayerName}" />
            </DataTemplate>
        </ComboBox.ItemTemplate>
   </ComboBox> 
```

**The IDisplayer:**

```
public interface IDisplayer
{
    string DisplayDataLocation { get; set; }
    string DisplayerName { get; }
    string DisplayerDescription { get;}
    bool WatcherEnabled { get; }
    UserControl View { get; }
    string DisplayerImageLeft { get; set; }
    string DisplayerImageRight { get; set; }
    void Update();
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T18:18:51.113

I don't even want to think about how many hours I have spent trying to solve what should be a simple problem. Why is it so hard to get your selected text to appear as the selected value? I give up, WPF you have beat me into submission. I changed the control to a list box it takes up more room to display the selectable Items but at least it works.

```
 <ListBox
     Name="DisplayTypeComboBox"
     Grid.Column="1"
     Grid.ColumnSpan="2"
     Grid.Row="1" 
     SelectionChanged="DisplayType_SelectionChanged">
        <ListBox.ItemTemplate>
            <DataTemplate>
                <Label Content="{Binding DisplayerName}" />
            </DataTemplate>
        </ListBox.ItemTemplate>
    </ListBox> 
```

![alt text](https://i86.photobucket.com/albums/k83/Aaronls79/windowOptions.jpg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-11T15:05:08.680

I encountered the same thing. Took me a while too. :( You should have used the ItemContainerStyle and not ItemTemplate. Because ComboBox wraps the internal items with a ComboBoxItem - you basically wrapped the ComboBoxItem with another one.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T18:41:09.520

Try using a TextBlock to bind to the DisplayerName instead of a ComboboxItem. I believe that when you set the itemsource, the combo control will wrap the items inside comboboxitems controls automatically.

Edit: I misunderstood your question. Try setting the SelectionBoxItemTemplate.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:54:48.627

Check what DisplayerName member actually contains. Most likely it contains the UserControl name instead of the Display name.

# c# - 如何在文本上执行逐行和逐字符差异？

> ID：849324
> 
> 赞同：3
> 
> 时间：2009-05-11T18:11:10.803
> 
> 标签：c#, text, diff

如何比较 2 个文件，并生成一份报告，显示包含差异的行以及这些行上的哪些字符不同？

显然，已经有工具可以做到这一点，但我想知道这是如何做到的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T18:13:08.180

这是一个可能有帮助的[代码项目示例。](http://www.codeproject.com/KB/recipes/diffengine.aspx)

# c# - 如何找出当前项目的所有引用并判断哪些是从 C# 中的特定基类派生的？

> ID：849328
> 
> 赞同：1
> 
> 时间：2009-05-11T18:11:40.177
> 
> 标签：c#, reflection, activerecord, dynamic

由于我工作的大型金融机构的政治原因，我无法使用 Castle Project 的 ActiveRecord 实现，但我非常喜欢这种模式，我自己实现了它。这已经完成，现在管理层正在寻找一个 GUI 工具来浏览所有活动记录类、搜索实例和管理数据。

为此，我正在构建一个“浏览器”，它遍历引用项目中的所有类，如果它们派生自特定的基类（“ActiveInstanceBase”），则使它们可用于在 ASP 中进行检查和修改。净数据网格。

对我来说，第一步是弄清楚如何遍历当前项目中的所有引用（使用此工具的开发人员会将他们的 dll 作为引用添加到项目中）并识别 ActiveInstance 类以填充一个充满类型的下拉列表检查。

1.  如何获取当前项目的所有引用列表？谷歌在许多查询的结果的第一页上没有为我打开任何东西。我得到了很多关于编写 Visual Studio 插件的东西，但对于运行时检查却一无所获。

2.  如果基类采用 Type 参数，如何在运行时确定派生类型的基类？

if (t.IsSubclassOf(typeof(ActiveInstance.ActiveInstanceBase))) {}

不是正确的语法，我在运行时不知道。

我也被迫使用IE6，如果这篇文章的格式不是很好，请原谅。首先十分感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:34:30.750

1）如何获取项目中引用的程序集

```
Assembly ourAssembly = Assembly.GetEntryAssembly();
AssemblyName[] refs = ourAssembly.GetReferencedAssemblies(); 
```

2）使用类型。[IsSubclassOf](http://msdn.microsoft.com/en-us/library/system.type.issubclassof.aspx) () 或类型。[获取接口](http://msdn.microsoft.com/en-us/library/ayfa0fcd.aspx)()

```
Type theType = typeof(ActiveInstance.ActiveInstanceBase<>);
foreach(Type type in assembly.GetTypes())
{
    if (type.IsSubclassOf(theType))
    { ... }
} 
```

这些应该对你有用......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:54:26.007

如果您有禁止下载第三方软件的政治规则，这可能行不通，但我使用 .net Reflector。它将为您提供参考并反编译代码以供审查。

[http://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/)

# c# - 如何使用 .net 紧凑框架 3.5 隐藏数据网格中的列

> ID：849330
> 
> 赞同：4
> 
> 时间：2009-05-11T18:11:52.470
> 
> 标签：c#, .net, datagrid, windows-mobile, compact-framework

我有一个使用 DataReader 作为其数据源的 DataGrid。我想隐藏数据网格的第一列。我正在使用 .net 紧凑框架 3.5。我可以找到 windows 窗体的示例，但 api 已更改得足够多，以至于它们无法正常工作。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-03-02T06:45:24.177

您可以将列样式宽度设置为`0`或`-1`。

```
DataGridTableStyle ts = new DataGridTableStyle();
ts.MappingName = "Order";

// Order date column style
DataGridColumnStyle cust_id = new DataGridTextBoxColumn();
cust_id.MappingName = "cust_id";
cust_id.HeaderText = "ID";

//Hide Customer ID
cust_id.Width = -1;

ts.GridColumnStyles.Add(cust_id);

// Shipping name column style
DataGridColumnStyle cust_name = new DataGridTextBoxColumn();
cust_name.MappingName = "cust_name";
cust_name.HeaderText = "Customer";
cust_name.Width = 500;
ts.GridColumnStyles.Add(cust_name);

GridView1.TableStyles.Add(ts); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:37:57.687

无论如何，在分配数据源之前，请隐藏您不想显示的列：

```
ds.Tables("dtRecords").Columns("ID").ColumnMapping = MappingType.Hidden

Datagrid1.datasource = ds.Tables("dtRecords") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-09T19:09:03.993

正如 Henk 所说，我刚刚使用 DataGridTableStyle 和 GridColumnStyles 解决了这个问题。但是，我也将 GridColumnStyle 中的 Width 属性分配给 -1。

而且，它有效！

# ruby - 如何在 sinatra 中运行基本的异步作业？

> ID：849331
> 
> 赞同：0
> 
> 时间：2009-05-11T18:12:31.707
> 
> 标签：ruby, process, asynchronous, sinatra

我想运行一个基本的异步作业

```
exec('curl -0 '+url) 
```

来自 sinatra 应用程序，

我试图用 fork and detach 来做到这一点，但它似乎是假的。

（我在窗户上）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T19:03:05.123

Github 上有来自 Blake Mizerany 的示例应用程序：[sinatra-dj](http://github.com/bmizerany/sinatra-dj/tree/master "西纳特拉-DJ")，使用 DelayedJob 作为队列机制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T12:44:23.927

试试呢：

```
exec('curl -0'+url) if fork == nil 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-04T00:12:33.613

老问题，但是...

使用[叉叉](http://github.com/deadprogrammer/spork)

# python - python 包的标准非代码资源位置

> ID：849334
> 
> 赞同：4
> 
> 时间：2009-05-11T18:13:14.840
> 
> 标签：python, resources, location, package, shared

这应该是一个常见的场景，但还没有找到任何相关的帖子..

我计划部署一个 Python 库（我想这同样适用于常规应用程序），它使用一些图像和其他资源文件。此类物品的标准位置是什么？我想，对于 project `Foo`，选择是

*   在源存储库中有`resources`目录，然后将文件移动到`/usr/share/foo/`
*   将资源直接放在下面的python包中`/usr/lib/python-<version>/foo/`

有什么建议么？

**编辑：**正如建议的那样，澄清将在其上运行的主要平台是 Linux。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T18:37:35.457

这个问题有些不完整，因为正确的答案取决于底层操作系统，因为每个操作系统都有自己的作案手法。在 linux（和大多数基于 unix 的操作系统）中，例如 /usr/share/foo 或 /usr/local/share/foo 将是标准。在 OS X 中你可以做同样的事情，但我认为“/Library/Application Support/Foo”（虽然这通常用于存储设置和诸如此类的东西）将是放置这些东西的地方，尽管如果你正在编写库之后“框架”的想法，所有资源都将包含在 /Library/Frameworks/Foo.Framework" ...另一方面，OS X 上的应用程序应将所有资源保留在 Foo.app 内的 Resources 目录中

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:01:23.603

我们将非 .py 文件放入`/opt/foo/foo-1.2/...`

当然，除了 Apache 提供的静态媒体，`/var/www/html/foo/foo-1.1/media/...`

当然，客户特定的配置文件除外。他们去了 `/var/opt/customer/foo/...`

据我了解，它们遵循 Linux 标准。

我们尽量远离各种地点`/usr/lib/`，`/lib`因为那些地方感觉它们是分布的一部分。我们倾向于`/opt`并且`/var`因为它们明显与 linux 发行版目录分开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:58:44.123

*标准*位置是您的标准库所在的位置。但是从您所写的内容中，我听起来并不觉得您需要您的 python 库。我认为您应该尝试一下[Virtualenv](http://pypi.python.org/pypi/virtualenv#what-it-does)。

如果你不想经历所有的麻烦（好吧，它真的只是`sudo easy_install virtualenv`为你），你可以尝试将你的 python lib 转储到你的任何目录中，`~/`然后按照以下方式做一些事情

```
import sys
sys.path.append( '/full/path/to/your/lib/goes/here') 
```

到任何使用您的库的给定应用程序。

请记住，给出的示例仅用于测试目的。对于任何活的东西，我建议您使用[distutil](http://docs.python.org/distutils/)。[此处](http://docs.python.org/distutils/setupscript.html)给出了使用示例。

# c# - 使用 OLEDB 连接字符串打开 MS Access，但无权创建 .ldb 锁定文件

> ID：849339
> 
> 赞同：2
> 
> 时间：2009-05-11T18:14:32.280
> 
> 标签：c#, ms-access

我有一个使用 MS Access 数据库的 C# 程序，我正在使用 OleDb 连接并对该数据库进行查询。我的问题是我在数据库中有一些敏感信息，我不希望它显示为 Access DB。我更改了扩展名，但是当我打开它时，它仍然会创建 Access 使用的 .ldb 锁定文件。我想让数据库不创建该锁定文件。

我已经阅读了很多关于这个问题的帖子，听起来如果我以独占模式打开数据库，它不会创建那个 .ldb 文件。但是，到目前为止，我还没有找到任何用于 OleDb 的连接字符串，可以让我指定对数据库的独占访问权限。C# 中的 OleDbConnection 对象也没有“模式”成员，因此以这种方式设置独占访问是不可能的。

如果有人有任何可以以独占模式打开数据库的连接字符串，或者如果有人知道另一种避免在 Access 中创建 .ldb 锁定文件的方法，我们将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:19:47.997

[http://www.connectionstrings.com/access](http://www.connectionstrings.com/access)有一个 Ecxlusive 模式的条目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:19:48.790

如果您想避免锁定文件，我建议您使用[SQLite](http://www.sqlite.org/)或其他非访问选项。

试图避免锁定文件充其量是困难的。即使您以独占模式打开文件，JET 有时也会创建这些文件。

如果您尝试存储敏感数据，并且想要“隐藏”文件类型，另一个不错的选择是[VistaDB](http://vistadb.net/)。它是一个单文件数据库，但允许完整的数据库加密。这可能是一种比仅仅试图掩盖您正在使用 JET 的事实更好的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T18:30:04.983

您无法真正隐藏它是一个 Access 数据库。任何人都可以在十六进制编辑器（甚至只是记事本）中打开文件，然后看到一个字符串，如“ `Standard Jet DB`”（Office 2000/XP/2003）或“ `Standard ACE DB`”（Office 2007）正盯着他们看。即使他们不知道这意味着什么，谷歌也会很快告诉他们。您可以使用不太常见的数据库，但它们也会有类似的弱点。

如果你真的想要安全，你将不得不加密数据库文件并使用一个引擎，让你在内存中保存一个解密的版本（IIRC sqlite 支持这个，或者很快就会支持）或者使用一个原生支持加密的引擎。即使这样，如果 ram 被分页到磁盘或另一个进程“嗅探”您的应用程序的 ram，您也可能会遇到问题。

* * *

更新较晚，但今天我的注意力又回到了这里，我想补充一点，除了 Access 将要求您将引擎与应用程序一起分发。您还需要注意引擎的文件也不要泄露。访问获得通过，因为引擎已经是 Windows 的一部分。你也可以尝试一些开源的东西，这样你就可以将它重新编译到你的主应用程序文件中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:33:17.710

安装 SQL Server 2008 Express，在 Access 中使用升迁向导，指向您的 Express 实例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T18:26:13.260

我有几个设置了 Exclusive 标志的数据库，每次打开一个时我仍然会创建 .ldb 文件。如果您真的担心安全性，那么是时候迁移到“成熟”的数据库了。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-05-11T19:02:41.203

您也可以潜在地使用 Sql Server Compact 来执行此操作。它是免费的，并且是 Visual Studio 的一部分。微软在很多产品中积极使用它，包括 Windows Live。

# tfs - SolutionToBuild 中的属性问题

> ID：849343
> 
> 赞同：0
> 
> 时间：2009-05-11T18:15:12.793
> 
> 标签：tfs, msbuild, tfsbuild

我正在尝试在 Team Build 的 SolutionToBuild 项中使用属性元数据。

我正在将版本添加到目标内的属性元数据中，该目标在获得代码之前被调用（BuildNumberOverrideTarget），但我想为时已晚。我更改的值不会传递给已构建的解决方案。

这些数据何时传递给解决方案（显然是在从源代码控制中提取之前）。

如果我想在这种情况发生之前进行一些计算（即版本号），是否有可以完成的目标？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T11:13:23.503

这篇文章应该可以帮助你：http: [//blogs.msdn.com/aaronhallberg/archive/2008/05/12/orcas-sp1-tfs-build-changes-part-2.aspx](http://blogs.msdn.com/aaronhallberg/archive/2008/05/12/orcas-sp1-tfs-build-changes-part-2.aspx)

如果您将动态生成的属性添加到 CustomPropertiesForBuild，它将在稍后的构建过程中可用。

# iphone - iPhone 导航栏图像

> ID：849345
> 
> 赞同：4
> 
> 时间：2009-05-11T18:15:15.680
> 
> 标签：iphone

我想用自定义图像替换 iPhone 应用程序中的后退按钮和整个导航栏。首先，这可能吗？第二，如果有，怎么做？谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-09-10T13:10:39.593

此代码将修改您应用中的每个 UINavigationBar。

```
@implementation UINavigationBar (CustomImage)
- (void)drawRect:(CGRect)rect {
    UIImage *image = [UIImage imageNamed: @"MyNavigationBar.png"];
    [image drawInRect:CGRectMake(0, 0, self.frame.size.width, self.frame.size.height)];
}
@end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:17:23.600

您将无法轻松覆盖 Apple 导航栏的外观和感觉，即使您能够，也很有可能会违反他们避免使用私有 API 的政策。但是，使用所有自定义图像创建自己的相似导航栏非常简单。这对于需要导航栏的简单一次性屏幕非常有效，但在复杂的基于 UINavigationController 的层次结构上实现起来将是一种野兽。

编辑：看起来人们已经能够通过覆盖`-drawRect`选择器来更改背景：[UINavigationBar 的自定义背景？](http://discussions.apple.com/thread.jspa?messageID=7951074). 我没有看到任何有关更改是否已在 App Store 中获得批准的报告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-27T00:14:14.610

您可以使用此代码将导航栏图像和标签栏图像更改为您的自定义图像：

```
 if([[UINavigationBar class] respondsToSelector:@selector(appearance)])  {//iOS >=5.0
    UIImage *image = [UIImage imageNamed:@"myCustomImage.png"];

    CGSize newSize = CGSizeMake(self.navigationController.navigationBar.frame.size.width, self.navigationController.navigationBar.frame.size.height);
    UIGraphicsBeginImageContext(newSize);
    [image drawInRect: CGRectMake(0, 0, self.navigationController.navigationBar.frame.size.width, self.navigationController.navigationBar.frame.size.height)];

    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    [self.navigationController.navigationBar   setBackgroundImage:newImage  forBarMetrics:UIBarMetricsDefault];

    [[UIToolbar appearance] setBackgroundImage:newImage forToolbarPosition:UIToolbarPositionAny barMetrics:UIBarMetricsDefault];
    [[UITabBar appearance] setBackgroundImage:newImage];
    [[UITabBar appearance] setSelectedImageTintColor:[UIColor cyanColor]];
} 
```

# mysql - 基于 MySQL 中其他列的查询条件列

> ID：849348
> 
> 赞同：14
> 
> 时间：2009-05-11T18:15:57.083
> 
> 标签：mysql, database, syntax, conditional

我很确定我在某处看到过这个，但我找不到正确的术语，所以我遇到了麻烦......

假设我有一个包含用户信息的表（我们还假设它是由比我获得​​更高报酬的人创建的，因此修改模式不是一种选择。）用户信息的各个列中包括 DOB 和职位的列. 我想要一个查询，根据这些列中的内容，将包含一个名为“Real_Title”的额外列，例如：

```
User_id    Job_Title    DOB
  joe_1      manager    01/01/1950
  jim_1    associate    01/01/1970
 jill_1    associate    01/01/1985
 jane_1      manager    01/01/1975 
```

询问：

```
SELECT User_id, Real_Title FROM users
IF (YEAR(DOB) < 1980 AND Job_Title = "manager")
   {Real_Title = "Old Fart"}
ELSE IF (YEAR(DOB) < 1980 AND Job_Title = "associate")
   {Real_Title = "Old Timer"}
ELSE IF (YEAR(DOB) > 1980 AND Job_Title = "manager")
   {Real_Title = "Eager Beaver"}
ELSE IF (YEAR(DOB) > 1980 AND Job_Title = "associate")
   {Real_Title = "Slacker"} 
```

我知道上面不仅是错误的，而且编码效率很低，但我想把这个想法传达出去。

有没有办法在不使用连接的情况下根据同一个表中一个或多个其他列中的信息填充列？

目前，在获得结果后，我在 PHP 脚本中使用某些东西将这些结果引导到我想要的组中，但如果可以在查询中完成，这将使将查询移植到其他脚本和语言变得更加容易。

谢谢！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-11T18:29:02.833

```
select User_id
,case 
    when (YEAR(DOB) < 1980 AND Job_Title = "manager")   then 'Old Fart'
    when (YEAR(DOB) < 1980 AND Job_Title = "associate") then 'Old Timer'
    when (YEAR(DOB) > 1980 AND Job_Title = "manager")   then 'Eager Beaver'
    when (YEAR(DOB) > 1980 AND Job_Title = "associate") then 'Slacker'
    else 'nobody'
end
as Real_Title 
from users 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-11T18:25:05.460

如果我理解正确，我认为您正在寻找[CASE 声明](http://dev.mysql.com/doc/refman/5.1/en/control-flow-functions.html#operator_case)：

```
SELECT User_id,
        (CASE
            WHEN YEAR(DOB) < 1980 AND Job_Title = "manager" THEN "Old Fart"
            WHEN YEAR(DOB) < 1980 AND Job_Title = "associate" THEN "Old Timer"
            ...
            ELSE "Unknown Title"
        END) AS Real_Title
FROM users; 
```

# php - 如何使这个多维数组和这些 foreach 循环一起工作？

> ID：849355
> 
> 赞同：1
> 
> 时间：2009-05-11T18:17:09.170
> 
> 标签：php, foreach, multidimensional-array

```
// a beautiful multidimensional array

public $form = array (
        array(
            'field' => 'email',
            array(
                'params' => 
                array(
                    'rule' => 'email',
                    'on' => 'create',
                    'required' => true,
                    ),
                ),
            array(
                'params' =>
                array(
                    'rule' => 'email',
                    'on' => 'update',
                    'required' => false,
                    )
                )
            )
        );

// beautiful foreach loops

public function validate($form) {
    foreach ($form as $valueA) {
        $field = $valueA['field'];

        foreach ($valueA as $valueB) {
            $params = $valueB['params'];

            foreach ($valueB as $valueC) {
                $rule = $valueC['on'];
                $on = $valueC['on'];
                $required = $valueC['required'];

                $this->isValid($field, $rule, $on, $required);
            }
        }
    }
}

// they do not work together!!! 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T18:30:19.460

此页面有一些使用 for 循环访问多维数组元素的示例：[http ://www.webcheatsheet.com/PHP/multidimensional_arrays.php](http://www.webcheatsheet.com/PHP/multidimensional_arrays.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:32:20.237

尽管这些数组很“漂亮”，但在我看来，这确实像是一个类会更擅长的东西，而且处理起来会容易得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T18:50:27.807

那个多维数组对我来说并不漂亮。它看起来像一团糟。这似乎更合乎逻辑：

```
public $form = array (
            'field' => 'email',
            'params' => 
              array(
                array(
                    'rule' => 'email',
                    'on' => 'create',
                    'required' => true,
                    ),
                array(
                    'rule' => 'email',
                    'on' => 'update',
                    'required' => false,
                    )
                )
        ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:51:11.940

在我看来，您将在第二个循环中生成错误：

```
foreach ($ValueA as $ValueB) { 
```

这将包含`field`在循环中，并且在尝试将其作为数组访问时会遇到问题。

另外，我认为你的意思是你的第三个循环是：

```
foreach ($params as $ValueC) { 
```

否则，它会遇到与中间循环相同的问题。

我认为，如果您打算继续将其用作数组而不是像其他人建议的那样将其重构为类，则应该对其进行重构，以使命名数据都处于同一级别。请注意，这降低了数组（一点）和循环（很多）的复杂性。

```
public $form = array (
    array(
        'field' => 'email',
        'params' => array(
            array(
                'rule' => 'email',
                'on' => 'create',
                'required' => true,
            ),
            array(
                'rule' => 'email',
                'on' => 'update',
                'required' => false,
            )
        )
    )
);

public function validate($form) {
    foreach ($form as $field_params) {
        $field = $field_params['field'];

        foreach ($field_params['params'] as $param) {
            $this->isValid($field, $param['rule'], $param['on'], $param['required']);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T19:27:57.400

例如，尝试调试`$valueX`您的情况`var_dump()`。

可能`foreach($array as $key => $value)`是你在找什么

# c# - 如何在图片框上绘制文字？

> ID：849359
> 
> 赞同：16
> 
> 时间：2009-05-11T18:17:37.483
> 
> 标签：c#, graphics, image

我用谷歌搜索“在图片框 C# 上绘制文本”，但找不到任何有用的东西。然后我用谷歌搜索“在 C# 表单上绘制文本”，我找到了一些代码，但它并没有按照我想要的方式工作。

```
 private void DrawText()
    {
        Graphics grf = this.CreateGraphics();
        try
        {
            grf.Clear(Color.White);
            using (Font myFont = new Font("Arial", 14))
            {
                grf.DrawString("Hello .NET Guide!", myFont, Brushes.Green, new PointF(2, 2));
            }
        }
        finally
        {
            grf.Dispose();
        }
    } 
```

当我调用该函数时，表单的背景颜色变为白色（默认为黑色）。

我的问题：

1：这适用于图片框吗？

2：如何解决问题？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-05-11T18:19:53.097

你不想调用 Clear() - 这就是为什么它把背景变成白色，它会掩盖你的图片。

您想在 PictureBox 中使用 Paint 事件。您从 e.Graphics 获得图形参考，然后使用您在示例中拥有的 DrawString()。

这是一个示例。只需在表单中添加一个图片框，并为 Paint 事件添加一个事件处理程序：

```
private void pictureBox1_Paint(object sender, PaintEventArgs e)
{
    using (Font myFont = new Font("Arial", 14))
    {
        e.Graphics.DrawString("Hello .NET Guide!", myFont, Brushes.Green, new Point(2, 2));
    }
} 
```

（请注意，在设计时您不会看到文本 - 您必须运行程序才能对其进行绘制）。

# python - 如何在 Python 中对元组列表进行 enumerate()？

> ID：849369
> 
> 赞同：53
> 
> 时间：2009-05-11T18:20:13.533
> 
> 标签：python, list, enumerate

我有一些这样的代码：

```
letters = [('a', 'A'), ('b', 'B')]
i = 0
for (lowercase, uppercase) in letters:
    print "Letter #%d is %s/%s" % (i, lowercase, uppercase)
    i += 1 
```

有人告诉我有一个 enumerate() 函数可以为我处理“i”变量：

```
for i, l in enumerate(['a', 'b', 'c']):
    print "%d: %s" % (i, l) 
```

但是，我不知道如何将两者结合起来：当相关列表由元组组成时，如何使用枚举？我必须这样做吗？

```
letters = [('a', 'A'), ('b', 'B')]
for i, tuple in enumerate(letters):
    (lowercase, uppercase) = tuple
    print "Letter #%d is %s/%s" % (i, lowercase, uppercase) 
```

还是有更优雅的方式？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-05-11T18:23:36.850

这是一种巧妙的方法：

```
letters = [('a', 'A'), ('b', 'B')]
for i, (lowercase, uppercase) in enumerate(letters):
    print "Letter #%d is %s/%s" % (i, lowercase, uppercase) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T19:39:31.063

这就是我的做法：

```
import itertools

letters = [('a', 'A'), ('b', 'B')]
for i, lower, upper in zip(itertools.count(),*zip(*letters)):
    print "Letter #%d is %s/%s" % (i, lower, upper) 
```

编辑：拆包变得多余。这是一种更紧凑的方式，取决于您的用例，它可能有效或无效：

```
import itertools

letters = [('a', 'A'), ('b', 'B')]
for i in zip(itertools.count(),*zip(*letters)):
    print "Letter #%d is %s/%s" % i 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-10T17:05:52.903

你也可以这样做：

```
letters = [('a', 'A'), ('b', 'B')]
for i, letter in enumerate(letters):
    print "Letter #%d is %s/%s" % (i, letter[0], letter[1]) 
```

# treeview - ASP.NET Treeview 控件和客户端 javascript - 突出显示选定的树视图节点

> ID：849370
> 
> 赞同：1
> 
> 时间：2009-05-11T18:20:25.343
> 
> 标签：treeview, asp.net-2.0, selection, treenode

如何执行以下操作 - ASP.NET 2.0 TreeView 和**使用 JavaScript选择选定节点**

我通过阅读[这篇文章](http://www.codeproject.com/KB/webforms/ClientSideTreeView.aspx)来尝试这个，但它没有在 asp.net 2.0 树视图控件上找到 getTreeNode() 属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T15:43:02.807

JQuery 解决方案 - 用于在客户端选择单个节点（突出显示）ASP.NET 2.0 Treeview 控件

```
$("#TreeView1t5").addClass("TreeView1_5"); 
```

`#TreeView1t5`id在哪里`node`，`TreeView1_5`用于`css class`选择。

享受..！

# c++ - 在不传输数据的情况下确定网络接口带宽/类型

> ID：849375
> 
> 赞同：4
> 
> 时间：2009-05-11T18:20:56.323
> 
> 标签：c++, winapi, networking, bandwidth

Win32 中是否有任何方法可以在不实际传输任何数据的情况下以编程方式确定给定网络接口的带宽？我只想区分不同类型的接口（例如拨号、DSL 和 LAN），所以粗略的数量级就可以了，我不需要实际测量带宽。

问题的背景是我的应用程序非常需要带宽，如果他们尝试在低带宽接口（例如拨号调制解调器或 GPRS 调制解调器）上运行它，我想向用户显示警告。

我已经查看了其他一些[相关问题](https://stackoverflow.com/questions/729146/how-to-programmatically-check-internet-bandwidth-in-vc)，但如果可能的话，我想避免测量吞吐量。特别是 GPRS 调制解调器可能有使用上限，我不想吃掉用户的津贴 - 我宁愿以其他方式检测不良连接，而实际上根本不发送任何数据。

我对 Win32/C++ 的答案最感兴趣，但任何想法都将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T18:27:11.027

您可以使用 WMI 查询，当然也有 Win32 函数调用，但是这个查询：

```
Select * from Win32_PerfFormattedData_Tcpip_NetworkInterface 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T18:26:29.327

您可以使用[InternetGetConnectedState](http://msdn.microsoft.com/en-us/library/aa384702(VS.85).aspx)来确定连接类型（LAN/调制解调器/等）。这将告诉您他们是否有一个不错的（非调制解调器）连接而没有带宽传输。

不幸的是，如果不连接和传输数据，您真的无法超越。系统无法知道其 LAN 连接之外的带宽限制 - 即：您可以直接连接到 LAN 上的网关，并且它与外部世界的连接可能很糟糕。但是，就您的计算机而言，它处于全速局域网连接...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T18:22:35.697

为什么不问用户？他应该知道。

您的应用程序可以缓存网络地址的信息，并且只会再次询问网络地址是否已更改。

# svn - svn 与修订版合并不符合我的预期

> ID：849382
> 
> 赞同：4
> 
> 时间：2009-05-11T18:21:59.677
> 
> 标签：svn

我正在尝试对从主干到分支的更改进行 svn 合并（2001 年）。更改在修订版 614 的主干中。

我已经尝试了以下方法，但他们都没有做我想做的事：

```
svn merge
svn merge -r 614:HEAD https://secreturl/trunk 
```

但这似乎带来了很多我不想要的变化。

当我运行时：`svn log -r 614 https://secreturl/trunk`- 我看到了我想要合并的一小部分更改的签入注释。我在这里想念什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T18:27:10.667

`svn merge -r 614:HEAD https://secreturl/trunk`将合并修订版 614 和 HEAD 之间的**所有更改。**此外，它将以 614 作为基础修订版（可能不是您想要的：）

要合并来自特定修订的更改，您可以使用以下两种方法之一：

`$ svn merge -c 614 https://secreturl/trunk`或`$ svn merge -r 613:614 https://secreturl/trunk`。

第一种表示*仅应用修订版 614 中*的更改，而第二种形式表示*进行从 r613 到 r614 所需的所有更改并在此处应用它们*。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:23:33.870

我想你想要-r 613:HEAD。如果您只想更改 614，请执行 -r 613:614。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T18:24:14.290

`svn log -r 614`将向您显示特定的 614 修订版。如果您只想合并 r614 的结果，请执行以下操作：

svn 合并 -r 613:614 [https://secreturl/trunk](https://secreturl/trunk)

即合并613到614的变化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:27:17.470

很好的网站可以帮助你
[链接 1](http://svnbook.red-bean.com/en/1.0/re16.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-31T18:24:45.417

我获取了上面的信息，并制作了一个 windows .bat 文件来展示如何编写脚本。我的补充更明确地显示了您如何处理本地工作副本，然后提交回存储库。

在下面的 .bat 文件中，我输入了一个 svn.exe 状态来显示如果你提交会发生什么，然后是一个暂停，给你最后一次机会 X 退出而不执行提交。

这是.bat文件

仅供参考，我使用的是 svn.exe 1.6.15。

```
 set __SVNClient="C:\Program Files (x86)\CollabNet\Subversion Client\svn.exe"

 set __PreviousRevisionNumber=2594

 set __CheckoutFolder=".\MyCheckoutFolderRevision%__PreviousRevisionNumber%"

 RD %__CheckoutFolder% /Q /S

 %__SVNClient% checkout "https://www.myrepository.com/MyProject/trunk" %__CheckoutFolder% --username %USERNAME%

 CD %__CheckoutFolder%

%__SVNClient% merge --revision HEAD:%__PreviousRevisionNumber% "."

%__SVNClient% status "."

PAUSE

%__SVNClient% commit -m "Manual Change. Revision %__PreviousRevisionNumber% was pulled out of repository and then it was made the HEAD Revision." "." --username %USERNAME%

CD ..

set __CheckoutFolder=
set __PreviousRevisionNumber=
set __SVNClient= 
```

下面的网站（和部分名称）给出了更多解释：

[http://durak.org/sean/pubs/software/version-control-with-subversion-1.6/svn.branchmerge.basicmerging.html](http://durak.org/sean/pubs/software/version-control-with-subversion-1.6/svn.branchmerge.basicmerging.html)
（搜索“撤消更改”作为部分标题）

# iphone - 使用 pagingEnabled 的 UIScrollView 中页面之间的照片应用程序式间隙

> ID：849383
> 
> 赞同：23
> 
> 时间：2009-05-11T18:22:04.920
> 
> 标签：iphone, cocoa-touch, uiscrollview

分页模式下的 UIScrollView 假定页面彼此相邻，没有间隙。但是，如果您在“照片”应用程序中打开一张照片并在照片中滑动，您会发现它在页面之间存在一些间隙。我也想要这些差距。

我正在寻找现有的解决方案（如果有的话），或者除了我在下面解释的那个之外，还有一些关于实现页面间隙的更奇怪的想法。或者也许我错过了一些明显的简单方法？

需要明确的是：我希望只有在滚动时才能看到间隙，所以我不能简单地插入页面内容。

* * *

我的计划是尝试从`scrollViewDidScroll`回调内部移动页面内容，以便（假设您向右滚动）最初目标页面稍微偏移到其页面边界的右侧，并且当您到达目标页面时它回到了正确的位置，并且源页面稍微偏离了其边界的左侧。（或者也许不是连续移动东西，我会更好地移动偏移量，比如说，正好在页面之间的中间。）

我是[ScrollingMadness 文章+示例](http://github.com/andreyvit/ScrollingMadness/tree/master)的作者，我一直在向这里推荐一些人。我已经实现了程序缩放，并让照片内缩放+滚动与照片间分页一起工作。所以我知道如何使用 UIScrollView，并且正在寻找高级的东西。

请不要将我指向 TTScrollView。我自己已经向很多人指出了它，但我认为它与本机 UIScrollView 行为相去甚远，并且不想在我的项目中使用它。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-12T05:56:54.130

> 请注意，这个答案已经很老了。基本概念仍然有效，但您不应该在 iOS7 和 8 中硬编码视图大小。即使您忽略该建议，也不应使用 480 或 330。

您是否尝试过使框架`UIScrollView`略大于屏幕（假设您想全屏显示图像，然后将子视图排列在相同的略大于屏幕边界上。

```
#define kViewFrameWidth 330; // i.e. more than 320

CGRect scrollFrame;
scrollFrame.origin.x = 0;
scrollFrame.origin.y = 0; 
scrollFrame.size.width = kViewFrameWidth;
scrollFrame.size.height = 480;

UIScrollView* myScrollView = [[UIScrollView alloc] initWithFrame:scrollFrame];
myScrollView.bounces = YES;
myScrollView.pagingEnabled = YES;
myScrollView.backgroundColor = [UIColor redColor];

UIImage* leftImage = [UIImage imageNamed:@"ScrollTestImageL.png"];
UIImageView* leftView = [[UIImageView alloc] initWithImage:leftImage];
leftView.backgroundColor = [UIColor whiteColor];
leftView.frame = CGRectMake(0,0,320,480);

UIImage* rightImage = [UIImage imageNamed:@"ScrollTestImageR.png"];
UIImageView* rightView = [[UIImageView alloc] initWithImage:rightImage];
rightView.backgroundColor = [UIColor blackColor];
rightView.frame = CGRectMake(kViewFrameWidth * 2,0,320,480);

UIImage* centerImage = [UIImage imageNamed:@"ScrollTestImageC.png"];
UIImageView* centerView = [[UIImageView alloc] initWithImage:centerImage];
centerView.backgroundColor = [UIColor grayColor];
centerView.frame = CGRectMake(kViewFrameWidth,0,320,480);

[myScrollView addSubview:leftView];
[myScrollView addSubview:rightView];
[myScrollView addSubview:centerView];

[myScrollView setContentSize:CGSizeMake(kViewFrameWidth * 3, 480)];
[myScrollView setContentOffset:CGPointMake(kViewFrameWidth, 0)];

[leftView release];
[rightView release];
[centerView release]; 
```

抱歉，如果无法编译，我在横向应用程序中对其进行了测试，然后将其手动编辑回纵向。我相信你明白了。它依赖于超级视图剪辑，对于全屏视图总是如此。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-07-18T01:40:01.987

所以我没有足够的“代表”来对上面的答案发表评论。这个答案是正确的，但有一个大问题需要注意：

如果您在作为 UINavigationController 一部分的 viewController 中使用 UIScrollView，则导航控制器将调整您的 scrollView 框架的大小。

也就是说，您有一个使用 UINavigationController 在不同视图之间切换的应用程序。您推送一个具有滚动视图的视图控制器，并在视图控制器的 -init 方法中创建此滚动视图。您为其分配一个 (0, 0, 340, 480) 的帧。

现在，转到 viewController 的 -viewDidAppear 方法，获取您创建的 scrollView 的框架。您会发现宽度已减小到 320 像素。因此，分页将无法正常工作。您会期望 scrollView 移动 340 像素，但它会移动 320 像素。

UINavigationController 因弄乱子视图而臭名昭著。它移动它们并调整它们的大小以适应导航栏。简而言之，它不是团队合作者——尤其是在这种情况下。如果您需要精确控制视图的大小和位置，网络上的其他地方建议您不要使用 UINavigationController。相反，他们建议您基于 UINavigationBar 创建自己的 navigationController 类。

嗯，这是一大堆工作。幸运的是，有一个更简单的解决方案：在 viewController 的 -viewDidAppear 方法中设置 scrollView 的框架。此时，UINavigationController 已经完成了对框架的处理，因此您可以将其重置为应有的状态，并且滚动视图将正常运行。

这与 OS 3.0 有关。我没有测试过 3.1 或 2.2.1。我还向 Apple 提交了一份错误报告，建议他们使用诸如“-shouldAutoarrangeSubviews”之类的 BOOL 修改 UINavigationController，以便我们可以使该类保持其肮脏的手离开子视图。

在此之前，上面的修复将在 UINavigationController 内的分页 UIScrollView 中为您提供间隙。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-06-20T19:39:42.420

Apple 已向 iphone 开发者计划的所有成员发布了 2010 年 WWDC 会议视频。讨论的主题之一是他们如何创建照片应用程序！！！他们逐步构建了一个非常相似的应用程序，并免费提供了所有代码。

它也不使用私有 api。这是示例代码下载的链接。您可能需要登录才能获得访问权限。

[http://connect.apple.com/cgi-bin/WebObjects/MemberSite.woa/wa/getSoftware?code=y&source=x&bundleID=20645](http://connect.apple.com/cgi-bin/WebObjects/MemberSite.woa/wa/getSoftware?code=y&source=x&bundleID=20645)

而且，这里是 iTunes WWDC 页面的链接：

[http://insideapple.apple.com/redir/cbx-cgi.do?v=2&la=en&lc=&a=kGSol9sgPHP%2BtlWtLp%2BEP%2FnxnZarjWJglPBZRHd3oDbACudP51JNGS8KlsFgxZto9X%2BTsnqSbeUSWX0doe%2Fzv%2FN5XV55%2FomsyfRgFBysOnIVggO%2Fn2p%2BiweDK%2F%2FmsIXj](http://insideapple.apple.com/redir/cbx-cgi.do?v=2&la=en&lc=&a=kGSol9sgPHP%2BtlWtLp%2BEP%2FnxnZarjWJglPBZRHd3oDbACudP51JNGS8KlsFgxZto9X%2BTsnqSbeUSWX0doe%2Fzv%2FN5XV55%2FomsyfRgFBysOnIVggO%2Fn2p%2BiweDK%2F%2FmsIXj)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-12T15:53:08.807

做到这一点的方法就像你说的，结合了几件事。

如果您希望图像之间有 20 像素的间隙，则需要：

首先，将滚动视图的总宽度扩大 20 像素，然后将其向左移动 10 像素。

其次，当您布置图像的 xLoc 时，为每个图像添加 20px，使它们相隔 20px。第三，将图像的初始 xLoc 设置为 10px 而不是 0px。

第四，确保将滚动视图的内容大小设置为为每个图像添加 20 像素。因此，如果您有 kNumImages 图像并且每个图像都是 kScrollObjWidth，那么您可以这样：

```
[scrollView setContentSize:CGSizeMake((kNumImages * (kScrollObjWidth+20)),  kScrollObjHeight)]; 
```

它应该在那之后工作！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T19:04:11.683

这只是一种预感，如果完全错误，请道歉，但是 contentSize 是否可能只是设置为比屏幕宽度略宽。

然后在视图中将正确的信息呈现到屏幕宽度，而 UIScrollView 会负责其余的工作吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T22:28:07.263

也许你想试试 UIScrollView 的 contentInset 属性？

```
myScrollView.contentInset = UIEdgeInsetsMake(0, 0, 0, 10.0); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-30T14:11:18.930

我只是想我会在这里添加我最终使用的解决方案。很长一段时间以来，我一直在使用 Bryan 调整框架的解决方案，`-viewDidAppear`效果非常好。但是，自从 iOS 引入多任务处理以来，我一直遇到一个问题，即当应用程序从后台恢复时，滚动视图框架会发生变化。在这种情况下，`-viewDidAppear`没有被调用，并且我找不到将在正确的时间调用以撤消更改的委托方法。所以我决定让我的滚动视图成为我的视图控制器视图的子视图，这似乎解决了这个问题。这还具有不需要使用`-viewDidAppear`来更改框架的优点 - 您可以在创建滚动视图后立即执行此操作。我的问题[在这里](https://stackoverflow.com/questions/8279194/how-do-i-preserve-the-frame-of-a-uiscrollview-upon-entering-foreground/8680228#8680228)有详细信息，但我也会在这里发布它们：

```
CGRect frame = CGRectMake(0, 0, 320, 460);
scrollView = [[UIScrollView alloc] initWithFrame:frame];

// I do some things with frame here

CGRect f = scrollView.frame;
f.size.width += PADDING; // PADDING is defined as 20 elsewhere
scrollView.frame = f;

[self.view addSubview:scrollView]; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-30T04:10:10.377

为了避免弄乱 UIScrollView 的框架，您可以继承 UIScrollView 并覆盖 layoutSubviews 以将偏移量应用于每个页面。

这个想法是基于以下观察：

1.  当 zoomScale !=1 时，在左/右边缘时偏移量为零
2.  当 zoomScale ==1 时，在可见矩形中心时偏移量为零

然后衍生出以下代码：

```
- (void) layoutSubviews
{
    [super layoutSubviews];

    // Find a reference point to calculate the offset:
    CGRect bounds = self.bounds;
    CGFloat pageGap = 8.f;
    CGSize pageSize = bounds.size;
    CGFloat pageWidth = pageSize.width;
    CGFloat halfPageWidth = pageWidth / 2.f;
    CGFloat scale = self.zoomScale;
    CGRect visibleRect = CGRectMake(bounds.origin.x / scale, bounds.origin.y / scale, bounds.size.width / scale, bounds.size.height / scale);
    CGFloat totalWidth = [self contentSize].width / scale;
    CGFloat scrollWidth = totalWidth - visibleRect.size.width;
    CGFloat scrollX = CGRectGetMidX(visibleRect) - visibleRect.size.width / 2.f;
    CGFloat scrollPercentage = scrollX / scrollWidth;
    CGFloat referencePoint = (totalWidth - pageWidth) * scrollPercentage + halfPageWidth;

    // (use your own way to get all visible pages, each page is assumed to be inside a common container)
    NSArray * visiblePages = [self visiblePages];

    // Layout each visible page:
    for (UIView * view in visiblePages)
    {
        NSInteger pageIndex = [self pageIndexForView:view]; // (use your own way to get the page index)

        // make a gap between pages
        CGFloat actualPageCenter = pageWidth * pageIndex + halfPageWidth;
        CGFloat distanceFromRefPoint = actualPageCenter - referencePoint;
        CGFloat numOfPageFromRefPoint = distanceFromRefPoint / pageWidth;
        CGFloat offset = numOfPageFromRefPoint * pageGap;
        CGFloat pageLeft = actualPageCenter - halfPageWidth + offset;

        view.frame = CGRectMake(pageLeft, 0.f, pageSize.width, pageSize.height);
    }
} 
```

# python - 通过 CGI 部署 Python

> ID：849384
> 
> 赞同：1
> 
> 时间：2009-05-11T18:22:12.860
> 
> 标签：python

如何通过 CGI 将 Python 项目部署到支持 Python 的网络服务器？我精通PHP，但不了解CGI在部署过程中与Python的关系。

任何资源链接表示赞赏。

有问题的网络主机是 GoDaddy。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:12:27.567

通常，我们使用[mod_wsgi](http://code.google.com/p/modwsgi/)来使 Python 应用程序响应 CGI。

PHP 有一个特殊的角色——语言运行时是一个 CGI 应用程序。

Python 没有这个特殊的角色。Python - 默认情况下 - 不是 CGI 应用程序。它需要一块胶水才能很好地与 Apache 配合使用。mod_wsgi 就是这种胶水。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:44:17.020

要真正回答您关于将 python 部署为 CGI 的问题（虽然它在高活动系统上没有多大意义 - 在某些情况下它可以很好地完成工作），您只需确保您的文件是可执行的，具有正确的扩展名，然后按照[本教程](http://www.cs.virginia.edu/~lab2q/)进行操作。这是我过去学习的。

编辑：要清楚 - 我建议您研究[Django](http://www.djangoproject.com/)来部署基于 Web 的 python 应用程序。

# java - 如何在 Maven 中读取外部属性文件

> ID：849389
> 
> 赞同：135
> 
> 时间：2009-05-11T18:23:56.820
> 
> 标签：java, build, maven-2, properties-file

有谁知道如何在 Maven 中读取 x.properties 文件。我知道有一些方法可以使用资源过滤来读取属性文件并从中设置值，但我想要在我的 pom.xml 中使用一种方法，例如：

```
<properties file="x.properties"> 

</properties> 
```

对此进行了一些讨论： [Maven外部属性](http://www.mail-archive.com/users@maven.apache.org/msg70112.html)

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-05-11T18:40:58.867

试试 [Properties Maven 插件](http://www.mojohaus.org/properties-maven-plugin/)

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2009-05-18T21:52:09.350

使用建议的 Maven 属性插件，我可以读取 buildNumber.properties 文件，该文件用于对构建进行版本控制。

```
 <build>    
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>properties-maven-plugin</artifactId>
        <version>1.0-alpha-1</version>
        <executions>
          <execution>
            <phase>initialize</phase>
            <goals>
              <goal>read-project-properties</goal>
            </goals>
            <configuration>
              <files>
                <file>${basedir}/../project-parent/buildNumber.properties</file>
              </files>
            </configuration>
          </execution>
        </executions>
      </plugin>
   </plugins> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-09-20T13:04:58.060

This [answer](https://stackoverflow.com/questions/1231561/how-to-share-common-properties-among-several-maven-projects/1265428#1265428) to a similar question描述了如何扩展属性插件，以便它可以使用属性文件的远程描述符。描述符基本上是一个包含属性文件的 jar 工件（属性文件包含在 src/main/resources 下）。

描述符被添加为扩展属性插件的依赖项，因此它位于插件的类路径中。该插件将在类路径中搜索属性文件，将文件的内容读入 Properties 实例，并将这些属性应用于项目的配置，以便它们可以在其他地方使用。

# java - Java BBCode 库

> ID：849396
> 
> 赞同：17
> 
> 时间：2009-05-11T18:26:02.527
> 
> 标签：java, parsing, bbcode

有人使用过良好的 BBCode Java 实现吗？我在看

1.  [javabbcode](https://javabbcode.dev.java.net/)：没什么可看的
2.  [kefir-bb](http://sourceforge.net/projects/kefir-bb/) : 列为 alpha
3.  JBoss 源代码中的 BBcode 解析器。

有没有更好的选择？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-09-15T22:09:54.360

**当前版本的 KefirBB 0.6 不再列为测试版。我发现 KefirBB 解析器很容易使用我自己的标签进行配置和扩展：**

[开菲尔-bb.sourceforge.net](http://kefir-bb.sourceforge.net/)

*（这是迄今为止我发现的最好的[BBCode解析器）](http://en.wikipedia.org/wiki/BBCode)*

我还在[fyhao.com](http://fyhao.com/2010/06/computer-and-it/java/simple-java-bbcode-implementation/)找到了这段代码，但它确实可以保护您免受错误嵌套标签的影响（因此不适合解析用户输入的输入）：

```
 public static String bbcode(String text) {
        String html = text;

        Map<String,String> bbMap = new HashMap<String , String>();

        bbMap.put("(\r\n|\r|\n|\n\r)", "<br/>");
        bbMap.put("\\[b\\](.+?)\\[/b\\]", "<strong>$1</strong>");
        bbMap.put("\\[i\\](.+?)\\[/i\\]", "<span style='font-style:italic;'>$1</span>");
        bbMap.put("\\[u\\](.+?)\\[/u\\]", "<span style='text-decoration:underline;'>$1</span>");
        bbMap.put("\\[h1\\](.+?)\\[/h1\\]", "<h1>$1</h1>");
        bbMap.put("\\[h2\\](.+?)\\[/h2\\]", "<h2>$1</h2>");
        bbMap.put("\\[h3\\](.+?)\\[/h3\\]", "<h3>$1</h3>");
        bbMap.put("\\[h4\\](.+?)\\[/h4\\]", "<h4>$1</h4>");
        bbMap.put("\\[h5\\](.+?)\\[/h5\\]", "<h5>$1</h5>");
        bbMap.put("\\[h6\\](.+?)\\[/h6\\]", "<h6>$1</h6>");
        bbMap.put("\\[quote\\](.+?)\\[/quote\\]", "<blockquote>$1</blockquote>");
        bbMap.put("\\[p\\](.+?)\\[/p\\]", "<p>$1</p>");
        bbMap.put("\\[p=(.+?),(.+?)\\](.+?)\\[/p\\]", "<p style='text-indent:$1px;line-height:$2%;'>$3</p>");
        bbMap.put("\\[center\\](.+?)\\[/center\\]", "<div align='center'>$1");
        bbMap.put("\\[align=(.+?)\\](.+?)\\[/align\\]", "<div align='$1'>$2");
        bbMap.put("\\[color=(.+?)\\](.+?)\\[/color\\]", "<span style='color:$1;'>$2</span>");
        bbMap.put("\\[size=(.+?)\\](.+?)\\[/size\\]", "<span style='font-size:$1;'>$2</span>");
        bbMap.put("\\[img\\](.+?)\\[/img\\]", "<img src='$1' />");
        bbMap.put("\\[img=(.+?),(.+?)\\](.+?)\\[/img\\]", "<img width='$1' height='$2' src='$3' />");
        bbMap.put("\\[email\\](.+?)\\[/email\\]", "<a href='mailto:$1'>$1</a>");
        bbMap.put("\\[email=(.+?)\\](.+?)\\[/email\\]", "<a href='mailto:$1'>$2</a>");
        bbMap.put("\\[url\\](.+?)\\[/url\\]", "<a href='$1'>$1</a>");
        bbMap.put("\\[url=(.+?)\\](.+?)\\[/url\\]", "<a href='$1'>$2</a>");
        bbMap.put("\\[youtube\\](.+?)\\[/youtube\\]", "<object width='640' height='380'><param name='movie' value='http://www.youtube.com/v/$1'></param><embed src='http://www.youtube.com/v/$1' type='application/x-shockwave-flash' width='640' height='380'></embed></object>");
        bbMap.put("\\[video\\](.+?)\\[/video\\]", "<video src='$1' />");

        for (Map.Entry entry: bbMap.entrySet()) {
            html = html.replaceAll(entry.getKey().toString(), entry.getValue().toString());
        }

        return html;
    } 
```

顺便说一句，javaBBcode 是开源项目的一部分：[JavaBB](http://www.javabb.org/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-11T20:31:26.477

我相信更好的选择是使用 wiki 标记。您可以尝试 Mylyn Wikitext 包，我目前在我们的文档系统中使用它取得了巨大的成功。

但是，这不是您问题的答案，如果您尝试自动解析一些您已经拥有的论坛文本:-I

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-07T14:02:09.993

> 我相信更好的选择是使用 wiki 标记

除非您有习惯 bbcode 并且对学习另一种神秘标记格式不太感兴趣的非技术用户。

我过去曾成功使用正则表达式在 html 和 bbcode 之间切换。定义涵盖每个标签的表达式列表，并为每个标签预编译模式。然后用每个表达式迭代地转换字符串。双向工作。性能实际上相当不错，您可以轻松适应自己的方言/扩展。

缺点是正则表达式并不总是很容易解决。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-07-30T17:56:24.170

用于 BBCode 解析和转换为 HTML 的另一个 Java 选项是 Prime Transformer。

[https://github.com/inversoft/prime-transformer](https://github.com/inversoft/prime-transformer)

我们为某些特定用途构建了它，但试图保持它足够通用以供一般消费。我有一个基本示例，说明如何在 GitHub 的登录页面上将其组合在一起。

# c - 使用 3D 图形的最佳途径是什么？

> ID：849402
> 
> 赞同：2
> 
> 时间：2009-05-11T18:26:49.170
> 
> 标签：c, opengl, 3d

现在，我认为 C 和 openGL 的组合是我需要学习的，但似乎我需要的还有更多。另外，我不知道从哪里开始。我通过阅读*C 编程语言*(K&R)了解了一些 C。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T18:38:19.073

如果您了解 3D 计算机图形背后的概念，那么 OpenGL + C 就是您所需要的。如果您在概念方面需要一些帮助，那么我建议您[阅读 NeHe OpenGL 教程](http://nehe.gamedev.net/)和一本很好的参考书，例如[The Red Book](https://rads.stackoverflow.com/amzn/click/com/0321481003)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:02:11.573

这取决于您要执行的操作：

*   如果您对游戏感兴趣并且只想开发业余的东西而不是大惊小怪，那么 XNA + C# 是迄今为止最简单的开始方式。
*   如果你打算成为一名专业的游戏开发者，你最好的选择是 DirectX + C++。
*   如果你喜欢开源并且只想搞乱一般的 3D，OpenGL + C/C++ 将为你提供一个很好的敬业社区。

当然，除了最后两个之外，您还可以使用许多引擎和库，例如扭矩、几何工具等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:31:16.137

我不认为还有更多。是什么让你这么想的 ？开始使用 C 和 OpenGL 就足够了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T18:29:08.310

我建议你看看 .NET 的可能性，即[XNA Framework](http://msdn.microsoft.com/en-us/xna/default.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T18:41:36.807

我建议您非常高度地了解、阅读和完成《[计算机图形学：原理与实践](https://rads.stackoverflow.com/amzn/click/com/0201848406)》一书中的一些示例。是的，这本书已经过时了。它仍然是这类事情的规范参考。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T18:32:34.107

我发现使用 3D Studio Max 并实际制作模型对学习一些 OpenGL 有很大帮助。我可以理解法线和诸如此类的所有复杂性。

我真的建议不要尝试同时学习 C 和 OpenGL。它们都很复杂，而且当你混合它们时更是如此。

# asp.net - 任何人都可以劫持（通过 js）asp.net 表单 cookie 并更改过期日期吗？

> ID：849409
> 
> 赞同：6
> 
> 时间：2009-05-11T18:28:07.420
> 
> 标签：asp.net, forms-authentication

任何人都可以劫持（通过 js）asp.net 表单 cookie 并更改过期日期吗？

什么可以阻止他们抓住它并更改到期日期？即有效地让用户保持登录状态？

**更新**

.net 框架是否形成身份验证。cookie 依赖于 cookie 的到期日期还是它加密？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T21:04:49.287

您可以采取一些措施来改善这种情况。

在 web.config 中，为 cookie 设置 protection="All"：http: [//msdn.microsoft.com/en-us/library/1d3t3c61.aspx](http://msdn.microsoft.com/en-us/library/1d3t3c61.aspx)。这将加密和验证，使破解客户端变得更加困难。

此外，cookie 可以将 httpOnly 设置为 true。这告诉浏览器无法在 javascript 中操作 cookie。

web.config 中的 <forms> 元素也有一个超时设置（参见上面的链接）。微软的实现可能足够聪明，不会仅仅依赖于 cookie，但我不知道。

其他评论是正确的，客户永远不应该被信任。因此，为了保证安全，您需要在服务器上跟踪“上次登录”并在一段时间后强制重新登录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T18:31:29.380

Cookie 由客户端存储，您不能相信它们不会更改。

Firefox 有一些扩展程序可以让您编辑 cookie，包括过期日期。如果您希望它们强制它们过期，您应该也在服务器端跟踪它们并在那里使它们过期。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:30:55.357

跟踪它服务器端。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T22:15:19.267

通过 JS (JavaScript) 是不可能的，至少在支持 ASP.NET 为 Forms cookie 设置的 HttpOnly 属性的浏览器中是不可能的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T18:33:19.627

如果您想防止这种情况发生，请将过期日期散列到 cookie 值中。然后，当您检索 cookie 时，如果散列到期日期与明文到期日期不匹配，则丢弃 cookie。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T18:30:01.613

不太确定 javascript 但你可以使用 Fire Fox 的 Cookie Editor add on

加密它

在 cookie 中设置一个额外的日期标志

# java - Spring MVC DefaultRequestToViewNameTranslator 大写问题

> ID：849410
> 
> 赞同：3
> 
> 时间：2009-05-11T18:28:23.927
> 
> 标签：java, spring, spring-mvc

我正在使用 Spring MVC 尝试整个“约定优于配置”。Spring 有各种各样的工具来帮助解决这个问题，我正在尝试其中的一些。但是，我遇到了一个问题，我们团队的配置与 Spring 想要的不太匹配。

问题是我们获取像“ [http://ourSite/SomePage.do](http://ourSite/SomePage.do) ”这样的 URL，将它们放入“SomePageController”，然后用“somePage.jsp”渲染它们。请注意 SomePage.do 以大写字母开头，而 somePage.jsp 不是。似乎 Spring 的 DefaultRequestToViewNameTranslator 保留了大写字母，而 ViewResolvers 无法弄清楚如何使第一个字符小写。

有没有办法配置 NameTranslator 或 ViewResolver 使第一个字母小写？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T20:20:01.327

DispatcherServlet的[Javadocs](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/web/servlet/DispatcherServlet.html)指定如何确定“viewNameTranslator”：

> 如果用户未提供视图或视图名称，则配置的 RequestToViewNameTranslator 会将当前请求转换为视图名称。对应的bean名称为“ `viewNameTranslator`”；默认为`DefaultRequestToViewNameTranslator`.

因此，如果您想要稍微不同的“视图名称转换器”行为，则必须提供自己的实例。您可能可以轻松地仅子类`DefaultRequestToViewNameTranslator`化以添加有关文件名大小写的逻辑。

但老实说，我真的建议您的控制器返回命名视图，而不必依赖与 URI 相同的视图名。这使您可以对多个 URL/控制器使用相同的视图，并允许您真正从 URL 中抽象出“视图”的概念。

（老实说，我已经在一个相当大的应用程序上使用 Spring MVC 大约 5 个月了，甚至不知道这个`DefaultRequestToViewNameTranslator`类在框架中，或者 DispatherServlet 将使用“viewNameTranslator”！）

# javascript - 在 jquery 自动完成中处理没有结果

> ID：849415
> 
> 赞同：9
> 
> 时间：2009-05-11T18:29:39.353
> 
> 标签：javascript, jquery, jquery-ui, autocomplete

嘿，当用户当前查询没有结果时，我正在尝试返回一条消息！我知道我需要利用 keyup 事件，但看起来插件正在使用它

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-11-22T01:05:13.050

这个问题真的过时了，无论如何我正在使用新的 jQuery UI 1.8.16，自动完成现在非常不同：http: [//jqueryui.com/demos/autocomplete/#default](http://jqueryui.com/demos/autocomplete/#default)

无论如何，如果您尝试做与问题相同的事情，则没有更多的 parse 函数，据我所知，没有与搜索结果一起调用的函数。

我设法解决这个问题的方法是覆盖自动完成的过滤器功能 - 注意：这会影响你所有的自动完成

```
$.ui.autocomplete.filter = function(array, term) {
            var matcher = new RegExp( $.ui.autocomplete.escapeRegex(term), "i" );

            var aryMatches = $.grep( array, function(value) {
                return matcher.test(value.label || value.value || value);
            });

            if (aryMatches.length == 0){
                aryMatches.push({
                    label: '<span class="info" style="font-style: italic;">no match found</span>',
                    value: null
                });                     
            }

            return aryMatches;
        }; 
```

该函数从源代码略有修改，grep 调用是相同的，但如果没有结果我添加一个值为 null 的对象，然后我覆盖 select 调用以检查 null 值。

这为您提供了一种效果，如果您继续输入并且没有找到匹配项，您会在下拉列表中看到“未找到匹配项”，这非常酷。

要覆盖选择调用，请参阅[jQuery UI 自动完成禁用选择和关闭事件](https://stackoverflow.com/questions/6043506/jquery-ui-autocomplete-disable-select-close-events)

```
$(this).data('autocomplete').menu.options.selected = function(oEvent, ui){

            if ($(ui.item).data('item.autocomplete').value != null){
                //your code here - remember to call close on your autocomplete after

            }
        }; 
```

由于我在页面上的所有自动完成中都使用了它，因此请确保首先检查值是否为空！在您尝试引用不存在的密钥之前。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T18:48:28.840

您可以尝试提供一个解析选项（处理数据解析的函数），并在没有返回解析的结果时执行您需要的操作。

此示例假定您正在获取包含 FullName 和 Address 属性的 JSON 对象数组。

```
 $('#search').autocomplete( {
       dataType: "json",
       parse: function(data) {
         var array = new Array();
         if (!data || data.length == 0) {
             // handle no data case specially
         }
         else {
            for (var i = 0; i < data.length; ++i) {
               var datum = data[i];
               array[array.length] = { 
                                       data: datum,
                                       value: data.FullName + ' ' + data.Address,
                                       result: data.DisplayName
                                     };
            }
         }
         return array;
       }
   }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-29T19:29:48.047

我将以下代码用于相同目的（消息显示在自动完成列表中）：

```
success: function(data, status, xhr){                       
    if(!data.length){
        var result = [
            {
                label: 'There are no matches for your query: ' + response.term, 
                value: response.term
            }
        ];
        response(result);
    }
    else{
        // normal response
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-04-26T18:37:41.407

您还可以利用“响应”事件来检查这一点。简单但功能强大。 [http://api.jqueryui.com/autocomplete/#event-response](http://api.jqueryui.com/autocomplete/#event-response)

```
response: function (event, ui) {
            if (ui.content.length == 0) {
                //Display an alert or something similar since there are no results
            }
        }, 
```

# f# - 在 F# 中计算带引号的表达式

> ID：849416
> 
> 赞同：13
> 
> 时间：2009-05-11T18:30:01.317
> 
> 标签：f#, quotations

我希望我没有错过一些明显的东西，但我一直在玩 F# 表达式，我想即时评估引用的表达式。例如，我想写这样的东西：

```
let x = <@ 2 * 5 @>
let y = transform x // replaces op_Multiply with op_Addition, or <@ 2 + 5 @>
let z = eval y // dynamically evaluates y, returns 7 
```

**是否有可以评估引用表达式的内置 F# 方法，还是我必须自己编写？**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-07-08T22:08:11.840

[作为Unquote](http://code.google.com/p/unquote/)的一部分，我已经实现了一个基于反射的报价评估器（这是 2.0.0 版的新功能）。

```
> #r @"..\packages\Unquote.2.2.2\lib\net40\Unquote.dll"

--> Referenced '..\packages\Unquote.2.2.2\lib\net40\Unquote.dll'

> Swensen.Unquote.Operators.eval <@ sprintf "%A" (1,2) @>;;
val it : string = "(1, 2)" 
```

我测得它比 PowerPack 的评估器快 50 倍。当然，这会因场景而异。但在解释表达式时，Unquote 通常比 PowerPack 快几个数量级。

它还支持比 PowerPack 的求值器更多的表达式，包括 VarSet、PropertySet、FieldSet、WhileLoop、ForIntegerRangeLoop 和 Quote。事实上，Unquote 的求值器支持*除*NewDelegate、AddressSet 和 AddressOf 之外的所有引用表达式，我计划最终支持所有这些表达式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-11T18:34:32.293

不，没有编译 F# 引用的内置方法。使用 PowerPack LINQ，您可以将一些引用转换为 .NET System.Linq.Expressions.Expression，并使用它来编译它们。

引用是为了允许对代码进行其他解释，例如针对 SQL 或 GPU 卡。

然而，在 hubfs 上的帖子中，有人暗示这是一个常见的请求，将予以关注。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-07-09T09:17:34.177

`Eval`您可以使用 DLL提供的扩展成员评估 F# 引用`FSharp.PowerPack.Linq`，如下所示：

```
#r "FSharp.PowerPack.Linq.dll"

open Linq.QuotationEvaluation
let f = <@2 + 3@>
f.Eval() 
```

请注意，您必须命名空间才能`open`使`Linq.QuotationEvaluation`此扩展成员可用。

还有一个`Compile`扩展成员返回暂停，但似乎并没有提高性能。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-06-16T20:28:58.273

**2016年更新**

现在`Evaluate`可以在 NuGet 包中找到扩展方法`FSharp.Quotations.Evaluator`

```
#r "../packages/FSharp.Quotations.Evaluator.1.0.7/lib/net40/FSharp.Quotations.Evaluator.dll"

open FSharp.Quotations.Evaluator

let f = <@ 2 + 3 @>
f.Evaluate() 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-11T18:34:14.743

我认为引文有一个`.eval()`方法。

# debugging - 调试深度递归的实用技巧？

> ID：849422
> 
> 赞同：18
> 
> 时间：2009-05-11T18:30:51.817
> 
> 标签：debugging, language-agnostic, recursion

我正在研究一种棋盘游戏算法，其中使用递归遍历一棵大树，但是，它的行为不如预期。我该如何处理？您在这些情况下有何经验？

更糟糕的是，它使用了 alpha-beta 剪枝，这意味着树的整个部分都不会被访问，并且当满足某些条件时它会简单地停止递归。我也不能将搜索深度更改为较低的数字，因为虽然它是确定性的，但结果确实会因搜索深度而异，并且它可能在较低的搜索深度下表现如预期（确实如此）。

现在，我不会问你“我的代码的问题在哪里？” 但我正在寻找一般提示、工具、可视化，以及调试这样的代码的任何东西。就个人而言，我正在使用 C# 进行开发，但欢迎使用任何和所有工具。尽管我认为这可能最适用于命令式语言。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-11T18:37:40.760

记录。广泛登录您的代码。根据我的经验，日志记录是解决这些类型问题的方法。当很难弄清楚您的代码在做什么时，广泛记录它是一个非常好的解决方案，因为它可以让您从代码中输出内部状态是什么；这确实不是一个完美的解决方案，但据我所知，它比使用任何其他方法都更好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T18:39:08.683

我过去做过的一件事是格式化日志以反映递归深度。因此，您可以为每个递归或其他一些分隔符做一个新的缩进。然后制作一个调试 dll，记录您需要了解的有关每次迭代的所有信息。在这两者之间，您应该能够阅读执行路径并希望能找出问题所在。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-11T18:35:12.603

我通常会使用一个或多个具有明确结果的预定义数据集对此类算法进行单元测试。我通常会按照复杂性递增的顺序进行几个这样的测试。

如果您坚持调试，有时使用检查给定值的语句来修改代码很有用，因此您可以在那时附加一个断点并放置在代码中：

```
 if ( depth = X && item.id = 32) {
     // Breakpoint here
  } 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-11T18:47:10.027

也许您可以将递归转换为带有参数显式堆栈的迭代。以这种方式进行测试更容易，因为您可以直接记录值、访问堆栈并且不必在每次自我评估中传递数据/变量或防止它们超出范围。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-11T18:54:08.050

我曾经在开发 AI 算法来玩俄罗斯方块游戏时遇到过类似的问题。在尝试了很多事情之后，在阅读我自己的日志和调试以及步入和退出函数方面浪费了很多时间，对我来说，最终的结果是编写一个快速可视化器并使用 FIXED 输入测试我的代码。

因此，如果时间不是问题，并且您真的想了解正在发生的事情，请获取固定的电路板状态，并使用调试日志/输出和某种您自己的工具来查看您的程序对数据的处理方式显示每个步骤的信息。

一旦你找到一个给你这个问题的板状态，试着找出它开始的功能，然后你就可以解决它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-11T18:40:29.867

我知道这会是多么痛苦。在我的工作中，我们目前正在使用一个基本上表现为黑匣子的第三方应用程序，因此我们必须设计一些有趣的调试技术来帮助我们解决问题。

当我在大学上编译器理论课程时，我们使用了一个软件库来可视化我们的树；这也可能对您有所帮助，因为它可以帮助您查看树的样子。事实上，您可以自己构建一个 WinForms/WPF 应用程序来将树的内容转储到 TreeView 控件中——这很麻烦，但它可以完成工作。

您可能还想考虑某种调试输出。我知道您提到您的树很大，但也许调试语句或在执行期间您无法可视化的关键点中断会帮助您。

还要记住，使用 Visual Studio 进行智能调试可以创造奇迹。很难看出状态在多个中断之间是如何变化的，但 Visual Studio 2010 实际上应该对此有所帮助。

不幸的是，在没有更多信息的情况下帮助您进行调试并不是特别容易。您是否确定了它开始破裂的第一个深度？它会随着搜索深度的增加而继续中断吗？您可能想要评估您的工作案例并尝试确定它有何不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T18:41:01.190

既然您说遍历没有按预期工作，我假设您对可能出错的地方有所了解。然后检查代码以确认您没有忽略一些基本的东西。

之后，我建议您设置一些简单的单元测试。如果他们通过了，那么继续添加测试直到他们失败。如果它们失败了，则减少测试，直到它们通过或尽可能简单。这应该可以帮助您查明问题。

如果你也想调试，我建议你使用条件断点。Visual Studio 允许您修改断点，因此您可以设置触发断点的条件。这可以减少您需要查看的迭代次数。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-11T18:42:49.457

我将从检测功能开始。在每个递归调用日志中，数据结构和任何其他有助于您识别问题的信息。

将转储连同源代码一起打印出来，然后离开计算机，一边喝杯咖啡，一边进行一次不错的纸质调试会议。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-15T22:59:27.150

从您提到 if else 语句的基本案例开始，然后尝试通过在笔和纸上写下来+在使用值生成递归函数的前几个实例时在控制台上打印值来引导您的想法。

座右铭是找到您打印的值之间的正确趋势，并将它们与您在递归算法的最初几个步骤中写在纸上的值匹配。

# iphone - 低于 10mb 的 iphone 应用程序大小限制是否被压缩？

> ID：849424
> 
> 赞同：1
> 
> 时间：2009-05-11T18:31:12.377
> 
> 标签：iphone

关于无法下载大于 10mb 的 iphone 应用程序...

这是否适用于压缩或未压缩的文件大小？

谢谢你的帮助

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:33:43.463

压缩。

*（[不过要小心你的 9.9MB 应用程序](http://discussions.apple.com/thread.jspa?threadID=1862941&tstart=120)）*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:22:59.750

我相信 iPhone 应用程序可以达到 2 GB。那么 10 MB 数字是指可以在蜂窝网络上下载的应用程序与可以通过 wifi 或计算机上的 iTunes 下载的应用程序。

iPhone 应用程序 Myst 远大于 10 MB。 [单击此处获取有关应用程序的故事的链接](http://www.macrumors.com/2009/05/03/cyans-classic-myst-arrives-in-app-store/)

# stored-procedures - 将参数传递给 Crystal Report 子报表中的存储过程？

> ID：849455
> 
> 赞同：1
> 
> 时间：2009-05-11T18:40:06.607
> 
> 标签：stored-procedures, crystal-reports

我有一个水晶报表，它填充了一个存储过程，它还包含一个子报表，我试图用另一个存储过程填充它......相同的参数。我无法弄清楚如何将参数值传递给子报告。

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T18:51:44.090

当您将存储的过程添加到子报告中时，CR 将自动添加参数。然后，当您设置子报告链接时，您将主报告参数链接到子报告参数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-04T16:54:29.573

我知道这个问题很老，但我没有找到任何令人满意的答案。**我发现的简单解决方案是在水晶命令**中实现存储过程，就像任何其他命令**sql**一样。无论如何，我都无法让参数显示在左下角的下拉菜单中。类似于下面的内容，其中`ZNG_PROACTIVE_STREET_SWEEPS`存储过程的名称和两个参数是存储过程接受的内容。

`[dbo].[ZNG_PROACTIVE_STREET_SWEEPS] @StartDate ={?begindate}, @EndDate = {?enddate}`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-12T12:09:42.420

Sounds all so simple, but unfortuanate it isn't that simple. I can link the parameters from main to sub -report, no problem. But when it comes to feeding it to the subreport procedure parameters it becomes rather difficult.

I'm using Crystal XI. Same procedure main and subreport. The aim is to let the user select the parameters only once. Currently, the user needs to select the parameters for both main and sub report.

**Ok, I over-read the comment where to find the dropdown.** The drop down is in the screen subreport links. On the botton there are 2 dropdowns, use the one on the left.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-27T07:51:27.217

您可以像这样将值传递给子报告：

```
oRpt.SetParameterValue("@InvNo", Session("InvoiceNo"), "rptInvoicePrintSub") ' parameter for subreport 
```

# sql - 使用 Quickbooks 2008+ 数据构建报告的方法

> ID：849456
> 
> 赞同：0
> 
> 时间：2009-05-11T18:40:21.207
> 
> 标签：sql, report, quickbooks, building

我希望为 Quickbooks 数据构建一些报告，而不使用 Quickbooks 内置报告，或通过第三方库（如 QODBC）。

Quickbooks 2008 和更新版本建立在 SQL 后端之上。环顾四周，似乎有几种产品和角度可以做到这一点。

理想情况下，我希望自己能够直接对数据库进行 SQL 命中，或者使用诸如 Crystal Reports 之类的东西。

我想在这里要求收集任何可以仔细观察的东西，以及为了避免悲伤而可能避免的东西。

提前致谢！

**更新**：Quickbooks 似乎对其 sql 数据库进行了加密，因此您无法使用报告工具直接读取它。市场上有一些产品可以提供帮助......更多产品即将推出。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:42:51.547

如果它托管在 SQL 2005 或 2008 上，您可以使用 Reporting Services（免费）和与其捆绑的 Report Builder。如果您使用 2008，那么我建议您下载 Report Builder 2.0

[http://www.microsoft.com/downloads/details.aspx?familyid=9f783224-9871-4eea-b1d5-f3140a253db6](http://www.microsoft.com/downloads/details.aspx?familyid=9f783224-9871-4eea-b1d5-f3140a253db6)

这里有一些学习RS的链接：

[http://www.google.com/search?q=reporting+services+tutorial+video&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a](http://www.google.com/search?q=reporting+services+tutorial+video&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-14T12:51:09.840

最好的选择是 QuickBooks SDK，它提供了获取数据的工具，还可以直接从 QuickBooks 中获取报告数据，格式为 XML 以便于解析和显示，但你想显示它。

您可以使用 qbXML/QBFC [QuickBooks On-Screen 参考](https://developer.intuit.com/qbsdk-current/Common/newOSR/index.html)查看可用的数据（您可以发送到 QuickBooks 的请求位于屏幕顶部的“选择消息”下拉框中）。

QuickBooks SDK 可从[Intuit 开发者网络免费下载（需要注册）](http://developer.intuit.com/technical_resources/?id=1488)

如果您正在编写桌面应用程序，您可以考虑使用 QBFC，这是一个使用 COM/DCOM 与 QuickBooks 对话的 API。

如果您使用 PHP，IDN 论坛上有一个流行的[QuickBooks PHP 框架](https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=9164)。

如果您使用的是 ASP.NET，这里还有一个[QuickBooks ASP .NET 框架](https://idnforums.intuit.com/messageview.aspx?catid=56&threadid=11040&enterthread=y)。

如果您想要直接 SQL 访问，您应该查看 QODBC（它是将 SQL 查询转换为 qbXML SDK 请求的 SQL 包装器）或 AccessBooks（它使用 SDK 将 QuickBooks 数据镜像到 SQL 数据库）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T16:03:21.977

那么您是否使用 2008 版（SQL Server）？

如果是这样，您可以使用 SQLChicken 发布的 SSRS，或者您可以使用任何其他报告工具，并通过 SQL Native Client（随 SQL Server 提供）进行连接： - Crystal Reports - Excel -*在此处插入您最喜欢的报告工具*

# iphone - 导航控制器上的透明模式视图

> ID：849458
> 
> 赞同：71
> 
> 时间：2009-05-11T18:40:56.963
> 
> 标签：iphone

我正在尝试在我的导航控制器之上创建一个透明的模态视图。有谁知道这是否可能？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-05-13T17:10:01.523

模态视图将覆盖它被推送到顶部的视图以及导航控制器的导航栏。但是，如果您使用 -presentModalViewController:animated: 方法，那么一旦动画完成，刚刚覆盖的视图实际上会消失，这会使您的模态视图的任何透明度变得毫无意义。（您可以通过在根视图控制器中实现 -viewWillDisappear: 和 -viewDidDisappear: 方法来验证这一点）。

您可以将模态视图直接添加到视图层次结构中，如下所示：

```
UIView *modalView =
    [[[UIView alloc] initWithFrame:[[UIScreen mainScreen] bounds]] autorelease];
modalView.opaque = NO;
modalView.backgroundColor =
    [[UIColor blackColor] colorWithAlphaComponent:0.5f];

UILabel *label = [[[UILabel alloc] init] autorelease];
label.text = @"Modal View";
label.textColor = [UIColor whiteColor];
label.backgroundColor = [UIColor clearColor];
label.opaque = NO;
[label sizeToFit];
[label setCenter:CGPointMake(modalView.frame.size.width / 2,
                                modalView.frame.size.height / 2)];
[modalView addSubview:label];

[self.view addSubview:modalView]; 
```

像这样将 modalView 作为子视图添加到根视图实际上不会覆盖导航栏，但会覆盖其下方的整个视图。我尝试使用用于初始化 modalView 的框架的原点，但负值会导致它不显示。除了状态栏之外，我发现覆盖整个屏幕的最佳方法是将 modalView 添加为窗口本身的子视图：

```
TransparentModalViewAppDelegate *delegate = (TransparentModalViewAppDelegate *)[UIApplication sharedApplication].delegate;
[delegate.window addSubview:modalView]; 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-09-09T21:07:12.977

最简单的方法是使用**navigationController的****modalPresentationStyle**属性（但您必须自己制作动画）：

 **```
self.navigationController.modalPresentationStyle = UIModalPresentationCurrentContext;
[self presentModalViewController:modalViewController animated:NO];
modalViewController.view.alpha = 0;
[UIView animateWithDuration:0.5 animations:^{
    modalViewController.view.alpha = 1;
}]; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-11T18:45:58.233

我通过设置位于我的窗口或根视图的所有其他子视图之上的“OverlayViewController”来最轻松地完成此操作。在您的应用程序委托或根视图控制器中进行设置，并使 OverlayViewController 成为单例，以便可以从代码或视图控制器层次结构中的任何位置访问它。然后，您可以在需要时调用方法来显示模式视图、显示活动指示器等，它们可能会覆盖任何选项卡栏或导航控制器。

根视图控制器的示例代码：

```
- (void)viewDidLoad {
  OverlayViewController *o = [OverlayViewController sharedOverlayViewController];
  [self.view addSubview:o.view];
} 
```

您可以用来显示模态视图的示例代码：

```
[[OverlayViewController sharedOverlayViewController] presentModalViewController:myModalViewController animated:YES]; 
```

我实际上并没有`-presentModalViewController:animated:`与我的 OverlayViewController 一起使用，但我希望这会工作得很好。

另请参阅：[您的 Objective-C 单例是什么样的？](https://stackoverflow.com/questions/145154/what-does-your-objective-c-singleton-look-like)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-10-20T19:40:15.843

我有同样的问题，为了解决方案是使用 addSubview 添加模态视图：并使用 UIView 的 animateWithDuration:delay:options:animations:completion 动画视图层次结构中的变化：

我向包含其他功能的 UIViewController (FRRViewController) 的子类添加了一个属性和 2 个方法。我将很快在 gitHub 上发布所有内容，但在那之前你可以看到下面的相关代码。有关更多信息，您可以查看我的博客：[如何显示透明模式视图控制器](http://www.cocoaosx.com/2011/10/20/how-to-display-transparent-modal-viewcontrollers/)。

```
#pragma mark - Transparent Modal View
-(void) presentTransparentModalViewController: (UIViewController *) aViewController 
                                     animated: (BOOL) isAnimated 
                                    withAlpha: (CGFloat) anAlpha{

    self.transparentModalViewController = aViewController;
    UIView *view = aViewController.view;

    view.opaque = NO;
    view.alpha = anAlpha;
    [view.subviews enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) {
        UIView *each = obj;
        each.opaque = NO;
        each.alpha = anAlpha;
    }];

    if (isAnimated) {
        //Animated
        CGRect mainrect = [[UIScreen mainScreen] bounds];
        CGRect newRect = CGRectMake(0, mainrect.size.height, mainrect.size.width, mainrect.size.height);

        [self.view addSubview:view];
        view.frame = newRect;

        [UIView animateWithDuration:0.8
                         animations:^{
                             view.frame = mainrect;
                         } completion:^(BOOL finished) {
                             //nop
                         }];

    }else{
        view.frame = [[UIScreen mainScreen] bounds];
        [self.view addSubview:view];
    }

}

-(void) dismissTransparentModalViewControllerAnimated:(BOOL) animated{

    if (animated) {
        CGRect mainrect = [[UIScreen mainScreen] bounds];
        CGRect newRect = CGRectMake(0, mainrect.size.height, mainrect.size.width, mainrect.size.height);
        [UIView animateWithDuration:0.8
                         animations:^{
                             self.transparentModalViewController.view.frame = newRect;
                         } completion:^(BOOL finished) {
                             [self.transparentModalViewController.view removeFromSuperview];
                             self.transparentModalViewController = nil;
                         }];
    }

} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-04-10T07:57:40.707

这是我为解决问题所做的 - 谷歌详细信息，但这种方法对我来说效果很好：

*   截取底层视图的屏幕截图。[https://devforums.apple.com/message/266836](https://devforums.apple.com/message/266836) - 这会导致一个现成的方法返回当前屏幕的 UIView。
*   将屏幕截图交给模态视图（我使用了一个属性）
*   呈现模态视图
*   在模态视图控制器的 viewDidAppear 中，将图像设置为索引 0 处的 UIImageView。通过状态栏的高度调整图像的垂直位置。
*   在模态视图控制器的 viewWillDisappear 中，再次移除图像

效果是：

*   视图像任何模态视图一样动画 - 模态视图的半透明部分滑过现有视图
*   一旦动画停止，背景就会设置为屏幕截图 - 这使得它看起来好像旧视图仍在下方，即使它不是。
*   一旦模态视图的消失动画开始，图像就会被删除。同时，操作系统会显示旧的导航视图，因此模态视图会透明地滑出并移开视线，就像您所期望的那样。

我尝试在自己的叠加视图中制作动画，但效果不佳。我遇到了崩溃，没有任何迹象表明发生了什么崩溃。我没有追究这一点，而是做了 bg view & Works 真的很好。

模态视图中的代码-我认为您可以弄清楚其余部分，即设置属性modalView.bgImage ...

```
- (void)viewDidAppear:(BOOL)animated {
    // background
    // Get status bar frame dimensions
    CGRect statusBarRect = [[UIApplication sharedApplication] statusBarFrame];
    UIImageView *imageView = [[UIImageView alloc] initWithImage:self.bgImage];
    imageView.tag = 5;
    imageView.center = CGPointMake(imageView.center.x, imageView.center.y - statusBarRect.size.height);
    [self.view insertSubview:imageView atIndex:0];
}

- (void)viewWillDisappear:(BOOL)animated {
    [[self.view viewWithTag:5] removeFromSuperview];
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-07-02T07:08:55.803

```
self.modalPresentationStyle = UIModalPresentationCurrentContext;
[self presentModalViewController:newview animated:YES]; 
```

并确保将模态视图背景设置为透明，

self.view.background = .... alpha:0.x;

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-10-25T07:47:18.673

如果将模态视图控制器的 modalPresentationStyle 设置为：

viewController.modalPresentationStyle = 17;

背景中的视图不会被删除。（TWTweetComposeViewController 使用它）。

我没有尝试使用此代码通过 App Store 审查

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-17T14:14:40.353

这篇关于[显示半透明“正在加载...”视图的](http://cocoawithlove.com/2009/04/showing-message-over-iphone-keyboard.html)帖子可能会为如何继续提供一些指导。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-10-19T02:57:52.193

是的，你必须手动添加视图，如果你想从底部滑入或者你必须自己做动画。

我编写了一个类来执行此操作，并使用该类作为示例的半模态日期选择器。

[您可以在这篇博](http://reednj.tumblr.com/post/1346445326)文中找到文档，代码[在 github 上](http://github.com/reednj/TDSemiModal)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-23T01:20:38.480

我从[https://gist.github.com/1279713得到这个想法](https://gist.github.com/1279713)

**准备：** 在模态视图 xib（或使用情节提要的场景）中，我设置了 0.3 alpha 的全屏背景 UIImageView（将其与 .h 文件挂钩并给它一个属性“backgroundImageView”）。我将视图（UIView）背景颜色设置为纯黑色。

**想法：** 然后在模态视图控制器的“viewDidLoad”中，我从原始状态捕获屏幕截图并将该图像设置为背景 UIImageView。将初始 Y 点设置为 -480，并使用 EaseInOut 动画选项使用 0.4 秒的持续时间让它滑动到 Y 点 0。当我们关闭视图控制器时，只需做相反的事情。

**模态视图控制器类的代码**

**.h 文件：**

```
@property (weak, nonatomic) IBOutlet UIImageView *backgroundImageView;
- (void) backgroundInitialize;
- (void) backgroundAnimateIn;
- (void) backgroundAnimateOut; 
```

**.m 文件：**

```
- (void) backgroundInitialize{
    UIGraphicsBeginImageContextWithOptions(((UIViewController *)delegate).view.window.frame.size, YES, 0.0);
    [((UIViewController *)delegate).view.window.layer renderInContext:UIGraphicsGetCurrentContext()];
    UIImage * screenshot = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    backgroundImageView.image=screenshot;
}
- (void) backgroundAnimateIn{
    CGRect backgroundImageViewRect = backgroundImageView.frame;
    CGRect backgroundImageViewRectTemp = backgroundImageViewRect;
    backgroundImageViewRectTemp.origin.y=-480;
    backgroundImageView.frame=backgroundImageViewRectTemp;

    [UIView animateWithDuration:0.4 delay:0.0 options:UIViewAnimationCurveEaseInOut animations:^{
        backgroundImageView.frame=backgroundImageViewRect;
    } completion:^(BOOL finished) {

    }];
}
- (void) backgroundAnimateOut{
    CGRect backgroundImageViewRect = backgroundImageView.frame;
    backgroundImageViewRect.origin.y-=480;

    [UIView animateWithDuration:0.4 delay:0.0 options:UIViewAnimationCurveEaseInOut animations:^{
        backgroundImageView.frame=backgroundImageViewRect;
    } completion:^(BOOL finished) {

    }];
} 
```

在 viewDidLoad 中，只需调用：

```
[self backgroundInitialize];
[self backgroundAnimateIn]; 
```

在我们关闭模态视图控制器的任何地方，我们调用：

```
[self backgroundAnimateOut]; 
```

请注意，这将始终为背景图像设置动画。所以如果这个模态视图控制器过渡风格（或segue过渡风格）没有设置为“Cover Vertical”，你可能不需要调用动画方法。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-03-18T20:40:25.903

过去一周我一直在研究同样的问题。我尝试了在 Google 和 StackOverflow 上找到的所有各种答案和示例。他们都没有那么好。

作为 iOS 编程的新手，我不知道有什么叫做[`UIActionSheet`](http://eureka.ykyuen.info/2010/04/14/iphone-uiactionsheet-example/). 因此，如果您尝试完成此操作以显示按钮的模态叠加层（例如模态询问某人他们想如何共享某些内容），只需使用`UIActionSheet`.

这是[一个网页，展示了如何执行此操作的示例](http://eureka.ykyuen.info/2010/04/14/iphone-uiactionsheet-example/)。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-04-26T16:38:57.170

对于导航或标签栏界面，我终于完成了这一点，方法是结合一个覆盖视图控制器（参见：pix0r's answer），该控制器在隐藏或显示基于这个非常好的[博客文章](http://ramin.firoozye.com/2009/09/29/semi-modal-transparent-dialogs-on-the-iphone/)的视图控制器之前隐藏/取消隐藏。

关于视图控制器，提示是使其背景视图为`clearColor`，然后半透明覆盖视图可见，并且在视图控制器中作为子视图添加的任何视图都在前面，最重要的是不透明。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-08-10T17:59:43.120

我创建了开放源库[MZFormSheetController](https://github.com/m1entus/MZFormSheetController)以在其他 UIWindow 上呈现模态表单。您可以使用它来呈现透明度模态视图控制器，甚至可以调整呈现的视图控制器的大小。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-09-16T19:39:51.890

对于 iOS 8+，您可以为**呈现**`UIModalPresentationOverCurrentContext`的视图控制器使用演示样式来轻松实现所需的行为。

 **```
UIViewController *viewController = [[UIViewController alloc] init];
viewController.view.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:0.9f];
viewController.modalPresentationStyle = UIModalPresentationOverCurrentContext;
[self presentViewController:viewController animated:YES completion:nil]; 
```

如果您还需要支持 iOS 7，请查看[此线程](https://stackoverflow.com/questions/26032472/presenting-semi-transparent-viewcontroller-that-works-both-in-ios7-and-ios8)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-01-29T16:29:44.320

You can achieve transparent/semi-transparent modal view effect by overlaying a transparent/semi-transparent button on both the view and the navigation bar.

You can access the navigation bar through the navigationBar property of the UINavigationController.

I found that UIButton unlike UILabel will trap mouse events - hence giving the correct modal behavior.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-04-26T11:47:32.030

这对我有用：

```
UIViewController *modalViewController = [[UIViewController alloc] init];
modalViewController.view.backgroundColor = [UIColor whiteColor] colorWithAlpha:0.5];
[self showDetailViewController:modalViewController sender:nil]; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-10-29T10:39:11.427

我刚刚找到了解决方法。只需创建一个 1X1 的 UIViewController 并将其添加到您的父视图控制器。并在该 UIViewController 中显示透明模式视图控制器。

在 viewDidLoad 上；

> self.dummyViewController = [[UIViewController alloc] init]; [self.dummyViewController.view setFrame:CGRectMake(0, 0, 1, 1)]; [self.view addSubView:self.dummyViewController.view];

当你需要打开一个transparentViewController时；

> [self.dummyViewController presentModalViewController:yourTransparentModalViewController Animation:true];

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-02-28T13:05:37.370

如果您需要类似附件的屏幕，下面的代码可能会对您有所帮助。![在此处输入图像描述](https://i.stack.imgur.com/06LkJ.png)

**编码：**

```
MyViewController * myViewController = [[MyViewController alloc] initWithNibName:nibName bundle:nil];
UINavigationController * myNavigationController = [[UINavigationController alloc] initWithRootViewController: myViewController];
myNavigationController.modalPresentationStyle = UIModalPresentationPageSheet;
[self presentModalViewController: myNavigationController animated:YES]; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-10-18T14:02:53.343

如果说你想要一个屏幕覆盖，使用 parentViewController.view，它会放在导航栏 ++

`MyCustomViewController* myOverlayView = [[MyCustomViewController alloc] init]; [self.parentViewController.view addSubview:myOverlayView];`

# python - django模板包括

> ID：849463
> 
> 赞同：3
> 
> 时间：2009-05-11T18:41:24.340
> 
> 标签：python, django, django-templates

我目前遇到了 django 模板的问题。我基本上有3个模板文件：

*   根据
*   故事列表
*   故事细节

Story_list 和 _detail 扩展了 Base，效果很好。但是，list 和 detail 共享一些代码，这些代码扩展了我的侧边栏的基本模板。我基本上在两个模板中重复了一大段代码，而我的程序员说那是错误的。必须有更好的方法，我敢肯定。我试过包含，但是我在包含的文件中有：

```
{% block item %}
    content stuff
{% endblock %} 
```

大约3个街区。问题是这些都没有被拾取/渲染。如果我将文件包含在扩展 base 的块部分中，那么它会正确转储所有内容，但如果我不将它包含在块中，我什么也得不到。SSI是要走的路吗？我玩弄了它，但这似乎也不能正常工作。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-11T19:11:25.103

一般来说，使用`include`s 不是 Django 模板的答案。让我从几个方面回答你的问题。

首先，让我谈谈侧边栏。

*   **几乎所有常见页面都将使用该侧边栏吗？**把它放进去`Base`。不要覆盖那些侧边栏块（即根本不要在`Story_*`模板中编写它们）。

*   **`Story_*`这个侧边栏是模板独有的吗？**制作另一个模板，比如说，`Story_base`然后扩展它。这类似于在 Java 中创建抽象超类。（答案在我的脑海中，但措辞被无情地从 jpwatts 中[扯下来。）](https://stackoverflow.com/questions/849463/django-template-includes/849530#849530 "jpwatts 的回答")

接下来，让我解决模板继承问题。假设您有一个名为`Story_list`extends的模板`Base`。此时，刚放完之后`{% extends "Base" %}`，`Story_list` *就是* `Base`。您输入的任何其他内容都将`Story_list`被忽略，因为模板已经完成。您现在唯一能做的就是*覆盖*已在`Base`.

最后，让我谈谈`include`s。尽量避免它们。其他模板引擎，例如 PHP，似乎鼓励使用`include`s。但是，从长远来看，这可能会导致难以管理的模板。查看包含的片段并立即确定其在模板层次结构中的位置稍微困难一些。它们也更难重构到模板层次结构中，特别是如果您将它们包含在多个级别（一次在 中`Base`，两次在 中`Story_base`，一次在某些中`Story_*`，等等）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T18:58:14.593

如果故事模板之间存在站点范围内不需要的通用代码，我会创建一个`story_base`（扩展原始的`base`）并让我的故事模板扩展它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-20T13:33:27.087

```
{% include xxx.html %} 
```

这个标签有效。

另一种方法是使用过滤器。过滤器调用一个函数进行渲染，模板可以在渲染时使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T19:07:32.457

你有一个[{% include %}](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#include)标签。

# c# - Excel、Word、PDF 和 PowerPoint 打印对话框

> ID：849466
> 
> 赞同：0
> 
> 时间：2009-05-11T18:42:09.287
> 
> 标签：c#, printing

任何人都知道如何在 C# 应用程序中获取所有这些信息，从而将用户引导至打印对话屏幕？我的意思是：
在 gui 中，用户选择一个文档，右键单击该文档，选择打印。不是立即打印出文档，而是出现打印对话框。

有人知道所有这些的语法吗？我尝试使用 MS Office 应用程序的所有互操作并尝试 printdialogue 方法......但没有这样的运气。

谁能给我一些代码？我已经认真地做这几个小时了，但我什么也想不出来。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T19:02:54.463

也许看到这个以前的问答： [send-document-to-printer-with-c#](https://stackoverflow.com/questions/218556/send-document-to-printer-with-c)

或者，对于打印 FlowDocument 的 WPF 应用程序：

```
 private void DoThePrint(System.Windows.Documents.FlowDocument document)
    {
        // Clone the source document's content into a new FlowDocument.
        // This is because the pagination for the printer needs to be 
        // done differently than the pagination for the displayed page. 
        // We print the copy, rather that the original FlowDocument. 
        System.IO.MemoryStream s = new System.IO.MemoryStream();
        TextRange source = new TextRange(document.ContentStart, document.ContentEnd);
        source.Save(s, DataFormats.Xaml);
        FlowDocument copy = new FlowDocument();
        TextRange dest = new TextRange(copy.ContentStart, copy.ContentEnd);
        dest.Load(s, DataFormats.Xaml);

        // Create a XpsDocumentWriter object, implicitly opening a Windows common print dialog, 
        // and allowing the user to select a printer.

        // get information about the dimensions of the seleted printer+media. 
        System.Printing.PrintDocumentImageableArea ia = null;
        System.Windows.Xps.XpsDocumentWriter docWriter = System.Printing.PrintQueue.CreateXpsDocumentWriter(ref ia);

        if (docWriter != null && ia != null)
        {
            DocumentPaginator paginator = ((IDocumentPaginatorSource)copy).DocumentPaginator;

            // Change the PageSize and PagePadding for the document to match the CanvasSize for the printer device.
            paginator.PageSize = new Size(ia.MediaSizeWidth, ia.MediaSizeHeight);
            Thickness t = new Thickness(72);  // copy.PagePadding;
            copy.PagePadding = new Thickness(
                             Math.Max(ia.OriginWidth, t.Left),
                               Math.Max(ia.OriginHeight, t.Top),
                               Math.Max(ia.MediaSizeWidth - (ia.OriginWidth + ia.ExtentWidth), t.Right),
                               Math.Max(ia.MediaSizeHeight - (ia.OriginHeight + ia.ExtentHeight), t.Bottom));

            copy.ColumnWidth = double.PositiveInfinity;
            //copy.PageWidth = 528; // allow the page to be the natural with of the output device

            // Send content to the printer.
            docWriter.Write(paginator);
        }

    } 
```

# c# - 什么是执行集成测试的好方法？

> ID：849467
> 
> 赞同：24
> 
> 时间：2009-05-11T18:42:30.127
> 
> 标签：c#, .net, integration-testing

我们已经编写了自己的集成测试工具，我们可以在其中编写许多“操作”或测试，例如“GenerateOrders”。我们有许多参数可以用来配置测试（例如订单数）。然后我们编写第二个操作来确认测试已经通过/失败（即有（nt）个订单）。

该工具用于

*   集成测试
*   数据生成
*   端到端测试（通过混合和匹配多个测试）

它似乎运行良好，但是需要开发经验来维护和编写新的测试。我们的测试团队想参与进来，他们几乎没有 C# 开发经验。

我们即将开始一个新的 Greenfield 项目，我正在研究编写和维护集成测试的最佳方式。

问题如下：

*   你如何进行集成测试？
*   您使用什么工具（FitNess？、Custom？、NUnit）？

我期待着人们的建议/评论。

提前致谢，

大卫

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-14T08:56:09.470

集成测试可以在用户界面级别（通过自动化功能测试 - *AFT*）或服务/API 界面级别完成。

在这两种情况下都有几个工具：

我参与的项目成功使用[Sahi](http://sahi.co.in/)或[Selenium](http://seleniumhq.org/)进行 Web 应用程序的 AFT，[white](http://www.codeplex.com/white)用于 .NET WPF 或 winforms 应用程序的 AFT，[swtBot](http://www.eclipse.org/swtbot/)用于 Eclipse 富客户端应用程序的 AFT 以及[frankenstein](http://frankenstein.openqa.org/)用于 Java swing 应用程序的 AFT。

Fitnesse 对于服务/api 级别测试或在 UI 下方运行的测试很有用。如果做得好，它的优势是具有业务可读的测试，即非开发人员可以阅读和理解测试。NUnit 之类的工具在此用途上的用处不大。[SOAPUI](http://www.soapui.org)特别适合测试 SOAP Web 服务。

需要考虑的因素：

*   **持续时间**：你能忍受 8 小时的试运行吗？
*   **脆弱**性：AFT 对于不断发展的应用程序可能非常脆弱（例如，小部件的 id 和位置可能会改变）。需要足够的技能和努力才能不对变化的部分进行硬编码。
*   **保真度**：您希望它与现实世界有多接近？例如，您可能不得不模拟与支付网关的交互，除非提供商为您提供了一个测试环境，您可以使用您的测试进行测试。

[这里](http://fragmental.tw/2008/09/29/where-do-acceptance-tests-go-to-die/)捕捉到了一些细微差别。

全面披露：作者与上述大多数（不是全部）免费和开源工具背后的组织有关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-12T23:11:54.977

您可以尝试使用[Concordion](http://www.concordion.org)框架在 HTML 文件中编写用户验收测试。它采用 BDD 风格的方法。还有一个[.Net](http://code.google.com/p/concordion-net/)端口

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T07:55:08.977

它还没有结束 Beta 测试，但[StoryTeller](http://storyteller.tigris.org/)看起来很有希望：

# actionscript-3 - 如何在可编辑的 ComboBox 中设置 TextInput 的“maxChars”？

> ID：849473
> 
> 赞同：0
> 
> 时间：2009-05-11T18:44:20.203
> 
> 标签：actionscript-3, apache-flex, combobox, textinput

我想设置`maxChars`可编辑组合框的 TextInput 的属性。我目前正在使用更改事件将文本修剪为一定数量的字符：

```
private function nameOptionSelector_changeHandler(event:ListEvent):void
{
    nameOptionSelector.text = nameOptionSelector.text.substr(0, MAX_LENGTH);
} 
```

这感觉有点矫枉过正。必须有更好的方法来做到这一点......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-27T16:36:51.773

我的替代方法是直接使用受保护的 textInput。这种方法允许在 GUI 构建器或代码中设置“maxChars”属性，就像对普通 TextField 所做的那样。请注意，零是 maxChars 的有效值，表示字符数不限。需要覆盖 .childrenCreated() 以避免在 TextInput 对象存在之前尝试设置 maxChars。

```
package my.controls
{
    import mx.controls.ComboBox;

    public class EditableComboBox extends ComboBox
    {
        public function EditableComboBox()
        {
            super();
        }

        private var _maxChars:int = 0;

        override protected function childrenCreated():void
        {
            super.childrenCreated();

            // Now set the maxChars property on the textInput field.
            textInput.maxChars = _maxChars;
        }

        public function set maxChars(value:int):void 
        {
            _maxChars = value;
            if (textInput != null && value >= 0)
                textInput.maxChars = value;
        }

        public function get maxChars():int 
        {
            return textInput.maxChars;
        }

  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T18:59:21.987

您可以扩展`ComboBox`和覆盖 internal 的默认`maxChars`值`TextInput`。如果您需要动态设置它，您可以添加一个公共方法来设置扩展类的属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:50:40.827

使用斯蒂格勒的建议，这是我实现的完整解决方案：

```
package
{
    import mx.controls.ComboBox;

    public class ComboBoxWithMaxChars extends ComboBox
    {
        public function ComboBoxWithMaxChars()
        {
            super();
        }

        private var _maxCharsForTextInput:int;

        public function set maxCharsForTextInput(value:int):void
        {
            _maxCharsForTextInput = value;

            if (super.textInput != null && _maxCharsForTextInput > 0)
                super.textInput.maxChars = _maxCharsForTextInput;
        }

        public function get maxCharsForTextInput():int
        {
            return _maxCharsForTextInput;
        }

        override public function itemToLabel(item:Object):String
        {
            var label:String = super.itemToLabel(item);

            if (_maxCharsForTextInput > 0)
                label = label.substr(0, _maxCharsForTextInput);

            return label;
        }
    }
} 
```

# c - 可以包含哪些文件？

> ID：849476
> 
> 赞同：2
> 
> 时间：2009-05-11T18:45:40.420
> 
> 标签：c

我希望能够获得 C 源文件中包含的所有可能文件的列表。

我知道其他 # 指令存在复杂性（例如，#ifdef 可能会阻止包含或导致额外的包含）。我正在寻找的只是可能已包含的文件列表。

有没有工具可以做到这一点？

我正在编译的文件只会转到 .o，不包括标准 C 库。我知道这听起来很奇怪，但我们有自己的理由。

我希望能够做到这一点的原因是我想要一个文件列表，这些文件可能对 .o 有所贡献，因此我可以检查它们是否已更改。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T18:55:04.973

引用手册页`gcc`：

```
-M  Instead of outputting the result of preprocessing, output a rule
    suitable for make describing the dependencies of the main source
    file.  The preprocessor outputs one make rule containing the object
    file name for that source file, a colon, and the names of all the
    included files, including those coming from -include or -imacros
    command line options. 
```

这基本上可以满足您的需求。还有[其他几个相关选项](http://gcc.gnu.org/onlinedocs/gcc-4.4.0/gcc/Preprocessor-Options.html#Preprocessor-Options)（均以 开头`-M`）为您提供此输出的不同变体。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T18:49:54.827

我的语法生疏了，但是...

```
grep -ir "#include " *.c 
```

可能工作...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T18:52:45.290

如果您使用 gcc，您可以检查预处理器转储：

```
[~]> gcc -E /usr/include/cups/dir.h|grep "#"
# 1 "/usr/include/cups/dir.h"
# 1 "<built-in>"
# 1 "<command line>"
# 1 "/usr/include/cups/dir.h"
# 26 "/usr/include/cups/dir.h"
# 1 "/usr/include/sys/stat.h" 1 3 4
# 73 "/usr/include/sys/stat.h" 3 4
# 1 "/usr/include/sys/_types.h" 1 3 4
# 32 "/usr/include/sys/_types.h" 3 4
# 1 "/usr/include/sys/cdefs.h" 1 3 4
# 33 "/usr/include/sys/_types.h" 2 3 4
# 1 "/usr/include/machine/_types.h" 1 3 4
# 34 "/usr/include/machine/_types.h" 3 4
# 1 "/usr/include/i386/_types.h" 1 3 4
# 37 "/usr/include/i386/_types.h" 3 4
# 70 "/usr/include/i386/_types.h" 3 4
# 35 "/usr/include/machine/_types.h" 2 3 4
# 34 "/usr/include/sys/_types.h" 2 3 4
# 58 "/usr/include/sys/_types.h" 3 4
# 94 "/usr/include/sys/_types.h" 3 4
# 74 "/usr/include/sys/stat.h" 2 3 4
# 1 "/usr/include/sys/_structs.h" 1 3 4
# 88 "/usr/include/sys/_structs.h" 3 4
# 79 "/usr/include/sys/stat.h" 2 3 4
# 152 "/usr/include/sys/stat.h" 3 4
# 228 "/usr/include/sys/stat.h" 3 4
# 248 "/usr/include/sys/stat.h" 3 4
# 422 "/usr/include/sys/stat.h" 3 4
# 27 "/usr/include/cups/dir.h" 2
# 42 "/usr/include/cups/dir.h" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T19:24:49.793

唉，仅仅获取#include 的来源并不能保证足够，因为有人可能已经承诺......

```
#define tricksy(foo,bar) <foo##bar>
#define precious tricksy(ios, tream)
#include precious
int main(int, char **)
{
        std::cout << "Hobbits!" << std::endl;
        return 0;
} 
```

...尽管您可以通过检查得知由于缺少 <> 或“” ， *#include 珍贵的东西正在发生一些非标准的事情。*

一个非反常的例子是根据命令行定义粘贴不同的库根目录。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T18:48:12.677

您只能执行预处理器步骤。大多数编译器都允许这样做。

当然，这需要一些繁忙的工作来读取生成的文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T18:49:05.640

所有可能的文件？没有办法做到这一点。

# c++ - 你如何根据另一个被击中的断点添加条件中断？视觉 C++

> ID：849483
> 
> 赞同：4
> 
> 时间：2009-05-11T18:47:24.613
> 
> 标签：c++, debugging, visual-c++, visual-studio-2005, breakpoints

我有一堆经常使用的通用代码，为了处理特定情况下的错误，我想深入研究一下。

因此，只有在命中其他断点时，我才想在一组断点上中断。有没有办法在 Visual 2005 中做到这一点？我正在使用 C++ 代码。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T19:38:44.310

请记住，您可以禁用断点 - 它可能更容易/更有效/更清洁（然后将调试标志添加到您的代码并重新编译例如）禁用第二个断点，等到第一个断点中断然后启用第二个断点您的断点窗口 - 每次调试时只需单击两次鼠标... :)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T18:51:56.507

如果触发逻辑足够复杂，有时我发现只添加一个[DebugBreak](http://msdn.microsoft.com/en-us/library/ms679297(VS.85).aspx) ();会更容易。调用源。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T18:51:02.390

让您的第一个断点将某个变量的值更改为魔术值（您可以使用条件断点，使用更改变量然后返回 true 的表达式）。然后，当变量处于那个神奇值时，让第二个断点中断。例如，

```
int debug_flag = 0; 
```

第一个断点条件：

```
debug_flag = 0xdeadbeef, true 
```

第二个断点条件：

```
debug_flag == 0xdeadbeef 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-03-03T11:55:05.533

十年后...

执行 OP 所需的一种简单方法是使用即时窗口来定义全局变量，并按照@chris-jester-young 的建议在断点条件下使用它。

反正对我有用。

# c++ - 为 RegSetValueEx() 将 std::string 转换为 const BYTE*

> ID：849491
> 
> 赞同：4
> 
> 时间：2009-05-11T18:49:16.217
> 
> 标签：c++, windows, winapi, stl, registry

我有一个获取 std::string 的函数。该函数调用

[RegSetValueEx](http://www.google.be/search?q=RegSetValueEx)

第 5 个参数是注册表值，需要一个 const BYTE* 类型的变量。所以我必须将 std::string 转换为 const BYTE* 并将结果数组的长度作为第 6 个参数。

我找到了一种方法来做到这一点，但感觉很难看，我真的不明白发生了什么。这是该功能的精简版：

```
void function(const std::string& newValue)
{
    HKEY keyHandle;
    if(RegOpenKeyEx(HKEY_CLASSES_ROOT, TEXT("some key"),0,KEY_ALL_ACCESS,&keyHandle) == ERROR_SUCCESS)
    {
        std::wstring wNewValue;
        wNewValue.assign(newValue.begin(),newValue.end());

        if (RegSetValueEx(keyHandle, TEXT("some value"), NULL, REG_SZ, (const BYTE*)(LPCTSTR)(wNewValue.c_str()), wNewValue.size()*2)==ERROR_SUCCESS)
        {
            //do something
        }
        RegCloseKey(keyHandle);
    }
} 
```

如您所见，我首先制作一个宽字符串（定义了UNICODE），然后使用双重转换，并且对于长度我必须做* 2，否则它只会设置输入字符串的一半。

这种形式的演员表是正常/最好的方法吗？

为什么是* 2，有什么更好的方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T19:07:34.923

```
void function(const std::string& newValue)
{
    HKEY keyHandle;
    if(RegOpenKeyEx(HKEY_CLASSES_ROOT, TEXT("some key"),0,KEY_ALL_ACCESS,&keyHandle) == ERROR_SUCCESS)
    {

        if (RegSetValueExA(keyHandle, "some value", NULL, REG_SZ, (const BYTE*)newValue.c_str(), newValue.size() + 1)==ERROR_SUCCESS)
        {
                //do something
        }
        RegCloseKey(keyHandle);
    }
} 
```

我删除了将字符串转换为 wstring 的部分，而是显式使用 ANSI 版本的 RegSetValueEx。

引用 MSDN 中的 RegSetValueEx 备注：

> 如果 dwType 是 REG_SZ、REG_MULTI_SZ 或 REG_EXPAND_SZ 类型并且使用此函数的 ANSI 版本（通过显式调用 RegSetValueExA 或在包含 Windows.h 文件之前不定义 UNICODE），则 lpData 参数指向的数据必须是一个 ANSI 字符串。该字符串在存储到注册表之前会转换为 Unicode。

另请注意，cbData 参数也应包括空终止的大小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T18:56:51.960

* 2 是因为`RegSetValueEx`想知道要写入的字节数，而 wstring 中的每个 char (wchar_t) 都是两个字节宽。所以得到的字节数组的大小是原来的两倍！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-23T09:23:49.743

您还可以将 unicode 字符串复制到字节数组中：

```
LPWSTR pData = L"SampleGrabber";
int dwSize = wcslen(pData)*sizeof(TCHAR);
BYTE slump[256];
memset((void*) slump, 0, 256*sizeof(BYTE));
memcpy((void*) slump, (const void *) pData, dwSize*sizeof(BYTE));

globit = RegSetValueEx(hKey, NULL, 0, REG_SZ, (const BYTE*) slump, dwSize); 
```

如果您不幸为 WINCE 5.0 设备编写代码并且它缺少 regedit API 的一部分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-20T02:08:29.680

不应该`wNewValue.size()*2+2`吗？空字符的+2？MSDN 说：lpData 参数指向的信息的大小，以字节为单位。如果数据的类型为 REG_SZ、REG_EXPAND_SZ 或 REG_MULTI_SZ，则 cbData 必须包括终止空字符的大小。

# cruisecontrol.net - 巡航控制失败

> ID：849496
> 
> 赞同：1
> 
> 时间：2009-05-11T18:50:26.307
> 
> 标签：cruisecontrol.net

我有一个在 CruiseControl 中运行并输出“通过”或“失败”的批处理文件。如果我的批处理文件的输出为“失败”，如何管理 CruiseContorl 以使构建失败？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T18:51:43.107

如果批处理文件的返回值不为零，则构建将报告为失败。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T18:57:59.010

在您的 ant 脚本中使用*failonerror*标志：

```
<exec executable="xxx" failonerror="true"> 
```

可执行文件（脚本）需要通过设置非零返回码（调用退出）来发出失败信号

# c# - 如何获取vs2008的intellisense成员列表以显示完整签名？

> ID：849501
> 
> 赞同：4
> 
> 时间：2009-05-11T18:51:13.187
> 
> 标签：c#, visual-studio-2008, settings, intellisense

前几天我看到一篇博文，其中有一个智能感知成员列表的屏幕截图，如下所示：

```
DateTime. -> [Compare(DateTime, DateTime) int]
             [DaysInMonth(int, int)       int]
             ... 
```

而不是我的，看起来像：

```
DateTime. -> [Compare    ]
             [DaysInMonth]
             ... 
```

如何设置我的 vs2008 IDE 以使我的成员列表看起来像第一个示例？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T18:54:43.010

难道他们正在使用[ReSharper](http://jetbrains.com/resharper)吗？ReSharper 的 Intellisense 绝对比 Visual Studio 的更好——除此之外，当它显示过载时，它一次显示多个——我永远无法忍受 Visual Studio 这样做的方式......

我刚刚检查过，我不相信 ReSharper*默认会这样做，*但是 ReSharper / Options / Environment / Intellisense / Completion Appearance 下有一个选项：“显示成员签名”。打开它会根据需要提供参数类型。

我*认为*vanilla Visual Studio 没有等效的选项。

# ado.net - ADO .NET 实体数据模型：创建函数

> ID：849523
> 
> 赞同：0
> 
> 时间：2009-05-11T18:56:10.713
> 
> 标签：ado.net

我已经通过网络搜索以解决这个问题，但没有运气。

我有一个接受 10 个字段的存储过程，其中 3 个是 OUTPUT 类型，因此我可以返回值。我使用函数导入来创建函数，并将返回类型设置为无。但我不知道如何访问该功能。如果我将返回类型放入我创建的实体，它是可访问的，但我得到编译错误，并非所有字段都已映射。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-09T17:42:56.303

我的问题已得到回答[，实体模型中的函数导入具有非实体返回类型](https://stackoverflow.com/questions/578536/function-imports-in-entity-model-with-a-non-entity-return-type) ，即该功能尚未创建。

# php - 在 Kohana PHP 中的哪里放置图像文件夹？

> ID：849525
> 
> 赞同：0
> 
> 时间：2009-05-11T18:56:23.757
> 
> 标签：php, kohana

我有一个包含一些 HTML 的页面。我需要将 src 属性设置为图片的位置。

如何使用 Kohana PHP 实现这一目标？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:00:11.783

这取决于图像的位置。在标准的 Kohana 安装中，这些文件位于您的文档根目录中，并且可以通过 url::file() 调用访问，例如：

```
<?php echo url::file("images/foo.gif") ?> 
```

将指：

```
http://example.com/images/foo.gif 
```

参考：[http ://docs.kohanaphp.com/helpers/url#file](http://docs.kohanaphp.com/helpers/url#file)

# c# - C# 或 Java 中 MruList 的高效建模

> ID：849527
> 
> 赞同：3
> 
> 时间：2009-05-11T18:57:28.247
> 
> 标签：c#, java, data-structures, class-design

您将如何在 C# 或 Java 中实现容量有限的通用 MruList？

我想要一个代表最近使用的缓存或列表（= MruList）的类。它应该是通用的，并且限制在实例化时指定的容量（计数）。我希望界面类似于：

```
public interface IMruList<T>
{
    public T Store(T item);
    public void Clear();
    public void StoreRange(T[] range);
    public List<T> GetList();
    public T GetNext(); // cursor-based retrieval
} 
```

每个 Store() 都应该将项目放在列表的顶部（前面？）。*GetList() 应返回按最近商店*排序的有序列表中的所有项目。如果我调用 Store() 20 次并且我的列表有 10 个项目长，我只想保留最近存储的 10 个项目。GetList 和 StoreRange 旨在支持在应用程序启动和关闭时检索/保存 MruList。

这是为了支持 GUI 应用程序。我想我可能还想知道存储项目的时间戳。也许。没有把握。

在内部，您将如何实施它，为什么？

（不，这不是课程作业）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:02:57.147

关于您的方法的一些评论

*   为什么有商店退货 T？我知道我刚刚添加的内容，除非您明确需要方法链接，否则无需将其返回给我
*   将 GetNext() 重构为一个新类。它代表一组不同的功能（存储与游标遍历），应由单独的接口表示。它还存在可用性问题，因为当在同一堆栈上活动的两个不同方法想要遍历结构时会发生什么？
*   GetList() 应该可能返回`IEnumerable<T>`. 返回`List<T>`要么强制显式复制，要么返回指向底层实现的指针。两者都不是一个很好的选择。

至于支持接口的最佳结构是什么。似乎最好的实现方法是拥有一种数据结构，该结构可以有效地添加到一端并从另一端移除。双向链表很适合这种情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T19:14:33.740

这是一个 Cache 类，它在对象被访问时存储它们。最近的项目冒泡到列表的末尾。缓存操作一个索引器属性，该属性采用对象键。您可以轻松地将内部字典替换为列表并从索引器中引用该列表。

顺便说一句，您也应该将该类重命名为 MRU :)

```
class Cache
    {
        Dictionary<object, object> cache = new Dictionary<object, object>();

        /// <summary>
        /// Keeps up with the most recently read items.
        /// Items at the end of the list were read last. 
        /// Items at the front of the list have been the most idle.
        /// Items at the front are removed if the cache capacity is reached.
        /// </summary>
        List<object> priority = new List<object>();
        public Type Type { get; set; }
        public Cache(Type type)
        {
            this.Type = type;

            //TODO: register this cache with the manager 

        }
        public object this[object key]
        { 
            get 
            {
                lock (this)
                {
                    if (!cache.ContainsKey(key)) return null;
                    //move the item to the end of the list                    
                    priority.Remove(key);
                    priority.Add(key);
                    return cache[key];
                }
            }
            set 
            {
                lock (this)
                {
                    if (Capacity > 0 && cache.Count == Capacity)
                    {
                        cache.Remove(priority[0]);
                        priority.RemoveAt(0);
                    }
                    cache[key] = value;
                    priority.Remove(key);
                    priority.Add(key);

                    if (priority.Count != cache.Count)
                        throw new Exception("Capacity mismatch.");
                }
            }
        }
        public int Count { get { return cache.Count; } }
        public int Capacity { get; set; }

        public void Clear()
        {
            lock (this)
            {
                priority.Clear();
                cache.Clear();
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:06:04.957

如果它的大小超过构造函数中建立的容量，我将有一个内部 ArrayList 并让 Store() 删除最后一个元素。我认为标准术语，奇怪的是，将其称为“LRU”列表，因为最近最少使用的项目会被丢弃。请参阅[维基百科的条目](http://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T19:07:43.690

您可以使用`Collections.Generic.LinkedList<T>`. 当您将一个项目推入完整列表时，删除最后一个并将新的插入到最前面。大多数操作应该在 O(1) 中，这比基于数组的实现要好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T21:34:34.403

每个人都喜欢滚动自己的容器类。

但在 .NET BCL 中有一个名为`SortedList<T>`. 您可以使用它来实现您的 MRU 列表或任何其他优先级队列类型列表。它使用有效的树结构来进行有效的添加。

从[MSDN 上的 SortedList](http://msdn.microsoft.com/en-us/library/system.collections.sortedlist.aspx)：

> SortedList 对象的元素根据创建 SortedList 时指定的特定 IComparer 实现或根据键本身提供的 IComparable 实现按键排序。在任何一种情况下，SortedList 都不允许重复键。
> 
> 索引序列基于排序序列。添加元素时，它会以正确的排序顺序插入到 SortedList 中，并且索引会相应调整。当一个元素被删除时，索引也会相应地调整。因此，特定键/值对的索引可能会随着从 SortedList 对象中添加或删除元素而改变。
> 
> 由于排序，对 SortedList 对象的操作往往比对 Hashtable 对象的操作慢。然而，SortedList 提供了更大的灵活性，它允许通过关联的键或索引访问值。
> 
> 可以使用整数索引访问此集合中的元素。此集合中的索引是从零开始的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:23:37.653

在 Java 中，我会使用[`LinkedHashMap`](http://java.sun.com/javase/6/docs/api/java/util/LinkedHashMap.html)为这类事情而构建的 .

```
public class MRUList<E> implements Iterable<E> {
    private final LinkedHashMap<E, Void> backing;

    public MRUList() {
        this(10);
    }

    public MRUList(final int maxSize) {
        this.backing = new LinkedHashMap<E,Void>(maxSize, maxSize, true){
           private final int MAX_SIZE = maxSize;
           @Override
           protected boolean removeEldestEntry(Map.Entry<E,Void> eldest){
               return size() > MAX_SIZE;
           }
        };
    }

    public void store(E item) {
        backing.put(item, null);
    }

    public void clear() {
        backing.clear();
    }

    public void storeRange(E[] range) {
        for (E e : range) {
            backing.put(e, null);
        }
    }

    public List<E> getList() {
        return new ArrayList<E>(backing.keySet());
    }

    public Iterator<E> iterator() {
        return backing.keySet().iterator();
    }
} 
```

然而，这确实以完全相反的顺序进行迭代（即 LRU 首先，MRU 最后）。使其成为 MRU-first 基本上需要重新实现`LinkedHashMap`，但在后备列表的前面插入新元素，而不是在末尾。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T21:25:41.547

Java 6 为双端队列添加了一个名为 Deque... 的新 Collection 类型。

特别是可以给予有限容量的一个：[LinkedBlockingDeque](http://java.sun.com/javase/6/docs/api/java/util/concurrent/LinkedBlockingDeque.html)。

```
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.LinkedBlockingDeque;

public class DequeMruList<T> implements IMruList<T> {

    private LinkedBlockingDeque<T> store;

    public DequeMruList(int capacity) {
        store = new LinkedBlockingDeque<T>(capacity);
    }

    @Override
    public void Clear() {
        store.clear();
    }

    @Override
    public List<T> GetList() {
        return new ArrayList<T>(store);
    }

    @Override
    public T GetNext() {
    // Get the item, but don't remove it
        return store.peek();
    }

    @Override
    public T Store(T item) {
        boolean stored = false;
        // Keep looping until the item is added
        while (!stored) {
            // Add if there's room
            if (store.offerFirst(item)) {
                stored = true;
            } else {
                // No room, remove the last item
                store.removeLast();
            }
        }
        return item;
    }

    @Override
    public void StoreRange(T[] range) {
        for (T item : range) {
            Store(item);
        }
    }

} 
```

# c# - 位图中的 TextRenderer.DrawText 与 OnPaintBackground

> ID：849531
> 
> 赞同：8
> 
> 时间：2009-05-11T18:58:59.087
> 
> 标签：c#, textrenderer

如果我使用我的文本中提供`TextRenderer.DrawText()`的`Graphics`对象`OnPaintBackground`看起来很完美。如果我创建自己的`Bitmap`并使用`Graphics`从我`Bitmap`的文本中获得的对象看起来很糟糕。看起来它是使用黑色而不是位图的背景颜色对文本进行抗锯齿处理。如果我使用 ，我可以避免这个问题`Graphics.DrawString()`，但是这种方法有可怕的字距调整问题。我该怎么办？如何`TextRenderer.DrawText()`使用位图的内容正确获得抗锯齿？

**看起来很可怕：**

```
Bitmap bmp = new Bitmap(100, 100, PixelFormat.Format32bppArgb);
using (Graphics g = Graphics.FromImage(bmp))
{
    g.Clear(Color.Red);
    TextFormatFlags tf = TextFormatFlags.Left;
    TextRenderer.DrawText(g, @"C:\Development\Testing\blag", font, clip, Color.White,
                          Color.Transparent, tf);
} 
```

**看起来不错，但我想将其渲染到位图上，而不是渲染到控件的表面上：**

```
protected override void OnPaintBackground(PaintEventArgs e)
{
    e.Graphics.Clear(Color.Red);
    TextFormatFlags tf = TextFormatFlags.Left;
    TextRenderer.DrawText(e.Graphics, @"C:\Development\Testing\blag", font, clip,
                          Color.White, Color.Transparent, tf);
} 
```

有什么不同？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-16T13:31:51.540

答案是不使用`TextRenderer`。TextRenderer 是文本渲染的 GDI（不是 GDI+）实现的包装器，它具有许多功能，但与您发现的内存中 DC 的互操作性不佳。

使用`Graphics.DrawString`& `Graphics.MeasureString`，但记得传递 StringFormat.GenericTypographic 以获得准确的大小和定位。

最初引入 TextRenderer 的原因是 GDI+ 不支持 GDI 的 Uniscribe 引擎支持的所有复杂脚本。然而，随着时间的推移，GDI+ 对复杂脚本的支持得到了扩展，现在已经没有任何充分的理由使用 TextRenderer（它甚至不再是两者中更快的了，事实上它看起来完全相反）。

但实际上，除非您遇到严重的、可衡量的性能问题，否则只需使用`Graphics.DrawString`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-15T20:29:36.723

我认为问题在于，如果背景是透明的，则清晰类型的文本渲染不起作用。一些可能的解决方案。

选项 1\. 用颜色填充位图的背景。

如果你这样做（正如蒂姆罗宾逊在上面的代码示例中使用 g.Clear(Color.Red) 所做的那样），清除类型将做正确的事情。但是您的位图不会完全透明，这可能是不可接受的。如果您使用 Graphics.MeasureText，您可以只填充文本周围的矩形，如果您愿意的话。

选项 2\. 设置 TextRenderingHint = TextRenderingHintAntiAliasGridFit

这似乎关闭了清除类型。文本将以低于背景上清晰类型的质量呈现，但比无背景创建的混乱清晰类型要好得多。

选项3。用白色填充文本矩形，绘制文本，然后找到所有非文本像素并将它们恢复为透明。

```
using (Bitmap bmp = new Bitmap(someWidth, someHeight))
{
    using (Graphics g = Graphics.FromImage(bmp))
    {
        // figure out where our text will go
        Point textPoint = new Point(someX, someY);
        Size textSize = g.MeasureString(someText, someFont).ToSize();
        Rectangle textRect = new Rectangle(textPoint, textSize);

        // fill that rect with white
        g.FillRectangle(Brushes.White, textRect);

        // draw the text
        g.DrawString(someText, someFont, Brushes.Black, textPoint);

        // set any pure white pixels back to transparent
        for (int x = textRect.Left; x <= textRect.Left + textRect.Width; x++)
        {
            for (int y = textRect.Top; y <= textRect.Top + textRect.Height; y++)
            {
                Color c = bmp.GetPixel(x, y);
                if (c.A == 255 && c.R == 255 && c.G == 255 && c.B == 255)
                {
                    bmp.SetPixel(x, y, Color.Transparent);
                }
            }
        }
    }
} 
```

我知道，这是一个可怕的黑客，但它似乎工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-28T12:04:43.380

**答案是使用[`BuffersGraphicsContext`](http://msdn.microsoft.com/en-us/library/tt8yksdk.aspx).** 当您`ControlStyles.OptimizedDoubleBuffer`在控件上设置样式时，这与 .NET 在内部使用的系统相同。

有关.NET 中双缓冲的更多信息，请参阅[http://msdn.microsoft.com/en-us/library/b367a457.aspx 。](http://msdn.microsoft.com/en-us/library/b367a457.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-08T20:55:54.977

另一种可能的解决方案：将整个内容绘制到屏幕上，顶部带有文本的位图，然后编写一些代码来“截屏”屏幕的那部分。在所有情况下都不实用，但你是对的，DrawString 会创建奇怪的文本，并且 DrawText 到位图上看起来很糟糕。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-11T19:05:07.407

如果您的位图与显示区域的大小不同，则可能只是大小调整问题，其中 .NET 将位图缩放到显示大小，您会得到看起来很有趣的文本。

您可以使用与您的显示区域大小相同的位图进行测试吗？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-11T21:39:37.687

你能发布遇到这个问题的最小程序吗？我不能像这样复制它——抗锯齿看起来很好：

```
 using System.Drawing;
using System.Drawing.Imaging;
using System.Windows.Forms;

public class Program
{
    public static void Main()
    {
        Bitmap bmp = new Bitmap(100, 100, PixelFormat.Format32bppArgb);
        using (Font font = new Font("Arial", 10, GraphicsUnit.Point))
        using (Graphics g = Graphics.FromImage(bmp))
        {
            Rectangle clip = Rectangle.FromLTRB(0, 0, 100, 100);
            g.Clear(Color.Red);
            TextFormatFlags tf = TextFormatFlags.Left;
            TextRenderer.DrawText(g, @"C:\Development\Testing\blag", font, clip, Color.White, Color.Transparent, tf);
        }

        Form form = new Form();
        form.BackgroundImage = bmp;
        Application.Run(form);
    }
} 
```

# asp.net - 如何获得“发布网站”命令来为我的 Visual Studio 2005 网站项目发出 PDB 文件？

> ID：849533
> 
> 赞同：5
> 
> 时间：2009-05-11T18:59:54.547
> 
> 标签：asp.net, visual-studio

我有一个 VS 2005 网站项目（不是 Web 应用程序项目模型，“网站”项目模型），我希望能够通过“发布网站”命令将页面程序集的 PDB 文件包含在 bin 文件夹中在 Visual Studio 中帮助调试问题。

无论我对“调试/发布”模式设置进行什么尝试，一旦我发布了网站，我似乎都无法让网站程序集的 PDB 文件显示在“bin”文件夹中。我确实为任何外部引用程序集获取它们，但不是为实际的网站代码隐藏程序集获取它们，这正是我所需要的。

使用网站项目模型发布时，如何让 Visual Studio 包含这些文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T19:22:16.367

发布命令总是编译您的项目以进行发布，我还没有找到一种方法来导致在预编译期间生成 pdb 文件。

我尝试过一种解决方法。如果在预编译时选中“允许此预编译站点可更新”框，然后在适当位置更新网站，则会导致动态编译。如果您的 web.config 设置具有以下内容，则动态编译应生成调试代码和 pdb 文件：

```
 <compilation defaultLanguage="your language" debug="true" /> 
```

这是一篇关于不同发布选项的[好博文。](http://odetocode.com/blogs/scott/archive/2005/11/15/2464.aspx)

# php - 将 mysqli 结果对象转换为数组是一种好习惯吗？

> ID：849539
> 
> 赞同：0
> 
> 时间：2009-05-11T19:02:00.750
> 
> 标签：php, mysqli

我想知道，如果我有一些代码，例如：

```
$result = $db->query($sql); // dont worry, its escaped
$myData = (array)$result->fetch_assoc(); 
```

在哪里

```
$result->fetch_assoc(); 
```

返回一个 mysqli 结果对象。

像这样立即施放它是一种好习惯吗？我想这是一个昂贵的电话 - 这是真的吗？

它确实使我查询后立即使用起来很方便，但我想确保我没有做不好的事情。

感谢您的任何意见，

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T19:08:02.877

根据[mysqli 文档](http://www.php.net/manual/en/mysqli-result.fetch-assoc.php)，它无论如何都会返回一个数组......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:24:15.830

如果没有更多结果 - 它将返回 NULL。在这种情况下（数组） null 可能有一些意义。

真的最好在单独的地方检查特殊情况而不是类型转换

# c# - C# 通用列表联合问题

> ID：849545
> 
> 赞同：8
> 
> 时间：2009-05-11T19:03:25.290
> 
> 标签：c#, linq, generics

我正在尝试使用“Union”合并 2 个列表，以便消除重复项。以下是示例代码：

```
public class SomeDetail
{
    public string SomeValue1 { get; set; }
    public string SomeValue2  { get; set; }
    public string SomeDate { get; set; }
}

public class SomeDetailComparer : IEqualityComparer<SomeDetail>
{
    bool IEqualityComparer<SomeDetail>.Equals(SomeDetail x, SomeDetail y)
    {
        // Check whether the compared objects reference the same data.        
        if (Object.ReferenceEquals(x, y))
            return true;
        // Check whether any of the compared objects is null.        
        if (Object.ReferenceEquals(x, null) || Object.ReferenceEquals(y, null))
            return false;
        return x.SomeValue1 == y.SomeValue1 && x.SomeValue2 == y.SomeValue2;
    }
    int IEqualityComparer<SomeDetail>.GetHashCode(SomeDetail obj)
    {
        return obj.SomeValue1.GetHashCode();
    }
}

List<SomeDetail> tempList1 = new List<SomeDetail>();
List<SomeDetail> tempList2 = new List<SomeDetail>();

List<SomeDetail> detailList = tempList1.Union(tempList2, SomeDetailComparer).ToList(); 
```

现在的问题是我可以使用 Union 并且仍然获得具有最新日期的记录（使用 SomeDate 属性）。记录本身可以在 tempList1 或 tempList2 中。

提前致谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T19:13:09.127

真正适合此目的的操作是[完全外连接](http://en.wikipedia.org/wiki/Outer_join#Full_outer_join)。该类`Enumerable`有一个内部连接的实现，您可以使用它来查找重复项并选择您喜欢的任何一个。

```
var duplicates = Enumerable.Join(tempList1, tempList2,  keySelector, keySelector, 
    (item1, item2) => (item1.SomeDate > item2.SomeDate) ? item1 : item2)
    .ToList(); 
```

`keySelector`只是一个从类型对象中提取键的函数（可能是 lambda 表达式）`SomeDetail`。现在，要实现完整的外部联接，请尝试以下操作：

```
var keyComparer = (SomeDetail item) => new { Value1 = item.SomeValue1,
    Value2 = item.SomeDetail2 };
var detailList = Enumerable.Union(tempList1.Except(tempList2, equalityComparer), 
    tempList2.Except(tempList1, equalityComparer)).Union(
    Enumerable.Join(tempList1, tempList2, keyComparer, keyComparer
    (item1, item2) => (item1.SomeDate > item2.SomeDate) ? item1 : item2))
    .ToList(); 
```

`equalityComparer`应该是一个实现`IEqualityComparer<SomeDetail>`并有效地使用`keyComparer`函数来测试相等性的对象。

让我知道这是否适合您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:07:48.353

您必须能够告诉 Union 如何选择要使用的副本之一。除了编写自己的 Union 之外，我不知道有什么方法可以做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:14:33.913

您不能使用标准方法，但您可以为这种特殊处理`Union`创建扩展方法，并且将使用此方法，因为签名更适合。`Union``List<SomeDetail>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T20:04:33.370

为什么不直接使用 HashSet<T>？

```
List<SomeDetail> tempList1 = new List<SomeDetail>();
List<SomeDetail> tempList2 = new List<SomeDetail>();

HashSet<SomeDetail> hs = new HashSet<SomeDetail>(new SomeDetailComparer());

hs.UnionWith(tempList1);
hs.UnionWith(tempList2);

List<SomeDetail> detailList = hs.ToList(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-23T19:52:59.343

合并通用列表

```
 public static List<T> MergeListCollections<T>(List<T> firstList, List<T> secondList)
    {
        List<T> merged = new List<T>(firstList);
        merged.AddRange(secondList);
        return merged;
    } 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-05-25T12:24:29.523

试试这个：

```
list1.RemoveAll(p => list2.Any(z => z.SomeValue1 == p.SomeValue1 &&
                               z => z.SomeValue2 == p.SomeValue1 &&
                               z => z.SomeDate == p.SomeDate));
var list3 =  list2.Concat<SomeDetail>(list1).ToList(); 
```

# php - 诊断内存泄漏 - # 字节的允许内存大小已用尽

> ID：849549
> 
> 赞同：102
> 
> 时间：2009-05-11T19:04:00.873
> 
> 标签：php, memory-leaks

我遇到了可怕的错误消息，可能是经过艰苦的努力，PHP 内存不足：

> 在第 123 行的 file.php 中，允许的 #### 字节内存大小已用尽（尝试分配 #### 字节）

## 增加限制

如果您知道自己在做什么并想增加限制，请参阅[memory_limit](http://php.net/manual/en/ini.core.php#ini.memory-limit)：

```
ini_set('memory_limit', '16M');
ini_set('memory_limit', -1); // no limit 
```

谨防！您可能只是解决了症状而不是问题！

## 诊断泄漏：

错误消息指向带有循环的行，我认为该循环正在泄漏或不必要地累积内存。我`memory_get_usage()`在每次迭代结束时打印了语句，并且可以看到数字缓慢增长直到达到极限：

```
foreach ($users as $user) {
    $task = new Task;
    $task->run($user);
    unset($task); // Free the variable in an attempt to recover memory
    print memory_get_usage(true); // increases over time
} 
```

出于这个问题的目的，让我们假设可以想象的最糟糕的意大利面条代码隐藏在全局范围内的某处`$user`or `Task`。

**哪些工具、PHP 技巧或调试 voodoo 可以帮助我找到并解决问题？**

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-11T19:44:25.753

PHP 没有垃圾收集器。它使用引用计数来管理内存。因此，最常见的内存泄漏源是循环引用和全局变量。如果你使用一个框架，恐怕你需要大量的代码来寻找它。最简单的方法是有选择地调用`memory_get_usage`并将其缩小到代码泄漏的地方。您还可以使用[xdebug](http://www.xdebug.org)创建代码跟踪。运行带有[执行跟踪](http://xdebug.org/docs/execution_trace)的代码和`show_mem_delta`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-12-15T03:12:39.400

这是我们用来识别哪些脚本在我们的服务器上使用最多内存的技巧。

将以下代码段保存在文件中，例如`/usr/local/lib/php/strangecode_log_memory_usage.inc.php`：

```
<?php
function strangecode_log_memory_usage()
{
    $site = '' == getenv('SERVER_NAME') ? getenv('SCRIPT_FILENAME') : getenv('SERVER_NAME');
    $url = $_SERVER['PHP_SELF'];
    $current = memory_get_usage();
    $peak = memory_get_peak_usage();
    error_log("$site current: $current peak: $peak $url\n", 3, '/var/log/httpd/php_memory_log');
}
register_shutdown_function('strangecode_log_memory_usage'); 
```

通过将以下内容添加到 httpd.conf 来使用它：

```
php_admin_value auto_prepend_file /usr/local/lib/php/strangecode_log_memory_usage.inc.php 
```

然后分析日志文件`/var/log/httpd/php_memory_log`

`touch /var/log/httpd/php_memory_log && chmod 666 /var/log/httpd/php_memory_log`在您的网络用户可以写入日志文件之前，您可能需要这样做。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-15T18:57:18.970

我注意到有一次在一个旧脚本中，即使在我的 foreach 循环之后，PHP 也会将“as”变量保持在范围内。例如，

```
foreach($users as $user){
  $user->doSomething();
}
var_dump($user); // would output the data from the last $user 
```

我不确定未来的 PHP 版本是否修复了这个问题，因为我已经看到了。如果是这种情况，您可以`unset($user)`在该`doSomething()`行之后将其从内存中清除。YMMV。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-11T19:19:53.110

php内存泄漏的几个可能点：

*   php 本身
*   扩展名
*   你使用的 php 库
*   你的 php 代码

如果没有深入的逆向工程或 php 源代码知识，很难找到并修复前 3 个。[对于最后一个，您可以通过memory_get_usage](http://www.php.net/memory_get_usage)使用二进制搜索来查找内存泄漏代码

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-07-20T04:12:56.787

我最近在一个应用程序上遇到了这个问题，在我收集到的类似情况下。在 PHP 的 cli 中运行的脚本，循环多次迭代。我的脚本依赖于几个底层库。我怀疑一个特定的库是原因，我花了几个小时徒劳地试图向它的类添加适当的破坏方法，但无济于事。面对到另一个库的漫长转换过程（这可能会出现相同的问题），我想出了一个粗略的解决方法来解决我的问题。

在我的情况下，在一个 linux cli 上，我循环了一堆用户记录，并为每个用户创建了一个我创建的几个类的新实例。我决定尝试使用 PHP 的 exec 方法创建类的新实例，以便这些进程将在“新线程”中运行。这是我所指的一个非常基本的示例：

```
foreach ($ids as $id) {
   $lines=array();
   exec("php ./path/to/my/classes.php $id", $lines);
   foreach ($lines as $line) { echo $line."\n"; } //display some output
} 
```

显然，这种方法有局限性，需要意识到这样做的危险，因为它很容易创建一个兔子工作，但在极少数情况下，它可能有助于克服困难，直到找到更好的解决方案，就像我的情况一样。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-04-20T08:38:04.233

我遇到了同样的问题，我的解决方案是将 foreach 替换为常规 for。我不确定具体细节，但似乎 foreach 为该对象创建了一个副本（或以某种方式创建了一个新引用）。使用常规 for 循环，您可以直接访问该项目。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-12-07T08:35:26.217

我建议您查看 php 手册或添加`gc_enable()`收集垃圾的功能......那是内存泄漏不会影响您的代码运行方式。

`gc_enable()`PS：php 有一个不带参数的垃圾收集器。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-07-11T23:28:40.257

我最近注意到 PHP 5.3 lambda 函数在删除时会留下额外的内存。

```
for ($i = 0; $i < 1000; $i++)
{
    //$log = new Log;
    $log = function() { return new Log; };
    //unset($log);
} 
```

我不知道为什么，但即使在函数被删除之后，每个 lambda 似乎也需要额外的 250 个字节。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-02-19T20:53:26.443

我没有看到明确提到它，但是[xdebug在分析时间](https://xdebug.org/docs/profiler)**和内存**方面做得很好（截至[2.6](https://xdebug.org/updates.php)）。您可以获取它生成的信息并将其传递给您选择的 gui 前端：[webgrind](https://github.com/jokkedk/webgrind)（仅限时间）、[kcachegrind](https://kcachegrind.github.io/)、[qcachegrind](https://sourceforge.net/projects/qcachegrindwin/)或其他，它会生成非常有用的调用树和图表，让您找到各种问题的根源.

示例（qcachegrind）： [![在此处输入图像描述](https://i.stack.imgur.com/YxSdi.png)](https://i.stack.imgur.com/YxSdi.png)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-12T11:58:57.607

如果您所说的 PHP 仅在函数之后执行 GC 是真的，您可以将循环的内容包装在函数中作为解决方法/实验。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-06-22T14:02:56.717

我遇到的一个大问题是使用[create_function](http://in.php.net/create_function)。与 lambda 函数一样，它将生成的临时名称留在内存中。

内存泄漏的另一个原因（在 Zend Framework 的情况下）是 Zend_Db_Profiler。如果您在 Zend Framework 下运行脚本，请确保禁用该功能。例如，我的 application.ini 中有以下内容：

```
resources.db.profiler.enabled    = true
resources.db.profiler.class      = Zend_Db_Profiler_Firebug 
```

在此之前运行大约 25.000 个查询 + 处理负载，使内存达到 128Mb（我的最大内存限制）。

只需设置：

```
resources.db.profiler.enabled    = false 
```

将其保持在 20 Mb 以下就足够了

这个脚本在 CLI 中运行，但它正在实例化 Zend_Application 并运行 Bootstrap，所以它使用了“开发”配置。

它确实有助于使用[xDebug 分析运行脚本](http://xdebug.org/docs/profiler)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-01-05T23:06:15.960

这次谈话我有点晚了，但我会分享一些与 Zend Framework 相关的内容。

在安装 php 5.3.8（使用 phpfarm）以使用使用 php 5.2.9 开发的 ZF 应用程序后，我遇到了内存泄漏问题。我发现内存泄漏是在 Apache 的 httpd.conf 文件中触发的，在我的虚拟主机定义中，它说`SetEnv APPLICATION_ENV "development"`. 在注释掉这一行之后，内存泄漏就停止了。我试图在我的 php 脚本中提出一个内联解决方法（主要是通过在主 index.php 文件中手动定义它）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-09-08T19:47:09.117

我没有看到这里提到它，但可能有用的一件事是使用 xdebug 和 xdebug_debug_zval('variableName') 来查看引用计数。

我还可以提供一个阻碍 php 扩展的示例：Zend Server 的 Z-Ray。如果启用了数据收集，则每次迭代时内存使用将激增，就像垃圾收集已关闭一样。

# ajax - Ajax 中的深度放大 - 可能吗？有什么例子吗？

> ID：849552
> 
> 赞同：4
> 
> 时间：2009-05-11T19:04:53.820
> 
> 标签：ajax, deepzoom

我有一个想法，在浏览器中为运动训练数据（速度、距离、心率等）实现一个深度缩放类型的界面。但是，我实际上想要放大的不是图像，而是信息层次结构。例如，初始显示将包含一个年份网格 - 例如，将鼠标悬停在 2008 年，然后旋转鼠标滚轮（或单击）将放大该年份，但在缩放期间我希望 2008 淡出并替换为日历个月。再次放大一个月，月份将替换为月份日历，放大一天，您最终会看到一个带有训练数据的图表。一直以来，只有具有实际数据的日期才会以某种方式突出显示。

我的问题是这是否可能，以及是否有人已经看过这样的例子。我想象大多数时候下一级信息可以缓存在浏览器中（事实上，因为这是基于日历的，我可以计算其中的大部分并缓存要突出显示的日期。）我也可以缩放在 Ajax 线程获取要显示的数据时放入一个空图表。

我以前从未尝试过这样的事情，我特别感兴趣的是 DHTML 是否能够进行这种缩放（我怀疑没有，我将不得不求助于 Silverlight）以及 Ajax 执行是否会在浏览器期间不间断渲染线程一直忙于缩放。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T18:51:25.830

对于 JavaScript/Ajax 中图像的 Deep Zoom，Microsoft Live Labs 提供了出色的[Seadragon Ajax 库](http://livelabs.com/seadragon-ajax/library/)。

如果您正在研究[文本](http://gasi.ch/go/openzoom-fte)、视频和[矢量](http://gasi.ch/blog/openzoom-visualization-z-order/)等图像以外的内容的平滑和交互式缩放，请查看我在过去几个月开发的开源[OpenZoom SDK 。](http://openzoom.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T19:06:34.777

您可能无法使用 javascript/ajax 类型的界面实现非常平滑的缩放，但可以使用缩放界面。实用的 ajax 书有一章很好地介绍了实现 Google 地图克隆。该技术无需仅限于放大和缩小平铺图像。图像元素可以很容易地成为您想要的任何 HTML。可以将淡入淡出效果应用于缩放操作，因此当您上下移动图层时，您会得到与您描述的相似的效果。我建议抓住这本书（它是一本实用的程序员书籍，因此有一个便宜且可立即下载的 PDF 版本。阅读本章，思考这些技术，然后看看你是否认为它对你的愿景实用。祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-14T17:56:31.760

Seadragon Ajax 不断发展，现在是 OpenSeadragon：

[http://openseadragon.github.io/](http://openseadragon.github.io/)

我还列出了各种缩放技术，其中许多使用 JavaScript：

[https://github.com/iangilman/zooming](https://github.com/iangilman/zooming)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T19:12:41.100

我不相信 ajax 或 dhtml 是您想要实现的目标的好解决方案。我认为 flash/flex 或 silverlight 可能是最好的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T19:39:50.027

查看 jQuery 中的“缩放”效果。[这是一个链接。](http://docs.jquery.com/UI/Effects/Scale)我自己没有使用它，但它可能能够做你想做的事。您必须在正确的位置将一些内容换成不同的内容，否则您的 html 会变得太大。

# c# - 在 C# 中，一个类之前应该考虑重构多少行？

> ID：849557
> 
> 赞同：16
> 
> 时间：2009-05-11T19:06:18.107
> 
> 标签：c#, refactoring, class

一个好的经验法则是我智能地重构超过 50 行的任何方法。

该计数不包括注释和空格，而是实际代码。我还聪明地说的原因是有很多时候超过 50 行的类是可以接受的，不能或不应该改变。

我没有上课的经验法则。通常我不检查类来查看它们是否应该被重构。

在我目前的项目中，我刚刚完成了近 4000 行长的课程。但是没有超过 50 个的方法，并且大多数行和方法都是私有的，并且不作用于类之外的任何数据。

重构类的经验法则是什么？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-05-11T19:09:42.393

当类违反[SRP](http://en.wikipedia.org/wiki/Single_responsibility_principle)时，就该重构了。

> 单一职责原则是一种计算机编程原则，它规定每个模块或类都应该对软件提供的单个功能部分负责，并且该职责应该完全由类封装。它的所有服务都应与该职责密切相关

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-11T20:29:11.560

If your classes have broken one of following "rules", you should consider to refactor.

You are looking for **SOLID**, more detailed screencasts can be found [here](http://www.dimecasts.net/Casts/ByTag/SOLID%20Principle).

*   **S**RP: single responsibility principle, there should never be more than one reason for a class to change.

*   **O**CP: open closed principle, software entities (classes, modules, functions, etc.) should be open for extension but closed for modification.

*   **L**SP: liskov substitution principle, functions that use references to base classes must be able to use objects of derived classes without knowing it.

*   **I**SP: interface segregation principle, clients should not be forced to depend upon interfaces that they do not use.

*   **D**IP: dependency inversion principle:

    *   high level modules should not depend upon low level modules. Both Should depend upon abstractions.

    *   abstractions should not depend upon details. Details should depend upon abstractions.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-11T19:37:00.287

Don't let LOC be your primary metric. 50 lines seems really small to me. With 50 line files, you will end up having an unfriendly number of class files in the solution. Your productivity will be dampened by all the navigation you will be doing between files and your IDE will always be littered with too many tabs. I personally try to organize classes into logical groups by namespace first. On a class by class basis, I try to make the code smaller and easier to read. Sometimes, class files do get large. I start to get a sick feeling when the class file is 2000+ lines. Anything less than that, I deal with on a case by case basis.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-11T19:12:20.547

我不会说重构大型类有任何“经验法则”。有时候一个类真的封装了很多业务逻辑，应该和它一样大。但是，您可能会考虑问自己几个问题：

1.  （假设您正在编写面向对象的代码）我的代码真的是面向对象的吗？也就是说，它是否遵循单一职责原则（感谢 Nebakanezer）？这个类是辅助类吗？如果是这样，我如何将其方法重构为更合适的对象类？

2.  我有坚实的架构吗？也就是说，我是在利用抽象和继承，而不是在每个类中重新发明轮子吗？重载的方法是否适当地调用基方法？

3.  Do I really need all this code? Could some of the logic be externalized using xpath, lambda expressions, or some form of database driven expressions?

4.  Is the code extensible? Is it easy to maintain? Was it well-architected from the beginning, or are we always making small patches to try to fix problems?

I hope that this helps a little; it can be difficult to refactor large classes, but I think if you start looking through my questions, you may find pretty quickly that there is room for improvement in your code...I know I typically do.

Especially look at #1--it's really common for people to create a ton of helper classes all over the place, which is very anti-object oriented (in my opinion). That's a different topic, but you may want to see what really -belongs- in the class you've made and what could/should be somewhere else.

As a rule of thumb, if the class is maintainable and flexible, it may not need to be changed. :)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-11T19:14:06.737

In C#, my rule of thumb for classes is anything over 500 lines is getting too long. I really like methods under 10 lines, and I guess under 20 is acceptable. I think it really depends on the context.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-11T19:18:47.383

Refactor whenever you have the opportunity to:

*   introduce the appropriate design patterns in lieu of spaghetti code
*   reduce code complexity and increase readability
*   remove redundant code by introducing a single method call
*   extricate UI from business logic

etc, etc.

EDIT: Obviously, the decision to refactor should take into account time, potential pay-off, other responsibilities, etc.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-11T19:14:11.683

My rule of thumb is for methods, more than classes - If I can't see the whole method on screen it needs to be refactored. Of course, the [traditional smells](http://users.csc.calpoly.edu/~jdalbey/305/Lectures/SmellsToRefactorings) apply.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-11T19:37:03.597

I tend to look at the cyclomatic complexity of each member instead of number of lines of code for the entire class.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-11T19:08:52.347

重构与其说是减少 LOC 的数量（尽管这是一个副作用），不如说是提高质量。特别是，您想尽可能合理地遵循 DRY（不要重复自己）原则。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-11T19:43:57.750

This class could be a candidate for the refactoring exercise of "extract an object that you don't think is there"?

Perhaps, for example, you could extract a method object that would allow you to refactor several of the 50 line methods into members of an extracted class?

Alternatively, encapsulating some of those private methods that contain business logic in a new object that collaborates with this one might provide a new way to reuse either this object, or the extracted one.

One line is enough to consider refactoring. 40 each 50 line methods is starting to scream "I'm too complicated, there's another object hiding in here" to my ear.

# c# - 在 C# 中保存 XML 流表示它正在被另一个进程使用

> ID：849558
> 
> 赞同：1
> 
> 时间：2009-05-11T19:07:09.103
> 
> 标签：c#, xml, file, process, save

我有[这个](http://wiki.nazgulled.net/en/easy-settings)开源库，但在解决问题时遇到了一些麻烦……这个库允许轻松创建 XML 文件来存储应用程序设置。但是我在保存更改时遇到了问题。

我有另一个应用程序，我正在使用这个库，每次应用程序窗口完成调整大小时，我都会调用库的 Save() 方法将窗口大小/位置保存到 XML 文件中。

大多数时候它工作正常，一切都被保存了。不过，偶尔，我会收到一个异常，说该文件正在被另一个进程使用。

我真的需要确保每次调用 Save() 方法时都保存更改，我需要以某种方式处理此异常或防止它发生。

你们有什么建议可以最好地处理这种情况？

Save() 方法的代码如下：

```
public void Save() {
    // Create a new XML file if there's no root element
    if(xDocument.DocumentElement == null) {
        xDocument = new XmlDocument();
        xDocument.LoadXml("<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n" +
            "<" + XmlRootElement + ">\n</" + XmlRootElement + ">");
    }

    // OMITTED CODE WAS HERE (NOT IMPORTANT FOR THE PROBLEM)

    // Create a new XML writer for the XML file
    XmlWriter xWriter = XmlWriter.Create(XmlFilePath, new XmlWriterSettings() {
        Indent = true,
        IndentChars = "\t"
    });

    // Sort the XML file using the XSL sylesheet and save it
    xslTransform.Transform(xDocument, xWriter);

    // Clear the buffer and close the XML writer stream
    xWriter.Flush();
    xWriter.Close();
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:14:17.253

XmlWriter 是 IDisposable。您应该将其包装在 using() 子句中。 [http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmlwriter.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T21:38:47.157

我必须结合这里已经给出的答案。

出于多种原因，您的 XmlWriter 应该位于 using 块中。您应该处置它，以便尽快释放您的资源。此外，如果您在与它交互时抛出异常怎么办。该文件不会被正确关闭，至少在终结器启动并释放您的资源之前。

即使使用 using 语句，您也“可能”对文件有争用，需要将 Save 代码放在 lock 语句中。该方法本质上是不可重入的，因为文件是共享资源。如果您没有多个线程，那么在它周围加锁可能会过度杀戮，但您会确保正确控制对文件的访问。

要考虑的另一件事是您可能希望将保存操作移动到后台线程以将文件写出。如果你得到一个大的设置文件，你可能会导致奇怪的 UI 交互，因为每次用户调整大小时你都在等待文件写入，这发生在 UI 线程上。如果你这样做了，你肯定需要锁定对文件资源的访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:15:43.600

您也可以尝试使用锁定语句。可能是这些方法相互超越。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T19:48:29.707

可能是 window-resizing-completed 事件触发得如此之快，以至于调用了 save 函数，在它第一次完成运行之前再次调用。这将导致您描述的错误（使用该文件的另一个进程是......你！）。 [尝试用锁包围您的代码，因此](http://msdn.microsoft.com/en-us/library/c5kehkcz(VS.80).aspx)：

```
lock(some_shared_object)
{
    //Your code here
} 
```

# apache-flex - E4X：按月对 XMLList 进行排序？

> ID：849566
> 
> 赞同：0
> 
> 时间：2009-05-11T19:09:20.973
> 
> 标签：apache-flex, e4x

我正在尝试按月对 XML 列表进行排序，实际的标签具有比月更多的属性，但为简洁起见，我将不包括它们：

```
<var month="OCT"/>
<var month="NOV"/>
<var month="JAN"/>
<var month="MAR"/>
<var month="SEP"/>
<var month="JUL"/>
<var month="APR"/>
<var month="AUG"/>
<var month="DEC"/>
<var month="FEB"/>
<var month="MAY"/>
<var month="JUN"/> 
```

我怎样才能按月排序这个列表？...我不是按字母顺序，我是指 JAN、FEB、MAR 等。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:34:01.353

我不太清楚你是如何获得数据的，但如果你必须对 XML 进行实际排序，我猜你只需要编写一个自定义排序函数。

如果您有对象或可以将其解析为对象，则可以使用自定义比较函数。这是我用来对移动运营商的数组集合进行不区分大小写的排序的函数。我还使用它来跳过对数组集合中的第一个元素进行排序 - CARRIER DEFAULT：

```
private function x(event:ResultEvent):void{
                for(i=0; i<event.result.carriers.carrier.length; i++){
                    _mobile_carriers.addItem({label:event.result.carriers.carrier[i].name, data:event.result.carriers.carrier[i].id});
                }
                var sort:Sort = new Sort();
                sort.fields = [new SortField("label")];
                sort.compareFunction = caseInsensitiveSort;
                _mobile_carriers.sort = sort;
                _mobile_carriers.addItemAt({label:"Mobile Carrier", data:0},0);
                _mobile_carriers.refresh();
}

private function caseInsensitiveSort(obj1:Object, obj2:Object, fields:Array):int{
            if(obj1.label == CARRIER_DEFAULT) return -1;
            if(obj2.label == CARRIER_DEFAULT) return 1;
            return (obj1.label.toLowerCase() < obj2.label.toLowerCase()) ? -1 : 1;
        } 
```

如果您必须对字符串进行排序，请枚举月份，然后您可以比较它们，因为它们将映射到整数。可能有更好的方法来做到这一点，但作为一个快速的解决方案，我可能会整理一个哈希：

```
month_hash=
"JAN" => 1
"FEB" => 2
"MAR" => 3
... 
```

这是一些可用于自定义比较代码或用作 Sort() 的排序函数的比较伪代码

```
function compare(s1,s2){
   var m1 = ""
   var m2 = ""
   if (s1 =~ /month="([A-Z]+)"/) m1 = $1;
   if (s2 =~ /month="([A-Z]+)"/) m2 = $1;

   if(m1 ==  "" or m2 == ""){ 
     throw exception;
   }else{
      if(month_hash(m1) > month_hash(m2)){
         // string 1's month comes after string 2's month
         // return whatever will indicate that
         return 1;
      }else if(month_hash(m1) < month_hash(m2)){
         // string 1's month comes before string 2's month
         // return whatever will indicate that
         return -1;
      }else{
         //same month
         //return 0
      }
   }

} 
```

没有时间发布确切的代码，但希望这会有所帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T14:35:05.027

今天早上我想出了这个解决方案：

```
function sortXMLListByMonth(xmlList:XMLList):XMLList
{
    var months:Array = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
    var xml:XML = new XML(<temp></temp>);
    for(var i:uint = 0; i<months.length; i++)
    {
        var tmp:XMLList = xmlList.(@month == months[i]);
        xml.appendChild(tmp);
    }
    return xml.children();
} 
```

它实际上并不对 XMLList 进行排序，而是返回一个排序后的副本。

# delphi - TDataset 书签的有效期是多久？

> ID：849568
> 
> 赞同：13
> 
> 时间：2009-05-11T19:10:12.203
> 
> 标签：delphi, dbexpress, tclientdataset

我正在工作的项目中有如下代码。

```
procedure TForm.EditBtnClick(Sender:TObject);
begin
  // Mark is form variable. It's private
  Mark = cdsMain.GetBookmark;
  // blabalbal
  .
  .   
  .
end;

procedure TForm.OkBtnClick(Sender:TObject);
var  
  mistakes: Integer;
begin
  //Validation stuff and transaction control
  //removed to not clutter the code
  If cdsMain.ChangeCount <> 0 then 
    mistakes := cdsMain.AppyUpdates(-1); 
  cdsMain.Refresh;
  try
    cdsMain.GotoBookmark(Mark);
    // Yes, I know I would have to call FreeBookmark
    // but I'm just reproducing 
  except
    cdsMain.First;
  end;
end; 
```

就个人而言，我很少使用书签——除了重新定位我只移动光标位置的数据集（创建列表、填充字符串列表等）。如果我`Refresh`、更新（特别是当过滤器可以使记录不可见时）、重新获取（`Close`/ `Open`）或任何修改数据集中数据的操作，我不使用书签。我更喜欢`Locate`在主键上（`TClientDataset`当然使用 a ）或重新查询修改参数。

书签的有效期到什么时候？直到一个`Refresh`？直到`Close`/`Open`完成重新获取数据？安全区在哪里结束？

考虑一下我`TClientDataset`与`TSQLQuery`（DbExpress）一起使用的答案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T23:15:46.593

就像[c0rwin](https://stackoverflow.com/users/104014/c0rwin)和[skamradt](https://stackoverflow.com/users/9217/skamradt)已经提到的那样：书签行为取决于您使用的 TDataSet 后代。

通常，书签在以下期间无效：

1.  关闭/打开
2.  刷新（在支持它的数据集上）
3.  数据更改（有时仅删除）

我知道 1\. 和 2\. 会使您在 TClientDataSets 中的书签无效。我几乎可以肯定，对于 TClientDataSets，使用哪个底层提供程序（TSQLQuery、TIBQuery 等）并不重要。

确定什么有效，什么无效的唯一方法是对其进行测试。这意味着你不使用它们是完全正确的：书签有一个内在的机会是不可靠的。

为了安全起见，请务必`BookmarkValid`在前往书签之前致电。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T19:23:27.237

TDataSet 实现了虚拟书签方法。虽然这些方法确保在调用书签方法时从 TDataSet 派生的任何数据集对象都返回一个值，但返回值只是默认值，不跟踪当前位置。TDataSet 的后代，例如 TBDEDataSet，重新实现了书签方法以返回有意义的值，如下表所述：

*   **BookmarkValid**，用于确定是否正在使用指定的书签。
*   **CompareBookmarks**，测试两个书签是否相同。
*   **GetBookmark**，为您在数据集中的当前位置分配书签。
*   **GotoBookmark**，返回到以前由 GetBookmark 创建的书签
*   **FreeBookmark**，释放以前由 GetBookmark 分配的书签。

从[这里获取](http://www.podgoretsky.com/ftp/Docs/Delphi/D5/dg/5_datset.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T20:29:57.753

我个人很少使用书签。相反，我使用正在查看的记录的 ID，并在刷新完成后对其执行定位。如果我需要遍历集合中的所有记录，我会使用 tClientDataset 的克隆（它有自己的游标）来完成。

我的理解是，书签的实现取决于 tDataset 后代的供应商，并且可能因实现而异。在我非常简单的数据集 ( [tBinData](http://www.threefishsoftware.com/tfcomponents.htm) ) 中，我将书签实现为物理记录编号，因此只要记录未被删除，它就会在刷新之间持续存在。我不能对所有实现都这么说。

# windows-mobile - Windows Mobile PPC 麦克风

> ID：849572
> 
> 赞同：0
> 
> 时间：2009-05-11T19:10:31.423
> 
> 标签：windows-mobile

当我有 SIP 一键通呼叫时，我需要能够将 ppc 麦克风静音/取消静音；有知情者请指教；我曾尝试使用 phoneSetGain(...) API 但不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:13:39.623

我很确定这不是您想要做的。只需在 ptt 未激活时收集并丢弃样本。这样做的原因有很多，其中最大的一个是你会更灵敏（你可以在收到按钮按下事件后立即开始发送样本，否则，你必须等待所有硬件更改生效。

# assembly - IMUL AX 有效吗？

> ID：849575
> 
> 赞同：1
> 
> 时间：2009-05-11T19:11:44.323
> 
> 标签：assembly, x86

我花了最后一小时谷歌搜索，试图找出 IMUL AX 是否是 80x86 汇编程序中的有效命令。很抱歉没有尝试，我目前正在使用的 PC 上没有工具。

我需要的只是一个快速回答是/否。谢谢！

jpou

**更新：**今天尝试并验证。按预期工作。

```
-R
AX=0002  BX=0000  CX=20CD  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=0B02  ES=9FFF  SS=0B02  CS=0B02  IP=0102   NV UP EI PL NZ NA PO NC
0B02:0102 F7E0          MUL     A

-X
-T
AX=0004  BX=0000  CX=20CD  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=0B02  ES=9FFF  SS=0B02  CS=0B02  IP=0104   NV UP EI PL NZ NA PO NC
0B02:0104 FE7405        PUSH    [SI+05]                     DS:0005=9A 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T19:16:45.767

它应该是有效的：

> IMUL——有符号乘法
> 
> IMUL r/m16
> DX:AX ← AX * r/m 字。

摘自[此处](http://developer.intel.com/products/processor/manuals/index.htm)，“第 2A 卷：指令集参考，AM”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T19:23:06.130

> 很抱歉没有尝试，我目前正在使用的 PC 上没有工具。

从命令行：

```
Microsoft Windows [Version 6.0.6001]
Copyright (c) 2006 Microsoft Corporation.  All rights reserved.

C:\Windows\system32>debug
-a
17CC:0100 imul ax
17CC:0102
-u
17CC:0100 F7E8          IMUL    AX
17CC:0102 0000          ADD     [BX+SI],AL
-q 
```

使用调试命令可以验证“imul ax”将被汇编（因此是 80x86 汇编器中的有效命令）。

# c# - 持久层验证

> ID：849577
> 
> 赞同：0
> 
> 时间：2009-05-11T19:12:01.437
> 
> 标签：c#, .net, sql-server, database, validation

在使用存储过程保存数据时，我们经常会遇到外键约束、唯一键约束等。所有这些错误都可以通过传入正确的数据来纠正。

验证可以在业务逻辑层完成，只有在验证成功时才应该发送到持久层。但在某些情况下，在保存时验证数据很方便。就像在存储过程中一样。

例如，如果用户输入一些日期范围值，则应验证该范围不与任何现有范围重叠。在这种情况下，最好返回一些错误代码，它可以告诉我们范围是否重叠并且无法保存。

在 SQL Server 中，我们可以简单地引发自定义异常，但我想在不使用异常的情况下这样做。是否有任何我可以使用的验证框架。

我正在寻找一个 SQL Server 2005 和 .net 特定的解决方案。

* * *

**PS：**我通常从存储过程中返回自定义错误代码，然后通过在 xml 文件中查找来解析它们，然后在我的业务层规则引擎中使用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:50:04.463

在 SQL Server 中嵌入业务逻辑可能会提高性能，但会因违反关注点分离而使设计复杂化。为了让我有可移植的业务逻辑，它应该在业务层。我会从存储的过程中删除验证逻辑，只使用它们来简化 CRUD 操作。您永远不知道项目利益相关者何时会说“让它在数据库 X 上运行！”。尽最大努力保持验证逻辑数据库的独立性。

# c# - 在被动视图架构中，我应该在哪里为 Presenter 类创建依赖项？

> ID：849590
> 
> 赞同：4
> 
> 时间：2009-05-11T19:14:42.493
> 
> 标签：c#, refactoring, dependency-injection, mvp

我刚刚从演示者类重构了一个新的域类，但我不知道在哪里实例化它。

这是对维护不善的遗留项目进行的更大的持续重构工作的一部分。

当前正在由视图的 OnLoad 事件创建 Presenter，并且视图在构造函数中作为参数传递。Presenter 中的所有公共方法都是无参数的并且返回 void。它们使用视图的公共属性与视图通信。

视图，本质上是一种简陋的形式，完全取决于演示者的一切。

这是典型的被动视图模式，我想继续坚持下去。这使我陷入困境。我需要创建一个新域对象的实例供演示者使用。

*   如果我通过构造函数传递它，那么视图必须创建它并获得不必要的依赖。
*   如果我在演示者的任何地方创建它，我无法在单元测试中用模拟对象替换它。
*   如果我将它设为演示者的公共属性，那么我会在使用它的演示者方法上引入创建顺序依赖项，但我仍然没有解决哪个外部类负责创建它。

我目前没有使用任何依赖注入框架。虽然我有兴趣在未来使用它，但源代码仍然很脆弱，无法将第三方框架引入混合中。

我愿意接受任何建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:20:07.553

我已经做好了！！！[在我的存储库](http://code.google.com/p/mytodotodaylist/source/browse/#svn/trunk/prototype)中查看这里。我在这里的选择是使用构造函数......满足最贪婪的我确信演示者是向上的。在您的情况下，您可以从视图中为依赖项提供特定的 impl。

玩得开心 ：）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T17:58:06.527

我找到了一个更简单的解决方案。这是我原来的课程的一个例子：

```
public Presenter(IView view)
{
    this.View = view;
} 
```

我想将我的新依赖项作为构造函数参数传递，但也不想将此依赖项添加到我的视图中。构造函数链来救援！

```
public Presenter(IView view):this(view, new Dependency()){}

public Presenter(IView view, IDependency dependency)
{
    this.View = view;
    this.Dependency = dependency;
} 
```

现在生产代码继续使用原始接口，而单元测试使用新的接口，为视图和依赖项传入模拟。如果依赖项的数量继续增长，则需要进行一些重构，但在不久的将来，这是一个理想的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:03:41.523

我现在会去存储库或工厂。它可以立即进行测试。将来，您可以将其实现替换为 DI 库。

```
public class DomainObjectsRepository
{
    /// <summary>
    /// can not be instantiated, use <see cref="Instance"/> instead.
    /// </summary>
    protected DomainObjectsRepository()
    {

    }

    static DomainObjectsRepository()
    {
        Instance = new DomainObjectsRepository();
    }

    public static DomainObjectsRepository Instance { get; set; }

    public virtual ICustomerDao GetCustomerDao()
    {
        return new CustomerDao();
    }
}

public class DomainObjectsRepositoryMock : DomainObjectsRepository
{
    public override ICustomerDao GetCustomerDao()
    {
        return new CustomerDaoMock();
    }
} 
```

# windows-services - Tomcat 5.5 作为 Windows Server 2008 64 位上的服务

> ID：849594
> 
> 赞同：1
> 
> 时间：2009-05-11T19:15:04.957
> 
> 标签：windows-services, windows-server-2008, tomcat5.5

有没有人设法让 Tomcat 在 Win2008 64 位上作为服务运行？我需要它作为我的网站所依赖的第 3 方组件。否则它工作正常，但我无法让它作为服务运行。我已经尝试了所有可以使用的谷歌搜索，并尝试了各种 64 位 tomcat.exe / tomcatw.exe 但没有成功。升级到 Tomcat 6 也无济于事。我正在运行 Java 1.5 64 位。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-03-17T08:13:51.260

1.  下载 apache-tomcat-6.0.30-windows-x64 版本。
2.  解压到 c:\Tomcat6
3.  打开命令提示符以管理员身份运行
4.  并转到 Tomcat6\bin 目录并从命令提示符>服务安装运行
5.  Tomcat6 将作为 Windows 服务安装。
6.  再次转到 Tomcat6\bin 并打开以管理员身份运行的 tomcat6w.exe 并修改您的更改。
7.  它很酷。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-01T02:22:36.690

下载最新版本。您的问题是未提供 64 位 procrun.exe/tomcatw.exe。Tomcat 5.5 和 Tomcat 6 的较新安装程序包括 32 位和 64 位并部署适当的安装程序

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-15T03:51:22.537

摘自[http://www.openlogic.com/wazi/bid/188180/](http://www.openlogic.com/wazi/bid/188180/)

虽然 Tomcat 的 Java 组件在 64 位 JVM 下运行良好，但构建 Windows 服务的安装程序是 32 位可执行文件，在 64 位 Windows 操作系统下无法正常工作。

幸运的是，Tomcat 团队已经将这些可执行文件的 64 位版本组合在一起，尽管它们只将它们包含在每个 Tomcat 版本的源代码分发中。如果您已经安装了 Tomcat 的副本，以下是更新可执行文件的方法：

1) 从 OLEX 下载并解压您的 Tomcat 版本的源代码分发包

2）找到目录tomcat-XXXX-src/connectors/procrun/bin/amd64/

3) 将上述目录下的可执行文件复制到tomcat-XXXX/bin，覆盖32位版本

4) 运行命令 service.bat 安装。这将以显示的名称 Apache Tomcat 安装服务（服务名称将是 Tomcat5）

它对我有用！我一直在寻找这个解决方案......

# c - 在 c 中以 10 为底打印大型 256 数组

> ID：849598
> 
> 赞同：8
> 
> 时间：2009-05-11T19:15:44.333
> 
> 标签：c, base-conversion

我在 c 中有一组无符号字符，我试图以 10 为基数打印，但我被卡住了。我认为这将在代码中得到更好的解释，因此，鉴于：

```
unsigned char n[3];
char[0] = 1;
char[1] = 2;
char[2] = 3; 
```

我想打印 197121。

这对于小型基数 256 阵列来说是微不足道的。可以简单地 1 * 256 ^ 0 + 2 * 256 ^ 1 + 3 * 256 ^ 2。

但是，如果我的数组有 100 字节大，那么这很快就会成为一个问题。C 中没有 100 字节大的整数类型，这就是我将数字存储在 unsigned char 数组中的原因。

我应该如何有效地以 10 为基数打印这个数字？

我有点失落。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T19:25:01.383

仅使用标准 C 库没有简单的方法可以做到这一点。您要么必须自己编写函数（不推荐），要么使用外部库，例如[GMP](http://gmplib.org/)。

例如，使用 GMP，您可以执行以下操作：

```
unsigned char n[100];  // number to print

mpz_t num;
mpz_import(num, 100, -1, 1, 0, 0, n);  // convert byte array into GMP format
mpz_out_str(stdout, 10, num);  // print num to stdout in base 10
mpz_clear(num);  // free memory for num 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-07T20:57:20.750

当我看到这个问题时，我打算解决它，但那一刻我很忙。上周末，我可以获得一些有奖时间的空闲时间，所以我考虑了我的未决挑战。

首先，我建议你考虑上述反应。我从不使用 GMP 库，但我确信它是比手工代码更好的解决方案。此外，您可能有兴趣分析 bc 计算器的代码；它可以处理大数字，我曾经测试过我自己的代码。

好的，如果您仍然对代码感兴趣，请自己动手（仅支持 C 语言和标准 C 库）也许我可以给您一些东西。

首先，一点点理论。在基本数值理论（模算术水平）中，有一种算法可以启发我找到一个解决方案；**乘法和幂**算法求解**a^N**模 m：

```
Result := 1;
for i := k until i = 0
    if n_i = 1 then Result := (Result * a) mod m;
    if i != 0 then Result := (Result * Result) mod m;
end for; 
```

其中 k 是二进制表示中 N 减去一个的位数，并且 n_i 是 i 二进制数。例如（N 是指数）：

```
N = 44 -> 1 0 1 1 0 0

k = 5
n_5 = 1
n_4 = 0
n_3 = 1
n_2 = 1
n_1 = 0
n_0 = 0 
```

当我们进行模运算时，作为整数除法，我们可能会丢失部分数字，所以我们只需要修改算法，以免遗漏相关数据。

这是我的代码（注意它是一个临时代码，对可能的计算机拱门有很强的依赖性。基本上我玩的是 C 语言的数据长度，所以要小心，因为我的数据长度不能相同）：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>

enum { SHF = 31, BMASK = 0x1 << SHF, MODULE = 1000000000UL, LIMIT = 1024 };

unsigned int scaleBigNum(const unsigned short scale, const unsigned int lim, unsigned int *num);   
unsigned int pow2BigNum(const unsigned int lim, unsigned int *nsrc, unsigned int *ndst);
unsigned int addBigNum(const unsigned int lim1, unsigned int *num1, const unsigned int lim2, unsigned int *num2);

unsigned int bigNum(const unsigned short int base, const unsigned int exp, unsigned int **num);

int main(void)
{
  unsigned int *num, lim;
  unsigned int *np, nplim;
  int i, j;

  for(i = 1; i < LIMIT; ++i)
  {
    lim = bigNum(i, i, &num);

    printf("%i^%i == ", i, i);
    for(j = lim - 1; j > -1; --j)
      printf("%09u", num[j]);
    printf("\n");

    free(num);
  } 

  return 0;
}

/*
  bigNum: Compute number base^exp and store it in num array
  @base: Base number
  @exp: Exponent number
  @num: Pointer to array where it stores big number

  Return: Array length of result number
*/
unsigned int bigNum(const unsigned short int base, const unsigned int exp, unsigned int **num)
{
  unsigned int m, lim, mem; 
  unsigned int *v, *w, *k;

  //Note: mem has the exactly amount memory to allocate (dinamic memory version) 
  mem = ( (unsigned int) (exp * log10( (float) base ) / 9 ) ) + 3;
  v = (unsigned int *) malloc( mem * sizeof(unsigned int) );
  w = (unsigned int *) malloc( mem * sizeof(unsigned int) );

  for(m = BMASK; ( (m & exp) == 0 ) && m;  m >>= 1 ) ;

  v[0] = (m) ? 1 : 0;
  for(lim = 1; m > 1; m >>= 1)
  { 
    if( exp & m )
      lim = scaleBigNum(base, lim, v);

    lim = pow2BigNum(lim, v, w);

    k = v;
    v = w;
    w = k;
  }

  if(exp & 0x1)
    lim = scaleBigNum(base, lim, v);

  free(w);

  *num = v;  
  return lim;
}

/*
  scaleBigNum: Make an (num[] <- scale*num[]) big number operation
  @scale: Scalar that multiply big number
  @lim: Length of source big number
  @num: Source big number (array of unsigned int). Update it with new big number value

  Return: Array length of operation result
  Warning: This method can write in an incorrect position if we don't previous reallocate num (if it's necessary). bigNum method do it for us
*/
unsigned int scaleBigNum(const unsigned short scale, const unsigned int lim, unsigned int *num)
{
  unsigned int i;
  unsigned long long int n, t;

  for(n = 0, t = 0, i = 0; i < lim; ++i)
  {
    t = (n / MODULE);
    n = ( (unsigned long long int) scale * num[i]  );

    num[i] =  (n % MODULE) + t;  // (n % MODULE) + t always will be smaller than MODULE  
  }

  num[i] = (n / MODULE);

  return ( (num[i]) ? lim + 1 : lim );
}

/*
  pow2BigNum: Make a (dst[] <- src[] * src[]) big number operation  
  @lim: Length of source big number
  @src: Source big number (array of unsigned int)
  @dst: Destination big number (array of unsigned int)

  Return: Array length of operation result
  Warning: This method can write in an incorrect position if we don't previous reallocate num (if it's necessary). bigNum method do it for us
*/
unsigned int pow2BigNum(const unsigned int lim, unsigned int *src, unsigned int *dst)
{
  unsigned int i, j;
  unsigned long long int n, t;
  unsigned int k, c;

  for(c = 0, dst[0] = 0, i = 0; i < lim; ++i)
  {
    for(j = i, n = 0; j < lim; ++j)
    {
      n = ( (unsigned long long int) src[i] * src[j] );
      k = i + j;

      if(i != j)
      {
        t = 2 * (n % MODULE);
        n = 2 * (n / MODULE);

        // (i + j)
        dst[k] = ( (k > c) ? ((c = k), 0) : dst[k] ) + (t % MODULE); 
        ++k; // (i + j + 1)
        dst[k] = ( (k > c) ? ((c = k), 0) : dst[k] ) + ( (t / MODULE) + (n % MODULE) ); 
        ++k; // (i + j + 2)
        dst[k] = ( (k > c) ? ((c = k), 0) : dst[k] ) + (n / MODULE);
      }
      else
      {
        dst[k] = ( (k > c) ? ((c = k), 0) : dst[k] ) + (n % MODULE);
        ++k; // (i + j)
        dst[k] = ( (k > c) ? ((c = k), 0) : dst[k] ) + (n / MODULE);
      }

      for(k = i + j; k < (lim + j); ++k)
      {
        dst[k + 1] += (dst[k] / MODULE);
        dst[k] %= MODULE;
      }

    }
  }

  i = lim << 1;
  return ((dst[i - 1]) ? i : i - 1);
}

/*
  addBigNum: Make a (num2[] <- num1[] + num2[]) big number operation
  @lim1: Length of source num1 big number
  @num1: First source operand big number (array of unsigned int). Should be smaller than second
  @lim2: Length of source num2 big number
  @num2: Second source operand big number (array of unsigned int). Should be equal or greater than first

  Return: Array length of operation result or 0 if num1[] > num2[] (dosen't do any op)
  Warning: This method can write in an incorrect position if we don't previous reallocate num2  
*/
unsigned int  addBigNum(const unsigned int lim1, unsigned int *num1, const unsigned int lim2, unsigned int *num2)
{
  unsigned long long int n;
  unsigned int i;

  if(lim1 > lim2)
    return 0;

  for(num2[lim2] = 0, n = 0, i = 0; i < lim1; ++i)
  {
    n = num2[i] + num1[i] + (n / MODULE); 
    num2[i] = n % MODULE;
  }

  for(n /= MODULE; n; ++i)
  {
    num2[i] += n;
    n = (num2[i] / MODULE);
  }

  return (lim2 > i) ? lim2 : i;
} 
```

编译：

```
gcc -o bgn <name>.c -Wall -O3 -lm     //Math library if you wants to use log func 
```

要检查结果，请使用直接输出 as 和输入到 bc。简单的shell脚本：

```
#!/bin/bash

select S in ` awk -F '==' '{print $1 " == " $2 }' | bc`;
do
    0;
done;

echo "Test Finished!"; 
```

* * *

我们有一个 unsigned int 数组（4 个字节），我们在数组的每个 int 中存储一个 9 位数字（ % 1000000000UL ）；因此 num[0] 我们将有前 9 位数字，num[1] 我们将有数字 10 到 18，num[2]... 我使用常规内存来工作，但可以使用动态内存进行改进。好的，但是它可能是数组的长度？（或者我们需要分配多少内存？）。使用 bc 计算器（bc -l 和 mathlib）我们可以确定有多少位数字：

```
l(a^N) / l(10)     // Natural logarith to Logarithm base 10 
```

如果我们知道数字，我们就知道我们需要的整数数量：

```
( l(a^N) / (9 * l(10)) ) + 1     // Truncate result 
```

如果您使用 (2^k)^N 之类的值，您可以使用以下表达式将其解析为对数：

```
( k*N*l(2)/(9*l(10)) ) + 1    // Truncate result 
```

确定整数数组的确切长度。例子：

```
256^800 = 2^(8*800) ---> l(2^(8*800))/(9*l(10)) + 1 = 8*800*l(2)/(9*l(10)) + 1 
```

值 **1000000000UL** (10^9) 常量非常重要。像 10000000000UL (10^10) 这样的常量不起作用，因为会产生和未检测到的溢出（尝试数字 16^16 和 10^10 常量会发生什么）和更小的常量，例如 1000000000UL (10^8) 是正确的，但是我们需要预留更多的内存，做更多的步骤。10^9 是 32 位 unsigned int 和 64 位 unsigned long long int 的关键常数。

代码有两部分，乘法（简单）和乘以 2（更难）。乘法只是乘法和缩放并传播整数溢出。它需要数学中的关联属性原理来精确地执行逆原理，所以如果 k(A + B + C) 我们想要 kA + kB + kC ，其中数字将是 k*A*10^18 + k*B*10 ^9 + k *C。显然，k* C 操作可以生成大于 999 999 999 的数字，但绝不会大于 0xFF FF FF FF FF FF FF FF。乘法中永远不会出现大于 64 位的数字，因为 C 是 32 位的无符号整数，而 k 是 16 位的无符号短整数。在麦芽汁的情况下，我们将有这个数字：

```
k = 0x FF FF;
C = 0x 3B 9A C9 FF;    // 999999999
n = k*C = 0x 3B 9A | 8E 64 36 01;

n % 1000000000 = 0x 3B 99 CA 01;
n / 1000000000 = 0x FF FE; 
```

在 Mul k *B 之后，我们需要从 C 的最后一次乘法中添加 0x FF FE（ B = k* B + (C / module) ），依此类推（我们有 18 位算术偏移量，足以保证正确的值）。

功率更复杂，但本质上是相同的问题（乘法和加法），所以我给出了一些关于代码功率的技巧：

*   数据类型很重要，非常重要
*   如果您尝试将无符号整数与无符号整数相乘，则会得到另一个无符号整数。使用显式强制转换来获得 unsigned long long int 并且不会丢失数据。
*   始终使用无符号修饰符，不要忘记它！
*   Power by 2 可以直接修改当前索引前的 2 索引
*   gdb 是你的朋友

我开发了另一种添加大数字的方法。最后这些我没有证明太多，但我认为它运作良好。如果它有错误，请不要对我残忍。

...就这样！

PD1：开发于

```
Intel(R) Pentium(R) 4 CPU 1.70GHz

Data length: 
    unsigned short: 2 
    unsigned int: 4 
    unsigned long int: 4 
    unsigned long long int: 8 
```

它花费的数字如 256^1024：

```
real    0m0.059s
user    0m0.033s
sys    0m0.000s 
```

计算 i^i 的 bucle，其中 i = 1 ... 1024：

```
real    0m40.716s
user    0m14.952s
sys    0m0.067s 
```

对于像 65355^65355 这样的数字，花费的时间是疯狂的。

PD2：我的回复太晚了，但我希望我的代码有用。

**PD3：对不起，用英语解释我是我最严重的障碍之一！**

**最后更新：**我刚刚有了一个想法，即使用相同的算法但其他实现，提高响应并减少要使用的内存量（我们可以使用 unsigned int 的完全位）。秘密：n^2 = n * n = n * (n - 1 + 1) = n * (n - 1) + n。（我不会做这个新代码，但如果有人有兴趣，可能是在考试之后......）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-27T22:26:54.943

我不知道你是否还需要解决方案，但我写了[一篇](http://jonnydee.wordpress.com/2011/05/01/convert-a-block-of-digits-from-base-x-to-base-y/)关于这个问题的文章。它展示了一个非常简单的算法，可用于将任意以 X 为底的长数字转换为相应的以 Y 为底的数字。该算法是用 Python 编写的，但实际上只有几行长，并且不使用任何 Python魔法。我也需要这样一种算法来实现 C 语言，但出于两个原因决定使用 Python 来描述它。首先，任何理解用伪编程语言编写的算法的人都非常容易阅读 Python，其次，我不允许发布 C 版本，因为我是为我的公司做的。只要看看，你就会发现这个问题通常是多么容易解决。C中的实现应该是直截了当的......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T19:29:22.593

这是一个可以满足您要求的功能：

```
#include <math.h>
#include <stddef.h> // for size_t

double getval(unsigned char *arr, size_t len)
{
    double ret = 0;
    size_t cur;
    for(cur = 0; cur < len; cur++)
        ret += arr[cur] * pow(256, cur);
    return ret;
} 
```

这对我来说看起来完全可读。只需传递`unsigned char *`要转换的数组和大小。请注意，它并不完美 - 对于任意精度，我建议查看 GNU MP BigNum 库，正如已经建议的那样。

作为奖励，我不喜欢您以 little-endian 顺序存储您的数字，所以如果您想以 big-endian 顺序存储 base-256 数字，这里有一个版本：

```
#include <stddef.h> // for size_t

double getval_big_endian(unsigned char *arr, size_t len)
{
    double ret = 0;
    size_t cur;
    for(cur = 0; cur < len; cur++)
      {
        ret *= 256;
        ret += arr[cur];
      }
    return ret;
} 
```

只是要考虑的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-08T05:10:10.383

提出这个建议可能为时已晚或无关紧要，但是您能否将每个字节存储为两个以 10 为基数的数字（或一个以 100 为基数）而不是一个以 256 为基数的数字？如果您还没有实现除法，那么这意味着您所拥有的只是加法、减法，也许还有乘法；那些不应该太难转换。一旦你这样做了，打印它就很简单了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-17T03:18:19.690

由于我对提供的其他答案不满意，我决定自己编写一个替代解决方案：

```
#include <stdlib.h>
#define BASE_256 256

char *largenum2str(unsigned char *num, unsigned int len_num)
{
    int temp;
    char *str, *b_256 = NULL, *cur_num = NULL, *prod = NULL, *prod_term = NULL;
    unsigned int i, j, carry = 0, len_str = 1, len_b_256, len_cur_num, len_prod, len_prod_term;

    //Get 256 as an array of base-10 chars we'll use later as our second operand of the product
    for ((len_b_256 = 0, temp = BASE_256); temp > 0; len_b_256++)
    {
        b_256 = realloc(b_256, sizeof(char) * (len_b_256 + 1));
        b_256[len_b_256] = temp % 10;
        temp = temp / 10;
    }

    //Our first operand (prod) is the last element of our num array, which we'll convert to a base-10 array
    for ((len_prod = 0, temp = num[len_num - 1]); temp > 0; len_prod++)
    {
        prod = realloc(prod, sizeof(*prod) * (len_prod + 1));
        prod[len_prod] = temp % 10;
        temp = temp / 10;
    }

    while (len_num > 1) //We'll stay in this loop as long as we still have elements in num to read
    {
        len_num--; //Decrease the length of num to keep track of the current element

        //Convert this element to a base-10 unsigned char array
        for ((len_cur_num = 0, temp = num[len_num - 1]); temp > 0; len_cur_num++)
        {
            cur_num = (char *)realloc(cur_num, sizeof(char) * (len_cur_num + 1));
            cur_num[len_cur_num] = temp % 10;
            temp = temp / 10;
        }

        //Multiply prod by 256 and save that as prod_term
        len_prod_term = 0;
        prod_term = NULL;

        for (i = 0; i < len_b_256; i++)
        {                                                                        //Repeat this loop 3 times, one for each element in {6,5,2} (256 as a reversed base-10 unsigned char array)
            carry = 0;                                                           //Set the carry to 0
            prod_term = realloc(prod_term, sizeof(*prod_term) * (len_prod + i)); //Allocate memory to save prod_term
            for (j = i; j < (len_prod_term); j++)                                //If we have digits from the last partial product of the multiplication, add it here
            {
                prod_term[j] = prod_term[j] + prod[j - i] * b_256[i] + carry;
                if (prod_term[j] > 9)
                {
                    carry = prod_term[j] / 10;
                    prod_term[j] = prod_term[j] % 10;
                }
                else
                {
                    carry = 0;
                }
            }

            while (j < (len_prod + i)) //No remaining elements of the former prod_term, so take only into account the results of multiplying mult * b_256
            {
                prod_term[j] = prod[j - i] * b_256[i] + carry;

                if (prod_term[j] > 9)
                {
                    carry = prod_term[j] / 10;
                    prod_term[j] = prod_term[j] % 10;
                }
                else
                {
                    carry = 0;
                }
                j++;
            }

            if (carry) //A carry may be present in the last term. If so, allocate memory to save it and increase the length of prod_term
            {
                len_prod_term = j + 1;
                prod_term = realloc(prod_term, sizeof(*prod_term) * (len_prod_term));
                prod_term[j] = carry;
            }
            else
            {
                len_prod_term = j;
            }
        }

        free(prod); //We don't need prod anymore, prod will now be prod_term
        prod = prod_term;
        len_prod = len_prod_term;

        //Add prod (formerly prod_term) to our current number of the num array, expressed in a b-10 array
        carry = 0;
        for (i = 0; i < len_cur_num; i++)
        {
            prod[i] = prod[i] + cur_num[i] + carry;
            if (prod[i] > 9)
            {
                carry = prod[i] / 10;
                prod[i] -= 10;
            }
            else
            {
                carry = 0;
            }
        }

        while (carry && (i < len_prod))
        {
            prod[i] = prod[i] + carry;
            if (prod[i] > 9)
            {
                carry = prod[i] / 10;
                prod[i] -= 10;
            }
            else
            {
                carry = 0;
            }
            i++;
        }

        if (carry)
        {
            len_prod++;
            prod = realloc(prod, sizeof(*prod) * len_prod);
            prod[len_prod - 1] = carry;
            carry = 0;
        }
    }

    str = malloc(sizeof(char) * (len_prod + 1)); //Allocate memory for the return string

    for (i = 0; i < len_prod; i++) //Convert the numeric result to its representation as characters
    {
        str[len_prod - 1 - i] = prod[i] + '0';
    }

    str[i] = '\0'; //Terminate our string

    free(b_256); //Free memory
    free(prod);
    free(cur_num);

    return str;
} 
```

这一切背后的想法都源于简单的数学。对于任何以 256 为底的数字，其以 10 为底的表示可以计算为： `num[i]*256^i + num[i-1]*256^(i-1) + (···) + num[2]*256^2 + num[1]*256^1 + num[0]*256^0`

扩展为： `(((((num[i])*256 + num[i-1])*256 + (···))*256 + num[2])*256 + num[1])*256 + num[0]`

所以我们所要做的就是一步一步地将数字数组的每个元素乘以 256，然后将下一个元素加到它上面，依此类推……这样我们就可以得到以 10 为底的数字。

# c# - 在 Windows 服务中使用 OleDb 从 Excel 读取？

> ID：849602
> 
> 赞同：0
> 
> 时间：2009-05-11T19:16:20.587
> 
> 标签：c#, excel

免责声明：我知道这是一种不好的做事方式。这是我们与客户的唯一选择。

问题：

我们需要每隔 x 时间从 Excel 文件中读取数据。数据通过第 3 方 Excel 插件不断变化。应用程序的环境是 Windows XP、SP1 和 .Net 2.0。无需将操作系统升级到 SP2/3 或升级 .Net Framework。同样，这都是每个客户的参数。

这是我们当前的代码：

```
String sConnectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + Settings.ReutersFilePath + ";Extended Properties=\"Excel 8.0;HDR=No;IMEX=1\"";
使用 (OleDbConnection objConn = new OleDbConnection(sConnectionString))
{
    尝试
    {
        objConn.Open();
        _dataSet = 新数据集（）；
        OleDbCommand objCmdSelect = new OleDbCommand("SELECT * FROM [" + ConfigurationManager.AppSettings["Excel.WorksheetName"] + "$]", objConn);
        OleDbDataAdapter objAdapter1 = new OleDbDataAdapter();
        objAdapter1.SelectCommand = objCmdSelect;
        objAdapter1.Fill(_dataSet);
        _dataTable = _dataSet.Tables[0];
        objConn.Close();

        // 将新数据保存到数据库中。
        更新 SQL();
    }
    捕捉（异常前）{}
    最后
    {
        _isCurrentlyProcessing = false;
        if (objConn != null && (objConn.State != ConnectionState.Broken || objConn.State != ConnectionState.Closed))
        {
            objConn.Close();
        }
    }
}

```

此代码在从控制台或 Windows 窗体运行时有效，但当我们从 Windows 服务运行它时，它无法访问 Excel 文件。XP w/SP1 中是否存在不允许与 Vista 中的桌面应用程序交互的限制？这可以通过服务完成吗？客户端非常需要从服务运行它的可靠性。

编辑：

该服务作为 LocalSystem 运行。

编辑#2：

从服务运行时出现的错误是：Microsoft Jet 数据库引擎无法打开文件''。它已被其他用户独占打开，或者您需要权限才能查看其数据。

Excel 文件在桌面上打开，但必须打开它才能从 3rd 方应用程序获取更新。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-12T03:24:19.650

除了@sontek 的回答。

[仅适用于您是相关电子表格的所有者/开发者...]

您可能会发现使用“数据推送”模型比使用“数据拉取”模型更容易。根据插件中的某些事件，通过 excel 宏将数据直接推送到数据存储中通常是一种更简单的编程模型。这通常比在计时器上进行服务轮询要好得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T03:01:29.313

Excel 不允许您同时打开文件。您需要将其创建为共享工作簿或制作文件的副本并处理该副本。

您还可以尝试使用完整的 excel API (Microsoft.Office.Interop.Excel)，它可以让您连接到当前打开的 excel/工作簿。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:39:26.477

服务以什么用户身份运行？确保用户有权访问特定文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T19:55:50.350

似乎很可能是权限问题。Windows 服务在与桌面应用程序不同的用户帐户下运行。

此外，您提到您每隔 x 时间执行一次此方法。确保您使用正确的计时器。[http://www.aspfree.com/c/a/C-Sharp/Timer-Objects-in-Windows-Services-with-C-sharp-dot-NET/](http://www.aspfree.com/c/a/C-Sharp/Timer-Objects-in-Windows-Services-with-C-sharp-dot-NET/)

您应该能够通过使用“附加到进程”并选择您的主机进程来将调试器附加到服务。这可能会为您提供有关您的问题的更多信息。[http://msdn.microsoft.com/en-us/library/7a50syb3(VS.80).aspx](http://msdn.microsoft.com/en-us/library/7a50syb3(VS.80).aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T16:27:55.757

即使 Excel 当前已打开文件，[SpreadsheetGear for .NET也可以打开文件，并且非常适合从 Windows 服务使用。](http://www.spreadsheetgear.com/)

但是，磁盘上的文件不会反映 Excel 尚未保存的更改，并且 SpreadsheetGear 将无法在 Excel 保存期间打开工作簿，因此服务必须考虑到这一点。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T02:17:13.707

您可以尝试将其设为共享工作簿（工具 > 共享工作簿）。这允许多个用户同时编辑同一个工作簿。我不确定这是否对您有用，因为某些工作簿功能在共享时会被锁定

# c# - 如何在 SaveFileDialog 关闭之前验证文件名？

> ID：849604
> 
> 赞同：0
> 
> 时间：2009-05-11T19:16:34.097
> 
> 标签：c#, savefiledialog

我正在使用 SaveFileDialog 并想在允许保存文件之前评估文件是否满足某些条件。如果它不符合条件，我不希望 SaveFileDialog 在单击“保存”时关闭。我认为 FileOK 可能会起作用，但是在触发该事件时，对话框看起来已经关闭了，而且我看不到任何方法可以阻止它在任何情况下关闭。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:21:41.500

`FileOK`是[`CancelEventHandler`](http://msdn.microsoft.com/en-us/library/system.componentmodel.canceleventhandler(VS.71).aspx)- 您只需将 的[`Cancel`](http://msdn.microsoft.com/en-us/library/system.componentmodel.canceleventargs.cancel(VS.71).aspx)属性设置[`CancelEventArgs`](http://msdn.microsoft.com/en-us/library/system.componentmodel.canceleventargs(VS.71).aspx)为`true`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T19:29:32.733

从 FileOK 处理程序尝试这种方法

```
private void openFileDialog1_FileOk(object sender, CancelEventArgs e)
{
    //your conditions...
    if (!openFileDialog1.FileName.Equals( "C:\\hello.txt" ) )
    {
        //if fail, set e.cancel
        MessageBox.Show(@"File name must equal c:\hello.txt.");
        e.Cancel = true;

    }            
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:20:24.560

[.NET 控件：保存文件对话框](http://ww.functionx.com/vcsharp2003/controls/savefiledialog.htm)

# .htaccess - .htaccess 和 URL 重写

> ID：849609
> 
> 赞同：0
> 
> 时间：2009-05-11T19:17:32.613
> 
> 标签：.htaccess, mod-rewrite, https

我们有以下示例“丑陋”的 URL：

```
https://some.uglyurl.com/directory/test.jsp?hotelid=1111&rateplanid=33333 
```

我们需要使用我们自己的域 URL 作为地址将我们的客户定向到上述 URL - 所以它看起来像：

```
https://www.PrettyURL.com/reservations?hotelid=1111&rateplanid=33333 
```

我们的客户“看到”的地址对他们来说是一个好看的“熟悉”URL。这在 .htaccess 中可行吗？我们会在丑陋的 URL 中的 test.jsp 之后添加各种变量——所以它不能只是一组固定的变量。

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:25:16.953

如果您只是使用纯 HTTP，您可以将*漂亮的 URL*服务器设置为[代理](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html)，将每个请求传递给*丑陋的 URL*服务器并将响应返回给客户端：

```
RewriteCond %{HTTP_HOST} ^pretty\.example\.com$
RewriteRule ^reservations$ http://ugly.example.com/directory/test.jsp [L,P] 
```

但是当您使用 HTTPS 时，不可能不收到错误消息，即证书的主机名不正确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T02:03:40.590

这是对我有用的代码：

```
RewriteCond %{HTTP_HOST} ^www.prettyurl.com$
RewriteRule ^reservations$ https://uglyURL.com/istay/istay.jsp?%2 [QSA,L] 
```

它完全按照我的需要工作。

非常感谢 Gumbo 和其他人的帮助。

# silverlight - Silverlight 3 中是否存在 XamlWriter？

> ID：849612
> 
> 赞同：1
> 
> 时间：2009-05-11T19:18:15.310
> 
> 标签：silverlight, xaml

我正在尝试将 Silverlight (2) 中的对象写为 Xaml。[http://www.codeplex.com/silverlightcontrib](http://www.codeplex.com/silverlightcontrib)对我不起作用，因为它不是我正在处理的 FrameworkElement。有谁知道 Silverlight 3 中是否存在 XamlWriter？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T13:05:45.090

不幸的是，它不在当前版本的 SL3 中，而且似乎也不会进入最终版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-06T18:23:30.473

它仍然不在 Silverlight 4 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-17T18:26:37.250

然而，这可能是序列化到 Xaml 的有用替代品： [http ://www.davidpoll.com/2010/07/25/to-xaml-with-love-an-experiment-with-xaml-serialization-in-silverlight/](http://www.davidpoll.com/2010/07/25/to-xaml-with-love-an-experiment-with-xaml-serialization-in-silverlight/)

# winapi - 我可以使用 svchost.exe 来托管我自己的服务吗？

> ID：849613
> 
> 赞同：13
> 
> 时间：2009-05-11T19:18:15.747
> 
> 标签：winapi, windows-services

我找不到如何做的文档，这让我觉得我不应该这样做。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T19:19:07.057

不，svchost.exe 未记录在案，仅支持作为 Windows 一部分的服务。

部分原因是可靠性——第 3 方服务的崩溃应该不会影响关键的 Windows 服务。

为什么要使用 svchost？您是否有多个服务想要组合在一起？创建自己的 exe 来托管多个服务非常简单。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T19:22:15.443

此链接中的评论将帮助您，这里剪切/粘贴太多了。源代码是 C++，因为您没有指定一种语言，我认为这无关紧要。

[链接](http://forum.sysinternals.com/forum_posts.asp?TID=11974)

编辑：为了记录，我并不是说这是一个好主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:45:09.090

您可以下载 Windows NT 资源工具包 ( [http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en) )，然后按照这些说明从任何东西：http: [//support.microsoft.com/kb/137890](http://support.microsoft.com/kb/137890)

# windows-7 - Windows 7 RC 中的 Group by、Sort by、Stack by Column 标题上下文菜单发生了什么？

> ID：849615
> 
> 赞同：0
> 
> 时间：2009-05-11T19:18:47.383
> 
> 标签：windows-7, windows-explorer, windows-shell

作为开发人员，我通常按文件类型对资源管理器详细信息视图进行分组。这样，所有配置文件、程序集、可执行文件等都被分组并准备好复制，只需单击其组标题以选择所有相关文件。

在 beta build 7000 中，可以按住 Ctrl 并选择多个组来选择所有相关文件。

IMO 自 RC build 7100 以来，仅第一次单击的组会选择所有相关文件，并且在新组上按住 Ctrl 时的每次后续单击都无效（未选择该组中的相关文件）。

有没有我错过的任何选项来恢复行为 - 可以从列表视图列标题上下文菜单中选择分组依据、排序依据、堆叠依据，就像它在 beta 中一样？- 可以按住 Ctrl 并根据需要选择尽可能多的组来选择相关文件（用于实例的复制操作）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-07T11:18:02.267

我在 MS Connect提交了一个[错误](https://connect.microsoft.com/feedback/ViewFeedback.aspx?FeedbackID=453069&SiteID=647)

# ruby - `autoload` 会引发错误，但 `require` 不会（ruby）

> ID：849622
> 
> 赞同：3
> 
> 时间：2009-05-11T19:20:38.753
> 
> 标签：ruby, rubygems

在我的 Ruby 程序中，我试图延迟加载一个库（好奇的[破解](http://github.com/jnunemaker/crack/tree/master)）。

如果我这样做：

```
require 'rubygems'
require 'crack' 
```

一切正常。但是，当我尝试这个时：

```
require 'rubygems'
autoload :Crack, 'crack' 
```

引发了 LoadError。（*没有这样的文件可以加载——破解*）

为什么会引发此错误？是因为“crack”（以及我的其他用户安装的 gem）不在我的 $LOAD_PATH 中吗？

*编辑：*

此外，`autoload`确实适用于标准库：

```
autoload :Yaml, 'yaml' 
```

工作正常，并且不会引发错误。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T20:04:47.327

您需要通过执行以下操作将“破解”gem 添加到您的 $LOAD_PATH 中：

```
gem 'crack' 
```

这是必要的，因为 RubyGems 将 Kernel#require 替换为在必要时尝试在需要它之前“激活”gem 的方法，但不会对 Kernel#load 做同样的事情 - 并且 autoload 在后端调用 load。

# asp.net - ASP.NET - 传递字符串时，ActionResult 参数总是返回 null - 为什么？

> ID：849624
> 
> 赞同：10
> 
> 时间：2009-05-11T19:21:33.277
> 
> 标签：asp.net, asp.net-mvc

我刚刚开始我的第一个 ASP.NET MVC 项目类型的项目，我正在创建一个详细信息页面，而不是传递模板（int id），而是传递一个字符串。但是当我处于调试模式并在 URL 中输入时，“myString”为空。为什么这样？我是否必须在其他地方更改任何其他内容？

因此，如果我转到 URL 并输入以下内容：

[http://localhost:2345/Bank/EmployeeDetails/3d34xyz](http://localhost:2345/Bank/EmployeeDetails/3d34xyz)

```
public ActionResult EmployeeDetails(string myString) // myString is null
{
     return View();
} 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-11T19:29:49.583

在您`Global.asax.cs`的文件中，您将默认映射以下路由：

```
routes.mapRoute(
    "Default",
    "{controller}/{action}/{id}",
    new { controller = "Home", action = "Index", id = UrlParameter.Optional }); 
```

这意味着类似的 url`http://localhost:2345/Bank/EmployeeDetails/3d34xyz`将转到`Bank`控制器、`EmployeeDetails`操作并将值传递给`3d34xyz`名为 的参数`id`。传递一个字符串是完全可以的，但是为了让它工作，你有两个选择：

`id`1）在您的操作方法中将变量重命名为。

```
public ActionResult EmployeeDetails(string id) { ... } 
```

2）添加另一个与您想要的字符串名称匹配的路由。确保使其比默认路由更具体，并将其放在文件中的默认路由*之前*`Global.asax.cs`。

```
routes.mapRoute(
    "BankEmployeeDetails"
    "Bank/EmployeeDetails/{myString}"
    new { controller = "Bank", action = "EmployeeDetails", myString = UrlParameter.Optional }); 
```

如果在 url 中没有传递值，这将传递一个默认值`null`to `myString`，但是使用您指定的 url，您将传递 value `3d34xyz`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T19:23:08.813

如果您使用的是默认路由表，请重命名`myString`为。`id`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T19:24:11.417

假设您没有修改默认路由（在您的 Global.asax.cs 中）：

```
 routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        ); 
```

**该方法期望它被命名为“id”。**

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-11T19:23:49.827

将名称更改`myString`为`id`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-12T01:52:11.520

我遇到了同样的问题，您只需要在页面中提供详细信息超链接的 id（在此处的银行页面中）

```
 @Html.ActionLink("Details", "Details", new { id=""}) 
```

这解决了我的问题，希望对你有所帮助。

这适用于 MVC 5。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-11T17:29:44.723

当您尝试了所有这些并且仍然返回 null 时，请重新启动 Visual Studio。这最终对我有所帮助。

# php - Leopard 上的 Zend_Search_Lucene：问题

> ID：849634
> 
> 赞同：1
> 
> 时间：2009-05-11T19:23:03.680
> 
> 标签：php, lucene, osx-leopard, zend-search-lucene

Leopard 10.5.6 Macbook Zend 1.6、Apache 2、PHP 5.2.5

我似乎无法使用 Zend_Search_Lucene api 进行索引。构建或打开索引会生成以下异常消息：

string(30) "错误的segments.gen 文件格式"

但是，索引/段文件是来自我网站的工作版本的 scp，我已将它们全部更改为 777，所以我不认为这是一个权限问题。

不确定尝试哪个方向 - 寻找一些想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T15:20:32.683

我的 PHP 二进制文件是 32 位的。PHP_INT_SIZE 是 4。这让 Zend 感到困惑，它检查系统的 int 大小，在 Leopard 上是 8 位。切换到 XAMMP（PHP 64 位二进制文​​件）解决了 Lucene 文件系统问题。它与区分大小写或路径无关。它与使用 Marc Liyanage pkg php/mysql/apache 有关。更新到最新的 Liyanage pkg 并没有解决这个问题。使用 XAMMP 做到了。耶。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T19:57:38.390

如果您要部署到 Leopard 与 Linux/Unix，您还可能会遇到区分大小写的问题。

或者它可能是绝对路径与相对路径问题。如果我没记错的话，Zend_Search_Lucene 喜欢绝对路径。如果您的包含路径不同，则可能会导致问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:36:51.973

一种选择是您在不同的机器上使用不同版本的 Lucene。 [Zend 文档](http://framework.zend.com/manual/en/zend.search.lucene.html#zend.search.lucene.overview)说 Zend 1.6 支持 Lucene 2.3 格式。也许另一台机器使用较旧/较新的 Lucene 版本。

# django - GAE Django 中的对象标签

> ID：849644
> 
> 赞同：0
> 
> 时间：2009-05-11T19:24:56.360
> 
> 标签：django, google-app-engine, django-models

在我常用的 django 代码中，我使用**unicode**函数给每个对象一个标签...这在管理界面中显示为列出的对象中的 oject 标签...

```
class apprd(models.Model):
   usr = models.ReferenceProperty(User)
   approved = models.BooleanProperty(default = True)

   def __unicode__(self):
      return ('approved one') 
```

但现在我已经转移到 GAE 并且似乎不支持此功能......有什么解决方法还是我做错了

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T08:18:42.447

这在 GAE 中是不可能的，因为 GAE 管理控制台不读取 - 实际上，无权访问 - 您的模型定义。它只能访问存储的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-30T11:22:14.450

如果您使用[http://code.google.com/p/app-engine-patch/](http://code.google.com/p/app-engine-patch/)，您可以在 GAE 中运行完整的 Django 管理界面。

# moss - 当返回超过 100 个组时，MOSS 所有组不显示分页

> ID：849650
> 
> 赞同：0
> 
> 时间：2009-05-11T19:25:45.267
> 
> 标签：moss, wss

当我进入`/_layouts/groups.aspx`我的网站集时，我只看到前 100 个组。没有可见的分页控件。我该如何纠正这个问题，而不是只与前 100 个组一起工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-05-24T00:12:23.150

如果需要，您还可以通过标准 UI 修改此视图，而不是使用代码：

1.  浏览到“http:// ***<网站集 url>*** /_catalogs/users/AllGroups.aspx”
2.  站点操作-> 编辑页面
3.  修改列表视图 web 部件
4.  在选定视图下单击“编辑当前视图”链接。
5.  您现在可以像在 SharePoint 中一样编辑视图设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T23:35:04.703

该列表是一个共享点内部列表，无法通过 API 访问，必须通过使用对象模型来访问。

假设您熟悉 SharePoint API，

您需要以编程方式访问您的站点，然后访问用户和组列表，然后访问其上的默认视图，并将其分页属性设置为 true。

```
static void Main(string[] args)
{
  //Access the site
  using (SPSite _site = new SPSite("http://myurlwithport:800"))
  {
    //Substitute the appropriate web if it is not the root
    using (SPWeb _web = _site.RootWeb)
    {
      // This is always the name of the users list
      SPList userList = _web.Lists["User Information List"];

      //This is the view that is causing you trouble
      SPView allGroupsView = userList.Views["All Groups"];

      //Set this value to true if it is false.
      Console.WriteLine(allGroupsView.Paged);

      //Set this value to whatever you want if you don't want paging
      Console.WriteLine(allGroupsView.RowLimit);                   

      Console.ReadLine();
    }
  }
} 
```

希望这对你们有用。

**编辑**

基于OP评论

如果需要，您可以更改一个 RowLimit 属性。

我已将其添加到提供的代码中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-03T21:43:15.927

我想对 Michael M 关于更新“AllGroups.aspx”的建议分享一些额外的说明。

最初，我使用常规网站集管理员帐户访问“http:///_catalogs/users/AllGroups.asp”页面，但访问被拒绝。

然后，我使用了另一个站点集合管理员帐户，该帐户也在 SP 服务器的 Windows 管理员组中，但仍然被拒绝访问。

最后，我使用了用于设置 Web 应用程序/应用程序池的 SharePoint 2010 Farm 管理员帐户，这最终使我能够访问该页面。

# asp-classic - 是否有一个小型的经典 ASP 服务器，例如 Visual Studio 附带的 ASP.NET 开发服务器？

> ID：849651
> 
> 赞同：4
> 
> 时间：2009-05-11T19:25:45.890
> 
> 标签：asp-classic, webserver, embeddedwebserver

想听听有没有小型的经典ASP服务器，类似于Visual Studio自带的ASP.NET开发服务器？

我们是一个支持传统（经典）ASP 站点的小组，因此希望有一个可以在 Windows XP 机器上轻松执行的小型服务器。目前，我们在开发机器上使用 IIS 5.1（而且因为我们运行的是 XP Pro，我们无法更新到 IIS 6 或 7）。

我已经尝试安装[Cassini](http://www.asp.net/downloads/archived/cassini/) Web 服务器，但这似乎也不适用于经典 ASP。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:44:09.137

通过在 IIS 6 或 7 上运行，您不会从 ASP 获得任何额外的东西。在 IIS 5.1 上卡住您是否有任何特定问题？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-18T20:07:29.997

简短的回答是不，没有运行经典 ASP 的小型 Web 服务器。正如这里提到的，有许多替代品，例如 IIS 或 Apache 插件，但没有一个像 Visual Studio 附带的支持调试的 ASP.NET 开发服务器那样占用空间小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-18T22:44:11.380

你试过 Baby Web Server 吗？- [http://www.pablosoftwaresolutions.com/html/baby_web_server.html](http://www.pablosoftwaresolutions.com/html/baby_web_server.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-29T22:21:44.400

有一个运行 Classic ASP 的小型 Web 服务器。

它被称为深渊网络服务器。Abyss Web服务器由Aprelium软件制作，可免费下载。Abyss Web 服务器可以配置为使用 ASP.net 或 Classic ASP 运行。

服务器可以配置为运行 ASP.net 而无需任何额外的下载。

要在服务器上运行 Classic ASP，必须下载并配置由 Selisoft 编写的名为 ActiveHTML 的程序，以允许 Classic ASP 在 Abyss Web 服务器上运行。Active HTML 提供 45 天免费试用，如果您喜欢它，目前的购买价格约为 30 到 40 欧元，具体取决于您需要客户端版本还是服务器版本。

希望这可以帮助。

安东尼

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-16T18:01:25.183

Abyss 网络服务器[http://www.aprelium.com/](http://www.aprelium.com/)支持经典的 ASP（还有 ASP.Net、Ruby 和 PHP），带有一个 3rd 方扩展，费用为 $$$。但是在某个时候，第三方组件有一个免费版本，你可能会找到一个仍然在流传的副本。不确定调试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-01T06:43:27.533

Baby ASP Web Server 可以为您处理事情，而且您不必安装它，因此它不会将各种疯狂的设置放入您的注册表中。

[在这里获取](http://www.pablosoftwaresolutions.com/html/baby_web_server.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T19:31:58.267

您唯一真正的选择是运行 Windows 服务器或 Vista 以获得最新版本的 IIS。

Cassini 不支持经典的 asp。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T19:37:52.050

根据[这篇文章](http://forums.asp.net/p/832651/832651.aspx)，不可能在 Cassini 上运行 ASP。几次谷歌搜索后，我仍然找不到任何其他选择。

你追求什么功能？如果是 VS 的快捷运行特性，你可以很容易地[在 IIS 上进行 IDE 调试](http://spinningtheweb.blogspot.com/2006/06/getting-visual-studio-2005-and-iis-51.html)（虽然 ASP 在技术上不能被“调试”——你真正要做的就是用`Ctrl+F5`命令运行它）。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-05-11T20:14:39.120

这是一个允许您从任何 Web 服务器（包括 IIS 和 Apache）运行经典 ASP 页面的网站，但它需要花钱：

[http://www.selisoft.com/en/ahtml/index.phtml](http://www.selisoft.com/en/ahtml/index.phtml)

# php - 以编程方式执行 Photoshop 的“亮度”过滤器

> ID：849654
> 
> 赞同：4
> 
> 时间：2009-05-11T19:27:12.487
> 
> 标签：php, python, image, image-processing, python-imaging-library

我有两个 JPEG，并希望将一个叠加在另一个上，其结果与 Photoshop（和 Fireworks）中可用的“亮度”模式相同。您可以在此处阅读有关亮度模式的更多信息：http: [//www.adobetutorialz.com/articles/662/1/Photoshop%92s-Luminosity-Mode](http://www.adobetutorialz.com/articles/662/1/Photoshop%92s-Luminosity-Mode)

我怎样才能做到这一点？编程语言无关紧要，但我最熟悉 Python 和 PHP（按此顺序）。Python Imaging Library 似乎很合适，但 luminosity 不是内置函数，我不知道正确的程序。见[http://effbot.org/imagingbook/imagechops.htm](http://effbot.org/imagingbook/imagechops.htm)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T19:37:30.443

首先，您需要了解 Photoshop 的功能。

它保留下层的感知颜色信息，并用顶层的感知光度信息替换它的光度。为此，您需要将图像转换为正确的色彩空间。

如果您决定自己实施所有事情，以下是您需要做的事情的购物清单：

*   加载源 JPEG 和目标 JPEG
*   将像素从 RGB 颜色空间转换为 L *a* b 颜色空间（或任何其他具有发光度信息的颜色空间）
*   保留目标颜色通道并用源的亮度替换其亮度通道
*   转换回 RGB 空间
*   保存 JPEG

如果你觉得 Lab 太复杂，你也可以使用 HSL 颜色空间，它更简单但效果会很差。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:41:58.253

在伪代码中：

```
foreach rgb_pixel1, rgb_pixel2 in image1, image2 {
    hsl1 = RgbToHsl(rgb_pixel1);
    hsl2 = RgbToHsl(rgb_pixel2);
    hsl3 = hsl(hsl1.h, hsl1.s, hsl2.l);
    output_rgb = HslToRgb(hsl3);
} 
```

从 rgb 到 hsl 的转换在[这里](http://www.geekymonkey.com/Programming/CSharp/RGB2HSL_HSL2RGB.htm)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T21:07:00.220

我不知道这个特定的过滤器，但我可以告诉你如何遵循[PIL](http://www.pythonware.com/products/pil/)中的 Coincoin 步骤。我实际上并没有运行代码，但您可以将其用作参考：

加载源 JPEG 和目标 JPEG

```
from PIL import Image
img1 = Image.open('image1.jpg')
img2 = Image.open('image2.jpg') 
```

将像素从 RGB 颜色空间转换为 L *a* b 颜色空间（或任何其他具有发光度信息的颜色空间）

```
# Color matrix for Lab
colorMatrix = (
    x1, y1, z1, 0,
    x2, y2, z2, 0,
    x3, y3, z3, 0
)
img1 = img1.convert("RGB", colorMatrix)
img2 = img2.convert("RGB", colorMatrix) 
```

保留目标颜色通道并用源的亮度替换其亮度通道

```
l1, a1, b1 = img1.split()
l2, a2, b2 = img2.split()
img1.putdata(zip(l1.getdata(), a2.getdata(), b2.getdata())) 
```

转换回 RGB 空间

```
# Color matrix for RGB
RGBcolorMatrix = (
    x1, y1, z1, 0,
    x2, y2, z2, 0,
    x3, y3, z3, 0
)
img1 = img1.convert("RGB", RGBcolorMatrix) 
```

保存 JPEG

```
img1.save('new_image.jpg') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T19:36:31.507

Gimp 是另一种选择——它有一个脚本接口和一个 python api——这是一篇关于[luminosity 和 Gimp](http://gimpology.com/submission/view/luminosity_masking_the_light_side/)的文章。不确定它是否与您想要的效果相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T19:44:39.480

你可以看看[OpenCV](http://opencv.willowgarage.com/wiki/)图像处理库。它具有 Python 绑定并为您处理许多这些较低级别的图像处理任务，或者至少使它们更容易。

# cocoa - NSTextView 在滚动时未正确刷新

> ID：849655
> 
> 赞同：7
> 
> 时间：2009-05-11T19:27:22.987
> 
> 标签：cocoa, macos, nstextview, artifacts

我有一个带有大量文本的 NSTextView。但是，每当我滚动时，视图都不会正确更新。视图的顶部或底部保留了一些工件。看起来视图本身刷新的频率不够高。如果我滚动得很慢，视图会正确更新。如果我在视图中添加边框一切正常，那么无边框视图就是有问题的视图。这是屏幕截图的链接：

[![](https://i.stack.imgur.com/k1SOk.png)](https://i.stack.imgur.com/k1SOk.png)

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-28T18:55:00.857

您是否为或设置了`setDrawsBackground`和属性？`copiesOnScroll``NSScrollView``NSClipView`

我建议的第一件事是关闭以下的“绘制背景”属性`NSScrollView`：

```
[myScrollView setDrawsBackground:NO]; 
```

请注意，这应该在 上设置`NSScrollView`，而*不是*在嵌入式上`NSClipView`。

[文档](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/nsscrollview_Class/Reference/Reference.html#//apple_ref/occ/instm/NSScrollView/setDrawsBackground:)中的以下摘录可能是相关的：

> 如果您将发送带有 的参数的消息`NSScrollView`附在中，则具有发送带有参数的消息的附加效果。将消息直接发送到的副作用是在文档视图滚动时出现“轨迹”（先前绘图的痕迹）。`NSClipView``setDrawsBackground:``NO``NSScrollView``NSClipView``setCopiesOnScroll:``NO``setDrawsBackground:``NSClipView`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-24T04:08:49.407

看起来文本字段甚至不在滚动区域中......你确定有什么东西没有重叠吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-01-07T19:58:40.683

我遇到了类似的麻烦 - 当 NSTextView 嵌入另一个滚动视图（即 NSTableView）时，工件就会出现。

我实际上打开*了*setdrawsbackground，然后添加了一个漂亮的颜色让它再次消失。

```
-(void)awakeFromNib{
    NSScrollView *scroll = [self enclosingScrollView];
    [scroll setBorderType:NSNoBorder];
    [scroll setDrawsBackground:YES];
    [scroll setBackgroundColor:[NSColor windowBackgroundColor]];
} 
```

这与 scrollWheel 事件相结合，让我可以在 NSTableView 中使用 NSTextView。

```
-(void)scrollWheel:(NSEvent *)theEvent{
    NSScrollView *scroll = [self enclosingScrollView];
   [[scroll superview] scrollWheel:theEvent];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T23:04:34.237

前段时间我也遇到了同样的麻烦。我不记得我是如何解决的。

如果超级视图是自定义视图，请尝试将 NSTextView 放置到另一个视图。只是看看会发生什么。

# c++ - 使用 C++ (Windows) 在新窗口中启动 URL

> ID：849656
> 
> 赞同：4
> 
> 时间：2009-05-11T19:27:23.627
> 
> 标签：c++, url

如何使用 C++（仅限 Windows）在新窗口中启动 URL？

直接的方法似乎是在现有浏览器窗口中打开一个新选项卡。（或者，如果选项卡式浏览被禁用，新的 URL 会劫持现有的浏览器窗口）。

这是一个（大型）桌面应用程序，使用 MFC 和 Qt。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T21:46:32.790

我已经使用它在默认浏览器中显示本地生成的 html，在我的情况下，文件名类似于“c:\temp\page.html”，也许用 URL 替换文件名可能有效？

```
ShellExecute(NULL,"open",filename,NULL,NULL,SW_SHOWNORMAL); 
```

**更新： http:** [//support.microsoft.com/kb/224816](http://support.microsoft.com/kb/224816)

ShellExecute 如何确定是否启动新实例 ShellExecute 查看注册表时，会查找 shell\open 子项。如果定义了 shell\open\ddeexec 键，则将带有指定应用程序 IExplore 和主题 WWW_OpenURL 的动态数据交换 (DDE) 消息广播到桌面上的所有顶级窗口。响应此消息的第一个应用程序是访问所请求 URL 的应用程序。如果没有应用程序响应此 DDE 消息，则 ShellExecute 使用包含在 shell\open\command 子项中的信息来启动应用程序。然后它重新广播 DDE 消息以转到请求的 URL。

**所以看起来你无法控制打开一个新窗口。当前运行的任何浏览器都可以以他们想要的任何方式打开它。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:30:32.640

这是由窗口控制的。明确告诉它在新浏览器窗口中打开的唯一方法是明确生成浏览器并为其提供 url。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T22:03:44.697

Here's a link to [some code that will open a URL in a new browser](http://www.programmersheaven.com/mb/Win32API/190862/190862/open-a-url-in-a-new-browser-window/?S=B20000). The code looks up the default application for handling an HTML document and then explicitly opens that application with a ShellExecute call.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T23:54:17.077

You can't in general. The user's browser is free to do whatever the user wants it to do.

One way to achieve your desired effect might be to embed a particular browser in a window of your own (say, the IE ActiveX control) and have that render your URL.

# list - 比较haskell中的字符串内容

> ID：849659
> 
> 赞同：3
> 
> 时间：2009-05-11T19:28:37.807
> 
> 标签：list, haskell, comparison

我有 2 个字符串列表，
例如：

```
listx = ["name","age","rank"]
input = ["name","age"] 
```

如何比较两个列表以检查是否`listx`包含`"name"`&`"age"`给出`input`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T20:39:41.030

B 是 A 的子集当且仅当 B \ A 为空

所以另一种方法是

```
import Data.List ((\\))
null (input \\ listx) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T19:48:36.010

```
all (flip elem listx) input 
```

想到了。不知道它的效率如何......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T19:33:13.587

这是作业吗？:)

您需要创建一个或两个递归函数来遍历这两个列表，并搜索输入中的每个字符串。

或者，您可以在 Prelude 中查找一些有用的功能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-12T02:08:18.900

还有一种方法。

```
import Data.Set
(fromList input) `isSubsetOf` (fromList listX) 
```

# windows - 如何阻止“gem”实用程序访问我的主目录？

> ID：849660
> 
> 赞同：19
> 
> 时间：2009-05-11T19:29:04.997
> 
> 标签：windows, ruby, unicode, rubygems

当我跑

```
gem install <somegem> 
```

命令该`gem`实用程序尝试访问我的主目录。它包含一些非拉丁字符，因此安装失败。例如：

```
E:\ruby\bin>gem install <somegem>
ERROR:  While executing gem ... (Errno::ENOENT)
    No such file or directory - C:\Documents and Settings\<user> 
```

如果我使用包含 ASCII 字符的用户名切换到另一个用户帐户，则只能`gem`正常工作。

有人知道如何告诉 gem 不要检查我的主目录吗？

**更新**：我尝试按照下面的建议设置 GEM_HOME 但它没有帮助（仍然检查用户主目录）

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-07-04T22:49:15.100

*只需在运行gem*之前更改 HOMEDRIVE 和 HOMEPATH ，然后恢复（如果需要）。

我已经像这样更改了我的*gem.bat*：

```
@ECHO OFF
SET _HOMEDRIVE=%HOMEDRIVE%
SET _HOMEPATH=%HOMEPATH%
SET HOMEDRIVE=E:
SET HOMEPATH=/Dev/Ruby
IF NOT "%~f0" == "~f0" GOTO :WinNT
@"ruby.exe" "E:/Dev/Ruby/bin/gem" %1 %2 %3 %4 %5 %6 %7 %8 %9
GOTO :EOF
:WinNT
@"ruby.exe" "%~dpn0" %*
SET HOMEDRIVE=%_HOMEDRIVE%
SET HOMEPATH=%_HOMEPATH% 
```

*E:/Dev/Ruby/*是我的 Ruby 路径。似乎可以将 HOMEPATH 更改为路径中仅包含 ASCII 字符的任何其他内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-12T17:23:17.490

写起来更简单：

```
@ECHO OFF
SET HOMEPATH=
IF NOT "%~f0" == "~f0" GOTO :WinNT
ECHO.This version of Ruby has not been built with support for Windows 95/98/Me.
GOTO :EOF
:WinNT
@"ruby.exe" "%~dpn0" %* 
```

在这种情况下，您不需要编写路径，并且可以用文件替换或重新分发以进行新安装

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:48:53.997

也许尝试更改 GEM_HOME 环境目录的值？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T11:28:44.523

如果您将 GEM_PATH 设置为您的用户目录，它仍然会访问它。尝试更改 GEM_HOME 和 GEM_PATH。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-22T16:53:56.847

只需运行安装后文件 pi.bat 或 pi.sh 此文件位于 ./RubyDevKit/postinstall 中。

这对我有用。cygwin 的安装程序似乎破坏了我的设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-05T19:02:55.057

重新启动命令提示符控制台，因为某些东西可能已经将其顶起。我遇到了同样的问题，重新启动控制台会重置我的环境。

# c# - Fluent nhibernate：如何将实体与类型为接口的属性映射？

> ID：849664
> 
> 赞同：3
> 
> 时间：2009-05-11T19:29:27.210
> 
> 标签：c#, nhibernate, fluent-nhibernate, interface, nhibernate-mapping

我有一个像这样的实体：

```
public class Employee
{
    public int ID { get; set; }
    public IAccountManager AccountManager { get; set; }
    ...
} 
```

我还为“DefaultAccountManager”定义了一个映射——IAccountManager 的具体实现。在映射上述“Employee”实体时，我如何告诉 NHibernate 使用“DefaultAccountManager”中定义的映射来持久/加载 AccountManager 属性？

**编辑：** 实际上，如果我可以为 IAccountManager 设置一个映射，以便 NHibernate 可以推断出哪个实现者来加载/持久化，那就更好了。我宁愿不必通过强制所有实现者使用相同的映射来打破多态性。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-09T16:25:41.877

我确实找到了这个问题的答案。我对细节有点模糊，就像几个月前一样，但以下是解决方案的要点：

*   为每个具有映射的 IAccountManager 实现创建一个表。
*   确保您的数据库设置为使用 HiLo id 算法。
*   在映射中使用联合子类

联合子类看起来像这样：

```
<class name="IAccountManager" abstract="true">
  <id name="ID" column="ID" type="Int32">
    <generator class="hilo"/>
  </id>
  <union-subclass name="DefaultAccountManager" table="DefaultAccountManager"
      proxy="IAccountManager">
    <property name="FirstName" type="String"/>
    <property name="LastName" type="String"/>
  </union-subclass>
  ... more implementations
</class> 
```

请注意联合子类上的属性“名称”。这对于 IAccountManager 的每个实现应该是唯一的（并且匹配）。

此外，ID 不会对每个表都是唯一的，而是对所有 IAccountManager 都是唯一的（通过利用 hilo）。

当 NHibernate 看到一个 IAccountManager 实体时，它将使用实例的具体类型和联合子类定义来找出正确的表。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-22T23:37:31.840

只是想我会分享一种我设法使用 Fluent NHibernate 而不是 hbm 文件来实现这一目标的方法。

这种方法有点hacky，但是一旦Fluent NH 获得对Union-Subclass 的适当支持，这些hack 就会被隔离并轻松删除。

要使用您的示例，我的场景的上下文是这样的 - Employee 类位于一个项目中，其中 AccountManager 属性指定为接口，因为具体的 AccountManager 位于另一个我们不想创建依赖项的项目中。

首先，我创建了一个“Helper”类，它完成了大部分 Employee 映射，看起来像这样。

```
public abstract class EmployeeMapperBase
{
    protected abstract Type GetAccountManagerType();

    public void DoMapping(ClassMap<Employee> classMap)
    {
        classMap.Id(x => x.Id);

        classMap.Maps(..... etc....

        classMap.References(x => x.AccountManager)
            .Class(GetAccountManagerType());
    }
} 
```

接下来，在具有具体 AccountManager 类的项目中，我完成了映射：

```
public class EmployeeClassMap : ClassMap<Employee>
{
    public EmployeeClassMap
    {
        new ConcreteEmployeeMapper().DoMapping(this);
    }

    private class ConcreteEmployeeMapper : EmployeeMapperBase
    {
        public override Type GetAccountManagerType()
        {
            return typeof(DefaultAccountManager);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T21:37:39.030

如果您需要多态性，因为 IAccountManager 实现的功能可能具有不同的功能，您可以查看[鉴别](http://blog.jagregory.com/2009/01/05/fluent-nhibernate-subclass-syntax-changes/)器并使用基类而不是接口。

如果您只是使用接口，因为它们是当前的 OOP 范式，那么请三思而后行，因为实体通常几乎没有行为，在这种情况下，接口提供的价值很少（如果有的话）。

# python - Python 2.6 中使用 thread.start_new_thread() 的简单线程

> ID：849674
> 
> 赞同：13
> 
> 时间：2009-05-11T19:32:17.347
> 
> 标签：python, multithreading, python-2.6

我正在关注简单线程的教程。他们给出了这个例子，当我尝试使用它时，我从解释器那里得到了难以理解的错误。你能告诉我为什么这不起作用吗？我正在使用带有 Python 2.6 的 WinXP SP3

```
import thread

def myfunction(mystring,*args):
    print mystring

if __name__ == '__main__':

    try:

        thread.start_new_thread(myfunction,('MyStringHere',1))

    except Exception as errtxt:
        print errtxt 
```

执行这会导致::

由 sys.excepthook 中的错误启动的线程中未处理的异常：

原来的例外是：

错误中缺少的信息*实际上*在输出中丢失了。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-11T19:53:08.623

问题是您的主线程在您的新线程有时间完成之前已经退出。解决方案是在您的主线程处等待。

```
import thread, time

def myfunction(mystring,*args):
    print mystring

if __name__ == '__main__':

    try:

        thread.start_new_thread(myfunction,('MyStringHere',1))

    except Exception, errtxt:
        print errtxt

    time.sleep(5) 
```

附带说明一下，您可能想要使用 threading 模块。您的主线程将等待所有这些类型的线程在退出之前关闭：

```
from threading import Thread

def myfunction(mystring,*args):
    print mystring

if __name__ == '__main__':

    try:
        Thread(target=myfunction, args=('MyStringHere',1)).start()
    except Exception, errtxt:
        print errtxt 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-11T20:19:04.917

你需要等到你的 Thread 完成它的工作，所以你必须使用 Thread.join() ：

```
from threading import Thread

def myfunction(mystring,*args):
    print mystring

if __name__ == '__main__':

    try:
        t = Thread(None,myfunction,None,('MyStringHere',1))
        t.start()
        t.join()
    except Exception as errtxt:
        print errtxt 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-17T11:38:56.107

```
import thread

def myfunction(mystring,*args):
    print mystring

if __name__ == '__main__':

    try:

        thread.start_new_thread(myfunction,('MyStringHere',1))

    except Exception as errtxt:
        print errtxt

while 1:
    pass 
```

最后放 while 循环然后它会为你工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T19:38:35.730

更改后，我在 Mac 上的 Python 2.5 中尝试过

```
except Exception as errtxt: 
```

至

```
except Exception, errtxt: 
```

该程序没有抛出异常，但也没有打印任何内容。不确定这是否有帮助，但我确实觉得它很好奇......

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-11T19:38:51.220

当我在 Python 2.6 中运行此代码时，它起作用了，您是否有可能已经打开了锁定在该函数上的线程？我建议完全关闭 Python，检查正在运行的进程以确保没有任何进程在运行，然后重试。

# postgresql - 重构 PostgreSQL SProcs

> ID：849675
> 
> 赞同：0
> 
> 时间：2009-05-11T19:32:32.043
> 
> 标签：postgresql, refactoring, user-defined-functions

通过适度的 PostgreSQL 安装，我们积累了相当多的存储过程/函数和类型。

现在在最低级别的复合类型中（即用它构建了 3 种类型，并且无数函数引用了这些类型中的任何一种）类型的一个元素是**错误的类型**（即 smallint 而不是 bigint），因此处理它是相同的，只有范围不同。

1.  我如何知道取决于类型的所有类型（pg_catalog.pg_type 似乎不够）？
2.  我如何知道取决于类型的所有函数（作为参数和本地范围的变量）？
3.  我可以重构一个复合类型（可能将 smallint 更改为 bigint）而不依赖它删除/重建每个函数吗？
4.  这种重构是否有任何类型的自动化/工具/最佳实践？

我知道它的 4 个问题合而为一，但是 atm 这有点令人沮丧，任何帮助将不胜感激！非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:13:01.113

系统目录“pg_depend”包含一些有用的依赖信息。您可以根据特定类型找到对象，如下所示：

```
select * from pg_depend where refclassid = 'pg_type'::regclass
    and refobjid = 'information_schema.sql_identifier'::regtype; 
```

这会查找依赖于“information_schema.sql_identifier”类型的对象。结果，classid 是目录的 OID——例如，对于取决于用户类型的列，classid 是 'pg_class'::regclass，objid 是 pg_class 行的 OID，objsubid 是来自 pg_attribute 的 attnum 值，因此对于这种情况，您可以像这样格式化结果：

```
select objid::regclass, attname from pg_depend
    join pg_attribute on pg_attribute.attrelid = pg_depend.objid and pg_attribute.attnum = pg_depend.objsubid
where refclassid = 'pg_type'::regclass and refobjid = 'information_schema.sql_identifier'::regtype
    and classid = 'pg_class'::regclass
limit 10 
```

所以在 pg_depend 中，`(classid,objid,objsubid)`描述一些依赖于`(refclassid,refobjid)`.

# sql-server-2005 - 将 SQL Server 2008 降级到 SQL Server 2005

> ID：849678
> 
> 赞同：6
> 
> 时间：2009-05-11T19:33:25.490
> 
> 标签：sql-server-2005, sql-server-2008, database-backups, downgrade

从 SQL Server 2008 备份数据库，然后将其导入 SQL Server 2005 是否有任何问题？我已经升级到 SQL Server 2008，但是 2008 似乎问题太大，所以现在我想降级。这样做有什么问题吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T19:38:31.707

那么，您将无法将 2008 备份恢复到 SQL 2005 服务器。

最简单的方法是使用“生成 SQL Server 脚本”向导创建一个脚本（包括架构和数据），您可以在 SQL 2005 上运行该脚本来创建数据库。见[http://www.devx.com/dbzone/Article/40531](http://www.devx.com/dbzone/Article/40531)

但回到最初的问题：您在使用 SQL 2008 时遇到了什么问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:52:34.723

另一种方法是通过对象资源管理器连接到两台服务器并将数据从一个导入到另一个。

但是，执行此操作时，有些内容无法正确传输。例如，我必须手动重置主键和外键设置，以及自动增量设置。不过，要让所有数据正常工作，这是一个很小的代价。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:08:02.953

我同意这是什么问题？如果它与应用程序有关，你能不能在 SQL 2005 兼容模式下运行数据库。如果您必须移动到 2005，您不能只将数据库从 08 恢复到 05。

如果您有一个大于 50mb 左右的数据库，我将使用脚本生成向导为您的数据库模式编写脚本，为您的所有键、索引、触发器、排序规则和任何没有数据的全文索引编写脚本。只需记住检查 sql 2005 版本选项的脚本即可。运行该脚本以在 sql server 2005 上创建一个新数据库。

如果您的表上有触发器，您将希望在导入数据之前将它们全部禁用。这些脚本将为您做到这一点。这些将为您做到这一点

```
-- Disable Triggers
While @i <= @MaxI
Begin
      Select @dsql =  'DISABLE Trigger ' + TriggerName + ' ON ' + TableName
      From @DisableTriggers
      Where MyRowCount = @i
      Exec sp_executesql @dsql
      Select @i = @i + 1
End

-- Enable Triggers
While @i <= @MaxI
Begin
      Select @dsql =  'Enable Trigger ' + TriggerName + ' ON ' + TableName
      From @DisableTriggers
      Where MyRowCount = @i
      Exec sp_executesql @dsql
      Select @i = @i + 1
End 
```

然后使用导入/导出向导将数据导入您的数据库；根据我的经验，这比编写脚本要快得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-14T08:56:34.330

您无法恢复从 SQL Server 2008 获取的 SQL Server 数据库备份并在 SQL Server 2005 上恢复它，因为 Microsoft 不支持此操作。要了解更多为什么不能将数据库从较高版本恢复到较低版本，请阅读以下**[文章](http://www.mytechmantra.com/LearnSQLServer/Unable_to_Restore_Database_From_Backup.html)**。如果要降级数据库，则可以使用 SQL Server Integration Services。**[以下文章](http://www.mytechmantra.com/LearnSQLServer/Downgrade_SQL_Server_Database_P1.html)**中提到了将 SQL Server 2008 数据库降级到 SQL Server 2005 的示例。

# sqlite - SQLite 中的临时内存数据库

> ID：849679
> 
> 赞同：20
> 
> 时间：2009-05-11T19:33:37.487
> 
> 标签：sqlite, jdbc

是否有可能以某种方式在 SQLite 中创建内存数据库，然后仅通过一些查询将其销毁？

我需要这样做以对我的数据库层进行单元测试。到目前为止，我只通过创建普通的 SQLite db 文件并在所有测试后删除 if 来工作，但是在内存中完成这一切会好得多。

那么是否可以仅在内存中实例化数据库而不向磁盘写入任何内容？我不能只使用事务，因为我想创建全新的数据库。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-11T19:35:21.070

使用文件名 ":memory:": [In-Memory Databases](http://www.sqlite.org/inmemorydb.html)创建它。

一旦与它的连接关闭，它就会不复存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-09-29T00:37:38.607

作为内存数据库的替代方案，您可以使用空字符串作为文件名来创建[SQLite 临时数据库。](https://www.sqlite.org/inmemorydb.html)当连接关闭时，它将被删除。与内存数据库相比，优势在于您的数据库不受可用内存的限制。

或者，您可以在临时文件中创建数据库并让操作系统清理它。这具有便于检查的优点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T19:40:40.593

我建议在某处安装一个 tmpfs 文件系统（仅限 RAM 文件系统）并将其用于您的单元测试。

像往常一样实例化 DB 文件，然后使用 rm 将它们吹走——但没有任何东西进入磁盘。

（编辑：很好 - 有人打败了我，得到了正确的答案；）不管怎样，把它留在这里作为另一个选择）

# django - 使用 Django 通用视图从 create_object 创建的新对象中检索密钥

> ID：849681
> 
> 赞同：1
> 
> 时间：2009-05-11T19:34:20.650
> 
> 标签：django, google-app-engine, views, generics

我的代码如下所示：

```
def add_cart(request):
    return create_object(request, form_class=CartForm,
    post_save_redirect=reverse('test.views.show_cart',
                               kwargs=dict(object_id='%(key)s'))) 
```

理想情况下，我希望它看起来像这样：

```
def add_cart(request):
    newobject = create_object(request, form_class=CartForm,
    post_save_redirect=reverse('test.views.show_cart',
                               kwargs=dict(object_id='%(key)s'))) 
    request.session['cartid'] = newobject.key
    return newobject 
```

如何从新创建的对象中检索密钥？

我正在使用带有所有最新版本的 google-app-engine-patch。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T18:20:56.427

当前的通用视图，包括 create_object，不提供挂钩来对创建的对象进行额外处理。所以如果你想这样做，你必须滚动你自己的创建视图，这真的不是很难。

当 Django 1.2 推出时，我们应该获得基于类的通用视图，这将更容易挂钩额外的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T00:58:26.580

在 Django 下，您可以使用

```
newobject.id 
```

或者

```
newobject.pk 
```

我建议使用*.pk*。

请记住，*newobject.pk*并不总是与*newobject.id*相同。

# sql-server - 关系数据库设计模式问题 - 海量只读数据库

> ID：849682
> 
> 赞同：0
> 
> 时间：2009-05-11T19:34:25.427
> 
> 标签：sql-server

我有一个有趣的挑战，那就是构建一个从大约 500 个不同来源导入数据的数据库。

每个来源都有自己的模式，而且很多都非常不同。然而，它们都是关于一个共同实体的数据。

我的第一个想法是典型的实体/属性/值模式，但是在将非规范化导入从一个源（550k 行）转换为 AEV 后，我最终在 Attribute_Value 表中有 3600 万行。使用适当的索引，这仍然非常快，但这只是迄今为止 500 个导入源中的一个。

我不认为这会扩展，但是它确实可以实现非常好的逻辑分区，我们不需要跨导入源加入，因此我们可以构建（理论上）50 个左右的独立数据库。

我正在寻找那些使用过大量数据源的人，以及他们在行数达到数亿时如何处理事情的经验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:36:57.637

您是否考虑过 OLAP 解决方案？它们可能是为像您这样的情况而设计的。需要读取和分析的大量数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T19:50:27.800

我有十亿多行表，行数并不像碎片级别和表本身的宽度那么重要，表越宽，页面上的容量就越小

除了 OLAP/SSAS 你看过使用分区函数吗（sql server 2005 中的新功能）

您还可以利用页面和行级压缩（sql server 2008 中的新功能）这将帮助您将更多数据存储到 RAM 中，我自己进行了压缩测试，查看此链接以查看它与不压缩相比如何[快速查看 SQL 2008 中的压缩](http://sqlblog.com/blogs/denis_gobo/archive/2009/04/07/13137.aspx)

# java - 内部组件的JPanel大小

> ID：849684
> 
> 赞同：23
> 
> 时间：2009-05-11T19:35:57.483
> 
> 标签：java, user-interface, swing

是否可以告诉 JPanel 设置其大小以适合它包含的所有组件？类似于`pack()`JFrame 的东西。

编辑：preferredSize 的技巧没有帮助。我有 JSplitPane，其中一部分是带有许多标签的 GridBagLayout（参见屏幕截图），并且标签相互重叠。

[截图 http://foto.darth.cz/pictures/screen.png](http://foto.darth.cz/pictures/screen.png)

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-11T19:53:38.310

在查看源代码后`pack()`，我想出了：

```
 panel.setPreferredSize(panel.getPreferredSize()); 
```

这迫使面板根据其子组件的首选大小重新计算其首选大小。

之后您可能需要也可能不需要打电话[`validate()`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#validate())；在我的小例子中，它似乎没有什么区别，但 Javadoc 说：

> 该`validate`方法用于使容器重新布置其子组件。在容器显示后修改此容器的子组件（添加到容器或从容器中删除，或更改布局相关信息）时，应调用它。

所以我想这取决于你为什么要重新打包你的`JPanel`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T20:04:50.943

默认情况下`Container`s 具有与容器给出的首选布局大小相匹配的首选大小。所以从字面上看，你所要做的就是：

```
panel.setSize(panel.getPreferredSize()); 
```

大概你正在对父母做一些奇怪的事情来阻止父母的布局管理器做同样的事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T19:44:24.737

也许您可以通过从面板中删除来做类似的事情

可调整大小（假）；

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T21:11:29.977

我会尝试：

```
panel.revalidate();
panel.repaint(); 
```

这不一定会将面板设置为其首选大小，这更取决于布局管理器决定使用的大小。

这在您从当前显示和可见的面板中添加/删除组件的情况下很有用。

更新：根据您的屏幕截图，我可以说以下内容：1）考虑以编程方式更改分隔线位置。2）考虑以编程方式水平调整窗口本身的大小，因为显示拆分窗格的两侧似乎有点紧。或两者。您可以通过执行设置分隔线位置

```
splitPane.setDividerLocation(newSize); 
```

请记住，有两种重载方法，一种采用浮点数，另一种采用 int。float 占大小的百分比，而 int 是以像素为单位的大小。该尺寸适用于左侧面板（或该方向的顶部面板）。我会考虑根据面板的首选宽度更改分隔线的位置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-07-07T00:30:56.270

**我在使用Netbeans GUI Builder**时遇到了类似的问题。我的内面板变得奇怪的尺寸；我试图手动调整最小和首选尺寸，这是一个令人沮丧的练习。

当我**将所有最小和首选大小重置为默认值**时，问题就解决了（在 Netbeans GUI Builder 中：右键单击 JPanel 组件 -> 属性 -> 首选大小 -> 重置为默认值）。*当没有强制大小时，jpanel 采用内部组件的大小。*

*注意：在我的案例中使用了 GridBaLayout*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T23:01:29.137

JSplitPanes 在涉及其子项的大小时有点挑剔，请查看[Java 教程](http://java.sun.com/docs/books/tutorial/uiswing/components/splitpane.html#divider)。您是否正确使用了 GridBagLayout？看起来它没有正确设置正确的 JPanel 的最小尺寸。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-05T17:26:27.923

javax.swing 的奥秘只会逐渐显现，而且只会向那些准备向 Swing 之神献上许多祭品（尤其是撕掉的头发、熬夜等）的人揭开。

但是，对于这种情况，我建议将以下内容作为一种瑞士军刀，它通常会做你认为框架应该做的事情：

```
myJPanel.getTopLevelAncestor().validate() 
```

正如神圣文本所说，“验证这个容器及其所有子组件。” （容器。验证）。注意 getTopLevelAncestor() 是一个 JComponent 方法。

不记得 JSplitPane 是如何适应这种情况的：尝试一下，您可能会发现它验证了两个组件（左右、顶部和底部），但如果更改分隔符对您没有这样做，我会感到惊讶.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-11-27T00:39:58.320

这是一个面板示例：

*   与它的父母一起调整大小。
*   将宽度设置为父级的宽度。
*   根据所有子项的高度之和设置高度。

```
JPanel panel = JPanel(new GridBagLayout())

panel.setMaximumSize(new Dimension(panel.getMaximumSize().width, panel.getPreferredSize().height))

panel.validate()
panel.repaint() 
```

# jquery - What is the best way to submit disabled inputs as part of a jQuery Ajax request?

> ID：849693
> 
> 赞同：18
> 
> 时间：2009-05-11T19:37:05.717
> 
> 标签：jquery

I have a pretty complex form that provides real-time validation and feedback to the user using it as they type in data. Parts of the form may be disabled due to form "business logic" of the inputs, but the server side needs to know the value of these disabled inputs to do some of its checking in the Ajax requests.

I was using jQuery to serialize the entire form, $(form).serialize(), and sending all of this data to the server during my Ajax requests, but this serialized data will be missing any inputs that are disabled. So what is the best way to include all of the form data (even disabled inputs) with each Ajax request?

My current thought is to attach a function to ajaxStart (callback) that would create a client side hash-map of all form inputs' disabled attribute, enable all the inputs, serialize, and then set each form's disabled attribute back to its original value. But this seems overly complex, and I wanted something simpler that wouldn't be as brittle.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-11T20:02:02.103

Try doing something like this to serialize the form:

```
 $(function() {
      $('input[type=button]').click( function() {
          var form = $('form').serialize();
          $('input[disabled]').each( function() {
              form = form + '&' + $(this).attr('name') + '=' + $(this).val();
          });

      });
   }); 
```

Test HTML

```
<form action="/action">
   <input type='text' disabled='disabled' value='hey' id='hey' name='hey' />
   <input type='text' value='ho' id='ho' name='ho' />
   <input type='text' value="hi" id='hi' name='hi' />
   <input type='button' value="Serialize" />
</form> 
```

Output

```
ho=ho&hi=hi&hey=hey 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-12-29T03:04:09.680

> Parts of the form may be disabled due to form "business logic" of the inputs

You can use "readonly" attribute to disable those input fields. Do like this:

```
<input type="text" readOnly="readOnly" /> 
```

> The readonly attribute specifies that an input field should be read-only. A read-only field cannot be modified. However, a user can tab to it, highlight it, and copy the text from it.

from: [HTML input readonly Attribute](http://www.w3schools.com/tags/att_input_readonly.asp)

A read-only field also can be submitted to server as query string.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T20:04:40.603

If your server accepts JSON, you can create a JSON object with jQuery (use jQuery select statements to include the necessary input tags), then send it to the server as an object - more information here: [http://encosia.com/2009/04/07/using-complex-types-to-make-calling-services-less-complex/](http://encosia.com/2009/04/07/using-complex-types-to-make-calling-services-less-complex/).

Basically, do something like this:

```
var formInputs = { };

$('input[type=text]').each(function() {
  formInputs[this.id] = this.value;
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-25T11:24:34.820

Well another option is to simply add a **hidden field** with the value you wan't posted to the server.

Remember to use a **different** (dummy) id for the tag that you disable to avoid any conflict.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-22T14:25:46.527

To send the disabled value to the backend using .serilize() through a form submit using jQuery to Ajax, it is:

```
<HTML>
    <HEAD>
        <script>
            $(document).ready(function(){
                $("#submid").click(function() { // loginForm is submitted
                    $('#ayyappa').removeAttr('disabled');
                    $.ajax({
                        url: "urls",
                        data:{
                            "sel_opt": $("#ayyappa").attr("value"),
                        }

                    }); // Ajax
                    $("#Number").attr("disabled", "disabled");
                }); // Click
            });
        </script>
    </HEAD>

    <BODY>
        <input type='text' id="ayyappa"  name='ayyappa' value="ayyappa" disabled>
    </BODY>
</HTML> 
```

# c# - 从 Com Interop 程序集中查找 COM DLL 路径

> ID：849701
> 
> 赞同：3
> 
> 时间：2009-05-11T19:39:12.080
> 
> 标签：c#, .net, com

我正在尝试围绕旧 COM 对象编写一个包装器并将该包装器安装到 GAC 中。目标是自动设置组件所需的特定配置信息，并为我的所有应用程序使用通用的强类型接口。

到目前为止，我的解决方案是将 XML 配置文件保存在与原始 COM DLL 相同的目录中，并在类构造函数中加载配置。不幸的是，我一直无法找到注册的 COM dll 的位置...

如何获取 COM 对象互操作 dll 引用的 COM dll 的完整文件路径？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:00:26.380

大概您可以从映射到 COM DLL 的 CLSID 和 IID 值的互操作 DLL 中获取[`GuidAttribute`](http://social.msdn.microsoft.com/Search/en-US/?query=GuidAttribute)or值。[`CoClassAttribute`](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.coclassattribute.aspx)然后您可以在注册表中查找相应的 DLL 路径。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T06:11:15.633

从相应的 COM 服务器创建对象后，它的 DLL 必须已加载。假设底层 COM 服务器是在“mycomserver.dll”中实现的，您可以使用 P/Invoke 并调用 GetModuleHandle("mycomserver.dll")——它会为您提供 DLL 的路径。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-12-05T00:52:06.040

如果您知道 COM dll 的 CLSID，您可以检查是否存在具有该 CLSID 的密钥`HKEY_CLASSES_ROOT\CLSID\{CLSID-of-your-COM-component}`或`HKEY_CLASSES_ROOT\Wow6432Node\CLSID\{CLSID-of-your-COM-component}`（Wow6432Node => 在 64 位机器上注册的 32 位 COM）

如果 key 在那里，则表示 COM 组件已注册。然后查看子键里面的默认值`InprocServer32`

例如

*   `HKEY_CLASSES_ROOT\CLSID\{12345678-9012-3456-7890-123456789012}\InprocServer32`
*   `HKEY_CLASSES_ROOT\Wow6432Node\CLSID\{12345678-9012-3456-7890-123456789012}\InprocServer32`

如果有帮助，这里是一个如何使用 C# 打开这些键的参考示例（您只需检查 中的值`InprocServer32`）：[如何检查 COM dll 是否使用 C# 注册？](https://stackoverflow.com/questions/4966508/how-to-check-com-dll-is-registered-or-not-with-c/34099852#34099852)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2016-09-19T11:09:23.387

只反映`AddIn`班级。

```
var t = typeof(ThisAddIn);
var path = t.Assembly.CodeBase; 
```

# c# - 静态类与实例化类

> ID：849706
> 
> 赞同：1
> 
> 时间：2009-05-11T19:39:33.140
> 
> 标签：c#, static, state, instance

## 复制

> [*可以*是静态的 C# 方法应该是静态的吗？](https://stackoverflow.com/questions/731763/should-c-methods-that-can-be-static-be-static/731779#731779)

* * *

如果这个问题看起来很简单，请原谅我 - 我正在查看一些看起来不错的源代码，但它提出了一些问题......

如果给定的类没有成员数据 - 即它不维护任何类型的状态，那么不将该类标记为具有静态方法的静态类有什么好处吗？

不将不保持状态的方法标记为静态有什么好处吗？

谢谢！

编辑：由于有人提出，我正在查看的代码是用 c# 编写的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T19:42:33.120

是的。我能想到一些原因：

1.  易于模拟和单元测试
2.  易于添加状态
3.  你可以传递它（作为一个`interface`或什么）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T19:43:46.143

我想说使它们成为类的静态方法是有好处的，最重要的是使类抽象。这样，程序员就很清楚，这个类从来没有被实例化过，并且方法仍然可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T19:44:02.103

*如果您打算（或认为您可能打算）从类继承并使用确实更改状态的代码覆盖这些方法，那么将不*更改状态的方法保留为非静态方法可能会有好处。虽然在那种情况下它真的应该是一个抽象类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T19:50:23.573

如果一个类不维护任何状态，没有任何实例方法，并且可以完全用类方法实现，我通常会仔细研究它的行为是否实际上在其他地方更有意义。我发现它们通常似乎有很多类似 的方法`doSomethingWithItem(Item item)`，这在`Item`.

是的，我知道这不能回答你的问题，但我认为其他人已经很好地涵盖了这一点，我想从另一个角度出发。

# java - 速度和 log4J 错误

> ID：849710
> 
> 赞同：18
> 
> 时间：2009-05-11T19:41:03.213
> 
> 标签：java, servlets, log4j, stack-trace, velocity

我构建了一个在我的本地主机（tomcat）中运行良好的 web 应用程序。但是当我尝试部署时，velocity 在 init() 中崩溃，在这里留下了这个奇怪的堆栈跟踪（对不起大小）：

```
 ERROR [main] (VelocityConfigurator.java:62) - Error initializing Velocity!
org.apache.velocity.exception.VelocityException: Failed to initialize an instance of org.apache.velocity.runtime.log.Log4JLogChute with the current runtime configuration.
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:206)
    at org.apache.velocity.runtime.log.LogManager.updateLog(LogManager.java:255)
    at org.apache.velocity.runtime.RuntimeInstance.initializeLog(RuntimeInstance.java:795)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:250)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:589)
    at org.apache.velocity.runtime.RuntimeSingleton.init(RuntimeSingleton.java:229)
    at org.apache.velocity.app.Velocity.init(Velocity.java:107)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.initVelocity(VelocityConfigurator.java:57)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.configure(VelocityConfigurator.java:42)
    at com.webcodei.velociraptor.VelociListener.contextInitialized(VelociListener.java:26)
    at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3827)
    at org.apache.catalina.core.StandardContext.start(StandardContext.java:4336)
    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:761)
    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:741)
    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
    at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:626)
    at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:553)
    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:488)
    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138)
    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:120)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1023)
    at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1015)
    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
    at org.apache.catalina.core.StandardService.start(StandardService.java:448)
    at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
    at org.apache.catalina.startup.Catalina.start(Catalina.java:552)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
Caused by: java.lang.RuntimeException: Error configuring Log4JLogChute : 
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    at org.apache.velocity.util.ExceptionUtils.createWithCause(ExceptionUtils.java:67)
    at org.apache.velocity.util.ExceptionUtils.createRuntimeException(ExceptionUtils.java:45)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:133)
    at org.apache.velocity.runtime.log.Log4JLogChute.init(Log4JLogChute.java:85)
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:157)
    ... 33 more
Caused by: java.io.FileNotFoundException: velocity.log (Permission denied)
    at java.io.FileOutputStream.openAppend(Native Method)
    at java.io.FileOutputStream.(FileOutputStream.java:177)
    at java.io.FileOutputStream.(FileOutputStream.java:102)
    at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)
    at org.apache.log4j.RollingFileAppender.setFile(RollingFileAppender.java:194)
    at org.apache.log4j.FileAppender.(FileAppender.java:109)
    at org.apache.log4j.RollingFileAppender.(RollingFileAppender.java:72)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:118)
    ... 35 more
ERROR [main] (VelocityConfigurator.java:63) - java.lang.RuntimeException: Error configuring Log4JLogChute : 
org.apache.velocity.exception.VelocityException: Failed to initialize an instance of org.apache.velocity.runtime.log.Log4JLogChute with the current runtime configuration.
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:206)
    at org.apache.velocity.runtime.log.LogManager.updateLog(LogManager.java:255)
    at org.apache.velocity.runtime.RuntimeInstance.initializeLog(RuntimeInstance.java:795)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:250)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:589)
    at org.apache.velocity.runtime.RuntimeSingleton.init(RuntimeSingleton.java:229)
    at org.apache.velocity.app.Velocity.init(Velocity.java:107)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.initVelocity(VelocityConfigurator.java:57)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.configure(VelocityConfigurator.java:42)
    at com.webcodei.velociraptor.VelociListener.contextInitialized(VelociListener.java:26)
    at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3827)
    at org.apache.catalina.core.StandardContext.start(StandardContext.java:4336)
    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:761)
    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:741)
    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
    at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:626)
    at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:553)
    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:488)
    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138)
    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:120)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1023)
    at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1015)
    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
    at org.apache.catalina.core.StandardService.start(StandardService.java:448)
    at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
    at org.apache.catalina.startup.Catalina.start(Catalina.java:552)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
Caused by: java.lang.RuntimeException: Error configuring Log4JLogChute : 
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    at org.apache.velocity.util.ExceptionUtils.createWithCause(ExceptionUtils.java:67)
    at org.apache.velocity.util.ExceptionUtils.createRuntimeException(ExceptionUtils.java:45)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:133)
    at org.apache.velocity.runtime.log.Log4JLogChute.init(Log4JLogChute.java:85)
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:157)
    ... 33 more
Caused by: java.io.FileNotFoundException: velocity.log (Permission denied)
    at java.io.FileOutputStream.openAppend(Native Method)
    at java.io.FileOutputStream.(FileOutputStream.java:177)
    at java.io.FileOutputStream.(FileOutputStream.java:102)
    at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)
    at org.apache.log4j.RollingFileAppender.setFile(RollingFileAppender.java:194)
    at org.apache.log4j.FileAppender.(FileAppender.java:109)
    at org.apache.log4j.RollingFileAppender.(RollingFileAppender.java:72)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:118)
    ... 35 more
ERROR [main] (VelocityConfigurator.java:64) - Failed to initialize an instance of org.apache.velocity.runtime.log.Log4JLogChute with the current runtime configuration.
org.apache.velocity.exception.VelocityException: Failed to initialize an instance of org.apache.velocity.runtime.log.Log4JLogChute with the current runtime configuration.
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:206)
    at org.apache.velocity.runtime.log.LogManager.updateLog(LogManager.java:255)
    at org.apache.velocity.runtime.RuntimeInstance.initializeLog(RuntimeInstance.java:795)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:250)
    at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:589)
    at org.apache.velocity.runtime.RuntimeSingleton.init(RuntimeSingleton.java:229)
    at org.apache.velocity.app.Velocity.init(Velocity.java:107)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.initVelocity(VelocityConfigurator.java:57)
    at com.webcodei.velociraptor.velocity.VelocityConfigurator.configure(VelocityConfigurator.java:42)
    at com.webcodei.velociraptor.VelociListener.contextInitialized(VelociListener.java:26)
    at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3827)
    at org.apache.catalina.core.StandardContext.start(StandardContext.java:4336)
    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:761)
    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:741)
    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
    at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:626)
    at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:553)
    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:488)
    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138)
    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:120)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1023)
    at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1015)
    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
    at org.apache.catalina.core.StandardService.start(StandardService.java:448)
    at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
    at org.apache.catalina.startup.Catalina.start(Catalina.java:552)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
Caused by: java.lang.RuntimeException: Error configuring Log4JLogChute : 
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    at org.apache.velocity.util.ExceptionUtils.createWithCause(ExceptionUtils.java:67)
    at org.apache.velocity.util.ExceptionUtils.createRuntimeException(ExceptionUtils.java:45)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:133)
    at org.apache.velocity.runtime.log.Log4JLogChute.init(Log4JLogChute.java:85)
    at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:157)
    ... 33 more
Caused by: java.io.FileNotFoundException: velocity.log (Permission denied)
    at java.io.FileOutputStream.openAppend(Native Method)
    at java.io.FileOutputStream.(FileOutputStream.java:177)
    at java.io.FileOutputStream.(FileOutputStream.java:102)
    at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)
    at org.apache.log4j.RollingFileAppender.setFile(RollingFileAppender.java:194)
    at org.apache.log4j.FileAppender.(FileAppender.java:109)
    at org.apache.log4j.RollingFileAppender.(RollingFileAppender.java:72)
    at org.apache.velocity.runtime.log.Log4JLogChute.initAppender(Log4JLogChute.java:118)
    ... 35 more 
```

有谁知道解决方法？或者至少理解错误？我做了一些谷歌搜索但没有任何线索..只有这个[页面](http://www.nabble.com/org.apache.velocity.runtime.log.Log4JLogChute-initialization-failed-td22099662.html)面临同样的问题但没有解决方案..

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2012-08-18T06:48:38.543

Velocity 尝试将日志文件放在启动 Tomcat 的目录中，我相信这实际上是 /。

您可以通过将这些行添加到您的 velocity.properties 来强制 Velocity 记录到 Tomcat 的标准日志：

```
runtime.log.logsystem.class=org.apache.velocity.runtime.log.SimpleLog4JLogSystem
runtime.log.logsystem.log4j.category=velocity
runtime.log.logsystem.log4j.logger=velocity 
```

velocity.properties 应该进入 /WEB-INF/velocity.properties 但您可以在 web.xml 中的 servlet 定义中覆盖它。

如果您通过属性而不是 velocity.properties 来初始化 Velocity：

```
VelocityEngine engine = new VelocityEngine();

Properties props = new Properties();
props.put("runtime.log.logsystem.class", "org.apache.velocity.runtime.log.SimpleLog4JLogSystem");
props.put("runtime.log.logsystem.log4j.category", "velocity");
props.put("runtime.log.logsystem.log4j.logger", "velocity");

engine.init(props); 
```

在这里阅读更多：

[http://velocity.apache.org/engine/devel/developer-guide.html#usinglog4jwithexistinglogger](http://velocity.apache.org/engine/devel/developer-guide.html#usinglog4jwithexistinglogger)

和这里：

[http://minaret.biz/tips/tomcatLogging.html#velocity](http://minaret.biz/tips/tomcatLogging.html#velocity)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-11T19:50:50.313

我认为这条线有答案。看起来创建velocity.log 文件时出现问题。你的配置文件是什么样的？

```
Caused by: java.io.FileNotFoundException: velocity.log (Permission denied) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T19:48:40.503

似乎尝试打开日志文件的进程没有这样做的权限：

```
Caused by: java.io.FileNotFoundException: velocity.log (Permission denied) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-22T11:19:00.227

我也有同样的问题，但我能够解决此问题，将默认日志文件覆盖为自定义日志文件。只需在调用评估函数的方法中添加这 3 行代码。

```
Velocity.setProperty(RuntimeConstants.RUNTIME_LOG_LOGSYSTEM_CLASS,"org.apache.velocity.runtime.log.Log4JLogChute");

Velocity.setProperty("runtime.log.logsystem.log4j.logger","com.mindtree.igg.website.email.TemplateMergeUtilVelocityImpl");

VelocityContext velocityContext = new VelocityContext(parameters); 
```

这是解决它的一种方法，即不使用属性文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-03-31T19:54:56.327

我的代码遇到了完全相同的问题，经过数小时的谷歌搜索，我决定在我的项目中添加一些其他 Velocity 库。我的项目只有 apache-velocity jar 文件，然后从[这里](http://mvnrepository.com/search?q=velocity)，我还将 Velocity-Dep 添加到我的 Maven 项目和 Yesssssssssss！胜利！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-07-02T17:43:05.433

我遇到了同样的问题，并写了一篇描述性博客，其中包含可能的原因和解决方案。这是[链接](http://techieme.in/failed-to-initialize-an-instance-of-org-apache-velocity-runtime-log-servletlogchute-with-the-current-runtime-configuration/)

# c++ - TextBox 让 '\n' 为回车

> ID：849711
> 
> 赞同：0
> 
> 时间：2009-05-11T19:41:07.987
> 
> 标签：c++, winapi

由 "CreateWindowEx(WS_EX_CLIENTEDGE, "EDIT", "", ES_MULTILINE.." 创建的文本框需要 \r\n 换行。我将我的标准输出重定向到该文本框，它仅使用 '\n' 来指示新行。而且我不愿意用 '\r\n' 替换所有 '\n' 是否有办法让 '\n' 在文本框中换行？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:54:05.143

我很确定您要问的是不可能的（即没有使 Windows 编辑控件接受 Unix 样式的换行符的神奇设置）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:09:06.930

不确定您使用的是什么语言，但为什么不这样做（VB.NET 示例）：

```
TextBox1.Text=TextBox1.Text.Replace("\r\n","\n") 
```

那应该只用“\n”替换所有“\r\n”出现

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:48:06.493

\r\n 不是新行。这是一个回车+换行。它们是不同的东西。不过，对于在控制台世界工作的人来说，这可能意味着更多，因为您可以转到新行而无需回到角色位置 1。

# java - 将参数传递给 tomcat 实例的最佳方法是什么？

> ID：849713
> 
> 赞同：1
> 
> 时间：2009-05-11T19:41:39.687
> 
> 标签：java, tomcat, jakarta-ee

将参数传递给 tomcat 实例的最佳方法是什么？命令行参数是否可用于容器内的所有应用程序？我可以将参数传递给特定的应用程序吗？我需要通过内置的应用服务器来管理它吗？

**编辑：** 为了澄清，我希望传递一个参数来指定要使用的配置。有时这可能会指定一组配置文件，这些文件可能因环境而异。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T20:26:16.103

您可以添加 -Dmy.config.var=configA 和 -Dmy.config.var=configB 并添加到 CATALINA_OPTS（每次都需要）并通过 System.getProperty("my.config.var") 从 java 中读取它们。这些不是环境变量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:36:52.750

我相信配置它的最佳方法是使用 server.xml 和 context.xml 文件。这是添加 JNDI 配置的地方。您可以为每个应用程序拥有不同的 context.xml 文件。在您的 WAR 文件中，将其放在 META-INF 目录中，Tomcat 将导入它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:03:00.683

一切都可以通过标准的Java Properties机制看到通用的系统环境。此外，环境变量 CATALINA_OPTS 可用于将参数传递给 JVM。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T20:44:10.227

需要神奇地进入 Web 应用程序的东西应该放在 JNDI 中。这使您可以将对象放入和检索到某个外部的“全局哈希表”中。

如果您只需要一个配置文件名，则传入一个属性（-Dfoo=bar）。

# math - 2 System.Drawing.Point 之间的距离

> ID：849714
> 
> 赞同：2
> 
> 时间：2009-05-11T19:41:48.143
> 
> 标签：math, distance

如何找到 2 System.Drawing.Point 之间的距离？

我用谷歌搜索并没有找到它......

```
Dim p1 As New Point(0, 10)
Dim p2 As New Point(10, 10)
Dim distance = ?? 
```

在这种情况下，它应该是 10，但是这里呢？

```
Dim p1 As New Point(124, 942)
Dim p2 As New Point(34, 772)
Dim distance = ?? 
```

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T19:45:02.053

距离公式：sqrt( (x2 - x1)^2 + (y2 - y1)^2 )

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-31T14:59:01.973

```
Point p1 = new Point(7, 5);
Point p2 = new Point(26, 29);
double distance = Math.Round(Math.Sqrt(Math.Pow((p2.X - p1.X), 2) + Math.Pow((p2.Y - p1.Y), 2)), 1); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T19:47:04.967

如果你想知道人们给你的公式来自哪里，这被概括为[勾股定理](http://en.wikipedia.org/wiki/Pythagorean_theorem)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T19:45:52.333

伪代码：

```
SquareRoot(Square(p1.x - p2.x)+Square(p1.y-p2.y)) 
```

# memcached - memcached 成百上千个 tcp 套接字是否合理？

> ID：849717
> 
> 赞同：0
> 
> 时间：2009-05-11T19:43:45.113
> 
> 标签：memcached, merb, connection, persistent

我正在使用 Merb::Cache 来存储 txt/xml，并注意到我让我的 merb 运行的时间越长，我打开的打开 tcp 套接字的数量就越大——我相信这会导致一些主要的性能问题。

```
lsof | grep 11211 | wc -l
494

```

```
merb 27206 root 71u IPv4 13759908 TCP localhost.localdomain:59756->localhost.localdomain:11211（已建立）
merb 27206 root 72u IPv4 13759969 TCP localhost.localdomain:59779->localhost.localdomain:11211（已建立）
merb 27206 root 73u IPv4 13760039 TCP localhost.localdomain:59805->localhost.localdomain:11211（已建立）
merb 27206 根 74u IPv4 13760052 TCP localhost.localdomain:59810->localhost.localdomain:11211（已建立）
merb 27206 根 75u IPv4 13760135 TCP localhost.localdomain:59841->localhost.localdomain:11211（已建立）
merb 27206 根 76u IPv4 13760823 TCP localhost.localdomain:59866->localhost.localdomain:11211（已建立）
merb 27206 根 77u IPv4 13760951 TCP localhost.localdomain:52095->localhost.localdomain:11211（已建立）

```

ETC...

我的相关代码是：

```
    如果 !exists?(:memcached) 那么
      register(:memcached, Merb::Cache::MemcachedStore, :namespace => 'mynamespace', :servers => ['127.0.0.1:11211'])
    结尾

```

&&

```
    什么时候：xml
      除非@hand_xml = Merb::Cache[:memcached].read("/hands/#{@hand.id}.xml")
        @hand_xml = 显示（@hand）
        Merb::Cache[:memcached].write("/hands/#{@hand.id}.xml", @hand_xml)
      结尾
      返回@hand_xml

```

这段代码是直接错误的还是我使用了错误版本的内存缓存？

我有 memcached 1.2.8 并具有以下内容：

libmemcached-0.25.14.tar.gz memcached-0.13.gem

这有点让我发疯..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T19:13:22.207

k 我想出了一些东西..

1) 假设您使用的是使用 epoll 或其他东西的库，那么将成百上千个套接字连接到 memcached 是合理的——但是，如果您像我一样使用 ruby​​，我不知道使用某些东西的库除了 select() 或 poll() - 因此这会引发这个问题/想要立即退出

2）如果你像我一样，你现在只有 1 个 memcached 服务器在运行，并且有几个 mongrels/thins 在运行以处理请求。因此你的 memcache 连接应该有问题。不超过你运行的杂种/瘦的数量（假设你只缓存 1 或两组东西）——这是我的情况

这是修复：

通过 memcached gem 而不是 merb::cache 设置 memcache（它实际上包装了您正在使用的任何 memcache lib

```
MMCACHE = Memcached.new("localhost:11211") 
```

获取/设置您的值：

```
 @cache = MMCACHE.clone
  begin
    @hand_xml = @cache.get("/hands/#{@hand.id}.xml")
  rescue
    @hand_xml = display(@hand)
    @cache.set("/hands/#{@hand.id}.xml", @hand_xml)
  end
  @cache.quit 
```

当你这样做时，现在坐下来喝一杯冷饮：

```
lsof | grep 11211 | wc -l 
```

您会看到类似 2 或 3 而不是 2036 的东西！

礁的道具让我知道，memcache 连接从一开始就保持持久性并不少见

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T23:21:19.547

我也许可以提供帮助，但我需要讲一个故事来做到这一点。这里是。

曾几何时，有一个由 10 个 apache(ssl) 服务器组成的集群，每个服务器配置为正好有 100 个线程。还有一个由 10 个 memcached 服务器组成的集群（在同一个盒子上），它们*似乎*都过着平静的生活。apache 和 memcached 都受到邪恶的**monit 守护进程的保护。**

然后 King 安装了第 11 个 apache(ssl) 服务器，memcached 每隔几个小时就开始随机重启！国王开始调查，他发现了什么？php memcache 模块文档中有一个错误，说 memcache 连接对象的默认构造函数**不是**持久的，但显然它是。发生的事情是，每个 php 线程（大约有 1000 个）在需要时打开了与池中每个 memcached 的连接，并且它持有它。每个 memcached 服务器有 10*100 个连接，这很好，但是对于 11 个服务器，它是 1100，并且 1024<1100。memcached 的最大打开套接字数为 1024。当所有套接字都被占用时，monit 守护进程无法连接，因此他重新启动了 memcached。

每个故事都必须有道德。那么，国王对这一切做了什么？他禁用了持久连接，他们从此过上了幸福的生活，集群上的连接数达到了 5（五个）的峰值。这些服务器正在处理大量数据，所以我们不能有 1000 个备用套接字，而且在每个请求上协商 memcache 连接更便宜。

很抱歉，但我不知道 ruby​​，看起来你有大量线程，或者你缓存错误。

祝你好运！

# sql-server - SQL Server 2005 删除触发器从已删除中选择返回 null

> ID：849722
> 
> 赞同：1
> 
> 时间：2009-05-11T19:44:17.203
> 
> 标签：sql-server, sql-server-2005, triggers

我在 SQL Server 中有一个名为 hl7_lock 的表，其中包含以下列：

hl7_id lock_dtm lock_user

我在表上有 3 个触发器用于 UPDATE、INSERT 和 DELETE

该表永远不会更新，但 INSERT 触发器工作正常。但是，此删除触发器偶尔会在 hl7_lock_log 中放置一条 hl7_id 为空的记录

```
 SET NOCOUNT ON;
declare @hl7_id decimal(18,0)
select @hl7_id = hl7_id from deleted
insert into hl7_lock_log (user_name, action, hl7_id, dtm)                        
        values(system_user, 'Delete', @hl7_id,getdate()) 
```

其他字段插入成功，但 hl7_id 为空。删除的记录没有空 hl7_id。

我们在周末安装了 SQL Server SP 2，但这并没有改善这种情况。有没有人在 SQL Server 触发器中看到过这种行为。关于如何修复触发器的任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T19:54:17.623

仅删除一条记录或删除多条记录时会发生这种情况吗？如果删除了多个记录，则触发器将失败。

你应该做更多这样的事情：

插入 hl7_lock_log (user_name, action,hl7_id, dtm) select system_user, 'Delete', hl7_id, getdate() from deleted

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:56:01.163

您确定记录在“已删除”表中吗？如果在您的主表上运行删除零记录的删除语句，看起来您上面的代码仍将插入到您的锁定日志中。

也许在插入之前检查是否有任何记录被删除可以解决这个问题。

正如 Thirster 指出的那样，您需要针对在单个语句中删除的多条记录进行调整。

# sql-server - 是否可以更新 SQL Server 中的二进制字段？

> ID：849726
> 
> 赞同：0
> 
> 时间：2009-05-11T19:45:00.353
> 
> 标签：sql-server, vb.net

我知道如何将新行插入到具有二进制列的表中。但是，一旦添加了该行，有什么方法可以更新二进制列？到目前为止，详尽的谷歌搜索一无所获。

到目前为止，我的解决方案是

1.  获取我希望更新的当前行
2.  删除我要更新的行
3.  使用我希望更新的行中的信息以及新的二进制文件创建一个新行

它看起来不是很优雅，我希望我可以用更新语句做同样的事情。

这是我现在使用的更新代码以供参考

```
Dim objCommand As New SqlCommand("UPDATE " & Tablename & " SET " _ 
& column & " = Data  WHERE " & criteria)
objCommand.Parameters.Add("@Data", SqlDbType.Image)
objCommand.Parameters("@Data").Value = BinaryData 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:50:44.180

查看TechRepublic 上的[这篇文章](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5766889.html)以了解技术。您将需要使用 GetBytes / PutBytes 方法，这比大多数 ADO.Net 代码要痛苦得多。另请参阅[MSDN](http://msdn.microsoft.com/en-us/library/bb399384.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:08:46.587

插入二进制/字节

```
INSERT INTO table_name
(field_name)
VALUES
(4|8|16|32) 
```

更新二进制/字节

```
UPDATE table_name 
SET field_name=field_name|8|16|32 
WHERE field_name_filter=@this_value 
```

**注意：**一旦设置了字节标志，您就无法更新它以将其删除。因此，您不能使用 UPDATE 示例删除已设置为 4 的字节，然后想将其更改为 8，它只需添加 8，因此现在您将拥有 4|8。此外，放置反向字节也比接缝更难，不仅仅是 UPDATE -4|8。

查询结果更容易，删除记录并将其作为新记录插入旧数据（来自第一个查询）并使用正确的字节标志重新格式化。

至少这是我对此的有限经验

# c++ - 确定网络连接链路速度

> ID：849728
> 
> 赞同：4
> 
> 时间：2009-05-11T19:45:02.897
> 
> 标签：c++, windows, winapi, networking

如何以编程方式确定活动网络连接的网络连接链接速度 - 就像任务管理器在“网络”选项卡中显示的那样？我并不真正追求可用带宽，只是当前连接的一个数字，例如 54Mbps、100Mbps 等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:48:17.260

[`Win32_NetworkAdapter`](http://msdn.microsoft.com/en-us/library/aa394216(VS.85,loband).aspx)WMI 类可以帮助你（`Speed`属性）。它为连接到 WiFi-g 接入点的 WiFi 适配器返回值 54000000。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T13:22:40.607

最后我找到了[`Win32_PerfRawData_Tcpip_NetworkInterface`](http://msdn.microsoft.com/en-us/library/aa394340(VS.85).aspx)WMI 类，因为我需要支持遗留平台，不幸的是，`Win32_NetworkAdapter`它不支持。`Win32_PerfRawData_Tcpip_NetworkInterface`有一个`CurrentBandwidth`属性，它可以在所有必需的平台上为我提供我需要的东西（我意识到我说过我不需要“带宽”，但它可以接受，并且似乎无论如何都会返回适配器的“标称带宽”）。

感谢所有发帖的人，为我指明了正确的方向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T06:59:37.333

.NET 方法如何知道适配器速度是

```
IPGlobalProperties computerProperties = IPGlobalProperties.GetIPGlobalProperties();
NetworkInterface[] nics = NetworkInterface.GetAllNetworkInterfaces();
if ( nics != null )
    for (int i = 0; i < nics.Length; i++)
        Console.WriteLine("Adapter '{0}' speed : {1}", nics[i].Name, nics[i].Speed); 
```

一些适配器是隧道，因此它们的速度将返回为 0。有关详细信息，请阅读MSDN 上的[NetworkInterface](http://msdn.microsoft.com/ru-ru/library/system.net.networkinformation.networkinterface.aspx)文档。

# subsonic - ExecuteJoinedDataSet 但使用 Where()

> ID：849732
> 
> 赞同：0
> 
> 时间：2009-05-11T19:46:08.057
> 
> 标签：subsonic

我做了一些搜索，发现 ExecuteJoinedDataSet 不适用于 2.1 中的 Where 子句。如果我想使用 WHERE 查询表，但希望 FK 对象值可绑定，这是创建自定义类的最简单方法（我的表有大量 FK 引用）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T22:02:38.147

你能给我们举个例子说明你想写什么样的查询吗？如果您只是想返回一个 DataTable 而不创建自定义类，只需编写您的查询并使用返回 IDataReader 的 ExecuteReader。IDataReader 是可绑定的，如果您需要更多，可以将其加载到 DataTable 中。

# c# - 如何在没有 web.config 或 httpModule 的情况下定义端点？

> ID：849733
> 
> 赞同：1
> 
> 时间：2009-05-11T19:46:53.127
> 
> 标签：c#, .net, wcf, rest

我想制作一个 HTTPhandlers 的 RESTful 应用程序，而不必通过在 web.config 中创建一个条目来定义每个端点，我想要将属性附加到类构造函数的样式，例如：

```
public class obj : IHttpHandler
{
  [WebGet(UriTemplate = "/accounts/{id}")]
  public obj(string id)
  {
     // this is just an eg, it worild normally include caching and 
     // a template system
     String html = File.ReadAllText("/accounts/accounts.htm");
     html.replace("id", id);
     httpcontext.current.response.write(html)
  }
} 
```

代替

```
<httpHandlers>
      <clear />
      <add verb="GET" path="/accounts/*" type="MyApp.obj" />
</httphandlers> 
```

我现在这样做的方式是在 web.config 中有 100 个端点 :( 我宁愿在课堂上定义它们。而且我也不想制作额外的文件 (.asmx)。我想要仅包含带有令牌和 .cs 文件的 .htm 文件的应用程序

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:12:03.363

您可以使用自定义 ServiceHost 自动注册端点等，它会覆盖 ApplyConfiguration() 方法，然后虚拟化配置，使其不必位于 web.config 文件中。

[这是一个起点](http://blogs.msdn.com/dotnetinterop/archive/2008/09/22/custom-service-config-file-for-a-wcf-service-hosted-in-iis.aspx)。它并不完全符合您的要求，但它说明了虚拟化配置的概念。

# c++ - 在 Quartz 插件中查找左上角

> ID：849734
> 
> 赞同：0
> 
> 时间：2009-05-11T19:47:01.473
> 
> 标签：c++, macos, quartz-graphics, browser-plugin

我有一个用于查看图像的 Mac 插件。它最初是用 Quickdraw 编写的，我正在尝试将其移至 Quartz。

我目前的问题是起源。在 QD 中，原点（明智地）是插件矩形的左上角。在 Quartz 中，它似乎是插件矩形顶部下方的一个屏幕高度（不包括 firefox 按钮等）。这实际上是在我的插件矩形中间的某个随机位置。

这也意味着我需要知道浏览器窗口的绘图部分的大小。我确定我可以算出一个窗口有多大，但是我如何算出标签等占用了多少空间？Mac 不知道这些事情，是吗？

在相关的说明中，有人知道为什么 Apple 决定将原点放在左下角吗？对我来说似乎有点愚蠢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T00:14:04.220

如果您使用的是 NSView，您可以创建一个`-isFlipped`返回 YES 的函数的实现，这将允许您基于翻转的坐标系进行绘制。

或者，如果您不使用 NSView 而是在进行原始 CoreGraphics 绘图，则可以像这样修改 CTM：

```
CGContextScaleCTM( context, 1.0, -1.0 ); 
```

这来自[这个 Apple Q&A 文档](http://developer.apple.com/qa/qa2001/qa1009.html)。

如果您使用其他东西提供的 CGContextRef 执行此操作，则应首先保存现有的 CTM 并在完成后恢复它：

```
CGContextSaveGState( context );

// do your stuff here ...

CGContextRestoreGState( context ); 
```

哦，原点在左下角，因为 Quartz 渲染系统基于 PDF 图形系统，它本身基于 PostScript，并且原点在左下角。

# matlab - 如何在 MATLAB 中获取文件的大小？

> ID：849739
> 
> 赞同：35
> 
> 时间：2009-05-11T19:48:13.920
> 
> 标签：matlab, file-io

使用 MATLAB 计算文件大小的最佳方法是什么？想到的第一个念头是`size(fread(fid))`。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-05-11T20:08:57.210

请参阅上述的[dir](http://www.mathworks.com/help/techdoc/ref/dir.html)函数。

请注意，dir 函数适用于文件，而不仅仅适用于目录。

```
>> s = dir('c:\try.c')

s = 

       name: 'try.c'
       date: '01-Feb-2008 10:45:43'
      bytes: 20
      isdir: 0
    datenum: 7.3344e+005 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-11T19:55:51.333

您可以使用[DIR](http://www.mathworks.com/help/techdoc/ref/dir.html)函数获取目录信息，其中包括该目录中文件的大小。例如：

```
dirInfo = dir(dirName);  %# Where dirName is the directory name where the
                         %#   file is located
index = strcmp({dirInfo.name},fileName);  %# Where fileName is the name of
                                          %#   the file.
fileSize = dirInfo(index).bytes;  %# The size of the file, in bytes 
```

或者，由于您只查找一个文件，您可以按照[Elazar](https://stackoverflow.com/questions/849739/matlab-get-file-size/849861#849861)所说的操作，只需将文件的绝对或相对路径传递给 DIR：

```
fileInfo = dir('I:\kpe\matlab\temp.m');
fileSize = fileInfo.bytes; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-11T19:55:42.583

使用 MatLab 可以访问 Java 对象的事实：

```
myFile = java.io.File('filename_here')
flen = length(myFile) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-06-20T19:45:14.863

如果您不想在目录中硬编码，可以使用内置的 pwd 工具找到当前目录，然后将文件名添加到其中。请参见下面的示例：

```
FileInfo = dir([pwd,'\tempfile.dat'])
FileSize = FileInfo.bytes 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-20T13:33:04.720

这个问题似乎表明`fopen`/ `fread`/.. 被使用。在这种情况下，为什么不寻找文件末尾并读取位置？

例子：

```
function file_length = get_file_length(fid)
% extracts file length in bytes from a file opened by fopen
% fid is file handle returned from fopen

% store current seek
current_seek = ftell(fid);
% move to end
fseek(fid, 0, 1);
% read end position
file_length = ftell(fid);
% move to previous position
fseek(fid, current_seek, -1);

end 
```

Matlab本可以提供一个快捷方式..

更多信息`ftell`可以在[这里](http://www.mathworks.com/help/matlab/ref/ftell.html)找到。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-28T07:41:17.847

此代码适用于任何文件和目录（不需要绝对路径）：

```
 dirInfo=dir(pwd);
    index = strcmp({dirInfo.name},[filename, '.ext']); % change the ext to proper extension 
    fileSize = dirInfo(index).bytes 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-02-20T07:26:34.757

查找文件大小的简单方法是：输入这些指令

> > K=imfinfo('filename.formate');
> > 
> > size_of_file=K.FileSize

并获取文件大小。

# php - 如何为 CodeIgniter 创建一个不错的错误 404 处理程序？

> ID：849746
> 
> 赞同：5
> 
> 时间：2009-05-11T19:49:15.103
> 
> 标签：php, codeigniter, http-status-code-404

CodeIgniter 有 /system/application/errors/error_404.php ，当出现 404 时会显示它，因为实际上是“找不到控制器”条件。但是，对于我的项目，我真的需要处理这个错误，就像控制器类中缺少方法一样。在这种情况下，我会显示一个带有漂亮“找不到页面：也许您的意思是这个？...”页面的普通视图，其中包含数据库生成的导航等。

我的想法是我可以做以下两件事之一：

1.  创建`header("Location: /path/to/error_page")`调用以重定向到现有（或特殊）控制器的 404 处理程序
2.  添加某种默认路由器来处理它。

达到所需结果的最佳方法是什么？有什么需要注意的陷阱吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T13:30:13.427

我将 CodeIgniter 与 Smarty 一起使用。我的 Smarty 类中有一个名为 notfound() 的附加函数。调用 notfound() 将正确的标题位置设置为 404 页面，然后显示 404 模板。该模板具有可覆盖的标题和消息，因此用途广泛。这是一些示例代码：

```
Smarty.class.php

function not_found() {
header('HTTP/1.1 404 Not Found');

if (!$this->get_template_vars('page_title')) {
    $this->assign('page_title', 'Page not found');
    }

    $this->display('not-found.tpl');
    exit;
} 
```

在控制器中，我可以执行以下操作：

```
$this->load->model('article_model');
$article = $this->article_model->get_latest();

if ($article) {
    $this->smarty->assign('article', $article);
    $this->smarty->view('article');
} else {
    $this->smarty->assign('title', Article not found');
    $this->smarty->not_found();
} 
```

同样，我可以将 /system/application/error/error_404.php 中的代码更改为：

```
$CI =& get_instance();
$CI->cismarty->not_found(); 
```

它工作得很好，使用少量代码，并且不会为不同类型的缺失实体重复 404 功能。

我认为您可以使用内置的 CodeIgniter 视图做类似的事情。重要的是在你做你的视图之前吐出标题。

更新：我使用与此处描述的类似的自定义 Smarty 包装器：

[使用 Smarty 和 CodeIgniter](http://devcha.blogspot.com/2007/12/smarty-as-template-engine-in-code.html)

# wpf - WPF相当于margin-top？

> ID：849754
> 
> 赞同：18
> 
> 时间：2009-05-11T19:51:07.240
> 
> 标签：wpf, margin

你如何在WPF中做相当于css的margin-top？

我有一个图像，我想在顶部添加一个边距，但我似乎可以开始工作的是边距，它会影响图像的每一侧。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-11T19:57:20.723

您可以指定每边的边距（按此顺序：左、上、右、下）

```
<Image Source="image.png" Margin="0,10,0,0"/> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T19:58:06.680

Margin 属性是您正在寻找的。有 3 种不同的方式来设置边距。第一个（见下文）将所有边距设置为相同的值——它扩展为“0,0,0,0”。第二个将左侧和右侧设置为 1，将顶部和底部设置为 0——它扩展为“1,0,1,0”。第三个将每一边设置为一个单独的值（在本例中为 5）。边距值，按顺序：第一个值是左侧第二个值是顶部
第三个值是右侧第四个值是底部

```
Margin="5";      <!-- same as "5,5,5,5" -->
Margin="5,2"     <!-- same as "5,2,5,2" -->
Margin="5,6,7,8" <!-- set left,top,right,bottom independantly --> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T19:58:03.420

您可以使用左、上、右、下数字来指定 WPF 中任何控件的边距

例如：

```
<Button Margin="10 5 10 10" /> 
```

这里左 -> 10，上 -> 5，右 - 10 和下 -> 10

有关更多信息，请查看此博客文章 [WPF Margin demystified](http://vkreynin.wordpress.com/2008/10/13/wpf-margin-demystified/)

[另一篇关于边距、填充、边框和内容](http://www.danrigsby.com/blog/index.php/2008/05/20/margins-and-padding-in-wpf/)的有用博客文章，不错

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-18T17:38:29.307

您可以使用边距和垂直对齐。

例如：

```
<Button Margin="0,200,0,0" VerticalAlignment="Top" /> 
```

# .net - .NET 的 Mercurial API

> ID：849755
> 
> 赞同：3
> 
> 时间：2009-05-11T19:51:12.730
> 
> 标签：.net, api, mercurial

我想为 mercurial 创建一个 .NET 客户端。没什么花哨的，只是基本的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-11-10T10:34:24.897

我已经开始在 .NET 4.0 中为 Mercurial 命令行客户端编写一个包装类库。现在使用任何东西还为时过早，但您可能需要密切关注它。希望它对更多的人有用，而不仅仅是我。

代码在 bitbucket 上作为开源发布，这里：

[http://bitbucket.org/lassevk/mercurial.net](http://bitbucket.org/lassevk/mercurial.net)

目前您可以进行基本的日志检索。没有对指定 revsets 的完整语法支持，但您可以执行以下操作：

```
var repo = new Repository(@"c:\dev\some\project\repo");
var log = repo.Log(verbose: true, set: RevisionSet.FromRevision(10)); // 10:tip

var changesByMeThatModifiesIgnoreFile =
    from changeset in log
    where changeset.AuthorName == "Lasse V. Karlsen"
       && changeset.PathActions.Any(pa =>
           pa.Path == ".hgignore" &&
           pa.Action == PathActionType.Modify)
    select changeset; 
```

我计划支持所有内置命令，以便您可以提交、更新、推送、拉取、检查传入和传出、克隆等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-24T12:49:28.880

就像乍得说的，使用命令行。那*是*官方的API。我们竭尽全力保持它的稳定性，以使脚本和程序更容易解析其输出。有关我们如何尝试确保向后兼容性从而使程序更容易使用 Mercurial 的详细信息，请参阅[兼容性规则。](http://www.selenic.com/mercurial/wiki/CompatibilityRules)

由于稳定的命令行 API，人们可以在其上编写包装库。对于 .Net，我会选择 Lasse Karlsen 的[Mercurial.Net](http://mercurialnet.codeplex.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T19:55:13.970

问题并不相同，但最佳答案同样适用于您的情况：[Mercurial API for Java？](https://stackoverflow.com/questions/380321/mercurial-api-for-java/385536#385536).

基本上我认为你可能只需要调用命令行函数。[官方 API](http://www.selenic.com/mercurial/wiki/MercurialApi)似乎仅适用于 Python。

# sql - 如何让 SSIS 查找转换忽略字母大小写？

> ID：849758
> 
> 赞同：7
> 
> 时间：2009-05-11T19:52:52.993
> 
> 标签：sql, sql-server, ssis, lookup, business-intelligence

希望这很容易解释，但我在我的一个 SSIS 包中进行了查找转换。我正在使用它在维度表中查找员工记录的 id。但是我的问题是，一些源数据的员工姓名全部大写（例如：CHERRERA），而我使用的比较数据都是小写的（例如：cherrera）。

对于不是 100% 大小写相似的记录，查找失败（例如：cherrera vs cherrera 工作正常 - cherrera vs CHERRERA 失败）。有没有办法让查找转换忽略字符串/varchar 数据类型的大小写？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-11T19:58:37.383

我认为没有办法使转换不区分大小写，但是您可以修改转换的 SQL 语句，以确保源数据与比较数据的大小写匹配，方法是使用 LOWER() 字符串函数。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2015-04-14T01:10:32.023

将查找转换的 CacheType 属性设置为 Partial 或 None。

查找比较现在将由 SQL Server 而不是由 SSIS 查找组件完成，并且不再区分大小写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-05T12:28:07.783

您必须更改源并查找数据，两者都应该是相同的案例类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-12-18T12:27:33.677

基于这篇[微软文章](https://docs.microsoft.com/en-us/sql/integration-services/data-flow/transformations/lookup-transformation)：

> 查找转换执行的查找区分大小写。为避免因数据大小写差异导致查找失败，请先使用字符映射转换将数据转换为大写或小写。然后，在生成引用表的 SQL 语句中包含 UPPER 或 LOWER 函数

要阅读有关*字符映射转换*的更多信息，请点击此链接“

*   [字符映射转换](https://docs.microsoft.com/en-us/sql/integration-services/data-flow/transformations/character-map-transformation)

# php - 当 PHP6 发布，ereg 正则表达式变成扩展而不是核心时如何安全

> ID：849761
> 
> 赞同：1
> 
> 时间：2009-05-11T19:53:20.777
> 
> 标签：php

对于那些不知道 PHP6 会发生什么的人，这里有一个不错的简短阅读：http: [//jero.net/articles/php6](http://jero.net/articles/php6)

现在，如果您有依赖于 ereg 的函数并且您无法控制托管脚本的服务器上的 php.ini 文件，您将如何处理呢？

例如，这里的这个函数：

```
function currentDateTime() {
  list($micro, $Unixtime) = explode(" ",microtime());
  $sec= $micro + date("s", $Unixtime);
  $sec = mb_ereg_replace(sprintf('%d', $sec), "", ($micro + date("s", $Unixtime)));
  return date("Y-m-d H:i:s", $Unixtime).$sec;
} 
```

它似乎依赖于ereg，那么我该如何替换它呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T19:58:31.267

您可以重新编写以使用[preg 函数](http://www.php.net/preg_match)。

编辑：[动态加载](http://www.php.net/dl)似乎已被弃用...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:09:13.387

如果[`ini_set()`](http://us.php.net/manual/en/function.ini-set.php)您无法控制`php.ini`文件，您可以在脚本中设置 PHP 配置值。但我建议尝试在某个时候迁移到`preg_`over 。`ereg_`PCRE 比 POSIX 正则表达式更有用、更强大，并且在很大程度上兼容。

# c# - 如何在 Silverlight 中将一个控件固定在另一个控件下方？

> ID：849768
> 
> 赞同：3
> 
> 时间：2009-05-11T19:54:30.697
> 
> 标签：c#, silverlight-2.0

我有一个使用`DataGrid`自定义模板的项目，以便我可以在数据行的底部添加一个特殊行。我希望将此特殊行固定在最后一行下方，但不作为 的一部分`ScrollViewer`，以便它保持固定在最后一行下方，直到特殊行的底部到达数据网格的底部，然后我想要这些行区域调整到中间的空间并相应地滚动，特殊行始终可见。

到目前为止，我已经将我的特殊行`ScrollViewer`与`RowsPresenter`. 演示者和特殊行都在 a 中的自动大小行中`Grid`，`ScrollViewer`而 则`ScrollViewer`在星形网格行中，以便滚动条在空间不足时出现。我如何从中得到，行和特殊行一起滚动到我想要的位置，行滚动到哪里，但特殊行固定在底部并且始终可见？

尽管我的示例使用了`DataGrid`，但我确信这可以简化为仅具有不同高度的可滚动元素，并在其下方固定一个控件。到目前为止，我想我需要一个`Canvas`而不是 a`Grid`来托管我`ScrollViewer`和同伴的特殊行，并在`ScrollViewer`增长时使用一些逻辑来调整高度和位置（如果我能检测到的话），但我还没有尝试过。有没有更好的方法，或者该`Canvas`方法是最好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T14:38:45.887

我能够通过使用`Grid`具有两个自动调整大小的行来解决这个问题；一行`DataGrid`代表我的固定行。然后我监视 的大小，`Grid`并在调整大小时查看`Grid`的 ActualHeight 是否大于它所占用的屏幕空间。如果是，我将`DataGrid`' 行更改为星形大小，这会导致固定行显示固定在父控件的底部，并`DataGrid`为其行显示滚动条。当有更多空间可用时，我将行改回自动调整大小。

这显然适用于其中一行必须始终在屏幕上但也必须固定在另一行底部的任何情况。

固定代码如下所示：

```
RowDefinition row = this.mainGrid.RowDefinitions[0];
if (row.Height.GridUnitType == GridUnitType.Auto)
{
    if (this.mainGrid.ActualHeight > this.ActualHeight)
    {
        row.Height = new GridLength(1, GridUnitType.Star);
    }
}
else
{
    if (this.dataGrid.DesiredSize.Height < row.ActualHeight)
    {
        row.Height = GridLength.Auto;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-14T08:54:26.940

首先，为主控件和固定控件创建一个 Grid：

```
<Grid Grid.Row="0" VerticalAlignment="Top">
    <Grid.RowDefinitions>
        <RowDefinition Height="*" />               
        <RowDefinition Height="Auto" />            
    </Grid.RowDefinitions>

    <!-- The main control, that is about to stretch. -->
    <sdk:DataGrid Grid.Row="0" ItemsSource="{Binding YOUR_COLLECTION}" />

    <!-- The pinned control. -->
    <TextBlock Grid.Row="1" Text="Hello World" />
</Grid> 
```

诀窍是 VerticalAlignment="Top" - 当主控件小于可用高度时，它将移动到可用空间的顶部，并且固定控件将出现在其下方。

然后，将此 Grid 放入一个垂直延伸的容器中，例如在另一个具有 Star 高度的 Grid 的行中：

```
<Grid x:Name="LayoutRoot">
    <Grid.RowDefinitions>
        <!-- RowDefition for the Grid with the main control and the pinned control. --> 
        <!-- If you want to have some other controls, -->
        <!-- add other RowDefinitions and put these controls there.  -->
        <RowDefinition Height="*" /> 
    </Grid.RowDefinitions>

    <!-- The internal Grid for the main control and the pinned control. -->
    <Grid Grid.Row="0" VerticalAlignment="Top">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />               
            <RowDefinition Height="Auto" />            
        </Grid.RowDefinitions>

        <sdk:DataGrid Grid.Row="0" ItemsSource="{Binding YOUR_COLLECTION}" />

        <TextBlock Grid.Row="1" Text="Hello World" />
    </Grid>
</Grid> 
```

除了根 Grid 之外，您可能还有任何其他垂直延伸的容器，重要的是它会尝试为其填充所有可用空间。

# database - 将当前用户带到数据库层

> ID：849780
> 
> 赞同：0
> 
> 时间：2009-05-11T19:57:16.870
> 
> 标签：database, logging

我有一个使用 MySQL 和 Tomcat 构建的经典 3 层 Web 应用程序。

我想在 creator_id 列中保存所有表的每个数据库记录的创建者 ID，或者将其记录在某处。当前用户存储在 http 会话对象中。修改所有查询并传递 creator id 参数是不可接受的。

我可以使用触发器、alter table 命令等解决问题吗？最好的方法是什么？

PS。黑客是可以接受和欢迎的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:01:24.570

数据库不可能知道哪个**站点用户**正在发送查询，它只知道哪个**数据库用户**。如果它是一个 Web 应用程序，它可能一直都是同一个数据库用户，无论谁在网站上登录。

简短的回答是不，您将不得不选择“不可接受”的选项，除非您想为每个站点用户创建一个数据库用户，并让站点使用这些用户打开数据库连接，而不是一个“共享”用户。但这可能最终导致的问题多于解决的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:26:42.000

根据您在问题中所说的内容，您的逻辑应用程序用户 ID 与您的数据库连接 ID 不同。如果是这种情况，数据库怎么可能知道您的逻辑应用程序用户 ID 是什么？除非你把它传递进去，否则它无法知道谁在做什么。您说修改所有查询以将其传入是不可接受的。但是，您只需要修改要记录此“creator_id”值的保存位置。您还需要修改这些表。希望您有一个包含所有这些用户的表，并且您可以 FK 到该表的新列。

# sql - SQL Server Management Studio 显示数据库图表 (ER) 权限

> ID：849784
> 
> 赞同：5
> 
> 时间：2009-05-11T19:57:34.653
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我想知道是否有人确切地知道 SQL Server 2005+ 中的数据库需要哪些权限，以便当一个人使用 SQL Server Management Studio 时，他们至少可以看到数据库图。

我试过给这个人 db_datareader、db_datawriter 和 db_ddladmin，但无济于事。

我还尝试在用户的“属性”→“有效权限”中授予他们访问权限。在有效权限下，我找不到“数据库图”的数据库对象类型或任何类似的东西来让用户访问。

他们正在运行 SQL Server Management Studio（非快速版本。）

任何帮助都会很棒。

仅供参考，我不想给他们 db_owner 访问权限。

编辑：

1.  至于评论之一：是的，该数据库是 SQL Server 2005 数据库。
2.  至于答案之一，将数据库从生产转移到开发不是一种选择。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-13T04:13:56.723

授予管理员权限不是正确的方法，您需要成为数据库图的数据库所有者，[查看此线程以获取更多详细信息](http://social.msdn.microsoft.com/Forums/en-US/sqlexpress/thread/8715f383-3e28-4910-93f9-5cca51d48380/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-06T12:05:21.550

首先，您需要设置图表设计器（为此您需要成为 db_owner）。只需展开图表节点，然后按“是”即可启用图表。

之后，所有其他数据库用户都可以创建图表并查看**他们自己的**图表。只有 db_owner 可以看到其他人的图表。

db_owner 也可以将图表所有者更改为他自己，但在此之前必须从数据库中删除原始所有者。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2009-05-11T21:58:10.230

将数据库复制到开发系统，并授予开发人员管理权限。其他任何事情都是浪费时间（比如研究这个问题。）

请参阅[这篇文章](https://stackoverflow.com/questions/701214/should-developers-have-administrator-permissions-on-their-pc)以获得更好的解释。

# javascript - 从 Javascript 画布中获取点的未翻译、未旋转 (x,y) 坐标

> ID：849785
> 
> 赞同：2
> 
> 时间：2009-05-11T19:57:34.717
> 
> 标签：javascript, geometry, canvas, translation, rotation

在 Javascript 中，我们经常在发送东西之前通过旋转和平移坐标平面来渲染图形

```
ctx.save();
ctx.translate(someX, someY);
ctx.rotate(someAngle * Math.PI / 180);

ctx.beginPath();
ctx.moveTo(x1, y1);    // What's the actual (x1,y1)?
ctx.lineTo(x2, y2);    // What's the actual (x2,y2)?
ctx.stroke();

ctx.restore(); 
```

因此，完成此操作后，我如何计算出我绘制的线段端点的实际值？因为在平移和旋转之后， (x1,y1) 和 (x2,y2) 距离没有平移和旋转的位置很远。有没有一种简单的方法可以找出它们的实际值是多少？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T22:45:21.167

现在无法获取当前的转换矩阵，因此您需要自己跟踪任何旋转/平移/缩放。

要实际执行转换，您需要将转换矩阵乘以点（作为列向量）。

您可以覆盖影响转换的方法以存储您自己的矩阵副本。我没有测试过这段代码，但这样的东西应该可以工作：

```
var contextPrototype = CanvasRenderingContext2D.prototype;

contextPrototype.xform = Matrix.I(3);

contextPrototype.realSave = contextPrototype.save;
contextPrototype.save = function() {
    if (!this.xformStack) {
        this.xformStack = [];
    }
    this.xformStack.push(this.xform.dup());
    this.realSave();
}

contextPrototype.realRestore = contextPrototype.restore;
contextPrototype.restore = function() {
    if (this.xformStack && this.xformStack.length > 0) {
        this.xform = this.xformStack.pop();
    }
    this.realRestore();
}

contextPrototype.realScale = contextPrototype.scale;
contextPrototype.scale = function(x, y) {
    this.xform = this.xform.multiply($M([
        [x, 0, 0],
        [0, y, 0],
        [0, 0, 1]
    ]));
    this.realScale(x, y);
}

contextPrototype.realRotate = contextPrototype.rotate;
contextPrototype.rotate = function(angle) {
    var sin = Math.sin(angle);
    var cos = Math.cos(angle);
    this.xform = this.xform.multiply($M([
        [cos, -sin, 0],
        [sin,  cos, 0],
        [   0,   0, 1]
    ]));
    this.realRotate(angle);
}

contextPrototype.realTranslate = contextPrototype.translate;
contextPrototype.translate = function(x, y) {
    this.xform = this.xform.multiply($M([
        [1, 0, x],
        [0, 1, y],
        [0, 0, 1]
    ]));
    this.realTranslate(x, y);
}

contextPrototype.realTransform = contextPrototype.transform;
contextPrototype.transform = function(m11, m12, m21, m22, dx, dy) {
    this.xform = this.xform.multiply($M([
        [m11, m21, dx],
        [m12, m22, dy],
        [  0,   0,  1]
    ]));
    this.realTransform(m11, m12, m21, m22, dx, dy);
}

contextPrototype.realSetTransform = contextPrototype.setTransform;
contextPrototype.setTransform = function(m11, m12, m21, m22, dx, dy) {
    this.xform = $M([
        [m11, m21, dx],
        [m12, m22, dy],
        [  0,   0,  1]
    ]);
    this.realSetTransform(m11, m12, m21, m22, dx, dy);
} 
```

为方便起见，我使用了[Sylvester 矩阵库](http://sylvester.jcoglan.com/)，但您可以自己进行乘法运算。

要获得变换点，只需将变换矩阵乘以该点：

```
// Get the transformed point as [x, y]
contextPrototype.getTransformedPoint = function(x, y) {
    var point = this.xform.multiply($V([x, y, 1]));
    return [point.e(1), point.e(2)];
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:03:00.153

我认为找到它的唯一方法是将与您在渲染上下文中所做的相同的转换应用于您想知道实际坐标的点。一些库提供矩阵运算，例如：[http](http://sylvester.jcoglan.com/) ://sylvester.jcoglan.com/ 您可以尝试对[笛卡尔坐标执行旋转运算](http://en.wikipedia.org/wiki/Cartesian_coordinate)

# c# - 是否可以使用无锁（等待）双向链表？

> ID：849786
> 
> 赞同：10
> 
> 时间：2009-05-11T19:57:41.207
> 
> 标签：c#, thread-safety, locking, lock-free, interlocked

用 C# 标签问这个问题，但如果可能的话，应该可以用任何语言。

是否可以使用互锁操作实现双向链表以提供无等待锁定？我想插入、添加和删除，无需等待即可清除。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-07-06T20:04:06.610

是的，这是可能的，这是我在 C++ 中实现的类似 STL 的无[锁双链表。](https://github.com/Qarterd/Honeycomb/blob/master/src/common/Honey/Thread/LockFree/List.h)

[生成线程以在列表上随机执行操作的示例代码](https://github.com/Qarterd/Honeycomb/blob/master/test/Test.cpp#L12)

它需要 64 位比较和交换才能在没有 ABA 问题的情况下运行。这个列表只有在无[锁内存管理器](https://github.com/Qarterd/Honeycomb/blob/master/src/common/Honey/Thread/LockFree/HazardMem.h)的作用下才有可能。

查看[第 12 页的基准](http://docs.google.com/viewer?url=http%3A%2F%2Fciteseerx.ist.psu.edu%2Fviewdoc%2Fdownload%3Fdoi%3D10.1.1.140.5222%26rep%3Drep1%26type%3Dpdf)。随着争用的增加，列表的性能随着线程数的增加呈线性关系。该算法支持不相交访问的并行性，因此随着列表大小的增加，争用可以减少。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-11T20:06:03.860

一个简单的 google 搜索将显示许多无锁双向链表论文。

但是，它们基于原子 CAS（比较和交换）。

我不知道 C# 中的操作有多原子，但根据这个网站

[http://www.albahari.com/threading/part4.aspx](http://www.albahari.com/threading/part4.aspx)

C# 操作仅保证对读取和写入 32 位字段是原子的。没有提到CAS。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-29T11:08:33.280

这是[一篇](http://citeseer.ist.psu.edu/cache/papers/cs/32904/http:zSzzSzwww.cs.chalmers.sezSz~phszSzTechnicalReportszSzSunT04_Deque.pdf/sundell04lockfree.pdf)描述无锁双向链表的论文。

> 我们提出了一种高效且实用的无锁并发双端队列实现，该双端队列可不相交并行访问，并使用现代计算机系统中可用的原子原语。以前已知的双端队列无锁算法要么基于不可用的原子同步原语，要么只实现功能的一个子集，要么不是为不相交的访问而设计的。我们的算法是基于一个双向链表，并且只需要一个单词的比较和交换...

Ross Bencina 有一些非常好的链接，我刚刚在大量论文和源代码示例中找到了“[关于无锁和无等待算法的一些注释](http://www.audiomulch.com/~rossb/code/lockfree/)”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T20:03:28.280

我不相信这是可能的，因为您必须一次设置多个参考，并且联锁操作的能力有限。

例如，以 add 操作为例 - 如果您在 A 和 C 之间插入节点 B，则需要在一个原子操作中设置 B->next、B->prev、A->next 和 C->prev。联锁处理不了。预设 B 的元素甚至没有帮助，因为另一个线程可能决定在您准备“B”时进行插入。

在这种情况下，我会更多地关注尽可能细粒度的锁定，而不是试图消除它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-15T22:57:26.490

Well you haven't actually asked how to do it. But, provided you can do an atomic CAS in c# it's entirely possible.

In fact I'm just working through an implementation of a doubly linked wait free list in C++ right now.

Here is paper describing it. [http://www.cse.chalmers.se/~tsigas/papers/Haakan-Thesis.pdf](http://www.cse.chalmers.se/~tsigas/papers/Haakan-Thesis.pdf)

And a presentation that may also provide you some clues. [http://www.ida.liu.se/~chrke/courses/MULTI/slides/Lock-Free_DoublyLinkedList.pdf](http://www.ida.liu.se/~chrke/courses/MULTI/slides/Lock-Free_DoublyLinkedList.pdf)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-15T06:36:30.563

阅读脚注 - 他们计划在 VS2010 最终版本之前从 4.0 中提取 ConcurrentLinkedList

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-20T18:18:46.583

可以为大多数架构上的*所有可复制数据结构编写无锁算法 [1]。*但是很难写出有效的。

我为 .Net编写了 Håkan Sundell 和 Philippas Tsigas的[无锁双向链表](http://www.researchgate.net/publication/237782379_Lock-Free_and_Practical_Deques_and_Doubly_Linked_Lists_using_Single-Word_Compare-And-Swap1)[实现。](https://github.com/2i/lfdll)请注意，由于这个概念，它不支持原子 PopLeft。

[1]：[Maurice Herlihy：无等待同步的不可能性和普遍性结果（1988 年）](http://repository.cmu.edu/cgi/viewcontent.cgi?article=2796&context=compsci)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-30T21:56:44.273

FWIW，.NET 4.0 正在添加 ConcurrentLinkedList，这是 System.Collections.Concurrent 命名空间中的线程安全双向链表。您可以阅读[文档](http://msdn.microsoft.com/en-us/library/dd381935(VS.100).aspx)或描述它的[博客文章。](http://blogs.msdn.com/pfxteam/archive/2009/03/04/9457880.aspx)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-11T20:04:20.760

我会说答案是非常有资格的“是的，有**可能**，但很难”。要实现您所要求的，您基本上需要将操作编译在一起以确保没有冲突的东西；因此，很难为此目的创建一个通用实现，并且它仍然存在一些重大限制。创建一个针对精确需求量身定制的特定实现可能会更简单，即使那样，它无论如何也不会是“简单”的。

# sql - 查看 ActiveRecord.Save() 生成的 SQL 的简单方法？

> ID：849791
> 
> 赞同：0
> 
> 时间：2009-05-11T19:58:18.133
> 
> 标签：sql, activerecord, subsonic

亚音速 2.1

我有一个 ActiveRecord 对象。当我调用它的 Save() 方法时，是否有一种简单的方法可以让我看到生成的 SQL，比如在 Visual Studio 调试器中？运行 SQL Profiler 不是一种选择。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:20:17.720

您可以将 subsonic 源项目加载到 Visual Studio 中，并将核心项目的调试目标设置为您的应用程序并运行调试器。或者，您可以将调试器附加到正在运行的应用程序。您的应用程序必须参考 subsonic 项目的当前调试输出“subsonic.dll”来构建；我通常在不同的 Visual Studio 实例中打开这两个项目。然后在activerecord.cs的180行左右设置断点：

QueryCommand cmd = GetSaveCommand(userName);

然后在cmd上观察一下sql。

# java - JFreeChart 注释

> ID：849797
> 
> 赞同：1
> 
> 时间：2009-05-11T19:59:09.253
> 
> 标签：java, jfreechart

我无法理解注释系统的工作原理。例如，我可以使用从鼠标获得的一些坐标绘制一条垂直线作为注释，但我无法在 2 个不同点之间绘制一条线。

这有效：

```
HighLowRenderer hlr=(HighLowRenderer)plot.getRenderer();

XYLineAnnotation a1=new XYLineAnnotation(chartX, 0, chartX, dataArea.getHeight(), bs1, Color.black);
hlr.addAnnotation(a1); 
```

其中 chartX 是从鼠标位置计算得出的值。

这不起作用：

```
HighLowRenderer hlr=(HighLowRenderer)plot.getRenderer();  
XYLineAnnotation a2=new XYLineAnnotation(175, 67, 230, 167, bs1, Color.black);
hlr.addAnnotation(a2); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:00:45.987

看一下[这个例子](http://www.java2s.com/Code/Java/Chart/JFreeChartPlotOrientationDemo.htm)，它将 XYLineAnnotations 添加到 XYPlot 对象（在上面你将它添加到渲染器）。

我在注释方面遇到了很多麻烦，不幸的是，我能提供的唯一真正的建议是查看[http://www.java2s.com/上的示例](http://www.java2s.com/)

# c# - WCF 403 错误

> ID：849798
> 
> 赞同：2
> 
> 时间：2009-05-11T19:59:15.573
> 
> 标签：c#, wcf, web-services, iis

我在使用 WCF 服务时遇到了不同的错误。到目前为止，该服务在我们所有的测试环境中都运行良好。我们通常让它在 Windows Server 2003 上的 IIS 6 下运行。我让它在连接到我们公司域的 Windows XP Pro VM 下运行。我们的 IT 人员最近从公司域中删除了 VM。

现在我收到如下错误：

> 现有连接被远程主机强行关闭。
> 
> 远程服务器返回错误：(403) Forbidden。
> 
> 客户端身份验证方案“匿名”禁止 HTTP 请求。

IIS 配置为允许匿名访问。IIS 用户还具有在服务文件夹中查看/执行的权限。

该服务适用于某些呼叫，但不适用于其他呼叫。应用程序在加载时调用服务，但随后在单独的调用中执行此操作。

该服务正在使用 wsHttpBinding：

```
 <wsHttpBinding>
    <binding name="wsHttpBindingSettings" maxReceivedMessageSize="2147483647">
      <security mode="None">
        <transport clientCredentialType="None" />
        <message establishSecurityContext="false" />
      </security>
      <readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647" maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
    </binding>
  </wsHttpBinding> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-25T20:03:10.783

我认为这个问题的关键是它在 Windows XP 上的 IIS 5 中运行。XP 中的 IIS 5 的最大连接数为 10。一旦超过该限制，我相信我们会收到 403 错误。我们通过使用 Server 2008 VM 而不是 XP 在笔记本电脑上进行演示来解决此问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:03:44.083

*该服务适用于某些呼叫，但不适用于其他呼叫。应用程序在加载时调用服务，但随后在单独的调用中执行此操作。*

也许有效的调用没有执行任何敏感操作，例如访问数据库或文件？IIS应用程序池在什么权限下运行，是否使用客户端模拟？这将解释这个问题..

此外，您可能想尝试此设置：

```
 <system.serviceModel>
    <behaviors>
      <serviceBehaviors>
        <behavior name="xyz">
          <!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information -->
          <serviceDebug includeExceptionDetailInFaults="True"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T15:19:52.710

同样的问题在这里，我通过向端点添加默认绑定并在可能的情况下将安全级别显式设置为“无”来缓解问题，现在它工作得更好但是如果对服务器的调用过于频繁，它会再次失败，我'还注意到，即使调用频率很高，VS2008 中的开发网络服务器也不会失败。所以它应该以某种方式与 IIS 相关，我怀疑这与安全上下文的持续时间有关，但到目前为止这些只是我的猜测，我还没有找到真正的解决方案

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T04:25:48.287

它可能是由 IIS 和 web.config 中的安全设置组合引起的。

如果 IIS 中的设置是集成和匿名的，并且 web.config 中的设置设置为 windows，则 impersonate = false。

然后，当机器在域中时，将使用集成身份验证，并且一切正常。

当机器从域中删除时，将使用匿名身份验证，然后将是用于访问资源的 IIS 匿名用户。此用户的权限有限，因此某些呼叫可能会失败。

您可以将 web.config 中的设置更改为 impersonate = false，这意味着将使用应用程序池的身份来访问资源。

# c# - 将文本框中的文本格式化为百分比

> ID：849799
> 
> 赞同：4
> 
> 时间：2009-05-11T19:59:41.983
> 
> 标签：c#, .net, vb.net, formatting

我有一个数值`Textbox`，我想将其格式化为百分比。如何在 C# 或 VB.NET 中执行此操作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T20:03:04.287

在 VB.NET 中...

```
YourTextbox.Text = temp.ToString("0%") 
```

和 C#...

```
YourTextbox.Text = temp.ToString("0%"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T01:41:09.350

基于 Larsenal 的回答，如何使用 TextBox.Validating 事件，如下所示：

```
yourTextBox_Validating(object sender, CancelEventArgs e)
{
    double doubleValue;
    if(Double.TryParse(yourTextBox.Text, out doubleValue))
    {
        yourTextBox.Text = doubleValue.ToString("0%");
    }
    else
    {
        e.Cancel = true;
        // do some sort of error reporting
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T03:21:59.157

为了增加乐趣，让我们让解析器更复杂一点。

而不是`Double.TryParse`，让我们创建`Percent.TryParse`通过这些测试的：

```
100.0 == " 100.0 "
 55.0 == " 55%  "
100.0 == "1"
  1.0 == " 1 % "
  0.9 == " 0.9  % "
   90 == " 0.9 "
 50.0 == "50 "
1.001 == " 1.001" 
```

如果我是需要输入百分比的用户，我认为这些规则看起来很公平。它允许您输入十进制值和百分比（需要“%”结束字符或输入的值大于`1`）。

```
public static class Percent {
    static string LOCAL_PERCENT = "%";
    static Regex PARSE_RE = new Regex(@"([\d\.,]+)\s*("+LOCAL_PERCENT+")?");
    public static bool TryParse(string str, out double ret) {
        var m = PARSE_RE.Match(str);
        if (m.Success) {
            double val;
            if (!double.TryParse(m.Groups[1].Value, out val)) {
                ret = 0.0;
                return false;
            }
            bool perc = (m.Groups[2].Value == LOCAL_PERCENT);
            perc = perc || (!perc && val > 1.0);
            ret = perc ? val : val * 100.0;
            return true;
        }
        else {
            ret = 0.0;
            return false;
        }
    }
    public static double Parse(string str) {
        double ret;
        if (!TryParse(str, out ret)) {
            throw new FormatException("Cannot parse: " + str);
        }
        return ret;
    }
    public static double ParsePercent(this string str) {
        return Parse(str);
    }
} 
```

当然，如果您只是将“%”符号**放在**.`TextBox`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-01T20:44:40.180

在用户输入之前在面板中填充标签（和 TexBox）的一个小技巧。这包括十进制、整数、百分比和字符串。

在任何事情发生之前在 Page_Load 事件中使用 C# 1.1：

```
if (!this.IsPostBack)

{
    pnlIntake.Visible = true    // what our guest will see & then disappear  
    pnlResult.Visible = false   // what will show up when the 'Submit' button fires   

    txtIperson.Text = "enter who";  
    lbl1R.Text = String.Format(Convert.ToString(0));     // how many times  
    lbl2R.Text = String.Format(Convert.ToString(365));   // days a year  
    lblPercentTime = String.Format("{0:p}", 0.00);       // or one zero will work '0'  
    lblDecimal = String.Format("{0:d}", 0.00);           // to use as multiplier  
    lblMoney = String.Format("{0:c}", 0.00);             // I just like money  

    // < some code goes here - if you want
} 
```

# ruby-on-rails - 如何在 Ruby on Rails 连接表中加载数据？

> ID：849801
> 
> 赞同：0
> 
> 时间：2009-05-11T20:00:02.187
> 
> 标签：ruby-on-rails, join, fixtures

我有以下有效的联接表：

```
class CreateRolesUsers < ActiveRecord::Migration
  def self.up
    create_table :roles_users,:id => false do |t|
      t.integer :role_id, :null => false
      t.integer :user_id, :null => false
    end    
  end

  def self.down
    drop_table :roles_users
  end
end 
```

但我不知道如何默认加载一些数据（语法），我尝试：

```
roleUser = RoleUser.create(:role_id => 2,:user_id => 1)
roleUser.save! 
```

它不起作用，是 RoleUser... 还是其他要使用的东西？角色用户...等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T02:41:58.427

前提是您有一个名为 RolesUser 的模型。

如果您有一个 habtm 关联，则该模型可能不存在。

加载角色的一种方法可能是；

```
user = User.create :name => 'John'
role = Role.create :name => 'admin'

user.roles << role 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:35:34.920

据我了解，你`user`可以有很多`roles`，对吧？如果是这样..

```
class User < ActiveRecord::Base
  has_and_belongs_to_many :roles
end

class Role < ActiveRecord::Base
  has_and_belongs_to_many :users
end 
```

然后你可以做

```
user = User.create :name => 'John'
role = Role.create :name => 'admin'
roles_users = RolesUser.create :user => user, :role => role 
```

该`has_and_belongs_to_many`关联创建一个包含两个 FK 的连接表。如果您需要连接表中的额外数据，则需要使用`has_may :through`而不是`has_and_belongs_to_many`.
我强烈建议阅读[ActiveRecord 关联指南](http://guides.rails.info/association_basics.html)。祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:11:30.530

您快到了。表名是模型名的复数形式。表被命名`RolesUsers`，因此模型被命名`RolesUser`。

`new`另外，如果您要在`save!`事后打电话，我认为您更愿意使用该方法。呼叫`create`自动保存记录。

```
rolesUser = RolesUser.new(role_id => 2,:user_id => 1)
rolesUser.save! 
```

推荐阅读：[http ://api.rubyonrails.org/classes/ActiveRecord/Base.html](http://api.rubyonrails.org/classes/ActiveRecord/Base.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-25T11:57:45.160

首先，当您有关联 has_and_belongs_to_many 时，您实际上没有模型，您只有从参与关联的模型组合而成的复数名称的数据库表，例如

```
class User < ActiveRecord::Base
   has_and_belongs_to_many :roles
end

class Role < ActiveRecord::Base
   has_and_belongs_to_many :users
end 
```

您不会获得名为 UserRoles 或 UsersRoles 或 UsersRole 或任何类型的模型的模型，这只会使您可以在 User 实例或 Role 实例上使用一些方法来查找 1 个用户的所有角色，或查找所有用户有一些角色蚂蚁等。

这行得通，rails 将查找名称为roles_users 的数据库表（它查找与两个模型名称以复数形式组合的表，按字母顺序排序，这就是它的roles_users 而不是users_roles 的原因）。

对于特定用户，您可以添加角色或预定义现有角色，例如：

```
# find one user
user = User.first
# get collection of roles
roles_c = Role.where("some conditional statement to find roles")
# set user roles to found collection
user.roles = roles_c
# save changes
user.save 
```

这样，您将在 roles_users 表中使用 user_id 获取记录，并且对于 roles_c 集合中的每个角色都会有记录，例如：

```
# if user.id is 1
# and in roles_c you have 3 roles with id_s 2,5 and 34
# in roles_users table there will be created 3 records with

user_id => 1, role_id => 2
user_id => 1, role_id => 5
user_id => 1, role_id => 34 
```

另一种方法是添加一些角色，

```
user = User.first
roles_c = Role.where('conditional statement')
user.roles << roles_c
user.save 
```

# python - 有没有办法使用另一个字典在 Python 字典上设置多个默认值？

> ID：849806
> 
> 赞同：9
> 
> 时间：2009-05-11T20:01:46.223
> 
> 标签：python, dictionary

假设我在 Python 中有两个字典：

```
mydict = { 'a': 0 }

defaults = {
    'a': 5,
    'b': 10,
    'c': 15
} 
```

我希望能够`mydict`使用来自 的默认值进行扩展`defaults`，这样 'a' 保持不变，但填充了 'b' 和 'c'。我知道[`dict.setdefault()`](http://docs.python.org/library/stdtypes.html#dict.setdefault)and [`dict.update()`](http://docs.python.org/library/stdtypes.html#dict.update)，但每个只做我想要的一半 - 与`dict.setdefault()`,我必须遍历每个变量`defaults`；但使用`dict.update()`,`defaults`将消除`mydict`.

是否有一些我在 Python 中找不到的功能可以做到这一点？如果没有，是否有`dict.setdefaults()`比这更 Pythonic 的方式来编写循环以重复调用：

```
for key in defaults.keys():
    mydict.setdefault(key, defaults[key]) 
```

上下文：我正在用 Python 编写一些数据来控制如何解析 XML 树。每个节点都有一个字典（即如何处理每个节点），我宁愿我写的数据是稀疏的，但用默认值填充。示例代码只是一个示例......真实代码在默认字典中有更多的键/值对。

（我意识到这整个问题只是一个小问题，但它一直困扰着我，所以我想知道是否有更好的方法来做到这一点，我不知道。）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T20:07:05.823

你不能让 mydict 成为默认值的副本，那样的话，mydict 将具有所有正确的值吗？

```
mydict = default.copy() 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T20:08:06.913

如果您不介意在此过程中创建一个新字典，则可以这样做：

```
newdict = dict(defaults)
newdict.update(mydict) 
```

现在`newdict`包含您需要的内容。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T20:11:44.583

您可以按照 Python 的工作方式执行此操作`collections.DefaultDict`：

```
class MultiDefaultDict(dict):
    def __init__(self, defaults, **kwargs):
        self.defaults = defaults
        self.update(kwargs)
    def __missing__(self, key):
        return self.defaults[key]

>>> mydict2 = MultiDefaultDict(defaults, a=0)
>>> mydict2['a']
0
>>> mydict2['b']
10
>>> mydict2
{'a': 0} 
```

到目前为止发布的其他解决方案复制了所有默认值；这个根据要求分享它们。您可能希望也可能不希望覆盖其他 dict 方法，如`__contains__()`, `__iter__()`, `items()`, `keys()`, `values()`-- 此处定义的此类仅迭代非默认项。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2021-10-13T13:09:06.640

从 Python 3.9 开始，您可以执行以下操作：

```
mydict = defaults | mydict 
```

我发现这个解决方案在我的用例中是最优雅的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T20:05:26.607

```
defaults.update(mydict) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T22:36:35.660

我个人喜欢附加字典对象。它主要像字典一样工作，只是您必须先创建对象。

```
class d_dict(dict):
    'Dictionary object with easy defaults.'
    def __init__(self,defaults={}):
        self.setdefault(defaults)           
    def setdefault(self,defaults):
        for key, value in defaults.iteritems():
            if not key in self:
                dict.__setitem__(self,key,value) 
```

这提供了与 dict 类型完全相同的功能，只是它覆盖了 setdefault() 方法，并将采用包含一个或多个项目的字典。您可以在创建时设置默认值。

这只是个人喜好。据我了解， dict.setdefault() 所做的只是设置尚未设置的项目。所以可能最简单的就地选项是：

```
new_dict = default_dict.copy()
new_dict.update({'a':0}) 
```

但是，如果您多次执行此操作，您可能会使用此功能。此时，使用自定义 dict 对象可能会更容易，而不是不断向字典添加默认值。

# reporting-services - 大型报告实施建议 250 - 300 页

> ID：849810
> 
> 赞同：4
> 
> 时间：2009-05-11T20:02:37.063
> 
> 标签：reporting-services, reporting, reportingservices-2005

我的小组最近使用 Reporting Services 2005 和 NeoDynamics 条形码组件开发了一份报告。该报告用于退货授权，由 2 个主要报告组成。

> 报告上的第一组数据是授权表，列出了所有行项目产品和一些标题信息（将其视为发票）。
> 
> 报告中的第二项是所有产品的列表，每页打印 4 个产品。每个产品都有 3 个条形码和 1 个徽标。

平均退货授权仅在几秒钟内生成，并以 PDF 格式传输给用户。平均文档长度约为 6 - 8 页。我们还有一些退货授权（很遗憾），最多可以达到 300 页左右（不到 10% 的授权超过 15 页）。Reporting Services 似乎在尝试将报表作为 PDF 组合在一起几分钟后超时。

我的问题是，将此报告转换为 PDF 格式的最佳选择是什么？我们的用户可以 24x7 全天候生成报告，并以 PDF 格式传输给他们。我们可以做些什么来提高报告服务的性能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:03:32.673

我对 Reporting Services 不是特别熟悉。我认为这是微软的产品。这意味着您可能正在与后端的 SQL Server 数据库通信。所以有两条建议。

1.  检查客户端和服务器配置，因为在某处设置了查询超时值，您可能会遇到该限制。
2.  您最好将所有必要的数据提取到临时表或某种缓存中，以便您可以在更合理的时间范围内处理数据。

(2) 无论如何都是一个好主意......它将防止锁升级和相关的坏事。

# c++ - C ++ - 在类中构造对象

> ID：849812
> 
> 赞同：32
> 
> 时间：2009-05-11T20:02:47.360
> 
> 标签：c++, constructor, oop

我对 C++ 相当陌生，对此我不确定。看看下面的例子，它总结了我当前的问题。

```
class Foo
{
    //stuff
};

class Bar
{
    Foo foo;
}; 
```

所以 Bar 包含一个完整的 Foo 对象，而不仅仅是一个引用或指针。该对象是否由其默认构造函数初始化？我是否需要显式调用其构造函数，如果需要，如何以及在哪里？

谢谢。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-11T20:06:26.153

它将由其默认构造函数初始化。如果你想使用不同的构造函数，你可能有这样的东西：

```
class Foo
{
    public: 
    Foo(int val) { }
    //stuff
};

class Bar
{
    public:
    Bar() : foo(2) { }

    Foo foo;
}; 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-11T21:43:07.617

构造在 C++ 中是一个相当困难的话题。简单的答案是*视情况而定*。Foo 是否初始化取决于 Foo 本身的定义。关于第二个问题：如何让 Bar 初始化 Foo：*初始化列表*就是答案。

虽然普遍的共识是 Foo 将由隐式默认构造函数（编译器生成）默认初始化，但这不需要成立。

如果 Foo 没有用户定义的默认构造函数，则 Foo 将未初始化。更准确地说：*缺少用户定义的默认构造函数的 Bar 或 Foo 的每个成员都将被编译器生成的 Bar 默认构造函数初始化*：

```
class Foo {
   int x;
public:
   void dump() { std::cout << x << std::endl; }
   void set() { x = 5; }
};
class Bar {
   Foo x;
public:
   void dump() { x.dump(); }
   void set() { x.set(); } 
};
class Bar2
{
   Foo x;
public:
   Bar2() : Foo() {}
   void dump() { x.dump(); }
   void set() { x.set(); }
};
template <typename T>
void test_internal() {
   T x;
   x.dump();
   x.set();
   x.dump();
}
template <typename T>
void test() {
   test_internal<T>();
   test_internal<T>();
}
int main()
{
   test<Foo>(); // prints ??, 5, 5, 5, where ?? is a random number, possibly 0
   test<Bar>(); // prints ??, 5, 5, 5
   test<Bar2>(); // prints 0, 5, 0, 5
} 
```

现在，如果 Foo 有一个用户定义的构造函数，那么它将始终被初始化，无论 Bar 是否有用户初始化的构造函数。如果 Bar 有一个用户定义的构造函数显式调用 Foo 的（可能是隐式定义的）构造函数，那么 Foo 实际上将被初始化。如果 Bar 的初始化列表没有调用 Foo 构造函数，则相当于 Bar 没有用户定义的构造函数。

测试代码可能需要一些解释。我们感兴趣的是编译器是否在没有用户代码实际调用构造函数的情况下初始化了变量。我们要测试对象是否被初始化。现在，如果我们只是在函数中创建一个对象，它可能会碰巧碰到一个未被触及且已经包含零的内存位置。我们想区分运气和成功，所以我们在函数中定义了一个变量并调用了两次函数。在第一次运行时，它将打印内存内容并强制更改。在对函数的第二次调用中，由于堆栈跟踪相同，因此变量将被保存在完全相同的内存位置。如果它被初始化，它将被设置为 0，否则它将保持与旧变量完全相同的值在完全相同的位置。

在每次测试运行中，打印的第一个值是初始化值（如果它实际上已初始化）或该内存位置中的值，在某些情况下恰好为 0。第二个值只是表示该值的测试标记手动更改后在记忆位置。第三个值来自函数的第二次运行。如果变量正在初始化，它将回退到 0。如果对象未初始化，其内存将保留旧内容。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-11T21:16:13.497

C++ 编译器将为每个类生成四个函数（如果可以，如果您不提供它们）：默认构造函数、复制构造函数、赋值运算符和析构函数。在 C++ 标准（第 12 章，“特殊函数”）中，这些被称为“隐式声明”和“隐式定义”。他们将有公共访问权限。

不要在构造函数中将“隐式定义”与“默认”混淆。默认构造函数是可以在没有任何参数的情况下调用的构造函数，如果有的话。如果您不提供构造函数，则将隐式定义默认构造函数。它将为每个基类和数据成员使用默认构造函数。

所以，发生的事情是类 Foo 有一个隐式定义的默认构造函数，而 Bar（它似乎没有用户定义的构造函数）使用其隐式定义的默认构造函数，它调用 Foo 的默认构造函数。

如果您确实想为 Bar 编写构造函数，则可以在其初始化列表中提及 foo，但由于您使用的是默认构造函数，因此您实际上不必指定它。

请记住，如果您确实为 Foo 编写了构造函数，编译器不会自动生成默认构造函数，因此如果需要，您必须指定一个。因此，如果您将类似的东西`Foo(int n);`放入 Foo 的定义中，并且没有显式编写默认构造函数（或者`Foo();`或`Foo(int n = 0);`），那么您将无法拥有当前形式的 Bar，因为它无法使用 Foo 的默认构造函数. 在这种情况下，您必须有一个构造函数，例如`Bar(int n = 0): foo(n) {}`让 Bar 构造函数初始化 Foo。（请注意，`Bar(int n = 0) {foo = n;}`或类似的方法不起作用，因为 Bar 构造函数会首先尝试初始化 foo，这会失败。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T20:06:50.677

如果您没有在 Bar 的构造函数中显式调用 foo 的构造函数，那么将使用默认的构造函数。您可以通过显式调用构造函数来控制它

```
Bar::Bar() : foo(42) {} 
```

这当然是假设您在代码中添加了 Foo::Foo(int) :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T20:06:14.127

> 所以 Bar 包含一个完整的 Foo 对象，而不仅仅是一个引用或指针。该对象是否由其默认构造函数初始化？

如果`Foo`具有默认 ctor，则类型的对象`Foo`将在您创建 type 对象时使用默认 ctor `Bar`。否则，您需要自己调用`Foo`ctor，否则您`Bar`的 ctor 会使您的编译器大声抱怨。

例如：

```
class Foo {
public:
 Foo(double x) {}
};

class Bar  {
 Foo x;
};

int main() {
 Bar b;
} 
```

以上将使编译器抱怨如下：

> “在构造函数 'Bar::Bar()' 中：第 5 行：错误：没有匹配函数调用 'Foo::Foo()'
> 
> 我是否需要显式调用其构造函数，如果需要，如何以及在哪里？

将上面的例子修改如下：

```
class Foo {
 public:
  Foo(double x) {} // non-trivial ctor
};

class Bar  {     
 Foo x;
public:
  Bar() : x(42.0) {} // non-default ctor, so public access specifier required
};

int main() {
 Bar b;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T20:06:53.000

完整的对象。不，它是在 Bar 的默认构造函数中默认构造的。

现在，如果 Foo 有一个只接受一个 int 的构造函数。您需要 Bar 中的构造函数来调用 Foo 的构造函数，并说出它是什么：

```
class Foo {
public:
    Foo(int x) { .... }
};

class Bar {
public:
    Bar() : foo(42) {}

    Foo foo;
}; 
```

但是如果 Foo 有一个默认构造函数 Foo()，编译器会自动生成 Bar 的构造函数，这会调用 Foo 的默认构造函数（即 Foo()）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T20:07:44.153

除非您另外指定，否则 foo 使用其默认构造函数进行初始化。如果你想使用其他构造函数，你需要在 Bar 的初始化列表中这样做：

```
Bar::Bar( int baz ) : foo( baz )
{
    // Rest of the code for Bar::Bar( int ) goes here...
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-15T18:52:52.263

Constructor meant for setting an initial state of object. In case of inheritance hierarchy, base class objects will be constructed in the order of inheritance hierarchy (IS-A relation in OO terminology) followed by derived class objects.

Similarly when an object is embedded in another object (HAS-A relation in OO terms or containment), constructors of embedded object are called in the order of their declaration.

The compiler parses all the members of the class B, and then generates the code for each method. At that point, it knows all the members and their order, and it'll construct the members in order, using the default constructors unless otherwise specified. So foo is constructed without calling explicitly its default constructor. What you need to do is just create object of Bar.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T20:10:59.920

您不需要在 C++ 中显式调用默认构造函数，它会为您调用。如果你想调用不同的构造函数，你可以这样做：

```
Foo foo(somearg) 
```

# java - Java中的大数

> ID：849813
> 
> 赞同：101
> 
> 时间：2009-05-11T20:02:50.183
> 
> 标签：java, numbers, integer, biginteger

我将如何在 Java 中进行非常大的数字计算？

我已经尝试过`long`，但最大值为 9223372036854775807，当使用整数时，它不能保存足够的数字，因此对于我需要的不够准确。

有没有办法解决？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-05-11T20:04:20.773

您可以将`BigInteger`类用于整数和`BigDecimal`带有小数位的数字。这两个类都在`java.math`包中定义。

例子：

```
BigInteger reallyBig = new BigInteger("1234567890123456890");
BigInteger notSoBig = new BigInteger("2743561234");
reallyBig = reallyBig.add(notSoBig); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-11T20:04:48.153

使用作为`BigInteger`Java 库一部分的类。

[http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigInteger.html](http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigInteger.html)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-11T20:33:29.400

这是一个非常快速地获得大数字的示例。

```
import java.math.BigInteger;

/*
250000th fib # is: 36356117010939561826426 .... 10243516470957309231046875
Time to compute: 3.5 seconds.
1000000th fib # is: 1953282128707757731632 .... 93411568996526838242546875
Time to compute: 58.1 seconds.
*/
public class Main {
    public static void main(String... args) {
        int place = args.length > 0 ? Integer.parseInt(args[0]) : 250 * 1000;
        long start = System.nanoTime();
        BigInteger fibNumber = fib(place);
        long time = System.nanoTime() - start;

        System.out.println(place + "th fib # is: " + fibNumber);
        System.out.printf("Time to compute: %5.1f seconds.%n", time / 1.0e9);
    }

    private static BigInteger fib(int place) {
        BigInteger a = new BigInteger("0");
        BigInteger b = new BigInteger("1");
        while (place-- > 1) {
            BigInteger t = b;
            b = a.add(b);
            a = t;
        }
        return b;
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-05-11T20:04:35.983

结帐`BigDecimal`和`BigInteger`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-10-11T12:00:35.077

```
import java.math.BigInteger;
import java.util.*;
class A
{
    public static void main(String args[])
    {
        Scanner in=new Scanner(System.in);
        System.out.print("Enter The First Number= ");
        String a=in.next();
        System.out.print("Enter The Second Number= ");
        String b=in.next();

        BigInteger obj=new BigInteger(a);
        BigInteger obj1=new BigInteger(b);
        System.out.println("Sum="+obj.add(obj1));
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-09-23T01:13:33.647

根据您正在做的事情，您可能想看看 GMP (gmplib.org)，它是一个高性能多精度库。要在 Java 中使用它，您需要围绕二进制库的 JNI 包装器。

有关使用它而不是 BigInteger 将 Pi 计算为任意位数的示例，请参阅一些 Alioth Shootout 代码。

[https://benchmarksgame-team.pages.debian.net/benchmarksgame/program/pidigits-java-2.html](https://benchmarksgame-team.pages.debian.net/benchmarksgame/program/pidigits-java-2.html)

# c# - 如何获得组合框值？

> ID：849821
> 
> 赞同：0
> 
> 时间：2009-05-11T20:03:51.710
> 
> 标签：c#, subsonic, combobox

我通常做网络编程，但在我现在正在做的这个项目中需要一个 Windows 窗体。

我正在使用 SubSonic 获取作业列表并加载组合框：

```
JobCollection jobs = new JobCollection().Load();
cboJobs.DisplayMember = "Name";
cboJobs.ValueMember = "Id";
cboJobs.DataSource = jobs; 
```

当用户选择一个项目并单击搜索按钮时，我需要使用作业“Id”字段查询数据库。

```
TransactionCollection transactions = new TransactionCollection();
if (!String.IsNullOrEmpty(txtTransactionId.Text))
{
    transactions.Where("id", txtTransactionId.Text);
}
else
{
    transactions.Where("raw_data", Comparison.Like, "%" + txtFind.Text + "%");     
}
transactions.Where("job_id", Convert.ToInt32(cboJobs.SelectedItem));
transactions.Load(); 
```

有问题的那一行是“Convert.ToInt32(cboJobs.SelectedItem)”。

我如何获得工作 ID 与名称？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T20:05:33.940

您可能想查看[`SelectedValue`](http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvalue.aspx)组合框的属性。您将 ValueMember 设置为 ID，因此[`SelectedValue`](http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvalue.aspx)应该包含正确的值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T21:21:06.313

您已经得到（一个很好的）答案，但我认为无论如何都可以指出这一点：在您的应用程序的组合框中，每个项目实际上都是一个完整的 Job 对象，而不仅仅是一个字符串表示。因此该`SelectedItem`属性将返回当前在 ComboBox 中选择的 Job 对象。您只需将其转换为 Job 即可访问其任何成员：

```
Job currentJob = cboJobs.SelectedItem as Job;
if (currentJob != null)
{
    // here you can access currentJob.Name, currentJob.Id or any other member
} 
```

# c# - VB.Net 中的匿名类初始化

> ID：849836
> 
> 赞同：12
> 
> 时间：2009-05-11T20:05:45.873
> 
> 标签：c#, vb.net, anonymous-types

我想在 vb.net 中创建一个匿名类，就像这样：

```
var data = new {
                total = totalPages,
                page = page,
                records = totalRecords,
                rows = new[]{
                    new {id = 1, cell = new[] {"1", "-7", "Is this a good question?"}},
                    new {id = 2, cell = new[] {"2", "15", "Is this a blatant ripoff?"}},
                    new {id = 3, cell = new[] {"3", "23", "Why is the sky blue?"}}
                }
            }; 
```

谢谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-11T20:40:38.157

VB.NET 2008 没有该`new[]`结构，但 VB.NET 2010 有。您不能直接在 VB.NET 2008 中创建匿名类型数组。诀窍是声明如下函数：

```
Function GetArray(Of T)(ByVal ParamArray values() As T) As T()
    Return values
End Function 
```

并让编译器为我们推断类型（因为它是匿名类型，我们无法指定名称）。然后像这样使用它：

```
Dim jsonData = New With { _
  .total = totalPages, _
  .page = page, _
  .records = totalRecords, _
  .rows = GetArray( _
        New With {.id = 1, .cell = GetArray("1", "-7", "Is this a good question?")}, _
        New With {.id = 2, .cell = GetArray("2", "15", "Is this a blatant ripoff?")}, _
        New With {.id = 3, .cell = GetArray("3", "23", "Why is the sky blue?")}
   ) _
} 
```

PS。这不称为 JSON。它被称为匿名类型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-12-19T17:16:10.973

在 VS2010 中：

```
Dim jsonData = New With {
  .total = 1,
  .page = Page,
  .records = 3,
  .rows = {
    New With {.id = 1, .cell = {"1", "-7", "Is this a good question?"}},
    New With {.id = 2, .cell = {"2", "15", "Is this a blatant ripoff?"}},
    New With {.id = 3, .cell = {"3", "23", "Why is the sky blue?"}}
  }
} 
```

# project-management - 使用 Wiki 进行需求管理？

> ID：849840
> 
> 赞同：11
> 
> 时间：2009-05-11T20:06:28.227
> 
> 标签：project-management, requirements

我一直在寻找用于开发功能规范的协作工具。我正在寻找以下能力：

*   让多个用户参与规范。
*   提供某种形式的可追溯性，如果需要，可以手动完成。
*   为用户提供添加评论和注释的能力。
*   上传和显示 Visio 文档
*   使用 Balsamiq Mockup 上传和显示模型屏幕。

我最初的印象是，使用 wiki 可能是完成这项任务的好工具。有没有人有使用 wiki 创建功能规范的经验？与需求管理工具相比，使用这样的工具有什么优缺点？

非常感谢您的意见！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T20:36:39.007

*尽管*使用 wiki ，但可以按照您的描述以协作的方式开发需求。wiki 范式在这个过程中没有任何帮助。

我在 Zend Framework 项目上管理了一个 wiki，以跟踪组件的建议。 [他们仍在使用它。](http://framework.zend.com/wiki/display/ZFPROP/Home) 提案与功能规范不同，但用法与您的问题足够相似，我认为这是相关的。

wiki 不会照顾自己。除非你有人负责管理它并确保有一些结构和一致性，否则它很快就会变得一团糟。现实世界的类比是给你的每个团队一张白纸，并告诉他们写下他们的部分需求。这方面的问题是：

*   每个贡献者都必须构建自己的文档结构，并以不同的顺序撰写不同的内容。因此，不可能将一页与另一页进行比较。
*   没有“索引页面”来组织所有不同的贡献。没有人希望页面“落入裂缝”，但在 wiki 中，这是任何页面一旦编写完成后的*默认命运。*
*   没有反馈循环来确保写作真正完成。

使其工作的方法是对项目应用一些流程，并按照该流程使用 wiki。

*   使人们能够在 wiki 中创建新页面，但只能通过自动将新页面链接到正确索引的界面。
*   定义文档的生命周期，确保它们在适当的阶段被起草、审查和批准。
*   为新页面提供模板。在每个页面中提供您需要的部分标题，并在审核过程中确认标题部分已充分填写。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T20:18:24.120

“与需求管理工具相比，使用这样的工具有什么优缺点？”

虽然这似乎是一个好主意，但你遇到的是那些不会也不会写作的人。

不会写的人——嗯——不会写。他们无法通过电子邮件或 wiki 或任何外部声音媒介进行交流。

*   有些人“杂乱无章”。实际上，写作太线性了，他们不会线性思考。

*   有些人没有得到“写给你的听众”的意思，写出难以理解的东西。

*   有时你甚至无法弄清楚他们在说什么，更不用说他们在写什么了。他们用行话或代码说话。他们知道的不多，但坚持要被倾听。

有些人不会写。

*   有些人拒绝做出承诺。即使在可以收回的wiki中。他们觉得他们必须预先讨论所有事情。

*   有些人习惯于通过给别人指示来做每件事。他们要么不为自己写作，要么让人们站在办公室里听他们说话和打字。

*   有些人通常对任何类型的项目都是有毒的。他们在最后一刻提出了新的要求。他们的第一反应是“那永远行不通”。他们不能很好地进行头脑风暴。当他们说它有效，而你请求他们改进时，他们没有。他们只知道这行不通。

我的经验是，只有程序员才能成功使用 Wiki。而且只有高级程序员。

*   N00bz 没有足够的经验从谣言和管理绒毛中梳理出设计需求。

*   N00bz 并不总是具备清晰书写的语言技能。他们最终可能会这样做，但一看他们的 Javadoc 注释就可以看出他们正在为写作的“清晰性”部分而苦苦挣扎。

它非常吸引人。我希望人们能够更好地使用 wiki，因为我认为它比一个人采访每个人并写下来的更传统的方法有很多优势。但它需要一定程度的自信和沟通技巧，而这似乎很少有人具备。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T21:11:51.287

考虑研究[Fog Bugz](http://www.fogcreek.com/FogBUGZ/)。他们吹嘘自己是项目管理中的佼佼者。考虑到乔尔的历史，我会给他们怀疑的好处。他们以您刚才描述的方式使用 wiki。

如果您是认真的，我建议您注册免费试用版。根据您项目的规模，购买它可能是一个非常好的选择。

至少你可以看看他们是如何构建它的，或者阅读论坛以获取有关如何构建自己的精简版本的想法

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T20:28:11.047

专业工具有助于让事情保持正轨并引入固定的工作流程。这就是重点，让事情保持专注和功能。使用像 Wiki 这样的通用工具对一群程序员来说可能很好，但为“混合模式”工作引入一个可能很糟糕：

1.  事情可能会迅速蔓延并偏离轨道
2.  沟通可能会在媒体中丢失

看看像 Basecamp 这样的东西。它们可以被认为是一个应用的 wiki 或协作工具。用于特定目的的通用工具需要改进。我不知道 MediaWiki 或其他人是否有足够的定制来保持事情的清洁和专注。

也许收集您的需求管理工具的需求（我知道是递归的）以及您可以从 wiki 文化和开放式沟通心态中获得哪些方面（沟通方面）。如果需求管理工具或 wiki 都不符合要求，请考虑构建一个。可能是下一个大事件。感觉就像在说*我可以使用 wiki 代替 Bugzilla 吗？*

一个用于需求管理的固定工作流 web 应用程序，强调开放式沟通，让来自不同角色的人都能看到和理解，这可能是件好事！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-16T14:43:23.760

在这种情况下，我们使用了 TWiki，现在使用了 FosWiki。有很多东西是免费的（版本控制、访问控制、基于 Web 的访问、搜索、远程​​管理、安全补丁……）。几分钟后，您可以定义：

*   定义需求属性的表，
*   它创建具有字段选择和验证的交互式表单（您还可以在其中记录讨论和基本原理，嵌入图像，附加文档，链接到其他要求......），
*   然后查询这些“需求”并将它们显示为可以排序、过滤、打印、报告等的表格（例如， http: [//jucmnav.softwareengineering.ca/ucm/bin/view/ProjetSEG/JUCMNavRequirementsVer2](http://jucmnav.softwareengineering.ca/ucm/bin/view/ProjetSEG/JUCMNavRequirementsVer2)） .

显然，一路上可以很容易地使用超链接和 Wiki 链接。如果需要，FosWiki 还具有可用于强制执行特定工作流的功能。支持用例和其他范式的表单也很容易（我们过去曾这样做过，而且通常效果很好）。

诸如 FosWiki 之类的 Wiki 是可扩展的，可以开发更多模块来解决与可追溯性管理和影响分析、基于表格的需求修改、整体打包等相关的弱点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T21:17:25.070

作为自由形式的 wiki 和需求管理工具之间的中间地带，可以考虑使用像[Foswiki这样的](http://foswiki.org/)[结构化 wiki](http://en.wikipedia.org/wiki/Structured_wiki)。我没有做过任何正式的需求管理（使用 wiki 或其他方式），但我使用 TWiki（Foswiki 的前身）来完成其他任务，它允许您根据需要定义工作流、表单字段等它们，同时在不需要正式结构时保持 wiki 的灵活性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T22:50:24.777

我同意上述所有（大多数）人的观点 - 使用 wiki 可能听起来不错，但 wiki 旨在提供信息并根据需要进行更新，而不是用作交互式项目管理工具。我强烈建议 SmartSheet（我是该产品的坚定拥护者）——它提供了一个类似电子表格的界面，您可以在其中为每行/任务存储多个文件，向用户发送自动更新并维护规范修订......另一种方法可能是使用谷歌电子邮件、文档和日历——一种免费的友好的团队互动方式……我会回避用于项目管理的问题/错误跟踪工具——它们的重点往往不同：整个项目管理工具针对特定输入问题的项目/资源/时间线和问题跟踪工具....

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-01T18:28:02.540

这现在可能有点老了，但我目前正在使用 Atlassian 的“Confluence”，它很棒。我目前是一名 UX 工程师，在敏捷过程中扮演“产品负责人”的角色。我可以记录离散界面的需求，允许多个用户的反馈和评论，并在更大的上下文（例如用户故事）中将每个界面与其他界面交织在一起。一切都非常动态和模板驱动。它非常适合我目前的需求。

# .net - .NET 是否有 OWL 推理器

> ID：849848
> 
> 赞同：4
> 
> 时间：2009-05-11T20:07:02.610
> 
> 标签：.net, owl, dig

我正在寻找一个提供 .NET API 的 OWL-DL 推理器。或者，我可以使用以任何语言编写的符合 DIG 的推理器，但我需要一个能够将 OWL 本体转换为 DIG XML 语言的 .NET 库。有人听说过这样的工具/库吗？

# ajax - 2009 年智能手机中的 AJAX 支持

> ID：849850
> 
> 赞同：2
> 
> 时间：2009-05-11T20:07:07.290
> 
> 标签：ajax, mobile, frameworks

AJAX对手机的支持有多成熟？有一些著名的 AJAX 框架的移动版本吗？即使对某些 ajax lib 的支持有限，我也会生活。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:25:16.170

iPhone 不会缓存任何大于 25 KB 的未压缩内容，这意味着 jQuery 和 Prototype 等库不会像在普通计算机上那样被缓存。我怀疑很多其他移动浏览器也会出现这种情况。

[XUI](http://xuijs.com/)是一个相当流行的精简的类 jQuery 库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:33:03.147

手机市场非常分散，您需要将自己限制在特定的技术上才能获得有用的答案。据我所知，没有可用的跨平台移动框架。然而，一些移动浏览器非常先进，它们将能够处理 jQuery 或其他库。我已经看到 jQuery 在 S60 内置浏览器以及同一平台上的 Opera（不是 mini）上运行。我还成功地在移动 IE（Windows Mobile 专业版）中运行了 jQuery。但是我不会说在这些平台上使用 jQuery 是安全的。您还想询问有关下载库的大小以及执行速度的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T13:58:13.943

Peter-Paul Koch (ppk) 开始从事移动设备兼容性测试，并为移动设备制作了[兼容性图表](http://www.quirksmode.org/m/table.html)。

一旦这些被记录下来，图书馆作者就可以开始抽象这些差异。我还不知道有多少库是跨平台的，但 Peter 的工作应该会加速开发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T13:50:01.930

您还可以查看[iWebkit](http://www.iwebkit.net)或[iUI](http://code.google.com/p/iui/)来构建 iPhone 友好的网络应用程序

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T13:44:23.560

我认为移动 ajax 还不成熟，但你应该阅读这个[wmlprogramming 线程](http://tech.groups.yahoo.com/group/wmlprogramming/message/29463)，并检查这个[dojo mobile](http://alex.dojotoolkit.org/2009/01/webkit-mobile/)的初步版本。

# wpf - WPF 内存使用 #2

> ID：849857
> 
> 赞同：2
> 
> 时间：2009-05-11T20:08:17.303
> 
> 标签：wpf, performance, memory, scroll

我问了一个[关于](https://stackoverflow.com/questions/841602/wpf-memory-usage)我在 WPF 中的内存管理问题的问题，但这是关于同一问题的不同问题。我正在使用 DotTrace 试图弄清楚发生了什么。当我启动我的应用程序时，我可以在任务管理器中看到它占用了 200MB。DotTrace 说总共 33MB。如果我只是将窗口最小化并重新打开，根据 TM 的内存占用量约为 25MB。

我有一个显示人名和图片的列表框。它最多显示 3000 人（我将处理分页，但这不是重点）。当我向下滚动时，我可以在 TM 中看到内存迅速增加。如果我只是继续向上和向下滚动，内存会快速达到 1GB。在滚动期间，基础数据没有变化，也没有我自己的事件。如果我将窗口最小化并重新打开，内存将从 1GB 下降到 25MB。

在最小化并看到 TM 中的内存下降之前，我使用 DotTrace 拍摄了一张快照，它显示的内存量与滚动前相同——大约 30MB 左右。

有人可以向我解释一下当应用程序最小化时内存会发生什么？任务管理器中显示的图可信吗？

谢谢

PS1：如果我将其添加或不添加到我的列表框中，行为没有变化：

```
VirtualizingStackPanel.IsVirtualizing="True" 
VirtualizingStackPanel.VirtualizationMode="Recycling" 
```

PS2：我在代码上放了一个按钮，如果有的话，GC 并没有回收太多（它从 700MB 下降到 680MB）：

```
 GC.Collect();
    GC.WaitForPendingFinalizers(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T22:22:46.633

不能给你一个明确的答案，但有几点需要指出：

1.  DotTrace 仅显示托管内存使用情况。看起来您的应用程序正在使用大量非托管内存（可能由 WPF 本身为所有这些图像分配）。

2.  最小化进程通常不会释放任何内存，它只是将其分页以便其他应用程序可以使用它。在这种情况下，这是一个红鲱鱼。

3.  看看 .Net 的分代垃圾收集是如何工作的。

4.  在您的进程达到操作系统设置的资源限制之前，它不一定会释放分配给它的任何内存。

5.  使用 Windows 内置的性能计数器。它们将向您展示比 DotTrace 更有用的应用程序内存的整体细分，包括托管和非托管内存。

6.  DotTrace 很烂。拿蚂蚁什么的。我喜欢 ReSharper，但 Jetbrains 真的不应该为 DotTrace 收费，这太可悲了。

编辑：4）有点误导-.Net的内存管理器可以出于其他原因释放内存（当一代已满时，对于初学者）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:12:27.017

如果您使用的是虚拟化容器，则视觉对象将在您滚动时动态创建。这反过来可能会导致 GC 出现一些问题，因为您正在非常快速地创建相当大的对象。一旦你最小化，我会假设 GC 正在启动并收集所有这些可视对象。

编辑：

看到您的编辑后，您可能想尝试将 设置[`IsVirtualizing`](http://msdn.microsoft.com/en-us/library/system.windows.controls.virtualizingstackpanel.isvirtualizing.aspx)为`false`进行测试。默认值为`true`，因此省略它不会改变任何内容。

# algorithm - 确定算法的最坏情况复杂度

> ID：849867
> 
> 赞同：2
> 
> 时间：2009-05-11T20:09:37.100
> 
> 标签：algorithm, complexity-theory, time-complexity

有人可以向我解释如何确定算法的最坏情况复杂性。我知道我们需要使用方程 W(n) = max{t(I)|I 的 D 元素)，其中 D 是大小为 n 的输入集。我是否计算为每个元​​素执行的操作次数，然后取其最大值？有什么更简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:02:51.990

从方程式开始考虑有点倒退。你真正关心的是可扩展性，或者，当你增加输入的大小时它会做什么。

例如，如果您只有一个循环，那么您就有一个 O(n) 时间复杂度算法。但是，如果您在另一个循环中有一个循环，则它变为 O(n^2)，因为它现在必须为任何大小的 n 输入执行 n^2 很多事情。

当您谈论最坏的情况时，您通常谈论的是非确定性算法，其中您可能有一个可以过早停止的循环。为此，您要做的是假设最坏的情况并假装循环将尽可能晚地停止。所以如果我们有：

> for(int i = 0;i < n;i++){ for(int j = 0;j < n;j++){ if(rand() > .5) j = n; } }

我们会说最坏的情况是 O(n^2)。尽管我们知道中间循环很可能会提前结束，但我们正在寻找可能的最差性能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T23:38:16.963

这个方程更像是一个定义而不是一个算法。

所讨论的算法是否关心输入大小以外的任何内容？如果不是，那么计算 W(n) 是“容易的”。

如果是这样，请尝试提出病态输入。例如，使用快速排序，很明显排序后的输入是病态的，您可以进行一些计数以查看它需要 O(n^2) 步。那时你可以

1.  认为您的输入“最大程度”是病态的
2.  在任何输入的运行时显示匹配的上限

#1 的示例：

> 每次快速排序都会将枢轴放在正确的位置，然后在这两个部分上递归。（**手电警报**）最坏的情况是让阵列的其余部分位于枢轴的一侧。排序的输入实现了这一点。

#2 的例子：

> 快速排序的每一遍都将枢轴放在正确的位置，因此不会超过 O(n) 遍。每次通过不超过 O(n) 的工作。因此，没有任何输入会导致快速排序的时间超过 O(n^2)。

在这种情况下，＃2要容易得多。

# cross-platform - 移植到哪些游戏平台？

> ID：849868
> 
> 赞同：0
> 
> 时间：2009-05-11T20:09:40.140
> 
> 标签：cross-platform, portability

我正在开发一个非常便携的独立游戏引擎，以及一个与之配套的“演示”游戏。然而，在未来我想制作一个更全面的游戏来部署在一些不同的平台上。未来游戏的细节不太重要，我更关注“如何”而不是“什么”——类型和内容与我无关。

那么你会推荐什么目标平台呢？您为该平台成功开发了哪些*便宜的功能（非常震撼）？*请记住成本效益，因为我的预算不允许购买价格为 10k U$ 的 SDK。

编辑：我对*您*为某个平台成功开发的廉价功能非常感兴趣。*例如，“我很快就*为 iPod 制作了这款很棒的两指触摸输入控制方法，用于复古类型的这个和那个游戏，它**震撼了**——我真的可以推荐那个平台/方法！”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T20:11:41.840

由于您的预算不允许购买价值数万美元的开发套件，因此您的选择有点有限——Playstation、Wii 和原生 XBox 开发已经过时了。

我推荐使用 XNA Game Studio 的 Windows PC 和 Xbox 360。XNA 是免费的，可以在这两个平台上运行。它也有很好的开发者追随者，并且有很多博客和网站提供信息、提示和技巧以及示例。您可以从[http://creators.xna.com](http://creators.xna.com)开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:11:41.387

PC - 免费 SDK :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T20:58:22.603

这对您没有帮助，但值得一提：[World of Goo](http://www.worldofgoo.com/)引起了轰动，并针对 Mac、Windows、Linux 甚至 Wii 发布。[据称](http://en.wikipedia.org/wiki/World_of_Goo)他们使用了名为**Experimental Gameplay Project**的东西，但它似乎[还没有发布](http://www.experimentalgameplay.com/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T21:09:05.443

PC、Linux、Mac、Iphone、Xbox 360 的 XNA 以及 Nintendo DS 和 Sony PSP homebrew 都是非常有趣的目标。编写一个可以为所有这些目标工作的引擎是一个有趣的挑战，但它是可以实现的。

如果您将事物抽象得足够好，以至于您可以达到所有这些目标，那么将其扩展到诸如...之类的商业产品... WiiWare 在未来不会有太大的交易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T20:13:30.620

你也可以让你的游戏引擎跨平台，这样你就可以同时为 linux 和 windows 开发。如果您将演示引擎用于游戏公司的未来职位，那么您将获得巨大的成就。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:14:22.193

如果您想考虑在 Wii/PS/等上进行开发。迈克尔指出的控制台可能超出您的价格范围，请考虑自制开发套件。它们不受支持或认可，但就使用这些技术而言，它们可能会帮助您决定将来是否要使用这些 SDK。

我希望你开始的任何项目都能顺利进行！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T20:55:33.653

我认为“什么”的问题在选择平台时非常重要，因为平台对谁将接触你的游戏以及如何玩游戏有着重大影响。

您是否正在开发一款面向坐在屏幕周围的多人的游戏，例如。琐事游戏，格斗游戏，体育游戏等？那么你可能想看看像 360 这样的控制台。你在寻找更深层次的东西吗？矮人要塞，还是下一个伟大的六角战争游戏？你可能想去PC。射手？有鼠标的东西。又是电脑。需要一千个不同按钮的飞行模拟游戏？带有键盘的东西，就像PC一样。您正在构建一个简单的 Popcap 风格的益智游戏吗？您可能会查看某种手持设备的 SDK。

告诉我们您想要构建什么，我们可以推荐一个平台

编辑：如果是我，无论如何PC都是我的默认平台

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T21:03:39.553

如果您想为 PC 开发，我可以建议[Simple DirectMedia Layer](http://www.libsdl.org/) (SDL) 吗？

*   它是一个跨平台（Linux、Windows、**Mac**（我们需要更多游戏，拜托！）、BSD 和其他没人关心的）库，用于开发为游戏量身定制的图形。
*   [有史以来最好的游戏](http://sc2.sourceforge.net/)（至少在我看来）是用它编写的。
*   它是免费和开源的，但在许可许可下发布，因此您可以使用在其上编写的代码做任何您想做的事情。如果您选择这样做，您甚至可以深入了解它的内部结构，看看如何将它移植到 SDL 不支持的平台上。

# c# - C# 同时控制台输入和输出？

> ID：849876
> 
> 赞同：7
> 
> 时间：2009-05-11T20:11:43.820
> 
> 标签：c#, console

我正在编写一个服务器应用程序，我希望它是基于控制台的。我需要用户能够输入不同的命令，但同时有可能在用户编写时将某些内容输出到控制台。这会弄乱缓冲区。有什么干净的方法可以做到这一点吗？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T23:59:00.093

我开始编写一个测试程序，以展示如何将控制台划分为输出区域和输入区域，其中输入区域随着输出区域的扩展而向下移动，输出更多。它还不完美，但您可以将其开发为您正在寻找的答案：

```
 static int outCol, outRow, outHeight = 10;

  static void Main(string[] args)
  {
     bool quit = false;
     System.DateTime dt = DateTime.Now;
     do
     {
        if (Console.KeyAvailable)
        {
           if (Console.ReadKey(false).Key == ConsoleKey.Escape)
              quit = true;
        }
        System.Threading.Thread.Sleep(0);
        if (DateTime.Now.Subtract(dt).TotalSeconds > .1)
        {
           dt = DateTime.Now;
           WriteOut(dt.ToString(" ss.ff"), false);
        }            
     } while (!quit);
  }

  static void WriteOut(string msg, bool appendNewLine)
  {
     int inCol, inRow;
     inCol = Console.CursorLeft;
     inRow = Console.CursorTop;

     int outLines = getMsgRowCount(outCol, msg) + (appendNewLine?1:0);
     int outBottom = outRow + outLines;
     if (outBottom > outHeight)
        outBottom = outHeight;
     if (inRow <= outBottom)
     {
        int scrollCount = outBottom - inRow + 1;
        Console.MoveBufferArea(0, inRow, Console.BufferWidth, 1, 0, inRow + scrollCount);
        inRow += scrollCount;
     }
     if (outRow + outLines > outHeight)
     {
        int scrollCount = outRow + outLines - outHeight;
        Console.MoveBufferArea(0, scrollCount, Console.BufferWidth, outHeight - scrollCount, 0, 0);
        outRow -= scrollCount;
        Console.SetCursorPosition(outCol, outRow);
     }
     Console.SetCursorPosition(outCol, outRow);
     if (appendNewLine)
        Console.WriteLine(msg);
     else
        Console.Write(msg);
     outCol = Console.CursorLeft;
     outRow = Console.CursorTop;
     Console.SetCursorPosition(inCol, inRow);
  }

  static int getMsgRowCount(int startCol, string msg)
  {
     string[] lines = msg.Split('\n');
     int result = 0;
     foreach (string line in lines)
     {
        result += (startCol + line.Length) / Console.BufferWidth;
        startCol = 0;
     }
     return result + lines.Length - 1;
  } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-22T05:57:31.267

就我个人而言，我会使用事件处理程序来管理一个同时处理输入和输出的控制台，创建一个类 ScreenManager 或其他任何东西，在该类中添加一个 void RunProgram() 方法，使用处理程序和读取所需的变量创建一个事件输入键“Console.ReadKey(bool).key”。

```
static Consolekey newKey; 
```

在你的主程序上，创建你的类的一个实例“你叫什么”，然后创建一个该实例内部方法的线程， Thread coreThread = new Thread(delegate() {myinstance.myProgramMrthod()});

在你的主线程中循环，直到线程启动并运行。而 (!Thread.IsAlive) ;

然后创建主程序循环。

```
while (true)
{
} 
```

然后为了安全起见，加入您的自定义线程，以便主程序在自定义线程关闭/处置之前不会继续。

```
customThread.Join(); 
```

你现在有两个线程分别运行。

回到您的班级，在您的事件处理程序方法中创建一个开关。

```
switch (newkey)
{
case Consolekey.enter
Console.WriteLine("enter pressed");
break;

ect, ect.

default:
Console.write(newkey); // writes character key that dont match above conditions to the screen. 
break;
} 
```

将您的所有逻辑与您希望如何处理键结合在一起。 [如何在 C# 中使用多个修饰键](https://stackoverflow.com/questions/1434867/how-to-use-multiple-modifier-keys-in-c-sharp) 可能会有所帮助。

在您的实例的方法 RunProgram() 或您选择调用它的任何方法中，在您完成所需的任何代码后，创建一个无限循环以检查密钥更改。

```
while (true)
{
newKey = Console.ReadKey(true).Key;
if (newKey != oldKey)
{
KeyChange.Invoke();
}
} 
```

此循环存储按下的任何键，然后检查是否有新键，如果 true 触发事件。

您现在有了您要查找的内容的核心，一个循环询问新键的字符串，而主循环可以自由显示您希望显示的任何文本。

我能想到的两个可修复的错误，一个是开关内部的“默认”，将以大写字母或字符串形式打印到控制台。另一个是添加到控制台的任何文本都添加到光标点，因此它添加到用户刚刚输入的文本中。

不管我会怎样，因为我刚刚做到了，你必须如何管理添加到控制台的文本。我再次使用一个事件。我可以在整个过程中使用方法和函数，但我认为事件为程序增加了移动灵活性。

好的，所以我们希望能够将文本添加到控制台，而不会破坏我们输入的输入。将输入保持在底部；

创建一个具有字符串参数签名的新委托，void delegate myDelegate(string Arg)。然后用这个委托创建一个事件，把它叫做换行符、新输入，你喜欢什么。

事件处理程序将接受一个字符串参数（代表控制台更新文本：您要在用户输入上方插入控制台的内容）它将获取用户输入控制台的文本，存储它，然后打印出参数字符串到控制台，然后在下面打印出用户输入。

我个人选择在方法外的顶部创建一个静态字符串，将其初始化为空，因为它会被频繁使用，并且您不想创建一个新的标识符，然后在每次调用该方法时初始化变量，然后处置它在方法结束时，只是为了重新创建一个新的，一次又一次。

调用字符串“输入”或其他。

在 keychange 事件句柄的默认区域添加输入 +=newkey。

在 Consolekey.enter 部分控制台 writline 输入然后 input = string.empty 或 string = ""。

在事件处理程序中添加一些逻辑。

```
public void OnInsert(string Argument)
        {
            Console.CursorTop -= 1;

    // moves the cursor to far left so new input overwrites the old.

    // if arg string is longer, then print arg string then print input  // string.

            if (Argument.Length > input.Length)
            {
                Console.WriteLine(Argument);
                Console.WriteLine(input);
            }
            else
            {

    // if the users input if longer than the argument text then print
    // out the argument text, then print white spaces to overwrite the
    // remaining input characters still displayed on screen.

                for (int i = 0; i < input.Length;i++ )
                {
                    if (i < Argument.Length)
                    {
                        Console.Write(Argument[i]);
                    }
                    else
                    {
                        Console.Write(' ');
                    }
                }
                Console.Write(Environment.NewLine);
                Console.WriteLine(input);
            }
        }

hope this helps some of you, its not perfect, a quick put together test that works enough to be built on. 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T20:50:52.243

如果您需要在用户键入时允许输出到达，我建议将输出发送到新窗口。因此，您可以有一个用于启动应用程序的窗口，然后它会产生一个线程来打开一个新的控制台进行输入，然后它会继续将任何输出消息发送到原始窗口。如果您尝试将所有内容都放在同一个窗口中，我认为您会遇到太多资源锁定问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T21:07:43.213

如果您将服务器视为客户端/服务器应用程序，则此类事情会变得更加简单。让服务器与发送命令和接收输出的客户端管理应用程序有“n”个连接。客户端应用程序可以完全分离输入和输出，一个线程处理输入，一个线程处理输出。

如果输入线程正在进入一行，则输出线程可能会阻塞，并在取消或提交该行时解除阻塞。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-12T10:38:45.050

我的示例使用`Console.MoveBufferArea()`，但请注意，这不适用于 Windows 以外的平台，因为该方法[未](https://github.com/dotnet/corefx/issues/22992#issuecomment-320787978)在这些平台上实现。

在此示例中，您将在代码中使用`Read()`代替`Console.ReadLine()`和`Log(...)`代替。`Console.WriteLine(...)`

```
class Program
{
    static void Main(string[] args)
    {
        // Reader
        new Thread(() =>
        {
            string line;
            while ((line = Read()) != null)
            {
                //...
            }
            Environment.Exit(0);
        }).Start();

        // Writer
        new Thread(() =>
        {
            while (true)
            {
                Thread.Sleep(1000);
                Log("----------");
            }
        }).Start();

    }

    static int lastWriteCursorTop = 0;
    static void Log(string message)
    {
        int messageLines = message.Length / Console.BufferWidth + 1;
        int inputBufferLines = Console.CursorTop - lastWriteCursorTop + 1;

        Console.MoveBufferArea(sourceLeft: 0, sourceTop: lastWriteCursorTop,
                               targetLeft: 0, targetTop: lastWriteCursorTop + messageLines,
                               sourceWidth: Console.BufferWidth, sourceHeight: inputBufferLines);

        int cursorLeft = Console.CursorLeft;
        Console.CursorLeft = 0;
        Console.CursorTop -= inputBufferLines - 1;
        Console.WriteLine(message);
        lastWriteCursorTop = Console.CursorTop;
        Console.CursorLeft = cursorLeft;
        Console.CursorTop += inputBufferLines - 1;
    }
    static string Read()
    {
        Console.Write(">"); // optional
        string line = Console.ReadLine();
        lastWriteCursorTop = Console.CursorTop;
        return line;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:18:14.993

您是否尝试过调用[OpenStandardInput](http://msdn.microsoft.com/en-us/library/system.console.openstandardinput.aspx)，读取任何输入并重置其位置，然后写入输出流。之后，您可以再次调用 OpenStandardInput 并将数据填充回流中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T20:50:55.223

我认为没有完美的方法可以做到这一点。telnet 所做的（至少是我使用的最后一个版本）不是打印任何输入（只需读取击键），而是在输出到达时简单地打印输出。另一种方法是将需要输出到控制台的任何数据存储在缓冲区中，并且仅在用户完成输入命令后才打印。（你甚至可以给输出加上时间戳，让它更明显。）我真的找不到更好的选择——你不可避免地会遇到使用同步 I/O 接口（即命令行）的问题后端的异步操作。

# java - 使用 Java 的目录创建 Word/RTF 文件

> ID：849879
> 
> 赞同：1
> 
> 时间：2009-05-11T20:12:21.103
> 
> 标签：java, ms-word

我想用 Java 的目录（每个部分的链接）创建一个 Word 或 RTF 文件。据我了解，iText 和 Apache POI 不支持生成目录。该应用程序的某些客户端仍在使用旧版本的 Word，因此我需要一个支持旧 Word 文档格式的库。有谁知道我该怎么做？

谢谢，

格伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T20:20:14.943

查看[OpenOffice 的 Java API](http://api.openoffice.org/)。它会做你想做的事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-13T06:47:18.583

迟到，但可能对其他人有帮助。 [Docmosis](http://www.docmosis.com)在这里是一个不错的选择。它适用于 OpenOffice API，但您不必花时间学习该 API。它提供模板填充和操作、一系列数据源选项以及 OpenOffice 的所有输入和输出选项。具体来说，它还在文档呈现的最后阶段更新 TOC 和索引。

# vb6 - 指定 ODBC 的默认驱动程序

> ID：849887
> 
> 赞同：10
> 
> 时间：2009-05-11T20:15:10.990
> 
> 标签：vb6, odbc, adodb, dsn

我有一个旧版 VB6 应用程序，它基于配置文件中的参数构建 DSN。该参数是一个 ODBC 连接，该连接有一个名称 (DSN-NAME)，它将服务器 (DBSERVER) 映射到驱动程序（“SQL Server Native Client”）。

通常，它会像这样构建一个 DSN：

> DSN=DSN-NAME；用户=foo；密码=bar

如果我在文件中指定一个主机名，它会建立一个连接字符串，上面写着

> DSN=DBSERVER；用户=foo；密码=bar

报告的错误信息是：

> [Microsoft][ODBC Driver Manager] 未找到数据源名称且未指定默认驱动程序

这向我表明，也许有一种指定默认驱动程序的方法，这可能意味着我可以只在配置文件中指定服务器名称，而无需创建 ODBC 连接。

（我知道这些可以自动创建；这只是为了简单地安装，并满足我的好奇心）。

如何指定默认驱动程序？如果我可以将默认驱动程序设置为 SQL Server Native Client，那么我可以说 DSN=DBSERVER 并连接吗？

***编辑：***重点是在不更改连接字符串的情况下尝试这样做。所有的研究都表明这实际上是不可能的，但对话的措辞表明它可能是。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-11-19T12:53:04.600

我遇到了同样的问题，并通过使用 32 位 ODBC 管理员创建 32 位 DSN 而不是管理工具中的 64 位管理员来修复它，后者仅创建不起作用的 64 位 DSN。

32 位 ODBC 管理器位于`C:\Windows\SysWOW64\odbcad32.exe`

请参阅Corey Gilmore 博客上的这篇文章[“未找到数据源名称且未指定默认驱动程序” 。](http://coreygilmore.com/blog/2010/04/14/odbc-driver-manager-data-source-name-not-found-and-no-default-driver-specified/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:22:09.793

要指定默认驱动程序，请在连接字符串中使用 DRIVER=：

```
DRIVER=driver name here;DATABASE=mydb;USER=foo;PASSWORD=bar 
```

驱动程序名称是显示在控制面板 ODBC 配置工具中的每个驱动程序的名称。请注意，您需要提供通常来自 DSN 的信息，在本例中为数据库名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-22T19:17:33.030

您可以通过将“;SERVER=dbserver”附加到您的连接字符串来实现您想要的。

您的 DSN 中已经指定了一个服务器，但是您的连接字符串中的 SERVER 关键字将覆盖它。

[http://msdn.microsoft.com/en-us/library/ms715433(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms715433(VS.85).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-12T15:13:09.230

使用无 DSN 连接字符串...它可以“即时”创建以完全适合您的目的...无需使用 odbcad32.cpl 或 reg/ini 文件来控制/配置所需的 dsn。

请参阅[http://support.microsoft.com/kb/147875](http://support.microsoft.com/kb/147875)

详情

# visual-studio - 从 Visual Studio 项目文件夹中消除所有中间文件的最佳方法？

> ID：849891
> 
> 赞同：3
> 
> 时间：2009-05-11T20:17:30.533
> 
> 标签：visual-studio

当 IDE 将随机的非源文件放到我的源目录中时，我是那些不喜欢它的人之一。特别是如果这些是作为构建的一部分生成的。

我发现通过同时覆盖“<IntermediateOutputPath>”和“<BaseIntermediateOutputPath>”，我可以将留下的烂摊子去掉，只剩下几个空目录，我想这是我可以容忍的。

但是，使用“<BaseIntermediateOutputPath>”会导致 Visual Studio 询问我是否真的要打开该项目，因为它认为这是一个“不安全”的添加。

有谁知道如何禁用此安全检查，或者可能是在不使用“<BaseIntermediateOutputPath>”的情况下摆脱所有中间文件的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-19T20:25:16.043

您是否尝试过在项目的构建后事件中编写宏。你应该能够执行

```
DEL -S -Q MyProject/bin/*.*
DEL -S -Q MyProject/obj/*.* 
```

希望这可以帮助，

账单

# sifr - sifr 3 - 在我的智慧尽头试图让文本块不换行

> ID：849892
> 
> 赞同：1
> 
> 时间：2009-05-11T20:17:50.220
> 
> 标签：sifr

期待对此任何方面的任何帮助/评论，但主要问题是关于 sIFR 文本换行，以及如何禁止它。这应该是一个简单的 html 化工作（哈哈哈）

[在这里查看](http://esdaile-ryus.com/clientarea/fluidtrade/newhtml/)

所以我将导航和内容剪辑框放在表格中，我知道你们纯粹主义者可能会不屑一顾，但这似乎是最简单/最一致的方式......请原谅。

问题是 sIFR - 我无法让导航项目之一（“交换技术”）正常运行；它一直在包装。与此同时，小内容框中的 sIFR 头条也变得不守规矩，并试图逃避。

我堵塞了 CSS 试图在各种元素中修复它——如果 sIFR 专家能检查一下，看看是否有任何关于使 sIFR 头工作的建议，我将永远感激不尽。

请注意，我不需要在 sIFR 元素的底部进行任何填充，因为标题全部大写。

如果有帮助，我可以发送设计师正在寻找的图像。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T08:43:08.070

`forceSingleLine`参数 for`sIFR.replace()`是解决此问题的最简单方法。当 Flash 文本比 HTML 文本更宽时，通常会出现问题，并且被替换的元素恰好是 HTML 文本的宽度。在这种情况下，如果不换行，sIFR 文本将不适合允许的空间。

另一种解决方案是`letter-spacing`通过`.sIFR-active .myNavItemToBeReplaced`CSS 规则使用，使 HTML 文本更宽，以便 Flash 文本在不换行的情况下适合。

# ruby-on-rails - Rails Migrations 可以用来转换数据吗？

> ID：849897
> 
> 赞同：32
> 
> 时间：2009-05-11T20:19:06.383
> 
> 标签：ruby-on-rails, ruby, migration

我正在尝试将 Rails 应用程序中的列转换为参数，让我们假设我正在尝试将表中的`age`列更改`users`为字符串表示形式而不是 int。

在我的迁移中，我有这个；

```
def.self up
    add_column :users, :age_text, :string

    users = User.find(:all)

    users.each do |u|
       u.age_text = convert_to_text(u.age)
       u.save
    end
end

def self.convert_to_text(number)
   #code here to convert 1 to 'one' etc
end 
```

但这似乎不起作用，我在这里尝试的内容是否可以通过迁移来实现？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-05-11T21:52:49.257

您尝试做的事情是可能的，我会说正确的事情。

但是，您需要重新加载您在迁移中更新的模型类的列信息，以便 Rails 知道新列。试试这个：

```
def.self up
    add_column :users, :age_text, :string

    User.reset_column_information 

    users = User.find(:all)

    users.each do |u|
       u.age_text = convert_to_text(u.age)
       u.save
    end
end 
```

另外请注意，如果您的表很大，则一个一个地进行更新将花费很长时间。请注意这一点。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-05-14T15:07:13.993

由于我是新来的，因此无法对上述内容发表评论，因此我将添加自己的答案。

通常在迁移中操纵数据是一个坏主意。如果模型逻辑发生变化，直接访问模型的迁移可能会卡住。

想象一下，在您的第二次迁移中，您添加了一个新列。您想用新数据播种该列。

再假设几周后，您向模型添加了一个新的验证 - 一个在您的第二次迁移中尚不存在的字段上运行的验证。如果你曾经从迁移 0 构建数据库，你会遇到一些问题。

我强烈建议使用迁移来更改列和其他方式来管理数据库数据，尤其是在迁移到生产环境时。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-12-22T06:46:02.290

这是我为转换数据而运行的示例迁移。您可以轻松地将其转换为使用整数而不是字符串。在 SQL 中进行转换比在 Rails 中加载每一行要快得多。

```
class ConvertCommentTextToText < ActiveRecord::Migration
  def up
    add_column :comments, :text_tmp, :text
    # copy text column
    execute <<-SQL
      update comments set text_tmp = text
    SQL
    remove_column :comments, :text
    rename_column :comments, :text_tmp, :text
  end

  def down
    add_column :comments, :text_tmp, :string
    # copy text column
    execute <<-SQL
      update comments set text_tmp = text
    SQL
    remove_column :comments, :text
    rename_column :comments, :text_tmp, :text
  end

end 
```

并对其进行测试：

```
rake db:migrate
rake db:rollback
rake db:migrate 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T17:57:32.250

我想说，如果您可以在回滚迁移版本时“撤消”导入的数据，那么将导入放入迁移中是合适的。

例如，我有一个迁移，它设置了很多查找表和其他元数据。在此阶段填充这些表的数据。随着这些查找表的数据发生变化，我创建了新的 YAML 文件来存储元数据并在后续迁移中加载这些文件（并撤消这些 YAMLS，在退出迁移版本时重新加载以前的 YAML 文件）。这很干净。我有这些文件的文件（在我的情况下位于不同的定义明确的文件夹中）：

```
002_setup_meta_data.rb
002_meta_data.yaml

007_change_meta_data.rb
007_meta_data.yaml 
```

如果您要将“生产”数据从另一个系统导入事务（非静态）表，那么我会说使用迁移是不合适的。然后我会按照 Brian Hogan 的建议使用 rake 任务。

# c# - 编译导致双重警告

> ID：849898
> 
> 赞同：3
> 
> 时间：2009-05-11T20:19:42.760
> 
> 标签：c#, msbuild, warnings

我有一个 WPF 项目，Visual Studio/MSBuild 的编译似乎做了 2 遍，后者添加了一些临时资源文件，例如

```
csc <options> <files>
csc <options> <files> /resource:obj\Debug\Project.g.resources 
```

我怀疑您无法解决此问题（至少在不放弃代码生成或 XAML 的情况下无法解决）。但我面临的问题是每个编译器警告都会加倍。更糟糕的是，它们使用不同的语言！例如对我来说英语和德语，第一遍产生英语警告，第二遍产生德语警告：

```
 5  The event 'SomeEvent' is never used           Foo.xaml.cs  29
 8  Unreachable code detected                     Bar.cs       33
34  Unerreichbarer Code wurde entdeckt.           Bar.cs       33
44  Das Ereignis "SomeEvent" wird nie verwendet.  Foo.xaml.cs  29 
```

显然，这会产生很多噪音。

这是正常行为还是我在这里做错了什么？有什么方法可以改善这一点吗？它应该只显示一次警告，最好是英文。但是德语的一切就足够了，也是。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T20:43:04.113

当您的 XAML 文件引用在同一项目中定义的类型（即 xmlns:local="..."）时，MSBuild 过程会生成一个临时项目来构建类型，以便 XAML 编译器可以正确生成 BAML 和/或部分支持类。

您可以通过将这些类型移动到将在您的 XAML 项目之前编译的不同程序集来修复您的双重错误消息。

我很难理解为什么它使用不同的语言来报告两次传递的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:38:50.267

吉克斯，

双虚拟机或者资源？不知道，尝试使用 /nowarn 强行删除它。

等待解决方案。

# model-view-controller - 简单的 MVC NerdDinners Lambda

> ID：849900
> 
> 赞同：4
> 
> 时间：2009-05-11T20:19:59.627
> 
> 标签：model-view-controller, lambda, nerddinner

在 Microsoft 的 MVC 教程 NerdDinners 的这段代码中：

> 公共类 DinnerRepository {
> 
> ```
> private NerdDinnerDataContext db = new NerdDinnerDataContext();
> 
> //
> // Query Methods
> 
> public IQueryable<Dinner> FindAllDinners() {
>     return db.Dinners;
> }
> 
> public IQueryable<Dinner> FindUpcomingDinners() {
>     return from dinner in db.Dinners
>            where dinner.EventDate > DateTime.Now
>            orderby dinner.EventDate
>            select dinner;
> }
> 
> public Dinner GetDinner(int id) {
>     return db.Dinners.SingleOrDefault(d => d.DinnerID == id);
> }
> 
> //
> // Insert/Delete Methods
> 
> public void Add(Dinner dinner) {
>     db.Dinners.InsertOnSubmit(dinner);
> }
> 
> public void Delete(Dinner dinner) {
>     db.RSVPs.DeleteAllOnSubmit(dinner.RSVPs);
>     db.Dinners.DeleteOnSubmit(dinner);
> }
> 
> //
> // Persistence 
> 
> public void Save() {
>     db.SubmitChanges();
> } 
> ```
> 
> }

有什么作用：

> ```
> public Dinner GetDinner(int id) {
>     return db.Dinners.SingleOrDefault(d => d.DinnerID == id);
> } 
> ```

“d”是什么意思？这段代码是如何工作的？我知道它会带回与函数参数中的 id 匹配的晚餐。我不明白“d 去...”的意思。我知道这是一个 lambda，但我真的不明白。“d”是干什么用的？它有什么作用？

这是否可以在没有 lambda 的情况下编写（如何）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T20:38:53.260

您可能应该阅读[匿名方法](http://msdn.microsoft.com/en-us/library/0yw3tz5k(VS.80).aspx)。

基本上，您所指的代码可以写成没有像这样的 Lamba 语法的匿名方法：

```
public Dinner GetDinner(int id) {    
   return db.Dinners.SingleOrDefault(delegate (Dinner d) {
                                       return d.DinnerID == id;
                                     });
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:25:19.727

您需要了解 lambda 语法及其用途。

这是[一篇](http://blogs.msdn.com/ericwhite/pages/Lambda-Expressions.aspx)很好地解释它的文章。

但是，为了简短地回答您关于 NerdDinner 上下文的问题，此上下文中的“d”只是传递给作为晚餐对象的 lamda 表达式的参数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T20:28:10.690

这也很相似……

```
from d in db.Dinners
where d.DinnerID == id
select d 
```

代码基本上围绕返回第一个晚餐的晚餐进行循环，如果没有找到则返回默认值。

在这种情况下，示例中使用的命名约定在生产中并不总是合适的。通常使用“d”作为局部变量，选择变量名“dinner”可能更合适，尽管在这种情况下，d 的范围很小，只要你知道，无论哪种方式都很清楚lambda 表达式是如何工作的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T20:40:08.343

这段代码：

```
d => d.DinnerID == id 
```

可以认为是定义类型的函数`Func<Dinner, bool>`。

无论你把它传递给什么，这个函数都可以被调用和传递`Dinner`，它会返回一个`bool`.

```
void Foo(Func<Dinner, bool> f)
{
    bool result = f(new Dinner());
} 
```

在您的真实示例中，该函数`SingleOrDefault`将多次调用您给它的函数，`Dinner`每次传递一个不同的函数，并将返回`Dinner`函数返回的函数`true`。

事实上，当您使用`IQueryable`时，这只是*概念上*发生的情况。很有可能，函数的代码被转换成 SQL，所有的执行都在数据库内部完成。

# syntax-highlighting - 编辑 perl 文件时，如何在 POD 部分中启用 vim7 拼写检查？

> ID：849908
> 
> 赞同：7
> 
> 时间：2009-05-11T20:22:22.337
> 
> 标签：syntax-highlighting, vim

我是 vim 的老用户，但最近才知道 vim7 现在有一些很棒的拼写功能。到目前为止，我一直在使用各种外部拼写工具和插件，并且很高兴放弃所有这些工具和插件以使用内置拼写。

所以这就是问题所在。我进行了审查`:help spell`，对于我尝试过的大多数文件类型，拼写看起来都很棒，除了 perl ( `.pl|.pm`)。问题似乎与语法有关，因为当 I`:set spell`和`set syntax=off`拼写工作正常时，但当 I 时停止工作`set syntax=perl`。

真正酷的是，如果我可以为 POD 块启用拼写。有任何想法吗？

```
:set spell
:set spelllang=en_us
:set syntax=perl 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T22:42:10.907

grepping for “spell” in `/usr/share/vim/vim72/syntax/perl.vim`，我发现一些 POD 的语法定义已经包含了拼写，但是被包裹在一个包含保护中`perl_include_pod`。在 perl.vim 的顶部，给出了默认变量，默认`perl_include_pod`为 unlet。

所以添加

```
let perl_include_pod = 1 
```

在 perl 文件的 POD 部分中`~/.vimrc`打开语法突出显示和拼写检查。

# sharepoint - 从 Sharepoint Webpart 中写入事件日志

> ID：849909
> 
> 赞同：5
> 
> 时间：2009-05-11T20:22:26.690
> 
> 标签：sharepoint, event-log

我正在尝试创建自定义 Web 部件。为了实现错误处理，我想写入事件日志。为此，我正在尝试使用以下代码；

```
protected void btnExceptionTester_Click(object sender, EventArgs e)
    {
        try
        {
            throw new Exception("this is a test");
        }
        catch (Exception ex)
        {
            SPSecurity.RunWithElevatedPrivileges(delegate()
            {
                EventLog.WriteEntry("TestWebpart", ex.ToString(), EventLogEntryType.Error);
            });
        }
    } 
```

当我尝试执行此代码时，我收到一个共享点错误页面（未处理的异常）。当我查看事件日志时，我看到以下消息；“不允许请求的注册表访问”。

我在完全信任级别下运行（仅用于测试）。有人可以向我指出我需要什么样的权限才能写入事件日志吗？还是有其他方法？

大受帮助！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T21:02:43.893

我没有尝试写入 Windows 事件日志，但作为替代方案，您可以使用以下命令写入 12 配置单元中的 SharePoint 日志：

```
Microsoft.Office.Server.Diagnostics.PortalLog.LogString("your message here!"); 
```

希望这可以帮助

伊恩

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T21:13:08.447

*更新*

写入事件日志需要在 Web 部件中提升权限：

```
SPSecurity.RunWithElevatedPrivileges(delegate { EventLog.WriteEntry(... 
```

* * *

权限：

HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\ *YourWebPartLog*

我想是你悲伤的原因。与您的应用程序池的权限相比，它的权限是什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T14:49:46.980

SharePoint 中的事件日志条目：

1.  对于 WebParts 记录 12 个配置单元中存在的 ULS 日志中的错误。

2.  对于 SharePoint 应用程序页面，将错误写入事件日志中。

3.  所有其他列表和库相关错误将仅记录在 ULS 日志中。

谢谢

# regex - 我用什么来匹配正则表达式中的 MS Word 字符

> ID：849910
> 
> 赞同：0
> 
> 时间：2009-05-11T20:22:33.567
> 
> 标签：regex

我需要查找并删除字符串中的所有非标准 ascii 字符（通常由 MS Word 提供）。我不完全确定这些字符是什么……比如花哨的撇号和双向引号等等。那是unicode吗？我知道如何做笨手笨脚的 [az etc. etc.]，但我希望有一种更优雅的方式来排除键盘上没有的任何内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T02:58:31.143

处理这个问题的最好方法可能是使用字符集，是的，但是对于它的价值，我已经通过这种快速而肮脏的方法取得了一些成功，即字符类

```
[\x80-\x9F] 
```

这很有效，因为对我来说，“Word chars”的问题是那些在 Unicode 中是非法的，而且我无法清理用户输入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-13T10:13:52.327

我通常使用一个 JEdit 宏，将其中最常见的宏替换为对 ascii 更友好的版本，即：

*   连字符和破折号到减号；
*   悬浮点（单个字符）到多个点；
*   列出项目点到星号；
*   等等

它很容易适应 Word/Openoffice/whatever，当然也可以根据您的需要进行修改。我写了一篇关于这个主题的文章： [http ://www.megadix.it/node/138](http://www.megadix.it/node/138)

干杯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T20:56:29.533

Microsoft 应用程序因使用花哨的字符而臭名昭著，如花引号、破折号等，这些字符需要特殊处理而不会增加任何实际价值。在某些情况下，您所要做的就是确保您使用他们的扩展字符集之一来阅读文本（例如，windows-1252 而不是 ISO-8859-1）。但是有几种工具可以用它们普通但普遍支持的等价物替换那些花哨的字符。谷歌搜索“demoronizer”或“AsciiDammit”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T04:43:42.267

我要做的是，使用[AutoHotKey](http://www.autohotkey.com/)或 python [SendKeys](http://www.rutherfurd.net/python/sendkeys/#overview)或某种视觉基础，将所有可能的键（也应用和未应用移位）发送到 Word 文档。

在 SendKeys 中，它将是表单的脚本

```
chars = ''.join([chr(i) for i in range(ord('a'),ord('z'))])
nums = ''.join([chr(i) for i in range(ord('0'),ord('9'))])
specials = ['-','=','\','/',','.',',','`']
all = chars+nums+specials
SendKeys.SendKeys("""
    {LWIN}
    {PAUSE .25}
    r
    winword.exe{ENTER}
    {PAUSE 1}
    %(all)s
    +(%(all)s)
    "testQuotationAndDashAutoreplace"{SPACE}-{SPACE}a{SPACE}{BS 3}{LEFT}{BS}
    {Alt}{PAUSE .25}{SHIFT}
    changeLanguage
    %(all)s
    +%(all)s
"""%{'all':all}) 
```

然后我会将文档保存为文本，并将其用作键盘布局中所有可显示键的数据库（您可能希望多次替换默认输入语言以接收绝对所有可显示的字符）。

如果字符在结果文本文档中 - 它是可显示的，否则不是。不需要正则表达式。您当然可以随后将字符范围嵌入脚本或程序中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T20:32:10.043

您可能正在查看的是 UTF-8 格式的 Unicode 字符。如果是这样，只需用您的正则表达式语言转义它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:38:04.760

我对这个问题的解决方案是编写一个 Perl 脚本，它给我所有超出 ASCII 范围 (0 - 127) 的字符：

```
#!/usr/bin/perl

use strict;
use warnings;

my %seen;
while (<>) {
    for my $character (grep { ord($_) > 127 } split //) {
        $seen{$character}++;
    }
}

print "saw $_ $seen{$_} times, its ord is ", ord($_), "\n" for keys %seen; 
```

然后我创建这些字符到我想要的字符的映射并在文件中替换它们：

```
#!/usr/bin/perl

use strict;
use warnings;

my %map = (
    chr(128) => "foo",
    #etc.
);

while (<>) {
    s/([\x{80}-\x{FF}])/$map{$1}/;
    print;
} 
```

# python - Python -- 正则表达式 -- 如何在两组字符串之间找到一个字符串

> ID：849912
> 
> 赞同：6
> 
> 时间：2009-05-11T20:23:49.290
> 
> 标签：python, regex, string, tags

考虑以下：

```
<div id=hotlinklist>
  <a href="foo1.com">Foo1</a>
  <div id=hotlink>
    <a href="/">Home</a>
  </div>
  <div id=hotlink>
    <a href="/extract">Extract</a>
  </div>
  <div id=hotlink>
    <a href="/sitemap">Sitemap</a>
  </div>
</div> 
```

您将如何在**python**中使用正则表达式取出站点地图行？

```
<a href="/sitemap">Sitemap</a> 
```

下面可以用来拉出锚标签。

```
'/<a(.*?)a>/i' 
```

但是，有多个锚标记。还有多个热链接，所以我们也不能真正使用它们吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T20:32:41.523

不要使用正则表达式。使用[BeautfulSoup](http://www.crummy.com/software/BeautifulSoup/)，一个 HTML 解析器。

```
from BeautifulSoup import BeautifulSoup

html = \
"""
<div id=hotlinklist>
  <a href="foo1.com">Foo1</a>
  <div id=hotlink>
    <a href="/">Home</a>
  </div>
  <div id=hotlink>
    <a href="/extract">Extract</a>
  </div>
  <div id=hotlink>
    <a href="/sitemap">Sitemap</a>
  </div>
</div>"""

soup = BeautifulSoup(html)
soup.findAll("div",id="hotlink")[2].a

# <a href="/sitemap">Sitemap</a> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T20:37:51.920

用正则表达式解析 HTML 是个坏主意！

想想下面这段 html

```
<a></a > <!-- legal html, but won't pass your regex -->

<a href="/sitemap">Sitemap<!-- proof that a>b iff ab>1 --></a> 
```

这样的例子还有很多。正则表达式适用于很多事情，但不适用于解析 HTML。

您应该考虑使用[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/) python HTML 解析器。

无论如何，使用正则表达式的临时解决方案是

```
import re

data = """
<div id=hotlinklist>
  <a href="foo1.com">Foo1</a>
  <div id=hotlink>
    <a href="/">Home</a>
  </div>
  <div id=hotlink>
    <a href="/extract">Extract</a>
  </div>
  <div id=hotlink>
    <a href="/sitemap">Sitemap</a>
  </div>
</div>
"""

e = re.compile('<a *[^>]*>.*</a *>')

print e.findall(data) 
```

输出：

```
>>> e.findall(data)
['<a href="foo1.com">Foo1</a>', '<a href="/">Home</a>', '<a href="/extract">Extract</a>', '<a href="/sitemap">Sitemap</a>'] 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-12T07:37:33.123

为了提取标语的内容：

```
 <a href="/sitemap">Sitemap</a> 
```

...我会使用：

```
 >>> import re
    >>> s = '''
    <div id=hotlinklist>
    <a href="foo1.com">Foo1</a>
      <div id=hotlink>
        <a href="/">Home</a>
      </div>
      <div id=hotlink>
        <a href="/extract">Extract</a>
      </div>
      <div id=hotlink>
        <a href="/sitemap">Sitemap</a>
      </div>
    </div>'''
    >>> m = re.compile(r'<a href="/sitemap">(.*?)</a>').search(s)
    >>> m.group(1)
    'Sitemap' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T20:43:23.503

如果需要解析 HTML，请使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)或[lxml 。](http://www.codespeak.net/lxml/)

另外，您真正需要做什么？找到最后一个链接？找到第三个链接？找到指向 /sitemap 的链接？你的问题不清楚。你需要对数据*做*什么？

如果您真的必须使用正则表达式，请查看`findall`.

# php - 从 Twitter 中提取多页搜索词

> ID：849922
> 
> 赞同：0
> 
> 时间：2009-05-11T20:26:17.930
> 
> 标签：php, twitter

我试图找出一种方法来通过 PHP 和 Twitter 搜索 API 提取特定搜索词的所有推文。

因此功能将包括 1\. 包括搜索词 2\. 从每个页面中提取词。3\. 仅从上次搜索中提取新术语 4\. 导出到数据库或平面文件。

除了遍历多个页面之外，我对所有这些都很清楚

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T20:36:21.940

twitter API 采用页码参数。在原子结果中，有链接元素，具有下一个和上一个的 rel 属性。这将是您是否应该去寻找第二页等的最佳指标。该标签的 href 属性甚至会告诉您应该请求的 URL。

您创建的查询也采用 since_id 参数。您需要存储您在响应中看到的最大 ID 号，并在后续请求中使用它，这样您就不必过滤重复项。

至于数据存储，您的选择可能最好以您计划如何处理结果为指导……如果您要进行任何查询，您可能应该将其归档到数据库中，即 MySQL。如果您只是在记录，则平面文件应该可以。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:29:49.280

搜索 API 有一个`page`参数：

> 页面：可选。要返回的页码（从 1 开始），最多大约 1500 个结果（基于 rpp * page。注意：有分页限制。
> 
> 示例：[http ://search.twitter.com/search.atom?q=devo&rpp=15&page=2](http://search.twitter.com/search.atom?q=devo&rpp=15&page=2)

这有帮助吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:30:54.007

[twitter 搜索 api](http://apiwiki.twitter.com/Twitter-Search-API-Method%3A-search)需要一个页面参数：

> # 页面：可选。要返回的页码（从 1 开始），最多大约 1500 个结果（基于 rpp * page。注意：有分页限制。
> 
> ```
> * Example: http://search.twitter.com/search.atom?q=devo&rpp=15&page=2 
> ```

# javascript - xml、xsl Javascript 排序

> ID：849925
> 
> 赞同：3
> 
> 时间：2009-05-11T20:27:51.360
> 
> 标签：javascript, xml, xslt

我正在寻找一种使用 javascript 对我的 xml 数据进行排序的方法，并希望最终也过滤掉数据。我知道这一切在 xsl 文件中都是可能的，但我想在客户端做。

我已经搜索了多个使用 javascript 进行排序的地方，但其中大部分都过于特定于 xml 文件，或者我无法弄清楚发生了什么。

非常感谢任何建议

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-29T07:14:15.453

第一部分是在 javascript 中执行转换：

```
function transformXML(_xml, _xsl) {
  var
    xml = typeof _xml == 'string' 
      ? new DOMParser().parseFromString(_xml, 'text/xml') 
      : _xml // assume this is a node already
    ,xsl = typeof _xsl == 'string'
      ? new DOMParser().parseFromString(_xsl, 'text/xml')
      : _xsl // assume this is a node already
    ,processor = new XSLTProcessor()
  ;

  processor.importStylesheet(xsl);

  return processor.transformToDocument(xml.firstChild);
} 
```

此函数接受两个参数。第一个是您要转换的 xml。第二个是您要用于转换 xml 的 xslt。两个参数都接受将转换为节点的字符串或节点本身（例如 XHR.responseXML）。

谜题的第二部分是排序，您将使用 xsl 的内置`xsl:sort`.

```
<xsl:sort
  select="expression"
  lang="language-code"
  data-type="text|number|qname"
  order="ascending|descending"
  case-order="upper-first|lower-first"/> 
```

除了 select 语句之外，所有参数都是可选的。

**示例排序用法：**

```
<xsl:for-each select="catalog/cd">
  <xsl:sort select="artist"/>

  <xsl:value-of select="artist"/>
  <xsl:text> - </xsl:text>
  <xsl:value-of select="title"/>
</xsl:for-each> 
```

`xsl:sort`您可以在[w3schools](http://www.w3schools.com/xsl/el_sort.asp)找到更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-03T03:16:01.793

我不会在 xsl 表中排序。我将[tablesorter](http://tablesorter.com/docs/) [插件](http://docs.jquery.com/Plugins/Authoring)用于[jquery](http://jquery.com/)。

[入门](http://tablesorter.com/docs/#Getting-Started)部分非常简单（并在下面复制）。

要使用 tablesorter 插件，请在 HTML 文档的标记中包含 jQuery 库和 tablesorter 插件：

```
<script type="text/javascript" src="/path/to/jquery-latest.js"></script> 
<script type="text/javascript" src="/path/to/jquery.tablesorter.js"></script> 
```

tablesorter 适用于标准 HTML 表格。您必须包含 THEAD 和 TBODY 标签：

```
<table id="myTable"> 
<thead> 
<tr> 
    <th>Last Name</th> 
    <th>First Name</th> 
    <th>Email</th> 
    <th>Due</th> 
    <th>Web Site</th> 
</tr> 
</thead> 
<tbody> 
<tr> 
    <td>Smith</td> 
    <td>John</td> 
    <td>jsmith@gmail.com</td> 
    <td>$50.00</td> 
    <td>http://www.jsmith.com</td> 
</tr> 
<tr> 
    <td>Bach</td> 
    <td>Frank</td> 
    <td>fbach@yahoo.com</td> 
    <td>$50.00</td> 
    <td>http://www.frank.com</td> 
</tr> 
<tr> 
    <td>Doe</td> 
    <td>Jason</td> 
    <td>jdoe@hotmail.com</td> 
    <td>$100.00</td> 
    <td>http://www.jdoe.com</td> 
</tr> 
<tr> 
    <td>Conway</td> 
    <td>Tim</td> 
    <td>tconway@earthlink.net</td> 
    <td>$50.00</td> 
    <td>http://www.timconway.com</td> 
</tr> 
</tbody> 
</table> 
```

首先告诉 tablesorter 在加载文档时对表格进行排序：

```
$(document).ready(function() 
    { 
        $("#myTable").tablesorter(); 
    } 
); 
```

单击标题，您会看到您的表格现在可以排序了！您还可以在初始化表时传入配置选项。这告诉 tablesorter 按升序对第一列和第二列进行排序。

```
$(document).ready(function() 
    { 
        $("#myTable").tablesorter( {sortList: [[0,0], [1,0]]} ); 
    } 
); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:33:42.113

一个很好的方法是在其中设置一个带有参数检查的 XSL 以进行排序，然后在其上应用一些 js，一个完整的工作示例可在以下位置获得：

[http://www.google.com.br/search?hl=pt-BR&q=xml+javascript+data+sort&meta=](http://www.google.com.br/search?hl=pt-BR&q=xml+javascript+data+sort&meta=)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T20:34:17.417

为什么不把它变成一个对象数组并对其进行排序，因为无论如何您可能都需要将其转换为显示它。

如果您必须在 javascript 中对 xml 进行排序，您可能会在这里找到一些帮助。 [http://www.velocityreviews.com/forums/t170211-clientside-filtering-and-sorting-xml-with-javascript-work-in-iebut-not-firefox.html](http://www.velocityreviews.com/forums/t170211-clientside-filtering-and-sorting-xml-with-javascript-work-in-iebut-not-firefox.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T22:28:42.707

所有主要浏览器版本都支持 XSLT 仅供参考^_^（IE 6+、FF 1+、SF 2+、CHROME、OPERA 9+）

不知道你在做什么，但 XSLT 也可以在 ajax 中使用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T19:32:23.773

那么，你为什么不使用原型库呢？它有[http://prototypejs.org/api/enumerable/sortBy](http://prototypejs.org/api/enumerable/sortBy) 它有[http://prototypejs.org/api/enumerable/grep](http://prototypejs.org/api/enumerable/grep) 那么为什么不对元素进行排序并 grep 元素呢？如果你想在 javascript 中使用那个客户端？

# ios - 如何将 UITableView 行重新排序限制为一个部分

> ID：849926
> 
> 赞同：123
> 
> 时间：2009-05-11T20:27:58.130
> 
> 标签：ios, iphone, uitableview, cocoa-touch

我在这个问题上撞了我的头，而谷歌什么也没找到。我最终解决了这个问题，并想为了下一个人而把它写在这里。

您有`UITableView`多个部分。每个部分都是同质的，但表整体是异质的。因此，您可能希望允许对部分内的行进行重新排序，但不允许*跨*部分重新排序。也许您甚至只想要一个部分可以重新排序（这是我的情况）。如果您像我一样正在寻找，`UITableViewDataSourceDelegate`您将找不到关于何时允许您在部分之间移动一行的通知。当它开始移动一行时你会得到一个（这很好），当它已经移动它并且你有机会与你的内部内容同步时你会得到一个。没有帮助。

那么如何防止部分之间的重新订购呢？

我将发布我所做的作为单独的答案，让其他人发布更好的答案！

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2009-05-11T20:51:37.810

此实现将防止像菲尔的回答那样在原始部分之外重新排序，但它也会将记录捕捉到该部分的第一行或最后一行，具体取决于拖动的位置，而不是开始的位置。

```
- (NSIndexPath *)tableView:(UITableView *)tableView targetIndexPathForMoveFromRowAtIndexPath:(NSIndexPath *)sourceIndexPath toProposedIndexPath:(NSIndexPath *)proposedDestinationIndexPath
{
  if (sourceIndexPath.section != proposedDestinationIndexPath.section) {
    NSInteger row = 0;
    if (sourceIndexPath.section < proposedDestinationIndexPath.section) {
      row = [tableView numberOfRowsInSection:sourceIndexPath.section] - 1;
    }
    return [NSIndexPath indexPathForRow:row inSection:sourceIndexPath.section];     
  }

  return proposedDestinationIndexPath;
} 
```

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2009-05-11T20:34:16.373

很简单，真的。

UITableViewDelegate 有以下方法：

```
 tableView:targetIndexPathForMoveFromRowAtIndexPath:toProposedIndexPath: 
```

当用户将鼠标悬停在潜在的下降点上时，会调用它。你有机会说，“不！不要把它丢在那里！把它丢在这里”。您可以将不同的索引路径返回到建议的索引路径。

我所做的只是检查部分索引是否匹配。如果他们做得很好，请返回建议的路径。如果不是，则返回源路径。这也很好地防止了其他部分中的行甚至在您拖动时移开 - 并且拖动的行将快速恢复到您尝试将其移动到另一个部分的原始位置。

```
 - (NSIndexPath *)tableView:(UITableView *)tableView targetIndexPathForMoveFromRowAtIndexPath:(NSIndexPath *)sourceIndexPath toProposedIndexPath:(NSIndexPath *)proposedDestinationIndexPath
{
    if( sourceIndexPath.section != proposedDestinationIndexPath.section )
    {
        return sourceIndexPath;
    }
    else
    {
        return proposedDestinationIndexPath;
    }
} 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2015-03-03T16:35:38.023

杰森为你懒惰的人回答的 Swifty 快速版本：

**斯威夫特 3、4 和 5**

```
override func tableView(_ tableView: UITableView, targetIndexPathForMoveFromRowAt sourceIndexPath: IndexPath, toProposedIndexPath proposedDestinationIndexPath: IndexPath) -> IndexPath {
    if sourceIndexPath.section != proposedDestinationIndexPath.section {
        var row = 0
        if sourceIndexPath.section < proposedDestinationIndexPath.section {
            row = self.tableView(tableView, numberOfRowsInSection: sourceIndexPath.section) - 1
        }
        return IndexPath(row: row, section: sourceIndexPath.section)
    }
    return proposedDestinationIndexPath
} 
```

**斯威夫特 1 & 2**

```
override func tableView(tableView: UITableView, targetIndexPathForMoveFromRowAtIndexPath sourceIndexPath: NSIndexPath, toProposedIndexPath proposedDestinationIndexPath: NSIndexPath) -> NSIndexPath {
    if sourceIndexPath.section != proposedDestinationIndexPath.section {
        var row = 0
        if sourceIndexPath.section < proposedDestinationIndexPath.section {
            row = self.tableView(tableView, numberOfRowsInSection: sourceIndexPath.section) - 1
        }
        return NSIndexPath(forRow: row, inSection: sourceIndexPath.section)
    }
    return proposedDestinationIndexPath
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-07-27T00:20:31.363

您可以使用以下方法防止部分之间的行移动。只是不允许部分之间有任何移动。您甚至可以控制部分内特定行的移动。例如，一节中的最后一行。

这是示例：

```
- (NSIndexPath *)tableView:(UITableView *)tableView targetIndexPathForMoveFromRowAtIndexPath:(NSIndexPath *)sourceIndexPath toProposedIndexPath:(NSIndexPath *)proposedDestinationIndexPath {

    // Do not allow any movement between section
    if ( sourceIndexPath.section != proposedDestinationIndexPath.section) {
        return sourceIndexPath;
    }
    // You can even control the movement of specific row within a section. e.g last row in a     Section

    // Check if we have selected the last row in section
    if (sourceIndexPath.row < sourceIndexPath.length) {
        return proposedDestinationIndexPath;
    } 
    else {
        return sourceIndexPath;
    }
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-07-23T00:30:57.543

**斯威夫特 3：**

```
override func tableView(_ tableView: UITableView, targetIndexPathForMoveFromRowAt sourceIndexPath: IndexPath, toProposedIndexPath proposedDestinationIndexPath: IndexPath) -> IndexPath {
    if sourceIndexPath.section != proposedDestinationIndexPath.section {
        var row = 0
        if sourceIndexPath.section < proposedDestinationIndexPath.section {
            row = self.tableView(tableView, numberOfRowsInSection: sourceIndexPath.section) - 1
        }
        return IndexPath(row: row, section: sourceIndexPath.section)
    }
    return proposedDestinationIndexPath
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-02-20T06:20:02.153

比@Jason Harwig，下面的代码可以正常工作。

```
- (NSIndexPath *)tableView:(UITableView *)tableView targetIndexPathForMoveFromRowAtIndexPath:(NSIndexPath *)sourceIndexPath toProposedIndexPath:(NSIndexPath *)proposedDestinationIndexPath
    {
      if (sourceIndexPath.section != proposedDestinationIndexPath.section) {
        NSInteger row = 0;
        if (sourceIndexPath.section < proposedDestinationIndexPath.section) {
          row = [tableView numberOfRowsInSection:sourceIndexPath.section] - 1;
        }
        return [NSIndexPath indexPathForRow:row inSection:sourceIndexPath.section];     
      }

      return proposedDestinationIndexPath;
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-14T08:20:16.437

为了不改变**Swift3部分之间的位置**

```
override func collectionView(_ collectionView: UICollectionView, targetIndexPathForMoveFromItemAt originalIndexPath: IndexPath, toProposedIndexPath proposedIndexPath: IndexPath) -> IndexPath {
    if originalIndexPath.section != proposedIndexPath.section
    {
        return originalIndexPath
    }
    else
    {
        return proposedIndexPath
    }
} 
```

# nhibernate - nHibernate 是否允许像 linq to sql 那样拖放自动创建类？

> ID：849927
> 
> 赞同：1
> 
> 时间：2009-05-11T20:28:08.737
> 
> 标签：nhibernate, linq-to-sql

只是一个基本的问题。学习 Linq to SQL 和一些 nHibernate。我正在使用 mvc 教程，他们将表格拖放到 Visual Studio 设计器上以创建类并连接所有内容。

当我尝试使用 nHibernate 时，我不得不对 xml 文件做很多事情。nHibernate 是否有任何“简单”的东西，比如 Linq to SQL，或者 Linq to SQL 的拖放功能是否如此基本，以至于当我想做一些“真正的”事情时，Visual Studio 为我做这件事并不重要（在这个基本水平）？换句话说，我使用 Linq to SQL 越深入，我最终将不得不像使用 nHibernate 那样处理配置文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T20:33:52.270

查看[Castle 的](http://www.castleproject.org/) [ActiveRecord](http://www.castleproject.org/activerecord/index.html)框架。它将 XML 配置文件的使用替换为直接在类/属性声明上使用属性。此外，一个名为[ActiveWriter](http://using.castleproject.org/display/Contrib/ActiveWriter)的工具与 Visual Studio 集成，允许连接到数据源并生成对象模型！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:32:12.053

没有像您在 LINQ to SQL 中看到的“本机”支持。但是，有第三方插件可以让您使用 nHibernate 执行类似的操作。我最喜欢的是这个：

[http://sourceforge.net/projects/nhibernateaddin](http://sourceforge.net/projects/nhibernateaddin)

要使用它：

*   创建一个到数据库的数据连接，该数据库包含您要编写代码的结构（您的开发数据库）。

*   将一个新的 NHibernate 插件项（通过添加新项）添加到您的项目中，该项目将包含您的域对象。在属性窗口中，从您刚刚创建的数据连接中添加数据连接字符串（这还不是自动化的）。

*   最后，将表从数据连接拖放到 NHibernate 插件对象，并在保存映射文件时生成域对象。要使用它，您需要创建一个到数据库的数据连接，该数据库包含您要编写代码的结构（您的开发数据库）。

# .net - 动态 ASP.net Web 表单

> ID：849931
> 
> 赞同：4
> 
> 时间：2009-05-11T20:28:31.453
> 
> 标签：.net, asp.net, dynamic-controls

我正在创建一个 ASP.NET 应用程序，其中程序的管理员将能够为用户填写和提交的表单定义自定义字段。

管理员需要定义各种类型的字段，例如复选框、单选按钮、文本框和文本区域供用户填写。管理员还可以定义是否需要这些自定义字段。

我现在正处于计划阶段，想知道如何将这些自定义字段定义存储在数据库中，以及如何将它们呈现出来并使其发挥作用。

### 编辑

最终用户使用这些动态创建的表单字段提交的表单数据也必须保存在数据库中。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-13T14:00:05.673

这是我为概念证明而快速制作的东西。

[动态表格.zip](http://dynamicforms.googlecode.com/files/DynamicForms.zip)

我在 VS 2008 SP1 中构建。appdata 文件夹中有一个 sql server db，所以如果你想运行它，sqlexpress 会有所帮助。

我很快建立了这个，所以它很草率。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T20:36:56.510

如果没有完成此操作或其他类似操作，我认为您的数据库结构可能包括控件类型、名称、值类型、是否已验证、如何验证以及是否需要。然后，当您阅读所需控件的记录/数据集时，您可能会将记录集中的控件类型与翻译后的值进行比较，然后将其添加到 Web 表单中。

例如：

```
if(drow["ControlType"].ToString().ToUpper() == "TEXTBOX")
{
    Label lbl = new Label();
    lbl.Text = drow["ControlLabel"].ToString();
    TextBox txt = new TextBox();

    //TO GET THE VALUE ON POSTBACK LATER
    txt.ID = drow["ControlID"].ToString();

    //PROBABLY NOT NECESSARY
    Div myDiv = new Div();
    myDiv.Controls.Add(lbl);
    myDiv.Controls.Add(txt);

    //ADD THE DIV ABOVE TO THE FORM/PANEL/DIV/ETC.
    MyForm.Controls.Add(myDiv);
} 
```

这在理论上会将标签放在文本框控件旁边。我不知道 Div 是否可以工作，但你可以为 CheckBox、TextBox、Label 等运行这种类型的东西。

一旦控件和标签出现在页面上，您将需要某种形式的操作来使服务器将值保存到数据库中。我建议将表名和列名与对象列表一起存储。然后将表单字段映射到用于插入的 DB 列。（请记住，这个解释就像在 200,000 英尺处）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T20:36:33.110

可能需要以下基本结构：Form、Field、FieldType。您将需要每个业务对象和数据表，以便您可以存储每个字段的配置。

您可能需要该字段具有可以设置的多个属性（例如被要求），以便您可以独立跟踪每个字段。

然后，您将需要某种可以读取数据层的实用程序，然后为每个字段和字段类型知道要制作什么类型的控件，以及如何将控件添加到当前页面。

在主页上使用 asp:PlaceHolder 标记将允许您使用表单构建实用程序向该占位符动态添加控件。

最后，您可能希望为生成的表单的不同部分构建一个包含多个类的样式表，以便客户端可以自定义您生成的任何控件表的字体、间距等。

**编辑：**

如果表单上输入的数据需要持久化，那么您需要决定是否要拥有可自定义的数据层。您可以拥有一个使用 ALTER TABLE 脚本的空数据库表，以允许客户端根据需要向数据库添加列，然后您可以设置哪个控件绑定到哪个列。控件到数据库列之间的这种映射对于正确存储数据至关重要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T20:30:32.773

每个控件都可以实例化并添加到页面中。例子：

```
 Label label = new Label();
 CheckBox check = new CheckBox(); 
```

之后，您应该将控件添加到任何容器的 Controls 属性中：

```
Panel1.Controls.Add(label); 
```

要在回发后检索控件，可以使用 FindControl 方法。

```
TextBox name = (TextBox) Panel1.FindControl("name of control"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T14:28:08.997

我以前做过这个。我为此使用了两张桌子，比方说

KeyField_Master：字段名称，类型，是否强制？

和

KeyField_Details：根据（值和描述）存储自定义字段值。

使用 Page_Load 事件创建该字段

```
if (keyField_type == "T") // Textbox
{
   txtBox.Attributes.Add("Type", "T"); // type of field for validation
   txtBox.Attributes.Add("IsKeyField", "Y"); // to mark it as a custom field
   if (isMandatory == "Y")
     txtBox.Attributes.Add("IsMandatory", "Y"); // is it mandatory

   // you could set layout of these controls using HTML Tables or any other way you prefer.

  htmlCell.Controls.Add(txtBox);
  htmlRow.Cells.Add(htmlCell);
  tbHTML.Rows.Insert(2, htmlRow);
}
else if // other controls type
{
  // ...
} 
```

另外，您可以参考这个问题[“如何验证动态创建的控件？”](https://stackoverflow.com/questions/419769/how-to-validate-dynamically-created-control) 这个问题与那个程序有关吗？

此外，验证可能是上述问题中所述的客户端？或服务器端通过将创建的字段存储在列表中，然后您可以在提交时检查该列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:40:38.483

正如其他人所说，通过在运行时向 ASP.NET 页面动态添加控件，肯定有办法做到这一点。

或者，虽然我没有使用过[Microsoft Infopath](http://office.microsoft.com/en-gb/infopath/default.aspx) ，但据我所知，它做了很多你想做的事情（即允许超级用户设计表格/问卷并放到网上并收集数据之后回来）

如果您的客户拥有适当的 Microsoft Office 版本，他们可能已经拥有 InfoPath。

# c# - 模拟接口是否仍会序列化为文件？

> ID：849940
> 
> 赞同：2
> 
> 时间：2009-05-11T20:30:51.527
> 
> 标签：c#, unit-testing, serialization, mocking

我正在尝试对文件的保存进行单元测试。我有一个定义文档的接口，我将一个实现该接口的具体对象传递给 Save 方法，它在实践中有效，但我正在尝试对其进行单元测试以确保它始终有效（而且我在一段“关键时间”之后，我拼命地试图赶上单元测试）。

我的保存方法很简单，它的工作原理是这样的：

```
public Boolean SaveDocument(IDocument document)
{
    BinaryFormatter bFormatter = new BinaryFormatter();
    FileStream fs = null;

    try
    {
        if (!Directory.Exists(folderName))
            Directory.CreateDirectory(folderName);

        String path = Path.Combine(Path.Combine(folderName, document.FileName), document.Extension);
        using (fs = new FileStream(path, FileMode.OpenOrCreate))
        {
            bFormatter.Serialize(fs, document);
        }
    }
    catch (IOException ioex)
    {
        LOG.Write(ioex.Message);
        return false;
    }

    return true;
} 
```

我的测试是：

```
[Test]
public void can_save_a_document()
{
    String testDirectory = "C:\\Test\\";
    m_DocumentHandler = new DocumentHandler(testDirectory);

    DynamicMock mock = new DynamicMock(typeof(IDocument));

    mock.ExpectAndReturn("get_FileName", "Test_File");
    mock.ExpectAndReturn("get_Extension", ".TST");

    m_DocumentHandler.SaveDocument(mock.MockInstance as IDocument);

    try
    {    
        Assert.IsTrue(Directory.Exists(testDirectory), "Directory was not created");
        String[] filesInTestDir = Directory.GetFiles(testDirectory);

        Assert.AreEqual(1, filesInTestDir.Length, "there is " + filesInTestDir.Length.ToString() + " files in the folder, instead of 1");
        Assert.AreEqual(Path.GetFileName(filesInTestDir[0]), "Test_File.TST");
    }
    finally
    {
        Directory.Delete(testDirectory);
        Assert.IsFalse(Directory.Exists(testDirectory), "folder was not cleaned up");
    }
} 
```

我知道序列化接口会[保留具体数据](https://stackoverflow.com/questions/619197/casting-to-multiple-unknown-types-at-runtime)，但是模拟接口会序列化吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T20:50:01.573

BinaryFormatter 在序列化数据时使用传入的对象的实际类型，而不是接口。所以在内部，当你传递一个真实的对象时它会写 Type:MyLib.Objects.MyObj,MyLib 和 Type:Moq.ConcreteProxy,Moq 等当你传递一个模拟对象时。

无论哪种方式，使用 BinaryFormatter 进行持久化都会给您带来麻烦，因为您必须处理版本之间的版本控制和内存布局差异。您最好为您的文档建立一个定义良好的格式并手动编写对象和字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T13:03:31.977

如果您需要测试序列化如何与类一起工作，则为测试创建一些真实的类并使用它们。模拟对于测试协作对象之间的交互很有用。

# objective-c - Core Data 中对多关系的属性声明

> ID：849942
> 
> 赞同：9
> 
> 时间：2009-05-11T20:31:34.020
> 
> 标签：objective-c, cocoa, macos, core-data

我有一个使用 Core Data 编写的应用程序。我有 2 个具有一对多关系的实体。我已经为他们两个子类化了 NSManagedObject。一侧的实体称为播放列表，另一侧的实体称为歌曲。

播放列表界面：

```
@interface VBPlaylist : NSManagedObject {
}

@property (readwrite, copy) NSString *name;

@end 
```

播放列表的实现：

```
@implementation VBPlaylist

@dynamic name;

@end 
```

我认为我应该有另一个属性来指示 Playlist 类下的 Songs。我找不到任何显示写为属性的多关系的示例代码。你怎么做到这一点？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-11T20:44:20.833

Core Data 将一对一关系建模为对象引用。`Bar`因此，从 Entity到 entity的一对一关系`Baz`（假设`Baz`由 class 实现`Baz`）将是

```
@interface Bar : NSManagedObject {
}

@property (readwrite,nonatomic) Baz * toBaz;

@end 
```

对多关系被建模为可变集合属性（尽管不是*）*`NSMutableSet`。`Bar`假设从到`Baz`调用的一对多关系`manyBazz`：

```
@interface Bar : NSManagedObject {

}

@property (retain) NSSet* manyBazz;

@end

// coalesce these into one @interface AnalysisRecord (CoreDataGeneratedAccessors) section
@interface Bar (CoreDataGeneratedAccessors)
- (void)addManyBazzObject:(Baz *)value;
- (void)removeManyBazzObject:(Baz *)value;
- (void)addManyBazz:(NSSet *)value;
- (void)removeManyBazz:(NSSet *)value;

@end 
```

如果你想使用 NSMutableSet 接口来操作`manyBazz`关系，你应该调用`-mutableSetValueForKey:@"manyBazz"`来获取一个符合 KVO 的`manyBazz`关系代理。

在 Leopard (OS X 10.5) 及更高版本上，所有适当的方法都是由 Core Data 框架在运行时自动生成的，即使你没有显式声明或实现它们（当然，如果你尝试，你会收到编译器警告使用它们而不在头文件中声明它们）。因此你*不需要*子类化

获得声明和实现权的最简单方法是在数据建模器中选择属性，然后从“设计->数据模型”菜单中选择“复制 Objective-C 2.0 方法声明到剪贴板”，粘贴到您的实现类中。 h 文件。当然，你必须让你的 .h 和模型保持同步……因此强烈推荐rentzsch 很棒的[MO 生成器](http://rentzsch.github.com/mogenerator/)，一个可以从你的数据模型中自动生成（和重新生成）NSManagedObject 子类的工具。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-11T21:18:18.343

为 CoreData 实体创建 .h 和 .m 文件的最简单方法是：

1.  在数据建模器中选择一个实体。
2.  按 Command-N 或选择 File->New File…</li>
3.  从源列表中选择“Cocoa”。
4.  在模板选择器中，您现在应该会看到一个名为“Managed Object Class”的项目。如果不存在，请单击取消并重复步骤 1-2。
5.  按下一步，选择项目/目标，然后再次按下一步。
6.  现在您会看到类似于以下窗口的内容：[New Managed Object Class 窗口 http://blog.alanquatermain.net/images/ManagedObjectClass.png](http://blog.alanquatermain.net/images/ManagedObjectClass.png)
7.  选择您需要的选项，然后单击完成。

这将生成以下头文件和源文件：

实体.h：

```
#import <CoreData/CoreData.h>

@interface Entity :  NSManagedObject  
{
}

@property (retain) NSNumber * uniqueID;
@property (retain) NSString * name;
@property (retain) Entity * parent;
@property (retain) NSSet* children;

@end

@interface Entity (CoreDataGeneratedAccessors)
- (void)addChildrenObject:(Entity *)value;
- (void)removeChildrenObject:(Entity *)value;
- (void)addChildren:(NSSet *)value;
- (void)removeChildren:(NSSet *)value;

@end 
```

实体.m：

```
#import "Entity.h"

@implementation Entity 

@dynamic uniqueID;
@dynamic name;
@dynamic parent;
@dynamic children;

@end 
```

请注意，实现不包含任何东西，除了`@dynamic`标记告诉编译器不要担心缺少方法/变量来匹配属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-14T18:22:50.503

这种情况略有改变。从 4.2.1（2012 年 3 月）开始，您将转到新文件；选择Core Data（不是Cocoa），然后选择New NSObjectModel subclass。从那里它产生如上所述的子类。

# .net - 从 DataGrid 1.0 中检索行顺序

> ID：849953
> 
> 赞同：0
> 
> 时间：2009-05-11T20:33:23.970
> 
> 标签：.net, datagrid, .net-1.1, legacy-code

我正在使用 .net 1.1 的旧版应用程序，我需要检索数据网格后排序中的行（通过单击列标题）。这听起来像是一件容易的事，然而，答案似乎让我难以捉摸。我可以很好地从数据集中检索行，但是单击标题时它们不会再次排序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-20T21:51:12.997

我发现答案是创建一个 DataView，例如

```
Dim dv As DataView = CType(dg.DataSource, DataTable).DefaultView 
```

希望这可能会在以后对其他人有所帮助...

# c# - WPF - 图像源 - 不在预期范围内

> ID：849955
> 
> 赞同：1
> 
> 时间：2009-05-11T20:33:35.890
> 
> 标签：c#, .net, wpf

在我的 XAML 中，当我构建时，我得到以下异常：

错误 3 值“colorpick.png”无法分配给属性“源”。值不在预期范围内。

这是 XAML：

"Source="colorpick.png" 带有下划线。

我能找到的几件事之一是下面的博客文章： http: [//nickeandersson.blogs.com/blog/2008/06/wpf-image-and-v.html](http://nickeandersson.blogs.com/blog/2008/06/wpf-image-and-v.html)

colorpick.png 设置为 Build action = resource。

任何提示将不胜感激！

这是所有的xaml：

```
<UserControl x:Class="MyApp.Controls.ColorSettings"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:MyApp">
    <Grid>
        <StackPanel>
          <ScrollViewer>
           <ListView Name="lvColors" MinHeight="100" MinWidth="300" SelectionChanged="lvColors_SelectionChanged">
                <ListView.ItemContainerStyleSelector>
                    <local:ColorSettingsStyleSelector/>
                </ListView.ItemContainerStyleSelector>
                <ListView.View>
                <GridView>
                    <GridViewColumn Header="Level" DisplayMemberBinding="{Binding Level}"></GridViewColumn>

                    </GridView>
            </ListView.View>
        </ListView>
        </ScrollViewer>
            <StackPanel Orientation="Horizontal" Name="spColorPicker" Visibility="Hidden">
                <Image Source="colorpick.png" Width="200" Height="200" MouseLeftButtonDown="Image_MouseLeftButtonDown" MouseMove="wheel_MouseMove" Name="wheel"/>
                <Rectangle Width="200" Height="200" Name="rectDisplay"/>
            </StackPanel>
        </StackPanel>

    </Grid>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T20:44:38.837

我认为您可能需要使用 WPF[资源文件包 URI](http://msdn.microsoft.com/en-us/library/aa970069.aspx)语法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T20:45:20.427

尝试将其更改为

```
<Image Source="/AssemblyName;component/colorpick.png" ... 
```

其中 AssemblyName 是程序集的名称（组件是文字）。

假设 colorpick.png 位于项目的根目录中，如果它位于（例如）图像文件夹中，请使用`/AssemblyName;component/images/colorpick.png`

# ruby-on-rails - 慢速客户端连接阻塞 Mongrel

> ID：849963
> 
> 赞同：0
> 
> 时间：2009-05-11T20:36:12.437
> 
> 标签：ruby-on-rails, apache, mongrel

我为我的 rails 应用程序设置了 Apache + Haproxy + Mongrel。当我点击一个特定的服务器页面时，mongrel 需要大约 100 毫秒来处理请求，并且由于我的慢速家庭连接上的数据传输时间，我在大约 5 秒内获得了该页面。

现在我看到在这 5 秒的数据传输过程中，mongrel 没有服务任何其他请求。我很惊讶，因为这意味着 mongrel 正在向客户端提供响应 html，并且在客户端收到它之前被阻止。服务响应不应该是 Apache 的工作吗？

这对 Mongrel 可以提供的请求数量造成了严重的瓶颈，因为这取决于客户端连接的速度。有没有什么方法可以让 mongrel 生成的 html 由 apache/haproxy 或任何其他 Web 服务器（如 nginx）提供服务？
我想知道其他高流量网站是如何管理它的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T22:21:45.073

大多数使用 mongrel 的网站都会使用其中的很多，因为它们会像您遇到的那样阻塞。

你可能会想看看乘客，因为这是他们这些天要走的路。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-14T10:37:43.087

mongrel 本身是多线程的，但是默认情况下 rails 一次只能处理一个进程，尽管这可以通过 config.xml 更改。如果是 mongrel，请使用 mongrel-cluster。

仅供参考，乘客还设置了一个应用程序池，但它更好地部署，具有更好的新闻，并且现在更受欢迎。

# javascript - 尝试使用正则表达式替换 html 标签

> ID：849969
> 
> 赞同：5
> 
> 时间：2009-05-11T20:37:35.947
> 
> 标签：javascript, replace, elements

例如，我正在尝试替换

```
<script type='text/javascript'>some stuff</script> 
```

和：

```
<div type='text/javascript'>some stuff</div> 
```

我目前正在测试：

```
alert( o.replace( /(?:<\s*\/?\s*)(script)(?:\s*([^>]*)?\s*>)/gi ,'div') ); 
```

但我得到的是：

```
divsomestuffdiv 
```

我怎样才能让它只替换“脚本”部分并保留其他标记和属性字符？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T20:41:34.940

您保留了开始和结束标签括号。所以试试这个：

```
o.replace(/(<\s*\/?\s*)script(\s*([^>]*)?\s*>)/gi ,'$1div$2') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:42:54.050

DOM 方法比正则表达式更适合这种情况。这样你就可以逻辑地操作你的文档，而不是纯文本：

```
var els = document.getElementsByTagName('script');
for (var i = 0, el; el = els[i]; i++) {
    var new = document.createElement('div');
    new.type = el.type;
    el.parentNode.replaceChild(el, new);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T20:43:48.197

一种天真的但可读的方法是在我想的两遍中完成，第一次匹配并替换

> `<script`

与

> `<div`

然后另一个匹配

> `</script>`

并将其替换为

> `</div>`

# javascript - 如何在 JavaScript 中禁用 http-equiv 刷新？

> ID：849973
> 
> 赞同：4
> 
> 时间：2009-05-11T20:38:08.643
> 
> 标签：javascript, html, browser

我正在构建一个应该定期刷新的状态页面。

因此，我在该`<head>`部分进行了 http-equiv 刷新，以便每分钟刷新一次页面：

```
<meta http-equiv="Refresh" id="refresh" content="60"/> 
```

但是，对于支持 JavaScript 的浏览器，我想发送一个 Ajax 请求来检查页面是否应该刷新。因此，我想在 JavaScript 中禁用 http-equiv 刷新（因为它是 Ajax 可以完成这项工作）。

我尝试使用 JavaScript/PrototypeJs 删除标签，但这不起作用：

```
 $('refresh').remove(); 
```

似乎浏览器会跟踪该计时器并且不关心该 DOM 更新。

任何的想法 ？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T20:46:06.853

不完全确定，但也许：

```
<noscript>
    <meta http-equiv="Refresh" id="refresh" content="60"/>
</noscript> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:45:55.557

这将在服务器上更好地处理。有许多工具可以让您可靠地检查浏览器是否支持 JS（想到的就是 BrowserHawk），或者您可以检查 Browser 对象的 SupportsECMAScript（在 ASP.NET 中）属性，并在以下情况下写出不同的代码浏览器支持JS。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T20:47:09.940

我认为没有办法禁用 http-equiv 刷新。

状态页面是您应用中的第一页吗？如果没有，那么为什么不在请求状态页面之前先获取客户端的功能呢？如果是这样，那么您可能必须注入一个无 UI 的页面，该页面可以获取浏览器的功能并立即返回到真实的状态页面。所有这些都假设您不愿意使用 HTTP 标头中的用户代理字符串来获取浏览器功能。

# php - 使用 JavaScript 将输入字段文本插入 textarea

> ID：849978
> 
> 赞同：1
> 
> 时间：2009-05-11T20:39:33.417
> 
> 标签：php, javascript

我需要将输入字段中的文本/字符串插入到里面已经有一些文本的文本区域。插入的字符串必须在光标所在的位置，并且需要一个插入按钮。

有没有办法用 JavaScript 完成这个？

提前谢谢

PS应该插入的文本/字符串是使用PHP从数据库中获取的

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T22:31:05.043

@Kamia 的代码示例在正确的轨道上。这是您的测试的完整实现。根据您的描述，我假设在您的真实代码中，您可能会使用 php 进行某种类型的查找，该查找将检索文本以添加到 textarea。如果是这种情况，则需要对服务器进行某种类型的 Ajax 调用。我建议为此使用**[jQuery 的 Ajax 功能](http://docs.jquery.com/Ajax)**。

```
<html>
 <head>
  <title>Test Page</title>
  <script type="text/javascript">
    window.onload = function(){
       btn = document.getElementById("btnInsertText");
       myText = document.getElementById("myTextArea");
       text = document.getElementById("textToInsert");
       btn.onclick = function(){
          insertAtCursor(myText, text.value);
       }
    }

    function insertAtCursor(myField, myValue) { 
        //IE support 
        if (document.selection) { 
            myField.focus(); 
            sel = document.selection.createRange(); 
            sel.text = myValue; 
        }
            //Mozilla/Firefox/Netscape 7+ support 
        else if (myField.selectionStart || myField.selectionStart == '0'){  
            var startPos = myField.selectionStart; 
            var endPos = myField.selectionEnd; 
            myField.value = myField.value.substring(0, startPos)+ myValue 
                 + myField.value.substring(endPos, myField.value.length); 
            } else { 
                myField.value += myValue; 
            } 
        }       
    </script>
 </head>
 <body>
   Text To Insert:<input type="text" id="textToInsert" />
   <input type="button" id="btnInsertText" value="Insert Text" /><br/>
   <textarea id="myTextArea" rows="6" cols="50">
      Contrary to popular belief, Lorem Ipsum is not simply random text. 
      It has roots in a piece of classical Latin literature from 45 BC, 
      making it over 2000 years old.
   </textarea>
 </body>
 </html> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T20:42:40.290

德德，

从一些基本的谷歌搜索：D->

```
 <script type="text/javascript"> 
<!-- 

//myField accepts an object reference, myValue accepts the text strint to add 
function insertAtCursor(myField, myValue) { 
//IE support 
if (document.selection) { 
myField.focus(); 

//in effect we are creating a text range with zero 
//length at the cursor location and replacing it 
//with myValue 
sel = document.selection.createRange(); 
sel.text = myValue; 
} 

//Mozilla/Firefox/Netscape 7+ support 
else if (myField.selectionStart ¦¦ myField.selectionStart == '0') { 

//Here we get the start and end points of the 
//selection. Then we create substrings up to the 
//start of the selection and from the end point 
//of the selection to the end of the field value. 
//Then we concatenate the first substring, myValue, 
//and the second substring to get the new value. 
var startPos = myField.selectionStart; 
var endPos = myField.selectionEnd; 
myField.value = myField.value.substring(0, startPos)+ myValue+ myField.value.substring(endPos, myField.value.length); 
} else { 
myField.value += myValue; 
} 
} 

//--> 
</script> 
```

使用按钮添加文本：

```
<textarea id="mytext" rows="8" cols="70"></textarea> 
<button onclick="insertAtCursor(document.getElementById('mytext'),'Test text')" valueAdd Test text> 
```

希望对你有帮助

咿呀

# php - 如何在 php 中尽可能高效地对数据进行计数和排序

> ID：849980
> 
> 赞同：1
> 
> 时间：2009-05-11T20:39:50.420
> 
> 标签：php, mysql, ranking

我对编程并不陌生，但我对 MySQL 和 PHP 很陌生。我想知道执行以下操作的最有效方法是什么。我不需要实际的代码，只需要步骤。

我有一个用户评论列表，简单地说：

```
USER    REVIEW  
Bob     nice
John    good
Fred    bad
Bob     poor
Bob     the best
Fred    medicre
Bob     shiny 
```

我希望能够创建一个评论最多的评论者列表，即

```
USER REVIEWS
Bob  4
Fred 2
John 1 
```

以最有效的方式解决此问题的最佳方式是什么

干杯！！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T20:43:29.807

作为您的查询：

```
SELECT user, COUNT(*) AS reviews
FROM <table name>
GROUP BY user
ORDER BY reviews DESC; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T20:54:07.307

有时程序员用代码解释自己更容易：

```
// Credit to Chad Birch for the query...
$query = "SELECT user, COUNT(*) AS reviews 
          FROM <table name>
          GROUP BY user
          ORDER BY reviews DESC";

$res = mysql_query($query);
if(mysql_num_rows($res) > 0) {
    $res_array = mysql_fetch_assoc($res);
    $list = "<h1>USER REVIEWS</h1>\n";
    foreach($res_array as $user) {
        $list .= $user['user'].' '.$user['reviews']."<br />\n";
    }
}

echo $list; 
```

所以，基本上，9/10 次，最好让 SQL 来进行排序和处理，因为这样的处理效率更高。

1.  做 SQL 查询，让它对你的结果进行排序
2.  让 PHP 检查是否有任何结果返回。
3.  让 PHP 将结果转换为数组/对象
4.  让PHP遍历数组，提取需要的内容
5.  打印您想要的输出。

# asp.net - 当用户注销时，为什么authenticRequest 在页面上触发？

> ID：849983
> 
> 赞同：0
> 
> 时间：2009-05-11T20:40:34.990
> 
> 标签：asp.net, authentication, global-asax

我的目标是在用户进行身份验证时编写一个 cookie。我们使用了一个糟糕的框架，它隐藏了它的源代码和事件模型，所以当我使用他们的登录控件时，我无法在它上面设置会话超时！

无论如何，我试图在用户登录时编写一个 cookie，然后在后续页面视图（滑动到期）上刷新 cookie 过期时间。

所以我想我最初可以在 global.asax 中的 Application_AuthenticateRequest 期间创建 cookie，但即使用户尚未登录，它似乎也会触发。

估计是这样吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:50:03.223

Application_AuthenticateRequest 在每个请求上触发，但是如果您使用表单身份验证并且用户尚未登录，您会发现 HttpContext 的 User 属性（通过全局应用程序类文件中的 this.User 访问）评估为 null ，而如果用户登录，它将评估为 IPrincipal 对象。

所以你可以做这样的事情：

```
Private Sub Application_AuthenticateRequest(ByVal pObjSender As Object, ByVal pEaDummy As EventArgs)
    If Me.User IsNot Nothing AndAlso Me.User.Identity.IsAuthenticated Then
        If Me.Request.Cookies("authCookieName") Is Nothing Then
            ' Create cookie
        Else
            ' Update cookie
        End If
    End If
End Sub 
```

其中 authCookieName 是 cookie 名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:49:50.793

是的。Application_AuthenticateRequest 将在每次请求访问网站时发生。如果要对页面进行授权，AuthenticateRequest 以及进行身份验证也将检查并返回。某些页面需要从身份验证和授权检查中排除，例如登录页面。

对于您的情况，您还应该检查页面并排除登录序列中涉及的页面。

# .net - .net安装项目注册表问题

> ID：849986
> 
> 赞同：0
> 
> 时间：2009-05-11T20:40:46.597
> 
> 标签：.net, installation, registry

我正在为我的 .net 应用程序（c#）制作一个安装项目，我希望它向注册表添加一些条目，但在其中一些条目中我需要编写安装文件夹，而在其他条目中我想保存完整的应用程序主要结果的路径（.exe 文件）

我怎样才能做到这一点？是否有一些我可以使用的特殊变量或类似的东西（例如 %app_path%\%app_exe_name% -d "%1" ...）

我正在为应用程序和安装项目使用 VS 2005

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T21:00:20.073

您是否尝试过使用 [TARGETDIR]。添加需要引用文件路径的注册表项时，可以使用 [TARGETDIR] 等属性。例如，如果您需要引用位于应用程序文件夹中的文件 test.exe，那么您将输入 [TARGETDIR]test.exe。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T21:00:09.810

将注册表项的值设置为 [TARGETDIR] 或 [TARGETDIR]AppName.exe

# asp.net - aspnetdb.mdf 是否曾经打算用于生产在线 Web 应用程序？

> ID：849987
> 
> 赞同：3
> 
> 时间：2009-05-11T20:40:50.480
> 
> 标签：asp.net, security

生成的 aspnetdb.mdf 是否曾经打算在线使用？自从我查看它已经有一段时间了，但据我所知，生成的用户名数据库只能在您的 Visual Studio 环境中本地配置和维护。这仍然是真的吗？有人在网上用这个来做大应用吗？

编辑：

我之所以问是因为我看到的所有示例都只是使用内置的 VS 工具来构建示例数据库，但我还没有找到他们在网上做了“真实”的地方。

编辑：

知道您可以创建此用户名/密码数据库以在您的项目中使用，然后发现您真的不能，这似乎是一个很大的失望。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T20:44:39.367

> 在您的 Visual Studio 环境中本地配置和维护。这仍然是真的吗

不，这不是真的。

您可以使用 aspnet_regsql 脚本在数据库中生成所有必需的表/脚本/视图，而不必使用 aspnetdb.mdf。

毕竟，它只是会员/安全 api 所需的一堆数据库对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:52:40.180

它只是一个 SQL Express 数据库。如果您愿意，您当然可以通过您自己的管理页面维护 aspnetdb.mdf 中的成员信息。

事实上，如果你打算使用 SQL Express 作为你的数据库（非常有限的场景，这将是合适的）你可以将其余的表/存储过程添加到 aspnetdb.mdf 并只使用一个数据库而不是使用 aspnetdb.mdf 作为成员，并为您的其他需求创建另一个。

[本文](http://www.devx.com/MicrosoftISV/Article/38728)包含有关 sql express 限制的信息以及功能集的链接 ( [2005](http://www.microsoft.com/Sqlserver/2005/en/us/compare-features.aspx) , [2008](http://www.microsoft.com/sqlserver/2008/en/us/editions-compare.aspx) ) 。

基本上限制是：

1.  只有 1 个 CPU。如果系统有 1 个以上的 SQL Express 2008 仍将运行，但将自身限制为 1 个 CPU。
2.  内存：1 GB。可以存在更多 RAM，但 SQL Express 2008 最多只能使用 1 GB。
3.  最大数据库大小：4 GB

# java - 无法使用 Maven 更新快照或运行安装目标

> ID：849988
> 
> 赞同：0
> 
> 时间：2009-05-11T20:41:09.683
> 
> 标签：java, maven-2, dependencies, snapshot

有谁知道如何解决这个 Maven 错误？当我尝试更新项目的快照时，我得到以下信息：

> my-projects-name 的构建错误；org.apache.maven.lifecycle.LifecycleExecutionException：插件管理器执行目标'org.apache.maven.plugins：maven-dependency-plugin：2.0：unpack'中的内部错误：Mojo执行失败。

然后当我尝试运行“mvn install”时：

> ```
> [INFO] [assembly:single {execution:default}] [INFO]   
> --------------------------------------------------------- 
> [ERROR] BUILD ERROR [INFO]
> --------------------------------------------------------- 
> [INFO] Error reading assemblies: No assembly descriptors found. 
> ```

我正在运行 Maven 2.1.0。任何人都可以解释为什么它对我犹豫不决吗？其他团队成员可以使用来自 SVN 的完全相同的代码副本执行上述操作。

谢谢！

编辑：这是POM：

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>com.company.group</groupId>
    <artifactId>the-project-parent</artifactId>
    <version>1.0</version>
  </parent>
  <groupId>com.company.group.project</groupId>
  <artifactId>project-root</artifactId>
  <packaging>pom</packaging>
  <name>Project Name</name>
  <version>1.0.2-SNAPSHOT</version>
  <description>This artifact contains the common settings for the Project.</description>
  <url>http://maven.dev.companyName.com/sites/projectGroup/project</url>
  <scm>
    <connection>scm:svn:https://sourceforge.companyname.com/svn/repos/group/tags/projGroup/my-project-name</connection>
    <developerConnection>scm:svn:https://sourceforge.companyname.com/svn/repos/group/tags/projGroup/my-project-name</developerConnection>
  </scm>
  <modules>
    <module>module-1</module>
    <module>module-2</module>
    <module>module-3</module>
    <module>module-4</module>
  </modules>
  <dependencyManagement>
    <dependencies>
      <dependency>
        <groupId>net.sourceforge.jtds.jdbc</groupId>
        <artifactId>jtds</artifactId>
        <version>1.2.2</version>
        <scope>runtime</scope>
      </dependency>
      <dependency>
        <groupId>org.unitils</groupId>
        <artifactId>unitils</artifactId>
        <version>2.2</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.easymock</groupId>
        <artifactId>easymock</artifactId>
        <version>2.3</version>
        <scope>test</scope>
      </dependency>

      <!-- I cut most dependencies for brevity -->

      <dependency>
        <groupId>taglibs</groupId>
        <artifactId>standard</artifactId>
        <version>1.1.2</version>
        <scope>runtime</scope>
        <exclusions>
          <exclusion>
            <artifactId>commons-logging</artifactId>
            <groupId>commons-logging</groupId>
          </exclusion>
        </exclusions>
      </dependency>
    </dependencies>
  </dependencyManagement>
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-release-plugin</artifactId>
        <version>2.0-beta-5</version>
        <inherited>false</inherited>
        <configuration>
          <preparationGoals>clean install</preparationGoals>
          <tagBase>https://sourceforge.companyname.com/svn/repos/projects/tags/projGroup/my-project-name</tagBase>
        </configuration>
      </plugin>
    </plugins>
  </build>
</project> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T22:14:48.940

我终于`install`通过将 Maven 降级到 2.0.9 来实现目标。

编辑：我尝试执行`mvn clean install`和`mvn clean install assembly:assembly`使用 Maven 2.1.0，它重复了上述错误：>“未找到程序集描述符。”

它仍然适用于 Maven 2.0.9。我完全相信，导致这种差异的版本之间至少发生了一些变化......

编辑：据我所知，Maven 2.1.0 和我们使用的插件版本之间可能存在某种版本冲突：

```
<groupId>org.apache.maven.plugins</groupId>
<artifactId>maven-release-plugin</artifactId>
<version>2.0-beta-5</version> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T19:13:45.623

您粘贴的 pom 中没有显示任何程序集插件配置。也许它在父母身上？如果没有配置，那么程序集插件会抱怨，因为您没有使用描述符配置它来告诉它要做什么。运行 mvn help:effective-pom 然后粘贴这些结果（确保清除所有密码），这样我就可以在继承后看到你的完整 pom。

# aop - 您在现实世界中对面向方面编程有何用途？

> ID：849994
> 
> 赞同：8
> 
> 时间：2009-05-11T20:42:36.563
> 
> 标签：aop

我很难理解为什么采用 AO 的速度如此缓慢。主流语言有很多丰富的实现。我的猜测是，就像当时的 OO 一样，这足以使人们不认识它可以帮助他们的地方的范式转变。

那么，除了非侵入式日志记录之外，您已经使用或计划使用 AO 的哪些方法可以降低复杂性、改进维护、增强系统[“功能”](http://en.wikipedia.org/wiki/Ilities)？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T06:24:27.390

我目前在生产中通过 EntLib / Unity 使用 AOP：

*   日志记录
*   缓存
*   安全
*   异常报告
*   性能计数器

查看[http://www.agileatwork.com/unit-of-work-with-unity-and-aspnet-mvc/](http://www.agileatwork.com/unit-of-work-with-unity-and-aspnet-mvc/)以了解使用 AOP 的工作单元模式的实现

```
[UnitOfWork]
public void Process(Job job)
{
    ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T20:45:07.963

交易管理。我知道这是 AOP 的规范用法，但在用于此时它确实很出色。

虽然我还没有机会在现实世界中使用它，但我认为“环绕建议”非常强大，特别是它通过消除对许多代码的需求来简化代码复杂性所增加的价值检查罕见的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T21:44:10.940

AOP 很常见，只是人们很少称它为 AOP。查看 .NET 编程中使用属性的所有地方。属性本质上是可以应用于许多类/方法/参数的横切行为。

最近，ASP.NET MVC 平台大量使用属性，用于广泛的跨领域组件，例如安全性、数据绑定和异常处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T21:35:40.033

我同意 Spring AOP。

AOSD（我们不再谈论 AOP，我不知道为什么）对于中间件/面向服务的体系结构非常有用，在这些体系结构中，您已经通过设计获得了一些模块化。

在这种情况下，我将它用于具有一些非常有限的计费服务的电话服务。

我还用它来构建一种模块化解释器/编译器，以便围绕一些代码执行一些分析。

在我看来，一个问题是切入点语言有时很难准确地描述你想在哪里应用你的建议。另一个问题是作文，我不知道它是否已经解决，但是当你订购你的建议时可能很难理解......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-09T23:24:30.280

[e硬件验证语言](https://en.wikipedia.org/wiki/E_%28verification_language%29)使用AOP。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T21:00:55.127

以我的经验，Spring AOP 似乎很常见。

我认为困难在于人们只是不习惯从方面进行思考，并且即使在编译时编织代码也可能有些可怕，因为很难看到实际影响每种方法的因素，例如，esp如果您在编译时和运行时混合使用编织。

我在有一个控制器的情况下使用它，例如，我添加了它是 servlet 还是 web 服务。我还使用它来抽象出数据库，因此可以将数据库连接和数据库优化查询编织到应用程序中。

# asp.net - {ApplicationName}/ScriptResource.axd 和无效的视图状态

> ID：849999
> 
> 赞同：0
> 
> 时间：2009-05-11T20:42:56.997
> 
> 标签：asp.net

我有一个在网络场中运行的 asp.net 网络表单应用程序？

根据 MSDN 推荐，所有机器密钥在 web.config 中配置相同，但它会定期抛出“System.Web.HttpException: Invalid viewstate.”，并根据堆栈。

在这一行

请求：/{applicationname}/ScriptResource.axd +92

注意：{applicationname} 是我的应用程序名称。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-21T21:57:22.840

请参阅[.net 应用程序中的 Erratic Invalid Viewstate 问题](https://stackoverflow.com/questions/728513/erratic-invalid-viewstate-issue-in-net-application)********``*******