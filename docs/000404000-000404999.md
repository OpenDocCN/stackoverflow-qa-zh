# StackOverflow 问答 000404000-000404999

# silverlight - 在 Silverlight 中，在 System.Drawing.Color 和 System.Windows.Media.Color 之间进行转换的最佳方式是什么？

> ID：404002
> 
> 赞同：1
> 
> 时间：2008-12-31T20:40:38.030
> 
> 标签：silverlight

我正在尝试从 System.Drawing.Color 转换为 Silverlight System.Windows.Media.Color。我实际上是在尝试通过服务传递这种颜色。

通过网络传递的 System.Drawing.Color 不会独立地序列化 argb 值。

我可以将 argb 值转换为 32 位 int

```
[DataMember]  
public int MyColor { get { return Color.Red.ToArgb(); } set {} } 
```

但我在 System.Windows.Media.Color 中没有看到任何相应的方法可以将其转换回来。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T20:55:40.967

System.Drawing.Color 的 32 位表示假定一组字节顺序（例如 ARGB）并且每个通道由 8 位表示。

Silverlight 不做这些假设。相反，Media.Color 存储为四个 32 位浮点值，并且排序基于颜色配置文件。

要从 System.Drawing.Color 创建 Media.Color 值，您应该使用 FromArgb / FromRgb 方法并传入四个单独的组件。

如有必要，您可以通过与组合的 32 位值中的组件进行“与”运算来获得这些组件。您知道（或可以找出）此颜色值中字节的顺序，这是 Silverlight 所没有的知识。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T19:27:22.893

谢谢。这几乎就是我所做的，尽管我必须添加 .ToHtml 方法才能以十六进制表示法输出它：

```
[DataMember]
public string MyColor { 
    get { 
        return ColorTranslator.ToHtml(  
                   Color.FromArgb(  
                       Color.Red.A, 
                       Color.Red.R, 
                       Color.Red.G, 
                       Color.Red.B  
            )); 
     } 
     private set{}   
} 
```

所以另一方面，我可以使用从这里借来的代码[http://blogs.microsoft.co.il/blogs/alex_golesh/archive/2008/04/29/colorconverter-in-silverlight-2.aspx](http://blogs.microsoft.co.il/blogs/alex_golesh/archive/2008/04/29/colorconverter-in-silverlight-2.aspx)进行转换六边形到实心刷子。

它可以工作，但它很丑陋，而且对于我所假设的似乎相当复杂，显然错误的是，它是一种单一的方法。也许在下一个版本中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-17T05:33:32.240

这是[微软说要做的](http://msdn.microsoft.com/en-us/library/system.windows.media.color(VS.95).aspx)——但我不推荐它。

```
 String xamlString = "<Canvas xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\" Background=\"MistyRose\"/>";
  Canvas c = (Canvas) System.Windows.Markup.XamlReader.Load(xamlString);
  SolidColorBrush mistyRoseBrush = (SolidColorBrush) c.Background;
  Color mistyRose = mistyRoseBrush.Color; 
```

如果你问我，那完全是疯了 - 但那是来自 MS 文档！

# asp.net - 免费的 DotNetNuke 皮肤资源

> ID：404009
> 
> 赞同：4
> 
> 时间：2008-12-31T20:48:20.793
> 
> 标签：asp.net, open-source, dotnetnuke, skinning

有人有免费（或廉价）DotNetNuke 皮肤的优质资源吗？DotNetNuke 生态系统中的大多数皮肤资源都非常昂贵，因为您需要为一个可能不会带来任何收入的网站提供简单的皮肤。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T05:07:34.263

[大约有十个是从DNN Creative](http://skintemplates.dnncreative.com/)上可用的开源 CSS 模板转换而来的，这些模板质量非常好，而且免费。在[Snowcovered](http://www.snowcovered.com/Snowcovered2/Default.aspx?tabid=295&categoryid=19&sortby=Price-ASC)上也可以免费找到一些宝石，但请注意，有些宝石可能只有免费试用。

Google 上“[免费 dnn 皮肤](http://www.google.com/search?q=free+dnn+skins)”的最高搜索结果会将您带到[dnnskins.com](http://www.dnnskins.com/free-skins.aspx)，但其中大多数看起来都非常糟糕。

如果您对 HTML、CSS 和 DotNetNuke 皮肤有一定的了解，那么将开源 CSS 模板转换为 DotNetNuke 皮肤也相对容易。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-12T03:01:25.877

我拥有[http://www.dnnskins.com](http://www.dnnskins.com)，你知道的。你说的这些皮肤是残暴的牛神，是由许多认为自己也是设计师的萌芽开发者完成的！它们实际上是程序员皮肤——所以你在这里告诉我你自己的类型——世界上的程序员都是残暴的设计师？

虽然我同意它们不是那么整洁，但我花了几个月的时间试图让它们更新到不同版本的 DNN，这被证明是一个挑战。

我们已经将大约 20 个基于 css 的皮肤转换为 dnn 并使其兼容。

虽然它并不完美，但它是我能做到的最好的，基于我的时间和努力，以及我必须运行这个站点的实际帮助。至少可以说，读到有人收拾东西，然后甚至不提供建设性的解决方案，这有点令人沮丧。

告诉人们，如果你熟悉的话，转换一些东西相对容易，真的不能回答这里的问题吗？

我希望有更多免费的 dnn 皮肤网站，但现实是 - 这是一项每年花费数千美元来维护的大工作，其动机是尝试帮助 dnn 社区，但我可以看到像你自己牛神这样的人没有关于为大约 75,000 名饥饿用户构建、管理和提供服务所涉及的工作的想法。

干杯并感谢您对我的网站做出如此积极的评论！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T08:46:17.553

[DNN Creative](http://skintemplates.dnncreative.com/) CSS 模板很酷，但在 DotNetNuke 5 中存在问题。

例如，“Summer Breeze”皮肤中的超级用户内联检测会导致错误。即使从皮肤的 ascx 中删除了有问题的代码，我也遇到了容器问题。

使用 DNN 4 一切正常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-22T20:58:20.840

最好的方法是转到您的安装 Portals/_default/skins/MinimalExtropy 文件夹，只需复制该文件夹并将其命名为 mySkin 或您喜欢的任何名称。有 .ascx 文件和 skin.css 文件，.ascx 文件我只是喜欢具有基本 html 知识的 html 文件，您应该能够修改配色方案。由于此模式使用圣杯样式（如果您不知道，请上网查找），这应该可以适应您的所有更改。瞧，你有自己的个人皮肤。只要它在此文件夹中，它就会自动显示在皮肤中。（如果您使用 GoDaddy 进行托管，请使用文件资源管理器）

# c# - 在 .Net Winforms 中使用打印预览

> ID：404010
> 
> 赞同：1
> 
> 时间：2008-12-31T20:48:58.153
> 
> 标签：c#, .net, winforms, visual-studio-2008

我正在.Net 2008 Winforms 中编写 c# 代码。

我创建了一个打印预览窗口来创建报告。它工作正常，我可以预览报告然后打印它。唯一的问题是它不像 Office Print 预览那样灵活。用户不能选择默认打印机以外的打印机，也不能将打印限制在某些页面。也许我缺少一些我需要的属性。

这是我使用的部分代码：

```
PrintDocument pd = new PrintDocument();
            pd.PrintPage += new PrintPageEventHandler(this.PrintTheGraph);
            pd.DefaultPageSettings.Landscape = true;
            // Allocate a print preview dialog object.
            PrintPreviewDialog dlg = new PrintPreviewDialog();
            dlg.Width = 100;
            dlg.MinimumSize = new Size(375, 250);
            dlg.SetBounds(100, -550, 800, 800);
            dlg.Document = pd;
            DialogResult result = dlg.ShowDialog(); 
```

谢谢，

鲍勃

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-31T21:04:20.557

打印预览和打印是不同的功能，应该是不同的菜单选项。选择打印预览不应该打印您的文档，用户很可能希望在不实际打印的情况下查看他们的文档在页面上的布局。

要打印页面并允许选择打印机设备，请使用：

```
PrintDialog pDialog = new PrintDialog( );
pDialog.Document = printDocument;
if (pDialog.ShowDialog( ) == DialogResult.OK) {
    printDocument.DocumentName = fileName;
    printDocument.Print( );
    }
```

该类`PrintDialog`有一个`UseEXDialog`属性，可用于显示扩展的页面设置对话框，其中包含打印选择、范围、n-up 打印等。人。处理所有这些选项需要做很多工作，`PrintDialog` 首先要开始工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-26T10:03:24.853

谢谢

公共 OpenFileDialog dlg ; 私人 PrintDocument printDocument = new PrintDocument(); private void FileUpload_Click(object sender, EventArgs e) { dlg = new OpenFileDialog(); dlg.Filter = "Doc 文件 ( *.doc,* .docx)| *.pdf* ;*.xls, *.xlsx,* .txt";

```
 if (dlg.ShowDialog() == DialogResult.OK)
           txtFilename.Text = dlg.FileName;
    }

    private void button1_Click(object sender, EventArgs e)
    {
        label2.Text = txtFilename.Text;
        string sFileName = "";
        long nLength = 0;
        byte[] barFile = null;
        if (dlg.FileName != "")
        {
            System.IO.FileStream fs = new System.IO.FileStream(dlg.FileName, System.IO.FileMode.Open);
            System.IO.FileInfo fileInfo = new System.IO.FileInfo(dlg.FileName);
            sFileName = fileInfo.Name;
            nLength = fs.Length;
            barFile = new byte[fs.Length];
            fs.Read(barFile, 0, Convert.ToInt32(fs.Length));
            fs.Close();
            PrintDialog pDialog = new PrintDialog();
            pDialog.Document = printDocument;
            if (pDialog.ShowDialog() == DialogResult.OK)
            {
                printDocument.DocumentName = dlg.FileName;
                printDocument.Print();
            }
        }
        else
        {
            MessageBox.Show("Please Select the File For File Upload");
        }
    } 
```

# date - 处理历史日历日期

> ID：404013
> 
> 赞同：10
> 
> 时间：2008-12-31T20:53:52.700
> 
> 标签：date, time, calendar, rdf, genealogy

**有哪些标准和策略来处理以旧日历形式描述的历史日期？**

现代[公历](http://en.wikipedia.org/wiki/Gregorian_calendar)，具有不同长度的月份、闰年等，使用内置的编程语言库或数据格式（如[ISO8601](http://en.wikipedia.org/wiki/Iso8601)、[RFC3339](https://www.rfc-editor.org/rfc/rfc3339)和 RDF 的[OWL-Time](http://www.w3.org/TR/owl-time/)本体）相对容易处理。较早的表示形式，例如[儒略](http://en.wikipedia.org/wiki/Julian_calendar)历、宗教日历、[统治年](http://www.genproxy.co.uk/king_queen_reign_dates_regnal.htm)（例如*查理二世 13 日 6 月 3 日*）及其变体似乎并没有得到很好的满足。

我对解析和存储不同日历中的历史家谱日期以及当代数据特别感兴趣。是否有任何 RDF 本体涵盖不同日历中的日期？OWL-Time 似乎不包括日历。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T08:18:08.933

你需要什么取决于你所追求的。我认为您最好以简单的统一格式存储日期，例如“日历计算，第三版”（由 StarBlue 引用）中的 RD（rata die 或 RD）格式。但是，我也认为您应该保留原始文本作为起点的记录，以便可以根据要求验证对 RD 的翻译。

例如，如果你回到足够远的时间，英格兰的新年（至少出于某些目的）不是 1 月 1 日，而是 3 月 25 日（女士节）。例如，在中世纪早期，您可能会发现我们目前计算为 1167 年 2 月 14 日的日期会被当时记录日期的人视为 1166 年 2 月 14 日。1752 年 9 月（在英国及其殖民地）儒略历和公历之间变化的一个有趣的副作用是这一年缩短了 12 天。353 天而不是 365 天的税收计算会很糟糕，因此将纳税年度的结束日期更改为当前的 4 月 6 日 - 尽管日历发生了变化，但该年度仍然是 365 天。（好的；从技术上讲，这是有根据的推测。

因此，要处理“3 月 13 日查理二世”，您需要知道输入是 regnal 格式的，当天是 3，月份是 6 月（不太难），年份是查理二世在位的 13 日（1630-05-29 至 1685-02-06；从 1649-01-30 成为国王，但直到 1661-04-23 才加冕；从 1660 年开始，文件的日期就好像他自 1649 年以来在位一样；参见[维基百科](http://en.wikipedia.org/wiki/Charles_II_of_England)了解更多信息）。因此，据推测，所指的日期是儒略历的 1662-06-13（因为英格兰直到 1752 年才改用公历）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-31T21:06:25.140

我想你知道Reingold 和 Dershowitz的书“[日历计算”吗？](http://www.calendarists.com/)

# selenium - Selenium Fitnesse Bridge：如何存储和回显变量？

> ID：404014
> 
> 赞同：1
> 
> 时间：2008-12-31T20:53:57.053
> 
> 标签：selenium, fixtures, fitnesse, selenium-fitnesse-bridge

我正在使用[Selenium Fitnesse Bridge Fixture](http://www.michaelshimer.com/demo/demo.html)在 Fitnesse for Selenium 中编写测试。这很棒，因为它涵盖了 Selenium 的**所有**功能。但是，我遇到的问题是像在 Selenium IDE 中一样存储变量。

```
| !- 固定装置.SeleniumFixture -!|
| 设置 | http://www.google.com/ | *chrome /usr/lib/firefox-3.0.5/firefox |
| 开放| http://www.google.com/ | |
| 店铺位置 | 这里 | |
| 回声 | ${这里} | |
```

像这样简单的东西应该可以正常工作，但是当我保存测试时，我得到一个错误，未定义的变量。

```
| 店铺位置 | 这里 | |
| 回声 | 未定义的变量：这里 | |
```

这没有任何意义。我在回显之前定义了该行。当我运行测试时，我得到：

```
| 店铺位置 | 这里 | |
| 回声 | 未定义的变量：这里 | 未定义的变量：这里 |
```

[作者对他的测试](http://www.michaelshimer.com/demo/alltests.html)做同样的事情。为什么这对我不起作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T21:13:05.737

问题是Fitnesse变得困惑了。它认为您没有定义变量。

```
!定义变量{变量}
| 回声 | ${变量} | |
```

解决 Fitnesse 混淆的方法是通过用!- -! 包围变量名来逃避变量名。

```
| 店铺位置 | 这里 | |
| 回声 | ${!-这里-!} | |
```

现在这将回显所需的响应。

```
| !- 固定装置.SeleniumFixture -!|
| 设置 | http://www.google.com/ | *chrome /usr/lib/firefox-3.0.5/firefox |
| 开放| http://www.google.com/ | |
| 店铺位置 | 这里 | |
| 回声 | ${这里} | http://www.google.com |
```

# indexing - Visual FoxPro 紧凑索引文件格式

> ID：404015
> 
> 赞同：3
> 
> 时间：2008-12-31T20:54:30.547
> 
> 标签：indexing, file-format, visual-foxpro, foxpro, xbase

我试图了解 Visual FoxPro 紧凑索引 (*.IDX) 的文件格式。我目前正在参考[Microsoft 的文档](http://msdn.microsoft.com/en-us/library/s8tb8f47(VS.80).aspx)以获取指导。

索引是一个 512 字节节点的 B 树。每个叶（“外部”）节点包含多个条目。每个条目由四部分数据组成：

*   行号 [固定长度]
*   重复的字节数（文档没有解释这一点）[固定长度]
*   尾随字节数（文档没有解释这一点）[固定长度]
*   键[可变长度]

条目（没有它们的键）存储在节点的开头，紧跟在节点的 24 字节标头之后。它们的键不包含在此位置，因为键的长度不同，而行号、重复字节数和尾随字节数的长度是固定的。密钥存储在节点的末尾并向后工作。例如：

*   24 字节标头
*   行号、重复字节数、尾随字节数（条目 #1）
*   行号、重复字节数、尾随字节数（条目 #2）
*   行号、重复字节数、尾随字节数（条目 #3）
*   ...
*   密钥（条目 #3）
*   密钥（条目 #2）
*   密钥（条目 #1）

如何确定密钥的各个长度？该文档似乎没有指定这一点。它们是完全连续的（没有空字节分隔符）。

我可以通过目视检查手动隔离键。我怀疑尾随字节数代表密钥的长度。但是，它与本次检查确定的长度无关。

我相信 FoxPro 文件格式源自 xBase 标准。也许这敲响了警钟？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T13:23:42.737

在发现 XBase::Index Perl 模块后，我确定外部节点中的键实际上与内部节点中的固定长度键的长度相同，除了删除了任何尾随空格。这就是文档中提到的“尾随字节数”所指的内容（从键的末尾截断了多少尾随空格）。我还没有确定“重复字节数”是什么，但模块至少澄清了它的关系：

```
variable_key_length = fixed_key_length - duplicate_byte_count - trailing_byte_count 
```

例如，假设此索引的固定键长度为 10 个字节。现在假设密钥“DOG”存储在外部节点中。它的重复字节数（根据我观察到的）很可能为零，而它的尾随字节数将是 7（截断的空格数）。因此，将只存储代表“DOG”的三个字节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-22T06:00:16.397

关于重复字节数：这意味着第一个字节的数量，在当前键和前一个键中相同。存储在节点末尾的第一个键条目具有完整长度，除了尾随空格；连续的键输入仅具有与先前的键输入不同的符号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-17T21:20:16.553

在 Xbase 中，使用索引（索引讨论文本）时，索引很少超过 10 个字符或 15 个（很少）。

在任何情况下，如果您知道键的数量按比例划分二进制部分。当您制作存储数据的算法或使用以下方式存储数据时：开始或结束标记或制表符，或者您是否保留静态大小以便不使用留空。静态格式效率较低，但提供了更快的阅读速度，并且显然会生成更多可预测的结构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T03:50:40.237

[微软说](http://msdn.microsoft.com/en-us/library/aa975366(VS.71).aspx)这是关于 IDX 文件结构的（在页面底部有指向所有其他文件的链接，如[紧凑索引格式](http://msdn.microsoft.com/en-us/library/aa975346(VS.71).aspx)。）

# asp.net - 网络表单验证框架

> ID：404018
> 
> 赞同：0
> 
> 时间：2008-12-31T20:58:41.787
> 
> 标签：asp.net, validation

我发现在我的大多数 Web 项目中，我的大部分时间都花在验证客户端和服务器端的用户输入上。

我使用过 ASP.NET 表单验证控件，但我一直发现它们很麻烦，而且从来没有真正按照我想要的方式工作。所以通常我最终会手动汇总我自己的验证。

在我当前的项目中，每条记录大约有 450 个字段，并且这些记录最终会在许多不同的页面上得到更新，因此您可以想象这需要大量的时间来确保所有验证正确无误。

除了内置的 ASP.NET 表单验证控件之外，有没有人知道任何好的验证框架可以帮助我更快地进行验证？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T21:02:38.517

[http://peterblum.com/DES/ProfessionalValidation.aspx](http://peterblum.com/DES/ProfessionalValidation.aspx)

这是一个很棒的工具包和令人难以置信的价值。我喜欢 Scott Hanselman 所说的...“不是插件，而是对 ASP.NET 验证框架的完全重新构想。有一个学习曲线，但它会改变你编写页面的方式。还可以查看他的 Visual Security Security 和 Peter'sDatePackage。他的文档具有传奇色彩。”

# c# - WPF 类库中的程序集范围/根级样式

> ID：404019
> 
> 赞同：50
> 
> 时间：2008-12-31T20:59:08.900
> 
> 标签：c#, .net, wpf, xaml

我有一个支持 WPF 的 C# (2008/.NET 3.5) 类库程序集（基于[这篇文章](http://dotupdate.wordpress.com/2007/12/05/how-to-add-a-wpf-control-library-template-to-visual-c-express-2008/)）。
我已经创建了几个窗口，现在正尝试为它们创建一个通用样式集。但是，由于它是一个类库（而不是 WPF 应用程序），我没有一个 app.xaml（及其包含的应用程序和相应的 Application.Resources）来存储这些样式以供全局访问。

**那么：***如果我没有 app.xaml（见上文），我*如何创建一组顶级样式定义，这些样式定义将被程序集中的所有 xaml 文件看到？和/或是否可以*将*工作 app.xaml 添加到类库中？

仅供参考，我确实尝试在 ResourceDictionary.xaml 文件中创建 ResourceDictionary，并将其包含在“Window.Resources”块中的每个窗口中。事实证明，这解决了按钮的样式等问题……但不适用于封闭的窗口。我可以放入`Style="{StaticResource MyWindowStyle}"`Window 的开始块，它可以编译并很好地显示在 VS Design 窗口中，但是在实际运行时我得到一个解析异常（找不到 MyWindowStyle；我猜 Visual Studio 会看到包含在有问题的行，但 CRL 更按顺序执行操作，因此尚未加载 ResourceDictionary）。

* * *

感谢您的想法，但仍然不行......显然类库不支持 generic.xaml 隐式使用。我将 generic.xaml 添加到我的类库项目中，并将其构建操作设置为“资源”。它包含：

```
<ResourceDictionary 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Style TargetType="{x:Type Window}" x:Key="MyWindow">
        <Setter Property="Background" Value="Black"/>
    </Style>
</ResourceDictionary> 
```

我想要使​​用该主题的窗口 xaml 如下所示：

```
<Window x:Class="MyAssembly.ConfigureGenericButtons"
    x:ClassModifier="internal"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Style="{StaticResource MyWindow}"
    Title="ConfigureGenericButtons">
...Buttons, etc...
</Window> 
```

虽然 VS Design 窗口不显示使用 MyWindow 样式的窗口（即黑色背景），但它编译良好并启动。但是，当包含此类库的应用程序发出导致此窗口显示的调用时，我收到 XamlParseException：

> 找不到名为“{MyWindow}”的资源。

我还尝试省略 Style 参数，以查看窗口是否会默认使用该样式（并且我尝试了包含和不包含 generic.xaml 中的 x:Key）。没有错误，但 generic.xaml 中定义的任何内容也没有出现。

我在这里做错了什么，或者关于如何允许在窗口上使用常见自定义样式的任何其他想法（即，不必在每个窗口的 xaml 中定义样式） - 需要注意的是，这不是应用？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-02T18:00:16.207

尝试添加

```
Style={DynamicResource MyStyle} 
```

在这种情况下，您不能使用 StaticResource。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-01T04:00:31.387

这听起来像是主题化的工作。

1.  将`/themes/generic.xaml`ResourceDictionary 添加到您的项目中。
2.  将以下内容添加到 AssemblyInfo.cs：`[assembly: ThemeInfo(ResourceDictionaryLocation.None, ResourceDictionaryLocation.SourceAssembly)]`
3.  ?
4.  利润！

您添加到通用的任何资源都将被所有控件使用。您还可以通过在目录中包含具有正确主题名称的 ResourceDictionary 文件来制作配置文件特定主题（Luna、Aero 等）`themes`。

这是指向更多信息的链接：[创建和应用自定义主题](https://web.archive.org/web/20090124183844/http://blog.rioterdecker.net/blogs/chaz/archive/2006/03/06/100.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-02T15:38:23.417

如果您没有 app.xaml，您仍然可以将其加载到应用程序级资源中，但您必须编写代码（不是 xaml）来执行此操作，类似于此...

```
void LoadIt()
{
     ResourceDictionary MyResourceDictionary = new ResourceDictionary();
     MyResourceDictionary.Source = new Uri("MyResources.xaml", UriKind.Relative);
     App.Current.Resources.MergedDictionaries.Add(  MyResourceDictionary )
} 
```

看看这个网站的例子： [~~http ://ascendedguard.com/2007/08/one-of-nice-features-about-wpf-is-how.html~~](http://ascendedguard.com/2007/08/one-of-nice-features-about-wpf-is-how.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-08T16:26:23.943

WPF 博士（或以前称为 WPF 博士的人）在这个主题上有一篇很棒[的帖子](http://drwpf.com/blog/2007/10/05/managing-application-resources-when-wpf-is-hosted/)。

这是他们创建 Application 对象并添加资源的帖子的摘录：

```
if (Application.Current == null)
{
    // create the Application object
    new Application();

    // merge in your application resources
    Application.Current.Resources.MergedDictionaries.Add(
        Application.LoadComponent(
            new Uri("MyLibrary;component/Resources/MyResourceDictionary.xaml",
            UriKind.Relative)) as ResourceDictionary);
} 
```

由于我的程序集是通过互操作托管的，因此我必须添加如下设置 ShutdownMode 并在完成时关闭：

```
new Application() { ShutdownMode = ShutdownMode.OnExplicitShutdown }; 
```

它就像一个魅力。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-24T21:22:11.057

这是跨**.NET 类库****共享“模块范围”资源**的简单解决方案。重要的是，它似乎在**Visual Studio中稳健地保留了****XAML 设计器**的显示功能和行为。

 ******首先添加一个派生自如下的新**C#类。**`ResourceDictionary`此类的实例将替换类库中需要查看共享资源的`ResourceDictionary`每个`System.Windows.Control`（或其他轴承组件）的默认值：`ResourceDictionary`

**组件资源.cs：**

```
using System;
using System.Reflection;
using System.Windows;
using System.Windows.Markup;

namespace MyNamespace
{
    [UsableDuringInitialization(true), Ambient, DefaultMember("Item")]
    public class ComponentResources : ResourceDictionary
    {
        static ResourceDictionary _inst;

        public ComponentResources()
        {
            if (_inst == null)
            {
                var uri = new Uri("/my-class-lib;component/resources.xaml", UriKind.Relative);
                _inst = (ResourceDictionary)Application.LoadComponent(uri);
            }
            base.MergedDictionaries.Add(_inst);    //  <--  !
        }
    };
} 
```

请务必将前面的代码片段中的**`MyNamespace`**和替换**`my-class-lib`**为（分别）您自己项目中的命名空间和程序集文件名（不带“.dll”扩展名）：

将新的`ResourceDictionary` **XAML**文件添加到您的类库项目。与“应用程序”程序集不同，Visual Studio UI 中没有此选项，因此您必须手动完成。这将包含您要在整个类库中共享的资源：

**$(项目目录)\Resources.xaml:**

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/netfx/2009/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MyNamespace">

    <!-- define the resources to be shared across the whole class library here -->

    <!-- example for demonstration -->
    <Style TargetType="Rectangle">
        <Setter Property="Fill" Value="Red" />
    </Style>

<ResourceDictionary> 
```

将**构建操作**设置为**“页面”**并确保文件属性信息如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/bK6y1.png)](https://i.stack.imgur.com/bK6y1.png)

最后，转到项目中需要引用共享资源的**XAML**`ResouceDictionary`文件，并将默认值（通常`Resources`在 XAML 根元素的属性上）替换为`ComponentResources`实例。这将保存每个组件的私有资源，正如您在顶部的 C# 代码（`ComponentResources`构造函数）中所见，这些不同实例中的每一个都将附加相同的模块范围共享单例`ResourceDictionary`作为“合并字典”。对应该看到共享资源的每个控件执行此操作，即使是那些没有自己的私有资源的控件。当然，您也可以根据需要跳过此步骤以将某些控件排除在共享之外。例如：

```
<UserControl x:Class="MyNamespace.UserControl1"
             xmlns="http://schemas.microsoft.com/netfx/2009/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MyNamespace">

    <UserControl.Resources>
        <local:ComponentResources>
            <!-- Keep any existing non-shared resources here from before -->
            <!-- Can be empty if this control has no private resources -->
        </local:ComponentResources>
    </UserControl.Resources>

    <!-- to demonstrate that the Style in the above example is effective... -->
    <Grid>
        <Rectangle Width="10" Height="10" />
    </Grid>

</UserControl> 
```

正如所宣传的那样，它工作得很好，包括在**XAML 设计器**中......

[![在此处输入图像描述](https://i.stack.imgur.com/8IGy7.png)](https://i.stack.imgur.com/8IGy7.png)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T21:45:34.220

如果您在 Window.Resource 中加载它，则该字典仅适用于该窗口的子窗口。您需要让它可用于窗口及其子项。

尝试将其加载到您的 app.xaml 文件中。这应该使它成为应用程序级资源，而不是窗口级资源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-17T03:53:52.950

所以在花了很多时间之后，我终于想通了。就是这样：

1.  在 WPF 控件库中，添加一个名为`themes`.
2.  在`themes`文件夹中，添加一个名为`generic.xaml`.
3.  在内部`generic.xaml`，使用以下语法添加您的资源：

    ```
    <SolidColorBrush x:Key="{ComponentResourceKey {x:Type local:UserControl1}, MyEllipseBrush}" Color="Blue" /> 
    ```

4.  在您的控制下，使用以下语法访问此资源：

    ```
    Background="{StaticResource {ComponentResourceKey {x:Type local:UserControl1}, MyEllipseBrush}}" 
    ```

注意事项：

1.  当您创建新的 WPF 控件库时，Visual Studio 通常会自动为您完成第 1 步和第 2 步。
2.  我不完全理解`ComponentResourceKey`第一个参数的用途，但它是必需的。使用将使用此资源的控件的名称。
3.  在我的案例中，Visual Studio 的设计器无法找到该资源。这可能是缓存问题，我不确定。但是在运行时它工作得很好。
4.  [您可以在此 MSDN 文章](https://msdn.microsoft.com/en-us/library/ms753186)中阅读有关此语法的更多详细信息。

希望这能让一些生活更轻松。

# apache-flex - 在 Flex 中的数据绑定重新加载之间保留列表 selectedIndex

> ID：404020
> 
> 赞同：1
> 
> 时间：2008-12-31T21:00:28.973
> 
> 标签：apache-flex, actionscript-3, data-binding

在我的 Flex 界面中，我有一些数据绑定到 ArrayCollections 的 List 组件。我发现当 ArrayCollections 被更新（通过 Web 服务）并且 Lists 的数据绑定更新时，每个 List 都被重置并且其 selectedIndex 被删除。如果用户正在执行一项任务并且已经在列表中选择了一个项目，但尚未提交表单，则这是一个问题。

我知道如何组合一些 ActionScript 来处理这些情况，但是您知道使用 Flex 的数据绑定或通用事件实用程序更自然地处理这些情况的任何方法吗？

一如既往，谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T21:41:30.357

[我喜欢使用此处](http://weblogs.macromedia.com/paulw/archives/2006/05/the_worlds_smal.html)找到的观察类在数据更改时调用函数。它有两个参数：要观察的数据和要调用的函数。（节省您一直重复 setter 和 getter 的时间）

我会在选择它时存储 selectedItem 并且在更新数据时通过循环遍历列表并再次选择该项目来重新选择该项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T05:11:05.570

我们有一个 SelectionRestorer 类可以做到这一点。只需将其添加到 MXML 并将其目标设置为列表/组合框/您想要重新填充的任何内容，它就会为您完成所有的监视。

高温下，

山姆

* * *

我们正在招聘！华盛顿特区（或希望搬迁）的开发人员和 QA 应将简历发送至 careers@blinemedical.com。

* * *

```
package com.atellis.common.controls {
import flash.events.Event;
import flash.events.EventDispatcher;

import mx.events.CollectionEvent;
import mx.events.ListEvent;

public class SelectionRestorer extends EventDispatcher
{
    private var previousSelectedItems:Array;

    private var _compareField:String;
    [Bindable("compareFieldChanged")]
    public function get compareField():String {
        return _compareField;
    }
    public function set compareField(value:String):void {
        _compareField = value;
        dispatchEvent(new Event("compareFieldChanged"));
    }

    private var _compareFunction:Function;
    [Bindable("compareFunctionChanged")]
    public function get compareFunction():Function {
        return _compareFunction;
    }
    public function set compareFunction(value:Function):void {
        _compareFunction = value;
        dispatchEvent(new Event("compareFunctionChanged"));
    }

    private var _target:Object;
    [Bindable("targetChanged")]
    public function get target():Object {
        return _target;
    }

    public function set target(value:Object):void {
        if (_target) {
            if (_target.dataProvider) {
                _target.dataProvider.removeEventListener(CollectionEvent.COLLECTION_CHANGE, dataChangeHandler);
            }
            _target.removeEventListener(ListEvent.CHANGE, selectionChangeHandler);
            _target.removeEventListener(CollectionEvent.COLLECTION_CHANGE, dataChangeHandler);              
        }
        _target = value;
        if (value) {
            value.addEventListener(ListEvent.CHANGE, selectionChangeHandler, false, 0, true);
            value.addEventListener(CollectionEvent.COLLECTION_CHANGE, dataChangeHandler, false, 100.0, true);
            if (value.dataProvider) {
                value.dataProvider.addEventListener(CollectionEvent.COLLECTION_CHANGE, dataChangeHandler, false, 100.0, true);
            }
        }
        dispatchEvent(new Event("targetChanged"));
    }

    public function refresh():void {
        if (useMultipleSelect) {
            previousSelectedItems = target.selectedItems;
        } else {
            previousSelectedItems = [target.selectedItem];
        }
    }

    public function clear():void {
        previousSelectedItems = null;
    }

    private function compareFieldFunction(o1:Object, o2:Object):Boolean {
        if (o1 == null || o2 == null) {
            return false;
        }
        var v1:Object = o1[compareField];
        var v2:Object = o2[compareField];
        return v1 != null && v2 != null && v1 == v2;                
    }

    private function compareEqualityFunction(o1:Object, o2:Object):Boolean {
        if (o1 == null || o2 == null) {
            return false;
        }
        return o1 == o2;                
    }

    private function get useMultipleSelect():Boolean {
        return "selectedItems" in target && "allowMultipleSelection" in target && target.allowMultipleSelection;
    }

    private function selectionChangeHandler(event:ListEvent):void {
        refresh();
    }

    private function dataChangeHandler(event:CollectionEvent):void {

        if (previousSelectedItems == null || previousSelectedItems.length == 0) {
            return;
        }

        if (target.dataProvider == null) {
            previousSelectedItems = null;
            return;
        }

        var comparer:Function = compareFunction;

        if (comparer == null) {
            if (compareField == null) {
                comparer = compareEqualityFunction;
            } else {
                comparer = compareFieldFunction;
            }
        }

        // when you assign an array to ListBase.selectedItems, it removes all items from the array,
        // so we need to build two arrays, one to assign, and one for current state
        var indices:Array = new Array();
        var items:Array = new Array();
        var dpIndex:int = 0;            
        for each(var newItem:Object in target.dataProvider) {
            for(var i:int = 0; i<previousSelectedItems.length; i++) {
                if (comparer(newItem, previousSelectedItems[i])) {
                    indices.push(dpIndex);
                    items.push(newItem);
                    previousSelectedItems.splice(i, 1);
                    break;
                }                       
            }
            if (previousSelectedItems.length == 0) {
                break;
            }
            dpIndex++;
        }
        target.validateNow();

        if (useMultipleSelect) {
            target.selectedIndices = indices;
        } else {
            target.selectedIndex = indices[0];
        }

        if (items.length) {
            previousSelectedItems = items;
        } else {
            previousSelectedItems = null;
        }
    }               
}
} 
```

# sharepoint - 如何最好地将 SharePoint 多用户字段字符串转换为 SPUsers 数组？

> ID：404024
> 
> 赞同：9
> 
> 时间：2008-12-31T21:02:53.837
> 
> 标签：sharepoint, wss

我正在为 SharePoint 列表编写 ItemAdding 处理程序，并且该列表包含多用户字段。由于此时 SPItem 实际上不可用，我认为我只能使用从 SPItemEventDataCollection 返回的字符串。当存在 user1、user2 和 user3 时，该字符串将如下所示：

1;#MYDOMAIN\user1;#4;#MYDOMAIN\user2;#10;#MYDOMAIN\user3

我想将其转换为 SPUser 对象数组，以便将其传递给另一个现有方法。是否有任何 SharePoint 内置方法来处理这些字符串，还是我只能解析这个字符串？

另外，假设我需要处理这个字符串，看起来这里的整数标记总是对应于后面的域\用户名。在任何情况下，这将不正确并且整数或域\用户名丢失或不正确？仅使用数字并使用 SPWeb 的 SiteUsers.GetByID(id) 方法是否安全？在少数测试中，我无法让它失败，但如果数字和字符串数据完全冗余，它们都会被包含在内，这似乎很奇怪。

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-19T07:21:08.027

SPFieldUserValueCollection 完全符合您的要求。它的构造函数接受一个 SPWeb 和用户字符串。集合中的 SPFieldUserValue 项提供了一个 User 属性，该属性返回 Web 的相应 SPUser 对象。

```
private void ProcessUsers(SPListItem item, string fieldName)
{
  string fieldValue = item[fieldName] as string;
  SPFieldUserValueCollection users = new SPFieldUserValueCollection(item.Web, fieldValue);

  foreach(SPFieldUserValue uv in users)
  {
    SPUser user = uv.User;
    // Process user
  }
} 
```

SPFieldUser 类型从标准 SPFieldLookup 继承其行为，该标准还存储 ID 和 Title 并具有相应的 SPFieldLookupValueCollection。ID 支持（弱）引用完整性，而缓存的 Value 允许快速查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T13:51:15.690

这适用于我从用户字段中获取 SPSuser 从事件数据中提取它应该是相同的事情。：

```
private SPUser getGroup(SPListItem item, string fieldName)
        {
            string fieldValue = item[fieldName] as string;
            if (string.IsNullOrEmpty(fieldValue)) return null;
            int id = int.Parse(fieldValue.Split(';')[0]);
            SPUser user = item.Web.AllUsers.GetByID(id);
            return user;
        } 
```

整数是指本地 SPWebs 的用户数据库中的用户 id。但是，这不会同步，因此自从保存列表项后，用户可能已从用户数据库中删除。

# php - 你如何管理 api 密钥

> ID：404027
> 
> 赞同：2
> 
> 时间：2008-12-31T21:04:48.310
> 
> 标签：php, api, oauth, key

我正在考虑构建一个 API，并且正在考虑使用 oauth 来管理对 api 的访问，但我正在做的更多的是一个 b2b 系统，它允许企业访问数据以将其合并到他们的站点中。一开始我不会有任何b2c。

所以 oauth 对我来说似乎不是正确的工具，我一直在寻找有关构建基于密钥的系统的资源，但没有遇到任何问题。

那里已经有东西了吗？最好只创建一些用户提交的数据的哈希或类似的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T21:38:43.623

您需要的只是唯一标识用户的东西......只需使用 UUID 或 UUID 的哈希值。

只需确保此 ID 通过安全通道传递，如果您通过不安全通道传递它，您可能需要实现一些类似于 HTTP 摘要身份验证的方法来保护 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T22:41:15.370

看看几乎所有的 Web 2.0 站点/服务。他们都有不同程度的身份验证和管理 API 密钥。Flickr、Twitter、Github 等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T23:29:56.490

根据要求，在 web api 的世界中，为您的合作伙伴/开发人员提供 API 密钥（标识）并要求他们签署调用（身份验证）是非常标准的。有很多方法可以指定签名。这些天很常见的是；获取调用的所有参数、时间戳（+/- 5 分钟摆动）、共享密钥，并使用 SHA-1 或 MD5（SHA-1 更好）对其进行哈希处理。

您可以自己实施，也可以找一个合作伙伴（有几个）为您完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-12T10:41:38.017

这里建议的一般方法（使用包含 API 密钥和当前时间的哈希）都很好 - 当然比在消息中包含“密码”更好。

但是，有一种称为 HMAC 的“绿”操作的加密标准方法。如果您想要更标准/强大/安全的东西，非常值得一看。

最后，显然有来自安全选项的“黄金标准”——使用数字证书来签署所有请求（计算成本可能很高）或用于签署初始请求，然后生成有限使用的会话密钥（例如，仅一个 API，使用60 分钟后到期）。

或者，您可以将 2-way SSL 用于传输层，并在应用程序/API 中简单地信任它。

真的取决于你想要它有多安全...... :]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T21:09:27.037

我不会只使用用户提交的数据，因为这会造成 API 密钥可猜测的情况。通常，我会获取用户生成的一些数据，然后将其与一些相对唯一的数据（即当前系统时间）结合起来，并使用 SHA-1 或其他方法对其进行哈希处理，如果我不这样做，可能会更改表示希望它显然是一个 SHA-1 哈希，然后将其用作密钥。

# sql - SQL“IF”、“BEGIN”、“END”、“END IF”？

> ID：404029
> 
> 赞同：50
> 
> 时间：2008-12-31T21:07:32.643
> 
> 标签：sql

根本不是 SQL 人。有顾问编写的以下代码。

首先，它确保只选择了一所小学——然后，在 BEGIN 之后，如果变量 @Term 等于 3，我们希望在该 IF 语句下执行这些操作。这就是问题所在。当@Term 不是 = 3 时，我们仍然想要下拉并执行 SECOND INSERT INTO @Classes 部分。仅供参考 - 运行时 Term 为 = 3，但它没有同时执行 INSERT - 在“IF @Term = 3”部分的末尾是否应该有一个 END IF 而不仅仅是一个普通的 END？

```
IF @SchoolCategoryCode = 'Elem' 

--- We now have determined we are processing an elementary school...

BEGIN

---- Only do the following if the variable @Term equals a 3 - if it does not, skip just this first part

    IF @Term = 3

    BEGIN

        INSERT INTO @Classes

        SELECT      
        XXXXXX  
        FROM XXXX blah blah blah

    END   <----(Should this be ENDIF?)

---- **always** "fall thru" to here, no matter what @Term is equal to - always do the following INSERT for all elementary schools

    INSERT INTO @Classes    
    SELECT
    XXXXXXXX    
    FROM XXXXXX (more code) 

END 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-12-31T21:19:24.787

它与 SQL 语言的范式有关。`IF`根据定义，语句只能采用 **单个**SQL 语句。但是，有一种特殊的 SQL 语句可以包含多个 SQL 语句，即`BEGIN-END`块。

如果省略该`BEGIN-END`块，您的 SQL 将运行良好，但它只会执行第一条语句作为`IF`.

基本上，这是：

```
IF @Term = 3
    INSERT INTO @Classes
    SELECT              
        XXXXXX  
    FROM XXXX blah blah blah 
```

与`BEGIN-END`块相同，因为您只执行一条语句。然而，出于同样的原因，在类 C 语言的语句中不包含花括号`IF`是一个坏主意，**总是**最好使用`BEGIN`and `END`。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-12-31T21:18:16.880

SQL 中没有 ENDIF。

只有当 if 表达式为真时，才执行直接跟在 IF 后面的语句。

BEGIN ... END 结构与 IF 是分开的。它将多个语句绑定在一起作为一个块，可以将它们视为单个语句。因此 BEGIN ... END 可以直接在 IF 之后使用，因此 BEGIN .... END 序列中的整个代码块将被执行或跳过。

在您的情况下，我怀疑 FROM XXXXX 之后的“（更多代码）”是您的问题所在。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-12-31T21:20:28.137

手头上的代码看起来是正确的。如果您尝试使用“Else”并看看会发生什么？

```
IF @SchoolCategoryCode = 'Elem' 

--- We now have determined we are processing an elementary school...

BEGIN

---- Only do the following if the variable @Term equals a 3 - if it does not, skip just this first part

    IF @Term = 3
    BEGIN
        INSERT INTO @Classes

        SELECT              
            XXXXXX  
        FROM XXXX blah blah blah

        INSERT INTO @Classes    
        SELECT
        XXXXXXXX    
        FROM XXXXXX (more code) 
    END   <----(Should this be ENDIF?)
    ELSE
    BEGIN

        INSERT INTO @Classes    
        SELECT
        XXXXXXXX    
        FROM XXXXXX (more code) 
    END
END 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-31T22:17:49.350

您还可以重写代码以完全删除嵌套的“If”语句。

```
INSERT INTO @Classes    
SELECT XXXXXX      
FROM XXXX 
Where @Term = 3   

---- **always** "fall thru" to here, no matter what @Term is equal to - always do
---- the following INSERT for all elementary schools    
INSERT INTO @Classes        
SELECT    XXXXXXXX        
FROM XXXXXX (more code) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-31T21:12:14.147

如果这是 MS Sql Server，那么您所拥有的应该可以正常工作...实际上，从技术上讲，您根本不需要 Begin & End，因为 begin-End 块中只有一条语句...（我假设@Classes 是一个表变量？）

```
If @Term = 3
   INSERT INTO @Classes
    SELECT                  XXXXXX  
     FROM XXXX blah blah blah
-- -----------------------------

 -- This next should always run, if the first code did not throw an exception... 
 INSERT INTO @Classes    
 SELECT XXXXXXXX        
 FROM XXXXXX (more code) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T21:12:39.480

如果我没记错的话，而且我经常不这样做...... Transact-Sql 中没有 END IF 支持。BEGIN 和 END 应该完成这项工作。你有错误吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-31T21:23:49.940

唯一一次插入@clases 失败是在第一个插入语句中发生错误。

如果是这种情况，那么您需要决定第二个语句是否应该在第一个语句之前运行，或者您是否需要一个事务来执行回滚。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-02-10T08:54:44.143

> 块引用

就像 .NET 中的括号一样

```
IF
  BEGIN
      do something
  END
ELSE 
  BEGIN 
      do something
  ELSE 
```

等于

```
if
{
   do something
}
else
{
   do something
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-31T21:17:21.467

根据您对您想要做什么的描述，代码似乎是正确的。ENDIF 不是有效的 SQL 循环控制关键字。您确定 INSERTS 实际上是在提取数据以放入 @Classes 吗？事实上，如果它很糟糕，它就不会运行。

您可能想要尝试的是在其中放置一些 PRINT 语句。在每个 INSERTS 上方放置一个 PRINT，只是输出一些愚蠢的文本以表明该行正在执行。如果你得到两个输出，那么你的 SELECT...INSERT... 是可疑的。您也可以只执行 SELECT 来代替 PRINT（即不使用 INSERT），并准确查看正在提取的数据。

# algorithm - 你喜欢你的主键吗？

> ID：404040
> 
> 赞同：92
> 
> 时间：2008-12-31T21:14:11.800
> 
> 标签：algorithm, database-design, relational-database, primary-key, ddl

在我团队的一次相当热烈的讨论中，我被迫思考大多数人喜欢什么作为主键。我们有以下小组-

1.  Int/ BigInt 哪个自动增量是足够好的主键。
2.  应该至少有 3 列构成主键。
3.  Id、GUID 和人类可读的行标识符都应该区别对待。

PK的最佳方法是什么？如果你能证明你的观点是正确的，那就太棒了。有没有比上述更好的方法？

编辑：任何人都有一个简单的示例/算法来为可扩展的行生成人类可读的标识符？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-12-31T21:21:47.590

如果您打算在偶尔连接的应用程序的数据库之间进行任何同步，那么您应该使用 GUID 作为主键。调试有点痛苦，所以除了这种情况，我倾向于坚持使用自动增量的整数。

自动增量整数应该是您的默认值，**不**使用它们应该是合理的。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-01-01T03:09:08.590

我没有看到一个答案指出（我认为）真正的基本点 - 即，主键是保证你不会在同一个现实世界实体的表中获得两个条目（如在数据库中建模）。这一观察有助于确定主键的哪些是好的选择，哪些是不好的选择。

例如，在（美国）州名称和代码表中，名称或代码可以是主键 - 它们构成两个不同的候选键，并且选择其中一个（通常较短 - 代码）作为主键首要的关键。在函数依赖理论（以及连接依赖——1NF 到 5NF）中，候选键比主键更重要。

举个反例，人名通常是主键的错误选择。有很多人叫“约翰·史密斯”或其他类似的名字；即使考虑到中间名（记住：不是每个人都有一个 - 例如，我没有），重复的空间很大。因此，人们不使用名称作为主键。他们发明了人工密钥，例如社会安全号码 (SSN) 或员工号码，并使用它们来指定个人。

理想的主键是简短的、独特的、令人难忘的和自然的。在这些特征中，唯一性是强制性的；鉴于现实世界数据的限制，其余部分必须灵活调整。

因此，在确定给定表的主键时，您必须查看该表代表什么。表中的哪组或哪组列值唯一标识表中的每一行？这些是候选键。现在，如果每个候选键由 4 或 5 列组成，那么您可能会认为它们太笨拙而不能成为一个好的主键（主要是因为简短）。在这种情况下，您可能会引入一个代理键 - 一个人工生成的数字。很多时候（但不总是）一个简单的 32 位整数对于代理键就足够了。然后将此代理键指定为主键。

但是，您仍然**必须**确保其他候选键（因为代理键也是候选键，以及选择的主键）都作为唯一标识符维护 - 通常通过对这些列集放置唯一约束。

有时，人们发现很难确定是什么让一行独一无二，但应该有办法做到这一点，因为简单地重复一条信息并不能使它变得更加真实。如果您不小心并且确实获得了两行（或更多）声称存储相同信息的行，然后您需要更新信息，则存在仅更新一行的危险（尤其是如果您使用游标）而不是每一行，所以行不同步，没有人知道哪一行包含正确的信息。

在某些方面，这是一个相当强硬的观点。

在需要时使用 GUID 并没有什么特别的问题，但它们往往*很大*（如 16-64 字节），而且使用得太频繁了。通常一个非常好的 4 字节值就足够了。使用 4 字节值就足够的 GUID 会浪费磁盘空间，并且会减慢对数据的索引访问，因为每个索引页的值较少，因此索引会更深，必须读取更多页才能到达信息。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-31T22:01:42.843

这只是一个宗教问题，因为人们寻求一个普遍的正确答案。您的团队和这个 SO 线程都显示出如此多的分歧这一事实应该是一个线索，表明有充分的理由在不同的情况下使用您描述的所有解决方案。

*   当表中没有其他属性或属性集适合唯一标识行时，代理键很有用。
*   如果可能，自然键是首选，以使表格更易于阅读。自然键还允许依赖表中的外键包含实际值而不是代理 id。例如，当您需要存储`state`（CA、TX、NY）时，您不妨使用`char(2)`自然键而不是 int。
*   在适当的地方使用复合主键。当存在完美的复合键时，不要不必要地添加“ `id`”代理键（在多对多表中尤其如此）。每个表中的三列键的授权绝对是胡说八道。
*   当您需要在多个站点上保持唯一性时，GUID 是一种解决方案。如果您需要主键中的值是唯一的，但不是有序的或连续的，它们也很方便。
*   INT 与 BIGINT：表*需要*64 位范围的主键并不常见，但随着 64 位硬件可用性的增加，它不应该成为负担，并且可以确保不会溢出。INT 当然更小，所以如果空间非常宝贵，它可以带来一点优势。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-12-31T21:23:02.050

我喜欢[将数据库程序员博客](http://database-programmer.blogspot.com/2007/12/database-skills-complete-contents.html)作为此类信息的来源。

主键的 3 列？我会说，列应该根据业务规则的要求具有适当的唯一约束，但我仍然有一个单独的代理键。复合键意味着业务逻辑进入键。如果逻辑发生变化，您的整个架构就会被搞砸。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-01-06T12:14:40.643

我喜欢我独一无二的。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-01-03T03:23:53.573

有点离题，但我觉得有必要插话...

如果您的主键是 GUID，***请不要***将其**设为聚集索引**。由于 GUID 是非顺序的，因此几乎每次插入期间，数据都会在磁盘上重新排列。（糟糕。）如果使用 GUID 作为主键，它们应该是非聚集索引。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-12-31T22:15:52.677

我总是使用代理键。代理键（通常是标识列、自动增量或 GUID）是其中键不存在于数据本身中的键。另一方面，自然键是其自身唯一标识行的键。据我所知，生活中几乎没有*真正的*天然钥匙。甚至美国的 SSN 之类的东西也不是自然密钥。复合主键是一场等待发生的灾难。您无法编辑任何数据（这是任何自然键的主要缺点，无论是否组合），但更糟糕的是，使用组合键，现在您必须将该键数据永久保存到每个相关表中。多么巨大的浪费。

现在，为了选择代理键，我坚持使用标识列（我主要在 MS SQL Server 中工作）。GUID 太大，Microsoft 建议*不要*将它们用作 PK。如果您有多个服务器，您需要做的就是增加 10 或 20 或任何您认为需要同步/扩展的服务器的最大数量，并为每个后续服务器上的每个表添加种子，并且您将永远不会发生数据冲突。

当然，由于增量，我将标识列设为 BigInt（也称为长 [64 位]）。

做一些数学运算，即使增量为 100，表中仍然可以有 92,233,720,368,547,758（> 92 万亿）行。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-12-31T22:02:17.493

我认为在短语“Primary” Key 中使用“Primary”一词在真正意义上具有误导性。

首先，使用“键”是表中必须唯一的一个属性或一组属性的定义，

然后，拥有任何密钥服务于几个经常相互不一致的目的。

1.  用作与该父表有关系的子表中的一条或多条记录的连接条件。（在这些子表中显式或隐式定义外键）
2.  （相关）确保子记录必须在父选项卡中有父记录；e（子表FK必须作为Key存在于父表中）
3.  提高需要在表中快速定位特定记录/行的查询的性能。

4.  通过防止在表中插入代表相同逻辑实体的重复行来确保数据一致性。（这通常被称为“自然”键，应该由相对不变的表（实体）属性组成。）

显然，任何无意义的、非自然的键（如 GUID 或自动生成的整数）完全无法满足 #4。

但通常，对于许多（大多数）表，可以提供 #4 的完全自然的键通常包含多个属性并且过宽，或者太宽以至于将其用于目的 #1、#2 或 #3 会导致不可接受性能后果。

答案很简单。两者都用。对其他子表中的所有联接和 FK 使用简单的自动生成整数键，但要确保每个需要数据一致性的表（很少有表不需要）都有一个备用的自然唯一键，以防止插入不一致的数据行。 .. 另外，如果你总是同时拥有这两者，那么所有反对使用自然键的反对意见（如果它改变了怎么办？我必须改变它被引用为 FK 的每个地方）变得没有实际意义，因为你没有使用它。 ..您只在它是PK的一个表中使用它，以避免不一致的重复数据......

至于 GUID，使用它们时要非常小心，因为在索引中使用 guid 可以处理索引碎片。用于创建它们的最常用算法将 guid 的“随机”部分放在最重要的位位置......这增加了在添加新行时对常规索引碎片整理/重新索引的要求。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-12-31T22:25:09.600

您永远不应该做的一件事是使用智能钥匙。这是一把钥匙，其中有关记录的信息被编码在钥匙本身中，它最终会咬你。

我在一个地方工作，主键是帐户 ID，它是字母和数字的组合。我不记得任何细节，但是，例如，那些属于某种类型的帐户将在 600 范围内，而另一种类型的帐户则以 400 开头。那太好了，直到那个客户决定同时要求两者工作类型。或者改变他们所做的工作类型。

另一个地方，使用树中的位置作为记录的主键。所以会有如下的记录。

```
Cat1.subcatA.record1
Cat1.subcatA.record2
Cat1.subcatB.record1
Cat2.subcatA.record1 
```

当然，客户首先想要的是一种在树上移动物品的方法。整套软件在那之前就死了。

拜托，拜托，拜托，如果你正在编写我必须维护的代码，请不要使用智能钥匙！

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-31T21:20:13.130

我喜欢将自动增量作为主键。我内心深处知道这是一种逃避，但它确实可以很容易地按添加数据的时间对数据进行排序（ORDER BY ID DESC，f'r instance）。

3 列对于人类解析来说听起来非常刺耳。

这就是权衡——你需要多少关系能力，而不是让这个表在此处被人类询问（相对于存储过程或编程接口）是可以理解的。

自动增量适用于我们人类。:-(

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-31T21:21:01.397

一般来说，这取决于。

就个人而言，我喜欢自动增量整数。

但是，我可以告诉你的一件事是永远不要相信来自其他来源的数据作为你的密钥。我发誓，每次我这样做时，它都会回来咬我。好吧，再也不会了！

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-12-31T21:25:07.270

> 应该至少有 3 列构成主键。

我不明白这一点。

您是在谈论“自然键”，例如“姓名和出生日期”吗？如果存在自然键可能是理想的，但自然键的大多数候选者不是唯一的（几个同名的人）或不是恒定的（有人可以更改他们的名字）。

> Int/ BigInt 哪个自动增量是足够好的主键。

我更喜欢吉德。自动增量的一个潜在问题是值（例如“订单 ID”）由数据库实例（例如“销售数据库”）分配......如果您需要合并由多个数据库实例创建的数据（例如，来自多个销售办事处的数据，每个销售办事处都有自己的数据库）。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-01T01:03:38.063

RE GUID

注意这是否会成为一个非常非常非常非常**大**的数据库、大量负载和快速访问。

在我的上一份工作中，我们拥有 100 到 5 亿条记录的数据库，我们的数据库人员强烈反对 GUID，并要求使用适当大小的十进制数。他们认为（在 Oracle 下）字符串 Guid 与十进制值的内部存储大小差异会在查找中产生非常明显的差异。（更大的键=要遍历的更深的树）

GUID 的随机性也显着降低了索引页的填充因子——这极大地增加了撕裂和磁盘 I/O。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-31T21:16:34.777

这是一个经典的“它取决于”。每个项目都没有一个正确的答案。对于不同的情况，我喜欢不同的东西。这取决于我是否使用 ORM 以及它支持什么。它取决于整体架构（分布式与否等）。只需选择一个您认为可行的选项，然后继续争论制表符和空格即可。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-12-31T21:22:22.253

我倾向于使用选项 #1 或 #3，具体取决于大小、连接的人数以及是否是多数据库服务器的情况。

选项＃2对我来说没有多大意义。如果这三个中的任何一个不足以识别唯一记录，那么有可能（无需经过额外的阴谋）两个记录在所有三列中显示具有相同值的两个记录。如果您想对这三者的任何组合强制唯一性，那么只需为它们添加一个索引。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-12-31T22:29:17.390

自动增加列。我能够使我的代码与 SQL Server 或 Oracle 无缝协作，一个使用身份，另一个通过我的 DAL 使用序列，我非常高兴。我同意，如果您要进行复制或发送数据以便稍后在处理后接收它，则有时需要 GUID。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-01-01T21:18:26.363

我一直使用代理键 - 一个称为“id”的自动递增整数。即使另一个选项很明显，我也可以看到很多这样做的理由：

*   一致性
*   数据独立（唯一，不会因格式更改而破坏）
*   人类可读

...而且没有合理的理由不：

*   连接中的歧义？- 别名表是一种更好的做法，恕我直言
*   最佳表？- 每个条目删除一个字节是过早的优化，恕我直言
*   每桌决定？- 不再一致
*   缩放问题？- 嗯？为什么？
*   分层数据结构？- 这是非规范化，完全是另一个宗教主题。我只想说我在理论上在某些情况下是粉丝，但在实践中从来没有:)

我还没有想到或遇到的合理理由总是受到欢迎......

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-31T21:27:02.710

Guids.时期。

如果您需要扩展或需要通过其他方式分配主键，它们将成为您的朋友。您可以为其他所有内容添加索引。

* * *

更新以澄清我的陈述。

我在很多不同类型的网站上工作过。从小型单服务器交易到支持多个数据库和 Web 服务器的大型交易。肯定有一些应用程序可以使用自动递增整数作为主键。但是，这些不符合我做事的模式。

使用 GUID 时，您可以在任何地方生成 ID。它可以由远程服务器、您的 Web 应用程序、数据库本身甚至在多主机情况下的多个数据库中生成。

另一方面，自动递增的 INT 只能在主数据库中安全地生成。同样，如果您的应用程序将与该支持数据库服务器密切相关，并且您不关心横向扩展 ，这*可能没问题。*

当然，使用 GUID 意味着您必须每晚进行重新索引过程。但是，如果您使用的不是自动递增的 INT，则无论如何都应该这样做。哎呀，即使以 INT 作为主索引，您也可能有其他索引需要重新生成以处理碎片。因此，使用 GUID 并不会完全增加另一个问题，因为无论如何都需要执行这些任务。

如果您查看较大的应用程序，您会注意到一些重要的事情：它们都使用 Base64 编码的 GUID 作为键。原因很简单，GUID 的使用使您能够轻松地*进行*横向扩展，而在尝试横向扩展 INT 时可能会遇到很多麻烦。

我们最新的应用程序经历了持续大约一个月的大量插入。在那之后，90% 以上的查询都是报告的选择。为了增加容量，我可以在这个大插入期间启动额外的数据库服务器；然后轻松地将它们合并到一个数据库中进行报告。试图用 INT 做到这一点绝对是一场噩梦。

坦率地说，任何时候你集群一个数据库或设置复制，数据库服务器都会要求你在表上有 GUID。因此，如果您认为您的系统可能需要增长，请选择一个好的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-31T21:32:28.457

我只使用自动增量 int 或 GUID。99% 的时间我都使用自动增量 int。当我第一次了解数据库并且从未遇到不使用它们的理由时，这正是我被教导要使用的东西（尽管我知道 GUID 会更好的原因）。

我喜欢自动增量整数，因为它有助于提高可读性。例如，我可以说“看看记录 129383”，并且很容易有人进去找到它。使用几乎不可能做到的 GUID。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-31T21:45:01.787

除了一个基本的定义性答案，什么才是*好的*主键主要留给宗教和休息室争论。如果您有一些东西是并且将始终唯一地映射到单个行，那么它将作为主键正常工作。在此之后，还有其他考虑因素：

*   主键定义是不是太复杂了？为了遵循“最佳实践”，它是否避免引入不必要的复杂性？
*   是否有更好的主键可能需要更少的数据库处理开销（即 INTEGER 与 VARCHAR 等）？
*   我是否绝对确定我的主键的唯一性和定义性不变量不会改变？

最后一个可能是吸引大多数人使用 GUID 或自增整数列之类的东西的原因，因为依赖于地址、电话号码、名字/姓氏等内容，只是不要削减它。我能想到的唯一不变的人是 SSN，但我什至不能 100% 确定那些永远独一无二的人。

希望这有助于增加一些清晰度......

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-12-31T21:49:33.570

我处理主键的方式（我觉得是最好的）是避免采用“默认”方式。这意味着，与其只是在一个自动递增的整数上打一个耳光并称它为一天，我会查看问题并说“是否有一个列或一组列将永远是 unqiue 并且不会改变？” 如果答案是肯定的，那么我采取这种方法。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-12-31T21:57:10.640

几乎总是整数。

除了处理更小/更快之外，它们还有其他充分的理由。您更愿意写下哪个 - “404040”或“3463b5a2-a02b-4fd4-aa0f-1d3c0450026c”？

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-12-31T23:56:54.687

只是有点相关，但是当我有小型分类表（主要是那些在代码中表示 ENUM 的表）时，我最近开始做的一件事是我将主键设为 char(3) 或 char(4)。然后我让这些主键代表查找值。

例如，我有一个内部销售代理的报价系统。我们有“成本类别”，每个报价行项目都分配有一个......所以我有一个名为“tCostCategories”的类型查找表，其中主键是“MTL”、“SVC”、“TRV”、“TAX”， 'ODC'。查找表中的其他列存储更多详细信息，例如代码的正常英文含义、“材料”、“服务”、“旅行”、“税收”、“其他直接成本”等。

这非常好，因为它不使用比 int 更多的空间，而且当您查看源数据时，您无需链接查找表即可知道值到底是什么。例如，报价行可能如下所示：

1 零件编号 40 美元 MTL
2 其他零件编号 29.99 美元 SVC
3 零件编号2 150 美元 TRV

使用 int 表示类别然后在所有行上链接 1、2、3 会容易得多 - 您的数据就在您面前，而且性能似乎根本没有受到影响（不是我已经真正测试过了。）

就真正的问题而言……我喜欢 RowGUID 唯一标识符。我不是 100% 的，但不是所有行都有内部 RowGuid 吗？如果是这样，那么使用 RowGuid 实际上会比整数（或其他任何东西）占用更少的空间。我所知道的是，如果它足以让 M$ 在 GreatPlains 中使用，那么它对我来说就足够好了。（我应该躲避吗？？）

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-01-01T00:00:00.733

哦，我使用 GUID 的另一个原因 - 我使用分层数据结构。也就是说，我有一个主键匹配的表“公司”和一个表“供应商”。但我也有一个表“制造商”，它也从公司“继承”。供应商和制造商共有的字段不会出现在这些表中 - 它们出现在公司中。在这种设置中，使用 int 比使用 Guid 更痛苦。至少，您不能使用身份主键。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2009-01-06T12:03:03.240

我喜欢自然键，只要我可以信任它们。为了使用对主题专家有意义的密钥，我愿意支付少量的性能价格。

对于描述实体的表，应该有一个简单的自然键来标识单个实例，其方式与主题人员所做的相同。如果主题没有实体之一的可靠标识符，那么我将求助于代理键。

对于描述关系的表，我使用复合键，其中每个组件引用一个参与关系的实体，因此是实体表中的一行。同样，使用复合键对性能的影响通常很小。

正如其他人指出的那样，“主键”一词有点误导。在关系数据模型中，使用的术语是“候选键”。一个表可能有多个候选键。从逻辑上讲，每一个都和另一个一样好。选择其中一个作为“主要”并通过该键进行所有引用只是设计师可以做出的选择。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-12-31T21:27:06.317

无论您是否意识到，这都是一个复杂的主题。可能属于此 StackOverflow 常见问题解答部分。

我不应该在这里问什么样的问题？

避免提出主观的、争论的或需要扩展讨论的问题。这是一个可以回答问题的地方！

这已经争论了多年，并将继续争论多年。我看到的唯一共识提示是，答案在某种程度上是可预测的，具体取决于您是否询问 OO 人（GUID 是唯一的方法！），数据建模者（自然键是唯一的方法！），或面向性能的 DBA（INT 是唯一的出路！）。

# javascript - IE designMode Showing display:none Divs

> ID：404043
> 
> 赞同：2
> 
> 时间：2008-12-31T21:15:21.690
> 
> 标签：javascript, jquery, internet-explorer, tinymce, designmode

我对此做了很多研究，但我无法解决这个问题。我有一个 Div，里面有几个 Div，我想在打开 TinyMCE 实例之前隐藏它们。

我正在通过 jQuery 执行此操作 -

```
$(".drop").hide() 
```

这很好用，除了 Trident (IE) 之外的每个浏览器引擎都隐藏了它们。如果我检查 IE 中的元素，则 css 指示“显示：无”。

我发现了一些关于这是 IE 的一项功能如何显示这些元素的文章和注释，包括 MSDN 上的这篇文章：http: [//msdn.microsoft.com/en-us/library/aa770023 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa770023(VS.85).aspx)

问题是我需要隐藏这些。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-18T15:21:26.430

这是因为在可编辑元素内部，IE 使所有内容，包括使用 display: none 隐藏的元素，可编辑。除了从页面的 DOM 中删除要隐藏的元素之外，您无能为力。

此处引用了 IE 的这种行为：http: [//msdn.microsoft.com/en-us/library/aa770023%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/aa770023%28VS.85%29.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T22:54:01.273

您可以尝试应用一种将显示设置为非无的样式，例如：

```
.drop
{
    display: block; // or inline
} 
```

这听起来像是由于 IE 需要元素“具有布局”以便对其进行某些操作，隐藏是其中之一。给定显示类型的元素应该有布局，也就是说，它占用空间并迫使浏览器重新组织它周围的兄弟元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T23:11:51.527

据我所知，tinyMCE 使用 iframe 进行编辑并在 iframe 内启用编辑模式，因此如果您在加载 tinyMCE 之前处于编辑模式，您确定必须将外部文档置于编辑模式。

澄清一下，您是想影响 iframe 的内部还是 tinyMCE 正在加载包含 display: none 的内容

从表面上看，如果您将带有 display: none 的内容加载到 tinyMCE 中，您可能需要做一些混乱的解决方法，即在加载时删除节点并在保存时尝试将它们重新插入到相同的位置。

我能看到的唯一好处是，如果在其他浏览器中，您只需选择节点两侧的文本，就会在不知不觉中删除隐藏节点。

# delphi - 在delphi中添加多个函数调用？

> ID：404060
> 
> 赞同：6
> 
> 时间：2008-12-31T21:22:56.323
> 
> 标签：delphi

```
 case i of
         0..99  :   Function-call('bobo') ;
         100..209 : function-smell('Hobo');
         210..300 : function-yikes('argh');
       end; 
```

但是如果我想让 210..300 同时调用函数 yikes 和函数气味呢？不知道怎么感谢。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-31T21:27:09.200

只需添加一个开始结束块：

```
case i of
  0..99    : function-call('bobo') ;
  100..209 : function-smell('Hobo');
  210..300 : begin
    function-yikes('argh');
    function-smell('Hobo');
  end;
end; 
```

# javascript - 为什么这个 E4X 代码不尊重默认命名空间？

> ID：404065
> 
> 赞同：1
> 
> 时间：2008-12-31T21:25:57.673
> 
> 标签：javascript, firefox, e4x

我正在研究 Firefox 扩展，试图使用 E4X。但是，我遇到了一个奇怪的问题：

```
var myXml = <test xmlns="http://test.com">
     Hey
     <inner>
        Guys
      </inner>
   </test>;

var ns = myXml.namespace();

default xml namespace = ns;

this.log(myXml.*::inner);
this.log(myXml.ns::inner);
this.log(myXml.inner); 
```

前两个日志语句打印“Guys”。第三个是空白。这是怎么回事？我已经指定了默认命名空间，它实际上与我在第二个日志语句中使用的完全一样。为什么这不起作用？

[Mozilla 的文档表明这应该可行。](https://developer.mozilla.org/en/E4X_Tutorial/Namespaces)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T10:54:03.643

在 Firefox 3 中，您的代码按预期运行。也许您遇到了在旧版 Gecko 中发现的错误？

# javascript - 交换 Internet Explorer 中的选项框？

> ID：404073
> 
> 赞同：1
> 
> 时间：2008-12-31T21:30:59.240
> 
> 标签：javascript, internet-explorer

我的客户要求我（一名 JavaScript 客户端程序员）更改选项的顺序，以便在页面加载时他们公司的选项出现在选择框的顶部。

以下代码在 Firefox 中有效，但在我尝试交换两个选项时在 Internet Explorer 7 中失败：

```
 function load{
        var shippingLocation  = document.getElementById("location");
        var swap = null;

        var initiallyFirstItem = shippingLocation.options[0].cloneNode(true);

        var lastPos = null;

        for(var i = 0; i < shippingLocation.length; i++)
        {
            if(shippingLocation.options[i].value == "XETEX")
            {
                swap = shippingLocation.options[i];
                lastPos = i;
                break;
            }
        }
        console.debug("sl: " + shippingLocation.options[0]);
        console.debug("s: " + swap);
        shippingLocation.options[0] = swap;
        shippingLocation.options[lastPos] = initiallyFirstItem;
        shippingLocation.selectedIndex = 0;
    } 
```

我在底部第三行的旁边收到一个错误：

```
shippingLocation.options[0] = swap; 
```

错误指出“对象不支持此属性或方法”。

Internet Explorer 在切换选项项目方面的优势是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T22:20:31.730

啊，我们走了。比上面的代码优雅得多。

```
function swapOptions(obj,i,j){
    var o = obj.options;
    var i_selected = o[i].selected;
    var j_selected = o[j].selected;
    var temp = new Option(o[i].text, o[i].value, o[i].defaultSelected, o[i].selected);
        var temp2= new Option(o[j].text, o[j].value, o[j].defaultSelected, o[j].selected);
    o[i] = temp2;o[j] = temp;o[i].selected = j_selected;o[j].selected = i_selected;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T22:37:18.357

好吧，我做了一些测试，我相信 IE 认为选项数组是不可变的（在某种程度上）。您可以编辑选项并删除它们，但不能将一个选项设置为另一个选项。

所以当你这样做时：

```
 shippingLocation.options[0] = swap; 
```

IE 抱怨是因为您试图将一个选项设置为另一个选项。

我会这样做：

```
> Removed due to excessive stupidity on
> my part. :P 
```

这是一个更好的方法：

```
<script type="text/javascript">
function swap(obj,i,j) {
    sib=obj.options[i].nextSibling;
    obj.insertBefore(obj.options[i],obj.options[j]);
    obj.insertBefore(obj.options[j],sib);
}
</script> 
```

# database - ORM 还是“计算机科学的越南”吗？

> ID：404083
> 
> 赞同：30
> 
> 时间：2008-12-31T21:37:04.547
> 
> 标签：database, language-agnostic, orm

我昨晚读[了这篇文章](http://www.codinghorror.com/blog/archives/000621.html)，我注意到它是从 2006 年开始的。我可以在 ORM 和数据库方面采取任何一种方式，但我只是想知道 Jeff 所说的关于 ORM 的所有坏话是否仍然适用，即使现在考虑到这篇文章是从 2006 年开始的。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-12-31T22:16:07.200

这仍然是真的。

与 OO 软件相比，如果没有按照预期的方式精确处理数据库，数据库也会受到影响。并且不打算在它前面插入一些抽象层。

我认为不透水的抽象层就像试图建造一个乐高城堡，所有的部件都被封闭在一个枕套中。SQL 很难正确执行。它与过程式编程没有很多相同的模式，一个最佳实践可能与另一个相反。您需要能够理解 SQL 语句中的每一个项目，并且非常清楚它的目的是什么，以及它实际上做了什么。

很多人似乎认为，就像马蹄铁一样，接近就足够了——如果弹出正确的答案，这意味着你就快到了。在 SQL 中，这根本不是真的。

由于这个原因，RoR 和 ActiveRecord 模式当之无愧地赢得了 dbms 资源占用者的美誉。优化的 ActiveRecord 设计往往不是次优的 SQL 设计，因为它鼓励 SQL 语句分解。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-31T22:38:35.610

是的。

面向对象仍然是*面向对象的*，关系仍然是*面向集合的*。在过去的两年中，这两种范式没有发生任何变化，以使它们更好地协同工作。

在很多人眼中，SQL 是丑陋的、复杂的、令人困惑的。但是试图创建一个面向对象的接口来执行相同的功能总是更丑陋、更复杂，并且学习曲线更陡峭。

**在所有编程中，都需要在灵活性**和**假设**之间进行权衡。框架（例如 Rails）试图通过“固执己见”来解决问题。也就是说，它们限制了问题的关系或面向对象方面的灵活性，对数据的结构方式以及您可以对其进行哪些操作进行假设。自然，简化问题空间也会使解决方案更简单。

此外，令人沮丧的是，发现一个 ORM 框架是不完整的，因此 SQL 中的一些普通操作在给定的 ORM 中没有解决方案。这也是“自以为是”框架的结果。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-17T09:40:31.797

许多 web 2.0 公司都在致力于键值存储。所有这些公司都必须经历同样痛苦的过程才能使其发挥作用。

如果 ORM 是“计算机科学的越南”，那么构建自己的键值存储可能就是“计算机科学的伊拉克”:-)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-31T22:24:34.843

我只能说说我的经历。我使用 DAL 和 DTO，我仍然能够执行非常复杂的查询（连接和所有），并且我可以在需要时使用 SP 或自定义 SQL。它让我的生活更轻松，我的代码更一致，我的最后期限更容易实现。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-31T22:40:08.367

我认为从 Jeff 的结论正确的假设出发并不一定是好的；在维护了存储过程代码以及基于 JDBC 的数据层之后，我可以说这些导致了大量的维护问题，主要与无法理解更高级别发生的事情有关。

数据库必然是低级的；它本质上存储数字和字符串。业务逻辑是高级别的。这就是我们有抽象的原因。

就个人而言，我认为 Rails/ActiveRecord 方式是拥有对象/域模型但也能够利用关系数据库的最佳解决方案。

所以：不要抛弃 ORM，但也不要默认使用它。它是解决某些问题的工具。忽视它是无知的，总是使用它是傲慢的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-04-04T11:35:06.520

Jeffs 文章链接到**Ted Newards 文章**。如果您了解详细信息，那么您需要查看那里：

1.  原创 - [http://blogs.tedneward.com/post/the-vietnam-of-computer-science/](http://blogs.tedneward.com/post/the-vietnam-of-computer-science/)

2.  跟进 - [http://blogs.tedneward.com/post/thoughts-on-vietnam-commentary/](http://blogs.tedneward.com/post/thoughts-on-vietnam-commentary/)

**在 Ted 的原始观点中，我将其描述为：**

*   1 错误（身份）
*   其中 2 个已解决（部分对象和 N + 1）
*   2 是有争议的（双模式/共享模式）。

免责声明：我是 Ebean ORM 的作者，所以我将参考它来解决所提出问题的各种“解决方案”。

Ted的原点（因为实在是罗嗦所以提炼出来）：

**1\. 部分对象问题。**

总是可以解决的。Ebean ORM 使部分对象成为其查询语言和所有内部结构的基础。不幸的是，JPQL 并没有将其作为优先事项，这更是一个问题。

*   参考：[http ://ebean-orm.github.io/docs/query/partialobjects](http://ebean-orm.github.io/docs/query/partialobjects)

**2\. N + 1（Ted 的加载时间悖论）**

总是可以解决的。应该写成，`1 + N / batchSize`但比这更有趣（每个路径，需要考虑 SQL 分页，避免 sql 笛卡尔积）。不幸的是，一些 ORM 把这件事弄得一团糟，这通常会使 ORM 声名狼藉。某些 ORM 是可以的，直到您达到一定程度的复杂性（例如 OneToMany 中的 OneToMany 中的 OneToMany）。

*   参考：[http ://ebean-orm.github.io/docs/query/nplus1](http://ebean-orm.github.io/docs/query/nplus1)

只是为了提高赌注，ORM 可以分析对象图的使用并**自动优化查询**（只获取需要的内容，定义获取路径以优化 N + 1 等）。

*   参考：[http ://ebean-orm.github.io/docs/query/autotune](http://ebean-orm.github.io/docs/query/autotune)

这种自动 ORM 查询优化的想法来自德克萨斯大学（使用 Hibernate）。它在 2008 年作为 Ebean ORM 的一部分被包含在内，所以它已经存在了一段时间。

*   参考：[https ://en.wikipedia.org/wiki/AutoFetch](https://en.wikipedia.org/wiki/AutoFetch)

**3\. 身份**

Ted 谈到身份和并发性不匹配的问题。这一点是错误的，因为 ORM（好吧，我所知道的所有）以与先前的客户端/服务器工具**完全相同**的方式处理这方面的问题，特别是 ORM 正在为应用程序提供部分数据库的**快照视图。**这里从来没有问题，但是 ORM 实现可能会因过度依赖 hashCode()/equals() 而陷入冲突。

**4\. 双模式问题**

这是值得商榷的。如果组织允许，那么 ORM 可以为模式提供 DIFF/SQL 脚本，并由 FlywayDB/Liquibase 等运行。如果组织不允许，这在某种程度上可能仍然是一个问题。

**5\. 数据库重构/共享模式**

这是值得商榷的。DB 设计/规范化人员会争辩说，DB 设计应该达到 4NF，这意味着任何重构都应该只是附加的（非规范化、添加列/表）而不是破坏性更改。不相信规范化的人会因为担心共享模式而发疯。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-31T21:42:34.007

我认为确实如此。

我认为最后一句话是最有趣的：“我倾向于站在数据库模型阵营的一边，因为我认为对象被高估了。” Java、C++ 和 C# 无疑是主要的语言，但函数式编程正在与 F#、Scala 等一起卷土重来。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T22:10:00.067

这不是我的专业领域，但我在 Rails 工作了大约一年，我认为 ActiveRecord 解决了大部分 DB 映射问题。我意识到它有一些问题，但我认为它做得很棒。

我认为他的帖子没有考虑到框架本身（在本例中为 AcitveRecord/Rails）定义数据库和对象模型的可能性，据我所知，这使问题消失了。

由于这与前两个回复相反（基本上该帖子已过时），我觉得我可能不理解某些东西；如果是这种情况，请纠正我，而不是仅仅投票给我，因为我认为我遗漏了一个重要的观点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-05-22T17:23:55.150

恕我直言，像 Scala 的[Slick](http://slick.lightbend.com/)和[Quill](https://github.com/getquill/quill)这样的 Monadic 方法在很大程度上绕过了上述泥潭，为 Ted 的许多问题提供了更强大的解决方案（JOOQ 也值得一提）。虽然它们并不完美，但它们肯定会解决 N+1 和 Partial Object 问题，主要解决 Identity 问题，部分解决 Dual Schema 问题。忘记笨拙和冗长的 CriteriaBuilder 查询*（任何人都读过“名词王国中的执行？？？”）*，Scala 的单子 for-comprehensions 为您提供了一个简单的 DSL，可以在其中编写标准查询：

```
case class Person(id: Int, name: String, age: Int)
case class Contact(personId: Int, phone: String)

val query = for {
    p <- query[Person] if(p.id == 999)
    c <- query[Contact] if(c.personId == p.id)
  } yield {
    (p.name, c.phone)
  } 
```

这种语法保持理智，即使对于更复杂的查询，例如 Ted 的 is-acceptable-spouse 查询：

```
case class Person(name:String, spouse:Option[PersonId]) {
    isThisAnAccpetableSpouse(person:Person) {...}
}

val query = for {
    p1 <- people
    p2 <- people if (
        p1.spouse.isEmpty && p2.spouse.isEmpty 
        && p1.isThisAnAccpetableSpouse(p2)
        && p1.isThisAnAccpetableSpouse(p1))
} yield (p1, p2) 
```

所有这些都被编译成一个 SELECT 查询并针对数据库运行。插入、更新和删除是类似的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-01T23:19:02.650

披露：我是[RDO.Net](https://rdo.devzest.com)的作者。

是的。我相信现有的 ORM 正朝着错误的方向发展——他们试图将关系数据映射到任意对象中，恕我直言，这是不可能的。在 OO 世界中，任意对象不是序列化/反序列化友好的，因为每个对象都有一个当前进程本地的对象引用（地址）。当你处理单个对象时没关系，当你面对一个复杂的对象图时你会遇到麻烦。

希望这个问题可以使用不同的方法来解决，就像在[RDO.Net](https://rdo.devzest.com)中一样：我们不是将关系数据映射到任意对象，而是将数据的模式映射为丰富的元数据（`Model`包含列、主键/外键、验证等）。 )，并公开具体`Db`的 、和 ，`DbTable`用于数据访问。执行数据库 CRUD 操作时，您可以使用强类型 OO 语言显式构建 SQL 抽象语法树 (AST)，如以下示例 C# 代码所示，该代码创建查询并返回分层数据的 DataSet：`DbQuery``DataSet`

```
public async Task<DataSet<SalesOrderInfo>> GetSalesOrderInfoAsync(_Int32 salesOrderID, CancellationToken ct = default(CancellationToken))
{
    var result = CreateQuery((DbQueryBuilder builder, SalesOrderInfo _) =>
    {
        builder.From(SalesOrderHeader, out var o)
            .LeftJoin(Customer, o.FK_Customer, out var c)
            .LeftJoin(Address, o.FK_ShipToAddress, out var shipTo)
            .LeftJoin(Address, o.FK_BillToAddress, out var billTo)
            .AutoSelect()
            .AutoSelect(c, _.Customer)
            .AutoSelect(shipTo, _.ShipToAddress)
            .AutoSelect(billTo, _.BillToAddress)
            .Where(o.SalesOrderID == salesOrderID);
    });

    await result.CreateChildAsync(_ => _.SalesOrderDetails, (DbQueryBuilder builder, SalesOrderInfoDetail _) =>
    {
        builder.From(SalesOrderDetail, out var d)
            .LeftJoin(Product, d.FK_Product, out var p)
            .AutoSelect()
            .AutoSelect(p, _.Product)
            .OrderBy(d.SalesOrderDetailID);
    }, ct);

    return await result.ToDataSetAsync(ct);
} 
```

# c# - MouseMove 事件太慢，无法绘画

> ID：404094
> 
> 赞同：5
> 
> 时间：2008-12-31T21:41:37.223
> 
> 标签：c#, .net, winforms, xna

我正在使用 C# WinForms 为我的 XNA 游戏创建关卡构建器。我有一个可以使用铅笔工具绘制的平铺网格，就像在 MSPaint 中一样。问题是，当您快速（ish）拖动鼠标来绘制线条时，瓷砖会被跳过。

我尝试使用我在 Google 上看到的一种方法来生成一个线程来进行绘画，但这似乎没有帮助。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T21:57:04.740

OTTOMH，您可以跟踪鼠标的最后一点，并且在 MouseMove 处理程序中，您可以假设线性运动并确定最后一点和当前点之间的所有图块。我的猜测是，您不太可能触发足够的 MouseMove 事件来处理用户快速移动鼠标的情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T23:19:52.733

惊人的！完美地工作。

我从这里使用了 DDA 线算法

[http://www.cs.unc.edu/~mcmillan/comp136/Lecture6/Lines.html](http://www.cs.unc.edu/~mcmillan/comp136/Lecture6/Lines.html)

画线。

谢谢！！

# windows - 在 Windows 上的软件中关闭 USB 设备

> ID：404097
> 
> 赞同：31
> 
> 时间：2008-12-31T21:42:35.160
> 
> 标签：windows, winapi, embedded, usb, microcontroller

我想通过 Windows 上的软件重新启动 USB 设备。

我正在开发一个小型 USB 电源微控制器。该芯片将在电源循环时恢复为本机行为并允许下载代码。由于我的代码会在出现问题时使设备崩溃——使其忽略所有 USB 命令——我必须从系统中物理拔出设备。

我想远程进行开发，而不必亲自到场。

到目前为止，我已经尝试使用“devcon”来禁用部分 USB 堆栈。虽然这会将集线器带入 D3（应该关闭电源！），但仍然为设备供电。

是否有任何预先存在的解决方案或 SetupAPI 技巧可能会有所帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-02-06T16:05:56.137

一些 USB 集线器能够关闭其下游设备的电源。

“是否可以从 Ubuntu 为 USB 集线器上的端口供电？” [https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu](https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu) 指向 hub-ctrl.c 的一些 c 源

见：[http ://www.gniibe.org/development/ac-power-control-by-USB-hub/index](http://www.gniibe.org/development/ac-power-control-by-USB-hub/index)

我在 Ubuntu 上使用 Dream-Cheeky USB LED 单元对此进行了测试，它似乎确实关闭了电源 - 尽管再次打开时，设备已经记住（！）它的 LED 开/关状态？？？- 当我拔下 USB 线并将其重新插入 LED 时，没有发生这种情况......

看起来有人看过为 Windows 编译这个，但我找不到结果，抱歉。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-31T23:02:00.600

Since it's for development/test instead of production, I'd recommend having a [solid-state_relay](https://en.wikipedia.org/wiki/Solid-state_relay) as part of a second device and using that to cycle the power on the USB connection.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-19T01:57:18.247

您可以使用硬件继电器并通过软件控制它：http: [//pintant.cat/2012/05/12/power-off-usb-device/](http://pintant.cat/2012/05/12/power-off-usb-device/)（当然，将使用 2 个 USB 端口 :-) 一个用于设备，一个用于继电器）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-06-24T20:31:03.247

如果您购买此外[部 USB 集线器](https://amzn.com/B00007AKAZ)，则在 Windows 上有一个简单的解决方案。它有一个未记录的功能，只要在 Windows 设备管理器中“启用”集线器，就会为所有连接的 USB 设备循环供电。您可以手动执行此操作：

1.  运行“设备管理器”
2.  展开“通用串行总线控制器”
3.  打开相应“通用 USB 集线器”的属性
4.  选择“驱动程序”选项卡
5.  单击“禁用”按钮
6.  单击“启用”按钮。集线器将暂时禁用其所有 4 个 USB 端口的电源输出，然后再次启用。

您还可以通过任何以管理员权限运行的 Windows 应用程序以编程方式执行此操作。这是[C# 中的一个示例](https://github.com/idmadj/handsoff/blob/master/DisableHardware.cs)。

我已经成功地使用这种技术为“锁定”的 USB 设备循环供电。它肯定胜过物理拔出设备，尤其是在远程或无人 PC 上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T22:42:55.867

Unfortunately, it's not possible on stock PCs.

USB host chipsets do not have the capability to fully power-down. There is some signaling that you can do in USB 2.0 or 3.0 to ask the device to go into a sleep-state, but the port will provide power even when the PC is turned off. (That's so devices like iPods and whatnot can still charge if needed.)

# xml - 为什么 XML 1.0 中的“控制”字符是非法的？

> ID：404107
> 
> 赞同：65
> 
> 时间：2008-12-31T21:48:44.697
> 
> 标签：xml, unicode, history

有多种字符在 XML 1.0 中是不可合法编码的，例如`U+0007`('bell') 和`U+001B`('escape')。大多数有趣的是非空白“控制”字符。

从（例如）[这个问题](https://stackoverflow.com/questions/209193/special-characters-in-xml)和其他问题中可以清楚地看出，问题在于[XML 规范](http://www.sklar.com/blog/archives/96-XML-vs.-Control-Characters.html)——但是任何人都可以告诉我*为什么*XML 规范禁止这些字符吗？

似乎可能需要将它们编码为转义符，例如 as`&#x0007;`和`&#x001B;`分别，但也许有一个实际原因是字符被禁止而不是被要求转义？

回答者建议避免传输控制字符有一些动机，但 Unicode 包含许多*其他*类似控制的字符（考虑`U+200C`“零宽度非连接符”）。我承认这种行为可能没有充分的理由，但我仍然想更好地理解它。

这尤其令人沮丧，因为当这些字符值出现在其他~~编码~~数据格式中时，我最终会“双重转义”需要对其进行编码的新 XML 文档。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-31T22:42:46.663

我的理解是，这个范围是被禁止的，因为标记语言不需要支持传输和流控制字符，包括它们会给二进制转换中的任何编辑器和解析器带来问题。

不过，我正在努力从 Tim Bray 等人那里找到任何关于这方面的东西。

编辑：对控制字符的[一些](http://lists.xml.org/archives/xml-dev/199804/msg00502.html) [讨论](http://lists.xml.org/archives/xml-dev/200006/msg00360.html)和模糊的承认它并没有完全过度设计：

> 在 17/06/00 -0500 上午 09:27，Mark Volkmann 写道：
> 
> > 我从未见过关于为什么大多数 ASCII 控制字符（例如换页）在 XML 文档中不允许出现的讨论。谁能告诉我该决定背后的原因或指出我的规格。这就解释了？
> 
> 如果我们再做一次，我不确定我们是否会这样做。我没有看到他们造成任何真正的伤害。显然，如果您正在优化一种高度可互操作的*内容*标记语言（XML 是），那么怀疑诸如垂直制表符和退格等之类的东西是合理的......但是如何保持一致呢\n和DEL等？-蒂姆

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-02T13:55:17.637

> 似乎可能需要将它们编码为转义符，例如 和

您可以在 XML 1.1 中完全做到这一点，除了 \0。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-02T16:52:00.817

那是很久以前的事了，但我最好的回忆是它们没有图形表示，也没有商定的语义。随机选择一对，我们看到 U+0006 “确认”或 U+0016 “同步空闲”......这是什么意思？Unicode 没有说。即使在每个人都声称支持 ASCII 的时候，围绕这个垃圾也没有互操作性。XML 应该是关于互操作性的。

经验是，想要使用这些东西的人真的想将二进制数据塞进他们的 XML 元素中（他们想要的下一件事是包含 U+0000 NULL），这一直是 XML 的明确非目标1\. 如果你想表示数字 0x6 或 0x16，有很多很好的方法可以做到这一点，不会混淆“字符”的概念。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2015-04-23T15:31:27.683

可能是时候重新总结一下了，同样是对 XML 1.1 的看法。

**Unicode 中有哪些控制字符代码点？**

*   `U+0000`to `U+001f`，继承自 ASCII。
*   `U+007F`, 继承自 ASCII
*   `U+0080`to `U+009F`, 继承自 Latin-1
*   各种特殊用途的范围，针对 Unicode 显式标准化，并且在非标记上下文中尤其有用。[此处逐块讨论](http://www.w3.org/TR/unicode-xml)它们，包括在 XML 中使用它们或不使用它们的原因和方法，以及如果遇到它们该怎么办。

**XML 如何看待这些控制字符？**

这是一个不同的分类。

*   制表符和换行符（无论换行符的平台依赖性如何）都很好。每个人都使用它们。每个人都知道他们应该代表什么。允许以几乎所有已知的形式出现，甚至通常用于标记本身的漂亮打印。
*   `U+0000`是邪恶的。空字符？字符串终止符？二进制噪声？互操作性和标记的对立面。禁止一切形式。
*   还要别的吗？很少使用，有问题的互操作性，但即使不知道它们应该“控制”什么，也有办法容忍它们。

现在让我们将注意力转移到最后一个类别，控制代码正确。也就是说，以下摘要不适用于制表符和换行符：`U+0009`, `U+000a`, `U+000D`, `U+0085`, `U+2028`。

XML 1.0 允许所有上述范围的控制字符，除了`U+0000`、`U+001f`作为文本（直接包含的字符）和作为[数字字符引用](http://en.wikipedia.org/wiki/Numeric_character_reference)。允许显然`U+007F`是遗漏的，这种不一致在 XML 1.1 中得到了纠正，但反过来[。](http://lists.xml.org/archives/xml-dev/200006/msg00622.html)他们甚至在标准中给出了详细的理由：`U+009F`

> 最后，对定义 XML 文档中任意 Unicode 字符的标准表示存在相当大的需求。因此，XML 1.1 允许使用对控制字符 #x1 到 #x1F 的字符引用，其中大部分在 XML 1.0 中是被禁止的。然而，出于鲁棒性的原因，这些字符仍然不能直接在文档中使用。为了提高字符编码检测的稳健性，在 XML 1.0 文档中自由允许的附加控制字符 #x7F 到 #x9F 现在也必须仅作为字符引用出现。（空白字符当然是例外的。）向后兼容性的微小牺牲被认为是不重要的。由于 API 的潜在问题，#x0 仍然被禁止直接和作为字符引用。

**为什么 Unicode 和 XML 允许自由使用类似标记的控制字符，除了少数“继承”的范围？人们应该为那些使用标记。**

Unicode 也用于非标记上下文，它是一个仍在发展的字符集。如果非控制字符集是移动目标，那么实现符合标准的 XML 处理器就太难了。

**好的，那么与特定于 Unicode 的控制字符相比，继承的范围有什么问题？**

缺乏标准化。Unicode 联盟并没有真正选择将哪些数字分配给这些“字符”，或者它们的典型视觉呈现或含义是什么。与 ASCII（在编码的 UTF-8 级别）和 Latin-1（在代码点分配级别）的完全向后兼容性强制原始包含这些代码点，而不管在各种文本处理上下文中经常附加到它们的各种特殊和重载含义。

**等等，你是说 XML 并不意味着完全向后兼容 ASCII，不像 UTF-8？**

是的。这是正确的。您需要一个文档元素。你甚至不能放入一个 raw`<`或`&`. 那么为什么你需要输入原始控制字符呢？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-31T22:48:40.037

XML 是专门围绕 Unicode（特别是 UTF-8 和 UTF-16）和 ISO/IEC 10646 设计的，这两者（我对 ISO 10646*不太*肯定）都包含从 ASCII 和基于字符的终端时代。虽然这些字符仍有用处，但它们不属于 XML 之类的格式。

至于这些将这些代码用于其他用途的新编码，似乎 XML 规范可能需要适应。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-09T14:53:50.533

你为什么要双重逃避它们？这似乎是 &bell; 的好地方。和 &escape;。（未定义，由解析器的回调处理到您的代码）

# google-chrome - OpenSearch OSDD 文档在哪里？

> ID：404109
> 
> 赞同：8
> 
> 时间：2008-12-31T21:49:42.777
> 
> 标签：google-chrome, opensearch

有没有人知道我将这个 XML 文档命名为什么以及在我创建了它之后将它放在哪里？

我想在我的网站上提供一个 OSDD（OpenSearch 描述文档），以便 Google Chrome 会自动为其选择搜索功能。谷歌告诉我这就是[它的完成方式](http://www.google.com/chrome/intl/en/webmasters-faq.html#osdd)，但不是它应该托管的地方。[我在OpenSearch](http://www.opensearch.org/Documentation/Frequently_asked_questions)网站上也找不到任何关于最终位置的参考。我什至尝试在支持它的地方的来源周围寻找它是否是某种 META 标签，但无济于事。

**编辑**好吧，有一种明确的方法。现在我只需要看看是否有办法让它像在许多网站上那样自动发生（它们都没有任何类型的链接标签）：bugmenot.com、*.craigslist.org 和任何其他网站当他们右键单击 Chrome 地址栏并选择“编辑搜索引擎...”时可能会发现。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T21:57:27.067

它应该存储在您网站的根目录中。您只需在您的网页中添加一个指向它的链接，如下所示：

```
<link rel="search" type="application/opensearchdescription+xml" title="Stack Overflow" href="/opensearch.xml" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-23T13:31:52.197

描述符文档可以托管在几乎任何地方，只要它对客户端机器上的浏览器可用。

正如[Micah 指出的那样](http://#404128)，在您想要“宣传”您的搜索功能的网页中，只需在 HTML HEAD 中添加对 OSDD 的引用：

```
<html>
  <head>
    ...
    <link rel="search" type="application/opensearchdescription+xml" title="[display name]" href="[path to OSDD]" />
    ...
  </head>
  ... 
```

这样做是让浏览器突出显示搜索区域（例如，在 Firefox 中，蓝色发光，在 MSIE 中，按钮突出显示为橙色，在 Chrome 中，我相信浏览器只是添加搜索提供程序而不询问您）让最终用户知道该站点具有浏览器可以集成的搜索功能。

[你可以在这里http://customsearchprovider.appspot.com](http://customsearchprovider.appspot.com)创建你的 OSDD 文件（虽然它真的很简单）。

顺便说一句，BugMeNot.com、Craigslist 等不会自动将搜索提供程序添加到您的浏览器（在我访问过几次之后它还没有为我完成）。我怀疑它一定是手动添加的，或者可能是在您第一次安装 Chrome 时从其他浏览器导入的。

# java - 禁用点击点击

> ID：404118
> 
> 赞同：0
> 
> 时间：2008-12-31T21:54:15.293
> 
> 标签：java, windows, tablet

在 Tablet PC 上，用笔触摸屏幕被解释为单击。调整了灵敏度，即使你的笔滑了一点，它仍然被解释为点击；您必须移动一定距离才能成为拖放事件。

然而，在笔记本风格的应用程序中，您永远不想在区域内“单击”；唯一关心的事件是 mousedown 和 mouseup。

我发现我在 Windows 上的平板电脑驱动程序正在将 mousedown 和 mouseup 一起批处理，以获得比特定时间短的笔划；因此，我的应用程序只看到一次单击并绘制一个点，该点应该是一个短划线。

现在，我知道可以关闭它，因为这正是 Windows Journal 所做的。但是，我不知道我必须使用什么系统级调用/标志才能使其正常工作。如果有人能告诉我如何在 Java 中执行此操作会更好，但由于它是特定于平台的，我想我可能需要动态调用它。

**编辑：**我不再对这个问题的答案感兴趣，因为我现在在 linux 上使用 Xournal。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T03:43:34.417

在 Java 中，您应该能够处理鼠标按下、鼠标移动和鼠标释放事件，并完全忽略鼠标单击事件，以便能够对您想要的行为进行编程。这与更高级别的拖动事件无关，后者通常具有内置的容差，即鼠标在被拖动之前必须移动多远。

当然，这是我在触摸屏手持设备上使用 Java 的经验。

# java - 如何使用 Java StAX 格式化和读取 XML 处理指令？

> ID：404141
> 
> 赞同：2
> 
> 时间：2008-12-31T22:11:10.500
> 
> 标签：java, xml, stax

首先，我如何格式化XML处理指令，是不是：

```
<?processingInstructionName attribute="value" attribute2="value2"?> 
```

使用 StAX，然后我想通过处理`XMLStreamConstants.PROCESSING_INSTRUCTION`( [javadoc](http://java.sun.com/javase/6/docs/api/javax/xml/stream/XMLStreamConstants.html#PROCESSING_INSTRUCTION) ) 事件来读取它，但它只提供了两种方法来从以下位置检索有关处理指令的信息`XMLStreamReader`：

```
getPITarget()
getPIData() 
```

这两种方法的[javadoc](http://java.sun.com/javase/6/docs/api/javax/xml/stream/XMLStreamReader.html#getPIData())不是很有帮助。

1.  XML 格式是否正确？
2.  这是使用 StAX `XMLStreamReader` API 解析处理指令的正确方法吗？
3.  如何使用`getPITarget()`并`getPIData()`返回多个参数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T00:59:25.433

> 1.XML格式是否正确？

**是**的，但是**请注意，[处理指令](http://www.w3.org/TR/2006/REC-xml-20060816/#sec-pi)没有[属性](http://www.w3.org/TR/2006/REC-xml-20060816/#attdecls)**——只有数据。看起来像属性的东西是数据的一部分，有些人称它们为“ `pseudo-attributes`”。

> 2.这是使用 StAX XMLStreamReader API 解析处理指令的正确方法吗？

是的。

> 3.如何使用getPITarget()和getPIData()返回多个参数？

如果“多个参数”是指数据中可能包含多个伪属性，则答案是您的代码必须解析数据（使用一些标准的字符串方法作为 C# [**`split()`**](http://msdn.microsoft.com/en-us/library/ms228388.aspx)，并检索一组名称-值对对于所有伪属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T20:43:25.840

我认为这种处理指令具有属性的概念来自一些旧的 xml 手册。曾一度讨论过推荐 PI 以尊重或要求这种结构。然而，官方的 xml 规范从未强制甚至推荐过这种用法。

所以基本上你必须自己解析内容——它们可能是任何格式，但如果你知道它使用属性表示法，你可以解析它。

据我所知，不幸的是，没有一个 Java xml 解析器或处理包支持这种用法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-12-17T20:34:52.270

尽管[Dimitre 的回答](https://stackoverflow.com/a/404355/59087)在技术上是正确的，但一些流行的库现在可以按预期解析处理指令伪属性。后续示例解析以下 XML 处理指令以获取`href`pseduo-attribute 的值：

```
<?xml-stylesheet type="text/xsl" href="markdown.xsl"?> 
```

## JDOM2

使用[JDOM2](https://github.com/hunterhacker/jdom/blob/master/core/src/java/org/jdom2/ProcessingInstruction.java)：

```
import org.jdom2.ProcessingInstruction;
import org.xml.sax.helpers.DefaultHandler;

public class ProcessingInstructionHandler extends DefaultHandler {

  @Override
  public void processingInstruction( final String target, final String data ) {
    final ProcessingInstruction pi = new ProcessingInstruction( target, data );
    System.out.println( pi.getPseudoAttributeValue( "href" ) );
  }
} 
```

## 撒克逊人

使用[撒克逊](http://www.saxonica.com/documentation9.4/javadoc/net/sf/saxon/tree/util/ProcInstParser.html)：

```
import static net.sf.saxon.tree.util.ProcInstParser.getPseudoAttribute;
import org.xml.sax.helpers.DefaultHandler;

public class ProcessingInstructionHandler extends DefaultHandler {

  @Override
  public void processingInstruction( final String target, final String data ) {
    System.out.println( getPseudoAttribute( data, "href" ) );
  }
} 
```

# asp.net - .Net 实现

> ID：404142
> 
> 赞同：1
> 
> 时间：2008-12-31T22:11:25.337
> 
> 标签：asp.net, .net, visual-studio

我曾在两家以两种不同方式实现 ASP.Net 的公司工作过。我倾向于倾向于 A，但我目前的工作遵循 B（更典型）的方法。我想知道哪个是最好的，而且，这些实现是否有正式的名称？

A) 没有构建项目或解决方案。我们只是将 Visual Studio 指向一个目录并开始构建页面（我们有内联 aspx 页面和 aspx/code-behind 页面的组合）。我们只是将文件推送到服务器上，就是这样。如果我们需要任何第三方功能，所有类和服务都位于 App_Code 目录或 Bin 中。我们从未在 .Net 中使用过“构建”功能，而且大部分内容都是 JIT 编译的。调试是通过老式的 Response.Write() 方式完成的。

B) 创建一个项目。有 Resx 文件、sln 文件和项目文件等。我确信大多数 .Net 开发人员都习惯了该项目的编译、构建和调试方式。一切都与 VS IDE 密切相关，尝试在 Visual Studio 的另一个副本中打开“项目”需要与发起项目的人相同的目录/本地主机设置。

听听在这两种实施中工作过的人以及他们在任何一方都发现的好处会很有趣。

我问的原因是我想我想引导我目前的开发团队更多地转向 A 实现，并删除所有这些将你锁定在 VS 中的外围文件和配置，但我也愿意听到饮用 Microsoft Kool-Aid 的好处。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T22:21:29.093

我出于充分的理由使用了这两种方法，但坦率地说，B）比 A）更可取。

如果您正在开发代码，然后将其交给开发能力有限的客户，那么 A)（我们将其称为网站项目）可能是最好的方法，同时保持其他一切尽可能简单。

但是，如果您正在开发一个只有您的公司会处理代码的应用程序，那么您真的想学习如何使用 B) 方法（我们将其称为 Web 应用程序 probject）。

Web 应用程序项目可以更好地控制项目中的内容、实际发布的内容，并且至关重要的是可以带来更好的测试。我建议你接受这种方法，而不是试图说服你的同事远离网络应用程序。避免在 App_Code 和代码隐藏文件中发布代码。构建和发布程序集，添加到解决方案库项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-31T22:55:41.957

If you are using ASP .NET then you are already 'drinking the Microsoft Kool-Aid', or at least sipping it quite a bit.

With A, you are primarily using Visual Studio as a glorified text editor, with all debugging, organization, and other work being done manually.

With B, you are able to use all the debugging and editing features in Visual Studio. The downside is that Visual Studio has it's own way of doing some things that is initially pushed upon you; though with some effort you can modify the project settings to act how you want.

In any situation you have to compare what you gain vs what you lose. In the case of going from A to B, you are losing a bit of flexibility, but gaining a ton of debugging capability.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-31T22:23:17.247

我宁愿被“锁定”Visual Studio 而不是失去我的调试器。你们多久需要在 VS 之外进行开发？我猜永远不会。您已经在使用 MS 产品，请按照预期的方式使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-31T22:46:02.223

My preference is for method A. I like to keep things as simple as possible. With method A I know that everything within a directory is needed for a web site. With B it's possible to exclude files from a project but still have those files in the directory. I think this is confusing if you are looking at the site from Windows explorer.

With A it is easy to deploy a small fix to a page. With B you need to recompile the project and re-deploy. Related to this A allows you to make a change and deploy using any editor. B requires that you use VS.net.

B introduces more dependencies and complexity which can result in more issues that are not related to the site code.

A plays well with any source control. With B I've had issues with the project and solution files. B also adds files to the project that are not necessary for the web site.

With both A and B you can use VS.net for debugging. There's no need to use response.write with A.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-31T22:20:32.293

几天前看到[这个问题和答案......](https://stackoverflow.com/questions/398037/asp-net-web-site-or-web-application)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T22:53:01.073

I come from using both as well. option A is really the way to go if other people will be servicing the site once your done like anthony was saying. option b makes development so much easier and for me personally, I think you get more productivity out of option B.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-01T00:16:17.800

你对 B) 的工作方式做出了错误的断言：

> 尝试在 Visual Studio 的另一个副本中打开“项目”需要与发起该项目的人相同的目录/本地主机设置。

这并不完全正确。重要的设置应该包含在解决方案中，虽然您确实需要与项目真正组成部分相同的文件夹结构，而不是您暗示的繁重负担。在开发人员之间移动项目通常很容易。至少，不会比类似范围的桌面应用程序更难。

如果您使用源代码管理，则尤其如此。只需检查项目，您担心的任何文件夹结构都应该随附。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T00:58:04.843

“一切都与 VS IDE 密切相关，尝试在 Visual Studio 的另一个副本中打开“项目”需要与发起项目的人相同的目录/本地主机设置”

不是根据我的经验。Web 项目下的目录必须相同，但对于任何 Web 应用程序都是如此。如果您在谈论 3rd 方引用（例如 dll），那么您可以创建一个名为“References”的文件夹并将它们放入其中。这样，每个人都将指向相同的文件夹（相对于本地项目......如果您将项目存储在与其他人不同命名的目录中，这并不重要）。

至于本地主机设置......我不确定你在做什么。在 Web 服务器设置方面，方法 A 与方法 B 有何不同？

# .net - 我的服务以什么帐户运行？

> ID：404144
> 
> 赞同：2
> 
> 时间：2008-12-31T22:15:10.430
> 
> 标签：.net, windows-services

如何从服务本身确定服务正在运行的帐户。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-31T22:21:46.207

一种语言会很有用..

在 C++ 中： [获取用户名](http://msdn.microsoft.com/en-us/library/ms724432(VS.85).aspx)

C＃

```
System.Security.Principal.WindowsIdentity.GetCurrent().Name.ToString(); 
```

# windows - 您如何获得 Windows 视频驱动程序的版本？

> ID：404146
> 
> 赞同：3
> 
> 时间：2008-12-31T22:15:40.960
> 
> 标签：windows, device-driver

在 Windows 上，我的用户模式程序如何获取已安装显卡的驱动程序版本号？

像 ATI 的“催化剂控制中心”这样的程序可以向用户显示此信息或将其自动包含在错误报告中。他们如何得到它？

我一直在查看 PSDK 文档，但找不到任何相关内容。

用户程序可以遍历设备管理器显示的数据库吗？
是否有像获取磁盘驱动器几何形状这样的 IOCTL 调用？
它是否在（可靠的）注册表项中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T01:06:50.303

在 PowerShell 中：

```
Get-WmiObject Win32_VideoController | format-table Name, Description,VideoProcessor,DriverVersion 
```

WMI 对象也可以从任何讲 COM 或 .Net 的语言中获得。

ETA：您可能希望排除没有 VideoProcessor 值的记录，例如 Live Mesh 驱动程序。我通过`|where {$_.VideoProcessor -ne $null }`在格式命令之前包含在管道中来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-20T11:05:16.797

我使用“dxdiag /x output.xml”，然后通过解析“output.xml”获取视频驱动程序版本。dxdiag 很慢，但它告诉一个正确的驱动程序版本..

我使用 python 来完成这项工作。受 Jason 的回答启发，我得到以下代码：

```
>>> import wmi
>>> c = wmi.WMI()
>>> for device in c.Win32_VideoController():
    if device.VideoProcessor:
        print device.DriverVersion 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T00:59:44.997

我以前必须解决这个问题。我相信您实际上必须获取相关驱动程序文件的文件版本信息。

# javascript - x(); 是什么意思？参考？

> ID：404163
> 
> 赞同：0
> 
> 时间：2008-12-31T22:25:38.943
> 
> 标签：javascript

```
var y = new w();
var x = y.z;

y.z= function() {
      doOneThing();
      x();
   } 
```

*where`w`不包含`z`对象但包含其他对象（例如`a`，，，，`b`）`c`*

也`x();`可能指的是什么？（同样，这是 JavaScript）
函数是否在调用自身？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T22:44:39.840

```
var y = new w();
var x = y.z;  # x = undefined ( you say there is no w().z ) 

y.z= function() {
        doOneThing();
      x();  # undefined, unless doOneThing defines x 
}; 
```

但是，如果您设法在 yz() 之前的某个时间定义 x；那么 x() 将是当时定义的任何内容。

根据您的陈述，以下代码执行类似的操作。

```
var y = {}; 
var x; 
y.z = function(){ 
        x(); 
}; 
y.z(); # type error, x is not a function. 
x = function(){ } ; 
y.z(); # works.  
x = undefined; 
y.z(); # type error, x is not a function. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T22:28:35.723

```
var y = new w();

// Create a global variable x referring to the y.z method
var x = y.z;

y.z= function() {
        doOneThing();

      // Refers to the global x
      x();
     } 
```

重命名`x`为`oldZ`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T22:34:06.587

x 是一个变量，因为它的作用域在分配给 yz 的函数之外，所以可以在 yz 内部访问

该代码中发生的事情是 y 被初始化为类型为“w”的新类，然后 x 被设置为对当前“z”函数的引用，该函数是类的实例“y”的成员'w'。然后，函数 'z' 被一个新函数替换，它调用 doOneThing，然后执行 'x' 的值，正如已经确定的那样，它是 'yz' 的先前值，因此，*新*的yz 扩展了通过在旧 yz 返回之前简单地调用旧 yz 的*行为*。

我希望这是有道理的。

当然，假设您确实说“y”对象没有“z”成员，那么 x 将是未定义的，并且当您尝试执行 x() 时将引发运行时错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-31T22:44:24.927

很难理解的一点是，在 JavaScript（以及许多其他动态解释语言中）中，函数也是“一等公民”。它们可以像任何其他变量一样被操纵。

也许它可以帮助将 JavaScript 函数可视化为包含代码的字符串。当使用 () 语法调用时，JavaScript 执行字符串中的代码。但除此之外，它们可以像任何其他搅拌变量一样被操纵。

尽管这个类比并不完美（字符串和函数之间实际上存在许多差异），但它可能有助于初步理解这种函数变量对偶性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T00:11:59.993

看起来他们试图重载 wz() 方法，但这很奇怪，因为您说 az() 方法不存在。鉴于这种可能性，我会这样编写代码：

```
var y = new w();
var x = y.z;

y.z= function() {
      doOneThing();
      if (x) x();
   } 
```

它归结为同一件事，但会避免引发错误。

# c++ - GNU 编译器调试“级别”

> ID：404169
> 
> 赞同：0
> 
> 时间：2008-12-31T22:29:06.347
> 
> 标签：c++, debugging, gnu

在浏览我的编译器的各种选项开关（我的组织支持我的给定硬件配置的 GNU C++ 3.2.3）时，我遇到了这个问题：

```
-glevel
   :
Level 3 includes extra information, such as all the macro definitions
present in the program. Some debuggers support macro expansion when
you use -g3. 
```

我用几个宏编译了一个测试程序（比如一个循环，一个参数上的 if-then-else），然后在编译的代码上尝试了商业调试器 TotalView 和 GDB -g3。我没有看到任何区别（宏没有扩展到它们的原始代码，我无法“进入”宏等）。

这里的任何人都有在 GNU 编译器上使用 -g3 获得额外调试“功能”的经验吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T08:57:18.140

您的问题似乎暗示您不了解宏是什么。*当然*你不能进入宏。

-g3 对于“宏重”程序非常有用。考虑：

```
int main()
{
  int i;
  for (i = 0; i < 20; ++i) {
#define A(x) case x: printf(#x "\n"); break
    switch(i) {
      A(1); A(2); A(3); A(4); /* line 7 */
#undef A
#define A(x) case 10+x: printf("10+" #x "\n"); break
      A(1); A(2); /* line 10 */
    }
  }
  return 0;
} 
```

如果没有 -g3，当您在第 7 行或第 10 行停止时，您可能需要大量搜索 A() 的定义，并且可能有很多这样的定义，因此您必须找出哪个是“当前”。

使用 -g3，GDB 可以为您完成繁重的工作：

```
(gdb) b 7
Breakpoint 1 at 0x4004cc: file m.c, line 7.
(gdb) b 10
Breakpoint 2 at 0x4004fc: file m.c, line 10.
(gdb) r

Breakpoint 1, main () at m.c:7
7         A(1); A(2); A(3); A(4);
(gdb) info macro A
Defined at /tmp/m.c:5
#define A(x) case x: printf(#x "\n"); break
(gdb) c
1
2
3
4

Breakpoint 2, main () at m.c:10
10        A(1); A(2);
(gdb) info macro A
Defined at /tmp/m.c:9
#define A(x) case 10+x: printf("10+" #x "\n"); break
(gdb) q 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T22:57:31.483

**自 1992 年以来**，我不断**尝试，但`-g3`****从未让它做任何有用的事情**。

# xcode - 在 XCode 中启用代码视图的抗锯齿功能

> ID：404171
> 
> 赞同：8
> 
> 时间：2008-12-31T22:29:30.307
> 
> 标签：xcode

有没有办法让 XCode 在启用抗锯齿的编辑器中呈现文本？我在首选项对话框中看不到任何可以执行此操作的内容。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-31T22:41:11.813

XCode 文本已经抗锯齿。检查以确保字体大小大于指定的：

系统偏好设置 -> 外观。

如果它大于该值，您可以在命令行中尝试此命令来编辑 xcode 的应用程序设置。

```
defaults write com.apple.xcode AppleAntiAliasingThreshold -int <font-size>
defaults write com.apple.xcode AppleSmoothFontsSizeThreshold -int <font-size> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T09:40:26.480

Xcode 和 Terminal 中的默认代码字体是 10-point Monaco，传统上*没有*抗锯齿，因为有手动调整的位图。

您可以使用 Xcode Preferences 中的 Fonts & Colors 窗格让 Xcode 使用您喜欢的任何字体、大小和颜色。例如，如果您想要消除锯齿的文本，您可以使用 11 点 Monaco 或更大，或者如果像素清晰度对您很重要，您可以使用许多位图编程字体中的一种以它们的原始大小。

就个人而言，我更喜欢 Courier 12 和 Inconsolata 13 用于编码。Courier 随 Mac OS X 一起提供，而[Inconsolata是来自](http://www.levien.com/type/myfonts/inconsolata.html "无情的")[Raph Levien](http://www.levien.com/)的免费等宽字体。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T15:04:27.717

只是一个提示：要更改 xcode 中所有类别的字体，请单击类别表内，按 cmd+a 并双击类别表中的某个位置。之后您在“字体”对话框中应用的更改将应用​​到所有类别。

希望这有帮助

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-24T00:19:23.753

多年来，在 Xcode 中禁用字体抗锯齿所需要做的事情发生了变化。

目前，如果您正在运行 Xcode 4.6.x 和 OS X 10.8.x，要关闭字体抗锯齿功能，请从终端窗口运行以下两个命令：

```
defaults write com.apple.dt.Xcode NSFontDefaultScreenFontSubstitutionEnabled -bool YES
defaults write com.apple.dt.Xcode AppleAntiAliasingThreshold -int 24 
```

# sql-server - ftp Delete 命令中不允许使用哪些字符？

> ID：404175
> 
> 赞同：1
> 
> 时间：2008-12-31T22:34:08.350
> 
> 标签：sql-server, ssis, ftp

我正在从外部服务器对文件进行 ftp 处理，然后在外部服务器上删除它们，并且一个文件失败，因为文件名中有空格。我将我的 ftp 删除命令更改为在文件名周围加上引号。

```
ftpStream.WriteLine("delete """ & FileToDelete & """") 
```

但是，用户在创建文件名时可能会使用其他字符，我的程序仍然会阻塞吗？我无法控制这些文件名可能是什么。

（我放了一个 SSIS 和 SQL Server 的标签，因为我正在从 SSIS 包动态创建 ftp 任务。双方的操作系统都是 Win XP）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T22:44:37.360

不允许文件系统保留的任何字符。这通常包括空格、逗号、斜杠、冒号、问号、双引号等。但正如 JaredPar 所提到的，空格可能是唯一的普遍违规者，因为每个文件系统都有自己的一组保留字符，这些字符并不总是重叠。

对任何 ftp 或 http 路径进行 url 编码是个好主意。这会将空格转换为 %20，这通常应该被 ftp 服务器理解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T22:43:04.773

[请参阅 FTP RFC (RFC 959)](http://www.faqs.org/rfcs/rfc959.html)的第 5.3 节。除了 CrLf 之外，实际上没有任何非法字符作为文件名的一部分是非法的。

问题是知道目标服务器会阻塞哪些字符与非法 FTP 字符。我猜除了空格之外，不会有太多字符会导致问题。但我不是 FTP 专家。

# windows-server-2003 - Windows 2003 上的 msxml3.dll 是否存在任何已知问题？

> ID：404176
> 
> 赞同：1
> 
> 时间：2008-12-31T22:36:43.087
> 
> 标签：windows-server-2003, msxml3, rds

我正在尝试将使用 RDS 访问的 VB6 业务对象从 Windows 2000 迁移到 Windows 2003 服务器环境。我没有对应用程序和调用应用程序进行任何更改，但是当代码执行到达解析对象应该处理的 XML 数据点 (SAXXMLReader) 时，我收到错误代码 440 自动化错误。该应用程序使用 msxml3.dll，该 dll 安装在服务器上。有谁知道 msxml3 和 win2003 服务器之间是否存在已知问题？

或者有什么其他建议？

这是调用阅读器的代码：

```
Set reader = New SAXXMLReader
Set contentHandler = New mBL_ContentHandlerImpl
Set errorHandler = New mBL_ErrorHandlerImpl

contentHandler.rsBatch = m_rsBatch
contentHandler.rsDocument = m_rsDocument

Set reader.contentHandler = contentHandler 
Set reader.errorHandler = errorHandler     

reader.parse (sData) 
```

我不知道把代码放在这里会有什么价值。SAX 阅读器内容处理程序的实现相当大且笨拙。问题不在代码中，我不相信，因为这个应用程序在 Win 2k 服务器上运行良好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T23:14:41.920

事实证明，这个问题与 msxml 3 和 Windows 2003 之间的任何问题都没有关系。这个问题对于应用程序来说是特殊的，因为需要一个不存在的可用注册表项。此应用程序没有很好的文档记录，因此必须通过仔细检查大量代码来发现很多内容。

# linq-to-sql - Problem with the return type of a stored procedure

> ID：404186
> 
> 赞同：2
> 
> 时间：2008-12-31T22:42:07.257
> 
> 标签：linq-to-sql, stored-procedures

i have a stored procedure that creates a table then fills this table somehow from tables of the database then selects everything from this table then drops this table.the problem is,how can i use the selected columns from that dropped table im using DataContext i always put the result of the the stored procedure in a list of the type of that stored procedure

ex:

```
MyDataContext db=new MyDataContext();

public List<Base_RetriveItemResulte> RetriveItem(int ItemId)

{ 

    List<Base_RetriveItemResulte> ItemList=db.Base_RetriveItem(ItemId).ToList<Base_RetriveItemResulte>(); 

    return ItemList;

} 
```

//Base_RetriveItem is a stored procedure from the data context the problem with the stored procedure that drops the table" GetSubcategories " is that it cant be put in a list with its result type db.GetSubcategories(CategoryId) i was expecting to put the result from GetSubcategories(CategoryId) in a list of type

```
List<GetSubcategoriesResult> 
```

but there is no type like this!! How can I get the selected columns from the dropped table?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T22:59:40.653

**EDIT:** Please read the comments left at the end of your question. If you won't participate like everyone else does it gets confusing and frustrating, and those who would willingly help you will just ignore your request.

Please supply some information in your post. If we dont have clear information, we are guessing wildly and making ASSumptions.

*   What language are you using?
*   Are you using MSSQL, MySQL, Oracle? What version?
*   Linq to SQL, Linq to EF, or another ORM solution?

That stored procedure does not look like it RETURNS a value single result, but rather uses recursion and cursors to "walk" through a result. Very, Very, Very dirty.

That SP is the real problem here. I understand that you may not be able to fix it, but you may be better off by either a) making your own stored procedure, or b) calling the stored procedure the good old fashioned way with a dataAdapter or its equivalent.

As another point, you would be wise to look at the example of code that I gave to you and understand that it is going to be less prone to bugs and other problems. There are several key differences in our approaches that you should take the time to understand.

**Original post:** Stored procedures typically return DataSets, not an arraylist (Those are .NET types) . Your implementation could use some cleaning up too.

Change it to something like this, forgive the syntax errs, I do VB all day.

Note: ID has both letters capitalized, and also observe how the variables are declared in each scope. You may want to choose a different pattern, but this is an example of a standard.

```
//retrieves a list of strings related to the itemID
public List<String> RetriveItem(int itemID)
{

  // declare our return value
  List _itemList = new List<String>; // int, whatever type of list

  // create a data context with the using statement (so it will be cleaned up when
  // the operation is completed.
  using (MyDataContext _db=new MyDataContext()) 
  {

     // get the data from the stored procedure
     DataSet _ds = _db.Base_RetriveItem(itemID);

     // go through each row in the first table (you may have more tables to look in
     foreach DataRow _dr in _ds.Tables(0)
     {
        // adds the first column value in the row to the return list.
        _itemList.Add(Convert.ToString(_dr(0)); //convert to whatever type your list is.
     }
  }

return _itemList;

} 
```

Alternately you could use the IQueryable inside the using block.

```
 var listOfItems = from i in _db._db.Base_RetriveItem(itemID) select i;
 foreach i in listOfItems 
 {
   _itemList.Add(i); //convert to whatever type your list 
 } 
```

Its kind of difficult to provide without more detail and feedback.

> "is a stored procedure from the data context the problem with the stored procedure that drops the table GetSubcategories"

This is really confusing. The procedure is a GET which means it GETS data, not DROPS a TABLE. Please clarify this.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T21:50:47.280

这是一篇有用的[MSDN 文章](http://msdn.microsoft.com/en-us/library/bb386975.aspx)。

根据这篇文章，您应该期望您的结果是 GetSubcategoriesResult 的 IEnumerable。但是，你得到的是一个 int ！

> 无法将类型“int”隐式转换为...

您需要找到此方法的生成源：db.GetSubcategories(RootCat); 并检查返回类型。您需要去找设计器并对其进行处理，直到它为您提供正确的 IEnumerable 结果而不是行数（int）。

* * *

如果设计者不配合，可以回退到手动执行方式：

步骤 1\. 创建类以保存返回类型：

```
public class MyCustomResult
{
  public int CategoryId{get;set;}
  public int ParentCategoryId{get;set;}
  public int IsActive{get;set;}
} 
```

步骤 2\. 使用 ExecuteQuery 调用存储过程：

```
public List<MyCustomResult> GetResult(int RootCat)
{
  List<MyCustomResult> result =
    db.ExecuteQuery<MyCustomResult>("EXEC _BASE_GetSubcategories {0}", RootCat);
  return result;
} 
```

ExecuteQuery 将获取（单个）结果集并通过与属性名称匹配的列名将其映射到类（MyCustomResult）。

有些人可能会对这种手动解决方案感到失望，但 LinqToSql 对存储过程（以及具有存储过程的复杂映射场景）的支持相当薄弱，有时必须被覆盖。

* * *

就存储过程而言，它似乎是标准的“任意深度树遍历”。在 SQL 中实现这一点并没有真正好的方法，因此在我看来，存储过程的实现很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T23:27:55.103

I don't know if this is the exact solution you need, but one thing I've had to do in the past is "fool" LinqToSQL by setting up the code side of things with a very straight-forward SQL statement (make the stored procedure do nothing more than a very simple select that gives you the exact data structure that you need [like selecting from a temp view]). Then once you've got all the code stuff wired up, you can go make changes to your stored procedure to add its advanced functionality. As long as you don't regenerate the associated LinqToSQL stuff then it should continue to work.

# apache-flex - 使用 HTTPService 或 URLRequest 时如何避免 Flex 中的身份验证对话框？

> ID：404199
> 
> 赞同：1
> 
> 时间：2008-12-31T22:48:17.243
> 
> 标签：apache-flex, rest, restful-authentication

这与[这个问题有关](https://stackoverflow.com/questions/153420/is-it-feasible-to-create-a-rest-client-with-flex)。我正在编写一个使用 REST 的 Flex 应用程序（一个 WindowedApplication）。当我使用有效的身份验证发布时一切都很好，但如果我碰巧将无效的用户名或密码传递给 REST API（具体来说是 Twitter REST API），则会弹出一个身份验证对话框。

这不是理想的用户体验，当我使用 HTTPService 和 URLRequest 时都会发生这种情况。我似乎没有可以捕捉到取消对话框的事件。

这是我的代码的样子：

```
 var request:URLRequest = new URLRequest('http://twitter.com/statuses/update.json');
    request.method = URLRequestMethod.POST;
    var encoder : Base64Encoder = new Base64Encoder();
    encoder.encode(this.user + ':' + this.password);
    request.requestHeaders.push(new URLRequestHeader("Authorization", "Basic " + encoder.toString()));
    var params:Object = new Object();
    params.status = msg;                
    request.data = params;

    var loader:URLLoader = new URLLoader();
    loader.addEventListener(Event.COMPLETE, HandleRequestComplete);
    loader.load(request); 
```

我错过了什么吗？有没有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T07:14:11.603

那是因为您的 URLRequest 正在处理身份验证。为避免这种情况，请执行以下操作：

```
request.authenticate = false; 
```

问候！

阿兰。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-31T23:12:35.307

从[这里](http://apiwiki.twitter.com/REST+API+Documentation#Authentication)的 Twitter API 文档：

> suppress_response_codes：如果存在此参数，则所有响应都将返回 200 OK 状态代码 - 甚至是错误。此参数的存在是为了适应在拦截所有非 200 响应的浏览器中运行的 Flash 和 JavaScript 应用程序。如果使用，那么客户端的工作就是通过解析响应正文来确定错误状态。请谨慎使用，因为这些错误消息可能会发生变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T13:18:07.463

我不知道这是否适用于普通的 Flex 应用程序，但在 AIR 应用程序中，您可以设置允许的响应代码列表以被视为有效。

# windows - 如何运行以下 WMI 查询？

> ID：404206
> 
> 赞同：0
> 
> 时间：2008-12-31T22:51:25.770
> 
> 标签：windows, wmi, usb, wql

如何以编程方式和一次性交易运行以下 WMI 查询？我可以使用 Visual Studio 2008，如果可以，我应该设置什么语言和项目类型？我是一个完整的初学者，所以请提供详细信息。谢谢！

```
SELECT * FROM Win32_USBControllerDevice
For Each as USBDevice
   ASSOCIATORS OF {Win32_PnPEntity.DeviceID="<USBDevice.Dependent>"}
    WHERE ResultClass = Win32_DiskDrive
   For Each as Drive
      ASSOCIATORS OF {Win32_DiskDrive.DeviceID="<Drive.DeviceID>"} 
       WHERE AssocClass = Win32_DiskDriveToDiskPartition
      For Each as Drive2Part
         ASSOCIATORS OF {Win32_DiskPartition.DeviceID="<Drive2Part.DeviceID>"} 
          WHERE AssocClass = Win32_LogicalDiskToPartition
         For Each as Disk2Part
            Win32_LogicalDisk = <Disk2Part.Dependent>
         End For
      End For      
   End For
End For 
```

这是来自 CodeGuru 的查询的[来源](http://www.codeguru.com/forum/showthread.php?t=467620)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T23:11:48.193

[WMI 代码创建者](http://www.microsoft.com/downloads/details.aspx?familyid=2cc30a64-ea15-4661-8da4-55bbc145c30e&displaylang=en)将以几种语言为您创建代码片段。它非常适合这种任务。

# design-patterns - 设计模式 - 建筑宇航员

> ID：404210
> 
> 赞同：39
> 
> 时间：2008-12-31T22:53:52.630
> 
> 标签：design-patterns, architecture

也许我的问题本质上与这个问题相似：[您使用设计模式吗？](https://stackoverflow.com/questions/11586/do-you-use-design-patterns)

我编写的程序是 50-75 K 行的小型程序，主要使用[Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms)和[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)。这些程序是 GUI 密集型的，允许设计和布局各种图形和图形处理。

我认为自己擅长 OOP，并在平衡 OOP 和传统的过程方法以创建可维护的代码方面进行了实践。

当我考虑设计模式时，问题就出现了。链接到的线程有一个有趣的评论，即可以使用设计模式，但不是有意的。当我想有意使用一种设计模式（在我的程序设计中）时，感觉就像我正在超越需要的东西，我处于“[建筑宇航员](http://www.joelonsoftware.com/articles/fog0000000018.html)”的领域，所以我回退到我的传统方法，一切顺利（即正常）。

以 MVC 模式为例。如果我想使用 Windows 窗体或 ASP.NET (Visual Studio 2005) 来实现这种模式，那么我必须编写一个“框架”，而编写框架似乎比应用程序的大小更麻烦。

也许我的应用程序太小而无法证明使用其中一些模式是合理的。也许我只是不太了解这些模式，或者需要更多地研究它们。

有没有人体验过这种“建筑宇航员”的感觉？

您如何在不“过火”的情况下有意识地使用设计模式？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-31T23:11:26.590

当涉及到这种性质的小型应用程序时，我通常更担心[反模式](http://c2.com/cgi/wiki?AntiPattern)比我对设计模式所做的还要多。也就是说，这实际上是同一枚硬币的两个方面：对我来说，设计模式的力量在于熟悉它们，以便认识到我正在考虑的任何解决方案的不那么明显的利弊。我很少会特意去完全实现一个完整的设计模式（除非我真的需要所有的功能）；然而，我经常通过识别我所走的道路并查看该解决方案的常见缺陷或缺点，为自己节省了很多未来的返工，然后我可以检查我未来的用途，看看它是否会成为对我来说是否相关的问题。因此，设计模式的强大之处在于，您可以轻松预测当前解决方案对潜在需求的未来后果，

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-31T23:14:56.473

'你如何去有意识地使用设计模式而不会“过火”？'

简单的。

1.  不要将 MVC 框架开发工作与模式混为一谈。

2.  认识到你所做的每一件事都是以前做过的（你或其他人）。

3.  当你重复某件事——任何事情——你是在遵循一种模式。

4.  当你为任何东西重复设计时——无论多么小——你都在遵循一种设计模式。

5.  当您注意到自己在重复某件事时，请为您正在重复的那件事指定一个名称。看，您已经发现并命名了您的第一个设计模式。无论多小。

6.  当你命名了一个设计模式后，你就可以考虑什么时候使用它，为什么使用它，它解决了什么问题以及使用它的后果是什么。无论多小。

7.  每一项涉及“重复设计元素”的学习都是设计模式。无论多小。

每个循环。每个 if 语句。每个对话框。每个文件都打开。这些都是设计模式。

大多数是语言的一部分，并且具有明显的特定于语言的名称。“如果”、“打开”等

一些设计模式大于单个语句但小于整个 MVC 框架。这些是有趣的。学习那些。买一本书。阅读。MVC 不会出现在大多数设计模式书籍中，因为——嗯——它太复杂而且太难应用。

不要从 MVC 开始。从其他任何事情开始。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-31T23:52:48.360

“建筑宇航员”是那些花大量时间讨论设计但实际上并没有实现任何设计的人。

我喜欢“重构到模式”一书中介绍的设计模式方法。在这里，模式不是我们预先投资的东西，而是我们为了降低代码复杂性而做的事情。因为这种方法需要从功能代码开始，并根据更容易扩展代码以满足特定需求来选择重构，所以它非常注重结果。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-31T23:20:32.873

几乎任何适当的设计模式在应用时都应该简化。如果您让事情变得更复杂，那么您可能会针对您的特定问题朝着错误的方向前进。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-31T23:06:26.613

MVC 本身并不要求您编写任何框架。它只是意味着您将视图、控制器和模型代码分开。我甚至将 MVC（或 MVP）用于简单的移动应用程序，因为我发现控制分离在编写测试时非常有利（更不用说在更改 UI 时）。

我的猜测是你现在没有做很多单元或集成测试，所以这个部门对代码质量和可读性的帮助并不明显。

我强烈建议您阅读[Fowler 对 UI 架构的报道](http://martinfowler.com/eaaDev/uiArchs.html)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-01T00:57:15.703

不要忘记沟通——众所周知的设计模式允许您用几句话来沟通复杂的事情。当您说“并且使用观察者模式传递通知”时，每个人都知道您的意思。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-09-30T16:20:57.270

很少有项目需要或受益于超架构。大多数以这种方式开始的项目永远不会完成。许多确实很难扩展或维护（尽管他们声称相反）。记住语言和技术的发展速度有多快。当你完成一个非常大的项目时，今天最新、最酷的东西可能已经过时了。模式很有趣，可以让您深入了解如何优雅地解决问题，但大多数时候，在现实世界中，没有优雅的解决方案。我工作过的每一个地方都有一位超级明星宇航员，他在编写我以后必须修复的垃圾代码时吐出无尽的行话给每个人留下了深刻的印象。最后的结果是最重要的。您的公司需要一个有效的应用程序，而不是无休止的工作，即使他们没有'

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T23:08:14.817

这些模式只是作为一般问题的抽象解决方案。如果一个人知道这些模式，那么他们更有可能更快地应用一个已知的解决方案，而不是坐在那里思考，“哎呀，我想知道如何使这个工作。”

关于框架：如果您曾在一个多人的团队中工作过（这听起来不像是基于您的项目的小规模），框架可以帮助每个人以相同的方式做事，即对于可维护性和快速让新人上手的团队努力很重要。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-31T23:24:11.697

简单的问题通常需要简单的解决方案，尽管一些难题非常简单。另一方面，复杂的问题可以通过有组织的方式或肮脏的意大利面条代码来解决。许多人试图组织软件设计，一些“模式”出现并得名。

我认为当你向他人传达你的设计意图时，模式是有用的词汇，但这并不是你将它强加到设计中的东西。当您根据需要使代码解耦时，您可以根据需要应用模式。例如，当您发现自己正在制作非常复杂的构造函数时，请使用构建器模式。

将数据层和 UI 层从您的业务逻辑中解耦出来是您应该做的事情，就像好的设计一样。同样，低耦合、[DRY](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)和可维护的代码应该是目标，而不是模式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-31T23:07:12.727

对我来说，这取决于：

*   应用程序的大小，
*   要使用的设计模式，
*   我必须在架构上预先投入的时间。

在小型应用程序中，我不太可能使用任何不能自然流动的设计模式，除非它们在扩展或维护应用程序的范围内具有很高的投资回报率。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-31T23:07:48.937

你在一个大公司为你设定模式的环境中工作，我认为这解释了你的感受。你可能是对的。我们这些在开放环境中使用 FOSS 语言解决更广泛问题的人有无穷无尽的选择，阅读设计模式有助于我们做出有关架构的明智决策。通常这意味着选择正确的库。您正在为您工作的狭窄领域做出选择。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-31T23:11:15.857

恕我直言，需要：

1.  很好地了解您可以使用的不同设计模式的优缺点
2.  明确您的应用程序的设计目的，并确保该模式的优点被用于您的优势。

> 以 MVC 模式为例。如果我想使用 WinForms 或 ASP.NET (VS 2005) 来实现这种模式，那么我必须编写一个“框架”，而对于应用程序的大小来说，编写框架似乎更麻烦。

您的 Web 应用程序是否需要有效的 SEO？为 ASP.NET 实现的 MVC 模式可以在这方面有所帮助。以 SO URL 为例。它们针对搜索引擎进行了如此出色的优化，主要是因为 ASP.NET 的 MVC 模式实现支持它并且已在 SO 设计/开发中有效使用。

# subsonic - Inserting a new record pattern in SubSonic 3

> ID：404222
> 
> 赞同：2
> 
> 时间：2008-12-31T22:58:17.770
> 
> 标签：subsonic, subsonic3, subsonic-v3p2

I'm trying out the new SubSonic 3 preview, but I'm not sure about the patterns I should be using for the basic CRUD operations in my MVC project.

I'm trying to keep as much of my data logic in my models, so I added some static CRUD methods to each model's partial class.

For example, let's say I have a configuration table, which should only have a single record. So, my partial class may look something like this:

```
public partial class Configuration{
        // cut down; mocking hooks here IRL
        private static IRepository<Configuration> Table = new MyRepository<Configuration>();

        public static Configuration Retrieve()
        {
            var config = Table.GetAll().FirstOrDefault();
            if (config == null)
            {
                config = new Configuration();
                Table.Add(config);
            }
            return config;
        }

        public static void Update(Configuration target)
        {
            Table.Update(target);
        }
} 
```

Currently, this doesn't work as the config table has an identity column for a primary key, and Add-ing a new record to the table throws the standard "Cannot insert explicit value for identity column" error. SubSonic 3 doesn't seem to generate classes that, upon new-ing them up, play nice with the rules of the database schema (i.e., no default values, no nullable primitives for values that are nullable in the database, etc).

Now, I can alter my table and pattern to get around these issues, but I'm wondering about when I *cannot* get around this issue--when I have to add a new record to the database and have an identity as my primary key.

I'm also wondering if this pattern is even correct or not. SubSonic gives you a number of different ways you can go about your repository business, so I'm not sure which one I should be using. I'd LIKE to use my models as MUCH as possible (otherwise why not just Linq to Sql?), so I don't want to use SubSonic's query building goodness when trying to CRUD my models.

What should I do here? Any advice on CRUD patterns for using SubSonic 3 in my MVC project would be welcome and +'d. Also welcome are links to websites that cover this subject for SubSonic 3 but that don't rank high in Google searches...

* * *

Asked Rob directly ([link here](http://groups.google.com/group/subsonicproject/browse_thread/thread/d65036df31a37368)). For my DB, at least, there's a showstopper bug in the generated code. Aaah, alpha software.

* * *

**UPDATE**

With [the release of Subsonic3](http://blog.wekeroad.com/), can we have a little bump to reconsider this question?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T20:06:55.357

首先也是最重要的：t4 模板可供您根据需要使用 SS3 进行更改。这是使用 T4 的主要思想——我不想让你陷入我的愚蠢:)。

对于手头的问题 - 我认为这可能是我们的模板中的一个错误，它拒绝将值粘贴到 PK 字段中：

```
 ISqlQuery BuildInsertQuery(T item) {
        ITable tbl = _db.FindTable(typeof(T).Name);
        Insert query = null;
        if (tbl != null) {
            var hashed = item.ToDictionary();
            query = new Insert(_db.Provider).Into<T>(tbl); ;
            foreach (string key in hashed.Keys) {
                IColumn col = tbl.GetColumn(key);
                if (!col.IsPrimaryKey) {
                    query.Value(key, hashed[key]);
                }
            }
        }
        return query;
    } 
```

在这种情况下，我们的支票实际上应该是......

```
 if (!col.IsPrimaryKey && !col.AutoIncrement) {
                    query.Value(key, hashed[key]);
                } 
```

这样，非身份将被插入。但是在这里阅读您的问题时，在我看来，您并没有试图插入非身份。

您发给我的电子邮件没有说明 PK 作为身份 - 您的 PK 是一个名为“NAme”的东西，它是一个字符串类型，而*不是*身份（自动增量）。

> 我想知道什么时候我无法解决这个问题——当我必须向数据库中添加一条新记录并且有一个身份作为我的主键时。

这是 SubSonic 的假设 - 您的 PK 是 IDENTITY 列。如果您只有一个 IDENTITY 列，我们无法帮助您，因为这是一个死锁表，您无法向其中插入任何值，因此您无法勾选 IDENTITY 列。此时您唯一的办法是 SET IDENTITY INSERT="off"，这违背了目的。

希望这能回答你的问题？如果我没有得到它 - 你能为我做这个：

1.  一句话：你不能做什么，错误是什么
2.  你期待什么

谢谢威尔，我希望我不会太厚。

# sql - 没有通配符的 SQL LIKE 与 '=' 一样吗？

> ID：404226
> 
> 赞同：47
> 
> 时间：2008-12-31T23:01:15.173
> 
> 标签：sql, wildcard, sql-like

我知道这是一个非常基本的问题，我*想*我知道答案……但我想确认一下。

这些查询真的等价吗？

```
SELECT * FROM FOO WHERE BAR LIKE 'X'
SELECT * FROM FOO WHERE BAR ='X' 
```

在没有通配符的情况下使用 like 可能会产生性能开销？

我有一个可以选择使用 LIKE 和通配符的应用程序。SP 当前执行类似操作并附加通配符 - 我正在考虑更新查询以使用 like 但让应用程序根据需要附加通配符。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-31T23:07:18.093

正如@ocdecio 所说，如果优化器足够聪明，应该没有区别，但是如果您想确定幕后发生的事情，您应该比较两个查询的执行计划。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2016-06-13T11:18:51.863

Matt Whitfield 的原始答案来自[这里](https://ask.sqlservercentral.com/questions/20216/why-use-like-without-a-wildcard.html)

**`=`和之间**有区别**`LIKE`。使用 执行字符串比较时`LIKE`，模式字符串中的所有字符都是有效的。这包括前导或尾随空格。**

 **因此，如果您有一列是`char`or`nchar`而不是`nvarchar`or `varchar`，则会由于尾随空格而产生不同的结果。

重现此行为的小示例：

```
CREATE TABLE #temp (nam [varchar](MAX))
INSERT INTO [#temp] ([nam])
VALUES ('hello')
INSERT INTO [#temp] ([nam])
VALUES ('hello  ')

SELECT * FROM #temp WHERE [nam] = 'hello  '

SELECT * FROM #temp WHERE [nam] LIKE 'hello  ' 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-31T23:04:08.647

任何好的优化器都会将第一个表达式减少到第二个。

# c++ - 使用枚举作为数组索引

> ID：404231
> 
> 赞同：61
> 
> 时间：2008-12-31T23:02:54.140
> 
> 标签：c++, enums

我有这个枚举：

```
enum ButtonState {
    BUTTON_NORMAL = 0,
    BUTTON_PRESSED = 1,
    BUTTON_CLICKED = 2
};

const u8 NUM_BUTTON_STATES = 3; 
```

在我的 Button 类中，我有成员变量`ButtonState state;`和`ButtonColors colors[NUM_BUTTON_STATES];`. 绘制按钮时，我`colors[state]`用来获取按钮所处状态的颜色。

我的问题：

1.  这是好的编程风格吗？有更好的方法吗？（我通常只使用带有 switch 语句的枚举......使用枚举作为数组索引感觉不对。）
2.  我*必须*指定枚举的值吗？默认情况下它似乎从 0 开始并递增 1，但它是否保证在所有编译器中都以这种方式工作？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-31T23:23:12.057

***这是好的编程风格吗？***

我认同。我经常做同样的事情。

***有更好的方法吗？***

```
class Button
{
public:
    // Used for array indexes!  Don't change the numbers!
  enum State {
    NORMAL = 0,
    PRESSED,
    CLICKED,
    NUMBER_OF_BUTTON_STATES
  };
}; 
```

缺点是*NUMBER_OF_BUTTON_STATES*现在是一个有效的*Button::State*值。如果您将这些值作为*ints*传递，这不是一个大问题。但是如果你真的期待一个*Button::State*就麻烦了。

***使用枚举作为数组索引感觉不对。***

没关系。只需将其**记录下来**，以便下一个人知道发生了什么！（这就是评论的目的。）

***我必须指定枚举的值吗？***

如果没有“=”分配，枚举*应该*从零开始并向上递增。

如果枚举条目具有 '=' 赋值，则后续非 '=' 枚举条目从那里继续计数。

资料来源： *带注释的 C++ 参考手册*，第 113 页

也就是说，我喜欢指定初始值只是为了使代码更清晰。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-01T00:09:53.287

是的，它会运作良好。也就是说，无论如何，您*确实*应该在枚举中添加另一个条目来定义项目数量的值：

```
enum ButtonState {
    BUTTON_NORMAL,
    BUTTON_PRESSED,
    BUTTON_CLICKED,
    STATE_COUNT
}; 
```

然后你可以像这样定义数组

```
Color colors[STATE_COUNT]; 
```

否则，使状态数量与数组大小保持同步是一团糟。如果没有以其他方式初始化，枚举将始终从零开始，然后每个附加条目将被分配一个比前一个条目高一的值，如果没有以其他方式初始化。当然，如果你愿意的话，如果你明确地输入一个零也不会受到伤害。如果您不介意额外的代码，我会使用类似的函数来包装对原始数组的访问

```
Color & operator[](ButtonState state) {
    return array[state];
} 
```

`getColor`或转发请求的等效函数。这将禁止使用某个整数直接索引数组，这几乎肯定会在某些时候失败，因为索引错误。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-31T23:13:51.607

使用枚举是可以的。但是您不必为每个项目指定值。指定第一个值就足够了。我不会假设枚举从 0 开始，因为我使用了使用 1 作为起始值的编译器（不适用于 PC，但一些用于微控制器的编译器有一些奇怪的行为）。此外，您可以摆脱 const：

```
enum ButtonState {
    BUTTON_NORMAL = 0,
    BUTTON_PRESSED,
    BUTTON_CLICKED,
    NUM_BUTTON_STATES
}; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-31T23:26:33.813

风格方面，还不错。

像 Delphi 这样的基于 Pascal 的语言允许将数组边界指定为枚举类型，因此您只能使用该特定类型的项目作为索引。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-31T23:09:15.143

问题1：我认为这是很好的编程风格。我用它所有的时间。问题 2：据我所知，可以保证以这种方式工作，因此您不必指定值。

我也会将 NUM_BUTTON_STATES 放入枚举中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T23:24:45.767

使用枚举来索引数组是完全正常的。

您不必指定每个枚举值，它们会自动递增 1。让编译器选择这些值可以减少错误输入和创建错误的可能性，但它会让您无法看到这些值，这在调试中可能很有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-01T00:13:11.223

没关系，但我想对数组进行一些边界检查，就好像有人添加了另一个 ButtonState，你会遇到问题。

此外，颜色数组的元素是不可变的，因此可以考虑使用不同的集合来排列数组，以便您可以强制执行该不变性。也许一个`Dictionary<ButtonState,ButtonColor>`

# c++ - How do I pass a reference to a two-dimensional array to a function?

> ID：404232
> 
> 赞同：26
> 
> 时间：2008-12-31T23:03:39.397
> 
> 标签：c++, arrays

I am trying to pass a reference to a two-dimensional array to a function in C++. I know the size of both dimensions at compile time. Here is what I have right now:

```
const int board_width = 80;
const int board_height = 80;
void do_something(int[board_width][board_height]& array);  //function prototype 
```

But this doesn't work. I get this error from g++:

```
error: expected ‘,’ or ‘...’ before ‘*’ token 
```

What does this error mean, and how can I fix it?

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-31T23:11:32.907

If you know the size at compile time, this will do it:

```
//function prototype
void do_something(int (&array)[board_width][board_height]); 
```

Doing it with

```
void do_something(int array[board_width][board_height]); 
```

Will actually pass a pointer to the first sub-array of the two dimensional array ("board_width" is completely ignored, as with the degenerate case of having only one dimension when you have `int array[]` accepting a pointer), which is probably not what you want (because you explicitly asked for a reference). Thus, doing it with the reference, using sizeof on the parameter `sizeof array` will yield `sizeof(int[board_width][board_height])` (as if you would do it on the argument itself) while doing it with the second method (declaring the parameter as array, thus making the compiler transform it to a pointer) will yield `sizeof(int(*)[board_height])`, thus merely the sizeof of a pointer.

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-31T23:29:29.173

Although you can pass a reference to an array, because arrays decay to pointers in function calls when they are not bound to a reference parameters and you can use pointers just like arrays, it is more common to use arrays in function calls like this:

```
void ModifyArray( int arr[][80] ); 
```

or equivalently

```
void ModifyArray( int (*arr)[80] ); 
```

Inside the function, arr can be used in much the same way as if the function declaration were:

```
void ModifyArray( int (&arr)[80][80] ); 
```

The only case where this doesn't hold is when the called function needs a statically checked guarantee of the size of the first array index.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-31T23:28:30.080

You might want to try *cdecl* or *c++decl*.

```
% c++decl
c++decl> declare i as reference to array 8 of array 12 of int
int (&i)[8][12]
c++decl> explain int (&i)[8][12]
declare i as reference to array 8 of array 12 of int
c++decl> exit 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-09-16T18:45:56.927

语法不正确。

让我们以一维数组为例

```
 int a[] = {1,2,3};
 int (&p) [3] = a; // p is pointing array a 
```

所以你可以对二维数组做同样的事情，如下所示

```
const int board_width = 80;
const int board_height = 80;
void do_something(int (&array) [board_width][board_height]); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-31T23:09:29.963

I think this is what you want:

```
void do_something(int array[board_width][board_height]); 
```

You can't pass an array of references to a function.

# c++ - 如何从 stl 数据结构中删除 reverse_iterator？

> ID：404258
> 
> 赞同：15
> 
> 时间：2008-12-31T23:18:28.430
> 
> 标签：c++, stl, iterator

由于某种原因，以下代码失败。您不能简单地使用它的 base() 方法擦除 reverse_iterator。

```
#include <set>
#include <iostream>

int main()
{
    std::set<int> setOfInts;
    setOfInts.insert(1);
    setOfInts.insert(2);
    setOfInts.insert(3);

    std::set<int>::reverse_iterator rev_iter = setOfInts.rbegin();
    std::set<int>::reverse_iterator nextRevIter = setOfInts.rbegin();
    ++nextIter;

    while ( rev_iter != setOfInts.rend())
    {
        // Find 3 and try to erase
        if (*rev_iter == 3)
        {
            // SEGFAULT HERE
            setOfInts.erase( rev_iter.base());
        }
        rev_iter = nextRevIter;
        ++nextRevIter;
    }

} 
```

如何正确地执行上述操作？给定一个与您要擦除的内容相对应的 reverse_iterator，您如何擦除它？

**请注意，不幸的是，擦除不会采用 reverse_iterators。它想要真实的东西。**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-31T23:25:32.003

显然解决方案是 base() 返回的是 1 。以下标识适用于 reverse_iterator：

```
&*(reverse_iterator(i)) == &*(i - 1) 
```

或者换句话说，reverse_iterator 始终是它作为基础的常规迭代器的一次传递。不知道为什么。

# 在海合会

简单地改变

```
 // SEGFAULT HERE
        setOfInts.erase( rev_iter.base()); 
```

到

```
 // WORKS!
        setOfInts.erase( --rev_iter.base()); 
```

我当然很好奇为什么上面的身份是有意义的。

# 在 Visual Studio 中

重新开始工作并在 Visual Studio 中尝试此操作，我发现上述解决方案不太奏效。“nextIter”在擦除时变得无效。相反，您需要从擦除中保存临时值以获取下一个迭代器，而不是像上面那样保留 nextIter。

```
 set<int>::iterator tempIter = setOfInts.erase(--rev_iter.base());
  rev_iter = setOfInts.erase(tempIter); 
```

所以最终的解决方案是

```
int main()
{
    using namespace std;

    set<int> setOfInts;
    setOfInts.insert(1);
    setOfInts.insert(2);
    setOfInts.insert(3);

    set<int>::reverse_iterator rev_iter = setOfInts.rbegin();

    while ( rev_iter != setOfInts.rend())
    {
        // Find 3 and try to erase
        if (*rev_iter == 3)
        {
            cout << "Erasing : " << *rev_iter;
            set<int>::iterator tempIter = setOfInts.erase( --rev_iter.base());
            rev_iter = set<int>::reverse_iterator(tempIter);            
        }
        else
        {
            ++rev_iter;
        }
    }   

} 
```

请注意，关联容器不会从擦除返回迭代器。所以这个解决方案不适用于地图、多地图等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-04T16:57:45.210

当您使用反向迭代器进行迭代并希望使用 base() 修改其容器时，请始终牢记 reverse_iterator 始终基于原始顺序的下一个迭代器。这有点不直观，但实际上使代码更简单：

```
#include <set>
int main()
{
    std::set<int> setOfInts;
    setOfInts.insert(1);
    setOfInts.insert(2);
    setOfInts.insert(3);

    typedef std::set<int>::reverse_iterator RevIter;

    RevIter rev_iter = setOfInts.rbegin();
    while (rev_iter != setOfInts.rend())
    {
        // Find 3 and try to erase
        if (*rev_iter == 3)
            setOfInts.erase(--rev_iter.base());

        ++rev_iter;
    }
} 
```

在此示例中，不需要保留“下一个”迭代器，因为基本迭代器没有失效！（我们在处理普通迭代器时确实需要它。）

反向迭代器的行为在处理单个项目时会产生奇怪的逐一困难，但实际上它简化了范围：

```
riValue = find(riEnd.base(), riBegin.base(), value); 
```

使用完全相同的对象（以相反的顺序）

```
iValue = find(riBegin, riEnd, value); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-08T07:27:23.040

1 来自[map::erase](http://msdn.microsoft.com/en-us/library/z2f3cb7h%28v=vs.90%29.aspx)，我们知道它只需要`iterator`;

2 来自[reverse_iterator::base](http://msdn.microsoft.com/en-us/library/10sbbf0k%28v=vs.90%29.aspx)，我们知道`&*(reverse_iterator ( i ) ) == &*( i – 1 ).`

因此，您可以使用 erase(--r_v.base()) 来擦除“r_v”（和“current-1”）指向的元素：

```
 r_v+1            r_v          r_v-1
           current-2      current-1      current 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-12-31T23:22:57.767

使用迭代器本身调用`erase`（无需使用`base`）。

```
#include <set>
#include <iostream>

int main()
{
    std::set<int> setOfInts;
    setOfInts.insert(1);
    setOfInts.insert(2);
    setOfInts.insert(3);

    std::set<int>::reverse_iterator rev_iter = setOfInts.rbegin();

    while (rev_iter != setOfInts.rend())
    {
        // Find 3 and try to erase
        if (*rev_iter == 3)
        {
            rev_iter = setOfInts.erase(rev_iter);
        }
        else
        {
            ++rev_iter;
        }
    }
} 
```

此外，您不需要单独的“下一个”迭代器（参见上面的更改）。一个更好的方法是使用`std::remove_if`（或类似的函数）。

# java - Spring SP Class generation with or without Eclipse

> ID：404275
> 
> 赞同：0
> 
> 时间：2008-12-31T23:29:37.143
> 
> 标签：java, sql, database, spring, scripting

With Hibernate+Eclipse you can generate POJO classes that represent the tables. You can then wire it all together pretty easily with Spring. However, if you have to interact with stored procedures you have to wrap each one in it's own class(es) -- although this is definitely preferred to standard JDBC it is still a bit cumbersome at times.

Does anyone out there know of a script, application, Eclipse Plug-in or anything that generates Spring stored procedure classes?

Thanks in advance.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T00:41:11.523

您可以继承 Spring 的 StoredProcedure 来调用存储过程，但如果您使用的是 Spring 2.5，还有另一种方法。[SimpleJdbcCall](http://static.springframework.org/spring/docs/2.5.x/reference/jdbc.html#jdbc-simple-jdbc-call-1)类使这很容易。

我不知道 Eclipse 插件或其他任何可以为您做的事情。如果你有很多事情要同时做，在我看来，它是一个完美的地方.

[咆哮] 天哪，你已经有了框架。要求我们写一点代码是不是太过分了？如果都是向导和插件，那么开发人员有什么用？[/咆哮]

# cocoa-touch - 如何使用 UIView 和 subViews 创建相当于 Java 的 CardLayout 或 ASP:MultiView？

> ID：404276
> 
> 赞同：0
> 
> 时间：2008-12-31T23:34:52.423
> 
> 标签：cocoa-touch, interface-builder

理想情况下，我希望能够在 Interface Builder 中创建视图，然后用代码交换它们。

任何指向示例代码或教程的指针将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-01T02:59:56.533

这正是 UIViewController 和 UIView 的配对让你做的。您可以在 Interface Builder 中为 UIViewController 布置 UIView，然后轻松地从代码中使用它们。

# java - Java calendar time, minute is wrong

> ID：404278
> 
> 赞同：5
> 
> 时间：2008-12-31T23:36:06.350
> 
> 标签：java, time

Anyone know why the MINUTE method in java.util.Caldendar returns an incorrect minute?

```
import java.util.Calendar;

public class Clock
{
    // Instance fields
    private Calendar time;

    /**
     * Constructor. Starts the clock at the current operating system time
     */
    public Clock()
    {
       System.out.println(this.time.HOUR_OF_DAY+":"+this.time.MINUTE);
    }
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-31T23:42:49.333

Calendar.MINUTE isn't the actual minute but rather a constant index value to pass into "get()" in order to get the value. For example:

```
System.out.println(this.time.get(Calendar.HOUR_OF_DAY) + ":" + this.time.get(Calendar.MINUTE)); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-31T23:44:13.463

`HOUR_OF_DAY`并且`MINUTE`是公共静态字段，旨在传递给`Calendar#get(int)`. 通常，您希望使用`Calendar.getInstance().get(Calendar.MINUTE)`当前分钟。不过，在您的示例中，您想要`time.get(Calendar.MINUTE)`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-16T07:51:31.647

导入 java.util.Calendar；

public class Clock { // 实例字段 private Calendar time;

```
/**
 * Constructor. Starts the clock at the current operating system time
 */
public Clock()
{
   time = Calendar.getInstance(); 
   System.out.println(this.time.get(Calendar.HOUR_OF_DAY) +
                       ":" + this.time.get(Calendar.MINUTE));
} 
```

}

----0--------------- ;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-12-27T03:06:45.813

# windows - Uninstalling a Windows app installed by a nonexistent user

> ID：404280
> 
> 赞同：2
> 
> 时间：2008-12-31T23:38:15.193
> 
> 标签：windows, winforms, installation, windows-installer

We have a .Net Winforms app running on XP machines that are not connected to the internet. We install and update this app by distributing a CD with a .MSI installer file. Users uninstall the old app from the Add or Remove Programs control panel and install the new app from CD.

A while ago we required users to log in under individual accounts and not a shared account. All these individual accounts are "Standard User" accounts in the Power Users group from the XP User Accounts control panel. Such users are able to install the app for all users, we have tested this and it works.

Until recently. A user updating a remote machine says the application does not appear in Add or Remove programs, though the application and data files are installed. Trying to run the new installer shows a dialog reading "The system administrator has set policies to prevent this installation". This is not true, we have set no policies on this machine, and there are no Windows Installer policies in the Group Policy panel of Windows Management Console.

We tried logging on to this machine with an administrator account, and see the same thing.

My current theory is that the application was installed under an account that was later deleted, and only that user can uninstall the app. But why can an administrator not uninstall the app? Is there some way to have the installer remove the old app, regardless of who installed it?

Additional information:

I am not asking how a user can uninstall the app; we create the installer and I want to know how our deployment project can detect and handle this situation.

A technician logged on to the affected machine as an administrator and says the app does appear in the Add/Remove control panel but there's no Remove button, selecting it shows app info but no buttons.

I do not know for sure if the app was originally installed by a deleted user, this is a guess based on the fact user accounts were recently changed on this machine.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T02:08:03.460

I suggest using [MSIZAP](http://msdn.microsoft.com/en-us/library/aa370523.aspx "Windows Installer Cleanup Utility") to force removal of the entry, however that won't delete any existing files that might be lying around but simply removes the windows installer entries for the application.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T00:46:47.490

好吧，这不是答案，只是为了帮助诊断；您可以查看下面的注册表项，看看是否有您的应用程序的条目？这是添加/删除程序的填充方式：

HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-14T00:45:27.027

以及你自己解释。安装程序时必须检查安装是否在正确的条件下完成。所以安装后，让程序检查是谁安装的。或者在安装前触发一些代码进行检查（安装程序包编辑器）

我还看到您谈论与互联网断开连接.. 奇怪的是，他们是否也与 LAN 网络断开连接？如果是这样，它可能会在更多地方出错，甚至可能是注册表损坏的简单案例。

# .net - 带有加载程序集状态的启动画面

> ID：404290
> 
> 赞同：2
> 
> 时间：2008-12-31T23:47:30.573
> 
> 标签：.net, vb.net, initialization

我正在尝试创建一个显示程序集（所有引用的库）加载状态的初始屏幕。我使用 AppDomain.AssemblyLoad AssemblyLoadEventHandler 委托来捕获正在加载的程序集，但问题是程序初始化时未触发事件。我尝试在应用程序启动“MyApplication_Startup”中注册事件处理程序，但它不起作用。这是我的测试代码：

```
 Partial Friend Class MyApplication

    Private Sub MyApplication_Startup(ByVal sender As Object, ByVal e As Microsoft.VisualBasic.ApplicationServices.StartupEventArgs) Handles Me.Startup
        AddHandler AppDomain.CurrentDomain.AssemblyLoad, AddressOf MyAssemblyLoadEventHandler
    End Sub

    Sub MyAssemblyLoadEventHandler(ByVal sender As Object, ByVal args As AssemblyLoadEventArgs)
        Console.WriteLine(">>> ASSEMBLY LOADED: " + args.LoadedAssembly.FullName)
        Console.WriteLine()
    End Sub

End Class 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T14:57:06.327

您将遇到的一个问题是 .Net 中的程序集在需要时才会加载。

例如，创建一个包含“Hello World”类的新程序集，使用任何可执行文件引用它，然后从工作目录中删除新程序集，您将不会注意到它已被加载。

接下来，在按钮单击事件上，初始化“Hello World”类，将程序集从工作目录中删除，单击按钮时将收到无法找到程序集的错误。

这是 .Net 中第一次数据库访问通常很慢的关键原因，并且对它有一种“加速”的感觉（你使用它的次数越多，它变得越快），那是因为你在数据层中使用的对象是在访问它们之前不会加载到运行时中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T00:11:52.597

嗯，我不确定 VB 语法，但在 C# 中，我会将它放在程序的 Main(...) 中：

```
static void Main(string[] args)
{
    AppDomain.CurrentDomain.AssemblyLoad += new AssemblyLoadEventHandler(CurrentDomain_AssemblyLoad);
}

static void CurrentDomain_AssemblyLoad(object sender, AssemblyLoadEventArgs args)
{
    Console.WriteLine("Loaded " + args.LoadedAssembly.FullName);
} 
```

**更新：**使用反射器，VB 语法似乎是：

```
Private Shared Sub Main(ByVal args As String())
    AddHandler AppDomain.CurrentDomain.AssemblyLoad, New AssemblyLoadEventHandler(AddressOf Program.CurrentDomain_AssemblyLoad)
End Sub

Private Shared Sub CurrentDomain_AssemblyLoad(ByVal sender As Object, ByVal args As AssemblyLoadEventArgs)
    Console.WriteLine(("Loaded " & args.LoadedAssembly.FullName))
End Sub 
```

# c# - C# MySQL 连接问题

> ID：404299
> 
> 赞同：1
> 
> 时间：2009-01-01T00:01:18.360
> 
> 标签：c#, .net, mysql

我现在使用的是 Visual Studio 2008 Pro Edition。我安装了带有 Visual Studio 集成的[Connector/Net 5.2 。](http://dev.mysql.com/downloads/connector/net/5.2.html)我重新启动了 Visual Studio，MySQL 数据库现在出现在数据提供者列表中。我输入了我的数据库信息，然后单击“测试连接”并成功，但是当我尝试关闭“添加连接”对话框时，出现错误：

```
Unable to find the requested .NET Framework Data Provider. It may not be installed. 
```

我错过了设置这个步骤吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T03:53:01.810

这是 VS 的 CTP 版本的问题，解决方案是[this](http://oakleafblog.blogspot.com/2007/03/orcas-march-ctp-on-vista-database.html)。

即使您运行的是 RTM 版本，也可能值得检查您的配置文件。

# c++ - 有没有办法为整个解决方案的 Visual Studio 设置编译指示禁用警告？

> ID：404311
> 
> 赞同：4
> 
> 时间：2009-01-01T00:12:08.073
> 
> 标签：c++, visual-c++, pragma

有没有办法为整个解决方案的 Visual Studio 设置编译指示禁用警告？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T00:16:02.277

使用[/w 编译器开关](https://msdn.microsoft.com/en-us/library/thxezb7y(v=vs.140).aspx)来抑制每个项目。如果不选择所有项目并将其添加到每个项目的命令行（可以在一个操作中完成），我不知道有任何方法可以在解决方案范围内进行。

# c# - 使用 C# 优化将数据导入 SQL Server 2005

> ID：404313
> 
> 赞同：1
> 
> 时间：2009-01-01T00:13:10.240
> 
> 标签：c#, sql-server, sql-server-2005

我有一张表，里面有大约 1/2 百万条记录。

每个月我们要导入大约 1/2 百万条记录。这些当前被推到数据库中的另一个表中，但最终将直接从 txt 文件加载。对于这些新记录中的每一个，我必须确定我们是否已经拥有该记录，如果没有，则需要插入它。但是，如果我们确实有记录，则需要对其进行更新。这些更新的逻辑包含 C# 代码。

AC# 命令行程序正在处理这些新数据的导入，因此现在有 1/2 百万个选择语句 - 每条记录一个。然后，会生成一堆（同样大约 1/2 百万）插入和更新语句并针对数据库运行。

在我的工作站上运行大约需要 6 个小时。您对如何加快速度有任何想法吗？我需要运行大约 60 次这样的大型导入，以使数据库达到当前月份，然后每月加载一次新数据。

我认为可以改进的一个领域是 1/2 百万选择语句。也许我可以发出一个选择语句来获取所有行，并将它们存储在内存中，然后搜索它。我可以为此使用列表，还是有更好的课程？我必须根据两个属性（或数据库字段）进行搜索。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T00:18:51.227

查看 .NET Framework 2.0 的[SqlBulkCopy](http://blogs.msdn.com/nikhilsi/archive/2008/06/11/bulk-insert-into-sql-from-c-app.aspx)类。

MSDN[参考](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T00:20:59.960

是的，将逻辑移动到单个存储过程中，该过程将批量插入临时表（没有日志记录，然后在两个单独的语句中处理临时表中的所有记录......对确实存在的所有记录进行一次更新在desti表中，并为所有没有的人插入一个

```
 Update DestTable Set
       ColName = T.ColName,
       [repeat for all cols]
    From TmpTable T Join DestTable D On D.Pk = T.Pk

    Insert DestTable(ColList)
    Select [ColList]
    From TmpTable T
    Where Not Exists (Select * From DestTable
                      Where pk = T.Pk) 
```

如果这会为您的事务日志创建太大的事务，请将其分成更小的块

# java - 以编程方式转码 MPEG-2 视频

> ID：404322
> 
> 赞同：2
> 
> 时间：2009-01-01T00:20:06.700
> 
> 标签：java, video, ffmpeg, mpeg, transcoding

我需要能够以编程方式将 mpeg-2 文件转码为 .mp4、.mp3、.wmv、.rm（可选）和 .flv（可选），并希望还能生成缩略图。我找到了 Java Media Framework，但坦率地说，它看起来很糟糕。这将运行一个 Linux 服务器，所以我可以使用 Commons Exec 来使用 ffmpeg - ffmpeg 是否完成了我需要做的所有事情？FFmpeg 看起来相当令人生畏，这就是为什么我很难找到这些信息，但它绝对似乎是万事通。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T00:47:50.870

ffmpeg 是最好和最简单的。输出/转换视频：

```
ffmpeg -i {input}.ext -r {target_frame_rate} -ar {target_audio_rate} -b {target_bitrate} -s {width}x{height} {target}.ext 
```

还有你的截图：

```
ffmpeg -i {input}.ext -r 1 -ss 00:00:04:005 -t 00:00:01 -an -s {width}x{height} {target_name}%d.jpg 
```

flv 的标准是 15 fps，flv 的音频采样率应该是 44100。使用选项：`-r`指定 1 fps 的帧速率（一帧用作屏幕截图），`-ss`寻找您想要的位置`hh:mm:ss:fff`，`-t`是持续时间（一秒以匹配您的 1 fps），`-an`告诉 ffmpeg 忽略音频，并且`-s`是大小的截图。这`%d`是必要的，因为它将是您使用的屏幕截图数量递增的数字。有了上面，`%d`将永远是数字 1（一帧，一张截图）。祝你好运。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T00:45:32.513

[encoding.com](http://www.encoding.com/)的一个有趣的网络服务将为您转码文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-11T22:42:48.850

您也可以直接从 Java 中使用[Xuggler](http://www.xuggle.com/xuggler)，它提供了比 JMF 更好的编解码器和编码支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T00:35:35.063

Linux 上流行的转码应用程序是 ffmpeg、[transcode](http://www.transcoding.org/cgi-bin/transcode)和[mencoder](http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html)。transcode 和 mencoder 都使用 ffmpeg，这三个都可以处理您需要的任务，包括 FLV 转码和视频缩略图。ffmpeg 可能是这三个中最受欢迎的，因此您可能会找到更好的在线支持。另外值得一提的是ffmpeg支持多线程转码。

我建议使用 ffmpeg。

# .net - 在.Net中将url转换为超链接的正则表达式

> ID：404332
> 
> 赞同：2
> 
> 时间：2009-01-01T00:35:11.193
> 
> 标签：.net, regex

在我的 ASP.NET 应用程序中，我想使用正则表达式将 URL 更改为用户帖子中的超链接，例如：

```
http://www.somesite.com/default.aspx 
```

至

```
<a href="http://www.somesite.com/default.aspx">http://www.somesite.com/default.aspx</a> 
```

使用 Regex.Replace() 相当容易，但我遇到的问题是，如果 URL 太长，我想截断链接文本，例如：

```
http://www.somesite.com/files/default.aspx?id=a78b38ae723b1f8ed232c23de7f9121d&n=93b34a732e074c934e32d123de19c83d 
```

至

```
<a href="http://www.somesite.com/files/default.aspx?id=a78b38ae723b1f8ed232c23de7f9121d&n=93b34a732e074c934e32d123de19c83d">http://www.somesite.com/files/default.aspx?id=a78b38ae723b1f8...</a> 
```

使其显示如下：

```
http://www.somesite.com/files/default.aspx?id=a78b38ae723b1f8... 
```

我尝试使用 Regex.Matches() 但我不知道如何替换文本，有什么建议吗？

谢谢你的帮助 ...

编辑：没关系，伙计们，我自己想出来的，结果非常简单，我只是使用了[MatchEvaluator](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.matchevaluator.aspx)！

```
public static string Replace(
    string input,
    string pattern,
    MatchEvaluator evaluator
) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T00:38:01.297

这是[JUST 使用 Regex 试图做太多事情的](http://msmvps.com/blogs/jon_skeet/archive/2005/09/21/67247.aspx)一个例子。我建议使用正则表达式来查找模式，但使用代码逻辑来根据自己的喜好调整输出。输出带有替换的新模式并不难，但试图控制链接文本的长度太过分了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T00:38:19.767

AFAIK 对此没有开箱即用的支持。您确实必须遍历`Regex.Matches()`自己并自己进行替换（通过 string.Replace 或 StringBuilder），在需要的地方截断文本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T01:52:30.443

您可以通过检查超链接（通过正则表达式）来完成转换，然后执行类似的操作...

```
string displayText = url.Substring(0, maxLength);
string hyperlink = string.Format("<a href=\"{0}\">{1}</a>", url, displayText); 
```

# php - 使用 PHP + SimpleXML 抓取...我可以抓取图像但不能抓取原始文本？

> ID：404344
> 
> 赞同：2
> 
> 时间：2009-01-01T00:50:06.717
> 
> 标签：php, screen-scraping, simplexml

我正在尝试从网站上获取特定的原始文本。通过使用这个站点和其他资源，我学会了如何使用 simpleXML 和 xpath 获取特定图像。

然而，相同的方法似乎不适用于抓取原始文本。这是现在不起作用的东西。

```
// first I set the xpath of the div that contains the text I want
$xpath = '//*[@id="storyCommentCountNumber"]';

// then I create a new DOM Document
$html = new DOMDocument();

// then I fetch the file and parse it (@ suppresses warnings).
@$html->loadHTMLFile($url);

// then convert DOM to SimpleXML
$xml = simplexml_import_dom($html);   

// run an XPath query on the div I want using the previously set xpath
$commcount = $xml->xpath($xpath);
print_r($commcount); 
```

现在，当我抓取图像时，该 commcount 对象将返回一个数组，其中包含其中某处的图像源。

在这种情况下，我希望该对象返回包含在“storyCommentCountNumber”div 中的原始文本。但该文本似乎不包含在对象中，只是 Div 的名称。

我究竟做错了什么？我可以看到这种方法仅用于抓取 HTML 元素及其内部的位，而不是原始文本。如何获取该 div 中的文本？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T20:12:22.100

需要注意的一件事是，当您在 SimpleXML 对象上使用 print_r 或 var_dump 时，您不会看到对象的“文本”（或有时是属性）。因此，要查看*所有内容*，您应该使用 $variable->AsXml() 输出完整的 XML 字符串。

要获取文本，您需要将 SimpleXml 对象转换为字符串。这会自动拉出 innerText。

```
 /* remember $commcount is always an array from the xpath */
 foreach($commcount as $str)
 {
     echo (string)$str;
 } 
```

希望以上内容能给你一个开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T15:24:23.763

我知道您正在尝试使用 SimpleXML，但我认为使用正则表达式获取原始文本会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T19:58:08.147

您能否包含 HTML 示例（可能包括您选择的元素之前和之后的几行？）和 print_r() 的输出？

您可以尝试以下方法，看看是否对您有帮助：

```
if ( count($commcount) > 0 ) {
    $divContent = $commcount[0]->asXml();
    print $divContent;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T15:33:39.207

div 内的原始文本不是 div 元素本身的一部分，而是 div 元素的第一个子节点的一部分。div 中应该有一个文本节点，其中包含您要查找的数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T01:12:26.407

尝试检查[此](http://us.php.net/manual/en/class.domelement.php#86803)页面。

:)

# python - 计算谐波级数的Python程序

> ID：404346
> 
> 赞同：8
> 
> 时间：2009-01-01T00:55:16.753
> 
> 标签：python, math

有谁知道如何用 Python 编写一个程序来计算谐波级数的加法。即 1 + 1/2 +1/3 +1/4...

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-01T10:47:42.720

[@Kiv 的答案](https://stackoverflow.com/questions/404346/python-program-to-calculate-harmonic-series#404425)是正确的，但如果您不需要无限精度，那么对于大 n 来说它会很慢。在这种情况下最好使用[渐近公式：](http://en.wikipedia.org/wiki/Harmonic_number)

![谐波数的渐近展开](https://upload.wikimedia.org/math/0/5/1/0516d4c5d9a19f09ffcfc04a6a596928.png)

```
#!/usr/bin/env python
from math import log

def H(n):
    """Returns an approximate value of n-th harmonic number.

       http://en.wikipedia.org/wiki/Harmonic_number
    """
    # Euler-Mascheroni constant
    gamma = 0.57721566490153286060651209008240243104215933593992
    return gamma + log(n) + 0.5/n - 1./(12*n**2) + 1./(120*n**4) 
```

[@Kiv](https://stackoverflow.com/questions/404346/python-program-to-calculate-harmonic-series#404425)对 Python 2.6 的回答：

```
from fractions import Fraction

harmonic_number = lambda n: sum(Fraction(1, d) for d in xrange(1, n+1)) 
```

例子：

```
>>> N = 100
>>> h_exact = harmonic_number(N)
>>> h = H(N)
>>> rel_err = (abs(h - h_exact) / h_exact)
>>> print n, "%r" % h, "%.2g" % rel_err
100 5.1873775176396242 6.8e-16 
```

在`N = 100`相对误差较小时`1e-15`。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-01T02:31:41.973

[@recursive 的解决方案](https://stackoverflow.com/questions/404346/python-program-to-calculate-harmonic-series#404354)对于浮点近似是正确的。如果您愿意，您可以使用 fractions 模块在 Python 3.0 中获得准确的答案：

```
>>> from fractions import Fraction
>>> def calc_harmonic(n):
...   return sum(Fraction(1, d) for d in range(1, n + 1))
...
>>> calc_harmonic(20) # sum of the first 20 terms
Fraction(55835135, 15519504) 
```

请注意，位数增长很快，因此对于较大的 n，这将需要大量内存。如果您想获得真正的幻想，您还可以使用生成器来查看一系列部分和。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-01T05:35:22.633

只是使用浮点的其他答案的脚注；从最大的除数开始**向下**迭代（朝着具有最大值的倒数）将尽可能地推迟累积的舍入误差。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-12-29T04:12:19.273

可以使用 digamma 函数计算 H 函数的快速、准确、平滑、复值版本，如此处[所述](https://en.wikipedia.org/wiki/Harmonic_number#Generalization_to_the_complex_plane "这里")。Euler-Mascheroni (gamma) 常数和 digamma 函数分别在 numpy 和 scipy 库中可用。

```
from numpy import euler_gamma
from scipy.special import digamma

def digamma_H(s):
    """ If s is complex the result becomes complex. """
    return digamma(s + 1) + euler_gamma

from fractions import Fraction

def Kiv_H(n):
    return sum(Fraction(1, d) for d in xrange(1, n + 1))

def J_F_Sebastian_H(n):
    return euler_gamma + log(n) + 0.5/n - 1./(12*n**2) + 1./(120*n**4) 

```

下面是速度和精度的三种方法的比较（以Kiv_H为参考）：

`Kiv_H(x) J_F_Sebastian_H(x) digamma_H(x) x seconds bits seconds bits seconds bits 1 5.06e-05 exact 2.47e-06 8.8 1.16e-05 exact 10 4.45e-04 exact 3.25e-06 29.5 1.17e-05 52.6 100 7.64e-03 exact 3.65e-06 50.4 1.17e-05 exact 1000 7.62e-01 exact 5.92e-06 52.9 1.19e-05 exact`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-01T01:02:21.793

谐波级数发散，即其和为无穷大。

编辑：除非您想要部分金额，但您对此并不十分清楚。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-01T00:59:15.217

这应该可以解决问题。

```
def calc_harmonic(n):
    return sum(1.0/d for d in range(2,n+1)) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-01T01:00:40.113

这个怎么样：

```
partialsum = 0
for i in xrange(1,1000000):
    partialsum += 1.0 / i
print partialsum 
```

其中 1000000 是上限。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T01:06:44.843

家庭作业？

这是一个发散的系列，因此不可能对所有术语进行总结。

我不懂 Python，但我知道如何用 Java 编写它。

```
public class Harmonic
{
    private static final int DEFAULT_NUM_TERMS = 10;

    public static void main(String[] args)
    {
        int numTerms = ((args.length > 0) ? Integer.parseInt(args[0]) : DEFAULT_NUM_TERMS);

        System.out.println("sum of " + numTerms + " terms=" + sum(numTerms));
     }

     public static double sum(int numTerms)
     {
         double sum = 0.0;

         if (numTerms > 0)
         {
             for (int k = 1; k <= numTerms; ++k)
             {
                 sum += 1.0/k;
             }
         }

         return sum;
     }
 } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-01-30T05:05:37.933

使用简单的 for 循环

```
def harmonicNumber(n):
x=0
for i in range (0,n):
    x=x+ 1/(i+1)
return x 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-18T09:07:26.277

通过使用该`numpy`模块，您还可以选择使用：

```
import numpy as np
def HN(n):
    return sum(1/arange(1,n+1)) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-05-20T10:55:03.660

我添加了另一个解决方案，这次使用递归来找到第 n 个谐波数。

### 一般实施细节

**函数原型：** `harmonic_recursive(n)`

**功能参数：** `n` -第n次谐波数

**基本情况：**如果`n`等于`1`返回 1。

**重复步骤：**如果不是基本情况，请调用`harmonic_recursive`该`n-1`术语并将该结果与`1/n`. 这样，我们每次将谐波级数的第 i 项与直到该点的所有先前项的总和相加。

### 伪代码

*（这个解决方案也可以很容易地用其他语言实现。）*

```
harmonic_recursive(n):
    if n == 1:
        return 1
    else:
        return 1/n + harmonic_recursive(n-1) 
```

### Python代码

```
def harmonic_recursive(n):
    if n == 1:
        return 1
    else:
        return 1.0/n + harmonic_recursive(n-1) 
```

# c# - C# 对象、接口和数据库

> ID：404368
> 
> 赞同：1
> 
> 时间：2009-01-01T01:04:44.363
> 
> 标签：c#, database, object, interface

在使用对象和接口时，写入数据库的最佳实践是什么？关于对象设计有很多意见，但我不清楚数据库端。一个简单的例子：

假设一个 Contact 基类包含常用字段，例如联系人姓名（Bill、Fred、Sally）和位置（家庭、工作等）。添加一个 IPhone 接口（区号、电话号码、分机）和一个 IEmail 接口（电子邮件地址，cc）以抽象出差异。然后创建继承自这些的类（电话、电子邮件），如下所示：

```
    电话：联系方式，IPhone
    电子邮件：联系方式，IEMail

```

另一种方法是创建一个 IContact 接口而不是 Contact 基类，如下所示：

```
    电话：IContact、iPhone
    电子邮件： IContact、IEMail

```

如果这些对象被写入单个数据库表，那么没有实现 NHibernate 或实体框架，那么数据访问代码的最佳实践是什么？我所看到的似乎相当笨拙。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T01:19:28.467

根据我的经验，当涉及到数据库时，如果您想要获得任何表面上的性能，则必须首先考虑良好的关系设计。之后，我的模型就很简单了：一张桌子，一个班级。如果我有自引用关系，我会创建另一个直接从原始类派生的类。连接被定义为对象列表（例如，订单有一个订单详细信息列表）。

完成此操作后，我将使用能够反映这些类并动态生成所需 SQL 的 DAL；分析后，我可能必须创建一些 SP，但其结果也会发送到接收 DTO。

到目前为止，我还没有遇到任何使用接口的理由。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T05:02:38.440

听起来您要建模的是电话联系人和电子邮件联系人，但我认为您真正拥有的是具有主要联系方式的联系人：电话或电子邮件。我构建它的方式是组合——假设您希望灵活地拥有多个电话号码/电子邮件。如果每个人都可以使用一个，则可以将其直接存储在联系人表中。如果您需要多个地址，则使用与电话/电子邮件相同的方式处理它，并使用单独的表格。

```
联系人表
     联系人 ID
     名
     姓
     心肌梗死
     街道地址1
     街道地址2
     城市
     州省
     邮政编码
     PreferredContactMethod（0 = 电话，1 = 电子邮件）
     ... 更多细节 ...

电话号码表
     电话号码
     联系人 ID
     电话号码
     是主要的
     ...更多细节...

电子邮件地址表
     电子邮件ID
     联系人 ID
     电子邮件地址
     是主要的
     ...更多细节...

```

那么对于您的类，您将有一个 Contact 类，其中包含一个或多个 PhoneNumbers 和一个或多个 EmailAddresses。如果除了联系人以外，您还有其他东西有电话号码或电子邮件地址，那么让界面指示它们是 IPhoneable 或 IEmailable 可能是有意义的——这意味着您可以从中添加/删除电话号码或电子邮件地址，就像这样：

```
public interface IPhoneable
{
     public PhoneNumber GetPrimaryNumber();
     public void AddNumber( PhoneNUmber number );
     public IEnumerable<PhoneNumber> GetNumbers();
}

public interface IEmailable
{
     public EmailAddress GetPrimaryAddress();
     public void AddEmailAddress( EmailAddress address );
     public IEnumerable<EmailAddress> GetEmailAddresses();
}

public class Contact : IPhoneable, IEmailable
{
     private List<PhoneNumber> phoneNumbers;
     private List<EmailAddresses> emailAddresses;

     public int ContactID { get; private set; }
     public string FirstName { get; set; }
     ...

     public Contact()
     {
         this.phoneNumbers = new List<PhoneNumber>();
         this.emailAddresses = new List<EmailAddress>();
     }

     public PhoneNumber GetPrimaryNumber()
     {
          foreach (PhoneNumber number in this.phoneNumbers)
          {
               if (number.IsPrimary)
               {
                    return number;
               }
          }
          return null;
      }

      ...
} 
```

如果你愿意，你可以有一个 PhoneableContact 和一个 EmailableContact ，它们可以从 Contact 子类化，并且可以根据首选的联系方法进行区分，但我真的不认为有必要这样做。如果你这样做了，那么 Contact 将不会实现任何一个接口——子类将分别实现适当的接口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T01:21:45.407

我想你需要考虑这三个实体之间的关系。大声说出以下陈述，看看哪些陈述对您的应用程序是正确的：

*   `Phone` *是*一个`Contact`
*   `Phone` *有*一个`Contact`

就您在此处发布的内容而言，听起来您可以通过使用第二个选项来大大降低应用程序的复杂性。

但是，您想知道数据访问，并且您提到有一个单一的数据库表，这让我想知道为什么您需要单独的实体`Contact`,`Phone`和`Email`. 我建议您重构代码以包含单个实体来表示您的数据模型，因为这将降低代码库的复杂性，或者重构您的数据库模式以反映您真正想要的内容（基于您的示例代码）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T02:46:42.910

首先构建您的数据库，这样您就可以确定您实际上可以存储您需要的所有内容。然后构建常见查询，例如“所有客户及其主要电话号码”和“单个客户及其所有电话号码”。

这将暴露出明显的问题，例如没有足够的电话号码字段或无法指示真实电话号码。

您的数据库的使用时间至少是您的应用程序的三倍，并且很难更改，因此请确保从一开始就正确使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T11:28:17.617

在这种情况下......我认为最好的选择是使用数据库对象，如 DB4O。

“Db4o 是开放源代码对象数据库，它使 Java 和 .NET 开发人员能够存储和检索任何应用程序对象，包括主题图，只需一行代码，无需预定义或维护单独的、严格的数据模型。”

[http://www.db4o.com/](http://www.db4o.com/)

# php - Fixing malformed HTML in PHP?

> ID：404377
> 
> 赞同：6
> 
> 时间：2009-01-01T01:14:16.200
> 
> 标签：php, html, parsing

I am constructing a large HTML document from fragments supplied by users that have the annoying habit of being malformed in various ways. Browsers are robust and forgiving enough but I want to be able to validate and (ideally) fix any malformed HTML if at all possible. For example:

```
<td><b>Title</td> 
```

can be reasonably fixed to:

```
<td><b>Title</b></td> 
```

Is there a way of doing this easily in PHP?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-01T01:16:45.523

You can use [HTML Tidy](http://devzone.zend.com/article/761-Tidying-up-your-HTML-with-PHP-5), man pages are [here](http://au.php.net/tidy).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-04T13:41:28.303

I highly recommend [HTML Purifier](http://htmlpurifier.org/). From their site:

> HTML Purifier is a standards-compliant HTML filter library written in PHP. HTML Purifier will not only remove all malicious code (better known as XSS) with a thoroughly audited, secure yet permissive whitelist, it will also make sure your documents are standards compliant, something only achievable with a comprehensive knowledge of W3C's specifications. Tired of using BBCode due to the current landscape of deficient or insecure HTML filters? Have a WYSIWYG editor but never been able to use it? Looking for high-quality, standards-compliant, open-source components for that application you're building? HTML Purifier is for you!

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-04T13:36:56.020

If you can't use Tidy (sometimes hosting service do not activate this php module), you can use this PHP class: [http://www.barattalo.it/html-fixer/](http://www.barattalo.it/html-fixer/)

# asp.net-mvc - 是否可以为 ASP.NET MVC 用户控件提供与页面不同的模型

> ID：404379
> 
> 赞同：1
> 
> 时间：2009-01-01T01:14:52.800
> 
> 标签：asp.net-mvc, user-controls

我有一个从具有一些属性的模型对象（订单）呈现的订单页面。Order 对象的属性之一是

```
public List<OrderItem> Items { get; set; }; 
```

另一个是

```
public List<OrderComment> Comments { get; set; }; 
```

我的主页是这样声明的：

```
public class OrderView : ViewPage<Order> 
```

我想为每个 OrderItem 设置一个用户控件（名为 OrderItemControl），为每个 OrderComment 设置另一个用户控件（名为 OrderCommentControl）。如果我可以为每个集合使用中继器，那就太好了，但我遇到了问题。我希望我的用户控件声明如下所示：

```
public class OrderItemControl : ViewUserControl<OrderItem>
public class OrderCommentControl : ViewUserControl<OrderComment> 
```

当我尝试执行此操作时出现错误：

{“传入字典的模型项是'Order'类型，但是这个字典需要'OrderItem'类型的模型项。”}

我猜转发器可能不是正确的方法，但我真的希望每个用户控件都有一个 OrderItem 或 OrderComment 类型的模型，而不仅仅是 Order。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T02:42:08.223

是的。使用`RenderPartial`您可以使用提供模型的签名并简单地使用当前视图中可用的任何模型对象。

```
<% foreach (OrderItem orderItem in ViewData.Model.OrderItems)
   {
 %>
       <%= Html.RenderPartial( "OrderItem", orderItem, ViewData ) %>
<% } %> 
```

您可以在[http://www.codeplex.com/aspnet](http://www.codeplex.com/aspnet)上查看实际源代码。单击 Source 选项卡并向下导航到 MVC 源树。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T01:42:44.240

确保渲染用户控件的调用将正确的数据传递给 Render 函数。

（我对 ViewData 的当前对象模型的记忆很模糊，但应该很接近）。

请参阅 [Rob Conery 的这篇旧帖子](http://blog.wekeroad.com/2008/01/07/aspnet-mvc-using-usercontrols-usefully/)

# javascript - 通过 jQuery 检查以查看在 HTML 选择列表中选择了哪些项目

> ID：404391
> 
> 赞同：3
> 
> 时间：2009-01-01T01:30:51.363
> 
> 标签：javascript, jquery

如何获取 HTML 选择框中所选项目的实际值（或文本）？以下是我尝试过的主要方法...

```
 document.getElementById('PlaceNames').value 
```

```
 $("#PlaceNames option:selected").val() 
```

```
 $("#PlaceNames option:selected").text() 
```

我已经尝试了这些变化。我最终想要做的就是获取该数据并通过 AJAX 将其发送到 Web 服务，我只需要用户选择的字符串表示形式。这似乎应该很容易，我什至在这里找到了一个与此类似的问题，但我仍然无法解决问题。谷歌似乎也没有帮助。我觉得这一定是由于对 Javascript 和 jQuery 的一些基本误解。

编辑：我应该提到我正在使用 IE7

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T01:46:05.043

`$('#placeNames').val()`返回最新版本 jQuery 中选定选项的[值](http://docs.jquery.com/Attributes/val)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T01:38:46.977

非 jQuery 变体：

```
var select = document.getElementById('PlaceNames');
var value = select.options[select.selectedIndex].value; 
```

较旧的 jQuery 变体：

```
var select = $('#PlaceNames:first')[0];
var value = select.options[select.selectedIndex].value; 
```

当前的 jQuery 变体：

```
var value = $('#PlaceNames:first').val(); 
```

我可能只是使用 :first 过于安全。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T01:37:59.523

var plid = $('#PlaceNames').val();

val placename = $('#PlaceNames option[value=\''+plid.toString()+'\']').html();

# .net - ASP.Net MVC 中的 JsonResult 又名 Json 函数中的控制序列化程序？

> ID：404393
> 
> 赞同：5
> 
> 时间：2009-01-01T01:37:20.973
> 
> 标签：.net, asp.net-mvc, json, serialization

有没有办法配置通过控制器中的 JsonResult 返回 JSON 时使用的 JSON 序列化程序：

```
public ActionResult SomeJsonFunction()
{
  var x = SomeModelCode.SomeModelFunction();
  return Json(x);
} 
```

看起来默认是[JavaScriptSerializer](http://JavaScriptSerializer)。我希望能够使用 DataContractJsonSerializer，但找不到任何有关如何执行此操作的文档。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T03:29:08.160

检查[源代码](http://www.codeplex.com/aspnet)以查看 JsonResult 是如何实现的。使用您的 DataContractJsonSerializer 实现从 ActionResult 派生。现在使用 Json() 辅助方法并不容易，但是您可以在层超类型控制器中创建自己的辅助方法。您的新辅助方法将返回您的新 ActionResult 派生。

# sqlite - 使用 AIR 应用程序安装默认数据库

> ID：404412
> 
> 赞同：2
> 
> 时间：2009-01-01T02:12:05.087
> 
> 标签：sqlite, air

我想发布一个默认的 SQLite 数据库，在一个表中包含一些预定义的键/值对，以及一个 Adob​​e AIR 应用程序。实现这一目标的最佳方法是什么？在我看来，这就像更新 xml 文件并重建应用程序一样简单。我遇到过这个[解决方案](http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&productId=4&postId=10483)，但对我来说它看起来有点骇人听闻（必须将数据库复制到另一个位置）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T03:34:33.907

一种可能的方法是在 AIR 应用程序中编写一些代码，该代码使用应该存在的初始数据生成数据库。此代码只能在程序第一次运行时执行，或者如果数据库不存在。

# macos - 如何让方案解释器在 Emacs 中工作？

> ID：404421
> 
> 赞同：16
> 
> 时间：2009-01-01T02:26:41.687
> 
> 标签：macos, emacs, scheme, interpreter, sicp

我正在通过 SICP，我希望有一个类似于交互式 Python 解释器的解释器，以便在我观看讲座和阅读本书时玩。此外，我希望这个解释器在 Emacs 中运行，这样我就可以在方案代码文件和交互式解释器等之间来回跳转。

但是，我对 Emacs 还很陌生，到目前为止还不能让它工作或找到一套清晰的指令来让它工作。

似乎我应该能够设置它，以便`M-x run-scheme`打开一个交互式解释器，至少听起来正是我想要的，但目前这只是返回`Searching for program: no such file or directory, scheme`，我无法弄清楚我到底是什么文件需要在哪里解决这个问题。

我正在`GNU Emacs 22.1.1 (mac-apple-darwin, Carbon Version 1.6.0)`通过 OS X 10.5 安装 DVD 安装。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-01T02:28:55.287

你需要安装一个像 MIT Scheme 这样的 Scheme 解释器（这是通过 SICP 练习的推荐实现）。在 Ubuntu 上，它带有一个名为“scheme”的符号链接，这是 Emacs 正在寻找的。[您可以在此处](http://www.gnu.org/software/mit-scheme/)为 MacOS X 下载它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-01T04:20:11.473

`M-x customize-group`，然后告诉它您要自定义`scheme`。稍微向下浏览一下页面，您会看到“方案程序名称”，如果您的方案解释器没有被调用，您可以更改它`scheme`。

您可能还会发现 Quack 很有用 - [http://www.neilvandyke.org/quack/](http://www.neilvandyke.org/quack/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-01T02:31:22.753

即使它不在 emacs 中运行，您也可能需要考虑运行[PLT Scheme](http://plt-scheme.org/)，这是一个世界级的 Scheme 编程环境，设计有许多工具来帮助人们学习 Scheme。由于您对 emacs 还很陌生，因此可能值得切换。（并查看 PLT Schemers 的书，[如何设计程序](http://htdp.org/)。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-03T10:06:47.223

查找与 Emacs 捆绑的 cmuscheme 包的描述 - 它提供代码评估等。 Quack 也非常有用

PS 我计划（在接下来的 2 天内）将关于“Emacs 作为 IDE”的文章的第二部分上传[到我的网站](http://xtalk.msk.su/~ott/en/writings/emacs-devenv/)，该部分将描述 Emacs 中的方案支持

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-03T10:58:41.797

去年 11 月，我曾担任您的职务。我终于让它工作并给自己写了方向。具有讽刺意味的是，昨天我决定将它作为[我的第一篇文章](http://circulardependencies.wordpress.com/2009/01/02/how-to-scheme-in-emacs/)发布在我的网站上。这是在 Ubuntu 中设置 Scheme 的说明，但它可能是一个方便的参考，以防你遇到问题。如果不出意外，其他人可能会发现这个问题并觉得它很有用。希望能帮助到你。

# regex - 你用正则表达式做什么？

> ID：404430
> 
> 赞同：10
> 
> 时间：2009-01-01T02:39:17.060
> 
> 标签：regex, language-agnostic

我听说过正则表达式，并且只看到过一些用例，所以我不打算经常使用它们。在过去，我做了几件事，我花了几个小时才完成。后来我和某人交谈，他们说“这是使用正则表达式的方法”。

那么，您使用正则表达式的目的是什么？如果我得到更多示例，那么也许我可以开始知道何时寻找和使用它们。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-01T02:48:28.867

很多东西。包含：

*   检查命令行
*   解析用户输入
*   解析各种文本文件
*   检查 Web 服务器日志
*   检查测试结果
*   在电子邮件中查找文本
*   读取配置文件

在学习正则表达式时，学习克制可能会有所帮助。您可能会像我一样倾向于将正则表达式视为解决太多问题的方法。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-01T03:46:28.233

我使用正则表达式的最后一件事是验证文本输入以确保输入字符串符合某些规则，例如第二个字符必须是“-”。

我读了你的问题并立即想到了这一点。

![替代文字](https://imgs.xkcd.com/comics/regular_expressions.png)

编辑：忘了提到这是一部 XKCD 漫画。 [http://xkcd.com/208/](http://xkcd.com/208/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-01T02:46:21.367

最常见的用例是查找与模式匹配的字符串。通常，搜索与将匹配模式的文本替换为另一个字符串相结合。

例如，下面的表达式将匹配行首的空格（在这种特殊情况下只是空格和制表符）。

```
^[ \t]+ 
```

如果您想修剪该空白，这可能很有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-01T03:00:33.007

我将使用正则表达式的症结是：

1.  输入验证
2.  清洁输入
3.  输入重组
4.  在输入中寻找子串

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-01T03:04:28.083

输入验证例程充当 Web 应用程序的第一道防线。正则表达式是验证输入的好方法。

如果您对输入的类型、长度、格式或范围做出毫无根据的假设，您的应用程序不太可能是健壮的。如果攻击者发现您做出了毫无根据的假设，输入验证可能会成为一个安全问题。然后，攻击者可以提供精心设计的输入，通过尝试 SQL 注入、跨站点脚本和其他注入攻击来破坏您的应用程序。为避免此类漏洞，您应该验证文本字段（例如姓名、地址、税号等）并使用正则表达式。

例如，您不只是为姓氏输入添加必填字段，而是使用以下表达式仅允许大写和小写字符以及某些名称共有的一些特殊字符。

^[a-zA-Z''-'\s]{1,40}$

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-01T02:50:10.283

好吧，任何时候你需要匹配一些东西，而仅仅匹配一个逐字单词是行不通的。重命名文件，在代码中搜索和替换，你命名它。

一个传统的示例可能是当您想要查找文件中所有出现的电话号码时。搜索单个数字显然是行不通的，仅搜索破折号可能会模棱两可。最好说“找到所有出现的 3 位数字，然后是短划线，然后是 4 位数字”（出于示例目的而保持基本；实际上，您可能想要匹配区号、不同的分隔符等）

正则表达式的另一个巧妙之处是它们允许您使用部分/全部您在替换中搜索的内容。因此，如果您想用其他东西替换所有区号 555，您可以，同时保持电话号码的其余部分完好无损。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-01T03:08:38.920

对于自学者，您可能想了解的有关正则表达式的所有信息等等：[http ://www.regular-expressions.info/](http://www.regular-expressions.info/)

这可能有助于理解为什么它们被称为“正则表达式”。它的“常规”部分意味着对模式有一些期望。它的“表达式”部分意味着它们在某种意义上是文本的数学表示，这反过来又允许您从文本中提取信息。

例如，我编写了一个模块，它使用正则表达式将电话号码拆分成它们的组成部分——例如国家、区号、交易所和车站。这对人类来说听起来很容易，但对于计算机来说，如果你考虑到有这么多写电话号码的方法，那就不是那么容易了。您可以拨打 +1(407)555-1234 或 407-555-1234 或 555-1234（7 位拨号）或 1.407.555.1234 或 4075551234。使用正则表达式有助于抽象处理某些事情时的文本您试图从文本中提取的内容。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-01T03:09:43.393

几年前，在 iPhone 出现之前，Windows Mobile 和 Palm PDA 上的网络浏览器确实非常有限。除非您拥有最新版本的 Windows Mobile，否则即使是 CSS 也是禁止使用的。因为我有一个带有精美无线附加卡的极客 PDA，我想用它上网而不是购买笔记本电脑，所以我创建了一个门户网站。我所做的其中一件事是一个页面，它可以对 HTML 的某些部分进行转换、删除和替换，可以是删除所有图像等通用操作，也可以是特定于站点的内容。这几乎都是用正则表达式完成的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-01T05:11:47.313

我经常使用它们，可能是因为我主要在 linux 环境中并且可以轻松访问它们。

*   在编辑器中搜索东西，特别是当我知道一行中的两个部分但不知道中间的部分时（请原谅无关的空格）
    *   带有小部件的 reval 函数在哪里？" `reval.*\<widget\<`"
    *   my_obj 分配到哪里？" `\<my_obj\>.*=`"
*   搜索和替换以生成数据文件的修改：即将所有交付量设置为一个“ `#<volume>[-0-9.]+</volume>#<volume>1.0</volume>`#g”
*   调整输出以适应屏幕（删除空白或无趣的字段）。
*   将数据文件转换为另一种格式，例如获取日志文件并为 gnuplot 生成用于绘制性能数据的文件。
*   对于编程用途，例如模式匹配数据值的名称，以便在它匹配某些最容易用正则表达式表示的标准时以不同方式处理它。

使用正则表达式后，我讨厌 Windows 的“查找”框，因为它是如此有限。

正如另一位用户回答的那样，正则表达式本质上是更强大的 globbing，但它们远不止于此。您无需阅读[“掌握正则表达式”](http://oreilly.com/catalog/9781565922570/)即可使用它们，但我确实推荐这本书。我确信互联网上有很多资源，例如[这里](http://www.regular-expressions.info/)，尽管我不能保证其中任何一个。

使用正则表达式（无论是在代码中还是在命令行中）的另一个优点是它们已经过大量优化。尤其是Grep 和[DFA 解析器](http://en.wikipedia.org/wiki/21st_Century_Compilers)几乎可以肯定比您自己编写的解析器要快……而且第一次更有可能是正确的。当你手边有这么好的一个轮子时，不要重新发明轮子。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-01T04:28:00.007

在我的 Web 表单中，我经常使用正则表达式来验证用户在文本字段或类似字段中输入的内容。电子邮件地址需要是一些非空白字符，后跟“@”字符，然后是一些非空白字符，然后是句点字符等。日期需要满足几种允许的格式之一（1/23 /2008, 1/23/08) 以便我的代码准确地确定输入的日期。等等。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-01-13T08:57:23.213

我用它们来[检查素数](http://montreal.pm.org/tech/neil_kandalgaonkar.shtml)，虽然我想知道为什么有时它很慢:-)

```
/^1?$|^(11+?)\1+$/ 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-01T02:46:58.697

Stack Overflow 实际上是查找用例的好地方：

[https://stackoverflow.com/questions/tagged/regex](https://stackoverflow.com/questions/tagged/regex)

将正则表达式视为类固醇上的 glob（你知道，* ? {a,b,c} [abc]）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-01T02:54:36.933

拉出字符串输入。例如，

*   通过直接匹配 HTML 或（更有用的）来自 w3m 等工具的 ASCII 输出来“屏幕抓取”网页，例如，用于找出足球比赛何时结束，以便我的计算机可以停止记录

*   例如，将电子邮件标题拆分为标签和值，以帮助识别垃圾邮件

*   从学生记录中提取名字、姓氏和电子邮件地址，以便在成绩册中我可以通过姓氏来识别学生，如果它是唯一的，如果需要消除歧义，我可以通过“last, first”来识别学生

正则表达式是第一个广泛部署的字符串处理工具，但现在我经常更喜欢基于 Parsing Expression Grammars 的东西，比如[LPEG 模式匹配器](http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-01T03:05:18.100

我基本上将它们用于我需要的不仅仅是精确字符串匹配的任何事情，但我不太关心性能或可维护性来做任何需要超过几行代码的事情。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-01T05:17:52.917

简而言之，正则表达式在您需要理解或操作字符串的任何时候都很有用。当您要编写多行文本处理代码块并且意识到正则表达式可以在一行中完成时，使用正则表达式特别容易。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-01T04:01:54.240

解析骰子符号（“2d6”、“3d4+10”等）以在 ruby​​ 中创建 Dice 对象。（不确定这段代码是否是“完美”的方式，因为我还在学习 Ruby）。

```
def Dice
    def self.parse(str)
        match = /^(\d+)d(\d+)([\+|\-]\d+)?$/.match(str)
        amt, sides, mod = match.captures.map {|c| c.to_i }
        Dice.new(amt, sides, mod)
    end
end 
```

非常好和容易。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-01T19:28:30.750

```
I've regularly used it to take text output from some programs which have a lot of information and abstract some of that information to be saved in databases, spreadsheets or even as a new text file.
Also, I've used it in a program to read text files that initialize the program's variables. 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-18T09:10:30.857

我还使用它们来构建符合现有验证规则的随机数据。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-01T11:14:24.383

正则表达式非常适合中小型文本中的小型文本搜索、模式匹配和替换。例如，我使用 RE 的地方之一是表单字段验证。

如果您不介意性能，您可以真正快速而肮脏的脚本来处理文本。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-01T02:47:37.790

验证电子邮件地址是我一直使用正则表达式的事情。

我什至不想考虑尝试以另一种方式做类似的事情。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-01T02:52:29.747

在 ASP.NET 中，如果您使用用户控件或母版页，即使您对控件进行唯一命名，它们也会被框架破坏。我在原型 $ 函数周围写了一个小包装器，以允许我在 javascript 中获得重整的控件，尽管名称重整。它使用正则表达式在 DOM 中搜索以适当名称结尾的控件。

我还在需要匹配特定输入模式的输入的客户端/服务器端验证中大量使用它。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-06-21T03:57:06.880

1.  跟踪日志文件中的异常或验证行（即“子系统 A 已启动...”）等。
2.  替换文本，（即在源文件中，快速成为 Sysout 语句）
3.  向同事解释正则表达式的强大功能。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-03-04T10:14:27.847

我用它在 OCR 之后解析数据。正则表达式对于丢弃错误并保留我们正在寻找的真实数据很有用。

# sql - LINQ 到 SQL

> ID：404450
> 
> 赞同：1
> 
> 时间：2009-01-01T02:55:13.767
> 
> 标签：sql, sql-server, linq

我正在完成一个 C# ASP.NET 程序，该程序允许用户通过从下拉列表中选择内存、cpu 等硬件组件来构建自己的计算机。SQL 数据表有 3 列；计算机 ID、属性和值。computerID是我的产品主数据表中某台计算机对应的ID，Attribtute是硬件组件的名称；memory,cpu, hard drive etc.. 并且该值是分配给该属性的值，例如 1GB 或 2.8GHz 320GB。这意味着一台计算机将具有多个属性。

我试图通过首先选择满足第一个属性要求的所有计算机然后从该列表中获取所有满足下一个要求的计算机来缩小结果范围......等等大约10多个属性。

我认为向您展示我的 LINQ to SQL 查询示例可能是一个好主意，这样您就可以更好地了解我想要做什么。这基本上选择了计算机内存大于 1GB 的 ComputerID。

```
var resultsList = from results in db.ComputerAttributes
                  where computer.Value == "MEMORY" && computer.Value >= "1"
                  select results.ComputerID; 
```

接下来我想从结果列表中选择 CPU 所在的位置，比 2.8Ghz 快，依此类推。

我希望我已经给了你足够的信息。如果有人可以请给我一些建议，告诉我如何完成这个很棒的项目。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T14:22:23.613

您需要使用 Concat 作为“Union All”。

```
IQueryable<ComputerAttribute> results = null;
foreach(ComputerRequirement z in requirements)
{
  //must assign to a locally scoped variable to avoid using
  //  the same reference in all of the where methods.
  ComputerRequirement cr = z;
  if (results == null)
  {
    results = db.ComputerAttributes
      .Where(c => c.Attribute == cr.Attribute && c.Value >= cr.Value);
  }
  else
  {
    results = results
      .Concat(db.ComputerAttributes
         .Where(c => c.Attribute == cr.Attribute && c.Value >= cr.Value)
      );
  }
}

int requirementCount = requirements.Count();

//Get the id's of computers that matched all requirements.
IQueryable<int> ids = results
  .GroupBy(x => x.ComputerId)
  .Where(g => g.Count == requirementsCount)
  .Select(g => g.Key);

//Get all attributes for those id's
List<ComputerAttributes> data = db
  .ComputerAttributes.Where(c => ids.Contains(c.ComputerId))
  .ToList(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T03:03:44.437

我假设你在问：

> 如何优化使用 LINQ to SQL 完成的搜索内容？

或者类似的东西对吗？

据我了解，您有两种选择：

1.  在内存中过滤你的结果（如果你有缓存的话）。
2.  扩展您的 SQL 查询并再次访问数据库。

我不确定 LINQ to SQL 是否允许您重新查询现有结果集。我很确定它不会。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T03:14:13.760

您可能想要切换到使用扩展方法。将这些链接在一起可能会更容易一些。此外，您将无法对字符串进行小于/大于比较，因为 SQL 不支持这些类型的字符串比较。但是，如果您存储的 id 与字符串描述的顺序相同，则可以比较它们。

使用扩展方法，您可以执行以下操作：

```
Dictionary<string,int>  attributeMap = new Dictionary<string,int>();
attributeMap.Add("MEMORY",1000);
attributeMap.Add("SPEED",2800);

var results = db.ComputerAttributes;
foreach (var attribute in attributeMap)
{
    results = results.Where( c => c.Attribute == attribute.Key
                             && c.Value >= attribute.Value );
}

var ids = results.Select( c => c.ComputerID );

foreach (int id in ids)
{
    ...
} 
```

在上面的例子中，1000 相当于 1GB，2800 相当于 2.8GHz。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T01:21:05.203

哇，谢谢大家的建议，它非常有用。我会试试你的方法，告诉你事情的进展。David B 的最后一个解决方案与我之前所做的非常相似（计算 ComputerID 的出现次数），但是我的代码效率极低。:)

```
 string[] FinalResults = new string[100];
        int Counter2 = 0;
        foreach (string Result in Results)
        {
            string test = Result;
            var Counter1 = 0;
            foreach (string Result2 in Results)
            {
                if (test == Result2)
                {
                    Counter1++;
                }
                else
                {
                    continue;
                }
            }
            if (Counter1 >= 3 && Result != null)
            {
                FinalResults.SetValue(Result,Convert.ToInt32(Counter2));
            }
            else
            {
                continue;
            }
            Counter2++;
        }
        foreach (string FinalResult in FinalResults)
        {
            if (FinalResult != null)
            {
                Response.Write("Laptop: " + FinalResult + "<br />");
            }
            else
            {
                continue;
            }
        }
    } 
```

在我尝试过每个答案后会选择最佳答案。再次感谢大家的帮助，它已经挽救了生命。

# c++ - typedef a std::string - 最佳实践

> ID：404468
> 
> 赞同：5
> 
> 时间：2009-01-01T03:15:52.897
> 
> 标签：c++, typedef

我正在用标准 C++ 编写一个库来进行语音转换。到目前为止，我已经使用了 std::string 。但是将来我可能不得不将其更改为其他内容（std::wstring 或其他内容）。所以我需要以一种可以轻松切换的方式编写我的库。到目前为止，我已经完成了以下工作来实现这一目标。

1.  创建了一个所有 CPP 文件都将使用的头文件
2.  为此添加了“typedef std::string”，并在文件中的任何地方使用了新名称。

如果我需要更改类型，我可以简单地在头文件中更改，它会在任何地方反映出来。如果有人能看到这是正确的方法或者有更好的方法来做到这一点，我将不胜感激？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T03:30:45.537

您可以编写适用于任何一种字符串类型的模板函数，或者任何具有适当方法的东西。

如果您按照建议执行 typedef，则将来更改 typedef 时将需要更改所有代码。我建议反对它。

编辑：关键是 string 和 wstring 不可互换。当然，您可以通过更改一行来更新您的库，但这仅仅是开始 - 更改 typedef 意味着您正在更改库的公共 API。您必须更改和测试与您的库交互的所有代码，这可能代表了所涉及的大部分工作。甚至有可能一个简单的搜索和替换就足以更新你的库，然后 typedef 什么也没给你买。

坚持每个人都知道和理解的标准类型是有价值的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T03:43:51.080

我认为 typedefing std::string 是合理的。你仍然绑定到一个接口。如果您曾经切换到具有不兼容接口的字符串实现，您可以将 typedef 的值更改为某个适配器类。在 C++ 中，您可以用最少甚至没有开销来做到这一点。更改为新的字符串类型意味着更改适配器类。如果您发现自己经常更换适配器，您可以将其设置为模板。

但是，您仍然无法避免其他人（或以后的您自己）忘记 typedef 并直接使用 std::string 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T14:53:36.123

如果您预计字符串将来需要更改，最好将其从其余代码中抽象出来。

Typedef 或专用类都是实现此目的的两种方法。

使用 typedef 是一个好的开始：代码依赖于抽象。问题是：您的客户端代码可以使用*任何*优惠`std::string`，因此如果您想稍后迁移，您将不得不事后分析需要哪些方面（如果您不想模仿整体`std::string`）。

如果您想控制客户端代码可以使用的内容，最好使用具有更有限接口的适当类。

所以：了解您的需求并做出决定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T03:26:31.037

我将创建一个具有 std::string 作为私有成员的类。然后您需要重新实现您想要使用的方法，但是如果您将来切换字符串类型，您需要做的就是重写这个类。

typedef 可以很好地从 string 切换到 wstring，但是切换到具有不同接口的 string 类并不是很容易（即 qstring）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T03:28:13.107

只要您将来用 std::string 替换的任何东西都具有与 std::string 相同的方法、构造函数等，这将起作用。例如，这不适用于 std::wstring，因为它的方法对宽字符而不是 char 进行操作。

如果您真的打算在将来更换类型，最好将您的数据封装在具有所需接口的自定义类中，然后在保持接口不变的情况下更改实现。std::string 对于您的应用程序来说可能过于“原始”。

# json - 如果 REST API 返回 JSON，那么 MIME 类型是什么？

> ID：404470
> 
> 赞同：70
> 
> 时间：2009-01-01T03:17:22.443
> 
> 标签：json, http, mime-types, rest

我的 REST API 返回 JSON。

我目前将 text/plain 作为 MIME 类型返回，但感觉很有趣。我应该返回`application/x-javascript`还是其他类型？

第二个问题是关于错误条件的 HTTP 状态代码。如果我的 REST API 返回错误状态，我将以 JSON 形式返回

```
{ result: "fail", errorcode: 1024, errormesg: "That sucked. Try again!" } 
```

HTTP 状态码是否应该保持在`200 OK`?

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-01-01T03:22:36.893

[JSON](http://www.ietf.org/rfc/rfc4627.txt)规范建议，这`application/json`似乎得到[IETF](http://www.ietf.org/rfc/rfc4627.txt)和[IANA](http://www.iana.org/assignments/media-types/application/)注册表的支持。

~~关于第二个问题，我认为如果消息处理以某种方式失败，您应该将结构化和标准错误响应作为 JSON 消息返回；仅当由于某种原因无法将消息传递给后端处理程序时，您才应考虑 HTTP 错误代码。~~

**2014-06-27 更新**：客户端（浏览器）仅使用 200 响应的时代早已过去，RESTful API 的普遍建议是使用适合响应的 HTTP 响应代码，2xx 表示成功响应（例如 201 Created for PUT; 204 No Content for DELETE) 以及所有错误条件的 4xx 和 5xx，包括来自 API 本身的错误条件。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-05-25T08:39:06.523

JSON 的 MIME 类型是

`application/json`

[http://www.ietf.org/rfc/rfc4627.txt](http://www.ietf.org/rfc/rfc4627.txt)

[http://www.iana.org/assignments/media-types/application/](http://www.iana.org/assignments/media-types/application/)

更具体地说，这里：

[http://www.ietf.org/rfc/rfc4627.txt](http://www.ietf.org/rfc/rfc4627.txt)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-31T18:13:35.363

我更喜欢同时回复 HTTP 错误状态和特定于应用程序的有效负载。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-05-25T09:25:03.627

不，您不应该在错误情况下返回 200。

可以重复状态代码，或者在响应负载中包含更详细的错误代码。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-08-01T19:15:24.917

根据[RFC 4627](https://www.rfc-editor.org/rfc/rfc4627) ，正确`Content-type`的返回是，它还注册了 MIME 类型 IANA（实际上，它显示在 IANA 的页面上）。当然，如果你要写一个客户端，你会希望在你接受的内容上更加自由，同时也接受其他的，比如和。`application/json``text/json``text/x-json`

现在，如果出现错误，您不应该**返回**HTTP 200，这基本上是非 RESTful 的。我知道有时您的错误不完全匹配，但在[RFC 2616 第 10.4](https://www.rfc-editor.org/rfc/rfc2616#section-10.4) -10.5 节中选择最接近的 4XX（客户端错误）或 5XX（服务器错误）错误，并且在 JSON 中更精确。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-03-06T04:35:35.157

如果通过“REST API”表示您想要遵循 REST 架构，那么要使用的媒体类型取决于您想要通过 REST API 公开的功能。您希望能够创建新对象吗？查询对象列表？编辑对象？如果是这样，那么一个好的 RESTful 媒体类型可能是 vnd.collection+json，因为它定义了一个超文本链接接口来操作 json 对象的集合。

注意：一个 RESTful API 可以使用媒体类型 application/json，但是这种媒体类型没有超文本链接的 RESTful 接口，所以它是状态变化的一个终点。

遵循 Web API 架构也是完全可以接受的，其中 HTTP RPC 调用返回 application/json 对象，其他 HTTP RPC 调用操作这些对象，并且没有用于使用和导航状态更改的超文本链接接口。但这不是 REST。

我喜欢 REST 的这种描述（来自 REST 的创建者）：

[REST APIS 必须是超文本驱动的](http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven)

> 换句话说，如果应用程序状态引擎（以及 API）不是由超文本驱动的，那么它就不能是 RESTful 并且不能是 REST API。时期。

此外，从那篇文章的讨论中可以看出这个 RESTful 应用程序示例：[Lost Boys's Spam-E REST Application](http://www.ldodds.com/blog/archives/000337.html)

# css - 样式表上的 Grails NumberFormatException

> ID：404484
> 
> 赞同：2
> 
> 时间：2009-01-01T03:36:04.480
> 
> 标签：css, jsp, grails, stylesheet

使用 Grails 1.1 beta2 和一个 JSP 页面。JSP 包括 CSS 参考：

```
<link rel="stylesheet" type="text/css" href="styles.css"> 
```

当包含此行时，Grails 会出现以下错误：

```
[7000] errors.GrailsExceptionResolver java.lang.NumberFormatException: For input string: "styles" org.codehaus.groovy.runtime.InvokerInvocationException: java.lang.NumberFormatException: For input string: "styles"
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:92)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:234)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1061)
        at groovy.lang.ExpandoMetaClass.invokeMethod(ExpandoMetaClass.java:893)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:892)
        at groovy.lang.Closure.call(Closure.java:279)
        at groovy.lang.Closure.call(Closure.java:274)
        at org.codehaus.groovy.grails.web.servlet.mvc.SimpleGrailsControllerHelper.handleAction(Simp
leGrailsControllerHelper.java:340)
        ... 
```

如果我删除样式表标签，则页面加载无错误（但没有 CSS）。任何想法为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-01T19:21:31.310

需要检查的几件事：

该标签是否被加载到 HTML HEAD 中？

可以“找到”styles.css 文件吗？

玩转格式...一些标准文档使用以下语法：

（注意样式表周围没有引号）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-15T12:41:18.470

试试看：

```
<link rel="stylesheet" type="text/css" media="screen" href="${resource(dir:'path/to/css', file:'styles.css')}" /> 
```

# javascript - 从 javascript 进行另一个脚本函数调用

> ID：404491
> 
> 赞同：0
> 
> 时间：2009-01-01T03:47:44.767
> 
> 标签：javascript, function, function-calls

我设计了 Javascript 函数 My.js 它包含以下代码

```
My.js
function display(){

  //Call to another Javascript function defined as ShowUser() in selectUser.js
  showUser(str);

 }

SelectUser.js has

 function showUser(Str){

     //Do the display

 } 
```

现在，我的问题是：我想从 My.Js 本身调用 showUser() 。有人建议如何拨打电话吗？我应该包括任何东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-01T03:55:49.323

您需要为 HTML 文档中的两个 javascript 文件设置单独的脚本标记，并设置 src 属性，假设这是针对 HTML 页面（而不是 AIR 应用程序、服务器端 JavaScript 或 Rhino）。无论您在通过脚本元素添加的任何 JavaScript 文件中的全局范围内声明的什么函数，或内联代码都应该可用于任何文件中的 JavaScript。

唯一需要注意的是，如果您使用 window.foo 语法将某些内容分配给文件中的全局（窗口）范围，那么令人惊讶的是，在 IE 中，其他文件会认为 window.foo 未分配，直到 JavaScript 开始执行。

[关于上一期的更多信息](http://blowery.org/2008/11/21/windowbaz-vs-var-baz-a-subtle-oddity/)

# c# - 以编程方式将行添加到 DataGridTable

> ID：404498
> 
> 赞同：3
> 
> 时间：2009-01-01T03:55:18.857
> 
> 标签：c#, .net, datagridview

如何以编程方式将行添加到 C# 中的 DataGridTable？当用户选择一个选项时，我想用新数据重新填充 DataGridTable，我正在获取如下所示的数据：

```
 connect.Open();
        MySqlCommand comm = connect.CreateCommand();
        comm.CommandText = getCustomerInvoices + customerID + "\'";
        MySqlDataReader r = comm.ExecuteReader();
        while (r.Read())
        {
            DataGridViewRow d = new DataGridViewRow();
            String[] parameters = new String[5];
            parameters[0] = r.GetValue(0).ToString();
            parameters[1] = r.GetValue(1).ToString();
            parameters[2] = r.GetValue(2).ToString();
            parameters[3] = r.GetValue(3).ToString();
            parameters[4] = r.GetValue(4).ToString();
            d.SetValues(parameters);
            invoiceTable.Rows.Add(d);
        }
        connect.Close(); 
```

似乎发生的事情是我在表中添加了一个新行，但旧行仍然存在，并且新行中似乎没有任何值（一堆空白文本框，我知道这个查询在我的测试用例中返回一个结果）。

有人可以向我解释我必须做什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T04:10:50.713

我相信 Rows.Add() 对字符串数组有重载。如果您要创建一个字符串数组，为什么不尝试使用它呢？即代替：

```
d.SetValues(parameters);
invoiceTable.Rows.Add(d); 
```

你会使用：

```
invoiceTable.Rows.Add(parameters); 
```

或者，如果您仍想创建一个 DataGridViewRow 对象并在其上调用 setvalues，我认为您需要将数组转换为 Object 类型的数组，或者将每个值作为它自己的参数传递，而不是传递数组。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-29T22:10:34.757

我相信您需要在调用 setvalue 之前调用 .CreateCells(GridName)

# c++ - 私有成员变量范围 - C++

> ID：404513
> 
> 赞同：2
> 
> 时间：2009-01-01T04:17:27.360
> 
> 标签：c++, scope

我刚从 C++ 开始，在理解类中私有成员变量的范围如何工作时遇到了一些问题。请看下面的代码

```
class Foo{
    private:
        std::vector<int> container;
    public:
        // other methods
};

int main(int argc, char* argv[])
{
    Foo* foo = new Foo;
    // other method calls to which foo is passed
    delete foo;
    return 0;
} 
```

在上面的代码中，变量“容器”是一个私有成员变量。我正在调用“Foo”实例并将其传递给其他几个方法和类。以下是我的疑惑

1.  变量“容器”的范围是什么？在我删除实例 foo 之前，该变量是否存在？
2.  我需要将“容器”作为指向向量的指针吗？

谢谢您的帮助

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T04:23:40.950

1.  是的，只要包含它的对象存在，容器成员的*生命周期*`delete`就会持续，直到您调用指向它的指针（`foo`在您的情况下）。
2.  不，没有理由这样做。使其成为指针需要您创建一个动态对象`vector<int>`，您需要管理其生命周期（包括在容器指针上调用 delete）。这里没有必要。假设您希望容器与 Foo 对象一样长，您可以直接包含它，而无需使用指针。

传递`foo`指针只会传递指针。它指向的对象*不会*被复制，如果需要，只会复制指向它的指针。如果您了解 Java，那么如果我告诉您传递指针与仅传递对 Java 中的对象的引用相同，那么它将对您有所帮助，例如：

```
Foo f = new Foo();
// just passes the reference (pointer in C++) to doIt. 
// the actual object is not copied
doIt(f); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T04:59:56.197

***我正在调用“Foo”实例***

实际上，您正在创建*类 Foo*的实例。

*具体来说，您正在通过new()*从堆中分配一块内存。这块内存足够大，可以包含*Foo::container和**Foo*所需的任何其他开销类。

（在这个例子中，没有。对于其他类，可能有额外的属性或虚拟指针表。）

自然地，*new()*调用（也许是默认的？）*Foo::Foo()*构造函数，而后者又通过*std::vector*构造函数初始化*Foo::container*。

 ****变量“容器”的范围是什么？***

*container*是实例*foo*的属性 [component] 。只要实例*foo*存在，它就存在。

在范围方面，我们可以说*Foo::container*。但是如果没有类*Foo*的实例，您将无法访问*Foo::constainer*。（例如对象*foo*。） *Foo::constainer*没有类*Foo*的实例就不存在。

 ***（有些类变量的工作方式有所不同，其中一个值在所有实例之间共享。但这里不是这种情况。）

此范围与您的公共/受保护/私人/朋友成员访问控制**无关。**

例如，在某些*Foo::myPublicMethod()*中，您可以参考*Foo::container*。尽管您也可以在这种情况下放弃显式范围，并将其称为*container*。

请注意，作为私有，您不能在 Foo 类*的*方法之外访问*Foo::container 。*

 ****在我删除实例 foo 之前，该变量是否存在？***

是的。

***我需要将“容器”作为指向向量的指针吗？***

不，你可以，但你当然不必这样做。

一般来说，我建议不要将类实例成员作为指针加上构造函数中的 new 和析构函数中的 delete。这是低效和麻烦的。（默认的复制构造函数可以复制指针值，然后析构函数可以删除相同的指针值两次。）

* * *

根据您的需要，您可以考虑：

```
int main(int argc, char* argv[])
{
  Foo foo;
  // other method calls to which foo is passed
  return 0;
} 
```

**返回 0后**foo*将超出范围；，并被自动删除。此外，*foo*将从堆栈而不是堆中分配。*

 ** * *

[您可能会发现The Annotated C++ Reference Manual](https://rads.stackoverflow.com/amzn/click/com/0201514591)的二手副本很有用。它很旧，但它具有很高的信噪比。

# c# - 我可以在 .NET 中创建常规 Windows DLL（用于插件）吗？

> ID：404521
> 
> 赞同：5
> 
> 时间：2009-01-01T04:30:38.533
> 
> 标签：c#, .net, dll

我正在尝试为程序创建一个插件。该程序通过加载您的插件 DLL 并在该 DLL 中执行特定命名的函数来工作。很标准的东西。但是，我想在 C# 中创建我的插件（而且我有点新手）。我的问题是，我可以从 C# 中导出常规的 C 类函数吗？或者我如何轻松地创建一个存根来做到这一点？

到目前为止，谷歌还没有提供帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T02:03:42.497

通过遵循一系列相当复杂的步骤，我设法得到了我想要的东西：

在 C# 方面：

1.  我创建了一个带有接口的 C# 类
2.  使其 COM 可见，
3.  使用强名称密钥文件对程序集进行签名
4.  使用 gacutil 将程序集添加到 GAC
5.  用 REGASM 工具注册它并生成一个 tlb 类型库文件。

然后我创建了一个 MFC DLL，公开了我需要为插件接口导出的函数。然后在我的 C++ 代码中使用 #import 指令加载前面提到的 tlb 文件。这会生成一个存根，因此我可以轻松地通过 COM 从 C++ 调用我的 C# 代码。

结果似乎完美运行并且性能是瞬时的（这有点令人惊讶，我认为 CLR 加载开销会很明显）。

将 CLR 加载到这个特定的应用程序中并不是一个真正的问题，但我担心其他插件的版本控制问题。当我通过 COM 做这一切时，这真的是一个问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T05:25:00.937

如果您使用 Visual C++，您可以创建一个本机 dll，该 dll 包装用 .NET dll 编写的功能。如果您完全了解 C++（或者如果您是一个快速学习者），那么编写一个调用您在 C# 程序集中实现的函数的 C++ shim dll 将相当简单。

但是，你不能只使用 C# 来做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T05:27:31.087

您可以在 C++/CLI 中编写程序集/dll，将函数公开为标准 DLL 导出。然后，如果需要，您可以将它们用作 C# 程序集中的方法的代理。

但是，这并不意味着这是一个好主意。强制 CLR 加载到进程中是一个非常激烈的步骤，插件作者不应该将其强制加载到其主机上。

例如，Microsoft 强烈建议 shell 扩展作者（即 Windows Explorer 的插件代码）不要**在**.NET 中编写这些插件（通过 COM），因为他们不希望 CLR 加载到如此关键的应用程序中.

应用程序可能（尽管不太可能）需要加载 CLR 本身和某个时间点，如果插件已经加载了给定版本，那么这可能会产生版本控制问题。此外，不能从进程中卸载 CLR，而宿主应用程序可能希望能够卸载插件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T04:56:28.793

不，C# DLL 是托管的，这意味着您需要加载 CLR 才能让计算机理解它。您可能能够使用普通的 C++ 项目，将 C++/CLI 添加到它（项目设置），使用 C# DLL，然后编写基本的 C 导出函数来环绕它。

那将是我要尝试的第一件事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-01T05:02:29.377

您不能使用 C# 或任何 .Net 框架语言创建本机 DLL。然而，.Net 框架可以通过 P/Invoke 使用本机 DLL。

无论如何，用 C# 编写本机 DLL 是不切实际的。你最好用 C 或 C++ 编写 DLL。

如果您打算用 .Net 框架语言（托管 C++、C#、.Net）制作最终程序，那么您可以用 C# 制作 DLL，否则不要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-01T05:11:24.880

对操作：

我为使用旧 COM 互操作程序集的包进行自定义加载项开发。我们想使用 c#，但由于它严重依赖后期绑定，我们不得不使用 vb.net，并将接口类构建为 COM 互操作类。一旦你克服了这个障碍，你通常就很成功了。“接口”库之外的所有支持库都是在 C# 中完成的，因此当基础应用程序的新版本即将推出时，工作量就会减少。

很想听听您编写插件的目的是什么，所以如果有任何我们可以帮助您的提示和/或技巧，我们可以在您继续前进时这样做。

# iphone - 调用 addObserver 和 removeObserver 方法的可能位置

> ID：404522
> 
> 赞同：8
> 
> 时间：2009-01-01T04:31:55.630
> 
> 标签：iphone, cocoa, notifications, addobserver

我有一个子视图向其父视图发送通知的情况。现在我打电话`addObserver:`进来。但是，我猜这是不正确的，因为在刷新视图时调用。`viewWillAppear:``removeObserver:``viewWillDisappear:``viewWillAppear:`

```
[[NSNotificationCenter defaultCenter] addObserver: (id)observer selector: (SEL)aSelector name: (NSString *)aName object: (id)anObject];

[[NSNotificationCenter defaultCenter] removeObserver: (id)observer name: (NSString *)aName object: (id)anObject]; 
```

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T13:13:09.183

实际上，这是一个坏主意。当内存不足时，您的视图控制器可能会收到内存警告。这种情况下的默认行为是清除您的视图（如果您当前不在屏幕上）。在这种情况下，您可以获得第二次发送的 viewDidLoad 消息（在内存事件之后，当您的视图被其导航控制器带回屏幕时。）因此您将拥有同一对象的两个注册，但只有一个删除（在其交易中）

更好的解决方案是设置一个标志说明您已注册，或者在您的 init 方法中注册。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T08:31:39.390

我猜注册通知的正确位置是`viewDidLoad`方法，而取消注册相同通知的正确位置是`dealloc`方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-02T20:44:37.347

本是对的——但我发现了另一种可能很脆弱的方法。我刚刚发现了这一点，因为我永远得到“......在关键值观察者仍在注册时被释放”

我不知道为什么 - 但是当我在我的 init 方法中有 addObserver 和在我的 dealloc 方法中有 removeObserver 时 - 我仍然收到 KVO 仍在被观察消息。我逐步检查并确认我的 removeObserver 被正确调用。

我将我的 addobserver 移到 viewDidLoad 方法中，这似乎有效。

我在 viewDidUnload*和*dealloc 中留下了一个 removeObserver；但我不喜欢这样，因为它不平衡。但在正常情况下，我的 viewDidUnload 不会被调用——这只是为了防止我收到内存不足的通知。

但是我可以看到可能会进入低内存事件的情况，即调用 viewDidUnload。如果我在那之后的某个时间点击 dealloc（在我再次点击 viewDidLoad 之前），我将调用 removeObserver 两次！

所以，我想我会把它保存在我的 viewDidLoad 和我的 dealloc 中。

如果我在我的 init 方法中执行 addobserver，我仍然不知道为什么它不能正常工作。

# c# - 当子窗体关闭时，C# 清除父窗体上的 Datagridview

> ID：404528
> 
> 赞同：1
> 
> 时间：2009-01-01T04:42:35.280
> 
> 标签：c#

我在父（主）窗体上有一个带有 Datagridview 控件的 MDI 应用程序。单击工具条菜单上的项目会填充数据网格，然后打开相应的子窗体。

关闭子窗体时，我想清除父窗体上的数据网格。

非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T04:56:16.173

打开一个新的子窗体时，钩入它的窗体关闭或窗体关闭事件，并在主窗体中清除该点的 datagridview 内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T04:59:56.510

监听子窗体上的 .Closed 事件。在处理程序中，清除数据网格。

您可能想阅读有关[在 C# 中创建基本 MDI 应用程序的](http://www.c-sharpcorner.com/UploadFile/ggaganesh/DevelopingMDIAppplicationsinCSharp11272005225843PM/DevelopingMDIAppplicationsinCSharp.aspx)内容。

# php - 使用 RemoteObject 从 Flex 中检索 Drupal 内容

> ID：404532
> 
> 赞同：2
> 
> 时间：2009-01-01T04:48:17.033
> 
> 标签：php, apache-flex, drupal, actionscript, remoteobject

我以前在 Flex 中使用过 DTO，它映射到 PHP DTO 文件。我通过 remoteobject (AMFPHP) 使用 PHP 从 MySQL 数据库中检索信息，该数据库被转换为 DTO 类型，然后传递回 Flex 以填充 Datagrid。

用于填充 Datagrid 的数据是 DataVO 的 ArrayCollection，如下所示。

```
Public Function OnResult(event:Object):void{

accountingdata:ArrayCollection = new ArrayCollection(ArrayUtil.toArray(event.result);
....

} 
```

然后我使用绑定来填充带有 {accountingdata} 的 DataGrid，

选定项作为 DataVO

DataGrid 上的选定项按如下方式填充变量 selectedItem。

```
selectedItem = event.target.selectedItem 
```

然后我像这样填充文本字段：

```
date_txtfield.text = selectedItem.date

accountno_txtfield.text = selectedItem.accountno 
```

我对此没有任何问题，因为来自服务器端的数据也是 DataVO 对象。

但是现在我试图用 Drupal 内容/节点替换我的服务器端 PHP 脚本，但我遇到了转换问题。

我没有足够的知识将从 Drupal 检索到的数据转换为 DataVO 格式。我仍然可以使用 ArrayCollection 填充 Datagrid，但我无法使用日期、帐户号等个人属性填充各个文本字段。

由于我对这一切都不熟悉，有人可以提供有关如何执行此操作的说明（尽可能详细）吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T20:28:34.323

也许您可以尝试在 PHP 中使用某种适配器层，将 Drupal contet 转换为您当前支持的 DTO。这样，您就不需要在可能没有服务器上那么多灵活性的客户端上处理这个问题，并且您可以重用大部分 Flex/ActionScript 代码。

# python - Python 全局变量、局部变量和 UnboundLocalError

> ID：404534
> 
> 赞同：8
> 
> 时间：2009-01-01T04:48:54.240
> 
> 标签：python, binding, scope, identifier

我最近遇到了这种情况`UnboundLocalError`，这似乎很奇怪：

```
import pprint

def main():
    if 'pprint' in globals(): print 'pprint is in globals()'
    pprint.pprint('Spam')
    from pprint import pprint
    pprint('Eggs')

if __name__ == '__main__': main() 
```

产生：

```
pprint is in globals()
Traceback (most recent call last):
  File "weird.py", line 9, in <module>
    if __name__ == '__main__': main()
  File "weird.py", line 5, in main
    pprint.pprint('Spam')
UnboundLocalError: local variable 'pprint' referenced before assignment 
```

`pprint`明确地绑定在 中`globals`，并且将`locals`在以下语句中绑定。有人可以解释为什么它不乐意解决这里`pprint`的绑定`globals`吗？

**编辑：**感谢良好的回应，我可以用相关术语澄清我的问题：

在编译时，标识符`pprint`被标记为框架的本地。执行模型在框架内绑定本地标识符的*位置*是否没有区别？是否可以说“在此字节码指令之前引用全局绑定，此时它已被重新绑定到本地绑定”，或者执行模型是否没有考虑到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-01T09:42:23.197

惊喜在哪里？*您在该范围内重新分配的范围内的任何*全局变量都被编译器标记为该范围内的本地变量。

如果进口的处理方式不同，*恕*我直言。

但是，它可能会在其中使用的符号之后不命名模块，反之亦然。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-01T08:21:10.003

好吧，这对我来说很有趣，我做了一些实验，我通读了[http://docs.python.org/reference/executionmodel.html](http://docs.python.org/reference/executionmodel.html)

然后在这里和那里修改你的代码，这就是我能找到的：

代码：

```
import pprint

def two():
    from pprint import pprint
    print globals()['pprint']
    pprint('Eggs')
    print globals()['pprint']

def main():
    if 'pprint' in globals():
        print 'pprint is in globals()'
    global  pprint
    print globals()['pprint']
    pprint.pprint('Spam')
    from pprint import pprint
    print globals()['pprint']
    pprint('Eggs')

def three():
    print globals()['pprint']
    pprint.pprint('Spam')

if __name__ == '__main__':
    two()
    print('\n')
    three()
    print('\n')
    main() 
```

输出：

```
<module 'pprint' from '/usr/lib/python2.5/pprint.pyc'>
'Eggs'
<module 'pprint' from '/usr/lib/python2.5/pprint.pyc'>

<module 'pprint' from '/usr/lib/python2.5/pprint.pyc'>
'Spam'

pprint is in globals()
<module 'pprint' from '/usr/lib/python2.5/pprint.pyc'>
'Spam'
<function pprint at 0xb7d596f4>
'Eggs' 
```

在方法`two()` `from pprint import pprint`中但不覆盖中的名称`pprint`，`globals`因为`global`关键字**未**在 的范围内使用`two()`。

在方法`three()`中，由于在本地范围内没有`pprint`名称声明，因此默认为全局名称`pprint`，即模块

而在 in 中`main()`，首先使用关键字`global` **，**`pprint`因此方法范围内的所有引用都`main()`将引用该`global`名称`pprint`。正如我们所看到的，它最初是一个模块，并且在`global` `namespace`我们执行的方法中被覆盖`from pprint import pprint`

虽然这可能无法回答这个问题，但我认为这是一些有趣的事实。

======================

**编辑**另一个有趣的事情。

如果你有一个模块说：

`mod1`

```
from datetime import    datetime

def foo():
    print "bar" 
```

另一种方法说：

`mod2`

```
import  datetime
from mod1 import *

if __name__ == '__main__':
    print datetime.datetime.now() 
```

乍一看似乎是正确的，因为您已将模块导入`datetime`.`mod2`

现在，如果您尝试将 mod2 作为脚本运行，它将引发错误：

```
Traceback (most recent call last):
  File "mod2.py", line 5, in <module>
    print datetime.datetime.now()
AttributeError: type object 'datetime.datetime' has no attribute 'datetime' 
```

因为第二个导入`from mod2 import *` 覆盖了`datetime`命名空间中的名称，因此第一个`import datetime`不再有效。

道德：因此，导入的顺序、导入的性质（从 x 导入 *）和导入模块中的导入意识 -**很重要**。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-01T06:02:48.583

看起来 Python在执行任何代码*之前*`from pprint import pprint`会看到该行并将其标记`pprint`为本地名称。由于 Python 认为 pprint 应该是一个局部变量，在使用语句“分配”它之前引用它，它会抛出该错误。 `main()` *`pprint.pprint()``from..import`*

 *这是我所能理解的。

当然，道德是始终将这些`import`陈述放在范围的顶部。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-01-27T11:25:45.670

这个问题在几周前得到了回答，但我想我可以稍微澄清一下答案。首先是一些事实。

1：在 Python 中，

```
import foo 
```

几乎完全一样

```
foo = __import__("foo", globals(), locals(), [], -1) 
```

2：在函数中执行代码时，如果 Python 遇到一个尚未在函数中定义的变量，它会在全局范围内查找。

3：Python 对名为“locals”的函数进行了优化。当 Python 标记一个函数时，它会跟踪您分配给的所有变量。它为这些变量中的每一个分配一个来自局部单调递增整数的数字。当 Python 运行该函数时，它会创建一个包含与局部变量一样多的插槽的数组，并为每个插槽分配一个特殊值，表示“尚未分配”，这就是存储这些变量的值的地方。如果您引用尚未分配给的本地，Python 会看到该特殊值并引发 UnboundLocalValue 异常。

现在舞台已经搭建好了。您的“从 pprint 导入 pprint”实际上是一种分配形式。因此 Python 创建了一个名为“pprint”的局部变量，它会遮挡全局变量。然后，当您在函数中引用“pprint.pprint”时，您点击了特殊值，Python 会抛出异常。如果你在函数中没有那个 import 语句，Python 会使用普通的look-in-locals-first-then-look-in-globals 解析并在 globals 中找到 pprint 模块。

为了消除歧义，您可以使用“global”关键字。当然，现在你已经解决了你的问题，我不知道你是否真的需要“全局”或者是否需要其他方法。

# c# - 在 ASP.Net 中关闭应用程序时删除所有元素

> ID：404545
> 
> 赞同：0
> 
> 时间：2009-01-01T05:04:09.917
> 
> 标签：c#, asp.net

任何人都可以在这方面帮助我。我正在使用带有 C# 的 Asp.NET。我的数据库中有许多产品。当我运行我的代码时，所有产品值都存储在数据库表中。如果没有退出按钮，如果我关闭我的应用程序，当我第二次运行时，数据库表应该是空的。我不能使用 !PAGE.ISPOSTBACK 因为我在单次运行时添加了不同的产品，这将为单个用户删除。谁能告诉我，或者在没有内部退出按钮事件的情况下关闭应用程序时显示删除元素的代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T05:18:09.453

如果您使用的是 Web 应用程序，则无法确定用户何时离开您的应用程序。您可以使用多种策略，但没有一个是 100% 可靠的。这些策略包括：

1.  用户的会话超时导致执行注销逻辑（删除行）。
2.  使用 Javascript 检测用户何时离开页面并触发 AJAX 调用以执行注销逻辑。
3.  使用 Javascript 检测浏览器关闭并像 #2 一样调用 AJAX。

您可能希望在这里颠倒逻辑。为什么在用户登录时不运行一些逻辑来检测这些孤立的行并删除它们？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T19:39:15.553

您应该使用 SlidingExpiration 添加一些 Cache Item 和 Cache Expiration CallBack。

因此，只要用户没有单击 Exit 按钮，就会在 Expiration CallBack 被触发时处理删除所有项目。

看看这个： http: [//geekswithblogs.net/jawad/archive/2005/05/23/CacheManager.aspx](http://geekswithblogs.net/jawad/archive/2005/05/23/CacheManager.aspx)

# c++ - C ++将二维数组对象插入另一个

> ID：404547
> 
> 赞同：0
> 
> 时间：2009-01-01T05:04:46.250
> 
> 标签：c++, arrays, syntax, 2d

这个问题是前一个问题的延续：

[C++ 返回和插入二维数组对象](https://stackoverflow.com/questions/402432/c-returning-and-inserting-a-2d-array-object)

强烈建议查看链接了解以下内容。

我遵循了亚当罗森菲尔德的回答，它解决了前两个问题。然而，前两个高涉及的最后一个问题尚未解决。我不确定问题是我尝试纠正代码的方式，还是尝试的内容有问题。

这是 int main() 中所写内容的一部分：

```
 int i, j;

    Grid myGrid;
    Piece myPiece;

    //First two lines of Adam's Code
    int (*arrayPtr)[4][4] = myPiece.returnPiece();
    int cell = (*arrayPtr)[i][j];

    //compiler error
    myGrid.insertArray(cell); <--- Problem 
```

我不确定是不是这个论点是错误的，还是我正在尝试的东西是错误的。这是我尝试编译时收到的：

```
在函数“int main()”中
从 `int' 到 `int(*)[4][4]' 的无效转换
初始化 `void Grid::insertArray(int(*)[4][4])' 的参数 1
[构建错误] [grid test.o] 错误 1

```

我试过这些：

```
myGrid.insertArray((*arrayPtr)[4][4]); //同样的错误
myGrid.insertArray((*arrayPtr)[i][j]); //同样的错误

```

我不确定是什么问题，也不确定该怎么做。我感谢亚当和其他人帮助我解决了以前的问题，但是有人知道如何解决最后一个问题吗？

"在 insertArray() 的参数中接受 returnpiece()；

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-05T16:35:51.180

> ```
> int i, j;
> 
> Grid myGrid;
> Piece myPiece;
> 
> //First two lines of Adam's Code
> int (*arrayPtr)[4][4] = myPiece.returnPiece();
> int cell = (*arrayPtr)[i][j];
> 
> //compiler error
> myGrid.insertArray(cell); <--- Problem 
> ```

如果要复制一块（或 4x4 部分），则必须将指针传递给该部分 Adam 提供的函数接受类型为 (int *[4][4]) 的参数，而不是整数

```
 void Grid::InsertArray(int (*arr)[4][4]) {
      for(int i = 0; i < x_ROWS; i++)
      {
          for(int j = 0; j < y_COLUMNS ; j++)
              squares[i][j] = (*arr)[i][j];
      } 
 } 
```

所以你会传递它 arrayPtr

```
int i, j;

 Grid myGrid;
 Piece myPiece;

 //First two lines of Adam's Code
 int (*arrayPtr)[4][4] = myPiece.returnPiece();
 myGrid.insertArray(arrayPtr); 
```

或在一行中

```
myGrid.insertArray(myPiece.returnPiece()); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T01:40:06.163

我看到几个问题：

1) 有可能您根本没有剪切和粘贴所有内容，但看起来您设置`cell`为`(*arrayPtr)[i][j]`在 i 和 j 有值之前 - 在 C/C++ 中，它们不会自动初始化为 0，它们的值可以是任何值（通常是荒谬的高/低数字，无论之前发生在那个位置的内存中）。

2）您的 insertArray 函数的目的是获取一个数组并将其插入另一个数组。所以你应该给它一个数组。相反，您传递的是它`cell`，它是数组的单个元素。你想自己给它`arrayPtr`。在 Adam 的第一行代码中，[4][4] 是数组类型的一部分（它专门指定它是一个 4x4 数组）。但是`myGrid.insertArray((*arrayPtr)[4][4]);`意思是，“获取 arrayPtr 的第 4 行和第 4 列中的元素”——在变量声明之外，[4][4] 执行元素的实际查找。不同的语境，不同的意思。

3) 样式说明：查看您的上一篇文章，insertArray 的代码不会执行“插入”，因为该词通常在编程中使用。插入是指将元素添加到序列（例如数组或链表）而不删除之前存在的任何内容。您的代码执行复制，因此 copyArray 或 setArray 的误导性较小。

# coding-style - 你如何设计主要和次要评论？

> ID：404549
> 
> 赞同：7
> 
> 时间：2009-01-01T05:06:50.507
> 
> 标签：coding-style, comments

有时我想写一个“主要”注释来描述一大块代码，然后写一个“次要”注释来描述该代码块中的几行：

```
// Major comment

// Minor comment
...

// Minor comment 2
... 
```

主要注释下面没有代码看起来很奇怪，你无法直观地看出它下面描述了多少代码。

你如何看待这些评论？

（我记得不久前在 Code Complete 中读到过这个，但我不拥有这本书。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T05:15:08.087

我对“主要”评论使用多行评论：

```
/*
 * yada yada yada
 */ 
```

并为次要的使用单行注释。

我知道有些人不喜欢使用 /* */ 样式的注释，因为它使自动注释和取消注释块变得更加困难......但我喜欢它们的外观，并且我坚信代码应该在美学上令人愉悦读。

这也意味着您应该能够在很大程度上解析代码的结构而无需阅读细节，这意味着我倾向于使用相当多的空格和分隔注释行来帮助分解。因此，对于我想评论的块，我可能会写：

```
/**
 * detailed description ...
 */

code

// -- minor comment
code

code
// --- --- --- --- --- --- --- --- --- --- --- --- --- --- --- --- --- --- 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T05:13:23.380

```
//主要评论
// -------------
...

// 小注释
...

... // 次要注释（行尾）

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T05:18:49.453

我将主要注释放在代码（块）上方，前面有一个空行，有时全部大写。我把一些小评论放在右边，缩进到第 81 列，以免它们妨碍代码。这两个都使用 //。

对于算法“话语”，我使用 /* */ ，如下所示：

```
/*
 * This is a long discourse on the code which follows it, usually
 * placed at the beginning of a method and containing information
 * which is not appropriate for the doc comments.
 */ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T05:21:40.757

我认为“主要”和“次要”评论之间的区别在于它们所附加的程序结构。例如，我将方法或类级别的文档注释视为“主要”，将块或行级别的注释视为“次要”：

```
/**
 * This is major comment describing the method
 */
public void foo() {
    if (...) {
        // minor comment describing block
        ...
        doSomething(); // minor comment describing line
    }
} 
```

与其用注释来分割你的代码，我认为用描述性名称和文档注释将功能单元重构为它们自己的方法是一种很好的做法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-01T05:40:10.097

这一切都以 C 为中心。在 C/C++ 中，我倾向于编写

```
/* file -- what it is -*-emacs magic-*- */ 
```

作为第一行。

```
/*
 * Block comments like this
 */

if( I need a comment on a code block) {
   /* I tend to write them like this */
   x = x + 1 ;                        /* ... and write my */
                                      /* line comments so */
} 
```

我通常保留`// comments`内部代码，并将好的旧 BSD 注释保留在块注释中。

在 Lisp 中

```
;;;; Four semicolons for "file-scope" comments

;;; Three for block comments over a large chunk of code

(defun quux (foo bar)
    "Don't forget your docstrings, folks"
    ;; but big code comments get two semicolons
    (let ((a 1)
          (b 2))                      ; and only one semicolon
          (+ a b)))                   ; means an in-line comment.

# comment languages like Python and Ruby
# Have to live with one style of comment.
def quux(a,b):
    return a + b                          # poor neglected things. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-01T05:40:45.320

我通常`/* */`在每个部分的顶部使用注释代码块。我不使用内联注释，除非在特殊情况下（例如棘手的代码），因为我觉得注释是“隐藏的”，并且代码可以稍后扩展，并且必须对注释进行微管理。例如：

```
int parseEverything()
{
    /* Initialize the parser. */
    random_code_here();

    still_more_init();
        /// (Note: the above line still falls under the init section, even if it's separated by a newline.)

    /* Main parser loop. */
    while(!done_parsing) {
        /* Grab the token. */
        if(x) {
            /* Preprocessor stuff. */
            y();
        } else {
            /* Normal token. */
            z();
        }

        /* Insert into tree. */
        make_tree_node();
        insert_into_tree();

        /* Move to next token. */
        ++streamPtr;
            /// (Note: the above could be expanded to take up multiple lines, thus
            ///        if an inline comment were used it'd have to be moved, if
            ///        you even remember there's a comment there.)
    }

    clean_up();
} 
```

当然，如果代码很明显，则*不需要*注释，如`clean_up()`. 包括注释并没有太大的伤害，如果稍后扩展，它会更容易知道在哪里放置额外的清理代码。

使用这个方案，我发现仅仅通过它的注释就可以很容易地跟踪一个函数。 `parseEverything`包含三个主要部分：初始化、主循环和清理。在主循环中，我们抓取令牌（预处理器或普通），将其插入树中，然后继续下一个令牌。

很可能每个部分都需要自己的 [set] 函数，因此很明显，如果部分变得庞大，您可能需要重构。

我应该补充一点，我这样格式化多行注释（我的“IDE”（ ）使用默认脚本（对于我的发行版）为我在每一行`Vim`插入，这很方便）：`*`

```
/*
 * This is a comment which normally would be on one line, but is either split into multiple
 * lines for emphasis or so we don't have 160-character hard-to-read comments everywhere.
 */ 
```

另外，我评论`#else`'s 和`#endif`'s：

```
#ifndef FOO_H
#define FOO_H

#ifdef DEBUG
#else   /* DEBUG */
#endif  /* !DEBUG */

#endif  /* FOO_H */ 
```

但这有点跑题了。

（`#include`守卫不需要`not`（`!`）在它们之前，因为它们的使用是显而易见的，这是传统。=]）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-01T05:11:49.420

我使用这样的东西，使它看起来更像是以下代码块的“标题”或分隔符：

```
// ***** Major comment *****

// Minor comment
...

// Minor comment 2
... 
```

当然，这是假设“主要评论”只是几句话

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T05:21:59.307

我可能会这样做：

```
// Here we do it
//
// So, be aware this text is just to make a silly
// long comment to show how it would look like 
// in real code. 
doTheRealThing();

// and this is another thingy
doOtherThing(); 
```

如果注释记录了出现在其他代码块之间的一些代码，并且我想真正弄清楚注释所指的位置，有时我会发现我在这些东西周围写块

```
// prepare for party
doIt();

// Here we do it
//
{
    // So, be aware this text is just to make a silly
    // long comment to show how it would look like 
    // in real code. 
    doTheRealThing();

    // and this is another thingy
    doOtherThing();
}

// another code that is not really affected by the comment
// above
die(); 
```

有时，块需要自己的一组局部变量来完成任务，然后块还可以将它们的范围缩小到需要它们的地方。可以说，此类代码应该放入各自的函数中，但偶尔会发生这样做会降低代码质量。现在，对于注释方法，我通常只在它们的头文件中注释它们，并通过以下方式进行：

```
/**
 * This function will return the current object.
 *
 * And now it follows the normal long stuff that's again
 * a bit stretched to fill space...
 */
Object getCurrentObject(); 
```

对于取消注释的代码范围，我明确*不*使用这些注释，因为我只保留它们以记录代码。我会用

```
#if 0
    Code in Here that's disabled
#endif 
```

它还可以让我免于使用一些无效的 C++ 代码（这些分隔符之间的东西仍然必须包含有效的标记）。不过，我不确定 C# 中的情况如何。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-01T05:43:12.693

```
// A plate is displayed if a WorkFlowStepUpdate message is received
// whose:
//        * Change_Type is License_No
//        * Event_Type is GA, NA, or NG
//        * New_Value is non-null and non-blank
//        * Inspection_DateTime<(NOW-TimeInMinutesBeforeExpiringDisplaySignMessage)
//
// A plate is removed:
//         * if it has been displayed for TimeInMinutesBefore...
//         * a GA, NA, or NG CloseEvent is received  whose New_Value matches
//           a displayed plate
//
// If a plate is to be added to a full screen, the oldest plate on the display
// is removed to make room for the new plate.

.
.
.
.
.

// Record the ping status of each IP device
foreach (string s in th.Keys)
        {
        // We don't know if this is a wks or svr.
        // But we can rely on 0 being bad, and we'll
        // get the 'proper' state enumeration down in GetsOHInfo
        // 
        if (IsItLive(s)) IPStates[s] = 1;
        else IPStates[s] = 0;
        IPTimes[s] = System.DateTime.Now.ToUniversalTime();
        } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-01T07:52:47.830

主要评论

```
/***  Function - fooBar()  ****************************
** Description                                       **
**    does the flooble using the bardingle algorithm **
**      with the flinagle modification               **
** Pre-condition                                     **
**    all moths are unballed                         **
** Post-condition                                    **
**    all moths are balled                           **
******************************************************/
void fooBar( int foo ) {
    ...
    ...
}

/***  Function - fooBar() END  ***********************/ 
```

小评论

```
// note cast to int to ensure integer maths result
int i = (int)y / (int)x; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-01T08:33:37.983

```
// Top-level (major) comment
theThing=doSomething();
    // - Second-level (minor) comment
    anotherThing=doSomethingWith(theThing);
        // - - Third-level (minor-minor?) comment
        yetAnotherThing=doSomethingWith(anotherThing);
    // - Back to second level
    destroy(anotherThing);
// Back to first level
helloWorld();
```

当然，当语法不允许时，识别技巧不适用（阅读：Python）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-01T13:24:58.613

这是我的评论风格偏好：

```
/**
 * This is a comment explaining
 * what this method is actually doing
 */
public void foo()
{
    // this is a simple comment
    doSomething();

    // this is a special comment
    // explaining thoroughly what I'm doing
    // using as many words as possible
    // to be the most concise
    doSomethingSpecial();
} 
```

# .net - 如何在循环中从 Enumerable 集合中删除对象

> ID：404557
> 
> 赞同：13
> 
> 时间：2009-01-01T05:11:46.033
> 
> 标签：.net, design-patterns, ienumerable

## 复制

[在迭代时修改集合](https://stackoverflow.com/questions/308466/modifying-a-collection-while-iterating-through-it-c)

* * *

有没有人有一个很好的模式可以让我在循环遍历可枚举集合（例如，字典中的 IList 或 KeyValuePairs）时解决无法删除对象的问题

例如，以下失败，因为它修改了在 foreach 期间枚举的列表

```
foreach (MyObject myObject in MyListOfMyObjects)
{
     if (condition) MyListOfMyObjects.Remove(myObject);
} 
```

过去我使用了两种方法。

我已将 foreach 替换为反向 for 循环（以免在删除对象时更改我正在循环的任何索引）。

我还尝试存储一个新的对象集合以在循环中删除，然后遍历该集合并从原始集合中删除对象。

这些工作正常，但都*感觉*不好，我想知道是否有人想出了一个更*优雅*的解决方案

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-01T05:27:23.210

我认为有一个有用的`List<T>.RemoveAll(Predicate<T> match)`方法是为此设计的：http: [//msdn.microsoft.com/en-us/library/wdka673a.aspx](http://msdn.microsoft.com/en-us/library/wdka673a.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-05T06:15:47.890

这有点简单，但是当我打算从 IEnumerable/IList 中删除项目时，我通常只是复制一份：

```
foreach (MyObject myObject in new List<MyObject>(MyListOfMyObjects))
{
     if (condition) MyListOfMyObjects.Remove(myObject);
} 
```

这不是最有效的方法，但它很容易阅读。过早的优化等等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-01T05:20:25.737

做相反的事情，创建一个新列表：

```
List myFilteredList = new List();
foreach (MyObject myObject in myListOfMyObjects)
{
     if (!condition) myFilteredList.Add(myObject);
} 
```

然后在需要的地方使用新列表。

您还可以轻松地使用 LINQ 表达式，同样，反转条件。这具有不创建新结构的额外好处，但也有它是一个惰性可枚举的陷阱：

```
var myFilteredList = from myObject in myListOfMyObjects
                     where !condition
                     select myObject; 
```

但是，如果您确实需要从列表中删除项目，我通常使用“创建一个新列表，然后重复并删除”的方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-01T05:20:34.940

我不喜欢反向 for 循环的想法，因为它只适用于某些数据结构。

一般来说，我会使用第二种技术并将要删除的项目累积在一个单独的“待删除”集合中。如果删除会导致现有迭代无效（例如，任何平衡树集合都会发生这种情况），那么我看不到解决方法。

我偶尔使用的唯一其他技术是在找到要删除的第一个元素时重新开始整个迭代。如果您通过但没有找到任何要删除的项目，则该功能已完成。这是低效的，但如果从集合中删除一个项目可能会更改需要删除的项目集，则有时这是必要的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-25T20:49:30.427

我刚刚看到这篇文章，并认为我会分享。

```
void RemoveAll(object condition)  
{

    bool found = false;

    foreach(object thisObject in objects)    
    {

        if (condition)    
        {    
            objects.Remove(thisObject);

            found = true;

            break; //exit loop    
        }     
     }

    // Call again recursively

    if (found) RemoveAll(condition);

} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-29T17:10:37.560

我很感激这现在可能已经死了，但我总是这样做的方式是：

foreach（MyListOfMyObjects 中的 MyObject myObject）
{

if (条件) MyListOfMyObjects.Remove(myObject);

**休息;**

}

对象被移除，然后循环退出，中提琴！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-13T12:40:49.267

我有一本字典，想处理所有值。当每个值被处理时，它会从创建您讨论的问题的字典中删除自己。我做了以下事情：

```
foreach (var o in dictionary.Values.ToList())
{
  o.Dispose();
} 
```

# internet-explorer - 将文件功能拖放到浏览器

> ID：404574
> 
> 赞同：1
> 
> 时间：2009-01-01T05:22:51.113
> 
> 标签：internet-explorer, drag-and-drop

我正在寻找一种方法来模仿 Windows Live 功能，将文件从 Windows 资源管理器拖到浏览器中的网页上并捕获文件名。我认为这个功能是通过以下控制

Microsoft.Live.Folders.RichUpload.UploadControl

任何指向照顾客户的正确方向的指针

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T04:08:52.137

我做了一堆挖掘来弄清楚这是否可能在不嵌入 Active-X 控件的情况下，但似乎你不能。您可以在脚本中使用各种库来执行此操作，但主要原因是：

Javascript 在沙盒环境中运行，该环境无权访问文件系统，这是出于安全目的。同样，如果不使用为访问该类型结构而设计的 Active-X 控件，它也无法访问 OLE。

我在这里找到了一个演示教程：http: [//straxus.javadevelopersjournal.com/creating_a_mozillafirefox_drag_and_drop_file_upload_script_p.htm](http://straxus.javadevelopersjournal.com/creating_a_mozillafirefox_drag_and_drop_file_upload_script_p.htm)

# oracle - 用于 oracle 数据库的免费 SQL 查询生成器工具？

> ID：404581
> 
> 赞同：2
> 
> 时间：2009-01-01T05:31:33.060
> 
> 标签：oracle, devtools

您是否使用任何免费工具为 oracle 数据库生成查询。自动完成并建议表名和列名的工具。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T05:50:16.533

[Oracle SQL Developer](http://www.oracle.com/technology/products/database/sql_developer/index.html)具有自动完成等功能。

由 Oracle 自己编写和维护。虽然它是用 java 编写的，但在最小化一段时间后响应可能会很慢（不是 java 是原因，咳咳）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T20:37:58.020

[Henplus](http://henplus.sourceforge.net/)包括自动完成功能；我没有在 Oracle 上尝试过，但如果它在这种情况下不起作用，我会感到惊讶。不幸的是，该项目似乎已经停滞不前。

# sql-server - SQL Server Enterprise Manager 2005 - 未显示存储过程

> ID：404600
> 
> 赞同：3
> 
> 时间：2009-01-01T05:51:41.587
> 
> 标签：sql-server, sql-server-2005

在使用 SQL Server 2005 中的 SQL Server Management Studio 时，我可以连接到 SQL Server 2000 的实例...但没有显示任何存储过程。是否有一些技巧可以让 SQL Server Enterprise Manager 2005 与 SQL Server 2000 数据库正确通信？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T06:01:12.753

我猜您登录的帐户无权执行存储的过程。如果它无权使用存储过程，SQL Server Management Studio 2005 将不会显示它（无论您连接到 SQL 2000 或 2005 服务器）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T05:59:21.867

我没有看到 2005 Enterprise Manager。相反，有一个管理工作室，它显示数据库/数据库/可编程性/存储过程（它正在查看 2k 数据库）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T06:02:51.780

我将我的 SQL Server Management Studio 连接到两个 SQL Server 2000 服务器，并且存储的过程显示在我正在访问的数据库的可编程性下。

PS我只是觉得看看谁在新年被绑在他们的电脑上会很有趣，你为什么不像世界其他地方那样参加派对？:oP

# model - 您如何与领域专家协商领域模型？

> ID：404601
> 
> 赞同：2
> 
> 时间：2009-01-01T05:53:59.023
> 
> 标签：model, dns, domain-driven-design

假设您正在与客户的领域专家合作。你意识到（或至少有合理的信念）你对他们问题的模型比他们的更清晰。你如何说服他们他们应该按照你的方式行事。

就我而言，需求的主要推动力是相当清楚的（例如，产品的交易系统）。根据我的经验和研究，我会推荐一个有两个 TraderParties 的 TradeContract。每个 TraderParty 购买一种产品并出售一种产品。如果我必须在 XML 中对组合进行建模，我可以将其建模为：

```
<tradeContract>
    <id>1234</id>
    <tradeParty>
       <id>1</id>
       <name>Ann</name>
       <long type="money" value="20.00"/>
       <short reference="book.123"/>
    </tradeParty>
    <tradeParty>
       <id>2</id>
       <name>Bob</name>
       <long reference="book.123"/>
       <short type="money" value="20.00"/>
    </tradeParty>
    <product>
       <id key="book.123">123</id>
       <type>book</type>
       <title>Harry Potter and the Prisoner of Azkaban</title>
    </product>
</tradeContract> 
```

以上只是安以 20.00 美元从鲍勃那里购买*的哈利波特与阿兹卡班囚徒的模型。*更抽象地说，这模拟了两方四足交易。为了争论，我们假设使用 XML 的系统验证`tradeContract`并协调交易。

如果您的领域专家觉得这对他们来说太复杂了怎么办？虽然您可以很容易地承认一些中间步骤来获得上述域模型，但您如何说服他们“咬紧牙关”并尽早使用上述域模型更好？

补充：中小企业提出的模型...

领域专家一直在谈论的是我提出的模型，但看起来他们不相信他们的业务流程还没有准备好。（不过，我认为现在有一些方法可以解决）。

他们*立即*想要的模型是：

```
<tradeParty>
   <id>1</id>
   <name>Ann</name>
   <transaction type="long" product="money" value="20.00"/>
</tradeParty> 
```

Ann 赠送了 20.00 美元的这个模型。然后必须输入一个*单独的事务：*

```
<tradeParty>
   <id>1</id>
   <name>Ann</name>
   <transaction type="short" product="book" reference="book.123"/>
</tradeParty> 
```

为了建模，她获得了哈利波特的书。我认为这很麻烦，因为我们无法模拟我们的系统是否会欺骗 Ann。同样，交易合约中 Bob 一方也发生了类似的交易碎片化。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T06:16:47.510

我从不尝试改变领域专家的心理模型……毕竟他们是专家。但是，如果我将其建模与他们的模型略有不同，那么我确保它仍然可以产生相同的效果。所以我接受他们的观点，以我自己的方式建模，然后以他们理解的方式呈现给他们。

从您的技术角度到他们面向业务的角度，总会有这种翻译。这就是您的业务分析师的角色。

您的领域专家提出的模型是什么？如果如您所说，您的模型捕获了需求，那么请使用您的模型，但向领域专家展示的技术视图较少……请改用图表。他们不必知道从图表生成的 XML。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T07:12:25.103

> 我从不尝试改变领域专家的心理模型……毕竟他们是专家。

我认为这大部分是真的。但是，我知道认为领域专家不如我“明白”的感觉。虽然很容易将其归咎于他们不了解技术方面，但通常这表明开发人员和领域专家之间的沟通没有达到标准。这可能非常危险。

如果您认为最有效的内容与领域专家想要的内容之间存在巨大的脱节，则可能是您错过了他们认为理所当然的领域关键部分。尝试从不同的角度询问问题。有时你会通过另一种推理路径得到不同的结果。灯泡可能会继续存在，突然之间，您对问题的理解比以前要好得多，因此您将能够与领域专家进行更好的沟通。

> 您的领域专家提出的模型是什么？

我认为这也会很有趣。

# build-process - 改进构建 Java EE 应用程序时的周转时间

> ID：404602
> 
> 赞同：0
> 
> 时间：2009-01-01T05:54:32.093
> 
> 标签：build-process, jakarta-ee

构建 Java EE 应用程序的一个令人不安的方面是编辑、编译、部署过程的周转时间。我尝试使用 Jetty，但即使在进行多次编辑后也会出现一些问题，您通常会遇到内存错误。

目前我使用 Netbeans，我可以看到对表示层的编辑而无需重新部署，但是当对模型进行更改时，需要完全重建，并且可能会出现一些问题。

对于改进流程的这方面有哪些建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T20:58:37.367

你可以使用[JavaRebel](http://www.zeroturnaround.com/javarebel/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T13:42:23.100

麻烦吗？真的吗？你的项目有多长？

我认为 Spring dm Server 可能会开始使用其 OSGi 技术。它使部署保持模块化，您可以热部署/取消部署单个模块。

# linux - 比较 Unix/Linux IPC

> ID：404604
> 
> 赞同：80
> 
> 时间：2009-01-01T05:58:11.977
> 
> 标签：linux, unix, ipc

Unix/Linux 提供了许多 IPC：管道、套接字、共享内存、dbus、消息队列……

每种最适合的应用程序是什么，它们的性能如何？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-01-01T06:09:13.500

## Unix IPC

以下是七大：

1.  [管道](http://en.wikipedia.org/wiki/Pipe_%28Unix%29)

    仅在与父/子相关的进程中有用。呼叫[`pipe(2)`](http://linux.die.net/man/2/pipe)和[`fork(2)`](http://linux.die.net/man/2/fork)。单向。

2.  [FIFO](http://en.wikipedia.org/wiki/Named_pipe)或命名管道

    与普通管道不同，两个不相关的进程可以使用 FIFO。打电话[`mkfifo(3)`](http://linux.die.net/man/3/mkfifo)。单向。

3.  [套接字](http://en.wikipedia.org/wiki/Internet_socket)和[Unix 域套接字](http://en.wikipedia.org/wiki/Unix_domain_sockets)

    双向。用于网络通信，但也可以在本地使用。可用于不同的协议。TCP 没有消息边界。打电话[`socket(2)`](http://linux.die.net/man/2/socket)。

4.  [消息队列](http://en.wikipedia.org/wiki/Message_queue)

    操作系统维护离散消息。请参阅[sys/msg.h](http://opengroup.org/onlinepubs/007908799/xsh/sysmsg.h.html)。

5.  [信号](http://en.wikipedia.org/wiki/Signal_%28computing%29)

    Signal 向另一个进程发送一个整数。不能很好地与多线程啮合。打电话[`kill(2)`](http://linux.die.net/man/2/kill)。

6.  [信号](http://en.wikipedia.org/wiki/Semaphore_%28programming%29)

    一种多进程或多线程的同步机制，类似于排队等候洗手间的人。请参阅[sys/sem.h](http://www.opengroup.org/onlinepubs/7990989775/xsh/syssem.h.html)。

7.  [共享内存](http://en.wikipedia.org/wiki/Shared_memory)

    做你自己的并发控制。打电话[`shmget(2)`](http://linux.die.net/man/2/shmget)。

## 消息边界问题

选择一种方法而不是另一种方法时的一个决定因素是消息边界问题。您可能期望“消息”彼此分离，但它不适用于 TCP 或 Pipe 这样的字节流。

考虑一对回显客户端和服务器。客户端发送字符串，服务器接收并立即发送回。假设客户端发送“Hello”、“Hello”和“How about an answer?”。

使用字节流协议，服务器可以接收“Hell”、“oHelloHow”和“about an answer？”；或者更现实地说“你好你好，答案怎么样？”。服务器不知道消息边界在哪里。

一个古老的技巧是将消息长度限制为`CHAR_MAX`or`UINT_MAX`并同意首先在`char`or中发送消息长度`uint`。因此，如果您在接收方，则必须先阅读消息长度。这也意味着一次只能有一个线程读取消息。

使用 UDP 或消息队列等离散协议，您不必担心这个问题，但以编程方式处理字节流更容易，因为它们的行为类似于文件和标准输入/输出。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-01T06:14:28.980

共享内存可能是最有效的，因为您在其上构建了自己的通信方案，但它需要大量的关注和同步。解决方案也可用于将共享内存分配给其他机器。

如今，套接字是最便携的，但比管道需要更多的开销。在本地或通过网络透明地使用套接字的能力是一个很大的好处。

消息队列和信号非常适合硬实时应用程序，但它们没有那么灵活。

这些方法自然是为进程之间的通信而创建的，在一个进程中使用多个线程会使事情变得复杂——尤其是信号。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-14T17:18:38.730

这是一个带有简单基准的网页：[https ://sites.google.com/site/rikkus/sysv-ipc-vs-unix-pipes-vs-unix-sockets](https://sites.google.com/site/rikkus/sysv-ipc-vs-unix-pipes-vs-unix-sockets)

据我所知，每个都有其优点：

*   管道 I/O 是最快的，但需要父/子关系才能工作。
*   Sysv IPC 具有定义的消息边界，并且可以在本地连接不同的进程。
*   UNIX 套接字可以在本地连接不同的进程，并且具有更高的带宽，但没有固有的消息边界。
*   TCP/IP 套接字可以连接任何进程，甚至可以通过网络连接，但具有更高的开销并且没有固有的消息边界。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-01T21:39:19.067

值得注意的是，许多库在另一种之上实现了一种类型的东西。

共享内存不需要使用可怕的 sysv 共享内存函数 - 使用 mmap() 更优雅（如果你想命名它，将文件 mmap 到 tmpfs /dev/shm ；如果你想 mmap /dev/zero分叉未执行的进程以匿名继承它）。话虽如此，它仍然使您的进程需要同步以避免问题 - 通常通过使用其他一些 IPC 机制来同步访问共享内存区域。

# .net - 为产品的多个版本开发代码库

> ID：404606
> 
> 赞同：4
> 
> 时间：2009-01-01T05:59:50.197
> 
> 标签：.net, scripting, build-process

我知道这是可能的，因为有很多可用的软件包，其中你有一个“标准”、“专业”和“企业”版本的软件包......但是有没有人有任何关于 uISV 将如何进行的像样的教程学习开发分层功能软件所涉及的技术？

我已经通过您通常使用的不同渠道（谷歌、MSDN 等）进行了多次搜索，但到目前为止都是空的。

任何想法/建议将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T14:47:40.910

最简单的方法是创建一个包含所有功能的程序，并根据产品密钥启用/禁用它们。

第二种选择可能是为您的程序创建一个最小架构，并使用插件架构来添加更多功能。这意味着您可以仅部署您正在部署的版本所需的部分。

使用 .net，您可以查看 System.AddIn 命名空间或反射的东西......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T15:06:18.783

我会寻求更简单的解决方案：

*   将您的代码放入程序集中
*   创建仅包含主窗体以及每个版本的菜单和工具栏的 shell 项目。菜单和工具栏应该只激活程序集中的表单/功能。

这样您就不需要配置文件来启用/禁用功能，如果您将所有内容都放入一个应用程序中，则没有您应该拥有的“功能访问”代码。此外，您的用户不可能破解您的应用程序或密钥并访问他未付费的功能。

缺点是您不能仅通过发送新密钥将用户从“标准”升级到“专业”，用户必须下载并安装新应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T08:01:31.603

您可能想查看 .Net Membership Provider 中基于角色的安全性（假设它是一个 Web 应用程序）。您可以添加角色“第 1 层”和“第 2 层”，也可以为层允许用户使用的每个功能添加角色。然后在实现分层功能的页面上，如果 user.IsInRole("featurename") 显示它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T08:45:09.567

这取决于您要阻止用户使用哪些功能。如果您的所有功能都是独立的，那么 Bramha 的解决方案是一个很好的解决方案，但如果您的功能不是，那么这是一个完全不同的故事，您需要开发一个内部“框架”，允许对每个功能进行抽象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T15:38:54.380

我可能会使用编译器指令来分离这些功能。这样，您拥有一个代码库，但可以在您的应用程序中“编译”几个不同的功能。如果您编译所有内容并使用不同的序列号将功能分开，那么盗版者将非常容易。毕竟，如果功能不存在，躲闪的连续剧就无法解锁这些功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T15:50:31.080

从软件盗版的角度来看，您可能希望使用条件编译（使用[#define 和 #if](http://msdn.microsoft.com/en-us/library/yt3yck0x.aspx)）或单独的程序集 - 基本上：如果标准或试用版中不提供某个功能，请不要禁用它，而是将其完全删除。

如果您尝试使用某种全局枚举“LICENSETYPE { Standard, Enterprise }”，请记住，看起来像[Crack.net](http://www.codeplex.com/cracknetproject)存在可以轻松更改它。

另一方面：只有一个包含所有功能的可执行文件，并基于每个密钥启用/禁用它们，这使得部署和版本管理变得更加容易。

# c - 在 C 中减少内存使用的最佳实践是什么？

> ID：404615
> 
> 赞同：42
> 
> 时间：2009-01-01T06:05:17.610
> 
> 标签：c, optimization, memory-management

什么是“内存高效 C 编程”的一些最佳实践。主要针对嵌入式/移动设备，低内存消耗的指导方针是什么？

我想应该有单独的指导方针 a) 代码存储器 b) 数据存储器

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-01T09:56:57.143

在 C 中，在更简单的层面上，考虑以下内容；

*   使用 #pragma pack(1) 对结构进行字节对齐
*   在结构可以包含不同类型数据的情况下使用联合
*   使用位域而不是整数来存储标志和小整数
*   避免使用固定长度的字符数组来存储字符串，实现字符串池和使用指针。
*   在存储对枚举字符串列表的引用（例如字体名称）时，将索引存储到列表中而不是字符串
*   使用动态内存分配时，请提前计算所需的元素数量以避免重新分配。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-01T14:40:01.083

我发现在使用嵌入式系统时有用的一些建议：

*   确保任何查找表或其他常量数据实际上是使用`const`. 如果`const`使用，则数据可以存储在只读（例如，闪存或 EEPROM）存储器中，否则数据必须在启动时复制到 RAM，这会占用闪存和 RAM 空间。设置链接器选项，使其生成映射文件，并研究此文件以准确查看数据在内存映射中的分配位置。

*   确保您使用了所有可用的内存区域。例如，微控制器通常具有可供您使用的板载内存（访问速度也可能比外部 RAM 更快）。您应该能够使用编译器和链接器选项设置来控制代码和数据分配到的内存区域。

*   要减少代码大小，请检查编译器的优化设置。大多数编译器都有开关来优化速度或代码大小。值得尝试使用这些选项来查看是否可以减少编译代码的大小。显然，尽可能消除重复代码。

*   检查您的系统需要多少堆栈内存并相应地调整链接器内存分配（请参阅[此问题](https://stackoverflow.com/questions/389219/how-to-determine-maximum-stack-usage)的答案）。为了减少堆栈的使用，请避免在堆栈上放置大型数据结构（对于任何与您相关的“大”值）。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-01T19:05:35.070

确保尽可能使用定点/整数数学。当简单的缩放整数数学就足够时，许多开发人员使用浮点数学（以及缓慢的性能和大型库和内存使用）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-27T22:36:17.900

所有好的建议。以下是我发现有用的一些设计方法。

*   字节编码

为特殊用途的字节码指令集编写解释器，并在该指令集中编写尽可能多的程序。如果某些操作需要高性能，请将它们设为本机代码并从解释器中调用它们。

*   代码生成

如果部分输入数据很少更改，您可以使用外部代码生成器来创建临时程序。这将比更通用的程序更小，并且运行速度更快，并且不必为很少更改的输入分配存储空间。

*   成为数据仇恨者

如果它能让你存储绝对最小的数据结构，那就愿意浪费很多周期。通常你会发现性能受到的影响很小。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-01T07:52:34.010

通过使用您自己的内存分配器（或小心使用系统的分配器）来避免内存碎片。

一种方法是使用“slab 分配器”（例如，参见[本文](http://www.ibm.com/developerworks/linux/library/l-linux-slab-allocator/?ca=dgr-lnxw16LinuxSlabAllo)）和多个内存池用于不同大小的对象。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-01T06:41:52.967

您很可能需要仔细选择算法。针对具有 O(1) 或 O(log n) 内存使用（即低）的算法。例如，`std::vector`在大多数情况下，连续可调整大小的数组（例如 ）比链表需要更少的内存。

有时，使用查找表可能更有益于代码大小*和*速度。如果 LUT 中只需要 64 个条目，那么与大型 sin/cos/tan 函数相比，sin/cos/tan（使用对称性！）是 16*4 字节。

压缩有时会有所帮助。像 RLE 这样的简单算法在顺序读取时很容易压缩/解压缩。

如果您正在处理图形或音频，请考虑不同的格式。调色板或 bitpacked* 图形可能是质量的良好折衷，并且调色板可以在许多图像之间共享，从而进一步减少数据大小。音频可能会从 16 位降低到 8 位甚至 4 位，并且可以将立体声转换为单声道。采样率可以从 44.1KHz 降低到 22kHz 或 11kHz。这些音频转换大大减少了它们的数据大小（遗憾的是，质量）并且是微不足道的（除了重新采样，但这就是音频软件的用途=]）。

* 我想你可以把它压缩。图形的位打包通常是指减少每个通道的位数，以便每个像素可以容纳两个字节（例如 RGB565 或 ARGB155）或一个（ARGB232 或 RGB332），而不是原来的三个或四个（分别为 RGB888 或 ARGB8888）。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-01T06:10:43.623

预先分配所有内存（即除了启动初始化之外没有 malloc 调用）对于确定性内存使用肯定有帮助。否则，不同的架构提供了帮助的技术。例如，某些 ARM 处理器提供了一个替代指令集 (Thumb)，通过使用 16 位指令而不是普通的 32 位指令，该指令集几乎将代码大小减半。当然，这样做会牺牲速度......

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-01T14:08:51.240

一些解析操作可以在字节到达时对流执行，而不是复制到缓冲区并解析。

这方面的一些例子：

1.  使用状态机解析 NMEA 流，仅将所需字段收集到更高效的结构中。
2.  使用 SAX 而不是 DOM 解析 XML。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-01T14:18:12.077

1）在你开始项目之前，建立一种测量你正在使用多少内存的方法，最好是在每个组件的基础上。这样，每次进行更改时，您都可以看到它对内存使用的影响。你无法优化你无法衡量的东西。

2）如果项目已经成熟并达到内存限制，（或移植到内存较少的设备），请找出您已经使用内存的目的。

我的经验是，在修复超大应用程序时，几乎所有重要的优化都来自少量更改：减少缓存大小，去除一些纹理（当然这是需要利益相关者同意的功能更改，即会议，因此可能在您的时间方面效率不高），重新采样音频，减少自定义分配堆的前期大小，找到释放仅临时使用的资源并在再次需要时重新加载它们的方法。偶尔你会发现一些 64 字节的结构可以减少到 16 字节，或者其他什么，但这很少是最容易实现的结果。但是，如果您知道应用程序中最大的列表和数组是什么，那么您就知道首先要查看哪些结构。

哦，是的：查找并修复内存泄漏。您可以在不牺牲性能的情况下恢复任何记忆都是一个很好的开始。

过去我花了*很多*时间担心代码大小。主要考虑因素（除了：确保您在构建时对其进行测量，以便您可以看到它的变化）是：

1）找出引用了哪些代码，以及引用了什么。如果您发现整个 XML 库被链接到您的应用程序只是为了解析一个二元素配置文件，请考虑更改配置文件格式和/或编写您自己的简单解析器。如果可以的话，使用源代码或二进制分析来绘制一个大的依赖图，并寻找只有少数用户的大型组件：可能只需要少量的代码重写就可以将它们剪掉。准备好扮演外交官：如果您的应用程序中有两个不同的组件使用 XML，并且您想要削减它，那么您必须让这两个人相信手动滚动当前受信任的现成库的好处.

2）弄乱编译器选项。请查阅特定于平台的文档。例如，您可能希望减少由于内联而导致的默认可接受的代码大小增加，并且在 GCC 上，您至少可以告诉编译器仅应用通常不会增加代码大小的优化。

3) 尽可能利用目标平台上已有的库，即使这意味着编写适配器层。在上面的 XML 示例中，您可能会发现在您的目标平台上，内存中始终存在一个 XML 库，因为操作系统使用它，在这种情况下动态链接到它。

4）正如其他人提到的，拇指模式可以帮助ARM。如果您只将它用于对性能不重要的代码，而将关键例程留在 ARM 中，那么您将不会注意到差异。

最后，如果您对设备有足够的控制权，您可能会玩一些巧妙的技巧。UI 一次只允许一个应用程序运行？卸载您的应用不需要的所有驱动程序和服务。屏幕是双缓冲的，但您的应用程序与刷新周期同步？您可能能够回收整个屏幕缓冲区。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-18T06:34:28.977

推荐这本书[小内存软件：内存有限系统的模式](https://rads.stackoverflow.com/amzn/click/com/0201596075)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-09-07T16:31:16.087

*   尽量减少字符串常量的长度并消除尽可能多的字符串常量以减少代码空间

*   在需要时仔细考虑算法与查找表的权衡

*   请注意如何分配不同类型的变量。

    *   常量可能在代码空间中。
    *   静态变量可能位于固定的内存位置。尽可能避免这些。
    *   参数可能存储在堆栈或寄存器中。
    *   局部变量也可以从堆栈中分配。如果代码在最坏的情况下可能会耗尽堆栈空间，请不要声明大型本地数组或字符串。
    *   您可能没有堆 - 可能没有操作系统来为您管理堆。这可以接受吗？你需要一个 malloc() 函数吗？

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-09-07T17:12:43.897

除了其他人给出的建议之外，请记住，在您的函数中声明的局部变量通常会在堆栈上分配。

如果堆栈内存有限，或者您想减小堆栈大小以便为更多堆或全局 RAM 腾出空间，请考虑以下事项：

1.  *展平您的调用树*以减少任何给定时间堆栈上的变量数量。
2.  *将大型局部变量转换为全局变量*（减少使用的堆栈数量，但增加使用的全局 RAM 数量）。可以声明变量：

    *   全局范围：对整个程序可见
    *   文件范围内的静态：在同一文件中可见
    *   函数范围内的静态：在函数内可见
    *   **注意：**[`reentrant`](http://en.wikipedia.org/wiki/Reentrant_%28subroutine%29)无论如何，如果进行了这些更改，如果您有[`preemptive`](http://en.wikipedia.org/wiki/Preemption_%28computing%29)环境，则必须警惕代码问题。

许多嵌入式系统没有堆栈监视器诊断以确保捕获[堆栈溢出](http://en.wikipedia.org/wiki/Stack_overflow)，因此需要进行一些分析。

*PS：适当使用Stack Overflow*的奖励？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-09T08:18:17.843

我有一个来自嵌入式系统会议的关于这个主题的演讲。它是从 2001 年开始的，但它仍然非常适用。见[论文](http://www.engbloms.se/publications/engblom-esc-sf-2001.pdf)。

此外，如果您可以选择目标设备的架构，例如使用带有 Thumb V2 的现代 ARM，或者带有 VLE 的 PowerPC，或者带有 MIPS16 的 MIPS，或者选择像 Infineon TriCore 或 SH 系列这样的已知紧凑型目标，那么非常好的选择。更不用说非常紧凑的 NEC V850E 系列了。或者转移到具有出色代码紧凑性的 AVR（但是是 8 位机器）。除了固定长度的 32 位 RISC 之外的任何东西都是不错的选择！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-04-07T13:02:36.393

另一个有用的技巧是使用#define 而不是那些值不会改变的变量。例如：如果某些东西被定义为 const，则用#define 替换它，因为它们在预处理器阶段被解码并且不占用空间。定义的任何其他数据类型都需要内存空间。这将有助于减少内存使用量。这仅适用于不关心变量类型的情况，因为#define 不会处理它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-02T07:27:17.320

限制内存需求的一个好方法是尽可能多地依赖 libc 或其他可以动态链接的标准库。您必须在项目中包含的每个附加 DLL 或共享对象都是您可以避免烧毁的重要内存块。

此外，在适用的情况下，使用联合和位字段，仅加载程序在内存中处理的部分数据，并确保使用 -Os（在 gcc 中；或您的编译器的等效项）切换到优化程序大小。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-01T14:30:48.323

在应用程序中有用的一个技巧是创建一个未雨绸缪的内存基金。在启动时分配足够大的单个块，足以完成清理任务。如果 malloc/new 失败，释放未雨绸缪的资金并发布消息，让用户知道资源紧张，他们应该尽快保存。这是 1990 年左右在许多 Mac 应用程序中使用的一种技术。

# php - 在 Flash 应用程序中禁用 PHP 或 JavaScript 中的浏览器缓存

> ID：404617
> 
> 赞同：11
> 
> 时间：2009-01-01T06:05:43.710
> 
> 标签：php, javascript

我们正在用 PHP 开发一个 Flash 网站。问题是它存储缓存，但我们必须使用 JavaScript 或 PHP 禁用缓存。

如何禁用缓存？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-01T06:28:37.110

禁用浏览器缓存的常见做法是在 HTTP 标头中将过期日期设置为过去的日期。不同的浏览器以不同的方式使用 HTTP 标头值，因此使用以下设置很重要（如果不是全部的话）：

```
<?php
header("Expires: Tue, 01 Jan 2000 00:00:00 GMT");
header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
header("Cache-Control: no-store, no-cache, must-revalidate, max-age=0");
header("Cache-Control: post-check=0, pre-check=0", false);
header("Pragma: no-cache");
?> 
```

[在 PHP 网站上](http://www.php.net/header)阅读有关[该`header`](http://www.php.net/header)功能的更多信息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-01T12:32:50.543

尝试使用查询字符串加载电影，这应该会禁用缓存。请注意，查询字符串每次都应该不同。

```
<parm name='movie' value='movie.swf?ran=sfkjfsdkf23123'> 
```

例如，您可以使用 php 创建一个随机查询字符串。

# c# - 任何 Windows 窗体应用程序最常见的设计模式是什么？

> ID：404624
> 
> 赞同：9
> 
> 时间：2009-01-01T06:09:22.097
> 
> 标签：c#, winforms, design-patterns

我在问这个问题，因为我将使用 c# 开发一个客户端应用程序来显示股票数据并进行一些用户交互，所以给我你之前阅读的最佳教程的链接

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-26T21:05:54.387

[Jeremy Miller 的指南](http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx)是一个很好的起点。它涵盖了几个重要的模式，包括：

*   [模型 - 视图 - 控制器](http://codebetter.com/blogs/jeremy.miller/archive/2007/05/23/build-your-own-cab-part-2-the-humble-dialog-box.aspx)- 有几种风格，确保你检查它们
*   GUI绑定代码的[自动化单元测试](http://codebetter.com/blogs/jeremy.miller/archive/2007/06/26/build-your-own-cab-part-10-unit-testing-the-ui-with-nunitforms.aspx)
*   [命令模式](http://codebetter.com/blogs/jeremy.miller/pages/build-your-own-cab-14-managing-menu-state-with-microcontroller-s-command-s-a-layer-supertype-some-structuremap-pixie-dust-and-a-dollop-of-fluent-interface.aspx)
*   [登记处](http://codebetter.com/blogs/jeremy.miller/archive/2008/01/15/build-your-own-cab-17-boil-down-the-quot-wiring-quot-to-a-registry.aspx)

您还需要查看控制反转和依赖反转。 [Fowler 的概述](http://martinfowler.com/articles/injection.html)很好地解释了这个概念。当你看到这个时，这里是一个关于 IoC 工具的一个实现的 [教程。](http://aspadvice.com/blogs/insane_world/archive/2007/06/25/Windsor-Container-Tutorials-_2D00_-BitterCoder_2700_s-Wiki.aspx)

如果您仍然渴望更多，请查看[Rich Newman](http://richnewman.wordpress.com/intro-to-cab-toc/)关于 Microsoft 的复合应用程序块的系列。CAB 充满了模式，但要避免官方文档，因为它非常困难。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T06:15:44.237

为了回答您的问题，根据我的经验，最常见的模式似乎是通用黑客攻击，但是如果您想要一个不错的模式，请查看 Microsoft 模式和实践组的[MVP（模型视图演示器）](http://www.codeplex.com/websf/Wiki/View.aspx?title=MVP_landing_page)模式。尽管它是一种 ASP.NET 模式，但我对其稍作修改以始终在 Winforms 上使用。

这是一个很好的关注点分离，并允许通过对接口的编程来构建单元测试（按组合设计）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T17:33:21.870

这只是部分答案，但我真的很喜欢参考[Windows Vista 用户体验/交互指南](http://msdn.microsoft.com/en-us/library/aa511258.aspx)（整个内容也有一个 pdf 链接）。当然，其中大部分都是为了使您的应用程序的外观和感觉与 Vista 相匹配。

但是，其中一些普遍适用——**尤其是**关于警告、错误和其他消息的差异以及何时使用它们的部分。我发现自己每次处理会弹出窗口的东西时都会检查这些指导方针——在追查微软程序违反这些指导方针时，该指导并没有采取任何措施。

我不知道 Windows XP 存在这样的指南。

# windows - 复制 Windows XP 上正在运行的进程使用的 dll 是否安全？

> ID：404646
> 
> 赞同：2
> 
> 时间：2009-01-01T06:28:33.883
> 
> 标签：windows, dll, process

这是在 Windows XP 上。

我有一个正在运行的进程（我想继续运行）。如果我复制它使用的 dll（例如，将其替换为较新的版本），这是否会导致正在运行的进程出现问题，或者代码是否已经加载而无关紧要？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T06:39:17.917

您不应该能够复制正在运行的进程正在使用的 dll。为了替换 dll，需要将其标记为删除并在下次重新启动时替换。如果您希望手动执行此操作，则需要停止该过程。

如果你*可以*复制它 - 那么你怀疑的 dll 没有在使用中，如果它是后期绑定的，那么你*可以*在进程没有主动锁定它的时候复制它 - 并提供dll对活动进程没有任何不利影响，应该没问题。

当然，对所讨论的dll一无所知，也不知道在开发所述dll时使用的内部结构或编程标准——我无法以一种方式或另一种方式说。

但请注意，复制任何 dll 都有可能对依赖它的应用程序产生不利影响，其中包括您的操作系统。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T06:42:52.683

行为将始终是特定于过程的。一些进程获取卷影副本，一些锁定 DLL，另一些加载到内存并忘记文件系统，直到下次加载。

即使您可以覆盖 DLL，该进程也不太可能在重新启动之前对更改做出反应。也许它会自动重启。（运行 ASP.NET 应用程序的 IIS 就是一个例子）。你只需要尝试一下。

可能永远不可取。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T06:33:42.640

我相信 DLL 在使用时会保持打开状态，因此您将无法对其进行写入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T14:04:22.090

通常，您应该避免这种做法。虽然理论上它可能会起作用，特别是如果您控制长时间运行的进程和 DLL，并且可以保证没有其他人需要它，Windows 真的不喜欢做这种事情。

我建议阅读 Raymond Chen 最近 2008 年 11 月在 Technet 上的文章（“ [Windows 可以但不会](http://technet.microsoft.com/en-us/magazine/2008.11.windowsconfidential.aspx)”），以了解有关为什么这通常不是一个好的做法以及为什么应用程序安装程序经常需要重新启动的更多信息。

# c# - 如何在选择更改时获取 DataGridView 中的特定单元格

> ID：404651
> 
> 赞同：3
> 
> 时间：2009-01-01T06:32:14.157
> 
> 标签：c#, winforms, datagridview, selectionchanged

使用列表框，我有以下代码来提取所选项目：

```
 private void inventoryList_SelectedIndexChanged(object sender, EventArgs e)
    {
        String s = inventoryList.SelectedItem.ToString();
        s = s.Substring(0, s.IndexOf(':'));
        bookDetailTable.Rows.Clear();
        ...
        more code
        ...
    } 
```

I want to do something similar for a DataGridView, that is, when the selection changes, retrieve the contents of the first cell in the row selected. 问题是，我不知道如何访问该数据元素。

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-01T06:56:20.283

我认为这就是你要找的。但如果没有，希望它会给你一个开始。

```
private void dataGridView1_SelectionChanged(object sender, EventArgs e)
{
    DataGridView dgv = (DataGridView)sender;

    //User selected WHOLE ROW (by clicking in the margin)
    if (dgv.SelectedRows.Count> 0)
       MessageBox.Show(dgv.SelectedRows[0].Cells[0].Value.ToString());

    //User selected a cell (show the first cell in the row)
    if (dgv.SelectedCells.Count > 0)
        MessageBox.Show(dgv.Rows[dgv.SelectedCells[0].RowIndex].Cells[0].Value.ToString());

    //User selected a cell, show that cell
    if (dgv.SelectedCells.Count > 0)
        MessageBox.Show(dgv.SelectedCells[0].Value.ToString());
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-02-03T05:17:00.293

这是使用列名解决此问题的另一种方法。

```
private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)
{
   var senderGrid = (DataGridView)sender;
   if (senderGrid.Columns[e.ColumnIndex] is DataGridViewButtonColumn && e.RowIndex >= 0)
   {
      if (e.ColumnIndex == dataGridView1.Columns["ColumnName"].Index)
      {
        var row = senderGrid.CurrentRow.Cells;
        string ID = Convert.ToString(row["columnId"].Value); //This is to fetch the id or any other info
        MessageBox.Show("ColumnName selected");
      }
   }
} 
```

如果您需要从该选定行传递数据，您可以通过这种方式将其传递给另一个表单。

```
Form2 form2 = new Form2(ID);
form2.Show(); 
```

# algorithm - 计算最佳库存长度

> ID：404675
> 
> 赞同：1
> 
> 时间：2009-01-01T07:25:30.350
> 
> 标签：algorithm

这类似于[切削库存问题](http://en.wikipedia.org/wiki/Cutting_stock_problem)，但略有不同。我想根据切口的大小找出最佳的库存长度。

潜在并发症：

1.  关于切割库存问题的维基百科文章让我头疼。我怀疑了解如何解决这个问题可能对解决我自己的问题至关重要。

2.  一些切割长度比其他切割长度更常见。任何小于 2 英尺的东西都被视为废品，因此我们宁愿不要进行会留下大块废品的切割。另一方面，我们不想持有大量的部分库存，希望有一天我们可能需要其中的一个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T13:21:32.223

我是否正确理解这一点：您有不同的切割长度（3.6、10.2、8.3、7.3，...），并且您想找出最能减少切割浪费的库存长度？您只想找到一个库存长度还是多个？有最大长度，最小长度吗？如果您没有最大长度，最好的选择是使用一种非常长的库存，其中所有切割长度都完全适合，但我认为这不是您想要的..

**更新**作为我工作的一部分，我一直在研究这个问题一段时间，我们有一个产品可以做到这一点（以及更多）。对于一个简单的解决方案，您可以实现一个适用于给定库存长度的[First Fit Decreasing](http://www.google.com/search?&q=first+fit+decreasing)启发式。然后随机使用几个库存长度，每次都使用启发式来填充它们。记住浪费最少的库存长度。

如果您想要更高级的算法，我建议您购买我们的软件 :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T08:31:56.537

问题还取决于您要使用的股票 S 的数量。

如果 S=1，那么库存长度应该是所有切割尺寸的总和。

如果 S>1，那么你想将切割的大小分成 S 组，并最小化每组中切割大小总和之间的差异。这非常接近 NP-hard 的[分区问题](http://en.wikipedia.org/wiki/Partition_problem)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T09:26:02.900

看来你有这个或类似的优化问题的“在线”版本。在线意味着您事先不知道所有信息，即您必须在订单进来时做出决定。

# ruby - Ruby：比 Java/C# 更灵活？

> ID：404676
> 
> 赞同：3
> 
> 时间：2009-01-01T07:28:38.910
> 
> 标签：ruby, programming-languages, syntax, language-features, dynamic-languages

是我是一个学习 Ruby 的新手，还是它真的有比 Java/C# 更多的方法来编写（相同的）东西？另外，如果它比 Java 更灵活，那么 Ruby 是否有任何语言特性通常**不**使用以避免混淆？

示例可能是并行分配以及编写字符串的所有不同方式，也许？

**注意：**我不是要与 Java/C# 进行比较......请只是这个语言问题......

**编辑：**我知道 C#、Java 和 Ruby 是强类型的，并且只有 Ruby（如 Python 和其他）是动态类型的（而 Java/C# 是静态类型的）。一些答案说动态类型语言更灵活。这一定是真的吗？它如何影响语法？**我只是在问句法灵活性。**

（据我所见，PHP 也是动态类型的，它似乎**并不比 Java/C# 更灵活。同样，我的意思是在语法方面，而不是在部署方面或任何其他方面......）**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-01T09:46:59.940

对我而言，Ruby 中最常用而 Java 中缺少的特性是代码块/lambdas/闭包。

另一个很棒（但可能很危险）的特性是开放类——你可以改变你想要的任何类——添加新方法、改变旧方法等。你甚至可以将方法添加到特定对象，而不是整个类:)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-01T08:25:12.523

另一种与 Ruby 非常相似的动态语言是 Python。然而，在[Python 之禅中](http://www.python.org/dev/peps/pep-0020/)，其中一条规则规定“应该有一种，而且只有一种做某事的方式”。这与 Ruby 截然相反，Ruby 允许进行如此多的元编程，以至于基本上有无数种方法可以做同样的事情。

也就是说，直到 Python 3.0（又名：3000）字符串和 unicode 值都是不同的类型，这有点讽刺。虽然这是有道理的，但人们有时会遇到在两者之间进行大量转换以执行文本操作的问题。

如果您有选择，我几乎建议您使用 Python 作为对动态语言的介绍。Ruby 并没有什么问题，但是您可能会发现您会遇到更少的情况，即做某事的“正确”方法并不完全显而易见。

**响应 PHP 被动态输入：**

PHP 的类型系统很灵活，允许根据使用的上下文自动转换类型。然而，这实际上并不能生成真正的动态类型。例如，语言本身大部分是静态的，并且不允许您在运行时向对象添加属性（至少，我上次检查时）。

Python，很可能是 Ruby，实际上是强类型的，这意味着您可以自信地进行类型比较，而不能使用 PHP 技巧，例如添加数字字符串以获取数字。真正的动态语言通常还允许元分类，您可以在其中调整实例或类的类型，或向其中任何一个添加属性，所有这些都在运行时进行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T07:38:51.713

Ruby 是一种动态语言。C# 和 Java 都是具有强类型的静态类型语言。v4.0 中的 C# 将添加动态功能，但到目前为止，Java 和 C# 与动态语言（如 Ruby 和 Python）相比，具有完全不同且更严格的范式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-16T18:43:59.063

我评论了上面关于 lambda 的 rkj 的回答。此代码演示了您要求的示例；

```
def abs(n); (n < 0) ? -n : n; end
def square(n); n * n; end
def average(x, y); (x + y) / 2; end

def fixed_point(x, point, process, test)
  return point if test.call(x, point)
  fixed_point(x, process.call(x, point), process, test)
end

def sqrt(n)
  process = lambda {|n,g| average g, (n/g) }
  test = lambda {|n,g| abs(square(g) - n) < 0.001} 
  fixed_point(n, 1.0, process, test)
end 
```

首先要注意的一点是，该`fixed_point`方法处理的一般思想是逐步将过程应用于某些数据，直到它通过某个测试。该`sqrt`函数定义了求平方根的过程和确定何时满足的测试。然后像任何其他形式的数据一样传递这些“程序”，这样就`fixed_point`可以发挥它的魔力。

而不是临时存储过程和测试整个事情可以是匿名的。我们可以重写`sqrt`为；

```
def sqrt(n)
  fixed_point( n, 1.0, 
      lambda {|n,g| average g, (n/g)},
      lambda {|n,g| abs(square(g) - n) < 0.001} )
end 
```

如果没有这种能力，我将不得不将流程和测试都定义为单独的函数，并创建一个特殊的`sqrt_fixed_point`函数来调用它们。据我所知，Java 可以使用 Functor 做类似的事情，但我不知道如何评论。我在博客或类似文章中看到的共识是，Java 使这变得非常复杂，以至于您尝试一下就会流鼻血。

当然，Ruby 提供的另一个选择是元编程。我可以重写`sqrt`，以便它`fixed_point`使用正确的过程和测试（即时）重写，但这可能是对该功能的滥用:-)

附言。发布的 JoelOnSoftware 链接值得重复；[http://www.joelonsoftware.com/items/2006/08/01.html](http://www.joelonsoftware.com/items/2006/08/01.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T08:07:03.420

所有动态类型语言（如 Ruby）通常比静态类型语言（如 Java）更灵活。您不必与类型系统作斗争，而您通常最终会在静态类型语言中这样做。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-01-01T11:07:18.813

我不知道 Java 或 C#，但我让你可以重新定义 + 如何在数字上工作的事实不言自明。

# apache - mod_rewrite：检查 URL 中的自定义查询字符串？

> ID：404684
> 
> 赞同：3
> 
> 时间：2009-01-01T07:40:02.663
> 
> 标签：apache, url-rewriting

我正在尝试在我的新项目中使用 URL 重写。但我还需要在 URL 中允许自定义查询字符串。

我只想知道如何为这个 URL 写重写规则

> [http://www.mysite.com/edit/123/?q1=value1&q2=value2](http://www.mysite.com/edit/123/?q1=value1&q2=value2)

成为这个

> [http://www.mysite.com/index.php?action=edit&id=123&q1=value1&q2=value2](http://www.mysite.com/index.php?action=edit&id=123&q1=value1&q2=value2)

自定义查询字符串应允许无限制。

百万感谢...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T08:50:56.670

只需像任何其他规则一样执行您的规则，并在末尾添加 QSA 修饰符（查询字符串附加）。

```
RewriteEngine On
RewriteRule ^/([A-Za-z0-9]+)/([0-9]+)/$ index.php?action=$1&id=$2 [L,QSA] 
```

# forms - 电子表格引擎解决方案

> ID：404689
> 
> 赞同：2
> 
> 时间：2009-01-01T07:45:49.437
> 
> 标签：forms, validation, webforms

我的客户要求由精通技术的用户（而不是开发人员）完成处理电子表单生成的解决方案。换句话说，一个用于动态创建和实现电子表格的电子表格引擎。

市场上是否有任何工具/解决方案可以处理此要求？我很想避免从头开始构建它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T07:53:38.407

什么是域？表格会发生什么 - 电子邮件/数据库保存？什么样的表格——它们是调查、发票等。用户填写然后提交（将数据保存在某处）的 pdf 是否足够好？是否应该有一个用户认证片？

我认为您会通过更多信息获得更好的回应。

* * *

编辑：当我需要整理一个快速而肮脏的数据收集片段时，我会使用[谷歌调查。](https://drive.googleblog.com/2008/02/stop-sharing-spreadsheets-start.html)它非常擅长它的作用。我用它从我的足球队收集花名册信息和比赛可用性。根据您的最终用户是谁，以及您希望他们拥有什么样的体验，它可能会奏效。这是愚蠢的简单。

# c# - 这些代码示例中哪一个具有更好的性能？

> ID：404698
> 
> 赞同：3
> 
> 时间：2009-01-01T08:04:46.497
> 
> 标签：c#, performance

在回答[我的一个问题](https://stackoverflow.com/questions/391503/if-condition-continue-or-if-condition-style-preference)时，我收到了许多回答说样式 2 可能比样式 1 执行得更好。我不明白怎么做，因为我相信它们应该发出基本相同的机器指令（如果用 C++ 编写）。您能否解释一下为什么样式 2 可能表现更好？

我将在这里重写这两种样式以便于参考：

*样式 1*：

```
while (!String.IsNullOrEmpty(msg = reader.readMsg()))
{
    RaiseMessageReceived();
    if (parseMsg)
    {
        ParsedMsg parsedMsg = parser.parseMsg(msg);
        RaiseMessageParsed();
        if (processMsg)
        {
            process(parsedMsg);
            RaiseMessageProcessed();
        }
    }
} 
```

*风格二：*

```
while (!String.IsNullOrEmpty(msg = reader.readMsg()))
{
    RaiseMessageReceived();
    if (!parseMsg) continue;

    ParsedMsg parsedMsg = parser.parseMsg(msg);
    RaiseMessageParsed();
    if (!processMsg) continue;

    process(parsedMsg);
    RaiseMessageProcessed();
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-01T08:21:08.977

我认为如果性能完全不同，性能差异将可以忽略不计。无论如何，编译器可能会将它们优化为相同的形式。

唯一的实质性区别是风格。

我喜欢样式 1 只是因为循环有一个入口点（每次迭代）和一个出口点（每次迭代），因此很容易在循环末尾插入调试代码并知道它会被调用。这与函数的一个入口和出口点背后的原理相同（出于相同的原因）。话虽这么说，但太多的缩进可能很难阅读，所以 continue 也有它的位置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-01T13:34:58.233

我不得不检查一下。

这是我的代码版本：

```
using System;
using System.Collections.Generic;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            Tester t=new Tester();
            t.Method1(new Stack<string>(), new MsgParser(), true, true);
            t.Method2(new Stack<string>(), new MsgParser(), true, true);
        }
    }
    class Tester
    {
        public void Method1(Stack<string> strings, MsgParser parser, bool parseMsg, bool processMsg)
        {
            string msg;
            while (!String.IsNullOrEmpty(msg = strings.Pop()))
            {
                RaiseMessageReceived();
                if (parseMsg)
                {
                    ParsedMsg parsedMsg = parser.ParseMsg(msg);
                    RaiseMessageParsed();
                    if (processMsg)
                    {
                        process(parsedMsg);
                        RaiseMessageProcessed();
                    }
                }
            }
        }

        public void Method2(Stack<string> strings, MsgParser parser, bool parseMsg, bool processMsg)
        {
            string msg;
            while (!String.IsNullOrEmpty(msg = strings.Pop()))
            {
                RaiseMessageReceived();
                if (!parseMsg) continue;

                ParsedMsg parsedMsg = parser.ParseMsg(msg);
                RaiseMessageParsed();
                if (!processMsg) continue;

                process(parsedMsg);
                RaiseMessageProcessed();
            }

        }

        private void RaiseMessageProcessed()
        {
            Console.WriteLine("Done");
        }

        private void process(ParsedMsg msg)
        {
            Console.WriteLine(msg);
        }

        private void RaiseMessageParsed()
        {
            Console.WriteLine("Message parsed");
        }

        private void RaiseMessageReceived()
        {
            Console.WriteLine("Message received.");
        }
    }

    internal class ParsedMsg
    {
    }

    internal class MsgParser
    {
        public ParsedMsg ParseMsg(string msg)
        {
            return new ParsedMsg();
        }
    }
} 
```

我使用代码优化（默认发布配置）构建它，并使用反射器反汇编程序集。结果验证两种样式是否相同：

```
internal class Tester
{
    // Methods
    public void Method1(Stack<string> strings, MsgParser parser, bool parseMsg, bool processMsg)
    {
        string msg;
        while (!string.IsNullOrEmpty(msg = strings.Pop()))
        {
            this.RaiseMessageReceived();
            if (parseMsg)
            {
                ParsedMsg parsedMsg = parser.ParseMsg(msg);
                this.RaiseMessageParsed();
                if (processMsg)
                {
                    this.process(parsedMsg);
                    this.RaiseMessageProcessed();
                }
            }
        }
    }

    public void Method2(Stack<string> strings, MsgParser parser, bool parseMsg, bool processMsg)
    {
        string msg;
        while (!string.IsNullOrEmpty(msg = strings.Pop()))
        {
            this.RaiseMessageReceived();
            if (parseMsg)
            {
                ParsedMsg parsedMsg = parser.ParseMsg(msg);
                this.RaiseMessageParsed();
                if (processMsg)
                {
                    this.process(parsedMsg);
                    this.RaiseMessageProcessed();
                }
            }
        }
    }

    private void process(ParsedMsg msg)
    {
        Console.WriteLine(msg);
    }

    private void RaiseMessageParsed()
    {
        Console.WriteLine("Message parsed");
    }

    private void RaiseMessageProcessed()
    {
        Console.WriteLine("Done");
    }

    private void RaiseMessageReceived()
    {
        Console.WriteLine("Message received.");
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-01T08:19:27.857

最好的答案是查看生成的字节码/程序集并查看。然后忽略你所看到的，因为优化的 JIT 编译器无论如何都会根据对执行代码的实时分析来改变它。所以坚持使用最能表达意图的风格。

也就是说，样式 2 应该直接跳回条件，而样式 1 可以想像跳转通过 if 块只是再次跳转到条件。

这必须是我所见过的不过早优化的最佳示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T08:19:19.633

性能应该是相同的，无论谁说其他话一定是......困惑。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T08:20:51.957

为什么不从 Jeff 的书中学习一下，并像[这个问题](https://stackoverflow.com/questions/232848/wrapping-stopwatch-timing-with-a-delegate-or-lambda#232870)一样对这两段代码进行计时？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T08:22:02.750

代码流看起来是一样的，字节码也应该是一样的。

免责声明：我是一名 C/C++ 程序员，我并不真正做 C#

# javascript - 标签云：flash 或 javascript 中有没有

> ID：404701
> 
> 赞同：1
> 
> 时间：2009-01-01T08:15:49.500
> 
> 标签：javascript, flash

我想在我的主页上显示 tagcloud。找到了这个 wordpress flash 插件[http://alexisyes.com/tags/wpcumulus](http://alexisyes.com/tags/wpcumulus)，但为此我需要设置 wordpress。我想知道是否有任何其他类似于 wpcumulus 的独立插件可以配置。

我不想安装 wordpress，但我想使用 wpcumulus。是否可以？如果不是 wpcumulus，我可以使用任何其他独立的标签云吗？

只是好奇，我遇到了所有在 flash 或 flex 中实现的标签云。我可以获得在 javascript 中实现相同功能的演示链接/插件吗？

谢谢，~沙菲

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T08:24:03.930

你绝对可以使用 wpcumulus（我刚刚下载并检查了它）。您只需要弄清楚创建标签云需要哪些数据。

首先，您需要下载 swf 并将其添加到您的站点。您可以查看它的已安装版本/演示，以查看正确的 swf 嵌入 html。

接下来，您必须弄清楚它是如何获取数据的。我认为最快的方法是去看 wpcumulus 的演示并查看正在进行的 http 请求/响应。我为此使用了 Firefox 的 Live Http Headers 插件。它可能会查找在其 swf 嵌入代码中设置的 xml 文件。我猜xml可能看起来像这样：

```
<?xml version="1.0" encoding="UTF-8"?>
<tags>
    <tag name="Books" count="4" />
    <tag name="Magazines" count="20" />
    <!-- etc... -->
</tags> 
```

现在您只需要创建一个包含该数据的 xml 文件。您可以将其设为静态 xml 文件，也可以使用 php 或 asp.net 创建生成 xml 的动态页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T08:48:25.863

换句话说，我想为标签云提供“自动刷新”功能。可以做到吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T12:35:19.767

请从 99atoms.com 下载 BlogEngine.Net 平台的[BlogCumulus.Net](http://www.99atoms.com/post/BlogCumulusNET-A-flash-based-tag-cloud.aspx)。它将让您全面了解如何在 .Net 中使用它。同样对于 PHP，请阅读此页面以了解在[Drupal中使用它](http://alexisyes.com/2008/10/8/how-setup-wp-cumulus-drupal)

实际上你不需要给它完整的 xml 文件，而是一个格式的字符串：

```
<tags>
<a href="#" title="C#" style="..." class="..">C#</a>
.............
...............
</tags> 
```

我认为标签的大小来自 <a> 中的类属性。您可以使用[swfobject.js](http://code.google.com/p/swfobject/)生成用于将 flash 对象插入页面的标记。

# refactoring - 通过编译错误进行重构很糟糕吗？

> ID：404717
> 
> 赞同：10
> 
> 时间：2009-01-01T08:27:38.353
> 
> 标签：refactoring, compiler-errors

我已经习惯通过引入编译错误来进行一些重构。例如，如果我想从我的类中删除一个字段并将其作为某些方法的参数，我通常会先删除该字段，这会导致类的编译错误。然后我会将参数引入我的方法，这会破坏调用者。等等。这通常会给我一种安全感。我实际上还没有读过任何关于重构的书籍，但我曾经认为这是一种相对安全的方式。但我想知道，它真的安全吗？或者这是一种糟糕的做事方式？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-01T08:40:04.600

我在重构时从不依赖简单的编译，代码可以编译但可能会引入错误。

我认为最好只为要重构的方法或类编写一些单元测试，然后通过在重构后运行测试，您将确保没有引入任何错误。

我不是说去测试驱动开发，只是编写单元测试以获得你需要重构的必要信心。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-01T19:08:37.920

这是静态编译语言的一种常见且有用的技术。您正在做的事情的一般版本可以表述如下：

> 当您对可能使该模块的客户端中的某些用途无效的模块进行更改时，请以导致编译时错误的方式进行初始更改。

有多种推论：

*   如果方法、函数或过程的含义发生了变化，而类型也没有变化，则更改名称。（当您仔细检查并修复所有用途时，您可能会改回名称。）

*   如果将新案例添加到数据类型或将新文字添加到枚举，请更改所有现有数据类型构造函数或枚举文字的名称。（或者，如果你有幸拥有一个编译器来检查案例分析是否详尽，那么还有更简单的方法。）

*   如果您正在使用一种重载语言，*请不要*只更改一个变体或添加一个新变体。您冒着以不同方式静默解决重载的风险。如果您使用重载，则很难让编译器以您希望的方式为您工作。我知道处理重载的唯一方法是对所有用途进行全局推理。如果您的 IDE 不能帮助您，您必须更改*所有*重载变体的名称。不愉快。

您真正要做的是使用编译器来帮助您检查代码中可能需要更改的所有位置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-01T08:32:25.130

我看不出有什么问题。它是安全的，只要您在编译之前不提交更改，它就不会产生长期影响。此外，Resharper 和 VS 有一些工具可以让你的过程更轻松一些。

您在 TDD 的另一个方向上使用类似的过程 - 您编写的代码可能没有定义方法，这导致它无法编译，然后您编写足够的代码来编译（然后通过测试，等等......）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-01T08:52:47.540

当您准备阅读有关该主题的书籍时，我推荐 Michael Feather 的“[有效地使用旧代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)”。（*非作者添加：也是福勒的经典著作《[重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)》——[重构](http://refactoring.com/)网站可能会有用。*）

他谈到在进行更改之前识别您正在工作的代码的特征，并进行他所谓的临时重构。那就是通过反思找到代码的特征，然后把结果扔掉。

您正在做的是将编译器用作自动测试。它将测试您的代码是否可以编译，但如果行为由于重构或是否有任何副作用而改变，则不会。

考虑这个

```
class myClass {
     void megaMethod() 
     {
         int x,y,z;
         //lots of lines of code
         z = mysideEffect(x)+y;
         //lots more lines of code 
         a = b + c;
     }
} 
```

你可以重构出添加

```
class myClass {
     void megaMethod() 
     {
         int a,b,c,x,y,z;
         //lots of lines of code
         z = addition(x,y);
         //lots more lines of code
         a = addition(b,c);  
     }

     int addition(int a, b)
     {
          return mysideaffect(a)+b;
     }
} 
```

这会起作用，但第二个附加项在调用该方法时会出错。除了编译之外，还需要进一步的测试。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-01T10:38:45.327

很容易想到一个例子，其中由编译器错误进行的重构会默默地失败并产生意想不到的结果。
想到的几个案例：（我假设我们在谈论 C++）

*   将参数更改为具有默认参数的其他重载的函数。重构之后，参数的最佳匹配可能不是您所期望的。
*   具有强制转换运算符或非显式单参数构造函数的类。根据所涉及的星座，更改、添加、删除或更改其中任何一个的参数都可以更改被调用的最佳匹配。
*   更改虚函数而不更改基类（或以不同方式更改基类）将导致调用被定向到基类。

仅当您绝对确定编译器将捕获需要进行的每一个更改时，才应使用依赖编译器错误。我几乎总是倾向于怀疑这一点。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-01T19:01:05.797

我只想补充一下这里的所有智慧，还有一种情况可能不安全。反射。这会影响 .NET 和 Java 等环境（当然还有其他环境）。您的代码可以编译，但是当反射尝试访问不存在的变量时仍然会出现运行时错误。例如，如果您使用像 Hibernate 这样的 ORM 并且忘记更新映射 XML 文件，这可能很常见。

在整个代码文件中搜索特定变量/方法名称可能会更安全一些。当然，它可能会带来很多误报，所以它不是一个通用的解决方案；你也可以在你的反射中使用字符串连接，这也会使这无用。但这至少离安全更近了一步。

我不认为有一个 100% 万无一失的方法，除了手动浏览所有代码。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-01T08:31:03.790

我认为这是一种非常常见的方式，因为它会找到对该特定事物的所有引用。然而，现代 IDE（如 Visual Studio）具有查找所有引用的功能，这使得这变得不必要。

但是，这种方法有一些缺点。对于大型项目，编译应用程序可能需要很长时间。另外，不要长时间这样做（我的意思是，尽快让事情恢复正常）并且一次不要做超过一件事，因为你可能会忘记你修补的正确方法第一次。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-01T08:57:28.497

这是一种方式，如果不知道您要重构的代码是什么样的以及您做出的选择，就无法明确说明它是安全还是不安全。

如果它对你有用，那么没有理由仅仅为了改变而改变，但是当你有时间阅读这里的资源时，可能会给你新的想法，随着时间的推移你可能想要探索这些想法。

[http://www.refactoring.com/](http://www.refactoring.com/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-01T14:38:42.707

如果您使用的是 dotnet 语言之一，您可以考虑的另一种选择是使用 Obsolete 属性标记“旧”方法，这将引入所有编译器警告，但如果有代码超出您的范围，仍然保留代码可调用控制（例如，如果您正在编写 API，或者如果您不使用 VB.Net 中的严格选项）。您可以愉快地重构，让过时的版本调用新版本；举个例子：

```
 public string Username
    {
        get
        {
            return this.userField;
        }
        set
        {
            this.userField = value;
        }
    }

    public int Login()
    {
        /* do stuff */
    } 
```

变成：

```
 [ObsoleteAttribute()]
    public string Username
    {
        get
        {
            return this.userField;
        }
        set
        {
            this.userField = value;
        }
    }

    [ObsoleteAttribute("Replaced by Login(username, password)")]
    public int Login()
    {
        Login(Username, Pasword);
    }

    public int Login(string username, string password)
    {
        /* do stuff */
    } 
```

反正我就是这样的

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-01T08:33:22.663

这是一种常见的方法，但结果可能会因您的语言是静态的还是动态的而异。

在静态类型语言中，这种方法是有意义的，因为您引入的任何差异都会在编译时被捕获。但是，动态语言通常只会在运行时遇到这些问题。这些问题不会被编译器捕获，而是被您的测试套件捕获；假设你写了一个。

我的印象是您正在使用 C# 或 Java 之类的静态语言，因此请继续使用这种方法，直到您遇到某种表明您应该采取其他方式的重大问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-01T08:35:25.810

我进行通常的重构，但仍然通过引入编译器错误来进行重构。我通常在更改不是那么简单并且此重构不是真正的重构（我正在更改功能）时执行它们。这些编译器错误给了我一些地方，我需要查看并进行一些比名称或参数更改更复杂的更改。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-01T10:39:50.100

这听起来类似于测试驱动开发中使用的绝对标准方法：编写引用不存在的类的测试，因此使测试通过的第一步是添加类，然后是方法，等等。有关详尽的 Java 示例，请参阅[Beck 的书](https://rads.stackoverflow.com/amzn/click/com/0321146530)。

你的重构方法听起来很危险，因为你没有任何安全测试（或者至少你没有提到你有任何测试）。您可能创建的编译代码实际上并不能满足您的需求，或者会破坏应用程序的其他部分。

我建议您在实践中添加一条简单的规则：*仅在单元测试代码中*进行非编译更改。这样，您可以确保每次修改都至少有一个本地测试，并且在进行修改之前，您会在测试中记录修改的意图。

顺便说一句，Eclipse 使这种“失败、存根、写入”方法在 Java 中变得异常简单：每个不存在的对象都为您标记，并且 Ctrl-1 加上一个菜单选项告诉 Eclipse 为您编写一个（可编译的）存根！我很想知道其他语言和 IDE 是否提供类似的支持。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-01T13:46:43.903

从某种意义上说，它是“安全的”，因为在经过充分编译时检查的语言中，它会强制您更新对已更改内容的所有实时引用。

如果你有条件编译的代码，它仍然可能出错，例如如果你使用了 C/C++ 预处理器。因此，如果适用，请确保在所有可能的配置和所有平台上进行重建。

它不会消除测试更改的需要。如果您向函数添加了参数，则编译器无法告诉您在更新该函数的每个调用站点时提供的值是否是正确的值。如果你删除了一个参数，你仍然会犯错误，例如，更改：

```
void foo(int a, int b); 
```

到

```
void foo(int a); 
```

然后将呼叫更改为：

```
foo(1,2); 
```

到：

```
foo(2); 
```

这编译得很好，但它是错误的。

就个人而言，我确实使用编译（和链接）失败作为搜索代码以获取对我正在更改的函数的实时引用的一种方式。但是您必须记住，这只是一种节省劳动力的设备。它不保证生成的代码是正确的。

# firefox - 如何从外部程序更改 Firefox 的代理设置？

> ID：404729
> 
> 赞同：9
> 
> 时间：2009-01-01T08:41:19.450
> 
> 标签：firefox, proxy, firefox-3

我见过一些能够修改 Firefox 代理设置的程序（例如 Charles Web Developer Proxy）。顺序是：

1.  Firefox 正在运行，带有用户代理设置。
2.  用户启动外部第三方应用程序，该应用程序
3.  修改 Firefox 的代理设置，然后
4.  用户退出第三方程序，并且，
5.  Firefox 使用其原始代理设置恢复运行。

假设外部应用程序记住旧的代理设置并在退出时恢复它们我如何读取和写入 Firefox 的代理设置？已尝试通过 Firefox doco 进行谷歌搜索，但还没有运气。

**考虑的选项：**

*   编写一个新的用户首选项配置文件并启动一个新的浏览器实例。可以工作但不太正确——例如，Charles 可以修改已经运行的浏览器的设置并在不重新启动的情况下恢复它们。
*   写一个插件。可以编写一个 Firefox 插件，向外部提供某种 IPC，然后自己处理 Firefox 首选项设置。事实上，我认为这可能是唯一的方法。禁用 Charles 的 Firefox 插件似乎会禁用它即时修改首选项的能力。

**可能的资源**

*   以编程方式更改 Firefox 首选项：[首选项 - MDC](https://developer.mozilla.org/en/Code_snippets/Preferences)
*   构建 Firefox 扩展：[扩展 - MDC](https://developer.mozilla.org/en/Extensions)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T19:49:57.393

您可能想看看 Fiddler 是如何做到这一点的 (www.fiddler2.com)。C:\program files\fiddler2\fiddlerhook\ 文件夹有一个 Firefox 扩展，它显示了如何做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T23:18:04.860

在我的机器上，Firefox 的所有代理设置都存储在 C:\DOCUME~1\BRUCEX~1\APPLIC~1\Mozilla\Firefox\Profiles\licga1pg.default\prefs.js 中。该文件中的标题说

```
# Mozilla User Preferences

/* Do not edit this file.
 *
 * If you make changes to this file while the application is running,
 * the changes will be overwritten when the application exits.
 *
 * To make a manual change to preferences, you can visit the URL about:config
 * For more information, see http://www.mozilla.org/unix/customizing.html#prefs
 */ 
```

customizing.html 的链接在[这里](http://www.mozilla.org/unix/customizing.html#prefs)。所以理论上你可以调整其中的部分或全部

```
user_pref("network.proxy.backup.ftp", "squid.home-server");
user_pref("network.proxy.backup.ftp_port", 3128);
user_pref("network.proxy.backup.gopher", "squid.home-server");
user_pref("network.proxy.backup.gopher_port", 3128);
user_pref("network.proxy.backup.socks", "squid.home-server");
user_pref("network.proxy.backup.socks_port", 3128);
user_pref("network.proxy.backup.ssl", "squid.home-server");
user_pref("network.proxy.backup.ssl_port", 3128);
user_pref("network.proxy.ftp", "squid.home-server");
user_pref("network.proxy.ftp_port", 3128);
user_pref("network.proxy.gopher", "squid.home-server");
user_pref("network.proxy.gopher_port", 3128);
user_pref("network.proxy.http", "squid.home-server");
user_pref("network.proxy.http_port", 3128);
user_pref("network.proxy.no_proxies_on", "localhost, 127.0.0.1, *.my-domain");
user_pref("network.proxy.share_proxy_settings", true);
user_pref("network.proxy.socks", "squid.home-server");
user_pref("network.proxy.socks_port", 3128);
user_pref("network.proxy.ssl", "squid.home-server");
user_pref("network.proxy.ssl_port", 3128);
user_pref("network.proxy.type", 1); 
```

虽然存在让 Firefox 重新阅读它们的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-02T08:05:33.843

从我从文档中可以看到，Charles 安装/使用了一个匹配的 Firefox 扩展。这可能是它可以即时重新加载代理信息的方式。

代理信息存储在您的个人资料的 prefs.js 中，但不能即时重新加载。Firefox 在启动时读取它并在它关闭时写入它，并且在其间不从它加载。此外，如果在您编辑 prefs.js 时 Firefox 正在运行，您的更改将被覆盖。

我认为您可能可以使用 PAC 文件做一些事情，但经过一番挖掘后，我发现它似乎也没有即时重新加载。您必须重新启动才能重新加载对设置的任何修改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T09:21:24.580

如果您查看[我之前问题](https://stackoverflow.com/questions/69602/proxy-settings-in-firefox-dont-stick)的答案中的一些链接，您可能会找到可用于根据需要调整代理设置的代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T13:20:13.167

通过[ActiveX Control 与 Firefox 建立 ActiveX 连接，用于在 IE 中托管 Netscape 插件，](https://developer.mozilla.org/En/ActiveX_Control_for_Hosting_Netscape_Plug-ins_in_IE)但我怀疑这是否会有所帮助。尽管如此，还是值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T10:29:51.550

当我从第三方应用程序启动 firefox 浏览器时，即使我面临使用手动代理完成的连接设置的问题（我正在使用 selenium）

我厌倦了在 C:\Program Files\Mozilla Firefox\defaults\profile 中添加 users.js 文件

使用上面建议的更改（添加 user_pref）语句，但不知何故，我的 firefox 浏览器仍然没有接收到提到的更改。即使在同一位置的 prefs.js 上也是一样的（实际上我的 prefs.js 是空的！！）

但是有一些其他的方法......在 C:\Program Files\Mozilla Firefox\greprefs\all.js 中，执行上面建议的相同更改 pref("network.proxy.type", 0); 到 1 个首选项（“network.proxy.http”，“”）；到本地主机首选项（“network.proxy.http_port”，0）；到 4444

事情开始工作了..但我不确定这是否是正确的做法，因为我们正在更改安装目录中的文件..顺便说一句，这是firefox的错误吗？

感谢您的评论

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-19T19:25:56.960

我尝试下载 selenium rc 1.0.3 并使用 *chrome /usr/lib/firefox-3.0.10/firefox-bin 后跟 AUT 的 URL。它有效。据说他们已经从 1.0 中删除了 *custom 运行模式.3（我的猜测），因为在解压缩 selenium-server.jar 文件时，我找不到任何 custom.class 文件，而不是在 selenium-server.jar 文件中存在 custom.class 文件的早期版本.

# java - Java：如何检查字符是否属于特定的 unicode 块？

> ID：404733
> 
> 赞同：16
> 
> 时间：2009-01-01T08:43:01.473
> 
> 标签：java, regex, unicode, char

我需要确定我的输入属于哪种自然语言。目标是区分混合输入中的*阿拉伯语*和*英语*单词，其中输入是 Unicode 并从 XML 文本节点中提取。我注意到了课堂`Character.UnicodeBlock`。和我的问题有关吗？我怎样才能让它工作？

**编辑：** 该`Character.UnicodeBlock`方法对阿拉伯语很有用，但显然不适用于英语（或其他欧洲语言），因为`BASIC_LATIN`Unicode 块涵盖符号和不可打印字符以及字母。所以现在我使用带有正则表达式`matches()`的对象的方法。我可以忍受它，但也许有人可以提出更好/更快的方法。`String``"[A-Za-z]+"`

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-01T08:49:02.147

是的，您可以简单地使用[Character.UnicodeBlock.of(char)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Character.UnicodeBlock.html#of(char))

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-04T11:31:37.410

如果`[A-Za-z]+`满足您的要求，您将找不到更快或更漂亮的东西。但是，如果你想匹配 Latin1 块中的所有字母（包括重音字母和连字），你可以使用这个：

```
Pattern p = Pattern.compile("[\\pL&&\\p{L1}]+"); 
```

这是所有 Unicode 字母的集合和所有 Latin1 字符的集合的交集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-10-07T13:19:17.667

[Unicode Script 属性](http://unicode.org/reports/tr24/)可能更有用。[在 Java 中，可以使用java.lang.Character.UnicodeScript](http://docs.oracle.com/javase/7/docs/api/java/lang/Character.UnicodeScript.html)类来查找它：

```
Character.UnicodeScript script = Character.UnicodeScript.of(c); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-03T13:31:10.513

英文字符往往在这 4 个 Unicode 块中：

```
ArrayList<Character.UnicodeBlock> english = new ArrayList<>();
english.add(Character.UnicodeBlock.BASIC_LATIN);
english.add(Character.UnicodeBlock.LATIN_1_SUPPLEMENT);
english.add(Character.UnicodeBlock.LATIN_EXTENDED_A);
english.add(Character.UnicodeBlock.GENERAL_PUNCTUATION); 
```

因此，如果您有一个字符串，您可以遍历所有字符并查看每个字符所在的 Unicode 块：

```
for (char currentChar : myString.toCharArray())  
{
    Character.UnicodeBlock unicodeBlock = Character.UnicodeBlock.of(currentChar);
    if (english.contains(unicodeBlock))
    {
        // This character is English
    }
} 
```

如果它们都是英文的，那么你知道你有全是英文的字符。您可以对任何语言重复此操作；您只需要弄清楚每种语言使用的 Unicode 块。

注意：这并不意味着您已经证明该语言*是*英语。您只证明了它使用的是英文字符。它可能是法语、德语、西班牙语或其他字符与英语有很多重叠的语言。

还有其他方法可以检测实际的自然语言。像 langdetect 这样的库，我已经非常成功地使用了，可以为你做到这一点：

[https://code.google.com/p/language-detection/](https://code.google.com/p/language-detection/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T13:08:46.747

你有与这个相反的问题[，](https://stackoverflow.com/questions/397788/why-does-w-match-only-english-words-in-javascript-regex)但具有讽刺意味的是，什么对他不起作用，它应该对你有用。它只是用 reg-exp "\w" 查找英文单词（仅与 ASCII 兼容的字符）。

# python - 在 pyInstaller 生成的 Python EXE 中确定应用程序路径

> ID：404744
> 
> 赞同：94
> 
> 时间：2009-01-01T08:50:22.597
> 
> 标签：python, executable, relative-path, pyinstaller

我有一个驻留在单个 .py 文件中的应用程序。我已经能够让 pyInstaller 成功地将其捆绑到 Windows 的 EXE 中。问题是，应用程序需要一个 .cfg 文件，该文件始终直接位于同一目录中的应用程序旁边。

通常，我使用以下代码构建路径：

```
import os
config_name = 'myapp.cfg'
config_path = os.path.join(sys.path[0], config_name) 
```

但是，当从 pyInstaller 生成的 EXE 调用 sys.path 时，它似乎是空白的。当您运行 python 交互式命令行并尝试获取 sys.path[0] 时，会发生同样的行为。

有没有更具体的方法来获取当前正在运行的应用程序的路径，以便我可以找到与其相关的文件？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-01-01T08:53:20.173

我找到了解决方案。您需要检查应用程序是作为脚本运行还是作为冻结的 exe 运行：

```
import os
import sys

config_name = 'myapp.cfg'

# determine if application is a script file or frozen exe
if getattr(sys, 'frozen', False):
    application_path = os.path.dirname(sys.executable)
elif __file__:
    application_path = os.path.dirname(__file__)

config_path = os.path.join(application_path, config_name) 
```

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2017-03-06T00:00:11.660

根据 PyInstaller 的[文档](https://pyinstaller.readthedocs.io/en/stable/runtime-information.html)，恢复应用程序路径的建议方法如下：

```
#!/usr/bin/python3
import sys, os
if getattr(sys, 'frozen', False):
    # If the application is run as a bundle, the PyInstaller bootloader
    # extends the sys module by a flag frozen=True and sets the app 
    # path into variable _MEIPASS'.
    application_path = sys._MEIPASS
else:
    application_path = os.path.dirname(os.path.abspath(__file__)) 
```

针对 PyInstaller v3.2 进行了测试，但这当然也适用于早期版本。

Soviut 的解决方案不起作用，至少对于最新版本的 pyInstaller 来说通常不起作用（请注意，OP 已有多年历史）。例如，在 MacOS 上，当将应用程序捆绑到一个文件包中时，`sys.executable`仅指向嵌入式存档的位置，而*不是*pyInstaller 引导加载程序创建临时应用程序环境后应用程序实际运行的位置。仅`sys._MEIPASS`正确指向该位置。有关 PyInstaller 如何工作的更多信息，请参阅[此文档页面。](https://pyinstaller.readthedocs.io/en/stable/operating-mode.html)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2017-12-21T06:47:45.280

我稍微缩短了代码。

```
import os, sys

if getattr(sys, 'frozen', False):
    application_path = os.path.dirname(sys.executable)
    os.chdir(application_path)

logging.debug('CWD: ' + os.getcwd()) 
```

但是，`sys._MEIPASS`指向了错误的目录。我认为它也需要`sys._MEIPASS`+`\app_name`

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2020-09-04T00:30:38.133

我很惊讶没有人提到`getattr()`具有内置默认参数，如果该属性不存在，该参数将被返回。[使用pathlib](https://docs.python.org/3/library/pathlib.html)也可以使其更具可读性。无论代码是否与 PyInstaller 捆绑在一起，此代码都有效。

```
from pathlib import Path
bundle_dir = Path(getattr(sys, '_MEIPASS', Path.cwd()))
config_path = bundle_dir / 'myapp.cfg' 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-01-17T05:31:57.197

```
os.path.dirname(sys.argv[0]) 
```

这对我行得通。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-02-15T22:13:19.593

`__file__`从命令行使用 python 可执行文件工作。它还给出了冻结模式下没有实际路径的脚本文件名。但是它在交互模式下会出错。

以下将适用于所有三种模式：

```
import sys,os

config_name = 'myapp.cfg'

if getattr(sys, 'frozen', False):
    application_path = os.path.dirname(sys.executable)
    running_mode = 'Frozen/executable'
else:
    try:
        app_full_path = os.path.realpath(__file__)
        application_path = os.path.dirname(app_full_path)
        running_mode = "Non-interactive (e.g. 'python myapp.py')"
    except NameError:
        application_path = os.getcwd()
        running_mode = 'Interactive'

config_full_path = os.path.join(application_path, config_name)

print('Running mode:', running_mode)
print('  Appliction path  :', application_path)
print('  Config full path :', config_full_path) 
```

以三种不同模式输出：

```
Running mode: Interactive
  Appliction path  : C:\Projects\MyAppDir
  Config full path : C:\Projects\MyAppDir\myapp.cfg

C:\Projects\MyAppDir>myapp.exe
Running mode: Frozen/executable
  Appliction path  : C:\Program Files\myapp
  Config full path : C:\Program Files\myapp\myapp.cfg

C:\Projects\MyAppDir>python myapp.py
Running mode: Non-interactive (e.g. 'python myapp.py')
  Appliction path  : C:\Projects\MyAppDir
  Config full path : C:\Projects\MyAppDir\myapp.cfg

C:\Projects\MyAppDir> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-04-26T03:27:17.753

这里有很多答案，但我发现这个解决方案在大多数情况下都有效：

```
import os
import sys
import os.path as op
try:
    this_file = __file__
except NameError:
    this_file = sys.argv[0]
this_file = op.abspath(this_file)
if getattr(sys, 'frozen', False):
    application_path = getattr(sys, '_MEIPASS', op.dirname(sys.executable))
else:
    application_path = op.dirname(this_file) 
```

# qt - 为什么库名称的名称中多了一个 0？

> ID：404774
> 
> 赞同：3
> 
> 时间：2009-01-01T09:22:49.443
> 
> 标签：qt, qt4, makefile, nmake

我有一个带有这样的项目文件的小型 Qt 项目：

```
TEMPLATE = lib
TARGET = record32
VERSION = 0.0.1
DEPENDPATH += .
INCLUDEPATH += .

CONFIG += shared
SOURCES += recorder.cpp
HEADERS += recorder.h 
```

当我从它编译一个库时`qmake && nmake`，它会生成文件

```
record32.obj
record320.lib
record320.dll
... 
```

**为什么将额外的 0 添加到 lib 和 dll 名称中？**

生成的makefile似乎没有附加它，而是假设它，`Makefile.Release`它只是说：

```
####### Files

SOURCES       = recorder.cpp release\moc_recorder.cpp
OBJECTS       = release\recorder.obj release\moc_recorder.obj
DIST          = 
QMAKE_TARGET  = recorder
DESTDIR        = release\ #avoid trailing-slash linebreak
TARGET         = record320.dll
DESTDIR_TARGET = release\record320.dll 
```

**如何防止它并根据需要命名我的库？**

（请注意，手动修复 makefile.release 不是可接受的解决方案）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T14:42:23.247

它来自 VERSION 的第一部分。“lib”模板正在添加它。

IMO 将它包含在库名称中是个好主意，因为它避免了在 Windows 上发生的臭名昭著的“DLL Hell”，在这种情况下，该约定没有始终如一地遵循......通过命名库文件以包含主要版本号，用户可以安装了多个版本，程序将在运行时使用正确的版本。DLL 版本不一定需要与整个项目发布版本相同。在 Linux 和 OSX 上，版本附加到文件名（例如 librecorder.so.0.0.1）

[如果使用 Visual C++，我也总是添加一个标签来指示使用的 Visual CI 版本，因为不同版本生成的代码也很大程度上不兼容。]

也许您可以省略 VERSION 的定义以禁用此行为，但我现在无法验证 Windows （在 Linux 上，共享库始终具有版本号，它只假定版本 1.0.0。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-03-15T12:19:46.577

试试这个：

```
CONFIG += skip_target_version_ext 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-02-16T09:26:06.227

有用的[技巧](https://wiki.qt.io/Qt_project_org_faq#How_can_I_add_version_information_to_my_application.3F)：

```
VERSION = 0.0.1
win32:TARGET_EXT = .dll 
```

有了这个，你会得到：

*   在 Linux 上：librecord.so, ..., librecord.so.0.0.1
*   在 Windows 上：record.dll

# ruby-on-rails - 如何组织太胖的 Rails 模型？

> ID：404785
> 
> 赞同：29
> 
> 时间：2009-01-01T09:40:43.260
> 
> 标签：ruby-on-rails, model

将逻辑从控制器转移到模型中是一种很好的做法。但是在任何复杂的系统中，这总是会导致一个非常大的文件，即使大多数方法是按照 Rails 方式的一个衬里。

我已经采取了将模型拆分为其他模块并将它们包含在原始模型中的方法，例如 ,`model_flags`等`model_validation`。有人有更好的方法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2011-08-07T03:16:46.177

我意识到这是一个相当古老的问题，它已被标记为已回答，但它仍然有很好的谷歌果汁，所以我认为值得添加...

Rails 3 引入了 ActiveSupport::Concern，可用于模块化跨模型共享的行为。或者，就此而言，瘦身已经变得太胖的模特。

DHH 本人在这里提供了一个很好的、简洁的示例要点：

[https://gist.github.com/1014971](https://gist.github.com/1014971)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-01T16:14:10.143

我不会这样做有几个原因。

首先，您违反了事物将在应有的位置的假设，这可能首先是对 Rails 的最大好处。如果您将模型内容粘贴到模型中，一个新人可以很容易地进入您的项目并导航它。如果你把它拉出来，你只会增加延迟和一些混乱，特别是如果将某些东西删除到模块的唯一逻辑是减小模型大小。

其次，您几乎没有从中获得任何收益，并且您会失去一些东西。如今，几乎所有编辑器和 IDE 都减轻了大文件的导航痛苦，因此文件大小已不再重要。将东西移动到一个模块实际上会消除一些现代的轻松，并且需要您和您的同事或未来的维护者在处理一个模型时跳过更多的文件。

也就是说，我怀疑铁杆最佳实践团队会告诉您的是，如果您的模型又大又复杂，那么您的设计就有缺陷，并且您的模型可能代表了可以制作成单独模型而不是模块的几件事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-09T19:41:42.167

好吧，我不会说你们中的任何人将所有东西都放在一个模型中是错误的，但我认为能够分离各种关注点也是非常有效的。这至少是一种权衡。

我正在发布我自己问题的答案，因为我已经找到了 Rails 方式来做到这一点：http: [//github.com/jakehow/concerned_with](http://github.com/jakehow/concerned_with)

更多信息可以在这里找到：http: [//m.onkey.org/2008/9/15/active-record-tips-and-tricks](http://m.onkey.org/2008/9/15/active-record-tips-and-tricks)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-01T18:28:06.753

不了解您的对象模型，建议您有点困难，但我想说的是，如果您绝对确信所有验证/关联/回调都**需要**在那个地方，那么仍然有一些方法可以解决常见的行为。因此，虽然我不会将一大块代码从一个文件移到另一个文件中，它只是重新打开类，但我会说使用模块/插件来描述常见的行为类型是一个好主意。

例如，如果您正在构建 Facebook 式的活动提要，并且所有内容都需要生成“事件”，那么您可能希望将“可事件”行为移动到一个模块中，当包含该模块时，它定义了关联/验证/ETC。我想说这种方法实际上会提高代码的清晰度，因为在任何地方手动指定这些关联并不像将某些东西声明为 Eventable 那样富有表现力，也不安全（你会在很多地方重复逻辑，当逻辑发生变化时，你知道其余的......）

总而言之，我想说仔细看看你的对象模型。在您的测试套件中，如果您注意到所有测试都需要进行大量设置，那么这可能是一个很好的指标，表明您在对象模型中遗漏了一些东西。不过，再一次，一些示例代码会很棒。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-04-30T12:57:09.453

*   您可以使用服务对象：[http ://railscasts.com/episodes/398-service-objects](http://railscasts.com/episodes/398-service-objects)
*   您也可以使用关注点。默认情况下，它会在 Rails 4 中创建一个文件夹：[http ://railscasts.com/episodes/400-what-s-new-in-rails-4](http://railscasts.com/episodes/400-what-s-new-in-rails-4)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T11:11:21.487

模块听起来很明智。我不会将方法调用（验证、回调、插件等）提取到模块中，但是，我会将提取限制为我自己的方法。

和往常一样，如果您发布一些示例代码会有所帮助。我发现很难想象清理模型的通用策略，这取决于代码的性质。

# sql - 数据库大小估计工具

> ID：404794
> 
> 赞同：0
> 
> 时间：2009-01-01T09:48:42.060
> 
> 标签：sql, filesize

是否有估算数据库大小的工具？

我正在寻找这样一个工具，我可以输入估计的表、行大小、数据类型、索引和其他变量，从而为我提供有关尚不存在的数据库大小的线索。

我知道 MS Sql Server Books Online 有一个关于如何估计的很好的文档，但我不想最终编码它:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T11:09:39.853

Sybase PowerDesigner 能够根据模型计算数据库大小，您只需估计每个表的行数。

# java - Java中的LBYL与EAFP？

> ID：404795
> 
> 赞同：73
> 
> 时间：2009-01-01T09:50:56.343
> 
> 标签：java, python, error-handling, idioms

我最近在自学 Python，并发现了关于代码执行前错误检查的 LBYL/EAFP 习语。在 Python 中，似乎公认的风格是 EAFP，而且它似乎与该语言很好地配合。

LBYL ***（****在****你****之前****先****看看**）*：***_***

 ******```
def safe_divide_1(x, y):
    if y == 0:
        print "Divide-by-0 attempt detected"
        return None
    else:
        return x/y 
```

EAFP ***（*** *Ask* ***F*** ***orgiveness****比**Permission**更**容易**）*******：******

 ******```
def safe_divide_2(x, y):
    try:
        return x/y
    except ZeroDivisionError:  
        print "Divide-by-0 attempt detected"
        return None 
```

我的问题是：我什至从未听说过使用 EAFP 作为主要数据验证结构，来自 Java 和 C++ 背景。EAFP 在 Java 中使用是明智的吗？还是有太多的异常开销？我知道只有在实际抛出异常时才会产生开销，所以我不确定为什么不使用更简单的 EAFP 方法。只是偏好吗？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2009-01-01T17:52:24.157

如果你正在访问文件，EAFP 比 LBYL 更可靠，因为 LBYL 中涉及的操作不是原子的，文件系统可能会在你查看的时间和跳跃的时间之间发生变化。实际上，标准名称是TOCTOU——检查时间，使用时间；检查不准确导致的错误是 TOCTOU 错误。

考虑创建一个必须具有唯一名称的临时文件。找出所选文件名是否存在的最佳方法是尝试创建它 - 确保使用选项来确保如果文件已经存在则操作失败（在 POSIX/Unix 术语中，O_EXCL 标志为`open()`）。如果您尝试测试文件是否已经存在（可能使用`access()`），那么在显示“否”的时间和您尝试创建文件的时间之间，可能有人或其他人创建了该文件。

相反，假设您尝试读取现有文件。您检查文件是否存在 (LBYL) 可能会说“它在那里”，但是当您实际打开它时，您会发现“它不存在”。

在这两种情况下，您都必须检查最终操作 - LBYL 不会自动提供帮助。

（如果你在弄乱 SUID 或 SGID 程序，`access()`问一个不同的问题；它可能与 LBYL 相关，但代码仍然必须考虑失败的可能性。）

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-01-02T23:31:52.107

除了 Python 和 Java 中异常的相对成本之外，请记住它们之间的理念/态度存在差异。Java 试图对类型（以及其他所有内容）非常严格，需要明确、详细地声明类/方法签名。它假定您在任何时候都应该确切地知道您正在使用什么类型的对象以及它能够做什么。相比之下，Python 的“鸭子类型”意味着您不确定（也不应该关心）对象的清单类型是什么，您只需要关心它在您要求它时会发出嘎嘎声。在这种放任自流的环境中，唯一理智的态度就是假设事情会奏效，但如果不奏效，就要准备好应对后果。Java 的自然限制性 不适合这种随意的方法。（这并不是要贬低方法或语言，而是说这些态度是每种语言习语的一部分，在不同语言之间复制习语往往会导致尴尬和沟通不畅……）

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-01T14:30:19.043

在 Python 中处理异常比在 Java 中更有效，这至少*部分*是您在 Python 中看到该结构的原因。在 Java 中，以这种方式使用异常会更加低效（在性能方面）。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-04-28T18:26:54.340

考虑这些代码片段：

```
def int_or_default(x, default=0):
    if x.isdigit():
        return int(x)
    else:
        return default

def int_or_default(x, default=0):
    try:
        return int(x)
    except ValueError:
        return default 
```

他们看起来都是正确的，对吧？但其中之一不是。

前者使用 LBYL，但由于 和 之间的细微差别`isdigit`而失败`isdecimal`；当使用字符串“①²³₅”调用时，它会抛出错误而不是正确返回默认值。

根据定义，后者使用 EAFTP 会导致正确处理。没有行为不匹配的范围，因为需要该需求*的*代码就是断言该需求的代码。

使用 LBYL 意味着采用内部逻辑并将它们复制到*每个*呼叫站点。与其对您的要求进行一个规范的编码，不如在每次调用该函数时都有机会搞砸。

值得注意的是，EAFTP与异常*无关*，Java 代码尤其不应该普遍使用异常。这是关于将正确的工作分配给正确的代码块。例如，使用`Optional`返回值是编写 EAFTP 代码的一种完全有效的方式，并且在确保正确性方面比 LBYL 更有效。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-01T09:57:00.047

就个人而言，我认为这得到了惯例的支持，EAFP 从来都不是一个好方法。您可以将其视为等效于以下内容：

```
if (o != null)
    o.doSomething();
else
    // handle 
```

相对于：

```
try {
    o.doSomething()
}
catch (NullPointerException npe) { 
    // handle
} 
```

此外，请考虑以下事项：

```
if (a != null)
    if (b != null)
        if (c != null)
            a.getB().getC().doSomething();
        else
            // handle c null
    else
        // handle b null
else
    // handle a null 
```

这可能看起来不那么优雅（是的，这是一个粗略的例子 - 请耐心等待），但它在处理错误时为您提供了更大的粒度，而不是把它全部包装在一个 try-catch 中以获得它`NullPointerException`，然后试着找出你在哪里以及为什么得到它。

我看到它的方式 EAFP 不应该被使用，除非在极少数情况下。此外，由于您提出了这个问题：是的，即使没有抛出异常**，try-catch 块也会产生一些开销。**

# java - Java协变

> ID：404804
> 
> 赞同：14
> 
> 时间：2009-01-01T10:00:37.213
> 
> 标签：java

```
public class CovariantTest {
    public A getObj() {
        return new A();
    }

    public static void main(String[] args) {
        CovariantTest c = new SubCovariantTest();
        System.out.println(c.getObj().x);
    }
}

class SubCovariantTest extends CovariantTest {
    public B getObj() {
        return new B();
    }
}

class A {
    int x = 5;
}

class B extends A {
    int x = 6;
} 
```

上面的代码在编译和运行时打印 5。它对覆盖的方法使用协变返回。

为什么它打印 5 而不是 6，因为它在类 SubCovariantTest 中执行了覆盖的方法 getObj。

有人可以对此有所了解。谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-01T10:31:18.090

这是因为在 Java 中成员变量不会被覆盖，它们会*影响*（与方法不同）。A 和 B 都有一个变量 x。由于 c 被*声明*为 CovarientTest 类型，因此 getObj() 的返回值隐含为 A，而不是 B，因此您得到的是 A 的 x，而不是 B 的 x。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-01T10:08:48.367

Java**不会覆盖字段**（又名属性或成员变量）。相反，它们相互[遮蔽](http://leepoint.net/notes-java/data/variables/60shadow-variables.html)。如果您通过调试器运行程序，您将`x`在任何类型为 的对象中找到两个变量`B`。

这是对正在发生的事情的解释。该程序首先检索隐含类型的内容`A`，然后调用`x`假定来自 的内容`A`。即使它显然是一个子类型，在您的示例中，类型的对象`B`是通过 创建的`SubCovariantTest`，它仍然假设您在 getObj() 中返回隐式类型为 A 的内容。由于 Java 无法覆盖字段，因此测试将调用`A.x`而不是`B.x`。

```
CovariantTest c = new SubCovariantTest();
// c is assumed the type of CovariantTest as it is
// implicitly declared

System.out.println(c.getObj().x);
// In this method chain the following happens:

// c.getObj() will return object of type B
// BUT will assume it is an A

// c.getObj().x will return the x from A
// since in this context the compiler assumes 
// it is an A and make the call to A.x 
```

这似乎是一个令人难以置信的问题，因为 Java 中的方法总是被覆盖（与 C++ 和 C# 相比，它们不是）。您通常不会遇到这个问题，因为 Java 代码约定告诉您永远不要直接访问字段。相反，请确保始终通过访问*器方法*访问字段，即*getter*：

```
class A {
    private int x = 5;

    public int getX() { // <-- This is a typical accessor method
        return x;
    }
}

class B extends A {
    private int x = 6;

    @override
    public int getX() {
        // will be called instead even though B is implied to be A
        // @override is optional because methods in Java are always virtual
        // thus are always overridden
        return x;
    }
} 
```

使其工作的代码如下：

```
c.getObj().getX();
// Will now call getX() in B and return the x that is defined in B's context. 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-01T10:09:06.730

将上面的 A 和 B 替换为：

```
class A {
    public int getX() { return 5; }
}

class B extends A {
    public int getX() { return 6; }
 } 
```

这可能会回答你关于什么是错的问题;-)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-01T10:11:25.867

对象中有两个名为 x 的字段，一个来自 A 类，一个来自 B 类，它隐藏了 A 中的那个。由于 c 的声明，引用的字段 x 是 A 中的那个。

在实践中这不是问题，因为这是非常糟糕的风格

*   隐藏子类中的字段，

*   直接访问字段而不是通过方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-01T10:15:14.313

我正在查看您的代码，但在编译时遇到了一些麻烦。得到错误

> 返回类型与 CovariantTest.getObj() 不兼容

我做了一个小改动。

```
class A {
    int x = 5;
}

class B extends A {
    int x = 6;
 }

public class CovariantTest {

    public A getObj() {
        return new A();
    }

    public static void main(String[] args) {
        CovariantTest c = new SubCovariantTest();
        A a = c.getObj();

        System.out.println(c.getObj().x);
    }
}

 class SubCovariantTest extends CovariantTest {
    public A getObj() {
        return new B();
    }

 } 
```

在系统输出行插入断点并查看 a 变量。它包含两个 x 成员，一组为 5，一组为 6。

Starblue 的回答解释了这种行为。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-03T14:36:41.153

```
package ch2;

class CovariantTest
{
    public A getObj()
    {
        return new A();
    }
}

class SubCovariantTest extends CovariantTest
{
    public B getObj()
    {
        return new B();
    }
}

public class TestPrg
{
    public static void main(String[] args)
    {
        CovariantTest c = new SubCovariantTest();
        System.out.println("c.getObj().x :: "+c.getObj().x);
        System.out.println("c.getObj().getX() :: "+c.getObj().getX());
    }
}

class A
{
    int x = 5;

    int getX()
    {
        return x;
    }
}

class B extends A
{
    int x = 6;

    int getX()
    {
        return x;
    }
} 
```

简单... 多态性仅适用于函数。不是变量。

变量将在编译期间解析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T04:29:17.320

c 在编译时被键入为 CovariantTest ，因此对 c.getObj() 的调用在编译时绑定到方法 CovariantTest.getObj() （并且不能在运行时修改）。

此外，x 存在于 A 和 B 中（它被遮蔽，而不是被覆盖）。因为被调用的方法是 CovariantTest.getObj() 并且该方法适用于 A，所以即使实际对象是 B 类型，被检索的 x 也是 Ax。

# security - 引脚生成

> ID：404806
> 
> 赞同：17
> 
> 时间：2009-01-01T10:03:23.823
> 
> 标签：security, encryption, random, cryptography

我正在寻求开发一个系统，我需要为每个用户分配一个唯一的密码以确保安全。用户只会输入此 PIN 码作为识别自己的一种方式。因此，我不希望用户能够猜测其他用户的密码。假设我将拥有的最大用户数是 100000，这个密码应该是多长时间？

例如 1234 4532 3423

我应该通过某种算法生成此代码吗？还是我应该随机生成它？

基本上我不希望人们能够猜测其他人的密码，它应该支持足够数量的用户。

很抱歉，如果我的问题听起来有点令人困惑，但很乐意澄清任何疑问。

非常感谢你。

**更新**

在阅读了下面的所有帖子之后，我想添加更多细节。

1.  我想要实现的是与刮刮卡非常相似的东西。
2.  给用户一张卡，他/她必须刮擦才能找到密码。
3.  现在使用此密码，用户必须能够访问我的系统。

我无法添加额外的安全性（例如用户名和密码），因为它会阻止用户使用刮刮卡。我想让在限制范围内猜测密码变得尽可能困难。

再次感谢大家的精彩回复。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-01T10:10:43.810

如果将 4 个随机数字附加到唯一的已知用户 ID（仍然可以是数字）[starblue 推荐]，则应该足够了

伪随机数生成器也应该没问题。您可以使用可逆加密 (AES) 或单向哈希将这些存储在数据库中

您主要担心的是一个人在被锁定之前可能错误地输入了多少次密码。这应该很低，比如说大约三个......这将阻止人们猜测其他人的数字。

任何超过 6 位数字的人都会忘记它们，或者更糟的是，将它们写在显示器上的便利贴上。

假设一个帐户因 3 次错误尝试而被锁定，那么拥有一个 4 位密码加上一个用户 ID 组件 UserId (999999) + Pin (1234) 会给您 3/10000 的机会让您猜测。这可以接受吗？如果不使引脚长度为 5 并获得 3/100000

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-01T11:01:23.083

我可以建议一种替代方法吗？看看[Perfect Paper Passwords](http://www.grc.com/ppp.htm)及其提示的[派生词](http://www.grc.com/ppp/software.htm)。

您可以使用此“原样”来生成一次性 PIN，或者只是为每个用户生成一个 PIN。

还要记住，重复的 PIN 本身并不是问题：任何攻击都只需要尝试多个用户 ID。

（里程警告：我绝对不是安全专家。）

* * *

这是第二个答案：通过重新阅读，我假设您不想要这样的用户 ID - 您只是在验证一组已发行的刮刮卡。我还假设您不想使用字母 PIN。

您需要选择一个 PIN 长度，以使猜测有效 PIN 的概率小于 1/（您可以防止的尝试次数）。因此，例如，如果您有 100 万个有效 PIN，并且想要防止 10000 次猜测，您将需要一个 10 位数的 PIN。

如果您使用 John Graham-Cumming 的[Perfect Paper Passwords](http://www.jgc.org/blog/2008/02/ppp3-in-java-and-c.html)系统版本，您可以：

1.  为（比如说）10 位十进制引脚配置这个
2.  选择一个秘密 IV/关键短语
3.  生成（比如说）前一百万个密码（/PIN）

我怀疑这是一个通用过程，例如，也可以用于生成 25 个字母数字的产品 ID。

很抱歉通过逐次逼近来做到这一点；我希望这更接近你正在寻找的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-01T13:30:02.580

如果我们假设最多有 100,000 个用户，那么他们可以拥有 0-99,999 的唯一 PIN，即。5位数。

但是，这将更容易猜测具有最大用户数的 PIN。如果您可以限制 PIN 的尝试次数，那么您可以使用更短的 PIN。例如。每个 IP 每天最多 10 次失败尝试。

这还取决于你所保护的东西的价值，以及如果奇怪的人真的出去了，那将是多么灾难性的。

如果您想保持简短，我会选择 9 位数字，如果您想从自动猜测中获得更多安全性，我会选择 12 位数字。

为了生成 PIN，我会采用**高分辨率**版本的时间以及一些[盐](http://en.wikipedia.org/wiki/Salt_(cryptography))和可能的伪随机数，生成[哈希](http://en.wikipedia.org/wiki/Hash_function)并使用前 9 或 12 位数字。确保新 PIN 生成之间存在合理且随机的延迟，因此**不要循环生成它们**，如果可能，请让它们由用户启动。

例如。左（Sha1（日期时间 + 盐 + 伪随机），9）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-02T05:39:51.857

到目前为止有很多很棒的答案：简单、有效、优雅！

我猜这个应用程序有点像彩票，因为每个用户都会得到一张刮刮卡，并用它来询问你的应用程序是否“他已经中奖了！” 因此，从这个角度来看，我想到了一些新问题：

**War-dialing**，或者它的互联网等价物：一个流氓用户可以反复点击你的应用程序，比如连续猜测每个 10 位数字吗？如果有可能，请考虑限制来自特定位置的尝试次数。一种有效的方法可能是简单地拒绝回答，例如，从同一 IP 地址每 5 秒尝试一次以上。这使得机器驱动的攻击效率低下并避免了**锁定问题**。

**锁定问题**：如果您在多次尝试失败后*永久*锁定帐户，您很容易受到[拒绝服务](http://en.wikipedia.org/wiki/Denial_of_service)攻击。除非您在一段时间后重新激活帐户，否则上述攻击者可以有效地锁定*每个用户。*但是，只有当您的 PIN 包含用户 ID + 密钥的明显串联时，这才是一个问题，因为攻击者可以尝试给定用户 ID 的每个密钥。该技术还大大减少了您的密钥空间，因为只有少数 PIN 数字是真正随机的。另一方面，如果 PIN 只是一个随机数字序列，则锁定只需要应用于源 IP 地址。（如果尝试失败，则不会影响有效帐户，那么您会“锁定”什么？）

**数据存储**：如果您真的在构建某种类似彩票的系统，您*只需要存储中奖 PIN 码*！当用户输入 PIN 时，您可以搜索相对较小的 PIN/奖品（或您的等价物）列表。如果经济情况正确，您可以将“丢失”和无效 PIN 与“抱歉，下次好运”消息或“默认”奖品一视同仁。

祝你好运！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-01T12:33:36.877

问题应该是，“与攻击者的猜测次数相比，平均需要多少次猜测才能找到有效的 PIN 码？”

如果您生成 100 000 个 5 位代码，那么显然需要 1 次猜测。这不太可能足够好。

如果您生成 100 000 个 n 位代码，则需要 (n-5)^10 次猜测。要确定这是否足够好，您需要考虑您的系统如何响应错误的猜测。

如果一个攻击者（或所有攻击者的组合）每秒可以进行 1000 次猜测，那么显然 n 必须非常大才能阻止一个坚定的攻击者。如果您在 3 次错误猜测后永久锁定他们的 IP 地址，那么由于给定的攻击者不太可能访问超过 1000 个 IP 地址，因此 n=9 足以阻止几乎所有攻击者。显然，如果您将面临分布式攻击或来自僵尸网络的攻击，那么每个攻击者 1000 个 IP 地址不再是一个安全的假设。

如果将来您需要发布更多代码（超过 100 000 个），那么显然您可以更轻松地猜测有效代码。因此，现在可能值得花一些时间来确定您未来的扩展需求，然后再确定大小。

鉴于您的刮刮卡用例，如果用户要长时间使用系统，我建议允许他们（或强迫他们）在第一次使用后将他们的 PIN 码“升级”为他们选择的用户名和密码系统的。然后，您将获得用户名/密码的通常优势，而无需放弃仅在卡上输入数字的易用性。

至于如何生成数字-大概您生成的每个数字都会存储，在这种情况下，我会说随机生成它们并丢弃重复项。如果您使用任何一种算法生成它们，并且有人找出了算法，那么他们就可以找出有效的 PIN 码。如果您选择的算法使得某人无法弄清楚该算法，那么这几乎*是*一个伪随机数生成器（PRNG 的另一个属性是它们是均匀分布的，这在这里也有帮助，因为它使得它更难猜测代码），在这种情况下，您不妨随机生成它们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-08T11:24:42.443

如果您使用随机数生成器算法，那么您永远不会有像 "00038384882" 这样的 PIN，以 0（零）开头，因为整数永远不会以“0”开头。您的 PIN 必须以 1-9 数字开头，但 0 除外。

我已经看到许多 PIN 号码包含并开始许多零，因此您消除了前一百万个数字。置换需要计算消除了多少个数。

我认为您需要将 0-9 个数字放入哈希中，并从哈希中随机获取，并制作您的字符串 PIN 号。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T17:27:49.487

如果要生成刮刮卡类型的密码，则必须使用大数字，大约 13 位长；而且，它们必须类似于信用卡号码，在号码本身中嵌入校验和或验证数字。您必须有一个算法来根据一些初始数据生成一个 pin，这些初始数据可以是一个数字序列。生成的 pin 对于序列中的每个数字必须是唯一的，因此如果您生成 100,000 个 pin 码，它们都必须不同。这样，您不仅可以通过对照数据库检查数字来验证数字，还可以先验证它。

我曾经为此目的写过一些东西，我不能给你代码，但总体思路是这样的：

*   准备一个12位数的空格
*   将数字格式化为五位数字（00000 到 99999），并以某种方式沿空间分布。例如，数字 12345 可以扩展为 __3_5_2_4__1。您可以根据它是偶数还是奇数，或 3 的倍数等来改变分配数字的方式。
*   根据某些数字的值，生成更多的数字（例如，如果第三个数字是偶数，则创建一个奇数并将其放入第一个空位，否则创建一个偶数并将其放入第二个空位，例如_83_5_2_4__1
*   生成 6 位数字后，您将只有一个空位。您应该始终保留相同的开放空间（例如倒数第二个空间）。您将在该位置放置验证码。
*   要生成验证数字，您必须对生成的数字执行一些算术运算，例如将奇数位置的所有数字相加并乘以其他数字，然后减去偶数位置的所有数字，最后将所有数字相加数字在一起（您必须根据某些数字的值稍微改变算法）。最后，您有一个验证数字，您将其包含在生成的密码中。

所以现在您可以验证您生成的密码。对于给定的密码，您生成验证数字并与密码中包含的数字进行核对。如果没问题，那么您可以通过执行相反的操作来提取原始数字。

这听起来不太好，因为它看起来像是通过默默无闻的安全性，但这是您可以使用它的唯一方法。有人猜出密码并非不可能，但作为带有验证码的 12 位密码，这将非常困难，因为您必须尝试 1,000,000,000,000 种组合，而您只有 100,000 个有效密码，因此对于那里的每个有效密码是 10,000,000 个无效的。

我应该提一下，这对于一次性密码很有用；一个人只使用一次这些代码之一，例如为预付费电话充电。将这些引脚用作身份验证令牌不是一个好主意，尤其是如果这是对某人进行身份验证的唯一方法（您永远不应该仅通过一条数据对某人进行身份验证；最低要求是用户名+密码）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T10:18:10.267

您似乎想使用 PIN 码作为用户识别的唯一手段。一个可行的解决方案是使用前五位数字来识别用户，并附加四位数字作为 PIN 码。

如果您不想存储 PIN，可以通过将加密安全哈希（SHA1 或更好）应用于用户编号以及系统范围的密码来计算它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-01T10:52:09.607

> 我应该通过某种算法生成此代码吗？

不，这将是可预测的。

> 还是我应该随机生成它？

是的。使用加密随机生成器，或让用户选择自己的 PIN。

理论上 4 位数字就足够了，因为 ATM 卡发行商设法支持一个非常大的社区（显然，它们不能也不需要是唯一的）。但是，在这种情况下，您应该限制输入 PIN 码的尝试次数，并在银行进行多次尝试后将其锁定。您还应该让用户提供一个用户 ID（在 ATM 的情况下，这实际上是在卡上）。

如果您不想以这种方式限制它们，最好放弃 PIN 的想法并使用标准密码（本质上就是您的 PIN，只是长度非常短且字符集有限）。如果您绝对必须将其限制为数字（因为您有密码键盘或其他东西），那么请考虑将 4 设为（可配置的）最小长度而不是固定长度。

您不应该将 PIN 明文存储在任何地方（例如，加盐并像密码一样对其进行哈希处理），但是鉴于长度短且字符集有限，只要提供一种简单的验证方法，它总是容易受到暴力搜索的攻击.

如果您可以告诉我们更多有关您的要求的信息（这是一个网络应用程序吗？嵌入式系统？等），也可以使用各种其他方案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-01T13:09:13.573

*猜测目标用户的 PIN 码与任何*有效用户的 PIN 码是有区别的。从您的用例来看，PIN 似乎用于获取对某些资源的访问权限，攻击者可能会使用该资源，而不是特定的用户身份。如果确实如此，您将需要使有效的 PIN 号码在相同数字的所有可能数字中足够*稀疏。*

正如一些答案中提到的，您需要使您的 PIN 足够随机，无论您是否想从算法生成它。随机性通常通过PIN的*熵来衡量。*

现在，假设您的 PIN 的熵为*N*，并且您的系统中有*2^M*用户（*M < N*），随机猜测产生有效 PIN 的概率为*2^{MN}*。（对不起乳胶符号，我希望它足够直观）。然后从那里您可以确定在给定*N*和*M*的情况下该概率是否足够低，或者根据所需的概率和*M*计算所需的*N。*

 *有多种方法可以生成 PIN，这样您就不必记住生成的每个 PIN。但是您需要一个很长的 PIN 码才能确保其安全。这可能不是你想要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-02T05:58:12.493

我以前用 PHP 和 MySQL 数据库做过这个。我有一个排列函数，它首先确保能够在开始生成过程之前创建所需代码的数量 - $n，长度为 $l，字符数量为 $c。

然后，我会将每个新代码存储到数据库中，并让它通过 UNIQUE KEY 错误告诉我存在冲突（重复）。然后继续，直到我成功创建了 $n 个代码。您当然可以在内存中执行此操作，但我想保留在 MS Word 邮件合并中使用的代码。所以...然后我将它们导出为 CSV 文件。

# mysql - 混合表的 MySQL 事务支持

> ID：404809
> 
> 赞同：1
> 
> 时间：2009-01-01T10:08:11.147
> 
> 标签：mysql, performance, database-design, innodb, myisam

似乎我将需要与 MySQL 的事务，但我不知道如何在 Mysql 中使用混合 InnoDB/MyISAM 表管理事务，这一切似乎都是一团糟。

你可能会问我为什么要把桌子混在一起……答案是性能。正如许多开发人员所注意到的那样，InnoDB 表的性能通常很差，但作为回报，它会提供更高的隔离级别等......

有人对这个问题有什么建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-01T14:56:45.790

我认为您高估了 MyISAM 和 InnoDB 之间的性能差异。MyISAM 在数据仓库的情况下（例如全表扫描报告等）速度更快，但 InnoDB 实际上在许多情况下使用普通的 OLTP 查询可以更快。

InnoDB 更难调优，因为它有更多的旋钮，但是由于更好的锁定和更好的 I/O 模式，经过适当调优的 InnoDB 系统通常可以比 MyISAM 具有更高的吞吐量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-01T10:59:31.183

鉴于您不能在 MyISAM 表中进行事务处理，我不确定实际问题是什么。您需要事务的任何数据都必须在 InnoDB 表中，并且您可以使用正在使用的任何访问库或手动 SQL 命令来管理事务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T21:25:04.603

只使用一个引擎有一定的性能优势。

为一个引擎调整的服务器不会为另一个引擎调整 - 两者都需要您为其专用分配大量 RAM - 因此，您不能同时为它们提供最佳数量。

假设您的（显然是 64 位，但仍然相对较小）数据库服务器上有 8G 的内存，您可能希望将大约 3/4 的内存分配给您的 innodb 页面缓存。或者，如果您使用的是 MyISAM，您可能希望其中一半作为您的 key_buffer。你不能两者都做。

选择一个引擎并专门使用它。有一些方法可以解决性能问题——尽管它们中的大多数并不容易（即它们需要重新设计您的数据结构或应用程序）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T23:35:27.170

简短的回答是 MyISAM 中没有事务支持。如果您启动一个事务，在一些 InnoDB 表中添加或修改数据，在 MyISAM 表中添加或修改数据，然后您必须回滚，您的 MyISAM 更改将无法删除。为了支持这样的混合引擎，您的应用程序必须知道对存储 MyISAM 的任何数据的更改发生在事务“外部”。

如果您需要某些流程的事务，则隔离必须可事务的数据并将*所有*这些数据放在 InnoDB 中。

# python - 我需要帮助——列表和 Python

> ID：404825
> 
> 赞同：-3
> 
> 时间：2009-01-01T10:28:31.713
> 
> 标签：python, list, return

如何在 Python 中返回一个列表？？？

当我尝试返回一个列表时，我得到一个空列表。这是什么原因？？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T11:26:36.527

正如 Andrew 所说，如果您向我们展示您当前使用的代码，您将收到更好的答案。此外，如果您能说明您使用的是哪个版本的 Python，那就太好了。

有几种方法可以返回列表。例如，我们有一个名为 retlist 的函数。

```
def retlist():
    return [] 
```

将返回空列表

```
def retlist():
    a = list()
    a.append(5)
    return a 
```

将返回 [5]。

您还可以使用列表推导返回列表

```
def retlist():
    return [x*x for x in range(10)] 
```

有很多方法可以返回列表。但基本上它涉及 return 。

如果您需要更详细的回复，请评论您需要的内容。

祝你好运

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-01T10:42:02.950

以机智：

```
In [1]: def pants():
   ...:     return [1, 2, 'steve']
   ...: 
In [2]: pants()
Out[2]: [1, 2, 'steve'] 
```

# cocoa - Cocoa 不会捕获 Shift 修饰符？

> ID：404830
> 
> 赞同：3
> 
> 时间：2009-01-01T10:31:23.127
> 
> 标签：cocoa, macos

我有一个应用程序，我试图在其中捕获 shift 键修饰符以执行操作，但是当我运行程序并按下没有 shift 键修饰符的普通键时，我会听到哔声并且修饰符和键未发送到我的 keyDown 事件。相关代码为：

```
NSString* eventChars = [theEvent charactersIgnoringModifiers];

if ([eventChars isEqualTo:@"w"]) {
    newPlayerRow++;
    direction = eUp;
} else if ([eventChars isEqualTo:@"x"]) {
    newPlayerRow--;
    direction = eDown;
} else if ([eventChars isEqualTo:@"a"]) {
    newPlayerCol--;
    direction = eLeft;
} else if ([eventChars isEqualTo:@"d"]) {
    newPlayerCol++;
    direction = eRight;
} else {
    [super keyDown:theEvent];
    return;
}

// handle the player firing a bullet
if (([theEvent modifierFlags] & (NSShiftKeyMask | NSAlphaShiftKeyMask)) != 0) {
    NSLog(@"Shift key");
    [self fireBulletAtColumn:newPlayerCol row:newPlayerRow inDirection:direction];
    [self setNeedsDisplay:YES];
} else {
    ...
} 
```

我不确定是什么原因造成的，但我希望能够捕捉到 shift 按键。提前感谢您对此问题的任何帮助。

编辑：如果这有什么不同，我也在使用 MacBook 键盘。

编辑：这绝对是一个以班次为中心的问题，因为将 (NSShiftKeyMask | NSAlphaShiftKeyMask) 更改为 NSControlKeyMask 确实具有预期的效果。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T23:08:32.210

首先， -charactersIgnoringModifiers 不会忽略 shift 键，因此您仍然会从它返回转换后的字符（即 UPPERCASE 和 !%#$%^&*）。您的函数中可能发生的情况是：您按 shift-w，您的 -isEqualTo: 返回 false，因为您正在比较小写的“w”和大写的“W”，因此您在到达移位检测代码之前返回底端。最简单的解决方案是同时检查两者。

但是，例如，如果您希望阿拉伯语键盘手能够轻松使用您的应用程序，那么您真的不应该对甚至可能不会出现在用户键盘上的字符进行硬编码。-keyCode 返回的值是指键盘上键的位置，而不是表示的字符。对于初学者，Events.h 中以 'kVK_ANSI_' 和 'kVK_' 开头的常量（您可能必须链接到 Carbon.framework 和 #include <Carbon/Carbon.h> 才能使用这些常量）可以与 -keyCode 进行比较返回，它们指的是使用 QWERTY 的 USian 期望的关键位置。因此，您可以（非常）确定，无论键盘布局如何，“wasd”的键码（kVK_ANSI_W、kVK_ANSI_A 等）都将引用用户键盘左上角的那个三角形。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-07T15:18:11.180

如果您只想在没有字符键的情况下收到修改键按下的通知，您应该覆盖 NSResponder 方法 flagsChanged。

`- (void)flagsChanged:(NSEvent *)theEvent`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-01T22:29:31.400

您是否尝试过记录`eventChars`和`modifierFlags`使用的值`NSLog`？也许它与您预期的不同。如果日志语句未显示在您的输出中，则此代码根本没有运行，并且您在其他地方遇到了问题。

```
NSLog(@"Chars: %@, modifier flags: 0x%x", eventChars, [theEvent modifierFlags]); 
```

其他一些值得注意的事情：

1.  `isEqualTo:`是 AppleScript 相等运算符。它*应该可以*工作，但不会因为它通过`compare:`. 正确的方法是或者`isEqualToString:`更通用`isEqual:`的，其中任何一个都可以进行直接的相等比较。
2.  QWERTY 字母区域中的传统移动键集是 wsad，而不是 wxad。这使用倒 T 形排列。您可能还想支持箭头键，因为我们中的许多人确实拥有带有倒 T 形排列的箭头的键盘。

    此外，您应该使这些由用户配置，并且您应该响应*键代码*而不是字母，因为不同的布局（法语、德沃夏克等）会生成不同的字母。我的网站上有[一张改编自 Inside Macintosh 的关键代码表](http://boredzo.org/blog/archives/2007-05-22/virtual-key-codes)。仅将字符用于显示目的。

3.  不应该是“<code>fireBullet ”吗？我不了解你，但是说该方法*向*一个单元格发射子弹告诉我（并且会告诉你，在你一年没看代码之后）它*向*那个单元格发射子弹；将“At”替换为“From”避免了这一混乱时刻。*`From`*`Column:row:inDirection:`

 *** * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T12:20:42.033

从您的代码看来，检查修饰符的代码永远不会到达。任何不是 "w,x,a,d" 的东西都被发送到超类（参见 else 分支）。

您可能想要移动“[super keyDown:theEvent]; return;” 在您的 keyDown 方法结束时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T03:13:37.307

**解决眼前的问题：**

1.  基于 Boaz 所说的， -charactersIgnoringModifiers 不包括 Shift 键（阅读[文档](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/doc/uid/20000016-BCIBEHDG)），并且当 Shift 键按下时**将返回大写字符。**这就是 Control 键起作用而 Shift 键不起作用的原因。在测试之前将字符串切换为[小写：](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/doc/uid/20000154-lowercaseString)

    ```
    eventChars = [[theEvent charactersIgnoringModifiers] lowercaseString]; 
    ```

2.  之后，（正如彼得建议的那样）将所有 isEqualTo: 更改为[isEqualToString:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/doc/uid/20000154-isEqualToString_)（除了正确之外，它还被记录为更快）。

**然而：**

如果您打算将这个应用程序发布给其他人，那么您真的应该使用键码（正如 Peter 和 Boaz 建议的那样），以便它可以在尽可能多的不同键盘和设置上工作。

在您的首选项中创建一个视图，为您拥有的每个命令输入一个输入，并记录用户按下的键的键代码。将这些存储在您的[NSUserDefaults](http://developer.apple.com/documentation/Cocoa/Conceptual/UserDefaults/UserDefaults.html)中并检查这些而不是您的硬编码字符串。您可以为当前的“wasd”键创建默认设置。

有关如何执行此操作的示例（或搜索您的[朋友](http://www.google.com/)） ，请参阅诸如[Shortcut Recorder之类的项目。](http://wafflesoftware.net/shortcut/)

# c - 你更喜欢“if (var)”还是“if (var != 0)”？

> ID：404838
> 
> 赞同：22
> 
> 时间：2009-01-01T10:42:15.523
> 
> 标签：c, perl, coding-style

几十年来，我一直在使用 C 派生语言进行编程。在某个地方，我决定不再想写：

```
if (var)    // in C
if ($var)   # in Perl 
```

当我的意思是：

```
if (var != 0)
if (defined $var and $var ne '') 
```

我认为部分原因是我有一个强类型的大脑，在我看来，“如果”需要一个布尔表达式。

或者可能是因为我经常使用 Perl，而 Perl 中的真假是一个雷区。

或者也许只是因为这些天，我主要是一名 Java 程序员。

你的偏好是什么，为什么？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-01T10:54:11.227

我喜欢我`if`的 s 在大声朗读时有意义：

```
if (is_it_happening) ...
if (number_of_sheep != 0) ...
if (pointer_to_something != NULL) ... 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-01T10:48:33.733

我更喜欢

```
if (var != 0) 
```

它更容易阅读/理解。由于您编写了一次代码但阅读了很多次，因此易于阅读比易于编写更重要。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-01-03T21:41:36.320

这很简单。 `if( var )`测试真实性。 `if( var != 0 )`测试它不是数字 0。它们 **不可互换！** 有三个原因。

首先，`if( var != 0 )`用于检验真伪更加复杂。那里还有更多需要阅读和理解的内容。你必须理解这一点`!=`，这`0`就是“是真的”的成语。缺乏独特的视觉模式，您必须多做一点研究才能知道它与`if( var == 0)`. 这是一个细微的区别，但值得一提。`if( 0 != var )`这种风格存在的事实证明了这一点。最好只是消除问题并`if( var )`用于真实性。

其次，更重要的是，意图必须明确。您是在测试真相还是在测试一个数字（或缺少数字）？ `if( var )`是在检验真理，`if( var != 0 )`是在检验一个数字。要确定其他任何事情，需要了解作者的风格，我们必须假设维护程序员没有。

第三，这里有一个关于真假和数字运算符的值的假设，这可能在某些语言中有效，而在其他语言中无效。在 Perl 中，我认为 Javascript 也是，空字符串是错误的。许多运算符返回空字符串为假。因此，测试真理`if( var != 0 )`会导致警告。当你做一些更天真的事情时，它会变得更加明显，比如`if( var == 1 )`意味着真理，这是一个明显危险的假设。我似乎有很多初级程序员写了这个，然后写了返回奇数但真实的数字的函数来惩罚这种事情。或者，当我心情好时，我已经用`return var ? 1 : 0`.

在相关的注释中，Perl 将返回来自子例程的最后计算的表达式，因此实际上不必编写`return`. 将此与人们认为显式`return`速度较慢的想法相结合，您会得到很多人滥用这一事实。

```
sub set {
    my( $self, $key, $value ) = @_;

    $self->{$key} = $value;
} 
```

`set`将返回`$value`。这是故意的吗？我不知道。我所知道的是有人会开始依赖它。维护程序员不知道他们是否可以更改它。所以我喜欢在每个重要的子程序中显式地返回一个。

```
sub set {
    my( $self, $key, $value ) = @_;

    $self->{$key} = $value;
    return;
} 
```

在这种情况下，我决定`set`暂时不返回任何内容，并且该决定对读者和用户来说都非常清楚。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-01-01T10:46:17.153

```
if (var) 
```

只要您确定自己没有测试错误的东西，就可以少打字。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-01-01T10:49:24.073

我更喜欢显式测试，除非括号内的结果是显式布尔值。短语“if (1)”虽然就语言而言在句法和语义上是正确的，但它是不合逻辑的。它应该是真或假，而不是自动投射。

我更喜欢可读的逻辑代码，而不是每天少打字。

我也非常鄙视这种形式的代码：

```
if (gotError == FALSE) ...
if (isComplete == TRUE) ... 
```

如果布尔值被正确命名（并且应该是），那么正确的方法是：

```
if (!gotError) ...
if (isComplete) ... 
```

那是因为（使用 reductio ad absurdum）`boolVal == TRUE`只是另一个布尔值，那么你在哪里停下来呢？

```
if (isComplete == TRUE) ...
if ((isComplete == TRUE) == TRUE) ...
if (((isComplete == TRUE) == TRUE) == TRUE) ...
if ((((isComplete == TRUE) == TRUE) == TRUE) == TRUE)... 
```

以此类推，无穷无尽。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-01T11:40:15.733

我会说，如果您正在比较一个真正的整数，那么永远不要将隐式转换为布尔值，因为它意味着变量的不同含义。

但话说回来，这种风格如此受欢迎可能没什么大不了的，但是从我使用 C# 的工作来看，我以这种风格编写了我的 C++ 代码：

Boolean 或 int 基本上是一个布尔值：

```
if (val) 
```

大于真/假的真整数很重要：

```
if (val != 0) 
```

某种指针：

```
if (val != NULL) 
```

但正如许多人所说的那样，编码风格在功能上没有任何区别，最好是保持一致，如果您使用现有代码，请与该代码保持一致。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-01T13:42:17.347

在 Perl中`if (defined $var and $var ne '')`和`if( $var)`不等价。试试看`$var=0`。相反，如果您对`$var!=0`所有无法转换为数字的字符串进行测试，则测试将失败（如果您打开了它们，则会发出警告）。

所以你必须确切地知道你的变量包含什么（数字或字符串，是否可以`undef`），以便进行相应的测试。

我通常只是编写`if( $var)`并让 Perl 处理它。我相信这更容易阅读，这是 Perl 中最常见的风格。

很多时候，实际上，正确的测试最终是`if( defined $var)`. 这就是 perl 的新（在 5.10 中）`//`运算符派上用场的地方。`$var= $val // $default`或者通常`$var //= $default`， where仅当(resp ) is`$var`时才会收到。`$default``$val``$var``undef`

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-01T11:13:58.190

在 Javascript 中（我不知道其他动态语言）

```
if (x) 
```

和

```
if (x != 0) 
```

意味着不同的东西。当我希望 x 持有对不应为零长度的对象或字符串的引用时，我将使用前者。这是一个众所周知的成语。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-01T10:53:50.430

如果您有一个打算用作布尔值的值，那么您应该感到很舒服：

```
if ( var )
if ( $var ) 
```

如果您对“布尔值”有更具体的要求，您始终可以对变量进行一些准备工作/测试，并将其分配给具有更好定义的布尔值的另一个变量。

```
$shouldDoSomething = ( defined $var and $var ne '' ) ? 1 : 0;

if ( $shouldDoSomething ) {
    // Handle this case.
} 
```

这可以相当多地清理代码。如果您打算多次使用此条件，它也会有所帮助。实际上，我发现这种情况经常发生。另外，我觉得上面的内容比内联的可读性强得多：

```
if ( defined $var and $var ne '' ) {
    // Handle this case.
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-01T18:49:57.957

我像大多数人一样具有可读性，我喜欢能够扫描我的代码并阅读它而不必考虑太多，它与命名良好的变量名齐头并进。如果您的变量名称听起来应该是普通的`if(isPurchasable)`，那么我会使用它，但是它指的是我使用的数字或日期或类似的方式`if(stock > 0)`。

如果表达式如此简单，我也必须为 if 语句写注释是一个可怕的想法，如下所示的 if 语句虽然我可以理解为什么应该使用注释。

```
if(isPurchasable && stock > 0 && credit >= cost && !reserved) { 
     // Checks to see if customer can purchase product.
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-01T19:37:57.797

对于数值标量，我倾向于写`if ( $num_foo )`何时`$num_foo`在我的控制范围内。如果是用户输入或从外部传入，我要么先将其数字化，要么明确说明测试。这取决于很多因素。主要标准是何时以及如何方便地处理未定义的值，以避免警告。

为了测试非空字符串，我曾经写过`if ( $foo )`，因为正确的咒语只是输入太多：

```
if ( defined $foo and length $foo ) 
```

但我对这种情况并不满意，所以我[在 Perl 5.12 中](http://www.nntp.perl.org/group/perl.perl5.porters/;msgid=20080111141206.GF17196@klangraum)[更改了行为`length undef`](http://www.nntp.perl.org/group/perl.perl5.porters/;msgid=20080111141206.GF17196@klangraum)，这会引发警告并返回 0 直到 Perl 5.10（包括 Perl 5.10）。[在 5.12 中，它只会默默地返回`undef`](http://www.nntp.perl.org/group/perl.perl5.changes/;msgid=20080112223005.697B550007@mx.activestate.com)。因此，在非布尔上下文中，您仍然会收到警告，它只是在`length`评估调用之后而不是之前发生。但在布尔上下文中，没有警告，因此检查非空字符串更容易正确执行：

```
if ( length $foo ) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-01T10:50:00.453

我有很多方法可以做到：

对于布尔值：

```
if (x) 
```

对于整数：

```
if (x != 0)  // always compare, never assume true/false on int values 
```

对于指针：

```
if (x /* != 0 */)  // I've always done this, not sure where I picked it up but I like it 
```

这些天来，我认为最好有一个函数调用来描述 if 语句中的逻辑实际含义

编辑：注意，0（NULL 的整数）是因为我这些天主要使用 C++

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-01T12:51:58.273

我很惊讶没有人提到我过去雇主的编码标准所提倡的另一种选择：

```
if( 0 != x ); 
```

常量总是列在最前面的地方（特别是在比较时更重要，因为它们偶尔会在分配中出现拼写错误——许多错误的根源）

这是我从那时起在我的 C / Perl / C++ / VB.Net 中使用的风格（显然，这一点在 C# 中变得没有实际意义，但实际上并不允许这种`if (x)`情况（除非 x 实际上是一个布尔值，当然）。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-01T13:00:54.200

在 C# 中，它已被明确禁止编写

```
if(x){} 
```

除非 x 是布尔类型。没有从大多数其他类型到 bool 的隐式转换。

我经常使用这种形式编写 JavaScript、PHP 等来检查非空值。但是话又说回来，我确实从中得到了一些（很容易检测到的）错误……我想没有它我们会更好。

在布尔变量上使用它时，我坚信易于阅读的名称。我通常将布尔变量命名为以“is”、“has”或类似名称开头的名称。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-01T15:27:52.577

我通常更喜欢`if (var)`if`if ($var)`用作`var`布尔值，即使语言中没有任何此类类型。

我非常不喜欢`if (!strcmp(...))`or之类的结构`if (var == true)`。第一个试图太聪明，第二个太愚蠢——尽管它可以很好地扩展到`if ((var == true) == true)`, ... ;-)

一些语言，如 Perl 和 C++，提供额外的甚至用户定义的真实性解释。如果转换为布尔值看起来太神奇了，请记住它基本上只是一个`is_true(var)`or`var.booleanValue()`或类似的东西，只是一种更简洁的语法。

与您的问题相关，我喜欢以积极的方式制定条件。代替

```
if (!condition) {
    g();
}
else {
    f();
} 
```

我更喜欢

```
if (condition) {
    f();
}
else {
    g();
} 
```

即使只有一个分支，条件也不是很简单。（这表明需要评论。）例如，而不是

```
// explain reason for condition here
if (!condition) {
    f();
} 
```

我更喜欢将其表述为

```
if (condition) {
    // explain condition here
}
else {
    f();
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-01-01T19:47:52.787

在我看来，简单是最好的。

编写代码越简单越好。此外，您犯错误的可能性也越小。因此，我会使用

```
if(var) 
```

但最后，您应该使用最适合您自己的思维方式的方法。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-01-01T20:49:07.483

我并不总是管理它，但我尝试使用

```
if (0 != var) 
```

所以它符合防守风格

```
if (0 == var) 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-02T22:29:27.660

我更喜欢裸露的：

```
if ($canDo) {
} 
```

而不是类似的东西：

```
if ($canDo == true) {
} 
```

如果条件非常棘手，我要么用注释显式地注释它，要么用一个好的变量名隐式地注释它。在设置布尔变量时，我也尝试非常明确，更喜欢：

```
my($canDo) = !0; 
```

到

```
my($canDo) = 1; 
```

后者令人困惑；为什么将离散值分配给布尔值？

不过，鉴于 Perl 对“评估为真”的许多含义，我可以理解为什么从长远来看更明确更实用。尽管如此，我最喜欢 Perl 的一件事是它自然的语言流动性，我更喜欢在我的代码中坚持这一点（如果需要，留下注释和变量名以进一步澄清事情）。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-03-19T02:41:32.493

如果您在 C 中有一个 int-bool 已经拥有一个标志（而不是一个计数），并且您正在使用“if (var != 0)”对其进行测试，它在哪里结束？“如果（（var！= 0）！= 0）”不是更好吗？:-)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-01T10:51:06.800

VB脚本？好吧，这段代码声明了一个 Variant，所以 bFlag 为零，这实际上是一个 False。

```
Dim bFlag
If bFlag Then 
```

我不喜欢那样。因此，即使在 VB 中，可以选择更具体的声明，我发现自己是明确的，无论是什么类型。

```
Dim bFlag As Boolean
If bFlag = False Then 
```

另一个与变量命名规则有关的问题。如果您使用的是受匈牙利影响的制度，那么您可以直观地判断给定变量是布尔值，因此具体说明它是真还是假不是问题。但是，如果您正在使用其他一些变量命名技术，或者更糟糕的是，以特别的方式命名，那么具体说明正在测试的内容是合适的。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-01T12:30:13.060

我经常使用：

```
 if(x) {
       DoSomething;
       DoSomething2;
     } 
```

因为这是少写的，而读的书说：

> 很少有优秀的程序员使用**if(x!=0)**形式，他们使用**if(x)**。

但有时使用和其他形式：

```
if(x!=0) 
```

哈尼！:-)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-01-04T08:14:34.560

我发现 if(X) { /* ... */ } 更容易阅读（至少在 C 中）。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-01-08T19:25:15.157

如果我不希望其他人阅读代码，我会选择简短的。如果我希望有人真正阅读我的代码，我会考虑使用长格式以提高可读性。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-03-19T02:12:27.290

在我看来，`if (var != 0)`更好。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-03-19T02:32:15.230

我喜欢 Python 结构：

```
if var:
    return "I like the way I do it!" 
```

*这只是例如*;-)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-12-29T08:06:44.937

有些语言你别无选择。例如，在 Specman 中，您不能编写：

```
var x: uint;

if (x) {
    bla
}; 
```

但你*可以*这样做：

```
var x: uint;

if (x != 0) {
    bla
}; 
```

或者

```
var x: bool;

if (x) {
    bla
}; 
```

但是，您不能这样做：

```
var x: bool;

if (x != 0) {
    bla
}; 
```

因为您无法将布尔值与整数进行比较。

Coming from C and Perl I always thought this to be annoying, until I actually started writing a lot in Specman. The code is simply clearer like this.

# algorithm - 量子算法可以用于加密吗？

> ID：404839
> 
> 赞同：1
> 
> 时间：2009-01-01T10:42:59.983
> 
> 标签：algorithm, computer-science, wep

量子算法有用吗？

有没有人成功地将量子算法用于任何用途？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-01T18:49:10.457

“量子算法”是要在量子计算机上运行的算法。

有些事情可以在量子计算模型中快速完成，而经典计算尚不知道（或认为）不可能：[离散对数](http://en.wikipedia.org/wiki/Discrete_logarithm)和[整数分解](http://en.wikipedia.org/wiki/Integer_factorization)（参见[Shor 算法](http://en.wikipedia.org/wiki/Shor%27s_algorithm)）在[BQP](http://en.wikipedia.org/wiki/BQP)中，但不被认为在 P 中（或[BPP](http://en.wikipedia.org/wiki/BPP)）。因此，当/如果构建量子计算机时，众所周知它可以破解 RSA 和大多数当前的密码学。

然而，

*   量子计算机不能（不相信，我的意思是）在多项式时间内解决 NP 完全问题，更重要的是，
*   还没有人建造过量子计算机，甚至不清楚是否有可能建造一台——避免退相干等。（有人声称量子计算机的量子比特数有限——5到10个，但显然它们对任何事情都没有多大用处。）

> “嗯，有一台可以分解 15 倍的量子计算机，所以你们这些使用 4 位 RSA 的人应该担心。” ——布鲁斯·施奈尔

[还有*量子密码学*的概念，它是基于量子通道的密码学，与量子计算完全不同。]

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-01T14:57:31.047

唯一合乎逻辑的答案是它们既有用又没用。;-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-01T14:15:36.030

我的理解是，当前的量子计算能力可以用来安全地交换密钥。然后可以使用交换的密钥来执行传统的密码学。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-26T20:03:52.747

据我所知，量子计算和算法。我在密码学中看到了很多量子算法的用法。如果你真的对密码学感兴趣，请检查这些东西。基本上，重要的是你对量子力学和离散数学的基础知识有多了解. 例如：你一定会看到像 Shor 算法这样困难的算法，这基本上是整数分解。基本上整数分解很容易使用普通算法代数群分解算法，费马分解方法..等等，但是当涉及到量子计算时，它完全不同，你正在量子计算机中运行这些东西，因此算法会发生变化，我们必须使用 Shor 等算法。

基本上对量子计算有很好的理解，然后再看量子算法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T03:59:49.230

Stackoverflow 在各种量子计算机上运行。

费曼暗示了量子概率是人类创造力源泉的可能性。

人群中的个人提出答案并以正确的概率对其进行投票。只有对人群进行多次抽样，才能将概率提高到一个自信的水平。

所以也许 Stackoverflow 是一个成功的量子算法实现的例子。

你怎么看？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T12:52:12.047

还有一些关于量子计算是否可用于解决难题的研究，例如分解大数（如果这是可行的，它将破坏当前的加密技术）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-09T12:38:25.560

可以在当前技术中完成的量子设备的一个很好的用途是随机数生成器。

生成真正的随机位是一个重要的密码原语，例如，在 RSA 算法中用于生成私钥。在我们的 PC 中，随机数生成器根本不是随机的，因为源中没有熵，因此根本不是真正随机的。

# unit-testing - 红绿灯测试的相关性

> ID：404842
> 
> 赞同：1
> 
> 时间：2009-01-01T10:46:19.680
> 
> 标签：unit-testing, language-agnostic, tdd

我开始并喜欢 TDD，但对红绿灯概念感到疑惑。从理论上讲，我确实理解确保您在通过考试之前可以通过考试的重要性。然而，在实践中，我发现这是一种徒劳的做法。

我觉得如果不实现我打算测试的代码，我就无法正确编写失败或通过的测试。例如，如果我编写一个测试来显示我的 DataProvider 正在返回一个 DataRow，我需要编写 DAL 逻辑来给出一个有意义的失败，一个不仅仅是 NullException 或从空方法返回 Null 的失败，看起来毫无意义，因为我觉得红灯应该表明我可以根据我正在测试的实际逻辑创建一个失败的测试。

换句话说，如果我只是从我正在测试的函数中返回 null 或 false，以使我失败，那么红灯的真正价值是什么。

但是，如果我已经实现了逻辑（在某种程度上违背了测试第一范式），我发现我只是为了获得红色而测试互斥概念（IsTrue 而不是 IsFalse，或 IsNull 而不是 IsNotNull）灯而不是绿色，然后将它们切换到相反的位置以获得通行证。

我对这个概念没有兴趣，我真的在提出这个问题，因为这是我注意到的，并且想知道我是否做错了什么。

**编辑**

我接受了查理·马丁的回答，因为它对我最有效，这绝不意味着其他答案没有有效性，所有这些都帮助我理解了一个我显然没有正确理解的概念

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-01T11:03:45.777

红右的价值在于它能够发现误报。发生在我身上的是，无论我的实现代码是什么，它总是通过测试。正是在这种情况下，红灯/绿灯测试才有帮助。

我也遇到过，我的一些测试根本没有运行，当我不使用红灯时，我所看到的只是“构建成功”。如果我使用红灯来确保我的测试失败，那么当我看到构建成功时，我会怀疑构建成功，而我预计构建会失败。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T16:17:45.673

将其视为一种规范。你*首先*问自己，“我最终想要的代码应该能够做什么？” 所以，假设你想编写一个添加自然数的函数。你怎么知道这是否有效？好吧，你知道 2+2=4，所以你可以编写一个测试（这基本上是 python，但省略了很多细节，请参阅[unittest 模块文档](http://docs.python.org/library/unittest.html)）：

```
def test2plus2(self):
    assertEquals(addNat(2,2), 4) 
```

因此，您在这里定义了一个说明“对于自然数 a 和 b，计算 a+b”的规范。 *现在您知道编写函数需要什么*：

```
def addNat(a,b):
    return a+b 
```

你运行它，它通过了测试。但是还有一些其他的事情你知道；因为它仅适用于自然数（无论出于何种原因），您需要添加对非自然数的防范：

```
def testUnnatural(self):
    failUnlessRaises(AssertionErrof, addNat(-1, 2)) 
```

Now you've added a specification that says "and throw an AssertionError if the numbers are negative." that tells you the next piece of code:

```
def addNat(a,b):
    """Version two"""
    assert((a >= 0) and (b>=0))
    return a+b 
```

Run this now, and the assertion doesn't fire; success again.

The point is that TDD is a way of defining very clear detailed specifications. For something like "addNat" they're not needed, but real code, especially in an agile world, you *don't* know the answer intuitively. TDD helps you sort that and fid the real requirements,

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T11:41:35.013

有几个鼓舞人心的例子可以让我想到为什么红灯很有用并且对我有很大帮助。

1.  为了理智而编写红色测试。我确信该测试可以验证我所知道的某些功能尚未实现但真的真的真的没有。

2.  当您在代码中发现错误时，您会编写一个指出该错误的失败测试。从一开始就进行红色测试，您很确定您已经得到它并且知道何时修复错误。

可能有一次红灯没用的例子，那就是当您编写测试以填充有效的功能时，它们通常从一开始就是绿色的。不过，我会警告您不要编写绿色测试，您可能必须重新设计类等等，这会使某些测试过时。*所有那些绿色测试写作都是徒劳的！*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-01T13:16:48.583

我不确定我是否明白你的意思，但这就是我对此事的看法。

少考虑函数返回什么，多考虑它的作用和假设为真。

如果我的真/假函数是以下 C 函数的某种语言版本：

```
bool isIntPrime( int testInt ) 
```

那么你要确保测试失败，如果你通过双倍（而不是像你在某些语言中遇到的那样发生“有用的”隐式转换）。

如果您真的找不到“红灯”案例，那么您的“绿灯”基本上没有意义。如果您真的遇到这种情况，那么测试可能不会有太大价值，因此测试该功能/特性有点浪费时间。也许它是如此简单和强大，它实际上不会失败？那么写一堆“绿灯”测试就是浪费你的时间。

这有点像白兔思想实验。如果我假设所有兔子都是棕色的，那么计算棕色兔子对确定我的主张的真实性毫无帮助。然而，我看到的第一只白兔证明了我的说法是错误的。

这个简单的例子有帮助吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-01T13:38:23.657

我总是从我的代码开始抛出 NotImplementedException，尽管有些人会声称你应该从不实现该方法开始，并且让失败的编译成为你的第一个失败的测试。这有一些逻辑，如果您可以在不使用该方法的情况下编写测试（并且它通过了），那么您就不需要编写任何代码。不过，我通常会在脑海中这样做。

编写了抛出异常的代码后，我继续为我正在开发的功能编写第一个测试并获得第一个红灯（大概）。现在我可以继续 TDD 的常规节奏——Red-Green-Refactor。不要忘记最后一步。当你的测试通过时重构——而不是在编写代码来纠正失败的测试时。

这种方法需要纪律，有时您似乎在做愚蠢的事情，因为通常通过第一个测试最简单的方法是返回一些硬编码的数据。不过要坚持；这个引导阶段相对较短，如果您不跳过它，您可能会发现您编写的代码比通过让您的解决方案（或至少是骨架）在第一次测试中神奇地变成完整的方式更简单、更可维护的代码。如果您不以小增量进行开发，那么您就没有进行 TDD。

强制性免责声明：不要忘记 TDD 是关于单元测试的。还有其他类型的测试（集成、验收、负载……），当您开始进行 TDD 时，对其他类型测试的需求不会神奇地消失。

# linux - 在 ps -l 中，wchan=stext 是什么意思？

> ID：404854
> 
> 赞同：9
> 
> 时间：2009-01-01T10:57:12.403
> 
> 标签：linux, scheduling

当我尝试微调我的流程时，我看到等待通道是 stext，这是什么意思？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-01T11:08:19.620

WCHAN 是内核中进程正在休眠的地址（如果它确实在休眠）。将其设置为 stext 通常意味着您的内核早于 2.6 并且您尚未初始化 System.map（名称列表文件）或者您的内核和名称列表文件不匹配。

如果您执行“man ps”并搜索 wchan，它将告诉您名称列表文件的搜索路径。很可能它发现的第一个与您拥有的内核不匹配，因为 stext 是内核 TEXT 段的开始，您不太可能在那里睡觉。

我相信如果地址在 TEXT 段之外，默认情况下你会得到 stext （因此我认为你的名单文件和内核不匹配）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-11-09T15:13:16.110

wchan 在 SCHED_NO_NO_OMIT_FRAME_POINTER 已设置为“y”（这是默认值）的 x86 系统上被破坏。在那些系统中，wchan 将始终返回映射到 _stext 的“0”

查看[http://lkml.org/lkml/2008/11/6/12](http://lkml.org/lkml/2008/11/6/12)了解更多详情

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-07T18:53:26.927

Kiwi - RHEL 的 ps 应该从 /boot/System.map-2.6.18-53.1.14.el5PAE 中获取名单。我希望这已经安装了。如果它工作正常，那么`ps axo pid,cmd,wchan`将生成一个进程列表和它们正在等待的内核函数。对我来说，它对于大多数函数来说都是有意义的输出，除了少数——rpc.idmap 和 lockd。几个函数显示“stext”，我仍然想知道这是什么意思。

# math - 计算已知中点的三次贝塞尔曲线

> ID：404861
> 
> 赞同：5
> 
> 时间：2009-01-01T11:05:02.670
> 
> 标签：math, bezier

我知道：

*   控制点 a 和 d（二维三次贝塞尔曲线的起点和终点）

*   斜率 a->b、c->d 和 b->c（b,c 其他控制点）

*   [贝塞尔曲线](http://en.wikipedia.org/wiki/B%C3%A9zier_curve)的中点在哪里。

现在，给定这些信息，控制点 b 和 c 位置的公式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-07T18:02:45.263

我知道这个问题很老，但没有提供正确或完整的答案，所以我想我会提出一个解决方案。请注意，大卫的计算包含几个错误，即使这些错误得到纠正，他的解决方案也不完整。

首先，定义向量`T0`，`T1`并`T2`使用三个斜率：

```
T0 = ( b - a ) / u0
T1 = ( c - b ) / u1
T2 = ( d - c ) / u2 
```

如果我们知道每对控制点之间的*方向*和*距离*，那么我们就不需要比例因子`u0`和。因为我们只知道斜率，并且是未知的标量。此外，我们假设和非零，因为斜率已定义。`u1``u2``u0``u1``u2``u0``u1``u2`

我们可以用几种不同的方式重写这些方程，以获得每个控制点根据其他控制点的表达式。例如：

```
b = a + T0*u0
c = b + T1*u1
d = c + T2*u2 
```

该问题还指出，我们有三次贝塞尔曲线的“中点”。我认为这意味着我们的点位于曲线参数范围的中点。我将这一点称为`p`：

```
p = ( a + 3*b + 3*c + d ) / 8 
```

用左侧的未知数重写产生：

```
b + c = ( 8*p - a - d ) / 3 
```

我们现在可以用各种方式替换`b`和`c`使用前面的表达式。事实证明，当我们有平行向量或时`T0`，就会出现歧义。有四种情况需要考虑。`T1``T2`

**情况1：`T0`不平行`T1`**

代入`b = a + T0*u0`和`c = a + T0*u0 + T1*u1`解决`u0`和`u1`：

```
2*T0*u0 + T1*u1 = ( 8*p - 7*a - d ) / 3 
```

这是两个方程和两个未知数，因为`T0`和`T1`是向量。代入`u0`和得到缺失的控制点和。`u1``b = a + T0*u0``c = a + T0*u0 + T1*u1``b``c`

**情况2：`T1`不平行`T2`**

代入`c = d - T2*u2`和`b = d - T2*u2 - T1*u1`解决`u1`和`u2`：

```
T1*u1 + 2*T2*u2 = ( a + 7*d - 8*p ) / 3 
```

**案例3：`T0`不平行`T2`**

代入`b = a + T0*u0`和`c = d - T2*u2`解决`u0`和`u2`：

```
T0*u0 - T2*u2 = ( 8*p - 4*a - 4*d ) / 3 
```

**情况 4：`T0`和`T1`都是`T2`并行的**

在这种情况下`a`，`b`，`c`和`d`都是共线的，`T0`，`T1`和`T2`都等价于一个比例因子内。没有足够的信息来获得唯一的解决方案。一个简单的解决方案是`b`通过设置简单地选择`u0 = 1`：

```
b = a + T0
(a + T0) + c = ( 8*p - a - d ) / 3
c = ( 8*p - 4*a - d - 3*T0 ) / 3 
```

存在无数种解决方案。本质上，拣货`b`定义`c`或拣货`c`将定义`b`。

**扩展到 3D**

该问题专门询问了平面贝塞尔曲线，但我认为有趣的`p`是，当将此问题扩展到非平面 3D 三次贝塞尔曲线时，该点不是必需的。在这种情况下，我们可以简单地为 和`u0`求解这个方程：`u1``u2`

```
T0*u0 + T1*u1 + T2*u2 = d - a 
```

这是三个方程（向量是 3D）和三个未知数（`u0`和`u1`）`u2`。代入`b = a + T0*u0`and`c = b + T1*u1`或`c = d - T2*u2`得到`b`and `c`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T13:39:58.537

假设您的斜率已标准化，那么对于某些 u,v 您有

```
u * slope(a->b)+a = b, v * slope(c->d)+d = c 
```

你知道 a、d 和`q:=(a+b+c+d)/8`（曲线的中点）的值，所以`c = 8(q-a-d-b)`

将上述方程插入你得到的最后一个方程

```
v * slope(c->d)+d = 8(q-a-d-a-u * slope(a->b)) 
```

这是两个变量（u，v）中的2个方程（一个2d向量方程）

你不需要第三个斜坡。

# notepad++ - 如何在记事本++中多行“替换文件...”

> ID：404873
> 
> 赞同：79
> 
> 时间：2009-01-01T11:23:33.787
> 
> 标签：notepad++, scintilla

如果免费源代码编辑器[Notepad++](http://notepad-plus.sourceforge.net/uk/about.php)具有“在文件中查找...”功能，即没有在编辑器中打开文件，它是否也具有“在文件中替换...”功能？

Notepad++ 基于编辑组件[Scintilla](http://www.scintilla.org/) - 在 SourceForge 对此功能的请求有响应：“无需将其包含在 SciTE 中，因为您可以使用参数对话框将此命令添加到工具菜单中。” 那么是否可以在 Notepad++**中的文件中进行多行替换？**

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2010-11-01T18:35:38.713

在 Notepad++ 中进行多行替换很容易。您必须使用`\n`来表示字符串中的换行符，它适用于搜索和替换字符串。您必须确保在搜索窗口的左下角选择“扩展”搜索模式。

我在这里找到了一篇描述这些功能的好文章：http: [//markantoniou.blogspot.com/2008/06/notepad-how-to-use-regular-expressions.html](http://markantoniou.blogspot.com/2008/06/notepad-how-to-use-regular-expressions.html)

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2015-08-31T16:15:33.203

实际上，使用 Notepad++ 的 ToolBucket 插件进行多行替换更容易。

要激活它，只需转到 N++ 菜单：

插件 > 插件管理器 > 显示插件管理器 > 检查 ToolBucket > 安装。

重新启动 N++ 并按 ALT + SHIFT + F 进行多行编辑。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-12-17T17:16:10.340

解决方法是

1.  搜索并将 \r\n 替换为 thisismynewlineword

（这将删除所有新行，应该有整行）

1.  现在执行您的替换

2.  搜索并将 thisismynewlineword 替换为 \r\n

（撤消步骤 1）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T12:52:12.827

这是一个主观意见，但我认为文本编辑器不应该做所有事情和厨房水槽。我更喜欢轻巧灵活且功能强大（在他们的专业领域）的编辑器。尽管我主要是 Windows 用户，但我喜欢 Unix 哲学，即拥有许多可以一起使用的专用工具（例如[UnxUtils](http://unxutils.sourceforge.net/ "UnxUtils")），而不是像怪物一样做所有事情，但不一定如你所愿！

在文件中查找位于这些额外功能的边界，但当您可以双击找到的行以在右侧行打开文件时很有用。请注意，最初，在 SciTE 中，它只是对 grep 或等价物的工具调用！
FTP 非常接近题外话，尽管它可以被视为扩展的打开/保存对话框。
在文件中替换太多 IMO：如果您没有预览等，这很危险（您可以一次弄乱很多文件）。我宁愿使用我选择的专用工具，也许在[Multi line search and replace tool](https://stackoverflow.com/questions/268045/multi-line-search-and-replace-tool "多行搜索和替换工具")中。

为了回答这个问题，查看 N++，我看到一个运行菜单，您可以在其中启动任何工具，并指定名称和快捷键。我还看到 Plugins > NppExec，它似乎能够启动 sed 之类的东西（没有尝试过）。

# mysql - 更改 MySQL 读取的日期格式

> ID：404875
> 
> 赞同：0
> 
> 时间：2009-01-01T11:28:10.050
> 
> 标签：mysql, date, format

我有一个为 Oracle 数据库创建的批处理文件，我现在正尝试将其导入 MySQL 数据库。我不得不处理两者之间的各种不一致。该文件的所有日期都为“17-NOV-1981”，而不是 MySQL 预期的“1981-11-17”。

批处理文件具有命令***ALTER SESSION set nls_date_format='DD-MON-YYYY';*** 设置日期格式。MySQL 中是否有等价物可以让它按原样接受日期而无需主要编辑文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T11:35:24.620

我不相信不修改 SQL 是可能的。

[STR_TO_DATE](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_str-to-date)可以在插入语句中用于转换字符串，或者您可以尝试通过[sed](http://unixhelp.ed.ac.uk/CGI/man-cgi?sed)管道传输文件并使用正则表达式来发现日期并重新处理它们，例如，这样的事情会用调用 str_to_date 替换原始转储中的单引号日期，并将生成的转换后的 sql 通过管道传输到 mysql...

```
cat oracledump.sql |  sed "s/'[0-9][0-9]-\(JAN\|FEB\|MAR\|APR\|MAY\|JUN\|JUL\|AUG\|SEP\|OCT\|NOV\|DEC\)-[1-2][0-9][0-9][0-9]'/str_to_date(&, '%d-%b-%Y')/g" | mysql newdb 
```

# java - 如何从图像数据创建 java.awt.Image？

> ID：404877
> 
> 赞同：2
> 
> 时间：2009-01-01T11:30:57.750
> 
> 标签：java, image, awt

如何从图像数据创建 java.awt.Image？图像数据不是纯 RGB 像素数据，而是以 jpeg/png 格式编码。

JavaME 有一个简单的 api Image.createImage(...) 用于执行此操作。

```
public static Image createImage(byte[] imageData,
                                int imageOffset,
                                int imageLength) 
```

imageData - 支持的图像格式的图像数据数组。

JavaSE中是否有类似的东西可用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T11:43:09.660

```
import java.awt.*;

Toolkit toolkit = Toolkit.getDefaultToolkit();

Image image = toolkit.createImage(imageData,imageOffset,imageLength); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T13:53:39.087

使用 javax.imageio.ImageIO

```
BufferedImage image = ImageIO.read(new ByteArrayInputStream(myRawData)); 
```

**不要**使用返回 BufferedImage 以外的 Image 实现的旧函数。Image 接口实际上只是一个可能被后台线程加载的句柄，给你带来各种各样的麻烦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T13:35:45.313

看看 java.awt.image.MemoryImageSource。

# sqlite - SQLite3：在 C++ 中插入带有 NULL 字符的 BLOB

> ID：404879
> 
> 赞同：8
> 
> 时间：2009-01-01T11:35:40.143
> 
> 标签：sqlite, null, escaping, blob

我正在开发一个 C++ API，它使用定制设计的插件来使用它们的 API 和特定的 SQL 语法与不同的数据库引擎进行交互。

目前，我正在尝试找到一种插入 BLOB 的方法，但由于`NULL`是 C/C++ 中的终止字符，因此在构造*INSERT INTO*查询字符串时 BLOB 会被截断。到目前为止，我已经与

```
//...
char* sql;
void* blob;
int len;
//...
blob = some_blob_already_in_memory;
len = length_of_blob_already_known;
sql = sqlite3_malloc(2*len+1);
sql = sqlite3_mprintf("INSERT INTO table VALUES (%Q)", (char*)blob);
//... 
```

我希望，如果可以在 SQLite3 交互式控制台中执行此操作，那么应该可以使用正确转义的`NULL`字符构造查询字符串。也许有一种方法可以使用 SQLite SQL 语法也支持的标准 SQL 来做到这一点？

肯定有人以前遇到过同样的情况。我用谷歌搜索并找到了一些答案，但使用的是其他编程语言（Python）。

预先感谢您的反馈。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-02T22:08:41.977

再次感谢大家的反馈。这一次，我报告了我是如何借助此处提供的指示解决问题的。希望这将在未来对其他人有所帮助。

正如前三张海报所建议的，我确实使用了准备好的语句——另外因为我也对获取列的数据类型感兴趣，而简单的`sqlite3_get_table()`不会这样做。

准备好以下常量字符串形式的 SQL 语句后：

```
INSERT INTO table VALUES(?,?,?,?); 
```

它仍然是相应值的*绑定*。这是通过发出`sqlite3_bind_blob()`与列一样多的调用来完成的。（我还求助于`sqlite3_bind_text()`其他“简单”数据类型，因为我正在处理的 API 可以将整数/双精度/等转换为字符串）。所以：

```
#include <stdio.h>
#include <string.h>
#include <sqlite3.h>
/* ... */
void* blobvalue[4] = { NULL, NULL, NULL, NULL };
int blobsize[4] = { 0, 0, 0, 0 };
const char* tail = NULL;
const char* sql = "INSERT INTO tabl VALUES(?,?,?,?)";
sqlite3_stmt* stmt = NULL;
sqlite3* db = NULL;
/* ... */
sqlite3_open("sqlite.db", &db);
sqlite3_prepare_v2(db,
                   sql, strlen(sql) + 1,
                   &stmt, &tail);
for(unsigned int i = 0; i < 4; i++) {
    sqlite3_bind_blob(stmt, 
                      i + 1, blobvalue[i], blobsize[i], 
                      SQLITE_TRANSIENT);
}
if(sqlite3_step(stmt) != SQLITE_DONE) {
    printf("Error message: %s\n", sqlite3_errmsg(db));
}
sqlite3_finalize(stmt);
sqlite3_close(db); 
```

另请注意，某些函数（`sqlite3_open_v2()`, `sqlite3_prepare_v2()`）出现在更高版本的 SQLite 上（我想是 3.5.x 及更高版本）。

可以使用（例如）创建`tabl`文件中的 SQLite 表`sqlite.db`

```
CREATE TABLE tabl(a TEXT PRIMARY KEY, b TEXT, c TEXT, d TEXT); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-02T02:38:13.817

您将希望将此函数与准备好的语句一起使用。

```
int sqlite3_bind_blob(sqlite3_stmt*, int, const void*, int n, void(*)(void*)); 
```

在 C/C++ 中，处理字符串中的 NULL 的标准方法是存储字符串的开头和长度，或者存储指向字符串开头的指针和指向字符串结尾的指针。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T12:57:58.993

您要预编译语句`sqlite_prepare_v2()`，然后在 using 中绑定 blob `sqlite3_bind_blob()`。请注意，您绑定的语句将是*INSERT INTO table VALUES (?)*。

# c++ - CString::Format 的替代方案？

> ID：404886
> 
> 赞同：3
> 
> 时间：2009-01-01T11:50:02.767
> 
> 标签：c++, string, mfc, format

在 VC6 中进行字符串格式化是否有更好的替代方法，在替换之前进行语法检查？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-01T12:41:44.893

`CString`提供了-style 格式化的`Format`方法`printf`，但这不是类型安全的。

对于类型安全的字符串格式化，您可以使用`std::stringstream`/`std::wstringstream`或[Boost Format](http://www.boost.org/doc/libs/1_37_0/libs/format/index.html)库，尽管它们都适用于 C++`std::basic_string`类模板，而不是 MFC`CString`类。我已经在 VC6 中成功地使用了这两种方法。

Boost Format 很好，因为它允许您使用`printf`-like 语法，并且如果您提供的参数与格式字符串不匹配，则会引发异常，而使用 C++ iostreams 的字符串格式往往会使您的代码非常冗长。

请注意，您可以从 a 创建`CString`对象，`std::string`如下所示：

```
std::string s;
CString str( s.c_str() ); 
```

我希望这有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T23:51:57.190

查看[FastFormat](http://www.fastformat.org/)。它有一个简单的语法和一个“接收器”——FastFormat 术语，用于接收格式化操作的结果——用于 CString。

类似于以下内容：

```
int i = 1;
std::string ss = "a std string";
CString cs = "a Cstring";

CString result;

fastformat::fmt(result, "i={0}, ss={1}, cs={2}", i, ss, cs); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T03:46:53.877

[FormatString - 智能字符串格式化](http://www.codeproject.com/KB/string/FormatString.aspx)
作者：Ivo Beltchev

发表在 CodeProject

# ruby-on-rails - 被 RSpec 惊呆了

> ID：404887
> 
> 赞同：0
> 
> 时间：2009-01-01T11:50:20.363
> 
> 标签：ruby-on-rails, ruby, testing, rspec

对不起，但这开始感觉像是在踢自己的头。我对 RSpec 完全感到困惑。一个接一个地看视频，一个接一个地阅读教程，但我仍然停留在第一个问题上。

===这是我正在使用的

**[http://github.com/fudgestudios/bort/tree/master](http://github.com/fudgestudios/bort/tree/master)**

=== 错误

```
F

1)
NoMethodError in 'bidding on an item should work'
You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.new_record?
spec/controllers/auction_controller_spec.rb:16:
spec/controllers/auction_controller_spec.rb:6:

Finished in 0.067139 seconds

1 example, 1 failure 
```

=== 这是我的控制器动作

```
 def bid

      @bid = Bid.new(params[:bid])
      @bid.save

  end 
```

===这是我的测试

```
require File.dirname(__FILE__) + '/../spec_helper'
include ApplicationHelper
include UsersHelper
include AuthenticatedTestHelper

describe "bidding on an item" do
  controller_name :items

    before(:each) do
      @user = mock_user
      stub!(:current_user).and_return(@user)
    end

  it "should work" do
    post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
    assigns[:bid].should be_new_record
  end

end 
```

=== spec_helper

**[http://github.com/fudgestudios/bort/tree/master/spec/spec_helper.rb](http://github.com/fudgestudios/bort/tree/master/spec/spec_helper.rb)**

凌晨 3 点起床上班，一整天一事无成，真是令人沮丧。敬请谅解。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-01T17:46:13.467

在 before(:each) 中你有一些倒退的东西。看到示例指定帖子应将计数增加 1，您正在处理真实记录，根本没有理由存根任何东西。此外，此时，由于只有一个示例，因此没有理由使用 before 块。我会这样做：

```
describe ItemsController, "bidding on an item" do
  fixtures :users

  it "should create a new Bid" do
    login_as :quentin
    lambda do
      post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
    end.should change(Bid, :count).by(1)
  end

end 
```

我推荐的一件事是现在非常精细地创建这些东西，直到你更好地理解它们。从期望开始（帖子应该更改出价计数），运行规范并让失败消息指导您在规范或代码中添加您需要的任何其他内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-14T12:20:07.450

杰西，

如果您注释掉 before(:each) 的第二两行，它仍然会通过，这对“应该创建一个新的 Bid”示例没有影响。

lambda 关键字创建一个任意代码块，在定义它时不会执行，但实际上是一个可以分配给变量并稍后执行的对象：

```
the_post = lambda do
  post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
end 
```

此时代码没有被执行，但我们可以使用 'the_post' 变量来引用它。现在我们可以发送“should”，然后发送“change ...”，如下所示：

```
the_post.should change(Bid, :count).by(1) 
```

执行此行时，会发生一些事情。'should' 右边的材料首先被评估，用一些指令初始化一个 rspec 匹配器对象。该匹配器是“应该”的参数 - 相当于：

```
matcher = change(Bid, :count).by(1)
the_post.should(matcher) 
```

'should' 方法在 the_post 上调用，它是代码块（仍未执行）。在后台，'should' 方法将 self (the_post) 传递给匹配器，因此匹配器现在拥有评估示例所需的一切。

匹配器调用 Bid.count 并记录该值。然后它执行块（the_post），然后再次调用 Bid.count 并将其与之前记录的值进行比较。在这种情况下，由于我们正在寻找 Bid.count 以 1 变化（此处隐含正数 - 增加 1），如果发生这种情况，则匹配器保持沉默并且示例通过。

如果这些值相同，或者相差 1 以外的某个值，则示例将失败。如果将期望更改为 by(2) 而不是 by(1)，您可以看到该工作。

HTH，大卫

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-01T16:12:13.360

编辑：您不应该期望 Bid.count 在使用模拟对象时增加。我忘记了口头禅：代码之前的咖啡因。

现在只是注释掉这些行，所以原来的仍然存在。

```
require File.dirname(__FILE__) + '/../spec_helper'
include ApplicationHelper
include UsersHelper
include AuthenticatedTestHelper

describe "POST to bid_controller" do
  controller_name :items

  before(:each) do
        #@bid = mock_model(Bid)           # create a new mock model so we can verify the appropriate things
        #Bid.stub!(:new).and_return(@bid) # stub the new class method on Bid to return our mock rather than a new ActiveRecord object.
                                         # this separates our controller spec entirely from the database.
  end

  it "should create a new Bid" do
    lambda do
        post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
    end.should change(Bid, :count).by(1)
  end

    # ... more specs
end 
```

尝试编写尽可能小的规范，以使您应该在该规范中验证的内容显而易见的方式编写您的设置。例如，我如何将您的从 更改`it "should work"`为`it "should create a new Bid"`. 如果该控制器还有更多功能，请为每个小功能编写一个新规范。

如果你最终需要模拟用户，有一些 restful_authentication 的帮助器可以让它更容易。首先在 中创建一个用户夹具 `RAILS_ROOT/spec/fixtures/users.yml`，如下所示：

```
quentin:
  login: quentin
  email: quentin@example.com
  salt: 7e3041ebc2fc05a40c60028e2c4901a81035d3cd
  crypted_password: 00742970dc9e6319f8019fd54864d3ea740f04b1 # test
  created_at: <%= 5.days.ago.to_s :db %>
  activation_code: 8f24789ae988411ccf33ab0c30fe9106fab32e9b 
  activated_at: <%= 5.days.ago.to_s :db %> 
  name: "Quentin" 
```

然后在您的规范中，您将能够编写以下内容并让您的`current_user`方法和 restul_authentication 的所有其他部分的行为与您在运行时所期望的一样。

```
login_as :quentin
# .... the rest of your spec 
```

作为更多规范的示例，我可能会添加更多示例：

```
def do_post
    # extracting the method under test, so I don't repeat myself
    post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
end

it "should create a new Bid" do
    lambda do
    do_post
    end.should change(Bid, :count).by(1)
end

it "should assign the Bid to the proper auction" do
    @bid.should_receive(:auction_id=).with(1) # test this, I believe doing  Bid.new(params[:bid]) sets the id directly not sets the model
    do_post
end

it "should assign the Bid the proper points" do
    @bid.should_receive(:point=).with(1)
    do_post
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T17:13:09.713

虽然我不太明白发生了什么。（带有存根和 lambda）....

为了

```
def bid
  @bid = Bid.new params[:bid]
  @bid.save
end 
```

以下**通过！！**

```
require File.dirname(__FILE__) + '/../spec_helper'
include ApplicationHelper
include UsersHelper
include AuthenticatedTestHelper

describe "bidding on an item" do
  controller_name :items
  fixtures :users

  before(:each) do
    @user = login_as :quentin
    @bid = mock_model(Bid)           # create a new mock model so we can verify the appropriate things
    @bid.stub!(:new).and_return(@bid) # stub the new class method on Bid to return our mock rather than a new ActiveRecord object.
    #Bid.stub!(:save).and_return(true)# this separates our controller spec entirely from the database.
  end

  it "should create a new Bid" do
    lambda do
      post 'bid', :bid => { :auction_id => 1, :user_id => @user.id, :point => 1 }
    end.should change(Bid, :count).by(1)
  end

end 
```

# windows-xp - 这是 Windows XP 防火墙错误吗？

> ID：404890
> 
> 赞同：2
> 
> 时间：2009-01-01T11:56:58.197
> 
> 标签：windows-xp, firewall

我的 Windows XP 计算机上运行着一个网络服务器。我已将防火墙设置为允许传入的 HTTP 连接：防火墙设置窗口->“高级”选项卡->选择我的网络连接->设置->服务->选中“Webserver(HTTP)”复选框。

通常，这是有效的。但是，有时在重新启动服务器计算机时，防火墙会再次开始阻止 HTTP 连接，尽管在防火墙设置窗口中仍然检查了“Webserver(HTTP)”异常。

那么，让事情再次正常运行的唯一方法是取消选中上述选项，保存设置，重新打开防火墙对话框并检查该选项并再次保存。

我的问题是，这是我机器的一些特性还是 Windows XP 防火墙错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-01T12:10:44.363

不，这不是错误，您只是误解了“服务”选项卡的用途。

该选项卡上的列表适用于防火墙系统还用作另一台计算机的 NAT 网关（“Internet 连接共享”或 Microsoft 提出的任何名称）的情况。它基本上是 DNAT 的一种形式。它控制是否允许通过防火墙系统*后面的专用网络上运行的主机启动到该端口的连接。*

您需要在例外选项卡上为端口 80 / TCP 添加例外（不要忘记单击更改范围并选择适当的范围！）这将毫无障碍地工作。我还建议您尽快取消选中您检查的内容，因为 Windows 客户端操作系统并不特别适合数据包转发，并且该选项卡上的设置有时会神秘地干扰正常的网络流量（就像您的情况一样。）

# jquery - 如何在jQuery中将值从一个页面传递到另一个页面

> ID：404891
> 
> 赞同：3
> 
> 时间：2009-01-01T11:59:47.160
> 
> 标签：jquery

我有两页 jQuery，Page1 和 Page2，我可以在 Page1 中获得输入。

`somval=1000$`。_

第 1 页用户输入某个值。我已经存储了值：

```
var val = somval; 
```

现在在第二页，我需要得到第1页中somvalue的结果。当然两个页面分别使用My1.js My2.js。

如何将一个 jQuery 文件中的值共享给其他 JavaScript，或者如何从 page1 值获取值到 page2？

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-01T12:13:01.097

您可以使用查询字符串中的数据将用户重定向到下一页，然后在第二页中您可以解析 URL。

要重定向用户，您可以这样做：

```
window.location = 'page2.html?somval=' + somval; 
```

然后在第二页中，您可以使用一个函数来解析 URL 查询字符串：

```
var qsParm = new Array();
function qs() {
    var query = window.location.search.substring(1);
    var parms = query.split('&');
    for (var i=0; i < parms.length; i++) {
        var pos = parms[i].indexOf('=');
        if (pos > 0) {
            var key = parms[i].substring(0, pos);
            var val = parms[i].substring(pos + 1);
            qsParm[key] = val;
        }
    }
} 
```

[这段代码是从这里](http://javascript.about.com/library/blqs.htm)借来的，尽管有[很多方法可以做到这一点](http://www.google.com.au/search?q=parse+query+strings+javascript)。

您提到了 jQuery，但如果我错了，请纠正我，我认为它不能做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T23:51:34.667

您可以将数据设置在 cookie 中，[http://www.quirksmode.org/js/cookies.html](http://www.quirksmode.org/js/cookies.html)具有读取和写入 cookie 的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-01T12:24:30.480

这个问题并不特定于 jQuery（即它可能没有特定的解决方案，除非我弄错了），而是任何网页。
Gerald 给出了 URL 查询字符串的解决方案，另一个经典的解决方案，如果你想独立于服务器，就是使用 cookie，它们就是为此而生的！
使用服务器，您可以获得会话数据、隐藏字段、Ajax 保存和恢复等。

# c# - 委托中的变量范围

> ID：404899
> 
> 赞同：8
> 
> 时间：2009-01-01T12:23:25.787
> 
> 标签：c#, functional-programming, delegates, lambda, scope

我发现以下内容很奇怪。再说一次，我主要在动态语言中使用闭包，这不应该被同一个“错误”怀疑。以下使编译器不高兴：

```
VoidFunction t = delegate { int i = 0; };

int i = 1; 
```

它说：

> 不能在此范围内声明名为“i”的局部变量，因为它会给“i”赋予不同的含义，而“i”已在“子”范围中用于表示其他内容

所以这基本上意味着在委托中声明的变量将具有在其中声明的函数的范围。不完全是我所期望的。我什至没有尝试调用该函数。至少 Common Lisp 有一个特性，你说一个变量应该有一个动态名称，如果你真的希望它是本地的。这在创建不泄漏的宏时尤其重要，但类似的东西在这里也很有帮助。

所以我想知道其他人如何解决这个问题？

为了澄清我正在寻找一种解决方案，其中我在委托中声明的变量不会干扰委托*之后*声明的变量。而且我希望仍然能够捕获在委托之前声明的变量。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-01T12:33:02.430

它必须是允许匿名方法（和 lambdas）使用包含方法范围内的局部变量和参数的方式。

解决方法是为变量使用不同的名称，或者创建一个普通的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T13:26:09.513

匿名函数创建的“闭包”与其他动态语言创建的“闭包”有些不同（我将使用 Javascript 作为示例）。

```
function thing() {
    var o1 = {n:1}
    var o2 = {dummy:"Hello"}
    return function() { return o1.n++; }
}

var fn = thing();
alert(fn());
alert(fn()); 
```

这个小块 javascript 将显示 1 然后 2。匿名函数可以访问 o1 变量，因为它存在于其作用域链中。然而，匿名函数有一个完全独立的作用域，它可以在其中创建另一个 o1 变量，从而隐藏作用域链下的任何其他变量。还要注意，整个链中的所有变量都保留下来，因此只要 fn 变量持有函数引用，o2 就会继续存在持有对象引用。

现在与 C# 匿名函数进行比较：-

```
class C1 { public int n {get; set;} }
class C2 { public string dummy { get; set; } }

Func<int> thing() {
   var o1 = new C1() {n=1};
   var o2 = new C2() {dummy="Hello"};
   return delegate { return o1.n++; };
}
...
Func<int> fn = thing();
Console.WriteLine(fn());
Console.WriteLine(fn()); 
```

在这种情况下，匿名函数不会创建真正独立的范围，就像任何其他函数内 {} 代码块中的变量声明（用于 a `foreach`，`if`等）

因此，同样的规则适用，块外的代码不能访问块内声明的变量，但你也不能重用标识符。

当匿名函数被传递到创建它的函数之外时，就会创建一个闭包。与 Javascript 示例的不同之处在于，只有匿名函数实际使用的那些变量才会保留，因此在这种情况下，o2 持有的对象将一旦事情完成就可以用于GC，

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T13:56:25.680

您还将从如下代码中获得 CS0136：

```
 int i = 0;
  if (i == 0) {
    int i = 1;
  } 
```

“i”的第二个声明的范围是明确的，像 C++ 这样的语言没有任何问题。但是 C# 语言设计者决定禁止它。鉴于上面的片段，你认为仍然认为这是一个坏主意吗？扔进一堆额外的代码，你可能会盯着这段代码看一会儿，却看不到错误。

解决方法是简单而轻松的，只需想出一个不同的变量名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T12:34:59.617

这是因为委托可以引用委托之外的变量：

```
int i = 1;
VoidFunction t = delegate { Console.WriteLine(i); }; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T12:43:52.487

如果我没记错的话，编译器会创建一个匿名方法中引用的外部变量的类成员，以使其工作。

这是一种解决方法：

```
class Program
    {
        void Main()
        {
            VoidFunction t = RealFunction;
            int i = 1;
        }
        delegate void VoidFunction();
        void RealFunction() { int i = 0; }
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-01T13:57:27.893

实际上，该错误似乎与匿名委托或 lamda 表达式无关。如果您尝试编译以下程序...

```
using System;

class Program
{
    static void Main()
    {
        // Action t = delegate
        {
            int i = 0;
        };

        int i = 1;
    }
} 
```

...无论您是否在该行中发表评论，您都会得到完全相同的错误。[错误帮助](http://msdn.microsoft.com/en-us/library/973aa6bt(VS.71).aspx)显示了一个非常相似的情况。我认为禁止这两种情况是合理的，因为程序员可能会混淆这两个变量。

# jquery - 处理 jQuery 插入的 HTML 元素的事件

> ID：404905
> 
> 赞同：4
> 
> 时间：2009-01-01T12:31:52.103
> 
> 标签：jquery

我目前有一个锚标记，当单击它时，会将另一个锚标记附加到 DOM。这一切都是通过 jQuery 完成的。我知道要添加的锚标记的“id”属性是什么。但是，当我尝试以下代码时，它无法处理新添加的锚标记的点击事件：

$("#id").click(function() { alert("test"); });

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-06-22T14:01:58.103

您遇到的问题是，当您拥有代码时`$('#Element').click(function(){...});`，它只会在最初运行该代码时存在的元素上运行代码，如果您使用的是最新版本的 jQuery，则应该使用此代码使其工作：

```
//This makes sure that all the elements are ready to receive jQuery bindings
$(document).ready(function(){

    //The .on function will attach the event to all current
    // elements that match the selector and all future elements
    // that will match the selector
    $(document).on('[EVENT]', '[SELECTOR]', function(){
        //Do Stuff
    });

}); 
```

此代码以及附加到元素的任何其他 jQuery 代码（使用或不使用 .on() 函数）都应该与上面的 document.ready 一起使用。

这将为现在和将来匹配的任何元素运行事件（在您的情况下，`[EVENT]`将是） （在您的情况下，）`click``[SELECTOR]``#id`

**JSFiddle 示例：http: [//jsfiddle.net/DhWmP/](http://jsfiddle.net/DhWmP/)**

来源： http: [//api.jquery.com/on/](http://api.jquery.com/on/) & 在需要功能的页面上插入元素的经验。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T12:40:46.423

您是否在将元素添加到 DOM 之前附加了 click 事件？在这种情况下，它不会工作。您需要在元素插入到 DOM 之后附加事件，或者添加一个侦听器来拦截 DOM 更改并在 DOM 更新后添加事件（类似于[livequery](http://plugins.jquery.com/project/livequery)插件所做的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T12:42:24.923

您在此处粘贴的代码是否可能在新的 DOM 节点实际可用之前执行？如果是这样，您可以尝试使用 .ready() 方法并在事后附加您的点击。

```
$("#id").ready(function() {
    $("#id").click(function() { alert("test"); }
}); 
```

编辑：我自己对 jQuery 有点陌生，我认为 .ready() 方法不仅仅可以被文档对象使用。如果这不是真的，看起来有一个 jQuery 插件[jQuery.Listen](http://plugins.jquery.com/project/Listen)，它做了类似的事情：

```
// Listen to clicks, even for newly added instances of #id.
jQuery.listen( 'click', '#id', function(){ alert("test"); }); 
```

如果您可以为动态添加的锚点使用类，这样的事情会很好。

```
// Listen to clicks for anything with the class "dynamicAnchors", even newly
// added anchors.
jQuery.listen( 'click', '.dynamicAnchors', function(){ alert("test"); }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T16:23:19.533

## 事件委托

如果您升级到新的 1.3 beta，他们有一个 live() 方法来处理委托事件。如果您无法升级，您可以自己轻松滚动事件委托。在我的回复中解释了[here](https://stackoverflow.com/questions/325200/how-to-bind-a-click-event-on-a-recently-added-a-tag-in-jquery)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-01T15:02:18.667

正如其他人所说，您不能将事件处理程序附加到尚不存在的元素。因此，如果您的代码片段已在文档中准备好，它将无法正常工作。

只需将`$("#id").click(function() { alert("test"); });`jQuery 代码放入添加锚点的代码中即可。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-12-15T00:55:27.727

**使用 .on 属性在给定标签上附加事件处理程序：**

```
$(document).on("click", "#id" function(){
    // Do something...
}); 
```

# c++ - 有人可以解释这个 C++ 符号吗？

> ID：404934
> 
> 赞同：3
> 
> 时间：2009-01-01T13:18:46.910
> 
> 标签：c++, arrays, notation

```
if (vector1.x > ((float*)&vector1)[j]) 
```

*j*只是向量的索引吗？
例如，即使向量不是数组，C++ 是否能够使用数组表示法检索这些值？
如果是这样，我猜它是通过地址引用*向量*来实现的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-01T13:23:47.990

C++ 标准说，将（pods）结构的指针转换为其第一个元素类型的指针将产生指向其第一个元素的指针：

```
struct a {
    float a1;
    float a2;
    float a3;
};

a o1; ((float*)&o1); // points to o1.a1 
```

我怀疑代码告诉编译器不要在 a1、a2 和 a3 之间添加任何填充，这样如果它索引指针，它将精确地指向它想要的浮点数。所以上面

```
((float*)&o1)[1] // *would* return o1.a2 
```

这取决于平台，因为在标准 C++ 中无法更改填充。查找该代码的排列方式，以及我是否完全正确:)

# mysql - 如何将值的“数组”传递给我的存储过程？

> ID：404941
> 
> 赞同：14
> 
> 时间：2009-01-01T13:25:37.770
> 
> 标签：mysql, database, arrays, postgresql, stored-procedures

我希望能够将值的“数组”传递给我的存储过程，而不是连续调用“添加值”过程。

任何人都可以建议一种方法吗？我在这里错过了什么吗？

编辑：我将使用 PostgreSQL / MySQL，我还没有决定。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-08-18T09:15:03.307

正如 Chris 所指出的，在 PostgreSQL 中这没有问题——任何基本类型（如 int、text）都有自己的数组子类型，您还可以创建自定义类型，包括复合类型。例如：

```
CREATE TYPE test as (
    n int4,
    m int4
); 
```

现在您可以轻松创建测试数组：

```
select ARRAY[
    row(1,2)::test,
    row(3,4)::test,
    row(5,6)::test
]; 
```

您可以编写一个函数，将 n*m 乘以数组中的每个项目，并返回产品的总和：

```
CREATE OR REPLACE FUNCTION test_test(IN work_array test[]) RETURNS INT4 as $$
DECLARE
    i      INT4;
    result INT4 := 0;
BEGIN
    FOR i IN SELECT generate_subscripts( work_array, 1 ) LOOP
        result := result + work_array[i].n * work_array[i].m;
    END LOOP;
    RETURN result;
END;
$$ language plpgsql; 
```

并运行它：

```
# SELECT test_test(
    ARRAY[
        row(1, 2)::test,
        row(3,4)::test,
        row(5,6)::test
    ]
);
 test_test
-----------
        44
(1 row) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-01T14:56:20.050

如果您打算使用 MySQL 5.1，则无法传入数组。
查看 MySQL 5.1[常见问题](http://dev.mysql.com/doc/refman/5.1/ja/faqs-stored-procs.html#qandaitem-27-4-17)
如果您打算使用 PostgreSQL，可以查看[这里](http://www.pgadmin.org/docs/1.6/pg/plpgsql.html#plpgsql-args-results)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-01T15:07:25.083

我不知道将实际数组传递给那些引擎（我使用 sqlserver），但这里有一个想法是传递一个分隔字符串并使用这个函数在你的 sproc 中解析它。

```
CREATE FUNCTION [dbo].[Split]
(
    @ItemList NVARCHAR(4000), 
    @delimiter CHAR(1)
)
RETURNS @IDTable TABLE (Item VARCHAR(50))  
AS      

BEGIN    
    DECLARE @tempItemList NVARCHAR(4000)
    SET @tempItemList = @ItemList

    DECLARE @i INT    
    DECLARE @Item NVARCHAR(4000)

    SET @tempItemList = REPLACE (@tempItemList, ' ', '')
    SET @i = CHARINDEX(@delimiter, @tempItemList)

    WHILE (LEN(@tempItemList) > 0)
    BEGIN
        IF @i = 0
            SET @Item = @tempItemList
        ELSE
            SET @Item = LEFT(@tempItemList, @i - 1)
        INSERT INTO @IDTable(Item) VALUES(@Item)
        IF @i = 0
            SET @tempItemList = ''
        ELSE
            SET @tempItemList = RIGHT(@tempItemList, LEN(@tempItemList) - @i)
        SET @i = CHARINDEX(@delimiter, @tempItemList)
    END 
    RETURN
END 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-01T13:39:45.573

您没有指出，但如果您指的是 SQL 服务器，[这是一种方式](http://vyaskn.tripod.com/passing_arrays_to_stored_procedures.htm)。

并且 MS 支持[ref](http://support.microsoft.com/kb/555266)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-18T06:43:31.740

对于 PostgreSQL，您可以执行以下操作：

```
CREATE OR REPLACE FUNCTION fnExplode(in_array anyarray) RETURNS SETOF ANYELEMENT AS
$$
    SELECT ($1)[s] FROM generate_series(1,array_upper($1, 1)) AS s;
$$
LANGUAGE SQL IMMUTABLE; 
```

然后，您可以将分隔字符串传递给您的存储过程。

说，param1 是一个输入参数，包含`'1|2|3|4|5'`

该声明：

```
SELECT CAST(fnExplode(string_to_array(param1, '|')) AS INTEGER); 
```

生成可以连接或插入的结果集。

同样，对于 MySQL，您可以执行以下操作：

```
DELIMITER $$
CREATE PROCEDURE `spTest_Array`
(
    v_id_arr TEXT
)
BEGIN
    DECLARE v_cur_position INT; 
    DECLARE v_remainder TEXT; 
    DECLARE v_cur_string VARCHAR(255); 
    CREATE TEMPORARY TABLE tmp_test
    ( 
        id INT
    ) ENGINE=MEMORY; 

    SET v_remainder = v_id_arr; 
    SET v_cur_position = 1;

    WHILE CHAR_LENGTH(v_remainder) > 0 AND v_cur_position > 0 DO 
        SET v_cur_position = INSTR(v_remainder, '|'); 
        IF v_cur_position = 0 THEN 
            SET v_cur_string = v_remainder; 
        ELSE 
            SET v_cur_string = LEFT(v_remainder, v_cur_position - 1); 
        END IF; 

        IF TRIM(v_cur_string) != '' THEN 
            INSERT INTO tmp_test
                (id)
            VALUES 
                (v_cur_string);                 
        END IF; 

        SET v_remainder = SUBSTRING(v_remainder, v_cur_position + 1); 
    END WHILE; 

    SELECT 
        id
    FROM 
    tmp_test;

    DROP TEMPORARY TABLE tmp_test;
END 
$$ 
```

然后简单的 CALL`spTest_Array('1|2|3|4|5')`应该产生与上述 PostgreSQL 查询相同的结果集。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-15T09:02:59.400

由于 MySQL 中的 JSON 支持，您现在实际上可以将数组传递给您的 MySQL 存储过程。创建一个 JSON_ARRAY 并将其作为 JSON 参数传递给您的存储过程。然后在过程中，使用 MySQL 的 WHILE 循环和 MySQL 的 JSON "pathing" ，访问 JSON_ARRAY 中的每个元素并按照您的意愿进行操作。这里的一个例子[https://gist.githubusercontent.com/jonathanvx/513066eea8cb5919b648b2453db47890/raw/22f33fdf64a2f292688edbc67392ba2ccf8da47c/json.sql](https://gist.githubusercontent.com/jonathanvx/513066eea8cb5919b648b2453db47890/raw/22f33fdf64a2f292688edbc67392ba2ccf8da47c/json.sql)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-27T21:56:22.883

顺便说一句，这是将数组添加到函数（存储过程）调用的方法：

```
CallableStatement proc = null;
List<Integer> faultcd_array = Arrays.asList(1003, 1234, 5678);
//conn - your connection manager
conn = DriverManager.getConnection(connection string here);
proc = conn.prepareCall("{ ? = call procedureName(?) }");
proc.registerOutParameter(1, Types.OTHER);
//This sets-up the array
Integer[] dataFaults = faultcd_array.toArray(new Integer[faultcd_array.size()]);
java.sql.Array sqlFaultsArray = conn.createArrayOf("int4", dataFaults);
proc.setArray(2, sqlFaultsArray);
//:
//add code to retrieve cursor, use the data.
//: 
```

# c - 下载网页

> ID：404946
> 
> 赞同：2
> 
> 时间：2009-01-01T13:31:16.743
> 
> 标签：c, winapi, download, webpage

我如何使用 C（不使用 libcurl）下载网页，操作系统：Win32

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T13:41:21.887

要下载网页，您需要两件事：

1.  与网络服务器建立沟通渠道
2.  管理 Web 服务器协议以下载页面。

对于第一项，请查看套接字 API。您需要打开一个套接字，使用 send() 发送一些数据，从网络服务器接收数据。

对于第二项，你需要了解http协议。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T13:53:50.630

试试[wininet](http://msdn.microsoft.com/en-us/library/aa385473(VS.85).aspx) API

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T14:08:03.627

您需要做的就是所谓的“套接字通信”。要获得出色的概述，请查看

[http://web.archive.org/web/20090227031327/http://www.cs.utah.edu/dept/old/texinfo/glibc-manual-0.02/library_15.html](http://web.archive.org/web/20090227031327/http://www.cs.utah.edu/dept/old/texinfo/glibc-manual-0.02/library_15.html)

[http://web.archive.org/web/20090402133256/http://www.uwo.ca/its/doc/courses/notes/socket/](http://web.archive.org/web/20090402133256/http://www.uwo.ca/its/doc/courses/notes/socket/)

[http://wiki.linuxquestions.org/wiki/Connecting_a_socket_in_C](http://wiki.linuxquestions.org/wiki/Connecting_a_socket_in_C)

最后一个链接来自 linuxquestions，但这两种解决方案都是完全跨平台的，这与 frankodwyer 对 wininet 的建议相反。最后一个链接也完全符合您的要求，因为它下载了一个网页。

# eclipse - Practical way to commit changes in source control to multiple branches

> ID：404948
> 
> 赞同：7
> 
> 时间：2009-01-01T13:35:36.297
> 
> 标签：eclipse, version-control, cvs, branch

A common scenario when using source control is to have a development branch along with versioned release branches. We use CVS, with HEAD as the development branch, and a branch named e.g. release-6-2 for the current release of a product.

Development of new features go into the development branch only, but bug fixes sometimes have to be checked into both the development branch and the current release branch. This can get quite tedious at times, so I am looking for practical ways to accomplish this.

When a file to be commited is in synch on the two branches, I am in particular looking for a quick "commit to these branches" solution.

(We use CVS as our source control system, so any CVS-specific answers are nice. However, it is also interesting to see whether other source control systems can offer a better way. On the client side we use Eclipse, so Eclipse solutions are good. But if you have a non-Eclipse solution, that is fine too.)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-01T13:52:09.977

Apply your fix to the oldest release branch required. Then merge the change to the next release branch and so on until you merge from the last release branch to the HEAD.

Say the oldest version of your product is 1.0 and you also have 1.1 and 1.5 releases. New features for the next release are being added to the HEAD. If a bug is found in 1.0, you apply the fix to the 1.0 branch. Merge from 1.0 to the 1.1 branch. Merge from 1.1 to the 1.5 branch, and finally merge from the 1.5 branch to the HEAD.

Merging from branch to branch is better than applying the fix manually to each branch.

With CVS you have to mannually keep track of what versions are merged, so that you do not include the same revisions when you do your next merge.

If you change to use Subversion, merging from branch to branch is easier. Eclipse's subversion tool will keep track of what revisions you have previously merged, greatly simplifying the task of doing repeated merges between two branches.

Changing to Subversion from CVS is easy(ish). You won't be the first to have made such a move.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-01T14:26:20.517

Like awalshe said, it's better to merge between branches. To cherry-pick a merge, the method described in [Pragmatic Version Control using CVS](http://www.pragprog.com/titles/vcc/pragmatic-version-control-using-cvs) is very good:

In the branch - tag (`PRE_FOO`) before the change, make the changes and commit, tag after the change (`POST_FOO`). Then, in trunk, merge using the tags:

```
cvs up -j PRE_FOO -j POST_FOO 
```

Merging between branches is much easier and safer in SVN, and it's trivial to convert your entire CVS history to SVN - see [cvs2svn](http://cvs2svn.tigris.org/). You should use either SVN 1.5, or - with earlier SVN versions - [svnmerge](http://www.orcaware.com/svn/wiki/Svnmerge.py).

# cocoa-touch - CALayer的动画结束回调？

> ID：404957
> 
> 赞同：5
> 
> 时间：2009-01-01T13:41:43.697
> 
> 标签：cocoa-touch, core-animation

使用 iPhone CALayer，我想要一个我的精神层的旋转动画，但我也想要一个动画结束的回调，这样做很热吗？

我想也许我应该使用 CABasicAnimation，但我不知道如何使用 CABasicAnimation 进行旋转，知道吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-01T20:01:18.563

如果为 CAAnimation 设置委托，则可以添加回调方法：

```
- (void)animationDidStop:(CAAnimation *)theAnimation finished:(BOOL)flag 
```

动画完成时会调用它。根据此链接，通过 CGAffineTransform 变换矩阵查找旋转动画的示例：

[http://iphonedevelopment.blogspot.com/2008/10/demystifying-cgaffinetransform.html](http://iphonedevelopment.blogspot.com/2008/10/demystifying-cgaffinetransform.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-02T15:30:43.667

顺便说一句，您还可以通过在以下代码块中包装您对旋转 UIView 的调用来对 UIView 动画执行相同类型的回调

```
[UIView beginAnimations:nil context:NULL];
[UIView setAnimationDuration:0.5f];
[UIView setAnimationDelegate:self];
[UIView setAnimationDidStopSelector:@selector(rotationAnimationHasFinished:finished:context:)];
// Rotate the view here
[UIView commitAnimations]; 
```

然后定义一个委托方法

```
- (void)rotationAnimationHasFinished:(NSString *)animationID finished:(BOOL)finished context:(void *)context;
{
// Handle the completion of the animation
} 
```

在您的委托中，它将在动画完成后执行您需要的任何操作。

# windows - 如何从 ruby 将原始打印机代码写入 Windows 打印机共享？

> ID：404975
> 
> 赞同：1
> 
> 时间：2009-01-01T14:05:44.117
> 
> 标签：windows, ruby, printing, share

使用java，减去异常处理，就这么简单

```
FileOutputStream ostream = new FileOutputStream("\\\\host\\share");
PrintStream printStream = new PrintStream(ostream);
printStream.print("HELLO PRINTER");
printStream.close();
ostream.close(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-02T03:58:29.147

```
File.open("\\\\host\\share") do |f|
  f.print("HELLO PRINTER#{12.chr}")
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T18:38:59.523

虽然我从未尝试从 Ruby 进行打印，而且我没有可用于测试的 Windows 机器，但在我看来，您不想使用`File`该类，而是使用`IO`该类。您可以在此处查看其文档：[http](http://ruby-doc.org/core/classes/IO.html) ://ruby-doc.org/core/classes/IO.html 。看起来它实际上具有 Windows 特定的选项，所以请看一下，如果它不是很有帮助，请告诉我原因。

# asp.net - 如何在一个站点上对用户进行身份验证并将凭据传递给另一个站点？（Windows 身份验证，ASP.Net）

> ID：404978
> 
> 赞同：5
> 
> 时间：2009-01-01T14:08:17.637
> 
> 标签：asp.net, windows-authentication

我们有多个运行 Windows 身份验证的 Web 应用程序。
用户使用与他们在本地计算机上使用的 DomainOther\UsernameOther 不同的 Domain\Username 登录网站。
考虑到我们有 2 个站点 One.xyz.com 和 Two.xyz.com 都运行 Windows 身份验证（并且用户使用域\用户名登录到两者），是否可以让用户从 One.xyz.com 上的页面重定向到在 One.xyz.com 上输入凭据后，无需再次输入凭据即可访问 Two.xyz.com 的主页？
是否可以使用 ASP.Net 做到这一点？

亲切的问候，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-01T15:23:39.497

您正在寻找的是所谓的单点登录，并且有各种各样的商业产品能够满足您的需求。他们中的许多人通过 HTTPS 通过服务器变量传递凭据，这样用户就不会在 URL 中看到凭据。我曾与希望“推出自己的”并且采用其他方法（引用第三台服务器的会话密钥、加密和时间敏感的 URL 字符串等）的公司合作过。

要开始使用，您需要阅读关于单点登录的[Wikipedia 条目（它也与 SAML 链接）。](http://en.wikipedia.org/wiki/Single_sign-on)您可能还想访问一些更受欢迎的商业供应商的网站，例如[Passlogix](http://www.passlogix.com/index.php/products/v-GO_singlesignon)和[Imprivata](http://www.imprivata.com/)（虽然有几十个，所以不要认为这个列表很详尽，甚至特别推荐 - 只是很受欢迎）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T14:21:07.360

SharePoint 支持[SPNEGO](http://en.wikipedia.org/wiki/SPNEGO)身份验证，这是一种单点登录形式。MSDN 有使用 SPNEGO 在 .net 上进行单点登录的文档。查看 Microsoft 安全 SSPI。我通过快速搜索找到[了这个样本。](http://msdn.microsoft.com/en-us/library/ms973911.aspx)

SPNEGO 是[Kerberos](http://en.wikipedia.org/wiki/Kerberos_(protocol))的 Microsoft 变体，它还将与 IBM 产品和 Oracle WebLogic 互操作。

如果您想使用比 Kerberos 具有更广泛互操作性的国际标准进行单点签名，您应该使用[SAML](http://en.wikipedia.org/wiki/SAML)。有关SAML 的 Microsoft 讨论，请参阅[Active Directory 联合。](http://msdn.microsoft.com/en-us/magazine/cc163520.aspx)但是，SAML 的实现和配置要复杂得多。

# .net - 如何为 .NET 应用程序追溯创建单元测试？

> ID：404988
> 
> 赞同：2
> 
> 时间：2009-01-01T14:19:39.500
> 
> 标签：.net, asp.net, unit-testing

我是单元测试的新手，但开始认为我需要它。我有一个 ASP.NET Web 表单应用程序，它正在向不可预见的方向扩展，这意味着某些代码位正在适应多种用途。我需要尝试并确保在更改这些单元时不会破坏它们最初的预期用途。那么，我如何最好地将单元测试追溯应用到现有代码中呢？实用建议表示赞赏。谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T15:06:56.800

非常缓慢地！

我目前正在我的项目上做同样的事情，这是一个很大的努力。为了对现有类进行单元测试，它们通常需要完全重新设计……并且由于高度耦合，更改单个类可能会导致需要在几十个其他类中进行更改。

最终的结果是良好的干净代码，可以工作，可以扩展，可以验证....但这确实需要大量的时间和精力。

我给自己买了几本关于单元测试的书，它们可以帮助我完成整个过程。

您可能需要考虑让自己获得[xUnit 测试模式](https://rads.stackoverflow.com/amzn/click/com/0131495054)并[有效地使用遗留代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-01T15:23:07.750

在为它所在的方法编写测试之前，不要更改一行代码。我看到人们犯的最大错误是他们在为它编写测试之前重新设计了类以使其更具可测试性。这是适得其反的，因为你*会*破坏一些东西。

正确的做法是在更改之前为类（或方法，粒度级别取决于您）编写一套完整的测试。这些测试是您的安全网，可让您自信地做出改变。如果你发现你不能为一个类编写测试，可能是因为它与另一个类的耦合度太高，那么你的第一组测试应该是对两个类一起进行测试，那么下一步应该是解耦这些类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-01T14:35:52.370

单元测试的一个不言而喻的好处是它将类设计推向低耦合的方式。如果您尝试在最后添加 UnitTesting，您应该为以下任一情况做好准备：

*   由于耦合而无法测试单元的情况
*   重新设计类以消除耦合，如果没有现有的单元测试，这当然不是很安全。

特别是，需要注意的几件事是：

*   更新其他类的类（这里通常是高耦合的）。
*   依赖于单元测试时不存在的基础设施的类，例如 HttpRequest 和数据库

编辑

维基百科解释了[单元测试](http://en.wikipedia.org/wiki/Unit_testing)：

> 单元测试的目标是隔离程序的每个部分并显示各个部分是正确的。单元测试提供了一段代码必须满足的严格的书面契约。

这是关于测试一种方法。这与测试方法和数据库无关。您可以进行测试方法和数据库的自动化测试，但这些不是单元测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-21T08:58:13.757

我面临同样的问题。

我们决定做的事情一次只需要一个特定的功能。编写测试并解耦现有代码。新代码将替换现有的耦合代码。所以基本上我们正在做的就是一点一点地重写应用程序。

确保将单个重写尽可能小，以减少对现有代码的影响。

确保您了解您的代码是什么以及应该做什么，这指向需求。归根结底，尤其是当您沿着 TDD 路线前进时。您的单元测试是您的要求。因此，如果您不知道原始要求，您将不会为您的代码编写正确的测试。

正如每个人都建议的那样，首先编写测试然后编写代码（TDD）。一旦所有测试都通过了，然后用经过全面测试的代码替换应用程序中的旧耦合代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T15:07:34.387

从字面上看，我想建议您**一次添加一个单元测试**并以相同的速度修复它们。

# c# - 将字符串写入文件会导致 C# 中的异常

> ID：404989
> 
> 赞同：1
> 
> 时间：2009-01-01T14:20:55.147
> 
> 标签：c#, string

我收到一个我不明白的“FormatException：输入字符串格式不正确”错误。

我正在使用以下几行将字符串写入文本文件：

```
using (StreamWriter sw = new StreamWriter(myfilename, false, System.Text.Encoding.GetEncoding(enc)))
{
    sw.Write(mystring, Environment.NewLine);
} 
```

（编码部分是因为我的应用程序中有一个选项可以将其设置为 utf-8 或 iso-8859-1 ......但我认为这无关紧要）。

我所有的字符串都写得很好，除了这个字符串与其他字符串不同，因为它实际上有一段 javascript 代码。我确信那里的特殊字符之一可能会导致问题，但我怎么知道？

我尝试的一件事是在上面的 sw.Write 语句之前插入以下行：

```
System.Console.WriteLine(mystring); 
```

它写到控制台就好了 - 没有错误。

帮助？

谢谢！（新年快乐！）

-阿迪娜

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-01T14:26:02.170

您正在使用的重载将格式作为第一个参数，然后将对象注入。

您可以执行以下任一操作：

```
sw.Write(mystring + Environment.NewLine); 
```

或者

```
sw.Write("{0}{1}", mystring, Environment.NewLine); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T13:54:03.207

为了回应 DK 的评论，我测试了扩展字符串连接的速度较慢。我用三个选项进行了这个设置；

*   连接字符串
*   打`sw.Write`了两次电话
*   打电话`sw.WriteLine`

在我的机器上，第二个选项比平均速度快 88%。在 10000000 次迭代中，他们使用 3517、2420 和 3385 毫秒。

只有当这是在您的程序中多次调用的代码时，它才应该是重要的。

```
using System;
using System.IO;
using System.Text;

class Program
    {
        static void Main(string[] args)
        {
            const string myString = "kdhlkhldhcøehdhkjehdkhekdhk";
            int iterations=getIntFromParams(args, 0, 10);
            int method = getIntFromParams(args, 1, 0);
            var fileName=Path.GetTempFileName();
            using (StreamWriter sw = new StreamWriter(fileName, false, Encoding.Default))
            {
                switch (method)
                {
                    case 0:

                        Console.WriteLine("Starting method with concatenation. Iterations: " + iterations);
                        var start0 = DateTimeOffset.Now;
                        for (int i = 0; i < iterations; i++)
                        {
                            sw.Write(myString + Environment.NewLine);
                        }
                        var time0 = DateTimeOffset.Now - start0;
                        Console.WriteLine("End at " + time0.TotalMilliseconds + " ms.");

                        break;
                    case 1:
                        Console.WriteLine("Starting method without concatenation. Iterations: " + iterations);
                        var start1 = DateTimeOffset.Now;
                        for (int i = 0; i < iterations; i++)
                        {
                            sw.Write(myString);
                            sw.Write(Environment.NewLine);
                        }
                        var time1 = DateTimeOffset.Now - start1;
                        Console.WriteLine("End at " + time1.TotalMilliseconds + " ms.");
                        break;
                    case 2:
                        Console.WriteLine("Starting method without concatenation, using WriteLine. Iterations: " + iterations);
                        var start2 = DateTimeOffset.Now;
                        for (int i = 0; i < iterations; i++)
                        {
                            sw.WriteLine(myString);
                        }
                        var time2 = DateTimeOffset.Now - start2;
                        Console.WriteLine("End at " + time2.TotalMilliseconds + " ms.");
                        break;
                }
            }
        }

        private static int getIntFromParams(string[] args, int index, int @default)
        {
            int value;
            try
            {
                if (!int.TryParse(args[index], out value))
                {
                    value = @default;
                }
            }
            catch(IndexOutOfRangeException)
            {
                value = @default;
            }
            return value;
        }
  } 
```

# c++ - 如何检查麦克风和扬声器是否来自同一声卡？

> ID：404995
> 
> 赞同：6
> 
> 时间：2009-01-01T14:26:08.020
> 
> 标签：c++, windows, audio, multimedia

我的问题是如何检查麦克风和扬声器是否来自 Windows 平台上的同一个声卡。如果它们来自不同的卡，那么处理时间的逻辑就会不同。我同时使用 DSound 和 WMME API。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T12:40:52.917

WMI 确实提供了一些有关声卡的信息。我还没有发现的是它的付出是否足够。以下脚本使用“ [WMI Code Creator](http://www.microsoft.com/downloads/details.aspx?familyid=2cc30a64-ea15-4661-8da4-55bbc145c30e&displaylang=en) ”列出了[Win32_SoundDevice](http://msdn.microsoft.com/en-us/library/aa394463.aspx)对象存储的所有内容：

```
strComputer = "." 
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\CIMV2") 
Set colItems = objWMIService.ExecQuery( _
    "SELECT * FROM Win32_SoundDevice",,48) 
For Each objItem in colItems 
    Wscript.Echo "-----------------------------------"
    Wscript.Echo "Win32_SoundDevice instance"
    Wscript.Echo "-----------------------------------"
    Wscript.Echo "Availability: " & objItem.Availability
    Wscript.Echo "Caption: " & objItem.Caption
    Wscript.Echo "ConfigManagerErrorCode: " & objItem.ConfigManagerErrorCode
    Wscript.Echo "ConfigManagerUserConfig: " & objItem.ConfigManagerUserConfig
    Wscript.Echo "CreationClassName: " & objItem.CreationClassName
    Wscript.Echo "Description: " & objItem.Description
    Wscript.Echo "DeviceID: " & objItem.DeviceID
    Wscript.Echo "DMABufferSize: " & objItem.DMABufferSize
    Wscript.Echo "ErrorCleared: " & objItem.ErrorCleared
    Wscript.Echo "ErrorDescription: " & objItem.ErrorDescription
    Wscript.Echo "InstallDate: " & objItem.InstallDate
    Wscript.Echo "LastErrorCode: " & objItem.LastErrorCode
    Wscript.Echo "Manufacturer: " & objItem.Manufacturer
    Wscript.Echo "MPU401Address: " & objItem.MPU401Address
    Wscript.Echo "Name: " & objItem.Name
    Wscript.Echo "PNPDeviceID: " & objItem.PNPDeviceID
    If isNull(objItem.PowerManagementCapabilities) Then
    Wscript.Echo "PowerManagementCapabilities: "
    Else
    Wscript.Echo "PowerManagementCapabilities: " & Join(objItem.PowerManagementCapabilities, ",")
    End If
    Wscript.Echo "PowerManagementSupported: " & objItem.PowerManagementSupported
    Wscript.Echo "ProductName: " & objItem.ProductName
    Wscript.Echo "Status: " & objItem.Status
    Wscript.Echo "StatusInfo: " & objItem.StatusInfo
    Wscript.Echo "SystemCreationClassName: " & objItem.SystemCreationClassName
    Wscript.Echo "SystemName: " & objItem.SystemName
Next 
```

在我的笔记本电脑上运行它会给

```
-----------------------------------
Win32_SoundDevice instance
-----------------------------------
Availability: 
Caption: ATI Function Driver for High Definition Audio - ATI AA01
ConfigManagerErrorCode: 0
ConfigManagerUserConfig: False
CreationClassName: Win32_SoundDevice
Description: ATI Function Driver for High Definition Audio - ATI AA01
DeviceID: HDAUDIO\FUNC_01&VEN_1002&DEV_AA01&SUBSYS_00AA0100&REV_1000\5&BB7E0F3&0&0001
DMABufferSize: 
ErrorCleared: 
ErrorDescription: 
InstallDate: 
LastErrorCode: 
Manufacturer: ATI
MPU401Address: 
Name: ATI Function Driver for High Definition Audio - ATI AA01
PNPDeviceID: HDAUDIO\FUNC_01&VEN_1002&DEV_AA01&SUBSYS_00AA0100&REV_1000\5&BB7E0F3&0&0001
PowerManagementCapabilities: 
PowerManagementSupported: False
ProductName: ATI Function Driver for High Definition Audio - ATI AA01
Status: OK
StatusInfo: 3
SystemCreationClassName: Win32_ComputerSystem
SystemName: BABEL
-----------------------------------
Win32_SoundDevice instance
-----------------------------------
Availability: 
Caption: Conexant High Definition SmartAudio 221
ConfigManagerErrorCode: 0
ConfigManagerUserConfig: False
CreationClassName: Win32_SoundDevice
Description: Conexant High Definition SmartAudio 221
DeviceID: HDAUDIO\FUNC_01&VEN_14F1&DEV_5051&SUBSYS_1179FF5B&REV_1000\4&2DBDAC14&0&0001
DMABufferSize: 
ErrorCleared: 
ErrorDescription: 
InstallDate: 
LastErrorCode: 
Manufacturer: Conexant
MPU401Address: 
Name: Conexant High Definition SmartAudio 221
PNPDeviceID: HDAUDIO\FUNC_01&VEN_14F1&DEV_5051&SUBSYS_1179FF5B&REV_1000\4&2DBDAC14&0&0001
PowerManagementCapabilities: 
PowerManagementSupported: False
ProductName: Conexant High Definition SmartAudio 221
Status: OK
StatusInfo: 3
SystemCreationClassName: Win32_ComputerSystem
SystemName: BABEL 
```

不知道里面有没有什么有用的。这是一个棘手的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T16:44:18.477

假设您有输入和输出设备的 ID，您可以使用类似以下的内容来获取相应的混音器 ID。如果两者相同，则它们都连接到同一个混音器，并且很可能属于同一个物理硬件。

```
 /// <summary>
    /// Get the ID of the mixer associated with the given input device ID
    /// Returns -1 if no such mixer can be found
    /// </summary>
    static public int GetMixerIdInput(int inputId)
    {
        int mixerId = -1;
        int result = MmeMixerApi.mixerGetID(inputId, ref mixerId, MIXER_OBJECTFLAG.WAVEIN);
        if (((MMError)result != MMError.MMSYSERR_NOERROR) &&
            ((MMError)result != MMError.MMSYSERR_NODRIVER))
        {
            throw new MmeException((MMError)result);
        }
        return mixerId;
    }

    /// <summary>
    /// Get the ID of the mixer associated with the given output device ID
    /// Returns -1 if no such mixer can be found
    /// </summary>
    static public int GetMixerIdOutput(int outputId)
    {
        int mixerId = -1;
        int result = MmeMixerApi.mixerGetID(outputId, ref mixerId, MIXER_OBJECTFLAG.WAVEOUT);
        if (((MMError)result != MMError.MMSYSERR_NOERROR) &&
            ((MMError)result != MMError.MMSYSERR_NODRIVER))
        {
            throw new MmeException((MMError)result);
        }
        return mixerId;
    } 
```

如果您只有输入设备的名称，则可以使用类似以下内容来查找设备 ID：

```
 /// <summary>
    /// Find the ID of the input device given a name
    /// </summary>
    static public int GetWaveInputId(string name)
    {
        int id = MmeWaveApi.WAVE_MAPPER;
        int devCount = MmeWaveApi.waveInGetNumDevs();
        WAVEINCAPS caps = new WAVEINCAPS();
        for (int dev = 0; (dev < devCount) && (id == MmeWaveApi.WAVE_MAPPER); dev++)
        {
            int result = MmeWaveApi.waveInGetDevCaps(dev, ref caps, Marshal.SizeOf(caps));
            if ((MMError)result == MMError.MMSYSERR_NOERROR)
            {
                if (string.Compare(name, 0, caps.szPname, 0, Math.Min(name.Length, caps.szPname.Length)) == 0)
                {
                    id = dev;
                }
            }
        }
        return id;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T14:34:09.973

永远不要使用 WMI（这里什么都不做） 使用 MM apis。

# text - Komodo 编辑：通过键绑定与工具栏运行宏

> ID：404997
> 
> 赞同：0
> 
> 时间：2009-01-01T14:27:36.740
> 
> 标签：text, scripting, editor, macros, komodo

**问题：**有没有人足够熟悉 Komodo Edit 来了解这个宏？当通过工具面板调用宏时，我需要弄清楚如何在宏中进行缓冲区文本选择。

**问题：**我在 Komodo Edit javascript 中有一个非常简单的宏，它可以按预期工作，但仅在通过自定义键绑定调用时。如果用户试图从标准的“工具面板”调用它，那么 selectWordLeft 调用什么也不做。我的猜测是失败是由于编辑缓冲区没有焦点引起的，但人们会认为告诉宏明确将焦点放在缓冲区上会起作用。

```
komodo.view.setFocus();
komodo.doCommand('cmd_selectWordLeft'); /// this NO_WORKY 
```

**背景：** *Komodo Edit，版本 5.0.2，build 2604，平台 win32-x86。建于 2008 年 11 月 19 日星期三 18:33:41。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T14:32:37.853

**回答：**又搜索了一下，在一个KE论坛上看到了这个对另一个问题的回答；这似乎解决了这个问题。

如果其他人有相同或类似的问题，请不要删除问题，而是提供答案。

```
There are currently some issues with komodo.docommand and some commands. 
To work around this, change this line:

komodo.doCommand("cmd_selectWordLeft");

to this instead:

komodo.editor.wordLeftExtend(); 
```******************************