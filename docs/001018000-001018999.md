# StackOverflow 问答 1018000-1018999

# c# - 是否有一种 .NET 方法来枚举所有可用的网络打印机？

> ID：1018001
> 
> 赞同：13
> 
> 时间：2009-06-19T13:38:09.980
> 
> 标签：c#, .net, network-printers

有没有一种简单的方法来枚举 .NET 中所有可见的网络打印机？目前，我正在展示 PrintDialog 以允许用户选择打印机。问题是，本地打印机也会显示（以及 XPS Document Writer 等）。如果我可以自己枚举网络打印机，我可以只显示那些打印机的自定义对话框。

谢谢！！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-08-31T09:13:53.497

*   获取默认打印机`LocalPrintServer.DefaultPrintQueue`
*   获取已安装的打印机（从用户的角度）`PrinterSettings.InstalledPrinters`
*   通过列表枚举：
*   任何以开头`\\`的打印机都是网络打印机-因此请使用`new PrintServer("\\UNCPATH").GetPrintQueue("QueueName")`
*   任何不以开头`\\`的打印机都是本地打印机，因此请使用`LocalPrintServer.GetQueue("Name")`
*   `FullName`您可以通过比较属性来查看哪个是默认值。

注意：网络打印机可以是默认打印机`LocalPrintServer.DefaultPrintQueue`，但不会出现在`LocalPrintServer.GetPrintQueues()`

```
 // get available printers
    LocalPrintServer printServer = new LocalPrintServer();
    PrintQueue defaultPrintQueue = printServer.DefaultPrintQueue;

    // get all printers installed (from the users perspective)he t
    var printerNames = PrinterSettings.InstalledPrinters;
    var availablePrinters = printerNames.Cast<string>().Select(printerName => 
    {
        var match = Regex.Match(printerName, @"(?<machine>\\\\.*?)\\(?<queue>.*)");
        PrintQueue queue;
        if (match.Success)
        {
            queue = new PrintServer(match.Groups["machine"].Value).GetPrintQueue(match.Groups["queue"].Value);
        }
        else
        {
            queue = printServer.GetPrintQueue(printerName);
        }

        var capabilities = queue.GetPrintCapabilities();
        return new AvailablePrinterInfo()
        {
            Name = printerName,
            Default = queue.FullName == defaultPrintQueue.FullName,
            Duplex = capabilities.DuplexingCapability.Contains(Duplexing.TwoSidedLongEdge),
            Color = capabilities.OutputColorCapability.Contains(OutputColor.Color)
        };
    }).ToArray();

    DefaultPrinter = AvailablePrinters.SingleOrDefault(x => x.Default); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-08-19T05:34:03.450

使用新的 System.Printing API

```
using (var printServer = new PrintServer(string.Format(@"\\{0}", PrinterServerName)))
{
    foreach (var queue in printServer.GetPrintQueues())
    {
        if (!queue.IsShared)
        {
            continue;
        }
        Debug.WriteLine(queue.Name);
     }
 } 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-19T13:49:10.643

[在这里](http://www.dotnetcurry.com/ShowArticle.aspx?ID=148&AspxAutoDetectCookieSupport=1)找到了这段代码

```
 private void btnGetPrinters_Click(object sender, EventArgs e)
        {
// Use the ObjectQuery to get the list of configured printers
            System.Management.ObjectQuery oquery =
                new System.Management.ObjectQuery("SELECT * FROM Win32_Printer");

            System.Management.ManagementObjectSearcher mosearcher =
                new System.Management.ManagementObjectSearcher(oquery);

            System.Management.ManagementObjectCollection moc = mosearcher.Get();

            foreach (ManagementObject mo in moc)
            {
                System.Management.PropertyDataCollection pdc = mo.Properties;
                foreach (System.Management.PropertyData pd in pdc)
                {
                    if ((bool)mo["Network"])
                    {
                        cmbPrinters.Items.Add(mo[pd.Name]);
                    }
                }
            }

        } 
```

更新：

“这个API函数可以枚举所有网络资源，包括服务器、工作站、打印机、共享、远程目录等。”

[http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=741&lngWId=10](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=741&lngWId=10)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T13:44:59.280

`PrinterSettiings.InstalledPrinters`应该给你你想要的收藏

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-11-13T00:34:50.357

在与此相关的另一篇文章 ( [https://stackoverflow.com/a/30758129/6513653](https://stackoverflow.com/a/30758129/6513653) ) 中，Scott Chamberlain 说：“我不相信 .NET 中有任何东西可以做到这一点，您需要进行本地调用”。在尝试了所有可能的 .NET 资源之后，我认为他是对的。所以，我开始研究 ADD PRINTER 对话框是如何进行搜索的。使用 Wireshark，我发现 ADD PRINTER 向本地网络中的所有主机发送至少两种类型的包：两个 http/xml 请求到 3911 端口和三个 SNMP 请求。[![在此处输入图像描述](../Images/ad4edd88dcefaa5df0136993db81b1da.png)](https://i.stack.imgur.com/0WZYi.jpg) 第一个 SNMP 请求是 get-next 1.3.6.1.2.1.43，即 Printer-MIB。第二个，是获取 1.3.6.1.4.1.2699.1.2.1.2.1.1.3，它是 PRINTER-PORT-MONITOR-MIB 的 pmPrinterIEEE1284DeviceId。这是最有趣的，因为这是 ADD PRINTER 获取打印机名称的地方。第三个是get 1.3.6.1.2.1.1.1.0，就是SNMP MIB-2 System的sysDescr。我确实相信第二个 SNMP 请求足以找到本地网络中的大多数网络打印机，所以我做了这个代码。它适用于 Windows 窗体应用程序，它依赖于 SnmpSharpNet。

编辑：我使用 ARP Ping 而不是普通 Ping 来搜索网络中的活动主机。示例项目的链接：[ListNetworks C# 项目](https://github.com/vinifr/-ListNetworks)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-27T18:50:47.463

请注意，如果您正在使用 RDP，它似乎会使这变得复杂，因为它看起来只是将主机上的所有内容都导出为本地打印机。

如果您希望它在不在 RDP 上时以相同的方式工作，那么这就是一个问题。

# c++ - 制作可变大小结构的方法

> ID：1018005
> 
> 赞同：0
> 
> 时间：2009-06-19T13:39:39.320
> 
> 标签：c++, data-structures, packets

我需要制作一个包含标头、尾标和可变长度有效负载字段的数据包。到目前为止，我一直在使用向量作为有效载荷，所以我的结构是这样设置的：

```
struct a_struct{
 hdr a_hdr;
 vector<unsigned int> a_vector;
 tr a_tr;
}; 
```

当我尝试访问向量的成员时，我得到一个段错误，整个结构的 sizeof 给了我 32（在我向向量添加了大约 100 个元素之后。

这是一个好方法吗？什么是更好的？

我发现这篇文章 [Variable Sized Struct C++](https://stackoverflow.com/questions/688471/variable-sized-struct-c) 他使用的是 char 数组，而我使用的是向量。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-19T13:42:16.290

即使向量类型在结构中内联，向量中的唯一成员也可能是指针。向向量添加成员不会增加向量类型本身的大小，而是增加它指向的内存。这就是为什么您永远不会看到内存中结构的大小增加，因此您会遇到段错误。

通常当人们想要创建一个可变大小的结构时，他们通过添加一个数组作为结构的最后一个成员并将其长度设置为 1 来实现。然后他们将为 sizeof() 中实际需要的结构分配额外的内存为了“扩展”结构。这几乎总是伴随着结构中的一个额外成员，详细说明扩展数组的大小。

使用 1 的原因在 Raymond 的博客中有详细记录

*   [http://blogs.msdn.com/oldnewthing/archive/2004/08/26/220873.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/08/26/220873.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T13:50:21.483

另一个 SO 答案中的解决方案是 c 特定的，并且依赖于 c 数组的特性 - 即使在 c 中， sizeof() 也不会帮助您找到可变大小结构的“真实”大小。本质上，它是作弊，这是一种在 C++ 中没有必要的作弊。

你在做什么很好。为避免段错误，请像访问 C++ 中的任何其他向量一样访问该向量：

```
a_struct a;
for(int i = 0; i < 100; ++i) a.a_vector.push_back(i);
cout << a.a_vector[22] << endl; // Prints 22 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T17:46:36.427

我在 boost 中看到了这个实现..它看起来真的很整洁......有一个可变长度的有效载荷......

> ```
> class msg_hdr_t 
> {
>    public:
>    std::size_t             len;     // Message length
>    unsigned int            priority;// Message priority
>    //!Returns the data buffer associated with this this message
>    void * data(){ return this+1; }  //
> }; 
> ```

这可能与问题完全无关，但我想分享信息

# visual-studio - Visual Studio：如何让 Cassini 在 ::1 上监听？

> ID：1018006
> 
> 赞同：5
> 
> 时间：2009-06-19T13:39:46.997
> 
> 标签：visual-studio, web, cassini, ipv6

Visual Studio 的内部开发 Web 服务器仅侦听来自本地计算机的连接。

不幸的是，网络服务器只绑定到**IPv4**环回地址：

```
127.0.0.1 
```

在启用了 IPv6 的机器上（即 Windows Vista、Window 7），它不会绑定到**IPv6**环回地址：

```
::1 
```

当您在 Visual Studio 中推送播放，或从通知区域图标打开网站时，浏览器会启动并尝试连接到“ **localhost** ”：

```
http://localhost:53289/WebSite/ 
```

localhost 不是真实地址，而是别名。在 Vista 及更高版本上，它被定义为：

```
C:\Windows\System32\drivers\etc\hosts

::1        localhost 
```

因此，您无法通过尝试连接到**localhost**来浏览在本地主机上运行的网站，您必须将其更改为 127.0.0.1

* * *

我怎样才能让 Visual Studio 的内部网络服务器也监听

```
::1 
```

此外

```
127.0.0.1 
```

?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T13:45:40.603

据我所知，您不能将 IPv6 与 Visual Studio 的开发服务器一起使用。但是，您可以使用 IIS 进行设置。

您可以在此处找到有关如何执行此操作的说明：http: [//blogs.iis.net/.../using-ipv6-with-iis7.aspx](http://blogs.iis.net/nazim/archive/2008/05/03/using-ipv6-with-iis7.aspx)。

另一种选择是做我之前做过的事情，即从你的主机文件中删除 IPv6 localhost 定义。只需删除此行：

```
::1        localhost 
```

确保您`127.0.0.1`在主机文件中包含对的引用作为替代方案，否则您将遇到更大的问题。至少在世界完全切换到 IPv6 之前，您永远不需要`localhost`用作 的别名`::1`，无论如何这不会持续很长时间。

# ruby-on-rails - 如何为 Windows 上的 Ruby on Rails 应用程序部署创建一体化安装程序？

> ID：1018009
> 
> 赞同：1
> 
> 时间：2009-06-19T13:40:07.293
> 
> 标签：ruby-on-rails, windows, ruby, deployment, installation

我正在将 Rails 应用程序部署到 Windows 机器上。我使用 OS X 和 Linux 进行所有开发，但最终的应用程序实际上将在 Windows 机器上运行。

也就是说，我的客户正在寻找一个一体化的 Apache（我不得不说服他退出 IIS）+Rails+应用程序部署/安装程序。他想为他的所有（基于 Windows 的）客户提供各自服务器的安装 CD（他们都想要自己的设置）。

存在这样的东西吗？我意识到 Capistrano 存在，但这需要事先在主机（尤其是 Windows）上进行大量设置，并且在这种特殊情况下不太可行。

过去，我使用 InnoSetup ( [http://www.jrsoftware.org/isinfo.php](http://www.jrsoftware.org/isinfo.php) ) 创建安装程序，但我不确定这在这种情况下是否有效。

如果你们有任何意见、建议或极具说服力的客户端技术（将它们全部从 Windows =P 中谈出来），我们将不胜感激。

最好的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:49:26.910

我会考虑将 jruby 与 glassfish 一起使用。确保用户有 java 并且应该很好去。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T18:24:52.293

尝试使用 RubyStack：

BitNami RubyStack 是一个安装程序，它极大地简化了 Ruby on Rails 及其运行时依赖项的安装。它包括 Ruby、Rails、MySQL 和 Subversion 的现成版本以及许多第三方库，如 FiveRuns TuneUp。RubyStack 在 Apache 2.0 许可下免费分发，并已使用 BitRock 的多平台安装程序打包。

[http://bitnami.org/stack/rubystack](http://bitnami.org/stack/rubystack)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T18:30:28.340

RubyStack 是最接近您所追求的东西，尽管您可能需要稍微调整安装并删除一些不需要的包袱。我不知道任何其他用于生产环境的 Windows 项目（InstantRails 专为开发而设计）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T13:42:21.313

也许您可以让[InstantRails](http://instantrails.rubyforge.org)满足您的需求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T13:50:50.047

Ruby 和因此 Ruby on Rails 在 Windows 上是一个相当臭名昭著的部署，即使在最好的情况下也是如此，尤其是在安装失败或你的手这样的情况下。我并不是要告诫，但这绝对是在匹配开发和部署环境（当我发现我们部署到的 Java 环境已经过时了五年时，我曾经遇到过类似的问题）。

由于我没有足够的 Ruby-on-Windows 经验来公平地权衡这个问题，我想说 LiveCD 或 CygWin 部署可能值得一看（总是很好地拓宽人们对替代操作系统的看法，对吧？） .

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T14:08:53.177

您是否考虑过构建在 VM 中运行的单个版本？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T17:11:24.283

对于这个特殊的问题，我会使用像[NSIS](http://nsis.sourceforge.net/Main_Page)这样的传统 Windows 安装程序包。

但是，当我有一个只使用 Windows 的 IT 部门的客户时，我发现他们更适合 XServer 而不是 linux 服务器。我通常不认为 OS X 是一个服务器操作系统，但它实际上运行得非常好。我首先尝试了 linux，当他们将其击落时，我建议使用 OS X，然后他们就跳了起来。

我认为，这有助于他们已经支持一些 Mac 笔记本电脑。

祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-22T13:42:06.223

正如其他海报所建议的那样，[RubyStack](http://bitnami.org/stack/rubystack)应该是一个不错的选择。它是免费的，您可以随时使用它来运行您自己的“安装后”脚本，以根据您的需要对其进行自定义。如果您想要支持的堆栈或对RubyStack的添加/修改，您可以从[BitRock获得](http://bitrock.com)[商业支持](http://fi.github.com)

# .net - 在您的项目中使用 FXCop

> ID：1018013
> 
> 赞同：6
> 
> 时间：2009-06-19T13:40:35.187
> 
> 标签：.net, fxcop

是否有很多 IT 商店使用 FxCop 来编写生产代码？如果是这样，您在文化转变、痛点和有形收益方面实施它的总体经验是什么？

我处于一个有点混乱的环境中，我正在寻找工具来帮助我们标准化我们的开发工作并让我们在一个体面的时间回家。我想避免因为推动静态分析工具而失败，因为它“不实用”。<-（预期的管理层回应）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T13:44:27.017

我想说真正使用 FxCop 的地方并不多。我们打开了它，但大多数开发人员忽略了产生的警告。

此外，这里的开发管理对真正推动清理警告并不感兴趣，部分原因是 FxCop 真的不喜欢管理层希望我们遵循的约定（变量名等）......

在我领导的项目中，我强制使用它，因为我认为它可以帮助我们成为更好的程序员。但是您必须先进入顶部才能让所有开发人员都遵循它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T13:50:40.453

请注意，对于您希望应用的规则，FxCop 是非常可定制的。您可能会发现通过逐步引入它效果最好；仅针对某组文件的某组规则，甚至最初排除所有遗留文件。

一定有一些规则您可能永远不会激活，因为它们不适合您的问题域。请记住，如果一段代码出于特定目的“违反规则”，则有一个属性可以将此类代码标记为可接受，尽管我会声明所有此类覆盖都必须使用`Justification`属性上的属性来指示原因的规则。

最后，尽管内置规则对提高代码质量有很大帮助，但真正大的胜利在于自定义规则，它允许您检查公司惯例。如果您不以这种方式自动化您的“同行评审”，那么您就无法真正保证合规性。

我在工作中使用 FxCop 作为构建系统的一个集成部分，我们的公共库目前在发布时启用了所有规则并启用了最少的属性覆盖，并且在很多地方都值得。

# asp.net - open source custom tooltip (callout) control/code for asp.net

> ID：1018020
> 
> 赞同：0
> 
> 时间：2009-06-19T13:41:58.193
> 
> 标签：asp.net

Looking for a custom tooltip (typical yellow baloon callout) on click of an anchor tag. The tooltip should appear and remain in view until the cross button on the tooltip is clicked.

Just looking for a tried and tested open source solution. Tried googling this but most of the tooltip [...*missing info?*...]

Ajax control toolkit has the calloutvalidator which seems like a good choice but is tied up to be used for validation tooltips.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T15:04:11.273

我不知道有很多好的开源服务器端控件。但是你应该看看这些：

*   [http://www.obout.com/flyout/example_Googlemap_tooltip.aspx](http://www.obout.com/flyout/example_Googlemap_tooltip.aspx) - 免费用于商业和个人用途
*   [http://aspalliance.com/1686](http://aspalliance.com/1686) - 创建自定义工具提示 Ajax 扩展器控件
*   [http://craigsworks.com/projects/qtip/demos/](http://craigsworks.com/projects/qtip/demos/) - jQuery 的 qTip。它不是一个 asp.net 控件，但可以很好地为您工作。

# c# - 限制嵌套 ASP.NET ListView 中的结果数

> ID：1018026
> 
> 赞同：0
> 
> 时间：2009-06-19T13:42:26.117
> 
> 标签：c#, asp.net, data-binding, listview, collections

类似于[我的另一个问题](https://stackoverflow.com/questions/1017959/limit-the-number-of-results-on-a-asp-net-listview)：

我有一个绑定到字典的 ListView。然后我有一个嵌套的 ListView 用于字典的值的整数。

我需要将绑定到嵌套列表的项目数限制为 5，并在模板中显示更多按钮。

我找不到让更多按钮工作并同时正确限制数量的方法。我现在有它作为一个或另一个工作。

有任何想法吗？谢谢！

**更新：**

标记看起来像这样：

```
<asp:ListView runat="server" ID="MainListView" ItemPlaceholderID="PlaceHolder2">
    <LayoutTemplate>
        <asp:PlaceHolder runat="server" ID="PlaceHolder2" />
    </LayoutTemplate>
    <ItemTemplate>
        <h1>My Main ListView - <%# Eval("Key") %></h1>
        <asp:ListView runat="server" ID="NestedListView" ItemPlaceholderID="PlaceHolder3"
        DataSource='<%# Eval("Value") %>' >
        <LayoutTemplate>
            <h2>One of many Nested ListViews</h2>
            <asp:PlaceHolder runat="server" ID="PlaceHolder3" />
        </LayoutTemplate>
        <ItemTemplate>
                <asp:LinkButton runat="server" ID="AnInteger" Text='<%# Eval("value") %>'></asp:LinkButton>
                <br />
        </ItemTemplate>
        </asp:ListView>
        <asp:LinkButton runat="server" ID="uxMoreIntegers" Text="More..." Visible="false" OnClick="uxMoreIntegers_Click"></asp:LinkButton>
    </ItemTemplate>
</asp:ListView> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T17:39:12.317

1.  无论如何，DataBind 主 ListView。
2.  在主 ListView 的 ItemDataBound 事件中以编程方式对嵌套的 ListView 进行数据绑定

代码：

```
protected void uxListView_ItemDataBound(object sender, ListViewItemEventArgs e)
{
    if (e.Item.ItemType == ListViewItemType.DataItem)
    {
        ListViewDataItem item = (ListViewDataItem)e.Item;

        // Get the bound object (KeyValuePair from the dictionary)
        KeyValuePair<string, List<int>> nestedIntegerList = (KeyValuePair<string, List<int>>)item.DataItem;

        // Get our nested ListView for this Item
        ListView nestedListView = (ListView)e.Item.FindControl("uxNestedListView");

        // Check the number of items
        if (nestedIntegerList.Value.Count > 5)
        {
            // There are more items than we want to show, so show the "More..." button
            LinkButton button = (LinkButton)item.FindControl("uxMore");
            button.Visible = true;
        }

        // Bind the nestedListView to wahtever you want 
        nestedListView.DataSource = nestedIntegerList.Value.Take(5);
        nestedListView.DataBind();
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T13:46:46.157

Take 方法将返回列表中的前 5 个项目，但不会修改列表本身。然后，您可以简单地检查列表中的项目数以确定是否需要启用更多按钮。

```
someList.Take(5); //use these items in your ListView
moreButton.Enabled = (someList.Count > 5); 
```

# excel - How to fill up a range in Excel worksheet with an array formula using VBA?

> ID：1018027
> 
> 赞同：1
> 
> 时间：2009-06-19T13:42:48.830
> 
> 标签：excel, vba

Actually the input range is bigger than the actual range required for the array formula as well. So it would be nice if the answer also includes the code to resize the range before filling in with array formula.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T13:54:09.620

这似乎对我有用

```
Call rng.Clear
Dim rngState As Range
Set rngState = rng.Resize(nRowCount, nColumnCount)
rngState.FormulaArray = "whatever_array_formula"
rngState.Calculate 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-08T21:37:15.317

我正在寻找的只是我更彻底的版本，因为数组已经被填充：

```
Sub PasteArray(vTheArray As Variant)
Dim rPasteHere As Range

With ActiveWorkbook
    Set rPasteHere = .Sheets("PayRoll").Range("A1").CurrentRegion  'Assign the region to use
    With rPasteHere
        .Clear  'Wipe the current region clean
        Set rPasteHere = .Resize(UBound(vTheArray, 1) + 1, UBound(vTheArray, 2) + 1)  'Resize the region to your input
        .FormulaArray = vTheArray  'Dump the array into the resized region
    End With
End With
Set rPasteHere = Nothing  'Clean up!
End Sub 
```

请记住，数组是从零开始的，因此 .Resize 函数中的 +1。对于我的应用程序，我对工作表名称和范围进行了硬编码，因此**rPasteHere**的生成方式自然取决于个人。

# asp.net - ASP.net 中菜单和 ajax ModalPopupExtender 的 Z-index 问题

> ID：1018029
> 
> 赞同：2
> 
> 时间：2009-06-19T13:43:11.107
> 
> 标签：asp.net, css, ajax, z-index

我使用 Ajax ModalPopupExtender，但问题是应用程序中的菜单显示在 ModalPopupExtender 上。我还为 ModalPopupExtender 设置了 z-index=1，为但问题未解决设置 z-index=100。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-03T16:35:26.807

经过几分钟的学习如何使用开发者工具（Chrome/IE 上的 F12），我终于找到了问题的根源。

我将假设以下两件事情中的一件是正确的： 1\. 您的主菜单位于母版页上，而 ModalPopupExtender 控件位于子页内。2\. ModalPopupExtender 控件放置在包含页面其余内容（主菜单除外）的同一 div 中，并且此 div 的 z-index 低于包含主菜单的 div。（即使您没有明确指定这些 z-index 值，这些 div 也会自动继承值。）

如果您的情况属于第一类，那么会发生以下情况：生成的标记将灯箱与子页面的其余内容（例如 wrapperContent）以及另一个（例如 wrapperHeader）放在一个 div 中。wrapperHeader 的 z-index 必须大于 wrapperContent 的 z-index，否则子菜单在下拉时将落在内容下方。现在无论您为灯箱指定什么 z-index 值，它都将始终显示在 wrapperHeader 内的每个元素下，因为它从 wrapperContent 继承了它的 z-index，它低于 wrapperHeader 的 z-index。

如果您的情况属于第二类，则类似的解释如下。

@Jack Marchetti 这也解释了为什么当您将灯箱放置在它自己的 div 中时，这个问题是固定的，与页面其余部分的内容分开。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:15:21.073

使用 Firebug(Firefox Extension) 或类似的东西来检查菜单的 Z-Index。然后将 ModalPopupExtender 的 Z-Index 设置为 1 更高。

如果没有看到实时页面，我无法猜测 z-index，但它必须大于 100。您可以尝试将其设置为 10001 或非常高的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-09T11:54:29.110

我已经做了大约 4 年的 Asp.Net 开发，我的经验告诉我要远离微软的 AJAX 库，尤其是 AJAX Control Toolkit。那里有一些错误，他们似乎并不打算修复。

我对你的建议：使用另一个库。我现在正在使用 JQuery，您在网上找到的 JQuery 插件质量参差不齐，但其中一些非常好，另一些我自己修复了错误（我只选择我可以快速理解代码的那些）。

JQuery UI 具有非常高的质量，它包括一个我正在使用的对话框小部件，而不是 ModalPopupExtender。如果您不喜欢窗口样式，请查看此页面上提供的 15 个插件之一：[15+ jQuery Popup Modal Dialog Plugins and Tutorials](http://choosedaily.com/1178/15-jquery-popup-modal-dialog-plugins-tutorials/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:42:16.140

将 z-index 设置为像@Jab 提到的非常大的东西。

我还发现，如果你将 ModalPopupExtender 放在 HTML 标记的底部，它有时会因为一些非常奇怪的原因修复它。试试看。

# c - C 中数据包的示例读/写处理

> ID：1018030
> 
> 赞同：3
> 
> 时间：2009-06-19T13:43:13.883
> 
> 标签：c, networking, sockets, packet

我对 C 有点陌生，但我已经完成了我的作业（一些教程、书籍等），我需要编写一个简单的服务器来处理来自客户端的请求并与数据库交互。我已经阅读了 Beej 的网络编程指南，但我有点不确定如何拼凑和处理来回发送的数据的不同部分。

例如，假设客户端正在发送一些信息，服务器将把这些信息放在多个字段中。如何将要发送的数据拼凑在一起，然后在服务器端将其分解？

谢谢，

埃里克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:04:13.437

如果我理解正确，您会问，“服务器如何理解客户端发送的信息”？

如果这就是您要问的，答案很简单：事先双方都同意每个使用的数据结构将是兼容的。即你决定你的通信协议将提前。

因此，例如，如果我有一个客户端-服务器应用程序，客户端连接并可以询问诸如“时间”、“日期”之类的内容，并且可以说“设置时间”和“设置日期”，我需要用这样的方式编写我的服务器一种理解这些命令的方式。

显然，在上述情况下它是微不足道的，因为它只是一个基于文本的协议。但是假设您正在编写一个将返回信息结构的应用程序，即

```
struct Person {
    char* name;
    int age;
    int heightInInches;
    // ... other fields ...
}; 
```

您可以从服务器/客户端写出整个结构。在这种情况下，有几点需要注意：

1.  你需要正确地 hton/ntoh
2.  You need to make sure that your client and server both can understand the struct in question.
3.  You may or may not have to align on a 4B boundary (because if you don't, different C compilers may do different things, which may burn you between the client and the server, or it may not).

In general, though, when writing a client/server app, the most important thing to get right is the **communication protocol.**

I'm not sure if this quite answers your question, though. Is this what you were after, or were you asking more about how, exactly, do you use the send/recv functions?

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T14:05:04.293

First, you define how the packet will look - what information will be in it. Make sure the definition is in an architecture-neutral format. That means that you specify it in a sequence that does not depend on whether the machine is big-endian or little-endian, for example, nor on whether you are compiling with 32-bit `long` or 64-bit `long` values. If the content is of variable length, make sure the definition contains the information needed to tell how long each part is - in particular, each variable length part should be preceded by a suitable count of its length.

When you need to package the data for transmission, you will take the raw (machine-specific) values and write them into a buffer (think 'character array') at the appropriate positions, in the appropriate format.

This buffer will be sent across the wire to the receiver, which will read it into another buffer, and then reverse the process to obtain the information from the buffer into local variables.

There are functions such as `ntohs()` to convert from a network ('n') to host ('h') format for a 'short' (meaning 16-bit) integer, and `htonl()` to convert from a host 'long' (32-bit integer) to network format - etc.

One good book for networking is Stevens' "[UNIX Network Programming, Vol 1, 3rd Edn](http://unpbook.com/)". You can find out more about it at its web site, including example code.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:16:44.347

As already mentioned above what you need is a previously agreed means of communication. One thing that helps me is to use xmls to communicate.

e.g. You need time to send time to client then include it in a tag called time. Then parse it on the client side and read the tag value.

The biggest advantage is that once you have a parser in place on client side then even if you have to send some new information them just have to agree on a tag name that will be parsed on the client side.

It helps me , I hope it helps you too.

# c# - Custom binding class is not working correctly

> ID：1018039
> 
> 赞同：7
> 
> 时间：2009-06-19T13:44:39.687
> 
> 标签：c#, .net, wpf, visual-studio, data-binding

Currently I'm playing around with WPF data binding and I came to an issue I dont understand. So I post the problem here, maybe you have and idea whats geoing wrong.

At first: I'm working with Visual Studio 2008 under Windows Vista 32bit, the problem is also present in Windows 7 RC1 64bit, latest updates/service packs are installed except Vista, its still running with SP1.

Here is the problem: I'm not able to set a ValueConverter in an inherited Binding class.

Here is my custom binding class:

```
public class MyBinding : Binding
{
    public MyBinding() : base() { }
    public MyBinding(string path) : base(path) { }
} 
```

This class should do exactly the same as the original Binding class because currently it does not implement any own logic. I can use this class in XAML as follows:

```
<TextBlock Text="{local:MyBinding SomeProperty}" /> 
```

local is the namespace where the MyBinding class is implemented.

Now here comes the first thing I dont understand. VS2008 shows the following error message in its error window (the original message is in german, because I'm running a german system - i dont have the english error message, so I will try to translate)

> Kein Konstruktor des MyBinding-Typs weist 1-Parameter auf.
> 
> (No constructor of type MyBinding takes 1 argument)

Althoug this error is display the project compiles just fine and the MyBinding class is working as expected. Why Visual Studio does not find the corresponding constructor (wich, I would say, is properly implemented)?

I can prevent these message if I change the XAML code to this:

```
<TextBlock Text="{local:MyBinding Path=SomeProperty}" /> 
```

The error message is gone because the MyBinding's default constructor is called, everything works fine, ok...

Now I would like to set a ValueConverter to my property binding, XAML looks like this:

```
<Window.Resources>
    <local:MyValueConverter x:Key="converter" />
</Window.Resources>
[...]
<TextBlock Text="{local:MyBinding Path=SomeProperty, Converter={StaticResource converter}}" />
[...] 
```

..., and here I get the following error while compiling (original in german and I think, I've also found the original message in english):

> Beim Analysieren einer Markup Extension wurde für den Typ "MS.Internal.Markup.MarkupExtensionParser+UnknownMarkupExtension" die unbekannte Eigenschaft "Converter" gefunden. Zeile X Position Y.
> 
> (Unknown property 'Converter' for type 'MS.Internal.Markup.MarkupExtensionParser+UnknownMarkupExtension' encountered while parsing a Markup Extension. Line x position Y)

Now I cannot compile anymore because VS does not find the converter property (wich is a public property of the original Binding class).

I've managed to get the MyBinding class to run with a converter I specify, but only with a little hack: I've added the following property to the MyBinding class:

```
 public Type ConverterType
    {
        get { return Converter == null ? null : Converter.GetType(); }
        set { Converter = value == null ? null : (IValueConverter)Activator.CreateInstance(value); }
    } 
```

... and XAML changes to this:

```
<TextBlock Text="{local:MyBinding Path=SomeString, ConverterType=local:MyValueConverter}" /> 
```

Now my project compiles and runs fine. Actually I think, its a nice solution, because you dont have to specify the converter as a static resource and the binding expression looks a little bit more clearly to me. But at the end, this cannot be the solution.

So can anyone tell me what I've done wrong? Why I cannot set the Converter property in my custom Binding class?

Thank you! Best regards, René

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-22T13:26:34.510

在对标记扩展进行了一些进一步的测试之后，这个问题一遍又一遍地通过我的方式，经过更多的谷歌搜索，我想我已经找到了一个确认，这是 Visual Studio 设计器中的一个错误。大家有兴趣的可以看看

[http://www.hardcodet.net/2008/04/nested-markup-extension-bug](http://www.hardcodet.net/2008/04/nested-markup-extension-bug)

最好的问候，勒内

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T15:58:41.823

从 Binding 继承可能不是最好的解决方案。如果您只是想绕过将转换器声明为静态资源，请尝试创建转换器的单例，并像这样使用它：

```
Text="{Binding Path=Foo, Converter={x:Static local:MyConverter.Converter}}" 
```

或者，您可以尝试[此处](http://www.drwpf.com/Blog/Default.aspx?tabid=36&EntryID=48)显示的标记扩展。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T18:55:04.210

谢谢您的答复！

一般来说，我对绑定表达式语法和在使用它之前声明转换器没有问题。我上面写的只是解决我的主要问题的一个很好的结果。我想创建自己的 Binding 类并将自己的转换器传递给它，就像我使用原始 Binding 类一样。

我只是想了解错误消息，它是由 VS 呈现给我的。我认为这一定是有原因的，要么我做错了，要么 Visual Studio/WPF 中存在错误。

直到今天下午，我还很确定问题出在电脑前。但是我已经在另外两个用户组中发布了这个问题（也在 WPF 论坛的 MSDN 上）。到现在为止，你是唯一回应的人。所以我想到了这个想法，它也可能是视觉工作室的问题......我不知道。

再次，非常感谢您，我将仔细查看您发布的页面（目前只是一个简短的页面）。

周末愉快！

最好的问候，勒内

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-14T15:42:25.397

我遇到了同样的问题，不知道为什么，但是我将自定义绑定放在另一个 dll 上并且它起作用了。

# ruby-on-rails - 你如何在 Sass 中编写 tr:nth-child(odd) ？

> ID：1018045
> 
> 赞同：3
> 
> 时间：2009-06-19T13:46:19.947
> 
> 标签：ruby-on-rails, haml, sass

这个 sass 代码有效吗？

```
tr:nth-child(odd)
  :background-color #cccccc 
```

不知何故，它不会为我的表格的交替行着色。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T13:57:44.510

你使用的是什么浏览器？ `nth-child` [目前](http://kimblim.dk/css-tests/selectors/)在 Firefox 或[IE](http://msdn.microsoft.com/en-us/library/cc351024(VS.85).aspx#pseudoclasses)中不支持。你可能不得不使用旧的奇数/偶数类的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-08T18:12:46.273

Compass 为使用 sass 设置表格样式提供了 mixins，由于对 CSS3 的支持不佳，它需要一些额外的 css 类。

有关更多信息，请参阅[wiki 文档的](http://wiki.github.com/chriseppstein/compass/compass-core-utilities-module)**表格实用程序**部分。演示[在这里](http://compass-style.org/examples/compass/utilities.html)。

# c# - 带有 Activator.CreateInstance 的 var 关键字？

> ID：1018049
> 
> 赞同：1
> 
> 时间：2009-06-19T13:47:02.333
> 
> 标签：c#

在将 Activator.CreateInstance 的结果转换为接口类型时，我在哪里使用 var 关键字存在一些问题。据我了解 var，以下代码片段对在 var 版本和显式类型版本之间几乎相同：

```
// Direct cast
var thing = (IThing)Activator.CreateInstance(Type.GetType(thingType));
IThing thing = (IThing)Activator.CreateInstance(Type.GetType(thingType));

// Casting with as
var thing = Activator.CreateInstance(Type.GetType(thingType)) as IThing;
IThing thing = Activator.CreateInstance(Type.GetType(thingType)) as IThing; 
```

是否有任何我遗漏的细微差异可能会改变 Intellisense 或运行时行为？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T13:49:23.577

没有区别。' `var`' 关键字没有做任何神奇的事情，它使用编译时类型推断，类似于泛型的工作方式。

编译好后就没什么区别了。您可以通过将鼠标悬停在使用它的变量名上（而不是声明它的位置）来用您的 IDE 来证明这一点。应该会弹出一个工具提示，向您显示类型。将鼠标悬停在上面时，两个变量应具有相同的类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T13:50:50.327

在每种情况下，将事物声明为`var`或是`IThing`同义词。

cast 和 using 之间存在差异-如果项目不是您要转换的项目`as`，则后者将返回。`null`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T13:54:40.837

不，没有区别。我也没有看到使用`var`关键字有任何问题。

`Type`在可读性方面，查看以下代码行，您很容易看到`var`：

```
var thing = (IThing)Activator.CreateInstance(Type.GetType(thingType));
var thing = Activator.CreateInstance(Type.GetType(thingType)) as IThing; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T13:48:28.320

var 和 IThing 是相同的。您只需节省 3 次击键。

# reporting-services - SQL Reporting Services - 多个快照？

> ID：1018051
> 
> 赞同：0
> 
> 时间：2009-06-19T13:47:39.103
> 
> 标签：reporting-services, snapshot

我有一份报告，该报告每周根据某个位置的默认值生成一个快照。现在我需要在同一个报告上运行相同的快照，但默认值不同。有没有办法在不创建默认值略有不同的新报告的情况下做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-17T14:36:05.607

您可以使用 Null Delivery Provider 创建数据驱动订阅，并打开缓存。

或者，您可以围绕历史快照创建解决方案，如[http://blogs.msdn.com/lukaszp/archive/2007/01/12/per-user-snapshots-or-multiple-snapshots-for-a-在同一时间报告每个具有不同参数的.aspx](http://blogs.msdn.com/lukaszp/archive/2007/01/12/per-user-snapshots-or-multiple-snapshots-for-a-report-each-with-different-parameters-at-the-same-time.aspx)

# c - 如何获取和同步所有 X11 窗口的完整列表？

> ID：1018052
> 
> 赞同：13
> 
> 时间：2009-06-19T13:47:43.407
> 
> 标签：c, linux, x11, race-condition, xorg

我想监控X11下所有打开的窗口。目前，我这样做如下：

1.  最初通过从根窗口递归调用 XQueryTree 来遍历整个树
2.  监听整个桌面的子结构变化：`XSelectInput( display, root_window, SubstructureNotifyMask | PropertyChangeMask )`
3.  处理所有 MapNotify、UnmapNotify 和 DestroyNotify 事件，在进程中更新我自己的窗口列表

我主要担心第1点。在递归过程中，XQueryTree会被多次调用。有什么办法可以确保树在此期间不会改变？换句话说，在某个时间点获取整棵树的“快照”？

另外，我注意到在某些 X11 系统下，并非所有事件都正确到达。例如，当在桌面上打开一个新窗口时，该窗口的 MapNotify 可能永远不会到达我的监控应用程序。怎么会这样？是否有可能在到达之前被丢弃？

**更新：**

我编写了一个小程序来监视根窗口上的 X 事件（见下文）。现在，当我运行这个程序并启动和退出 xcalc 时，我得到以下输出：

```
Reparented: 0x4a0005b to 0x1001e40
Mapped    : 0x1001e40
Destroyed : 0x1001e40 
```

而已。**我从来没有收到关于真实窗口（0x4a0005b）被破坏的通知。甚至没有被映射！**谁能告诉我为什么不呢？SubStructureNotifyMask 是否只导致发送**直接**子窗口的事件而不是整个子树？

顺便说一句，这显然不会在 Compiz 运行时发生。然后不进行重新父项：

```
Mapped    : 0x4a0005b
Mapped    : 0x4e00233
Destroyed : 0x4a0005b
Destroyed : 0x4e00233 
```

监控程序来源：

```
#include <X11/Xlib.h>
#include <cstdio>

int main()
{
    Display *display;
    Window rootwin;

    display = XOpenDisplay( NULL );
    rootwin = DefaultRootWindow( display );
    XSelectInput( display, rootwin, SubstructureNotifyMask );

    XEvent event;

    while ( 1 ) {
        XNextEvent( display, &event );
        if ( event.type == MapNotify ) {
            XMapEvent *mapevent = (XMapEvent *)&event;
            printf( "Mapped    : 0x%x\n", (unsigned int)(mapevent->window) );
        }
        if ( event.type == DestroyNotify ) {
            XDestroyWindowEvent *destroywindowevent = (XDestroyWindowEvent *)&event;
            printf( "Destroyed : 0x%x\n", (unsigned int)(destroywindowevent->window) );
        }
        if ( event.type == ReparentNotify ) {
            XReparentEvent *reparentevent = (XReparentEvent *)&event;
            printf( "Reparented: 0x%x to 0x%x\n", (unsigned int)(reparentevent->window), (unsigned int)(reparentevent->parent) );
        }
    }

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-19T14:17:50.087

看看`xwininfo`。

您可能还喜欢`xprop`和`xspy`获取更多信息。

**更新：**是的。尝试使用and 或者`xwininfo`让`-root`所有窗口都参与进来。`-tree``-children`

并且可以使用 跟踪更改`xprop -spy`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-17T11:53:04.187

我相信抓取 X 服务器 (XGrabServer(3)) 将阻止对窗口层次结构的更改。虽然它有点重，所以你应该只在你真的需要它时才这样做。

有关遍历窗口层次结构、构建树、使用窗口事件使其保持最新以及忽略由于竞争而不可避免的 X 协议错误的代码示例，请参见文件[src/VBox/Additions/x11/VBoxClient /seamless-x11.cpp](http://www.virtualbox.org/svn/vbox/trunk/src/VBox/Additions/x11/VBoxClient/seamless-x11.cpp)在 VirtualBox 的源代码中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-15T07:54:03.847

X11 是一个远程协议。这意味着当您向 X 服务器查询任何信息时，您总是会得到自己的副本。当 X 服务器更新其内部数据结构时，您的副本永远不会改变。

这意味着当您遍历树时，树不会突然改变，但是当您使用其中的信息（例如检查窗口）时，该信息可能是陈旧的（有人可能已经关闭了窗口）。这就是为什么您需要进行适当的错误处理的原因。

# sql - 用 parentid 过滤掉表中的孩子

> ID：1018057
> 
> 赞同：2
> 
> 时间：2009-06-19T13:48:29.770
> 
> 标签：sql, sql-server, tsql

我需要一些帮助来构建一个可以让我过滤以下数据的查询。

```
Table: MyTree
Id  ParentId  Visible
=====================
1   null      0
2   1         1
3   2         1
4   3         1
5   null      1
6   5         1 
```

我期望从查询中得到以下结果：

```
Id  ParentId  Visible
=====================
5   null      1
6   5         1 
```

也就是说，不应该返回隐藏节点的所有子节点。更重要的是，层次结构的深度不受限制。现在不要因为不可能的非显而易见的原因回答“只是将 2、3 和 4 设置为可见 = 0”......就像我正在修复一个可怕的“遗留系统”。

我在想类似的东西：

```
SELECT *
FROM MyTree m1
JOIN MyTree m2 ON m1.ParentId = m2.Id
WHERE m1.Visible = 1
AND (m1.ParentId IS NULL OR m2.Id IS NOT NULL) 
```

*抱歉有任何语法错误*

但这只会过滤第一级，对吗？希望你能帮忙。

编辑：完成标题，哎呀。该服务器是全新的 MSSQL 2008 服务器品牌，但数据库以 2000 兼容模式运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T13:54:48.713

在`SQL Server 2005+`：

```
WITH    q (id, parentid, visible) AS
        (
        SELECT  id, parentid, visible
        FROM    mytree
        WHERE   id = 5
        UNION ALL
        SELECT  m.id, m.parentid, m.visible
        FROM    q
        JOIN    mytree m
        ON      m.parentid = q.id
        WHERE   q.visible = 1
        )
SELECT  *
FROM    q 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T14:10:46.187

我同意@Quassnoi 对递归 CTE 的关注（在 SQL Server 2005 或更高版本中），但我认为回答原始问题的逻辑不同：

```
WITH visall(id, parentid, visible) AS
   (SELECT  id, parentid, visible
    FROM    mytree
    WHERE   parentid IS NULL
        UNION ALL
    SELECT  m.id, m.parentid, m.visible & visall.visible AS visible
    FROM    visall
    JOIN    mytree m
      ON    m.parentid = visall.id
   )
SELECT  *
FROM    visall
WHERE   visall.visible = 1 
```

表达相同逻辑的一种可能更优化的方法应该是尽可能在 WHERE 中进行可见检查——尽快停止沿不可见“子树”的递归。IE：

```
WITH visall(id, parentid, visible) AS
   (SELECT  id, parentid, visible
    FROM    mytree
    WHERE   parentid IS NULL AND visible = 1
        UNION ALL
    SELECT  m.id, m.parentid, m.visible
    FROM    visall
    JOIN    mytree m
      ON    m.parentid = visall.id
    WHERE   m.visible = 1
   )
SELECT  *
FROM    visall 
```

与通常的性能问题一样，有必要根据实际数据对两个版本进行基准测试，以便自信地做出决定（这也有助于检查它们是否确实产生了相同的结果；-)——因为数据库引擎的优化器有时会出于奇怪的原因做一些奇怪的事情；- ）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T14:13:58.770

我认为 Quassnoi 接近提问者想要的，但并不完全如此。我认为这就是提问者正在寻找的（SQL Server 2005+）：

```
WITH    q (id) AS
        (
        SELECT  id
        FROM    mytree
        WHERE   parentid is null and visible=1
        UNION ALL
        SELECT  m.id
        FROM    q
        JOIN    mytree m
        ON      m.parentid = q.id
        WHERE   q.visible = 1
        )
SELECT  *
FROM    q 
```

公用表表达式非常适合这种工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-19T13:56:08.243

我认为您需要的东西不可能从单个查询中获得。这看起来更像是从代码中做的事情，但仍然需要对 DB 进行多次查询。

如果您真的需要从 SQL 中执行此操作，我认为您最好的选择是使用游标并构建一个带有隐藏 ID 的表。如果数据不经常更改，您可以将该“临时”表保留为一种缓存。

**编辑**：我得到了纠正（对于 SQL 2005）并且今天还学到了一些新东西:)

# java - 如何在 Eclipse 中构建 Java Servlet？

> ID：1018063
> 
> 赞同：2
> 
> 时间：2009-06-19T13:49:32.610
> 
> 标签：java, eclipse, servlets

我是 Java 新手。我必须修改在我的 Tomcat 上运行的这个 Web Servlet。Webapps 文件夹包含多个文件和目录，但只有一个 .JAR 文件。我设法使用 Java Decompiler JD-GUI 对其进行了反编译，但是当我在 Eclipse 中从反编译的源代码创建项目并尝试验证它时，Eclipse 向我显示了大约 389 个错误。像这样的错误

> HttpServlet 无法解析为类型

而且我什至不知道哪个 Eclipse 按钮​​重建了 .JAR 文件。谁能帮我？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:08:32.820

您的 Eclipse 项目将需要包含 servlet 所依赖的库才能工作。

如果您将 Eclipse 项目创建为动态 Web 项目，它将设置一些所需的基本结构，包括相关的库。如果原始代码依赖于它们，您可能需要包含其他库，但从您的描述来看，这似乎不太可能。

您可以从 Eclipse 文件菜单创建一个 JAR 文件。单击导出...，然后选择 Java->Jar 文件。

许多项目将使用 ANT，它允许您定义脚本来执行编译、打包、部署和测试项目所需的任务。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2011-01-10T09:14:11.643

您将 Eclipse 项目创建为动态 Web 项目，它将设置一些所需的基本结构，包括相关库。如果原始代码依赖于它们，您可能需要包含其他库，

> 从 Eclipse 文件菜单创建一个 JAR 文件
> 
> 单击导出...，然后选择 Java->Jar 文件。

# python - 帮我理解Oracle中CLOB和BLOB的区别

> ID：1018073
> 
> 赞同：39
> 
> 时间：2009-06-19T13:51:38.453
> 
> 标签：python, oracle

这主要只是一个“检查我的理解”类型的问题。以下是我对在 Oracle 中工作的 CLOB 和 BLOB 的理解：

*   CLOB 用于 XML、JSON 等文本。您不应假设数据库会将其存储为何种编码（至少在应用程序中），因为它将转换为数据库配置使用的任何编码。
*   BLOB 用于二进制数据。您可以放心，它们将以您发送它们的方式存储，并且您将使用与它们发送时完全相同的数据取回它们。

所以换句话说，假设我有一些二进制数据（在这种情况下是一个腌制的 python 对象）。我需要保证，当我发送它时，它将完全按照我发送它的方式存储，并且当我取回它时它会完全一样。BLOB 是我想要的，对吗？

为此使用CLOB真的可行吗？或者字符编码会导致足够多的不值得的问题？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-06-19T13:56:25.543

`CLOB`是编码和排序敏感的，`BLOB`不是。

当你写一个`CLOB`using 时，比如说，`CL8WIN1251`你写一个`0xC0`（这是西里尔字母 А）。

当您使用 读回数据时`AL16UTF16`，您会返回`0x0410`，这是`UTF16`这封信的表示。

如果你正在阅读 a `BLOB`，你会得到同样的`0xC0`回报。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-19T13:57:36.430

你的理解是正确的。既然您提到了 Python，请考虑一下 Python 3 字符串和字节之间的区别：CLOB 和 BLOB 非常相似，还有一个额外的问题是 CLOB 的编码不受您的应用程序的控制。

# flash - 游戏开发的 Flash 性能：本机渲染 VS BitmapData 帧缓冲区

> ID：1018074
> 
> 赞同：20
> 
> 时间：2009-06-19T13:52:09.203
> 
> 标签：flash, actionscript-3, performance

*我开发了一个包含大量对象*和*激进滚动*的 2D 射击游戏。

**问题：**哪种方式更好？

选择 1 - 使用原生 Flash 渲染：

*   从 Bitmap 派生游戏对象，使用现有的 x、y、width、height、bitmapData
*   将所有对象作为子 UIComponent.addChild(...) 添加到屏幕
*   使用“scrollRect”剪辑可见区域

CHOICE 2 - 使用“bitmap + copyPixels”编写自定义渲染

*   将自己的游戏对象与 x、y、宽度、高度、位图数据一起使用
*   将位图添加到屏幕，从中获取位图数据
*   重绘每个 ENTER_FRAME：bitmapData.lock()，遍历游戏对象和 copyPixels() 到 bitmapData，然后 bitmapData.unlock()
*   自定义剪辑：不渲染屏幕对象

在这个[问题](https://stackoverflow.com/questions/989471/vsync-in-flex-flash-as3)中，有些人抱怨“bitmap + copyPixels()”很慢。

**实验：**我已经实现了这两种技术：

*   [main_1.swf](http://sites.google.com/site/oshyshko/framebuffer_vs_nativerender/main_1_more_creeps.swf?attredirects=0) - 本机
*   [main_2.swf](http://sites.google.com/site/oshyshko/framebuffer_vs_nativerender/main_2_more_creeps.swf?attredirects=0) - 自定义

请尝试一下，看看哪个更好（更快、更流畅、消耗更少的 CPU）。

等到*至少有 250 个敌人*（屏幕上方的计数器）。
**更新：**尝试打开任务管理器（或 $top）并查看整体 CPU 使用情况

**更新 2：**我更改了代码，现在小兵的生成速度更快。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:03:05.140

更新：感谢高压力版本。再一次，我真的看不出只是跑来跑去有什么不同。但是我巧妙地发现“r”会掉落炮塔，而当我掉落20-30个炮塔时，原生版本比手动版本要慢一些，所以也许我错了。（我发现在内存使用方面没有区别。）似乎在本机上做事情应该有更快的潜力，但很可能需要专门处理一些不透明的排序。

由于这已被接受，我将添加一条注释以明确我在对不同答案的评论中所说的话：如果您的所有资产本身都是位图，那么正如 HanClinto 指出的那样，发现手动合成它们比制作本机对象并让 Flash 完成工作，因为它消除了与显示对象相关的开销，例如事件结构。

然而，在某些情况下，手动操作可能会胜出，例如，如果您有需要渲染为位图的矢量内容，或大量动画精灵，或者如果您需要检测演员上的鼠标事件（您会如果您自己进行合成，则需要手动进行，也许会很痛苦）。

因此，如果您不需要做任何会减慢手动合成的事情，它似乎绝对是最好的答案，如果您这样做，那么尝试这两种方法是绝对确定的最佳方法。（混合模型也是可能的，您可以在其中制作一层需要鼠标事件的本机对象，并用一层手动合成的位图覆盖或覆盖它。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-21T18:36:54.477

我发现自定义（位图渲染）版本要快得多，并且会这样。

Flash 的 DisplayList 旨在解决 DisplayObjects 中的大量差异，因此不是最有效的方法（除非您最终在 AS3 中自行解决所有这些差异，在这种情况下您将输给本机代码）。

例如，对于平铺渲染（您正在为平铺执行 copyPixels），自定义位图渲染器将比在 DisplayList 上拥有数百个 DisplayObject 快得多。您也可以使用专门的裁剪器来处理切片，而 Flash 最终会进行非常通用的边界框计算和测试。

在 re: variances 中，例如，在您的自定义版本中，“建筑”精灵会随着角色四处移动而摆动，这可能是由于代码中的浮点到整数转换或舍入而不是舍入所致。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:51:28.270

如果您在屏幕上制作数百或数千个对象（例如具有强烈的粒子效果），那么使用 CopyPixels 将获得更好的性能。

这在很大程度上取决于你想要做什么，对吧？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T14:24:15.813

Flash 可以在现代 pc 或 mac 上本地处理数百个 sprite 而不会损失性能，所以我投票赞成使用显示对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-07T11:30:07.530

我有一台低端笔记本电脑，Intel Mobile 1.6Ghz/512MB，Firefox 3.5.x，Flash10.0.32.18，WinXP

我可以清楚地看到一个很大的不同。

本机版本：不到 10 秒就达到 CPU99% 并且移动很生涩。自定义版本：保持在下面

顺便说一句，有没有机会获得示例代码作为练习。

# html - 语义缩略图指示

> ID：1018075
> 
> 赞同：1
> 
> 时间：2009-06-19T13:52:21.120
> 
> 标签：html, image, semantics

给定以下图片链接：

```
<a href="path/to/img.jpg">Title</a> 
```

指示缩略图位置的语义最合理的方法是什么？

到目前为止，我能想到的最好的方法是使用`data-`如下属性：

```
<a href="path/to/img.jpg" data-thumb="path/to/thumb.jpg">Title</a> 
```

但是，它在语义上似乎不太合理。有没有更好或更正确的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:37:19.400

为什么不使用`<img>`元素？你可以给它一个类来表明它是一个缩略图，如果你需要的话，可以通过渐进增强来隐藏它。这样，图像的缩略图将在没有 JavaScript/CSS 的情况下显示：

```
<a href="path/to/img.jpg">
    <img src="path/to/thumbnail.jpg" class="thumb" alt="Thumbnail" />
    Title
</a> 
```

还是我太天真了？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:26:06.640

```
<a href="path/to/img_thumb.jpg">Title</a> 
```

简单并保持原始路径不变，同时只需添加后缀以指示图像是缩略图。我们一直在我们的网站上使用它，它使事情变得容易。

# html - 测试 HTML 电子邮件呈现

> ID：1018078
> 
> 赞同：259
> 
> 时间：2009-06-19T13:53:12.727
> 
> 标签：html, email, testing

是否有任何好的工具可以轻松测试 HTML 电子邮件在不同电子邮件客户端中的外观？我更喜欢即时反馈的东西，而不是像[http://litmusapp.com](http://litmusapp.com)这样的提交和等待服务或者至少是一种测试 Outlook 2007/MS Word 渲染的方法？

我发现了这个相关的问题，但它并没有专门解决测试问题。[有哪些 HTML 电子邮件设计指南？](https://stackoverflow.com/questions/127498/what-guidelines-for-html-email-design-are-there)

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2011-01-20T01:16:25.810

您还可以使用[PutsMail](http://putsmail.com)在发送电子邮件之前对其进行测试。

> PutsMail 是一个测试 HTML 电子邮件的工具，这些电子邮件将作为活动、新闻通讯和其他方式发送（请不要用它来发送垃圾邮件，帮助我们创造更美好的世界）。
> 
> 主要特点：
> 
> *   检查与电子邮件客户端的 HTML 和 CSS 兼容性
> *   轻松发送 HTML 电子邮件以供批准或检查其在电子邮件客户端中的外观

* * *

## 回答 #2

> 赞同：139
> 
> 时间：2009-06-19T17:40:24.997

是的，您可以使用以下任何流行工具：

*   石蕊[https://litmusapp.com/](https://litmusapp.com/)
*   MailChimp [https://www.mailchimp.com/](https://www.mailchimp.com/)
*   CampaignMonitor [https://www.campaignmonitor.com/](https://www.campaignmonitor.com/)
*   Testi@ [https://testi.at/](https://testi.at/)
*   电子邮件上酸@ [https://www.emailonacid.com/](https://www.emailonacid.com/)
*   Email2Go [https://email2go.io](https://email2go.io)

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-08-24T19:05:20.313

我今天找到[了 emailonacid.com](http://www.emailonacid.com/)（测试版，目前免费†）——只玩了一点，但到目前为止还不错。它模拟以下客户端：

*   美国在线 9
*   随行人员 2004 和 2008
*   邮箱
*   热邮件
*   Windows Live 邮件
*   视窗邮件
*   Mac 邮件
*   展望 2003 和 2007
*   雷鸟 2、3 和测试版
*   雅虎经典/雅虎邮箱

该服务非常有用的一点是它会告诉您哪些代码在哪个客户端中不受支持。

* * *

*†<strong>编辑：不再免费，但提供 7 天免费试用。*

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2012-05-04T14:04:11.563

您可以尝试的另一件事是将 html 上传到网页，然后用 word 打开网页以测试 Outlook。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-11-19T23:10:32.380

Direct Mail 是一个 OS X 桌面应用程序，它可以显示您的电子邮件在各种电子邮件客户端中的外观预览：

[http://directmailmac.com/mac-email-design/](http://directmailmac.com/mac-email-design/)

完全披露：我为 Direct Mail 的开发人员工作

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2012-02-06T08:14:43.607

如果您要将 HTML 页面转换为电子邮件。你应该检查 [Premailer](http://premailer.dialect.ca/)，

它将 CSS 转换为内联 CSS，并测试与主要电子邮件客户端的兼容性。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-06-19T17:50:47.387

如果您不想使用像 Litmus 这样的提交服务（Litmus 是最好的，顺便说一句），那么您只需要运行 Outlook 2007 来测试您的电子邮件。

听起来您想要一些更自动化的东西（尽管我不确定为什么），但幸运的是 Outlook 很容易使用 Visual Basic for Applications (VBA) 实现自动化。

您可以编写一个从命令行运行的 VBA 工具来生成电子邮件，将电子邮件加载到 Outlook 中，如果您愿意，甚至可以截取屏幕截图。（大概这就是 Litmus 团队在后端所做的。）

（顺便说一句，不要尝试使用 MS Word 来测试邮件；渲染器相似，但页面布局的细微差别会影响电子邮件的渲染。）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-06-19T13:59:28.063

[Campaign Monitor](http://www.campaignmonitor.com/testing/)非常流行，并为许多流行的电子邮件客户端提供预览。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-09-02T15:12:31.610

我已经使用了其中的大多数，并且可以告诉您最好的方法是直接对每个客户进行测试。一旦您对发送感到满意，您就可以将您的电子邮件测试发送到 gmail，如果设计没有破坏，那么它在现代电子邮件客户端上非常安全。

您可以在此处查看哪个客户端支持的内容：

[http://www.email-standards.org](http://www.email-standards.org)

# svn - 从我的 SVN 自我中拯救我

> ID：1018079
> 
> 赞同：1
> 
> 时间：2009-06-19T13:53:55.360
> 
> 标签：svn, shell

使用 svn 时，我想签入整个本地存储库，我 cd 进入其目录并键入：

```
svn commit -m "blah blah" 
```

我很快意识到（痛苦的方式）这不会自动添加新文件。

为了做到这一点，我正在执行这两个步骤 hackasstic 怪物：

```
find . | grep -v ".svn" | grep -v "ignorepattern" | xargs svn add 2>/dev/null
svn commit -m "blah blah" 
```

现在，我不是 shell 专家，但我的代码感觉给我带来了不好的代码气味。

任何建议将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-19T14:00:52.803

好的，这不是问题的直接答案，但我不得不说这确实是一个工作流程问题，而不是你应该尝试自动化的东西。开发目录往往会填满许多您不希望在源代码控制下的随机杂物，但忘记添加到忽略文件中。这个过程很快就会用垃圾填满你的存储库。

此外，创建新的项目资源通常是一个相当少见的过程，应该至少稍微仔细考虑一下。我赞成必须对每个资源（或批次，通过 globbing）执行“svn add”的步骤，因为它可以阻止随意提交。

如果你担心自己会忘记事情，“svn status”命令是你的朋友。偶尔运行它以确保您正在跟踪您关心的所有资源。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-06-19T13:55:51.893

查找要添加的文件的更简单方法：

```
svn status | grep "^\?" | awk {'print $2'} 
```

它的好处是使用 svn 客户端来确定要添加的内容——新的、不可忽略的文件——因此更安全、更快捷。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-19T15:27:18.137

所以你没有在提交之前审查你的差异吗？啧啧啧。

您可以`svn st`在每次提交之前执行一次，并[在](http://en.wikipedia.org/wiki/Visual_inspection#Humorous_terminology)第一列中添加“？”。只要你在做小的提交，这些应该不难捕捉。

或者，如果它是您环境中的一个选项，您可以使用像[TortoiseSVN](http://tortoisesvn.tigris.org/)这样的 GUI 工具来提交。在 Tortoise 中，未版本化的文件非常突出，可以从提交窗口中添加（通过右键单击并选择“添加”，或者只需选中复选框并单击“确定”）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:16:40.203

```
find . | grep -v ".svn" | grep -v "ignorepattern" | xargs svn add 
```

最好写成

```
find . -name .svn -prune -o ! -name '*ignorepattern*' -exec svn add {} + 
```

这排除了“ `.svn`”目录，但不排除名为（例如）“ `foo/svn-bar`”的文件，并且还处理文件名中的空格。

如果您没有 GNU findutils，这可能必须是

```
find . -name .svn -prune -o ! -name '*ignorepattern*' -print0 | xargs -0 svn add 
```

不过，我同意其他质疑此工作流程可取性的答案和评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-22T08:08:55.773

我也是一个命令行迷，我经常从命令行发出像*svn status*和*svn update*这样的命令，但是正如一些人在这里建议的那样，当涉及到提交时间时，我真的需要更多关于我将要提交的信息而不是什么命令行提供。当然，我可以使用*svn diff*，但它很难读取输出。

我建议在命令行之上使用一个不错的 GUI 客户端。一个通用的、跨平台的（基于 Java 的）例如[SmartSVN](https://www.smartsvn.com/)。我认为当涉及到提交更改时，GUI 是要走的路。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-06-19T14:24:04.550

切换到[Mercurial](http://www.selenic.com/mercurial/wiki/)（... 或 git 或 bazaar 或其他任何东西。我实际上是认真的）。

```
> hg addremove #adds files you added, removes the ones you've deleted. 
```

...而且 .hgignore 比一堆 svn ignore 属性更容易管理。

SVN 不是唯一的免费版本控制系统，您可能需要考虑切换。（[所有](http://openjdk.java.net/) [很酷](http://www.mozilla.org/)[的](http://www.python.org/) [孩子](http://www.gnome.org/)[都](http://rubyonrails.org/)[在这样做](http://www.ubuntu.com/)[。](http://kernel.org/)）

# php - 如何从 PHP 目录中获取 X 个最新文件？

> ID：1018080
> 
> 赞同：6
> 
> 时间：2009-06-19T13:54:07.200
> 
> 标签：php, file

下面的代码是从给定目录中获取 5 个图像文件的函数的一部分。

目前 readdir 根据[规范](http://us3.php.net/manual/en/function.readdir.php)“按照文件系统存储它们的顺序”返回图像。

我的问题是，如何修改它以获得最新的 5 张图像？基于`last_modified`日期或文件名（看起来像 0000009-16-5-2009.png、0000012-17-5-2009.png 等）。

```
if ( $handle = opendir($absolute_dir) )
{
    $i = 0;
    $image_array = array();

    while ( count($image_array) < 5 && ( ($file = readdir($handle)) !== false) )
    {
        if ( $file != "." && $file != ".." && $file != ".svn" && $file != 'img' ) 
        {
            $image_array[$i]['url'] = $relative_dir . $file;
            $image_array[$i]['last_modified'] = date ("F d Y H:i:s", filemtime($absolute_dir . '/' . $file));
        }

        $i++;
    }
    closedir($handle);
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-19T14:02:02.163

如果您想完全在 PHP 中执行此操作，您必须找到所有文件及其最后修改时间：

```
$images = array();
foreach (scandir($folder) as $node) {
    $nodePath = $folder . DIRECTORY_SEPARATOR . $node;
    if (is_dir($nodePath)) continue;
    $images[$nodePath] = filemtime($nodePath);
}
arsort($images);
$newest = array_slice($images, 0, 5); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-21T09:31:47.297

如果你真的只对图片感兴趣，你可以使用[glob()](http://www.php.net/manual/en/function.glob.php)而不是 soulmerge 的 scandir：

```
$images = array();
foreach (glob("*.{png,jpg,jpeg}", GLOB_BRACE) as $filename) {
    $images[$filename] = filemtime($filename);
}
arsort($images);
$newest = array_slice($images, 0, 5); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-23T02:13:08.340

或者您可以为指定文件夹中的最新 5 个文件创建函数。

```
private function getlatestfivefiles() {
    $files = array();
    foreach (glob("application/reports/*.*", GLOB_BRACE) as $filename) {
        $files[$filename] = filemtime($filename);
    }
    arsort($files);

    $newest = array_slice($files, 0, 5);
    return $newest;  
} 
```

顺便说一句，我使用 CI 框架。干杯！

# c# - 从.net逐行更新db2中的表

> ID：1018092
> 
> 赞同：0
> 
> 时间：2009-06-19T13:55:58.977
> 
> 标签：c#, .net-2.0, odbc, db2

我在 C# 项目中对从 db2 数据库中逐行检索的表执行一些操作。但是当我尝试使用以下语句将游标逐行更新到数据库时，会生成异常：

```
selectCommand.CommandText = "DECLARE crsr1 CURSOR FOR select * from " + tableName+" ;" 
```

据我了解，.net 语言不支持使用 db2 的游标语句。我使用 IBM DB2 ODBC 驱动程序连接到数据库。

是否有任何方法可以使用 cursors ，或者是否有人可以判断我在这里是否缺少某些东西。

我在网上做了很多搜索，但在这个问题上没有多少可用的。

这是我对上述声明的例外——

```
"ERROR [42601] [IBM][CLI Driver][DB2/NT] SQL0104N  An unexpected token \"DECLARE CRSR1 CURSOR FOR select * from MYTA\" was found following \"BEGIN-OF-STATEMENT\".  
Expected tokens may include:  \"<space>\".  SQLSTATE=42601\r\n" 
```

非常感谢任何帮助或建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-18T07:55:26.423

我认为您可能希望将其放入 proc - 您通常不会在 Stored proc 之外执行“声明光标..”{除非您在 CLI 或其他东西中进行调试}

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-12-04T09:35:30.753

您应该只将“SELECT”部分放在命令文本中，并使用DB2Command 的[ExecuteResultSet方法返回一个包含可滚动可更新游标的结果集。](http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.swg.im.dbclient.adonet.ref.doc/doc/DB2CommandClassExecuteResultSetMethod2.html)

```
selectCommand.CommandText = "select * from " + tableName+" ;"
using(var result = selectCommand.ExecuteResultSet(DB2ResultSetOptions.Updatable))
{
   while (result.Read())
   {
       //set value of 2nd column to 'Hello'
       result.SetString(1, "Hello");
   }
} 
```

# asp.net-mvc - Subsonic 3.0 对生产使用安全吗？

> ID：1018095
> 
> 赞同：1
> 
> 时间：2009-06-19T13:56:10.990
> 
> 标签：asp.net-mvc, subsonic, subsonic3, production

我有兴趣使用 Subsonic 3.0 开发一个新的 ASP.Net MVC 应用程序，该应用程序将很快投入生产使用。这会是一个可行的选择吗？有人知道 3.0 什么时候发布吗？有其他人在生产 MVC 应用程序上使用它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-22T18:45:53.620

我到了那里 - 我们正处于清理阶段，我很高兴地说 Eric 重新加入了战斗:)。前几天我进行了性能测试并修复了一些瓶颈，核心几乎是我们想要的。

不知道什么时候准备好...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:14:14.120

我还没有在生产站点上使用它，虽然我正在用它构建一个未来的生产站点，但它是一个爱好项目，所以如果 DAL 有错误，我不会被解雇，SS4 可能会在我的爱好之前出现项目。

到目前为止，我还没有遇到任何阻碍或实际上任何错误，在过去，我发现如果你确实发现问题，Rob 非常适合快速获得补丁。所以我想回答你的问题，它可能还没有“准备好生产”，但在玩弄它时，我觉得它非常可靠，并选择了它而不是 LINQtoSQL 或实体框架。我建议以这种方式隔离您的 DAL（IRepository），如果您遇到 SS 的问题，您可以相当快地换掉其他东西。

至于什么时候准备好——我会让 Rob 插话。我认为他正在使用它来构建其他一些应用程序，所以他有点用它来测试 SS3 - 我猜这还需要几个月的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-30T05:14:59.273

我认为对我来说唯一的阻碍是它不能以中等信任度运行。

虽然对于我们从事的几乎所有项目来说，这都不是问题，因为它是快速“启动”网站的专用环境，亚音速真的很适合这很糟糕，因为这意味着共享主机是不可能的...... :(

但是 subsonic 2.0 非常适合，即使它缺乏 linq 支持。

ps 我知道他们正在做这个:)

# sql - 在 :select 中使用 AS 加入 ActiveRecord

> ID：1018107
> 
> 赞同：1
> 
> 时间：2009-06-19T13:59:05.727
> 
> 标签：sql, ruby-on-rails, activerecord

我正在尝试这样做

```
Version.find(:all, :joins=>"JOIN editions ON versions.edition_id=editions.id JOIN products ON editions.product_id=products.id", :select=>"products.name, versions.name AS what") 
```

但是 ActiveRecord 不尊重 AS 关键字……有什么想法吗？

**编辑：**由于这两个字段都被称为“名称”，它们正在发生冲突，所以我只得到列表中的最后一个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:57:44.750

从查询：

产品has_many editions（这里只说明关系）

版本 has_many 版本

```
foo = Version.find(:all, :joins=>"JOIN editions ON versions.edition_id=editions.id JOIN products ON editions.product_id=products.id", :select=>"products.name, versions.name AS what")
puts foo.inspect 
```

> 这应该给你一个值：
> 
> `[#<Version name: "foobar1">, #<Version name: "foobar2">]`

```
foo[0].what # Will print the value of 'what' returned by the query 
```

当我编写类似的查询时，类似的层次结构给了我完美的结果。如果遇到错误，您想共享堆栈跟踪吗？

编辑： foo[0].attributes 将打印 {"name" => "foobar1", "what" => ""} 抱歉这里的错字。我的意思是说属性。

# python - 每个站点一个 django 安装不同的用户

> ID：1018111
> 
> 赞同：0
> 
> 时间：2009-06-19T13:59:32.883
> 
> 标签：python, django, authentication, django-models

如何使用 django 为不同的站点拥有不同的用户。我的应用程序应如下所示：

```
a.mydomain.com
b.otherdomain.com 
```

用户应该与域绑定，以便 a.mydomain.com 和 b.otherdomain.com 拥有不同的用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:20:43.030

在[身份验证](http://docs.djangoproject.com/en/dev/topics/auth/)设置中，您可以创建单独的自定义权限，每个域一个，并检查当前用户是否具有当前域的权限 - 请参阅相关身份验证文档中的“自定义权限”部分。

# sql-server - 关于 SQL Server Compact Edition 3.5 的基本问题

> ID：1018117
> 
> 赞同：2
> 
> 时间：2009-06-19T14:01:14.597
> 
> 标签：sql-server

1) SSCE (SQL Server Compact Edition) 是仅限本地的数据库吗？意思是我不能从主机以外的任何地方访问它？

2）本地最多支持256个连接？

3) 是否有任何好的工具可用于将没有存储过程或触发器的空 mdf 转换为 CE sdf？

4）当您为此运行安装时，它是否打开了任何端口？我不这么认为，但我的老板相信它确实如此。

5) SQL Server Management Studio 在安装时是否默认打开任何端口？

感谢您的阅读以及您可以提供的任何见解:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:09:55.343

1.  是的。它是本地唯一的数据库，不能从其他机器访问
2.  不确定，我从来没有达到限制，但我知道文件大小有 4GB 限制
3.  没有我知道的
4.  同样，我不知道（至少我的软件和公司防火墙没有抱怨）
5.  再说一次，我不知道。Management Studio 本身不是 DBMS 包（它确实需要打开一些端口）。也就是说，我从来没有尝试在没有 SQL DEVELOPER 或 SQL EXPRESS 的情况下安装 Management STudio。

请注意：我回答了关于尝试将 SSCE 用作辅助计算机连接到的服务器的概念的问题 #1，而不是从共享驱动器安装数据库文件。例如，在 SQL Express 中，我可以将一个实例放在服务器上，并让多个应用程序连接到它，我还可以将与数据库关联的文件从共享驱动器挂载到我的本地 SQL Express 实例中。在 SSCE 中，可以挂载文件，但不能充当服务器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T14:11:24.187

1.  数据库文件（通常是 sdf）可以很高兴地位于远程共享上，但一次只有一台远程计算机可以访问它。
2.  它支持[256](http://msdn.microsoft.com/en-us/library/aa983341(VS.80).aspx)个可以来自不同进程的连接。
3.  不知道抱歉 - 我已经使用[这个项目](http://www.codeproject.com/KB/database/SqlCompactCoptUtility.aspx)进行了一些小的编辑，以便有效地从 sql server 复制。
4.  从包*安装*时，它可能会尝试 ping Windows 更新服务以进行最新检查（我尚未检查）当通过 xcopy 部署运行时我看不到打开端口（您不需要安装 SqlServerCE，只需将您的私有 bin 路径（通常与可执行文件相同的文件夹）中所需的 dll 就足够了。
5.  我不知道

至于开放端口，最好的检查方法是简单地使用运行wireshark之​​类的东西进行安装。

# hibernate - 如何在 Hibernate 中映射一组对象而没有同名主键？

> ID：1018122
> 
> 赞同：0
> 
> 时间：2009-06-19T14:03:26.077
> 
> 标签：hibernate, properties, one-to-many, no-match

我有一个代表表的域对象类。这个类与另一个表有关联，但源类的属性与目标类的属性命名不同，我不知道如何休眠映射它。

这是具有集合的类的示例（一个 CT 到多个 R 实例）：

```
public class CT {
    // This is the property in the property-ref down below
    private String b;

    // The set of Rs I want to get - there may be none that correspond to a CT instance.
    private Set rs;
}

public class R {
    // This property is mapped to the column name below.
    private String rBc;
}

<!--Snippet of the mapping for class CT-->

 <set name="rs" lazy="true" sort="MyComparator" table="R" >
      <key column="R_COLUMN_NAME_THAT_REPRESENTS_THE_RELATIONSHIP" property-ref="b" />
      <one-to-many class="CLASS_THAT_R_IS" />
 </set> 
```

Hibernate 接受这个映射，但是当我从我知道应该存在的 CT 实例中提取 Rs 集时，我只得到一个空的 PersistentSet。

请注意，对于每个 CT 实例，完全有可能没有或超过一个 R。这就是为什么我在那里有比较器的原因——我无法弄清楚如何在没有显式 SQL 的情况下轻松地告诉 Hibernate 如何执行 ORDER BY 子句（我犹豫要不要在 Hibernate 映射中编写它。

有人可以帮我吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T19:02:39.330

问题可能出`table="R"`在`<set ..>`映射中。这告诉 hibernate 使用连接表而不是直接在子表中查找外键。从命名我了解到您没有使用连接表。那是对的吗？

# java - 重用 PreparedStatement

> ID：1018123
> 
> 赞同：4
> 
> 时间：2009-06-19T14:03:36.060
> 
> 标签：java, prepared-statement, findbugs

我在我们的代码库上运行了 findbugs，它指出还有两个语句需要关闭。在这部分代码中，我们运行：

```
preparedStatement = connection.prepareStatement(query); 
```

对于 3 个不同的查询，重用preparedStatement。在 finally 块中，我们确实关闭了资源：

```
finally{
   try{
      if (resultSet != null) 
         resultSet.close();
   } catch (Exception e) {
      exceptionHandler.ignore(e);
   }
   try {
      if (preparedStatement != null) 
         preparedStatement.close();
   } catch(Exception e) {
      exceptionHandler.ignore(e);
   } 
```

该语句是否应该在下一个 connection.prepareStatement(query) 之前关闭 还是这个 findbugs 很谨慎？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-19T14:08:24.333

是的，在执行下一个 connection.prepareStatement 之前必须关闭该语句。否则，您将失去对未关闭的前一个（又名泄漏声明）的引用。将 try {} finally {} 包裹在每个语句的使用中，并在 finally 中关闭它。

# css - IE7：如何让TD浮动？

> ID：1018125
> 
> 赞同：3
> 
> 时间：2009-06-19T14:03:53.127
> 
> 标签：css, internet-explorer-7

我想要一组`<td>`s 在 IE7 中向左浮动。如果窗口太小，它们应该跳到下一行。

CSS

```
table {
  width: 100%;
}
td {
  border: 1px solid red;
}
tr.f td {
  width: 500px;
  float: left;
} 
```

HTML：

```
<table>
  <tr class="f">
    <td>1</td>
    <td>2</td>
    <td>3</td>
  </tr>
</table> 
```

这适用于 IE8 和 Firefox，但不适用于 IE7。我究竟做错了什么？

页面呈现模式为“IE7（Quirks）”或“IE7（标准）”。不过，我正在尝试使用 IE8，相信 IE7 呈现模式就是它所说的。“IE8 兼容性视图”也失败了，只有“IE8 标准”才能正确。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T15:28:17.963

我不认为这是你想要的方式。

当您将浮动应用于 td 元素 [在 FF/IE8[ 中] 时，它们会根据 CSS 2.1 规范成为匿名表格对象。本质上，它们不再是表格单元格，并且这些匿名对象具有可浮动的显示类型。

IE7不遵循这部分规范，实际上，单元格的显示类型根本不能改变，显示类型为table-cell的对象不能浮动。

如果您绝对需要使用表格（而不是 ul/li），您可以这样做吗？

```
<style type="text/css" media="screen">`
    table {
        width: 100%;
    }
    .f {
        border: 1px solid red;
        float: left;
        height: 10px;
        width: 500px;
    }
</style>

<table summary="yes">
    <tr><td>
    <span class="f">1</span>
    <span class="f">2</span>
    <span class="f">3</span>
  </td></tr>
</table> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:10:12.443

我的最佳猜测：IE7 及以下版本具有更严格的表格模型，并且不允许您更改表格元素的流程。

# opengl - 带有 Dev-C++ 和 SDL 的 OpenGL v2.0 着色器？

> ID：1018126
> 
> 赞同：7
> 
> 时间：2009-06-19T14:03:57.993
> 
> 标签：opengl, sdl, shader, dev-c++

我正要在 Windows 下用 Dev-C++ 重建我的库；但是，不支持我在此期间添加的着色器功能，编译器找不到相关函数（::glCreateShader()、::glCreateProgram() 等）

在互联网和 Dev-C++ 文件夹中挖掘，我发现 OpenGL 实现（gl.h）只有 v1.1。我找到了从[SGI下载最新标头的](http://oss.sgi.com/projects/ogl-sample/registry/)[建议](http://www.gamedev.net/community/forums/topic.asp?topic_id=358499)。我找到了 gl3.h，但是，经过仔细审查后，我意识到 gl.h 无论如何都不包含在我的项目中，我应该查看 SDL/SDL_opengl.h。

**编辑：** SDL_opengl.h*确实*包含 gl.h*并*声明了相关函数的原型。所以问题是，为什么我给出的是编译时错误而不是链接器错误？

（我的库只链接到 mingw32、libOpenGL32、libSDL、libSDL_Image 和 libSDL_Mixer，就像在 OSX 下（当然，mingw32 除外）我没有任何问题。）

如何在 Dev-C++ 和 SDL 中使用 OpenGL v2.0 着色器？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T15:36:30.850

gl.h 仅适用于 OpenGL 1.1（在某些情况下最高 1.3，具体取决于您使用的文件版本和操作系统）。对于其他所有内容，您还需要[glext.h](http://www.opengl.org/registry/api/glext.h)和可能[的 glxext.h](http://www.opengl.org/registry/api/glxext.h) (Linux/Unix) 或[wgext.h](http://www.opengl.org/registry/api/wglext.h) (Windows)。

来自较新版本 OpenGL 的所有函数必须在运行时链接。因此，为了使用它们，您必须获得正确的函数地址并将其分配给函数指针。最简单的方法是使用[GLEW 之](http://glew.sourceforge.net/)类的东西。

手动方式将是这样的：

```
PFNGLCREATESHADERPROC glCreateShader = NULL;
glCreateShader = (PFNGLCREATESHADERPROC) wglGetProcAddress("glCreateShader"); 
```

或者对于 Linux：

```
PFNGLCREATESHADERPROC glCreateShader = NULL;
glCreateShader = (PFNGLCREATESHADERPROC) glXGetProcAddress((GLubyte*) "glCreateShader"); 
```

如果你在包含 glext.h 之前定义了 GL_GLEXT_PROTOTYPES 你可以省略第一行。

**编辑：** SDL_opengl.h 看起来它包含 glext.h 的副本（虽然不是最新的）。因此，如果您使用它，上述内容应该仍然有效。如果您想使用单独的 glext.h，您必须在包含 SDL_opengl.h 之前定义 NO_SDL_GLEXT。此外，只要未定义 GL_GLEXT_PROTOTYPES 或您自己编写函数原型，它们就无法使用。

**EDIT2：**显然 SDL 有自己的 GetProcAddress 函数，称为[SDL_GL_GetProcAddress](http://sdl.beuc.net/sdl.wiki/SDL_GL_GetProcAddress)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:29:31.203

你可以在运行时加载函数的地址吗？

```
typedef GLhandle (APIENTRYP PFNGLCREATESHADERPROC) (GLenum shaderType);
PFNGLCREATESHADERPROC glCreateShader = NULL;
glCreateShader = (PFNGLCREATESHADERPROC)wglGetProcAddress("glCreateShader");

typedef GLhandle (APIENTRYP PFNGLCREATEPROGRAMPROC) ();
PFNGLCREATEPROGRAMPROC glCreateProgram = NULL;
glCreateProgram = (PFNGLCREATEPROGRAMPROC)wglGetProcAddress("glCreateProgram"); 
```

# java - 在 Java 中将多个图像上传到面板上

> ID：1018129
> 
> 赞同：0
> 
> 时间：2009-06-19T14:04:16.150
> 
> 标签：java, image, upload

我正在尝试将多张图片上传到面板上，但我不知道该怎么做。我可以上传一张图片，但一次不能超过一张。实际上，我需要这些知识来使我最近设计的一个简单的纸牌游戏看起来更真实。

谁能帮我吗。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:07:19.750

听起来您需要设置布局，添加布局管理器，并在面板内的某些面板中插入插槽。

这样，您可以将图像添加到每个子面板，并根据布局管理器排列它们。

# .net - .NET：如何在不打开文件的情况下打印文件

> ID：1018137
> 
> 赞同：7
> 
> 时间：2009-06-19T14:06:21.420
> 
> 标签：.net, file, printing

我们有一个基本上归档文件的应用程序，我们让用户可以打印这些文件。它们可以是 .txt、.doc、.pdf、.jpg，没什么特别的。是否有.NET 方式将这些文件发送到打印机而不进一步处理它们，即打开它们？

我已经尝试使用 StartInfo.Verb = "print" 创建一个进程

```
Process p = new Process();
p.StartInfo.UseShellExecute = false;
p.StartInfo.CreateNoWindow = true;
p.StartInfo.FileName = fileName;
p.StartInfo.Verb = "print"
p.StartInfo.WindowStyle = ProcessWindowStyle.Hidden

p.Start(); 
```

它仍然会打开我不想要的文件。有人可以帮忙吗？

任何帮助，将不胜感激。托比

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-19T14:14:55.210

我的理解是，大多数应用程序会在您打印时打开（甚至是短暂的）。尝试右键单击 MS Word 文档并点击打印。您将看到 Word 打开、打印和关闭。

但是，您可能希望将其添加到您的代码中以保持进程隐藏并在完成时关闭：

```
p.Start();
p.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
if (p.HasExited == false)
{
   p.WaitForExit(10000);
}

p.EnableRaisingEvents = true;
p.CloseMainWindow();
p.Close(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T14:41:48.260

这实际上非常非常容易。

使用[System.Drawing.Printing.PrintDocument](http://msdn.microsoft.com/en-us/library/system.drawing.printing.printdocument(VS.80).aspx)。

按照该链接中的示例进行操作，或者仅使用此处的代码（我摘自我每天都在使用的打印自动化操作）。

例如，打印 .jpg（顺便说一句，这不会打开任何编辑应用程序；它会在后台假脱机到打印机）

```
public void SetupPrintHandler()
{
    PrintDocument printDoc = new PrintDocument();
    printDoc.PrintPage += new PrintPageEventHandler(OnPrintPage);

    printDoc.Print();
}

private void OnPrintPage(object sender, PrintPageEventArgs args)
{
    using (Image image = Image.FromFile(@"C:\file.jpg"))
    {
        Graphics g = args.Graphics;
        g.DrawImage(image, 0, 0);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:09:32.757

您如何建议 Windows 设法打印文件而不将其发送到知道如何处理它的应用程序？

我认为没有办法做到这一点，仅仅是因为 Windows 不知道 a`pdf`是什么（或 a `doc`，甚至 a `jpg`）。

恐怕您会被您所拥有的东西所困扰，或者为您希望打印的每种格式在您的应用程序中包含一个库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T14:18:18.277

这是一个无需打开 Word 并显示文档即可打印 Word 文档的类。虽然我通常用 C# 编写代码，但我很久以前就知道，用除 VB.NET 之外的任何东西编写任何 Office 自动化代码都是非常愚蠢的（C# 4.0 中即将推出的一些特性可能会改变这一点）。

这仅适用于 Word，但 Excel 文档将以类似的方式完成。对于文本文档，您可以很容易地使用 System.Drawing.Printing 东西。

```
Imports System.IO 
Imports System.Windows.Forms 
Imports System.Drawing

Namespace rp.OfficeHelpers

    Public Enum PrintStatus
        Success
        FileNotFound
        FailedToOpenDocument
        FailedToPrintDocument
    End Enum

    Public Class Word

        Public Shared Function PrintDocument( DocumentName As String,_ 
                               PrinterName As String ) As PrintStatus 
            Dim wordApp As Microsoft.Office.Interop.Word.Application = _ 
                           new Microsoft.Office.Interop.Word.Application()
            Dim wordDoc As Microsoft.Office.Interop.Word.Document
            Dim copies  As Object = 1
            Dim CurrentPrinter As String = wordApp.ActivePrinter

            If ( Not File.Exists( DocumentName ) )
                Return PrintStatus.FileNotFound    
            End If

            wordApp.Visible = false

            wordApp.ActivePrinter = PrinterName

            ' Document name must be provided as an object, not a string.
            Try 
                wordDoc = wordApp.Documents.Open( CType( DocumentName, Object ) )
            Catch WordError as System.Exception 
                Return PrintStatus.FailedToOpenDocument
            End Try  

            Try 
                wordDoc.PrintOut( Copies := copies, Background:= false )
            Catch WordError as System.Exception 
                Return PrintStatus.FailedToPrintDocument
            End Try  

            wordApp.ActivePrinter = CurrentPrinter

            wordApp.Quit( SaveChanges := false )

            Return PrintStatus.Success        
        End Function

    End Class

End Namespace 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T18:18:14.490

我必须同意其他答案，因为如果不打开它就无法打印。

我认为您可能能够解决此问题的唯一方法是，如果您有一个直接的 postscript 文件，以及一个直接连接的 postscript 兼容打印机。

在这种情况下，您只需将 .ps 文件转储到 LPT 端口，打印机就会正确处理它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-16T13:23:31.383

某些打印机支持使用命令行向打印机发送文件`LPR`。我们有一台复印机可以做到这一点。这确实根本不会打开计算机上的文件。它将文件发送到打印机，打印机对其进行解释并打印。

```
LPR -S <Server Name> -P <Printer Name> -o l "C:\Temp\Sample.PDF" 
```

我们使用 PostScript 和 PDF 文件取得了巨大成功。不知道它是否适用于其他文件类型；检查打印机文档。

对于最新版本的 Windows，您需要启用“LPR 端口监视器”。控制面板 > 程序和功能 > 打开或关闭 Windows 功能 > 打印和文档服务/LPR 端口监视器

[TechNet LPR 命令行](https://technet.microsoft.com/en-us/library/cc731926.aspx)

# firefox - XUL 事件：新页面加载/获取页面内容

> ID：1018138
> 
> 赞同：2
> 
> 时间：2009-06-19T14:06:39.127
> 
> 标签：firefox, xul

当“页面开始在浏览器中加载”时如何捕捉事件？

如何访问 HTML 并使用 XUL 操作它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-29T19:49:14.243

我有同样的问题。我找到了文档，但无法让代码在 Firefox 3.6.12 中运行。我做了一些改变并设法让它工作：

```
this._loadHandler = function(event) {

var myDomain = 'www.yahoo.com';

let doc = event.originalTarget;
//alert(doc.defaultView.location.href);
if (doc instanceof HTMLDocument) {

    var re = new RegExp(myDomain);
    if (doc.defaultView.location.href.match(re)) {
        alert("Successful match");
    }

}};

gBrowser.addEventListener("load", this._loadHandler, true); 
```

这是从这里的示例修改的：[https ://developer.mozilla.org/en/XUL_School/Intercepting_Page_Loads](https://developer.mozilla.org/en/XUL_School/Intercepting_Page_Loads)

高温高压

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-16T00:29:47.390

这基本上取自 Mozilla 网站

```
window.addEventListener("load", function() { myExtension.init(); }, false);

var myExtension = {

    init: function() {
    var appcontent = document.getElementById("appcontent");  
    if(appcontent)
        appcontent.addEventListener("DOMContentLoaded", myExtension.onPageLoad, true);  
    },

    onPageLoad: function(event) {
        var doc = event.originalTarget;
        var myDiv = doc.getElementById("myDiv");
        //do something interesting with it
    }
} 
```

玩得开心

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T19:05:17.877

在 Mozilla 的网站上已经有大量[用于此任务的文档和示例代码。](https://developer.mozilla.org/en/Code_snippets/Progress_Listeners)不过，您的问题很模糊，因此我可能将您链接到错误的页面。

# lucene.net - 如何在 nhibernate.search 查询中使字段名称大小写

> ID：1018139
> 
> 赞同：1
> 
> 时间：2009-06-19T14:07:16.240
> 
> 标签：lucene.net, nhibernate.search

我想让我的查询案例中的字段名称具有吸引力，以便在用户进行查询时

```
title:Jurassic 
```

或者

```
Title:Jurassic 
```

NHibernate Search 将产生相同的结果。

据我了解，Lucene 的工作方式字段名称区分大小写。有没有办法将 NH Search/Lucene 配置为在索引时将字段名称小写，在搜索时将字段名称小写？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-21T05:33:36.963

字段名称区分大小写。一种方法是将您的所有字段指定为完全小写，然后将您的查询小写。

类示例：

```
[Indexed]
class Article
{
     [Field(Name="title", Index=Index.Tokenized, Store=Store.No)]
     Title { get; set; }
} 
```

查询示例

```
string query = tbSearch.Text;
query = query.ToLower();
IFullTextQuery ftq = search.CreateFullTextQuery(query); 
```

# php - 正确设计 MVC 项目

> ID：1018153
> 
> 赞同：7
> 
> 时间：2009-06-19T14:09:18.870
> 
> 标签：php, design-patterns, model-view-controller, kohana

我已经使用 Kohana 几个月了，对于组织代码/演示文稿/db-layer 的 MVC 风格仍然相对较新。不幸的是，虽然有很多关于如何创建控制器、建立视图以及通过模型与数据库交互的文档，但我还没有找到很多处理干净和建议的开发模式的资源。

让我举一个简单的例子：

我的最新项目有一个控制器，因为我不确定我是否应该制作更多……或者何时应该制作一个新的。我如何准确地确定何时需要新控制器以及何时需要新模型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-20T10:04:11.720

我建议你先看看[面向资源的架构](http://en.wikipedia.org/wiki/Resource_oriented_architecture)。这不会为您提供有关如何组织代码的任何直接指导。但是，在考虑资源时，在决定是否创建新控制器时会更容易。一旦您设法识别系统中的资源，为它创建一个模型和一个控制器通常是一件好事——尽管这只是一个经验法则。

一些额外的点：

*   寻找资源并为每个资源创建一个模型和一个控制器（经验法则）
*   不要害怕为不持久的资源创建模型
*   将控制器视为将用户“连接”到业务域的“管道”或“接线”——它们的作用是处理用户请求并将答案转发给他们——使它们尽可能薄

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:34:44.047

规则拇指如下：当我识别出我的应用程序的一种新的“项目”时。需要管理，我问自己这些问题：

(1) 这类项目应该是持久性的吗？

(2) 这个项目会有很多实例吗？

如果这两个问题的答案都是肯定的，我得出结论，所述项目应该是一个模型（或模型元素或域类，取决于您的 MVC 框架的术语）。当我定义一个新的模型元素时，我还为它定义了一个控制器，它将支持四种基本操作：创建、检索、更新、删除（您的框架可能会为您生成一个默认控制器）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T19:52:09.373

您可能想要获得 Martin Fowler 的“企业应用程序架构模式”的副本。Web 演示部分广泛讨论了如何在使用前端控制器驱动的框架时构建代码，就像当前的任何 MVC 框架浪潮一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-22T11:49:53.080

我喜欢具有明确定义的功能或一组功能的小型控制器。这通常意味着每个页面（或一组类似页面）一个控制器。在我的 Kohana 站点[CSSMySite](http://cssmysite.com/)中，我有 about、blog、contact、css 和 post 控制器。

关于控制器所做的只是设置模板。博客控制器与博客模型交互以列出数据库中的多个帖子。帖子控制器与博客模型交互以显示数据库中的一篇帖子。

每当我有持久的数据（博客文章）或多次使用（下拉框的状态列表）时，它都会进入模型。模型可以被不同的控制器访问，因此它不必是模型到控制器的一对一映射。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-19T20:19:30.307

也许学习好的 MVC 编程的一个好方法是花一些时间在 Ruby-on-Rails 上。不久前我开始使用 Rails，作为间接结果，我相信我现在对 MVC 有了很好的理解。我将 Rails 视为 MVC 的缩影。至少，这可能是一种学习 MVC 的有趣方式……你会怎么想？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-22T02:44:47.280

这是我在 Kohana 应用程序中所做的一个示例。

我需要一个“最新消息”部分，所以我设置了一个名为“新闻”的控制器、模型和视图。

我的新闻控制器有方法`index()`，`feed()`和`media_releases()`。

我的模型由数据库查询组成，这些查询从 MySQL 数据库中获取我的新闻数据。

我的观点只是很多 HTML 和一些`<?php echo $title; ?>`类似的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-22T02:57:13.963

您是否有理由不能定义一个通用系统，该系统可以在全球范围内利用数据库元数据？在我看来，通常编写任何代码来访问和显示简单数据都是不必要的冗余。

# core-data - 我需要做什么才能让 Core Data 自动迁移模型？

> ID：1018155
> 
> 赞同：96
> 
> 时间：2009-06-19T14:09:45.767
> 
> 标签：core-data

我已阅读有关 Core Data 模型的自动/轻量级迁移的文档 - 但我在实现它时遇到了问题。

据我了解，应用程序应该注意到它拥有的模型和设备上已经存在的模型是不一样的。如果您只添加了属性或关系以及类似的简单更改，则应自动升级模型。

任何指针 - 我需要在 Xcode 中设置一些东西吗？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2009-06-19T14:47:53.473

我现在发现这很简单——一旦你知道去哪里看。

在我的 AppDelegate 中，我设置了 NSPersistentStoreCoordinator - 您需要为此添加一些选项来告诉它处理自动迁移：

```
NSDictionary *options = [NSDictionary dictionaryWithObjectsAndKeys:

[NSNumber numberWithBool:YES], NSMigratePersistentStoresAutomaticallyOption,

[NSNumber numberWithBool:YES], NSInferMappingModelAutomaticallyOption, nil];

NSError *error;
_persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel: [self managedObjectModel]];

if (![_persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeUrl options:options error:&error]) {
    // Handle error
    NSLog(@"Problem with PersistentStoreCoordinator: %@",error);
} 
```

然后你需要在 xCode 中做一个小技巧：

1.  选择您的 xcdatamodel 文件
2.  选择顶部的设计菜单 - 然后选择数据模型 - 然后选择添加模型版本
3.  然后，您的 xcdatamodel 文件将被移动到与您的 xcdatamodel 文件同名但扩展名为 xcdatamodeld 的新目录中 - 此目录中将有第二个文件，名称中包含 2。选择新文件，然后选择 Design->Data Model->Set Current Version（[在 Xcode 4 中你可以这样做](https://stackoverflow.com/questions/5372479/xcode-4-core-data-model-version-set-current-version)）
4.  如果您已经进行了导致项目不兼容的更改 - 将这些更改从原始 xcdatamodel 文件中删除。如果您还没有进行更改 - 那么只需编辑 2.xcdatamodel 文件（您刚刚制作的当前版本）。
5.  现在，当您将此版本安装到具有旧型号的设备上时 - 它会自动将该型号升级到新型号。

这看起来很棒而且很简单 - 但我认为在开发过程中更改模型时需要小心 - 否则您将不得不为每次更改创建一个新版本。

我想我要做的是保留所有更改的文件，然后一旦我准备好部署我的更新，我将删除所有中间文件，只使用最旧和最新的模型进行部署。

* * *

更新（2011 年 7 月 15 日）：

感谢[@rockstarberlin](https://stackoverflow.com/users/623673/rockstarberlin)指出苹果有更新的文档：

[Xcode 4：设置托管对象模型的当前版本](http://developer.apple.com/library/mac/#recipes/xcode_help-core_data_modeling_tool/Articles/setting_current_version.html)

更新：2013 年 8 月 19 日更好的链接：

[https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreDataVersioning/Articles/vmModelFormat.html](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreDataVersioning/Articles/vmModelFormat.html)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-08-02T21:34:36.550

这非常有帮助。苹果的文档——像往常一样——非常不完整。我建议进行干净的构建，因为在进行这些更改后第一次运行时遇到错误“无法将模型与两个不同的实体 xxx 合并”。干净的构建修复了它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-07-01T17:55:22.460

Grouchal 的回答是完美的……但是如果您在多次清理构建之后仍然遇到“无法将模型与两个不同的实体 xxx 合并”……您可能对 managedObjectModel 的加载方式有疑问。 .看看这个...帮助我修复它..

[核心数据迁移问题](http://iphonedevelopment.blogspot.com/2009/09/core-data-migration-problems.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-15T23:26:36.687

另外，如果您像我一样偶然发现了这篇文章，在收到“用于打开商店的模型与用于创建商店的模型不兼容”错误之后，您只是在使用模拟器进行调试并希望完全替换安装旧模型，您可以重置模拟器应用程序或从模拟器中删除您的应用程序可能也可以。

直到阅读这里的帖子，我才想到尝试这个，此时我意识到我已经在模拟器中安装了应用程序，然后更改了模型，导致上述运行时错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-30T22:52:54.510

为了跟进 Santthosh 的回答，我想我会在此处发布代码片段。你需要创建你的 managedObjectModel `initWithContentsOfURL:`，`mergedModelFromBundles:`否则你会得到错误：

> 无法合并具有两个不同实体 XXX 和 XXX 的模型

如果您的模型文件名为“模型”，则创建 managedObjectModel 的方法如下：

```
NSString *path = [[NSBundle mainBundle] pathForResource:@"Model" ofType:@"momd"];
NSURL *momURL = [NSURL fileURLWithPath:path];
managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:momURL]; 
```

归功于[这篇博文](http://iphonedevelopment.blogspot.com/2009/09/core-data-migration-problems.html)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-14T12:48:38.100

Xcode 4 中的菜单发生了一些变化。这里有一个描述如何在 Xcode 4 中做到这一点：

[Xcode 4：设置托管对象模型的当前版本](http://developer.apple.com/library/mac/#recipes/xcode_help-core_data_modeling_tool/Articles/setting_current_version.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-02T21:55:23.973

我多年来一直有这个问题，我尝试了所有这些答案都无济于事。今天我终于弄清楚我做错了什么。非常简单的问题，但我忽略了它。创建更新版本的数据模型时，如果要添加列，请确保将它们标记为 OPTIONAL。如果不这样做，简单的迁移将不起作用，因为不会填写新的列值。

一旦我确保我的新列已选中“可选”，我再次尝试迁移并且它工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-01T23:03:29.667

由于另一个问题，我偶然发现了这篇文章，但错误是“**用于打开商店的模型配置与用于创建商店的模型配置不兼容。** ”

这是我的问题及其解决方案。在我的模型中，我使用了***配置***。我将一些实体存储在一个文件中，而将其他实体存储在第二个文件中。（我有一些可能需要定期下载的默认值，将它们合并到整体中会非常痛苦）。无论如何，我创建了一个新实体。该程序似乎运行良好，但每当我退出时，我都会收到上述错误。

解决方案是查看我的配置，意识到我有一个当前不在任何配置中的实体，然后将其添加到一个配置中。像梦一样奔跑。

这不会解决 OP 的问题。但也许一些通过谷歌登陆这里的沮丧的人会在我所在的船上:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-28T22:34:58.127

iOS 4.0+

```
NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"model" withExtension:@"momd"];
managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL]; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-17T22:27:03.560

对上面针对 Xcode 版本 5 的 @Grouchal 的精彩说明进行了少量编辑：

旧：2\. 选择顶部的设计菜单 - 然后选择数据模型 - 然后选择添加模型版本

版本 5+： 2\. 选择编辑器菜单，然后添加模型版本...，输入您的版本名称和基于模型（从列表中选择您的原始模型）

# iphone - iPhone 和 BlackBerry 共享库

> ID：1018158
> 
> 赞同：4
> 
> 时间：2009-06-19T14:10:18.247
> 
> 标签：iphone, objective-c, blackberry, mobile, java-me

我有一组功能（类），我想与我正在为 iPhone 和 Blackberry (Java) 构建的应用程序共享这些功能（类）。有没有人有这样做的最佳实践？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:20:51.423

据我了解您的问题，这是不可能的 - iPhone 和 Java 的二进制格式不兼容 - 甚至对于黑莓设备上的本机库也是如此。

这不像为 OS X 构建你可以使用 Java 不幸的是 iPhone 不支持 Java。

最好的想法可能是在 Objective-C 中构建您的库，然后将其移植到 Java，这比其他方式更容易过渡。如果您为 Objective-C 编程并确保您的代码没有内存泄漏 - 那么更改就不会那么复杂。

如果您保持类的结构相同，那么您应该会发现维护要简单得多 - 修复 Java 中的错误，并且您应该会发现在 ObjC 方法等中检查相同的错误很容易。

希望这会有所帮助 - 抱歉，这并非都是好消息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-19T14:49:39.290

正如 Grouchal 所提到的 - 您将无法在两个平台之间共享应用程序的任何物理组件。但是，如果您仔细地将应用程序分成高度解耦的层，您应该能够共享应用程序的逻辑设计。这仍然是一个巨大的胜利，因为逻辑应用程序设计可能占您开发工作的很大一部分。

您的目标可以是包装您在自己的接口中使用的平台特定 API（iPhone SDK 等）的部分。这样一来，您就可以有效地隐藏特定于平台的库，并使您的设计和代码在处理平台差异时更易于管理。

有了这个，您可以编写核心应用程序代码，使其在任一平台上看起来都非常相似——即使它们是用不同的语言编写的。我发现 Java 和 Objective-C 在概念上非常相似（至少在我使用它的级别上）并且希望能够至少在以下方面实现对等：

*   一组几乎相同的 Java 和 Objective-C 类，具有相同的名称和职责
*   具有类似名称方法的 Java/Objective-C 类
*   具有相同职责和逻辑实现的 Java/Objective-C 方法

仅此一项将使应用程序更易于跨平台理解。当然，代码在边缘总是看起来非常不同 - 即当您开始处理视图、线程、网络等时。然而，这些问题将由您的 API 包装器处理，一旦开发应该具有相当静态的接口。

如果您以后开发需要交付到这两个平台的更多应用程序，您也可能会受益，因为您可能会发现您可以重用或扩展您的 API 包装器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T15:01:37.423

如果您正在编写客户端-服务器类型的应用程序，您还应该尝试在服务器上保留尽可能多的逻辑。将设备上的额外业务逻辑量保持在最低限度。您越能将设备视为视图层，您需要做的移植工作就越少。

除此之外，在所有项目中遵循相同的命名约定和包结构有很大帮助，尤其是对于您的框架代码。

BlackBerry 和 iPhone 的 UI API 和可用性范例如此不同，以至于在大多数情况下，无法在应用程序之间直接移植这种逻辑。一个人可能犯的最大错误（在我看来）是尝试将专为一个移动平台设计的用户体验移植到另一个平台上。人们与黑莓和 iPhone 交互的方式非常不同，因此请准备好为您要部署的每个移动平台改进用户体验。

希望这会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-02T19:32:02.170

可以编写适用于 BB10 Native 应用程序和 iOS 应用程序的 C++ 代码。XCode 需要将 C++ 文件视为 ObjectiveCPP 代码。

我目前正在业余时间从事这样的任务。我还没有完成它足以证明或知道它是否真的可能，但我还没有遇到任何障碍。

您将需要自律地编写优秀的跨平台代码，并针对特定于平台的功能进行抽象设计。

我的一般模式是我有“class Foo”来做跨平台的东西，还有一个“class FooPlatform”来做平台特定的东西。“Foo”类可以调用“FooPlatform”类，它抽象出任何特定于平台的东西。

原始跨平台代码本身不可编译。在各自的 IDE 中创建单独的 BB10 和 XCode 项目。每个项目都实现了一个薄（几 [打] 行）“类 FooPlatform”并引用原始跨平台代码。

当我得到一些可以展示的东西时，我会在这里再次发布......

# svn - 使用 NAnt 删除 svn checkout

> ID：1018163
> 
> 赞同：3
> 
> 时间：2009-06-19T14:11:03.720
> 
> 标签：svn, nant

我正在尝试删除一个文件夹，该文件夹是我的项目的 svn 结帐，以便我可以重新结帐。问题是每当我尝试使用 nant 删除任务删除此文件夹时，我都会收到以下错误：

```
[delete] Deleting directory 'C:\projects\my_project\Trunk'.

BUILD FAILED

c:\Projects\my_project\default.build(63,4):
Cannot delete directory 'C:\projects\my_project\Trunk\SomeFolder\AnotherFolder'.
    The directory is not empty. 
```

有没有技巧在这里用 nant 删除工作副本？我尝试仅针对 .svn 目录进行删除，但由于某种原因，nant 不会删除所有这些目录。这是我为此使用的任务，但它不起作用：

```
 <delete>
        <fileset basedir="myproject\trunk">
            <include name="\**\.svn" />
        </fileset>
    </delete> 
```

任何想法将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T15:17:21.590

@jitter，你非常接近

首先没有dirset，尝试使用它时出现错误。这是实际工作的

```
<delete>
  <fileset basedir="myproject\trunk" defaultexcludes="false">
    <include name="**/.svn" />
    <include name="**/.svn/**/*" />
  </fileset>
</delete> 
```

如果您有正确的选择，文件集将包括目录。我认为关键是使用 d`efaultexcludes="false"`并使用

```
**/.svn/**/* 
```

正确选择 .svn 文件夹的子文件夹。

谢谢！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:45:10.763

如果要删除整个主干目录

```
<delete dir="myproject/trunk" /> 
```

我现在无法验证是否`<include ... />`能够选择目录而不是文件。

否则，如果您只想删除 .svn 目录

```
<delete>
    <dirset basedir="myproject\trunk" defaultexcludes="false">
        <include name="**/.svn" />
    </dirset>
</delete> 
```

我用过`dirset`，因为我不确定是否`fileset`甚至选择目录。也许它被解释为“给我所有名为*.svn*的文件”注意使用`defaultexcludes="false"`并在此处检查[`<fileset documentation>`](http://nant.sourceforge.net/release/latest/help/types/fileset.html)defaultexcludes 是什么（例如`**/.svn`，正是您试图包含的内容）

# asp.net - 如何将以下 GridView 内联样式转换为样式表的类？

> ID：1018167
> 
> 赞同：0
> 
> 时间：2009-06-19T14:13:27.413
> 
> 标签：asp.net, css, gridview

我相信 GridView 呈现为表格，那么如何使用类将以下 GridView 的内联样式转换为外部样式表？

```
<asp:GridView ID="gvQuotes" 
              runat="server" 
              BackColor="#DEBA84" BorderColor="#DEBA84" 
              BorderStyle="None" BorderWidth="1px" 
              CellPadding="3" CellSpacing="2" 
              GridLines="Both"
              Width="100%"
              ShowFooter="True">

<RowStyle BackColor="#FFF7E7" ForeColor="#8C4510" 
          HorizontalAlign="Center" />

<FooterStyle BackColor="#F7DFB5" ForeColor="#8C4510" />

<PagerStyle ForeColor="#8C4510" HorizontalAlign="Center" />

<SelectedRowStyle BackColor="#738A9C" Font-Bold="True" 
                  ForeColor="White" />

<HeaderStyle BackColor="#A55129" Font-Bold="True" 
             ForeColor="White" Font-Underline="true"
             HorizontalAlign="Center" />

</asp:GridView> 
```

例如，对于整个网格，我是否会执行以下操作并设置 CssClass="grid"

```
.grid
{
    background-color: #DEBA84;
    border-color:#DEBA84;
    width:100%;

} 
```

我不确定如何处理边框样式、单元格填充、单元格间距和网格线

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T14:22:12.560

看看[这个](http://www.somacon.com/p141.php)。我想这会对你有所帮助。

这里的关键是如何针对某些方式来显示表格单元格。

```
table.gridView td
{
    padding:10px; // same as CellPadding on table HTML tag
} 
```

# c# - 获取字典中的最后一个元素？

> ID：1018168
> 
> 赞同：29
> 
> 时间：2009-06-19T14:13:30.687
> 
> 标签：c#, .net, dictionary

我的字典：

```
Dictionary<double, string> dic = new Dictionary<double, string>(); 
```

如何返回字典中的最后一个元素？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-06-19T14:16:59.963

你说的最后是什么意思？你的意思是最后的增值吗？

该类`Dictionary<TKey,TValue>`是一个无序的集合。添加和删​​除项目可以更改被认为是第一个和最后一个元素的内容。因此，无法添加 Last 元素。

有一个有序的字典类，格式为`SortedDictionary<TKey,TValue>`. 但这将根据键的比较而不是添加值的顺序进行排序。

**编辑**

有几个人提到使用以下 LINQ 风格的方法

```
var last = dictionary.Values.Last(); 
```

使用这种方法要非常小心。它将返回 Values 集合中的最后一个值。这可能是也可能不是您添加到字典中的最后一个值。它很可能不会像现在这样。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-06-19T14:17:33.003

字典是无序的集合——因此，没有第一个或最后一个元素的概念。如果您正在寻找一个行为类似于字典但保持项目插入顺序的类，请考虑使用[`OrderedDictionary`](http://msdn.microsoft.com/en-us/library/system.collections.specialized.ordereddictionary.aspx).

如果您正在寻找对项目进行排序的集合，请考虑使用[`SortedDictionary<TKey,TValue>`](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx).

如果您有一个现有的字典，并且您正在寻找给定某种排序顺序的“最后一个”元素，则可以使用 linq 对集合进行排序，例如：

```
myDictionary.Values.OrderBy( x => x.Key ).Last(); 
```

谨慎使用`Dictionary.Keys.Last()`- 虽然使用默认的键类型对键列表进行排序`IComparer`，但您获得的值可能不是您期望的值。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-09-20T16:44:30.750

我知道这个问题太老了，无法得到任何支持，但我不喜欢任何答案，所以会发布我自己的答案，希望为未来的读者提供另一种选择。

假设您想要字典中的*最高键值*，而不是最后插入的键值：

以下内容在 .NET 4.0 上对我不起作用*：*

```
myDictionary.Values.OrderBy( x => x.Key ).Last(); 
```

我怀疑问题是'x'代表字典中的一个值，而一个值没有键（字典存储键，字典值没有）。我也可能在使用该技术时犯了一个错误。

无论哪种方式，这种解决方案对于大型词典来说都会很慢，对于 CS 人员来说可能是*O(n log n)*，因为它对**整个词典进行排序**只是为了获得一个条目。这就像重新排列您的整个 DVD 收藏只是为了找到一部特定的电影。

* * *

```
var lastDicVal = dic.Values.Last(); 
```

已被确立为一个坏主意。在实践中，此解决方案可能会返回添加到字典中的最后一个值（不是最高键值），但在软件工程术语中这是没有意义的，不应依赖。即使它在永恒的剩余时间里每次都有效，它也代表了代码中的一个定时炸弹，它取决于库的实现细节。

* * *

我的解决方案如下：

```
var lastValue = dic[dic.Keys.Max()]; 
```

Keys.max() 函数比排序*O(n)*而不是*O(n log n)*快得多。如果性能足够重要以至于*O(n)*太慢，则可以在用于替换*dic.Keys.Max()*的单独变量中跟踪最后插入的键，这将使整个查找尽可能快，或 O(1)。

注意：使用 double 或 float 作为键不是最佳实践，可能会产生超出本文范围的令人惊讶的结果。在浮点/双精度值的上下文中阅读“epsilon”。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-19T14:17:07.780

如果您使用的是 .NET 3.5，请查看：

```
 dic.Keys.Last() 
```

但是，如果您想要一个可预测的顺序，请使用：

```
IDictionary<int, string> dic = new SortedDictionary<int, string>(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T14:19:58.227

考虑创建一个包含自定义集合`Add`方法中的引用的自定义集合。这将根据您的要求设置一个包含最后添加的键/值（或两者）的私有字段。

然后有一个`Last()`返回这个的方法。这是一个概念证明类来说明我的意思（请不要敲缺乏接口实现等 - 它是示例代码）：

```
public class LastDictionary<TKey, TValue>
{
    private Dictionary<TKey, TValue> dict;

    public LastDictionary()
    {
        dict = new Dictionary<TKey, TValue>();
    }

    public void Add(TKey key, TValue value)
    {
        LastKey = key;
        LastValue = value;
        dict.Add(key, value);
    }

    public TKey LastKey
    {
        get; private set;
    }

    public TValue LastValue
    {
        get; private set;
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-02-24T15:01:53.283

而不是使用：

```
Dictionary<double, string> 
```

...你可以使用：

```
List<KeyValuePair<double, string>> 
```

这将允许您使用索引器按顺序而不是按键访问元素。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-19T14:20:38.413

从[文档](http://msdn.microsoft.com/en-us/library/xfhwa508(VS.80).aspx)：

> 出于枚举的目的，字典中的每个项目都被视为表示值及其键的 KeyValuePair 结构。**返回项目的顺序是未定义的**。

所以，我不认为你可以依靠`Dictionary`返回最后一个元素。

使用另一个集合。也许`SortedDictionary`...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T14:15:47.657

如果您只想要该值，这应该可以工作（假设您可以使用 LINQ）：

```
dic.Values.Last() 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T14:16:03.147

你可以使用：

```
dic.Last() 
```

但是字典并没有真正的最后一个元素（里面的对没有以任何特定的方式排序）。最后一项将始终相同，但不清楚它可能是哪个元素。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-19T14:16:45.907

使用 .Net 3.5：

```
string lastItem = dic.Values.Last()
string lastKey = dic.Keys.Last() 
```

...但请记住，字典没有排序，因此您不能指望值将保持相同的顺序。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-19T14:22:19.530

字典不是按顺序访问的，所以 first, last 没有意义。您想要由最高键索引的值吗？

```
Dictionary<double, string> dic = new Dictionary<double, string>();
double highest = double.MinValue;
string result = null;
foreach(double d in dic.keys)
{
   if(d > highest)
   {
      result = dic[d];
      highest = d;
   }
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-03-01T21:19:19.407

而不是像大多数其他答案所建议的那样使用 Linq，您可以通过 Count 属性访问任何 Collection 对象的最后一个元素（有关更多信息，请参阅[ICollection.Count 属性](https://msdn.microsoft.com/en-us/library/system.collections.icollection.count(v=vs.110).aspx)）。

有关如何使用 count 访问任何 Collection（包括 Dictionary）中的最终元素的示例，请参见此处的代码：

```
Dictionary<double, string> dic = new Dictionary<double, string>();
var lastElementIndex = dic.Count - 1;
var lastElement = dic[lastElementIndex]; 
```

请记住，这将返回最后一个**VALUE**，而不是键。

# c# - 与 webapplication 一起使用的 traceview

> ID：1018175
> 
> 赞同：0
> 
> 时间：2009-06-19T14:16:02.603
> 
> 标签：c#, iis, trace

有没有人能够在 TraceView 中查看来自 web 应用程序的 Trace 消息？我正在使用 System.Diagnostincs.Trace.Write .... 但无论我在 TraceView 中选择什么过滤器，我都看不到任何消息...（在调试模式下编译，启用了 TRACE 和 DEBUG）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T14:23:06.677

编辑：好的，我想我实际上找到了你需要的东西：MSDN 有关于如何使用 SvcTraceViewer.exe [http://msdn.microsoft.com/en-us/library/ms732023.aspx](http://msdn.microsoft.com/en-us/library/ms732023.aspx)的说明 ，这似乎适合账单。

在您的 asp.net 应用程序中，转到 trace.axd，您的跟踪消息将在那里。如果您的 asp.net 应用程序位于[http://bob.com/woot](http://bob.com/woot)然后转到[http://bob.com/woot/trace.axd](http://bob.com/woot/trace.axd)，您将看到您的跟踪消息。您必须在 web.config 中设置一些设置才能远程访问跟踪。

```
<configuration>
 <system.web>
   <trace 
    enabled="true" 
    requestLimit = "10"
    pageOutput="false"
    traceMode="SortByTime"
    localOnly = "true"
  />
 </system.web>
</configuration> 
```

# sql-server - Service Broker 中的私钥问题

> ID：1018177
> 
> 赞同：1
> 
> 时间：2009-06-19T14:16:08.263
> 
> 标签：sql-server, sql-server-2005, service-broker

我们正在尝试按照 MSDN 中的教程通过 Service Broker 在一个 SQL 引擎中的两个 SQL 实例之间进行对话。为了简单起见，我们发送 Encryption = OFF 的对话框，因此我们不需要处理 Master key、Certificate... 并且它在本地工作站中工作。

```
DECLARE @InitDlgHandle UNIQUEIDENTIFIER; 
```

声明 @RequestMsg NVARCHAR(100);

开始交易；

BEGIN DIALOG @InitDlgHandle 从服务 [//InstDB/2InstSample/InitiatorService] 到 SERVICE N'//TgtDB/2InstSample/TargetService' ON CONTRACT [//BothDB/2InstSample/SimpleContract] WITH ENCRYPTION = OFF;

SELECT @RequestMsg = N'目标服务的消息。';

发送对话@InitDlgHandle MESSAGE TYPE [//BothDB/2InstSample/RequestMessage] (@RequestMsg);

选择 @RequestMsg 作为 SentRequestMsg;

提交交易；去

但是，在移动到服务器后，使用相同的脚本，目标数据库在 initDB 发出消息后的 SQL 跟踪中一直显示“找不到私钥，消息无法传递”。

我的问题是，既然我们设置了加密 = OFF，为什么目标数据库显示缺少证书？

我们使用 SQL 2005 SP2 , Windows 2003

感谢任何输入。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-14T19:32:01.197

说到聚会迟到……
以前没看过这个帖子。我不知道是否仍然有任何相关性，但可能的原因如下：

[REMOTE SERVICE BINDING](http://msdn.microsoft.com/en-us/library/ms166042.aspx)的存在将胜过 ENCRYPTION = OFF。这是为了允许将开发人员职责与管理员职责分开。如果应用程序需要加密，则开发人员指定 ENCRYPTION = ON 并且管理员**必须**提供远程服务绑定。如果应用程序不需要加密，则开发人员指定 ENCRYPTION = OFF，如果部署站点决定需要加密，即使应用程序不需要，管理员**也可以提供远程服务绑定。**

可以在我的网站上找到有关对话安全和身份验证工作原理的[完整说明。](http://rusanu.com/2008/11/04/conversations-authentication/)

# visual-studio-2005 - 如何删除 web.config 中自动添加的引用

> ID：1018180
> 
> 赞同：1
> 
> 时间：2009-06-19T14:16:49.980
> 
> 标签：visual-studio-2005

我机器中 Visual Studio 2005 中的所有应用程序都会自动添加 n 个引用。我该如何解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T17:36:59.323

我的问题在 System.Web.Extensions 3.5 中，现在我更改为 System.Web.Extensions 1.6 并解决了问题。

谢谢您的帮助。

# c# - 访问动态类中包含的 Linq 结果

> ID：1018183
> 
> 赞同：0
> 
> 时间：2009-06-19T14:17:15.533
> 
> 标签：c#, linq, linq-to-sql, dynamic-linq

我正在使用 DbLinq，对于这个问题，它应该等同于 Linq2SQL。我需要生成一个 Linq2SQL 查询，在其中指定要在运行时返回的列。我可以使用 Dynamic Linq 扩展方法来实现这一点，但我不知道如何提取结果。

```
string someProperty = "phonenumber";
string id = "1234";

Table<MyClass> table = context.GetTable<MyClass>();
var queryResult = (from item in table where item.Id == id select item).Select("new (" + someProperty + ")"); 
```

Linq 表达式生成正确的 SQL：

```
select phonenumber from mytable where id = '1234' 
```

在调试器中，我可以在结果视图中看到 phonenumber 值。问题是我不知道如何从 queryResult 对象中获取 phonenumber 值？queryResult 的类型是：

```
QueryProvider<DynamicClass1> 
```

编辑：我发现了一种方法，但它看起来很粗糙。

```
IEnumerator result = (from item in table where item.Id == id select item).Select("new (" + someProperty + ")").GetEnumerator();
result.MoveNext();
var resultObj = result.Current;
PropertyInfo resultProperty = resultObj.GetType().GetProperty(someProperty);
Console.WriteLine(resultProperty.GetValue(resultObj, null)); 
```

也许有人知道更清洁的方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T15:12:11.740

Linq 使用延迟执行的方法来获取数据。[延迟执行](http://msdn.microsoft.com/en-us/library/bb943859.aspx)意味着表达式的计算被延迟到实际需要它的实现值。

在您的情况下 queryResult 是一个 IEnumerable 对象，这意味着尚未实际评估任何数据。您可以通过调用 result.ToList() 或 result.ToDictionary() 或任何其他将返回具有非 IEnumerable 数据类型的对象的方法来评估 queryResult 对象。

希望这会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-20T02:49:13.603

解决方案的动态方面迫使您使用反射。您可以使用 IQueryable 的“ElementType”属性，而不是获取第一项并读取它的类型。然后，像这样的循环可能会更好：

```
var result = (from item in table where item.Id == id select item).Select("new (" + someProperty + ")");
PropertyInfo resultProperty = result.ElementType.GetProperty(someProperty);
foreach (var resultObj in result)
{
    var value = resultProperty.GetValue(resultObj, null);
} 
```

除了创建函数来为您完成其中一些工作，没有太多需要改进的地方。编译器只是不知道对象中有什么，因为它是动态的。因此，非反射代码的所有优点都是不可用的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-01T12:00:18.607

解决方案是：

```
string someProperty = "phonenumber";
PropertyInfo property = typeof(T).GetProperty(propertyName);
string id = "1234";
Table<MyClass> table = context.GetTable<MyClass>();
Expression<Func<T, Object>> mySelect = DynamicExpression.ParseLambda<T, Object>(property.Name);
var query = (from asset in table where asset.Id == id select asset).Select(mySelect);
return query.FirstOrDefault(); 
```

# asp.net - ASP.NET MVC 中的 Url.Content 问题

> ID：1018188
> 
> 赞同：3
> 
> 时间：2009-06-19T14:18:26.763
> 
> 标签：asp.net, asp.net-mvc

出于某种原因，当我尝试在我新创建的 asp.net mvc 应用程序的默认母版页 (Site.Master) 中使用 Page.ResolveURL 或 Url.Content 时出现运行时异常。这很奇怪，因为多年来我一直在 .NET 中使用 ResolveURL 辅助函数而没有问题。这是我的代码片段：

```
<link href="<%= Url.Content("~/css/style.css"); %>" rel="stylesheet" type="text/css" /> 
```

这是发生在同一行的运行时错误：

```
Compiler Error Message: CS1026: ) expected 
```

如果我将 href 更改为静态 URL，一切都很好。此外，这是一个全新的 ASP.NET mvc 项目……这是我更改的第一行代码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T14:20:12.110

删除分号

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T14:23:13.070

从末尾删除分号。一些 MVC 帮助器方法返回字符串，在这种情况下，它们应该出现在`<%= %>`适合这种情况的标记之间。当使用返回一些东西的辅助方法时，你把分号放在末尾。

其他辅助方法不返回任何内容（例如，Html.RenderPartial），在这种情况下，您使用`<% %>`标签，并在此处以分号结束您的代码表达式。

# c++ - 实现“观察者”模式的问题

> ID：1018189
> 
> 赞同：32
> 
> 时间：2009-06-19T14:18:52.957
> 
> 标签：c++, design-patterns, observer-pattern

在使用 C++ 和 STL 实现观察者模式时，我遇到了一个有趣的问题。考虑这个经典的例子：

```
class Observer {
public:
   virtual void notify() = 0;
};

class Subject {
public:
   void addObserver( Observer* );
   void remObserver( Observer* );
private:
   void notifyAll();
};

void Subject::notifyAll() {
   for (all registered observers) { observer->notify(); }
} 
```

这个例子可以在每一本关于设计模式的书中找到。不幸的是，现实生活中的系统更复杂，所以这是第一个问题：一些观察者决定在收到通知时将其他观察者添加到主题中。这使我使用的“for”循环和所有迭代器无效。解决方案相当简单——我对已注册的观察者列表进行快照并遍历该快照。添加新的观察者不会使快照失效，所以一切看起来都很好。但是这里还有另一个问题：观察者决定在收到通知时摧毁自己。更糟糕的是，一个观察者可以决定销毁所有其他观察者（它们由脚本控制），这会使队列和快照都无效。我发现自己迭代了解除分配的指针。

我的问题是，当观察者互相残杀时，我应该如何处理这种情况？有没有现成的模式？我一直认为“观察者”是世界上最简单的设计模式，但现在看来要正确实现它并不是那么容易......

**谢谢大家的关注。让我们有一个决策摘要：**

**[1]“不要这样做”**对不起，但这是必须的。观察者由脚本控制并被垃圾收集。我无法控制垃圾收集以防止它们被取消分配；

**[2] “使用 boost::signal”**最有希望的决定，但我不能在项目上引入 boost，这样的决定只能由项目负责人做出（我们在 Playstation 下编写）；

**[3] “使用 shared__ptr”**这将阻止观察者解除分配。一些子系统可能依赖于内存池清理，所以我认为我不能使用 shared_ptr。

**[4] “推迟观察者释放”**在通知的同时将观察者排队等待移除，然后使用第二个周期将它们删除。不幸的是，我无法阻止释放，所以我使用了一种用某种“适配器”包装观察者的技巧，实际上保留了“适配器”列表。在析构函数上，观察者从他们的适配器中取消分配，然后我用我的第二个周期来销毁空的适配器。

ps 可以吗，我编辑我的问题以总结所有帖子？我是 StackOverflow 上的菜鸟...

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-19T14:39:12.307

非常有趣的问题。

试试这个：

1.  将 remObserver 更改为使条目无效，而不是仅仅删除它（并使列表迭代器无效）。
2.  将您的 notifyAll 循环更改为：

    for (所有注册的观察者) { if (observer) observer->notify(); }

3.  在 notifyAll 末尾添加另一个循环以从观察者列表中删除所有空条目

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T14:29:01.810

就个人而言，我使用[boost::signals](http://www.boost.org/doc/libs/1_39_0/doc/html/signals.html)来实现我的观察者；我必须检查一下，但我相信它可以处理上述情况（已**编辑**：找到它，请参阅[“何时会发生断开连接”](http://www.boost.org/doc/libs/1_39_0/doc/html/signals/tutorial.html)）。它简化了您的实现，并且不依赖于创建自定义类：

```
class Subject {
public:
   boost::signals::connection addObserver( const boost::function<void ()>& func )
   { return sig.connect(func); }

private:
   boost::signal<void ()> sig;

   void notifyAll() { sig(); }
};

void some_func() { /* impl */ }

int main() {
   Subject foo;
   boost::signals::connection c = foo.addObserver(boost::bind(&some_func));

   c.disconnect(); // remove yourself.
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-19T14:30:56.113

一个男人去找医生说：“医生，当我这样举起手臂时，真的很痛！” 医生说：“不要那样做。”

最简单的解决方案是与您的团队合作并告诉他们不要这样做。如果观察者“真的需要”杀死自己或所有观察者，则安排通知结束时的操作。或者，更好的是，更改 remObserver 函数以了解是否正在发生通知过程，并在一切完成后将删除排队。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-20T18:40:15.783

这是TED已经提出的想法的变体。

只要 remObserver 可以使条目为空而不是立即删除它，那么您可以将 notifyAll 实现为：

```
void Subject::notifyAll()
{
    list<Observer*>::iterator i = m_Observers.begin();
    while(i != m_Observers.end())
    {
        Observer* observer = *i;
        if(observer)
        {
            observer->notify();
            ++i;
        }
        else
        {
            i = m_Observers.erase(i);
        }
    }
} 
```

这避免了对第二个清理循环的需要。但是，这确实意味着，如果某个特定的 notify() 调用触发了删除其自身或位于列表中较早位置的观察者，则列表元素的实际删除将推迟到下一个 notifyAll()。但是只要在列表上运行的任何函数在适当的时候适当注意检查空条目，那么这应该不是问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-19T14:31:23.537

问题是所有权问题。您可以使用智能指针（例如`boost::shared_ptr`and`boost::weak_ptr`类）来延长观察者的生命周期，使其超过“解除分配”点。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-19T14:36:40.143

这个问题有几种解决方案：

1.  使用`boost::signal`它允许在对象销毁时自动删除连接。但是你应该*非常*小心线程安全
2.  使用`boost::weak_ptr`or`tr1::weak_ptr`来管理观察者，`boost::shared_ptr`或者`tr1::shared_ptr`为观察者自己管理 - 引用计数将帮助您使对象无效，weak_ptr 将让您知道对象是否存在。
3.  如果您在某个事件循环上运行，请确保每个观察者不会在同一个调用中破坏自己、添加自己或任何其他对象。只是推迟工作，意思是

    ```
    SomeObserver::notify()
    {
       main_loop.post(boost::bind(&SomeObserver::someMember,this));
    } 
    ```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T14:22:08.207

`for`在循环中使用链表怎么样？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T14:28:32.763

如果您的程序是多线程的，您可能需要在此处使用一些锁定。

无论如何，根据您的描述，问题似乎不是并发（多线程），而是由 Observer::notify() 调用引起的突变。如果是这种情况，那么您可以通过使用向量并通过索引而不是迭代器遍历它来解决问题。

```
for(int i = 0; i < observers.size(); ++i)
  observers[i]->notify(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T16:22:55.330

如何调用一个成员迭代器`current`（初始化为`end`迭代器）。然后

```
void remObserver(Observer* obs)
{
    list<Observer*>::iterator i = observers.find(obs);
    if (i == current) { ++current; }
    observers.erase(i);
}

void notifyAll()
{
    current = observers.begin();
    while (current != observers.end())
    {
        // it's important that current is incremented before notify is called
        Observer* obs = *current++;
        obs->notify(); 
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-19T18:54:30.360

在通知器容器上定义和使用重载迭代器，该迭代器对删除有弹性（例如，如前所述，清空）并且可以处理添加（例如附加）

另一方面，如果您想在通知期间强制保持容器 const，请将 notifyAll 和被迭代的容器声明为 const。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-09-13T06:34:17.187

由于您正在复制集合，所以这有点慢，但我认为它也更简单。

```
class Subject {
public:
   void addObserver(Observer*);
   void remObserver(Observer*);
private:
   void notifyAll();
   std::set<Observer*> observers;
};

void Subject::addObserver(Observer* o) {
  observers.insert(o);
}

void Subject::remObserver(Observer* o) {
  observers.erase(o);
}

void Subject::notifyAll() {
  std::set<Observer*> copy(observers);
  std::set<Observer*>::iterator it = copy.begin();
  while (it != copy.end()) {
    if (observers.find(*it) != observers.end())
      (*it)->notify();
    ++it;
  }
}
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-01-20T14:03:25.313

您永远无法避免在迭代时移除观察者。

观察者甚至可以在`WHILE`你试图调用它的`notify()`函数时被移除。

因此我想你需要一个*try/catch*机制。

锁是为了确保在复制观察者集时观察者集不会改变

```
 lock(observers)
  set<Observer> os = observers.copy();
  unlock(observers)
  for (Observer o: os) {
    try { o.notify() }
    catch (Exception e) {
      print "notification of "+o+"failed:"+e
    }
  } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-10-06T01:04:24.147

几个月前，当我看到这篇文章时，我正在寻找解决这个问题的方法。它让我开始思考解决方案，我认为我有一个不依赖于 boost、智能指针等的解决方案。

简而言之，这是解决方案的草图：

1.  Observer 是一个单例，带有用于注册感兴趣的主题的键。因为它是一个单例，所以它始终存在。
2.  每个主题都派生自一个公共基类。基类有一个抽象虚函数 Notify(...) 必须在派生类中实现，以及一个析构函数，当它被删除时，它会从 Observer 中删除（它总是可以到达）。
3.  在观察者本身内部，如果在 Notify(...) 正在进行时调用 Detach(...)，则任何分离的 Subjects 最终都会出现在列表中。
4.  当在 Observer 上调用 Notify(...) 时，它会创建主题列表的临时副本。当它迭代它时，它将它与最近分离的进行比较。如果目标不在其上，则在目标上调用 Notify(...)。否则，将被跳过。
5.  Observer 中的 Notify(...) 还跟踪处理级联调用的深度（A 通知 B、C、D，并且 D.Notify(...) 触发对 E 的 Notify(...) 调用， ETC。）

这似乎运作良好。该解决方案与源代码一起发布在网络上[。](http://www.nliapps.com/tools-you-build-part-i-observer/)这是一个相对较新的设计，因此非常感谢任何反馈。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-08-18T07:30:01.367

我刚刚写了一个完整的观察者类。我会在测试后将其包含在内。

但我对你的问题的回答是：办案！

我的版本确实允许在通知循环内触发通知循环（它们立即运行，将其视为深度优先递归），但是有一个计数器，以便 Observable 类知道通知正在运行以及有多少深度。

如果观察者被删除，它的析构函数会告诉所有它订阅的可观察对象关于销毁的事情。如果它们不在观察者所在的通知循环中，则该可观察对象将从该事件的 std::list<pair<Observer*, int>> 中删除，如果它处于循环中，则它在list 无效，并且命令被推入队列，当通知计数器降至零时将运行该队列。该命令将删除无效的条目。

所以基本上，如果你不能安全地删除（因为可能有一个迭代器持有将通知你的条目），那么你使条目无效而不是删除它。

因此，与所有并发无等待系统一样，规则是 - 如果您没有被锁定，则处理此案，但如果您被锁定，那么您将工作排队，持有锁的人将在他释放锁时完成工作。

# c# - 可以使用 ssl 公开 wcf 服务并由 .net 1.1 客户端使用吗？

> ID：1018190
> 
> 赞同：2
> 
> 时间：2009-06-19T14:19:12.847
> 
> 标签：c#, .net, asp.net, wcf, web-services

我没有看到任何明确说这不能做的事情，但我想确认......

我们有一个需要使用 Web 服务的客户，他们仍在使用 .NET 1.1

我很想以此作为学习一些 WCF 的理由，我只是想确保它兼容..

从我所读到的，看起来我可以在 IIS 中托管 WCF 服务并使用“securetransport”绑定使用 basicHttpbinding 设置它，并且 .NET 1.1 客户端将能够访问它。

还有其他需要考虑的因素吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:33:24.453

是的。

这是[一篇](http://social.msdn.microsoft.com/forums/en-US/wcf/thread/1f8c7fe9-784c-4beb-8d0f-060bf8bfc24f)包含相同问题的文章以及有关如何操作的答案。

自由贸易协定：

> 如果您使用 basicHttpBinding
> 
> ```
>  <endpoint address="basic"
>   binding="basicHttpBinding"
>   contract="YourNameSpace.IYourService" /> 
> ```
> 
> 您告诉 WCF 使用 SOAP1.1。这就是 ASMX 在 ASP.NET 1.1 和 2.0 中使用的内容。Visual Studio 2003 和 2005 的添加 Web 引用功能使用 WSDL 读取 SOAP Web 服务的定义。您可以通过为 serviceMetaData 包含一个带有 httpGetEnabled 的 serviceBehavior 在您的 WCF 服务上启用 WSDL
> 
> 你可以通过向你的服务添加一个 behaviorConfiguration 来做到这一点
> 
> ```
> <service name="MyService" behaviorConfiguration="MyBehavior">...
> </service>
> ...
> <behaviors>
> <serviceBehaviors>
> <behavior name="MyBehavior">
> <serviceMetadata httpGetEnabled="true"/>
> </behavior>
> </serviceBehaviors>
> </behaviors> 
> ```
> 
> 然后，您可以使用 Add Web Reference 浏览到 HTTP 托管的 WCF 服务以创建客户端代理，或者如果您需要更大的灵活性，您可以从命令行使用 wsdl.exe（来自 1.1 或 2.0）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:33:53.860

使用 basicHttpBinding 并尝试避免 .NET 1.1 中不存在的 .NET 2.0 类型。

# objective-c - Objective-C：使用多个参数调用选择器

> ID：1018195
> 
> 赞同：148
> 
> 时间：2009-06-19T14:19:47.383
> 
> 标签：objective-c, selector

在 MyClass.m 中，我定义了

```
- (void) myTest: (NSString *) withAString{
    NSLog(@"hi, %@", withAString);
} 
```

以及 MyClass.h 中的适当声明。稍后我想打电话

```
[self performSelector:@selector(mytest:withAString:) withObject: mystring]; 
```

在 MyClass.m 但我收到类似于 *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '*** -[MyClass myTest:withAtring:]: unrecognized selector sent to instance 0xe421f0'

我尝试了一个更简单的案例，它使用不带参数的选择器，将字符串打印到控制台并且效果很好。代码有什么问题，我该如何解决？谢谢。

* * *

## 回答 #1

> 赞同：315
> 
> 时间：2009-06-19T17:15:34.153

在 Objective-C 中，选择器的签名包括：

1.  方法的名称（在本例中为“myTest”）（必需）
2.  如果方法有输入，则方法名称后面的“：”（冒号）。
3.  每个附加输入的名称和“：”。

选择器不知道：

1.  输入类型
2.  方法的返回类型。

这是一个类实现，其中 performMethodsViaSelectors 方法通过选择器执行其他类方法：

```
@implementation ClassForSelectors
- (void) fooNoInputs {
    NSLog(@"Does nothing");
}
- (void) fooOneIput:(NSString*) first {
    NSLog(@"Logs %@", first);
}
- (void) fooFirstInput:(NSString*) first secondInput:(NSString*) second {
    NSLog(@"Logs %@ then %@", first, second);
}
- (void) performMethodsViaSelectors {
    [self performSelector:@selector(fooNoInputs)];
    [self performSelector:@selector(fooOneInput:) withObject:@"first"];
    [self performSelector:@selector(fooFirstInput:secondInput:) withObject:@"first" withObject:@"second"];
}
@end 
```

您要为其创建选择器的方法有一个输入，因此您可以为它创建一个选择器，如下所示：

```
SEL myTestSelector = @selector(myTest:); 
```

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2009-06-19T16:19:28.187

您的方法签名是：

```
- (void) myTest:(NSString *) 
```

withAString 恰好是参数（名称具有误导性，看起来它是选择器签名的一部分）。

如果您以这种方式调用该函数：

```
[self performSelector:@selector(myTest:) withObject:myString]; 
```

它会起作用的。

但是，正如其他海报所建议的那样，您可能需要重命名该方法：

```
- (void)myTestWithAString:(NSString*)aString; 
```

并调用：

```
[self performSelector:@selector(myTestWithAString:) withObject:myString]; 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-11-05T13:10:38.330

@Shane Arney

```
performSelector:withObject:withObject: 
```

您可能还想提一下，此方法仅用于传递最多 2 个参数，并且不能延迟。（例如`performSelector:withObject:afterDelay:)`.

有点奇怪，苹果只支持发送 2 个对象，并没有使它更通用。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-07-18T15:19:26.487

您的代码有两个问题。一个被识别并回答了，但另一个没有。首先是您的选择器缺少其参数的名称。但是，即使您修复了该问题，该行仍然会引发异常，假设您修改后的方法签名仍然包含多个参数。假设您修改后的方法声明为：

```
-(void)myTestWithString:(NSString *)sourceString comparedTo:(NSString *)testString ; 
```

为接受多个参数的方法创建选择器是完全有效的（例如 @selector(myTestWithString:comparedTo:) ）。但是，performSelector 方法只允许您将一个值传递给 myTest，不幸的是它有多个参数。它会出错并告诉您您没有提供足够的值。

你总是可以重新定义你的方法来获取一个集合，因为它是唯一的参数：

```
-(void)myTestWithObjects:(NSDictionary *)testObjects ; 
```

但是，有一个更优雅的解决方案（不需要重构）。答案是使用 NSInvocation 以及它的`setArgument:atIndex:`和`invoke`方法。

如果您需要更多详细信息，我已经写了[一篇文章，包括代码示例。](http://excitabyte.wordpress.com/2009/07/07/spawning-threads-using-selectors-with-multiple-parameters/)重点是线程，但基础仍然适用。

祝你好运！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T14:24:29.620

您的方法签名没有意义，您确定这不是错字吗？我不清楚它是如何编译的，尽管您可能会收到您忽略的警告？

您希望此方法采用多少参数？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-19T14:23:52.507

认为类应该定义为：

```
- (void) myTestWithSomeString:(NSString *) astring{
    NSLog(@"hi, %s", astring);
} 
```

你只有一个参数，所以你应该只有一个：

您可能还想考虑在您的 NSLog 中使用 %@ - 这只是一个好习惯 - 然后会写出任何对象 - 而不仅仅是字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-10-15T08:57:34.433

## 由 android 开发者在 2021_10_15 发布。

（OC比较难用，-_-||）

使用多个参数调用选择器，

你可以使用`NSObject performSelector:withObject:withObject`，

但只支持传递两个参数！！！

幸运的是，你可以`performSelector withObject X 3`通过`objc_msgSend`函数来​​实现你。

```
#include <objc/message.h>

- (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2 withObject:(id)object3 {
    typedef id (*send_type)(id, SEL, id, id, id);
    send_type func = (send_type) objc_msgSend;
    id retValue = func(self, aSelector, object1, object2, object3);
    return retValue;
} 
```

用法：

```
- (NSString *)ObjcMsgSendWithString:(NSString *)string withNum:(NSNumber *)number withArray:(NSArray *)array {
    NSLog(@" ---> %@, %@, %@", string, number, array[0]);
    return @"return 311";
}

- (void)test{
    NSString *str = @"字符串objc_msgSend";
    NSNumber *num = @20;
    NSArray *arr = @[@"数组值1", @"数组值2"];

    SEL sel = @selector(ObjcMsgSendWithString:withNum:withArray:);
    NSLog(@"1223 ---> %@", [self performSelector:sel withObject:str withObject:num withObject:arr]);
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-01-12T05:43:07.160

> iOS 用户还期望自动大写：在标准文本字段中，区分大小写语言的句子的第一个字母会自动大写。
> 
> 您可以决定是否实现这些功能；刚刚列出的任何功能都没有专用的 API，因此提供它们是一种竞争优势。

Apple 文档说在自定义键盘中没有可用于此功能和其他一些预期功能的 API。所以你需要找出你自己的逻辑来实现它。

# c++ - 如何在 GCC 中抑制“条件表达式中的枚举和非枚举类型”警告

> ID：1018208
> 
> 赞同：5
> 
> 时间：2009-06-19T14:21:49.207
> 
> 标签：c++, gcc, gcc-warning

我不断从第三方库（我不想调试）收到此警告，因此我非常感谢一种抑制此特定警告的方法。谷歌让我失望了，所以我在这里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-09-16T18:36:31.400

在 gcc4.6 及更高版本中，您可以使用编译指示来抑制特定的警告，并且只对特定的代码块进行抑制，即：

```
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wno-enum-compare" 
// Code that causes warning goes here
#pragma GCC diagnostic pop 
```

push/pop 用于保留在处理代码之前存在的诊断选项。

这将是一种比`#pragma GCC system_header`用于抑制所有警告更好的方法。（当然，在较旧的 gcc 中，您可能会“卡住”该`#pragma GCC system_header`方法！）

这是关于抑制 gcc 警告的一个很好的参考：[http ://www.dbp-consulting.com/tutorials/SuppressingGCCWarnings.html](http://www.dbp-consulting.com/tutorials/SuppressingGCCWarnings.html)

此页面还描述了如何使用`-fdiagnostics-show-option`来找出控制特定警告的选项。

当然，解决所有警告的根本原因通常比压制它们要好得多！但是，有时这是不可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-22T21:22:03.103

`-Wno-enum-compare`绕过这个警告。

[**也可以看看**](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=27975#c8)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-20T09:15:20.757

好吧，由于我找不到禁用此特定警告的方法，因此我求助于使用 gcc 的#pragma system_header。基本上，我像这样包装有问题的标题：

```
#if 定义了 __GNUC__
#pragma GCC system_header
#elif 定义 __SUNPRO_CC
#pragma disable_warn
#elif 定义 _MSC_VER
#pragma 警告（推，1）
＃万一

#include "foo.h"

#如果定义了 __SUNPRO_CC
#pragma enable_warn
#elif 定义 _MSC_VER
#pragma 警告（弹出）
＃万一

```

其中 foo.h 是有问题的标头。现在我只包含这个 fooWrapper.h，问题就消失了。请注意，这也适用于其他一些编译器（MSC 和 SUNPRO），但我没有对其进行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T14:35:18.490

以下标志不会消除该警告吗？

```
-Wno-enum-promotion 
```

# ant - Tricky Ant 文件集（包括大部分，但不是所有目录）

> ID：1018214
> 
> 赞同：25
> 
> 时间：2009-06-19T14:22:13.790
> 
> 标签：ant

我有一个案例，我只是不知道如何让 Ant 只在文件集中提取我想要的文件（为什么 Ant 人不只使用正则表达式？）。

这是情况。我在类目录下有一堆类。我想：

1）类下的所有文件，

2) 但不是 /com/foo/bar 下的那些

3) 除了我确实想要 /com/foo/bar/AbstractCustomerAdapter.class 和 CustomerAdapterFactory.class。

/com/foo/bar 下的文件通常命名为 FooCustomerAdapter.class。

简而言之，我们创建了 2 个罐子，一个只包含客户特定的适配器，一个包含其他所有内容。这使我们能够创建一个新的客户适配器并只换掉那个 mini-jar。上面的文件集杀死我是“其他一切”。

一旦 Ant 排除了一个文件，没有包含将它带回来，所以项目 2 和 3 让我对如何处理文件集感到心痛。如何排除我的所有客户适配器，但不排除抽象客户适配器？在不排除 AbstractCustomerAdapter 的情况下，我无法使用与 ant 兼容的通配符来排除 XZYCustomerAdapter 类。

好吧，至少我想不出一个，但希望你们中的一个 Stack Overflow 居民比我更聪明 :)

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-06-19T19:21:53.617

大多数接受单个文件集的任务也可以接受多个文件集。

```
<jar file="...">
  <fileset dir="classes">
    <exclude name="com/foo/bar/**"/>
  </fileset>

  <fileset dir="classes">
    <include name="com/foo/bar/AbstractCustomerAdapter.class"/>
    <include name="com/foo/bar/CustomerAdapterFactory.class"/>
  </fileset>
</jar> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T17:00:05.873

我在不同的地方做两件不同的事情。有时我会将文件复制到一个临时位置，这样我就可以在一个步骤中包含所有可能的内容，并在后面的步骤中排除一些特定的项目。其他时候，我使用两个单独的语句。

您似乎不需要临时文件，但为了在构建安装之前将一些文本文件转换为 PC 行结尾，我复制并转换与临时目录相关的所有内容（使用 fixcrlf），然后选择文件与创建的层次结构不同的平台。

在构建 tar 文件时，能够在一行中包含特定文件并在包含其他文件的后一行中排除模式似乎就足够了。

`<tarfileset dir="classes" includes="classes" excludes="classes/com/foo/bar" />
<tarfileset dir="classes" includes="classes/com/foo/bar/AbstractCustomerAdapter.class,classes/com/foo/bar/CustomerAdapterFactory.class" />`

如果 Jar 文件不像 tar 和 zip 文件那样构建，您可能需要像我对 fixcrlf 所做的那样显式构建文件层次结构，并在第二遍中从更正的层次结构中构建 jar 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T14:30:58.423

编写[自定义选择器](http://ant.apache.org/manual/Types/custom-programming.html)。api很容易实现。在那里，您拥有需要决定的 Java 的所有力量。

# image - 如何处理 GDI+ Image Resize 的颜色丢失？

> ID：1018216
> 
> 赞同：1
> 
> 时间：2009-06-19T14:22:20.873
> 
> 标签：image, colors, gdi+, resize, loss

我正在使用以下路由使用 C#/GDI+ 调整图像大小

```
 bmpOut = new Bitmap(lnNewWidth, lnNewHeight);
        Graphics g = Graphics.FromImage(bmpOut);
        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBilinear;
        g.FillRectangle(Brushes.White, 0, 0, lnNewWidth, lnNewHeight);
        g.DrawImage(loBMP, 0, 0, lnNewWidth, lnNewHeight); 
```

并以最高质量对其进行编码。

```
System.Drawing.Imaging.Encoder qualityEncoder = System.Drawing.Imaging.Encoder.Quality;
            EncoderParameter myEncoderParameter = new EncoderParameter(qualityEncoder, 100L); 
```

但是，我得到的图像有明显的颜色损失（我只使用 JPG 图像）。质量是完美的，但颜色被洗掉了。你知道发生了什么吗？

提前非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-24T03:38:04.163

请参阅[如何使用 .NET / GDI+ 禁用子采样？](https://stackoverflow.com/questions/745610/how-to-disable-subsampling-with-net-gdi)

问题是 GDI+ 的 jpeg 编码器不允许禁用色度二次采样，因此颜色信息以半分辨率保存。唯一的解决方法可能是使用不同的编码器，例如建议作为上述答案的 ImageMagick。

# java - 我可以设置从 jar 文件运行的 Java 最大堆大小吗？

> ID：1018217
> 
> 赞同：40
> 
> 时间：2009-06-19T14:23:01.137
> 
> 标签：java, memory-management, jar

我正在启动一个 java jar 文件，它通常需要超过默认的 64MB 最大堆大小。不过，256MB 的堆大小对于这个应用程序来说已经足够了。无论如何指定（可能在清单中？）在启动 jar 时始终使用 256MB 的最大堆大小？（如果需要，请在下面提供更具体的详细信息。）

* * *

这是我用 Java 编写的一个命令行应用程序，它可以进行一些图像处理。在高分辨率图像（大约 12 兆像素及以上，这并不罕见）上，我得到了 OutOfMemoryError。

目前我正在从 jar 文件启动应用程序，即

`java -jar MyApp.jar params...`

我可以通过在命令行上指定 256MB 最大堆大小来避免 OutOfMemoryError，即：

`java -Xmx256m -jar MyApp.jar params...`

但是，我不想指定这一点，因为我知道即使是高分辨率图像，256MB 也足够了。我想将该信息保存在 jar 文件中。那可能吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2015-05-05T12:20:09.397

编写包含以下行的批处理或 shell 脚本。放入存储 MyApp.jar 的文件夹中。

```
java -Xmx256M -jar MyApp.jar 
```

之后总是打开这个批处理/脚本文件以启动 JAR 文件。虽然，这不会将虚拟内存大小的规范嵌入到 jar 文件本身中。但是，经常在命令行上编写相同的命令可以解决问题。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-19T14:37:53.167

您还可以使用像[launch4j](http://launch4j.sourceforge.net/index.html)这样的包装器，它将为大多数操作系统生成可执行文件：es 并允许您指定VM 选项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T14:27:47.507

这不是很好，但你可以将它作为一个可执行的 JAR，然后在它的 main 中，让它通过命令行作为非守护线程执行自身，并将适当的参数存储在属性文件中或计算或其他，然后退出原件。您甚至可以让它使用另一个需要这些参数的“真实”入口点来执行 jar。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-26T19:28:43.787

我有类似的需求，并认为我应该能够按照上面的建议在清单中指定它。但是，这是不可能的。我的解决方案与上面 Alex 建议的类似，但是，我所做的是让 main 方法使用 Java 的 ProcessBuilder 来启动另一个 Java 进程。启动另一个进程时，您可以指定新进程的最大内存。您实际上是在让一个 Java 进程启动另一个进程。这有点做作，但它确实有效，它仍然允许您通过双击 Jar 文件来启动您的应用程序，我知道您想要这样做。查看 ProcessBuilder。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-19T14:26:25.873

在谷歌上找到[了答案](http://coding.derkeiler.com/Archive/Java/comp.lang.java.help/2004-06/0604.html)。

他对 JAR 文件说不，在 JavaWeb Start 中是的，并且你应该在你的（可能是系统特定的）启动器/包装器脚本/应用程序中执行它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-16T11:16:17.683

**是的！**您需要编写一个小型入门程序 - 我编写了一个小型的跨平台兼容（路径应该没问题）程序来做到这一点 - 见下文。这已经在 Windows/Ubuntu/Mac OS X 上进行了测试。

[关于增加可执行 Java jar 堆的静默开发博客文章](http://silentdevelopment.blogspot.com/2010/03/how-to-set-or-increase-xmx-heap-memory.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-05T11:30:12.200

显然这适用于 Ubuntu

```
> export _JAVA_OPTIONS="-Xmx1g" 
```

> java -jar jconsole.jar & 拾取 _JAVA_OPTIONS: -Xmx1g

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-16T17:56:50.367

有很多方法可以做到：

您可以通过另一个 Jar 文件来触发您的主 Jar。

或者，有一个批处理文件将启动您的 jar。但要小心，如果从网络下载，用户必须设置脚本可运行的权限

构建安装程序。在 Mac 上，使用适用于 Java 7 的 Oracle Java App bundler，适用于 Java 6 的 Apple App bundler 构建 .app 文件。您仍然无法重新分发它，因为不会设置必要的权限。为应用程序文件构建一个 dmg。这可以用于分发。适用于 Windows 的类似安装程序

第三种技术是最好的，因为您可以很好地打包依赖项，设置所有 JVM 参数等

# mysql - 为什么 UPPER() 在 MySQL 中不起作用？

> ID：1018221
> 
> 赞同：4
> 
> 时间：2009-06-19T14:24:03.897
> 
> 标签：mysql

My SQL 查询从具有可选排序字段的视图中选择一些列。基本上，我的视图将多个字段连接到一个地址字符串中，因此我最终得到类似

```
123 Sesame Street Birdtown 
```

在地址栏中。我希望搜索不区分大小写（默认情况下不区分大小写），所以我尝试了这个：

```
SELECT * FROM BasicJobInfo WHERE UPPER(address) LIKE UPPER(searchString) 
```

searchString 是我要查找的地址。但是，MySQL 似乎无法将地址转换为大写 - 我尝试调用

```
SELECT UPPER(address) FROM BasicJobInfo 
```

但这根本不会改变情况。关于为什么会这样的任何想法？
另外，关于我还能如何进行不区分大小写的搜索的任何建议？
非常感谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-19T14:29:37.253

根据[字符串函数的 MySQL 参考手册页面](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_upper)：

> UPPER() 应用于二进制字符串（BINARY、VARBINARY、BLOB）时无效。

您的`ADDRESS`列是否可能具有`BINARY`、`VARBINARY`或`BLOB`数据类型？

如果是，您需要[将二进制字符串转换为“普通”字符串](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_lower)。例如：

```
UPPER(CONVERT(ADDRESS USING latin1)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T14:29:07.990

您能否运行以下查询：

```
SELECT  @@character_set_server, @@collation_server

SELECT  HEX(CAST(UPPER(address) AS binary)), HEX(CAST(address AS binary))
FROM    BasicJobInfo 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T14:30:02.167

这可能来自编码问题。[mysql 帮助页面的附录中](http://dev.mysql.com/doc/refman/5.0/en/case-sensitivity.html)描述了执行不区分大小写的比较。不区分大小写的 UTF8 列/字符串比较示例：

```
SELECT *
FROM YourTable
WHERE address LIKE 'searchString' COLLATE utf8_general_ci; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-11T06:24:48.343

对我有用的是使用关键字二进制

```
 SELECT *
  FROM Table
  WHERE binary address = 'caseSensitiveString' ; 
```

# c# - 使用 LINQ/Lambdas 将 String[] 复制到列表中 ?

> ID：1018225
> 
> 赞同：4
> 
> 时间：2009-06-19T14:24:17.843
> 
> 标签：c#, linq

使用更性感的语法执行以下操作的正确 C# 语法是什么？

```
string[] arr = ///....
List<string> lst = new List<string>();

foreach (var i in arr) {
   lst.Add(i);
} 
```

我觉得这可能是一个使用类似：arr.Select(x => lst.Add(x));

但我不够聪明，无法找出正确的语法。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-19T14:27:23.373

.ToList() 很好，但老实说，你不需要 LINQ：

```
List<int> list = new List<int>(arr); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-19T14:25:20.383

```
List<string> lst = arr.ToList(); 
```

[http://msdn.microsoft.com/en-us/library/bb342261.aspx](http://msdn.microsoft.com/en-us/library/bb342261.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T14:26:59.443

`list.AddRange(arr)`?

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T14:27:15.963

.Net 2.0：

```
lst.AddRange(arr); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T14:32:05.080

你可以这样做...

```
String[] arr = new String[] { "Hello", "Bonjour", "Hola" };

List<String> lst = arr.ToList(); 
```

如果您缺少`.ToList()`可能需要添加`using System.Linq;`到代码中的方法...

谢谢**:)**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T14:42:43.110

```
 string[] arr = new string[] { "a", "b", "c" };
  var lst = new List<string>();
  Array.ForEach(arr, x => lst.Add(x)); 
```

# php - 注册码/服务器验证和 Joomla

> ID：1018226
> 
> 赞同：0
> 
> 时间：2009-06-19T14:24:21.447
> 
> 标签：php, code-generation, joomla1.5, registration

这个问题可以分成几个部分：

1.  在 PHP 中为产品创建注册密钥的最佳方法是什么（即一个人购买了 PHP 程序并在付款后收到激活密钥）
2.  我希望能够将注册密钥存储在我的服务器 (Joomla) 上并将密钥与我现有的用户相关联。然后 PHP 程序将与服务器检查以验证密钥是否正确。最好的方法是什么？

我已经尝试过研究这个问题，但我一直在做空。我知道 Joomla 有一个内置的 XML-RPC 插件，但完全不知道如何从组件内部操作它。

任何帮助是极大的赞赏

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T08:29:30.460

“（即一个人购买了一个 PHP 程序并在付款后收到一个激活密钥）”

当他们购买程序时，您也会交出源代码，因此您也无法阻止他们更改代码:)

您可以做的是围绕“软件即服务 (SAAS)”模型构建您的服务。看看它，看看是否有帮助

# c# - 从int转换为float的问题

> ID：1018231
> 
> 赞同：13
> 
> 时间：2009-06-19T14:25:29.917
> 
> 标签：c#, floating-point

有一种我无法理解的奇怪行为。同意浮点数是近似值，因此即使是显然返回没有十进制数的数字的操作也可以近似为带有小数的东西。

我正在这样做：

```
int num = (int)(195.95F * 100); 
```

由于这是一个浮点运算，我得到 19594 而不是 19595 .. 但这是正确的。

令我困惑的是，如果我这样做

```
float flo = 195.95F * 100;
int num = (int) flo; 
```

我得到 19595 的正确结果。

知道为什么会这样吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-19T14:39:09.827

我查看了这是否是编译器在进行数学运算，但即使您强制执行它，它也会以这种方式运行：

```
static void Main()
{
    int i = (int)(GetF() * GetI()); // 19594
    float f = GetF() * GetI();
    int j = (int)f; // 19595
}
[MethodImpl(MethodImplOptions.NoInlining)]
static int GetI() { return 100; }
[MethodImpl(MethodImplOptions.NoInlining)]
static float GetF() { return 195.95F; } 
```

看起来不同之处在于它是保留在寄存器中（比正常 r4 宽）还是被强制到`float`变量中：

```
L_0001: call float32 Program::GetF()
L_0006: call int32 Program::GetI()
L_000b: conv.r4 
L_000c: mul 
L_000d: conv.i4 
L_000e: stloc.0 
```

对比

```
L_000f: call float32 Program::GetF()
L_0014: call int32 Program::GetI()
L_0019: conv.r4 
L_001a: mul 
L_001b: stloc.1 
L_001c: ldloc.1 
L_001d: conv.i4 
L_001e: stloc.2 
```

唯一的区别是`stloc.1`/ `ldloc.1`。

这得到以下事实的支持：如果您进行优化构建（这将删除局部变量），我会得到相同的答案（19594）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:33:03.300

这段代码...

```
namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            float result = 195.95F*100;
            int intresult = (int)(195.95F * 100);
        }
    }
} 
```

给这个 IL

```
.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       14 (0xe)
  .maxstack  1
  .locals init ([0] float32 result,
           [1] int32 intresult)
  IL_0000:  nop
  IL_0001:  ldc.r4     19595.
  IL_0006:  stloc.0
  IL_0007:  ldc.i4     0x4c8a
  IL_000c:  stloc.1
  IL_000d:  ret
} // end of method Program::Main 
```

看IL_00001 -> 编译器已经计算过了。否则有十进制 -> 二进制转换问题

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:52:18.957

Mark 的回答是正确的，因为它是 nativefloat 和 float32/float64 之间的转换。

这在 CLR ECMA 规范中有介绍，但[David Notario](http://blogs.msdn.com/davidnotario/archive/2005/08/08/449092.aspx)比我解释得好得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T14:40:25.097

尝试在第二个示例中将 float 转换为 double ：

```
double flo = 195.95F * 100;
int num = (int) flo; 
```

我猜在您的第一个示例中，编译器使用 double 来保存中间结果，因此在浮点情况下，您会失去精度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:27:52.890

当你乘以 100 时，这是一个整数，所以它在该步骤进行隐式转换。如果你在 100 后面加上“F”，我敢打赌它们会是一样的。

当它是引用类型时，我通常使用带括号的装箱/拆箱。当它是值类型时，我尝试使用 Convert 静态方法。

尝试 Convert.ToSingle(YourNumber); 以获得更可靠的转换。

高温高压

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T14:31:30.900

我无法回答为什么第二个有效而第一个无效。但是，我可以告诉你 195.95 是二进制中的非终止十进制数，因此肯定会发生这样的舍入错误。

尝试转换为双精度而不是浮点数。您也可以使用货币或小数类型而不是浮点数。这将以不同方式和更准确地存储数字。

有关浮点数和 IEEE 表示的更多信息，请访问此处：

[http://en.wikipedia.org/wiki/IEEE_754](http://en.wikipedia.org/wiki/IEEE_754)

# c# - .NET GUI - C# 与 C++/CLI

> ID：1018233
> 
> 赞同：8
> 
> 时间：2009-06-19T14:25:58.540
> 
> 标签：c#, windows, user-interface, c++-cli

我正在编写一个需要一些列表框、按钮、文本框的小应用程序。它将与 Boost、MySQL 等 C++ 静态库链接。该项目需要win32功能。我认为 Winforms 会很好（MFC 和 CodeJock 需要太多时间）。

所以 C++/CLI 似乎非常适合这项工作。只需在 GUI 旁边使用标准 C++。然后我跑过线程，建议你用 C# 编写你的 GUI。然后对标准 C++ DLL 使用 p/Invoke（慢）或 C++/CLI 接口。

示例：[http ://social.msdn.microsoft.com/Forums/en-US/clr/thread/6ae877ac-07b4-4d26-8582-de475ee9a5cb](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/6ae877ac-07b4-4d26-8582-de475ee9a5cb)

为什么？将 C# 用于您的 winforms GUI 而不是 C++/CLI 有什么优势（它们看起来相同，命令相同）。使用 C++/CLI 可执行文件而不是标准 C++ 可执行文件有什么缺点。我可以理解跨平台兼容性是否是一个问题，但是您可以简单地不使用托管功能（GUI 除外）。

我不明白你为什么要使用 C#，然后用“引擎 DLL”将它分开。当然，除非“引擎 DLL”也被用于其他应用程序。

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-19T14:55:37.827

我认为关于这个问题的大多数建议都围绕着这样一个事实，即 C# 只是一个比 C++/CLI 更好的创建 .NET 应用程序的环境。语法更简洁，工具更好——无论是在 Visual Studio 中还是来自 3rd 方。您将从几乎都更熟悉 C# 的开发人员那里获得更多更好的支持。

C++/CLI 应用程序与标准 C++ 完全不同，所有这些 ^ 和 % 字符我至少觉得它不是 C++。

大多数建议也来自您想要创建 .NET 应用程序的观点，而 C++/CLI 更多地用作粘合层。每当我使用 C++/CLI 时，总是不情愿地而且几乎总是因为一些第三方库有许多复杂的 C/C++ 对象，它会传递它。使用 C# 和 P/Invoke 时，您通常必须创建类来镜像您正在与之交互的软件的 C++ 头文件中的结构和类。保持同步是劳动密集型的，而且很容易犯错误。此外，弄清楚如何用指向结构数组结构的指针来编组结构将使您的大脑融化！

我的一般建议是使用 C#（或 VB.NET）为您的应用程序创建尽可能多的代码。当您调用 Win32 API 和/或 3rd 方 SDK 的需求有限且接口和参数简单时，请使用 P/Invoke。如果无法做到这一点，请使用 C++/CLI 作为粘合层。

在团队环境中，您的开发人员会感谢您将 C++/CLI 的使用限制在绝对、肯定需要的地方。C++/CLI 专业知识并不常见。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-19T15:01:54.180

就个人而言，我喜欢 C++/CLI，但我还是更愿意用 C# 编写我的 UI。

C++/CLI**非常**适合直接使用 Win32 或与遗留代码交谈，但在 UI 代码方面我不喜欢它有点过于冗长。C# 中的 WinForms UI 代码既漂亮又简单（大部分情况下，哈哈）。用 C++ 编写 UI 代码几乎总是一团糟（看看 MFC）。

为什么不在一个 C# 程序集中创建 UI，然后将所有低级代码放在 C++/CLI 程序集中？C++/CLI 的好处是您可以创建一个托管层，您的 C# 代码可以轻松调用它。然后，该托管层可以轻松地将调用转发到直接 C++ 或 C 代码的本机层。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T15:12:55.280

> 将 C# 用于您的 winforms GUI 而不是 C++/CLI 有什么优势（它们看起来相同，命令相同）？

它们看起来不一样。在我看来，C# 更简洁，并且有一些有用的抽象。对 C# 或 VB.net 的工具支持也非常好。

[在此处查看示例比较](http://en.wikipedia.org/wiki/C%2B%2B/CLI#Finalizers_and_automatic_variables)

并且不要忘记高效的语言特性，如 Lambda 表达式、LINQ、类型推断等，这些特性往往会首先触及 C# 并很快渗​​透到 VB.net，但很少能找到 C++/CLI 的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T14:59:36.070

我想知道这一点，因此在 Visual Studio 2008 中，我使用 C++/CLI 作为语言创建了一个新的 Windows 窗体应用程序项目。它做的第一件事就是抛出一个错误。所以我认为这表明这些东西还没有完全准备好使用。也许我没有给它足够的机会！

> ```
> The file 'c:\source\Test\Test\Form1.h' does not
> support code parsing or generation
> because it is not contained within a
> project that supports code. 
> ```

每当我尝试打开向导创建的 Form1.h 文件时都会发生这种情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T15:18:13.677

> 我正在编写一个需要一些列表框、按钮、文本框的小应用程序。它将与 Boost、MySQL 等 C++ 静态库链接。项目需要win32功能...

**我可能会面临被否决的风险，但是，如果您的大部分代码已经用 C++ 编写并使用 C++ 功能，那么用Native** C++编写 GUI 不是更简单。

您不必使用 MFC 来创建 GUI。看看[Qt4](http://doc.trolltech.com/)，他们有很好的教程，所以你可以在几个小时内开始用 C++ 编写 GUI。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-07T09:09:11.783

是的，似乎大多数自动建议使用 C# 而不是 C++ 的人假设你已经了解 C# 或者愿意花时间学习它。我看不出对 C++/CLI WinForms 的所有仇恨是什么。至少如果你想移植现有的 C++ 代码，它就能完成工作。至少我已经使用 WinForms/CLI 在我现有的 C++ 中添加了一个 GUI。是的，如果我从头开始，我可能会使用 C#，因为：

# 1 我已经知道 C

# 2 我知道使用 C 编写代码更容易、更快捷

但是就像我说的，如果你已经有了 C++ 代码，你真的想从头开始吗？

# c# - .NET 中字节与 int 的性能

> ID：1018234
> 
> 赞同：12
> 
> 时间：2009-06-19T14:25:58.603
> 
> 标签：c#, .net

在 .NET 之前的世界中，我一直认为 int 比 byte 快，因为这就是处理器的工作方式。

现在，即使字节可以工作，使用 int 也是一种习惯，例如当 byte 是存储在数据库中的内容时

问题：从性能/内存的角度来看，.NET 如何处理字节类型与 int。

更新：感谢您的输入。不幸的是，没有人真正回答这个问题。.NET 如何处理字节与整数。

如果性能没有差异，那么我喜欢chills42 的表述方式： int 用于算术运算 bytes 用于二进制 我将继续这样做。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-19T14:32:02.477

您的 .NET 之前的假设是错误的——周围总是有很多计算机系统，虽然名义上是“字节可寻址”，但必须通过读取一个完整的字来设置一个字节，将其屏蔽以改变一个字节其中，把它全部写下来——比设置一个完整的单词要慢。它取决于处理器和内存连接方式的内部结构，而不是程序员可见的架构。

无论是在 .NET 还是本机代码中，首先关注的是使用数据在语义上对您的应用程序是正确的，而不是试图双重猜测计算机系统的架构师——“过早的优化是编程中万恶之源”，引用 Knuth 的话霍尔。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T14:34:10.583

您是在谈论存储空间还是对字节的操作？如果是存储空间，是的，它占用的空间比 int 少（1 字节对 4 字节）。

就字节上的算术运算而言，我没有原始数字，实际上只有分析器才能将它们提供给您。但是，您应该考虑到算术运算不是在原始字节实例上完成的。相反，它们被提升为 int，然后在 int 上完成操作。这就是为什么您必须显式转换如下操作的原因

```
byte b1 = 4;
byte b2 = 6;
byte b3 = b1 + b2;  // Does not compile because the type is int 
```

因此，在一般情况下，我认为可以肯定地说 int 上的算术运算比字节上的运算要快。仅仅因为在字节的情况下，您支付（可能非常小的）类型提升成本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-23T13:37:27.053

好的，我刚刚打开了反汇编窗口。除了常规的“mov byte”之外什么都没有

因此，.NET/CLR 不会为此添加任何内容。并且所有算术运算都是针对 int 值进行的，因此 bytes 和 int 之间没有区别。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T14:37:09.267

除非您已完成设计并需要找到优化的巧妙方法，否则只需使用您需要的东西。

如果您需要一个计数器或正在做基本的数学运算，这可能就是您想要的，如果您正在处理二进制数据，请使用一个字节。

最后，每种类型都应针对其预期目的进行优化，因此最好将时间花在设计上而不是优化上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:28:53.917

与任何其他平台相同。为什么 .NET 会改变这一点？代码仍然必须在同一个 CPU 上运行，它与往常一样具有相同的性能特征。

这意味着您仍应*默认*使用`int`。

# objective-c - 如何以编程方式生成按钮？

> ID：1018235
> 
> 赞同：0
> 
> 时间：2009-06-19T14:26:09.167
> 
> 标签：objective-c, iphone, xcode

我想使用循环在视图上生成按钮。假设我想生成 3 个按钮。我在主视图中添加了一个 uiview btnframe。现在我想使用该视图的坐标在该视图内添加按钮。如何计算 btnframe 的边界？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:35:42.110

那么你希望你的按钮是什么尺寸的？如果您将它们添加到视图中，它们会继承这些坐标，因此如果您执行 0,0，它将位于您添加到的视图的左上角。

```
for(int x=0;x<3;x++){
CGRect rect = CGRectMake(0,20 * x,100,20);
UIButton *button = [[UIButton alloc] initWithFrame:rect];
[btnframe addSubview:button];
.....
} 
```

基础知识，这会给你三个按钮。

如果你想要一个这样的网格就可以了。

```
for(int x=0;x<5;x++){
    for(int y=0;y<5;y++){
        UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(x * 100, y * 20, 100, 20)];
        [button setText:[NSString stringWithFormat:@"%d,%d",x,y]];
        [button addTarget:self action:@selector(changeView:) forControlEvents:UIControlEventTouchUpInside];
        [mainView addSubview:button];
    }
} 
```

这为您提供了 25 个按钮，每行 5 个。

# scripting - 是否可以从客户端自动回发？

> ID：1018241
> 
> 赞同：1
> 
> 时间：2009-06-19T14:27:24.060
> 
> 标签：scripting, automation, postback

我的一位客户需要定期从 Web 服务中提取客户数据。数据本身通过 javascript 回发以 CSV 文件的形式提供，服务网站内的大多数导航也是如此。

目前，整个系统最严重的瓶颈是需要人工登录网页，导航到下载页面，然后手动将下载的文件添加到系统的其余部分。

通过回发下载文件的过程可以自动化吗？（例如通过可以通过 cron 运行的 shell 脚本？）

如果是这样，您会推荐什么作为最合适的工具？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-20T21:52:08.083

万一有人再次遇到这个问题，我找到了一个解决方案：

诀窍是使用[Mechanize](http://wwwsearch.sourceforge.net/mechanize/)`Browser.submit()` ，并在适当的页面上进行一系列调用。

其他人可能还会遇到的一个问题是 ASP.NET 页面（根据我的经验，基于回发的导航的最大来源）还需要`__EVENTTARGET`在表单中调用一个隐藏参数，当您使用 mechanize 时将不存在该参数。

这些页面上的`__doPostBack('foo')`函数通过每个链接上的 javascript onclick 事件提供相关值`__EVENTTARGET`，但由于 mechanize 不使用 javascript，您需要自己设置这些值。

我制作了一个快速的小实用功能，可以在我的脚本中使用它：

```
def add_event_target(form, target):
    #Creates a new __EVENTTARGET control and adds the value specified
    #.NET doesn't generate this in mechanize for some reason -- suspect maybe is 
    #normally generated by javascript or some useragent thing?
    form.new_control('hidden','__EVENTTARGET',attrs = dict(name='__EVENTTARGET'))
    form.set_all_readonly(False)
    form["__EVENTTARGET"] = target 
```

我希望这对以后可能遇到这个问题的人有所帮助。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-06-19T14:30:16.223

您可以使用 AJAX 计时器。检查[asp.net/ajax](http://asp.net/ajax)网站。

# asp.net - 发现 JS 错误 - “停止运行此脚本？”

> ID：1018246
> 
> 赞同：0
> 
> 时间：2009-06-19T14:28:15.260
> 
> 标签：asp.net, javascript, ajax, debugging

我正在使用 ajax、回调、javascript 等相当复杂的 ASP.NET 网页。我间歇性地遇到此错误：

> 停止运行此脚本？此页面上的脚本导致 IE 运行缓慢...

非常感谢找到罪魁祸首的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:31:57.920

如果您有无限循环或未返回的同步 ajax 调用，则可能会发生这种情况。我建议您使用带有 Firebug、Fiddler 的 Firefox 或 IE 开发工具来调试问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T17:46:39.623

我建议阅读以下文章：

[http://www.julienlecomte.net/blog/2007/10/28/](http://www.julienlecomte.net/blog/2007/10/28/)

简而言之，您描述的错误消息发生在从单个 javascript 入口点执行的代码运行很长时间时。如果您可以将长处理分成几部分并使用 setTimeout() 顺序调用它们，您将不再收到错误消息。

从文章中可以看出，长时间运行的 javascript 例程的一个很好的模板：

```
function doSomething (callbackFn [, additional arguments]) {
    // Initialize a few things here...
    (function () {
        // Do a little bit of work here...
        if (termination condition) {
            // We are done
            callbackFn();
        } else {
            // Process next chunk
            setTimeout(arguments.callee, 0);
        }
    })();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:32:56.547

在尝试调试 javascript 时，以下一些内容很有帮助：

*   安装 firebug - 它能够分析您的应用程序，这可以引导您找到脚本中可能出现减速的地方
*   如有疑问，请使用警告语句。在你的代码中加入它们并使用它们来找出你的 javascript 慢的地方。
*   看看这个 SO question 以获得更多的[javascript 调试技巧](https://stackoverflow.com/questions/988363/how-do-you-debug-your-javascript-code)，或者这个 question on [how to debug javascript in IE](https://stackoverflow.com/questions/170164/debugging-javascript-in-ie)
*   将您的 AJAX 调用包装在 try/catch 块中 - 文章[Debugging AJAX in Production](http://queue.acm.org/detail.cfm?id=1515745)描述了该技术

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T14:45:33.277

我发现在 IE 和任何其他浏览器中弹出此问题的主要原因是字符串操作。如果您经常连接字符串，则 IE 性能会随着字符串的增长而受到巨大影响。

但正如许多人所建议的那样，使用开发工具有望将您带到问题区域，如果需要，我们可以从那里提供帮助。

# apache-flex - 如何防止 TextField 中的向上/向下箭头默认行为？

> ID：1018259
> 
> 赞同：4
> 
> 时间：2009-06-19T14:29:56.303
> 
> 标签：apache-flex, flash, actionscript-3, textfield

我正在为关键字创建一个输入字段，当用户写作时，我在插入符号位置下方的列表中显示关键字建议。输入字段是单行的，所以我使用向上/向下箭头键选择一个建议，然后 Enter 插入它。它大部分都在工作，除了向上/向下键还将插入符号位置更改为`TextField`.

我尝试在事件侦听器中使用`preventDefault()`and来更改所选建议，但这并没有改变任何东西。我检查了触发事件时carret还没有移动，但是在视觉上我可以看到它在释放键之前正在移动（键向上）。`stopImmediatePropagation()``KeyboardEvent.KEY_DOWN``KeyboardEvent.KEY_DOWN`

我可以只保存插入符号的位置，然后重置为默认行为。但这将适当地涉及一些使用计时器的类似黑客的代码。

那么有谁知道如何防止默认行为？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T19:13:46.797

你无法阻止它，但你可以扭转它。为此，您将具有不同优先级的处理程序添加到同一事件 - KeyboardEvent.DOWN。一个将在 TextField 之前执行，并保存选择索引，另一个将在之后恢复它们。工作代码如下：

```
 import flash.events.Event;
    import flash.events.KeyboardEvent;
    import flash.ui.Keyboard;

    import mx.controls.TextInput;
    import mx.events.FlexEvent;

    public class FooledTextInput extends TextInput
    {
        private var ssi : int = 0;
        private var sei : int = 0;

        public function FooledTextInput()
        {
            super();

            this.addEventListener(KeyboardEvent.KEY_DOWN, onBeforeKeyDown, false, 10000);
            this.addEventListener(KeyboardEvent.KEY_DOWN, onAfterKeyDown, false, -10000);
        }

        private function onBeforeKeyDown(e : KeyboardEvent) : void
        {
            if (e.keyCode == Keyboard.UP || e.keyCode == Keyboard.DOWN)
            {
                ssi = this.selectionBeginIndex;
                sei = this.selectionEndIndex;
            }   
        } 

        private function onAfterKeyDown(e : KeyboardEvent) : void
        {
            if (e.keyCode == Keyboard.UP || e.keyCode == Keyboard.DOWN)
            {
                this.setSelection(ssi, sei);
            }   
        } 
    } 
```

您可能想要更好的 ssi（选择开始索引）和 sei（选择结束索引）名称，我懒得找一些。我认为这个解决方案是基于 Alex Harui 的一篇文章，我记不太清了，但他的博客上有很多与 Flex 相关的好东西。

**更新：**对于 spark TextInput，不仅可以防止，而且真的很容易。您需要做的就是在捕获阶段捕获事件并停止传播。代码：

```
package
{
    import flash.events.KeyboardEvent;
    import flash.ui.Keyboard;

    import spark.components.TextInput;

    public class HackedTextInput extends TextInput
    {
        public function HackedTextInput()
        {
            super();
            addEventListener(KeyboardEvent.KEY_DOWN, onBeforeKeyDown, true);
        }

        private function onBeforeKeyDown(e:KeyboardEvent) : void
        {
            if (e.keyCode == Keyboard.UP || e.keyCode == Keyboard.DOWN)
            {
                e.stopImmediatePropagation();
            }   
        }  
    }
} 
```

请注意 addEventListener 调用中的最后一个参数，该参数设置为 true 以便在捕获阶段调用处理程序。遗憾的是，此解决方案不适用于 mx TextInput，仅适用于 spark 。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-07-17T16:53:43.753

我在这里发布了解决此问题的方法：
[AS3: setSelection Up Arrow Override](https://stackoverflow.com/questions/4928474/as3-setselection-up-arrow-override/6725314#6725314)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T23:37:43.367

bug-a-lot 的解决方案很有趣——我没想过要使用优先级。相反，我利用了事件过程的不同阶段。对我来说，问题是决定箭头键是否应该在给定的文本字段中前进或后退一个字符，或者跳转到表单中的下一个或上一个字段。

首先，我覆盖了舞台对键的事件处理：

```
stage.addEventListener(KeyboardEvent.KEY_UP, typing);
// Sneak in before the normal processing handles right and left arrow keystrokes.
stage.addEventListener(KeyboardEvent.KEY_DOWN, pretyping, true, 10); 
```

请注意，我将处理每个键两次 - 在系统执行之前它是魔法（在 KEY_DOWN 之前调用预输入），所以我可以在 Flash 移动它之前和系统处理它之后查看插入符号的位置（键入，在 KEY_UP 之后调用） .

```
/** Capture prior state of text field so we can later tell if user should tab to next field or previous field. */
private function pretyping(evt:KeyboardEvent):void {
    var keyString:String = Configuration.getKeyString(evt);
    if (isFocusInTextBox()) {
        var tf:TextField = getFocus() as TextField;
        capturePhaseCaret = tf.caretIndex;
    }
} 
```

getKeyString 是我的一种方法——它所做的只是将这些代码变成方便的助记符。isFocusInTextBox 是对我的焦点管理器的调用 - 我替换了标准焦点管理器以克服其他 Flash 问题。我只需要知道这个东西是否是一个文本字段。

接下来我必须在 Flash 已经移动插入符号甚至可能跳转到一个新字段之后处理密钥，并通过查看先前的状态，决定 Flash 做了什么并撤消它，然后做应该发生的事情。我的函数“打字”有很多本次讨论不需要的东西，但它所做的重要事情是调用allowKeyMapping。allowKeyMapping 决定用户是从文本字段中的最后一个字符位置输入向前箭头（或向下箭头），还是从开头输入向后箭头。如果是这样，“打字”将分别跳到下一个或上一个字段。

```
 /** Prefer default behavior and do not allow certain kestrokes to be reinterpreted by key mappings, such as left and right cursor keys in text boxes. */
    private function allowKeyMapping(keyString:String) {
        var allow:Boolean;
        // If focus is in a text field, allow right arrow to advance to next field only if caret is at end of text.
        // Conversely, allow left arrow to back up to previous field only if caret is at beginning of text.
        // The trick is that the normal processing of keystrokes by TextFields occurs before this method is called,
        // so we need to know the caret position from before the key was pressed, which we have stored in capturePhaseCaret, set in pretyping.
        if (isDragging) {
            allow = false;
        }
        else if (isFocusInTextBox()) {
            var tf:TextField = getFocus() as TextField;
            if (keyString == Configuration.LEFT_CURSOR_KEY) {
                allow = tf.caretIndex == 0 && capturePhaseCaret == 0;
            }
            else if (keyString == Configuration.RIGHT_CURSOR_KEY) {
                allow = tf.caretIndex == tf.text.length && capturePhaseCaret == tf.text.length;
            }
            else {
                allow = true;
            }
        }
        else {
            allow = true;
        }
        return allow;
    } 
```

对不起，我没有准备一个紧凑的例子。我只是认为重要的是要强调，无论你是否希望它们发生，你都可以绕过 Flash 为你做事的偏好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-28T15:25:47.113

bug-a-lot 的解决方案可能会产生一些轻弹效果。

有一个有效的解决方案和使用这里描述`stage.invalidate()`的阶段的好技巧`Event.RENDER`：

[AS3：setSelection 上箭头覆盖](https://stackoverflow.com/questions/4928474/as3-setselection-up-arrow-override)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T23:18:29.673

这是我解决该问题的方法。我确信有更好的方法，但它可能需要扩展 TextInput 控件。

```
private function onKeyDown(event:KeyboardEvent):void
{
    if(event.keyCode == flash.ui.Keyboard.UP)
    {
        var begin:int = textinput.selectionBeginIndex;
        var end:int = textinput.selectionEndIndex;
        textinput.setSelection(begin,end);
    }
} 
```

不性感，但它有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-21T21:10:33.593

默认情况下，事件在 UIComponent 上的优先级为 0，因此您可以随时停止阻止某些事情发生，在这里您可以阻止所有 KeyboardEvent.KEY_DOWN

```
yourObject.addEventListener(KeyboardEvent.KEY_DOWN, _preventDefault, false, 1, true );
private function _preventDefault(event:KeyboardEvent):void 
{
event.preventDefault();
event.stopImmediatePropagation();
} 
```

# c - 参考 ANSI C 中的设计模式？

> ID：1018264
> 
> 赞同：10
> 
> 时间：2009-06-19T14:30:56.627
> 
> 标签：c, design-patterns

您能否指出标准 C（C89 或 C99）中设计模式的参考？（不是 C#，不是 C++。）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-19T14:40:39.150

看看 Axel-Tobias Schreiner 的电子书[Object-Oriented Programming with ANSI-C](http://www.cs.rit.edu/~ats/books/ooc.pdf)。您必须手动处理某些模式的某些方面，但您将能够实现许多更简单的 GoF 模式。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T14:44:55.697

设计模式应该与语言无关——不幸的是，它们中的大多数都假定了一个面向对象的环境。

[与来自面向对象领域的 C 作斗争？](https://stackoverflow.com/questions/674722/struggling-with-c-coming-from-object-oriented-land)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T15:25:33.523

根据 Nick 的回答，我建议您学习如何使用 C 实现类似 cplusplus 的东西（例如，带有指向函数指针表的指针的 C 结构，模拟带有虚函数的 C++ 类），这意味着了解 C++ 是如何实现的由编译器实现。完成此操作后，您将能够阅读 C++ 的设计模式并使用 C 实现它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-19T19:57:29.733

如果您需要有关实时嵌入式 C 设计模式的信息，我可以推荐这两本书

*   “实时设计模式：实时系统的稳健可扩展架构”（Douglass、Bruce Powel | Elsevier | 第 1 版 | 2002）和
*   “C 中嵌入式系统的设计模式：嵌入式软件工程工具包”（Douglass、Bruce Powel | Elsevier | 第 1 版 | 2011）

一些高级模式依赖于前面提到的面向对象特性的“模拟”。模式描述得非常好（UML 图，示例）。我喜欢在应用模式后影响上下文的“力量”（必须考虑什么？）的讨论。

# derby - 德比实体关系图

> ID：1018265
> 
> 赞同：4
> 
> 时间：2009-06-19T14:30:58.343
> 
> 标签：derby, erd

是否有任何免费软件可以提取我的 derby 数据库图表？（比如 MySQL 的 MySQL Workbench？）

或者也许是netbeans的插件？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-26T14:38:11.427

如果它有 JDBC 驱动程序（derby 有一个），您可以使用任何可以绘制所需图表并支持 JDBC 的开源工具（大多数开源数据库工具都支持 JDBC）。我喜欢这个：[PowerArchitect](http://code.google.com/p/power-architect/downloads/list)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-03-13T00:25:24.610

如果您仍在寻找解决方案，有一个很好的 NetBeans 开源插件，它为您的 Derby 数据库提供了一个 ERD。这是下载插件的链接：[https ://java.net/projects/dber/downloads/directory/1.2](https://java.net/projects/dber/downloads/directory/1.2)

不仅有一个 NetBeans 插件，而且它们还有一个独立版本。

# javascript - 使用 JavaScript 编辑 XML 文件？

> ID：1018270
> 
> 赞同：3
> 
> 时间：2009-06-19T14:31:31.243
> 
> 标签：javascript, xml

是否可以从服务器获取 XML 文件（不是 HTML），使用客户端 JavaScript 添加/删除/编辑其中的特定部分，然后将其发送回服务器进行保存？JSON 或任何其他标记/数据交换格式也适用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:38:59.450

是的。使用 jQuery...

```
$.get("myGetUrl.php", function(data) {
  var xml = $(data);

  xml.find("myNode").text("newValue");

  $.post("myPostUrl.php", xml, function(resp) {
    alert(resp);
  }, "xml");
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:38:19.967

是的，这是可能的。搜索“XML DOM”，您可以很容易地在客户端上对其进行编辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T14:38:45.567

是的。您可以通过 AJAX 读取 XML 文档并像使用 HTML 一样遍历其 DOM。如果你使用像 jQuery 这样的框架，那就更容易了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T14:38:52.290

当然。您可以使用 XMLHttpRequest 对象对文件发出请求，对数据执行任何您需要的操作，然后使用另一个 XMLHttpRequest 将整个文档发回。您可以使用 XML 来执行此操作（这对于下载原始文档可能是最简单的），但您可能最容易使用 JSON 将回传到服务器。

您将需要一个服务器端脚本（即 PHP、ASP、Ruby）来接收发布的数据，根据需要对其进行格式化（即，将 JSON 转换为 XML 文档）并将其保存为文件或数据库。

这个问题太笼统了，无法进入具体实施，但如果您需要这些步骤的额外帮助，请询问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:43:14.873

当然。如果服务器使用 text/xml MIME 类型提供 XML 文档，您可以使用它`XMLHttpRequest`来获取 XML 文档。该`responseText`属性将为您提供 XML 文本，但浏览器也会为您解析 XML 并在`responseXML`. 您可以随意修改该 DOM，然后将其序列化并将其发送回服务器。

您也可以以同样的方式使用 JSON。您用于`XMLHttpRequest`从服务器获取数据，然后`jsonData = eval(xhr.responseText)`将 JSON 数据转换为 JavaScript 对象。

每个主要的 JavaScript 库都有模块/函数来帮助执行这些方法中的任何一种。XML 和 JSON 是 Ajax 应用程序中最流行的两种数据交换方法。

# html - 什么是免费的、基于 Windows 的 HTML/CSS 页面设计应用程序？

> ID：1018278
> 
> 赞同：4
> 
> 时间：2009-06-19T14:32:59.837
> 
> 标签：html, css

我的小弟弟想开始做网站，我建议使用 Frontpage 或 Dreamweaver。有什么好的免费替代程序呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:35:59.893

[Aptana Studio](http://aptana.com/studio)很不错。它具有html和css的智能感知，这将帮助他更快地学习。此外，[HTMLDog](http://www.htmldog.com)是一个很好的教程网站。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T15:45:51.780

你哥哥到底有多想学点东西？如果他真的想学习如何正确地做事，那么我会从一个简单的文本编辑器开始，可能带有代码突出显示和一个免费的图像编辑器。然后，他可以真正深入研究语义 HTML、CSS 以及 Web 服务器如何在基本层面上工作，而无需学习复杂工具的任何干扰。

这有点像学习在变速杆上驾驶，这很痛苦，但最终你可能会成为一个更好的司机。如果他以后有兴趣学习 PHP、JSP 或 ASP.NET 之类的 Web 编程语言，这将是双倍的。我认为很多人在开始进行 Web 编程时并没有掌握基础知识，所以最终感觉就像是黑魔法（我在看你的 ViewState）。

例子：

*   文本编辑器：记事本++
*   图像编辑器：Gimp，或此列表中的其他内容：[在线 Photoshop 替代品](http://esdev.net/5-free-online-photoshop-alternatives/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T15:51:12.040

就个人而言，我建议一个阅读清单 - 可能取决于他的年龄 - 和记事本（或[记事本++](http://notepad-plus.sourceforge.net/uk/site.htm "链接到 Notepad++ 主页。")）。

我知道这可能是一个更陡峭的学习曲线，但如果他使用 WYSIWYGs 开始，他将有一个地狱般的时间来学习他可以安全地 - 并且应该 - 取出什么，以及如何自己管理代码，以后。当我第一次开始使用 xhtml 时，我发现记事本是我能找到的最好的编辑器。它完成了工作，并确保你学会了。

现在，在 Linux 上，与我尝试过的其他选项相比，我仍然更喜欢 Gedit（向 Vi 和 Emacs 粉丝道歉）。请注意，我可能只是相反。之前有人建议过... =）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T14:38:11.263

可视化 Web 开发人员速递。 [http://www.microsoft.com/express/vwd/](http://www.microsoft.com/express/vwd/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:34:48.850

[nvu](http://www.net2.com/nvu/)是一个很好的解决方案。它也是跨平台的 Window、Mac 和 Linux。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T14:40:24.753

如果你不想学习 Html，我喜欢 NVU。不过我的建议是使用处理 html、css 等的编辑器，以便他了解标签的工作方式、css 的工作方式等。为此，我可以推荐 2 个我过去经常使用的编辑器：

Html-Kit： [http :](http://htmlkit.com/) [//htmlkit.com/](http://www.aptana.com/) （免费提供大量插件 ）

对于 CSS，我倾向于喜欢可视化编辑器，所以我硬着头皮买了 TopStyle 的许可证：[http](http://www.topstyle4.com/) ://www.topstyle4.com/ 有一个旧的免费版本，效果很好。

祝你兄弟好运

标签

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T15:02:55.860

如果您只想编辑代码（不是所见即所得），您可以使用轻量级记事本替代品，[在此处讨论](https://stackoverflow.com/questions/34215/what-are-the-best-alternatives-to-notepad)。对于 Windows，我建议尝试[Intype](http://intype.info/home/index.php)、[e-texteditor](http://www.e-texteditor.com/)和[komodo edit](http://www.activestate.com/komodo_edit/)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T16:32:53.457

我认为[Shea](https://stackoverflow.com/questions/1018278/what-is-a-free-windows-based-html-css-page-design-app/1018691#1018691)和[ricebowl](https://stackoverflow.com/questions/1018278/what-is-a-free-windows-based-html-css-page-design-app/1018715#1018715)是正确的：你的兄弟是想做一些*平庸*的网站，还是他真的想学习 HTML 和 CSS 是如何工作的以及为什么工作，这样他就有了做一些*优秀*网站的基础？

如果您 a) 不了解 HTML 或 CSS，并且 b) 您需要在很短的时间内构建一个功能有限的小型网站，那么“网页构建器”类型的应用程序非常棒。这是 Frontpage 擅长的地方，因为它允许任何人构建网页。不幸的是，所有方便的“单击此处添加链接”和“拖到此处以将其包含在您的页面中”功能都无法在您需要执行应用程序本身无法执行的操作时立即为您提供帮助。

如果您想在您的网站上嵌入 Google 地图，但您的应用程序在工具栏中没有相应的按钮怎么办？如果 Opera 或 Internet Explorer 6 用户看起来不正确，并且没有“使站点 100% 兼容”菜单项，您如何修复该站点？当您的网站需要拨号用户 5 分钟下载时，您会打电话给谁？

Frontpage（我猜现在是 Microsoft Expression Web）和类似的程序使您免受潜在的技术问题的影响，这最终成为一种责任。

[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)是一个不错的选择，[TextPad](http://www.textpad.com/)也是如此；任何一个都提供语法突出显示和着色，如果您刚开始，这将非常有用。前者是免费的，后者是共享软件。 [Eclipse](http://www.eclipse.org/)非常通用且免费，尽管当您开始使用它时可能会令人生畏。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T16:34:51.960

NVU 的开源 WYSIWYG 编辑器已经停产，但基于相同原始代码的版本仍在继续开发中，名称为 kompozer，可在[http://www.kompozer.net/](http://www.kompozer.net/)找到。如果您正在寻找与 Dreamweaver 类似的东西，而无需花费高昂或高端功能，那么这是一个非常强大的免费选项。即使在使用 WYSIWYG 应用程序时，了解 HTML 和 CSS 通常也是一个好主意。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2009-06-19T14:47:58.280

它不是免费的，它适用于 Mac OS X，但值得购买一台新电脑。

[尾声](http://www.panic.com/coda)。

# language-agnostic - 为什么要区分返回值的方法和不返回值的方法？

> ID：1018281
> 
> 赞同：5
> 
> 时间：2009-06-19T14:33:10.243
> 
> 标签：language-agnostic, programming-languages, language-design

为什么有些语言会区分返回值的方法和不返回值的方法？

即在Oracle 的PL/SQL 中，函数和过程之间的主要区别在于函数必须返回一个值，而过程不能。

同样对于不支持的语言，为什么不呢？

* * *

编辑：我发现了一个相关问题，可能会引起人们阅读此问题的兴趣：

*   [表达与陈述](https://stackoverflow.com/questions/19132/expression-versus-statement/19224#19224)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-06-19T15:07:51.390

因为在计算机科学理论和实践的最初概念中，函数和子程序几乎没有任何关系。

FORTRAN 通常被认为是实现这两者并展示了区别的第一种语言。（早期的 LISP 在这方面也起到了某种相反的作用，但它在学术界之外几乎没有影响）。

遵循数学的传统（CS 在 60 年代仍然是其中的一部分），函数仅被视为参数化数学计算的封装，仅旨在将值返回到更大的表达式中。你可以称之为“裸”（F = AZIMUTH(SECONDS)）只是一个微不足道的用例。

另一方面，子例程被视为一种命名一组旨在产生某种效果的语句的方式。参数极大地提高了它们的可用性，并且允许它们返回修改后的参数值的唯一原因是它们可以报告它们的状态而不必依赖全局变量。

所以，除了封装和参数之外，它们真的没有概念上的联系。

真正的问题是：“这么多开发人员怎么会认为他们是一样的？”

答案是 C。

当 K+R 最初为 PDP-11 设计他们的高级宏汇编器类型语言时（可能是在 PDP-8 上开始的？），他们没有硬件独立的幻想。实际上，该语言的每个“独特”特性都是 PDP 机器语言和体系结构的反映（参见 i++ 和 --i）。其中之一是函数和子程序在 PDP 中的实现是相同的，只是调用者只是忽略了子程序的返回值（在 R0 [, R1] 中）。

空指针就这样诞生了，并且在 C 语言接管了整个编程世界之后，随之而来的是这种 HW/OS 实现工件（尽管在几乎所有后续平台上都是如此）与语言语义相同的误解。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T15:00:26.523

在纯粹的或效果类型的设置中，存在天壤之别，因为显然“不返回任何东西”的方法仅对它们的副作用有用。

这类似于表达式和语句之间的区别，它可以整理语言并消除一类通常错误的程序（当然，这就是 C 不这样做的原因；））。

举一个小例子，当您清楚地区分表达式和语句时，`if(x = 3)`, 而不是在`if(x == 3)`语法上不正确（用于在需要表达式的地方使用语句），而不仅仅是类型错误（用于在需要布尔值的地方使用整数） . 这样做的好处是`if(x = true)`，在赋值是具有其右操作数的值的表达式的上下文中，也不允许基于类型的规则允许的情况。

在用 monad 封装效果的语言中，重要的区别在于：

*   返回`()`的函数是纯函数，并且只能返回一个无用的空值，称为`()`或发散
*   返回的函数`IO ()`（或某些其他 monad 中的单元）是没有“结果”的函数，除了 IO（或任何其他）monad 中的效果

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-10T08:50:18.903

对不起，我回答了一个两年前的问题，尤其是我自己的语言 Felix [http://felix-lang.org](http://felix-lang.org)独有的东西，但无论如何：)

在 Felix 中，函数和过程是根本不同的，不仅仅是过程有副作用并且在语句中被调用，而函数没有副作用并且在表达式中使用（因为 Felix 也有生成器，它们是函数副作用 .. ：）

不，执行模型根本不同，主要是出于性能原因，但并非完全不同。型号为：

*   函数将它们的返回地址和返回值放在机器堆栈上。
*   程序在堆上使用链表。程序代码是扁平的，它不使用机器堆栈。

这通常是低效的，那么为什么要这样做呢？答案是：Felix 程序都是潜在的协同程序（纤维）。他们可以通过访问通道将控制切换到另一个程序。这会导致控制权的交换。

*   出于性能原因，在控制交换上复制机器堆栈不是一种选择。
*   出于内存管理的原因，交换堆栈指针也不是一种选择。

操作系统通常会为线程交换堆栈指针，这相当快，但在线性地址机器上存在一个基本问题：您要么必须将堆栈的最大大小限制为一个可笑的小值，要么将线程数限制为一个可笑的小值。在 32 位机器上，甚至没有足够的地址空间来考虑这个解决方案。在 64 位机器上，堆栈交换具有更大的潜力，但当然用户需求总是在发布 3 天后增长超过硬件 .. :)

**Felix 只是交换一个指向基于堆的堆栈的指针，因此上下文切换速度非常快，并且浪费的地址空间非常少。**当然，成本是过程调用的堆分配。

在编译器中，很多理论模型的架构都是在“as-if”的基础上进行优化的，所以实际性能和实现可能与理论模型有很大的不同，前提是编译器可以证明你看不出来区别..除了被剥夺了悠闲地泡杯咖啡的机会:)

所以在这里，对于为什么函数和过程可能会被区别对待，你有不同的答案。

# algorithm - 重复数据删除算法

> ID：1018282
> 
> 赞同：2
> 
> 时间：2009-06-19T14:33:23.457
> 
> 标签：algorithm, duplicate-data

我想找到重复数据删除算法，主要是为了找到重复的文件。看起来第一步是识别具有相同时间戳、大小和文件名的文件。我可以对这些文件进行 MD5 校验和比较。除此之外，还可以比较文件的内容。我还应该注意什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T14:39:46.797

您有操作系统元信息（大小和时间戳）。其他元信息包括权限。您可以比较 inode 和 dnode 信息，但这并不意味着什么。

您有一个摘要（校验和）。

您有逐字节的详细信息。

还能有什么？您是否要求其他摘要？摘要比逐字节详细信息提供的信息更少。但是您可以轻松发明许多其他摘要。仅当您将摘要保存在某个地方时，摘要才有用，这样您就不会一直重新计算它。

如果您想为“主”副本保存摘要，您可以发明任何您想要的摘要。行数，字母“e”数，平均行长，任何东西都是一个潜在的有趣的总结。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-01-04T07:07:43.037

md5 有冲突问题（两个具有相同 md5 的文件可能仍然有不同的内容。）

如果对每个文件执行 SHA-1 哈希并比较哈希，则只有内容完全相同的文件才会具有相同的哈希。时期。

这也有助于忽略它们是否具有不同的名称、修改日期等。

有些人加倍努力并使用 sha-256，但这确实没有必要。大多数商业重复数据删除设备依赖于 SHA-1（也称为 SHA-160）。

如果您使用 SHA-1 比较文件，则不需要任何其他内容。

我知道这一点是因为我与不同的重复数据删除系统和供应商合作多年，并且我还编写了一个示例重复数据删除系统。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T14:38:05.240

有可用的产品。寻找重复文件侦探。可以按名称、时间戳、md5等算法进行匹配

# .net - 存储无法在服务器应用程序中散列的密码

> ID：1018284
> 
> 赞同：2
> 
> 时间：2009-06-19T14:33:46.543
> 
> 标签：.net, encryption

我有一个 .NET 服务器应用程序，它必须存储无法散列的密码，因为我使用的某些 API 需要纯文本密码。

这些密码也可以作为系统配置的一部分导出和导入到应用程序的另一个服务器实例中或用于备份目的。

加密数据肯定需要被其他服务器上的应用程序实例读取，而不是从它导出的服务器上读取。

什么是最安全的方法来实现这一点，而不会给用户带来太多麻烦，并且由于丢失/不可用的加密密钥而导致数据丢失的风险最小？

* * *

**编辑**

我正在寻找更多详细信息，例如：

*   如何/在哪里存储密钥
*   为每次安装生成唯一密钥并将其存储与应用程序范围的公共密钥

...不是使用哪种加密算法。

* * *

**编辑二**

我应该补充一点，这个应用程序将分发给客户在他们自己的服务器上运行。它是一个客户端/服务器应用程序。存储的密码仅由我们的应用程序用于传递给外部 API 方法。我们不会将它们用于其他任何事情。

主要问题是当系统配置导出为 XML 以进行备份或移动到不同的机器时。这是我们想要保护它们的地方，同时也尽可能让用户轻松灵活。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T14:38:41.340

好吧，如果您只是在寻找一种强大的算法，那么您可能会比使用 TripleDES 做得更糟。它可能已经 32 岁了，但它仍然非常强大。

如果您想要一些更新的东西，AES（最初是 Rijndael）也可以。

您可能想比较每个的性能，看看最适合您的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:40:49.307

在加密方面，密钥就像硬件加密狗。用生命保护它。

你用的是什么服务器？大多数现代 RDMBS 都带有加密功能，可以在静止时为您处理加密数据，无需外部密钥。这至少可以保护服务器中的数据......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:45:20.530

实际上，一个好方法是使用用户输入的密码作为种子/密钥来生成动态更强的密码。许多服务器一直在这样做。这给你带来了几个好处。1\. 不给用户带来麻烦。2\. 您可以将用户密码保存为文本文件。3\. 机器生成的密码比人类提供的密码强得多。4.您可以生成具有相同种子的新密码，这使您的协议对重放攻击更强大。

试试看。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:09:09.047

在您描述您正在寻找的内容的编辑之后，以下是一些更多建议 -

如果您继续使用用户密码作为密钥或种子，则该密钥可以存储在数据库中，甚至可以存储在与用户相关的 CSV 文件中。完成之后，下一个问题将是，更好的方法是 - 每次安装生成唯一密钥或拥有通用应用程序密钥。实际上，拥有一个通用应用程序密钥是一个坏主意，原因有几个 - 1\. 如果它被破解一次，那么你之前的所有交易所也可以被破解。2\. 很容易被重放攻击，加密后的密码可以被重放。3.你应该有意识地不时地改变这个键。

因此，在任何一天，生成唯一密钥都是一个更好的主意。我认为您应该研究 Diffie-Hellman 密钥交换。我认为这将解决您的大部分问题。DH 密钥交换的概念是，您使用自己的用户提供的密钥来建立唯一的（每笔交易）密钥进行通信。这种方法最好的部分是，实际密钥永远不会泄露，您每次都可以根据相同的旧种子/密钥生成新密码。

看看它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:41:36.200

您可以让您的程序 pgp 加密它们，以便您的客户 pgp 密钥可以解密它们，您的也可以。在程序使用密码时，密码只能是纯文本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T15:23:55.460

我们使用非对称公钥加密存储信用卡信息。许多服务器都有用于加密信用卡的公钥。只有我们的 cc 网关应用程序拥有用于解密和处理付款的私钥。私钥作为证书安装在生产服务器上。

由于您正在存储密码，因此您可能仍然应该有一个用于快速用户身份验证的哈希。

[http://en.wikipedia.org/wiki/Public-key_cryptography](http://en.wikipedia.org/wiki/Public-key_cryptography)

# java - Java 等效于 PHP 的 mysql_real_escape_string()

> ID：1018292
> 
> 赞同：15
> 
> 时间：2009-06-19T14:34:55.903
> 
> 标签：java, sql, mysql, security, jdbc

是否有与 PHP 的 mysql_real_escape_string() 等效的 Java？

这是为了在将 SQL 注入尝试传递给 Statement.execute() 之前对其进行转义。

我知道我可以使用 PreparedStatement 代替，但我们假设这些是一次性语句，因此准备它们会导致[性能下降](http://www.onjava.com/pub/a/onjava/excerpt/oraclejdbc_19/)。我已经将代码更改为使用 PreparedStatement，但鉴于现有代码的结构方式，escape() 函数将使代码更改更易于查看和维护；我更喜欢易于维护的代码，除非有令人信服的理由导致额外的复杂性。此外，数据库对 PreparedStatements 的处理方式也有所不同，因此这可能会使我们暴露于数据库中以前从未遇到过的错误，需要在发布到生产环境之前进行更多测试。

[Apache StringEscapeUtils escapeSQL()](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringEscapeUtils.html)只转义单引号。

后记：我继承的环境中有很多微妙之处，我在我的问题中刻意避免。

需要考虑的两点：

1）Prepared statements 不是万能的，不能提供 100% 的 SQL 注入保护。一些数据库驱动程序使用不安全的字符串连接来实例化参数化查询，而不是将查询预编译为二进制形式。此外，如果您的 SQL 依赖于存储过程，则需要确保存储过程本身不会以不安全的方式构建查询。

2）大多数准备好的语句实现将语句绑定到实例化语句的数据库连接。如果您正在使用数据库连接池，则需要小心地
将准备好的语句引用仅用于准备它的连接。一些池化机制确实透明地实现了这一点。否则，您也可以合并准备好的语句，或者（最简单但开销更大）为每个查询创建一个新的准备好的语句。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-19T14:39:50.510

据我所知，没有“标准”的方式来做到这一点。

尽管您目前存在顾虑，但我强烈建议您使用准备好的陈述。对性能的影响可以忽略不计——我们有类似的情况，每秒有几千条语句——其中大多数也是一次性的。

您获得的安全性应该比您尚未见过的性能问题更重要。在我看来，这是“不要过早优化”的明显情况。

无论如何，如果您以后真的发现遇到性能问题，请通过仔细分析确保准备好的语句确实是原因，然后寻找替代方案。在那之前，您应该省去尝试正确逃脱的麻烦。

这一点更重要，因为我推断您正在开发某种面向公众的网站 - 内部应用程序很少获得足够的流量来关注性能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-08T04:24:22.157

这是一些可以实现您正在寻找的代码。最初在 Vnet Publishing wiki 上。

[https://web.archive.org/web/20131202082741/http://wiki.vnetpublishing.com/Java_Mysql_Real_Escape_String](https://web.archive.org/web/20131202082741/http://wiki.vnetpublishing.com/Java_Mysql_Real_Escape_String)

```
/**
  * Mysql Utilities
  *        
  * @author Ralph Ritoch <rritoch@gmail.com>
  * @copyright Ralph Ritoch 2011 ALL RIGHTS RESERVED
  * @link http://www.vnetpublishing.com
  *
  */

 package vnet.java.util;

 public class MySQLUtils {

     /**
      * Escape string to protected against SQL Injection
      *
      * You must add a single quote ' around the result of this function for data,
      * or a backtick ` around table and row identifiers. 
      * If this function returns null than the result should be changed
      * to "NULL" without any quote or backtick.
      *
      * @param link
      * @param str
      * @return
      * @throws Exception 
      */

     public static String mysql_real_escape_string(java.sql.Connection link, String str) 
           throws Exception
     {
         if (str == null) {
             return null;
         }

         if (str.replaceAll("[a-zA-Z0-9_!@#$%^&*()-=+~.;:,\\Q[\\E\\Q]\\E<>{}\\/? ]","").length() < 1) {
             return str;
         }

         String clean_string = str;
         clean_string = clean_string.replaceAll("\\\\", "\\\\\\\\");
         clean_string = clean_string.replaceAll("\\n","\\\\n");
         clean_string = clean_string.replaceAll("\\r", "\\\\r");
         clean_string = clean_string.replaceAll("\\t", "\\\\t");
         clean_string = clean_string.replaceAll("\\00", "\\\\0");
         clean_string = clean_string.replaceAll("'", "\\\\'");
         clean_string = clean_string.replaceAll("\\\"", "\\\\\"");

         if (clean_string.replaceAll("[a-zA-Z0-9_!@#$%^&*()-=+~.;:,\\Q[\\E\\Q]\\E<>{}\\/?\\\\\"' ]"
           ,"").length() < 1) 
         {
             return clean_string;
         }

         java.sql.Statement stmt = link.createStatement();
         String qry = "SELECT QUOTE('"+clean_string+"')";

         stmt.executeQuery(qry);
         java.sql.ResultSet resultSet = stmt.getResultSet();
         resultSet.first();
         String r = resultSet.getString(1);
         return r.substring(1,r.length() - 1);       
     }

     /**
      * Escape data to protected against SQL Injection
      *
      * @param link
      * @param str
      * @return
      * @throws Exception 
      */

     public static String quote(java.sql.Connection link, String str)
           throws Exception
     {
         if (str == null) {
             return "NULL";
         }
         return "'"+mysql_real_escape_string(link,str)+"'";
     }

     /**
      * Escape identifier to protected against SQL Injection
      *
      * @param link
      * @param str
      * @return
      * @throws Exception 
      */

     public static String nameQuote(java.sql.Connection link, String str)
           throws Exception
     {
         if (str == null) {
             return "NULL";
         }
         return "`"+mysql_real_escape_string(link,str)+"`";
     }

 } 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-19T14:39:03.303

不要假设 PreparedStatements 较慢。尝试它，测量它，然后判断。

PreparedStatements 应*始终*优先于 Statement 使用，几乎无一例外，*尤其是*当您试图避免 SQL 注入攻击时。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-19T14:39:09.857

避免 SQL 注入的唯一明智方法是使用准备好的/参数化语句。

例如，您出于某种原因试图避免的[PreparedStatement 。](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/PreparedStatement.html)如果你做一次性声明，准备它们的时间应该可以忽略不计（“一次性”和“性能关键”是矛盾的，恕我直言）。如果您在循环中执行操作，准备好的语句甚至会导致性能提高。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-09T08:51:55.233

commons-lang.jar 中的 org.apache.commons.lang.StringEscapeUtils.class 可以解决您的问题！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-19T14:58:26.397

根据 Daniel Schneller 的说法，在 Java 中没有标准的方法来处理 PHP 的 mysql_real_escape_string() 我所做的是链接 replaceAll 方法来处理可能需要避免任何异常的每个方面。这是我的示例代码：

`public void saveExtractedText(String group,String content) { try { content = content.replaceAll("\\", "\\\\") .replaceAll("\n","\\n") .replaceAll("\r", "\\r") .replaceAll("\t", "\\t") .replaceAll("\00", "\\0") .replaceAll("'", "\\'") .replaceAll("\\"", "\\\"");`

 ````
 state.execute("insert into extractiontext(extractedtext,extractedgroup) values('"+content+"','"+group+"')");
    } catch (Exception e) {
        e.printStackTrace();

    } 
````  `* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-06-13T15:24:42.850

除了 PreparedStatement 之外，我不会相信任何其他东西来确保安全。但是，如果您在构建查询时需要类似的工作流程，您可以使用下面的代码。它在下面使用 PreparedStatement，像 StringBuilder 一样工作，添加转义函数并为您跟踪参数索引。它可以这样使用：

```
SQLBuilder sqlBuilder = new SQLBuilder("update ").append(dbName).append(".COFFEES ");
sqlBuilder.append("set SALES = ").escapeString(sales);
sqlBuilder.append(", TOTAL = ").escapeInt(total);
sqlBuilder.append("where COF_NAME = ").escapeString(coffeeName);
sqlBuilder.prepareStatement(connection).executeUpdate(); 
```

这是代码：

```
class SQLBuilder implements Appendable {
    private StringBuilder sqlBuilder;
    private List<Object> values = new ArrayList<>();

    public SQLBuilder() {
        sqlBuilder = new StringBuilder();
    }

    public SQLBuilder(String str)
    {
        sqlBuilder = new StringBuilder(str);
    }

    @Override
    public SQLBuilder append(CharSequence csq)
    {
        sqlBuilder.append(csq);
        return this;
    }

    @Override
    public SQLBuilder append(CharSequence csq, int start, int end)
    {
        sqlBuilder.append(csq, start, end);
        return this;
    }

    @Override
    public SQLBuilder append(char c)
    {
        sqlBuilder.append(c);
        return this;
    }

    // you can add other supported parameter types here...
    public SQLBuilder escapeString(String x)
    {
        protect(x);
        return this;
    }

    public SQLBuilder escapeInt(int x)
    {
        protect(x);
        return this;
    }

    private void escape(Object o)
    {
        sqlBuilder.append('?');
        values.add(o);
    }

    public PreparedStatement prepareStatement(Connection connection)
        throws SQLException
    {
        PreparedStatement preparedStatement =
            connection.prepareStatement(sqlBuilder.toString());
        for (int i = 0; i < values.size(); i++)
        {
            Object value = values.get(i);
            // you can add other supported parameter types here...
            if (value instanceof String)
                preparedStatement.setString(i + 1, (String) value);
            else if (value instanceof Integer)
                preparedStatement.setInt(i + 1, (Integer) value);
        }
        return preparedStatement;
    }

    @Override
    public String toString()
    {
        return "SQLBuilder: " + sqlBuilder.toString();
    }
} 
````

# java - 根据原始请求的 URL 显示不同的 Tomcat 错误页面

> ID：1018295
> 
> 赞同：2
> 
> 时间：2009-06-19T14:35:47.570
> 
> 标签：java, jsp, tomcat, custom-error-pages

我想使用 Tomcat 的错误页面指令来显示各种不同的错误页面以响应各种类型的异常。但是，我希望显示的错误页面具有不同的样式和内容，具体取决于导致错误的原始请求 URL。

具体来说，我的 Web 应用程序有一个管理部分和一个用户部分。错误页面在样式和菜单方面都应该不同。区分给定页面所在部分的最可靠方法是在 URL 中查找字符串。我想将 Tomcat 错误页面指向一个 servlet，它会解析 URL 并重定向到适当样式的错误页面。

所以 1) 是否可以使用错误页面或其他机制将错误重定向到 servlet 而不是 JSP？（如果没有，我可以在 JSP 中做我想象的事情吗？）

和 2) 一旦我在我的 servlet 中，我能否确定导致错误的请求 URL（request.requestURI 似乎不起作用——它指向错误 JSP 本身的位置）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T15:38:45.570

您可以从中获取原始 requestURI

```
pageContext.errorData.requestURI 
```

在您注册的错误 jsp`<error-page>`中`web.xml`

有关详细信息，请参阅[http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/ErrorData.html](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/ErrorData.html)。

至于使用 servlet，您可能可以`<jsp:forward>`在错误 jsp 中使用 a 来转发到您选择的 servlet。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:21:50.923

Tomcat 的错误页面是显示应用程序错误的最后手段（以防您的错误页面实际上失败）。通常您应该（我建议）构建自己的错误页面，您可以在非技术视图中显示错误（默认情况下) 和技术视图（如果用户愿意）以适合您的用户的方式。

# c# - 当子控件具有焦点时在表单上捕获 KeyUp 事件

> ID：1018299
> 
> 赞同：11
> 
> 时间：2009-06-19T14:36:40.843
> 
> 标签：c#, .net, winforms, event-handling

我需要在我的表单中捕获 KeyUp 事件（以切换“全屏模式”）。这就是我正在做的事情：

```
protected override void OnKeyUp(KeyEventArgs e)
{
    base.OnKeyUp(e);

    if (e.KeyCode == Keys.F12) this.ToggleFullScreen();
}

private void ToggleFullScreen()
{
    // Snazzy code goes here           
} 
```

这很好用，除非表单上的控件具有焦点。在那种情况下，我根本没有得到这个事件（也试过 OnKeyDown - 那里也没有运气）。

我可以从子控件处理 KeyUp 事件，但是表单上的控件是动态生成的，并且可能有很多——每个都有自己的多个子控件。

有没有办法在不为屏幕上的每个控件生成事件处理程序的情况下做到这一点（我当然可以使用递归函数来做到这一点）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-19T14:46:08.017

将表单的 KeyPreview 设置为 true，您可以拦截 KeyUp 事件。

在我的测试应用程序中，我做了这样的事情：

```
this.KeyPreview = true;
.
.
.

private void button1_KeyUp(object sender, KeyEventArgs e)
{
    Trace.WriteLine("button key up");
}

private void Form1_KeyUp(object sender, KeyEventArgs e)
{
    Trace.WriteLine("form key up");
    e.Handled = true;
} 
```

它将转储表单跟踪行，向上处理键并且不会调用按钮处理程序。当然，您可以不处理事件（不执行 e.Handled = true），然后按钮处理程序也会被调用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T14:44:06.040

您是否尝试过在表单上全局处理事件？

```
protected override bool ProcessCmdKey(ref Message msg, Keys e)
{
    if (e.KeyCode == Keys.F12) 
    {
       this.ToggleFullScreen();
       return true; //marks command as handled
    }

    return base.ProcessCmdKey(ref msg, e); // Resend To Base Function
} 
```

# oracle - Delphi TOracleQuery 绑定变量

> ID：1018327
> 
> 赞同：0
> 
> 时间：2009-06-19T14:39:52.430
> 
> 标签：oracle, delphi

我正在尝试使用 DOA 组件集的 TOracleQuery 对象从 Delphi 6 调用带有绑定变量的查询。我有 6 个变量，其中 1 个是字符串（Oracle 术语中的 VarChar2）。我曾尝试使用 otVarchar2 枚举调用 query.DeclareVariable，这在直觉上是有意义的，otString 枚举（如文档所建议的那样）和 otVarchar 枚举（它可能会起作用），所有这些都会导致异常运行时：“不支持的变量类型”。

知道会有什么问题吗？我认为创建字符串类型的绑定变量将是相当普遍的情况。

更新：这是导致异常的 otNumber 。它只是打破了 otString 线。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T14:44:38.050

根据文档，我应该一直使用 otInteger，而不是 otNumber（使用 Delphi 术语，而不是 Oracle 术语）。因此，问题不在于字符串（在我将其更改为 otString 之后），而是 Delphi 在导致异常的行之后中断（我习惯于 VC# 在触发异常的行上中断） . 那解决了它。

# sifr - sIFR 3 改变元素

> ID：1018331
> 
> 赞同：0
> 
> 时间：2009-06-19T14:40:47.233
> 
> 标签：sifr

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-20T20:29:56.873

您是否复制了包含其他内容样式的样式表？可能是这些样式隐藏了文本。

# excel - Excel - 根据另一个列表提取数据

> ID：1018335
> 
> 赞同：19
> 
> 时间：2009-06-19T14:41:05.140
> 
> 标签：excel, extract

我有一个 Excel 工作表，其中包含两列（名称/ID），然后是另一个列表，它是上述较大列表中名称的子集。我想浏览子集列表，然后从较大的列表（名称/ID）中提取数据并将其放在其他地方......如果名称在子集上，基本上只从较大的列表中获取数据。

我尝试使用过滤器，但无法正常工作。想法？

谢谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-06-19T14:57:23.563

新的 Excel 版本

`=IF(ISNA(VLOOKUP(A1,B,B,1,FALSE)),"",A1)`

较旧的 Excel 版本

`=IF(ISNA(VLOOKUP(A1;B:B;1;FALSE));"";A1)`

即：“如果B列中存在A1的值，则在此处显示。如果不存在，则留空。”

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-04-20T21:30:32.177

我无法让第一种方法起作用，我知道这是一个老话题，但这是我最终为解决方案所做的：

```
=IF(ISNA(MATCH(A1,B:B,0)),"Not Matched", A1) 
```

基本上，将 A1 与 B 列完全匹配（0 代表与 B 列中的值完全匹配）。ISNA 测试#N/A 响应，如果未找到匹配项，将返回匹配项。最后，如果 ISNA 为真，则将“不匹配”写入所选单元格，否则写入匹配单元格的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-20T18:01:38.047

您是否尝试过高级过滤器？使用您的短列表作为“标准”，使用长列表作为“列表范围”。使用选项：“就地过滤”和“唯一值”。

您应该看到仅出现在您的短列表中的唯一值列表。

或者，如果您愿意，您可以将唯一列表粘贴到另一个位置（在同一张纸上）。选择“复制到另一个位置”选项，然后在“复制到”框中输入您想要唯一列表的单元格引用（例如 F1）。

注意：这也适用于两列（名称/ID），如果您选择两列作为“标准”和“列表范围”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-26T01:49:07.167

和其他人一样，我一直在为此烦恼。

我使用了标准；

`=countif(matchingList,C2)=0`

其中matchingList 是我用作过滤器的列表。

看看这个

[http://www.youtube.com/watch?v=x47VFMhRLnM&list=PL63A7644FE57C97F4&index=30](http://www.youtube.com/watch?v=x47VFMhRLnM&list=PL63A7644FE57C97F4&index=30)

我发现的诀窍是，通常您会在标准中使用与数据列标题匹配的列标题。这不适用于作为公式的标准。

我发现如果我将列标题留空，则仅适用`countif`于高级过滤器中具有公式的条件。如果我有列标题，即公式示例中列 C2 的列标题，则过滤器不返回任何输出。

希望这可以帮助

# sql - 获取 MySQL 中表的行数？

> ID：1018336
> 
> 赞同：7
> 
> 时间：2009-06-19T14:41:09.353
> 
> 标签：sql, mysql, count, row

谁能告诉我在查找表的行数时，他在 MySQL 中哪种方法更好：这样做更好吗

```
SELECT COUNT(*) FROM TABLE_NAME 
```

或查找表`TABLE`中的行数`INFORMATION_SCHEMA`？

这将是计算页面分页计数的频繁操作吗？

我应该补充一点，表最多只有几千行。

谢谢

马丁奥谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-19T14:43:49.567

在`MyISAM`中，此查询：

```
SELECT  COUNT(*)
FROM    TABLE_NAME 
```

是即时的，因为它保存在表元数据中，所以发出这个查询几乎是免费的，它总是会得到正确的结果。

在`InnoDB`中，此查询将逐一计算行数，这可能需要一些时间。

因此，如果您不需要 的确切值`COUNT(*)`，您可以查询`INFORMATION_SCHEMA`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-07T03:13:11.093

如果您发现速度太慢`SQL_CALC_FOUND_ROWS`，我也会考虑使用。`SELECT FOUND_ROWS()``COUNT(*)`

# jquery - $(document).ready 在 Ruby 局部视图中

> ID：1018338
> 
> 赞同：1
> 
> 时间：2009-06-19T14:41:24.937
> 
> 标签：jquery, ruby-on-rails

希望这个例子能比简单地解释它更好地说明我的观点：

我正在使用众多 jQuery 水印插件之一。要将水印附加到文本框，语法是：

```
$(document).ready(function(){
  $("#item_description").watermark("Description");
}); 
```

如果我的页面已经包含 id = item_description 的文本框，这将非常有效。但是，如果我尝试通过在单击按钮时加载包含该文本框的部分视图来执行任何 ajaxy 类型的操作，那么`$(document).ready()`已经调用了该文本框并且不应用水印。我尝试在局部视图中单独放置一个`$(document).ready()`，但看起来 rails (?)`<script>`在呈现页面时会去除任何块，这意味着它仍然永远不会被调用。

是否有捷径可寻？我只是错过了一些明显的东西吗？

**编辑**：我正在使用[jQuery Colorbox](http://colorpowered.com/colorbox/)插件来加载灯箱内的部分视图（通过`$(.colorbox).colorbox();`）——我实际上并没有自己执行 ajax 请求。如果我到目前为止理解答案，最好的方法可能是使用插件的回调功能在部分内部执行我需要的任何 javascript。

**工作示例**：根据反馈，我只需将 colorbox 调用更改为：

```
$(".colorbox").colorbox({}, function(){
  $(".description").watermark("Description"); //Changed to a class
}); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T14:46:30.310

为什么一定要在里面`$(document).ready`？您已经有加载 ajax 的 javascript，因此您可以激活`$("#item_description").watermark("Description");`回调。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T14:45:53.447

从 ajax 直接调用，不用封装`$(document).ready()`

```
$("#item_description").watermark("Description"); 
```

# sql-server - 发布“xx”的并发快照不可用，因为它尚未完全生成或日志读取器 A

> ID：1018339
> 
> 赞同：4
> 
> 时间：2009-06-19T14:41:31.037
> 
> 标签：sql-server, replication

我在让 SQL Server (2005) 正常工作时遇到了各种麻烦。当我运行客户端（SQL Server Express 2005）时，我收到以下错误“发布 'xx' 的并发快照不可用，因为它尚未完全生成或日志读取器 A”

错误被裁剪掉。

我尝试过： - 删除订阅 - 删除发布并重新开始 - 重新启动服务器和客户端。- 缩小数据库

一切都没有任何改变。

我知道客户端可以看到网络共享 \servername\repldata 有一个 UNC 子文件夹，其中包含快照（如预期的那样，具有 pubName 和 dateTime 编码的文件夹更深）

任何提示或旅行将不胜感激

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-02-10T13:25:05.737

但这里是解决方案： [http ://social.msdn.microsoft.com/forums/en-US/sqlreplication/thread/baf99181-2fe1-4e6b-ba45-5d1d08103550/](http://social.msdn.microsoft.com/forums/en-US/sqlreplication/thread/baf99181-2fe1-4e6b-ba45-5d1d08103550/)

1）删除订阅和整个不工作的出版物

2) 对这些表运行选择以查看发布数据库是否仍有可用行：

```
select * from msdb..MSdistpublishers
select * from distribution..MSpublisher_databases
select * from distribution..MSpublications
select * from distribution..MSarticles
select * from distribution..MSsubscriptions 
```

3）现在从刚刚删除的发布者数据库中删除所有仍然具有“publisher_db”的行：

```
delete from distribution..MSarticles where publisher_db = '<NameOfDatabase>'
delete from distribution..MSsubscriptions where publisher_db = '<NameOfDatabase>' 
```

4）像往常一样重新创建发布和订阅者

这应该够了吧 ：-）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T21:21:38.117

1.  *是否*已生成发布的快照？有时这需要很长时间，有时会推迟到以后。如果它是制作的，您应该能够在磁盘上的某个地方找到它。

2.  确保日志阅读器正在发布器上运行，如果这是事务复制，我假设它是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-26T06:09:58.403

在我的情况下，这是因为分销商数据库上的“MSSubscriptions”表有 nosync_type=1 和 status=2。上面分别更改为 0 和 1。

再次重新初始化快照，然后分发代理开始接收这些更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-26T16:02:52.033

对我来说，只需让 Log-Reader 和 Distribution 服务帐户 DB_Owner 访问发布数据库即可。我不确定它们是否都是必需的，但这很容易解决。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-04-11T18:27:04.650

我只是再次重新初始化快照（新快照，不要重复使用旧快照），然后分销商代理开始接收这些更改。

# .net - 未关闭的数据库连接会发生什么？

> ID：1018349
> 
> 赞同：7
> 
> 时间：2009-06-19T14:42:46.947
> 
> 标签：.net, database-connection

今天早些时候，我在我们的一个项目中发现了一个错误——与永远不会关闭的数据库有一个连接，我的意思是永远不会调用 Close() 方法。但是，当我关闭应用程序时，连接已关闭（多次在 sql management studio 中检查）。为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:46:54.537

当应用程序退出时，连接将关闭。阅读[SqlConnection 的 Finalize](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.finalize.aspx)。来自 MSDN 的[Object.Finalize](http://msdn.microsoft.com/en-us/library/system.object.finalize.aspx)文档：

“在应用程序域关闭期间，会自动对不能免于终结的对象调用终结，即使是那些仍可访问的对象。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:55:32.147

这里要记住的另一件事是，在 .Net 中，您可以将连接包装在 using 块中，这将关闭并为您处理连接。因此，如果您在那里有 using 块，那么缺少明确的 Close() 并不是一件坏事......

```
// this using block will auto close & dispose your connection...
using (var conn = new SqlConnection(...))
{
    conn.Open();
    // database code here with no explicit close

} 
```

这与在 finally 中带有 conn.close 的 try/finally 块的功能等效。许多开发人员忽略了 using 块 - 确保在这种情况下你没有做同样的事情。

如果您确实重写了代码以关闭连接 - 最好在所有数据库对象（连接、命令、读取器）周围使用 Using 块，以确保它们在超出 using 块的范围时正在关闭和处置. 我肯定会建议将它们写入您的代码，而不仅仅是 conn.Close() 在需要的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T14:49:22.707

SQL 连接的创建成本很高，ADO.NET 使用一种称为连接池的技术，允许重用它们。

引用[MSDN](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)：

> 强烈建议您在使用完连接后始终关闭连接，以便将其返回连接池并重新使用。
> 
> 如果已达到最大池大小并且没有可用的连接可用，则将请求排队。然后，池程序尝试回收任何连接，直到达到超时（默认值为 15 秒）。如果 pooler 在连接超时之前无法满足请求，则会引发异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T14:53:25.693

当您以常规方式退出应用程序时，我希望终结器能够运行。如果连接仍然打开，他们将关闭连接。只是不要依赖这一点：这些终结器可能需要一段时间才能在您的应用程序的正常操作中运行，因此您将保持打开太多连接。

当应用程序崩溃时，终结器可能不会运行，使连接在应用程序的生命周期之后保持打开状态。

# c# - C# 冒泡/传递事件

> ID：1018350
> 
> 赞同：3
> 
> 时间：2009-06-19T14:42:47.260
> 
> 标签：c#, events, messages

如何在课程之间传递事件？

我知道这听起来很荒谬（而且确实如此），但在过去的一段时间里我一直被这件事难住了。搜索没有出现类似的问题，所以我想我会提出它。

以下是涉及的对象：

```
WinForm -> Speaker -> Tweeter
                   -> Woofer 
```

[Speaker, Tweeter, Woofer] 都声明了一个发送简单字符串消息的“SpeakToMe”事件。事件使用标准模式声明：

```
public delegate void SpeakToMeHandler(object sender, SpeakToMeEventArgs e);
public event SpeakToMeHandler SpeakToMe;
protected virtual void OnSpeakToMe(string message)
{
   if (SpeakToMe != null) SpeakToMe(this, new SpeakToMeEventArgs(DateTime.Now.ToString() + " - " + message));
} 
```

SpeakToMeEventArgs 是一个简单的类，继承自 EventArgs 并包含一个字符串属性（消息）。

就其本身而言，这些事件中的每一个都可以正常工作。例如，我在表单中设置了一个按钮来创建、订阅和触发 [Speaker, Tweeter, Woofer] 的事件。每个报告都正确返回。

问题是当 Speaker 创建一个 [Tweeter, Woofer] 并订阅他们的事件时。

我想要的是 [Tweeter, Woofer] 触发他们的事件，扬声器消耗它并触发它自己的事件。我认为这应该非常简单：

```
void tweeter_SpeakToMe(object sender, SpeakToMeEventArgs e)
{
   Console.Out.WriteLine("the tweeter is speaking: " + e.Message);
   this.OnSpeakToMe("tweeter rockin' out [" + e.Message + "]");
} 
```

单步执行此功能（在扬声器中），Console.Out.WriteLine 工作。继续单步执行 OnSpeakToMe，显示委托为空。

发言人的 SpeakToMe 事件由表单订阅。我知道这应该防止事件的委托为空。

我确定这很容易，我错过了什么？

顺便说一句，如果你好奇我为什么要找这个。[Speaker, Tweeter, Woofer] 是我的演示替身，用于非常长的数据处理操作。该表单同时运行其中的几个，并且需要每个班级的进度更新。

一如既往，非常感谢任何和所有帮助！

**更新：**感谢大家的所有反馈。我真的很感激帮助！我收集了一些很好的技巧（@David Basarab 和@Brian）以及一些关于如何构建事物的不同想法。再次，非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T15:02:48.640

如果我从基本意义上理解你想要什么。是让 Tweeter 和 Woofer 触发一个 Speaker 也订阅的事件，然后触发它自己的事件。

这是具有此输出的我的代码

**输出**

***OnSpeak 消息 = OnSpeakToMeHander 原始消息：由 Tweeter 发射***

***OnSpeak Message = OnSpeakToMeHander 原始消息：由 Woofer 触发***

```
class Program
{

    static void Main(string[] args)
    {
        Console.Clear();

        try
        {
            Speaker speaker = new Speaker();
            speaker.speakerEvent += new SpeakToMeHandler(Program.OnSpeak);

            // Cause events to be fied
            speaker.Tweeter.CauseEvent();
            speaker.Woofer.CauseEvent();

        }
        catch (Exception ex)
        {
            Console.WriteLine("Error: {0}", ex.Message);
            Console.WriteLine("Stacktrace: {0}", ex.StackTrace);
        }
    }

    public static void OnSpeak(object sendere, SpeakToMeEventArgs e)
    {
        Console.WriteLine("OnSpeak Message = {0}", e.Message);
    }

}

public delegate void SpeakToMeHandler(object sender, SpeakToMeEventArgs e);

public class SpeakToMeEventArgs : EventArgs
{
    public string Message { get; set; }
}

public class Speaker
{
    public event SpeakToMeHandler speakerEvent;

    public Tweeter Tweeter { get; set; }
    public Woofer Woofer { get; set; }

    public void OnSpeakToMeHander(object sender, SpeakToMeEventArgs e)
    {
        if (this.speakerEvent != null)
        {
            SpeakToMeEventArgs args = new SpeakToMeEventArgs
                {
                    Message = string.Format("OnSpeakToMeHander Orginal Message: {0}", e.Message)
                };

            this.speakerEvent(this, args);
        }
    }

    public Speaker()
    {
        this.Tweeter = new Tweeter();
        this.Woofer = new Woofer();

        Tweeter.tweeterEvent += new SpeakToMeHandler(this.OnSpeakToMeHander);
        Woofer.wooferEvent += new SpeakToMeHandler(this.OnSpeakToMeHander);
    }
}

public class Tweeter
{
    public event SpeakToMeHandler tweeterEvent;

    public void CauseEvent()
    {
        SpeakToMeEventArgs args = new SpeakToMeEventArgs()
            {
                Message = "Fired By Tweeter"
            };

        if (this.tweeterEvent != null)
        {
            this.tweeterEvent(this, args);
        }
    }
}

public class Woofer
{
    public event SpeakToMeHandler wooferEvent;

    public void CauseEvent()
    {
        SpeakToMeEventArgs args = new SpeakToMeEventArgs()
            {
                Message = "Fired By Woofer"
            };

        if (this.wooferEvent != null)
        {
            this.wooferEvent(this, args);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-19T15:25:09.530

[Eric Lippert](http://blogs.msdn.com/ericlippert/archive/2009/04/29/events-and-races.aspx)`if (SpeakToMe != null)`对代码提出警告。虽然在您的情况下这可能不是问题（即，如果您从不删除事件），您应该养成使用它的习惯：

```
var tmp = SpeakToMe;
if (tmp!=null) tmp(/*arguments*/); 
```

在 C#6 及更高版本中，请考虑以下简洁代码：

```
SpeakToMe?.Invoke(e) 
```

[MSDN上](https://msdn.microsoft.com/en-us/library/dn986595.aspx)建议使用后一种方法

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T15:00:48.253

委托为空的唯一方法是表单实际上没有订阅该事件。您是否在某个时候创建​​了一个新的扬声器实例？如果您订阅了一个实例，然后使用相同的变量创建了一个新实例，则不会关联新实例的事件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:16:25.773

您可以使用事件声明的长形式将事件传递给内部对象。

```
public class Speaker
{
    public Speaker()
    {
        this.MyTweeter = new Tweeter();
    }

    public Tweeter MyTweeter { get; private set; }

    public event SpeakToMeHandler SpeakToMe
    {
        add { MyTweeter.SpeakToMe += value; }
        remove { MyTweeter.SpeakToMe -= value; }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T15:03:32.880

与其传递事件，不如为事件分配一个额外的处理程序？您不仅限于一种方法。

```
//Handler class
public class Speaker {
    public delegate void HandleMessage(string message);
    public event HandleMessage OnMessage;
    public void SendMessage(string message) {
        if (OnMessage != null) { OnMessage(message); }
    }
}

//then used like...
Speaker handler = new Speaker();
handler.OnMessage += (message) => { Console.WriteLine("Woofer: {0}", message); };
handler.OnMessage += (message) => { Console.WriteLine("Tweeter: {0}", message); };
handler.SendMessage("Test Message"); 
```

# c# - 值未在本地存储的 DependencyProperties

> ID：1018352
> 
> 赞同：0
> 
> 时间：2009-06-19T14:43:18.257
> 
> 标签：c#, wpf, dependency-properties, managed-c++

我对创建一个`DependencyProperty`依赖于外部资源的属性有点困惑。例如，在我正在编写的超声应用程序中，我目前在托管 C++ 包装器中有以下内容（为了简单起见，此处翻译为 C#，实现 INotifyPropertyChanged）：

```
public int Gain
{
    get { return ultrasound.GetParam(prmGain); }
    set 
    { 
        ultrasound.SetParam(prmGain, value);
        NotifyPropertyChanged("Gain");
    }
} 
```

我所有的代码都在 WPF 中使用，我正在考虑如何更改`INotifyPropertyChanged`to`DependencyProperty`以及是否会从更改中受益。大约有 30 个变量与此类似，其中大部分都将数据绑定到屏幕上的滑块、文本块或其他控件。

`DependencyProperty`以下对于为此对象实现 a 是否正确？

```
public int Gain
{
    get { return ultrasound.GetParam(prmGain); }
    set 
    { 
        ultrasound.SetParam(prmGain, value);
        this.SetValue(GainProperty, value); 
    }
}

public static readonly DependencyProperty GainProperty = DependencyProperty.Register(
    "Gain", typeof(int), typeof(MyUltrasoundWrapper), new PropertyMetadata(0)); 
```

我从未见过`this.GetValue(GainProperty)`未使用的示例。此外，还有其他功能可能会更改该值。这也是正确的改变吗？

```
public void LoadSettingsFile(string fileName)
{
    // Load settings...

    // Gain will have changed after new settings are loaded.
    this.SetValue(GainProperty, this.Gain);
    // Used to be NotifyPropertyChanged("Gain");
} 
```

另外，附带说明一下，在大多数属性是数据绑定的情况下，我是否应该期望性能提升，或者更确切地说，在许多参数不是数据绑定的情况下性能损失？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T14:49:59.490

使用依赖属性时，Get 和 Set 方法必须只是 this.GetValue() 和 this.SetValue() 的简单包装，原因是 WPF 不使用 getter 或 setter 来访问值，因此您可以t 依赖于一直运行的额外代码。

如果您确实需要将这些属性作为依赖属性，则创建一个标准依赖属性，该属性有效地缓存您的超音波.GetParam(prmGain) 结果并在 PropertyChanged 事件中调用超音波.SetParam(prmGain, value)，无论如何属性变了。

* * *

虽然我上面写的仍然是正确的，但重读你的问题让我认为你可能误解了依赖属性是什么。如果此 C++ 包装器对象实际上是您的模型，那么您希望保留 INotifyPropertyChanged。依赖属性旨在供 WPF 控件在内部使用，以促进绑定并降低控件的内存占用。它们不应该在数据提供者内部使用，这就是通知接口的用途。

# apache-flex - Flex：对 mx:Label 或 mx:Text 中的选定文本执行*任何操作*？

> ID：1018355
> 
> 赞同：1
> 
> 时间：2009-06-19T14:44:03.357
> 
> 标签：apache-flex, actionscript-3, flex3

Flex 的文本编辑控件 (mx:TextField, mx:TextArea) 提供了对选定文本 ( `selectionBeginIndex`, `selectionEndIndex`, `setSelection`) 进行“处理”的功能，但文本显示控件 (mx:Label, mx:Text) 似乎没有提供任何类型的东西。

经过一番修修补补，我尝试将 Label 子类化，然后编写可以访问底层`TextField`实例的函数......但即便如此，设置选择也不起作用！

```
function get selectionBeginIndex():int {
    // This works
    return this.textField.selectionBeginIndex;
}

function get selectionEndIndex():int {
    // This works
    return this.textField.selectionEndIndex;
}

function setSelection(beginIndex:int, endIndex:int):void {
    // But this has no effect!
    this.textField.setSelection(beginIndex, endIndex);
} 
```

那么，有没有更好的方法来访问/更改在 mx:Label 和 mx:Text 控件中选择的文本？是否有“更好”的控件可供使用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T15:42:18.840

最好使用 TextInput 并将可编辑属性设置为 false，并将borderStyle 设置为“none”而不是 Label。

Text 组件在某些情况下比 Label 好一点，因为它允许用户用鼠标选择显示的文本，并且支持多行。但是我不知道您是否可以通过编程方式选择文本，尽管我怀疑如果您对它进行子类化，那么使用它会比使用子类化标签更成功。或者，您可以使用具有我为 TextInput 提到的相同属性的 TextArea。

要根据他的文本调整 TextInput 的大小，您可以覆盖 validateProperties 方法，并使用 getLineMetrics() 来计算所需的宽度：

```
 public override function validateProperties():void
    {
        super.validateProperties();
        var tm : TextLineMetrics = this.getLineMetrics(0);
        var txtWidth : uint = tm.width + tm.leading + 10;
        this.width = minWidth < txtWidth ? txtWidth : minWidth;
    } 
```

根据您可能使用的字体，可能需要更改“10”值。如果您还需要在键入时调整 TextInput 的大小，则需要侦听其更改事件并从处理程序调用 validateProperties。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-22T23:06:21.650

您可能想要使用 UITextField，即 flash TextField 的 flex 版本。这是在 TextArea 内用于显示文本的对象。它支持您正在寻找的那些索引。

请注意，样式有点奇怪。“setStyle”什么都不做。而且您必须覆盖 validateNow 函数才能使用 setTextFormat，否则，您的设置将被清除。我不确定如何使用 CSS，但当时这不是问题。

# python - 传递关键字参数

> ID：1018359
> 
> 赞同：6
> 
> 时间：2009-06-19T14:44:33.963
> 
> 标签：python

我有一个需要“通过”特定关键字参数的类函数：

```
def createOrOpenTable(self, tableName, schema, asType=Table):
    if self.tableExists(tableName):
        return self.openTable(tableName, asType=asType)
    else:
        return self.createTable(self, tableName, schema, asType=asType) 
```

当我调用它时，我收到如下错误：

```
TypeError: createTable() got multiple values for keyword argument 'asType' 
```

有没有办法“通过”这样的关键字参数？

我已经想到了几个答案，但没有一个是最佳的。从最差到最好：

*   我可以更改一个或多个函数的关键字名称，但我想对所有三个函数使用相同的关键字，因为参数具有相同的含义。

*   我可以`asType`按位置而不是关键字传递参数，但如果我将其他关键字参数添加到`openTable`or `createTable`，我必须记住更改调用。我宁愿它自动适应，就像我可以使用关键字形式一样。

*   我可以使用`**args`此处的表单来获取关键字参数的字典，而不是使用默认参数，但这看起来就像使用大锤打苍蝇（因为正确解析它需要额外的代码行）。

有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-19T14:46:01.043

你做对了......只需`self`在第二个函数调用中取出 :)

```
 return self.createTable(self, tableName, schema, asType=asType) 
```

应该：

```
 return self.createTable(tableName, schema, asType=asType) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T14:57:58.243

不得不说，我首先想到了一个更复杂的问题。但是David Wolever的回答是绝对正确的。正是这里的重复自我造成了问题。这样，位置参数就会脱节，并且 asType 被赋予一个值作为位置参数（一次）和关键字参数（第二次！）。

一个更有趣的问题是，当您想要增强被调用的例程（示例中的 createTable）而不每次都增强中间函数时该怎么办。在这里，**args 解决方案成功了：

例如：

```
def createOrOpenTable(self, tableName, schema, **args):
    if self.tableExists(tableName):
        return self.openTable(tableName, **args)
    else:
        return self.createTable(tableName, schema, **args) 
```

通过这种方式，可以增强 createTable 和 openTable 的签名，而无需再更改 createOrOpenTable。

当 create 和 openTable 可以有不同的关键字参数时，当然这两个例程都必须定义如下：

```
def createTable(self, tableName, schema, asType=None, **others):
   ... 
```

其他参数会占用该方法未知的任何关键字参数——也不需要对其进行评估。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-19T15:07:34.340

我会在 Juergen 的帖子上发表评论，但我需要编写一个代码示例。这是一个更通用的版本：

```
def createOrOpenTable(self, tableName, schema, *args, **argd):
    if self.tableExists(tableName):
        return self.openTable(tableName, *args, **argd)
    else:
        return self.createTable(tableName, schema, *args, **argd) 
```

这将允许位置参数也有效（如果你真的希望这是一个“传递”，这一点很重要。

# tfs - 从 TFS 查询工作项的最快方法

> ID：1018380
> 
> 赞同：1
> 
> 时间：2009-06-19T14:47:15.300
> 
> 标签：tfs

我在 TFS 中存储了 6000 个工作项

1.  首先，我需要全部接收它们（嗯，使用 WIQL 或其他东西很简单）
2.  然后，我需要过滤掉我在特定日期范围内没有工作的所有工作项。例如，我正在查看是否对每个工作项执行了任何更改。
3.  最后，我在网页上显示工作项（最快的一步）。

但是，整个过程大约需要 300 秒才能完成。我认为这是因为我需要分析每个工作项的历史记录。那么，有没有什么技巧可以改善时间呢？

更多细节：我有一个需要做所有这些事情的 Web 应用程序，我正在使用 .Net，我正在使用 Work Items Store 缓存（但它似乎没有提供太多帮助）并且我可以自由使用任何工具来加速过程。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-26T14:02:44.683

The fastest way would be to query the TfsWorkItemTracking database on the server directly via SQL. This is not recommended of cause, but i have done this for a similar web application and it works quite well and reasonable fast. The db structure is not too complicated.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T14:58:33.093

绝对最快的方式，SSIS 包（或任何 DTL）执行数据转换并在某处保存此应用程序所需的非规范化数据。根据您的情况，此程序包可以每晚、每小时以任何您需要的频率（在合理的范围内）运行。但是，如果您需要数据的实时视图（每个人都认为他们需要，但实际上很少这样做），这将行不通。我会考虑缓存数据，只抓取和过滤已更改的项目。

在我看来，这个过程中真正的瓶颈是你要抓取所有的工作项，然后进行过滤。

# php - 如何为子目录“重写规则”？.htaccess/php

> ID：1018383
> 
> 赞同：0
> 
> 时间：2009-06-19T14:47:48.077
> 
> 标签：php, url-rewriting, friendly-url

我有一个名为 test 的文件夹，位于 www.mydomain.com/abc/files/test。我需要从`www.mydomain.com/abc/files/test/test.php?id=15&key=some-text123`

这与`www.mydomain.com/abc/files/test/15/some-text123`SO url 类似。

我尝试在 .htaccess 文件中使用以下代码

```
RewriteEngine on 
Options +FollowSymlinks
RewriteBase / 
RewriteRule ^test/([0-9]+)/([A-Za-z0-9-]+)?$ test/test.php?id=$1&key=$2 [R] 
```

它将我重定向到`www.mydomain.com/test/test.php?id=15&key=some-text-123` 但它没有工作，因为我从某个地方复制了格式。我不确定 ^ 是否也应该包含 www 部分，或者它只是假设 / 作为根？

“id”部分对我很重要。我还将以下内容视为有效网址。

```
www.mydomain.com/abc/files/test/15 (without /some-text123")
www.mydomain.com/abc/files/test/15/ (without /some-text123 but having / ) 
```

你能帮我写出正确的规则吗？

我怎样才能做到这样我就不必硬编码 "abc/files/" ？

它不应该影响我网站的任何其他网址（除了“测试”文件夹。）

URL 也应该保持不变 ( `/files/test/15 etc`) 而不是更改为`"?id=15&key=some-text123"`

非常感谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T14:55:13.023

该[`R`标志](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriteflags)强制进行外部重定向。因此，只需将其保留，请求将在内部重定向：

```
RewriteRule ^test/([0-9]+)/([A-Za-z0-9-]+)?$ test/test.php?id=$1&key=$2 
```

# .net - 在 ISerialized 实现的类上使用 DataContract

> ID：1018387
> 
> 赞同：0
> 
> 时间：2009-06-19T14:49:06.530
> 
> 标签：.net, wcf

我有 A 类，它为自定义序列化实现了 ISerializable。现在我需要在 WCF 中传递这个 A 类。

我想使用 DataContractSerializer 进行 WCF 序列化而不是我的自定义序列化。

WCF 不允许，如果类实现了 ISerializable，它不允许 [DataContract] 属性。

如何在同一类上使用 DataContractSerializer(For WCF) 和 ISerializer(For Persistance)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T01:17:20.187

正如评论中提到的，您不能同时拥有两种序列化方法。

如果你：

*   将您的类放在一个单独的 dll 中。
*   从客户端和服务器项目中引用 dll。
*   删除 [DataContract] 属性。

然后它应该可以工作，除非在自定义序列化的实现方式上有什么特别之处。

# c++ - 如何在 IE8 盒子上使用 URLDownloadToFile（没有崩溃会很好）？

> ID：1018389
> 
> 赞同：0
> 
> 时间：2009-06-19T14:49:37.637
> 
> 标签：c++, winapi, internet-explorer-8, urlmon

我有一个 C++ 应用程序（类似于[这个](http://www.codeguru.com/cpp/i-n/internet/generalinternet/article.php/c3467/)），它使用`URLDownloadToFile`方法（在 urlmon.dll 中定义）下载文件。`E_ABORT`在 IE8 之前，可以通过在进度回调中返回来中止下载。

在安装了 IE8 的系统上，这样做会使程序崩溃，并生成错误报告。

有谁知道取消通过 启动的下载的任何替代方法`URLDownloadToFile`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:09:48.873

如果您使用的是 MFC，您是否考虑过使用 CInternetSession 和 CHttpFile？

我正在使用这些没有任何问题（已安装 IE8）

我正在使用的快速代码片段：

```
CInternetSession internetSession;

CHttpFile *pHttpFile = 
    reinterpret_cast< CHttpFile* >( internetSession.OpenURL( L"www.example.com" ) );

DWORD dwStatusCode;
if ( pHttpFile->QueryInfoStatusCode( dwStatusCode ) && 
    dwStatusCode == HTTP_STATUS_OK )
{
    char szBuffer[ BUFFER_SIZE ];
    DWORD dwBufferIndex = 0;

    DWORD dwBytesRead = (DWORD)pHttpFile->Read( &szBuffer[ dwBufferIndex ], CHUNK_SIZE );
    while ( dwBytesRead > 0 && dwBufferIndex < BUFFER_SIZE )
    {
        dwBufferIndex += dwBytesRead;

        // break out if cancelled 
        if ( m_bCancel )
            break;

        dwBytesRead = (DWORD)pHttpFile->Read( &szBuffer[ dwBufferIndex ], CHUNK_SIZE );
    }

    szBuffer[ dwBufferIndex ] = '\0';

    // szBuffer now contains the file contents
}

pHttpFile->Close();
delete pHttpFile; 
```

这就是我目前正在使用的 - 我需要一个包含内容的缓冲区，但是修改此代码以写入文件应该不是什么大问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:20:15.267

[乔尔](http://www.joelonsoftware.com/articles/fog0000000250.html)有这样的问题。他放弃了它并作弊（作弊意味着取消转移导致用户不再看到转移，但仍然继续进行）。WinInet 有一个错误...

# android - @ 在 AndroidManifest.xml 文件中

> ID：1018392
> 
> 赞同：6
> 
> 时间：2009-06-19T14:50:07.260
> 
> 标签：android, xml

来自 Rick Rogers、John Lombardo、Zigurd Mednieks 和 Blake Meike 的 O'Reilly 书“Android 应用程序开发”，第 23 页：

```
 <TextView
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:text="@string/hello"
    /> 
```

从第 44 页开始：

```
 <application android:icon="@drawable/icon2"> 
```

`@`上述每个片段中的是什么意思？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T15:32:29.360

在这种情况下：

```
android:layout_width="fill_parent" 
```

属性的值 ,`android:layout_width`直接在引号 中指定`fill_parent`。在另一种情况下：

```
android:text="@string/hello" 
```

属性的值 , 在`android:text="@string/hello"`别处指定。这由`@`字符串开头的 表示。在这个例子中是 `@string/hello`. 该值在资源中。

来自Android 开发者网站[的 AndroidManifest.xml 文件](http://developer.android.com/guide/topics/manifest/manifest-intro.html)中的“资源值”部分。[从allclaws](https://stackoverflow.com/users/23977/allclaws)答案中的链接中找到。

> 资源值用以下格式表示，
> 
> @[包：]类型：名称
> 
> 如果资源与应用程序在同一个包中，则包名可以省略，type 是一种资源类型，例如“string”或“drawable”，name 是标识特定资源的名称。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:07:21.530

我倾向于将其视为与资源所在位置有关的缩写，因此：

在正常设置中，它将类似于：

@drawable/icon = /PROJECT_ROOT/res/drawable/icon.png

@string/hello = /PROJECT_ROOT/res/values/strings.xml（一个名为“hello”的元素）

这似乎是额外的麻烦，但实际上效果很好。它还使对国际化和不同屏幕尺寸的支持变得非常容易。您只需为不同的国家代码和布局声明额外的资源文件，Android 就会为您挑选最佳匹配。

此处有关[国际化的](http://developer.android.com/guide/topics/resources/resources-i18n.html)文档可能会更清楚地说明他们为什么决定这样做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:09:27.220

这是资源的类型：http: [//developer.android.com/guide/topics/manifest/manifest-intro.html](http://developer.android.com/guide/topics/manifest/manifest-intro.html)

# sql - 更新 sql 语法 - 使用连接将字段重置为自身 - SQLServer 2005

> ID：1018395
> 
> 赞同：1
> 
> 时间：2009-06-19T14:50:15.607
> 
> 标签：sql, sql-server-2005, syntax-error, sql-update, string-concatenation

我使用这种语法得到错误：

```
update table set field1 = (field1+' - '+field2) where field1 = 'somevalue' 
```

为我做这件事不太高兴。我知道用于连接的“+”在我的选择语句中有效，所以这是正确的语法。这里还有其他东西在起作用......我也尝试删除括号。

例子：

如果 field1 = 'Cheese' 和 field2 = 'ConQueso'
那么我的更新应该将 field1 = 'Cheese' 的所有记录设置为 field1 = 'Cheese - ConQueso'

* * *

**编辑：**
两个字段都是文本字段

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T14:53:57.753

如果不提供错误，很难说，但组合数据大小可能超过 field1。

例如，如果`field1`is varchar(50) 和`field2`is varchar(50)，则包括 your 在内的总和最多可达 103 个字符`' - '`，超过了 field1 的 50 个字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T14:55:03.100

（编辑：在更新澄清数据类型之前的日期是`text`；但可以正常工作`varchar(max)`）

在这里工作正常（SQL2005）：

```
create table [table] (
   field1 varchar(max) not null,
   field2 varchar(max) not null)
insert [table] values ('somevalue','abc')
insert [table] values ('other','def')
update [table] set field1 = (field1+' - '+field2) where field1 = 'somevalue'
select * from [table] 
```

输出：

```
field1               field2
-------------------- --------------------
somevalue - abc      abc
other                def 
```

# java-me - Netbeans IDE 问题

> ID：1018399
> 
> 赞同：0
> 
> 时间：2009-06-19T14:51:00.550
> 
> 标签：java-me, netbeans6.1

在 J2ME (WTK 2.2) 中工作时，NetBeans 6.1 IDE 中的以下问题代表什么？

找不到“builtin.ks”文件/文件夹”

如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T17:09:21.103

似乎 Netbeans 找不到密钥库文件，它正在尝试对文件进行签名。所以，这里是 5.5 版本的 Netbeans 的说明，对于 6.1 应该不会有太大的不同。

*   右键单击项目选择项目属性。然后在左侧菜单列表中选择“签名”。右侧的 UI 将更改为列出密钥库管理的选项。
*   单击“打开安全管理器..”链接，然后在出现的弹出窗口中单击“添加密钥库”按钮。
*   现在选中“添加现有密钥库”的单选框并导航到保存文件的位置。单击确定以完成这些步骤。

另一方面，您可以告诉 Netbeans 不要签署 jad/jar。

*   右键单击项目选择项目属性。然后在左侧菜单列表中选择“签名”。右侧的 UI 将更改为列出密钥库管理的选项。
*   取消选中“签名分发”框，您应该能够避免此错误。

# c# - 如何裁剪大图像

> ID：1018401
> 
> 赞同：6
> 
> 时间：2009-06-19T14:51:02.377
> 
> 标签：c#, image, crop

我需要在 C# 中处理大图像（20,000x20,000 像素）。由于内存限制，直接打开这些图像不是可行的方法，但我想要做的是将图像分割成更小的部分（裁剪）。我一直在寻找可以解决问题的第 3 方库，但到目前为止还没有结果。我尝试了 FreeImage 和 ImageMagick，但它们无法打开 20,000x20x000 像素的图像。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T15:23:24.183

我目前的工作项目包括一个能够加载超过 16 GB 的图像的图像查看器/分析程序。您必须使用手动文件 IO，提取标题信息并按需创建子图像（或者如果您正在处理图像，则可以创建单个图块并就地处理它）。很少有库能够让您加载/修改 20k x 20k 图像（24bpp 时为 1.2gb），而那些这样做的库很少会以类似性能的方式这样做（如果这是一个问题）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:14:34.217

不知道这是否有帮助，但这里有一篇关于[使用 C# lambda 表达式进行图像处理](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2008/12/02/image-processing-with-c-lambda-expressions.aspx)的文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-11-22T00:22:50.273

您可以使用内置的 .Net 库。

利用

`sourceBitmap = (Bitmap)Image.FromStream(sourceFileStream, false, false);`

这将阻止图像数据缓存在内存中。您可以创建一个新的目标位图以将该大量图像的一部分绘制到：

```
var output = new Bitmap(outputWidth, outputHeight);
var outputGraphics = Graphics.FromImage(output);

outputGraphics.DrawImage(sourceBitmap, destRect, srcRect, GraphicsUnit.Pixel);

using (var fs = File.OpenWrite(outputFilePath))
{
    output.Save(fs, System.Drawing.Imaging.ImageFormat.Png);
} 
```

其中 destRect 可以是 outputImage 的整个大小，也可以是较小的区域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-05T19:53:11.260

我不知道有任何现有的图书馆可以做到这一点。

您可能必须打开图像文件流，寻找颜色和像素数据存在的位置，并将像素数据的一部分读入数组，然后从中创建图像。

例如，对于[BMP 文件格式](http://en.wikipedia.org/wiki/BMP_file_format)，您需要查找颜色表，加载颜色表，然后查找像素阵列部分，将您希望的任意数量的像素加载到一个数组中，然后制作一个新的位图那些像素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-06T06:25:04.573

我会用 ImageMagick 来做。有一个非常可靠的 .NET API 可用，它通常是进行此类图像处理的最佳方式。

在 .NET 下查看，在页面下方。

[http://www.imagemagick.org/script/api.php](http://www.imagemagick.org/script/api.php)

以下是有关 ImageMagick 中的裁剪内容如何工作的信息，适用于命令行版本。

[http://www.imagemagick.org/Usage/crop/#crop](http://www.imagemagick.org/Usage/crop/#crop)

# flash - 在运行时资产中使用字体 - actionscript3

> ID：1018404
> 
> 赞同：0
> 
> 时间：2009-06-19T14:51:37.290
> 
> 标签：flash, actionscript-3

我正在尝试实现此处找到的示例：

[http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7d9a.html](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7d9a.html)

我已成功共享影片剪辑，但字体似乎不可用。

我将 AS3 用于 Flash - 而不是 Flex。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T15:30:24.793

刚刚找到答案。导入时需要注册字体。

```
private function onComplete(evt:Event):void {

  var loaderInfo:LoaderInfo = evt.target as LoaderInfo;

  loaderInfo.removeEventListener(
    Event.COMPLETE,
    onComplete
  );

  var appDomain:ApplicationDomain = loaderInfo.applicationDomain;

  var thisIsMyFont:Class;

  try {

    thisIsMyFont = appDomain.getDefinition(
      "ThisIsMyFont"
    ) as Class;

  } catch(ex:Error) {

    throw new Error(
      "The font could not be found!"
    );

  }

  Font.registerFont(thisIsMyFont);

  trace(
    "Now there are " + Font.enumerateFonts().length + " fonts available"
  );

} 
```

# c# - 从集合中按索引获取一组项目的最优雅方法是什么？

> ID：1018407
> 
> 赞同：10
> 
> 时间：2009-06-19T14:52:51.780
> 
> 标签：c#

给定

```
IList<int> indexes;
ICollection<T> collection; 
```

根据 index 中提供的**索引提取****集合中所有****T**的最优雅方法是什么？

 ****例如，如果**集合**包含

```
"Brian", "Cleveland", "Joe", "Glenn", "Mort" 
```

并包含**索引**

```
1, 3 
```

回报将是

```
"Cleveland," "Glenn" 
```

编辑：假设**索引**总是按升序排序。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-06-19T15:35:05.250

这假设索引序列是非负索引的单调升序。该策略很简单：对于每个索引，将集合上的枚举器提升到该点并产生元素。

```
public static IEnumerable<T> GetIndexedItems<T>(this IEnumerable<T> collection, IEnumerable<int> indices)
{
    int currentIndex = -1;
    using (var collectionEnum = collection.GetEnumerator())
    {
        foreach(int index in indices)
        {
            while (collectionEnum.MoveNext()) 
            {
                currentIndex += 1;
                if (currentIndex == index)
                {
                    yield return collectionEnum.Current;
                    break;
                }
            }
        }    
    }
} 
```

与发布的其他解决方案相比，此解决方案的优势：

*   额外存储 O(1) - 其中一些解决方案在空间中是 O(n)
*   O(n) 时间——其中一些解是时间二次方的
*   适用于任何两个序列；不需要 ICollection 或 IList。
*   只迭代一次集合；一些解决方案多次迭代集合（例如，从中构建一个列表。）

缺点：

*   更难阅读

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:04:59.883

这是一个更快的版本：

```
IEnumerable<T> ByIndices<T>(ICollection<T> data, IList<int> indices)
{
    int current = 0;
    foreach(var datum in data.Select((x, i) => new { Value = x, Index = i }))
    {
        if(datum.Index == indices[current])
        {
            yield return datum.Value;
            if(++current == indices.Count)
                yield break;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-19T15:45:37.647

不知道这有多优雅，但你去吧。

因为`ICollection<>`没有给你我刚刚使用的索引`IEnumerable<>`，因为我也不需要`IList<>`我在`IEnumerable<>`那里使用的索引。

```
public static IEnumerable<T> IndexedLookup<T>(
    IEnumerable<int> indexes, IEnumerable<T> items)
{
    using (var indexesEnum = indexes.GetEnumerator())
    using (var itemsEnum = items.GetEnumerator())
    {
        int currentIndex = -1;
        while (indexesEnum.MoveNext())
        {
            while (currentIndex != indexesEnum.Current)
            {
                if (!itemsEnum.MoveNext())
                    yield break;
                currentIndex++;
            }

            yield return itemsEnum.Current;
        }
    }
} 
```

编辑：刚刚注意到我的解决方案类似于 Erics。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-19T14:59:09.770

我会使用扩展方法

```
public static IEnumerable<T> Filter<T>(this IEnumerable<T> pSeq, 
                                       params int [] pIndexes)
{
      return pSeq.Where((pArg, pId) => pIndexes.Contains(pId));
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T14:59:31.517

你可以在扩展方法中做到这一点：

```
static IEnumerable<T> Extract<T>(this ICollection<T> collection, IList<int> indexes)
{
   int index = 0;
   foreach(var item in collection)
   {
     if (indexes.Contains(index))
       yield item;
     index++;
   }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-19T15:13:15.450

不优雅，但高效 - 确保对索引进行排序......

```
ICollection<T> selected = new Collection<T>();
var indexesIndex = 0;
var collectionIndex = 0;
foreach( var item in collection )
{
    if( indexes[indexesIndex] != collectionIndex++ )
    {
        continue;
    }
    selected.Add( item );
    if( ++indexesIndex == indexes.Count )
    {
        break;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-19T15:22:29.690

作为一个正确的答案：

```
var col = new []{"a","b","c"};
var ints = new []{0,2};
var set = new HashSet<int>(ints);

var result = col.Where((item,index) => set.Contains(index)); 
```

通常使用 IList.Contains 或 Enumerable.Contains，如果您不知道集合中有多少索引，则不要在列表中进行查找。或者你会走 O(n^2) 的艰难道路。如果您想安全起见，则应使用中间查找/字典/哈希集并在此集合上进行测试，而不是在普通列表上进行测试（线性搜索对您不利）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-19T15:28:47.540

这里已经有几个很好的建议，我只会投入两分钱。

```
int counter = 0;
var x = collection
    .Where((item, index) => 
        counter < indices.Length && 
        index == indices[counter] && 
        ++counter != 0); 
```

编辑：是的，第一次没想到。只有在满足其他两个条件时才会发生增量..

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-22T00:34:35.890

我发现这个解决方案特别优雅，而且更容易理解。

**解决方案 1**

```
 public static IEnumerable<T> GetIndexedItems2<T>(this IEnumerable<T> collection,    IEnumerable<int> indices) {

        int skipped = 0;
        foreach (int index in indices) {
            int offset = index - skipped;
            collection = collection.Skip(offset);
            skipped += offset;
            yield return collection.First();
        }
    } 
```

这可以进一步重构为一个真正简单的实现：

**解决方案 2**

```
 public static IEnumerable<T> GetIndexedItems3<T>(this IEnumerable<T> collection, IEnumerable<int> indices) {
        foreach (int offset in indices.Distances()) {
            collection = collection.Skip(offset);
            yield return collection.First();
        }
    }

    public static IEnumerable<int> Distances(this IEnumerable<int> numbers) {
        int offset = 0;
        foreach (var number in numbers) {
            yield return number - offset;
            offset = number;
        }
    } 
```

**但我们还没有完成**

由于延迟执行 LINQ 跳过太慢了。

```
 public static IEnumerable<T> GetIndexedItems4<T>(this IEnumerable<T> collection, IEnumerable<int> indices) {
        var rest = collection.GetEnumerator();
        foreach (int offset in indices.Distances()) {
            Skip(rest, offset);
            yield return rest.Current;
        }
    }

    static void Skip<T>(IEnumerator<T> enumerator, int skip) {
        while (skip > 0) {
            enumerator.MoveNext();
            skip--;
        }
        return;
    }

    static IEnumerable<int> Distances(this IEnumerable<int> numbers) {
        int offset = 0;
        foreach (var number in numbers) {
            yield return number - offset;
            offset = number;
        }
    } 
```

基准测试为我们提供了与 Eric 解决方案相似的性能。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace ConsoleApplication21 {

    static class LinqExtensions {

        public static IEnumerable<T> GetIndexedItemsEric<T>(this IEnumerable<T> collection, IEnumerable<int> indices) {
            int currentIndex = -1;
            using (var collectionEnum = collection.GetEnumerator()) {
                foreach (int index in indices) {
                    while (collectionEnum.MoveNext()) {
                        currentIndex += 1;
                        if (currentIndex == index) {
                            yield return collectionEnum.Current;
                            break;
                        }
                    }
                }
            }
        }

        public static IEnumerable<T> GetIndexedItemsSam<T>(this IEnumerable<T> collection, IEnumerable<int> indices) {
            var rest = collection.GetEnumerator();
            foreach (int offset in indices.Distances()) {
                Skip(rest, offset);
                yield return rest.Current;
            }
        }

        static void Skip<T>(this IEnumerator<T> enumerator, int skip) {
            while (skip > 0) {
                enumerator.MoveNext();
                skip--;
            }
            return;
        }

        static IEnumerable<int> Distances(this IEnumerable<int> numbers) {
            int offset = 0;
            foreach (var number in numbers) {
                yield return number - offset;
                offset = number;
            }
        }
    } 

    class Program {

        static void TimeAction(string description, int iterations, Action func) {
            var watch = new Stopwatch();
            watch.Start();
            for (int i = 0; i < iterations; i++) {
                func(); 
            }
            watch.Stop();
            Console.Write(description);
            Console.WriteLine(" Time Elapsed {0} ms", watch.ElapsedMilliseconds);
        }

        static void Main(string[] args) {

            int max = 100000;
            int lookupCount = 1000;
            int iterations = 500;
            var rand = new Random();
            var array = Enumerable.Range(0, max).ToArray();
            var lookups = Enumerable.Range(0, lookupCount).Select(i => rand.Next(max - 1)).Distinct().OrderBy(_ => _).ToArray();

            // warmup 
            array.GetIndexedItemsEric(lookups).ToArray();
            array.GetIndexedItemsSam(lookups).ToArray();

            TimeAction("Eric's Solution", iterations, () => {
                array.GetIndexedItemsEric(lookups).ToArray();
            });

            TimeAction("Sam's Solution", iterations, () =>
            {
                array.GetIndexedItemsEric(lookups).ToArray();
            });

            Console.ReadKey();
        }
    }
} 
```

```

Eric 的求解时间经过 770 毫秒
Sam 的求解时间经过 768 毫秒

```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-19T16:24:49.823

我喜欢linq。

```
 IList<T> list = collection.ToList<T>();

    var result = from i in indexes
                 select list[i];

    return result.ToList<T>(); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-19T14:59:27.023

据我了解，ICollection 可能不一定有任何顺序，这就是为什么没有非常优雅的解决方案来按索引访问事物的原因。许多人想考虑使用字典或列表将数据存储在集合中。

我能想到的最好方法是遍历集合，同时跟踪您所在的索引。然后检查索引列表是否包含该索引。如果是，则返回该元素。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-19T15:09:41.090

```
 public static IEnumerable<T> WhereIndexes<T>(this IEnumerable<T> collection, IEnumerable<int> indexes)
    {
        IList<T> l = new List<T>(collection);
        foreach (var index in indexes)
        {
            yield return l[index]; 
        }
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-19T15:16:53.400

似乎最有效的方法是使用 a`Dictionary<int,T>`而不是 a `Collection<T>`。您仍然可以在`IList<int>`.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-19T16:15:38.170

也许我错过了一些东西，但是有什么问题：

```
indexes.Select( (index => values[index])) 
```****

# linux - 如何远程监控家用电源插座的可用性？

> ID：1018409
> 
> 赞同：0
> 
> 时间：2009-06-19T14:53:15.990
> 
> 标签：linux, monitor, ups

我们有一个插入 GFCI 电源插座的冰箱，它喜欢“弹出”并每隔一段时间自行关闭。

我想做的是监控这个电源插座的可用性。理想情况下，我想插入一个便宜的监控设备，比如 Smarthome 或 X10 类型的设备。当电路关闭时，该设备会触发另一台计算机上的一些脚本，该脚本可以向我发送电子邮件或其他任何东西。

我无法从 Smarthome 和 X10 设备中找到类似的东西。

我知道一些 UPS（不间断电源）设备会在断电时发送某种信号。我想这可能是我需要的。我需要使用 RS-232 电缆吗？我需要配置一个便宜的 linux 服务器来做到这一点吗？或者有没有办法这些设备之一可以通过以太网发送触发器？并且可以在没有太多费用的情况下完成吗？

总结；我想要一个便宜的解决方案，以便在电源插座没电时向我发送电子邮件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T14:58:23.593

有很多方法可以做这样的事情。如果您对电子产品有经验，我建议您自己构建，因为我认为您不会找到任何不是某种可靠性监视器（因此价格昂贵）的商业产品。您可以在某些网站上找到一些设计理念，甚至可能是完整的设计，例如[hack a day](http://hackaday.com)。如果您不想弄乱任何硬件并且成本不是太大的因素，那么中级UPS实际上可能是解决这个问题的好方法。

但实际上，这里的问题不在于监控插座，而在于 GFI 跳闸的原因。要么 GFI 坏了，需要更换（非常便宜，而且很容易自己动手），要么你的冰箱坏了，接地不当——应该修理或更换，因为这很危险。

此外，这与编程无关...... prolly 将被关闭。

# c# - 与 XML 文件的事务

> ID：1018410
> 
> 赞同：2
> 
> 时间：2009-06-19T14:53:21.387
> 
> 标签：c#, .net, xml, compact-framework

我正在寻找在 C# 中实现类似事务的数据库。我正在处理多个 XML 文件。任何特定的 XML 文件都可以在处理期间调用子 XML 文件。处理器将开始处理子 XML 文件。如果初始化条件失败或出现异常，那么我想继续处理父 XML 文件。这就是我正在寻找类似事务的实现的原因，以便我可以回滚。有没有可能实现？有人可以提供我的代码片段或伪代码吗？

仅供参考 - 我正在使用 .NET Compact Framework。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:30:39.143

在紧凑的框架上，我认为您将推出自己的事务管理器。

在完整的框架上，您可能已经使用 TransactionScope 和 IEnlistmentNotification 构建了一些东西。您必须做很多工作才能使您的所有操作都可交易，因为不支持开箱即用的 xml 交易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:04:20.150

如果不滚动您自己的自定义事务管理组件，这将难以实现。

您不能在允许您的应用程序开始其处理阶段之前预先验证/验证所有 XML 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T22:02:01.420

也许你可以尝试使用颠覆。有一些库可以从 C# 控制它。因此，要开始事务，您只需开始工作，而要回滚，则执行回滚。提交你的 svn 树完成你的交易。

我不知道这是不是太简单的方法。可能是这样，但是您所描述的仅需要事务的某些属性。具体来说，您已经表明您需要原子性（即能够同时回滚对多个文件的更改）。持久性是隐含的，但提交会让你明白这一点。

除了存在初始化条件和异常之外，您没有提到任何一致性约束，但大概您的代码可以处理这些，并在任何规则被破坏时强制回滚。

隔离要么难，要么容易。这完全取决于您是否需要一次支持多个事务。是否要求您允许并发更新？如果没有，只需构建一些东西来强制对系统进行串行访问，你就完成了。如果您需要并发更新，恐怕我没有想法:-)

# c# - 如何从 C 代码创建 ac# 对象？

> ID：1018413
> 
> 赞同：1
> 
> 时间：2009-06-19T14:54:18.920
> 
> 标签：c#, c++, interop

我正在使用一个小型 C 网络服务器。我正在使用 C# 库进行一些实际的请求处理。

我正在使用似乎是用接近 c++ 的东西编写的粘合层来加入这两个世界。它提供了一个“公共引用类”，我可以从 C# 世界中派生它。

如果我想在 C# 中从中派生几个不同的类，如何从 C/C++ 创建这些派生类的实例？

我应该（以及以什么形式）从 C# 到 C/C++ 代码传递什么信息（类名？工厂函数？）？

我想要一个与 .NET 2.0 兼容的解决方案，并且我正在使用 Visual Studio 2008 创建我的代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T17:52:37.077

我已经多次意识到人们有时并没有完全意识到托管代码和非托管代码之间的区别，所以我想总结一下：

1.  您不能简单地从本机 C++ 应用程序调用托管代码。为了调用它，您首先必须将您的 .Net 代码公开给 COM，然后在 C++ 中实例化一个 COM 对象。这样，您的本机应用程序会认为它正在像其他任何应用程序一样创建 COM 对象，而 .Net 在运行时执行所有互操作。

2.  第二种方法是使用托管 C++/CLI（它不是本机 C++，但支持两个世界）。通过这种方式，C++ 和 C# 应用程序都得到了管理，并且可以无缝通信。因此，只要“粘合层”是使用托管 C++/CLI 编写的，您就可以使用本机数据和托管数据。

正如您最初提到的非托管 C++，那么答案将是第一个解决方案：通过 COM 互操作将托管对象公开给本机世界。如果您不介意使用托管 C++/CLI，那么您有一个更简单的解决方案 - 您可以轻松地实例化托管类（在语法上进行一些更改，您应该很快就习惯了）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:03:21.383

请参阅*如何在 Visual Studio.NET 或 Visual Studio 2005 中从本机 Visual C++ 代码调用托管 DLL*。

[http://support.microsoft.com/kb/828736](http://support.microsoft.com/kb/828736)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T17:13:34.877

使用 #using 指令将 C# 程序集导入 C++ 代码。

```
#using "ThingLib.dll"
using namespace ThingLib; 
```

如果您只希望 C++ 代码了解基类，则需要调用某种工厂方法。

```
ThingBase^ thing = myThingFactory.MakeThing(aParameter); 
```

如果要在 C++ 中实际实例化派生类，请使用`gcnew`运算符。

```
ThingBase^ thing = gcnew DerivedThing(aParameter); 
```

这里有一个关于与托管代码交谈的新 C++ 语言功能的很好的总结：http: [//msdn.microsoft.com/en-us/library/xey702bw.aspx](http://msdn.microsoft.com/en-us/library/xey702bw.aspx)

# xml - 如何在我不关心元素名称的 XML 模式中指定？

> ID：1018414
> 
> 赞同：0
> 
> 时间：2009-06-19T14:54:27.487
> 
> 标签：xml, xsd

我正在尝试解析 XML 文件，并且我想提供一个模式来进行验证，但是，由于我不关心某些标签名称，我希望允许用户为某些标签指定任何内容。

示例 XML：

```
<root>
    <record>
        <data1>foo</data1><data2>bar</data2>
    </record>
    <record>
        <data2>foo2</data2><data1>bar2</data1>
    </record>
</root> 
```

在本例中，标签名称“data1”和“data2”对程序很重要（主要是因为它们可以按上述任意顺序出现），但标签名称“record”和“root”则不重要。

最好允许用户使用任何（非空）字符串为“记录”和“根”指定 XML，这些字符串仍然可以针对我的模式进行验证。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:08:50.297

这违背了拥有 Schema 和定义合同的目的。它的作用是要求用户联系开发人员（您）以了解如何使用您的服务。您不想陷入这样一种情况，即了解如何使用服务的准则是“联系 Jack”。

# python - Python 和 if 语句

> ID：1018415
> 
> 赞同：2
> 
> 时间：2009-06-19T14:54:30.357
> 
> 标签：python, if-statement

我正在运行一个脚本来为 exe 文件提供如下语句：

```
for j in ('90.','52.62263.','26.5651.','10.8123.'):
    if j == '90.':
        z = ('0.')
    elif j == '52.62263.':
        z = ('0.', '72.', '144.', '216.', '288.')
    elif j == '26.5651':
        z = ('324.', '36.', '108.', '180.', '252.')
    else:
        z = ('288.', '0.', '72.', '144.', '216.')

    for k in z:

        exepath = os.path.join('\Program Files' , 'BRL-CAD' , 'bin' , 'rtarea.exe')
        exepath = '"' + os.path.normpath(exepath) + '"'
        cmd = exepath + '-j' + str(el) + '-k' + str(z)

        process=Popen('echo ' + cmd, shell=True, stderr=STDOUT )
        print process 
```

我正在使用命令提示符，当我使用这些数字运行 exe 时，有时它似乎不正常。就像有时它会打印出 52.62263 的 3 条语句，但在它们全部打印出来之前，它会打印出一个 26.5651，然后返回 52.62263。不仅仅是那些数字表现得像这样。不同的运行可能是不同的数字（“两个​​”90 语句之间的 52.62263）。总而言之，我希望它按从上到下的顺序打印。有什么建议并使用我的代码有什么有用的解决方案吗？谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T14:57:07.183

`z = ('0.')`不是元组，因此您的`for k in z`循环将遍历字符“0”和“.”。添加一个逗号告诉 python 你希望它是一个元组：

```
z = ('0.',) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:06:14.373

我认为现在发生的事情是，您不会在打印之前等待这些过程完成。在最后两行尝试这样的事情：

```
from subprocess import Popen, STDOUT
stdout, stderr = Popen('echo ' + cmd, shell=True, stderr=STDOUT).communicate()
print stdout 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-19T15:10:57.513

eduffy 说了什么。这更干净一点；只是打印，但你明白了：

```
import os

data = {
    '90.': ('0.',),
    '52.62263.': ('0.', '72.', '144.', '216.', '288.'),
    '26.5651.': ('324.', '36.', '108.', '180.', '252.'),
    '10.8123.': ('288.', '0.', '72.', '144.', '216.'),
}

for tag in data:
    for k in data[tag]:
        exepath = os.path.join('\Program Files', 'BRL-CAD', 'bin', 'rtarea.exe')
        exepath = '"' + os.path.normpath(exepath) + '"'
        cmd = exepath + ' -el ' + str(tag) + ' -az ' + str(data[tag])
        process = 'echo ' + cmd
        print process 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T15:11:09.620

既然你已经就这段代码发表了一些帖子，请允许我纠正/pythonify/beautify整个事情：

```
for j,z in {
        '90.'       : ('0.',) ,
        '52.62263.' : ('0.',   '72.', '144.', '216.', '288.') ,
        '26.5651.'  : ('324.', '36.', '108.', '180.', '252.') ,
        '10.8123.'  : ('288.', '0.',  '72.',  '144.', '216.')
    }.iteritems():

    for k in z:
        exepath = os.path.join('\Program Files' , 'BRL-CAD', 'bin' , 'rtarea.exe')
        exepath = '"%s"' % os.path.normpath(exepath)
        cmd = exepath + '-j' + str(el) + '-k' + z

        process = Popen('echo ' + cmd, shell=True, stderr=STDOUT )
        print process 
```

# sql - 序数使用哪种数据类型？

> ID：1018418
> 
> 赞同：2
> 
> 时间：2009-06-19T14:54:57.517
> 
> 标签：sql, sql-server, database, data-structures

每当我有一些想要按特定顺序排列的记录/对象时，我通常会创建一个名为 Ordinal 的字段。

我经常想知道对序数字段使用整数还是十进制值会更好。

这是将对象按顺序移动到不同位置时的考虑因素：

*   如果您使用连续整数，则必须对所有序数（或至少落在被移动对象的原始位置之前的序数）进行一些认真的修改。

*   如果您使用整数但将它们隔开（可能以 1000 个间隔），那么您只需将序数更改为要移动对象的周围对象之间的中点值。如果在某处你最终得到连续的整数，这可能会失败。

*   如果您使用十进制数字，您可以找到周围对象序数的平均值并将其用于要移动的对象。

*   也许可以使用字符串，但我可以看到它变得非常愚蠢。

我敢肯定还有其他我没有想到的考虑因素。你用什么，为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:33:42.037

小数似乎很好地解决了您的问题。由于小数只是以 10 为底的浮点数，因此您实际上有很多可用的数字。除非您已经看到了一些数字，并且有理由怀疑需要无限位数的原因，否则我会顺其自然。

如果您确实需要替代方案并且认为不需要坚持使用基本数据字节，则可以使用[不倒翁算法](http://www.udanax.com/green/febe/tumblers.html)。基本思想是它是一个在每个位置都可以无限扩展的位置符号。概念上很简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:05:11.723

“如果在某个地方你最终得到连续的整数，这可能会失败。”

对于这种情况（可能很少见，因此对性能不重要），您可以实现一个重新编号的方法，该方法再次间隔。当我以前用 COMAL 编程时（有人知道那种语言吗？），你可以用行号来做这件事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T14:59:33.247

我记得这是一个与以前的帖子类似的问题。在这里能找到它：

[SQL Server 优先顺序](https://stackoverflow.com/questions/112551/sql-server-priority-ordering/112565#112565)

链接列表仍然可以工作，但如果您不想跟踪父子关系，这是一个更简单的解决方案。

听起来你想要的是一个链表。这样，您总是知道接下来会发生什么，而不必猜测。所以位置字段将是指向它后面的对象的指针。

使用任意数字作为位置时我一直遇到的问题是它会很快陷入熵。如果添加了更多项目并且数量变得连续等等等等。如果项目列表改变位置，它很快就会变得难以管理。

要在 sql server 表中实现这一点，请添加另一个与主键具有相同数据类型的字段。如果该字段为空，则它是列表中的底部元素。如果您在同一个表中存储多个列表，您可能需要添加另一个名为 ListID 的字段，它指定具有相同 ListID 的所有行属于同一个列表。所以像这样。

```
Table:
ID INT
ListID INT
Child INT

Pararent Row For first list:
 1, 1, 2
First Child
 2, 1, 3
Second Child
3, 1, NULL

Parent Row for second list:
4, 2, 5
First Child
5, 2, 6
Second Child
6, 2, NULL 
```

每次添加一行时，您可能都必须进行插入和更新，这可能有点乏味，但它总是会使列表对齐。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:00:25.133

我曾经对这种类型的字段使用十进制类型来对表中的记录进行排序，我们实际上将其暴露给客户，以便他们可以设置自己的顺序。虽然听起来很俗气，但我们的客户喜欢它；他们发现它非常直观。他们很快就发现他们可以使用像 21.5 这样的数字在 21 和 22 之间移动。

也许是因为他们是会计师。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T21:36:37.820

当需要在订单中间插入新项目时，我使用整数并根据需要重新排列。由于您可以使用单个更新语句创建必要的间隙，因此它相当简单。但是，我最多只在几十行的查找表上做过这个，显然这扩展性有点差。但是我想说，如果您需要针对大量行解决此问题，那么维护顺序的过程无论如何都应该程序化，这使得数据类型的选择在很大程度上没有实际意义。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-06-19T15:04:24.813

“一定的顺序”是基于表外的数据吗？如果是这样，为什么不包括它，以便您可以动态进行排序？如果它已经在表中，添加一个字段是多余的。

# windows - 对 Windows 上的命令行搜索和替换工具的建议

> ID：1018427
> 
> 赞同：8
> 
> 时间：2009-06-19T14:57:07.870
> 
> 标签：windows, replace

我正在寻找可以在命令行上使用的 Windows 工具 (exe) 或 Python 脚本，以在源代码树中递归地搜索和替换文本文件中的字符串。我试图避免像 linux 工具那样的 sed/awd 的自定义语法。它需要自动化，因此它需要是命令行。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:01:26.270

我认为 WinGrep 可能会满足您的需求。我相信它可以从命令行运行。链接：[www.wingrep.com](http://www.wingrep.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:23:31.343

有点贵，但[PowerGrep](http://www.powergrep.com)有一个命令行界面，手册上是这么说的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-09T16:56:20.650

有 fnr.exe，它是一个支持命令行的轻量级实用程序。它没有 grep 那么多的功能，但是通过以 windows 形式提供所有参数，可以很容易地生成命令行脚本。可从此处获得：http: [//findandreplace.codeplex.com](http://findandreplace.codeplex.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-18T14:03:32.097

记事本++ 工作得很好。免费插件。搜索 - 在文件中查找...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-12-31T14:02:18.020

```
sed -i%TEMP%\* "s/regexp/replacement/g" *.txt 
```

备份文件将在临时目录中。可以使用 Chocolatey 轻松下载 Sed： [https ://chocolatey.org/packages/sed](https://chocolatey.org/packages/sed)

# usb - USB 清除端点功能

> ID：1018429
> 
> 赞同：0
> 
> 时间：2009-06-19T14:57:39.117
> 
> 标签：usb, usbserial

我正在为 USB 设备开发 CDC 驱动程序，但偶然发现了一些问题。我在 Windows 端使用的驱动程序使用 Clear endpoint Feature 作为某种 flash 机制或正确获取数据。这给我带来了很多麻烦，因为我无法让它工作。我认为数据切换不同意，并且我错过了一些重要的数据传输，甚至由于清除数据切换错误而没有获得与该端点相关的中断。正如 USB 标准中所指出的，我在设置接口和清除功能时将数据切换重置为 0。当我应该这样做时，还有更多情况吗？或者是否有简单的错误处理无效数据切换的方法。

感谢您的回答。我有 USB 分析仪，但我现在对我没有任何好处。从我能设法收集到的东西来看，我认为正在发生。在清除功能（应该这样做）之后，我在硬件中为对应的端点设置了 datatoggle 位。发送一些数据，在 PC 上接收。我知道这种形式的 USB 分析器，我用端口监视器跟踪了我的 Vcom 驱动程序。然后我等待一些数据，因为一切都已配置（设备枚举等），最初的问题是 anwsered 但下一个问题不是，在明确端点故障后，PC 端再次提出问题。这应该会触发对应端点的 UBS 中断，但它并没有发生，一段时间后再次出现明确的端点功能和相同的包，并且它一次又一次地得到响应，通信协议保持沉默。

我希望我清楚地说明了这个问题，对于哈瓦雷方面，我认为唯一值得关注的是我正在设置的位。它声明“向该位写入 1 以将端点数据切换重置为 0”。好的，我认为（希望）我解决了 Clear 端点故障，其他错误是由其他原因引起的，并且累积问题很难发现。

* * *

好的，我前段时间解决了这个问题，现在我什至不记得是什么原因了，但通常情况下 - 这是另外一回事。与anwser相关的每个人都感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T14:02:53.313

我建议使用[usb snoopy](http://sourceforge.net/projects/usbsnoop/)（软件usb分析器）来了解你做错了什么。如果您有任何预算，您最好购买硬件 USB 分析仪，例如[Lecroy](http://www.lecroy.com/tm/products/ProtocolAnalyzers/usb.asp?menuid=67)或[Ellisys](http://www.ellisys.com/products/usbex200/index.php)。或者获取商业 CDC 驱动程序，只有谷歌可用于 cdc 驱动程序。您的问题描述非常笼统，可以直接解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-22T11:33:51.147

请注意，在某些版本的 usbser.sys 上，Windows 在传输 64 字节的精确倍数后无法正确刷新管道。从您的问题中我并不清楚这是否是您所看到的行为，但是 USB 分析器应该可以帮助您确定是否是这种情况。如果您使用的是 XP SP2，请升级到 SP3。

# c++ - 用于分析 C++ 源代码 (MSVC) 的工具

> ID：1018438
> 
> 赞同：2
> 
> 时间：2009-06-19T14:59:02.453
> 
> 标签：c++, code-analysis, visual-c++

我需要一个工具来分析 C++ 源代码并说明未使用哪些代码。源大小约为 500mb

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:05:51.177

PC-Lint 很好。如果它需要免费/开源，您的选择就会减少。Cppcheck 是免费的，并且会检查未使用的私有函数。我不认为它会寻找诸如 PC-Lint 之类的未实例化类之类的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:37:23.997

再一次，我将把[AQTime](http://www.automatedqa.com)放到讨论中。对大多数（如果不是全部）支持的语言进行静态代码分析。不过我并没有真正进入那部分，我主要使用动态分析器（内存、性能等）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-12T06:22:05.560

您可以使用代码覆盖率工具（动态分析）来了解哪些代码没有被执行，然后手动分析以查看该代码是否真的没用。

如果您想要进行静态分析，您需要一个可以读取整个 500Mb 源代码（估计有 2000 万行？哇！）并计算所使用内容的保守估计的工具。这需要对整个系统进行点对点分析。

原因如下：如果您遗漏了任何模块 Z，并确定未使用 FOO，您稍后可能会发现 Z 恰好是使用 FOO 的模块，或者更巧妙的是，Z 复制了一个恰好包含 &FOO 的指针值到第三个模块 M，该模块又通过指针调用“未使用”函数。

这意味着没有任何静态分析工具只能读取单个模块（编译单元）可以安全地回答这个问题。在你的规模上，你不能犯愚蠢的错误。

我的公司 Semantic Designs 使用我们的 DMS Software Reengineering Toolkit 对 3500 万行 C 代码系统进行了点对点分析。DMS *可以*读取非常大的源代码系统。它需要一个自定义工具，与其说是因为源代码是 C++ 的一种奇怪的（古老的）方言，不如说是因为非常现代的方言中的系统不可能这么大，没有足够的时间来编写它们！），而是因为在非常大型系统还有其他特殊因素在起作用。对于我们所做的 C 系统，有一个自定义动态链接器，这会影响指向分析，而后者又必须进行自定义。

因为您正在讨论的规模系统总是有这样的惊喜（BIBSEH：“因为在大系统中，一切都会发生”），您可能需要一个自定义工具来回答这个问题。DMS 旨在定制。请参阅[http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html) 和[http://www.semanticdesigns.com/Products/FrontEnds/CppFrontEnd.html](http://www.semanticdesigns.com/Products/FrontEnds/CppFrontEnd.html)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-06-19T15:07:34.307

代码覆盖工具是您所需要的，但您必须通过所有功能运行我们的程序并查看报告为未使用的内容。由于代码可能是 DLL 导出函数，因此您必须确保没有在外部使用它们。一些代码覆盖率工具：如果我没记错的话，Purify、CTC++、Boundschecker 和一堆其他工具可能具有代码覆盖率功能。

在不知道可能链接/使用它的外部程序的情况下删除任何可能已导出的函数时要非常小心。

# performance - 插入大块数据后 Sql Express 性能下降

> ID：1018451
> 
> 赞同：1
> 
> 时间：2009-06-19T15:00:59.483
> 
> 标签：performance, sql-server-express

我们注意到，与在每条记录的基础上添加数据但数据量相似的数据库相比，我们的查询在添加了大量数据（批量插入）的数据库上运行速度较慢。我们使用 Sql 2005 Express 并尝试重新索引所有索引，但没有任何更好的结果。您是否知道数据库中的某种结构问题可能是由大块而不是一个一个地插入数据引起的？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:16:32.387

我看到的一个提示是在进行批量插入之前关闭自动创建统计信息和自动更新统计信息：

```
ALTER DATABASE databasename SET AUTO_CREATE_STATISTICS OFF WITH NO_WAIT

ALTER DATABASE databasename SET AUTO_UPDATE_STATISTICS OFF WITH NO_WAIT 
```

之后，通过以下两种方法之一手动创建统计信息：

```
--generate statistics quickly using a sample of data from the table
exec sp_createstats 
```

或者

```
--generate statistics using a full scan of the table
exec sp_createstats @fullscan = 'fullscan' 
```

完成后，您可能还应该重新打开自动创建和自动更新统计信息。

另一种选择是在批量插入后检查索引并对其进行碎片整理。查看 Pinal Dave 的[博客文章](http://blog.sqlauthority.com/2008/03/04/sql-server-2005-a-simple-way-to-defragment-all-indexes-in-a-database-that-is-fragmented-above-a-declared-threshold/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:03:47.373

可能 SQL Server 以许多小块的形式分配了新的磁盘空间。在进行大事务时，最好在数据文件和日志文件中预先分配大量空间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:17:33.413

这是一个有趣的问题。

我会猜到 Express 和非 Express 具有相同的存储布局，因此当您在谷歌上搜索其他有类似问题的人时，不要限制自己在谷歌上搜索 Express 版本中的问题。但另一方面，批量插入是一种常见的操作，性能很重要，所以我认为这不太可能是以前未检测到的错误。

一个明显的问题：哪个是聚集索引？聚集索引也是主键吗？插入时主键是否未分配，因此由数据库初始化？如果是这样，那么数据库分配的连续值的模式或序列可能存在差异（两种插入方法之间），这会影响数据的聚类方式，进而影响性能。

别的东西：除了索引，人们说 SQL 使用统计信息（它作为运行先前查询的结果创建）来优化其执行计划。我不知道任何细节，但是除了“重新索引所有索引”之外，检查两个测试用例中查询的执行计划以确保计划相同（和/或检查相关的统计信息）。

# c - 将指针转换为 int64_t 时丢失最重要的 32 位

> ID：1018452
> 
> 赞同：2
> 
> 时间：2009-06-19T15:00:59.483
> 
> 标签：c, gcc, casting

有人可以解释以下奇怪的行为吗？

我在 64 位 Intel 平台上运行以下程序：

```
include <stdio.h>
#include <stdint.h>

int main(void)
{
  int x;
  int *ptr = &x;

  printf("ptr = %p\n", ptr);
  printf("sizeof(ptr) = %d\n", sizeof(ptr));

  int64_t i1 = (int64_t) ptr;
  printf("i1 = 0x%x\n", i1);
  printf("sizeof(i1) = %d\n", sizeof(i1));

  return 0;
} 
```

该程序产生以下输出：

```
ptr = 0x7fbfffdf2c
sizeof(ptr) = 8
i1 = 0xbfffdf2c
sizeof(i1) = 8 
```

谁能解释为什么 i1 只包含 ptr 的最低有效 32 位？（请注意，它缺少 0x7f）。

```
Compiler: gcc version 3.4.6 20060404 (Red Hat 3.4.6-9)
OS: Linux scream 2.6.9-67.ELsmp #1 SMP Wed Nov 7 13:56:44 EST 2007 x86_64 x86_64 x86_64 GNU/Linux
Processor: Intel(R) Xeon(R) CPU E5430  @ 2.66GHz 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-19T15:06:08.007

它没有去任何地方..您的打印声明是错误的。试试这个：

```
printf("i1 = 0x%lx\n", i1); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T15:10:25.160

首先，您将指针转换为有符号整数 - 这是错误的 - 指针是无符号的。然后，您使用格式修饰符打印 64 位值`%x`- 堆栈上需要 32 位值。尝试编译`-Wall -pedantic`并`gcc`抱怨。

# ruby-on-rails - 从 ActiveRecord 模型中获取 ID 列表的最佳实践

> ID：1018453
> 
> 赞同：4
> 
> 时间：2009-06-19T15:01:25.957
> 
> 标签：ruby-on-rails, optimization, activerecord

我有一个 ActiveRecord 模型`Language`，有列`id`和`short_code`（还有其他列，但它们与这个问题无关）。我想创建一个方法，该方法将获得一个短代码列表，并返回一个 ID 列表。我不关心关联，我只需要最终得到一个看起来像 [1, 2, 3, ...] 的数组。

我的第一个想法是做类似的事情

```
def get_ids_from_short_codes(*short_codes)
  Language.find_all_by_short_code(short_codes.flatten, :select => 'id').map(&:id)
end 
```

但我不确定这是否不必要地浪费时间/内存/处理。

我的问题是双重的：

1.  有没有办法运行 ActiveRecord 查找，它只返回某个表列的数组而不是实例化对象？
2.  *如果是这样，收集一个长度为n*的数组而不是实例化*n 个*ActiveRecord 对象真的值得吗？

请注意，对于我的特定目的，*n*大约为 200。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-11-21T17:41:56.040

在 Rails 3.x 中，您可以使用`pluck`从请求字段返回值的方法，而无需实例化对象来保存它们。

这将为您提供一组 ID：

```
Language.where(short_code: short_codes.flatten).pluck(:id) 
```

我应该提一下，在 Rails 3.x 中，您一次只能提取一列，但在 Rails 4 中，您可以传递多列来提取。

顺便说一句，这里有一个[类似问题的](https://stackoverflow.com/questions/2393412/ruby-on-rails-is-there-a-method-to-retrieve-an-array-of-data-from-the-database)[类似答案](https://stackoverflow.com/a/12807232/793309)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:10:05.083

老实说，对于 200 条记录，我不会担心。当您达到 2000、20,000 或 200,000 条记录时，您就可以担心优化了。

确保您的表中有 short_code 索引。

如果您仍然关心性能，请查看 development.log 并查看该特定调用的数据库编号。您可以调整查询并查看它如何影响日志中的性能。这应该给你一个粗略的性能估计。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-19T15:13:58.693

同意前面的答案，但如果你绝对必须，你可以试试这个

```
sql = Language.send(:construct_finder_sql, :select => 'id', :conditions => ["short_code in (?)", short_codes])
Language.connection.select_values(sql) 
```

虽然有点难看，但它不会创建内存对象。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-04T15:25:27.643

如果您使用关联，则可以直接从 ActiveRecord 获取原始 ID。例如。：

```
class User < ActiveRecord::Base
  has_many :users
end

irb:=> User.find(:first).user_ids
irb:>> [1,2,3,4,5] 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T15:14:37.913

菲尔对此是正确的，但如果您确实发现这是一个问题。您可以将原始 SQL 查询发送到数据库并在 ActiveRecord 以下的级别上工作。这对于这样的情况很有用。

```
ActiveRecord::Base.connection.execute("SQL CODE!") 
```

在使用此功能之前，请先对您的代码进行基准测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T15:25:59.403

这确实是一个选择问题。

不管是否矫枉过正，ActiveRecord**应该**给你对象，因为它是一个 ORM。就像 Ben 说的那样，如果您不想要对象，请使用原始 SQL。

# asp.net - 什么与 AspNetMembershipProvider 中的 DotNetNuke UserLogin 函数交互？

> ID：1018458
> 
> 赞同：0
> 
> 时间：2009-06-19T15:02:04.537
> 
> 标签：asp.net, login, dotnetnuke, bll

我试图找出与 AspNetMembershipProvider 部分的 UserLogin 函数交互的登录功能在哪里，没有提到登录功能存在的位置。我知道这是完整保存数据的功能，我只需要在源代码中找到登录的位置，以便我可以自定义登录（例如，基于用户角色、个性化消息等在登录时重定向）

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T15:34:19.450

没关系，找到了，就是有点瞎。Login.aspx.cs 有它，它只是在私有成员部分，我正在查看事件处理程序部分。

# sql - 使用 SQL2008 在另一台机器上与 SQL2005 DB 交互会出现问题吗？

> ID：1018459
> 
> 赞同：2
> 
> 时间：2009-06-19T15:02:31.433
> 
> 标签：sql, sql-server-2005, sqlcompare

我在本地机器上安装了 SQL2008，需要从运行 SQL 2005 的远程服务器上的数据库中查看/更改/选择行和表。这样做会有什么问题吗？我看到有些人谈论为某些事情设置兼容性，但这似乎只在使用 SQL 2005 中不存在的 SQL 2008 新术语时，这是正确的吗？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:09:27.580

我假设您正在谈论使用 SSMS 2008 连接到 2005 数据库。你根本不应该有任何问题——事实上你会得到一些好处。SSMS 2008 具有 SSMS 2005 版本中没有的搜索功能。连接到 2005 数据库时，您不会获得智能感知，但 2008 中的大多数其他改进仍然有效。

我个人从 2005 年升级到 2008 SSMS 的两个最大原因是搜索功能，以及查看估计查询计划时的缺失索引建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:14:46.150

这将毫无问题地工作。我的整个开发团队目前都是这样设置的。您将失去一些功能（即智能感知），但除此之外，它会起作用。

# sql - SQL (DB2) 在单个查询中返回多个条件计数

> ID：1018469
> 
> 赞同：7
> 
> 时间：2009-06-19T15:04:38.900
> 
> 标签：sql, db2

我正在尝试将多个条件摘要选择到基于 DB2 的数据库上的单个表结果中。

例子：

```
SELECT COUNT(FOO) FROM T1 WHERE T1.A=1 AS A_COUNT,
SELECT COUNT(FOO) FROM T1 WHERE T1.B=2 AS B_COUNT
Ext... 
```

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T15:26:56.187

这将计算每个条件的发生：

```
select sum(case when t1.a = 1 then 1 else 0 end) as A_COUNT
     , sum(case when t1.b = 2 then 1 else 0 end) as B_COUNT
  from t1
 where t1.a = 1
    or t1.b = 2 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:09:55.100

```
select count(case when t1.a = 1 then foo else null end) as A_COUNT
     , count(case when t1.b = 2 then foo else null end) as B_COUNT
  from t1
 where t1.a = 1
    or t1.b = 2 
```

Where 子句严格来说是可选的，但可能有助于性能。当省略 else 子句时，“else null”也是隐含的，因此您也可以放心地将其关闭。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T15:11:12.600

```
select count(foo)
  from t1
 where a = 1
union
select count(foo)
  from t1
 where b = 2
.... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T17:35:38.933

这会做到的。

```
SELECT  A_COUNT as Type ,COUNT(FOO) FROM T1 WHERE T1.A=1, 

Union

SELECT B_COUNT as Type, COUNT(FOO) FROM T1 WHERE T1.B=2 
```

# logging - 记录经典的 ASP 表单帖子

> ID：1018471
> 
> 赞同：2
> 
> 时间：2009-06-19T15:05:01.333
> 
> 标签：logging, asp-classic, iis-6

我有一个旧的经典 ASP 站点，我正在维护并正在转换为 asp.net。我有一页有外部端点向其发布数据，我想捕获/监视正在此页面上发布的帖子。有谁知道我可以使用哪些工具将这些帖子转储到某个日志文件或数据库中？

我想也许这个问题也可以针对IIS？从我用谷歌搜索的结果来看，这在 IIS 中似乎也不可能。也许有一个 ISAPI 扩展可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T17:46:00.607

正如 Manos 在对您的问题的评论中指出的那样，您可以简单地将 Request.Form 和/或 Request.QueryString 集合的内容转储到文件中。

文件锁定是一个问题，但您始终可以为每个帖子使用一个新文件。使用由格式化的当前日期/时间、SessionID 和其他一些随机元素组合而成的文件名。ASP 一次只处理一个会话请求，因此没有发生冲突的危险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T19:58:47.720

正如多次指出的那样，您可以将内容转储到某种集合中。之前的建议是将其转储到 .txt（或其他）文件中。除非您正在转储大量数据，或者您运行一个非常活跃的站点，否则您不太可能遇到锁定问题。

顺便说一句，这些信息将帮助您获得更好的答案。;)

我们在谈论多少流量？同时用户？到底有多少数据被转储了？

最后，如果您不喜欢文件的想法，那么为什么不使用数据库呢？哪一个取决于交通问题的答案...

# asp.net - 查询通知错误

> ID：1018473
> 
> 赞同：2
> 
> 时间：2009-06-19T15:05:18.883
> 
> 标签：asp.net, sql-server, caching, service-broker

我们有这个关于 SQL 查询通知服务的奇怪问题。我们有一个使用 QN 服务运行的主 Web 应用程序，因此当监控数据发生更改时，Web 中的缓存项会从 SQL 获得通知。它运行良好。奇怪的是，当其他支持的 Web 服务尝试将 QN 订阅注册到 SQL 2005 SP2 并发生此错误时

“系统异常：SqlDependency.Start 已为服务器多次调用命令执行，但当前命令没有匹配的服务器/用户/数据库 Start() 调用”

此错误仅在 SQLDependency 中针对特定实例数据库的 SQL 查询时发生。另一个实例数据库工作得很好。

对于 QN / 服务代理问题，找不到太多资源。希望有类似经历的朋友可以分享一下知识。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:01:37.423

这意味着已经为此 DB 调用了 Start() 方法。start 方法具有您可以在底部[看到的限制。](http://msdn.microsoft.com/en-us/library/ms224872.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:40:25.363

这是那些没有太多知识专家可用的 SQL Server 主题领域之一，我敢说，我自己 ;-)

我的建议是在 MSDN 上的官方 SQL Server 服务代理论坛上发布您的查询。以下链接供参考：

[http://social.msdn.microsoft.com/Forums/en-US/sqlservicebroker/threads](http://social.msdn.microsoft.com/Forums/en-US/sqlservicebroker/threads)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-14T19:38:08.610

这不是对该主题的直接回答，但关于 QN/SSB 资源的问题，我的网站上有几篇文章：

*   [http://rusanu.com/2006/06/17/the-mysterious-notification/](http://rusanu.com/2006/06/17/the-mysterious-notification/)
*   [http://rusanu.com/2008/01/04/sqldependencyonchange-callback-timing/](http://rusanu.com/2008/01/04/sqldependencyonchange-callback-timing/)
*   [http://rusanu.com/2007/11/10/when-it-rains-it-pours/](http://rusanu.com/2007/11/10/when-it-rains-it-pours/)
*   [http://rusanu.com/2005/12/20/troubleshooting-dialogs/](http://rusanu.com/2005/12/20/troubleshooting-dialogs/)

我是 SQL Server 团队的前开发人员，我参与了 Service Broker 以及或多或少的内部使用，如查询通知和 SqlDependency、事件通知、dbMail 等。

# visual-studio-2008 - 如何检查谁在 TFS 中签出了特定文件？

> ID：1018479
> 
> 赞同：24
> 
> 时间：2009-06-19T15:06:09.333
> 
> 标签：visual-studio-2008, tfs

如何检查谁在 TFS 中签出了特定文件？

在 Visual Studio 2008 中，项目中的文件被标记为已签出。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-06-19T15:11:41.273

如果您的意思是通过 Visual Studio 2008 而不是以编程方式，那么一个简单的方法是：

进入源代码管理资源管理器（拉起团队资源管理器并单击源代码管理）。然后导航到您正在检查的文件，并且有一列用户已签出该特定文件。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-22T14:09:46.277

在 Visual Studio 中，解决方案资源管理器界面相当有限——它必须支持标准化功能集才能与所有 SCC 提供程序交互。

源代码管理资源管理器（查看 -> 其他窗口 -> 源代码管理资源管理器）是 TFS 原生的，并且功能更强大。在这里您可以直接浏览服务器端视图。右侧的详细信息窗格有一列，您可以在其中查看结帐信息。

但是，如果有几个人签出该文件，它就无法显示所有内容。可以从右键单击 -> 属性 -> 状态获得结帐记录的完整转储。或者你可以运行命令行 *tf status $/path/to/item /user:**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-23T09:19:16.257

Visual Studio 也有这个坏习惯。似乎该文件已被其他人在解决方案资源管理器中签出，但实际上并非如此。刷新不起作用。源代码管理资源管理器正确显示了这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-01-24T22:19:27.483

## Visual Studio 2015 的更新答案

不幸的是，虽然您可以在解决方案资源管理器中看到紫色的人形图标 ( [![不要与紫色食人者混淆](../Images/5a3a6f88e7ccc10b2220e7fe581c46bb.png)](https://i.stack.imgur.com/iMeL9.png))（表示其他人已将其签出），但您无法看到是谁将其签出，因此必须转到源代码管理资源管理器并查看在用户列：

[![源代码管理资源管理器](../Images/d1c2a8ebc949be181408543582b55568.png)](https://i.stack.imgur.com/BrxK5.png)

但这仍然不会向您显示已签出的每个人（相反，第一个之后的用户被替换为 [more]，如上所示）。为此，您需要打开 VS2015 的开发人员命令提示符（它只是带有预加载批处理文件的 cmd.exe，快捷方式通常在 中`C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Visual Studio 2015\Visual Studio Tools`）并输入：

```
tf status .\proj.csproj /user:* 
```

将“.\proj.csproj”替换为已检出项目的相对或绝对路径（以 TFS 的 $ 开头）。

# wpf - 在 MVVM 中构建显示各种页面的菜单的最佳方法是什么？

> ID：1018483
> 
> 赞同：8
> 
> 时间：2009-06-19T15:07:04.607
> 
> 标签：wpf, mvvm, application-design

我想用 MVVM 模式构建一个简单的应用程序。

此应用程序将有两个主要部分：

*   **顶部的**菜单****
***   **以下**内容******

 ****导航将很简单：

*   每个**菜单项**（例如“管理客户”或“查看报告”）都会**在内容区域中填充**一个具有某些特定功能的新页面

我**之前使用代码隐藏**了代码，其中菜单项的代码隐藏事件处理程序已加载所有页面，并且应该显示的页面作为 StackPanel 的子项加载。但是，这在 MVVM 中不起作用，因为您不想手动填充 StackPanel 而是显示例如带有 DataTemplate 的“PageItem”对象等。

**那么你们中的那些用 MVVM 制作了这样一个简单的单击菜单应用程序的人，你的基本应用程序结构是什么？** 我在考虑这些方面：

**MainView.xaml：**

```
<DockPanel LastChildFill="False">

    <Menu 
        ItemsSource="{Binding PageItemsMainMenu}" 
        ItemTemplate="{StaticResource MainMenuStyle}"/>

    <ContentControl 
        Content="{Binding SelectedPageItem}"/>        

</DockPanel> 
```

其中，Menu 填充了“PageItems”的集合，DataTemplate 将每个“PageItem 对象”的 Title 显示为每个 MenuItem 的 Header。

ContentControl 将填充具有完整功能的 View/ViewModel 对，但对此不确定。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-20T15:52:35.630

首先，我认为您应该保留代码隐藏事件处理程序，没有任何实际原因将简单的 2 行事件处理程序更改为复杂的命令驱动的怪物是没有意义的（不要说可测试性，这是主菜单，它每次运行应用程序时都会进行测试）。

现在，如果你确实想走纯 MVVM 路线，你所要做的就是让你的菜单触发一个命令，首先，在一些资源部分添加这个样式：

```
<Style x:Key="MenuItemStyle" TargetType="MenuItem">
    <Setter Property="Command" 
            Value="{Binding DataContext.SwitchViewCommand,
            RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Menu}}}"/>
    <Setter Property="CommandParameter" 
            Value="{Binding}"/>
</Style> 
```

此样式将使菜单项在附加的视图模型上触发 SwitchViewCommand，并将 MenuItem 的 DataContext 作为命令参数。

实际视图与您的代码相同，只是将该样式作为 ItemContainerStyle 的附加引用（因此它适用于菜单项而不是 DataTemplate 的内容）：

```
<DockPanel LastChildFill="False">

    <Menu DockPanel.Dock="Top"
        ItemsSource="{Binding PageItemsMainMenu}" 
        ItemTemplate="{StaticResource MainMenuStyle}"
        ItemContainerStyle="{StaticResource MenuItemStyle}"/>
    <ContentControl 
    Content="{Binding SelectedPageItem}"/>
</DockPanel> 
```

现在在您需要的视图模型中（我使用字符串，因为我没有您的 PageItem 代码）：

```
private string _selectedViewItem;
public List<string> PageItemsMainMenu { get; set; }
public string SelectedPageItem
{
    get { return _selectedViewItem; }
    set { _selectedViewItem = value; OnNotifyPropertyChanged("SelectedPageItem"); }
}
public ICommand SwitchViewCommand { get; set; } 
```

并使用您使用的任何命令类使命令调用此代码：

```
private void DoSwitchViewCommand(object parameter)
{
    SelectedPageItem = (string)parameter;
} 
```

现在，当用户单击菜单项时，菜单项将调用 SwitchViewCommand，并将页面项作为参数。

该命令将调用将设置 SelectedPageItem 属性的 DoSwitchViewCommand

该属性将引发 NotifyPropertyChanged，这将使 UI 通过数据绑定进行更新。

或者，您可以编写一个 2 行事件处理程序，由您选择

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-20T13:47:57.897

我可以想象 VM 中有一个 ObservableCollection，它包含所有可从菜单调用的页面。然后将 ItemsControl 和 ContentControl 绑定到它，以使 ContentControl 始终显示该列表中的 CurrentItem。当然，菜单只会绑定到一些 Title 属性，而 ContentControl 会采用整个项目并根据类型插入一些适当的视图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-20T16:25:43.033

另一种选择是使用 ListBox 而不是菜单，将 ListBox 设置为看起来像菜单，然后您可以绑定到选定的值，如下所示：

```
<DockPanel LastChildFill="False">

    <ListBox 
        ItemsSource="{Binding PageItemsMainMenu}" 
        ItemTemplate="{StaticResource MainMenuStyle}"
        IsSynchronizedWithCurrentItem="True"/>

    <ContentControl 
        Content="{Binding PageItemsMainMenu/}"/>        

</DockPanel> 
```

请注意 IsSynchronizedWithCurrentItem="True" 设置所选项目和 {Binding PageItemsMainMenu/} 与尾随斜杠使用它。****

# linq - LINQ 中的 OrderBy 是如何工作的（在幕后）？

> ID：1018484
> 
> 赞同：5
> 
> 时间：2009-06-19T15:07:12.313
> 
> 标签：linq, sql-order-by

我已经知道 LINQ 的工作原理是评估表达式并逐个迭代它们（有点像管道），但是有一些类似的操作`OrderBy`需要缓冲，因为排序需要一次分析所有数据来进行排序。

我有兴趣了解这些数据在 LINQ 中是如何在幕后缓冲的。

如果有人能指出我的文章或解释，我将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:20:57.400

由 LINQ 提供者来实现。一些提供程序（例如，LINQ to SQL、LINQ to Entities）将音译为 SQL OrderBy。其他（LINQ to Objects）将在客户端上排序。LINQ 本身真正所做的就是调用一个名为 OrderBy 或 OrderByDesc 的方法。

# c# - .NET 序列化排序

> ID：1018490
> 
> 赞同：16
> 
> 时间：2009-06-19T15:07:58.753
> 
> 标签：c#, xml, serialization, xml-serialization

我正在尝试使用 XmlSerializer 和继承来序列化一些对象，但是在排序结果时遇到了一些问题。

下面是一个类似于我设置的示例：~

```
public class SerializableBase
{
    [XmlElement(Order = 1)]
    public bool Property1 { get; set;}

    [XmlElement(Order = 3)]
    public bool Property3 { get; set;}
}

[XmlRoot("Object")]
public class SerializableObject1 : SerializableBase
{
}

[XmlRoot("Object")]
public class SerializableObject2 : SerializableBase
{
    [XmlElement(Order = 2)]
    public bool Property2 { get; set;}
} 
```

我想要的结果如下：~

```
<Object>
    <Property1></Property1>
    <Property2></Property2>
    <Property3></Property3>
</Object> 
```

但是我得到的结果是：〜

```
<Object>
    <Property1></Property1>
    <Property3></Property3>
    <Property2></Property2>
</Object> 
```

有谁知道这是否可能或任何替代方案？

谢谢

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-06-20T21:02:26.947

从技术上讲，从纯 xml 的角度来看，我想说这可能是一件不好的事情。

.NET 隐藏了 XmlSerialization 之类的大部分复杂性——在这种情况下，它隐藏了序列化 xml 应符合的架构。

推断的模式将使用序列元素来描述基本类型和扩展类型。这需要严格的排序——即使 Deserializer 不那么严格并且接受乱序元素。

在 xml 模式中，当定义扩展类型时，来自子类的附加元素必须在来自基类的元素*之后。*

你基本上会有一个看起来像这样的模式（为清楚起见，删除了 xml-y 标记）

```
base
  sequence
    prop1
    prop3

derived1 extends base
  sequence
    <empty>

derived2 extends base
  sequence
    prop2 
```

没有办法在 prop1 和 prop3 之间放置一个占位符来指示派生 xml 中的属性可以去哪里。

最后，您的数据格式和业务对象之间存在不匹配。可能您最好的选择是定义一个对象来处理您的 xml 序列化。

例如

```
[XmlRoot("Object")
public class SerializableObjectForPersistance
{
    [XmlElement(Order = 1)]
    public bool Property1 { get; set; }

    [XmlElement(Order = 2, IsNullable=true)]
    public bool Property2 { get; set; }

    [XmlElement(Order = 3)]
    public bool Property3 { get; set; }
} 
```

这将您的 xml 序列化代码与您的对象模型分开。将 SerializableObject1 或 SerializableObject2 中的所有值复制到 SerializableObjectForPersistance，然后对其进行序列化。

本质上，如果您希望对序列化 xml 的格式进行这样的特定控制，这与期望 xml 序列化框架不太相符，您需要将业务对象设计（在这种情况下为继承结构）和序列化的责任解耦。业务对象。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T20:43:40.127

编辑：**这种方法不起作用**。我把这个帖子留在了，这样人们就可以避免这种想法。

序列化程序以递归方式运行。这样做有一个好处；在反序列化上，反序列化过程可以读取基类，然后是派生类。这意味着派生类的属性没有在基类的属性之前设置，这可能会导致问题。

如果它真的很重要（而且我不确定为什么按顺序排列这些很重要）那么你可以试试这个——

1) 将基类的 Property1 和 Property3 设为虚拟。2）用派生类中的琐碎属性覆盖它们。例如

```
public class SerializableBase
{
    [XmlElement(Order = 1)]
    public virtual bool Property1 { get; set;}

    [XmlElement(Order = 3)]
    public virtual bool Property3 { get; set;}
}

[XmlRoot("Object")]
public class SerializableObject1 : SerializableBase
{
}

[XmlRoot("Object")]
public class SerializableObject2 : SerializableBase
{
    [XmlElement(Order = 1)]
    public override bool Property1 
    { 
      get { return base.Property1; }
      set { base.Property1 = value; }
    }

    [XmlElement(Order = 2)]
    public bool Property2 { get; set;}

    [XmlElement(Order = 3)]
    public override bool Property3
    { 
      get { return base.Property3; }
      set { base.Property3 = value; }
    }

} 
```

这将属性的具体实现放在最派生的类上，并且应该尊重顺序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T16:11:08.187

看起来 XmlSerializer 类将基类型序列化，然后按该顺序序列化派生类型，并且仅单独尊重每个类中的 Order 属性。即使订单不完全是您想要的，它仍然应该正确反序列化。如果你真的必须有这样的命令，你将需要编写一个自定义的 xml 序列化程序。我会提醒您不要这样做，因为 .NET XmlSerializer 为您做了很多特殊处理。你能按照你提到的顺序描述为什么你需要东西吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-10T10:57:51.010

这篇文章现在已经很老了，但是我最近在 WCF 中遇到了类似的问题，并找到了类似于上述史蒂夫库珀的解决方案，但确实有效，并且可能也适用于 XML 序列化。

如果从基类中删除 XmlElement 属性，并将每个属性的副本添加到通过 get/set 访问基值的派生类中，并使用不同的名称，则可以使用 XmlElementAttribute 分配的适当名称对副本进行序列化，并希望随后以默认顺序序列化：

```
public class SerializableBase
{
   public bool Property1 { get; set;}
   public bool Property3 { get; set;}
}

[XmlRoot("Object")]
public class SerializableObject : SerializableBase
{
  [XmlElement("Property1")]
  public bool copyOfProperty1 
  { 
    get { return base.Property1; }
    set { base.Property1 = value; }
  }

  [XmlElement]
  public bool Property2 { get; set;}

  [XmlElement("Property3")]
  public bool copyOfProperty3
  { 
    get { return base.Property3; }
    set { base.Property3 = value; }
  }
} 
```

我还添加了一个接口来添加到派生类中，以便可以强制复制：

```
interface ISerializableObjectEnsureProperties
{
  bool copyOfProperty1  { get; set; }
  bool copyOfProperty2  { get; set; }
} 
```

这不是必需的，但意味着我可以在编译时检查所有内容是否已实现，而不是检查生成的 XML。我最初制作了 SerializableBase 的这些抽象属性，但是这些然后首先序列化（使用基类），我现在意识到这是合乎逻辑的。

这通过更改上面的一行以通常的方式调用：

```
public class SerializableObject : SerializableBase, ISerializableObjectEnsureProperties 
```

我只在 WCF 中对此进行了测试，并且在没有编译的情况下将这个概念移植到 XML 序列化，所以如果这不起作用，道歉，但我希望它的行为方式相同 - 我相信有人会让我知道如果不是...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-05-28T17:47:56.847

我知道这个问题已经过期了；但是，这是解决此问题的方法：

方法的名称应始终以 ShouldSerialize 开头，然后以属性名称结尾。然后你只需要根据你想要的任何条件返回一个布尔值，关于是否序列化值。

```
public class SerializableBase
{
    public bool Property1 { get; set;}
    public bool Property2 { get; set;}
    public bool Property3 { get; set;}

    public virtual bool ShouldSerializeProperty2 { get { return false; } }
}

[XmlRoot("Object")]
public class SerializableObject1 : SerializableBase
{        
}

[XmlRoot("Object")]
public class SerializableObject2 : SerializableBase
{
    public override bool ShouldSerializeProperty2 { get { return true; } }
} 
```

使用 SerializableObject2 时的结果：~

```
<Object>
    <Property1></Property1>
    <Property2></Property2>
    <Property3></Property3>
</Object> 
```

使用 SerializableObject1 时的结果：~

```
<Object>
    <Property1></Property1>
    <Property3></Property3>
</Object> 
```

希望这对其他人有帮助！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-05T19:02:34.017

就像纳德说的，也许考虑做一个更松耦合的设计。但是，就我而言，松耦合是不合适的。这是我的类层次结构，以及我建议如何在不使用自定义序列化或 DTO 的情况下解决问题。

在我的项目中，我正在构建一大堆对象来表示将通过 Web 服务提交的 XML 文档的片段。有大量的碎片。并非所有请求都随每个请求一起发送（实际上，在此示例中，我正在对响应进行建模，但概念是相同的）。这些部分很像构建块来组装请求（或在这种情况下分解响应）。因此，这是一个使用聚合/封装来完成所需排序的示例，尽管继承层次结构。

```
[Serializable]
public abstract class ElementBase
{
    // This constructor sets up the default namespace for all of my objects. Every
    // Xml Element class will inherit from this class.
    internal ElementBase()
    {
        this._namespaces = new XmlSerializerNamespaces(new XmlQualifiedName[] {
            new XmlQualifiedName(string.Empty, "urn:my-default-namespace:XSD:1")
        });
    }

    [XmlNamespacesDeclaration]
    public XmlSerializerNamespaces Namespaces { get { return this._namespaces; } }
    private XmlSerializationNamespaces _namespaces;
}

[Serializable]
public abstract class ServiceBase : ElementBase
{
    private ServiceBase() { }

    public ServiceBase(Guid requestId, Guid? asyncRequestId = null, Identifier name = null)
    {
        this._requestId = requestId;
        this._asyncRequestId = asyncRequestId;
        this._name = name;
    }

    public Guid RequestId
    {
        get { return this._requestId;  }
        set { this._requestId = value;  }
    }
    private Guid _requestId;

    public Guid? AsyncRequestId
    {
        get { return this._asyncRequestId; }
        set { this._asyncRequestId = value; }
    }
    private Guid? _asyncRequestId;

    public bool AsyncRequestIdSpecified
    {
        get { return this._asyncRequestId == null && this._asyncRequestId.HasValue; }
        set { /* XmlSerializer requires both a getter and a setter.*/ ; }
    }

    public Identifier Name
    {
        get { return this._name; }
        set { this._name; }
    }
    private Identifier _name;
}

[Serializable]
public abstract class ServiceResponseBase : ServiceBase
{
    private ServiceBase _serviceBase;

    private ServiceResponseBase() { }

    public ServiceResponseBase(Guid requestId, Guid? asyncRequestId = null, Identifier name = null, Status status = null)
    {
        this._serviceBase = new ServiceBase(requestId, asyncRequestId, name);
        this._status = status;
    }

    public Guid RequestId
    {
        get { return this._serviceBase.RequestId; }
        set { this._serviceBase.RequestId = value; }
    }

    public Guid? AsyncRequestId
    {
        get { return this._serviceBase.AsyncRequestId; }
        set { this._serviceBase.AsyncRequestId = value; }
    }

    public bool AsynceRequestIdSpecified
    {
        get { return this._serviceBase.AsyncRequestIdSpecified; }
        set { ;  }
    }

    public Identifier Name
    {
        get { return this._serviceBase.Name; }
        set { this._serviceBase.Name = value; }
    }

    public Status Status
    {
        get { return this._status; }
        set { this._status = value; }
    }
}

[Serializable]
[XmlRoot(Namespace = "urn:my-default-namespace:XSD:1")]
public class BankServiceResponse : ServiceResponseBase
{
    // Determines if the class is being deserialized.
    private bool _isDeserializing;

    private ServiceResponseBase _serviceResponseBase;

    // Constructor used by XmlSerializer.
    // This is special because I require a non-null List<T> of items later on.
    private BankServiceResponse()
    { 
        this._isDeserializing = true;
        this._serviceResponseBase = new ServiceResponseBase();
    }

    // Constructor used for unit testing
    internal BankServiceResponse(bool isDeserializing = false)
    {
        this._isDeserializing = isDeserializing;
        this._serviceResponseBase = new ServiceResponseBase();
    }

    public BankServiceResponse(Guid requestId, List<BankResponse> responses, Guid? asyncRequestId = null, Identifier name = null, Status status = null)
    {
        if (responses == null || responses.Count == 0)
            throw new ArgumentNullException("The list cannot be null or empty", "responses");

        this._serviceResponseBase = new ServiceResponseBase(requestId, asyncRequestId, name, status);
        this._responses = responses;
    }

    [XmlElement(Order = 1)]
    public Status Status
    {
        get { return this._serviceResponseBase.Status; }
        set { this._serviceResponseBase.Status = value; }
    }

    [XmlElement(Order = 2)]
    public Guid RequestId
    {
        get { return this._serviceResponseBase.RequestId; }
        set { this._serviceResponseBase.RequestId = value; }
    }

    [XmlElement(Order = 3)]
    public Guid? AsyncRequestId
    {
        get { return this._serviceResponseBase.AsyncRequestId; }
        set { this._serviceResponseBase.AsyncRequestId = value; }
    }

    [XmlIgnore]
    public bool AsyncRequestIdSpecified
    {
        get { return this._serviceResponseBase.AsyncRequestIdSpecified; }
        set { ; } // Must have this for XmlSerializer.
    }

    [XmlElement(Order = 4)]
    public Identifer Name
    {
         get { return this._serviceResponseBase.Name; }
         set { this._serviceResponseBase.Name; }
    }

    [XmlElement(Order = 5)]
    public List<BankResponse> Responses
    {
        get { return this._responses; }
        set
        {
            if (this._isDeserializing && this._responses != null && this._responses.Count > 0)
                this._isDeserializing = false;

            if (!this._isDeserializing && (value == null || value.Count == 0))
                throw new ArgumentNullException("List cannot be null or empty.", "value");

            this._responses = value;
        }
    }
    private List<BankResponse> _responses;
} 
```

因此，虽然我必须为所有包含的类创建属性，但我可以通过在访问叶类的属性时简单地使用包含的类的属性来委派我在包含的类属性设置器/获取器中可能拥有的任何自定义逻辑。由于没有继承，我可以用属性装饰叶子类的所有`XmlElementAttribute`属性，并使用我认为合适的任何顺序。

* * *

**更新：**

我回来重温了这篇文章，因为我关于使用类继承的设计决策又回来了。虽然我上面的解决方案确实有效，但我正在使用它，我真的认为纳德的解决方案是最好的，应该在我提出的解决方案之前考虑。事实上，我今天正在为他 +1！我真的很喜欢他的回答，如果我有机会重构我当前的项目，我肯定会将业务对象与对象的序列化逻辑分开，否则这些对象将从继承中受益匪浅，以简化代码并使其更容易供他人使用和理解。

感谢您发布您的回复 Nader，因为我认为许多人会发现它非常有启发性和有用性。

# asp.net - 在 GridView 自动数据绑定中捕获错误

> ID：1018496
> 
> 赞同：0
> 
> 时间：2009-06-19T15:09:03.277
> 
> 标签：asp.net, data-binding, gridview, error-handling

我有一个设置了 DataSourceID 的 gridview，因此数据绑定会自动发生。问题是有时，SqlDataSource 中定义的过程需要很长时间才能完成，因此绑定带有超时过期错误。

如何在不手动对 gridview 进行数据绑定并用 try/catch 语句包围它的情况下捕获此错误？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-08-27T21:47:16.957

如果在执行 SqlDataSource 时发生异常，它会触发相应的操作后事件 - 在本例中为 Selected。您可以选择为此事件创建事件处理程序，并在事件处理程序中说明您已处理异常。

此图显示了此交互如何与 ObjectDataSource 一起使用（概念与 SqlDataSource 控件相同）。检查下图时，将单词“ObjectDataSource”替换为“SqlDataSource”，将“Underlying Object”替换为“Database”，使其与 SqlDataSource 相关。

![数据源控件在其操作之前和之后引发事件。](../Images/f3383e5c7d9ccac1369d34ebdfb97826.png)

如您所见，Selecting 事件在数据发送到数据库之前引发，Selected 事件在数据返回后引发（或者如果有异常）。

您可以在页面中创建 Selected 事件处理程序并检查是否发生异常并决定是否要自己处理。[Fredrik Normen 对此](http://weblogs.asp.net/fredriknormen/)有一篇很好的博客文章：[自行处理数据源控制异常。](http://fredrik.nsquared2.com/viewpost.aspx?PostID=300 "自行处理数据源控制异常。")

其他阅读材料：[在 ASP.NET 中访问和更新数据：检查数据源控件的事件](http://www.4guysfromrolla.com/articles/112206-1.aspx)。

快乐编程！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:12:12.333

为什么不解决查询超时的问题呢？优化数据库（首选）或将连接/命令超时设置为高于当前值。

[您可以通过挂钩到SqlDataSource 选择事件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sqldatasource.selecting.aspx)来调整超时如下：

```
protected void ds_Selecting(object sender, SqlDataSourceSelectingEventArgs e)
    {
        e.Command.CommandTimeout = 5000;
    } 
```

如果您使用的是 SQL Server，您可能希望查看索引调整向导/[调整顾问](http://msdn.microsoft.com/en-us/library/ms166575.aspx)、[显示查询执行计划](http://msdn.microsoft.com/en-us/library/aa178423.aspx)或[SQL Server Profiler](http://msdn.microsoft.com/en-us/library/aa178423.aspx)等工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:32:47.377

异步绑定怎么样？一旦完成，如果没有返回错误，回调函数可以调用 databind。

**编辑：**我想那是手动的......不是你想要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-27T14:19:00.670

您唯一能做的就是处理 Page_Error 事件

[http://msdn.microsoft.com/en-us/library/ed577840.aspx](http://msdn.microsoft.com/en-us/library/ed577840.aspx)

# django - django- 在 urls.py 中传递字符串或实例？

> ID：1018509
> 
> 赞同：5
> 
> 时间：2009-06-19T15:10:21.433
> 
> 标签：django, optimization, url

在 url 模式中传递字符串与函数实例相比有什么好处吗？似乎***可以***对其进行优化，使其在需要时才实际加载该函数，但这实际上是真的吗？

```
from django.conf.urls.defaults import *
from myapp.views import myView

urlpatterns = patterns('',
    # as a string
    url(r'^as-string/$', "myapp.views.myView"),

    # Uploading photos
    url(r'^as-instance/$', myView),

) 
```

**编辑**：如果确实在需要它们之前它不会导入，那么这将是对内存的优化，但在您实际尝试访问 url 之前不会引发不存在的函数和其他错误。

当然，如果您编写测试，这不是问题；）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T20:01:12.367

主要好处是，当您使用实际的可调用对象时，您可以在 URLConf 中执行诸如应用装饰器之类的操作。因此，您可以执行以下操作：

```
from django.conf.urls.defaults import *
from django.contrib.auth.decorators import login_required

from some_module import some_view

urlpatterns = patterns('',
                       (r'^some_url/$', some_view),
                       (r'^some_other_url/$', login_required(some_view))) 
```

等等

这使您可以拥有仅在您特别需要时才应用于视图的装饰器，而不是在视图文件中进行装饰，然后必须始终使用该装饰器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:22:23.357

仔细阅读 RegexURLPattern的[源](http://code.djangoproject.com/browser/django/trunk/django/core/urlresolvers.py)代码（这是在幕后`defaults.url`使用的）确认导入仅在需要时才发生，因此您的想法是正确的：这是一个轻微的优化，但确实需要彻底的测试！

# .net - Visual Studio 2008 单元测试：如何一一执行？

> ID：1018515
> 
> 赞同：4
> 
> 时间：2009-06-19T15:11:37.060
> 
> 标签：.net, visual-studio, visual-studio-2008, unit-testing

在进行单元测试时，有没有办法告诉[TestClass()]一个一个地执行一个[TestMethod()]？（而不是 Visual Studio 来启动多线程）。这将只需要我的一两个测试课程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-20T20:10:55.850

如果您使用 Visual Studio 2008 Team Suite 或（我相信）其中一个 Tester 版本，您可以创建一个有序测试并将所有单元测试添加到该有序测试中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:16:14.930

不，在 Visual Studio 2008 中使用默认工具无法做到这一点。

可以通过向 TestInit 方法添加一些......有趣的配置代码来实现。例如，您可以让所有测试类都派生自以下基类。

```
[TestClass]
public class ExecuteOneAtTimeBase {
  private static object s_mutex = new object();

  [TestInit]
  public void TestInit() {
    Monitor.Enter(s_mutex);
  }

  [TestCleanup]
  public void TestCleanup() {
    Monitor.Exit(s_mutex);
  }
} 
```

所有 TestMethod 实例都被对 TestInit 和 TestCleanup 方法的调用括起来。使用 Monitor.Enter/Exit 组合，您可以保证给定的单元测试方法在其执行期间保持锁定。因此，多个线程不能在单个 AppDomain 中同时运行不同的测试。

在某些错误情况下，这可能会导致测试过程中出现死锁。但我认为这可能是一个小问题，因为它不是生产代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:19:26.797

您可以调试或运行任何单个 TestMethod。

*   将光标放在 TestMethod 中
*   调试：Ctrl-R、Ctrl-T 或测试 -> 调试 -> 当前上下文中的测试
*   运行：Ctrl-R、T 或测试-> 运行-> 当前上下文中的测试

# clojure - Binding multiple related variables in Clojure without nested let

> ID：1018516
> 
> 赞同：13
> 
> 时间：2009-06-19T15:11:40.320
> 
> 标签：clojure, nested, let

I want to use the value of a variable to compute the value of another variable in the same let statement. Is there a way to do this in Clojure without using nested lets?

Nested let solution:

```
(let [x 3] 
  (let [y (+ 1 x)] 
    y)) = 4 
```

Desired solution:

```
(let [x 3 
      y (+ 1 x)] 
   y) = 4 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-19T16:36:48.310

Never mind, the desired solution works fine. I wonder why I was having trouble with it before?

# javascript - 如何使用 javascript 制作 Flash 电影以播放全屏模式？

> ID：1018518
> 
> 赞同：3
> 
> 时间：2009-06-19T15:12:01.570
> 
> 标签：javascript, html, flash

我有一个包含在我的 html 文档中的 .swf 文件。我希望能够以全屏模式播放。（没有浏览器显示）。

是否可以使用 html / javascript 来执行此操作，或者这是 Flash 电影本身的一个组件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:33:57.967

> 启动全屏模式的 ActionScript 只能在鼠标单击或按键响应时调用。如果在其他情况下调用它，它将被忽略（在 ActionScript 2.0 中）或引发异常（在 ActionScript 3.0 中）。

[http://www.adobe.com/devnet/flashplayer/articles/full_screen_mode.html](http://www.adobe.com/devnet/flashplayer/articles/full_screen_mode.html)

所以你不能使用 Javascript 来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T16:52:43.263

不，你不能。我知道阻止人们制作烦人的自动全屏电影之类的东西听起来不错，但这真的很糟糕......你有一个完整的 HTML 导航栏（整个网站的标准），然后对于这个 flash 组件，有一个按钮不在栏中，因为... 因为其他人可能会用它做一些粗俗的事情？视频无提示全屏播放的真正危害是什么？用户会丢失文件吗？电脑会关机吗？有时我认为 Adob​​e 为自己的利益太偏执了……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:14:16.853

我认为您必须使用[SWFObject](http://code.google.com/p/swfobject/)从 javascript 控制它。

# php - PHP 和 MYSQ 帮助

> ID：1018519
> 
> 赞同：1
> 
> 时间：2009-06-19T15:12:06.810
> 
> 标签：php, mysql

好的，这是我的 php 和 mysql 代码：

我想从在线表格中获取uid，如果它在那里

我需要在哪里 online.uid = '' 所以它把 uid 放在那里。

```
$sql = ("select accounts.id, 
                accounts.tgid, 
                accounts.lastactivity, 
                cometchat_status.message, 
                cometchat_status.status, 
                **online.uid** 
         from friends_list join accounts 
                on friends_list.fid = accounts.id 
         left join cometchat_status 
                on accounts.id = cometchat_status.userid 
         where friends_list.status = '1' 
                and **online.uid = ''** 
                and friends_list.uid = '".mysql_real_escape_string($userid)."' 
         order by tgid asc"); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T15:40:55.193

@sledge 在他上面的评论中指出了问题（我不确定他为什么没有发布答案）。

您正在从表中选择一列`online`，但您没有将其包含在您的`FROM`子句中。您必须从表中查询才能在查询的其他部分引用其列。例如：

```
$sql = ("select accounts.id, 
            accounts.tgid, 
            accounts.lastactivity, 
            cometchat_status.message, 
            cometchat_status.status, 
            online.uid 
     from friends_list 
       join accounts on friends_list.fid = accounts.id 
       join online on ( ??? ) 
       left join cometchat_status 
            on accounts.id = cometchat_status.userid 
     where friends_list.status = '1' 
            and online.uid = '' 
            and friends_list.uid = '".mysql_real_escape_string($userid)."' 
     order by tgid asc"); 
```

您需要填写连接条件，因为您的原始帖子中没有足够的信息来推断该`online`表与其他表的关系。

PS：感谢使用`mysql_real_escape_string()`。

# css - 如何为动态下拉列表设置表格列宽？

> ID：1018522
> 
> 赞同：4
> 
> 时间：2009-06-19T15:12:53.843
> 
> 标签：css, width, html-table

我有一个带有动态下拉列表的表格。

下拉菜单的宽度将根据其内容而变化。

我希望表格列与下拉列表的宽度相同。

如果我设置的宽度小于下拉列表的大小，IE 似乎使列大于下拉列表，同时包装列标题它会在下拉列表的任一侧插入空格。

CSS中有没有办法说只是使列的大小与其内容相同？

这是一个示例 html 表，其中包括我当前的修复（kludge）

```
<table id="mappingtable" width="100%" align="center" cellspacing="0" cellpadding="0" border="0">
  <tr>
    <th width="80px">FixedWidthColumn</th>
    <th width="80%">ExpandingColumn</th>
    <th width="122px">&nbsp;</th>
    <th>DynamicColumn</th>
  </tr>
  <tr>
    <td align="center">1</td>
    <td>Text</td>
    <td align="center">Button</td>
    <td align="center">DropDownList</td>
  </tr>
</table> 
```

没有任何css就存在问题

如果我从扩展列中删除 width="80%" 动态列将有空格

我尝试过 width: auto 在动态列上并将其设置为固定宽度，但这些都不适合我

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T18:02:19.523

您需要的是一个宽度为 100% 且 1 列未定义宽度的表格。带有下拉列表的列可以有一个非常小的宽度，浏览器会自动使整个列与下拉列表的宽度相匹配。

HTML 看起来像这样：

```
<table width="100%" >
  <tr>
    <th width="80">FixedWidthColumn</th>
    <th>ExpandingColumn</th>
    <th width="122"> </th>
    <th width="10">DynamicColumn</th>
  </tr>
  <tr>
    <td align="center">1</td>
    <td>Text</td>
    <td align="center">Button</td>
    <td align="center">DropDownList</td>
  </tr>
</table> 
```

作为对以下评论的回答，您可以探索一些解决方案：

您可以在下拉列表中添加一个选项标签，该标签至少具有一定的宽度和一些不间断的空格，如下所示：

```
<option>Please select...&nbsp;&nbsp;&nbsp;&nbsp;</option> 
```

您可以给选择标签一个最小宽度，如下所示：

```
<select style="min-width: 200px;" > 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:22:22.280

对于这个特定的表，你为什么不覆盖表参数内的 css 数据？

该参数在哪里传递（或在其他地方解析）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T22:45:23.063

这就是表格的工作方式，如果有 2 列没有设置宽度并且设置了表格宽度，则剩余的可用空间将分布在 2 列之间。

如果 ExpandingColumn 中的内容足够大以填充剩余宽度，则从表中删除 100% 宽度将解决您的问题。

# unit-testing - 我应该更改单元测试的命名约定吗？

> ID：1018525
> 
> 赞同：11
> 
> 时间：2009-06-19T15:13:36.527
> 
> 标签：unit-testing, tdd, naming-conventions, bdd

我目前对我的单元测试使用一个简单的约定。如果我有一个名为“EmployeeReader”的类，我将创建一个名为“EmployeeReader.Tests”的测试类。然后我在测试类中为该类创建所有测试，其名称如下：

*   Reading_Valid_Employee_Data_Correctly_Generates_Employee_Object
*   Reading_Missing_Employee_Data_Throws_Invalid_Employee_ID_Exception

等等。

我最近一直在阅读BDD 中使用的[不同类型的命名约定。](http://elegantcode.com/2008/05/01/thanks-to-bdd/)我喜欢这个命名的可读性，最终得到一个测试列表，例如：

*   When_Reading_Valid_Employee（夹具）
    *   Employee_Object_Is_Generated（方法）
    *   Employee_Has_Correct_ID（方法）
*   When_Reading_Missing_Employee（夹具）
    *   An_Invalid_Employee_ID_Exception_Is_Thrown（方法）

等等。

有人用过这两种命名方式吗？你能提供任何建议、好处、缺点、陷阱等来帮助我决定是否为我的下一个项目切换吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T15:29:34.093

我一直在使用的命名约定是：

> functionName_shouldDoThis_whenThisIsTheSituation

例如，这些将是堆栈的“pop”函数的一些测试名称

> pop_shouldThrowEmptyStackException_whenTheStackIsEmpty
> 
> pop_shouldReturnTheObjectOnTheTopOfTheStack_whenThereIsAnObjectOnTheStack

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T15:17:29.733

您的第二个示例（每个逻辑“任务”都有一个夹具，而不是每个类一个夹具）的优点是您可以为每个任务设置不同的 SetUp 和 TearDown 逻辑，从而简化您的各个测试方法并使它们更具可读性。

您无需将其中一个作为标准。我们混合使用两者，这取决于我们必须为每个类测试多少不同的“任务”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T15:23:33.293

我觉得第二种更好，因为它使您的单元测试对其他人更具可读性，因为长行使代码看起来更难阅读或更难浏览。如果您仍然觉得对于测试的作用有任何歧义，您可以添加评论来澄清这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-03T04:28:13.677

您引用的第二个命名约定背后的部分原因是您正在同时创建测试和行为规范。您确定事情正在发生的上下文以及在该上下文中实际应该发生的事情。（根据我的经验，观察/测试方法通常以“should_”开头，因此您会得到标准的“When_the_invoicing_system_is_told_to_email_the_client”、“should_initiate_connection_to_mail_server”格式。）

有一些工具可以反映您的测试装置并输出格式良好的 html 规格表，去除下划线。您最终会得到与实际代码同步的可读文档（只要您保持测试覆盖率高且准确）。

根据您正在处理的故事/功能/子系统，这些规范可以向非程序员利益相关者展示和理解，以进行验证和反馈，这尤其是敏捷和 BDD 的核心。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-27T01:03:06.840

我使用第二种方法，它确实有助于描述你的软件应该做什么。我还使用嵌套类来描述更详细的上下文。

本质上，测试类是上下文，可以嵌套，方法都是一行断言。例如，

```
public class MyClassSpecification
{
    protected MyClass instance = new MyClass();

    public class When_foobar_is_42 : MyClassSpecification 
    {
        public When_foobar_is_42() {
            this.instance.SetFoobar( 42 ); 
        }

        public class GetAnswer : When_foobar_is_42
        {
            private Int32 result;

            public GetAnswer() {
                this.result = this.GetAnswer();
            }

            public void should_return_42() {
                Assert.AreEqual( 42, result );
            }
        }
    }
} 
```

这将在我的测试运行器中为我提供以下输出：

```
MyClassSpecification+When_foobar_is_42+GetAnswer
    should_return_42 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-21T05:11:24.347

我一直在您在问题中描述的两条道路以及其他一些道路上……您的第一个选择对大多数人来说非常简单且易于理解。我个人更喜欢 BDD 样式（您的第二个示例），因为它隔离了不同的上下文并将对这些上下文的观察分组。唯一真正的缺点是它会生成更多代码，因此在您看到整洁的测试之前，开始这样做会感觉有点麻烦。此外，如果您使用继承来重用夹具设置，您需要一个输出继承链的测试运行程序。考虑一个类“An_empty_stack”，并且您想重用它，然后您再做另一个类：“When_five_is_pushed_on：An_empty_stack”您希望将其作为输出，而不仅仅是“When_five_is_pushed_on”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-03T04:47:04.957

我投票支持调用测试用例类：EmployeeReaderTestCase 并调用方法（），如[http://xunitpatterns.com/Organization.html](http://xunitpatterns.com/Organization.html)和[http://xunitpatterns.com/Organization.html#Test%20Naming%20Conventions](http://xunitpatterns.com/Organization.html#Test%20Naming%20Conventions)

# python - Python 日志记录在 2.5 和 2.6 之间不兼容

> ID：1018527
> 
> 赞同：6
> 
> 时间：2009-06-19T15:14:14.870
> 
> 标签：python, logging, incompatibility

您能帮我解决以下 Python 2.5 和 2.6 之间的不兼容问题吗？

记录器配置文件：

```
[loggers]
keys=root,aLogger,bLogger

[handlers]
keys=consoleHandler

[formatters]
keys=

[logger_root]
level=NOTSET
handlers=consoleHandler

[logger_aLogger]
level=DEBUG
handlers=consoleHandler
propagate=0
qualname=a

[logger_bLogger]
level=INFO
handlers=consoleHandler
propagate=0
qualname=b

[handler_consoleHandler]
class=StreamHandler
args=(sys.stderr,) 
```

module_one.py：

```
import logging
import logging.config

logging.config.fileConfig('logger.conf')
a_log = logging.getLogger('a.submod')
b_log = logging.getLogger('b.submod')

def function_one():
    b_log.info("function_one() called.") 
```

module_two.py：

```
import logging
import logging.config

logging.config.fileConfig('logger.conf')
a_log = logging.getLogger('a.submod')
b_log = logging.getLogger('b.submod')

def function_two():
    a_log.info("function_two() called.") 
```

记录器.py：

```
from module_one import function_one
from module_two import function_two

function_one()
function_two() 
```

在 Ubuntu 9.04 下调用 logger.py 的输出：

```
$ python2.5 logger.py
$

$ python2.6 logger.py
function_one() called.
function_two() called.
$ 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T17:03:53.343

这是在 2.5 和 2.6 之间修复的错误。fileConfig() 函数用于一次性配置，因此不应多次调用 - 但是您可以选择安排它。fileConfig 的预期行为是禁用配置中未明确提及的任何记录器，并保持启用提及的记录器及其子级；该错误导致孩子们在不应该被禁用时被禁用。示例记录器配置提到记录器“a”和“b”；调用 getLogger('a.submod') 后，将创建一个子记录器。第二个 fileConfig 调用在 Python 2.5 中错误地禁用了此功能 - 在 Python 2.6 中，记录器没有被禁用，因为它是配置中明确提到的记录器的子级。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:46:30.813

我自己不明白这种行为的原因，但正如你在 2.6 中所说的那样，它的工作方式不同。我们可以假设这是一个影响 2.5 的错误

作为一种解决方法，我建议如下：

额外模块.py：

```
import logging
import logging.config

logging.config.fileConfig('logger.conf')
a_log = logging.getLogger('a.submod')
b_log = logging.getLogger('b.submod') 
```

module_one.py：

```
from extra_module import a_log

def function_one():
    a_log.info("function_one() called.") 
```

module_two.py：

```
from extra_module import b_log

def function_two():
    b_log.info("function_two() called.") 
```

通过使用这个方案，我能够在 python2.5.4 上运行 logger.py，其行为与 2.6 相同

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:47:03.447

有趣......我在控制台中玩了一点，看起来第二次调用`logging.config.fileConfig`是搞砸了。不知道为什么会这样......这是显示问题的成绩单：

```
lorien$ python2.5
Python 2.5.1 (r251:54863, Feb  6 2009, 19:02:12) 
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import logging
>>> import logging.config
>>> logging.config.fileConfig('logger.conf')
>>> alog = logging.getLogger('a.submod')
>>> alog.info('foo')
foo
>>> import logging
>>> import logging.config
>>> alog.info('foo')
foo
>>> logging.config.fileConfig('logger.conf')
>>> alog.info('foo')
>>> alog = logging.getLogger('a.submod')
>>> alog.info('foo')
>>> 
>>> blog = logging.getLogger('b.submod')
>>> blog.info('foo')
foo
>>> 
```

一旦我`logging.config.fileConfig`第二次调用，我的记录器实例就会停止记录。获取一个新的日志实例并没有帮助，因为它是同一个对象。如果我等到两次配置后获取记录器实例，那么一切正常 - 这就是`blog`实例工作的原因。

我的建议是延迟获取记录器实例，直到您使用函数。如果将调用移至`logging.getLogger()`and `function_one`，`function_two`则一切正常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T17:23:15.097

我可以通过在两个文件中更改记录器的名称来解决此问题：

```
logging.config.fileConfig('logger.conf')
a_log = logging.getLogger('a')
b_log = logging.getLogger('b') 
```

我不确定确切的错误，但 v2.5 记录器模块似乎无法将传递给`getLogger()`的名称与配置文件中的名称匹配。

# svn - XCode 和更新的 SVN

> ID：1018546
> 
> 赞同：2
> 
> 时间：2009-06-19T15:18:04.800
> 
> 标签：svn, xcode

OSX 附带的股票 svn 是 1.4.4，我（通过 opencollab 安装程序）升级到 1.6.2

我的问题是，XCode (v3.1.2) 采用了旧的颠覆。有一次，我通过执行以下操作解决了这个问题：

```
defaults write ~/.MacOSX/environment DYLD_LIBRARY_PATH /opt/subversion/lib 
```

它奏效了。但它已经恢复到不再工作了:(

我得到的错误信息是：

> 错误：155021（不支持的工作副本格式）说明：此客户端太旧，无法使用工作副本'/Users/craiger/workspace/Onshore/Mapp'；请获取更新的 Subversion 客户端

有人知道如何一劳永逸地解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T15:19:53.113

我已经在 iPhone SDK 2.2 和 SVN 1.6 的 XCode 上使用[了这种方法](http://www.lemonteam.com/blog/2008/12/setting-up-subversion-15-on-xcode/)，并且它已经升级到 SDK 3.0 (XCode 3.1.3)。

```
ln -s -f /opt/subversion/lib/libapr-1.dylib /usr/lib/libapr-1.dylib
ln -s -f /opt/subversion/lib/libapr-1.dylib /usr/lib/libapr-1.0.dylib
ln -s -f /opt/subversion/lib/libaprutil-1.dylib /usr/lib/libaprutil-1.dylib
ln -s -f /opt/subversion/lib/libaprutil-1.dylib /usr/lib/libaprutil-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_client-1.dylib /usr/lib/libsvn_client-1.dylib
ln -s -f /opt/subversion/lib/libsvn_client-1.dylib /usr/lib/libsvn_client-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_delta-1.dylib /usr/lib/libsvn_diff-1.dylib
ln -s -f /opt/subversion/lib/libsvn_delta-1.dylib /usr/lib/libsvn_diff-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_fs_fs-1.dylib /usr/lib/libsvn_fs_fs-1.dylib
ln -s -f /opt/subversion/lib/libsvn_fs_fs-1.dylib /usr/lib/libsvn_fs_fs-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_fs-1.dylib /usr/lib/libsvn_fs-1.dylib
ln -s -f /opt/subversion/lib/libsvn_fs-1.dylib /usr/lib/libsvn_fs-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_ra_local-1.dylib /usr/lib/libsvn_ra_local-1.dylib
ln -s -f /opt/subversion/lib/libsvn_ra_local-1.dylib /usr/lib/libsvn_ra_local-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_ra_svn-1.dylib /usr/lib/libsvn_ra_svn-1.dylib
ln -s -f /opt/subversion/lib/libsvn_ra_svn-1.dylib /usr/lib/libsvn_ra_svn-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_ra-1.dylib /usr/lib/libsvn_ra-1.dylib
ln -s -f /opt/subversion/lib/libsvn_ra-1.dylib /usr/lib/libsvn_ra-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_wc-1.dylib /usr/lib/libsvn_wc-1.dylib
ln -s -f /opt/subversion/lib/libsvn_wc-1.dylib /usr/lib/libsvn_wc-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_repos-1.dylib /usr/lib/libsvn_repos-1.dylib
ln -s -f /opt/subversion/lib/libsvn_repos-1.dylib /usr/lib/libsvn_repos-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_subr-1.dylib /usr/lib/libsvn_subr-1.dylib
ln -s -f /opt/subversion/lib/libsvn_subr-1.dylib /usr/lib/libsvn_subr-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_delta-1.dylib /usr/lib/libsvn_delta-1.dylib
ln -s -f /opt/subversion/lib/libsvn_delta-1.dylib /usr/lib/libsvn_delta-1.0.dylib
ln -s -f /opt/subversion/lib/libsvn_diff-1.dylib /usr/lib/libsvn_diff-1.dylib
ln -s -f /opt/subversion/lib/libsvn_diff-1.dylib /usr/lib/libsvn_diff-1.0.dylib 
```

# .net - 将小数转换为英文字符串

> ID：1018548
> 
> 赞同：1
> 
> 时间：2009-06-19T15:18:32.197
> 
> 标签：.net

我编写了一个 .NET 类，可以将十进制（货币值）转换为英文可读的字符串。

113.25 => 113 25 美分。

这是支票上的金额线。代码已部署并且可以工作，但我想知道是否有比编写一堆 if、switch、整数除法和模数语句更好的方法。我希望有一个更优雅的解决方案，而不是我的 168 行代码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T15:21:51.347

我相信您正在寻找的东西已经在[Code Golf 中以每种语言完成：数字到单词](https://stackoverflow.com/questions/309884/code-golf-number-to-words)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T15:27:31.397

虽然这*是*一个常见的代码高尔夫问题，但正如这里的[“嘶嘶声”问题](https://stackoverflow.com/questions/437/what-is-your-solution-to-the-fizzbuzz-problem)所证明的那样：你并不总是得到好的答案！

优秀的 Black Wasp 资源中提供了代码：http: [//www.blackwasp.co.uk/NumberToWords.aspx](http://www.blackwasp.co.uk/NumberToWords.aspx)可以解决您的问题。也许将他们的方法与您自己的方法进行比较，看看您是否走在正确的轨道上。

虽然他们的解决方案目前只处理整数，但我想你可以很容易地调整它，或者分别传入你的尾数和指数并组合结果。

希望这可以帮助。

# wpf - WPF中的BindingExpressing

> ID：1018549
> 
> 赞同：0
> 
> 时间：2009-06-19T15:18:50.230
> 
> 标签：wpf, binding

如何将 BindingExpression 用于列表框？

对于文本框，我们使用类似

BindingExpression bindingExpression = txtbox1.GetBindingExpression(TextBox.TextProperty);

谢谢沙拉特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:37:13.017

一样的方法？`GetBindingExpression`为 定义`FrameworkElement`，并且`ListBox`是一。

# c++ - 什么时候让一个对象删除自己？

> ID：1018550
> 
> 赞同：3
> 
> 时间：2009-06-19T15:18:55.657
> 
> 标签：c++, oop, memory-management

```
Callback* p = new Callback;
function(p); 
```

如果我想删除回调对象，何时以及如何删除？

如果它被提前删除，那么回调可能会因分段错误而失败。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-19T15:23:11.530

最好的解决方案是使用智能指针。
您使用回调初始化指针并将其传递给函数。当函数或任何过程完成时，智能指针将自动删除回调。
一个好的智能指针实现是[`boost::shared_ptr<>`](http://www.boost.org/doc/libs/1%5F39%5F0/libs/smart%5Fptr/shared%5Fptr.htm)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T15:42:12.600

如果代码像你说的那么简单，这意味着在 func() 执行后只有一个对回调指针的引用，我相信一个 auto_ptr 就足够了：

```
std::auto_ptr<Callback> p(new Callback);
func(p.get()); 
```

这也确保了如果 func() 抛出异常，内存仍将被释放。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T15:24:06.817

您可以对使用回调的时间进行递增/递减计数。当它被使用时，增加计数，当它不再使用时，减少它。当它达到 0 或 -1 时释放它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:32:49.407

假设 func() 是唯一使用该特定 Callback 对象的函数，并且此代码始终按照产生 Callback 对象的顺序执行，我会将其放在调用 func() 之后。这样，如果您必须编辑 func() 您不必担心 Callback 对象在何处被删除。它还确保所有指针都已清空，因为 func() 的指针应该在函数完成时停止存在，唯一要做的就是删除引用它的指针。

如果我对 C++ 中的指针的理解存在缺陷并导致我给出错误的答案，我深表歉意，我总是对此感到有些困惑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T18:04:55.527

如果你的代码和你写的一样简单，并且`func()`在某个时候直接调用回调，那么这应该足够了：

```
Callback p;
func(&p); 
```

但是，如果`func()`将引用或指向回调的指针保存在别处，则需要跟踪该引用的生命周期。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T15:26:53.567

持有回调的“caller-backer”对象（执行回调的对象）可能是正确的所有者（决定回调的生命周期，特别是，`delete`用来取消回调对象，用`auto_ptr`. ) 当且仅当它的语义是让它决定何时不再需要进一步的回调——这是不可能从问题中提供的如此少的信息中分辨出来的。

当所述代码*是*一个确定不再需要回调的人。

其他答案提到更聪明的指针，而不是`auto_ptr`让“谁拥有这个”的问题消失（提升`shared_ptr`，手动引用计数，......） - 如果你因为其他原因被迫使用 C++，这可能会很好，但真的寻找具有垃圾收集功能的语言，但是，如果您专门选择 C++，因为它可以让您完全控制内存使用，那么正确确定对象所有权和生命周期问题不是可选的（与任何类型相比，它可以严重优化您的资源使用或多或少自动化的“垃圾收集”——当然，这仅在您**确实**需要密切控制资源使用时才重要；-)。

# serial-port - Windows XP 嵌入式 - RS485 问题

> ID：1018556
> 
> 赞同：1
> 
> 时间：2009-06-19T15:21:13.017
> 
> 标签：serial-port, windows-xp-embedded, rs485

我们有一个运行 XP Embedded 的系统，COM2 是一个硬件 RS485 端口。

在我的代码中，我使用*RTS_CONTROL_TOGGLE*设置 DCB 。我假设它会做它所说的......一旦发生写空中断，就在内核模式下关闭 RTS。这应该是即时的。

相反，我们在示波器上看到 PC 驱动总线的时间比消息结束时间长 1-8 毫秒。我们正在与之交谈的设备会在大约 1-5 毫秒内做出响应。所以... 通信腐败盛行。不，没有办法改变目标的响应时间。

我们现在已经连接到 RS232 端口并将示波器连接到 TX 和 RTS 线，我们看到了同样的情况。RTS 线在消息发送后 1-8 毫秒保持高电平。

我们还尝试关闭 FIFO，或将 FIFO 深度设置为 1，但没有任何效果。

有任何想法吗？我将尝试在“SendFile，清除 RTS”周期中以 REALTIME 优先级从用户模式手动控制 RTS 线路。我也不希望这会奏效。这不应该在用户模式下完成。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T17:58:28.623

*RTS_CONTROL_TOGGLE*在我们的嵌入式 XP 平台上不起作用（在传输后关闭它之前有 1-15 毫秒的可变延迟）。如果我使用 timeBeginPeriod(1) 等将时间量更改为 1 毫秒，我可能会降低它，但我怀疑它是否可靠或足够重要。（设备有时会在 1 毫秒内响应）

最终的解决方案真的很难看，但它适用于这个硬件。我不会在硬件没有固定在石头上的任何东西上使用它。

基本上：

1) 将串口设备管理器页面上的 FIFO 设置为关闭或 1 个字符深

2）使用此代码发送您的消息+ **2个额外字节：**

```
int WriteFile485(HANDLE hPort, void* pvBuffer, DWORD iLength, DWORD* pdwWritten, LPOVERLAPPED lpOverlapped)
{
  int iOldClass = GetPriorityClass(GetCurrentProcess());
  int iOldPriority = GetThreadPriority(GetCurrentThread());
  SetPriorityClass(GetCurrentProcess(), REALTIME_PRIORITY_CLASS);
  SetThreadPriority(GetCurrentThread(), THREAD_PRIORITY_TIME_CRITICAL);

  EscapeCommFunction(hPort, SETRTS);

  BOOL bRet = WriteFile(hPort, pvBuffer, iLength, pdwWritten, lpOverlapped);

  EscapeCommFunction(hPort, CLRRTS);

  SetPriorityClass(GetCurrentProcess(), iOldClass);
  SetThreadPriority(GetCurrentThread(), iOldPriority);

  return bRet;
} 
```

当最后一个或两个字节已写入串行端口时，WriteFile() 返回。他们还没有离开端口，因此需要发送 2 个额外的字节。当您执行 CLRRTS 时，它们中的一个或两个都会被丢弃。

就像我说的......它很丑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:45:54.107

> 有任何想法吗？

您可能会发现 DDK 中有串行端口驱动程序的源代码，它可以让您了解该选项应该如何实现：即它是在中断级别、在 DPC 级别还是更糟。

其他可能性包括重写驱动程序；如果您能找到，请使用第 3 方 RS485 驱动程序；或使用带有自己的驱动程序的第 3 方 RS485 硬件（例如，至少在过去，第 3 方曾经制造具有 32 个端口、深度缓冲区和自己的微处理器的“智能串行端口板”；我预计 RS485 是一个一直存在的问题）由某人解决）。

8 毫秒确实看起来令人失望。我知道 XP 不是 RTOS，但我希望它（通常）做得比这更好。要查看的另一件事是是否有其他高优先级线程正在运行，可能会产生干扰。如果您一直在提高自己应用程序中某些线程的优先级，那么也许您应该降低其他线程的优先级。

> 我将尝试在“SendFile，清除 RTS”周期中以 REALTIME 优先级从用户模式手动控制 RTS 线路。

不要让那个线程失控：IME 一个这样的线程，如果它有问题，就可以永远抢占所有其他用户模式线程。

# ruby-on-rails - Rails find :include 在多数据库环境中

> ID：1018558
> 
> 赞同：1
> 
> 时间：2009-06-19T15:21:37.697
> 
> 标签：ruby-on-rails, database, activerecord

我正在 RoR 中创建一个站点，并且我在一个多数据库环境中。我的意思是，我的一些模型链接到 MSSQL 表，而其他一些模型链接到 MYSQL 表。

它在大多数情况下运行良好，但是当我在查找方法中使用“包含”选项时，我得到了一个非常奇怪的 SQL 组合。让我给你看一个例子：

```
[SELECT * FROM "viewInfoClient" WHERE ("viewInfoClient".`NoClient` IN (6044196,5000652,0204392)) ] 
```

MSSQL 在表和列名之间使用 "

MYSQL 使用 `

当我`:include`在 MYSQL 模型中使用该选项时，它会尝试去读取 MSSQL 模型表中的相应结果。由于 NoClient 链接字段来自我的 MYSQL 模型，因此它混合在一起，MSSQL 会抛出一个合乎逻辑的错误。

```
[unixODBC][FreeTDS][SQL Server]Incorrect syntax near '`' 
```

知道如何解决这个问题吗？

客户模型（MSSQL 数据库）

```
class Client < ActiveRecord::Base  
  establish_connection "mssql_#{RAILS_ENV}"  
  set_table_name "viewInfoClient"  
  set_primary_key "NoClient"  
  has_many :billets, :foreign_key => 'noclient', :primary_key => 'NoClient'
end 
```

方坯模型（MySQL 数据库）

```
class Billet < ActiveRecord::Base
  belongs_to :client, :foreign_key => 'noclient'
end 
```

受影响的陈述可能是任何使用 :include 的东西，介于两者之间。来自 Billet 模型的示例

```
def findall
  find(:all, :include => 'client', :conditions => 'bin_id = 1')
end 
```

将返回：

```
SELECT * FROM "viewInfoClient" WHERE ("viewInfoClient".`NoClient` IN (6044196,5000652,0204392)) 
```

`(6044196,5000652,0204392)`模型中的 3 条记录`bin_id = 1`在哪里`Billet`。

我从模型中删除了所有其他内容以缩短代码，但基本上就是这样。我可以从任何使用 MySQL - MSSQL 链接的模型中重现它。

# installation - 在 NSIS 中最小化运行快捷方式

> ID：1018563
> 
> 赞同：3
> 
> 时间：2009-06-19T15:21:59.163
> 
> 标签：installation, nsis

在 Windows 中，可以编辑快捷方式的属性并选择是否应该正常启动目标程序的窗口、最小化或最大化。

我正在 NSIS 中创建一个安装程序，并且有一些批处理文件我想创建快捷方式并将它们最小化。有谁要包含哪些参数`CreateShortcut`来完成此操作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-19T15:32:25.613

以下是启动目标最小化的快捷方式的一个非常基本的示例。空字符串用于此示例中忽略的其他参数。有关详细信息，[请参阅参考](http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.3.4)

```
CreateShortCut "MyShortcut.lnk" "MyProgram.exe" "" "" "" SW_SHOWMINIMIZED 
```

# c# - 封装网络协议

> ID：1018564
> 
> 赞同：3
> 
> 时间：2009-06-19T15:22:02.047
> 
> 标签：c#, networking

我正在开发一个接收原始二进制消息的应用程序（非常简单，第一个字节是消息类型，其余是有效负载），然后对其进行处理。我想要完成的事情是确保网络服务从应用程序的其余部分抽象出来，以允许不时修改协议而不会过多影响应用程序的其余部分。应用程序的上下文是一个非常简单的客户端-服务器游戏，我现在正在为此做客户端工作。

不过我现在有点挣扎。我需要找到一种优雅的方式来连接某种翻译器/适配器服务，它会返回漂亮的对象（我认为）。这些对象将被放入队列中等待应用程序的其余部分使用。我面临的问题或多或少是这个构造（伪代码）：

假设每条消息都是 20 个字节，所以我可以处理每 20 个字节调用这个函数：

```
public Message GetMessage(byte[] buffer)
{
  switch(buffer[0])
  {
     case 1:
       return Message1(...);
     case 2:
       return Message2(...);
     .....

     case n:
       return MessageN(...);
  }
} 
```

显然，我会为此案例使用枚举或常量，但这不是困扰我的事情。事情就是这样。我想我有大约 50 种消息类型，这意味着我将得到一个包含 50 个案例的 switch 语句。我真的想不出一个合适的方法来把它切成小块，这将导致一个巨大的、容易出错的方法。我想知道是否有任何模式可以让这更容易，因为我找不到任何模式。

感谢您提前输入！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:33:32.697

我有一些 Java 代码可以做到这一点。希望您可以轻松转换为 C#。本质上，我有一个`messageMap`集合：

```
private final Map<Byte, Class<? extends Message>> messageMap; 
```

这是从消息 ID 到相应`Message`类的映射。`addMessage`我为每种不同的消息类型调用一次：

```
public void addMessage(int id, Class<? extends Message> messageClass) {
    messageMap.put((byte) id, messageClass);
} 
```

然后，当消息到达时，我从线路中读取消息 ID，查找`Message`我需要在其中实例化的类`messageMap`，然后使用反射创建该类的实例。

```
Class<? extends Message> messageClass = messageMap.get(id);
Message                  message      = messageClass.newInstance(); 
```

这里`newInstance()`调用默认构造函数。

我已经在具有不同消息的多个应用程序中使用了这个通用消息处理代码。每个都只有一个漂亮、简单的代码块来注册不同的消息，如下所示：

```
// Messages that we can send to the client.
addOutgoingMessage(0, HeartbeatMessage.class);
addOutgoingMessage(1, BeginMessage    .class);
addOutgoingMessage(2, CancelMessage   .class);

// Messages that the client can send.
addIgnoredMessage (0, HeartbeatMessage.class);
addIncomingMessage(1, StatusMessage   .class, statusMessageHandler);
addIncomingMessage(2, ProgressMessage .class, progressMessageHandler);
addIncomingMessage(3, OutputMessage   .class, outputMessageHandler);
addIncomingMessage(4, FinishedMessage .class, finishedMessageHandler);
addIncomingMessage(5, CancelledMessage.class, cancelledMessageHandler);
addIncomingMessage(6, ErrorMessage    .class, errorMessageHandler); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-20T03:47:45.747

嗯，当然有很多方法。标准的方法是将函数存储在字典中。在函数式语言中，您会编写类似

```
import MyProtocol

handler  = { mListFirmware :  listFirmwareVersions,                  
             mLoadFirmware :  startLoadingFirmwareVersion,
             mLoadFirmwareBl: loadFirmwareVersionBlock, 
             ...
}

...
try {
    handler[message[0]](message[1:])
} catch (NotInTheDictionary e) {
    # complain ...
} 
```

我不确定您的 C/C++/C# 版本是什么。如果你不能把函数放在那里，那么把指针放在那里。如果您的某些功能非常小，则在某些语言中，您可以将其放在那里`lambda`：

```
 ...
             mLoadFirmware :  (lambda (m): start_load(m[1:3]); do_threads()),
 ... 
```

我会做更多的优化。看，对于每条消息，您都有一个常量和一个函数名。不过，您不必重复：

```
 Messages = new Array()

 def listFirmwareVersions(m):
      ...
     Messages.add(Name_Of_This_Method(), This_Method) 
     # it's possible to get name of current function in Python or C#

 ... # how to send 
 send_message(Messages.lookup(listFirmwareVersions), ...)

 ... # how to receive
 try {  
     Messages[message[0]](message[1:])
 ... 
```

但是如果你想在哲学上是正确的，你可以为处理程序设置单独的类：

```
 class MessageHandler:
      static int message_handlers = [] 
      int msg
      Array data
      void handler
      Message(a_handler):               
          msg = message_handlers.add(this)
          handler = a_handler
      write(Stream s):
          s.write(msg, data)

  listFirmwareVersions = new MessageHandler(do_firmware)
  startLoadingFirmwareVersion = new MessageHandler(load_firmware) 
  ...

 ... # how to send 
 listFirmwareVersions.send(...)

 ... # how to receive
 try {
      message_handlers[message[0]](message[1:])
 ... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T16:04:16.877

虽然不完全是 C# 解决方案，但我最近处理了类似的情况。我的解决方案是使用 F#，这使它更容易。

例如，我的代码如下所示

```
member private this.processDefaultGroupMessage(m : Message) =
        try
            match m.Intro.MessageType with
            | (1us) -> this.listFirmwareVersions(m)                               //ListFirmwareVersions              0
            | (2us) -> this.startLoadingFirmwareVersion(m)                        //StartLoadingFirmwareVersion       1
            | (3us) -> this.loadFirmwareVersionBlock(m)                           //LoadFirmwareVersionBlock          2
            | (4us) -> this.removeFirmwareVersion(m)                              //RemoveFirmwareVersion             3
            | (5us) -> this.activateFirmwareVersion(m)                            //ActivateFirmwareVersion           3        
            | (12us) -> this.startLoadingBitmapLibrary(m)                         //StartLoadingBitmapLibrary         2
            | (13us) -> this.loadBitmapBlock(m)                                   //LoadBitmapLibraryBlock            2        
            | (21us) -> this.listFonts(m)                                         //ListFonts                         0
            | (22us) -> this.loadFont(m)                                          //LoadFont                          4
            | (23us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //RemoveFont                        3
            | (24us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //SetDefaultFont                    3         
            | (31us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //ListParameterSets                 0
            | (32us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //LoadParameterSets                 4
            | (33us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //RemoveParameterSet                3
            | (34us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //ActivateParameterSet              3
            | (35us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //GetParameterSet                   3        
            | (41us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //StartSelfTest                     0
            | (42us) -> this.ackResponse(m)                                       //GetStatus (reply with ACK)        0
            | (43us) -> this.getStatusDetail(m)                                   //GetStatusDetail                   0
            | (44us) -> this.resetStatus(m)                                       //ResetStatus                       5
            | (45us) -> this.setDateTime(m)                                       //SetDateTime                       6
            | (46us) -> this.nakResponse(m, VPL_FRAMELENGTH)                      //GetDateTime                       0
            | (71us) -> this.clearConfiguration(m)                                //ClearConfiguration                0
            | (72us) -> this.defineTextFields(m)                                  //DefineTextFields                  11
            | (74us) -> this.defineClockFields(m)                                 //DefineClockFields                 13
            | (80us) -> this.deleteFieldDefinitions(m)                            //DeleteFieldDefinitions            14
            | (91us) -> this.preloadTextFields(m)                                 //PreloadTextFields                 15
            | (94us) -> this.clearFields(m)                                       //ClearFields                       17
            | (95us) -> this.activate(m)                                          //Activate                          0
            | _ -> this.nakResponse(m, VPL_REQUESTNOTSUPPORTED)
        with 
            | _ -> this.nakResponse(m, VPL_INVALID) 
```

这不是完美的解决方案，但看起来比 c# 中的 switch 语句要好得多。所以我们整个应用都是用csharp写的，但是消息解析器是用fsharp写的。

仅供参考：我们有几个接口：

IDataTransportServer - 负责通过 RS232 或 TCP/IP 接收数据

IDataProcessor - 负责解析二进制数据并将其转换为 Message 类的实例

IMessageProcessor - 负责处理消息（这是 fsharp 模块）

我不知道这对您是否有用，只是想让您知道我们如何处理此类问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:32:09.563

您可以有一个包含 50 个函数指针（即 C# 委托）的数组，您可以使用第一个字节的值对其进行索引，或者使用一个委托字典，其键是第一个字节的值。不过，这只是编写 switch 语句的另一种方式。

但它更分散：例如，当您创建新的消息类型（可能是新源文件中的新类）时，您可以调用将新委托添加到委托的静态集合的现有方法。

# c# - Windows 客户端应用程序的登录对话框

> ID：1018575
> 
> 赞同：9
> 
> 时间：2009-06-19T15:23:28.160
> 
> 标签：c#, .net, windows, winapi

我可以调用 Win32 函数来显示 Windows 登录对话框吗？

例如，Internet Explorer 和 Visual Studio 的 Team Explorer 在访问网站时都显示凭据对话框 - 我如何显示该对话框？

我有一个 .NET Windows 客户端应用程序，它在与 Web 服务通信时使用登录的 Windows 用户身份。服务使用该用户 ID 来确定谁在调用服务并决定他们有权查看哪些内容。

我想添加一个命令，允许当前用户有效地执行“运行方式”，他们可以在其中输入另一个用户的用户名/密码，我们让应用程序充当他们。

我可以构建一个自定义对话框并使用 LoginUser() 函数，但我宁愿使用“官方”的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T15:42:13.973

您可以使用[CredUIPromptForCredentials](http://msdn.microsoft.com/en-us/library/aa375177.aspx) API 函数

另请参阅[此处](http://weblogs.asp.net/hernandl/archive/2005/11/21/usercredentialsdialog.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:36:29.053

我认为您无法创建自己的对话框。不过，让它看起来正式一点并不难。

# version-control - 让我的 TFS 源代码控制项目上路然后将其带回的最佳方式是什么？

> ID：1018583
> 
> 赞同：0
> 
> 时间：2009-06-19T15:26:27.267
> 
> 标签：version-control, tfs

所以我的桌面是我的 VS2008 的主要工作站，它在 TFS 的后端支持。我正在路上一周，我想和我一起做一个项目。我想检查整个项目，将其复制到我的外部 HD 上，然后解决它。我知道，当我尝试在无法连接到网络的笔记本电脑上打开它时，系统会要求我删除源代码控制绑定。那么我是否这样做，然后当我回到办公室时，只需将所有文件复制到我签出的版本之上？我只是不想搞砸任何事情。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:36:15.187

您可以在桌面计算机上使您的 TFS 解决方案[脱机。](https://stackoverflow.com/questions/934875/how-to-work-offline-with-tfs)然后你将工作目录复制到你的笔记本电脑上（假设你的笔记本电脑有 VS 和其他所有设置）它将允许你继续工作。

回来后，将笔记本电脑解决方案根文件夹复制到桌面解决方案根文件夹，然后将解决方案重新联机。根据您的解决方案的大小，这可能需要一些时间，因为它会逐个文件比较以查看更改的内容（它只会针对您在路上更改的文件执行此操作，因为您的解决方案在“离线模式”仍将跟踪哪些文件已更改）。然后一个列表将出现在您的待定更改中。您可以在签入之前检查其中的每一个（像往常一样）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:44:00.757

您可以使用[SvnBridge](http://www.codeplex.com/SvnBridge)并将其放入 svn 存储库中，然后使用它做任何您想做的事情，因为 svn 可以很好地处理离线工作，然后在完成后将其重新签入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T14:03:54.557

既然你有 VS2008，这应该主要为你处理。无需制作多余的副本。

以下是新离线功能的逐次点击演练：http: [//teamfoundation.blogspot.com/2007/12/offline-and-back-again-in-vs2008.html](http://teamfoundation.blogspot.com/2007/12/offline-and-back-again-in-vs2008.html)

如果您想手动管理离线状态，Ben Ryan 有几篇指导性帖子：http: [//blogs.msdn.com/benryan/archive/2008/07/09/using-tfs-2008-power-tools-to-modify -server-s-offline-state.aspx](http://blogs.msdn.com/benryan/archive/2008/07/09/using-tfs-2008-power-tools-to-modify-server-s-offline-state.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:31:31.030

1.  如果可以的话，检查整个项目。
2.  不要删除源绑定
3.  为了安全起见，在您办理登机手续之前，请复制您的本地资源。

# php - 从另一个站点获取元素的值（快速共享）

> ID：1018586
> 
> 赞同：1
> 
> 时间：2009-06-19T15:27:07.327
> 
> 标签：php

我正在用 php 开发一个脚本来管理我的 rapidshare 帐户（用于学习目的），我想知道我们如何远程登录并在我的网站上获取帐户详细信息、api 所做的事情、剩余流量、到期日期等详细信息.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:33:49.387

使用 PHP，您可以使用[Curl](http://us2.php.net/curl)、[PHPSimpleHTMLDomParser](http://simplehtmldom.sourceforge.net/)、[Snoopy](http://sourceforge.net/projects/snoopy/)或[phpQuery](http://code.google.com/p/phpquery/)从远程页面获取内容。请注意，某些网站需要 user_agent，在这种情况下，您可以在运行脚本之前通过 ini_set 设置一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:34:10.307

您可以使用[cURL](http://ca.php.net/manual/en/book.curl.php)将 HTTP 请求从您的脚本发送到站点。还有现成的 PHP 解决方案，例如[Snoopy](http://sourceforge.net/projects/snoopy/)，它可以让您执行诸如发布表单或抓取页面之类的操作，而无需直接使用 cURL。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T15:36:08.057

不确定您的问题到底是什么，但看看[Rapidshare](http://rapidshare.com/dev.html) API 可能会有所帮助。此外，您可能想让自己熟悉以下功能/组件：fopen 和 curl 以使用 api/加载站点。要从内容中获取特定参数，我建议使用 ereg 或 xml 功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:30:58.783

由于 Rapidshare 不为其服务提供 API 接口，唯一的方法是使用可用于 PHP 的 HTML 解析器，使用脚本登录并解析值。

**更新：** Rapidshare 确实提供了一个 API，正如 merkuro 在他的帖子中所说的那样。

# java - 如何在struts 2中设置动作范围

> ID：1018589
> 
> 赞同：0
> 
> 时间：2009-06-19T15:28:12.830
> 
> 标签：java, struts2

在struts中，动作范围被定义为

```
<action scope="session" .../> 
```

你如何在 Struts2 中设置范围？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T22:32:50.127

struts2 中并没有真正的直接等价物。在 struts1 中，该范围指的是关联的 ActionForm。

通常，如果您想做类似的事情，您将通过 spring、guice 或 struts2 配置创建一个会话范围的 bean，并将其注入到您的操作中。

或者您可以实现 SessionAware，并管理您希望自己获得会话支持的属性。

# performance - 如何编写动态的 Linq2Sql 编译查询？

> ID：1018596
> 
> 赞同：0
> 
> 时间：2009-06-19T15:30:12.967
> 
> 标签：performance, linq-to-sql

与原始 ADO.NET 相比，Linq2Sql 存在性能问题，这导致我走上了编译查询的道路。到目前为止我已经做到了

```
public static readonly Func<MyDataContext, WebServices.Search.Parameters, IQueryable<image>>
    Compiled_SelectImagesLinq = 
        CompiledQuery.Compile<MyDataContext, WebServices.Search.Parameters, IQueryable<image>>(
            (dc, parameters) =>  from i in dc.images
                  join l in dc.links on i.image_id equals l.image_id
                  join r in dc.resolutions on i.image_id equals r.image_id
                  where i.image_enabled == true && i.image_rating >= parameters.MinRating
                  && i.image_rating <= parameters.MaxRating
                  select i
      ); 
```

但是我不知道如何像我目前所做的那样将额外的可选参数添加到查询中

```
if (parameters.Country != null)
{
    query = query.Where(x => x.image_country_id == parameters.Country);
}

if (parameters.ComponentId != null)
{
    query = query.Where(x => x.links.Any(l => l.link_component_id == parameters.ComponentId));
} 
```

等等等等

我试着写另一个函数

```
var query = Compiled_SelectImagesLinq(parameters); 
```

然后将额外的参数添加到查询并返回

```
return query.Distinct().Take(parameters.Results); 
```

有点这似乎不正确并且不返回任何结果

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T15:41:44.130

看看这篇文章。它可能无法满足您的需求（特别是因为您正在编译查询），但是任何时候有人在同一句话中提到 Dynamic 和 Linq，我都会将他们推荐给这篇文章：

动态 LINQ：使用 LINQ 动态查询库

[http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:45:52.217

您必须对特定查询进行基准测试，但通常查询必须使用 10-20 次，然后编译的查询性能改进等于开销。另外，您如何向 where 子句添加参数？

此外，动态编译查询似乎有点不匹配。动态 LINQ 查询库将满足您的需求，但我认为您不会获得所需的编译查询性能改进。

# ruby-on-rails - 建模团队

> ID：1018607
> 
> 赞同：1
> 
> 时间：2009-06-19T15:32:42.260
> 
> 标签：ruby-on-rails, ruby, activerecord, membership

我只是想获得一些关于在 Rails 中建模团队/团队成员的更好方法的反馈。
我目前有以下内容：

```
class User
    has_many :teams, :foreign_key => "owner_id" #user owns this team
    has_many :memberships #user is a member of these teams

class Team
    belongs_to :team_administrator, :class_name => "User", :foreign_key => "owner_id"
    has_many :memberships

class Membership
    belongs_to :team
    belongs_to :user 
```

我不喜欢团队管理员部分，因为我必须坚持认为他既是会员，又拥有一个团队。`is_administrator`也许拥有 的财产会更好`Membership`？

这个模型的另一个问题是我正在努力寻找一种很好的方法来确定 UserA 是否是 UserB 拥有的团队的成员。我目前正在做：

```
Membership.first(:joins => :team, :conditions => {:id => params[:membership_id], :teams => {:owner_id => current_user}}) 
```

其中membership_id 是包含我要确定的用户的会员资格是属于current_user 的团队的成员。

那么，有人有更好的方法来建模吗？

感谢您的任何建议！

**编辑：**用户确实可以是多个团队的所有者/成员

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T16:22:20.137

你需要的是多态性：

```
class User
    has_many :teams, :as => team_administrator, :foreign_key => "owner_id"
    has_many :teams, :through => :memberships #user is a member of these teams
    has_many :memberships

class Team
    belongs_to :team_administrator, :polymorphic => true, :foreign_key => "owner_id"
    has_many :users, :though => memberships

class Membership
    belongs_to :team
    belongs_to :user 
```

要确定用户 A 是否属于 B 的团队：

```
b = User.find_by_name("B")
a = User.find_by_name("A")
a.teams.find_by_owner_id(b.id) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:58:44.130

以另一种方式找到会员资格

```
@membership = current_user.membership.find(params[:membership_id], :joins => :team) 
```

# c# - Simplest way to do a fire and forget method in C#?

> ID：1018610
> 
> 赞同：168
> 
> 时间：2009-06-19T15:33:09.827
> 
> 标签：c#, .net, nonblocking

I saw in WCF they have the `[OperationContract(IsOneWay = true)]` attribute. But WCF seems kind of slow and heavy just to do create a nonblocking function. Ideally there would be something like static void nonblocking `MethodFoo(){}`, but I don't think that exists.

What is the quickest way to create a nonblocking method call in C#?

E.g.

```
class Foo
{
    static void Main()
    {
        FireAway(); //No callback, just go away
        Console.WriteLine("Happens immediately");
    }

    static void FireAway()
    {
        System.Threading.Thread.Sleep(5000);
        Console.WriteLine("5 seconds later");
    }
} 
```

**NB**: Everyone reading this should think about if they actually want the method to finish. (See #2 top answer) If the method has to finish, then in some places, like an ASP.NET application, you will need to do something to block and keep the thread alive. Otherwise, this could lead to "fire-forget-but-never-actually-execute", in which case,of course, it would be simpler to write no code at all. ([A good description of how this works in ASP.NET](https://github.com/StephenCleary/AspNetBackgroundTasks))

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2009-06-19T15:35:54.390

```
ThreadPool.QueueUserWorkItem(o => FireAway()); 
```

(five years later...)

```
Task.Run(() => FireAway()); 
```

as pointed out by [luisperezphd](https://stackoverflow.com/users/984780/luisperezphd).

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2012-10-23T20:29:15.200

For C# 4.0 and newer, it strikes me that the best answer is now given here by Ade Miller: [Simplest way to do a fire and forget method in c# 4.0](https://stackoverflow.com/questions/5613951/simplest-way-to-do-a-fire-and-forget-method-in-c-sharp-4-0)

> ```
> Task.Factory.StartNew(() => FireAway()); 
> ```
> 
> Or even...
> 
> ```
> Task.Factory.StartNew(FireAway); 
> ```
> 
> Or...
> 
> ```
> new Task(FireAway).Start(); 
> ```
> 
> Where `FireAway` is
> 
> ```
> public static void FireAway()
> {
>     // Blah...
> } 
> ```
> 
> So by virtue of class and method name terseness this beats the threadpool version by between six and nineteen characters depending on the one you choose :)
> 
> ```
> ThreadPool.QueueUserWorkItem(o => FireAway()); 
> ```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2013-10-11T19:03:33.337

For .NET 4.5:

```
Task.Run(() => FireAway()); 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-06-19T16:12:56.703

To add to [Will's answer](https://stackoverflow.com/questions/1018610/simplest-way-to-do-a-fire-and-forget-method-in-c/1018630#1018630), if this is a console application, just throw in an `AutoResetEvent` and a `WaitHandle` to prevent it exiting before the worker thread completes:

```
Using System;
Using System.Threading;

class Foo
{
    static AutoResetEvent autoEvent = new AutoResetEvent(false);

    static void Main()
    {
        ThreadPoolQueueUserWorkItem(new WaitCallback(FireAway), autoEvent);
        autoEvent.WaitOne(); // Will wait for thread to complete
    }

    static void FireAway(object stateInfo)
    {
        System.Threading.Thread.Sleep(5000);
        Console.WriteLine("5 seconds later");
        ((AutoResetEvent)stateInfo).Set();
    }
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-06-19T15:36:53.470

An easy way is to create and start a thread with parameterless lambda:

```
(new Thread(() => { 
    FireAway(); 
    MessageBox.Show("FireAway Finished!"); 
}) { 
    Name = "Long Running Work Thread (FireAway Call)",
    Priority = ThreadPriority.BelowNormal 
}).Start(); 
```

By using this method over ThreadPool.QueueUserWorkItem you can name your new thread to make it easier for debugging. Also, don't forget to use extensive error handling in your routine because any unhandled exceptions outside of a debugger will abruptly crash your application:

[![enter image description here](../Images/6c748b64183f32274051811d6629e088.png)](https://i.stack.imgur.com/qv5qG.png)

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2015-08-02T21:52:08.840

The recommended way of doing this when you are using Asp.Net and .Net 4.5.2 is by using `QueueBackgroundWorkItem`. Here is a helper class:

```
public static class BackgroundTaskRunner
{     
    public static void FireAndForgetTask(Action action)
    {
        HostingEnvironment.QueueBackgroundWorkItem(cancellationToken => // .Net 4.5.2 required
        {
            try
            {
                action();
            }
            catch (Exception e)
            {
                // TODO: handle exception
            }
        });
    }

    /// <summary>
    /// Using async
    /// </summary>
    public static void FireAndForgetTask(Func<Task> action)
    {
        HostingEnvironment.QueueBackgroundWorkItem(async cancellationToken => // .Net 4.5.2 required
        {
            try
            {
                await action();
            }
            catch (Exception e)
            {
                // TODO: handle exception
            }
        });
    }
} 
```

Usage example:

```
BackgroundTaskRunner.FireAndForgetTask(() =>
{
    FireAway();
}); 
```

or using async:

```
BackgroundTaskRunner.FireAndForgetTask(async () =>
{
    await FireAway();
}); 
```

This works great on Azure Web Sites.

Reference: [Using QueueBackgroundWorkItem to Schedule Background Jobs from an ASP.NET Application in .NET 4.5.2](https://blog.mariusschulz.com/2014/05/07/scheduling-background-jobs-from-an-asp-net-application-in-net-4-5-2)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-07-16T19:13:52.027

Almost 10 years later:

```
Task.Run(FireAway); 
```

I would add exception handling and logging inside FireAway

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-01-17T07:17:03.847

Calling beginInvoke and not catching EndInvoke is not a good approach. Answer is simple: The reason that you should call EndInvoke is because the results of the invocation (even if there is no return value) must be cached by .NET until EndInvoke is called. For example if the invoked code throws an exception then the exception is cached in the invocation data. Until you call EndInvoke it remains in memory. After you call EndInvoke the memory can be released. For this particular case it is possible the memory will remain until the process shuts down because the data is maintained internally by the invocation code. I guess the GC might eventually collect it but I don't know how the GC would know that you have abandoned the data vs. just taking a really long time to retrieve it. I doubt it does. Hence a memory leak can occur.

More can be found on [http://haacked.com/archive/2009/01/09/asynchronous-fire-and-forget-with-lambdas.aspx](http://haacked.com/archive/2009/01/09/asynchronous-fire-and-forget-with-lambdas.aspx)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-12-09T02:51:50.290

The simplest .NET 2.0 and later approach is using the Asynchnonous Programming Model (ie. BeginInvoke on a delegate):

```
static void Main(string[] args)
{
      new MethodInvoker(FireAway).BeginInvoke(null, null);

      Console.WriteLine("Main: " + Thread.CurrentThread.ManagedThreadId);

      Thread.Sleep(5000);
}

private static void FireAway()
{
    Thread.Sleep(2000);

    Console.WriteLine("FireAway: " + Thread.CurrentThread.ManagedThreadId );  
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-09-27T10:04:30.100

If you want to test in Console keep in mind that `Console.ReadKey()` or something like that is needed before Console loses its thread by `Press any key to continue ...`

```
public static void Main()
{
    Task.Factory.StartNew(async () => 
    {
         await LongTaskAsync();         
    }, TaskCreationOptions.LongRunning).ConfigureAwait(false);

    Console.WriteLine("Starts immediately");
    Console.ReadKey();
}

static async Task LongTaskAsync()
{
    await Task.Delay(5000);
    Console.WriteLine("After 5 seconds delay");
} 
```

# excel - 将数据从 CRM 4.0 导出到 Excel

> ID：1018611
> 
> 赞同：1
> 
> 时间：2009-06-19T15:33:27.547
> 
> 标签：excel, export, dynamics-crm, dynamics-crm-4

客户将数据从 CRM 4.0 导出到 Excel 的最佳方式是什么？现在可以导出的行数限制设置为 10000？是否有支持的方式来增加限制或是否有其他方式？客户处于锁定环境中，因此通过 CRM 4.0 的解决方案将是理想的。（例如，将给定数据范围的 Orders 实体中的所有记录导出到 excel 中）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-10T19:02:15.547

要在 CRM 4.0 中更改此设置：

1.  登录存储 _MSCRM 数据库的 SQL Server
2.  打开 OrganizationBase 表
3.  查找列：MaxRecordsForExportToExcel
4.  将值从 10,000 更改为所需值
5.  将更改提交到数据库

# iphone - iPhone上SQLite时间戳的错误时间

> ID：1018614
> 
> 赞同：1
> 
> 时间：2009-06-19T15:33:40.167
> 
> 标签：iphone, database, datetime, sqlite

从我的 iPhone 应用程序中，我在我的 sqlite 数据库中插入了一些数据，其中包括使用 CURRENT_TIMESTAMP 默认值的日期。一切都很好，除了时间比它应该的时间晚 1 小时。这发生在设备和模拟器上。我可以在某处访问任何 sqlite 设置（如当前时间）？

如果您想查看我正在使用的代码，您可以查看我对这篇文章的回答：[sqlite datetime data type with iphone NSdate?](https://stackoverflow.com/questions/942188/sqlite-datetime-data-type-with-iphone-nsdate/1000959#1000959)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:06:42.243

听起来好像 SQLite 和 NSDateFormatter 使用的时区之间可能存在夏令时时区不一致。[看起来 SQLite 将日期时间存储在 GMT](https://stackoverflow.com/questions/381371/sqlite-currenttimestamp-is-in-gmt-not-the-timezone-of-the-machine)中。因此，您需要确保 NSDateFormatter 也设置为 GMT。似乎您可以使用以下方法执行此操作：

```
gmtFormatter.timeZone = [NSTimeZone timeZoneWithAbbreviation:@"GMT"];
[gmtFormatter setDateFormat:@"yyyy-MM-dd HH:mm:ss"] 
```

一旦你有了你的 NSDate 实例，我希望你可以使用一个设置了本地/系统时区的 NSDateFormatter 实例来获取它的字符串版本，以显示正确的本地时间。

**注意：**我实际上还没有尝试过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:10:42.977

您可能需要考虑使用现在在 O/S 3.0 中可用的 Core Data - 它会自动为您处理此类事情，而无需指定时区等 - 它只会使用用户的默认值并保持一切一致。

还有许多其他优势 - 但这似乎是一个相关的优势。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-26T18:23:12.070

我想你最好实施茶机器人的建议。当一个时区有冬季而一个时区没有时，问题就来了...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-08T10:50:07.267

我也刚刚解决了这个问题，茶壶的答案是正确的。sqlite 创建的时间戳是 GMT 格式的，所以当您从数据库中读取它时，您需要告诉您的日期格式化程序也以 GMT 格式读取它。生成的 NSDate 将是您所在时区的正确日期。您说您已经纠正它的方式，增加 1 小时，最终会失败。在 GMT 时区使用该应用程序的任何人都将看到 +1 小时的所有时间。其他时区的任何人都会看到完全不同的时间偏移。（我知道这已经有好几年了，但它刚刚帮助了我）。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-25T13:55:40.997

好吧，由于我找不到这个 1 小时的差异来自哪里，所以我使用以下方法来修复日期。这不是一个合适的解决方案，但它正是我需要的。因此，以防其他人遇到与我相同的麻烦..这是我的解决方法：

```
NSDate *date = [[NSDate alloc] initWithTimeInterval:3600 sinceDate:[formatter dateFromString:score.datetime]]; 
```

这只是给日期时间增加了一小时的延迟，因此使其正确。

# workflow-foundation - WF HandleExternalEvent 活动

> ID：1018622
> 
> 赞同：0
> 
> 时间：2009-06-19T15:34:38.857
> 
> 标签：workflow-foundation

我在工作流中有一个 HandleExternalEvent 活动。但是当事件引发时，我希望我的 HandleEventActivity 以这种方式处理它，保持空闲状态，而不是继续。如何解决？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-25T10:39:30.833

在该状态活动中，您可以将 setstateactivity 指向相同的活动，以便在您引发其他一些事件之前它将处于相同状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-03T06:20:54.997

如果您正在等待多个事件，您可以在 EventHandlingScopeActivity 中使用 HandleExternalEvent Activity。

否则，在 HandleExternalEvent Activity 的代码中使用交易计时器，以便工作流进入空闲状态。

# python - 使用 Google Reader API 为帖子“取消星标”

> ID：1018626
> 
> 赞同：3
> 
> 时间：2009-06-19T15:35:20.413
> 
> 标签：python, google-reader

有人知道如何使用其非官方 API 为在 Google Reader 中加注星标的文章删除星标吗？

我找到了这个，但它不起作用：

[http://www.niallkennedy.com/blog/2005/12/google-reader-api.html](http://www.niallkennedy.com/blog/2005/12/google-reader-api.html)

Python 中的 pyrfeed 模块也没有，我每次都会收到 IOError 异常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:42:17.903

尝试使用：

```
r=user%2F[user ID]%2Fstate%2Fcom.google%2Fstarred 
```

代替

```
a=user%2F[user ID]%2Fstate%2Fcom.google%2Fstarred 
```

调用编辑标签时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-10T00:16:38.493

我没有这方面的 Python 代码（我有 Java），但你遇到的问题几乎与你使用的语言无关，能够在需要的地方看到一些代码总是好的所有的细节。你只需要按照我的要求去做，并验证我强调的一些细节并检查它是否可能是你的问题。

您可以使用它来删除给定帖子的星标（请注意，如果您需要，此服务同时支持多个项目）：

```
 String authToken = getGoogleAuthKey();
    // I use Jsoup for the requests, but you can use anything you
    // like - for jsoup you usually just need to include a jar
    // into your java project
Document doc = Jsoup.connect("http://www.google.com/reader/api/0/edit-tag")
    // this is important for permission - more details on how to get this ahead in the text
    .header("Authorization", _AUTHPARAMS + authToken)
    .data(
             // you don't need the userid, the '-' will suffice
             // "r" means remove. you can also use "a" to add
             // you have lots of other options besides starred. e.g: read
            "r", "user/-/state/com.google/starred",
            "async", "true",
            // the feed, but don't forget the beginning: feed/
            "s", "feed/http://www.gizmodo.com/index.xml",
            // there are 2 id formats, easy to convert - more info ahead in the text
            "i", "tag:google.com,2005:reader/item/1a68fb395bcb6947",
            // another token - this one for allow editing - more details on how to get this ahead in the text
            "T", "//wF1kyvFPIe6JiyITNnMWdA"
    )
    // I also send my API key, but I don't think this is mandatory
    .userAgent("[YOUR_APP_ID_GOES_HERE].apps.googleusercontent.com")
    .timeout(10000)
    // VERY IMPORTANT - don't forget the post! (using get() will not work)
    .post(); 
```

[您可以在其他问题](https://stackoverflow.com/questions/1434146/how-to-mark-items-read-with-google-reader-api)中查看我的回答，了解更多实施细节（评论中提到的那些）。

要列出提要中所有已加星标的项目，您可以使用[http://www.google.com/reader/api/0/stream/items/ids](http://www.google.com/reader/api/0/stream/items/ids)或[http://www.google.com/reader/atom/user ///state/com.google/starred](http://www.google.com/reader/atom/user/-/state/com.google/starred)。您可以使用这些 id 调用上述 API 来移除星星。

最后两个更容易使用。您可以在这些非官方（但结构良好）资源上查看 API 的详细信息：http : [//www.chrisdadswell.co.uk/android-coding-example-authenticating-clientlogin-google-reader-api/，http](http://www.chrisdadswell.co.uk/android-coding-example-authenticating-clientlogin-google-reader-api/) [:// code.google.com/p/pyrfeed/wiki/GoogleReaderAPI，http://blog.martindoms.com/2009/10/16/using-the-google-reader-api-part-2](http://code.google.com/p/pyrfeed/wiki/GoogleReaderAPI) _ [_](http://blog.martindoms.com/2009/10/16/using-the-google-reader-api-part-2)

希望能帮助到你！

# installation - 整个文件补丁与增量补丁安装

> ID：1018627
> 
> 赞同：2
> 
> 时间：2009-06-19T15:35:23.440
> 
> 标签：installation

我正在为我们的客户准备一个服务版本安装。我正在创建一个小更新补丁。是否建议使用增量补丁方法更新文件，还是“整个文件”方法产生更可靠的结果？有没有人看到过一个比另一个有优势（除了增量补丁的较小尺寸）？

我正在使用 InstallShield Basic MSI 项目和 Windows Installer 3.1

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-19T21:33:46.190

由于 XP 版本的 MSPATCHA.DLL 存在一个 bug，它是一个不能轻易替换的受保护文件，因此整个文件方法更加可靠。事实上，这是我向运行 XP 的用户分发补丁的唯一选择。

# macos - FireLog：正确安装

> ID：1018628
> 
> 赞同：1
> 
> 时间：2009-06-19T15:35:27.387
> 
> 标签：macos, kernel, iokit

我已经在我的开发 Mac 上安装了 firewiresdk26 ......并且在 Tools/ 目录中是 FireLog。我在我的 dev mac 上运行了 FireLog 2.0.0.pkg 安装程序，但它部署的有效负载安装在我的 /System/Library 树中，而不是我的 /Developer/SDKs 树中。因此，当我尝试包含标头 iokit/firewire/FireLog.h 时，找不到它。

我错过了什么吗？或做错了什么？

或者这是安装程序中的错误（FW26 还是 FireLog 安装程序？）我意识到 FireLog 安装程序旨在在机器上运行以进行远程调试，因此将框架放置在 /System/Library 中是有意义的路径，但是没有安装程序将它放入我的开发者路径中......我想我只需要手动将它移到那里，但在我这样做之前，我想看看我是否只是忽略了一些愚蠢的东西并且需要阅读更专注的文档或其他东西......

有人遇到过这个吗？[谢谢]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T10:48:40.257

事实证明，答案很简单......
从 10.5 Leopard 开始，FireLog 设施内置在操作系统中，并且根本不再需要 FireLog 应用程序/框架！

请参阅 FireWireKPrintf Readme.txt

和

男人 fwkpfv

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-31T02:39:22.010

我不得不手动将头文件安装到：

```
/Developer/SDKs/MacOSX10.5.sdk/System/Library/Frameworks/Kernel.framework/Versions/A/Headers/IOKit/firewire/IOFireLog.h
/Developer/SDKs/MacOSX10.6.sdk/System/Library/Frameworks/Kernel.framework/Versions/A/Headers/IOKit/firewire/IOFireLog.h

```

您可以通过简单地将 FireLog 声明添加到项目的头文件中来完成相同的操作：

```
void FireLog( const char *format, ... );

```

FireLog 的性能比 FireWireKprintf 高得多，因此使用它可能是有利的，特别是在需要记录快速活动且性能下降较少的情况下。

# c# - 如何在 .net windows 应用程序的“添加/删除程序”中添加一个条目

> ID：1018634
> 
> 赞同：1
> 
> 时间：2009-06-19T15:36:16.153
> 
> 标签：c#, asp.net, windows

如何在 .net windows 应用程序的“添加/删除程序”中添加一个条目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T15:38:23.840

使用部署项目创建 MSI 文件并让用户执行该文件，而不是 xcopy 部署。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T15:48:49.157

删除“仅在线可用”选项的 ClickOnce 部署也将执行此操作。或者创建一个 MSI 包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:42:35.097

除了部署项目，ClickOnce 部署也将实现这一点。

# linux - 在 x86 linux 上使用软件浮点

> ID：1018638
> 
> 赞同：9
> 
> 时间：2009-06-19T15:36:41.677
> 
> 标签：linux, floating-point, x86

是否可以（轻松地）在 i386 linux 上使用软件浮点，而不会产生每次调用都陷入内核的费用？我试过-msoft-float，但似乎普通（ubuntu）C库没有包含FP库：

```
$ gcc -m32 -msoft-float -lm -o test test.c
/tmp/cc8RXn8F.o: In function `main':
test.c:(.text+0x39): undefined reference to `__muldf3'
collect2: ld returned 1 exit status 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-11-22T13:28:57.983

令人惊讶的是 gcc 本身并不支持这一点，因为代码在源代码中的一个名为`soft-fp`. 可以手动编译该库：

```
$ svn co svn://gcc.gnu.org/svn/gcc/trunk/libgcc/ libgcc
$ cd libgcc/soft-fp/
$ gcc -c -O2 -msoft-float -m32  -I../config/arm/ -I..  *.c
$ ar -crv libsoft-fp.a *.o 
```

有一些 c 文件由于错误而无法编译，但大多数都可以编译。使用我们的源文件复制`libsoft-fp.a`到目录后，它们现在可以正常编译`-msoft-float`：

```
$ gcc -g -m32  -msoft-float test.c -lsoft-fp -L. 
```

使用快速检查

```
$ objdump -D --disassembler-options=intel a.out  | less 
```

表明，正如预期的那样，没有调用 x87 浮点指令，并且代码运行速度也相当慢，在我的示例中使用了很多除法，是 8 倍。

**注意：**我宁愿编译软浮点库

```
$ gcc -c -O2 -msoft-float -m32  -I../config/i386/ -I..  *.c 
```

但这会导致大量错误消息，例如

```
adddf3.c: In function '__adddf3':
adddf3.c:46: error: unknown register name 'st(1)' in 'asm' 
```

似乎该`i386`版本没有得到很好的维护，因为它`st(1)`指向 x87 寄存器之一，使用`-msoft-float`. 奇怪或幸运的是，该`arm`版本在 an 上编译得很好，`i386`并且似乎工作得很好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T15:44:20.083

除非您*想*手动引导整个工具链，否则您可以从[uclibc 工具链](http://packages.ubuntu.com/dapper/devel/uclibc-toolchain)（我想是 i386 版本）开始——软浮点（AFAIK）不直接支持在 debian 和衍生产品上的“本机”编译，但它可以是通过 uclibc 工具链的“嵌入式”方法使用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-08T21:25:29.903

如果没有一些额外的库，GCC 不支持这一点。来自[386 文档](http://gcc.gnu.org/onlinedocs/gcc-4.6.1/gcc/i386-and-x86_002d64-Options.html#i386-and-x86_002d64-Options)：

> **-msoft-float**生成包含浮点库调用的输出。**警告**：必需的库不是 GCC 的一部分。通常使用机器通常的 C 编译器的工具，但这不能直接在交叉编译中完成。您必须自行安排为交叉编译提供合适的库函数。
> 
> 在函数在 80387 寄存器堆栈中返回浮点结果的机器上，即使使用 -msoft-float 也可能会发出一些浮点操作码

此外，您不能将 -mfpmath=unit 设置为“none”，它必须是 sse、387 或两者兼而有之。

但是，根据[this gnu wiki page](http://gcc.gnu.org/wiki/Software_floating_point)，有 fp-soft 和[ieee](http://www.math.utah.edu/~beebe/software/ieee/)。还有[SoftFloat](http://www.jhauser.us/arithmetic/SoftFloat.html)。

（对于 ARM，有 -mfloat-abi=softfp，但似乎没有类似的东西可用于 386 SX）。

**tcc**似乎也不支持软件浮点数。

祝你好运找到适合你的图书馆。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:45:23.687

天，

除非您的目标是没有内置 FP 支持的平台，否则我想不出您想要模拟 FP 支持的原因。

你的 x386 平台没有外部 FPU 支持吗？可惜它不是内置 FPU 的 x486！

以我的经验，任何软仿真都必然比其硬件仿真慢得多。

这就是为什么我完成了在 Ada 中编写一个包来标记板载 68k FPU，而不是使用当时编译器制造商提供的软仿真。事实上，他们最终将它捆绑在他们的编译器中。

**编辑：**刚刚在下面看到您的评论。嗯，如果您不需要一整套 FP 支持，是否可以为您确实需要的少数数学函数推出自己的功能？我提到的 Ada 包就是这样开始的。

高温高压

干杯，

# c# - 处理负时间跨度

> ID：1018643
> 
> 赞同：43
> 
> 时间：2009-06-19T15:38:01.220
> 
> 标签：c#, .net, datetime, timespan

在我的网格输出中，我计算 a`TimeSpan`并取其`TotalHours`. 例如

```
(Eval("WorkedHours") - Eval("BadgedHours")).TotalHours 
```

目标是显示`TotalHours`as `39:44`，所以我需要将值从 转换`7.5`为`07:30`。这没问题......除非它是负面的！

我可以创建一个`TimeSpan`对象`Hours`

```
TimeSpan.FromHours( (Eval("WorkedHours") - Eval("BadgedHours")).TotalHours) 
```

如果为负数，我无法将其转换为 a`DateTime`以使用该`.ToString("HH:mm")`方法，并且该`TimeSpan`对象不支持格式字符串。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2011-11-27T22:37:44.280

没有[`TimeSpan.Duration`](https://docs.microsoft.com/en-us/dotnet/api/system.timespan.duration?view=net-6.0)方法吗？我认为这将处理您正在尝试做的事情。

> 返回一个新的 TimeSpan 对象，其值为当前 TimeSpan 对象的绝对值。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-19T16:14:40.963

```
static string ToHMString(TimeSpan timespan) { 
    if (timespan.Ticks < 0) return "-" + ToHMString(timespan.Negate());

    return timespan.TotalHours.ToString("#0") + ":" + timespan.Minutes.ToString("00");
}

Console.WriteLine(ToHMString(TimeSpan.FromHours(3)));       //Prints "3:00"
Console.WriteLine(ToHMString(TimeSpan.FromHours(-27.75)));  //Prints "-28:45" 
```

如果时间跨度超过 24 小时，这也将正常工作。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-19T15:41:45.487

只需将其乘以 -1 或使用绝对值函数。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-11-01T11:47:51.023

TimeSpan 类中有一个 Negate 方法。

链接到 MSDN 文档： [TimeSpan.Negate Method()](https://msdn.microsoft.com/en-us/library/system.timespan.negate(v=vs.110).aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-01-02T11:26:07.587

它的工作。试试这个

mytimespam.Negate();

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-19T15:42:18.870

简单的解决方案是：

```
string format = "HH:mm";
if(hours < 0)
  format = "-" + format;

hours = Math.Abs(hours) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-11-18T15:19:48.637

嗨，我把它变成了我一直在写的一些代码，希望它有帮助

(结果) 是一个 int 变量

`(TimeSpan.FromMinutes(result)) < TimeSpan.Zero ? "-" + TimeSpan.FromMinutes(result).ToString(@"hh\:mm") : "" + TimeSpan.FromMinutes(result).ToString(@"hh\:mm");`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-22T13:06:49.017

```
TimeSpan Diff = Date1 - Date2;

if ((int)Diff.TotalDays < 0) { // your code } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-02-20T09:04:38.797

我检查了每一个地方。但我没有得到正确的答案，为什么我用这种方式完成

```
TimeSpan diff = actualout.Subtract(actualin);
 string a =(diff.ToString()).ToString();
if(a.Contains("-"))
 {        
 diff = new TimeSpan(0,0,0,0);
} 
```

# c# - 将现有表中的数据行添加到新表中

> ID：1018648
> 
> 赞同：0
> 
> 时间：2009-06-19T15:40:13.133
> 
> 标签：c#, .net, ado.net, asp.net-3.5, datarow

嗨，我想添加一个我从数据表返回的数据行到一个新的数据表

这是我使用的代码：

```
foreach (DataRow dr1 in dt.Rows)
{
  string AptType = dr1["AppointmentType"].ToString();
  if (AptType == "FreeTime")
  {
    dt2.ImportRow(dr1);
  }
}
RadGrid2.DataSource = dt2;
reader.Close();
conn.Close(); 
```

问题是，当我然后去运行上面有表格的页面时，我得到一个数据键错误，并且其中一个列没有被识别

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T15:45:20.037

这两个数据表是否具有相同的架构？如果这些错误与列、数据类型或键不匹配，则可能会引发这些错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T20:09:51.693

你应该使用 Typed TableDataAdapters，我会让你的生活更轻松......

这是很容易做到和理解的。

遵循本教程[强类型表数据适配器和数据表](http://weblogs.asp.net/scottgu/archive/2006/01/15/435498.aspx)

一旦你掌握了这个概念，你应该做这样的事情：

```
MyTypedTableAdapter tableAdapter = new MyTypedTableAdapter();
    MyTypedDataTable dt = tableAdapter.GetData();
    foreach (MyTypedDataRow row in dt.Rows)
    {
        string AptType = row.AppointmentType;
        if (AptType == "FreeTime")
        {
            dt2.ImportRow(row);
        }
    }
    RadGrid2.DataSource = dt2; 
```

# sql - NOLOCK 与事务隔离级别

> ID：1018651
> 
> 赞同：19
> 
> 时间：2009-06-19T15:40:46.363
> 
> 标签：sql, sql-server, transaction-isolation

使用“SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED”和 NOLOCK 有什么区别？这个比那个好吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-19T15:42:47.403

它们是相同的东西，只是范围不同。NOLOCK 放置在每个表的基础上，并且`SET Transaction...`可以作为一个块放置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T15:43:21.990

NOLOCK 是一个查询提示，因此仅适用于指定它的查询中的特定表。

设置事务隔离级别适用于在当前连接中执行的所有代码，或者直到它被显式修改。

澄清一下，工作中的隔离级别在功能上是相同的，但所涵盖的范围可能不同。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-19T15:43:34.190

请参阅几个小时前对[SQL Server SELECT statements 导致阻塞的问题的](https://stackoverflow.com/questions/1017177/sql-server-select-statements-causing-blocking/)[答案](https://stackoverflow.com/questions/1017177/sql-server-select-statements-causing-blocking/1017217#1017217)。

引用[Remus Rusanu 的话](https://stackoverflow.com/users/105929/remus-rusanu)：

> SELECT 可以阻止更新。正确设计的数据模型和查询只会导致最小的阻塞并且不会成为问题。'通常' WITH NOLOCK 提示几乎总是错误的答案。正确的答案是调整您的查询，使其不会扫描巨大的表。
> 
> 如果查询不可调，那么您应该首先考虑 SNAPSHOT ISOLATION 级别，其次您应该考虑使用 DATABASE SNAPSHOTS，最后一个选项应该是 DIRTY READS（并且最好更改隔离级别而不是使用 NOLOCK HINT）。请注意，脏读，顾名思义，将返回不一致的数据（例如，您的总工作表可能不平衡）。

其他答案也可能对您有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:45:47.397

它们具有相同的效果，只有一个用作锁定提示（nolock），另一个用作连接范围。

小心其中任何一个 - 脏读可能是一件非常糟糕的事情，具体取决于您的应用程序。由于页面移动而两次读取同一记录或丢失一条记录对于用户来说可能是一件非常令人困惑的事情......

# javascript - 在我的框架中查找带有函数的页面 url

> ID：1018654
> 
> 赞同：0
> 
> 时间：2009-06-19T15:41:10.013
> 
> 标签：javascript, url

我制作了一个 html 页面，两个网站将它放在她的网站上，就像一个框架。

我想改变我的框架的颜色。所以我必须知道女巫网站包括我的框架。

我必须在javascript中使用什么功能

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T15:49:12.243

```
try {
  alert(window.top.location);
} catch (e) {
  alert("Couldn't read window.top.location.\n" + e.message);
} 
```

由于跨站点策略，这可能不起作用。或者，您可以让一些服务器端逻辑根据请求参数动态插入样式表。

例如，

```
http://mysite.com/iframeContent?useStyles=http://yoursite.com/iframe.css 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:48:06.723

我会调查

```
window.frames 
```

因为它返回当前窗口内的帧数组。

这也可能会有所帮助：

[http://www.oreillynet.com/pub/a/javascript/excerpt/jstdg_ch13/index.html?page=2#winoverview](http://www.oreillynet.com/pub/a/javascript/excerpt/jstdg_ch13/index.html?page=2#winoverview)

# cognos - Cognos 8.3 没有数据内容问题

> ID：1018660
> 
> 赞同：0
> 
> 时间：2009-06-19T15:42:11.210
> 
> 标签：cognos

从 8.2 升级到 8.3 并测试新的无数据内容功能。如果返回结果，则报告按顺序查找。没有数据消息不会出现。但是，如果我们测试报告（传入参数但没有结果），我们会返回一个空白页面（pdf、html、excel 输出）。甚至页眉或页脚都不会出现在页面上。并且没有数据内容消息也不会出现。

我们有使用 Oracle SQL 的非常复杂的报告，并且在大多数情况下，标题内容链接到 SQL 语句以呈现数据库的输出并列出传入的参数。问题似乎与嵌入式数据对象有关，即我们有嵌入在表对象中的列表对象。到目前为止，我已经尝试剥离额外的层但没有成功。

在 8.2 中，我们使用样式变量，即 RowNumber()=0 或 RowNumber() 为 null 来有条件地隐藏报表正文中的数据对象。我们从未使用任何条件来隐藏或显示页眉或页脚，在 8.3 中这似乎是一个问题。

这在 8.3 中似乎是一个非常有用的增强功能，但我们还没有让它工作。有什么想法或建议可以尝试吗？

感谢您阅读本文。我很感激任何建议。

乔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T13:33:23.263

We ran into this same problem when upgrading reports from 8.2 => 8.4\. We reported it to Cognos as a bug -- Not sure if they've assigned a bug tracker id to it, but we got the impression it wasn't going to be fixed soon. (Obviously, if it exists in 8.3 and it has been carried forward to the next version, it's not a high priority.)

I'm sorry I don't have an answer at the moment on how to fix it, but I was planning to look into work arounds next week. I'll edit this post with any ideas I come up with.

**UPDATE:**

Not sure if this is an available feature of 8.3, but in 8.4 there is a new "No Data Contents" property for data containers (lists, blocks, etc.). Setting this value to yes creates two tabs at the top of the page, one for a page to be displayed if data is returned, and another for instances when no records are found. You can customize a message to be displayed using that second page. Pretty cool, actually, but buried in the documentation.

Hope that helps. If you still have problems, check out the Index topic "no data > specify what appears for a data container."

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-25T14:58:11.917

是的，它似乎返回了一个空白的pdf......但实际上，如果没有数据，cognos 查看器会在第二个提示页面出现错误。页眉和页脚以及不需要数据来呈现的项目......也没有显示出来。

这存在于 8.2 中，我们总是能够做一些工作来让它至少显示出来。现在在 8.3 中似乎更加普遍。

我也想要一个解决方案！住手！>_<

**编辑：**似乎一个轻微的解决方法是在 8.3 中创建一个新报告并从查询开始复制每个组件......然后是变量..然后是页面上的对象..然后是页面集和主详细信息关系。为了简单起见。基本上在 8.3 中从头开始重新创建报告似乎可以解决问题。

这适用于我们大约 90% 的报告。

# automation - 使用 Trac 自动分配工单

> ID：1018663
> 
> 赞同：0
> 
> 时间：2009-06-19T15:42:15.453
> 
> 标签：automation, trac, ticket-system

我正在使用**Trac** (v0.11)，我想：

1.  根据某些规则，在打开时自动将票分配给某人

2.  隐藏“新工单”屏幕中的“分配给”和“抄送”字段

我该怎么做（脚本、工作流程等）？
谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T16:00:42.040

第 1 点是使用**Components**解决的，标准 Trac 实体可以关联到工单的自动受让人。

第 2 点由强大的[BlackMagicTicketTweaks](http://trac-hacks.org/wiki/BlackMagicTicketTweaksPlugin)插件解决（它隐藏、禁用或更改 Ticket 表单上的字段名称）。

# mysql - mysqldump 表而不转储主键

> ID：1018669
> 
> 赞同：45
> 
> 时间：2009-06-19T15:42:24.690
> 
> 标签：mysql, mysqldump, load-data-infile

我有一张表分布在运行 MySql 4 的两台服务器上。我需要将它们合并到一台服务器中以用于我们的测试环境。

这些表实际上每个都有数百万条记录，它们在两台服务器上的原因是因为它们有多大。表的任何更改和分页都会给我们带来太大的性能损失。

因为它们在生产环境中，所以我不可能在现有服务器上以任何方式更改它们。

问题是主键是一个唯一的自动递增字段，因此存在交叉点。

我一直在试图弄清楚如何使用 mysqldump 命令忽略某些字段，但是 --disable-keys 只是改变了表，而不是完全摆脱了键。

在这一点上，看起来我需要修改数据库结构以利用主键的校验和或哈希作为实际上应该是唯一的两个唯一字段的组合......我真的不想做这个。

帮助！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2015-02-24T19:26:13.623

为了解决这个问题，我查找了这个问题，找到了@pumpkinthehead 的答案，并意识到我们需要做的就是用 NULL 查找+替换每一行中的主键，以便 mysql 将使用默认的 auto_increment 值。

`(your complete mysqldump command) | sed -e "s/([0-9]*,/(NULL,/gi" > my_dump_with_no_primary_keys.sql`

原始输出：

```
INSERT INTO `core_config_data` VALUES
    (2735,'default',0,'productupdates/configuration/sender_email_identity','general'),
    (2736,'default',0,'productupdates/configuration/unsubscribe','1'), 
```

转换输出：

```
INSERT INTO `core_config_data` VALUES
    (NULL,'default',0,'productupdates/configuration/sender_email_identity','general'),
    (NULL,'default',0,'productupdates/configuration/unsubscribe','1'), 
```

注意：这仍然是一个 hack；例如，如果您的自动增量列不是第一列，但 99% 的时间都解决了我的问题，它将失败。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-06-19T15:54:54.757

如果您不关心 auto_increment 列的值是什么，那么只需加载第一个文件，重命名表，然后重新创建表并加载第二个文件。最后，使用

```
INSERT newly_created_table_name (all, columns, except, the, auto_increment, column)
       SELECT all, columns, except, the, auto_increment, column
         FROM renamed_table_name 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-06-19T15:48:11.183

您可以创建没有主键列的表视图，然后在该视图上运行 mysqldump。

因此，如果您的表“用户”有以下列：id、name、email

```
> CREATE VIEW myView AS
  SELECT name, email FROM users 
```

编辑：啊，我明白了，我不确定是否还有其他方法。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-11-21T16:54:10.113

1.  克隆你的表
2.  删除克隆表中的列
3.  转储没有结构的克隆表（但使用 -c 选项获取完整插入）
4.  在您想要的地方导入

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-04-12T20:30:27.833

这是一个彻头彻尾的痛苦。我通过运行类似的东西来解决这个问题

```
sed -e "s/([0-9]*,/(/gi" export.sql > expor2.sql 
```

在转储上摆脱主键，然后

```
sed -e "s/VALUES/(col1,col2,...etc.) VALUES/gi" LinxImport2.sql > LinxImport3.sql 
```

对于除主键之外的所有列。当然，您必须小心`([0-9]*,`不要替换您真正想要的任何东西。

希望对某人有所帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-19T16:03:52.400

```
SELECT null as fake_pk, `col_2`, `col_3`, `col_4` INTO OUTFILE 'your_file'
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM your_table;

LOAD DATA INFILE 'your_file' INTO TABLE your_table
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n'; 
```

为了增加幻想，您可以在接收表上设置一个*插入前*触发器，该触发器在插入发生之前为到达行设置新的主键，从而使用常规转储并仍然清除您的 pk。没有经过测试，但对它很有信心。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-01-22T12:42:12.170

使用虚拟临时主键：

`mysqldump`正常使用`--opts -c`。例如，您的主键是“id”。编辑输出文件并在表结构中添加一行“dummy_id”，其类型与“id”相同（当然不是主键）。然后修改`INSERT`语句并将“id”替换为“dummy_id”。导入后，删除“dummy_id”列。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-22T13:15:48.357

jimyi 是在正确的轨道上。

这是自动增量键是 PITA 的原因之一。一种解决方案不是删除数据，而是添加数据。

```
CREATE VIEW myView AS
SELECT id*10+$x, name, email FROM users 
```

（其中 $x 是唯一标识原始数据库的单个数字）在源数据库上创建视图（您暗示这可能是不可能的）或使用像 Autocracy 描述的提取例程或将数据加载到临时表中测试盒。

或者，不要在测试系统上创建表 - 而是为 src 数据放入单独的表，然后创建一个从它们两者中获取的视图：

```
CREATE VIEW users AS
(SELECT * FROM users_on_a) UNION (SELECT * FROM users_on_b) 
```

C。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-08T07:05:34.893

我一直在使用的解决方案是对我正在导出的数据进行常规 SQL 导出，然后使用 RegEx 查找和替换编辑器从插入语句中删除主键。我个人使用 Sublime Text，但我确信 TextMate、Notepad++ 等也可以这样做。

然后我只需通过将查询复制粘贴到 HeidiSQL 的查询窗口或 PHPMyAdmin 来运行查询应该插入数据的数据库。如果有**很多**数据，我将插入查询保存到 SQL 文件并改用文件导入。复制和粘贴大量文本通常会使 Chrome 冻结。

这听起来可能需要做很多工作，但我很少在导出和导入之间使用超过几分钟的时间。可能比我在接受的解决方案上使用的要少得多。我已经在几十万行上使用了这种解决方法而没有问题，但我认为当你达到数百万时它会出现问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-06-10T20:44:16.237

我喜欢临时表路由。

```
create temporary table my_table_copy
select * from my_table;

alter table my_table_copy drop id;

// Use your favorite dumping method for the temporary table 
```

像其他人一样，这不是一个万能的解决方案（特别是考虑到 OP 的数百万行），但即使是 10^6 行，它也需要几秒钟才能运行但可以工作。

# silverlight - 将焦点设置在 DataGridTemplateColumn 中的 AutoCompleteBox

> ID：1018673
> 
> 赞同：2
> 
> 时间：2009-06-19T15:43:18.323
> 
> 标签：silverlight, silverlight-3.0, datagrid, autocomplete

我在 CellEditingTemplate 中有一个用于 DataGridTemplateColumn 的 AutoCompleteBox，并且在前一列中输入了一定数量的字符后，我试图自动关注它。

我已经能够使用 BeginInvoke 方法（在[此处](http://silverlight.net/forums/t/28726.aspx)描述）将焦点转移并正确设置插入符号，但前提是控件是 TextBox。当将此方法与 AutoCompleteBox 一起使用时，插入符号不会设置，控件似乎也不会获得焦点。

我试图通过在 setCaretInCurrentCell 方法中获取对 AutoCompleteBox 的引用并调用焦点来手动设置焦点，但这也不起作用。

我真的想在本专栏中使用 AutoCompleteBox 功能，但数据网格需要针对数据输入进行优化，这意味着如果用户无法使用选项卡或自动被带到下一个字段，则它是一个显示停止器。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-30T09:48:23.867

我可能会对此提出最奇怪的建议，但不要尝试进入网格/控制树并明确处理事物，而是使用当前列设置。

将帮助文件中的数据模板示例撕下 XAML 和基本代码如下：

这在很大程度上并不完美：

*   它只是根据按空格从第 0 列移动到第 1 列，您对移动焦点的条件的要求更复杂。
*   我没有设置两种方式绑定，所以编辑仍然存在等。只是看看如何移动列。

但是当它运行时，它会响应一个空格并将光标移动到自动完成框中，突出显示文本，如果我开始输入自动完成下拉菜单就会激活。因此，原则上，设置当前列似乎提供了您所追求的行为。

一个。

代码：

```
 <UserControl x:Class="SilverlightApplication2.MainPage"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
        xmlns:data="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"
        xmlns:input="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Input"
        xmlns:toolkit="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Toolkit"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        Width="400" Height="300">
        <ScrollViewer VerticalScrollBarVisibility="Auto" BorderThickness="0">
            <StackPanel Margin="10,10,10,10">

                <TextBlock Text="DataGrid with template column and custom alternating row backgrounds:"/>
                <data:DataGrid x:Name="dataGrid5" 
                Height="125" Margin="0,5,0,10"
                AutoGenerateColumns="False"
                RowBackground="Azure"
                AlternatingRowBackground="LightSteelBlue">
                    <data:DataGrid.Columns>
                        <!-- Address Column -->
                        <data:DataGridTemplateColumn Header="Address" Width="300">
                            <data:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Padding="5,0,5,0" Text="{Binding Address}"/>
                                </DataTemplate>
                            </data:DataGridTemplateColumn.CellTemplate>
                            <data:DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <TextBox Padding="5,0,5,0" Text="{Binding Address}"/>
                                </DataTemplate>
                            </data:DataGridTemplateColumn.CellEditingTemplate>
                        </data:DataGridTemplateColumn>
                        <!-- Name Column -->
                        <data:DataGridTemplateColumn Header="Name">
                            <data:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Padding="5,0,5,0"
                                        Text="{Binding FirstName}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </data:DataGridTemplateColumn.CellTemplate>
                            <data:DataGridTemplateColumn.CellEditingTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <input:AutoCompleteBox Padding="5,0,5,0"
                                        Text="{Binding FirstName}">
                                            <input:AutoCompleteBox.ItemsSource>
                                                <toolkit:ObjectCollection>
                                                    <system:String>January</system:String>
                                                    <system:String>February</system:String>
                                                    <system:String>March</system:String>
                                                    <system:String>April</system:String>
                                                    <system:String>May</system:String>
                                                    <system:String>June</system:String>
                                                    <system:String>July</system:String>
                                                    <system:String>August</system:String>
                                                    <system:String>September</system:String>
                                                    <system:String>October</system:String>
                                                    <system:String>November</system:String>
                                                    <system:String>December</system:String>
                                                </toolkit:ObjectCollection>
                                            </input:AutoCompleteBox.ItemsSource>
                                        </input:AutoCompleteBox>
                                    </StackPanel>
                                </DataTemplate>
                            </data:DataGridTemplateColumn.CellEditingTemplate>
                        </data:DataGridTemplateColumn>

                    </data:DataGrid.Columns>
                </data:DataGrid>
                <Button Content="test"></Button>
            </StackPanel>
        </ScrollViewer>

    </UserControl>

using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Shapes;

namespace SilverlightApplication2
{
    public partial class MainPage : UserControl
     {
        public MainPage()
        {
            InitializeComponent();

            // Set the ItemsSource to autogenerate the columns.

            dataGrid5.ItemsSource = Customer.GetSampleCustomerList();

            dataGrid5.KeyDown += new KeyEventHandler(dataGrid5_KeyDown);

        }

        void dataGrid5_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Key == Key.Space)
            {
                // move to next cell and start editing
                DataGrid grd = (DataGrid)sender;
                if (grd.CurrentColumn.DisplayIndex == 0)
                {
                    // move to column 1 and start the edit
                   grd.CurrentColumn = grd.Columns[1];
                }
            }
        }
    }

    public class Customer
    {
        public String FirstName { get; set; }
        public String LastName { get; set; }
        public String Address { get; set; }
        public Boolean IsNew { get; set; }

        // A null value for IsSubscribed can indicate 
        // "no preference" or "no response".
        public Boolean? IsSubscribed { get; set; }

        public Customer(String firstName, String lastName, 
            String address, Boolean isNew, Boolean? isSubscribed)
        {
            this.FirstName = firstName;
            this.LastName = lastName;
            this.Address = address;
            this.IsNew = isNew; 
            this.IsSubscribed = isSubscribed;
        }

        public static List<Customer> GetSampleCustomerList()
        {
            return new List<Customer>(new Customer[4] {
                new Customer("A.", "Zero", 
                    "12 North", 
                    false, true), 
                new Customer("B.", "One", 
                    "34 West", 
                    false, false),
                new Customer("C.", "Two", 
                    "56 East", 
                    true, null),
                new Customer("D.", "Three", 
                    "78 South", 
                    true, true)
            });
        }
    }

} 
```

# asp.net-mvc - 对于需要在 ASP.NET MVC 中显示的分层数据，我应该如何构建我的 ViewModel？

> ID：1018679
> 
> 赞同：4
> 
> 时间：2009-06-19T15:44:08.103
> 
> 标签：asp.net-mvc, treeview, tree, viewmodel

我有一个看起来像这样的视图：

![替代文字](../Images/a53d39493e164b93351ddfc77cb5e6a5.png)

我试图弄清楚我应该如何为这个视图表示我的 ViewModel。每个“机构”可以有多个“业务单位”，每个“业务单位”可以有多个“客户”。

在数据库中，我很容易用代理表、业务单元表和客户表的映射表和外键来表示这一点。

但是，现在我需要使用 LINQ 从数据库中查询这些数据，然后构造一个表示这种树状结构的 ViewModel 对象，以便我的 View 可以呈现它。

谁能给我关于我应该使用什么数据结构的提示，或者我的 ViewModel 在 C# 代码中的这种分层结构可能看起来像什么？我需要创建我的 ViewModel 对象来传递给这个视图。

任何有关如何表示 ViewModel 的建议都值得赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:19:27.797

只需在您的视图数据中存储一个 List 实例？

```
public class Agency
{
   public List<BusinessUnit> Units;
   public string Name;
   public int NumberOfAccounts
   {
      get 
      {
         int ret = 0;
         foreach(BusinessUnit unit in units)
            ret += unit.NumberOfAccounts;
         return ret;
      }
   }
   // ... continue this strategy for other properties
}
public class BusinessUnit
{
   public List<Client> clients;
   public string Name;
   public int NumberOfAccounts
   {
      get 
      {
         int ret = 0;
         foreach(Client client in clients)
            ret += client.NumberOfAccounts;
         return ret;
      }
   }
   // ... continue this strategy for other properties

}
public class Client
{
   public string Name;
   public int NumberOfAccounts;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:01:20.637

我最近一直在使用“ADO .Net 实体数据模型”模板来控制与支持层次结构数据的 MSSQL 数据库的连接，并且运行良好。

您可以将表示层直接绑定到数据模型。

如果您的密钥在数据库中设置正确，则可以快速启动和运行..我认为它还需要 ADO.Net 3.5

[创建 ADO.NET Entity Framework 实体](http://open-source-net-java.blogspot.com/2009/06/creating-adonet-entity-framework-entity_08.html)

[MS 实体信息](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-20T01:30:49.953

假设您的 Linq2Sql 实现与数据库具有相同的关系（如果您确实拖放到设计器，他们肯定会这样做），这就是我将如何处理它。

我将创建一个代理类型的强类型部分视图，它代表每个部分（代理，在你的情况下），称之为 AgencyReportSection.ascx。这种控制将使代理机构迭代其业务部门，进而迭代其客户。

无论您在哪里打包数据，都可以执行以下操作：

```
DataContext context = new DataContext();
DataLoadOptions options = new DataLoadOptions();
options.LoadWith<Agency>(a => a.BusinessUnit);
options.LoadWith<BusinessUnit>(b => b.Client); 

context.LoadOptions = options; 
```

这将为您提供的是，当上下文获得代理时，它将遵循定义的关系并为您提供这些对象。所以你得到：

```
Agency a = context.Agency.FirstOrDefault();
IEnumerable<BusinessUnit> units = a.BusinessUnits;
IEnumerable<Client> clients = units.Clients; 
```

您的视图可以执行以下操作：

```
<% foreach(var agency in agencies)%{>
<% Html.RenderPartial("AgencyReportSection"); %> 
<%}%> 
```

您执行数据加载选项的原因是为了避免视图中的延迟加载，让模型打包所有必要的数据。

我希望我已经正确理解了你的问题......

# java - 如何为 BlazeDS 启用 RDS 支持？

> ID：1018695
> 
> 赞同：1
> 
> 时间：2009-06-19T15:46:57.240
> 
> 标签：java, apache-flex, blazeds

我在我的应用程序中使用 BlazeDS 3。BlazeDS 库的依赖项是从公共 maven 存储库下载的。但是，由于缺少一些库，我无法在服务器上启用 RDS 支持。有谁知道这个类的位置： blazeds 发行版中的 flex.rds.server.servlet.FrontEndServlet？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-20T19:37:00.413

这是一个错误，几个月前报告已修复...有关错误详细信息 - 请查看[此处](http://bugs.adobe.com/jira/browse/FB-18612)。当然，这是在夜间构建中，而不是在正式版本中。

您会在错误文本中注意到它们引用了 ChangeList Number-229457 中的修复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-10T15:13:23.933

您需要使用 blazeDS 4 来获得 RDS 支持。您所指的类 `flex.rds.server.servlet.FrontEndServlet`与`flex-rds-server.jar`BlazeDS 4 一起提供

# rhino-mocks - Rhino Mocks - 模拟工厂

> ID：1018698
> 
> 赞同：1
> 
> 时间：2009-06-19T15:47:39.127
> 
> 标签：rhino-mocks, range, collections

我有一个以 IJob 形式创建作业对象的工厂

```
Public Interface IJobFactory
    Function CreateJobs(ByVal cacheTypes As CacheTypes) As IEnumerable(Of IJob)
End Interface 
```

IJob 接口定义了三件事

```
Public Interface IJob
    Sub Execute()
    ReadOnly Property Id() As Integer
    ReadOnly Property JobType() As JobType
End Interface 
```

我正在尝试测试工厂的消费者，一个名为 JobManager 的类。作业管理器调用 IJobFactory 并要求收集 IJobs。我可以很好地解决这个问题，但如果没有大量工作，我就无法改变集合大小。

有没有一种简单的方法来存根集合，以便我得到一个范围？

如何创建 IJobFactory.CreateJobs 的存根，以便我取回 IJob 存根的集合，例如 5 个左右，其中每个 IJob 存根的 Id 都不同。id 可以是 1 到 5，这样会很好用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-01T09:53:48.843

我会创建一个辅助函数来设置对工厂的期望（c# 表示法，未经测试）：

```
private List<IJob> SetExpectedJobs(MockRepository mocks, IJobFactory factory, int n)
{
    List<IJob> result = new List<IJob>();
    for(int i=1; i<=n; i++)
    {
        IJob job = mocks.CreateStub<IJob>();
        Expect.Call(job.Id).Return(i).Repeat.Any();
        result.Add(job);
    }
    Expect.Call(factory.CreateJobs(null)).Return(result).IgnoreArguments();
    return result;
} 
```

并在测试开始时设置期望时调用此函数。可能您也应该将 cacheTypes 传递给此方法。

# vb.net - 大量文件的 Visual Studio 和编译性能问题

> ID：1018699
> 
> 赞同：4
> 
> 时间：2009-06-19T15:47:59.857
> 
> 标签：vb.net, visual-studio, performance, compiler-construction, projects-and-solutions

我们当前的解决方案/项目将几个类合并到一个文件中，我听说这是由于 VS 中的编译时间缓慢而完成的。

这是一个已确认的问题和解决方案吗？

既然我们正在使用 VS2008 Team 系统，我们可以将它们分开吗？有没有其他人将这些类分成不同的文件并且仍然具有良好的性能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T16:48:18.620

我在 VB.Net IDE 团队工作，我可以告诉你，将所有内容放在 1 个文件中会使 VS 运行得更慢，而不是更快。VB.Net 可以很好地处理不同文件中的类。

唯一会产生影响的情况是，如果您的硬盘驱动器速度慢得令人难以置信，并且文件位于物理磁盘的不同部分（导致越来越多的寻道指令）。一般来说，这应该不是问题，对于 VB.Net IDE，这只会在初始启动期间出现问题。我们有几层缓存可以帮助消除这些类型的问题。

如果您只考虑命令行编译器运行所需的原始时间，您**可能会发现这种方法的一些最小好处。**恕我直言，更重要的数字是 Visual Studio 的响应能力和 Visual Studio 的相对构建时间。**如果文件过长**（如果您将任何类放入单个文件最终会发生这种情况）， VS 的响应能力会降低。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T16:25:29.730

你的硬件是什么样的？

VS 的一大瓶颈是它需要读取和写入大量的小文件。

一两个快速硬盘驱动器可以提高性能负载！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T15:56:30.043

我使用的是 C# 而不是 VB.NET，但我从未遇到过编译器性能问题。这似乎是某种过早的优化。我不在乎我的构建服务器需要多长时间来构建应用程序。不要为了构建时间性能而牺牲清晰度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T16:11:11.773

听起来您可能想说服您的团队研究解决方案设计；拥有一个包含所有项目的巨型解决方案可能不是最佳选择。如果构建时间确实是一个问题，如果可能的话，我宁愿通过将解决方案分解为逻辑部分来解决它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T16:20:09.247

我不相信将许多类分组到一个文件中会显着提高普通项目的构建性能。将它们分成更多文件应该是安全的（每个类一个是标准的）。

我遇到的一个例外是“网站”项目。我没有任何科学数据，但随着文件数量的增加，这些数据似乎会变慢*。*要解决此问题，您可以将其转换为“Web 应用程序”项目。

众所周知，解决方案中有太多项目会使 VS 变慢，但这听起来不像您的问题。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-06-19T16:30:43.253

这是一个已确认的问题和已确认的解决方案。今年在 Tech Ed 上，他们说 VS2010 将不再是问题，您可以下载测试版并试用。

# linq-to-sql - Linq to SQL 问题 - 指定列然后修改列

> ID：1018704
> 
> 赞同：0
> 
> 时间：2009-06-19T15:48:48.187
> 
> 标签：linq-to-sql

我正在尝试编写一个 linq to sql 方法来处理 ajax 网格的排序、分页和过滤。我创建了一个具有 TotalRecordCount 的部分类 Employee，因为我需要将它传递给 javascript 以设置寻呼机。问题是它不会构建，因为我无法设置 AnonymousType#1.TotalRecordCount，它是只读的。然而，如果我“选择新员工”，那么它将抛出异常 - “不允许在查询中显式构造实体类型'InVision.Data.Employee'。”。

这是代码...

```
public string GetPageJSON(string sortColumn, string sortDirection, int pageNumber, int pageSize, EmployeeSearch search)
        {
            var query = from e in db.Employees
                        select new
                        {
                            EmployeeID = e.EmployeeID,
                            FirstName = e.FirstName,
                            LastName = e.LastName,
                            LoginName = e.LoginName,
                            IsLockedOut = e.IsLockedOut,
                            TotalRecordCount = e.TotalRecordCount
                        };
            //searching.
            if (search.FirstName.Length > 0) query = query.Where(e => e.FirstName.Contains(search.FirstName));
            if (search.LastName.Length > 0) query = query.Where(e => e.LastName.Contains(search.LastName));
            if (search.LoginName.Length > 0) query = query.Where(e => e.LoginName.Contains(search.LoginName));
            if (search.Status.Length > 0) query = query.Where(e => (search.Status == "Active" && !e.IsLockedOut) 
                || (search.Status == "Inactive" && e.IsLockedOut));
            //sorting.
            query = query.OrderBy(sortColumn, sortDirection);
            //get total record count.
            int totalRecordCount = query.Count();
            //paging.
            query = query.Skip((pageNumber - 1) * pageSize).Take(pageSize);
            //set total record count.
            var list = query.ToList();
            if (list.Count > 0)
            {
                list[0].TotalRecordCount = totalRecordCount; //throws exception
            }
            //return json.
            JavaScriptSerializer serializer = new JavaScriptSerializer();
            return serializer.Serialize(list);
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:04:47.423

您需要选择原始对象而不是将它们映射到新对象（无论是相同类型还是匿名类型）。

替换这个：

```
var query = from e in db.Employees
                        select new
                        {
                            EmployeeID = e.EmployeeID,
                            FirstName = e.FirstName,
                            LastName = e.LastName,
                            LoginName = e.LoginName,
                            IsLockedOut = e.IsLockedOut,
                            TotalRecordCount = e.TotalRecordCount
                        }; 
```

有了这个：

```
var query = db.Employees.AsQueryable(); 
```

然后稍后替换这个：

```
var list = query.ToList();
if (list.Count > 0)
{
    list[0].TotalRecordCount = totalRecordCount;
} 
```

有了这个：

```
var list = from e in query
           select new
           {
               EmployeeID = e.EmployeeID,
               FirstName = e.FirstName,
               LastName = e.LastName,
               LoginName = e.LoginName,
               IsActive = !e.IsLockedOut,
               TotalRecordCount = totalRecordCount
           }; 
```

I think that should be everything. If the `JavaScriptSerializer` requires a `List`, just make sure you use it like this: `return serializer.Serialize(list.ToList());`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T17:46:37.970

I ended up using a custom view class to get this to work...

```
partial class EmployeeView
    {
        public int EmployeeID { get; set; }
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public string LoginName { get; set; }
        public bool IsActive { get; set; }
        public int TotalRecordCount { get; set; }
    }

public string GetPageJSON(string sortColumn, string sortDirection, int pageNumber, int pageSize, EmployeeSearch search)
        {
            var query = from e in db.Employees
                        select new EmployeeView
                        {
                            EmployeeID = e.EmployeeID,
                            FirstName = e.FirstName,
                            LastName = e.LastName,
                            LoginName = e.LoginName,
                            IsActive = !e.IsLockedOut,
                            TotalRecordCount = 0
                        };
            //searching.
            if (search.FirstName.Length > 0) query = query.Where(e => e.FirstName.Contains(search.FirstName));
            if (search.LastName.Length > 0) query = query.Where(e => e.LastName.Contains(search.LastName));
            if (search.LoginName.Length > 0) query = query.Where(e => e.LoginName.Contains(search.LoginName));
            if (search.Status.Length > 0) query = query.Where(e => (search.Status == "Active" && e.IsActive) 
                || (search.Status == "Inactive" && !e.IsActive));
            //sorting.
            query = query.OrderBy(sortColumn, sortDirection);
            //get total record count.
            int totalRecordCount = query.Count();
            //paging.
            query = query.Skip((pageNumber - 1) * pageSize).Take(pageSize);
            //set total record count.
            var list = query.ToList();
            if (list.Count > 0)
            {
                list[0].TotalRecordCount = totalRecordCount;
            }
            //return json.
            JavaScriptSerializer serializer = new JavaScriptSerializer();
            return serializer.Serialize(list);
        } 
```

# javascript - 如何检测浏览器中 AJAX (XmlHttpRequest) 调用的超时？

> ID：1018705
> 
> 赞同：47
> 
> 时间：2009-06-19T15:48:48.843
> 
> 标签：javascript, ajax, browser

我正在网上寻找，但很难找到文档。我们都知道使用浏览器内置`XMLHttpRequest`对象的基本 AJAX 调用（假设这里是现代浏览器）：

```
var xmlHttp = new XMLHttpRequest();  // Assumes native object

xmlHttp.open("GET", "http://www.example.com", false);

xmlHttp.send("");

var statusCode = xmlHttp.status;
// Process it, and I'd love to know if the request timed out 
```

那么，有没有一种方法可以通过检查浏览器中的 XMLHttpRequest 对象来检测 AJAX 调用超时？我会被建议做类似的事情`window.setTimeout(function() { xmlHttp.abort() }, 30000);`吗？

谢谢！

-麦克风

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2013-07-01T07:35:06.003

一些现代浏览器（2012）无需依赖即可做到这一点`setTimeout`：它包含在 XMLHttpRequest 中。请参阅答案[https://stackoverflow.com/a/4958782/698168](https://stackoverflow.com/a/4958782/698168)：

```
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function () {
    if (xhr.readyState == 4) {
        alert("ready state = 4");
    }
};

xhr.open("POST", "http://www.service.org/myService.svc/Method", true);
xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
xhr.timeout = 4000;
xhr.ontimeout = function () { alert("Timed out!!!"); }
xhr.send(json); 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-06-19T15:55:16.270

**更新：**这是一个如何处理超时[的示例：](http://geekswithblogs.net/lorint/archive/2006/03/07/71625.aspx)

```
var xmlHttp = new XMLHttpRequest();
xmlHttp.open("GET", "http://www.example.com", true);

xmlHttp.onreadystatechange=function(){
   if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
      clearTimeout(xmlHttpTimeout); 
      alert(xmlHttp.responseText);
   }
}
// Now that we're ready to handle the response, we can make the request
xmlHttp.send("");
// Timeout to abort in 5 seconds
var xmlHttpTimeout=setTimeout(ajaxTimeout,5000);
function ajaxTimeout(){
   xmlHttp.abort();
   alert("Request timed out");
} 
```

在 IE8 中，您可以向对象添加[超时](http://msdn.microsoft.com/en-us/library/cc304105(VS.85).aspx)事件处理程序`XMLHttpRequest`。

```
var xmlHttp = new XMLHttpRequest();
xmlHttp.ontimeout = function(){
  alert("request timed out");
} 
```

我建议不要像您的代码所暗示的那样进行同步调用，并且还建议使用 javascript 框架来执行此操作。**[jQuery](http://jquery.com)**是最流行的一种。它使您的代码更高效、更易于维护和跨浏览器兼容。

# sharepoint - CAML 查询

> ID：1018711
> 
> 赞同：2
> 
> 时间：2009-06-19T15:50:04.647
> 
> 标签：sharepoint, caml

我想要一个 CAML 查询来从日历列表中获取事件。

我想在接下来的 30 天左右获得包括今天在内的所有事件。

到目前为止，我有：

```
<Where>
  <DateRangesOverlap>
    <Geq>
      <FieldRef Name=\"EventDate\" />
      <Value Type=\"DateTime\">
        <Today />
      </Value>
    </Geq>
    <FieldRef Name=\"EndDate\" />
    <FieldRef Name=\"RecurrenceID\" />
    <Value Type=\"DateTime\">
      <Month />
    </Value>
  </DateRangesOverlap>
</Where> 
```

这不起作用:(有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T11:59:13.967

正如 Nat 所说，您暗示（但未指定）您正在使用日历列表中的重复事件，所以我假设这是不起作用的部分？

您需要在运行 CAML 查询之前设置`SPQuery.ExpandRecurrances`and`SPQuery.CalendarDate`属性，并且您只能使用对象模型而不是 Web 服务或通过在 CAML 中设置属性来执行此操作。

此外 - IIRC 这只会扩展在同一日历月内发生的重复事件的实例，`.CalendarDate`因此您必须多次运行它才能获得多月视图。

这是迄今为止我发现的涵盖重复事件的最佳参考。

*   [了解 SharePoint 日历以及如何将其导出为 iCal 格式](http://blogs.msdn.com/sharepoint/archive/2007/05/14/understanding-the-sharepoint-calendar-and-how-to-export-it-to-ical-format.aspx)

欢迎来到 SharePoint 中重复事件的噩梦！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T23:57:30.957

循环实际上并没有将所有事件添加到列表中，但 CAML 只能从列表中存储的“实际”事件中查询。

# c# - C# 创建与处理器一样多的类实例

> ID：1018714
> 
> 赞同：2
> 
> 时间：2009-06-19T15:50:57.923
> 
> 标签：c#, multithreading

我有一个 GUI C# 应用程序，它有一个按钮开始/停止。

最初，此 GUI 是创建一个类的单个实例，该实例查询数据库并在有结果时执行一些操作，并一次从数据库中获取单个“任务”。

然后我被要求尝试在 8 个核心系统中的一些系统上利用所有计算能力。使用我认为的处理器数量，我可以创建我的类的该数量的实例并运行它们，并且非常接近使用相当数量的计算能力。

```
Environment.ProccessorCount; 
```

使用这个值，在 GUI 表单中，我一直试图通过循环 ProccessorCount 次数并启动一个新线程，该线程调用类中的“doWork”类型方法。然后休眠 1 秒（以确保初始查询通过），然后继续循环的下一部分。

然而，我一直遇到这个问题，因为它似乎要等到循环完成才能启动导致某种冲突的查询（从 MySQL 数据库中获取相同的值）。

在主窗体中，一旦启动“workers”，它就会将按钮文本更改为 STOP，如果再次按下按钮，它应该在每个“worker”上执行“stopWork”方法。

我想要完成的事情有意义吗？有没有更好的方法来做到这一点（不涉及重组工人阶级）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:01:31.337

重构你的设计，让一个线程在后台运行，检查你的数据库是否有工作要做。

当它找到工作要做时，为每个工作项生成一个新线程。

不要忘记对关键的有限资源使用同步工具，例如信号量和互斥锁。微调同步值得您花时间。

您还可以尝试最大数量的工作线程 - 我的猜测是它会比您当前的处理器数量多一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T16:01:55.580

虽然关于多线程开发最佳实践的详尽答案有点超出我可以在这里写的范围，但有几点：

1.  除非绝对必要，否则不要使用`Sleep()`等待某些事情继续进行。如果您有另一个需要等待完成的代码进程，您可以使用`Join()`该线程或使用 a`ManualResetEvent`或`AutoResetEvent`. MSDN上有很多关于它们使用的信息。花一些时间阅读它。
2.  您不能真正保证您的线程将在各自的核心上运行。虽然操作系统线程调度程序很可能会执行此操作，但请注意，这并不能保证。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T15:55:54.367

我认为增加处理器使用率的最简单方法是简单地从[`ThreadPool`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)（通过调用[`ThreadPool.QueueUserWorkItem`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.queueuserworkitem.aspx)）在线程上生成工作方法。如果您在循环中执行此操作，则运行时将从线程池中获取线程并并行运行工作线程。

```
ThreadPool.QueueUserWorkItem(state => DoWork()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T15:56:22.650

永远不要`Sleep`用于线程同步。

您的问题没有提供足够的详细信息，但您可能希望使用 a`ManualResetEvent`让工作人员等待初始查询。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T15:58:05.893

是的，你想做的事情是有道理的。

让 8 个工作人员，每个工作人员从队列中消费任务是有意义的。如果线程需要访问共享状态，您应该注意正确同步线程。根据您对问题的描述，听起来您遇到了线程同步问题。

您应该记住，您只能从 GUI 线程更新 GUI。这也可能是你问题的根源。

如果没有更多信息或代码示例，真的无法判断问题到底是什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T16:01:46.847

我怀疑您有这样的问题：您需要将循环变量（任务）的副本复制到 currenttask 中，否则线程实际上都共享相同的变量。

```
<main thread>
var tasks = db.GetTasks();
foreach(var task in tasks) {
   var currenttask = task; 
   ThreadPool.QueueUserWorkItem(state => DoTask(currenttask));
   // or, new Thread(() => DoTask(currentTask)).Start()
   // ThreadPool.QueueUserWorkItem(state => DoTask(task)); this doesn't work!
} 
```

请注意，您不应该在主线程上使用 Thread.Sleep() 等待工作线程完成。如果使用线程池，您可以继续排队工作项，如果您想等待执行任务完成，您应该使用类似 AutoResetEvent 的东西来等待线程完成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T16:12:34.270

您似乎遇到了多线程编程的常见问题。它被称为[Race Condition](http://en.wikipedia.org/wiki/Race_condition)，您最好先对这个和其他多线程问题进行一些研究，然后再继续进行。快速弄乱所有数据非常容易。

简而言之，您必须确保对数据库的所有命令（例如：获取可用任务）都在单个事务的范围内执行。

我不太了解 MySQL，无法给出完整的答案，但是 T-SQL 的一个非常基本的示例可能如下所示：

```
BEGIN TRAN 
DECLARE @taskid int 
SELECT @taskid=taskid FROM tasks WHERE assigned = false
UPDATE tasks SET assigned=true WHERE taskid = @taskID 
SELECT * from tasks where taskid = @taskid 
COMMIT TRAN 
```

MySQL 5 及更高版本也[支持事务](http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-transactions.html)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T17:57:47.800

您还可以锁定“从数据库获取任务”代码，这样一次只有一个线程会查询数据库 - 但显然这会在一定程度上降低性能增益。

你正在做的一些代码（可能还有一些 SQL，这真的取决于）将是一个巨大的帮助。

但是，假设您要从 DB 中获取任务，并且这些任务在 C# 中需要一些时间，您可能想要这样的东西：

```
object myLock;

void StartWorking()
{
    myLock = new object(); // only new it once, could be done in your constructor too.
    for (int i = 0; i < Environment.Processorcount; i++)
    {
        ThreadPool.QueueUserWorkItem(null => DoWork());
    }
}

void DoWork(object state)
{
    object task;
    lock(myLock)
    {
        task = GetTaskFromDB();
    }

    PerformTask(task);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T18:10:51.630

上面贴了一些好主意。我们遇到的一件事是，我们不仅想要一个支持多处理器的应用程序，而且还想要一个支持多服务器的应用程序。根据您的应用程序，我们使用一个队列，该队列通过一个公共 Web 服务器被锁在一个锁中（导致其他人被阻止），同时我们得到下一个要处理的事情。

在我们的例子中，我们正在处理大量数据，为了保持单一，我们锁定了一个对象，获取下一个未处理项目的 id，将其标记为正在处理，解锁对象，将要处理的记录 id 交还给调用服务器上的主线程，然后处理它。这似乎对我们很有效，因为锁定、获取、更新和释放所花费的时间非常短，而且虽然确实发生了阻塞，但我们在等待资源时永远不会遇到死锁情况（因为我们正在使用 lock(object ) { } 和一个很好的 try catch 内部，以确保我们在内部优雅地处理错误。

如其他地方所述，所有这些都在主线程中处理。给定要处理的信息，我们将其推送到一个新线程（对我们来说，该线程会检索 100mb 的数据并在每次调用时对其进行处理）。这种方法使我们能够扩展到单个服务器之外。过去我们不得不通过高端硬件来解决问题，现在我们可以扔几台更便宜但仍然非常强大的服务器。我们还可以在低利用率期间通过我们的虚拟化场进行此操作。

我没有提到的另一件事是，我们还在存储过程中使用锁定互斥锁，因此如果两台服务器上的两个应用程序同时调用它，它会被优雅地处理。所以上面的概念适用于我们的应用程序和数据库。我们的客户端后端是 MySql 5.1 系列，只需要几行代码就可以完成。

我认为人们在开发时会忘记的一件事是，您希望相对快速地进出锁定。如果您想返回大块数据，除非您确实必须这样做，否则我个人不会在锁本身中执行此操作。否则，如果每个人都在等待获取数据，你就不能真正做很多多线程的事情。

好的，找到了我的 MySql 代码来做你需要的事情。

```
 DELIMITER //

    CREATE PROCEDURE getnextid(
        I_service_entity_id INT(11)
      , OUT O_tag VARCHAR(36)
    )

    BEGIN
      DECLARE L_tag VARCHAR(36) DEFAULT '00000000-0000-0000-0000-000000000000';
      DECLARE L_locked INT DEFAULT 0;

      DECLARE C_next CURSOR FOR
        SELECT tag FROM workitems
        WHERE status in (0)
          AND processable_date <= DATE_ADD(NOW(), INTERVAL 5 MINUTE)
        ;

      DECLARE EXIT HANDLER FOR NOT FOUND
      BEGIN
        SET L_tag := '00000000-0000-0000-0000-000000000000';
        DO RELEASE_LOCK('myuniquelockis');
      END;

      SELECT COALESCE(GET_LOCK('myuniquelockis',20), 0) INTO L_locked;
      IF L_locked > 0 THEN
        OPEN C_next;
        FETCH C_next INTO I_tag;
        IF I_tag <> '00000000-0000-0000-0000-000000000000' THEN
          UPDATE workitems SET
              status = 1
            , service_entity_id = I_service_entity_id
            , date_locked = NOW()
          WHERE tag = I_tag;

        END IF;
        CLOSE C_next;
        DO RELEASE_LOCK('myuniquelockis');
      ELSE
        SET I_tag := L_tag;
      END IF;
    END
    //

    DELIMITER ; 
```

在我们的例子中，我们将 GUID 作为输出参数返回给 C#。您可以用 SELECT L_tag 替换末尾的 SET；并完成它并释放 OUT 参数，但我们从另一个包装器调用它......

希望这可以帮助。

# maven-2 - 根据当前模块激活不同的 Maven 配置文件？

> ID：1018720
> 
> 赞同：2
> 
> 时间：2009-06-19T15:52:06.317
> 
> 标签：maven-2, profile

我们有一个多模块构建，其中包含使用不同技术（如 Java 和 Flex）的模块。是否可以根据当前编译的模块激活不同的配置文件？

我尝试过像这样的激活

```
<profile>
  <id>flex</id>
  <activation>
    <file>
      <exists>${basedir}/src/main/flex</exists>
    </file>
  </activation>
  ...
</profile 
```

但它不起作用，尽管 ${basedir} 的使用[记录在 Maven 文档中](http://maven.apache.org/pom.html#Activation)（这是 Maven 中的一个错误）。基于当前模块是否有不同的激活方式？或者 Maven 是否只允许激活所有模块的配置文件或根本不允许？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-23T12:39:46.077

经过更多研究，我终于得出结论，在当前的 Maven 版本（2.1.0）中，这有两个原因是不可能的：

*   Maven 配置文件不是继承的，因此您不能在父 POM 中定义配置文件并在子 POM 中激活它。
*   我还没有找到从 POM 本身激活配置文件的可能性。激活不适用于 ${basedir} 并且属性激活仅响应系统设置，这些设置是通过 -D 选项全局指定的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-16T19:18:51.310

在 2.2.1 中，配置文件被继承，但 ${basedir} 问题仍然存在。我在同一条船上 - 我需要根据给定项目中文件的存在来激活配置文件。我的孩子构建单独运行很好（由本地文件存在激活的继承配置文件），但如果我从顶级父级运行构建，它们会失败，因为找不到文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-01T10:00:46.797

对于像我这样阅读这个问题以寻找答案的人来说，这个用例现在可以在 Maven 3 中使用。

在 3 的早期版本中存在一个影响此功能的错误（请参阅[http://jira.codehaus.org/browse/MNG-2363](http://jira.codehaus.org/browse/MNG-2363)），但它适用于我正确使用 Maven 3.0.4。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T10:54:27.257

关于基于文件的激活，您可以尝试删除 ${basedir}。我们像这样使用它：

```
<activation>
   <file>
      <missing>target/jboss/conf/jboss-service.xml</missing>
   </file>
</activation> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-12T13:22:34.407

我不知道这是否有帮助，但我用以下方法解决了类似的问题：

1.  我在父 POM 中创建并描述了配置文件，它具有`activeByDefault=false`. PluginManagement-Section 然后包含不同插件的配置。
2.  孩子们可以重用这个配置文件，并设置`activeByDefault=true` This 使配置文件处于活动状态，但仍然没有激活任何插件。
3.  但幸运的是，所描述的插件配置是可用的。您可以通过在 Plugins-Section 中定义它们来在子项中重用它们。您只需提供组和 artifactID，并`inherited=true`为您要在子级中重用的每个插件进行设置。

我希望这会有所帮助。很抱歉没有包含任何代码片段，但我希望即使如此，这些解决方案也是可以理解的。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-06-19T19:11:03.293

您可以在要使用配置文件的每个模块中设置一个属性，然后在您的配置文件中使用“属性”激活。

# facebook - Facebook 应用维护注意事项

> ID：1018723
> 
> 赞同：1
> 
> 时间：2009-06-19T15:53:12.227
> 
> 标签：facebook, maintenance, fbml

如果我为客户编写 Facebook 应用程序（我可能是与营销机构合作的“开发人员”，将一个或多个 Facebook 应用程序作为社交媒体策略的市场），这不仅仅是一个“一劳永逸”的项目，是它？

从我目前所读到的内容来看，Facebook API 仍在不断变化，Facebook 所做的修复和更改可能会破坏应用程序。因此，为客户开发 Facebook 应用程序的业务方面可能包括对该应用程序的一些持续监控和沿途的修复，以及跟踪托管成本和问题。

对于现在使用 Facebook 应用程序的人来说，您的应用程序多久崩溃一次？您采取了哪些防御措施来防止破损？

对于开发规划，开发时间与维护时间的比例是多少？在商业方面，您会在发生维护时收取维护费用还是每月收取固定费用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T17:27:20.490

这当然不是一个“一劳永逸”的项目。

Facebook 不断推出新功能，弃用现有功能，并改变许多关键平台概念的工作流程。

我会说应用程序每 2-3 个月“中断”一次，尽管它们何时推出更改确实无法预测。对于某些应用程序，Facebook 的更改不会立即对应用程序产生影响，但会为扩展现有功能创造机会。有时中断只会影响后端进程的一部分，不会立即对用户产生影响。但是，有时，应用程序可能会变得完全无法访问，或者关键功能可能会停止工作。

至于预防措施，最好的办法是及时了解 Facebook 平台公告，这些公告发布在开发者应用程序留言板上。通常会提前 30 到 60 天宣布更改，并且通常会更早地传出消息。一旦他们做出更改，Facebook 通常还会保留对任何已弃用功能的支持一个月，以便每个人都有时间进行更改、测试、故障排除等。所以说真的，到最后，当你的应用程序“破坏”你的时候将有足够的时间来容纳。

我的建议是根据需要按更新收费。作为开发人员，您应该紧跟公告，以保持精明。当 Facebook 宣布更改时，我个人会让我的所有客户知道，以便他们提前了解所需的任何工作，并且通常会包含我的报价，以便对他们的应用程序进行必要的更改。如果客户在更改推出时没有采取行动，我会发出提醒。这样，当应用程序真正“崩溃”时，已经有足够的警告了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-22T17:04:22.770

这还有另一个方面。Facebook 几乎每个月都会改变它的用户界面。通常，一个很棒的新应用程序概念或 UI 设计会变得笨拙或愚蠢，因为 Facebook 只是改变了平台的某些方面。例如，任何 FB 应用程序最重要的功能就是在墙上发帖。在过去 6 个月中，围绕此功能的用户界面、api 和策略已更改 3 次。这些设计更改是跟上扎克伯格一家最困难和最昂贵的方面。

根据我们的经验，大多数客户不想注册维护 Facebook 应用程序。他们的预算很小且基于广告系列，因此在一两个月后，他们不再关心该应用程序。我们努力改变态度，但它仍然是我们一次又一次遇到的一堵墙。

# python - tkinter 文本输入验证

> ID：1018729
> 
> 赞同：1
> 
> 时间：2009-06-19T15:54:36.317
> 
> 标签：python, tkinter

我正在尝试使用 Python/tkInter 验证文本的输入

```
def validate_text():
    return False

text = Entry(textframe, validate="focusout", validatecommand=validate_text) 
```

其中 validate_text 是函数-我尝试过总是返回 False 并且总是返回 True 并且结果没有区别..？我需要在函数中包含一组参数吗？

编辑 - 从 NONE 更改为 focusout ...仍然无法正常工作

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-02T22:13:34.433

我认为您唯一缺少的是`invalidcommand (or invcmd)`. 如果 validatecommand（或 vcmd）返回 false，您期望它做什么？根据 Tk 手册（见下文），如果 vcmd 返回 False 并且 validate*未*设置为 none，则将调用 invcmd。invcmd 的典型命令是 Tkinter.bell，它会发出 ding 的声音。另请注意，vcmd 和 invcmd 非常*敏感*，如果它们遇到异常、如果小部件在 vcmd 或 invcmd 函数内以任何方式更改或者如果 vcmd 没有返回有效的 Tcl 布尔值，它们会将 validate 变为“none”。特别是 textvariable 因引起问题而臭名昭著，[Entry 中名为 valdation 的部分](http://www.tcl.tk/man/tcl/TkCmd/entry.htm#M7)专门处理了这个问题。

以下是 Tk 命令条目中的相关部分（与 Spinbox 相同）。有关更多参考，请参见下文。

> 命令行名称：`-validatecommand or -vcmd`
> 数据库名称：`validateCommand`
> 数据库类：`ValidateCommand`
> 指定要在您想要验证输入小部件的输入时评估的脚本。将其设置为 {} 会禁用此功能（默认设置）。该命令必须返回一个有效的 Tcl 布尔值。如果它返回 0（或有效的 Tcl 布尔等效值），则意味着您拒绝新版本并且它不会发生，并且如果设置了 invalidCommand 将被评估。如果它返回 1，则出现新版本。有关详细信息，请参阅下面的验证。
> 
> 命令行名称：`-invalidcommand or -invcmd`
> 数据库名称：`invalidCommand`
> 数据库类：`InvalidCommand`
> 指定在 validateCommand 返回 0 时要评估的脚本。将其设置为 {} 将禁用此功能（默认设置）。此选项的最佳用途是将其设置为 bell。有关详细信息，请参阅下面的验证。

查看[这个 SO 答案](https://stackoverflow.com/a/4140988/1020470)、[Tk 命令](http://www.tcl.tk/man/tcl/)和[epydoc-Tkinter](http://epydoc.sourceforge.net/stdlib/Tkinter-module.html)以获得更多参考。

这个问题有很多重复。 [Python tkInter Entry fun](https://stackoverflow.com/a/4372831/1020470)
[限制 Tkinter Entry 小部件中的值](https://stackoverflow.com/a/8960839/1020470)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-06-12T05:10:07.740

您应该注册您的验证功能。

```
def validate_text():
    return False

textframe.register(validate_text)
text = Entry(textframe, validate="focusout", validatecommand=validate_text) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-12T03:13:48.693

`focusout`意味着 validatecommand 将仅在您将焦点从 entrywidget 中取出时才会被调用。

您可以在键入时尝试“键”进行验证。

Tcl 手册：
通过将 validateCommand 选项设置为脚本来进行验证，该脚本将根据 validate 选项进行评估，如下所示：

*   无
    默认值。这意味着不会发生验证。

*   focus
    validateCommand 将在条目接收或失去焦点时调用。

*   focusin
    validateCommand 将在条目获得焦点时调用。

*   focusout
    validateCommand 将在条目失去焦点时调用。

*   编辑条目时将调用key validateCommand。

*   所有
    validateCommand 将针对上述所有条件调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T15:58:21.433

“请注意，此选项 [validatecommand] 仅在 validate 选项不是 NONE 时使用”

来自[http://effbot.org/tkinterbook/entry.htm#entry.Entry.config-method](http://effbot.org/tkinterbook/entry.htm#entry.Entry.config-method)

# c# - 使用反射查找 [XmlAttribute("IWantThisValueRightHere")]

> ID：1018733
> 
> 赞同：0
> 
> 时间：2009-06-19T15:55:38.920
> 
> 标签：c#, reflection

我有一个具有一些基本属性的类...

```
[XmlAttribute("MyFirstProperty")]
public string FirstProperty { get; set; }

[XmlAttribute("MySecondProperty")]
public string SecondProperty { get; set; } 
```

使用反射，我可以枚举公共属性并获取上述每个属性的 PropertyInfo 对象......我现在唯一需要的是一种方法：

1.  检测属性是否具有 XmlAttribute（我认为这可以通过 PropertyInfo.IsDefined(typeof(XmlAttribute), true) 工作，但想确保）
2.  获取 XmlAttribute 的字符串值

这是怎么做到的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T16:01:51.680

```
 object[] attribs = myPropertyInfo.GetCustomAttributes(typeof(XmlAttribute),false);
 bool doesPropertyHaveAttrib =attribs.Length > 0; 
 string name = (XmlAttribute)(attribs[0].AttributeName); 
```

乔尔在评论中说的很好。我的错。固定的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-10T08:15:24.783

我意识到这是一个老问题。今天偶然发现了同样的问题，这里提供的解决方案都没有奏效。尤其是看到建议的解决方案如何`Attribute.GetCustomAttributes(typeof(XmlAttribute),false)` 引发异常，因为 XmlAttribute 不是从 System.Attribute 派生的。相反，您应该检查`XmlAttributeAttribute`.

为了将来参考，这是使用反射检查 XmlAttribute 的正确且有效的方法：

```
PropertyInfo[] objProperties = obj.GetProperties();

foreach (var prop in objProperties)
{
Attribute[] propXmlAttr = Attribute.GetCustomAttributes(prop, typeof(XmlAttributeAttribute), false);
if (propXmlAttr.Length > 0)
     string myAttribute = propValue.ToString());
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:06:52.400

我目前使用这种方法：

'获取属性

```
 Dim pi() As PropertyInfo = arguments.SourceObject.GetType.GetProperties(BindingFlags.Instance Or BindingFlags.Static Or BindingFlags.Public Or BindingFlags.GetProperty) 
```

'获取属性的属性

暗点作为 PropertyInfo=pi(0)

```
 Dim vobj() As Object = pitem.GetCustomAttributes(GetType(ValidationSettingsBaseAttribute), False)

          Dim attr As ValidationSettingsBaseAttribute= TryCast(vobj(0), ValidationSettingsBaseAttribute) 
```

# ms-word - Word VSTO 在不调试的情况下在运行时吞下异常？

> ID：1018745
> 
> 赞同：18
> 
> 时间：2009-06-19T15:59:01.587
> 
> 标签：ms-word, vsto

将此代码放置在 ThisDocument_Startup 之外的 Word 文档级别 VSTO 解决方案中的某个位置（创建一个功能区按钮，带有一个单击事件）：

```
int zero = 0;
int divideByZero = 10 / zero; 
```

开始不调试（Ctrl + F5），结果：异常被吞下，其余代码静默失败。

如果将异常放置在 ThisDocument_Startup 中，则该异常*将*可见，但不会出现在其他任何地方。微软的 VSTO 论坛和 MSDN 文档似乎都觉得 Try...Catch 应该被使用——这对于已知的未知数来说没什么大不了的。未知的未知数呢？

处理托管代码的未处理异常的所有常见方法似乎都不起作用，大概是因为 VSTO 将托管代码与 Office COM 互操作一起使用：

```
//These don't work
AppDomain.CurrentDomain.UnhandledException ...
System.Windows.Forms.Application.ThreadException ... 
```

我已经阅读了有关故障排除 VSTO 代码的帖子，这些帖子似乎总是导致将 Try...Catch 几乎所有内容！

有没有更好的方法来处理已知和未知（现在是不可见和无声的！）故障？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-05-22T23:56:04.573

其实很简单，在运行office应用程序之前将环境变量VSTO_SUPPRESSDISPLAYALERTS设置为0，然后Office会在启动过程中显示异常并且在出现问题时不会杀死你的加载项。

还有一个有用的 powershell 脚本可以为你做这些事情，并且在确定 VSTO 何时不工作时很方便[http://archive.msdn.microsoft.com/vstotroubleshooter](http://archive.msdn.microsoft.com/vstotroubleshooter) 通过运行开始`vstotroubleshooter.ps1 setdbg`，它将设置 VSTO_SUPPRESSDISPLAYALERTS 环境为你变数

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-30T17:15:13.903

我认为该问题仅与“加载项用户界面”周围的异常有关-恰好是此处的直接设置（Word 2007）：

Word 选项 > 高级 > 常规 > “显示加载项用户界面错误”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-03T22:24:09.990

我在 Word 中的应用程序级加载项也遇到了同样的问题。

如果您通过使用 F5 从 Visual Studio 启动加载项来运行加载项，那么您将始终在 VS（例如 2008 SP1）中获得“未处理的用户代码”，除非：

*   取消选中 CLR 异常的 Visual Studio 设置“当异常是 .. 用户未处理时中断”，或者

*   您可以自由地应用 [System.Diagnostics.DebuggerNonUserCodeAttribute()] 注释。

一旦你完成了其中的一项，UnhandledException/ThreadException 似乎就可以工作了。

# iphone - 完全隐藏状态栏

> ID：1018748
> 
> 赞同：2
> 
> 时间：2009-06-19T15:59:36.783
> 
> 标签：iphone, cocoa-touch

我使用隐藏 applicationDidFinishLaunching 中的状态栏

```
[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO]; 
```

除了在加载应用程序时状态栏在那里之外，它工作正常。意思是，当显示 default.png 时，我会看到状态栏。有没有办法让状态栏根本不显示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-03-12T20:10:37.347

将 UIStatusBarHidden 添加到您的 info.plist 文件中，设置为 true。此处的文档：

[http://developer.apple.com/library/ios/ipad/#documentation/general/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html](http://developer.apple.com/library/ios/ipad/#documentation/general/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-12T20:03:54.553

你需要使用这个：

```
[[UIApplication sharedApplication] setStatusBarHidden:YES]; 
```

然后打开 info.plist 文件，新建一行，选择**Status bar is initial hidden**并将其设置为 true。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-16T16:54:14.977

您需要编辑 Info.plist 以包含“状态栏最初隐藏”条目并将值设置为 YES。

![在此处输入图像描述](../Images/f122d2c582d247d58de0b871f22df678.png)

欲了解更多信息： [http ://www.idev101.com/code/User_Interface/StatusBar.html](http://www.idev101.com/code/User_Interface/StatusBar.html)

# windows - 文件复制期间显示的预期时间是最佳时间还是最差时间？

> ID：1018749
> 
> 赞同：1
> 
> 时间：2009-06-19T15:59:40.073
> 
> 标签：windows, file, copy-paste

当我们在 windows 中复制文件时，我们会得到一个预期的完成时间。那个时候是最好的时间还是最坏的时间？你还假设环境变量吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:17:28.903

对此，陈瑞峰有[话要说](http://blogs.msdn.com/oldnewthing/archive/2004/01/06/47937.aspx)……

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:20:08.997

如果你实现了这样的功能，让进度条快速增长到 90%。然后，无论需要多长时间，您都可以执行真正的工作。用户体验将比显示当前进度要好得多；-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:20:52.820

我只能猜测，时间是如何计算的。但是花了很多时间观察复制窗口并查看时间估计如何变化，这是我的最佳估计：

*   Windows 正在保留所有要复制的文件的列表
*   它正在跟踪已复制文件的时间和数量
*   剩余时间计算如下：
    *   到目前为止每个文件的平均时间 = 到目前为止经过的时间 / 已经复制的文件
    *   所有文件所需的估计时间 = 每个文件的平均时间 * 文件数。

在经过固定的时间跨度后重复计算（可能是 5 秒，也可能是 30 秒？）

我上面解释的可能有点复杂，我想当前正在复制的文件的大小以及已复制的百分比也会进入计算。这可以解释为什么我们在只复制一个文件时看到估计值 ;-)。

因此，直接回答您的问题：这既不是最好的时间也不是最坏的时间，它只是一个非常弱的估计，文件大小彼此之间的差异越大，越不准确。

或者换句话说：这可能是程序员可以想到的实现特定功能的最快方式（就快速编程以及运行时的低 CPU 使用率而言）。如果它是在星期五下午编码的，我不会感到惊讶...

# java - 如何在Java中将对象数组转换为字符串数组

> ID：1018750
> 
> 赞同：266
> 
> 时间：2009-06-19T16:00:04.210
> 
> 标签：java, arrays, string

我使用以下代码将 Object 数组转换为 String 数组：

```
Object Object_Array[]=new Object[100];
// ... get values in the Object_Array

String String_Array[]=new String[Object_Array.length];

for (int i=0;i<String_Array.length;i++) String_Array[i]=Object_Array[i].toString(); 
```

但我想知道是否有另一种方法可以做到这一点，比如：

```
String_Array=(String[])Object_Array; 
```

但这会导致运行时错误：`Exception in thread "AWT-EventQueue-0" java.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [Ljava.lang.String;`

正确的方法是什么？

* * *

## 回答 #1

> 赞同：397
> 
> 时间：2009-06-19T16:11:44.270

另一种选择`System.arraycopy`：

```
String[] stringArray = Arrays.copyOf(objectArray, objectArray.length, String[].class); 
```

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2014-04-20T01:46:37.090

在 Java 8 中：

```
String[] strings = Arrays.stream(objects).toArray(String[]::new); 
```

要转换其他类型的数组：

```
String[] strings = Arrays.stream(obj).map(Object::toString).
                   toArray(String[]::new); 
```

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2009-06-19T16:08:05.283

System.arraycopy 可能是最有效的方法，但为了美观，我更喜欢：

```
 Arrays.asList(Object_Array).toArray(new String[Object_Array.length]); 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2012-11-30T14:25:34.373

我看到已经提供了一些解决方案，但没有任何原因，所以我将详细解释这一点，因为我相信知道你做错了什么与从给定的回复中获得“有用的东西”同样重要。

首先，让我们看看Oracle有什么要说的

```
 * <p>The returned array will be "safe" in that no references to it are
 * maintained by this list.  (In other words, this method must
 * allocate a new array even if this list is backed by an array).
 * The caller is thus free to modify the returned array. 
```

它可能看起来并不重要，但正如您所看到的那样......那么下面这行失败了什么？列表中的所有对象都是字符串，但它不会转换它们，为什么？

```
List<String> tList = new ArrayList<String>();
tList.add("4");
tList.add("5");
String tArray[] = (String[]) tList.toArray(); 
```

可能很多人会认为这段代码在做同样的事情，但事实并非如此。

```
Object tSObjectArray[] = new String[2];
String tStringArray[] = (String[]) tSObjectArray; 
```

实际上，编写的代码正在做这样的事情。javadoc是这么说的！它将创建一个新数组，它将是什么对象！！！

```
Object tSObjectArray[] = new Object[2];
String tStringArray[] = (String[]) tSObjectArray; 
```

所以 tList.toArray 正在实例化一个对象而不是字符串......

因此，这个线程中没有提到但Oracle推荐的自然解决方案如下

```
String tArray[] = tList.toArray(new String[0]); 
```

希望它足够清楚。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-06-19T16:08:49.857

google collections 框架提供了一个很好的转换方法，因此您可以将您的对象转换为字符串。唯一的缺点是它必须从 Iterable 到 Iterable 但这是我会这样做的方式：

```
Iterable<Object> objects = ....... //Your chosen iterable here
Iterable<String> strings = com.google.common.collect.Iterables.transform(objects, new Function<Object, String>(){
        String apply(Object from){
             return from.toString();
        }
 }); 
```

这使您不再使用数组，但我认为这将是我的首选方式。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-06-19T16:14:31.913

这个很好，但不像 mmyers 注意到的那样工作，因为方括号：

`Arrays.toString(objectArray).split(",")`

这个很丑但有效：

`Arrays.toString(objectArray).replaceFirst("^\\[", "").replaceFirst("\\]$", "").split(",")`

如果使用此代码，则必须确保对象的 toString() 返回的字符串不包含逗号。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-19T16:11:51.073

如果您想获取数组中对象的字符串表示形式，那么是的，没有其他方法可以做到这一点。

如果你知道你的对象数组只包含字符串，你也可以这样做（调用 toString() 的方法）：

```
for (int i=0;i<String_Array.length;i++) String_Array[i]= (String) Object_Array[i]; 
```

您可以使用转换为 Object_Array 的 String[] 的唯一情况是，如果它引用的数组实际上被定义为 String[] ，例如这会起作用：

```
 Object[] o = new String[10];
    String[] s = (String[]) o; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-11-24T00:05:00.057

对于您的想法，实际上您正在接近成功，但是如果您这样做应该没问题：

```
for (int i=0;i<String_Array.length;i++) String_Array[i]=(String)Object_Array[i]; 
```

顺便说一句，使用 Arrays 实用方法非常好，并且使代码优雅。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-05-23T15:29:46.033

您可以使用[类型转换器](https://github.com/jsolve/type-converter)。要将任何类型的数组转换为字符串数组，您可以注册自己的转换器：

```
 TypeConverter.registerConverter(Object[].class, String[].class, new Converter<Object[], String[]>() {

        @Override
        public String[] convert(Object[] source) {
            String[] strings = new String[source.length];
            for(int i = 0; i < source.length ; i++) {
                strings[i] = source[i].toString();
            }
            return strings;
        }
    }); 
```

并使用它

```
 Object[] objects = new Object[] {1, 23.43, true, "text", 'c'};
   String[] strings = TypeConverter.convert(objects, String[].class); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-01-07T06:53:26.753

```
Object arr3[]=list1.toArray();
   String common[]=new String[arr3.length];

   for (int i=0;i<arr3.length;i++) 
   {
   common[i]=(String)arr3[i];
  } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-12-10T11:23:39.627

轻松更改，无需任何麻烦 将任何对象数组转换为字符串数组 Object drivex[] = {1,2};

```
 for(int i=0; i<drive.length ; i++)
        {
            Str[i]= drivex[i].toString();
            System.out.println(Str[i]); 
        } 
```

# excel-2007 - 如何在 Excel 2007 中关闭 R1C1 引用样式

> ID：1018751
> 
> 赞同：2
> 
> 时间：2009-06-19T16:00:07.703
> 
> 标签：excel-2007, excel, vba

我正在使用excel-2007。我想看看 R1C1 的东西，然后我检查了“R1C1 参考样式”（office 按钮-> Excel 选项-> 公式-> R1C1 参考样式）...

现在我想再次回到 xlA1 样式，我取消选中 R1C1 参考样式，但我的宏仍然以 R1C1 样式编写......我怎样才能切换到 xlA1 参考样式，以便我的宏再次以 xlA1 样式编写？谢谢

我再次尝试录制宏它不起作用！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T17:15:07.120

您将不得不手动编辑代码 [scratch out] 或再次录制宏 [/scratch out]。

* * *

编辑：

**Office 按钮>Excel 选项>公式>R1C1 参考样式**选项仅适用于参考样式，因为它出现在电子表格的单元格中。

在 R1C1 参考样式***关闭***的情况下，我录制了一个宏，其中最初选择了单元格“A2”。刻录机启动后，我在“A2”中输入以下论坛：**=A1+12**，按回车键停止刻录机。记录的代码是：

```
ActiveCell.FormulaR1C1 = "=R[-1]C+12"
Range("A3").Select 
```

使用 R1C1 参考样式***，***代码看起来完全一样：

```
ActiveCell.FormulaR1C1 = "=R[-1]C+12"
Range("A3").Select 
```

原因是宏记录器总是将公式存储在***ActiveCell 对象的******FormulaR1C1 属性***中。

 *必须手动编辑这样的代码以采用 xlA1 样式：

```
ActiveCell.FormulaR1C1 = Range("A1").Value + 12 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-05-16T08:47:59.603

进入文件菜单->选项->公式->然后取消选中r1c1参考样式*

# macos - 在 OS X 上安装 readline 6.0

> ID：1018752
> 
> 赞同：7
> 
> 时间：2009-06-19T16:00:28.407
> 
> 标签：macos, installation, readline

我正在尝试从源代码安装 readline 6，但在“make install”期间遇到错误。

这是执行“sudo make install”后输出的结尾

```
( cd shlib ; make  DESTDIR= install )
/bin/sh ../support/mkdirs /usr/local/lib
/bin/sh ../support/shlib-install -O darwin9.7.0 -d /usr/local/lib -b /usr/local/bin -i "/usr/bin/install -c -m 644" libhistory.6.0.dylib
/bin/sh ../support/shlib-install -O darwin9.7.0 -d /usr/local/lib -b /usr/local/bin -i "/usr/bin/install -c -m 644" libreadline.6.0.dylib
install: you may need to run ldconfig 
```

我知道`ldconfig`在 OS X 上默认没有安装它，我在某处读到它不应该用来解决这个问题。我相信它与动态库有关，但我一直无法找到解决问题的方法，有人有任何见解吗？

仅供参考，我在英特尔 2.4ghz macbook 上运行 OS X

谢谢

PS 在运行 configure 和 make 之前，我还应用了 3 个可用的 readline 6 补丁

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-19T16:04:05.643

实际上，这根本不是错误......它只是安装结束时的通知消息。它也得到了这个，我的 readline 6 很高兴地安装了。

如果你检查`/usr/local/lib`并看到那里的 readline，你就完成了 :-) 不需要运行任何等效的 ldconfig。

```
$ ls /usr/local/lib | grep readline
libreadline.6.0.dylib
libreadline.6.dylib
libreadline.a
libreadline.dylib 
```

# security - 围绕 JSON 响应的注释块

> ID：1018763
> 
> 赞同：8
> 
> 时间：2009-06-19T16:03:19.247
> 
> 标签：security, json

我注意到一些 Web 应用程序返回的 AJAX 响应带有嵌入在注释块中的 JSON 数据。例如，这将是一个示例响应：

```
/*{
 "firstName": "John",
 "lastName": "Smith",
 "address": {
     "streetAddress": "21 2nd Street",
     "city": "New York",
     "state": "NY",
     "postalCode": 10021
 },
 "phoneNumbers": [
     "212 555-1234",
     "646 555-4567"
 ]} */ 
```

将 JSON 数据嵌入注释块有什么好处？这样做是否可以避免某种安全漏洞？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T17:25:42.177

这样做是为了避免第三方网站使用`<script>`标签劫持您的数据并覆盖`Object`构造函数以在构建数据时获取数据。

当 JSON 数据被注释包围时，它不再可以通过`<script>`标签直接执行，因此“更安全”。

[请参阅http://www.fortifysoftware.com/servlet/downloads/public/JavaScript_Hijacking.pdf](http://www.fortifysoftware.com/servlet/downloads/public/JavaScript_Hijacking.pdf)上的 PDF了解更多信息（带有示例）

# asp.net - 当我将 .NET 通配符映射添加到目录时，为什么无法在经典 ASP 中获取应用程序对象？

> ID：1018764
> 
> 赞同：0
> 
> 时间：2009-06-19T16:03:26.610
> 
> 标签：asp.net, asp-classic, mapping, wildcard

我们正在将站点从经典 asp 迁移到 .NET。在此过程中，我需要使用 .NET 身份验证来保护经典的 asp 页面。这适用于通配符映射...除非经典的 asp 页面尝试使用类似 Application 对象的东西。

我尝试添加一个 HTTPHandler 将请求传递给 asp.dll，但无济于事。

我想要做的甚至可能吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T16:06:02.850

您是否试图将一些旧的“经典”asp 页面与 .aspx 页面放在同一个站点中？我们在这里做了类似的事情，但我们最终建立了两个网站，一个用于 asp，一个用于 .net，并进行了一些会话共享以执行身份验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-23T15:01:05.527

在 IIS7 上使用集成管道是可能的，我想说在 IIS6 上使用通配符映射会非常脆弱。

# iphone - 如何确定 iPhone 摇晃的方向

> ID：1018770
> 
> 赞同：4
> 
> 时间：2009-06-19T16:04:25.380
> 
> 标签：iphone, accelerometer

我正在使用加速度计滚动 UIScrollVIew 中的多个子视图。我希望当用户将 iPhone 向右滑动时视图（纵向）向右滚动，当设备向左滑动时向左滚动。

我认为我可以通过记录正或负 x 加速度值来做到这一点，但我发现这些值通常是正值和负值的混合。我已将地板设置为 1.5g 以消除非抖动运动，并在 0.5 秒的时间内查看 x 值。

我确信有一种三角方法可以确定轻弹的整体方向，并且您必须在轻弹运动的持续时间内测量值。我也确信有人已经弄清楚了这一点。

有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2015-03-13T11:24:42.443

我开发了一个解决方案，它比建议的解决方案给我更好的反馈（仅适用于左右摇晃）。我在这里做的方式非常敏感（识别出轻微的震动），但是可以通过更改 tresholdFirstMove 和 tresholdBackMove 来调整灵敏度（增加以降低灵敏度）

在 Swift 中：（在您的 viewController 中。并添加“import CoreMotion”）

```
var startedLeftTilt = false
var startedRightTilt = false
var dateLastShake = NSDate(timeIntervalSinceNow: -2)
var dateStartedTilt = NSDate(timeIntervalSinceNow: -2)
var motionManager = CMMotionManager()
let tresholdFirstMove = 3.0
let tresholdBackMove = 0.5

override func viewDidLoad() {
    // your code

    motionManager.gyroUpdateInterval = 0.01
}

override func viewDidAppear(animated: Bool) {
    super.viewDidAppear(animated)

    motionManager.startGyroUpdatesToQueue(NSOperationQueue.currentQueue(), withHandler: { (gyroData, error) -> Void in
        self.handleGyroData(gyroData.rotationRate)
    })

}

private func handleGyroData(rotation: CMRotationRate) {

    if fabs(rotation.z) > tresholdFirstMove && fabs(dateLastShake.timeIntervalSinceNow) > 0.3
    {
        if !startedRightTilt && !startedLeftTilt
        {
            dateStartedTilt = NSDate()
            if (rotation.z > 0)
            {
                startedLeftTilt = true
                startedRightTilt = false
            }
            else
            {
                startedRightTilt = true
                startedLeftTilt = false
            }
        }
    }

    if fabs(dateStartedTilt.timeIntervalSinceNow) >= 0.3
    {
        startedRightTilt = false
        startedLeftTilt = false
    }
    else
    {
        if (fabs(rotation.z) > tresholdBackMove)
        {
            if startedLeftTilt && rotation.z < 0
            {
                dateLastShake = NSDate()
                startedRightTilt = false
                startedLeftTilt = false

                println("\\\n Shaked left\n/")
            }
            else if startedRightTilt && rotation.z > 0
            {
                dateLastShake = NSDate()
                startedRightTilt = false
                startedLeftTilt = false

                println("\\\n Shaked right\n/")
            }
        }
    }

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T17:19:42.153

好的，想出了一个解决方案。当我检测到抖动运动（x 轴上的加速度大于 1.5）时，我启动一个计时器并将 BOOL 设置为 true。虽然 BOOL 为真，但我添加了加速度值。当计时器到期时，我停止添加加速度值并通过总加速度的符号确定震动的方向。

```
 - (void)accelerometer:(UIAccelerometer *)acel didAccelerate:(UIAcceleration *)aceler {

    if (fabsf(aceler.x) > 1.5)
    {
        shake = YES;
        NSTimeInterval myInterval = .75;
        [NSTimer scheduledTimerWithTimeInterval:myInterval target:self selector:@selector(endShake) userInfo:nil repeats:NO];
        return;
    }

    if(shake)
    {
        totalG += aceler.x;
    }
}

- (void) endShake {
    shake = NO;
    int direction;
    if (totalG isLessThan 0) direction = 1;
    if(totalG isGreaterThan 0) direction = -1;
    [self changePageByShake:direction];
    totalG = 0;
} 
```

注意：我无法在上面的代码块中正确格式化 < 和 > 符号，因此我用 isLessThan 和 isGreaterThan 替换了这些符号。

# tfs - 将任务与 TFS 合并

> ID：1018771
> 
> 赞同：3
> 
> 时间：2009-06-19T16:04:39.637
> 
> 标签：tfs

我正在使用 TFS 源代码控制，并修复了错误，当我签入我的更改时，我将签入与任务（代表错误）相关联。

现在，复杂的东西。我想将与该任务关联的更改合并到另一个分支中。

我在 Visual Studio 团队系统或 TFS 源代码控制资源管理器中找不到方法。

你知道任何其他可以提供帮助的工具吗？

我告诉你，如果我不能在 TFS 中做到这一点，那么 TFS 缺乏核心要求，因为我可以在免费的其他免费源代码控制中做到这一点。

感谢帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-22T13:58:53.803

您需要查找与错误关联的变更集#。或者找到为您包装此功能的 3rd 方工具。（如果你不关心处理所有边缘情况，写一篇大约需要 10 分钟）

本机 Merge 命令不允许您使用 bug #s 作为输入，因为 bug 可以与可能不连续的任意数量的变更集相关联。我的理解是 TFS 2010 在一些常见的场景中改进了这一点，但一般情况下是无法解决的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-08T13:23:22.643

TFS 允许合并变更集。

# csv - 是否有任何免费工具可以将超过 65000 个寄存器的文件从 DBF 格式转换为 CSV？

> ID：1018777
> 
> 赞同：4
> 
> 时间：2009-06-19T16:06:14.317
> 
> 标签：csv, import, dbf

我需要将一个非常大的文件从 DBF 格式转换为 CSV 格式。我已经尝试使用 Microsoft Excel 来完成这项工作，但问题是当我打开和导出文件时，我看不到超过 65500 个寄存器。

Microsoft Access 也无法打开该文件。

我在谷歌上找到了一些共享软件工具，搜索“DBF to CSV”。您是否尝试过其中任何一个非常大的文件？

此外，任何可以导出到 mysql 或 postgresql 数据库格式的解决方案都将受到欢迎。

提前感谢您的回复，最好的问候，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-30T20:35:24.700

[https://github.com/SocialExplorer/FastDBF](https://github.com/SocialExplorer/FastDBF)

“这里还包括一个读取 DBF 文件并输出 CSV 文件的小实用程序！”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T16:29:54.000

转到[http://www.the-oasis.net/ftpmaster.php3?content=ftputils.htm](http://www.the-oasis.net/ftpmaster.php3?content=ftputils.htm)

查找此文件 **dbx130.zip**

```
Bytes: 125,478 Date: 1993-03-22

dbMAX is an xBASE utility that will allow complete multi-user access
to any xBASE databases and indexes. The program uses a CUA-type menu
system with Brief(R)-style hot keys and can browse databases in up to
250 moveable, sizable windows. Almost every Clipper(R)/dBASE(R)
command is available, allowing dbMAX to replace the dBASE
Assist/Control Center or Computer Associates' DBU utility. dbMAX also
has a partially open architecture, allowing programmers to create
their own menus and operate on dbMAX internal data structures. 
```

此实用程序有一个 dos ui，但它允许您通过菜单上的**Copy**功能以 SDF 或 CSV 格式导出整个 dbf 表。我个人知道它可以处理包含 380 万行的文件，因此它应该能够处理您的表格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:22:13.317

使用 OpenOffice - 它是免费的，可以处理很多行。有了这么多行，您可能需要拆分文件，然后转换这些部分，然后重新组合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-20T14:20:56.833

OpenOffice 3.0 Calc 的最大行数为 65K。我尝试将一个大型 DBF 导入 OpenOffice 3.0 Base，但它把工作交给了 Calc :-(

替代方案：如果您有 Python 2.4 到 2.6，我可以向您发送我即将公开的 DBF 阅读模块的副本以及 DBF-to-CSV 脚本。要获取我的电子邮件地址，请搜索“John Machin xlrd”[xlrd 是我的 Excel XLS 阅读包]。

# asp.net - ASP.NET：将 DataTable 呈现为字符串 (HTML) 的最短方法？

> ID：1018785
> 
> 赞同：9
> 
> 时间：2009-06-19T16:08:34.520
> 
> 标签：asp.net, string, datatable

将 DataTable 转换为字符串（以 HTML 格式格式化）的最短方法是什么？

以编程方式绑定到 UI 控件并呈现到 ASP.NET 页面是不可接受的。不能依赖于 ASP.NET 页面生命周期。

这样做的目的无关紧要，但可以满足好奇心：这是为了在执行大量 DataTable 处理的算法中进行日志记录/调试/转储。

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-19T16:15:33.130

您可以使用 ASP.net 控件如 GridView、DataGrid 并使用 StringWriter 将它们渲染到 StringBuilder 中，无需为此使用 ASP.net 页面，这是控制台中的一个简单示例

```
class Program
{
    static void Main(string[] args)
    {
        IList<Person> persons = new List<Person>()
            {
               new Person{Id = 1, Name="Test Name 1"},
               new Person{Id = 2, Name="Test Name 2"}
            };

        GridView gridView = new GridView();
        StringBuilder result =  new StringBuilder();
        StringWriter writer = new StringWriter(result);
        HtmlTextWriter htmlWriter = new HtmlTextWriter(writer);
        gridView.DataSource = persons;
        gridView.DataBind();

        gridView.RenderControl(htmlWriter);

        Console.WriteLine(result);
    }

}

class Person
{
    public int Id { get; set; }
    public string Name { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-19T16:18:07.217

我通过我的应用程序使用此功能。这很简单

```
 static public string ConvertDataTableToHTMLString(System.Data.DataTable dt, string filter, string sort, string fontsize, string border, bool headers, bool useCaptionForHeaders)
        {

            StringBuilder sb = new StringBuilder();
            sb.Append("<table border='" + border + "'b>");
            if (headers)
            {
                //write column headings
                sb.Append("<tr>");
                foreach (System.Data.DataColumn dc in dt.Columns)
                {
                    if (useCaptionForHeaders)
                        sb.Append("<td><b><font face=Arial size=2>" + dc.Caption + "</font></b></td>");
                    else
                        sb.Append("<td><b><font face=Arial size=2>" + dc.ColumnName + "</font></b></td>");
                }
                sb.Append("</tr>");
            }

            //write table data
            foreach (System.Data.DataRow dr in dt.Select(filter,sort))
            {
                sb.Append("<tr>");
                foreach (System.Data.DataColumn dc in dt.Columns)
                {
                    sb.Append("<td><font face=Arial size=" + fontsize + ">" + dr[dc].ToString() + "</font></td>");
                }
                sb.Append("</tr>");
            }
            sb.Append("</table>");

            return sb.ToString();
        } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T16:14:03.083

创建控件，创建 HTML Writer，设置任何设置或数据绑定控件，然后使用 HTML Writer 调用 render 方法。

然后，您可以从编写器中取出字符串。

编辑：我最初误读了这个问题，并认为你想渲染一个数据网格。

Datatable 可以很容易地呈现为其 XML。

您要求提供 HTML。

这是一个控制台应用程序代码，它将使用数据网格控件呈现数据表。

```
class Program
{
    static void Main(string[] args)
    {
        DataTable dt = new DataTable();
        dt.Columns.Add("Column1");
        dt.Columns.Add("Column2");
        dt.Rows.Add("RowValue1", "Field2RowValue1");
        dt.Rows.Add("RowValue2", "Field2RowValue2");

        DataGrid dg = new DataGrid();
        dg.DataSource = dt;
        dg.DataBind();

        StringWriter sw = new StringWriter();
        HtmlTextWriter w = new HtmlTextWriter(sw);

        dg.RenderControl(w);

        Console.Write(sw.ToString());
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T16:19:52.507

如果这只是为了记录，那么将它们作为 XML 记录可能没有意义 - 如果需要，更容易操作。您只需要调用 WriteXml 方法。

# c# - 如何在 c#.net 中使用 PennySMS？

> ID：1018786
> 
> 赞同：0
> 
> 时间：2009-06-19T16:08:38.280
> 
> 标签：c#, sms

有人用过 PennySMS 的网络服务吗？（[https://www.pennysms.com/docs](https://www.pennysms.com/docs)）我在成功执行 HttpPost 请求时遇到了一些困难。

更新：我是网络服务的 n00b。我什至不知道我是否可以在服务器端完成这种类型的请求。我已经用示例信息替换了参数中的实际信息。

```
protected void bText_Click(object sender, EventArgs e)
 {
    string XML = "<?xml version=\"1.0\"?>"
                    +"<methodCall>"
                    +"<methodName>send</methodName>"
                    +"    <params>"
                    +"        <param>"
                    + "            <value><string>MY KEY</string></value>"
                    +"        </param>"
                    +"        <param>"
                    + "            <value><string>service@example.com</string></value>"
                    +"       </param>"
                    +"       <param>"
                    + "           <value><string>555555555</string></value>"
                    +"       </param>"
                    +"       <param>"
                    +"          <value><string>Test Message</string></value>"
                    +"      </param>"
                    +"  </params>"
                    +"</methodCall>";
    SendText("http://api.pennysms.com/xmlrpc", "XML");
}
public void SendText(string _URL, string _parameters)
{
    WebRequest request = WebRequest.Create(_URL);
    request.Method = "POST";
    string postData = _parameters;
    byte[] byteArray = Encoding.UTF8.GetBytes(postData);
    request.ContentType = "text/xml";
    request.ContentLength = byteArray.Length;
    Stream dataStream = request.GetRequestStream();
    dataStream.Write(byteArray, 0, byteArray.Length);
    dataStream.Close();
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-19T16:24:29.900

如果您使用的是 XML-RPC API，您是否检查过您的内容类型？它应该是“文本/xml”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T17:36:40.680

以下代码有效。我没有尝试优化任何东西。除非服务器限制传出连接，否则您可以使用此服务器端。

```
 protected static string DoRequest()
    {
        string XML = "<?xml version=\"1.0\"?>"
            +"<methodCall>"
            +"<methodName>send</methodName>"
            +"    <params>"
            +"        <param>"
            + "            <value><string>MY KEY</string></value>"
            +"        </param>"
            +"        <param>"
            + "            <value><string>service@example.com</string></value>"
            +"       </param>"
            +"       <param>"
            + "           <value><string>555555555</string></value>"
            +"       </param>"
            +"       <param>"
            +"          <value><string>Test Message</string></value>"
            +"      </param>"
            +"  </params>"
            +"</methodCall>";
        return SendText("http://api.pennysms.com/xmlrpc", XML);
    }
    public static string SendText(string _URL, string _parameters)
    {
        WebRequest request = WebRequest.Create(_URL);
        request.Method = "POST";
        string postData = _parameters;
        byte[] byteArray = Encoding.UTF8.GetBytes(postData);
        request.ContentType = "text/xml";
        request.ContentLength = byteArray.Length;
        Stream dataStream = request.GetRequestStream();
        dataStream.Write(byteArray, 0, byteArray.Length);
        dataStream.Close();

        long responseLength = request.GetResponse().ContentLength;
        Stream responseStream = request.GetResponse().GetResponseStream();
        MemoryStream memStream = new MemoryStream((int)responseLength);
        byteArray = new byte[4096];
        int bytesRead = 0;
        bytesRead = responseStream.Read(byteArray, 0, 4096);                
        while(bytesRead > 0)
        {
            memStream.Write(byteArray, 0, bytesRead);
            bytesRead = responseStream.Read(byteArray, 0, 4096);                
        }           
        return Encoding.UTF8.GetString(memStream.ToArray());
    } 
```

# .net - 对于 .NET ToolStripButton，我可以有一个多行“文本”属性吗？

> ID：1018787
> 
> 赞同：4
> 
> 时间：2009-06-19T16:08:46.580
> 
> 标签：.net, winforms

我有一个图像工具栏，我想要图像下方的文本标签。在文本标签是多个单词的情况下，我想垂直堆叠单词。我该怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-19T16:28:55.813

详细说明保罗的回答：

你不能在设计时做多线。但在运行时，您可以像这样设置每个 ToolStripButton 的 .Text 属性：

```
ToolStripButton1.Text = "This is " & ControlChars.CrLF & "a button." 
```

这将为您的文本提供多行显示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T16:18:57.763

尽管 VS UI 不支持，但您可以使用多行标签。只需使用 CrLf 来分隔行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-07-25T10:20:10.760

2019 年 VS UI 仍然不支持此功能。但是您可以将其放在构造函数中的 InitializeComponent() 之后作为简单的解决方法：

```
foreach (ToolStripItem tsi in tsMain.Items)
{
  tsi.Text = tsi.Text.Replace("|", Environment.NewLine);
} 
```

并使用“|” 作为设计器中换行符的占位符。

# visual-studio - VS 自动向网站项目添加一些不需要的引用

> ID：1018789
> 
> 赞同：0
> 
> 时间：2009-06-19T16:09:27.717
> 
> 标签：visual-studio, web

我们在使用 Visual Studio 2005 时遇到了一个非常奇怪的情况：

我们确实有一个网站项目，并且 VS 在编译项目时会自动添加一些不需要的引用，例如“System.Data.Oracle”（我们根本不使用 Oracle，也从未使用过）和来自 asp.net 的东西3.5（项目是2.0，我们没有在里面使用任何与新版本相关的东西）。

因此，当将发布的站点放入生产服务器（配置为 2.0，没有这些奇怪的 dll）时，该站点无法运行。即使我们从 Web.config 文件中删除这些依赖项。

你们有没有人见过你的 VS05 发生过这样的事情？

注意：bin 文件夹没有这些 dll。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:11:46.127

保存您的理智并停止使用网站项目。他们从一开始就是令人憎恶的。

向 Web 应用程序项目的转换非常值得付出努力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T17:05:23.717

您使用的是 Visual Studio 2005 SP1 吗？你应该。除了他们添加了 Web 应用程序项目之外，还有一些错误修复。

VS2005 并没有发明这些参考。您网站中的某些内容正在使用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:16:10.387

您是否在部署站点之前对其进行预编译？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T18:10:44.173

我们可以解决它！

该网站项目引用了一个项目。

这个项目有所有这些引用，网站使用它们。删除不需要的引用导致成功；）

# java - 您可以将@Autowired 与静态字段一起使用吗？

> ID：1018797
> 
> 赞同：181
> 
> 时间：2009-06-19T16:11:22.897
> 
> 标签：java, spring, autowired

有什么方法可以`@Autowired`与静态字段一起使用。如果没有，还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-06-19T17:13:28.620

简而言之，没有。您不能在 Spring 中自动连接或手动连接静态字段。您必须编写自己的逻辑来执行此操作。

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2011-05-13T11:33:07.977

```
@Component("NewClass")
public class NewClass{
    private static SomeThing someThing;

    @Autowired
    public void setSomeThing(SomeThing someThing){
        NewClass.someThing = someThing;
    }
} 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2009-06-20T01:27:07.090

`@Autowired`可以与 setter 一起使用，因此您可以让 setter 修改静态字段。

只有一个最后的建议......**不要**

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2017-12-26T10:38:01.117

在 @PostConstruct 方法中初始化您的自动装配组件

```
@Component
public class TestClass {
   private static AutowiredTypeComponent component;

   @Autowired
   private AutowiredTypeComponent autowiredComponent;

   @PostConstruct
   private void init() {
      component = this.autowiredComponent;
   }

   public static void testMethod() {
      component.callTestMethod();
   }
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-20T01:21:49.787

创建一个可以自动装配的 bean，它将初始化静态变量作为副作用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-10-24T08:15:07.387

想要添加自动连接静态字段（或常量）将被忽略的答案，但也不会产生任何错误：

```
@Autowired
private static String staticField = "staticValue"; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-22T09:37:59.167

您可以使用**XML 表示法**和`MethodInvokingFactoryBean`. 例如看[这里](https://stackoverflow.com/questions/28629930/how-can-i-inject-local-variables-of-a-static-method-inside-an-abstract-class-usi/28632156#28632156)。

```
private static StaticBean staticBean;

public void setStaticBean(StaticBean staticBean) {
   StaticBean.staticBean = staticBean;
} 
```

您应该尽可能使用**弹簧注入，因为这是推荐的方法**，但这并不总是可行的，因为我相信您可以想象并非所有东西都可以从弹簧容器中提取出来，或者您可能会处理遗留系统。

使用这种方法进行笔记测试也可能更加困难。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-14T06:52:03.443

您可以使用 ApplicationContextAware

```
@Component
public class AppContext implements ApplicationContextAware{
    public static ApplicationContext applicationContext;

    public AppBeans(){
    }

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }
} 
```

然后

```
static ABean bean = AppContext.applicationContext.getBean("aBean",ABean.class); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-06-22T01:09:40.227

**免责声明**这绝不是标准的，很可能有更好的弹簧方式来做到这一点。以上答案都没有解决连接公共静态字段的问题。

我想完成三件事。

1.  使用弹簧“自动装配”（我使用@Value）
2.  公开一个公共静态值
3.  防止修改

我的对象看起来像这样

```
private static String BRANCH = "testBranch";

@Value("${content.client.branch}")
public void finalSetBranch(String branch) {
    BRANCH = branch;
}

public static String BRANCH() {
    return BRANCH;
} 
```

我们已经检查了 1 和 2 现在我们如何防止调用 setter，因为我们无法隐藏它。

```
@Component
@Aspect
public class FinalAutowiredHelper {

@Before("finalMethods()")
public void beforeFinal(JoinPoint joinPoint) {
    throw new FinalAutowiredHelper().new ModifySudoFinalError("");
}

@Pointcut("execution(* com.free.content.client..*.finalSetBranch(..))")
public void finalMethods() {}

public class ModifySudoFinalError extends Error {
    private String msg;

    public ModifySudoFinalError(String msg) {
        this.msg = msg;
    }

    @Override
    public String getMessage() {
        return "Attempted modification of a final property: " + msg;
    }
} 
```

这个方面将包装所有以 final 开头的方法，如果它们被调用则抛出错误。

我不认为这特别有用，但如果你是强迫症并且喜欢把豌豆和胡萝卜分开，这是一种安全的方法。

**重要**Spring 在调用函数时不会调用你的切面。让这更容易，糟糕的是，我在弄清楚之前制定了逻辑。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-11T14:14:35.043

通常，通过对象实例设置静态字段是一种不好的做法。

为避免可选问题，您可以添加`synchronized`定义，并仅在私有静态 Logger 记录器时设置它；

```
@Autowired
public synchronized void setLogger(Logger logger)
{
    if (MyClass.logger == null)
    {
        MyClass.logger = logger;
    }
} 
```

：

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2019-03-26T11:19:11.233

```
private static UserService userService = ApplicationContextHolder.getContext().getBean(UserService.class); 
```

# c++ - 抛出 C++0x 异常的代价

> ID：1018800
> 
> 赞同：14
> 
> 时间：2009-06-19T16:11:47.187
> 
> 标签：c++, performance, exception

在 C++0x 中抛出异常对性能有何影响？这个编译器依赖多少？这与询问[进入一个`try`块的成本是多少不同，即使没有抛出异常](https://stackoverflow.com/questions/1897940/in-what-ways-do-c-exceptions-slow-down-code-when-there-are-no-exceptions-thown)。

我们是否应该期望像在 Java 中那样将异常更多地用于一般逻辑处理？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-19T17:03:43.157

```
#include <iostream>
#include <stdexcept>

struct SpaceWaster {
    SpaceWaster(int l, SpaceWaster *p) : level(l), prev(p) {}
    // we want the destructor to do something
    ~SpaceWaster() { prev = 0; }
    bool checkLevel() { return level == 0; }
    int level;
    SpaceWaster *prev;
};

void thrower(SpaceWaster *current) {
    if (current->checkLevel()) throw std::logic_error("some error message goes here\n");
    SpaceWaster next(current->level - 1, current);
    // typical exception-using code doesn't need error return values
    thrower(&next);
    return;
}

int returner(SpaceWaster *current) {
    if (current->checkLevel()) return -1;
    SpaceWaster next(current->level - 1, current);
    // typical exception-free code requires that return values be handled
    if (returner(&next) == -1) return -1;
    return 0;
}

int main() {
    const int repeats = 1001;
    int returns = 0;
    SpaceWaster first(1000, 0);

    for (int i = 0; i < repeats; ++i) {
        #ifdef THROW
            try {
                thrower(&first);
            } catch (std::exception &e) {
                ++returns;
            }
        #else
            returner(&first);
            ++returns;
        #endif
    }
    #ifdef THROW
        std::cout << returns << " exceptions\n";
    #else
        std::cout << returns << " returns\n";
    #endif
} 
```

米老鼠基准测试结果：

```
$ make throw -B && time ./throw
g++     throw.cpp   -o throw
1001 returns

real    0m0.547s
user    0m0.421s
sys     0m0.046s

$ make throw CPPFLAGS=-DTHROW -B && time ./throw
g++  -DTHROW   throw.cpp   -o throw
1001 exceptions

real    0m2.047s
user    0m1.905s
sys     0m0.030s 
```

所以在这种情况下，将异常抛出 1000 个堆栈级别，而不是正常返回，大约需要 1.5 毫秒。这包括输入 try 块，我相信在某些系统上它在执行时是免费的，在其他系统上每次输入 try 都会产生成本，而在其他系统上只会在每次输入包含 try 的函数时产生成本。对于更有可能的 100 个堆栈级别，我将重复次数提高到 10k，因为一切都快了 10 倍。所以异常花费了0.1ms。

对于 10 000 个堆栈级别，它是 18.7 秒与 4.1 秒，因此异常的额外成本约为 14 毫秒。所以对于这个例子，我们正在查看每层堆栈 1.5us 的相当一致的开销（其中每一层都破坏一个对象）。

显然，C++0x 没有指定异常的性能（或其他任何东西，除了算法和数据结构的大 O 复杂性）。我认为它不会以一种会严重影响许多实现的方式改变异常，无论是积极的还是消极的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-19T16:15:11.900

异常性能非常依赖于编译器。您必须分析您的应用程序以查看它是否存在问题。一般来说，它不应该是。

您确实应该对“异常条件”使用异常，而不是一般逻辑处理。异常是通过代码和错误路径分隔正常路径的理想选择。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-06-19T20:47:53.317

我基本上认为问错了问题。
什么是例外的成本没有用，更有用的是例外相对于替代方案的成本。因此，您需要测量异常的成本并将其与返回的错误代码进行比较 >>>AND<<< 检查堆栈展开的每个级别的错误代码。

另请注意，当您可以控制所有内容时，不应使用异常。在返回错误代码的类中可能是一种更好的技术。当您无法确定在运行时将如何（或在什么上下文中）使用您的对象时，应使用异常在运行时转移控制。

基本上，它应该用于将控制转移到更高级别的上下文，其中具有足够上下文的对象将了解如何处理异常情况。

鉴于这种使用原则，我们看到异常将用于将控制权转移到堆栈帧中的多个级别。现在考虑您需要编写的额外代码以将错误代码传递回相同的调用堆栈。当错误代码可能来自多个不同的方向并尝试协调所有不同类型的错误代码时，请考虑额外的复杂性。

鉴于此，您可以看到异常如何极大地简化代码流程，并且您可以看到代码流程的复杂性。那么问题就变成了天气异常比需要在每个堆栈帧上执行的复杂错误条件测试更昂贵。

答案始终取决于（如果需要，请同时进行配置文件和使用 quickist）。

但如果速度不是唯一的成本。
可维护性是可以衡量的成本。使用这种成本度量异常总是获胜，因为它们最终使代码的控制流只针对需要完成的任务，而不是任务和错误控制。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-19T17:13:15.267

我曾经创建了一个 x86 仿真库并将异常用于中断等。馊主意。即使我没有抛出任何异常，它也会对我的主循环产生很大影响。像这样的东西是我的主要循环

```
try{
    CheckInterrupts();
    *(uint32_t*)&op_cache=ReadDword(cCS,eip);
    (this->*Opcodes[op_cache[0]])();
    //operate on the this class with the opcode functions in this class
    eip=(uint16_t)eip+1;

}
//eventually, handle these and do CpuInts...
catch(CpuInt_excp err){
    err.code&=0x00FF;
    switch(err.code){ 
```

在 try 块中包含该代码的开销使异常函数成为 CPU 时间前 5 个用户中的 2 个。

那对我来说很贵

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-19T18:05:16.353

C++0x 中的异常没有理由比 C++03 更快或更慢。这意味着它们的性能完全依赖于实现。Windows 使用完全不同的数据结构在 32 位和 64 位以及 Itanium 和 x86 上实现异常处理。Linux 也不能保证只坚持一种实现。这取决于。有几种流行的方式来实现异常处理，它们都有优点和缺点。

所以它不依赖于语言（c++03 vs 0x），而是依赖于编译器、运行时库、操作系统和 CPU 架构。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-19T16:21:36.000

我认为 C++0x 不会增加或改变 C++ 异常的工作方式。对于一般建议看看[这里](http://www.ddj.com/cpp/184401836)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-19T16:15:29.527

可以想象它们的性能与 C++03 中的性能大致相同，即“非常慢！” 不，由于 try-catch-throw 构造，在任何语言中都应该在特殊情况下使用异常。如果您在 java 中使用 throw 进行程序流控制，那么您做错了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-29T06:40:55.537

@Steve Jessop 已经发布了事实上的答案，但我仍然认为还有一件事：尝试不同的优化级别，例如大多数产品经常使用的“-O2”。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-06-19T16:22:08.810

一般来说，异常处理是一项昂贵的功能，因为抛出/捕获意味着要执行额外的代码以确保堆栈展开和捕获条件评估。

据我从一些阅读材料中了解到，例如，对于 Visual C++，代码中嵌入了一些非常复杂的结构和逻辑来确保这一点。由于大多数函数可能会调用可能引发异常的其他函数，因此即使在这些情况下也可能存在一些堆栈展开开销。

但是，在考虑异常开销之前，最好在执行任何优化操作之前**测量**代码中异常使用的影响。避免异常过度使用应防止异常处理显着开销。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-06-19T16:49:35.717

想象一下铃声响起，计算机停止接受**任何**输入三秒钟，然后有人踢了用户的头部。

这就是例外的代价。如果它是为了防止数据丢失或机器着火，那是值得的。否则，它可能不是。

编辑：因为这得到了一个反对票（加上一个赞成票，所以对我来说+8！），我会用更少的幽默和更多的信息来澄清上面的内容：异常，至少在 C++ 领域，需要 RTTI 和编译器，可能还有操作系统魔法，这使得他们表现出一个巨大的不确定性黑洞。（您甚至不能保证它们会触发，但这些情况会发生在其他更严重的事件中，例如内存不足或用户只是杀死进程或机器实际上着火了。）所以如果你使用它们，它应该是因为您希望从否则会导致可怕的事情发生的情况中优雅地恢复，但是该恢复不能期望以高性能运行（无论对于您的特定应用程序可能是什么）。

因此，如果您要使用异常，则不能对性能影响做出任何假设。

# asp.net - 跨 Informatica ETL 和 ASP.NET CRUD 页面重用业务逻辑的最佳方式是什么？

> ID：1018808
> 
> 赞同：0
> 
> 时间：2009-06-19T16:13:05.190
> 
> 标签：asp.net, etl

我不知道关于 Informatica 的第一件事，但我正在寻找解决重复业务逻辑的方法，用于在表中插入和更新记录。问题在于以一种有效的方式进行。

1) 我们的网页一次插入、更新和删除一条记录。

2) 我们有 Informatica ETL 加载程序，从暂存（临时）表中获取记录并加载它们。这个过程对我来说是一个黑匣子，但我知道 Informatica 具有内置的效率，例如读取内存中相当大的表等，因此可以快速验证许多记录。

我知道，如果将业务编辑放在 Web 服务中，那么执行 CRUD 操作的网页以及 Informatica 加载过程都可以重用此 Web 服务，但是您如何有效地做到这一点？一次将一条记录传递给 Web 服务会降低 ETL 效率。传递数以千计的记录也是如此。

我觉得我在黑暗中，因为我不知道 Informatica 是如何工作的。

有人有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-11T15:00:29.930

恐怕你必须去了解 InfoMatica。它可能以与您想象的完全不同的方式运作，使您的所有假设都是错误的

# java - 在 Spring MVC 中使用 AXSLT 组件

> ID：1018815
> 
> 赞同：2
> 
> 时间：2009-06-19T16:14:41.010
> 
> 标签：java, spring, xslt, components, xalan

不久前，我编写了一个 Java 应用程序，该应用程序使用 Xalan 使用 XSLT 处理 XML。现在我正试图走向春天。

我一直无法访问组件。据我所知，我的 XML、XSLT 和 Java 对象是正确的，但 Spring 似乎无法找到和引用我想要访问的组件。

```
...
<axslt:component prefix="oni" functions="say">
    <axslt:script lang="javaclass" src="xslt.components.TestComponent" />
</axslt:component>
... 
```

我还尝试了一个 JavaScript 组件（使用 bsf.jar 和 js.jar），但也失败了。

```
...
<axslt:component prefix="js" functions="say">
    <xalan:script lang="javascript">
        function say() { return "Hello from JavaScript"; }
    </xalan:script>
</axslt:component>
... 
```

我一直收到此错误：

```
javax.xml.transform.TransformerConfigurationException: Could not compile stylesheet
    com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl.newTemplates(Unknown Source)
    org.springframework.web.servlet.view.xslt.XsltView.loadTemplates(XsltView.java:417)
    ... 
```

我在网上查了一下，并没有发现很多东西可以继续。Spring+XSLT 似乎不是一个很突出的话题。关于 Spring 中我需要配置的东西，或者我需要扩展的东西有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T20:28:51.517

Spring 的 XsltView 类的源代码是免费提供的。我建议阅读它以了解它如何使用 XSLT API，并将其与您自己的代码的实现方式进行比较。

# c# - Silverlight 同步

> ID：1018816
> 
> 赞同：0
> 
> 时间：2009-06-19T16:15:03.460
> 
> 标签：c#, silverlight, synchronization

我正在开发一个 silverlight 应用程序，我需要在可以离线的不同 silverlight 实例中同步一个列表。我将有一个在线服务器来同步它们。

所以我们可以这样想象：

> pc1: A1 A2 A3
> 
> pc2：A1 A2（A3 已删除）
> 
> 服务器：A1 A2 A3（删除 A3 以反映 pc2，然后更新 pc1 以也删除）

它也必须反映项目的重新排序。我想将它与silverlight 在线和离线（在浏览器之外）一起使用。

你们中有人解决过类似的问题吗？有什么好的方法呢？

谢谢你，阿图尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:31:11.257

在正常的断开连接的环境中，您会使用诸如同步服务之类的东西来处理这个问题，但这在 Silverlight 客户端上有点重。

我首先给列表中的每个项目一个 GUID。然后，我会在每个客户端和服务器上维护列表的插入、更新和删除日志。然后每次客户端连接到服务器时，您都必须进行合并同步。在这种情况下，您必须检测和处理冲突：

*   有人编辑一个项目，而其他人删除它
*   两个客户端同时编辑一个项目

您处理物品重新订购的要求增加了一些复杂性。您可能希望将重新排序记录为“在项目 x 之前移动”或“在项目 x 之后移动”操作，而不是更新列表中所有项目的所有索引。

# sql - INNER JOIN ON vs WHERE 子句

> ID：1018822
> 
> 赞同：1048
> 
> 时间：2009-06-19T16:16:24.347
> 
> 标签：sql, mysql, join, inner-join

为简单起见，假设所有相关字段都是`NOT NULL`.

你可以做：

```
SELECT
    table1.this, table2.that, table2.somethingelse
FROM
    table1, table2
WHERE
    table1.foreignkey = table2.primarykey
    AND (some other conditions) 
```

要不然：

```
SELECT
    table1.this, table2.that, table2.somethingelse
FROM
    table1 INNER JOIN table2
    ON table1.foreignkey = table2.primarykey
WHERE
    (some other conditions) 
```

这两个工作方式相同`MySQL`吗？

* * *

## 回答 #1

> 赞同：762
> 
> 时间：2009-06-19T16:17:28.200

`INNER JOIN`是您应该使用的 ANSI 语法。

它通常被认为更具可读性，尤其是当您连接大量表时。

`OUTER JOIN`每当需要时，它也可以很容易地替换为。

`WHERE`语法更面向关系模型。

两个表`JOIN`ed 的结果是应用过滤器的表的笛卡尔积，该过滤器仅选择与连接列匹配的那些行。

`WHERE`使用语法更容易看到这一点。

至于您的示例，在 MySQL 中（通常在 SQL 中），这两个查询是同义词。

另外，请注意 MySQL 也有一个`STRAIGHT_JOIN`子句。

使用此子句，您可以控制`JOIN`顺序：在外循环中扫描哪个表，在内循环中扫描哪个表。

您无法在 MySQL 中使用`WHERE`语法来控制它。

* * *

## 回答 #2

> 赞同：211
> 
> 时间：2009-06-19T16:30:59.527

其他人指出，这`INNER JOIN`有助于人类的可读性，这是首要任务，我同意。
让我试着解释一下*为什么*连接语法更具可读性。

一个基本的`SELECT`查询是这样的：

```
SELECT stuff
FROM tables
WHERE conditions 
```

该`SELECT`子句告诉我们我们得到了**什么**；`FROM`子句告诉我们从**哪里**得到它，子句`WHERE`告诉我们**从哪**一个得到。

`JOIN`是关于表的声明，它们是如何绑定在一起的（从概念上讲，实际上是一个表）。

任何控制表的查询元素——我们从中获取东西——在语义上都属于`FROM`子句（当然，这就是`JOIN`元素所在的地方）。将 join-elements 放入`WHERE`子句将**which**和**where-from**`JOIN`混为一谈，这就是首选语法的原因。

* * *

## 回答 #3

> 赞同：153
> 
> 时间：2009-12-22T06:24:07.403

**在 ON / WHERE 中应用条件语句**

这里我已经解释了逻辑查询处理步骤。

* * *

参考：Inside Microsoft® SQL Server™ 2005 T-SQL 查询
出版商：Microsoft Press
Pub 日期：2006 年 3 月 7 日
印刷 ISBN-10：0-7356-2313-9
印刷 ISBN-13：978-0-7356-2313-2
页数：640

[Microsoft® SQL Server™ 2005 T-SQL 查询内部](http://www.microsoft.com/learning/en/us/book.aspx?ID=9615&locale=en-us)

```
(8)  SELECT (9) DISTINCT (11) TOP <top_specification> <select_list>
(1)  FROM <left_table>
(3)       <join_type> JOIN <right_table>
(2)       ON <join_condition>
(4)  WHERE <where_condition>
(5)  GROUP BY <group_by_list>
(6)  WITH {CUBE | ROLLUP}
(7)  HAVING <having_condition>
(10) ORDER BY <order_by_list> 
```

SQL 与其他编程语言不同的第一个显着方面是代码的处理顺序。在大多数编程语言中，代码是按照编写的顺序处理的。在 SQL 中，处理的第一个子句是 FROM 子句，而最先出现的 SELECT 子句几乎最后处理。

每个步骤都会生成一个虚拟表，用作下一个步骤的输入。这些虚拟表对调用者（客户端应用程序或外部查询）不可用。只有最后一步生成的表才会返回给调用者。如果查询中未指定某个子句，则简单地跳过相应的步骤。

# 逻辑查询处理阶段的简要说明

如果这些步骤的描述目前似乎没有多大意义，请不要太担心。这些提供作为参考。场景示例之后的部分将更详细地介绍这些步骤。

1.  FROM：在FROM子句的前两个表之间进行笛卡尔积（交叉连接），结果生成虚拟表VT1。

2.  ON：对 VT1 应用 ON 滤波器。仅将`<join_condition>`TRUE 的行插入到 VT2。

3.  OUTER (join)：如果指定了 OUTER JOIN（与 CROSS JOIN 或 INNER JOIN 相对），则将保留表中的行或未找到匹配的表添加到 VT2 的行中作为外行，生成VT3。如果 FROM 子句中出现两个以上的表，则在最后一个连接的结果和 FROM 子句中的下一个表之间重复应用步骤 1 到 3，直到处理完所有表。

4.  WHERE：将 WHERE 过滤器应用于 VT3。仅将`<where_condition>`TRUE 的行插入到 VT4。

5.  GROUP BY：VT4 中的行根据 GROUP BY 子句中指定的列列表分组排列。产生VT5。

6.  立方体 | ROLLUP：将超组（组的组）添加到来自 VT5 的行，生成 VT6。

7.  HAVING：HAVING 过滤器应用于 VT6。仅将`<having_condition>`TRUE 的组插入到 VT7。

8.  SELECT：处理SELECT列表，生成VT8。

9.  DISTINCT：从 VT8 中删除重复的行。产生VT9。

10.  ORDER BY：VT9 中的行根据 ORDER BY 子句中指定的列列表进行排序。生成游标 (VC10)。

11.  TOP：从VC10的开头选择指定的行数或百分比。表 VT11 生成并返回给调用者。

* * *

因此，(INNER JOIN) ON 将在应用 WHERE 子句之前过滤数据（此处将自行减少 VT 的数据计数）。随后的连接条件将使用过滤后的数据执行，从而提高性能。之后，只有 WHERE 条件会应用过滤条件。

（在 ON / WHERE 中应用条件语句在少数情况下不会产生太大影响。这取决于您连接了多少表以及每个连接表中可用的行数）

* * *

## 回答 #4

> 赞同：70
> 
> 时间：2009-06-19T16:23:45.003

隐式连接 ANSI 语法较旧，不​​太明显，不推荐使用。

此外，关系代数允许`WHERE`子句和中的谓词可互换`INNER JOIN`，因此即使是`INNER JOIN`带有`WHERE`子句的查询也可以让优化器重新排列谓词。

我建议您以最易读的方式编写查询。

有时这包括制作`INNER JOIN`相对“不完整”的标准并将一些标准`WHERE`简单地放入其中以使过滤标准列表更易于维护。

例如，而不是：

```
SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
    AND c.State = 'NY'
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
    AND a.Status = 1 
```

写：

```
SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
WHERE c.State = 'NY'
    AND a.Status = 1 
```

但这当然取决于。

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2009-06-19T16:19:14.940

一旦您需要开始向查询中添加更多表，隐式连接（这是您的第一个查询所称的）变得更加混乱、难以阅读和难以维护。想象一下在四个或五个不同的表上执行相同的查询和连接类型……这是一场噩梦。

使用显式连接（您的第二个示例）更具可读性和易于维护。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2009-06-19T16:46:59.837

我还要指出，使用旧语法更容易出错。如果您使用不带 ON 子句的内部连接，则会出现语法错误。如果您使用较旧的语法并忘记 where 子句中的连接条件之一，您将获得交叉连接。开发人员通常通过添加 distinct 关键字（而不是修复联接，因为他们仍然没有意识到联接本身已损坏）来解决此问题，这似乎可以解决问题，但会大大减慢查询速度。

此外，如果您在旧语法中有交叉连接，维护人员将如何知道您是否打算拥有一个（在某些情况下需要交叉连接）或者它是否应该修复？

让我指出这个问题，看看为什么使用左连接时隐式语法不好。 [Sybase *= 到 Ansi 标准，同一个内表有 2 个不同的外表](https://stackoverflow.com/questions/12186549/sybase-to-ansi-standard-with-2-different-outer-tables-for-same-inner-table#comment16335545_12186549)

另外（个人咆哮），使用显式连接的标准已有 20 多年的历史，这意味着隐式连接语法已经过时了 20 年。你会使用已经过时 20 年的语法编写应用程序代码吗？为什么要写数据库代码呢？

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-06-19T16:20:49.900

它们具有不同的人类可读含义。

但是，根据查询优化器的不同，它们对机器可能具有相同的含义。

您应该始终编码可读。

也就是说，如果这是一个内置关系，则使用显式连接。如果要匹配弱相关数据，请使用 where 子句。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-06-19T17:28:56.930

SQL:2003 标准更改了一些优先规则，因此 JOIN 语句优先于“逗号”连接。这实际上可以根据设置方式更改查询的结果。当 MySQL 5.0.12 切换到遵守标准时，这会给一些人带来一些问题。

因此，在您的示例中，您的查询将相同。但是如果你添加了第三个表： SELECT ... FROM table1, table2 JOIN table3 ON ... WHERE ...

在 MySQL 5.0.12 之前，table1 和 table2 将首先连接，然后是 table3。现在（5.0.12 及更高版本），首先连接 table2 和 table3，然后连接 table1。它并不总是改变结果，但它可以而且你甚至可能没有意识到这一点。

我不再使用“逗号”语法，选择您的第二个示例。无论如何，它更具可读性，JOIN 条件与 JOIN 一起使用，而不是分成单独的查询部分。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-06-19T17:03:42.483

我知道您在谈论 MySQL，但无论如何：在 Oracle 9 中，显式连接和隐式连接会生成不同的执行计划。已在 Oracle 10+ 中解决的 AFAIK：不再有这样的区别。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-07-09T16:23:52.087

如果您经常编写动态存储过程，那么您会爱上您的第二个示例（使用 where）。如果您有各种输入参数和大量变形混乱，那么这是唯一的方法。否则，它们都将运行相同的查询计划，因此经典查询绝对没有明显差异。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-06-19T16:50:12.830

ANSI 连接语法肯定更便携。

我正在升级 Microsoft SQL Server，我还要提一下，2005 SQL Server 及更高版本不支持 SQL Server 中外部连接的 =* 和 *= 语法（没有兼容模式）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-11-04T14:49:41.313

对于隐式连接，我有两点（第二个示例）：

1.  告诉数据库你想要什么，而不是它应该做什么。
2.  You can write all tables in a clear list that is not cluttered by join conditions. Then you can much easier read what tables are all mentioned. The conditions come all in the WHERE part, where they are also all lined up one below the other. Using the JOIN keyword mixes up tables and conditions.

# jquery - 如何在单击按钮时触发弹出窗口？

> ID：1018824
> 
> 赞同：0
> 
> 时间：2009-06-19T16:17:03.567
> 
> 标签：jquery, modalpopups

该按钮源自用户控件。我想在单击该特定按钮时关联一个弹出窗口。我可以通过单击基本页面上的任何其他按钮来实现此目的，但是由于该特定按钮来自用户控件，因此我无法触发弹出窗口。

```
$('#btnSendOrder').click(function() {// code here}) // btnSendOrder is from a user control.In this case pop-up is not coming.

$('#btnSendOrder').click(function() { // code here}) // btnSend Order is from the base page itself. In this scenario pop-up comes out. 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:35:11.663

由于按钮正在服务器上呈现，因此它的客户端 ID 不是您使用的

你可以这样做...

```
$('#<%= btnSendOrder.ClientID %>').click(function() {// code here}) 
```

...来自您的用户控件，<% 和 %> 之间的部分将替换为客户端 html 中的真实控件 ID

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:25:43.847

使用一点 jquery，将按钮与页面加载时的单击事件相关联相对简单：

```
 $(".button").click(function() {
        PopupMyWindow();
    }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:26:37.997

如果您使用的是 .NET，请记住您的控件最终会看起来像：ctl1.UserControlName.ButtonName 或类似的东西。

渲染后检查您的标记代码，然后使用确切的按钮名称，以便您的 jQuery 知道从哪个控件触发。

# php - 如何使用rapidshare api？

> ID：1018829
> 
> 赞同：3
> 
> 时间：2009-06-19T16:18:27.437
> 
> 标签：php, rapidshare

我正在尝试使用 rapidshare api，但不知道如何使用它？

[http://api.rapidshare.com/cgi-bin/rsapi.cgi?subroutine=getaccountdetails_v1&type=prem&login=MY_USERNAME&password=MY_PASSWORD](http://api.rapidshare.com/cgi-bin/rsapi.cgi?subroutine=getaccountdetails_v1&type=prem&login=MY_USERNAME&password=MY_PASSWORD)

使用后我收到错误“错误：子程序无效。”

谁能告诉我我的链接有什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T16:46:29.853

问题是尽管 API 将子例程定义为 `subroutine=getaccountdetails_v1`它实际需要的是 `sub=getaccountdetails_v1`. 这适用于所有子程序调用。

这应该工作

`http://api.rapidshare.com/cgi-bin/rsapi.cgi?sub=getaccountdetails_v1&type=prem&login=MY_USERNAME&password=MY_PASSWORD`

[点击这里](http://api.rapidshare.com/cgi-bin/rsapi.cgi?sub=getaccountdetails_v1&type=prem&login=MY_USERNAME&password=MY_PASSWORD)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-10T01:33:18.143

但我认为它应该是这样的

[https://api.rapidshare.com/cgi-bin/rsapi.cgi?sub=getaccountdetails&type=prem&login=MYUSERNAME&password=MYPASS](https://api.rapidshare.com/cgi-bin/rsapi.cgi?sub=getaccountdetails&type=prem&login=MYUSERNAME&password=MYPASS)

# c++ - 如何将二进制数据写入文件以便可以快速读取？

> ID：1018830
> 
> 赞同：2
> 
> 时间：2009-06-19T16:18:48.967
> 
> 标签：c++, linux, file, gcc, binary

我需要编写一种文件格式，将数据写入文件并可以将其读回。

它应该能够相当快地读回数据，这应该涉及将一大块数据块传输到 a 中`std::vector`（因为它们的存储总是连续实现的）。

但是，在编写文件时，我不知道如何对整数和其他类型的对齐和大小实施约束。

这应该怎么做？我在 Q6600 (x86) 上的 buntu linux 上使用 gcc。

举个例子：

```
struct Vertex
{
  float point [3];
  float normal [3];
  float texcoord [2];
} 
```

稍后，数据存储在`std::vector<Vertex>`. 我考虑过使用`__attribute__` 和打包/对齐它，以便它在不同平台上更便携。

编辑：我已经制定了规范，我打算使用它。最大的数据位是 Vertex 和 Indices，因此它们将被读取为大块，例如（较大规范的一部分）： VertexGroup 是一组共享特征的顶点。它们一次只能容纳一种材料，因此网格中应该包含许多材料。

```
<uint> thisid # Of this VertexGroup
<string> name
<uint> materialId # A material
<uint> vertexCount
for (vetexCount):
    <3xfloat> point
    <3xfloat> normal
    <2xfloat> texcoord
<uint> triangleCount
for (triangleCount):
    <3xuint> indices 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T16:24:45.580

这将取决于您的编译器和平台。据我所知，如果不定义大量自己的宏，就无法以完全跨编译器和跨平台的方式强制执行此操作。

但是，VC++ 和 GCC（大两个）都支持该`#pragma pack`指令，这将允许您为结构定义对齐和打包。请参阅[http://msdn.microsoft.com/en-us/library/2e70t5y1.aspx](http://msdn.microsoft.com/en-us/library/2e70t5y1.aspx)或[http://gcc.gnu.org/onlinedocs/gcc/Structure_002dPacking-Pragmas.html](http://gcc.gnu.org/onlinedocs/gcc/Structure_002dPacking-Pragmas.html)。

考虑到这一点，您可以使用`#pragma pack`定义结构的对齐方式，然后`fread()`或类似地简单地将字节从文件传输到内存。您可能希望在列表前面加上列表长度，以便一次为整个列表分配内存，然后使用单个 I/O 调用加载整个文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T17:00:06.453

如果它只是 POD（普通旧数据），没有指针，那么您可以只使用 fwrite 和 fread。当然，这假设您绝对会在相同的架构上读回与以前完全相同的格式。

考虑[提升序列化](http://www.boost.org/doc/libs/1_39_0/libs/serialization/doc/tutorial.html)。

# linux - Ubuntu Linux 和 Crossroads 负载均衡器无法正常工作

> ID：1018834
> 
> 赞同：0
> 
> 时间：2009-06-19T16:19:09.293
> 
> 标签：linux, centos, ubuntu-9.04, load-balancing

在一些关于问题的建议之后，我开始使用基于 linux 的软件来平衡两台服务器之间的流量。

基本上我们有我们的生产网站和一个备份系统（在远程站点）。产品会不断地镜像到备份中，以保持同步。我们的域名指向 Linux Ubuntu 9.04 服务器（除了负载平衡软件之外，什么都没有安装）。它正在运行最新版本的 Crossroads（又名 XR）。

XR 设置为将所有连接交给实时网络服务器，直到它失去与该服务器的“心跳”连接，一旦发生这种情况，它就会将连接反弹到我们的备份系统。

我遇到的问题表现为我们的网络服务器缺乏响应，基本上客户端将正确格式的 XML 消息传递给 .NET Web 服务，该服务对数据进行一些计算和更改，然后回复 XML 响应，但是客户似乎从来没有得到回应。

我一直在使用wireshark来调查这个问题，它似乎在响应进行到一半时连接被切断或断开（由于我缺乏wireshark经验，我不太确定）。

我一直在与 XR 软件的作者交谈，他们在软件本身中找不到任何可以解释这种行为的原因或问题，并且相信这可能与我正在使用的 linux 发行版或内核问题有关。

谁能帮我解决这个问题，因为我们将在接下来的几周内启用这个系统，这个问题阻碍了我们。

我现在已经从 Ubuntu 切换到 CentOS 4 并再次尝试，现在当我使用wireshark 时，我收到了来自系统的随机回复。有时我会从服务器得到一个完整的 XMl 回复，而下一次尝试我可能只会在 Linux 机器发送 RST 数据包之前得到部分回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-14T13:01:41.313

好的，结果证明这与操作系统无关，而是我使用的软件有问题。在配置 xml 文件中输入一些超时值（感谢作者的建议），这似乎已经解决了问题。

这是您需要在# 符号之间添加到配置文件中的条目的示例，给出的超时时间有点过长（1 分钟）

```
<service>
    <name>web_http</name>
    <server>
      <address>x.x.x.x:80</address>
      <type>tcp</type>
      <dispatchmode>first-available</dispatchmode> 
```

## #

```
 <clienttimeout>60:60</clienttimeout>
      <backendtimeout>60:60</backendtimeout> 
```

## #

```
 </server>
      <backend>
        <address>x.x.x.x:80</address>
      </backend>
      <backend>
        <address>x.x.x.x:80</address>
      </backend>
      <backend>
        <address>x.x.x.x:80</address>
      </backend>
  </service> 
```

# ruby-on-rails - Rails：在 ActionView-Helper 'collection_select' 中预选一个值

> ID：1018836
> 
> 赞同：5
> 
> 时间：2009-06-19T16:19:27.407
> 
> 标签：ruby-on-rails, actionview, actionviewhelper

我正在尝试让[ActionView-Helper`collection_select`](http://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html#M001910)采用将在下拉菜单中预选的值。

两者都没有（`:selected`在 html-option-hash 中）

```
<%= collection_select(:my_object, :my_method, @my_collection, :id, :description_string, {}, {:selected => @my_collection_object.id}) %> 
```

也不是（`:selected`在选项哈希中）

```
<%= collection_select(:my_object, :my_method, @my_collection, :id, :description_string, {:selected => @my_collection_object.id}, {}) %> 
```

似乎工作。

我究竟做错了什么？谁能帮我解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T17:29:58.647

从[文档](http://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html#M001910)：

示例用法（`Author`为 , 的实例选择关联`Post`的`@post`）：

```
collection_select(:post, :author_id, Author.all, :id, :name_with_initial) 
```

如果`@post.author_id`已经是 1，这将返回：

```
<select name="post[author_id]">
  <option value="">Please select</option>
  <option value="1" selected="selected">D. Heinemeier Hansson</option>
  <option value="2">D. Thomas</option>
  <option value="3">M. Clark</option>
</select> 
```

因此，您只需要确保`@my_object.my_method`返回一个与可用选项值之一匹配的值。如果匹配，则将选择该选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T16:35:20.633

根据[文档](http://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html#M001910)，如果`@my_object.my_method`与选项之一具有相同的值，则默认情况下将选择该选项。

相反，您可以尝试[`options_from_collection_for_select`](http://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html#M001913)结合使用[`select_tag`](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#M002015)：

```
<%= select_tag 'my_object[my_method]', options_from_collection_for_select(@my_collection, :id, :description_string, @my_collection_object.id) %> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-24T18:32:04.403

利用`:selected_value`

```
%= collection_select(:my_object, :my_method, @my_collection, :id, :description_string, {}, {:selected_value => @my_collection_object.id}) %> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T16:40:26.780

检查 @my_object.my_method 是否返回 nil。如果是这样，

> 如果调用方法返回 nil，则在选项哈希中不包含 :prompt 或 :include_blank 时不会进行选择。

除此之外，您可以尝试使用 lambda，就像在 rdoc 示例中一样

```
{:disabled => lambda {|category| category.archived? } 
```

在你的情况下，这看起来像

```
{:selected => lambda {|obj| obj.id == @my_collection_object.id }} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-07-17T07:59:19.057

如果您的集合是 2 值数组的数组形式，它也可以工作：

```
CURRENCIES = [["USD", "$"], ["BRL", "R$"]]

<%= collection_select :thing, :currency, CURRENCIES, :first, :last %> 
```

`:first`and技巧对这些`:last`东西非常有效，无需为它们定义单独的模型。

# sql-server - 我可以在我的 SQL 连接字符串中使用故障转移伙伴而不进行镜像吗？

> ID：1018852
> 
> 赞同：5
> 
> 时间：2009-06-19T16:24:13.833
> 
> 标签：sql-server, replication, failover, mirroring

我承认我有点小气，但我不想为通过镜像获得 SQL Server 自动故障转移所需的三台服务器而奔波，尤其是因为这三台服务器中的一台除了作为见证服务器之外什么都不做。

如果我设置了从主服务器到备份服务器的正常 SQL 复制（比如快照），我可以在我的 ASP.NET 应用程序中设置我的连接字符串以包含“故障转移伙伴=备份”吗？似乎客户端上的 ADO.NET 应该只尝试主节点，如果主节点不可用，则故障转移到备份。

或者这只适用于镜像？

（我喜欢镜像的想法，但是如果您不想为见证服务器付费，则必须手动将备份服务器切换为主服务器。）

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-08-19T15:09:10.770

我还在寻找关于在非镜像环境中是否支持 FailoverPartner 的原始问题的答案。在我们的环境中，有一个通过复制同步的辅助数据库。

为了测试，我在 SSIS OLEDB 源中设置了以下连接字符串：

```
Data Source=PRIMARY;FailoverPartner=SECONDARY;Provider=SQLNCLI10.1;
                            Network=dbmssocn;Database=myDB;User ID=user;Password=password; 
```

当我运行时，我看到以下错误

> 连接尝试故障转移到未配置数据库镜像的数据库。

因此，除非辅助服务器实际上处于镜像配置中，否则这似乎是不可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-10T08:41:44.550

根据 Microsoft 的 SQL Server 2005/2008 许可条款，您的主 SQL 服务器只需要一个许可（每个 CPU）。

您不必为镜像购买额外的 SQL Server 许可证，因为镜像服务器只与主服务器通信。

如果发生故障转移，您有 30 天的时间将故障转移回主服务器，否则您需要购买额外的许可证。

这是许可详细信息的链接，请参阅第 2 页的被动服务器/故障转移支持。

[Microsoft 的许可概述...](http://download.microsoft.com/download/1/e/6/1e68f92c-f334-4517-b610-e4dee946ef91/2008%20SQL%20Licensing%20Overview%20final.docx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T16:48:32.130

Gregor，如果我没记错的话，你的见证服务器可以是运行在非常便宜的硬件上的 SQL Express（即使你需要，也可以是桌面级 PC）。据我所知，如果不使用集群或通过见证进行镜像，则无法进行自动故障转移。

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/ms189590.aspx](http://msdn.microsoft.com/en-us/library/ms189590.aspx)和[http://msdn.microsoft.com/en-us/library/ms175191.aspx](http://msdn.microsoft.com/en-us/library/ms175191.aspx)。

摘自第二个网址：“我们强烈建议见证服务器与合作伙伴位于单独的计算机上。数据库镜像合作伙伴仅受 SQL Server 2005 Standard 及更高版本以及 SQL Server 2005 Enterprise Edition 及更高版本支持。见证人，相反，SQL Server 2005 Workgroup 和更高版本以及 SQL Server 2005 Express Edition 和更高版本也支持。见证可以在任何支持这些 SQL Server 版本的可靠计算机系统上运行。但是，我们建议每个用作见证的服务器实例对应于您正在运行的 SQL Server Standard 版本所需的最低配置。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-25T10:16:37.423

我正在寻找类似的东西；是否可以将故障转移伙伴指定为一个和一个唯一的连接字符串；- 显然只要存在故障转移伙伴；- db 引擎足够聪明，可以在 master 故障转移时进行平衡（幸运的是）；

# c - 为什么使用 alloca() 不被认为是好的做法？

> ID：1018853
> 
> 赞同：456
> 
> 时间：2009-06-19T16:24:16.517
> 
> 标签：c, stack, malloc, allocation, alloca

`alloca()`在堆栈上而不是在堆上分配内存，如`malloc()`. 因此，当我从例程返回时，内存被释放。所以，实际上这解决了我释放动态分配内存的问题。释放通过分配的内存`malloc()`是一个令人头疼的问题，如果以某种方式错过会导致各种内存问题。

`alloca()`尽管有上述功能，为什么不鼓励使用？

* * *

## 回答 #1

> 赞同：292
> 
> 时间：2009-06-19T16:27:17.543

答案就在`man`页面中（至少在[Linux](http://man7.org/linux/man-pages/man3/alloca.3.html)上）：

> 返回值 alloca() 函数返回一个指向已分配空间开头的指针。如果分配导致堆栈溢出，则程序行为未定义。

这并不是说它永远不应该被使用。我从事的 OSS 项目之一广泛使用它，只要您不滥用它（`alloca`“巨大的价值”），就可以了。一旦超过“几百字节”标记，就该使用`malloc`和朋友了。你可能仍然会遇到分配失败，但至少你会有一些失败的迹象，而不是仅仅吹出堆栈。

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2010-08-04T23:35:07.060

我遇到的最令人难忘的错误之一是与使用`alloca`. 它在程序执行的随机点表现为堆栈溢出（因为它在堆栈上分配）。

在头文件中：

```
void DoSomething() {
   wchar_t* pStr = alloca(100);
   //......
} 
```

在实现文件中：

```
void Process() {
   for (i = 0; i < 1000000; i++) {
     DoSomething();
   }
} 
```

所以发生的事情是编译器内联`DoSomething`函数，所有的堆栈分配都发生在`Process()`函数内部，从而炸毁了堆栈。在我的辩护中（我不是发现问题的人；当我无法修复它时，我不得不去向一位高级开发人员哭泣），它不是直截了当`alloca`的，它是 ATL 字符串转换之一宏。

所以教训是——不要`alloca`在你认为可能被内联的函数中使用。

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2010-08-01T20:45:08.660

老问题，但没有人提到它应该被可变长度数组取代。

```
char arr[size]; 
```

代替

```
char *arr=alloca(size); 
```

它在标准 C99 中并且作为编译器扩展存在于许多编译器中。

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2009-06-22T23:46:08.043

如果您不能使用标准局部变量，alloca() 非常有用，因为它的大小需要在运行时确定，并且您可以 **绝对保证从 alloca() 获得的指针在此函数返回后永远不会被使用**。

你可以相当安全，如果你

*   不要返回指针或任何包含它的东西。
*   不要将指针存储在堆上分配的任何结构中
*   不要让任何其他线程使用指针

真正的危险来自其他人稍后会违反这些条件的机会。考虑到这一点，将缓冲区传递给将文本格式化到其中的函数非常有用:)

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2009-06-19T16:28:33.347

[正如此新闻组帖子](http://compilers.iecc.com/comparch/article/91-12-079)中所述，使用`alloca`被认为是困难和危险的原因有几个：

*   并非所有编译器都支持`alloca`.
*   一些编译器对预期行为的解释`alloca`不同，因此即使在支持它的编译器之间也不能保证可移植性。
*   一些实现是错误的。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2009-06-19T16:35:44.020

一个问题是它不是标准的，尽管它得到了广泛的支持。在其他条件相同的情况下，我总是使用标准函数而不是通用编译器扩展。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2013-02-26T10:31:06.390

> 仍然不鼓励使用alloca，为什么？

我不认为有这样的共识。许多强大的专业人士；一些缺点：

*   C99提供了变长数组，通常会优先使用，因为记法更符合定长数组，整体直观
*   许多系统可用于堆栈的整体内存/地址空间比堆可用的总内存/地址空间少，这使得程序更容易受到内存耗尽（通过堆栈溢出）的影响：这可能被视为一件好事或坏事 - 一个堆栈不会像堆那样自动增长的原因之一是为了防止失控的程序对整个机器产生同样多的不利影响
*   当在更局部的作用域（例如一个`while`或`for`循环）或多个作用域中使用时，内存在每次迭代/作用域中累积，并且在函数退出之前不会释放：这与在控制结构的作用域中定义的普通变量（例如`for {int i = 0; i < 2; ++i) { X }`将在 X 处累积`alloca`请求的内存，但每次迭代都会回收固定大小数组的内存）。
*   现代编译器通常不会`inline`调用函数`alloca`，但如果你强制它们，那么`alloca`它将发生在调用者的上下文中（即堆栈在调用者返回之前不会被释放）
*   很久以前`alloca`从一个不可移植的特性/hack 过渡到一个标准化的扩展，但是一些负面的看法可能会持续存在
*   生命周期绑定到函数范围，这可能比`malloc`显式控制更适合程序员
*   必须使用`malloc`鼓励考虑释放 - 如果这是通过包装函数（例如`WonderfulObject_DestructorFree(ptr)`）管理的，那么该函数为实现清理操作（如关闭文件描述符、释放内部指针或进行一些日志记录）提供了一个点，而无需显式更改客户端代码：有时它是一个很好的模型，可以始终如一地采用
    *   在这种伪 OO 风格的编程中，很自然地想要类似`WonderfulObject* p = WonderfulObject_AllocConstructor();`的东西 - 当“构造函数”是一个返回`malloc`-ed 内存的函数时，这是可能的（因为在函数返回要存储的值之后内存保持分配状态`p`），但不是如果“构造函数”使用`alloca`
        *   的宏版本`WonderfulObject_AllocConstructor`可以实现这一点，但“宏是邪恶的”，因为它们可能会与非宏代码和非宏代码发生冲突，并产生意外替换和随之而来的难以诊断的问题
    *   ValGrind、Purify 等可以检测到丢失`free`的操作，但根本无法检测到丢失的“析构函数”调用——在强制执行预期用途方面，这是一个非常微不足道的好处；一些`alloca()`实现（例如 GCC 的）使用内联宏 for `alloca()`，因此内存使用诊断库的运行时替换是不可能的`malloc`// `realloc`（`free`例如电栅栏）
*   一些实现有一些微妙的问题：例如，来自 Linux 联机帮助页：

    > 在许多系统上 alloca() 不能在函数调用的参数列表中使用，因为 alloca() 保留的堆栈空间将出现在函数参数空间中间的堆栈上。

* * *

我知道这个问题被标记为 C，但作为 C++ 程序员，我想我会使用 C++ 来说明以下的潜在效用`alloca`：下面的代码（以及[在 ideone](http://ideone.com/XIBes5)的代码）创建了一个向量跟踪堆栈分配的不同大小的多态类型（使用生命周期与函数返回相关）而不是堆分配。

```
#include <alloca.h>
#include <iostream>
#include <vector>

struct Base
{
    virtual ~Base() { }
    virtual int to_int() const = 0;
};

struct Integer : Base
{
    Integer(int n) : n_(n) { }
    int to_int() const { return n_; }
    int n_;
};

struct Double : Base
{
    Double(double n) : n_(n) { }
    int to_int() const { return -n_; }
    double n_;
};

inline Base* factory(double d) __attribute__((always_inline));

inline Base* factory(double d)
{
    if ((double)(int)d != d)
        return new (alloca(sizeof(Double))) Double(d);
    else
        return new (alloca(sizeof(Integer))) Integer(d);
}

int main()
{
    std::vector<Base*> numbers;
    numbers.push_back(factory(29.3));
    numbers.push_back(factory(29));
    numbers.push_back(factory(7.1));
    numbers.push_back(factory(2));
    numbers.push_back(factory(231.0));
    for (std::vector<Base*>::const_iterator i = numbers.begin();
         i != numbers.end(); ++i)
    {
        std::cout << *i << ' ' << (*i)->to_int() << '\n';
        (*i)->~Base();   // optionally / else Undefined Behaviour iff the
                         // program depends on side effects of destructor
    }
} 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2009-06-19T16:32:27.013

所有其他答案都是正确的。但是，如果您要分配的东西`alloca()`相当小，我认为这是一种比使用`malloc()`或其他方式更快、更方便的好技术。

换句话说，`alloca( 0x00ffffff )`它是危险的并且可能导致溢出，就像是一样多`char hugeArray[ 0x00ffffff ];`。谨慎和合理，你会没事的。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2016-03-31T22:00:52.420

这个“老”问题有很多有趣的答案，甚至是一些相对较新的答案，但我没有找到任何提到这个的答案......

> 如果使用得当且小心谨慎，始终如一地使用`alloca()` （可能是应用程序范围内的）来处理小的可变长度分配（或 C99 VLA，如果可用）可能会导致**整体堆栈增长**低于使用固定长度的超大局部数组的其他等效实现. 所以如果你小心使用它`alloca()`可能***对你的堆栈有好处。***

我在……中找到了那句话。好吧，我做了那句话。但真的，仔细想想......

@j_random_hacker 在其他答案下的评论中非常正确：避免使用有`alloca()`利于过大的本地数组不会使您的程序免受堆栈溢出的影响（除非您的编译器足够老以允许内联`alloca()`在这种情况下使用的函数，您应该升级，或者除非你使用`alloca()`内部循环，在这种情况下你应该......不要使用`alloca()`内部循环）。

我曾在桌面/服务器环境和嵌入式系统上工作过。许多嵌入式系统根本不使用堆（它们甚至不链接以支持它），原因包括认为动态分配的内存是邪恶的，因为应用程序存在内存泄漏的风险，永远不会一次重启多年，或者更合理的理由是动态内存是危险的，因为无法确定应用程序永远不会将其堆碎片化到虚假内存耗尽的程度。所以嵌入式程序员几乎没有选择。

## `alloca()`（或 VLA）可能只是适合这项工作的工具。

我已经一次又一次地看到程序员使堆栈分配的缓冲区“大到足以处理任何可能的情况”。在深度嵌套的调用树中，重复使用该（反？）模式会导致过度使用堆栈。（想象一个 20 层深的调用树，在每一层由于不同的原因，函数盲目地过度分配 1024 字节的缓冲区“只是为了安全”，而通常它只会使用 16 个或更少的缓冲区，并且仅在非常极少数情况下可能会使用更多。）另一种方法是使用`alloca()`或 VLA 并仅分配函数所需的堆栈空间，以避免不必要的堆栈负担。希望当调用树中的一个函数需要大于正常的分配时，调用树中的其他函数仍在使用它们正常的小分配，并且总体应用程序堆栈使用量明显少于每个函数盲目过度分配本地缓冲区的情况.

## 但是，如果您选择使用`alloca()`...

根据此页面上的其他答案，似乎 VLA 应该是安全的（如果从循环内调用它们不会复合堆栈分配），但如果您使用`alloca()`，请注意不要在循环内使用它，并制作如果有可能在另一个函数的循环中调用它，请*确保您的函数不能被内联。*

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2016-11-04T16:00:30.210

我认为没有人提到这一点：在函数中使用 alloca 会阻碍或禁用一些原本可以应用于函数的优化，因为编译器无法知道函数堆栈帧的大小。

例如，C 编译器的一个常见优化是消除函数中帧指针的使用，而是相对于堆栈指针进行帧访问；所以还有一个通用寄存器。但是如果在函数内部调用alloca，sp和fp的区别对于部分函数是未知的，所以这个优化是做不到的。

考虑到它的稀有性，以及它作为标准函数的可疑状态，编译器设计者很可能会禁用*任何**可能*导致 alloca 问题的优化，如果需要付出更多努力才能使其与 alloca 一起使用。

**更新：** 由于可变长度的局部数组已添加到 C 中，并且由于这些向编译器提出了与 alloca 非常相似的代码生成问题，我看到“使用稀有和可疑状态”不适用于底层机制；但我仍然怀疑使用 alloca 或 VLA 往往会损害使用它们的函数中的代码生成。我欢迎编译器设计人员提供任何反馈。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2011-03-21T16:19:04.990

每个人都已经指出了堆栈溢出的潜在未定义行为，但我应该提到，Windows 环境有一个很好的机制来使用结构化异常 (SEH) 和保护页来捕获这一点。由于堆栈只根据需要增长，因此这些保护页驻留在未分配的区域中。如果您分配给它们（通过溢出堆栈），则会引发异常。

您可以捕获此 SEH 异常并调用 _resetstkoflw 来重置堆栈并继续您的快乐方式。它并不理想，但它是另一种机制，至少可以知道当东西撞到风扇时出现了问题。*nix 可能有类似的东西，我不知道。

我建议通过包装 alloca 并在内部跟踪它来限制您的最大分配大小。如果你真的很顽固，你可以在你的函数顶部放置一些范围哨兵来跟踪函数范围内的任何 alloca 分配，并根据项目允许的最大数量检查它。

此外，除了不允许内存泄漏之外，alloca 不会导致内存碎片，这非常重要。如果你聪明地使用它，我不认为alloca是不好的做法，这基本上适用于所有事情。:-)

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2018-02-26T04:12:23.547

一个陷阱`alloca`是它`longjmp`倒带。

也就是说，如果你用 保存一个上下文`setjmp`，那么`alloca`一些内存，然后`longjmp`到上下文，你可能会丢失`alloca`内存。堆栈指针回到原来的位置，因此不再保留内存；如果你调用一个函数或做另一个`alloca`，你会破坏原来的`alloca`。

澄清一下，我在这里具体指的是一种情况，即`longjmp`不会从发生的函数中返回`alloca`！相反，函数使用`setjmp`;保存上下文。然后分配内存，`alloca`最后在该上下文中发生 longjmp。该函数的`alloca`内存并未全部释放；只是它自`setjmp`. 当然，我说的是观察到的行为；`alloca`据我所知，没有记录任何此类要求。

文档中的重点通常是`alloca`内存与*功能*激活相关联的概念，而不是与任何块相关联；多次调用`alloca`只是获取更多的堆栈内存，这些内存在函数终止时全部释放。不是这样；内存实际上与过程上下文相关联。当使用 恢复上下文时`longjmp`，先前的`alloca`状态也是如此。这是堆栈指针寄存器本身用于分配的结果，并且（必然）在`jmp_buf`.

顺便说一句，如果它以这种方式工作，它提供了一种合理的机制来故意释放分配给`alloca`.

我已经将此作为错误的根本原因。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2010-08-01T20:32:39.617

Here's why:

```
char x;
char *y=malloc(1);
char *z=alloca(&x-y);
*z = 1; 
```

Not that anyone would write this code, but the size argument you're passing to `alloca` almost certainly comes from some sort of input, which could maliciously aim to get your program to `alloca` something huge like that. After all, if the size isn't based on input or doesn't have the possibility to be large, why didn't you just declare a small, fixed-size local buffer?

Virtually all code using `alloca` and/or C99 vlas has serious bugs which will lead to crashes (if you're lucky) or privilege compromise (if you're not so lucky).

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2014-09-02T10:26:20.137

**alloca()**很好而且很高效......但它也被深深地破坏了。

*   破坏范围行为（函数范围而不是块范围）
*   使用与 malloc 不一致（**alloca()** -ted 指针不应被释放，因此您必须跟踪指针从哪里指向**free()**只有那些您使用**malloc()**获得的指针）
*   当您还使用内联时的不良行为（范围有时会转到调用者函数，具体取决于被调用者是否内联）。
*   没有堆栈边界检查
*   失败时未定义的行为（不会像 malloc 那样返回 NULL ......失败意味着什么，因为它无论如何都不检查堆栈边界......）
*   不是ANSI标准

在大多数情况下，您可以使用局部变量和主要大小来替换它。如果它用于大型对象，将它们放在堆上通常是一个更安全的想法。

如果你真的需要它 C，你可以使用 VLA（C++ 中没有 vla，太糟糕了）。在作用域行为和一致性方面，它们比 alloca() 好得多。在我看来，**VLA**是一种正确的**alloca()**。

当然，使用所需空间的主要部分的本地结构或数组仍然更好，如果您没有这样的主要堆分配，使用普通 malloc() 可能是理智的。我没有看到真正需要**alloca()**或**VLA 的合理用例。**

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2010-11-27T18:49:15.397

`alloca()`一个比内核特别危险的地方`malloc()`——典型操作系统的内核有一个固定大小的堆栈空间，硬编码到它的一个标题中；它不像应用程序的堆栈那样灵活。以不合理的大小进行调用`alloca()`可能会导致内核崩溃。某些编译器会警告`alloca()`在编译内核代码时应该打开的某些选项下（甚至是 VLA）的使用 - 在这里，最好在未通过硬编码限制固定的堆中分配内存。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2009-06-19T16:27:46.547

进程只有有限的可用堆栈空间——远远少于可用的内存量`malloc()`。

通过使用`alloca()`你，大大增加了发生 Stack Overflow 错误的机会（如果你幸运的话，或者如果你不幸运的话，则会出现莫名其妙的崩溃）。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2016-02-17T10:43:45.337

如果您不小心写入了分配的块之外`alloca`（例如由于缓冲区溢出），那么您将覆盖函数的*返回地址*，因为该地址位于堆栈的“上方”，即*在*您分配的块之后。

[![堆栈上的 _alloca 块](../Images/5adb547fc25428a6a75463d539d07988.png)](https://i.stack.imgur.com/IEx9b.gif)

这样做的后果是双重的：

1.  程序将严重崩溃，并且无法说明崩溃的原因或位置（由于被覆盖的帧指针，堆栈很可能会展开到随机地址）。

2.  它使缓冲区溢出更加危险，因为恶意用户可以制作一个特殊的有效负载，该有效负载将被放入堆栈并因此最终被执行。

相反，如果你写超出堆上的一个块，你“只是”得到堆损坏。程序可能会意外终止，但会正确展开堆栈，从而减少恶意代码执行的机会。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2011-03-30T06:58:49.993

可悲的`alloca()`是，几乎令人敬畏的 tcc 缺少真正令人敬畏的东西。Gcc 确实有`alloca()`.

1.  它播下了自己毁灭的种子。以 return 作为析构函数。

2.  就像`malloc()`它在失败时返回一个无效指针，这将在具有 MMU 的现代系统上出现段错误（并希望重新启动那些没有）。

3.  与自动变量不同，您可以在运行时指定大小。

它适用于递归。您可以使用静态变量来实现类似于尾递归的功能，并仅使用其他几个变量将信息传递给每次迭代。

如果你推得太深，你肯定会出现段错误（如果你有 MMU）。

请注意，`malloc()`当系统内存不足时，它会返回 NULL（如果分配也会出现段错误），因此不会提供更多功能。即你所能做的就是保释或尝试以任何方式分配它。

要使用`malloc()`我使用全局变量并将它们分配为 NULL。如果指针不为 NULL，我在使用之前释放它`malloc()`。

`realloc()`如果要复制任何现有数据，您也可以将其用作一般情况。如果要在`realloc()`.

[3.2.5.2 alloca的优势](http://www.gnu.org/s/hello/manual/libc/Advantages-of-Alloca.html "3.2.5.2 alloca的优势")

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2017-01-30T18:14:22.037

实际上，alloca 并不能保证使用堆栈。实际上，alloca 的 gcc-2.95 实现使用 malloc 本身从堆中分配内存。此外，该实现是错误的，如果您在块内调用它并进一步使用 goto，它可能会导致内存泄漏和一些意外行为。不是，说你永远不应该使用它，但有时 alloca 导致的开销比它释放的开销更大。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-12-13T14:36:17.440

在我看来，alloca()，如果可用，应该只以一种受约束的方式使用。非常像“goto”的使用，相当多的其他合理的人不仅对alloca()的使用，而且对alloca()的存在都有强烈的反感。

对于嵌入式使用，堆栈大小已知并且可以通过约定和分析对分配大小施加限制，并且编译器无法升级以支持 C99+，使用 alloca() 很好，我一直知道使用它。

如果可用，VLA 可能比 alloca() 有一些优势：编译器可以生成堆栈限制检查，当使用数组样式访问时，这些检查将捕获越界访问（我不知道是否有任何编译器这样做，但它可以完成），并且分析代码可以确定数组访问表达式是否正确有界。请注意，在某些编程环境中，例如汽车、医疗设备和航空电子设备，即使对于固定大小的数组，也必须进行这种分析，包括自动（在堆栈上）和静态分配（全局或本地）。

在将数据和返回地址/帧指针存储在堆栈上的架构上（据我所知，这就是全部），任何堆栈分配的变量都可能是危险的，因为可以获取变量的地址，并且未经检查的输入值可能允许各种恶作剧。

可移植性在嵌入式空间中不太受关注，但是它是反对在仔细控制的环境之外使用 alloca() 的一个很好的论据。

在嵌入空间之外，我主要在日志记录和格式化函数中使用 alloca() 以提高效率，并在非递归词法扫描器中使用临时结构（使用 alloca() 分配）在标记化和分类期间创建，然后是持久的对象（通过 malloc() 分配）在函数返回之前被填充。对于较小的临时结构使用 alloca() 可以大大减少分配持久对象时的碎片。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-08-05T17:08:22.937

为什么没有人提到 GNU 文档介绍的这个例子？

[https://www.gnu.org/software/libc/manual/html_node/Advantages-of-Alloca.html](https://www.gnu.org/software/libc/manual/html_node/Advantages-of-Alloca.html)

> 完成的非本地退出`longjmp`（请参阅[非本地退出](https://www.gnu.org/software/libc/manual/html_node/Non_002dLocal-Exits.html)`alloca`）在通过调用的函数退出时自动释放分配的空间`alloca`。**这是使用的最重要原因 `alloca`**

建议阅读顺序`1->2->3->1`：

1.  [https://www.gnu.org/software/libc/manual/html_node/Advantages-of-Alloca.html](https://www.gnu.org/software/libc/manual/html_node/Advantages-of-Alloca.html)
2.  [非本地出口的](https://www.gnu.org/software/libc/manual/html_node/Non_002dLocal-Exits.html)[介绍](https://www.gnu.org/software/libc/manual/html_node/Non_002dLocal-Intro.html)和[详细](https://www.gnu.org/software/libc/manual/html_node/Non_002dLocal-Details.html)信息
3.  [Alloca 示例](https://www.gnu.org/software/libc/manual/html_node/Alloca-Example.html)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-12-30T22:29:57.113

我认为没有人提到过这一点，但是 alloca 也有一些严重的安全问题，malloc 不一定存在（尽管这些问题也出现在任何基于堆栈的数组中，无论是否动态）。由于内存是在堆栈上分配的，因此缓冲区溢出/下溢比仅使用 malloc 具有更严重的后果。

特别是，函数的返回地址存储在堆栈中。如果此值损坏，您的代码可能会转到内存的任何可执行区域。编译器竭尽全力使这变得困难（特别是通过随机化地址布局）。但是，这显然比堆栈溢出更糟糕，因为如果返回值损坏，最好的情况是 SEGFAULT，但它也可能开始执行随机的内存块，或者在最坏的情况下，某些内存区域会危及程序的安全性.

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-09-17T16:48:04.927

IMO 使用 alloca 和可变长度数组的最大风险是，如果分配大小出乎意料地大，它可能会以非常危险的方式失败。

堆栈上的分配通常不检查用户代码。

现代操作系统通常会在下面放置一个保护页面*以检测堆栈溢出。当堆栈溢出时，内核可能会扩展堆栈或终止进程。Linux 在 2017 年扩展了这个保护区，使其比页面大得多，但它的大小仍然是有限的。

因此，作为一项规则，在使用之前的分配之前，最好避免在堆栈上分配多于一个页面。使用 alloca 或可变长度数组很容易导致攻击者在堆栈上进行任意大小的分配，从而跳过任何保护页并访问任意内存。

* 在当今最广泛的系统上，堆栈向下增长。

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2017-04-28T14:31:41.020

`_alloca()`这里的大多数答案很大程度上都没有抓住重点：使用可能比仅仅在堆栈中存储大对象更糟糕是有原因的。

与自动存储的主要区别在于`_alloca()`后者存在一个额外的（严重的）问题：分配的块*不受编译器控制*，因此编译器无法优化或回收它。

相比：

```
while (condition) {
    char buffer[0x100]; // Chill.
    /* ... */
} 
```

和：

```
while (condition) {
    char* buffer = _alloca(0x100); // Bad!
    /* ... */
} 
```

后者的问题应该很明显。

# jquery - 使用 jQuery 查找带有文本的元素

> ID：1018855
> 
> 赞同：8
> 
> 时间：2009-06-19T16:24:38.810
> 
> 标签：jquery, textnode

我想在包含文本字符串的 div 中创建一个包含所有 html 元素的数组，例如

```
<p>some string</p>. 
```

我不想获取字符串，我希望数组项成为元素（在示例中，将是 p 节点）。我事先不知道字符串是什么，所以我无法查找要匹配的字符串值。我也不希望空文本节点最终出现在数组中。

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-19T17:54:37.383

```
$("#my_div *").filter(function()
{
     var $this = $(this);
     return $this.children().length == 0 && $.trim($this.text()).length > 0;
}) 
```

此版本将不返回包含具有文本的元素的父元素，仅返回最后一级元素。

可能不是最快的，但在 StackOverflow 主页上效果很好:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-19T17:04:14.077

在您的情况下，自定义选择器可能会有所帮助：

```
jQuery.expr[':'].hasText = function(element, index) {
     // if there is only one child, and it is a text node
     if (element.childNodes.length == 1 && element.firstChild.nodeType == 3) {
        return jQuery.trim(element.innerHTML).length > 0;
     }
     return false;
}; 
```

之后，您可以简单地执行以下操作：

```
$('#someDiv :hasText') // will contain all elements with text nodes (jQuery object)
$('#someDiv :hasText').get() // will return a regular array of plain DOM objects 
```

我假设您只是想选择其中只有文本的元素。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T16:55:29.453

您可以使用 not 和空选择器来获取非空元素，同时可以使用 get 实现转换为数组

```
$("#theDiv > :not(:empty)").get(); 
```

上面的选择器获取“theDiv”的所有不为空的子元素（即它们有子元素或文本），然后将匹配的集合转换为数组。

如果您只想要其中包含文本的元素，这应该可以...

```
$("#theDiv > :not(:empty, :has(*))").get(); 
```

要摆脱有空格的元素，您可以使用过滤器

```
$("#theDiv > :not(:has(*))").filter(function() { 
                 return $.trim(this.innerHTML).length > 0;
         }).get(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T16:31:29.387

您可以循环遍历[孩子](http://docs.jquery.com/Traversing/children#expr)并获取具有[.text()](http://docs.jquery.com/Attributes/text)值的所有内容`!= ""`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T16:45:32.787

```
var array = [];
var divSelector = "div.mine";

$(divSelector).contents().each(function()
{
   // If not an element, go to next node.
   if (this.nodeType != 1) return true;       

   var element = $(this);
   if ($.trim(element.text()) != "")
     array.push(element);
}); 
```

`array`是其中包含一些文本的元素数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-19T16:40:32.037

d 是您要在其下查找内容的 div
v 是一个空数组
i 您必须从 0 开始。

使用 $.trim 是为了您不会得到只是空白的节点。

```
$("*",d).filter( function() { 
     return $.trim($(this).text()) != ""
  } ).each( function() { 
     v[i] = $(this).text(); 
     i++; 
  } ); 
```

也可以使用 v.push($(this))... 这完全让我忘记了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T17:17:23.340

使用 :contains 选择器：

```
var matches = new Array();
$('#start_point *:contains(' + text + ')').each(function(i, item) {
 matches.push( item );
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T16:47:10.867

```
 $(function() {
        var array = new Array();
        $("#testDiv *").each(function(x, el) {

            if ($.trim($(el).text()) != '' ) {
                array.push(el);
            }
        });
        alert(array.length);
    }); 
```

# gdi+ - 来自另一个图像的 Gdiplus 掩码图像

> ID：1018868
> 
> 赞同：1
> 
> 时间：2009-06-19T16:28:06.390
> 
> 标签：gdi+, mask, alphablending

有没有办法使用另一个图像的 alpha 来操作图像的 alpha？

假设我有一个图像，我想改变它的 alpha 从左边不透明开始在右边完全透明，目前我用 LinearGradientBrush 绘制另一个图像，并通过逐个像素循环从第二个图像设置原始图像的 alpha，在 Gdiplus 中有另一种方法吗，一些图像蒙版，或混合两个图像的阿尔法？

结论：在 GDI+ 中似乎没有办法混合两个图像，唯一的方法似乎是通过像素迭代的手动方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T13:34:48.003

我认为您是正确的，因为您必须逐个像素地执行此操作。我还寻找了一种更“纯粹”的方式来做到这一点，但这就是我最终得到的：

```
 public enum ChannelARGB
    {
        Blue = 0,
        Green = 1,
        Red = 2,
        Alpha = 3
    }

    public static void transferOneARGBChannelFromOneBitmapToAnother(
        Bitmap source,
        Bitmap dest,
        ChannelARGB sourceChannel,
        ChannelARGB destChannel )
    {
        if ( source.Size!=dest.Size )
            throw new ArgumentException();
        Rectangle r = new Rectangle( Point.Empty, source.Size );
        BitmapData bdSrc = source.LockBits( r, ImageLockMode.ReadOnly, PixelFormat.Format32bppArgb );
        BitmapData bdDst = dest.LockBits( r, ImageLockMode.ReadWrite, PixelFormat.Format32bppArgb );
        unsafe
        {
            byte* bpSrc = (byte*)bdSrc.Scan0.ToPointer();
            byte* bpDst = (byte*)bdDst.Scan0.ToPointer();
            bpSrc += (int)sourceChannel;
            bpDst += (int)destChannel;
            for ( int i = r.Height * r.Width; i > 0; i-- )
            {
                *bpDst = *bpSrc;
                bpSrc += 4;
                bpDst += 4;
            }
        }
        source.UnlockBits( bdSrc );
        dest.UnlockBits( bdDst );
    } 
```

# c++ - 针对 March09SDK 编译 DX 9.0c 应用程序 => 无法使用旧的 DX 9.0c DLL 运行 => 问题 :)

> ID：1018872
> 
> 赞同：0
> 
> 时间：2009-06-19T16:29:12.957
> 
> 标签：c++, directx, direct3d9

我无法从主题中做一个场景。

我安装了 DirectX 9 March 2009 SDK，即 9，“sub”-version c，但“sub-sub”-version 是 41，所以 libs (d3dx9.lib d3d9.lib) 将导出链接到 dxd3d_41.dll。

当我尝试在具有 DX9.0c 但从 2009 年 3 月起不可再分发的机器上运行我的应用程序时会发生什么现在很明显:)，它失败了，因为它找不到 dxd3d_41.dll。

哪个是这个问题的标准解决方案？我应该如何编译我的应用程序以使所有具有 DX 9.0c 的机器都支持？这甚至可以实现吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T16:33:48.357

您需要安装与您用于编译的 SDK 相匹配的运行时。

强制它在所有安装了 DirectX9c 的机器上工作的唯一方法是使用旧的 SDK（第一个 9.0c SDK）。但是，我强烈建议避免这种情况。最好只使用 March 09，并在安装应用程序的同时安装 March 运行时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-18T09:15:17.497

最简单的解决方案是在您的下载页面上链接到 Microsoft DirectX 最终用户运行时更新程序，并告诉人们首先运行它以确保运行时组件是最新的，然后再安装您的应用程序。

之后，下一个最简单的事情是将必要的运行时更新程序与您的应用程序捆绑在一起，并让用户在运行安装程序之前运行它。

所有这些都记录在 SDK 文档中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T10:36:19.297

规则是，如果您链​​接到 d3dx9，那么您应该确保已安装所需的 redist 运行时组件。

查看 DXSDK 文档中的“面向游戏开发人员的 DirectX 安装”页面。

# powershell - Powershell Golf：下一个工作日

> ID：1018873
> 
> 赞同：3
> 
> 时间：2009-06-19T16:29:23.863
> 
> 标签：powershell

如何使用 powershell 查找下一个工作日？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-19T17:53:29.223

好吧，我的手机允许我设置工作日，但 Windows/.NET 不会，所以我假设是星期一到星期五。

注意：由于问题包括“高尔夫”，我正在打这个，即尝试使用尽可能少的字节作为脚本。因此，代码不一定是可读的。

最简单和最直接的方法是从今天开始，添加一天并查看它是否在想要的范围内：

```
PS> $d = [DateTime]::Now.AddDays(1); while ($d.DayOfWeek -eq "Saturday" -or $d.DayOfWeek -eq "Sunday") { $d = $d.AddDays(1) }; $d
Montag, 22\. Juni 2009 19:50:27 
```

不过，我们可以缩短一点：

```
PS> $d=(Get-Date)+"1";for(;6,0-contains$d.DayOfWeek){$d+="1"}$d
Montag, 22\. Juni 2009 19:52:31 
```

但我们也可以使用管道进行不同的尝试。下一个工作日至少是一天，最多三天，所以我们可以生成一个可能的日期列表并相应地过滤它们，最后选择第一个：

```
PS> @(1..3|%{(Get-Date).AddDays($_)}|?{$_.DayOfWeek -ge "Monday" -and $_.DayOfWeek -le "Friday"})[0]
Montag, 22\. Juni 2009 22:11:19 
```

或更短：

```
PS> @(1..3|%{(Get-Date)+"$_"}|?{1..5-contains$_.DayOfWeek})[0]
Montag, 22\. Juni 2009 19:55:53 
```

通过让范围变为 4，我们可以保证它总是返回至少两个工作日，并保存 @ 运算符来强制数组：

```
PS> (1..4|%{(Get-Date)+"$_"}|?{1..5-contains$_.DayOfWeek})[0]
Montag, 22\. Juni 2009 20:24:06 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-21T12:39:07.490

这也很短（但使用别名）：

```
,(1,2-eq7-(date).dayofweek)|%{(date)+"$(1+$_[0])"} 
```

在一个单一的声明中：

```
(date)+"$(1+$(@(1,2-eq7-(date).dayofweek)))" 
```

* * *

关于这种方法的一些注意事项：

*   在 Powershell（至少 v1）中，与集合的比较返回条件为真的项目，例如：

    `PS> 1,2 -eq 1`
    `PS> 1`

*   我正在利用这样一个事实，即`today + 1`计算下一个工作日的规则的实际例外情况只有周五（+3 天）和周六（+2 天）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T18:32:38.710

这是另一种管道方式：

```
(@(1..4) | foreach { if (([datetime]::Now.AddDays($_)).DayOfWeek -ne "Sunday" -and ([datetime]::Now.AddDays($_)).DayOfWeek -ne "Saturday") {[datetime]::Now.AddDays($_); }})[0] 
```

不知道为什么我必须使用 (1..4) 而不是 (1..3) 但是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-24T18:04:34.773

我发现第一个答案中的示例代码真的很难理解，所以我重写了它以便更容易看到发生了什么。我仍在使用 -eq 测试将返回匹配值的 -eq 行为。

```
$date = get-date "2013 Apr 24"

write-host "Based on your date"
$date

write-host "next business day (skipping saturday and sunday)"
$Date.AddDays(1 + $(1,2 -eq 7 - [int]$date.dayofweek) )

write-host "Next week monday"
$Date.AddDays(1 + $(0,1,2,3,4,5,6,7 -eq 7 - [int]$date.dayofweek) ) 
```

# svn - 将公司从 SVN 转换为 Hg？

> ID：1018874
> 
> 赞同：16
> 
> 时间：2009-06-19T16:29:54.113
> 
> 标签：svn, version-control, mercurial

我们在这里是 SVN 的重度用户。虽然 GIT 相对于 SVN 的优势让我们想要改变，但 Hg 相对于 SVN 的优势意味着现在是时候改变了，我们需要尽快开始这样做。

我对客户端并不那么担心，但这是我的问题。

1.  在 SVN 上有一些关于设置文件元属性、正确组织项目等方面的优秀书籍。Hg 的那本书是什么？

2.  有没有办法转换一个 SVN 存储库（你已经使用过）并且可以报告它的进展情况？如果可能，我们不想丢失多年的提交日志。

3.  当您转换时，您是如何拆分旧代码的？您是否将主干作为一个项目提交，并将标签/分叉作为另一个项目提交？

4.  如果您将 SVN 用于遗留工作，您是否签入了 SVN 的更新或其他内容？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-19T17:32:42.933

1.  [http://hgbook.red-bean.com/](http://hgbook.red-bean.com/)上有一本免费书籍，[由 O'Reilly](https://rads.stackoverflow.com/amzn/click/com/0596800673)于 2009 年出版。

2.  从 0.9.5 版开始，Mercurial 带有一个[转换工具](http://www.selenic.com/mercurial/wiki/RepositoryConversion#Subversion)。

3.  我必须承认我改用 Git 而不是 Mercurial。也就是说，使用 Git，您可以在同一个存储库中同时导入分支、标签和主干。Git 照顾每个人，优雅地将标签存储为标签，将分支存储为分支，将主干存储为主分支。我相信这与 Mercurial 几乎相同。

4.  我建议您尽快切换到 Mercurial（或 Git 或任何其他 DVCS）。不要继续在两个不同的存储库上工作。当我切换时，只要我对 Git 有足够的信心，我就会一直使用 svn（git-svn 使你可以从 git 到 svn 进行交互，反之亦然）。然后我进行了切换并锁定了 SVN 存储库。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-02T23:27:45.320

请首先访问[Mercurial wiki](http://mercurial.selenic.com/wiki/)。在那里您会找到一个名为**Mercurial: The Definitive Guide**的显着链接，该链接链接到名为[hg](http://hgbook.red-bean.com/read/)的书。你可能知道 Subversion 的[svn 书](http://svnbook.red-bean.com/)——这是 Mercurial 的等价物（它们甚至托管在同一台服务器上，但由不同的作者编写）。

在 wiki 首页的下方，您会发现来自其他版本控制系统的难民部分。有一个包含[SVN 用户](http://mercurial.selenic.com/wiki/WorkingWithSubversion)和[存储库转换](http://mercurial.selenic.com/wiki/RepositoryConversion)信息的链接。前者解释说，如果你想在 Subversion 和 Mercurial 之间进行双向转换，可以尝试[HgSubversion ，后者解释如何使用](http://bitbucket.org/durin42/hgsubversion/)[convert 扩展](http://mercurial.selenic.com/wiki/ConvertExtension)来进行（可能的增量）Subversion -> Mercurial 转换。

您是否已经找到这些页面中的任何一个？如果没有，请告诉我们如何改进这些页面，以便更容易找到这些内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-07-02T23:38:14.410

我已经开始了几次从 Subversion 到其他东西的转换，一次到 Darcs，现在我正在使用 Git。很久以前，我还从 CVS 到 Subversion 做了一个相当大的转变。

我最大的建议是，不要一次做所有事情。选择一个不平凡但不是很大的项目，然后先转换它。为学习系统和调整工作流程分配合理的时间预算（前几周每个开发人员每天一小时并不是不合理的）。大约一个月后，一旦您在几个开发人员中对系统有相当多的经验，那么您可以考虑转换其他所有内容，如果您仍然觉得您甚至想要这样做的话。当您这样做时，请确保您的具有新 VCS 经验的开发人员可供其他人使用，理想情况下，应该与正在转换的任何人在同一个房间里工作。

哦，是的，这确实假设您已经对系统进行了相当多的操作，并使用它构建了一个“玩具”项目。不过，这不是玩具：它应该至少涉及三个开发人员、几十个文件、数百个提交，并且应该使用类似于您的一个真实项目的工作流程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T15:30:15.320

有一个关于分布式 Subversion 的[讨论](http://subversion.tigris.org/ds/viewMessage.do?dsForumId=1065&dsMessageId=2359309)(pro v con)，其中一些涉及 SVN 不如 DVCS 做得好的项目，反之亦然，但在长时间的讨论中有很多有用的信息任何想迁移公司 VCS 的人。

要直接跳到好帖子，试试[这个](http://subversion.tigris.org/ds/viewMessage.do?dsForumId=1065&dsMessageId=2360938)。

如果您决定从 SVN 购买 DVCS，也许您应该查看[git-svn](http://git-scm.com/docs/git-svn)，它允许在 svn 存储库和 git 前端之间进行双向更改。它应该给你两全其美，尽管使用 git 而不是 mercurial。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-15T04:59:55.350

我有一个相当大的颠覆存储库，其中每个主文件夹都是一个模块。为了拆分它，我使用了以下咒语：

```
for i in *; do \
    echo include "\"${i}\"" > /tmp/hgv.map; \
    echo rename "\"${i}\"" . >> /tmp/hgv.map; \
    hg convert --filemap /tmp/hgv.map /mnt/e/sqlwork/ "/mnt/h/work/${i}"; \
done 
```

它获取当前目录中的每个文件夹，为 convert 子命令生成文件映射并将目录转换为 hg 存储库。我没有历史损失，也没有遇到其他障碍。您可能想看看[转换扩展](http://mercurial.selenic.com/wiki/ConvertExtension)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-30T09:16:33.313

1.  [Joel Spolsky](http://www.joelonsoftware.com/)的[hginit.com](http://hginit.com)是一个非常好的介绍。
2.  我使用`hg convert`插件将（原文如此）我的 Subversion 存储库转换为 Mercurial 版本。工作得很好。有关详细信息，请参阅[插件文档](http://mercurial.selenic.com/wiki/ConvertExtension)。（当然）[还有其他方式](http://mercurial.selenic.com/wiki/RepositoryConversion#Subversion)。
3.  `hg convert`确实复制了完整的 svn 集，包括分支和标签（以及您的存储库中存在的任何其他目录结构）。
4.  使用单一版本控制系统要好得多，但如果需要，您可以使用[hgsubversion](http://mercurial.aragost.com/kick-start/en/hgsubversion/)插件与 subversion 链接。

# php - 解析 Excel 电子表格数据与 CSV 的优势？

> ID：1018880
> 
> 赞同：2
> 
> 时间：2009-06-19T16:31:32.507
> 
> 标签：php, mysql, excel, csv

我在 Excel 电子表格中列出了数据（文件大小可能永远不会大于 1 mb）。我想使用 PHP 解析数据并插入 MySQL 数据库。

将文件保存为 .xls/.xlsx 并使用 PHP Excel 解析库解析它有什么好处吗？如果是这样，有哪些好的库可以使用？

显然，我可以将 .xls/.xlsx 保存为 CSV 并以这种方式处理文件。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-19T16:38:05.140

如果您只是在值之后，我会将其保存为 CSV。这更容易以编程方式解析，特别是如果您尝试在非 Windows 机器上执行此操作。

话虽如此，在导出到 CSV 时会丢失信息。它只会保存单元格的值 - 而不是它们的格式信息、公式等。如果您需要使用该信息，最好直接从 Excel 中执行此操作。

这是一个[PHP Excel 阅读](http://sourceforge.net/projects/phpexcelreader/)库。如果您决定直接阅读 Excel 文件，这可能有助于您入门。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T13:22:07.123

when you provide a way for customers to upload excel/csv files, you should consider that

1.  CSV files will only export one sheet
2.  Having multiline cells will make the CSV parsing complicated
3.  You cannot easily detect corrupted/incomplete CSV files
4.  CSV files do not include formatting

Besides from that, importing CSV is a lot easier than importing XLS.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T16:41:22.707

如果您的 excel 文件包含严格的数据并且不包含公式、脚本、宏等，我会说通过 Excel 解析只会增加开发开销，并且可能会减慢处理速度。在这种情况下，最好将文件转换为 CSV。

还要考虑 MySQL 的 'LOAD DATA INFILE' 命令可用于将整个 CSV 文件导入表中，这可能会使您的事情变得更简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-20T11:29:28.130

请记住，如果您将 csv 文件直接导入 Mysql，您可能会遇到日期格式问题（因为 Mysql 使用与 Excel 不同的日期格式）。我发现在保存为 csv 文件之前先更改 Excel 中的日期字段（格式化 yyyy-mm-dd）更容易。编辑：虽然我自己没有使用过，但其他人推荐 Navicat 作为将 Excel 电子表格或 Access 数据转换为 Mysql 数据库的非常好的工具。可能值得一看。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-20T11:52:26.663

Office 2003 有一种称为SpreadsheetML 的XML 格式，它介于XML 和Excel 之间。我考虑过使用这种格式将数据导入/导出到网站，但这种格式有点复杂。在内部，这种格式将所有引用转换为相对引用。（相对于当前位置。）更糟糕的是，某些单元格有索引，因此您可能会看到一行只有两个单元格，但第二个单元格可能距第一个单元格 6 列。（在这种情况下Index=5。）基本上，如果你想使用Excel格式，你需要有一个很好的方法来计算每个单元格的位置，并知道如何以正确的方式翻译单元格中的引用。如果您只对数据感兴趣，那么 CSV 会更容易实现。作为中间解决方案，您可以定义 XML 模式并将 XML 映射添加到电子表格中，以将数据导出到 XML 文件。它比 CSV i9mport/export 更复杂，但也更强大。但是 Excel 或 Excel XML 格式本身很难实现。（或者只是一个不错的挑战，如果您是真正的 XML 专家。）

# c# - NumberFormat 有效，但值仍然不同

> ID：1018882
> 
> 赞同：1
> 
> 时间：2009-06-19T16:32:30.837
> 
> 标签：c#, excel, excel-2007, number-formatting

我正在使用 C# 在 Excel-2007 中执行操作。我有以下代码

```
 object mis = Type.Missing;
   Excel.Workbook wb = (Excel.Workbook)Globals.ThisAddIn.GetActiveWorkbook();
   Excel.Worksheet ws = (Excel.Worksheet)wb.Worksheets.Add(mis, mis, mis, mis);
   Excel.Range range = (Excel.Range)ws.get_Range("A1", "HM232");
   range.Formula = "Sheet4!A1:HM232*0.56+Sheet5!A1:HM232*0.45";
   range.NumberFormat = "0"; 
```

它正确地将所有单元格显示为整数十进制数字，没有任何小数点...但是如果我请求单元格 G5 中的值，我会看到 1，但是当我执行以下操作时

```
 MsgBox Range("G5").Value2 
```

它向我展示了 0.933333222，你是如何做到的，以便 Value2 也被四舍五入的值改变......？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T21:14:57.193

您可以将值转换为整数，以确保将其四舍五入为最接近的整数，例如

```
MsgBox Convert.ToInt32(Range.("G5").Value2) 
```

# python - .filter() vs .get() 用于单个对象？（姜戈）

> ID：1018886
> 
> 赞同：160
> 
> 时间：2009-06-19T16:33:11.820
> 
> 标签：python, django, django-models, backend, django-queryset

我正在和一些同事就这个问题进行辩论。当您只需要一个对象时，是否有一种首选方法可以在 Django 中检索对象？

两种明显的方式是：

```
try:
    obj = MyModel.objects.get(id=1)
except MyModel.DoesNotExist:
    # We have no object! Do something...
    pass 
```

和：

```
objs = MyModel.objects.filter(id=1)

if len(objs) == 1:
    obj = objs[0]
else:
    # We have no object! Do something...
    pass 
```

第一种方法在行为上似乎更正确，但在控制流中使用了异常，这可能会引入一些开销。第二个更迂回，但永远不会引发异常。

关于这些中哪一个更可取的任何想法？哪个更有效率？

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-06-19T20:04:19.443

[`get()`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#django.db.models.query.QuerySet.get)是[专门针对这种情况](https://docs.djangoproject.com/en/stable/topics/db/queries/#retrieving-a-single-object-with-get)提供的。用它。

选项 2 几乎正是该`get()`方法在 Django 中的实际实现方式，因此应该没有“性能”差异（而且您正在考虑它的事实表明您违反了编程的基本规则之一，即试图在编写和分析代码之前优化代码——在你拥有代码并可以运行它之前，你不知道它将如何执行，并且在此之前尝试优化是一条痛苦的道路）。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-06-20T02:19:06.907

您可以安装一个名为[django-annoying](http://bitbucket.org/offline/django-annoying/)的模块，然后执行以下操作：

```
from annoying.functions import get_object_or_None

obj = get_object_or_None(MyModel, id=1)

if not obj:
    #omg the object was not found do some error stuff 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-06-19T20:08:30.043

1 是正确的。在 Python 中，异常的开销与返回的开销相同。对于一个简化的证明，你可以看看[这个](http://paltman.com/2008/jan/18/try-except-performance-in-python-a-simple-test/)。

2 这就是 Django 在后端所做的。如果没有找到项目或找到多个对象，则`get`调用并引发异常。`filter`

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2014-05-14T10:11:18.900

我参加聚会有点晚了，但是在 Django 1.6 中有`first()`关于查询集的方法。

[https://docs.djangoproject.com/en/dev/ref/models/querysets/#django.db.models.query.QuerySet.first](https://docs.djangoproject.com/en/dev/ref/models/querysets/#django.db.models.query.QuerySet.first)

* * *

> 返回查询集匹配的第一个对象，如果没有匹配的对象，则返回 None。如果 QuerySet 没有定义排序，则查询集会自动按主键排序。

例子：

```
p = Article.objects.order_by('title', 'pub_date').first()
Note that first() is a convenience method, the following code sample is equivalent to the above example:

try:
    p = Article.objects.order_by('title', 'pub_date')[0]
except IndexError:
    p = None 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-06-20T01:25:03.430

为什么所有这些工作？用 1 个内置快捷方式替换 4 行。（这有自己的尝试/除外。）

```
from django.shortcuts import get_object_or_404

obj = get_object_or_404(MyModel, id=1) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-06-19T16:45:23.160

我无法谈论 Django 的任何经验，但选项 #1 清楚地告诉系统您正在请求 1 个对象，而第二个选项则没有。这意味着选项 #1 可以更轻松地利用缓存或数据库索引，尤其是在您过滤的属性不能保证唯一的情况下。

此外（再次推测）第二个选项可能必须创建某种结果集合或迭代器对象，因为 filter() 调用通常会返回许多行。你可以用 get() 绕过它。

最后，第一个选项既短又省略了额外的临时变量——只有很小的区别，但每一点都有帮助。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-06-20T01:32:03.853

有关异常的更多信息。如果他们不被提高，他们几乎没有成本。因此，如果您知道您可能会得到结果，请使用异常，因为使用条件表达式您每次都要付出检查的成本，无论如何。另一方面，当它们被提出时，它们的成本比条件表达式要多一点，所以如果你不希望得到某个频率的结果（比如，30% 的时间，如果内存服务的话），条件检查结果是要便宜一点。

但这是 Django 的 ORM，可能是到数据库的往返，甚至是缓存的结果，很可能会支配性能特征，所以有利于可读性，在这种情况下，因为您期望只有一个结果，所以使用`get()`.

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-01-16T11:46:08.337

我玩过这个问题，发现选项 2 执行两个 SQL 查询，对于这样一个简单的任务来说，这是多余的。看我的注释：

```
objs = MyModel.objects.filter(id=1) # This does not execute any SQL
if len(objs) == 1: # This executes SELECT COUNT(*) FROM XXX WHERE filter
    obj = objs[0]  # This executes SELECT x, y, z, .. FROM XXX WHERE filter
else: 
    # we have no object!  do something
    pass 
```

执行单个查询的等效版本是：

```
items = [item for item in MyModel.objects.filter(id=1)] # executes SELECT x, y, z FROM XXX WHERE filter
count = len(items) # Does not execute any query, items is a standard list.
if count == 0:
   return None
return items[0] 
```

通过切换到这种方法，我能够大大减少我的应用程序执行的查询数量。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-12-25T18:54:14.540

**。得到（）**

> 返回与给定查找参数匹配的对象，该参数应采用字段查找中描述的格式。
> 
> 如果找到多个对象，get() 将引发 MultipleObjectsReturned。MultipleObjectsReturned 异常是模型类的一个属性。
> 
> 如果未找到给定参数的对象，get() 将引发 DoesNotExist 异常。这个异常也是模型类的一个属性。

**。筛选（）**

> 返回一个新的 QuerySet，其中包含与给定查找参数匹配的对象。

**笔记**

> 当您想要获取单个唯一对象时使用 get()，当您想要获取与查找参数匹配的所有对象时使用 filter()。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-19T16:36:26.263

有趣的问题，但对我来说，选项 #2 带有过早优化的味道。我不确定哪个性能更高，但选项#1 对我来说确实看起来和感觉更 Pythonic。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-08-15T07:50:27.500

我建议一个不同的设计。

如果要对可能的结果执行功能，可以从 QuerySet 派生，如下所示：[http ://djangosnippets.org/snippets/734/](http://djangosnippets.org/snippets/734/)

结果非常棒，例如，您可以：

```
MyModel.objects.filter(id=1).yourFunction() 
```

在这里，过滤器返回一个空查询集或一个包含单个项目的查询集。您的自定义查询集函数也是可链接和可重用的。如果您想为所有条目执行它：`MyModel.objects.all().yourFunction()`.

它们也非常适合用作管理界面中的操作：

```
def yourAction(self, request, queryset):
    queryset.yourFunction() 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-22T11:40:02.477

选项 1 更优雅，但一定要使用 try..except。

根据我自己的经验，我可以告诉您，有时您确定数据库中不可能有多个匹配的对象，但仍然会有两个……（当然，通过主键获取对象时除外）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-10-22T10:16:46.893

很抱歉在这个问题上再添加一个，但我正在使用 django 分页器，在我的数据管理应用程序中，允许用户选择要查询的内容。有时这是文档的 id，但除此之外它是返回多个对象的一般查询，即 Queryset。

如果用户查询 id，我可以运行：

```
Record.objects.get(pk=id) 
```

这会在 django 的分页器中引发错误，因为它是一个记录而不是记录的查询集。

我需要运行：

```
Record.objects.filter(pk=id) 
```

它返回一个包含一个项目的查询集。然后分页器工作得很好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-25T20:15:04.147

**".get()"**可以返回**一个带有花括号 "{}" 的最外对象**：

```
{
  "name": "John",
  "age": "26",
  "gender": "Male"
} 
```

**".filter()"**可以返回**一个或多个对象的列表（集合），其中最外的方括号 "[]"**：

```
[
  {
    "name": "John",
    "age": "26",
    "gender": "Male"
  },
  {
    "name": "Tom",
    "age": "18",
    "gender": "Male"
  },
  {
    "name": "Marry",
    "age": "22",
    "gender": "Female"
  }
] 
```

# c++ - 希望进入回合制网页游戏业务

> ID：1018888
> 
> 赞同：1
> 
> 时间：2009-06-19T16:33:29.837
> 
> 标签：c++

好的，让我们从关于我自己的信息开始......这样就没有不遗余力。

1.  我是成年人，27岁。所以这不是一个笑话或一时的时尚。我喜欢计算机，它们是如何工作的，以及应用程序和游戏是如何从头开始设计和制作的。

2.  我有零编程背景。我上大学是为了错误的事情。我从小就喜欢电子游戏，应该走这条路。

3.  我刚拿起一本名为 C++ 的书，毫无畏惧。我已经读完了前三章，我还没有关于自学这个主题的问题……但是……哈哈。

我在大约 3000 页上编写并绘制了一些游戏创意。我把我的一款游戏带给了一些网站开发者，我收到的最便宜的制作游戏的报价是 16k 和 3 个月的时间。现在我现在不是超级天才或头脑聪明的人......但是来吧...... 16k？我想……是时候自学如何制作这些游戏了……是的，这可能需要 2 到 4 年，但至少我会学会如何编写自己的代码，并且永远不必为这种服务付费。

所以我四处询问我应该学习什么，我被告知 C++ 是一个很好的起点......这是正确的吗？

2... 我写下并玩过所有数学问题的游戏中有 2 种在这个游戏时尚中有点像。www.goallineblitz.com。如果这里有人可以注册并查看该游戏并让我知道您作为编码人员需要哪些工具来制作这种风格的游戏......我将非常感谢您提供的信息。

我还能从这里去哪里？你会做什么和计划？

我知道我面前有一座大山。我期待在这次冒险中我将忍受的每一步，跌倒、跌倒和膝盖流血……

=）提前谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-19T16:41:21.193

我祝你好运，但你必须意识到在这种情况下你是第 1238471920847 个人，其中大约 3 人设法弄清楚他们在做什么。在 stackoverflow 上甚至还有类似的问题。最有用的答案是“重新考虑你是否对编码或游戏设计感兴趣——两者并不等同”

此外，您必须意识到 16k 是一个不合理的数字。不是因为它高，而是因为它低。[以 Braid](http://en.wikipedia.org/wiki/Braid_(video_game))为例，它是一款非常成功的“独立”游戏。它花费了 20 万美元，开发人员一开始就已经知道自己在做什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-19T16:44:40.960

有很多东西要学，你会感到惊讶。

我认为你应该做的是找到一个聪明的年轻 Web 开发人员，他有兴趣将一些时间投入到创业公司中，以获得一定比例的业务份额。您可以贡献游戏的知识产权和创意方向。我想这会让你以低于 5000 美元的成本启动和运行，包括注册费用、网站成本（最低）、商标等。你可以通过自己做生意来省钱，也可以让你的合作伙伴自己做编程.

这是双赢的。你构建了你的游戏，开发者在他们的简历中获得了很多很棒的经验（以及任何利润的一部分）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T16:50:47.540

坦率地说，我认为您对所涉及的工作量的估计非常低。在 3 个月内从规范到完成的网络产品对我来说听起来相当不错，包括质量保证（这里非常重要的事情）以及图形和声音之类的东西，而且 16000 美元对于三个月的工作来说听起来也很不错。（说真的，作为承包商，假设只有一个人，这就是每年 64000 美元。任何能做这种事情的人都可以赚到更多的钱。）

话虽这么说，自己动手会教给你很多东西。只是不要将其视为可能的收入来源。

如果您对基于 Web 的游戏感兴趣，那么您需要熟悉的不仅仅是 C++。至少，您需要了解网页设计和 Javascript。这一次让我觉得很吃力，所以我建议从一个简单的基于屏幕的游戏开始，当你对基本​​的游戏编程有信心时学习网络知识。（不要只是在屏幕上编写你想要的游戏，然后认为你只是将它移植到网络上；编写是为了熟悉 C++ 游戏编程，学习网络知识，并以此为基础设计你的游戏。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T16:38:49.430

这听起来像是学习编程的好方法，但不要抱太大希望。那将是一条漫长的道路。

另外，我同意 C++ 可能不是执行此操作的正确语言。也许你应该先从一个较小的、不那么雄心勃勃的项目开始学习编程，然后使用一种初学者更容易上手的语言。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-19T20:53:50.420

首先，我要回答你的技术问题。

你将需要 3 样东西。

1- 在用户的浏览器中显示内容，以便他可以使用您的应用程序。这意味着使用最适合编程的语言。最有可能是 PHP（或它的 Microsoft 等价物：ASP.NET，使用较少，需要更昂贵的工具）或 Flash。还有其他较少使用的选项，但那是无关紧要的。

2-一个数据库，用于存储您的数据。这里的语言将是 SQL，您可能会从一个免费的开源数据库开始。大多数人在这种情况下选择 MySQL。

3- 使用数据库中的数据和用户输入做某事的引擎。在这里，由于您对编程一无所知，因此最简单的方法是使用与您的 GUI 相同的语言：PHP/ASP.NET。稍后，如果您设法成为代码专家并且需要一些性能改进，您可能会尝试更强大的东西，例如 Java 或 C++，但是您将不得不将您的 PHP 前端与您的 C++ 后端接口，这将是棘手。

现在这就是我认为你会失败的原因：我所说的一切意味着，至少，你需要学习基本的编程概念、2 种语言（PHP + SQL）和所有相关的工具（MySQL、一个 IDE对于 PHP，...）。此外，您还必须学习如何设置、配置和使用 Web 服务器。一个人在几个月甚至两年内完成这一切，是一项相当艰巨的任务。

其实最让我担心的是，你说你没有编程背景。这意味着你甚至不知道你是否愿意做这种事情。编程可能非常令人沮丧，许多人讨厌它。您应该从构建小型应用程序作为一种爱好开始，看看这是否是您想做的那种工作（因为是的，这是一项需要技能的工作）。只有这样，您才能考虑将其作为您的业务范围。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-19T16:52:21.890

回合制策略游戏基本上是一个具有光鲜前端的商业应用程序。

我推荐 SQL Server 用于数据存储和规则引擎。您将不得不学习如何为数据库建模。我不想辜负你的希望，但其他人是对的：你还有很长的路要走。以下是一些入门帮助：

[回合制游戏简介及其含义](http://www.rjcyberware.com/md/intro-tbse.html)

[您可以浏览和修改的回合制战争游戏的源代码](http://sourceforge.net/projects/otwg)

[Torque 2D 游戏引擎](http://www.garagegames.com/products/torque-2d)

十多年前，我在 MSAccess(!) 中编写了一个回合制太空战斗/战略游戏的开端（呃，我只是做了数学计算，实际上已经快 20 年了），但我从未完成过。希望你能比我走得更远。祝你好运！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-19T16:52:48.753

Java、Flash、PHP、ASP.NET，都是常用于实现网络游戏的语言。

您还很可能需要向自己介绍 SQL，因为必须以某种方式存储数据。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-19T16:36:37.373

如果你想制作基于网络的游戏，C++ 可能是错误的语言。您应该研究 PHP、SQL 数据库编程和 Perl。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-19T18:54:19.330

欢迎来到编程的世界。这很有趣，但需要一段时间来学习。

我的建议：从小处着手。真的很小。你需要很多基础知识。C++ 实际上可能是扎实基础的好方法，尽管您不太可能将它用于您的最终 Web 产品（有关 Web 语言选项，请参阅其他答案）。当您浏览示例时，请考虑您可以使用您所知道的项目的一小部分，即使它只是选择一个名称并显示它，或者添加一个分数。Processing.org 是一种有趣的语言——同样不是你最终需要的语言，但它面向初学者，让你可以立即进入图形（这很有趣，虽然可能不是你玩这个游戏的主要关注点）。

额外建议：如果您想以此赚钱或成为专业游戏开发者，请不要立即在网络上发布您的最佳创意。我丈夫在大学里创造了一个非常有创意的游戏，它在一个 java 游戏网站上变得有点流行。几年后，为 Playstation 发布了几乎完全相同的克隆版本。Playstation 开发人员并没有直接敲诈他，事实证明这个想法已经广泛传播。虽然在某些方面确实很酷，但如果您作为游戏设计师想要钱或信用，显然这不是您想要的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-19T21:24:58.593

你可以从另一个方向来解决这个问题。与其实现您想到的这些大型设计，不如从 Facebook 应用程序开始。这样你就可以实现一些非常小的想法。如果你先尝试做大事，你最终会陷入焦油坑。

小心大型游戏设计。首先要善于实施小问题。您总是可以在它们之上构建。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-19T19:24:42.610

其他人已经说过这一点，但 PHP 将是您的最佳起点。对于基于回合的、基于网络的游戏，我肯定会使用 PHP 和 mySql。在使用 PHP 编写大部分游戏后，如果您愿意，您将有足够的理解开始转向其他语言。设置一个支持 php 的 apache 服务器和一个 mysql 服务器（它们可以很容易地在您自己的机器上运行）。然后开始玩代码。查看其他示例，修改它们，混合它们，学习。你可以在网上找到很多关于 php 和 sql 的免费教程。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-19T20:22:47.143

我最近开始学习 C++，也是用“无所畏惧”。一旦掌握了基础知识，您可以做的最好的事情就是潜入一个简单的项目，但非常简单（如井字游戏）。

我认为你不应该仅仅为了你的这个想法而学习编程。学习编程以获得乐趣，看看你是怎么上车的，看看你的船是什么漂浮的。一年后，再想想你的项目，它是否可行，你是否想做，你想怎么做。但是在此之前不要考虑它，因为你能想到的只是你似乎离让成千上万的顾客排队更近了一步。

只要继续编码，你就会到达你想去的地方。你想去的地方可能不是你现在想去的地方！祝你好运。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-19T16:40:39.713

C++ 是学习计算机编程的好语言；然而，对于编程回合制网页游戏的特定任务，C++ 可能不是您想要用于该任务的工具。您可能想继续学习 C++，以掌握底层编程；不过，这可能需要一段时间。您可能还想研究其他编程语言以在网络上实现您的游戏；PHP 非常适合编写脚本。C#与C++有很多相似之处，并且与微软的Web服务器有很好的集成；ASP.NET 也很容易理解。您应该在学习 C++ 的同时对它们中的每一个进行研究，以确定哪一个似乎可以满足您的需求。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-19T21:20:25.590

它可能对你没有用，但[http://archverse.sourceforge.net/](http://archverse.sourceforge.net/)是一个开源 C++ 回合制网页游戏。它还没有完成，但所有的基础知识都在那里，它实际上做了很多（尽管它现在没有客户端，只有一个带有单元测试的服务器）。它获得了 BSD 许可，因此欢迎您使用它来做您想做的事情，除非您声称您是从头开始编写的。

与这里其他人的建议相反，我不喜欢半实时游戏的 RDBMS，所以我使用 BerkeleyDB 作为数据存储，它允许我拥有 ACID 并且仍然更快，因为我从不搜索除了关键字段和所有内容之外的任何内容正在进行中。真的不想开始一个平面文件与 rdbms 的火焰大战，但是这个与使用 MySQL 相关的非开源项目并为此付出了相当痛苦的代价。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-06-19T22:34:47.547

C++ 的学习曲线对于初学者来说可能很棘手。如果你能在没有严重精神伤害的情况下读完关于引用和指针的章节，你可能会没事的。否则，您可能想从更高级别的东西开始。正如其他人所说，C++ 是一种非常适合游戏开发的编程语言，但它并不特别适合基于 Web 的应用程序。

无论您选择哪种语言，您可以从书本中学到的东西只有这么多。编程技能在很大程度上取决于经验——编程、编程好、总是编程。

在某些时候，您可能想要学习面向对象的分析和设计。如果您的游戏对它们具有任何显着程度的复杂性，那么将它们分解成易于管理的块的能力是非常宝贵的。

查看[gamedev.net](http://www.gamedev.net "游戏开发网")，他们为游戏开发者提供了大量资源。

游戏开发涉及除编程本身之外的许多不同方面。根据游戏的不同，您还必须担心声音、音乐、图形、动画、用户界面、游戏平衡、故事、对话和数据库设计。所有这些都必须适用于各种硬件和软件配置。哦，是的，它可能也必须很有趣。

从小处着手。

祝你好运。

# c# - 在条件查询中选择多个实体

> ID：1018897
> 
> 赞同：2
> 
> 时间：2009-06-19T16:35:26.890
> 
> 标签：c#, nhibernate

在 NHibernate HQL 中，您可以为给定查询选择多个实体，如本例。

```
var query = session.CreateQuery("select c,k from Cat as c join c.Kittens as k"); 
```

显然，现实世界的情况更加复杂，但这是基础。有没有办法在条件查询中做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-05-18T16:45:05.647

var catsWithKittens = session.createCriteria() .SetFetchmode("Kittens", Fetchmode.Eager) .List();

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-17T21:27:07.353

您需要使用 JOIN FETCH。

HQL 是这样的——

```
FROM Cat C JOIN FETCH C.Kittens 
```

# design-patterns - 设计模式 - 策略模式

> ID：1018913
> 
> 赞同：7
> 
> 时间：2009-06-19T16:38:53.660
> 
> 标签：design-patterns, strategy-pattern

我是设计模式的初学者。

假设我正在开发一个 C# 应用程序来跟踪开发团队中各个成员执行的开发工作（即项目跟踪器）。

我试图从战略模式中获得灵感。

所以我正在设计我的类和接口如下：

```
interface IEmployee
{
    void Retires();
    void TakesLeave();
}

interface IResponsible
{
void AcknowledgeJobAccomplish();
void CompletesJob();
}

interface ILeader
{
    void FormsTeam();
    void RecruitsNewMember();
    void KicksOutMemberFromTheTeam();
    void AssignsJob();
void UnassignsJob();
void QueriesTheJobStatus();
void ChangesTheJobStatus();
}

interface IPersistent
{
    void Save();
    void Update();
    void Delete();  
}

abstract class TeamMember : IEmployee, IResponsible, IPersistent
{
    string Name;
}

class Programmer : TeamMember
{
}

class LeadProgrammer : Programmer, ILeader
{
    ProgrammerCollection associateProgrammers;
}

class ProjectManager :  TeamMember, ILeader
{
    TeamMemberCollection teamMembers;
}

abstract class Tester : TeamMember
{
}

class UnitTester : Tester
{
}

class QC : Tester
{
}

class SupportStaff : TeamMember
{
} 
```

我应该做些什么来改进这个设计？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-19T16:45:52.020

好吧，首先，您所拥有的不是策略模式的实例。[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)允许动态规范完成工作的方法。你在这里所拥有的实际上更像是一个标准的接口设计，你通过接口继承来分配职责和能力。

编辑：让我们举个例子。假设您有一组工人；您还有一组任务。每个 Worker 可以执行一个任务。这些任务可以包含多个内容，例如 DoFoo() 和 DoBar()。每个 Worker 都不知道他们将执行什么任务；他们只知道当他们出现时他们将执行一项任务。

因此，我们希望将 Workers 建模为他们将执行的任务。由于任务变化很大，我们将任务实现为接口。

所以我们会有：

```
public class Worker 
{
   public Task myTask;

   public Worker(Task task)
   {
      myTask = task;
   }

   public void DoWork() 
      {
      myTask.DoTask();
      }
   }
}

Interface Task
{
   void DoTask();
}

public class Task1 : Task
{
   public void DoTask()
   {
   // Do whatever Task1 will do
   }
}

public class Task2 : Task
{
   public void DoTask()
   {
   // Do whatever Task2 will do
   }
}

public class Job
{
   public List<Worker> workers;

   public void Job()
   {
      workers.Add(new Worker(new Task1()));
      workers.Add(new Worker(new Task2()));
   }

   public void DoJob()
   {
      foreach (Worker worker in workers)
      {
      worker.DoWork();
      }
   }

   public void ChangeJobsToTask1()
   {
      foreach (Worker worker in workers)
      {
         worker.myTask = new Task1();
      }
   }

   public void ChangeJobsToTask2()
   {
      foreach (Worker worker in workers)
      {
         worker.myTask = new Task2();
      }
   }
} 
```

所以发生的事情是，当我们实例化 a 时`Job`，`Job`创建了两个`Worker`s。第一个`Worker`有`Task1`任务；第二个`Worker`有`Task2`任务。为了让`Worker`s 做它们`Task`的 s，我们调用类`DoJob()`上的方法，它只调用每个s 上的方法，然后又调用每个设置s 的s 上的方法。 `Job``DoWork()``Worker``DoTask()``Task``Worker`

如果我们想将`Worker`s 更改为 all do `Task1`，我们调用该`ChangeJobsToTask1()`方法，该方法将 ; 包含的所有对象设置`Task`为; 如果此时我们在对象上调用 ，所有的s 都会执行任务。同样，如果我们想将s 更改为，只需调用方法即可；然后，所有的s 将在调用他们的方法时执行。`Task1``Worker``Job``DoJob()``Job``Worker``Task1``Task``Task2``ChangeJobsToTask2()``Worker``Task2.DoTask()``DoWork()`

这里抽象的重点是`Worker`s 暴露了一个`DoWork()`方法，但它们不一定知道正在完成的工作是什么。也就是说，`Task`s 的`Worker`s 是可以互换的；`Worker`s 只知道他们会做 a ，但具体内容对s`Task`来说并不重要`Worker`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T16:44:37.777

我在您的示例中没有看到策略模式。策略模式在参​​数中采用“策略”类（通常从具有逻辑方法的接口继承，例如“DoJob（）”），当调用方法时，它将通过应用较早传递的策略来执行操作，而不知道它是什么具体会做。

在您的示例中，您可以拥有一个您的所有人都继承的类，该类具有 SetJob(IJobStrategy) 和 DoJob() 方法，该方法将调用接口 DoJob()（来自 IJobStrategy）。比，你可以有多个继承 IJobStrategy 的具体工作。这样，您的员工不知道工作，您可以更改工作而无需修改人员类。

[您可以在此处](http://www.dofactory.com/Patterns/PatternStrategy.aspx)查看示例和更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T16:53:04.027

这看起来更像是接口隔离原则。现在，这确实与策略相得益彰，但这就是我要做出的不同之处。

Tester 不会是一个具体的类，它将是一个 TeamMember，其 TesterCompletesJobStrategy 配置为 CompletesJobStrategy。毕竟，唯一让我无法进行测试的是我目前在团队中分配的任务。

只是作为一个话题，如果我的目标是策略，我会从更像这样的东西开始。

```
interface ICompleteJobStrategy {
   void CompleteJob(IResponsible responsibleParty);
}
class TesterCompletJobStrategy : ICompleteJobStrategy {
    ...
}
class TeamMember : IResponsible {
   TeamMember(ICompleteJobStrategy strat){ .. };
   void CompleteJob() { _completeJobStrategy.CompleteJob(this) ; }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-08-07T14:40:03.173

你可以在 C# 中使用“动态”，而不是像这样：

方法（动态输入）

方法（DTO1 输入） 方法（DTO2 输入） 方法（DTO3 输入）

没有遵守时间错误

# .net - .NET 字符串的内部格式是什么？

> ID：1018915
> 
> 赞同：9
> 
> 时间：2009-06-19T16:40:08.353
> 
> 标签：.net, string, unicode, internals

我在 C#.NET 中编写了一些漂亮的字符串操作密集型代码，并对我记得不久前读过的一些 Joel Spolsky 文章感到好奇：

[http://www.joelonsoftware.com/articles/fog0000000319.html](http://www.joelonsoftware.com/articles/fog0000000319.html)
[http://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)

那么，.NET 是如何做到的呢？每个字符两个字节？有一些 Unicode 字符^H^H^H^H^H 代码点需要更多。长度是如何编码的？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-19T16:42:33.923

在 Jon Skeet 出现之前，有一个链接指向他关于C#[字符串的优秀博客。](http://csharpindepth.com/Articles/General/Strings.aspx)

> 至少在当前实现中，字符串占用 20+(n/2)*4 个字节（将 n/2 的值向下舍入），其中 n 是字符串中的字符数。字符串类型的不寻常之处在于对象本身的大小不同

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-19T16:44:52.690

.NET 使用[UTF-16](http://en.wikipedia.org/wiki/UTF-16)。

从[MSDN 上的 System.String](http://msdn.microsoft.com/en-us/library/system.string.aspx)：

“字符串中的每个 Unicode 字符由一个 Unicode 标量值定义，也称为 Unicode 码点或 Unicode 字符的序数（数字）值。每个码点使用 UTF-16 编码进行编码，每个码点的数值编码元素由 Char 对象表示。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-01-22T17:18:23.257

String 对象非常复杂，无法提供一个简短的示例并将给定的文本编码为字符串，将生成的内存内容显示为字节值序列。

String 对象将文本表示为一系列 UTF-16 代码单元。它是 System.Char 对象的顺序集合，每个对象对应一个 UTF-16 代码单元。单个 Char 对象通常表示单个代码点。一个代码点可能需要多个编码元素，即。多个 Char 对象（补充代码点（或代理对）和字素）。注意：UTF-16 是一种可变宽度编码。

字符串的长度作为 String 对象的属性存储在内存中。注意：String 对象可以包含嵌入的空字符，这些字符计为字符串长度的一部分（与 C 和 C++ 不同，空字符表示字符串的结尾，因此不必额外存储长度）。存储 Char 对象的内部字符数组实际上可以比字符串的长度长（分配策略的结果）。

如果您难以创建正确的编码来使用（因为您找不到任何名为 System.Text.Encoding.UTF16 的属性），则 UTF-16 实际上是 System.Text.Encoding.Unicode，如本示例中所使用的：

```
string unicodeString = "pi stands for \u03a0";
byte[] encoded = System.Text.Encoding.Unicode.GetBytes(unicodeString); 
```

构造函数 Encoding.Unicode，没有任何参数，实际上是使用 little endian 字节顺序创建一个 UnicodeEncoding 对象。UnicodeEncoding 类（实现 UTF-16 编码）也能够处理大端（也支持字节顺序标记的处理）。英特尔平台的本机字节顺序是小端，因此 .NET（和 Windows）以这种格式存储 Unicode 字符串可能更有效。

# eclipse - 让 netbeans 更加 Eclipse-y

> ID：1018918
> 
> 赞同：1
> 
> 时间：2009-06-19T16:40:36.967
> 
> 标签：eclipse, ide, netbeans

我是一个长期的 Eclipse 用户，现在我已经尝试了一些 netbeans，因此希望使用 netbeans。我最喜欢我所看到的，除了缺少一些美学。任何人都对 NetBeans 中是否提供以下内容有想法？：

*   Eclipse 在左边距/装订线中突出显示修改和插入的行
*   Eclipse 在左边距/装订线中突出显示当前编辑的功能
*   Eclipse 在右边距突出显示 TODO / FIXME 注释

例如：

[替代文字 http://img507.imageshack.us/img507/5471/forso.png](http://img507.imageshack.us/img507/5471/forso.png)

...关于我如何让 Netbeans 做这种事情的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T17:02:37.633

如果您的项目连接到源代码控制，netbeans 将在行的开头显示带有绿色块的添加行、带有蓝色块的修改行和带有红色箭头的已删除行。它还在右边距/装订线中标记这些。这是基于与上次提交的比较，而不是上次保存。

至于其他两个，我找不到实现它们的方法，但我可能只是遗漏了一些东西

# sql-server - 需要帮助设计大型数据库更新流程

> ID：1018920
> 
> 赞同：3
> 
> 时间：2009-06-19T16:40:45.423
> 
> 标签：sql-server, architecture, ado.net

我们有一个包含约 100K 业务对象的数据库。每个对象有大约 40 个属性，存储在 15 个表中。我必须获取这些对象，对它们执行一些转换，然后将它们写入不同的数据库（具有相同的架构）。这是 ADO.Net 3.5，SQL Server 2005。

我们有一个库方法来编写单个属性。它确定属性进入 15 个表中的哪一个，创建并打开连接，确定属性是否已经存在并相应地进行插入或更新，然后关闭连接。

我在程序中的第一遍是从源数据库中读取一个对象，执行转换，并在其 40 个属性中的每一个上调用库例程，以将对象写入目标数据库。重复 100,000 次。显然，这是非常低效的。

处理此类问题有哪些好的设计？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-19T16:45:24.440

这正是 SQL Server Integration Services (SSIS) 擅长的事情。它记录在联机丛书中，与 SQL Server 相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T18:16:24.617

我和 John 在一起，SSIS 是导入大量数据的任何可重复过程的方法。它应该比您目前获得的 30 小时快得多。如果两个数据库在同一台服务器上或者是链接服务器，您也可以编写纯 t-sql 代码来执行此操作。如果你走 t-sql 路线，你可能需要混合使用基于集合和循环的代码来批量运行（比如一次 2000 条记录），而不是在整个时间内锁定表，一个大的插入会拿。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T16:56:58.547

不幸的是，我会说您需要忘记您的客户端库，并在 SQL 中完成这一切。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T17:03:33.797

你需要这样做多少次？如果只有一次，它可以在无人看管的情况下运行，我看不出你为什么不应该重用现有的客户端代码。计算机的目的是使人类的工作自动化。如果它效率低下，我知道这很糟糕，但是如果你要花一周的时间来设置一个 SSIS 包，那也是低效的。此外，您的客户端解决方案可能包含业务逻辑或验证代码，您必须记住这些代码才能转移到 SQL 中。

您可能想研究[Create_Assembly](http://msdn.microsoft.com/en-us/library/ms189524.aspx)，将您的客户端代码通过网络移动到您的 SQL 框上。这将避免网络延迟，但可能会破坏您的 SQL Server。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T17:09:05.707

坏消息：你有很多选择

使用平面文件转换：将所有数据提取到平面文件中，使用 grep、awk、sed、c、perl 将它们操作到所需的插入/更新语句中，并针对目标数据库执行这些语句

PRO：快；CON：极其丑陋......维护的噩梦，如果您需要超过一周的时间，请不要这样做。还有几十次处决

使用纯 sql：我对 sql server 了解不多，但我认为它可以从另一个数据库中访问一个数据库，因此最快的方法之一是将其编写为“插入/更新”的集合/ 合并由 select 语句提供的语句。

PRO：快速，仅一种技术；缺点：需要数据库之间的直接连接 您可能会很快达到 SQL 的限制或可用的 SQL 知识，具体取决于转换的类型。

使用 t-sql 或数据库提供的任何迭代语言，其他一切都类似于纯 sql 方法。

优点：非常快，因为你不离开数据库 缺点：我不知道 t-sql，但如果它是 PL/SQL 之类的东西，它不是进行复杂转换的最佳语言。

使用高级语言（Java、C#、VB ...）：您可以将数据加载到适当的业务对象中，操作这些对象并将它们存储在数据库中。几乎你现在正在做的事情，虽然听起来有更好的 ORM 可用，例如 nhibernate

使用 ETL 工具：有用于提取、转换和加载数据的特殊工具。它们通常支持各种数据库。并且有许多现成的策略可用于确定是否进行了更新或插入。

PRO：对不起，你得问别人，到目前为止，我对这些工具的体验很糟糕。

CON：一个高度专业化的工具，你需要掌握。我个人的经验：转换的实现和执行速度比手写 SQL 慢。可维护性的噩梦，因为所有东西都隐藏在专有存储库中，因此对于 IDE、版本控制、CI、测试，您会被工具提供商提供的任何东西（如果有的话）困住。

PRO：即使是复杂的操作也可以以干净可维护的方式实现，您可以使用所有精美的工具，如优秀的 IDE、测试框架、CI 系统，在开发转换时为您提供支持。

CON：它增加了很多开销（从数据库中检索数据，实例化对象，并将对象编组回目标数据库。如果这是一个将要存在的过程，我会这样做很长时间。

在最后一个选项的基础上，您可以通过使用消息传递和 Web 服务进一步美化架构师，如果您有多个源数据库或多个目标数据库，这可能是相关的。或者您可以手动实现一个多线程转换器，以便通过投入获得收益。但我想我正在离开你的问题范围。

# sql-server - linq to sql什么时候会被淘汰？实体框架（替代）发布了吗？

> ID：1018928
> 
> 赞同：4
> 
> 时间：2009-06-19T16:44:52.833
> 
> 标签：sql-server, linq-to-sql

linq to sql什么时候会被淘汰？实体框架（替代）发布了吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-19T16:49:34.763

是的，ADO.NET Entity Framework 已随 .NET 3.5 Service Pack 1 一起发布。

不，实体框架本身不会取代 LINQ-2-SQL - 两者有完全不同的目标受众，并且有各自的目标市场。

LINQ-2-SQL 非常适用于您的业务对象几乎是数据库表的 1:1 映射的简单场景。这种情况经常发生，在这种情况下，EF 是多余的。

另一方面，EF 在企业级应用程序中非常有用，您的业务域对象不一定会 1:1 映射到表上，或者您需要支持 MS SQL Server 之外的多个数据库后端。

即使使用 .NET 4.0，Microsoft 仍在对 LINQ-2-SQL 进行投资 - 请参阅 Damien Guard 的[博客文章](http://damieng.com/blog/2009/06/01/linq-to-sql-changes-in-net-40)。

马克

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-19T16:48:35.593

实体框架发布。LinqToSql 将针对 .Net 4 进行更新，并且不会很快消失。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T16:50:07.807

根据去年年底的 ADO.NET 团队的说法，.NET 4.0 将成为他们建议逐步淘汰 LINQ to SQL 以支持实体框架的官方点。

从[这个博客](http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx)：

“我们正在对 Entity Framework 进行大量投资，因此从 .NET 4.0 开始，Entity Framework 将成为我们推荐的 LINQ 到关系方案的数据访问解决方案。”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-19T17:14:05.420

Linq-to-SQL 是基于 SQL 服务器的高性能选项。它是 .net 框架的一部分，不会消失。不要太在意那些试图出售自己的本土 ORM 或 MSFT 营销的 RD 口中的内容......

与 L2S 相比，EF 提供了更多的抽象并支持更多的后端数据库，但代价是 [much] 效率较低的 SQL 查询。尽管 Microsoft 营销有其自己的故事，但我个人的看法是：如果您的目标是 SQL Server [，想要使用 MSFT OR 映射器，] 并且您想要可伸缩性和性能 - L2S 是适合的技术。另一方面，如果性能和可扩展性并不重要，但您有一群缺乏经验的开发人员，他们需要将所有东西都放在一个盘子上，[并且提供该盘子的人擅长在 XML 编辑器中手动启动 SSDL 和 CSDL] EF 是一个很好的竞争者。JMHO。

# file - 简单的 PowerShell LastWriteTime 比较

> ID：1018934
> 
> 赞同：30
> 
> 时间：2009-06-19T16:46:20.897
> 
> 标签：file, powershell

我需要一个 PowerShell 脚本，它可以访问文件的属性并发现*LastWriteTime*属性并将其与当前日期进行比较并返回日期差异。

我有这样的东西...

```
$writedate = Get-ItemProperty -Path $source -Name LastWriteTime 
```

...但我不能将*LastWriteTime*转换为“DateTime”数据类型。它说，“无法将“@{LastWriteTime=...date...}”转换为“System.DateTime”。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-06-19T16:58:21.947

试试下面的。

```
$d = [datetime](Get-ItemProperty -Path $source -Name LastWriteTime).lastwritetime 
```

这是项目属性怪异的一部分。当您运行 Get-ItemProperty 时，它不会返回值，而是返回属性。您必须使用更多的间接级别才能获得该值。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-02-28T21:45:38.550

```
(ls $source).LastWriteTime 
```

（“ls”、“dir”或“gci”是 Get-ChildItem 的默认别名。）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-09-18T19:16:27.413

我有一个例子我想分享

```
$File = "C:\Foo.txt"
#retrieves the Systems current Date and Time in a DateTime Format
$today = Get-Date
#subtracts 12 hours from the date to ensure the file has been written to recently
$today = $today.AddHours(-12)
#gets the last time the $file was written in a DateTime Format
$lastWriteTime = (Get-Item $File).LastWriteTime

#If $File doesn't exist we will loop indefinetely until it does exist.
# also loops until the $File that exists was written to in the last twelve hours
while((!(Test-Path $File)) -or ($lastWriteTime -lt $today))
{
    #if a file exists then the write time is wrong so update it
    if (Test-Path $File)
    {
        $lastWriteTime = (Get-Item $File).LastWriteTime
    }
    #Sleep for 5 minutes
    $time = Get-Date
    Write-Host "Sleep" $time
    Start-Sleep -s 300;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-12-12T22:44:27.530

对于 OP 接受其中一个作为解决问题的答案，我不能对这里的任何答案提出错误。但是，我发现它们在一个方面存在缺陷。当您将赋值结果输出到变量时，它包含许多空白行，而不仅仅是寻求的答案。例子：

```
PS C:\brh> [datetime](Get-ItemProperty -Path .\deploy.ps1 -Name LastWriteTime).LastWriteTime

Friday, December 12, 2014 2:33:09 PM

PS C:\brh> 
```

我喜欢代码中的两件事，简洁性和正确性。brianary 有权对 Roger Lipscombe 表示简洁，但由于结果中的多余线条，两者都错失了正确性。这就是我认为 OP 正在寻找的东西，因为它让我越过了终点线。

```
PS C:\brh> (ls .\deploy.ps1).LastWriteTime.DateTime
Friday, December 12, 2014 2:33:09 PM

PS C:\brh> 
```

请注意没有多余的行，只有 PowerShell 用来分隔提示的那一行。现在可以将其分配给一个变量进行比较，或者在我的情况下，存储在一个文件中，以便在以后的会话中读取和比较。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-01-06T07:17:29.033

`(Get-Item $source).LastWriteTime`是我的首选方式。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-11-30T12:56:06.560

稍微容易一些 - 使用`new-timespan`cmdlet，它会从当前时间创建一个时间间隔。

```
ls | where-object {(new-timespan $_.LastWriteTime).days -ge 1} 
```

显示今天未写入的所有文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-19T17:03:52.657

采用

ls | % {(get-date) - $_.LastWriteTime }

它可以用来检索差异。您可以`ls`用单个文件替换。

# php - $_GET 和 WordPress

> ID：1018935
> 
> 赞同：15
> 
> 时间：2009-06-19T16:46:27.730
> 
> 标签：php, wordpress

我想向 WordPress 添加一个自定义 php 文件来执行一个简单的操作。

到目前为止，我的主题`index.php`文件中有：

```
<a href="myfile.php?size=md">link</a> 
```

而php是

```
<?php echo "hello world"; ?>

<?php echo $_GET["size"]; ?>

<?php echo "hello world"; ?> 
```

单击该链接后，将显示：

```
hello world 
```

WordPress 是否接管了该`$_GET`功能，我需要做一些技巧来使用它吗？我究竟做错了什么？

**编辑**：

```
<?echo "hello world";?>
<? 
  if (array_key_exists('size', $_GET))
    echo $_GET['size'];
?>
<?echo "end";?> 
```

输出：

```
hello world 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-11-26T21:32:39.967

查看解决方案：

为了能够添加和使用附加到 URL 的您自己的自定义查询变量（例如：`www.site.com/some_page/?my_var=foo`- 例如使用`add_query_arg()`），您需要将它们添加到可用于`WP_Query`. 这些是在实例化时建立的，`WP_Query`但幸运的是`query_vars`在它们实际用于填充`$query_vars`.`WP_Query`

对于您的情况：

```
 function add_query_vars_filter( $vars ){
       $vars[] = "size";
       return $vars;
  }
  add_filter( 'query_vars', 'add_query_vars_filter' ); 
```

并在您的模板页面上调用 get 方法：

```
$size_var = (get_query_var('size')) ? get_query_var('size') : false;
if($size_var){
   // etc...
} 
```

**更多在法典**：**[http ://codex.wordpress.org/Function_Reference/get_query_var](http://codex.wordpress.org/Function_Reference/get_query_var)**

我希望它有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T16:56:17.423

不确定这是否会显示任何内容，但尝试使用以下命令打开错误报告：

```
<?php
   error_reporting(E_ALL);
   ini_set('display_errors', true);
?> 
```

在任何其他代码之前的页面顶部。

**编辑：**

从OP评论：

> 愚蠢的问题，但是您确定您正在查看对文件的最新更改的结果，而不是页面的缓存副本或其他内容吗？将“hello world”更改为其他内容。（很抱歉抓住了稻草，但这件事以前发生在我身上） – Zenshai
> 
> 啊哈哈，进行更改的人没有更改正确的文件。它现在正在工作 - marcgg
> 
> 对等编程失败^^ – marcgg
> 
> 那将是一个“或某事”，无法告诉您我做过多少次这样的事情。很高兴你最终能够弄清楚。– 禅斋

我通常只有在它们开始挑战我对语言或环境的一切了解时才会发现此类错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T17:20:40.357

您可能想查看关于 WP Query 对象的 WP 文档。

[http://codex.wordpress.org/Query_Overview](http://codex.wordpress.org/Query_Overview)

似乎 wordpress 使用 wp_query 对象的 get_query_vars 方法来获取查询。

你也可以看看这个： [http ://codex.wordpress.org/Custom_Queries](http://codex.wordpress.org/Custom_Queries)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T16:53:13.760

尝试这个：

```
<?echo "hello world";?>
<? 
  if (array_key_exists('size', $_GET))
    echo $_GET['size'];
?>
<?echo "end";?> 
```

如果你看到

```
hello worldend 
```

...这意味着您没有设置 size GET 参数。您使用什么 URL 来访问所述页面？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T16:56:41.713

Wordpress 不会接管 $_GET。你确定你正确地传递了变量吗？

如果您在 url 中对变量进行硬编码，请确保它采用以下形式：

```
YOUR_SITE_PATH/?variable_name=variable_value 
```

请不要在网址末尾的“/”，在“？”之前

我看不到您的 index.php 代码，但请确保变量“size”是在 url 中手动设置或从提交的表单中设置的。如果您使用表单，请确保您使用方法="GET"。如果您使用 method="POST"，那么您的变量将在 $_POST['size'] 中。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-26T07:15:16.810

虽然这是一篇很老的帖子，但让我们知道它可能会很有用......有一个插件可以很好地简化 $_GET、$_POST 和全局变量声明问题的处理。[http://wordpress.org/extend/plugins/wordpress-registry/](http://wordpress.org/extend/plugins/wordpress-registry/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-27T10:42:29.670

也许这可以有人

请检查您的 htaccess 文件。并在那里有一个重写规则

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase <<relative_url>>/
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . <<relative_url>>/index.php [L]
</IfModule>
# END WordPress 
```

请使用与您的域相比的相对 url 更改 << relative_url>>

我遇到了同样的问题，我的 wordpress 安装在 Godaddy 服务器上。但是在更改 .htaccess 文件后，问题得到了解决。

# jpa - 为什么 EclipseLink 认为我的数据库模式不存在？

> ID：1018941
> 
> 赞同：2
> 
> 时间：2009-06-19T16:47:05.750
> 
> 标签：jpa, schema, persistence, ejb, eclipselink

我正在使用 EJB 3.0 开发一个 Web 项目，每当 EclipseLink 尝试与数据库交互时，它都会说我正在使用的模式不存在（它*确实*存在）。

我从 GlassFish 2.1 中得到了一个巨大的、无用的堆栈跟踪，它的开头是：

```
EclipseLink, version: Eclipse Persistence Services - 1.1.0.r3639-SNAPSHOT
file:/C:/Documents%20and%20Settings/nick/.personalDomain/personalDomain/applications/j2ee-apps/ScienceEar/lib/ScienceJpa-1.0-SNAPSHOT.jar-SciencePU login successful
Local Exception Stack: 
Exception [EclipseLink-4002] (Eclipse Persistence Services - 1.1.0.r3639-SNAPSHOT): org.eclipse.persistence.exceptions.DatabaseException
Internal Exception: java.sql.SQLSyntaxErrorException: Schema 'BEAMLINE' does not exist
Error Code: -1
Call: SELECT exp_id, fac_family, public_viewable, group_name, created_ts, status, exp_num, date_received, exp_type, title, updated_ts, text_only_title, experiment_url, proposed_eec, start_of_prep FROM beamline.eec_exp_toc
Query: ReadAllQuery(name="Experiment.findAll" referenceClass=Experiment sql="SELECT exp_id, fac_family, public_viewable, group_name, created_ts, status, exp_num, date_received, exp_type, title, updated_ts, text_only_title, experiment_url, proposed_eec, start_of_prep FROM beamline.eec_exp_toc") 
```

我可以发布更多的堆栈跟踪，但这真的很无聊。关于为什么 EclipseLink 看不到架构的任何想法？

更多信息：“beamline”是我使用的唯一模式。堆栈跟踪中的 SQL 是由 NamedQuery 生成的，这是我的程序中与该数据库的第一次交互（以及第一次 JPA 交互）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T18:47:37.093

明白了 - 我直接连接到数据库，而我应该使用 GlassFish 的连接池。

# vb6 - 在 VB6 应用程序中使用 ImageList 会导致 Windows 7.0 64 位崩溃

> ID：1018942
> 
> 赞同：7
> 
> 时间：2009-06-19T16:47:09.400
> 
> 标签：vb6, listview, treeview, win64, imagelist

我有一个旧的 VB6 应用程序，它使用 COMCTL32.OCX 中的 ImageList 控件（“Microsoft Windows Common Controls 5.0 (SP2)”）为 TreeViews 和 ListViews 提供图标。

该应用程序甚至无法在 Windows 7.0 64 位上启动。它尝试加载具有 ImageList 的表单的那一刻，它崩溃了（实际上，应用程序眨眼，退出而无影无踪）。

从表单中删除 ImageList 可以解决问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-19T19:28:29.950

我通过将 VB5 附带的所有 COMCTL32.OCX 实例替换为 VB6 附带的 MSCOMCTL.OCX 解决了这个问题。

Microsoft 知识库文章[190952](http://support.microsoft.com/kb/190952)提供了执行此操作的说明。这几乎只是一个全局搜索和替换操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T18:50:05.797

向 Microsoft 报告错误。VB6 运行时在 64 位 Windows 7 上[仍受支持。COMCTL32.ocx 未随 Windows 7 一起安装，但在 Windows 7 上被](http://msdn.microsoft.com/en-us/vbrun/ms788708.aspx)[明确列为](http://msdn.microsoft.com/en-us/vbrun/ms788708.aspx)受支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-21T00:18:38.260

你的解决方案没问题。但是 COMCTL32.OCX 在 Win64 上应该可以正常工作（Vista 或 7）。

只是一点建议：

如果使用 MSCOMCTL.OCX，您将无法将 XP/Vista/7 样式应用于您的列表视图或树视图，并且您的应用程序可能看起来很陌生。清单不会对 MSCOMCTL.OCX 控件产生任何影响。

一种解决方法是对 MSCOMCTL.OCX 控件进行子类化，并且由于它们仍然包含 COMCTL32.DLL 标头，因此您可以操纵它的绘制方式。

（我会作为评论发布，但我仍然不能）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T17:53:36.370

一个不太激烈的 DEP 调整是进入计算机性能对话框（系统属性的高级选项卡）并将应用程序 exe 添加到 DEP 选项卡上的例外列表中。

顺便说一句，你确定这不属于 serverfault.com。:P

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-19T17:01:21.647

您可能会遇到数据执行保护 (DEP) 的问题。通过禁用 DEP 进行测试：

```
bcdedit.exe /set {current} nx AlwaysOff 
```

在命令行中输入以上内容后重新启动。请记住将其重新打开，因为它相当于脱下裤子运行 Windows。

编辑：上面的命令适用于 Vista。我还没有在 Windows 7 上尝试过。

# c# - ASP.NET 中的嵌套表单问题

> ID：1018949
> 
> 赞同：0
> 
> 时间：2009-06-19T16:49:12.423
> 
> 标签：c#, asp.net, jquery, file-upload, nested-forms

我想在单击按钮时显示一个弹出窗口。弹出窗口应该有一个文件上传控件。我需要实现上传功能。

基本页面具有嵌套表单。总共嵌套了三个表格。如果我评论这两个表单，那么我可以从请求对象中获取发布的文件。但我不应该评论其他两种形式。使用嵌套表单，我没有从 Request 对象中获取发布的文件。

我需要一些协议来实现这一点。

我正在使用 C#。弹出窗口是使用 jQuery 设计的。

正如建议的那样，我在此处发布示例代码。

```
<form id="frmMaster" name="frmMaster" method="post" action="Main.aspx" Runat="server" enctype="multipart/form-data">

<form method='Post' name='frmSub'>                      
<input type="hidden" name='hdnData' value=''>                   
</form> // This form is driven dynamically from XSL

<form method='Post' name='frmMainSub'>                      
<input type="hidden" name='hdnSet' value=''>                    
</form>

</form> 
```

* * *

### 笔记：

评论内部形式工作正常。但是因为它需要其他功能，所以不应该触及这些表格。

我已经给出了这个代码作为示例。此页面中的实际 LOC 为 1200。第二个表单动态加载了许多控件。我被要求不要碰现有的表格。是否可以使用嵌套表单执行此功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-19T17:02:28.040

一个页面中可以有多个 HTML 表单标签，但它们不能相互嵌套。您需要删除嵌套才能使其正常工作。如果您发布一些代码，您可能会获得更多帮助，并提供一些解决此问题的具体建议。

从您发布的代码中，也不清楚为什么您甚至会倾向于使用多种形式。你能详细说明为什么你认为你需要多种表格吗？您的子表单中没有明确的操作，因此很难说出您希望他们发布的位置，但我猜它们都发布到同一页面。那么，为什么要使用多种形式呢？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T17:47:02.680

You could always try putting one of the inner forms onto another page and serving it up in an iframe. That way the inner form is not technically inside the outer form. This will require you to alter some of the html, but there's really no way around that.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T17:37:56.217

在您的情况下，无论您如何表达，您都在寻找黑客攻击。你不应该有嵌套的表格。

由于您使用 Javascript 来执行此操作，因此您*可以*尝试将要回发的表单元素移出父表单，然后在移动后执行*.submit()*操作。

这是一个丑陋的黑客 - 但我也是 HTML - :) （我孩子，我孩子！）

# sql - JOIN 或 WHERE 中的条件

> ID：1018952
> 
> 赞同：245
> 
> 时间：2009-06-19T16:49:46.807
> 
> 标签：sql, performance

将条件放入 JOIN 子句与 WHERE 子句之间是否有任何区别（性能、最佳实践等）？

例如...

```
-- Condition in JOIN
SELECT *
FROM dbo.Customers AS CUS
INNER JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
AND CUS.FirstName = 'John'

-- Condition in WHERE
SELECT *
FROM dbo.Customers AS CUS
INNER JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
WHERE CUS.FirstName = 'John' 
```

你更喜欢哪个（也许是为什么）？

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2009-06-19T17:00:50.367

关系代数允许`WHERE`子句和中的谓词可互换`INNER JOIN`，因此即使是`INNER JOIN`带有子句的查询也可以让优化器重新排列谓词，以便在处理过程`WHERE`中它们**可能已经被排除在外**`JOIN`。

我建议您以最易读的方式编写查询。

有时这包括制作`INNER JOIN`相对“不完整”的标准并将一些标准`WHERE`简单地放入其中以使过滤标准列表更易于维护。

例如，而不是：

```
SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
    AND c.State = 'NY'
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
    AND a.Status = 1 
```

写：

```
SELECT *
FROM Customers c
INNER JOIN CustomerAccounts ca
    ON ca.CustomerID = c.CustomerID
INNER JOIN Accounts a
    ON ca.AccountID = a.AccountID
WHERE c.State = 'NY'
    AND a.Status = 1 
```

但这当然取决于。

* * *

## 回答 #2

> 赞同：154
> 
> 时间：2009-06-19T18:34:49.907

对于内部连接，我并没有真正注意到差异（但与所有性能调整一样，您需要在您的条件下检查您的数据库）。

但是，如果您使用左连接或右连接，则放置条件的位置会有很大的不同。例如考虑这两个查询：

```
SELECT *
FROM dbo.Customers AS CUS 
LEFT JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
WHERE ORD.OrderDate >'20090515'

SELECT *
FROM dbo.Customers AS CUS 
LEFT JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
AND ORD.OrderDate >'20090515' 
```

第一个将只为您提供那些订单日期晚于 2009 年 5 月 15 日的记录，从而将左连接转换为内连接。

第二个将提供这些记录以及任何没有订单的客户。结果集非常不同，具体取决于您放置条件的位置。（选择 * 仅用于示例目的，当然您不应该在生产代码中使用它。）

例外情况是您只想查看一个表中的记录而不查看另一个表中的记录。然后，您将 where 子句用于条件而不是连接。

```
SELECT *
FROM dbo.Customers AS CUS 
LEFT JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
WHERE ORD.OrderID is null 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-06-19T16:54:55.583

大多数 RDBMS 产品将同样优化这两个查询。在 Peter Gulutzan 和 Trudy Pelzer 的“SQL 性能调优”中，他们测试了多个品牌的 RDBMS，没有发现性能差异。

我更喜欢将连接条件与查询限制条件分开。

如果您`OUTER JOIN`有时使用，则有必要在 join 子句中添加条件。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-06-19T16:51:45.557

WHERE 将在 JOIN 发生后过滤。

过滤 JOIN 以防止在 JOIN 过程中添加行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T16:52:11.983

我更喜欢 JOIN 来连接完整的表/视图，然后使用 WHERE 来引入结果集的谓词。

它在语法上感觉更干净。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-19T16:55:49.110

在对连接进行过滤时，我通常会看到性能提高。特别是如果您可以加入两个表的索引列。您应该能够通过大多数查询也这样做来减少逻辑读取，也就是说，在大容量环境中，这是一个比执行时间更好的性能指标。

当有人展示他们的 SQL 基准测试并且他们在开发服务器上午夜执行了 sproc 的两个版本 50,000 次并比较了平均时间时，我总是感到有点好笑。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-02-13T19:51:01.937

同意第二个投票最多的答案，即使用`LEFT JOIN`or时会有很大的不同`RIGHT JOIN`。实际上，下面的两个语句是等价的。因此，您可以看到该`AND`子句在之前执行过滤器，`JOIN`而`WHERE`子句在之后执行过滤器`JOIN`。

```
SELECT *
FROM dbo.Customers AS CUS 
LEFT JOIN dbo.Orders AS ORD 
ON CUS.CustomerID = ORD.CustomerID
AND ORD.OrderDate >'20090515'

SELECT *
FROM dbo.Customers AS CUS 
LEFT JOIN (SELECT * FROM dbo.Orders WHERE OrderDate >'20090515') AS ORD 
ON CUS.CustomerID = ORD.CustomerID 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T16:53:21.437

在我看来，将条件放入连接中似乎“语义错误”，因为这不是 JOIN 的“用途”。但这是非常定性的。

附加问题：如果您决定从内部联接切换到例如右联接，则将条件置于 JOIN 内部可能会导致意外结果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T17:27:06.760

在我看来，当你有一个更大的表时，连接会更快。这确实没有太大区别，特别是如果您处理的是一张相当小的桌子。当我第一次了解连接时，有人告诉我连接中的条件就像 where 子句条件一样，如果 where 子句特定于在哪个表上执行条件，我可以互换使用它们。

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2018-07-18T12:44:13.640

最好在 Join 中添加条件。性能比可读性更重要。对于大型数据集，这很重要。

# php - 插入时自动将字符串剪辑到适当的长度

> ID：1018954
> 
> 赞同：2
> 
> 时间：2009-06-19T16:50:05.387
> 
> 标签：php, mysql, pdo

我在 MySQL 中有一个包含各种 VARCHAR 字段的表。我想通过 PHP 从表单中插入一些用户数据。显然，如果我知道 PHP 中的字段长度，我可以用`substr()`. 但是这种违反 DRY（存储在 MySQL 中的字段长度并作为我的 PHP 脚本中的常量）。有没有办法让我配置一个 INSERT 以便它自动切断过长的字符串，而不是失败？

编辑：当我的字符串过长时，它在 PHP/PDO 中失败（或至少导致异常）。不知道我必须在 PHP/PDO 中做什么，所以它做正确的事。

编辑2：呃。这是错误的方法；即使我让它在 INSERT 上正常工作，如果我想检查重复的字符串，它也不会正确匹配。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-19T17:05:11.127

实际上，MySQL 默认将字符串截断为列宽。它会生成警告，但允许插入。

```
mysql> create table foo (str varchar(10));
mysql> insert into foo values ('abcdefghijklmnopqrstuvwxyz');
Query OK, 1 row affected, 1 warning (0.00 sec)
mysql> show warnings;
+---------+------+------------------------------------------+
| Level   | Code | Message                                  |
+---------+------+------------------------------------------+
| Warning | 1265 | Data truncated for column 'str' at row 1 | 
+---------+------+------------------------------------------+
mysql> select * from foo;
+------------+
| str        |
+------------+
| abcdefghij | 
+------------+ 
```

如果您设置严格的 SQL 模式，它会将警告变为错误并拒绝插入。

* * *

回复您的评论：SQL 模式是 MySQL 服务器配置。它可能不是导致它的 PDO，但另一方面它是可能的，因为任何客户端都可以为其会话设置 SQL 模式。

您可以使用以下语句检索当前的全局或会话 sql_mode 值：

```
SELECT @@GLOBAL.sql_mode;
SELECT @@SESSION.sql_mode; 
```

默认值应为空字符串（未设置模式）。您可以使用 mysqld 选项或使用语句在`my.cnf`文件中设置 SQL 模式。`--sql-mode``SET`

更新：MySQL 5.7 及更高版本默认设置严格模式。见[https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html](https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T17:52:36.620

您可以查询 information_schema 以获取列的长度并在插入之前使用该数据进行截断，但这比必要的开销更大。只需为此语句关闭严格的 SQL 模式：

```
SET @prev_mode = @@sql_mode;
SET sql_mode = '';
INSERT blah....;
SET sql_mode = @prev_mode; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-02T17:48:42.237

您可以使用列元数据来检查字符串长度。（[关于 PDOStatement->getColumnMeta 的 PHP 手册](http://php.net/manual/en/pdostatement.getcolumnmeta.php)）

以这种方式获取整个表的元数据

```
$query = $conn->query("SELECT * FROM places");
$numcols = $query->columnCount();

$tablemeta = array();
for ($i = 0; $i < $numcols; $i++) {
    $colmeta = $query->getColumnMeta($i);
    $tablemeta[$colmeta['name']] = $colmeta;
} 
```

# javascript - 如何从 Safari 4 的 Javascript 调试器中删除断点？

> ID：1018957
> 
> 赞同：5
> 
> 时间：2009-06-19T16:50:39.413
> 
> 标签：javascript, safari, debugging

如何从 Safari 4 的 Javascript 调试器中删除断点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-01-05T21:41:52.663

或者，根据苹果...

“装订线中的蓝色箭头表示在执行该行代码之前，执行将停止。要暂时禁用断点，请单击它；它会从蓝色变为灰色，表示已禁用。要删除断点，请将其拖到外面排水沟的。”

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-11-09T05:40:14.407

对于最近的 Safari（在本例中为 11），单击左侧框中显示断点的任何断点。点击删除并按住。它将把它们全部消灭。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-20T20:21:48.467

再次单击它将禁用它（变为浅蓝色），但该行始终突出显示为断点（或断点 woz 'ere）。如果您发现不久之后需要重新设置，视觉指示会很方便。无论如何，禁用的断点的行为就像没有断点一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-28T04:10:48.247

我知道已经有一段时间了，但如果有人现在遇到这个问题（就像我在深夜调试会话时所做的那样），我可以进入“例外”选项卡（[http://cl.ly/image/1M0K1O0a0T2w ) 并且未捕获的异常 (](http://cl.ly/image/1M0K1O0a0T2w) [http://cl.ly/image/0Y2I1n3F1c2F](http://cl.ly/image/0Y2I1n3F1c2F) )下面列出了所有断点的列表。突出显示最上面的断点并在我的键盘上按 Delete 直到它们都消失了，可以在短时间内处理所有断点。

# c# - 是否有必要将 StreamWriter 包装在 using 块中？

> ID：1018963
> 
> 赞同：25
> 
> 时间：2009-06-19T16:51:36.963
> 
> 标签：c#

几天前，我发布了一些这样的代码：

```
StreamWriter writer = new StreamWriter(Response.OutputStream);
writer.WriteLine("col1,col2,col3");
writer.WriteLine("1,2,3");
writer.Close();
Response.End(); 
```

有人告诉我，如果出现异常，我应该将 StreamWriter 包装在 using 块中。这样的更改将使它看起来像这样：

```
using(StreamWriter writer = new StreamWriter(Response.OutputStream))
{
    writer.WriteLine("col1,col2,col3");
    writer.WriteLine("1,2,3");
    writer.Close(); //not necessary I think... end of using block should close writer
}
Response.End(); 
```

我不确定为什么这是一个有价值的变化。如果在没有 using 块的情况下发生异常，编写器和响应仍然会被清理，对吗？using 块对我有什么好处？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-19T16:53:45.163

不，在第一个示例中流将保持打开状态，因为错误会否定它的关闭。

using 运算符强制调用 Dispose()，它应该在对象退出块时清理对象并关闭所有打开的连接。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-19T18:17:02.150

我要发表不同意见。具体问题“是否有必要将 StreamWriter 包装在 using 块中？”的答案 实际上是没有**。**事实上，你*不应该*在 StreamWriter 上调用 Dispose，因为它的 Dispose 设计得很糟糕并且做错了事情。

StreamWriter 的问题在于，当您 Dispose 它时，它会 Dispose 底层流。如果您使用文件名创建了 StreamWriter，并且它在内部创建了自己的 FileStream，那么这种行为将是完全合适的。但是，如果像这里一样，您使用现有流创建了 StreamWriter，那么这种行为绝对是 The Wrong Thing(tm)。但无论如何它都会这样做。

这样的代码不起作用：

```
var stream = new MemoryStream();
using (var writer = new StreamWriter(stream)) { ... }
stream.Position = 0;
using (var reader = new StreamReader(stream)) { ... } 
```

因为当 StreamWriter 的`using`块处理 StreamWriter 时，这将反过来丢弃流。因此，当您尝试从流中读取数据时，您会得到一个 ObjectDisposedException。

StreamWriter 严重违反了“清理自己的烂摊子”规则。它试图清理别人的烂摊子，无论他们是否愿意。

*（想象一下，如果你在现实生活中尝试过。试着向警察解释你为什么闯入别人的房子并开始把他们所有的东西都扔进垃圾桶......）*

出于这个原因，我认为 StreamWriter（和 StreamReader，它做同样的事情）是少数几个“如果它实现 IDisposable，你应该调用 Dispose”是错误的类之一。*永远不要*在现有流上创建的 StreamWriter 上调用 Dispose。改为调用 Flush()。

然后确保在需要时清理 Stream。（正如 Joe 所指出的，ASP.NET 为您处理了 Response.OutputStream，因此您不必在这里担心。）

警告：如果您不 Dispose StreamWriter，那么您*确实*需要在完成写入后调用 Flush()。否则，您可能仍然会在内存中缓冲数据，而这些数据永远不会进入输出流。

我对 StreamReader 的规则是，假装它没有实现 IDisposable。完成后就放手吧。

我对 StreamWriter 的规则是，调用 Flush，否则你会调用 Dispose。（这意味着您必须使用`try`..`finally`而不是`using`.）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-19T16:55:00.780

如果在没有 using 块的情况下发生异常并终止程序，您将留下 openconnections。using 块将始终为您关闭连接，类似于您要使用 try{}catch{}finally{}

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-19T16:56:39.157

最终，作者将被清理干净。当这种情况发生时取决于垃圾收集器，谁会注意到该命令的 Dispose 尚未被调用，并调用它。当然，GC 可能不会运行几分钟、几小时或几天，具体取决于具体情况。如果作者持有一个文件的排他锁，那么即使你已经完成了很长时间，其他进程也无法打开它。

using 块确保始终进行 Dispose 调用，因此无论发生什么控制流，始终调用 Close。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-19T17:12:57.717

将 包装`StreamWriter`在一个`using`块中几乎等同于以下代码：

```
StreamWriter writer;
try
{
    writer = new StreamWriter(Response.OutputStream);
    writer.WriteLine("col1,col2,col3");
    writer.WriteLine("1,2,3");
}
catch
{
    throw;
}
finally
{
    if (writer != null)
    {
        writer.Close();    
    }
} 
```

虽然您可以自己编写此代码，但将其放在 using 块中要容易得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-19T16:55:40.640

在我看来，有必要将任何实现 IDisposable 的类包装在 using 块中。类实现 IDisposable 的事实意味着该类具有需要清理的资源。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-19T17:32:01.437

我的经验法则是，如果我看到 Intellisense 中列出了 Dispose，我会将其包装在 using 块中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-19T16:56:10.933

using 块在结束时调用 dispose()。这只是确保及时清理资源的一种便捷方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T16:56:12.603

在几乎所有情况下，如果一个类实现了 IDisposable，并且您正在创建该类的实例，那么您需要 using 块。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-19T17:41:24.980

正如其他人所指出的，尽管始终处置 StreamWriter 等一次性类是一种很好的做法，但在这种情况下，这并不重要。

Response.OutputStream 将在 ASP.NET 基础结构处理完您的请求后释放。

StreamWriter 假定它“拥有”一个传递给构造函数的 Stream，因此将在处理流时关闭该流。但是在您提供的示例中，流是在您的代码之外实例化的，因此将有另一个所有者负责清理。

# xslt - 使用 XSLT 1.0 进行标记和排序

> ID：1018974
> 
> 赞同：5
> 
> 时间：2009-06-19T16:53:57.177
> 
> 标签：xslt, sorting, tokenize, xslt-1.0

我有一个分隔字符串（在下面的示例中由空格分隔），我需要对其进行标记、排序，然后重新连接在一起，我需要使用 XSLT 1.0 完成所有这些操作。我该怎么做？我知道我需要以`xsl:sort`某种方式使用，但到目前为止我所尝试的一切都给了我某种错误。

例如，如果我运行这篇文章底部的代码，我会得到：

> 草莓 蓝莓 橙 覆盆子 青柠 柠檬

如果我想得到这个，我会怎么做？：

> 蓝莓 柠檬 酸橙 橙 覆盆子 草莓

请注意，我使用的是 XSLT 1.0。

这是代码，它基于[Jeni Tennison](http://www.jenitennison.com/xslt/index.html)的代码。

```
<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="tokenize1.xsl"?>
<xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:template match="/">
  <xsl:call-template name="tokenize">
    <xsl:with-param name="string" select="'strawberry blueberry orange raspberry lime lemon'" />
  </xsl:call-template>
</xsl:template>

<xsl:template name="tokenize">
  <xsl:param name="string" />
  <xsl:param name="delimiter" select="' '" />
  <xsl:choose>
    <xsl:when test="$delimiter and contains($string, $delimiter)">
      <token>
        <xsl:value-of select="substring-before($string, $delimiter)" />
      </token>
      <xsl:text> </xsl:text>
      <xsl:call-template name="tokenize">
        <xsl:with-param name="string" 
                        select="substring-after($string, $delimiter)" />
        <xsl:with-param name="delimiter" select="$delimiter" />
      </xsl:call-template>
    </xsl:when>
    <xsl:otherwise>
      <token><xsl:value-of select="$string" /></token>
      <xsl:text> </xsl:text>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-20T00:03:59.303

这是一个低效的纯版本 1 解决方案：

```
<!-- Sort the tokens -->
<xsl:template name="sortTokens">
  <xsl:param name="tokens" select="''"/>      <!-- The list of tokens -->
  <xsl:param name="separator" select="' '"/>  <!-- What character separates the tokens? -->
  <xsl:param name="pivot" select="''"/>       <!-- A pivot word used to divide the list -->
  <xsl:param name="lessThan" select="''"/>    <!-- Accumulator for tokens less than the pivot (with leading separator) -->
  <xsl:param name="moreThan" select="''"/>    <!-- Accumulator for tokens more than the pivot (with leading separator) -->
  <xsl:param name="leadWith" select="''"/>    <!-- If set, output this before sorting -->
  <xsl:param name="trailWith" select="''"/>   <!-- If set, output this after sorting -->

  <!-- The first token -->
  <xsl:variable name="firstToken" select="substring-before(concat($tokens,$separator),$separator)"/>

  <!-- Is the first token more or less than the pivot? -->
  <xsl:variable name="pivotVsFirstToken">
    <xsl:call-template name="compareStrings">
      <xsl:with-param name="a" select="$pivot"/>
      <xsl:with-param name="b" select="$firstToken"/>
    </xsl:call-template>
  </xsl:variable>

  <xsl:choose>
    <!-- No input, no output -->
    <xsl:when test="$tokens = '' and $pivot = ''"></xsl:when>

    <!-- At the outset, the first token becomes the pivot -->
    <xsl:when test="$pivot = ''">
      <xsl:value-of select="$leadWith"/>
      <xsl:call-template name="sortTokens">
        <xsl:with-param name="separator" select="$separator"/>
        <xsl:with-param name="tokens" select="substring-after($tokens,$separator)"/>
        <xsl:with-param name="pivot" select="$firstToken"/>
      </xsl:call-template>
      <xsl:value-of select="$trailWith"/>
    </xsl:when>

    <!-- When all tokens are in a bucket, output the pivot between sorted buckets -->
    <xsl:when test="$tokens = ''">
      <xsl:call-template name="sortTokens">
        <xsl:with-param name="separator" select="$separator"/>
        <xsl:with-param name="tokens" select="substring-after($lessThan,$separator)"/>
        <xsl:with-param name="trailWith" select="$separator"/>
      </xsl:call-template>
      <xsl:value-of select="$pivot"/>
      <xsl:call-template name="sortTokens">
        <xsl:with-param name="separator" select="$separator"/>
        <xsl:with-param name="tokens" select="substring-after($moreThan,$separator)"/>
        <xsl:with-param name="leadWith" select="$separator"/>
      </xsl:call-template>
    </xsl:when>

    <!-- If the first token is less than the pivot, put it in the lessThan bucket -->
    <xsl:when test="number($pivotVsFirstToken) = 1">
      <xsl:call-template name="sortTokens">
        <xsl:with-param name="separator" select="$separator"/>
        <xsl:with-param name="tokens" select="substring-after($tokens,$separator)"/>
        <xsl:with-param name="pivot" select="$pivot"/>
        <xsl:with-param name="lessThan" select="concat($separator,$firstToken,$lessThan)"/>
        <xsl:with-param name="moreThan" select="$moreThan"/>
      </xsl:call-template>
    </xsl:when>

    <!-- If the first token is more than the pivot, put it in the moreThan bucket -->
    <xsl:otherwise>
      <xsl:call-template name="sortTokens">
        <xsl:with-param name="separator" select="$separator"/>
        <xsl:with-param name="tokens" select="substring-after($tokens,$separator)"/>
        <xsl:with-param name="pivot" select="$pivot"/>
        <xsl:with-param name="lessThan" select="$lessThan"/>
        <xsl:with-param name="moreThan" select="concat($separator,$firstToken,$moreThan)"/>
      </xsl:call-template>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

<!-- Quote an apostrophe -->
<xsl:variable name="apos" select="&quot;'&quot;"/>

<!-- The comparison order of the characters -->
<xsl:variable name="characterOrder" select="concat(' !&quot;#$%&amp;',$apos,'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~')"/>

<!-- Return -1 if string a is less, 1 if string b is less, or 0 if they are equal -->
<xsl:template name="compareStrings">
  <xsl:param name="a" select="''"/>
  <xsl:param name="b" select="''"/>
  <xsl:choose>
    <xsl:when test="$a = '' and $b = ''">0</xsl:when>
    <xsl:when test="$a = ''">-1</xsl:when>
    <xsl:when test="$b = ''">1</xsl:when>
    <xsl:when test="substring($a,1,1) = substring($b,1,1)">
      <xsl:call-template name="compareStrings">
        <xsl:with-param name="a" select="substring($a,2)"/>
        <xsl:with-param name="b" select="substring($b,2)"/>
      </xsl:call-template>
    </xsl:when>
    <xsl:when test="contains(substring-after($characterOrder,substring($a,1,1)),substring($b,1,1))">-1</xsl:when>
    <xsl:otherwise>1</xsl:otherwise>
  </xsl:choose>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:58:02.350

如果你的处理器支持 EXSLT，你最好使用[str:tokenize](http://exslt.org/str/functions/tokenize/index.html)

对于排序，为什么不使用 xsl:sort？

```
<xsl:template match="/">
  <xsl:variable name="tokens">
    <xsl:call-template name="tokenize">
      <xsl:with-param name="string" select="'strawberry blueberry orange raspberry lime lemon'" />
    </xsl:call-template>
  </xsl:variable>

  <xsl:for-each select="$tokens">
    <xsl:sort select="text()" />
    <xsl:value-of select="." />
    <xsl:if test="not(last())">
      <xsl:text> </xsl:text>
    </xsl:if>
  </xsl:for-each>
</xsl:template> 
```

请注意，您可能需要 exsl:node-set 执行迭代。

# c# - 如何使这个 LINQ 查询更干净？

> ID：1018975
> 
> 赞同：1
> 
> 时间：2009-06-19T16:54:17.893
> 
> 标签：c#, linq, linq-to-sql, refactoring

我最近编写了一个 LINQ 查询来获取`Dictionary`包含过去 6 个月的安置金额。

它返回一个`Dictionary`月份字符串 - 十进制金额对。

这似乎有点笨拙。你们中的任何 LINQ 大师都可以帮助我重构它以使其更清洁吗？

```
/// <summary>
/// Gets the last 6 months of Placement History totalled by Month 
/// for all Agencies
/// </summary>
/// <returns></returns>
public Dictionary<string, decimal> getRecentPlacementHistory()
{
    var placementHistoryByMonth = new Dictionary<string, decimal>();

    using (DemoLinqDataContext db = new DemoLinqDataContext())
    {
        for (int i = 0; i < 6; i++)
        {
            Decimal monthTotal = 
              (from a in db.Accounts
               where 
                 (a.Date_Assigned.Value.Month == DateTime.Now.AddMonths(-i).Month &&
                  a.Date_Assigned.Value.Year == DateTime.Now.AddMonths(-i).Month)
               select a.Amount_Assigned).Sum();
            String currentMonth = DateTime.Now.AddMonths(-i).ToString("MMM");

            placementHistoryByMonth.Add(currentMonth, monthTotal);
        }
        return placementHistoryByMonth;
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-19T17:03:09.817

第一个问题：

```
where (a.Date_Assigned.Value.Month == DateTime.Now.AddMonths(-i).Month &&
       a.Date_Assigned.Value.Year == DateTime.Now.AddMonths(-i).Month) 
```

后一个表达式不应该以 .Year 而不是 .Month 结尾吗？当然，您很少会得到 1-12 的年份...

当您经常使用它时，我会提取“当前月份”的想法。请注意，您还多次使用当前时间，如果它在月底的午夜运行，这可能会产生奇怪的结果......

```
public Dictionary<string, decimal> getRecentPlacementHistory()
{
    var placementHistoryByMonth = new Dictionary<string, decimal>();
    using (DemoLinqDataContext db = new DemoLinqDataContext())
    {
        DateTime now = DateTime.Now;

        for (int i = 0; i < 6; i++)
        {
            DateTime selectedDate = now.AddMonths(-i);

            Decimal monthTotal = 
               (from a in db.Accounts
                where (a.Date_Assigned.Value.Month == selectedDate.Month &&
                       a.Date_Assigned.Value.Year == selectedDate.Year)
                select a.Amount_Assigned).Sum();

            placementHistoryByMonth.Add(selectedDate.ToString("MMM"),
                                        monthTotal);
        }
        return placementHistoryByMonth;
    }
} 
```

我意识到这可能是您试图摆脱的循环。您可以尝试计算整个批次的日期的上限和下限，然后`a.Date_Assigned`在相关范围内按年/月分组。老实说，它不会更漂亮。请注意，这只是对数据库的一次查询，如果你能完成的话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T19:29:33.663

使用分组依据

```
DateTime now = DateTime.Now;
DateTime thisMonth = new DateTime(now.Year, now.Month, 1);

Dictionary<string, decimal> dict;
using (DemoLinqDataContext db = new DemoLinqDataContext())
{
    var monthlyTotal = from a in db.Accounts
        where a.Date_Assigned > thisMonth.AddMonths(-6)
        group a by new {a.Date_Assigned.Year, a.Date_Assigned.Month} into g
        select new {Month = new DateTime(g.Key.Year, g.Key.Month, 1),
                    Total = g.Sum(a=>a.Amount_Assigned)};

    dict = monthlyTotal.OrderBy(p => p.Month).ToDictionary(n => n.Month.ToString("MMM"), n => n.Total);
} 
```

无需循环！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T18:03:50.893

如果您不担心缺少没有数据的月份，那么我在执行以下操作时遇到了类似的问题：（转换为您的变量）

```
 DateTime startPeriod = 
     new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1).AddMonths(-6);

  var query1 = from a in db.Accounts where a.Date_Assigned >= startPeriod
 group a by new { a.Date_Assigned.Year  ,a.Date_Assigned.Month  } into result
 select new
 {
     dt = new DateTime( result.Key.Year, result.Key.Month , 1),
     MonthTotal = result.Sum(i => i.Amount_Assigned)
 } ;             

  var dict = query1.OrderBy(p=> p.dt).ToDictionary(n => n.Dt.ToString("MMM") , n => n.MonthTotal ); 
```

# python - 使用 __init__ 和设置类变量之间的区别

> ID：1018977
> 
> 赞同：3
> 
> 时间：2009-06-19T16:54:44.307
> 
> 标签：python, descriptor

我正在尝试学习描述符，但我对对象的行为感到困惑——在下面的两个示例中，据我所知`__init__`它们应该工作相同。有人可以解开我的困惑，或者将我指向一个可以解释这一点的资源吗？

```
import math
class poweroftwo(object):
    """any time this is set with an int, turns it's value to a tuple of the int
    and the int^2"""
    def __init__(self, value=None, name="var"):
        self.val = (value, math.pow(value, 2))
        self.name = name

    def __set__(self, obj, val):
        print "SET"
        self.val = (val, math.pow(val, 2))
    def __get__(self, obj, objecttype):
        print "GET"
        return self.val

class powoftwotest(object):
    def __init__(self, value):
        self.x = poweroftwo(value)

class powoftwotest_two(object):
    x = poweroftwo(10)

>>> a = powoftwotest_two()
>>> b = powoftwotest(10)
>>> a.x == b.x
>>> GET
>>> False #Why not true? shouldn't both a.x and b.x be instances of poweroftwo with the same values? 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-19T17:15:01.363

首先，请用LeadingUpperCaseNames 命名所有类。

```
>>> a.x
GET
(10, 100.0)
>>> b.x
<__main__.poweroftwo object at 0x00C57D10>
>>> type(a.x)
GET
<type 'tuple'>
>>> type(b.x)
<class '__main__.poweroftwo'> 
```

`a.x`是实例级访问，支持描述符。这就是 3.4.2.2 节中“（一个所谓的描述符类）出现在另一个新式类的类字典中”的意思。类字典必须由实例访问才能使用`__get__`and`__set__`方法。

`b.x`是类级访问，不支持描述符。

# javascript - 如何在运行时动态重新配置 Drupal 的基于 jQuery 的自动完成功能？

> ID：1018981
> 
> 赞同：5
> 
> 时间：2009-06-19T16:55:08.360
> 
> 标签：javascript, jquery, drupal, autocomplete, drupal-6

[Drupal](http://drupal.org/)有一个架构非常好的、基于[jQuery的](http://jquery.com/)[autocomplete.js](http://cvs.drupal.org/viewvc.py/drupal/drupal/misc/autocomplete.js?revision=1.23&view=markup&pathrev=DRUPAL-6)。通常，您不必费心，因为它的配置和执行由 Drupal 表单 API 处理。

现在，我需要一种在运行时重新配置它的方法（即使用 JavaScript）。我有一个标准的下拉选择框，旁边有一个文本字段，根据选择框中选择的选项，我需要调用不同的 URL 来自动完成，对于其中一个选项，应该完全禁用自动完成。是否可以重新配置现有的自动完成实例，或者我必须以某种方式销毁并重新创建？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-20T00:30:43.803

看看 misc/autocomplete.js。

```
/**
 * Attaches the autocomplete behavior to all required fields
 */
Drupal.behaviors.autocomplete = function (context) {
  var acdb = [];
  $('input.autocomplete:not(.autocomplete-processed)', context).each(function () {
    var uri = this.value;
    if (!acdb[uri]) {
      acdb[uri] = new Drupal.ACDB(uri);
    }
    var input = $('#' + this.id.substr(0, this.id.length - 13))
      .attr('autocomplete', 'OFF')[0];
    $(input.form).submit(Drupal.autocompleteSubmit);
    new Drupal.jsAC(input, acdb[uri]);
    $(this).addClass('autocomplete-processed');
  });
}; 
```

输入的 value 属性用于创建 ACDB，这是该自动完成路径 (uri) 的值缓存。这在 Drupal.jsAC 函数中用于绑定元素的 keydown、keyup 和 blur 事件，触发自动完成 ajax 操作（将其值缓存在该元素的 ACDB 对象中）、打开弹出窗口等。

```
/**
 * An AutoComplete object
 */
Drupal.jsAC = function (input, db) {
  var ac = this;
  this.input = input;
  this.db = db;

  $(this.input)
    .keydown(function (event) { return ac.onkeydown(this, event); })
    .keyup(function (event) { ac.onkeyup(this, event); })
    .blur(function () { ac.hidePopup(); ac.db.cancel(); });

}; 
```

您需要做的是更改输入的值并重新附加行为。您将通过删除自动完成文本字段输入元素上的“.autocomplete-processed”类重新附加该行为，然后调用 Drupal.attachBehaviors(thatInputElement)。

这可能行不通。如果你一遍又一遍地将相同的行为附加到同一个元素上，事情可能会变得非常糟糕。创建不同的自动完成字段并根据选择的值简单地隐藏和显示它们可能更明智。当您隐藏和显示小部件时，这仍然需要调用 Drupal.attachBehaviors，但如果切换发生多次，相同的行为将保持附加，并且您不会冒险将相同的行为多次附加到元素。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T15:19:51.490

好吧，作为参考，我整理了一个可行的技巧，但如果有人能想到更好的解决方案，我会很高兴听到它。

```
Drupal.behaviors.dingCampaignRules = function () {
  $('#campaign-rules')
    .find('.campaign-rule-wrap')
      .each(function (i) {
          var type = $(this).find('select').val();

          $(this).find('.form-text')
            // Remove the current autocomplete bindings.
            .unbind()
            // And remove the autocomplete class
            .removeClass('form-autocomplete')
          .end()
          .find('select:not(.dingcampaignrules-processed)')
            .addClass('dingcampaignrules-processed')
            .change(Drupal.behaviors.dingCampaignRules)
          .end();

          if (type == 'page' || type == 'library' || type == 'taxonomy') {
            $(this).find('input.autocomplete')
              .removeClass('autocomplete-processed')
              .val(Drupal.settings.dingCampaignRules.autocompleteUrl + type)
            .end()
            .find('.form-text')
              .addClass('form-autocomplete');
            Drupal.behaviors.autocomplete(this);
          }
      });
}; 
```

此代码来自[ding_campaign 模块](http://github.com/kdb/ding/tree/master/sites/all/modules/ding_campaign)。如果您需要做类似的事情，请随时查看代码。都是 GPL2。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-19T22:05:28.683

它应该像动态更改自动完成表单字段旁边的“隐藏”自动完成输入元素的“值”一样简单。IE。

```
$('select#myelement').bind('change', function(e) { 
  if (/* something */) {
    $('input#myelement-autocomplete').attr('value', '/mycustom/path');
  }
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-04T14:08:43.257

**Drupal 5**的工作解决方案

 **```
/*
 *  Błażej Owczarczyk
 *  blazej.owczarczyk@gmail.com 
 * 
 *  Name: Autocomplete City Taxonomy 
 *  Description: Hierarchical city selecting (province select and city autocomplete)
 */

var Act = Act || {};

Act.init = function () {
    $('select.act-province').change(Act.provinceChange);        // select with top taxonomy terms    
}

/*
 *  Change event of select element
 */
Act.provinceChange = function () { 
    var context = $(this).parent().parent();              
    var currentTid = $(this).val();
    Act.rewriteURI(context, currentTid);
    Act.unbind();
    Drupal.autocompleteAutoAttach();
};

/*
 *  Changes the value of hidden autocomplete input
 */
Act.rewriteURI = function (context, newTid) {
    var tempArray;
    tempArray = $('.autocomplete', context).val().split('/');
    tempArray.pop();
    tempArray.push(newTid);
    $('.autocomplete', context).val(tempArray.join('/'));    
};

/*
 *  Prevents muliple binding of the same events
 */
Act.unbind = function () {
    $('.form-autocomplete').unbind().parents('form').unbind('submit');
};

$(document).ready(Act.init); 
```**

# php - PHP - 只读电子表格文件类型？

> ID：1018988
> 
> 赞同：8
> 
> 时间：2009-06-19T16:56:17.563
> 
> 标签：php, formatting, file-type, spreadsheet, readonly

我正在使用一个简单的基于 Web 的 PHP 应用程序，它将表格输出为电子表格

```
header("Content-Disposition: attachment; filename=" . $filename . ".xls");
header("Content-Type: application/vnd.ms-excel");

//inserts tab delimited text 
```

但我发现下载的电子表格作为只读文件打开，必须保存在本地，并且（在 Windows 上的 Excel 中）类型更改为 XLS（来自 HTML）。有没有办法正确设置文件类型的属性，以便进行简单的保存不需要更正文件类型？

下载的文件是出于安全性而只读还是不正常？

此外，我不喜欢在 Excel 或 OpenOffice（Linux 上）中打开电子表格时创建的自动边框。我宁愿没有边框格式。文件中有没有办法指定不添加格式，或者这是否内置在这些应用程序中？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-07-19T20:29:53.960

我不知道您说的是哪个版本的 Excel，所以我假设您使用的是 2007 或更新版本。

扩展更改问题可能取决于名为“[扩展强化](http://blogs.msdn.com/b/vsofficedeveloper/archive/2008/03/11/excel-2007-extension-warning.aspx)”的 Office 功能；据我所知，唯一的解决方案是生成一个真正的 Excel 文件（例如通过使用[PHPExcel](http://phpexcel.codeplex.com/)类集），而不是 HTML 文件。

出于安全原因，下载的文件是只读的，因为它们是在所谓的“[受保护的视图](http://office.microsoft.com/en-us/excel-help/what-is-protected-view-HA010355931.aspx)”中打开的：

> 来自 Internet 和其他可能不安全的位置的文件可能包含病毒、蠕虫或其他类型的恶意软件，它们会损害您的计算机。为了帮助保护您的计算机，来自这些潜在不安全位置的文件会在受保护的视图中打开。通过使用受保护的视图，您可以读取文件并检查其内容，同时降低可能发生的风险。

最后，关于边框和格式：在旧的 Excel 2000 版本中，您可以通过在 HTML 代码的标题部分简单地添加一些 XML 标记来格式化输出；有关更多详细信息和示例，请参阅“ [Microsoft Office HTML 和 XML 参考](http://msdn.microsoft.com/en-us/library/aa155477%28office.10%29.aspx)”，但请记住，它已经过时了，所以我认为这种技术仍然不适用于最新的 Excel 版本。

如果您想更好地控制生成的输出，则不应使用简单的 HTML 来创建电子表格文件。

在[这篇文章](https://stackoverflow.com/questions/3930975/alternative-for-php-excel)中，您还可以找到一些 PHPExcel 的替代方法来编写 Excel 文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-19T18:13:44.450

AFAIK，至少在 Windows 上，这取决于用户在点击链接时对浏览器显示的提示做了什么。

如果用户选择保存文件，它将不是只读的。如果用户选择打开它，该文件将被保存到一个临时目录，并且浏览器可能会在它关闭时将其删除。我不确定这种机制是如何工作的，但我假设有一个锁涉及某个地方，使文件只读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-22T22:51:18.620

如果要在本地保存，可以设置属性`content-description`：

```
header('Content-Description: File Transfer');   
header('Content-Type: application/vnd.ms-excel');
header("Content-Disposition: attachment; filename=" . $filename . ".xls"); 
```

**编辑**

如果您打印制表符分隔的文本和属性`content-disposition`，如 xls 或 csv，Excel 应用程序（或其他程序，如 gnumeric 或 openoffice）会像 xls 或 csv 一样识别它。

# exception - 托管模式下的 GWT Javascript 异常：表达式 'doc.getBoxObjectFor' [undefined] 的结果不是函数

> ID：1018997
> 
> 赞同：3
> 
> 时间：2009-06-19T16:58:18.030
> 
> 标签：exception, gwt

有人见过这个例外吗？我在 Mac 上的 GWT 1.6.4 上以托管模式运行。我正在使用 AutoSuggest，它试图显示弹出窗口时抛出了这个异常。它在编译模式下工作正常，但显然托管模式相当重要。

```
[ERROR] Uncaught exception escaped
com.google.gwt.core.client.JavaScriptException: (TypeError): Result of expression 'doc.getBoxObjectFor' [undefined] is not a function.
 line: 71
 sourceId: 1152617088
 sourceURL: jar:file:/Users/holmes/.m2/repository/com/google/gwt/gwt-user/1.6.4/gwt-user-1.6.4.jar!/com/google/gwt/dom/client/DOMImplMozillaOld.java
 expressionBeginOffset: 288
 expressionCaretOffset: 307
 expressionEndOffset: 313
    at com.google.gwt.dom.client.DOMImplMozillaOld.getAbsoluteLeftImpl(Native Method)
    at com.google.gwt.dom.client.DOMImplMozillaOld.getAbsoluteLeft(DOMImplMozillaOld.java:29)
    at com.google.gwt.dom.client.Element$.getAbsoluteLeft$(Element.java:86)
    at com.google.gwt.user.client.DOM.getAbsoluteLeft(DOM.java:646)
    at com.google.gwt.user.client.ui.UIObject.getAbsoluteLeft(UIObject.java:487)
    at com.google.gwt.user.client.ui.PopupPanel.position(PopupPanel.java:1015)
    at com.google.gwt.user.client.ui.PopupPanel.access$5(PopupPanel.java:958)
    at com.google.gwt.user.client.ui.PopupPanel$1.setPosition(PopupPanel.java:811)
    at com.google.gwt.user.client.ui.PopupPanel.setPopupPositionAndShow(PopupPanel.java:700)
    at com.google.gwt.user.client.ui.PopupPanel.showRelativeTo(PopupPanel.java:809)
    at com.google.gwt.user.client.ui.SuggestBox.showSuggestions(SuggestBox.java:768)
    at com.google.gwt.user.client.ui.SuggestBox.access$3(SuggestBox.java:738)
    at com.google.gwt.user.client.ui.SuggestBox$1.onSuggestionsReady(SuggestBox.java:281)
    at com.google.gwt.user.client.ui.MultiWordSuggestOracle.requestSuggestions(MultiWordSuggestOracle.java:225)
    at com.google.gwt.user.client.ui.SuggestBox.showSuggestions(SuggestBox.java:640)
    at com.google.gwt.user.client.ui.SuggestBox.refreshSuggestions(SuggestBox.java:713)
    at com.google.gwt.user.client.ui.SuggestBox.access$6(SuggestBox.java:705)
    at com.google.gwt.user.client.ui.SuggestBox$1TextBoxEvents.onKeyUp(SuggestBox.java:678)
    at com.google.gwt.event.dom.client.KeyUpEvent.dispatch(KeyUpEvent.java:54)
    at com.google.gwt.event.dom.client.KeyUpEvent.dispatch(KeyUpEvent.java:1)
    at com.google.gwt.event.shared.HandlerManager$HandlerRegistry.fireEvent(HandlerManager.java:65)
    at com.google.gwt.event.shared.HandlerManager$HandlerRegistry.access$1(HandlerManager.java:53)
    at com.google.gwt.event.shared.HandlerManager.fireEvent(HandlerManager.java:178)
    at com.google.gwt.user.client.ui.Widget.fireEvent(Widget.java:52)
    at com.google.gwt.event.dom.client.DomEvent.fireNativeEvent(DomEvent.java:116)
    at com.google.gwt.user.client.ui.Widget.onBrowserEvent(Widget.java:90)
    at com.google.gwt.user.client.ui.TextBoxBase.onBrowserEvent(TextBoxBase.java:193)
    at com.google.gwt.user.client.ui.Composite.onBrowserEvent(Composite.java:54)
    at com.google.gwt.user.client.DOM.dispatchEventImpl(DOM.java:1320)
    at com.google.gwt.user.client.DOM.dispatchEventAndCatch(DOM.java:1299)
    at com.google.gwt.user.client.DOM.dispatchEvent(DOM.java:1262) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-22T20:37:46.427

在编译模式下使用 Firefox 3.7a1pre（“雷区”）时，我遇到了类似的问题。函数 getBoxObjectFor 被 getBoundingClientRect 取代。这是我让 GWT 再次工作的解决方法。只需在一开始的某个地方调用以下方法，至少对我来说它确实有效。

```
private static native void firefox3compatibility() /*-{
 if (!$doc.getBoxObjectFor) {
  $doc.getBoxObjectFor = function (element) {
   var box = element.getBoundingClientRect();
   return { "x"      : box.left,  "y"       : box.top,
            "screenX": box.left,  "screenY" : box.top,
            "width"  : box.width, "height"  : box.height };
  }
 }
}-*/; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-12T18:54:23.173

I fixed this successfully with the following inserted after nitobi.browser.detect(); in the nitobi.toolkit.js file. It's around line 575\. (ish)

```
if(nitobi.browser.MOZ) {
    if(typeof document.getBoxObjectFor == "undefined") {
        document.getBoxObjectFor = function(elem) {
            var obj = new Object;
            var rect = elem.getBoundingClientRect();
            obj.y = rect.top;
            obj.x = rect.left;
            obj.width =Math.abs(rect.right-rect.left);
            obj.height = Math.abs(rect.bottom-rect.top);
            return obj;
        }
    }
}

```

It works well if the Gecko browser you're targeting is implementing the function getBoundingClientRect like Mozilla.

They deprecated getBoxObjectFor, and instead added this function.

Hope that helps.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-13T09:00:18.420

`getBoxObjectFor`FF3.6 已弃用。这是在 GWT 中解决此问题的问题：[问题 4605](http://code.google.com/p/google-web-toolkit/issues/detail?id=4605)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-04T15:01:44.433

这是一个很好的修复，但我还需要将 screenX 和 screenY 添加到返回的对象中：

`private static native void firefox3compatibility() /-{ if (!$doc.getBoxObjectFor) { $doc.getBoxObjectFor = function (element) { var box = element.getBoundingClientRect(); return { "x" : box.left, "y" : box.top, "width" : box.width, "height" : box.height, "screenX": box.left, "screenY":box.top }; } } }-/;`

# class - 是否可以在没有整个项目的情况下重新编译单个 .java Java 文件？

> ID：1018999
> 
> 赞同：4
> 
> 时间：2009-06-19T16:59:19.340
> 
> 标签：class, jar, compilation

我有这个 .JAR 文件。我将它反编译为多个 .java 文件。在更新单个 .java 文件并重新编译后，有什么方法可以拥有一个新的功能性 .JAR 文件？如果有可能我们将如何重新编译这个 .java 文件而没有它的依赖项？（即外部库）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-19T17:02:00.303

当然！

问 javac

```
javac -cp <whatever classpath you have> path/to/YourClass.java 
```

之后你会说

```
jar uvf yourjar.jar path/to/YourClass*.class 
```

大功告成，您的 .jar 已更新，现在部署它！

请记住，.jar 文件只是一个包含类和清单的 zip 存档！

如果您的 java 源代码引用了任何外部类，您将需要它们。但是你也需要它们来实际使用编译的类，所以我想这不是一个大问题。