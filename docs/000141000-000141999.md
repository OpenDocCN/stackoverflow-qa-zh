# StackOverflow 问答 000141000-000141999

# javascript - Javascript error: [elementname] has no properties

> ID：141002
> 
> 赞同：4
> 
> 时间：2008-09-26T17:59:45.783
> 
> 标签：javascript, ajax

I'm doing some maintenance coding on a webapp and I am getting a javascript error of the form: "[elementname] has no properties"

Part of the code is being generated on the fly with an AJAX call that changes innerHTML for part of the page, after this is finished I need to copy a piece of data from a hidden input field to a visible input field. So we have the destination field: `<input id="dest" name="dest" value="0">`
And the source field: `<input id="source" name="source" value="1">`
Now when the ajax runs it overwrites the innerHTML of the div that source is in, so the source field now reads: `<input id="source" name="source" value="2">`

Ok after the javascript line that copies the ajax data to innerHTML the next line is: `document.getElementById('dest').value = document.getElementById('source').value;`

I get the following error: `Error: document.getElementById("source") has no properties`

(I also tried `document.formname.source` and `document.formname.dest` and same problem)

What am I missing?

Note1: The page is fully loaded and the element exists. The ajax call only happens after a user action and replaces the html section that the element is in.

Note2: As for not using innerHTML, this is how the codebase was given to me, and in order to remove it I would need to rewrite all the ajax calls, which is not in the scope of the current maintenance cycle.

Note3: the innerHTML is updated with the new data, a whole table with data and formatting is being copied, I am trying to add a boolean to the end of this big chunk, instead of creating a whole new ajax call for one boolean. It looks like that is what I will have to do... as my hack on the end then copy method is not working.

Extra pair of eyes FTW.

Yeah I had a couple guys take a look here at work and they found my simple typing mistake... I swear I had those right to begin with, but hey we live and learn...

Thanks for the help guys.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T18:17:52.977

"[elementname] has no properties" is javascript error speak for "the element you tried to reference doesn't exist or is nil"

This means you've got one or more of a few possible problems:

1.  Your page hasn't rendered yet and you're trying to reference it before it exists
2.  You've got a spelling error
3.  You've named your id the same as a reserved word (submit on a submit button for instance)
4.  What you think you're referencing you're really not (a passed variable that isn't what you think you're passing)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T18:02:44.403

Make sure your code runs AFTER the page fully loads. If your code runs before the element you are looking for is rendered, this type of error will occur.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T18:16:56.240

What your describing is this functionality:

```
<div id="test2">
    <input id="source" value="0" />
</div>
<input id="dest" value="1" />

<script type="text/javascript" charset="utf-8">
//<![CDATA[
function pageLoad()
{
    var container = document.getElementById('test2');
    container.innerHTML = "<input id='source' value='2' />";
    var source = document.getElementById('source');
    var dest = document.getElementById('dest');
    dest.value = source.value;
}
//]]>
</script> 
```

This works in common browsers (I checked in IE, Firefox and Safari); are you using some other browser or are you sure that it created the elements correct on innerHTML action?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T18:20:54.343

It sounds like the DOM isn't being updated with the new elements to me.

For that matter, why are you rewriting the entire div just to change the source input? Wouldn't it be just as easy to change source's value directly?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T18:22:24.790

This is a stretch, but just may be the trick - I have seen this before and this hack actually worked.

So, you said:

> Ok after the javascript line that copies the ajax data to innerHTML the next line is: document.getElementById('dest').value = document.getElementById('source').value;

Change that line to this:

```
setTimeout(function() {
   document.getElementById("dest").value = document.getElementById("source").value;
}, 10); 
```

You really shouldn't need this, but it is possible that the time between your setting the innerHTML and then trying to access the "source" element is so fast that the browser is unable to find it. I know, sounds completely whack, but I have seen browsers do this in certain instances for some reason that is beyond me.

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-26T18:02:07.460

Generally you shouldn't use innerHTML, but create elements using DOM-methods. I cannot say if this is your problem.

# c# - 从没有密钥的代码创建 XAML 资源

> ID：141007
> 
> 赞同：7
> 
> 时间：2008-09-26T18:00:56.543
> 
> 标签：c#, wpf, xaml, code-behind

有没有办法从代码中将资源添加到 ResourceDictionary 而不给它一个资源键？

例如，我在 XAML 中有这个资源：

```
<TreeView.Resources>
    <HierarchicalDataTemplate DataType="{x:Type xbap:FieldPropertyInfo}"
        ItemsSource="{Binding Path=Value.Values}">
            <TextBlock Text="{Binding Path=Name}" />
    <HierarchicalDataTemplate>
</TreeView.Resources> 
```

我需要从代码动态创建此资源并将其添加到 TreeView ResourceDictionary。但是，在 XAML 中没有 Key 意味着它默认用于所有 FieldPropertyInfo 类型。有没有办法在没有密钥的情况下将其添加到代码中的资源中，或者有没有办法我可以使用密钥并仍然在所有 FieldPropertyInfo 类型上使用它？

到目前为止，这是我在 C# 中所做的：

```
HierarchicalDataTemplate fieldPropertyTemplate = new HierarchicalDataTemplate("FieldProperyInfo");

fieldPropertyTemplate.ItemsSource = new Binding("Value.Values");

this.Resources.Add(null, fieldPropertyTemplate); 
```

显然，将资源添加到 ResourceDictionary 键为 null 不起作用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T18:05:37.670

使用您希望模板应用的类型作为键：

```
HierarchicalDataTemplate fieldPropertyTemplate = new 
    HierarchicalDataTemplate("FieldProperyInfo");

fieldPropertyTemplate.SetBinding(
   HierarchialDataTemplate.ItemSourceProperty, 
   new Binding("Value.Values");
this.Resources.Add(FieldPropertyInfo.GetType(), fieldPropertyTemplate); 
```

您的代码不起作用的原因是您*实际上并没有设置 binding*。您需要使用您希望绑定绑定到的属性调用 SetBinding。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T18:03:13.417

使用您希望模板应用的类型作为键：

```
this.Resources.Add(FieldPropertyInfo.GetType(), fieldPropertyTemplate); 
```

与上面的模板一样，您提供了一个类型。您必须提供名称或类型。

# tfs - Team Foundation Server 中的汇总任务

> ID：141019
> 
> 赞同：0
> 
> 时间：2008-09-26T18:03:16.070
> 
> 标签：tfs, project-management

我们正在使用 TFS 2008 进行项目管理，我正在寻找一种方法来在 tfs 中将较小的任务汇总为较大的任务。我们的工作流程是这样的：

1.  我创建了一个新的大型工作项，例如“实施网页 X”并将其分配给我的开发人员（我们称他为 Brad）
2.  布拉德接到任务。现在他以前从未设计过“网页 X”，也不知道整个事情需要多长时间才能实现。然而，他过去也做过类似的页面......所以布拉德接受了大任务并将其分成四到五个他可以估计的小任务。
3.  Brad 完成了他的五项新任务，并估算了每项任务需要多长时间。甚至其中一些任务比 8 小时的工作还要长，所以他继续将任务分解成足够小的部分，他相信他可以准确地估算出实施新网页需要多长时间。
4.  Brad 现在有一个很棒的任务列表，其中包含每项任务需要多长时间的实际估计。我可以使用这些数据并计算出实现这个新页面需要多长时间。

在经历了所有这些之后，我们失去了整体的“主要任务”。我正在寻找一个工作流，它可以让 Brad 和我自己轻松引用主任务，并传达所有这些子任务都属于更大的主任务。

关于如何实现这样的工作流程的任何想法，或者关于如何处理 tfs 中的任务汇总的更好建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T18:08:07.027

TFS 中还没有这样的支持。然而，在 rosario 中可以做这样的事情，因为它支持嵌套任务，就像树结构一样。

您可以利用 TFS 中的迭代和区域来满足这种需求。

使用这些链接作为灵感：

[http://blogs.msdn.com/ericlee/archive/2006/08/09/when-to-use-team-projects.aspx](http://blogs.msdn.com/ericlee/archive/2006/08/09/when-to-use-team-projects.aspx) [http://blogs.msdn.com/slange/archive/2007/01/30 /my-2-cents-on-areas-and-iterations-in-team-foundation-server.aspx](http://blogs.msdn.com/slange/archive/2007/01/30/my-2-cents-on-areas-and-iterations-in-team-foundation-server.aspx)

# c# - 什么是用于在 Delphi 和/或 C# 中录制/捕获和播放声音的好 API？

> ID：141023
> 
> 赞同：3
> 
> 时间：2008-09-26T18:04:26.333
> 
> 标签：c#, delphi, desktop-application

*<flavor> 我想为我的小学生创建一个拼写测试程序，让他们输入并记录他们的拼写单词，然后在整个星期内对其进行测试。</flavor>*

什么是一个好的 Delphi API，我可以使用它选择录音设备，捕获并保存声音文件，然后播放它们？

我也在玩弄在 C# 中做同样的项目，所以 C# Sound capture/playback API 建议也将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T18:07:55.857

我发现[New Audio Components](http://symmetrica.net/newac/)非常适合 Delphi。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T18:10:46.160

录制的替代方法是使用带有 C# 的 MS Speech API，通过键盘输入单词，并让它说明键入的内容。

只是一个想法......祝你的应用程序好运 - 这听起来像是一个非常酷的程序！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T18:13:24.470

这个组件集看起来很有希望，尽管我自己从未使用过它。[AudioLab 3.1](http://www.mitov.com/html/audiolab.html)具有 VCL 组件和 .NET 2.0 组件，无论您是继续在 Delphi 中开发应用程序还是迁移到 C#，都应该允许您使用它。最后，它似乎可以免费用于非商业用途。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:07:03.330

寻找 Delphi 组件的最佳地点

（音频） [http://www.torry.net/pages.php?id=167](http://www.torry.net/pages.php?id=167)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T00:09:39.090

为什么不使用 Delphi 附带的 TMediaPlayer（在 Palette 的 System 选项卡中）？
它可以非常轻松地录制和播放波形文件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-27T01:45:44.710

我也打算推荐[AudioLab](http://www.mitov.com/html/audiolab.html)。

# flash - ActionScript3 用户界面组件？

> ID：141024
> 
> 赞同：8
> 
> 时间：2008-09-26T18:04:30.327
> 
> 标签：flash, actionscript-3, user-interface, components

使用 AS2 几年后，我开始使用 AS3 (Flash9/Flash10) 编写应用程序。我已经到了需要一些完整的 GUI 组件集的地步，我需要决定要使用哪个集。回到 AS2 时代，flash 包含的内置组件非常糟糕——文件大小臃肿、速度慢、有问题等。但是，我听说新组件（包含在 CS3 中）的好消息。所以我正在寻找使用过几种不同套装的人的建议。

我听说过的组件集：

1.  **CS3 组件**- 缺点，我需要摆弄 CS3 IDE，我宁愿只从 FlashDevelop 中工作。
2.  **Flex 组件**- 缺点，我需要 Flex 框架，这意味着我必须从 MXML 文件开始，加上框架的膨胀
3.  **bit101 的[MinimalComps](http://code.google.com/p/minimalcomps/)** - 这些看起来可能是一个很好的起点，虽然有点有限
4.  **[ASwing A3](http://www.aswing.org/)** - 这些看起来很有趣，但它们似乎有点过度设计。

理想情况下，它们应该是轻量级的，有一个不错的 API，而且不会过于复杂。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T15:43:07.940

我实际上是 CS3 的粉丝，主要是因为双击那些坏男孩并使用绘图工具在 Flash IDE 中直接编辑非常容易。对于那些必须快速将蒙皮视频播放器投入生产的时候非常有帮助......

在开源方面，这里还有 Thimbault Imbert 的 Liquid Components ( [http://www.bytearray.org/?p=137](http://www.bytearray.org/?p=137) ) 演示 ( [http://www.bytearray.org/?p=109](http://www.bytearray.org/?p=109) )...

它非常棒，并且运行时蒙皮，这在我正在从事的项目中节省了大量时间。也很容易上手...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-27T02:35:27.650

雅虎的 Astra 组件也不错：http: [//developer.yahoo.com/flash/astra-flash/](http://developer.yahoo.com/flash/astra-flash/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T18:14:15.327

如果您正在制作一个 GUI 应用程序，这正是 Flex 的用途。除了内置类型之外，您还可以获得一个非常棒的可视化编辑器、酷炫的绑定功能以及其他类似内置拖放功能的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:15:52.280

Flex 框架有一个很好的、一致的 API，我不会认为它“臃肿”——是的，它是一个功能丰富的 UI 框架，但按钮和布局面板等基本功能不需要任何深入的知识。并且基于 XML 的 UI 语言是一种祝福（所有现代 UI 平台都这样做，无论是 DHTML、Flex 还是 WPF/Silverlight）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T18:16:20.000

与 Cs3 一起去 - 我认为是由 Grant Skinner 创建的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-01T10:17:29.630

试用[AS DataProvider 控件](http://sibirjak.com/osflash/projects/as-dataprovider-controls/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-03T06:51:52.693

[MyLib](http://mylib.samystudio.net/?page_id=30)是另一个不错的 AS 组件库

# silverlight - Silverlight 2 中的 System.Net.HttpWebRequest 是否缺少 SendChunked 属性？

> ID：141031
> 
> 赞同：0
> 
> 时间：2008-09-26T18:05:34.300
> 
> 标签：silverlight

我需要从 silverlight 2 beta 2 发送大文件，所以我需要将 sendchuncked 属性设置为 true，但该属性似乎不存在。我在 Internet 上看到其他帖子，人们可以在 Silverlight 中进行设置。

我在反射器中的 C:\Program Files\Microsoft SDKs\Silverlight\v2.0\Reference Assemblies 中取消了 .dll，并确认该属性不存在。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T03:33:00.927

经过更多的研究，我正在查看 ASP.NET 的文档。您需要连接自己的文件上传分块机制。请参阅 Tim Heuer关于此主题的[精彩视频](http://timheuer.com/blog/archive/2008/07/10/embed-fonts-and-file-upload-in-silverlight-2.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T19:17:10.777

你能提供这些帖子的链接吗？也许他们指的是不同的 Silverlight，有些东西已从 S2B2 中删除。

# c# - 如何替换 .NET 中字符串的*第一个实例*？

> ID：141045
> 
> 赞同：116
> 
> 时间：2008-09-26T18:10:22.543
> 
> 标签：c#, .net, regex, string, replace

我想替换给定字符串中的第一次出现。

如何在 .NET 中完成此任务？

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2008-09-26T18:17:06.503

```
string ReplaceFirst(string text, string search, string replace)
{
  int pos = text.IndexOf(search);
  if (pos < 0)
  {
    return text;
  }
  return text.Substring(0, pos) + replace + text.Substring(pos + search.Length);
} 
```

例子：

```
string str = "The brown brown fox jumps over the lazy dog";

str = ReplaceFirst(str, "brown", "quick"); 
```

**编辑**：正如@itsmatt[提到](https://stackoverflow.com/questions/141045/how-do-i-replace-a-string-in-net#141062)的，还有Regex.Replace(String, String, Int32)，它可以做同样的事情，但在运行时可能更昂贵，因为它使用了一个功能齐全的解析器，我的方法在其中一个查找和三个字符串串联。

**EDIT2**：如果这是一项常见任务，您可能希望将该方法设为扩展方法：

```
public static class StringExtension
{
  public static string ReplaceFirst(this string text, string search, string replace)
  {
     // ...same as above...
  }
} 
```

使用上面的示例，现在可以编写：

```
str = str.ReplaceFirst("brown", "quick"); 
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-09-28T21:11:49.890

正如*其马特*所说， [Regex.Replace](http://msdn.microsoft.com/en-us/library/haekbhys.aspx)是一个不错的选择，但是为了使他的答案更完整，我将用代码示例填充它：

```
using System.Text.RegularExpressions;
...
Regex regex = new Regex("foo");
string result = regex.Replace("foo1 foo2 foo3 foo4", "bar", 1);             
// result = "bar1 foo2 foo3 foo4" 
```

第三个参数，在这种情况下设置为 1，是要在输入字符串中从字符串开头替换的正则表达式模式的出现次数。

我希望这可以通过静态[Regex.Replace](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.replace.aspx)重载来完成，但不幸的是，您似乎需要一个 Regex 实例来完成它。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-26T18:13:34.250

看看[Regex.Replace](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.replace.aspx)。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-06-10T07:21:19.370

```
using System.Text.RegularExpressions;

RegEx MyRegEx = new RegEx("F");
string result = MyRegex.Replace(InputString, "R", 1); 
```

将首先找到`F`并将`InputString`其替换为`R`.

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2010-11-03T12:00:11.007

考虑到“唯一”，也许：

```
int index = input.IndexOf("AA");
if (index >= 0) output = input.Substring(0, index) + "XQ" +
     input.Substring(index + 2); 
```

?

或更一般地说：

```
public static string ReplaceFirstInstance(this string source,
    string find, string replace)
{
    int index = source.IndexOf(find);
    return index < 0 ? source : source.Substring(0, index) + replace +
         source.Substring(index + find.Length);
} 
```

然后：

```
string output = input.ReplaceFirstInstance("AA", "XQ"); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-26T18:20:09.993

在 C# 语法中：

```
int loc = original.IndexOf(oldValue);
if( loc < 0 ) {
    return original;
}
return original.Remove(loc, oldValue.Length).Insert(loc, newValue); 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-26T18:22:19.177

将执行此操作的 C# 扩展方法：

```
public static class StringExt
{
    public static string ReplaceFirstOccurrence(this string s, string oldValue, string newValue)
    {
         int i = s.IndexOf(oldValue);
         return s.Remove(i, oldValue.Length).Insert(i, newValue);    
    } 
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-11-03T12:00:35.303

假设`AA`仅当它位于字符串的开头时才需要替换：

```
var newString;
if(myString.StartsWith("AA"))
{
  newString ="XQ" + myString.Substring(2);
} 
```

如果您需要替换第一次出现的`AA`，无论字符串是否以它开头，请使用 Marc 的解决方案。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T18:42:35.007

而且因为还需要考虑 VB.NET，所以我想提供：

```
Private Function ReplaceFirst(ByVal text As String, ByVal search As String, ByVal replace As String) As String
    Dim pos As Integer = text.IndexOf(search)
    If pos >= 0 Then
        Return text.Substring(0, pos) + replace + text.Substring(pos + search.Length)
    End If
    Return text 
End Function 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-11-03T12:12:04.783

的重载之一`Regex.Replace`是`int`“可以发生替换的最大次数”。显然，使用`Regex.Replace`纯文本替换可能看起来有点矫枉过正，但它肯定很简洁：

```
string output = (new Regex("AA")).Replace(input, "XQ", 1); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-03-01T13:36:52.360

对于不介意参考的任何人`Microsoft.VisualBasic`，都有[`Replace`Method](https://msdn.microsoft.com/en-us/library/microsoft.visualbasic.strings.replace)：

```
string result = Microsoft.VisualBasic.Strings.Replace("111", "1", "0", 2, 1); // "101" 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-05-23T21:52:31.127

此示例抽象出子字符串（但速度较慢），但可能比 RegEx 快得多：

```
var parts = contents.ToString().Split(new string[] { "needle" }, 2, StringSplitOptions.None);
return parts[0] + "replacement" + parts[1]; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-08-17T20:09:47.250

更新的扩展方法利用`Span`以最小化新字符串的创建

```
 public static string ReplaceFirstOccurrence(this string source, string search, string replace) {
        int index = source.IndexOf(search);
        if (index < 0) return source;
        var sourceSpan = source.AsSpan();
        return string.Concat(sourceSpan.Slice(0, index), replace, sourceSpan.Slice(index + search.Length));
    } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2010-11-03T12:04:59.057

```
string abc = "AAAAX1";

            if(abc.IndexOf("AA") == 0)
            {
                abc.Remove(0, 2);
                abc = "XQ" + abc;
            } 
```

# command-line - MS Paint 命令行开关

> ID：141052
> 
> 赞同：9
> 
> 时间：2008-09-26T18:11:40.933
> 
> 标签：command-line, file-conversion

我一直在寻找与从命令行与 MSPaint 交互相关的文档。我只找到了对 /p、/pt 和 /wia 的引用，但没有关于如何使用它们及其限制的指导。

我正在尝试将一些图形文件发送到打印机，当我将文件放到打印机驱动程序上时，我得到的打印输出与从命令行调用paint不同。我正在使用 UDC 打印驱动程序来转换图形，并且我正在使用绘画将我的图形文件发送到打印机驱动程序以便我的文件进行转换。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T18:16:10.203

我实际上建议您考虑在[Paint.Net](http://getpaint.net/)中执行此操作。你会有更多的自由。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T18:18:19.717

我建议[ImageMagick 放下手](http://www.imagemagick.org/script/index.php)……这就像在命令行上使用 Photoshop！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T18:19:58.247

我知道，`mspaint /p filename`两者`mspaint /pt filename`都直接打印到默认打印机。不确定是什么`/wia`，也许与 Windows 图像采集有关？

此外，正如其他人指出的那样，有许多程序比 MSPaint 更能满足您的需求。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-26T18:33:35.107

您使用的是什么操作系统（特定版本）？较新版本的 Windows 支持打印图形文件，无需 MS Paint 或任何其他图形程序。它在 XP 中称为“照片打印向导”，您甚至可以右键单击图形文件并从资源管理器中选择“打印”——无需其他程序（也无需命令行开关）。

如果您要做的只是将一些图形文件发送到打印机，并且您可以拖放它们，那么这就是我建议使用的。

# .net - Crystal Report 10.5 [包含在 Visual Studio 2008 中] 按图像选择列

> ID：141068
> 
> 赞同：0
> 
> 时间：2008-09-26T18:14:53.703
> 
> 标签：.net, visual-studio-2008, crystal-reports

我在 SQL Server 2005 中有一个图像列（允许 Null = true）。我正在使用 Visual Studio 2008 附带的 Crystal Reports 设计器（10.5 版）。Crystal 将该列视为 blob 字段并为该列放置一个图像对象。当我试图通过使用限制记录选择时

```
 NOT ISNULL({Employee.Picture}) 
```

作为选择公式，我收到以下错误：

> 公式错误。
> 'NOT (ISNULL({Employee.Picture}))'
> 此函数不能使用，因为它必须在以后评估。

有没有办法过滤掉没有图片的行？

谢谢，
Kishore A

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T09:31:23.813

该`ISNULL`函数更像是`SWITCH`VB中的函数。您正在寻找的可能更像是：

```
WHERE NOT Employee.Picture IS NULL 
```

的两个单独的词`IS NULL`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T18:36:55.473

由于没有人参与其中，我会尝试（注意：我目前无法测试这些可能性）。

*   如果您可以使用公式编辑器从字段中获取大小，请尝试大于 0 或其他大小的大小。

*   如果您在报告中拉出该字段，它会显示图片吗？

*   如果您查看数据库，空字段实际上是否为空，或者 CR 是否会将它们读取为“0”？

# c# - 如何遍历字典？

> ID：141088
> 
> 赞同：2981
> 
> 时间：2008-09-26T18:20:06.357
> 
> 标签：c#, dictionary, loops

我已经看到了几种在 C# 中迭代​​字典的不同方法。有标准方法吗？

* * *

## 回答 #1

> 赞同：4204
> 
> 时间：2008-09-26T18:22:10.423

```
foreach(KeyValuePair<string, string> entry in myDictionary)
{
    // do something with entry.Value or entry.Key
} 
```

* * *

## 回答 #2

> 赞同：1004
> 
> 时间：2008-09-26T18:22:42.873

如果您尝试在 C# 中使用通用字典，就像在另一种语言中使用关联数组一样：

```
foreach(var item in myDictionary)
{
  foo(item.Key);
  bar(item.Value);
} 
```

或者，如果您只需要遍历键集合，请使用

```
foreach(var item in myDictionary.Keys)
{
  foo(item);
} 
```

最后，如果您只对这些值感兴趣：

```
foreach(var item in myDictionary.Values)
{
  foo(item);
} 
```

（请注意，`var`关键字是可选的 C# 3.0 及更高版本功能，您也可以在此处使用您的键/值的确切类型）

* * *

## 回答 #3

> 赞同：180
> 
> 时间：2011-03-10T20:44:43.237

在某些情况下，您可能需要一个可能由 for 循环实现提供的计数器。为此，LINQ 提供[`ElementAt`](https://msdn.microsoft.com/en-us/library/bb299233(v=vs.110).aspx)了以下功能：

```
for (int index = 0; index < dictionary.Count; index++) {
  var item = dictionary.ElementAt(index);
  var itemKey = item.Key;
  var itemValue = item.Value;
} 
```

* * *

## 回答 #4

> 赞同：112
> 
> 时间：2008-09-26T18:27:49.023

取决于您是追求键还是值...

从 MSDN[`Dictionary(TKey, TValue)`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)类描述：

```
// When you use foreach to enumerate dictionary elements,
// the elements are retrieved as KeyValuePair objects.
Console.WriteLine();
foreach( KeyValuePair<string, string> kvp in openWith )
{
    Console.WriteLine("Key = {0}, Value = {1}", 
        kvp.Key, kvp.Value);
}

// To get the values alone, use the Values property.
Dictionary<string, string>.ValueCollection valueColl =
    openWith.Values;

// The elements of the ValueCollection are strongly typed
// with the type that was specified for dictionary values.
Console.WriteLine();
foreach( string s in valueColl )
{
    Console.WriteLine("Value = {0}", s);
}

// To get the keys alone, use the Keys property.
Dictionary<string, string>.KeyCollection keyColl =
    openWith.Keys;

// The elements of the KeyCollection are strongly typed
// with the type that was specified for dictionary keys.
Console.WriteLine();
foreach( string s in keyColl )
{
    Console.WriteLine("Key = {0}", s);
} 
```

* * *

## 回答 #5

> 赞同：91
> 
> 时间：2015-08-10T11:15:17.733

一般来说，在没有特定上下文的情况下询问“最好的方式”就像问 *什么是最好的颜色*？

一方面，有很多颜色，没有最好的颜色。这取决于需要，通常也取决于口味。

另一方面，有很多方法可以在 C# 中迭代​​字典，并且没有最好的方法。这取决于需要，通常也取决于口味。

# 最直接的方法

```
foreach (var kvp in items)
{
    // key is kvp.Key
    doStuff(kvp.Value)
} 
```

如果您只需要值（允许调用它`item`，比 更具可读性`kvp.Value`）。

```
foreach (var item in items.Values)
{
    doStuff(item)
} 
```

# 如果您需要特定的排序顺序

一般来说，初学者对字典的枚举顺序感到惊讶。

LINQ 提供了一种简洁的语法，允许指定顺序（以及许多其他内容），例如：

```
foreach (var kvp in items.OrderBy(kvp => kvp.Key))
{
    // key is kvp.Key
    doStuff(kvp.Value)
} 
```

同样，您可能只需要该值。LINQ 还提供了一个简洁的解决方案：

*   直接在值上迭代（允许调用它`item`，比 更具可读性`kvp.Value`）
*   但按键排序

这里是：

```
foreach (var item in items.OrderBy(kvp => kvp.Key).Select(kvp => kvp.Value))
{
    doStuff(item)
} 
```

您可以从这些示例中做更多的实际用例。如果您不需要特定的顺序，只需坚持“最直接的方式”（见上文）！

* * *

## 回答 #6

> 赞同：62
> 
> 时间：2008-09-26T18:22:25.277

我想说`foreach`的是标准方式，尽管它显然取决于你在寻找什么

```
foreach(var kvp in my_dictionary) {
  ...
} 
```

那是你要找的吗？

* * *

## 回答 #7

> 赞同：62
> 
> 时间：2019-01-07T20:30:48.530

[*C# 7.0*引入了**Deconstructors**](https://msdn.microsoft.com/en-us/magazine/mt790184.aspx)，如果您使用的是*.NET Core 2.0+*应用程序，该结构`KeyValuePair<>`已经`Deconstruct()`为您包含了一个。所以你可以这样做：

```
var dic = new Dictionary<int, string>() { { 1, "One" }, { 2, "Two" }, { 3, "Three" } };
foreach (var (key, value) in dic) {
    Console.WriteLine($"Item [{key}] = {value}");
}
//Or
foreach (var (_, value) in dic) {
    Console.WriteLine($"Item [NO_ID] = {value}");
}
//Or
foreach ((int key, string value) in dic) {
    Console.WriteLine($"Item [{key}] = {value}");
} 
```

[![在此处输入图像描述](https://i.stack.imgur.com/OdW3m.png)](https://i.stack.imgur.com/OdW3m.png)

* * *

## 回答 #8

> 赞同：47
> 
> 时间：2015-06-11T13:32:27.487

您也可以在用于多线程处理的大字典上尝试此操作。

```
dictionary
.AsParallel()
.ForAll(pair => 
{ 
    // Process pair.Key and pair.Value here
}); 
```

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2014-07-30T10:54:42.790

我很欣赏这个问题已经有很多回应，但我想进行一些研究。

与迭代数组之类的东西相比，迭代字典可能会相当慢。在我的测试中，对数组的迭代耗时 0.015003 秒，而对字典（具有相同数量的元素）的迭代耗时 0.0365073 秒，是 2.4 倍！虽然我看到了更大的差异。为了比较，列表介于 0.00215043 秒之间。

然而，这就像比较苹果和橘子。我的观点是迭代字典很慢。

字典针对查找进行了优化，因此考虑到这一点，我创建了两种方法。一个简单地做一个 foreach，另一个迭代键然后查找。

```
public static string Normal(Dictionary<string, string> dictionary)
{
    string value;
    int count = 0;
    foreach (var kvp in dictionary)
    {
        value = kvp.Value;
        count++;
    }

    return "Normal";
} 
```

这个加载键并对其进行迭代（我也尝试将键拉入字符串 [] 但差异可以忽略不计。

```
public static string Keys(Dictionary<string, string> dictionary)
{
    string value;
    int count = 0;
    foreach (var key in dictionary.Keys)
    {
        value = dictionary[key];
        count++;
    }

    return "Keys";
} 
```

在这个例子中，正常的 foreach 测试需要 0.0310062，而密钥版本需要 0.2205441。加载所有键并遍历所有查找显然要慢很多！

对于最终测试，我已经执行了十次迭代，看看在此处使用密钥是否有任何好处（此时我只是好奇）：

这是 RunTest 方法，如果它可以帮助您可视化正在发生的事情。

```
private static string RunTest<T>(T dictionary, Func<T, string> function)
{            
    DateTime start = DateTime.Now;
    string name = null;
    for (int i = 0; i < 10; i++)
    {
        name = function(dictionary);
    }
    DateTime end = DateTime.Now;
    var duration = end.Subtract(start);
    return string.Format("{0} took {1} seconds", name, duration.TotalSeconds);
} 
```

在这里，正常的 foreach 运行耗时 0.2820564 秒（大约是单次迭代耗时的十倍——如您所料）。对键的迭代花费了 2.2249449 秒。

**编辑添加：** 阅读其他一些答案让我质疑如果我使用 Dictionary 而不是 Dictionary 会发生什么。在这个例子中，数组耗时 0.0120024 秒，列表耗时 0.0185037 秒，字典耗时 0.0465093 秒。可以合理地预期数据类型会影响字典的速度。

**我的结论是**什么？

*   如果可以，请避免迭代字典，它们比迭代具有相同数据的数组要慢得多。
*   如果您确实选择遍历字典，请不要太聪明，尽管速度较慢，但​​您可能会比使用标准 foreach 方法做得更糟。

* * *

## 回答 #10

> 赞同：30
> 
> 时间：2008-09-26T18:22:47.130

有很多选择。我个人最喜欢的是 KeyValuePair

```
Dictionary<string, object> myDictionary = new Dictionary<string, object>();
// Populate your dictionary here

foreach (KeyValuePair<string,object> kvp in myDictionary)
{
     // Do some interesting things
} 
```

您还可以使用键和值集合

* * *

## 回答 #11

> 赞同：28
> 
> 时间：2020-06-05T01:51:55.000

[正如已在此答案](https://stackoverflow.com/a/55392400/3059191)中指出的那样，`KeyValuePair<TKey, TValue>`实现了[`Deconstruct`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.keyvaluepair-2.deconstruct?view=netcore-2.0)从 .NET Core 2.0、.NET Standard 2.1 和 .NET Framework 5.0（预览版）开始的方法。

`KeyValuePair`有了这个，就可以以不可知的方式遍历字典：

```
var dictionary = new Dictionary<int, string>();

// ...

foreach (var (key, value) in dictionary)
{
    // ...
} 
```

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2017-10-17T15:18:55.273

用`.NET Framework 4.7`一个可以用*分解*

```
var fruits = new Dictionary<string, int>();
...
foreach (var (fruit, number) in fruits)
{
    Console.WriteLine(fruit + ": " + number);
} 
```

要使此代码在较低的 C# 版本上工作，请在`System.ValueTuple NuGet package`某处添加和编写

```
public static class MyExtensions
{
    public static void Deconstruct<T1, T2>(this KeyValuePair<T1, T2> tuple,
        out T1 key, out T2 value)
    {
        key = tuple.Key;
        value = tuple.Value;
    }
} 
```

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2019-11-26T14:56:43.307

`foreach`是最快的，如果你只迭代`___.Values`，它也更快

[![在此处输入图像描述](https://i.stack.imgur.com/Nr35i.png)](https://i.stack.imgur.com/Nr35i.png)

* * *

## 回答 #14

> 赞同：15
> 
> 时间：2018-07-11T18:05:23.743

从 C# 7 开始，您可以将对象解构为变量。我相信这是迭代字典的最佳方式。

**例子：**

创建一个`KeyValuePair<TKey, TVal>`解构它的扩展方法：

```
public static void Deconstruct<TKey, TVal>(this KeyValuePair<TKey, TVal> pair, out TKey key, out TVal value)
{
   key = pair.Key;
   value = pair.Value;
} 
```

`Dictionary<TKey, TVal>`以下列方式迭代任何

```
// Dictionary can be of any types, just using 'int' and 'string' as examples.
Dictionary<int, string> dict = new Dictionary<int, string>();

// Deconstructor gets called here.
foreach (var (key, value) in dict)
{
   Console.WriteLine($"{key} : {value}");
} 
```

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2009-10-28T20:49:36.530

您建议在下面进行迭代

```
Dictionary<string,object> myDictionary = new Dictionary<string,object>();
//Populate your dictionary here

foreach (KeyValuePair<string,object> kvp in myDictionary) {
    //Do some interesting things;
} 
```

仅供参考，`foreach`如果值是对象类型，则不起作用。

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2016-10-02T04:00:41.890

迭代字典的最简单形式：

```
foreach(var item in myDictionary)
{ 
    Console.WriteLine(item.Key);
    Console.WriteLine(item.Value);
} 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2018-05-27T12:25:49.350

使用**C# 7**将此**扩展方法**添加到解决方案的任何项目中：

```
public static class IDictionaryExtensions
{
    public static IEnumerable<(TKey, TValue)> Tuples<TKey, TValue>(
        this IDictionary<TKey, TValue> dict)
    {
        foreach (KeyValuePair<TKey, TValue> kvp in dict)
            yield return (kvp.Key, kvp.Value);
    }
} 
```

并使用这个简单的语法

```
foreach (var(id, value) in dict.Tuples())
{
    // your code using 'id' and 'value'
} 
```

或者这个，如果你喜欢

```
foreach ((string id, object value) in dict.Tuples())
{
    // your code using 'id' and 'value'
} 
```

代替传统的

```
foreach (KeyValuePair<string, object> kvp in dict)
{
    string id = kvp.Key;
    object value = kvp.Value;

    // your code using 'id' and 'value'
} 
```

扩展方法将`KeyValuePair`of your`IDictionary<TKey, TValue>`转换为强类型`tuple`，允许您使用这种新的舒适语法。

它将所需的字典条目转换为`tuples`，因此它不会将整个字典转换为`tuples`，因此不存在与此相关的性能问题。

`tuple`与直接使用相比，调用扩展方法来创建 a 的成本很小，如果您要分配的属性和新的循环变量`KeyValuePair`，这应该不是问题。`KeyValuePair``Key``Value`

在实践中，这种新语法非常适合大多数情况，除了低级超高性能场景，您仍然可以选择在特定位置不使用它。

看看这个：[MSDN 博客 - C# 7 中的新功能](https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/)

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2019-06-14T15:14:04.510

我知道这是一个非常古老的问题，但我创建了一些可能有用的扩展方法：

```
 public static void ForEach<T, U>(this Dictionary<T, U> d, Action<KeyValuePair<T, U>> a)
    {
        foreach (KeyValuePair<T, U> p in d) { a(p); }
    }

    public static void ForEach<T, U>(this Dictionary<T, U>.KeyCollection k, Action<T> a)
    {
        foreach (T t in k) { a(t); }
    }

    public static void ForEach<T, U>(this Dictionary<T, U>.ValueCollection v, Action<U> a)
    {
        foreach (U u in v) { a(u); }
    } 
```

这样我就可以编写如下代码：

```
myDictionary.ForEach(pair => Console.Write($"key: {pair.Key}, value: {pair.Value}"));
myDictionary.Keys.ForEach(key => Console.Write(key););
myDictionary.Values.ForEach(value => Console.Write(value);); 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2009-02-17T23:51:39.733

我在 MSDN 上 DictionaryBase 类的文档中找到了这个方法：

```
foreach (DictionaryEntry de in myDictionary)
{
     //Do some stuff with de.Value or de.Key
}
```

这是我唯一能够在从 DictionaryBase 继承的类中正常运行的功能。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2014-07-02T01:55:08.463

有时，如果您只需要枚举值，请使用字典的值集合：

```
foreach(var value in dictionary.Values)
{
    // do something with entry.Value only
} 
```

这篇文章报告说这是最快的方法： [http ://alexpinsker.blogspot.hk/2010/02/c-fastest-way-to-iterate-over.html](http://alexpinsker.blogspot.hk/2010/02/c-fastest-way-to-iterate-over.html)

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2020-05-14T12:52:33.647

如果你想使用 for 循环，你可以这样做：

```
var keyList=new List<string>(dictionary.Keys);
for (int i = 0; i < keyList.Count; i++)
{
   var key= keyList[i];
   var value = dictionary[key];
 } 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-10-01T23:17:52.443

我将利用 .NET 4.0+ 并为最初接受的答案提供更新的答案：

```
foreach(var entry in MyDic)
{
    // do something with entry.Value or entry.Key
} 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2016-07-28T10:58:55.327

根据 MSDN 上的官方文档，迭代字典的标准方法是：

```
foreach (DictionaryEntry entry in myDictionary)
{
     //Read entry.Key and entry.Value here
} 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-06-08T07:07:02.110

我写了一个扩展来遍历字典。

```
public static class DictionaryExtension
{
    public static void ForEach<T1, T2>(this Dictionary<T1, T2> dictionary, Action<T1, T2> action) {
        foreach(KeyValuePair<T1, T2> keyValue in dictionary) {
            action(keyValue.Key, keyValue.Value);
        }
    }
} 
```

然后你可以打电话

```
myDictionary.ForEach((x,y) => Console.WriteLine(x + " - " + y)); 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-12-09T04:16:11.013

如果说，你想默认迭代values集合，我相信你可以实现IEnumerable<>，其中T是字典中values对象的类型，“this”是字典。

```
public new IEnumerator<T> GetEnumerator()
{
   return this.Values.GetEnumerator();
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2022-02-08T05:37:20.997

有几种方法可以在 C# 中迭代​​字典，但我发现最好和最简单的方法是使用***foreach***。

```
foreach(KeyValuePair<string, string> entry in mDictionary)
{
    // Your coding for Value & Key ...
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-05-28T15:00:10.157

```
var dictionary = new Dictionary<string, int>
{
    { "Key", 12 }
};

var aggregateObjectCollection = dictionary.Select(
    entry => new AggregateObject(entry.Key, entry.Value)); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-04-16T11:25:37.177

**Dictionary< TKey, TValue >**是c#中的一个通用集合类，它以键值格式存储数据。key必须唯一且不能为null，而value可以重复且为null。因为字典中的每一项都是视为 KeyValuePair< TKey, TValue > 结构，表示一个键及其值。因此我们应该在元素的迭代过程中采用元素类型 KeyValuePair<TKey, TValue>。**下面是示例。**

```
Dictionary<int, string> dict = new Dictionary<int, string>();
dict.Add(1,"One");
dict.Add(2,"Two");
dict.Add(3,"Three");

foreach (KeyValuePair<int, string> item in dict)
{
    Console.WriteLine("Key: {0}, Value: {1}", item.Key, item.Value);
} 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2016-09-16T16:03:08.327

只是想加我的 2 美分，因为大多数答案与 foreach 循环有关。请看下面的代码：

```
Dictionary<String, Double> myProductPrices = new Dictionary<String, Double>();

//Add some entries to the dictionary

myProductPrices.ToList().ForEach(kvP => 
{
    kvP.Value *= 1.15;
    Console.Writeline(String.Format("Product '{0}' has a new price: {1} $", kvp.Key, kvP.Value));
}); 
```

尽管这增加了对“.ToList()”的额外调用，但可能会有轻微的性能改进（如此处指出的[foreach vs someList.Foreach(){}](https://stackoverflow.com/questions/225937/foreach-vs-somelist-foreach)），尤其是在使用大型字典和并行运行时不会选项 / 根本没有效果。

另外，请注意，您将无法为 foreach 循环内的“值”属性分配值。另一方面，您也可以操纵“密钥”，可能会在运行时给您带来麻烦。

当您只想“读取”键和值时，您还可以使用 IEnumerable.Select()。

```
var newProductPrices = myProductPrices.Select(kvp => new { Name = kvp.Key, Price = kvp.Value * 1.15 } ); 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2021-01-22T15:56:51.040

最好的答案当然是：**想一想，如果您打算迭代它，是否可以使用比字典更合适的数据结构**- 正如 Vikas Gupta 在问题下的讨论（开始）中已经提到的那样。但是，作为整个线程的讨论仍然缺乏令人惊讶的好选择。一种是：

```
SortedList<string, string> x = new SortedList<string, string>();

x.Add("key1", "value1");
x.Add("key2", "value2");
x["key3"] = "value3";
foreach( KeyValuePair<string, string> kvPair in x )
            Console.WriteLine($"{kvPair.Key}, {kvPair.Value}"); 
```

为什么可以争论迭代字典的代码味道（例如通过 foreach(KeyValuePair<,>) ？

Clean Coding 的一个基本原则：“**表达意图！** ” Robert C. Martin 在“Clean Code”中写道：“选择显示意图的名称”。显然，仅命名太弱了。“**表达（揭示）每个编码决策的意图”**更好地表达了它。

一个相关的原则是“[最不意外](http://principles-wiki.net/principles:principle_of_least_surprise)原则”（=[最小惊讶原则](https://en.wikipedia.org/wiki/Principle_of_least_astonishment)）。

为什么这与迭代字典有关？**选择字典表达了选择数据结构的意图，该数据结构主要用于通过 key 查找数据**。如今，.NET 中有很多替代方案，如果您想遍历键/值对，您可以选择其他东西。

此外：如果您对某些内容进行迭代，则必须揭示有关（将要）如何订购和预期如何订购这些项目的信息！尽管 Dictionary 的已知实现按照添加的项目的顺序对键集合进行排序 - AFAIK，但 Dictionary 没有关于排序的保证规范（有吗？）。

但是有什么替代方案？

TLDR：
**SortedList**：如果您的集合没有变得太大，一个简单的解决方案是使用 SortedList<,> 它还可以为您提供键/值对的完整索引。

微软有一篇很长的文章提到和解释拟合集合：
[Keyed collection](https://docs.microsoft.com/en-us/dotnet/api/system.collections.objectmodel.keyedcollection-2?view=net-5.0%20AA)

提一下最重要的：**KeyedCollection** <,> 和 SortedDictionary<,> 。 **SortedDictionary** <,> 比 SortedList 快一点，仅当它变大时才插入，但缺少索引，并且仅当 O(log n) 插入优先于其他操作时才需要。如果您确实需要 O(1) 来插入并接受较慢的迭代作为交换，您必须使用简单的 Dictionary<,>。显然，对于所有可能的操作，没有最快的数据结构。

此外还有**ImmutableSortedDictionary** <,>。

如果一个数据结构不是您所需要的，那么从 Dictionary<,> 甚至新的**ConcurrentDictionary** <,> 派生并添加显式迭代/排序函数！

* * *

## 回答 #31

> 赞同：-4
> 
> 时间：2018-08-19T20:50:39.683

除了在使用之间进行讨论的排名最高的帖子之外

```
foreach(KeyValuePair<string, string> entry in myDictionary)
{
    // do something with entry.Value or entry.Key
} 
```

或者

```
foreach(var entry in myDictionary)
{
    // do something with entry.Value or entry.Key
} 
```

最完整的如下，因为你可以从初始化中看到字典类型，kvp 是 KeyValuePair

```
var myDictionary = new Dictionary<string, string>(x);//fill dictionary with x

foreach(var kvp in myDictionary)//iterate over dictionary
{
    // do something with kvp.Value or kvp.Key
} 
```

# java - 在 Terracotta 中使用“脏读”安全吗？

> ID：141090
> 
> 赞同：3
> 
> 时间：2008-09-26T18:20:37.977
> 
> 标签：java, cluster-computing, terracotta

“脏读”，意思是读取一个对象的值，即使它被另一个线程写锁定，在 Terracotta 的网站上有[描述](http://www.terracotta.org/confluence/display/howto/Recipe?recipe=dirty-read)，但我听说不应该使用它们，即使你不关心这种可能性当你脏读锁定的对象时，你可能会得到旧数据。

有没有人有在 Terracotta 中使用脏读的经验，如果你不关心读取旧值的可能性，它们是否可以安全使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T22:42:48.580

脏读是脏读。Terracotta 是分布式/集群的，它只会增加读取您正在访问的共享可变状态的更旧值的可能性，而无需适当的同步。

您应该注意，在 Java 5 中的内存模型下，如果您不使用正确的同步，则不能保证您*永远读取更新的值。*兵马俑可能决定利用这种可能性。事实上，任何 JVM 都可以在闲暇时利用它。即使它可能在您的机器上运行，它也可能在其他机器上中断。它可能会因 JVM 的小更新而中断，并且可能会因不同 CPU 上的同一 JVM 的相同版本而中断。

考虑到这一点，您可以说脏读在任何 JVM 中都是不安全的……除非您不介意您永远无法读取其他线程所做的更新的可能性——这种情况不太可能发生，但它可能发生。

此外，当您实际点击指向 Terracottas wiki 的链接时，它会说该文章已被删除并且不鼓励使用该模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-27T03:58:00.633

我是一个兵马俑开发者。答案的要点正如 Christian Vest Hansen 已经指出的那样——正如 JVM 不保证在没有适当同步的情况下访问的共享对象的更新的可见性一样，Terracotta 同样不能保证对一个聚集对象。

该链接确实已被故意删除并替换为不使用此模式的警告。

# asp.net - 如何集成 ASP .Net Model View Presenter (MVP) 模式和标记为 [WebMethod] 的静态页面方法？

> ID：141104
> 
> 赞同：5
> 
> 时间：2008-09-26T18:22:39.643
> 
> 标签：asp.net, json, mvp, wcsf

在一个 asp.net 应用程序中，我想将 Webclient Software Factory (WCSF) 及其关联的 Model View Presenter 模式 (MVP) 的使用与 Page Method 结合起来，即 .aspx 视图上标有[WebMethod] 属性。

但是，aspx 页面上的静态方法似乎破坏了模型视图演示者模式，因为页面上需要一个实例方法来获得视图与之对话所需的演示者和控制器的上下文。

如何在 WCSF 中扩展 asp .net 的 MVP 模式以支持页面上的 [WebMethods]，也就是视图？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-27T01:51:26.880

我最近在做一个 MVP 模式项目并想要大量 AJAX 集成时遇到了类似的问题。您最好拥有符合您所称的 MVP 模式的 Web 服务。

请记住，PageMethod 只是在当前页面中的 Web 服务。它无法访问任何页面级对象，因此拥有它的优势很小。我实际上认为它们是不利的，它们使开发人员（不熟悉该概念）认为他们可以与页面级对象进行交互。

硬币的另一面是您的 PageMethod 正在做的事情，如果您的页面方法不需要与模型交互（例如，它正在处理在 C#/VB.NET 中比 JS 更快的复杂算术计算），那么操作是真的是 UI 级别的操作，如果您要将应用程序变成 WinForm（或其他东西），则很可能无关紧要。

请记住，在 UI 级别与数据的所有交互都是特定于该 UI 实现的。如果您要为演示者编写不同的 UI，那么您可能会有不同的 UI 级别的数据交互。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-27T01:12:58.173

我认为您可以通过使用 ASP.Net AJAX Web 服务而不是静态页面方法来接近您正在寻找的东西。Web 服务的优点是不是静态的，并且取决于您的视图是如何实现的，（我不熟悉 WCSF MVP 模式的细节）您可能会将 Web 服务设为您的“视图”层..或至少相当接近。

我在我正在做的一个项目中做过类似的事情。我最终需要创建一个精简的纯数据类，该类由 Web 服务序列化为 JSON，以将数据从模型传送到“视图”，但 Web 服务具有基本相同的方法，这些方法将作为事件公开风景。

我喜欢这种方法的一件事是，包括 Web 服务在内的所有位都是可测试的。

# php - 如何找到foreach索引？

> ID：141108
> 
> 赞同：587
> 
> 时间：2008-09-26T18:23:15.413
> 
> 标签：php, loops, foreach

是否可以找到`foreach`索引？

在一个`for`循环中如下：

```
for ($i = 0; $i < 10; ++$i) {
   echo $i . ' ';
} 
```

`$i`会给你索引。

我必须使用`for`循环还是有某种方法可以在`foreach`循环中获取索引？

* * *

## 回答 #1

> 赞同：1090
> 
> 时间：2008-09-26T18:24:33.833

```
foreach($array as $key=>$value) {
    // do stuff
} 
```

`$key`是每个`$array`元素的索引

* * *

## 回答 #2

> 赞同：194
> 
> 时间：2008-09-26T18:25:54.190

您可以在您`foreach`的`for`. 这样的字段将是需要手动管理（增量等）的伪索引。

A`foreach`将以您的价值的形式为您提供索引`$key`，因此不需要这样的黑客攻击。

例如，在一个**`foreach`**

```
$index = 0;
foreach($data as $key=>$val) {
    // Use $key as an index, or...

    // ... manage the index this way..
    echo "Index is $index\n";
    $index++;
} 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2011-03-04T11:17:22.553

应该注意的是，您可以调用[`key()`](http://www.php.net/manual/en/function.key.php)任何数组来找到当前键所在的位置。您可以猜到`current()`将返回当前值并将`next()`数组的指针移动到下一个元素。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-09-26T21:35:43.080

欧文有一个很好的答案。如果您只需要密钥，并且您正在使用数组，这也可能很有用。

```
foreach(array_keys($array) as $key) {
//  do stuff
} 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-26T18:25:29.697

您可以`$i`在循环外部创建并`$i++`在循环底部执行。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-01-27T22:43:06.903

这两个循环是等效的（当然是安全栏杆）：

```
for ($i=0; $i<count($things); $i++) { ... }

foreach ($things as $i=>$thing) { ... } 
```

例如

```
for ($i=0; $i<count($things); $i++) {
    echo "Thing ".$i." is ".$things[$i];
}

foreach ($things as $i=>$thing) {
    echo "Thing ".$i." is ".$thing;
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2016-05-12T13:59:54.563

我认为最好的选择是一样的：

```
foreach ($lists as $key=>$value) {
    echo $key+1;
} 
```

这很容易而且通常

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-28T20:43:54.667

PHP 数组有内部指针，所以试试这个：

```
foreach($array as $key => $value){
   $index = current($array);
} 
```

对我来说没问题（虽然只是经过初步测试）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-26T18:47:18.833

乔纳森是对的。PHP 数组充当映射表，将键映射到值。在某些情况下，如果定义了数组，您可以获得索引，例如

```
$var = array(2,5);

for ($i = 0; $i < count($var); $i++) {
    echo $var[$i]."\n";
} 
```

你的输出将是

```
2
5 
```

在这种情况下，数组中的每个元素都有一个已知的索引，但是如果您随后执行以下操作

```
$var = array_push($var,10);

for ($i = 0; $i < count($var); $i++) {
    echo $var[$i]."\n";
} 
```

你没有输出。发生这种情况是因为 PHP 中的数组不像大多数语言那样是线性结构。它们更像是哈希表，可能有也可能没有所有存储值的键。因此 foreach 不使用索引来爬过它们，因为如果定义了数组，它们只有一个索引。如果您需要索引，请确保您的数组在爬过它们之前已完全定义，并使用 for 循环。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2021-05-16T14:48:37.113

我使用`++$key`而不是`$key++`从 1 开始。通常它从 0 开始。

```
@foreach ($quiz->questions as $key => $question)
 <h2> Question: {{++$key}}</h2>
 <p>{{$question->question}}</p>
@endforeach 
```

输出：

```
Question: 1
......
Question:2
.....
.
.
. 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-05-27T13:31:33.313

当我不得不在相同的上下文中使用 foreach 索引和值时，我以这种方式解决了：

```
$array = array('a', 'b', 'c');
foreach ($array as $letter=>$index) {

  echo $letter; //Here $letter content is the actual index
  echo $array[$letter]; // echoes the array value

}//foreach 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-07-07T00:26:57.120

我通常在使用关联数组时这样做：

```
foreach ($assoc_array as $key => $value) {
 //do something
} 
```

这也适用于非关联数组。$key 将是索引值。如果您愿意，您也可以这样做：

```
foreach ($array as $indx => $value) {
  //do something
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-06-16T10:12:58.920

```
foreach(array_keys($array) as $key) {
//  do stuff
} 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-04-08T09:49:02.403

我想添加这个，我在 laravel 中使用它来索引我的表：

*   使用 $loop->index
*   我还使用 ++$loop 将其预增量为从 1 开始

我的代码：

```
@foreach($resultsPerCountry->first()->studies as $result)
  <tr>
    <td>{{ ++$loop->index}}</td>                                    
  </tr>
@endforeach 
```

# cvs - 为什么不建议删除 CVS 中的分支？

> ID：141123
> 
> 赞同：26
> 
> 时间：2008-09-26T18:26:13.130
> 
> 标签：cvs

在什么情况下这样做或不安全？我有一个有四个更改的分支（没有文件添加或删除）。这可以安全删除吗？

编辑：想要删除它的原因是它被错误命名并且会导致混乱。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2011-09-01T16:51:00.653

人们登陆这里寻找“如何在 cvs 中删除分支”的答案

cvs tag -dB 分支名

-d 将删除，-B 将覆盖并让它知道删除分支（不是标签）

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-26T18:32:41.133

我相信 CVS 实际上不会删除分支，它只会从分支中删除标签——所以分支仍然存在于每个受影响的 ",v" 文件中，它只是不再容易被访问. 结果很奇怪，但可能并不危险。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T18:35:32.733

通常不建议删除分支，因为它会丢失太多历史并且无法撤消。一般的建议实际上是仅在分支非常年轻并且犯了错误时才删除它。就像分支名称中的错字一样。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T18:41:29.487

如果一个分支是空的（你没有在其中提交任何东西），那么删除它是可以的，它就像取消标记文件一样工作。但是如果你已经提交了几次文件，这会有点危险，因为你可以删除分支引用，但不能删除它下面的文件。这至少会很混乱。

相反，如果真的想“保护”这个分支，您可以将文件锁定在（通过脚本更好），这样没有人可以再对其进行更改而忘记它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T18:35:14.840

Curt 是正确的，要删除分支，您必须从框中物理运行删除命令。

好像在你提到的情况下，删除它就可以了。

# database-design - 设计数据库时要记住哪些重要事项？

> ID：141126
> 
> 赞同：18
> 
> 时间：2008-09-26T18:26:35.640
> 
> 标签：database-design

设计数据库时要记住哪些重要事项？

我不想限制您对我的需求的回答，因为我相信其他人也可以从您的见解中受益。但我正在为多客户社区驱动的网站规划一个内容管理系统。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-26T18:32:31.727

“规范化，直到它受伤；去规范化，直到它起作用。”

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-26T18:29:20.547

（假设 OLTP）

数据结构的规范化。（性能反规范化*通常*可以在需要时进行）

[http://en.wikipedia.org/wiki/Database_normalization](http://en.wikipedia.org/wiki/Database_normalization)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-26T18:49:06.193

确保使用约束（`CHECK`、`NOT NULL`、`FOREIGN KEY`、`PRIMARY KEY`和`DEFAULT`）首先确保只有正确的数据存储在数据库中。您总是可以购买更快的硬件，但您无法购买更多正确的数据。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-26T19:13:59.253

预先建立一致的命名标准。从长远来看，这将节省几分钟不必要的思考。（这可能读起来很讽刺，但我是认真的。）

并且不要缩写任何东西，除非它*非常*常见。不要将数据库变成车牌信息猜谜游戏。令人惊讶的是，一年后变得不明显。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-26T18:40:12.347

尝试想象您将针对它执行的 SQL 查询。

这很重要，因为你会做很多！

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-26T19:09:46.893

有些事情我会记住。确保每个表都有唯一标识记录的方法（这样做可以节省数小时的痛苦）。规范化但不要加入大型多列自然键，除非您希望整个过程变慢。请改用在父表中自动生成的数字键。

是的，考虑一下您需要运行的查询和报告类型。考虑可扩展性。看起来您在订单表中不需要超过 10 个产品列，但是当您需要 11 个时会发生什么。最好有一个订单表和一个订单详细信息表。

确保将所有数据完整性规则合并到数据库中。并非所有数据更改都来自用户界面，我不得不尝试修复太多严重混乱的数据库，因为设计人员认为将所有规则都放在 GUI 中是可以的。

设计时要考虑的最关键的事情首先是如何确保数据完整性（如果数据没有意义，那么数据库就没有用处），其次是如何确保性能。不要使用对象模型来设计关系数据库，除非你想要糟糕的性能。

下一个最重要的事情是数据保护和安全。用户永远不应该直接访问数据库表。如果您的设计需要动态 SQL，他们将必须具有该访问权限。从通过 SQL 注入攻击之类的潜在黑客入侵的角度来看，这很糟糕，但更重要的是，它会为内部人员进行欺诈打开您的数据库。是否有需要加密数据的字段（信用卡信息、密码和社会安全号码是永远不应该以未加密方式存储的项目之一）。您打算如何做到这一点以及您打算如何审核解密以确保人们在不需要查看数据时不会解密。有没有你必须经历的法律障碍（[HIPPA](http://en.wikipedia.org/wiki/Health_Insurance_Portability_and_Accountability_Act)和[Sarbanes Oxley](http://en.wikipedia.org/wiki/Sarbanes%E2%80%93Oxley_Act)会浮现在脑海中）？

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T19:57:52.753

获得一本关于数据建模的非常好的书 - 由真正的数据库开发人员编写，而不是试图教您如何在“现实世界”中完成它的 .NET 开发人员。

数据库设计的问题空间太大了，无法在这样的论坛中进行详细介绍。尽管如此，我还是给你一些个人建议：

听听上面关于规范化的帖子。永远不要非规范化，因为您认为出于性能原因必须这样做。只有在遇到实际性能问题（理想情况下是在您的 QA 环境中，而不是在生产环境中）之后，您才应该进行非规范化。即便如此，请考虑可能有更好的方法来编写查询或首先改进索引。

尽可能地约束数据。列应尽可能为 NOT NULL。在任何应该使用的地方使用 CHECK 约束和 FOREIGN KEY。如果您不这样做，不良数据**将**进入您的数据库并导致很多麻烦和特殊情况编程。

在您真正开始设计表格之前仔细考虑您的数据。很好地了解您的流程将如何流动以及他们需要跟踪哪些数据。很多时候，你乍一看认为是一个实体，结果却是两个实体。例如，在我正在开发的系统中，之前的设计者创建了一个 Member 表，他们应用程序中的所有信息都是 Member 表的一部分。事实证明，成员可能想要更改其应用程序上的数据，但我们仍然需要跟踪原始应用程序的外观，因此应用程序实际上是它自己的实体，而成员是一个最初可能从应用程序。简而言之，做广泛的数据分析，不要只是开始创建表格。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-26T20:12:09.053

既然现在已经有好几篇帖子提倡这个了，我再补充一件事……

不要陷入将 ID 列放在所有表上的陷阱。现代数据库设计理论使用真正的主键有很多很好的理由，它们并不是严格的学术理由。我使用过包含数百个表的数据库，其中许多是数百万行表，有超过 1000 个并发用户并且使用真正的主键并没有“崩溃”。

在所有表上使用 ID 列意味着您必须进行多表连接才能遍历数据库，这会变得很麻烦。它还倾向于促进草率的数据库设计，甚至超出通常会导致重复行的问题。另一个问题是，在处理外部系统时，您现在必须与这些 ID 进行通信。

代理 ID 有一些位置 - 类型代码表和概念表（例如，如果规则没有真实世界的标识符，则系统规则表可以使用 ID）。在任何地方使用它们是一个错误 IMO。

这是一个长期存在的辩论，但这是我对此事的看法，因为它的价值。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-27T18:59:20.327

数据是永恒的。处理来来去去。

让关系模型成为现实世界的高保真表示。这比什么都重要。

处理将改变和发展多年。但是您的数据——以及数据模型——不能以同样的速度和同样的灵活性发展。您可以添加处理，但不能神奇地添加信息。您不想删除信息（但您可以忽略它。）

得到**正确**的模型。图表中的实体和关系对于普通的非技术用户来说应该是合理的。即使是应用程序编程也应该简单、清晰和精确。

如果您在模型上遇到困难，请不要发明大而复杂的查询或（更糟糕的）存储过程来解决问题。程序上的变通办法是一个代价高昂的错误。了解你拥有什么，你想做什么，并应用 YAGNI 原则将事情精简到基本要素。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-14T15:45:34.657

我知道这已经说明了，但是规范化，规范化，规范化是关键。如果您觉得出于某种原因需要以非规范化格式存储数据，请不要这样做。这应该通过视图或在单独的报告数据库中处理。我的另一个关键建议是尽可能避免使用 text/ntext 字段。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-07-22T13:32:59.523

“数据库的拇指规则 - 总是失败！”

示例：如果您有一个 Customer 表，其中包含 Mailing Address 和 Shipping address 以及 Billing address 列... 创建一个具有地址类型的单独 CustomerAddress 表

如果您有一个 CancellationDetails 表，其中包含 CancellationReason01、CancellationReason02、CancellationReason03.. 创建一个单独的 CancellationReason 表

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-09-13T20:52:40.547

实用。记住你的目标是什么，不要疯狂地创造不必要的复杂性。我有一些偏好：

*   保持表的数量少
*   与充满空值的宽表相比，更喜欢窄表。
*   标准化通常很好
*   触发器通常非常痛苦

但这些都是达到目的的手段（在很多情况下是矛盾的，需要仔细平衡），主要是让需求驱动设计。您对什么是独立实体、什么是另一个实体的一部分以及什么是猫粮（不是您关心其身份的任何东西）的选择完全取决于您的要求。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-26T18:45:01.383

如果您有查询要运行很多，请将它们放入存储过程。他们*几乎*总是跑得更​​快。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T18:47:22.080

如果您将按主键以外的字段查找行，请确保对它们进行索引。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T18:56:08.423

是面向对象的语言吗？因此，请尝试在数据库之前为您的对象建模。这将帮助您专注于模型。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T19:08:02.373

尽可能多地了解需求。然后设计一个逻辑模式，只有在需求发生变化或迁移到完全不同类型的数据库时才需要更改，比如不使用 SQL 的数据库。然后将您的设计细化并扩展为考虑您的特定 DBMS 产品、您的容量、您的负载和您的速度要求的物理设计。

学习如何规范化，还要学习何时打破规范化规则。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-26T19:23:11.510

我强烈赞同标准化是至关重要的，出于性能或其他可维护性原因，需要遵循战术非标准化。但是，如果您希望拥有的不仅仅是几张桌子，我想提出一个关于规范化的警告，随着桌子数量的增加，这将使您的生活变得更加轻松。

需要注意的是使每个表的主键成为单个数字列（适合您的 DB 风格）。在学术规范化中，想法是结合实体（表）的任何属性（列），以便您可以唯一标识正在描述的内容（行）的实例，并且最终可以得到多列复合主键. 因此，每当您将该复合键作为外键迁移到其他表时，您最终都会在引用它的*每个表中复制这些多列。*如果您只有六张桌子，那可能对您有用。但是当你比这大得多时，它很快就会分崩离析。

因此，不要使用多列复合主键，而是使用顺序数字主键，即使这种方法违背了一些严格的规范化教导。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-04T17:22:06.930

确保在模型中编码尽可能多的元数据。只需查看数据模型，就应该可以推断出几乎任何业务规则或概念。

这意味着，请注意选择反映用户现实的名称（但如果它有助于模型，请不要害怕改变他们对现实的看法）。

对数据库中的所有约束进行编码。不要依赖应用层只提供敏感数据。首先确保只有合理的数据可以存在。

不要在模型中聚合数据。尽可能保持模型的原子性。即时聚合或将常规聚合作业运行到聚合表中。

在模式之间选择一个好的分区。一些分区与外键有关，而另一些则通过纯粹的物理分离。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-26T18:52:06.483

不要使用大量列作为主键

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-26T19:14:05.963

请记住，标准化仅与您正在建模的内容相关。也许您正在为您的域中的一组对象建模。也许您正在记录一系列事件，其中数据重复，因为相同的数据碰巧不止一次应用。不要把这两件事混为一谈。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-26T19:23:04.130

我同意了解您的数据是好的和规范化的。

我建议的其他方法是将非常大的文本字段保存在单独的表格中。例如，如果您有一份合同，您可能希望将有关合同的大量信息保存在一个表中，但将法律（并且非常大）文档保存在单独的表中。只需将主表中的索引放入法律文件即可。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-27T18:31:32.530

我想说要记住的重要一点是结构可能会改变。所以不要把自己设计成一个角落。确保你所做的任何事情都会给你留下一些“空间”，甚至有一天可以将数据迁移到不同的结构中。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-09-13T20:57:55.690

尽可能使主键成为序列生成的数字。

# tcp - TCP/IP 是否防止数据包重放？

> ID：141128
> 
> 赞同：3
> 
> 时间：2008-09-26T18:27:01.723
> 
> 标签：tcp

TCP/IP 是否会阻止同一数据包的多个副本到达目的地？还是由端点在其上方分层幂等性逻辑？

如果可能，请参考 TCP/IP 规范中的特定段落。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T18:32:06.843

从重复数据包中恢复是 TCP 堆栈的工作：

> TCP 必须从 Internet 通信系统损坏、丢失、复制或乱序传送的数据中恢复。这是通过为每个传输的八位字节分配一个序列号来实现的，并且需要来自接收 TCP 的肯定确认 (ACK)。如果在超时间隔内没有收到 ACK，则重新传输数据。在接收端，序列号用于正确排序可能被乱序接收的段并消除重复。通过向每个传输的段添加校验和，在接收器处对其进行检查并丢弃损坏的段来处理损坏。

-- [RFC 793](http://www.faqs.org/rfcs/rfc793.html) - 传输控制协议，第 1.5 节

但是，如果它们是具有新序列号的相同数据包，则不会。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T18:37:59.793

TCP 在重传的情况下使用序列号来检测重复，这也将防止微不足道的重放攻击。

来自 RFC 793，第 3.3 节 - 序列号：

> 设计中的一个基本概念是通过 TCP 连接发送的每个八位字节数据都有一个序列号。由于每个八位字节都是按顺序排列的，因此它们中的每一个都可以被确认。所采用的确认机制是累积的，因此对序列号 X 的确认表示已接收到直到但不包括 X 的所有八位字节。这种机制允许在存在重传的情况下直接进行重复检测。段内八位字节的编号是紧跟在头之后的第一个数据八位字节编号最低，后面的八位字节连续编号。

重复检测将确保不能轻易重传相同的数据包。序列号还将确保注意到数据流中数据的插入（而不是替换），因为伪造数据包之后的其他合法数据包将具有重复的序列号，这将破坏数据流。这可能会导致这些数据包作为重复数据包被丢弃，这可能会破坏正在使用的协议。

有关原始 (1981) TCP/IP 规范的更多信息，请参见[RFC 793](http://www.faqs.org/rfcs/rfc793.html)以及许多其他涉及 TCP/IP 协议扩展或修改的 RFC。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T18:38:48.933

是的，TCP 层防止重复数据包。它下面的 IP 层没有。

[RFC 1122](https://www.rfc-editor.org/rfc/rfc1122#page-82)中的详细信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-14T19:58:16.637

您似乎担心两件不同的事情：

1.  TCP 可靠传递提供了哪些保证
2.  攻击者能否通过重放攻击影响我的服务器进程

回答1：

TCP 保证字节序列的可靠、有序传递。在服务器调用期间，客户端应用程序发送到 TCP 的任何数据`write()`都将完全相同。`read()`

回答2：

重放攻击不适用于 TCP，因为每个连接都依赖于客户端和服务器分别生成的两个随机 32 位数字。要使重放攻击起作用，攻击者必须猜测服务器为其发起的虚假连接生成的序列号（理论上，攻击者有 1 / 2**32 的机会正确猜测）。如果攻击者猜错了，她在最坏的情况下会在你的操作系统中造成一些数据缓冲。

请注意，仅仅因为重放攻击不起作用，没有什么可以阻止攻击者与您的服务器建立合法连接并将她想要的任何数据流传输到您的应用程序。这就是为什么*始终验证输入*很重要的原因。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T18:30:26.537

TCP 之下的层可能会遇到多个数据包或丢弃的数据包。TCP 之上的层不会遇到重复或丢弃的数据包。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T18:28:49.970

我不知道数据包重复，但我从未使用 TCP/IP 遇到过它，而且我知道它确实保证数据包都以正确的顺序到达，所以我不明白为什么它不会。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-14T13:06:09.540

这实际上取决于您接收数据的方式——尽管从技术上讲，协议不应给您重复（即具有相同 tcp 校验和的数据包），但其他因素可能会导致您看到重复数据——例如，您使用的网络硬件；此外，如果您使用嗅探器查看 tcp 流，而不仅仅是在应用程序中读取打开的套接字，即使它们正在监视的实际 tcp 流没有 dup 数据包，也有可能从嗅探器获取 dup 数据包。

举一个真实的例子——目前我正在为一家大型证券交易所对内部网络进行一些 tcp 分析，我正在查看的数据来自多个嗅探器并被拼接在一起。所以在提取数据时，我发现我需要做一些预处理步骤，包括查找和删除重复项。例如，在我刚刚读入的大约 60,000 个数据包的流中，我找到并删除了 95 个重复的数据包。

我在这里采取的策略是保留 10 个最近的 tcp 校验和的滚动窗口，并忽略与这些校验和匹配的数据包。请注意，这适用于 PSH 数据包，但不适用于 ACK 数据包 - 但无论如何我不太关心这些。

为了跟踪这个 tcp 校验和的滚动窗口，我编写了一个特殊的集合，这可能对其他人有帮助：

```
/// <summary>
/// Combination of a double-linked-list and a hashset with a max bound; 
/// Works like a bounded queue where new incoming items force old items to be dequeued; 
/// Re-uses item containers to avoid GC'ing;
/// Public Add() and Contains() methods are fully thread safe through a ReaderWriterLockSlim;
/// </summary>
public class BoundedHashQueue<T>
{
    private readonly int _maxSize = 100;
    private readonly HashSet<T> _hashSet = new HashSet<T>();
    private readonly ReaderWriterLockSlim _lock = new ReaderWriterLockSlim();
    private readonly Item _head;
    private readonly Item _tail;
    private int _currentCount = 0;

    public BoundedHashQueue(int maxSize)
    {
        _maxSize = maxSize;
        _head = _tail = new Item();
    }

    private class Item
    {
        internal T Value;
        internal Item Next;
        internal Item Previous;
    }

    public void Add(T value)
    {
        _lock.Write(() =>
            {
                if (_currentCount == 0)
                {
                    Item item = new Item();
                    item.Value = value;
                    _head.Next = item;
                    item.Previous = _head;
                    item.Next = _tail;
                    _tail.Previous = item;
                    _currentCount++;
                }
                else
                {
                    Item item;
                    if (_currentCount >= _maxSize)
                    {
                        item = _tail.Previous;
                        _tail.Previous = item.Previous;
                        _tail.Previous.Next = _tail;
                        _hashSet.Remove(item.Value);
                    }
                    else
                    {
                        item = new Item();
                        _currentCount++;
                    }
                    item.Value = value;
                    item.Next = _head.Next;
                    item.Next.Previous = item;
                    item.Previous = _head;
                    _head.Next = item;
                    _hashSet.Add(value);
                }
            });
    }

    public bool Contains(T value)
    {
        return _lock.Read(() => _hashSet.Contains(value));
    }
}} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-25T23:05:07.343

你没有完全理解问题。请参阅此链接： [http ://en.wikipedia.org/wiki/Transmission_Control_Protocol](http://en.wikipedia.org/wiki/Transmission_Control_Protocol)

在这个页面上写着：

“在 RFC 1323 中定义的 TCP 时间戳帮助 TCP 计算发送方和接收方之间的往返时间。时间戳选项包括一个 4 字节时间戳值，发送方在其中插入其时间戳时钟的当前值，以及一个 4 字节回显回复时间戳值，接收方通常插入它收到的最新时间戳值。发送方在确认中使用回显回复时间戳来计算自确认段发送以来经过的总时间。[2]

TCP 时间戳也用于帮助 TCP 序列号遇到其 2^32 边界并“环绕”序列号空间的情况。该方案被称为防止包装序列号或 PAWS（有关详细信息，请参阅 RFC 1323）。”

问候，联合（波兰）

# asp.net - 在 JavaScript 中计算时间跨度

> ID：141136
> 
> 赞同：14
> 
> 时间：2008-09-26T18:28:18.427
> 
> 标签：asp.net, javascript

我有一个带有开始时间和结束时间文本框的 .net 2.0 ascx 控件。数据如下：

txtStart.Text = 09/19/2008 07:00:00

txtEnd.Text = 09/19/2008 05:00:00

我想计算 JavaScript 中的总时间（小时和分钟），然后将其显示在页面上的文本框中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-06-04T02:25:59.610

```
function stringToDate(string) {
        var matches;
    if (matches = string.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2}) (\d{2,2}):(\d{2,2}):(\d{2,2})$/)) {
       return new Date(matches[1], matches[2] - 1, matches[3], matches[4], matches[5], matches[6]);
    } else {
       return null;
    };
}

    function getTimeSpan(ticks) {
        var d = new Date(ticks);
        return {
            hour: d.getUTCHours(), 
            minute: d.getMinutes(), 
            second: d.getSeconds()
        }
    }

    var beginDate = stringToDate('2008-09-19 07:14:00');
    var endDate = stringToDate('2008-09-19 17:35:00');

    var sp = getTimeSpan(endDate - beginDate);
    alert("timeuse：" + sp.hour + " hour " + sp.minute + " minute " + sp.second + " second "); 
```

您可以使用 getUTCHours() 代替 Math.floor(n / 3600000);

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T18:33:26.357

一旦预先知道了文本框日期格式，就可以在 Javascript 中使用[Matt Kruse 的 Date 函数](http://www.mattkruse.com/javascript/date/)将两者转换为时间戳，减去然后写入结果文本框。

同样，[JQuery 日期输入](http://jonathanleighton.com/projects/date-input#date-formatting)代码`stringToDate`可以根据您的目的进行调整 - 下面采用“YYYY-MM-DD”格式的字符串并将其转换为日期对象。这些对象的时间戳 ( `getTime()`) 可用于您的计算。

```
stringToDate: function(string) {
    var matches;
    if (matches = string.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2})$/)) {
       return new Date(matches[1], matches[2] - 1, matches[3]);
    } else {
       return null;
    };
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T19:19:41.393

我采用了[@PConroy](https://stackoverflow.com/questions/141136/calculate-timespan-in-javascript#141159)所做的，并通过为您进行计算来添加它。我还添加了正则表达式以确保时间是创建日期对象的字符串的一部分。

```
<html>
    <head>
        <script type="text/javascript">
            function stringToDate(string) {
                var matches;
                if (matches = string.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2}) (\d{2,2}):(\d{2,2}):(\d{2,2})$/)) {
                   return new Date(matches[1], matches[2] - 1, matches[3], matches[4], matches[5], matches[6]);
                } else {
                   return null;
                };
            }

            //Convert duration from milliseconds to 0000:00:00.00 format
            function MillisecondsToDuration(n) {
                var hms = "";
                var dtm = new Date();
                dtm.setTime(n);
                var h = "000" + Math.floor(n / 3600000);
                var m = "0" + dtm.getMinutes();
                var s = "0" + dtm.getSeconds();
                var cs = "0" + Math.round(dtm.getMilliseconds() / 10);
                hms = h.substr(h.length-4) + ":" + m.substr(m.length-2) + ":";
                hms += s.substr(s.length-2) + "." + cs.substr(cs.length-2);
                return hms;
            }

            var beginDate = stringToDate('2008-09-19 07:14:00');
            var endDate = stringToDate('2008-09-19 17:35:00');

            var n = endDate.getTime() - beginDate.getTime();

            alert(MillisecondsToDuration(n));
        </script>
    </head>
    <body>
    </body>
</html> 
```

这很粗糙，因为我编码得很快，但它确实有效。我测试了它。警报框将显示 0010:21:00.00 (HHHH:MM:SS.SS)。基本上，您需要做的就是从文本框中获取值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-09T15:57:49.243

最重要的答案都假设字符串操作。这是一个适用于纯日期对象的解决方案：

```
var start = new Date().getTime();
window.setTimeout(function(){
  var diff = new Date(new Date().getTime() - start);
  // this will log 0 hours, 0 minutes, 1 second
  console.log(diff.getHours(), diff.getMinutes(),diff.getSeconds());
},1000); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-02T04:46:39.683

我在 javascript 中搜索了计算时间跨度，并在 SO 上找到了这个问题；不幸的是，问题文本和实际问题（只需要几小时和几分钟）不一样......所以我想我是错误地来到这里的。

但是，我确实写了问题标题的答案-因此，如果其他人想要打印出诸如“ 1年零15分钟”之类的东西，那么这是给您的：

```
function formatTimespan(from, to) {
    var text = '',
        span = { y: 0, m: 0, d: 0, h: 0, n: 0 };

    function calcSpan(n, fnMod) {
        while (from < to) {
            // Modify the date, and check if the from now exceeds the to:
            from = from[fnMod](1);
            if (from <= to) {
                span[n] += 1;
            } else {
                from = from[fnMod](-1);
                return;
            }
        }
    }

    function appendText(n, unit) {
        if (n > 0) {
            text += ((text.length > 0) ? ', ' : '') +
                n.toString(10) + ' ' + unit + ((n === 1) ? '' : 's');
        }
    }

    calcSpan('y', 'addYears');
    calcSpan('m', 'addMonths');
    calcSpan('d', 'addDays');
    calcSpan('h', 'addHours');
    calcSpan('n', 'addMinutes');

    appendText(span.y, 'year');
    appendText(span.m, 'month');
    appendText(span.d, 'day');
    appendText(span.h, 'hour');
    appendText(span.n, 'minute');

    if (text.lastIndexOf(',') < 0) {
        return text;
    }

    return text.substring(0, text.lastIndexOf(',')) + ', and' + text.substring(text.lastIndexOf(',') + 1);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-27T17:51:05.843

使用 Math.floor(n / 3600000) 而不是 getUTCHours() ，否则您将失去大于 24 的小时数。

例如，如果您有 126980000 毫秒，则应转换为 0035:16:20.00

如果你使用 getUTCHours() 你会得到一个不正确的字符串 0011:16:20.00

更好的是，使用这个（由 KK-MOD 表示的修改）：

> 函数 MillisecondsToDuration(n) {
> var hms = "";
> var dtm = 新日期（）；
> dtm.setTime(n);
> var d = Math.floor(n / 3600000 / 24); // KK-MOD
> var h = "0" + (Math.floor(n / 3600000) - (d * 24)); // KK-MOD
> var m = "0" + dtm.getMinutes();
> var s = "0" + dtm.getSeconds();
> var cs = "0" + Math.round(dtm.getMilliseconds() / 10);
> hms = (d > 0 ? d + "T" : "") + h.substr(h.length - 2) + ":" + m.substr(m.length - 2) + ":"; // KK-MOD
> hms += s.substr(s.length - 2) + "." + cs.substr(cs.length - 2);
> 返回 hms; }

所以现在，192680000 显示为 1T11:16:20.00，即 1 天 11 小时 16 分 20 秒

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-11T18:55:48.293

我喜欢 K3 + KK-MOD 的方法，但我需要显示负时间跨度，所以我做了以下修改：

```
 function MillisecondsToDuration(milliseconds) {
   var n = Math.abs(milliseconds);
   var hms = "";
   var dtm = new Date();
   dtm.setTime(n);
   var d = Math.floor(n / 3600000 / 24); // KK-MOD
   var h = "0" + (Math.floor(n / 3600000) - (d * 24)); // KK-MOD
   var m = "0" + dtm.getMinutes();
   var s = "0" + dtm.getSeconds();
   var cs = "0" + Math.round(dtm.getMilliseconds() / 10);
   hms = (milliseconds < 0 ? " - " : "");
   hms += (d > 0 ? d + "." : "") + h.substr(h.length - 2) + ":" + m.substr(m.length - 2) + ":"; // KK-MOD
   hms += s.substr(s.length - 2) + "." + cs.substr(cs.length - 2);
   return hms; } 
```

我还将“T”分隔符更改为“。” 出于我自己的格式化目的。

现在传入一个负值，比如 -360000（负六分钟）将产生以下输出：

- 00:06:00

# java - 为什么 Java 没有块范围的变量声明？

> ID：141140
> 
> 赞同：10
> 
> 时间：2008-09-26T18:28:59.753
> 
> 标签：java, syntax, language-design

以下方法不起作用，因为内部块声明了一个与外部块中的变量同名的变量。显然变量属于声明它们的方法或类，而不是声明它们的块，因此我不能编写一个简短的小临时块进行调试，碰巧将外部范围内的变量推入影子只是片刻：

```
void methodName() {
  int i = 7;
  for (int j = 0; j < 10; j++) {
    int i = j * 2;
  }
} 
```

几乎我用过的所有块级语言都支持这一点，包括我在学校编写的解释器和编译器的琐碎小语言。Perl 可以做到这一点，Scheme 也可以，甚至 C 也可以。甚至 PL/SQL 也支持这一点！

这个 Java 设计决策的基本原理是什么？

编辑：正如有人指出的那样，Java 确实有块作用域。我要问的概念的名称是什么？我希望我能从那些语言设计课程中记住更多。:)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-26T19:00:49.957

好吧，严格来说，Java*确实*有块范围的变量声明。所以这是一个错误：

```
void methodName() {
  for (int j = 0; j < 10; j++) {
    int i = j * 2;
  }
  System.out.println(i); // error
} 
```

因为 'i' 在 for 块之外不存在。

问题是 Java 不允许您创建与在同一方法的外部块中声明的另一个变量同名的变量。正如其他人所说，据说这样做是为了防止难以识别的错误。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-26T18:37:34.613

因为作家故意这样做并通过忘记现在有两个具有相同名称的变量而完全搞砸的情况并不少见。他们更改了内部变量名称，但保留了使用该变量的代码，现在无意中使用了先前隐藏的变量。这导致程序仍然可以编译，但执行错误。

同样，意外隐藏变量并改变程序行为的情况并不少见。在不知不觉中隐藏现有变量可以像我上面提到的取消隐藏变量一样容易地更改程序。

允许这种阴影几乎没有什么好处，以至于他们将其排除在外，因为它太危险了。说真的，只需将您的新变量称为其他变量，问题就会消失。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-26T18:33:14.953

我相信基本原理是大多数时候，这不是故意的，这是一个编程或逻辑缺陷。

在像您这样微不足道的示例中，这很明显，但是在一大段代码中，意外地重新声明变量可能并不明显。

ETA：它也可能与java中的异常处理有关。我认为这个问题的一部分是在一个与为什么在 try 部分中声明的变量在 catch/finally 范围中不可用有关的问题中讨论的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-26T18:30:51.713

我猜它会导致难以发现的错误。在 C# 中类似。

Pascal 不支持这一点，因为您必须在函数体上方声明变量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T19:27:25.010

这个问题的基本假设是错误的。

Java**确实**有块级作用域。但它也有一个范围层次结构，这就是为什么你可以`i`在`for`循环内引用，但不能`j`在 for 循环外引用的原因。

```
public void methodName() {
  int i = 7;
  for (int j = 0; j < 10; j++) {
    i = j * 2;
  }

  //this would cause a compilation error!
  j++;
} 
```

我一生都无法弄清楚为什么您希望范围界定以其他方式表现。不可能确定`i`您在 for 循环中指的是哪个，我敢打赌，您有 99.999% 的机会想要引用`i`方法内部。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-13T06:30:38.750

另一个原因：如果允许这种变量声明，人们会想要（需要？）一种访问外部块变量的方法。可能会添加类似“外部”关键字的内容：

```
void methodName() {
    int i = 7;
    for (int j = 0; j < 10; j++) {
        int i = outer.i * 2;
        if(i > 10) {
            int i = outer.outer.i * 2 + outer.i;
        }
    }
} 
```

# sql-server - Great Plains 中的 SQL 跟踪显示无效的列名“desSPRkmhBBCreh”

> ID：141144
> 
> 赞同：1
> 
> 时间：2008-09-26T18:29:22.933
> 
> 标签：sql-server, sql-server-profiler, dynamics-gp

这个错误似乎只是不时弹出。它不限于单个表，甚至发生在它刚刚创建的表上。其他人看到这种奇怪的行为吗？

[Edit w/solution] 原来这个查询是用来判断表是否存在的。显然查询无效列比只检查表要快得多。Sql，去图。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T20:58:53.323

是的，它看起来像其他人已经看到它： [http://microsoft-programming.hostweb.com/TopicMessages/microsoft.public.greatplains/1866812/1/Default.aspx](http://microsoft-programming.hostweb.com/TopicMessages/microsoft.public.greatplains/1866812/1/Default.aspx)

不幸的是，我找不到他们引用的知识库文章。那里的 Victoria Yudin 说：“看看知识库文章 875229 - 它解决了这个确切的问题。基本上，这是在从 SQL 获取信息的同时输入的一个虚拟值，并且预计会出现错误。”

# svn - 如何找到我的 Subversion 服务器版本号？

> ID：141146
> 
> 赞同：300
> 
> 时间：2008-09-26T18:29:54.960
> 
> 标签：svn

我想知道我的服务器是否运行 Subversion 1.5。

我怎样才能知道呢？

也很高兴知道我的 SVN 客户端版本号。`svn help`没有帮助。

**注意：**我不想要我*的项目的*修订号等。这个问题是关于*Subversion 软件*本身的。

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2008-10-16T15:58:21.183

要查找 subversion REPOSITORY 的版本，您可以：

1.  查看网络上的存储库，在页面底部它会说：
    “Powered by Subversion version 1.5.2 (r32768)。”
2.  从命令行：<在此处插入 curl，grep oneliner>

如果没有显示，请查看页面源代码

```
<svn version="1.6.13 (r1002816)" href="http://subversion.tigris.org/"> 
```

现在对于颠覆客户：

```
svn --version 
```

就足够了

* * *

## 回答 #2

> 赞同：139
> 
> 时间：2012-02-29T16:29:17.363

让我们合并这些响应：

## 对于存储库/服务器（原始问题）：

### 如果能够访问 Subversion 服务器：

*   [从Manuel](https://stackoverflow.com/users/143838/manuel)较早的[回答](https://stackoverflow.com/questions/141146/how-to-find-my-subversion-server-version-number/1172703#1172703)中，在 SVN 服务器上运行以下命令：

    ```
    svnadmin --version 
    ```

### 如果是 HTTP/HTTPS 访问：

*   通过浏览器访问服务器时，请参阅“由 Subversion 提供支持”行。

*   通过浏览器访问存储库，然后查找嵌入在 HTML 源中的版本字符串。来自elviejo和[jaredjacobs](https://stackoverflow.com/users/140743/jaredjacobs)[的早期答案](https://stackoverflow.com/questions/141146/how-to-find-my-subversion-server-version-number/1148254#1148254)。同样，从 ?? 开始，使用浏览器的开发人员工具（通常是++ ）来阅读完整的响应。这也是处理证书和授权的最简单（非自动化）方式 - 您的浏览器会为您完成。`Ctrl``Shift``I`

*   检查响应标签（这些未显示在 HTML 源代码中），来自Christopher[较早](https://stackoverflow.com/users/193617/christopher)[的回答](https://stackoverflow.com/questions/141146/how-to-find-my-subversion-server-version-number/2742515#2742515)

    ```
    wget -S --spider 'http://svn.server.net/svn/repository' 2>&1 |
    sed -n '/SVN/s/.*\(SVN[0-9\/\.]*\).*/\1/p' 
    ```

### 如果 svn:// 或 ssh+svn 访问

*   来自[Milen](https://stackoverflow.com/users/15785/milen-a-radev)[较早的](https://stackoverflow.com/questions/141146/how-to-find-my-subversion-server-version-number/142061#142061)回答

    ```
    svnserve --version   (run on svn server) 
    ```

*   来自[Glenn](https://stackoverflow.com/users/165843/glenn)[较早的](https://stackoverflow.com/questions/141146/how-to-find-my-subversion-server-version-number/1356116#1356116)回答

    ```
    ssh user@host svnserve --version 
    ```

### 如果 GoogleCode SVN 服务器

```
 Check out the current version in a FAQ: 
    http://code.google.com/p/support/wiki/SubversionFAQ#What_version_of_Subversion_do_you_use? 
```

### 如果另一个自定义 SVN 服务器

```
 TBD 
```

***请编辑以完成此答案***

## 对于客户（不是原始问题）：

```
svn --version 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-09-26T21:20:46.190

在服务器上： `svnserve --version`

如果是基于 svnserve 的配置（svn:// 和 svn+xxx://）。

（为了完整性）。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2009-07-18T18:43:27.760

这是获取SVN服务器版本的最简单方法。即使您的 SVN 存储库需要[HTTPS ，](http://en.wikipedia.org/wiki/HTTP_Secure) [HTTP](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)也可以工作。

```
$ curl -X 选项 http://my-svn-domain/
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>...</head>
<身体>...
<address>Apache/2.2.11 (Debian) DAV/2 SVN/1.5.6 PHP/5.2.9-4 ...</address>
</body> 
</html>

```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2008-09-26T19:38:25.747

对于基于 HTTP 的服务器，有一个 Python 脚本可以在以下位置找到服务器版本：http: [//svn.apache.org/repos/asf/subversion/trunk/tools/client-side/server-version.py](http://svn.apache.org/repos/asf/subversion/trunk/tools/client-side/server-version.py)

您可以通过以下方式获取客户端版本

```
`svn --version` 
```

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2010-04-30T05:39:55.367

如果 HTML 列表中没有打印 Subversion 服务器版本，则它在服务器返回的 HTTP RESPONSE 标头中可用。您可以使用此 shell 命令获取它

```
wget -S --no-check-certificate \
  --spider 'http://svn.server.net/svn/repository' 2>&1 \
  | sed -n '/SVN/s/.*\(SVN[0-9\/\.]*\).*/\1/p'; 
```

如果 SVN 服务器要求您提供用户名和密码，则将`wget`参数`--user`和添加`--password`到命令中，如下所示

```
wget -S --no-check-certificate \
  --user='username' --password='password' \
  --spider 'http://svn.server.net/svn/repository' 2>&1 \
  | sed -n '/SVN/s/.*\(SVN[0-9\/\.]*\).*/\1/p'; 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-08-20T13:48:59.850

另一种选择：如果您有 Firefox（我使用的是 14.0.1）和 SVN Web 界面：

*   在 repo 页面上打开**Tools->Web Developer->Web Console**
*   刷新页面
*   点击**GET**行
*   查看服务器的**响应标头**部分**：**行

那里应该有一个“SVN/1.7.4”字符串或类似的。同样，这可能仅在您拥有如上所述的“ServerTokens Full”时才有效。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-05-13T17:32:22.320

确实没有一种***简单***的方法可以找出您的服务器正在运行的 Subversion 版本——除非您自己进入服务器并查看。

但是，这可能不像您想象的那么大。Subversion 客户端处理了大部分繁重的工作，并且大多数版本的 Subversion 客户端可以与几乎任何版本的服务器一起使用。

服务器版本真正对客户端产生影响的最后一个版本是在添加合并跟踪时从 1.4 版更改为 1.5 版。合并跟踪在 1.6 版中得到了极大的改进，但这并没有真正影响客户端和服务器之间的交互。

让我们看看 Subversion 1.8 的最新变化：

*   **`svn move`现在是一流的操作**： Subversion 终于明白`svn move`is not a `svn copy`and了`svn delete`。但是，这是客户端处理的事情，并不真正影响服务器版本。
*   **`svn merge --reintegrate`deprecated**：同样，只要服务器是 1.5 或更高版本，这不是问题。
*   **属性继承**：这是另一个 1.8 版本更新，但这将适用于任何 Subversion 服务器——尽管运行 1.8 的 Subversion 服务器将在可继承属性上提供更好的性能。
*   **两个新的可继承属性 -`svn:global-ignores`和`svn:auto-props`**：唉！我们真正想要的。一种设置这两个属性的方法，而不依赖于 Subversion 配置文件本身。但是，这是一个仅限客户端的问题，因此您使用的服务器版本再次无关紧要。
*   **gnu-agent 内存缓存**：另一个仅限客户端的功能。
*   fsfs 性能增强和 authz 存储库内身份验证。不错的功能，但无论您使用什么版本的客户端，这些功能都有效。

在所有功能中，只有一个取决于服务器的版本是 1.5 或更高版本（而 1.4 已经过时了很长一段时间。1.8 的新功能将提高工作副本的性能，但版本 1.8 的服务器不是'没有必要。您受客户端版本的影响比服务器版本更大。

我知道这不是您想要的答案（没有查看服务器版本的官方方式），但幸运的是服务器版本并没有真正对您产生太大影响。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-01-24T14:36:53.497

尝试这个：

```
ssh your_user@your_server svnserve --version

svnserve, version 1.3.1 (r19032)
   compiled May  8 2006, 07:38:44 
```

我希望它有所帮助。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-08-31T06:43:01.837

对于 svn+ssh 配置，使用 ssh 在主机上运行 svnserve --version：

> $ ssh user@host svnserve --version

必须在实际用作服务器的机器上运行 svnserve 命令。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-07-05T13:47:28.183

[使用 Firefox 浏览存储库并使用Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)检查元素。在 NET 选项卡下，您可以检查页面的 Header。它会有类似的东西：

```
Server: Apache/2.2.14 (Win32) DAV/2 SVN/1.X.X 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-08-16T14:36:36.600

只需使用网络浏览器访问 SVN 地址。检查源代码 ( `Ctrl`+ `U`)。然后你会在 HTML 代码中找到类似的内容：

```
<svn version="1.6\. ..." ... 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-09-15T14:06:41.513

[您可以使用HTTP](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)连接到您的 Subversion 服务器并在 HTTP 标头中找到版本号。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-01-09T03:09:38.483

对于 Subversion 1.7 及更高版本，服务器不提供指示服务器版本的页脚。但是您可以运行以下命令从响应标头中获取版本

```
$ curl -s -D - http://svn.server.net/svn/repository
HTTP/1.1 401 Authorization Required
Date: Wed, 09 Jan 2013 03:01:43 GMT
Server: Apache/2.2.9 (Unix) DAV/2 SVN/1.7.4 
```

请注意，这也适用于您无权访问的 Subversion 服务器。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-03-27T13:41:34.190

如果您使用 VisualSVN Server，您可以通过几种不同的方式找到版本号。

## 使用 VisualSVN 服务器管理器

请按照以下步骤通过管理控制台查找版本：

1.  启动**VisualSVN 服务器管理器**控制台。
2.  请参阅仪表板右下角的**版本。**

[![在此处输入图像描述](https://i.stack.imgur.com/AfPjW.png)](https://i.stack.imgur.com/AfPjW.png)

如果单击**版本**，您还将看到组件的版本。

[![在此处输入图像描述](https://i.stack.imgur.com/PtNJ2.png)](https://i.stack.imgur.com/PtNJ2.png)

## 检查 README.txt 文件

按照以下步骤从 readme.txt 文件中找出版本：

1.  启动**记事本.exe**。
2.  打开**%VISUALSVN_SERVER%README.txt**文件。第一行显示版本号。

[![在此处输入图像描述](https://i.stack.imgur.com/HrxKt.png)](https://i.stack.imgur.com/HrxKt.png)

# sql-server - 如何确定已安装的 SQL Server 实例及其版本？

> ID：141154
> 
> 赞同：242
> 
> 时间：2008-09-26T18:32:23.457
> 
> 标签：sql-server, sql-server-express

我正在尝试确定我已经安装了哪些 sql server/sql express 实例（手动或以编程方式），但所有示例都告诉我运行 SQL 查询以确定假设我已经连接到特定实例.

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-09-26T18:45:50.493

在命令行：

```
SQLCMD -L 
```

或者

```
OSQL -L 
```

（注：必须是大写L）

这将列出您网络上安装的所有 sql 服务器。您可以设置一些配置选项来阻止 SQL Server 显示在列表中。去做这个...

在命令行：

```
svrnetcn 
```

在启用的协议列表中，选择“TCP/IP”，然后单击属性。有一个“隐藏服务器”复选框。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2008-09-26T18:34:28.570

您可以查询此注册表值以直接获取 SQL 版本：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\ClientSetup\CurrentVersion 
```

或者，您可以查询您的实例名称，然后将 sqlcmd 与您想要的实例名称一起使用：

要查看您的实例名称：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names 
```

然后执行这个：

```
SELECT SERVERPROPERTY('productversion'), SERVERPROPERTY ('productlevel'), SERVERPROPERTY ('edition') 
```

[如果您使用的是 C++，则可以使用此代码来获取注册表信息。](https://stackoverflow.com/questions/34065/how-to-read-a-value-from-the-windows-registry#35717)

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2008-09-26T18:37:18.953

所有安装的实例都应显示在 Microsoft 管理控制台的服务管理单元中。要获取实例名称，请转到开始 | 运行 | 键入 Services.msc 并查找所有带有“Sql Server（实例名称）”的条目。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2012-02-27T12:06:07.857

-- T-SQL 查询以查找机器上安装的实例列表

```
DECLARE @GetInstances TABLE
( Value nvarchar(100),
 InstanceNames nvarchar(100),
 Data nvarchar(100))

Insert into @GetInstances
EXECUTE xp_regread
  @rootkey = 'HKEY_LOCAL_MACHINE',
  @key = 'SOFTWARE\Microsoft\Microsoft SQL Server',
  @value_name = 'InstalledInstances'

Select InstanceNames from @GetInstances 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2016-11-14T21:42:56.907

我知道这个线程有点老了，但是在我找到我正在寻找的答案并认为我会分享之前，我遇到了这个线程。如果您使用的是 SQLExpress（或 localdb），则有一种更简单的方法可以找到您的实例名称。在命令行类型：

```
> sqllocaldb i 
```

这将列出您在本地安装的实例名称。因此，您的完整服务器名称应在要连接的实例名称前包含 (localdb)\。此外，sqllocaldb 允许您创建新实例或删除它们以及配置它们。请参阅：[SqlLocalDB 实用程序](https://msdn.microsoft.com/en-us/library/hh212961.aspx)。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-27T09:18:58.287

如果您只想查看当前登录的计算机上安装了什么，我认为最直接的手动过程是打开 SQL Server 配置管理器（从“开始”菜单），它显示所有 SQL 服务（和*仅*SQL 服务）在该硬件上（运行与否）。这假定 SQL Server 2005 或更高版本；[dotnetengineer](https://stackoverflow.com/questions/141154/how-can-i-determine-installed-sql-server-versions#141180)使用服务管理控制台的建议将向您显示所有服务，并且应该始终可用（例如，如果您正在运行早期版本的 SQL Server）。

但是，如果您正在寻找更广泛的发现过程，您可能会考虑使用 SQLRecon 和 SQLPing 等第三方工具，它们将扫描您的网络并生成在他们有权访问的任何服务器上找到的所有 SQL 服务实例的报告。自从我使用这样的工具已经有一段时间了，但我对他们的发现感到惊讶（即，少数我不知道存在的实例）。YMMV。您可以谷歌了解详细信息，但我相信此页面有相关下载：[http ://www.sqlsecurity.com/Tools/FreeTools/tabid/65/Default.aspx](http://www.sqlsecurity.com/Tools/FreeTools/tabid/65/Default.aspx)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-03-21T21:19:32.420

SQL Server 允许应用程序在当前网络中查找 SQL Server 实例。SqlDataSourceEnumerator 类将此信息公开给应用程序开发人员，提供包含有关所有可见服务器的信息的 DataTable。此返回的表包含网络上可用的服务器实例列表，该列表与用户尝试创建新连接时提供的列表相匹配，并在“连接属性”对话框中展开包含所有可用服务器的下拉列表。显示的结果并不总是完整的。为了检索包含有关可用 SQL Server 实例信息的表，您必须首先使用共享/静态 Instance 属性检索一个枚举器：

```
using System.Data.Sql;

class Program
{
  static void Main()
  {
    // Retrieve the enumerator instance and then the data.
    SqlDataSourceEnumerator instance =
      SqlDataSourceEnumerator.Instance;
    System.Data.DataTable table = instance.GetDataSources();

    // Display the contents of the table.
    DisplayData(table);

    Console.WriteLine("Press any key to continue.");
    Console.ReadKey();
  }

  private static void DisplayData(System.Data.DataTable table)
  {
    foreach (System.Data.DataRow row in table.Rows)
    {
      foreach (System.Data.DataColumn col in table.Columns)
      {
        Console.WriteLine("{0} = {1}", col.ColumnName, row[col]);
      }
      Console.WriteLine("============================");
    }
  }
} 
```

来自 msdn [http://msdn.microsoft.com/en-us/library/a6t1z9x2(v=vs.80).aspx](http://msdn.microsoft.com/en-us/library/a6t1z9x2(v=vs.80).aspx)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-26T18:35:51.123

SQL Server 浏览器服务[http://msdn.microsoft.com/en-us/library/ms181087.aspx](http://msdn.microsoft.com/en-us/library/ms181087.aspx)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-06-21T19:41:18.730

如果您有兴趣在脚本中确定这一点，可以尝试以下操作：

```
sc \\server_name query | grep MSSQL 
```

注意：grep 是 gnuwin32 工具的一部分

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-08-22T01:11:06.117

此查询应该为您提供服务器名称和实例名称：

```
SELECT @@SERVERNAME, @@SERVICENAME 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-10-07T16:26:16.653

在 Windows 命令行中，键入：

```
SC \\server_name query | find /I "SQL Server (" 
```

其中“server_name”是您希望在其上显示 SQL 实例的任何远程服务器的名称。

这当然需要足够的权限。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-01-16T14:58:08.900

另一种选择是运行 SQLSERVER 发现报告。转到 sqlserver 的安装介质并双击 setup.exe

[![在此处输入图像描述](https://i.stack.imgur.com/bcNp1.gif)](https://i.stack.imgur.com/bcNp1.gif)

并在下一个屏幕中，转到工具并单击发现报告，如下所示

[![在此处输入图像描述](https://i.stack.imgur.com/Y1tg0.gif)](https://i.stack.imgur.com/Y1tg0.gif)

这将向您显示所有存在的实例以及整个功能。下面是我电脑上的快照 [![在此处输入图像描述](https://i.stack.imgur.com/G2fpm.gif)](https://i.stack.imgur.com/G2fpm.gif)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-12-22T10:30:35.683

我有同样的问题。“osql -L”命令仅显示服务器列表但没有实例名称（仅显示我的本地 SQL Sever 的实例）。使用 Wireshark、sqlbrowser.exe（可以在 SQL 安装的共享文件夹中找到），我找到了解决问题的方法。

本地实例由注册表项解析。远程实例由 UDP 广播（端口 1434）和 SMB 解析。使用“sqlbrowser.exe -c”列出请求。

我的配置使用 1 个物理网络适配器和 3 个虚拟网络适配器。如果我使用“osql -L”命令，sqlbrowser 会显示来自其中一个虚拟适配器（位于另一个网段中）的请求，而不是物理适配器。osql 通过其度量选择适配器。您可以使用“路由打印”命令查看指标。对于我的配置，路由表显示虚拟适配器的指标低于物理适配器。因此，我通过取消选择高级网络设置中的自动指标来更改网络属性中的接口指标。osql 现在使用物理适配器。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-12-14T00:34:02.553

我刚刚安装了 Sql server 2008，但我无法连接到任何数据库实例。@G Mastros 发布的命令未列出任何活动实例。

所以我查看了服务，发现 SQL Server 代理被禁用了。我通过将其设置为自动然后启动它来修复它。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-28T17:39:33.920

我在评估 100 多台服务器时遇到了同样的问题，我有一个用 C# 编写的脚本来浏览由 SQL 组成的服务名称。在服务器上安装实例时，SQL Server 会为每个实例添加一个服务名称。对于 2000 到 2008 等不同版本，它可能会有所不同，但可以肯定的是有一个带有实例名称的服务。

我获取服务名称并从服务名称中获取实例名称。以下是用于 WMI 查询结果的示例代码：

```
if (ServiceData.DisplayName == "MSSQLSERVER" || ServiceData.DisplayName == "SQL Server (MSSQLSERVER)")
            {
                InstanceData.Name = "DEFAULT";
                InstanceData.ConnectionName = CurrentMachine.Name;
                CurrentMachine.ListOfInstances.Add(InstanceData);
            }
            else
                if (ServiceData.DisplayName.Contains("SQL Server (") == true)
                {
                    InstanceData.Name = ServiceData.DisplayName.Substring(
                                            ServiceData.DisplayName.IndexOf("(") + 1,
                                            ServiceData.DisplayName.IndexOf(")") - ServiceData.DisplayName.IndexOf("(") - 1
                                        );
                    InstanceData.ConnectionName = CurrentMachine.Name + "\\" + InstanceData.Name;
                    CurrentMachine.ListOfInstances.Add(InstanceData);
                }
                else
                    if (ServiceData.DisplayName.Contains("MSSQL$") == true)
                    {
                        InstanceData.Name = ServiceData.DisplayName.Substring(
                                                ServiceData.DisplayName.IndexOf("$") + 1,
                                                ServiceData.DisplayName.Length - ServiceData.DisplayName.IndexOf("$") - 1
                                            );

                        InstanceData.ConnectionName = CurrentMachine.Name + "\\" + InstanceData.Name;
                        CurrentMachine.ListOfInstances.Add(InstanceData);
                    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-10-17T14:46:11.930

这些命令将向您显示*网络上的*`OSQL -L`所有实例。`SQLCMD -L`

 *如果您想获得*服务器上*所有实例的列表并且不想编写脚本或编程，请执行以下操作：

1.  启动 Windows 任务管理器
2.  勾选复选框“显示所有用户的进程”或等效项
3.  按“图像名称”对进程进行排序
4.  找到所有`sqlsrvr.exe`图像

实例应在“用户名”列中列为`MSSQL$INSTANCE_NAME`.

而且我从认为糟糕的服务器运行 63 个实例到意识到它正在运行三个实例（其中一个在 CPU 负载下表现得像一个完全的恶霸......）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-02-17T04:03:01.687

将获取 SQL server reg query "HKLM\Software\Microsoft\Microsoft SQL Server\Instance Names\SQL" 的实例

或使用 SQLCMD -L

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-07-24T13:54:25.113

这是一个简单的方法：依次转到开始、程序、Microsoft SQL Server 2005、配置工具、SQL Server 配置管理器、SQL Server 2005 网络配置，然后在这里您可以找到安装在您机器上的所有实例。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-12-01T15:42:04.387

我知道这是一篇旧文章，但我找到了 PoweShell 的一个很好的解决方案，您可以在其中找到安装在本地或远程机器上的 SQL 实例，包括该版本，还可以扩展获取其他属性。

```
$MachineName = ‘.’ # Default local computer Replace . with server name for a remote computer

$reg = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey(‘LocalMachine’, $MachineName)
$regKey= $reg.OpenSubKey("SOFTWARE\\Microsoft\\Microsoft SQL Server\\Instance Names\\SQL" )
$values = $regkey.GetValueNames()
$values | ForEach-Object {$value = $_ ; $inst = $regKey.GetValue($value); 
              $path = "SOFTWARE\\Microsoft\\Microsoft SQL Server\\"+$inst+"\\MSSQLServer\\"+"CurrentVersion";
              #write-host $path; 
              $version = $reg.OpenSubKey($path).GetValue("CurrentVersion");
                          write-host "Instance" $value;
              write-host  "Version" $version} 
```

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2015-09-07T12:28:45.567

如果您在 SSMS 中，您可能会发现它更易于使用：

```
SELECT @@Version 
```

# java - 如何确定是否在 Linux 上使用 Java 或 JRuby 运行了不同的进程 ID？

> ID：141162
> 
> 赞同：2
> 
> 时间：2008-09-26T18:34:21.003
> 
> 标签：java, ruby, linux, jruby, pid

我需要查看给定的进程 ID 是否正在运行，并且它必须在 Java 或 JRuby（最好是 Ruby 解决方案）中工作。它可以依赖于 Linux（特别是 Debian 和/或 Ubuntu）的系统。

我已经有了我要查找的 PID，只需要查看它当前是否正在运行。

* * *

更新：

感谢大家的所有回复！我很感激，但它不是我正在寻找的东西......我希望在标准 Ruby 库（或 Java，但最好是 Ruby）中找到一些东西......如果不存在这样的库调用，我可能会坚持我已经拥有的 procfs 解决方案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T09:51:51.017

[Darron's comment](https://stackoverflow.com/questions/141162/how-can-i-determine-if-a-different-process-id-is-running-using-java-or-jruby-on#141731) was spot on, but rather than calling the "kill" binary, you can just use Ruby's Process.kill method with the 0 signal:

```
#!/usr/bin/ruby 

pid = ARGV[0].to_i

begin
    Process.kill(0, pid)
    puts "#{pid} is running"
rescue Errno::EPERM                     # changed uid
    puts "No permission to query #{pid}!";
rescue Errno::ESRCH
    puts "#{pid} is NOT running.";      # or zombied
rescue
    puts "Unable to determine status for #{pid} : #{$!}"
end 
```

> [user@host user]$ ./is_running.rb 14302
> 14302 is running
> 
> [user@host user]$ ./is_running.rb 99999
> 99999 is NOT running.
> 
> [user@host user]$ ./is_running.rb 37
> No permission to query 37!
> 
> [user@host user]$ sudo ./is_running.rb 37
> 37 is running

Reference: [http://pleac.sourceforge.net/pleac_ruby/processmanagementetc.html](http://pleac.sourceforge.net/pleac_ruby/processmanagementetc.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T20:23:37.557

Unix 在信号零附近有一个特殊的 kill 系统调用功能。执行错误检查，但不发送信号。

```
def pid_exists? (pid)
    system "kill -0 #{pid}"
    return $? == 0
end 
```

一个警告：这不会检测您无权发出信号的具有该 pid 的进程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T18:34:27.743

根据[我对这个问题的回答](https://stackoverflow.com/questions/138097/how-do-i-find-my-pid-in-java-or-jruby-on-linux#138098)，我正在考虑再次使用 procfs，通过 File.exist 检查给定目录是否存在？“/proc/#{pid}”。这在 jirb 中有效：

```
irb(main):001:0> File.exist? “/proc/5555”
=> 假的
irb(main):002:0> File.exist? “/proc/7677”
=> 真

```

但是，我仍然更喜欢使用一种专门存在的方法来检测进程是否正在运行......比如 Process.exist?(pid)...... 不幸的是，我见过它不存在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:10:45.843

如果您不介意创建一个全新的流程，那么这种懒惰的方式应该可行：

```
def pid_exists? (pid)
    system "ps -p #{pid} > /dev/null"
    return $? == 0
end 
```

对于*ps*的大多数变体，它应该在成功时返回 0，在错误时返回非零。上述用法的常见错误是找不到具有给定 PID 的进程。在这种情况下，我在 Ubuntu 下的*ps*版本返回 256。

您也可以使用 Process.kill 向进程发送信号 0（信号 0 表示是否可以发送信号），但这似乎只有在您拥有将信号发送到的进程（或以其他方式拥有）时才有效发送信号的权限）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T18:40:34.997

我不能代表 JRuby，但在 Java 中，唯一的检查方法是检查您是否从 Java 启动了进程（在这种情况下，您将拥有一个可以使用的[Process](http://java.sun.com/javase/6/docs/api/index.html?java/lang/Process.html)实例）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T19:00:37.883

您可能需要仔细检查您正在使用的 JVM。但是如果你发送一个**SIGQUIT**信号 kill -3 我相信，（我手边没有终端）。这应该会生成一个 Javacore 文件，该文件将具有正在使用的线程的堆栈跟踪，检查该文件中的 JRuby 包。

它不应该终止或任何东西，但一如既往地小心发送信号。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-25T16:20:46.350

`jps`您可以使用java 安装附带的命令行工具。jps 列出了一个用户的所有 java 进程。

例如

```
>jps -l
5960 org.jruby.Main
2124 org.jruby.Main
5376 org.jruby.Main
4428 sun.tools.jps.Jps 
```

或者，如果您需要将结果放入脚本中，您可以使用 %x[..]：

```
>> result = %x[jps -l]
=> "5960 org.jruby.Main\n2264 sun.tools.jps.Jps\n2124 org.jruby.Main\n5376 org.jruby.Main\n"
>> p result
"5960 org.jruby.Main\n2264 sun.tools.jps.Jps\n2124 org.jruby.Main\n5376 org.jruby.Main\n"
=> nil 
```

# c# - C# 动态创建的 LinkBut ton 命令事件处理程序

> ID：141169
> 
> 赞同：3
> 
> 时间：2008-09-26T18:35:02.780
> 
> 标签：c#, asp.net, linkbutton

所以我在这里遇到了一个奇怪的情况......我有一个 System.Web.UI.WebControls.WebParts.EditorPart 类。它呈现一个“搜索”按钮，当您单击此按钮时，它的 clickHandler 方法会进行 DB 搜索，并为它返回的每一行动态创建一个 LinkBut​​ton，设置 CommandName 和 CommandArgument 属性并添加一个 CommandEventHandler 方法，然后添加 LinkBut​​ton 控件到页面。

问题是，当您单击 LinkBut​​ton 时，它的 CommandEventHandler 方法永远不会被调用，看起来页面只是返回到按下原始“搜索”按钮之前的位置。

我看到帖子说您需要在 OnLoad() 或其他一些早期方法中添加事件处理程序，但是直到用户告诉我们要搜索什么并点击“搜索”按钮之前，我的 LinkBut​​tons 甚至还没有创建。 .关于如何处理这个的任何想法？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T14:10:05.363

这是我最喜欢的把戏:)

我们的场景是首先渲染一个控件。然后使用来自用户的一些输入，呈现更多控件并让它们响应事件。

这里的关键是状态——你需要知道控件到达 PostBack 时的状态——所以我们使用 ViewState。那么问题就变成了先有鸡还是先有蛋的问题。ViewState 在调用之后才可用`LoadViewState()`，但您必须在调用之前创建控件才能正确触发事件。

诀窍是覆盖`LoadViewState()`，`SaveViewState()`因此我们可以控制事物。

*（请注意，下面的代码是粗略的，来自记忆，可能有问题）*

```
private string searchQuery = null;

private void SearchButton(object sender, EventArgs e)
{
    searchQuery = searchBox.Text;
    var results = DataLayer.PerformSearch(searchQuery);
    CreateLinkButtonControls(results);
}

// We save both the base state object, plus our query string.  Everything here must be serializable.
protected override object SaveViewState()
{
    object baseState = base.SaveViewState();
    return new object[] { baseState, searchQuery };
}

// The parameter to this method is the exact object we returned from SaveViewState().
protected override void LoadViewState(object savedState)
{
    object[] stateArray = (object[])savedState;

    searchQuery = stateArray[1] as string;

    // Re-run the query
    var results = DataLayer.PerformSearch(searchQuery);

    // Re-create the exact same control tree as at the point of SaveViewState above.  It must be the same otherwise things will break.
    CreateLinkButtonControls(results);

    // Very important - load the rest of the ViewState, including our controls above.
    base.LoadViewState(stateArray[0]);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T18:42:26.163

您需要在 onload 中重新添加动态创建的控件，以便它们可以在页面层次结构中并触发它们的事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-01-11T11:25:05.147

```
 LinkButton link= new LinkButton();
 link.Command +=new CommandEventHandler(LinkButton1_Command);

 protected void LinkButton1_Command(object sender, CommandEventArgs e)
{
    try
    {
        System.Threading.Thread.Sleep(300);
        if (e.CommandName == "link")
        {
           //////////
        }
    }
    catch
    {

    }
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-04-01T09:26:39.753

我刚刚想出的一个肮脏的技巧是创建与真实按钮具有相同 ID 的虚拟 LinkBut​​tons。因此，假设您要在 Pre_Render 创建一个 LinkBut​​ton“foo”（为时已晚），然后还要在 Page_Load 创建一个虚拟 foo：

```
 var link = new LinkButton();
        link.ID = "foo";
        link.Click += fooEventHandler;
        dummyButtons.Controls.Add(link); 
```

（其中“dummyButtons”只是页面上的一个 PlaceHolder，Visibility 设置为 false。）它很丑，但它有效。

# javascript - 如何检测小书签中的键盘修饰符？

> ID：141198
> 
> 赞同：7
> 
> 时间：2008-09-26T18:42:44.273
> 
> 标签：javascript, firefox, safari, keyboard, bookmarklet

有没有办法检测用户在执行 javascript 小书签时是否按住 shift 键（或其他修饰键）？

在我对 Safari 3.1 和 Firefox 3 的测试中，`window.event`始终未定义。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T18:48:47.723

如果您正在寻找一种在物理单击小书签时检测鼠标位置的方法，不，没有办法。由于小书签位于任何页面之外（该区域通常称为浏览器“chrome” - 这很令人困惑，因为现在有一个具有该名称的浏览器）因此无法检测到与 JavaScript 相关的事件。

话虽如此，如果您将其创建为 Firefox 扩展，那么您将可以访问事件信息、JavaScript 和键盘修饰符。但这似乎不是您要寻找的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:35:02.697

window.event 只是一个 IE。事件对象作为 firefox 和 safari 中的参数传递给事件侦听器。所以你可以在 IE 中分辨出来，但在任何其他流行的浏览器中都看不到。

# ruby-on-rails - 如何使用 ActiveRecord 最好地处理每个模型的数据库连接？

> ID：141201
> 
> 赞同：13
> 
> 时间：2008-09-26T18:43:17.457
> 
> 标签：ruby-on-rails, ruby, activerecord

我想要规范的方式来做到这一点。我的 Google 搜索不足。我有一个 ActiveRecord 模型，它应该映射到与应用程序的其余部分不同的数据库。我也想将新配置存储在 database.yml 文件中。

我知道应该调用建立连接，但不清楚在哪里。这是我到目前为止得到的，但它不起作用：

```
class Foo < ActiveRecord::Base
    establish_connection(('foo_' + ENV['RAILS_ENV']).intern)
end 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-27T10:06:55.643

此外，最好对使用不同数据库的模型进行子类化，例如：

```
class AnotherBase < ActiveRecord::Base
  self.abstract_class = true
  establish_connection "anotherbase_#{RAILS_ENV}"
end 
```

在你的模型中

```
class Foo < AnotherBase
end 
```

当您需要添加访问相同的另一个数据库的后续模型时，它很有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T19:05:01.990

呵呵。我是正确的！更干净：

```
class Foo < ActiveRecord::Base
    establish_connection "foo_#{ENV['RAILS_ENV']}"
end 
```

[pragedave.pragprog.com 上](http://pragdave.me/blog/2006/01/03/sharing-external-activerecord-connections/)的好帖子。

# c# - AppDomain 和当前目录

> ID：141202
> 
> 赞同：1
> 
> 时间：2008-09-26T18:43:26.427
> 
> 标签：c#, appdomain

我有一个使用 Environment.CurrentDirectory 的目录交换方法的类。代码看起来像这样：

```
 var str = Environment.CurrentDirectory;
 Environment.CurrentDirectory = Path.GetDirectoryName(pathToAssembly);
 var assembly = Assembly.Load(Path.GetFileNameWithoutExtension(pathToAssembly));
 Environment.CurrentDirectory = str; 
```

与我之前的文章一样，我们使用此目录切换方法来允许加载指定的程序集以及任何引用程序集以及非托管程序集。我遇到的问题是这个函数在两个单独的 AppDomain 中运行。在 AppDomain A（我创建的 AppDomain）中，代码工作正常。在 AppDomain B（默认 AppDomain）中，它会抛出 FileNotFoundException。对于这两个调用，我都试图加载相同的程序集。任何线索为什么会这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T20:04:00.350

这篇[文章](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/63653ce8-83a0-410c-8bc8-134e52129049/)建议您一旦加载主 AppDomain 就不能更改它的搜索路径 - 您必须在配置文件中设置它 - 并且有许多建议，尽管它们都归结为“你可以” t 在主 AppDomain 中执行此操作”。

# .net - 我什么时候需要 .NET 中的 SecureString？

> ID：141203
> 
> 赞同：185
> 
> 时间：2008-09-26T18:43:31.073
> 
> 标签：.net, security, encryption

我正在尝试了解 .NET 的 SecureString 的目的。来自 MSDN：

> System.String 类的实例是不可变的，并且在不再需要时，不能以编程方式安排垃圾回收；也就是说，实例在创建后是只读的，无法预测实例何时会从计算机内存中删除。因此，如果 String 对象包含密码、信用卡号或个人数据等敏感信息，则存在使用该信息后可能会泄露的风险，因为您的应用程序无法从计算机内存中删除数据。
> 
> SecureString 对象与 String 对象的相似之处在于它具有文本值。但是，SecureString 对象的值是自动加密的，可以修改，直到您的应用程序将其标记为只读，并且可以由您的应用程序或 .NET Framework 垃圾收集器从计算机内存中删除。
> 
> SecureString 实例的值在实例初始化或修改值时自动加密。您的应用程序可以通过调用 MakeReadOnly 方法使实例不可变并防止进一步修改。

自动加密是大回报吗？

为什么我不能说：

```
SecureString password = new SecureString("password"); 
```

代替

```
SecureString pass = new SecureString();
foreach (char c in "password".ToCharArray())
    pass.AppendChar(c); 
```

我缺少 SecureString 的哪个方面？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-09-26T19:20:38.990

当前使用的框架的某些部分[`SecureString`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)：

*   WPF 的[`System.Windows.Controls.PasswordBox`](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.passwordbox)控件在内部将密码保存为 SecureString（通过 公开为副本`PasswordBox::SecurePassword`）
*   该[`System.Diagnostics.ProcessStartInfo::Password`](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.password)物业是一个[`SecureString`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)
*   for 的构造函数[`X509Certificate2`](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate2)接受[`SecureString`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)密码

主要目的是减少攻击面，而不是消除攻击面。[`SecureStrings`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)被“固定”在 RAM 中，因此垃圾收集器不会移动它或复制它。它还确保纯文本不会被写入交换文件或核心转储中。加密更像是混淆，但不会阻止一个坚定的黑客，他们将能够找到用于加密和解密它的[对称密钥。](https://en.wikipedia.org/wiki/Symmetric-key_algorithm)

正如其他人所说，您必须[`SecureString`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)逐个字符地创建一个字符的原因是因为这样做的第一个明显缺陷是：您可能已经将秘密值作为纯字符串，那么有什么意义呢？

[`SecureString`](https://docs.microsoft.com/en-us/dotnet/api/system.security.securestring)s 是解决鸡和蛋问题的第一步，因此即使大多数当前场景需要将它们转换回常规字符串才能完全使用它们，它们在框架中的存在现在意味着在未来 - 至少到您的程序不必成为薄弱环节的程度。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-27T11:48:56.850

**编辑**：*不要使用 SecureString*

目前的指导方针现在说不应使用该类。详细信息可在此链接中找到：[https ://github.com/dotnet/platform-compat/blob/master/docs/DE0001.md](https://github.com/dotnet/platform-compat/blob/master/docs/DE0001.md)

来自文章：

# DE0001：不应使用 SecureString

## 动机

*   的目的[`SecureString`](https://docs.microsoft.com/dotnet/api/system.security.securestring)是避免将机密作为纯文本存储在进程内存中。
*   但是，即使在 Windows 上，[`SecureString`](https://docs.microsoft.com/dotnet/api/system.security.securestring)也不作为操作系统概念存在。
    *   它只是使纯文本的窗口更短；它并没有完全阻止它，因为 .NET 仍然必须将字符串转换为纯文本表示形式。
    *   好处是纯文本表示不会作为实例存在[`System.String`](https://docs.microsoft.com/dotnet/api/system.string)- 本机缓冲区的生命周期更短。
*   除了在 .NET Framework 上，数组的内容是未加密的。
    *   在 .NET Framework 中，内部 char 数组的内容是加密的。由于缺少 API 或密钥管理问题，.NET 并不支持所有环境中的加密。

## 推荐

不要[`SecureString`](https://docs.microsoft.com/dotnet/api/system.security.securestring)用于新代码。将代码移植到 .NET Core 时，请考虑数组的内容在内存中未加密。

处理凭据的一般方法是避免使用它们，而是依靠其他方式进行身份验证，例如证书或 Windows 身份验证。

**结束编辑：下面的原始摘要**

很多很棒的答案；这里是所讨论内容的简要概要。

Microsoft 已实现 SecureString 类，旨在为敏感信息（如信用卡、密码等）提供更好的安全性。它自动提供：

*   加密（在内存转储或页面缓存的情况下）
*   钉在记忆中
*   标记为只读的能力（以防止任何进一步的修改）
*   通过不允许传入常量字符串来安全构造

目前，SecureString 的使用受到限制，但预计未来会有更好的采用。

基于此信息，SecureString 的构造函数不应该只获取一个字符串并将其分割为 char 数组，因为将字符串拼写出来会破坏 SecureString 的目的。

附加信息：

*   来自 .NET Security 博客的[帖子](http://blogs.msdn.com/shawnfa/archive/2004/05/27/143254.aspx)与此处介绍的内容大致相同。
*   另一个[人](http://blogs.msdn.com/shawnfa/archive/2006/11/01/securestring-redux.aspx) 重新审视它并提到了一个可以转储 SecureString 内容的工具。

编辑：我发现很难选择最佳答案，因为很多信息都很好；太糟糕了，没有辅助答案选项。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2016-12-16T21:17:41.370

## 简答

> 为什么我不能说：
> 
> ```
> SecureString password = new SecureString("password"); 
> ```

因为现在你`password`在记忆中；无法擦除它 - 这正是**SecureString**的重点。

## 长答案

**SecureString**存在的原因是因为您在完成后无法使用**ZeroMemory**擦除敏感数据。它的存在是为了解决**由于**CLR 而存在的问题。

在常规的*本机*应用程序中，您会调用[`SecureZeroMemory`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa366877%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396)：

> 用零填充一块内存。

**注意**： SecureZeroMemory 与 相同`ZeroMemory`，[只是编译器不会对其进行优化。](https://blogs.msdn.microsoft.com/oldnewthing/20130529-00/?p=4223)

问题是您**不能**在.NET 内部调用`ZeroMemory`或调用。`SecureZeroMemory`而在 .NET 中，字符串是不可变的；你甚至不能像用其他语言那样*覆盖*字符串的内容：

```
//Wipe out the password
for (int i=0; i<password.Length; i++)
   password[i] = \0; 
```

所以，你可以做什么？我们如何在 .NET 中提供从内存中擦除密码或信用卡号的能力？

唯一可以做到的方法是将字符串放在某个*本机*内存块中，然后您**可以**在其中调用`ZeroMemory`. 本机内存对象，例如：

*   一个 BSTR
*   一个 HGLOBAL
*   CoTaskMem 非托管内存

## SecureString 恢复了失去的能力

在 .NET 中，字符串在完成后无法擦除：

*   它们是不可变的；你不能覆盖他们的内容
*   你不能`Dispose`对他们
*   他们的清理工作受垃圾收集器的支配

SecureString 存在作为传递字符串安全的一种方式，并且能够在需要时保证它们的清理。

你问了这个问题：

> 为什么我不能说：
> 
> ```
> SecureString password = new SecureString("password"); 
> ```

因为现在你`password`在记忆中；没有办法擦掉它。它一直停留在那里，直到 CLR 碰巧决定重新使用该内存。你让我们回到了起点；一个正在运行的应用程序，其密码我们无法摆脱，并且内存转储（或进程监视器）可以在其中看到密码。

SecureString 使用数据保护 API 将加密的字符串存储在内存中；这样，该字符串将不会存在于交换文件、故障转储中，甚至不会存在于本地变量窗口中，而同事正在查看您的内容。

## 我如何读取密码？

那么问题来了：我如何与字符串交互？你绝对**不**想要这样的方法：

```
String connectionString = secureConnectionString.ToString() 
```

因为现在你又回到了你开始的地方——一个你无法摆脱的密码。您想**强制**开发人员正确处理敏感字符串 - 以便*可以*将其从内存中擦除。

这就是为什么 .NET 提供了三个方便的辅助函数来将 SecureString 编组到非托管内存中：

*   [SecureStringToBSTR](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.securestringtobstr(v=vs.110).aspx) *（使用[ZeroFreeCoTaskMemUnicode](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.zerofreecotaskmemunicode(v=vs.110).aspx)释放）*
*   [SecureStringToCoTaskMemUnicode](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.securestringtocotaskmemunicode%28v=vs.110%29.aspx?f=255&MSPPError=-2147217396) *（用[ZeroFreeCoTaskMemUnicode](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.zerofreecotaskmemunicode(v=vs.110).aspx)释放）*
*   [SecureStringToGlobalAllocUnicode](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.securestringtoglobalallocunicode(v=vs.110).aspx) *（用[ZeroFreeGlobalAllocUnicode](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.zerofreeglobalallocunicode(v=vs.110).aspx)释放）*

您将字符串转换为非托管内存 blob，处理它，然后再次擦除它。

一些 API 接受**SecureStrings**。例如，在 ADO.net 4.5 中**SqlConnection.Credential**采用一组**SqlCredential**：

```
SqlCredential cred = new SqlCredential(userid, password); //password is SecureString
SqlConnection conn = new SqlConnection(connectionString);
conn.Credential = cred;
conn.Open(); 
```

您还可以在连接字符串中更改密码：

```
SqlConnection.ChangePassword(connectionString, cred, newPassword); 
```

.NET 中有很多地方出于兼容性目的继续接受纯字符串，然后迅速转身将其放入 SecureString。

## 如何将文本放入 SecureString？

这仍然留下了问题：

> 我如何首先将密码输入 SecureString？

这是挑战，但重点是让您考虑安全性。

有时已经为您提供了该功能。例如，WPF **PasswordBox**控件可以直接将输入的密码作为**SecureString**返回：

> ## [PasswordBox.SecurePassword 属性](https://msdn.microsoft.com/en-us/library/system.windows.controls.passwordbox.securepassword(v=vs.110).aspx)
> 
> 获取 PasswordBox 当前作为[SecureString保存的](https://msdn.microsoft.com/en-us/library/system.security.securestring(v=vs.110).aspx)[密码](https://msdn.microsoft.com/en-us/library/system.windows.controls.passwordbox(v=vs.110).aspx)。

这很有帮助，因为在您过去传递原始字符串的任何地方，您现在都有类型系统抱怨 SecureString 与 String 不兼容。在将 SecureString 转换回常规字符串之前，您希望尽可能长。

转换 SecureString 很简单：

*   SecureStringToBSTR
*   PtrToStringBSTR

如：

```
private static string CreateString(SecureString secureString)
{
    IntPtr intPtr = IntPtr.Zero;
    if (secureString == null || secureString.Length == 0)
    {
        return string.Empty;
    }
    string result;
    try
    {
        intPtr = Marshal.SecureStringToBSTR(secureString);
        result = Marshal.PtrToStringBSTR(intPtr);
    }
    finally
    {
        if (intPtr != IntPtr.Zero)
        {
            Marshal.ZeroFreeBSTR(intPtr);
        }
    }
    return result;
} 
```

他们只是真的不希望你这样做。

但是我如何将字符串放入 SecureString 中？那么你需要做的是首先停止在**字符串**中使用密码。你需要把它放在*别的*东西里。即使是`Char[]`数组也会有所帮助。

那时您可以附加每个字符**并**在完成后擦除明文：

```
for (int i=0; i < PasswordArray.Length; i++)
{
   password.AppendChar(PasswordArray[i]);
   PasswordArray[i] = (Char)0;
} 
```

您需要将密码存储在可以擦除的内存中**。**从那里将其加载到 SecureString 中。

* * *

tl;dr：**SecureString**的存在是为了提供**ZeroMemory**的等价物。

有些人看不到在[设备被锁定时从内存中擦除用户密码](https://www.apple.com/business/docs/iOS_Security_Guide.pdf)或[在验证后从内存中擦除击键的意义](https://ostif.org/the-veracrypt-audit-results/)。那些人不使用 SecureString。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-26T19:02:03.043

在当前版本的框架中，您可以明智地使用 SecureString 的场景非常少。它实际上只对与非托管 API 交互有用 - 您可以使用 Marshal.SecureStringToGlobalAllocUnicode 对其进行编组。

一旦您将它转换为 System.String 或从 System.String 转换，您就违背了它的目的。

MSDN[示例](http://msdn.microsoft.com/en-us/library/07b9wyhy.aspx)从控制台输入一次生成一个字符的 SecureString，并将安全字符串传递给非托管 API。这是相当复杂和不切实际的。

您可能期望 .NET 的未来版本对 SecureString 有更多支持，这将使其更有用，例如：

*   SecureString Console.ReadLineSecure() 或类似方法将控制台输入读取到 SecureString 中，而无需示例中的所有复杂代码。

*   WinForms TextBox 替换，将其 TextBox.Text 属性存储为安全字符串，以便可以安全地输入密码。

*   对与安全相关的 API 的扩展，以允许将密码作为 SecureString 传递。

如果没有上述内容，SecureString 的价值将有限。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-26T18:47:52.063

我相信您必须进行字符附加而不是一个平面实例化的原因是因为在后台将“密码”传递给 SecureString 的构造函数将“密码”字符串放入内存中，从而破坏了安全字符串的目的。

通过附加，您一次只将一个字符放入内存中，这很可能不会在物理上彼此相邻，这使得重建原始字符串变得更加困难。我在这里可能是错的，但这就是向我解释的方式。

该类的目的是防止安全数据通过内存转储或类似工具暴露。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-26T18:49:13.977

MS 发现，在某些导致服务器（台式机等）崩溃的情况下，有时运行时环境会进行内存转储，从而暴露内存中的内容。安全字符串在内存中对其进行加密，以防止攻击者能够检索到字符串的内容。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-26T18:55:32.217

SecureString 的一大好处是它应该避免由于页面缓存而将数据存储到磁盘的可能性。如果您在内存中有密码，然后加载大型程序或数据集，则您的密码可能会在您的程序被内存分页时写入交换文件。使用 SecureString，至少数据不会以明文形式无限期地保存在磁盘上。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-26T18:46:09.930

我想这是因为该字符串是安全的，即黑客不应该能够读取它。如果你用一个字符串初始化它，黑客就可以读取原始字符串。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T18:51:33.693

好吧，正如描述所述，该值是加密存储的，这意味着您的进程的内存转储不会显示字符串的值（没有一些相当严肃的工作）。

您不能仅从常量字符串构造 SecureString 的原因是因为您*将*在内存中拥有未加密版本的字符串。将您限制为分段创建字符串可以降低一次将整个字符串存储在内存中的风险。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-07-21T00:12:10.863

我会停止使用 SecureString 。看起来PG家伙正在放弃对它的支持。将来甚至可能拉它 - [https://github.com/dotnet/apireviews/tree/master/2015-07-14-securestring](https://github.com/dotnet/apireviews/tree/master/2015-07-14-securestring)。

> 我们应该在 .NET Core 的所有平台上从 SecureString 中删除加密 - 我们应该废弃 SecureString - 我们可能不应该在 .NET Core 中公开 SecureString

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-10-31T03:30:57.747

另一个用例是当您使用支付应用程序 (POS) 时，您根本*无法使用不可变数据结构*来存储敏感数据，因为您是细心的开发人员。例如：如果我将敏感的卡数据或授权元数据存储到不可变字符串中，那么总会出现这样的情况：这些数据在被丢弃后会在内存中保留相当长的时间。我不能简单地覆盖它。将此类敏感数据加密保存在内存中的另一个巨大优势。

# c# - 引发异常时确保关闭 SQL 连接的正确方法是什么？

> ID：141204
> 
> 赞同：18
> 
> 时间：2008-09-26T18:43:55.613
> 
> 标签：c#, .net, sql, sqlconnection

我经常使用看起来像这样的模式。我想知道这是否可以，或者是否有我没有在这里应用的最佳实践。

具体来说，我想知道；在引发异常的情况下，我在 finally 块中的代码是否足以确保连接正确关闭？

```
public class SomeDataClass : IDisposable
{
    private SqlConnection _conn;

    //constructors and methods

    private DoSomethingWithTheSqlConnection()
    {
        //some code excluded for brevity

        try
        {
            using (SqlCommand cmd = new SqlCommand(SqlQuery.CountSomething, _SqlConnection))
            {
                _SqlConnection.Open();
                countOfSomething = Convert.ToInt32(cmd.ExecuteScalar());
            }
        }
        finally
        {
            //is this the best way?
            if (_SqlConnection.State == ConnectionState.Closed)
                _SqlConnection.Close();
        }

        //some code excluded for brevity
    }

    public Dispose()
    {
        _conn.Dispose();
    }
} 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-26T18:46:37.603

将您的数据库处理代码包装在“使用”中

```
using (SqlConnection conn = new SqlConnection (...))
{
    // Whatever happens in here, the connection is 
    // disposed of (closed) at the end.
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T18:55:01.047

.Net Framework 维护一个连接池是有原因的。相信它！:) 您不必为了连接数据库并释放连接而编写这么多代码。

您可以只使用“使用”语句并放心“IDBConnection.Release()”将为您关闭连接。

高度复杂的“解决方案”往往会导致代码错误。简单更好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T18:55:57.940

[MSDN Docs](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.close.aspx)清楚地说明了这一点......

*   Close 方法回滚任何挂起的事务。然后它释放到连接池的连接，或者如果连接池被禁用，则关闭连接。

您可能没有（也不想）禁用连接池，因此池最终会在您调用“关闭”后管理连接的状态。这可能很重要，因为您可能会从数据库服务器端查看所有打开的连接时感到困惑。

* * *

*   一个应用程序可以多次调用 Close。不会产生异常。

那么，为什么还要为 Closed 进行测试呢？只需调用 Close()。

* * *

*   Close 和 Dispose 在功能上是等效的。

这就是为什么*using*块导致关闭连接的原因。 *使用*调用 Dispose 为您服务。

* * *

*   不要在类的 Finalize 方法中对 Connection、DataReader 或任何其他托管对象调用 Close 或 Dispose。

重要的安全提示。谢谢，埃贡。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T18:49:52.993

我猜`_SqlConnection.State == ConnectionState.Closed`你的意思是`!=`

这肯定会奏效。我认为将连接对象本身包含在 using 语句中更为习惯，但是如果您出于某种原因想要重用相同的连接对象，那么您所拥有的就很好。

但是，您绝对应该改变的一件事是`Dispose()`方法。您不应该在 dispose 中引用连接对象，因为它可能已经在此时完成。您应该改为遵循推荐的 Dispose 模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T18:46:46.230

因为您无论如何都在使用 IDisposables。可以使用'using'关键字，基本上相当于在finally块中调用dispose，但看起来更好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T18:52:21.863

像您展示的那样，将连接关闭代码放在“Finally”块中。finally 块在抛出异常之前执行。使用“使用”块同样有效，但我发现明确的“最终”方法更清晰。

使用语句对许多开发人员来说是老生常谈，但年轻的开发人员可能不知道这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T19:02:03.277

请参阅此问题以获取答案：

[Close and Dispose - 调用哪个？](https://stackoverflow.com/questions/61092/close-and-dispose-which-to-call#61131)

如果您的连接生命周期是单个方法调用，请使用该`using`语言的特性来确保正确清理连接。虽然一个`try/finally`块在功能上是相同的，但它需要更多的代码并且 IMO 的可读性较差。无需检查连接状态，您可以调用`Dispose`，它会处理清理连接。

如果您的连接生命周期对应于包含类的生命周期，则`IDisposable`在`Dispose`.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-05T22:17:00.283

不需要尝试..最后围绕“使用”，使用**是**尝试..最后

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-09-26T18:51:39.323

我可以建议这个：

```
 class SqlOpener : IDisposable
    {
        SqlConnection _connection;

        public SqlOpener(SqlConnection connection)
        {
            _connection = connection;
            _connection.Open();

        }

        void IDisposable.Dispose()
        {
            _connection.Close();
        }
    }

    public class SomeDataClass : IDisposable
    {
        private SqlConnection _conn;

        //constructors and methods

        private void DoSomethingWithTheSqlConnection()
        {
            //some code excluded for brevity
            using (SqlCommand cmd = new SqlCommand("some sql query", _conn))
            using(new SqlOpener(_conn))
            {
                int countOfSomething = Convert.ToInt32(cmd.ExecuteScalar());
            }
            //some code excluded for brevity
        }

        public void Dispose()
        {
            _conn.Dispose();
        }
    } 
```

希望有帮助:)

# asp.net - 如何使用 ASP.Net Ajax $addHandler 将参数传递给被调用函数

> ID：141207
> 
> 赞同：1
> 
> 时间：2008-09-26T18:44:43.910
> 
> 标签：asp.net, javascript, ajax

我正在尝试使用 $addHandler 函数将处理程序添加到文本框的单击事件

```
var o=$get('myTextBox');
var f = Type.parse('funcWithArgs');
$addHandler(o, 'click', f); 
```

但是我需要将参数传递给被调用的函数。你是怎样做的？

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T18:46:37.790

用匿名函数（又名 lambda）包装你的函数：

```
$addHandler(o, 'click', function() { f(my, arguments, go, here); }); 
```

* * *

### 替代解决方案：

如果你有一个创建部分的函数，你也可以这样做——我使用了一个为此提供的工具包，这就是它的完成方式：

```
$addHandler(o, 'click', partial(f, my, arguments, go, here)); 
```

我不知道（并且实际上怀疑）Microsoft 的框架为此提供了，但您可以考虑编写自己的`partial`函数。

# .net - 如何在 .NET 中使用 LinkLabels 的 ArrayList 进行 LinkClicked 事件

> ID：141212
> 
> 赞同：1
> 
> 时间：2008-09-26T18:46:01.863
> 
> 标签：.net, visual-studio-2005, arraylist, linklabel

我正在制作一个表格，该表格将显示打开不同类型报告的链接。这个系统有不同类型的用户，所以用户应该只能看到他们可以访问的报告类型的链接。

目前，我进行此设置的方式是我有一个 LinkLabels 的 ArrayList，但我遇到的问题是如何为 ArrayList 中的每个 LinkLabel 设置一个 LinkClicked 事件，以便它会显示一个特定于每个报告的表单.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T18:50:19.280

实际上，我会为所有链接标签创建一个事件处理程序，（在 ArrayList 的数据绑定过程中添加处理程序）以及要在 LinkLabel 的 CommandName 标签中加载的报告的名称。当事件处理程序触发时，您将检查 CommandName 属性并触发适当的功能以加载给定的报告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:06:31.597

您可以将相同的事件处理程序应用于列表中的每个 LinkLabel，并从 sender 参数中获取特定的 LinkLabel。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:00:41.500

绝对建议为所有动态 LinkLabel 实例使用单个事件处理程序。

我通常使用 Hashtable，其中键是 LinkLabel 实例，值是将在单击事件中使用的内容（例如报告实例，如果合适的话）。

然后在您使用的点击事件中（例如）

```
Report r = m_TheTable[sender] as Report;
if( r != null ) r.DoSomething(); 
```

# database - 多少数据库索引太多了？

> ID：141232
> 
> 赞同：120
> 
> 时间：2008-09-26T18:50:13.680
> 
> 标签：database, oracle, database-design

我正在开发一个具有相当大的 Oracle 数据库的项目（尽管我的问题同样适用于其他数据库）。我们有一个网络界面，允许用户搜索几乎任何可能的字段组合。

为了使这些搜索快速进行，我们正在为我们认为用户通常会搜索的字段和字段组合添加索引。但是，由于我们并不真正知道我们的客户将如何使用该软件，因此很难判断要创建哪些索引。

空间不是问题；我们有一个 4 TB 的 RAID 驱动器，我们只使用了其中的一小部分。但是，我担心索引过多可能会导致性能下降。因为每次添加、删除或修改行时都需要更新这些索引，所以我想在一个表上拥有数十个索引是个坏主意。

那么有多少索引被认为是太多了？10？25？50？还是我应该只涵盖真正、非常常见和明显的案例而忽略其他所有内容？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-09-26T18:52:53.643

这取决于表上发生的操作。

如果有很多 SELECT 并且更改很少，请索引所有你喜欢的......这些将（可能）加快 SELECT 语句的速度。

如果表受到 UPDATEs、INSERTs + DELETEs 的严重影响......这些会非常慢，因为有很多索引，因为每次发生这些操作之一时都需要修改它们

话虽如此，您可以清楚地向一个不会做任何事情的表添加许多无意义的索引。将 B-Tree 索引添加到具有 2 个不同值的列将毫无意义，因为它不会在查找数据方面添加任何内容。列中的值越独特，它就越能从索引中受益。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-09-26T18:58:28.450

我通常是这样进行的。

1.  获取典型一天对数据运行的*真实*查询的日志。
2.  添加索引，以便最重要的查询命中其执行计划中的索引。
3.  尽量避免索引具有大量更新或插入的字段
4.  在几个索引之后，获取一个新的日志并重复。

与所有任何优化一样，当达到请求的性能时我会停止（这显然意味着点 0\. 将获得特定的性能要求）。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-26T21:41:10.773

其他人一直在给你很好的建议。在你前进的过程中，我有一个额外的建议给你。在某些时候，您必须决定您的最佳索引策略。但最终，最好的 PLANNED 索引策略最终仍然会创建最终不会被使用的索引。让您找到未使用的索引的一种策略是监视索引使用情况。你这样做如下： -

```
alter index my_index_name monitoring usage; 
```

然后，您可以通过查询 v$object_usage 来监控该索引是否被使用。可以在[Oracle® Database Administrator's Guide](http://download.oracle.com/docs/cd/B19306_01/server.102/b14231/indexes.htm#sthref2563)中找到有关这方面的信息。

请记住，如果您有一个在更新表之前删除索引然后重新创建它们的仓储策略，您将不得不再次设置索引以进行监视，并且您将丢失该索引的任何监视历史记录。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-26T19:37:22.193

在数据仓库中，拥有大量索引是很常见的。我使用过具有 200 列和其中 190 列的事实表。

尽管这有开销，但必须在上下文中理解，在数据仓库中，我们通常只插入一次行，我们从不更新它，但它可以参与数千个 SELECT 查询，这些查询可能受益于任何列。

为了获得最大的灵活性，数据仓库通常使用单列位图索引，除了高基数列，可以使用（压缩）btree 索引。

索引维护的开销主要与写入大量块和块拆分的费用有关，因为新行添加了该列现有值范围“中间”的值。这可以通过分区和使新数据负载与分区方案保持一致以及使用直接路径插入来缓解。

为了更直接地解决您的问题，我认为首先索引显而易见的内容可能很好，但不要害怕添加更多索引来确定对表的查询是否会受益。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-26T18:56:33.757

在[爱因斯坦](http://en.wikiquote.org/wiki/Albert_Einstein)关于简单性的解释中，添加尽可能多的索引，而不是更多。

然而，说真的，只要将数据添加到表中，您添加的每个索引都需要维护。在主要是只读的表上，大量索引是一件好事。在高度动态的表上，越少越好。

我的建议是涵盖常见和明显的情况，然后当您遇到需要更快地从特定表中获取数据的问题时，评估并添加索引。

此外，每隔几个月重新评估您的索引方案是一个好主意，只是看看是否有任何新的需要索引或您创建的任何索引没有被用于任何事情并且应该被摆脱.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-08T08:19:07.803

除了其他人提出的观点之外，如果有更多索引，则基于成本的优化器在为 SQL 语句创建计划时会产生成本，因为要考虑的组合更多。您可以通过正确使用绑定变量来减少这种情况，以便 SQL 语句保留在 SQL 缓存中。然后，Oracle 可以进行软解析并重新使用它上次找到的计划。

一如既往，没有什么是简单的。如果涉及倾斜的列和直方图，那么这可能是一个坏主意。

在我们的网络应用程序中，我们倾向于限制我们允许的搜索组合。否则，您必须逐字逐句地测试每个组合的性能，以确保您没有某个人有一天会发现的潜在问题。我们还实施了资源限制，以防止出现问题时在应用程序的其他地方引起问题。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-02-08T00:51:56.347

我对我的真实项目和真实的 MySql 数据库做了一些简单的测试。我已经在这个主题中回答了：[索引多个 db 列的成本是多少？](https://stackoverflow.com/questions/418744/what-is-the-cost-of-indexing-multiple-db-columns/2219030#2219030)

但我认为如果我在这里引用它会更好：

> 我使用我的真实项目和真实的 MySql 数据库做了一些简单的测试。
> 
> 我的结果是：将平均索引（索引中的 1-3 列）添加到表中 - 使插入速度降低 2.1%。因此，如果您添加 20 个索引，您的插入速度会降低 40-50%。但是您的选择会快 10-100 倍。
> 
> 那么添加很多索引可以吗？- 这取决于:) 我给了你我的结果 - 你决定！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T18:54:11.843

最终，您需要多少索引取决于您在数据库服务器上运行的应用程序的行为。

一般来说，插入越多，索引就越痛苦。每次执行插入时，都必须更新包含该表的所有索引。

现在，如果您的应用程序有相当多的读取量，或者甚至更多，如果它几乎是所有读取量，那么索引就是要走的路，因为将以很少的成本实现重大的性能改进。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T18:57:19.217

我认为没有静态答案，这类事情属于“性能调整”。

可能是您的应用程序所做的一切都是通过主键查找的，或者可能是相反的，因为查询是在不受限制的字段组合上完成的，特别是任何一个都可以在任何给定时间使用。

除了索引之外，还有重新组织您的数据库以包括计算的搜索字段、拆分表等 - 它实际上取决于您的负载形状和查询参数，查询需要“真正”返回多少/什么数据。

如果您的整个数据库前面是存储过程门面，那么转向会变得更容易一些，因为您不必担心每个临时查询。或者您可能对将访问您的数据库的查询类型有深入的了解，并且可以将调整限制在这些查询范围内。

对于 SQL Server，我发现数据库引擎优化顾问很有用——您可以设置“典型”工作负载，它可以就添加/删除索引和统计信息提出建议。我确信其他数据库也有类似的工具，无论是“官方”还是第三方。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-26T18:58:23.287

这确实是一个比实际更理论的问题。索引对性能的影响取决于您拥有的硬件、Oracle 的版本、索引类型等。昨天我听说 Oracle 宣布了由 HP 制造的专用存储，它应该在 11g 数据库上运行速度提高 10 倍。至于您的情况，可以有几种解决方案： 1.拥有大量索引（> 20）并每天（每晚）重建它们。如果表每天有数千次更新/删除，这将特别有用。2\. 对您的表进行分区（如果这适用于您的数据模型）。3\. 为新的/更新的数据使用单独的表，并运行一个将数据组合在一起的每晚进程。这将需要更改您的应用程序逻辑。4\. 如果您的数据支持，切换到 IOT（索引组织表）。

当然，这种情况可能有更多的解决方案。我给你的第一个建议是将数据库克隆到开发环境，并对其进行一些压力测试。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T18:54:52.623

如果您主要阅读（并且很少更新），那么真的没有理由不索引您需要索引的所有内容。如果您经常更新，那么您可能需要谨慎对待您拥有的索引数量。没有硬性数字，但是当事情开始放缓时，您会注意到。确保您的聚集索引是基于数据最有意义的索引。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T18:55:57.223

您可能会考虑的一件事是构建索引以针对标准搜索组合。如果经常搜索 column1，并且经常将 column2 与它一起使用，并且 column3 有时与 column2 和 column1 一起使用，那么在 column1、column2 和 column3 上按该顺序排列的索引可以用于这三种情况中的任何一种，尽管它是只需要维护一个索引。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T19:02:59.780

更新基础表时，索引会产生成本。索引在用于加速查询时提供了好处。对于每个索引，您需要平衡成本与收益。如果没有索引，查询会慢多少？跑得更快有多大好处？当索引丢失时，您或您的用户能否容忍缓慢的速度？

您能容忍完成更新所需的额外时间吗？

您需要比较成本和收益。这对你的情况来说是特别的。没有超过“太多”阈值的索引数量。

还有存储索引所需的空间成本，但您已经说过在您的情况下这不是问题。在大多数情况下也是如此，因为磁盘空间变得如此便宜。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-26T18:55:36.770

有多少列？我一直被告知要制作单列索引，而不是多列索引。所以没有比列数更多的索引，恕我直言。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T18:56:33.260

真正归结为，不要添加索引，除非您知道（这通常意味着收集使用统计信息）它的使用频率将远远超过更新频率。

任何不符合该标准的索引都将花费您更多的重建成本，而不是在使用它的奇怪情况下不使用它的性能损失。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-02-16T17:59:45.500

Sql server 为您提供了一些很好的工具，可以让您查看实际使用了哪些索引。这篇文章[http://www.mssqltips.com/tip.asp?tip=1239](http://www.mssqltips.com/tip.asp?tip=1239)为您提供了一些查询，让您可以更好地了解索引的使用量，而不是更新量。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-09-26T12:27:00.160

它完全基于 Where 子句中使用的列。作为规则的拇指，我们必须在外键列上建立索引以避免死锁。AWR 报告应定期分析以了解索引的需求。

# java - java 是否有等效于 C#“使用”子句

> ID：141241
> 
> 赞同：25
> 
> 时间：2008-09-26T18:52:28.853
> 
> 标签：java, syntax

我在一些 C# 发布的问题中看到了对“使用”子句的引用。java有等价的吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-26T18:56:34.397

是的。Java 1.7 引入了[try-with-resources](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)结构，允许您编写：

```
try(InputStream is1 = new FileInputStream("/tmp/foo");
    InputStream is2 =  new FileInputStream("/tmp/bar")) {
         /* do stuff with is1 and is2 */
} 
```

...就像一个`using`声明。

不幸的是，在 Java 1.7 之前，Java 程序员被迫使用 try{ ... } finally { ... }。在 Java 1.6 中：

```
InputStream is1 = new FileInputStream("/tmp/foo");
try{

    InputStream is2 =  new FileInputStream("/tmp/bar");
    try{
         /* do stuff with is1 and is 2 */

    } finally {
        is2.close();
    }
} finally {
    is1.close();
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-09-21T10:03:45.957

是的，从 Java 7 开始，您可以重写：

```
InputStream is1 = new FileInputStream("/tmp/foo");
try{

    InputStream is2 =  new FileInputStream("/tmp/bar");
    try{
         /* do stuff with is1 and is2 */

    } finally {
        is2.close();
    }
} finally {
    is1.close();
} 
```

作为

```
try(InputStream is1 = new FileInputStream("/tmp/foo");
    InputStream is2 =  new FileInputStream("/tmp/bar")) {
         /* do stuff with is1 and is2 */
} 
```

作为参数传递给 try 语句的对象应该实现`java.lang.AutoCloseable`。看看[官方文档](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)。

对于较旧版本的 Java，请查看[此答案](https://stackoverflow.com/a/141267/1860591)和[此答案](https://stackoverflow.com/a/143690/1860591)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-27T14:10:42.157

语言中最接近的等价物是使用 try-finally。

```
using (InputStream in as FileInputStream("myfile")) {
    ... use in ...
} 
```

变成

```
final InputStream in = FileInputStream("myfile");
try {
    ... use in ...
} finally {
    in.close();
} 
```

请注意，一般形式始终是：

```
acquire;
try {
    use;
} finally {
    release;
} 
```

如果采集在try块内，采集失败则释放。在某些情况下，您可能可以使用不必要的代码（通常在上面的示例中测试 null），但在 ReentrantLock 的情况下，会发生坏事。

如果你经常做同样的事情，你可以使用“execute around”这个成语。不幸的是，Java 的语法很冗长，所以有很多 bolier 板。

```
fileInput("myfile", new FileInput<Void>() {
   public Void read(InputStream in) throws IOException {
       ... use in ...
       return null;
   }
}); 
```

在哪里

```
public static <T> T fileInput(FileInput<T> handler) throws IOException {
    final InputStream in = FileInputStream("myfile");
    try {
        handler.read(in);
    } finally {
        in.close();
    }
} 
```

更复杂的例子，例如，包装异常。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-10-05T08:50:48.023

这是一个很长的时间，但在 Java 7 中添加了[try-with-resources 语句](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)以及[AutoCloseable](http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html)接口。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T18:56:55.503

不是我知道的。您可以使用 try...finally 块进行一些模拟，但它仍然不完全相同。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T19:44:49.790

在 Java 中最接近的方法是 try/finally。此外，Java 不提供隐式 Disposable 类型。

**C#：在 using 块之外限定变量**

```
public class X : System.IDisposable {

    public void Dispose() {
        System.Console.WriteLine("dispose");
    }

    private static void Demo() {
        X x = new X();
        using(x) {
            int i = 1;
            i = i/0;
        }
    }

    public static void Main(System.String[] args) {
        try {
            Demo();
        } catch (System.DivideByZeroException) {}
    }

} 
```

**Java：将变量范围限定在块之外**

```
public class X {

    public void dispose() {
        System.out.println("dispose");
    }

    private static void demo() {
        X x = new X();
        try {
            int i = 1 / 0;
        } finally {
            x.dispose();
        }        
    }

    public static void main(String[] args) {
        try {
            demo();
        } catch(ArithmeticException e) {}
    }

} 
```

**C#：在块内确定变量的范围**

```
public class X : System.IDisposable {

    public void Dispose() {
        System.Console.WriteLine("dispose");
    }

    private static void Demo() {
        using(X x = new X()) {
            int i = 1;
            i = i/0;
        }
    }

    public static void Main(System.String[] args) {
        try {
            Demo();
        } catch (System.DivideByZeroException) {}
    }

} 
```

**Java：在块内确定变量的范围**

```
public class X {

    public void dispose() {
        System.out.println("dispose");
    }

    private static void demo() {
        {
            X x = new X();
            try {
                int i = 1 / 0;
            } finally {
                x.dispose();
            }
        }
    }

    public static void main(String[] args) {
        try {
            demo();
        } catch(ArithmeticException e) {}
    }

} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-26T19:02:46.940

我认为你可以实现类似于“使用”块的东西，实现一个匿名内部类。就像 Spring 对“Dao 模板”所做的那样。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-27T11:39:29.400

好吧，无论如何都使用语法糖，所以 Java 伙伴们，不要担心。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T13:12:15.403

如果我们在 Java 中获得 BGGA 闭包，这也将为 Java 中的类似结构打开。Gafter 在他的幻灯片中使用了这个例子，例如：

```
withLock(lock) { //closure } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-01T01:48:14.480

大多数程序员在第一个示例中使用的实际习惯用法是这样的：

```
InputStream is1 = null;
InputStream is2 = null;
try{
    is1 = new FileInputStream("/tmp/bar");
    is2 = new FileInputStream("/tmp/foo");

    /* do stuff with is1 and is 2 */

} finally {
    if (is1 != null) {
        is1.close();
    }
    if (is2 != null) {
        is2.close();
    }
} 
```

使用这个习惯用法的缩进更少，当你有超过 2 个资源需要清理时，这变得更加重要。

此外，您可以在结构中添加一个 catch 子句，以便在需要时处理新的 FileStream() 引发的异常。在第一个示例中，如果您想这样做，则必须有另一个封闭的 try/catch 块。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-09-26T18:59:09.117

不，没有。

你可以

```
public void func(){

  {
    ArrayList l  =  new ArrayList();
  }
  System.out.println("Hello");

} 
```

这为您提供了 using 子句的有限范围，但没有任何 IDisposable 接口来调用终结代码。您可以使用 try{}catch(){}Finally{}，但它没有使用的好处。顺便说一句，在 Java 中使用终结器通常是个坏主意。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-09-26T18:56:55.987

不，在 Java 中没有 using，最相似的功能是“import”关键字。

# c# - 套接字客户端类的异常与结果代码

> ID：141242
> 
> 赞同：2
> 
> 时间：2008-09-26T18:52:35.017
> 
> 标签：c#, .net, networking, sockets, tcp

我有一个封装与服务器的 tcp 套接字通信的类。对于发送到服务器的每条命令消息，服务器都会发回一个响应消息，该响应消息总是包含一个响应代码（OK，Fail）。使用我的课程，每个命令都可以同步或异步执行。

基本上可以发生两种类型的异常：由断开连接或其他不可恢复的错误引起的“故障”和“发送缓冲区已满”等意外异常。如果发生故障，在重新建立连接之前，任何命令都无法继续或重试或任何其他操作。在响应失败甚至异常的情况下，可以再次尝试该命令...

所以，现在我的同步命令方法返回一个可以具有以下值的枚举：OK、Fail、Fault。如果发生异常，则简单地将其引发到调用线程（在同步命令中）。对于异步命令，Result 属性枚举值可以包含一个额外的值：OK、Fail、Fault 或 Exception，并且回调可以通过命令对象的 Exception 属性访问实际的异常对象。

你怎么看这个策略？我很想根本不为同步命令引发异常，而只是在内部记录异常并返回第 4 个枚举值，因为这就是我在任何给定情况下真正对异常所做的一切......或者，我应该不使用结果代码，只是在所有情况下引发异常，甚至是错误？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T19:05:38.807

我认为你的策略基本上是合理的。

请记住，异常的目的是处理异常情况。越接近问题的根源越好。

在您的情况下，您的策略似乎类似于“它现在不起作用。让我们重试”。我认为没有理由真正引发异常。

如果处理关闭的套接字需要在您的代码中使用完全不同的流程，那么异常可能是有意义的。从你的描述来看，事实并非如此。

我关于异常的理念是，它们应该适用于您无法真正处理的异常情况。一个封闭的插座？嗯……我家的网络断了多少次……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:21:33.200

我的偏好是，只要您的方法没有成功完成其任务，您就会抛出异常。因此，如果我（调用者）调用 yourObject.UploadFile()，我将假定调用返回时文件已成功上传。如果由于任何原因失败，我希望您的对象会抛出异常。如果您想区分我可以重试的命令和我不应该重试的命令，请将这些信息放在异常中，我可以决定如何做出相应的反应。

调用 yourObject.BeginAsyncUploadFile() 时，我希望有相同的行为，除了我需要等待 IAsyncResult 或等效对象以查明文件上传是否成功，然后检查异常/错误属性是否成功没有。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:02:14.227

结果代码和异常都可以正常工作。这是个人品味（以及团队中其他人的品味）的问题。异常有一些优势，尤其是在更复杂的设置中，但在您的设置中，返回码应该可以正常工作，这听起来很简单。

有些人会口吐白沫并坚持例外，但在我的项目中，人们喜欢返回码的简单性，这使它们成为整体上更好的选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:05:46.200

这是一个相当有趣的问题。因此，可能没有“100% 正确”的答案，主要取决于您认为使用您的函数的代码应该如何结构化。

我看到的方式是，仅当您想提供调用您的函数的代码以优雅地摆脱“灾难性”情况时才使用异常。*所以，在我的代码中，当真正非常*可怕的事情发生并且调用者需要知道时，我通常会抛出异常。

现在，如果您所拥有的是正常且预期的情况，您可能应该返回一个错误值。这样代码就知道它需要“更努力地尝试”，但它不会受到所发生的事情的影响。

例如，在您的情况下，您可以将超时视为预期的事情，因此返回错误代码，以及更严重的问题（如完整的发送缓冲区），其中调用代码需要执行一些额外的操作才能恢复正常' 作为一个例外。

但是，美丽在旁观者的眼中，有些人会告诉你只使用异常，其他人（主要是 C 程序员）只使用返回码。请记住，异常应该**始终**是异常的。:)

# asp.net-ajax - 控制序列化 ASP.Net Ajax 对象上的属性名称

> ID：141244
> 
> 赞同：0
> 
> 时间：2008-09-26T18:53:09.537
> 
> 标签：asp.net-ajax

首先，我知道目前 ASP.Net 中内置了两种“类型”的 JSON 序列化：您可以使用 JavaScriptSerializer 类将对象序列化为 JSON，或者使用新的 DataContractJsonSerializer 类将对象转换为 JSON。

如果使用 JavaScriptSerializer() 方法，则必须将类标记为 Serializable() —— 如果使用 DataContractJsonSerializer 方法，则必须将类标记为 DataContract()，并将属性标记为 DataMembers()。

如果需要，您可以为每个 DataMembers 指定一个 NAME 属性，因此当属性被序列化/反序列化时，它会使用该名称。出于我的目的，我认为这有助于使 JSON 不那么“罗嗦”。例如，我不想将“UserID”声明为我的属性（并在我的 JSON 对象中重复使用它），而是简单地使用“u”。更少的数据传输等。

两个序列化引擎的渲染有点不同，您只能将 JavaScriptSerializer 与 ASP.Net Web/Script Methods 一起使用。这就是我的问题。

是否有一种等效的方法可以将属性名称设置为其他名称，严格用于使用常规 JavaScriptSerializer 进行序列化/反序列化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T23:17:52.710

不，没有。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T23:20:36.167

假设 UTF-8 你通过这种技术在网络上节省了 40 位，它不值得失去睡眠。

# matlab - MATLAB 环境调整

> ID：141247
> 
> 赞同：16
> 
> 时间：2008-09-26T18:54:23.280
> 
> 标签：matlab, development-environment, customization

您如何调整 MATLAB 环境以更好地满足您的需求？每个答案一个调整。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-15T13:12:23.513

我运行“格式紧凑”来删除所有那些在我的输出中间隔开的令人沮丧的空白行。哦，如此简单，但它对我来说更好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-08-25T17:08:10.980

我使用一个函数 idetitle() 可以改变 Matlab GUI 本身的窗口标题。在我运行多个 Matlab 进程的开发环境中很有用，可能在源代码或模型运行的不同分支上。有时我会将 PID 放在窗口标题中，以便在 Process Explorer 中轻松找到以监控资源使用情况。

```
function idetitle(Title)
%IDETITLE Set Window title of the Matlab IDE
%
% Examples:
% idetitle('Matlab - Foo model')
% idetitle(sprintf('Matlab - some big model - #%d', feature('getpid')))

win = appwin();
if ~isempty(win)
    win.setTitle(Title);
end

function out = appwin()
%APPWIN Get main application window

wins = java.awt.Window.getOwnerlessWindows();
for i = 1:numel(wins)
    if isa(wins(i), 'com.mathworks.mde.desk.MLMainFrame')
        out = wins(i);
        return
    end
end

out = []; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T19:23:30.823

我将 MATLAB 编辑器中的默认字体更改为 10 点 ProFont（可以在[此处](http://www.tobias-jung.de/seekingprofont/)获得），这样我就可以长时间编写代码而不会因为眼睛疲劳而让自己头疼。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-20T13:44:16.613

我使用选项运行 Matlab `-nodesktop -nojvm`。这样它就可以放在一个不碍事的终端中，我可以使用我最喜欢的文本编辑器来满足我的需求。

不过，您确实会错过一些杀手级功能。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-10-26T15:05:50.880

我使用[startup.m](http://blogs.mathworks.com/loren/2009/03/03/whats-in-your-startupm/)文件（位于本地 MATLAB 路径中）来确保在启动 MATLAB 时拥有所需的设置。这包括格式化 REPL 和绘图参数等。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T18:59:44.453

我将命令窗口滚动缓冲区中的行数设置为最大值（25,000）。这似乎不会显着影响性能，并允许我显示大量数据/结果。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T20:56:16.590

I set the Command Window output numeric format to **long g**.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-28T10:21:39.953

我实现了 xlim 和 ylim 的类似物：xlim_global([xmin xmax]) 和 ylim_global([ymin ymax])，它们为图中的每个子图设置了相同的轴限制。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-10-16T16:00:06.650

我反转颜色以获得黑色背景，更容易在眼睛上。

（Windows上的Alt+Shift+PrintScreen，你可以配置掉大图标）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-26T22:08:30.973

我为每个会话（可能每天有多个日记文件）写日记，以回忆所有执行的命令。这由一个 startup.m 文件控制，该文件检查当天以前的日记文件。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-28T10:17:16.843

我具有以下功能：1）在屏幕上保存当前图形位置和大小，以及 2）和一个加载此类配置的功能。它非常有用，例如在监控大量数据的模拟时。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-27T03:34:47.867

[我编写了一个名为fig.m](http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=11236&objectType=FILE)的小函数来调用带有名称而不是数字的图形窗口，并在状态栏中显示名称。

有趣的是，有两个或三个同名文件在文件交换中执行完全相同的操作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-01-22T08:51:43.070

1.  运行时间长时将输出发送到您的电子邮件 esp [http://www.mathworks.com/matlabcentral/fileexchange/29183-sending-reports-and-timestamped-file-by-email](http://www.mathworks.com/matlabcentral/fileexchange/29183-sending-reports-and-timestamped-file-by-emailing)

2.  创建用于存档和发送的结果收集器 [http://www.mathworks.com/matlabcentral/fileexchange/29255-track-collect-and-tar-inputs-and-outputs](http://www.mathworks.com/matlabcentral/fileexchange/29255-track-collect-and-tar-inputs-and-outputs)

3.  以正确顺序排列目录中文件的补丁 [http://www.mathworks.com/matlabcentral/fileexchange/29033-file-ordering-patch-utility-for-matlab](http://www.mathworks.com/matlabcentral/fileexchange/29033-file-ordering-patch-utility-for-matlab)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-22T08:44:16.643

我设置了快捷方式

1.  打开当前目录
2.  最多 1 个文件夹
3.  一个动作做'关闭所有; 清除所有；cl;'

参考： http: [//www.mathworks.com/matlabcentral/fileexchange/19097-custom-panzoom-icons](http://www.mathworks.com/matlabcentral/fileexchange/19097-custom-panzoom-icons)

# java - 在 struts2 VelocityResult 类中抑制 ClientAbortException

> ID：141248
> 
> 赞同：2
> 
> 时间：2008-09-26T18:54:28.957
> 
> 标签：java, struts2

我在我的日志文件中得到以下堆栈跟踪，并且想要禁止在日志中显示这个错误：

> 错误 08-09-26 14:48:45.141 http-80-215 org.apache.struts2.dispatcher.VelocityResult: 无法渲染速度模板，'/jsondata.vm' ClientAbortException: java.net.SocketException: Broken pipe

我了解导致错误的原因，并且在此特定用例中并不是真正的例外；我只想禁止在日志文件中显示 ClientAbortException，而是显示调试级别消息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-18T18:20:35.323

作为一种解决方法，您可以将类的日志级别设置`org.apache.struts2.dispatcher.VelocityResult`为`fatal`.

# web-services - 无状态 EJB 问题

> ID：141249
> 
> 赞同：0
> 
> 时间：2008-09-26T18:54:30.220
> 
> 标签：web-services, ejb

我们有一个位于 Web 服务 (EJB3) 后面的无状态 EJB，该 EJB 还加载了一个 EntityManager，该 EntityManager 在它发出的调用中传递。我有一个问题。

对 web 服务的同时调用是使用相同的 EJB 还是有不同的实例？我特别问这个关于注入的 EntityManager 的使用。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T19:12:52.610

取决于应用服务器使用相同或不同。你可能会认为它们是不同的。

现在，如果您要注入它，我假设您已将其声明为实例变量，这对于无状态 EJB 来说是一个非常糟糕的主意，因为好吧。它不应该有状态。

与其注入 EntityManager，不如让应用服务器完成其工作，而您只需从上下文中获取它。来自无状态的每个方法调用都属于一个事务，不会干扰其他调用。

总结：假设它们是不同的实例，并且不要将这些对象注入你自己。从应用服务器负责离开它们的上下文中获取它们。

我希望我能正确理解你的问题。

# url - 复制或删除时指向相同地址的 Windows .url 链接

> ID：141251
> 
> 赞同：2
> 
> 时间：2008-09-26T18:54:37.927
> 
> 标签：url, installation, hyperlink, software-distribution

这真的很烦人，我们已经将我们的客户端下载页面切换到不同的站点，并希望使用我们的安装程序发送一个链接。创建链接并覆盖现有文件时，Windows XP 中的元数据仍指向同一位置，即使 .url 的内容显示正确的地址。我可以将该 URL 属性更改为 google.com，当我复制文件时它指向同一个位置。

```
[互联网快捷方式]
URL=https://www.xxxx.com/?goto=clientlogon.php  
ID列表=
热键=0

```

如果我们重命名链接 .url 文件，它会起作用。但是我们希望该目录将被重用，这将导致一个坏链接和一个好链接，这比它更酷更令人困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-27T18:44:11.033

看看这里：[http ://www.cyanwerks.com/file-format-url.html](http://www.cyanwerks.com/file-format-url.html)

它解释了您可以添加到 .url 文件的 Modified 字段。它还解释了如何解释它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-27T18:42:45.310

.URL 文件很奇怪（它们是否记录在任何地方？）

我的看起来像这样，我似乎没有这个问题（可能是因为修改了条目？）

```
[DEFAULT]
BASEURL=http://www.xxxx.com/Help
[InternetShortcut]
URL=http://www.xxxx.com/Help
Modified=60D0EDADF1CAC5014B 
```

# hex - 有人可以向我解释十六进制偏移吗？

> ID：141262
> 
> 赞同：24
> 
> 时间：2008-09-26T18:56:00.797
> 
> 标签：hex, hex-editors

我下载了 Hex Workshop，并被告知要读取 .dbc 文件。

> 如果您读取偏移量 0x04 和 0x05，它应该包含 28,315

我不确定该怎么做？0x04 是什么意思？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T18:57:49.557

0x04 是 4 的十六进制（0x 只是数字的基数 16 表示的常见前缀约定 - 因为许多人认为是十进制），这将是第四个字节（因为他们说偏移，他们可能将第一个字节计为字节 0，因此偏移量 0x04 将是第 5 个字节）。

我猜他们是说第 4 和第 5 个字节加起来是 28315，但是他们说这是小端还是大端？

28315（十进制）在十六进制表示法中是 0x6E9B，如果它是 little-endian，则可能在文件中按 0x9B 0x6E 的顺序排列。

注意：little-endian 和 big-endian 是指字节写入的顺序。人类通常以大端方式编写十进制表示法和十六进制，因此：

256 将被写为 0x0100 （左边的数字是最大的比例）

但这需要两个字节，小端系统将首先写入低字节：0x00 0x01。Big-endian 系统会先写入高字节：0x01 0x00。

通常，英特尔系统是小端的，其他系统各不相同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T19:00:45.167

将二进制文件视为字节的线性数组。

0x04 将是数组中的第 5 个（在基于 0 的数组中）元素，而 0x05 将是第 6 个。

0x04 和 0x05 中的两个值可以通过“或”运算得到数字 28,315。

由于您正在读取的值是 16 位，因此您需要移动一个值，然后将它们 OR 在一起，即如果您在 c# 中操作文件，您将使用如下内容：

```
int value = (ByteArray[4] >> 8) | ByteArray[5]); 
```

希望这有助于解释十六进制地址的工作原理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T18:58:48.853

这是您查看的第 4 个和第 5 个 XX 代码...

```
1 2 3 4 5 6
01 AB 11 7B FF 5A

```

所以，0x04 和 0x05 是“7B”和“FF”。

假设你在说什么，在你的情况下 7BFF 应该等于你想要的值。

高温高压

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T18:58:47.467

十六进制的 0x04 是十进制的 4。十六进制的 0x10 是十进制的 16。`calc.exe`可以为您在十六进制和十进制之间转换。

偏移量 4 表示距离文件开头的 4 个字节。偏移量 0 是文件中的第一个字节。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T18:59:17.323

查看第 4 和第 5 个字节，它们的值应为 0x6E 0x9B（或 0x9B 0x6E），具体取决于您的字节序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T18:58:05.907

[从这里](http://en.wikipedia.org/wiki/Hexadecimal)开始。一旦您学会了如何读取十六进制值，您将能够更好地实际解决您的问题。

# sql - 子查询与连接

> ID：141278
> 
> 赞同：162
> 
> 时间：2008-09-26T18:58:53.517
> 
> 标签：sql, mysql, performance, database-design, join

我重构了我们从另一家公司继承的应用程序的慢速部分，以使用内部联接而不是子查询，例如：

```
WHERE id IN (SELECT id FROM ...) 
```

**重构后的查询运行速度提高了大约 100 倍。**（约 50 秒到约 0.3 秒）我预计会有所改善，但谁能解释为什么它如此激烈？where 子句中使用的列都已编入索引。SQL 是否每行执行一次 where 子句中的查询？

**更新**- 解释结果：

不同之处在于“where id in ()”查询的第二部分 -

```
2   DEPENDENT SUBQUERY  submission_tags ref st_tag_id   st_tag_id   4   const   2966    Using where 
```

vs 1 个带有连接的索引行：

```
 SIMPLE  s   eq_ref  PRIMARY PRIMARY 4   newsladder_production.st.submission_id  1   Using index 
```

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-09-26T19:03:42.213

“相关子查询”（即 where 条件取决于从包含查询的行获得的值的查询）将为每一行执行一次。一个不相关的子查询（其中 where 条件独立于包含的查询）将在开始时执行一次。SQL 引擎会自动进行这种区分。

但是，是的，解释计划会给你一些肮脏的细节。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-09-26T19:01:12.123

您**为每一行运行一次**子查询，而连接发生在索引上。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-28T07:19:08.910

这是一个如何[在 MySQL 6.0 中评估子查询](http://datacharmer.blogspot.com/2008/09/drizzling-mysql.html)的示例。

新的优化器会将这种子查询转换为连接。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T19:00:10.207

在每个版本上运行解释计划，它会告诉你原因。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-26T19:06:24.437

在针对数据集运行查询之前，它们通过查询优化器，优化器尝试以一种可以尽快从结果集中删除尽可能多的元组（行）的方式来组织查询。通常，当您使用子查询（尤其是坏的子查询）时，在外部查询开始运行之前，无法从结果集中删除元组。

如果没有看到查询，很难说原始查询有什么不好，但我的猜测是优化器无法做得更好。运行“解释”将向您展示用于检索数据的优化器方法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T19:01:05.917

查看每个查询的查询计划。

*Where in*和*Join***通常**可以使用相同的执行计划来实现，因此**通常**它们之间的更改速度为零。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T19:01:34.293

优化器做得不是很好。通常它们可以毫无区别地进行转换，优化器可以做到这一点。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-26T19:03:02.090

通常它的结果是优化器无法确定子查询可以作为连接执行，在这种情况下，它为表中的每条记录执行子查询，而不是将子查询中的表与您正在查询的表连接起来。一些更“企业”的数据库在这方面做得更好，但有时他们仍然会错过它。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T19:05:45.390

这个问题有点笼统，所以这里有一个笼统的答案：

基本上，当 MySQL 有大量行要排序时，查询需要更长的时间。

做这个：

对每个查询（JOIN'ed 查询，然后是 Subqueried 查询）运行 EXPLAIN，然后在此处发布结果。

我认为看到 MySQL 对这些查询的解释的差异对每个人来说都是一次学习经历。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-26T19:18:32.677

where 子查询必须为每个返回的行运行 1 个查询。内连接只需要运行 1 个查询。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-26T19:02:58.733

子查询可能正在执行“全表扫描”。换句话说，不使用索引并返回主查询中的 Where 需要过滤掉的太多行。

当然只是一个没有细节的猜测，但这是常见的情况。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T19:02:04.790

使用子查询，您必须为每个结果重新执行第二个 SELECT，并且每次执行通常返回 1 行。

通过连接，第二个 SELECT 返回更多行，但您只需执行一次。优点是现在您可以加入结果，而加入关系是数据库应该擅长的。例如，也许优化器现在可以发现如何更好地利用索引。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T19:02:52.057

它与其说是子查询不如说是 IN 子句，尽管连接至少是 Oracle 的 SQL 引擎的基础并且运行得非常快。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-09-20T13:34:42.480

取自参考手册（[14.2.10.11 将子查询重写为连接](http://dev.mysql.com/doc/refman/5.7/en/rewriting-subqueries.html)）：

> LEFT [OUTER] JOIN 可以比等效的子查询更快，因为服务器可能能够更好地优化它——这一事实并非仅针对 MySQL 服务器。

所以子查询可能比 LEFT [OUTER] JOINS 慢。

# javascript - 在 JavaScript 中计算关键字的最佳方法是什么？

> ID：141280
> 
> 赞同：2
> 
> 时间：2008-09-26T18:59:15.017
> 
> 标签：javascript, regex, arrays, string

在 JavaScript 中计算关键字的最佳和最有效的方法是什么？基本上，我想取一个字符串，得到字符串中出现的前N个单词或短语，主要是为了提示标签的使用。我正在寻找更多的概念提示或现实生活示例的链接，而不是实际代码，但我当然不介意您是否也想共享代码。如果有特定的功能会有所帮助，我也将不胜感激。

现在我想我正在使用 split() 函数用空格分隔字符串，然后用正则表达式清除标点符号。我也希望它不区分大小写。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T19:05:59.397

一旦你清理了一系列单词，假设你称之为`wordArray`：

```
var keywordRegistry = {};

for(var i = 0; i < wordArray.length; i++) {
   if(keywordRegistry.hasOwnProperty(wordArray[i]) == false) {
      keywordRegistry[wordArray[i]] = 0;
   }
   keywordRegistry[wordArray[i]] = keywordRegistry[wordArray[i]] + 1;
}

// now keywordRegistry will have, as properties, all of the 
// words in your word array with their respective counts 

// this will alert (choose something better than alert) all words and their counts
for(var keyword in keywordRegistry) {
  alert("The keyword '" + keyword + "' occurred " + keywordRegistry[keyword] + " times");
} 
```

这应该为您提供完成这部分工作的基础知识。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T19:15:35.227

剪切、粘贴 + 执行演示：

```
var text = "Text to be examined to determine which n words are used the most";

// Find 'em!
var wordRegExp = /\w+(?:'\w{1,2})?/g;
var words = {};
var matches;
while ((matches = wordRegExp.exec(text)) != null)
{
    var word = matches[0].toLowerCase();
    if (typeof words[word] == "undefined")
    {
        words[word] = 1;
    }
    else
    {
        words[word]++;
    }
}

// Sort 'em!
var wordList = [];
for (var word in words)
{
    if (words.hasOwnProperty(word))
    {
        wordList.push([word, words[word]]);
    }
}
wordList.sort(function(a, b) { return b[1] - a[1]; });

// Come back any time, straaanger!
var n = 10;
var message = ["The top " + n + " words are:"];
for (var i = 0; i < n; i++)
{
    message.push(wordList[i][0] + " - " + wordList[i][1] + " occurance" +
                 (wordList[i][1] == 1 ? "" : "s"));
}
alert(message.join("\n")); 
```

可重复使用的功能：

```
function getTopNWords(text, n)
{
    var wordRegExp = /\w+(?:'\w{1,2})?/g;
    var words = {};
    var matches;
    while ((matches = wordRegExp.exec(text)) != null)
    {
        var word = matches[0].toLowerCase();
        if (typeof words[word] == "undefined")
        {
            words[word] = 1;
        }
        else
        {
            words[word]++;
        }
    }

    var wordList = [];
    for (var word in words)
    {
        if (words.hasOwnProperty(word))
        {
            wordList.push([word, words[word]]);
        }
    }
    wordList.sort(function(a, b) { return b[1] - a[1]; });

    var topWords = [];
    for (var i = 0; i < n; i++)
    {
        topWords.push(wordList[i][0]);
    }
    return topWords;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T19:04:00.963

尝试将字符串拆分为单词并计算结果单词，然后对计数进行排序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:55:24.783

这建立在*insin*先前的答案之上，只有一个循环：

```
function top_words(text, n) {
    // Split text on non word characters
    var words = text.toLowerCase().split(/\W+/)
    var positions = new Array()
    var word_counts = new Array()
    for (var i=0; i<words.length; i++) {
        var word = words[i]
        if (!word) {
            continue
        }

        if (typeof positions[word] == 'undefined') {
            positions[word] = word_counts.length
            word_counts.push([word, 1])
        } else {
            word_counts[positions[word]][1]++
        }
    }
    // Put most frequent words at the beginning.
    word_counts.sort(function (a, b) {return b[1] - a[1]})
    // Return the first n items
    return word_counts.slice(0, n)
}

// Let's see if it works.
var text = "Words in here are repeated. Are repeated, repeated!"
alert(top_words(text, 3)) 
```

该示例的结果是：`[['repeated',3], ['are',2], ['words', 1]]`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-26T19:21:55.273

我会完全按照您上面提到的方法来隔离每个单词。然后我可能会将每个单词添加为数组的索引，并将出现次数作为值。

例如：

```
var a = new Array;
a[word] = a[word]?a[word]+1:1; 
```

现在您知道有多少个唯一单词（a.length）以及每个单词出现了多少次（a[word]）。

# java - Java中Runnable和Callable接口的区别

> ID：141284
> 
> 赞同：536
> 
> 时间：2008-09-26T19:00:37.883
> 
> 标签：java, multithreading, interface, runnable, callable

`Runnable`在 Java 中设计并发线程时使用和接口有什么区别`Callable`，为什么要选择一个而不是另一个？

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2008-09-26T19:02:17.363

请参阅[此处](http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html)的说明。

> Callable 接口与 Runnable 类似，两者都是为实例可能由另一个线程执行的类设计的。**但是，Runnable 不返回结果，也不能抛出检查异常。**

* * *

## 回答 #2

> 赞同：295
> 
> 时间：2010-10-17T06:44:49.880

> `Runnable`和的应用有什么区别`Callable`。差异仅与中存在的返回参数不同`Callable`吗？

基本上，是的。[请参阅此问题](https://stackoverflow.com/questions/141284/the-difference-between-the-runnable-and-callable-interfaces-in-java)的答案。和[用于`Callable`](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html).

> 如果`Callable`可以做到所有这些，那么需要两者兼有`Runnable`吗？

因为`Runnable`界面**不能**做所有事情`Callable`！

`Runnable`自 Java 1.0 以来一直存在，但`Callable`仅在 Java 1.5 中引入......用于处理`Runnable`不支持的用例。理论上，Java 团队可以更改`Runnable.run()`方法的签名，但这会破坏与 1.5 之前代码的二进制兼容性，在将旧 Java 代码迁移到新 JVM 时需要重新编码。这是一个很大的禁忌。Java 力求向后兼容……这是 Java 在商业计算方面的最大卖点之一。

而且，显然，有些用例不需要任务*返回*结果或抛出检查异常。对于这些用例， using`Runnable`比使用`Callable<Void>`并从方法返回一个虚拟 ( `null`) 值更简洁`call()`。

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2013-05-20T13:34:41.853

*   A`Callable`需要实现`call()`方法，而A 需要`Runnable`实现`run()`方法。
*   A`Callable`可以返回一个值，但 a`Runnable`不能。
*   A`Callable`可以抛出已检查的异常，但`Runnable`不能。
*   A`Callable`可以与`ExecutorService#invokeXXX(Collection<? extends Callable<T>> tasks)`方法一起使用，但 a`Runnable`不能。

    ```
    public interface Runnable {
        void run();
    }

    public interface Callable<V> {
        V call() throws Exception;
    } 
    ```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2010-01-27T17:35:29.817

我在另一个博客中发现了这一点，可以更多地解释这些[差异](http://geekexplains.blogspot.com/2008/05/callable-interface-vs-runnable.html)：

虽然这两个接口都是由希望在不同的执行线程中执行的类实现的，但是这两个接口之间几乎没有区别，它们是：

*   `Callable<V>`实例返回 type 的结果，`V`而`Runnable`实例不返回。
*   实例可能会抛出已检查的`Callable<V>`异常，而`Runnable`实例不能

Java 的设计者觉得有必要扩展`Runnable`接口的功能，但他们不想影响`Runnable`接口的使用，这可能是他们选择`Callable`在 Java 1.5 中命名的单独接口而不是更改已经存在的接口的原因现有的`Runnable`.

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2014-10-03T16:40:42.883

让我们看看在哪里可以使用 Runnable 和 Callable。

Runnable 和 Callable 都在与调用线程不同的线程上运行。但是 Callable 可以返回一个值，而 Runnable 不能。那么这在哪里真正适用。

**Runnable**：如果你有一个火而忘记的任务，那么使用 Runnable。将您的代码放在 Runnable 中，当调用 run() 方法时，您可以执行您的任务。当您执行任务时，调用线程真的不在乎。

**Callable**：如果您尝试从任务中检索值，请使用 Callable。现在可单独调用将无法完成这项工作。您将需要一个 Future 来包装您的 Callable 并在 future.get() 上获取您的值。这里调用线程将被阻塞，直到 Future 返回结果，结果又等待 Callable 的 call() 方法执行。

所以考虑一个目标类的接口，你定义了 Runnable 和 Callable 包装的方法。调用类会随机调用你的接口方法，不知道哪个是可运行的，哪个是可调用的。Runnable 方法将异步执行，直到调用 Callable 方法。这里调用类的线程将阻塞，因为您正在从目标类中检索值。

注意：在您的目标类中，您可以在单个线程执行程序上调用 Callable 和 Runnable，使这种机制类似于串行调度队列。因此，只要调用者调用您的 Runnable 包装方法，调用线程就会非常快地执行而不会阻塞。一旦它调用包装在 Future 方法中的 Callable，它将不得不阻塞，直到所有其他排队的项目都被执行。只有这样，该方法才会返回值。这是一种同步机制。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2014-12-27T07:24:17.893

`Callable`接口声明`call()`方法，您需要提供泛型，因为 Object call() 的类型应该返回 -

```
public interface Callable<V> {
    /**
     * Computes a result, or throws an exception if unable to do so.
     *
     * @return computed result
     * @throws Exception if unable to compute a result
     */
    V call() throws Exception;
} 
```

`Runnable`另一方面是声明`run()`方法的接口，当您使用可运行对象创建线程并在其上调用 start() 时调用该方法。您也可以直接调用 run() 但只执行 run() 方法是同一个线程。

```
public interface Runnable {
    /**
     * When an object implementing interface <code>Runnable</code> is used 
     * to create a thread, starting the thread causes the object's 
     * <code>run</code> method to be called in that separately executing 
     * thread. 
     * <p>
     * The general contract of the method <code>run</code> is that it may 
     * take any action whatsoever.
     *
     * @see     java.lang.Thread#run()
     */
    public abstract void run();
} 
```

总结几个显着的区别是

1.  `Runnable`对象不返回结果，而对象`Callable`返回结果。
2.  `Runnable`对象不能抛出已检查异常，而对象`Callable`可以抛出异常。
3.  该`Runnable`接口自 Java 1.0 以来一直存在，而`Callable`仅在 Java 1.5 中引入。

很少有相似之处包括

1.  实现 Runnable 或 Callable 接口的类的实例可能由另一个线程执行。
2.  ExecutorService 可以通过 submit() 方法执行 Callable 和 Runnable 接口的实例。
3.  两者都是函数式接口，并且可以在 Java8 之后的 Lambda 表达式中使用。

ExecutorService 接口中的方法是

```
<T> Future<T> submit(Callable<T> task);
Future<?> submit(Runnable task);
<T> Future<T> submit(Runnable task, T result); 
```

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2016-02-15T10:59:17.890

oracle 文档中这些接口的用途：

[Runnable](https://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html)接口应该由其实例打算由`Thread`. 该类必须定义一个没有参数的方法，称为`run`.

[Callable](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html)：返回结果并可能引发异常的任务。实现者定义了一个没有参数的方法，称为 call。该`Callable`接口类似于`Runnable`，因为两者都是为实例可能由另一个线程执行的类设计的。但是， A`Runnable`不返回结果，也不能抛出检查异常。

其他区别：

1.  您可以通过`Runnable`创建一个[Thread](https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html)。但是您不能通过`Callable`作为参数传递来创建新线程。您只能将 Callable 传递给`ExecutorService`实例。

    [例子：](https://docs.oracle.com/javase/tutorial/essential/concurrency/runthread.html)

    ```
    public class HelloRunnable implements Runnable {

        public void run() {
            System.out.println("Hello from a thread!");
        }   

        public static void main(String args[]) {
            (new Thread(new HelloRunnable())).start();
        }

    } 
    ```

2.  用于`Runnable`火灾和忘记呼叫。用于`Callable`验证结果。

3.  `Callable`可以传递给[invokeAll](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html)方法，不像`Runnable`. 方法`invokeAny`和`invokeAll`执行最常用的批量执行形式，执行一组任务，然后等待至少一个或全部完成

4.  微不足道的区别：要实现的方法名称 => `run()`for`Runnable`和`call()`for `Callable`。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2010-10-17T07:16:09.763

正如这里已经提到的，Callable 是一个相对较新的接口，它是作为并发包的一部分引入的。Callable 和 Runnable 都可以与执行程序一起使用。类 Thread（实现 Runnable 本身）仅支持 Runnable。

您仍然可以将 Runnable 与执行程序一起使用。Callable 的优点是您可以将其发送给 executor 并立即返回 Future 结果，该结果将在执行完成时更新。Runnable 也可以实现相同的功能，但在这种情况下，您必须自己管理结果。例如，您可以创建将保存所有结果的结果队列。其他线程可以在这个队列上等待并处理到达的结果。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2017-10-02T09:47:31.753

**Callable 和 Runnable 的区别如下：**

1.  JDK 5.0 中引入了 Callable，但 JDK 1.0 中引入了 Runnable
2.  Callable 有 call() 方法，但 Runnable 有 run() 方法。
3.  Callable 具有返回值的 call 方法，但 Runnable 具有不返回任何值的 run 方法。
4.  call 方法可以抛出已检查的异常，但 run 方法不能抛出已检查的异常。
5.  Callable 使用 submit() 方法放入任务队列，而 Runnable 使用 execute() 方法放入任务队列。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2017-10-08T22:43:00.130

```
+----------------------------------------+--------------------------------------------------------------------------------------------------+
|              Runnable                  |                                           Callable<T>                                            |
+----------------------------------------+--------------------------------------------------------------------------------------------------+
| Introduced in Java 1.0 of java.lang    | Introduced in Java 1.5 of java.util.concurrent library                                           |
| Runnable cannot be parametrized        | Callable is a parametrized type whose type parameter indicates the return type of its run method |
| Runnable has run() method              | Callable has call() method                                                                       |
| Runnable.run() returns void            | Callable.call() returns a generic value V                                                        |
| No way to propagate checked exceptions | Callable's call()“throws Exception” clause so we can easily propagate checked exceptions further |                                                                     |
+----------------------------------------+--------------------------------------------------------------------------------------------------+ 
```

Java 的设计者觉得有必要扩展`Runnable`接口的功能，但他们不想影响`Runnable`接口的使用，这可能是他们选择`Callable`在 Java 1.5 中命名的单独接口而不是更改已经存在的接口的原因`Runnable`自 Java 1.0 以来一直是 Java 一部分的现有接口。[来源](http://geekexplains.blogspot.in/2008/05/callable-interface-vs-runnable.html)

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2018-10-23T08:12:40.910

Callable 和**Runnable**彼此相似，都可以用于实现线程。在实现**Runnable**的情况下，您必须实现**run()**方法，但在 callable 的情况下，您必须实现**call()**方法，两种方法的工作方式相似，但可调用的**call()**方法具有更大的灵活性。它们之间存在一些差异。

**Runnable**和**callable**之间的区别如下 -

1) **runnable的****run()**方法返回**void**，这意味着如果您希望线程返回可以进一步使用的东西，那么您**别无选择 Runnable run()**方法。有一个解决方案**'Callable'**，如果你想以**对象**的形式返回任何东西，那么你**应该使用 Callable 而不是 Runnable**。可调用接口具有**返回 Object 的方法 'call()'**。

 ******方法签名 - Runnable->

```
public void run(){} 
```

可调用->

```
public Object call(){} 
```

2) 在**Runnable run()**方法的情况下，如果出现任何已检查的异常，则必须**使用 try catch 块进行处理**，但在**Callable call()**方法的情况下，您**可以抛出已检查的异常**，如下所示

```
 public Object call() throws Exception {} 
```

3) **Runnable**来自传统的**java 1.0**版本，但**callable**来自带有**Executer**框架的**Java 1.5**版本。

 **如果您熟悉**Executers** ，那么您应该**使用 Callable 而不是 Runnable**。

希望你能理解。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2019-06-03T09:54:29.467

**当我们使用 Executer 框架时，**Runnable (vs) Callable就很重要了。****

 **ExecutorService 是 的子接口[**`Executor`**](https://docs.oracle.com/javase/tutorial/essential/concurrency/exinter.html)，它接受 Runnable 和 Callable 任务。

^(*从 1.0*)开始使用 Interface 可以实现早期的多线程，但是这里的问题是在完成线程任务后我们无法收集线程信息。为了收集数据，我们可能会使用静态字段。**`Runnable`**

 *示例 单独的线程来收集每个学生的数据。

```
static HashMap<String, List> multiTasksData = new HashMap();
public static void main(String[] args) {
    Thread t1 = new Thread( new RunnableImpl(1), "T1" );
    Thread t2 = new Thread( new RunnableImpl(2), "T2" );
    Thread t3 = new Thread( new RunnableImpl(3), "T3" );

    multiTasksData.put("T1", new ArrayList() ); // later get the value and update it.
    multiTasksData.put("T2", new ArrayList() );
    multiTasksData.put("T3", new ArrayList() );
} 
```

为了解决这个问题，他们^(*从 1.5*)开始引入，它返回一个结果并可能引发异常。**`Callable<V>`**

 **   **单一抽象方法**：Callable 和 Runnable 接口都有一个抽象方法，这意味着它们可以在 java 8 的 lambda 表达式中使用。

    ```
    public interface Runnable {
    public void run();
    }

    public interface Callable<Object> {
        public Object call() throws Exception;
    } 
    ```

有几种不同的方法可以将要执行的任务委托给[ExecutorService](http://tutorials.jenkov.com/java-util-concurrent/executorservice.html)。

*   `execute(Runnable task):void`板条箱新线程但不阻塞主线程或调用者线程，因为此方法返回 void。
*   `submit(Callable<?>):Future<?>`，`submit(Runnable):Future<?>`在使用**future.get()**时创建新线程并阻塞主线程。

将接口 Runnable、Callable 与 Executor 框架一起使用的示例。

```
class CallableTask implements Callable<Integer> {
    private int num = 0;
    public CallableTask(int num) {
        this.num = num;
    }
    @Override
    public Integer call() throws Exception {
        String threadName = Thread.currentThread().getName();
        System.out.println(threadName + " : Started Task...");

        for (int i = 0; i < 5; i++) {
            System.out.println(i + " : " + threadName + " : " + num);
            num = num + i;
            MainThread_Wait_TillWorkerThreadsComplete.sleep(1);
        }
        System.out.println(threadName + " : Completed Task. Final Value : "+ num);

        return num;
    }
}
class RunnableTask implements Runnable {
    private int num = 0;
    public RunnableTask(int num) {
        this.num = num;
    }
    @Override
    public void run() {
        String threadName = Thread.currentThread().getName();
        System.out.println(threadName + " : Started Task...");

        for (int i = 0; i < 5; i++) {
            System.out.println(i + " : " + threadName + " : " + num);
            num = num + i;
            MainThread_Wait_TillWorkerThreadsComplete.sleep(1);
        }
        System.out.println(threadName + " : Completed Task. Final Value : "+ num);
    }
}
public class MainThread_Wait_TillWorkerThreadsComplete {
    public static void main(String[] args) throws InterruptedException, ExecutionException {
        System.out.println("Main Thread start...");
        Instant start = java.time.Instant.now();

        runnableThreads();
        callableThreads();

        Instant end = java.time.Instant.now();
        Duration between = java.time.Duration.between(start, end);
        System.out.format("Time taken : %02d:%02d.%04d \n", between.toMinutes(), between.getSeconds(), between.toMillis()); 

        System.out.println("Main Thread completed...");
    }
    public static void runnableThreads() throws InterruptedException, ExecutionException {
        ExecutorService executor = Executors.newFixedThreadPool(4);
        Future<?> f1 = executor.submit( new RunnableTask(5) );
        Future<?> f2 = executor.submit( new RunnableTask(2) );
        Future<?> f3 = executor.submit( new RunnableTask(1) );

        // Waits until pool-thread complete, return null upon successful completion.
        System.out.println("F1 : "+ f1.get());
        System.out.println("F2 : "+ f2.get());
        System.out.println("F3 : "+ f3.get());

        executor.shutdown();
    }
    public static void callableThreads() throws InterruptedException, ExecutionException {
        ExecutorService executor = Executors.newFixedThreadPool(4);
        Future<Integer> f1 = executor.submit( new CallableTask(5) );
        Future<Integer> f2 = executor.submit( new CallableTask(2) );
        Future<Integer> f3 = executor.submit( new CallableTask(1) );

        // Waits until pool-thread complete, returns the result.
        System.out.println("F1 : "+ f1.get());
        System.out.println("F2 : "+ f2.get());
        System.out.println("F3 : "+ f3.get());

        executor.shutdown();
    }
} 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-04-15T15:32:12.770

它是一种与函数式编程相匹配的接口命名约定

```
//Runnable
interface Runnable {
    void run();
}

//Action - throws exception
interface Action {
    void run() throws Exception;
}

//Consumer - consumes a value/values, throws exception
interface Consumer1<T> {
    void accept(T t) throws Exception;
}

//Callable - return result, throws exception
interface Callable<R> {
    R call() throws Exception;
}

//Supplier - returns result, throws exception
interface Supplier<R> {
    R get() throws Exception;
}

//Predicate - consumes a value/values, returns true or false, throws exception
interface Predicate1<T> {
    boolean test(T t) throws Exception;
}

//Function - consumes a value/values, returns result, throws exception
public interface Function1<T, R> {
    R apply(T t) throws Exception;
}

...

//Executor
public interface Executor {
    void execute(Runnable command);
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-02T10:51:40.937

除了所有其他答案：

我们不能将 Callable 传递/使用给单个线程执行，即 Callable 只能在 Executor Framework 中使用。但是，Runnable 可以传递给单个线程执行（new Thread(new CustomRunnable())），也可以在 Executor Framework 中使用。

# apache-flex - 可以在不使用 MXML 的情况下使用 Flex 框架/组件吗？

> ID：141288
> 
> 赞同：19
> 
> 时间：2008-09-26T19:00:47.163
> 
> 标签：apache-flex, actionscript-3, mxml, flashdevelop

是否可以在不使用 MXML 的情况下使用 Flex 框架和组件？我非常了解 ActionScript，并且不想为了获得一些简单的 UI 而使用一些新的 XML 语言。谁能提供一个包含可以编译的 .as 文件的示例（最好通过 FlashDevelop，尽管只是告诉如何使用 Flex SDK 也可以）并使用 Flex 框架？例如，只显示一个弹出警报的 Flex 按钮将是完美的。

如果不可能，有人可以提供一个最小的 MXML 文件，该文件将引导一个自定义 AS 类，然后可以访问 Flex SDK？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-20T19:29:28.633

我做了一个类似于 Borek 的简单引导程序（见下文）。我很想摆脱 mxml 文件，但如果我没有它，我将无法获得 Flex 附带的任何标准主题（haloclassic.swc 等）。有人知道如何按照 Theo 的建议去做并且仍然应用标准主题吗？

这是我简化的引导方法：

主.mxml

```
<?xml version="1.0" encoding="utf-8"?>
<custom:ApplicationClass xmlns:custom="components.*"/> 
```

应用程序类.as

```
package components {
    import mx.core.Application;
    import mx.events.FlexEvent;
    import flash.events.MouseEvent;
    import mx.controls.Alert;
    import mx.controls.Button;

    public class ApplicationClass extends Application {
        public function ApplicationClass () {
            addEventListener (FlexEvent.CREATION_COMPLETE, handleComplete);
        }
        private function handleComplete( event : FlexEvent ) : void {
            var button : Button = new Button();
            button.label = "My favorite button";
            button.styleName="halo"
            button.addEventListener(MouseEvent.CLICK, handleClick);
            addChild( button );
        }
        private function handleClick(e:MouseEvent):void {
            Alert.show("You clicked on the button!", "Clickity");
        }
    }
} 
```

* * *

以下是在 Flex 4 中使用它的必要更新：

主.mxml

```
<?xml version="1.0" encoding="utf-8"?>
<local:MyApplication xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:local="components.*" /> 
```

我的应用程序.as

```
package components {
    import flash.events.MouseEvent;
    import mx.controls.Alert;
    import mx.events.FlexEvent;
    import spark.components.Application;
    import spark.components.Button;

    public class MyApplication extends Application {
        public function MyApplication() {
              addEventListener(FlexEvent.CREATION_COMPLETE, creationHandler);
        }
        private function creationHandler(e:FlexEvent):void {
            var button : Button = new Button();
            button.label = "My favorite button";
            button.styleName="halo"
            button.addEventListener(MouseEvent.CLICK, handleClick);
            addElement( button );
        }
        private function handleClick(e:MouseEvent):void {
            Alert.show("You clicked it!", "Clickity!");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-26T19:46:59.847

这是一个非常简单的应用程序，它只执行 MXML 中的基本引导。这是 MXML：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="onCreationComplete()">
  <mx:Script source="Script.as" />
</mx:Application> 
```

这是 Script.as：

```
import mx.controls.Button;
import flash.events.MouseEvent;
import mx.controls.Alert;
import mx.core.Application;

private function onCreationComplete() : void {
  var button : Button = new Button();
  button.label = "Click me";
  button.addEventListener(MouseEvent.CLICK, function(e : MouseEvent) : void {
    Alert.show("Clicked");
  });

  Application.application.addChild(button);
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-26T20:38:28.757

注意：除非您先初始化 Flex 库，否则下面的答案实际上不会起作用。有很多代码可以做到这一点。有关更多详细信息，请参阅下面的评论或其他答案。

* * *

主类甚至不必在 MXML 中，只需创建一个继承自的类（无论如何编译具有根节点`mx.core.Application`的 MXML 类）：`<mx:Application>`

```
package {

  import mx.core.Application;

  public class MyFancyApplication extends Application {

    // do whatever you want here

  }

} 
```

此外，任何使用编译器编译的 ActionScript 代码`mxmlc`- 甚至是 Flash CS3 创作工具 - 都可以使用 Flex 类，只需使它们在类路径中可用（在使用`mxmlc`或指向文件夹时参考框架 SWC使用其中之一时包含源）。但是，除非文档类从`mx.core.Application`您那里继承，否则可能会遇到一些麻烦，因为框架中的某些东西假设是这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:40:58.317

是的，你只需要在你的类路径中包含 flex swc。您可以在 frameoworks/lib/flex.swc 的 flex sdk 中找到 flex.swc

编辑：还有一件事：如果您使用的是 Flex Builder，您可以简单地创建一个新的 ActionScript 项目，该项目基本上与上述相同。

# python - 如何仅列出 Python 中的顶级目录？

> ID：141291
> 
> 赞同：167
> 
> 时间：2008-09-26T19:01:06.650
> 
> 标签：python, filesystems

我希望能够仅列出某个文件夹中的目录。这意味着我不想列出文件名，也不需要额外的子文件夹。

让我们看看一个例子是否有帮助。在当前目录中，我们有：

```
>>> os.listdir(os.getcwd())
['cx_Oracle-doc', 'DLLs', 'Doc', 'include', 'Lib', 'libs', 'LICENSE.txt', 'mod_p
ython-wininst.log', 'NEWS.txt', 'pymssql-wininst.log', 'python.exe', 'pythonw.ex
e', 'README.txt', 'Removemod_python.exe', 'Removepymssql.exe', 'Scripts', 'tcl',
 'Tools', 'w9xpopen.exe'] 
```

但是，我不想列出文件名。我也不想要像 \Lib\curses 这样的子文件夹。基本上我想要的适用于以下内容：

```
>>> for root, dirnames, filenames in os.walk('.'):
...     print dirnames
...     break
...
['cx_Oracle-doc', 'DLLs', 'Doc', 'include', 'Lib', 'libs', 'Scripts', 'tcl', 'Tools'] 
```

但是，我想知道是否有更简单的方法可以实现相同的结果。我的印象是，仅使用 os.walk 来返回顶层是低效/太多的。

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2008-09-26T23:57:04.597

## os.walk

[`os.walk`](https://docs.python.org/3/library/os.html#os.walk)与[`next`](https://docs.python.org/3/library/functions.html#next)项目功能一起使用：

```
next(os.walk('.'))[1] 
```

对于*Python <=2.5* ，请使用：

```
os.walk('.').next()[1] 
```

### 这是如何工作的

`os.walk`是一个生成器，调用`next`将获得 3 元组形式的第一个结果（目录路径、目录名、文件名）。因此，`[1]`索引仅返回`dirnames`来自该元组的。

* * *

## 回答 #2

> 赞同：161
> 
> 时间：2008-09-26T19:06:57.477

使用 os.path.isdir() 过滤结果（并使用 os.path.join() 获取真实路径）：

```
>>> [ name for name in os.listdir(thedir) if os.path.isdir(os.path.join(thedir, name)) ]
['ctypes', 'distutils', 'encodings', 'lib-tk', 'config', 'idlelib', 'xml', 'bsddb', 'hotshot', 'logging', 'doc', 'test', 'compiler', 'curses', 'site-packages', 'email', 'sqlite3', 'lib-dynload', 'wsgiref', 'plat-linux2', 'plat-mac'] 
```

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2008-09-26T19:10:36.157

使用 os.path.isdir 过滤列表以检测目录。

```
filter(os.path.isdir, os.listdir(os.getcwd())) 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-09-26T19:04:46.907

```
directories=[d for d in os.listdir(os.getcwd()) if os.path.isdir(d)] 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-26T22:32:50.947

请注意，与其做`os.listdir(os.getcwd())`，不如做`os.listdir(os.path.curdir)`。少了一个函数调用，而且它是可移植的。

因此，要完成答案，要获取文件夹中的目录列表：

```
def listdirs(folder):
    return [d for d in os.listdir(folder) if os.path.isdir(os.path.join(folder, d))] 
```

如果您更喜欢完整路径名，请使用此功能：

```
def listdirs(folder):
    return [
        d for d in (os.path.join(folder, d1) for d1 in os.listdir(folder))
        if os.path.isdir(d)
    ] 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2016-07-06T04:54:49.890

这似乎也有效（至少在 linux 上）：

```
import glob, os
glob.glob('*' + os.path.sep) 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2019-04-10T05:29:57.140

使用列表理解，

```
[a for a in os.listdir() if os.path.isdir(a)] 
```

我认为这是最简单的方法

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2013-01-17T11:57:25.733

只是补充一点，使用 os.listdir() 不会*“与非常简单的 os.walk().next()[1] 相比需要大量处理”*。这是因为 os.walk() 在内部使用 os.listdir()。事实上，如果你一起测试它们：

```
>>>> import timeit
>>>> timeit.timeit("os.walk('.').next()[1]", "import os", number=10000)
1.1215229034423828
>>>> timeit.timeit("[ name for name in os.listdir('.') if os.path.isdir(os.path.join('.', name)) ]", "import os", number=10000)
1.0592019557952881 
```

os.listdir() 的过滤速度非常快。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-10-13T11:26:42.517

一个非常简单和优雅的方法是使用它：

```
 import os
 dir_list = os.walk('.').next()[1]
 print dir_list 
```

在您想要文件夹名称的同一文件夹中运行此脚本。它只会为您提供确切的直接文件夹名称（也没有文件夹的完整路径）。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-07-20T18:17:01.010

Python 3.4[将该`pathlib`模块](https://docs.python.org/3/library/pathlib.html)引入标准库，它提供了一种面向对象的方法来处理文件系统路径：

```
from pathlib import Path

p = Path('./')
[f for f in p.iterdir() if f.is_dir()] 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T19:05:26.733

```
[x for x in os.listdir(somedir) if os.path.isdir(os.path.join(somedir, x))] 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-01-27T18:25:17.837

作为一个新手，我还不能直接发表评论，但这里有一个小的更正，我想添加到[ΤZΩΤZΙΟΥ答案](https://stackoverflow.com/questions/141291/how-to-list-only-top-level-directories-in-python/142368#142368)的以下部分：

> 如果您更喜欢完整路径名，请使用此功能：
> 
> ```
> def listdirs(folder):  
>   return [
>     d for d in (os.path.join(folder, d1) for d1 in os.listdir(folder))
>     if os.path.isdir(d)
> ] 
> ```

**对于那些仍在 python < 2.4 上**的人：内部构造需要是一个列表而不是一个元组，因此应该是这样的：

```
def listdirs(folder):  
  return [
    d for d in [os.path.join(folder, d1) for d1 in os.listdir(folder)]
    if os.path.isdir(d)
  ] 
```

否则会出现语法错误。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2021-02-12T10:48:57.343

你也可以使用[`os.scandir`](https://docs.python.org/3/library/os.html#os.scandir)：

```
with os.scandir(os.getcwd()) as mydir:
    dirs = [i.name for i in mydir if i.is_dir()] 
```

如果你想要完整的路径，你可以使用`i.path`.

> 使用 scandir() 代替 listdir() 可以显着提高还需要文件类型或文件属性信息的代码的性能，因为如果操作系统在扫描目录时提供了这些信息，os.DirEntry 对象就会公开这些信息。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-09-05T23:07:39.983

2021 年答案使用[`glob`](https://docs.python.org/3/library/glob.html)：

```
import glob, os

p = "/some/path/"
for d in glob.glob(p + "*" + os.path.sep):
  print(d) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-20T10:53:08.207

对于完整路径名列表，我更喜欢此版本而不是此处的其他[解决方案](https://stackoverflow.com/a/142368/2190476)：

```
def listdirs(dir):
    return [os.path.join(os.path.join(dir, x)) for x in os.listdir(dir) 
        if os.path.isdir(os.path.join(dir, x))] 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-09-18T16:04:06.760

```
scanDir = "abc"
directories = [d for d in os.listdir(scanDir) if os.path.isdir(os.path.join(os.path.abspath(scanDir), d))] 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-09-03T02:24:42.173

FWIW，该`os.walk`方法比列表理解和过滤方法快近 10 倍：

```
In [30]: %timeit [d for d in os.listdir(os.getcwd()) if os.path.isdir(d)]
1.23 ms ± 97.8 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [31]: %timeit list(filter(os.path.isdir, os.listdir(os.getcwd())))
1.13 ms ± 13.8 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [32]: %timeit next(os.walk(os.getcwd()))[1]
132 µs ± 9.34 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-26T19:05:26.247

像这样？

```
>>>> [path for path in os.listdir(os.getcwd()) if os.path.isdir(path)] 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-07-21T08:01:34.193

没有目录时不会失败的更安全的选项。

```
def listdirs(folder):
    if os.path.exists(folder):
         return [d for d in os.listdir(folder) if os.path.isdir(os.path.join(folder, d))]
    else:
         return [] 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-02-26T23:25:35.863

```
-- This will exclude files and traverse through 1 level of sub folders in the root

def list_files(dir):
    List = []
    filterstr = ' '
    for root, dirs, files in os.walk(dir, topdown = True):
        #r.append(root)
        if (root == dir):
            pass
        elif filterstr in root:
            #filterstr = ' '
            pass
        else:
            filterstr = root
            #print(root)
            for name in files:
                print(root)
                print(dirs)
                List.append(os.path.join(root,name))
            #print(os.path.join(root,name),"\n")
                print(List,"\n")

    return List 
```

# delphi - 在 Delphi 中检查文件是否打开

> ID：141302
> 
> 赞同：15
> 
> 时间：2008-09-26T19:02:15.210
> 
> 标签：delphi, file-io

有没有办法检查文件是否已被 Delphi 中的 ReWrite 打开？

代码会是这样的：

```
AssignFile(textfile, 'somefile.txt');
if not textFile.IsOpen then
   Rewrite(textFile); 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-26T19:11:16.857

你可以得到文件模式。（一会儿，我将创建一个示例）。

TTextRec(txt).Mode 为您提供模式：

```
55216 = closed
55217 = open read
55218 = open write

fmClosed = $D7B0;
fmInput  = $D7B1;
fmOutput = $D7B2;
fmInOut  = $D7B3; 
```

在系统单元中搜索 TTextRec 以获取更多信息。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-26T19:17:26.733

试试这个：

```
function IsFileInUse(fName: string) : boolean;
var
  HFileRes: HFILE;
begin
  Result := False;
  if not FileExists(fName) then begin
    Exit;
  end;

  HFileRes := CreateFile(PChar(fName)
    ,GENERIC_READ or GENERIC_WRITE
    ,0
    ,nil
    ,OPEN_EXISTING
    ,FILE_ATTRIBUTE_NORMAL
    ,0);

  Result := (HFileRes = INVALID_HANDLE_VALUE);

  if not(Result) then begin
    CloseHandle(HFileRes);
  end;
end; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-11-17T11:29:31.053

这工作正常：

```
function IsOpen(const txt:TextFile):Boolean;
const
  fmTextOpenRead = 55217;
  fmTextOpenWrite = 55218;
begin
  Result := (TTextRec(txt).Mode = fmTextOpenRead) or (TTextRec(txt).Mode = fmTextOpenWrite)
end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-11T17:47:13.427

我发现将布尔变量作为伴侣更容易；例子：`bFileIsOpen`。无论文件在哪里打开，`bFileIsOpen := true`然后设置，每当您需要知道文件是否打开时，只需测试此变量即可；例子：`if (bFileIsOpen) then Close(datafile);`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-01-10T11:29:37.357

约瑟夫的回答完美 - 我调用了这个函数`filenotopen`并改变了如果

```
Result := (HFileRes = INVALID_HANDLE_VALUE); 
```

到

```
Result := NOT (HFileRes = INVALID_HANDLE_VALUE); 
```

我还删除了“如果不是（结果）然后开始”（和“结束”）行，以便它总是关闭句柄或后续分配并读取给出错误

我现在这样称呼它

```
if filenotopen(filename) then 
  begin
    assignfile(f,filename);
    reset(f)
    etc;
  end
else
  message('file open by a different program') 
```

# dictionary - 发音词典

> ID：141312
> 
> 赞同：8
> 
> 时间：2008-09-26T19:04:12.820
> 
> 标签：dictionary, phonetics

[The CMU Pronouncing Dictionary](http://www.speech.cs.cmu.edu/cgi-bin/cmudict)是否有任何替代品，商业或开源？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T19:12:03.847

我不相信答案肯定是“不”，但我知道 CMU 是我轶事经验中最受欢迎的发音词典。我相信它是开源的，所以如果它缺少某些东西，也许你可以找到一种方法来添加它（或请求添加它）。

除此之外，我会与[Language Log 的人员核实。](http://itre.cis.upenn.edu/~myl/languagelog/)他们经常处理语音。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:10:35.957

我也在寻找类似的东西。在它旁边我找到了[http://www.voxforge.org/home/downloads](http://www.voxforge.org/home/downloads)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T15:50:17.010

有[CELEX 2](http://www.ldc.upenn.edu/Catalog/CatalogEntry.jsp?catalogId=LDC96L14)，可从 Linguistic Data Consortium 获得，其中包含语音信息，价格为 300 美元。问题是它有点过时了，而且英语词典是BE，而不是AE。

您也可以使用[CALLHOME](http://www.ldc.upenn.edu/Catalog/CatalogEntry.jsp?catalogId=LDC97L20)，但要 2250 美元，它比 CELEX 贵。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T18:58:42.700

我找到了[DictionaryForMIDs](http://dictionarymid.sourceforge.net/what.html)和[desktionary](http://sourceforge.net/projects/desktionary)。我没用过，但都是开源的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T18:17:56.243

[forvo.com](http://forvo.com) . 免费开放。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-31T03:29:49.520

查看[Merriam-Webster](http://m-w.com)以了解以下内容：

[堆栈](http://www.merriam-webster.com/cgi-bin/audio.pl?stack001.wav=stack) [溢出](http://www.merriam-webster.com/cgi-bin/audio.pl?overfl02.wav=overflow)

# php - php 检查有效日期，奇怪的日期转换

> ID：141315
> 
> 赞同：14
> 
> 时间：2008-09-26T19:05:22.457
> 
> 标签：php, date, time, strtotime

有没有办法检查日期/时间是否有效，您会认为这些很容易检查：

```
$date = '0000-00-00';
$time = '00:00:00';
$dateTime = $date . ' ' . $time;

if(strtotime($dateTime)) {
    // why is this valid?
} 
```

真正让我感动的是：

```
echo date('Y-m-d', strtotime($date)); 
```

结果：“1999-11-30”，

嗯？我从 0000-00-00 到 1999-11-30 ？？？

我知道我可以进行比较以查看日期是否与我拥有的日期相等，但这不是一种非常可靠的检查方式。有什么好方法可以检查我是否有一个有效的日期？任何人都有一个很好的功能来检查这个？

编辑：人们在问我在运行什么：在 Linux localhost 2.6.18-53.1.14.el5 #1 SMP Wed Mar 5 11 上运行 PHP 5.2.5 (cli)（构建时间：2008 年 7 月 23 日 11:32:27） :36:49 EST 2008 i686 i686 i386 GNU/Linux

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-26T19:15:01.217

来自[php.net](http://php.net/manual/en/function.checkdate.php#78362)

```
<?php
function isValidDateTime($dateTime)
{
    if (preg_match("/^(\d{4})-(\d{2})-(\d{2}) ([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/", $dateTime, $matches)) {
        if (checkdate($matches[2], $matches[3], $matches[1])) {
            return true;
        }
    }

    return false;
}
?> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-03-29T21:07:19.120

如此处所述： [https ://bugs.php.net/bug.php?id=45647](https://bugs.php.net/bug.php?id=45647)

> 这里没有 bug，00-00-00 表示 2000-00-00，即 1999-12-00，即 1999-11-30。没有bug，完全正常。

正如一些测试所示，如果有点不安，向后滚动是预期的行为：

```
>> date('Y-m-d', strtotime('2012-03-00'))
string: '2012-02-29'
>> date('Y-m-d', strtotime('2012-02-00'))
string: '2012-01-31'
>> date('Y-m-d', strtotime('2012-01-00'))
string: '2011-12-31'
>> date('Y-m-d', strtotime('2012-00-00'))
string: '2011-11-30' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T19:11:25.627

> echo date('Ymd', strtotime($date));
> 
> 结果：“1999-11-30”

结果是 943920000 - 这是从[Unix 纪元](http://en.wikipedia.org/wiki/Unix_time)（测量时间的基准）到 1999-11-30`strtotime`之间的大致秒数。

当您尝试一个前纪元时间（包括“0000-00-00 00:00:00”）时，所有返回这个奇数的值都有一个记录**在案的[mysql 错误。](http://bugs.php.net/bug.php?id=17123)**`mktime(), localtime(), strtotime()`关于这是否实际上是一个错误的链接线程存在一些争论：

> 由于时间戳是从 1970 年开始的，我认为它无论如何都不应该工作。

下面是一个函数，我用于将上述日期时间转换为时间戳以进行比较等，对于“0000-00-00 00:00:00”以外的日期，这可能对您有用

```
/**
 * Converts strings of the format "YYYY-MM-DD HH:MM:SS" into php dates
 */
function convert_date_string($date_string)
{
    list($date, $time) = explode(" ", $date_string);
    list($hours, $minutes, $seconds) = explode(":", $time);
    list($year, $month, $day) = explode("-", $date);
    return mktime($hours, $minutes, $seconds, $month, $day, $year);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T12:07:04.607

当您超出范围时，不要期望获得一致的结果：

cf [strtotime](http://us2.php.net/manual/en/function.strtotime.php)

cf [Gnu 日历-日期-项目](http://www.gnu.org/software/tar/manual/html_node/Calendar-date-items.html#SEC116).html

> “对于数字月份，允许使用 ISO 8601 格式‘年-月-日’，其中年是任何正数， **月是介于 01 和 12 之间的数字**，**日是介于 01 和 31 之间的数字**。前导零必须是如果数字小于十，则存在。”

所以'0000-00-00'给出了奇怪的结果，这是合乎逻辑的！

* * *

> “此外，**并非所有平台都支持负时间戳，因此您的日期范围可能会限制为不早于 Unix 纪元**。这意味着例如 %e、%T、%R 和 %D（可能还有更多）以及**之前的日期1970 年 1 月 1 日将无法在 Windows、某些 Linux 发行版和其他一些操作系统上运行**。”

cf [strftime](http://us2.php.net/manual/en/function.strftime.php)

* * *

改用[checkdate](http://us2.php.net/manual/en/function.checkdate.php)函数（更健壮）：

> 月份：**月份介于 1 和 12 之间**。
> 
> day：日期在给定月份的允许天数内。闰年被考虑在内。
> 
> year：**年份在 1 到 32767 之间**。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-15T06:16:58.837

如果您只想处理日期转换而没有 mysql 日期字段的时间，您可以像我一样修改这个很棒的代码。在我的 PHP 版本上没有执行这个功能，我每次都会得到“0000-00-00”。恼人的。

```
function ConvertDateString ($DateString)
{
    list($year, $month, $day) = explode("-", $DateString);
    return date ("Y-m-d, mktime (0, 0, 0, $month, $day, $year));
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-05T15:41:28.257

此版本允许字段为空，具有 mm/dd/yy 或 mm/dd/yyyy 格式的日期，允许单个数字小时，添加可选的 am/pm，并纠正时间匹配中的一些细微缺陷。

仍然允许一些病态时间，例如“23:14 AM”。

```
function isValidDateTime($dateTime) {
    if (trim($dateTime) == '') {
        return true;
    }
    if (preg_match('/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})(\s+(([01]?[0-9])|(2[0-3]))(:[0-5][0-9]){0,2}(\s+(am|pm))?)?$/i', $dateTime, $matches)) {
        list($all,$mm,$dd,$year) = $matches;
        if ($year <= 99) {
            $year += 2000;
        }
        return checkdate($mm, $dd, $year);
    }
    return false;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-20T08:29:44.750

我一直在更改上面的马丁答案，它将验证任何类型的日期并以您喜欢的格式返回。

只需通过编辑下面的脚本行来更改格式 strftime("10-10-2012", strtotime($dt));

```
<?php
echo is_date("13/04/10");

function is_date( $str ) {
    $flag = strpos($str, '/');

    if(intval($flag)<=0){
        $stamp = strtotime( $str );
    } else {
        list($d, $m, $y) = explode('/', $str);    
        $stamp = strtotime("$d-$m-$y");
    } 
    //var_dump($stamp) ;

    if (!is_numeric($stamp)) {
        //echo "ho" ;
        return "not a date" ;        
    }

    $month = date( 'n', $stamp ); // use n to get date in correct format
    $day   = date( 'd', $stamp );
    $year  = date( 'Y', $stamp );

    if (checkdate($month, $day, $year)) {
        $dt = "$year-$month-$day" ;
        return strftime("%d-%b-%Y", strtotime($dt));
        //return TRUE;
    } else {
        return "not a date" ;
    }
}
?> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-16T18:08:34.630

```
<?php
function is_valid_date($user_date=false, $valid_date = "1900-01-01") {
    $user_date = date("Y-m-d H:i:s",strtotime($user_date));
    return strtotime($user_date) >= strtotime($valid_date) ? true : false;
}

echo is_valid_date("00-00-00") ? 1 : 0;    // return 0

echo is_valid_date("3/5/2011") ? 1 : 0;    // return 1 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-04-25T10:03:22.563

我使用以下代码来验证来自 ExtJS 应用程序的日期。

```
function check_sql_date_format($date) {
    $date = substr($date, 0, 10);
    list($year, $month, $day) = explode('-', $date);
    if (!is_numeric($year) || !is_numeric($month) || !is_numeric($day)) {
        return false;
    }
    return checkdate($month, $day, $year);
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-09-19T18:27:36.493

```
<?php

function is_date( $str ) {
    $stamp = strtotime( $str );

    if (!is_numeric($stamp)) {
        return FALSE;
    }
    $month = date( 'm', $stamp );
    $day   = date( 'd', $stamp );
    $year  = date( 'Y', $stamp );

    if (checkdate($month, $day, $year)) {
        return TRUE;
    }
    return FALSE;
}
?> 
```

# php - Phing 和 PHPUnderControl 有什么区别？

> ID：141319
> 
> 赞同：9
> 
> 时间：2008-09-26T19:05:37.607
> 
> 标签：php, continuous-integration, phpunit, cruisecontrol, phing

我们目前使用手动设置和配置脚本以及手动持续集成脚本来构建和部署我们的应用程序。我正在考虑使用为这些目的设计的第三方系统将其正式化。

我以前研究过 Phing，我知道它基本上就像 Ant。但是，我的 Ant 经验有些有限，所以对我没有多大帮助。（我所做的大部分 Java 工作只是部署为 jar 文件）。

之前研究过Cruise Control，了解到phpUnderControl是CC的一个插件。但是，Phing 说它也适用于 CC。所以我不清楚这里的重叠。我是否需要 Phing 和 phpUnderControl 才能与 CruiseControl 一起工作，还是它们是互斥的？

我真正需要的是可以：

*   查看来自 SVN 的源代码
*   从 SQL 文件安装数据库
*   从一系列模板和一个ini文件生成一些本地配置文件
*   运行我们所有的单元测试（目前是 ST，但很容易转换为 PHPUnit）并在任何测试中断时向开发团队发送电子邮件（当然还有堆栈跟踪）
*   为应用程序生成 API 文档并将其放在某处
*   运行测试覆盖率报告

现在，我们几乎以一种或另一种形式拥有所有这些。但是，将所有这些自动化并捆绑在一个过程中会很好。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T19:14:41.717

phing 几乎是用 PHP 编写的 ant，其中 phpUnderControl 向 CruiseControl 添加了对 PHP 项目的支持，并在后端使用 phing 或 ant 来解析 build.xml 文件并运行命令。

我刚刚设置了 CruiseControl 和 phpUnderControl，它运行良好。它检查我的 SVN，在我们检查时通过 phpDocumentor、PHP_CodeSniffer 和 PHPUnit 运行它。由于它完全基于 build.xml 文件，您可以通过它运行几乎任何您想要的软件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:10:10.760

我相信很多人会在我输入这个时说这个，但是......

我知道这不是 PHP，但我们发现[Capistrano](http://www.capify.org/)只是这种事情的工作。它确实是一款出色的软件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T20:25:42.140

我们一直在使用 Phing，而且设置它的成本非常低；即使您不了解 ANT，它也很容易学习。我对 CruiseControl 的体验非常糟糕（不稳定 - 随机下降） - 所以我喜欢 Phing 的简单性。另外，它可以使用 PHP 轻松扩展（如果您有一个自定义任务，他们不支持开箱即用）。

# perl - Perl - Win32 - 如何从另一个进程非阻塞读取文件句柄？

> ID：141332
> 
> 赞同：2
> 
> 时间：2008-09-26T19:08:30.797
> 
> 标签：perl, winapi, file, asynchronous

我正在编写一些通过 STDIN 与客户端进程对话的服务器代码。我正在尝试编写一段 perl 代码，以异步接收来自客户端 STDOUT 的响应。代码的阻塞版本可能如下所示：

```
sub _read_from_client
{
   my ($file_handle) = @_;
   while (my $line = <$file_handle>) {
      print STDOUT $line;
   }
   return;
} 
```

重要的是，该片段需要在 Win32 平台上工作。*nix 平台有很多我不感兴趣的解决方案。我使用的是 ActivePerl 5.10。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T20:29:29.853

[Perlmonks](http://www.perlmonks.org)上的[这个线程](http://www.perlmonks.org/?node_id=529812)建议您可以通过这种方式在 Perl 中的 Windows 上创建一个非阻塞套接字：

```
ioctl($socket, 0x8004667e, 1); 
```

该线程中的更多详细信息和资源

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-27T06:42:47.447

如果您不想走低级路线，则必须查看其他更框架化的解决方案。

您可以使用[线程](http://search.cpan.org/perldoc?threads)从输入中读取数据，并将其读取的所有数据填充到[Thread::Queue](http://search.cpan.org/perldoc?Thread::Queue)中，然后在主线程中处理该线程。

您可以查看实现基于事件的框架的[POE](http://search.cpan.org/perldoc?POE)，尤其是[POE::Wheel::Run::Win32](http://search.cpan.org/perldoc?POE::Wheel::Run::Win32)。潜在地，您还可以从中窃取代码以自己实现非阻塞读取。

你可以看看 [Coro]，它使用协程实现了一个协作多任务系统。这与线程最相似，只是您获得的是用户空间线程，而不是系统线程。

You haven't stated how far up you want to go, but your choice is between `sysread` and a framework, or writing said framework yourself. The easiest route to go is just to use threads or by going through the code of `Poe::Wheel::Run::Win32`.

# c++ - 我应该存储整个对象还是指向容器中对象的指针？

> ID：141337
> 
> 赞同：165
> 
> 时间：2008-09-26T19:10:38.280
> 
> 标签：c++, stl, pointers

从头开始设计一个新系统。我将使用 STL 来存储某些长寿命对象的列表和映射。

问题：我是否应该确保我的对象具有复制构造函数并将对象的副本存储在我的 STL 容器中，还是自己管理生命和范围并将指向这些对象的指针存储在我的 STL 容器中通常更好？

我意识到这在细节上有些不足，但我正在寻找“理论上的”更好的答案（如果存在），因为我知道这两种解决方案都是可能的。

玩指针的两个非常明显的缺点： 1) 我必须自己在 STL 之外的范围内管理这些对象的分配/释放。2) 我无法在堆栈上创建临时对象并将其添加到我的容器中。

还有什么我想念的吗？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-09-26T19:18:20.930

由于人们正在关注使用指针的效率。

如果您正在考虑使用 std::vector 并且更新很少并且您经常迭代您的集合并且它是存储对象“副本”的非多态类型将更有效，因为您将获得更好的参考位置。

Otoh，如果更新是常见的，存储指针将节省复制/重定位成本。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-09-26T19:41:30.203

这真的取决于你的情况。

如果您的对象很小，并且复制对象是轻量级的，那么在我看来，将数据存储在 stl 容器中很简单且更易于管理，因为您不必担心生命周期管理。

如果您的对象很大，并且具有默认构造函数没有意义，或者对象的副本很昂贵，那么使用指针存储可能是要走的路。

如果您决定使用指向对象的指针，请查看[Boost Pointer Container Library](http://www.boost.org/doc/libs/1_35_0/libs/ptr_container/doc/ptr_container.html)。这个 boost 库包装了所有 STL 容器，用于动态分配的对象。

每个指针容器（例如 ptr_vector）在添加到容器时都会获得对象的所有权，并为您管理这些对象的生命周期。您还可以通过引用访问 ptr_ 容器中的所有元素。这使您可以执行以下操作

```
class BigExpensive { ... }

// create a pointer vector
ptr_vector<BigExpensive> bigVector;
bigVector.push_back( new BigExpensive( "Lexus", 57700 ) );
bigVector.push_back( new BigExpensive( "House", 15000000 );

// get a reference to the first element
MyClass& expensiveItem = bigList[0];
expensiveItem.sell(); 
```

这些类封装了 STL 容器并与所有 STL 算法一起工作，这非常方便。

还有一些工具可以将容器中指针的所有权转移给调用者（通过大多数容器中的释放函数）。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2008-09-26T19:13:25.340

如果要存储多态对象，则始终需要使用基类指针的集合。

也就是说，如果您计划在集合中存储不同的派生类型，则必须存储指针或被切片守护进程吃掉。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2012-01-26T11:01:39.193

很抱歉在事件发生 3 年后加入，但这里有一个警告......

在我上一个大项目中，我的中心数据结构是一组相当简单的对象。项目开始大约一年后，随着需求的发展，我意识到对象实际上需要是多态的。花了几个星期的艰难和讨厌的脑部手术，将数据结构修复为一组基类指针，并处理对象存储、铸造等方面的所有附带损害。我花了几个月的时间来说服自己新代码是有效的。顺便说一句，这让我认真思考 C++ 的对象模型设计得多么好。

在我目前的大项目中，我的中心数据结构是一组相当简单的对象。项目进行了大约一年（恰好是今天），我意识到对象实际上需要是多态的。回到网上，找到了这个线程，找到了 Nick 的 Boost 指针容器库的链接。这正是我上次为了解决所有问题而必须写的，所以这次我会试一试。

无论如何，对我来说，道德是：如果你的规范不是 100% 确定的，那就去寻求指导，你以后可能会为自己节省很多工作。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2008-09-26T19:15:17.583

为什么不两全其美：做一个智能指针容器（例如[`boost::shared_ptr`](http://www.boost.org/doc/libs/1_51_0/libs/smart_ptr/shared_ptr.htm)or [`std::shared_ptr`](http://en.cppreference.com/w/cpp/memory/shared_ptr)）。您不必管理内存，也不必处理大型复制操作。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-26T19:16:22.853

通常将对象直接存储在 STL 容器中是最好的，因为它最简单、最有效，并且最容易使用对象。

如果您的对象本身具有不可复制的语法或者是抽象基类型，您将需要存储指针（最简单的是使用 shared_ptr）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-26T19:14:10.220

您似乎很好地掌握了差异。如果对象很小且易于复制，那么一定要存储它们。

如果没有，我会考虑将智能指针（不是 auto_ptr，一个 ref 计数智能指针）存储到您在堆上分配的指针。显然，如果您选择智能指针，那么您将无法存储临时堆栈分配的对象（如您所说）。

@ [Torbjörn](https://stackoverflow.com/questions/141337/c-stl-should-i-store-entire-objects-or-pointers-to-objects#141352)对切片提出了一个很好的观点。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T19:14:44.620

使用指针会更有效，因为容器只会复制指针而不是完整的对象。

这里有一些关于 STL 容器和智能指针的有用信息：

[为什么将 std::auto_ptr<> 与标准容器一起使用是错误的？](https://stackoverflow.com/questions/111478/why-is-it-wrong-to-use-stdautoptr-with-stl-containers#111511)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-27T05:54:38.090

如果要在代码中的其他地方引用对象，请存储在 boost::shared_ptr 的向量中。这样可以确保在调整向量大小时指向对象的指针仍然有效。

IE：

```
std::vector<boost::shared_ptr<protocol> > protocols;
...
connection c(protocols[0].get()); // pointer to protocol stays valid even if resized 
```

如果没有其他人存储指向对象的指针，或者列表没有增长和缩小，只需存储为普通旧对象：

```
std::vector<protocol> protocols;
connection c(protocols[0]); // value-semantics, takes a copy of the protocol 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-07-19T01:33:36.953

这个问题一直困扰着我一段时间。

我倾向于存储指针，但我有一些可能不适用于您的附加要求（SWIG lua 包装器）。

这篇文章中最重要的一点是*自己测试它*，使用*你的对象。*

我今天这样做是为了测试在 1000 万个对象的集合上调用成员函数 500 次的速度。

该函数根据 xdir 和 ydir（所有浮点成员变量）更新 x 和 y。

我使用 std::list 来保存这两种类型的对象，我发现将对象存储在列表中比使用指针稍微快一些。另一方面，性能非常接近，因此取决于它们在您的应用程序中的使用方式。

作为参考，在我的硬件上使用 -O3 时，指针需要 41 秒才能完成，而原始对象需要 30 秒才能完成。

# windows - 如何检查 %PATH% 中是否存在目录？

> ID：141344
> 
> 赞同：68
> 
> 时间：2008-09-26T19:12:25.950
> 
> 标签：windows, batch-file

如何检查 PATH 环境变量中是否已经存在目录？这是一个开始。不过，我对下面的代码所做的只是回显 %PATH% 中的第一个目录。由于这是一个 FOR 循环，您会认为它会枚举 %PATH% 中的所有目录，但它只获取第一个目录。

有没有更好的方法来做到这一点？在 %PATH% 变量上运行 find 或 findstr 之类的东西？我只想检查 %PATH% 中的目录列表中是否存在一个目录，以避免添加可能已经存在的内容。

```
FOR /F "delims=;" %%P IN ("%PATH%") DO (
    @ECHO %%~P
) 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2011-11-08T05:54:11.633

首先，我将指出一些使这个问题难以完美解决的问题。然后我将介绍我能想到的最防弹的解决方案。

在本次讨论中，我将使用小写的路径来表示文件系统中的单个文件夹路径，并使用大写的 PATH 来表示 PATH 环境变量。

从实际的角度来看，大多数人想知道 PATH 是否包含给定路径的逻辑等价物，而不是 PATH 是否包含给定路径的精确字符串匹配。这可能是有问题的，因为：

1.  **路径中的尾随`\`是可选的**
    大多数路径在有尾随和没有尾随的情况下都同样有效`\`。无论哪种方式，路径在逻辑上都指向相同的位置。PATH 经常混合有尾随和不带尾随的路径`\`。这可能是在 PATH 中搜索匹配项时最常见的实际问题。

    *   有一个例外：相对路径（指C盘当前工作目录）与（指C盘根目录 `C:`）有很大不同`C:\`

2.  **一些路径具有备用短名称**
    任何不符合旧 8.3 标准的路径都有一个符合标准的备用短形式。这是我经常看到的另一个 PATH 问题，尤其是在商业环境中。

3.  **Windows 接受`/`和`\`作为路径中的文件夹分隔符。**
    这种情况并不常见，但是可以使用`/`而不是指定路径，`\`并且它在 PATH 中（以及在许多其他 Windows 上下文中）可以正常工作

4.  **Windows 将连续的文件夹分隔符视为一个逻辑分隔符。**
    C:\FOLDER\\ 和 C:\FOLDER\ 是等价的。在处理路径时，这实际上在许多情况下都有帮助，因为开发人员通常可以附加`\`到路径而无需检查尾随是否`\`已经存在。但是，如果尝试执行精确的字符串匹配，这显然会导致问题。

    *   例外：不仅是`C:`，不同于`C:\`，而且`C:\`（有效路径），不同于`C:\\`（无效路径）。

5.  **Windows 从文件和目录名称中修剪尾随的点和空格。**
    `"C:\test. "`相当于`"C:\test"`。

6.  **当前`.\`和父`..\`文件夹说明符可能出现在路径**中不太可能在现实生活中
    看到，但类似于`C:\.\parent\child\..\.\child\``C:\parent\child`

7.  **路径可以选择用双引号括起来。**
    路径通常用引号括起来，以防止出现特殊字符，例如`<space>` `,` `;` `^` `&` `=`. 实际上，任何数量的引号都可以出现在路径之前、之中和/或之后。除了防止特殊字符之外，它们被 Windows 忽略。除非路径包含 a `;`，否则在 PATH 中永远不需要引号，但引号可能永远存在。

8.  **路径可以是完全限定的或相对的。**
    完全限定路径指向文件系统中的一个特定位置。相对路径位置根据当前工作卷和目录的值而变化。相对路径有三种主要风格：

    *   **`D:`**相对于卷 D 的当前工作目录：
    *   **`\myPath`**是相对于当前工作量的（可以是 C:, D: 等）
    *   **`myPath`**相对于当前工作卷和目录

    在 PATH 中包含相对路径是完全合法的。这在 Unix 世界中很常见，因为 Unix 默认不搜索当前目录，因此 Unix PATH 通常包含`.\`. 但是 Windows 默认会搜索当前目录，因此在 Windows PATH 中相对路径很少见。

因此，为了可靠地检查 PATH 是否已经包含路径，我们需要一种将任何给定路径转换为规范（标准）形式的方法。FOR 变量和参数扩展使用的`~s`修饰符是解决问题 1 - 6 和部分解决问题 7 的简单方法。`~s`修饰符删除封闭引号，但保留内部引号。问题 7 可以通过在比较之前从所有路径中显式删除引号来完全解决。请注意，如果路径实际上不存在，则`~s`修饰符不会将 附加`\`到路径，也不会将路径转换为有效的 8.3 格式。

问题`~s`在于它将相对路径转换为完全限定的路径。这对于问题 8 来说是有问题的，因为相对路径永远不应该与完全限定的路径匹配。我们可以使用 FINDSTR 正则表达式将路径分类为完全限定路径或相对路径。正常的完全限定路径必须以`<letter>:<separator>`but not开头`<letter>:<separator><separator>`，其中 <separator> 是`\`or `/`。UNC 路径始终是完全限定的，并且必须以`\\`. 在比较完全合格的路径时，我们使用`~s`修饰符。在比较相对路径时，我们使用原始字符串。最后，我们从不将完全限定路径与相对路径进行比较。此策略为问题 8 提供了一个很好的实用解决方案。唯一的限制是两个逻辑等效的相对路径可能被视为不匹配，但这是一个小问题，因为相对路径在 Windows PATH 中很少见。

还有一些额外的问题使这个问题复杂化：

9)**处理包含特殊字符的 PATH 时，正常扩展不可靠。**
特殊字符不需要在 PATH 中引用，但可以。所以像 PATH 一样 `C:\THIS & THAT;"C:\& THE OTHER THING"`是完全有效的，但它不能使用简单的扩展安全地扩展，因为两者`"%PATH%"`都会`%PATH%`失败。

10)**路径定界符在路径名中也有效**
A`;`用于在 PATH 中定界路径，但`;`也可以是路径中的有效字符，在这种情况下必须引用路径。这会导致解析问题。

jeb 在['Pretty print' windows %PATH% 变量中解决了问题 9 和 10 - 如何在 ';' 上拆分 在 CMD 外壳中](https://stackoverflow.com/questions/5471556/pretty-print-windows-path-variable-how-to-split-on-in-cmd-shell/5472168#5472168)

因此，我们可以将`~s`修饰符和路径分类技术与我对 jeb 的 PATH 解析器的变体结合起来，以获得这种几乎防弹的解决方案，用于检查给定路径是否已存在于 PATH 中。该函数可以在批处理文件中包含和调用，也可以独立运行并作为其自己的 inPath.bat 批处理文件调用。它看起来有很多代码，但其中一半以上是注释。

```
@echo off
:inPath pathVar
::
::  Tests if the path stored within variable pathVar exists within PATH.
::
::  The result is returned as the ERRORLEVEL:
::    0 if the pathVar path is found in PATH.
::    1 if the pathVar path is not found in PATH.
::    2 if pathVar is missing or undefined or if PATH is undefined.
::
::  If the pathVar path is fully qualified, then it is logically compared
::  to each fully qualified path within PATH. The path strings don't have
::  to match exactly, they just need to be logically equivalent.
::
::  If the pathVar path is relative, then it is strictly compared to each
::  relative path within PATH. Case differences and double quotes are
::  ignored, but otherwise the path strings must match exactly.
::
::------------------------------------------------------------------------
::
:: Error checking
if "%~1"=="" exit /b 2
if not defined %~1 exit /b 2
if not defined path exit /b 2
::
:: Prepare to safely parse PATH into individual paths
setlocal DisableDelayedExpansion
set "var=%path:"=""%"
set "var=%var:^=^^%"
set "var=%var:&=^&%"
set "var=%var:|=^|%"
set "var=%var:<=^<%"
set "var=%var:>=^>%"
set "var=%var:;=^;^;%"
set var=%var:""="%
set "var=%var:"=""Q%"
set "var=%var:;;="S"S%"
set "var=%var:^;^;=;%"
set "var=%var:""="%"
setlocal EnableDelayedExpansion
set "var=!var:"Q=!"
set "var=!var:"S"S=";"!"
::
:: Remove quotes from pathVar and abort if it becomes empty
set "new=!%~1:"=!"
if not defined new exit /b 2
::
:: Determine if pathVar is fully qualified
echo("!new!"|findstr /i /r /c:^"^^\"[a-zA-Z]:[\\/][^\\/]" ^
                           /c:^"^^\"[\\][\\]" >nul ^
  && set "abs=1" || set "abs=0"
::
:: For each path in PATH, check if path is fully qualified and then do
:: proper comparison with pathVar.
:: Exit with ERRORLEVEL 0 if a match is found.
:: Delayed expansion must be disabled when expanding FOR variables
:: just in case the value contains !
for %%A in ("!new!\") do for %%B in ("!var!") do (
  if "!!"=="" endlocal
  for %%C in ("%%~B\") do (
    echo(%%B|findstr /i /r /c:^"^^\"[a-zA-Z]:[\\/][^\\/]" ^
                           /c:^"^^\"[\\][\\]" >nul ^
      && (if %abs%==1 if /i "%%~sA"=="%%~sC" exit /b 0) ^
      || (if %abs%==0 if /i "%%~A"=="%%~C" exit /b 0)
  )
)
:: No match was found so exit with ERRORLEVEL 1
exit /b 1 
```

该函数可以这样使用（假设批处理文件名为 inPath.bat）：

```
set test=c:\mypath
call inPath test && (echo found) || (echo not found) 
```

* * *

通常，检查路径是否存在于 PATH 中的原因是，如果路径不存在，则要附加该路径。这通常只需使用类似`path %path%;%newPath%`. 但是第 9 期证明了这是不可靠的。

另一个问题是如何在函数结束时通过 ENDLOCAL 屏障返回最终的 PATH 值，特别是如果可以在启用或禁用延迟扩展的情况下调用该函数。`!`如果启用延迟扩展，任何未转义的值都会损坏该值。

使用 jeb 在这里发明的惊人的安全返回技术解决了这些问题：http: [//www.dostips.com/forum/viewtopic.php? p=6930#p6930](http://www.dostips.com/forum/viewtopic.php?p=6930#p6930)

```
@echo off
:addPath pathVar /B
::
::  Safely appends the path contained within variable pathVar to the end
::  of PATH if and only if the path does not already exist within PATH.
::
::  If the case insensitive /B option is specified, then the path is
::  inserted into the front (Beginning) of PATH instead.
::
::  If the pathVar path is fully qualified, then it is logically compared
::  to each fully qualified path within PATH. The path strings are
::  considered a match if they are logically equivalent.
::
::  If the pathVar path is relative, then it is strictly compared to each
::  relative path within PATH. Case differences and double quotes are
::  ignored, but otherwise the path strings must match exactly.
::
::  Before appending the pathVar path, all double quotes are stripped, and
::  then the path is enclosed in double quotes if and only if the path
::  contains at least one semicolon.
::
::  addPath aborts with ERRORLEVEL 2 if pathVar is missing or undefined
::  or if PATH is undefined.
::
::------------------------------------------------------------------------
::
:: Error checking
if "%~1"=="" exit /b 2
if not defined %~1 exit /b 2
if not defined path exit /b 2
::
:: Determine if function was called while delayed expansion was enabled
setlocal
set "NotDelayed=!"
::
:: Prepare to safely parse PATH into individual paths
setlocal DisableDelayedExpansion
set "var=%path:"=""%"
set "var=%var:^=^^%"
set "var=%var:&=^&%"
set "var=%var:|=^|%"
set "var=%var:<=^<%"
set "var=%var:>=^>%"
set "var=%var:;=^;^;%"
set var=%var:""="%
set "var=%var:"=""Q%"
set "var=%var:;;="S"S%"
set "var=%var:^;^;=;%"
set "var=%var:""="%"
setlocal EnableDelayedExpansion
set "var=!var:"Q=!"
set "var=!var:"S"S=";"!"
::
:: Remove quotes from pathVar and abort if it becomes empty
set "new=!%~1:"^=!"
if not defined new exit /b 2
::
:: Determine if pathVar is fully qualified
echo("!new!"|findstr /i /r /c:^"^^\"[a-zA-Z]:[\\/][^\\/]" ^
                           /c:^"^^\"[\\][\\]" >nul ^
  && set "abs=1" || set "abs=0"
::
:: For each path in PATH, check if path is fully qualified and then
:: do proper comparison with pathVar. Exit if a match is found.
:: Delayed expansion must be disabled when expanding FOR variables
:: just in case the value contains !
for %%A in ("!new!\") do for %%B in ("!var!") do (
  if "!!"=="" setlocal disableDelayedExpansion
  for %%C in ("%%~B\") do (
    echo(%%B|findstr /i /r /c:^"^^\"[a-zA-Z]:[\\/][^\\/]" ^
                           /c:^"^^\"[\\][\\]" >nul ^
      && (if %abs%==1 if /i "%%~sA"=="%%~sC" exit /b 0) ^
      || (if %abs%==0 if /i %%A==%%C exit /b 0)
  )
)
::
:: Build the modified PATH, enclosing the added path in quotes
:: only if it contains ;
setlocal enableDelayedExpansion
if "!new:;=!" neq "!new!" set new="!new!"
if /i "%~2"=="/B" (set "rtn=!new!;!path!") else set "rtn=!path!;!new!"
::
:: rtn now contains the modified PATH. We need to safely pass the
:: value accross the ENDLOCAL barrier
::
:: Make rtn safe for assignment using normal expansion by replacing
:: % and " with not yet defined FOR variables
set "rtn=!rtn:%%=%%A!"
set "rtn=!rtn:"=%%B!"
::
:: Escape ^ and ! if function was called while delayed expansion was enabled.
:: The trailing ! in the second assignment is critical and must not be removed.
if not defined NotDelayed set "rtn=!rtn:^=^^^^!"
if not defined NotDelayed set "rtn=%rtn:!=^^^!%" !
::
:: Pass the rtn value accross the ENDLOCAL barrier using FOR variables to
:: restore the % and " characters. Again the trailing ! is critical.
for /f "usebackq tokens=1,2" %%A in ('%%^ ^"') do (
  endlocal & endlocal & endlocal & endlocal & endlocal
  set "path=%rtn%" !
)
exit /b 0 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-26T19:19:31.737

我有一段时间没有进行任何批处理文件编程，但是：

```
echo ;%PATH%; | find /C /I ";<string>;" 
```

如果找不到字符串，应该给你 0，如果是，应该给你 1 或更多。

编辑：添加了不区分大小写的标志，感谢 Panos。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-04-01T09:24:15.493

检查路径中是否存在某些内容的另一种方法是执行一些无辜的可执行文件，如果它存在则不会失败，并检查结果。例如，下一个代码片段检查**maven**是否在路径中：

```
mvn --help > NUL 2> NUL 
if errorlevel 1 goto mvnNotInPath 
```

所以我尝试运行*mvn --help*，忽略输出（如果 maven 存在，实际上不想看到帮助）（> NUL），如果找不到 maven 也不显示错误消息（2>无）。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-10-28T19:06:25.383

在阅读了这里的答案后，我想我可以提供一个新的观点：如果这个问题的目的是知道*某个可执行文件的路径是否*存在`%PATH%`，如果不存在，则插入它（**这是唯一的**理由我认为），那么它可能会以稍微不同的方式解决：“如何检查某个可执行程序的目录是否存在于 %PATH% 中”？这个问题可以通过这种方式轻松解决：

```
for %%p in (programname.exe) do set "progpath=%%~$PATH:p"
if not defined progpath (
   rem The path to programname.exe don't exist in PATH variable, insert it:
   set "PATH=%PATH%;C:\path\to\progranname"
) 
```

如果您不知道可执行文件的扩展名，只需查看所有文件：

```
set "progpath="
for %%e in (%PATHEXT%) do (
   if not defined progpath (
      for %%p in (programname.%%e) do set "progpath=%%~$PATH:p"
   )
) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-01T14:04:07.193

使用[`for`](http://technet.microsoft.com/en-us/library/bb490909.aspx)and [`delims`](http://technet.microsoft.com/en-us/library/bb490909.aspx)，您无法捕获任意数量的字段（正如[Adam 指出的](https://stackoverflow.com/questions/141344/how-to-check-if-directory-exists-in-path#142381)那样），因此您必须使用循环技术。以下命令脚本将在`PATH`单独的行上列出环境变量中的每个路径：

```
@echo off 
setlocal 
if "%~1"=="" (
    set PATHQ=%PATH%
) else (
    set PATHQ=%~1 ) 
:WHILE
    if "%PATHQ%"=="" goto WEND
    for /F "delims=;" %%i in ("%PATHQ%") do echo %%i
    for /F "delims=; tokens=1,*" %%i in ("%PATHQ%") do set PATHQ=%%j
    goto WHILE 
:WEND 
```

它模拟了许多编程语言中的经典*while …<em>wend 构造。*有了这个，你可以使用类似的东西[`findstr`](http://technet.microsoft.com/en-us/library/bb490907.aspx)来过滤和寻找特定的路径。例如，如果您将上述脚本保存在一个名为`tidypath.cmd`then 的文件中，那么您可以通过管道传输到`findstr`，在标准程序目录下查找路径（使用不区分大小写的匹配）：

```
> tidypath | findstr /i "%ProgramFiles%" 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-04-06T21:10:29.877

这将寻找一个精确但不区分大小写的匹配，因此请注意任何尾随反斜杠等：

```
for %P in ("%path:;=";"%") do @if /i %P=="PATH_TO_CHECK" echo %P exists in PATH 
```

或者，在一个带有参数的批处理文件（例如 checkpath.bat）中：

```
@for %%P in ("%path:;=";"%") do @if /i %%P=="%~1" echo %%P exists in PATH 
```

在后一种形式中，可以调用 eg`checkpath "%ProgramFiles%"`来查看指定的路径是否已经存在于 PATH 中。

请注意，此实现假定单个路径项中不存在分号或引号。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-05-05T23:51:57.040

只是为了详细说明[Heyvoon (2015.06.08)](https://stackoverflow.com/a/30711326/2211788)使用 Powershell 的响应，这个简单的 Powershell 脚本应该为您提供有关 %path% 的详细信息

```
$env:Path -split ";" | % {"$(test-path $_);$_"} 
```

生成这种您可以独立验证的输出

```
True;C:\WINDOWS
True;C:\WINDOWS\system32
True;C:\WINDOWS\System32\Wbem
False;C:windows\System32\windowsPowerShell\v1.0\
False;C:\Program Files (x86)\Java\jre7\bin 
```

重新组装以更新路径：

```
$x=$null;foreach ($t in ($env:Path -split ";") ) {if (test-path $t) {$x+=$t+";"}};$x 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-07-23T18:40:48.823

您还可以使用子字符串替换来测试是否存在子字符串。在这里，我删除引号以创建 PATH_NQ，然后从 PATH_NQ 中删除“c:\mydir”并将其与原始文件进行比较以查看是否有任何更改：

```
set PATH_NQ=%PATH:"=%
if not "%PATH_NQ%"=="%PATH_NQ:c:\mydir=%" goto already_in_path
set PATH=%PATH%;c:\mydir
:already_in_path 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-26T22:36:27.037

如果您的问题是“为什么这个 cmd 脚本片段不起作用？” 那么答案是`for /f`遍历行。分割线成字段，`delims`但您只捕获`%%P`. 没有办法通过`for /f`循环捕获任意数量的字段。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-27T00:26:10.097

我使用*for*循环实现了您的实现，并将其扩展为迭代路径的所有元素的东西。for 循环的每次迭代都会从整个路径（保存在 %q 和 %r 中）中删除路径的第一个元素 (%p)。

```
@echo off
SET MYPATHCOPY=%PATH%

:search
for /f "delims=; tokens=1,2*" %%p in ("%MYPATHCOPY%") do (
   @echo %%~p
   SET MYPATHCOPY=%%~q;%%~r
)

if "%MYPATHCOPY%"==";" goto done;
goto search;

:done 
```

样本输出：

```
Z:\>path.bat
C:\Program Files\Microsoft DirectX SDK (November 2007)\Utilities\Bin\x86
c:\program files\imagemagick-6.3.4-q16
C:\WINDOWS\system32
C:\WINDOWS
C:\SFU\common\
c:\Program Files\Debugging Tools for Windows
C:\Program Files\Nmap 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-10-11T19:44:38.757

我结合了上面的一些答案来提出这个问题，以确保给定的路径条目*与给定* 的一样存在，并且尽可能简洁，并且在命令行上没有垃圾回声。

```
set myPath=<pathToEnsure | %1>
echo ;%PATH%; | find /C /I ";%myPath%;" >nul
if %ERRORLEVEL% NEQ 0 set PATH=%PATH%;%myPath% 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-06-13T15:37:09.630

一般来说，这是在路径上放置一个 exe/dll。只要此文件不会出现在其他任何地方：

```
@echo off
where /q <put filename here>    
if %errorlevel% == 1 (
    setx PATH "%PATH%;<additional path stuff>"
) else (
    echo "already set path"
) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-04-28T23:58:52.153

这是 Kevin Edwards 使用字符串替换的答案的变体。基本模式是：

```
IF "%PATH:new_path=%" == "%PATH%" PATH=%PATH%;new_path 
```

例如：

```
IF "%PATH:C:\Scripts=%" == "%PATH%" PATH=%PATH%;C:\Scripts 
```

简而言之，我们进行条件测试，尝试`new_path`从`PATH`环境变量中删除/替换。如果`new_path`不存在，则条件成功，并且`new_path`将`PATH`第一次附加到。如果`new_path`已经存在，则条件失败，我们不会添加`new_path`第二次。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-01T13:43:24.983

您提到如果目录已经存在，您希望避免将目录添加到搜索路径中。您打算将目录永久存储到路径中，还是只是为了批处理文件而暂时存储？

如果您希望将目录永久添加（或删除）到 PATH，请查看用于管理任务的 Windows 资源工具包工具中的路径管理器 (pathman.exe) 实用程序，[http://support.microsoft.com/kb/927229](http://support.microsoft.com/kb/927229)。有了它，您可以添加或删除系统和用户路径的组件，它将处理异常，例如重复条目。

如果您只需要临时修改批处理文件的路径，我只会在路径前面添加额外的路径，由于路径中的重复条目，存在轻微性能损失的风险。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T22:44:26.613

基于 rcar 的答案，您必须确保未找到目标的子字符串。

```
if a%X%==a%PATH% echo %X% is in PATH
echo %PATH% | find /c /i ";%X%"
if errorlevel 1 echo %X% is in PATH
echo %PATH% | find /c /i "%X%;"
if errorlevel 1 echo %X% is in PATH 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-04-06T22:59:52.650

作为替代方案：

1.  在您将要搜索`PATH`变量的文件夹中，创建一个临时文件，其名称如此不寻常，您永远不会期望计算机上的任何其他文件都有。

2.  使用标准的批处理脚本构造，该构造允许您通过查找由某个环境变量（通常为`PATH`）定义的目录列表来执行文件搜索。

3.  检查搜索结果是否与相关路径匹配，并显示结果。

4.  删除临时文件。

这可能看起来像这样：

```
@ECHO OFF
SET "mypath=D:\the\searched-for\path"
SET unusualname=nowthisissupposedtobesomeveryunusualfilename
ECHO.>"%mypath%\%unusualname%"
FOR %%f IN (%unusualname%) DO SET "foundpath=%%~dp$PATH:f"
ERASE "%mypath%\%unusualname%"
IF "%mypath%" == "%foundpath%" (
  ECHO The dir exists in PATH
) ELSE (
  ECHO The dir DOES NOT exist in PATH
) 
```

已知的问题：

1.  该方法仅在目录存在时才有效（并非总是如此）。

2.  在目录中创建/删除文件会影响其“修改日期/时间”属性（有时这可能是不良影响）。

3.  在一个人的脑海中编造一个全球唯一的文件名并不能被认为是非常可靠的。生成这样的名称本身并不是一项简单的任务。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-10-07T09:15:02.270

这个版本运行得相当好。它只是检查 vim71 是否在路径中，如果没有，则将其添加到前面。

```
@echo off
echo %PATH% | find /c /i "vim71" > nul
if not errorlevel 1 goto jump
PATH = C:\Program Files\Vim\vim71\;%PATH%
:jump 
```

这个demo是为了说明errorlevel的逻辑：

```
@echo on
echo %PATH% | find /c /i "Windows"
if "%errorlevel%"=="0" echo Found Windows
echo %PATH% | find /c /i "Nonesuch"
if "%errorlevel%"=="0" echo Found Nonesuch 
```

vim71 代码中的逻辑是相反的，因为 errorlevel 1 等价于 errorlevel >= 1。因此 errorlevel 0 将始终评估为真，因此`not errorlevel 1`使用“”。

**如果您使用 setlocal 和 endlocal 来本地化您的环境设置，则可能不需要**后记检查，例如****

 **```
@echo off
setlocal
PATH = C:\Program Files\Vim\vim71\;%PATH%
rem your code here
endlocal 
```

在 endlocal 之后，您将返回原始路径。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-03-14T09:23:23.083

如果目录不存在，则将目录添加到 PATH：

```
set myPath=c:\mypath
For /F "Delims=" %%I In ('echo %PATH% ^| find /C /I "%myPath%"') Do set pathExists=%%I 2>Nul
If %pathExists%==0 (set PATH=%myPath%;%PATH%) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-12-14T09:51:33.503

对“addPath”脚本的注释；当提供带有空格的路径时，它会抛出。

示例：调用 addPath "c:\Program Files (x86)\Microsoft SDKs\Windows\v7.0A\Bin"

产生：“文件”不是内部或外部命令、可运行程序或批处理文件。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-06-08T14:06:01.887

您可以使用 PoweShell 完成此操作；

```
Test-Path $ENV:SystemRoot\YourDirectory
Test-Path C:\Windows\YourDirectory 
```

这返回`TRUE`或`FALSE`

简短、简单、容易！

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-10-14T17:07:19.937

此例程将在路径变量中搜索 path\ 或 file.ext，如果找到则返回 0。如果引用，路径\ 或文件可能包含空格。如果一个变量作为最后一个参数传递，它将被设置为`d:\path\file`.

```
@echo off&goto :PathCheck
:PathCheck.CMD
echo.PathCheck.CMD: Checks for existence of a path or file in %%PATH%% variable
echo.Usage: PathCheck.CMD [Checkpath] or [Checkfile] [PathVar]
echo.Checkpath must have a trailing \ but checkfile must not
echo.If Checkpath contains spaces use quotes ie. "C:\Check path\"
echo.Checkfile must not include a path, just the filename.ext
echo.If Checkfile contains spaces use quotes ie. "Check File.ext"
echo.Returns 0 if found, 1 if not or -1 if checkpath does not exist at all
echo.If PathVar is not in command line it will be echoed with surrounding quotes
echo.If PathVar is passed it will be set to d:\path\checkfile with no trailing \
echo.Then %%PathVar%% will be set to the fully qualified path to Checkfile
echo.Note: %%PathVar%% variable set will not be surrounded with quotes
echo.To view the path listing line by line use: PathCheck.CMD /L
exit/b 1

:PathCheck
if "%~1"=="" goto :PathCheck.CMD
setlocal EnableDelayedExpansion
set "PathVar=%~2"
set "pth="
set "pcheck=%~1"
if "%pcheck:~-1%" equ "\" (
  if not exist %pcheck% endlocal&exit/b -1
  set/a pth=1
) 
for %%G in ("%path:;=" "%") do (
  set "Pathfd=%%~G\"
  set "Pathfd=!Pathfd:\\=\!"
  if /i "%pcheck%" equ "/L" echo.!Pathfd!
  if defined pth (
    if /i "%pcheck%" equ "!Pathfd!" endlocal&exit/b 0
  ) else (
    if exist "!Pathfd!%pcheck%" goto :CheckfileFound
  )
)
endlocal&exit/b 1

:CheckfileFound
endlocal&(
  if not "%PathVar%"=="" (
    call set "%~2=%Pathfd%%pcheck%"
  ) else (echo."%Pathfd%%pcheck%")
  exit/b 0
) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-01-07T06:44:29.283

```
rem https://stackoverflow.com/a/59571160/2292993
rem Don't get mess with %PATH%, it is a concatenation of USER+SYSTEM, and will cause a lot of duplication in the result. 
for /f "usebackq tokens=2,*" %%A in (`reg query HKCU\Environment /v PATH`) do set userPATH=%%B
rem userPATH should be %USERPROFILE%\AppData\Local\Microsoft\WindowsApps

rem https://stackoverflow.com/questions/141344
for /f "delims=" %%A in ('echo ";%userPATH%;" ^| find /C /I ";%WINAPPS%;"') do set pathExists=%%A
If %pathExists%==0 (
    echo Inserting user path...
    setx PATH "%WINAPPS%; %userPATH%"
) 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-07-04T08:03:31.233

`-contains`为我工作

```
$pathToCheck = "c:\some path\to\a\file.txt"

$env:Path - split ';' -contains $pathToCheck 
```

在路径不存在时添加路径我使用

```
$pathToCheck = "c:\some path\to\a\file.txt"

if(!($env:Path -split ';' -contains $vboxPath)) {
  $documentsDir = [Environment]::GetFolderPath("MyDocuments")
  $profileFilePath = Join-Path $documentsDir "WindowsPowerShell/profile.ps1"
  Out-File -FilePath $profileFilePath -Append -Force -Encoding ascii -InputObject "`$env:Path += `";$pathToCheck`""
  Invoke-Expression -command $profileFilePath
} 
```

# xml - xsl 范围帮助

> ID：141345
> 
> 赞同：0
> 
> 时间：2008-09-26T19:12:32.003
> 
> 标签：xml, templates, xslt

我有一个 xsl 文件，它从 xml 中获取变量，它们似乎无法看到对方。我知道这是一个范围问题，我只是不知道我做错了什么。

```
<xsl:template match="one">
 <xsl:variable name="varOne" select="@count" />
</xsl:template>

<xsl:template match="two">
 <xsl:if test="$varOne = 'Y'">
     <xsl:value-of select="varTwo"/>
 </xsl:if>
</xsl:template> 
```

此处已对此进行了简化。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T19:35:44.287

您还可以通过传递参数来解决一些范围界定问题......

```
<xsl:apply-templates select="two">
 <xsl:with-param name="varOne">
  <xsl:value-of select="one/@count"/>
 </xsl:with-param>
</xsl:apply-templates>

<xsl:template match="two">
 <xsl:param name="varOne"/>
 <xsl:if test="$varOne = 'Y'">
     <xsl:value-of select="varTwo"/>
 </xsl:if>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:14:53.543

我相当确定变量是有范围的，因此您不能在一个变量中声明一个变量，然后在另一个变量中使用它。您将不得不将变量声明移出模板，以便它位于比它们都更高的范围内。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T19:23:33.117

记住 xsl 变量是不可变的......

```
<!-- You may want to use absolute path -->
<xsl:variable name="varOne" select="one/@count" />

<xsl:template match="one">
<!-- // do something --> 
</xsl:template>

<xsl:template match="two">
 <xsl:if test="$varOne = 'Y'">
     <xsl:value-of select="varTwo"/>
 </xsl:if>
</xsl:template> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-27T02:10:50.187

XSLT 中变量的范围是它的封闭元素。要使变量对多个元素可见，其声明必须与这些元素处于相同级别或更高级别。

# javascript - 如何从 JavaScript 中的用户输入将时间解析为 Date 对象？

> ID：141348
> 
> 赞同：74
> 
> 时间：2008-09-26T19:13:02.237
> 
> 标签：javascript, datetime, parsing, date, time

我正在开发一个表单小部件，供用户在文本输入中输入一天中的时间（用于日历应用程序）。使用 JavaScript（我们使用 jQuery FWIW），我想找到解析用户输入到 JavaScript`Date()`对象中的文本的最佳方法，以便我可以轻松地对其进行比较和其他操作。

我尝试了这种`parse()`方法，但它对我的需求来说有点太挑剔了。我希望它能够成功地将以下示例输入时间（除了其他逻辑上相似的时间格式）解析为同一个`Date()`对象：

*   1:00 PM
*   1:00 PM
*   下午 1:00
*   1:00 PM
*   1:00 PM。
*   下午 1:00
*   下午 1 点
*   下午 1 点
*   1个
*   下午 1 点
*   下午 1 点
*   1便士
*   13:00
*   13

我在想我可能会使用正则表达式来拆分输入并提取我想用来创建`Date()`对象的信息。做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-26T19:44:31.240

适用于您指定的输入的快速解决方案：

```
function parseTime( t ) {
   var d = new Date();
   var time = t.match( /(\d+)(?::(\d\d))?\s*(p?)/ );
   d.setHours( parseInt( time[1]) + (time[3] ? 12 : 0) );
   d.setMinutes( parseInt( time[2]) || 0 );
   return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

它也应该适用于其他一些品种（例如，即使使用 am，它仍然可以工作）。显然这很粗糙，但也很轻巧（例如，使用它比使用完整的库便宜得多）。

> 警告：代码不适用于 12:00 AM 等。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2010-02-02T23:50:20.430

提供的所有示例在上午 12:00 到上午 12:59 的时间段内都无法工作。如果正则表达式与时间不匹配，它们也会引发错误。下面处理这个：

```
function parseTime(timeString) {	
	if (timeString == '') return null;

	var time = timeString.match(/(\d+)(:(\d\d))?\s*(p?)/i);	
	if (time == null) return null;

	var hours = parseInt(time[1],10);	 
	if (hours == 12 && !time[4]) {
		  hours = 0;
	}
	else {
		hours += (hours < 12 && time[4])? 12 : 0;
	}	
	var d = new Date();    	    	
	d.setHours(hours);
	d.setMinutes(parseInt(time[3],10) || 0);
	d.setSeconds(0, 0);	 
	return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

这适用于其中包含时间的字符串。因此“abcde12:00pmdef”将被解析并返回下午 12 点。如果期望的结果是它只返回字符串中仅包含时间的时间，则可以使用以下正则表达式，前提是您将“time[4]”替换为“time[6]”。

```
/^(\d+)(:(\d\d))?\s*((a|(p))m?)?$/i 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-09-26T19:18:52.817

不要费心自己做，只需使用[datejs](http://www.datejs.com/)。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2013-02-09T11:02:13.393

当无法解析字符串时，这里的大多数正则表达式解决方案都会引发错误，并且其中没有多少会考虑诸如`1330`or之类的字符串`130pm`。尽管 OP 没有指定这些格式，但我发现它们对于解析人类输入的日期至关重要。

所有这些让我想到使用正则表达式可能不是最好的方法。

我的解决方案是一个函数，它不仅解析时间，还允许您指定输出格式和将分钟舍入到的步长（间隔）。大约 70 行，它仍然是轻量级的，可以解析所有上述格式以及不带冒号的格式。

*   演示：http: [//jsfiddle.net/HwwzS/1/](http://jsfiddle.net/HwwzS/1/)
*   代码：[https ://gist.github.com/claviska/4744736](https://gist.github.com/claviska/4744736)

```
function parseTime(time, format, step) {

	var hour, minute, stepMinute,
		defaultFormat = 'g:ia',
		pm = time.match(/p/i) !== null,
		num = time.replace(/[^0-9]/g, '');

	// Parse for hour and minute
	switch(num.length) {
		case 4:
			hour = parseInt(num[0] + num[1], 10);
			minute = parseInt(num[2] + num[3], 10);
			break;
		case 3:
			hour = parseInt(num[0], 10);
			minute = parseInt(num[1] + num[2], 10);
			break;
		case 2:
		case 1:
			hour = parseInt(num[0] + (num[1] || ''), 10);
			minute = 0;
			break;
		default:
			return '';
	}

	// Make sure hour is in 24 hour format
	if( pm === true && hour > 0 && hour < 12 ) hour += 12;

	// Force pm for hours between 13:00 and 23:00
	if( hour >= 13 && hour <= 23 ) pm = true;

	// Handle step
	if( step ) {
		// Step to the nearest hour requires 60, not 0
		if( step === 0 ) step = 60;
		// Round to nearest step
		stepMinute = (Math.round(minute / step) * step) % 60;
		// Do we need to round the hour up?
		if( stepMinute === 0 && minute >= 30 ) {
			hour++;
			// Do we need to switch am/pm?
			if( hour === 12 || hour === 24 ) pm = !pm;
		}
		minute = stepMinute;
	}

	// Keep within range
	if( hour <= 0 || hour >= 24 ) hour = 0;
	if( minute < 0 || minute > 59 ) minute = 0;

	// Format output
	return (format || defaultFormat)
		// 12 hour without leading 0
        .replace(/g/g, hour === 0 ? '12' : 'g')
		.replace(/g/g, hour > 12 ? hour - 12 : hour)
		// 24 hour without leading 0
		.replace(/G/g, hour)
		// 12 hour with leading 0
		.replace(/h/g, hour.toString().length > 1 ? (hour > 12 ? hour - 12 : hour) : '0' + (hour > 12 ? hour - 12 : hour))
		// 24 hour with leading 0
		.replace(/H/g, hour.toString().length > 1 ? hour : '0' + hour)
		// minutes with leading zero
		.replace(/i/g, minute.toString().length > 1 ? minute : '0' + minute)
		// simulate seconds
		.replace(/s/g, '00')
		// lowercase am/pm
		.replace(/a/g, pm ? 'pm' : 'am')
		// lowercase am/pm
		.replace(/A/g, pm ? 'PM' : 'AM');
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-03T19:33:01.963

这是对[Joe 版本](http://#253680)的改进。随意进一步编辑它。

```
function parseTime(timeString)
{
  if (timeString == '') return null;
  var d = new Date();
  var time = timeString.match(/(\d+)(:(\d\d))?\s*(p?)/i);
  d.setHours( parseInt(time[1],10) + ( ( parseInt(time[1],10) < 12 && time[4] ) ? 12 : 0) );
  d.setMinutes( parseInt(time[3],10) || 0 );
  d.setSeconds(0, 0);
  return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

变化：

*   向 parseInt() 调用添加了 radix 参数（因此 jslint 不会抱怨）。
*   使正则表达式不区分大小写，因此“2:23 PM”的工作方式类似于“2:23 pm”

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-31T14:21:17.537

在实施 John Resig 的解决方案时，我遇到了一些问题。这是我根据他的回答一直在使用的修改后的功能：

```
function parseTime(timeString)
{
  if (timeString == '') return null;
  var d = new Date();
  var time = timeString.match(/(\d+)(:(\d\d))?\s*(p?)/);
  d.setHours( parseInt(time[1]) + ( ( parseInt(time[1]) < 12 && time[4] ) ? 12 : 0) );
  d.setMinutes( parseInt(time[3]) || 0 );
  d.setSeconds(0, 0);
  return d;
} // parseTime()

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-10-22T15:29:16.520

对于所有使用支持的 24 小时时钟的人来说，这里有一个解决方案：

*   0820 -> 08:20
*   32 -> 03:02
*   124 -> 12:04

```
function parseTime(text) {
  var time = text.match(/(\d?\d):?(\d?\d?)/);
	var h = parseInt(time[1], 10);
	var m = parseInt(time[2], 10) || 0;

	if (h > 24) {
        // try a different format
		time = text.match(/(\d)(\d?\d?)/);
		h = parseInt(time[1], 10);
		m = parseInt(time[2], 10) || 0;
	} 

  var d = new Date();
  d.setHours(h);
  d.setMinutes(m);
  return d;		
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-02-21T20:22:20.250

这是一种更可靠的方法，它考虑了用户打算如何使用这种类型的输入。例如，如果用户输入“12”，他们会认为是中午 12 点（中午），而不是上午 12 点。下面的函数处理所有这些。它也可以在这里找到：[http ://blog.de-zwart.net/2010-02/javascript-parse-time/](http://blog.de-zwart.net/2010-02/javascript-parse-time/)

```
/**
 * Parse a string that looks like time and return a date object.
 * @return  Date object on success, false on error.
 */
String.prototype.parseTime = function() {
    // trim it and reverse it so that the minutes will always be greedy first:
    var value = this.trim().reverse();

    // We need to reverse the string to match the minutes in greedy first, then hours
    var timeParts = value.match(/(a|p)?\s*((\d{2})?:?)(\d{1,2})/i);

    // This didnt match something we know
    if (!timeParts) {
        return false;
    }

    // reverse it:
    timeParts = timeParts.reverse();

    // Reverse the internal parts:
    for( var i = 0; i < timeParts.length; i++ ) {
        timeParts[i] = timeParts[i] === undefined ? '' : timeParts[i].reverse();
    }

    // Parse out the sections:
    var minutes = parseInt(timeParts[1], 10) || 0;
    var hours = parseInt(timeParts[0], 10);
    var afternoon = timeParts[3].toLowerCase() == 'p' ? true : false;

    // If meridian not set, and hours is 12, then assume afternoon.
    afternoon = !timeParts[3] && hours == 12 ? true : afternoon;
    // Anytime the hours are greater than 12, they mean afternoon
    afternoon = hours > 12 ? true : afternoon;
    // Make hours be between 0 and 12:
    hours -= hours > 12 ? 12 : 0;
    // Add 12 if its PM but not noon
    hours += afternoon && hours != 12 ? 12 : 0;
    // Remove 12 for midnight:
    hours -= !afternoon && hours == 12 ? 12 : 0;

    // Check number sanity:
    if( minutes >= 60 || hours >= 24 ) {
        return false;
    }

    // Return a date object with these values set.
    var d = new Date();
    d.setHours(hours);
    d.setMinutes(minutes);
    return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + tests[i].parseTime() );
}
```

这是一个字符串原型，所以你可以像这样使用它：

```
var str = '12am';
var date = str.parseTime(); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-03-04T01:08:26.007

[时间](https://github.com/zackdever/time)包大小为 0.9kbs 。可与 NPM 和 bower 包管理器一起使用。

这是一个直接来自的示例`README.md`：

```
var t = Time('2p');
t.hours();             // 2
t.minutes();           // 0
t.period();            // 'pm'
t.toString();          // '2:00 pm'
t.nextDate();          // Sep 10 2:00 (assuming it is 1 o'clock Sep 10)
t.format('hh:mm AM')   // '02:00 PM'
t.isValid();           // true
Time.isValid('99:12'); // false 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-12-12T07:36:40.560

**其他答案汇编表**

首先，我*不敢相信*没有内置功能，甚至没有强大的第三方库可以处理这个问题。实际上，这是网络开发，所以我可以相信。

试图用所有这些不同的算法测试所有边缘情况让我头晕目眩，所以我冒昧地将这个线程中的所有答案和测试编译到一个方便的表格中。

代码（和结果表）对于包含内联来说毫无意义，所以我制作了一个 JSFiddle：

[http://jsfiddle.net/jLv16ydb/4/show](http://jsfiddle.net/jLv16ydb/4/show)

```
// heres some filler code of the functions I included in the test,
// because StackOverfleaux wont let me have a jsfiddle link without code
Functions = [
    JohnResig,
    Qwertie,
    PatrickMcElhaney,
    Brad,
    NathanVillaescusa,
    DaveJarvis,
    AndrewCetinic,
    StefanHaberl,
    PieterDeZwart,
    JoeLencioni,
    Claviska,
    RobG,
    DateJS,
    MomentJS
];
// I didn't include `date-fns`, because it seems to have even more
// limited parsing than MomentJS or DateJS 
```

*请随时 fork 我的小提琴并添加更多算法和测试用例*

我没有在结果和“预期”输出之间添加任何比较，因为在某些情况下“预期”输出可能会引起争论（例如，应该`12`解释为`12:00am`或`12:00pm`？）。您将不得不浏览表格，看看哪种算法对您最有意义。

**注意：**颜色不一定表示输出的质量或“预期”，它们仅表示输出的类型：

*   `red`= js 错误抛出

*   `yellow`=“假”值（`undefined`, `null`, `NaN`, `""`, `"invalid date"`）

*   `green`= js`Date()`对象

*   `light green`=其他一切

如果`Date()`对象是输出，我将其转换为 24 小时`HH:mm`格式以便于比较。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-03-19T09:32:05.433

AnyTime.Converter 可以解析多种不同格式的日期/时间：

[http://www.ama3.com/anytime/](http://www.ama3.com/anytime/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-12-06T05:57:33.583

我对上面的函数做了一些修改，以支持更多的格式。

*   1400 -> 下午 2:00
*   1.30 -> 下午 1:30
*   凌晨 1:30 -> 凌晨 1:30
*   100 -> 上午 1:00

还没有清理它，但适用于我能想到的一切。

```
function parseTime(timeString) {
    if (timeString == '') return null;

    var time = timeString.match(/^(\d+)([:\.](\d\d))?\s*((a|(p))m?)?$/i);

    if (time == null) return null;

    var m = parseInt(time[3], 10) || 0;
    var hours = parseInt(time[1], 10);

    if (time[4]) time[4] = time[4].toLowerCase();

    // 12 hour time
    if (hours == 12 && !time[4]) {
        hours = 12;
    }
    else if (hours == 12 && (time[4] == "am" || time[4] == "a")) {
        hours += 12;
    }
    else if (hours < 12 && (time[4] != "am" && time[4] != "a")) {
        hours += 12;
    }
    // 24 hour time
    else if(hours > 24 && hours.toString().length >= 3) {
        if(hours.toString().length == 3) {
           m = parseInt(hours.toString().substring(1,3), 10);
           hours = parseInt(hours.toString().charAt(0), 10);
        }
        else if(hours.toString().length == 4) {
           m = parseInt(hours.toString().substring(2,4), 10);
           hours = parseInt(hours.toString().substring(0,2), 10);
        }
    }

    var d = new Date();
    d.setHours(hours);
    d.setMinutes(m);
    d.setSeconds(0, 0);
    return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-01-05T11:48:14.923

很多答案，所以一个不会伤害。

```
/**
 * Parse a time in nearly any format
 * @param {string} time - Anything like 1 p, 13, 1:05 p.m., etc.
 * @returns {Date} - Date object for the current date and time set to parsed time
*/
function parseTime(time) {
  var b = time.match(/\d+/g);

  // return undefined if no matches
  if (!b) return;

  var d = new Date();
  d.setHours(b[0]>12? b[0] : b[0]%12 + (/p/i.test(time)? 12 : 0), // hours
             /\d/.test(b[1])? b[1] : 0,     // minutes
             /\d/.test(b[2])? b[2] : 0);    // seconds
  return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

为了适当地健壮，它应该检查每个值是否在允许值的范围内，例如，如果上午/下午时间必须是 1 到 12（含），否则是 0 到 24（含）等。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-03-09T01:08:18.140

这是另一种方法，涵盖了原始答案、任何合理的数字、猫的数据输入和逻辑谬误。算法如下：

1.  判断子午线是否为[后子午线](https://en.wikipedia.org/wiki/12-hour_clock)。
2.  将输入数字转换为整数值。
3.  0 到 24 之间的时间：小时是点，没有分钟（12 小时是下午）。
4.  100 到 2359 之间的时间：小时 div 100 是点钟，分钟 mod 100 余数。
5.  从 2400 开始的时间：小时是午夜，剩余分钟。
6.  当小时数超过 12 时，减去 12 并强制 post meridiem 为真。
7.  当分钟超过 59 时，强制为 59。

将小时、分钟和 post meridiem 转换为 Date 对象是读者的练习（许多其他答案显示了如何执行此操作）。

```
"use strict";

String.prototype.toTime = function () {
  var time = this;
  var post_meridiem = false;
  var ante_meridiem = false;
  var hours = 0;
  var minutes = 0;

  if( time != null ) {
    post_meridiem = time.match( /p/i ) !== null;
    ante_meridiem = time.match( /a/i ) !== null;

    // Preserve 2400h time by changing leading zeros to 24.
    time = time.replace( /^00/, '24' );

    // Strip the string down to digits and convert to a number.
    time = parseInt( time.replace( /\D/g, '' ) );
  }
  else {
    time = 0;
  }

  if( time > 0 && time < 24 ) {
    // 1 through 23 become hours, no minutes.
    hours = time;
  }
  else if( time >= 100 && time <= 2359 ) {
    // 100 through 2359 become hours and two-digit minutes.
    hours = ~~(time / 100);
    minutes = time % 100;
  }
  else if( time >= 2400 ) {
    // After 2400, it's midnight again.
    minutes = (time % 100);
    post_meridiem = false;
  }

  if( hours == 12 && ante_meridiem === false ) {
    post_meridiem = true;
  }

  if( hours > 12 ) {
    post_meridiem = true;
    hours -= 12;
  }

  if( minutes > 59 ) {
    minutes = 59;
  }

  var result =
    (""+hours).padStart( 2, "0" ) + ":" + (""+minutes).padStart( 2, "0" ) +
    (post_meridiem ? "PM" : "AM");

  return result;
};

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + tests[i].toTime() );
}
```

使用 jQuery，新定义的 String 原型使用​​如下：

```
 <input type="text" class="time" /> 
```

```
 $(".time").change( function() {
    var $this = $(this);
    $(this).val( time.toTime() );
  }); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-06-08T22:49:55.310

我对其他答案不满意，所以我又做了一个。这个版本：

*   识别秒和毫秒
*   返回`undefined`无效输入，例如“13:00pm”或“11:65”
*   如果您提供`localDate`参数，则返回本地时间，否则返回 Unix 纪元（1970 年 1 月 1 日）的 UTC 时间。
*   支持军事时间`1330`（要禁用，请在正则表达式中设置第一个'：'）
*   单独允许一个小时，24 小时制（即“7”表示早上 7 点）。
*   允许 24 小时作为 0 小时的同义词，但不允许 25 小时。
*   要求时间在字符串的开头（禁用，`^\s*`在正则表达式中删除）
*   具有实际检测输出何时不正确的测试代码。

编辑：它现在是一个包含格式化程序的[包：](https://www.npmjs.com/package/simplertime)`timeToString``npm i simplertime`

* * *

```
/**
 * Parses a string into a Date. Supports several formats: "12", "1234",
 * "12:34", "12:34pm", "12:34 PM", "12:34:56 pm", and "12:34:56.789".
 * The time must be at the beginning of the string but can have leading spaces.
 * Anything is allowed after the time as long as the time itself appears to
 * be valid, e.g. "12:34*Z" is OK but "12345" is not.
 * @param {string} t Time string, e.g. "1435" or "2:35 PM" or "14:35:00.0"
 * @param {Date|undefined} localDate If this parameter is provided, setHours
 *        is called on it. Otherwise, setUTCHours is called on 1970/1/1.
 * @returns {Date|undefined} The parsed date, if parsing succeeded.
 */
function parseTime(t, localDate) {
  // ?: means non-capturing group and ?! is zero-width negative lookahead
  var time = t.match(/^\s*(\d\d?)(?::?(\d\d))?(?::(\d\d))?(?!\d)(\.\d+)?\s*(pm?|am?)?/i);
  if (time) {
    var hour = parseInt(time[1]), pm = (time[5] || ' ')[0].toUpperCase();
    var min = time[2] ? parseInt(time[2]) : 0;
    var sec = time[3] ? parseInt(time[3]) : 0;
    var ms = (time[4] ? parseFloat(time[4]) * 1000 : 0);
    if (pm !== ' ' && (hour == 0 || hour > 12) || hour > 24 || min >= 60 || sec >= 60)
      return undefined;
    if (pm === 'A' && hour === 12) hour = 0;
    if (pm === 'P' && hour !== 12) hour += 12;
    if (hour === 24) hour = 0;
    var date = new Date(localDate!==undefined ? localDate.valueOf() : 0);
    var set = (localDate!==undefined ? date.setHours : date.setUTCHours);
    set.call(date, hour, min, sec, ms);
    return date;
  }
  return undefined;
}

var testSuite = {
  '1300':  ['1:00 pm','1:00 P.M.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
            '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1:00:00PM', '1300', '13'],
  '1100':  ['11:00am', '11:00 AM', '11:00', '11:00:00', '1100'],
  '1359':  ['1:59 PM', '13:59', '13:59:00', '1359', '1359:00', '0159pm'],
  '100':   ['1:00am', '1:00 am', '0100', '1', '1a', '1 am'],
  '0':     ['00:00', '24:00', '12:00am', '12am', '12:00:00 AM', '0000', '1200 AM'],
  '30':    ['0:30', '00:30', '24:30', '00:30:00', '12:30:00 am', '0030', '1230am'],
  '1435':  ["2:35 PM", "14:35:00.0", "1435"],
  '715.5': ["7:15:30", "7:15:30am"],
  '109':   ['109'], // Three-digit numbers work (I wasn't sure if they would)
  '':      ['12:60', '11:59:99', '-12:00', 'foo', '0660', '12345', '25:00'],
};

var passed = 0;
for (var key in testSuite) {
  let num = parseFloat(key), h = num / 100 | 0;
  let m = num % 100 | 0, s = (num % 1) * 60;
  let expected = Date.UTC(1970, 0, 1, h, m, s); // Month is zero-based
  let strings = testSuite[key];
  for (let i = 0; i < strings.length; i++) {
    var result = parseTime(strings[i]);
    if (result === undefined ? key !== '' : key === '' || expected !== result.valueOf()) {
      console.log(`Test failed at ${key}:"${strings[i]}" with result ${result ? result.toUTCString() : 'undefined'}`);
    } else {
      passed++;
    }
  }
}
console.log(passed + ' tests passed.'); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T19:40:51.937

为什么不使用验证来缩小用户可以输入的范围并简化列表以仅包含可以解析（或经过一些调整后解析）的格式。

我认为要求用户以受支持的格式投入时间并不过分。

dd:dd A(m)/P(m)

dd A(米)/P(米)

dd

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-11T11:43:47.280

```
/(\d+)(?::(\d\d))(?::(\d\d))?\s*([pP]?)/ 

// added test for p or P
// added seconds

d.setHours( parseInt(time[1]) + (time[4] ? 12 : 0) ); // care with new indexes
d.setMinutes( parseInt(time[2]) || 0 );
d.setSeconds( parseInt(time[3]) || 0 ); 
```

谢谢

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-10-22T14:50:50.170

Patrick McElhaney 的解决方案的改进（他没有正确处理上午 12 点）

```
function parseTime( timeString ) {
var d = new Date();
var time = timeString.match(/(\d+)(:(\d\d))?\s*([pP]?)/i);
var h = parseInt(time[1], 10);
if (time[4])
{
    if (h < 12)
        h += 12;
}
else if (h == 12)
    h = 0;
d.setHours(h);
d.setMinutes(parseInt(time[3], 10) || 0);
d.setSeconds(0, 0);
return d;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-08-22T15:04:17.327

如果你只想要几秒钟这里是一个班轮

```
const toSeconds = s => s.split(':').map(v => parseInt(v)).reverse().reduce((acc,e,i) => acc + e * Math.pow(60,i)) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-12-12T22:46:26.747

在通过[我的其他编译答案](https://stackoverflow.com/questions/141348/what-is-the-best-way-to-parse-a-time-into-a-date-object-from-user-input-in-javas/53738137#53738137)进行彻底测试和调查后，我得出结论，@Dave Jarvis 的解决方案最接近我认为的合理输出和边缘情况处理。作为参考，我查看了退出文本框后谷歌日历的时间输入将时间重新格式化为什么。

尽管如此，我还是看到它没有处理谷歌日历所做的一些（尽管很奇怪）边缘情况。所以我从头开始重新设计它，这就是我想出的。我还将它添加到[我的编译答案](https://stackoverflow.com/questions/141348/what-is-the-best-way-to-parse-a-time-into-a-date-object-from-user-input-in-javas/53738137#53738137)中。

```
// attempt to parse string as time. return js date object
function parseTime(string) {
  string = String(string);

  var am = null;

  // check if "apm" or "pm" explicitly specified, otherwise null
  if (string.toLowerCase().includes("p")) am = false;
  else if (string.toLowerCase().includes("a")) am = true;

  string = string.replace(/\D/g, ""); // remove non-digit characters
  string = string.substring(0, 4); // take only first 4 digits
  if (string.length === 3) string = "0" + string; // consider eg "030" as "0030"
  string = string.replace(/^00/, "24"); // add 24 hours to preserve eg "0012" as "00:12" instead of "12:00", since will be converted to integer

  var time = parseInt(string); // convert to integer
  // default time if all else fails
  var hours = 12,
    minutes = 0;

  // if able to parse as int
  if (Number.isInteger(time)) {
    // treat eg "4" as "4:00pm" (or "4:00am" if "am" explicitly specified)
    if (time >= 0 && time <= 12) {
      hours = time;
      minutes = 0;
      // if "am" or "pm" not specified, establish from number
      if (am === null) {
        if (hours >= 1 && hours <= 12) am = false;
        else am = true;
      }
    }
    // treat eg "20" as "8:00pm"
    else if (time >= 13 && time <= 99) {
      hours = time % 24;
      minutes = 0;
      // if "am" or "pm" not specified, force "am"
      if (am === null) am = true;
    }
    // treat eg "52:95" as 52 hours 95 minutes 
    else if (time >= 100) {
      hours = Math.floor(time / 100); // take first two digits as hour
      minutes = time % 100; // take last two digits as minute
      // if "am" or "pm" not specified, establish from number
      if (am === null) {
        if (hours >= 1 && hours <= 12) am = false;
        else am = true;
      }
    }

    // add 12 hours if "pm"
    if (am === false && hours !== 12) hours += 12;
    // sub 12 hours if "12:00am" (midnight), making "00:00"
    if (am === true && hours === 12) hours = 0;

    // keep hours within 24 and minutes within 60
    // eg 52 hours 95 minutes becomes 4 hours 35 minutes
    hours = hours % 24;
    minutes = minutes % 60;
  }

  // convert to js date object
  var date = new Date();
  date.setHours(hours);
  date.setMinutes(minutes);
  date.setSeconds(0);
  return date;
}

var tests = [
  '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '99999', '0000', '0011', '-1', 'mioaw' ];

for ( var i = 0; i < tests.length; i++ ) {
  console.log( tests[i].padStart( 9, ' ' ) + " = " + parseTime(tests[i]) );
}
```

我觉得这是我能满足我需求的最接近的方法，但欢迎提出建议。**注意：**这是以美国为中心的，因为它对于某些模式默认为 am/pm：

*   `1`=> `13:00`( `1:00pm`)
*   `1100`=> `23:00`( `11:00pm`)
*   `456`=> `16:56`( `4:56pm`)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-02-25T15:02:07.417

我需要一个时间解析器功能，并且根据一些答案，我最终得到了这个功能

```
 function parse(time){
  let post_meridiem = time.match(/p/i) !== null;
  let result;
  time = time.replace(/[^\d:-]/g, '');
  let hours = 0;
  let minutes = 0;
  if (!time) return;
  let parts = time.split(':');
  if (parts.length > 2) time = parts[0] + ':' + parts[1];
  if (parts[0] > 59 && parts.length === 2) time = parts[0];
  if (!parts[0] && parts[1] < 60) minutes = parts[1];
  else if (!parts[0] && parts[1] >= 60) return;
  time = time.replace(/^00/, '24');
  time = parseInt(time.replace(/\D/g, ''));
  if (time >= 2500) return;
  if (time > 0 && time < 24 && parts.length === 1) hours = time;
  else if (time < 59) minutes = time;
  else if (time >= 60 && time <= 99 && parts[0]) {
    hours = ('' + time)[0];
    minutes = ('' + time)[1];
  } else if (time >= 100 && time <= 2359) {
    hours = ~~(time / 100);
    minutes = time % 100;
  } else if (time >= 2400) {
    hours = ~~(time / 100) - 24;
    minutes = time % 100;
    post_meridiem = false;
  }
  if (hours > 59 || minutes > 59) return;
  if (post_meridiem && hours !== 0) hours += 12;
  if (minutes > 59) minutes = 59;
  if (hours > 23) hours = 0;
  result = ('' + hours).padStart(2, '0') + ':' + ('' + minutes).padStart(2, '0');
  return result;
}
 var tests = [
   '1:00 pm','1:00 p.m.','1:00 p','1:00pm','1:00p.m.','1:00p','1 pm',
  '1 p.m.','1 p','1pm','1p.m.', '1p', '13:00','13', '1a', '12', '12a', '12p', '12am', '12pm', '2400am', '2400pm', '2400', 
  '1000', '100', '123', '2459', '2359', '2359am', '1100', '123p',
  '1234', '1', '9', '99', '999', '9999', '0000', '0011', '-1', 'mioaw',
  "0820",
  "32",
  "124",
  "1330",
  "130pm",
  "456",
  ":40",
  ":90",
  "12:69",
  "50:90",
  "aaa12:34aaa",
  "aaa50:00aaa",
 ];

    for ( var i = 0; i < tests.length; i++ ) {
      console.log( tests[i].padStart( 9, ' ' ) + " = " + parse(tests[i]) );
    }
```

它也在其他答案的编译表上，这里是其他答案的分叉 [编译表](http://jsfiddle.net/gabihp30/8tur5kb4/9/)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-02-13T04:40:23.097

主要投票和选择的答案给我带来了麻烦并输出了荒谬的结果。下面是我的尝试，它似乎解决了大多数人遇到的所有问题，包括我的。我的一个附加功能是能够将“am”或“pm”指定为一天中的时间，以默认用户输入未指定（例如 1:00）。默认情况下，它设置为“pm”。

需要注意的一点是，此函数假定用户想要（并试图）提供一个表示时间输入的字符串。正因为如此，“输入验证和清理”只能排除任何会导致错误的东西，而不是任何看起来不一定像时间的东西。这最好由代码片段底部的数组中的最后三个测试条目来表示。

```
const parseTime = (timeString, assumedTimeOfDay = "pm") => {
  // Validate timeString input
  if (!timeString) return null

  const regex = /(\d{1,2})(\d{2})?([a|p]m?)?/
  const noOfDigits = timeString.replace(/[^\d]/g, "").length

  if (noOfDigits === 0) return null

  // Seconds are unsupported (rare use case in my eyes, feel free to edit)
  if (noOfDigits > 4) return null

  // Add a leading 0 to prevent bad regex match (i.e. 100 = 1hr 00min, not 10hr 0min)
  const sanitized = `${noOfDigits === 3 ? "0" : ""}${timeString}`
    .toLowerCase()
    .replace(/[^\dapm]/g, "")
  const parsed = sanitized.match(regex)

  if (!parsed) return null

  // Clean up and name parsed data
  const {
    input,
    hours,
    minutes,
    meridian
  } = {
    input: parsed[0],
    hours: Number(parsed[1] || 0),
    minutes: Number(parsed[2] || 0),
    // Defaults to pm if user provided assumedTimeOfDay is not am or pm
    meridian: /am/.test(`${parsed[3] || assumedTimeOfDay.toLowerCase()}m`) ?
      "am" : "pm",
  }

  // Quick check for valid numbers
  if (hours < 0 || hours >= 24 || minutes < 0 || minutes >= 60) return null

  // Convert hours to 24hr format
  const timeOfDay = hours >= 13 ? "pm" : meridian
  const newHours =
    hours >= 13 ?
    hours :
    hours === 12 && timeOfDay === "am" ?
    0 :
    (hours === 12 && timeOfDay === "pm") || timeOfDay === "am" ?
    hours :
    hours + 12

  // Convert data to Date object and return
  return new Date(new Date().setHours(newHours, minutes, 0))
}

const times = [
  '12',
  '12p',
  '12pm',
  '12p.m.',
  '12 p',
  '12 pm',
  '12 p.m.',
  '12:00',
  '12:00p',
  '12:00pm',
  '12:00p.m.',
  '12:00 p',
  '12:00 pm',
  '12:00 p.m.',
  '12:00',
  '12:00p',
  '12:00pm',
  '12:00p.m.',
  '12:00 p',
  '12:00 pm',
  '12:00 p.m.',
  '1200',
  '1200p',
  '1200pm',
  '1200p.m.',
  '1200 p',
  '1200 pm',
  '1200 p.m.',
  '12',
  '1200',
  '12:00',
  '1',
  '1p',
  '1pm',
  '1p.m.',
  '1 p',
  '1 pm',
  '1 p.m.',
  '1:00',
  '1:00p',
  '1:00pm',
  '1:00p.m.',
  '1:00 p',
  '1:00 pm',
  '1:00 p.m.',
  '01:00',
  '01:00p',
  '01:00pm',
  '01:00p.m.',
  '01:00 p',
  '01:00 pm',
  '01:00 p.m.',
  '0100',
  '0100p',
  '0100pm',
  '0100p.m.',
  '0100 p',
  '0100 pm',
  '0100 p.m.',
  '13',
  '1300',
  '13:00',
  'random',
  '092fsd9)*(U243',
  '092fsd9)*(U'
]

times.map(t => {
  const parsed = parseTime(t)

  if (parsed) {
    console.log(`${parsed.toLocaleTimeString()} from ${t}`)
  } else {
    console.log(`Invalid Time (${t})`)
  }
})
```

Although I've tested this quite a bit, I'm sure I tunnel-visioned on something. If someone is able to break it (in a reasonable way), please comment and I'll see about updating!

# python - 如何在生产系统的 Python 进程中找到正在使用内存的内容？

> ID：141351
> 
> 赞同：50
> 
> 时间：2008-09-26T19:13:14.793
> 
> 标签：python, memory-leaks, coredump

我的生产系统偶尔会出现内存泄漏，我无法在开发环境中重现。我在开发环境中使用了[Python 内存分析器](https://stackoverflow.com/questions/110259/python-memory-profiler)（特别是 Heapy）并取得了一些成功，但它无法帮助我处理无法重现的事情，而且我不愿意使用 Heapy 来检测我们的生产系统，因为它需要一段时间才能完成它的工作，并且它的线程远程接口在我们的服务器中无法正常工作。

我想我想要的是一种方法来转储生产 Python 进程（或至少 gc.get_objects）的快照，然后离线分析它以查看它在哪里使用内存。 [如何获得这样的 python 进程的核心转储？](https://stackoverflow.com/questions/141802/how-do-i-dump-an-entire-python-process-for-later-debugging-inspection) 一旦我有了一个，我该如何用它做一些有用的事情？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2012-03-05T13:56:17.080

使用 Python 的`gc`垃圾收集器接口，`sys.getsizeof()`可以转储所有 Python 对象及其大小。这是我在生产中用于解决内存泄漏的代码：

```
rss = psutil.Process(os.getpid()).get_memory_info().rss
# Dump variables if using more than 100MB of memory
if rss > 100 * 1024 * 1024:
    memory_dump()
    os.abort()

def memory_dump():
    dump = open("memory.pickle", 'wb')
    xs = []
    for obj in gc.get_objects():
        i = id(obj)
        size = sys.getsizeof(obj, 0)
        #    referrers = [id(o) for o in gc.get_referrers(obj) if hasattr(o, '__class__')]
        referents = [id(o) for o in gc.get_referents(obj) if hasattr(o, '__class__')]
        if hasattr(obj, '__class__'):
            cls = str(obj.__class__)
            xs.append({'id': i, 'class': cls, 'size': size, 'referents': referents})
    cPickle.dump(xs, dump) 
```

请注意，我只保存具有`__class__`属性的对象的数据，因为这些是我关心的唯一对象。应该可以保存完整的对象列表，但您需要注意选择其他属性。另外，我发现获取每个对象的引用非常慢，所以我选择只保存引用。无论如何，在崩溃之后，可以像这样读回生成的腌制数据：

```
with open("memory.pickle", 'rb') as dump:
    objs = cPickle.load(dump) 
```

## 添加于 2017-11-15

Python 3.6 版本在这里：

```
import gc
import sys
import _pickle as cPickle

def memory_dump():
    with open("memory.pickle", 'wb') as dump:
        xs = []
        for obj in gc.get_objects():
            i = id(obj)
            size = sys.getsizeof(obj, 0)
            #    referrers = [id(o) for o in gc.get_referrers(obj) if hasattr(o, '__class__')]
            referents = [id(o) for o in gc.get_referents(obj) if hasattr(o, '__class__')]
            if hasattr(obj, '__class__'):
                cls = str(obj.__class__)
                xs.append({'id': i, 'class': cls, 'size': size, 'referents': referents})
        cPickle.dump(xs, dump) 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2020-04-16T22:07:06.500

我将根据我最近的经验扩展布雷特的答案。[Dozer 包](https://pypi.org/project/Dozer/)[维护得很好](https://github.com/mgedmin/dozer)， 尽管有一些进步，比如`tracemalloc`在 Python 3.4 中添加了 stdlib，但它的`gc.get_objects`计数图表是我解决内存泄漏的首选工具。下面我使用`dozer > 0.7`的是在撰写本文时尚未发布的（嗯，因为我最近在那里贡献了几个修复）。

# 例子

让我们看一个不平凡的内存泄漏。我将在这里使用[Celery](http://www.celeryproject.org/) 4.4 并最终发现一个导致泄漏的功能（并且因为它是一种错误/功能类型的东西，它可以被称为纯粹的错误配置，由于无知）。所以有一个 Python 3.6 *venv*我`pip install celery < 4.5`. 并具有以下模块。

*演示.py*

```
import time

import celery 

redis_dsn = 'redis://localhost'
app = celery.Celery('demo', broker=redis_dsn, backend=redis_dsn)

@app.task
def subtask():
    pass

@app.task
def task():
    for i in range(10_000):
        subtask.delay()
        time.sleep(0.01)

if __name__ == '__main__':
    task.delay().get() 
```

基本上是一个安排一堆子任务的任务。会出什么问题？

我将[`procpath`](https://pypi.org/project/Procpath/)用来分析 Celery 节点的内存消耗。`pip install procpath`. 我有 4 个终端：

1.  `procpath record -d celery.sqlite -i1 "$..children[?('celery' in @.cmdline)]"`记录 Celery 节点的进程树统计信息
2.  `docker run --rm -it -p 6379:6379 redis`运行 Redis，它将作为 Celery 代理和结果后端
3.  `celery -A demo worker --concurrency 2`用 2 个工作人员运行节点
4.  `python demo.py`最后运行示例

(4) 将在 2 分钟内完成。

然后我使用[sqliteviz](https://github.com/lana-k/sqliteviz)（[预建版本](https://lana-k.github.io/sqliteviz/)）来可视化`procpath`记录器的内容。我放下`celery.sqlite`那里并使用这个查询：

```
SELECT datetime(ts, 'unixepoch', 'localtime') ts, stat_pid, stat_rss / 256.0 rss
FROM record 
```

在 sqliteviz 中，我使用 , 创建折线图跟踪`X=ts`，`Y=rss`并添加 split transform `By=stat_pid`。结果图为：

[![芹菜节点泄漏](https://i.stack.imgur.com/US20P.png)](https://i.stack.imgur.com/US20P.png)

任何与内存泄漏作斗争的人都可能非常熟悉这种形状。

# 寻找泄漏的物体

现在是时候了`dozer`。我将展示非仪器案例（如果可以的话，您可以以类似的方式检测您的代码）。要将 Dozer 服务器注入目标进程，我将使用[Pyrasite](https://pypi.org/project/pyrasite/)。关于它有两点需要了解：

*   要运行它，必须将[ptrace](http://man7.org/linux/man-pages/man2/ptrace.2.html)配置为“经典 ptrace 权限”：`echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope`，这可能存在安全风险
*   您的目标 Python 进程崩溃的可能性不为零

有了这个警告，我：

*   `pip install https://github.com/mgedmin/dozer/archive/3ca74bd8.zip`（我上面提到的应该是0.8）
*   `pip install pillow`（`dozer`用于制图）
*   `pip install pyrasite`

之后，我可以在目标进程中获取 Python shell：

```
pyrasite-shell 26572 
```

并注入以下内容，这将使用 stdlib 的`wsgiref`服务器运行 Dozer 的 WSGI 应用程序。

```
import threading
import wsgiref.simple_server

import dozer

def run_dozer():
    app = dozer.Dozer(app=None, path='/')
    with wsgiref.simple_server.make_server('', 8000, app) as httpd:
        print('Serving Dozer on port 8000...')
        httpd.serve_forever()

threading.Thread(target=run_dozer, daemon=True).start() 
```

在浏览器中打开`http://localhost:8000`应该会看到如下内容：

[![推土机](https://i.stack.imgur.com/5hDUb.png)](https://i.stack.imgur.com/5hDUb.png)

之后，我`python demo.py`再次从 (4) 运行并等待它完成。然后在 Dozer 中，我将“Floor”设置为 5000，这就是我所看到的：

[![推土机显示芹菜泄漏](https://i.stack.imgur.com/VoTDD.png)](https://i.stack.imgur.com/VoTDD.png)

随着子任务的调度，与 Celery 相关的两种类型会增长：

*   `celery.result.AsyncResult`
*   `vine.promises.promise`

`weakref.WeakMethod`具有相同的形状和数字，一定是由同一事物引起的。

# 寻找根本原因

此时，从泄漏类型和趋势来看，您的情况可能已经很清楚了。如果不是，Dozer 每个类型都有“TRACE”链接，它允许跟踪（例如查看对象的属性）选择的对象的引用者（`gc.get_referrers`）和引用者（`gc.get_referents`），并再次遍历图继续该过程。

但是一张图片说一千个字，对吧？因此，我将展示如何使用[`objgraph`](https://pypi.org/project/objgraph/)来呈现所选对象的依赖关系图。

*   `pip install objgraph`
*   `apt-get install graphviz`

然后：

*   我`python demo.py`再次从 (4)运行
*   在我设置的推土机中`floor=0`，`filter=AsyncResult`
*   并单击“TRACE”，这应该会产生

[![痕迹](https://i.stack.imgur.com/GRp77.png)](https://i.stack.imgur.com/GRp77.png)

然后在 Pyrasite shell 中运行：

```
objgraph.show_backrefs([objgraph.at(140254427663376)], filename='backref.png') 
```

PNG 文件应包含：

[![参考图表](https://i.stack.imgur.com/TrU1M.png)](https://i.stack.imgur.com/TrU1M.png)

基本上有一些`Context`对象包含一个`list`被调用的对象，而该对象`_children`又包含许多`celery.result.AsyncResult`泄漏的实例。`Filter=celery.*context`我看到的是推土机的变化：

[![芹菜上下文](https://i.stack.imgur.com/sIplB.png)](https://i.stack.imgur.com/sIplB.png)

所以罪魁祸首是`celery.app.task.Context`。搜索该类型肯定会引导您进入[Celery 任务页面](https://docs.celeryproject.org/en/stable/reference/celery.app.task.html)。在那里快速搜索“孩子”，它是这样说的：

> `trail = True`
> 
> 如果启用，请求将跟踪此任务启动的子任务，并且此信息将与结果一起发送 ( `result.children`)。

通过如下设置禁用跟踪`trail=False`：

```
@app.task(trail=False)
def task():
    for i in range(10_000):
        subtask.delay()
        time.sleep(0.01) 
```

然后再次从 (3) 和`python demo.py`(4) 重新启动 Celery 节点，显示此内存消耗。

[![解决了](https://i.stack.imgur.com/CzTin.png)](https://i.stack.imgur.com/CzTin.png)

问题解决了！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T23:41:01.297

您能否在生产站点上记录流量（通过日志），然后在装有 python 内存调试器的开发服务器上重新播放？（我推荐推土机： http: [//pypi.python.org/pypi/Dozer](http://pypi.python.org/pypi/Dozer)）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-27T00:11:08.587

[使您的程序转储核心，然后使用](http://www.gsp.com/cgi-bin/man.cgi?section=1&topic=gcore)[gdb](http://www.gsp.com/cgi-bin/man.cgi?section=1&topic=gdb)在足够相似的盒子上克隆该程序的一个实例。有一些[特殊的宏](http://wiki.python.org/moin/DebuggingWithGdb)可以帮助调试 gdb 中的 python 程序，但是如果你可以让你的程序同时[提供一个远程 shell](http://blog.vrplumber.com/index.php?/archives/1631-Minimal-example-of-using-twisted.manhole-Since-it-took-me-so-long-to-get-it-working....html)，你可以继续程序的执行，并用 python 查询它。

我从来没有这样做过，所以我不能 100% 确定它会起作用，但也许这些指针会有所帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T21:37:03.170

我不知道如何转储整个 python 解释器状态并恢复它。这会很有用，我会密切关注这个答案，以防其他人有想法。

如果您知道内存泄漏的位置，您可以添加检查对象的引用计数。例如：

```
x = SomeObject()
... later ...
oldRefCount = sys.getrefcount( x )
suspiciousFunction( x )
if (oldRefCount != sys.getrefcount(x)):
    print "Possible memory leak..." 
```

您还可以检查高于对您的应用程序合理的某个数字的引用计数。更进一步，您可以修改 python 解释器以通过用您自己的宏替换`Py_INCREF`和宏来执行这些类型的检查。`Py_DECREF`不过，这在生产应用程序中可能有点危险。

这是一篇文章，其中包含有关调试此类事物的更多信息。它更适合插件作者，但大部分都适用。

[调试引用计数](http://www.python.org/doc/essays/refcnt/ "调试引用计数")

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T21:45:10.623

该[`gc`模块](http://docs.python.org/lib/module-gc.html)具有一些可能有用的功能，例如列出垃圾收集器发现无法访问但无法释放的所有对象，或者列出所有正在跟踪的对象。

如果您怀疑哪些对象可能泄漏，[weakref](http://docs.python.org/lib/module-weakref.html)模块可以方便地找出是否/何时收集对象。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-01-31T00:16:42.393

[Meliae](https://edge.launchpad.net/meliae)看起来很有希望：

> 这个项目类似于 heapy（在“guppy”项目中），试图了解内存是如何分配的。
> 
> 目前，它的主要区别在于它将计算内存消耗的汇总统计等任务与实际扫描内存消耗的任务分开。它这样做是因为我经常想弄清楚我的进程中发生了什么，而我的进程正在消耗大量内存（1GB 等）。它还可以显着简化扫描程序，因为我在尝试分析 python 对象内存消耗时不分配 python 对象。

# svn - Team Foundation Server - 使用 API 同步到 SVN

> ID：141353
> 
> 赞同：3
> 
> 时间：2008-09-26T19:13:33.843
> 
> 标签：svn, api, version-control, tfs, synchronization

有没有人使用 TFS 的 API 来同步不同类型的存储库？我有一个 SVN 存储库，我想与 TFS 存储库同步。更准确地说，我只想偶尔（每晚）从 SVN 获取最新的所有内容，并将其作为最新版本转储到 TFS。

有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T20:55:19.883

运行 CodePlex 的人在 TFS 和 SVN 之间架起了一座桥梁。它被称为 SvnBridge。他们有 2 个版本的应用程序。一个版本在 IIS 中运行，另一个版本是客户端。

您也许可以与该项目交谈，看看您是否可以做您想做的事。我相信现在的实际流程是 SVN 到 TFS，但我不认为它不能走另一条路。

[http://www.codeplex.com/SvnBridge](http://www.codeplex.com/SvnBridge)

# apache-flex - Flex 事件后屏幕更新

> ID：141360
> 
> 赞同：1
> 
> 时间：2008-09-26T19:14:24.777
> 
> 标签：apache-flex, flash, actionscript-3, performance, profiling

我今天在调查一些非常奇怪的事情时遇到了这个话题。在我们的 Flex 应用程序中执行某些操作会导致渲染帧数猛增，从 12fps 到 ~30fps：加载的动画开始高速播放，GUI 开始锁定。

由于我在 Flex/Flash 上阅读的所有内容都强调了“帧速率限制在顶级应用程序中设置的 fps”这一点，因此这些额外渲染发生的唯一方法似乎是由于某些事件导致它们（在任何地方都没有对舞台的帧速率进行任何程序化更改）。由于它仅在我将更新逻辑放入 ENTER_FRAME 处理程序时发生，所以我试图找出可能发生的情况，这显然导致 Flex 变得疯狂渲染。

假设：我的更新函数中的某些内容正在触发立即屏幕更新，这会立即引发另一个 ENTER_FRAME，这意味着我的更新循环被调用，这会触发另一个立即屏幕更新，...

如果这是一个因素，我们的 GUI 中使用了 Flex 组件。我真的不知道下一步该去哪里。

**澄清**：

*   当我说事情加速时，这有两种表现形式。
*   首先，我的 ENTER_FRAME 处理程序被更频繁地调用。
*   其次，加载了内置循环动画的 Flash SWF 突然加速到它看起来很傻的程度。
*   我没有使用updateAfterEvent，我只是在研究这个问题时才发现它存在。显然，Sprite 子类上的一些事件会自动调用它，我想知道这是否是根本原因。
*   我根本没有直接搞乱渲染。背景动画会自动播放，因为它们具有来自 CS3 创作的内置时间线，我们的所有更新功能所做的只是更改 DisPlayObjects 的位置或添加/删除它们等

**更新：** 我在我的应用程序中添加了一个标签来打印 stage.frameRate，并发现在某些时候，它突然从 12 变为 1000（允许的最大值）。虽然向我的 ENTER_FRAME 处理程序添加一行来重置它是微不足道的，但这几乎没有什么大帮助。此外，即使这样做，渲染也一团糟。某些操作（例如发出警报弹出窗口）会使它重新焕发生机。不幸的是，我无法查看 Stage 类的源代码以在 setter 属性上设置断点。

这对于 Flex 加载“设置为 1000fps”的事情非常有趣。我们有几个 Flex 应用程序，它们都提供了一个通用接口。主应用程序负责通过 SWFLoader 类根据需要加载这些模块。但是，加载过程已经考虑到延迟加载......当 SWF 加载时，我们然后等待来自 SystemManager 的 APPLICATION_COMPLETE。收到此信息后，是否应该完成应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T11:17:22.870

Flex 在 Flex 组件的“分阶段实例化”期间将帧速率设置为 1000，这仅在 flex swf 的初始加载期间发生。这允许它非常快速地构建所有组件。

您是否正在等待 Flex 应用程序完全加载和构建？在使用 Flex 内容之前，您应该等待 FlexEvent.CREATION_COMPLETE。

如果您想知道发生这种情况的位置，请查看 Flex LayoutManager 类的第 326 行（使用 Flex SDK 3.0.194161），在属性 usePhasedInstantiation 的设置器中。

**更新：**

APPLICATION_COMPLETE 应该为您提供初始加载。

这实际上发生在任何时候直接从 MXML 创建组件时。因此，还有一些其他情况需要寻找。您是否使用任何中继器？您是否使用任何按需构建其子级的导航容器？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-27T15:36:28.253

Thanks for the clarifications. If a loaded clip with a animation (I assume you mean a frame animation) is speeding up, then that certainly sounds like something is changing your playback framerate, as opposed to other things that could be going on. With that said it's not a problem I've seen crop up before, but I do think there are some things you could try that ought to narrow down where the problem is:

1.  You might as well try tracing out `stage.frameRate` during the speed-up. Presumably nothing *ought* to be changing your framerate, but since that would explain your issues you might as well rule it out.

2.  Try removing as many GUI components as possible and seeing if the problem still occurs, if it's possible to trigger the problem without them.

3.  One sanity check you could try, if it's feasible, is to copy some of the contents of your game into a fresh project and try it there. Sometimes mysterious issues like this happen because some class or SWC is being imported somewhere that everyone forgot about.

4.  You could try driving your code from a different event. For example, as far as I know driving it from `Event.EXIT_FRAME` or `Event.FRAME_CONSTRUCTED` ought to look the same, but if it doesn't then that's a hint. Alternately, you could try driving it from something like a keyboard event or `MouseEvent.MOUSE_MOVE`. Then if updates occur even though you're not firing events, you'll know something else is driving things besides your event loop.

Those are the things I'd try, anyway. Hope you track it down...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-27T08:02:44.447

我不清楚的一件事-您是否看到实际的屏幕刷新速度比发布的帧速率更快？还是您的动画移动得更快但屏幕刷新没有改变？（也就是说，它曾经每秒移动 10 个像素，但现在它的移动速度比这更快，无论屏幕绘制的频率如何。）

一个简单的检查方法是尝试以 1 fps 发布您的内容。应该清楚屏幕是否每秒重绘一次，但动画元素的移动比这更频繁，或者屏幕是否实际上更新更频繁。

如果是后者，您是否`updateAfterEvent()`在代码中使用了任何方法？这可能会导致实际屏幕刷新比发布的帧速率更快。但它不应该影响`ENTER_FRAME`事件。您仍然应该只获得每帧更新中的一个。

或者，您正在制作动画的只是 Sprite 等，还是您将它们实现为 Flex 组件，并尝试使用`invalidate()`方法和 RENDER 事件等重绘它们？

如果您可以澄清问题中的一些要点，答案可能会更清楚。谢谢...

# c# - 计算两个日期时间之间经过的工作时间

> ID：141368
> 
> 赞同：6
> 
> 时间：2008-09-26T19:15:35.007
> 
> 标签：c#, datetime, date

给定两个日期时间。计算它们之间的工作时间的最佳方法是什么。考虑到工作时间是周一 8 - 5.30，周二至周五 8.30 - 5.30，并且任何一天都可能是公共假期。

这是我的努力，看起来效率非常低，但就迭代次数而言，IsWorkingDay 方法会访问数据库以查看该日期时间是否是公共假期。

任何人都可以提出任何优化或替代方案。

```
 public decimal ElapsedWorkingHours(DateTime start, DateTime finish)
        {

            decimal counter = 0;

            while (start.CompareTo(finish) <= 0)
            {   
                if (IsWorkingDay(start) && IsOfficeHours(start))
                {
                    start = start.AddMinutes(1);
                    counter++;
                }
                else
                {
                    start = start.AddMinutes(1);
                }
            }

            decimal hours;

            if (counter != 0)
            {
                hours = counter/60;
            }

            return hours;
        } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T19:20:17.150

在开始优化之前，问自己两个问题。

a) 它有效吗？

b) 是不是太慢了？

只有当这两个问题的答案都是“是”时，您才可以开始优化。

除此之外

*   您只需要担心开始日和结束日的分钟和小时。中间的日子显然是整整 9/9.5 小时，除非是节假日或周末
*   无需检查周末是否是假期

这是我的做法

```
// Normalise start and end    
while start.day is weekend or holiday, start.day++, start.time = 0.00am
    if start.day is monday,
        start.time = max(start.time, 8am)
    else
        start.time = max(start.time, 8.30am)
while end.day is weekend or holiday, end.day--, end.time = 11.59pm
end.time = min(end.time, 5.30pm)

// Now we've normalised, is there any time left?    
if start > end
   return 0

// Calculate time in first day    
timediff = 5.30pm - start.time
day = start.day + 1
// Add time on all intervening days
while(day < end.day)
   // returns 9 or 9.30hrs or 0 as appropriate, could be optimised to grab all records
   // from the database in 1 or 2 hits, by counting all intervening mondays, and all
   // intervening tue-fris (non-holidays)
   timediff += duration(day) 

// Add time on last day
timediff += end.time - 08.30am
if end.day is Monday then
    timediff += end.time - 08.00am
else
    timediff += end.time - 08.30am

return timediff 
```

您可以执行 SELECT COUNT(DAY) FROM HOLIDAY WHERE HOLIDAY BETWEEN BETWEEN @Start AND @End GROUP BY DAY 之类的操作

计算周一、周二、周三等节假日的数量。可能是一种让 SQL 只计算星期一和非星期一的方法，尽管目前想不出任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:23:19.090

看看 TimeSpan 类。这将为您提供任意 2 次之间的时间。

一个 DB 调用也可以获得您两次之间的假期；类似于：

```
SELECT COUNT(*) FROM HOLIDAY WHERE HOLIDAY BETWEEN @Start AND @End 
```

将该计数乘以 8，然后从总小时数中减去。

-伊恩

**编辑**：回应下面，如果你是假期不是固定的小时数。你可以在你的数据库中保留一个`HolidayStart`和一个`HolidayEnd`时间，并且也可以将它们从调用中返回到数据库。做一个小时计数，类似于您为主要例程选择的任何方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T19:18:55.547

> 特别是考虑到 IsWorkingDay 方法会访问数据库以查看那天是否是公共假期

如果问题是查询次数而不是数据量，请在开始时从数据库中查询您需要的整个日期范围的工作日数据，而不是在每个循环迭代中查询。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T19:42:45.410

还有递归解决方案。不一定高效，但很有趣：

```
public decimal ElapseddWorkingHours(DateTime start, DateTime finish)
{
    if (start.Date == finish.Date)
        return (finish - start).TotalHours;

    if (IsWorkingDay(start.Date))
        return ElapsedWorkingHours(start, new DateTime(start.Year, start.Month, start.Day, 17, 30, 0))
            + ElapsedWorkingHours(start.Date.AddDays(1).AddHours(DateStartTime(start.Date.AddDays(1)), finish);
    else
        return ElapsedWorkingHours(start.Date.AddDays(1), finish);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T19:26:41.563

基于@OregonGhost 所说的，而不是在接受一天并返回布尔值时使用 IsWorkingDay() 函数，而是使用一个接受范围并返回一个整数的 HolidayCount() 函数，该整数给出该范围内的假期数。这里的诀窍是，如果您要处理边界开始和结束日期的部分日期，您可能仍需要确定这些日期本身是否是假期。但即便如此，您也可以使用新方法来确保您*最多*需要对 DB 的三个调用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T19:37:31.757

尝试以下方式：

```
TimeSpan = TimeSpan Between Date1 And Date2
cntDays = TimeSpan.Days 
cntNumberMondays = Iterate Between Date1 And Date2 Counting Mondays 
cntdays = cntdays - cntnumbermondays
NumHolidays = DBCall To Get # Holidays BETWEEN Date1 AND Date2
Cntdays = cntdays - numholidays 
numberhours = ((decimal)cntdays * NumberHoursInWorkingDay )+((decimal)cntNumberMondays * NumberHoursInMondayWorkDay ) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T19:47:38.410

最有效的方法是计算总时差，然后减去周末或节假日的时间。有很多边缘情况需要考虑，但您可以通过取范围的第一天和最后一天并分别计算它们来简化它。

[Ian Jacobs](https://stackoverflow.com/questions/141368/calculating-the-elapsed-working-hours-between-2-dates#141401)建议的 COUNT(*) 方法似乎是计算假期的好方法。无论您使用什么，它都会处理一整天，您需要分别涵盖开始日期和结束日期。

计算周末天数很容易；如果你有一个函数 Weekday(date)，它从星期一返回 0 到星期日返回 6，它看起来像这样：

```
saturdays = ((finish - start) + Weekday(start) + 2) / 7;
sundays = ((finish - start) + Weekday(start) + 1) / 7; 
```

注意： (finish - start) 不是字面意思，而是用计算时间跨度的东西来代替它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T19:51:33.750

使用@Ian 的查询检查日期之间的日期，以找出哪些天不是工作日。然后做一些数学运算，找出您的开始时间或结束时间是否在非工作日，并减去差值。

因此，如果开始是星期六中午，结束是星期一中午，则查询应该返回 2 天，从中计算 48 小时 (2 x 24)。如果您对 IsWorkingDay(start) 的查询返回 false，请从 24 中减去从开始到午夜的时间，这将为您提供 12 小时或总共 36 小时的非工作时间。

现在，如果你每天的办公时间都一样，你就会做类似的事情。如果你的办公时间有点分散，你会遇到更多的麻烦。

理想情况下，对数据库进行一次查询，即可为您提供两次（或什至日期）之间的所有办公时间。然后从该集合中本地进行数学运算。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-08-30T18:38:18.350

```
Dim totalMinutes As Integer = 0

For minute As Integer = 0 To DateDiff(DateInterval.Minute, contextInParameter1, contextInParameter2)
    Dim d As Date = contextInParameter1.AddMinutes(minute)
    If d.DayOfWeek <= DayOfWeek.Friday AndAlso _
       d.DayOfWeek >= DayOfWeek.Monday AndAlso _
       d.Hour >= 8 AndAlso _
       d.Hour <= 17 Then
        totalMinutes += 1
    Else
        Dim test = ""
    End If
Next minute

Dim totalHours = totalMinutes / 60 
```

小菜一碟！

干杯!

# .net - INotifyPropertyChanged 属性名称 - 硬编码与反射？

> ID：141370
> 
> 赞同：42
> 
> 时间：2008-09-26T19:15:43.307
> 
> 标签：.net, wpf, reflection

使用 INotifyPropertyChanged 时指定属性名称的最佳方法是什么？

大多数示例将属性名称硬编码为 PropertyChanged 事件的参数。我正在考虑使用 MethodBase.GetCurrentMethod.Name.Substring(4) 但对反射开销有点不安。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-27T13:02:23.943

不要忘记一件事：`PropertyChanged`事件主要由组件使用，这些组件将**使用反射**来获取命名属性的值。

最明显的例子是数据绑定。

当您触发`PropertyChanged`事件时，将属性名称作为参数传递，您应该知道*此事件的订阅者可能会*通过调用来使用反射，例如`GetProperty`（如果它使用 的缓存，则至少是第一次`PropertyInfo`），然后`GetValue`. 最后一次调用是属性 getter 方法的动态调用 (MethodInfo.Invoke)，其成本高于`GetProperty`仅查询元数据的调用。（请注意，数据绑定依赖于整个[TypeDescriptor](http://msdn.microsoft.com/en-us/library/ms171819.aspx) ——但默认实现使用反射。）

因此，当然，在触发 PropertyChanged 时使用硬代码属性名称比使用反射动态获取属性名称更有效，但恕我直言，平衡您的想法很重要。在某些情况下，性能开销并不那么重要，您可以从某种强类型事件触发机制中受益。

这是我有时在 C# 3.0 中使用的，当性能不是问题时：

```
public class Person : INotifyPropertyChanged
{
    private string name;

    public string Name
    {
        get { return this.name; }
        set 
        { 
            this.name = value;
            FirePropertyChanged(p => p.Name);
        }
    }

    private void FirePropertyChanged<TValue>(Expression<Func<Person, TValue>> propertySelector)
    {
        if (PropertyChanged == null)
            return;

        var memberExpression = propertySelector.Body as MemberExpression;
        if (memberExpression == null)
            return;

        PropertyChanged(this, new PropertyChangedEventArgs(memberExpression.Member.Name));
    }

    public event PropertyChangedEventHandler PropertyChanged;
} 
```

注意使用表达式树来获取属性的名称，以及使用 lambda 表达式作为`Expression`:

```
FirePropertyChanged(p => p.Name); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2013-01-03T05:42:49.950

在 .NET 4.5 (C# 5.0) 中有一个名为 - [CallerMemberName](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.callermembernameattribute.aspx)的新属性，如果开发人员决定更改属性名称，它有助于避免硬编码的属性名称防止出现错误，这是一个示例：

```
public event PropertyChangedEventHandler PropertyChanged = delegate { };

public void OnPropertyChanged([CallerMemberName]string propertyName="")
{
    PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
}

private string name;
public string Name
{
    get { return name; }
    set 
    { 
        name = value;
        OnPropertyChanged();
    }
} 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-26T19:17:51.337

这里的反射开销非常大，特别是因为 INotifyPropertyChanged 被调用**了很多**。如果可以的话，最好只对值进行硬编码。

如果您不关心性能，那么我会查看下面提到的各种方法，并选择需要最少编码量的方法。如果您可以做一些事情来完全消除对显式调用的需要，那么那将是最好的（例如 AOP）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-07-30T20:21:17.533

使用表达式树所涉及的性能损失是由于表达式树的重复解析。

下面的代码仍然使用表达式树，因此具有重构友好和混淆友好的后续优势，但实际上比通常的技术快 40%（非常粗略的测试） - 包括为每个更改通知更新一个 PropertyChangedEventArgs 对象.

它更快并且避免了表达式树的性能损失，因为我们为每个属性缓存了一个静态 PropertyChangedEventArgs 对象。

我还没有做一件事 - 我打算添加一些代码来检查调试版本，以确保提供的 PropertChangedEventArgs 对象的属性名称与正在使用它的属性匹配 - 目前使用此代码它仍然是开发人员可能会提供错误的对象。

看看这个：

```
 public class Observable<T> : INotifyPropertyChanged
    where T : Observable<T>
{
    public event PropertyChangedEventHandler PropertyChanged;

    protected static PropertyChangedEventArgs CreateArgs(
        Expression<Func<T, object>> propertyExpression)
    {
        var lambda = propertyExpression as LambdaExpression;
        MemberExpression memberExpression;
        if (lambda.Body is UnaryExpression)
        {
            var unaryExpression = lambda.Body as UnaryExpression;
            memberExpression = unaryExpression.Operand as MemberExpression;
        }
        else
        {
            memberExpression = lambda.Body as MemberExpression;
        }

        var propertyInfo = memberExpression.Member as PropertyInfo;

        return new PropertyChangedEventArgs(propertyInfo.Name);
    }

    protected void NotifyChange(PropertyChangedEventArgs args)
    {
        if (PropertyChanged != null)
        {
            PropertyChanged(this, args);
        }
    }
}

public class Person : Observable<Person>
{
    // property change event arg objects
    static PropertyChangedEventArgs _firstNameChangeArgs = CreateArgs(x => x.FirstName);
    static PropertyChangedEventArgs _lastNameChangeArgs = CreateArgs(x => x.LastName);

    string _firstName;
    string _lastName;

    public string FirstName
    {
        get { return _firstName; }
        set
        {
            _firstName = value;
            NotifyChange(_firstNameChangeArgs);
        }
    }

    public string LastName
    {
        get { return _lastName; }
        set
        {
            _lastName = value;
            NotifyChange(_lastNameChangeArgs);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-12T12:48:17.907

罗马：

我想说你甚至不需要“Person”参数 - 因此，一个像下面这样的完全通用的片段应该做：

```
private int age;
public int Age
{
  get { return age; }
  set
  {
    age = value;
    OnPropertyChanged(() => Age);
  }
}

private void OnPropertyChanged<T>(Expression<Func<T>> exp)
{
  //the cast will always succeed
  MemberExpression memberExpression = (MemberExpression) exp.Body;
  string propertyName = memberExpression.Member.Name;

  if (PropertyChanged != null)
  {
    PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
  }
} 
```

...但是，我更喜欢在 Debug 构建中坚持使用带有条件验证的字符串参数。Josh Smith 对此发布了一个很好的示例：

[实现 INotifyPropertyChanged 的​​基类](http://joshsmithonwpf.wordpress.com/2007/08/29/a-base-class-which-implements-inotifypropertychanged/)

干杯 :) 菲利普

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-26T19:27:02.513

是的，我看到了您建议的功能的使用和简单性，但是当考虑到反射导致的运行成本时，是的，这是一个坏主意，我在这种情况下使用的是正确添加**代码片段**以利用时间并在触发所有 Notifyproperty 事件时写入属性时出错。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-23T02:43:26.337

我能想到的另一种非常好的方法是

**使用 AOP自动实现 INotifyPropertyChanged**
：面向方面的编程

关于 codeproject 的好文章：[INotifyPropertyChanged 的​​ AOP 实现](http://www.codeproject.com/KB/cs/NotifyingAttribute.aspx)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-18T20:36:22.650

你可能对这个讨论感兴趣

[“最佳实践：如何实现 INotifyPropertyChanged 对？”](http://compositeextensions.codeplex.com/Thread/View.aspx?ThreadId=53731)

也。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-04-04T11:33:03.450

由于 C# 6.0 有一个**nameof()**关键字，它将在编译时进行评估，因此它将具有硬编码值的性能，并防止与通知属性不匹配。

```
public event PropertyChangedEventHandler PropertyChanged;

protected void NotifyPropertyChanged(string info)
{       
    PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(info));
}
public string SelectedItem
{
    get
    {
        return _selectedItem;
    }
    set
    {
        if (_selectedItem != value)
        {
            _selectedItem = value;
            NotifyPropertyChanged(nameof(SelectedItem));
        }
    }
}
private string _selectedItem; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-02-08T11:52:10.390

没有无关紧要，在硬编码和反射之间，我的选择是：[notifypropertyweaver](http://github.com/SimonCropp/NotifyPropertyWeaver)。

这个 Visual Studio 包允许您获得反射的好处（可维护性、可读性......）而不必失去性能。

实际上，您只需要实现 INotifyPropertyChanged 并在编译时添加所有“通知内容”。

如果您想完全优化代码，这也是完全可参数化的。

例如，使用 notifypropertyweaver，您将在编辑器中拥有以下代码：

```
public class Person : INotifyPropertyChanged
{
    public event PropertyChangedEventHandler PropertyChanged;

    public string GivenNames { get; set; }
    public string FamilyName { get; set; }

    public string FullName
    {
        get
        {
            return string.Format("{0} {1}", GivenNames, FamilyName);
        }
    }
} 
```

代替 ：

```
public class Person : INotifyPropertyChanged
{

    public event PropertyChangedEventHandler PropertyChanged;

    private string givenNames;
    public string GivenNames
    {
        get { return givenNames; }
        set
        {
            if (value != givenNames)
            {
                givenNames = value;
                OnPropertyChanged("GivenNames");
                OnPropertyChanged("FullName");
            }
        }
    }

    private string familyName;
    public string FamilyName
    {
        get { return familyName; }
        set
        {
            if (value != familyName)
            {
                familyName = value;
                OnPropertyChanged("FamilyName");
                OnPropertyChanged("FullName");
            }
        }
    }

    public string FullName
    {
        get
        {
            return string.Format("{0} {1}", GivenNames, FamilyName);
        }
    }

    public virtual void OnPropertyChanged(string propertyName)
    {
        var propertyChanged = PropertyChanged;
        if (propertyChanged != null)
        {
            propertyChanged(this, new PropertyChangedEventArgs(propertyName));
        }
    }
} 
```

对于讲法语的人：[Améliorez la lisibilité de votre code et simplifiez vous la vie avec notifypropertyweaver](http://www.kevinrapaille.com/2012/02/amliorez-la-lisibilit-de-votre-code-et-simplifiez-vous-la-vie-avec-notifypropertyweaver/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T19:52:25.653

此外，我们发现了一个问题，即在 Debug 与 Release 构建中获取方法名称的工作方式不同：

[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/244d3f24-4cc4-4925-aebe-85f55b39ec92](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/244d3f24-4cc4-4925-aebe-85f55b39ec92)

（我们使用的代码并不完全按照您建议的方式反映，但它让我们确信硬编码属性名称是最快和最可靠的解决方案。）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-26T22:47:41.457

我曾经做过一次类似的实验，从内存中它工作正常，并且不需要硬编码字符串中的所有属性名称。如果您在桌面上构建大容量服务器应用程序，性能可能会出现问题，您可能永远不会注意到差异。

```
protected void OnPropertyChanged()
{
    OnPropertyChanged(PropertyName);
}

protected string PropertyName
{
    get
    {
        MethodBase mb = new StackFrame(1).GetMethod();
        string name = mb.Name;
        if(mb.Name.IndexOf("get_") > -1)
            name = mb.Name.Replace("get_", "");

        if(mb.Name.IndexOf("set_") > -1)
            name = mb.Name.Replace("set_", "");

        return name;
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-27T04:19:02.737

基于反射的方法的问题在于它相当昂贵，而且速度不是很快。当然，它更加灵活，并且对重构不那么脆弱。

但是，它确实会损害性能，尤其是在频繁调用事物时。stackframe 方法（我相信）在 CAS 中也存在问题（例如受限信任级别，例如 XBAP）。最好硬编码。

如果您在 WPF 中寻找快速、灵活的属性通知，那么有一个解决方案——使用 DependencyObject :) 这就是它的设计目的。如果您不想依赖依赖，或者担心线程关联问题，请将属性名称移动到常量中，然后繁荣！你的好。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-30T13:09:36.977

您可能希望完全避免 INotifyPropertyChanged。它为您的项目添加了不必要的簿记代码。请考虑改用[Update Controls .NET](http://codeplex.com/updatecontrols)。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-09-20T13:20:01.160

另一种方法： http: [//www.codeproject.com/Articles/450688/Enhanced-MVVM-Design-w-Type-Safe-View-Models-TVM](http://www.codeproject.com/Articles/450688/Enhanced-MVVM-Design-w-Type-Safe-View-Models-TVM)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-08-10T14:09:18.967

看看这篇博文：http: [//khason.net/dev/inotifypropertychanged-auto-wiring-or-how-to-get-rid-of-redundant-code](http://khason.net/dev/inotifypropertychanged-auto-wiring-or-how-to-get-rid-of-redundant-code)[](http://khason.net/dev/inotifypropertychanged-auto-wiring-or-how-to-get-rid-of-redundant-code)

# vim - 如何在 Vim 中模拟 Emacs 的转置词？

> ID：141372
> 
> 赞同：16
> 
> 时间：2008-09-26T19:16:17.283
> 
> 标签：vim, emacs, editor, usability

Emacs 有一个有用的`transpose-words`命令，它可以让用户将光标前的单词与光标后的单词交换，同时保留标点符号。

例如，'<code>stack |overflow' + Mt = '<code>overflow stack|' （'<code>|' 是光标位置）。

`<a>|<p>`变成`<p><a|>`.

是否可以在 Vim 中模拟它？我知道我可以使用`dwwP`，但它不适用于标点符号。

*更新：*不，`dwwP`真的*不是*一个解决方案。想象：

```
SOME_BOOST_PP_BLACK_MAGIC( (a)(b)(c) )
//             with cursor here ^ 
```

Emacs 的 Mt 将交换`b`和`c`，从而产生`(a)(c)(b)`.

有效的是`/\w yiwNviwpnviwgp`。但它破坏`""`和`"/`。有更清洁的解决方案吗？

*更新²：*

# 解决了

```
:nmap gn :s,\v(\w+)(\W*%#\W*)(\w+),\3\2\1\r,<CR>kgJ:nohl<CR> 
```

不完美，但有效。

感谢 Camflan 让`%#`我注意到这个项目。当然，这一切都在[wiki](http://vim.wikia.com/wiki/VimTip47)上，但我没有意识到它可以解决该功能的*精确*（Emacs 完全正确）重复的问题`transpose-words`。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T20:38:07.773

这些来自我的 .vimrc 并且对我很有效。

```
" swap two words
:vnoremap <C-X> <Esc>`.``gvP``P
" Swap word with next word
nmap <silent> gw    "_yiw:s/\(\%#\w\+\)\(\_W\+\)\(\w\+\)/\3\2\1/<cr><c-o><c-l> *N* 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T19:33:21.203

根据情况，您可以使用 W 或 B 命令，如 dWwP。“大写”版本跳到下一个/上一个空格，包括标点符号。f 和 t 命令也可以帮助指定删除范围的结尾。

[Vim Tips Wiki](http://vim.wikia.com/wiki/VimTip47)上也有关于各种交换技术的讨论。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T19:40:48.037

在一行的中间，转到第一个单词的第一个字母，然后执行

```
dw wP 
```

在一行的末尾（即该行的最后两个单词），转到单词之间的空格并执行

```
2dw bhP 
```

*从方便[的 VIM 和 Emacs 命令等效](http://danzig.jct.ac.il/unix_class/emacs-vi-Commands.html)*

* * *

您可以通过在 vimrc 文件中添加如下内容来为它们添加快捷键：

```
map L dwwP
map M 2dwbhP 
```

在这种情况下，SHIFT-L（在命令模式下）会在行的中间切换单词，而 SHIFT-M 会在最后进行。

*注意：这对空格分隔的单词最有效，并且不能很好地处理 OP 的具体情况。*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-20T12:09:05.697

[http://vim.wikia.com/wiki/VimTip10](http://vim.wikia.com/wiki/VimTip10)上有一个提示。但我选择自己动手。与提示中提到的方法相比，我的代码片段有两个明显的优势：1）当光标不在单词中时它可以工作。2）它不会突出整个屏幕。

它的工作原理几乎与 emacs 的“转置词”类似，只是当无法转置时，它什么也不做。（emacs 'transpose-words' 会闪烁并将光标位置更改为当前单词的开头。）

```
"transpose words (like emacs `transpose-words')
function! TransposeWords()
    if search('\w\+\%#\w*\W\+\w\+')
    elseif search('\w\+\W\+\%#\W*\w\+')
    endif
    let l:pos = getpos('.')
    exec 'silent! :s/\(\%#\w\+\)\(\W\+\)\(\w\+\)/\3\2\1/'
    call setpos('.', l:pos)
    let l:_ = search('\(\%#\w\+\W\+\)\@<=\w\+')
    normal el
endfunction

nmap <silent> <M-right> :call TransposeWords()<CR>
imap <silent> <M-right> <C-O>:call TransposeWords()<CR> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T19:51:43.143

正如 Mark 和 CapnNefarious 所说，您可以使用 dwwP 或 dWwP，但我有一些自己的笔记：

*   如果光标在第二个单词的第一个字母上，如您给出的示例所示，则可以使用 dwbP （或 dWbP 处理标点符号）；
*   如果光标在单词的中间，可以使用 dawbP/daWbP。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-26T13:22:14.680

vim.org 上有一个[transpose-words 脚本](https://www.vim.org/scripts/script.php?script_id=3656)，效果很好。

# apache-flex - 动态单选按钮

> ID：141388
> 
> 赞同：0
> 
> 时间：2008-09-26T19:19:49.287
> 
> 标签：apache-flex

我们的常驻 Flex 专家今天外出，我认为这将是测试该站点的好机会。我有一个工作正常的 dataProvider 下拉列表：

```
<ep:ComboBox id="dead_reason" selectedValue="{_data.dead_reason}"
    dataProvider="{_data.staticData.dead_reason}"
    labelField="@label" width="300"/> 
```

ComboBox 是自定义的，但我不确定这对问题是否重要。我需要将组合框更改为收音机（全部在一组中）但保持动态选项。换句话说，生成动态 RadioButtons 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T19:25:05.857

尝试使用 <mx:Repeater> 类似：

```
<mx:Repeater dataProvider="{_data.staticData.dead_reason}">
   <mx:RadioButton groupName="reasons" ...>
</mx:Repeater> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T12:51:32.187

```
<mx:RadioButtonGroup id="RDO_Group"/>
<mx:Repeater id="myRepeater" dataProvider="{_data.staticData.dead_reason}">
<mx:RadioButton id="rdo" label="{myRepeater.currentItem}" value="{myRepeater.currentItem}" groupName="RDO_Group"/>
</mx:Repeater> 
```

是最好的方法。

# c++ - 在 C++ 中处理分组密码的最佳方法是什么？（加密++）

> ID：141399
> 
> 赞同：2
> 
> 时间：2008-09-26T19:23:05.410
> 
> 标签：c++, encryption, cryptography, padding

我对 C++ 和 Block Cipher 加密都很陌生，我目前正在为 AES（16 字节种子/16 字节块）编写解密函数。一切进展顺利，但我的总数据大小并不总是我的块大小的倍数。我想知道在数据末尾处理剩余数据的最佳方法是什么。

我将 Crypto++ 用于 AES 库。

该`ProcessBlock()`函数采用输入和输出字符数组。我假设它期望它们至少足够大作为块大小。

在分组密码中处理所有 16 字节块的最佳方法是什么，然后还处理剩余数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:15:09.993

它不仅仅是填充 - 您需要一种操作模式。好数学，坏数学博客正在写一个关于它们是什么以及如何在[这里](http://scienceblogs.com/goodmath/2008/09/modes_of_operation_in_block_cr.php)使用它们的优秀系列。另请参阅[维基百科条目](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)。非常非常重要的一件事：永远不要使用 ECB（电子密码本）模式 - 您可以独立加密每个块。这是显而易见的方法，但它提供的安全性非常差。

但是，理想情况下，您甚至不必自己执行此操作。你的加密库应该提供它。如果没有，我建议换成别的。像 OpenSSL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T19:25:10.973

你想要的是一个填充系统。

[查看有关 Crypto++ 的 CodeProject 文章](http://www.codeproject.com/KB/security/BlockCiphers.aspx)：

> 当消息不是密码块大小的倍数时，必须填充 ECB 或 CBC 模式消息。填充的方法和值是密码库和 API 之间互操作性问题的根源。正如 Garth Lancaster 所指出的，如果您不了解填充的细节，请使用 StreamTransformationFilter。在这种情况下，Crypto++ 过滤器将为您填充。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:25:22.003

有一个称为“填充”的 PKCS 标准

请参阅[wikipedia page](http://en.wikipedia.org/wiki/Padding_(cryptography))，但它相当于填充以下之一：

```
 01
 02 02
 03 03 03
 04 04 04 04
 05 05 05 05 05 
```

这样你就知道在解密过程中原始消息在哪里结束......

# c# - 雅虎 GeoPlanet 和 XPathNavigator C#

> ID：141405
> 
> 赞同：0
> 
> 时间：2008-09-26T19:24:30.523
> 
> 标签：c#, web-services, xpath, yahoo

我从 Yahoo GeoPlanet Web 服务返回 XML 数据，使用`HttpWebRequest`.

我正在使用加载 XML

```
XPathDocument doc = new XPathDocument(HttpWebResponse.GetResponseStream()) 
```

接下来是：

```
XPathNavigator nav = doc.CreateNavigator(); 
```

如果我执行`nav.Select("places");`or `nav.Select("/places");`or `nav.Select("//places");`，则不会返回任何内容！

但如果我这样做`nav.select("/*");`，我会得到节点并做`node.Name`回报`places`吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T19:27:49.050

我对 Yahoo 数据的格式一无所知，但我知道 C# 和 XPath 最常见的错误是忘记将相关的命名空间添加到您的“NamespaceManager”中看看这里[http://mydotnet.wordpress.com/2008 /05/29/worlds-smallest-xml-xpath-tutorial/](http://mydotnet.wordpress.com/2008/05/29/worlds-smallest-xml-xpath-tutorial/)

# crystal-reports - 如何在不出现拒绝访问错误的情况下将子报表重新导入 Crystal 报表 9.0？

> ID：141406
> 
> 赞同：1
> 
> 时间：2008-09-26T19:24:45.000
> 
> 标签：crystal-reports

我正在使用水晶报表 9.0。它有一个由 2 个主报告共享的子报告。由于修复了其中一个主报告，我修改了子报告。当我尝试将该子报告重新导入我的第二个主报告时，我收到错误：访问被拒绝，然后重新导入子报告失败。

有谁知道问题可能是什么？2 个主报告和子报告都已“签出”，因此这不是一个现成的问题。此外，当我第一次说重新导入时，它告诉我找不到文件（指向一个很长的死文件路径），我需要选择它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T19:48:30.670

您是否同时打开两个主报告？

如果是这样，可能会关闭您已经刷新的那个，然后再试一次。似乎出于某种原因它被锁定了。

# java - Tomcat 6.0.18 服务无法在 Windows 服务器上启动

> ID：141411
> 
> 赞同：5
> 
> 时间：2008-09-26T19:25:25.840
> 
> 标签：java, tomcat, windows-server-2003

我在 windows server 2003 机器上安装了 Tomcat 6.0.18，它不会作为服务启动。我正在使用 jdk 1.6.0_07 运行它。

当我使用 tomcat6.exe 启动它时它会运行。

我在 Windows 上的系统事件日志中得到一个模糊的错误。

Apache Tomcat 6 服务因特定于服务的错误 0 (0x0) 而终止。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T21:48:55.480

我会咬它的:-)

Windows 上的 Tomcat 服务依赖于 MS C 运行时库 msvcr71.dll。只要它在路径中，服务就可以正常启动。

只是为了防止您的其他窗口被迫使用此版本的运行时库，您可能希望仅将 DLL 复制到 tomcat bin 路径而不是 windows\system32。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T19:27:34.167

来自[gobaco.wordpress.com](http://gobaco.wordpress.com/2007/07/04/could-not-start-tomcat-6-on-windows-xp/)

Tomcat 6 找不到名为 msvcr71.dll 的文件。
我刚刚将它从 c:\windows\microsoft.net\framework\v1.1.4322 复制到 c:\windows\system32

并且能够启动tomcat。

我觉得这很奇怪，所以我想把它贴在 SO 上，以防其他人遇到这个问题。如果有人想发布相同的答案，我会接受。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-10T04:29:49.440

我遵循上述指南，但仍然相同，错误 0，我的进程监视器日志位于 [http://www.sendspace.com/file/t0tahr](http://www.sendspace.com/file/t0tahr)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-04T09:31:41.017

我解决了在配置应用程序中启用默认 java 虚拟机的相同问题。

假设您已使用以下方式安装了 tomcat：

```
service install tomcat-6.0.35 
```

执行：

```
tomcat6w //ES/tomcat-6.0.35 
```

弹出一个窗口，选择 java 选项卡并单击“使用默认值”复选框。

而是选择了服务安装脚本（我想象）`C:\Program Files(x86)\Java\jre\bin\client\jvm.dll`。

环境：

*   Windows Server 标准 SP2 64 位
*   Java 1.6.0_23-b05（Java热点64位服务器vm 19.0-b09混合模式）
*   Apache tomcat 6.35（你猜对了吗？）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-08T18:28:12.083

我将 java 主目录中的 msvcr71.dll 复制到 apache-tomcat 安装的 bin 目录中，然后服务启动。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-03T12:09:17.053

尽管这是一篇较旧的帖子，但我想我会分享关于我遇到的同样问题的知识，但解决方法不同。

> Apache Tomcat 7 服务因服务特定错误 0 (0x0) 而终止。

由于没有关于该问题的更多信息，我返回 Tomcat 控制面板并查看 Java 路径，该路径指向 Java 虚拟机的早期安装：

> C:\Program Files\Java\jre6\bin\client\jvm.dll，已经不存在了，所以只好把JRE版本改成jre7。

完成后，服务启动并立即运行。

希望它会帮助你们中的一些人。

# algorithm - 如何将多项式转换为另一个坐标系？

> ID：141422
> 
> 赞同：7
> 
> 时间：2008-09-26T19:27:52.623
> 
> 标签：algorithm, language-agnostic, math, geometry, transform

使用各种矩阵数学，我求解了一个方程组，得到了“n”次多项式的系数

```
Ax^(n-1) + Bx^(n-2) + ... + Z 
```

然后我在给定的 x 范围内评估多项式，基本上我正在渲染多项式曲线。现在这是问题所在。我在一个我们称之为“数据空间”的坐标系中完成了这项工作。现在我需要在另一个坐标空间中呈现相同的曲线。输入/输出与坐标空间之间的转换很容易，但最终用户只对系数 [A,B,....,Z] 感兴趣，因为他们可以自己重建多项式。如何呈现第二组系数 [A',B',....,Z']，它们在不同的坐标系中表示相同形状的曲线。

如果有帮助，我正在二维空间中工作。普通的旧 x 和 y。我也觉得这可能涉及将系数乘以变换矩阵？它是否会包含坐标系之间的比例/平移因子？它会是这个矩阵的逆矩阵吗？我觉得我在朝着正确的方向前进......

更新：坐标系是线性相关的。会有有用的信息吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T23:03:45.880

问题陈述有点不清楚，所以首先我将澄清我自己对它的解释：

你有一个多项式函数

**f(x) = C [n] x ^n + C [n-1] x ^(n-1) + ... + C [0]**

[我将 A, B, ... Z 更改为 C [n] , C [n-1] , ..., C [0]以便更轻松地使用下面的线性代数。]

然后你也有一个转换，例如：   **z = ax + b**   你想用它来找到*相同*多项式的系数，但在*z*方面：

**f(z) = D [n] z ^n + D [n-1] z ^(n-1) + ... + D [0]**

这可以通过一些线性代数很容易地完成。特别是，您可以定义一个 (n+1)×(n+1) 矩阵*T*，它允许我们进行矩阵乘法

  ***d* = *T* * *c*** ,

其中*d*是具有顶部条目*D [0]*的列向量，到最后一个条目*D [n]*，列向量*c*与*C [i]*系数相似，并且矩阵*T*具有 (i,j)-th [i ^(th) row, j ^(th) column] 条目*t [ij]*由

  ***t [ij]* = ( *j*选择*i* ) *a ^i* *b ^(j-i)***。

其中 ( *j*选择*i* ) 是二项式系数，当*i* > *j*时 = 0 。此外，与标准矩阵不同，我认为 i,j 每个范围从 0 到 n（通常从 1 开始）。

[当您手动插入 z=ax+b 并使用二项式定理](http://en.wikipedia.org/wiki/Binomial_theorem)时，这基本上是写出多项式的展开和重新压缩的好方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-27T12:14:29.253

如果您必须多次计算变量 z = ax+b 的这种变化（我的意思是许多不同的多项式），泰勒的答案是正确的答案。另一方面，如果您只需要执行一次，那么将矩阵系数的计算与最终评估相结合会快得多。最好的方法是通过 Hörner 的方法在点 (ax+b) 符号地评估您的多项式：

*   您将多项式系数存储在向量 V 中（一开始，所有系数都为零），对于 i = n 到 0，您将其乘以 (ax+b) 并添加 C [i]。
*   添加 C [i]意味着将其添加到常数项
*   乘以 (ax+b) 意味着将所有系数乘以 b 到向量 K [1]中，将所有系数乘以 a 并将它们从常数项移到向量 K [2]中，然后将 K [1] +K [2]放回 V中。

这将更容易编程，计算速度更快。

请注意，将 y 更改为 w = cy+d 非常简单。最后，正如 mattiast 指出的那样，坐标的一般变化不会给你一个多项式。

**技术说明**：如果您仍想计算矩阵 T（由 Tyler 定义），则应使用 Pascal 规则的加权版本来计算它（这是 Hörner 计算隐含的内容）：

t [i,j] = bt [i,j-1] + 在[i-1,j-1]

这样，您可以简单地从左到右逐列计算它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T22:23:56.630

如果我正确理解您的问题，则无法保证在您更改坐标后该函数将保持多项式。例如设y=x^2，新坐标系x'=y，y'=x。现在方程变为 y' = sqrt(x')，这不是多项式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:42:34.473

你有等式：

```
y = Ax^(n-1) + Bx^(n-2) + ... + Z 
```

在 xy 空间中，并且您希望它在某个 x'y' 空间中。您需要的是转换函数 f(x) = x' 和 g(y) = y'（或 h(x') = x 和 j(y') = y）。在第一种情况下，您需要求解 x 并求解 y。一旦有了 x 和 y，就可以将这些结果代入原始方程并求解 y'。

这是否微不足道取决于用于从一个空间转换到另一个空间的函数的复杂性。例如，以下等式：

```
5x = x' and 10y = y' 
```

非常容易求解结果

```
y' = 2Ax'^(n-1) + 2Bx'^(n-2) + ... + 10Z 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T19:45:32.813

如果输入空间是线性相关的，那么是的，矩阵应该能够将一组系数转换为另一组系数。例如，如果您的“原始”x 空间中有多项式：

ax^3 + bx^2 + cx + d

你想转换成一个不同的 w 空间，其中 w = px+q

那么你想找到a'、b'、c'和d'这样

ax^3 + bx^2 + cx + d = a'w^3 + b'w^2 + c'w + d'

和一些代数，

a'w^3 + b'w^2 + c'w + d' = a'p^3x^3 + 3a'p^2qx^2 + 3a'pq^2x + a'q^3 + b'p ^2x^2 + 2b'pqx + b'q^2 + c'px + c'q + d'

所以

a = a'p^3

b = 3a'p^2q + b'p^2

c = 3a'pq^2 + 2b'pq + c'p

d = a'q^3 + b'q^2 + c'q + d'

可以重写为矩阵问题并解决。

# c# - 如果我在调度时在 c# 中注册一个事件，我是否保证在调度期间不会再次被调用？

> ID：141423
> 
> 赞同：5
> 
> 时间：2008-09-26T19:28:06.193
> 
> 标签：c#, events, mono

在 C# 中，我发现自己偶尔想在同一事件的调度过程中为某个事件注册一个方法。例如，如果我有一个基于同一事件的连续分派转换状态的类，我可能希望第一个状态的处理程序注销自身并注册第二个处理程序。但是，我不希望在下次触发事件之前调度第二个处理程序。

好消息是，微软的 C# 实现看起来就是这样。事件注册语法糖被替换为对 System.Delegate.Combine 的调用，它只是将当前调用列表和新方法连接到一个单独的列表中，并将其分配给事件属性。这给了我我想要的行为。

所以，我的问题是：这是语言标准保证的行为吗？我希望能够在 mono 下的其他平台上运行我的 C# 代码，并且通常希望确保我不会根据其实现对语言标准做出假设。

我在 MSDN 上找不到任何明确的信息。

如果你想要一个我正在谈论的具体例子，这里有一个例子：

```
 delegate void TestDelegate();
    static event TestDelegate TestEvent;

    static void Main (string[] args) {
        TestEvent += TestDelegateInstanceFirst;
        TestEvent();
        TestEvent();
    }

    static void TestDelegateInstanceFirst () {
        Console.WriteLine("First");
        TestEvent += TestDelegateInstanceSecond;
    }

    static void TestDelegateInstanceSecond () {
        Console.WriteLine("Second");
    } 
```

至少在 Windows 上，输出是：

```
First
First
Second 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T19:36:29.620

是的，这是有保证的。

来自统一的 C# 3.0 规范，第 15.1 节：

> 但是，当两个非空委托实例组合在一起时，它们的调用列表被连接起来——按照左操作数然后右操作数的顺序——形成一个新的调用列表，其中包含两个或更多条目。

注意“新调用列表”。再次在第 15.3 节中：

> 一旦实例化，委托实例总是引用相同的目标对象和方法。请记住，当两个委托组合在一起或从另一个委托中删除时，会产生一个新委托，并带有自己的调用列表；合并或删除的委托的调用列表保持不变。

最后，MSDN for System.Delegate 指出：

> 代表是不可变的；一旦创建，委托的调用列表就不会改变。

我怀疑 CLI 规范中有一些东西 - 我会检查你是否愿意，但希望这三个能给你足够的信心 :)

# javascript - 优雅地关闭 iframe 周围的框架（工具栏）

> ID：141427
> 
> 赞同：5
> 
> 时间：2008-09-26T19:28:39.047
> 
> 标签：javascript, html, xss

我创建了一个与相当流行的音乐零售商一起使用的工具。

该工具提供了增强的搜索功能（透明的 last.fm 结果，没有广告，没有跛脚，没有令人毛骨悚然的东西），我发现显示搜索的最有用和不引人注目的方式是使用备受诟病的 iframe 作为工具栏。这允许用户在不窃取用户焦点的情况下加载搜索。

我不是 iframe 的特别忠实粉丝，我认为添加“关闭此框架”（ala Google 图片搜索）链接让用户快速轻松地重新获得对浏览器的控制权是微不足道的。

但是与谷歌不同，我不知道 iframe 中内容的位置是什么（仅通过 src 开始）。

所以现在我发现自己陷入了 XSS 的世界和所有与安全相关的问题。

使用 Javascript，我添加了“后退”和“前进”按钮以及从父级链接调用的历史对象（当用户进行搜索时，结果会加载到 iframe 中，因此后退按钮允许他们返回主完成使用/阅读搜索结果后的网站）。

有什么方法可以调用 iframe 中的当前位置并将页面（现在没有框架）重新加载到该位置？

我检查了 PHP $GLOBAL/$_SERVER 变量，看看我可能会走运。我知道存在安全问题，但我看不出这个特定的函数与 history.back() 有什么不同，浏览器在没有“通知”我的父框架的情况下自行调用。

我知道我可以从 iframe 本身检索 src 位置，但当然假设用户没有导航到此页面之外，如果他们这样做，他们不介意丢失当前位置并被重定向回最初调用的页面框架（……啊……）。

似乎框架旨在窃取窗口，无法优雅地“突破”并保持用户会话的完整性。

难怪人们讨厌他们。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T19:36:18.437

在谷歌图像搜索中，当您删除框架时，它会按照您当前建议的方式运行，方法是返回到原始框架源。由于 XSS 的原因，找到当前位置应该是不可能的，如果是这样，它将被认为是一个错误并在后续的浏览器补丁中修复，所以如果存在这样的怪癖，最好不要依赖这样的怪癖。不过，一种在不暴露位置的情况下优雅地突围的方法会很好。这可能是您可以向[HTML5](http://www.whatwg.org/mailing-list)小组提出的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-27T15:11:19.470

感谢您 (hal10001) 和 Zach 抽出时间来回答。由于 xss 安全问题，我似乎很糟糕（正如我所怀疑的那样）。

我想我可以简单地将*所有*内容包装在基于 php 的代理中，但这显然会进入令人毛骨悚然的区域，更不用说增加的延迟等等。

我会继续旋转这个想法，以防我遇到一些理智和可用的东西，但在那之前我想我会使用稍微不那么友好的方法来推广原始框架并清除它们当前的位置（如果他们不这样做就像我可以重新审视 iframe/工具栏的情况。

再次感谢！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-27T01:56:44.153

并不是说它真的很有帮助，但最接近的方法是检测是否有人真的离开了原始框架源页面。当您浏览一个框架时，历史对象会维护条目，并且如果您在页面加载时的原始历史长度大于有人单击“跳出此框架...”时的历史长度，那么您知道他们正在浏览该框架.

# cryptography - 填写表单的 Web 应用程序是否有电子签名的标准实现？

> ID：141428
> 
> 赞同：3
> 
> 时间：2008-09-26T19:29:01.480
> 
> 标签：cryptography, standards, pgp, electronic-signature

我有一位客户有兴趣在冗长的（40 个问题）卖方申请表中添加电子签名支持。我对是否存在金融界人士期望看到的现有标准或流程感到有些困惑？

我当然可以添加一个系统，我们根据他们的回复生成一堆文本，让申请人用他们的私钥签名并上传公钥——但这似乎对人们提出了很多要求。这些天来，非书呆子甚至安装了 PGP 吗？

有没有标准的方法来解决这个问题？任何在金融界工作的人都做到了这一点并且运作良好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-02T16:33:25.287

我们使用[Alphatrust](http://www.alphatrust.com/)的[电子签名](http://www.alphatrust.com/Products/)软件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T20:12:01.860

签名试图填写的目的是什么？您是否正在尝试验证表单是否确实来自特定卖家？（如果是这样，您必须提前知道他们的公钥。）您是否试图让卖方在以后对他们的回答负责？（在这种情况下，您可能需要某种第三方参与。）

有时人们要求电子签名只是因为它们听起来很整洁。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2014-06-02T08:27:03.160

如果这些表格旨在通过公众共享，您将需要知道（并且可以验证，这是最难的部分）人们可以用来签署这些表格的这些数量的证书的所有生产者，这几乎是不可能的。

在封闭的环境（如工作人员、医生......）中，所有用户都应该持有证书（使用您信任的预先知道的 CA），并且您应该确保表单是由受信任的人发送的（不可否认性、完整性。 ..) 签署表格是更好的方案，否则我不建议您使用已签署的表格来实现您的目标。

# python - 如何使用 Cocoa 和 Python (PyObjC) 创建状态栏项目？

> ID：141432
> 
> 赞同：9
> 
> 时间：2008-09-26T19:29:48.343
> 
> 标签：python, cocoa, pyobjc

我在 XCode 中创建了一个全新的项目，并在我的 AppDelegate.py 文件中有以下内容：

```
from Foundation import *
from AppKit import *

class MyApplicationAppDelegate(NSObject):
    def applicationDidFinishLaunching_(self, sender):
        NSLog("Application did finish launching.")

        statusItem = NSStatusBar.systemStatusBar().statusItemWithLength_(NSVariableStatusItemLength)
        statusItem.setTitle_(u"12%")
        statusItem.setHighlightMode_(TRUE)
        statusItem.setEnabled_(TRUE) 
```

但是，当我启动应用程序时，没有显示状态栏项目。main.py 和 main.m 中的所有其他代码都是默认的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-12-07T17:27:19.400

上面的 .retain() 用法是必需的，因为 statusItem 在从 applicationDidFinishLaunching() 方法返回时被销毁。使用 self.statusItem 将该变量绑定为 MyApplicationAppDelegate 实例中的字段。

这是一个不需要 .xib / 等的修改示例...

```
from Foundation import *
from AppKit import *
from PyObjCTools import AppHelper

start_time = NSDate.date()

class MyApplicationAppDelegate(NSObject):

    state = 'idle'

    def applicationDidFinishLaunching_(self, sender):
        NSLog("Application did finish launching.")

        self.statusItem = NSStatusBar.systemStatusBar().statusItemWithLength_(NSVariableStatusItemLength)
        self.statusItem.setTitle_(u"Hello World")
        self.statusItem.setHighlightMode_(TRUE)
        self.statusItem.setEnabled_(TRUE)

        # Get the timer going
        self.timer = NSTimer.alloc().initWithFireDate_interval_target_selector_userInfo_repeats_(start_time, 5.0, self, 'tick:', None, True)
        NSRunLoop.currentRunLoop().addTimer_forMode_(self.timer, NSDefaultRunLoopMode)
        self.timer.fire()

    def sync_(self, notification):
        print "sync"

    def tick_(self, notification):
        print self.state

if __name__ == "__main__":
    app = NSApplication.sharedApplication()
    delegate = MyApplicationAppDelegate.alloc().init()
    app.setDelegate_(delegate)
    AppHelper.runEventLoop() 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T21:41:54.733

我必须这样做才能使其工作：

1.  打开 MainMenu.xib。确保应用程序委托的类是`MyApplicationAppDelegate`. 我不确定你是否必须这样做，但我做到了。这是错误的，所以应用程序委托一开始就没有被调用。

2.  添加`statusItem.retain()`是因为它会立即自动发布。

# msbuild - 与从命令行运行 DevEnv.exe 相比，使用 MSBuild 或 NAnt 的优势

> ID：141435
> 
> 赞同：20
> 
> 时间：2008-09-26T19:30:46.640
> 
> 标签：msbuild, build-process, nant

谁能解释使用像 MSBuild（或 NAnt）这样的工具来构建项目集合与从命令行运行 DevEnv.exe 相比有什么优势？

我过去共事过的一位同事解释说（至少在旧版本的 Visual Studio 中）使用 DevEnv.exe 比其他技术慢得多，但我还没有读到任何证据，或者如果那现在是现在有争议的一点是，从 2005 年开始，Visual Studio 在后台使用 MSBuild。

我知道使用 MSBuild 的一个优势是让您无需在构建机器上安装 Visual Studio 即可构建您的项目，但我不确定是否还有其他优势。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-26T19:59:36.913

一个原因是因为构建产品不仅仅是编译它。由于这些工具（及其扩展）提供的功能，创建安装、更新版本号、创建托管、分发最终包等任务会变得更加容易。

虽然您可以使用常规脚本完成所有这些工作，但使用 NAnt 或 MSBuild 为您提供了一个可靠的框架来完成所有这些工作。两者都有很多社区支持，包括可以下载的其他任务（例如[MSBuild 社区任务项目](http://msbuildtasks.tigris.org/)）。此外，许多第三方和开源产品都支持它们。

如果您只对编译（而不是整个构建过程）感兴趣，您可能会发现 MSBuild 的一个节省时间的好处是[支持使用多个处理器进行构建](http://blogs.msdn.com/msbuild/archive/2007/10/22/enabling-multiprocessor-support-in-an-msbuild-host.aspx)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T01:58:22.143

我的团队给出的明显答案是，**并不是每个人都**安装了 Visual Studio，特别是我们没有将 Visual Studio 安装到我们的构建/CI 服务器上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T19:35:48.140

使用 NAnt 或 MsBuild 等外部​​构建工具的主要原因是能够自动化构建过程，从而提供有关系统状态的持续反馈。除了“纯”构建之外，它们还可以用于许多事情，这就是您真正开始从它们那里获得价值的地方，能够使用单个命令构建和测试您的应用程序是一件非常有价值的事情。

您还可以开始添加诸如指标集合、发布二进制文件打包和各种类似的漂亮东西之类的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-17T00:32:19.797

就 C# 而言，devenv.exe 2005 在进程内运行编译器，这可能会导致相当大的解决方案出现内存不足异常。Msbuild 为每个项目启动 csc.exe 进程。不使用 devenv /build 编译的项目可以使用 msbuild 正常工作。希望你喜欢这个理由。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T13:27:54.103

我们正在尝试从 DevEnv 切换到在后台使用 MsBuild 的工具（Visual Build Pro），并且对于不需要它的项目，我们得到了“组装'System.Drawing ...所需的参考”错误在 Visual Studio 中构建良好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-17T00:54:42.177

我们有一个由 C#、托管 C++ 和普通旧的非托管 C++ 程序集/dll 组成的大型系统。有依赖于托管 C++ 代码的 C++ 代码依赖于依赖于普通旧 C++ 代码的托管 C++ 代码的 C# 代码（哇！）。几年前，当我们设置我们的自动化构建环境时，我们发现 MSBuild.exe 没有正确处理我们拥有的所有依赖项。

与 Microsoft 合作，我们能够解决一些问题，但不是全部。如果我没记错的话，我们永远无法构建依赖托管 C++ dll 的 C# 程序集。所以我们最终制作了一个从命令行调用 devenv.exe 的自定义构建脚本，它工作得很好。

当然，那是 VS2005 的问题，现在可能已修复，但脚本仍在工作，所以我们没有重新讨论这个问题。

# javascript - JavaScript try-catch 是否忽略预期的偶尔错误是不好的做法？

> ID：141441
> 
> 赞同：7
> 
> 时间：2008-09-26T19:31:07.793
> 
> 标签：javascript, try-catch

在 JavaScript 中使用 try-catch 块并忽略错误而不是测试块中的许多属性是否为 null 是错误的吗？

```
try{ 
   if(myInfo.person.name == newInfo.person.name
      && myInfo.person.address.street == newInfo.person.address.street
      && myInfo.person.address.zip == newInfo.person.address.zip) {
         this.setAddress(newInfo);
    } 
} catch(e) {} // ignore missing args 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T19:39:40.473

如果您期望特定条件，那么如果您明确地测试它，您的代码将更容易维护。我会把上面写成类似的东西

```
if(   myInfo && newInfo 
      && myInfo.person && newInfo.person
      && myInfo.person.address && newInfo.person.address
      && ( myInfo.person.name == newInfo.person.name
           && myInfo.person.address.street == newInfo.person.address.street
           && myInfo.person.address.zip == newInfo.person.address.zip
         )
) 
{
     this.setAddress(newInfo);
} 
```

这使得效果更加清晰 - 例如，假设 newInfo 全部填写，但部分 myInfo 丢失？也许您实际上希望在这种情况下调用 setAddress() ？如果是这样，您将需要更改该逻辑！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:38:24.233

是的。一方面，除了缺少参数之外，还可能由于多种原因引发异常。包罗万象将隐藏那些可能不需要的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T19:38:05.763

我认为，如果您要捕获异常，请对其进行处理。否则，让它冒泡，以便更高级别可以以某种方式处理它（即使它只是浏览器向您报告错误）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T19:47:41.047

在相关说明中，在 IE 中，即使规范说可以，但不能使用 try/finally 组合。为了让你的“finally”执行，你必须定义一个 catch 块，即使它是空的。

```
//this will [NOT] do the reset in Internet Explorer
try{
  doErrorProneAction();
} finally {
  //clean up
  this.reset();
}

//this [WILL] do the reset in Internet Explorer
try{
  doErrorProneAction();
} catch(ex){
  //do nothing
} finally {
  //clean up
  this.reset();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T21:48:11.677

您总是可以编写一个辅助函数来为您进行检查：

```
function pathEquals(obj1, obj2, path)
{
    var properties = path.split(".");
    for (var i = 0, l = properties.length; i < l; i++)
    {
        var property = properties[i];
        if (obj1 === null || typeof obj1[property] == "undefined" ||
            obj2 === null || typeof obj2[property] == "undefined")
        {
            return false;
        }

        obj1 = obj1[property];
        obj2 = obj2[property];
    }

    return (obj1 === obj2);
}

if (pathEquals(myInfo, newInfo, "person.name") &&
    pathEquals(myInfo, newInfo, "person.address.street") &&
    pathEquals(myInfo, newInfo, "person.address.zip"))
{
    this.setAddress(newInfo);
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-26T19:37:41.240

对于给出的示例，我会说这是不好的做法。然而，在某些情况下，简单地捕获**预期**错误可能更**有效。**[在将字符串转换为 GUID](https://stackoverflow.com/questions/104850/c-test-if-string-is-a-guid-without-throwing-exceptions#104932)之前验证字符串的格式就是一个很好的例子。

 **# python - 如何在 Python 中将字符串包装到文件中？

> ID：141449
> 
> 赞同：109
> 
> 时间：2008-09-26T19:33:55.570
> 
> 标签：python, string, file, stringio

如何使用字符串的内容创建类似文件的对象（与 File 相同的鸭子类型）？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-09-26T19:34:04.977

对于 Python 2.x，请使用[StringIO](https://docs.python.org/2/library/stringio.html)模块。例如：

```
>>> from cStringIO import StringIO
>>> f = StringIO('foo')
>>> f.read()
'foo' 
```

我使用 cStringIO （更快），但请注意，它不[接受无法编码为纯 ASCII 字符串的 Unicode 字符串](http://docs.python.org/lib/module-cStringIO.html)。（您可以通过将“from cStringIO”更改为“from StringIO”来切换到 StringIO。）

对于 Python 3.x，请使用该[`io`](https://docs.python.org/3/library/io.html#text-i-o)模块。

```
f = io.StringIO('foo') 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-09-26T22:00:25.923

在 Python 3.0 中：

```
import io

with io.StringIO() as f:
    f.write('abcdef')
    print('gh', file=f)
    f.seek(0)
    print(f.read()) 
```

输出是：

```
'abcdefgh' 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-02-27T15:02:22.077

这适用于 Python2.7 和 Python3.x：

```
io.StringIO(u'foo') 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2020-02-05T20:01:21.203

如果您的类文件对象预计包含字节，则应首先将字符串编码为字节，然后可以使用[BytesIO对象代替。](https://docs.python.org/3/library/io.html#text-i-o)在 Python 3 中：

```
from io import BytesIO

string_repr_of_file = 'header\n byline\n body\n body\n end'
function_that_expects_bytes(BytesIO(bytes(string_repr_of_file,encoding='utf-8'))) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-27T12:19:45.217

两个很好的答案。我要添加一个小技巧——如果你需要一个真正的文件对象（有些方法需要一个，而不仅仅是一个接口），这里有一种创建适配器的方法：

*   [http://www.rfk.id.au/software/filelike/](http://www.rfk.id.au/software/filelike/)

# javascript - Javascript检测选择元素的下拉菜单是否可见

> ID：141450
> 
> 赞同：6
> 
> 时间：2008-09-26T19:34:03.013
> 
> 标签：javascript, html, html-select

我在表单中有一个选择元素，我只想在下拉菜单不可见时才显示一些内容。我尝试过的事情：

*   观察点击事件，奇数点击意味着下拉菜单可见，偶数点击意味着下拉菜单不可见。错过了下拉菜单可能消失的其他方式（按转义键，切换到另一个窗口），我认为这可能很难跨浏览器获得正确的。
*   更改事件，但这些仅在选择框的值更改时触发。

想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-11T01:27:37.353

这就是我希望这样做的方式。焦点和模糊就是它所在的位置。

```
<html>
    <head>
        <title>SandBox</title>
    </head>
    <body>
        <select id="ddlBox">
            <option>Option 1</option>
            <option>Option 2</option>
            <option>Option 3</option>
        </select>
        <div id="divMsg">some text or whatever goes here.</div>
    </body>
</html>
<script type="text/javascript">
    window.onload = function() {
        var ddlBox = document.getElementById("ddlBox");
        var divMsg = document.getElementById("divMsg");
        if (ddlBox && divMsg) {
            ddlBox.onfocus = function() {
                divMsg.style.display = "none";
            }
            ddlBox.onblur = function() {
                divMsg.style.display = "";
            }
            divMsg.style.display = "";
        }
    }
</script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-01T19:42:17.920

条件内容，这就是你要问的，并不难。在下面的示例中，我将使用[jQuery](http://www.jquery.com)来实现我们的目标：

```
<select id="theSelectId">
  <option value="dogs">Dogs</option>
  <option value="birds">Birds</option>
  <option value="cats">Cats</option>
  <option value="horses">Horses</option>
</select>

<div id="myDiv" style="width:300px;height:100px;background:#cc0000"></div> 
```

我们将根据#theSelectId 的选定值绑定几个事件来显示/隐藏#myDiv

```
$("#theSelectId").change(function(){
  if ($(this).val() != "dogs")
    $("#myDiv").fadeOut();
  else
    $("#myDiv").fadeIn();
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T19:41:36.503

我的第一个问题是——你为什么要这么做？我想不出任何表现出这种行为的应用程序，我想不出发生这种情况的充分理由。

我并不是说你没有充分的理由，但我只是不知道那可能是什么:)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:48:17.613

我认为没有直接的支持。您也可以坐在Select的Onblur上 - 当Select Offoy focus时，它会被调用。

根据它的重要性，您可以尝试实现自己的控件或从类似的下拉菜单控件开始。通常，除非它对您的应用程序至关重要，否则不值得这样做。如果你决定走这条路，这里有一个人试图以 dojo 为基础进行讨论：

[http://dojotoolkit.org/forum/dijit-dijit-0-9/dijit-support/emulating-html-select](http://dojotoolkit.org/forum/dijit-dijit-0-9/dijit-support/emulating-html-select)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T19:49:04.630

使用 JavaScript 变量跟踪状态。我们称之为“openX”。

onfocus="openX=true" onblur="openX=false" onchange="openX=false"

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T22:07:40.663

在 jQuery 中，测试是否可见：

```
$('something').css('display') 
```

这将返回类似“block”、“inline”或“none”的内容（如果未显示元素）。这只是 CSS 'display' 属性的表示。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T23:34:18.053

这个基本示例演示了如何使用 setInterval 执行此操作。它每秒检查一次选择菜单的显示状态，然后隐藏或显示一段内容。它根据您的问题描述工作，无论选择菜单隐藏什么，它都会相应地显示该内容。换句话说，toggleDisplay() 的设置只是为了证明这一点。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title></title>
<script language="javascript" type="text/javascript">

var STECHZ = {
    init : function() {
        STECHZ.setDisplayedInterval();
    },
    setDisplayedInterval : function() {
        STECHZ.isDisplayedInterval = window.setInterval(function(){
            if ( document.getElementById( "mySelectMenu" ).style.display == "none" ) {
                document.getElementById( "myObjectToShow" ).style.display = "block";
            } else {
                document.getElementById( "myObjectToShow" ).style.display = "none";
            }
        }, 1000);
    },
    isDisplayedInterval : null,
    toggleDisplay : function() {
        var mySelectMenu = document.getElementById( "mySelectMenu" );
        if ( mySelectMenu.style.display == "none" ) {
            mySelectMenu.style.display = "block";
        } else {
            mySelectMenu.style.display = "none";
        }
    }
};

window.onload = function(){

    STECHZ.init();

}

</script>
</head>
<body>
    <p>
        <a href="#" onclick="STECHZ.toggleDisplay();return false;">Click to toggle display.</a>
    </p>
    <select id="mySelectMenu">
        <option>Option 1</option>
        <option>Option 2</option>
        <option>Option 3</option>
    </select>
    <div id="myObjectToShow" style="display: none;">Only show when mySelectMenu is not showing.</div>
</body>
</html> 
```

# c# - 如何从缓存中清除过期项目？

> ID：141452
> 
> 赞同：3
> 
> 时间：2008-09-26T19:34:09.050
> 
> 标签：c#, .net, caching

我已经构建了一个不错的小类，用作缓存。每个项目都有一个过期时间跨度或日期时间。每次尝试访问缓存中的项目时，都会检查该项目的过期时间，如果过期，则将该项目从缓存中删除并且不返回任何内容。

这对于经常访问的对象来说非常有用，但是如果一个项目被放入缓存中并且再也不会被访问，那么即使它已经过期，它也永远不会被删除。

从缓存中使此类项目过期的好方法是什么？

我是否应该有一个后台线程无限枚举缓存中的每个项目以检查它是否已过期？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T21:36:23.093

The best code is no code. Use the ASP.NET cache instead. You can reference it as System.Web.HttpRuntime.Cache in any application, not just web applications.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:37:04.970

您可以实施 LRU（最近最少使用）策略，保持您的项目按访问时间排序，当一个新项目插入缓存**并且**缓存已满时，您驱逐该列表中最后一个项目。请参阅Wikipedia 上的[缓存算法](http://en.wikipedia.org/wiki/Cache_algorithms)。

如果您想立即过期，我仍然只会在访问内容时这样做。即当缓存对象被访问并且它的时间已经过期时重新获取它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T19:38:11.490

您还可以对缓存的任何更改（重新）启动一个 Timer，并将 Interval 设置为最接近的到期时间戳。这不会精确到毫秒，并且取决于消息泵的运行，但对资源的要求不是很高。

Harald Scheirich 的回答会更好，如果您不介意在缓存未更新时对象会永远挂起。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T19:40:21.843

在最后一次清除项目后 1 分钟后，您可以在第一次访问时从缓存中清除适当的旧项目。

```
private DateTime nextFlush;
public object getItem(object key)
{
  DateTime now = DateTime.Now
  if (now > nextFlush)
  {
    Flush();
    nextFlush = now.AddMinutes(1)
  }
  return fetchItem(key);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T19:41:41.137

以我的经验，维护自定义缓存机制变得比它的价值更麻烦。有几个图书馆已经解决了这些问题。我建议使用其中之一。.Net 中流行的一个是企业库，尽管我对它的缓存能力的经验有限。

如果您必须使用自定义缓存机制，那么我认为您建议的监视线程想法没有问题。也就是说，如果您的应用程序是基于服务器的应用程序而不是 Web 应用程序。如果它是一个网络应用程序，你已经内置了滑动到期。然后，您可以将其包装在强类型包装器中，以避免每次都按键引用缓存项。

# java - Microsoft SQL Server CE(精简版) 3.5 的 jdbc 驱动程序

> ID：141454
> 
> 赞同：5
> 
> 时间：2008-09-26T19:34:15.663
> 
> 标签：java, sql-server, database, jdbc, sql-server-ce

我希望能够为这个版本的数据库探索数据库的内容。我正在考虑使用 Squirrel DB 客户端（需要 JDBC 驱动程序）。

因此，我正在寻找适用于 SQL SERVER 3.5 的 JDBC 类型 4 驱动程序。有人可以指点我免费或开源或试用件吗？

如果没有 JDBC 驱动程序，MS 开发人员如何探索给定的 .SDF 文件？

谢谢，

BR，
~A

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T23:06:35.670

您是否尝试过[SQL Server Management Studio Express](http://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&DisplayLang=en)？

> 您可以使用 SQL Server 中的 SQL Server Management Studio 或 SQL Server Management Studio Express (SSMSE) 访问存储在智能设备或台式计算机上的 SQL Server Compact 3.5 数据库。[http://technet.microsoft.com/en-us/library/ms172037.aspx](http://technet.microsoft.com/en-us/library/ms172037.aspx)

至于JDBC Driver，你可以看看微软提供的[这个](http://msdn.microsoft.com/en-us/data/aa937724.aspx)。我不知道它是否适用于精简版，或者您是否已经尝试过，但我认为值得一提。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T14:41:33.833

1- 没有 JDBC 驱动程序，在撰写本文时，MS 没有计划创建一个。

2- 没有 ODBC 驱动程序，所以下一个明显的答案（JDBC 到 ODBC 桥）对您没有帮助。

3- 一些 JDBC 供应商声称能够连接到“任何 oledb”数据源，所以这很可能是最好的选择——[链接](http://www.sqlsummit.com/JDBCVend.htm)，但它不一定是免费的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T15:04:33.630

试试 jTDS，它是用于 SQL Server 和 Sybase 的免费软件 JDBC 驱动程序。

[http://jtds.sourceforge.net/](http://jtds.sourceforge.net/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-01T23:35:29.477

JDBC 驱动程序使用 TCP/IP 连接。精简版很可能无法侦听 TCP/IP 端口 1433。精简版旨在由加载了与之通信所需的 .dll 的应用程序访问。它适用于 Visual Studio 项目。

您需要卸载精简版并安装 SQL Express 2005/2008。安装后启用“sa”帐户，给它一个密码，启用 SQL+NT 身份验证，然后启用 TCP/IP 侦听器侦听端口 1433（默认端口）。

然后，最后，您可以使用 JDBC 进行连接。Jtds 是 JDBC3.0 驱动，因此需要 JDK1.6+ 。我更喜欢使用 Microsoft 2005 JDBC2.0 驱动程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-12T18:36:46.167

有一个名为 SQLCeEditor 的免费程序可以做到这一点。

不过，我仍然想要一个 JDBC 驱动程序，因为这样可以很容易地与 Eclipse 和 Java 一起使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-09T21:13:16.477

Use [SDF Viewer](http://www.flyhoward.com/SDF_Viewer.aspx) to explore your .SDF database file, can also import/export data, script and work with tables, indexes and foreign keys.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-10T20:13:26.330

If you're into linq syntax, you can also use [LinqPad](http://www.linqpad.net/). There's a free version that allows exploring the data and editing it. You would pay for autocompletion but you can live without it. I hope this helps.

# c# - 递归列表展平

> ID：141467
> 
> 赞同：39
> 
> 时间：2008-09-26T19:36:20.200
> 
> 标签：c#, .net, recursion

我可能自己写这个，但我试图完成它的具体方式让我失望。我正在尝试编写一种类似于 .NET 3.5 中引入的其他方法的通用扩展方法，它将采用嵌套的 IEnumerables（等等）并将其展平为一个 IEnumerable。有人有想法么？

具体来说，我在扩展方法本身的语法方面遇到了问题，因此我可以研究扁平化算法。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-23T11:48:45.207

这是一个可能有帮助的扩展。它将遍历对象层次结构中的所有节点，并挑选出符合条件的节点。它假定层次结构中的每个对象都有一个包含其子对象**的集合属性。**

## 这是扩展名：

```
/// Traverses an object hierarchy and return a flattened list of elements
/// based on a predicate.
/// 
/// TSource: The type of object in your collection.</typeparam>
/// source: The collection of your topmost TSource objects.</param>
/// selectorFunction: A predicate for choosing the objects you want.
/// getChildrenFunction: A function that fetches the child collection from an object.
/// returns: A flattened list of objects which meet the criteria in selectorFunction.
public static IEnumerable<TSource> Map<TSource>(
  this IEnumerable<TSource> source,
  Func<TSource, bool> selectorFunction,
  Func<TSource, IEnumerable<TSource>> getChildrenFunction)
{
  // Add what we have to the stack
  var flattenedList = source.Where(selectorFunction);

  // Go through the input enumerable looking for children,
  // and add those if we have them
  foreach (TSource element in source)
  {
    flattenedList = flattenedList.Concat(
      getChildrenFunction(element).Map(selectorFunction,
                                       getChildrenFunction)
    );
  }
  return flattenedList;
} 
```

## 示例（单元测试）：

首先，我们需要一个对象和一个嵌套对象层次结构。

一个简单的节点类

```
class Node
{
  public int NodeId { get; set; }
  public int LevelId { get; set; }
  public IEnumerable<Node> Children { get; set; }

  public override string ToString()
  {
    return String.Format("Node {0}, Level {1}", this.NodeId, this.LevelId);
  }
} 
```

以及一种获得 3 级深层节点层次结构的方法

```
private IEnumerable<Node> GetNodes()
{
  // Create a 3-level deep hierarchy of nodes
  Node[] nodes = new Node[]
    {
      new Node 
      { 
        NodeId = 1, 
        LevelId = 1, 
        Children = new Node[]
        {
          new Node { NodeId = 2, LevelId = 2, Children = new Node[] {} },
          new Node
          {
            NodeId = 3,
            LevelId = 2,
            Children = new Node[]
            {
              new Node { NodeId = 4, LevelId = 3, Children = new Node[] {} },
              new Node { NodeId = 5, LevelId = 3, Children = new Node[] {} }
            }
          }
        }
      },
      new Node { NodeId = 6, LevelId = 1, Children = new Node[] {} }
    };
  return nodes;
} 
```

第一次测试：扁平化层次结构，不过滤

```
[Test]
public void Flatten_Nested_Heirachy()
{
  IEnumerable<Node> nodes = GetNodes();
  var flattenedNodes = nodes.Map(
    p => true, 
    (Node n) => { return n.Children; }
  );
  foreach (Node flatNode in flattenedNodes)
  {
    Console.WriteLine(flatNode.ToString());
  }

  // Make sure we only end up with 6 nodes
  Assert.AreEqual(6, flattenedNodes.Count());
} 
```

这将显示：

```
Node 1, Level 1
Node 6, Level 1
Node 2, Level 2
Node 3, Level 2
Node 4, Level 3
Node 5, Level 3 
```

第二个测试：获取具有偶数 NodeId 的节点列表

```
[Test]
public void Only_Return_Nodes_With_Even_Numbered_Node_IDs()
{
  IEnumerable<Node> nodes = GetNodes();
  var flattenedNodes = nodes.Map(
    p => (p.NodeId % 2) == 0, 
    (Node n) => { return n.Children; }
  );
  foreach (Node flatNode in flattenedNodes)
  {
    Console.WriteLine(flatNode.ToString());
  }
  // Make sure we only end up with 3 nodes
  Assert.AreEqual(3, flattenedNodes.Count());
} 
```

这将显示：

```
Node 6, Level 1
Node 2, Level 2
Node 4, Level 3 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-26T19:47:25.600

嗯......我不确定你*到底*想要什么，但这里有一个“一级”选项：

```
public static IEnumerable<TElement> Flatten<TElement,TSequence> (this IEnumerable<TSequence> sequences)
    where TSequence : IEnumerable<TElement> 
{
    foreach (TSequence sequence in sequences)
    {
        foreach(TElement element in sequence)
        {
            yield return element;
        }
    }
} 
```

如果这不是你想要的，你能提供你想要的签名吗？如果您不需要通用形式，而只想做 LINQ to XML 构造函数所做的那种事情，那相当简单——尽管迭代器块的递归使用效率相对较低。就像是：

```
static IEnumerable Flatten(params object[] objects)
{
    // Can't easily get varargs behaviour with IEnumerable
    return Flatten((IEnumerable) objects);
}

static IEnumerable Flatten(IEnumerable enumerable)
{
    foreach (object element in enumerable)
    {
        IEnumerable candidate = element as IEnumerable;
        if (candidate != null)
        {
            foreach (object nested in candidate)
            {
                yield return nested;
            }
        }
        else
        {
            yield return element;
        }
    }
} 
```

请注意，这会将字符串视为一系列字符，但是 - 您可能希望将特殊情况下的字符串作为单独的元素而不是将它们展平，具体取决于您的用例。

这有帮助吗？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-06-21T14:26:22.450

我想我会分享一个包含错误处理和单一逻辑方法的完整示例。

递归展平很简单：

**LINQ 版本**

```
public static class IEnumerableExtensions
{
    public static IEnumerable<T> SelectManyRecursive<T>(this IEnumerable<T> source, Func<T, IEnumerable<T>> selector)
    {
        if (source == null) throw new ArgumentNullException("source");
        if (selector == null) throw new ArgumentNullException("selector");

        return !source.Any() ? source :
            source.Concat(
                source
                .SelectMany(i => selector(i).EmptyIfNull())
                .SelectManyRecursive(selector)
            );
    }

    public static IEnumerable<T> EmptyIfNull<T>(this IEnumerable<T> source)
    {
        return source ?? Enumerable.Empty<T>();
    }
} 
```

**非 LINQ 版本**

```
public static class IEnumerableExtensions
{
    public static IEnumerable<T> SelectManyRecursive<T>(this IEnumerable<T> source, Func<T, IEnumerable<T>> selector)
    {
        if (source == null) throw new ArgumentNullException("source");
        if (selector == null) throw new ArgumentNullException("selector");

        foreach (T item in source)
        {
            yield return item;

            var children = selector(item);
            if (children == null)
                continue;

            foreach (T descendant in children.SelectManyRecursive(selector))
            {
                yield return descendant;
            }
        }
    }
} 
```

**设计决策**

我决定：

*   禁止对 null 进行展平`IEnumerable`，这可以通过删除异常抛出来改变，并且：
    *   在第一版`source = source.EmptyIfNull();`之前添加`return`
    *   在第二版`if (source != null)`之前添加`foreach`
*   允许选择器返回一个空集合 - 这样我就从调用者那里移除了确保子列表不为空的责任，这可以通过以下方式更改：
    *   在第一个版本中删除`.EmptyIfNull()`- 注意`SelectMany`如果选择器返回 null 将失败
    *   在第二个版本中删除`if (children == null) continue;`- 请注意，`foreach`空`IEnumerable`参数将失败
*   允许`.Where`在调用方或*子选择器*内过滤子句，而不是传递*子过滤器选择器*参数：
    *   它不会影响效率，因为在两个版本中它都是延迟调用
    *   它会将另一个逻辑与该方法混合，我更喜欢将逻辑分开

**样品使用**

我在 LightSwitch 中使用这个扩展方法来获取屏幕上的所有控件：

```
public static class ScreenObjectExtensions
{
    public static IEnumerable<IContentItemProxy> FindControls(this IScreenObject screen)
    {
        var model = screen.Details.GetModel();

        return model.GetChildItems()
            .SelectManyRecursive(c => c.GetChildItems())
            .OfType<IContentItemDefinition>()
            .Select(c => screen.FindControl(c.Name));
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-21T21:04:12.953

这是修改后[的 Jon Skeet 的答案](https://stackoverflow.com/questions/141467/recursive-list-flattening#141528)，允许超过“一个级别”：

```
static IEnumerable Flatten(IEnumerable enumerable)
{
    foreach (object element in enumerable)
    {
        IEnumerable candidate = element as IEnumerable;
        if (candidate != null)
        {
            foreach (object nested in Flatten(candidate))
            {
                yield return nested;
            }
        }
        else
        {
            yield return element;
        }
    }
} 
```

免责声明：我不知道 C#。

在 Python 中也是如此：

```
#!/usr/bin/env python

def flatten(iterable):
    for item in iterable:
        if hasattr(item, '__iter__'):
            for nested in flatten(item):
                yield nested
        else:
            yield item

if __name__ == '__main__':
    for item in flatten([1,[2, 3, [[4], 5]], 6, [[[7]]], [8]]):
        print(item, end=" ") 
```

它打印：

```
1 2 3 4 5 6 7 8 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-26T19:48:49.357

这不是 [SelectMany][1] 的用途吗？

```
enum1.SelectMany(
    a => a.SelectMany(
        b => b.SelectMany(
            c => c.Select(
                d => d.Name
            )
        )
    )
); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-05-19T12:08:29.877

功能：

```
public static class MyExtentions
{
    public static IEnumerable<T> RecursiveSelector<T>(this IEnumerable<T> nodes, Func<T, IEnumerable<T>> selector)
    {
        if(nodes.Any() == false)
        {
            return nodes; 
        }

        var descendants = nodes
                            .SelectMany(selector)
                            .RecursiveSelector(selector);

        return nodes.Concat(descendants);
    } 
} 
```

用法：

```
var ar = new[]
{
    new Node
    {
        Name = "1",
        Chilren = new[]
        {
            new Node
            {
                Name = "11",
                Children = new[]
                {
                    new Node
                    {
                        Name = "111",

                    }
                }
            }
        }
    }
};

var flattened = ar.RecursiveSelector(x => x.Children).ToList(); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-04-15T22:57:03.030

好的，这是另一个版本，它结合了上面大约 3 个答案。

递归的。使用产量。通用的。可选过滤谓词。可选的选择功能。尽可能简洁。

```
 public static IEnumerable<TNode> Flatten<TNode>(
        this IEnumerable<TNode> nodes, 
        Func<TNode, bool> filterBy = null,
        Func<TNode, IEnumerable<TNode>> selectChildren = null
        )
    {
        if (nodes == null) yield break;
        if (filterBy != null) nodes = nodes.Where(filterBy);

        foreach (var node in nodes)
        {
            yield return node;

            var children = (selectChildren == null)
                ? node as IEnumerable<TNode>
                : selectChildren(node);

            if (children == null) continue;

            foreach (var child in children.Flatten(filterBy, selectChildren))
            {
                yield return child;
            }
        }
    } 
```

用法：

```
// With filter predicate, with selection function
var flatList = nodes.Flatten(n => n.IsDeleted == false, n => n.Children); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-23T12:16:57.257

[`SelectMany`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.selectmany.aspx)扩展方法已经这样做了。

> 将序列的每个元素投影到 IEnumerable<(Of <(T>)>) 并将结果序列展平为一个序列。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-17T19:04:47.123

由于 VB 中不提供 yield 并且 LINQ 提供了延迟执行和简洁的语法，因此您也可以使用。

```
<Extension()>
Public Function Flatten(Of T)(ByVal objects As Generic.IEnumerable(Of T), ByVal selector As Func(Of T, Generic.IEnumerable(Of T))) As Generic.IEnumerable(Of T)
   If(objects.Any()) Then
      Return objects.Union(objects.Select(selector).Where(e => e != null).SelectMany(e => e)).Flatten(selector))
   Else
      Return objects 
   End If
End Function 
```

```
public static class Extensions{
  public static IEnumerable<T> Flatten<T>(this IEnumerable<T> objects, Func<T, IEnumerable<T>> selector) where T:Component{
    if(objects.Any()){
        return objects.Union(objects.Select(selector).Where(e => e != null).SelectMany(e => e).Flatten(selector));
    }
    return objects;
  }
} 
```

*编辑*为包括：

*   [每个https://stackoverflow.com/a/30325216/107683](https://stackoverflow.com/a/30325216/107683)的空可枚举 ，
*   [每个https://stackoverflow.com/a/39338919/107683](https://stackoverflow.com/a/39338919/107683)可枚举为 null
*   C# 实现。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-07-14T22:59:05.430

我不得不从头开始实现我的，因为如果有一个循环，即一个指向其祖先的孩子，所有提供的解决方案都会中断。如果您有与我相同的要求，请查看此（如果我的解决方案在任何特殊情况下会中断，请告诉我）：

如何使用：

```
var flattenlist = rootItem.Flatten(obj => obj.ChildItems, obj => obj.Id) 
```

代码：

```
public static class Extensions
    {
        /// <summary>
        /// This would flatten out a recursive data structure ignoring the loops. The end result would be an enumerable which enumerates all the
        /// items in the data structure regardless of the level of nesting.
        /// </summary>
        /// <typeparam name="T">Type of the recursive data structure</typeparam>
        /// <param name="source">Source element</param>
        /// <param name="childrenSelector">a function that returns the children of a given data element of type T</param>
        /// <param name="keySelector">a function that returns a key value for each element</param>
        /// <returns>a faltten list of all the items within recursive data structure of T</returns>
        public static IEnumerable<T> Flatten<T>(this IEnumerable<T> source,
            Func<T, IEnumerable<T>> childrenSelector,
            Func<T, object> keySelector) where T : class
        {
            if (source == null)
                throw new ArgumentNullException("source");
            if (childrenSelector == null)
                throw new ArgumentNullException("childrenSelector");
            if (keySelector == null)
                throw new ArgumentNullException("keySelector");
            var stack = new Stack<T>( source);
            var dictionary = new Dictionary<object, T>();
            while (stack.Any())
            {
                var currentItem = stack.Pop();
                var currentkey = keySelector(currentItem);
                if (dictionary.ContainsKey(currentkey) == false)
                {
                    dictionary.Add(currentkey, currentItem);
                    var children = childrenSelector(currentItem);
                    if (children != null)
                    {
                        foreach (var child in children)
                        {
                            stack.Push(child);
                        }
                    }
                }
                yield return currentItem;
            }
        }

        /// <summary>
        /// This would flatten out a recursive data structure ignoring the loops. The     end result would be an enumerable which enumerates all the
        /// items in the data structure regardless of the level of nesting.
        /// </summary>
        /// <typeparam name="T">Type of the recursive data structure</typeparam>
        /// <param name="source">Source element</param>
        /// <param name="childrenSelector">a function that returns the children of a     given data element of type T</param>
        /// <param name="keySelector">a function that returns a key value for each   element</param>
        /// <returns>a faltten list of all the items within recursive data structure of T</returns>
        public static IEnumerable<T> Flatten<T>(this T source, 
            Func<T, IEnumerable<T>> childrenSelector,
            Func<T, object> keySelector) where T: class
        {
            return Flatten(new [] {source}, childrenSelector, keySelector);
        }
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T19:42:53.007

```
static class EnumerableExtensions
{
    public static IEnumerable<T> Flatten<T>(this IEnumerable<IEnumerable<T>> sequence)
    {
        foreach(var child in sequence)
            foreach(var item in child)
                yield return item;
    }
} 
```

也许像这样？或者你的意思是它可能很深？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-05-03T10:16:55.940

```
class PageViewModel { 
    public IEnumerable<PageViewModel> ChildrenPages { get; set; } 
}

Func<IEnumerable<PageViewModel>, IEnumerable<PageViewModel>> concatAll = null;
concatAll = list => list.SelectMany(l => l.ChildrenPages.Any() ? 
    concatAll(l.ChildrenPages).Union(new[] { l }) : new[] { l });

var allPages = concatAll(source).ToArray(); 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-26T19:47:06.680

基本上，您需要有一个主 IENumerable 在您的递归函数之外，然后在您的递归函数中（伪代码）

```
private void flattenList(IEnumerable<T> list)
{
    foreach (T item in list)
    {
        masterList.Add(item);

        if (item.Count > 0)
        {
            this.flattenList(item);
        }
    }
} 
```

虽然我真的不确定嵌套在 IEnumerable 中的 IEnumerable 是什么意思……那里面是什么？嵌套多少级？最后的类型是什么？显然我的代码不正确，但我希望它能让你思考。

# wcf - 如何使用用户名/密码 + SSL 使用 WCF 配置安全 RESTful 服务

> ID：141484
> 
> 赞同：24
> 
> 时间：2008-09-26T19:40:42.700
> 
> 标签：wcf, web-services, security, rest

我正在寻找一个允许在 WCF 中使用 RESTful 服务的配置文件，但我仍然希望能够“利用”成员资格提供程序以进行用户名/密码身份验证。

以下是我当前使用 basicHttp 绑定或 wsHttp w/out WS Security 的配置的一部分，这将如何改变 w/ 基于 REST 的服务？

```
 <bindings>
        <wsHttpBinding>
            <binding name="wsHttp">
                <security mode="TransportWithMessageCredential">
                    <transport/>
                    <message clientCredentialType="UserName" negotiateServiceCredential="false" establishSecurityContext="false"/>
                </security>
            </binding>
        </wsHttpBinding>
        <basicHttpBinding>
            <binding name="basicHttp">
                <security mode="TransportWithMessageCredential">
                    <transport/>
                    <message clientCredentialType="UserName"/>
                </security>
            </binding>
        </basicHttpBinding>
    </bindings>
    <behaviors>
        <serviceBehaviors>
            <behavior name="NorthwindBehavior">
                <serviceMetadata httpGetEnabled="true"/>
                <serviceAuthorization principalPermissionMode="UseAspNetRoles"/>
                <serviceCredentials>
                    <userNameAuthentication userNamePasswordValidationMode="MembershipProvider"/>
                </serviceCredentials>
            </behavior>
        </serviceBehaviors>
    </behaviors> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T14:30:07.917

这是一个关于使用 ASP.net 成员提供程序保护 WCF REST 服务的播客：

[http://channel9.msdn.com/posts/rojacobs/endpointtv-Securing-RESTful-services-with-ASPNET-Membership/](http://channel9.msdn.com/posts/rojacobs/endpointtv-Securing-RESTful-services-with-ASPNET-Membership/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T15:23:51.950

我同意 Darrel 的观点，即 WCF 上的复杂 REST 场景是个坏主意。它只是不漂亮。

然而，Dominick Baier在他的最低权限博客上有一些[很好的帖子。](http://www.leastprivilege.com/HTTPBasicAuthenticationAgainstNonWindowsAccountsInIISASPNETPart3AddingWCFSupport.aspx)

如果您想查看 WSSE 身份验证支持并回退到 WCF 上的 FormsAuthenticationTicket 支持，请查看[BlogService 的源代码](http://codeplex.com/blogsvc)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-27T14:50:32.483

在继续沿着这条通过 WCF 实现 REST 的道路之前，我建议您阅读Tim Ewald 的[这篇](http://www.pluralsight.com/community/blogs/tewald/archive/2007/08/26/48298.aspx)文章。我尤其受到以下声明的影响：

> 我不确定我是否要在旨在将 HTTP 分解的层之上构建一个旨在将 HTTP 分解的层。

在过去的 12 个月里，我一直在使用 WCF 开发基于 REST 的东西，并且这种说法一次又一次地证明了自己是如此正确。恕我直言，WCF 带来的好处超过了它为进行 REST 工作引入的复杂性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T19:06:45.853

无论社区是否对 WCF 上的 REST 有意见*（我个人持反对态度），*微软都对它进行了抨击， http: **[//msdn.microsoft.com/en-us/netframework/cc950529.aspx](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-05T01:22:41.817

是的，与 Moto 一致，WCF Starter Kit 的链接是我看到的最接近使用自定义 HTTP 标头 ( [http://msdn.microsoft.com/en-us/library/dd203052.aspx](http://msdn.microsoft.com/en-us/library/dd203052.aspx) ) 进行凭据身份验证的东西。

但是我无法让这个例子继续下去。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-22T09:49:13.400

尝试[custombasicauth @codeplex](http://custombasicauth.codeplex.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-24T02:58:27.217

**2012 年 1 月 23 日更新**

自从我写了这个问题以来，我已经看到了一种更好的方法来保护 REST，比如在野外的 Web 服务。当我第一次听说它时，它听起来很复杂，但这个想法很简单，并且遍布整个网络，用于网络服务和其他安全通信。

它需要使用公钥/私钥。

1.) 端点的每个用户（客户）都需要注册您的 REST Web 服务

*   a.) 你给这个用户一个不应该与任何人共享的私钥
*   b.）如果需要，您还可以生成一个可以通过纯文本传输的公钥（这也将用于识别客户端）

2.) 用户的每个请求都需要生成一个哈希来对请求进行签名

*   a.) 其中一个示例可能如下所示：私钥 + 时间戳 + 编码的有效负载（如果足够小，例如要更新的简单用户信息）
*   b.）您采用这 3 个（或您决定的任何内容）并生成 1 路哈希（例如使用 hmac）
*   c.) 在通过网络发送的请求中，您包括公钥（以便服务器端知道谁在尝试发送此请求）、使用私钥生成的哈希和时间戳。

3.）服务器端点（您的 REST 方法）将需要使用客户端上使用的相同输入生成哈希。此步骤将证明客户端和服务器都知道与请求一起传递的公钥匹配的私钥。（这反过来意味着发送请求的用户是合法的，因为没有人知道私钥）

*   a.) 通过请求期间传递的公钥查找客户私钥

*   b.）将其他参数（时间戳和编码的有效负载）与您在上一步中找到的私钥一起使用，并使用相同的算法生成单向哈希（同样，hmac 是我在现实世界中看到的)

*   c.）产生的 1 路哈希需要匹配通过网络发送的哈希，如果不发回 400（或您认为是“错误请求”的任何 http 代码）

# python - 有没有一种简单的方法可以从 CharField 填充 SlugField？

> ID：141487
> 
> 赞同：41
> 
> 时间：2008-09-26T19:40:57.660
> 
> 标签：python, django, slug

```
class Foo(models.Model):
    title = models.CharField(max_length=20)
    slug = models.SlugField() 
```

是否有内置方法可以根据标题自动填充 slug 字段？也许在管理员和管理员之外。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-26T19:51:46.527

对于 Django 1.0 及更高版本中的管理员，您需要使用

```
prepopulated_fields = {'slug': ('title',), } 
```

在你的 admin.py

您在 prepopulated_fields 字典中的键是您要填充的字段，值是您要连接的字段的元组。

在管理员之外，您可以`slugify`在视图中使用该功能。在模板中，您可以使用`|slugify`过滤器。

还有这个包会自动处理这个问题：[https ://pypi.python.org/pypi/django-autoslug](https://pypi.python.org/pypi/django-autoslug)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T20:59:49.017

在管理员之外，请参阅[这个 django 片段](http://www.djangosnippets.org/snippets/690/)。将其放入您的`.save()`中，它将与以编程方式创建的对象一起使用。正如其他人所说，在管理员内部，使用`prepopulated_fields`.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-04-20T09:47:00.973

以为我会添加一个完整且最新的答案，其中提到了陷阱：

## 1\. 在 Django Admin 中自动填充表单

如果您只关心在管理员中添加和更新数据，您可以简单地使用[prepopulated_fields](https://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.prepopulated_fields)属性

```
class ArticleAdmin(admin.ModelAdmin):
    prepopulated_fields = {"slug": ("title",)}

admin.site.register(Article, ArticleAdmin) 
```

## 2.在模板中自动填充自定义表单

如果您已经使用表单构建了自己的服务器呈现界面，则可以在保存表单时使用[|slugify](https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#slugify)模板过滤器或[slugify](https://docs.djangoproject.com/en/2.2/ref/utils/#django.utils.text.slugify)实用程序自动填充字段 (is_valid)。

## 3\. 使用 django-autoslug 在模型级别自动填充 slugfields

当通过这些接口（管理员或自定义表单）操作数据时，上述解决方案只会自动填充 slugfield（或任何字段）。如果你有一个 API、管理命令或任何其他也可以操作数据的东西，你需要下拉到模型级别。

[django-autoslug](https://pypi.org/project/django-autoslug/)提供了扩展 SlugField 的 AutoSlugField-fields 并允许您设置它应该巧妙地设置哪个字段：

```
class Article(Model):
    title = CharField(max_length=200)
    slug = AutoSlugField(populate_from='title') 
```

**该字段使用 pre_save 和 post_save 信号来实现其功能，因此请参阅此答案底部的问题文本。**

## 4\. 通过覆盖 save() 在模型级别自动填充 slugfields

最后一个选项是自己实现，这涉及覆盖默认的 save() 方法：

```
 class Article(Model):
        title = CharField(max_length=200)
        slug = SlugField()

    def save(self, *args, **kwargs):
        self.slug = slugify(self.title)
        super(Job, self).save(*args, **kwargs) 
```

### 注意：批量更新将绕过您的代码（包括信号）

这是 Django 初学者常见的误解。首先，您应该知道 pre_save 和 post_save 信号与 save() 方法直接相关。其次，在 Django 中进行批量更新的不同方法都通过直接在 SQL 层上操作来绕过 save() 方法来实现高性能。这意味着对于上述解决方案 3 或 4 中使用的示例模型：

*   Article.objects.all().update(title='New post')**不会**更新任何文章的 slug
*   在 Article 模型上使用[bulk_create](https://docs.djangoproject.com/en/2.2/ref/models/querysets/#bulk-create)或[bulk_update](https://docs.djangoproject.com/en/2.2/ref/models/querysets/#bulk-update)**不会**更新任何文章的 slug。
*   由于未调用 save() 方法，因此**不会发出 pre_save 或 post_save 信号**。

要进行批量更新并仍然利用代码级约束，唯一的解决方案是逐个迭代对象并调用其 save() 方法，该方法的性能远低于 SQL 级批量操作。您当然可以在数据库中使用触发器，尽管这是一个完全不同的主题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T19:44:31.723

对于 1.0 之前的版本：

```
slug = models.SlugField(prepopulate_from=('title',)) 
```

应该可以正常工作

对于 1.0，使用[camflan](https://stackoverflow.com/questions/141487/is-there-an-easy-way-to-populate-slugfield-from-charfield#141554)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T13:31:04.287

您还可以使用 pre_save django 信号在 django 管理代码之外填充 slug。请参阅[Django 信号文档](http://docs.djangoproject.com/en/dev/ref/signals/)。

Ajax slug 唯一性验证也很有用，请参阅[As-You-Type Slug Uniqueness Validation @ Irrational Exuberance](http://lethain.com/entry/2008/sep/26/as-you-type-slug-uniqueness-validation/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-19T12:23:49.813

[过去， autoslug](https://bitbucket.org/neithere/django-autoslug)对我来说效果很好。虽然我从未尝试将它与管理应用程序一起使用。

# c++ - 有哪些开源 C++ 静态分析工具可用？

> ID：141498
> 
> 赞同：305
> 
> 时间：2008-09-26T19:43:19.887
> 
> 标签：c++, coding-style, static-analysis

Java 有一些非常好的开源静态分析工具，例如[FindBugs](http://findbugs.sf.net/)、[Checkstyle](http://checkstyle.sf.net/)和[PMD](http://pmd.sf.net/)。这些工具易于使用，非常有用，可在多个操作系统上运行并且*免费*。

提供商业 C++ 静态分析产品。虽然拥有这样的产品很棒，但对于学生来说成本太高了，而且通常很难获得试用版。

另一种方法是找到可以在多个平台（Windows 和 Unix）上运行的开源 C++ 静态分析工具。通过使用开源工具，可以对其进行修改以满足某些需求。找到这些工具并非易事。

以下是其他人发现或建议的 C++ 静态分析工具的简短列表。

*   C++ 检查[http://sf.net/projects/cppcheck/](http://sf.net/projects/cppcheck/)
*   Oink [http://danielwilkerson.com/oink/index.html](http://danielwilkerson.com/oink/index.html)
*   C 和 C++ 代码计数器[http://sourceforge.net/projects/cccc/](http://sourceforge.net/projects/cccc/)
*   夹板（来自答案）
*   Mozilla 的猪肉（来自答案）（现在是 Oink 的一部分）
*   Mozilla 的 Dehydra（来自答案）
*   使用`-Weffc++`GNU g++ 的选项（来自答案）

还有哪些**其他**任何人都知道并可以推荐的便携式开源 C++ 静态分析工具？

一些相关链接。

*   [http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)
*   [http://www.chris-lott.org/resources/cmetrics/](http://www.chris-lott.org/resources/cmetrics/)
*   [根据一组编码标准检查 C/C++ 源代码的免费工具？](https://stackoverflow.com/questions/93260/a-free-tool-to-check-cc-source-code-against-a-set-of-coding-standards)
*   [http://spinroot.com/static/](http://spinroot.com/static/)
*   [选择静态代码分析工具](https://stackoverflow.com/questions/2873/choosing-a-static-code-analysis-tool)

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-05-08T23:27:25.420

[CppCheck](http://sourceforge.net/p/cppcheck/wiki/Home/)是开源和跨平台的。

Mac OSX：

```
brew install cppcheck 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-27T20:24:38.280

关于 GNU 编译器，gcc 已经有一个内置选项，可以对 -Wall的选项提供额外的*警告。*选项是**-Weffc++**，它是关于违反*Scott Meyers*在他的书“ *Effective and More Effective C++* ”中发表的一些指导方针。

特别是该选项检测以下项目：

*   为具有动态分配内存的类定义复制构造函数和赋值运算符。
*   更喜欢在构造函数中进行初始化而不是赋值。
*   在基类中使析构函数为虚拟。
*   让 "operator=" 返回对 *this 的引用。
*   当你必须返回一个对象时，不要试图返回一个引用。
*   区分递增和递减运算符的前缀和后缀形式。
*   切勿重载“&&”、“||”或“,”。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-29T02:06:17.857

目前正在开发中，但[clang](http://clang.llvm.org/cxx_status.html)会进行 C 分析，并且目标是随着时间的推移处理 C++。它是[LLVM](http://llvm.org/)项目的一部分。

**更新**：虽然登陆页面上写着“分析器是一个持续进行中的工作”，但它现在被[记录](http://clang-analyzer.llvm.org/)为 C 和 C++ 的静态分析器。

问题：[如何运行 GCC/Clang 进行静态分析？（仅警告）](https://stackoverflow.com/questions/14072779/how-can-i-run-gcc-clang-for-static-analysis-warnings-only)

编译器选项：-fsyntax-only

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-12T22:04:12.717

Oink 是一个建立在 Elsa C++ 前端之上的工具。Mozilla 的 Pork 是 Elsa/Oink 的一个分支。

见：[http ://danielwilkerson.com/oink/index.html](http://danielwilkerson.com/oink/index.html)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2012-07-01T16:53:28.583

其他人提到了 -Weffc++，但这实际上是我默认不打开的唯一 GCC 警告之一。但是，我打开的一组警告是我工具包中最重要的静态分析工具。您可以查看[推荐警告的完整列表](https://stackoverflow.com/questions/5088460/flags-to-enable-thorough-and-verbose-g-warnings/9862800#9862800)。

总之：

> -pedantic -Wall -Wextra -Wcast-align -Wcast-qual -Wctor-dtor-privacy -Wdisabled-optimization -Wformat=2 -Winit-self -Wlogical-op -Wmissing-declarations -Wmissing-include-dirs -Wnoexcept -Wold -style-cast -Woverloaded-virtual -Wredundant-decls -Wshadow -Wsign-conversion -Wsign-promo -Wstrict-null-sentinel -Wstrict-overflow=5 -Wswitch-default -Wundef -Werror -Wno-unused

请注意，其中一些需要新版本的 gcc，因此如果您卡在 4.5 或其他版本上，您可能需要从列表中删除它们。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2012-01-22T15:23:00.130

John Carmack 还在这篇[关于“静态代码分析”的](http://viva64.com/en/a/0087)有趣博文中提到了[PVS-Studio](http://pvs-studio.viva64.com)。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-27T07:59:33.580

如果通过开源，你真的是指“免费”，那么微软的[prefast](http://msdn.microsoft.com/en-us/library/d3bbz7tz.aspx)分析是一个很好的分析。当然，仅限 Windows。它完全集成在 Visual Studio 和编译器中。例如：

```
cl /analyze Sample.cpp 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-27T08:24:30.227

[Mozilla 的静态分析工作](https://wiki.mozilla.org/Static_Analysis)大概值得一看。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T19:52:56.727

[夹板](http://lclint.cs.virginia.edu/)似乎填补了 C 的账单。

如果您没有指定开源，我会说[Gimpel Software](http://www.gimpel.com/)的[PCLint](http://www.gimpel.com/html/pcl.htm)可能是 C++ 中用于静态代码检查的最佳工具之一。但是，当然，它不是开源的。

Mac OSX：

```
brew install splint 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-01-19T20:18:32.077

Microsoft 的[PREFast](http://www.microsoft.com/whdc/DevTools/tools/PREfast.mspx)也可在 Windows Driver Kit 中使用。7.0 版可[在此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=2105564e-1a9a-4bf4-8d74-ec5b52da3d00&displaylang=en)下载。

Microsoft 文档声明它应该只针对驱动程序代码运行，但这篇（旧）[博客文章](http://buildingsecurecode.blogspot.com/2007/08/security-code-scanning-with-microsoft.html)列出了运行它的步骤。也许它可以集成到正常的构建过程中？

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-04-19T08:18:54.650

我们一直在开发一个名为 metriculator 的 Eclipse CDT 插件。它仍在开发中，但一些主要指标（例如 LSLOC、McCabe、EfferentCoupling）已经实现。

有关视频演示和文档等更多详细信息，请参见[http://sinv-56013.edu.hsr.ch/redmine/projects/metricular/wiki/Documentation](http://sinv-56013.edu.hsr.ch/redmine/projects/metricular/wiki/Documentation)。

最新的夜间版本可通过更新站点安装：[http ://sinv-56013.edu.hsr.ch/metriculator/updatesite-nightly/site/](http://sinv-56013.edu.hsr.ch/metriculator/updatesite-nightly/site/)

**进一步说明**

Metriculator 静态分析 C++ 源代码并生成软件指标。指标被实现为 Codan 检查器。可以在单独的视图中探索分析结果。每个指标都有可配置的属性（例如，“每个函数的最大代码行数”的阈值）。超过这些阈值将报告问题并在源代码编辑器中创建标记。

使用度量器，您可以：

*   分析 C++ 文件/文件夹/项目
*   使用 Codans 首选项页面定义指标阈值并启用/禁用指标
*   在源代码编辑器中有问题标记
*   探索指标结果
*   将指标结果导出为标签云（通过更新站点作为可选功能提供）

目前 metriculator 带有以下指标：

*   McCabe（圈复杂度）
*   每种类型的传出耦合
*   逻辑源代码行
*   每种类型的成员数
*   每个函数的参数数量

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-09T16:55:02.157

你应该试试 oo-browser 它与 xemacs 的集成很棒

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-11-09T21:33:13.157

还可以使用[MELT](http://gcc-melt.org/)（一种为扩展 GCC 而设计的领域特定语言）或 C 中的 GCC 插件（更难）对 GCC 的扩展进行编码，以进行一些自定义分析。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-12T22:24:25.640

Doxygen 进行一些控制流分析并生成图表。这些可能不是你要找的，但我发现它们很有用。

# java - 是否有任何验证 SQL 语法的 Java 库？

> ID：141499
> 
> 赞同：23
> 
> 时间：2008-09-26T19:43:29.697
> 
> 标签：java, sql, syntax

我不确定这是否存在，所以我想我会利用别人的智慧..

我想知道是否有任何 Java 库可用于验证 SQL 查询的语法。我知道与常见的 SQL 规范有很多偏差，所以它可能只适用于 SQL:2006 之类的东西，但这当然就足够了。

我的目标是将其用于单元测试目的，而无需尝试对数据库执行。我知道它的用途有限，但它仍然有用。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-26T20:11:19.973

也许你可以使用 Antlr，它有许多[SQL 语法](http://www.antlr3.org/grammar/list "Antlr 语法")和一个[Java 库](http://www.antlr.org/download.html)，以及各种 Java IDE 的插件。

[或者按照建议，使用SQuirreL SQL Client](http://squirrel-sql.sourceforge.net/ "SQuirreL SQL 客户端")等开源 SQL 实用程序的解析器。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-12-27T14:39:50.760

[通用 SQL Parser](http://www.sqlparser.com/)可以进行[离线 SQL 语法检查](http://www.dpriver.com/blog/list-of-demos-illustrate-how-to-use-general-sql-parser/vendor-specific-offline-sql-syntax-check/)。支持的数据库：Oracle、DB2、MySQL、SQL Server、Teradata 和 PostgreSQL。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-26T19:57:54.517

我不认为有这样的图书馆。SQL 语法有太多的派生词。

[一个可能的解决方案是使用像SmallSQL](http://www.smallsql.de)这样的开源纯 Java DBMS 的一部分。在这个项目中，您可以创建[SQLParser](http://smallsql.cvs.sourceforge.net/smallsql/SmallSQL/src/smallsql/database/SQLParser.java?view=annotate)的实例。可以很容易地删除所需的连接引用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-20T11:40:51.293

试试[JSQL 解析器](https://github.com/JSQLParser/JSqlParser)。

除了验证之外，您还可以获得查询的有意义的表示。
例如，这允许您只接受“某些”命令；操纵
查询，“美化”它等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T19:59:07.757

您也许可以从[HSQL](http://hsqldb.org/web/hsqlFeatures.html)中提取解析代码，它是 java 和开源的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T20:19:53.900

[Apache Derby](http://db.apache.org/derby/)是一个完全用 Java 实现的开源 SQL 数据库，可在[Apache 许可证 2.0 版](http://db.apache.org/derby/license.html)下使用。它以前称为[IBM Cloudscape](http://www-01.ibm.com/software/data/cloudscape/)。

您可以尝试重用它从`org.apache.derby.impl.sql`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-11T18:38:14.703

使用[JOOQ](http://www.jooq.org)，您将永远不会在 SQL 中出错。Java 编译器会处理这个问题。

# .net - 适用于小型团队的 Visual Studio 2008 源代码控制

> ID：141500
> 
> 赞同：15
> 
> 时间：2008-09-26T19:43:48.933
> 
> 标签：.net, windows, visual-studio, visual-studio-2008, version-control

我在一个小型 Web 团队工作，我是目前唯一使用 Visual Studio 2008 Professional 构建和维护一些 Web 应用程序的 .NET 开发人员。我即将开始培训我们团队的另一名成员，因此我们为他购买了 Visual Studio 2008 Professional 的副本。我已经研究了 Visual Source Safe，但我很怀疑。我不喜欢那是基于文件系统的。理想情况下，该系统将与 SQL Server 2005 一起工作并插入 Visual Studio。由于我工作的组织的 IT 环境，基于 Windows 的解决方案是最好的。

对于源代码控制系统，我有哪些选择？

（如果答案存在于另一个线程中，请原谅我。）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-26T19:47:23.900

[Subversion](http://subversion.tigris.org/)通过[VisualSVN](http://www.visualsvn.com/)和[Ankh](http://ankhsvn.open.collab.net/)与 Visual Studio 2008 有很好的集成。

SourceSafe 很危险。您说得对，基于文件共享的 SCM 是一个坏主意，Microsoft 自己已经淡化了它，并用 Visual Studio 团队版附带的新 SCM 取而代之。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-26T20:32:12.017

我不敢相信没有人提到[SourceGear Vault](http://sourcegear.com/vault/index.html)。它将您的代码存储在 SQL Server 中，非常好地集成到 VS 中，并且是 Source Safe 的绝佳替代品/替代品。由于他们的单用户许可证是免费的，我什至在家编码时使用它。[另外，它是由Eric Sink](http://www.ericsink.com/)创立/经营的公司。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-09T13:30:31.187

有没有人考虑过 Git？[这里](http://code.google.com/p/gitextensions/)有一个非常有用的 Windows 解决方案，称为 GitExtensions 。它通过额外的菜单和可选工具栏与 Visual Studio Professional 集成。与 Subversion 不同，Git 是分布式的，这意味着您可以在本地提交到您的存储库副本，然后将更改推送到服务器。底线？Git 速度很快！它的存储也比 subversion 更有效，这意味着您的存储库占用的空间更少。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T19:46:49.863

颠覆。自由。Visual SVN 是一个很好的附加组件，而且相当便宜。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-27T02:53:51.270

当然，正如大多数人所说，[Subversion](http://subversion.net) + [VisualSVN](http://www.visualsvn.com)。

VisualSVN 是一个相当便宜的插件，49 美元，颠覆是免费的而且非常稳定。我们将它用于 10-15 人的团队，它对我们来说非常有效。唯一的缺点是它是基于文件系统的。

另一方面，如果你有一个非常特殊的需要它不在文件系统上，我不会推荐 Visual Source Safe，在我的上一份工作中，我们遇到了很多麻烦并且失去了宝贵的工作时间。如果您想采用这种方式，请获取基于数据库的[sourcegear vault 之](http://www.sourcegear.com/)类的东西。还有来自 Microsoft 的 Team Foundation Server，但我相信它对于小型团队来说确实很昂贵（而且很重）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T19:49:21.540

[Visual SVN](http://www.visualsvn.com/) 可能适合您，它应该可以很好地集成并且相对便宜，每个许可证约 50 美元。我一直在考虑自己购买它，到目前为止我只使用 Tortoise SVN，因为我现在做的非 Eclipse 工作相对较少。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T19:53:27.147

[Team Foundation Server](http://msdn.microsoft.com/en-us/tfs2008/default.aspx)确实满足了您使用 SQL Server 的要求，但对于这样一个小型开发团队来说可能是多余的。

我建议使用[Subversion](http://tortoisesvn.tigris.org/)（免费）进行源代码控制以及[VisualSVN](http://www.visualsvn.com/)（49 美元）用于 Visual Studio 集成。还有一个出色的用于 Windows 资源管理器的 Subversion 客户端，称为[TortoiseSVN](http://tortoisesvn.tigris.org/)，非常棒。

试用 Subversion 之类的东西的好处是它是免费的，而且很容易设置。它还将扩大到一个相当大的团队。在投资 MSFT 的 Team Foundation Server 之前，值得一试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-26T19:45:34.157

Microsoft 的 Team Foundation Server 完全集成到 VS2008 中，并使用 SQL Server 作为其后端。缺点是它是一个非常昂贵的解决方案。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T19:46:48.083

为什么不使用 SVN 服务器？这样，您的所有开发人员都可以使用它，并且有一个非常好的免费 Windows 客户端 (TortoiseSVN)。您可以将 SVN 支持与 TortoiseSVN 集成到具有 VisualSVN 的 Visual Studio 中，这是商业的，但实际上并不昂贵。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-26T19:48:40.233

我们最近从 SourceSafe 切换到了 tfs，并且发现它工作得很好。

我们使用的功能中唯一值得注意的例外是文件链接。

为了降低成本，我们确保获得金牌认证合作伙伴身份。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-26T19:52:11.957

我推荐[subversion](http://subversion.tigris.org/)，再加上[AnkhSVN](http://ankhsvn.open.collab.net/)，一个将 Subversion 与 Visual Studio IDE 集成的插件（免费！）。

如果您使用 CollabNet 中免费的 svnserve 发行版（Windows 二进制文件：[此处](http://www.collab.net/downloads/subversion/)），则设置非常简单。管理非常简单。而且产品效果很好。

它仍然是基于文件系统的，但这并不是一个真正的问题。确保定期备份完整转储和热副本（文档中详细解释了这两者）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-27T02:29:17.977

Visual Source Safe 从它的早期版本中得到了一个坏名声。他们在 2005 年推出了一个新版本，它解决了早期版本的许多问题。我不认为他们已经解决了分支问题。他们现在有一个客户端/服务器部分（嗯，它是基于 http 的），这样可以解决一些远程问题。

SVN 可能是一个更好的解决方案，但 VSS 并不像以前那么糟糕。

# .net - 有谁知道 ASP.NET MVC 何时会完全发布？

> ID：141508
> 
> 赞同：2
> 
> 时间：2008-09-26T19:45:29.960
> 
> 标签：.net, asp.net, asp.net-mvc

您认为我们什么时候可以期待 ASP.NET MVC 的完整发布版本？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T19:46:06.137

***编辑（2009 年 7 月 16 日）***

更新以确保此页面包含最新的详细信息。

ASP.NET MVC 现已完全发布***[http://www.asp.net/mvc/](http://www.asp.net/mvc/)***。

* * *

***编辑（2009 年 1 月 28 日）***

ASP.NET MVC 1.0 RC 现已推出......下个月最后一次（[来自 ScottGu 的博客](http://weblogs.asp.net/scottgu/archive/2009/01/27/asp-net-mvc-1-0-release-candidate-now-available.aspx)）

> 今天的 RC 是 ASP.NET MVC 的最后一个公开版本，我们将在最终的“1.0”版本之前发布。我们预计将在下个月发布最终的 ASP.NET MVC 1.0 版本。

* * *

我上次听说，2008 年第四季度。

Scott Hanselman[在他的博客中发布了这个关于 3.5 SP1 的信息](http://www.hanselman.com/blog/HiddenGemsNotTheSameOld35SP1Post.aspx)

> **ASP.NET MVC 呢？**
> 
> 围绕 MVC 可能存在一些混淆，因为一些人预计 ASP.NET MVC 会在 SP1 中发布。这可能是因为 MVC 包含在 3.5“扩展预览”中。然而，计划总是在 2008 年第四季度发货。
> 
> *（那个日期是市场营销的说法，我刚刚了解到。我告诉人们 Eilon 告诉我的内容 - 它会在以“-ber”结尾的一个月内发货。可能是“March-ber”，也可能是“next June-ber”。 ")*
> 
> 无论如何，Phil 一直说 MVC 有自己的时间表，一旦完成就会发布。可能在永远的毁灭公爵发货时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-27T11:24:10.187

目前只能猜测。然后我推测我们将在 12 月发布 Beta 版（他们说下一个预览版将是 Beta 版），并在 2009 年 2 月至 3 月发布完整版。

# php - 你用的是哪个php变量调试功能？var_dump，print_r，var_export，其他？

> ID：141513
> 
> 赞同：4
> 
> 时间：2008-09-26T19:46:00.800
> 
> 标签：php, debugging

我个人用过[`var_dump`](http://php.net/var_dump)，但喜欢的人很多[`print_r`](http://php.net/print_r)。

大家都用什么？优点和缺点？

有人有自己的特殊家庭酿造功能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T19:46:41.267

我使用`print_r()`是因为我喜欢漂亮的数组结构......但`var_dump`确实给了你更多信息（比如类型）

```
$obj = (object) array(1, 2, 3);

// output of var_dump:
object(stdClass)#1 (3) {
  [0]=>
  int(1)
  [1]=>
  int(2)
  [2]=>
  int(3)
}

// output of print_r
stdClass Object
(
  [0] => 1
  [1] => 2
  [2] => 3
) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T19:52:55.947

我使用这些自定义函数取决于我处理的是数组还是单个值：

```
function show($array)
{
    echo '<pre>';
    print_r($array);
    echo '</pre>';
}

function prn($var)
{
    echo '<br/>' . $var . '<br/>';
} 
```

我发现这些功能简化了故障排除，因为我通常最终需要格式化输出，以便我可以在屏幕上轻松完成它。

对于更复杂的故障排除，我们使用 Exception 类的扩展版本，它将通过电子邮件发送堆栈跟踪以及特定的错误消息。这为我提供了所涉及的功能、涉及的文件、错误中涉及的一行或几行以及我创建的任何自定义消息，以便我确切地知道发生了什么。为了增加故障排除层，我们还将这些错误记录在正在访问的数据库中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-27T08:04:01.243

我总是使用 Xdebug 扩展的 var_dump。它给出了很多详细的输出。

有关详细信息，请参阅：http: [//xdebug.org/docs/display](http://xdebug.org/docs/display)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T19:57:11.787

我只是使用 print_r，以及几个包装函数来存储我在代码中放入的各种 DebugPrint，还有一个在页脚中用于将堆栈转储到页面（或文件中）。

我现在也尝试使用 XDebug... :-D

好的，为了记录，我给出了我的小功能......

```
// Primitive debug message storage
// $level = "Info", "Warn", "Error", "Title"
function DebugPrint($toDump, $level = "Info") {
  global $debugMode, $debugDump, $debugCount;

  if ($debugMode != 'N') {
    $debugDump[$debugCount++] = "<div class='Dbg$level'>" . $toDump . "</div>\n";
  }
}

// Initialize debug information collection
$debugMode = 'N'; // N=no, desactivated, P=dump to Web page, F=dump to file
$debugSavePath = 'C:\www\App\log_debug.txt'; // If mode F
$debugDump = array();
$debugCount = 0;

// Primitive debug message dump
function DebugDump() {
  global $debugMode, $debugSavePath, $debugDump, $debugCount;

  if ($debugMode == 'F') {
    $fp = fopen($debugSavePath, "a"); #open for writing
  }
  if ($debugCount > 0) {
    switch ($debugMode) {
    case 'P':
        echo '<div style="color: red; background: #8FC; font-size: 24px;">Debug:<br />
';
        for ($i = 0; $i < $debugCount; $i++) {
            echo $debugDump[$i];
        }
        echo '</div>
';
        break;
    case 'F':
        for ($i = 0; $i < $debugCount; $i++) {
            fputs($fp, $debugDump[$i]);
        }
        break;
//~         default:
//~             echo "debugMode = $debugMode<br />\n";
    }
  }
  if ($fp != null) {
    fputs($fp, "-----\n");
    fclose($fp);
  }
}

// Pre array dump
function DebugArrayPrint($array) {
global $debugMode;

  if ($debugMode != 'N') {
    return "<pre class='ArrayPrint'>" . print_r($array, true) . "</pre>";
  } else return "";    // Gain some microseconds...
} 
```

兴趣是将输出延迟到页面末尾，避免使真实页面混乱。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T19:58:45.417

如果您想避免向浏览器发送错误，但又想利用 var_dump 和 print_r 的优势，请查看输出缓冲：

```
ob_start();
var_dump($this); echo $that; print_r($stuff);
$out = ob_get_contents();
ob_end_clean();

user_error($out); 
```

[http://www.php.net/manual/en/book.outcontrol.php](http://www.php.net/manual/en/book.outcontrol.php)中的一些好读物

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T22:02:28.803

我发现变量转储函数的标准 PHP 实现中缺少一些非常有用的东西，即只打印表达式的一部分的能力。

这是一个解决这个问题的函数：

```
function dump($val) {
    echo '<pre>'.var_export($val,true).'</pre>';
    return $val;
} 
```

现在我可以在我需要知道的值的表达式周围放置一个函数调用，而不会破坏通常的代码执行流程，如下所示：

```
$a=2+dump(2*2); 
```

通过使用鲜为人知的*var_export*，我还消除了实现输出缓冲以对结果进行后处理的需要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-27T09:03:07.373

当您生成二进制答案（即使用 GD 库的图像）时，您可以使用有效的调整标头：

> `header('X-eleg:'.serialize($yourstuff));`

并使用 Firefox 的 Http-header 扩展来“窥探”它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T19:59:29.660

print_r() 通常，但 var_dump() 为原语提供更好的信息。

话虽如此，我的大部分*实际*调试都是使用 Zend Server Debugger 进行的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-18T18:35:20.273

var_dump。安装 XDebug 后，它可以很好地格式化和着色输出（无需在其`<pre>`周围放置标签）。

# c# - Windows 剪贴板 CRLF/LF 为一位用户传递错误

> ID：141519
> 
> 赞同：0
> 
> 时间：2008-09-26T19:46:47.630
> 
> 标签：c#, clipboard, citrix, batch-file

我们有一对应用程序。一个是用 C# 编写的，使用类似：

```
 string s = "alpha\r\nbeta\r\ngamma\r\ndelta";
 // Actually there's wrapper code here to make sure this works.
 System.Windows.Forms.Clipboard.SetDataObject(s, true); 
```

将项目列表放到剪贴板上。另一个应用程序（在 WinBatch 中）然后使用 ClipGet() 函数获取列表。（我们使用剪贴板功能让人们可以选择在记事本或其他东西中编辑列表，而不必每次都实际剪切和粘贴。）

在这个特定的环境中，我们通过 Citrix 在一个系统上拥有许多用户。许多人使用这对程序。

只有*一个*用户遇到问题，文本中的行分隔符从 CRLF 切换到 LF 在 SetDataObject() 和 CLipGet() 之间的某个位置。我可以在混合 Unix/Windows 环境中解释这一点，但这里没有 Unix。该系统附近也没有任何 unix-y 实用程序。同一台服务器上的其他用户，完全没有问题。当我们真的不想要它时，就像 Windows/Citrix 中的某些东西正在“有帮助”，但只是为了这个人。

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:05:13.433

Have you tried clearing their profile on Citrix? That seems to be the solution to many many user specific Citrix problems.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:21:05.830

Environment.NewLine 在 Citrix 环境中的行为是否不同？如果是这样，它可能会为您提供一个适用于所有用户而不是 \r\n 的好选择。

# language-agnostic - 什么是按位移位（bit-shift）运算符，它们是如何工作的？

> ID：141525
> 
> 赞同：1478
> 
> 时间：2008-09-26T19:47:15.367
> 
> 标签：language-agnostic, bit-manipulation, operators, bit-shift, binary-operators

我一直在尝试在业余时间学习 C，其他语言（C#、Java 等）具有相同的概念（并且通常是相同的运算符）...

我想知道的是，在核心层面上，位移 ( `<<`, `>>`, `>>>`) 有什么作用，它可以帮助解决什么问题，以及在拐弯处潜伏着什么陷阱？换句话说，绝对是初学者的移位指南。

* * *

## 回答 #1

> 赞同：1814
> 
> 时间：2008-09-26T20:46:39.813

位移运算符的作用与它们的名字所暗示的完全一样。他们移动位。这是对不同班次运算符的简要（或不那么简要）介绍。

## 运营商

*   `>>`是算术（或有符号）右移运算符。
*   `>>>`是逻辑（或无符号）右移运算符。
*   `<<`是左移运算符，同时满足逻辑和算术移位的需要。

所有这些运算符都可以应用于整数值（`int`, `long`, 可能`short`和`byte`or `char`）。在某些语言中，将移位运算符应用于小于`int`自动将操作数调整为`int`.

请注意，这`<<<`不是运算符，因为它是多余的。

另请注意，**C 和 C++ 不区分右移运算符**。它们仅提供`>>`运算符，并且右移行为是为有符号类型定义的实现。答案的其余部分使用 C#/Java 运算符。

（在包括 GCC 和 Clang/LLVM 在内的所有主流 C 和 C++ 实现中，`>>`有符号类型是算术的。一些代码假设这一点，但这不是标准所保证的。但它不是*undefined*；标准要求实现来定义它方式或另一种方式。但是，负符号数的左移*是*未定义的行为（有符号整数溢出）。因此，除非您需要算术右移，否则使用无符号类型进行位移通常是个好主意。）

* * *

## 左移 (<<)

整数作为一系列位存储在内存中。例如，存储为 32 位的数字 6`int`将是：

```
00000000 00000000 00000000 00000110 
```

将此位模式向左移动一个位置 ( `6 << 1`) 将产生数字 12：

```
00000000 00000000 00000000 00001100 
```

如您所见，数字向左移动了一个位置，而右边的最后一个数字用零填充。您可能还注意到，左移相当于乘以 2 的幂。所以`6 << 1`等价于`6 * 2`，并且`6 << 3`等价于`6 * 8`。一个好的优化编译器会尽可能用移位代替乘法。

### 非循环变速

请注意，这些*不是*循环班次。将此值向左移动一个位置 ( `3,758,096,384 << 1`)：

```
11100000 00000000 00000000 00000000 
```

结果为 3,221,225,472：

```
11000000 00000000 00000000 00000000 
```

“结束”移动的数字丢失了。它不会环绕。

* * *

## 逻辑右移 (>>>)

逻辑右移与左移相反。它们不是向左移动位，而是向右移动。例如，移动数字 12：

```
00000000 00000000 00000000 00001100 
```

向右移动一个位置 ( `12 >>> 1`) 将返回我们原来的 6：

```
00000000 00000000 00000000 00000110 
```

所以我们看到向右移动相当于除以 2 的幂。

### 丢失的位已消失

但是，移位不能回收“丢失”的位。例如，如果我们改变这种模式：

```
00111000 00000000 00000000 00000110 
```

向左 4 个位置 ( `939,524,102 << 4`)，我们得到 2,147,483,744：

```
10000000 00000000 00000000 01100000 
```

然后向后移动 ( `(939,524,102 << 4) >>> 4`) 我们得到 134,217,734：

```
00001000 00000000 00000000 00000110 
```

一旦丢失位，我们就无法恢复原始值。

* * *

# 算术右移 (>>)

算术右移与逻辑右移完全相同，只是它不是用零填充，而是用最高有效位填充。这是因为最高有效位是*符号*位，或区分正数和负数的位。通过用最高有效位填充，算术右移是符号保留的。

例如，如果我们将此位模式解释为负数：

```
10000000 00000000 00000000 01100000 
```

我们有数字 -2,147,483,552。用算术移位 (-2,147,483,552 >> 4) 将其向右移动 4 个位置会给我们：

```
11111000 00000000 00000000 00000110 
```

或数字 -134,217,722。

所以我们看到我们通过使用算术右移而不是逻辑右移来保留负数的符号。再一次，我们看到我们正在执行 2 的幂除法。

* * *

## 回答 #2

> 赞同：220
> 
> 时间：2008-09-26T19:55:11.853

假设我们有一个字节：

```
0110110 
```

应用单个左位移可以得到：

```
1101100 
```

最左边的零被移出字节，新的零被附加到字节的右端。

位不会翻转；它们被丢弃。这意味着如果您左移 1101100 然后右移它，您将不会得到相同的结果。

左移 N 相当于乘以 2 ^N。

右移 N 是（如果您使用[的是补码](https://en.wikipedia.org/wiki/Ones%27_complement)）相当于除以 2 ^N并四舍五入为零。

只要您使用 2 的幂，移位可以用于非常快速的乘法和除法。几乎所有低级图形例程都使用移位。

例如，在过去，我们在游戏中使用模式 13h（320x200 256 色）。在模式 13h 中，视频内存按像素顺序排列。这意味着要计算像素的位置，您将使用以下数学：

```
memoryOffset = (row * 320) + column 
```

现在，在那个时代，速度是至关重要的，所以我们会使用位移来完成这个操作。

但是，320 不是 2 的幂，所以要解决这个问题，我们必须找出什么是 2 的幂，加起来就是 320：

```
(row * 320) = (row * 256) + (row * 64) 
```

现在我们可以将其转换为左移：

```
(row * 320) = (row << 8) + (row << 6) 
```

对于最终结果：

```
memoryOffset = ((row << 8) + (row << 6)) + column 
```

现在我们得到了和以前一样的偏移量，除了不是昂贵的乘法运算，我们使用两个位移...几个错误并添加了一个 32 位示例））：

```
mov ax, 320; 2 cycles
mul word [row]; 22 CPU Cycles
mov di,ax; 2 cycles
add di, [column]; 2 cycles
; di = [row]*320 + [column]

; 16-bit addressing mode limitations:
; [di] is a valid addressing mode, but [ax] isn't, otherwise we could skip the last mov 
```

总计：在任何具有这些时序的古代 CPU 上都有 28 个周期。

虚拟现实

```
mov ax, [row]; 2 cycles
mov di, ax; 2
shl ax, 6;  2
shl di, 8;  2
add di, ax; 2    (320 = 256+64)
add di, [column]; 2
; di = [row]*(256+64) + [column] 
```

在同一个古老的 CPU 上运行 12 个周期。

是的，我们会努力减少 16 个 CPU 周期。

在 32 位或 64 位模式下，两个版本都变得更短、更快。[像 Intel Skylake（参见http://agner.org/optimize/](http://agner.org/optimize/) ）这样的现代乱序执行 CPU具有非常快的硬件乘法（低延迟和高吞吐量），因此增益要小得多。AMD Bulldozer 系列的速度有点慢，尤其是对于 64 位乘法。在 Intel CPU 和 AMD Ryzen 上，两次移位的延迟略低，但指令比乘法多（这可能导致吞吐量降低）：

```
imul edi, [row], 320    ; 3 cycle latency from [row] being ready
add  edi, [column]      ; 1 cycle latency (from [column] and edi being ready).
; edi = [row]*(256+64) + [column],  in 4 cycles from [row] being ready. 
```

对比

```
mov edi, [row]
shl edi, 6               ; row*64\.   1 cycle latency
lea edi, [edi + edi*4]   ; row*(64 + 64*4).  1 cycle latency
add edi, [column]        ; 1 cycle latency from edi and [column] both being ready
; edi = [row]*(256+64) + [column],  in 3 cycles from [row] being ready. 
```

编译器会为您做到这一点：了解[GCC、Clang 和 Microsoft Visual C++ 在优化`return 320*row + col;`](https://gcc.godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,source:'int+idx(int+row,+int+col)+%7B%0A++return+320*row+%2B+col%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:36.97169647716434,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g63,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-O3+-std%3Dc%2B%2B11+-Wall',source:1),l:'5',n:'0',o:'x86-64+gcc+6.3+(Editor+%231,+Compiler+%231)',t:'0')),k:30.33026438926557,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((g:!((h:compiler,i:(compiler:clang400,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-O3+-std%3Dc%2B%2B11+-Wall',source:1),l:'5',n:'0',o:'x86-64+clang+4.0.0+(Editor+%231,+Compiler+%232)',t:'0')),header:(),k:32.69803913357011,l:'4',m:61.21344498970813,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:cl19_64,filters:(b:'0',commentOnly:'0',directives:'0',intel:'0'),options:'-Ox',source:1),l:'5',n:'0',o:'x86-64+CL+19+2017+RTW+(Editor+%231,+Compiler+%233)',t:'0')),header:(),l:'4',m:38.78655501029187,n:'0',o:'',s:0,t:'0')),k:32.69803913357011,l:'3',n:'0',o:'',t:'0')),l:'2',n:'0',o:'',t:'0')),version:4).

这里需要注意的最有趣的一点是，[x86](https://stackoverflow.com/questions/1658294/whats-the-purpose-of-the-lea-instruction/7071164#7071164)有[一个移位和加法指令`LEA`](https://stackoverflow.com/questions/1658294/whats-the-purpose-of-the-lea-instruction/7071164#7071164)`add`（ARM 更强大：任何指令的一个操作数都可以自由地左移或右移。因此，通过已知为 2 的幂的编译时间常数进行缩放可能比乘法更有效。

* * *

好的，回到现代......现在更有用的是使用位移将两个 8 位值存储在一个 16 位整数中。例如，在 C# 中：

```
// Byte1: 11110000
// Byte2: 00001111

Int16 value = ((byte)(Byte1 >> 8) | Byte2));

// value = 000011111110000; 
```

在 C++ 中，如果您将 a`struct`与两个 8 位成员一起使用，编译器应该为您执行此操作，但实际上并非总是如此。

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2008-09-26T22:22:03.653

按位运算（包括位移）是低级硬件或嵌入式编程的基础。如果您阅读设备规范甚至某些二进制文件格式，您会看到字节、字和双字被分解为非字节对齐的位域，其中包含各种感兴趣的值。访问这些位域以进行读/写是最常见的用法。

图形编程中一个简单的真实示例是一个 16 位像素表示如下：

```
 bit | 15| 14| 13| 12| 11| 10| 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1  | 0 |
      |       Blue        |         Green         |       Red          | 
```

要获得绿色值，您可以这样做：

```
 #define GREEN_MASK  0x7E0
 #define GREEN_OFFSET  5

 // Read green
 uint16_t green = (pixel & GREEN_MASK) >> GREEN_OFFSET; 
```

**解释**

为了获得 green ONLY 的值，它从偏移量 5 开始，到 10 结束（即 6 位长），您需要使用（位）掩码，当应用于整个 16 位像素时，将产生只有我们感兴趣的位。

```
#define GREEN_MASK  0x7E0 
```

适当的掩码是 0x7E0，二进制是 0000011111100000（十进制是 2016）。

```
uint16_t green = (pixel & GREEN_MASK) ...; 
```

要应用掩码，请使用 AND 运算符 (&)。

```
uint16_t green = (pixel & GREEN_MASK) >> GREEN_OFFSET; 
```

应用掩码后，您将得到一个 16 位数字，这实际上只是一个 11 位数字，因为它的 MSB 在第 11 位。绿色实际上只有 6 位长，所以我们需要使用右移 (11 - 6 = 5) 来缩小它，因此使用 5 作为偏移量 ( `#define GREEN_OFFSET 5`)。

同样常见的是使用位移位进行快速乘法和除以 2 的幂：

```
 i <<= x;  // i *= 2^x;
 i >>= y;  // i /= 2^y; 
```

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2015-03-31T10:49:23.093

## 位屏蔽和移位

位移位常用于低级图形编程。例如，以 32 位字编码的给定像素颜色值。

```
 Pixel-Color Value in Hex:    B9B9B900
 Pixel-Color Value in Binary: 10111001  10111001  10111001  00000000 
```

为了更好地理解，相同的二进制值标有什么部分代表什么颜色部分。

```
 Red     Green     Blue       Alpha
 Pixel-Color Value in Binary: 10111001  10111001  10111001  00000000 
```

例如，假设我们想要获取该像素颜色的绿色值。*我们可以通过mask*和*shift*轻松获得该值。

我们的面具：

```
 Red      Green      Blue      Alpha
 color :        10111001  10111001  10111001  00000000
 green_mask  :  00000000  11111111  00000000  00000000

 masked_color = color & green_mask

 masked_color:  00000000  10111001  00000000  00000000 
```

逻辑`&`运算符确保仅保留掩码为 1 的值。我们现在要做的最后一件事是通过将所有这些位向右移动 16 位*（逻辑右移）*来获得正确的整数值。

```
 green_value = masked_color >>> 16 
```

等等，我们有一个整数表示像素颜色中绿色的数量：

```
 Pixels-Green Value in Hex:     000000B9
 Pixels-Green Value in Binary:  00000000 00000000 00000000 10111001
 Pixels-Green Value in Decimal: 185 
```

这通常用于编码或解码图像格式，如`jpg`,`png`等。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-09-26T20:07:48.203

一个问题是以下内容取决于实现（根据 ANSI 标准）：

```
char x = -1;
x >> 1; 
```

x 现在可以是 127 (01111111) 或仍然是 -1 (11111111)。

在实践中，通常是后者。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2016-10-11T22:43:54.087

我只写提示和技巧。它可能在测试和考试中很有用。

1.  `n = n*2`：`n = n<<1`
2.  `n = n/2`：`n = n>>1`
3.  检查 n 是否为 2 的幂（1,2,4,8,...）：检查`!(n & (n-1))`
4.  获得^第*x*位：^(`n``n |= (1 << x)`)
5.  检查 x 是偶数还是奇数：（`x&1 == 0`偶数）
6.  切换x 的^第*n*位：^(`x ^ (1<<n)`)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-08-28T13:16:33.497

请注意，在 Java 实现中，要移位的位数由源的大小修改。

例如：

```
(long) 4 >> 65 
```

等于 2。您可能希望将位向右移动 65 次会将所有内容归零，但实际上相当于：

```
(long) 4 >> (65 % 64) 
```

这适用于 <<、>> 和 >>>。我还没有用其他语言尝试过。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-06-13T17:55:59.337

位运算符用于执行位级别的操作或以不同的方式操作位。发现按位运算要快得多，并且有时用于提高程序的效率。基本上，位运算符可以应用于整数类型：**long**、**int**、**short**、**char**和**byte**。

## 移位运算符

它们分为左移和右移两类。

*   **左移（<<）：** 左移运算符，将值中的所有位向左移动指定的次数。语法：值 << 数字。这里 num 指定左移 value 中的值的位置数。也就是说，<< 将指定值中的所有位向左移动 num 指定的位位置数。对于每个左移，高位被移出（并被忽略/丢失），并在右侧带入零。这意味着当向 32 位编译器应用左移时，一旦移过位位置 31，位就会丢失。如果编译器是 64 位的，那么位位置 63 之后的位就会丢失。

[![在此处输入图像描述](https://i.stack.imgur.com/27o7v.jpg)](https://i.stack.imgur.com/27o7v.jpg)

**输出： 6**，这里 3 的二进制表示为 0...0011（考虑 32 位系统），因此当它移动一次时，前导零被忽略/丢失，其余 31 位向左移动。最后添加零。所以它变成了 0...0110，这个数字的十进制表示是 6。

*   在负数的情况下：

## [![负数代码。](https://i.stack.imgur.com/qNbnd.jpg)](https://i.stack.imgur.com/qNbnd.jpg)

**输出： -2**，在 java 中为负数，用 2 的补码表示。所以，-1 由 2^32-1 表示，相当于 1....11（考虑 32 位系统）。当移位一次时，前导位被忽略/丢失，其余 31 位向左移位，最后添加零。所以它变成了 11...10，它的十进制等价物是 -2。所以，我认为你对左移及其工作方式有足够的了解。

*   **Right Shift(>>)：**右移运算符，将值中的所有位向右移动指定的次数。语法：value >> num, num 指定将 value 中的值右移的位置数。也就是说，>> 将指定值中的所有位向右移动/移位 num 指定的位数。以下代码片段将值 35 向右移动两个位置：

[![在此处输入图像描述](https://i.stack.imgur.com/q0x8v.jpg)](https://i.stack.imgur.com/q0x8v.jpg)

**输出： 8**，由于 32 位系统中 35 的二进制表示是 00...00100011，所以当我们将其右移两次时，前 30 个前导位被移动/移动到右侧，两个低位位丢失/忽略，并在前导位添加两个零。所以，它变成了 00....00001000，这个二进制表示的十进制等价物是 8。或者有一个**简单的数学技巧**来找出以下代码的输出： 为了概括这一点，我们可以说，x >> y = 地板（x/pow（2，y））。考虑上面的例子，x=35 和 y=2 所以，35/2^2 = 8.75，如果我们取底值，那么答案是 8。

[![在此处输入图像描述](https://i.stack.imgur.com/FM2nG.jpg)](https://i.stack.imgur.com/FM2nG.jpg)

输出：

[![在此处输入图像描述](https://i.stack.imgur.com/cDTEe.jpg)](https://i.stack.imgur.com/cDTEe.jpg)

但是请记住一件事，如果您采用较大的 y 值，则此技巧适用于较小的 y 值，它会给您不正确的输出。

*   在负数的情况下：由于负数，右移运算符以有符号和无符号两种模式工作。在有符号右移运算符（>>）中，如果是正数，则用 0 填充前导位。如果是负数，则用 1 填充前导位。保持符号。这称为“符号扩展”。

[![在此处输入图像描述](https://i.stack.imgur.com/LpHwK.jpg)](https://i.stack.imgur.com/LpHwK.jpg)

**输出： -5**，正如我上面解释的，编译器将负值存储为 2 的补码。因此，-10 表示为 2^32-10 并且考虑到 32 位系统 11....0110 以二进制表示。当我们移位/移动一次时，前 31 个前导位在右侧移动，而低位丢失/忽略。所以，它变成了 11...0011 并且这个数字的十进制表示是 -5（我怎么知道数字的符号？因为前导位是 1）。有趣的是，如果将 -1 右移，结果始终保持为 -1，因为符号扩展不断在高位中引入更多的位。

*   **无符号右移（>>>）：**此运算符也向右移动位。有符号和无符号之间的区别在于，如果数字为负数，后者用 1 填充前导位，而在任何一种情况下，前者都填充零。现在问题出现了，如果我们通过有符号右移运算符获得所需的输出，为什么我们需要无符号右操作。通过一个例子来理解这一点，如果你正在移动不代表数值的东西，你可能不希望发生符号扩展。当您使用基于像素的值和图形时，这种情况很常见。在这些情况下，无论初始值是什么，您通常都希望将零移到高位。

[![在此处输入图像描述](https://i.stack.imgur.com/0w3xZ.jpg)](https://i.stack.imgur.com/0w3xZ.jpg)

**输出： 2147483647**，因为 -2 在 32 位系统中表示为 11...10。当我们将位移动一位时，前 31 个前导位向右移动/移位，低位丢失/忽略，并将零添加到前导位。因此，它变为 011...1111 (2^31-1)，其十进制等效值为 2147483647。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2019-04-27T18:40:24.543

Python中一些有用的位操作/操作。

我用 Python 实现了[Ravi Prakash 的答案](https://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work/39987901#39987901)。

```
# Basic bit operations
# Integer to binary
print(bin(10))

# Binary to integer
print(int('1010', 2))

# Multiplying x with 2 .... x**2 == x << 1
print(200 << 1)

# Dividing x with 2 .... x/2 == x >> 1
print(200 >> 1)

# Modulo x with 2 .... x % 2 == x & 1
if 20 & 1 == 0:
    print("20 is a even number")

# Check if n is power of 2: check !(n & (n-1))
print(not(33 & (33-1)))

# Getting xth bit of n: (n >> x) & 1
print((10 >> 2) & 1) # Bin of 10 == 1010 and second bit is 0

# Toggle nth bit of x : x^(1 << n)
# take bin(10) == 1010 and toggling second bit in bin(10) we get 1110 === bin(14)
print(10^(1 << 2)) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-11-04T06:22:58.540

移位运算符移动二进制对象的位值。左操作数指定要移位的值。右操作数指定值中的位要移动的位置数。结果不是左值。两个操作数具有相同的优先级并且是从左到右关联的。

```
Operator     Usage

 <<           Indicates the bits are to be shifted to the left.

 >>           Indicates the bits are to be shifted to the right. 
```

每个操作数必须具有整数或枚举类型。编译器对操作数执行整数提升，然后将右操作数转换为 int 类型。结果与左操作数具有相同的类型（在算术转换之后）。

右操作数不应具有负值或大于或等于要移位的表达式的位宽度的值。对这些值进行按位移位的结果是不可预测的。

如果右操作数的值为 0，则结​​果是左操作数的值（在通常的算术转换之后）。

<< 运算符用零填充空出的位。例如，如果 left_op 的值为 4019，则 left_op 的位模式（16 位格式）为：

```
0000111110110011 
```

表达式 left_op << 3 产生：

```
0111110110011000 
```

表达式 left_op >> 3 产生：

```
0000000111110110 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2015-10-23T14:28:36.217

请注意，在 Windows 平台上只有 32 位版本的 PHP 可用。

然后，例如，如果您将 << 或 >> 移动 31 位以上，则结果出乎意料。通常会返回原始数字而不是零，这可能是一个非常棘手的错误。

当然，如果您使用 64 位版本的 PHP（Unix），则应避免移位超过 63 位。但是，例如，MySQL 使用 64 位 BIGINT，因此不应该有任何兼容性问题。

更新：从 PHP 7 Windows 开始，PHP 构建最终能够使用完整的 64 位整数：整数 *的大小取决于平台，尽管通常值约为 20 亿的最大值（即 32 位有符号）。64 位平台的最大值通常约为 9E18，但在 PHP 7 之前的 Windows 上，它始终为 32 位。*

# asp.net-mvc - MVC n级路由构建

> ID：141534
> 
> 赞同：0
> 
> 时间：2008-09-26T19:48:09.517
> 
> 标签：asp.net-mvc, model-view-controller, mvcroutehandler

我想创建一个包含 N 级类别的产品目录

> 例如
> 
> ```
> /Catalog/Category1/Category2/../SubCategoryN/Product/{ProductActions}/{ID}
> 
> And at the same time be able to 
> 
> /Catalog/Category1/Category2/../SubCategoryN/{CategoryActions} 
> ```

这是可能的，如果是的话，怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T00:43:57.433

不是使用默认的 Route 类，但您可以通过从 RouteBase 派生来创建自己的路由类。您基本上最终不得不自己完成解析 URL 的所有工作，但您可以使用 Route 的源代码来帮助您开始。

# python - 如何根据参数类型重载 __init__ 方法？

> ID：141545
> 
> 赞同：384
> 
> 时间：2008-09-26T19:49:46.640
> 
> 标签：python, constructor, operator-overloading

假设我有一个类，它有一个名为 data 的成员，它是一个列表。

我希望能够使用例如文件名（其中包含用于初始化列表的数据）或实际列表来初始化类。

你这样做的技术是什么？

你只是通过查看来检查类型`__class__`吗？

我可能会错过一些技巧吗？

我习惯了 C++ 中的参数类型重载很容易。

* * *

## 回答 #1

> 赞同：513
> 
> 时间：2008-09-26T20:30:15.857

获得“备用构造函数”的一种更简洁的方法是使用类方法。例如：

```
>>> class MyData:
...     def __init__(self, data):
...         "Initialize MyData from a sequence"
...         self.data = data
...     
...     @classmethod
...     def fromfilename(cls, filename):
...         "Initialize MyData from a file"
...         data = open(filename).readlines()
...         return cls(data)
...     
...     @classmethod
...     def fromdict(cls, datadict):
...         "Initialize MyData from a dict's items"
...         return cls(datadict.items())
... 
>>> MyData([1, 2, 3]).data
[1, 2, 3]
>>> MyData.fromfilename("/tmp/foobar").data
['foo\n', 'bar\n', 'baz\n']
>>> MyData.fromdict({"spam": "ham"}).data
[('spam', 'ham')] 
```

它更简洁的原因是毫无疑问预期的类型是什么，并且您不必猜测调用者打算如何处理它给您的数据类型。问题`isinstance(x, basestring)`在于，调用者无法告诉您，例如，即使类型不是基本字符串，您也应该将其视为字符串（而不是另一个序列）。也许调用者想要将同一类型用于不同目的，有时作为单个项目，有时作为项目序列。显式可以消除所有疑问，并导致更健壮和更清晰的代码。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-10-17T13:34:31.393

很好的问题。我也解决了这个问题，虽然我同意“工厂”（类方法构造函数）是一个好方法，但我想建议另一种方法，我也发现它非常有用：

这是一个示例（这是一个`read`方法而不是构造函数，但想法是一样的）：

```
def read(self, str=None, filename=None, addr=0):
    """ Read binary data and return a store object. The data
        store is also saved in the interal 'data' attribute.

        The data can either be taken from a string (str 
        argument) or a file (provide a filename, which will 
        be read in binary mode). If both are provided, the str 
        will be used. If neither is provided, an ArgumentError 
        is raised.
    """
    if str is None:
        if filename is None:
            raise ArgumentError('Please supply a string or a filename')

        file = open(filename, 'rb')
        str = file.read()
        file.close()
    ...
    ... # rest of code 
```

这里的关键思想是使用 Python 对命名参数的出色支持来实现这一点。现在，如果我想从文件中读取数据，我会说：

```
obj.read(filename="blob.txt") 
```

为了从字符串中读取它，我说：

```
obj.read(str="\x34\x55") 
```

这样，用户只需调用一个方法。如您所见，在内部处理它并不太复杂

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2018-04-20T07:47:05.777

使用 python3，您可以使用[实现具有函数注释的多个调度，](https://github.com/dabeaz/python-cookbook/blob/master/src/9/multiple_dispatch_with_function_annotations/example1.py)如 Python Cookbook 所写：

```
import time

class Date(metaclass=MultipleMeta):
    def __init__(self, year:int, month:int, day:int):
        self.year = year
        self.month = month
        self.day = day

    def __init__(self):
        t = time.localtime()
        self.__init__(t.tm_year, t.tm_mon, t.tm_mday) 
```

它的工作原理如下：

```
>>> d = Date(2012, 12, 21)
>>> d.year
2012
>>> e = Date()
>>> e.year
2018 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2012-04-18T21:38:33.850

快速而肮脏的修复

```
class MyData:
    def __init__(string=None,list=None):
        if string is not None:
            #do stuff
        elif list is not None:
            #do other stuff
        else:
            #make data empty 
```

然后你可以调用它

```
MyData(astring)
MyData(None, alist)
MyData() 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-26T19:52:59.193

更好的方法是使用 isinstance 和类型转换。如果我理解你的正确，你想要这个：

```
def __init__ (self, filename):
    if isinstance (filename, basestring):
        # filename is a string
    else:
        # try to convert to a list
        self.path = list (filename) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T19:54:33.290

你应该使用 isinstance

```
isinstance(...)
    isinstance(object, class-or-type-or-tuple) -> bool

    Return whether an object is an instance of a class or of a subclass thereof.
    With a type as second argument, return whether that is the object's type.
    The form using a tuple, isinstance(x, (A, B, ...)), is a shortcut for
    isinstance(x, A) or isinstance(x, B) or ... (etc.). 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T19:54:30.843

您可能需要`isinstance`内置函数：

```
self.data = data if isinstance(data, list) else self.parse(data) 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-26T20:18:19.397

好的，不错。我只是把这个例子和一个元组而不是一个文件名放在一起，但这很容易。谢谢大家。

```
class MyData:
    def __init__(self, data):
        self.myList = []
        if isinstance(data, tuple):
            for i in data:
                self.myList.append(i)
        else:
            self.myList = data

    def GetData(self):
        print self.myList 
```

a = [1,2]

b = (2,3)

c = 我的数据（一）

d = 我的数据（b）

c.GetData()

d.GetData()

[1, 2]

[2, 3]

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-05-01T19:49:07.790

你为什么不去更pythonic？

```
class AutoList:
def __init__(self, inp):
    try:                        ## Assume an opened-file...
        self.data = inp.read()
    except AttributeError:
        try:                    ## Assume an existent filename...
            with open(inp, 'r') as fd:
                self.data = fd.read()
        except:
            self.data = inp     ## Who cares what that might be? 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-09-24T13:55:57.867

我首选的解决方案是：

```
class MyClass:
    _data = []
    __init__(self,data=None):
        # do init stuff
        if not data: return
        self._data = list(data) # list() copies the list, instead of pointing to it. 
```

然后用`MyClass()`or调用它`MyClass([1,2,3])`。

希望有帮助。快乐编码！

# c# - 将数百万条记录从平面文件插入 SQL Server 的陷阱是什么？

> ID：141556
> 
> 赞同：4
> 
> 时间：2008-09-26T19:52:04.203
> 
> 标签：c#, sql-server, sql-server-2005, ssis, bulkinsert

我即将开始编写一个 Windows 窗体应用程序的旅程，该应用程序将打开一个 txt 文件，该文件以管道分隔，大小约为 230 mb。然后，此应用程序会将这些数据插入到 sql server 2005 数据库中（显然这需要迅速发生）。我在这个项目中使用 c# 3.0 和 .net 3.5。

我不是在要求该应用程序，只是在这里提供一些公共建议和潜在的陷阱建议。从我收集到的网站上，SQL 批量复制是先决条件，有什么我应该考虑的（我认为仅使用表单应用程序打开 txt 文件将是一项巨大的努力；也许将其分解为 blob 数据？）。

谢谢，如果有人需要，我会编辑问题以使其清晰。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-26T19:56:14.940

你必须写一个winforms应用程序吗？使用 SSIS 可能更容易和更快。有一些内置任务可用，尤其是[Bulk Insert task](http://denster.spaces.live.com/Blog/cns!125D53A08EC75357!1210.entry)。

此外，值得检查[SQL Server 2005 中的平面文件批量导入方法速度比较。](http://weblogs.sqlteam.com/mladenp/articles/10631.aspx)

更新：如果您是 SSIS 新手，请查看其中一些网站，让您快速上手。1) [SSIS 控制流基础](http://www.jumpstarttv.com/ssis-control-flow-basics_201.aspx)2) [SQL Server 集成服务入门](http://www.developer.com/db/article.php/3635316)

这是另一个 How to: on [Importing Excel file into SQL 2005](http://www.builderau.com.au/program/sqlserver/soa/How-to-import-an-Excel-file-into-SQL-Server-2005-using-Integration-Services/0,339028455,339285948,00.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T19:54:43.867

这将是一项流媒体工作。

如果可以，请不要在此处使用事务。交易成本太高了。

因此，您要做的是一次读取文件一行，然后一次将其插入一行。您应该将失败的插入转储到另一个文件中，以便稍后诊断并查看它们失败的位置。

起初，我会继续尝试批量插入几百行，以查看流是否正常工作，然后您可以打开所有您想要的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:00:01.373

您可以尝试使用[SqlBulkCopy](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)。它使您可以从“任何数据源”中提取数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:03:26.250

顺便说一句，有时删除表的索引并在批量插入操作后重新创建它们会更快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:20:26.177

您可能会考虑从完全恢复切换到批量记录。这将有助于使您的备份保持合理的大小。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T22:14:12.910

我完全推荐 SSIS，您可以在相对较短的时间内读取数百万条记录并一路清理它们。

您将需要留出一些时间来掌握 SSIS，但它应该得到回报。SO上还有一些其他线程可能有用：

[在 SQL Server（C# 客户端）中批量插入大量数据的最快方法是什么](https://stackoverflow.com/questions/24200/whats-the-fastest-way-to-bulk-insert-a-lot-of-data-in-sql-server-c-client)

[SSIS推荐的学习材料是什么？](https://stackoverflow.com/questions/142015/ssis-gurus-links-to-great-learning-content-requested)

您还可以从 C# 创建包。我有一个 C# 程序，它从遗留系统读取 3GL“主文件”（使用我为相关项目提供的 API 解析为对象模型），获取包模板并对其进行修改以生成用于 ETL 的包。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:01:06.550

如果文件的列格式与数据需要结束的目标表匹配，我更喜欢使用命令行实用程序**bcp**来加载数据文件。它速度极快，您可以为任何无法插入的“奇数”记录指定错误文件。

如果您需要为其存储命令行参数（服务器、数据库、用户名/密码或受信任的连接、表、错误文件等），您的应用程序可以启动该命令。

与运行 BULK INSERT SQL 命令相比，我更喜欢这种方法，因为数据文件不需要位于数据库服务器可访问的系统上。要使用批量插入，您必须指定要加载的数据文件的路径，因此它必须是运行加载的数据库服务器上的系统用户可见和可读的路径。通常对我来说太麻烦了。:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T20:05:12.783

您所说的数据量实际上并没有那么大。我不知道你的效率问题是什么，但如果你可以等待几个小时让它插入，你可能会惊讶于用一种非常幼稚的技术来完成这将是多么容易，一次只插入每一行. 一次批处理大约一千行并将它们提交到 SQL Server 可能也会使其更快一些。

如果您不需要尽可能快的速度，这只是一个可以为您节省大量编程时间的建议。根据此导入必须运行的频率，节省几天的编程时间可能很值得，以换取在运行时等待几个小时。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T20:12:48.333

您可以使用 SSIS 进行读取和插入，但将其作为 WinForms 应用程序中的包调用。然后，您可以将源、目标、连接字符串等内容作为参数/配置传递。

方法：http : [//msdn.microsoft.com/en-us/library/aa337077.aspx](http://msdn.microsoft.com/en-us/library/aa337077.aspx)

您可以在 SSIS 中设置转换和错误处理，甚至可以根据输入参数创建逻辑分支。

# java - 应该尝试...catch 进入循环内部还是外部？

> ID：141560
> 
> 赞同：197
> 
> 时间：2008-09-26T19:52:30.143
> 
> 标签：java, performance, loops, try-catch

我有一个看起来像这样的循环：

```
for (int i = 0; i < max; i++) {
    String myString = ...;
    float myNum = Float.parseFloat(myString);
    myFloats[i] = myNum;
} 
```

这是唯一目的是返回浮点数组的方法的主要内容。`null`如果出现错误，我希望此方法返回，因此我将循环放在一个`try...catch`块中，如下所示：

```
try {
    for (int i = 0; i < max; i++) {
        String myString = ...;
        float myNum = Float.parseFloat(myString);
        myFloats[i] = myNum;
    }
} catch (NumberFormatException ex) {
    return null;
} 
```

但是后来我也想到了将`try...catch`块放入循环中，如下所示：

```
for (int i = 0; i < max; i++) {
    String myString = ...;
    try {
        float myNum = Float.parseFloat(myString);
    } catch (NumberFormatException ex) {
        return null;
    }
    myFloats[i] = myNum;
} 
```

是否有任何理由，性能或其他原因，更喜欢一个而不是另一个？

* * *

**编辑：**共识似乎是将循环放在 try/catch 中更干净，可能放在它自己的方法中。但是，仍然存在关于哪个更快的争论。有人可以对此进行测试并给出统一的答案吗？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-09-26T20:09:17.670

表现：

放置 try/catch 结构的位置绝对没有性能差异。在内部，它们被实现为结构中的代码范围表，该结构在调用方法时创建。当方法执行时，try/catch 结构完全不在图片中，除非发生抛出，然后将错误的位置与表进行比较。

这是一个参考：[http ://www.javaworld.com/javaworld/jw-01-1997/jw-01-hood.html](http://www.javaworld.com/javaworld/jw-01-1997/jw-01-hood.html)

这张桌子被描述到大约一半。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-09-26T19:57:12.067

**性能**：正如[Jeffrey](https://stackoverflow.com/questions/141560#141652)在他的回复中所说，在 Java 中并没有太大的区别。

**通常**，为了代码的可读性，您选择捕获异常的位置取决于您是否希望循环继续处理。

在您的示例中，您在捕获异常时返回。在这种情况下，我会将 try/catch 放在循环中。如果你只是想捕捉一个坏值但继续处理，把它放在里面。

**第三种方式**：您始终可以编写自己的静态 ParseFloat 方法，并在该方法而不是循环中处理异常处理。使异常处理与循环本身隔离！

```
class Parsing
{
    public static Float MyParseFloat(string inputValue)
    {
        try
        {
            return Float.parseFloat(inputValue);
        }
        catch ( NumberFormatException e )
        {
            return null;
        }
    }

    // ....  your code
    for(int i = 0; i < max; i++) 
    {
        String myString = ...;
        Float myNum = Parsing.MyParseFloat(myString);
        if ( myNum == null ) return;
        myFloats[i] = (float) myNum;
    }
} 
```

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-09-29T16:55:35.973

好吧，在[Jeffrey L Whitledge 说](https://stackoverflow.com/questions/141560/should-trycatch-go-inside-or-outside-a-loop#141652)没有性能差异（截至 1997 年）之后，我去测试了它。我运行了这个小基准测试：

```
public class Main {

    private static final int NUM_TESTS = 100;
    private static int ITERATIONS = 1000000;
    // time counters
    private static long inTime = 0L;
    private static long aroundTime = 0L;

    public static void main(String[] args) {
        for (int i = 0; i < NUM_TESTS; i++) {
            test();
            ITERATIONS += 1; // so the tests don't always return the same number
        }
        System.out.println("Inside loop: " + (inTime/1000000.0) + " ms.");
        System.out.println("Around loop: " + (aroundTime/1000000.0) + " ms.");
    }
    public static void test() {
        aroundTime += testAround();
        inTime += testIn();
    }
    public static long testIn() {
        long start = System.nanoTime();
        Integer i = tryInLoop();
        long ret = System.nanoTime() - start;
        System.out.println(i); // don't optimize it away
        return ret;
    }
    public static long testAround() {
        long start = System.nanoTime();
        Integer i = tryAroundLoop();
        long ret = System.nanoTime() - start;
        System.out.println(i); // don't optimize it away
        return ret;
    }
    public static Integer tryInLoop() {
        int count = 0;
        for (int i = 0; i < ITERATIONS; i++) {
            try {
                count = Integer.parseInt(Integer.toString(count)) + 1;
            } catch (NumberFormatException ex) {
                return null;
            }
        }
        return count;
    }
    public static Integer tryAroundLoop() {
        int count = 0;
        try {
            for (int i = 0; i < ITERATIONS; i++) {
                count = Integer.parseInt(Integer.toString(count)) + 1;
            }
            return count;
        } catch (NumberFormatException ex) {
            return null;
        }
    }
} 
```

我使用 javap 检查了生成的字节码，以确保没有内联。

结果表明，假设 JIT 优化不显着，**Jeffrey 是正确的**；**Java 6、Sun 客户端 VM 上**绝对没有性能差异（我无法访问其他版本）。在整个测试中，总时间差大约为几毫秒。

因此，唯一的考虑是看起来最干净的东西。我发现第二种方式很难看，所以我会坚持第一种方式或[Ray Hayes 的方式](https://stackoverflow.com/questions/141560/should-trycatch-go-inside-or-outside-a-loop#141589)。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2015-10-30T12:27:33.797

虽然性能可能相同，并且“看起来”更好是非常主观的，但功能上仍然存在很大差异。举个例子：

```
Integer j = 0;
    try {
        while (true) {
            ++j;

            if (j == 20) { throw new Exception(); }
            if (j%4 == 0) { System.out.println(j); }
            if (j == 40) { break; }
        }
    } catch (Exception e) {
        System.out.println("in catch block");
    } 
```

while 循环在 try catch 块内，变量 'j' 递增直到达到 40，当 j mod 4 为零时打印出来，当 j 达到 20 时抛出异常。

在任何细节之前，这里是另一个例子：

```
Integer i = 0;
    while (true) {
        try {
            ++i;

            if (i == 20) { throw new Exception(); }
            if (i%4 == 0) { System.out.println(i); }
            if (i == 40) { break; }

        } catch (Exception e) { System.out.println("in catch block"); }
    } 
```

与上面的逻辑相同，唯一的区别是 try/catch 块现在位于 while 循环内。

输出如下（在 try/catch 中）：

```
4
8
12 
16
in catch block 
```

和另一个输出（尝试/捕获同时）：

```
4
8
12
16
in catch block
24
28
32
36
40 
```

那里有很大的不同：

while in try/catch 跳出循环

try/catch in while 保持循环处于活动状态

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-30T20:42:21.350

我同意所有性能和可读性的帖子。但是，在某些情况下它确实很重要。其他几个人提到了这一点，但通过示例可能更容易看到。

考虑这个稍微修改的例子：

```
public static void main(String[] args) {
    String[] myNumberStrings = new String[] {"1.2345", "asdf", "2.3456"};
    ArrayList asNumbers = parseAll(myNumberStrings);
}

public static ArrayList parseAll(String[] numberStrings){
    ArrayList myFloats = new ArrayList();

    for(int i = 0; i < numberStrings.length; i++){
        myFloats.add(new Float(numberStrings[i]));
    }
    return myFloats;
} 
```

如果您希望 parseAll() 方法在有任何错误时返回 null（如原始示例），您可以像这样将 try/catch 放在外面：

```
public static ArrayList parseAll1(String[] numberStrings){
    ArrayList myFloats = new ArrayList();
    try{
        for(int i = 0; i < numberStrings.length; i++){
            myFloats.add(new Float(numberStrings[i]));
        }
    } catch (NumberFormatException nfe){
        //fail on any error
        return null;
    }
    return myFloats;
} 
```

实际上，您可能应该在此处返回错误而不是 null，而且通常我不喜欢有多个返回，但您明白了。

另一方面，如果您希望它忽略问题，并解析它可以解析的任何字符串，您可以将 try/catch 放在循环内部，如下所示：

```
public static ArrayList parseAll2(String[] numberStrings){
    ArrayList myFloats = new ArrayList();

    for(int i = 0; i < numberStrings.length; i++){
        try{
            myFloats.add(new Float(numberStrings[i]));
        } catch (NumberFormatException nfe){
            //don't add just this one
        }
    }

    return myFloats;
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-13T01:22:16.777

如前所述，性能是相同的。但是，用户体验不一定相同。在第一种情况下，您将很快失败（即在第一个错误之后），但是如果您将 try/catch 块放入循环中，您可以捕获为给定的方法调用创建的所有错误。从字符串中解析值数组时，您希望出现一些格式错误，在某些情况下，您肯定希望能够将所有错误呈现给用户，这样他们就不需要一个一个地尝试修复它们.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T19:59:38.333

如果它是全有或全无的失败，那么第一种格式是有意义的。如果您希望能够处理/返回所有非失败元素，则需要使用第二种形式。这些将是我在这些方法之间进行选择的基本标准。就个人而言，如果它是全有或全无，我不会使用第二种形式。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-08-31T09:08:33.973

只要你知道你需要在循环中完成什么，你就可以将 try catch 放在循环之外。但重要的是要了解，一旦发生异常，循环就会结束，这可能并不总是你想要的。这实际上是基于 Java 的软件中非常常见的错误。人们需要处理许多项目，例如清空队列，并错误地依赖外部 try/catch 语句来处理所有可能的异常。他们也可能只处理循环内的特定异常，而不期望发生任何其他异常。然后，如果发生未在循环内部处理的异常，则循环将被“抢占”，它可能过早结束并且外部 catch 语句处理异常。

如果循环在生活中的角色是清空队列，那么该循环很可能会在该队列真正清空之前结束。很常见的故障。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-02-13T21:56:01.320

我的观点是 try/catch 块对于确保正确的异常处理是必要的，但是创建这样的块会影响性能。由于循环包含密集的重复计算，因此不建议将 try/catch 块放在循环内。此外，似乎发生这种情况的地方，通常是“异常”或“运行时异常”被捕获。应避免在代码中捕获 RuntimeException。同样，如果您在一家大公司工作，则必须正确记录该异常，或停止运行时异常的发生。这个描述的重点是`PLEASE AVOID USING TRY-CATCH BLOCKS IN LOOPS`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-26T19:55:34.397

在您的示例中，没有功能差异。我发现您的第一个示例更具可读性。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-26T19:57:18.073

您应该更喜欢外部版本而不是内部版本。这只是规则的特定版本，将任何可以移出循环的内容移出循环。根据 IL 编译器和 JIT 编译器，您的两个版本可能会或可能不会以不同的性能特征结束。

另一方面，您可能应该查看 float.TryParse 或 Convert.ToFloat。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T19:58:23.937

如果您将 try/catch 放入循环中，您将在异常后继续循环。如果你把它放在循环之外，一旦抛出异常，你就会停止。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-05T15:41:53.697

`0.02c`在查看异常处理位置的一般问题时，我想添加我自己的两个相互竞争的考虑：

1.  块的“更广泛”的责任`try-catch`（即在您的情况下在循环之外）意味着在稍后更改代码时，您可能会错误地添加由现有`catch`块处理的行；可能是无意的。在您的情况下，这不太可能，因为您明确地捕获了`NumberFormatException`

2.  块的责任越“窄” `try-catch`，重构就越困难。`catch`特别是当（如您的情况）您正在从块（`return null`语句） 内执行“非本地”指令时。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-12-23T14:59:58.193

如果您想为每次迭代捕获异常，或者检查在哪个迭代抛出异常并捕获迭代中的每个异常，请将 try...catch 放在循环内。如果发生异常，这不会中断循环，并且您可以在整个循环中的每次迭代中捕获每个异常。

如果您想打破循环并在抛出异常时检查异常，请使用 try...catch 退出循环。这将中断循环并在 catch 之后执行语句（如果有的话）。

这一切都取决于您的需要。我更喜欢在部署时在循环内使用 try...catch，因为如果发生异常，结果不会模棱两可，循环不会中断并完全执行。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-26T19:57:38.417

如果它在内部，那么您将获得 N 次 try/catch 结构的开销，而不仅仅是外部的一次。

* * *

每次调用 Try/Catch 结构时，都会增加方法执行的开销。只需一点点内存和处理器的滴答声就可以处理该结构。如果您正在运行一个循环 100 次，并且出于假设的原因，假设成本是每次 try/catch 调用的 1 个滴答声，那么在循环中使用 Try/Catch 会花费您 100 个滴答声，而不是只有 1 个滴答声在循环之外。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-26T20:01:47.097

为 try/catch 设置一个特殊的堆栈帧会增加额外的开销，但 JVM 可能能够检测到您正在返回的事实并对其进行优化。

根据迭代次数，性能差异可能可以忽略不计。

然而，我同意其他人的观点，将它放在循环之外会使循环体看起来更干净。

如果您有可能想要继续处理而不是在存在无效数字时退出，那么您会希望代码位于循环内。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-26T23:11:28.013

例外的全部意义在于鼓励第一种风格：让错误处理合并并处理一次，而不是立即在每个可能的错误位置处理。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-01T05:23:00.147

把它放在里面。您可以继续处理（如果需要），或者您可以抛出一个有用的异常，告诉客户端 myString 的值和包含错误值的数组的索引。我认为 NumberFormatException 已经告诉你错误的值，但原则是将所有有用的数据放在你抛出的异常中。想想在程序的这一点上调试器中你会感兴趣的是什么。

考虑：

```
try {
   // parse
} catch (NumberFormatException nfe){
   throw new RuntimeException("Could not parse as a Float: [" + myString + 
                              "] found at index: " + i, nfe);
} 
```

在需要的时候，您会非常欣赏这样的异常，其中包含尽可能多的信息。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-07T08:13:14.897

这取决于故障处理。如果您只想跳过错误元素，请在里面尝试：

```
for(int i = 0; i < max; i++) {
    String myString = ...;
    try {
        float myNum = Float.parseFloat(myString);
        myFloats[i] = myNum;
    } catch (NumberFormatException ex) {
        --i;
    }
} 
```

在任何其他情况下，我更喜欢外面的尝试。代码更易读，更干净。如果返回 null，也许在错误情况下抛出 IllegalArgumentException 会更好。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-09T16:30:41.803

我会投入我的 0.02 美元。有时您最终需要稍后在代码中添加“finally”（因为谁第一次完美地编写了他们的代码？）。在这些情况下，突然间将 try/catch 放在循环之外更有意义。例如：

```
try {
    for(int i = 0; i < max; i++) {
        String myString = ...;
        float myNum = Float.parseFloat(myString);
        dbConnection.update("MY_FLOATS","INDEX",i,"VALUE",myNum);
    }
} catch (NumberFormatException ex) {
    return null;
} finally {
    dbConnection.release();  // Always release DB connection, even if transaction fails.
} 
```

因为如果你得到一个错误，或者没有，你只想释放你的数据库连接（或选择你最喜欢的其他资源类型......）一次。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-03-11T19:06:16.940

上面没有提到的另一个方面是每个 try-catch 都会对堆栈产生*一些*影响，这可能对递归方法产生影响。

如果方法“outer()”调用方法“inner()”（可能会递归调用自身），如果可能，尝试在方法“outer()”中找到 try-catch。我们在性能类中使用的一个简单的“堆栈崩溃”示例在 try-catch 位于内部方法中时在大约 6,400 帧时失败，而在外部方法中时在大约 11,600 帧处失败。

在现实世界中，如果您使用的是复合模式并且具有大型、复杂的嵌套结构，这可能会成为一个问题。

# sql - SQL查找列中不同值的数量

> ID：141562
> 
> 赞同：396
> 
> 时间：2008-09-26T19:52:48.677
> 
> 标签：sql, distinct

我可以通过以下方式选择列中的所有不同值：

*   `SELECT DISTINCT column_name FROM table_name;`
*   `SELECT column_name FROM table_name GROUP BY column_name;`

但是如何从该查询中获取行数？是否需要子查询？

* * *

## 回答 #1

> 赞同：687
> 
> 时间：2008-09-26T19:54:59.217

您可以在聚合函数中使用`DISTINCT`关键字：[`COUNT`](http://technet.microsoft.com/en-us/library/ms175997%28v=sql.90%29.aspx)

```
SELECT COUNT(DISTINCT column_name) AS some_alias FROM table_name 
```

这将只计算该列的不同值。

* * *

## 回答 #2

> 赞同：207
> 
> 时间：2012-10-27T15:45:30.510

这将为您提供不同的列值和每个值的计数。我通常发现我想知道这两条信息。

```
SELECT [columnName], count([columnName]) AS CountOf
FROM [tableName]
GROUP BY [columnName] 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-26T21:32:04.990

请注意 Count() 忽略 null 值，因此如果您需要允许 null 作为其自己的不同值，您可以执行一些棘手的操作，例如：

```
select count(distinct my_col)
       + count(distinct Case when my_col is null then 1 else null end)
from my_table
/ 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2015-05-20T00:04:51.973

column_name 的唯一值的 sql 总和并按频率排序：

```
SELECT column_name, COUNT(*) FROM table_name GROUP BY column_name ORDER BY 2 DESC; 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-26T19:55:38.857

```
SELECT COUNT(DISTINCT column_name) FROM table as column_name_count; 
```

你必须计算那个不同的 col，然后给它一个别名。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-11-04T09:37:48.543

```
select count(*) from 
(
SELECT distinct column1,column2,column3,column4 FROM abcd
) T 
```

这将给出不同列组的计数。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-26T19:54:47.517

```
select Count(distinct columnName) as columnNameCount from tableName 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-12-26T02:07:16.580

使用以下 SQL，我们可以获得 Oracle 11g 中**不同的列值计数**。

```
select count(distinct(Column_Name)) from TableName 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-02-19T05:57:29.200

在 MS SQL Server 2012 之后，您也可以使用窗口功能。

```
SELECT column_name, COUNT(column_name) OVER (PARTITION BY column_name) 
FROM table_name
GROUP BY column_name 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-03T20:38:30.907

要在[Presto 中执行此操作，请使用`OVER`](https://prestodb.io/docs/0.217/functions/window.html)：

```
SELECT DISTINCT my_col,
                count(*) OVER (PARTITION BY my_col
                               ORDER BY my_col) AS num_rows
FROM my_tbl 
```

使用这种`OVER`基于方法当然是可选的。在上面的 SQL 中，我发现指定`DISTINCT`and`ORDER BY`是必要的。

注意：根据[文档](https://docs.aws.amazon.com/athena/latest/ug/performance-tuning.html#performance-tuning-use-more-efficient-functions)，使用`GROUP BY`可能更有效。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-06-05T10:51:09.183

```
select count(distinct(column_name)) AS columndatacount from table_name where somecondition=true 
```

您可以使用此查询来计算不同/不同的数据。

* * *

## 回答 #12

> 赞同：-10
> 
> 时间：2014-12-18T02:13:16.343

Count(distinct({fieldname})) 是多余的

只需 Count({fieldname}) 即可为您提供该表中的所有不同值。它不会（许多人认为）只是给你表格的计数[即与表格中的 Count(*) 不同]

# fogbugz - 批量时间进入timesprite/fogbugz

> ID：141596
> 
> 赞同：2
> 
> 时间：2008-09-26T19:58:43.267
> 
> 标签：fogbugz

有没有一种好方法可以将时间数据导入 timesprite 或fogbugz？两者似乎都有非常笨拙的界面来一次添加单个项目。我想要的是一种电子表格样式的格式，我可以输入一堆行并将它们吸入。注意到 timesprite 有一个导入，但它似乎只需要 timesprite 格式的 XML。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T02:44:03.963

您可以使用[FogBugz API](http://www.fogcreek.com/FogBugz/docs/60/topics/advanced/API.html)将时间记录批量添加到 FogBugz。我不知道现有的使用 API 将数据加载到 FogBugz 的电子表格输入接口，但可以很容易地为此目的编写一个。

# c# - 在 XML 中存储关系数据

> ID：141598
> 
> 赞同：1
> 
> 时间：2008-09-26T19:58:52.157
> 
> 标签：c#, xml

我想知道在 XML 中存储关系数据结构的最佳实践是什么。特别是，我想知道执行节点顺序的最佳实践。例如，假设我有三个对象：`School`、`Course`和`Student`，它们的定义如下：

```
class School
{
    List<Course> Courses;
    List<Student> Students;
}

class Course
{
    string Number;
    string Description;
}

class Student
{
    string Name;
    List<Course> EnrolledIn;
} 
```

我会将这样的数据结构存储在 XML 中，如下所示：

```
<School>
    <Courses>
        <Course Number="ENGL 101" Description="English I" />
        <Course Number="CHEM 102" Description="General Inorganic Chemistry" />
        <Course Number="MATH 103" Description="Trigonometry" />
    </Courses>
    <Students>
        <Student Name="Jack">
            <EnrolledIn>
                <Course Number="CHEM 102" />
                <Course Number="MATH 103" />
            </EnrolledIn>
        </Student>
        <Student Name="Jill">
            <EnrolledIn>
                <Course Number="ENGL 101" />
                <Course Number="MATH 103" />
            </EnrolledIn>
        </Student>
    </Students>
</School> 
```

以这种方式排序的 XML，我可以`Courses`先解析。然后，当我 parse 时`Students`，我可以查找`Course`列表中`EnrolledIn`（按其`Number`）列出的每个`School.Courses`。这会给我一个对象引用以添加`EnrolledIn`到`Student`. `Students`但是，如果出现*在 之前* `Courses`，则无法进行此类查找以获取对象引用。（因为`School.Courses`还没有被填充。）

那么在 XML 中存储关系数据的最佳实践是什么？- 我是否应该强制执行`Courses`必须始终先行`Students`？`Course`-当我遇到一个我还没有见过的对象时，我是否应该容忍任何排序并创建一个存根对象？（在稍后最终达到定义时进行扩展`Course`。） - 还有其他方法我应该将我的对象持久化/加载到 XML 或从 XML 加载吗？（我目前正在我的所有业务对象上实现`Save`和方法，并使用及其关联的类手动完成所有这些。）`Load``System.Xml.XmlDocument`

我习惯于使用 SQL 处理关系数据，但这是我第一次尝试在 XML 中存储非平凡的关系数据结构。您可以就我应该如何进行操作提供任何建议，我们将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T20:06:11.080

虽然您可以使用 <xsd:sequence> 指定子元素的顺序，但通过要求子对象以特定顺序出现，您会降低系统的灵活性（即，使用记事本更难更新）。

最好的办法是解析出所有数据，然后执行您需要执行的操作。在解析期间不要采取行动。

* * *

显然，XML 的设计及其背后的数据排除了将单个 POCO 序列化为 XML 的可能性。您需要控制序列化和反序列化逻辑，以便将对象解除挂钩和重新挂钩。

我建议创建一个自定义序列化程序来构建此对象图的 xml 表示。因此，它不仅可以控制序列化的顺序，还可以处理节点不在预期顺序的情况。您可以执行其他操作，例如添加自定义属性以用于将对象链接在一起，这些对象在被序列化的对象上不作为公共属性存在。

创建 xml 就像迭代您的对象几次一样简单，构建 XElement 的集合，并将对象的预期表示为 xml。完成后，您可以将它们拼接成一个 XDocument 并从中获取 xml。您可以对反面的 xml 进行多次传递，以重新创建对象图并恢复所有引用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T20:14:55.567

使用 XML 时不要考虑 SQL 或关系，因为没有顺序限制。

但是，您可以随时使用 XPath 查询 XML 文档的任何部分。您首先需要课程，然后是“//Courses/Course”。接下来是学生注册，然后是“//Students/Student/EnrolledIn/Course”。

底线是... 仅仅因为 XML 存储在一个文件中，所以不要误以为您的所有访问都是串行的。

* * *

我发布了一个单独的问题，[“XPath 可以跨 XML 的两个子树进行外键查找吗？”](https://stackoverflow.com/questions/142010/can-xpath-do-a-foreign-key-lookup-across-two-subtrees-of-an-xml) ，以澄清我的立场。该解决方案展示了如何使用 XPath 对 XML 数据进行关系查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:21:38.063

仅当您需要对数据进行只进处理时，节点排序才重要，例如使用 XmlReader 或 SAX 解析器。如果您要在处理之前将 XML 读入 DOM（如果您正在使用 XmlDocument），那么节点顺序并不重要。更重要的是对 XML 进行结构化，以便您可以使用 XPath 有效地查询它，即不必使用“//”。

如果您查看 DataSetGenerator 生成的架构，您会发现没有与 DataTable 级元素关联的排序。可能是 ADO 以某种未在模式中表示的顺序处理元素（例如，一次一个 DataTable），或者可能是 ADO 只进行向前处理并且在完全读取 DataSet 之前不强制执行关系约束。我不知道。但很明显，ADO 没有将处理顺序与文档顺序结合起来。

（是的，您可以在 XML 模式中指定子元素的顺序；这就是 xs:sequence 的作用。如果您不想强制执行节点顺序，则使用无界 xs:choice。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:03:29.480

根据经验，XML 并不是存储关系数据的最佳选择。你调查过[YAML](http://www.yaml.org/ "YAML")吗？你有选择吗？

如果不这样做，一种安全的方法是为 XML 设置严格的 DTD 并以这种方式强制执行。正如您所建议的，您还可以保留已创建对象的哈希值。这样，如果学生创建了课程，您可以保留该课程以供将来在点击标签时进行更新。

还请记住，您可以使用 XPath 查询直接访问特定节点，因此您可以首先强制解析课程，而不管 XML 文档中的位置如何。（做出更完整的答案，感谢 dacracot）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T20:11:19.897

在 XML 中，顺序通常并不重要。在这种情况下，`Courses`可能会出现`Students`。您解析 XML，然后对整个数据进行查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:13:18.830

XML 绝对不是关系数据的友好场所。

如果您绝对需要这样做，那么我会推荐一种时髦的倒置逻辑。

在您的示例中，您有学校，它提供许多课程，由许多学生参加。

您的 XML 可能如下所示：

```
<School>
    <Students>
        <Student Name="Jack">
            <EnrolledIn>
                <Course Number="CHEM 102" Description="General Inorganic Chemistry" />
                <Course Number="MATH 103" Description="Trigonometry" />
            </EnrolledIn>
        </Student>
        <Student Name="Jill">
            <EnrolledIn>
                <Course Number="ENGL 101" Description="English I" />
                <Course Number="MATH 103" Description="Trigonometry" />
            </EnrolledIn>
        </Student>
    </Students>
</School> 
```

这显然不是最不重复的方法（它是关系数据！），但它很容易解析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:25:28.507

您还可以使用两个 XML 文件，一个用于课程，另一个用于学生。在执行第二个之前打开并解析第一个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T20:46:40.873

我已经有一段时间了，但我似乎记得在 xml 文件的一个部分中做了一个“事物”的基本集合，并使用模式特性*keyref*和*引用*在另一个中引用它们。[我在这里](http://www.datypic.com/books/defxmlschema/chapter17.html)找到了几个例子。如果这不是您要找的，我深表歉意。

# svn - 如何按日期范围从 Subversion 存储库中获取更改列表？

> ID：141599
> 
> 赞同：56
> 
> 时间：2008-09-26T19:58:52.907
> 
> 标签：svn

我想要的是能够生成一个简单的报告，它是特定日期范围内 svn log 的输出。具体来说，自“昨天”以来的所有变化。

除了对时间戳的 svn 日志输出进行 grep 处理之外，在 Subversion 中是否有一种简单的方法可以实现这一点？

例子：

```
svn -v log -d 2008-9-23:2008-9:24 > report.txt 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-26T20:02:19.933

谷歌第一次点击“svn日志日期范围”：[http ://svn.haxx.se/users/archive-2006-08/0737.shtml](http://svn.haxx.se/users/archive-2006-08/0737.shtml)

> 所以`svn log <url> -r {2008-09-19}:{2008-09-26}`会得到过去一周的所有变化，包括今天。

如果你想为 repo 生成报告，有一个解决方案：[Statsvn](http://statsvn.org/index.html)。

高温高压

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-26T20:04:33.783

您可以使用与使用修订号相同的日期。语法是 {yyyy-mm-dd}。因此，对于 9 月 23 日凌晨 12:00 到 9 月 24 日凌晨 12 点之间的所有更改，请执行以下操作：

```
svn log -v -r {2008-09-23}:{2008-09-24} > report.txt 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-09-10T04:55:21.157

```
svn log -r '{2013-9-23}:{2013-9-24}' 
```

这可能是正确的语法。
需要引用才能获得正确的结果。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T20:09:23.100

你可以这样做：

```
svn log -r{2008-9-23}:{2008-9-24} > report.txt 
```

如果您想获得 xml 格式的输出以“更轻松”地进行后期处理，请`--xml`在前面添加一个。`-r`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-09T11:33:53.480

如果您想查看实际更改的列表（在日志消息之外......如果有的话！;)）， -v 很重要

# linq - LINQ 语法序列

> ID：141602
> 
> 赞同：2
> 
> 时间：2008-09-26T19:59:16.900
> 
> 标签：linq, linq-to-sql

下面的 SQL

```
SELECT * FROM customers 
```

在 LINQ 中转换为此

```
var customers = from c in customers 
                select c; 
```

他们有什么好的理由交换 from 和 select 吗？

我能想到的唯一合乎逻辑的原因是智能感知？为了使智能感知器得到解决，它需要知道它在查询什么（范围）？

换了还有什么其他原因吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T20:05:26.027

Select 被交换，因为它表示 LINQ 查询语法所表示的方法调用的顺序。

这相当于

```
customers.Select(c=>c); 
```

或者

```
customers.Select(); 
```

SQL 通过在继续之前处理整个语句来摆脱它，但是为了获得诸如智能感知之类的东西并确定您的选择是否有效，它必须是最后一步，而不是第一步。

您可能还想查看 FLWOR，它是一种更接近的表示形式，代表*for*、*let*、*where*、*orderby*和*return*。你会注意到*for*，相当于 from ，是第一个；并且*return*，相当于 select ，是最后一个。

SQL，在这里，更多的是异常。在您指定域之前，应该如何知道您在做什么。

# gpl - 通过插件在闭源应用程序中使用 GPL 代码是否合法？

> ID：141605
> 
> 赞同：6
> 
> 时间：2008-09-26T19:59:31.687
> 
> 标签：gpl

考虑以下步骤：

0) 发布开源的Mock Program和Mock Plugin，通过一定的接口（一）进行通信，交换复杂的数据结构，共享内存，相互调用。对其应用全许可许可证。

1) 发布插件，设计用于以接口 (I) 定义的方式与任何程序一起工作。该插件使用第三方 GPL 覆盖的代码，GPL 本身也是如此。它最初是使用模拟程序开发和测试的。它作为任何 GPL 程序分发，并提供源代码。

2) 发布闭源专有程序，旨在以接口 (I) 定义的方式与任何插件进行通信。它最初是与 Mock Plugin 一起开发、测试和交付的。

3.1) 将安装脚本添加到下载 GPL 插件并将其附加到已安装程序的程序中。

3.2) 代替安装脚本添加说明如何手动下载和附加 GPL 插件。

因此最终用户获得了专有程序，该程序受益于插件中的 GPL 覆盖代码。

问题：

0）如果它是合法的，那么在开发人员相当小的努力下，在任何专有程序中获得任何 GPL 涵盖的代码，这难道不是一种合法的方式吗？

1）如果它不合法，那么 GPLv* 的哪一部分或任何东西阻止谁执行哪一步？

2) 3.1 和 3.2 之间有什么法律区别吗？

3）Mock Program和Plugin、专有程序和GPL Plugin是由一个人开发还是不同人开发，是否有法律上的区别？有意还是无意？

4）你的意见是什么——它是否足够合乎道德？

5) 有没有这种策略的现有样本？

6) 是否有任何更简单的合法方法来实现相同的结果 - 发布可能并且最有可能从 GPL 代码中受益的专有程序？

**更新：**

> 从字面上看，这意味着为闭源程序编写插件并在 GPL 下发布会导致该组合成为插件的扩展，因此属于 GPL，涵盖了整个闭源程序也

但是这种组合不是分布式的，它是在最终用户机器上组合的。就像我自己对 Linux 的修改一样，在我发布它之前我不必开源。在这种情况下，最终用户设法在没有访问程序源的情况下进行了修改——对他有好处，但到目前为止我没有看到任何非法行为。

> 为了使用 GPL 覆盖的插件，主程序必须在 GPL 下发布

我看到了 GPL 常见问题的那部分。但是插件可以独立开发并与 MockProram 一起提供。最终用户可以从 MockProgram 中获取插件并将其放入专有程序中。在最后一步之前，GPL 和封闭源代码是分开的。该步骤由最终用户完成，他没有义务，因为他不分发组合产品。

**更新 2**

这

> 如果法院发现其中一个是专门为要求另一个而设计的，那么您可能会遇到麻烦。模拟程序和模拟插件的性质也可能发挥作用，至于它们是“真正的”程序还是傀儡。咨询律师。

看起来像是问题 3 的答案。谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T09:55:59.450

这绝对是不道德的。当我选择 GPL 而不是 BSD 时，我的意图很明确 - 如果您从我的代码中受益，那么您应该回馈。很清楚我希望您如何回馈 - 通过提供对使用我的代码的 COMPLETE 系统的完全访问权限。GPL 的核心目的是让其他人能够对这样的系统进行修改并从中构建其他东西。

步骤 3.1/3.2 存在社会学问题。当他的系统停止工作时，用户会问谁？尤其是GPL插件的问题，GPL插件作者会支持这样的用户吗？GPL 插件开发者会招待不道德的闭源应用程序开发者吗？

鉴于上述情况，没有人会以足够大的规模尝试您的问题 4、5 和 6 以引起注意。此外，如果您正在编写从中赚很多钱的商业应用程序，那么您通常可以以一定的价格从版权所有者那里许可该 GPL 代码在您的项目中使用。

回答问题 3，如果您是 GPL 代码的唯一作者，那么您对该代码拥有完全的版权。你可以用它做任何你想做的事情，包括在非 GPL 项目中使用它，即使你已经在 GPL 下发布它供其他人使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T20:03:45.937

这不是技术问题，而是法律问题。请咨询在您所在地区获得执业许可的律师。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-26T20:04:19.133

> 如果程序动态链接插件，它们之间进行函数调用并共享数据结构，我们认为它们形成了一个单独的程序，必须将其视为主程序和插件的扩展。为了使用 GPL 涵盖的插件，主程序必须在 GPL 或与 GPL 兼容的自由软件许可下发布，并且在分发主程序以与这些插件一起使用时必须遵守 GPL 的条款插件。

[来源](http://www.gnu.org/licenses/gpl-faq.html#NFUseGPLPlugins)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T20:23:16.140

> 目标代码形式的作品的“对应源代码”是指生成、安装和（对于可执行作品）运行目标代码和修改作品所需的所有源代码，包括控制这些活动的脚本。但是，它不包括作品的系统库，或通用工具或普遍可用的免费程序，这些程序未经修改用于执行这些活动，但不属于作品的一部分。例如，对应源包括与工作源文件关联的接口定义文件，以及**工作专门设计需要的共享库和动态链接子程序**的源代码，例如通过这些子程序之间的密切数据通信或控制流和工作的其他部分。

如果法院发现其中一个是专门为要求另一个而设计的，那么您可能会遇到麻烦。模拟程序和模拟插件的性质也可能发挥作用，至于它们是“真正的”程序还是傀儡。咨询律师。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:58:39.097

我认为如果您实际上不链接程序，您也许可以做到。让它们成为单独的进程，并通过套接字或命名管道或类似方式进行通信。

但实际上，我同意第一张海报。如果您打算在非 GPL 项目中使用 GPL 代码，有几个不错的选择：

1.  咨询精通此类问题的律师
2.  将代码作为 GPL 发布到您的整个项目中
3.  不要在该地方使用 GPL 代码
4.  联系 GPL 代码的作者，向他们提供补偿以换取对您使用其代码的自由限制较少的许可证。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T11:48:04.680

[我在这里](https://stackoverflow.com/questions/629040/supporting-gpl-based-plugins)问了一个非常相似的问题，但从我希望从一开始就将原始产品开源的起点，这仍然让我有能力在以后出售它。

我并不是说 GPL 是正确的——有些领域我真的不同意（有些我真的不明白！），但至少这是朝着正确方向迈出的一步。

我认为这真的归结为一个问题：-

*   您的软件是否*需要*GPL 代码才能运行。

如果答案是肯定的，那么接受它并继续前进。如果答案是否定的（就我而言），那么到目前为止的共识是我不必担心 GPL。

# javascript - 如何从搜索引擎隐藏 HTML 文件中的内容？

> ID：141606
> 
> 赞同：3
> 
> 时间：2008-09-26T19:59:35.183
> 
> 标签：javascript, search-engine

假设我写了一篇关于某个主题的文章或文档，但内容是为对该主题有一定先验知识的读者准备的。为了帮助那些没有“必需”背景信息的人，我想在页面顶部添加一个注释，其中包含解释，可能还有一些参考资料的链接。

这是一个例子：

> **用世界上最好的产品创造世界和平**
> 
> *注意：本文假设您已经熟悉 The Best Product in the World。要了解更多关于世界上最好的产品的信息，请访问官方网站。*
> 
> 世界上最好的产品...

现在，我不希望该便笺出现在~~Google~~搜索引擎结果中，只显示该便笺的标题和内容。有什么办法可以做到这一点？

此外，是否可以在不直接控制整个 HTML 文件和/或 HTTP 响应的情况下执行此操作，即在由第三方托管的博客（如[Wordpress.com](http://www.wordpress.com) ）上？

**更新**

不幸的是，JavaScript 解决方案和 HTML 元标记方法都不适用于托管的 Wordpress.com 博客，因为它们不允许在帖子中使用 JavaScript，并且它们不提供直接编辑 HTML 元标记的访问权限。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T20:01:19.017

您可以使用 Javascript 动态构建该部分内容。

例如：

```
<html>
<body>
  <div id="dynContent">
  </div>
   Rest of the content here.
</body>
<script language='javascript' type='text/javascript'>
  var dyn = document.getElementById('dynContent');
  dyn.innerHTML = "Put the dynamic content here";
</script>
</html> 
```

如果你真的被卡住了，你可以去老学校，参考一张包含你的文字的图片。不过，它并不是特别“易于访问”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T20:01:15.677

Javascript。如果您使用 javascript 将您的内容添加到网站，则搜索引擎不会获取该内容。这甚至是合适的，因为您是在增强网站，而不是提供额外的内容。执行此操作的任何其他方法都会将内容粘贴到页面中。即使您使用样式隐藏它，它仍然会在文本中。根据您的页面结构，这可能无论如何都是不可能的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T21:54:50.163

如果您可以使用 iframe，则将内容放在静态 html 页面上，并在其头部使用元标记来告诉搜索引擎忽略它。由于它是一个单独的页面，谷歌等应该忽略它。

元标记：

```
<meta name="robots" content="noindex, nofollow"> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:33:18.597

您可以尝试通过提供[元描述标签](http://en.wikipedia.org/wiki/Meta_tag#The_description_attribute)来改进搜索结果页面上显示的文本。但是，搜索引擎有权显示它选择的任何内容，这不一定是页面上的前“n”个单词。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T20:00:47.723

我刚开始想到一件事。我想我可以在页面加载后使用 JavaScript 呈现注释？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:01:43.553

嗯......也许你可以创建一个 <div> 与 position: absolute; z-index：99（应该大于1）；顶部：0px；- 这应该将注释放在页面顶部，但您可以将实际代码放在底部附近......搜索引擎线性地通过源而不是我假设的位置。

编辑：如果您决定将其放置在其他地方，这是失败的，因为这是一个绝对位置——它只会崩溃.. :\。使用 javascript

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:05:45.497

任何隐藏内容的尝试都会对可访问性和兼容性产生副作用。似乎您要做的只是控制搜索引擎显示的片段，在这种情况下，[您最好提供适当的元元素描述](http://googlewebmastercentral.blogspot.com/2007/09/improve-snippets-with-meta-description.html)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T20:37:26.043

我熟悉 WordPress.com 的工作原理，但是如果您可以在您的博客上添加 Digg、Delicious 徽章作为第三方添加的东西……那么您可能有机会使用这些徽章使用的相同技巧，他们在您的页面中注入动态内容，您可以了解他们是如何做的，并对您的自定义内容做同样的事情

# java - 在 JSP 中迭代枚举常量

> ID：141611
> 
> 赞同：14
> 
> 时间：2008-09-26T20:00:18.923
> 
> 标签：java, jsp, enums, scriptlet

我有一个这样的枚举

```
package com.example;

public enum CoverageEnum {

    COUNTRY,
    REGIONAL,
    COUNTY
} 
```

我想在不使用 scriptlet 代码的情况下在 JSP 中迭代这些常量。我知道我可以用这样的脚本代码来做到这一点：

```
<c:forEach var="type" items="<%= com.example.CoverageEnum.values() %>">
    ${type}
</c:forEach> 
```

但是我可以在没有 scriptlet 的情况下实现同样的目标吗？

干杯，唐

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-10-04T17:09:28.467

如果您使用的是 Spring MVC，则可以通过以下语法祝福来实现您的目标：

```
 <form:form method="post" modelAttribute="cluster" cssClass="form" enctype="multipart/form-data">
   <form:label path="clusterType">Cluster Type
      <form:errors path="clusterType" cssClass="error" />
   </form:label>
   <form:select items="${clusterTypes}" var="type" path="clusterType"/>
 </form:form> 
```

您的模型属性（即要填充的 bean/数据实体）被命名为 cluster，并且您已经使用名为 clusterTypes 的值的枚举数组填充了模型。这`<form:error>`部分是非常可选的。

在 Spring MVC 领域，您还可以`clusterTypes`像这样自动填充到您的模型中

```
@ModelAttribute("clusterTypes")
public MyClusterType[] populateClusterTypes() {
    return MyClusterType.values();
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T20:10:03.627

如果您使用标签库，您可以将代码封装在 EL 函数中。所以开始标签会变成：

```
<c:forEach var="type" items="${myprefix:getValues()}"> 
```

编辑：为了回应关于适用于多种 Enum 类型的实现的讨论，刚刚概述了这一点：

```
public static <T extends Enum<T>> Enum<T>[] getValues(Class<T> klass) {
    try { 
        Method m = klass.getMethod("values", null);
        Object obj = m.invoke(null, null);
        return (Enum<T>[])obj;
    } catch(Exception ex) {
        //shouldn't happen...
        return null;
    }
} 
```

# ruby-on-rails - 跟踪更改历史的数据库结构

> ID：141612
> 
> 赞同：10
> 
> 时间：2008-09-26T20:00:24.057
> 
> 标签：ruby-on-rails, database-design

我正在将项目管理系统的数据库设计作为个人项目进行，但遇到了障碍。

我想实现一个票证系统，我希望票证看起来像[Trac 中的票证](http://trac.edgewall.org/ticket/6436)。我将使用什么结构来复制这个系统？（我在我的任何系统上安装 trac 都没有成功，所以我真的看不到它在做什么）

注意：我对尝试存储或显示任何版本的票都不感兴趣。我只需要变化的历史。我不想存储额外的数据。此外，我在文本字段中使用序列化数组实现了这样的功能。我不想再将其作为解决方案实施。

**编辑：我只寻找数据库结构。触发器/回调并不是真正的问题。**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-26T20:09:16.877

我使用“瘦”设计实现了纯记录更改数据：

```
RecordID  Table  Column  OldValue  NewValue
--------  -----  ------  --------  -------- 
```

根据您的设计，您可能不想使用“表”和“列”，而是使用“对象”和“属性”等等。

这具有灵活性和简单性的优点，但以查询速度为代价——“表”和“列”列上的聚集索引可以加快查询和过滤器的速度。但是，如果您要经常在线查看表或对象级别的更改日志，您可能需要设计一些更扁平的东西。

**编辑**：有几个人正确地指出，使用此解决方案，您无法将更改集组合在一起。我在上面的表格中忘记了这一点——我使用的实现还有一个“事务”表，其中包含日期时间、用户和其他信息，以及一个“事务 ID”列，所以设计看起来像这样：

```
CHANGE LOG TABLE:
RecordID  Table  Column  OldValue  NewValue  TransactionID
--------  -----  ------  --------  --------  -------------

TRANSACTION LOG TABLE:
TransactionID  UserID  TransactionDate
-------------  ------  --------------- 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T20:05:22.610

你追求这样的数据库机制吗？

```
 CREATE OR REPLACE TRIGGER history$yourTable
        BEFORE UPDATE ON yourTable
        FOR EACH ROW
        BEGIN
            INSERT INTO
                history
            VALUES
                (
                :old.field1,
                :old.field2,
                :old.field3,
                :old.field4,
                :old.field5,
                :old.field6
                );
        END;
    /
    SHOW ERRORS TRIGGER history$yourTable 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T20:35:58.557

我做了这样的事情。我有一个名为 LoggableEntity 的表，其中包含：ID (PK)。

然后我有 EntityLog 表，其中包含有关对可记录实体（记录）所做更改的信息：ID（PK）、EntityID（FK 到 LoggableEntity.ID）、ChangedBy（进行更改的用户名）、ChangedAt（更改发生时的小日期时间）、类型（枚举：创建、删除、更新）、详细信息（包含已更改内容的备注字段 - 可能是带有序列化详细信息的 XML）。

现在，我要跟踪的每个表（实体）都是从 LoggableEntity 表“派生”的——这意味着例如 Customer 对 LoggableEntity 表具有 FK。

现在，每次对客户记录进行更改时，我的 DAL 代码都会负责填充 EntityLog 表。每次当它看到实体类是一个可记录实体时，它就会将新的更改记录添加到实体日志表中。

所以这是我的表结构：

```
+------------------+           +------------------+
| LoggableEntity   |           | EntityLog        |
| ---------------- |           | ---------------- |
| (PK) ID          | <--+      | (PK) ID          |
+------------------+    +----- | (FK) LoggableID  |
        ^                      |      ...         |
        |                      +------------------+
+------------------+
| Customer         |
| ---------------- |
| (PK) ID          |
| (FK) LoggableID  |
|      ...         |
+------------------+ 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T20:11:11.317

至于不存储大量额外数据，我想不出任何好的方法来做到这一点。您必须存储每个修订版才能查看更改。

这是我见过的一种解决方案，尽管我不确定它是否是最好的。有一个主键，说它`id`指向一个特定的版本。也有`ticket_number`和`revision_date`领域。`ticket_number`修改票证时不会更改，而是会`id`更改`revision_date`。然后，根据上下文，您可以使用[groupwise max](http://jan.kneschke.de/projects/mysql/groupwise-max)获取特定修订版或特定票证的最新修订版。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:03:22.023

我会说创建某种事件侦听类，每次系统内发生某些事情时您都会 ping 并在数据库中放置对事件的描述。

它应该存储基本的 who/what/where/when/what 信息。

对该项目事件表进行排序应该可以为您提供所需的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:09:47.827

一种可能的解决方案是将票证的副本与进行更改的用户一起存储在历史表中。

但是，这将存储大量额外数据并需要大量处理来创建 Trac 显示的视图。

# ruby-on-rails - RoR：使用 application.rb 访问模型

> ID：141620
> 
> 赞同：1
> 
> 时间：2008-09-26T20:03:15.783
> 
> 标签：ruby-on-rails, ruby

我正在开发一个简单的 Web 应用程序，它具有用户模型和角色模型（以及其他），以及一个包含许多控制器的管理部分。我想使用 before_filter 来检查会话中用户的用户是否具有“can_access_admin”标志。

我在 application.rb 中有这段代码：

def check_role @user = session[:user]

如果@user.role.can_access_admin.nil？|| !@user.role.can_access_admin render :text => "您当前的角色不允许访问管理区域。" 返回结束结束

然后我在其中一个管理控制器中有此代码：

类 Admin::BlogsController < ApplicationController before_filter :check_role

def list @blogList = Blog.find(:all) end end

当我尝试查看列表操作时，我收到此错误：

用户的未定义方法“角色”...

任何人都知道我必须做什么才能在application.rb中识别角色关联？（请注意，关联配置正确，@user.role 在我尝试使用它的其他任何地方都可以正常工作）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T20:21:25.690

只是一个猜测，但似乎您的 session[:user] 只是存储 id，您需要这样做：

```
@user = User.find(session[:user]) 
```

或类似的东西从数据库中获取用户（连同它的关联）。

在前置过滤器中执行上述操作也很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:22:44.113

session[:user] 持有用户吗？还是user_id？在调用 .role 之前，您可能需要进行查找。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T22:31:25.630

此外，如果您使用 ActsAsAuthenticated 或 RestfulAuthentication 或他们的兄弟，您也可以使用`current_user`他们提供的方法。

# .net - 如何从 WebBrowser.Navigating 事件处理程序访问 PostData？

> ID：141626
> 
> 赞同：5
> 
> 时间：2008-09-26T20:03:46.967
> 
> 标签：.net, browser, postdata

我在 Visual Studio 2008 中有一个使用 .NET 3.5 的 Windows 窗体，上面有一个 WebBrowser 控件。在发送请求之前，我需要在 Navigating 事件处理程序中分析表单的 PostData。有没有办法得到它？

旧的 win32 浏览器控件有一个 Before_Navigate 事件，该事件将 PostData 作为其参数之一。新的 .NET WebBrowser 控件并非如此。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-08-17T08:22:38.057

## C#版本

```
 /// <summary>
    /// Fires before navigation occurs in the given object (on either a window or frameset element).
    /// </summary>
    /// <param name="pDisp">Object that evaluates to the top level or frame WebBrowser object corresponding to the navigation.</param>
    /// <param name="url">String expression that evaluates to the URL to which the browser is navigating.</param>
    /// <param name="Flags">Reserved. Set to zero.</param>
    /// <param name="TargetFrameName">String expression that evaluates to the name of the frame in which the resource will be displayed, or Null if no named frame is targeted for the resource.</param>
    /// <param name="PostData">Data to send to the server if the HTTP POST transaction is being used.</param>
    /// <param name="Headers">Value that specifies the additional HTTP headers to send to the server (HTTP URLs only). The headers can specify such things as the action required of the server, the type of data being passed to the server, or a status code.</param>
    /// <param name="Cancel">Boolean value that the container can set to True to cancel the navigation operation, or to False to allow it to proceed.</param>
    private delegate void BeforeNavigate2(object pDisp, ref dynamic url, ref dynamic Flags, ref dynamic TargetFrameName, ref dynamic PostData, ref dynamic Headers, ref bool Cancel);

    private void Form1_Load(object sender, EventArgs e)
    {
        dynamic d = webBrowser1.ActiveXInstance;

        d.BeforeNavigate2 += new BeforeNavigate2((object pDisp,
            ref dynamic url,
            ref dynamic Flags,
            ref dynamic TargetFrameName,
            ref dynamic PostData,
            ref dynamic Headers,
            ref bool Cancel) => {

            // Do something with PostData
        });
    } 
```

## C# WPF 版本

保留上述内容，但替换：

```
 dynamic d = webBrowser1.ActiveXInstance; 
```

和：

```
 using System.Reflection;
    ...
    PropertyInfo prop = typeof(System.Windows.Controls.WebBrowser).GetProperty("ActiveXInstance", BindingFlags.NonPublic | BindingFlags.Instance);
    MethodInfo getter = prop.GetGetMethod(true);
    dynamic d = getter.Invoke(webBrowser1, null); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-27T20:03:47.737

.NET WebBrowser 控件不公开该功能。幸运的是，该控件主要是“旧”控件的包装。这意味着您可以使用以下内容订阅您知道和喜爱的 BeforeNavigate2 事件（？）（在您的项目中添加对 SHDocVw 的引用之后）：

```
Dim ie = DirectCast(WebBrowser1.ActiveXInstance, SHDocVw.InternetExplorer)
AddHandler ie.BeforeNavigate2, AddressOf WebBrowser_BeforeNavigate2 
```

...并为该事件中的 PostData 做任何你想做的事情：

```
Private Sub WebBrowser_BeforeNavigate2(ByVal pDisp As Object, ByRef URL As Object, _
       ByRef Flags As Object, ByRef TargetFrameName As Object, _
       ByRef PostData As Object, ByRef Headers As Object, ByRef Cancel As Boolean)
    Dim PostDataText = System.Text.Encoding.ASCII.GetString(PostData)
End Sub 
```

一个重要的警告：[WebBrowser.ActiveXInstance 属性的文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowserbase.activexinstance.aspx)指出“此 API 支持 .NET Framework 基础结构，不打算直接从您的代码中使用。”。换句话说：您对该属性的使用可能会在将来的任何时候破坏您的应用程序，例如当框架人员决定实现自己的浏览器组件时，而不是包装现有的 SHDocVw COM 组件。

因此，您不希望将此代码放在您交付给很多人的任何内容中和/或任何应该为未来的许多框架版本继续工作的内容中......

# drag-and-drop - 如何在网页或 C# 中读取原始 (CF_HTML) 剪贴板数据？

> ID：141630
> 
> 赞同：2
> 
> 时间：2008-09-26T20:04:22.143
> 
> 标签：drag-and-drop, clipboard, copy-paste

如果我将所选网页从 Firefox 拖放到 HTML-Kit，HTML-Kit 会询问我是要粘贴为文本还是 HTML。如果我选择“文本”，我会得到：

```
Version:0.9
StartHTML:00000147
EndHTML:00000516
StartFragment:00000181
EndFragment:00000480
SourceURL:http://en.wikipedia.org/wiki/Herodotus
<html><body>
<!--StartFragment-->Additional details have been garnered from the <i><a href="http://en.wikipedia.org/wiki/Suda" title="Suda">Suda</a></i>, an 11th-century encyclopaedia of the <a href="http://en.wikipedia.org/wiki/Byzantium" title="Byzantium">Byzantium</a> which likely took its information from traditional accounts.<!--EndFragment-->
</body>
</html> 
```

[根据 MSDN](https://docs.microsoft.com/en-us/windows/win32/dataxchg/html-clipboard-format)，这是“CF_HTML”格式的剪贴板数据。在 OS X 和 Linux 系统上是否相同？

有没有办法在网页到网页的拖放操作中访问这种详细信息（而不仅仅是纯剪辑片段）？C# WinForms 桌面应用程序怎么样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2019-08-27T16:02:17.797

为了完整起见，这里是获取 RAW 剪贴板数据的 P/Invoke Win32 API 代码

```
using System;
using System.Runtime.InteropServices;
using System.Text;

//--------------------------------------------------------------------------------
http://metadataconsulting.blogspot.com/2019/06/How-to-get-HTML-from-the-Windows-system-clipboard-directly-using-PInvoke-Win32-Native-methods-avoiding-bad-funny-characters.html
//--------------------------------------------------------------------------------

public class ClipboardHelper
{
    #region Win32 Native PInvoke

    [DllImport("User32.dll", SetLastError = true)]
    private static extern uint RegisterClipboardFormat(string lpszFormat);
    //or specifically - private static extern uint RegisterClipboardFormatA(string lpszFormat);

    [DllImport("User32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool IsClipboardFormatAvailable(uint format);

    [DllImport("User32.dll", SetLastError = true)]
    private static extern IntPtr GetClipboardData(uint uFormat);

    [DllImport("User32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool OpenClipboard(IntPtr hWndNewOwner);

    [DllImport("User32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool CloseClipboard();

    [DllImport("Kernel32.dll", SetLastError = true)]
    private static extern IntPtr GlobalLock(IntPtr hMem);

    [DllImport("Kernel32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool GlobalUnlock(IntPtr hMem);

    [DllImport("Kernel32.dll", SetLastError = true)]
    private static extern int GlobalSize(IntPtr hMem);

    #endregion

    public static string GetHTMLWin32Native()
    {

        string strHTMLUTF8 = string.Empty; 
        uint CF_HTML = RegisterClipboardFormatA("HTML Format");
        if (CF_HTML != null || CF_HTML == 0)
                return null;

        if (!IsClipboardFormatAvailable(CF_HTML))
            return null;

        try
        {
            if (!OpenClipboard(IntPtr.Zero))
                return null;

            IntPtr handle = GetClipboardData(CF_HTML);
            if (handle == IntPtr.Zero)
                return null;

            IntPtr pointer = IntPtr.Zero;

            try
            {
                pointer = GlobalLock(handle);
                if (pointer == IntPtr.Zero)
                    return null;

                uint size = GlobalSize(handle);
                byte[] buff = new byte[size];

                Marshal.Copy(pointer, buff, 0, (int)size);

            strHTMLUTF8 = System.Text.Encoding.UTF8.GetString(buff);
            }
            finally
            {
                if (pointer != IntPtr.Zero)
                    GlobalUnlock(handle);
            }
        }
        finally
        {
            CloseClipboard();
        }

        return strHTMLUTF8; 
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:22:36.920

它是 Microsoft 特定的，不要期望在其他操作系统中看到相同的信息。
请注意，当您从 IE 复制片段时，您会得到相同的格式。

我不确定您所说的“网页到网页拖放操作”是什么意思。往哪里掉？文本区？

我不知道 C#，但在 C/C++ 应用程序中，您必须使用 OpenClipboard 和相关的 Win32 API 来获取此信息。特别是，GetClipboardData(CF_HTML) 允许您获取此信息（也可以以纯文本形式获取，例如，或 Unicode 数据等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:43:33.703

WinForms 应用程序可以使用[Clipboard.GetText](http://msdn.microsoft.com/en-us/library/944ft9kf.aspx)来获取它。但是，我认为没有办法在网页中执行此操作。

# java - 另一个 JPA 问题

> ID：141637
> 
> 赞同：-1
> 
> 时间：2008-09-26T20:05:55.307
> 
> 标签：java, jpa, annotations, java-ee-5

我有这个代码：

```
@PersistenceContext(name="persistence/monkey", unitName="deltaflow-pu")
...
@Stateless
public class GahBean implements GahRemote { 
```

但是当我使用这个时：

```
try{
 InitialContext ic = new InitialContext();
 System.out.println("Pissing me off * " + ic.lookup("java:comp/env/persistent/monkey"));
 Iterator e = ic.getEnvironment().values().iterator();
 while ( e.hasNext() )
     System.out.println("rem - " + e.next());
}catch(Exception a){ a.printStackTrace();} 
```

我得到这个例外：

```
javax.naming.NameNotFoundException: No object bound to name java:comp/env/persistent/monkey 
```

如果我删除查找，迭代器也没有任何接近它的东西。可能是什么问题呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T20:19:27.583

这可能是我对 JPA 展示的无知，但您似乎在某些地方具有“持久性”，而在其他地方则具有“持久性”。我会首先确保名称匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T20:18:37.523

如果我以它可以正常工作的方式注入它，但是在我读到的所有地方，他们都说这样做不是线程安全的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-27T06:16:59.787

查看服务器上是否配置了名称为persistance/monkey的数据源，并查看persistance.xml中的名称是否匹配，名称区分大小写。

# perl - 什么是对非 Perl 开发人员的有效 Perl 培训？

> ID：141641
> 
> 赞同：20
> 
> 时间：2008-09-26T20:06:33.590
> 
> 标签：perl, cpan, timtowtdi

我使用 Perl 的时间已经够长了，以至于它的许多特性已成为我的第二天性。当新程序员加入我们的团队时，他们通常几乎没有 Perl 经验，而我的任务通常是培训他们（在必要的范围内）。我想知道在培训刚接触 Perl 但有其他语言经验的程序员时应该关注什么（这个问题与语言无关，但我合作过的大多数开发人员都来自 Java）。

我想到了几件事：

*   符文的正确使用
*   引用/取消引用
*   使用列表函数，如**map**、 **grep**、**sort**

在帮助程序员过渡到 Perl 时，您发现有什么特别有用的地方吗？您是否强调相同点或不同点，或者两者都同等重要？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-26T21:20:44.737

查看我的书的目录。[学习 Perl](http://www.learning-perl.com)和[中级 Perl](http://www.intermediateperl.com)都旨在教程序员 Perl 语言。我们涵盖了大多数人一直使用的 80% 的 Perl，并通过多年教授 Perl 的经验发展起来。每本书都设计为教程，每章末尾都有练习。我还编写了[Learning Perl Student Workbook](https://rads.stackoverflow.com/amzn/click/com/0596009968)来提供额外的练习。[编程 Perl](http://www.programmingperl.org)也是一个很好的参考。

实际上，要“获得” Perl，您需要了解的规则很少，而且大多数人仅通过查看代码并不能正确理解这些规则。教来自另一种语言的新 Perlers 的一些事情：

*   严格和警告
*   标量与列表上下文
*   动态与词法作用域
*   印记不是变量类型
*   列表创建和操作（map、grep、排序）
*   如何有效地使用 CPAN
*   闭包和子程序作为数据
*   Perl 中的递归很糟糕

祝你好运 ：）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-26T20:29:08.950

我认为 Perl 的“杀手级应用”是[CPAN](http://enwp.org/CPAN) ……</p>

第一次浏览CPAN后的典型语录：

> “你有[什么](http://p3rl.org/Acme::Tie::Eleet)图书馆？”
> “ [Extirpate HTML](http://p3rl.org/HTML::Obliterate)必须是有史以来最好的函数名称！”
> “你可以用 Perl*[总结文本吗？”](http://p3rl.org/Lingua::EN::Summarize)*

一旦程序员看到做困难的事情是多么容易，他们就会被卖掉。

然后你可以给他们看[perldoc](http://p3rl.org/perldoc)和[Camel](https://socialtext.net/perl5/programming_perl)。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-27T13:00:40.143

我拥有并管理[Perl Training Australia](http://perltraining.com.au/)。我教 Perl 大约八年，教计算机科学十多年。我不仅对 Perl 有强烈的看法，而且对教学和总体呈现也有强烈的看法。我已经写了数百页关于 Perl 的文章——我不会在这里重复——所以我要给你的不是关于教 Perl 的建议；而是关于 Perl 的建议。它是元建议。

首先，如果您的时间和预算允许，请考虑让您的员工参加专业的 Perl 培训课程。专门课程的优点是不会出现工作中断，不会出现工作场所政治问题，而且*会*配备非常熟悉人们在学习 Perl 时遇到的困难的人。请确保您有一位了解他们的知识并且是 Perl 社区的活跃成员的培训师；这意味着他们应该能够回答向他们提出的任何问题，或者将提问者引导至适当的参考资料，以便他们了解更多信息。是的，我经营 Perl 培训业务，所以我在这里很固执己见。

如果由于某种原因您不能参加专门的课程，那么请买一本专门设计用来教人们如何使用 Perl 编程的书，然后逐步完成。很容易错过一些东西，或者尝试以错误的顺序介绍东西，或者（天堂禁止）教坏习惯，所有这些都会让你的生活变得困难。编写旨在教授 Perl 的书籍的人通常与成功开展 Perl 培训业务的人相同。如果你想买一本书，我推荐最新版本的*Learning Perl*。如果您想下载一本书，我建议您从[Perl Training Australia 网站获取](http://perltraining.com.au/notes.html)*Programming Perl*课程笔记。

这两本书都附有练习，这让我想到了我的最后一条元建议。确保任何正在学习 Perl的人都*做这些练习*。学习任何新技能时，很容易*认为*自己知道发生了什么，但发现将事情付诸实践时，它比看起来更难。Perl 尤其如此，其中可以应用诸如“上下文”之类的编程概念，这在其他语言中很少见。通常这些练习是专门为教授某种技能或突出某个陷阱而设计的；在学习过程中弄清楚这些事情比在项目截止日期前夕弄清楚要容易得多。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-26T20:36:59.150

我首先告诉他们要始终使用魔法咒语：

```
use strict;
use warnings; 
```

他们不需要知道为什么（还）。

接下来，我将向他们介绍 perldoc 并向他们展示使用它的基础知识（-f 和 -q 标志、perldoc perl 和 perldoc perltoc 等）。当他们有问题时，他们需要知道去哪里寻找。

我会谈论标量与列表上下文。

我将向他们介绍基本数据类型（标量、数组和散列）以及符号如何遵循上下文，而不是数据类型！

介绍`$_`和`@_`。理解这一点至关重要，`$_`因为它在很多地方都使用过，而且通常是隐含的。`@_`是编写子程序必不可少的。其他标点符号变量的使用频率要低得多，可以等待。

向他们介绍正则表达式并让他们习惯正则表达式是 Perl 中的一流对象的想法。

我将简要地向他们展示 Perl 的“对角线”语法。一旦你使用它们，像这样的习语`next unless /foo/`就很棒，但当来自其他语言时，特别是“正交”语言，它们看起来很陌生。

您无需立即谈论参考。让它等到他们准备好做需要数据结构的事情。函数`map`也`grep`可以等待。

在基础上打下坚实的基础。让他们先一步，然后混合更高级的功能和习语。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-26T20:23:44.673

您可以向他们展示的最重要的事情是如何访问文档以及如何找到它（`perldoc perltoc`,`perldoc -q $keyword`等`perldoc -f $function`）。

Perl 附带了很好的文档，包括参考和教程式的材料。让新来者可以使用它是您可以为他们做的最有效的事情。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-26T21:17:18.443

另一个令人惊讶的方面是上下文。函数甚至变量的行为取决于它们是在列表还是标量（或 void）上下文中引用，这一事实对于 Perl 学员来说是一个重要的细节。

我通常坚持使用“更高级别”的内置函数（map、grep、splice、split）。由于 TMTOWTDI，许多程序员只记得 Perl 更熟悉的方面（如 C 风格的循环、substr 和索引）并专门使用这些方面。

在他们熟悉该语言之后，[中级 Perl](http://oreilly.com/catalog/9780596102067/)和[高级 Perl 编程](http://oreilly.com/catalog/advperl/excerpt/ch01.html)可以让他们进一步了解 Perl 的世界

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-26T20:13:44.227

可能不完全是您正在寻找的东西。提前道歉。

除非确实有必要，否则我不会指出相似之处。
Perl 在它自己的世界里工作。如果你愿意，你可以用 Java 风格编写 Perl，但有什么意义呢？

我从 Perl（和我的 Perl 导师）那里学到的最重要的一课是“有不止一种方法可以做到”。所以我认为学习 Perl 的最好方法是接受它对编程的态度，并在每个程序员找到自己的方式时支持他或她。

您正在制作的示例、列出函数等，都是使用时自然而然的东西——只有在您掌握了 Perl 的“事物方式”后，您才能理解它们的强大功能。

只是我的两分钱。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-26T20:41:18.467

坦率地说，我只是给他们骆驼。这是一本易读且有趣的书，它们很快就会启动并运行。我仍然在嘲笑“Perl 认为真理是不言而喻的”，而且距离我第一次阅读它已经有十年了。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-26T20:13:09.533

我是一名 Java 程序员，最近不得不学习 Perl。我发现最难习惯的部分是所有特殊的内置变量，如 $_ $~ $' 等等。在您习惯它们之前，很难跟踪哪个人做了什么。

当然，还有正则表达式的使用。

例如，我必须维护代码，当我第一次看到下面的行时，有点混乱。作为一个 java 程序员，它看起来像胡言乱语。

```
next unless "$_" !~ /^#/; 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-26T21:24:05.587

我只能补充一点，来自表达力较差的语言的人可能不理解哈希表达式或哈希和数组切片表达式。如今，似乎每种语言都有一个 PCRE 库。

哦，再加上莫里茨的想法，我就这一点对我的同事进行了辅导。

另外，我包括了一些关于 Data::Dumper、Scalar::Util、List::Util 和一些非常有用的模块的说明。

为什么不这样做呢，请查看 Damian 的[*Perl 最佳实践*](http://oreilly.com/catalog/9780596001735/)并获得一些更强大的建议。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-26T20:18:05.963

我会选择各种引用运算符（来自 perlop）：

```
 Customary  Generic        Meaning        Interpolates
           ''       q{}          Literal             no
           ""      qq{}          Literal             yes
           ``      qx{}          Command             yes*
                   qw{}         Word list            no
           //       m{}       Pattern match          yes*
                   qr{}          Pattern             yes*
                    s{}{}      Substitution          yes*
                   tr{}{}    Transliteration         no (but see below)
           <<EOF                 here-doc            yes*

           * unless the delimiter is ''. 
```

该列表可能会让人不知所措（尤其是当您添加备用分隔符时），但非常有用。它在阅读代码时也很有帮助，因为很少（如果有的话！）语言具有 Perl 所具有的各种引号。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-26T20:33:55.177

这是一个细节，不是对您问题的完整答案，但对我来说，真正转向 Perl 的人的标志是替换这个成语的人：

```
for (my $i = 0; $i < @a; $i++)
{
  &do_something_with($array[$i]);
} 
```

用这个成语：

```
foreach my $a (@array)
{
  &do_something_with($a);
} 
```

教他们将列表作为列表，而不仅仅是作为数组。教授令人敬畏的数据结构。教列表、散列、散列列表、列表散列、散列散列。与大多数传统的强类型语言相比，这就是最大的进步。（具有讽刺意味的是，在我今年加入的 Java 商店中，我们使用大量任意深度的嵌套 HashMap 结构。事实上，太多了；我是主张少做一点的人！但在 Perl 中，这类事情至关重要。）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-26T20:48:44.567

只是开玩笑，但无论你做什么，最后都展示这样的[东西](http://www.ecclestoad.co.uk/blog/2005/06/02/sudoku_solver_in_three_lines_explained.html)！;)

```
use integer;@A=split//,<>;sub R{for$i(0..80){next if$A[$i];my%t=map{$_/9
==$i/9||$_%9==$i%9||$_/27==$i/27&&$_%9/3==$i%9/3?$A[$_]:0=>1}0..80;R($A[
$i]=$_)for grep{!$t{$_}}1..9;return$A[$i]=0}die@A}R 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-02T20:35:11.443

正如其他人所说：

```
use strict;
use warnings; 
```

也许

```
use diagnostics; 
```

对于 Java 程序员：

```
use autodie; #or Fatal 
```

English.pm
Moose/Mouse
Perl::Critic
perltidy

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-02T20:45:16.270

我刚刚被雇用到这个确切的场景中。我是一名 C++ 和 Java 开发人员，在我目前的工作之前从未接触过 Perl。也需要一些时间才能使用的东西是特殊的 Perl 语法选择 [$_]、$this = that unless ... 以及只见树木不见森林（任何包含 /^#+\d/ 元素的东西）。其他事情只是我工作的编程公司的结果[混淆了 OO 语句、$self 和把 1; 在模块文件的末尾]。

现在我在这里已经有一段时间了，即使在我的非工作项目中，我也看到了 Perl 赋予我的风格元素。您以不同的方式处理任务，尤其是数据按摩，感觉就像是我工具箱中真正可靠的工具。

尽管如此，我得到了一个大约 35,000 行的代码库，这是一本骆驼书，并告诉我不能使用 CPAN。这是富有成效的六个月。^^

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-08T07:45:31.443

[Programming Perl](http://oreilly.com/catalog/9780596000271/ "骆驼书")（由[#22483](https://stackoverflow.com/users/22483/randal-schwartz)合着——Randal 干得好，我的已经用了将近 10 年了）是 Perl 的一个很好的介绍。从正则表达式、切片和切块数组、关联数组等开始。再加上在 Perl 中报告的原因和方法以及函数参考。

我不确定它在第三版中有多少变化，但我会以此为基础开设一门课程并将其用作教科书。它相当简洁且切中要害。另外，您的课程与您的文档相匹配。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-25T22:37:33.683

根据我在工作场所的经验，我建议从 Perl 的文档开始（这里已经介绍过），然后花一些时间向学生展示如何在命令行上测试代码。真令人惊讶，当人们可以快速尝试某件事并进行更正直到正确为止时，他们能如此迅速地掌握一门语言。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-26T20:27:13.180

对于 C++/Java/C# 编码器，我预先非常强调的两个区别是：

第 1 点：在 Perl 中，几乎所有事物都有其含义，只是并不总是您想要的。很好的例子包括：

*   没有符号的变量名不会停止执行 - 它们被解释为裸词
*   尝试将数组存储在标量中，然后得到长度
*   尝试将哈希存储在标量中，您会得到“a/b”（正在使用的存储桶与总存储桶？）

第 2 点：在 Perl 中，您可以随心所欲地弥补。在其他作品中，您可以说*“在哈希 'w' 中，键 'x' 索引一个匿名数组，其中框 'y' 包含 'z'”*，并且解释器将在您进行时为您创建和调整所有变量的大小。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-02-27T12:56:33.317

行。当然你需要在某些时候使用 strict 。并且确定您想在某些时候使用库。但是 strict 只是 Perl 的基本启动文件魔法，每种语言都有库。我不认为这些是刚开始学习时非常重要的东西。

当您开始使用 Perl，但已经了解其他语言时，您需要了解一些疯狂的特质，例如 $a 和 $b 是特殊的变量，能够使用 -1 进行索引等。

回想起来，我真的很喜欢我学习 Perl 的方式：通过玩 Perl Golf。

通过将一种语言使用到如此极端，你强迫自己找出它所有疯狂的部分，你真的需要理解不同的结构。特别是如果您与一群朋友/同事/...一起做这件事，这真的很好。

（当然这不应该是唯一的培训；）但我真的相信它在某些时候效果很好）

# python - 与语言 X 闭包相比，Python 中的闭包有哪些限制？

> ID：141642
> 
> 赞同：48
> 
> 时间：2008-09-26T20:06:41.937
> 
> 标签：python, closures

其中 X 是任何支持某种闭包风格的编程语言（C#、Javascript、Lisp、Perl、Ruby、Scheme 等）。

[在 Python](http://ivan.truemesh.com/archives/000411.html)中的闭包中提到了一些限制（与 Ruby 的闭包相比），但这篇文章已经过时，现代 Python 中不再存在许多限制。

查看具体限制的代码示例会很棒。

**相关问题**：

*   [你能解释一下闭包（因为它们与 Python 有关）吗？](https://stackoverflow.com/questions/13857/can-you-explain-closures-as-they-relate-to-python)
*   [什么是“关闭”？](https://stackoverflow.com/questions/36636/what-is-a-closure)
*   [javascript 闭包是如何工作的？](https://stackoverflow.com/questions/111102/how-does-a-javascript-closure-work)

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-26T20:19:27.833

目前，最重要的限制是您不能分配给外部范围变量。换句话说，闭包是只读的：

```
>>> def outer(x): 
...     def inner_reads():
...         # Will return outer's 'x'.
...         return x
...     def inner_writes(y):
...         # Will assign to a local 'x', not the outer 'x'
...         x = y
...     def inner_error(y):
...         # Will produce an error: 'x' is local because of the assignment,
...         # but we use it before it is assigned to.
...         tmp = x
...         x = y
...         return tmp
...     return inner_reads, inner_writes, inner_error
... 
>>> inner_reads, inner_writes, inner_error = outer(5)
>>> inner_reads()
5
>>> inner_writes(10)
>>> inner_reads()
5
>>> inner_error(10)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 11, in inner_error
UnboundLocalError: local variable 'x' referenced before assignment 
```

除非另有声明，否则在本地范围（函数）中分配的名称始终是本地的。虽然有一个“全局”声明来声明一个全局变量，即使它被分配给它，但对于封闭的变量，还没有这样的声明。在 Python 3.0 中，有（将有）'nonlocal' 声明可以做到这一点。

同时，您可以通过使用可变容器类型来解决此限制：

```
>>> def outer(x):
...     x = [x]
...     def inner_reads():
...         # Will return outer's x's first (and only) element.
...         return x[0]
...     def inner_writes(y):
...         # Will look up outer's x, then mutate it.      
...         x[0] = y
...     def inner_error(y):
...         # Will now work, because 'x' is not assigned to, just referenced.
...         tmp = x[0]
...         x[0] = y
...         return tmp
...     return inner_reads, inner_writes, inner_error
... 
>>> inner_reads, inner_writes, inner_error = outer(5)
>>> inner_reads()
5
>>> inner_writes(10)
>>> inner_reads()
10
>>> inner_error(15)
10
>>> inner_reads()
15 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T20:11:53.437

我看到人们在使用 Python 时遇到的唯一困难是当他们尝试将变量重新分配等非功能性特性与闭包混合使用时，当这不起作用时会感到惊讶：

```
def outer ():
    x = 1
    def inner ():
        print x
        x = 2
    return inner
outer () () 
```

通常只是指出一个函数有它自己的局部变量就足以阻止这种愚蠢。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-08-09T00:05:36.070

与 Javascript 闭包相比，Python 闭包的一个限制（或“限制”）是它**不能**用于有效的**数据隐藏**

### Javascript

```
var mksecretmaker = function(){
    var secrets = [];
    var mksecret = function() {
        secrets.push(Math.random())
    }
    return mksecret
}
var secretmaker = mksecretmaker();
secretmaker(); secretmaker()
// privately generated secret number list
// is practically inaccessible 
```

### Python

```
import random
def mksecretmaker():
    secrets = []
    def mksecret():
        secrets.append(random.random())
    return mksecret

secretmaker = mksecretmaker()
secretmaker(); secretmaker()
# "secrets" are easily accessible,
# it's difficult to hide something in Python:
secretmaker.__closure__[0].cell_contents # -> e.g. [0.680752847190161, 0.9068475951742101] 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-26T20:29:21.023

[`nonlocal`](https://docs.python.org/3/reference/simple_stmts.html?#nonlocal)通过以下语句在 Python 3 中修复：

> 该`nonlocal`语句导致列出的标识符引用最近的封闭范围内的先前绑定的变量，不包括全局变量。这很重要，因为绑定的默认行为是首先搜索本地命名空间。该语句允许封装代码重新绑定全局（模块）范围之外的局部范围之外的变量。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T20:25:13.530

@约翰米利金

```
def outer():
    x = 1 # local to `outer()`

    def inner():
        x = 2     # local to `inner()`
        print(x)
        x = 3
        return x

    def inner2():
        nonlocal x
        print(x)  # local to `outer()`
        x = 4     # change `x`, it is not local to `inner2()`
        return x

    x = 5         # local to `outer()`
    return (inner, inner2)

for inner in outer():
    print(inner()) 

# -> 2 3 5 4 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T20:47:39.980

[评论[@Kevin Little 的答案](https://stackoverflow.com/a/141767/4279)以包含代码示例]

`nonlocal`在 python3.0 上没有完全解决这个问题：

```
x = 0 # global x
def outer():
    x = 1 # local to `outer`
    def inner():
        global x
        x = 2 # change global
        print(x) 
        x = 3 # change global
        return x
    def inner2():
##        nonlocal x # can't use `nonlocal` here
        print(x)     # prints global
##        x = 4      # can't change `x` here
        return x
    x = 5
    return (inner, inner2)

for inner in outer():
    print(inner())
# -> 2 3 3 3 
```

另一方面：

```
x = 0
def outer():
    x = 1 # local to `outer`
    def inner():
##        global x
        x = 2
        print(x) # local to `inner` 
        x = 3 
        return x
    def inner2():
        nonlocal x
        print(x)
        x = 4  # local to `outer`
        return x
    x = 5
    return (inner, inner2)

for inner in outer():
    print(inner())
# -> 2 3 5 4 
```

它适用于python3.1-3.3

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-06-12T21:33:32.043

在 3.0 之前，更好的解决方法是将变量作为默认参数包含在封闭的函数定义中：

```
定义 f()
    x = 5
    定义 g(y, z, x=x):
        x = x + 1

```

# python - Python中手机的Socket编程

> ID：141647
> 
> 赞同：1
> 
> 时间：2008-09-26T20:07:55.943
> 
> 标签：python, sockets, mobile

我已经编写了通过 TCP 套接字在我的手机和计算机之间进行通信的代码。当我在交互式控制台中逐行输入代码时，它工作正常。但是，当我尝试直接通过 filebrowser.py 运行脚本时，它就不起作用了。我正在使用诺基亚 N95。无论如何我可以不使用filebrowser.py直接运行这个脚本吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T22:36:02.310

你读过[用 Linux 和 Python 破解手机](http://pramode.net/articles/lfy/mobile/pramode.html)吗？它相当旧，但也许你觉得它有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-18T12:53:33.783

您的交互式 Python shell 中没有“运行脚本”菜单吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-27T02:31:34.880

好吧，这似乎不是一个僵局。它抛出一个错误，说远程服务器拒绝连接。然而，就像我之前说的，如果我在交互式解释器中输入相同的代码，它就可以正常工作。我想知道错误是否是因为脚本是通过 filebrowser.py 运行的？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T23:42:08.767

如果代码在键入时在交互式解释器中工作，但在直接运行时没有，那么我建议查看您的代码是否在套接字上达到死锁，例如两端都在等待来自另一端的数据。在交互式解释器中输入时，每行代码的执行之间存在较长的延迟。

# haskell - 你如何在 Haskell 中创建一个通用的 memoize 函数？

> ID：141650
> 
> 赞同：21
> 
> 时间：2008-09-26T20:08:49.777
> 
> 标签：haskell, monads, memoization

我看过[另一篇关于这个的帖子](https://stackoverflow.com/questions/129877/how-do-i-write-a-generic-memoize-function)，但是在 Haskell 中有没有一种干净的方法呢？

作为第二部分，它也可以在不使函数单子化的情况下完成吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-21T12:20:03.430

hackage 上的包 data-memocombinators 提供了许多可重用的记忆例程。基本思想是：

```
type Memo a = forall r. (a -> r) -> (a -> r) 
```

即它可以记忆来自a的任何功能。然后，该模块提供了一些原语（如`unit :: Memo ()`和`integral :: Memo Int`），以及用于构建更复杂的备忘录表的组合子（如`pair :: Memo a -> Memo b -> Memo (a,b)`和`list :: Memo a -> Memo [a]`）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-11-21T03:27:01.357

您可以使用 unsafePerformIO 修​​改 Jonathan 的解决方案，以创建函数的“纯”记忆版本。

```
import qualified Data.Map as Map
import Data.IORef
import System.IO.Unsafe

memoize :: Ord a => (a -> b) -> (a -> b)
memoize f = unsafePerformIO $ do 
    r <- newIORef Map.empty
    return $ \ x -> unsafePerformIO $ do 
        m <- readIORef r
        case Map.lookup x m of
            Just y  -> return y
            Nothing -> do 
                    let y = f x
                    writeIORef r (Map.insert x y m)
                    return y 
```

这将适用于递归函数：

```
fib :: Int -> Integer
fib 0 = 1
fib 1 = 1
fib n = fib_memo (n-1) + fib_memo (n-2)

fib_memo :: Int -> Integer
fib_memo = memoize fib 
```

虽然这个例子是一个带有一个整数参数的函数，但 memoize 的类型告诉我们，它可以与任何具有可比较类型的函数一起使用。如果您有一个具有多个参数的函数，只需在应用 memoize 之前将它们分组到一个元组中。菲：

```
f :: String -> [Int] -> Float
f ...

f_memo = curry (memoize (uncurry f)) 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-03T21:48:27.673

这主要遵循[http://www.haskell.org/haskellwiki/Memoization](http://www.haskell.org/haskellwiki/Memoization)。

你想要一个类型为 (a -> b) 的函数。如果它不调用自己，那么您可以编写一个简单的包装器来缓存返回值。存储此映射的最佳方式取决于您可以利用的 a 的哪些属性。订购几乎是最低限度的。使用整数，您可以构造一个无限的惰性列表或保存值的树。

```
type Cacher a b = (a -> b) -> a -> b

positive_list_cacher :: Cacher Int b
positive_list_cacher f n = (map f [0..]) !! n 
```

或者

```
integer_list_cacher :: Cacher Int b
integer_list_cacher f n = (map f (interleave [0..] [-1, -2, ..]) !!
    index n where
        index n | n < 0  = 2*abs(n) - 1
        index n | n >= 0 = 2 * n 
```

所以，假设它是递归的。然后你需要它不是调用它自己，而是调用 memoized 版本，所以你把它传入：

```
f_with_memo :: (a -> b) -> a -> b
f_with_memo memoed base = base_answer
f_with_memo memoed arg  = calc (memoed (simpler arg)) 
```

记忆化的版本当然是我们想要定义的。

但是我们可以从创建一个缓存其输入的函数开始：

我们可以通过传入一个创建缓存值的结构的函数来构建一个级别。除了我们需要创建*已经*传入缓存函数的 f 版本。

由于懒惰，这没问题：

```
memoize cacher f = cached where
         cached = cacher (f cached) 
```

那么我们只需要使用它：

```
exposed_f = memoize cacher_for_f f 
```

本文提供了有关如何使用类型类选择函数输入来执行上述操作的提示，而不是选择显式缓存函数。这真的很好——我们可以隐式地将类型 a 和 b 的缓存组合到一个接受 a 和 b 的函数的缓存中，而不是显式地为每个输入类型组合构造一个缓存。

最后一个警告：使用这种惰性技术意味着缓存永远不会缩小，只会增长。如果您改为使用 IO monad，您可以管理它，但明智地使用它取决于使用模式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T22:06:16.237

从更命令的语言直接翻译，我想出了这个。

```
memoize :: Ord a => (a -> IO b) -> IO (a -> IO b)
memoize f =
  do r <- newIORef Map.empty
     return $ \x -> do m <- readIORef r
                       case Map.lookup x m of
                            Just y  -> return y
                            Nothing -> do y <- f x
                                          writeIORef r (Map.insert x y m)
                                          return y 
```

但这在某种程度上并不令人满意。此外，[Data.Map](http://www.haskell.org/ghc/docs/latest/html/libraries/containers/Data-Map.html)将参数限制为[Ord](http://www.haskell.org/ghc/docs/latest/html/libraries/base/Data-Ord.html)的一个实例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T22:03:49.143

如果你的论点是自然数，你可以简单地做：

```
memo f = let values = map f [0..]
     in \n -> values !! n 
```

但是，这并不能真正帮助您解决堆栈溢出问题，并且它不适用于递归调用。[您可以在http://www.haskell.org/haskellwiki/Memoization](http://www.haskell.org/haskellwiki/Memoization)看到一些更高级的解决方案。

# visual-studio - 在 Visual Studio 中查看 Visual SourceSafe 日志

> ID：141659
> 
> 赞同：1
> 
> 时间：2008-09-26T20:10:05.767
> 
> 标签：visual-studio, visual-sourcesafe

有没有办法查看 Visual Studio 2005 Pro 中集成 SourceSafe 的活动日志？我希望能够快速查看任何获取最新版本、签入和签出操作的结果，但我找不到无需打开 VSS 客户端即可获取该信息的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T20:14:20.887

输出窗口（View - Output）回声很多。如果它不够详细，但我不知道如何配置它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:32:14.153

这就是我所缺少的 - 我从未在“输出”窗口中看到“显示输出来自：”设置的 [源代码管理] 选项。十分感谢。

# architecture - Polyglot Programming：使用多种语言构建应用程序是一种好习惯吗？

> ID：141669
> 
> 赞同：10
> 
> 时间：2008-09-26T20:11:45.467
> 
> 标签：architecture, polyglot

我正在考虑构建一个混合了动态语言（python 或 ruby​​）和编译语言的应用程序，并且需要一些帮助来说服自己这是一个好主意。

我的想法是，我可以使用动态语言来快速编写大量代码，然后下降到像 c/c++ 这样的编译语言来实现性能关键代码。

我可以看到这种方法的很多好处：

1.  通过主要使用动态语言进行编码来提高生产力
2.  两种语言的库的可用性

但也有一些缺点：

1.  维护两种语言之间的桥梁
2.  依赖两种语言和语言/库错误而不是一种

这种方法的其他优点/缺点是什么？有人知道这方面的任何资源和/或最佳实践吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-26T20:18:31.173

我认为你的方法非常明智。解决缺点的方法是在决定是否将动态语言用于您的项目之前，提前了解将动态语言与 C 或 C++ 接口是多么容易。

此外，您需要考虑是否希望您的应用程序是跨平台的。与编译语言相比，动态语言可能对平台的依赖性要小得多。这可能是决定应用程序的哪些部分应该用 C 或 C++ 完成的一个因素。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-26T20:54:53.490

我刚刚重新阅读了您的问题-您建议将 C 用于性能关键代码。任何称职的动态语言都有工具可以让您有效地访问本机代码。因此，首先用动态语言编写整个内容。你可能会发现你根本不需要 C。

但如果你这样做了，请拿出一个分析器，仔细选择要优化的东西，然后去做。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T20:29:38.870

Ja, bien sur, mein freund。这确实是不可思议的奇迹。蟒蛇排序。

我当然是在开玩笑。Web 开发人员每天都会这样做，甚至没有注意到：Java、JSP、EL/OGNL、HTML、CSS、Javascript、ant、XML、XSLT...

我认为多语言编程是自然的、强大的、高效的，而且比其他任何东西都酷。当然，它必须以正确的方式使用，以发挥每种语言的最大力量，并且不要混淆团队中的其他人。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T20:15:27.000

是的。许多程序是高级语言（如 Python 或 Ruby）和低级语言（如 C）的混合体。您可以从垃圾收集的 OO 语言中获得编码逻辑的好处，并且仍然可以在紧密的内部循环中手动管理寄存器.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T20:31:50.877

您可能会发现直到以后才需要实现任何对性能至关重要的东西。所以，我会努力反对这些性能关键的重大变化之一的到来，直到你真的确定你需要这样做。

否则只需选择一种根语言，perl 和 ruby​​ 使用 c，因此它们的合并非常简单。您还可以在 Java VM 上运行 python (jython) 或 ruby​​ (jrunby)，这将为您提供 java 作为后端。尽管它可能会带来一些其他问题，因为我不熟悉针对相应语言的这些版本进行开发。

不过，并非所有性能问题都需要您使用低级语言，因此请先尝试用一种语言解决它，然后再快速跳转到另一种语言。

祝你好运，

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T20:35:23.897

我赞成使用最好的工具来完成这项工作。在软件工程的情况下，这意味着是多语言的。你永远不会期望木匠只使用锤子，无论他/她正在建造什么。为什么对我们来说应该不同？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T20:51:47.193

@[佐克曼](https://stackoverflow.com/questions/141669/polyglot-programming-is-building-applications-with-multiple-languages-a-good-pr#141785)

我有使用 Jython 和 JRuby 的经验……更多的是使用 JRuby。

我必须说它们是很棒的平台，你会得到动态语言的巨大好处，加上对 Java 的丰富的 3rd 和 1st 方库支持，加上高度独立于平台的基础编译语言，加上两种语言的垃圾收集（理解这一点很重要）内存管理，但我的阵营是你最好避免它，除非你真的需要它，例如如果你正在做驱动程序或内核级别的东西，或者需要你可以召集的每一盎司性能的东西）。

我只想讲一个简短的轶事。我最近正在构建一个 ruby​​ 脚本来索引 Solr 实例，我需要访问一个 DB2 数据库（我们要索引的数据源）。直接 Ruby 惨遭失败……它具有糟糕的 DB2 支持，需要完整安装 DB2 express 版本……它仍然没有像宣传的那样工作（我在完成安装后无法编译 Ruby 驱动程序）。解决方案是切换到 JRuby 并从 Ruby 端使用 JDBC，使用几个易于安装的 jars（以及比 DB2 安装小得多的文件）。

我绝对强烈建议考虑使用 JRuby 或 Jython，而不是使用 C 作为后端...我发现算法和资源性能通常对应用程序性能的影响比您选择的语言大得多，而且 Java 平台有提供了很多东西（自从人们谴责它比 C/C++ 慢得多的早期以来，它已经走了很长一段路）。除非您正在执行无法通过算法重构的非常繁重的计算密集型事情，否则无论您选择什么，您很可能都不需要使用编译语言。

* * *

PS 在 JRuby 中与 Java 的集成是非常无缝的（无论如何从 JRuby 到 Java 端），所以维护一个桥不是问题。我认为 Jython 是一样的，但我对它的体验要少得多。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-27T00:28:06.487

值得注意的是，Gambit Scheme 和 Chicken（以及其他一些实现）在解释模式下运行，然后可以编译成 C。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-26T20:24:41.393

我认为这是个好主意。

由于大多数（几乎所有？）操作系统都是用 C 或 C++ 编写的，因此每种动态或解释语言都在某种程度上回退到针对低级内容的已编译、优化语言。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-27T01:00:20.637

有些人认为我们程序员必须掌握太多的语言。他们认为添加一种语言是一件坏事。

SQL 中的整个数据访问，HTML/CSS 中的表示似乎是不可逆转的。

XML 有点令人厌烦：有些人试图用 XML 做所有事情，好像 XML 具有使软件变得更好的神奇力量。

此外，由于多种语言，存在相当多的冗余。所有的语言间绑定意味着事情被写了两次，每种语言一次。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T20:38:03.063

这很常见，但请确保您知道为什么要以您的方式构建它。

一个例子是游戏编程。在许多游戏中，对性能至关重要的游戏引擎是用 C 编写的，而关卡脚本等事情是用 Python、Scheme、一种本土语言或其他语言完成的。

这意味着性能极客正在使用他们喜欢的语言工作，这为他们提供了所需的低级控制，而关卡设计人员可以使用更高级别的语言工作，而无需担心管理内存等等。

# sql - 如何使用 INFORMATION_SCHEMA 找到默认约束？

> ID：141682
> 
> 赞同：130
> 
> 时间：2008-09-26T20:13:45.633
> 
> 标签：sql, sql-server, tsql, information-schema

我正在尝试测试是否存在给定的默认约束。我不想使用 sysobjects 表，而是更标准的 INFORMATION_SCHEMA。

我以前用它来检查表和主键约束，但我在任何地方都看不到默认约束。

他们不在那里吗？（我使用的是 MS SQL Server 2000）。

编辑：我正在寻找约束的名称。

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2012-03-15T14:11:48.457

据我了解，默认值约束不是 ISO 标准的一部分，因此它们不会出现在 INFORMATION_SCHEMA 中。INFORMATION_SCHEMA 似乎是此类任务的最佳选择，因为它是跨平台的，但如果信息不可用，则应使用对象目录视图 (sys.*) 而不是 SQL Server 中已弃用的系统表视图2005 年及以后。

以下与@user186476 的答案几乎相同。它返回给定列的默认值约束的名称。（对于非 SQL Server 用户，您需要默认名称才能删除它，如果您自己不命名默认约束，SQL Server 会创建一些疯狂的名称，例如“DF_TableN_Colum_95AFE4B5”。为了更容易更改您将来的架构，始终明确命名您的约束！）

```
-- returns name of a column's default value constraint 
SELECT
    default_constraints.name
FROM 
    sys.all_columns

        INNER JOIN
    sys.tables
        ON all_columns.object_id = tables.object_id

        INNER JOIN 
    sys.schemas
        ON tables.schema_id = schemas.schema_id

        INNER JOIN
    sys.default_constraints
        ON all_columns.default_object_id = default_constraints.object_id

WHERE 
        schemas.name = 'dbo'
    AND tables.name = 'tablename'
    AND all_columns.name = 'columnname' 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-02-12T15:19:41.937

通过指定与默认约束相关的表名和列名，您可以使用以下内容进一步缩小结果范围：

```
select * from sysobjects o 
inner join syscolumns c
on o.id = c.cdefault
inner join sysobjects t
on c.id = t.id
where o.xtype = 'D'
and c.name = 'Column_Name'
and t.name = 'Table_Name' 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-09-27T00:33:52.947

`Information_Schema`视图中似乎没有默认约束名称。

用于`SELECT * FROM sysobjects WHERE xtype = 'D' AND name = @name` 按名称查找默认约束

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-06-13T09:28:27.063

下面的脚本列出了运行它的数据库中用户表的所有默认约束和默认值：

```
SELECT  
        b.name AS TABLE_NAME,
        d.name AS COLUMN_NAME,
        a.name AS CONSTRAINT_NAME,
        c.text AS DEFAULT_VALUE
FROM sys.sysobjects a INNER JOIN
        (SELECT name, id
         FROM sys.sysobjects 
         WHERE xtype = 'U') b on (a.parent_obj = b.id)
                      INNER JOIN sys.syscomments c ON (a.id = c.id)
                      INNER JOIN sys.syscolumns d ON (d.cdefault = a.id)                                          
 WHERE a.xtype = 'D'        
 ORDER BY b.name, a.name 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-09-23T22:14:02.413

如果您想通过列名或表名获取约束，或者您想获取数据库中的所有约束，请查看其他答案。但是，如果您只是在寻找问题的确切内容，即**“测试给定的默认约束是否存在......通过约束的名称”**，那么有一个更简单的方法。

`sysobjects`这是一个完全不使用 the或其他`sys`表的面向未来的答案：

```
IF object_id('DF_CONSTRAINT_NAME', 'D') IS NOT NULL BEGIN
   -- constraint exists, work with it.
END 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-08T15:46:35.037

```
select c.name, col.name from sys.default_constraints c
    inner join sys.columns col on col.default_object_id = c.object_id
    inner join sys.objects o  on o.object_id = c.parent_object_id
    inner join sys.schemas s on s.schema_id = o.schema_id
where s.name = @SchemaName and o.name = @TableName and col.name = @ColumnName 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T20:38:17.133

INFORMATION_SCHEMA.COLUMNS 的 COLUMN_DEFAULT 列是您要查找的内容吗？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-08-23T08:45:38.207

死灵术。
如果您只需要检查是否存在默认约束
（默认约束可能在管理不善的数据库中具有不同的名称），请
使用 INFORMATION_SCHEMA.COLUMNS (column_default)：

```
IF NOT EXISTS(
    SELECT * FROM INFORMATION_SCHEMA.COLUMNS
    WHERE (1=1) 
    AND TABLE_SCHEMA = 'dbo' 
    AND TABLE_NAME = 'T_VWS_PdfBibliothek' 
    AND COLUMN_NAME = 'PB_Text'
    AND COLUMN_DEFAULT IS NOT NULL  
)
BEGIN 
    EXECUTE('ALTER TABLE dbo.T_VWS_PdfBibliothek 
                ADD CONSTRAINT DF_T_VWS_PdfBibliothek_PB_Text DEFAULT (N''image'') FOR PB_Text; 
    '); 
END 
```

如果您只想通过约束名称进行检查：

```
-- Alternative way: 
IF OBJECT_ID('DF_CONSTRAINT_NAME', 'D') IS NOT NULL 
BEGIN
    -- constraint exists, deal with it.
END 
```

最后但同样重要的是，您可以创建一个名为
INFORMATION_SCHEMA.DEFAULT_CONSTRAINTS 的视图：

```
CREATE VIEW INFORMATION_SCHEMA.DEFAULT_CONSTRAINTS 
AS 
SELECT 
     DB_NAME() AS CONSTRAINT_CATALOG 
    ,csch.name AS CONSTRAINT_SCHEMA
    ,dc.name AS CONSTRAINT_NAME 
    ,DB_NAME() AS TABLE_CATALOG 
    ,sch.name AS TABLE_SCHEMA 
    ,syst.name AS TABLE_NAME 
    ,sysc.name AS COLUMN_NAME 
    ,COLUMNPROPERTY(sysc.object_id, sysc.name, 'ordinal') AS ORDINAL_POSITION 
    ,dc.type_desc AS CONSTRAINT_TYPE 
    ,dc.definition AS COLUMN_DEFAULT 

    -- ,dc.create_date 
    -- ,dc.modify_date 
FROM sys.columns AS sysc -- 46918 / 3892 with inner joins + where 
-- FROM sys.all_columns AS sysc -- 55429 / 3892 with inner joins + where 

INNER JOIN sys.tables AS syst 
    ON syst.object_id = sysc.object_id 

INNER JOIN sys.schemas AS sch
    ON sch.schema_id = syst.schema_id 

INNER JOIN sys.default_constraints AS dc 
    ON sysc.default_object_id = dc.object_id

INNER JOIN sys.schemas AS csch
    ON csch.schema_id = dc.schema_id 

WHERE (1=1) 
AND dc.is_ms_shipped = 0 

/*
WHERE (1=1) 
AND sch.name = 'dbo'
AND syst.name = 'tablename'
AND sysc.name = 'columnname'
*/ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-09-28T01:10:11.727

```
WHILE EXISTS( 
    SELECT * FROM  sys.all_columns 
    INNER JOIN sys.tables ST  ON all_columns.object_id = ST.object_id
    INNER JOIN sys.schemas ON ST.schema_id = schemas.schema_id
    INNER JOIN sys.default_constraints ON all_columns.default_object_id = default_constraints.object_id
    WHERE 
    schemas.name = 'dbo'
    AND ST.name = 'MyTable'
)
BEGIN 
DECLARE @SQL NVARCHAR(MAX) = N'';

SET @SQL = (  SELECT TOP 1
     'ALTER TABLE ['+  schemas.name + '].[' + ST.name + '] DROP CONSTRAINT ' + default_constraints.name + ';'
   FROM 
      sys.all_columns

         INNER JOIN
      sys.tables ST
         ON all_columns.object_id = ST.object_id

         INNER JOIN 
      sys.schemas
         ON ST.schema_id = schemas.schema_id

         INNER JOIN
      sys.default_constraints
         ON all_columns.default_object_id = default_constraints.object_id

   WHERE 
         schemas.name = 'dbo'
      AND ST.name = 'MyTable'
      )
   PRINT @SQL
   EXECUTE sp_executesql @SQL 

   --End if Error 
   IF @@ERROR <> 0 
   BREAK
END 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-26T21:26:54.317

我认为它不在 INFORMATION_SCHEMA 中 - 您可能必须使用 sysobjects 或相关的已弃用表/视图。

你会认为在 INFORMATION_SCHEMA.TABLE_CONSTRAINTS 中会有这样的类型，但我没有看到。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T21:55:41.177

可能是因为在其他一些 SQL DBMS 上，“默认约束”并不是真正的约束，您不会在“INFORMATION_SCHEMA.TABLE_CONSTRAINTS”中找到它的名称，所以最好的选择是“INFORMATION_SCHEMA.COLUMNS”，正如其他人已经提到的那样。

（这里是 SQLServer-ignoramus）

当您必须知道“默认约束”的名称时，我能想到的唯一原因是 SQLServer 不支持`"ALTER TABLE xxx ALTER COLUMN yyy SET DEFAULT..."`命令。但是，您已经处于非标准区域，您必须使用特定于产品的方式来获得所需的东西。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-26T21:06:25.953

如何使用 CHECK_CONSTRAINTS 和 CONSTRAINT_COLUMN_USAGE 的组合：

```
 select columns.table_name,columns.column_name,columns.column_default,checks.constraint_name
          from information_schema.columns columns
             inner join information_schema.constraint_column_usage usage on 
                  columns.column_name = usage.column_name and columns.table_name = usage.table_name
             inner join information_schema.check_constraints checks on usage.constraint_name = checks.constraint_name
    where columns.column_default is not null 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-10T09:22:15.963

我正在使用以下脚本来检索所有默认值（sp_binddefaults）和所有默认约束以及以下脚本：

```
SELECT 
    t.name AS TableName, c.name AS ColumnName, SC.COLUMN_DEFAULT AS DefaultValue, dc.name AS DefaultConstraintName
FROM  
    sys.all_columns c
    JOIN sys.tables t ON c.object_id = t.object_id
    JOIN sys.schemas s ON t.schema_id = s.schema_id
    LEFT JOIN sys.default_constraints dc ON c.default_object_id = dc.object_id
    LEFT JOIN INFORMATION_SCHEMA.COLUMNS SC ON (SC.TABLE_NAME = t.name AND SC.COLUMN_NAME = c.name)
WHERE 
    SC.COLUMN_DEFAULT IS NOT NULL
    --WHERE t.name = '' and c.name = '' 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-11-01T11:00:50.747

**对象目录视图**：sys.default_constraints

信息模式视图`INFORMATION_SCHEMA`符合 ANSI，但默认约束不是 ISO 标准的一部分。Microsoft SQL Server 提供系统目录视图以获取有关 SQL Server 对象元数据的信息。

`sys.default_constraints`系统目录视图用于获取有关默认约束的信息。

```
SELECT so.object_id TableName,
       ss.name AS TableSchema,
       cc.name AS Name,
       cc.object_id AS ObjectID,              
       sc.name AS ColumnName,
       cc.parent_column_id AS ColumnID,
       cc.definition AS Defination,
       CONVERT(BIT,
               CASE cc.is_system_named
                   WHEN 1
                   THEN 1
                   ELSE 0
               END) AS IsSystemNamed,
       cc.create_date AS CreationDate,
       cc.modify_date AS LastModifiednDate
FROM sys.default_constraints cc WITH (NOLOCK)
     INNER JOIN sys.objects so WITH (NOLOCK) ON so.object_id = cc.parent_object_id
     LEFT JOIN sys.schemas ss WITH (NOLOCK) ON ss.schema_id = so.schema_id
     LEFT JOIN sys.columns sc WITH (NOLOCK) ON sc.column_id = cc.parent_column_id
                                               AND sc.object_id = cc.parent_object_id
ORDER BY so.name,
         cc.name; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-01-21T19:56:34.887

一种更清洁的方法来做到这一点：

```
SELECT DC.[name]
  FROM [sys].[default_constraints] AS DC
  WHERE DC.[parent_object_id] = OBJECT_ID('[Schema].[TableName]') 
```

# ruby - 使用 merb-auth 进行身份验证后添加闪存

> ID：141683
> 
> 赞同：0
> 
> 时间：2008-09-26T20:13:57.923
> 
> 标签：ruby, merb, merb-auth

使用 merb-auth 切片（除了创建覆盖会话）时，为成功或不成功登录添加 flash 消息的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-27T02:16:09.083

嘿，火卫二。如果您想在不覆盖创建操作的情况下添加消息，您始终可以使用 after 过滤器。就像是

............

```
after :set_login_flash, :only => [:create]

private
def set_login_flash
  flash[:error] = "You're not logged in" unless logged_in?
end 
```

…………

您需要调整它以使用您在应用程序中使用的适当闪存系统，但类似的东西应该适合您。

# java - Java Web 部署：构建代码，还是部署 .war？

> ID：141693
> 
> 赞同：9
> 
> 时间：2008-09-26T20:16:56.560
> 
> 标签：java, deployment, jakarta-ee

部署 J2EE/Java Web 应用程序的两种主要方法（在​​非常简单的意义上）：

## 将组装的工件部署到生产盒

在这里，我们在`.war`别处创建（或其他），将其配置用于生产（可能为许多盒子创建大量工件）并将生成的工件放在生产服务器上。

*   **优点**：生产盒上没有开发工具，可以直接重用测试中的工件，进行部署的人员不需要了解构建过程
*   **缺点**：创建和部署工件的两个过程；预建工件的潜在复杂配置可能会使流程难以编写脚本/自动化；必须版本二进制工件

## **在**生产箱上构建工件

在这里，日常用于在开发人员机器上本地构建和部署的相同过程用于部署到生产。

*   **优点**：需要维护一个流程；并通过频繁使用进行了大量测试/验证。在创建工件时自定义配置可能比自定义预构建工件后记更容易；不需要对二进制工件进行版本控制。
*   **缺点**：所有生产盒都需要潜在的复杂开发工具；部署人员需要了解构建过程；你**没有**部署你测试的东西

我主要使用第二个过程，诚然是出于必要（另一个部署过程没有时间/优先级）。就我个人而言，我不赞成“生产箱必须清除所有编译器等”之类的论点，但我**可以**看到部署您测试过的东西的逻辑（而不是构建另一个工件）。

然而，Java Enterprise 应用程序对配置非常敏感，感觉就像是在为配置工件的两个进程自找麻烦。

想法？

## 更新

这是一个具体的例子：

我们使用 OSCache，并启用磁盘缓存。配置文件必须在 .war 文件中，并且它引用文件路径。这条路径在每个环境中都不同。构建过程检测用户的配置位置，并确保放置在战争中的属性文件对于他的环境是正确的。

如果我们要使用构建过程进行部署，则需要为生产环境（例如`production.build.properties`）创建正确的配置。

如果我们要遵循“将组装的工件部署到生产环境”，我们将需要一个额外的过程来提取（不正确的）OSCache 属性并将其替换为适合生产环境的属性。

这会创建两个进程来完成同一件事。

所以，问题是：

*   如果没有“在生产中编译”，这是否可以避免？
*   如果没有，这值得吗？“不编译生产”的价值是否大于“不要重复自己”？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T21:10:59.347

我坚决反对在生产盒上构建，因为这意味着您使用的构建与您测试时使用的构建不同。这也意味着每台部署机器都有不同的 JAR/WAR 文件。如果不出意外，请进行统一构建，以便在跟踪错误时不必担心服务器之间的不一致。

此外，如果您可以轻松地在构建和创建它的源之间进行映射，则不需要将构建放入版本控制中。

在我工作的地方，我们的部署过程如下。（这是在 Linux 上，使用 Tomcat。）

1.  测试更改并签入 Subversion。（不一定按这个顺序；我们不需要测试提交的代码。我是唯一的全职开发人员，所以 SVN 树本质上是我的开发分支。你的里程可能会有所不同。）

2.  将 JAR/WAR 文件复制到以 Subversion 修订号命名的共享目录中的生产服务器。Web 服务器只有读取权限。

3.  部署目录包含到以修订命名的目录中的文件的相对符号链接。这样，目录列表将始终向您显示生成运行版本的源代码版本。部署时，我们会更新一个日志文件，它只不过是一个目录列表。这使得回滚变得容易。（不过有一个问题；Tomcat 根据实际文件的修改日期检查新的 WAR 文件，而不是符号链接，因此我们在回滚时必须触及旧文件。）

我们的 Web 服务器将 WAR 文件解压到本地目录中。该方法是可扩展的，因为 WAR 文件位于单个文件服务器上；我们可以拥有无​​限数量的 Web 服务器，并且只进行一次部署。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T20:32:44.337

我工作过的大多数地方都使用了第一种方法，其中特定于环境的配置信息在战争/耳朵之外单独部署（并且很少更新）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:32:37.257

存在配置服务，例如重量级的[ZooKeeper](http://hadoop.apache.org/zookeeper/docs/current/)，大多数容器都允许您使用 JNDI 进行一些配置。这些会将配置与构建分开，但可能会过大。但是，它们确实存在。很大程度上取决于您的需求。

我还使用了一个过程，其中使用配置值的占位符构建工件。当 WAR 被部署时，它被分解并且占位符被替换为适当的值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:39:55.100

我强烈推荐“将组装的工件部署到生产箱”，例如战争文件。这就是为什么我们的开发人员使用相同的构建脚本（在我们的例子中是 Ant）来在他们的开发沙箱上构建战争，就像用于创建 finally 工件一样。通过这种方式，它和代码本身一样被调试，更不用说完全可重复了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T22:03:26.960

我会支持使用支持分布式构建的持续集成解决方案。签入 SCM 的代码可以触发构建（用于立即测试），您可以安排构建以创建用于 QA 的工件。然后，您可以将这些工件提升到生产环境并部署它们。

这是我目前正在使用[AnthillPro](http://www.anthillpro.com/html/default.html "AnthillPro")进行设置的。

编辑：我们现在正在使用[Hudson](http://hudson-ci.org/)。极力推荐！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T21:08:40.163

如果您问的是与配置管理相关的问题，那么您的答案需要基于您认为是托管工件的内容。从 CM 的角度来看，让一些源文件集合在一个环境中工作而不在另一个环境中工作是不可接受的情况。CM 对环境变量、优化设置、编译器和运行时版本等很敏感，你必须考虑这些事情。

如果您问的是与可重复流程创建相关的问题，那么答案需要基于您愿意忍受的疼痛的位置和数量。使用 .war 文件可能会带来更多的前期痛苦，以节省测试和部署周期的工作量。使用源文件和构建工具可能会节省前期成本，但您将不得不忍受在部署过程后期处理问题的额外痛苦。

**具体示例的更新**

与您的示例相关的两件事要考虑。

1.  .war 文件只是具有备用扩展名的 .zip 文件。您可以使用标准 zip 实用程序替换配置文件。

2.  可能会重新考虑将配置文件放在 .war 文件中的需要。将它放在类路径上或在服务器启动时在执行命令行中指定属性就足够了。

通常，我尝试保持特定于部署位置的部署配置要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-06T22:06:06.107

使用 1 个打包的 war 文件进行部署是一种很好的做法。
我们使用 ant 来替换环境之间不同的值。我们使用 @@@ 变量签入文件，该变量将被我们的 ant 脚本替换。ant 脚本替换文件中正确的项目，然后在部署到每个之前更新 war 文件

```
<replace file="${BUILDS.ROOT}/DefaultWebApp/WEB-INF/classes/log4j.xml" token="@@@" value="${LOG4J.WEBSPHERE.LOGS}"/>

<!-- update the war file We don't want the source files in the war file.-->
<war basedir="${BUILDS.ROOT}/DefaultWebApp" destfile="${BUILDS.ROOT}/myThomson.war" excludes="WEB-INF/src/**" update="true"/> 
```

总而言之，ant 可以做到这一切，我们使用 anthill 来管理 ant。ant 构建war 文件，替换文件路径，更新war 文件，然后部署到目标环境。一个过程，实际上是在anthill中单击一个按钮。

# linux - 如何使用 shell 命令对包含排除项的文件和文件夹列表进行 tar

> ID：141701
> 
> 赞同：3
> 
> 时间：2008-09-26T20:18:20.130
> 
> 标签：linux, unix, shell

如何在排除单个目录（包含大量数据）的情况下对文件和文件夹列表（都在同一个目录中）进行 tar

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T20:21:29.733

`tar --exclude=PATTERN xvzf nameof.tar.gz ./*`

PATTERN 可以是目录名。GNU焦油。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T20:22:20.587

我认为这可能取决于您的 tar 版本。您可以使用“man tar”或“tar --help”来检查您的版本的详细信息。但我发现的选项是：

tar -X*文件名*：排除给定文本文件中列出的任何内容
tar --exclude=*模式*：排除与模式匹配的任何内容

# linux - 如何在 Red Hat Linux 机器上设置 CPU 负载？

> ID：141707
> 
> 赞同：6
> 
> 时间：2008-09-26T20:18:39.193
> 
> 标签：linux, load, redhat, cpu-cycles

我有一个[RHEL](http://en.wikipedia.org/wiki/Red_Hat_Enterprise_Linux)盒子，我需要将它置于中等且可变的 CPU 负载 (50%-75%) 之下。

解决此问题的最佳方法是什么？有没有我不知道的可以做到这一点的程序？我很高兴编写一些 C 代码来实现这一点，我只是不知道什么系统调用会有所帮助。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-27T16:38:42.597

这正是您所需要的（互联网档案链接）： [https ://web.archive.org/web/20120512025754/http://weather.ou.edu/~apw/projects/stress/stress-1.0.4.tar .gz](https://web.archive.org/web/20120512025754/http://weather.ou.edu/%7Eapw/projects/stress/stress-1.0.4.tar.gz)

来自主页：“stress 是用于 POSIX 系统的简单工作负载生成器。它对系统施加可配置数量的 CPU、内存、I/O 和磁盘压力。它是用 C 编写的，是根据 GPL 许可的免费软件。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T20:29:22.897

找一个有源代码的简单素数搜索程序。修改源代码以在主循环中添加一个 nanosleep 调用，无论延迟为您提供所需的 CPU 负载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:26:32.060

在系统上获得一些负载的一种常见方法是一遍又一遍地编译一个大型软件包。类似于 Linux 内核的东西。

获取源代码的副本，解压 tar.bz2，进入顶级源目录，将内核配置从 /boot 复制到 .config 或 zcat /proc/config.gz > .config，然后执行 make oldconfig，然后虽然是真的；做干净 && 做 bzImage; 完毕

如果你有一个 SMP 系统，那么 make -j bzImage 很有趣，它会产生并行的 make 任务。

一个问题是调整 CPU 负载。除了在磁盘 I/O 上等待时，这将是最大的 CPU 负载。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:30:20.333

这实际上取决于您要测试的内容。如果您只是在测试 CPU 负载，那么吃空 CPU 周期的简单脚本就可以正常工作。我个人最近不得不测试 RAID 阵列的性能，我依靠 Bonnie++ 和 IOZone。IOZone 会给盒子带来相当大的负载，特别是如果您将文件大小设置为高于 RAM。

你可能也对[这篇文章](http://www.ibm.com/developerworks/linux/library/l-stress/index.html)感兴趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:33:18.470

您可以使用 Bash 脚本来执行此操作。使用“ps -o pcpu | grep -v CPU”获取所有进程的 CPU 使用率。将所有这些值加在一起以获得当前使用情况。然后有一个繁忙的 while 循环，它基本上会继续检查这些值，找出当前的 CPU 使用率，并等待计算出的时间量以使处理器保持在某个阈值。需要更多细节，但希望这会给你一个好的起点。

看看我找到的这个[CPU Monitor](http://bashcurescancer.com/media/scripts/monitorCpuUsage.sh.txt)脚本，并尝试获得一些关于如何完成此任务的其他想法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-07T14:34:25.630

Lookbusy 启用 CPU 负载的设定值。 [项目现场](http://devin.com/lookbusy/)

```
lookbusy -c util[-high_util], --cpu-util util[-high_util]

i.e. 60% load
lookbusy -c 60 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:25:01.253

您可能可以使用一些负载生成工具来完成此操作，或者运行一个脚本来获取所有 CPU 周期，然后使用[nice](http://en.wikipedia.org/wiki/Nice_%28Unix%29)和`renice`on the process 来改变进程获得的周期百分比。

这是一个将占用所有空闲 CPU 周期的示例 bash 脚本：

```
#!/bin/bash
while true ; do
true
done 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-27T16:48:57.253

使用“nice”命令。

a) 最高优先级： $ nice -n -20 my_command

或者

b) 最低优先级： $ nice -n 20 my_command

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-14T16:01:40.433

一个使用 awk 加载和锤击 CPU 的简单脚本。该脚本会进行数学计算，因此 CPU 负载会在 passwd 到 loadserver.sh 的较高值上达到峰值。

签出脚本@[http://unixfoo.blogspot.com/2008/11/linux-cpu-hammer-script.html](http://unixfoo.blogspot.com/2008/11/linux-cpu-hammer-script.html)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-26T21:17:37.193

不确定您的目标是什么。我相信 glxgears 将使用 100% CPU。

因此，找到您知道的任何进程会将 CPU 最大化到 100%。

如果您有四个 CPU 内核（0 1 2 3），您可以使用“taskset”将此进程绑定到 CPU 0 和 1。这应该会加载您的机器 50%。要加载它 75% 将进程绑定到 0 1 2 个 CPU。

免责声明：尚未对此进行测试。请让我们知道您的结果。即使这行得通，我不确定您会从中获得什么？

# compact-framework - Windows Mobile 2003 SE 上的 .NET Compact Framework 3.5

> ID：141716
> 
> 赞同：1
> 
> 时间：2008-09-26T20:20:32.073
> 
> 标签：compact-framework

.NET Compact Framework 3.5 是否可以不受限制地在 Windows Mobile 2003 SE 上运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T20:31:30.627

是的，它工作正常。[下载文档](http://www.microsoft.com/downloads/details.aspx?FamilyID=e3821449-3c6b-42f1-9fd9-0041345b3385&displaylang=en)也显示了这一点。

# sql-server - SQL Server 临时表和连接池

> ID：141718
> 
> 赞同：33
> 
> 时间：2008-09-26T20:20:58.017
> 
> 标签：sql-server, sql-server-2005

我有一个针对 SQL Server 运行的多用户 ASP.NET 应用程序，并且希望 StoredProcA 创建一个 #temptable 临时表（而不是表变量）来插入一些数据，然后分支到 StoredProcB、StoredProcC 和 StoredProcD 以操作其中的数据#temptable 每个业务规则。

Web 应用程序在与 SQL 通信时使用连接池。我会为每次调用 StoredProcA 获得一个新的 #temptable 暂存区吗？或者连接池是否会在用户之间共享#temptable？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-26T20:38:01.487

[`sp_reset_connection`](http://msdn.microsoft.com/en-us/library/ms187961.aspx)重用连接时将调用连接池（使用任何现代版本的 SQL Server） 。除其他外，此存储过程[会删除连接拥有的任何临时表](https://stackoverflow.com/questions/596365/what-does-sp-reset-connection-do)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-26T20:26:17.707

## 表将由所有用户共享。我想这不是你的意图。

单个# 临时表对调用堆栈下的所有存储过程可见，但在该范围之外不可见。如果你可以让 Proc A 调用 B、C 和 D，你应该没问题。

编辑：我现在应该处理的报告程序很像这样。:) 我在应用程序调用的根过程中创建了一个临时表（#results），然后在一系列子过程中进行一些复杂的数据处理，以 1）抽象重复代码，以及 2）阻止根过程运行到 500+ 行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T20:26:34.650

`#temptable`在声明它的过程结束后无法生存，因此其他用户永远不会看到它。

**编辑：**嘿，事实证明临时表的“嵌套可见性”自 SQL Server 7.0 起就有效，但我从未更新任何代码来利用这一点。我想我是在和自己约会——很多人可能无法想象 6.0 和 6.5 时代的 SQL Server 到底是什么鬼……

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T20:44:25.043

来自 MS 文档：

[http://msdn.microsoft.com/en-us/library/ms177399(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms177399(SQL.90).aspx)

***临时表***

*临时表与永久表类似，只是临时表存储在 tempdb 中，并在不再使用时自动删除。*

*有两种类型的临时表：本地和全局。它们在名称、可见性和可用性方面彼此不同。* ***本地临时表有一个单一的数字符号 (#) 作为其名称的第一个字符；它们仅对用户的当前连接可见，并且在用户与 SQL Server 实例断开连接时被删除。***

***全局临时表有两个数字符号 (##) 作为其名称的第一个字符；它们在创建后对任何用户都是可见的，当所有引用该表的用户与 SQL Server 实例断开连接时，它们将被删除。***

*例如，如果您创建表employees，则该表可以被任何拥有数据库安全权限的人使用，直到该表被删除。如果数据库会话创建本地临时表#employees，则只有会话可以使用该表，并且在会话断开连接时将其删除。如果您创建全局临时表##employees，则数据库中的任何用户都可以使用此表。如果在您创建该表后没有其他用户使用该表，则该表会在您断开连接时被删除。如果其他用户在您创建该表后使用它，则 SQL Server 会在您断开连接并且所有其他会话不再主动使用它之后将其删除。*

另外来自[Curt](https://stackoverflow.com/questions/141718/sql-server-temp-tables-and-connection-pooling#141754)，他纠正了我的方式错误，以防您错过评论中的引用：

[http://msdn.microsoft.com/en-us/library/ms191132.aspx](http://msdn.microsoft.com/en-us/library/ms191132.aspx)

*   *如果在存储过程中创建本地临时表，则临时表的存在仅用于存储过程；当您退出存储过程时，它会消失。*

*   *如果您执行一个调用另一个存储过程的存储过程，则被调用的存储过程可以访问由第一个存储过程创建的所有对象，包括临时表。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:24:13.000

要在用户之间共享临时表，请在名称 ##like_this 之前使用两个哈希。

在这种情况下，请确保您采取措施避免与程序的多个实例发生冲突。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:27:01.137

临时表是在后台创建名称修改的，因此不同的存储过程调用之间不应该存在冲突。

如果您需要在随后的存储过程调用中操作相同的临时数据，最好只使用真实表并使用某种唯一标识符来确保您只处理相关数据。如果数据只是暂时有价值，请在完成后手动将其删除。

# c - 您如何比较 C 中的结构是否相等？

> ID：141720
> 
> 赞同：240
> 
> 时间：2008-09-26T20:21:23.850
> 
> 标签：c, struct, equality

您如何比较标准 C 中结构的两个实例是否相等？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2008-09-26T20:22:14.520

C 没有提供任何语言工具来做到这一点——你必须自己做，并逐个比较每个结构成员。

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2008-09-26T20:32:39.860

您可能很想使用`memcmp(&a, &b, sizeof(struct foo))`，但它可能不适用于所有情况。编译器可以将对齐缓冲区空间添加到结构中，并且不保证在缓冲区空间中的内存位置找到的值是任何特定值。

但是，如果在使用它们之前使用结构`calloc`的`memset`完整大小，则**可以**进行*浅*比较`memcmp`（如果您的结构包含指针，则仅当指针指向的地址相同时才会匹配）。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-26T20:24:32.190

如果您经常这样做，我建议您编写一个比较这两种结构的函数。那样的话，如果你改变了结构，你只需要在一个地方改变比较。

至于怎么做......你需要单独比较每个元素

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-26T20:34:12.137

由于结构中的字段之间可能存在随机填充字符，因此您不能使用 memcmp 来比较结构是否相等。

```
 // bad
  memcmp(&struct1, &struct2, sizeof(struct1)); 
```

对于这样的结构，上述内容将失败：

```
typedef struct Foo {
  char a;
  /* padding */
  double d;
  /* padding */
  char e;
  /* padding */
  int f;
} Foo ; 
```

为了安全起见，您必须使用成员比较。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-08-19T05:39:21.890

@Greg 是正确的，在一般情况下必须编写显式比较函数。

在以下情况下可以使用`memcmp`：

*   结构不包含可能是的浮点字段`NaN`。
*   结构不包含填充（使用`-Wpadded`clang 来检查）或者结构`memset`在初始化时显式初始化。
*   没有具有不同但等效值的成员类型（例如 Windows `BOOL`）。

除非您正在为嵌入式系统编程（或编写可能在它们上使用的库），否则我不会担心 C 标准中的一些极端情况。在任何 32 位或 64 位设备上都不存在近与远指针的区别。我所知道的非嵌入式系统没有多个`NULL`指针。

另一种选择是自动生成相等函数。如果您以简单的方式布置结构定义，则可以使用简单的文本处理来处理简单的结构定义。您可以将 libclang 用于一般情况——因为它使用与 Clang 相同的前端，它可以正确处理所有极端情况（排除错误）。

I have not seen such a code generation library. However, it appears relatively simple.

However, it is also the case that such generated equality functions would often do the wrong thing at application level. For example, should two `UNICODE_STRING` structs in Windows be compared shallowly or deeply?

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-26T20:52:38.020

请注意，您可以在非静态结构上使用 memcmp() 而不必担心填充，只要您不初始化所有成员（一次）。这是由 C90 定义的：

[http://www.pixelbeat.org/programming/gcc/auto_init.html](http://www.pixelbeat.org/programming/gcc/auto_init.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-27T14:41:58.837

这取决于您要问的问题是否是：

1.  这两个结构是同一个对象吗？
2.  它们是否具有相同的价值？

要确定它们是否是同一个对象，请比较指向这两个结构的指针是否相等。如果您想大致了解它们是否具有相同的值，则必须进行深入比较。这涉及比较所有成员。如果成员是指向其他结构的指针，您也需要递归到这些结构中。

在结构不包含指针的特殊情况下，您可以使用 memcmp 对每个结构中包含的数据执行按位比较，而无需知道数据的含义。

确保您知道“等于”对每个成员的含义——对于整数来说很明显，但对于浮点值或用户定义的类型来说更微妙。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-07T19:15:47.023

`memcmp`不比较结构，`memcmp`比较二进制，结构中总是有垃圾，所以比较总是出假。

逐个元素比较其安全且不会失败。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T20:34:40.167

如果结构仅包含原语或者如果您对严格相等感兴趣，那么您可以执行以下操作：

```
int my_struct_cmp(const struct my_struct * lhs, const struct my_struct * rhs)
{
    返回 memcmp(lhs, rsh, sizeof(struct my_struct));
}

```

但是，如果您的结构包含指向其他结构或联合的指针，那么您将需要编写一个函数来正确比较原语并根据需要对其他结构进行比较调用。

但是请注意，作为 ADT 初始化的一部分，您应该使用 memset(&a, sizeof(struct my_struct), 1) 将结构的内存范围归零。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2012-10-03T09:11:00.260

如果 2 个结构变量是用 calloc 初始化的，或者它们由 memset 设置为 0，那么您可以将您的 2 个结构与 memcmp 进行比较，并且不用担心结构垃圾，这将让您赢得时间

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2014-09-30T17:06:41.837

此兼容示例使用 Microsoft Visual Studio 中的#pragma pack 编译器扩展来确保结构成员尽可能紧密地打包：

```
#include <string.h>

#pragma pack(push, 1)
struct s {
  char c;
  int i;
  char buffer[13];
};
#pragma pack(pop)

void compare(const struct s *left, const struct s *right) { 
  if (0 == memcmp(left, right, sizeof(struct s))) {
    /* ... */
  }
} 
```

# java - 部署多个 2.1 EJB 的 OC4J 10.1.3.4 问题

> ID：141733
> 
> 赞同：0
> 
> 时间：2008-09-26T20:23:47.747
> 
> 标签：java, jakarta-ee, ejb, oc4j, ejb-jar.xml

我在从 OC4J 10.1.2.3 迁移到 10.1.3.1.4 时遇到问题。问题在于具有多个 EJB 的应用程序（都是 2.1，没有 EJB 3.0）。Jdeveloper 将采用默认的 ejb-jar.xml（Jdeveloper 在其独立的 OC4J 实例上运行它所需的文件）并将其打包到每个 EJB JAR 模块中，不管是什么。这导致应用服务器在部署时深入每个 EJB JAR 模块，并找到 N 次相同的 ejb-jar.xml 文件（其中 N = EJB 模块的数量）。这会导致重复的 EJB 引用，并会破坏任何 JNDI 查找，例如：“java:comp/env/ejb/EJBName”。因此，部署具有 3 个 EJB、EJB1、EJB2 和 EJB3 的应用程序会导致应用程序服务器注册 9 个 EJB 而不是 3 个。**我需要一种最佳实践方式，但在 10.1.3.4 和 JDeveloper 执行的方式之间，情况相当糟糕...**

旁注：如果 Web 应用程序的 JNDI 查找代码被重构为“ejb/EJBName”，它们将起作用。但是，这是不可取的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-06T12:11:02.610

您应该查看 Oracle 文档以了解您的情况。Oracle® Containers for J2EE Enterprise JavaBeans Developer's Guide 是一个好的开始 根据 Oracle® Containers for J2EE 服务指南第 2 章：使用 JNDI 当您使用“ejb/EJBName”形式执行“本地”查找时。如果您想使用完整的表单，您必须查看“使用 JNDI”一章的“启用全局 JNDI 查找”部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T16:16:14.540

问题是我们的部署配置文件中的多个引用。我们为每个 EJB 创建了一个部署配置文件。这意味着每个 EJB 都有自己的 ejb-jar.xml（该文件包含项目中所有 EJBS 的描述）。因此，每次 JDeveloper 创建一个 EJB 时，它都会在它生成的每个 EJB 中放置一个所有 EJBS 的描述符，从而导致 NxN 数量的引用。因此 Nx(N-1) 个额外的引用。

现在，关键是 Oracle 应用服务器 10.1.2.3.0 及以下版本并不关心这些重复的引用。然而，正如我们所见，10.1.3.1.4 是一个非常不同的版本，并且确实中断了。

我们的解决方法：只有 1 个 EJB 部署配置文件，其中包含所有 EJB 类和它们使用的 POJO。请记住，在每个 EJB 有 1 个 EJB 配置文件之前......所做的一切就是让 Jdeveloper（恕我直言）*正确*生成有效的 EAR。Jdeveloper 和 Oracle 的应用服务器的垃圾的结合是造成这种情况的原因。

# java - Java EE 网站的默认会话超时是多少？

> ID：141734
> 
> 赞同：29
> 
> 时间：2008-09-26T20:23:48.680
> 
> 标签：java, jsp, tomcat, jakarta-ee

如果我没有在 web.xml 文件中指定以下内容：

```
<session-config>
    <session-timeout>10</session-timeout>
</session-config> 
```

我的默认会话超时是多少？（我正在运行 Tomcat 6.0）

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-26T20:26:46.427

如果您使用的是 Tomcat，则需要 30 分钟。[你可以在这里](http://forums.sun.com/thread.jspa?threadID=565341&messageID=2788327)阅读更多关于它的信息。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-26T22:33:44.140

`HttpSession` [您还可以使用setMaxInactiveInterval](http://java.sun.com/javaee/5/docs/api/javax/servlet/http/HttpSession.html#setMaxInactiveInterval(int)) API 在代码中为特定会话设置它：

> 指定 servlet 容器使该会话无效之前客户端请求之间的时间（以秒为单位）。负时间表示会话不应超时。

我会提到这一点，以防您看到不是 30 分钟的超时，但您没有指定另一个值（例如，项目中的另一个开发人员使用了这个 API）。

需要注意的另一项是此超时可能不会在会话有资格过期的确切秒内触发。Java EE 服务器可能有一个轮询线程，每分钟检查一次过期会话。我没有对此的参考，但在 WebSphere 5.1 时代已经看到了这种行为。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-26T20:24:48.053

我确定这取决于您的容器。Tomcat 是 30 分钟。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-20T16:28:57.740

我们可以在 web.xml 文件中为特定上下文指定会话超时，如条目 60 下方所述

默认会话超时为 30 分钟

# c++ - 浮点值在发布和调试版本中表现不同

> ID：141752
> 
> 赞同：7
> 
> 时间：2008-09-26T20:26:22.700
> 
> 标签：c++, c, debugging, compiler-construction, floating-point

当我在发布模式和调试模式下编译它时，我的应用程序会生成不同的浮点值。我发现的唯一原因是我保存了一个二进制跟踪日志，而来自发布版本的日志与调试版本略有不同，看起来 32 位浮点值的底部两位相差约 1/2的案例。

您会认为这种“差异”是一个错误，还是会出现这种差异。这是编译器错误还是内部库错误。

例如：

```
LEFTPOS and SPACING are defined floating point values.
float def_x;
int xpos;

def_x = LEFTPOS + (xpos * (SPACING / 2)); 
```

问题与 X360 编译器有关。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T20:29:35.110

发布模式可能有不同的 FP 策略集。根据您想要的优化级别，有不同的浮点运算模式。例如，MSVC 具有严格、快速和精确的模式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T20:37:05.327

我知道在 PC 上，浮点寄存器是 80 位宽的。因此，如果计算完全在 FPU 内完成，您将获得 80 位精度的好处。另一方面，如果将中间结果移出到普通寄存器并返回，它会被截断为 32 位，这会产生不同的结果。

现在考虑发布版本将进行优化，将中间结果保存在 FPU 寄存器中，而调试版本可能会天真地在内存和寄存器之间来回复制中间结果 - 并且您的行为有所不同。

我不知道这是否也发生在 X360 上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T20:29:31.757

这不是一个错误。任何浮点运算都有一定的不精确性。在发布模式下，优化会改变操作的顺序，你会得到一个稍微不同的结果。不过，差异应该很小。如果它很大，您可能会遇到其他问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-26T20:33:31.293

我帮助一位同事找到了一个编译器开关，该开关在发布与调试版本中不同，这导致了他的差异。

看看[/fp（指定浮点行为）](http://msdn.microsoft.com/en-us/library/e7s85ffb.aspx?ppud=4)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-26T23:57:36.170

除了其他人指出的不同浮点模式外，还可以打开 SSE 或类似的向量优化以进行发布。将浮点算术从标准寄存器转换为向量寄存器可能会对结果的低位产生影响，因为向量寄存器通常比标准浮点寄存器更窄（更少位）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T20:33:42.480

不是错误。这种差异是意料之中的。

例如，某些平台的浮点寄存器使用的位比存储在内存中的多，因此与存储到内存和从内存重新加载相比，在寄存器中保留一个值可能会产生稍微不同的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:34:45.160

这种差异很可能是由编译器优化引起的，这通常在发布模式下完成，而不是在调试模式下完成。例如，编译器可能会重新排序某些操作以加快执行速度，这可能会导致浮点结果略有不同。

所以，我会说它很可能不是一个错误。如果您真的担心这一点，请尝试在 Debug 模式下打开优化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T23:51:03.817

和其他人提到的一样，浮点寄存器的精度高于浮点数，因此最终结果的准确性取决于寄存器分配。

如果您需要一致的结果，您可以使变量易变，这将导致更慢、更不精确但一致的结果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-25T21:52:27.423

如果你设置了一个编译器开关，允许编译器重新排序浮点运算——例如/fp:fast——那么显然这不是一个错误。

如果您没有设置任何此类开关，那么这是一个错误——C 和 C++ 标准不允许编译器在未经您许可的情况下重新排序操作。

# windows - GDI 已经加速。有谁知道这是什么时候发生的？

> ID：141758
> 
> 赞同：7
> 
> 时间：2008-09-26T20:27:16.053
> 
> 标签：windows, graphics, gdi

勾勒出这个问题的背景：在工作中，我们使用 Dell Precision 工作站。我目前有一台 NVidia Quadro FX1700。我的团队正在为实时数据采集系统开发图形组件。因此，我们一直在寻找图形操作是否不会占用太多 CPU 时间。为了快速检查，我们运行了几个测试程序，它们以指定的速率（例如 10 fps）绘制场景，并且我们使用普通的旧任务管理器来查看 CPU 使用率在哪里。其中一个程序对 GDI DrawRectangle 调用（已填充）很重。这个程序过去总是消耗大约 40% 的 CPU 用户时间，但大约一年左右（这里只是猜测）它只使用大约 2-3% 的内核时间。很明显，这里正在进行一些硬件加速。事实上，如果我关闭 HW-accell，我们' 重新回到原来的 40% 的用户时间。所有这些当然都是好消息，因为我们已经在考虑使用 OpenGL。年复一年，GDI 从未从硬件加速中受益。直到前一段时间。

有人知道更多吗？微软这样做了吗？还是 gfx 卡供应商特定的？

**编辑**

Thnx 已经给出了答案（Ferrucio、Torlack 和 Rob Walker），但我的问题尚未得到解答。我们在这里讨论的是填充矩形。可能是最简单的优化功能：只需将几个坐标发送到 GPU 并让它撕裂。然而，它总是在 CPU 端实现。到目前为止，答案让我相信 NVidia 终于看到了曙光（经过 10 多年）并加速了 GDI。并且没有关于这个的公告？根本找不到这方面的信息。我的内部客户问我有关图形加速的问题，我只能说“好吧，我们很幸运”。

**编辑2**

It does seem like it is driver related according to the different answers. So, then NVidia has made crappy GDI drivers for its workstation cards for years. It really was an accepted fact within this company that GDI was not accelerated and all the tests confirmed this.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T20:42:20.680

GDI 通过调用图形设备驱动程序中的各种函数来工作。每个驱动程序都*必须*实现一组核心功能。其他功能可以由驱动程序实现。如果不是，GDI 将自己执行这些功能。

如果某个特定功能没有在硬件中实现，那么驱动程序就没有必要对该功能进行软件实现，因为 GDI 可能会做得更好。GDI 针对性能进行了极好的优化。

随着更多功能在硬件中实现，这些功能不仅性能更好，而且 GDI 要做的工作也减少了，从而减少了用于图形的 CPU 时间。

也可能是显卡供应商为了将显卡快速推向市场，可能没有实现显卡可以执行的所有可能的硬件功能。然后，该驱动程序的更高版本可能会实现该功能，从而提高性能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-06T13:10:40.103

GDI was accelerated for quite awhile. Far as I recall it did depend on your hardware and drivers to some extent. Why you've seen such a jump in performance only recently seems odd.

However, don't get too happy - GDI hardware acceleration is no longer supported in Vista. The new desktop composition engine doesn't support it. However, in Vista you do gain fast moving of windows since content doesn't always have to be re-drawn by the application (and no tearing I think?).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T20:32:00.987

在某种程度上，GDI一直在加速。甚至在旧的Win31时代我记得买卡（Number9）的主要卖点是GDI的硬件加速。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-27T01:27:02.820

许多 2D 的东西已经加速了一段时间，每个新的主要版本的 windows 都改变了显示驱动程序的工作方式。我相信是 Windows 修改了它的窗口管理器层。真的很难比较，因为 XP 比任何早期版本都更类似于 windows 2000/NT。

有关维基百科的更多信息，[Windows XP 的开发](http://en.wikipedia.org/wiki/Development_of_Windows_XP)。

当然，Windows 2000 是第一个包含 DirectX 的基于 NT 内核的窗口，并且还进行了一些图形改进。[Windows 2000（维基百科）](http://en.wikipedia.org/wiki/Windows_2000)

我不相信版本之间的显示驱动程序模型/2D 子系统有重大变化。因此，如果您注意到这样的变化，很可能是由于 nVidia 所做的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T20:39:03.840

Vista 有一个新的[显示驱动架构](http://msdn.microsoft.com/en-us/library/aa480220.aspx)，它可以提供一个显着提高性能的机会。您是否在比较硬件/操作系统组合？

# html - 是否有条件显示的替代方法：无

> ID：141775
> 
> 赞同：1
> 
> 时间：2008-09-26T20:30:06.637
> 
> 标签：html, css

我继承了一个应用程序，其中 display:none 用于根据其他输入元素的值控制输入元素的条件显示。

处理这种情况的方法是运行一些非常丑陋的代码来评估字段值并在页面加载期间重置显示属性。每次。

没有更好的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T20:33:52.637

将 display: none 与 JavaScript 和 CSS 结合使用是动态显示或隐藏 DOM 元素的最简单方法。也就是说，您可以通过添加或删除元素来操作 DOM 本身，而不是简单地显示/隐藏它们（例如，使用[jQuery](http://docs.jquery.com/Manipulation)）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T20:33:21.467

也许您应该重新设计使用所有**显示的表单：无**字段或重写/重构执行此检查的脚本？如果表格太大，请将其分成几部分 - 这也将对用户有所帮助。我个人不喜欢每当我尝试填写所有内容时表格经常更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:41:01.637

如果您没有在用户与表单交互时动态显示和隐藏元素，则无需使用 CSS/Javascript。只需使用您的服务器端语言（PHP/JSP/whatever）不输出隐藏字段。您将使用更少的带宽，即使禁用了 Javascript，该表单也能正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T12:36:44.053

是在提交之前在每个 POST 或重新排序字段上重塑表单的想法。如果是第一个，则应在页面到达用户之前在服务器端删除显示的字段。如果您正在谈论在发布之前在客户端进行更改（例如，根据用户类型的某些字段中的输入删除不相关的字段），您可以使用 javascript 从 DOM 中删除字段。

您的解决方案需要的两件事是：

1.  表单必须在没有 javascript 的情况下正常运行（即使它们感觉不那么光滑）
2.  不要提交用户看不到的字段，除非它们是 type="hidden" 的输入标签。如果您不知道用户是否将字段留空或看不到它，您只会在后端感到困惑，因为它的样式由客户端脚本动态更改。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-22T07:25:55.593

有一个部分替代显示：无，即在 css 中使用这种样式

```
opacity:0; 
```

但问题是它没有出现在画布上，但它仍然存在。使用显示：无；完全删除元素并在您应用属性 display:block 时创建；

# language-agnostic - 解决 XKCD 中的 NP 完全问题

> ID：141779
> 
> 赞同：45
> 
> 时间：2008-09-26T20:30:38.680
> 
> 标签：language-agnostic, np-complete

有问题的问题/漫画：http: [//xkcd.com/287/](http://xkcd.com/287/)

![通用解决方案为您提供 50% 的小费](https://imgs.xkcd.com/comics/np_complete.png)

我不确定这是不是最好的方法，但这是我迄今为止提出的。我正在使用 CFML，但任何人都应该可以阅读它。

```
<cffunction name="testCombo" returntype="boolean">
    <cfargument name="currentCombo" type="string" required="true" />
    <cfargument name="currentTotal" type="numeric" required="true" />
    <cfargument name="apps" type="array" required="true" />

    <cfset var a = 0 />
    <cfset var found = false />

    <cfloop from="1" to="#arrayLen(arguments.apps)#" index="a">
        <cfset arguments.currentCombo = listAppend(arguments.currentCombo, arguments.apps[a].name) />
        <cfset arguments.currentTotal = arguments.currentTotal + arguments.apps[a].cost />
        <cfif arguments.currentTotal eq 15.05>
            <!--- print current combo --->
            <cfoutput><strong>#arguments.currentCombo# = 15.05</strong></cfoutput><br />
            <cfreturn true />
        <cfelseif arguments.currentTotal gt 15.05>
            <cfoutput>#arguments.currentCombo# > 15.05 (aborting)</cfoutput><br />
            <cfreturn false />
        <cfelse>
            <!--- less than 15.05 --->
            <cfoutput>#arguments.currentCombo# < 15.05 (traversing)</cfoutput><br />
            <cfset found = testCombo(arguments.currentCombo, arguments.currentTotal, arguments.apps) />
        </cfif>
    </cfloop>
</cffunction>

<cfset mf = {name="Mixed Fruit", cost=2.15} />
<cfset ff = {name="French Fries", cost=2.75} />
<cfset ss = {name="side salad", cost=3.35} />
<cfset hw = {name="hot wings", cost=3.55} />
<cfset ms = {name="moz sticks", cost=4.20} />
<cfset sp = {name="sampler plate", cost=5.80} />
<cfset apps = [ mf, ff, ss, hw, ms, sp ] />

<cfloop from="1" to="6" index="b">
    <cfoutput>#testCombo(apps[b].name, apps[b].cost, apps)#</cfoutput>
</cfloop> 
```

上面的代码告诉我，加起来 15.05 美元的唯一组合是 7 个混合水果订单，我的 testCombo 函数需要执行 232 次才能完成。

有没有更好的算法来得出正确的解决方案？我找到了正确的解决方案吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-23T07:11:45.407

它提供了解决方案的所有排列，但我认为我在代码大小方面击败了其他所有人。

```
item(X) :- member(X,[215, 275, 335, 355, 420, 580]).
solution([X|Y], Z) :- item(X), plus(S, X, Z), Z >= 0, solution(Y, S).
solution([], 0). 
```

使用 swiprolog 的解决方案：

```
?- solution(X, 1505).

X = [215, 215, 215, 215, 215, 215, 215] ;

X = [215, 355, 355, 580] ;

X = [215, 355, 580, 355] ;

X = [215, 580, 355, 355] ;

X = [355, 215, 355, 580] ;

X = [355, 215, 580, 355] ;

X = [355, 355, 215, 580] ;

X = [355, 355, 580, 215] ;

X = [355, 580, 215, 355] ;

X = [355, 580, 355, 215] ;

X = [580, 215, 355, 355] ;

X = [580, 355, 215, 355] ;

X = [580, 355, 355, 215] ;

No 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-27T09:17:03.923

NP 完全问题的关键不是它在小数据集上很棘手，而是解决它的工作量以大于多项式的速度增长，即没有 O(n^x) 算法。

如果时间复杂度是 O(n!)，就像（我相信）上面提到的两个问题，那就是 NP。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-27T08:50:20.087

递归（在 Perl 中）不是更优雅吗？

```
#!/usr/bin/perl
use strict;
use warnings;

my @weights  = (2.15, 2.75, 3.35, 3.55, 4.20, 5.80);

my $total = 0;
my @order = ();

iterate($total, @order);

sub iterate
{
    my ($total, @order) = @_;
    foreach my $w (@weights)
    {
        if ($total+$w == 15.05)
        {
            print join (', ', (@order, $w)), "\n";
        }
        if ($total+$w < 15.05)
        {
            iterate($total+$w, (@order, $w));
        }
    }
} 
```

输出

`marco@unimatrix-01:~$ ./xkcd-knapsack.pl
2.15, 2.15, 2.15, 2.15, 2.15, 2.15, 2.15
2.15, 3.55, 3.55, 5.8
2.15, 3.55, 5.8, 3.55
2.15, 5.8, 3.55, 3.55
3.55, 2.15, 3.55, 5.8
3.55, 2.15, 5.8, 3.55
3.55, 3.55, 2.15, 5.8
3.55, 5.8, 2.15, 3.55
5.8, 2.15, 3.55, 3.55
5.8, 3.55, 2.15, 3.55`

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-23T04:18:54.960

尽管背包是 NP Complete 的，但它是一个非常特殊的问题：通常的动态程序实际上非常出色（[http://en.wikipedia.org/wiki/Knapsack_problem](http://en.wikipedia.org/wiki/Knapsack_problem)）

如果你做正确的分析，结果是 O(nW)，n 是项目数，W 是目标数。问题是当你必须 DP 超过一个大的 W 时，这就是我们得到 NP 行为的时候。但在大多数情况下，背包的表现相当不错，您可以毫无问题地解决非常大的实例。就 NP 完全问题而言，背包是最简单的问题之一。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-24T02:10:12.037

这是使用 constraint.py 的解决方案

```
>>> from constraint import *
>>> problem = Problem()
>>> menu = {'mixed-fruit': 2.15,
...  'french-fries': 2.75,
...  'side-salad': 3.35,
...  'hot-wings': 3.55,
...  'mozarella-sticks': 4.20,
...  'sampler-plate': 5.80}
>>> for appetizer in menu:
...    problem.addVariable( appetizer, [ menu[appetizer] * i for i in range( 8 )] )
>>> problem.addConstraint(ExactSumConstraint(15.05))
>>> problem.getSolutions()
[{'side-salad': 0.0, 'french-fries': 0.0, 'sampler-plate': 5.7999999999999998, 'mixed-fruit': 2.1499999999999999, 'mozarella-sticks': 0.0, 'hot-wings': 7.0999999999999996},
 {'side-salad': 0.0, 'french-fries': 0.0, 'sampler-plate': 0.0, 'mixed-fruit':     15.049999999999999, 'mozarella-sticks': 0.0, 'hot-wings': 0.0}] 
```

所以解决方案是订购一个采样盘、一个混合水果和 2 个热翅，或者订购 7 个混合水果。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-27T08:09:14.773

这是 F# 的解决方案：

```
#light

type Appetizer = { name : string; cost : int }

let menu = [
    {name="fruit"; cost=215}
    {name="fries"; cost=275}
    {name="salad"; cost=335}
    {name="wings"; cost=355}
    {name="moz sticks"; cost=420}
    {name="sampler"; cost=580}
    ] 

// Choose: list<Appetizer> -> list<Appetizer> -> int -> list<list<Appetizer>>
let rec Choose allowedMenu pickedSoFar remainingMoney =
    if remainingMoney = 0 then
        // solved it, return this solution
        [ pickedSoFar ]
    else
        // there's more to spend
        [match allowedMenu with
         | [] -> yield! []  // no more items to choose, no solutions this branch
         | item :: rest -> 
            if item.cost <= remainingMoney then
                // if first allowed is within budget, pick it and recurse
                yield! Choose allowedMenu (item :: pickedSoFar) (remainingMoney - item.cost)
            // regardless, also skip ever picking more of that first item and recurse
            yield! Choose rest pickedSoFar remainingMoney]

let solutions = Choose menu [] 1505

printfn "%d solutions:" solutions.Length 
solutions |> List.iter (fun solution ->
    solution |> List.iter (fun item -> printf "%s, " item.name)
    printfn ""
)

(*
2 solutions:
fruit, fruit, fruit, fruit, fruit, fruit, fruit,
sampler, wings, wings, fruit,
*) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-26T20:44:11.237

阅读[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-26T21:00:15.303

你现在已经得到了所有正确的组合，但你仍然检查了比你需要的更多的东西（正如你的结果显示的许多排列所证明的那样）。此外，您忽略了最后一个达到 15.05 标记的项目。

我有一个 PHP 版本，它执行 209 次递归调用迭代（如果我得到所有排列，它会执行 2012 年）。如果在循环结束之前取出刚刚检查的项目，则可以减少计数。

我不知道 CF 语法，但它会是这样的：

```
 <cfelse>
            <!--- less than 15.50 --->
            <!--<cfoutput>#arguments.currentCombo# < 15.05 (traversing)</cfoutput><br />-->
            <cfset found = testCombo(CC, CT, arguments.apps) />
        ------- remove the item from the apps array that was just checked here ------
    </cfif>
</cfloop> 
```

编辑：作为参考，这是我的 PHP 版本：

```
<?
  function rc($total, $string, $m) {
    global $c;

    $m2 = $m;
    $c++;

    foreach($m as $i=>$p) {
      if ($total-$p == 0) {
        print "$string $i\n";
        return;
      }
      if ($total-$p > 0) {
        rc($total-$p, $string . " " . $i, $m2);
      }
      unset($m2[$i]);
    }
  }

  $c = 0;

  $m = array("mf"=>215, "ff"=>275, "ss"=>335, "hw"=>355, "ms"=>420, "sp"=>580);
  rc(1505, "", $m);
  print $c;
?> 
```

输出

```
 mf mf mf mf mf mf mf
 mf hw hw sp
209 
```

编辑2：

由于解释为什么您可以删除这些元素需要的时间比我在评论中所能容纳的要多一些，所以我在这里添加它。

基本上，每个递归都将找到包括当前搜索元素的所有组合（例如，第一步将找到包括至少一个混合水果在内的所有组合）。理解它的最简单方法是跟踪执行，但由于这会占用大量空间，所以我会按照目标是 6.45 来执行。

```
MF (2.15)
  MF (4.30)
    MF (6.45) *
    FF (7.05) X
    SS (7.65) X
    ...
  [MF removed for depth 2]
  FF (4.90)
    [checking MF now would be redundant since we checked MF/MF/FF previously]
    FF (7.65) X
    ...
  [FF removed for depth 2]
  SS (5.50)
  ...
[MF removed for depth 1] 
```

此时，我们已经检查了包含任何混合水果的每个组合，因此无需再次检查混合水果。您也可以使用相同的逻辑在每个更深层次的递归中修剪数组。

像这样追踪它实际上可以节省一点时间——知道价格是从低到高排序的，这意味着我们一旦超过目标就不需要继续检查项目。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-29T17:00:33.390

我会就算法本身的设计提出一个建议（这就是我解释你最初问题的意图的方式）。这是我写的解决方案的*片段：*

```
....

private void findAndReportSolutions(
    int target,  // goal to be achieved
    int balance, // amount of goal remaining
    int index    // menu item to try next
) {
    ++calls;
    if (balance == 0) {
        reportSolution(target);
        return; // no addition to perfect order is possible
    }
    if (index == items.length) {
        ++falls;
        return; // ran out of menu items without finding solution
    }
    final int price = items[index].price;
    if (balance < price) {
        return; // all remaining items cost too much
    }
    int maxCount = balance / price; // max uses for this item
    for (int n = maxCount; 0 <= n; --n) { // loop for this item, recur for others
        ++loops;
        counts[index] = n;
        findAndReportSolutions(
            target, balance - n * price, index + 1
        );
    }
}

public void reportSolutionsFor(int target) {
    counts = new int[items.length];
    calls = loops = falls = 0;
    findAndReportSolutions(target, target, 0);
    ps.printf("%d calls, %d loops, %d falls%n", calls, loops, falls);
}

public static void main(String[] args) {
    MenuItem[] items = {
        new MenuItem("mixed fruit",       215),
        new MenuItem("french fries",      275),
        new MenuItem("side salad",        335),
        new MenuItem("hot wings",         355),
        new MenuItem("mozzarella sticks", 420),
        new MenuItem("sampler plate",     580),
    };
    Solver solver = new Solver(items);
    solver.reportSolutionsFor(1505);
}

... 
```

（请注意，构造函数*确实*通过增加价格对菜单项进行排序，以在剩余余额小于任何剩余菜单项时启用恒定时间提前终止。）

示例运行的输出是：

```
7 mixed fruit (1505) = 1505
1 mixed fruit (215) + 2 hot wings (710) + 1 sampler plate (580) = 1505
348 calls, 347 loops, 79 falls 
```

我要强调的设计建议是，在上面的代码中，每个嵌套（递归）调用都处理一个由参数`findAndReportSolution(...)`标识的菜单项的数量。`index`换句话说，递归嵌套与内联嵌套循环的行为相似。最外层计算第一个菜单项的可能使用，下一个计算第二个菜单项的使用，等等。（当然，递归的使用将代码从对特定数量的菜单项的依赖中解放出来！）

我建议这样可以更容易地设计代码，并且更容易理解每​​个调用在做什么（考虑到特定项目的所有可能用途，将菜单的其余部分委托给从属调用）。它还避免了产生多项目解决方案的所有排列的组合爆炸（如上述输出的第二行，它只出现一次，而不是重复地以不同的项目排序）。

我试图最大化代码的“显而易见性”，而不是试图最小化某些特定方法的调用次数。例如，上面的设计让委托调用确定是否已达到解决方案，而不是在调用点周围进行检查，这会减少调用次数，但会导致代码混乱。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-30T21:40:41.080

嗯，你知道什么是奇怪的。解决方案是菜单上第一项中的七个。

既然这显然意味着要在短时间内用纸和铅笔来解决，为什么不将订单总额除以每件商品的价格，看看他们是否有机会订购了一件商品的倍数呢？

例如，

15.05/2.15 = 7 个混合水果 15.05/2.75 = 5.5 个炸薯条。

然后继续简单的组合......

15 / (2.15 + 2.75) = 3.06122449 混合水果和炸薯条。

换句话说，假设该解决方案应该是简单的并且可以由人类解决，而无需访问计算机。然后测试最简单、最明显（因此隐藏在视线中）的解决方案是否有效。

我发誓这个周末我在俱乐部关门后的凌晨 4:30 点了价值 4.77 美元的开胃菜（含税）时，我会在当地的康尼餐厅吃这个。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-06T14:51:54.257

在蟒蛇。
我对“全局变量”有一些问题，所以我把函数作为对象的方法。它是递归的，它为漫画中的问题调用了 29 次，在第一次成功匹配时停止

```
class Solver(object):
    def __init__(self):
        self.solved = False
        self.total = 0
    def solve(s, p, pl, curList = []):
        poss = [i for i in sorted(pl, reverse = True) if i <= p]
        if len(poss) == 0 or s.solved:
            s.total += 1
            return curList
        if abs(poss[0]-p) < 0.00001:
            s.solved = True # Solved it!!!
            s.total += 1
            return curList + [poss[0]]
        ml,md = [], 10**8
        for j in [s.solve(p-i, pl, [i]) for i in poss]:
            if abs(sum(j)-p)<md: ml,md = j, abs(sum(j)-p)
        s.total += 1
        return ml + curList

priceList = [5.8, 4.2, 3.55, 3.35, 2.75, 2.15]
appetizers = ['Sampler Plate', 'Mozzarella Sticks', \
              'Hot wings', 'Side salad', 'French Fries', 'Mixed Fruit']

menu = zip(priceList, appetizers)

sol = Solver()
q = sol.solve(15.05, priceList)
print 'Total time it runned: ', sol.total
print '-'*30
order = [(m, q.count(m[0])) for m in menu if m[0] in q]
for o in order:
    print '%d x %s \t\t\t (%.2f)' % (o[1],o[0][1],o[0][0])

print '-'*30
ts = 'Total: %.2f' % sum(q)
print ' '*(30-len(ts)-1),ts 
```

输出：

```
Total time it runned:  29
------------------------------
1 x Sampler Plate   (5.80)
2 x Hot wings       (3.55)
1 x Mixed Fruit       (2.15)
------------------------------
               Total: 15.05 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-26T20:52:48.237

实际上，我已经重构了我的算法。我遗漏了几个正确的组合，这是因为我在成本超过 15.05 时立即返回 - 我没有费心检查我可以添加的其他（更便宜的）项目。这是我的新算法：

```
<cffunction name="testCombo" returntype="numeric">
    <cfargument name="currentCombo" type="string" required="true" />
    <cfargument name="currentTotal" type="numeric" required="true" />
    <cfargument name="apps" type="array" required="true" />

    <cfset var a = 0 />
    <cfset var found = false /> 
    <cfset var CC = "" />
    <cfset var CT = 0 />

    <cfset tries = tries + 1 />

    <cfloop from="1" to="#arrayLen(arguments.apps)#" index="a">
        <cfset combos = combos + 1 />
        <cfset CC = listAppend(arguments.currentCombo, arguments.apps[a].name) />
        <cfset CT = arguments.currentTotal + arguments.apps[a].cost />
        <cfif CT eq 15.05>
            <!--- print current combo --->
            <cfoutput><strong>#CC# = 15.05</strong></cfoutput><br />
            <cfreturn true />
        <cfelseif CT gt 15.05>
            <!--<cfoutput>#arguments.currentCombo# > 15.05 (aborting)</cfoutput><br />-->
        <cfelse>
            <!--- less than 15.50 --->
            <!--<cfoutput>#arguments.currentCombo# < 15.05 (traversing)</cfoutput><br />-->
            <cfset found = testCombo(CC, CT, arguments.apps) />
        </cfif>
    </cfloop>
    <cfreturn found />
</cffunction>

<cfset mf = {name="Mixed Fruit", cost=2.15} />
<cfset ff = {name="French Fries", cost=2.75} />
<cfset ss = {name="side salad", cost=3.35} />
<cfset hw = {name="hot wings", cost=3.55} />
<cfset ms = {name="moz sticks", cost=4.20} />
<cfset sp = {name="sampler plate", cost=5.80} />
<cfset apps = [ mf, ff, ss, hw, ms, sp ] />

<cfset tries = 0 />
<cfset combos = 0 />

<cfoutput>
    <cfloop from="1" to="6" index="b">
        #testCombo(apps[b].name, apps[b].cost, apps)#
    </cfloop>
    <br />
    tries: #tries#<br />
    combos: #combos#
</cfoutput> 
```

输出：

```
Mixed Fruit,Mixed Fruit,Mixed Fruit,Mixed Fruit,Mixed Fruit,Mixed Fruit,Mixed Fruit = 15.05
Mixed Fruit,hot wings,hot wings,sampler plate = 15.05
Mixed Fruit,hot wings,sampler plate,hot wings = 15.05
Mixed Fruit,sampler plate,hot wings,hot wings = 15.05
false false false hot wings,Mixed Fruit,hot wings,sampler plate = 15.05
hot wings,Mixed Fruit,sampler plate,hot wings = 15.05
hot wings,hot wings,Mixed Fruit,sampler plate = 15.05
hot wings,sampler plate,Mixed Fruit,hot wings = 15.05
false false sampler plate,Mixed Fruit,hot wings,hot wings = 15.05
sampler plate,hot wings,Mixed Fruit,hot wings = 15.05
false
tries: 2014
combos: 12067 
```

我认为这可能有所有正确的组合，但我的问题仍然存在：有更好的算法吗？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-03T17:45:41.530

从[@rcar 的答案](https://stackoverflow.com/questions/141779/solving-the-np-complete-problem-in-xkcd#141949)中学习，以及稍后的另一个重构，我得到了以下内容。

与我编写的许多东西一样，我已经从 CFML 重构为 CFScript，但代码基本相同。

我在他的建议中添加了数组中动态起点的建议（而不是按值传递数组并更改其值以供将来递归使用），这使我得到了与他相同的统计数据（209 次递归，571 次组合价格检查（循环迭代） ))，然后通过假设数组将按成本排序——因为它是——并在我们超过目标价格时立即中断，从而对此进行了改进。中断后，我们减少到 209 次递归和 376 次循环迭代。

该算法还有哪些其他改进？

```
function testCombo(minIndex, currentCombo, currentTotal){
    var a = 0;
    var CC = "";
    var CT = 0;
    var found = false;

    tries += 1;
    for (a=arguments.minIndex; a <= arrayLen(apps); a++){
        combos += 1;
        CC = listAppend(arguments.currentCombo, apps[a].name);
        CT = arguments.currentTotal + apps[a].cost;
        if (CT eq 15.05){
            //print current combo
            WriteOutput("<strong>#CC# = 15.05</strong><br />");
            return(true);
        }else if (CT gt 15.05){
            //since we know the array is sorted by cost (asc),
            //and we've already gone over the price limit,
            //we can ignore anything else in the array
            break; 
        }else{
            //less than 15.50, try adding something else
            found = testCombo(a, CC, CT);
        }
    }
    return(found);
}

mf = {name="mixed fruit", cost=2.15};
ff = {name="french fries", cost=2.75};
ss = {name="side salad", cost=3.35};
hw = {name="hot wings", cost=3.55};
ms = {name="mozarella sticks", cost=4.20};
sp = {name="sampler plate", cost=5.80};
apps = [ mf, ff, ss, hw, ms, sp ];

tries = 0;
combos = 0;

testCombo(1, "", 0);

WriteOutput("<br />tries: #tries#<br />combos: #combos#"); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-01T20:55:28.910

这是 Clojure 中的并发实现。计算`(items-with-price 15.05)`大约需要 14 次组合生成递归，以及大约 10 次可能性检查。我花了大约 6 分钟来计算`(items-with-price 100)`我的 Intel Q9300。

这只会给出第一个找到的答案，或者`nil`如果没有，因为这就是问题所需要的。为什么要做更多你被告知要做的工作；）？

```
;; np-complete.clj
;; A Clojure solution to XKCD #287 "NP-Complete"
;; By Sam Fredrickson
;;
;; The function "items-with-price" returns a sequence of items whose sum price
;; is equal to the given price, or nil.

(defstruct item :name :price)

(def *items* #{(struct item "Mixed Fruit" 2.15)
               (struct item "French Fries" 2.75)
               (struct item "Side Salad" 3.35)
               (struct item "Hot Wings" 3.55)
               (struct item "Mozzarella Sticks" 4.20)
               (struct item "Sampler Plate" 5.80)})

(defn items-with-price [price]
  (let [check-count (atom 0)
        recur-count (atom 0)
        result  (atom nil)
        checker (agent nil)
        ; gets the total price of a seq of items.
        items-price (fn [items] (apply + (map #(:price %) items)))
        ; checks if the price of the seq of items matches the sought price.
        ; if so, it changes the result atom. if the result atom is already
        ; non-nil, nothing is done.
        check-items (fn [unused items]
                      (swap! check-count inc)
                      (if (and (nil? @result)
                               (= (items-price items) price))
                        (reset! result items)))
        ; lazily generates a list of combinations of the given seq s.
        ; haven't tested well...
        combinations (fn combinations [cur s]
                       (swap! recur-count inc)
                       (if (or (empty? s)
                               (> (items-price cur) price))
                         '()
                         (cons cur
                          (lazy-cat (combinations (cons (first s) cur) s)
                                    (combinations (cons (first s) cur) (rest s))
                                    (combinations cur (rest s))))))]
    ; loops through the combinations of items, checking each one in a thread
    ; pool until there are no more combinations or the result atom is non-nil.
    (loop [items-comb (combinations '() (seq *items*))]
      (if (and (nil? @result)
               (not-empty items-comb))
        (do (send checker check-items (first items-comb))
            (recur (rest items-comb)))))
    (await checker)
    (println "No. of recursions:" @recur-count)
    (println "No. of checks:" @check-count)
    @result)) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-01-07T19:06:20.430

如果您想要优化算法，最好按降序尝试价格。这样您就可以先用完剩余的金额，然后看看如何填写剩余的金额。

此外，您可以使用数学计算每次开始的每种食品的最大数量，这样您就不会尝试超过 15.05 美元目标的组合。

这个算法只需要尝试 88 种组合就可以得到完整的答案，这看起来是迄今为止发布的最低值：

```
public class NPComplete {
    private static final int[] FOOD = { 580, 420, 355, 335, 275, 215 };
    private static int tries;

    public static void main(String[] ignore) {
        tries = 0;
        addFood(1505, "", 0);
        System.out.println("Combinations tried: " + tries);
    }

    private static void addFood(int goal, String result, int index) {
        // If no more food to add, see if this is a solution
        if (index >= FOOD.length) {
            tries++;
            if (goal == 0)
                System.out.println(tries + " tries: " + result.substring(3));
            return;
        }

        // Try all possible quantities of this food
        // If this is the last food item, only try the max quantity
        int qty = goal / FOOD[index];
        do {
            addFood(goal - qty * FOOD[index],
                    result + " + " + qty + " * " + FOOD[index], index + 1);
        } while (index < FOOD.length - 1 && --qty >= 0);
    }
} 
```

这是显示两种解决方案的输出：

```
9 次尝试：1 * 580 + 0 * 420 + 2 * 355 + 0 * 335 + 0 * 275 + 1 * 215
88 次尝试：0 * 580 + 0 * 420 + 0 * 355 + 0 * 335 + 0 * 275 + 7 * 215
尝试的组合：88

```

# shell - KornShell (ksh) 环绕

> ID：141780
> 
> 赞同：10
> 
> 时间：2008-09-26T20:31:26.120
> 
> 标签：shell, unix, command-line, ksh, editing

好的，我相信这很简单，但它让我发疯。我最近去开发一个程序，我不得不及时退后一点并使用 Redhat 9。当我从运行 KornShell (ksh) 的标准 xterm 在命令行上键入时，我到达了line 屏幕向右滑动（切断我命令的左侧），而不是将文本换行到新行。这对我来说很困难，因为我不能直接从命令行轻松地复制和粘贴上一个命令。我必须查看历史记录并从那里粘贴命令。如果您想知道，我会执行很多命令行 awk 脚本，这些脚本会导致行变得很长。

有没有办法强制命令行换行而不是将可见性转移到我正在输入的命令的右侧？

我已经倾注了手册页选项，但没有运气。

我在跑：

*   XFree86 4.2.99.903(174)
*   KSH 5.2.14。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T12:41:02.753

你做了`man ksh`吗？

你想做一个`set -o multiline`.

摘自`man ksh`：

> 多行：
> 
> > 对于长于屏幕宽度的行，内置编辑器将在屏幕上使用多行。这可能不适用于所有终端。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-24T18:44:15.273

eval $(resize) 应该这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-12T02:13:05.690

简单的答案是：

```
$ set -o multiline 
```

早于 5.12 的 ksh，就像 NetBSD 6.1 附带的 ksh 一样，没有这个选项。您将不得不关闭当前的交互式输入行编辑模式，通常是 emacs：

```
$ set +o emacs 
```

这完全关闭了许多功能，例如制表符完成或使用“向上箭头”键回滚上一个命令。

如果您决定以某种方式习惯 emacs 模式，请记住 ^a 转到行首（“Home”键不起作用k）并且 ^e 转到行尾。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-26T20:36:29.227

如果可能，尝试通过添加 \ 将命令分解为多行，即：

```
$我的命令-a foo \
  -f 酒吧\
  -c 差异

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T05:39:57.517

我不知道强制外壳换行的方法，但我会问你为什么要写那么长的行。使用 awk 脚本，我只需将脚本用单引号括起来，然后在我想要的地方换行。如果您在脚本中需要单引号，它只会变得棘手——如果您同时需要单引号和双引号，它就会变得非常棘手。实际上，规则很简单：用单引号包裹整个脚本，当你想在脚本中使用单引号时，写`'\''`. 第一个引号终止前一个单引号字符串；反斜杠单引号产生单引号；最后一个单引号开始一个新的单引号字符串。如果您需要为 eval 或类似的东西转义这些字符，那真的很麻烦。

另一个问题是 - 为什么不启动编辑器。因为我是一个顽固的 vim 疯子（好吧 - 我已经使用 vi 超过 20 年了，所以它比其他替代品更容易），我将 Korn shell 设置为 vi 模式（set -o vi），并且可以执行 escape-v 以在我输入的任何内容上启动编辑器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T12:55:41.737

这是一个务实的答案，但是当这对我来说是个问题时，我通常会这样做：

```
strings ~/.history | grep COMMAND 
```

或者

```
strings ~/.history | tail 
```

（历史文件中有一点二进制数据，因此是“字符串”）

# .net - .Net Web 服务日志记录

> ID：141781
> 
> 赞同：7
> 
> 时间：2008-09-26T20:31:27.337
> 
> 标签：.net, web-services, logging, soap-extension

我登录 Web 服务的理想情况是记录所有方法调用（身份验证和数据访问）以及传递给它们的参数以及可能发生的错误，并将它们与关联的单个 ID 链接他们用同一个电话。此外，理想情况下，我希望能够控制是否记录所有参数，或者是否只记录方法调用。我希望能够控制是记录所有登录还是仅记录失败的登录。同样，在单个请求中检索到的所有信息都将通过 id（guid 或其他）链接在一起。

这是我理想的日志记录情况。如果有人知道如何实施所有这些并愿意搬到新罕布什尔州曼彻斯特地区... ;)

但说真的，有谁知道我将如何将收到的 Web 服务请求与错误或方法调用联系起来？我最初的尝试涉及在 Soap 扩展中搞乱，尝试添加标头（soap 或 html）以及不将任意值从扩展传递到服务本身的内容。我所有的尝试都没有成功。

我们当前的日志记录情况是将身份验证记录到一个表，将方法/业务调用记录到另一个表，将异常记录到另一个表，它们之间没有互连。有时，时间戳很有帮助，但不够可靠，无法有效调试。我们目前正在使用 .Net 2.0，有可能在年底前使用 3.5，因此如果保留对 2.0 功能的回复会更有帮助。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-26T20:39:27.397

如果可能，请使用 wcf 并实施消息记录，请参阅[http://msdn.microsoft.com/en-us/library/ms730064.aspx](http://msdn.microsoft.com/en-us/library/ms730064.aspx)

```
<system.diagnostics>
  <sources>
      <source name="System.ServiceModel.MessageLogging">
        <listeners>
                 <add name="messages"
                 type="System.Diagnostics.XmlWriterTraceListener"
                 initializeData="c:\logs\messages.svclog" />
          </listeners>
      </source>
    </sources>
</system.diagnostics>

<system.serviceModel>
  <diagnostics>
    <messageLogging 
         logEntireMessage="true" 
         logMalformedMessages="false"
         logMessagesAtServiceLevel="true" 
         logMessagesAtTransportLevel="false"
         maxMessagesToLog="3000"
         maxSizeOfMessageToLog="2000"/>
  </diagnostics>
</system.serviceModel> 
```

# python - 如何转储整个 Python 进程以供以后调试检查？

> ID：141802
> 
> 赞同：26
> 
> 时间：2008-09-26T20:34:19.827
> 
> 标签：python, debugging, coredump

我有一个处于奇怪状态的 Python 应用程序。我不想对过程进行实时调试。我可以将其转储到文件中并稍后检查其状态吗？我知道我稍后在 gdb 中恢复了 C 程序的核心文件，但我不知道如何从 gdb 中以有用的方式检查 Python 应用程序。

（这是我关于[在生产系统中调试 memleaks 的](https://stackoverflow.com/questions/141351/how-do-i-find-what-is-using-memory-in-a-python-process-in-a-production-system)问题的一个变体。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T20:38:17.633

除了中止（使用 os.abort()，在资源限制允许的情况下导致核心转储）之外，没有其他内置方法——尽管您当然可以构建自己的“转储”功能，转储有关您关心的数据的相关信息。没有现成的工具。

至于处理 Python 进程的核心文件，[Python 源有一个 gdbinit 文件](http://svn.python.org/projects/python/trunk/Misc/gdbinit)，其中包含有用的宏。它仍然比以某种方式进入进程本身（使用 pdb 或交互式解释器）要痛苦得多，但它让生活变得更轻松一些。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:30:33.530

上面有人说没有内置的方法可以执行此操作，但这并不完全正确。例如，您可以查看 pylons 调试工具。当出现异常时，异常处理程序会保存堆栈跟踪并在控制台上打印一个 URL，该 URL 可用于通过 HTTP 检索调试会话。

虽然它们可能将这些会话保存在内存中，但它们只是 python 对象，因此没有什么可以阻止您对堆栈转储进行腌制并在以后恢复它以供检查。这将意味着对应用程序进行一些更改，但应该有可能......

经过一番研究，事实证明相关代码实际上来自 Paste 的[EvalException 模块](http://svn.pythonpaste.org/Paste/trunk/paste/evalexception/evalcontext.py)。您应该能够查看那里以确定您需要什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-02T12:30:03.527

也可以编写一些东西来转储进程中的所有**数据**，例如

*   Pickler 忽略它不能腌制的对象（用其他东西代替它们）（例如[Python: Pickling a dict with some unpicklable items](https://stackoverflow.com/questions/4080688/)）
*   递归地将所有内容转换为可序列化的东西的方法（例如[this](https://github.com/HoverHell/pyaux/blob/36d7f1b2cf7aadec5db1d97f1ba8c93331517764/pyaux/__init__.py#L289)`dir()` ，除了它需要检查无限递归对象并对其进行处理；它还可以尝试`getattr()` 处理一些未知对象，例如扩展类）。

但是，在可能的情况下，使用检修孔或塔架或类似的东西离开运行过程当然看起来更方便。

（另外，我想知道自从第一次提出这个问题以来是否写了一些更方便的东西）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T00:15:31.417

[这个答案](https://stackoverflow.com/questions/141351/how-do-i-find-what-is-using-memory-in-a-python-process-in-a-production-system#142571)建议让你的程序核心转储，然后在另一个足够相似的盒子上继续执行。

# visual-c++ - 如何在 VC++ 2005 中重命名整个项目

> ID：141807
> 
> 赞同：1
> 
> 时间：2008-09-26T20:35:30.900
> 
> 标签：visual-c++

我为自己做了一个非常大的项目，最近一个客户要求他们自己的版本进行一些修改。项目名称相当愚蠢，我的客户想要源代码，所以我认为最好将所有文件重命名为

```
sillyname.h
sillyname.cpp
sillyname.dsp 
```

等等。不幸的是，在我将所有内容重新添加在一起之后，我看不到任何更改项目名称本身的方法。另外，现在我在编译时遇到了这个错误。

```
main.obj : error LNK2001: unresolved external symbol __imp__InitCommonControls@0
Debug/New_Name_Thats_not_so_silly.exe : fatal error LNK1120: 1 unresolved externals
Error executing link.exe. 
```

必须有一种更简单的方法来改变这一切，对吧？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T20:46:03.353

Here is a [Step by Step](http://www.platinumbay.com/blogs/dotneticated/archive/2008/01/01/renaming-and-copying-projects-and-solutions.aspx) on Steve Andrews' blog (he works on Visual Studio at Microsoft)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:55:25.923

I haven't verified this, but I've done this a number of times and if my memory serves me right, you can actually use the search-and-replace functionality in VS2005 to rename all instances of the string "X" to "Y" in any type of file. Then you need to close the solution and change the project (and any other file with the same name regardless of extension) file name(s).

You will obviously need to do a full rebuild afterwards.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-20T13:39:48.823

我发现手动执行此操作也总是很烦人。

所以我尝试了一些通过谷歌搜索可用的工具 - 两个不起作用（这里是 VS C++），不知道，如果它们对 C# 更有用。

以下工具对我很有用：我使用了试用版，但我会为此支付 39 美元。对我来说这是值得的。它还有一个 VS 插件。不直接支持 VS 2013，至少没有提到，但是，当我查看时： [http ://www.kinook.com/CopyWiz](http://www.kinook.com/CopyWiz)

就地重命名不起作用（访问错误），但“复制时重命名”工作正常。

但我真的很想知道，它是否像某些程序员声称的那样困难。对于大多数部分文件重命名和搜索和替换项目目录中所有文本文件中的所有出现应该是一种非常简单且有效的方法。也许有人可以贡献如此困难的事情。

我大脑的理性部分禁止做梦的部分编写自己的工具——我很幸运！:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T21:01:08.717

I assume that in addition to the renamed set of files, you also still maintain a complete "parallel" set of the original files in some other directory, am I right?

Assuming you have both versions, what I would do is:

Get a file comparison tool like [Beyond Compare](http://www.google.com/search?hl=en&q=%22beyond+compare%22+%22scooter+software%22&btnG=Search) or [DiffMerge](http://www.google.com/search?hl=en&q=sourcegear+diffmerge&btnG=Search) and compare the old SLN file and the new SLN file side-by-side. Also do this for each "proj" file and any other "config" type files.

It is possible to edit these files by hand. Usually looking at what is different between two copies will help illuminate what you should do to get the second one working.

You might as well start tinkering with the renamed project by hand, anyway, given that it already isn't working. You can't make it much worse. And: you might learn some handy tricks about the XML structure of these files.

Even if you do make small mistakes when hand-tweaking this files, I have repeatedly been very impressed by how Visual Studio handles things. Visual Studio will usually tell you exactly where you got it wrong.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T20:40:22.260

您可以简单地重命名 .vcproj 或 .dsp 文件，然后创建一个新工作区 (sln dsw) 并包含重命名的项目，或者只是在 sln 文件中更改名称（它只是 xml）我不记得格式旧工作区，但它仍然是文本。

您可以手动重命名并重新包含编辑项目文件的所有 .cpp 并在其中重命名它们。

抱歉，不知道可以完成所有这些的重构工具，但可能有一个。

# ruby-on-rails - 如何忽略高亮功能中的重音符号

> ID：141808
> 
> 赞同：3
> 
> 时间：2008-09-26T20:35:38.030
> 
> 标签：ruby-on-rails

我有一个微型搜索引擎，可以突出显示我的 rails 应用程序中的搜索词。搜索会忽略重音符号，并且突出显示不区分大小写。几乎完美。但是，例如，如果我有一条带有文本“pão de queijo”的记录并搜索“pao de queijo”，**则会**返回记录，但 iext**不会**突出显示。同样，如果我搜索“pÃo de queijo”，则返回记录但未正确突出显示。

我的代码很简单：

```
<%= highlight(result_pessoa.observacoes, search_string, '<span style="background-color: yellow;">\1</span>') %> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T15:48:37.890

也许您正在直接针对 MySQL 数据库搜索 UTF-8 字符串？

正确配置的 MySQL 服务器（以及可能任何其他主流数据库服务器）将在不区分大小写和不区分重音的比较中正确执行。

不过，Ruby 的情况并非如此。从 1.8 版开始，Ruby 不支持 Unicode 字符串。因此，您从数据库服务器获得了正确的结果，但使用*gsub的 Rails 的**高亮*功能无法找到您的搜索字符串。您需要使用支持 Unicode 的字符串库（如[ICU4R ）重新实现](http://icu4r.rubyforge.org/)*高亮*。

 *** * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-17T14:49:42.360

我刚刚向 Rails 提交了一个补丁来解决这个问题。

[http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/3593-patch-support-for-highlighting-with-ignoring-special-chars](http://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets/3593-patch-support-for-highlighting-with-ignoring-special-chars)

```
 # Highlights one or more +phrases+ everywhere in +text+ by inserting it into
  # a <tt>:highlighter</tt> string. The highlighter can be specialized by passing <tt>:highlighter</tt>
  # as a single-quoted string with \1 where the phrase is to be inserted (defaults to
  # '<strong class="highlight">\1</strong>')
  #
  # ==== Examples
  #   highlight('You searched for: rails', 'rails')
  #   # => You searched for: <strong class="highlight">rails</strong>
  #
  #   highlight('You searched for: ruby, rails, dhh', 'actionpack')
  #   # => You searched for: ruby, rails, dhh
  #
  #   highlight('You searched for: rails', ['for', 'rails'], :highlighter => '<em>\1</em>')
  #   # => You searched <em>for</em>: <em>rails</em>
  #
  #   highlight('You searched for: rails', 'rails', :highlighter => '<a href="search?q=\1">\1</a>')
  #   # => You searched for: <a href="search?q=rails">rails</a>
  #
  #   highlight('Šumné dievčatá', ['šumňe', 'dievca'], :ignore_special_chars => true)
  #   # => <strong class="highlight">Šumné</strong> <strong class="highlight">dievča</strong>tá  
  #
  # You can still use <tt>highlight</tt> with the old API that accepts the
  # +highlighter+ as its optional third parameter:
  #   highlight('You searched for: rails', 'rails', '<a href="search?q=\1">\1</a>')     # => You searched for: <a href="search?q=rails">rails</a>
  def highlight(text, phrases, *args)
    options = args.extract_options!
    unless args.empty?
      options[:highlighter] = args[0] || '<strong class="highlight">\1</strong>'
    end
    options.reverse_merge!(:highlighter => '<strong class="highlight">\1</strong>')

    if text.blank? || phrases.blank?
      text
    else
      haystack = text.clone
      match = Array(phrases).map { |p| Regexp.escape(p) }.join('|')
      if options[:ignore_special_chars]
        haystack = haystack.mb_chars.normalize(:kd)
        match = match.mb_chars.normalize(:kd).gsub(/[^\x00-\x7F]+/n, '').gsub(/\w/, '\0[^\x00-\x7F]*')
      end
      highlighted = haystack.gsub(/(#{match})(?!(?:[^<]*?)(?:["'])[^<>]*>)/i, options[:highlighter])
      highlighted = highlighted.mb_chars.normalize(:kc) if options[:ignore_special_chars]
      highlighted
    end
  end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-26T11:28:55.180

这是我的[文章](http://codingwithlove.com/thoughts/searching-documents-with-accented-characters)，它解释了不需要 Rails 或 ActiveSupport 的优雅解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:38:03.407

听起来您正在使用两种不同的方法来确定是否发生匹配：一种用于搜索，另一种用于突出显示。使用与搜索突出显示相同的方法，它应该会选择它，不是吗？

# ms-access - 如何以编程方式修复（不仅仅是压缩）Access .mdb 文件？

> ID：141810
> 
> 赞同：2
> 
> 时间：2008-09-26T20:35:45.313
> 
> 标签：ms-access

我有一个损坏的数据库。如果我在 MS Access 中打开它，MS Access 会提供修复它，它会成功。

我怎么能用代码做到这一点？在未安装 MS Access 的机器上。

我通过尝试知道 JRO.JetEngine.CompactDatabase 不起作用。

换句话说，我想做 Access 或 JETCOMP.exe 正在做的事情，而不是 JRO.JetEngine.CompactDatabase 正在做的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-27T22:57:25.263

您需要访问[http://support.microsoft.com](http://support.microsoft.com)并搜索 JetComp.exe 实用程序，该实用程序将尝试在不打开文件的情况下修复和压缩您的 MDB。上述建议都不起作用的原因是因为他们必须打开 MDB 才能完成工作，而 JetComp 不会打开文件，而是在结构上对其进行操作。

如果它无法恢复您的文件（确实发生了），那么您将不得不去数据恢复服务。我推荐 PKSolutions.com 的 Peter Miller。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T20:43:47.277

Command-line switch for opening a .mdb file:

```
/compact 
```

It repairs and compacts the database file.

If you leave out a target file name following the /compact switch, the file is compacted to the original name and folder. To compact to a different name, specify a target file.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:48:00.667

Have you tried DBEngine.RepairDatabase [my.mdb]? (which doesn't seem to work any more even when you reference an earlier version)

However, if is happening so often that you need to code it, you probably have a bigger problem you should be solving first.

If you are willing to use separate utility, how about the Jetcomp.exe utility ([http://support.microsoft.com/kb/295334](http://support.microsoft.com/kb/295334) ). It is supposed to "be able to recover some databases that the Microsoft Access compact utility and the CompactDatabase method cannot." In which case, all you need to do is execute the external application.

e.g.,

```
Call Shell("Jetcomp.exe <arguments>") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:40:47.597

我不是 MS Acccess 专家，但看起来[这个实用程序](http://www.codetoad.com/vb_compact_db.asp)包含压缩和修复损坏的数据库文件所需的 DLL。

# haskell - 哪个 Haskell 包包含给定模块

> ID：141820
> 
> 赞同：15
> 
> 时间：2008-09-26T20:37:57.010
> 
> 标签：haskell, cabal, hackage

我知道一个 Haskell 模块名称，但我不知道它是在哪个包中定义的。这很糟糕，因为我无法在没有暴露此模块的包的情况下进行编译。

特别是我找不到的 Text.Regex ，但我想知道如何解决这个问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-26T20:42:07.013

[http://www.haskell.org/ghc/docs/latest/html/users_guide/packages.html](http://www.haskell.org/ghc/docs/latest/html/users_guide/packages.html)

ghc-pkg 查找模块 Text.Regex

但这仅适用于 (a) 最近的 GHC，和 (b) 安装在您系统上的软件包。

您还可以通过 grep 搜索包文件（例如 /usr/lib/ghc-6.8.2/package.conf）来查看已安装的内容。

您还可以使用 haskell API 搜索引擎[hoogle](http://www.haskell.org/hoogle/)或[hackage](http://hackage.haskell.org/packages/hackage.html)搜索引擎[hayoo](http://holumbus.fh-wedel.de/hayoo/hayoo.html)。

Text.Regex 位于包 regex-base 中，还有一些其他的构建在它之上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-11T20:47:51.953

如果你正在使用 Cabal 并且你已经安装了包，你可以尝试用 编译它`cabal build`，Cabal 会告诉你忘记添加哪个包到你的依赖项中：

```
Main.hs:1:8:
    Could not find module `Text.Regex':
      It is a member of the hidden package `regex-compat-0.93.1'.
      Perhaps you need to add `regex-compat' to the build-depends in your .cabal file.
      Use -v to see a list of the files searched for. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-17T19:24:46.150

最好的工具是：

*   [胡闹](http://www.haskell.org/hoogle/)；或者
*   [嘿嘿](http://holumbus.fh-wedel.de/hayoo/hayoo.html)_

两者都是 Haskell 模块和函数的搜索引擎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-23T20:45:19.627

如果您使用 Debian 和 Debian 提供的软件包，则有一个全局文档索引，在`/usr/share/doc/ghc-doc/html/libraries/index.html`该索引的最后一列中列出了软件包。

# sql-server - sql 2005 回滚事务

> ID：141828
> 
> 赞同：1
> 
> 时间：2008-09-26T20:38:39.083
> 
> 标签：sql-server

我刚刚 **从表中删除**

如何回滚或取消删除行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T20:40:27.860

如果你`begin transaction`在做之前打电话，还没有打电话`commit`，那么你可以打电话`rollback`，否则......你将不得不恢复

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T21:21:43.550

假设您最近对数据库进行了完整备份，请立即备份您的事务日志，并将其还原到删除之前的某个时间点。如果有从那时起更改的实时数据，您可能希望将其恢复到不同的数据库，并手动插入已删除的记录。

从记忆中，所以语法可能有点偏离 - 但你明白了：

```
BACKUP LOG DBName
   TO DISK='C:\DBName.TRN'
GO

RESTORE DATABASE DBName2
   FROM DISK='C:\DBName.BAK'
   WITH 
       MOVE 'DBName.MDF' TO 'C:\DBName2.MDF',
       MOVE 'DBName.LDF' TO 'C:\DBName2.LDF',
       NORECOVERY
GO

RESTORE LOG DBName2
   FROM DISK='C:\DBName.TRN'
   WITH
       RECOVERY,
       STOPAT = '09/26/2008 17:00'
GO 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T20:40:12.167

从备份中恢复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:55:24.643

假设你有钱，这会成功：[http ://www.lumigent.com/products/log_explorer.html](http://www.lumigent.com/products/log_explorer.html)

除此之外，备份，就像其他人所说的那样

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T20:40:42.633

如果您以 begin tran 开头删除，则只需使用 rollback tran

如果没有，请开始寻找您的备份。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:41:39.497

```
rollback; 
```

但只有当你在交易中..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T20:54:09.077

我在没有备份的数据库上做过一次，并且能够使用重放所有事务日志条目的实用程序来恢复数据。幸运的是，在我的情况下，我从未截断过事务日志。

# user-interface - 以编程方式淡化颜色

> ID：141855
> 
> 赞同：76
> 
> 时间：2008-09-26T20:43:35.590
> 
> 标签：user-interface, language-agnostic, colors

**动机**

我想找到一种方法来获取任意颜色并使其变亮一些阴影，这样我就可以通过编程创建一个从一种颜色到较浅版本的漂亮渐变。渐变将用作 UI 中的背景。

**可能性 1**

显然，我可以将 RGB 值分开并单独增加一定量。这真的是我想要的吗？

**可能性 2**

我的第二个想法是将 RGB 转换为 HSV/HSB/HSL（色相、饱和度、值/亮度/亮度），稍微增加亮度，降低饱和度，然后将其转换回 RGB。这通常会产生预期的效果吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-26T20:58:50.063

正如[Wedge 所说](https://stackoverflow.com/questions/141855/programmatically-lighten-a-color#141865)，您想要乘以使事物更亮，但这仅在其中一种颜色变得饱和（即达到 255 或更大）之前有效。那时，您可以将值限制为 255，但随着颜色变浅，您会巧妙地改变色调。为了保持色调，您希望保持（中-最低）/（最高-最低）的比率。

这是 Python 中的两个函数。第一个实现了简单的方法，如果它们超过，它只会将 RGB 值钳制为 255。第二个重新分配多余的值以保持色调不变。

```
def clamp_rgb(r, g, b):
    return min(255, int(r)), min(255, int(g)), min(255, int(b))

def redistribute_rgb(r, g, b):
    threshold = 255.999
    m = max(r, g, b)
    if m <= threshold:
        return int(r), int(g), int(b)
    total = r + g + b
    if total >= 3 * threshold:
        return int(threshold), int(threshold), int(threshold)
    x = (3 * threshold - total) / (3 * m - total)
    gray = threshold - x * m
    return int(gray + x * r), int(gray + x * g), int(gray + x * b) 
```

我创建了一个从 RGB 值 (224,128,0) 开始的渐变，并将其乘以 1.0、1.1、1.2 等，直到 2.0。上半部分是使用的结果`clamp_rgb`，下半部分是使用的结果`redistribute_rgb`。我认为很容易看出重新分配溢出会产生更好的结果，而不必离开 RGB 颜色空间。

![具有夹紧（顶部）和重新分布（底部）的亮度梯度](https://i.stack.imgur.com/sOn1e.png)

为了比较，这里是 HLS 和 HSV 颜色空间中的相同渐变，由 Python 的[`colorsys`](https://docs.python.org/2/library/colorsys.html)模块实现。仅`L`修改了组件，并对生成的 RGB 值执行了钳位。结果相似，但需要对每个像素进行色彩空间转换。

![HLS（顶部）和 HSV（底部）的亮度梯度](https://i.stack.imgur.com/e3xtn.png)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-26T20:44:51.250

我会选择第二种选择。一般来说，RGB 空间并不适合进行颜色处理（创建从一种颜色到另一种颜色的过渡，使颜色变亮/变暗等）。以下是我通过快速搜索找到的两个网站，可将 RGB 转换为 HSL 或从 HSL 转换为 RGB：

*   [来自“计算机图形学基础”](http://marcocorvi.altervista.org/games/imgpr/rgb-hsl.htm)
*   [C# 中的一些源代码](http://www.geekymonkey.com/Programming/CSharp/RGB2HSL_HSL2RGB.htm)- 应该很容易适应其他编程语言。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-09-26T20:46:04.667

在 C# 中：

```
public static Color Lighten(Color inColor, double inAmount)
{
  return Color.FromArgb(
    inColor.A,
    (int) Math.Min(255, inColor.R + 255 * inAmount),
    (int) Math.Min(255, inColor.G + 255 * inAmount),
    (int) Math.Min(255, inColor.B + 255 * inAmount) );
} 
```

我到处都用过这个。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-21T10:45:24.040

System.Windows.Forms 命名空间中的 ControlPaint 类具有静态方法 Light 和 Dark：

```
public static Color Dark(Color baseColor, float percOfDarkDark); 
```

这些方法使用 HLSColor 的私有实现。我希望这个结构是公开的并且在 System.Drawing 中。

或者，您可以在 Color 结构上使用 GetHue、GetSaturation、GetBrightness 来获取 HSB 组件。不幸的是，我没有找到反向转换。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-26T20:47:08.250

将其转换为 RGB 并在原始颜色和目标颜色（通常为白色）之间进行线性插值。因此，如果您想要两种颜色之间的 16 种色调，您可以：

```
 for(i = 0; i < 16; i++)
{
  colors[i].R = start.R + (i * (end.R - start.R)) / 15;
  colors[i].G = start.G + (i * (end.G - start.G)) / 15;
  colors[i].B = start.B + (i * (end.B - start.B)) / 15;
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-10-24T08:34:15.453

为了获得给定颜色的更亮或更暗版本，您应该修改其亮度。即使不将颜色转换为 HSL 或 HSB 颜色，您也可以轻松完成此操作。例如，要使颜色变浅，您可以使用以下代码：

```
float correctionFactor = 0.5f;
float red = (255 - color.R) * correctionFactor + color.R;
float green = (255 - color.G) * correctionFactor + color.G;
float blue = (255 - color.B) * correctionFactor + color.B;
Color lighterColor = Color.FromArgb(color.A, (int)red, (int)green, (int)blue); 
```

如果您需要更多详细信息，[请阅读我博客上的完整故事](http://www.pvladov.com/2012/09/make-color-lighter-or-darker.html)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-26T20:46:14.307

转换为 HS(LVB)、增加亮度然后转换回 RGB 是唯一可靠地使颜色变亮而不影响色相和饱和度值的方法（即仅使颜色变亮而不以任何其他方式改变它）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-26T20:45:50.937

之前提出了一个非常相似的问题，并提供了有用的答案： [如何确定给定颜色的较深或较浅颜色变体？](https://stackoverflow.com/questions/97646/how-do-i-determine-darker-or-lighter-color-variant-of-a-given-color)

简短的回答：如果您只需要“足够好”，则将 RGB 值乘以一个常数，如果您需要准确性，则转换为 HSV。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-01-23T18:27:33.187

我使用安德鲁的答案和马克的答案来做到[这一点](http://jsfiddle.net/ySGm2/1/)（截至 1/2013，ff 没有范围输入）。

```
function calcLightness(l, r, g, b) {
    var tmp_r = r;
    var tmp_g = g;
    var tmp_b = b;

    tmp_r = (255 - r) * l + r;
    tmp_g = (255 - g) * l + g;
    tmp_b = (255 - b) * l + b;

    if (tmp_r > 255 || tmp_g > 255 || tmp_b > 255) 
        return { r: r, g: g, b: b };
    else 
        return { r:parseInt(tmp_r), g:parseInt(tmp_g), b:parseInt(tmp_b) }
} 
```

![在此处输入图像描述](https://i.stack.imgur.com/ucXfL.png)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-26T20:54:56.390

我已经做到了这两种方式——使用可能性 2，你会得到更好的结果。

您为可能性 1 构建的任何简单算法可能仅适用于有限范围的起始饱和度。

如果 (1) 您可以限制使用的颜色和亮度，并且 (2) 您在渲染中执行了很多计算，您可能需要查看 Poss 1。

为 UI 生成背景不需要太多的着色计算，所以我建议 Poss 2。

-阿尔。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-21T10:47:19.670

如果您想产生渐变淡出，我建议进行以下优化：您应该只计算目标颜色，而不是为每个单独的颜色执行 RGB->HSB->RGB。一旦知道了目标 RGB，就可以简单地计算 RGB 空间中的中间值，而无需来回转换。是否计算使用某种曲线的线性过渡取决于您。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-04-22T11:57:11.193

方法一：RGB转HSL，调整HSL，转回RGB。

方法 2：*Lerp* RGB 颜色值 - [http://en.wikipedia.org/wiki/Lerp_(computing)](http://en.wikipedia.org/wiki/Lerp_(computing))

有关方法 2 的 C# 实现，请参阅[我对这个类似问题的回答。](https://stackoverflow.com/questions/97646/how-do-i-determine-darker-or-lighter-color-variant-of-a-given-color/2690026#2690026)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-12-19T16:53:58.373

假设您将 alpha 混合为白色：

```
oneMinus = 1.0 - amount
r = amount + oneMinus * r
g = amount + oneMinus * g
b = amount + oneMinus * b 
```

其中`amount`是从 0 到 1，0 返回原始颜色，1 返回白色。

如果您正在点亮以显示禁用的内容，您可能希望与任何背景颜色混合：

```
oneMinus = 1.0 - amount
r = amount * dest_r + oneMinus * r
g = amount * dest_g + oneMinus * g
b = amount * dest_b + oneMinus * b 
```

`(dest_r, dest_g, dest_b)`混合颜色在哪里，`amount`从 0 到 1，返回 0，返回`(r, g, b)`1`(dest.r, dest.g, dest.b)`

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-02-04T08:09:29.710

直到它成为与我原来的问题相关的问题之后，我才发现这个问题。

但是，使用这些出色答案的洞察力。为此，我拼凑了一个不错的两行函数：

[以编程方式使十六进制颜色变亮或变暗（或 rgb 和混合颜色）](https://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color/13542669#13542669)

它是方法 1 的一个版本。但考虑到了过度饱和。就像基思在上面的回答中所说的那样；使用 Lerp 似乎解决了 Mark 提到的相同问题，但没有重新分配。的结果`shadeColor2`应该更接近于使用 HSL 以正确的方式进行操作，但没有开销。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-04-14T19:19:45.810

派对有点晚了，但如果你使用`javascript`or `nodejs`，你可以使用[tinycolor 库](https://www.npmjs.com/package/tinycolor2)，并以你想要的方式操纵颜色：

```
tinycolor("red").lighten().desaturate().toHexString() // "#f53d3d" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-26T20:44:58.117

我会先尝试＃1，但＃2听起来不错。尝试自己做，看看你对结果是否满意，听起来你可能需要 10 分钟才能完成一次测试。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-26T20:56:32.190

从技术上讲，我认为两者都不正确，但我相信您想要选项 #2 的变体。问题在于采用 RGB 990000 并“点亮”它实际上只会添加到红色通道（值、亮度、亮度），直到你到达 FF。在那之后（纯红色），它将降低*饱和度*一直到纯白色。

转换变得烦人，特别是因为你不能直接往返于 RGB 和 Lab，但我认为你真的想分离色度和亮度值，只需修改亮度以真正实现你想要的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-05-08T01:49:18.760

这是在 Python 中点亮 RGB 颜色的示例：

```
def lighten(hex, amount):
    """ Lighten an RGB color by an amount (between 0 and 1),

    e.g. lighten('#4290e5', .5) = #C1FFFF
    """
    hex = hex.replace('#','')
    red = min(255, int(hex[0:2], 16) + 255 * amount)
    green = min(255, int(hex[2:4], 16) + 255 * amount)
    blue = min(255, int(hex[4:6], 16) + 255 * amount)
    return "#%X%X%X" % (int(red), int(green), int(blue)) 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-11-26T14:28:55.413

这是基于 Mark Ransom 的[回答](https://stackoverflow.com/a/141943/1262865)。

当`clampRGB`函数试图保持色调时，它会错误地计算缩放以保持相同的亮度。这是因为计算直接使用非线性的 sRGB 值。

`clampRGB`这是一个与保持亮度相同（尽管值范围从 0 到 1）的 Java 版本：

```
private static Color convertToDesiredLuminance(Color input, double desiredLuminance) {
  if(desiredLuminance > 1.0) {
    return Color.WHITE;
  }
  if(desiredLuminance < 0.0) {
    return Color.BLACK;
  }

  double ratio = desiredLuminance / luminance(input);
  double r = Double.isInfinite(ratio) ? desiredLuminance : toLinear(input.getRed()) * ratio;
  double g = Double.isInfinite(ratio) ? desiredLuminance : toLinear(input.getGreen()) * ratio;
  double b = Double.isInfinite(ratio) ? desiredLuminance : toLinear(input.getBlue()) * ratio;

  if(r > 1.0 || g > 1.0 || b > 1.0) {  // anything outside range?
    double br = Math.min(r, 1.0);  // base values
    double bg = Math.min(g, 1.0);
    double bb = Math.min(b, 1.0);
    double rr = 1.0 - br;  // ratios between RGB components to maintain
    double rg = 1.0 - bg;
    double rb = 1.0 - bb;

    double x = (desiredLuminance - luminance(br, bg, bb)) / luminance(rr, rg, rb);

    r = 0.0001 * Math.round(10000.0 * (br + rr * x));
    g = 0.0001 * Math.round(10000.0 * (bg + rg * x));
    b = 0.0001 * Math.round(10000.0 * (bb + rb * x));
  }

  return Color.color(toGamma(r), toGamma(g), toGamma(b));
} 
```

及配套功能：

```
private static double toLinear(double v) {  // inverse is #toGamma
  return v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
}

private static double toGamma(double v) {  // inverse is #toLinear
  return v <= 0.0031308 ? v * 12.92 : 1.055 * Math.pow(v, 1.0 / 2.4) - 0.055;
}

private static double luminance(Color c) {
  return luminance(toLinear(c.getRed()), toLinear(c.getGreen()), toLinear(c.getBlue()));
}

private static double luminance(double r, double g, double b) {
  return r * 0.2126 + g * 0.7152 + b * 0.0722;
} 
```

# java - Java, unicode and fonts

> ID：141859
> 
> 赞同：3
> 
> 时间：2008-09-26T20:44:16.183
> 
> 标签：java, unicode, fonts, internationalization

I've looked at the java documentation and scoured the net for information on java's support for international characters with specific fonts (such as Monospace), but haven't been able to get a clear concrete answer.

There has been a change between java 1.4 and java 1.5/1.6\. For example, in java 1.4 if you set the font on a JTextArea to Monospace, it won't be able to handle foreign characters (get rectangles instead), but in java 1.5/1.6 it seems to work fine.

Are these differences/improved support clearly documented anywhere?

Thanks

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T21:12:12.807

来自[国际化增强](http://java.sun.com/j2se/1.5.0/docs/guide/intl/enhancements.html)：

> **多语言文本渲染**
> 
> 为了渲染多语言文本，使用逻辑字体，2D 现在利用所有支持的书写系统安装的主机操作系统字体。例如，如果您在泰语语言环境中运行，但安装了韩语字体，则会同时呈现泰语和韩语。JRE 现在还自动检测安装到其 lib/fonts/fallback 目录中的物理字体，并将这些物理字体添加到所有逻辑字体以进行 2D 渲染。
> 
> **在 Windows 上使用 Unicode API**
> 
> AWT 现在在 Windows 2000/XP 上使用 Unicode API。因此，它的某些组件可以处理文本而不受 Windows 区域设置的限制。*例如，无论 Windows 区域设置如何，AWT 文本组件都可以接受和显示梵文书写系统中的文本。*（强调我的）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-27T00:10:04.300

这些角色有多“外国”？大多数基于拉丁文的字体至少可以处理 ISO-8859-1 上半部分中的重音字母和其他字符，但我认为您不能合理地指望对除此之外的任何内容的支持。

您最好的选择通常是让用户从您从底层操作系统检索的受支持字体列表中进行选择。如果不能这样做，或者不想这样做，您可以采用 CSS 方法：遍历可接受字体的列表并使用您找到的第一个安装的字体。

要填充列表，只需谷歌搜索“程序员字体”或“等宽字体”。我从不喜欢 Java 的任何逻辑字体，尤其是 Monospace，它在 Windows 机器上是 Courier 或 Courier New。我几年前就停止使用它了。

# .net - 通过 WCF 发送 XML 是否存在问题？

> ID：141863
> 
> 赞同：2
> 
> 时间：2008-09-26T20:45:15.183
> 
> 标签：.net, xml, wcf

假设您有要通过 WCF 发送的 XElement 或 XmlElment 甚至包含 xml 的字符串。你有什么特别的预防措施吗？刚刚出现的问题是，当您在 xml 消息中传输 xml 文档声明 (<?xml version='1.0' ?>) 时会发生什么，如果序列化 XmlDocument...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T13:45:37.123

只是想我会补充一点，在大多数情况下，这些将是配置更改，除非您通过代码进行所有绑定设置。

具体来说，您可能需要调整绑定的 MaxReceivedMessageSize 属性和接收端的读取器配额。

这与发送 XML 无关，顺便说一句，它只是在您发送较大消息时出现，因为默认配额非常保守（例如，最大消息大小为 64kb）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T23:18:15.830

我用 WCF 将 XML 作为字符串发送没有问题。如果您的 XML 超过几 Kb，则必须在客户端和服务器中进行更改以允许更大的数据量。

# c++ - C++ 映射的运算符重载

> ID：141864
> 
> 赞同：2
> 
> 时间：2008-09-26T20:45:19.673
> 
> 标签：c++, templates

我需要帮助理解一些 C++ 运算符重载语句。该类声明如下：

```
template <class key_t, class ipdc_t>
class ipdc_map_template_t : public ipdc_lockable_t
{
    ...
    typedef map<key_t,
            ipdc_t*,
            less<key_t>> map_t;
    ... 
```

类的创建者为内部映射结构创建了一个迭代器：

```
struct iterator : public map_t::iterator
{
    iterator() {}
    iterator(const map_t::iterator & it)
        : map_t::iterator(it) {}
    iterator(const iterator & it)
        : map_t::iterator(
            *static_cast<const map_t::iterator *>(&it)) {}
    operator key_t() {return ((this->operator*()).first);}           // I don't understand this.
    operator ipdc_t*() const {return ((this->operator*()).second);}  // or this.

}; 
```

begin() 和 end() 返回地图的 begin() 和 end()：

```
iterator begin() {IT_ASSERT(is_owner()); return map.begin();}
iterator end() {return map.end();} 
```

我的问题是，如果我有一个迭代器，我如何使用这些重载来获取键和值？

```
ipdc_map_template_t::iterator iter;
    for( iter = my_instance.begin();
             iter != my_instance.end();
         ++iter )
    {
        key_t my_key = ??????;
        ipdc_t *my_value = ??????;

    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T20:55:23.893

这些是类型转换运算符，因此您可以这样做：

```
{
    key_t   key = iter;
    ipdc_t *val = iter;
} 
```

或者，由于`ipdc_map_template::iterator`是 的子类`std::map::iterator`，您仍然可以使用原始访问器（我发现它更具可读性）：

```
{
    key_t   key = (*iter).first;
    ipdc_t *val = (*iter).second;

    // or, equivalently
    key_t   key = iter->first;
    ipdc_t *val = iter->second;

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T20:51:04.137

类的创建者已经覆盖了强制转换运算符。因此，只需将 iter 分配给正确类型的对象，它就应该通过方法自动将自身转换为正确的值。

**注意**：值类型被存储为指针。因此，当您提取值时，您需要指定指向您在映射接口中指定的值类型的指针。

```
 typedef ipdc_map_template_t<int,std::string>   MyMap;
 MyMap    mymap;

 for(MyMap::iterator iter = mymap.begin();
                     iter != mymap.end();
                     ++iter )
    {
            int          my_key   = iter;
            std::string* my_value = iter;

    } 
```

不确定我是否同意这里采取的方向。这是否使代码更具可读性？我会坚持使用老式的地图迭代器听起来更有用。这个容器是在您需要的某个专用库中定义的，还是查看 boost 指针容器是否有益？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T20:51:59.940

operator key_t() 和 operator ipdc_t*() 都是强制转换定义。因此，给定类中定义的迭代器，您应该能够简单地分配变量：

```
ipdc_map_template_t::iterator iter;
    for( iter = my_instance.begin();
         iter != my_instance.end();
         ++iter )
    {
            key_t my_key = iter;
            ipdc_t my_value = iter;
    } 
```

# .net - 内部 IT 环境中日志文件的最佳位置

> ID：141869
> 
> 赞同：1
> 
> 时间：2008-09-26T20:46:09.080
> 
> 标签：.net, logging

我所有的用户都在大厅里走一小段路，我的所有程序都在同一个 LAN 上的工作站上运行。几年前，我让员工将他们所有程序的日志文件写入共享文件夹层次结构，在以应用程序命名的子目录中以机器名称命名每个日志文件。

但这种安排并不是那么好，因为如果文件服务器出现故障，那么任何地方的程序都无法写入日志。然而，将日志保存在每个工作站本地会使我们在必须调试问题时阅读它们变得很痛苦。

我们尝试为日志文件服务器创建 DNS 别名，以便在必要时将其指向备份计算机，但 DNS 别名不适用于 Windows 文件共享。

将共享日志文件夹的路径放在每个程序中并不是很好——即使它是现场可配置的——因为我们在几十台机器上有几十个程序。

我们也研究过使用微软的分布式文件系统，但价格太离谱了。

我想要一种将本地网络上许多程序的日志收集到一个地方的方法，这样我就可以在不访问远程机器的情况下跟踪和分析它们。我们的所有程序都使用 .Net。

**编辑：**我想避免在每个用户的工作站上设置文件共享，或者每晚拖网日志的解决方案，因为我希望能够按需读取新日志，或者在报告问题后的片刻。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T20:48:31.087

在我几年前工作的 IT 环境中，我们让每台机器在本地写入日志文件，并每五天擦除一次。服务器每天晚上都会登录以从每台机器上获取最新的日志。如果服务器出现故障，它只会从每个人那里获取两天的日志。如果客户端出现故障，它的日志也可以在第二天被抓取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:06:42.727

您可以使用[MSMQ](http://www.microsoft.com/windowsserver2003/technologies/msmq/default.mspx "微软消息队列")。将您的日志写入 MSMQ 队列，然后有一个服务来挑选这些日志并将它们放入数据库中，或者如果您愿意，可以将它们放入中央位置的文件中。它不会是即时的，但您可以告诉它在您想要获取新的日志条目时运行。另外，由于它使用 MSMQ，因此它是可靠的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T21:16:54.747

我们的商店在将日志存储在数据库表中方面有很好的经验。您可以随时将清理安排为数据库作业，以防止它变得太大。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T22:33:36.873

我们使用登录到本地共享的已知位置的方法。然后很容易让第二个进程提取这些日志以供以后处理（转储到数据库、收集和存档等）。如果收集过程终止，则不会真正受到影响。

确保您没有中心故障点。我见过这样的例子，它使用了一个所有应用程序都依赖的中央日志数据库，当它出现故障时，其他*所有*东西也都这样做了。不聪明。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T20:48:46.140

您能否将日志文件写入人们的本地计算机，然后有一个脚本将它们作为夜间批处理作业拉到公共文件服务器？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T21:02:58.353

将您的应用程序的记录器作为订阅者服务（使用远程处理）怎么样。然后实现订阅应用程序的 LogServer。当应用程序有要记录的内容时，它会将其发送给订阅者。如果出现问题，例如订阅者没有响应/死亡并且您没有工作订阅者，请在本地写入但发出警报。例如 TraceListener 和 Debug 类的多机版本。

您几乎肯定希望应用程序将日志消息从不同的线程发送到应用程序的其余部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-26T21:11:24.900

我们编写了一个托管其他应用程序的应用程序（插件架构）。发生异常时，必要的信息将写入用户机器上的 XML 文件（名为 <USERNAME>.xml）。无论是根据我们的请求还是应用程序退出时，它都会将 XML 发送到 Web 服务，在那里它将文件写入我们可以去检查它们的位置。

如果 Web 服务关闭，这没什么大不了的，因为 XML 文件仍在用户的机器上，并且会在他们下次运行应用程序时被上传。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T21:13:42.040

[DFS](http://technet.microsoft.com/en-us/library/cc758523.aspx)包含在 Windows Server 中，您可以注册以使用[CNAME](http://support.microsoft.com/default.aspx?scid=kb;en-us;281308&Product=win2000)启用 NetBIOS。

我还尝试使用[Splunk](http://www.splunk.com/)提取和分析日志文件，但它有点占用 CPU，而且我无法节省马力。但是，否则，它是一个非常不错的产品。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T21:30:50.127

也写入数据库（如[CALM](http://www.nov8r.com/calm.aspx)），因此您只需在数据库关闭时查看日志文件

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-09T01:37:23.993

我同意[craigb](https://stackoverflow.com/users/18590/craigb)的评论。在 LAN 环境中应避免产生额外的单点故障。

My preference is to have the clients log locally, and then copy these log files to a central location. In this case if your log server falls over then there won't be any serious outage. Additionally, sometimes writing a log file to a network can be performance bottleneck.

Another issue with the central log server is if one application misbehaves, it can take down all the apps. I've seen countless bugs, which when encountered cause the program to enter an infinite loop and spew logs messages until the device fills up.

如果您真的需要中央日志记录，出于合规性原因或其他原因，我会写入网络驱动器，或者以[syslogd](http://linux.about.com/od/commands/l/blcmdl8_syslogd.htm)的方式写入套接字。由于 syslogd 非常标准，因此在服务器上设置它应该没有任何问题，并且有大量示例代码和库可以写入它。甚至可以将硬件负载平衡配置为位于两个或更多 syslogd 服务器的前面，从而提供更高的服务可用性。

# antlr - Antlr: Simplest way to recognize dates and numbers?

> ID：141875
> 
> 赞同：5
> 
> 时间：2008-09-26T20:46:55.023
> 
> 标签：antlr, grammar

What is the simplest (shortest, fewest rules, and no warnings) way to parse both valid dates and numbers in the same grammar? My problem is that a lexer rule to match a valid month (1-12) will match any occurrence of 1-12\. So if I just want to match a number, I need a parse rule like:

```
number: (MONTH|INT); 
```

It only gets more complex when I add lexer rules for day and year. I want a parse rule for date like this:

```
date: month '/' day ( '/' year )? -> ^('DATE' year month day); 
```

I don't care if month,day & year are parse or lexer rules, just so long as I end up with the same tree structure. I also need to be able to recognize numbers elsewhere, e.g.:

```
foo: STRING OP number -> ^(OP STRING number);
STRING: ('a'..'z')+;
OP: ('<'|'>'); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T21:14:13.957

The problem is that you seem to want to perform both syntactical and semantical checking in your lexer and/or your parser. It's a common mistake, and something that is only possible in very simple languages.

What you really need to do is accept more broadly in the lexer and parser, and then perform semantic checks. How strict you are in your lexing is up to you, but you have two basic options, depending on whether or not you need to accept zeroes preceding your days of the month: 1) Be really accepting for your INTs, 2) define DATENUM to only accept those tokens that are valid days, yet not valid INTs. I recommend the second because there will be less semantic checks necessary later in the code (since INTs will then be verifiable at the syntax level and you'll only need to perform semantic checks on your dates. The first approach:

```
INT: '0'..'9'+; 
```

The second approach:

```
DATENUM: '0' '1'..'9';
INT: '0' | SIGN? '1'..'9' '0'..'9'*; 
```

After accepting using these rules in the lexer, your date field would be either:

```
date: INT '/' INT ( '/' INT )? 
```

or:

```
date: (INT | DATENUM) '/' (INT | DATENUM) ('/' (INT | DATENUM) )? 
```

After that, you would perform a semantic run over your AST to make sure that your dates are valid.

If you're dead set on performing semantic checks in your grammar, however, ANTLR allows semantic predicates in the parser, so you could make a date field that checks the values like this:

```
date: month=INT '/' day=INT ( year='/' INT )? { year==null ? (/* First check /*) : (/* Second check */)} 
```

When you do this, however, you are embedding language specific code in your grammar, and it won't be portable across targets.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-07-29T21:32:59.543

Using ANTLR4, here is a simple combined grammar that I used. It makes use of the lexer to match simple tokens only, leaving the parser rules to interpret dates vs numbers.

```
// parser rules

date 
    : INT SEPARATOR month SEPARATOR INT
    | INT SEPARATOR month SEPARATOR INT4
    | INT SEPARATOR INT SEPARATOR INT4;

month : JAN | FEB | MAR | APR | MAY | JUN | JUL | AUG | SEP | OCT | NOV | DEC ;

number : FLOAT | INT | INT4 ;

// lexer rules

FLOAT : DIGIT+ '.' DIGIT+ ;

INT4 : DIGIT DIGIT DIGIT DIGIT;
INT : DIGIT+;

JAN : [Jj][Aa][Nn] ;
FEB : [Ff][Ee][Bb] ;
MAR : [Mm][Aa][Rr] ;
APR : [Aa][Pp][Rr] ;
MAY : [Mm][Aa][Yy] ; 
JUN : [Jj][Uu][Nn] ;
JUL : [Jj][Uu][Ll] ;
AUG : [Aa][Uu][Gg] ;
SEP : [Ss][Ee][Pp] ; 
OCT : [Oo][Cc][Tt] ; 
NOV : [Nn][Oo][Vv] ;
DEC : [Dd][Ee][Cc] ;

SEPARATOR : [/\\\-] ;

fragment DIGIT : [0-9]; 
```

# vb6 - VB6 中的应用程序标题截断

> ID：141876
> 
> 赞同：4
> 
> 时间：2008-09-26T20:46:55.833
> 
> 标签：vb6

平台：Windows XP 开发平台：VB6

当尝试通过 Make 选项卡上的 Project Properties 对话框设置应用程序标题时，它似乎会在设定的字符数处默默地切断标题。还通过 App.Title 属性尝试了这个，它似乎遇到了同样的问题。我不在乎这个，但 QA 部门坚持认为我们需要显示整个标题。

有没有人有解决方法或解决这个问题？

* * *

编辑：对于那些回答了 40 个字符限制的人，这就是我所怀疑的——因此我对可能的解决方法提出了问题 :-) 。

实际上，我发布这个问题是为了帮助一位开发人员，所以当我周一见到她时，我会向她指出你所有的优秀建议，看看是否有任何人能帮助她解决这个问题。我确实知道，出于某种原因，应用程序显示的某些对话框似乎从 App.Title 设置中提取了字符串，这就是为什么她问我关于字符串长度限制的原因。

我只是希望我能从微软那里找到一些明确的东西（比如某种 KB 注释），这样她就可以把它展示给我们的 QA 部门，这样他们就会意识到这只是 VB 的一个限制。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-27T10:58:18.360

MsgBox-Function 接受标题的参数。如果您不想更改对 MsgBox-Function 的每次调用，您可以“覆盖”默认行为：

```
Function MsgBox(Prompt, Optional Buttons As VbMsgBoxStyle = vbOKOnly, Optional Title, Optional HelpFile, Optional Context) As VbMsgBoxResult
    If IsMissing(Title) Then Title = String(40, "x") & "abc"
    MsgBox = Interaction.MsgBox(Prompt, Buttons, Title, HelpFile, Context)
End Function 
```

编辑：正如 Mike Spross 所说：这只隐藏了正常的 MsgBox-Function。如果您想从另一个项目访问您的自定义 MsgBox，则必须对其进行限定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T21:53:47.030

我刚刚在 IDE 中创建了一个标准 EXE 项目，并在 Project Properties Make 选项卡下的应用程序标题字段中键入了文本，直到我填写了该字段。从这个快速测试中，App.Title 似乎被限制为 40 个字符。接下来，我通过将以下代码放入为项目创建的默认表单（Form1）中，在代码中进行了尝试：

```
Private Sub Form_Load()
    App.Title = String(41, "X")
    MsgBox Len(App.Title)
End Sub 
```

此快速测试确认了 40 个字符的限制，因为 MsgBox 显示 40，即使代码尝试将 App.Title 设置为 41 个字符的字符串。

如果让完整的字符串显示在表单的标题栏中真的很重要，那么我能想到的确保显示整个标题的唯一方法就是获取标题栏文本的宽度并使用它来增加宽度您的表单，以便它可以容纳完整的标题字符串。如果我能找到正确的 API 咒语，我可能会回来并为此发布代码，但它在 Form_Load 事件中可能看起来像这样：

```
Dim nTitleBarTextWidth As Long
Dim nNewWidth As Long

Me.Caption = "My really really really really really long app title here"

' Get titlebar text width (somehow) '
nTitleBarTextWidth = GetTitleBarTextWidth()

' Compute the new width for the Form such that the title will fit within it '
' (May have to add a constant to this to make sure the title fits correctly) '
nNewWidth = Me.ScaleX(nTitleBarTextWidth, vbPixels, Me.ScaleMode)

' If the new width is bigger than the forms current size, use the new width '
If nNewWidth > Me.Width Then
    Form.Width = nNewWidth
End If 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-27T03:59:32.300

## 一种使用 Windows API 的解决方案

**免责声明**：*恕我直言，这似乎只是为了满足问题中所述的要求，但本着对问题给出（希望）完整答案的精神，这里什么都没有......*

这是我在 MSDN 中浏览了一段时间后想出的一个工作版本，直到我终于看到一篇关于 vbAccelerator 的文章让我的车轮转动起来。

*   请参阅原始文章的[vbAccelerator](http://www.vbaccelerator.com/home/VB/Tips/Get_System_Display_Fonts_and_Non-Client_Area_Sizes/article.asp)页面（与问题没有直接关系，但那里有足够的内容让我制定答案）

基本前提是先计算窗体标题文本的宽度，然后使用**GetSystemMetrics**获取窗口各个位的宽度，如边框和窗口框架宽度，Minimize、Maximize、Close按钮的宽度，等等（为了便于阅读/清晰，我将它们分成了它们自己的函数）。我们需要考虑窗口的这些部分，以便为表单计算准确的新宽度。

为了准确计算表单标题的宽度（“范围”），我们需要获取系统标题字体，因此**SystemParametersInfo**和**CreateFontIndirect**调用以及相关的好处。

所有这些努力的最终结果是**GetRecommendedWidth**函数，它计算所有这些值并将它们相加，加上一些额外的填充，以便在标题的最后一个字符和控制按钮之间有一些空间。如果这个新宽度大于表单的当前宽度，GetRecommendedWidth 将返回这个（更大的）宽度，否则，它将返回表单的当前宽度。

我只是简单地测试了它，但它似乎工作正常。但是，由于它使用 Windows API 函数，您可能需要谨慎行事，尤其是因为它正在复制内存。我也没有添加强大的错误处理。

顺便说一句，如果有人有更干净、更少参与的方法，或者我在自己的代码中遗漏了某些内容，请告诉我。

**要尝试一下，请将以下代码粘贴到新模块中**

```
Option Explicit

Private Type SIZE
    cx As Long
    cy As Long
End Type

Private Const LF_FACESIZE = 32

'NMLOGFONT: This declaration came from vbAccelerator (here is what he says about it):'
'                                                                  '
' For some bizarre reason, maybe to do with byte                   '
' alignment, the LOGFONT structure we must apply                   '
' to NONCLIENTMETRICS seems to require an LF_FACESIZE              '
' 4 bytes smaller than normal:                                     '

Private Type NMLOGFONT
   lfHeight As Long
   lfWidth As Long
   lfEscapement As Long
   lfOrientation As Long
   lfWeight As Long
   lfItalic As Byte
   lfUnderline As Byte
   lfStrikeOut As Byte
   lfCharSet As Byte
   lfOutPrecision As Byte
   lfClipPrecision As Byte
   lfQuality As Byte
   lfPitchAndFamily As Byte
   lfFaceName(LF_FACESIZE - 4) As Byte
End Type

Private Type LOGFONT
   lfHeight As Long
   lfWidth As Long
   lfEscapement As Long
   lfOrientation As Long
   lfWeight As Long
   lfItalic As Byte
   lfUnderline As Byte
   lfStrikeOut As Byte
   lfCharSet As Byte
   lfOutPrecision As Byte
   lfClipPrecision As Byte
   lfQuality As Byte
   lfPitchAndFamily As Byte
   lfFaceName(LF_FACESIZE) As Byte
End Type

Private Type NONCLIENTMETRICS
   cbSize As Long
   iBorderWidth As Long
   iScrollWidth As Long
   iScrollHeight As Long
   iCaptionWidth As Long
   iCaptionHeight As Long
   lfCaptionFont As NMLOGFONT
   iSMCaptionWidth As Long
   iSMCaptionHeight As Long
   lfSMCaptionFont As NMLOGFONT
   iMenuWidth As Long
   iMenuHeight As Long
   lfMenuFont As NMLOGFONT
   lfStatusFont As NMLOGFONT
   lfMessageFont As NMLOGFONT
End Type

Private Enum SystemMetrics
    SM_CXBORDER = 5
    SM_CXDLGFRAME = 7
    SM_CXFRAME = 32
    SM_CXSCREEN = 0
    SM_CXICON = 11
    SM_CXICONSPACING = 38
    SM_CXSIZE = 30
    SM_CXEDGE = 45
    SM_CXSMICON = 49
    SM_CXSMSIZE = 52
End Enum

Private Const SPI_GETNONCLIENTMETRICS = 41
Private Const SPI_SETNONCLIENTMETRICS = 42

Private Declare Function GetTextExtentPoint32 Lib "gdi32" Alias "GetTextExtentPoint32A" _
    (ByVal hdc As Long, _
     ByVal lpszString As String, _
     ByVal cbString As Long, _
     lpSize As SIZE) As Long

Private Declare Function GetSystemMetrics Lib "user32" (ByVal nIndex As SystemMetrics) As Long

Private Declare Function SystemParametersInfo Lib "user32" Alias "SystemParametersInfoA" ( _
   ByVal uAction As Long, _
   ByVal uParam As Long, _
   lpvParam As Any, _
   ByVal fuWinIni As Long) As Long

Private Declare Function SelectObject Lib "gdi32" (ByVal hdc As Long, ByVal hObject As Long) As Long
Private Declare Function DeleteObject Lib "gdi32" (ByVal hObject As Long) As Long
Private Declare Function CreateFontIndirect Lib "gdi32" Alias "CreateFontIndirectA" (lpLogFont As LOGFONT) As Long

Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (Destination As Any, Source As Any, ByVal Length As Long)

Private Function GetCaptionTextWidth(ByVal frm As Form) As Long

    '-----------------------------------------------'
    ' This function does the following:             '
    '                                               '
    '   1\. Get the font used for the forms caption  '
    '   2\. Call GetTextExtent32 to get the width in '
    '      pixels of the forms caption              '
    '   3\. Convert the width from pixels into       '
    '      the scaling mode being used by the form  '
    '                                               '
    '-----------------------------------------------'

    Dim sz As SIZE
    Dim hOldFont As Long
    Dim hCaptionFont As Long
    Dim CaptionFont As LOGFONT
    Dim ncm As NONCLIENTMETRICS

    ncm.cbSize = LenB(ncm)

    If SystemParametersInfo(SPI_GETNONCLIENTMETRICS, 0, ncm, 0) = 0 Then
        ' What should we do if we the call fails? Change as needed for your app,'
        ' but this call is unlikely to fail anyway'
        Exit Function
    End If

    CopyMemory CaptionFont, ncm.lfCaptionFont, LenB(CaptionFont)

    hCaptionFont = CreateFontIndirect(CaptionFont)
    hOldFont = SelectObject(frm.hdc, hCaptionFont)

    GetTextExtentPoint32 frm.hdc, frm.Caption, Len(frm.Caption), sz
    GetCaptionTextWidth = frm.ScaleX(sz.cx, vbPixels, frm.ScaleMode)

    'clean up, otherwise bad things will happen...'
    DeleteObject (SelectObject(frm.hdc, hOldFont))

End Function

Private Function GetControlBoxWidth(ByVal frm As Form) As Long

    Dim nButtonWidth As Long
    Dim nButtonCount As Long
    Dim nFinalWidth As Long

    If frm.ControlBox Then

        nButtonCount = 1                            'close button is always present'
        nButtonWidth = GetSystemMetrics(SM_CXSIZE)  'get width of a single button in the titlebar'

        ' account for min and max buttons if they are visible'
        If frm.MinButton Then nButtonCount = nButtonCount + 1
        If frm.MaxButton Then nButtonCount = nButtonCount + 1

        nFinalWidth = nButtonWidth * nButtonCount

    End If

    'convert to whatever scale the form is using'
    GetControlBoxWidth = frm.ScaleX(nFinalWidth, vbPixels, frm.ScaleMode)

End Function

Private Function GetIconWidth(ByVal frm As Form) As Long

    Dim nFinalWidth As Long

    If frm.ControlBox Then

        Select Case frm.BorderStyle

            Case vbFixedSingle, vbFixedDialog, vbSizable:
                'we have an icon, gets its width'
                nFinalWidth = GetSystemMetrics(SM_CXSMICON)
            Case Else:
                'no icon present, so report zero width'
                nFinalWidth = 0

        End Select

    End If

    'convert to whatever scale the form is using'
    GetIconWidth = frm.ScaleX(nFinalWidth, vbPixels, frm.ScaleMode)

End Function

Private Function GetFrameWidth(ByVal frm As Form) As Long

    Dim nFinalWidth As Long

    If frm.ControlBox Then

        Select Case frm.BorderStyle

            Case vbFixedSingle, vbFixedDialog:
                nFinalWidth = GetSystemMetrics(SM_CXDLGFRAME)
            Case vbSizable:
                nFinalWidth = GetSystemMetrics(SM_CXFRAME)
        End Select

    End If

    'convert to whatever scale the form is using'
    GetFrameWidth = frm.ScaleX(nFinalWidth, vbPixels, frm.ScaleMode)

End Function

Private Function GetBorderWidth(ByVal frm As Form) As Long

    Dim nFinalWidth As Long

    If frm.ControlBox Then

        Select Case frm.Appearance

            Case 0 'flat'
                nFinalWidth = GetSystemMetrics(SM_CXBORDER)
            Case 1 '3D'
                nFinalWidth = GetSystemMetrics(SM_CXEDGE)
        End Select

    End If

    'convert to whatever scale the form is using'
    GetBorderWidth = frm.ScaleX(nFinalWidth, vbPixels, frm.ScaleMode)

End Function

Public Function GetRecommendedWidth(ByVal frm As Form) As Long

    Dim nNewWidth As Long

    ' An abitrary amount of extra padding so that the caption text '
    ' is not scrunched up against the min/max/close buttons '

    Const PADDING_TWIPS = 120

    nNewWidth = _
        GetCaptionTextWidth(frm) _
        + GetControlBoxWidth(frm) _
        + GetIconWidth(frm) _
        + GetFrameWidth(frm) * 2 _
        + GetBorderWidth(frm) * 2 _
        + PADDING_TWIPS

    If nNewWidth > frm.Width Then
        GetRecommendedWidth = nNewWidth
    Else
        GetRecommendedWidth = frm.Width
    End If

End Function 
```

**然后将以下内容放在您的 Form_Load 事件中**

```
Private Sub Form_Load()

    Me.Caption = String(100, "x") 'replace this with your caption'
    Me.Width = GetRecommendedWidth(Me)

End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T21:47:54.190

看来 VB6 将 App.Title 属性限制为 40 个字符。不幸的是，我在 MSDN 上找不到任何详细说明此行为的文档。（不幸的是，我没有将文档加载到我的 VB6 副本仍然驻留的机器上。）

我用长标题进行了实验，这就是观察到的行为。如果您的标题超过 40 个字符，它将被截断。

# c - 如何在 C 预处理器标记中转义下划线？

> ID：141878
> 
> 赞同：1
> 
> 时间：2008-09-26T20:47:08.453
> 
> 标签：c, c-preprocessor

下面的代码片段应该采用 PROJECT 的值（在 Makefile 中定义）并创建一个包含文件名。例如，如果 PROJECT=classifier，那么它应该在最后为 PROJECTINCSTR 生成classifier_ir.h

我发现只要我不尝试在后缀中使用下划线，这段代码就可以工作。然而，下划线的使用不是可选的——我们的代码库在任何地方都使用它们。我可以解决这个问题，因为 PROJECT 的值数量有限，但我想知道如何使用下划线使以下代码段实际工作。能逃脱吗？

```
#define PROJECT classifier

#define QMAKESTR(x) #x
#define MAKESTR(x) QMAKESTR(x)
#define MAKEINC(x) x ## _ir.h
#define PROJECTINC MAKEINC(PROJECT)
#define PROJECTINCSTR MAKESTR(PROJECTINC)

#include PROJECTINCSTR 
```

编辑：编译器应该尝试包含classifier_ir.h，而不是PROJECT_ir.h。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T20:55:52.770

```
#define QMAKESTR(x) #x
#define MAKESTR(x) QMAKESTR(x)
#define SMASH(x,y) x##y
#define MAKEINC(x) SMASH(x,_ir.h)
#define PROJECTINC MAKEINC(PROJECT)
#define PROJECTINCSTR MAKESTR(PROJECTINC)
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:02:35.640

这对我有用：

```
#define QMAKESTR(x) #x
#define MAKESTR(x) QMAKESTR(x)
#define MAKEINC(x) x ## _ir.h
#define PROJECTINC(x) MAKEINC(x)
#define PROJECTINCSTR MAKESTR(PROJECTINC(PROJECT))

#include PROJECTINCSTR 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:54:12.087

该准系统示例适用于 gcc (v4.1.2) 并尝试包含“PROJECT_ir.h”

# dependency-injection - taglib -> dependency injection pojo/service how?

> ID：141885
> 
> 赞同：1
> 
> 时间：2008-09-26T20:48:40.370
> 
> 标签：dependency-injection, taglib

Is there a nice way to dependency inject using a jsp taglib?

either using ejb 3.0, spring, or guice...

I have a lot of services/pojos that I would like to use in my taglibs

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T20:54:41.960

I think you want [Seam](http://www.jboss.com/products/seam), it enables you to refer to a component by name. However, the released version is JSF based, but that's changing.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-01-02T00:42:04.327

在 servletContext 上保留对注入器的引用，然后根据需要在每个标记中使用。看

在您的 Guice 设置中：

```
public class GuiceServletConfig extends GuiceServletContextListener {

@Override
protected Injector getInjector() {
    return Guice.createInjector(blah, blah);
}

@Override
public void contextDestroyed(ServletContextEvent servletContextEvent) {
    ServletContext servletContext = servletContextEvent.getServletContext();
    servletContext.removeAttribute(Injector.class.getName());
    super.contextDestroyed(servletContextEvent);
}

@Override
public void contextInitialized(ServletContextEvent servletContextEvent) {
    Injector injector = getInjector();
    ServletContext servletContext = servletContextEvent.getServletContext();
    servletContext.setAttribute(Injector.class.getName(), injector);
    super.contextInitialized(servletContextEvent);
} 
```

}

然后在你的标签库中：

```
@Singleton
@SuppressWarnings("serial")
public class MySampleTag extends TagSupport {
@Inject private MyInjectedService myService;

@Override
public int doStartTag() throws JspException {
    Injector injector = (Injector) pageContext.getServletContext().getAttribute(Injector.class.getName());
    injector.injectMembers(this);

    String value = myService.doSomething();
            etc.
            etc. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-20T09:22:50.127

只是偶然发现了你的问题，因为我也打算这样做。您实际上可以使用 Spring 及其 @Configurable 注释（使用 AspectJ 加载时或编译时编织）将服务注入到您的标签实现中。有关所有选项的详细说明，请在[此处](http://blog.springsource.com/2008/01/23/new-improvements-in-domain-object-dependnecy-injection-feature/)查看 Ramnivas 的博客文章。

希望在您仍然需要解决方案的情况下提供帮助...

# c# - 在.Net中标记字符串的方法是什么？

> ID：141888
> 
> 赞同：6
> 
> 时间：2008-09-26T20:49:04.207
> 
> 标签：c#, java, .net, migration

对于任何从 Java 迁移的人来说，这一定是一个经典的 .NET 问题。

.NET 似乎没有直接等效于 java.io.StreamTokenizer，但是 JLCA 提供了一个 SupportClass 来尝试实现它。我相信 JLCA 还提供了一个以字符串为源的 Tokenizer SupportClass，我认为 StreamTokenizer 会派生自它，但事实并非如此。

~~标记流和字符串的*首选方法是什么？*还是有一个？~~如何在 .Net 中对流进行标记化？我想拥有 java.io.StreamTokenizer 提供的灵活性。有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T20:54:11.760

.NET 中没有任何东西完全等同于 StreamTokenizer。对于简单的情况，您可以使用 String.Split()，但对于更高级的令牌解析，您可能最终会使用[System.Text.RegularExpressions.Regex](https://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex(v=vs.110).aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T20:52:06.740

如果需要根据特定字符的集合拆分字符串，请使用 System.String.Split。

使用 System.Text.RegularExpressions.RegEx.Split 根据匹配模式进行拆分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T20:51:54.837

Nextem 库中有一个标记器——你可以在这里看到一个例子：http: [//trac.assembla.com/nextem/browser/trunk/Examples/Parsing.n](http://trac.assembla.com/nextem/browser/trunk/Examples/Parsing.n)

它被实现为 Nemerle 宏，但您可以编写它，然后从 C# 轻松使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T20:52:10.657

我不这么认为，对于非常简单的标记化，请查看 System.String.Split()。

System.Text.RegularExpressions.Regex 可以实现更复杂的标记化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T00:44:46.650

在将 tuProlog 从 Java 移植到 C# 时，我们遇到了相同的问题，即找到等效的 StreamTokenizer。据我所知，我们最终编写了 StreamTokenizer 的直接转换，它将 TextReader 作为输入目的的“流”。您将在[tuProlog.NET 2.1（LGPL 许可）的下载中](http://sf.net/projects/tuprolog/)找到代码，因此请随意重用并根据您的需要调整它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T20:50:46.293

要标记字符串，请使用`string.Split(...)`.

# command-line - Command line builds for VC 6?

> ID：141894
> 
> 赞同：4
> 
> 时间：2008-09-26T20:51:05.357
> 
> 标签：command-line, build, visual-c++-6

I have been used to working with VS2005 and 2008 - using msbuild, etc, but I have inherited a set of projects that have to remain in vc6.0 for now. I don't like opening each project in the developer studio and building. I prefer to build form command line (I am automating the builds). Is this possible?

I have tried the nmake utility, but I still need to open up the projects and save/export the make file. This is tedious if the project changes - each time I have to save the make file. nmake seems to work, but it had a problem when I changed the location of the project in my directory tree (I checked out of svn into a new clean dir to try the build). It seemed to have hard coded paths in it, but I will have to check on that - it might have been a different problem.

Any alternatives out there?

Eventually I will migrate these to 2008, but for now that is not an option.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-26T22:01:35.810

我在这里记录了[您链接](https://stackoverflow.com/questions/141894/command-line-builds-for-vc-6#141953)中最重要的部分- 微软有一个坏习惯，就是移动东西并留下死链接。这不仅是最重要的一点，而且它提供了足够的信息来进行搜索，如果/何时移动它。

## 从命令行构建项目

您可以从命令行生成 Visual C++ 项目，而无需先导出生成文件（MAKEFILE 或 filename.mak）并使用 NMAKE 实用程序。

基本的命令语法是

msdev FileName [/MAKE "ProjectName – ConfigName | ALL"] [/REBUILD /CLEAN /NORECURSE /OUT LogFile /USEENV]

其中 FileName 是您的项目 (.dsp) 或工作区 (.dsw) 文件的名称。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T21:00:54.597

I think I found m answer here: [http://msdn.microsoft.com/en-us/library/aa699274.aspx](http://msdn.microsoft.com/en-us/library/aa699274.aspx)

thanks all

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T20:54:00.730

We use automated builds at my work place. Essentially just a batch file i fire off from the command line. Let me make sure i am allowed to post some sample code before i go ahead and post it. But yes, it IS possible to automate the build.

Sample Code:

> :::::::: CompileSolution :::::::::::::::::::::::::
> 
> call X:\BuildTools\bin\BuildVbProj.bat %COMPONENTNAME% %SOLUTIONDIR% %PROJFILE% %BUILDOUTPUTFILE% %PREBUILDFILE% if %ERRORLEVEL% NEQ 0 goto BuildErrors

goto Cleanup

**EDIT:** The BuildVbProj.bat file ultimately calls VB6.exe in the Program Files\MS Visual Studio\VB98\ folder. Try calling it with "VB6.exe /?" or "VB6.exe -?" and it will show you a list of options. You can basically automate your process using those options.

There should be a similar exe for VC in the VC98 folder as well.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:56:51.097

of course you can automate. I haven't used vc in years, but I think the compiler is called c8.exe or wow, I can't remember silly little tidbits like that anymore, but look in your vc\bin directory at all the exes and it will be obvious by name. you can write a batch file worst case. But I also remember the UI having a "create makefile" function. So you do that once, and then just run make from the command line and voila. or maybe it's nmake. Again, been a long long time.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T21:46:02.993

Microsoft 提供了用于构建 Visual Studio 项目的命令行驱动程序。在 VC6 中，它被称为“msdev”（执行 msdev /? 以获得选项列表）。

在某个时候（可能是 VS.NET/VS 2002），出于某种原因，他们开始调用命令行构建驱动程序“devenv”。它有一些不同的语法，但对于驱动构建，选项是相同或相似的。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-27T21:38:29.227

另一种劳动强度较低的选择是

下拉菜单 (BUILD)
选择 (BATCHBUILD)
按钮 (REBUILDALL)

# model-view-controller - MVC 的替代方案

> ID：141912
> 
> 赞同：71
> 
> 时间：2008-09-26T20:53:22.730
> 
> 标签：model-view-controller, design-patterns

模型视图控制器的替代“设计方法”是什么？MVC 似乎很流行（SO 是用它构建的，我知道很多）但它是唯一使用的方法吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-28T08:05:10.297

这篇关于几种不同交互式应用程序架构模式的最佳文章之一是[这篇非常详细且经过充分研究的博客文章](http://lostechies.com/derekgreer/2007/08/25/interactive-application-architecture/)。它涵盖了模型-视图-控制器、三种不同风格的模型-视图-演示器、几种不同风格的演示-抽象-控制、监督控制器、被动视图和分层 MVC。

另一个有趣的模式是 Atomic Objects 的[Presenter First](https://atomicobject.com/resources/presenter-first)模式。它不仅仅是一种设计模式，它也是一种过程模式。IOW：“Presenter First”这个名字不是随意的，它实际上描述了一个开发过程，在这个过程中，Presenter 首先被编写，驱动系统其余部分的设计。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-26T21:00:49.997

还有很多其他的：

*   [模型视图演示器 (MVP)](http://en.wikipedia.org/wiki/Model_View_Presenter)

    *   [监督控制器](http://www.martinfowler.com/eaaDev/SupervisingPresenter.html)
    *   [被动视图](http://www.martinfowler.com/eaaDev/PassiveScreen.html)
*   [模型视图视图模型 (MVVM)](http://www.orbifold.net/default/?p=550)

    *   这在 WPF 应用程序中很常见（尽管[Prism](http://www.codeplex.com/CompositeWPF)（通常）使用 MVP 模式）

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-10-26T09:45:44.253

MVC 是一种架构模式。这些是您可以尝试的其他架构模式（来自维基百科）：

*   图层
*   多层架构
*   表示抽象控制 (PAC)
*   模型视图演示器 (MVP)
*   模型视图视图模型 (MVVM)
*   管道
*   隐式调用
*   黑板系统
*   点对点
*   面向服务的架构 (SOA)
*   裸对象

这些可[在 Wikipedia](http://en.wikipedia.org/wiki/Architectural_pattern_%28computer_science%29)中找到。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-02-27T01:30:07.360

**DCI** - “数据、通信和交互”

[http://www.antonioshome.net/kitchen/nbdci/index.php#dci-introduction](http://www.antonioshome.net/kitchen/nbdci/index.php#dci-introduction)

[http://www.artima.com/articles/dci_visionP.html](http://www.artima.com/articles/dci_visionP.html)

[面向对象编程的常识](http://folk.uio.no/trygver/2008/commonsense.pdf)- MVC vs DCI

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-26T21:04:33.730

MVC 是更大的一组设计模式的一部分。我不知道您有多少经验，所以我不确定如何针对此响应。我是一名 .NET 程序员，但我发现 Java 书籍[Head First Design Patterns](http://oreilly.com/catalog/9780596007126/)非常有帮助。设计模式通常与有助于解决类似问题的其他模式分成几组。

我还发现[Data Object Factory 网站](http://www.dofactory.com)也很有帮助。你应该四处寻找一些你喜欢的语言的资源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T21:01:35.690

我们使用的不是替代品，而是一种称为[MVC-ARS](https://stackoverflow.com/questions/140098/is-mvc-ars-preferable-to-classic-mvc-to-prevent-overloading)的混合体。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-17T16:46:50.670

我知道 Joe Berkovitz 的[**MVCS**](http://joeberkovitz.com/blog/reviewtube/)。

Kowarschick 教授使用这种方法开发了[**VCLSD**](http://glossar.hs-augsburg.de/Logic-Data-View-Controller-Service-Paradigma) -Pattern（用德语编写的 Wiki！也许有人有时间翻译它 - 至于我自己，我只是编程的初学者）

MVCS ：模型查看控制服务
VCLSD：查看控制逻辑服务数据

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-04-18T10:04:13.413

Facebook 的flux.js 怎么样？我知道它依赖于平台，但它是 FB 用来替代 MVC 的数据流架构，所以我相信你也可以从那里得到一些想法。

# php - 使用 Xpath 拉取给定节点的文本和属性

> ID：141913
> 
> 赞同：5
> 
> 时间：2008-09-26T20:53:51.887
> 
> 标签：php, dom, xpath

我正在使用 PHP 和 xpath 解析来自 API 调用的 XML 结果。

```
 $dom = new DOMDocument();
 $dom->loadXML($response->getBody());

 $xpath = new DOMXPath($dom);
 $xpath->registerNamespace("a", "http://www.example.com");

 $hrefs = $xpath->query('//a:Books/text()', $dom);

 for ($i = 0; $i < $hrefs->length; $i++) {
      $arrBookTitle[$i] = $hrefs->item($i)->data;
 }

 $hrefs = $xpath->query('//a:Books', $dom);

 for ($i = 0; $i < $hrefs->length; $i++) {
      $arrBookDewey[$i] = $hrefs->item($i)->getAttribute('DeweyDecimal');
 } 
```

这可行，但有没有一种方法可以从一个查询中访问文本和属性？如果是这样，一旦执行查询，您如何获得这些项目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-27T05:01:38.313

在环顾四周后，我遇到了这个解决方案。这样我可以获取元素文本并访问节点的任何属性。

```
$hrefs = $xpath->query('//a:Books', $dom);

for ($i = 0; $i < $hrefs->length; $i++) {
    $arrBookTitle[$i] = $hrefs->item($i)->nodeValue;
    $arrBookDewey[$i] = $hrefs->item($i)->getAttribute('DeweyDecimal');
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T02:59:32.767

一个 XPath 表达式将同时选择“a:Books”的文本节点及其“DeweyDecimal”属性，如下所示

`//a:Books/text() | //a:Books/@DeweyDecimal`

**请注意**在上面的表达式中使用了 XPath 的联合运算符。

**另一个注意事项**：尽量避免使用“//”缩写，因为它可能导致整个 XML 文档被遍历，因此非常昂贵。当 XML 文档的结构已知时，建议始终使用更具体的 XPath 表达式（例如由一系列特定位置步骤组成）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-27T10:10:30.300

如果您只是从 XML 文档中检索值，[SimpleXML](http://de.php.net/manual/en/book.simplexml.php)可能是更精简、更快且对内存更友好的解决方案：

```
$xml=simplexml_load_string($response->getBody());
$xml->registerXPathNamespace('a', 'http://www.example.com');
$books=$xml->xpath('//a:Books');
foreach ($books as $i => $book) {
    $arrBookTitle[$i]=(string)$book;
    $arrBookDewey[$i]=$book['DeweyDecimal'];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T20:56:31.753

你能查询连接吗？

```
$xpath->query('concat(//a:Books/text(), //a:Books/@DeweyDecimal)', $dom); 
```

XSLT 本身就是一种表达式语言，您可以从表达式中构造所需的任何特定格式的返回值。

# c++ - Unable to link to shared library

> ID：141939
> 
> 赞同：1
> 
> 时间：2008-09-26T20:58:10.190
> 
> 标签：c++, stl, map, linker, shared-libraries

I'm building a shared library with g++ 3.3.4\. I cannot link to the library because I am getting

```
./BcdFile.RHEL70.so: undefined symbol: _ZNSt8_Rb_treeIjjSt9_IdentityIjESt4lessIjESaIjEE13insert_uniqueERKj 
```

Which c++filt describes as

```
std::_Rb_tree<unsigned int, unsigned int, std::_Identity<unsigned int>, std::less<unsigned int>, std::allocator<unsigned int> >::insert_unique(unsigned int const&) 
```

I thought this might have come from using hash_map, but I've taken that all out and switched to regular std::map. I am using g++ to do the linking, which is including `-lstdc++`.

Does anyone know what class would be instantiating this template? Or even better, which library I need to be linking to?

*EDIT:* After further review, it appears adding the -frepo flag when compiling has caused this, unfortunately that flag is working around gcc3.3 bug.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:01:54.657

`std::_Rb_Tree` might be a red-black tree, which would most likely be from using `map`. It should be part of `libstdc++`, unless your library is linking against a different version of `libstdc++` than the application, which from what you've said so far seems unlikely.

EDIT: Just to clarify, the red-black tree is the underlying data structure in `map`. All that `hash_map` does is hash the key before using it, rather than using the raw value.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T21:06:42.073

Try

```
#include < map > 
```

in the source file where you are using map.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-27T02:14:15.233

您似乎有来自不同版本的 gcc 的 2 个不同的不兼容版本的 libstdc++.so。检查你的路径。

# .net - Vista 上的多用户 WinForms 应用程序规则

> ID：141951
> 
> 赞同：1
> 
> 时间：2008-09-26T21:00:47.640
> 
> 标签：.net, windows, winforms, windows-vista

我们有一个适用于 Windows XP 的 .Net WinForms 应用程序的 MSI 安装程序，它只能以管理员身份安装和运行。用户必须在应用程序运行时登录。客户希望它在 Vista 下的用户帐户下安装和运行，并使用他们的 Windows 帐户。

初步查看代码会发现很多问题；安装程序写入注册表并将应用程序安装在 C:\Program Files 中。该应用程序将用户首选项存储在注册表中，将数据写入 C:\Documents and Settings\All Users\，并在 C: 中创建临时文件。

我想首先要做的是将数据文件存储在 System.Environment.CommonApplicationData 中，并将用户首选项存储在 System.Environment.LocalApplicationData 中。用户帐户可以将应用程序安装到 System.Environment.ProgramFiles 吗？

一个问题是应用程序必须可由任何用户安装和卸载，并且所有用户共享相同的数据文件。每个用户都有自己的偏好。

是否有书籍或网站详细说明了构建一个遵循 Vista 上的多个用户规则的 WinForms 应用程序所需的条件？

编辑：我与客户核对过，仅作为用户帐户安装的要求是坚定的，他们正在从楼层工作人员那里删除管理员访问权限。这排除了管理员安装的组件和每台机器的安装。

我正在考虑创建一个单独的数据应用程序，该应用程序将在管理机器上运行，地板机器将通过远程处理连接到该管理机器。所有客户端数据都将存储在这台机器上。但是，此应用程序还必须在用户帐户下安装和运行。

是否有书籍或网站描述了 Vista 用户应用程序必须遵循的所有规则？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:09:40.850

“该应用程序必须可由任何用户安装和卸载” “所有用户共享相同的数据文件”

您将很难同时满足这两个要求。Vista 的新安全功能旨在防止用户互相践踏（和系统）。

我能想到的使这项工作的唯一方法是类似于我们在 Windows 2000 环境中处理类似需求的方法。您构建了两个组件——应用程序的用户部分，以及一个管理用户之间共享信息的系统组件。管理员安装“共享”组件（包括运行它的 Windows 服务），每个用户安装“用户”组件。

我认为这可能适用于您的方案，但它需要重新编写使用共享文件与服务对话而不是直接访问这些文件的代码。

当然，您也可以只使用用户以管理员身份运行的工具来在特定位置创建文件夹并授予所需的安全权限。这也可能适用于您的目的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:15:59.897

您将无法让任何用户安装该应用程序，同时访问共享数据文件。这是因为您的第一个要求意味着按用户安装，而第二个要求意味着按计算机安装。让我解释 ...

标准（基于 MSI）安装程序的范围可以是每用户或每台机器：

*   每用户安装将安装的程序文件放在用户主目录下的某个位置。该应用程序仅为该用户安装。其他用户甚至看不到开始菜单中的程序，也看不到添加/删除程序。如果他们想要该程序，他们必须自己将其安装到他们自己的每个用户区域中。因此，可能安装了多个程序副本，并且每个副本都与其他副本隔离。这种类型的安装可以由普通（非管理员）用户执行，这就是他们无法写入“程序文件”或“所有用户”等共享区域的原因。
*   每台机器安装可以修改文件系统的共享区域（即“程序文件”或“所有用户”）。每个用户都在开始菜单和添加/删除程序中看到相同的程序副本。只有管​​理员用户可以执行这种类型的安装。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T17:17:19.603

多谢你们。我与客户核实，仅作为用户帐户安装的要求是坚定的，他们正在从楼层工作人员那里删除管理员访问权限。这排除了管理员安装的组件和每台机器的安装。

我们的解决方案是为我们的应用创建一个新的标准用户帐户。需要使用该应用程序的员工必须以该用户身份登录。这实际上比在用户之间共享数据更好，因为现在我们可以在同一台机器上为不同的客户端托管应用程序。

I also found a great reference for making multi-user apps on Windows, the Microsoft Windows 7 Client Software Logo Technical Requirements [document](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=27028822-b172-4cec-91a3-26b610a4da79).

# c# - 具有 valueTypes 字段和装箱的类

> ID：141970
> 
> 赞同：1
> 
> 时间：2008-09-26T21:05:09.893
> 
> 标签：c#, data-structures, t4

我正在尝试使用泛型，并且正在尝试创建类似于 Dataset 类的结构。
我有以下代码

```
public struct Column<T>
{
    T value;
    T originalValue;

    public bool HasChanges
    {
        get { return !value.Equals(originalValue); }
    }

    public void AcceptChanges()
    {
        originalValue = value;
    }
}

public class Record
{
    Column<int> id;
    Column<string> name;
    Column<DateTime?> someDate;
    Column<int?> someInt;

    public bool HasChanges
    {
        get
        {
            return id.HasChanges | name.HasChanges | someDate.HasChanges | someInt.HasChanges;
        }
    }

    public void AcceptChanges()
    {
        id.AcceptChanges();
        name.AcceptChanges();
        someDate.AcceptChanges();
        someInt.AcceptChanges();
    }
} 
```

我遇到的问题是，当我添加新列时，我还需要在 HasChanges 属性和 AcceptChanges() 方法中添加它。这只是要求进行一些重构。
所以我想到的第一个解决方案是这样的：

```
public interface IColumn
{
    bool HasChanges { get; }
    void AcceptChanges();
}

public struct Column<T> : IColumn {...}
public class Record
{
    Column<int> id;
    Column<string> name;
    Column<DateTime?> someDate;
    Column<int?> someInt;

    IColumn[] Columns { get { return new IColumn[] {id, name, someDate, someInt}; }}

    public bool HasChanges
    {
        get
        {
            bool has = false;
            IColumn[] columns = Columns;            //clone and boxing
            for (int i = 0; i < columns.Length; i++)
                has |= columns[i].HasChanges;
            return has;
        }
    }

    public void AcceptChanges()
    {
        IColumn[] columns = Columns;            //clone and boxing
        for (int i = 0; i < columns.Length; i++)
            columns[i].AcceptChanges();         //Here we are changing clone
    }
} 
```

正如您从评论中看到的那样，我们在结构克隆方面几乎没有问题。对此的简单解决方案是将 Column 更改为类，但从我的测试来看，它似乎将内存使用量增加了约 40%（因为每个对象元数据），这对我来说是不可接受的。

所以我的问题是：有没有人有任何其他想法如何创建可以在不同结构化对象/记录上工作的方法？也许 F# 社区的某个人可以建议如何用函数式语言解决这些问题，以及它如何影响性能和内存使用。

**编辑：**
sfg 感谢有关宏的建议。
在 Visual Studio 2008 中有一个内置的（但不为人知的）模板引擎，称为 T4。重点是将“.tt”文件添加到我的项目中并创建一个模板，该模板将搜索我的所有类，以某种方式识别记录的那些（例如通过它们实现的某些接口）并使用 HasChanges 和 AcceptChanges 生成部分类（ ) 将只调用类包含的列。

一些有用的链接：
[VS](http://www.t4editor.net/ "VS 的 T4 编辑器")
[博客的 T4 编辑器，包含有关 T4 博客条目的链接和教程，](http://www.olegsych.com/2007/12/text-template-transformation-toolkit/ "包含有关 T4 的链接和教程的博客")
[以及使用 EnvDTE 读取项目文件的示例](http://www.olegsych.com/2008/07/t4-template-for-generating-sql-view-from-csharp-enumeration/ "带有使用 EnvDTE 读取项目文件的示例的博客条目")

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:46:47.717

正如您从功能语言中询问示例一样；在 lisp 中，您可以通过使用宏为您编写代码来防止在每次添加列时编写所有代码。可悲的是，我认为这在 C# 中是不可能的。

在性能方面：宏将在编译时进行评估（因此会稍微减慢编译速度），但不会导致运行时减速，因为运行时代码与您手动编写的代码相同。

我认为你可能不得不接受你原来的 AcceptChanges() 因为如果你想避免写入克隆版本，你需要直接通过它们的标识符访问结构。

换句话说：您需要一个程序来为您编写程序，而我不知道如何在 C# 中做到这一点，而不会比将结构转换为类（例如反射）花费更多的时间或在性能上损失更多.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T22:00:39.010

老实说，听起来您确实希望这些`Column`s 成为类，但又不想支付与类相关的运行时成本，因此您试图使它们成为结构。我不认为你会找到一种优雅的方式来做你想做的事。结构应该是值类型，你想让它们表现得像引用类型。

您无法将 Columns 有效地存储在`IColumn`s 数组中，因此任何数组方法都无法正常工作。编译器无法知道`IColumn`数组只会保存结构，事实上，如果这样做也无济于事，因为您仍然试图在其中插入不同类型的结构。每次有人调用`AcceptChanges()`or`HasChanges()`时，你最终都会对你的结构进行装箱和克隆，所以我严重怀疑让你`Column`的结构而不是类会为你节省很多内存。

但是，您*可能可以*将`Column`s 直接存储在数组中并使用枚举对其进行索引。例如：

```
public class Record
{
    public enum ColumnNames { ID = 0, Name, Date, Int, NumCols };

    private IColumn [] columns;

    public Record()
    {
        columns = new IColumn[ColumnNames.NumCols];
        columns[ID] = ...
    }

    public bool HasChanges
    {
        get
        {
            bool has = false;
            for (int i = 0; i < columns.Length; i++)
                has |= columns[i].HasChanges;
            return has;
        }
    }

    public void AcceptChanges()
    {
        for (int i = 0; i < columns.Length; i++)
            columns[i].AcceptChanges();
    }
} 
```

我手边没有 C# 编译器，所以我无法检查它是否可行，但基本想法应该可行，即使我没有得到所有细节。但是，我会继续为他们上课。无论如何，你要为此付出代价。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T21:32:43.647

您可以使用反射来迭代成员并调用 HasChanges 和 AcceptChanges。Record 类可以将反射元数据存储为静态的，因此没有每个实例的内存开销。但是，运行时的性能成本将是巨大的——您最终可能还会对列进行装箱和拆箱，这会增加更多的成本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T22:11:10.310

我能想到的做你真正想做的事情的唯一方法是使用反射。这仍然会装箱/拆箱，但它*可以*让您将克隆存储回现场，有效地使其成为真正的价值。

```
public void AcceptChanges()
{
    foreach (FieldInfo field in GetType().GetFields()) {
        if (!typeof(IColumn).IsAssignableFrom(field.FieldType))
            continue; // ignore all non-IColumn fields
        IColumn col = (IColumn)field.GetValue(this); // Boxes storage -> clone
        col.AcceptChanges(); // Works on clone
        field.SetValue(this, col); // Unboxes clone -> storage
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T05:39:41.637

这个怎么样：

```
public interface IColumn<T>
{
    T Value { get; set; }
    T OriginalValue { get; set; }
}

public struct Column<T> : IColumn<T>
{
    public T Value { get; set; }
    public T OriginalValue { get; set; }
}

public static class ColumnService
{
    public static bool HasChanges<T, S>(T column) where T : IColumn<S>
    {
        return !(column.Value.Equals(column.OriginalValue));
    }

    public static void AcceptChanges<T, S>(T column) where T : IColumn<S>
    {
        column.Value = column.OriginalValue;
    }
} 
```

客户端代码是：

```
Column<int> age = new Column<int>();
age.Value = 35;
age.OriginalValue = 34;

if (ColumnService.HasChanges<Column<int>, int>(age))
{
    ColumnService.AcceptChanges<Column<int>, int>(age);
} 
```

# python - 如何在没有数据库命中的情况下获取 db.ReferenceProperty 的键值？

> ID：141973
> 
> 赞同：1
> 
> 时间：2008-09-26T21:05:25.943
> 
> 标签：python, google-app-engine

有没有办法在不取消引用它指向的实际实体的情况下获取 db.ReferenceProperty 的键（或 id）值？我一直在挖掘 - 看起来密钥存储为以 _ 开头的属性名称，但我无法让任何代码正常工作。例子将不胜感激。谢谢。

编辑：这是我没有成功的尝试：

```
class Comment(db.Model):
    series = db.ReferenceProperty(reference_class=Series);

    def series_id(self):
        return self._series 
```

在我的模板中：

```
<a href="games/view-series.html?series={{comment.series_id}}#comm{{comment.key.id}}">more</a> 
```

结果：

```
<a href="games/view-series.html?series=#comm59">more</a> 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T22:17:40.930

实际上，您提倡访问 ReferenceProperty 的密钥的方式将来很可能不存在。在 python 中以 '_' 开头的属性通常被认为是“受保护的”，因为与其实现紧密绑定和密切的东西可以使用它们，但是随着实现更新的东西必须在它发生变化时发生变化。

但是，有一种方法可以通过公共接口访问您的参考属性的密钥，以便将来安全。我将修改上面的示例：

```
class Comment(db.Model):
    series = db.ReferenceProperty(reference_class=Series);

    def series_id(self):
        return Comment.series.get_value_for_datastore(self) 
```

当你通过它关联的类访问属性时，你会得到属性对象本身，它有一个可以获取底层值的公共方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T21:30:58.177

您是对的 - 密钥存储为以“_”为前缀的属性名称。您应该能够直接在模型对象上访问它。你能证明你正在尝试什么吗？我过去使用过这种技术，没有任何问题。

编辑：您是否尝试过直接调用 series_id() 或直接在模板中引用 _series？如果您在此上下文中指定它们，我不确定 Django 是否会自动调用不带参数的方法。您也可以尝试将 @property 装饰器放在方法上。

# mysql - PostgreSQL's and MySQL's full text search

> ID：141975
> 
> 赞同：8
> 
> 时间：2008-09-26T21:05:37.927
> 
> 标签：mysql, postgresql, search, full-text-search

How do the full text search systems of PostgreSQL and MySQL compare? Is any clearly better than the oder? In which way are they different?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T03:39:48.290

PostgreSQL 8.3 已内置全文搜索，它是“tsearch2”的集成版本

这是文档：[http ://www.postgresql.org/docs/8.3/static/textsearch.html](http://www.postgresql.org/docs/8.3/static/textsearch.html)

以及文档中的示例：

```
SELECT title
FROM pgweb
WHERE to_tsvector(body) @@ to_tsquery('friend'); 
```

其中 body 是一个文本字段。您可以专门为这些类型的搜索建立索引，当然它们可能比这个简单的示例更复杂。该功能非常可靠，值得您在做出决定时深入研究。

祝你好运。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T21:15:31.223

> **更新：**从 MySQL 5.6 开始，InnoDB[支持全文搜索](https://dev.mysql.com/doc/refman/5.6/en/fulltext-search.html)

不幸的是，我并不精通 PostgreSQL，但如果你在 MySQL 中使用全文搜索，你会立即与 MyISAM 绑定。如果您想使用 InnoDB（并且如果 ACID 合规性对您来说意味着什么，那么您应该使用 InnoDB），您将无法使用其他解决方案。

经常推出的两个流行的替代方案是[Lucene](http://lucene.apache.org)（如果您使用 PHP，则它是一个带有 Zend 模块的 apache 项目）和[Sphinx](http://sphinxsearch.com)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-01T08:58:21.050

如果您使用 Hibernate 作为 ORM，我强烈建议您使用 Hibernate 搜索。它建立在 Lucene 之上，因此速度非常快。

卡尔

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-23T14:31:18.737

我在使用 postgresql/tsearch2 方面有很好的经验，特别是因为它被引入了标准发行版（在 8.0 版之前 - 我认为 - 这是一个可选的 contrib 功能，升级到 tsearch2 需要做一些工作）。

如果我没记错的话，你必须在启动之前设置一些属性（模糊匹配，字典的东西），而在其他数据库上，这些东西是通过全文语法本身灵活地公开的（我在这里想到的是 Oracle Text，虽然我知道那不是与您的问题相关）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-27T13:25:53.497

我认为您可以将 Sphinx 与 MySQL 和 Postgres 一起使用。这是[一篇](http://www.khussein.com/wordpress/?p=38)解释如何将 Sphinx 与 MySQL 一起使用的文章（您可以将其添加为插件）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-17T09:25:55.637

mysql全文搜索很慢。它不能处理超过 100 万的数据（每个查询几十秒）。

我没有使用 postgresql 全文搜索的经验。

我用过狮身人面像搜索。它非常快速且易于使用。但它不是那么强大。我的意思是搜索功能。例如，它不支持像'abc？'，在哪里'？代表任何字符。

我也知道卢森。它很强大，但很难学习。

# metrics - 有人使用 ABC Metric 来测量应用程序的大小吗？

> ID：141979
> 
> 赞同：4
> 
> 时间：2008-09-26T21:06:55.457
> 
> 标签：metrics, measurement

它有一些不错的东西（比如它封装了圈复杂度的概念），我想知道是否有人在“现实生活”中使用过它。如果是这样，你的经验是什么？它是衡量大小的有用指标（与 KLOC 或功能点相反）吗？

对于那些想知道我在抽什么烟的人：这里有一些关于它的信息的链接：[http ://c2.com/cgi/wiki/Wiki?AbcMetric](http://c2.com/cgi/wiki/Wiki?AbcMetric)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T08:30:09.380

只要您在所有应用程序中使用相同的方法，应用程序的绝对“大小”就可以安全地以 LOC 或您能想到的任何其他指标来衡量。

然而，只有当您谈论代码库的重构和维护时，大小本身才真正重要。几乎必须将大小指标与覆盖率统计信息结合使用。

但大多数时候，功能点或类似概念可以让您更好地了解您的应用程序到底有多大。

例如，如果它有 10 FP 它很小，如果它有 200 它可能很大。

但是，如果它有 100 个 KLOC，除了我可能会花一些时间阅读这些行之外，它本身还能告诉我什么？几乎没有，我必须考虑大量其他因素才能理解这个指标。

显然，FP 有一个显着的缺点，即正确计算的成本很高。

# java - 缓冲一个大文件；BufferedInputStream 限制为 2gb；数组限制为 2^31 字节

> ID：141987
> 
> 赞同：2
> 
> 时间：2008-09-26T21:09:19.070
> 
> 标签：java, 64-bit, buffer, bufferedinputstream

我正在按顺序处理一个大文件，我想将其中的一大块保存在内存中，在 64 位系统上可用 16gb 内存。

一种快速而肮脏的方法是这样做，只需将输入流包装到缓冲输入流中，不幸的是，这只给了我一个 2gb 的缓冲区。我想有更多的记忆，我有什么选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T21:16:03.907

让操作系统处理文件的缓冲怎么样？您是否检查过不将整个文件复制到 JVM 内存中对性能的影响是什么？

编辑：然后您可以使用 RandomAccessFile 或 FileChannel 有效地将文件的必要部分读入 JVM 内存。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-26T21:17:31.343

你考虑过 java.nio 中的 MappedByteBuffer 吗？它在我的头上，但也许这就是你正在寻找的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T21:34:28.310

我怀疑一次缓冲超过 2GB 将是一个巨大的胜利。根据您正在执行的处理量，您可能能够以几乎与处理速度一样快的速度阅读。为了加快速度，您可以尝试使用双线程生产者-消费者模型（一个线程读取文件并将数据交给另一个线程进行处理）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-27T03:36:30.357

操作系统将尽可能多地缓存文件，因此试图智取缓存管理器可能不会让你得到太多。

从性能的角度来看，将字节保留在 JVM 之外会得到更好的服务（在操作系统和 JVM 之间传输大量数据相对较慢）。您可以通过使用由直接内存块支持的 MappedByteBuffer 来实现此目标。

这是一篇相关的文章类型： [文章](http://www.onjava.com/pub/a/onjava/2002/10/02/javanio.html?page=3)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T21:18:08.130

我认为有 64 位 JVM 将支持非标准限制。

您可以尝试缓冲块。

# javascript - 为什么更新面板会在几分钟后停止工作？

> ID：141989
> 
> 赞同：1
> 
> 时间：2008-09-26T21:09:36.077
> 
> 标签：javascript, ajax, asp.net-ajax, updatepanel

UpdatePanel 的哪些方面对时间敏感？

我有一个运行良好的 UpdatePanel。如果我离开页面几分钟然后回来，UpdatePanel 不起作用。看着萤火虫，我看到它发送了请求并得到了响应。但是，页面本身不会更新。我也没有看到任何脚本错误。到目前为止，除了时间的流逝，我还无法确定任何其他因素。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T21:19:51.807

也许您的应用程序域被回收或您的 Session 丢失了。您是否尝试过查看服务器上正在调用的内容？这就是我对下一步看哪里的建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T21:17:54.697

如果启用，请关闭 Firebug 网络监控。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-26T21:26:00.200

会话很可能已过期，导致它发回不再匹配页面的数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T21:36:21.020

如果它是一个会话到期，它应该可以在没有 UpdatePanel 的情况下重现——返回回发，看看它是否也会以这种方式发生。您甚至可能对错误有更好的了解，因为 UpdatePanel 在后台运行的 JavaScript 可能不会吃掉它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T21:38:02.043

我注意到，如果您的更新面板中有大量控件，它可能会超时或拒绝工作。有一次，我在更新面板中有一个 gridview，每行有三个 ajax 日历控件。gridview 中总共有 2,000 条记录。updatepanel 不太高兴

# java - 在 Java 中比较 2 个 XML 文档的最佳方法

> ID：141993
> 
> 赞同：212
> 
> 时间：2008-09-26T21:10:32.827
> 
> 标签：java, xml, testing, parsing, comparison

我正在尝试编写一个应用程序的自动化测试，该应用程序基本上将自定义消息格式转换为 XML 消息并将其发送到另一端。我有一组很好的输入/输出消息对，所以我需要做的就是发送输入消息并监听从另一端出来的 XML 消息。

当需要将实际输出与预期输出进行比较时，我遇到了一些问题。我的第一个想法就是对预期和实际消息进行字符串比较。这并不能很好地工作，因为我们所拥有的示例数据的格式并不总是一致，并且经常有不同的别名用于 XML 命名空间（有时根本不使用命名空间。）

我知道我可以解析两个字符串，然后遍历每个元素并自己比较它们，这不会太难做到，但我觉得有更好的方法或我可以利用的库。

所以，归根结底，问题是：

给定两个都包含有效 XML 的 Java 字符串，您将如何确定它们在语义上是否等效？如果您有办法确定差异是什么，则可以加分。

* * *

## 回答 #1

> 赞同：206
> 
> 时间：2008-09-26T21:43:03.857

听起来像是 XMLUnit 的工作

*   [http://www.xmlunit.org/](http://www.xmlunit.org/)
*   [https://github.com/xmlunit](https://github.com/xmlunit)

例子：

```
public class SomeTest extends XMLTestCase {
  @Test
  public void test() {
    String xml1 = ...
    String xml2 = ...

    XMLUnit.setIgnoreWhitespace(true); // ignore whitespace differences

    // can also compare xml Documents, InputSources, Readers, Diffs
    assertXMLEqual(xml1, xml2);  // assertXMLEquals comes from XMLTestCase
  }
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2010-11-18T02:50:41.473

下面将使用标准 JDK 库检查文档是否相等。

```
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
dbf.setNamespaceAware(true);
dbf.setCoalescing(true);
dbf.setIgnoringElementContentWhitespace(true);
dbf.setIgnoringComments(true);
DocumentBuilder db = dbf.newDocumentBuilder();

文档 doc1 = db.parse(new File("file1.xml"));
doc1.normalizeDocument();

文档 doc2 = db.parse(new File("file2.xml"));
doc2.normalizeDocument();

断言.assertTrue(doc1.isEqualNode(doc2));

```

normalize() 是为了确保没有周期（技术上不会有）

上面的代码将要求元素中的空格相同，因为它保留并评估它。Java 附带的标准 XML 解析器不允许您设置功能以提供规范版本或了解`xml:space`这是否会成为问题，那么您可能需要替换 XML 解析器，例如 xerces 或使用 JDOM。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-26T21:12:43.523

[Xom](http://xom.nu)有一个 Canonicalizer 实用程序，可以将您的 DOM 转换为常规形式，然后您可以对其进行字符串化和比较。因此，无论空格不规则或属性排序如何，您都可以对文档进行定期、可预测的比较。

这在具有专用可视字符串比较器的 IDE 中尤其有效，例如 Eclipse。您可以直观地看到文档之间的语义差异。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2013-05-09T21:40:20.563

最新版本的[XMLUnit](http://xmlunit.sourceforge.net/)可以帮助断言两个 XML 相等。也可能对所讨论`XMLUnit.setIgnoreWhitespace()`的`XMLUnit.setIgnoreAttributeOrder()`情况是必要的。

请参阅下面的 XML 单元使用的简单示例的工作代码。

```
import org.custommonkey.xmlunit.DetailedDiff;
import org.custommonkey.xmlunit.XMLUnit;
import org.junit.Assert;

public class TestXml {

    public static void main(String[] args) throws Exception {
        String result = "<abc             attr=\"value1\"                title=\"something\">            </abc>";
        // will be ok
        assertXMLEquals("<abc attr=\"value1\" title=\"something\"></abc>", result);
    }

    public static void assertXMLEquals(String expectedXML, String actualXML) throws Exception {
        XMLUnit.setIgnoreWhitespace(true);
        XMLUnit.setIgnoreAttributeOrder(true);

        DetailedDiff diff = new DetailedDiff(XMLUnit.compareXML(expectedXML, actualXML));

        List<?> allDifferences = diff.getAllDifferences();
        Assert.assertEquals("Differences found: "+ diff.toString(), 0, allDifferences.size());
    }

} 
```

如果使用 Maven，请将其添加到您的`pom.xml`：

```
<dependency>
    <groupId>xmlunit</groupId>
    <artifactId>xmlunit</artifactId>
    <version>1.4</version>
</dependency> 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-03-22T01:42:36.920

基于[Tom](https://stackoverflow.com/users/22850/tom)的回答，这里有一个使用 XMLUnit v2 的示例。

它使用这些 Maven 依赖项

```
 <dependency>
        <groupId>org.xmlunit</groupId>
        <artifactId>xmlunit-core</artifactId>
        <version>2.0.0</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.xmlunit</groupId>
        <artifactId>xmlunit-matchers</artifactId>
        <version>2.0.0</version>
        <scope>test</scope>
    </dependency> 
```

..这是测试代码

```
import static org.junit.Assert.assertThat;
import static org.xmlunit.matchers.CompareMatcher.isIdenticalTo;
import org.xmlunit.builder.Input;
import org.xmlunit.input.WhitespaceStrippedSource;

public class SomeTest extends XMLTestCase {
    @Test
    public void test() {
        String result = "<root></root>";
        String expected = "<root>  </root>";

        // ignore whitespace differences
        // https://github.com/xmlunit/user-guide/wiki/Providing-Input-to-XMLUnit#whitespacestrippedsource
        assertThat(result, isIdenticalTo(new WhitespaceStrippedSource(Input.from(expected).build())));

        assertThat(result, isIdenticalTo(Input.from(expected).build())); // will fail due to whitespace differences
    }
} 
```

概述这一点的文档是[https://github.com/xmlunit/xmlunit#comparing-two-documents](https://github.com/xmlunit/xmlunit#comparing-two-documents)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-04-28T08:54:51.970

谢谢，我扩展了这个，试试这个......

```
import java.io.ByteArrayInputStream;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.w3c.dom.Document;
import org.w3c.dom.NamedNodeMap;
import org.w3c.dom.Node;

public class XmlDiff 
{
    private boolean nodeTypeDiff = true;
    private boolean nodeValueDiff = true;

    public boolean diff( String xml1, String xml2, List<String> diffs ) throws Exception
    {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        dbf.setNamespaceAware(true);
        dbf.setCoalescing(true);
        dbf.setIgnoringElementContentWhitespace(true);
        dbf.setIgnoringComments(true);
        DocumentBuilder db = dbf.newDocumentBuilder();

        Document doc1 = db.parse(new ByteArrayInputStream(xml1.getBytes()));
        Document doc2 = db.parse(new ByteArrayInputStream(xml2.getBytes()));

        doc1.normalizeDocument();
        doc2.normalizeDocument();

        return diff( doc1, doc2, diffs );

    }

    /**
     * Diff 2 nodes and put the diffs in the list 
     */
    public boolean diff( Node node1, Node node2, List<String> diffs ) throws Exception
    {
        if( diffNodeExists( node1, node2, diffs ) )
        {
            return true;
        }

        if( nodeTypeDiff )
        {
            diffNodeType(node1, node2, diffs );
        }

        if( nodeValueDiff )
        {
            diffNodeValue(node1, node2, diffs );
        }

        System.out.println(node1.getNodeName() + "/" + node2.getNodeName());

        diffAttributes( node1, node2, diffs );
        diffNodes( node1, node2, diffs );

        return diffs.size() > 0;
    }

    /**
     * Diff the nodes
     */
    public boolean diffNodes( Node node1, Node node2, List<String> diffs ) throws Exception
    {
        //Sort by Name
        Map<String,Node> children1 = new LinkedHashMap<String,Node>();      
        for( Node child1 = node1.getFirstChild(); child1 != null; child1 = child1.getNextSibling() )
        {
            children1.put( child1.getNodeName(), child1 );
        }

        //Sort by Name
        Map<String,Node> children2 = new LinkedHashMap<String,Node>();      
        for( Node child2 = node2.getFirstChild(); child2!= null; child2 = child2.getNextSibling() )
        {
            children2.put( child2.getNodeName(), child2 );
        }

        //Diff all the children1
        for( Node child1 : children1.values() )
        {
            Node child2 = children2.remove( child1.getNodeName() );
            diff( child1, child2, diffs );
        }

        //Diff all the children2 left over
        for( Node child2 : children2.values() )
        {
            Node child1 = children1.get( child2.getNodeName() );
            diff( child1, child2, diffs );
        }

        return diffs.size() > 0;
    }

    /**
     * Diff the nodes
     */
    public boolean diffAttributes( Node node1, Node node2, List<String> diffs ) throws Exception
    {        
        //Sort by Name
        NamedNodeMap nodeMap1 = node1.getAttributes();
        Map<String,Node> attributes1 = new LinkedHashMap<String,Node>();        
        for( int index = 0; nodeMap1 != null && index < nodeMap1.getLength(); index++ )
        {
            attributes1.put( nodeMap1.item(index).getNodeName(), nodeMap1.item(index) );
        }

        //Sort by Name
        NamedNodeMap nodeMap2 = node2.getAttributes();
        Map<String,Node> attributes2 = new LinkedHashMap<String,Node>();        
        for( int index = 0; nodeMap2 != null && index < nodeMap2.getLength(); index++ )
        {
            attributes2.put( nodeMap2.item(index).getNodeName(), nodeMap2.item(index) );

        }

        //Diff all the attributes1
        for( Node attribute1 : attributes1.values() )
        {
            Node attribute2 = attributes2.remove( attribute1.getNodeName() );
            diff( attribute1, attribute2, diffs );
        }

        //Diff all the attributes2 left over
        for( Node attribute2 : attributes2.values() )
        {
            Node attribute1 = attributes1.get( attribute2.getNodeName() );
            diff( attribute1, attribute2, diffs );
        }

        return diffs.size() > 0;
    }
    /**
     * Check that the nodes exist
     */
    public boolean diffNodeExists( Node node1, Node node2, List<String> diffs ) throws Exception
    {
        if( node1 == null && node2 == null )
        {
            diffs.add( getPath(node2) + ":node " + node1 + "!=" + node2 + "\n" );
            return true;
        }

        if( node1 == null && node2 != null )
        {
            diffs.add( getPath(node2) + ":node " + node1 + "!=" + node2.getNodeName() );
            return true;
        }

        if( node1 != null && node2 == null )
        {
            diffs.add( getPath(node1) + ":node " + node1.getNodeName() + "!=" + node2 );
            return true;
        }

        return false;
    }

    /**
     * Diff the Node Type
     */
    public boolean diffNodeType( Node node1, Node node2, List<String> diffs ) throws Exception
    {       
        if( node1.getNodeType() != node2.getNodeType() ) 
        {
            diffs.add( getPath(node1) + ":type " + node1.getNodeType() + "!=" + node2.getNodeType() );
            return true;
        }

        return false;
    }

    /**
     * Diff the Node Value
     */
    public boolean diffNodeValue( Node node1, Node node2, List<String> diffs ) throws Exception
    {       
        if( node1.getNodeValue() == null && node2.getNodeValue() == null )
        {
            return false;
        }

        if( node1.getNodeValue() == null && node2.getNodeValue() != null )
        {
            diffs.add( getPath(node1) + ":type " + node1 + "!=" + node2.getNodeValue() );
            return true;
        }

        if( node1.getNodeValue() != null && node2.getNodeValue() == null )
        {
            diffs.add( getPath(node1) + ":type " + node1.getNodeValue() + "!=" + node2 );
            return true;
        }

        if( !node1.getNodeValue().equals( node2.getNodeValue() ) )
        {
            diffs.add( getPath(node1) + ":type " + node1.getNodeValue() + "!=" + node2.getNodeValue() );
            return true;
        }

        return false;
    }

    /**
     * Get the node path
     */
    public String getPath( Node node )
    {
        StringBuilder path = new StringBuilder();

        do
        {           
            path.insert(0, node.getNodeName() );
            path.insert( 0, "/" );
        }
        while( ( node = node.getParentNode() ) != null );

        return path.toString();
    }
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-04-12T10:09:19.470

[AssertJ](http://joel-costigliola.github.io/assertj/) 1.4+ 有特定的断言来比较 XML 内容：

```
String expectedXml = "<foo />";
String actualXml = "<bar />";
assertThat(actualXml).isXmlEqualTo(expectedXml); 
```

这是[文档](https://github.com/joel-costigliola/assertj-core/wiki/New-and-noteworthy#xml-assertions)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-08-23T12:38:03.803

下面的代码对我有用

```
String xml1 = ...
String xml2 = ...
XMLUnit.setIgnoreWhitespace(true);
XMLUnit.setIgnoreAttributeOrder(true);
XMLAssert.assertXMLEqual(actualxml, xmlInDb); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-26T21:51:15.553

skaffman 似乎给出了一个很好的答案。

另一种方法可能是使用像 xmlstarlet( [http://xmlstar.sourceforge.net/](http://xmlstar.sourceforge.net/) ) 这样的命令行实用程序来格式化 XML，然后格式化两个字符串，然后使用任何 diff 实用程序（库）来区分生成的输出文件。当名称空间出现问题时，我不知道这是否是一个好的解决方案。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-10-26T09:35:42.693

我正在使用[Altova DiffDog](http://www.altova.com/diffdog/diff-merge-tool.html)，它具有在结构上比较 XML 文件的选项（忽略字符串数据）。

这意味着（如果选中“忽略文本”选项）：

```
<foo a="xxx" b="xxx">xxx</foo> 
```

和

```
<foo b="yyy" a="yyy">yyy</foo> 
```

在结构上平等的意义上是平等的。如果您有数据不同但结构不同的示例文件，这很方便！

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-04-15T23:41:57.970

我需要与主要问题中要求的功能相同的功能。由于不允许我使用任何 3rd 方库，因此我基于 @Archimedes Trajano 解决方案创建了自己的解决方案。

以下是我的解决方案。

```
import java.io.ByteArrayInputStream;
import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;

import org.junit.Assert;
import org.w3c.dom.Document;

/**
 * Asserts for asserting XML strings.
 */
public final class AssertXml {

    private AssertXml() {
    }

    private static Pattern NAMESPACE_PATTERN = Pattern.compile("xmlns:(ns\\d+)=\"(.*?)\"");

    /**
     * Asserts that two XML are of identical content (namespace aliases are ignored).
     * 
     * @param expectedXml expected XML
     * @param actualXml actual XML
     * @throws Exception thrown if XML parsing fails
     */
    public static void assertEqualXmls(String expectedXml, String actualXml) throws Exception {
        // Find all namespace mappings
        Map<String, String> fullnamespace2newAlias = new HashMap<String, String>();
        generateNewAliasesForNamespacesFromXml(expectedXml, fullnamespace2newAlias);
        generateNewAliasesForNamespacesFromXml(actualXml, fullnamespace2newAlias);

        for (Entry<String, String> entry : fullnamespace2newAlias.entrySet()) {
            String newAlias = entry.getValue();
            String namespace = entry.getKey();
            Pattern nsReplacePattern = Pattern.compile("xmlns:(ns\\d+)=\"" + namespace + "\"");
            expectedXml = transletaNamespaceAliasesToNewAlias(expectedXml, newAlias, nsReplacePattern);
            actualXml = transletaNamespaceAliasesToNewAlias(actualXml, newAlias, nsReplacePattern);
        }

        // nomralize namespaces accoring to given mapping

        DocumentBuilder db = initDocumentParserFactory();

        Document expectedDocuemnt = db.parse(new ByteArrayInputStream(expectedXml.getBytes(Charset.forName("UTF-8"))));
        expectedDocuemnt.normalizeDocument();

        Document actualDocument = db.parse(new ByteArrayInputStream(actualXml.getBytes(Charset.forName("UTF-8"))));
        actualDocument.normalizeDocument();

        if (!expectedDocuemnt.isEqualNode(actualDocument)) {
            Assert.assertEquals(expectedXml, actualXml); //just to better visualize the diffeences i.e. in eclipse
        }
    }

    private static DocumentBuilder initDocumentParserFactory() throws ParserConfigurationException {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        dbf.setNamespaceAware(false);
        dbf.setCoalescing(true);
        dbf.setIgnoringElementContentWhitespace(true);
        dbf.setIgnoringComments(true);
        DocumentBuilder db = dbf.newDocumentBuilder();
        return db;
    }

    private static String transletaNamespaceAliasesToNewAlias(String xml, String newAlias, Pattern namespacePattern) {
        Matcher nsMatcherExp = namespacePattern.matcher(xml);
        if (nsMatcherExp.find()) {
            xml = xml.replaceAll(nsMatcherExp.group(1) + "[:]", newAlias + ":");
            xml = xml.replaceAll(nsMatcherExp.group(1) + "=", newAlias + "=");
        }
        return xml;
    }

    private static void generateNewAliasesForNamespacesFromXml(String xml, Map<String, String> fullnamespace2newAlias) {
        Matcher nsMatcher = NAMESPACE_PATTERN.matcher(xml);
        while (nsMatcher.find()) {
            if (!fullnamespace2newAlias.containsKey(nsMatcher.group(2))) {
                fullnamespace2newAlias.put(nsMatcher.group(2), "nsTr" + (fullnamespace2newAlias.size() + 1));
            }
        }
    }

} 
```

它比较两个 XML 字符串，并通过将它们转换为两个输入字符串中的唯一值来处理任何不匹配的名称空间映射。

可以微调，即在命名空间转换的情况下。但对于我的要求，只是做这项工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-10-14T13:10:41.627

这将比较完整的字符串 XML（在途中重新格式化它们）。它使您可以轻松地使用您的 IDE（IntelliJ、Eclipse），因为您只需单击并直观地查看 XML 文件中的差异。

```
import org.apache.xml.security.c14n.CanonicalizationException;
import org.apache.xml.security.c14n.Canonicalizer;
import org.apache.xml.security.c14n.InvalidCanonicalizerException;
import org.w3c.dom.Element;
import org.w3c.dom.bootstrap.DOMImplementationRegistry;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSSerializer;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.TransformerException;
import java.io.IOException;
import java.io.StringReader;

import static org.apache.xml.security.Init.init;
import static org.junit.Assert.assertEquals;

public class XmlUtils {
    static {
        init();
    }

    public static String toCanonicalXml(String xml) throws InvalidCanonicalizerException, ParserConfigurationException, SAXException, CanonicalizationException, IOException {
        Canonicalizer canon = Canonicalizer.getInstance(Canonicalizer.ALGO_ID_C14N_OMIT_COMMENTS);
        byte canonXmlBytes[] = canon.canonicalize(xml.getBytes());
        return new String(canonXmlBytes);
    }

    public static String prettyFormat(String input) throws TransformerException, ParserConfigurationException, IOException, SAXException, InstantiationException, IllegalAccessException, ClassNotFoundException {
        InputSource src = new InputSource(new StringReader(input));
        Element document = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(src).getDocumentElement();
        Boolean keepDeclaration = input.startsWith("<?xml");
        DOMImplementationRegistry registry = DOMImplementationRegistry.newInstance();
        DOMImplementationLS impl = (DOMImplementationLS) registry.getDOMImplementation("LS");
        LSSerializer writer = impl.createLSSerializer();
        writer.getDomConfig().setParameter("format-pretty-print", Boolean.TRUE);
        writer.getDomConfig().setParameter("xml-declaration", keepDeclaration);
        return writer.writeToString(document);
    }

    public static void assertXMLEqual(String expected, String actual) throws ParserConfigurationException, IOException, SAXException, CanonicalizationException, InvalidCanonicalizerException, TransformerException, IllegalAccessException, ClassNotFoundException, InstantiationException {
        String canonicalExpected = prettyFormat(toCanonicalXml(expected));
        String canonicalActual = prettyFormat(toCanonicalXml(actual));
        assertEquals(canonicalExpected, canonicalActual);
    }
} 
```

我更喜欢它而不是 XmlUnit，因为客户端代码（测试代码）更干净。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-02-09T11:12:51.407

将 JExamXML 与 Java 应用程序一起使用

```
 import com.a7soft.examxml.ExamXML;
    import com.a7soft.examxml.Options;

       .................

       // Reads two XML files into two strings
       String s1 = readFile("orders1.xml");
       String s2 = readFile("orders.xml");

       // Loads options saved in a property file
       Options.loadOptions("options");

       // Compares two Strings representing XML entities
       System.out.println( ExamXML.compareXMLString( s1, s2 ) ); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-24T16:16:11.467

## 使用 XMLUnit 2.x

在里面`pom.xml`

```
<dependency>
    <groupId>org.xmlunit</groupId>
    <artifactId>xmlunit-assertj3</artifactId>
    <version>2.9.0</version>
</dependency> 
```

测试实现（使用junit 5）：

```
import org.junit.jupiter.api.Test;
import org.xmlunit.assertj3.XmlAssert;

public class FooTest {

    @Test
    public void compareXml() {
        //
        String xmlContentA = "<foo></foo>";
        String xmlContentB = "<foo></foo>";
        //
        XmlAssert.assertThat(xmlContentA).and(xmlContentB).areSimilar();
    }
} 
```

其他方法 : `areIdentical()`, `areNotIdentical()`,`areNotSimilar()`

[此文档页面](https://github.com/xmlunit/user-guide/wiki/CompareAssert)中的更多详细信息（配置`assertThat(~).and(~)`和示例）。

XMLUnit 还具有（以及其他特性）a[`DifferenceEvaluator`](https://github.com/xmlunit/user-guide/wiki/DifferenceEvaluator)可以进行更精确的比较。

[XMLUnit 网站](https://www.xmlunit.org/)

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-09-27T16:30:09.123

既然您说“语义等效”，我假设您的意思是您想做的不仅仅是从字面上验证 xml 输出是否（字符串）等于，并且您想要类似的东西

<foo> 这里有些东西</foo></code>

和

<foo>这里有些东西</foo></code>

读为等价物。最终，您如何在要从中重构消息的任何对象上定义“语义等价”将很重要。只需从消息中构建该对象并使用自定义 equals() 来定义您要查找的内容。*******************