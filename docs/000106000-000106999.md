# StackOverflow 问答 000106000-000106999

# sharepoint - Office 2003 用户不能使用哪些 SharePoint 2007 功能？

> ID：106000
> 
> 赞同：1
> 
> 时间：2008-09-19T21:59:35.010
> 
> 标签：sharepoint, ms-office

我的任务是为 SharePoint 2007 提供一份兼容性指南，比较 Office 2003 和 Office 2007。有人知道在哪里可以找到这样的列表吗？

我已经搜索了一段时间，但似乎找不到完整的列表。

谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T22:05:23.093

有关 Office 与 SharePoint 集成的完整 MS 白皮书：

[http://download.microsoft.com/download/5/d/c/5dcfc15a-c31e-4a14-93cf-b44bce3e447e/Microsoft%20Office%20and%20SharePoint%20Integration%20White%20Paper.doc](http://download.microsoft.com/download/5/d/c/5dcfc15a-c31e-4a14-93cf-b44bce3e447e/Microsoft%20Office%20and%20SharePoint%20Integration%20White%20Paper.doc)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T14:51:49.880

这篇文章可能会有所帮助：[http ://www.sharepointusecases.com/index.php/2008/08/office-2003-and-sharepoint-2007-comparision](http://www.sharepointusecases.com/index.php/2008/08/office-2003-and-sharepoint-2007-comparision)

# sql-injection - 参数化的 SQL 列？

> ID：106001
> 
> 赞同：8
> 
> 时间：2008-09-19T21:59:35.727
> 
> 标签：sql-injection, parameterized

我有一些代码利用参数化查询来防止注入，但我还需要能够动态构造查询，而不管表的结构如何。这样做的正确方法是什么？

这是一个示例，假设我有一个包含名称、地址、电话列的表。我有一个网页，我在其中运行**Show Columns**并使用它们作为选项填充选择下拉列表。

接下来，我有一个名为**Search**的文本框。此文本框用作参数。

目前我的代码看起来像这样：

```
result = pquery('SELECT * FROM contacts WHERE `' + escape(column) + '`=?', search);

```

不过，我从中得到一种恶心的感觉。我使用参数化查询的原因是避免使用**escape**。此外，**转义**可能不是为转义列名而设计的。

我怎样才能确保这按我的意图工作？

**编辑：** 我需要动态查询的原因是模式是用户可配置的，我不会去修复任何硬编码的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-19T22:03:17.480

无需传递列名，只需传递您编码的标识符，该标识符将使用硬编码表转换为列名。这意味着您无需担心会传递恶意数据，因为所有数据要么经过合法翻译，要么已知无效。伪代码：

```
@columns = qw/Name Address Telephone/;
if ($columns[$param]) {
  $query = "select * from contacts where $columns[$param] = ?";
} else {
  die "Invalid column!";
}

run_sql($query, $search); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-19T22:10:51.097

诀窍是对您的转义和验证程序充满信心。我使用自己的 SQL 转义函数，该函数为不同类型的文字重载。我无法直接从用户输入插入表达式（与引用的文字值相反）。

尽管如此，它还是可以做到的，我推荐一个单独的 - 并且严格的 - 函数来验证列名。允许它只接受一个标识符，比如

```
/^\w[\w\d_]*$/

```

您将不得不依赖您可以对自己的列名做出的假设。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T22:12:46.337

我使用 ADO.NET 并使用 SQL 命令和 SQLParameters 来处理那些处理 Escape 问题的命令。因此，如果您也在 Microsoft 工具环境中，我可以说我非常成功地使用它来构建动态 SQL 并保护我的参数

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T22:15:49.900

根据对枚举可能架构值的表的另一个查询的结果创建列。在第二个查询中，您可以将选择硬编码为用于定义架构的列名。如果没有返回行，则输入的列无效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T22:16:13.380

在标准 SQL 中，您将分隔标识符括在双引号中。这意味着：

```
SELECT * FROM "SomeTable" WHERE "SomeColumn" = ? 
```

将从具有所示大写字母的名为 SomeTable 的表中进行选择（不是名称的大小写转换版本），并将条件应用于具有所示大写字母的名为 SomeColumn 的列。

就其本身而言，这并不是很有帮助，但是...如果您可以将带有双引号的 escape() 技术应用于通过 Web 表单输入的名称，那么您可以合理自信地构建您的查询。

当然，您说您想避免使用转义 - 实际上您不必在提供 ? 的参数上使用它。占位符。但是，当您将用户提供的数据放入查询中时，您需要保护自己免受恶意人员的侵害。

不同的 DBMS 有不同的方式来提供分隔标识符。例如，MS SQL Server 似乎使用方括号 [SomeTable] 而不是双引号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T22:16:26.140

某些数据库中的列名可以包含空格，这意味着您必须引用列名，但如果您的数据库不包含此类列，只需在拼接到 SQL 之前通过正则表达式或某种检查运行列名：

```
if ( $column !~ /^\w+$/ ) {
  die "Bad column name [$column]";
} 
```

# c# - 如何从 C/C++ 调用 .NET 程序集？

> ID：106033
> 
> 赞同：28
> 
> 时间：2008-09-19T22:06:37.597
> 
> 标签：c#, .net, c++

假设我正在用 C++ 和 C# 编写应用程序。我想用 C++ 编写低级部分并用 C# 编写高级逻辑。如何从我的 C++ 程序加载 .NET 程序集并开始调用方法和访问我的 C# 类的属性？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-19T22:34:44.880

你真的应该研究 C++/CLI。它使这样的任务几乎是微不足道的。

否则，您必须围绕 C# 代码生成 COM 包装器，并让您的 C++ 应用程序调用 COM 包装器。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-19T22:18:59.753

```
[Guid("123565C4-C5FA-4512-A560-1D47F9FDFA20")]
public interface IConfig
{
    [DispId(1)]
    string Destination{ get; }

    [DispId(2)]
    void Unserialize();

    [DispId(3)]
    void Serialize();
}

[ComVisible(true)]
[Guid("12AC8095-BD27-4de8-A30B-991940666927")]
[ClassInterface(ClassInterfaceType.None)]
public sealed class Config : IConfig
{
    public Config()
    {
    }

    public string Destination
    {
        get { return ""; }
    }

    public void Serialize()
    {
    }

    public void Unserialize()
    {
    }
} 
```

之后，您需要重新充气您的组件。Regasm 将添加必要的注册表项以允许您的 .NET 组件被视为 COM 组件。之后，您可以像调用任何其他 COM 组件一样在 C++ 中调用您的 .NET 组件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T01:50:48.557

我肯定会为此调查 C++/CLI 并避免 COM 和所有可能产生的注册麻烦。

使用 C++ 的动机是什么？如果它只是样式，那么您可能会发现您可以用 C++/CLI 编写所有内容。如果是性能，那么在托管 C++ 和非托管代码之间来回调用是相对简单的。但它永远不会是透明的。您不能先将托管指针传递给非托管代码而不固定它，以便垃圾收集器不会移动它，当然非托管代码不会知道您的托管类型。但是托管 (C++) 代码可以了解您的非托管类型。

需要注意的另一件事是，包含**非托管**代码的 C++/CLI 程序集将是特定于体系结构的。您将需要为 x86 和 x64（和 IA64）单独构建。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T22:30:32.313

如果您的进程中可以同时包含托管代码和非托管代码，则可以创建一个具有虚函数的 C++ 类。使用混合模式 C++/CLI 实现该类。将实现注入到您的 C++ 代码中，以便可以从您的（低级）C++ 代码调用（高级）实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T22:09:12.537

您可以将 .NET 组件包装在 COM 组件中（使用 .NET 工具非常容易）并通过 COM 调用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T22:10:52.580

如果 C++ 中的低级部分，那么通常您可以从传递所需值的 C# 代码中调用它。这应该以您可能习惯的标准方式工作。例如，您需要阅读编组。

您可以查看此[博客](http://blogs.msdn.com/deeptanshuv/archive/2005/06/26/432870.aspx)以获取一些具体细节。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T22:18:13.110

正常创建 .NET 程序集，但请务必使用 ClassInterface(ClassInterfaceType.AutoDual) 标记该类，并确保将程序集信息 SetAssemblyAtribute 设置为 ComVisible(true)。

然后，使用 REGASM 创建 COM 包装器：

regasm mydll.dll /tlb:mydll.tbl /codebase f:_code\ClassLibraryForCom

一定要使用 /codebase 指令——如果你不打算给程序集一个强名称，这是必要的。

rp

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T22:27:25.397

由于 C# 可以导入 C++ 标准导出，因此在 C# 应用程序中加载 C++ dll 可能比使用 C++ 中的 COM 更容易。

请参阅 System.Runtime.InteropServices.DllImport 的文档。

此外，这里是您可以在托管代码和非托管代码之间执行的互操作类型的完整列表：

[http://blogs.msdn.com/deeptanshuv/archive/2005/06/26/432870.aspx](http://blogs.msdn.com/deeptanshuv/archive/2005/06/26/432870.aspx)

简而言之：

(a) 使用 COM-Interop

(b) 使用导入/pinvoke（显式方法调用）

(c) IJW 和 MC++ 应用程序：MC++ 和 IJW 应用程序可以自由地相互调用。

(d) 托管。这种情况很少见，但 CLR 可以由非托管应用托管，这意味着运行时会调用一堆托管回调。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T22:49:28.650

我找到了嵌入 Mono 的链接： [http ://www.mono-project.com/Embedding_Mono](http://www.mono-project.com/Embedding_Mono)

它为与程序集交互提供了一个看起来非常简单的界面。这可能是一个有吸引力的选择，特别是如果您想跨平台

# c# - 在 WinForm 应用程序中进行批处理时，如何让 UI 线程更新 UI？

> ID：106036
> 
> 赞同：9
> 
> 时间：2008-09-19T22:06:50.093
> 
> 标签：c#, .net, winforms

我有一个用 .NET 3.5 用 C# 编写的 WinForms 应用程序。它运行一个冗长的批处理过程。我希望应用程序更新批处理正在执行的状态。更新 UI 的最佳方式是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-19T22:08:52.773

BackgroundWorker 听起来像您想要的对象。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-19T22:11:43.687

快速而肮脏的方法是使用`Application.DoEvents()`但这可能会导致处理订单事件的问题。所以不推荐

问题可能不是您必须屈服于 ui 线程，而是您在 ui 线程上进行处理，阻止它处理消息。您可以使用 backgroundworker 组件在不同的线程上进行批处理，而不会阻塞 UI 线程。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T22:11:27.447

在后台线程上运行冗长的进程。后台工作程序类是一种简单的方法——它为发送进度更新和完成事件提供了简单的支持，在正确的线程上为您调用事件处理程序。这使代码保持简洁明了。

要显示更新，进度条或状态栏文本是最常用的两种方法。

要记住的关键是，如果您在后台线程上执行操作，则必须切换到 UI 线程才能更新 Windows 控件等。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-11T18:18:47.630

为了加强人们对 DoEvents 的看法，这里描述了可能发生的情况。

假设您有一些包含数据的表单，并且您的长期运行事件正在将其保存到数据库或基于它生成报告。您开始保存或生成报告，然后定期调用 DoEvents 以使屏幕继续绘制。

不幸的是，屏幕不仅仅是绘画，它还会对用户的操作做出反应。这是因为 DoEvents 会停止您现在正在执行的操作以处理所有等待由您的 Winforms 应用程序处理的 Windows 消息。这些消息包括重绘请求，以及任何用户输入、点击等。

例如，当你保存数据时，用户可以做一些事情，比如让应用程序显示一个与长时间运行的任务完全无关的模式对话框（例如帮助->关于）。现在，您正在对已经运行的长时间运行的任务中的**新**用户操作做出反应。当您调用它时正在等待的所有事件完成时，DoEvents 将返回，然后您的长时间运行的任务将继续。

如果用户没有关闭模态对话框怎么办？您长时间运行的任务将永远等待，直到此对话框关闭。如果您正在提交一个数据库并持有一个事务，那么现在您在用户喝咖啡时持有一个打开的事务。要么您的事务超时并且您丢失了持久性工作，要么事务没有超时并且您可能会死锁数据库的其他用户。

这里发生的是 Application.DoEvents 使您的代码可重入。[请参阅此处](http://en.wikipedia.org/wiki/Reentrant_(subroutine))的维基百科定义。请注意文章顶部的一些要点，即要使代码可重入，它：

*   必须不保存静态（或全局）非常量数据。
*   必须仅对调用者提供给它的数据起作用。
*   不能依赖锁来锁定单例资源。
*   不得调用不可重入的计算机程序或例程。

WinForms 应用程序中长时间运行的代码不太可能只处理调用者传递给方法的数据，不保存静态数据，不持有锁，并且只调用其他可重入方法。

正如这里的许多人所说，DoEvents 会导致代码中出现一些非常奇怪的场景。它可能导致的错误很难诊断，您的用户不太可能告诉您“哦，这可能是因为我在等待保存时单击了这个不相关的按钮”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-21T23:10:02.920

使用`Backgroundworker`，并且如果您还尝试通过处理`ProgressChanged`事件来更新 GUI 线程（例如，对于 a `ProgressBar`），请务必同时设置`WorkerReportsProgress=true`，否则报告进度的线程将在第一次尝试调用时终止`ReportProgress`...

抛出异常，但您可能看不到它，除非您启用了“抛出时”，并且输出只会显示线程已退出。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T22:10:15.140

使用 backgroundworker 组件在单独的线程中运行批处理，这不会影响 UI 线程。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T23:18:33.447

我想重申我之前的评论者指出的内容：请尽可能避免 DoEvents() ，因为这几乎总是一种“黑客”形式并导致维护噩梦。

如果你走 BackgroundWorker 道路（我建议），如果你想调用控件的任何方法或属性，你将不得不处理对 UI 的跨线程调用，因为这些是线程仿射的，只能从他们创建的线程。酌情使用 Control.Invoke() 和/或 Control.BeginInvoke()。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T23:35:10.070

如果您在后台/工作线程中运行，您可以调用`Control.Invoke`您的 UI 控件之一在 UI 线程中运行委托。

`Control.Invoke`是同步的（等到委托返回）。如果您不想等待，请使用`.BeginInvoke()`仅对命令进行排队。

的返回值`.BeginInvoke()`允许您检查方法是否完成或等到它完成。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T22:08:31.323

Application.DoEvents() 还是可能在单独的线程上运行批处理？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-19T22:12:09.893

DoEvents() 是我一直在寻找的，但我也投票支持后台工作人员的答案，因为这看起来是一个很好的解决方案，我将进行更多调查。

# batch-file - 如何从命令提示符使用 soem 开关标志调试 exe

> ID：106038
> 
> 赞同：1
> 
> 时间：2008-09-19T22:06:57.223
> 
> 标签：batch-file, debugging, command, prompt

例如，从命令提示符下，我需要在调试器下启动带有一些开关标志的 exe。我该怎么做？

这是一个来自 c/c++ 的 exe，使用我需要调试的 VS2005 环境构建。我将一些标志传递给这个 exe 来执行一些事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T22:09:38.840

您需要提供有关您的开发环境的更多信息才能获得具体答案。

例如，对于 Visual Studio 中的 C# 项目，您可以右键单击项目 -> 属性，然后在“调试”选项卡中填写“命令行参数”字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T22:15:25.003

我想我已经成功了。右键单击项目-> 属性，然后在“调试”选项卡中填写“命令行参数”字段。bkane 解决方案有效。谢谢。

# linux - 由守护进程提供支持的 Web 服务的最佳方法

> ID：106045
> 
> 赞同：2
> 
> 时间：2008-09-19T22:08:51.103
> 
> 标签：linux, web-services

我对 Web 服务比较陌生，想知道标准的“最佳方法”是什么。基本上，事情的工作方式是我需要有一个任务不断地在后台运行。

Web 服务将连接到守护程序并返回适当的响应。目前，通信是通过 unix 域套接字进行的（Linux 是预期的服务器平台）。

这是做到这一点的“正确”方式吗？或者是否有更合适的方法来让您的网络服务器基于后台任务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-19T22:14:03.697

这几乎是最佳实践。您可能对其他 Web 应用程序中的这种模式很熟悉：守护程序通常是一个数据库。:)

# windows - 如何使用 Perl 使批处理文件像简单的 grep 一样工作？

> ID：106053
> 
> 赞同：10
> 
> 时间：2008-09-19T22:10:05.920
> 
> 标签：windows, perl, batch-file

我已经知道这个问题的明显答案：“只需下载 <在此处插入最喜欢的 Windows grep 或类似 grep 的工具>”。但是，我在当地 IT 人员严格控制的环境中工作，我们可以在我们的计算机上拥有什么。我只想说：我可以在 Windows XP 上访问 Perl。这是我想出的一个快速 Perl 脚本，它可以满足我的需求，但我还没有想出如何设置一个批处理文件，以便我可以将命令输出通过管道传输到其中，或者传递一个文件（或文件列表?) 作为“grep 表达式”之后的参数：

```
perl -n -e "打印 $_ if (m![表达式]!);" [文件名]

```

如何编写可以执行以下操作的批处理脚本，例如：

```
目录 | grep.bat 我的模式
grep.bat mypattern myfile.txt

```

**编辑**：即使我标记了另一个“答案”，我还是想赞扬[Ray Hayes 的答案](https://stackoverflow.com/questions/106053/how-to-make-a-batch-file-to-act-like-a-simple-grep-using-perl#106099)，因为它确实是“Windows 方式”，即使另一个答案在技术上更接近我想要的。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-19T22:18:54.387

grep 的大部分功能已经在您的计算机上的 Windows 应用程序 FindStr.exe 中可用，它是所有 Windows 2000、XP 和 Vista 计算机的一部分！它提供 RegExpr 等。

比调用 Perl 的批处理文件容易得多！

```
c:\>FindStr /?    
Searches for strings in files.

FINDSTR [/B] [/E] [/L] [/R] [/S] [/I] [/X] [/V] [/N] [/M] [/O] [/P] [/F:file]
        [/C:string] [/G:file] [/D:dir list] [/A:color attributes] [/OFF[LINE]]
        strings [[drive:][path]filename[ ...]]

  /B         Matches pattern if at the beginning of a line.
  /E         Matches pattern if at the end of a line.
  /L         Uses search strings literally.
  /R         Uses search strings as regular expressions.
  /S         Searches for matching files in the current directory and all
             subdirectories.
  /I         Specifies that the search is not to be case-sensitive.
  /X         Prints lines that match exactly.
  /V         Prints only lines that do not contain a match.
  /N         Prints the line number before each line that matches.
  /M         Prints only the filename if a file contains a match.
  /O         Prints character offset before each matching line.
  /P         Skip files with non-printable characters.
  /OFF[LINE] Do not skip files with offline attribute set.
  /A:attr    Specifies color attribute with two hex digits. See "color /?"
  /F:file    Reads file list from the specified file(/ stands for console).
  /C:string  Uses specified string as a literal search string.
  /G:file    Gets search strings from the specified file(/ stands for console).
  /D:dir     Search a semicolon delimited list of directories
  strings    Text to be searched for.
  [drive:][path]filename
             Specifies a file or files to search.

Use spaces to separate multiple search strings unless the argument is prefixed
with /C.  For example, 'FINDSTR "hello there" x.y' searches for "hello" or
"there" in file x.y.  'FINDSTR /C:"hello there" x.y' searches for
"hello there" in file x.y.

Regular expression quick reference:
  .        Wildcard: any character
  *        Repeat: zero or more occurances of previous character or class
  ^        Line position: beginning of line
  $        Line position: end of line
  [class]  Character class: any one character in set
  [^class] Inverse class: any one character not in set
  [x-y]    Range: any characters within the specified range
  \x       Escape: literal use of metacharacter x
  \<xyz    Word position: beginning of word
  xyz\>    Word position: end of word 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-19T22:49:02.863

下载并安装[ack](http://search.cpan.org/dist/ack/)。它是 grep 的出色替代品，并且 - 由于 Perl 的神奇双模式 .BAT / Perl 脚本魔法 - 它可以在命令行上为您工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-19T22:29:39.930

我前一阵子写了这个：

```
@rem = '--*-Perl-*--
@echo off
perl -x -S %0 %*
goto endofperl

@rem -- BEGIN PERL -- ';
#!d:/Perl/bin/perl.exe -w
#line 10
use strict; 
#use Test::Setup;
use Getopt::Long;

Getopt::Long::Configure ("bundling");

my $ignore_case    = 0;
my $number_line    = 0;
my $invert_results = 0;
my $verbose        = 0;

my $result = GetOptions( 
    'i|ignore_case' => \$ignore_case, 
    'n|number'      => \$number_line,
    'v|invert'      => \$invert_results,
    'verbose'       => \$verbose,
);
my $regex = shift;

if ( $ignore_case ) { 
    $regex = "(?i:$regex)";
}
$regex = qr/$regex/;
print "\$regex=$regex\n";
if ( $verbose ) { 
    print "Verbose: Ignoring case.\n"                      if $ignore_case;
    print "Verbose: Printing file name and line number.\n" if $number_line;
    print "Verbose: Inverting result set.\n"               if $invert_results;
    print "\n";
}

@ARGV = map { glob "$_" } @ARGV;

while ( <> ) { 
    my $matches = m/$regex/;
    next unless $matches ^ $invert_results;
    print "$ARGV\:$.:" if $number_line;
    print;
}

__END__
:endofperl 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-19T23:15:04.703

首先，把它变成一个真正的脚本，而不是一个单行：

```
use strict;
use warnings;

my $pattern = shift or die "Usage: $0 <pattern> [files|-]\n";
while (<>) { print if /$pattern/ } 
```

然后用pl2bat把它变成一个批处理文件：

```
pl2bat mygrep.pl 
```

这将创建“mygrep.bat”。

有关完全用 Perl 编写的全功能 grep（和许多其他 Unix 应用程序），请参阅[Perl Power Tools](http://search.cpan.org/dist/ppt/)项目。

如果只能运行 Perl，Perl Power Tools 就很好，但我通常更喜欢[GnuWin32](http://gnuwin32.sourceforge.net/)工具集。它们不需要安装。（您不需要管理权限，只需要一个可以写入的目录。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T22:19:00.237

你需要做这样的事情：

```
@echo off
perl -x -S script.pl %1 
```

"%1" 会将参数传递给 Perl 脚本。将其保存为 .bat 文件，您就可以开始使用了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T22:39:40.780

我同意 Axeman 和 Hayes 先生关于使用更好的工具来完成这项工作的观点。也就是说，您可以在批处理文件中尝试这样的操作，以针对文件通配符表达式运行自定义脚本：

```
@echo off

for /f "usebackq delims==" %%f in (`dir /w /b %2`) do (
    perl -n -e "print $_ if (m!%1!);" "%%f"
    REM or something like:  myperlscript.pl %1 "%%f"
) 
```

通过这种方式，您可以执行“grep mypattern myfile.txt”、“grep mypattern .”、“grep mypattern *.doc”等操作。

# c++ - QDrag 在拖动时被破坏

> ID：106056
> 
> 赞同：4
> 
> 时间：2008-09-19T22:10:23.517
> 
> 标签：c++, qt, com, drag-and-drop

我有一个在 QTreeView 中使用拖放的 Windows/Linux Qt 4.3 应用程序。我有两个非常相似的应用程序，它们使用相同的 Qt 库集。拖放在 Linux 上都适用，但在 Windows 上只适用于其中之一。

在不工作的应用程序中，一旦鼠标移动，QDrag 对象就会被删除。它被事件队列中的 DeferredDelete 事件删除，该事件队列在拖动期间仍在 Qt 中处理。我不知道如何查看导致 QDrag 对象过早删除的原因。

我想不出调试这个问题的好方法。我已经比较了来源，找不到任何明显的东西。我曾尝试在另一个应用程序中使用其中一个应用程序的代码。

有什么建议么？

**更新：**

QDrag 操作失败的原因是 COM 没有成功初始化，所以 QDrag::exec 中对 DoDragDrop 的调用立即返回。QApplication 尝试通过在 qt_init 中调用 OleInitialize 来初始化 COM，但失败并出现错误“设置后无法更改线程模式”。

有趣的是，即使 OleInitialize 是在 main 中完成的第一件事，也会发生这种情况，因此线程模式最初是由某些外部依赖项设置的。在 Windows 上运行的应用程序之间的区别之一是失败的应用程序还包含 .NET 代码，所以这可能就是问题所在。

**解决了：**

此问题是 COM/CLR 互操作问题。CLR 在初始化时将单元状态设置为 MTA，然后当 Qt 尝试初始化 COM 时失败。[Adam Nathan](http://blogs.msdn.com/adam_nathan/default.aspx)在[Gotcha 中使用 STAThreadAttribute 和 Managed C++](http://blogs.msdn.com/adam_nathan/archive/2003/07/18/56727.aspx)讨论了这个问题和一个旧的解决方案。*在 Visual Studio 2005 中，您可以在Configuration Properties > Linker > Advanced*中设置/CLRTHREADATTRIBUTE:STA 编译器选项，将线程属性设置为 STA，而无需创建新的入口点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T12:24:37.723

I have no idea what can cause this, but I would try to find out by subclassing QDrag, overwrite deleteLater() (well, reimplement it, but as it's a slot, it will get called anyway), use this instead of a QDrag and put a breakpoint in deleteLater().

# lisp - Lisp 灵活性的实际例子？

> ID：106058
> 
> 赞同：71
> 
> 时间：2008-09-19T22:10:32.923
> 
> 标签：lisp, homoiconicity

有人试图向我推销 Lisp，作为一种超级强大的语言，它可以做任何事情，然后是一些。

是否有Lisp 强大功能的*实际代码示例？*
（最好与以常规语言编码的等效逻辑一起使用。）

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-20T07:44:53.590

I like macros.

Here's code to stuff away attributes for people from LDAP. I just happened to have that code lying around and fiigured it'd be useful for others.

Some people are confused over a supposed runtime penalty of macros, so I've added an attempt at clarifying things at the end.

# In The Beginning, There Was Duplication

```
(defun ldap-users ()
  (let ((people (make-hash-table :test 'equal)))
    (ldap:dosearch (ent (ldap:search *ldap* "(&(telephonenumber=*) (cn=*))"))
                   (let ((mail  (car (ldap:attr-value ent 'mail)))
                         (uid   (car (ldap:attr-value ent 'uid)))
                         (name  (car (ldap:attr-value ent 'cn)))
                         (phonenumber (car (ldap:attr-value ent 'telephonenumber))))
                      (setf (gethash uid people)
                            (list mail name phonenumber))))
    people)) 
```

You can think of a "let binding" as a local variable, that disappears outside the LET form. Notice the form of the bindings -- they are very similar, differing only in the attribute of the LDAP entity and the name ("local variable") to bind the value to. Useful, but a bit verbose and contains duplication.

# On the Quest for Beauty

Now, wouldn't it be nice if we didn't have to have all that duplication? A common idiom is is WITH-... macros, that binds values based on an expression that you can grab the values from. Let's introduce our own macro that works like that, WITH-LDAP-ATTRS, and replace it in our original code.

```
(defun ldap-users ()
  (let ((people (make-hash-table :test 'equal))) ; equal so strings compare equal!
    (ldap:dosearch (ent (ldap:search *ldap* "(&(telephonenumber=*) (cn=*))"))
                   (with-ldap-attrs (mail uid name phonenumber) ent
                       (setf (gethash uid people)
                             (list mail name phonenumber))))
    people)) 
```

Did you see how a bunch of lines suddenly disappeared, and was replaced with just one single line? How to do this? Using macros, of course -- code that writes code! Macros in Lisp is a totally different animal than the ones you can find in C/C++ through the use of the pre-processor: here, you can run *real* Lisp code (not the `#define` fluff in cpp) that generates Lisp code, before the other code is compiled. Macros can use any real Lisp code, i.e., ordinary functions. Essentially no limits.

# Getting Rid of Ugly

So, let's see how this was done. To replace one attribute, we define a function.

```
(defun ldap-attr (entity attr)
  `(,attr (car (ldap:attr-value ,entity ',attr)))) 
```

The backquote syntax looks a bit hairy, but what it does is easy. When you call LDAP-ATTRS, it'll spit out a list that contains the *value* of `attr` (that's the comma), followed by `car` ("first element in the list" (cons pair, actually), and there is in fact a function called `first` you can use, too), which receives the first value in the list returned by `ldap:attr-value`. Because this isn't code we want to run when we compile the code (getting the attribute values is what we want to do when we *run* the program), we don't add a comma before the call.

Anyway. Moving along, to the rest of the macro.

```
(defmacro with-ldap-attrs (attrs ent &rest body)
  `(let ,(loop for attr in attrs
         collecting `,(ldap-attr ent attr))
     ,@body)) 
```

The `,@`-syntax is to put the contents of a list somewhere, instead of the actual list.

# Result

You can easily verify that this will give you the right thing. Macros are often written this way: you start off with code you want to make simpler (the output), what you want to write instead (the input), and then you start molding the macro until your input gives the correct output. The function `macroexpand-1` will tell you if your macro is correct:

```
(macroexpand-1 '(with-ldap-attrs (mail phonenumber) ent
                  (format t "~a with ~a" mail phonenumber))) 
```

evaluates to

```
(let ((mail (car (trivial-ldap:attr-value ent 'mail)))
      (phonenumber (car (trivial-ldap:attr-value ent 'phonenumber))))
  (format t "~a with ~a" mail phonenumber)) 
```

If you compare the LET-bindings of the expanded macro with the code in the beginning, you'll find that it is in the same form!

# Compile-time vs Runtime: Macros vs Functions

A macro is code that is run at *compile-time*, with the added twist that they can call any *ordinary* function or macro as they please! It's not much more than a fancy filter, taking some arguments, applying some transformations and then feeding the compiler the resulting s-exps.

Basically, it lets you write your code in verbs that can be found in the problem domain, instead of low-level primitives from the language! As a silly example, consider the following (if `when` wasn't already a built-in)::

```
(defmacro my-when (test &rest body)
  `(if ,test 
     (progn ,@body))) 
```

`if` is a built-in primitive that will only let you execute *one* form in the branches, and if you want to have more than one, well, you need to use `progn`::

```
;; one form
(if (numberp 1)
  (print "yay, a number"))

;; two forms
(if (numberp 1)
  (progn
    (assert-world-is-sane t)
    (print "phew!")))) 
```

With our new friend, `my-when`, we could both a) use the more appropriate verb if we don't have a false branch, and b) add an implicit sequencing operator, i.e. `progn`::

```
(my-when (numberp 1)
  (assert-world-is-sane t)
  (print "phew!")) 
```

The compiled code will never contain `my-when`, though, because in the first pass, all macros are expanded so there is *no runtime penalty* involved!

```
Lisp> (macroexpand-1 '(my-when (numberp 1)
                        (print "yay!")))

(if (numberp 1)
  (progn (print "yay!"))) 
```

Note that `macroexpand-1` only does one level of expansions; it's possible (most likely, in fact!) that the expansion continues further down. However, eventually you'll hit the compiler-specific implementation details which are often not very interesting. But continuing expanding the result will eventually either get you more details, or just your input s-exp back.

Hope that clarifies things. Macros is a powerful tool, and one of the features in Lisp I like.

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-19T22:16:07.077

我能想到的最好的例子是 Paul Graham 的书[On Lisp](http://www.paulgraham.com/onlisp.html)。可以从我刚刚提供的链接下载完整的 PDF。您还可以尝试[Practical Common Lisp](http://gigamonkeys.com/book/)（也可以在网络上完全获得）。

我有很多不切实际的例子。我曾经用大约 40 行 lisp 编写了一个程序，它可以解析自己，将其源视为 lisp 列表，对列表进行树遍历并构建一个表达式，如果 waldo 标识符存在于源中或计算为如果 waldo 不在场，则为零。返回的表达式是通过将对 car/cdr 的调用添加到已解析的原始源来构造的。我不知道如何用 40 行代码用其他语言做到这一点。也许 perl 可以用更少的代码来完成。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-19T22:40:03.027

您可能会发现这篇文章很有帮助： http: [//www.defmacro.org/ramblings/lisp.html](http://www.defmacro.org/ramblings/lisp.html)

也就是说，很难给出关于 Lisp 强大功能的简短实用示例，因为它真的只在不平凡的代码中闪耀。当您的项目发展到一定规模时，您将欣赏 Lisp 的抽象工具并为您一直在使用它们而感到高兴。另一方面，相当短的代码示例永远不会让您满意地展示 Lisp 的出色之处，因为其他语言的预定义缩写在小示例中看起来比 Lisp 在管理特定领域抽象方面的灵活性更具吸引力。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-23T03:22:29.857

Lisp 中有很多杀手级功能，但宏是我特别喜欢的功能，因为在语言定义的内容和我定义的内容之间不再存在真正的障碍。例如，Common Lisp 没有**while**构造。我曾经在我的脑海中实现它，同时走路。它简单明了：

```
(defmacro while (condition &body body)
  `(if ,condition
       (progn
         ,@body
         (do nil ((not ,condition))
           ,@body)))) 
```

瞧！您刚刚使用新的基本结构扩展了 Common Lisp 语言。您现在可以执行以下操作：

```
(let ((foo 5))
  (while (not (zerop (decf foo)))
    (format t "still not zero: ~a~%" foo))) 
```

哪个会打印：

```
still not zero: 4
still not zero: 3
still not zero: 2
still not zero: 1 
```

在任何非 Lisp 语言中这样做都留给读者作为练习......

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-20T12:55:55.307

我喜欢[Common Lisp 对象系统](https://en.wikipedia.org/wiki/Common_Lisp_Object_System)(CLOS) 和多方法。

大多数（如果不是全部）面向对象的编程语言都具有类和方法的基本概念。[Python](http://en.wikipedia.org/wiki/Python_%28programming_language%29)中的以下代码段定义了 PeelingTool 和蔬菜类（类似于访问者模式）：

```
class PeelingTool:
    """I'm used to peel things. Mostly fruit, but anything peelable goes."""
    def peel(self, veggie):
        veggie.get_peeled(self)

class Veggie:
    """I'm a defenseless Veggie. I obey the get_peeled protocol
    used by the PeelingTool"""
    def get_peeled(self, tool):
        pass

class FingerTool(PeelingTool):
  ...

class KnifeTool(PeelingTool):
  ...

class Banana(Veggie):
    def get_peeled(self, tool):
        if type(tool) == FingerTool:
            self.hold_and_peel(tool)
        elif type(tool) == KnifeTool:
            self.cut_in_half(tool) 
```

您将`peel`方法放入 PeelingTool 并让 Banana 接受它。但是，它必须属于 PeelingTool 类，因此只有在您拥有 PeelingTool 类的实例时才能使用它。

Common Lisp 对象系统版本：

```
(defclass peeling-tool () ())
(defclass knife-tool (peeling-tool) ())
(defclass finger-tool (peeling-tool) ())

(defclass veggie () ())
(defclass banana (veggie) ())

(defgeneric peel (veggie tool)
  (:documentation "I peel veggies, or actually anything that wants to be peeled"))

;; It might be possible to peel any object using any tool,
;; but I have no idea how. Left as an exercise for the reader
(defmethod peel (veggie tool)
   ...)

;; Bananas are easy to peel with our fingers!
(defmethod peel ((veggie banana) (tool finger-tool))
  (with-hands (left-hand right-hand) *me*
    (hold-object left-hand banana)
    (peel-with-fingers right-hand tool banana)))

;; Slightly different using a knife
(defmethod peel ((veggie banana) (tool knife-tool))
  (with-hands (left-hand right-hand) *me*
    (hold-object left-hand banana)
    (cut-in-half tool banana))) 
```

任何东西都可以用图灵完备的任何语言编写；语言之间的区别在于您必须跳过多少圈才能获得等效的结果。

像[Common Lisp](https://en.wikipedia.org/wiki/Common_Lisp)这样功能强大的语言，具有宏和 CLOS 等功能，可以让您快速轻松地获得结果，而无需跳过太多的障碍，以至于您要么满足于低于标准的解决方案，要么发现自己变成了一只袋鼠。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-19T23:40:21.150

实际上，一个很好的实际例子是 Lisp LOOP 宏。

[http://www.ai.sri.com/pkarp/loop.html](http://www.ai.sri.com/pkarp/loop.html)

LOOP 宏就是——一个 Lisp 宏。然而，它基本上定义了一个迷你循环 DSL（领域特定语言）。

当您浏览那个小教程时，您会发现（即使是新手）很难知道代码的哪一部分是 Loop 宏的一部分，哪一部分是“正常”的 Lisp。

这是 Lisps 表现力的关键组成部分之一，新代码确实无法与系统区分开来。

例如，在 Java 中，您可能无法（一目了然）知道程序的哪一部分来自标准 Java 库而不是您自己的代码，甚至是第三方库，但您确实知道代码的哪一部分是 Java 语言，而不是简单地对类进行方法调用。诚然，这都是“Java 语言”，但作为程序员，您仅限于将您的应用程序表达为类和方法的组合（现在是注释）。而在 Lisp 中，从字面上看，一切都可以争夺。

考虑将 Common Lisp 连接到 SQL 的 Common SQL 接口。在这里，[http://clsql.b9.com/manual/loop-tuples.html](http://clsql.b9.com/manual/loop-tuples.html)，它们展示了如何扩展 CL 循环宏以使 SQL 绑定成为“一等公民”。

您还可以观察诸如“[select [first-name] [last-name] :from [employee] :order-by [last-name]]”之类的结构。这是 CL-SQL 包的一部分，并作为“阅读器宏”实现。

看，在 Lisp 中，你不仅可以创建宏来创建新的结构，如数据结构、控制结构等。你甚至可以通过阅读器宏来更改语言的语法。在这里，他们使用读取器宏（在本例中为“[”符号）进入 SQL 模式，以使 SQL 像嵌入式 SQL 一样工作，而不是像许多其他语言那样仅作为原始字符串。

作为应用程序开发人员，我们的任务是将我们的流程和构造转换为处理器可以理解的形式。这意味着我们不可避免地不得不与计算机语言“交谈”，因为它“不理解”我们。

Common Lisp 是少数几个不仅可以自上而下构建应用程序的环境之一，而且我们可以提升语言和环境以适应我们的中途。我们可以在两端编码。

请注意，尽管如此优雅，但它不是灵丹妙药。显然还有其他因素会影响语言和环境的选择。但这当然值得学习和玩耍。我认为学习 Lisp 是提高编程水平的好方法，即使是其他语言也是如此。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-10-13T12:36:48.267

我发现这篇文章很有趣：

[编程语言比较：Lisp 与 C++](https://web.archive.org/web/20120419015920/http://www.antigreen.org/vadim/ProgLanguageComparison/lisp-cmp-with-cpp-java-etc/C++-vs-Lisp.html)

这篇文章的作者 Brandon Corfman 写了一篇关于将 Java、C++ 和 Lisp 的解决方案与一个编程问题进行比较的研究，然后用 C++ 编写了他自己的解决方案。基准解决方案是 Peter Norvig 的 45 行 Lisp（用 2 小时编写）。

Corfman 发现很难将他的解决方案减少到少于 142 行 C++/STL。他对原因的分析，读起来很有趣。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-20T13:07:45.297

我最喜欢 Lisp（和[Smalltalk](http://en.wikipedia.org/wiki/Smalltalk)）系统的地方在于，它们给人一种充满活力的感觉。您可以在 Lisp 系统运行时轻松探测和修改它们。

如果这听起来很神秘，请启动[Emacs](http://en.wikipedia.org/wiki/Emacs)并输入一些 Lisp 代码。输入`C-M-x`和瞧！您刚刚从 Emacs 中更改了 Emacs。您可以在 Emacs 运行时继续并重新定义所有 Emacs 函数。

另一件事是代码=列表等价性使代码和数据之间的边界非常薄。[多亏了宏，扩展语言和制作快速DSL](http://en.wikipedia.org/wiki/Domain-specific_language)非常容易。

例如，可以编写一个基本的 HTML 构建器，使用它的代码非常接近生成的 HTML 输出：

```
(html
  (head
    (title "The Title"))
  (body
    (h1 "The Headline" :class "headline")
    (p "Some text here" :id "content"))) 
```

=>

```
<html>
  <head>
    <title>The title</title>
  </head>
  <body>
    <h1 class="headline">The Headline</h1>
    <p id="contents">Some text here</p>
  </body>
</html> 
```

在 Lisp 代码中，自动缩进使代码看起来像输出，除了没有任何结束标记。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-01-14T14:28:01.830

我喜欢的一件事是我可以“运行时”升级代码而不会丢失应用程序状态。这只是在某些情况下有用的东西，但是当它有用时，已经存在它（或者，在开发过程中只需最低成本）比必须从头开始实现它便宜得多。尤其是因为这是以“没有甚至几乎没有”的代价。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-20T19:44:04.983

了解如何**使用 XML 模板扩展 Common Lisp**：[cl-quasi-quote XML 示例](http://common-lisp.net/project/cl-quasi-quote/present-class.html)、[项目页面](http://common-lisp.net/project/cl-quasi-quote/)、

```
(babel:octets-to-string
 (with-output-to-sequence (*html-stream*)
   <div (constantAttribute 42
         someJavaScript `js-inline(print (+ 40 2))
         runtimeAttribute ,(concatenate 'string "&foo" "&bar"))
     <someRandomElement
       <someOther>>>))

 =>

 "<div constantAttribute=\"42\"
       someJavaScript=\"javascript: print((40 + 2))\"
       runtimeAttribute=\"&amp;foo&amp;bar\">
    <someRandomElement>
      <someOther/>
    </someRandomElement>
  </div>" 
```

这与 Lisp 的反引号阅读器（用于列表准引用）基本相同，但它也适用于各种其他内容，例如 XML（安装在特殊的 <> 语法上）、JavaScript（安装在 `js-inline 上）等.

为了清楚起见，这是在**用户库**中实现的！它将静态 XML、JavaScript 等部分编译成[UTF-8](http://en.wikipedia.org/wiki/UTF-8)编码的文字字节数组，准备好写入网络流。使用一个简单的`,`（逗号），您可以返回到 lisp 并将运行时生成的数据交错到文字字节数组中。

这不适合胆小的人，但这就是库将上述内容编译成的内容：

```
(progn
 (write-sequence
  #(60 100 105 118 32 99 111 110 115 116 97 110 116 65 116 116 114 105 98
    117 116 101 61 34 52 50 34 32 115 111 109 101 74 97 118 97 83 99 114
    105 112 116 61 34 106 97 118 97 115 99 114 105 112 116 58 32 112 114
    105 110 116 40 40 52 48 32 43 32 50 41 41 34 32 114 117 110 116 105
    109 101 65 116 116 114 105 98 117 116 101 61 34)
  *html-stream*)
 (write-quasi-quoted-binary
  (let ((*transformation*
          #<quasi-quoted-string-to-quasi-quoted-binary {1006321441}>))
    (transform-quasi-quoted-string-to-quasi-quoted-binary
      (let ((*transformation*
               #<quasi-quoted-xml-to-quasi-quoted-string {1006326E51}>))
        (locally
            (declare (sb-ext:muffle-conditions sb-ext:compiler-note))
         (let ((it (concatenate 'string "runtime calculated: " "&foo" "&bar")))
           (if it
               (transform-quasi-quoted-xml-to-quasi-quoted-string/attribute-value it)
               nil))))))
  *html-stream*)
 (write-sequence
  #(34 62 10 32 32 60 115 111 109 101 82 97 110 100 111 109 69 108 101 109
    101 110 116 62 10 32 32 32 32 60 115 111 109 101 79 116 104 101 114 47
    62 10 32 32 60 47 115 111 109 101 82 97 110 100 111 109 69 108 101 109
    101 110 116 62 10 60 47 100 105 118 62 10)
  *html-stream*)
 +void+) 
```

作为参考，上面的两个大字节向量在转换为字符串时是这样的：

```
"<div constantAttribute=\"42\"
      someJavaScript=\"javascript: print((40 + 2))\"
      runtimeAttribute=\"" 
```

第二个：

```
"\">
 <someRandomElement>
    <someOther/>
  </someRandomElement>
</div>" 
```

它与其他 Lisp 结构（如宏和函数）很好地结合在一起。现在，将其与[JSP](http://en.wikipedia.org/wiki/JavaServer_Pages)进行比较...

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-08-22T09:46:53.403

[我喜欢这个来自http://common-lisp.net/cgi-bin/viewcvs.cgi/cl-selenium/?root=cl-selenium](http://common-lisp.net/cgi-bin/viewcvs.cgi/cl-selenium/?root=cl-selenium)的宏示例 这是一个绑定到 Selenium（一个 Web 浏览器测试框架）的 Common Lisp，但是它不是映射每个方法，而是在编译时读取 Selenium 自己的 API 定义 XML 文档并使用宏生成映射代码。您可以在此处查看生成的 API：common-lisp.net/project/cl-selenium/api/selenium-package/index.html

这实质上是使用外部数据驱动宏，在这种情况下恰好是 XML 文档，但可能与从数据库或网络读取一样复杂。这就是在编译时为您提供整个 Lisp 环境的强大功能。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-05-01T13:34:46.067

1970 年代，我是麻省理工学院的一名 AI 学生。和其他学生一样，我认为语言是最重要的。尽管如此，Lisp 是主要的语言。这些是我仍然认为它非常适合的一些事情：

*   符号数学。编写表达式的符号微分和代数化简既简单又有益。我仍然做那些，即使我在 C 中做它们。

*   定理证明。我时不时地进行一次临时的 AI 狂欢，比如试图证明插入排序是正确的。为此，我需要进行符号操作，而且我通常会使用 Lisp。

*   小的领域特定语言。我知道 Lisp 不是*很*实用，但是如果我想尝试一点[DSL](http://en.wikipedia.org/wiki/Domain-specific_language)而不必完全陷入解析等问题，Lisp 宏会让它变得简单。

*   像极小极大博弈树搜索这样的小游戏算法可以用三行来完成。

*   想尝试[lambda 演算](https://en.wikipedia.org/wiki/Lambda_calculus)吗？在 Lisp 中很容易。

Lisp 为我做的主要是脑力锻炼。然后我可以把它带到更实用的语言中。

PS 说到 lambda 演算，同样始于 1970 年代，在同一个 AI 领域，OO 开始侵入每个人的大脑，不知何故，对它的兴趣*似乎*挤掉了对它的*好处的*兴趣。即机器学习、自然语言、视觉、问题解决方面的工作，所有的工作都放在了房间的后面，而课程、消息、类型、多态性等都放在了前面。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-19T22:14:27.143

你有没有看过[这个](https://web.archive.org/web/20170702100142/http://www.weitz.de/macros.lisp)解释为什么宏是强大和灵活的？抱歉，没有其他语言的示例，但它可能会向您推销宏。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-09-19T22:50:09.477

@标记，

虽然你所说的有些道理，但我相信它并不总是那么直截了当。

程序员和一般人并不总是花时间评估所有可能性并决定切换语言。通常是经理决定，或者是教授第一门语言的学校……而程序员永远不需要投入足够的时间来达到一定的水平，如果他们可以决定这种语言比那种语言节省了我更多的时间。

另外，您必须承认，与没有此类支持的语言相比，有微软或 Sun 等大型商业实体支持的语言在市场上总是具有优势。

为了回答最初的问题，保罗格雷厄姆试图在[这里](http://www.paulgraham.com/accgen.html)举一个例子，尽管我承认它不一定像我想的那样*实用:-)*

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-06-01T20:51:23.100

让我印象深刻的一件事是编写自己的面向对象编程扩展的能力，如果你碰巧不喜欢包含的 CLOS。

其中之一是在[Garnet](http://garnetlisp.sourceforge.net/)中，一个在 Paul Graham 的[*On Lisp*](http://www.paulgraham.com/onlisp.html)中。

还有一个名为[Screamer](http://clocc.sourceforge.net/clocc/src/screamer/README)的包允许非确定性编程（我没有评估过）。

任何允许您更改它以支持不同编程范例的语言都必​​须是灵活的。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-19T23:13:54.223

You might find [this post](http://www.lispcast.com/drupal/node/42) by Eric Normand helpful. He describes how as a codebase grows, Lisp helps by letting you build the language up to your application. While this often takes extra effort early on, it gives you a big advantage later.

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-03-01T19:41:52.653

它是一种多范式语言这一简单事实使其非常灵活。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-09-19T22:37:10.800

John Ousterhout 在 1994 年对 Lisp 做了一个有趣的观察：

> 语言设计者喜欢争论为什么这种语言或那种语言 **必须**先验地更好或更差，但这些争论都不是很重要。最终，当用户用脚投票时，所有语言问题都会得到解决。
> 
> ***如果 [一种语言] 使人们更有效率，那么他们就会使用它；当出现其他更好的语言时（或者如果它已经在这里），那么人们就会切换到那种语言。这就是律法，很好。法律对我说，Scheme（或任何其他 Lisp 方言）可能不是“正确”的语言：在过去的 30 年中，有太多人用脚投票。***

[http://www.vanderburg.org/OldPages/Tcl/war/0009.html](http://www.vanderburg.org/OldPages/Tcl/war/0009.html)

# java - 正则表达式仅用一个替换两个（或多个）连续字符？

> ID：106067
> 
> 赞同：22
> 
> 时间：2008-09-19T22:12:56.630
> 
> 标签：java, regex

在java中，哪些正则表达式可以用来代替这些，例如：

之前：aaabbb 之后：ab

之前：14442345 之后：142345

谢谢！

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-19T22:17:24.890

在 perl 中

```
s/(.)\1+/$1/g; 
```

有诀窍吗，我假设如果 java 有 perl 兼容的正则表达式它也应该工作。

编辑：这就是它的意思

```
s {
    (.)  # match any charater ( and capture it )
    \1   # if it is followed by itself 
    +    # One or more times
}{$1}gx;  # And replace the whole things by the first captured character (with g modifier to replace all occurences) 
```

编辑：正如其他人指出的那样，Java 中的语法将变为

```
original.replaceAll("(.)\\1+", "$1"); 
```

记得避开 \1

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-19T22:20:34.210

```
String a = "aaabbb";
String b = a.replaceAll("(.)\\1+", "$1");
System.out.println("'" + a + "' -> '" + b + "'"); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T22:20:46.753

```
"14442345".replaceAll("(.)\\1+", "$1"); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-19T22:20:47.783

```
originalString.replaceAll( "(.)\\1+", "$1" ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T22:30:51.270

**匹配模式**（在必须转义 \ 的 Java/语言中）：

```
(.)\\1+ 
```

或（在您可以使用不将 \ 视为转义字符的字符串的语言中）

```
(.)\1+ 
```

**替换**：

```
$1 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T22:30:29.490

在 TextEdit（假设 posix 表达式）中找到：[a]+[b]+ 替换为：ab

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-21T19:22:17.307

在 Perl 中：

```
tr/a-z0-9//s; 
```

例子：

```
$ perl -E'@a = (aaabbb, 14442345); for(@a) { tr/a-z0-9//s; say }'
ab
142345 
```

如果 Java 没有`tr`类比，那么：

```
s/(.)\1+/$1/sg; 
#NOTE: `s` modifier. It takes into account consecutive newlines. 
```

例子：

```
$ perl -E'@a = (aaabbb, 14442345); for(@a) { s/(.)\1+/$1/sg; say }'
ab
142345 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-07-02T11:26:39.200

Java 7 加糖：命名组

```
static String cleanDuplicates(@NonNull final String val) { 
      assert val != null;
      return val.replaceAll("(?<dup>.)\\k<dup>+","${dup}");
} 
```

# c# - 如何仅在代码中创建 AxHost [C#]

> ID：106081
> 
> 赞同：2
> 
> 时间：2008-09-19T22:15:29.497
> 
> 标签：c#, activex, ocx

我正在使用 COM Wrapper 与 Windows Media Player 进行交互。

它使用 AxHost 以某种方式包裹播放器，对我来说这只是引擎盖下的魔法^^

AxHost.AttachInterfaces 看起来像这样

```
 protected override void AttachInterfaces() 
    {
        try 
        {   
            //Get the IOleObject for Windows Media Player.
            IOleObject oleObject = this.GetOcx() as IOleObject;

            //Set the Client Site for the WMP control.
            oleObject.SetClientSite(this as IOleClientSite);

            Player = this.GetOcx() as WMPLib.WindowsMediaPlayer; 
... 
```

只要我将此 AxHost 托管在 Windows 窗体控件中，一切正常。但我无法在构造函数中连接事件。

例如，这不起作用：

```
 public WMPMediaRating()
    {
        var remote = new WMPRemote.RemotedWindowsMediaPlayer();
        _WMP = remote.Player;

        _WMP.MediaChange += new _WMPOCXEvents_MediaChangeEventHandler(_WMP_MediaChange);
    } 
```

remote.Player 始终为 null，并且程序因 NullReferencesException 而崩溃。

AttachInterfaces() 中的代码以某种方式仅在窗体绘制后或其他所有操作完成后才执行。

我尝试手动调用 AttachInterfaces()，但这也不起作用，因为 GetOcx() 什么也不返回。

* * *

那么如何在没有 Windows 窗体的情况下实例化我的 AxHost 继承控件，以便在控制台应用程序中使用它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T01:02:19.687

仅供参考：没有人阻止您在控制台应用程序中使用隐藏窗口。

您将无法在非 Windows 应用程序中托管媒体播放器 - 它需要托管。如果你想播放一些音乐，你可以使用媒体图表来创建一个渲染（播放）你的音乐文件的图表——它不需要任何额外的托管。

# user-interface - 在 MATLAB 中，类方法可以充当 uicontrol 回调而不是公开的吗？

> ID：106086
> 
> 赞同：7
> 
> 时间：2008-09-19T22:16:02.910
> 
> 标签：user-interface, matlab, callback, oop, access-control

在 MATLAB 2008a 中，有没有办法允许类方法充当 uicontrol 回调函数，而无需公开该方法？从概念上讲，该方法不应该是公共的，因为它不应该被类的用户调用。它只能在 UI 事件触发回调时调用。但是，如果我将方法的访问权限设置为私有或受保护，则回调不起作用。我的类派生自 hgsetget 并使用 2008a classdef 语法定义。

uicontrol 代码如下所示：

```
 methods (Access = public)
   function this = MyClass(args)
      this.someClassProperty = uicontrol(property1, value1, ... , 'Callback', ...
      {@(src, event)myCallbackMethod(this, src, event)});
      % the rest of the class constructor code
   end
end 
```

回调代码如下所示：

```
 methods (Access = private)  % This doesn't work because it's private
   % It works just fine if I make it public instead, but that's wrong conceptually.
   function myCallbackMethod(this, src, event)
      % do something
   end
end 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-22T08:10:20.297

将回调的函数句柄存储为私有属性似乎可以解决该问题。试试这个：

```
classdef MyClass
    properties
        handle;
    end

    properties (Access=private)
        callback;
    end

    methods
        function this = MyClass(args)
            this.callback = @myCallbackMethod;
            this.handle = uicontrol('Callback', ...
                {@(src, event)myCallbackMethod(this, src, event)});
        end
    end

    methods (Access = private)
        function myCallbackMethod(this, src, event)
            disp('Hello world!');
        end
    end
end 
```

# .net - 错误“控件集合无法...”的含义和修复

> ID：106095
> 
> 赞同：2
> 
> 时间：2008-09-19T22:16:50.023
> 
> 标签：.net, asp.net, javascript

使用 ASP.NET 2.0，我有一个 Web 应用程序，我在其中尝试使用 JavaScript 使选项卡容器中的一个选项卡成为活动选项卡。

这些建议基于：

```
var mX=document.getElementById('<%= tc1.ClientID%>')

$find('<%= tc1.ClientID%>').set_activeTabIndex(1); 
```

两者都会产生错误：

```
The Controls collection cannot be modified because the control contains code blocks (i.e. <% ... %>). 
```

我尝试将代码从 head 标签移到 body 标签中；同样的错误。

我也尝试过替代方法`<%# tc1.ClientID%>`，如：

```
var mX = document.getElementById('<%# tc1.ClientID %>')

mX.ActiveTabIndex="2"; 
```

生成一个空错误 - 上面的代码在 html 中呈现为：

```
var mX = document.getElementById('')

mX.ActiveTabIndex="2"; 
```

谁能用通俗易懂的语言解释这意味着什么以及解决方案是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T20:44:06.987

如果您刚开始使用 ASP.NET MVC，这是对这个模糊错误的修复。我把这个笔记留在这里，以防像我一样的另一个人遇到这个问题，我真的很想拯救那个人，因为这个蹩脚的错误不会浪费他的时间：

更改 <SCRIPT> 标签的位置！！！

很可能您想在 Site.Master 页面上放置一些 javascript，但是当您这样做时，是在包含 jQuery 时在标签下方进行的。不，先生！请在 <head> 和 <body> 中包含带有 javascript 代码的 <script> 标记。祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T23:22:11.067

I've actually run into that before. **Here's an explanation: [http://west-wind.com/WebLog/posts/6148.aspx](http://west-wind.com/WebLog/posts/6148.aspx)**

For example, if your markup looks like:

```
<asp:Panel id="whatever" runat="server">
    <script type="text/javascript">
         var mX=document.getElementById('<%= tc1.ClientID%>');
         //and so on...
    </script>
</asp:Panel> 
```

And if you try to programatically add a control to that Panel it'll fail with the error you're getting.

One solution is to put your Javascript somewhere else in the page. Another way (although a hack) is this:

```
<asp:Panel id="whatever" runat="server">
    <asp:PlaceHolder id="dontCare" runat="server">
        <script type="text/javascript">
             var mX=document.getElementById('<%= tc1.ClientID%>');
             //and so on...
        </script>
    </asp:PlaceHolder>
</asp:Panel> 
```

Now the <%= ... %> part is inside the PlaceHolder, not directly inside the Panel. Adding controls in your C# or VB code to the Panel should now work (although adding controls to the PlaceHolder would fail.)

**EDIT:**
Yeah, I tried using <%# ... %> instead too, but that's only for inside a DataBound control. For example, that would work if it was in the middle of a DataGrid and I called it's DataBind() method this PostBack.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T23:06:33.180

You can't have code blocks mixed with controls, instead store the value in javascript and assign it that way... something like this:

```
<div runat="server" id="rawr">
    <span id="myspan">HI</span>
</div>
</form>

<script type="text/javascript">
    var obj = '<%= DateTime.Now.ToShortDateString() %>';
    var ele = document.getElementById("myspan");
    ele.innerHTML = obj;
</script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T22:29:21.133

看起来和听起来这些代码片段本身并不令人反感，但*其他*一些修改控件集合的代码现在对它们感到不安。您能说出错误实际发生在程序中的哪个位置吗？

顺便说一句，<%# %> 在这里不合适——它只适用于数据绑定控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-24T07:54:44.460

将 javascript 从 head.. 移动并确保在使用 ajaxextenders 时将 scriptmanager 添加到 default.aspx ..

# javascript - 类似于模态窗口的弹出窗口

> ID：106112
> 
> 赞同：2
> 
> 时间：2008-09-19T22:21:33.163
> 
> 标签：javascript, window, modal-dialog

我需要打开一个跨域内容的弹出窗口。在我完成子窗口之前，我不应该允许用户访问或关闭父窗口。

模态窗口的主要问题是停止在主窗口上运行的任何异步进程。例如，计时器和自动刷新不会在父窗口中工作。

有没有什么完美的方法可以做到上面所说的。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T22:40:22.477

不如不弹出一个实际的窗口，而是打开一个伪窗口……那是一个带有一些边框的 div，如果你愿意，可以让它可拖动，然后放置一个覆盖页面其余部分的大半透明 div并阻止它被点击。基本上做一些类似[灯箱](http://www.lokeshdhakar.com/projects/lightbox2/)工作的事情

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T22:55:55.687

You could use a fake window built via javascript. Several widget libraries have support for this. For example, see [ExtJS](http://extjs.com/deploy/dev/examples/#sample-3), which also supports modal windows but it might be overkill for your application. For jQuery, browse through the [plugins](http://plugins.jquery.com/project/Plugins/category/43), like [this one](http://www.ericmmartin.com/simplemodal/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T22:49:49.337

如果您在 ASP.Net 上工作，我认为 Telerik 可以对此进行控制。正如@Davr 建议的那样，在其实现中使用 div 。无论如何，模态窗口是一个糟糕的选择，因为并非所有浏览器都支持它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T23:31:10.530

除了 Davr 和 thorinn 所说的之外，您可能还需要进行 Ajax 调用来获取内容。由于通过浏览器进行的 Ajax 调用强制执行同域策略，因此您需要对 OWN 服务器进行 Ajax 调用，而后者又需要发出 xmlhttp 服务器到服务器请求以获取第三方的内容服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T22:11:51.010

由于以下原因，我觉得上述答案不适合..

JasonS 解决方案 - 该应用程序是基于 J2EE 技术开发的。

其他的解决方案——子窗口中启动的一些URL会通过标准API与父窗口通信。如果我使用 div 或其他内置插件窗口，那么那些 javascript API 将失败。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T22:54:49.427

查看“BlockUI”中的 Jquery 插件。当 BlockUI 被调用时，父窗口是不可访问的。你可以在模态框上做你想做的事，然后调用“UnblockUI”来关闭弹出窗口并再次给予父控制。

皮特

# c++ - GCC - “')'令牌之前的预期不合格ID”

> ID：106117
> 
> 赞同：7
> 
> 时间：2008-09-19T22:23:34.657
> 
> 标签：c++

请多多包涵，我只是在学习 C++。

我正在尝试编写我的头文件（用于类），但遇到了一个奇怪的错误。

```
cards.h:21: error: expected unqualified-id before ')' token
cards.h:22: error: expected `)' before "str"
cards.h:23: error: expected `)' before "r" 
```

“')'令牌之前的预期不合格ID”是什么意思？我做错了什么？

编辑：对不起，我没有发布整个代码。

```
/*
Card header file
[Author]
*/
// NOTE: Lanugage Docs here http://www.cplusplus.com/doc/tutorial/

#define Card
#define Hand
#define AppError

#include <string>

using namespace std;

// TODO: Docs here
class Card { // line 17
    public:
        enum Suit {Club, Diamond, Spade, Heart};
        enum Rank {Two, Three, Four, Five, Six, Seven, Eight, Nine,
                   Ten, Jack, Queen, King, Ace};
        Card(); // line 22
        Card(string str);
        Card(Rank r, Suit s); 
```

编辑：我只是想使用“g++ file.h”自行编译头文件。

编辑：封闭的问题。我的代码现在正在运行。谢谢大家！编辑：阅读[礼仪后重新打开的问题：关闭您的帖子](https://stackoverflow.com/questions/34456/etiquette-closing-your-posts)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-19T22:36:08.620

你的问题是你的`#define`。你做到了`#define Card`，所以现在到处`Card`都被视为一个令牌，它将被替换。

通常 a`#define Token`没有额外的标记，如 in`#define Token Replace`将使用 value `1`。

删除`#define Card`，它使第 22 行读取：`1();`或`();`，这导致了投诉。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T22:25:17.507

（编辑更新的问题）

删除`#define`语句，它们正在破坏文件。您是否尝试实施包含防护？那将是这样的：

```
#ifndef CARD_H
#define CARD_H

class Card ...
...

#endif 
```

* * *

旧答案：

这意味着`string`在当前行中没有定义。试试`std::string`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T10:40:18.300

只是我的两分钱，但我猜你使用了预编译的头文件

```
#define Card
#define Hand
#define AppError 
```

就好像你想告诉编译器“嘿，Card、Hand 和 AppError 类是在别处定义的”（即前向声明）。

即使由于您的代码无法编译的确切原因（正如 John Millikin 所说，修改您的文件），我们忽略了宏是一个痛苦的事实，也许您想要编写的内容类似于：

```
class Card ;
class Hand ;
class AppError ; 
```

这是这些类的*前向声明*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T22:25:13.857

删除**#define 卡**。

# rdf - 支持 A-Box 本体数据翻译的工具

> ID：106134
> 
> 赞同：0
> 
> 时间：2008-09-19T22:27:13.023
> 
> 标签：rdf, semantic-web, owl, ontology

有谁知道任何能够定义从一个本体到另一个本体的 T-Box 结构的声明性映射的工具，当执行时可以影响 A-Box 实例数据从一个本体的形式到另一个本体的转换？

我最近编写了这样一个工具来满足我的需求，但我想知道我是否重新发明了轮子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-21T03:44:48.307

据我所知，没有这样的工具。通常，您只需将 tbox 和 abox 定义从一个本体复制到另一个本体，然后编写一个转换工具。

我认为这是我在这个网站上看到的第一个本体问题。我希望更多的人使用这个标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T22:40:35.547

我使用了 SPARQL CONSTRUCT 查询，我在其中查询一个模型并使用来自不同命名空间的属性构造新语句。我保存这些，然后将它们加载到目标模型中。我发现这很灵活，但有很多地方我想对文字进行额外处理。

我也想使用 SWRL 规则。

# css - 你把你的 CSS 边距放在哪里？

> ID：106137
> 
> 赞同：17
> 
> 时间：2008-09-19T22:28:15.737
> 
> 标签：css, margin

当您想在 HTML 元素之间添加空格（使用 CSS）时，您会将其附加到哪个元素？

我经常处于以下情况：

```
<body>
  <h1>This is the heading</h1>
  <p>This is a paragraph</p>
  <h1>Here's another heading</h1>
  <div>This is a footer</div>
</body> 
```

现在，假设我希望每个元素之间有 1em 的空间，但没有高于第一个 h1 或低于最后一个 div。我会将它附加到哪些元素上？

显然，这之间没有真正的**技术**区别：

```
h1, p { margin-bottom: 1em; } 
```

...还有这个...

```
div { margin-top: 1em; }
p { margin-top: 1em; margin-bottom: 1em } 
```

我感兴趣的是次要因素：

1.  一致性
2.  适用于所有情况
3.  轻松/简单
4.  易于进行更改

例如：在这种特殊情况下，我会说第一种解决方案比第二种解决方案更好，因为它更简单；您只是在单个属性定义中将 margin-bottom 附加到两个元素。但是，我正在寻找更通用的解决方案。每次我做 CSS 工作时，我都会觉得有一个很好的经验法则可以应用……但我不确定它是什么。有人有好的论据吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-19T22:32:55.740

当我希望元素在下一个元素之前有空间时，我倾向于在元素上使用底部边距，然后在 css 中使用“.last”类来删除最后一个元素的边距。

```
<body>
  <h1>This is the heading</h1>
  <p>This is a paragraph</p>
  <h1>Here's another heading</h1>
  <div class="last">This is a footer</div>
</body> 
```

```
div { margin-bottom: 1em; }
p { margin-bottom: 1em; }
h1 { margin-bottom: 1em; }
.last {margin-bottom: 0; } 
```

不过，在您的示例中，这可能并不*适用*，因为页脚 div 很可能有它自己的类和特定的样式。当我有几个相同的元素一个接一个（段落和其他）时，我使用的“.last”方法仍然适用于我。当然，我是从“Elements”CSS 框架中挑选出的技术。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-21T17:44:15.123

使用高级 CSS 2 选择器，另一种不依赖类`last`将布局信息引入 HTML 的解决方案是可能的。

该解决方案使用[相邻的选择器](http://www.w3.org/TR/CSS2/selector.html#adjacent-selectors)。不幸的是，MSIE 6 还不支持它，所以不愿意使用它是可以理解的。

```
h1 {
    margin: 0 0 1em;
}

div, p, p + h1, div + h1 {
    margin: 1em 0 0;
} 
```

这样，第一个`h1`不会有上边距，而`h1`紧跟在段落或框之后的任何东西*都有*上边距。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T23:03:56.960

如果您想在元素周围留出一些空间，请给它一个边距。这意味着，在这种情况下，不要只给出`<h1>`下边距，而是给出`<p>`上边距。

请记住，当两个元素垂直相邻并且它们之间没有边框或填充时，它们的边距会折叠。这意味着只考虑两个边距中较大的一个 - 它们不会加在一起。所以这：

```
h1, p { margin: 1em; }

<h1>...</h1>
<p>...</p> 
```

...会导致标题和段落之间有 1em 的空间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T22:34:59.417

这将部分由您设计的具体内容驱动，但在典型的博客索引中，这些东西有一种粗略的层次结构：

*   您将在页面上有一个页脚。
*   每个*条目*将有一个标题。
*   每个条目将有 n 个段落。

为你的段落建立空白，知道它们有时会按顺序出现——你需要担心它们看起来像一个系列。从那里，调整您的标题以处理条目之间的边界。最后，调整页脚/正文间距以确保页面底部看起来不错。

这是一个缩略图。最终如何分配填充完全取决于您，但如果您从自下而上的角度处理它，您可能会看到更少的惊喜，因为您*首先*调整最常见/丰富的元素，然后*再*调整不太常见的元素。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-21T05:35:17.700

吉姆提出的观点是关键。元素之间的边距塌陷，它们不是相加的。如果您想要确保段落和标题上方和下方有 1em 的边距，并且页眉下方和页脚上方有 1em 的边距，那么您的 css 应该反映这一点。

给定这个标记（我添加了一个页眉并在页眉/页脚上放置了 id）：

```
<body>
  <div id="header"></div>
  <h1>This is the heading</h1>
  <p>This is a paragraph</p>
  <h1>Here's another heading</h1>
  <div id="footer">This is a footer</div>
</body> 
```

你应该使用这个CSS：

```
#header {
  margin-bottom: 1em;
}

#footer {
  margin-top: 1em;
}

h1, p {
  margin: 1em 0;
} 
```

现在元素的顺序无关紧要。如果您使用两个连续的标题，或者以段落而不是标题开始页面，它仍将呈现您缩进的方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-25T10:12:24.450

我是一个相对新手，但我自己的解决方案是我认为您和我都遇到的问题（更改一个标签的边距可能会整理网站某个部分的间距，只会扰乱其他地方以前良好的间距？）现在为所有标签分配相等的边距顶部和底部。与 H3 或 ap 相比，您可能希望 H1 上方和下方有更多空间，但总的来说，我认为页面看起来不错，任何给定文本的上方和下方都有相等的空间，所以这个解决方案对我很有效，并且符合您的“简单希望也有经验法则的规格！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-14T21:05:18.463

应该这样做：

```
body > * {
    margin-bottom: 1em;
}
body > *:last-child {
    margin-bottom: 0;
} 
```

现在您不必担心什么元素是第一个，什么元素是最后一个，并且您不必总是在最后一个元素上放置一个特殊的类。

这不会“工作”的唯一一次是当最后一个孩子是未渲染的孩子时。在这种情况下，您可能会考虑`margin-bottom:0;`在您最后一个可见的孩子上使用一个类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T22:33:21.060

我倾向于同意你的观点，第一个选择更好。这通常是我喜欢做的事情。但是，有一个论点是，您应该为这些元素中的每一个指定一个边距，如果您不想应用它，则将其归零，因为浏览器处理边距的方式都不同。如果没有指定， <p> （我认为也是 <h1> 标签）通常会有浏览器给出的默认边距。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-11-27T10:13:35.827

我刚刚使用了第一个孩子和最后一个孩子。例如，在纯 CSS 中：

```
h1{
    margin-top:10px;
    margin-bottom:10px;
}
h1:first-child{
    margin-top:0px;
}
p{
    margin:10px;
}
p:first-child{
    margin-top:0px;
}
p:last-child{
    margin-bottom:0px;
} 
```

这是一个基本示例，但您可以将其应用于更多元素，如果使用 SASS、LESS 等，结构会更好:)

# vb.net - ClickOnce Online-Only 应用程序作为 TS RemoteApp

> ID：106164
> 
> 赞同：3
> 
> 时间：2008-09-19T22:34:47.467
> 
> 标签：vb.net, clickonce, remoteapp

我已经尝试了几乎所有方法来让我们的 ClickOnce VB.NET 应用程序在终端服务下作为 RemoteApp 运行。我有一个运行应用程序的 .application 文件的批处理文件。

**这可以通过终端服务器上的 RDP 桌面会话正常工作**。然而，作为一个 TS RemoteApp，嗯……没那么多。

我在客户端系统上快速闪现命令提示符（批处理文件），然后……什么也没有……

让它直接指向 .application 文件（不使用批处理文件）甚至在本地复制发布并让它指向它也是如此。

我发现了关于类似问题的[technet.microsoft.com](http://social.technet.microsoft.com/forums/en-US/winserverTS/thread/0226cf94-133c-4b22-9800-942e7d091c71/)讨论，但没有列出解决方案。

**对于以前遇到过此问题并使其正常工作的任何人，您必须做什么？**

我们目前对该服务器上的所有其他内容都使用 RemoteApp，所以如果可能的话，我希望坚持下去。

当前的解决方法是每当我们通过 OneClick 发布到网络时，在我们的终端服务器上为应用程序构建和运行基于 MSI 的安装程序，但这有时会很痛苦，而且很容易忘记这样做。

由于该应用程序在以完整桌面模式运行但在 RemoteApp 期间无法通过终端服务正常工作，因此我认为它与终端服务器权限无关，因为 ClickOnce 需要在作为 RemoteApp 运行时不可用的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-04-06T13:49:45.533

让它工作的关键是使用 Windows 资源管理器“C:\windows\explorer.exe”。此过程是您登录完整会话时的基本过程。

如果您将 RemoteApp 设置为使用 Windows 资源管理器和 ClickOnce 应用程序的 .application 文件路径的命令行参数，那么它将在作为远程应用程序启动时工作。Windows 资源管理器在启动时会闪烁一秒钟，但会消失，然后 ClickOnce 应用程序将启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T08:04:07.663

为什么它必须是 ClickOnce 应用程序？我会考虑只部署 exe 文件和程序集。

我知道它只是解决方案的一半，但如果应用程序没有太大变化，它可能是一个很好的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T18:15:23.450

我相信您的问题与 ClickOnce 需要将其数据存储在称为 ClickOnce 应用程序缓存的特殊用户文件夹中的事实有关。显然，由于终端服务如何设置用户文件夹，ClickOnce 无法在终端服务模式下访问它。

有关更多信息，请参阅此链接。

[http://msdn.microsoft.com/en-us/library/267k390a(VS.80).aspx](http://msdn.microsoft.com/en-us/library/267k390a(VS.80).aspx)

可能没有办法做到这一点:(

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T16:11:42.083

你可以直接启动.exe吗？它隐藏在 \AppData\Local\Apps\2.0[混淆文件夹] 中的您的个人资料下，但您应该能够找到它。

这将跳过内置更新过程，但如果它可以以这种方式启动，那么您可以[编写代码](http://msdn.microsoft.com/en-us/library/ms404263(VS.80).aspx)在应用程序启动后进行手动更新。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-14T10:53:06.920

今天早上遇到了同样的问题，并通过将 clickonce 应用程序的目录从用户设置文件夹复制到 c:\MyApp\ 之类的地方来解决它 - 我知道它很讨厌而且不是很理想.. 但对我来说已经足够了！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-27T00:10:59.177

我们最近遇到了这个问题，并决定向 Visual Studio 开发团队发布关于这个问题的错误报告。随时对错误报告发表评论。它必须是由 Server 2008 中的某些更改引起的 ClickOnce 中的错误。

[https://connect.microsoft.com/VisualStudio/feedback/details/653362/net-clickonce-deployment-not-working-as-remoteapp-or-citrix-xenapp-on-server-2008-server-2008-r2](https://connect.microsoft.com/VisualStudio/feedback/details/653362/net-clickonce-deployment-not-working-as-remoteapp-or-citrix-xenapp-on-server-2008-server-2008-r2)

我们还在 MSDN 论坛上讨论了这个问题：

[http://social.msdn.microsoft.com/Forums/en-US/winformssetup/thread/7f41667d-287a-4157-be71-d408751358d9/#92a7e5d9-22b6-44ba-9346-ef87a3b85edc](http://social.msdn.microsoft.com/Forums/en-US/winformssetup/thread/7f41667d-287a-4157-be71-d408751358d9/#92a7e5d9-22b6-44ba-9346-ef87a3b85edc)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T16:11:13.717

在启动应用程序时尝试使用 RegMon 和 FileMon - 您可能能够将其追踪到文件和/或注册表权限问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T16:21:42.400

还可以检查事件日志以查看进程失败时是否记录了任何内容。

# vb.net - VB.NET - 如何在即时窗口中获取 With 语句使用的实例

> ID：106175
> 
> 赞同：1
> 
> 时间：2008-09-19T22:37:09.193
> 
> 标签：vb.net, visual-studio, debugging, immediate-window

[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)有一个非常方便的“with”语句，但它也允许您在未命名的变量上使用它，如下所示：

```
With New FancyClass()
    .Level = "SuperSpiffy"
    .Style = Slimming
    .Execute()
End With 
```

有没有办法获得“隐藏”实例，所以我可以在立即窗口中查看它的属性？我怀疑我会在监视窗口中得到它，所以立即可以。

如果您尝试`.Execute()`从“立即”窗口以相同的方式（例如，引发异常时）访问实例，则会收到错误消息：

```
? .Style
'With' contexts and statements are not valid in debug windows. 
```

有什么技巧可以用来得到这个，还是我必须将代码转换为另一种风格？如果`With`功能更像一个`Using`语句（例如“With v = New FancyClass()”），这不会造成问题。

我知道它`With`是如何工作的，存在哪些替代方案，编译器做了什么等等。我只想知道这是否可能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T23:03:13.157

在一行上定义一个变量并在下一行的 with 语句中使用它有什么问题？我意识到它可以让变量保持更长时间，但这有*那么*可怕吗？

```
Dim x = new SomethingOrOther()
With x
    .DoSomething()
End With
x = Nothing ' for the memory conscious 
```

两条额外的线不会杀死你=）

编辑：如果您只是在寻找是/否，我不得不说：不。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T15:13:57.837

正如所回答的那样，简单的答案是“不”。

但这不是另一种方法：不是声明然后清理变量而是使用“使用”。

```
Using fc as new FancyClass()
  With fc    
    .Level = "SuperSpiffy"    
    .Style = Slimming    
    .Execute()
  End With
End Using 
```

然后你可以在即时窗口中使用 fc 而不必记得写一个

```
fc=nothing 
```

线。

只是更多的想法;）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T07:16:33.920

我希望真的没有办法解决它，因为简单的答案是“不”，而且我也没有找到办法。无论哪种方式，到目前为止，没有任何说法真正有理由说“不”，只是没有人有 =）这只是你认为 vb 调试器团队会投入的事情之一，考虑到“与”是多么经典 =）

无论如何，我对 usings 和 Idisposable 了如指掌，我知道如何*修复*代码，正如有些人所说的那样，但我可能并不总是想要。

至于使用，我不喜欢在我的类上实现 IDisposable 只是为了获得一点糖。

我们真正需要的是“With var = New FancyClass()”，但这可能会让人感到困惑！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-19T23:09:35.670

无论哪种方式，您都在创建一个变量-在第一种情况下（您的示例），编译器正在创建一个您不允许真正访问的隐式变量，而在第二种情况下（Oli 的另一个答案）您' d 显式创建变量。

如果你明确地创建它，你可以在即时窗口中使用它，当你完成它时，你可以明确地销毁它（我想我是有记忆意识的人之一！），而不是将那些清理细节留给神奇的过程。我认为没有任何方法可以在即时窗口中获取隐式变量。（而且我也不相信魔法过程。出于这个原因，我从不使用多点符号或隐式变量）

# regex - 匹配 DNS 主机名或 IP 地址的正则表达式？

> ID：106179
> 
> 赞同：390
> 
> 时间：2008-09-19T22:38:01.703
> 
> 标签：regex, dns

有没有人有一个方便的正则表达式来匹配任何合法的 DNS 主机名或 IP 地址？

编写一个在 95% 的时间内都能正常工作的程序很容易，但我希望得到一些经过充分测试的东西，以完全匹配 DNS 主机名的最新 RFC 规范。

* * *

## 回答 #1

> 赞同：563
> 
> 时间：2008-09-19T22:45:58.237

您可以单独使用以下正则表达式，也可以将它们组合在一个联合 OR 表达式中。

```
ValidIpAddressRegex = "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$";

ValidHostnameRegex = "^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$"; 
```

**ValidIpAddressRegex**匹配有效的 IP 地址和**ValidHostnameRegex**有效的主机名。根据您使用的语言，\ 可能必须使用 \ 进行转义。

* * *

**ValidHostnameRegex**根据[RFC 1123](https://www.rfc-editor.org/rfc/rfc1123)有效。最初，[RFC 952](https://www.rfc-editor.org/rfc/rfc952)规定主机名段不能以数字开头。

[http://en.wikipedia.org/wiki/Hostname](http://en.wikipedia.org/wiki/Hostname)

> [RFC 952](https://www.rfc-editor.org/rfc/rfc952)中主机名的原始规范要求标签不能以数字或连字符开头，也不能以连字符结尾。但是，后续规范 ( [RFC 1123](https://www.rfc-editor.org/rfc/rfc1123) ) 允许主机名标签以数字开头。

```
Valid952HostnameRegex = "^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$"; 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2010-09-29T17:09:43.307

*smink*的主机名正则表达式不遵守主机名中单个标签长度的限制。**有效主机名中的每个标签的长度不得超过 63 个八位字节。**

```
ValidHostnameRegex="^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]) \
(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])) *$"
```

请注意，第一行（上图）末尾的反斜杠是用于分割长行的 Unix shell 语法。它不是正则表达式本身的一部分。

这只是单行上的正则表达式：

```
^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\. ([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$
```

您还应该单独检查**主机名的总长度不得超过 255 个字符**。有关详细信息，请参阅 RFC-952 和 RFC-1123。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2013-01-22T07:37:47.467

要匹配有效的**IP 地址**，请使用以下正则表达式：

```
(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3} 
```

代替：

```
([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5])(\.([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5])){3} 
```

### 解释

`OR`许多正则表达式引擎匹配序列中的第一种可能性。例如，尝试以下正则表达式：

```
10.48.0.200 
```

### 测试

测试[好与坏之间](http://regexr.com?37hh1)[的](http://regexr.com?37hh4)区别

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-03T21:23:37.430

我似乎无法编辑置顶帖子，所以我将在此处添加我的答案。

对于主机名 - 简单的答案，这里的 egrep 示例 - http://www.linuxinsight.com/how_to_grep_for_ip_addresses_using_the_gnu_egrep_utility.html

```
egrep '([[:digit:]]{1,3}\.){3}[[:digit:]]{1,3}' 
```

虽然这种情况没有考虑到第一个八位字节中的 0 之类的值，以及大于 254（IP 地址）或 255（网络掩码）的值。也许额外的 if 语句会有所帮助。

至于合法的 dns 主机名，前提是您只检查 Internet 主机名（而不是 Intranet），我编写了以下片段，混合了 shell/php，但它应该适用于任何正则表达式。

首先去ietf网站，下载并解析合法一级域名列表：

```
tld=$(curl -s http://data.iana.org/TLD/tlds-alpha-by-domain.txt |  sed 1d  | cut -f1 -d'-' | tr '\n' '|' | sed 's/\(.*\)./\1/')
echo "($tld)" 
```

这应该会给你一个很好的代码来检查顶级域名的合法性，比如 .com .org 或 .ca

然后根据此处找到的指南添加表达式的第一部分 -- http://www.domainit.com/support/faq.mhtml?category=Domain_FAQ&question=9 （任何字母数字组合和“-”符号，破折号不应该在八位字节的开头或结尾。

```
(([a-z0-9]+|([a-z0-9]+[-]+[a-z0-9]+))[.])+ 
```

然后将它们放在一起（PHP preg_match 示例）：

```
$pattern = '/^(([a-z0-9]+|([a-z0-9]+[-]+[a-z0-9]+))[.])+(AC|AD|AE|AERO|AF|AG|AI|AL|AM|AN|AO|AQ|AR|ARPA|AS|ASIA|AT|AU|AW|AX|AZ|BA|BB|BD|BE|BF|BG|BH|BI|BIZ|BJ|BM|BN|BO|BR|BS|BT|BV|BW|BY|BZ|CA|CAT|CC|CD|CF|CG|CH|CI|CK|CL|CM|CN|CO|COM|COOP|CR|CU|CV|CX|CY|CZ|DE|DJ|DK|DM|DO|DZ|EC|EDU|EE|EG|ER|ES|ET|EU|FI|FJ|FK|FM|FO|FR|GA|GB|GD|GE|GF|GG|GH|GI|GL|GM|GN|GOV|GP|GQ|GR|GS|GT|GU|GW|GY|HK|HM|HN|HR|HT|HU|ID|IE|IL|IM|IN|INFO|INT|IO|IQ|IR|IS|IT|JE|JM|JO|JOBS|JP|KE|KG|KH|KI|KM|KN|KP|KR|KW|KY|KZ|LA|LB|LC|LI|LK|LR|LS|LT|LU|LV|LY|MA|MC|MD|ME|MG|MH|MIL|MK|ML|MM|MN|MO|MOBI|MP|MQ|MR|MS|MT|MU|MUSEUM|MV|MW|MX|MY|MZ|NA|NAME|NC|NE|NET|NF|NG|NI|NL|NO|NP|NR|NU|NZ|OM|ORG|PA|PE|PF|PG|PH|PK|PL|PM|PN|PR|PRO|PS|PT|PW|PY|QA|RE|RO|RS|RU|RW|SA|SB|SC|SD|SE|SG|SH|SI|SJ|SK|SL|SM|SN|SO|SR|ST|SU|SV|SY|SZ|TC|TD|TEL|TF|TG|TH|TJ|TK|TL|TM|TN|TO|TP|TR|TRAVEL|TT|TV|TW|TZ|UA|UG|UK|US|UY|UZ|VA|VC|VE|VG|VI|VN|VU|WF|WS|XN|XN|XN|XN|XN|XN|XN|XN|XN|XN|XN|YE|YT|YU|ZA|ZM|ZW)[.]?$/i';

    if (preg_match, $pattern, $matching_string){
    ... do stuff
    } 
```

您可能还想添加一个 if 语句来检查您检查的字符串是否短于 256 个字符 - [http://www.ops.ietf.org/lists/namedroppers/namedroppers.2003/msg00964.html](http://www.ops.ietf.org/lists/namedroppers/namedroppers.2003/msg00964.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-05-05T18:42:43.830

值得注意的是，大多数语言的库都可以为您执行此操作，通常内置在标准库中。而且这些库的更新频率可能比四年前从 Stack Overflow 答案中复制并忘记的代码要频繁得多。当然，他们通常还会将地址解析为某种可用的形式，而不是仅仅为您提供与一堆组的匹配。

例如，在 (POSIX) C 中检测和解析 IPv4：

```
#include <arpa/inet.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
  for (int i=1; i!=argc; ++i) {
    struct in_addr addr = {0};
    printf("%s: ", argv[i]);
    if (inet_pton(AF_INET, argv[i], &addr) != 1)
      printf("invalid\n");
    else
      printf("%u\n", addr.s_addr);
  }
  return 0;
} 
```

* * *

显然，如果您尝试查找聊天消息中的所有有效地址等功能，这些功能将无法正常工作——但即便如此，使用简单但过于热心的正则表达式来查找潜在匹配项可能会更容易，然后使用库来解析它们。

例如，在 Python 中：

```
>>> import ipaddress
>>> import re
>>> msg = "My address is 192.168.0.42; 192.168.0.420 is not an address"
>>> for maybeip in re.findall(r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}', msg):
...     try:
...         print(ipaddress.ip_address(maybeip))
...     except ValueError:
...         pass 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-14T10:56:32.690

```
def isValidHostname(hostname):

    if len(hostname) > 255:
        return False
    if hostname[-1:] == ".":
        hostname = hostname[:-1]   # strip exactly one dot from the right,
                                   #  if present
    allowed = re.compile("(?!-)[A-Z\d-]{1,63}(?<!-)$", re.IGNORECASE)
    return all(allowed.match(x) for x in hostname.split(".")) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-12T17:21:45.920

我认为这是最好的 IP 验证正则表达式。请检查一次！！！

```
^(([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))\.){3}([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))$ 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-21T18:37:45.093

```
/^(?:[a-zA-Z0-9]+|[a-zA-Z0-9][-a-zA-Z0-9]+[a-zA-Z0-9])(?:\.[a-zA-Z0-9]+|[a-zA-Z0-9][-a-zA-Z0-9]+[a-zA-Z0-9])?$/ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-03-03T02:38:41.613

```
"^((\\d{1,2}|1\\d{2}|2[0-4]\\d|25[0-5])\.){3}(\\d{1,2}|1\\d{2}|2[0-4]\\d|25[0-5])$" 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-01-30T06:17:30.630

这适用于有效的 IP 地址：

```
regex = '^([0-9]|[1-9][0-9]|[1][0-9][0-9]|[2][0-5][0-5])[.]([0-9]|[1-9][0-9]|[1][0-9][0-9]|[2][0-5][0-5])[.]([0-9]|[1-9][0-9]|[1][0-9][0-9]|[2][0-5][0-5])[.]([0-9]|[1-9][0-9]|[1][0-9][0-9]|[2][0-5][0-5])$' 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-04-12T05:46:07.933

```
>>> my_hostname = "testhostn.ame"
>>> print bool(re.match("^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$", my_hostname))
True
>>> my_hostname = "testhostn....ame"
>>> print bool(re.match("^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$", my_hostname))
False
>>> my_hostname = "testhostn.A.ame"
>>> print bool(re.match("^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$", my_hostname))
True 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-02-19T14:19:30.613

这是我在 Ant 中用于从 ANT_OPTS 获取代理主机 IP 或主机名的正则表达式。这用于获取代理 IP，以便在为分叉的 JVM 配置代理之前运行 Ant “isreachable”测试。

```
^.*-Dhttp\.proxyHost=(\w{1,}\.\w{1,}\.\w{1,}\.*\w{0,})\s.*$ 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-24T21:48:51.860

我发现这对于 IP 地址非常有效。它像最佳答案一样验证，但它也确保 ip 是隔离的，因此在 ip 之后或之前没有文本或更多数字/小数。

> > > (?<!\S)(?:(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\b|. \b){7}(?!\S)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-06-25T07:12:54.890

```
AddressRegex = "^(ftp|http|https):\/\/([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{1,5})$";

HostnameRegex =  /^(ftp|http|https):\/\/([a-z0-9]+\.)?[a-z0-9][a-z0-9-]*((\.[a-z]{2,6})|(\.[a-z]{2,6})(\.[a-z]{2,6}))$/i 
```

此 re 仅用于此类型验证

**仅在** [http://www.kk.com](http://www.kk.com) [http://www.kk.co.in时工作](http://www.kk.co.in)

**不适用于**

[http://www.kk.com/](http://www.kk.com/) [http://www.kk.co.in.kk](http://www.kk.co.in.kk)

[http://www.kk.com/dfas](http://www.kk.com/dfas) [http://www.kk.co.in/](http://www.kk.co.in/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-05-27T02:58:53.293

试试这个：

```
((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?) 
```

它适用于我的情况。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-24T01:57:00.527

关于 IP 地址，似乎存在一些关于是否包含前导零的争论。这曾经是一种常见的做法，并且被普遍接受，所以我认为无论当前偏好如何，都*应该将它们标记为有效。*关于是否应该验证字符串前后的文本也存在一些歧义，我认为应该再次验证。1.2.3.4 是一个有效的 IP，但 1.2.3.4.5 不是，而且 1.2.3.4 部分和 2.3.4.5 部分都不应该导致匹配。一些问题可以用这个表达式来处理：

```
grep -E '(^|[^[:alnum:]+)(([0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])\.){3}([0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])([^[:alnum:]]|$)' 
```

不幸的是，验证八位字节的正则表达式部分重复了，这在许多提供的解决方案中都是如此。尽管这比模式实例要好，但如果使用的正则表达式支持子例程，则可以完全消除重复。`-P`下一个示例通过开关启用这些功能，`grep`并且还利用了前瞻和后瞻功能。（我选择的函数名称是 'o' 表示八位字节。我可以使用 'octet' 作为名称，但希望简洁。）

```
grep -P '(?<![\d\w\.])(?<o>([0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5]))(\.\g<o>){3}(?![\d\w\.])' 
```

如果 IP 地址位于带有句子形式的文本的文件中，则对点的处理实际上可能会产生误报，因为句点可能会跟随而不是点分符号的一部分。上面的一个变体可以解决这个问题：

```
grep -P '(?<![\d\w\.])(?<x>([0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5]))(\.\g<x>){3}(?!([\d\w]|\.\d))' 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-03-02T01:50:07.913

新的 Network 框架为 struct IPv4Address 和 struct IPv6Address 提供了可失败的初始化程序，它们可以非常轻松地处理 IP 地址部分。在 IPv6 中使用正则表达式执行此操作对于所有缩短规则都很困难。

不幸的是，对于主机名，我没有一个优雅的答案。

请注意，网络框架是最新的，因此它可能会强制您针对最新的操作系统版本进行编译。

```
import Network
let tests = ["192.168.4.4","fkjhwojfw","192.168.4.4.4","2620:3","2620::33"]

for test in tests {
    if let _ = IPv4Address(test) {
        debugPrint("\(test) is valid ipv4 address")
    } else if let _ = IPv6Address(test) {
        debugPrint("\(test) is valid ipv6 address")
    } else {
        debugPrint("\(test) is not a valid IP address")
    }
}

output:
"192.168.4.4 is valid ipv4 address"
"fkjhwojfw is not a valid IP address"
"192.168.4.4.4 is not a valid IP address"
"2620:3 is not a valid IP address"
"2620::33 is valid ipv6 address" 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2013-04-08T19:24:31.670

这个怎么样？

```
([0-9]{1,3}\.){3}[0-9]{1,3} 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2016-01-11T12:17:51.113

在 php 上：`filter_var(gethostbyname($dns), FILTER_VALIDATE_IP) == true ? 'ip' : 'not ip'`

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2012-01-11T11:14:43.007

检查主机名，例如... mywebsite.co.in、thangaraj.name、18thangaraj.in、thangaraj106.in 等，

```
[a-z\d+].*?\\.\w{2,4}$ 
```

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2015-11-10T06:28:21.470

我想到了这个简单的正则表达式匹配模式，用于 IP 地址匹配 \d+[.]\d+[.]\d+[.]\d+

# linux - 如何从我的 windows 机器运行安装在 linux 机器上的 OpenGL 应用程序？

> ID：106201
> 
> 赞同：7
> 
> 时间：2008-09-19T22:41:21.073
> 
> 标签：linux, opengl, x11, sysadmin, putty

本着乐于助人的精神，这是我遇到并解决的问题，所以我将在这里回答这个问题。

**问题**

我有：

必须安装在 Redhat 或 SuSE 企业上的应用程序。

它有巨大的系统要求并且需要 OpenGL。

它是一套工具的一部分，需要在一台机器上一起操作。

此应用程序用于工时方面的时间密集型任务。

我不想坐在服务器机房里处理这个应用程序。

所以，问题来了......我如何从远程 Windows 机器运行这个应用程序？

我将概述我的解决方案。随意评论替代品。该解决方案也适用于更简单的环境。我的情况有些极端。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-19T22:45:11.500

**解决方案**

我安装了两个软件：

[油灰](http://www.chiark.greenend.org.uk/~sgtatham/putty/)

[XMing-mesa](http://www.straightrunning.com/XmingNotes/)台面部分很重要。

**腻子配置**

```
Connection->Seconds Between Keepalives: 30
Connection->Enable TCP Keepalives: Yes

Connection->SSH->X11->Enable X11 forwarding: Yes
Connection->SSH->X11->X display location: localhost:0:0 
```

**发射**

运行*Xming*，它将简单地启动一个进程并在系统托盘中放置一个图标。使用上述配置启动 putty，指向您的 linux 框。运行程序

希望，**成功！**

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-19T22:59:10.607

如果您希望在本地计算机上执行 OpenGL 渲染，则使用 Windows X 服务器（如 Xming）是一个很好的解决方案。但是，如果您希望仅通过将图像发送到本地计算机来在远程端进行渲染，您需要一个可以处理远程 OpenGL 渲染的专用 VNC 系统，例如[VirtualGL](http://www.virtualgl.org/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-19T22:46:35.757

您也可以使用 VNC（如跨平台远程桌面）X 更有效，因为它只发送绘制命令而不是像素，但如果您使用的是 opengl，则很可能大部分数据都是渲染图像。

VNC 的另一大优点是您可以在服务器上本地启动程序，然后使用 VNC 连接到它，断开连接，从另一台机器重新连接等，而不会干扰主运行的程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T18:42:48.570

对于 OpenGL，运行 X 服务器绝对是更好的解决方案。只需确保将应用程序开发为联网即可。它不应该使用即时模式进行渲染，并且应该很少传输纹理。

为什么在这种情况下 X 服务器是一个更好的解决方案（相对于 VNC）？因为您可以在工作站上获得加速，而 VNC 解决方案通常甚至不会在大型机上加速。因此，只要在 X 服务器上缓冲数据（使用顶点数组、顶点缓冲区对象、纹理对象等），您应该获得比使用 VNC 更高的速度，尤其是对于复杂场景，因为 VNC 必须将它们分析、传输和解码为像素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-18T18:43:14.527

如果您需要服务器 glx 1.2 版，[Xming](https://sourceforge.net/projects/xming/) (Mesa 2007) 的免费版本可以正常工作。但是，如果您的应用程序需要 1.4 版，例如 qt5，Cygwin 的 X Server 可以免费使用以下命令运行它：

[在服务器上]

```
sudo vi /etc/ssh/ssh_config 
```

添加：

> X11转发是
> 
> X11DisplayOffset 10
> 
> X11UseLocalHost 否
> 
> AllowTcpForwarding 是
> 
> TCPKeepAlive 是
> 
> ClientAliveInterval 30
> 
> ClientAliveCountMax 10000

```
sudo vi ~/.bashrc 
```

添加：

> 导出显示=ip_from_remote:0

现在重新启动 ssh 服务器

[在客户幻灯片上]

运行以下命令后安装[Cygwin64](https://cygwin.com/install.html)（支持 X 包）：

```
d:\cygwin64\bin\run.exe --quote /usr/bin/bash.exe -l -c "cd; /usr/bin/xinit /etc/X11/xinit/startxwinrc -- /usr/bin/XWin :0 -ac -multiwindow -listen tcp" 
```

现在执行 ssh 客户端：

```
d:\cygwin64\bin\mintty.exe -i /Cygwin-Terminal.ico -e /usr/bin/ssh -Y user_name@ip_from_server 
```

# sql - 从 SQL Server 中的 VARCHAR 中删除非数字字符的最快方法

> ID：106206
> 
> 赞同：66
> 
> 时间：2008-09-19T22:42:41.613
> 
> 标签：sql, sql-server, performance, optimization

我正在编写一个导入实用程序，它使用电话号码作为导入中的唯一键。

我需要检查我的数据库中是否不存在该电话号码。问题是数据库中的电话号码可能有破折号和括号之类的东西，可能还有其他东西。我写了一个函数来删除这些东西，问题是它很**慢**，我的数据库中有数千条记录并且一次导入数千条记录，这个过程可能会慢得令人无法接受。我已经将电话号码列设为索引。

我尝试使用这篇文章中的脚本：
[T-SQL trim   (and other non-alphanumeric characters)](https://stackoverflow.com/questions/52315/t-sql-trim-nbsp-and-other-non-alphanumeric-characters)

但这并没有加快速度。

有没有更快的方法来删除非数字字符？当必须比较 10,000 到 100,000 条记录时可以表现良好的东西。

无论做什么都需要**快速**执行。

**更新**
鉴于人们的反应，我认为我必须在运行导入实用程序之前清理字段。

为了回答我正在编写导入实用程序的问题，它是一个 C# 应用程序。我现在正在将 BIGINT 与 BIGINT 进行比较，无需更改数据库数据，而且我仍在使用非常小的数据集（大约 2000 条记录）对性能造成影响。

将 BIGINT 与 BIGINT 进行比较会减慢速度吗？

我已经尽可能地优化了我的应用程序的代码端（删除了正则表达式，删除了不必要的数据库调用）。虽然我不能再将 SQL 隔离为问题的根源，但我仍然觉得它是。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2011-06-30T02:44:50.297

我用 T-SQL 代码和 PATINDEX 看到了这个解决方案。我喜欢 ：-）

```
CREATE Function [fnRemoveNonNumericCharacters](@strText VARCHAR(1000))
RETURNS VARCHAR(1000)
AS
BEGIN
    WHILE PATINDEX('%[^0-9]%', @strText) > 0
    BEGIN
        SET @strText = STUFF(@strText, PATINDEX('%[^0-9]%', @strText), 1, '')
    END
    RETURN @strText
END 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2013-07-30T14:59:45.653

`replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(string,'a',''),'b',''),'c',''),'d',''),'e',''),'f',''),'g',''),'h',''),'i',''),'j',''),'k',''),'l',''),'m',''),'n',''),'o',''),'p',''),'q',''),'r',''),'s',''),'t',''),'u',''),'v',''),'w',''),'x',''),'y',''),'z',''),'A',''),'B',''),'C',''),'D',''),'E',''),'F',''),'G',''),'H',''),'I',''),'J',''),'K',''),'L',''),'M',''),'N',''),'O',''),'P',''),'Q',''),'R',''),'S',''),'T',''),'U',''),'V',''),'W',''),'X',''),'Y',''),'Z','')*1 AS string`,

:)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2011-08-11T21:31:15.990

如果您不想创建函数，或者您只需要在 T-SQL 中进行一次内联调用，您可以尝试：

```
set @Phone = REPLACE(REPLACE(REPLACE(REPLACE(@Phone,'(',''),' ',''),'-',''),')','') 
```

当然，这是特定于删除电话号码格式的，而不是通用的从字符串函数中删除所有特殊字符。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-19T22:46:41.060

我可能会误解，但是您有两组数据来删除数据库中当前数据的字符串，然后在导入时删除一组新数据。

为了更新现有记录，我只需要使用 SQL，它只需要发生一次。

但是，SQL 并未针对此类操作进行优化，因为您说您正在编写导入实用程序，所以我将在导入实用程序本身的上下文中进行这些更新，而不是在 SQL 中。这将是更好的性能明智。你在写什么实用程序？

另外，我可能完全误解了这个过程，所以如果偏离基地，我深表歉意。

**编辑：**
对于初始更新，如果您使用的是 SQL Server 2005，您可以尝试使用 CLR 函数。这是一个使用正则表达式的快速方法。不知道性能如何比较，除了现在进行快速测试外，我自己从未使用过它。

```
using System;  
using System.Data;  
using System.Text.RegularExpressions;  
using System.Data.SqlClient;  
using System.Data.SqlTypes;  
using Microsoft.SqlServer.Server;  

public partial class UserDefinedFunctions  
{  
    [Microsoft.SqlServer.Server.SqlFunction]  
    public static SqlString StripNonNumeric(SqlString input)  
    {  
        Regex regEx = new Regex(@"\D");  
        return regEx.Replace(input.Value, "");  
    }  
}; 
```

部署后，要更新您可以使用：

```
UPDATE table SET phoneNumber = dbo.StripNonNumeric(phoneNumber) 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2014-03-20T11:49:17.300

简单功能：

```
CREATE FUNCTION [dbo].[RemoveAlphaCharacters](@InputString VARCHAR(1000))
RETURNS VARCHAR(1000)
AS
BEGIN
  WHILE PATINDEX('%[^0-9]%',@InputString)>0
        SET @InputString = STUFF(@InputString,PATINDEX('%[^0-9]%',@InputString),1,'')     
  RETURN @InputString
END

GO 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-11-03T12:54:36.557

```
create function dbo.RemoveNonNumericChar(@str varchar(500))  
returns varchar(500)  
begin  
declare @startingIndex int  
set @startingIndex=0  
while 1=1  
begin  
    set @startingIndex= patindex('%[^0-9]%',@str)  
    if @startingIndex <> 0  
    begin  
        set @str = replace(@str,substring(@str,@startingIndex,1),'')  
    end  
    else    break;   
end  
return @str  
end

go  

select dbo.RemoveNonNumericChar('aisdfhoiqwei352345234@#$%^$@345345%^@#$^') 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T22:44:54.323

您可以在每晚的过程中删除它们，将它们存储在单独的字段中，然后在运行该过程之前对更改的记录进行更新吗？

或者在插入/更新时，存储“数字”格式，以供以后参考。触发器将是一种简单的方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T23:16:23.857

与使用数字相比，使用 varchars 从根本上来说是缓慢且低效的，原因很明显。您在原始帖子中链接到的函数确实会很慢，因为它们循环遍历字符串中的每个字符以确定它是否是数字。对数千条记录执行此操作，这个过程肯定会很慢。这是正则表达式的完美工作，但 SQL Server 本身并不支持它们。您可以使用 CLR 函数添加支持，但如果不尝试它，很难说这会有多慢我肯定希望它比遍历每个电话号码的每个字符要快得多，但是！

一旦您在数据库中将电话号码格式化为仅是数字，您就可以在 SQL 中切换到数字类型，这将产生与其他数字类型的闪电般的快速比较。您可能会发现，根据新数据的输入速度，一旦您要比较的数据格式正确，在数据库端进行修剪和转换为数字就足够快了，但如果可能的话，您会更好用 .NET 语言编写一个导入实用程序，在访问数据库之前处理这些格式问题。

不管怎样，关于可选格式，你都会遇到一个大问题。即使您的号码保证仅来自北美，有些人会将 1 放在一个完全符合区号的电话号码前面，而另一些人则不会，这将导致同一电话号码的多次输入的可能性。此外，根据您的数据所代表的内容，有些人将使用他们的家庭电话号码，其中可能有几个人住在那里，因此对其的唯一约束将只允许每个家庭一个数据库成员。有些人会使用他们的工作编号并遇到同样的问题，有些人会或不会包含会再次导致人为唯一性潜力的扩展名。

所有这些可能会或可能不会影响您，具体取决于您的特定数据和使用情况，但请务必牢记！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-19T23:47:56.467

我会先尝试 Scott 的 CLR 函数，但添加一个 WHERE 子句以减少更新的记录数。

```
UPDATE table SET phoneNumber = dbo.StripNonNumeric(phoneNumber) 
WHERE phonenumber like '%[^0-9]%' 
```

如果您知道绝大多数记录都包含非数​​字字符，那么它可能无济于事。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-07T21:30:43.997

我知道游戏已经晚了，但这是我为 T-SQL 创建的一个函数，它可以快速删除非数字字符。值得注意的是，我有一个模式“字符串”，我将字符串的实用函数放入......

```
CREATE FUNCTION String.ComparablePhone( @string nvarchar(32) ) RETURNS bigint AS
BEGIN
    DECLARE @out bigint;

-- 1\. table of unique characters to be kept
    DECLARE @keepers table ( chr nchar(1) not null primary key );
    INSERT INTO @keepers ( chr ) VALUES (N'0'),(N'1'),(N'2'),(N'3'),(N'4'),(N'5'),(N'6'),(N'7'),(N'8'),(N'9');

-- 2\. Identify the characters in the string to remove
    WITH found ( id, position ) AS
    (
        SELECT 
            ROW_NUMBER() OVER (ORDER BY (n1+n10) DESC), -- since we are using stuff, for the position to continue to be accurate, start from the greatest position and work towards the smallest
            (n1+n10)
        FROM 
            (SELECT 0 AS n1 UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) AS d1,
            (SELECT 0 AS n10 UNION SELECT 10 UNION SELECT 20 UNION SELECT 30) AS d10
        WHERE
            (n1+n10) BETWEEN 1 AND len(@string)
            AND substring(@string, (n1+n10), 1) NOT IN (SELECT chr FROM @keepers)
    )
-- 3\. Use stuff to snuff out the identified characters
    SELECT 
        @string = stuff( @string, position, 1, '' )
    FROM 
        found
    ORDER BY
        id ASC; -- important to process the removals in order, see ROW_NUMBER() above

-- 4\. Try and convert the results to a bigint   
    IF len(@string) = 0
        RETURN NULL; -- an empty string converts to 0

    RETURN convert(bigint,@string); 
END 
```

然后用它来比较插入，像这样；

```
INSERT INTO Contacts ( phone, first_name, last_name )
SELECT i.phone, i.first_name, i.last_name
FROM Imported AS i
LEFT JOIN Contacts AS c ON String.ComparablePhone(c.phone) = String.ComparablePhone(i.phone)
WHERE c.phone IS NULL -- Exclude those that already exist 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-10-16T12:20:28.497

从性能的角度来看，我会使用内联函数，见下文： ***请注意，不会删除“+”、“-”等符号***

```
CREATE FUNCTION [dbo].[UDF_RemoveNumericStringsFromString]
 (
 @str varchar(100)
 )
 RETURNS TABLE AS RETURN
 WITH Tally (n) as 
  (
  -- 100 rows
   SELECT TOP (Len(@Str)) ROW_NUMBER() OVER (ORDER BY (SELECT NULL))
   FROM (VALUES (0),(0),(0),(0),(0),(0),(0),(0),(0),(0)) a(n)
   CROSS JOIN (VALUES(0),(0),(0),(0),(0),(0),(0),(0),(0),(0)) b(n)
  )

  SELECT OutStr =  STUFF(
       (SELECT SUBSTRING(@Str, n,1) st
        FROM Tally
        WHERE ISNUMERIC(SUBSTRING(@Str, n,1)) = 1
        FOR XML PATH(''),type).value('.', 'varchar(100)'),1,0,'')
  GO

  /*Use it*/
  SELECT OutStr
  FROM dbo.UDF_RemoveNumericStringsFromString('fjkfhk759734977fwe9794t23')
  /*Result set
   759734977979423 */ 
```

您可以用超过 100 个字符来定义它...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-19T23:54:44.577

“虽然我不能再将 SQL 隔离为问题的根源，但我仍然觉得它是。”

启动 SQL Profiler 并查看一下。获取结果查询并检查其执行计划以确保正在使用该索引。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-20T03:13:36.067

数千条记录对数千条记录通常不是问题。我已经使用 SSIS 导入了数百万条这样的重复数据删除记录。

我会清理数据库以首先删除非数字字符并将它们排除在外。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-06-07T15:08:27.447

寻找一个超级简单的解决方案：

```
SUBSTRING([Phone], CHARINDEX('(', [Phone], 1)+1, 3)
       + SUBSTRING([Phone], CHARINDEX(')', [Phone], 1)+1, 3)
       + SUBSTRING([Phone], CHARINDEX('-', [Phone], 1)+1, 4) AS Phone 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-19T22:55:00.710

我建议对数据库中的电话号码实施严格的格式。我使用以下格式。（假设美国电话号码）

数据库：5555555555x555

显示：(555) 555-5555 转 555

输入：任何字符串中嵌入的 10 位或更多位。（正则表达式替换删除所有非数字字符）

# java - OSGi 解决了什么问题？

> ID：106222
> 
> 赞同：292
> 
> 时间：2008-09-19T22:45:49.533
> 
> 标签：java, components, osgi

我在 Wikipedia 和其他网站上阅读过有关[OSGi](https://en.wikipedia.org/wiki/OSGi)的信息，但我并没有真正看到全局。它说它是一个基于组件的平台，并且您可以在运行时重新加载模块。此外，随处可见的“实际示例”是 Eclipse 插件框架。

我的问题是：

1.  OSGi 的清晰和简单的定义是什么？

2.  它解决了哪些常见问题？

我所说的“常见问题”是指我们每天面临的问题，例如“OSGi 可以做些什么来让我们的工作更高效/有趣/简单？”

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2013-07-26T08:39:38.223

# ***OSGi 的组件系统为您提供了哪些好处？
好吧，这是一个相当多的清单：***

**降低复杂性 -**使用 OSGi 技术进行开发意味着开发捆绑包：OSGi 组件。捆绑包是模块。它们对其他捆绑包隐藏其内部结构，并通过定义明确的服务进行通信。隐藏内部结构意味着以后可以更自由地进行更改。这不仅减少了 bug 的数量，而且还使 bundle 更易于开发，因为正确大小的 bundle 通过定义良好的接口实现了一项功能。有一个有趣的博客描述了 OSGi 技术为他们的开发过程做了什么。

**重用**——OSGi 组件模型使得在应用程序中使用许多第三方组件变得非常容易。越来越多的开源项目为 OSGi 提供了现成的 JAR。但是，商业库也可以作为现成的捆绑包使用。

**真实世界 -**OSGi 框架是动态的。它可以即时更新捆绑包，服务可以来来去去。习惯于更传统 Java 的开发人员认为这是一个非常有问题的特性，而看不到它的优势。然而，事实证明，现实世界是高度动态的，并且具有可以来去去去的动态服务使得这些服务非常适合许多现实世界的场景。例如，服务可以为网络中的设备建模。如果检测到设备，则注册服务。如果设备消失，则服务未注册。与这种动态服务模型相匹配的现实世界场景数量惊人。因此，应用程序可以在自己的域中重用服务注册中心的强大原语（注册、获取、使用表达性过滤语言列出，并等待服务出现和消失）。这不仅节省了编写代码，还提供了全局可见性、调试工具和比专用解决方案实现的更多功能。在这样的动态环境中编写代码听起来像是一场噩梦，但幸运的是，有一些支持类和框架可以减轻大部分（如果不是全部）的痛苦。

**易于部署 -** OSGi 技术不仅仅是组件的标准。它还指定如何安装和管理组件。许多捆绑软件都使用此 API 来提供管理代理。该管理代理可以像命令外壳、TR-69 管理协议驱动程序、OMA DM 协议驱动程序、亚马逊 EC2 的云计算接口或 IBM Tivoli 管理系统一样简单。标准化的管理 API 使得将 OSGi 技术集成到现有和未来系统中变得非常容易。

**动态更新**——OSGi 组件模型是一个动态模型。可以在不关闭整个系统的情况下安装、启动、停止、更新和卸载捆绑包。许多 Java 开发人员不相信这可以可靠地完成，因此最初不会在生产中使用它。然而，在开发中使用它一段时间后，大多数人开始意识到它确实有效并且显着减少了部署时间。

**自适应 -** OSGi 组件模型是从头开始设计的，允许组件的混合和匹配。这要求需要指定组件的依赖关系，并且要求组件生活在其可选依赖关系并不总是可用的环境中。OSGi 服务注册中心是一个动态注册中心，bundle 可以在其中注册、获取和监听服务。这种动态服务模型允许捆绑包找出系统上可用的功能并调整它们可以提供的功能。这使代码更灵活，更能适应变化。

**透明度 -**捆绑包和服务是 OSGi 环境中的一等公民。管理 API 提供对 bundle 内部状态以及它如何连接到其他 bundle 的访问。例如，大多数框架都提供了一个显示这种内部状态的命令 shell。可以停止部分应用程序以调试某个问题，或者可以引入诊断包。OSGi 应用程序通常可以使用实时命令 shell 来调试，而不是盯着数百万行的日志输出和漫长的重启时间。

**版本控制**——OSGi 技术解决了 JAR 问题。JAR 地狱是库 A 与库 B;version=2 一起工作的问题，但库 C 只能与 B;version=3 一起工作。在标准 Java 中，你不走运。在 OSGi 环境中，所有的 bundle 都经过仔细的版本控制，只有可以协作的 bundle 在同一个类空间中连接在一起。这允许包 A 和 C 使用它们自己的库来运行。尽管不建议设计具有此版本控制问题的系统，但在某些情况下它可以挽救生命。

**简单 -** OSGi API 非常简单。核心 API 只有一个包，不到 30 个类/接口。这个核心 API 足以编写包、安装包、启动、停止、更新和卸载包，并且包括所有侦听器和安全类。很少有 API 能够为这么少的 API 提供这么多的功能。

**小**——OSGi Release 4 框架可以在大约 300KB 的 JAR 文件中实现。对于通过包含 OSGi 添加到应用程序的大量功能来说，这是一个很小的开销。因此，OSGi 可以在各种设备上运行：从非常小的设备到小型设备，再到大型机。它只要求运行一个最小的 Java VM，并且在其上添加的东西很少。

**快速**- OSGi 框架的主要职责之一是从包中加载类。在传统的 Java 中，JAR 是完全可见的并放在一个线性列表中。搜索一个类需要搜索这个（通常很长，150 个并不少见）列表。相反，OSGi 预先连接捆绑包，并为每个捆绑包准确地知道哪个捆绑包提供了类。这种缺乏搜索是启动时的重要加速因素。

**懒惰 -**软件中的懒惰是好的，OSGi 技术有许多机制，只有在真正需要时才做事。例如，bundle 可以立即启动，但也可以配置为仅在其他 bundle 使用它们时启动。服务可以注册，但只能在使用时创建。规范已经过多次优化，以允许这种可以节省大量运行时成本的惰性场景。

**安全 -** Java 在底部有一个非常强大的细粒度安全模型，但在实践中却很难配置。结果是大多数安全的 Java 应用程序都以二元选择运行：没有安全性或功能非常有限。OSGi 安全模型利用了细粒度的安全模型，但通过让包开发人员以易于审计的形式指定请求的安全细节，同时环境的操作员仍然完全负责，从而提高了可用性（以及强化原始模型）。总体而言，OSGi 可能提供了最安全的应用程序环境之一，在没有硬件保护的计算平台的情况下仍然可用。

**非侵入式 -** OSGi 环境中的应用程序（捆绑包）由它们自己处理。他们几乎可以使用 VM 的任何设施，而不受 OSGi 的限制。OSGi 的最佳实践是编写普通的旧 Java 对象，因此，OSGi 服务不需要特殊的接口，即使是 Java 字符串对象也可以充当 OSGi 服务。这种策略使应用程序代码更容易移植到另一个环境。

**到处跑——**嗯，这取决于。Java 最初的目标是在任何地方运行。显然，不可能在任何地方运行所有代码，因为 Java VM 的功能不同。移动电话中的 VM 可能不支持与运行银行应用程序的 IBM 大型机相同的库。有两个问题需要处理。首先，OSGi API 不应使用并非在所有环境中都可用的类。其次，如果包包含在执行环境中不可用的代码，则不应启动它。这两个问题都在 OSGi 规范中得到了解决。

资料来源：[www.osgi.org/Technology/WhyOSGi](http://www.osgi.org/Technology/WhyOSGi)

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2008-09-19T23:16:33.937

I've found the following benefits from OSGi:

*   Each plugin is a versioned artifact that has its own classloader.
*   Each plugin depends on both specific jars that it contains and also other specific versioned plug-ins.
*   Because of the versioning and isolated classloaders, different versions of the same artifact can be loaded at the same time. If one component of your application relies on one version of a plug-in and another depends on another version, they both can be loaded at the same time.

With this, you can structure your application as a set of versioned plugin artifacts that are loaded on demand. Each plugin is a standalone component. Just as Maven helps you structure your build so it is repeatable and defined by a set of specific versions of artifacts it is created by, OSGi helps you do this at runtime.

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2008-09-20T16:43:45.493

我不太关心 OSGi 模块的热插拔性（至少目前是这样）。它更多的是强制模块化。在类路径上随时没有数百万个“公共”类可以很好地防止循环依赖：您必须真正考虑您的公共接口 - 不仅在 java 语言构造“公共”方面，而且在您的库方面/module：您想为其他人提供哪些（确切地说）是哪些组件？您真正需要实现功能的（其他模块的）接口是什么（确切地说）是什么？

很好，带有热插拔功能，但我宁愿重新启动我常用的应用程序，也不愿测试所有热插拔性组合......

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2010-11-23T16:21:30.627

*   以此类推，您可以在不关闭汽车的情况下更换汽车的电机。
*   您可以为客户定制复杂的系统。了解 Eclipse 的强大功能。
*   您可以重用整个组件。比仅仅对象更好。
*   您使用稳定的平台来开发基于组件的应用程序。这样做的好处是巨大的。
*   您可以使用黑盒概念构建组件。其他组件不需要知道隐藏接口，它们只看到已发布的接口。
*   您可以在同一系统中使用多个相同的组件，但在不同的版本中，而不会影响应用程序。OSGi 解决了 Jar Hell 问题。
*   使用 OSGi，您可以开发思维以使用[CBD构建系统](http://en.wikipedia.org/wiki/Component-based_software_engineering)

有很多好处（我现在只提醒了这些），适用于所有使用 Java 的人。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-19T22:55:47.543

*为清楚起见进行了编辑。OSGi 页面给出了比我更好的简单答案*

一个简单的答案：OSGi 服务平台为协作网络服务提供了一个标准化的、面向组件的计算环境。这种架构显着降低了构建、维护和部署应用程序的整体复杂性。OSGi 服务平台提供了在各种网络的设备上动态更改组合的功能，无需重新启动。

在单个应用程序结构中，比如 Eclipse IDE，安装新插件时重新启动并不是什么大问题。完全使用 OSGi 实现，您应该能够在运行时添加插件，获得新功能，但根本不必重新启动 eclipse。

同样，对于每天的小型应用程序使用而言，这没什么大不了的。

但是，当您开始研究多计算机、分布式应用程序框架时，它就会开始变得有趣。当您必须为关键系统提供 100% 的正常运行时间时，热插拔组件或在运行时添加新功能的功能非常有用。诚然，现在大多数情况下都有执行此操作的功能，但 OSGi 正试图将所有内容捆绑到一个带有通用接口的漂亮小框架中。

OSGi 是否解决了常见问题，我不确定。我的意思是，它可以，但对于更简单的问题，开销可能不值得。但是当您开始处理更大的网络应用程序时，这是需要考虑的事情。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-04-22T22:16:08.570

一些让我对 OSGi 疯狂的事情：

1) 实现和它们的上下文加载器有很多怪癖，并且可能有点异步（我们在 confluence 中使用 felix）。与纯弹簧（无 DM）相比，[main] 几乎所有东西都同步运行。

2）热加载后类不相等。比如说，你在休眠时有一个 tangosol 缓存层。它充满了 OSGi 范围之外的 Fork.class。你热加载了一个新的 jar，而 Fork 并没有改变。类[叉子]！=类[叉子]。由于相同的根本原因，它也会在序列化过程中出现。

3）聚类。

您可以解决这些问题，但这是一个主要的痛苦，并使您的架构看起来有缺陷。

对于那些为热插拔做广告的人...... OSGi 的#1 客户端？蚀。Eclipse 在加载包后会做什么？

它重新启动。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2017-06-14T13:17:39.467

OSGi 使您的代码抛出`NoClassDefFoundError`并且`ClassNotFoundException`没有明显的原因（很可能是因为您忘记在 OSGi 配置文件中导出包）；因为它有 ClassLoaders 它可以使你的类`com.example.Foo`无法被强制转换，`com.example.Foo`因为它实际上是由两个不同的类加载器加载的两个不同的类。安装 Eclipse 插件后，它可以让你的 Eclipse 启动到 OSGi 控制台。

对我来说，OSGi 只是增加了复杂性（因为它增加了一个让我去思考的心理模型），因为异常而增加了烦恼；我从来没有真正需要它“提供”的动态性。它是侵入性的，因为它需要对所有模块进行 OSGi 捆绑配置；这绝对不简单（在一个更大的项目中）。

由于我的经历不好，我倾向于远离那个怪物，非常感谢。我宁愿忍受 jar 依赖地狱，因为这比 OSGi 引入的类加载器地狱更容易理解。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-02-18T15:26:21.103

我还不是 OSGi 的“粉丝”……

我一直在财富 100 强公司使用企业应用程序。最近，我们使用的产品“升级”到了 OSGi 实现。

开始本地 cba 部署... [2/18/14 8:47:23:727 EST] 00000347 CheckForOasis

最终部署并且“以下捆绑包将被静默然后重新启动”[2/18/14 9:38:33:108 EST] 00000143 AriesApplicat I CWSAI0054I：作为应用程序更新操作的一部分

51 分钟...每次代码更改...以前的版本（非 OSGi）将在不到 5 分钟的时间内部署在较旧的开发机器上。

在具有 16 gig ram 和 40 个可用 gig 磁盘和 Intel i5-3437U 1.9 GHz CPU 的机器上

这次升级的“好处”作为改进（生产）部署出售——我们每年进行大约 4 次活动，每年可能进行 2-4 次小型修复部署。每天为 15 人（QA 和开发人员）增加 45 分钟我无法想象这是合理的。在大型企业应用程序中，如果您的应用程序是核心应用程序，那么更改它是正确的（小的更改可能会产生深远的影响 - 必须与整个企业的消费者进行沟通和计划），这是一项巨大的活动 - 错误的架构操作系统吉。如果您的应用程序不是企业应用程序 - 即每个消费者都可以拥有自己定制的模块，可能会在他们自己的孤岛数据库中访问他们自己的数据孤岛并在托管许多应用程序的服务器上运行，那么也许看看 OSGi。至少，

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-02-24T13:28:10.743

如果基于 Java 的应用程序需要添加或删除模块（扩展应用程序的基本功能），而无需关闭 JVM，则可以使用 OSGI。通常如果关闭JVM的成本更高，只是为了更新或增强功能。

**例子**：

1.  **Eclipse**：为插件提供安装、卸载、更新和相互依赖的平台。
2.  **AEM**：WCM 应用程序，其中功能更改将由业务驱动，无法承受停机维护时间。

**注意**：Spring 框架停止支持 OSGI spring 包，认为它对于基于事务的应用程序或这些行中的某些点来说是不必要的复杂性。除非绝对必要，否则我个人不会考虑 OSGI，例如构建平台。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-08-27T10:25:45.460

我使用 OSGi 已经有将近 8 年的时间了，我不得不说，只有当您有业务需要在运行时更新、删除、安装或替换组件时，您才应该考虑使用 OSGi。这也意味着您应该具有模块化的思维方式并了解模块化的含义。有一些争论说 OSGi 是轻量级的——是的，这是真的，但也有一些其他的框架是轻量级的，更容易维护和开发。保护 java blah blah 也是如此。

OSGi 需要一个可靠的体系结构才能正确使用，并且很容易制作 OSGi 系统，它可以很容易地成为一个独立运行的 jar，而不涉及任何 OSGi。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-11-18T17:21:32.103

OSGi 提供以下好处：

■ 基于 Java 的可移植且安全的执行环境

■ 服务管理系统，可用于跨包注册和共享服务，将服务提供者与服务消费者解耦

■ 动态模块系统，可用于动态安装和卸载 Java 模块，OSGi 将其称为捆绑包

■ 轻量级和可扩展的解决方案

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-03-10T22:05:52.060

至少，OSGi 让您思考模块化、代码重用、版本控制以及一般的项目管道。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-30T20:38:21.580

它还被用来为移动端的中间件和应用程序带来额外的可移植性。例如，移动端可用于 WinMo、Symbian、Android。一旦与设备功能集成，就会变得支离破碎。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-05-05T04:23:53.833

在它的官网上已经有一个相当有说服力的说法，我可以引用为

> OSGi 技术如此成功的关键原因在于它提供了一个非常**成熟的组件系统**，该系统实际上可以在数量惊人的环境中工作。OSGi 组件系统实际上用于构建高度复杂的应用程序，如 IDE (Eclipse)、应用程序服务器（GlassFish、IBM Websphere、Oracle/BEA Weblogic、Jonas、JBoss）、应用程序框架（Spring、Guice）、工业自动化、住宅网关、电话，还有更多。

至于对开发商的好处？

> 开发人员：OSGi 通过为当今的大型分布式系统以及小型嵌入式应用程序提供模块化架构来降低复杂性。从内部和现成的模块构建系统显着降低了复杂性，从而降低了开发和维护费用。OSGi 编程模型实现了基于组件的系统的承诺。

请查看[使用 OSGi 的好处中](https://www.osgi.org/developer/benefits-of-using-osgi/)的详细信息。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-12-23T07:39:00.203

其他人已经详细描述了它的好处，我在此解释一下我看到或使用过 OSGi 的实际用例。

1.  在我们的一个应用程序中，我们有基于事件的流程，并且流程是在基于 OSGi 平台的插件中定义的，所以明天如果一些客户想要不同/额外的流程，那么他只需要再部署一个插件，从我们的控制台配置它，他就完成了.
2.  它用于部署不同的 Store 连接器，例如，假设我们已经有 Oracle DB 连接器，明天需要连接 mongodb，然后编写一个新的连接器并部署它并通过控制台配置详细信息，然后您就完成了。连接器的部署由 OSGi 插件框架处理。

# unix - lsof生存指南

> ID：106234
> 
> 赞同：108
> 
> 时间：2008-09-19T22:48:10.867
> 
> 标签：unix, sysadmin, lsof

lsof 是一个非常强大的用于 unix 系统的命令行实用程序。它列出打开的文件，显示有关它们的信息。而且由于大多数东西都是 unix 系统上的文件，lsof 可以为系统管理员提供大量有用的诊断数据。

使用 lsof 的一些最常见和最有用的方法是什么，以及为此使用了哪些命令行开关？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2008-11-26T07:42:47.107

显示与给定相关的所有网络`port`：

```
lsof -iTCP -i :port
lsof -i :22 
```

要显示与特定主机的连接，请使用`@host`

```
lsof -i@192.168.1.5 
```

`@host:port` 使用lsof -i@192.168.1.5:22显示基于主机和端口的连接

`grep`ping for`LISTEN`显示您的系统正在等待连接的端口：

```
lsof -i| grep LISTEN 
```

使用以下命令显示给定用户已打开的内容`-u`：

```
lsof -u daniel 
```

查看命令正在使用哪些文件和网络连接`-c`

```
lsof -c syslog-ng 
```

该`-p`开关可让您查看给定进程 ID 已打开的内容，这有助于了解有关未知进程的更多信息：

```
lsof -p 10075 
```

该`-t`选项仅返回一个`PID`

```
lsof -t -c Mail 
```

一起使用`-t`和`-c`选项可以`HUP`处理

```
kill -HUP $(lsof -t -c sshd) 
```

您还可以使用`-t`with`-u`杀死用户打开的所有内容

```
kill -9 $(lsof -t -u daniel) 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-19T22:53:39.450

```
lsof -i :port 
```

将告诉您哪些程序正在侦听特定端口。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-19T22:51:41.483

`lsof -i`将提供打开的网络套接字列表。该`-n`选项将阻止 DNS 查找，这在您的网络连接缓慢或不可靠时很有用。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2012-07-15T19:31:36.690

```
lsof +D /some/directory 
```

将递归显示目录中打开的所有文件。+d 仅用于顶层。

当您对 IO 有很高的等待百分比时，这很有用，与在特定 FS 上使用相关，并且想要查看哪些进程正在咀嚼您的 io。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-19T22:52:54.930

查看正在运行的应用程序或守护程序打开了哪些文件：

```
lsof -p pid 
```

其中**pid**是应用程序或守护程序的进程 ID。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-07-05T17:48:32.253

```
lsof +f -- /mountpoint 
```

列出使用挂载在 /mountpoint 的挂载文件的进程。对于查找哪些进程正在使用已安装的 USB 记忆棒或 CD/DVD 尤其有用。

# data-structures - 计算一个点的希尔伯特值以用于希尔伯特 R-树？

> ID：106237
> 
> 赞同：21
> 
> 时间：2008-09-19T22:48:47.763
> 
> 标签：data-structures, fractals

我有一个应用程序，其中 Hilbert R-Tree [(wikipedia)](http://en.wikipedia.org/wiki/Hilbert_R-tree) [(citeseer)](http://citeseer.comp.nus.edu.sg/84580.html)似乎是一个合适的数据结构。具体来说，它需要对将经历大量更新的数据集进行相当快速的空间查询。

然而，据我所知，该数据结构的算法描述都没有*提到*如何实际计算所需的**希尔伯特值**；这是沿[希尔伯特曲线](http://en.wikipedia.org/wiki/Hilbert_curve)到该点的距离。

那么关于如何计算这个有什么建议吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T23:01:28.277

有趣的问题！

我做了一些谷歌搜索，好消息是，我找到了 Hilbert Value 的实现。

潜在的坏消息是，它在 Haskell 中......

[http://www.serpentine.com/blog/2007/01/11/two-dimensional-spatial-hashing-with-space-filling-curves/](http://www.serpentine.com/blog/2007/01/11/two-dimensional-spatial-hashing-with-space-filling-curves/)

它还提出了一个 Lebesgue 距离度量，您可以更轻松地计算。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-24T11:46:52.763

下面是我的 Java 代码改编自 Xian Lu 和 Gunther Schrack 发表在 Software: Practice and Experience Vol. 上的论文“Encoding anddecode the Hilbert order”中的 C 代码。26 页 1335-46 (1996)。

希望这可以帮助。欢迎改进！

迈克尔

```
/**
 * Find the Hilbert order (=vertex index) for the given grid cell 
 * coordinates.
 * @param x cell column (from 0)
 * @param y cell row (from 0)
 * @param r resolution of Hilbert curve (grid will have Math.pow(2,r) 
 * rows and cols)
 * @return Hilbert order 
 */
public static int encode(int x, int y, int r) {

    int mask = (1 << r) - 1;
    int hodd = 0;
    int heven = x ^ y;
    int notx = ~x & mask;
    int noty = ~y & mask;
    int temp = notx ^ y;

    int v0 = 0, v1 = 0;
    for (int k = 1; k < r; k++) {
        v1 = ((v1 & heven) | ((v0 ^ noty) & temp)) >> 1;
        v0 = ((v0 & (v1 ^ notx)) | (~v0 & (v1 ^ noty))) >> 1;
    }
    hodd = (~v0 & (v1 ^ x)) | (v0 & (v1 ^ noty));

    return interleaveBits(hodd, heven);
}

/**
 * Interleave the bits from two input integer values
 * @param odd integer holding bit values for odd bit positions
 * @param even integer holding bit values for even bit positions
 * @return the integer that results from interleaving the input bits
 *
 * @todo: I'm sure there's a more elegant way of doing this !
 */
private static int interleaveBits(int odd, int even) {
    int val = 0;
    // Replaced this line with the improved code provided by Tuska
    // int n = Math.max(Integer.highestOneBit(odd), Integer.highestOneBit(even));
    int max = Math.max(odd, even);
    int n = 0;
    while (max > 0) {
        n++;
        max >>= 1;
    }

    for (int i = 0; i < n; i++) {
        int bitMask = 1 << i;
        int a = (even & bitMask) > 0 ? (1 << (2*i)) : 0;
        int b = (odd & bitMask) > 0 ? (1 << (2*i+1)) : 0;
        val += a + b;
    }

    return val;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T07:03:55.160

见[uzaygezen](http://code.google.com/p/uzaygezen/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-27T18:40:43.400

上面的代码和 java 代码适用于 2D 数据点。但对于更高的维度，您可能需要查看 Jonathan Lawder 的论文：[JKLawder。使用希尔伯特空间填充曲线计算一维和 n 维值之间的映射。](http://www.dcs.bbk.ac.uk/~jkl/pubs/JL1_00a.pdf)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-14T15:51:22.580

我想出了一种更有效的方式来交错位。它可以在[斯坦福图形网站](http://graphics.stanford.edu/~seander/bithacks.html#InterleaveBMN "斯坦福图形网站")上找到。我包含了一个我创建的版本，它可以将两个 32 位整数交织成一个 64 位长。

```
public static long spreadBits32(int y) {
    long[] B = new long[] {
        0x5555555555555555L, 
        0x3333333333333333L,
        0x0f0f0f0f0f0f0f0fL,
        0x00ff00ff00ff00ffL,
        0x0000ffff0000ffffL,
        0x00000000ffffffffL
    };

    int[] S = new int[] { 1, 2, 4, 8, 16, 32 };
    long x = y;

    x = (x | (x << S[5])) & B[5];
    x = (x | (x << S[4])) & B[4];
    x = (x | (x << S[3])) & B[3];
    x = (x | (x << S[2])) & B[2];
    x = (x | (x << S[1])) & B[1];
    x = (x | (x << S[0])) & B[0];
    return x;
}

public static long interleave64(int x, int y) {
    return spreadBits32(x) | (spreadBits32(y) << 1);
} 
```

显然，*B*和*S*局部变量应该是类常量，但为了简单起见，它保留了这种方式。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-17T13:03:46.750

迈克尔，

感谢您的 Java 代码！我对其进行了测试，它似乎工作正常，但我注意到位交错函数在递归级别 7 处溢出（至少在我的测试中，但我使用了长值），因为“n”值是使用最高 OneBit（ )-函数，它返回值而不是最高一位的位置；所以循环不必要地进行了许多交错。

我只是将其更改为以下代码段，之后它运行良好。

```
  int max = Math.max(奇数，偶数);
  诠释 n = 0;
  而（最大> 0）{
    n++;
    最大值 >>= 1；
  }

```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-12-10T16:41:02.133

如果您需要具有快速删除/插入功能的空间索引，请查看 PH-tree。它部分基于四叉树，但速度更快，空间效率更高。在内部，它使用 Z 曲线，其空间特性比 H 曲线稍差，但**更**容易计算。

论文：[http ://www.globis.ethz.ch/script/publication/download?docid=699](http://www.globis.ethz.ch/script/publication/download?docid=699)

Java实现： http: [//globis.ethz.ch/files/2014/11/ph-tree-2014-11-10.zip](http://globis.ethz.ch/files/2014/11/ph-tree-2014-11-10.zip)

另一个选择是 X-tree，也可以在这里找到： [https ://code.google.com/p/xxl/](https://code.google.com/p/xxl/)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-23T22:50:08.317

建议：空间查询一个好的简单高效的数据结构是多维二叉树。

在传统的二叉树中，只有一个“判别式”；用于确定您是选择左分支还是右分支的值。这可以被认为是一维的情况。

在多维二叉树中，您有多个判别式；连续级别使用不同的判别式。例如，对于二维空间数据，您可以使用 X 和 Y 坐标作为判别式。连续级别将使用 X、Y、X、Y...

对于空间查询（例如查找矩形内的所有节点），您从根开始对树进行深度优先搜索，并在每个级别使用判别式以避免在给定矩形中搜索不包含节点的分支。

这使您可以在每个级别将搜索空间减少一半，从而非常有效地在海量数据集中查找小区域。（顺便说一句，这种数据结构对于部分匹配查询也很有用，即省略一个或多个判别式的查询。您只需在省略判别式的级别上搜索两个分支。）

关于这个数据结构的一篇好论文： http://portal.acm.org/citation.cfm?id= [361007](http://portal.acm.org/citation.cfm?id=361007) 这篇文章有很好的图表和算法描述：[http ://en.wikipedia.org/wiki/Kd-tree](http://en.wikipedia.org/wiki/Kd-tree)

# c++ - 如何使用 MAPI 在我的应用程序中同步通讯录？

> ID：106243
> 
> 赞同：0
> 
> 时间：2008-09-19T22:49:39.290
> 
> 标签：c++, mapi

我正在使用的系统包含一个地址簿。我正在寻找通过 MAPI 将地址与当前用户通讯簿同步的示例代码。我需要双向同步。

如果您知道任何具有易于使用功能的开源库，我会很高兴听到它。如果您知道一个不是开源的库，那也很好。最好的是一个库，它的许可证允许我在我们自己的解决方案中使用它。

如果你，上帝保佑，知道一个图书馆可以让我很*容易*地在 MAPI 提供者中发布我的地址簿 - 好吧，那么我很想听到它！

使用外部地址簿并放弃我们自己的地址簿不是为我们的客户服务的选择。

使用 vanilla MAPI 的良好工作代码示例当然也是可以接受的。;-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T22:52:33.540

Zarafa 刚刚[以 GPL 的形式发布了他们的 100% MAPI 兼容的群件套件](http://www.zarafa.com/?q=en/content/products)。也许这对你有用？

编辑：链接是斜线。 [更多信息在这里。](http://linux.slashdot.org/article.pl?sid=08/09/19/2023252)

# ruby-on-rails - 如何为我的 ActiveRecord 模型编写带有参数的自定义验证方法？

> ID：106251
> 
> 赞同：16
> 
> 时间：2008-09-19T22:51:47.897
> 
> 标签：ruby-on-rails, ruby

在我的模型中，我有：

```
validate :my_custom_validation

def my_custom_validation
 errors.add_to_base("error message") if condition.exists?
end 
```

我想向 mycustomer 验证添加一些参数，如下所示：

```
validate :my_custom_validation, :parameter1 => x, :parameter2 => y 
```

如何编写 mycustomvalidation 函数来解释参数？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-19T23:05:43.773

验证器通常有一个数组参数，首先指示要验证的字段，最后（如果存在）带有选项的哈希。在您的示例中：

```
:my_custom_validation, parameter1: x, parameter2: y 
```

:my_custom_validation 将是一个字段名称，而 parameter1: x, parameter2: y 将是一个哈希：

```
{ parameter1: x, parameter2: y} 
```

因此，您会执行以下操作：

```
def my_custom_validation(*attr)
    options = attr.pop if attr.last.is_a? Hash
    # do something with options
    errors.add_to_base("error message") if condition.exists?

end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T22:58:16.633

你可以这样做：

```
def validate
  errors.add('That particular field', 'can not be the value you presented') if !self.field_to_check.blank? && self.field_to_check == 'I AM COOL'
end 
```

无需调用引用它，因为我相信在任何类似 validates_uniqueness_of 的验证之后都会处理 validate 方法（如果它存在）。

补充：Rails API 文档中的更多信息在[这里](http://api.rubyonrails.com/classes/ActiveRecord/Validations.html)。

# sql - 如何使用 MS SQL 获取所有字段记录中使用的不同单词列表？

> ID：106275
> 
> 赞同：3
> 
> 时间：2008-09-19T23:00:41.760
> 
> 标签：sql, sql-server

如果我有一个名为“描述”的表字段，那么 SQL（使用 MS SQL）将获取该字段中使用的所有不同单词的记录列表。

例如：

如果表中的“描述”字段包含以下内容：

```
Record1 "The dog jumped over the fence."
Record2 "The giant tripped on the fence."
... 
```

SQL 记录输出将是：

```
"The","giant","dog","jumped","tripped","on","over","fence" 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-19T23:02:53.330

我不认为你可以用 SELECT 来做到这一点。最好的机会是编写一个用户定义的函数，该函数返回一个包含所有单词的表，然后对其执行 SELECT DISTINCT。

* * *

**免责声明：**函数**dbo.Split**来自[http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=50648](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=50648)

```
CREATE TABLE test
(
    id int identity(1, 1) not null,
    description varchar(50) not null
)

INSERT INTO test VALUES('The dog jumped over the fence')
INSERT INTO test VALUES('The giant tripped on the fence')

CREATE FUNCTION dbo.Split
(
    @RowData nvarchar(2000),
    @SplitOn nvarchar(5)
)  
RETURNS @RtnValue table 
(
    Id int identity(1,1),
    Data nvarchar(100)
) 
AS  
BEGIN 
    Declare @Cnt int
    Set @Cnt = 1

    While (Charindex(@SplitOn,@RowData)>0)
    Begin
        Insert Into @RtnValue (data)
        Select 
            Data = ltrim(rtrim(Substring(@RowData,1,Charindex(@SplitOn,@RowData)-1)))

        Set @RowData = Substring(@RowData,Charindex(@SplitOn,@RowData)+1,len(@RowData))
        Set @Cnt = @Cnt + 1
    End

    Insert Into @RtnValue (data)
    Select Data = ltrim(rtrim(@RowData))

    Return
END

CREATE FUNCTION dbo.SplitAll(@SplitOn nvarchar(5))
RETURNS @RtnValue table
(
    Id int identity(1,1),
    Data nvarchar(100)
)
AS
BEGIN
DECLARE My_Cursor CURSOR FOR SELECT Description FROM dbo.test
DECLARE @description varchar(50)

OPEN My_Cursor
FETCH NEXT FROM My_Cursor INTO @description
WHILE @@FETCH_STATUS = 0
BEGIN
    INSERT INTO @RtnValue
    SELECT Data FROM dbo.Split(@description, @SplitOn)
   FETCH NEXT FROM My_Cursor INTO @description
END
CLOSE My_Cursor
DEALLOCATE My_Cursor

RETURN

END

SELECT DISTINCT Data FROM dbo.SplitAll(N' ') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T06:36:47.647

我刚刚遇到了类似的问题，并尝试使用 SQL CLR 来解决它。可能对某人很方便

```
using System;
using System.Data;
using System.Data.SqlClient;
using System.Data.SqlTypes;
using Microsoft.SqlServer.Server;

using System.Collections;
using System.Collections.Generic;

public partial class UserDefinedFunctions
{
    private class SplitStrings : IEnumerable
    {
        private List<string> splits;

        public SplitStrings(string toSplit, string splitOn)
        {
            splits = new List<string>();

            //  nothing, return empty list
            if (string.IsNullOrEmpty(toSplit))
            {
                return;
            }

            //  return one word
            if (string.IsNullOrEmpty(splitOn))
            {
                splits.Add(toSplit);

                return;
            }

            splits.AddRange(
                toSplit.Split(new string[] { splitOn }, StringSplitOptions.RemoveEmptyEntries)
            );
        }

        #region IEnumerable Members

        public IEnumerator GetEnumerator()
        {
            return splits.GetEnumerator();
        }

        #endregion
    }

    [Microsoft.SqlServer.Server.SqlFunction(FillRowMethodName = "readRow", TableDefinition = "word nvarchar(255)")]
    public static IEnumerable fnc_clr_split_string(string toSplit, string splitOn)
    {
        return new SplitStrings(toSplit, splitOn);
    }

    public static void readRow(object inWord, out SqlString word)
    {
        string w = (string)inWord;

        if (string.IsNullOrEmpty(w))
        {
            word = string.Empty;
            return;
        }

        if (w.Length > 255)
        {
            w = w.Substring(0, 254);
        }

        word = w;
    }
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-27T12:17:13.043

这不是最快的方法，但可能会被某人用于少量数据：

```
declare @tmp table(descr varchar(400))

insert into @tmp
select 'The dog jumped over the fence.'
union select 'The giant tripped on the fence.'

/* the actual doing starts here */
update @tmp
set descr = replace(descr, '.', '') --get rid of dots in the ends of sentences.

declare @xml xml
set @xml = '<c>' + replace(
    (select ' ' + descr
    from @tmp
    for xml path('')
), ' ', '</c><c>') + '</c>'

;with 
allWords as (
    select section.Cols.value('.', 'varchar(250)') words
        from @xml.nodes('/c') section(Cols)
    )
select words
from allWords
where ltrim(rtrim(words)) <> ''
group by words 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T23:13:05.503

在 SQL 本身中，它可能需要一个大的存储过程，但是如果您将所有记录读取到您选择的脚本语言中，您可以轻松地循环它们并将每个记录拆分为数组/散列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T23:02:41.240

这将是一个混乱的存储过程，最后有一个临时表和一个 SELECT DISTINCT。

如果您已经将单词作为记录，您将使用 SELECT DISTINCT [WordsField] from [owner].[tablename]

# tracking - What is the most stable, least intrusive way to track web traffic between two sites?

> ID：106285
> 
> 赞同：0
> 
> 时间：2008-09-19T23:03:34.730
> 
> 标签：tracking, traffic

I need to track traffic between a specific set of web sites. I would then store the number of clicks in a database table with the fields **fromSite**, **toSite**, **day**, **noOfClicks**. The complete urls are unimportant - only web site identity is needed.

I've ruled out *redirects* since I don't want my server to be a single point of failure. I want the links to work even if the tracking application or server is down or overloaded.

Another goal is to minimize the work each participating site has to do in order for the tracking to work.

What would be the best way to solve this problem?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T23:04:44.837

The best way is to use an analytics program like Google Analytics, and to review the reports for each domain.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T23:24:35.600

您是否有权访问所有相关站点的日志？如果是这样，您应该能够从日志文件（Referer 标头）中提取该数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T23:16:55.090

You could place an onclick event on to each link that goes between each site. the onclick would then call some javascript which could do a server call back to register the click.

# c - What is causing a stack overflow?

> ID：106298
> 
> 赞同：6
> 
> 时间：2008-09-19T23:06:42.197
> 
> 标签：c, memory, malloc, stack-overflow

You may think that this is a coincidence that the topic of my question is similar to the name of the forum but I actually got here by googling the term "stack overflow".

I use the OPNET network simulator in which I program using C. I think I am having a problem with big array sizes. It seems that I am hitting some sort of memory allocation limitation. It may have to do with OPNET, Windows, my laptop memory or most likely C language. The problem is caused when I try to use nested arrays with a total number of elements coming to several thousand integers. I think I am exceeding an overall memory allocation limit and I am wondering if there is a way to increase this cap. Here's the exact problem description:

I basically have a routing table. Let's call it routing_tbl[n], meaning I am supporting 30 nodes (routers). Now, for each node in this table, I keep info. about many (hundreds) available paths, in an array called paths[p]. Again, for each path in this array, I keep the list of nodes that belong to it in an array called hops[h]. So, I am using at least nph integers worth of memory but this table contains other information as well. In the same function, I am also using another nested array that consumes almost 40,000 integers as well. As soon as I run my simulation, it quits complaining about stack overflow. It works when I reduce the total size of the routing table. What do you think causes the problem and how can it be solved? Much appreciated Ali

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-19T23:08:42.893

It may help if you post some code. Edit the question to include the problem function and the error.

Meanwhile, here's a very generic answer:

The two principal causes of a stack overflow are 1) a recursive function, or 2) the allocation of a large number of local variables.

**Recursion**

if your function calls itself, like this:

```
int recurse(int number) {

    return (recurse(number));
} 
```

Since local variables and function arguments are stored on the stack, then it will in fill the stack and cause a stack overflow.

**Large local variables**

If you try to allocate a large array of local variables then you can overflow the stack in one easy go. A function like this may cause the issue:

```
void hugeStack (void) {

    unsigned long long reallyBig[100000000][1000000000];

    ...
} 
```

There is quite a detailed answer to this [similar question](https://stackoverflow.com/questions/26158/how-does-a-stack-overflow-occur-and-how-do-you-prevent-it).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T23:27:53.457

不知何故，您使用了很多堆栈。可能的原因包括您正在堆栈上创建路由表，您正在堆栈上传递它，或者您正在生成大量调用（例如，通过递归处理整个事情）。

在前两种情况下，您应该在堆上创建它并传递一个指向它的指针。在第三种情况下，您需要以迭代形式重写您的算法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T23:14:06.437

Stack overflows can happen in C when the number of embedded recursive calls is too high. Perhaps you are calling a function from itself too many times?

This error may also be due to allocating too much memory in static declarations. You can switch to dynamic allocations through malloc() to fix this type of problem.

Is there a reason why you cannot use the debugger on this program?

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T00:38:48.183

这取决于您在哪里声明了变量。

局部变量（即在堆栈上声明的变量受最大帧大小的限制） 这是您正在使用的编译器的限制（通常可以使用编译器标志进行调整）。

动态分配的对象（即堆上的对象）受可用内存量的限制。这是操作系统的一个属性（如果你有一个智能操作系统，技术上可以通过更大的物理内存）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T20:19:08.990

当您使用更多堆栈时，许多操作系统会动态扩展堆栈。当您开始写入刚刚超出堆栈的内存地址时，操作系统会假定您的堆栈刚刚增长了一点，并为其分配了一个额外的页面（通常在 x86 上为 4096Kib - 正好为 1024 个整数）。

问题是，在 x86（和其他一些架构）上，堆栈*向下*增长，但 C 数组*向上*增长。这意味着如果您访问一个大数组的*开头*，您将访问距离堆栈边缘超过一页的内存。

如果*从数组末尾开始*将数组初始化为 0 （没错，创建一个 for 循环来执行此操作），错误可能会消失。如果他们这样做，这确实是问题所在。

您可能能够找到一些 OS API 函数来强制堆栈分配，或编译器编译指示/标志。我不确定如何以便携方式完成此操作，当然使用 malloc() 和 free() 除外！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T13:38:40.727

除非你做了一些特别令人震惊的事情，比如失控的递归或宇宙内存泄漏，否则你不太可能在使用非线程编译的 C 时遇到堆栈溢出。但是，您的模拟器可能有一个线程包，它将施加堆栈大小限制。当您启动一个新线程时，它将为该线程的堆栈分配一块内存。很可能，您可以在某处设置一个参数来建立默认堆栈大小，或者可能有一种方法可以动态增长堆栈。例如，pthreads 有一个函数 pthread_attr_setstacksize() 在启动新线程之前调用它来设置它的大小。您的模拟器可能使用也可能不使用 pthread。请查阅您的模拟器参考文档。

# frameworks - 如何规划企业级 Web 应用程序？

> ID：106299
> 
> 赞同：9
> 
> 时间：2008-09-19T23:06:43.070
> 
> 标签：frameworks

在我的自由职业生涯中，我已经为中小型企业开发了几个 Web 应用程序，这些应用程序支持项目管理、预订/预订和电子邮件管理等内容。

我喜欢这项工作，但发现最终我的应用程序达到了维护的偷听率非常高的地步。我回顾我 6 个月前编写的代码，发现我必须花一些时间重新学习我最初的编码方式，然后才能进行修复或添加功能。我确实尝试练习使用框架（我之前使用过 Zend 框架，并且正在考虑将 Django 用于我的下一个项目）

您使用什么技术或策略来规划一个能够处理大量用户而不会破坏并且仍然保持代码足够干净以便易于维护的应用程序？如果有人有任何可以推荐的书籍或文章，那也将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-19T23:48:25.060

尽管肯定有关于该主题的好文章，但它们都不能替代现实世界的经验。

可维护性不是您可以直接计划的，除非是非常小的项目。这是您在整个项目期间需要注意的事情。事实上，提前创建大量的类和基础设施代码会产生比简单的意大利面条代码更难理解的代码。

所以我的建议是**清理你现有的项目**，不断地重构它们。看看那些很难改变的部分，争取更简单的解决方案，更容易理解和调整。如果代码甚至太糟糕，请考虑从头开始重写。

不要仅仅因为您阅读了更多文章或使用了新框架就开始新项目并期望它们成功。相反，识别*现有*项目的失败并解决其*特定*问题。每当您需要更改代码时，问问自己如何重组它以支持将来的类似更改。无论如何，这是您需要做的，因为*将来*会有类似的变化。

通过进行这些重构，您将偶然发现各种您可以提出并阅读相关文章的*具体问题。*这样，您将学到更多知识，而不仅仅是提出一般性问题和阅读有关维护和框架的一般性文章。

**今天**开始清理你的代码。不要将其推迟到您未来的项目中。

* * *

（文档也是如此。每个人的第一个文档都非常糟糕。几个月后，它们变得过于冗长并且充满了不重要的东西。因此，用解决您*真正*遇到的问题的解决方案来补充文档，因为接下来的机会很好一年你会遇到类似的问题。这些经验将比任何“如何写好”风格指南更能改善你的写作风格。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T23:18:17.007

老实说，我建议您查看 Martin Fowlers [Patterns of Enterprise Application Architecture](https://rads.stackoverflow.com/amzn/click/com/0321127420)。它讨论了许多使您的应用程序更有条理和可维护性的方法。此外，我建议您使用单元测试来更好地理解您的代码。Kent Beck 关于[测试驱动开发](https://rads.stackoverflow.com/amzn/click/com/0321146530)的书是学习如何通过单元测试解决代码更改的重要资源。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-02T12:20:45.127

为了提高可维护性，您可以：

*   如果您是唯一的开发人员，那么采用一种编码风格并坚持下去。这将使您以后在浏览自己的代码时对您可能做过的事情和绝对不会做的事情充满信心。对去哪里寻找、寻找什么和不寻找什么充满信心，这将为您节省大量时间。

*   始终花时间更新文档。将任务纳入发展计划；将该时间作为任何更改或新功能的一部分包含在计划中。

*   保持文档平衡：一些高级图表，有意义的评论。最好的注释说明无法从代码本身中读取。就像某些代码块背后的商业原因或“为什么”。

*   在计划中包括努力保持代码结构、文件夹名称、命名空间、对象、变量和例程名称为最新并反映它们实际所做的事情。这将大大提高可维护性。总是把铁锹称为“铁锹”。避免使用大块代码，通过您选择的语言中可用的方式对其进行结构化，给块赋予有意义的名称。

*   低耦合和高一致性。确保您了解实现这些目标的最新技术：按合同设计、依赖注入、方面、设计模式等。

*   从任务管理的角度来看，您应该为非连续工作估计更多时间并收取更高的费率。不要犹豫，让客户意识到您需要额外的时间来进行随时间推移的小型非连续更改，而不是更大的连续项目和持续维护，因为管理和分析开销更大（您需要管理和分析每个更改，包括影响在现有系统上单独）。您的客户将获得的一项好处是系统的预期寿命更长。另一个是准确的文档，如果他们决定这样做，他们将保留寻求他人帮助的选择权。既保护客户投资，又是强大的卖点。

*   如果您还没有这样做，请使用源代码控制

*   详细记录为客户所做的一切以及任何重要的沟通（简单的计算机或纸质 CMS）。每次作业前刷新你的记忆。

*   记录每个客户未解决的问题、想法和建议；在开始作业之前再次刷新你的记忆。

*   提前计划如何进行实施后支持，与客户讨论。使您的系统易于维护。规划参数化、监控工具、内部健全性检查。作为初始合同的一部分，向客户出售实施后支持。

*   通过招聘进行扩展，即使您只是需要某人来提供实施后的支持，也可以做一些管理工作。

推荐阅读：

*   [史蒂夫麦康奈尔的“代码完成”](http://cc2e.com/)

*   任何有关[设计模式](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))的内容都包含在推荐阅读列表中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T23:28:40.787

在帮助将旧的 Web 应用程序发展为极高可用性、高需求的 Web 应用程序时，我能给出的最重要的建议是封装*所有内容。*- 尤其

1.  使用良好的 MVC 原则和框架将视图层与业务逻辑和数据模型分开。
2.  使用健壮的持久层不将业务逻辑与数据模型耦合
3.  规划无状态和异步行为。

这是一篇关于 eBay 如何解决这些问题的优秀文章 [http://www.infoq.com/articles/ebay-scalability-best-practices](http://www.infoq.com/articles/ebay-scalability-best-practices)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T00:34:08.767

1.  使用框架/MVC 系统。您的代码越有组织和集中越好。

2.  尝试使用内存缓存。PHP 有一个内置的扩展，它需要大约十分钟来设置，另外二十分钟可以放入您的应用程序。你可以缓存任何你想要的东西——我把我所有的数据库记录都缓存在里面——对于每个应用程序。它确实徘徊。

3.  如果您还没有，我建议您使用源代码控制系统，例如 Subversion。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-09-19T23:11:36.913

您应该考虑使用 SharePoint。这是一个已经设计用于完成您所提到的所有功能的环境，并且具有您可能没有想到的许多其他功能（但也许您将来会需要:-)）

[这](http://www.microsoft.com/Sharepoint/default.mspx)是来自官方网站的一些信息。
您可以使用 2 种不同的 SharePoint 环境：Windows Sharepoint Services (WSS) 或 Microsoft Office Sharepoint Server (MOSS)。WSS 是免费的，并且随 Windows Server 2003 一起提供，而 MOSS 不是免费的，但具有更多的功能，几乎涵盖了您企业的所有需求。

# java - 如何在有状态的 Web 应用程序中最好地连接 Seam 和 GWT？

> ID：106310
> 
> 赞同：2
> 
> 时间：2008-09-19T23:10:01.440
> 
> 标签：java, gwt, jboss, seam, java-ee-5

我们有一个使用 GWT 实现的 Web 应用程序。它呈现的内容是使用远程处理机制从 Jboss/Seam 服务器获取的，这很好用。但是，该应用程序现在已扩展为支持会话和用户。Seam GWT 服务似乎没有提供让我登录的方法，以便 Seam 可以将受限数据返回给 GWT 应用程序，因此在我看来，我必须将 GWT 应用程序包装在 facelets 中。

对我来说，使用 Seam 会话机制的登录将帮助我将正确的数据输入 GWT 应用程序对我来说并不明显，所以我的问题是我是否会很幸运并且它会正常工作，或者我是否需要做一些客户端魔术，服务器端魔术，或者我对 Seam GWT 服务中缺少登录功能的看法实际上是错误的。

奖金指向任何可以为我提供显示类似内容的完整示例的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T11:09:36.770

事实证明，事情就像我希望的那样“正常工作”。`Identity.instance().getUsername();`通过使用 Seam 的身份和登录机制，我可以通过从应用程序的 GWT 部分获取请求的服务代码访问当前登录的用户。

我试图`@Restrict`在服务上添加注释，但这似乎不起作用，但是只要我可以根据登录用户向 GWT 应用程序提供结果，这不是不需要的。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-20T01:13:06.247

谷歌代码上的这个完整的 GWT 应用程序怎么样——http: [//code.google.com/p/tocollege-net/](http://code.google.com/p/tocollege-net/)？

# oracle - SQLPlus 设置生成制表符分隔的数据文件

> ID：106323
> 
> 赞同：18
> 
> 时间：2008-09-19T23:14:23.723
> 
> 标签：oracle, tabs, sqlplus

任何人都有一套好的 sqlplus 配置指令来帮助将给定的 sql 查询转换为很好的制表符分隔输出，以便拉入电子表格或进一步处理？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-08-15T15:25:08.867

正如贾斯汀在他的链接中指出的那样，使用`set colsep`函数 SQLPlus 命令可以节省为每列输入分隔符。

但是对于制表符分隔，`set colsep Chr(9)`将不起作用。

对于 UNIX 或 LINUX，使用`set colsep ' '`单引号之间的空格作为键入的制表符。

对于 Windows，请使用以下设置：

```
col TAB# new_value TAB NOPRINT
select chr(9) TAB# from dual;
set colsep "&TAB"

select * from table; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-19T23:49:19.753

我不止一次偷过的一个特定脚本来自 AskTom 线程中关于[将数据提取到平面文件](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:68212348056#74643125201557)中的内容。如果我需要一个快速而肮脏的 SQL*Plus 平面文件。不过，对于任何正在进行的过程，我倾向于更喜欢 Tom 之前在该线程上发布的 DUMP_CSV 函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-12-26T08:02:57.347

我有一个愚蠢的解决方案。它工作得很好。

# 解决方案

```
SELECT column1 || CHR(9) || column2 || CHR(9) || column3 ... ...
FROM table 
```

# 背后的原则

实际上，它只是一个**字符串连接**。

CHR(9) **->** '\t'

第 1 列 || CHR(9) || column2 **->** **concat(column1, '\t', column2)**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-08-09T11:43:17.263

制表符是不可见的，但是，如果您键入以下内容：-

设置colsep Z

但不是 Z，而是按键盘上的 TAB 键，然后按 Enter，它可以工作。SQLPlus 知道空格（不可见的制表符）之后的下一个字符是 colsep。

我已将所有设置放入名为 /cli.sql 的文件中，所以我只是这样做：-

@/cli.sql

加载它们。

```
set serveroutput on
SET NEWPAGE NONE
set feedback off
set echo off
set feedback off
set heading off
set colsep  
set pagesize 0 
SET UNDERLINE OFF
set pagesize 50000
set linesize 32767
connect use/password 
```

（注意 - 在行尾的不可见空格之后有一个不可见的选项卡：）

```
set colsep 
```

享受！

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-09-19T23:31:42.073

查看 Oracle 文档：

*   [格式化 SQLPlus 报告](http://68.142.116.68/docs/cd/B19306_01/server.102/b14357/ch6.htm#i1081008)
*   [从 SQLPlus 生成 HTML 报告](http://68.142.116.68/docs/cd/B19306_01/server.102/b14357/ch7.htm#sthref1452)

您可以使用选项卡的 ASCII 值 9 和 chr 函数在 Oracle 中生成选项卡：

```
select chr(9) from dual; 
```

# c# - Is there a case where delegate syntax is preferred over lambda expression for anonymous methods?

> ID：106324
> 
> 赞同：12
> 
> 时间：2008-09-19T23:14:44.517
> 
> 标签：c#, .net-3.5, delegates, lambda, anonymous-methods

With the advent of new features like lambda expressions (inline code), does it mean we dont have to use delegates or anonymous methods anymore? In almost all the samples I have seen, it is for rewriting using the new syntax.

Any place where we still have to use delegates and lambda expressions won't work?

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-20T00:00:29.180

是的，有些地方直接使用匿名委托和 lambda 表达式是行不通的。

如果方法采用无类型委托，则编译器不知道将匿名委托/lambda 表达式解析为什么，您将收到编译器错误。

```
public static void Invoke(Delegate d)
{
  d.DynamicInvoke();
}

static void Main(string[] args)
{
  // fails
  Invoke(() => Console.WriteLine("Test"));

  // works
  Invoke(new Action(() => Console.WriteLine("Test")));

  Console.ReadKey();
} 
```

失败的代码行将得到编译器错误“无法将 lambda 表达式转换为类型 'System.Delegate'，因为它不是委托类型”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-19T23:20:11.277

lambda is shortcut for anonymous delegate, but you will always be using delegates. the delegate specifies the methods signature. you can just do this:

```
 delegate(int i) { Console.WriteLine(i.ToString()) } 
```

can be replaced with

```
f => Console.WriteLine(f.ToString()) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-29T15:51:20.027

Lambda 表达式不是（也不打算成为）替代（隐藏）委托的灵丹妙药。非常适合当地的小事，例如：

```
List<string> names = GetNames();
names.ForEach(Console.WriteLine); 
```

1.  它使代码更具可读性，因此易于理解。
2.  它使代码更短，从而减少了我们的工作量；）

另一方面，滥用它们非常简单。长或/和复杂的 lambda 表达式往往是：

1.  新开发者难以理解
2.  较少面向对象
3.  更难阅读

那么“这是否意味着我们不必再使用委托或匿名方法了？” 不——在你赢得时间/可读性的地方使用 Lambda 表达式，否则考虑使用委托。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-27T22:33:07.787

委托在 C# 中有两种含义。

关键字`delegate`可用于定义函数签名类型。这通常在定义高阶函数的签名时使用，即以其他函数作为参数的函数。这种委托的使用仍然是相关的。

该`delegate`关键字还可用于定义内联匿名函数。在函数只是单个表达式的情况下，lambda 语法是一种更简单的替代方案。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-19T23:22:13.970

Lambda 表达式只是“语法糖”，编译器将为您生成适当的委托。您可以使用 Lutz Roeder 的反射器对此进行调查。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-19T23:27:20.773

lamda 只是代表的语法糖，它们不仅仅是内联的，您可以执行以下操作：

```
s.Find(a =>
{
    if (a.StartsWith("H"))
        return a.Equals("HI");
    else
        return !a.Equals("FOO");
}); 
```

在定义事件时，或者当您有很多参数并且想要实际强类型被调用的方法时，仍然会使用委托。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-07-03T11:29:17.017

旧语法的一个*不太大*`delegate`的优势是，如果您不在方法主体中使用它，则无需指定参数。来自[msdn](http://msdn.microsoft.com/en-us/library/0yw3tz5k.aspx)

> 在一种情况下，匿名方法提供了 lambda 表达式中没有的功能。匿名方法使您能够省略参数列表。这意味着可以将匿名方法转换为具有各种签名的委托。这对于 lambda 表达式是不可能的。

例如，您可以这样做：

```
Action<int> a = delegate { }; //takes 1 argument, but not specified on the RHS 
```

虽然这失败了：

```
Action<int> a = => { }; //omitted parameter, doesnt compile. 
```

这种技术在编写事件处理程序时非常方便，例如：

```
button.onClicked += delegate { Console.WriteLine("clicked"); }; 
```

这不是一个*强大*的优势。最好总是采用较新的语法，恕我直言。

# c# - 如何以编程方式识别对 C# 方法的引用数量

> ID：106329
> 
> 赞同：6
> 
> 时间：2008-09-19T23:15:18.480
> 
> 标签：c#, refactoring

我最近继承了需要修剪和清理的 C# 控制台应用程序。长话短说，该应用程序由一个包含超过 110,000 行代码的类组成。是的，一个类中超过 110,000 行。当然，该应用程序是我们业务的核心，它全天候运行更新动态网站上使用的数据。尽管有人告诉我我的前任是“一个非常优秀的程序员”，但很明显他根本不喜欢 OOP（或版本控制）。

无论如何......在熟悉代码的同时，我发现了很多声明但从未引用过的方法。看起来好像复制/粘贴用于对代码进行版本控制，例如说我有一个名为 getSomethingImportant() 的方法，很可能还有另一个名为 getSomethingImortant_July2007() 的方法（在大多数情况下，模式是 functionName_[dateamp]）。看起来当程序员被要求对 getSomethingImportant() 进行更改时，他会复制/粘贴然后重命名为 getSomethingImortant_Date，对 getSomethingImortant_Date 进行更改，然后将代码中的任何方法调用更改为新方法名称，将旧方法留在代码，但从未被引用。

我想编写一个简单的控制台应用程序，它爬过一个巨大的类并返回所有方法的列表以及每个方法被引用的次数。据我估计，有超过 1000 种方法，所以手工完成需要一段时间。

.NET 框架中是否有可用于检查此代码的类？或者任何其他有用的工具可以帮助识别已声明但从未引用的方法？

（附带问题：有没有其他人见过这样的 C# 应用程序，一个非常大的类？这或多或少是一个巨大的程序过程，我知道这是我见过的第一个，至少是这个大小。）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-19T23:22:35.590

如果您只需要提取有关您的班级的一些统计信息，您可以尝试使用[NDepend 。](http://www.ndepend.com/)请注意，此工具在内部依赖 Mono.Cecil 来检查程序集。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T17:29:30.923

为了完成*Romain Verdier*的回答，让我们深入了解一下 NDepend 可以为您带来什么。（*免责声明：我是 NDepend 团队的开发人员*）

NDepend 允许使用一些 LINQ 查询来查询您的 .NET 代码。知道哪些方法调用和被其他方法调用，就像编写以下 LINQ 查询一样简单：

```
from m in Application.Methods
select new { m, m.MethodsCalled, m.MethodsCallingMe } 
```

此查询的结果以易于浏览调用者和被调用者的方式呈现（并且它 100% 集成到 Visual Studio 中）。

![NDepend 方法调用者和被调用者](https://i.stack.imgur.com/0w4ml.png)

* * *

还有许多其他 NDepend 功能可以帮助您。例如，您可以*右键单击 Visual Studio > NDepend > 选择方法中的方法... > 正在使用我（直接或间接）* ...

![NDepend Visual Studio 方法右键单击](https://i.stack.imgur.com/0G5nh.png)

生成以下代码查询...

```
from m in Methods 
let depth0 = m.DepthOfIsUsing("NUnit.Framework.Constraints.ConstraintExpression.Property(String)")
where depth0  >= 0 orderby depth0
select new { m, depth0 } 
```

...匹配直接和间接调用者，调用深度（1 表示直接调用者，2 表示直接调用者的调用者，依此类推）。

![NDepend 间接方法调用者](https://i.stack.imgur.com/atV6f.png)

然后通过单击按钮**Export to Graph**，您将获得枢轴方法的调用图（当然也可以反过来，即由特定枢轴方法直接或间接调用的方法）。

![NDepend 调用图](https://i.stack.imgur.com/ZjucL.png)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T23:42:44.793

下载 Resharper 的*免费试用版*。使用 Resharper->Search->Find Usages in File (Ctrl-Shift-F7) 突出显示所有用法。此外，状态栏中将显示一个计数。如果您想搜索多个文件，也可以使用 Ctrl-Alt-F7 进行搜索。

如果您不喜欢这样，请在 Visual Studio (Ctrl-Shift-F) 中对函数名称进行文本搜索，这应该会告诉您在解决方案中找到了多少次，以及它们在哪里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T23:23:16.557

我不认为你想自己写 - 只需购买[NDepend](http://www.ndepend.com/)并使用它的[代码查询语言](http://www.ndepend.com/Features.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T23:28:28.667

[Reflector](http://www.red-gate.com/products/reflector/)中的 Analyzer 窗口可以显示调用方法的位置（Used By）。
听起来要花很长时间才能以这种方式获取信息。
您可能会查看 Reflector 提供的用于编写插件的 API，看看您是否可以通过这种方式完成繁重的分析工作。我希望[代码度量加载项](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=CodeMetrics&referringTitle=Home)的源代码可以告诉您一些有关如何从反射器 API 获取有关方法的信息的信息。

编辑：Reflector 的[代码模型查看器](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=CodeModelViewer&referringTitle=Home)插件也可以提供帮助。这是探索 Reflector API 的好方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T23:29:50.097

.NET 框架本身没有简单的工具可以做到这一点。但是我不认为你真的需要一次未使用的方法列表。正如我所看到的，您只需浏览代码，对于每种方法，您将检查它是否未使用，如果是，则将其删除。我会使用 Visual Studio“查找引用”命令来做到这一点。或者，您可以使用带有“分析”窗口的 Resharper。或者您可以只使用 Visual Studio 代码分析工具来查找所有未使用的私有方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T00:56:48.983

FXCop 有一个规则可以识别未使用的私有方法。因此，您可以将所有方法标记为私有并让它生成一个列表。

如果你想变得更漂亮，FXCop 也有一种语言 [http://www.binarycoder.net/fxcop/](http://www.binarycoder.net/fxcop/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-22T22:01:16.477

如果您不想为 NDepend 掏腰包，因为听起来单个程序集中只有一个类 - 注释掉方法并编译。如果它编译，删除它们 - 你不会有任何继承问题，虚拟方法或类似的东西。我知道这听起来很原始，但有时重构只是像这样繁重的工作。这有点假设您在每次构建后运行单元测试，直到您清理了代码（红/绿/重构）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T23:17:38.347

我不知道为处理这种特定情况而构建的任何东西，但您可以使用 Mono.Cecil。反映程序集，然后计算 IL 中的引用。应该不会太硬。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-20T00:17:24.757

尝试让编译器发出汇编程序文件，如 x86 指令，而不是 .NET 程序集。

为什么？因为解析汇编代码比解析 C# 代码或 .NET 程序集要容易得多。

例如，函数/方法声明看起来像这样：

```
 .string "w+"
    .text
    .type   create_secure_tmpfile, @function
create_secure_tmpfile:
    pushl   %ebp
    movl    %esp, %ebp
    subl    $24, %esp
    movl    $-1, -8(%ebp)
    subl    $4, %esp 
```

和函数/方法引用看起来像这样：

```
 subl    $12, %esp
    pushl   24(%ebp)
    call    create_secure_tmpfile
    addl    $16, %esp
    movl    20(%ebp), %edx
    movl    %eax, (%edx) 
```

当您看到“create_secure_tmpfile:”时，您知道您有一个函数/方法声明，当您看到“call create_secure_tmpfile”时，您知道您有一个函数/方法引用。这对于您的目的可能已经足够了，但如果不是这样，您只需再执行几个步骤，就可以为整个应用程序生成一个非常可爱的调用树。

# java - 如何找出每个对象在 ArrayList 中的类型? I have a ArrayList made up of different elements imported from a db, made up of strings, numbers, doubles and ints. Is there a way to use a reflection type technique to find out what each type of data ea 问问题 WolfmanDragon 问问题 2008-09-19T23:17:11.720 267792 次 This question shows research effort; it is useful and clear 87 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. I have a ArrayList made up of different elements imported from a db, made up of strings, numbers, doubles and ints. Is there a way to use a reflection type technique to find out what each type of data each element holds? FYI: The reason that there is so many types of data is that this is a piece of java code being written to be implemented with different DB's. Just call .getClass() on each Object in a loop. Unfortunately, Java doesn't have map(). :) javagenericsreflectionarraylist 4 12 回答 12 This answer is useful 101 In C#: Fixed with recommendation from Mike ArrayList list = ...; // List<object> list = ...; foreach (object o in list) { if (o is int) { HandleInt((int)o); } else if (o is string) { HandleString((string)o); } ... } In Java: ArrayList<Object> list = ...; for (Object o : list) { if (o instanceof Integer)) { handleInt((Integer o).intValue()); } else if (o instanceof String)) { handleString((String)o); } ... } 于 2008-09-19T23:20:42.850 回答 This answer is useful 54 You can use the getClass() method, or you can use instanceof. For example for (Object obj : list) { if (obj instanceof String) { ... } } or for (Object obj : list) { if (obj.getClass().equals(String.class)) { ... } } Note that instanceof will match subclasses. For instance, of C is a subclass of A, then the following will be true: C c = new C(); assert c instanceof A; However, the following will be false: C c = new C(); assert !c.getClass().equals(A.class) 于 2008-09-19T23:28:41.300 回答 This answer is useful 45 for (Object object : list) { System.out.println(object.getClass().getName()); } 于 2008-09-19T23:23:24.480 回答 This answer is useful 13 You almost never want you use something like: Object o = ... if (o.getClass().equals(Foo.class)) { ... } because you aren't accounting for possible subclasses. You really want to use Class#isAssignableFrom: Object o = ... if (Foo.class.isAssignableFrom(o)) { ... } 于 2008-09-21T00:04:18.213 回答 This answer is useful 5 In Java just use the instanceof operator. This will also take care of subclasses. ArrayList<Object> listOfObjects = new ArrayList<Object>(); for(Object obj: listOfObjects){ if(obj instanceof String){ }else if(obj instanceof Integer){ }etc... } 于 2011-10-13T14:35:50.970 回答 This answer is useful 5 import java.util.ArrayList; /** * @author potter * */ public class storeAny { /** * @param args */ public static void main(String[] args) { // TODO Auto-generated method stub ArrayList<Object> anyTy=new ArrayList<Object>(); anyTy.add(new Integer(1)); anyTy.add(new String("Jesus")); anyTy.add(new Double(12.88)); anyTy.add(new Double(12.89)); anyTy.add(new Double(12.84)); anyTy.add(new Double(12.82)); for (Object o : anyTy) { if(o instanceof String){ System.out.println(o.toString()); } else if(o instanceof Integer) { System.out.println(o.toString()); } else if(o instanceof Double) { System.out.println(o.toString()); } } } } 于 2013-02-15T14:42:23.603 回答 This answer is useful 4 Just call .getClass() on each Object in a loop. Unfortunately, Java doesn't have map(). :) 于 2008-09-19T23:20:35.267 回答 This answer is useful 3 Instanceof works if you don't depend on specific classes, but also keep in mind that you can have nulls in the list, so obj.getClass() will fail, but instanceof always returns false on null. 于 2008-09-20T00:04:53.990 回答 This answer is useful 3 Since Java 8 mixedArrayList.forEach((o) -> { String type = o.getClass().getSimpleName(); switch (type) { case "String": // treat as a String break; case "Integer": // treat as an int break; case "Double": // treat as a double break; ... default: // whatever } }); 于 2015-05-10T11:12:57.727 回答 This answer is useful 2 instead of using object.getClass().getName() you can use object.getClass().getSimpleName(), because it returns a simple class name without a package name included. for instance, Object[] intArray = { 1 }; for (Object object : intArray) { System.out.println(object.getClass().getName()); System.out.println(object.getClass().getSimpleName()); } gives, java.lang.Integer Integer 于 2015-02-05T18:06:26.443 回答 This answer is useful 0 You say "this is a piece of java code being written", from which I infer that there is still a chance that you could design it a different way. Having an ArrayList is like having a collection of stuff. Rather than force the instanceof or getClass every time you take an object from the list, why not design the system so that you get the type of the object when you retrieve it from the DB, and store it into a collection of the appropriate type of object? Or, you could use one of the many data access libraries that exist to do this for you. 于 2008-09-20T01:11:36.280 回答 This answer is useful 0 If you expect the data to be numeric in some form, and all you are interested in doing is converting the result to a numeric value, I would suggest: for (Object o:list) { Double.parseDouble(o.toString); } 于 2008-12-11T14:56:40.033 回答 Related 1 javascript - 使用 Cytoscape.js 添加边缘标签 1 mysql - 如何找到计数最高的对象的数量？ 1 ruby-on-rails-3 - 回形针和 Phusion 乘客 NoHandlerError 2 php - 如何向新注册用户发送确认电子邮件？ 1 drupal - Drupal7 在提交时将文件字段复制到另一个节点 2 ios - 当我应用旋转和变换时，iOS 上的图像变得狭窄和挤压 1 php - 如何使用 htaccess 创建一个虚假的子域？ 2 php - 通过具有相同结果的两个变量过滤sql搜索 1 php - 在 rss 提要中使用一次而不是 foreach？ 1 c# - Chrome 中 RSS 源的空白页 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：106336
> 
> 赞同：87
> 
> 时间：
> 
> 标签：java, generics, reflection, arraylist

I have a ArrayList made up of different elements imported from a db, made up of strings, numbers, doubles and ints. Is there a way to use a reflection type technique to find out what each type of data each element holds?

FYI: The reason that there is so many types of data is that this is a piece of java code being written to be implemented with different DB's.

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-09-19T23:20:42.850

In C#:
Fixed with recommendation from [Mike](https://stackoverflow.com/users/14359/mike-brown)

```
ArrayList list = ...;
// List<object> list = ...;
foreach (object o in list) {
    if (o is int) {
        HandleInt((int)o);
    }
    else if (o is string) {
        HandleString((string)o);
    }
    ...
} 
```

In Java:

```
ArrayList<Object> list = ...;
for (Object o : list) {
    if (o instanceof Integer)) {
        handleInt((Integer o).intValue());
    }
    else if (o instanceof String)) {
        handleString((String)o);
    }
    ...
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-19T23:28:41.300

You can use the `getClass()` method, or you can use instanceof. For example

```
for (Object obj : list) {
  if (obj instanceof String) {
   ...
  }
} 
```

or

```
for (Object obj : list) {
 if (obj.getClass().equals(String.class)) {
   ...
 }
} 
```

Note that instanceof will match subclasses. For instance, of `C` is a subclass of `A`, then the following will be true:

```
C c = new C();
assert c instanceof A; 
```

However, the following will be false:

```
C c = new C();
assert !c.getClass().equals(A.class) 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-09-19T23:23:24.480

```
for (Object object : list) {
    System.out.println(object.getClass().getName());
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-21T00:04:18.213

You almost never want you use something like:

```
Object o = ...
if (o.getClass().equals(Foo.class)) {
    ...
} 
```

because you aren't accounting for possible subclasses. You really want to use Class#isAssignableFrom:

```
Object o = ...
if (Foo.class.isAssignableFrom(o)) {
    ...
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-10-13T14:35:50.970

In Java just use the instanceof operator. This will also take care of subclasses.

```
ArrayList<Object> listOfObjects = new ArrayList<Object>();
for(Object obj: listOfObjects){
   if(obj instanceof String){
   }else if(obj instanceof Integer){
   }etc...
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-02-15T14:42:23.603

```
import java.util.ArrayList;

/**
 * @author potter
 *
 */
public class storeAny {

    /**
     * @param args
     */
    public static void main(String[] args) {
        // TODO Auto-generated method stub

        ArrayList<Object> anyTy=new ArrayList<Object>();
        anyTy.add(new Integer(1));
        anyTy.add(new String("Jesus"));
        anyTy.add(new Double(12.88));
        anyTy.add(new Double(12.89));
        anyTy.add(new Double(12.84));
        anyTy.add(new Double(12.82));

        for (Object o : anyTy) {
            if(o instanceof String){
                System.out.println(o.toString());
            } else if(o instanceof Integer) {
                System.out.println(o.toString());   
            } else if(o instanceof Double) {
                System.out.println(o.toString());
            }
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-19T23:20:35.267

Just call `.getClass()` on each `Object` in a loop.

Unfortunately, Java doesn't have `map()`. :)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-20T00:04:53.990

Instanceof works if you don't depend on specific classes, but also keep in mind that you can have nulls in the list, so obj.getClass() will fail, but instanceof always returns false on null.

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-05-10T11:12:57.727

Since Java 8

```
 mixedArrayList.forEach((o) -> {
            String type = o.getClass().getSimpleName();
            switch (type) {
                case "String":
                    // treat as a String
                    break;
                case "Integer":
                    // treat as an int
                    break;
                case "Double":
                    // treat as a double
                    break;
                ...
                default:
                    // whatever
            }
        }); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-02-05T18:06:26.443

instead of using `object.getClass().getName()` you can use `object.getClass().getSimpleName()`, because it returns a simple class name without a package name included.

for instance,

```
Object[] intArray = { 1 }; 

for (Object object : intArray) { 
    System.out.println(object.getClass().getName());
    System.out.println(object.getClass().getSimpleName());
} 
```

gives,

```
java.lang.Integer
Integer 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T01:11:36.280

You say "this is a piece of java code being written", from which I infer that there is still a chance that you could design it a different way.

Having an ArrayList is like having a collection of stuff. Rather than force the instanceof or getClass every time you take an object from the list, why not design the system so that you get the type of the object when you retrieve it from the DB, and store it into a collection of the appropriate type of object?

Or, you could use one of the many data access libraries that exist to do this for you.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-11T14:56:40.033

If you expect the data to be numeric in some form, and all you are interested in doing is converting the result to a numeric value, I would suggest:

```
for (Object o:list) {
  Double.parseDouble(o.toString);
} 
```

# c++ - 使用许可文件保护 DLL 文件

> ID：106347
> 
> 赞同：14
> 
> 时间：2008-09-19T23:19:58.263
> 
> 标签：c++, dll, licensing

使用许可证文件保护 DLL 的使用/加载的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T07:21:43.257

您可能需要考虑以下几点：

检查总和 DLL。使用[加密散列函数](http://en.wikipedia.org/wiki/Cryptographic_hash_function)，您可以将其存储在许可证文件或 DLL 中。这提供了一种验证方法来确定我的原始 DLL 文件是否未被破解，或者它是否是该 DLL 的许可文件。一些简单的字节交换技术可以迅速让你的散列函数脱离常规（因此不容易重现）。

不要将散列存储为字符串，将其拆分为不同位置的无符号短裤。

正如拉里所说，MAC 地址相当普遍。[在The Code Project](http://en.wikipedia.org/wiki/The_Code_Project)上有很多关于如何获得它的示例，但请注意，这些天很容易伪造。

我的建议是使用[私钥/公钥](http://en.wikipedia.org/wiki/Public-key_cryptography)生成许可证。

In short, modes of attack will be binary (modify the instructions of your DLL file) so protect against this, or key generation so make each license user, machine, and even the install specific.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-19T23:21:54.173

您可以在 DllMain() 中检查许可证，如果没有找到就死掉。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T07:06:21.390

它还取决于您的许可证算法如何工作。我建议您考虑使用诸如[Diffie–Hellman 密钥交换](http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)（甚至[RSA](http://en.wikipedia.org/wiki/RSA_%28algorithm%29)）之类的东西来根据某些信息生成某种可以传递给您的用户的公钥/私钥。

（根据应用程序，我知道有一个案例，我为一家公司在合同上编写了许可证代码，他们使用[MAC 地址](http://en.wikipedia.org/wiki/MAC_address)和其他一些数据，对其进行哈希处理，并对哈希进行加密，为他们提供“密钥值”，如果注册号正确）。这确保了密钥文件不能被移动（或提供）到另一台机器，从而“窃取”软件。

如果您想深入挖掘并避免黑客攻击，那完全是“另一个话题……”

# monitoring - 您使用哪些工具来监控 Web 服务？

> ID：106358
> 
> 赞同：3
> 
> 时间：2008-09-19T23:22:52.783
> 
> 标签：monitoring, production

从每秒页面浏览量等基本内容到 cpu 或内存使用等更高级的内容。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-19T23:25:34.197

我想有人在这里问过同样类型的问题[吗](https://stackoverflow.com/questions/18080/best-traffic-performance-usage-monitoring-module#19502)？虽然我不太确定它有多大帮助。

对于 CPU 使用率等，我会尝试[RRDTool](http://oss.oetiker.ch/rrdtool/)，或者类似[Cacti](http://www.cacti.net/)的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T23:26:24.240

网络服务或网站？既然你提到页面浏览量：我相信你的意思是网站。

谷歌分析可能会为您提供跟踪使用统计数据所需的一切，最重要的是在大多数情况下是免费的。

您可能还想监控站点的正常运行时间，并在站点由于某种原因关闭时发送电子邮件警报。我们过去使用过 Nagios，它工作得很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T03:05:38.143

我也投票支持[monit](http://www.tildeslash.com/monit/)。好处是它了解 apache 状态信息，并且可以在 80% 的最大 apache 工作人员处于“忙碌”状态时通知/采取行动。

但是你需要其他东西来进行硬件和一般监控，一些支持 SNMP 的东西，比如 zennos 或 zabbix

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T03:22:25.670

[Munin](http://munin.projects.linpro.no/)和[Cacti](http://www.cacti.net/)为 rrdtool 提供了非常好的接口和预构建的脚本。他们还可以监控多台服务器并通过 naigos 发出警告和警报。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T23:34:08.120

多年来，我一直在使用 monit ( [http://www.tildeslash.com/monit/](http://www.tildeslash.com/monit/) )。它监控 CPU 和内存使用情况以及 apache/mysql/etc 的停机时间......您还可以将其配置为通知您中断并实时自动重启服务。

我还使用 munin 进行报告： http: [//munin.projects.linpro.no/](http://munin.projects.linpro.no/)

如果你想要关于页面浏览量的报告等等，[AWStats](http://awstats.sourceforge.net/)是我用过的最好的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T02:32:27.710

我在 Linux 上使用[Nagios](http://www.nagios.org)进行一般机器监控，并且我几乎依赖[Google Analytics](http://google.com/analytics)进行网站报告——我知道这并不适合所有人，因为有些人担心将所有网站数据提供给 Google。

两者都是免费且易于安装的（Nagios 通常可通过 apt-get 获得，而 Analytics 是在站点上非常容易安装的）。

然而，Nagios 可能难以配置。

# java - 在 Java 中将非 ASCII 文件名添加到 zip

> ID：106367
> 
> 赞同：19
> 
> 时间：2008-09-19T23:25:24.960
> 
> 标签：java, encoding, zip

使用**Java将****非 ASCII**文件名添加到**zip 文件**的最佳方法是什么，以便可以在**Windows**和**Linux 中正确读取文件？**

 ******这是一种尝试，改编自[https://truezip.dev.java.net/tutorial-6.html#Example](https://truezip.dev.java.net/tutorial-6.html#Example)，它适用于 Windows Vista 但在 Ubuntu Hardy 中失败。在 Hardy 中，文件名在 file-roller 中显示为 abc-ЖДФ.txt。

```
import java.io.IOException;
import java.io.PrintStream;

import de.schlichtherle.io.File;
import de.schlichtherle.io.FileOutputStream;

public class Main {

    public static void main(final String[] args) throws IOException {

        try {
            PrintStream ps = new PrintStream(new FileOutputStream(
                    "outer.zip/abc-åäö.txt"));
            try {
                ps.println("The characters åäö works here though.");
            } finally {
                ps.close();
            }
        } finally {
            File.umount();
        }
    }
} 
```

与 java.util.zip 不同，truezip 允许指定 zip 文件编码。这是另一个示例，这次明确指定了编码。IBM437、UTF-8 和 ISO-8859-1 在 Linux 中都不起作用。IBM437 在 Windows 中工作。

```
import java.io.IOException;

import de.schlichtherle.io.FileOutputStream;
import de.schlichtherle.util.zip.ZipEntry;
import de.schlichtherle.util.zip.ZipOutputStream;

public class Main {

    public static void main(final String[] args) throws IOException {

        for (String encoding : new String[] { "IBM437", "UTF-8", "ISO-8859-1" }) {
            ZipOutputStream zipOutput = new ZipOutputStream(
                    new FileOutputStream(encoding + "-example.zip"), encoding);
            ZipEntry entry = new ZipEntry("abc-åäö.txt");
            zipOutput.putNextEntry(entry);
            zipOutput.closeEntry();
            zipOutput.close();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-14T11:38:46.793

ZIP 中文件条目的编码最初指定为 IBM Code Page 437。其他语言中使用的许多字符不可能以这种方式使用。

[PKWARE-specification](http://www.pkware.com/documents/casestudies/APPNOTE.TXT)提到了这个问题并添加了一点。但这是后来添加的（从 2007 年开始，感谢 Cheeso 的清理，请参阅评论）。如果设置了该位，则文件名条目必须以 UTF-8 编码。此扩展在链接文档末尾的“附录 D - 语言编码 (EFS)”中进行了描述。

对于 Java，这是一个已知的错误，会遇到非 ASCII 字符的麻烦。请参阅[错误 #4244499](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4244499)和大量相关错误。

我的同事在将文件名存储到 ZIP 并在读取文件后解码之前用作文件名的解决方法 URL-Encoding。如果您同时控制存储和读取，这可能是一种解决方法。

编辑：在错误中，有人建议使用 Apache Ant 的 ZipOutputStream 作为解决方法。此实现允许指定编码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-04T03:49:48.107

在 Zip 文件中，根据 PKWare 拥有的规范，文件名和文件注释的编码是 IBM437。2007 年，PKWare 扩展了规范，也允许使用 UTF-8。这并没有说明 zip 中包含的文件的编码。只有文件名的编码。

我认为所有工具和库（Java 和非 Java）都支持 IBM437（它是 ASCII 的超集），支持 UTF-8 的工具和库较少。一些工具和库支持其他代码页。例如，如果您在上海运行的计算机上使用 WinRar 压缩某些内容，您将获得 Big5 代码页。这不是 zip 规范“允许”的，但无论如何都会发生。

.NET的[DotNetZip](http://dotnetzip.codeplex.com)库支持 Unicode，但如果您使用 Java，这当然对您没有帮助！

使用对 ZIP 的 Java 内置支持，您将始终获得 IBM437。如果您想要一个包含 IBM437 以外的东西的存档，那么请使用第三方库，或者创建一个 JAR。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-07-28T11:26:52.740

奇迹确实发生了，Sun/Oracle 确实修复了长期存在的错误/rfe：

现在可以在创建zip 文件/流[时设置文件名编码（](http://www.docjar.org/html/api/java/util/zip/ZipOutputStream.java.html#121)**需要 Java 7**）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-12-17T16:03:36.160

您仍然可以使用 Apache Commons 的 zip 流实现：[http ://commons.apache.org/compress/apidocs/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.html#setEncoding%28java.lang.String %29](http://commons.apache.org/compress/apidocs/org/apache/commons/compress/archivers/zip/ZipArchiveOutputStream.html#setEncoding%28java.lang.String%29)

在您的流上调用 setEncoding("UTF-8") 就足够了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T00:09:01.750

快速浏览一下 TrueZIP[手册](https://truezip.dev.java.net/manual-6.html)- 他们推荐 JAR 格式：

> 它使用 UTF-8 进行文件名编码和注释 - 不像 ZIP，它只使用 IBM437。

这可能意味着 API 正在使用[java.util.zip](http://java.sun.com/javase/6/docs/api/java/util/zip/package-summary.html)包来实现它；该文档指出，它仍然使用[1996 年的 ZIP 格式](ftp://ftp.uu.net/pub/archiving/zip/doc/appnote-970311-iz.zip)。直到 2006 年，Unicode 支持才被添加到[PKWARE .ZIP 文件格式规范中。](http://www.pkware.com/documents/casestudies/APPNOTE.TXT)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T23:29:16.370

它真的失败了还是只是字体问题？（例如，这些字符代码具有不同字形的字体） 我在 Windows 中看到了类似的问题，因为字体不支持字符集，但数据实际上是完整且正确的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-19T23:47:22.083

非 ASCII 文件名在 ZIP 实现中不可靠，最好避免使用。没有规定在 ZIP 文件中存储字符集设置；客户倾向于猜测“当前系统代码页”，这不太可能是您想要的。客户端和代码页的许多组合可能会导致无法访问的文件。

对不起！

# c# - 在 Windows 窗体中获取多个 UI 线程

> ID：106378
> 
> 赞同：4
> 
> 时间：2008-09-19T23:28:24.813
> 
> 标签：c#, winforms, module

我试图找出一种方法让用户控件在他们自己的 UI 线程中运行。这可能吗？我试图防止基于模块的应用程序由于单个模块而崩溃。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T03:40:39.450

不幸的是，所有 UI 控件都在同一个 UI 线程上运行。因此，在此线程上运行的任何可能导致挂起情况的代码都需要使用某种超时逻辑进行编码。

```
DateTime startTime = DateTime.Now;
while(DateTime.Now.Subtract(startTime).TotalSeconds < 30)
{
     //do something
} 
```

否则，正如 Orlangur 之前所说，所有事件处理程序代码都需要在单独的线程中运行。但是，您仍然需要监视这些线程以确定它们是否运行时间过长并关闭它们。因此，您不妨实现上面的逻辑类型，因为它的工作量要少得多，而且更易于维护。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T23:40:31.290

那是不可能的。但是，对于一些重要的代码，您可以在不同的线程中运行不同的窗口。每个窗口都有自己的消息循环。

更新：

您可以想到的另一种方法是以特殊方式编写控件。您可以通过创建将运行所有逻辑的新线程来处理控件中的所有事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T23:56:45.463

我想这不是程序崩溃的问题。当然可以捕获异常，但问题在于挂起控件。对于这种情况，这里有一个例子：

```
public void Button1_Click(object sender, EventArgs args)
{
     while(true) {}
} 
```

如果此代码在控件中运行，则不会抛出异常，但会挂起。我正在尝试确定一种方法来捕获它并从应用程序中删除控制模块。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-11T15:07:45.167

应该可以在不同的线程中运行控件。一点黑客和Windows覆盖，它应该是可行的。

我在想你可以在另一个线程中创建一个 GUI 控件，然后使用 win api SetParent 将它移动到一个公共窗口（主 gui 线程）。SetParent 可用于“劫持”其他窗口，因此您应该能够以这种方式获取控件。但当然可能存在焦点问题和其他问题，但可能是可行的。

我曾经用它把我自己的按钮放到 MS Messenger 上。

# c# - C# - 可以隐藏公共继承的方法（例如，将其设为派生类私有）

> ID：106383
> 
> 赞同：66
> 
> 时间：2008-09-19T23:29:04.357
> 
> 标签：c#, class, derived

假设我有带有公共方法 A 和 B 的 BaseClass，并且我通过继承创建了 DerivedClass。

例如

```
public DerivedClass : BaseClass {} 
```

现在我想在 DerivedClass 中开发一个使用 A 和 B 的方法 C。有没有一种方法可以在 DerivedClass 中覆盖方法 A 和 B 使其成为私有方法，以便只有方法 C 暴露给想要使用我的 DerivedClass 的人？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-19T23:56:51.000

**这是不可能的，为什么？**

在 C# 中，如果您继承公共方法，则必须将它们公开。否则，他们希望您首先不要从该类派生。

您必须使用 has-a 关系，而不是使用 is-a 关系。

语言设计者故意不允许这样做，以便您更正确地使用继承。

例如，人们可能会不小心将类 Car 混淆为从类 Engine 派生以获得它的功能。但是引擎是汽车使用的功能。所以你会想使用has-a关系。Car 的用户不想访问引擎的界面。Car 本身不应该将 Engine 的方法与它自己的方法混淆。也不是 Car 的未来衍生产品。

因此，他们不允许它保护您免受不良继承层次结构的影响。

**你应该怎么做？**

相反，您应该实现接口。这使您可以自由地使用具有关系的功能。

**其他语言：**

在 C++ 中，您只需在私有、公共或受保护的基类之前指定一个修饰符。这使得对指定访问级别公开的所有基础成员。对我来说，你不能在 C# 中做同样的事情似乎很愚蠢。

**重组后的代码：**

```
interface I
{
    void C();
}

class BaseClass
{
    public void A() { MessageBox.Show("A"); }
    public void B() { MessageBox.Show("B"); }
}

class Derived : I
{
    public void C()
    {
        b.A();
        b.B();
    }

    private BaseClass b;
} 
```

我知道上述类的名称有点没有实际意义:)

**其他建议：**

其他人建议公开 A() 和 B() 并抛出异常。但这并不能为人们提供一个友好的课程，也没有任何意义。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2010-07-01T10:06:57.593

例如，当您尝试从 a 继承`List<object>`，并且想要隐藏直接`Add(object _ob)`成员时：

```
// the only way to hide
[Obsolete("This is not supported in this class.", true)]
public new void Add(object _ob)
{
    throw NotImplementedException("Don't use!!");
} 
```

这并不是最可取的解决方案，但它确实可以完成工作。Intellisense 仍然接受，但在编译时会出现错误：

> 错误 CS0619：“TestConsole.TestClass.Add(TestConsole.TestObject)”已过时：“此类不支持。”

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-19T23:35:43.187

这听起来是个坏主意。[利斯科夫](http://en.wikipedia.org/wiki/Liskov_substitution_principle)不会留下深刻印象。

如果您不希望 DerivedClass 的消费者能够访问方法 DeriveClass.A() 和 DerivedClass.B() 我建议 DerivedClass 应该实现一些公共接口 IWhateverMethodCIsAbout 并且 DerivedClass 的消费者实际上应该与 IWhateverMethodCIsAbout 交谈并知道根本没有关于 BaseClass 或 DerivedClass 的实现。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-20T05:18:18.887

**你需要的是组合而不是继承。**

```
class Plane
{
  public Fly() { .. }
  public string GetPilot() {...}
} 
```

现在，如果您需要一种特殊的飞机，例如具有 PairOfWings = 2 的飞机，但除此之外，飞机可以做的一切......您继承飞机。通过这种方式，您声明您的派生符合基类的约定，并且可以在需要基类的任何地方进行替换而不会闪烁。例如 LogFlight(Plane) 将继续使用 BiPlane 实例。

但是，如果您只需要为要创建的新 Bird 的 Fly 行为而不愿意支持完整的基类契约，则可以改用 compose。在这种情况下，重构方法的行为以重用为新类型 Flight。现在在 Plane 和 Bird 中创建并保存对此类的引用。你不继承是因为 Bird 不支持完整的基类契约……（例如它不能提供 GetPilot() ）。

出于同样的原因，**您不能在覆盖时降低基类方法的可见性。**您可以在派生中覆盖并公开基类私有方法，但反之则不行。例如，在这个例子中，如果我派生出一种平面“BadPlane”，然后覆盖并“隐藏”GetPilot() - 将其设为私有；客户端方法 LogFlight(Plane p) 将适用于大多数飞机，但如果 LogFlight 的实现碰巧需要/调用 GetPilot()，则会因“BadPlane”而崩溃。**由于基类的所有派生都被期望在需要基类参数的任何地方都是“可替换的”，因此必须禁止这样做。**

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-19T23:34:33.423

**@Brian R. Bondy 向我指出了一篇关于通过继承和新**关键字隐藏的有趣文章。

[http://msdn.microsoft.com/en-us/library/aa691135(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa691135(VS.71).aspx)

因此，作为解决方法，我建议：

```
class BaseClass
{
    public void A()
    {
        Console.WriteLine("BaseClass.A");
    }

    public void B()
    {
        Console.WriteLine("BaseClass.B");
    }
}

class DerivedClass : BaseClass
{
    new public void A()
    {
        throw new NotSupportedException();
    }

    new public void B()
    {
        throw new NotSupportedException();
    }

    public void C()
    {
        base.A();
        base.B();
    }
} 
```

这样的代码将抛出**NotSupportedException**：

```
 DerivedClass d = new DerivedClass();
    d.A(); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-19T23:31:32.777

我知道的唯一方法是使用 Has-A 关系并仅实现您想要公开的功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T03:13:36.533

隐藏是一个很滑的斜坡。IMO 的主要问题是：

*   它取决于实例的设计时声明类型，这意味着如果您执行 BaseClass obj = new SubClass() 之类的操作，然后调用 obj.A()，隐藏就会失败。BaseClass.A() 将被执行。

*   隐藏可以很容易地掩盖基本类型中的行为（或行为变化）。当您拥有等式的两边，或者调用“base.xxx”是您的子成员的一部分时，这显然不那么令人担忧。

*   如果您确实*拥有*基本/子类等式的两边，那么您应该能够设计出比制度化隐藏/隐藏更易于管理的解决方案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T04:54:10.147

我想说，如果你有一个你想要做的代码库，它不是设计最好的代码库。它通常表示层次结构的一个级别中的一个类需要某个公共签名，而从该类派生的另一个类不需要它。

即将出现的编码范例称为“组合优于继承”。这直接体现了面向对象开发的原则（尤其是单一职责原则和开放/封闭原则）。

不幸的是，我们很多开发人员被教导面向对象的方式，我们已经养成了立即考虑继承而不是组合的习惯。我们倾向于拥有具有许多不同职责的更大类，这仅仅是因为它们可能包含在同一个“真实世界”对象中。这可能导致 5 级以上的类层次结构。

开发人员在处理继承时通常不会考虑的一个不幸的副作用是，继承形成了您可以引入代码中的最强依赖形式之一。您的派生类现在强烈依赖于它继承自的类。从长远来看，这会使您的代码更加脆弱，并导致令人困惑的问题，即更改基类中的特定行为会以模糊的方式破坏派生类。

分解代码的一种方法是通过另一个答案中提到的接口。无论如何，这是一件明智的事情，因为您希望类的外部依赖项绑定到抽象，而不是具体/派生类型。这允许您在不更改接口的情况下更改实现，所有这些都不会影响依赖类中的一行代码。

我宁愿维护一个包含数百/数千/甚至更多类的系统，这些类都是小而松耦合的，而不是处理一个大量使用多态性/继承并且具有更少类更紧密耦合的系统。

也许关于面向对象开发的**最佳资源是 Robert C. Martin 的书，**[敏捷软件开发、原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0135974445)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T23:31:03.697

如果它们在原始类中定义为公共的，则不能在派生类中将它们覆盖为私有。但是，您可以使公共方法抛出异常并实现您自己的私有函数。

编辑：豪尔赫费雷拉是正确的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-27T10:52:13.287

虽然这个问题的答案是“不”，但我想为其他到达这里的人指出一个提示（鉴于 OP 有点暗示第 3 方的装配访问权）。当其他人引用程序集时，Visual Studio 应该尊重以下属性，因此它不会在智能感知中显示（隐藏，但仍然可以调用，所以要小心）：

```
[System.ComponentModel.EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)] 
```

如果您别无选择，您应该能够`new`在隐藏基类型方法的方法上使用 return `=> throw new NotSupportedException();`，并将其与上面的属性结合起来。

另一个技巧取决于尽可能不从基类继承，其中基类具有相应的接口（例如`IList<T>`for `List<T>`）。“显式”实现接口还将在类类型上对智能感知隐藏这些方法。例如：

```
public class GoodForNothing: IDisposable
{
    void IDisposable.Dispose() { ... }
} 
```

在 的情况下`var obj = new GoodForNothing()`，该`Dispose()`方法将不可用`obj`。但是，任何显式类型转换`obj`为`IDisposable`.

此外，您还可以包装一个基类型而不是从它继承，然后隐藏一些方法：

```
public class MyList<T> : IList<T>
{
    List<T> _Items = new List<T>();
    public T this[int index] => _Items[index];
    public int Count => _Items.Count;
    public void Add(T item) => _Items.Add(item);
    [System.ComponentModel.EditorBrowsable(System.ComponentModel.EditorBrowsableState.Never)]
    void ICollection<T>.Clear() => throw new InvalidOperationException("No you may not!"); // (hidden)
    /*...etc...*/
} 
```

# bash - 是否可以在 bash 脚本中检测 32 位和 64 位？

> ID：106387
> 
> 赞同：71
> 
> 时间：2008-09-19T23:29:36.963
> 
> 标签：bash

我正在编写一个 bash 脚本以自动方式处理一些安装...我有可能以 32 位或 64 位二进制文​​件获取一个这样的程序...是否可以从 bash 检测机器架构，以便我可以选择正确的二进制文件？

这将适用于 Ubuntu 机器。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-09-19T23:37:10.173

```
MACHINE_TYPE=`uname -m`
if [ ${MACHINE_TYPE} == 'x86_64' ]; then
  # 64-bit stuff here
else
  # 32-bit stuff here
fi 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-19T23:33:04.037

做

```
uname -a 
```

给你任何你可以使用的东西？我没有要测试的 64 位机器。

* * *

**迈克·斯通（Mike Stone）的注释：**虽然特别有效，但这是可行的

```
uname -m 
```

将为 64 位提供“x86_64”，为其他 32 位类型提供其他内容（在我的 32 位 VM 中，它是“i686”）。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2011-09-05T12:33:46.593

`getconf LONG_BIT`似乎也能做到这一点，这使得检查这一点变得更加容易，因为它只返回整数而不是一些复杂的表达式。

```
if [ `getconf LONG_BIT` = "64" ]
then
    echo "I'm 64-bit"
else
    echo "I'm 32-bit"
fi 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-12-12T14:20:29.540

小心，在`chroot`ed 32 位环境中，uname 仍然像 64 位主机系统一样回答。

`getconf LONG_BIT`工作正常。

`file /bin/cp`如果您没有 getconf 或任何著名的可执行文件或库都应该可以解决问题（但您可以存储您无法使用的程序，并且可能在这个地方没有）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-10-18T21:01:37.060

您可以使用以下脚本（我从“ioquake3”的官方脚本中提取此脚本）：例如

```
archs=`uname -m`
case "$archs" in
    i?86) archs=i386 ;;
    x86_64) archs="x86_64 i386" ;;
    ppc64) archs="ppc64 ppc" ;;
esac

for arch in $archs; do
    test -x ./ioquake3.$arch || continue
    exec ./ioquake3.$arch "$@"
done 
```

==================================================== =================================

我正在制作一个脚本来检测“架构”，这是我的简单代码（我将它与 wine 一起使用，对于我的 Windows 游戏，在 Linux 下，每个游戏，我使用不同版本的 WineHQ，从“PlayOnLinux”下载地点。

```
# First Obtain "kernel" name
KERNEL=$(uname -s)

if      [ $KERNEL = "Darwin" ]; then
        KERNEL=mac
elif        [ $Nucleo = "Linux" ]; then
        KERNEL=linux
elif        [ $Nucleo = "FreeBSD" ]; then
        KERNEL=linux
else
        echo "Unsupported OS"
fi

# Second get the right Arquitecture
ARCH=$(uname -m)

if         [ $ARCH = "i386" ]; then
            PATH="$PWD/wine/$KERNEL/x86/bin:$PATH"
            export WINESERVER="$PWD/wine/$KERNEL/x86/bin/wineserver"
            export WINELOADER="$PWD/wine/$KERNEL/x86/bin/wine"
            export WINEPREFIX="$PWD/wine/data"
            export WINEDEBUG=-all:$WINEDEBUG
            ARCH="32 Bits"
    elif    [ $ARCH = "i486" ]; then
            PATH="$PWD/wine/$KERNEL/x86/bin:$PATH"
            export WINESERVER="$PWD/wine/$KERNEL/x86/bin/wineserver"
            export WINELOADER="$PWD/wine/$KERNEL/x86/bin/wine"
            export WINEPREFIX="$PWD/wine/data"
            export WINEDEBUG=-all:$WINEDEBUG
            ARCH="32 Bits"
    elif    [ $ARCH = "i586" ]; then
            PATH="$PWD/wine/$KERNEL/x86/bin:$PATH"
            export WINESERVER="$PWD/wine/$KERNEL/x86/bin/wineserver"
            export WINELOADER="$PWD/wine/$Nucleo/x86/bin/wine"
            export WINEPREFIX="$PWD/wine/data"
            export WINEDEBUG=-all:$WINEDEBUG
            ARCH="32 Bits"
    elif    [ $ARCH = "i686" ]; then
            PATH="$PWD/wine/$KERNEL/x86/bin:$PATH"
            export WINESERVER="$PWD/wine/$KERNEL/x86/bin/wineserver"
            export WINELOADER="$PWD/wine/$KERNEL/x86/bin/wine"
            export WINEPREFIX="$PWD/wine/data"
            export WINEDEBUG=-all:$WINEDEBUG
            ARCH="32 Bits"
         elif [ $ARCH = "x86_64" ]; then
            export WINESERVER="$PWD/wine/$KERNEL/x86_64/bin/wineserver"
            export WINELOADER="$PWD/wine/$KERNEL/x86_64/bin/wine"
            export WINEPREFIX="$PWD/wine/data"
            export WINEDEBUG=-all:$WINEDEBUG
            ARCH="64 Bits"
    else
        echo "Unsoportted Architecture"
fi 
```

==================================================== =================================

**现在我在我的 bash 脚本中使用它，因为在任何发行版中效果更好。**

```
# Get the Kernel Name
Kernel=$(uname -s)
case "$Kernel" in
    Linux)  Kernel="linux"              ;;
    Darwin) Kernel="mac"                ;;
    FreeBSD)    Kernel="freebsd"            ;;
* ) echo "Your Operating System -> ITS NOT SUPPORTED"   ;;
esac

echo
echo "Operating System Kernel : $Kernel"
echo
# Get the machine Architecture
Architecture=$(uname -m)
case "$Architecture" in
    x86)    Architecture="x86"                  ;;
    ia64)   Architecture="ia64"                 ;;
    i?86)   Architecture="x86"                  ;;
    amd64)  Architecture="amd64"                    ;;
    x86_64) Architecture="x86_64"                   ;;
    sparc64)    Architecture="sparc64"                  ;;
* ) echo    "Your Architecture '$Architecture' -> ITS NOT SUPPORTED."   ;;
esac

echo
echo "Operating System Architecture : $Architecture"
echo 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-19T23:44:02.327

```
slot8(msd):/opt # uname -a
Linux slot8a 2.6.21_mvlcge500-electra #1 SMP PREEMPT Wed Jun 18 16:29:33 \
EDT 2008 ppc64 GNU/Linux 
```

请记住，除了 Intel/AMD 之外，还有其他 CPU 架构......

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-19T23:36:33.280

你可以这样做：

```
if $(uname -a | grep 'x86_64'); then
  echo "I'm 64-bit"
else
  echo "I'm 32-bit"
fi 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-19T23:37:15.617

是的，**uname -a**应该可以解决问题。见： http: [//www.stata.com/support/faqs/win/64bit.html](http://www.stata.com/support/faqs/win/64bit.html)。

# flash - Flash切换捕捉

> ID：106395
> 
> 赞同：0
> 
> 时间：2008-09-19T23:31:15.023
> 
> 标签：flash

很久很久以前，在一个遥远的星系中，您曾经可以使用 ctrl 键在 Flash 中切换捕捉。假设您正在将一条线的末端拖到非常靠近另一个对象的位置。你可以很容易地按住 ctrl 键来关闭捕捉并让它在那里很好地关闭而不用捕捉。在某些时候，Macromedia 删除了此功能。

我想知道那个单键切换捕捉功能是否已经在应用程序的其他地方消失了，还是我每次都必须点击菜单？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-20T09:14:17.150

我不认为有，我已经搜索了文档，但找不到任何关于它的信息。奇怪的是，您无法设置用于切换它的键盘快捷键。该选项在那里，但由于某种原因它变灰了。我能做到的最好的办法是为对象捕捉设置一个快捷方式（因为这是我最常使用的），然后切换它。

此外，您无需浏览菜单，工具栏上的磁铁按钮也可以切换捕捉。

# c# - 访问项目资源中的图像？

> ID：106396
> 
> 赞同：2
> 
> 时间：2008-09-19T23:31:21.200
> 
> 标签：c#, .net

如何在运行时访问已添加到项目资源中的图像？

我希望能够做这样的事情：

```
if (value) {
    picBox1.image = Resources.imageA;
}
else 
{
    picBox2.image = Resources.imageB;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T23:42:27.133

something.Image = 命名空间.ProjectName.Properties.Resources.ImageName;

# sql - 获取前 X 名用户，以及特定用户（如果他们不在前 X 名中）

> ID：106400
> 
> 赞同：1
> 
> 时间：2008-09-19T23:33:49.870
> 
> 标签：sql, mysql, database

我有一个排名用户列表，并且想选择前 50 名。我还想确保某个特定用户在此结果集中，即使他们不在前 50 名中。有没有明智的方法这在单个 mysql 查询中？还是我应该只检查特定用户的结果并在必要时单独获取他？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-19T23:39:35.597

如果我理解正确，你可以这样做：

```
select * from users order by max(rank) desc limit 0, 49  
union  
select * from users where user = x 
```

通过这种方式，您可以获得 49 个顶级用户以及您的特定用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T00:58:25.517

无论是否可以进行单个花哨的 SQL 查询，最可维护的代码可能是两个查询：

```
select user from users where id = "fred"; 
select user from users where id != "fred" order by rank limit 49; 
```

当然，“fred”（或任何人）通常会被占位符取代，但具体情况取决于环境。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T01:06:59.100

```
declare @topUsers table(
    userId int primary key,
    username varchar(25)
)
insert into @topUsers
select top 50 
    userId, 
    userName
from Users
order by rank desc

insert into @topUsers
select
    userID,
    userName
from Users
where userID = 1234 --userID of special user

select * from @topUsers 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T01:42:12.197

最简单的解决方案取决于您的要求以及您的数据库支持的内容。

如果您不介意重复结果的可能性，那么一个简单的联合（如 Mariano Conti 所展示的那样）就可以了。

否则，你可以做类似的事情

```
select distinct <columnlist>
from (select * from users order by max(rank) desc limit 0, 49 
      union 
      select * from users where user = x) 
```

如果您的数据库支持它。

# php - 在 PHP 中验证对 WSDL 的传入 SOAP 请求

> ID：106401
> 
> 赞同：12
> 
> 时间：2008-09-19T23:33:56.173
> 
> 标签：php, soap, wsdl, xsd

的内置`PHP`扩展`SOAP`不会验证传入`SOAP`请求中的所有内容`XML Schema`与`WSDL`. 它确实会检查基本实体的存在，但是当你有一些复杂的东西比如`simpleType`限制时，扩展几乎会忽略它们的存在。

验证包含在中的`SOAP`请求的最佳方法是什么？`XML Schema``WSDL`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T08:53:22.520

除了原生 PHP5 SOAP 库之外，我还可以告诉您，目前 PEAR 和 Zend SOAP 库都不会对消息进行模式验证。（不幸的是，我不知道有任何 PHP SOAP 实现。）

我要做的是将 XML 消息加载到[DOMDocument](http://www.php.net/manual/en/class.domdocument.php)对象中，并使用 DOMDocument 的方法来验证架构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-16T09:55:50.490

在这个问题上一直在挖掘一个视图时间。本机 PHP SoapServer 和 NuSOAP 库都不进行任何验证。PHP SoapServer 只是进行类型转换。例如，如果您定义

```
<xsd:element name="SomeParameter" type="xsd:boolean" /> 
```

并提交

```
<get:SomeParameter>dfgdfg</get:SomeParameter> 
```

你会得到 php 类型 boolean (true)

尽管 NuSOAP 识别简单类型，但它只是将所有内容转换为字符串：

从 nuSOAP 调试日志：

```
nusoap_xmlschema: processing typed element SomeParameter of type http://www.w3.org/2001/XMLSchema:boolean 
```

所以最好的方法是 joelhardi 解决方案来验证自己或使用一些 xml 解析器，如 XERCES

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T15:43:06.687

通常不会根据 WSDL 进行验证。如果 WSDL 设计正确，则应该有一个底层 xml 模式 (XSD) 来验证请求的正文。您的 XML 解析器应该能够做到这一点。

其余的取决于您如何实现 Web 服务以及您使用的 SOAP 引擎。我不直接熟悉 PHP 引擎。对于 WSDL/接口级别的“验证”，我通常会这样做：

1.  请求的主体是否与已知的请求类型匹配并且它是否有效（通过 XSD）？
2.  该消息在这种情况下是否有意义，我可以将其映射到操作/处理程序吗？
3.  如果是这样，开始处理它
4.  否则：错误

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2022-01-17T17:02:49.840

使用**本机 SoapServer PHP**有点棘手，但也可以：

```
function validate(string $xmlEnvelope, string $wsdl) : ?array{

    libxml_use_internal_errors(true);

     //extracting schema from WSDL
    $xml = new DOMDocument();
    $wsdl_string = file_get_contents($wsdl);

    //extracting namespaces from WSDL
    $outer = new SimpleXMLElement($wsdl_string);
    $wsdl_namespaces = $outer->getDocNamespaces();

    //extracting the schema tag inside WSDL
    $xml->loadXML($wsdl_string);
    $xpath = new DOMXPath($xml);
    $xpath->registerNamespace('xsd', 'http://www.w3.org/2001/XMLSchema');
    $schemaNode = $xpath->evaluate('//xsd:schema');

    $schemaXML = "";
    foreach ($schemaNode as $node) {

        //add namespaces from WSDL to schema
        foreach($wsdl_namespaces as $prefix => $ns){
            $node->setAttribute("xmlns:$prefix", $ns);
        }
        $schemaXML .= simplexml_import_dom($node)
                ->asXML();
    }

    //capturing de XML envelope
    $xml = new DOMDocument();
    $xml->loadXML($xmlEnvelope);

    //extracting namespaces from soap Envelope
    $outer = new SimpleXMLElement($xmlEnvelope);
    $envelope_namespaces = $outer->getDocNamespaces();

    $xpath = new DOMXPath($xml);
    $xpath->registerNamespace('soapEnv', 'http://schemas.xmlsoap.org/soap/envelope/');
    $envelopeBody = $xpath->evaluate('//soapEnv:Body/*[1]');
    $envelopeBodyXML = "";
    foreach ($envelopeBody as $node) {

        //add namespaces from envelope to the body content
        foreach($envelope_namespaces as $prefix => $ns){
            $node->setAttribute("xmlns:$prefix", $ns);
        }
        $envelopeBodyXML .= simplexml_import_dom($node)
                ->asXML();
    }

    $doc = new DOMDocument();
    $doc->loadXML($envelopeBodyXML); // load xml
    $is_valid_xml = $doc->schemaValidateSource($schemaXML); // path to xsd file

    return libxml_get_errors();   

} 
```

在您的 SoapServer 函数实现中：

```
function myFunction($param) {

    $xmlEnvelope = file_get_contents("php://input");
    $errors = validate($xmlEnvelope, $wsdl);

} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-16T21:42:02.970

我找不到任何简单的方法来执行验证，最终在业务逻辑中有验证代码。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-21T07:03:29.453

前段时间，我使用[NuSOAP创建](http://sourceforge.net/projects/nusoap)[了一个使用 PHP 的概念验证](http://hype-free.blogspot.com/2007/01/implementing-web-services-with-open.html)Web 服务。我不知道它是否验证了输入，但我认为它确实如此。

# java - Spring 可以解析和注入属性文件吗？

> ID：106402
> 
> 赞同：12
> 
> 时间：2008-09-19T23:34:02.163
> 
> 标签：java, spring, configuration-files

我已经知道如何：

使用以下命令将属性文件加载到我的 Spring 配置中：

```
<context:property-placeholder location="aaa/bbb/ccc/stuff.properties"/> 
```

使用以下命令即时构建属性对象：

```
<props><prop key="abc">some value</prop></props> 
```

但是我不能做并且非常有用的是让 Spring 加载一个属性文件，然后构建匹配的属性对象。然后我可以以正常方式将其注入 bean 中。

我在其他地方搜索过这个没有成功。有任何想法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-20T01:45:38.243

看看[**util:properties**](https://docs.spring.io/spring/docs/2.5.x/reference/xsd-config.html#xsd-config-body-schemas-util-properties)

```
<util:properties id="myProperties" location="classpath:com/foo/my.properties"/> 
```

然后，将属性注入到 Spring 管理的 Bean 中，就像这样简单：

```
@Resource(name = "myProperties")
private Properties myProperties; 
```

# c++ - 推荐的 GNU autotools 版本是什么？

> ID：106405
> 
> 赞同：1
> 
> 时间：2008-09-19T23:34:19.727
> 
> 标签：c++, c, unix, gnu, autotools

我们在工作中维护基于 RPM 的软件分发，以便我们在我们支持的所有平台上拥有一套通用的软件。因此，我们必须构建大量第三方软件，并且经常会发现需要运行 autoconf/automake/libtoolize/etc 以使其在 Solaris 或其他平台上构建的情况。

我的结果好坏参半。这些工具似乎相当脆弱，而且这些文件通常只适用于它们最初编写的 autoconf/automake/etc 版本。

理想情况下，我只需要支持一个版本的 GNU 自动工具，但我的印象是我真的最终不得不拥有每个版本的副本。

这是不寻常的，还是其他人也有同样的问题？是否有涵盖所有情况的 autotools 版本的子集？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T17:04:12.573

确实，自动工具可能很脆弱且特定于版本。但请记住，您只需要在开发机器上使用这些工具。将项目部署到**目标**机器不需要在目标上安装任何工具。即使是测试机器也不需要任何工具。它们实际上只需要在依赖项发生变化时运行，例如向项目添加额外的文件或库。

多年来，我们一直将这些工具用于内部项目，但还没有找到更好的解决方案。如果您身处 Unix 世界，请不要低估拥有可以`configure; make; make install` *正常工作*的系统的好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T00:24:05.257

你的经历并不罕见。Autotools 就是这么脆弱，特别是对于复杂的项目。可悲的是，似乎没有其他选择可以替代它的很多版本。

# c++ - 是否有调试 C++ 宏的良好通用方法？

> ID：106412
> 
> 赞同：13
> 
> 时间：2008-09-19T23:36:34.090
> 
> 标签：c++, debugging, gcc, macros

一般来说，我偶尔会有一系列嵌套的宏，它们的定义中有一些预处理器条件元素。这些调试起来会很痛苦，因为很难直接看到正在执行的实际代码。

不久前，我隐约记得找到了一个编译器 (gcc) 标志来扩展它们，但我在实践中遇到了麻烦。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-19T23:39:31.290

gcc -E 将预处理的源输出到标准输出。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T00:10:28.330

对于 MSVC 用户，您可以右键单击文件/项目，查看设置并将文件属性更改为输出预处理源（通常在 obj 目录中）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-20T00:11:38.297

这可能不适用于您的情况，但宏确实会妨碍调试，并且经常被过度使用和避免。

您可以将它们替换为内联函数或以其他方式将它们全部删除吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T00:28:28.193

您可能应该开始远离宏并开始使用内联和模板。

宏是一个旧工具，有时是正确的工具。作为最后的手段，记住 printf 是你的朋友（实际上 printf 在你做多线程的事情时并不是那么糟糕的朋友）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T00:03:50.110

使用加载的符号调试反汇编。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T06:58:21.017

gcc -save-temps 将写出一个 .i（或 C++ 的 .ii 文件），它是 C 预处理器的输出，然后再交给编译器。这通常很有启发性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T06:10:10.230

GCC 和兼容的编译器使用 -E 选项将预处理的源输出到标准输出。

```
gcc -E foo.cpp 
```

Sun Studio 也支持这个标志：

```
CC -E foo.cpp 
```

但更好的是-xdumpmacros。[您可以在 Suns 的文档](http://docs.oracle.com/cd/E19205-01/819-5267/bkbbf/index.html)中找到更多信息。

# c# - 如何在 Windows 安装程序包添加的注册表项中引用 GAC 中程序集的路径？

> ID：106414
> 
> 赞同：1
> 
> 时间：2008-09-19T23:36:58.550
> 
> 标签：c#, com, 64-bit, windows-installer, com+

我有一个 .NET 程序集，其中包含要通过 EnterpriseServices (COM+) 注册为 ServicedComponent 并由第三方应用程序通过 COM RPC 调用的类。因此，我需要将它添加到 GAC 并`HKEY_CLASSES_ROOT\CLSID\{clsid}\CodeBase`在 GAC 文件夹中的程序集 DLL 路径下添加一个注册表项。（我不能依赖 regsvcs 来做，因为这是一个 32 位的程序集 --- 它依赖于 32 位的第三方组件 --- 而我之前提到的第三方应用程序看不到类Wow6432Node)

所以问题是：

要在 GAC 中创建的程序集的路径，或者至少是 GAC 文件夹本身的路径，是否可以在 Windows Installer 中作为可用于注册表项值等的属性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T05:02:01.953

如果每个文件都有一个组件，无论如何都应该这样做，组件的 KeyPath 指向文件安装的位置（在本例中为 GAC）。您可以将组件键用作 MSI 注册表中条目的值字段中的标记。

假设您在“assmb.dll”的文件表及其对应的组件（也称为“assmb.dll”）中有一个带有 File 键的程序集。您可以在 Registry 表中设置 value 字段以将您的程序集注册到 [$assmb.dll]，它将被解析到程序集的安装位置。如果此目录是 GAC，它将被解析为 GAC 的位置。

[您可以在此处](http://msdn.microsoft.com/en-us/library/aa368609(VS.85).aspx)找到有关 MSI 中格式化字段的更多信息。

# development-environment - 什么是好的源代码搜索引擎？

> ID：106419
> 
> 赞同：22
> 
> 时间：2008-09-19T23:38:53.197
> 
> 标签：development-environment, search-engine, code-search-engine

我工作的代码库非常庞大，grep 大约需要 20 分钟。我正在寻找一个很好的基于 Web 的源代码搜索引擎……类似于 koders.com 的内部网版本。

我发现的唯一东西是 Krugle 企业版，它没有公布价格……如果你不得不问，你买不起。

我真的更喜欢一个普通的旧搜索引擎，没有很多其他的花里胡哨。

源代码主要是 ASP.NET/C# 和 Javascript。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-28T23:42:20.963

我推荐[OpenGrok](http://opengrok.github.io/OpenGrok/)。还有一些其他引擎，[这里](http://bugsquash.blogspot.com/2007/09/code-search-engines-mini-review.html)是对它们的快速回顾。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-20T00:04:57.313

20分钟太离谱了！这些天我正在使用超过一百万行的源代码库，并且 grepping 最多需要几秒钟（我使用[ack](http://petdance.com/ack/)）。我们的主目录存储在文件服务器上并安装在 NFS 上，为了加快 grepping，我们在登录到文件服务器时执行此操作。我不确定 NFS 需要多长时间，但肯定会更长。

出于同样的性能原因，我们还在登录到文件服务器时进行源代码控制操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T00:48:52.060

在 Linux 上，我使用 GNU [ID Utils](http://www.gnu.org/software/idutils/)这些工具具有与 grep 类似的功能，但从索引中工作，因此它们的速度非常快。您运行 mkid 来创建一个索引，然后运行其他实用程序之一，例如“gid”，它是 grep 的 ID 工具版本，可以在整个索引中进行 grep。我有一个偶尔运行 mkid 的 cron 作业。

ID 工具也可以在 Windows 上使用，可以使用 cygwin 或作为[标准 Windows 程序](http://gnuwin32.sourceforge.net/packages/id-utils.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T23:44:35.117

[Lxr](http://sourceforge.net/projects/lxr)在大型代码库上工作得很好，正如[linux 内核](http://lxr.linux.no/)所证明的那样。我认为它仅适用于 C（您没有指定使用的语言）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-14T07:41:07.423

I have used OpenGrok before and was quite happy with it. Another alternative is:

**Gonzui** [http://gonzui.sourceforge.net/screenshots.html](http://gonzui.sourceforge.net/screenshots.html)

[![](https://i.stack.imgur.com/KXy8L.png)](https://i.stack.imgur.com/KXy8L.png)
[(source: [sourceforge.net](http://gonzui.sourceforge.net/screenshots/printf-2-mini.png))]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-26T07:02:39.307

我使用[cs2project](http://code.google.com/p/cs2project/)有一段时间了，它是一个基于Lucene.NET的开源c#代码搜索引擎。不幸的是，它不再被开发。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-19T23:45:31.590

如果您有这么多源代码，您可能需要花一些时间来设置搜索引擎以对其进行索引。我会推荐 Lucene——它是免费的，速度很快，对于任何有编程经验的人来说，为任何内容建立一个强大的索引非常容易。

[http://lucene.apache.org/](http://lucene.apache.org/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T00:06:32.723

既然你说'grepping'，我想你对命令行解决方案并不感兴趣。

像[ctags](http://ctags.sourceforge.net/)这样的工具将索引和搜索 C# 和 JavaScript 代码库（以及许多其他代码库）。

ctags 非常简洁的地方在于它可以与 vim 结合使用 taglist 插件以允许源代码浏览或与 vim omnicomplete 结合以启用代码完成。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-26T04:19:24.547

我有一个类似的问题。我在一家软件公司工作，该公司的项目涉及 c#、c++、asp.net、db 脚本甚至 vb6 源代码（是的，当没有像更高版本的 Visual Studio 那样的解决方案概念时，编译多个 vb6 项目是一件令人头疼的事情。 ..)

我一直在使用 Visual Studio 2010，但必须使用 3rd 方文本编辑器来搜索 db 脚本和 vb6 源代码。

我做了一些研究，发现了 KodeEx (http://kodeex.com) 并且对它很满意。它是一个基于索引的源代码搜索工具。您不必构建任何东西（就像其他人建议您使用 Lucene 所做的那样。顺便说一下，Lucene 是一个不错的开源项目 =)）。只需安装它并让它为您的项目编制索引。之后，它通常会在几秒钟内返回结果。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-12T18:40:48.607

请参阅我们的[SD 源代码搜索引擎](http://www.semanticdesigns.com/Products/SearchEngine/index.html)。语言感知和处理多种语言（C、C++、C#、Java、ObjectiveC、PHP、VB.net、VB6、Ada、Fortran、COBOL 等）。在 Linux 内核中搜索需要 2.8 秒（730 万行，18000 多个文件）。

因为它是语言感知的，它可以忽略与您的搜索无关的语言元素（例如，如果您只对标识符或表达式感兴趣，则忽略注释、格式和空格）。它可以在标识符、字符串和注释中进行搜索。如果您真的想这样做，它有一个完整的正则表达式字符串搜索选项。

它已被用于包含数千万行代码的系统，在我们所知道的一种情况下，一个包含超过一百万个文件的系统。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-19T23:52:46.983

也许您应该在支持符号标记的编辑器或 IDE 上投入一些时间和/或金钱。您只需遍历整个源代码树即可对其进行标记，然后编辑器使用索引搜索或映射查找来查找符号定义或引用。

一些支持标记的编辑器或 IDE 示例包括 Eclipse、Visual Studio、SlickEdit。一些 IDE 可能会调用功能符号浏览器或类似的东西。

# javascript - 从书签加载外部 JS？

> ID：106425
> 
> 赞同：75
> 
> 时间：2008-09-19T23:39:49.433
> 
> 标签：javascript, load, external, bookmarklet

如何使用书签加载外部 JavaScript 文件？这将克服 IE 的 URL 长度限制，并且通常使事情更清洁。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-09-19T23:43:19.050

### 2015 更新

[内容安全策略](https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy)现在将阻止这在许多站点中起作用。例如，下面的代码不适用于 Facebook。

### 2008年答案

使用创建包含外部 JS 的脚本标签的小书签。

作为示例：

```
javascript:(function(){document.body.appendChild(document.createElement('script')).src='** your external file URL here **';})(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-04-11T07:37:57.290

Firefox 和其他可能支持多行书签，不需要一个衬里。当您粘贴代码时，它只是用空格替换换行符。

```
javascript:
var q = document.createElement('script');
q.src = 'http://svnpenn.github.io/bm/yt.js';
document.body.appendChild(q);
void 0; 
```

[例子](http://github.com/svnpenn/bm/blob/ad7e0c6/index.htm#L27-L32)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-09-13T10:33:58.037

如果我可以添加在 FF 和 Chrome 中测试的方法（为了将可读性拆分为多行）：

```
javascript:var r = new XMLHttpRequest();
           r.open("GET", "https://...my.js", true);
           r.onloadend = function (oEvent) {
               new Function(r.responseText)();
               /* now you can use your code */
           };
           r.send();
           undefined 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2017-11-11T20:22:17.257

我一直更喜欢使用流行的开源项目[loadjs](https://github.com/muicss/loadjs/blob/master/dist/loadjs.min.js)

它经过跨浏览器测试，具有更多功能/舒适特性。

所以代码将如下所示：

```
loadjs=function(){function e(e,n){var t,r,i,c=[],o=(e=e.push?e:[e]).length,f=o;for(t=function(e,t){t.length&&c.push(e),--f||n(c)};o--;)r=e[o],(i=s[r])?t(r,i):(u[r]=u[r]||[]).push(t)}function n(e,n){if(e){var t=u[e];if(s[e]=n,t)for(;t.length;)t[0](e,n),t.splice(0,1)}}function t(e,n,r,i){var o,s,u=document,f=r.async,a=(r.numRetries||0)+1,h=r.before||c;i=i||0,/(^css!|\.css$)/.test(e)?(o=!0,(s=u.createElement("link")).rel="stylesheet",s.href=e.replace(/^css!/,"")):((s=u.createElement("script")).src=e,s.async=void 0===f||f),s.onload=s.onerror=s.onbeforeload=function(c){var u=c.type[0];if(o&&"hideFocus"in s)try{s.sheet.cssText.length||(u="e")}catch(e){u="e"}if("e"==u&&(i+=1)<a)return t(e,n,r,i);n(e,u,c.defaultPrevented)},!1!==h(e,s)&&u.head.appendChild(s)}function r(e,n,r){var i,c,o=(e=e.push?e:[e]).length,s=o,u=[];for(i=function(e,t,r){if("e"==t&&u.push(e),"b"==t){if(!r)return;u.push(e)}--o||n(u)},c=0;c<s;c++)t(e[c],i,r)}function i(e,t,i){var s,u;if(t&&t.trim&&(s=t),u=(s?i:t)||{},s){if(s in o)throw"LoadJS";o[s]=!0}r(e,function(e){e.length?(u.error||c)(e):(u.success||c)(),n(s,e)},u)}var c=function(){},o={},s={},u={};return i.ready=function(n,t){return e(n,function(e){e.length?(t.error||c)(e):(t.success||c)()}),i},i.done=function(e){n(e,[])},i.reset=function(){o={},s={},u={}},i.isDefined=function(e){return e in o},i}();
loadjs('//path/external/js', {
    success: function () {
        console.log('something to run after the script was loaded');
    }); 
```

# parsing - 是什么让 Ometa 与众不同？

> ID：106431
> 
> 赞同：21
> 
> 时间：2008-09-19T23:41:55.467
> 
> 标签：parsing, programming-languages, grammar, ometa

[Ometa](http://tinlizzie.org/ometa/)是“一种新的面向对象的模式匹配语言”。我之前在 Oz 工具等语言中遇到过模式匹配，用于解析 Lexx/Yacc 或 Pyparsing 等语法。尽管查看示例代码、阅读讨论并与朋友交谈，但我仍然无法真正理解 Ometa 的特别之处（或者至少，为什么有些人认为它如此）。有什么解释吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-10T09:27:12.897

此外，对我来说最重要的是，Ometa 的 Squeak 端口允许左递归规则。

从它的 PEG 遗产中，它获得了回溯和无限的前瞻。先前解析结果的记忆允许线性解析时间（几乎所有时间（*））。

高阶产生式允许人们轻松重构语法。

[这篇论文](http://www.vpri.org/pdf/tr2007002_packrat.pdf)——Packrat Parsers Can Support Left Recursion——解释了左递归的属性。

(*) 论文的第 5 节解释说，一个人可能会遭受超线性解析时间，但这个问题在实际语法中并不明显。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T05:34:20.300

据我所知，这是一种元语言。您可以创建新的语言结构，并创建 DSL；但最引人注目的是，您可以从现有的解析器继承来扩展语言。无论如何，这就是我能记住的。

我发现这很有趣：[http ://www.moserware.com/2008/06/ometa-who-what-when-where-why.html](http://www.moserware.com/2008/06/ometa-who-what-when-where-why.html)

# transactions - EJB3 事务传播

> ID：106437
> 
> 赞同：26
> 
> 时间：2008-09-19T23:43:08.520
> 
> 标签：transactions, jakarta-ee, ejb-3.0

我有一个无状态bean，例如：

```
@Stateless
public class MyStatelessBean implements MyStatelessLocal, MyStatelessRemote {
    @PersistenceContext(unitName="myPC")
    private EntityManager mgr;

    @TransationAttribute(TransactionAttributeType.SUPPORTED)
    public void processObjects(List<Object> objs) {
        // this method just processes the data; no need for a transaction
        for(Object obj : objs) {
            this.process(obj);
        }
    }

    @TransationAttribute(TransactionAttributeType.REQUIRES_NEW)
    public void process(Object obj) {
        // do some work with obj that must be in the scope of a transaction

        this.mgr.merge(obj);
        // ...
        this.mgr.merge(obj);
        // ...
        this.mgr.flush();
    }
} 
```

典型的用法是客户端调用 processObjects(...)，它实际上并不与实体管理器交互。它做它需要做的事情，并为每个要处理的对象单独调用 process(...) 。process(...) 的持续时间相对较短，但 processObjects(...) 可能需要很长时间才能运行所有内容。因此我不希望它保持一个开放的交易。我*确实*需要单独的 process(...) 操作在他们自己的事务中操作。这应该是每次调用的新事务。最后，我想保持选项打开，让客户直接调用 process(...)。

我尝试了许多不同的事务类型：从不、不支持、支持（在 processObjects 上）和必需，需要新的（在进程上），但每次调用 merge() 时都会得到 TransactionRequiredException。

我已经能够通过将方法分成两个不同的 bean 来使其工作：

```
@Stateless
@TransationAttribute(TransactionAttributeType.NOT_SUPPORTED)
public class MyStatelessBean1 implements MyStatelessLocal1, MyStatelessRemote1 {
    @EJB
    private MyStatelessBean2 myBean2;

    public void processObjects(List<Object> objs) {
        // this method just processes the data; no need for a transaction
        for(Object obj : objs) {
            this.myBean2.process(obj);
        }
    }
}

@Stateless
public class MyStatelessBean2 implements MyStatelessLocal2, MyStatelessRemote2 {
    @PersistenceContext(unitName="myPC")
    private EntityManager mgr;

    @TransationAttribute(TransactionAttributeType.REQUIRES_NEW)
    public void process(Object obj) {
        // do some work with obj that must be in the scope of a transaction

        this.mgr.merge(obj);
        // ...
        this.mgr.merge(obj);
        // ...
        this.mgr.flush();
    }
} 
```

但我仍然很好奇是否有可能在一堂课上完成这项工作。在我看来，事务管理器仅在 bean 级别运行，即使为单个方法提供了更具体的注释也是如此。因此，如果我以某种方式标记一个方法以防止事务开始在同一实例中调用其他方法也不会创建事务，无论它们是如何标记的？

我正在使用 JBoss Application Server 4.2.1.GA，但欢迎/首选非特定答案。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-04T15:46:23.633

另一种方法实际上是在同一个 bean 上使用这两种方法 - 并`@EJB`引用自身！像这样的东西：

```
// supposing processObjects defined on MyStatelessRemote1 and process defined on MyStatelessLocal1
@Stateless
@TransationAttribute(TransactionAttributeType.NOT_SUPPORTED)
public class MyStatelessBean1 implements MyStatelessLocal1, MyStatelessRemote1 {
    @EJB
    private MyStatelessLocal1 myBean2;

    public void processObjects(List<Object> objs) {
        // this method just processes the data; no need for a transaction
        for(Object obj : objs) {
            this.myBean2.process(obj);
        }
    }

    @TransationAttribute(TransactionAttributeType.REQUIRES_NEW)
    public void process(Object obj) {
        // do some work with obj that must be in the scope of a transaction

        this.mgr.merge(obj);
        // ...
        this.mgr.merge(obj);
        // ...
        this.mgr.flush();
    }
} 
```

这样，您实际上“强制”该`process()`方法通过代理的 ejb 堆栈访问，因此`@TransactionAttribute`生效 - 并且仍然只保留一个类。呸！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-17T22:06:24.760

马特，你问的问题是一个非常经典的问题，我认为 Herval/Pascal 的自我参考解决方案很简洁。这里没有提到一个更通用的解决方案。

这是 EJB“用户”事务的情况。由于您在会话 bean 中，您可以从会话上下文中获取用户事务。以下是您的代码在用户事务中的外观：

```
// supposing processObjects defined on MyStatelessRemote1 and process defined on MyStatelessLocal1
@Stateless
@TransationAttribute(TransactionAttributeType.NOT_SUPPORTED)
public class MyStatelessBean1 implements MyStatelessLocal1, MyStatelessRemote1 {

    @Resource
    private SessionContext ctx;

    @EJB
    private MyStatelessLocal1 myBean2;

    public void processObjects(List<Object> objs) {
        // this method just processes the data; no need for a transaction
        for(Object obj : objs) {
            this.myBean2.process(obj);
        }
    }

    public void process(Object obj) {

        UserTransaction tx = ctx.getUserTransaction();

        tx.begin();

        // do some work with obj that must be in the scope of a transaction

        this.mgr.merge(obj);
        // ...
        this.mgr.merge(obj);
        // ...
        this.mgr.flush();

        tx.commit();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-04T16:32:11.030

我认为问题是每个 bean 都包装在一个控制事务行为的代理中。当您从一个 bean 调用到另一个 bean 时，您将通过该 bean 的代理，并且可以通过代理更改事务行为。

但是当 bean 使用不同的事务属性调用自身的方法时，调用不会通过代理，因此行为不会改变。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T16:15:50.130

马特，不管怎样，我得出的结论和你完全一样。

只有在跨越 Bean 边界时才考虑 TransactionAttributeTypes。当在同一个 bean 中调用方法时，TransactionAttributeTypes 没有任何效果，无论在方法上放置什么类型。

据我所知，EJB Persistence Spec 中没有任何内容指定在这些情况下的行为应该是什么。

我在 Jboss 也遇到过这种情况。我也会在 Glassfish 中试一试，然后告诉你结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-07T19:09:07.247

如果有一天有人遇到这个：

为了避免 JBoss 中的循环依赖（例如允许自我引用），请使用注释“IgnoreDependency”，例如：

@IgnoreDependency @EJB MySelf 我自己Ref;

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-11T15:25:12.737

我还没有尝试过（我即将尝试），但是通过`@EJB`注释注入自引用的另一种方法是`SessionContext.getBusinessObject()`方法。这将是另一种避免循环引用对您造成影响的可能性的方法——尽管至少对于无状态 bean 注入似乎确实有效。

我正在开发一个使用两种技术的大型系统（可能是由不同的开发人员），但我不确定哪种方法是“正确”的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T00:01:37.807

我认为与方法**processObjects上的***@TransationAttribute(TransactionAttributeType.Never)*有关。

 ****TransactionAttributeType.Never**

[http://docs.sun.com/app/docs/doc/819-3669/6n5sg7cm3?a=view](http://docs.sun.com/app/docs/doc/819-3669/6n5sg7cm3?a=view)

> 如果客户端在事务中运行并调用企业 bean 的方法，则容器会抛出 RemoteException。如果客户端未与事务关联，则容器在运行该方法之前不会启动新事务。

我假设您是客户端代码中的方法**processObjects**的客户端。因为您的客户端可能与事务没有关联，所以使用**TransactionAttributeType.Never**的方法调用首先会很高兴。然后，您从**processObjects调用****process**方法，尽管**TransactionAttributeType.Required**注释不是 bean 方法调用，并且未强制执行事务策略。当您调用**合并**时，您会得到异常，因为您仍然没有与事务关联。

 ******尝试对这两种 bean 方法使用**TransactionAttributeType.Required**以查看它是否可以解决问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-26T14:31:46.483

我有凯文提到的这些循环依赖问题。然而，建议的注解@IgnoreDependency 是一个jboss 特定的注解并且在例如Glassfish 中没有对应的注解。

因为它不适用于默认的 EJB 引用，所以我对这个解决方案感到有点不舒服。

因此，我给了bluecarbon的解决方案一个机会，从而“手动”开始了内部交易。

除此之外，我认为没有解决方案，只能在另一个 bean 中实现内部 process()，这也很丑陋，因为我们只是想扰乱我们的类模型以获得这些技术细节。

# c# - 要求用户更新 .NET

> ID：106439
> 
> 赞同：1
> 
> 时间：2008-09-19T23:43:58.347
> 
> 标签：c#, .net, linq, client-applications

我正在开发一些生产软件，在 .NET 框架上使用 C#。我真的很希望能够在项目中使用 LINQ。我相信它需要 .NET 3.5 版（如果我错了，请纠正我）。此应用程序是一个商业软件应用程序，需要在客户的工作 PC 上运行。假设他们有 .NET 3.5，或者假设他们不介意升级到最新版本是否合理？

我只是想了解强制框架升级以运行应用程序的共识是什么。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-19T23:53:16.983

我会说假设他们拥有 .NET 3.5 是不安全的。

由于升级时他们非常非常不可能遇到任何问题，因此更改任何内容总是存在风险。我知道我不介意升级，但我是一名开发人员。

我认为这是可以采取任何一种方式的事情之一，他们要么不会三思而后行，只是升级，要么他们可能会因此而出问题。我认为这取决于您的客户，“低技术”客户可能会三思而后行，因为他们可能无法完全理解它，这会让他们感到紧张。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-21T13:10:46.823

如您所说，要使用 LINQ，您需要拥有 .NET 3.5。为了确认这一点，LINQ 的维基百科页面说：

> 语言集成查询（LINQ，发音为“链接”）是一个 Microsoft .NET Framework 组件，它使用类似于 SQL 的语法向 .NET 语言添加本机数据查询功能。LINQ 引入的许多概念最初是在 Microsoft 的 Cω 研究项目中测试的。 **LINQ 于 2007 年 11 月 19 日作为 .NET Framework 3.5 的一部分发布**。

由于机器可能已经安装了一些以前版本的 .NET，您可能会发现Scott Hanselman（Microsoft 员工）的[Smallest Dot NET](http://www.hanselman.com/smallestdotnet/)这个站点很有用。它计算出您需要更新的最小更新（当前为 3.5 SP1）。

至于在客户的机器上期待它是否合理，我想这取决于你正在创造什么。我的感受是：

**小型低成本应用程序 =**
可能还没有 以低成本出售的小型应用程序（可能以 3.5 为目标）有点早，并且由于烦恼因素可能会减少您的受众规模。

**带有安装程序的大型商业应用程序 = YES**
如果它是一个大型商业应用程序（您的基线规范已经是 WInXP 或在 .NET 2.0 上运行的更新版本），我认为客户不会在意。将可再发行组件放在安装程序磁盘上！

请记住，出于多种原因，应该采用任何新技术。您对使用 LINQ 有什么需求，它是否难以复制？如果 LINQ 为您提供了您真正需要的功能，您的成本和时间表可能会从选择它中受益。您的公司可以通过以更低的价格出售产品或增加利润来获得收益。

[正如Nescio](https://stackoverflow.com/questions/106439/requiring-users-to-update-net#106442)所指出的，最后一个选择是，如果您只需要 Linq to Objects（例如，您不需要 Linq to SQL 或 Linq to XML），那么[LinqBridge](http://www.albahari.com/nutshell/linqbridge.aspx)可能是一种选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-19T23:51:28.937

由于 .NET Framework 本身是免费分发的，因此人们很少反对升级它。但是，系统管理员的可用性或安装可能存在问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T23:45:24.867

签出：[LinqBridge](http://www.albahari.com/nutshell/linqbridge.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T23:53:39.493

与您的销售副总裁交谈。严重地。如果 3.5 是最前沿的（老实说我不知道​​），那么他/她很可能不会非常喜欢这个想法。如果是几年前，那么他们会更容易接受。作为一个强制升级第三方软件的产品，不是不可逾越的短板，但也无济于事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-19T23:55:53.887

这取决于您的目标受众和您的应用程序的重要性。一般来说，此时您可能无法假设您的受众已经拥有 .NET 3.5。安装它可能需要很长时间，如果他们还没有 .NET 3.5 的其他先决条件，可能会非常乏味。

因此，除非它是一个相当全面和/或重要的企业软件，否则我强烈建议不要使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-21T13:57:26.617

您应该阅读这个 Hanselman 的条目：[http](http://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx) ://www.hanselman.com/blog/SmallestDotNetOnTheSizeOfTheNETFramework.aspx 如果涉及到安装并因此最小化 .NET 框架的安装大小，这真的很有趣。它应该以某种方式回答您的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T23:50:47.053

只要您知道您不需要支持 Windows 2000 或任何旧版本的 Windows，那么需要最新和最好的框架版本就不会觉得太繁重。

一些不太幸运的开发人员被旧的框架版本卡住了，因为他们需要支持旧的操作系统版本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-19T23:53:29.807

.Net 3.5 尚未在 Windows PC 上自动更新，我不会打赌标准客户“按原样”拥有它。

请注意，您可能必须决定是否使用 .Net3.5 SP1，因为在 3.5 和 3.5SP1 之间存在一个小的 DataSet 向后不兼容（可能还有一些我没有看到的）。

如果您的客户是一家大公司，您可能要考虑他们通常非常保守（我的客户仍然是 XP/IE6，有时甚至是 W2K/IE6）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-21T13:25:04.013

注意 Windows 2000 不支持 2.0 以上的任何框架。因此，您的应用程序将仅支持以下操作系统：

*   微软视窗
*   微软视窗服务器 2003
*   视窗
*   视窗服务器 2008

祝你好运！

# .net - 在 ASP.NET 动态数据/LINQ to SQL 中启用主键字段的编辑

> ID：106444
> 
> 赞同：3
> 
> 时间：2008-09-19T23:45:50.980
> 
> 标签：.net, asp.net, linq-to-sql, dynamic-data

如果您的表具有由外键和其他表列组成的复合主键，您如何获得 ASP.NET 动态数据以允许非外键表列可编辑？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T00:26:30.303

即使不使用动态数据，LINQ to SQL 也不支持更改实体的主键。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T16:00:04.360

当前版本不太支持复合或复合外键。我在构建测试项目时遇到了同样的问题。对于具有单列外键的父子关系，动态数据允许我使用下拉菜单编辑子表中的记录。对于具有复合主键的父子关系，动态数据仅允许我编辑其中一个外键，而无需下拉菜单。我尝试了 Linq to SQL 和数据实体。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-13T14:24:26.647

主键必须是唯一的，这并不一定意味着它必须自动生成。也不意味着不能改变。

可以想象，人类可能会想出主键，在这种情况下，pk 字段需要输入。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-21T23:50:45.397

主键代表实体的身份。假定主键字段永远不会更改。您的问题表明您可能错误地使用了主键。

# java - 使用带有 netbeans 6.1 aka Matisse 的 JTables

> ID：106446
> 
> 赞同：1
> 
> 时间：2008-09-19T23:47:05.890
> 
> 标签：java, swing, netbeans

**在您回答之前：是的，我已经阅读了 Sun 的 jtable 教程**。不，它没有帮助我。是的，我是个傻子。**请不要参考该文件来回答**。我特别感兴趣的是如何通过 Netbeans IDE 向我的 Jtable 动态添加行和列。我已经有一个对象，其中包含我的数据的哈希图。我不知道我应该将该对象传递给何处或哪个对象。谢谢你的时间！

我有一个向量，其中包含一系列（长度为 l）的对象（每个对象对应一行）。如何让该矢量对象显示在 JTable 上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-19T23:54:40.957

A`JTable`使用 a`TableModel`来保存其数据。您的数据散列/向量需要进行调整以供使用；您可以编写一个`TableModel`实现，使用哈希/向量作为支持数据，或者，如果您不会动态更新哈希/向量并需要它自动显示，您可以简单地将所有内容复制到 的实例中`DefaultTableModel`，然后使用它。

如果您使用适配器并动态更新哈希/向量，请记住所有更新必须在事件调度线程中完成。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T01:08:58.173

只是为了说明，以下是如何使用s 和s`DefaultTableModel`显示数据的示例。`HashMap``Vector`

以下是将数据从 a 转储`HashMap`到`DefaultTableModel`用作a 的`TableModel`a的示例`JTable`。

```
import java.util.*;
import javax.swing.*;
import javax.swing.table.*;

public class JTableExample extends JFrame
{
    private void makeGUI()
    {
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        // HashMap with some data.
        HashMap<String, String> map = new HashMap<String, String>();
        map.put("key1", "value1");
        map.put("key2", "value2");

        // Create a DefaultTableModel, which will be used as the
        // model for the JTable.
        DefaultTableModel model = new DefaultTableModel();

        // Populate the model with data from HashMap.
        model.setColumnIdentifiers(new String[] {"key", "value"});

        for (String key : map.keySet())
            model.addRow(new Object[] {key, map.get(key)});

        // Make a JTable, using the DefaultTableModel we just made
        // as its model.
        JTable table = new JTable(model);

        this.getContentPane().add(table);
        this.setSize(200,200);
        this.setLocation(200,200);
        this.validate();
        this.setVisible(true);
    }

    public static void main(String[] args)
    {
        new JTableExample().makeGUI();
    }
} 
```

对于使用 a`Vector`将一列数据包含到 a 中`JTable`：

```
import java.util.*;
import javax.swing.*;
import javax.swing.table.*;

public class JTableExample extends JFrame
{
    private void makeGUI()
    {
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        // Vector with data.
        Vector<String> v = new Vector<String>();
        v.add("first");
        v.add("second");

        // Create a DefaultTableModel, which will be used as the
        // model for the JTable.
        DefaultTableModel model = new DefaultTableModel();

        // Add a column of data from Vector into the model.
        model.addColumn("data", v);

        // Make a JTable, using the DefaultTableModel we just made
        // as its model.
        JTable table = new JTable(model);

        this.getContentPane().add(table);
        this.setSize(200,200);
        this.setLocation(200,200);
        this.validate();
        this.setVisible(true);
    }

    public static void main(String[] args)
    {
        new JTableExample().makeGUI();
    }
} 
```

我不得不承认在使用上面的例子时没有出现列名（我通常使用`DefaultTableModel`'s`setDataVector`方法），所以如果有人对如何使列名出现有任何建议，请做:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T00:05:43.647

为了补充我之前的答案，为了它的价值，我实际上编写了一个表模型，它使用（基本上）`ArrayList<Row>`作为支持数据，其中`Row`是 a `HashMap<String, Object>`，将列名映射到值。

整件事大约有 1500 行代码，尽管我的代码对你的目的来说可能有点过头了，而且你可能不必编写几乎那么多的代码。一切顺利！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T11:17:06.597

只是对 coobird 帖子的补充；为了让标题出现，我这样做了：

```
import java.util.*;
import javax.swing.*;
import javax.swing.table.*;

public class JTableExample extends JFrame
{
    private void makeGUI()
    {
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        // HashMap with some data.
        HashMap<String, String> map = new HashMap<String, String>();
        map.put("key1", "value1");
        map.put("key2", "value2");

        // Create a DefaultTableModel, which will be used as the
        // model for the JTable.
        DefaultTableModel model = new DefaultTableModel();

        // Populate the model with data from HashMap.
        model.setColumnIdentifiers(new String[] {"key", "value"});

        for (String key : map.keySet())
                model.addRow(new Object[] {key, map.get(key)});

        // Make a JTable, using the DefaultTableModel we just made
        // as its model.
        JTable table = new JTable(model);

        this.getContentPane().add(new JScrollPane(table));
        this.setSize(200,200);
        this.setLocation(200,200);
        this.validate();
        this.setVisible(true);
    }

    public static void main(String[] args)
    {
        new JTableExample().makeGUI();
    }
} 
```

顺便说一句，你的帖子对我很有帮助，你不知道我有多感激！

# shell - 如何重定向 Tornado / VXWorks shell 输出？

> ID：106453
> 
> 赞同：3
> 
> 时间：2008-09-19T23:51:26.613
> 
> 标签：shell, redirect, embedded, vxworks

我最近一直在研究一个嵌入式 C/C++ 项目，使用 Tornado 2 中的 shell 作为调试工具包中正在发生的事情的一种方式。这种方法的唯一问题是它是一个复杂的系统，因此有相当多的输出。每当一些新信息到达时，Tornado 都会“有帮助地”滚动窗口，这意味着如果您发现错误，它会很快从网站上消失而无法查看。每次向上滚动查看时，系统都会添加更多信息，因此查看它的唯一方法是断开硬件。

我很想知道是否有人可以重定向 Tornado 的输出？

我希望可能有一种方法可以从一个小型 python 应用程序中记录所有内容，以便我可以将过滤器应用于传入信息。我尝试连接到 Tornado 进程，但带有信息的窗口不是标准的 CEditCtrl，因此以这种方式提取文本是死路一条。

有什么想法吗？

**[编辑]**我应该提到我们只运行 Tornado 2.1.0 并且升级到更新的版本是我无法控制的。

**[Edit2]**根据 WinID，Tornado 中的相关窗口是“AfxFrameOrView42”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-22T19:27:04.337

这是另一种可能的方式：

```
-> saveFd = open("myfile.txt",0x102, 0777 )
-> oldFd = ioGlobalStdGet(1)
-> ioGlobalStdSet(1, saveFd)
-> 运行我的测试（）
...
-> ioGlobalStdSet(1, oldFd)

```

这会将**所有**标准输出活动重定向到您打开的文件。您可能必须使用打开的文件名才能使其写入主机（例如使用“host：/myfile.txt”或类似的东西）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T00:52:06.983

主机外壳内置了记录功能。有 3 个环境变量可用（在 6.x 中 - 在 5.x 中不可用）：

RECORD（开/关）：控制外壳记录
RECORD_TYPE（输入/输出/全部）：确定您将记录的内容
RECORD_FILE ：保存内容的文件名。

您使用 ?shConfig 命令来配置 shell 环境变量。?shConfig 本身显示变量。这是我的设置方式：

```
 -> ?shConfig
...
RECORD = off
RECORD_FILE = C:/test.txt
RECORD_TYPE = output
...

-> ?shConfig RECORD_TYPE all
-> ?shConfig RECORD_FILE myData.txt
-> ?shConfig RECORD on
Started recording commands in 'myData.txt'. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T00:39:47.667

我假设您正在使用主机外壳来执行此操作。

如果您通过从 shell（如“runTest()”）启动测试来运行测试，则可以使用重定向运算符 (>) 将该函数的输出发送到主机上的文本文件。

```
> runTest() > mytestResults.txt

```

这会将 runTest 生成的任何输出保存到文件 mytestResults.txt

如果您想一直捕捉屏幕上的所有内容，我将不得不对此进行更多研究。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T04:32:09.823

rlogin vxWorks-target | 三通重定向输出.txt

# c++ - 更改控制台应用程序的默认设置

> ID：106470
> 
> 赞同：0
> 
> 时间：2008-09-19T23:57:21.920
> 
> 标签：c++, visual-studio, visual-c++-6

我希望控制台应用程序默认为

多线程调试。警告级别 4\. 构建浏览信息。没有资源文件夹。

有谁知道任何技术可以让我使用我想要的选项创建一个控制台应用程序，而无需手动设置它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T02:17:22.020

是的，你可以这么做。您想要的是创建自己的项目模板。然后，您可以从新建项目向导中选择该模板。我无法找到有关如何在 Visual Studio 6 中创建项目模板的文档，但[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms247120(VS.80).aspx)解释了 Visual Studio 2005 的过程。希望您会发现这些说明非常相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-27T21:03:03.197

我得出结论这是不可能的。

支持 Windows 项目的自定义应用程序向导，但不支持控制台项目。

这是我做研究的地方。

[http://www.codeproject.com/KB/cpp/genwiz.aspx?fid=15478&df=90&mpp=25&noise=3&](http://www.codeproject.com/KB/cpp/genwiz.aspx?fid=15478&df=90&mpp=25&noise=3&)
sort=Position&view=Quick&select=1266895

[http://msdn.microsoft.com/en-us/library/ms950410.aspx](http://msdn.microsoft.com/en-us/library/ms950410.aspx)

[http://msdn.microsoft.com/en-us/library/aa300499(VS.60).aspx](http://msdn.microsoft.com/en-us/library/aa300499(VS.60).aspx)

自定义应用程序向导将接受 Windows 项目作为模板的基础，但不接受控制台项目。将出现一个消息对话框，声称所选的基础项目不是 c++ 项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T00:35:17.297

事实证明这很容易做到。

在您的工作区中创建一个新的控制台项目，将其命名为 0_console
按您希望的方式设置其特征。（警告级别 4 ...）
退出 msvc，并使用 windows 资源管理器复制项目目录。
将其粘贴到与 0_console 项目相同的目录级别。
将其重命名为您想要的新项目。
进入该目录，编辑 dsp 文件，并将 0_console 值替换为新名称。
保存它，然后进入 msvc，只需将项目插入工作空间

# .net - 调试存储过程（并编写更易于调试的存储过程）的最佳方法是什么？

> ID：106472
> 
> 赞同：21
> 
> 时间：2008-09-19T23:57:28.563
> 
> 标签：.net, sql, stored-procedures

有什么好的方法可以创建可减少调试痛苦的存储过程？有哪些工具可用于调试存储过程？

也许最重要的是，有哪些迹象表明错误发生在存储过程中而不是代码中？我希望我在这里不是太糟糕了。投票选出以上任何一项的答案。谢谢。

对于它的价值，我在 .NET 环境中工作，SQL 服务器。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-20T01:14:34.713

我在存储过程中使用的一种技术可以使它们更易于为 SQL Server 2005 过程调试（无需 IDE 或调试器）：

我在过程的参数列表末尾添加了一个名为 @Debug = 0（默认为 0 = off）的输入参数。

然后我添加 if (@Debug = 1) print '...';

关键时刻代码中的语句以显示任何有用的内部值等。

是的，它是“老派”，让您“走代码”的调试器很棒 - 但这适用于任何 SQL 工具的任何人（包括任何没有使用相同 IDE 进行调试的人）。

罗恩

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T01:23:30.073

我用于简单日志输出和调试的另一种技术是在过程顶部创建一个表变量：

```
 --**************************************************************************
   -- Create a log table variable to store messages to be returned to the
   -- calling application.
   --**************************************************************************
   declare @log             as table ( msg  varchar(MAX) );

then

     insert into @log values ('Inserted a new DVO Order into IRMA, order id: [' + convert(varchar(10), @@IDENTITY ) + ']');
etc.

then ...

   select msg from @log;
end 
```

在过程结束时 - 这取决于调用应用程序记录您的过程调用输出的程度，但我编写的应用程序会记录所有内容。:-)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-30T12:20:59.217

我强烈建议您查看 SQL 管理工作室中的内置工具。

我在这里写了一篇非常详细的博客文章：

[http://www.diaryofaninja.com/blog/2010/11/23/debugging-sql-queries-function-amp-stored-procedures-with-sql-management-studio](http://www.diaryofaninja.com/blog/2010/11/23/debugging-sql-queries-function-amp-stored-procedures-with-sql-management-studio)

基本上它的要点是你输入你的sql查询来执行你的存储过程，而不是按F5或点击感叹号，你点击播放按钮并使用F10和F11单步执行并进入你的存储过程。

非常非常方便 - 似乎没有人使用它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T00:54:35.073

[TSQLUnit](http://tsqlunit.sourceforge.net/)

这是 SQL Server 的单元测试框架。不完全是经典的调试工具，但它确实允许您为存储过程编写单元测试，这可以极大地帮助识别错误并验证预期的行为。

例如，如果您有一个有问题的存储过程，那么您可以编写一些单元测试来了解它是如何失败的。此外，如果您对 SQL 代码进行更改，您可以验证您的更改没有破坏其他任何内容，或者至少告诉您问题出在哪里。

如果某些东西很难测试，那么这可能是一个很好的迹象，表明您的存储过程可能做的太多，如果将其分解为更多焦点和目标的过程，可能会受益。从长远来看，这些过程应该变得相对更容易调试和维护。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T02:06:38.833

我注意到很多关于使用不同环境和技术来调试 SQL procs 的建议，但没有人提到[DBFit](http://benilovj.github.com/dbfit)。如果您不熟悉[Fit](http://fit.c2.com/)和[FitNesse](http://fitnesse.org/)，请帮自己一个忙，然后查找它们。使用这三个工具，您可以快速为自己构建一整套验收测试，让您高枕无忧，因为您知道您可以毫无顾忌地进行重构。

DBFit 只是一系列 Fit Fixtures，可用于练习数据库。使用 Fitness，您可以将尽可能多的调用排列写入存储的过程中，因为您想为其创建测试。

这本身并不是调试，但您会惊讶于一旦您针对单个存储过程进行了整组测试，您可以多快地查明问题。失败的测试将直接引导您解决问题，并为您提供失败的确切上下文，因此无需猜测。最重要的是，您现在可以毫无畏惧地重构您的存储过程，因为您只需重新运行测试以确保您没有破坏任何东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T06:53:31.143

这可能是个人喜好，但我发现阅读全部放在一条长线上的 SQL 查询非常困难。我更喜欢以下缩进样式：

```
SELECT
    [Fields]
FROM
    Table
WHERE
    x = x 
```

在为全新的数据库模式编写存储过程时，这个简单的实践帮助了我很多。通过将语句分成多行，可以更容易地识别查询中错误的罪魁祸首。例如，在 SQL Server Management Studio 中，给出了异常的行号，因此您可以更快地定位有问题的代码。

对您的开发人员同行要轻松...不要将 800 个字符的 SQL 查询塞到一行中。如果数据库字段名称或数据类型更改并且没有人给您发送电子邮件，您稍后会感谢自己。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T00:10:44.883

对于工具，您可以使用 Visual Studio 来调试 SP。如果存储过程的逻辑很长，你可以重构它，创建单独的存储过程，然后从你的主存储过程中调用它。这也将有助于缩小您的测试范围，并让您轻松找到查询的哪一部分是错误的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T01:01:25.837

这是今天向我重申的一些建议 - 如果您要向生产数据库上的重要查询添加连接，请确保连接表中有空字段时它是安全的。

```
LEFT JOIN 
```

在我们发现这是我的小而仓促的存储过程更改之前，我打破了一个重要页面 20 分钟。

并确保在进行更改时测试您的程序。为此，我喜欢在过程的注释中放置一个简单的测试查询。Obvisouly，我今天没能做到这一点:-(

```
/************************************
  MyProcName

  Test:
  -----
  exec MyProcName @myParam
*************************************/ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T01:29:48.903

这可能不是您正在寻找的答案，但如果您已经在 .Net 环境中，LINQtoSQL 已经大大减少了我编写/使用/需要调试的存储过程的数量。

调试 SQL 的困难是在 LINQ 中编写业务逻辑是我新的首选实践的原因之一。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T02:09:17.547

SQL Server 2008 Management Studio 的集成调试器使逐步调试变得轻而易举（与弄清楚如何让 VS2005 + SQL 调试所需的柔道相比）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-20T00:06:43.083

我看到成功使用的几种模式是“诊断”或“测试”模式和日志记录。

执行动态 SQL 执行时，测试或诊断模式很有用。确保您可以看到您将要执行的操作。如果您有需要（或应该）检查错误的区域，请考虑将日志记录到具有足够详细信息的表中，以便诊断正在发生的事情。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-20T00:06:59.150

您可以使用 Sql 服务器调试，但我发现除了最直接的情况（在本地服务器上调试等）之外，这在任何情况下都是一种痛苦。我还没有找到比打印语句更好的东西，所以我会感兴趣地监视这个线程。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-09-03T00:03:09.357

与 Ron 的日志记录类似，我们通过所有其他存储过程调用日志记录过程，以帮助跟踪所有调用。始终使用一个通用的 BatchId 来允许跟踪某个批次运行。它可能不是最高效的过程，但它确实有助于跟踪故障。将摘要报告编译给电子邮件管理员也非常简单。

IE。

```
Select * from LogEvent where BatchId = 'blah' 
```

样品电话

```
EXEC LogEvent @Source='MyProc', @Type='Start'
, @Comment='Processed rows',@Value=50, @BatchId = @batchNum 
```

主进程

```
CREATE PROCEDURE [dbo].[LogEvent]
    @Source varchar(50),
    @Type varchar(50),
    @Comment varchar(400),
    @Value decimal = null,
    @BatchId varchar(255) = 'BLANK'
AS

IF @BatchId = 'BLANK'
  SET @BatchId = NEWID()

  INSERT INTO dbo.Log
    (Source, EventTime, [Type], Comment, [Value],BatchId)
  VALUES
    (@Source, GETDATE(), @Type, @Comment, @Value,@BatchId) 
```

展望未来，利用 CLR 并考虑通过 SQL 调用 Log4Net 之类的东西会很好。由于我们的应用程序代码使用 Log4Net，因此将进程的 SQL 端集成到相同的基础架构中将是有利的。

# debugging - 有没有办法在传统的代码调试意义上调试 Velocity 模板？

> ID：106473
> 
> 赞同：12
> 
> 时间：2008-09-19T23:57:42.230
> 
> 标签：debugging, templates, velocity, vtl

我们在 Web 应用程序中大量使用 Velocity。虽然很容易调试 Java 方面并确保正确填充 Velocity 上下文，但能够在合并步骤中逐步解析 VTL、设置断点等将非常有价值。是否有任何工具还是 IDE/IDE 插件可以通过 VTL（Velocity 模板语言）使这种事情成为可能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-11-01T20:58:34.210

我还没有找到。我能得到的最接近的方法是*破解*一个日志框架来打印出你想要的信息。

你要做的是：

1.  使用返回布尔值的日志记录方法创建一个类。
2.  将对象注入速度上下文
3.  从速度模板内部，您可以调用 logging 方法`#if($logger.log($data)) #end`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T01:36:14.053

可能有？但我发现有效的是，如果将所有内容都放入一个特殊的地图中，那就是放入上下文中。因此，您可以在渲染时将这个特殊映射的全部内容回显到屏幕上（无需知道键）......从而在任何时候指示上下文中任何给定项目的确切值。这不是万无一失的，但 VTL 似乎只适用于“快速和肮脏”的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T10:43:52.110

没有步骤，也没有某种内置的“打印变量”。这也是困扰我的事情，但是使用速度是我在加入我们的项目之前做出的决定......

# windows - 可以通过 WMI 监视另一个进程启动的进程吗？

> ID：106476
> 
> 赞同：1
> 
> 时间：2008-09-19T23:59:44.300
> 
> 标签：windows, scripting, wmi, wsh

我有一个需要安装的安装程序可执行文件。当我运行它时，它会启动一个 msi 来进行实际安装，然后立即死亡。这样做的副作用是它将控制权返回给您在安装完成之前调用它的任何控制台。根据我在哪台机器上运行它，它可能需要三到十分钟，因此不希望调用脚本休眠。我会直接启动 msi，但它抱怨缺少组件。

我有一个 WSH 脚本，它使用 WMI 启动一个进程，然后观察它，直到它的 pid 不再运行。有没有办法确定初始可执行文件正在执行的 MSI 的 pid，然后使用 WMI 观察该 pid 结束？启动进程信息是否甚至与进程相关联？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T00:44:33.833

对具有初始设置作为父进程的进程进行 WMI 查找是否可以解决问题？例如，如果我从进程 ID 为 4000 的命令提示符启动 MSI，我可以执行以下命令行来查找有关 msiexec 进程的信息：

```
c:\>wmic PROCESS WHERE ParentProcessId=4000 GET CommandLine, ProcessId 
CommandLine                                                 ProcessId
"C:\Windows\System32\msiexec.exe" /i "C:\blahblahblah.msi"  2752 
```

这可能是查找所需信息的一种方式。这是在 vbs 中查找该信息的演示：

```
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\.\root\cimv2")
Set colProcesses = objWMIService.ExecQuery("select * from Win32_Process where ParentProcessId = 4000")
For Each objProcess in colProcesses
    Wscript.Echo "Process ID: " & objProcess.ProcessId
Next 
```

我希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T00:46:50.257

如果您使用的是 .NET 语言（您可以在 Win32 中执行此操作，但在 .NET 中更容易），您可以枚举系统中的所有进程（在您对 Setup.exe 的初始调用完成后）并找到所有进程父进程的 PID 等于 Setup.exe 的 PID - 然后监视所有这些进程。他们何时完成 - 设置完成。确保它们也不再产生任何子进程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T04:30:27.410

这应该这样做。

```
$p1 = [diagnostics.process]::start($pathToExecutable) # this way we know the PID of the initial exe
$p2 = get-wmiobject win32_process -filter "ParentProcessId = $($p1.Id)" # using Jim Olsen's tip
(get-process -id $p2.ProcessId).WaitForExit() # voila--no messy sleeping 
```

不幸的是，.NET 对象没有ParentProcessId 属性，而WMI 对象没有WaitForExit() 方法，所以我们必须来回走。

[为这篇文章](http://blogs.msdn.com/powershell/archive/2007/01/16/managing-processes-in-powershell.aspx)向 Jeffrey Snover（总是）提供支持。

# javascript - 嵌入 Ruby 的 Javascript：如何安全地将 ruby 值分配给 javascript 变量

> ID：106481
> 
> 赞同：5
> 
> 时间：2008-09-20T00:00:56.340
> 
> 标签：javascript, ruby

我在页面的 javascript 块中有这一行：

```
res = foo('<%= @ruby_var %>'); 
```

`@ruby_var`处理其中包含单引号的情况的最佳方法是什么？否则它将破坏 JavaScript 代码。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-20T00:29:09.907

我想我会在 @ruby_var 上使用 ruby[​​ JSON](http://json.org)库来为字符串获取正确的 js 语法并摆脱 '', fex.:

```
res = foo(<%= @ruby_var.to_json %>) 
```

（在需要“json”之后，不完全确定如何在页面中执行此操作，或者上述语法是否正确，因为我没有使用那种模板语言）

（另一方面，如果 JSON 曾经更改为与会损坏的 js 不兼容，但是由于大量代码使用 eval() 来评估 json，我怀疑这会很快发生）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-02-14T19:48:41.317

[Rails 在ActionView::Helpers::JavaScriptHelper](http://api.rubyonrails.org/classes/ActionView/Helpers/JavaScriptHelper.html)中有专门用于此任务的方法，称为[escape_javascript](http://api.rubyonrails.org/classes/ActionView/Helpers/JavaScriptHelper.html#method-i-escape_javascript)。

在您的示例中，您将使用以下内容：

```
res = foo('<%= escape_javascript @ruby_var %>'); 
```

或者更好的是，使用**j**快捷方式：

```
res = foo('<%= j @ruby_var %>'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T00:13:10.197

```
@ruby_var.gsub(/[']/, '\\\\\'') 
```

这将用撇号转义单引号，确保您的 Javascript 安全！

此外，如果您在 Rails 中，还有一堆[Javascript 特定的工具](http://rails.rubyonrails.com/classes/ActionView/Helpers/JavaScriptHelper.html#M000440)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T02:24:45.450

你能把字符串放在双引号里吗？

```
res = foo("<%= @ruby_var %>"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-10T17:34:53.440

假设您知道它将是单引号，您也可以使用检查：

```
res = foo(<%= @ruby_var.inspect %>); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T15:06:16.993

我不太喜欢使用嵌入式 Ruby。但是使用`p`(which 调用`inspect`) 而不是`<%=`which 可能正在做类似`print`or的事情怎么样`puts`。 `p`总是打印字符串，就好像它是用双引号括起来的代码一样：

```
>> p "String ' \" String"
"String ' \" String"
# => nil  
>> p 'alpha " \' alpha'
"alpha \" ' alpha"
# => nil 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-12-14T10:05:50.100

您可能希望使用以下第一个属性，从字符串中删除 "，然后您可以继续使用您的`json`函数。

```
res = foo('<%= @ruby_var %>.first'); 
```

# arrays - 在 awk 中对哈希/数组进行排序

> ID：106484
> 
> 赞同：2
> 
> 时间：2008-09-20T00:01:59.553
> 
> 标签：arrays, hash, sorting, awk

有没有一种简单的方法可以在 awk 中执行以下任何操作？

*   按数据对数组/哈希进行排序
*   通过它的字符串键对哈希进行排序

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T00:05:30.980

这是其他人对非常相似的问题的回答：http: [//www.computing.net/answers/unix/urgent-help-with-sorting-in-awk/4442.html](http://www.computing.net/answers/unix/urgent-help-with-sorting-in-awk/4442.html)

应该是这样的：

```
gawk 'BEGIN {c=1} { array[c] = sprintf ("%s %s", $2, $1); c++ } 
END { asort(array); for (x=1;x&lt;c;x++) { print array[x] } }' 
```

请注意，我使用了“gawk”。如果您想要内置排序，请使用 gawk。

该示例采用键值对的“空格分隔”输入，并根据第二个值对它们进行排序（当然，它以值/键格式将它们打印出来，但你会看到我在那里做什么。）

为了对 gawk 中现有的数组执行此操作，您将使用类似的东西。

如果使用 awk 或 mawk，则必须使用手册页中提供的众多排序功能之一来完成排序。

> 来自 gawk 联机帮助页：AWK 中的所有数组都是关联的，即由字符串值索引。特殊运算符 in 可以在 if 或 while 语句中使用，以查看数组是否具有由特定值组成的索引。if (val in array) print array[val] 如果数组有多个下标，则在数组中使用 (i, j)。

# c++ - 什么是智能指针，我应该什么时候使用它？

> ID：106508
> 
> 赞同：2035
> 
> 时间：2008-09-20T00:09:24.963
> 
> 标签：c++, pointers, c++11, smart-pointers, c++-faq

什么是智能指针，我应该什么时候使用它？

* * *

## 回答 #1

> 赞同：1997
> 
> 时间：2008-09-20T00:48:23.480

**更新**

这个答案相当陈旧，因此描述了当时“好”的东西，即 Boost 库提供的智能指针。从 C++11 开始，标准库已经提供了足够多的智能指针类型，所以你应该倾向于使用[`std::unique_ptr`](http://en.cppreference.com/w/cpp/memory/unique_ptr),[`std::shared_ptr`](http://en.cppreference.com/w/cpp/memory/shared_ptr)和[`std::weak_ptr`](http://en.cppreference.com/w/cpp/memory/weak_ptr).

还有[`std::auto_ptr`](http://en.cppreference.com/w/cpp/memory/auto_ptr)。它非常像一个作用域指针，除了它还具有被复制的“特殊”危险能力——这也会意外地转移所有权。
**它在 C++11 中被弃用并在 C++17 中被删除**，所以你不应该使用它。

```
std::auto_ptr<MyObject> p1 (new MyObject());
std::auto_ptr<MyObject> p2 = p1; // Copy and transfer ownership. 
                                 // p1 gets set to empty!
p2->DoSomething(); // Works.
p1->DoSomething(); // Oh oh. Hopefully raises some NULL pointer exception. 
```

* * *

**旧答案**

智能指针是包装“原始”（或“裸”）C++ 指针的类，用于管理所指向对象的生命周期。没有单一的智能指针类型，但它们都试图以实用的方式抽象原始指针。

智能指针应该优先于原始指针。如果你觉得你需要使用指针（首先考虑你是否*真的*这样做），你通常会想要使用智能指针，因为这可以缓解原始指针的许多问题，主要是忘记删除对象和内存泄漏。

使用原始指针，程序员必须在对象不再有用时显式销毁它。

```
// Need to create the object to achieve some goal
MyObject* ptr = new MyObject(); 
ptr->DoSomething(); // Use the object in some way
delete ptr; // Destroy the object. Done with it.
// Wait, what if DoSomething() raises an exception...? 
```

相比之下，智能指针定义了关于何时销毁对象的策略。您仍然必须创建对象，但您不再需要担心销毁它。

```
SomeSmartPtr<MyObject> ptr(new MyObject());
ptr->DoSomething(); // Use the object in some way.

// Destruction of the object happens, depending 
// on the policy the smart pointer class uses.

// Destruction would happen even if DoSomething() 
// raises an exception 
```

使用中最简单的策略涉及智能指针包装对象的范围，例如由[`boost::scoped_ptr`](http://www.boost.org/doc/libs/release/libs/smart_ptr/scoped_ptr.htm)or实现[`std::unique_ptr`](http://en.cppreference.com/w/cpp/memory/unique_ptr)。

```
void f()
{
    {
       std::unique_ptr<MyObject> ptr(new MyObject());
       ptr->DoSomethingUseful();
    } // ptr goes out of scope -- 
      // the MyObject is automatically destroyed.

    // ptr->Oops(); // Compile error: "ptr" not defined
                    // since it is no longer in scope.
} 
```

请注意，`std::unique_ptr`不能复制实例。这可以防止指针被多次（错误地）删除。但是，您可以将对它的引用传递给您调用的其他函数。

`std::unique_ptr`当您想将对象的生命周期与特定代码块联系起来时，或者如果您将其作为成员数据嵌入到另一个对象中，则 s 很有用，即另一个对象的生命周期。该对象一直存在，直到退出包含代码块，或者直到包含对象本身被销毁。

更复杂的智能指针策略涉及对指针的引用计数。这确实允许复制指针。当对象的最后一个“引用”被销毁时，该对象被删除。该政策由[`boost::shared_ptr`](http://www.boost.org/doc/libs/release/libs/smart_ptr/shared_ptr.htm)和实施[`std::shared_ptr`](http://en.cppreference.com/w/cpp/memory/shared_ptr)。

```
void f()
{
    typedef std::shared_ptr<MyObject> MyObjectPtr; // nice short alias
    MyObjectPtr p1; // Empty

    {
        MyObjectPtr p2(new MyObject());
        // There is now one "reference" to the created object
        p1 = p2; // Copy the pointer.
        // There are now two references to the object.
    } // p2 is destroyed, leaving one reference to the object.
} // p1 is destroyed, leaving a reference count of zero. 
  // The object is deleted. 
```

当对象的生命周期要复杂得多并且不直接绑定到特定代码段或另一个对象时，引用计数指针非常有用。

引用计数指针有一个缺点——创建悬空引用的可能性：

```
// Create the smart pointer on the heap
MyObjectPtr* pp = new MyObjectPtr(new MyObject())
// Hmm, we forgot to destroy the smart pointer,
// because of that, the object is never destroyed! 
```

另一种可能性是创建循环引用：

```
struct Owner {
   std::shared_ptr<Owner> other;
};

std::shared_ptr<Owner> p1 (new Owner());
std::shared_ptr<Owner> p2 (new Owner());
p1->other = p2; // p1 references p2
p2->other = p1; // p2 references p1

// Oops, the reference count of of p1 and p2 never goes to zero!
// The objects are never destroyed! 
```

为了解决这个问题，Boost 和 C++11 都定义了 a`weak_ptr`来定义对 a 的弱（未计数）引用`shared_ptr`。

* * *

## 回答 #2

> 赞同：373
> 
> 时间：2015-05-09T19:06:44.070

这是现代 C++（C++11 及更高版本）的一个简单答案：

*   **“什么是智能指针？”**
    它是一种类型，其值可以像指针一样使用，但它提供了自动内存管理的附加功能：当智能指针不再使用时，它指向的内存将被释放（另请参阅[Wikipedia 上的更详细定义](http://en.wikipedia.org/wiki/Smart_pointer)）。
*   **“我什么时候应该用一个？”**
    在涉及跟踪一块内存的所有权、分配或取消分配的代码中；智能指针通常使您无需明确地执行这些操作。
*   **“但是在哪种情况下我应该使用哪个智能指针？”**
    *   [`std::unique_ptr`](http://en.cppreference.com/w/cpp/memory/unique_ptr)当您希望您的对象与对它的单个拥有引用一样长时使用。例如，将它用于指向内存的指针，该指针在进入某个范围时被分配并在退出范围时被取消分配。
    *   当您确实想从多个位置引用您的对象时使用[`std::shared_ptr`](http://en.cppreference.com/w/cpp/memory/shared_ptr)- 并且不希望您的对象被取消分配，直到所有这些引用本身都消失了。
    *   当您确实想从多个位置引用您的对象时使用[`std::weak_ptr`](http://en.cppreference.com/w/cpp/memory/weak_ptr)- 对于那些可以忽略和解除分配的引用（因此当您尝试解除引用时他们只会注意到该对象已消失）。
    *   不要使用`boost::`智能指针，`std::auto_ptr`除非在特殊情况下，如果你必须阅读的话。
*   **“喂，我没问用哪一个！”**
    啊，但你真的很想，承认吧。
*   **“那么我什么时候应该使用常规指针呢？”**
    主要是在忽略内存所有权的代码中。这通常是在从其他地方获取指针并且不分配或取消分配的函数中，并且不存储指针的副本，该副本的执行时间超过了它们的执行时间。

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2008-09-20T00:32:49.040

[智能指针](http://en.wikipedia.org/wiki/Smart_pointer)是一种类似指针的类型，具有一些附加功能，例如自动内存释放、引用计数等。

智能指针页面上提供了一个简短的介绍[- 什么，为什么，哪个？](http://ootips.org/yonat/4dev/smart-pointers.html).

一种简单的智能指针类型是[`std::auto_ptr`](http://en.cppreference.com/w/cpp/memory/auto_ptr)（C++ 标准的第 20.4.5 章），它允许在超出范围时自动释放内存，并且在抛出异常时比简单的指针使用更健壮，尽管灵活性较差。

另一种方便的类型是[`boost::shared_ptr`](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/shared_ptr.htm)实现引用计数并在没有对对象的引用时自动释放内存。这有助于避免内存泄漏，并且易于使用来实现[RAII](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)。

该主题在[David Vandevoorde、Nicolai M. Josuttis 所著的“C++ 模板：完整指南”](https://rads.stackoverflow.com/amzn/click/com/0201734842)一书的第 20 章“智能指针”中进行了深入介绍。涵盖的一些主题：

*   防止异常
*   持有者，（注意，[std::auto_ptr](http://en.cppreference.com/w/cpp/memory/auto_ptr)是这种类型的智能指针的实现）
*   [资源获取就是初始化](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)（这在 C++ 中经常用于异常安全的资源管理）
*   持有人限制
*   [引用计数](http://en.wikipedia.org/wiki/Reference_counting)
*   并发计数器访问
*   销毁和释放

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2008-09-20T01:53:30.533

Chris、Sergdev 和 Llyod 提供的定义是正确的。不过，我更喜欢一个更简单的定义，只是为了让我的生活简单：智能指针只是一个重载`->` and`*`运算符的类。这意味着您的对象在语义上看起来像一个指针，但您可以让它做一些更酷的事情，包括引用计数、自动销毁等 `shared_ptr`，并且`auto_ptr`在大多数情况下就足够了，但伴随着它们自己的一组小特质。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2008-09-20T00:13:25.750

智能指针类似于常规（类型化）指针，如“char*”，除非指针本身超出范围，然后它指向的内容也会被删除。您可以像使用常规指针一样使用它，使用“->”，但如果您需要指向数据的实际指针，则不能。为此，您可以使用“&*ptr”。

它适用于：

*   必须使用 new 分配的对象，但您希望与该堆栈上的某些对象具有相同的生命周期。如果对象被分配给智能指针，那么它们将在程序退出该功能/块时被删除。

*   类的数据成员，因此当对象被删除时，所有拥有的数据也会被删除，而在析构函数中没有任何特殊代码（您需要确保析构函数是虚拟的，这几乎总是一件好事） .

在以下情况下，您可能*不想*使用智能指针：

*   ...指针实际上不应该拥有数据...即，当您只是使用数据时，但您希望它在您引用它的函数中存在。
*   ...智能指针本身不会在某个时候被破坏。您不希望它位于永远不会被破坏的内存中（例如在动态分配但不会被显式删除的对象中）。
*   ...两个智能指针可能指向相同的数据。（然而，还有更智能的指针可以处理这个问题……这就是所谓的[引用计数](http://en.wikipedia.org/wiki/Reference_counting)。）

也可以看看：

*   [垃圾收集](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))。
*   这个关于数据所有权的[堆栈溢出问题](https://stackoverflow.com/questions/94227/smart-pointers-or-who-owns-you-baby)

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2013-03-12T09:51:18.110

智能指针是一个类似于指针的对象，但还提供对构造、销毁、复制、移动和取消引用的控制。

可以实现自己的智能指针，但许多库也提供智能指针实现，每个都有不同的优点和缺点。

例如，[Boost](http://www.boost.org/)提供了以下智能指针实现：

*   `shared_ptr<T>`是一个指针，指向`T`使用引用计数来确定何时不再需要该对象。
*   `scoped_ptr<T>`是超出范围时自动删除的指针。没有分配是可能的。
*   `intrusive_ptr<T>`是另一个引用计数指针。它提供了比 更好的性能`shared_ptr`，但需要类型`T`提供自己的引用计数机制。
*   `weak_ptr<T>`是一个弱指针，与`shared_ptr`避免循环引用一起工作。
*   `shared_array<T>`就像`shared_ptr`，但对于`T`.
*   `scoped_array<T>`就像`scoped_ptr`，但对于`T`.

这些只是每个的一个线性描述，可以根据需要使用，有关更多详细信息和示例，可以查看 Boost 的文档。

此外，C++ 标准库提供了三个智能指针；`std::unique_ptr`对于唯一所有权，`std::shared_ptr`对于共享所有权和`std::weak_ptr`. `std::auto_ptr`存在于 C++03 中，但现在已弃用。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2008-09-20T00:14:52.297

大多数类型的智能指针都会为您处理指向对象的处置。它非常方便，因为您不必再​​考虑手动处理对象了。

最常用的智能指针是`std::tr1::shared_ptr`（或`boost::shared_ptr`），以及不太常用的`std::auto_ptr`。我建议经常使用`shared_ptr`.

`shared_ptr`非常通用，可以处理各种各样的处理场景，包括对象需要“跨 DLL 边界传递”的情况（如果`libc`您的代码和 DLL 之间使用不同的 s，这是常见的噩梦情况）。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2014-03-07T09:03:03.213

这是类似答案的链接： http: [//sickprogrammersarea.blogspot.in/2014/03/technical-interview-questions-on-c_6.html](http://sickprogrammersarea.blogspot.in/2014/03/technical-interview-questions-on-c_6.html)

智能指针是一个对象，其行为、外观和感觉都像普通指针，但提供更多功能。在 C++ 中，智能指针被实现为封装指针并覆盖标准指针运算符的模板类。与常规指针相比，它们具有许多优点。它们保证被初始化为空指针或指向堆对象的指针。检查通过空指针的间接性。不需要删除。当指向它们的最后一个指针消失时，对象会自动释放。这些智能指针的一个重要问题是，与常规指针不同，它们不尊重继承。智能指针对多态代码没有吸引力。下面给出了智能指针的实现示例。

**例子：**

```
template <class X>
class smart_pointer
{
          public:
               smart_pointer();                          // makes a null pointer
               smart_pointer(const X& x)            // makes pointer to copy of x

               X& operator *( );
               const X& operator*( ) const;
               X* operator->() const;

               smart_pointer(const smart_pointer <X> &);
               const smart_pointer <X> & operator =(const smart_pointer<X>&);
               ~smart_pointer();
          private:
               //...
}; 
```

这个类实现了一个指向 X 类型对象的智能指针。对象本身位于堆上。以下是如何使用它：

```
smart_pointer <employee> p= employee("Harris",1333); 
```

与其他重载运算符一样，p 的行为类似于常规指针，

```
cout<<*p;
p->raise_salary(0.5); 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2016-03-03T00:58:48.883

让 T 成为本教程中的一个类 C++ 中的指针可以分为 3 种类型：

1）**原始指针**：

```
T a;  
T * _ptr = &a; 
```

它们将内存地址保存到内存中的某个位置。谨慎使用，因为程序变得复杂难以跟踪。

带有 const 数据或地址的指针 { 向后读取 }

```
T a ; 
const T * ptr1 = &a ; 
T const * ptr1 = &a ; 
```

指向数据类型 T 的指针，它是一个 const。这意味着您不能使用指针更改数据类型。即`*ptr1 = 19`；不管用。但是你可以移动指针。即`ptr1++ , ptr1--`；等会工作。向后阅读：指向类型 T 的指针，它是 const

```
 T * const ptr2 ; 
```

指向数据类型 T 的 const 指针。这意味着您不能移动指针，但可以更改指针指向的值。即`*ptr2 = 19`会工作，但`ptr2++ ; ptr2--`等不会工作。向后阅读：指向类型 T 的 const 指针

```
const T * const ptr3 ; 
```

指向 const 数据类型 T 的 const 指针。这意味着您不能移动指针，也不能将数据类型指针更改为指针。IE 。`ptr3-- ; ptr3++ ; *ptr3 = 19;`不管用

3）**智能指针**：{ `#include <memory>`}

**共享指针**：

```
 T a ; 
     //shared_ptr<T> shptr(new T) ; not recommended but works 
     shared_ptr<T> shptr = make_shared<T>(); // faster + exception safe

     std::cout << shptr.use_count() ; // 1 //  gives the number of " 
things " pointing to it. 
     T * temp = shptr.get(); // gives a pointer to object

     // shared_pointer used like a regular pointer to call member functions
      shptr->memFn();
     (*shptr).memFn(); 

    //
     shptr.reset() ; // frees the object pointed to be the ptr 
     shptr = nullptr ; // frees the object 
     shptr = make_shared<T>() ; // frees the original object and points to new object 
```

使用引用计数来实现，以跟踪有多少“事物”指向指针所指向的对象。当此计数变为 0 时，该对象被自动删除，即当所有指向该对象的 share_ptr 超出范围时，objected 被删除。这消除了必须删除使用 new 分配的对象的麻烦。

**弱指针：** 帮助处理使用共享指针时出现的循环引用当共享指针超出范围时被删除。要解决此问题，请将内部成员从 shared_ptr 更改为 weak_ptr。注意：要访问弱指针指向的元素，请使用 lock() ，这将返回一个weak_ptr。

```
T a ; 
shared_ptr<T> shr = make_shared<T>() ; 
weak_ptr<T> wk = shr ; // initialize a weak_ptr from a shared_ptr 
wk.lock()->memFn() ; // use lock to get a shared_ptr 
//   ^^^ Can lead to exception if the shared ptr has gone out of scope
if(!wk.expired()) wk.lock()->memFn() ;
// Check if shared ptr has gone out of scope before access 
```

请参阅：[std::weak_ptr 何时有用？](https://stackoverflow.com/questions/12030650/when-is-stdweak-ptr-useful)

**唯一指针：** 具有专有所有权的轻量级智能指针。当指针指向唯一对象而不在指针之间共享对象时使用。

```
unique_ptr<T> uptr(new T);
uptr->memFn(); 

//T * ptr = uptr.release(); // uptr becomes null and object is pointed to by ptr
uptr.reset() ; // deletes the object pointed to by uptr 
```

要更改唯一 ptr 指向的对象，请使用移动语义

```
unique_ptr<T> uptr1(new T);
unique_ptr<T> uptr2(new T);
uptr2 = std::move(uptr1); 
// object pointed by uptr2 is deleted and 
// object pointed by uptr1 is pointed to by uptr2
// uptr1 becomes null 
```

参考：它们本质上可以作为 const 指针，即一个 const 指针，不能用更好的语法移动。

请参阅：[C++ 中的指针变量和引用变量有什么区别？](https://stackoverflow.com/questions/57483/what-are-the-differences-between-a-pointer-variable-and-a-reference-variable-in)

```
r-value reference : reference to a temporary object   
l-value reference : reference to an object whose address can be obtained
const reference : reference to a data type which is const and cannot be modified 
```

参考： https: [//www.youtube.com/channel/UCEOGtxYTB6vo6MQ-WQ9W_nQ](https://www.youtube.com/channel/UCEOGtxYTB6vo6MQ-WQ9W_nQ) 感谢 Andre 指出这个问题。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-20T00:12:10.573

[http://en.wikipedia.org/wiki/Smart_pointer](http://en.wikipedia.org/wiki/Smart_pointer)

> 在计算机科学中，智能指针是一种抽象数据类型，它模拟指针同时提供附加功能，例如自动垃圾收集或边界检查。这些附加功能旨在减少因滥用指针而导致的错误，同时保持效率。出于内存管理的目的，智能指针通常会跟踪指向它们的对象。指针的滥用是错误的主要来源：使用指针编写的程序必须执行的常量分配、释放和引用使得很可能会发生一些内存泄漏。智能指针试图通过自动释放资源来防止内存泄漏：当指向对象的指针（或一系列指针中的最后一个）被销毁时，

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-06-12T23:23:27.347

智能指针是一个类，是普通指针的包装器。与普通指针不同，智能点的生命周期基于引用计数（分配智能指针对象的次数）。因此，每当将一个智能指针分配给另一个智能指针时，内部引用计数就会加上。并且每当对象超出范围时，引用计数减负。

自动指针虽然看起来很相似，但与智能指针完全不同。这是一个方便的类，当自动指针对象超出变量范围时，它会释放资源。在某种程度上，它使指针（指向动态分配的内存）的工作方式类似于堆栈变量（在编译时静态分配）。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2020-08-09T10:04:03.887

什么是智能指针。

长版，原则上：

[https://web.stanford.edu/class/archive/cs/cs106l/cs106l.1192/lectures/lecture15/15_RAII.pdf](https://web.stanford.edu/class/archive/cs/cs106l/cs106l.1192/lectures/lecture15/15_RAII.pdf)

现代 C++ 习语：

```
RAII: Resource Acquisition Is Initialization.

● When you initialize an object, it should already have 
  acquired any resources it needs (in the constructor).

● When an object goes out of scope, it should release every 
  resource it is using (using the destructor). 
```

关键：

```
● There should never be a half-ready or half-dead object.
● When an object is created, it should be in a ready state.
● When an object goes out of scope, it should release its resources. 
● The user shouldn’t have to do anything more. 
```

**原始指针违反 RAII**：当指针超出范围时需要用户手动删除。

RAII 解决方案是：

```
Have a smart pointer class:
● Allocates the memory when initialized
● Frees the memory when destructor is called
● Allows access to underlying pointer 
```

对于需要复制和共享的智能指针，请使用 shared_ptr：

```
● use another memory to store Reference counting and shared.
● increment when copy, decrement when destructor.
● delete memory when Reference counting is 0\. 
  also delete memory that store Reference counting. 
```

对于不拥有原始指针的智能指针，请使用weak_ptr：

```
● not change Reference counting. 
```

shared_ptr 用法：

```
correct way:
std::shared_ptr<T> t1 = std::make_shared<T>(TArgs);
std::shared_ptr<T> t2 = std::shared_ptr<T>(new T(Targs));

wrong way:
T* pt = new T(TArgs); // never exposure the raw pointer
shared_ptr<T> t1 = shared_ptr<T>(pt);
shared_ptr<T> t2 = shared_ptr<T>(pt); 
```

始终避免使用原始指针。

对于必须使用原始指针的场景：

[https://stackoverflow.com/a/19432062/2482283](https://stackoverflow.com/a/19432062/2482283)

对于非 nullptr 的原始指针，请改用引用。

```
not use T*
use T& 
```

对于可能为 nullptr 的可选引用，请使用原始指针，这意味着：

```
T* pt; is optional reference and maybe nullptr.
Not own the raw pointer, 
Raw pointer is managed by some one else.
I only know that the caller is sure it is not released now. 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-11-07T04:07:54.887

智能指针是那些您不必担心内存解除分配、资源共享和传输的指针。

您可以很好地使用这些指针，就像在 Java 中进行任何分配一样。在 java Garbage Collector 中可以做到这一点，而在 Smart Pointers 中，这个技巧是由析构函数完成的。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-01-26T03:10:57.513

现有答案很好，但没有涵盖当智能指针不是您要解决的问题的（完整）答案时该怎么做。

除其他外（在其他答案中有很好的解释），使用智能指针是[我们如何使用抽象类作为函数返回类型的可能解决方案？](https://stackoverflow.com/questions/48454208/how-do-we-use-a-abstract-class-as-a-function-return-type)已被标记为此问题的副本。但是，如果想在 C++ 中将抽象（或实际上任何）基类指定为返回类型，第一个要问的问题是“你真正的意思是什么？”。[在boost 指针容器库](http://www.boost.org/doc/libs/1_66_0/libs/ptr_container/doc/guidelines.html#recommended-practice-for-object-oriented-programming)的文档中，对 C++ 中惯用的面向对象编程（以及这与其他语言有何不同）进行了很好的讨论（有进一步的参考资料）. 总之，在 C++ 中，您必须考虑所有权。哪些智能指针可以帮助您，但不是唯一的解决方案，或者始终是完整的解决方案（它们不会为您提供多态副本）并且并不总是您想要在界面中公开的解决方案（并且函数返回听起来很糟糕很像一个界面）。例如，返回一个引用可能就足够了。但在所有这些情况下（智能指针、指针容器或简单地返回引用），您已经将返回值从*值*更改为某种形式的*引用*。如果您真的需要副本，您可能需要添加更多样板“习语”或超越 C++ 中的惯用（或其他）OOP，使用[Adob​​e Poly](http://stlab.adobe.com/group__poly__related.html)或[Boost.TypeErasure等库进行更通用的多态性](http://www.boost.org/doc/libs/1_66_0/doc/html/boost_typeerasure.html).

# asp.net - 表单提交时禁用按钮

> ID：106509
> 
> 赞同：15
> 
> 时间：2008-09-20T00:09:30.330
> 
> 标签：asp.net, javascript, webforms

我有一个按钮，我想在表单提交时禁用它以防止用户多次提交。

我曾尝试使用 javascript onclick 天真地禁用该按钮，但是如果客户端验证失败，则该按钮仍然被禁用。

当表单成功提交时，我如何禁用按钮，而不仅仅是在用户单击时？

这是一个 ASP.NET 表单，所以如果可能的话，我想很好地与 asp.net ajax 页面生命周期挂钩。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-04T21:54:06.117

我不喜欢在代码隐藏中编写所有这些 javascript。这是我的最终解决方案的样子。

按钮：

```
<asp:Button ID="btnSubmit" runat="server" Text="Submit" OnClick="btnSubmit_Click" OnClientClick="doSubmit(this)" /> 
```

Javascript：

```
<script type="text/javascript"><!--
function doSubmit(btnSubmit) {
    if (typeof(Page_ClientValidate) == 'function' && Page_ClientValidate() == false) { 
        return false;
    }    
    btnSubmit.disabled = 'disabled';
    btnSubmit.value = 'Processing. This may take several minutes...';
    <%= ClientScript.GetPostBackEventReference(btnSubmit, string.Empty) %>;    
}
//-->
</script> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-20T03:27:41.180

试一试：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Threading;

public partial class _Default : System.Web.UI.Page 
{
    protected void Page_Load(object sender, EventArgs e)
    {

         // Identify button as a "disabled-when-clicked" button...
         WebHelpers.DisableButtonOnClick( buttonTest, "showPleaseWait" ); 
    }

    protected void buttonTest_Click( object sender, EventArgs e )
    {
        // Emulate a server-side process to demo the disabled button during
        // postback.
        Thread.Sleep( 5000 );
    }
}

using System;
using System.Web;
using System.Web.UI.WebControls;
using System.Text;

public class WebHelpers
{
    //
    // Disable button with no secondary JavaScript function call.
    //
    public static void DisableButtonOnClick( Button ButtonControl )
    {
        DisableButtonOnClick( ButtonControl, string.Empty );    
    }

    //
    // Disable button with a JavaScript function call.
    //
    public static void DisableButtonOnClick( Button ButtonControl, string ClientFunction )
    {   
        StringBuilder sb = new StringBuilder( 128 );

        // If the page has ASP.NET validators on it, this code ensures the
        // page validates before continuing.
        sb.Append( "if ( typeof( Page_ClientValidate ) == 'function' ) { " );
        sb.Append( "if ( ! Page_ClientValidate() ) { return false; } } " );

        // Disable this button.
        sb.Append( "this.disabled = true;" ); 

        // If a secondary JavaScript function has been provided, and if it can be found,
        // call it. Note the name of the JavaScript function to call should be passed without
        // parens.
        if ( ! String.IsNullOrEmpty( ClientFunction ) ) 
        {
            sb.AppendFormat( "if ( typeof( {0} ) == 'function' ) {{ {0}() }};", ClientFunction );  
        }

        // GetPostBackEventReference() obtains a reference to a client-side script function 
        // that causes the server to post back to the page (ie this causes the server-side part 
        // of the "click" to be performed).
        sb.Append( ButtonControl.Page.ClientScript.GetPostBackEventReference( ButtonControl ) + ";" );

        // Add the JavaScript created a code to be executed when the button is clicked.
        ButtonControl.Attributes.Add( "onclick", sb.ToString() );
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-20T02:39:03.123

以下功能很有用，不需要往往不可靠的禁用部分。只需使用“return check_submit();” 作为提交按钮的 onclick 处理程序的一部分。

还应该有一个隐藏字段来保存 form_submitted 初始值 0；

```
<input type="hidden" name="form_submitted" value="0">

function check_submit (){
            if (document.Form1.form_submitted.value == 1){
                alert("Don't submit twice. Please wait.");
                return false;
            }
            else{
                document.Form1.form_submitted.value = 1;
                return true;
            }
            return false;
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T00:14:29.273

在提交处理程序的最后禁用按钮。如果验证失败，它应该在此之前返回 false。

但是，JavaScript 方法不是可以依赖的，因此您也应该有一些东西来检测服务器上的重复项。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T06:35:51.947

如果验证成功，则禁用该按钮。如果不是，那就不要。

```
function validate(form) {
  // perform validation here
  if (isValid) {
    form.mySubmitButton.disabled = true;
    return true;
  } else {
    return false;
  }
}

<form onsubmit="return validate(this);">...</form> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T16:45:17.503

将按钮的可见性设置为“无”；

```
 btnSubmit.Attributes("onClick") = document.getElementById('btnName').style.display = 'none';
```

它不仅可以防止重复提交，而且可以清楚地向用户表明您不想多次按下按钮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T00:15:09.787

不确定这是否有帮助，但表单中有 onsubmit 事件。每当表单提交（从任何按钮或控件）时，您都可以使用此事件。供参考：[http ://www.htmlcodetutorial.com/forms/_FORM_onSubmit.html](http://www.htmlcodetutorial.com/forms/_FORM_onSubmit.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T02:43:18.230

一个解决方案是在单击按钮时设置一个隐藏字段，编号为 1。

在按钮单击处理程序上，首先检查该数字是否不是 1，只是从函数中返回。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T03:05:06.493

您还可以利用表单上可用的 onsubmit() javascript 事件。此事件在表单实际提交时触发，并且在验证完成之前不应捕获。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T14:37:39.870

这是一种比[rp](https://stackoverflow.com/questions/106509/disable-button-on-form-submission#106958)建议的更简单但相似的方法：

```
function submit(button) {
        Page_ClientValidate(); 
        if(Page_IsValid)
        {
            button.disabled = true;
        }
}

 <asp:Button runat="server" ID="btnSubmit" OnClick="btnSubmit_OnClick" OnClientClick="submit(this)" Text="Submit Me" /> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-01T23:12:09.897

刚刚听说过 <asp:Button> 的“DisableOnSubmit”属性，如下所示：

```
<asp:Button ID="submit" runat="server" Text="Save"
    OnClick="yourClickEvent" DisableOnSubmit="true" /> 
```

渲染时，按钮的 onclick 属性如下所示：

```
onclick="this.disabled=true; setTimeout('enableBack()', 3000);
  WebForm_DoPostBackWithOptions(new
  WebForm_PostBackOptions('yourControlsName', '', true, '', '', false, true)) 
```

“enableBack()” javascript 函数如下所示：

```
function enableBack()
{
    document.getElementById('yourControlsName').disabled=false;
} 
```

所以当按钮被点击时，它会被禁用 3 秒。如果表单成功发布，那么您永远不会看到重新启用按钮。但是，如果任何验证器失败，则该按钮会在 3 秒后再次启用。

所有这一切只需在按钮上设置一个属性——无需手动编写 JavaScript 代码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-05T10:06:24.470

请注意，如果您使用带有`UseSubmitBehavior="false"`.

我使用 rp 代码的以下变体：

```
public static void DisableButtonOnClick(Button button, string clientFunction)
{
    // If the page has ASP.NET validators on it, this code ensures the
    // page validates before continuing.
    string script = "if (typeof(Page_ClientValidate) == 'function') { "
            + "if (!Page_ClientValidate()) { return false; } } ";

    // disable the button
    script += "this.disabled = true; ";

    // If a secondary JavaScript function has been provided, and if it can be found, call it.
    // Note the name of the JavaScript function to call should be passed without parens.
    if (!string.IsNullOrEmpty(clientFunction))
        script += string.Format("if (typeof({0}) == 'function') {{ {0}() }} ", clientFunction);

    // only need to post back if button is using submit behaviour
    if (button.UseSubmitBehavior)
        script += button.Page.GetPostBackEventReference(button) + "; ";

    button.Attributes.Add("onclick", script);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-05T10:38:21.583

正确的（至少就用户友好性而言）方法是使用 OnClientClick 属性禁用按钮，执行客户端验证，然后使用结果来继续或重新启用按钮。

当然，您还应该为此编写服务器端代码，因为即使由于 JavaScript 的缺乏或特定实现，您也不能依赖验证。但是，如果您依赖服务器控制按钮的启用/禁用状态，那么您基本上无法阻止用户多次提交表单。出于这个原因，您应该有某种逻辑来检测同一用户在短时间内的多次提交（例如，来自同一会话的相同值）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-02T09:14:15.273

我的解决方案之一如下：

在您的 aspx 文件的 page_load 中添加脚本

```
 HtmlGenericControl includeMyJava = new HtmlGenericControl("script");
    includeMyJava.Attributes.Add("type", "text/javascript");
    includeMyJava.InnerHtml = "\nfunction dsbButton(button) {";
    includeMyJava.InnerHtml += "\nPage_ClientValidate();";
    includeMyJava.InnerHtml += "\nif(Page_IsValid)";
    includeMyJava.InnerHtml += "\n{";
    includeMyJava.InnerHtml += "\nbutton.disabled = true;";
    includeMyJava.InnerHtml += "}";
    includeMyJava.InnerHtml += "\n}";
    this.Page.Header.Controls.Add(includeMyJava); 
```

然后将您的 aspx 按钮参数设置如下：

```
<asp:Button ID="send" runat="server" UseSubmitBehavior="false" OnClientClick="dsbButton(this);" Text="Send" OnClick="send_Click" /> 
```

请注意，“onClientClick”有助于禁用按钮，“UseSubmitBehaviour”禁用页面的传统提交行为，并允许asp.net在用户脚本上呈现提交行为。

祝你好运

- 瓦卡斯阿斯拉姆

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-01-25T19:04:09.757

因此，简单地通过 javascript 禁用按钮不是跨浏览器兼容的选项。如果您只使用 Chrome 将不会提交表单`OnClientClick="this.disabled=true;"`
以下是我在 Firefox 9、Internet Explorer 9 和 Chrome 16 中测试过的解决方案：

```
<script type="text/javascript">
var buttonToDisable;
function disableButton(sender)
{
    buttonToDisable=sender;
    setTimeout('if(Page_IsValid==true)buttonToDisable.disabled=true;', 10);
}
</script> 
```

然后使用表单提交按钮的单击事件注册“disableButton”，一种方法是：

```
<asp:Button runat="server" ID="btnSubmit" Text="Submit" OnClientClick="disableButton(this);" /> 
```

值得注意的是，如果客户端验证失败，这可以解决您禁用按钮的问题。也不需要服务器端处理。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-05-22T09:58:29.187

在@rp. 的回答的基础上，我对其进行了修改以调用自定义函数，并在成功时提交和禁用，或者在错误时“停止”：

```
public static void DisableButtonOnClick(Button ButtonControl, string ClientFunction)
{
    StringBuilder sb = new StringBuilder(128);

    if (!String.IsNullOrEmpty(ClientFunction))
    {
        sb.AppendFormat("if (typeof({0}) == 'function') {{ if ({0}()) {{ {1}; this.disabled=true; return true; }} else {{ return false; }} }};", ClientFunction, ButtonControl.Page.ClientScript.GetPostBackEventReference(ButtonControl, null));
    }
    else
    {
        sb.Append("return true;");
    }

    ButtonControl.Attributes.Add("onclick", sb.ToString());
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-11-28T19:54:56.783

在我们的一个遗留应用程序中遇到了 rp 的代码，该应用程序正在与一些疯狂的行为作斗争。

将其追踪到一个奇怪的事件触发组合 - 当 DisableButtonOnClick() 在 UpdatePanel 内的 asp 按钮上使用时，POST 将被发送两次（一次由 DisableButtonOnClick() 添加的 doPostBack，一次由 UpdatePanel）。但是，这只发生在某些浏览器上（Edge 的早期版本，但不是最近的版本，IE11 做到了，Chrome 和 FireFox 没有（至少我测试的版本））。我认为 Chrome 和更新版本的 Edge 正在以某种方式在内部处理这种情况。在 IE 中使用 F12 devtools 跟踪问题 - 这两个 POST 发生得如此紧密，以至于第一个 POST 立即中止，但在某些情况下（网络延迟、用户机器负载等），请求确实在浏览器可以之前到达服务器中止。因此，这会导致整个系统中的按钮按下看似随机的双张贴，追溯起来很痛苦。解决方法是添加一个“return false;” 在 doPostBack 之后，以防止在较旧的浏览器运行时 UpdatePanel 参与其中。

TLDR - 请注意更新面板中按钮上的此代码。这是一个很好的方法和很好的方法，但在我（可能是边缘）的情况下有一个潜在的问题。

ps - 我会评论 rp 的帖子，但我没有代表。认为它可能对未来的旅行者有用。

# html - 在 Rails 中将 HTML 添加到我的 RSS/Atom 提要

> ID：106534
> 
> 赞同：8
> 
> 时间：2008-09-20T00:17:56.660
> 
> 标签：html, ruby-on-rails, rss, builder, atom-feed

默认的 rails XML builder 会转义所有 HTML，例如：

```
atom_feed do |feed|  
  @stories.each do |story|  
    feed.entry story do |entry|   
      entry.title story.title
      entry.content "<b>foo</b>"
    end  
  end  
end 
```

将产生文本：

```
<b>foo</b> 
```

而不是：**foo**

有什么方法可以指示 XML 构建器不要转义 XML？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-20T00:48:36.227

原来你需要做

```
entry.content "<b>foo</b>", :type => "html" 
```

虽然将它包装在 CDATA 中会阻止它工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-04-18T18:03:22.313

```
entry.content "type" => "html" do
    entry.cdata!(post.content)
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-30T13:47:21.593

[http://builder.rubyforge.org/classes/Builder/XmlMarkup.html](http://builder.rubyforge.org/classes/Builder/XmlMarkup.html)

> 特殊的 XML 字符 <、> 和 & 会自动转换为 <、> 和 &。使用 << 操作插入文本而不进行修改。

# mutex - 为什么在使用 VxWorks 反转安全互斥锁时需要 SEM_PRIORITY_Q？

> ID：106540
> 
> 赞同：0
> 
> 时间：2008-09-20T00:20:55.327
> 
> 标签：mutex, semaphore, vxworks

在 VxWorks 中，我正在使用 SEM_INVERSION_SAFE 选项创建一个互斥锁，以防止出现优先级反转问题。
手册说我还**必须**使用 SEM_PRIORITY_Q 选项。这是为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-20T00:26:56.403

在 VxWroks 中创建互斥信号量时，您有两种选择来处理排队（等待）信号量的多个任务：FIFO 或最高优先级任务优先。

当您使用 SEM_INVERSION_SAFE 选项时，持有互斥锁的任务将被提升到与等待信号量的最高优先级任务相同的优先级。

如果您要为信号量使用 FIFO 队列，内核将不得不遍历等待互斥体的任务队列以找到具有最高优先级的任务。此操作不是确定性的，因为遍历队列的时间会随着排队的任务数量的变化而变化。

当您使用 SEM_PRIORITY_Q 选项时，内核只需查看队列头部的任务，因为它是最高优先级。这是一个恒定时间的操作。

# sockets - Windows 上的 Rsync - 非套接字上的套接字操作

> ID：106544
> 
> 赞同：1
> 
> 时间：2008-09-20T00:22:03.060
> 
> 标签：sockets, cygwin, rsync

尝试在 Windows XP SP2 中运行最新的 Cygwin 版本的 rsync 时出现以下错误。尝试本地同步（即：仅本地硬盘上的源和目标）和远程同步（使用 openssh 包中的“-e ssh”）时都会发生错误。关于如何修复/解决它的任何建议？

```
bash-3.2$ rsync -a dir1 dir2
rsync：无法复制/关闭：非套接字上的套接字操作（108）
rsync 错误：/home/lapo/packaging/tmp/rsync-2.6.9/pipe.c(143) [receiver=2.6.9] 处的 IPC 代码（代码 14）错误
rsync：读取错误：对等方重置连接（104）
rsync 错误：/home/lapo/packaging/tmp/rsync-2.6.9/io.c(604) [sender=2.6.9] 处的 IPC 代码（代码 14）错误

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-24T12:21:28.137

你可能有东西阻塞了 rsync。就我而言，它是 NOD32 防病毒软件。您可以通过在“gdb”中运行 rsync 来检查这一点，如下所示：

```
$ gdb --args /usr/bin/rsync -a somedir/ anotherdir
GNU gdb 6.8.0.20080328-cvs (cygwin-special)
.....
(no debugging symbols found)
(gdb) run 
```

请注意 gdb 启动后的“运行”命令。你会看到一些像这样的输出：

```
Starting program: /usr/bin/rsync -a somedir/ anotherdir
.....
(no debugging symbols found)
warning: NOD32 protected [MSAFD Tcpip [TCP/IP]]
warning: NOD32 protected [MSAFD Tcpip [UDP/IP]]
warning: NOD32 protected [MSAFD Tcpip [RAW/IP]]
warning: NOD32 protected [RSVP UDP Service Provider]
warning: NOD32 protected [RSVP TCP Service Provider]
(no debugging symbols found)
(no debugging symbols found)
---Type <return> to continue, or q <return> to quit---
(no debugging symbols found)
[New thread 1508.0x720]
[New thread 1508.0xeb0]
[New thread 1508.0x54c]
rsync: Failed to dup/close: Socket operation on non-socket
(108)
rsync error: error in IPC code (code 14) at
/home/lapo/packaging/rsync-3.0.4-1/src/rsync-3.0.4/pipe.c(147)
[receiver=3.0.4] 
```

因此，您必须将 rsync 添加到该病毒扫描程序 (NOD32) 的排除列表中：

c:\cygwin\bin\rsync.exe

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T11:44:35.033

请注意，如果通过 SSH 连接使用，Cygwin 中长期存在的管道实现错误会导致 rsync 挂起。

从 Cygwin v. 1.7 开始，使用 rsync 传输大量数据的唯一可靠方法似乎是使用 rsync 协议连接到 rsync 守护进程。DeltaCopy 只是这个方法的一个漂亮的包装器。

一些用户显然在 SSH 将数据从 Windows 推送到 Unix 上取得了成功，而不是在 Unix 端从 Windows 拉取数据。不过，根据我们的经验，这也是不可靠的。

谷歌搜索 cygwin、rsync、ssh 和 pipe/hang/stall，你会发现更多关于这个问题的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T01:42:29.903

不是你的问题的真正答案，但我发现[Delta Copy](http://www.aboutmyip.com/AboutMyXApp/DeltaCopy.jsp)是一个比乱用 Cygwin 更好的选择。它也连接到常规的 rsync 守护进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-20T17:14:17.550

我发现这是一个winsock错误。我确认问题始于安装 Sierra Wireless Aircard (875U) 的 ATT 通信管理器（版本 6.12.0046.0）。卸载 Communications Manager，rsync 错误消失。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-30T17:14:21.107

在遵循@akaihola 的建议后，我发现[这篇](http://marc-abramowitz.com/archives/2007/10/14/solving-rsync-hangs-with-cygwin/comment-page-1/)博客文章解决了同样的问题。我在这里发布解决方案，但功劳归[Marc Abramowitz](http://marc-abramowitz.com/)

```
cygrunsrv --install "rsyncd" --path /usr/bin/rsync --args "--daemon --no-detach" --desc "Starts a rsync daemon for accepting incoming rsync connections" --disp "Rsync Daemon" --type auto 
```

当然，您需要带有 rsync 的 Cygwin。

# performance - SOAP 与 XML-RPC 或 REST 的性能

> ID：106546
> 
> 赞同：47
> 
> 时间：2008-09-20T00:23:28.563
> 
> 标签：performance, web-services, rest, soap, xml-rpc

关于使用 XML-RPC 或 REST 解决方案的简单性的争论很容易理解，也很难争论。

我还经常听到一些争论，即 SOAP 开销的增加可能会显着影响使用的带宽，甚至可能会影响延迟。我想看看量化影响的测试结果。有人知道此类信息的良好来源吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-20T01:25:47.293

SOAP 与 REST 速度的主要影响与线速无关，而与可缓存性有关。REST 建议使用 Web 的语义而不是尝试通过 XML 对其进行隧道传输，因此 RESTful Web 服务通常被设计为正确使用缓存标头，因此它们可以很好地与 Web 的标准基础设施（如缓存代理甚至本地浏览器缓存）配合使用。此外，使用 Web 的语义意味着 ETags 和自动 zip 压缩之类的东西是很好理解的提高效率的方法。

..现在你说你想要基准。好吧，在 Google 的帮助下，我找到[了一个人](http://www.learnosity.com/techblog/index.cfm/2008/3/13/CFMX--SOAP-vs-REST-benchmarks)，他的测试表明 REST 比 SOAP 快 4-6 倍，而另[一篇论文](http://www.informs-sim.org/wsc09papers/133.pdf)也支持 REST。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-20T00:31:53.240

REST 作为协议没有定义任何形式的消息信封，而 SOAP 确实有这个标准。

因此，尝试比较两者有点简单，它们是苹果对橘子。

也就是说，一个 SOAP 信封（减去数据）只有几 k，因此只要您通过 SOAP 和 REST 检索序列化对象，速度上应该不会有任何明显差异。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-20T07:53:41.680

SOAP 和任何其他使用 XML 的协议通常会使您的消息膨胀很多——这可能是也可能不是问题，具体取决于上下文。

像 JSON 这样的东西会更紧凑，序列化/反序列化可能更快 - 但不要出于这个原因专门使用它。做任何你当时觉得有意义的事情，如果有问题就改变它。

任何通常使用 HTTP 的东西（除非它重用 HTTP 1.1 keepalive 连接，许多实现不这样做）为每个请求启动一个新的 TCP 连接；这非常糟糕，尤其是在高延迟链接上。HTTPS 更糟糕。如果您有很多从一个发送者到一个接收者的短请求，请考虑如何消除这些开销。

将 HTTP 用于任何类型的 RPC（无论是 SOAP 还是其他）总是会产生这种开销。其他 RPC 协议通常允许您保持连接打开。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-11-30T18:57:32.740

有一些关于这方面的研究，您可能会发现这些研究提供了丰富的信息。请参阅以下内容：

*   [SO：休息与肥皂性能](https://stackoverflow.com/questions/4163066/rest-vs-soap-has-rest-a-better-performance)
*   [问答：SOAP 和 REST 101](http://esj.com/articles/2011/08/01/soap-and-rest-101.aspx)
*   [更新的 SQL Server 数据服务：Northwind REST 和 SOAP 上传](http://oakleafblog.blogspot.com/2008/07/updated-sql-server-data-services-ssds.html)

[在MSDN 论坛](http://social.msdn.microsoft.com/Forums/en-US/ssdsgetstarted/thread/1a5a0be9-3160-4320-9e7c-f0c609f15b1c/)上还有一个（有点过时的）有趣的关于该主题的性能对话。

简而言之 - 这些来源中的大多数似乎都同意 SOAP 和 REST 对于通用数据的性能大致相同。然而，一些结果似乎表明，对于二进制数据，REST 实际上可能性能较差。有关更多详细信息，请参阅我链接的论坛中的链接。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-20T01:39:01.270

# 扩展 "pjz" 的答案。

如果您获得大量基于信息（get* 调用类型）的 SOAP 操作，那么目前您无法缓存它们。但是，如果您要使用 REST 实现这些相同的操作，则可能会缓存数据（取决于您的业务上下文），如上所述。因为 SOAP 使用 POST 进行操作，所以它不能在服务器端缓存信息。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-07-04T07:09:01.010

SOAP 肯定更慢。有效负载要大得多，组装、传输、解析、验证和处理的速度较慢。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T00:32:46.873

我不知道基准测试问题的任何答案，但是，我对 SOAP 格式的了解是肯定的，它确实有开销，但是每个请求的开销不会增加：如果您将一个元素发送到 Web 服务，你有开销 + 一个元素构造，如果你有 1000 个元素发送到 Web 服务，你有开销 + 1000 个元素构造。当 XML 请求针对特定操作进行格式化时会产生开销，但请求中的每个单独的参数元素的格式都是相同的。

如果您坚持使用可重复的短数据突发（例如 500 个元素），那么速度应该是可以接受的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-03T08:04:38.580

我想这里的主要问题是如何比较 RPC 和 SOAP。

它们都通过使用您操作的存根对象和您返回的原始/复杂数据类型来提供相同的通信抽象方法，而您却不知道这一切是如何在下面处理的。

我总是更喜欢（JSON-）RPC，因为

*   它很轻
*   所有编程语言都有很多很棒的实现
*   学习/使用/创建很简单
*   它很快（尤其是 JSON）

尽管您应该使用 SOAP 是有原因的，即如果您需要命名参数而不是依赖于它们的正确顺序

您从这个 stackoverflow[问题中获得的更多详细信息](https://stackoverflow.com/questions/80112/whats-the-difference-between-xml-rpc-and-soap)

# c# - 如何在服务中获取 USB 磁盘驱动器插入和删除事件，而不会听到我的硬盘驱动器在某些操作系统上被重复访问？

> ID：106554
> 
> 赞同：3
> 
> 时间：2008-09-20T00:27:17.917
> 
> 标签：c#, wmi

我在我的 Windows 服务中使用此代码来通知插入和移除 USB 磁盘驱动器：

```
WqlEventQuery query = new WqlEventQuery("__InstanceOperationEvent", 
    "TargetInstance ISA 'Win32_LogicalDisk' AND TargetInstance.DriveType=2");
query.WithinInterval = TimeSpan.FromSeconds(1);
_deviceWatcher = new ManagementEventWatcher(query);
_deviceWatcher.EventArrived += new EventArrivedEventHandler(OnDeviceEventArrived);
_deviceWatcher.Start(); 
```

它可以在 XP 和 Vista 上运行，但在 XP 上，我可以听到非常明显的硬盘驱动器每秒被访问的声音。是否有另一个 WMI 查询会给我没有声音效果的事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T02:03:20.913

不确定这是否适用于您的情况，但我们一直在 C# 代码中使用 RegisterDeviceNotification（我无法在此处发布）来检测 USB 设备何时插入。您必须导入一些本机函数，但通常效果很好。最容易让它在 C++ 中工作，然后看看你必须升级到 C#。

koders 代码搜索中有一些东西似乎是一个完整的 C# 设备管理模块，可能会有所帮助：

[http://www.koders.com/csharp/fidEF5C6B3E2F46BE9AAFC93DB75515DEFC46DB4101.aspx](http://www.koders.com/csharp/fidEF5C6B3E2F46BE9AAFC93DB75515DEFC46DB4101.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T16:04:22.323

尝试查找 InstanceCreationEvent，这将表明创建了一个新的 Win32_LogicalDisk 实例。现在您正在查询实例操作，而不是创建。您应该知道这些事件的查询间隔非常长 - 可以更快地插入和取出 USB，您会检测到。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-10-02T20:13:53.137

尝试这个

```
using System;
using System.Management;

namespace MonitorDrives
{
class Program
{
    public enum EventType
    {
        Inserted = 2,
        Removed = 3
    }

    static void Main(string[] args)
    {
        ManagementEventWatcher watcher = new ManagementEventWatcher();
        WqlEventQuery query = new WqlEventQuery("SELECT * FROM Win32_VolumeChangeEvent WHERE EventType = 2 or EventType = 3");

        watcher.EventArrived += (s, e) =>
        {
            string driveName = e.NewEvent.Properties["DriveName"].Value.ToString();
            EventType eventType = (EventType)(Convert.ToInt16(e.NewEvent.Properties["EventType"].Value));

            string eventName = Enum.GetName(typeof(EventType), eventType);

            Console.WriteLine("{0}: {1} {2}", DateTime.Now, driveName, eventName);
        };

        watcher.Query = query;
        watcher.Start();

        Console.ReadKey();
    }
}
} 
```

# perl - 如何在 Perl 中找到散列占用的物理内存量？

> ID：106555
> 
> 赞同：18
> 
> 时间：2008-09-20T00:27:53.547
> 
> 标签：perl, memory, hash

我有一个 Perl 脚本，我在其中使用哈希表维护一个非常简单的缓存。一旦它占用超过 n 个字节，我想清除哈希，以避免 Perl（32 位）内存不足和崩溃。

我可以检查键值对的数量：

```
if (scalar keys %cache > $maxSize)
 {
 %cache = ();
 } 
```

但是是否可以检查散列占用的实际内存？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-20T01:00:18.163

[Devel::Size](http://search.cpan.org/perldoc?Devel::Size)是您问题的答案。（请注意，Devel::Size 在处理大型数据结构时会临时分配大量内存，因此它不太适合此目的。）

但是，[Cache::SizeAwareMemoryCache](http://search.cpan.org/perldoc?Cache::SizeAwareMemoryCache)和[Tie::Cache](http://search.cpan.org/perldoc?Tie::Cache)已经实现了您正在寻找的东西（使用有些不同的接口），并且可以避免您重新发明轮子。

[Memoize](http://search.cpan.org/perldoc?Memoize)是一个模块，可以轻松缓存函数的返回值。它没有实现基于大小的缓存限制，但应该可以使用 Tie::Cache 作为 Memoize 的后端。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-20T00:32:22.630

您正在寻找[Devel::Size](http://search.cpan.org/perldoc?Devel::Size)

# 姓名

Devel::Size - 用于查找 Perl 变量的内存使用情况的 Perl 扩展

# 概要

```
use Devel::Size qw(size total_size);

my $size = size("A string");
my @foo = (1, 2, 3, 4, 5);
my $other_size = size(\@foo);
my $foo = {a => [1, 2, 3],
        b => {a => [1, 3, 4]}
       };
my $total_size = total_size($foo); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-20T00:39:40.990

您可以安装[Devel::Size](http://search.cpan.org/perldoc?Devel::Size)以找出 Perl 中任何构造所占用的内存。但是请注意，它会占用大量中间内存，因此我不会将它用于大型数据结构。如果您认为您可能即将耗尽内存，我当然不会这样做。

顺便说一句，CPAN 上有许多很好的模块可以在内存中进行缓存等。我建议不要自己动手，而是使用其中之一。例如，尝试[Tie::Cache::LRU](http://search.cpan.org/perldoc?Tie::Cache::LRU)用于内存缓存，该缓存只能达到指定数量的键。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T00:39:28.650

您可以使用[Devel::Size](http://search.cpan.org/perldoc?Devel::Size)来确定使用的内存，但通常不能将返回内存提供给操作系统。不过，听起来您只是想清除和重用，这应该可以正常工作。

如果缓存是用于函数的，请考虑使用[Memoize](http://search.cpan.org/perldoc?Memoize)模块，而不是自己维护缓存。它支持缓存过期（通过 Memoize::Expire），因此您可以限制缓存的大小而不会完全破坏它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T01:31:12.753

### [高速缓存存储器](http://search.cpan.org/perldoc?Cache::Memory)

```
use Cache::Memory;

my $cache = Cache::Memory->new(
  namespace => 'MyNamespace',
  default_expires => '600 sec'
);

my $size  = $cache->size()
my $limit = $cache->size_limit(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-22T00:53:38.973

如果您担心管理 Perl 正在使用的内存量，您可能应该考虑另一种方法。为什么你一次需要这么多内存？你应该使用某种持久性系统吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T16:38:28.597

正如其他人所说，缓存不是您需要重新发明的轮子，CPAN 上有很多简单的缓存解决方案可以很好地为您完成这项工作。

[Cache::SizeAwareMemoryCache](http://search.cpan.org/perldoc?Cache::SizeAwareMemoryCache)可以被告知您希望它使用的最大大小，然后您可以让它为您处理缓存。

# command-line - tee 命令是否总是等待 EOF？

> ID：106563
> 
> 赞同：4
> 
> 时间：2008-09-20T00:32:01.650
> 
> 标签：command-line, cygwin

我想将命令的输出记录`stdout`到日志文件中。我已经安装了 Cygwin，我正在尝试使用该`tee`命令来完成此操作。

```
devenv mysolution.sln /build myproject "Release|Win32" | tee build.log 
```

麻烦的是，这`tee`似乎坚持等待文件结束，然后再将任何内容输出到`stdout`日志文件或日志文件。这消除了这一切的重点，即有一个日志文件以供将来参考，还有一些`stdout`日志记录，以便我可以轻松查看构建进度。

`tee`的选项似乎仅限于`--append`、`--ignore-interrupts`、`--help`和`--version`。那么还有另一种方法可以达到我想要做的事情吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-20T00:35:05.683

您可以输出到文件和 tail -f 文件。

devenv mysolution.sln /build myproject "Release|Win32" > build.log &

尾 -f build.log

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T00:37:18.157

自己写！（这里的重点是 autoflush ( `$|`) 设置已打开，因此看到的每一行都会立即刷新。这可能是真正的`tee`命令所缺少的。）

```
#!/usr/bin/perl -w
use strict;
use IO::File;
$| = 1;
my @fhs = map IO::File->new(">$_"), @ARGV;
while (my $line = <STDIN>) {
    print $line;
    $_->print($line) for @fhs;
}
$_->close for @fhs; 
```

您可以随意调用脚本。我叫它`perlmilktee`！:-P

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T14:49:49.027

> tee 似乎坚持在将任何内容输出到标准输出或日志文件之前等待文件结束。

这绝对不应该发生 - 它会使 tee 几乎无用。这是我写的一个简单的测试，它对它进行了测试，它绝对不是在等待 eof。

```
$ cat test
#!/bin/sh
echo "hello"
sleep 5
echo "goodbye"

$ ./test | tee test.log
hello
<pause>
goodbye 
```

# macos - OS X 上包含的终端程序有什么好的替代方案？

> ID：106572
> 
> 赞同：2
> 
> 时间：2008-09-20T00:34:57.633
> 
> 标签：macos, keyboard, terminal

当我在 OS X 上使用终端会话时，我的键盘会变得不稳定（另一个问题？），所以使用命令行常常令人沮丧。其他本机应用程序似乎很好，不会遇到同样的问题。是否有其他终端应用程序可能更适合我？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T00:52:01.913

正如 ssh 的名字所揭示的那样：它是一个 shell 应用程序 :)

所以不会有gui或任何东西。如果您只是对使用终端感到生气……也许可以尝试[iTerm 2](http://www.iterm2.com/)。效果很好...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-28T23:40:25.507

[ZOC](http://www.emtec.com/zoc/index.html "ZOC 终端")将是一个（共享软件）替代方案。GUI，选项卡式...总体上更符合您在 Windows 下看到的终端应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T00:38:44.830

不是真正的替代方案，但您可能只需将您的字符集设置为正确的设置即可使其不至于不稳定。例如，如果您看到的问题是您的删除没有删除，等等。

山姆

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T01:00:56.447

如果您只想浏览和操作文件，[Cyber​​duck](http://cyberduck.ch/)可以连接到 SSH 会话。

当我连接到我的服务器时，我仍然使用终端输入命令，但使用 Cyber​​duck 和 TextMate 来编辑配置文件，因为使用 vi 是完全错误的，实际上可能会炸毁整个宇宙。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-26T18:29:13.417

[JellyfiSSH](http://www.grepsoft.net/jellyfissh.html)在管理 SSH 连接、设置隧道*等方面做得很好。*

# embedded - 将 Windows 软件移植到嵌入式/实时操作系统

> ID：106581
> 
> 赞同：3
> 
> 时间：2008-09-20T00:38:31.400
> 
> 标签：embedded, cross-platform, rtos

我有一个针对 Windows 环境的现有代码库，并着眼于未来，希望使其尽可能跨平台。通过使用跨平台库，我在标准 Linux 发行版上取得了一些成功，但希望将其扩展到实时和/或嵌入式操作系统。

是否可以将大部分代码库移植到此类系统，或者是否需要针对该环境重新实现？如果需要重新创建零件，这些系统的开发是否需要不同类型的设计方法？一些供应商提供他们自己的 IDE 用于开发，这些是必要的还是我们可以或是否有可能标准化 GNU 工具链类型的构建过程？

一个潜在的坑洞可能是 IPC 处理的差异，但如果没有进一步的暴露，很难掌握细节。

注意虽然目前基于 Windows，但 Win32 API（主要是 COM）或 Windows 类型的使用并不特别多。

谢谢

编辑:: 代码库是 C\C++

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T00:44:38.593

如果应用程序主要是 C 和 posix，那么它并不太难。今天的嵌入式平台可能意味着在紧凑型闪存卡上运行的 XP 或 Linux 的几乎完整副本。

对于 gui，QT 和 WX 都具有直接绘制小部件的嵌入式版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T17:11:08.960

如果您使用的是 Windows COM 接口（我假设您在这里讨论的不是串行端口，而是通用对象模型），您的代码可能需要从中抽象出来。

当您谈论 IPC 时，显然这是一个多任务/多处理类型的代码库。在这种情况下，您将不得不想出一种方法来处理环境差异。

首先，您**将**需要某种 RTOS，因为您的应用程序是多任务的。当您移植到 Linux 时，您可能想研究使用实时 Linux 版本。这将最大限度地减少您必须执行的端口数量。

如果您不想将 Linux 用作嵌入式平台，请使您的代码符合 POSIX（Linux 是）并确保您选择的 RTOS 支持 POSIX。这样，Linux 和嵌入式平台的端口将基本相同。

最重要的是，COM 将是你的信天翁。

由于您没有提到 GUI 的使用，因此我们不会解决**蠕虫**的问题 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T17:13:37.300

最重要的一步是将所有操作系统依赖函数从项目逻辑中分离出来。

完成此操作后，您将立即看到需要移植多少代码才能迁移到新操作系统，并且您将能够很好地开始移植。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T01:19:11.380

取决于您的嵌入式平台的功能。如果它是 8 位的，那么你的路还很艰辛，但如果它是 32 位的，具有不错的 RAM 等，那么有很多开源跨平台库可用。

我在我最后一个嵌入式 GUI 应用程序中使用了[DirectFB](http://www.directfb.org/)，它轻巧且可以，但不是跨平台的。下次我想我会试试[wxWidgets](http://www.wxwidgets.org/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T01:24:51.927

我不喜欢在 Windows 上使用 GNU 开发工具，因为 MS Dev Studio 比任何 GNU 工具都好，但最近我一直在使用基于 Eclipse 和 GCC 的[Wascana Desktop Developer ，它显示出前景。](http://wascana.sourceforge.net/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T17:56:23.437

如果您要指定使用哪种实时/嵌入式操作系统，您是否考虑过 Windows CE？

# exception - 指导您的异常处理策略的原则是什么？

> ID：106586
> 
> 赞同：27
> 
> 时间：2008-09-20T00:39:16.407
> 
> 标签：exception, exception-handling, error-handling

**处理异常涉及很多相对论。**除了异常涵盖硬件和操作系统引发的错误的低级 API 之外，还有一个阴影区域，程序员可以在其中决定什么构成异常以及什么是正常情况。

您如何决定何时使用异常？**您是否有关于例外情况的一致政策？**

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-20T01:50:05.720

异常不应**用作**在对象内部的方法之间在内部传递信息的方法，在本地您应该使用错误代码和防御性编程。

异常旨在将控制从检测到错误的点传递到可以处理错误的位置（堆栈上层），大概是因为本地代码没有足够的上下文来纠正问题和堆栈上层的东西将有更多的背景，从而能够更好地组织复苏。

在考虑异常时（至少在 C++ 中），您应该考虑 API 做出的异常保证。最低保证水平应为基本保证，但您应努力（在适当情况下）提供强有力的保证。如果您不使用来自特定 API 的外部依赖项，您甚至可以尝试提供不抛出保证。

**注意**不要将异常保证与异常规范混淆。

## 例外保证：

### 无保证：

> 异常转义方法后无法保证对象的状态 在这些情况下，不应再使用对象。

### 基本保证：

> 在几乎所有情况下，这应该是方法提供的最低保证。这保证了对象的状态被很好地定义并且仍然可以被一致地使用。

### 强有力的保证：（又名交易保证）

> 这保证了该方法将完全成功或抛出异常并且对象状态不会改变。

### 无投掷保证：

> 该方法保证不允许任何异常传播到该方法之外。所有的析构函数都应该做出这个保证。
> | NB 如果在异常已经传播时异常从析构函数中转义
> | 应用程序将终止

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T03:38:46.677

Microsoft 高级软件设计工程师 Eric Lippert 的这篇博客文章总结了一套出色而简短的[异常策略指南](http://blogs.msdn.com/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)。

简而言之：

*   **致命**：可怕的错误表明您的过程是完全不可恢复的。尽可能清理任何资源，但不要抓住它们。如果您正在编写能够检测这种情况的代码，请务必抛出。示例：内存不足异常。

*   **Boneheaded**：相对简单的错误表明您的进程无法对正在处理的任何数据进行操作，但如果导致错误的任何情况被简单地忽略，则会继续正常运行。这些更好地称为错误。不要抛出或捕获它们，而是防止它们发生，通常是通过传递错误或其他可以由您的方法处理的有意义的失败指标。示例：空参数异常。

*   **烦恼**：您不拥有的代码会向您抛出相对简单的错误。您必须捕获所有这些并处理它们，通常与处理您自己的*Boneheaded*异常的方式相同。请不要再把它们扔回去。示例：来自 C# 的[Int32.Parse()](http://msdn.microsoft.com/en-us/library/b3h1hf19.aspx)方法的格式化异常

*   **外生**：相对简单的错误，看起来很像*Vexing*（来自其他人的代码）甚至*Boneheaded*（来自您的代码）的情况，但必须抛出，因为现实表明抛出它们的代码真的不知道如何恢复，但是来电者可能会。继续扔这些，但是当您的代码从其他地方收到它们时，抓住它们并处理它们。示例：找不到文件异常。

在这四个中，外源性是您必须考虑最多才能做到正确的那些。一个指示找不到文件的异常适合为 IO 库方法抛出，因为该方法几乎肯定不知道如果找不到文件该怎么办，特别是考虑到这种情况随时可能发生并且存在无法检测这种情况是否是暂时的。但是，抛出这样的异常不适用于应用程序级代码，因为该应用程序可以从用户那里获取有关如何继续的信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T04:11:54.410

1.  永远不要从析构函数中抛出异常。

2.  维护关于对象状态的一些基本级别的异常保证。

3.  不要使用异常来传达可以使用错误代码完成的错误，除非它是真正的异常错误并且您可能希望上层知道它。

4.  如果可以提供帮助，请不要抛出异常。它减慢了一切。

5.  不要只是`catch(...)`什么也不做。捕获您知道的异常或特定异常。至少记录下发生了什么。

6.  在异常世界中使用 RAII 因为没有什么是安全的了。

7.  至少在内存方面，运输代码不应该抑制异常。

8.  当抛出异常时，尽可能多地打包信息，以便上层有足够的信息来调试它们。

9.  了解可能导致 STL 等库抛出异常而不是表现出未知行为的标志（例如，无效的迭代器/向量下标溢出）。

10.  捕获引用而不是异常对象的副本？

11.  在使用可能引发异常的代码时，请特别注意 COM 之类的引用计数对象，并将它们扭曲到引用计数指针中。

12.  如果代码在超过 2% 的时间内抛出异常，请考虑将其设为错误代码以提高性能。

13.  考虑不要从未修饰的 dll 导出/C 接口中抛出异常，因为某些编译器通过假设 C 代码不抛出异常来进行优化。

14.  如果您为处理异常所做的一切类似于下面的内容，那么根本不要使用异常处理。你不需要它。

    ```
    main 
    {
         try {
        all code....
        }
        catch(...) {} 
    } 
    ```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T00:52:16.873

异常在处理时间上是昂贵的，所以它们应该只在你的应用程序中确实不应该发生的事情发生时才被抛出。

有时您可以预测可能会发生什么样的事情以及从中恢复的代码，在这种情况下，抛出并捕获异常，记录并恢复，然后继续是合适的。否则，它们应该只用于处理意外情况并优雅地退出，同时捕获尽可能多的信息以帮助调试。

我是一名 .NET 开发人员，对于 catch and throw，我的方法是：

1.  仅在公共方法中尝试/捕获（一般而言；显然，如果您要捕获特定错误，您会在那里检查它）
2.  仅在抑制错误并重定向到错误页面/表单之前登录 UI 层。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T03:58:47.737

给出此答案的上下文是 Java 语言。

对于可能弹出的正常错误，我们直接处理（例如，如果某些内容为 null、空等，则立即返回）。我们只在特殊情况下使用实际异常。

但是，我们永远不会抛出已检查的异常。我们将 RuntimeException 子类化为我们自己的特定异常，在适用的地方直接捕获它们，对于其他库、JDK API 等抛出的异常，我们会在内部尝试/捕获并记录异常（如果确实发生了应该'没有，您无法像批处理作业的文件未找到异常一样恢复），或者我们将异常包装在 RuntimeException 中，然后抛出它。在代码的外部，我们依赖异常处理程序来最终捕获该 RuntimeException，无论是 JVM 还是 Web 容器。

这样做的原因是它避免了在可能有四个调用方法的实例但只有一个可以实际处理异常的地方创建强制的 try/catch 块。这似乎是规则，而不是（没有双关语......哎哟）异常，所以如果第四个可以处理它，它仍然可以捕获它并检查异常的根本原因以获得发生的实际异常（无需担心 RuntimeException 包装器）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T04:38:33.270

我认为通常有一种好方法可以根据对资源的访问、数据的完整性和数据的有效性来确定异常。

**访问例外**

*   创建或连接到任何类型的连接（远程、本地）。
    *   发生在：数据库、远程处理
    *   原因：不存在、已在使用或不可用、凭据不足/无效
*   打开、阅读或写入任何类型的资源
    *   出现在：文件 I/O、数据库
    *   原因：锁定、不可用、凭据不足/无效

**数据完整性**

*   在很多情况下，数据的完整性很重要
    *   它引用了什么，它包含什么......
    *   查找有关需要一组标准以使数据干净且格式有效的方法或代码的资源。
    *   示例：尝试将值为 'bleh' 的字符串解析为数字。

**数据的有效性**

*   这是提供的正确数据吗？（它的格式正确，但对于给定情况，它可能不是正确的参数集）
    *   发生在：数据库查询、事务、Web 服务
    *   示例：向数据库提交一行并违反约束

显然还有其他情况，但这些通常是我试图在需要的地方遵守的情况。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-01T06:52:50.143

我相信使用异常的最佳方式取决于您使用的计算机语言。例如，Java 比 C++ 有更可靠的异常实现。

如果您使用 C++，我建议您至少尝试阅读 Bjarne Stroustrup（C++ 的发明者）关于异常安全的说法。请参阅他的书“C++ 编程语言”的[附录 E。](http://www.research.att.com/~bs/3rd_safe0.html)

他花了 34 页试图解释如何以安全的方式处理异常。如果您确实理解他的建议，那么这应该就是您需要知道的全部内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T04:24:36.630

作为一名 C++ 开发人员，我自己的政策是不将我认为是公共 API 的异常抛出到我的类/模块（事实上，这是 COM 的要求）。但是，我在私有类实现中广泛使用异常。例如，使用 ATL：

```
HRESULT Foo()
{
    HRESULT hr = S_OK;
    try {
        // Avoid a whole lot of nested ifs and return code
        // checking - internal stuff just throws.
        DoStuff();
        DoMoreStuff(); // etc.
    } catch ( CAtlException& e ) {
        hr = e;
    }
    return hr;
}

void DoSomething()
{
    // If something goes wrong, AtlThrow( E_FAILED or E_WHATEVER ); 
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T01:34:48.707

其他人可能必须纠正/澄清这一点，但有一种策略称为（我相信）“合同驱动的开发”，您可以在公共界面中明确记录每种方法的预期前提条件以及保证的后置条件。然后，在实现该方法时，任何阻止您满足合同中的后置条件的错误都应该导致抛出异常。不满足先决条件被认为是程序错误，应导致程序中止。

我不确定合同驱动的开发是否涉及捕获异常的问题，但总的来说，您应该只捕获您期望并可以合理恢复的异常。例如，大多数代码无法从 Out Of Memory 异常中有意义地恢复，因此捕获它是没有意义的。另一方面，如果您试图打开一个文件进行写入，您可以（并且应该）处理文件被另一个进程独占锁定的情况，或者文件已被删除的情况（即使您检查了它的在尝试打开它之前存在）。

正如另一位评论者所指出的，您还应该避免使用异常来处理可以预期和避免的预期条件。例如，在 .NET 框架中，int.TryParse 优于带有 try/catch 的 int.Parse，尤其是在循环等中使用时。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T02:26:24.870

bea（现在是 oracle）的这篇文章很好地说明了如何去做：[http](http://www.oracle.com/technology/pub/articles/dev2arch/2006/11/effective-exceptions.html) ://www.oracle.com/technology/pub/articles/dev2arch/2006/11/effective-exceptions.html 。它有点假设 Java，但您也应该能够将它用于其他环境。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-03T07:02:33.313

我的异常处理政策可以在以下位置找到：

[http://henko.net/imperfection/exception-handling-policy-throwing-exception/](http://henko.net/imperfection/exception-handling-policy-throwing-exception/)。

（希望宣传一个网站不会违反规则，但是在这里粘贴的信息有点太多了。）

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-09-20T01:00:28.367

不是语言环境根据规范引发的异常。如果确实有例外的概念，那么使用的语言是什么？我正在考虑 Java 中的“除以零”，或者 Ada 中的 CONSTRAINT_ERROR 与 C 中的任何内容。

在选择了在其组成中定义了异常的编程语言之后，程序员如何“决定”使用异常？

编辑：或者不是“使用”异常，你的意思是什么时候有一个关于“处理”异常的连贯一致的政策？

Edit2：您可能想查看 Steven Dewhurst 的书“C++ Gotchas”中的[免费章节](http://www.semantics.org/cpp_gotchas/index.html)，特别是 Gotcha 64 和 Gotcha 65。虽然它侧重于 C++，但所涉及的课程在其他语言中很有用。

# java - volatile 关键字有什么用？

> ID：106591
> 
> 赞同：741
> 
> 时间：2008-09-20T00:41:02.267
> 
> 标签：java, multithreading, keyword, volatile

今天在工作中，我偶然发现了`volatile`Java 中的关键字。不是很熟悉，我找到[了这个解释](http://web.archive.org/web/20210221170926/https://www.ibm.com/developerworks/java/library/j-jtp06197/)。

鉴于那篇文章解释了相关关键字的详细信息，您是否曾经使用过它，或者您是否曾经看到过可以以正确方式使用该关键字的案例？

* * *

## 回答 #1

> 赞同：811
> 
> 时间：2008-09-20T02:09:51.007

`volatile`具有内存可见性的语义。基本上，一个`volatile`字段的值在写入操作完成后对所有读取器（特别是其他线程）都是可见的。没有`volatile`，读者可能会看到一些未更新的值。

回答您的问题：是的，我使用`volatile`变量来控制某些代码是否继续循环。循环测试该`volatile`值，如果是 则继续`true`。可以`false`通过调用“停止”方法来设置条件。循环`false`在 stop 方法完成执行后测试值时看到并终止。

我强烈推荐的《[Java Concurrency in Practice](http://jcip.net)》一书很好地解释了`volatile`. 这本书是由撰写问题中引用的 IBM 文章的同一个人撰写的（事实上，他在该文章的底部引用了他的书）。我使用的`volatile`是他的文章所说的“模式 1 状态标志”。

如果您想了解更多关于幕后[`volatile`](http://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.3.1.4)工作原理的信息，请阅读[Java 内存模型](http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html)。如果您想超越该级别，请查看像[Hennessy & Patterson](https://www.elsevier.com/books/computer-architecture/hennessy/978-0-12-383872-8)这样的优秀计算机体系结构书籍，并阅读有关缓存一致性和缓存一致性的内容。

* * *

## 回答 #2

> 赞同：198
> 
> 时间：2008-09-20T00:59:28.337

* * *

## 回答 #3

> 赞同：153
> 
> 时间：2015-12-18T21:52:46.723

**关于`volatile`：**

1.  Java 中的同步可以通过使用 Java 关键字`synchronized`和`volatile`和 锁来实现。
2.  在Java中，我们不能有`synchronized`变量。对变量使用`synchronized`关键字是非法的，会导致编译错误。除了`synchronized`在 Java 中使用变量，您可以使用 java`volatile`变量，它会指示 JVM 线程`volatile`从主内存中读取变量的值，而不是在本地缓存它。
3.  如果一个变量没有在多个线程之间共享，则不需要使用`volatile`关键字。

[来源](http://javarevisited.blogspot.sg/2011/06/volatile-keyword-java-example-tutorial.html)

**的示例用法`volatile`：**

```
public class Singleton {
    private static volatile Singleton _instance; // volatile variable
    public static Singleton getInstance() {
        if (_instance == null) {
            synchronized (Singleton.class) {
                if (_instance == null)
                    _instance = new Singleton();
            }
        }
        return _instance;
    }
} 
```

我们在第一个请求到来时懒惰地创建实例。

如果我们不创建`_instance`变量`volatile`，则创建实例的`Singleton`线程无法与其他线程通信。因此，如果线程 A 正在创建 Singleton 实例，并且在创建之后，CPU 损坏等，所有其他线程将无法看到`_instance`非 null 的值，他们会认为它仍然被分配为 null。

为什么会这样？因为读取器线程没有进行任何锁定，并且在写入器线程退出同步块之前，内存将不会同步，并且`_instance`不会在主内存中更新 的值。使用 Java 中的 Volatile 关键字，这是由 Java 本身处理的，并且所有读取器线程都可以看到此类更新。

> **结论**：`volatile`关键字也用于在线程之间传递内存内容。

**不带 volatile 的示例用法：**

```
public class Singleton{    
    private static Singleton _instance;   //without volatile variable
    public static Singleton getInstance(){   
          if(_instance == null){  
              synchronized(Singleton.class){  
               if(_instance == null) _instance = new Singleton(); 
      } 
     }   
    return _instance;  
    } 
```

上面的代码不是线程安全的。尽管它在同步块中再次检查实例的值（出于性能原因），但 JIT 编译器可以重新排列字节码，以便在构造函数完成执行之前设置对实例的引用。这意味着方法 getInstance() 返回一个可能尚未完全初始化的对象。为了使代码线程安全，从 Java 5 开始可以使用关键字 volatile 作为实例变量。标记为 volatile 的变量只有在对象的构造函数完全完成执行后才对其他线程可见。
[来源](http://www.javacodegeeks.com/2014/11/multithreading-concurrency-interview-questions-answers.html#36)

[![在此处输入图像描述](https://i.stack.imgur.com/bgHrU.png)](https://i.stack.imgur.com/bgHrU.png)

**`volatile`Java中的用法**：

快速失败迭代器*通常*使用`volatile`列表对象上的计数器来实现。

*   当列表更新时，计数器增加。
*   创建an`Iterator`时，计数器的当前值嵌入到`Iterator`对象中。
*   执行操作时`Iterator`，该方法比较两个计数器值，`ConcurrentModificationException`如果它们不同则抛出 a。

故障安全迭代器的实现通常是轻量级的。它们通常依赖于特定列表实现的数据结构的属性。没有通用模式。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2008-09-24T22:29:39.607

`volatile`对于停止线程非常有用。

并不是说您应该编写自己的线程，Java 1.6 有很多不错的线程池。但是如果你确定你需要一个线程，你需要知道如何停止它。

我用于线程的模式是：

```
public class Foo extends Thread {

  private volatile boolean close = false;

  public void run() {
    while(!close) {
      // do work
    }
  }
  public void close() {
    close = true;
    // interrupt here if needed
  }
} 
```

在上述代码段中，`close`while循环中读取的线程与调用的线程不同`close()`。如果没有 volatile，运行循环的线程可能永远不会看到要关闭的更改。

注意不需要同步

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2018-03-04T18:24:34.727

用关键字声明的变量`volatile`有两个使其特别的主要特性。

1.  如果我们有一个 volatile 变量，它就不能被任何线程缓存到计算机的（微处理器）缓存中。访问总是从主存储器发生。

2.  如果对 volatile 变量进行***写操作***，突然请求***读操作***，则保证***写操作将在读操作之前完成***。

以上两个性质推断出

*   所有读取 volatile 变量的线程肯定会读取最新值。因为没有缓存值会污染它。并且只有在当前写操作完成后才会授予读请求。

而另一方面，

*   如果我们进一步研究我提到的**＃2**`volatile` ，我们可以看到该关键字是维护共享变量的理想方式，该变量具有***“n”个读取器线程并且只有一个写入器线程***可以访问它。一旦我们添加了`volatile`关键字，它就完成了。没有任何其他关于线程安全的开销。

相反，

我们***不能***单独使用`volatile`关键字来满足一个共享变量，它有***多个写入线程访问它***。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2008-09-20T04:00:01.493

一个常见的使用示例`volatile`是使用`volatile boolean`变量作为标志来终止线程。如果您已经启动了一个线程，并且希望能够从另一个线程安全地中断它，您可以让该线程定期检查一个标志。要停止它，请将标志设置为 true。通过制作 flag `volatile`，您可以确保正在检查它的线程将在下次检查它时看到它已被设置，而无需使用`synchronized`块。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-09-20T04:26:30.790

是的，当您希望多个线程访问可变变量时，必须使用 volatile。这不是很常见的用例，因为通常您需要执行多个原子操作（例如，在修改变量之前检查变量状态），在这种情况下，您将使用同步块。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2015-02-11T14:51:29.300

没有人提到 long 和 double 变量类型的读写操作的处理。读取和写入对于引用变量和大多数原始变量都是原子操作，除了 long 和 double 变量类型，它们必须使用 volatile 关键字才能成为原子操作。[@关联](http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2019-12-27T09:21:13.467

**易挥发的**

`volatile`-> `synchronized`[^([关于])](https://stackoverflow.com/a/59500618/4770877)

`volatile`对程序员说值总是最新的。问题是该值可以保存在不同类型的硬件内存中。例如，它可以是 CPU 寄存器、CPU 缓存、RAM ... СPU 寄存器和 CPU 缓存属于 CPU，不能共享数据，这与 RAM 不同，RAM 在多线程环境中处于救援状态

[![在此处输入图像描述](https://i.stack.imgur.com/1EPWG.png)](https://i.stack.imgur.com/1EPWG.png)

`volatile`关键字表示将**直接**从 RAM 内存**读取和写入**变量。它有一些计算足迹

 **`Java 5``volatile`通过支持扩展`happens-before`[^([关于])](https://stackoverflow.com/a/59491099/4770877)

> 对 volatile 字段的写入发生在对该字段的每次后续读取之前。

```
Read is after write 
```

`volatile`关键字**不能解决**`race condition`多个线程可以同时**写入**一些值的情况。答案是`synchronized`关键词[^([关于])](https://stackoverflow.com/a/59500618/4770877)

因此，只有当**一个**线程**写入**而其他线程只读`volatile`取值时它才是安全的

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2014-02-25T09:17:27.940

在我看来，除了停止使用 volatile 关键字的线程之外，还有两个重要的场景是：

1.  [双重检查锁定机制](http://en.wikipedia.org/wiki/Double-checked_locking)。在单例设计模式中经常使用。在这种情况下，**需要将单例对象声明为 volatile**。
2.  [虚假唤醒](http://tutorials.jenkov.com/java-concurrency/thread-signaling.html#spuriouswakeups)。即使没有发出通知调用，线程有时也会从等待调用中唤醒。这种行为称为虚假唤醒。这可以通过使用条件变量（布尔标志）来解决。只要标志为真，就将 wait() 调用置于 while 循环中。因此，如果线程由于 Notify/NotifyAll 以外的任何原因从等待调用中唤醒，那么它遇到的标志仍然为真，因此再次调用等待。在调用 notify 之前将此标志设置为 true。在这种情况下，**布尔标志被声明为 volatile**。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2020-12-03T13:04:16.480

假设一个线程修改了共享变量的值，如果您没有`volatile`对该变量使用修饰符。当其他线程想要读取这个变量的值时，他们看不到更新的值，因为它们从 CPU 的缓存而不是 RAM 内存中读取变量的值。此问题也称为`Visibility Problem`.

通过声明共享变量`volatile`，所有对计数器变量的写入都将立即写回主存。此外，所有对计数器变量的读取都将直接从主存储器中读取。

```
public class SharedObject {
    public volatile int sharedVariable = 0;
} 
```

对于非易失性变量，无法保证 Java 虚拟机 (JVM) 何时将数据从主内存读取到 CPU 缓存，或将数据从 CPU 缓存写入主内存。这可能会导致几个问题，我将在以下部分中解释这些问题。

* * *

**例子：**

想象一下这样一种情况，两个或多个线程可以访问一个共享对象，该对象包含一个声明如下的计数器变量：

```
public class SharedObject {
    public int counter = 0;
} 
```

也想象一下，只有线程 1 增加了计数器变量，但线程 1 和线程 2 都可能不时读取计数器变量。

如果计数器变量未声明为易失性，则无法保证计数器变量的值何时从 CPU 缓存写回主存储器。这意味着，CPU 缓存中的计数器变量值可能与主内存中的不同。这种情况如下所示：

[![易挥发的](https://i.stack.imgur.com/L57nd.png)](https://i.stack.imgur.com/L57nd.png)

线程没有看到变量的最新值的问题，因为它还没有被另一个线程写回主内存，被称为“可见性”问题。一个线程的更新对其他线程是不可见的。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-20T07:14:12.913

如果您正在开发多线程应用程序，您将需要使用“volatile”关键字或“synchronized”以及您可能拥有的任何其他并发控制工具和技术。此类应用程序的示例是桌面应用程序。

如果您正在开发将部署到应用程序服务器（Tomcat、JBoss AS、Glassfish 等）的应用程序，您不必自己处理并发控制，因为它已经由应用程序服务器处理。事实上，如果我没记错的话，Java EE 标准禁止在 servlet 和 EJB 中进行任何并发控制，因为它是“基础设施”层的一部分，您应该无需处理它。如果您正在实现单例对象，则只能在此类应用程序中进行并发控制。如果您使用像 Spring 这样的框架来编织组件，这甚至已经解决了。

因此，在应用程序是 Web 应用程序并使用 Spring 或 EJB 等 IoC 框架的大多数 Java 开发情况下，您不需要使用“volatile”。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-03-02T21:07:43.430

`volatile`只保证所有线程，甚至它们自己，都在递增。例如：计数器同时看到变量的同一面。它不是用来代替同步或原子或其他东西的，它完全使读取同步。请不要将其与其他 java 关键字进行比较。正如下面的示例所示，易失性变量操作也是原子的，它们会立即失败或成功。

```
package io.netty.example.telnet;

import java.util.ArrayList;
import java.util.List;

public class Main {

    public static volatile  int a = 0;
    public static void main(String args[]) throws InterruptedException{

        List<Thread> list = new  ArrayList<Thread>();
        for(int i = 0 ; i<11 ;i++){
            list.add(new Pojo());
        }

        for (Thread thread : list) {
            thread.start();
        }

        Thread.sleep(20000);
        System.out.println(a);
    }
}
class Pojo extends Thread{
    int a = 10001;
    public void run() {
        while(a-->0){
            try {
                Thread.sleep(1);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            Main.a++;
            System.out.println("a = "+Main.a);
        }
    }
} 
```

即使您放 volatile 或 not 结果总是会有所不同。但是，如果您使用 AtomicInteger 如下结果将始终相同。这与同步也相同。

```
 package io.netty.example.telnet;

    import java.util.ArrayList;
    import java.util.List;
    import java.util.concurrent.atomic.AtomicInteger;

    public class Main {

        public static volatile  AtomicInteger a = new AtomicInteger(0);
        public static void main(String args[]) throws InterruptedException{

            List<Thread> list = new  ArrayList<Thread>();
            for(int i = 0 ; i<11 ;i++){
                list.add(new Pojo());
            }

            for (Thread thread : list) {
                thread.start();
            }

            Thread.sleep(20000);
            System.out.println(a.get());

        }
    }
    class Pojo extends Thread{
        int a = 10001;
        public void run() {
            while(a-->0){
                try {
                    Thread.sleep(1);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                Main.a.incrementAndGet();
                System.out.println("a = "+Main.a);
            }
        }
    } 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2020-09-05T13:49:03.410

虽然我在这里提到的答案中看到了许多很好的理论解释，但我在这里添加了一个带有解释的实际示例：

1.

**代码在没有易失性使用的情况下运行**

```
public class VisibilityDemonstration {

private static int sCount = 0;

public static void main(String[] args) {
    new Consumer().start();
    try {
        Thread.sleep(100);
    } catch (InterruptedException e) {
        return;
    }
    new Producer().start();
}

static class Consumer extends Thread {
    @Override
    public void run() {
        int localValue = -1;
        while (true) {
            if (localValue != sCount) {
                System.out.println("Consumer: detected count change " + sCount);
                localValue = sCount;
            }
            if (sCount >= 5) {
                break;
            }
        }
        System.out.println("Consumer: terminating");
    }
}

static class Producer extends Thread {
    @Override
    public void run() {
        while (sCount < 5) {
            int localValue = sCount;
            localValue++;
            System.out.println("Producer: incrementing count to " + localValue);
            sCount = localValue;
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                return;
            }
        }
        System.out.println("Producer: terminating");
    }
}
} 
```

在上面的代码中，有两个线程——生产者和消费者。

生产者线程在循环中迭代 5 次（睡眠时间为 1000 毫秒或 1 秒）。在每次迭代中，生产者线程将 sCount 变量的值增加 1。因此，生产者在所有迭代中将 sCount 的值从 0 更改为 5

消费者线程处于一个恒定循环中，并在 sCount 的值发生变化时打印，直到值达到 5 并结束。

两个循环同时启动。所以生产者和消费者都应该打印 sCount 的值 5 次。

**输出**

```
Consumer: detected count change 0
Producer: incrementing count to 1
Producer: incrementing count to 2
Producer: incrementing count to 3
Producer: incrementing count to 4
Producer: incrementing count to 5
Producer: terminating 
```

**分析**

在上面的程序中，当生产者线程更新 sCount 的值时，它确实会更新主内存中的变量值（每个线程最初将要从中读取变量值的内存）。但是消费者线程第一次从主内存中读取 sCount 的值，然后将该变量的值缓存在自己的内存中。因此，即使主内存中原始 sCount 的值已被生产者线程更新，消费者线程仍在读取其未更新的缓存值。这称为**可见性问题**。

2.

**使用易失性运行代码**

在上面的代码中，将声明 sCount 的代码行替换为以下内容：

```
private volatile  static int sCount = 0; 
```

**输出**

```
Consumer: detected count change 0
Producer: incrementing count to 1
Consumer: detected count change 1
Producer: incrementing count to 2
Consumer: detected count change 2
Producer: incrementing count to 3
Consumer: detected count change 3
Producer: incrementing count to 4
Consumer: detected count change 4
Producer: incrementing count to 5
Consumer: detected count change 5
Consumer: terminating
Producer: terminating 
```

**分析**

当我们声明一个变量 volatile 时，这意味着对该变量或从该变量进行的所有读取和所有写入都将直接进入主存储器。这些变量的值永远不会被缓存。

由于 sCount 变量的值永远不会被任何线程缓存，因此消费者总是从主内存中读取 sCount 的原始值（它正在由生产者线程更新）。因此，在这种情况下，输出是正确的，两个线程都打印了 sCount 的不同值 5 次。

这样， volatile 关键字就解决了**VISIBILITY PROBLEM 问题**。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-09-20T11:07:48.237

是的，我经常使用它——它对于多线程代码非常有用。你指出的文章是一篇好文章。虽然有两件重要的事情要记住：

1.  如果您完全了解它的作用以及它与同步的不同之处，您应该只使用 volatile。在许多情况下，从表面上看，volatile 似乎是一种比 synchronized 更简单、性能更好的替代方案，而对 volatile 的更好理解通常会清楚地表明，synchronized 是唯一可行的选择。
2.  volatile 在许多较旧的 JVM 中实际上并不工作，尽管 synchronized 可以。我记得看到一个文档引用了不同 JVM 中不同级别的支持，但不幸的是我现在找不到它。如果您使用的是 Java 1.5 之前的版本，或者您无法控制您的程序将在其上运行的 JVM，请务必考虑一下。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-08-11T16:27:12.843

每个访问 volatile 字段的线程都会在继续之前读取其当前值，而不是（可能）使用缓存值。

只有成员变量可以是易失的或瞬态的。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-20T01:59:35.823

绝对没错。（不仅在 Java 中，在 C# 中也是如此。）有时您需要获取或设置一个值，该值保证是给定平台上的原子操作，例如 int 或 boolean，但不需要线程锁定的开销。volatile 关键字允许您确保在读取值时获得*当前*值，而不是刚刚被另一个线程上的写入过时的缓存值。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-03-02T08:42:57.070

volatile 关键字有两种不同的用法。

1.  阻止 JVM 从寄存器中读取值（假设为缓存），并强制从内存中读取其值。
2.  降低内存不一致错误的风险。

> 防止 JVM 读取寄存器中的值，并强制从内存中读取其值。

*繁忙标志*用于防止线程在设备繁忙且该标志不受锁保护时继续：

```
while (busy) {
    /* do something else */
} 
```

当另一个线程关闭*忙标志*时，测试线程将继续：

```
busy = 0; 
```

但是，由于busy在测试线程中被频繁访问，JVM可以通过将busy的值放在一个寄存器中来优化测试，然后在每次测试之前不读取内存中busy的值就测试寄存器的内容。测试线程永远不会看到busy变化，而另一个线程只会改变内存中busy的值，从而导致死锁。*将繁忙标志*声明为 volatile 会强制在每次测试之前读取其值。

> 降低内存一致性错误的风险。

使用 volatile 变量可以降低**内存一致性错误**的风险，因为对 volatile 变量的任何写入都会与随后读取该相同变量建立 *“先发生”*关系。这意味着对 volatile 变量的更改始终对其他线程可见。

没有内存一致性错误的读写技术称为**原子动作**。

原子动作是一次有效地发生的动作。原子动作不能在中间停止：它要么完全发生，要么根本不发生。在操作完成之前，原子操作的副作用是不可见的。

以下是您可以指定的原子操作：

*   对于引用变量和大多数原始变量（除了 long 和 double 之外的所有类型），读取和写入都是原子的。
*   **对于声明为volatile**的所有变量 （包括 long 和 double 变量），读取和写入都是原子的。

干杯!

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2018-05-31T06:23:43.880

挥发物会跟随。

1> 不同线程对volatile变量的读写总是来自内存，而不是来自线程自己的缓存或者cpu寄存器。所以每个线程总是处理最新的值。2> 当 2 个不同的线程在堆中使用相同的实例或静态变量时，可能会认为其他线程的操作是无序的。请参阅 jeremy manson 的博客。但是 volatile 在这里有所帮助。

以下完全运行的代码显示了如何在不使用同步关键字的情况下按预定义的顺序执行多个线程并打印输出。

```
thread 0 prints 0
thread 1 prints 1
thread 2 prints 2
thread 3 prints 3
thread 0 prints 0
thread 1 prints 1
thread 2 prints 2
thread 3 prints 3
thread 0 prints 0
thread 1 prints 1
thread 2 prints 2
thread 3 prints 3 
```

为了实现这一点，我们可以使用以下完整的运行代码。

```
public class Solution {
    static volatile int counter = 0;
    static int print = 0;
    public static void main(String[] args) {
        // TODO Auto-generated method stub
        Thread[] ths = new Thread[4];
        for (int i = 0; i < ths.length; i++) {
            ths[i] = new Thread(new MyRunnable(i, ths.length));
            ths[i].start();
        }
    }
    static class MyRunnable implements Runnable {
        final int thID;
        final int total;
        public MyRunnable(int id, int total) {
            thID = id;
            this.total = total;
        }
        @Override
        public void run() {
            // TODO Auto-generated method stub
            while (true) {
                if (thID == counter) {
                    System.out.println("thread " + thID + " prints " + print);
                    print++;
                    if (print == total)
                        print = 0;
                    counter++;
                    if (counter == total)
                        counter = 0;
                } else {
                    try {
                        Thread.sleep(30);
                    } catch (InterruptedException e) {
                        // log it
                    }
                }
            }
        }
    }
} 
```

以下 github 链接有一个自述文件，其中给出了正确的解释。 [https://github.com/sankar4git/volatile_thread_ordering](https://github.com/sankar4git/volatile_thread_ordering)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-05-09T13:24:34.923

从 oracle 文档[页面](https://docs.oracle.com/javase/tutorial/essential/concurrency/atomic.html)，需要 volatile 变量来修复内存一致性问题：

> 使用 volatile 变量可以降低内存一致性错误的风险，因为对 volatile 变量的任何写入都会与后续读取该相同变量建立起先发生关系。

这意味着对`volatile`变量的更改总是对其他线程可见。这也意味着当一个线程读取一个 volatile 变量时，它不仅会看到对 的最新更改`volatile`，还会看到导致更改的代码的副作用。

正如`Peter Parker`答案中所解释的，在没有`volatile`修饰符的情况下，每个线程的堆栈都可能有自己的变量副本。通过将变量设为`volatile`，内存一致性问题已得到修复。

查看[jenkov](http://tutorials.jenkov.com/java-concurrency/volatile.html)教程页面以获得更好的理解。

查看相关的 SE 问题，了解有关 volatile 和使用 volatile 的用例的更多详细信息：

[Java 中 volatile 和 synchronized 的区别](https://stackoverflow.com/questions/3519664/difference-between-volatile-and-synchronized-in-java/)

一个实际用例：

您有许多线程，需要以特定格式打印当前时间，例如：`java.text.SimpleDateFormat("HH-mm-ss")`. Yon 可以有一个类，它将当前时间转换`SimpleDateFormat`为每秒钟更新一次的变量。所有其他线程可以简单地使用这个 volatile 变量在日志文件中打印当前时间。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-07-08T11:08:17.810

易失性变量是轻量级同步。当所有线程之间的最新数据的可见性是必需的并且原子性可能会受到损害时，在这种情况下必须首选易失性变量。对 volatile 变量的读取总是返回任何线程最近完成的写入，因为它们既没有缓存在寄存器中，也没有缓存在其他处理器看不到的缓存中。易失性是无锁的。当场景符合上述标准时，我使用 volatile。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-05-17T11:00:18.080

volatile 变量主要用于在主共享缓存行更新后进行即时更新（刷新），以便立即将更改反映到所有工作线程。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2015-12-24T16:41:21.910

volatile 键与变量一起使用时，将确保读取此变量的线程将看到相同的值。现在，如果您有多个线程读取和写入一个变量，那么使变量 volatile 是不够的，并且数据将被损坏。图像线程读取了相同的值，但每个线程都进行了一些更改（比如增加了一个计数器），当写回内存时，数据完整性被破坏。这就是为什么有必要使变量同步（不同的方式是可能的）

如果更改由 1 个线程完成，而其他线程只需要读取此值，则 volatile 将是合适的。

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2019-02-14T05:48:05.610

下面是一个非常简单的代码来演示`volatile`用于控制来自其他线程的线程执行的变量的要求（这是一个`volatile`需要的场景）。

```
// Code to prove importance of 'volatile' when state of one thread is being mutated from another thread.
// Try running this class with and without 'volatile' for 'state' property of Task class.
public class VolatileTest {
    public static void main(String[] a) throws Exception {
        Task task = new Task();
        new Thread(task).start();

        Thread.sleep(500);
        long stoppedOn = System.nanoTime();

        task.stop(); // -----> do this to stop the thread

        System.out.println("Stopping on: " + stoppedOn);
    }
}

class Task implements Runnable {
    // Try running with and without 'volatile' here
    private volatile boolean state = true;
    private int i = 0;

    public void stop() {
        state = false;
    } 

    @Override
    public void run() {
        while(state) {
            i++;
        }
        System.out.println(i + "> Stopped on: " + System.nanoTime());
    }
} 
```

**`volatile`不使用时：即使**在“ *Stopping on: xxx* ”之后，您也永远不会看到“ *Stopped on: xxx* ”消息，并且程序继续运行。

 *```
Stopping on: 1895303906650500 
```

**使用时`volatile`：**您会立即看到“ *Stopped on: xxx* ”。

```
Stopping on: 1895285647980000
324565439> Stopped on: 1895285648087300 
```

演示：[https ://repl.it/repls/SilverAgonizingObjectcode](https://repl.it/repls/SilverAgonizingObjectcode)

# emacs - 为什么 Emacs 中的 fixnums 只有 29 位？

> ID：106597
> 
> 赞同：8
> 
> 时间：2008-09-20T00:44:11.697
> 
> 标签：emacs, lisp, elisp

他们为什么不改变呢？

编辑：问的原因是因为我是 emacs 的新手，我想将 Emacs 用作“程序员计算器”。因此，我可以操作 32 位和 64 位整数，并让它们像在本机机器上一样运行。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-20T08:40:08.200

Emacs-Lisp 是一种动态类型语言。这意味着您在运行时需要类型标签。如果您想使用数字，通常必须将它们打包到某种可以指向的标记容器中（即“装箱”它们），因为在运行时无法区分指针和机器整数没有某种标记方案。

出于效率原因，大多数 Lisp 实现因此不使用原始指针，而是我认为称为描述符的东西。这些描述符通常是单个机器字，可以表示指针、未装箱的数字（所谓的*fixnum*）或各种其他硬编码数据结构之一（通常也值得特别编码 NIL 和 cons 单元，例如）。

现在，显然，如果您添加类型标签，您将没有完整的 32 位作为数字，所以您只剩下 MIT 方案中的 26 位或 Emacs 中的 29 位或任何其他位数你没有用完标记。

各种动态语言的一些实现为 fixnums 保留了多个标签，以便它们可以为您提供 30 位甚至 31 位的 fixnums。SBCL 是执行此操作的 Common Lisp 的一种[实现](http://sbcl-internals.cliki.net/tag%20bit)。不过，我不认为这导致的复杂性对于 Emacs 来说是值得的。*在文本编辑器*中，您多久需要一次快速的 30 位 fixnum 算术而不是 29 位 fixnum 算术，它甚至不会将其 Lisp 代码编译成机器代码（或者是吗？我不记得了，实际上）？你在用 Emacs-Lisp 写一个分布式的.net 客户端吗？那么，最好切换到 Common Lisp！;)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T01:09:10.373

剩下的 3 位被 Lisp 解释器用作标志。（您可以通过为 64 位机器编译 Emacs 来获得更大的整数。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T13:15:46.203

其他人评论了为什么 fixnums 只有 29 位宽。但是，如果您想要程序员的计算器，请查看[calc](http://www.gnu.org/software/emacs/calc.html)。它提供了任意精度的整数、矩阵运算、单位转换、通过 gnuplot 绘制的图形、统计函数、金融函数、科学函数、RPN 和代数符号、公式简化......而且它已经是 Emacs 的一部分，所以要开始使用，请访问“计算”的信息节点并从教程开始。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T05:07:58.117

其他三位用作对象类型的标记。这曾经非常普遍，以至于许多 CPU 架构在其指令集中至少包含对标记整数的一些支持： 例如[Sparc](http://compilers.iecc.com/comparch/article/91-04-079)、 [Alpha](http://pt.withy.org/publications/VLM.html)、 [Burroughs](http://en.wikipedia.org/wiki/Burroughs_large_systems)和 [K-Machine](http://fare.tunes.org/tmp/emergent/kmachine.htm)。现在我们让 Lisp 运行时处理标签，而不需要额外的硬件支持。如果您想快速了解历史，我建议您阅读关于 Sparc 的第一个链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T03:30:32.937

在许多 Lisp 实现中，单词中的某些位用于标记。这让垃圾收集器之类的东西无需猜测即可知道什么是指针，什么不是指针。

为什么你在乎 Elisp 的 fixnum 有多大？您可以按原样打开巨大的文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-11T10:17:45.430

我使用 Common Lisp 解释器 CLISP 作为程序员的计算器。Common Lisp 具有我在任何编程语言中见过的最合理的数字处理。最值得注意的是，它具有任意大小的整数，即 bignums，以及有理数。它还具有任意数字基数的输入和 bignums 的按位函数。如果你想在 Emacs 中计算，你可以在 Mx shell 中运行 CLISP。作为奖励，语法几乎与您在 Emacs Lisp 中使用的完全相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T01:09:13.307

这仅适用于 32 位架构，并且可以根据构建选项进行更改。其他位用于标记基本数据结构。

您可以使用具有更大整数的 64 位构建，并且有用于任意大整数运算的包。

或者，你只是在问一个反问，试图听起来很生气和重要......

# c# - .NET 对象最灵活的序列化是什么，但实现起来很简单？

> ID：106599
> 
> 赞同：31
> 
> 时间：2008-09-20T00:44:26.330
> 
> 标签：c#, .net, json, serialization, json.net

我想序列化和反序列化对象而不必担心整个类图。

灵活性是关键。我希望能够序列化传递给我的任何对象，而无需整个对象图中所需的完整属性。

> 这意味着二进制序列化不是一个选项，因为它仅适用于其他 .NET 平台。我还想要一些人可以阅读的东西，因此可以被管理程序和其他解释器破译。

我在使用 DataContract、JSON 和 XML 序列化程序时发现了问题。

*   大多数这些错误似乎都集中在列表/字典的序列化（即[XML Serializable Generic Dictionary](http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx)）上。
*   “将任何静态未知的类型添加到已知类型列表中 - 例如，通过使用 KnownTypeAttribute 属性或将它们添加到传递给 DataContractSerializer 的已知类型列表中。”

请根据实际经验而不是理论或阅读文章来回答。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-20T02:32:51.267

您是否考虑过序列化为 JSON 而不是 XML？

[Json.NET](http://james.newtonking.com/projects/json-net.aspx)有一个非常强大和灵活的序列化程序，它对 Hashtables/通用字典没有问题，并且不需要任何特定的属性。我知道是因为我写的:)

它通过序列化器上的各种选项为您提供大量控制，并允许您通过为其创建 JsonConverter 来覆盖类型的序列化方式。

在我看来，JSON 比 XML 更具人类可读性，而 Json.NET 提供了编写格式良好的 JSON 的选项。

最后，该项目是开源的，因此您可以在需要时单步执行代码并进行修改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T01:23:08.313

如果我记得它对属性的作用是这样的：

```
[XmlArray("Foo")]
[XmlArrayItem("Bar")]
public List<BarClass> FooBars
{ get; set; } 
```

如果你序列化这个，你会得到类似的东西：

```
<Foo>
    <Bar />
    <Bar />
</Foo> 
```

当然，我可能应该听从专家的意见。这是来自 MS 的更多信息：http: [//msdn.microsoft.com/en-us/library/system.xml.serialization.xmlarrayitemattribute.aspx](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlarrayitemattribute.aspx)

让我知道这是否适合你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T01:02:19.517

根据您的要求，听起来 Xml 序列化是最好的。

序列化时集合有哪些问题？如果您指的是不知道在 List 上使用什么属性或类似的东西，您可以尝试在您的属性上使用 XmlArray 属性。你绝对可以序列化一个集合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T00:47:59.410

XNA 框架中的 IntermediateSerializer 非常酷。[你可以在http://blogs.msdn.com/shawnhar](http://blogs.msdn.com/shawnhar)找到一堆使用它的教程

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T00:51:08.997

SOAP 序列化对我来说效果很好，即使对于没有标记为 [Serializable] 的对象也是如此

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T01:22:07.893

如果集合中的对象包含对同一集合中其他对象的任何引用，您将遇到集合序列化问题。如果存在任何类型的双指向，您最终会创建一个无法序列化的多映射。在我序列化自定义集合的每一个问题上，总是因为我需要一些附加功能，这些功能作为“典型”客户端-服务器应用程序的一部分工作得很好，然后作为消费者提供者的一部分惨遭失败-服务器应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T01:35:08.533

把所有要序列化的类放到一个单独的程序集中，然后用sgen工具生成一个序列化程序集序列化成XML。使用 XML 属性来控制序列化。

如果您需要自定义序列化程序集（并且您*需要*它来支持不是 IXmlSerializable 的类和包含抽象节点的类），则指示 sgen 将源代码转储到单独的文件中，然后将其添加到您的解决方案中。然后，您可以根据需要对其进行修改。

[http://msdn.microsoft.com/en-us/library/bk3w6240(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bk3w6240(VS.80).aspx)

FWIW，我已经设法使用这种技术序列化整个 AdsML 框架（超过 400 个类）。它确实需要大量的手动定制，但如果您考虑框架的大小，就无法解决这个问题。（我使用了一个单独的工具从 XSD 转到 C#）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T10:07:05.637

我同意基于 DataContract 的序列化方法（到 JSON、XML 等）比我想要的要复杂一些。

如果您尝试获取 JSON，请查看[http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)

它是 MS AJAX 扩展的一部分。诚然，它在 .NET 3.5 中被标记为已过时，但 ScottGu 在他的博客评论中提到 ( [http://weblogs.asp.net/scottgu/archive/2007/10/01/tip-trick-building-a-tojson-extension -method-using-net-3-5.aspx#4301973](http://weblogs.asp.net/scottgu/archive/2007/10/01/tip-trick-building-a-tojson-extension-method-using-net-3-5.aspx#4301973)）他不确定为什么，应该支持更长的时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T00:47:51.127

最简单的做法是使用 Serializable 属性标记您的对象，然后使用二进制格式化程序来处理序列化。如果任何包含的对象也被标记为可序列化，则整个类图不应该成为问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T02:14:54.880

也许更有效的方法是使用 BinaryFormatter 进行序列化

复制自[http://blog.paranoidferret.com/index.php/2007/04/27/csharp-tutorial-serialize-objects-to-a-file/](http://blog.paranoidferret.com/index.php/2007/04/27/csharp-tutorial-serialize-objects-to-a-file/)

```
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;

public class Serializer
{
   public Serializer()
   {
   }

   public void SerializeObject(string filename,
                  ObjectToSerialize objectToSerialize)
   {
      Stream stream = File.Open(filename, FileMode.Create);
      BinaryFormatter bFormatter = new BinaryFormatter();
      bFormatter.Serialize(stream, objectToSerialize);
      stream.Close();
   }

   public ObjectToSerialize DeSerializeObject(string filename)
   {
      ObjectToSerialize objectToSerialize;
      Stream stream = File.Open(filename, FileMode.Open);
      BinaryFormatter bFormatter = new BinaryFormatter();
      objectToSerialize =
         (ObjectToSerialize)bFormatter.Deserialize(stream);
      stream.Close();
      return objectToSerialize;
   }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T02:44:42.890

对于互操作性，我们一直使用 Xml 序列化，并确保我们的类从头开始设计以正确执行。

我们创建一个 XSD 模式文档并使用 XSD.exe 从中生成一组类。这会生成部分类，因此我们然后创建一组相应的部分类来添加我们想要帮助我们填充类并在我们的应用程序中使用它们的额外方法（因为它们专注于序列化和反序列化并且有时使用起来有点困难）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-20T09:56:36.673

您应该使用 NetDataContractSerializer。它涵盖任何类型的对象图并支持泛型、列表、多态性（此处不需要 KnownType 属性）、递归等。唯一的缺点是您必须使用 [Serializable] / [DataContract] 属性标记所有类，但是经验表明，无论如何您都必须进行某种手动微调，因为并非所有成员都应该被持久化。它还序列化为 Xml，尽管它的可读性值得怀疑。

我们有与您相同的要求并选择了此解决方案。

# algorithm - 在图像中混合渐变填充角的算法

> ID：106609
> 
> 赞同：5
> 
> 时间：2008-09-20T00:46:50.757
> 
> 标签：algorithm, image, graphics, image-processing, gradient

我需要在图像周围放置一个 alpha 混合渐变边框。我的问题是混合角落，使它们在水平和垂直渐变相遇的地方平滑。我相信有一个标准算法可以解决这个问题。我想我什至多年前在学校遇到过它。但是我在几次网络搜索中都没有找到对其中之一的任何引用。

（我已经在角落实现了径向填充图案，但过渡仍然不够平滑。）

**我的问题**：

1.  如果有解决这个问题的标准算法，它的名称是什么，更好的是，它是如何实现的？

2.  放弃任何标准算法，确定所需像素值以在角落产生平滑渐变的最佳方法是什么？（从垂直渐变平滑过渡到水平渐变。）

**编辑**：所以想象我有一个图像，我将插入一个更大的图像之上。较大的图像是纯黑色，较小的图像是纯白色。在我插入之前，我想通过在较小的图像上设置 alpha 值来将较小的图像混合到较大的图像中，以在它周围创建一个透明的“边框”，使其“淡入”到较大的图像中。做得正确，我应该有一个从黑色到白色的平滑渐变，除了角落和内边缘外，我在任何地方都这样做。

在靠近图像中心的渐变边框边缘，该值将是 255（不透明）。当边界接近外边缘时，alpha 值接近 0。在图像的垂直和水平边界相交的角落，你最终会得到一条对角线。我想消除那条线并平稳过渡。

我需要的是一种算法，该算法确定水平和垂直边缘相遇时在图像角落重叠的每个像素的 alpha 值（0 - 255）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T01:15:48.237

大概你正在将它们重叠的两个渐变相乘，对吧？

不知道标准算法。但是，如果您使用符号形状的渐变而不是线性渐变，那应该消除两者重叠的可见边缘。

一个简单的 sigmoid 函数是 smoothstep(t) = t *t* (3 - 2*t) 其中 0 <= t <= 1

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T00:57:39.917

如果您不需要调整大小，则可以使用简单的 alpha 贴图。

然而，我曾经使用过一个简单的高斯渐变，在我希望它成为最后一个完全不透明像素的位置的平均值。如果这是有道理的。

# java - Seam 2.0.2sp1 应用程序可以在嵌入 JBoss 的 Tomcat 5.5.9 上运行吗？

> ID：106622
> 
> 赞同：2
> 
> 时间：2008-09-20T00:51:31.103
> 
> 标签：java, jpa, seam

我正在尝试使用 JBoss Embedded jpa 预订示例运行 Tomcat。我运行构建并部署战争。然后我收到以下错误：

```
错误 [catalina.core.ContainerBase.[Catalina].[localhost].[/jboss-seam-jpa]] 配置类 com.sun.faces.config.ConfigureListener 的应用程序侦听器时出错
java.lang.NoClassDefFoundError: javax/el/CompositeELResolver
        在 java.lang.Class.getDeclaredConstructors0（本机方法）
        在 java.lang.Class.privateGetDeclaredConstructors(Class.java:2357)
        在 java.lang.Class.getConstructor0(Class.java:2671)
        在 java.lang.Class.newInstance0(Class.java:321)
        在 java.lang.Class.newInstance(Class.java:303)
        在 org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3618)
        在 org.apache.catalina.core.StandardContext.start（StandardContext.java:4104

```

我发现这个类存在于不在类路径中的 el-api.jar 中。所以我将 el-api.jar 添加到 WEB-INF/lib 目录中。然后我收到以下错误：

```
信息：JSF1048：存在 PostConstruct/PreDestroy 注释。标有这些注解的 ManagedBeans 方法将表示已处理的注解。
2008 年 9 月 19 日下午 5:37:50 com.sun.faces.config.ConfigureListener installExpressionFactory
严重：实例化 ExpressionFactory 时出错
java.lang.ClassNotFoundException: com.sun.el.E​​xpressionFactoryImpl
        在 org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1332)
        在 org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1181)
        在 java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
        在 java.lang.Class.forName0（本机方法）
        在 java.lang.Class.forName(Class.java:164)
        在 com.sun.faces.config.ConfigureListener.installExpressionFactory(ConfigureListener.java:1521)

```

这个库似乎在 el-ri.jar 或 JSP 2.1 jar 中。难道我做错了什么？有没有解释如何在 tomcat 5.5.x 上运行 seam 应用程序的地方？任何帮助是极大的赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T16:32:16.057

我得到了这个工作。我在 seam/examples/jpa 示例下运行了 ant tomcat55。这包括所需的 el- *.jars。然后我运行“ant clean”和“ant jboss-embeded”并手动复制到所有*来自 tomcat55 make 的 el-.jars。这解决了我上面的问题。现在我可以使用嵌入式 JBoss 启动 tomcat 5.5.9。我现在可以毫无问题地运行预订示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T03:43:28.037

你看过文档吗，在 www.seamframework.org 的论坛和 www.jboss.org 的旧论坛上也有一些非常好的信息。

# java - 如何在第三方类中给 java.util.Random 一个特定的种子？

> ID：106623
> 
> 赞同：5
> 
> 时间：2008-09-20T00:51:31.320
> 
> 标签：java, random, jvm, classloader

我有一个 Java 程序，它加载第三方类文件（我没有编写的类）并执行它们。这些类经常使用`java.util.Random`，默认情况下，每次实例化时都会生成随机的起始种子值。出于可重复性的原因，我想每次都为这些类提供相同的起始种子，仅由我自行决定更改它。

以下是一些明显的解决方案，以及为什么它们不起作用：

1.  在第三方类文件中使用不同的 Random 类。这里的问题是我只加载类文件，不能修改源。

2.  使用自定义类加载器来加载我们自己的 Random 类，而不是 JVM 的版本。这种方法不起作用，因为 Java 不允许类加载器覆盖`java`包中的类。

3.  将 rt.jar 的`java.util.Random`实现替换为我们自己的，或者将文件放入 JVM 的受信任位置。这些方法要求应用程序的用户在他们的机器上安装 JVM，这并不好。

4.  将自定义`java.util.Random`类添加到引导类路径。虽然这在技术上可行，但对于这个特定的应用程序来说，这是不切实际的，因为这个应用程序是供最终用户从 IDE 运行的。我想让用户方便地运行应用程序，这意味着强迫他们设置引导类路径是一件痛苦的事情。我无法将其隐藏在脚本中，因为它旨在从 Eclipse 之类的 IDE 中运行（以便于调试。）

那么我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T01:20:25.980

您的选项 2 将按照以下说明实际工作。

您将需要（如 anjab 所说）更改引导类路径。

在程序的命令行中，您需要添加以下内容：

java -Xbootclasspath/p:C:\your\random_impl.jar YourProgram

假设您使用的是 Windown 机器或任何操作系统中的相关路径。

该选项在加载 rt.jar 之前将类添加到 jar 文件中。因此，您的 Random 将在 rt.jar Random 类之前加载。

通过键入以下内容显示用法：

```
java -X 
```

它显示了 JVM 具有的所有 X(tra) 功能。它可能在其他 VM 实现（例如 JRockit 或其他）上不可用，但它在 Sun JVM 上存在。

-Xbootclasspath/p：在引导类路径前面添加

我在一个应用程序中使用了这种方法，其中默认的 ORB 类应该替换为其他 ORB 实现。ORB 类是 Java 核心的一部分，从来没有任何问题。

祝你好运。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T03:56:21.737

考虑修改第三方库，让他们为他们的 Random 实例使用 seen。尽管您没有源代码，但您可以编辑字节码来完成它。一个有用的工具包是[ASM](http://asm.objectweb.org/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T01:00:55.120

您可以使用 AOP 拦截对 Random 的调用并将 arg 调整为您想要的。

山姆

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T01:11:28.823

尽管您可能不会轻易更改“java.x”和“sun.x”包的类加载器，但有一种方法可以计算这些类的类加载（并安装“在类被字节编码和加载后”侦听器），所以你从这些包中加载类后，可以设置类似种子的东西。提示：使用反射。

无论如何，只要我没有进一步的信息，你究竟想要达到什么目标，在这里很难帮助你。

PS：请注意，“静态{}” - 块可能会再次阻碍您弄乱种子。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T01:01:46.587

“使用自定义类加载器来加载我们自己的 Random 类而不是 JVM 的版本。这种方法将不起作用，因为 Java 不允许类加载器覆盖 java 包中的类。”

如何更改引导类路径以使用您的自定义 Random 类？

BR，~A

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-04T07:45:22.767

是的，选项 2 有效：创建了两个用于测试目的的类，分别命名`ThirdPartyClass.java`为`Random.java`

从创建 jar`ThirdPartyClass.class`

```
jar -cvf tpc.jar ThirdPartyClass.class 
```

从创建 jar`Random.class`

```
jar -cvf rt123.jar Random.class 
```

之后使用以下命令执行：

```
java  -Xbootclasspath/p:tcp.jar:rt123.jar -cp . -verbose ThirdPartyClass 
```

输出将是：`seed value for ThirdPartyClass-> 1`

源代码ThirdPartyClass.java----->

```
import java.util.Random;

public class ThirdPartyClass {
    ThirdPartyClass(long seed ) {
        System.out.println("seed value for ThirdPartyClass-> "+seed);
    }   

    public static void main(String [] args) {
        ThirdPartyClass tpc=new ThirdPartyClass(new Random().nextLong());
    }
} 
```

源代码 Random.java-------->

```
package java.util;

import java.io.Serializable;

public class Random extends Object implements Serializable
{
    public Random() {
    }

    public Random(long seed) {
    }

    public long nextLong() {
        return 1;
    }
} 
```

谢谢马哈维尔·普拉萨德·马里

# iphone - Objective-C 中的内存管理

> ID：106627
> 
> 赞同：11
> 
> 时间：2008-09-20T00:52:08.013
> 
> 标签：iphone, objective-c, cocoa, memory, memory-management

> **可能的重复：**
> [学习 Obj-C 内存管理](https://stackoverflow.com/questions/370427/learn-obj-c-memory-management)
> [iPhone 内存管理的最佳解释在哪里？](https://stackoverflow.com/questions/710288/where-are-the-best-explanations-of-memory-management-for-iphone)

我来自 C/C++ 背景，Objective-C 的动态特性对我来说有些陌生，是否有任何人可以向我指出 Objective-C 中一些基本内存管理技术的好资源？前任。保留、释放、自动释放

例如，使用指向 Objective-C 对象的指针并将其视为数组是完全非法的吗？您是否被迫将 NSArray 和 NSMutableArray 用于数据结构？

我知道这些都是相当新手的问题，感谢您为我提供的任何帮助。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-20T00:52:45.063

[给你](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/index.html)：

> 应用程序内存管理是在程序运行时分配内存、使用它并在完成后释放它的过程。一个编写良好的程序使用尽可能少的内存。在 Objective-C 中，它也可以看作是在许多数据和代码之间分配有限内存资源所有权的一种方式。完成本指南的工作后，您将掌握管理应用程序内存所需的知识，方法是显式管理对象的生命周期并在不再需要它们时释放它们。
> 
> 尽管内存管理通常是在单个对象级别考虑的，但您的目标实际上是管理对象图。您想确保内存中没有比实际需要更多的对象...

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-28T20:54:03.803

重复内存管理的基本规则通常是没有用的，因为你几乎总是会犯错误或不完整地描述它们——就像'heckj'和'benzado'提供的答案一样......

内存管理规则的 Apple 文档中提供了内存管理的基本[规则](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html)。

来自“www.stray-bits.com”的答案：声明从“非拥有”方法返回的对象是“自动释放”的，充其量也是一种误导。您通常不应该考虑某些东西是否“自动释放”，而只需考虑内存管理规则并根据这些约定确定您是否拥有返回的对象。如果你这样做，你需要放弃所有权......

一个反例（考虑自动释放对象）是当您考虑与方法相关的性能问题时，例如`stringWithFormat:`. 由于您通常 (1) 无法直接控制这些对象的生命周期，因此它们可能会持续较长时间并不必要地增加应用程序的内存占用。虽然在桌面上这*可能*没什么影响，但在更受限制的平台上，这可能是一个重大问题。因此，在所有平台上使用`alloc`/`init`模式被认为是最佳实践，在更受限制的平台上，强烈建议您尽可能不要使用任何会导致自动释放对象的方法。

(1) 您可以使用自己的本地自动释放池进行控制。有关这方面的更多信息，请参阅[Apple 的内存管理编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Concepts/AutoreleasePools.html#//apple_ref/doc/uid/20000047)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T03:53:10.917

Objective-C 只是 C 的超集。你可以在 C 中做的任何事情在 Objective-C 中都是有效的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T09:11:10.353

以下是规则：

1.  如果您通过调用`alloc`or创建一个对象`copy`，则您拥有它并且`release`在完成后必须拥有它。
2.  如果你没有创建一个对象，但希望它确保它在控制返回到运行循环之前一直存在（或者，为了简单起见，你的方法返回），给它发送一条`retain`消息，然后`release`在你完成后发送它.
3.  如果您创建一个对象并希望从您的方法中返回它，您有义务释放它，但您不想在调用者有机会看到它之前销毁它。所以你发送它`autorelease`，它把它放在自动释放池中，一旦控制回到程序的事件循环，它就会被清空。如果没有其他人保留该对象，它将被释放。

关于数组，你可以自由地做这样的事情：

```
NSObject *threeObjects[3];

threeObjects[0] = @"a string";
threeObjects[1] = [NSNumber numberWithInt:2];
threeObjects[2] = someOtherObject; 
```

无论如何使用 NSArray 的原因：

*   NSArray 会在您添加对象时保留它们，并在您删除它们时释放它们，而在纯 C 数组中您必须自己做。
*   如果您将数组作为参数传递，则 NSArray 可以报告它包含的对象的数量，使用普通的 C 数组您也需要传递一个计数。
*   在一行上混合方括号的含义感觉很奇怪：

    `[threeObjects[0] length]`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T04:01:20.803

您当然可以使用数组并进行自己的内存管理。最大的组成部分是，如果您正在创建任何 NSObject 子类，并且您使用 [XXX alloc] 方法创建它，或者如果您使用 [xxx copy] 从另一个副本中获取它，那么您有责任将其与相关版本匹配。

如果从任何地方获取一个变量并打算保留它超过您正在执行的直接使用，那么请确保您在其上调用 [... retain]。

链接[http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)包含所有详细信息，绝对是第一个阅读的地方。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T01:20:06.137

如果它是一个数组，请随意使用指针进行迭代。常规数组仍然由 C 管理。如果它是 NSArray，请阅读 NSArray 文档。如果他们说要以特定的方式做，那就那样做。为 OS X 编写代码时，请按本书进行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T18:42:22.360

如果您使用 C 风格的数组来存储对象并决定使用垃圾回收，需要注意的是，您需要分配该内存`NSAllocateCollectable(sizeof(id)*size, NSScannedOption)`并将该变量标记为`__strong`.

这样，收集器就知道它持有对象，并将在该变量生命周期内将存储在那里的对象视为根。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T16:39:39.440

> 例如，使用指向 Objective C 对象的指针并将其视为数组是完全非法的吗？

如果它不是一个数组，那么是的。

> 您是否被迫将 NSArray 和 NSMutableArray 用于数据结构？

不。您可以使用 C 数组，并且应该能够使用 C++ STL 向量（虽然我不使用 C++，所以我不知道具体如何）。

但是没有理由不使用`NS{,Mutable}Array`. 不要害怕 Cocoa 框架，因为它们是你的朋友。

并且不要忘记其他集合类型，例如`NS{,Mutable}Set`和`NS{,Mutable}Dictionary`。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-04T16:17:42.753

作为另一位新手，我发现斯坦福 iOS 讲座非常有用：http: [//itunes.apple.com/itunes-u/developing-apps-for-ios-hd/id395605774](http://itunes.apple.com/itunes-u/developing-apps-for-ios-hd/id395605774)

这很好，因为它通过演示展示了实际的概念，而且我通常发现与我交谈的人比仅仅阅读更能吸收。

我绝对认为这是您必须通过不同来源学习和重新学习的主题之一……只是将其锤入您的脑海。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T14:02:49.827

可能还需要注意的是，对于像 NSString + (NSString *)stringWithFormat: 这样的类消息（基本上，为您分配对象而不是要求您自己分配对象的帮助消息），生成的对象会自动释放，除非您明确保留它。

# python - 为什么 unicode() 只在我的对象上使用 str() 而没有给出编码？

> ID：106630
> 
> 赞同：7
> 
> 时间：2008-09-20T00:53:24.373
> 
> 标签：python, unicode, encoding

我首先创建一个带有一些**非 ascii** *utf-8*编码数据的字符串变量：

```
>>> text = 'á'
>>> text
'\xc3\xa1'
>>> text.decode('utf-8')
u'\xe1' 
```

使用`unicode()`它会引发错误......

```
>>> unicode(text)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: 
                    ordinal not in range(128) 
```

...但如果我知道编码，我可以将其用作第二个参数：

```
>>> unicode(text, 'utf-8')
u'\xe1'
>>> unicode(text, 'utf-8') == text.decode('utf-8')
True 
```

现在，如果我有一个在方法中返回此文本的类`__str__()`：

```
>>> class ReturnsEncoded(object):
...     def __str__(self):
...         return text
... 
>>> r = ReturnsEncoded()
>>> str(r)
'\xc3\xa1' 
```

`unicode(r)`似乎使用`str()`它，因为它引发了与上面相同的错误`unicode(text)`：

```
>>> unicode(r)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: 
                    ordinal not in range(128) 
```

到目前为止，一切都按计划进行！

**但正如没有人会想到的那样，`unicode(r, 'utf-8')`甚至不会尝试：**

```
>>> unicode(r, 'utf-8')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: coercing to Unicode: need string or buffer, ReturnsEncoded found 
```

为什么？为什么会出现这种不一致的行为？它是一个错误吗？是有意的吗？很尴尬。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T01:32:09.070

这种行为确实看起来令人困惑，但内涵丰富。我在这里复制了[Python Built-In Functions 文档](http://docs.python.org/lib/built-in-funcs.html)中的全部 unicode 文档（对于 2.5.2 版，在我写这篇文章时）：

> **unicode（[对象[，编码[，错误]]]）**
> 
> 使用以下模式之一返回对象的 Unicode 字符串版本：
> 
> 如果给出编码和/或错误，unicode() 将使用编解码器对对象进行解码，该对象可以是 8 位字符串或字符缓冲区。encoding 参数是一个给出编码名称的字符串；如果编码未知，则引发 LookupError。根据错误进行错误处理；这指定了对输入编码中无效字符的处理。如果errors是'strict'（默认值），一个ValueError会在错误时引发，而'ignore'值会导致错误被静默忽略，'replace'值会导致官方Unicode替换字符，U+FFFD，用于替换无法解码的输入字符。另请参阅[编解码器](http://docs.python.org/lib/module-codecs.html)模块。
> 
> 如果没有给出可选参数，unicode() 将模仿 str() 的行为，只是它返回 Unicode 字符串而不是 8 位字符串。更准确地说，如果 object 是 Unicode 字符串或子类，它将返回该 Unicode 字符串，而无需应用任何额外的解码。
> 
> 对于提供 __unicode__() 方法的对象，它将不带参数调用此方法来创建 Unicode 字符串。对于所有其他对象，请求 8 位字符串版本或表示，然后使用“严格”模式下的默认编码的编解码器将其转换为 Unicode 字符串。
> 
> 2.0 版中的新功能。在 2.2 版更改：添加了对 __unicode__() 的支持。

因此，当您调用 时`unicode(r, 'utf-8')`，它需要一个 8 位字符串或字符缓冲区作为第一个参数，因此它使用该`__str__()`方法强制您的对象，并尝试使用编解码器对其进行`utf-8`解码。如果没有`utf-8`，该`unicode()`函数会`__unicode__()`在您的对象上查找方法，但没有找到它，会按照您的建议调用该`__str__()`方法，尝​​试使用默认编解码器转换为 unicode。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T00:58:52.303

`unicode`不会猜测您的文本的编码。如果您的对象可以将自身打印为`unicode`，请定义`__unicode__()`返回 Unicode 字符串的方法。

* * *

秘诀在于它`unicode(r)`实际上并没有调用`__str__()`自己。相反，它正在寻找一种`__unicode__()`方法。默认实现`__unicode__()`将调用`__str__()`然后尝试使用`ascii`字符集对其进行解码。当您传递编码时，`unicode()`期望第一个对象是可以解码的东西——即`basestring`.

* * *

> 行为很奇怪，因为如果我不通过“utf-8”，它会尝试解码为 ascii。但是如果我通过 'utf-8' 它会给出一个不同的错误......

那是因为当您指定“utf-8”时，它将第一个参数视为要解码的类似字符串的对象。没有它，它将参数视为要强制转换为 unicode 的对象。

我不明白这种混乱。如果您知道对象的`text`属性将始终是 UTF-8 编码，只需定义`__unicode__()`，然后一切都会正常工作。

# sharepoint - 在管理中心中使用管理员任务是否安全？

> ID：106632
> 
> 赞同：1
> 
> 时间：2008-09-20T00:55:19.800
> 
> 标签：sharepoint

奇怪的问题，但是：Sharepoint 2007 在安装后会通过管理中心的管理员任务向您致意。

我只是想知道这个列表对于我自己的管理任务是否“安全”？我问的原因是因为我发现 Sharepoint 使用了很多“黑魔法”和不合逻辑的行为并且很容易中断，所以如果我将自己的任务输入到任务列表中，我不想冒险破坏任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T02:38:56.897

我不会使用该列表，因为它似乎是用各种额外的字段专门修改的，我不想滥用这些。

创建自己的管理任务列表可能只需要您付费。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T15:59:04.213

该列表是可扩展的。您可以通过对象模型获得对该列表的引用：SPAdministrationWebApplication.Local.AdministrativeTasks

我理解您的担忧，但在这种情况下，您可以随意添加到此列表中。

# html - 如果有 1 行减去页脚，则内容占据视口全高的网页模板

> ID：106646
> 
> 赞同：6
> 
> 时间：2008-09-20T01:00:56.493
> 
> 标签：html, css

我正在寻找一个基于 CSS 的网页模板，`div`当它的内容只有几行时，它的主要内容占据了视口的整个高度（减去页眉和页脚的高度）。页脚应该在视口的底部，而不是内容的正下方，它更多地位于视口的中间。内容区域需要垂直扩展才能与页脚顶部连接。

如果内容需要比视口更多的空间，则作为标准网页设计，页脚可以位于网页底部（而不是视口底部）。

指向特定链接或示例代码的链接表示赞赏。不要提及模板站点并告诉我在那里进行搜索。必须至少在 IE 6 和 FF 中工作。如果需要 JavaScript，只要浏览器不支持 JS 就可以，它默认将页脚放在内容区域的底部而不破坏布局。

案例#1的草图：

```
--------------   <-----
header area  |         |
-------------|         |
small content|         |   
             |     view-port
             |         |
             |         |
-------------|         |
footer area  |         |
--------------   <-----

all other cases:

--------------   <-----
header area  |         |
-------------|         |
big content  |         |   
             |     view-port
             |         |           
             |         |
             |         |
             |         |
             |    <----      
             |         
-------------|         
footer area  |         
-------------- 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T01:19:36.917

此处示例： [http ://www.rossdmartin.com/aitp/index.htm](http://www.rossdmartin.com/aitp/index.htm)

更深入的资源：

*   [http://www.themaninblue.com/experiment/footerStickAlt/](http://www.themaninblue.com/experiment/footerStickAlt/)
*   [http://ryanfait.com/sticky-footer/](http://ryanfait.com/sticky-footer/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T01:29:02.870

寻找“Footer Stick Alt”...有一篇很长的博客写了如何使这项工作。

[由卡梅隆·亚当斯（Cameron Adams）又名“蓝衣人”完成](http://www.themaninblue.com/writing/perspective/2005/08/29/)。

# windows - 在 Windows 上同时监控多个日志文件（通过 ssh）？

> ID：106668
> 
> 赞同：4
> 
> 时间：2008-09-20T01:10:06.907
> 
> 标签：windows, logging, terminal, monitoring

我使用 poderosa（一个 .NET 终端应用程序）来监视多个 linux/solaris 服务器上的日志。这个应用程序目前没有得到维护，我遇到了几个问题。

我想知道其他用户如何同时实时监控多个日志（如tail -f logfile）。我希望能够标签/级联几个 ssh 尾部。

谢谢你

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T01:17:52.880

您可以只 ssh 到一台服务器，然后从那里使用[mutitail](http://www.vanheusden.com/multitail/)来跟踪所有其他服务器上的日志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T01:12:29.413

您可以使用[Putty Connection Manager](http://puttycm.free.fr/)将选项卡添加到 PuTTy。然后通过 SSH 进入机器两次并来回切换。

[设置教程](http://www.howtogeek.com/howto/the-geek-blog/get-tabs-for-your-putty/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T01:19:52.797

SSH 到其中一台服务器，在其上运行屏幕。然后，您可以将屏幕分成多个窗口，每个窗口都可以

```
ssh serverX tail -f /path/to/log/file 
```

此方法的一个附带优点是您不必每次连接时都重新启动尾部 - 相反，您可以重新连接到正在运行的屏幕会话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T08:50:16.533

从 bash 你可以（保存`~/.bashrc`或其他东西）：

```
function create-follower () {
    local _NAME=$1;
    local _USER=$2;
    local _HOST=$3;
    local _PATH=$4;

    if ! [ "${_NAME}" ]\
    || ! [ "${_USER}" ]\
    || ! [ "${_HOST}" ]\
    || ! [ "${_PATH}" ] ; then
        {   echo "Cannot create log follower." ;
            echo;
            echo "Usage: create-follower NAME USER HOST LOG-FILE";
        } >&2;
        return 1 ;
    fi ;

    eval "function ${_NAME}(){ ssh ${_USER}@${_HOST} tail -f \"${_PATH}\" & }"
}

function activate-followers () {
    if (( $# < 1 )) ; then
        {   echo "You must specify at least one follower to use" ;
            echo ;
            echo "Usage:" ;
            echo "    activate-followers follower1 [follower2 ... followerN]";
        } >&2;
        return 1 ;
    fi ;

    for FOLLOW in "${@}" ; do
        ${FOLLOW} ;
    done ;

    wait;
}

function stop-followers () {
    if [ "$(jobs)" ] ; then
        kill -9 $(jobs | perl -pe 's/\[([0-9]+)\].*/%$1/') ;
    fi ;
} 
```

然后从您的 shell 中，定义您要遵循的日志：

```
[dsm@localhost:~]$ create-follower test1 user1 localhost /tmp/log-1.txt
[dsm@localhost:~]$ create-follower test2 user2 otherhost /tmp/log-2.txt
[dsm@localhost:~]$ create-follower test2 user3 remotebox /tmp/log-3.txt 
```

现在，激活关注者：

```
[dsm@localhost:~]$ activate-followers test1 test2 test3 
```

要退出函数 use`CTRL+C`并停止后台进程，请使用：

```
[dsm@localhost:~]$ stop-followers 
```

**注意 1：假设您的盒子已经设置了公钥认证。**

**注意 2：您必须在退出 activate-followers 功能后终止所有仍在运行的作业。您可能需要手动执行此操作，因为提供的功能会对所有后台作业进行强力终止**

**注意 3：这假设一个工作的类 unix 环境，您可以通过安装 cygwin 来获得**

谁说你不能在 shellscript 中做 lisp ;-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-06-25T12:50:56.120

您可以在'side log 中结帐。

我创建的一个 Java 工具，能够使用 SSH 读取本地和远程日志文件。使用起来相当简单。

更多解释：[https ://github.com/pschweitz/insidelog/wiki](https://github.com/pschweitz/insidelog/wiki)

只需下载与您的操作系统相对应的版本，或 Java 运行时中的本机 jar 版本可执行文件（需要 java 8_40 或更高版本）：

[https://github.com/pschweitz/insidelog/releases](https://github.com/pschweitz/insidelog/releases)

您可以找到完整的文档（也嵌入在 Github 页面中）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T01:18:19.603

我首先想到的两个选项。

选择您最喜欢的 SSH 应用程序（putty、cygwin 中的 ssh 等）并登录机器。
1\. 每个日志的 SSH（在您的机器上打开许多窗口或选项卡，具体取决于您的应用程序）
2\. SSH 一次并使用[screen](http://aymanh.com/increase-your-linux-unix-productivity-with-gnu-screen)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T01:20:03.047

如果您确实需要同时查看两个日志，并且选项卡是不可能的，您可以安装一个名为 LogResolveMerge.pl 的 perl 脚本。它将两个日志合并在一起，并将输出转储到 STDOUT。但是，这将是资源密集型的，如果您的意图是 tail -f 日志，它可能不会太有效。

# artificial-intelligence - 如何在 Microsoft Robotics Studio 2.0 中创建新类型的实体？

> ID：106684
> 
> 赞同：6
> 
> 时间：2008-09-20T01:16:23.850
> 
> 标签：artificial-intelligence, robotics, robotics-studio

我试图用 MRS 做的是自学一些基本的人工智能；我想做的是制作一个火箭实体，包括矢量排气和分级。任何人都知道如何制作一个可以飞行的实体？还是我只需要不断地向上施加力？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-21T05:41:07.077

嘿 TraumaPony，你的问题看起来很孤独 :)

[我在这里](http://msdn.microsoft.com/en-us/magazine/cc546547.aspx)查看了一篇关于 MRS 2.0 的 MSDN 文章，我相信您实际上需要创建某种 Rocket 实体，然后创建一个它可以使用的 Thruster 实体。在文章中，他们能够重用一个差分驱动实体来推动他们的机器人前进。我希望这会有所帮助。我或多或少是在黑暗中拍摄，因为还没有其他人试图帮助你。干杯! :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T00:32:10.013

我自己只是从 MRS 开始 - 但我认为你走在正确的轨道上，你需要创建一个火箭发动机实体，你可以对其施加推力。有关创建实体的示例，请参阅[Simulation Tutorial 2 - Compose Entities with Simulation Services 。](http://msdn.microsoft.com/en-us/library/bb483078.aspx)

您可以使用`Simulation.Physics.PhysicsEntity.ApplyForce()`. 我认为你会在你的实体的`Update()`方法中做到这一点。但这取决于 ApplyForce 是否真的在应用 Impulse（仅适用于该帧的力），或者它是否真的在添加持久力。我假设它是前者，因为我认为没有办法取消申请。在这种情况下，Update() 可能是正确的地方。如果它是持久的，您只需要在推力水平发生变化时执行此操作。

您还需要创建一个与实体合作的服务，以便您可以与火箭交互，例如发射或引导它。在同一篇文章中有一个服务创建示例。

# php - 如何让 PHPMyAdmin 显示 MySQL 警告？

> ID：106685
> 
> 赞同：4
> 
> 时间：2008-09-20T01:16:56.550
> 
> 标签：php, mysql, phpmyadmin

我使用`PHPMyAdmi`n 是为了方便更新远程数据库。

但默认情况下它不显示警告，这最近让我陷入了一些尴尬的麻烦，我正在更新一个 SET 字段，其中的字符串不在其列表中并且没有注意到问题。

我正在使用`2.11.9.1 (Dreamhost's default install)`.

在`PHPMyAdmin`wiki 上，它将“显示警告”列为[2.9.0 版](http://wiki.cihar.com/pma/phpMyAdmin_2.9.0-rc1)的一项功能，甚至将“显示所有警告”列为 2.10.2 的一项功能——但我该如何真正打开它呢？文档不是很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-03-08T01:45:13.287

我只是在寻找同样的东西。

当我`INSERTs`使用标准的 phpMyAdmin 'insert' 表单运行时，行会被插入，但会出现一个红色条，说明任何警告。但是当我进行*批量插入*时，不会出现任何警告，而是出现一个绿色条，只是说明受影响的行数（给你的印象是一切都成功了，而实际上它可能没有）。

`SHOW WARNINGS`我发现我必须手动发送命令。例如，在运行此查询时，我将两个语句都放入了 phpMyAdmin SQL 框中。

 ****```
INSERT INTO test2 SELECT * FROM test1;
SHOW WARNINGS; 
```**  **这给出了如下警告列表...

```
Level    Code   Message
Warning  1265   Data truncated for column 'a' at row 1
Warning  1265   Data truncated for column 'a' at row 3
Warning  1265   Data truncated for column 'b' at row 3
Warning  1366   Incorrect integer value: 'x' for column 'b' at row... 
```

***注意事项：***

*   您以后无法运行该`SHOW WARNINGS`命令，它将显示为空。当您单击“开始”时，它必须在您的初始查询框中。这是因为 MySQL 只保存您运行的最后一个查询的警告。每次您单击链接或按钮时，phpMyAdmin 都会在数据库上运行各种其他查询，因此您之前的警告会丢失。
*   phpMyAdmin 不*支持*显示来自自定义查询的多个结果。因此，将其作为一个 SQL 脚本执行是行不通的……（从 3.4.10.1 版开始*）*

    ```
    INSERT INTO test2 VALUES ('my text', 'something else');
    SHOW WARNINGS;    # you won't see the warnings from here
    INSERT INTO test2 VALUES ('my text', 'something else');
    SHOW WARNINGS; 
    ```

    虽然上述方法在 phpMyAdmin 中不起作用，但它*应该*在 MySQL 命令行客户端中正常工作。因此，如果需要，请使用它。

如果您确实有多个插入并且想要显示所有警告，则必须将它们链接在一起作为单个`INSERT`语句。例如：

```
INSERT INTO test2 VALUES 
('my text', 'something else'), 
('my text', 'something else');
SHOW WARNINGS; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T02:01:42.433

我不相信 Dreamhost 让您可以访问他们安装 phpMyAdmin 的配置文件。但是，您可以轻松地自己安装 phpMyAdmin，方法是从[他们的网站](http://www.phpmyadmin.net/home_page/index.php)下载源代码并将其解压缩到您要访问的目录（例如 your-domain.com/phpma）。然后，按照[网站的说明编辑您的配置文件](http://www.phpmyadmin.net/documentation/#quick_install)（其中应包括启用您所要求的警告）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T04:12:01.010

> 按照网站的说明编辑您的配置文件（其中应包括启用您所要求的警告）。

嗯，是的，它应该。但是我在配置文件中看不到它，在您链接到的页面中也看不到它。我已经在明显的地方寻找信息，相信我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T01:21:03.620

我可能弄错了，但如果我没记错的话，您需要访问 phpMyAdmin 配置文件才能启用它。

# ruby-on-rails - 在 Rails 中：从与模型无关的表单中检索用户输入，在控制器中使用结果

> ID：106711
> 
> 赞同：1
> 
> 时间：2008-09-20T01:32:57.807
> 
> 标签：ruby-on-rails, before-filter

这是我正在尝试做的简化版本：

1.  在执行任何其他操作之前，向用户提供一个表单以检索字符串。
2.  输入字符串，然后重定向到默认的控制器动作（例如索引）。字符串只需要存在，不需要其他验证。
3.  该字符串必须可用于此控制器中的所有操作（作为实例变量？）。

我对 Rails 很陌生，但这似乎不应该非常难，所以我觉得有点愚蠢。

我试过的：我有一个`before_filter`重定向到一个看起来像的私有方法

```
def check_string
  if @string
    return true
  else
    get_string
  end
end 
```

该`get_string`方法看起来像

```
def get_string
  if params[:string]
    respond_to do |format|
      format.html {redirect_to(accounts_url)} # authenticate.html.erb
    end
  end

  respond_to do |format|
    format.html {render :action =>"get_string"} # get_string.html.erb
  end
end 
```

这失败了，因为我在同一个操作中有两个渲染或重定向调用。当然，我可以先把它拿出来`respond_to`，但结果是控制器被困在了`get_string`方法中。我或多或少可以看出为什么会这样，但我不知道如何解决它并爆发。我需要能够显示一个表单（视图），获取然后对输入字符串执行某些操作，然后正常进行。

该`get_string.html.erb`文件看起来像

```
<h1>Enter a string</h1>
<% form_tag('/accounts/get_string') do %>
<%= password_field_tag(:string, params[:string])%>
<%= submit_tag('Ok')%>
<% end %> 
```

我会感谢任何帮助！

## 编辑

感谢您的回复......
@Laurie Young：你是对的，我误会了。出于某种原因，我认为用户调用的任何给定控制器的实例都会在他们的会话中持续存在，并且 Rails 的一些魔力在于跟踪与每个用户会话关联的对象。我可以看到为什么回想起来这并没有多大意义，以及为什么我尝试使用实例变量（我认为会持续存在）不起作用。也谢谢你:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T01:52:24.483

部分问题是您没有设置@string。您根本不需要 before_filter ，并且应该能够使用：

```
def get_string
  @string = params[:string] || session[:string] 
  respond_to do |format|
    if @string  
      format.html {redirect_to(accounts_url)} # authenticate.html.erb
    else 
      format.html {render :action =>"get_string"} # get_string.html.erb
    end
  end
end 
```

如果您希望 @string 变量可用于所有操作，则需要将其存储在会话中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T16:00:45.300

看起来我就像你缺少一个 Rails 概念。用户看到的每一页都是不同的请求。

我可能误解了你想要做什么。但在我看来，您希望用户看到两个页面，

1.  在第一页他们设置了一个字符串变量
2.  在第二页中，他们看到一个以某种方式依赖于变量集的页面

做到这一点的最好方法是必须有一个 before 过滤器来检查变量的存在，如果它没有设置，则将它们重定向到表单，否则继续

```
class MyController < ApplicationController::Base
  before_filter :require_string

  def require_string
    return true if @string #return early if called multiple times in one request
    if params['string'] or session['string']  #depending on if you set it as a URL or session var
      @string = (params['string'] or session['string'])
      return true
    end

    #We now know that string is not set
    redirect_to string_setting_url and return false #the return false prevents any futher processing in this request
  end
end 
```

这是诸如 RestfulAuthentication 之类的插件如何工作的基本思想。在那种情况下，“字符串”是一个登录令牌（我认为是用户 ID），存储在会话中。

如果你看一下`login_required' action in`来自 ResultfulAuth 的 authenticated_system.rb`：它基本上就是这样做的，虽然它有更多的错误更正，但添加了其他内容

# .net - 如何在将字体与 .NET 一起使用之前确保字体存在

> ID：106712
> 
> 赞同：2
> 
> 时间：2008-09-20T01:33:28.583
> 
> 标签：.net, vb.net, winforms, fonts

我有一个 VB.NET Windows 窗体项目，它在运行时将文本直接绘制到窗体上。不过，在我用字体绘画之前，我想确保字体和字体大小存在于用户的机器上。如果他们不这样做，我会尝试其他一些类似的字体，最终默认使用 Arial 或其他字体。

在用户计算机上测试和验证字体的最佳方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T01:39:34.187

从题为“如何：枚举已安装字体”的 MSDN 文章中，我找到了以下代码：

```
 InstalledFontCollection installedFontCollection = new InstalledFontCollection();

// Get the array of FontFamily objects.
FontFamily[] fontFamilies = installedFontCollection.Families; 

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T01:40:56.367

这是一个解决方案，在 c# 中：

```
public partial class Form1 : Form
{
    public Form1()
    {
        SetFontFinal();
        InitializeComponent();
    }

    /// <summary>
    /// This method attempts to set the font in the form to Cambria, which
    /// will only work in some scenarios. If Cambria is not available, it will
    /// fall back to Times New Roman, so the font is good on almost all systems.
    /// </summary>
    private void SetFontFinal()
    {
        string fontName = "Cambria";
        Font testFont = new Font(fontName, 16.0f, FontStyle.Regular,
            GraphicsUnit.Pixel);

        if (testFont.Name == fontName)
        {
            // The font exists, so use it.
            this.Font = testFont;
        }
        else
        {
            // The font we tested doesn't exist, so fallback to Times.
            this.Font = new Font("Times New Roman", 16.0f,
                FontStyle.Regular, GraphicsUnit.Pixel);
        }
    }
} 
```

这是VB中的一种方法：

```
Public Function FontExists(FontName As String) As Boolean

    Dim oFont As New StdFont
    Dim bAns As Boolean

    oFont.Name = FontName
    bAns = StrComp(FontName, oFont.Name, vbTextCompare) = 0
    FontExists = bAns

End Function 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T14:37:33.730

另请参阅导致此代码的[相同问题：](https://stackoverflow.com/questions/113989/test-if-a-font-is-installed)

```
 private bool IsFontInstalled(string fontName) {
        using (var testFont = new Font(fontName, 8)) {
            return 0 == string.Compare(
              fontName,
              testFont.Name,
              StringComparison.InvariantCultureIgnoreCase);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-05T23:19:22.987

Arial Bold Italic 不太可能是一种字体。它是 Arial 家族的一个子类。

尽量保持简单并测试“Arial”。

# actionscript-3 - 有人有 Actionscript 3 Youtube API / 包装器吗？

> ID：106721
> 
> 赞同：3
> 
> 时间：2008-09-20T01:37:49.883
> 
> 标签：actionscript-3, youtube, youtube-api

Google / Youtube 有一个用于 Youtube 的 API，用于 javascript 和 Actionscript 2。

不幸的是，这个 API 与没有包装器的 Actionscript 3 不兼容——谷歌自己不提供包装器。

有没有人可以提供一个 actionscript 3 包装器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T01:41:47.223

[as3youtubelib](http://code.google.com/p/as3youtubelib/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-27T07:32:52.657

as3youtubelib 仅适用于 API 本身 - 用于搜索视频等。

我想要一个 youtube 视频播放器本身的包装器。

[http://code.google.com/p/youtubechromelesswrapper-as3/](http://code.google.com/p/youtubechromelesswrapper-as3/)是一个新的 API，它允许您嵌入 Flash/Flex 并使用 Javascript API（通过 ExternalInterface）来控制 Flash 中的电影。它没有任何控制按钮，但有 YouTube 标志。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-13T09:45:02.117

最后！YouTube 的官方 API 从 AS2 更改为 AS3

> [http://code.google.com/apis/youtube/flash_api_reference.html](http://code.google.com/apis/youtube/flash_api_reference.html)
> 
> 注意：本文档于 2009 年 10 月更新，以解释如何使用 AS3 而不是 ActionScript 2.0 (AS2)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-24T11:46:28.277

或者这个：[http ://code.google.com/apis/youtube/articles/tubeloc.html](http://code.google.com/apis/youtube/articles/tubeloc.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-30T09:51:13.890

或者您可以使用这个没有音量问题和多实例问题的包装器，就像 YouTube 上的包装器一样：[http ://www.ovidiudiac.ro/blog/?p=70](http://www.ovidiudiac.ro/blog/?p=70)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-24T11:40:46.463

试试这个： [http ://code.google.com/apis/youtube/flash_api_reference.html](http://code.google.com/apis/youtube/flash_api_reference.html)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-06-03T07:05:13.217

是的，这里有一个 AS3 包装器 [http://flashden.net/item/as3-youtube-wrapper-full-xml-site/21685](http://flashden.net/item/as3-youtube-wrapper-full-xml-site/21685)

# python - 如何捆绑包含依赖项的 Python 应用程序？

> ID：106725
> 
> 赞同：61
> 
> 时间：2008-09-20T01:39:48.960
> 
> 标签：python, tkinter, packaging

我需要将我的 Python 应用程序、它的依赖项和 Python 打包到一个 MSI 安装程序中。最终结果最好是：

*   Python 安装在标准位置
*   包及其依赖项安装在单独的目录中（可能是站点包）
*   安装目录应包含未压缩的 Python，并且不需要独立的可执行文件

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-20T01:41:20.000

[关于如何将 python 变成可执行文件](https://stackoverflow.com/questions/2933/an-executable-python-app)的这个问题的一种重复。

它归结为：

Windows上的[py2exe](http://www.py2exe.org/) 、 Linux 上的[Freeze和 Mac 上的](http://wiki.python.org/moin/Freeze)[py2app](http://svn.pythonmac.org/py2app/py2app/trunk/doc/index.html)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-20T01:52:20.800

我使用[PyInstaller](http://www.pyinstaller.org/)（svn 版本）来创建我的程序的独立版本，其中包括 Python 和所有依赖项。让它正常工作并包含所有东西需要一点点摆弄（py2exe和其他类似程序也是如此，请参阅[this question](https://stackoverflow.com/questions/2933/an-executable-python-app)），但它工作得很好。

然后，您需要创建一个安装程序。[NSIS](http://nsis.sourceforge.net/Main_Page)非常适用，而且是免费的，但它创建的是 .exe 文件而不是 .msi。如果不需要 .msi，我强烈推荐它。否则，请查看[此](http://web.archive.org/web/20140806170949/http://stackoverflow.com/questions/3767/what-is-the-best-choice-for-building-windows-installers)问题的答案以获取其他选项。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-22T12:58:57.217

我的公司使用免费的 InnoSetup 工具。这是一个中等复杂的程序，对于构建 Windows 安装程序具有很大的灵活性。但是，我相信它会创建 .exe 而不是 .msi 文件。InnoSetup 不是特定于 python 的，但我们已经为我们的一个产品创建了一个安装程序，该安装程序将 python 连同依赖项安装到用户在安装时指定的位置。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-09-11T07:28:07.903

我在使用[pyinstaller](http://www.pyinstaller.org/)的依赖项和自定义文件夹结构方面获得了更好的结果，它可以让您找到并指定隐藏的导入和挂钩，以获取更大的依赖项，如 numpy 和 scipy。不过，还有一个 PITA。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T01:41:47.660

[py2exe](http://wiki.python.org/moin/Py2Exe)将生成带有 python 的 windows 可执行文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T01:41:36.770

py2exe 是最好的方法。使用起来有点像 PITA，但最终效果非常好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-03-17T22:56:41.583

好的，我以前使用过 py2exe，它运行良好，除了一件事......它只适用于可执行的 Windows 机器。然后我了解了 Jython，它将 python 脚本转换为 .Jar 文件。如您所知，它可以从任何安装了 Java（“到您的最新运行版本”）的机器上执行。这很棒，因为 unix、windows 和 ios（大多数时候）都运行 java。这意味着它可以从以下所有机器执行。只要他们运行Java。无需“py2mac + py2exe + freeze”即可在所有操作系统上运行。只是 Jython

有关它如何工作以及如何使用它的更多信息，请单击此处。
[http://www.jython.org/](http://www.jython.org/)

# network-protocols - 以编程方式确定 Web 域是否可用的最有效方法？

> ID：106734
> 
> 赞同：11
> 
> 时间：2008-09-20T01:42:10.623
> 
> 标签：network-protocols, whois, nslookup

我正在编写一些代码来确定是否注册了网络域。例如，我想检查“Google123.com”是否可用。至少有两种方法可以以编程方式执行此操作，但我不确定哪种方法更有效：

*   A) 在 linux/cygwin 中，我可以启动 whois 命令来查看域是否正在使用中。
*   B) 在 linux/windows 中，我可以启动 nslookup 命令来查看域是否可解析。

我的问题是：

1.  nslookup 真的是检查注册的有效方法吗？每个注册的域是否都有一个名称服务器并显示在 DNS 中？
2.  进行此注册检查的最快方法是什么？有什么提示或其他方法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-20T01:44:51.210

关于#1，没有。没有要求注册的域实际上具有 DNS。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T01:49:49.543

nslookup 会访问您系统设置中的 dns 服务器。它可能落后于时代，也可能没有任何 dns 条目。我认为最好的方法是与 whois.internic.net 端口 43（whois 端口）建立 tcp 连接，传递您要检查的名称，然后您应该得到一个让您知道的响应。如果它不存在，您将收到类似**No match for "domainyourchecking.com"的响应**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T01:57:35.670

有传言说，一些允许您搜索域名的网站实际上是域名投机者的前线，他们会在您搜索域名后立即购买，然后尝试将其出售给您。我从未遇到过这样的骗局，但您可能想在搜索您梦寐以求的域名之前在新站点上尝试一些垃圾域搜索。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T20:03:36.657

whois 的问题在于不同的顶级域名没有一致的响应。

因此，如果您只是在寻找 .com 或其他一些特定的顶级域名，那就没问题了。如果您开始查看各种 ccTld 或其他 gTld，您可能会在逻辑中发现很多特殊的大小写，试图找出 whois 命令返回的数据中“可用”的含义。

Whois 总是向 shell 返回成功，即使域可用。:(

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-20T01:44:10.507

这会给你一个快速的是/否，但如果你认为它是免费的，并且你想要它，尝试注册它，你可能会发现它已经被占用了。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-20T01:49:15.270

system("whois $域名");

# c# - 我希望我的 C# Windows 服务自动更新

> ID：106765
> 
> 赞同：32
> 
> 时间：2008-09-20T01:55:28.610
> 
> 标签：c#, windows-services, upgrade

是否有可用于使 C# Windows 服务自动检查更新版本并自行升级的框架？我当然可以编写代码来实现这一点，但我正在寻找一个已经实现并且（最重要的是）经过测试的框架。

[编辑] 这是一个类似问题的链接，其中包含有助于实现此目的的现代项目的链接：[Auto-update library for .NET?](https://stackoverflow.com/questions/691663/auto-update-library-for-net)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-20T02:18:44.137

卸载类型的唯一方法是销毁 appdomain。要做到这一点，需要将您的托管层与执行的服务代码分开——这非常复杂。（有点像做锁孔手术）

可能更容易 a) 运行批处理任务或 b) 在服务中检测更新，然后启动一个单独的进程来停止服务、更新程序集等，然后重新启动它。

如果您对前者感兴趣，MSDN 模式和实践人员编写了一个应用程序更新程序块，您可以根据自己的服务进行调整。

[https://web.archive.org/web/20080506103749/http://msdn.microsoft.com/en-us/library/ms978574.aspx](https://web.archive.org/web/20080506103749/http://msdn.microsoft.com/en-us/library/ms978574.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2021-03-10T13:07:22.390

I've had good experiences with [Google Omaha](https://github.com/google/omaha) for updating Windows Services. It can generally be used to update any Windows application but there is a [tutorial](https://omaha-consulting.com/update-windows-service) for using it to update a Windows Service.

In comparison to other update frameworks, Omaha is more complex, but also the most powerful. This is because Google (and now also Microsoft) use it to update their browsers on billions of PCs. However, once it's set up and you understand the basics, it is a very nice experience.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T02:08:05.443

我不知道任何有助于解决此特定问题的框架。

您可以尝试将服务的业务逻辑与实际服务代码分离到不同的程序集中。让服务程序集定期检查业务逻辑程序集的更新，如有必要，从远程源复制它，卸载旧的 BL 程序集（也可能删除），然后动态加载新版本（卸载旧程序集不是一项微不足道的任务）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T02:27:15.850

另一种可能的解决方案是让一个单独的服务运行，如果有更新，则停止另一个服务，然后更新该服务。您无法自行更新服务，因为正在运行的 .dll 不会停止。

分离业务逻辑层将是一个不错的选择。您还可以重写主服务以在主服务或控制服务的反射下运行。这类似于分离业务逻辑，只需要停止一个线程并重新启动它。

我知道没有已知的框架可以做到这一点。我自己做了这个，但这不是一个公共框架。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-10-01T15:13:49.147

我一直在使用 WyBuild 来更新我的应用程序（包括 Windows 服务），它非常棒。非常易于使用，并且非常易于与现有应用程序集成。这是一个非常棒的自动更新框架......

[http://wyday.com/wybuild/help/automatic-updates/windows-services-console-apps.php](http://wyday.com/wybuild/help/automatic-updates/windows-services-console-apps.php) [http://wyday.com/wybuild/help/silent-update-windows-service.php](http://wyday.com/wybuild/help/silent-update-windows-service.php)

*请注意，它是一个付费框架（许可证是每个开发人员的，包括免费试用）*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-18T18:11:58.930

万一其他人正在寻找这个；我发现这个链接很有趣。我还没有实现这个解决方案，但它看起来可能对我有用

[http://www.eggheadcafe.com/articles/20041204.asp](http://www.eggheadcafe.com/articles/20041204.asp)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-11-10T08:02:09.203

You can use [NetSparke](https://github.com/NetSparkleUpdater/NetSparkle), it supports .NET Core 3+ (.NET 5+) and .NET Framework 4.5.2+. It comes with built-in UI or without any UI at all. You can handle all the events by yourself. It works with an appcast.xml (and also have a utility to generate that), is platform independent and just works out of the box.

Just work trough the documentation on their repository and check the example app ;-)

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-09-20T02:02:33.180

你能澄清一下你的问题吗？我有点困惑，因为据我所知，您总是可以覆盖服务使用的 DLL。服务的复制和重新启动可以很容易地成为您构建过程的一部分。

# python - 单元测试文件修改

> ID：106766
> 
> 赞同：23
> 
> 时间：2008-09-20T01:56:25.550
> 
> 标签：python, linux, unit-testing

我最近一直在处理的程序中的一项常见任务是以某种方式修改文本文件。（嘿，我在 Linux 上。一切都是文件。我做的是大型系统管理员。）

但是代码修改的文件可能不存在于我的桌面盒子上。如果它在我的桌面上，我可能不想修改它。

我已经阅读了 Dive Into Python 中的单元测试，并且很清楚在测试将十进制转换为罗马数字的应用程序时我想要做什么（DintoP 中的示例）。测试非常独立。您不需要验证程序是否打印了正确的东西，您只需要验证函数是否将正确的输出返回到给定的输入。

然而，在我的例子中，我们需要测试程序是否正确地修改了它的环境。这是我想出的：

1) 在标准位置创建“原始”文件，可能是 /tmp。

2) 运行修改文件的函数，将路径传递给 /tmp 中的文件。

3) 验证/tmp 中的文件是否被正确修改；相应地通过/失败单元测试。

这对我来说似乎很笨拙。（如果您想验证文件的备份副本是否已正确创建等，则更加麻烦。）有没有人想出更好的方法？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-21T15:16:34.853

你说的是一次测试太多。如果您开始尝试通过说“让我们验证它是否正确修改了环境”来解决测试问题，那么您注定要失败。环境有数十种甚至数百万种潜在的变化。

相反，请查看程序的各个部分（“单元”）。例如，您是否将有一个函数来确定必须写入的文件的位置？该功能的输入是什么？也许是一个环境变量，也许是从配置文件中读取的一些值？测试那个函数，实际上不要做任何修改文件系统的事情。不要传递“现实”值，传递易于验证的值。创建一个临时目录，用测试方法中的文件填充它`setUp`。

然后测试写入文件的代码。只要确保它正在写入正确的内容文件内容。甚至不要写入真实的文件系统！您不需要为此制作“假”文件对象，只需使用 Python 方便的`StringIO`模块即可；它们是“文件”接口的“真实”实现，它们不是您的程序实际要写入的那些。

最终，您将不得不测试最终的，一切都是实际挂钩的真实顶级函数，该函数传递真实的环境变量和真实的配置文件并将所有内容放在一起。但是不要担心开始。一方面，当您为较小的函数编写单独的测试时，您将开始学习技巧，创建测试模拟、伪造和存根将成为您的第二天性。另一方面：即使你不能完全弄清楚如何测试一个函数调用，你也会非常有信心它调用的所有东西都能完美运行。此外，您会注意到测试驱动开发迫使您使 API 更清晰、更灵活。例如：测试调用`open()`对来自某个抽象的对象的方法，而不是测试调用`os.open`您传递的字符串的东西。`open`方法灵活；它可以被伪造，它可以以不同的方式实现，但是字符串就是字符串，`os.open`并且不会给您任何余地来捕捉对其调用的方法。

您还可以构建测试工具来简化重复性任务。例如，twisted 提供了用于创建临时文件以进行测试的工具，这些文件[直接内置在其测试工具](http://twistedmatrix.com/documents/8.1.0/api/twisted.trial.unittest.TestCase.html#mktemp)中。测试工具或具有自己的测试库的大型项目具有这样的功能并不少见。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T02:05:23.873

您有两个级别的测试。

1.  过滤和修改内容。这些是不需要物理文件 I/O 的“低级”操作。这些是测试、决策、替代方案等。应用程序的“逻辑”。

2.  文件系统操作。创建、复制、重命名、删除、备份。抱歉，这些是正确的文件系统操作——嗯——需要正确的文件系统进行测试。

对于这种测试，我们经常使用“Mock”对象。您可以设计一个体现各种文件系统操作的“FileSystemOperations”类。您对此进行测试以确保它执行基本的读取、写入、复制、重命名等操作。这没有真正的逻辑。只是调用文件系统操作的方法。

然后，您可以创建一个模拟各种操作的 MockFileSystem。您可以使用此 Mock 对象来测试您的其他类。

在某些情况下，您所有的文件系统操作都在 os 模块中。如果是这种情况，您可以使用您实际使用的操作的模拟版本创建一个 MockOS 模块。

把你的 MockOS 模块放在上面`PYTHONPATH`，你就可以隐藏真正的 OS 模块。

对于生产操作，您可以使用经过充分测试的“逻辑”类以及 FileSystemOperations 类（或真正的 OS 模块。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-08T10:45:40.507

对于以后只想测试写入文件的代码是否正常工作的读者，这里有一个“fake_open”，它修补了模块的 open 内置以使用 StringIO。fake_open 返回一个打开文件的字典，可以在单元测试或文档测试中检查，所有这些都不需要真正的文件系统。

```
def fake_open(module):
    """Patch module's `open` builtin so that it returns StringIOs instead of
    creating real files, which is useful for testing. Returns a dict that maps
    opened file names to StringIO objects."""
    from contextlib import closing
    from StringIO import StringIO
    streams = {}
    def fakeopen(filename,mode):
        stream = StringIO()
        stream.close = lambda: None
        streams[filename] = stream
        return closing(stream)
    module.open = fakeopen
    return streams 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T02:01:20.920

当我在代码中触摸文件时，我倾向于模拟文件的实际读写......所以我可以在测试中给我的类提供我想要的确切内容，然后断言测试正在写回我期待的内容。

我已经在 J​​ava 中完成了这项工作，我想这在 Python 中非常简单......但它可能需要以这样一种方式设计你的类/函数，以便轻松模拟实际文件的使用。

为此，您可以尝试传入流，然后只传入一个不会写入文件的简单字符串输入/输出流，或者具有执行实际“将此字符串写入文件”或“读取此文件”的函数文件中的字符串”，然后在测试中替换该函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T02:04:47.323

我认为你在正确的轨道上。根据您需要做的事情，[chroot](http://en.wikipedia.org/wiki/Chroot)可能会帮助您为您的脚本设置一个“看起来”真实但实际上并非如此的环境。

如果这不起作用，那么您可以编写脚本以将“根”路径作为参数。

在生产运行中，根路径只是 /。为了进行测试，您可以在 /tmp/test 下创建一个影子环境，然后使用 /tmp/test 的根路径运行脚本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T02:06:19.473

您可能希望设置测试，使其在 chroot 监狱中运行，这样您就拥有了测试所需的所有环境，即使路径和文件位置在代码中是硬编码的 [这不是一个很好的做法，但有时可以获取文件来自其他地方的位置...]，然后通过退出代码检查结果。

# java - 用Java复制文件的标准简洁方法？

> ID：106770
> 
> 赞同：426
> 
> 时间：2008-09-20T01:59:09.457
> 
> 标签：java, file, copy

一直困扰着我的是，在 Java 中复制文件的唯一方法是打开流、声明缓冲区、读入一个文件、循环通过它，然后将其写入另一个流。网络上充斥着类似但仍然略有不同的此类解决方案的实现。

有没有更好的方法可以保持在 Java 语言的范围内（意味着不涉及执行操作系统特定的命令）？也许在一些可靠的开源实用程序包中，这至少会掩盖这个底层实现并提供一个单一的解决方案？

* * *

## 回答 #1

> 赞同：279
> 
> 时间：2008-09-22T14:17:26.827

我会避免使用像 apache commons 这样的大型 api。这是一个简单的操作，它内置在新 NIO 包中的 JDK 中。在之前的答案中已经链接到它，但是 NIO api 中的关键方法是新函数“transferTo”和“transferFrom”。

[http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html#transferTo(long,%20long,%20java.nio.channels.WritableByteChannel)](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html#transferTo(long,%20long,%20java.nio.channels.WritableByteChannel))

其中一篇链接的文章展示了如何使用 transferFrom 将此功能集成到您的代码中的好方法：

```
public static void copyFile(File sourceFile, File destFile) throws IOException {
    if(!destFile.exists()) {
        destFile.createNewFile();
    }

    FileChannel source = null;
    FileChannel destination = null;

    try {
        source = new FileInputStream(sourceFile).getChannel();
        destination = new FileOutputStream(destFile).getChannel();
        destination.transferFrom(source, 0, source.size());
    }
    finally {
        if(source != null) {
            source.close();
        }
        if(destination != null) {
            destination.close();
        }
    }
} 
```

学习 NIO 可能有点棘手，所以你可能只想相信这个机制，然后再去尝试一夜之间学习 NIO。从个人经验来看，如果您没有经验并且通过 java.io 流被介绍给 IO，这可能是一件非常困难的事情。

* * *

## 回答 #2

> 赞同：276
> 
> 时间：2008-09-20T02:23:46.233

正如上面提到的工具包，Apache Commons IO 是要走的路，特别是[FileUtils](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/FileUtils.html)。[复制文件（）](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/FileUtils.html#copyFile(java.io.File,%20java.io.File))；它为您处理所有繁重的工作。

作为后记，请注意最近的 FileUtils 版本（例如 2.0.1 版本）添加了使用 NIO 来复制文件；[NIO 可以显着提高文件复制性能](http://www.javalobby.org/java/forums/t17036.html)，这在很大程度上是因为 NIO 例程将复制直接推迟到 OS/文件系统，而不是通过 Java 层读取和写入字节来处理它。因此，如果您正在寻找性能，可能值得检查您使用的是最新版本的 FileUtils。

* * *

## 回答 #3

> 赞同：182
> 
> 时间：2011-07-28T18:22:35.277

现在使用 Java 7，您可以使用以下 try-with-resource 语法：

```
public static void copyFile( File from, File to ) throws IOException {

    if ( !to.exists() ) { to.createNewFile(); }

    try (
        FileChannel in = new FileInputStream( from ).getChannel();
        FileChannel out = new FileOutputStream( to ).getChannel() ) {

        out.transferFrom( in, 0, in.size() );
    }
} 
```

或者，更好的是，这也可以使用 Java 7 中引入的新 Files 类来完成：

```
public static void copyFile( File from, File to ) throws IOException {
    Files.copy( from.toPath(), to.toPath() );
} 
```

很时髦，嗯？

* * *

## 回答 #4

> 赞同：92
> 
> 时间：2013-05-17T03:09:21.707

*   这些方法是针对性能设计的（它们与操作系统本机 I/O 集成）。
*   这些方法适用于文件、目录和链接。
*   提供的每个选项都可以省略 - 它们是可选的。

### 实用程序类

```
package com.yourcompany.nio;

class Files {

    static int copyRecursive(Path source, Path target, boolean prompt, CopyOptions options...) {
        CopyVisitor copyVisitor = new CopyVisitor(source, target, options).copy();
        EnumSet<FileVisitOption> fileVisitOpts;
        if (Arrays.toList(options).contains(java.nio.file.LinkOption.NOFOLLOW_LINKS) {
            fileVisitOpts = EnumSet.noneOf(FileVisitOption.class) 
        } else {
            fileVisitOpts = EnumSet.of(FileVisitOption.FOLLOW_LINKS);
        }
        Files.walkFileTree(source[i], fileVisitOpts, Integer.MAX_VALUE, copyVisitor);
    }

    private class CopyVisitor implements FileVisitor<Path>  {
        final Path source;
        final Path target;
        final CopyOptions[] options;

        CopyVisitor(Path source, Path target, CopyOptions options...) {
             this.source = source;  this.target = target;  this.options = options;
        };

        @Override
        FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) {
        // before visiting entries in a directory we copy the directory
        // (okay if directory already exists).
        Path newdir = target.resolve(source.relativize(dir));
        try {
            Files.copy(dir, newdir, options);
        } catch (FileAlreadyExistsException x) {
            // ignore
        } catch (IOException x) {
            System.err.format("Unable to create: %s: %s%n", newdir, x);
            return SKIP_SUBTREE;
        }
        return CONTINUE;
    }

    @Override
    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {
        Path newfile= target.resolve(source.relativize(file));
        try {
            Files.copy(file, newfile, options);
        } catch (IOException x) {
            System.err.format("Unable to copy: %s: %s%n", source, x);
        }
        return CONTINUE;
    }

    @Override
    public FileVisitResult postVisitDirectory(Path dir, IOException exc) {
        // fix up modification time of directory when done
        if (exc == null && Arrays.toList(options).contains(COPY_ATTRIBUTES)) {
            Path newdir = target.resolve(source.relativize(dir));
            try {
                FileTime time = Files.getLastModifiedTime(dir);
                Files.setLastModifiedTime(newdir, time);
            } catch (IOException x) {
                System.err.format("Unable to copy all attributes to: %s: %s%n", newdir, x);
            }
        }
        return CONTINUE;
    }

    @Override
    public FileVisitResult visitFileFailed(Path file, IOException exc) {
        if (exc instanceof FileSystemLoopException) {
            System.err.println("cycle detected: " + file);
        } else {
            System.err.format("Unable to copy: %s: %s%n", file, exc);
        }
        return CONTINUE;
    }
} 
```

### 复制目录或文件

```
long bytes = java.nio.file.Files.copy( 
                 new java.io.File("<filepath1>").toPath(), 
                 new java.io.File("<filepath2>").toPath(),
                 java.nio.file.StandardCopyOption.REPLACE_EXISTING,
                 java.nio.file.StandardCopyOption.COPY_ATTRIBUTES,
                 java.nio.file.LinkOption.NOFOLLOW_LINKS); 
```

### 移动目录或文件

```
long bytes = java.nio.file.Files.move( 
                 new java.io.File("<filepath1>").toPath(), 
                 new java.io.File("<filepath2>").toPath(),
                 java.nio.file.StandardCopyOption.ATOMIC_MOVE,
                 java.nio.file.StandardCopyOption.REPLACE_EXISTING); 
```

### 递归复制目录或文件

```
long bytes = com.yourcompany.nio.Files.copyRecursive( 
                 new java.io.File("<filepath1>").toPath(), 
                 new java.io.File("<filepath2>").toPath(),
                 java.nio.file.StandardCopyOption.REPLACE_EXISTING,
                 java.nio.file.StandardCopyOption.COPY_ATTRIBUTES
                 java.nio.file.LinkOption.NOFOLLOW_LINKS ); 
```

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2014-06-20T18:38:26.580

在 Java 7 中，这很容易......

```
File src = new File("original.txt");
File target = new File("copy.txt");

Files.copy(src.toPath(), target.toPath(), StandardCopyOption.REPLACE_EXISTING); 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2013-10-23T13:08:53.413

要复制文件并将其保存到目标路径，您可以使用以下方法。

```
public void copy(File src, File dst) throws IOException {
    InputStream in = new FileInputStream(src);
    try {
        OutputStream out = new FileOutputStream(dst);
        try {
            // Transfer bytes from in to out
            byte[] buf = new byte[1024];
            int len;
            while ((len = in.read(buf)) > 0) {
                out.write(buf, 0, len);
            }
        } finally {
            out.close();
        }
    } finally {
        in.close();
    }
} 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2008-09-23T03:38:29.490

请注意，所有这些机制都只复制文件的内容，而不是权限等元数据。因此，如果您要在 linux 上复制或移动可执行的 .sh 文件，则新文件将无法执行。

为了真正复制或移动文件，即获得与从命令行复制相同的结果，您实际上需要使用本机工具。shell 脚本或 JNI。

显然，这可能在 java 7 - [http://today.java.net/pub/a/today/2008/07/03/jsr-203-new-file-apis.html](http://today.java.net/pub/a/today/2008/07/03/jsr-203-new-file-apis.html)中得到修复。手指交叉！

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2010-07-05T16:17:19.010

Google 的 Guava 库也有一个[复制方法](http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/io/Files.html#copy-java.io.File-java.io.File-)：

```
公共静态无效副本（文件 来自，
                        文件 到）
                 抛出IOException
```

将所有字节从一个文件复制到另一个文件。

**警告：**如果`to`表示现有文件，该文件将被`from`. 如果`to`和 `from`引用*同一个*文件，该文件的内容将被删除。

**参数：**`from` - 源文件`to`- 目标文件

**抛出：** `[IOException](http://download.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true "class or interface in java.io")` - 如果发生 I/O 错误 `[IllegalArgumentException](http://download.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true "class or interface in java.lang")`- 如果`from.equals(to)`

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2010-06-01T08:33:44.303

在 Java 7 中作为标准提供，path.copyTo： [http ://openjdk.java.net/projects/nio/javadoc/java/nio/file/Path.html](http://openjdk.java.net/projects/nio/javadoc/java/nio/file/Path.html) [http://java.sun.com/docs/books/教程/基本/io/copy.html](http://java.sun.com/docs/books/tutorial/essential/io/copy.html)

我不敢相信他们花了这么长时间来标准化像文件复制这样常见和简单的东西:(

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2012-04-13T09:36:31.757

上述代码可能存在的三个问题：

1.  如果 getChannel 抛出异常，您可能会泄漏一个打开的流。
2.  对于大文件，您可能会尝试一次传输超过操作系统处理能力的文件。
3.  您忽略了 transferFrom 的返回值，因此它可能只是复制文件的一部分。

这就是为什么`org.apache.tools.ant.util.ResourceUtils.copyResource`如此复杂。另请注意，虽然 transferFrom 可以，但在 Linux 上的 JDK 1.4 上 transferTo 会中断（请参阅[错误 ID：5056395](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5056395)） – Jesse Glick Jan

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2012-09-07T06:43:50.053

如果您在一个已经使用 Spring 的 Web 应用程序中，并且不想包含 Apache Commons IO 来进行简单的文件复制，则可以使用Spring 框架的[FileCopyUtils](http://static.springsource.org/spring/docs/1.2.x/api/org/springframework/util/FileCopyUtils.html)。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-01-16T01:25:45.143

```
public static void copyFile(File src, File dst) throws IOException
{
    long p = 0, dp, size;
    FileChannel in = null, out = null;

    try
    {
        if (!dst.exists()) dst.createNewFile();

        in = new FileInputStream(src).getChannel();
        out = new FileOutputStream(dst).getChannel();
        size = in.size();

        while ((dp = out.transferFrom(in, p, size)) > 0)
        {
            p += dp;
        }
    }
    finally {
        try
        {
            if (out != null) out.close();
        }
        finally {
            if (in != null) in.close();
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-11-13T11:57:18.453

这里有三种方法可以轻松地用单行代码复制文件！

**Java7**：

[java.nio.file.Files#copy](https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#copy(java.nio.file.Path,%20java.nio.file.Path,%20java.nio.file.CopyOption...))

```
private static void copyFileUsingJava7Files(File source, File dest) throws IOException {
    Files.copy(source.toPath(), dest.toPath());
} 
```

**阿帕奇公共 IO**：

[FileUtils#copyFile](http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html#copyFile(java.io.File,%20java.io.File))

```
private static void copyFileUsingApacheCommonsIO(File source, File dest) throws IOException {
    FileUtils.copyFile(source, dest);
} 
```

**番石榴**：

[文件#copy](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/io/Files.html#copy(java.io.File,%20java.io.File))

```
private static void copyFileUsingGuava(File source,File dest) throws IOException{
    Files.copy(source,dest);          
} 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2015-02-07T22:51:23.497

根据我的测试，带有缓冲区的 NIO 副本是最快的。从我的测试项目中查看下面的工作代码[https://github.com/mhisoft/fastcopy](https://github.com/mhisoft/fastcopy)

```
import java.io.Closeable;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.nio.ByteBuffer;
import java.nio.channels.FileChannel;
import java.text.DecimalFormat;

public class test {

private static final int BUFFER = 4096*16;
static final DecimalFormat df = new DecimalFormat("#,###.##");
public static void nioBufferCopy(final File source, final File target )  {
    FileChannel in = null;
    FileChannel out = null;
    double  size=0;
    long overallT1 =  System.currentTimeMillis();

    try {
        in = new FileInputStream(source).getChannel();
        out = new FileOutputStream(target).getChannel();
        size = in.size();
        double size2InKB = size / 1024 ;
        ByteBuffer buffer = ByteBuffer.allocateDirect(BUFFER);

        while (in.read(buffer) != -1) {
            buffer.flip();

            while(buffer.hasRemaining()){
                out.write(buffer);
            }

            buffer.clear();
        }
        long overallT2 =  System.currentTimeMillis();
        System.out.println(String.format("Copied %s KB in %s millisecs", df.format(size2InKB),  (overallT2 - overallT1)));
    }
    catch (IOException e) {
        e.printStackTrace();
    }

    finally {
        close(in);
        close(out);
    }
}

private static void close(Closeable closable)  {
    if (closable != null) {
        try {
            closable.close();
        } catch (IOException e) {
            if (FastCopy.debug)
                e.printStackTrace();
        }    
    }
} 
```

}

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-11-14T09:43:21.147

快速并适用于所有版本的 Java 和 Android：

```
private void copy(final File f1, final File f2) throws IOException {
    f2.createNewFile();

    final RandomAccessFile file1 = new RandomAccessFile(f1, "r");
    final RandomAccessFile file2 = new RandomAccessFile(f2, "rw");

    file2.getChannel().write(file1.getChannel().map(FileChannel.MapMode.READ_ONLY, 0, f1.length()));

    file1.close();
    file2.close();
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-05-30T10:50:52.433

聚会有点晚了，但这里是使用各种文件复制方法复制文件所用时间的比较。我循环使用这些方法 10 次并取平均值。使用 IO 流进行文件传输似乎是最差的选择：

[![使用各种方法的文件传输比较](https://i.stack.imgur.com/yM0GV.png)](https://i.stack.imgur.com/yM0GV.png)

以下是方法：

```
private static long fileCopyUsingFileStreams(File fileToCopy, File newFile) throws IOException {
    FileInputStream input = new FileInputStream(fileToCopy);
    FileOutputStream output = new FileOutputStream(newFile);
    byte[] buf = new byte[1024];
    int bytesRead;
    long start = System.currentTimeMillis();
    while ((bytesRead = input.read(buf)) > 0)
    {
        output.write(buf, 0, bytesRead);
    }
    long end = System.currentTimeMillis();

    input.close();
    output.close();

    return (end-start);
}

private static long fileCopyUsingNIOChannelClass(File fileToCopy, File newFile) throws IOException
{
    FileInputStream inputStream = new FileInputStream(fileToCopy);
    FileChannel inChannel = inputStream.getChannel();

    FileOutputStream outputStream = new FileOutputStream(newFile);
    FileChannel outChannel = outputStream.getChannel();

    long start = System.currentTimeMillis();
    inChannel.transferTo(0, fileToCopy.length(), outChannel);
    long end = System.currentTimeMillis();

    inputStream.close();
    outputStream.close();

    return (end-start);
}

private static long fileCopyUsingApacheCommons(File fileToCopy, File newFile) throws IOException
{
    long start = System.currentTimeMillis();
    FileUtils.copyFile(fileToCopy, newFile);
    long end = System.currentTimeMillis();
    return (end-start);
}

private static long fileCopyUsingNIOFilesClass(File fileToCopy, File newFile) throws IOException
{
    Path source = Paths.get(fileToCopy.getPath());
    Path destination = Paths.get(newFile.getPath());
    long start = System.currentTimeMillis();
    Files.copy(source, destination, StandardCopyOption.REPLACE_EXISTING);
    long end = System.currentTimeMillis();

    return (end-start);
} 
```

我在使用 NIO 通道类时看到的唯一缺点是我似乎仍然找不到显示中间文件复制进度的方法。

# .net - 您使用什么来保护您的 .NET 代码免受逆向工程的影响？

> ID：106794
> 
> 赞同：14
> 
> 时间：2008-09-20T02:15:07.283
> 
> 标签：.net, obfuscation, reflector

有一段时间，我们使用了一个名为 CodeVeil 的工具。我只是想知道是否有更好的选择。

编辑：在更多人误解这个问题之前，我知道一个坚定的破解者可能能够击败任何这些工具。不过我并不太关心他们。这些工具只是为了阻止“休闲破解者”，阻止人们窃取我们公司的 IP。如果他们足够优秀，可以通过一个像样的工具，他们可能对窃取我们的蹩脚代码不感兴趣:-P

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T03:15:24.190

我在 Xenocode Postbuild 方面取得了很大的成功。该工具可以混淆 .NET 程序集，防止 Reflector 反汇编，将 .NET 程序集组合成单个可执行文件（“虚拟化”），甚至可以将 .NET 应用程序编译为不需要安装 .NET 运行时的独立可执行文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-20T02:22:25.597

我仍然不相信这些工具的价值。没有任何技术解决方案能比许可证、商标、专利、版权等法律保护更好地防止逆向工程......

.NET 确实是大型透明源代码运动。相反，您最好围绕您的 IP 制定使用条款，例如许可和版权。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T02:50:09.023

编译 .NET 应用程序会生成包含大量元信息的输出程序集。这些信息使得重构非常接近原始代码的东西变得非常容易。一个名为 .NET Reflector 的优秀免费工具可用于完成此任务，并且是检查基类库如何工作的流行方法。下载并使用该工具查看重构的 C#/VB.NET 版本的程序集内容。

如果您是一个商业组织，那么您不希望人们很容易看到您制作代码的成本很高。一种流行的方法是使用混淆来打乱内容，这种方式不会改变其运行方式，但会使其难以理解。混淆使用重命名变量和方法等技术。找出方法 'a1'、'a2'、'a3' 的用途比原来的 'GetName'、'UpdateInterestRate' 和 'SetNewPassword' 困难得多。

因此，使用混淆会使人们更难理解你的代码在做什么以及它使用的算法。然而，它并没有使它成为不可能。就像愿意花时间处理二进制文件的汇编程序专家仍然可以理解 C++ 代码一样，MSIL 专家最终可以解决您的混淆代码。但它增加了障碍，以至于很少有人会费心去尝试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T02:20:12.060

老实说，除了使用您提到的工具进行一些混淆之外，您无能为力。.NET 只是比脚本语言高出一步，除了脚本命令是二进制的并且称为 IL。这有点过于简单化了，但离现实并不远。使用 Reflection 编写的任何好的程序都可以用来对 .NET 应用程序进行逆向工程，或者如果您有足够的知识，可以使用一个好的十六进制编辑器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T09:39:27.133

很抱歉恢复旧帖子，但我认为 Eziriz 的 .NET Reactor 工作得非常出色。

事实上，我自己将它用于我所有的 .net 应用程序，显然没有现有的工具可以反编译受 .net reactor 保护的程序。更多详细信息可以在信息页面[http://www.eziriz.com/dotnet_reactor.htm](http://www.eziriz.com/dotnet_reactor.htm)上找到。使用试用版和 .net 反射器对其进行测试，您可以自己查看。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T02:33:41.170

有几种流行的混淆工具，包括 Dotfuscation，它有一个随 Visual Studio 2005 和 2008 一起提供的“轻量级”版本。它们有一个 Pro 版本，它不仅可以重命名变量和函数名称。然而，代码仍然是可见的，只是被打乱了一点，使其更难阅读和理解软件的逻辑流程。

另一种技术是使用其他程序来加密程序，并在运行时解密。然而，这也不是一个完美的解决方案。事实上，我知道没有完美的解决方案可以阻止坚定的工程师对软件进行逆向工程，如果有足够的时间和精力的话。

它真正归结为确定保护级别，这将使劝阻临时黑客变得足够困难，并使逆向工程尽可能昂贵，因此至少逆向工程在任何时间或时间都是有代价的钱，或者理想情况下，两者兼而有之。逆向工程成本越高，愿意付出努力的人就越少。这就是混淆的重点。

一些人认为使用像 C++ 编译器这样编译为本机代码的编译器可以防止这种逆向工程，但事实并非如此。一个好的反汇编程序甚至可以对纯二进制可执行文件进行逆向工程，因此不存在完美的解决方案。如果计算机可以读取并执行它，那么计算机正在使用的内存就可以被扫描和跟踪，从而绕过所有加密、混淆或任何其他使代码不落入坚定工程师之手的尝试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-27T19:15:04.930

免责声明：我不为 SmartAssembly 的制造商 RedGate 工作。我只是一个非常高兴的客户，他找到了一个好的、负担得起的解决方案。

选择很简单，选择SmartAssembly！不要在市场上的其他混淆器上浪费您的时间或金钱。我在评估竞争产品的非计费时间方面花了更多的钱。它们都有致命的缺陷，几乎无法调试。SmartAssembly 是一个易于使用、文档齐全、完善的应用程序，具有出色的支持。在他们的论坛上发布一个问题，并期望实际开发人员相当快地给出答案。

SmartAssembly 不仅仅是一个混淆器。它具有一系列功能，包括内置的、高度可定制的崩溃报告生成器，您的客户可以自动通过电子邮件发送给您。您可以在自己的服务器或 red-gates 服务器上查看这些报告。当您进行 beta 测试或向客户发布产品时，我无法告诉您这有多大用处。它还生成调试器文件，因此您可以调试您可能遇到的混淆产品的任何发布后问题。

如果您正在交付一个商业应用程序，那么将钱花在一个像样的混淆器上是有意义的。此处的错误选择可能会损害您的知识产权，或者更糟的是导致您经历令人毛骨悚然的调试。与 SmartAssembly 的成本相比，这个成本是多少？

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-20T02:18:05.187

我听说混淆器很好；它用于.Net Reflector。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-11-24T05:59:55.750

另一个是[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm) - 它比其他一些更实惠，并且具有各种混淆和保护方法来阻止因果和不那么随意的黑客。

# unit-testing - 单元测试指南

> ID：106800
> 
> 赞同：23
> 
> 时间：2008-09-20T02:19:11.750
> 
> 标签：unit-testing, tdd

有谁知道在哪里可以找到单元测试指南和建议？我想要一些可以解决以下类型主题的东西（例如）：

*   测试是否应该与应用程序逻辑在同一个项目中？
*   我应该有测试类来反映我的逻辑类，还是应该只拥有我认为需要的那么多的测试类？
*   我应该如何命名我的测试类、方法和项目（如果它们在不同的项目中）
*   应该测试私有的、受保护的和内部的方法，还是只测试那些可公开访问的方法？
*   单元测试和集成测试应该分开吗？
*   是否有**充分**的理由不拥有 100% 的测试覆盖率？

我不是在问我应该是什么？

最好有在线资源。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-20T02:26:31.157

我会推荐[Kent Beck](https://rads.stackoverflow.com/amzn/click/com/0321146530)关于 TDD 的书。

此外，您需要访问[Martin Fowler 的](http://martinfowler.com/articles/mocksArentStubs.html)网站。他也有很多关于测试的好信息。

我们非常重视 TDD，所以我会从这个角度回答问题。

> 测试是否应该与应用程序逻辑在同一个项目中？

通常，我们将测试保存在同一个解决方案中，但我们将测试分解为单独的 DLL/项目，这些 DLL/项目镜像它们正在测试的 DLL/项目，但维护名称空间，测试位于子名称空间中。示例：Common / Common.Tests

> 我应该有测试类来反映我的逻辑类，还是应该只拥有我认为需要的那么多的测试类？

是的，您的测试应该在创建任何类之前创建，并且根据定义，您应该只单独测试一个单元。因此，您的解决方案中的每个类都应该有一个测试类。

> 我应该如何命名我的测试类、方法和项目（如果它们在不同的项目中）

我想强调的是行为是被测试的，所以我通常在 SUT 之后命名测试类。例如，如果我有一个 User 类，我会这样命名测试类：

```
public class UserBehavior 
```

应该命名方法来描述您期望的行为。

```
public void ShouldBeAbleToSetUserFirstName() 
```

项目可以随意命名，但通常您希望它正在测试哪个项目相当明显。请参阅有关项目组织的先前答案。

> 应该测试私有的、受保护的和内部的方法，还是只测试那些可公开访问的方法？

同样，您希望测试断言预期的行为，就好像您是被测试对象的第 3 方消费者一样。如果您测试内部实现细节，那么您的测试将很脆弱。您希望您的测试能够让您自由地进行重构，而不必担心破坏现有功能。如果您的测试知道实现细节，那么如果这些细节发生变化，您将不得不更改您的测试。

> 单元测试和集成测试应该分开吗？

是的，单元测试需要与验收和集成测试相隔离。关注点分离也适用于测试。

> 是否有充分的理由不拥有 100% 的测试覆盖率？

我不会挂断 100% 代码覆盖率的事情。100% 的代码覆盖率往往意味着测试中有一定程度的质量，但这是一个神话。您可以进行糟糕的测试，但仍然获得 100% 的覆盖率。相反，我会依靠良好的测试优先心态。如果您总是在编写一行代码之前编写测试，那么您将确保 100% 的覆盖率，因此它成为一个有争议的问题。

一般来说，如果您专注于描述课程的全部行为范围，那么您将无需担心。如果您将代码覆盖率作为衡量标准，那么懒惰的程序员只会做足以满足该标准的工作，而您仍然会有糟糕的测试。取而代之的是严重依赖同行评审，其中也对测试进行评审。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T02:29:37.310

这是个好问题。我们自己有机地种植，我怀疑最好的方法就是这样。里面有一点“这取决于……”。

我们在同一个项目中的一个名为“UnitTes”的子命名空间中进行测试

我们的测试类反映了逻辑类，以简化跟踪测试与测试内容相关的位置

类的命名与它们正在测试的逻辑类一样，方法的命名是根据它们正在测试的场景来命名的。

我们只为公共和内部方法编写测试（测试在同一个项目中），目标是 95% 的类覆盖率。

我不想区分“单元”和“综合”。将花费大量时间试图找出哪个是哪个...包！一个测试就是一个测试。

100% 很难一直做到。我们的目标是 95%。获得最后 5% 所需的时间以及实际捕获的内容的回报也在递减。

这就是我们，适合环境和节奏。你的里程可能会有所不同。想想你的环境和所涉及的个性。

我期待看到其他人对此有什么看法！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T06:55:54.720

乔希的回答是正确的 - 只是澄清一点：

我将单元测试与集成和验收测试分开的原因是速度。我使用 TDD。我需要关于我刚刚创建/修改的代码行的即时反馈。如果我正在运行全套集成和/或验收测试，我无法做到这一点——这些测试涉及真实磁盘、真实网络以及非常缓慢且不可预测的外部系统。

不要越过横梁。如果你这样做，坏事就会发生。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T02:23:07.607

我强烈建议您阅读[测试驱动开发：示例](https://rads.stackoverflow.com/amzn/click/com/0321146530)和[测试驱动开发：实用指南](https://rads.stackoverflow.com/amzn/click/com/0131016490)单个主题的问题太多了

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T02:30:02.053

为了：

*   不，通常最好将它们包含在一个单独的项目中；除非您希望能够在运行时运行诊断。
*   理想的情况是 100% 的代码覆盖率，这意味着每个类的每个例程中的每一行代码。
*   我选择 ClassnameTest，ClassnameTest.MethodNameTestnumber
*   一切。
*   我会说是的，因为如果单元测试失败，则不需要运行集成测试。
*   不需要测试只需设置和获取字段的简单属性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T02:33:02.747

关于您的最后一个问题，根据我的经验，不坚持 100% 测试覆盖率的“好”理由是，要获得最后几个百分点需要付出不成比例的努力，尤其是在更大的代码库中。因此，一旦达到收益递减点，就要决定是否值得花时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-27T15:55:01.080

**测试是否应该与应用程序逻辑在同一个项目中？**

这取决于。无论哪种方式都需要权衡取舍。

将其保留在一个项目中需要额外的带宽来分发您的项目、额外的构建时间并增加安装占用空间，并且更容易犯下依赖于测试代码的生产逻辑的错误。

另一方面，保持独立的项目可能会使编写涉及私有方法/类的测试变得更加困难（取决于编程语言），并且会导致一些管理上的小麻烦，例如设置新的开发环境（例如，当新开发人员加入项目）更难。

这些不同成本的重要性因项目而异，因此没有统一的答案。

**我应该有测试类来反映我的逻辑类，还是应该只拥有我认为需要的那么多的测试类？**

不。

你应该有测试类，允许良好的测试代码（即最小的重复，明确的意图等）。

直接在测试类中镜像逻辑类的明显优势是它可以很容易地找到对应于特定代码段的测试。在不限制测试代码灵活性的情况下，还有其他方法可以解决这个问题。测试模块和类的简单命名约定通常就足够了。

**我应该如何命名我的测试类、方法和项目（如果它们在不同的项目中）**

您应该命名它们，以便：

*   每个测试类和测试方法都有明确的目的，并且
*   以便寻找特定测试（或有关特定单元的测试）的人可以轻松找到它。

**应该测试私有的、受保护的和内部的方法，还是只测试那些可公开访问的方法？**

通常应该测试非公共方法。这取决于您是否从仅测试公共接口中获得足够的信心，或者您真正想要测试的单元是否不可公开访问。

**单元测试和集成测试应该分开吗？**

这取决于您选择的测试框架。选择最适合您的测试框架的方法，并使其：

*   与一段代码相关的单元测试和集成测试都很容易找到，
*   只运行单元测试很容易，
*   只运行集成测试很容易，
*   运行所有测试很容易。

**是否有充分的理由不拥有 100% 的测试覆盖率？**

是的，这是有充分理由的。严格来说，“100% 的测试覆盖率”意味着你的代码中所有可能的情况都经过了练习和测试。这对于几乎任何项目来说都是不切实际的。

如果你简单地认为“100% 测试覆盖率”意味着每一行源代码都在某个时候被测试套件执行，那么这是一个很好的目标，但有时在尴尬的地方只有几行代码很难达到自动化测试。如果定期手动验证该功能的成本低于通过扭曲到达最后五行的成本，那么这就是不具有 100% 线路覆盖率的好理由。

Rather than a simple rule that you should have 100% line coverage, encourage your developers to discover *any* gaps in your testing, and find ways to fix those gaps, whether or the number of lines “covered” improves. In other words, if you measure lines covered, then you will improve your line coverge — but what you actually want is improved quality. So don't forget that line coverage is just a very crude approximation of quality.

# jakarta-ee - 什么是 Java EE？

> ID：106820
> 
> 赞同：226
> 
> 时间：2008-09-20T02:29:30.773
> 
> 标签：jakarta-ee

我意识到它从字面上翻译为 Java 企业版。但我要问的是这到底是什么意思？当一家公司需要 Java EE 经验时，他们真正要求的是什么？使用 EJB 的经验？使用 Java Web 应用程序的经验？

我怀疑这对不同的人意味着不同的东西，并且定义是主观的。

* * *

## 回答 #1

> 赞同：237
> 
> 时间：2008-09-20T19:04:05.377

Java EE 是一组用于开发和部署企业应用程序的规范。

通常，企业应用程序是指托管在提供支持企业应用程序的服务器上的软件。

规范（由 Sun 定义）描述了服务、应用程序编程接口 (API) 和协议。

构成 Java EE 的 13 项核心技术是：

1.  JDBC
2.  JNDI
3.  EJB
4.  RMI
5.  JSP
6.  Java 小服务程序
7.  XML
8.  管理系统
9.  Java IDL
10.  JTS
11.  JTA
12.  邮件
13.  日航

Java EE 产品提供者通常是应用程序服务器、Web 服务器或数据库系统供应商，他们提供实现规范中定义的接口的类。这些供应商在 Java EE 规范的实现上展开竞争。

当一家公司需要 Java EE 经验时，他们真正需要的是使用构成 Java EE 的技术的经验。通常，公司只会使用 Java EE 技术的一个子集。

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2008-09-20T02:43:37.090

Java EE 实际上是 Java 平台的技术和 API 集合，旨在支持“企业”应用程序，这些应用程序通常可以归类为旨在支持关键任务业务需求的大规模、分布式、事务性和高可用性应用程序。

至于员工在特定技术中寻找什么，很难说，因为在过去五年中，竞争环境一直在变化。这确实是关于正在解决*的*问题比其他任何问题都多。交易和分销是关键。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-10-23T22:43:46.103

严格来说，J(2)EE 是一组`API`s（正如当前的最佳答案所拥有的那样），它使程序员能够构建分布式事务系统。这个想法是抽象出复杂的分布式事务位（将由诸如 WebSphere 或 Weblogic 之类的**容器**实现），让程序员开发业务逻辑时不必担心存储机制和同步。

实际上，这是一个由委员会设计的拼凑而成的混搭，它的推动很大程度上是为了 IBM、甲骨文和 BEA 等供应商的利益，这样他们就可以销售过度复杂、过度设计、过度设计的可笑的东西。没用的产品。其中没有最基本的功能（例如调度）！

*J2EE 是一种营销结构。*

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-20T02:37:02.207

Java 环境有 2 个版本，J2EE 和 Se。SE 是标准版，其中包括编写单用户应用程序所需的所有基本类。而企业版是为多层企业应用程序或可能的分布式应用程序设置的。如果您要使用应用程序服务器，例如 tomcat 或 websphere，您会希望使用 J2EE，以及用于 n 层支持的额外类。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-20T02:43:24.000

它的含义一直在变化。它曾经表示 Servlet、JSP 和 EJB。现在，它可能意味着 Spring 和 Hibernate 等。

他们真正需要的是对 Java 生态系统、Servlet 容器、JMS、JMX、Hibernate 等以及它们如何组合在一起的经验和理解。

测试和源代码控制也是一项重要技能。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-20T02:38:42.123

是的，具有 EJB、Web 应用程序（servlest 和 JSP）、事务、Web 服务、管理和应用程序服务器方面的经验。

这也意味着，体验“企业”级应用程序，而不是桌面应用程序。

在许多情况下，企业应用程序需要与许多遗留系统连接，它们不仅是“网页”，而且具有 Java“版本”上可用的功能，可以解决这种连接问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-20T03:27:34.877

J2EE 传统上指的是 Sun 发布的产品和标准。例如，如果您正在开发标准 J2EE Web 应用程序，您将使用 EJB、Java Server Faces，并在支持 J2EE 标准的应用程序服务器中运行。然而，由于有如此庞大的开源库和过多的产品可以完成相同的工作（并且许多人会认为更好）然后这些 Sun 产品，J2EE 的日常含义已经迁移到引用这些（例如，许多人认为是 Spring/Tomcat/Hibernate 解决方案。

我认为这是一本很棒的书，它讨论了 J2EE 的“开源”方法 [http://www.theserverside.com/tt/articles/article.tss?l=J2EEWithoutEJB_BookReview](http://www.theserverside.com/tt/articles/article.tss?l=J2EEWithoutEJB_BookReview)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-20T18:25:25.080

我会说 J2EE 经验 = 对一些 J2EE 技术的深入体验，对大多数 J2EE 技术的一般知识，以及对企业软件的一般经验。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2015-03-25T18:37:34.010

似乎 Oracle 现在正试图取消 JSP（用 Faces 代替）并模拟 Spring 的 REST (JAX-RS) 和 DI。

参考：[https ://docs.oracle.com/javaee/7/firstcup/java-ee001.htm](https://docs.oracle.com/javaee/7/firstcup/java-ee001.htm)

表 2-1 Web 层 Java EE 技术

* * *

**JavaServer Faces 技术**

一种用于 Web 应用程序的用户界面组件框架，它允许您在称为 Facelets 页面的 XHTML 页面上包含 UI 组件（例如字段和按钮）；转换和验证 UI 组件数据；将 UI 组件数据保存到服务器端数据存储；并维护组件状态

**表达语言**

Facelets 页面中使用的一组标准标记，用于引用 Java EE 组件

**小服务程序**

动态处理请求和构造响应的 Java 编程语言类，通常用于 HTML 页面

**Java EE 的上下文和依赖注入**

一组上下文服务，使开发人员可以轻松地在 Web 应用程序中使用企业 bean 和 JavaServer Faces 技术

# javascript - Javascript - 获取图像高度

> ID：106828
> 
> 赞同：32
> 
> 时间：2008-09-20T02:33:03.870
> 
> 标签：javascript, ajax

我需要使用 AJAX 在网页上显示一堆图像。它们都有不同的尺寸，所以我想在显示它们之前调整它们的尺寸。有没有办法在 JavaScript 中做到这一点？

对每个图像使用 PHP`getimagesize()`会导致不必要的性能损失，因为会有很多图像。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-06-04T18:06:35.413

我正在寻找使用 JavaScript 获取图像高度和宽度的解决方案。我发现了很多，但所有这些解决方案仅在图像存在于浏览器缓存中时才有效。

最后我找到了一个解决方案来获取图像的高度和宽度，即使图像不存在于浏览器缓存中：

```
<script type="text/javascript">

  var imgHeight;
  var imgWidth;

  function findHHandWW() {
    imgHeight = this.height;
    imgWidth = this.width;
    return true;
  }

  function showImage(imgPath) {
    var myImage = new Image();
    myImage.name = imgPath;
    myImage.onload = findHHandWW;
    myImage.src = imgPath;
  }
</script> 
```

谢谢，

比诺德·苏曼

[http://binodsuman.blogspot.com/2009/06/how-to-get-height-and-widht-of-image.html](http://binodsuman.blogspot.com/2009/06/how-to-get-height-and-widht-of-image.html)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-20T02:42:50.353

尝试这个：

```
var curHeight;
var curWidth;

function getImgSize(imgSrc)
{
var newImg = new Image();
newImg.src = imgSrc;
curHeight = newImg.height;
curWidth = newImg.width;

} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2019-06-18T12:41:41.693

您可以使用`img.naturalWidth`and`img.naturalHeight`来获取图像的真实尺寸（以像素为单位）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-21T11:13:40.757

我首选的解决方案是在服务器端调整大小，这样您传输的不必要数据就会减少。

如果您必须在客户端执行此操作，并且需要保持图像比例，则可以使用以下内容：

```
var image_from_ajax = new Image();
image_from_ajax.src = fetch_image_from_ajax(); // Downloaded via ajax call?

image_from_ajax = rescaleImage(image_from_ajax);

// Rescale the given image to a max of max_height and max_width
function rescaleImage(image_name)
{
    var max_height = 100;
    var max_width = 100;

    var height = image_name.height;
    var width = image_name.width;
    var ratio = height/width;

    // If height or width are too large, they need to be scaled down
    // Multiply height and width by the same value to keep ratio constant
    if(height > max_height)
    {
        ratio = max_height / height;
        height = height * ratio;
        width = width * ratio;
    }

    if(width > max_width)
    {
        ratio = max_width / width;
        height = height * ratio;
        width = width * ratio;
    }

    image_name.width = width;
    image_name.height = height;
    return image_name;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T02:41:46.377

...但是...在服务器端调整图像大小而不是将字节传输到浏览器并在那里执行不是更好吗？

当我说调整图像大小时，我并不是指在 HTML 图像标签中设置高度和宽度。如果这样做，您仍然需要从服务器向客户端传送大量字节。我的意思是，实际上是在服务器端操纵图像本身。

我在这里有.NET C# 代码采用这种方法，但也必须有一种 php 方式来做到这一点：http: [//ifdefined.com/www/gallery.html](http://ifdefined.com/www/gallery.html)

此外，通过在服务器端执行此操作，可以只进行一次调整，然后保存调整后的图像，这将非常快。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-15T11:22:20.343

尝试使用 JQuery：

```
<script type="text/javascript">
function jquery_get_width_height()
{
    var imgWidth = $("#img").width();
    var imgHeight = $("#img").height();
    alert("JQuery -- " + "imgWidth: " + imgWidth + " - imgHeight: " + imgHeight);
}
</script> 
```

或者

```
<script type="text/javascript">
function javascript_get_width_height()
{
    var img = document.getElementById('img');
    alert("JavaSript -- " + "imgWidth: " + img.width + " - imgHeight: " + img.height);
}
</script> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T02:36:11.367

你想自己调整图像，还是只是调整它们的显示方式？如果是前者，你需要在服务器端做一些事情。如果是后者，您只需要更改 image.height 和 image.width。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T02:42:16.437

嗯......有几种方法可以解释这个问题。

第一种方法，我认为您的意思是简单地改变显示尺寸，以便所有图像显示相同的尺寸。为此，我实际上会使用 CSS 而不是 JavaScript。只需创建一个设置了适当宽度和高度值的类，并让所有`<img>`标签都使用这个类。

第二种方法是您希望保留所有图像的纵横比，但将显示尺寸缩放到一个合理的值。有一种方法可以在 JavaScript 中访问它，但我需要一些时间来编写一个快速的代码示例。

第三种方法，我希望你不是这个意思，是改变图像的实际大小。这是你必须在服务器端做的事情，因为 JavaScript 不仅无法创建图像，而且它没有任何意义，因为已经发送了完整大小的图像。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T02:52:22.903

值得注意的是，在 Firefox 3 和 Safari 中，仅通过更改高度和宽度来调整图像大小看起来并不算太糟糕。在其他浏览器中，它看起来非常嘈杂，因为它使用最近邻重采样。当然，您需要为提供更大的图像付费，但这可能并不重要。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-24T13:38:58.093

只需在隐藏`<img>`标签 ( `style = "display none"`) 中加载图像，使用 jQuery 监听 load 事件触发，`Image()`使用 JavaScript 创建一个新的，将源设置为不可见图像，并获得如上所示的大小。

# python - 如何最好地在控制台中绘制？

> ID：106850
> 
> 赞同：9
> 
> 时间：2008-09-20T02:45:45.993
> 
> 标签：python, console, stdout

我正在尝试用python编写一个控制台（如终端，而不是游戏控制台）乒乓球游戏，但我无法确定如何最好地（重新）绘制游戏。

我正在考虑将二维数组作为一种位图，编辑数组以反映球/桨的新位置，然后将每一行转换为字符串并打印。然而，这意味着旧的“框架”将保留，如果游戏的尺寸小于控制台窗口，旧的框架仍然可见。

有没有办法从控制台中删除字符？'\b' 我听说是不可靠的。

或者是否有更简单的替代方法可以将此类应用程序输出到控制台？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T02:47:18.983

看起来 Python 有一个[curses](http://en.wikipedia.org/wiki/Curses_(programming_library))端口/库：

[https://docs.python.org/library/curses.html](https://docs.python.org/library/curses.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-24T07:16:41.540

试试[urwid](http://urwid.org/)。与 urwid 捆绑在一起的示例之一是[动画条形图模拟器](https://github.com/wardi/urwid/blob/master/examples/graph.py)。条形图可以很好地清除屏幕，不会留下旧“框架”的伪影。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T18:30:52.983

实际上有**两个**库可以解决这个问题，旧的[curses](https://docs.python.org/library/curses.html)和新的[S-Lang](http://www.jedsoft.org/slang/)。Curses 倾向于制作有缺陷的线条艺术，尤其是在 Windows 和 unicode 控制台上（它的 unicode 支持很糟糕）。S-Lang的[屏幕管理功能](http://www.jedsoft.org/slang/doc/html/cslang-8.html)更好。

虽然我没有在 Python 中使用它们中的任何一个，而且似乎更支持 curses，但由于这些问题，至少在 C 中我将我的代码切换到 S-Lang，并且因为在内心深处我从来没有真正喜欢过 curses API .

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-06-14T21:48:08.103

我最近一直在开发一个面临类似问题的 ASCII 动画包（ [https://github.com/peterbrittain/asciimatics ）。](https://github.com/peterbrittain/asciimatics)虽然它没有您编写游戏所需的一切，但它应该可以满足您的大部分需求。

特别是 Sprite 类将帮助您处理重绘问题。有大量示例可帮助您掌握使用它们的各种方法以及包中的其他效果。这是我整理的一个小演示，以向我过去最喜欢的游戏之一致敬...

[![吃豆人](https://asciinema.org/a/47568.png)](https://asciinema.org/a/47568)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T09:15:16.337

You can use curses.

It has a [Windows Port](http://adamv.com/dev/python/curses/ "WCurses") and [Unix Port](https://docs.python.org/library/curses.html "Unix Curses"), and plenty of [documentation](https://docs.python.org/howto/curses.html "curses howto"). You can also use some [helper libs](http://urwid.org/ "gui for curses").

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T02:48:12.787

我会使用[curses](http://python.org/doc/2.5/lib/module-curses.html)模块进行调查。它会处理很多细节，让你专注于更高层次的东西。

# sql - “订单”表的“身份增量”有什么好的价值

> ID：106854
> 
> 赞同：2
> 
> 时间：2008-09-20T02:49:12.100
> 
> 标签：sql

“订单”表的标识增量有什么好的价值？（购物车订单中的订单）

我希望显示订单号，以便我们的订单数量比实际数量多，并且在可能出现问题的情况下让用户更难猜测其他用户的订单号。

我不想要一个太大的值，以至于我可能会用完值，我也不希望一个明显的序列变得明显。

我现在已经确定了 42

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T02:54:32.773

将 ID 公开给最终用户通常不是一个好的（安全）想法。

我会使用一个普通的 +1 自动增量 ID 列，并让用户可见的订单号是一个基于当前日期的字符串。也许使用日期+今天到目前为止的订单数：“20080919336”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T02:56:26.497

为什么要增加？使用[GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)会使订单数量无法猜测，并且*几乎*不可能猜测订单 URL（显然，您仍想检查查看它的人是否有权查看它）。

如果您决定使用单调递增的整数 ID，则只需估算您将拥有多少订单，直到您用完为止。但是如果有人能看到其中的一小部分并猜测序列增量号，它们总是可以猜到的。然后他们就会知道你到底有多少订单，并且能够整天猜测 URL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T03:19:03.870

如果你想让它看起来订单比实际数量多，只需选择一个任意大的 ID 号即可。但是，如果是我，我只会将增量设置为 1。为了防止用户猜测订单号，混淆数字可能不是最好的方法。

如果我是用户 123，并且我下了订单，编号为 4567，假设查看订单的 url 如下所示：

> > [http://example.com/orders?id=4567](http://example.com/orders?id=4567)

假设我感觉很淘气，并决定开始使用该网址。如果我尝试怎么办：

> > [http://example.com/orders?id=5000](http://example.com/orders?id=5000)

如果还没有订单5000，会显示什么？像“无效的订单 ID”这样简单的东西呢？但是，说我尝试：

> > [http://example.com/orders?id=4568](http://example.com/orders?id=4568)

并且该订单确实存在，它应该显示订单吗？它可以检查创建订单的用户的 ID，除非是我（好老用户 #123），否则会显示相同的错误消息“无效的订单 ID”。这可能使用户无法判断是否存在任何给定的订单 ID，除非他们自己创建订单。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T02:54:33.723

我想说最重要的事情是让你的身份种子一开始就很高，比如 156,786 之类的。至于增量，使用奇数可能会很好，因此并非所有订单号都是偶数。

但是，我必须说，对于将向用户公开的订单#，最好不要使用标识字段。通常最好将这些东西隐藏在数据库中，并为订单号设置一个单独的字段。这样，您可以更改订单号，而不会弄乱您的所有参考资料。您的所有其他表都将引用 Identity 字段（应该是您的主键），然后您可以在其他 Order # 字段上添加索引以保持其唯一性。

你以后会感谢我的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T02:57:13.733

您可以使用 indenity 值。只需将种子设置为高，然后将其添加。

```
[ID] [int] IDENTITY(5497,73) NOT NULL, 
```

我有一种感觉，如果人们看到他们是 1 号订单，他们不会在意。我要做的是将其设置为 300 万，增量为 1。这将是一个很大的数字，并且会上升。如果您认为人们不购买，您可以随时重新播种，因为他们是第 5 个订购的人。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T03:02:24.097

虽然它是除此问题之外所有问题的答案，但 42 并不是一个好的选择。

一种可能性是您使用客户 ID 和附加的增量编号......但在这种情况下，这不会是订单表上带有种子的“身份增量”。

示例：JoeBlow 在客户表中的 ID 为 56，这是他的第 18 个订单（5618），为了进一步掩盖您的订单数量（？），您可以按照您喜欢的方式做任何其他事情，附加毫秒/随机或类似的东西。这是一个简单的例子

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T04:30:57.987

为什么不拥有一个随机数池，然后从池中取出下一个随机数？这可以通过获取一些数据（用户 ID 和计数器）并使用一些加密/散列算法来完成。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-27T10:59:09.660

A simple way to do this is to start high like has already been suggested and use an increment of 1\. When you have to show this order number to the user, reverse it and append a 1\.

So order 64010 would become 101046

I have to append a 1 in case the `Id` ends with a zero.

The users will see some high numbers that don't seemingly have a pattern and it would be difficult to guess the pattern used.

Preferably, you would have a column in your table called `OrderNumber` which is just a reversal of `Id`. This would prevent yourself mistakenly checking the Id for specific order numbers when you're debugging :)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T05:56:59.247

1.  创建一个递增的 Int 作为您的内部 PK。为您的存储和索引性能提供卓越的填充系数。
2.  创建一个散列、复合密钥或 GUID 作为外部 AK - 此值应该是在表单等上公开的值。美国驾照 # 是人为复合密钥的一个很好的例子 - 由唯一随机数加上驱动程序的一些任意组合生成名称字符。
3.  永远不会有 GUID 作为聚集索引 - 它会导致*可怕*的页面填充问题

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T02:56:11.333

您可以使用非数字订单参考代码，例如“ABC0123”。取决于您的平台，但您可以将其用作表的主键，也可以作为自动递增标识符的补充（然后将简单地成为内部引用）。

另外：如果用户猜测订单号是一个问题，你真的需要考虑一些安全措施。

# c++ - 有使用英特尔线程构建模块的经验吗？

> ID：106862
> 
> 赞同：25
> 
> 时间：2008-09-20T02:52:37.067
> 
> 标签：c++, multithreading, intel, tbb

英特尔的[线程构建模块 (TBB)](http://www.threadingbuildingblocks.org/)开源库看起来非常有趣。即使有一本关于这个主题的[O'Reilly 书](http://oreilly.com/catalog/9780596514808/)，我也没有听说有很多人在使用它。我有兴趣将它用于 Unix（Mac、Linux 等）环境中的一些多级并行应用程序（MPI + 线程）。对于它的价值，我对高性能计算/数值方法类应用感兴趣。

有没有人有 TBB 的经验？它运作良好吗？它是否相当可移植（包括 GCC 和其他编译器）？该范式是否适用于您编写的程序？还有其他我应该研究的图书馆吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-20T13:34:22.687

我已经将它引入到我们的代码库中，因为当我们迁移到 16 核机器时，我们需要一个 bettor malloc 来使用。对于 8 岁及以下，这不是一个重大问题。它对我们来说效果很好。我们计划接下来使用细粒度的并发容器。理想情况下，我们可以利用产品的真正内涵，但这需要重新考虑我们如何构建代码。我真的很喜欢 TBB 中的想法，但是在代码库上进行改造并不容易。

您不能将 TBB 视为另一个线程库。他们有一个全新的模型，它真正位于线程之上并将线程抽象出来。你学会思考任务、parallel_for 类型的操作和管道。如果我要构建一个新项目，我可能会尝试以这种方式对其进行建模。

我们在 Visual Studio 中工作，它工作得很好。它最初是为 linux/pthreads 编写的，所以在那里运行也很好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T17:20:41.303

我不做数值计算，但我从事数据挖掘（想想聚类和分类），我们的工作负载可能相似：所有数据都是静态的，你在程序开始时就有了。我简要调查了英特尔的 TBB，发现它们对我的需求来说太过分了。在开始使用基于 pthread 的原始代码后，我切换到 OPENMP 并在可读性和性能之间获得了正确的组合。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-08-09T20:44:17.897

# 可移植性

TBB 是便携式的。它支持 Intel 和 AMD（即 x86）处理器、IBM PowerPC 和 POWER 处理器、ARM 处理器以及可能的其他处理器。如果查看[构建目录](https://github.com/01org/tbb/tree/tbb_2018/build)，您可以看到构建系统支持的所有配置，包括各种操作系统（Linux、Windows、Android、MacOS、iOS、FreeBSD、AIX 等）和编译器（GCC、英特尔、Clang/LLVM、IBM XL 等）。我没有使用 PGI C++ 编译器尝试过 TBB，并且知道它不适用于 Cray C++ 编译器（截至 2017 年）。

几年前，我参与了将 TBB 移植到 IBM Blue Gene 系统的工作。静态链接是一个挑战，但现在由[big_iron.inc](https://github.com/jeffhammond/tbb/blob/cray-compiler/build/big_iron.inc)构建系统帮助程序解决。其他问题是支持相对古老的 GCC 版本（4.1 和 4.4）并确保 PowerPC atomics 正常工作。我希望在提供或兼容 GCC 和 POSIX 的平台上移植到任何当前不受支持的体系结构都相对简单。

# 在社区代码中的使用

我知道至少有两个使用 TBB 的 HPC 应用程序框架：

*   [驼鹿](http://mooseframework.org/)
*   [疯狂](https://github.com/m-a-d-n-e-s-s/madness)

我不知道 MOOSE 如何使用 TBB，但 MADNESS 使用 TBB 作为其任务队列和内存分配器。

# 性能与其他线程模型

我个人在[Parallel Research Kernels](https://github.com/ParRes/Kernels)项目中使用了 TBB，在其中我将 TBB 与 OpenMP、OpenCL、Kokkos、RAJA、C++17 Parallel STL 和其他模型进行了比较。有关详细信息，请参见[C++ 子目录](https://github.com/ParRes/Kernels/tree/master/Cxx11)。

下图显示了上述型号在 Intel Xeon Phi 7250 处理器上的相对性能（细节并不重要 - 所有型号都使用相同的设置）。正如你所看到的，除了较小的问题规模之外，TBB 做得很好，自适应调度的开销更相关。TBB 具有会影响这些结果的调谐旋钮。

[![PRK 模板](https://i.stack.imgur.com/MVd5j.png)](https://i.stack.imgur.com/MVd5j.png)

全面披露：我为英特尔工作，从事研究/寻路工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T05:55:55.257

ZThread 是 LGPL，如果不在开源项目中工作，您只能在动态链接中使用该库。

开源版本中的线程构建块（TBB），（有一个新的商业版本，299 美元，还不知道有什么区别）是带有所谓“运行时异常”的 GNU 通用公共许可证版本 2 ~~（即特定于仅用于创建免费软件。）~~ 我已经看到其他运行时异常尝试接近 LGPL，但启用商业用途和静态链接**现在**~~不是~~ 这种情况。

 **我之所以写这篇文章，是因为我借此机会检查了库许可证，并且这些许可证也应该是根据打算给予它们的用途进行选择的考虑因素。

* * *

Txs，Jihn 指出此更新...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T06:06:44.653

我已经简单地使用过 TBB，并且将来可能会更多地使用它。我喜欢使用它，最重要的是因为您不必处理 C++ 的宏/扩展，而是保留在语言中。它也非常便携。我在windows和linux上都用过。但是有一件事：使用 TBB 处理线程很困难，您必须从任务的角度来考虑（这实际上是一件好事）。英特尔 TBB 不支持您使用裸锁（这会使这变得乏味）。但总的来说，这是我的初步经验。

我还建议您也看看 openMP 3。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-02T21:35:42.620

我在一个项目中使用 TBB。它似乎比线程更容易使用。有些任务可以并行运行。任务只是对并行子例程的调用。负载平衡是自动完成的。这就是为什么我接受它作为更高级别的并行化库。我在 4 核英特尔处理器上没有太多工作就实现了 2.5 倍的速度。有一些例子，他们在论坛上回答问题，并且它被维护并且它是免费的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-12-03T11:36:18.580

与其他替代方案（例如 C++ 11x 并发特性）相比，TBB（线程构建块）的用途值得明确。TBB 是一个可移植和可扩展的库（不是编译器扩展），允许您以轻量级任务的形式编写代码，TBB 将安排这些任务在可用的 CPU 资源上尽可能快地运行。它不是为其他目的（例如抢占）而设计的支持线程。

我使用 TBB 将图像扫描线上的 for 循环的现有图像处理加速到 parallel_for 循环中（至少 2-4 条扫描线作为“粒度”大小）。这是非常成功的。它确实需要（重新）编写循环体以处理任意索引，而不是假设每个循环体都是按顺序处理的（例如，在每次循环迭代之间递增的指针）。

这是一个相当简单的案例，因为没有要更新的共享存储。使用更强大的功能（例如管道）将需要大量重新构想和/或重写现有代码，因此可能更适合新代码。

这个基于 TBB 的代码保持可移植性是一个强大的优势，似乎不会干扰同一进程中的其他代码同时使用其他线程策略，并且以后可以与更高或更低级别的多处理策略（例如 TBB parallel_for代码可以从 TBB 多处理管道中的过滤器调用）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T05:36:01.323

我研究过 TBB，但从未在项目中使用过它。[我没有看到比ZThread](http://zthread.sourceforge.net/)有任何优势（出于我的目的）。可以在[此处](http://www.inf.uni-konstanz.de/dbis/members/vinnik/zsim/doc/documents.html)找到简短且有些过时的概述。

它相当完整，有几个线程调度选项、所有常用的同步类和一个非常方便的基于异常的线程“中断”机制。它易于扩展，编写良好且有文档记录。我已经在 20 多个项目中使用了它。
它还可以与任何支持 POSIX 线程以及 Windows 的 *NIX 配合使用。

值得一看。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-04T08:40:04.243

> 开源版本中的 Threading Building Blocks (TBB)，（有一个新的商业版本，299 美元，还不知道有什么区别）是带有所谓“运行时异常”的 GNU 通用公共许可证版本 2（即特定于仅在创建免费软件时使用。）我已经看到其他尝试接近 LGPL 但启用商业使用和静态链接的运行时异常，情况并非如此。

根据这个[问题](https://stackoverflow.com/questions/362694/intels-threading-building-blocks-runtime-exception-license-what-does-it-mean)，线程构建块可以在没有版权限制的情况下用于商业用途。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T06:08:04.117

你看过[boost](http://www.boost.org/)库和它的[线程 API](http://www.boost.org/doc/libs/1_36_0/doc/html/thread.html)吗？

# adobe - Adobe Captivate 3 打字声音查看录音

> ID：106864
> 
> 赞同：0
> 
> 时间：2008-09-20T02:53:40.577
> 
> 标签：adobe, adobe-captivate

我正在使用 Adob​​e Captivate 3，但在使用录音时无法禁用打字噪音。有时，当我禁用此“功能”并进行录音时，它不会发出打字声音，但是当我发布项目时，打字声音会返回。此外，我还有其他项目正在处理，在录制过程中打字声音最初没有被禁用，我无法让它停止发出打字噪音。

关于如何在新的或现有的 Captivate 项目中永久禁用打字声音的任何建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-21T00:03:20.600

一些搜索的几个项目：

Adobe.com :[设置键盘敲击声音](http://help.adobe.com/en_US/Captivate/3.0/05_audio_17.html)

> 如果您不喜欢已完成项目中的敲击声，请使用以下步骤将其删除。敲击声音是项目级别的设置，因此声音要么在所有幻灯片上播放，要么从所有幻灯片中删除。

[Adobe Captivate 3：录制的击键让您重新录制？不再！](http://iconlogic.blogs.com/weblog/2007/09/adobe-captiva-3.html)

这篇文章很长，有几个选择。

希望有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-30T19:10:51.533

您可以在发布之前删除点击声音（Captivate 3）。单击发布，然后单击首选项，然后取消选中“生成项目时播放录制类型的点击音频”。这对我有用。

# php - 如何让 WISA 像 LAMP 一样工作（保护 IIS 上的 .mp3）

> ID：106871
> 
> 赞同：0
> 
> 时间：2008-09-20T02:56:24.127
> 
> 标签：php, asp.net, apache, iis, no-cache

我创建了一些小的 Flash 小部件，它们可以从 Apache/php 主机流式传输 .mp3 音频。mp3 文件无法直接访问，并且不会自行保存到浏览器缓存中。

为此，我将主机上的 mp3 文件权限设置为“所有者：读/写”（数值 600）。这使得只有我的 .php 文件可以读取 .mp3。

然后我从我的 ActionScript 向我的 php 文件发出请求，它将 mp3 流式传输到我的小部件。（如果客户端/用户在浏览器缓存中查找，则找不到所需的 mp3 文件）

这是流式传输文件的 php 代码：

```
<?php 
ob_start();
header("Expires: Mon, 20 Dec 1977 00:00:00 GMT");
header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
header("Cache-Control: no-store, no-cache, must-revalidate");
header("Cache-Control: post-check=0, pre-check=0", false);
header("Pragma: no-cache");
header("Content-Type: audio/mpeg");
@readfile($_GET["file"]);
ob_end_flush();
?> 
```

有谁知道如何使用 IIS/ASP.Net 重现此行为

```
 1.) Make it so a file is only accessible to a file on the server.
 2.) Stream that file using an .ASPX or .ASHX? 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T03:06:20.170

你并没有真正保护 MP3，只是混淆了它们。任何人仍然可以保存它们，特别是如果他们只是启动像 Fiddler 这样的 HTTP 调试器来找出正在进行的 HTTP 调用。您将它们设置为不缓存并通过 PHP 脚本这一事实并没有多大帮助。

要使用 ASP.NET 获得相同的效果，您将编写一个`HTTPHandler`（可能只是关闭**.ashx**），使用相同的方式设置所有标题`context.Response.Headers`，然后使用加载*.mp3*文件`System.IO.FileStream`并将其发送到`context.Response.OutputStream`. 在 MSDN 上查找`System.Web.HTTPHandler`、`System.IO.FileStream`和`System.Web.HTTPResponse`以获取更多信息。

# .net - InternalsVisibleTo 属性不起作用

> ID：106880
> 
> 赞同：76
> 
> 时间：2008-09-20T02:59:22.323
> 
> 标签：.net, attributes, internalsvisibleto

我正在尝试使用`InternalsVisibleTo`程序集属性使 .NET 类库中的内部类对我的单元测试项目可见。出于某种原因，我不断收到一条错误消息，上面写着：

> 'MyClassName' 由于其保护级别而无法访问

两个程序集都已签名，并且我在属性声明中列出了正确的密钥。有任何想法吗？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-09-20T11:40:12.633

您绝对确定您在属性中指定了正确的公钥吗？请注意，您需要指定完整的公钥，而不仅仅是公钥令牌。它看起来像：

```
[assembly: InternalsVisibleTo("MyFriendAssembly,
PublicKey=0024000004800000940000000602000000240000525341310004000001000100F73
F4DDC11F0CA6209BC63EFCBBAC3DACB04B612E04FA07F01D919FB5A1579D20283DC12901C8B66
A08FB8A9CB6A5E81989007B3AA43CD7442BED6D21F4D33FB590A46420FB75265C889D536A9519
674440C3C2FB06C5924360243CACD4B641BE574C31A434CE845323395842FAAF106B234C2C140
6E2F553073FF557D2DB6C5")] 
```

它是 320 左右的十六进制数字。不确定为什么需要指定完整的公钥 - 可能只使用其他程序集引用中使用的公钥令牌，有人会更容易欺骗朋友程序集的身份。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2013-07-26T18:01:04.757

另一个可能的“陷阱”：您在 中指定的朋友程序集的名称`InternalsVisibleToAttribute`必须与朋友程序集的名称**完全**匹配，如朋友的项目属性中所示（在“应用程序”选项卡中）。

就我而言，我有一个项目`Thingamajig`和一个配套项目`ThingamajigAutoTests`（更改名称以保护有罪者）都产生了未签名的程序集。我适当地将属性添加到 Thingamajig\AssemblyInfo.cs 文件中，并如上所述`[assembly: InternalsVisibleTo( "ThingamajigAutoTests" )]`注释掉`AssemblyKeyFile`和属性。`AssemblyKeyName`该`Thingamajig`项目构建得很好，但其内部成员顽固地拒绝出现在自动测试项目中。

经过一番摸索，我重新检查了`ThingamajigAutoTests`项目属性，发现程序集名称被指定为“ThingamajigAutoTests.dll”。宾果游戏 - 我在属性中的程序集名称中添加了“.dll”扩展名，`InternalsVisibleTo`这些部件就位。

有时候，这是最小的事情......

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2010-08-29T13:09:14.877

如果您的程序集未签名，但您仍然收到相同的错误，请检查您的 AssemblyInfo.cs 文件中的以下任一行：

```
[assembly: AssemblyKeyFile("")]
[assembly: AssemblyKeyName("")] 
```

如果存在这些行中的任何一个（或两个），属性选项卡仍会将您的程序集显示为未签名，但 InternalsVisibleTo 属性将具有这些行的程序集视为强签名。只需删除（或注释掉）这些行，它应该适合您。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-20T22:50:02.560

值得注意的是，如果“friend”（测试）程序集是用 C++/CLI 而不是 C#/VB.NET 编写的，则需要使用以下内容：

```
#using "AssemblyUnderTest.dll" as_friend 
```

而不是项目参考或通常的`#using`陈述。出于某种原因，在项目参考 UI 中无法执行此操作。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-05-10T01:23:47.067

您可以使用[AssemblyHelper 工具](http://vkreynin.wordpress.com/2007/12/09/testing-internals-members-with-internalsvisibleto-attribute/)，该工具将为您生成 InternalsVisibleTo 语法。这是[最新版本的链接](http://vkreynin.wordpress.com/2010/05/09/assemblyhelpers-now-works-net-4-assemblies/)。请注意，它仅适用于强命名程序集。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-03-22T17:36:45.837

这是我用来快速生成此属性的宏。它有点hacky，但它有效。在我的机器上。当最新的签名二进制文件位于`/bin/debug`. 等等模棱两可等等。无论如何，你可以看到它是如何获得密钥的，所以这会给你一个提示。在您的时间允许的情况下修复/改进。

```
Sub GetInternalsVisibleToForCurrentProject()
    Dim temp = "[assembly:  global::System.Runtime.CompilerServices." + _
               "InternalsVisibleTo(""{0}, publickey={1}"")]"
    Dim projs As System.Array
    Dim proj As Project
    projs = DTE.ActiveSolutionProjects()
    If projs.Length < 1 Then
        Return
    End If

    proj = CType(projs.GetValue(0), EnvDTE.Project)
    Dim path, dir, filename As String
    path = proj.FullName
    dir = System.IO.Path.GetDirectoryName(path)
    filename = System.IO.Path.GetFileNameWithoutExtension(path)
    filename = System.IO.Path.ChangeExtension(filename, "dll")
    dir += "\bin\debug\"
    filename = System.IO.Path.Combine(dir, filename)
    If Not System.IO.File.Exists(filename) Then
        MsgBox("Cannot load file " + filename)
        Return
    End If
    Dim assy As System.Reflection.Assembly
    assy = System.Reflection.Assembly.Load(filename)
    Dim pk As Byte() = assy.GetName().GetPublicKey()
    Dim hex As String = BitConverter.ToString(pk).Replace("-", "")
    System.Windows.Forms.Clipboard.SetText(String.Format(temp, assy.GetName().Name, hex))
    MsgBox("InternalsVisibleTo attribute copied to the clipboard.")
End Sub 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-09-17T12:03:10.330

除了上述所有，当一切似乎都正确，但朋友程序集固执地拒绝看到任何内部时，**重新加载解决方案或重新启动 Visual Studio**可以解决问题。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-20T03:16:25.513

在编译友元程序集（不包含 InternalsVisibleTo 属性的程序集）时，您需要使用 /out: 编译器开关。

编译器需要知道正在编译的程序集的名称，以确定生成的程序集是否应被视为友元程序集。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-10-18T18:13:59.380

您需要为程序集生成一个新的完整公钥，然后为程序集指定属性。

```
[assembly: InternalsVisibleTo("assemblyname,
PublicKey="Full Public Key")] 
```

按照以下[MSDN](https://msdn.microsoft.com/en-us/library/office/ee539398(v=office.14).aspx)步骤从 Visual Studio 为程序集生成新的完整公钥。

**将“获取程序集公钥”项添加到“工具”菜单**

在 Visual Studio 中，单击工具菜单上的**外部工具。**

在 External Tools 对话框中，单击**Add**并在 Title 框中输入 Get Assembly Public Key。

通过浏览到 sn.exe 填充命令框。它通常安装在以下位置：**C:\Program Files (x86)\Microsoft SDKs\Windows\v7.0a\Bin\x64\sn.exe**。

在“参数”框中，键入以下内容（区分大小写）：**-Tp $(TargetPath)**。选中使用输出窗口复选框。

单击**确定**。新命令被添加到工具菜单中。

每当您需要正在开发的程序集的公钥令牌时，单击工具菜单上的获取程序集公钥命令，公钥令牌就会出现在输出窗口中。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-11-25T10:47:16.457

在我使用 VS.Net 2015 的情况下，我需要对两个程序集进行签名**（**如果至少要对 1 个程序集进行签名，或者您想在程序集的公钥上引用）。

我的项目根本没有使用签名。所以我开始在我的测试库中添加一个签名密钥，并在我的项目的基础库中使用 InternalsVisibleTo-Attribute。但是 VS.Net 总是解释它无法访问朋友方法。

当我开始对基础库进行签名时（它可以是相同的或另一个签名密钥——只要你签署了基础库），VS.Net 立即能够按预期工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-10-14T15:57:50.527

以前使用 PublicKey 的答案有效：（Visual Studio 2015：需要在一行，否则会抱怨程序集引用无效或无法引用。PublicKeyToken 不起作用）

```
[assembly: InternalsVisibleTo("NameSpace.MyFriendAssembly, PublicKey=0024000004800000940000000602000000240000525341310004000001000100F73F4DDC11F0CA6209BC63EFCBBAC3DACB04B612E04FA07F01D919FB5A1579D20283DC12901C8B66A08FB8A9CB6A5E81989007B3AA43CD7442BED6D21F4D33FB590A46420FB75265C889D536A9519674440C3C2FB06C5924360243CACD4B641BE574C31A434CE845323395842FAAF106B234C2C1406E2F553073FF557D2DB6C5")] 
```

感谢@Joe

获取好友程序集的公钥：

```
sn -Tp path\to\assembly\MyFriendAssembly.dll 
```

在 Developper 命令提示符内（启动 > 程序 > Visual Studio 2015 > Visual Studio 工具 > VS2015 的开发人员命令提示符）。感谢@Ian G。

虽然，在完成上述操作之后，它对我有用的最后一点是签署我的朋友库项目，就像签署要共享的库项目一样。由于它是一个新的测试库，它还没有签名。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-08T00:10:49.373

另一种可能难以追踪的可能性，取决于您的代码是如何编写的。

1.  您正在从另一个程序集 Y 调用 X 中定义的内部方法
2.  方法签名使用 Z 中定义的内部类型
3.  然后您必须在 X 和 Z 中添加 [InternalsVisibleTo]

例如：

```
// In X
internal static class XType
{
    internal static ZType GetZ() { ... }
}

// In Y:
object someUntypedValue = XType.GetZ();

// In Z:
internal class ZType { ... } 
```

如果您按照上面的方式编写，在将 Y 添加为 X 的朋友之后，您没有直接在 Y 中引用 ZType，您可能会感到困惑，为什么您的代码仍然无法编译。

在这种情况下，编译错误肯定会更有帮助。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-10-19T00:25:44.540

我写这篇文章是出于沮丧。确保您授予访问权限的程序集按预期命名。

我重命名了我的项目，但这不会自动更新程序集名称。右键单击您的项目，然后单击*Properties*。在*Application*下，确保**Assembly Name**和**Default Namespace**是您所期望的。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-11-25T11:34:43.130

仅当您希望将未签名的程序集保留为未签名的程序集时才适用（并且出于多种原因不想对其进行签名）：

还有一点：如果您将基础库从 VS.Net 编译到本地目录，它可能会按预期工作。

但是：一旦您将基础库编译到网络驱动器，就会应用安全策略，并且无法成功加载程序集。这再次导致 VS.NET 或编译器在检查 PublicKey 匹配时失败。

最后，可以使用未签名的程序集： [https](https://msdn.microsoft.com/en-us/library/bb384966.aspx) ://msdn.microsoft.com/en-us/library/bb384966.aspx 您必须确保两个程序集都没有签名并且程序集属性必须没有 PublicKey 信息：

`<Assembly: InternalsVisibleTo("friend_unsigned_B")>`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-03-29T14:00:50.667

如果您有超过 1 个引用的程序集 - 检查所有必要的程序集是否具有 InternalsVisibleTo 属性。有时并不明显，也没有消息表明您必须将此属性添加到其他程序集中。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-03-29T15:50:16.743

我有同样的问题。没有一个解决方案奏效。

最终发现问题是由于 X 类显式实现了内部接口 Y。

X.InterfaceMethod 方法不可用，但我不知道为什么。

解决方案是在测试库中强制转换 (X as YourInterface).InterfaceMethod，然后一切正常。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-12-03T11:50:17.563

**1- 对测试项目进行签名：**在 Visual Studio 中，转到**测试项目**的属性窗口，并通过在“**签名**”选项卡中选中具有相同短语的复选框来**对程序集**进行签名。

 ****2- 为测试项目创建公钥：**打开 Visual Studio 命令提示符（例如 VS 2017 的开发人员命令提示符）。转到**测试项目**的 .dll 文件所在的文件夹。通过 sn.exe 创建公钥：

sn -Tp TestProject.dll

请注意，参数是-Tp，而不是-tp。

**3- 将PublicKey引入待测项目：进入****待测**项目的AssemblyInfo.cs文件，在上一步创建的PublicKey中加入这一行：

[组件：InternalsVisibleTo（” **TestProjectAssemblyName**，**公钥**= 2066212d128683a85f31645c60719617ba512c0bfdba6791612ed56350368f6cc40a17b4942ff16cda9e760684658fa3f357c137a1005b04cb002400000480000094000000060200000024000052534131000400000100010065fe67a14eb30ffcdd99880e9d725f04e5c720dffc561b23e2953c34db8b7c5d4643f476408ad1b1e28d6bde7d64279b0f51bf0e60be2d383a6c497bf27307447506b746bd2075" ）]

不要忘记将上面的 PublicKey 替换为您的。

**4- 将私有方法设为内部：**在要测试的项目中，将方法的访问修饰符更改为内部。

**内部静态**无效 DoSomething(){...}

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-04-26T18:25:51.517

附带说明一下，如果您想轻松获得公钥而无需使用 sn 并找出其选项，您可以在[此处](http://www.davidarno.org/2008/01/15/c-and-friend-assemblies-made-easy/)下载方便的程序。它不仅确定公钥，还创建“程序集：InternalsVisibleTo...”行，准备好复制到剪贴板并粘贴到您的代码中。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-02-26T09:20:02.417

`InternalsVisibleTo`我刚刚用属性解决了一个类似的问题。一切似乎都正确，我不明白为什么我瞄准的内部课程仍然无法访问。

将键的大小写从大写更改为小写解决了该问题。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-11-17T15:16:55.157

尽管使用`AssemblyInfo`文件并添加`InternalsVisibleTo`仍然有效，但现在（据我所知）首选方法是`ItemGroup`在您的项目`csproj`文件中使用 an ，如下所示：

```
 <ItemGroup>
        <InternalsVisibleTo Include="My.Project.Tests" />
    </ItemGroup> 
```

如果需要 PublicKey，也可以添加该属性。

# html - 在 HTML 中加载图像之前获取图像高度

> ID：106886
> 
> 赞同：2
> 
> 时间：2008-09-20T03:03:11.690
> 
> 标签：html, image

我有一个使用 DIV 动态创建的表。表格的每一行都有两个图像。我想将 div 的高度（表示特定行）设置为图像的高度，该高度大于该特定行中显示的两个图像。要显示的图像将始终更改，并且它们来自外部服务器。

如何设置我的 div 的高度以适应图像？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T16:43:18.520

如果您尝试动态调整表格中一行中的几个 div 的大小，则最好使用 html 表格并将每个图像放在 td 标记中。这将使 tr 标签为每个单元格中的图像相应地调整大小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-24T23:43:19.537

```
 this.img = new Image();
  this.img.src = url;
  alert(this.img.width); 
```

给出宽度，而

```
 var img = new Image();
  img.src = url;
  alert(img.width); 
```

不..

不知道为什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T03:15:52.300

你可以：

1.  不指定div的高度，让它自动展开
2.  加载图像后，请执行以下操作：

    document.getElementById("myDiv").height = document.getElementById("myImage").height

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T03:13:56.423

将它们预加载到 javascript 图像对象中，然后仅引用高度和宽度。

可能需要一些聪明的魔鬼才能在所有浏览器中工作......

```
function getSize(imgSrc){

    var aImg = new Image();

    aImg.src = imgSrc;

    aHeight = newImg.height;
    aWidth = newImg.width;

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T03:17:28.397

我们需要更多信息才能非常有用。[您可以在页面加载后通过 Javascript ( info](http://www.w3schools.com/htmldom/dom_obj_image.asp) )获取图像的高度和宽度，然后您可以在加载后调整 div 的高度。否则，你真的很不走运，因为 HTML 本身没有任何东西。

如果您使用 PHP，则可以使用[getimagesize()](http://us3.php.net/manual/en/function.getimagesize.php)，如果您使用 PHP 动态构建站点，则可以使用它。其他语言也有类似的功能，但我们需要更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T05:12:42.440

如果您希望浏览器根据图像的高度进行布局，则在它获取图像之前，您需要将该高度发送到浏览器的某个位置。这将需要一些服务器端的东西。最快的方法是直接插入到 html 中。更慢但更优雅的是使用 <script src=> 语句逐个图像地获取它，这些语句从一个特殊的 javascript 生成 cgi 中获取指令。（速度差异来自网络往返。）

如果您愿意在数据到达后调整大小，那就简单多了。要么在图像上添加一个 onload 处理程序，要么将它们粘贴在正常的 dom 中（例如，一个实际的表格，尽管您可以使用 div 和 css 来完成）并让布局引擎完成工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T00:14:16.160

这个问题已经通过多种方式得到了回答，您还提出了附加问题“这不会让 UI 看起来很糟糕吗？”

这个问题的答案是肯定的。在大多数情况下，最好的做法是将 div 的高度设置为看起来不错的值，然后缩小图像以适应。这将使渲染速度更快，最终产品看起来更好、更专业。

但这只是我自己的看法。我没有经验数据来支持这一点。

# python - 跨文件组织的 Python 类的可能性？

> ID：106896
> 
> 赞同：292
> 
> 时间：2008-09-20T03:07:01.870
> 
> 标签：python, class, project-structure

我习惯了 Java 模型，每个文件可以有一个公共类。Python 没有这个限制，我想知道组织类的最佳实践是什么。

* * *

## 回答 #1

> 赞同：353
> 
> 时间：2008-09-20T10:27:39.860

Python 文件称为“模块”，它是组织软件的一种方式，以使其“有意义”。另一个是目录，称为“包”。

一个模块是一个独特的东西，可能有一个或两个密切相关的类。诀窍是模块是您将要导入的东西，并且您需要该导入对于将阅读、维护和扩展您的软件的人来说是完全明智的。

规则是这样**的：模块是重用单元**。

你不能轻易地重用一个类。您应该能够毫无困难地重用模块。您库中的所有内容（以及您下载和添加的所有内容）要么是一个模块，要么是一个模块包。

例如，您正在处理读取电子表格、进行一些计算并将结果加载到数据库中的东西。你希望你的主程序是什么样的？

```
from ssReader import Reader
from theCalcs import ACalc, AnotherCalc
from theDB import Loader

def main( sourceFileName ):
    rdr= Reader( sourceFileName )
    c1= ACalc( options )
    c2= AnotherCalc( options )
    ldr= Loader( parameters )
    for myObj in rdr.readAll():
        c1.thisOp( myObj )
        c2.thatOp( myObj )
        ldr.laod( myObj ) 
```

将导入视为将代码组织成概念或块的方式。每个导入中有多少类并不重要。重要的是你用你的`import`陈述描绘的整体组织。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-20T03:11:04.807

既然没有人为的限制，那真的要看什么是可以理解的。如果你有一堆在逻辑上组合在一起的相当短、简单的类，那就扔进一堆。如果您有大型、复杂的类或作为一个组没有意义的类，请为每个类创建一个文件。或者选择介于两者之间的东西。随着事情的变化进行重构。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2011-10-24T16:50:01.740

我碰巧喜欢 Java 模型，原因如下。将每个类放在一个单独的文件中，通过使浏览源代码时更容易看到类来促进重用。如果您将一堆类分组到一个文件中，那么其他开发人员可能不会很明显地通过浏览项目的*目录结构*就可以重用那里的类。因此，如果你认为你的类可能被重用，我会把它放在它自己的文件中。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-30T06:57:32.723

这完全取决于项目有多大，类有多长，是否会从其他文件中使用它们等等。

例如，我经常使用一系列类进行数据抽象——所以我可能有 4 或 5 个可能只有 1 行长的类 ( `class SomeData: pass`)。

将它们中的每一个拆分成单独的文件会很愚蠢 - 但由于它们可能会从不同的文件中使用，所以将所有这些放在一个单独的`data_model.py`文件中是有意义的，所以我可以这样做`from mypackage.data_model import SomeData, SomeSubData`

如果你有一个包含大量代码的类，可能只有它使用的一些函数，最好将这个类和辅助函数拆分到一个单独的文件中。

您应该构建它们以便您这样做`from mypackage.database.schema import MyModel`，而不是`from mypackage.email.errors import MyDatabaseModel`- 如果您从哪里导入东西是有意义的，并且文件不是数万行长，那么您已经正确组织了它。

[Python Modules 文档](http://www.python.org/doc/2.5.2/tut/node8.html#SECTION008400000000000000000)有一些关于组织包的有用信息。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-11-11T18:49:05.837

当我对文件的庞大感到恼火并且当相关性的理想结构开始自然出现时，我发现自己正在分裂。通常这两个阶段似乎是重合的。

如果你过早拆分事情可能会很烦人，因为你开始意识到需要完全不同的结构顺序。

另一方面，当任何 .java 或 .py 文件的行数超过 700 行时，我开始感到恼火，不断地试图记住“那个特定的位”在哪里。

使用 Python/Jython 的 import 语句的循环依赖似乎也起作用：如果您尝试将太多协作的基本构建块拆分到单独的文件中，这种语言的“限制”/“不完美”似乎会迫使您将事物分组，也许以一种相当明智的方式。

至于拆分成包，我真的不知道，但我想说的是，可能同样的烦恼和快乐结构的出现规则适用于所有级别的模块化。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-20T03:08:45.187

我会说在该文件中放置尽可能多的类，而不会使其太大和复杂。

# c# - 使代码内部化，但可用于其他项目的单元测试

> ID：106907
> 
> 赞同：138
> 
> 时间：2008-09-20T03:10:29.083
> 
> 标签：c#, unit-testing, scope

我们将所有的单元测试放在他们自己的项目中。我们发现我们必须将某些类公开而不是仅用于单元测试的内部类。无论如何要避免这样做。使类公开而不是密封的内存含义是什么？

* * *

## 回答 #1

> 赞同：218
> 
> 时间：2008-09-20T03:24:33.357

如果您使用.NET，[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)程序集属性允许您创建“朋友”程序集。这些是特定的强命名程序集，允许访问其他程序集的内部类和成员。

请注意，这应该谨慎使用，因为它紧密耦合了所涉及的程序集。InternalsVisibleTo 的一个常见用途是用于单元测试项目。由于上述原因，在您的实际应用程序程序集中使用它可能不是一个好的选择。

**例子：**

```
[assembly: InternalsVisibleTo("NameAssemblyYouWantToPermitAccess")]
namespace NameOfYourNameSpace
{ 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-20T03:22:53.407

如果它是一个内部类，那么它一定不能被孤立地使用。因此，除了测试在内部使用该对象的其他类之外，您不应该真正测试它。

正如您不应该测试类的私有成员一样，您也不应该测试 DLL 的内部类。这些类是一些可公开访问的类的实现细节，因此应该通过其他单元测试很好地练习。

这个想法是您只想测试一个类的行为，因为如果您测试内部实现细节，那么您的测试将会很脆弱。您应该能够在不破坏所有测试的情况下更改任何类的实现细节。

如果您发现您确实需要测试该类，那么您可能需要重新检查为什么该类首先是内部的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-23T05:45:50.863

用于文档目的

或者，您可以使用`Type.GetType`方法实例化内部类

例子

```
//IServiceWrapper is public class which is 
//the same assembly with the internal class 
var asm = typeof(IServiceWrapper).Assembly;
//Namespace.ServiceWrapper is internal
var type = asm.GetType("Namespace.ServiceWrapper");
return (IServiceWrapper<T>)Activator
    .CreateInstance(type, new object[1] { /*constructor parameter*/ }); 
```

对于泛型类型，有如下不同的过程：

```
var asm = typeof(IServiceWrapper).Assembly;
//note the name Namespace.ServiceWrapper`1
//this is for calling Namespace.ServiceWrapper<>
var type = asm.GetType("Namespace.ServiceWrapper`1");
var genType = type.MakeGenericType(new Type[1] { typeof(T) });
return (IServiceWrapper<T>)Activator
     .CreateInstance(genType, new object[1] { /*constructor parameter*/}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2021-04-27T10:46:40.873

以下是在**.NET Core**应用程序中使用的方法。

1.  添加**AssemblyInfo.cs**文件并添加`[assembly: InternalsVisibleTo("AssemblytoVisible")]`
2.  将此添加到**.csproj**文件*（包含内部类的项目）*

```
<ItemGroup>
  <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleTo">
    <_Parameter1>Test_Project_Name</_Parameter1> <!-- The name of the project that you want the Internal class to be visible To it -->
  </AssemblyAttribute>
</ItemGroup> 
```

有关更多信息，请关注[https://improveandrepeat.com/2019/12/how-to-test-your-internal-classes-in-c/](https://improveandrepeat.com/2019/12/how-to-test-your-internal-classes-in-c/)

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2008-09-20T03:20:03.883

类既可以是公开的，也可以是密封的。

但是，不要那样做。

您可以创建一个工具来反射内部类，并发出一个通过反射访问所有内容的新类。MSTest 就是这样做的。

编辑：我的意思是，如果您不想在原始程序集中包含任何测试内容；如果成员是私人的，这也适用。

# winforms - 如何使用 Windows 窗体在窗口标题栏中绘制自定义按钮？

> ID：106912
> 
> 赞同：7
> 
> 时间：2008-09-20T03:12:42.200
> 
> 标签：winforms, winapi, windows-vista, wndproc, titlebar

如何在表单标题栏中的最小化、最大化和关闭按钮旁边绘制自定义按钮？

我知道您需要使用 Win32 API 调用并覆盖 WndProc 过程，但我无法找到一个正确的解决方案。

有谁知道如何做到这一点？更具体地说，有没有人知道在 Vista 中可以做到这一点的方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T06:49:21.507

以下将在 XP 中工作，我没有方便的 Vista 机器来测试它，但我认为你的问题是由于某种不正确的 hWnd 造成的。无论如何，继续使用注释不佳的代码。

```
// The state of our little button
ButtonState _buttState = ButtonState.Normal;
Rectangle _buttPosition = new Rectangle();

[DllImport("user32.dll")]
private static extern IntPtr GetWindowDC(IntPtr hWnd);
[DllImport("user32.dll")]
private static extern int GetWindowRect(IntPtr hWnd, 
                                        ref Rectangle lpRect);
[DllImport("user32.dll")]
private static extern int ReleaseDC(IntPtr hWnd, IntPtr hDC);
protected override void WndProc(ref Message m)
{
    int x, y;
    Rectangle windowRect = new Rectangle();
    GetWindowRect(m.HWnd, ref windowRect);

    switch (m.Msg)
    {
        // WM_NCPAINT
        case 0x85:
        // WM_PAINT
        case 0x0A:
            base.WndProc(ref m);

            DrawButton(m.HWnd);

            m.Result = IntPtr.Zero;

            break;

        // WM_ACTIVATE
        case 0x86:
            base.WndProc(ref m);
            DrawButton(m.HWnd);

            break;

        // WM_NCMOUSEMOVE
        case 0xA0:
            // Extract the least significant 16 bits
            x = ((int)m.LParam << 16) >> 16;
            // Extract the most significant 16 bits
            y = (int)m.LParam >> 16;

            x -= windowRect.Left;
            y -= windowRect.Top;

            base.WndProc(ref m);

            if (!_buttPosition.Contains(new Point(x, y)) && 
                _buttState == ButtonState.Pushed)
            {
                _buttState = ButtonState.Normal;
                DrawButton(m.HWnd);
            }

            break;

        // WM_NCLBUTTONDOWN
        case 0xA1:
            // Extract the least significant 16 bits
            x = ((int)m.LParam << 16) >> 16;
            // Extract the most significant 16 bits
            y = (int)m.LParam >> 16;

            x -= windowRect.Left;
            y -= windowRect.Top;

            if (_buttPosition.Contains(new Point(x, y)))
            {
                _buttState = ButtonState.Pushed;
                DrawButton(m.HWnd);
            }
            else
                base.WndProc(ref m);

            break;

        // WM_NCLBUTTONUP
        case 0xA2:
            // Extract the least significant 16 bits
            x = ((int)m.LParam << 16) >> 16;
            // Extract the most significant 16 bits
            y = (int)m.LParam >> 16;

            x -= windowRect.Left;
            y -= windowRect.Top;

            if (_buttPosition.Contains(new Point(x, y)) &&
                _buttState == ButtonState.Pushed)
            {
                _buttState = ButtonState.Normal;
                // [[TODO]]: Fire a click event for your button 
                //           however you want to do it.
                DrawButton(m.HWnd);
            }
            else
                base.WndProc(ref m);

            break;

        // WM_NCHITTEST
        case 0x84:
            // Extract the least significant 16 bits
            x = ((int)m.LParam << 16) >> 16;
            // Extract the most significant 16 bits
            y = (int)m.LParam >> 16;

            x -= windowRect.Left;
            y -= windowRect.Top;

            if (_buttPosition.Contains(new Point(x, y)))
                m.Result = (IntPtr)18; // HTBORDER
            else
                base.WndProc(ref m);

            break;

        default:
            base.WndProc(ref m);
            break;
    }
}

private void DrawButton(IntPtr hwnd)
{
    IntPtr hDC = GetWindowDC(hwnd);
    int x, y;

    using (Graphics g = Graphics.FromHdc(hDC))
    {
        // Work out size and positioning
        int CaptionHeight = Bounds.Height - ClientRectangle.Height;
        Size ButtonSize = SystemInformation.CaptionButtonSize;
        x = Bounds.Width - 4 * ButtonSize.Width;
        y = (CaptionHeight - ButtonSize.Height) / 2;
        _buttPosition.Location = new Point(x, y);

        // Work out color
        Brush color;
        if (_buttState == ButtonState.Pushed)
            color = Brushes.LightGreen;
        else
            color = Brushes.Red;

        // Draw our "button"
        g.FillRectangle(color, x, y, ButtonSize.Width, ButtonSize.Height);
    }

    ReleaseDC(hwnd, hDC);
}

private void Form1_Load(object sender, EventArgs e)
{
    _buttPosition.Size = SystemInformation.CaptionButtonSize;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T10:05:04.687

我知道距离上一个答案已经很久了，但这最近对我很有帮助，我喜欢用我的评论和修改来更新 Chris 提供的代码。该版本在 Win XP 和 Win 2003 上完美运行。在 Win 2008 ot 上有一个小错误，我在调整窗口大小时无法识别。也可以在 Vista 上工作（无 Aero），但请注意标题栏按钮不是方形的，按钮尺寸应考虑到这一点。

```
 switch (m.Msg)
            {
                // WM_NCPAINT / WM_PAINT        
                case 0x85:
                case 0x0A:
                    //Call base method
                    base.WndProc(ref m);
                    //we have 3 buttons in the corner of the window. So first's new button left coord is offseted by 4 widths
                    int crt = 4;
                    //navigate trough all titlebar buttons on the form
                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        //Calculate button coordinates
                        p.X = (Bounds.Width - crt * crtBtn.Size.Width);
                        p.Y = (Bounds.Height - ClientRectangle.Height - crtBtn.Size.Height) / 2;
                        //Initialize button and draw
                        crtBtn.Location = p;
                        crtBtn.ButtonState = ImageButtonState.NORMAL;
                        crtBtn.DrawButton(m.HWnd);
                        //increment button left coord location offset
                        crt++;
                    }
                    m.Result = IntPtr.Zero;
                    break;
                // WM_ACTIVATE      
                case 0x86:
                    //Call base method
                    base.WndProc(ref m);
                    //Draw each button
                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        crtBtn.ButtonState = ImageButtonState.NORMAL;
                        crtBtn.DrawButton(m.HWnd);
                    }
                    break;
                // WM_NCMOUSEMOVE        
                case 0xA0:
                    //Get current mouse position
                    p.X = ((int)m.LParam << 16) >> 16;// Extract the least significant 16 bits            
                    p.Y = (int)m.LParam >> 16;        // Extract the most significant 16 bits          
                    p.X -= windowRect.Left;
                    p.Y -= windowRect.Top;

                    //Call base method
                    base.WndProc(ref m);

                    ImageButtonState newButtonState;
                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        if (crtBtn.HitTest(p))
                        {//mouse is over the current button
                            if (crtBtn.MouseButtonState == MouseButtonState.PRESSED)
                                //button is pressed - set pressed state
                                newButtonState = ImageButtonState.PRESSED;
                            else
                                //button not pressed - set hoover state
                                newButtonState = ImageButtonState.HOOVER;
                        }
                        else
                        {
                            //mouse not over the current button - set normal state
                            newButtonState = ImageButtonState.NORMAL;
                        }

                        //if button state not modified, do not repaint it.
                        if (newButtonState != crtBtn.ButtonState)
                        {
                            crtBtn.ButtonState = newButtonState;
                            crtBtn.DrawButton(m.HWnd);
                        }
                    }
                    break;
                // WM_NCLBUTTONDOWN     
                case 0xA1:
                    //Get current mouse position
                    p.X = ((int)m.LParam << 16) >> 16;// Extract the least significant 16 bits
                    p.Y = (int)m.LParam >> 16;        // Extract the most significant 16 bits      
                    p.X -= windowRect.Left;
                    p.Y -= windowRect.Top;

                    //Call base method
                    base.WndProc(ref m);

                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        if (crtBtn.HitTest(p))
                        {
                            crtBtn.MouseButtonState = MouseButtonState.PRESSED;
                            crtBtn.ButtonState = ImageButtonState.PRESSED;
                            crtBtn.DrawButton(m.HWnd);
                        }
                    }
                    break;
                // WM_NCLBUTTONUP   
                case 0xA2:
                case 0x202:
                    //Get current mouse position
                    p.X = ((int)m.LParam << 16) >> 16;// Extract the least significant 16 bits   
                    p.Y = (int)m.LParam >> 16;        // Extract the most significant 16 bits 
                    p.X -= windowRect.Left;
                    p.Y -= windowRect.Top;

                    //Call base method
                    base.WndProc(ref m);
                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        //if button is press
                        if (crtBtn.ButtonState == ImageButtonState.PRESSED)
                        {
                            //Rasie button's click event
                            crtBtn.OnClick(EventArgs.Empty);

                            if (crtBtn.HitTest(p))
                                crtBtn.ButtonState = ImageButtonState.HOOVER;
                            else
                                crtBtn.ButtonState = ImageButtonState.NORMAL;
                        }

                        crtBtn.MouseButtonState = MouseButtonState.NOTPESSED;
                        crtBtn.DrawButton(m.HWnd);
                    }
                    break;
                // WM_NCHITTEST    
                case 0x84:
                    //Get current mouse position
                    p.X = ((int)m.LParam << 16) >> 16;// Extract the least significant 16 bits
                    p.Y = (int)m.LParam >> 16;        // Extract the most significant 16 bits
                    p.X -= windowRect.Left;
                    p.Y -= windowRect.Top;

                    bool isAnyButtonHit = false;
                    foreach (TitleBarImageButton crtBtn in titleBarButtons.Values)
                    {
                        //if mouse is over the button, or mouse is pressed 
                        //(do not process messages when mouse was pressed on a button)
                        if (crtBtn.HitTest(p) || crtBtn.MouseButtonState == MouseButtonState.PRESSED)
                        {
                            //return 18 (do not process further)
                            m.Result = (IntPtr)18;
                            //we have a hit
                            isAnyButtonHit = true;
                            //return 
                            break;
                        }
                        else
                        {//mouse is not pressed and not over the button, redraw button if needed  
                            if (crtBtn.ButtonState != ImageButtonState.NORMAL)
                            {
                                crtBtn.ButtonState = ImageButtonState.NORMAL;
                                crtBtn.DrawButton(m.HWnd);
                            }
                        }
                    }
                    //if we have a hit, do not process further
                    if (!isAnyButtonHit)
                        //Call base method
                        base.WndProc(ref m);
                    break;
                default:
                    //Call base method
                    base.WndProc(ref m);
                    //Console.WriteLine(m.Msg + "(0x" + m.Msg.ToString("x") + ")");
                    break;
            } 
```

该代码演示了需要处理的消息以及如何处理它们。该代码使用自定义 TitleBarButton 对象的集合。该类太大而无法包含在此处，但如果需要，我可以提供它以及一个示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T05:09:31.980

绘图似乎是容易的部分，以下将做到这一点：

[编辑：代码已删除，请参阅我的其他答案]

真正的问题是改变状态并检测按钮的点击......为此，您需要挂钩到程序的全局消息处理程序，.NET 似乎隐藏了表单的鼠标事件，而不是在实际容器中区域（即鼠标移动并单击标题栏）。我正在寻找这方面的信息，现在找到了，我正在努力，应该不会太难......如果我们能弄清楚这些消息实际上传递的是什么。

# ruby - 如何在 ruby 回溯中获取源值和变量值？

> ID：106920
> 
> 赞同：8
> 
> 时间：2008-09-20T03:15:54.610
> 
> 标签：ruby, debugging, exception, traceback

这是典型的 Ruby on Rails 回溯的最后几帧： ![应用程序跟踪](https://i.stack.imgur.com/plGxn.png)

以下是 Python 中典型的 Nevow 回溯的最后几帧： ![替代文字](https://i.stack.imgur.com/Jn4Le.png)

不只是 web 环境，你可以在 ipython 和 irb 之间进行类似的比较。如何在 Ruby 中获得更多此类细节？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T07:10:39.723

AFAIK，一旦发现异常，就为时已晚，无法获取引发异常的上下文。如果你捕获异常的新调用，你可以使用 evil.rb 的 Binding.of_caller 来获取调用范围，然后执行

```
eval("local_variables.collect { |l| [l, eval(l)] }", Binding.of_caller) 
```

但这是一个相当大的黑客。正确的答案可能是扩展 Ruby 以允许对调用堆栈进行一些检查。我不确定某些新的 Ruby 实现是否允许这样做，但我确实记得对 Binding.of_caller 的强烈反对，因为它会使优化变得更加困难。

（老实说，我不理解这种强烈反对：只要解释器​​记录了有关所执行优化的足够信息，Binding.of_caller 就应该能够工作，尽管可能很慢。）

# 更新

好的，我想通了。长代码如下：

```
class Foo < Exception
  attr_reader :call_binding

  def initialize
    # Find the calling location
    expected_file, expected_line = caller(1).first.split(':')[0,2]
    expected_line = expected_line.to_i
    return_count = 5  # If we see more than 5 returns, stop tracing

    # Start tracing until we see our caller.
    set_trace_func(proc do |event, file, line, id, binding, kls|
      if file == expected_file && line == expected_line
        # Found it: Save the binding and stop tracing
        @call_binding = binding
        set_trace_func(nil)
      end

      if event == :return
        # Seen too many returns, give up. :-(
        set_trace_func(nil) if (return_count -= 1) <= 0
      end
    end)
  end
end

class Hello
  def a
    x = 10
    y = 20
    raise Foo
  end
end
class World
  def b
    Hello.new.a
  end
end

begin World.new.b
rescue Foo => e
  b = e.call_binding
  puts eval("local_variables.collect {|l| [l, eval(l)]}", b).inspect
end 
```

# database - 共享文件数据库建议

> ID：106931
> 
> 赞同：1
> 
> 时间：2008-09-20T03:19:15.913
> 
> 标签：database, windows

我想为基于 Windows 的系统构建和部署数据库应用程序，但需要遵守以下限制：

1.  不能作为服务器运行（即，有开放的端口）；
2.  必须能够与程序的其他实例共享数据库文件（在其他机器上运行）；
3.  不得要求 DBA 进行维护；
4.  运行时许可证无需额外费用。

此外，以下是很好的“功能”：

1.  零安装（例如，没有注册表项，无需将文件放在 \Windows\... 等）；
2.  “合理”的表现（是的，这是模糊的）；
3.  “合理”的文件大小限制（每个表/文件至少 1GB——以防万一）。

我已经看到这个问题
  Embedded Database for .net 可以在网络上运行，
但它并不能完全回答我。

我看过[VistaDB 站点](http://www.vistadb.net/)，虽然它看起来很有希望，但我没有个人经验。

我也看过[SQLite](http://www.sqlite.org/)，虽然它对 Goggle 来说似乎已经足够好了，但我（再次）没有个人经验。

我喜欢使用基于 Java 的解决方案，因为它是跨平台的（尽管我的主要目标是 Windows，但我想灵活一点）而且 WebStart 是一种非常好的分发软件的方式，但最常用的 DB（Derby和 hsqldb) 将不支持共享访问。

我知道我不是唯一一个试图/试图这样做的人，所以我希望我能得到一些建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T03:23:15.700

我会选择 SQLite。一切都有 SQLite 绑定，它被广泛用作大量应用程序的嵌入式数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T03:47:22.910

我在工作中使用 SQLite，你应该记住的一件事是它基于文件并使用文件锁来管理并发连接。当您有多个用户尝试同时使用数据库时，这不是一个很好的解决方案。然而，对于一个用户应用程序来说，SQLite 是一个很棒的数据库，它速度快，占用空间小，并且围绕它建立了一个蓬勃发展的社区。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T05:41:49.127

如果您有 VStudio，那么 SQL Server 3.5 Compact 版本怎么样？MSSQL 在进程内运行。

[http://www.microsoft.com/sql/editions/compact/downloads.mspx](http://www.microsoft.com/sql/editions/compact/downloads.mspx)

# c# - 我应该默认使用内部可见性还是公共可见性？

> ID：106941
> 
> 赞同：42
> 
> 时间：2008-09-20T03:21:55.530
> 
> 标签：c#, .net, public, internals

我是一个相当新的 C# 和 .NET 开发人员。我最近使用 C# 创建了一个 MMC 管理单元，并且对它的简单性感到满意，尤其是在我的组织中的一些其他开发人员听到很多关于用 C++ 执行它有多难的恐怖故事之后。

我几乎在某个时候完成了整个项目，并将“public”关键字的每个实例都设置为“internal”，除非运行时需要运行管理单元。您对此有何感想，您通常应该将类和方法公开还是内部？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-20T03:25:50.560

我相信尽可能使用黑盒。作为一名程序员，我想要一个定义明确的黑盒，我可以轻松地将它放入我的系统中并让它工作。我给它赋值，调用适当的方法，然后从中取回我的结果。

为此，只给我类需要公开工作的功能。

考虑电梯。为了让它去楼层，我按下一个按钮。那是黑匣子的公共接口，它激活了将电梯带到所需楼层所需的所有功能。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T03:39:33.163

你所做的正是你应该做的；为您的班级提供尽可能低的知名度。哎呀，如果你真的想全心全意，你可以（最多）做*所有事情* `internal`并使用[`InternalsVisibleTo`属性](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.internalsvisibletoattribute)，这样你就可以分离你的功能，但仍然不会将它暴露给未知的外部世界。

公开的唯一原因是您将项目打包在多个 DLL 和/或 EXE 中，并且（无论出于何种原因）您不想使用`InternalsVisibleTo`，或者您正在创建一个供第三方使用的库。但即使在供第三方使用的库中，您也应该尽可能减少“表面积”；您可用的课程越多，您的图书馆就越混乱。

在 C# 中，确保您使用尽可能低的可见性的一种好方法是在您需要它们之前不使用可见性修饰符。C# 中的所有内容都默认为尽可能低的可见性：类内部的，类成员和内部类的私有。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-20T03:32:53.647

我认为你应该在内部类和成员方面犯错。您始终可以增加项目的可见性，但降低它可能会导致问题。如果您正在为其他人构建框架，则尤其如此。

您确实需要小心，但不要向用户隐藏有用的功能。.NET BCL 中有许多有用的方法，如果不借助反射就无法使用。然而，通过隐藏这些方法，减少了必须测试和维护的表面积。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-20T03:30:24.747

我更喜欢避免标记类，`public`除非我明确希望我的客户使用它们，并且我准备支持它们。

我没有将类标记为`internal`，而是将可访问性留空。这样一来，`public`就显得格外引人注目。（当然，嵌套类除外，如果它们即使在同一个程序集中也可见，则必须对其进行标记。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-01T18:15:02.063

大多数类应该是`internal`，但大多数非私有成员应该是`public`。

关于成员，您应该问的问题是“如果创建了课程，`public`我是否想让成员成员暴露？”。答案通常是“是（所以`public`）”，因为没有任何可访问成员的类没有多大用处！ `internal`成员确实有作用；它们是“后门访问”，仅适用于居住在同一个集会中的近亲。

即使您的班级仍然是内部的，也很高兴看到哪些是前门成员，哪些是后门成员。而且，如果您将其更改为公开，您将不必回过头来考虑哪些是哪些。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T03:28:07.747

您应该倾向于尽可能少地向其他课程公开，并仔细考虑您公开的内容和原因。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T03:36:39.457

您是否有任何理由需要使用内部而不是私有？您确实意识到 Internal 具有装配级别范围。换句话说，多类程序集中的所有类都可以访问内部类/成员。

正如其他一些答案所说，除非您实际上需要内部/受保护/公共，否则通常会尽可能地进行最高级别的封装（即私有）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-17T23:48:09.483

我发现尽可能**使用内部类的问题。**您不能让该类型（或参数类型或返回类型）的方法、属性、字段等比内部更可见。这导致具有内部的构造函数以及属性。这应该不是问题，但事实上，在使用 Visual Studio 和 xaml 设计器时，就会出现问题。**设计人员检测到误报错误是**因为方法不是公开的，用户控件属性似乎对设计人员不可见。我不知道其他人是否已经陷入了这样的问题......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-11-25T03:16:44.267

您应该尽量使它们尽可能可见，但正如上面 Mike 所说，这会导致 UserControls 出现问题，并将 VS Designer 与表单或其他 UserControls 上的这些控件一起使用。

因此，作为一般规则，将您未使用设计器添加的所有类和用户控件仅在需要时保持可见。但是，如果您要创建一个要在设计器中使用的 UserControl（即使它在同一个程序集中），您需要确保 UserControl 类、其默认构造函数以及任何属性和事件都是公开的设计师使用它。

我最近遇到了一个问题，设计人员会不断从 InitializeComponent() 方法中删除 this.myControl = new MyControl() 行，因为 UserControl MyControl 与其构造函数一起被标记为内部。

我认为这确实是一个错误，因为即使它们被标记为内部，它们仍然显示在工具箱中以添加到设计器中，要么 Microsoft 只需要显示带有公共构造函数的公共控件，要么他们需要使其与内部控件一起使用好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T03:26:40.107

这取决于您对使用它的代码的控制程度。在我的 Java 开发中，我默认将我所有的东西都公开为 final，因为 getter 很烦人。但是，我也可以随时更改代码库中的任何内容。过去，当我不得不向消费者发布代码时，我总是使用私有变量和 getter。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T03:29:57.853

我喜欢尽可能少地暴露事物。私有的、受保护的、内部的、公共的：为类、变量、属性和函数提供它们所需的最少可见性，以使所有内容仍能正常工作。

只有在有充分理由的情况下，我才会将某些东西的可见度提高到公开的链条上。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-04-15T22:37:21.317

到目前为止，我完全不同意答案。我觉得 internal 是一个可怕的想法，阻止另一个程序集继承您的类型，甚至在需要解决方法时使用您的内部类型。

今天，我不得不使用反射来访问 System.Data.DataTable 的内部（我必须快速构建一个数据表，无需所有检查），我不得不使用反射，因为不是单一类型我可以使用；它们都被标记为内部。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-15T20:17:14.480

默认情况下，类在 c# 中创建为内部：内部意味着：访问仅限于当前程序集。

请参阅 [http://msdn.microsoft.com/en-us/library/0b0thckt.aspx](http://msdn.microsoft.com/en-us/library/0b0thckt.aspx)

Good Article the defaults scope is internal: [http://www.c-sharpcorner.com/UploadFile/84c85b/default-scope-of-a-C-Sharp-class/](http://www.c-sharpcorner.com/UploadFile/84c85b/default-scope-of-a-C-Sharp-class/)

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-09-20T03:28:22.053

不要选择“默认”。选择最适合该特定类别的可见性需求的内容。在 Visual Studio 中选择新类时，模板将创建为：

```
class Class1
{
} 
```

这是私有的（因为没有指定范围）。您可以指定类的范围（或保留为私有）。应该有理由公开课程。

# inversion-of-control - Unity 框架对控制反转有用吗？

> ID：106956
> 
> 赞同：5
> 
> 时间：2008-09-20T03:27:30.853
> 
> 标签：inversion-of-control, unity-container

我使用[IoC](http://en.wikipedia.org/wiki/Inversion_of_control)已经有一段时间了，我很好奇是否应该使用微软的[Unity](http://msdn.microsoft.com/en-us/library/dd203101.aspx)框架（正式名称“Unity Application Block”）。有没有人有使用它的经验？所以我一直在将我的 IoC 容器代码从一个项目复制到另一个项目，但我认为使用标准的东西会更好。我认为 IoC 可以在保持基于组件的应用程序松散耦合方面产生巨大的差异，因此可以改变，但我绝不是 IoC 方面的专家，所以我很紧张切换到一个框架，它只会把我描绘成一个依赖我的角落终有一天会想要走开。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T04:22:04.397

我正在使用 Unity，没有任何实际问题。我知道一些 ALT.NET 类型的人警告 Unity，但我真的认为这只是因为 MS P&P 团队有编写过时软件的历史。Unity 还没有臃肿的 IMO 并且运行良好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-16T15:06:35.343

我查看了 Unity 框架，但发现它对于我的需求来说有点“太大”（不，我无法真正量化这一点，它似乎需要比我以前的其他框架更多的知识玩...这是不久前的事情，所以随着 Unity 的开发/改进，这种情况可能会发生变化）。

我当前的 IoC/依赖注入框架是[Ninject](http://www.ninject.org)。它很快，很快，我能够在大约两个小时内从阅读教程（大约 10 分钟）到在预先存在的项目中使用它。

如果您正在寻找一种干净的方式来进行依赖注入，我强烈建议您检查一下。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T03:36:44.870

我玩过 CompositeWPF（又名 Prism）——Composite 应用程序块的继任者。根据我的经验，与以前版本的 ObjectBuilder 相比，Unity 的效果要好得多。但是，您可以自行评估 IoC 框架并选择适合您需求的框架。

[Unity 教程和示例](http://www.pnpguidance.net/Category/Unity.aspx)

[Unity IoC 截屏视频](http://codebetter.com/blogs/david.hayden/archive/2008/02/22/unity-ioc-screencast.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-16T17:13:56.490

我会说坚持你认识的那个，直到你对它和整个概念有信心。之后，您将有更好的判断来选择满足您需求的框架。

# api - 如何从条形码编号中查找有关书籍的数据？

> ID：106963
> 
> 赞同：76
> 
> 时间：2008-09-20T03:28:34.360
> 
> 标签：api, language-agnostic, amazon, barcode

我正在构建世界上最简单的图书馆应用程序。我想要做的就是使用典型的扫描仪（它只是将条形码的数字输入到一个字段中）扫描一本书的 UPC（条形码），然后用它来查找关于这本书的数据......最低限度、标题、作者、出版年份，以及杜威十进制或国会图书馆目录号。

目标是打印一个带有卡片目录号的小贴纸（“书脊标签”），我可以贴在书脊上，然后我可以在我们公司图书馆的书架上按卡片目录号对书籍进行分类。这样，类似主题的书籍往往会彼此靠近，例如，如果您知道您正在寻找一本关于会计的书，您所要做的就是找到一些关于会计的书，然后您就会看到另外六本我们就在它旁边，方便浏览图书馆。

似乎有很多 Web API 可以做到这一点，包括亚马逊和国会图书馆。但这些都让我非常困惑。我真正想要的是一个更高级别的函数，它接受一个 UPC 条形码编号并返回有关这本书的一些基本数据。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-20T03:56:30.767

ISBNDB.com 上有一个非常简单的基于 Web 的解决方案，您可能想看看。

**编辑：**更新的 API 文档链接，现在也有第 2 版可用

[链接到这里的价格和等级](https://isbndb.com/isbn-database)

您可以在几分钟内启动并运行（这些示例来自 API v1）：

*   在网站上注册并获得使用 API 的密钥

*   试试这样的网址：

    `http://isbndb.com/api/books.xml?access_key=`*{你的钥匙}*`&index1=isbn&results=details&value1=9780143038092`

results=details 获取其他详细信息，包括卡目录号。

顺便说一句，通常条形码是 isbn10 或 isbn13 中的 isbn。如果您使用扫描仪并拾取 18 个号码，您只需删除最后 5 个号码。

这是一个示例响应：

```
<ISBNdb server_time="2008-09-21T00:08:57Z">
  <BookList total_results="1" page_size="10" page_number="1" shown_results="1">
    <BookData book_id="the_joy_luck_club_a12" isbn="0143038095">
      <Title>The Joy Luck Club</Title>
      <TitleLong/>
      <AuthorsText>Amy Tan, </AuthorsText>
      <PublisherText publisher_id="penguin_non_classics">Penguin (Non-Classics)</PublisherText>
      <Details dewey_decimal="813.54" physical_description_text="288 pages" language="" edition_info="Paperback; 2006-09-21" dewey_decimal_normalized="813.54" lcc_number="" change_time="2006-12-11T06:26:55Z" price_time="2008-09-20T23:51:33Z"/>
    </BookData>
  </BookList>
</ISBNdb> 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-04T05:12:17.107

注意：我是 LibraryThing 人，所以这是部分自我推销。

看看[这个 StackOverflow 答案](https://stackoverflow.com/questions/41469/how-to-fetch-a-book-title-from-an-isbn-number)，它涵盖了一些获取给定 ISBN 数据的好方法。

对于您的问题，亚马逊包含一个简单的 DDC（杜威）；谷歌没有。WorldCat API 可以，但您需要成为 OCLC 图书馆才能使用它。

ISBN/UPC 问题很复杂。如果您能找到它们，请首选 ISBN。大众市场平装本有时会在外面印上 UPC，而在里面印上 ISBN。

LibraryThing 成员已经开发了几页关于这个问题的页面，并努力将两者映射起来：

*   [http://www.librarything.com/wiki/index.php/UPC](http://www.librarything.com/wiki/index.php/UPC)
*   [http://www.librarything.com/wiki/index.php/CueCat:_ISBNs_and_Barcodes](http://www.librarything.com/wiki/index.php/CueCat:_ISBNs_and_Barcodes)

如果您从 Borders 购买，您图书的条形码将全部贴上它们自己的内部条形码（称为“BINC”）。最烦人的是，随着时间的推移，他们使用的任何胶水都变得越来越难以干净地去除。我知道没有可以转换它们的 API。LibraryThing 通过截屏来实现。

对于 API，我会选择亚马逊。LibraryThing 是一个很好的非 API 选项，通过查看其他版本的“作品”来解析 BINC 并为没有它们的书籍添加 DDC 和 LCC。

缺少的是标签部分。有人需要为此创建一个好的 PDF 模板。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-20T03:36:24.920

**编辑**如果你有 ISBN 会很容易。但是从 UPC 转换为 ISBN 并不像您想的那么容易。

这是来自[http://isbn.nu](http://isbn.nu)的一些 javascript 代码，它在脚本中完成

```
if (indexisbn.indexOf("978") == 0) {
   isbn = isbn.substr(3,9);
   var xsum = 0;
   var add = 0;
   var i = 0;
   for (i = 0; i < 9; i++) {
        add = isbn.substr(i,1);
        xsum += (10 - i) * add;
   }
   xsum %= 11;
   xsum = 11 - xsum;
   if (xsum == 10) { xsum = "X"; }
   if (xsum == 11) { xsum = "0"; }
   isbn += xsum;
} 
```

*但是，这有时*只会从 UPC 转换为 ISBN 。

您可能也想看看[条码扫描项目页面](http://www.eblong.com/zarf/bookscan/)- 一个人扫描书籍的旅程。

所以你知道[亚马逊网络服务](http://www.amazon.com/AWS-home-page-Money/b?ie=UTF8&node=3435361)。但这假设亚马逊有这本书并且已经在 UPC 中进行了扫描。

您也可以在[http://www.upcdatabase.com/item/ {UPC} 上尝试](http://www.upcdatabase.com/item/)[UPC 数据库](http://www.upcdatabase.com/)，但这也不完整 - 至少它正在增长..

到目前为止，国会数据库的库还没有包含 UPC（尽管它非常全面），并且更难实现自动化。

目前，您似乎必须自己编写此代码才能进行返回简单信息的高级查找（并尝试每个服务）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T03:57:09.613

听起来像是让一家小型软件公司为你做的工作......

更严重的是，有些服务提供了 ISBN 目录 www.literarymarketplace.com 的接口。

在 worldcat.com 上，您可以[使用 ISBN 创建一个 URL，该 URL](http://www.worldcat.org/links/default.jsp#isbn)将带您直接进入图书详细信息页面。该页面不是很有用，因为它仍然是 HTML 抓取来获取数据，但他们有一个链接可以以几种“标准”格式下载图书数据。

比如他们的演示书：[http](http://www.worldcat.org/isbn/9780060817084) ://www.worldcat.org/isbn/9780060817084 有一个“EndNote”格式的下载链接[http://www.worldcat.org/oclc/123348009?page=endnote&client=worldcat.org- detail_record](http://www.worldcat.org/oclc/123348009?page=endnote&client=worldcat.org-detailed_record)，您可以非常轻松地从该文件中获取数据。这与他们自己的 OCLC 号码相关联，而不是 ISBN，但转换的抓取并不难，而且他们可能还有一个很好的界面来做这件事。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T03:53:41.337

我的图书管理员妻子使用[http://www.worldcat.org/](http://www.worldcat.org/)，但他们关闭 ISBN。如果你能扫描它，你就是黄金。看了几本书，似乎UPC与ISBN相同或相关。

哦，[这些家伙](http://www.eblong.com/zarf/bookscan/#convert)有一个功能，可以将 UPC 转换为 ISBN。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T03:57:24.930

使用网站[Library Thing](http://www.librarything.com)，您可以扫描您的条形码（整个条形码，而不仅仅是 ISBN - 如果您有扫描“楔子”，那么您很幸运）并建立您的图书馆。（这是一个优秀的社交网络——想想看书爱好者的 StackOverflow。）

然后，使用工具部分，您可以导出您的库。现在您有一个要导入/解析的文本文件，并且可以创建您的标签、卡片目录等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T04:28:49.630

恐怕问题是数据库访问。公司为分配 UPC 而付费，因此该数据库不能免费访问。Philip 提到的[UPCdatabase](http://www.upcdatabase.com/)站点是一个开始，[UPCData.info](http://upcdata.info/)也是如此，但它们是用户输入的——这意味着不完整且可能不准确。

您始终可以在 UPC 中输入 Google 并获得成功，但这不是很自动化。但它确实在大多数情况下都是正确的。

我想我记得 Jon Udell 做过类似的事情（例如，[看这个](http://weblog.infoworld.com/udell/LibraryLookup)），但它纯粹是基于 ISBN 的。

看起来你已经找到了一个新的项目供某人工作！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-28T01:48:04.380

如果您想使用 Amazon，您可以使用[LINQ to Amazon](http://weblogs.asp.net/fmarguerie/archive/2006/06/26/introducing-linq-to-amazon.aspx)轻松实现它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-30T16:03:16.247

在图书馆界工作，我们只需连接到条形码中的 LMS 通道，然后很快就会返回数据。我相信有许多免费的 LMS 提供商——谷歌的“开源 lms”。

注意：这可能适用于 ISBN ......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-06-11T04:25:44.543

[您可以在Dawson Interactive](http://www.dawsoninteractive.com/articles/article/php-isbn-lookup-tool)找到 PHP 实现的 ISBN 查找工具。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-04-23T20:04:11.413

我经常推荐使用**亚马逊的 Product Affiliate API**（在此处查看[https://affiliate-program.amazon.com](https://affiliate-program.amazon.com)），但也有一些其他选项可用。

If you want to guarantee the accuracy of the data, you can go with the a paid solution. GS1 is the organization that issues UPC codes, so their information should always be accurate ([https://www.gs1us.org/tools/gs1-company-database-gepir](https://www.gs1us.org/tools/gs1-company-database-gepir)).

There are also a number of third party databases with relevant information such as [https://www.upccodesearch.com/](https://www.upccodesearch.com/) or [https://www.upcdatabase.com/](https://www.upcdatabase.com/) .

# c# - 如何通过 C# 中的另一个进程正在使用/锁定的网络读取文件？

> ID：106965
> 
> 赞同：2
> 
> 时间：2008-09-20T03:28:50.943
> 
> 标签：c#, .net, networking, io

鉴于您是远程机器上的机器管理员，有没有办法通过网络读取锁定的文件？我无法在本地读取锁定的文件，并且通过网络尝试它会增加另一层困难。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T03:36:30.130

根据锁定的类型（只读与独占），应该可以先复制文件，然后您可以使用未锁定的副本。

您应该能够在后台线程中执行此操作。如果您真的喜欢线程，请让文件观察程序在复制完成后启动读取过程（尽管这可能是矫枉过正）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T15:06:31.640

如果文件没有完全锁定或读/写，则在本地或远程读取文件没有问题。如果文件被锁定 - 您的管理权限将无济于事（即使您是上帝 :-)。如果文件在 READ 之前没有被锁定（您可以用记事本打开它来检查它） - 您可以在本地和远程读取它（没关系，除非您的网络共享设置了一些额外的限制）。

# .net - 在 .NET 中的并发线程之间传递数据的最佳方式是什么？

> ID：106979
> 
> 赞同：4
> 
> 时间：2008-09-20T03:33:15.503
> 
> 标签：.net, multithreading, concurrency

我有两个线程，一个需要轮询一堆单独的静态资源以查找更新。另一个需要获取数据并将其存储在数据库中。线程 1 如何告诉线程 2 有东西要处理？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T03:38:43.667

如果数据片段是独立的，则将数据片段视为要由线程池处理的工作项。使用线程池并将`QueueUserWorkItem`数据发布到线程。您应该使用对称线程池获得更好的可伸缩性，并限制生产者和消费者之间必须发生的同步量。

例如（来自[MSDN](http://msdn.microsoft.com/en-us/library/4yd16hza.aspx)）：

```
 TaskInfo ti = new TaskInfo("This report displays the number {0}.", 42);

    // Queue the task and data.
    if (ThreadPool.QueueUserWorkItem(new WaitCallback(ThreadProc), ti)) {    
        Console.WriteLine("Main thread does some work, then sleeps.");

        // If you comment out the Sleep, the main thread exits before
        // the ThreadPool task has a chance to run.  ThreadPool uses 
        // background threads, which do not keep the application 
        // running.  (This is a simple example of a race condition.)
        Thread.Sleep(1000);

        Console.WriteLine("Main thread exits.");
    }
    else {
        Console.WriteLine("Unable to queue ThreadPool request."); 
    }

// The thread procedure performs the independent task, in this case
// formatting and printing a very simple report.
//
static void ThreadProc(Object stateInfo) {
    TaskInfo ti = (TaskInfo) stateInfo;
    Console.WriteLine(ti.Boilerplate, ti.Value); 
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T03:34:13.270

我在工作项队列上使用 Monitor.Wait / Pulse。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T03:48:19.353

“存储在数据库中”线程是否总是需要运行？似乎最好的选择（如果可能的话）是让轮询线程启动另一个线程来进行保存。但是，根据创建的线程数，让第一个轮询线程使用 ThreadPool.QueueUserWorkItem() 可能是更有效的路线。

为了提高效率，当保存到数据库时，我会在数据库上使用异步 I/O 而不是同步方法。

任何时候您都可以不必在两个线程之间直接通信，您应该这样做。必须将一些同步原语放在一起，您的代码不会那么容易调试，并且可能会引入一些非常微妙的竞争条件，这些条件会导致“百万分之一执行”类型的错误（查找/修复远非有趣）。

如果第二个线程总是需要执行，请通过更多信息告诉我们原因，我们可以返回更深入的答案。

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T06:05:10.973

我个人会让线程 1 引发线程 2 可以响应的事件。线程可以通过启动两个线程的控制进程连接到适当的事件。*************************