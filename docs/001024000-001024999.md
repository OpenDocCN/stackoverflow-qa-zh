# StackOverflow 问答 1024000-1024999

# c# - 嵌套泛型

> ID：1024001
> 
> 赞同：3
> 
> 时间：2009-06-21T14:17:34.250
> 
> 标签：c#, generics, observablecollection

我以前问过这个问题，但我没有得到正确的问题，所以错过了答案。

如果我有一个返回方法的方法，`ObservableColletion<T>`那么我将在另一个通用方法中使用它。

将

```
method2<ObservableCollection<T>>(){} 
```

是要走的路。

我正在尝试制作一个通用的 resultEventArgs，它将 Ado.NET Dataservices 查询的结果传递给所有订阅者。在里面，我希望能够传递返回的强类型 EntityCollection [Ado.NET 1.5 生成]

所以是的，我的问题措辞是`ObservableCollection`因为我不想让整个 ado.net 数据服务混乱。

干杯戴夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T14:24:40.943

这取决于; 您要指定**项目**类型还是**集合**类型？如果您只想指定项目，则`T`仅与项目相关：

```
public ObservableCollection<T> SomeMethod<T>()
{
    var data = new ObservableCollection<T>();
    data.Add(default(T)); // or whatever
    return data;
} 
```

然后你可以使用`ObservableCollection<Order> orders = SomeMethod<Order>()`etc. 如果你需要指定集合类型，你可能需要更多的泛型类型......

```
public TList SomeMethod<TList, T>()
    where TList : class, IList<T>, new()
{
    var data = new TList();
    data.Add(default(T)); // or whatever
    return data;
} 
```

但是，调用它比较棘手。除非列表是参数，否则它不能进行类型推断，这意味着您必须同时指定两者`TList`，并且`T`在调用它时......不漂亮。

# c# - 使用 SqlBulkCopy 插入数据时出错

> ID：1024006
> 
> 赞同：18
> 
> 时间：2009-06-21T14:19:32.220
> 
> 标签：c#, sql-server, datetime, ado.net, sqlbulkcopy

我正在尝试使用将数据批量插入到 SQL 2008 中`SqlBulkCopy`。

这是我的桌子：

```
IF OBJECT_ID(N'statement', N'U') IS NOT NULL
DROP TABLE [statement]
GO
CREATE TABLE [statement](
  [ID] INT IDENTITY(1, 1) NOT NULL,
  [date] DATE NOT NULL DEFAULT GETDATE(),
  [amount] DECIMAL(14,2) NOT NULL,
CONSTRAINT [PK_statement] PRIMARY KEY CLUSTERED
(
    [ID] ASC
) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO 
```

这是我的代码：

```
private DataTable GetTable()
{
    var list = new List<DataColumn>();
    list.Add(new DataColumn("amount", typeof(SqlDecimal)));
    list.Add(new DataColumn("date", typeof(SqlDateTime)));

    var table = new DataTable("statement");
    table.Columns.AddRange(list.ToArray());

    var row = table.NewRow();
    row["amount"] = (SqlDecimal)myObj.Amount; // decimal Amount { get; set; }
    row["date"] = (SqlDateTime)myObj.Date; // DateTime Date { get; set }
    table.Rows.Add(row);

    return table;
}

private void WriteData()
{
    using (var bulk = new SqlBulkCopy(strConnection, SqlBulkCopyOptions.KeepIdentity & SqlBulkCopyOptions.KeepNulls))
    {
        //table.Columns.ForEach(c => bulk.ColumnMappings.Add(new SqlBulkCopyColumnMapping(c.ColumnName, c.ColumnName)));
        bulk.BatchSize = 25;
        bulk.DestinationTableName = "statement";
        bulk.WriteToServer(GetTable()); // a table from GetTable() 
    }
} 
```

所以我收到错误：

> 来自数据源的 type 的给定值`SqlDateTime`无法转换为`date`指定目标列的类型。

为什么？？我该如何解决？请帮帮我！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-06-21T19:53:08.780

使用您的原始表格脚本，以下代码有效。

```
private static DataTable GetTable()
{
    var list = new List<DataColumn>();
    list.Add(new DataColumn("amount", typeof(Double)));
    list.Add(new DataColumn("date", typeof(DateTime)));
    var table = new DataTable("statement");
    table.Columns.AddRange(list.ToArray());

    var row = table.NewRow();
    row["amount"] = 1.2d;
    row["date"] = DateTime.Now.Date;

    table.Rows.Add(row);
    return table;
}
private static void WriteData()
{
    string strConnection = "Server=(local);Database=ScratchDb;Trusted_Connection=True;";
    using (var bulk = new SqlBulkCopy(strConnection, SqlBulkCopyOptions.KeepIdentity & SqlBulkCopyOptions.KeepNulls))
    {
        bulk.ColumnMappings.Add(new SqlBulkCopyColumnMapping("amount", "amount"));
        bulk.ColumnMappings.Add(new SqlBulkCopyColumnMapping("date", "date"));
        bulk.BatchSize = 25;
        bulk.DestinationTableName = "statement";
        bulk.WriteToServer(GetTable());
    }
} 
```

正如 Amal 已经说过的，由于 Identity 列，您需要列映射。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-21T14:29:05.553

SQL Date 类型不同于 SQL DateTime 类型。我认为表中的日期列需要是 DateTime 类型，具体取决于您使用它的方式。

[SQL 日期类型](http://msdn.microsoft.com/en-us/library/bb630352.aspx)
[SQL 日期时间类型](http://msdn.microsoft.com/en-us/library/ms187819.aspx)

更新：

我认为 Marc 的答案应该有效，但您可能需要指定从源 DataTable 到目标的 SqlBulkCopyColumnMappings，否则可能会出现映射错误，因为输入表的结构与输出表不完全匹配，即日期顺序和行列交换。

例如

```
var amount = new SqlBulkCopyColumnMapping("amount", "amount");
var date = new SqlBulkCopyColumnMapping("date", "date");
bulk.ColumnMappings.Add(amount);
bulk.ColumnMappings.Add(date); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T14:29:06.817

`SqlDateTime`代表原始`datetime`类型。您是否尝试过仅在`DateTime`.NET 中使用 .NET 类型`DataTable`？我希望它可以将其转换为 TSQL`datetime`或`date`类型。同上`decimal`而不是`SqlDecimal`.

# asp.net-mvc - 使用 SelectList 更新模型

> ID：1024007
> 
> 赞同：0
> 
> 时间：2009-06-21T14:21:06.617
> 
> 标签：asp.net-mvc, updatemodel

我有一个名为 Product 的类

```
public class Product
{
    public virtual int Id { get; set; }
    public virtual Category Category { get; set; }
} 
```

请告诉我如何使用 UpdateModel 方法更新类别。

下面你会在视图中找到类别代码

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T17:02:22.307

I've found a easier way do do it:

```
<%= Html.DropDownList("Category.Id", (System.Web.Mvc.SelectList) ViewData["categoryList"])%> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T14:46:00.107

如果你是这样填充`ViewData["categoryList"]`的：

```
ViewData["categoryList"] = categories.Select(
    category => new SelectListItem {
        Text = category.Title,
        Value = category.Id.ToString()
    }).ToList(); 
```

然后在您的 POST 操作中，您可以简单地更新您的 Product.Category 属性：

```
int categoryId;
int.Parse(Request.Form["Category"], out categoryId);

product.Category = categories.First(x => x.Id == categoryId); 
```

或创建自定义 ModelBinder 以使用 UpdateModel() 进行更新：

```
public class CustomModelBinder : DefaultModelBinder
{
    protected override void BindProperty(ControllerContext controllerContext, ModelBindingContext bindingContext, System.ComponentModel.PropertyDescriptor propertyDescriptor)
    {
        if (String.Compare(propertyDescriptor.Name, "Category", true) == 0)
        {
            int categoryId = (int)bindingContext.ValueProvider["tags"].RawValue;

            var product = bindingContext.Model as Product;

            product.Category = categories.First(x => x.Id == categoryId);

            return;
        }

        base.BindProperty(controllerContext, bindingContext, propertyDescriptor);
    }
} 
```

# c - 图像库和 gif 图像

> ID：1024009
> 
> 赞同：3
> 
> 时间：2009-06-21T14:22:04.490
> 
> 标签：c, image, gif

我需要检查 C 程序中的 gif 图像。我查看了 FreeImage 库，但无法弄清楚。有人可以举一个使用 FreeImage 来了解有关 gif 图像的所有小细节的示例，例如帧、背景、透明度等......以及如何通过帧递增并获取动画的当前图像/像素。我遇到的问题是您将图像加载到 FIMULTIBITMAP 类型中，而大多数函数都采用 FIBITMAP 类型。我没有看到你应该如何使用带有 gif 的库。

另外，有没有更简单的库？

Ferruccio 说要使用 libGD。这是我在这个库中发现的。

```
/* These read the first frame only */
BGD_DECLARE(gdImagePtr) gdImageCreateFromGif (FILE * fd); 
```

我需要所有的框架。

下面是一种工作。问题是图像的宽度/高度变化小于实际图像。我认为它只是显示了更改的内容，但我不确定如何将其映射回原始图像以进行任何使用。这是[Gif 文件](http://uploading.com/files/MUWM1AQ2/clock_logo_ani.gif.html)。

实际上，这个库并没有像我认为的那样工作。例如，我无法获取图像的调色板。我得到的都是零。对此有何建议？

```
#include <stdio.h>
#include <string.h>
#include <FreeImage.h>

int main(int argc, char *argv) {
        FIMULTIBITMAP *src;
        src = FreeImage_OpenMultiBitmap(FIF_GIF, "clock_logo_ani.gif", FALSE, TRUE, FALSE, GIF_DEFAULT);

        int count = FreeImage_GetPageCount(src);
        int page, i, row, col, background, transparent;
        RGBQUAD bkcolor;
        BYTE pixel;

        char buffer[25*16 + 16];

        RGBQUAD *palette;

        background = 0;
        for(page = 0; page < count; page++) {
            FIBITMAP *dib = FreeImage_LockPage(src, page);
            if(dib) {
                printf("%dx%d\n", FreeImage_GetHeight(dib), FreeImage_GetWidth(dib));
                FreeImage_GetBackgroundColor(dib, &bkcolor);
                background = (&bkcolor)->rgbReserved;
                transparent = FreeImage_GetTransparentIndex(dib);
                memset(buffer, ' ', sizeof(char) * 24 * 16 + 17 * sizeof(char));
                for( row = 0; row < 16; row++ ) {
                        for( col = 0; col < 24; col++ ) {
                                if ( FreeImage_GetPixelIndex(dib, col, row, &pixel) ) {
                                        if((int)pixel != 0)
                                                buffer[row * 25 + col] = '.';
                                }

                        }
                }
                for (row = 0; row < 16; row++)
                        buffer[row * 25 + 25] = '\n';
                buffer[row * 25] = '\0';
                printf("-----\n%s\n-----\n", buffer);
                FreeImage_UnlockPage(src, dib, FALSE);
            }
        }

        FreeImage_CloseMultiBitmap(src, GIF_DEFAULT);
} 
```

这是输出。注意图像的大小如何变化。

```
16x24
-----
           ...           
        ..   ..         
       .       .        
      .         .       
     .           .      
     .           .      
    .             .     
    .      ...    .     
    .      .      .     
     .     .     .      
     .     .     .      
      .    .    .       
       .       .        
        ..   ..         
          ...           

-----
4x4
-----
 .                       
 .                      
  .                     

-----
4x3
-----
...                      

-----
4x3
-----
  .                      
.                       

.                       

-----
4x4
-----
.                        

-----
4x4
-----

.                       
 .                      

-----
4x4
-----

...                     

-----
4x4
-----

  .                     
 .                      
.                       

----- 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T21:27:56.593

在问题中包含的代码中，锁定页面后，您可以执行以下操作：

```
bool isTransparent=FreeImage_IsTransparent(dib);
RGBQUAD* bkcolor;
bool didIGetBackgroundCorrectly=FreeImage_GetBackgroundColor(dib, bkcolor); 
```

FreeImage_LockPage 为您提供的指针是该帧的图像。您应该能够在任何其他采用 FIBITMAP 类型的函数中使用它。（但请记住，在上面的代码中，您以只读方式打开它）

您已经知道动画中有多少帧，“计数”会告诉您。（当然，从零开始）这很简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T14:37:57.313

我在[LibGD](http://libgd.org/)上运气不错。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T15:45:26.430

如果你愿意使用 c++，[ImageMagick](http://www.imagemagick.org/Magick++/STL.html)有绑定来做这件事。它有 ac api，但我没有看到任何功能可以做到这一点。

# sql - 带有大量参数的Sql存储过程

> ID：1024018
> 
> 赞同：2
> 
> 时间：2009-06-21T14:26:43.967
> 
> 标签：sql, sql-server-2008, stored-procedures

我正在使用 Sql Server 2008。我的存储过程接受近 150 个参数。性能方面有什么问题吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-21T14:33:50.693

当您使用 SQL Server 2008 时，您可以使用新的 Table 参数。如果参数相同，您可以轻松使用 table 参数。

这是[MSDN](http://msdn.microsoft.com/en-us/library/bb675163.aspx)的链接。这是[另一个链接](http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/12/02/sql-server-2008-table-valued-parameters.aspx)，更多解释

享受。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-21T14:35:43.230

从性能的角度来看，也许这不是问题。但从维护的角度来看。

您可以考虑将数据作为单个 xml 参数发送。详情见：

[http://msdn.microsoft.com/en-us/library/dd788497.aspx](http://msdn.microsoft.com/en-us/library/dd788497.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T14:35:05.277

没有什么错误的性能明智，但它闻起来可以用动态 SQL 更好地完成。不看代码很难说。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T14:33:45.997

最大值为 1,024，但我认为 150 略高于

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-22T08:53:59.393

SQL Server 新闻组中的常客将熟悉 Joe Celko 和 Tony Rogerson 之间的许多争吵，其中之一就是关于使用具有大量参数的存储过程是否是个好主意的问题。

因为这个问题是关于性能的，所以这里是托尼方面的论点：

[不要使用 CSV/XML - 改用 1,000 个参数！](http://sqlblogcasts.com/blogs/tonyrogerson/archive/2007/03/17/joe-celko-don-t-use-csv-xml-use-1-000-parameters-instead.aspx)

托尼·罗杰森（Tony Rogerson）是英国人（美国 = 莱米），标题具有讽刺意味（美国 = NULL）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-21T15:43:52.563

您绝对应该确定所有参数的原因。

1.  它们是要插入或更新到表中的值吗？那么您最好对这些值使用表值参数。
2.  它们是复杂的选择标准吗？然后我怀疑您应该使用 XML 参数来传递选择标准；否则，您可能会重新评估实际使用各种标准的频率。在 80% 的情况下，您可能会发现更简单的 SP 可以满足您的需求。

# .net - .NET Windows 7 Jumplist - 复选框/单选 Jumplist 项

> ID：1024026
> 
> 赞同：2
> 
> 时间：2009-06-21T14:31:45.673
> 
> 标签：.net, windows-7, jump-list

我想创建一个跳转列表项目，该项目在选项前面带有勾号或圆形复选标记。我将[Windows API 代码包](http://code.msdn.microsoft.com/WindowsAPICodePack)用于 .NET 实现。

我查看了 SDK 文档，但找不到任何可以在跳转列表项前面启用勾号或圆形复选标记的内容。我知道我可以破解 Jumplist 项目前面的图标，但这是最好的方法吗？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-02T00:38:48.727

是的，使用 icon hack 确实是完成你想要做的事情的唯一方法。对于频繁/MRU 列表，您甚至没有图标作为选项。

您可以为被视为自定义任务的项目定义图标。单击时，它会将命令行参数传递给您的应用程序，您需要读取并存储该信息。当您重建跳转列表时，您将填充跳转列表并根据最近存储的状态设置图标。

我认为这当然是应该为 Windows 7 版本提供的功能，但它并没有像您不能禁用跳转列表中的任务链接那样大的问题......

# c - 如何在 C 中的结构内设置字符？

> ID：1024030
> 
> 赞同：1
> 
> 时间：2009-06-21T14:33:28.727
> 
> 标签：c, data-structures, malloc

如何为结构内的 char 变量（不是 char 指针）分配内存？
（变量名称是葡萄牙语，如果有点令人困惑，请见谅）

我有这个结构：

```
typedef struct node{
    char rotulo[10], instrucao[1][2][10], flag;
    int simplificado;

    struct node *referencias[2];
    struct node **antecessores;
    int nrAntecessores;

    struct node *ant;
    struct node *prox;
} Estado; 
```

这是`insere()`设置从新节点中的输入文件读取的值的函数：

```
void Insere(char *rotulo, char instrucao[][2][10], int qtdInstrucao, char flag){
    int i,j;
    Estado *NovoEstado;
    NovoEstado = (Estado*)malloc(sizeof(Estado));
    NovoEstado->prox = NULL;
    NovoEstado->ant = P->ult;
    strcpy(NovoEstado->rotulo, rotulo);
    NovoEstado->flag = flag;
    NovoEstado->antecessores = NULL;
    NovoEstado->nrAntecessores = 0;
    NovoEstado->simplificado = 0;

    for(i=0;i<qtdInstrucao;i++){
        realloc(NovoEstado->instrucao, i+1*sizeof(char[2][10]));
        strcpy(NovoEstado->instrucao[i][0], instrucao[i][0]);
        strcpy(NovoEstado->instrucao[i][1], instrucao[i][1]);
    }
} 
```

这`NovoEstado->flag = flag;`不起作用......
在我设置它之后，如果我打印`NovoEstado->flag`我得到正确的值，但如果我`for`在函数结束时将它放在后面，当我打印时`NovoEstado->flag`我得到 NovoEstado->rotulo 的第一个字符...
当我尝试打印时也会发生同样的`flag`情况`main()`...

我认为那是因为我没有正确分配内存空间`flag`in `Insere()`，对吗？我该如何解决？

我很确定这是一个非常简单的问题，而且我可能曾经知道这一点，但我忘记了并且在任何地方都找不到它......所以任何帮助将不胜感激

**编辑**

按照 ocdecio 的提示，我创建了一个指向二维数组的指针，以便获得一个动态的 3 维数组。
我的目标是有一个像这样的“表”：

```
 10 chars | 10 chars  
|__________|__________|
|__________|__________|
|__________|__________| 
```

行数是动态的，但它始终是 2 个 10 个字符的字符串的数组。

所以现在这就是我在主要做的事情：

```
 char estado[127], rotulo[10], strInstrucoes[117], *conjunto = calloc(21, sizeof(char)), flag;
    char (*instrucao)[2][10];

    FILE * entrada;
    Automato *Aut = (Automato*)malloc(sizeof(Automato));

    if((entrada = fopen(argv[1], "r")) != NULL){
        CriaAutomato(Aut);
        while(fgets(estado, 127, entrada)){
            flag = 0;
            sscanf(estado,"%[^:]: %[^;]; %c", rotulo, strInstrucoes, &flag);
            instrucao = calloc(1, sizeof(char[2][10]));
            conjunto = strtok(strInstrucoes,"() ");
            for(i = 0; conjunto != NULL; i++){
                realloc(instrucao, i+1*sizeof(char[2][10]));
                sscanf(conjunto,"%[^,],%s", instrucao[i][0], instrucao[i][1]);
                printf("%s || %d\n", instrucao[i][1], i);
                conjunto = strtok(NULL, "() ");
            }
            Insere(Aut, rotulo, instrucao, i, flag);
            free(instrucao);
        }
        fclose(entrada); 
```

但这不起作用...
这是从文件中读取的输入

```
adsasdfg2: (abc,123) (def,456) (ghi,789); 
```

但即使在我打电话之前，我`Insere`也没有按照我想要的方式分配正确的值`instrucao`，因为这是那个输出`printf`

```
123
454
789 
```

而不是我的目标

```
123
456
789 
```

怎么了？

（在有人问之前，这是作业**的****一部分**，但不是作业。我的任务是制作一个确定性有限自动机最小化器，这只是我得到的与数据输入相关的错误）

 **非常感谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T14:39:14.083

您的问题很可能出在这一行：

```
realloc(NovoEstado->instrucao, i+1*sizeof(char[2][10])); 
```

无需在结构内分配任何内容，因为该字段`instrucao`是由语句静态定义的`instrucao[1][2][10]`，它不是动态分配的结构。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T14:39:43.630

我认为这条线是问题所在：

```
realloc(NovoEstado->instrucao, i+1*sizeof(char[2][10])); 
```

在结构中，指令被定义为一块连续的内存，但您现在正在分配内存并分配指针。

尝试将其注释掉，您不需要为该变量分配内存。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T14:39:18.777

您不需要分配标志。它是在结构内定义的字符（与指针相反）。

您的错误是由在您写入的 for 循环期间覆盖结构内的标志内容引起的`NovoEstado->instrucao`（即它的内存涂鸦或覆盖）。

更新：正如@ocdecio 指出的那样，您不需要在循环内重新分配，因为`instrucao`它也是静态分配的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T14:47:04.380

我不知道代码的意图，但执行以下操作肯定是非法的：

realloc(NovoEstado->instrucao, i+1*sizeof(char[2][10]));

基本上，包含结构是使用 malloc 分配的，但所讨论的内部成员是一个静态定义的数组，它不能使用堆重新分配（因为堆管理器只跟踪指向节点的 malloced 指针）。

typedef struct node{ char rotulo[10], **instrucao[1][2][10],** flag;

如果您希望动态调整*指令*大小，则必须将其定义为指针类型并单独为其分配内存。**

# objective-c - EXC_BAD_ACCESS 试图读取一个 NSArray

> ID：1024031
> 
> 赞同：2
> 
> 时间：2009-06-21T14:33:32.143
> 
> 标签：objective-c, cocoa, cocoa-touch, nsmutablearray, nsuserdefaults

在下面的代码中，我尝试从 plist 中读取数据：

```
 -(void)readPreferences 
    {
        NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
        NSMutableArray * myAppDefaults  = [defaults mutableArrayValueForKey:@"LastList"];
        myCustomObject * savedObject;
        NSUInteger i;
        for (i = 0; i < [myAppDefaults  count]; i++) 
        {
            NSArray * thisArray = [myAppDefaults  objectAtIndex:i];

            savedObject.value1 = [thisArray objectAtIndex:0];
            savedObject.value2 = [thisArray objectAtIndex:1];
            savedObject.value3 = [thisArray objectAtIndex:2];
            savedObject.value4 = [myAppDefaults  objectAtIndex:3];

            [objectsArray addObject:savedObject];
        }

    } 
```

不知何故，当我尝试设置“savedObject.value1”时，出现“EXC_BAD_ACCESS”错误。

我意识到这很可能是基本的内存管理，或者指针/对象的混乱，但我仍在学习。我希望有人可以在这里帮助我。最好的问候

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T14:57:05.433

`savedObject`您在设置`value1`属性时尚未初始化。您将需要添加：

```
savedObject = [[myCustomObject alloc] init]; 
```

在您的`for`循环之前，以使其成为您可以设置属性的有效对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T14:53:27.533

我没有看到`mutableArrayValueForKey`。`NSUserDefaults`试试`arrayForKey:`吧，那会给你`NSArray*`。

似乎从返回的值`defaults`是不可变的（因为您从文件中获取内容是有意义的）。

检查从 的返回值`mutableArrayValueForKey`，我怀疑它是零。

再看你的代码没有多大意义。您在任何时候都不会分配 savedObjects，但您会反复将其插入数组中。即使您提取值的方式似乎也不正确。

我建议查看 Apple 文档中的 NSUserDefautls 参考，它有基本用法的示例。

# c# - 让智能感知在自定义服务器控件的标记中显示属性

> ID：1024043
> 
> 赞同：2
> 
> 时间：2009-06-21T14:38:19.827
> 
> 标签：c#, asp.net

**我有一个继承自UserControl**的自定义控件，我无法在智能感知中显示它的属性。例如，我有一个属性：

```
public string Title; 
```

但如果我开始输入：

```
ff:myControl Tit... 
```

什么都没有出现（就像我认为应该的那样）。我尝试添加**Browsable**、**EditorBrowsable**等属性，但似乎没有任何效果 - 我忘记了什么？

 *** * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T15:31:26.457

我好蠢。只是忘记了：

```
get;set; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T14:46:20.357

您是否尝试对您的属性使用 xml 注释？或者这是基类属性？无论如何，我认为标记不支持 xml 注释智能感​​知，并且“Browsable”属性仅确定是否在属性窗口上显示属性，而“EditorBrowsable”确定将使用哪个窗口来编辑属性。**

# database - 我应该使用字符串表来提高数据库的效率吗？

> ID：1024048
> 
> 赞同：4
> 
> 时间：2009-06-21T14:40:13.300
> 
> 标签：database, string, performance

假设您有一个带有单个表的数据库，例如...

```
---------------------------------------------
| Name    |  FavoriteFood                   |
---------------------------------------------
| Alice   | Pizza                           |
| Mark    | Sushi                           |
| Jack    | Pizza                           |
--------------------------------------------- 
```

如果有一个名为“Strings”的附加表来存储字符串，并将 FavoriteFood 列更改为字符串表中的索引，是否会更节省空间。在上面的示例中，“Pizza”看起来像是存储了两次，但对于附加表，它似乎只存储了一次。当然，请假设有 1,000,000 行和 1,000 个唯一字符串，而不是只有 3 行和 2 个唯一字符串。

编辑：我们事先不知道 FavoriteFoods 是什么：它们是用户提供的。字符串表的编程接口类似于......

```
String GetString(int ID) { return String at with Row-ID == ID }

int GetID(String s) {
  if s exists, return row-id;
  else {
    Create new row;
    return new row id;
  }
} 
```

所以字符串表似乎更有效，但是现代数据库是否已经在后台这样做了，所以我可以只做简单的单表方法并且高效吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T14:44:51.823

你用什么来衡量效率？假设没有与每个 FavoriteFood 关联的其他数据（在这种情况下显然您需要两个表），单表方法可能更节省时间，因为不必要的连接会产生额外的处理成本。另一方面，双表方法可能更节省空间，因为存储索引比存储字符串占用的空间更少，但这取决于您使用的特定数据库如何优化重复字符串的存储。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T14:49:58.133

您应该根据问题域而不是效率来考虑什么才是好的设计（除非您希望拥有数千万行以上的行）。

一个设计良好的数据库应该是 3NF（第三范式）。仅当您通过测量确定性能问题时才进行非规范化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T14:48:19.087

如果您有另一个表来存储字符串，当您想要更新描述时会更容易，例如，如果您需要将所有比萨饼更新为意大利比萨饼，那么如果您使用单独的桌子。另一个优点是翻译，您可以使用另一个表来存储不同语言的字符串翻译，并根据当前语言选择一个。

但是这种方法的问题在于插入。U 需要在两个表中插入并且还需要维护外键约束，因此它给简单的表增加了一些复杂性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T17:07:10.753

Pros for having a separate "Strings" table:

*   Likely, less space, if strings repeat really frequently
*   Likely, faster typical queries - because of less I\O

Cons:

*   You'll write more complex queries to achieve the same result
*   If the repetition factor is rather small, you'll get higher query execution time. To resolve each ID to string (or back), database server will perform a single lookup (seek operation) per each ID. So you get additional **log(Strings.Count())** factor ~ for each query doing this.

But actually this is really effecient. E.g. most of full-text search engines use nearly this approach to store document-word maps.

# python - 导入内部函数是pythonic吗？

> ID：1024049
> 
> 赞同：147
> 
> 时间：2009-06-21T14:41:00.227
> 
> 标签：python, conventions

[PEP 8](http://www.python.org/dev/peps/pep-0008/)说：

> *   导入总是放在文件的顶部，就在任何模块注释和文档字符串之后，模块全局变量和常量之前。

有时，我违反了 PEP 8。有时我在函数中导入东西。作为一般规则，如果有一个只在单个函数中使用的导入，我会这样做。

有什么意见吗？

**编辑（我觉得导入函数的原因可能是个好主意）：**

主要原因：它可以使代码更清晰。

*   在查看函数代码时，我可能会问自己：“什么是函数/类 xxx？” （函数内部使用了xxx）。如果我在模块的顶部有我的所有导入，我必须去那里看看 xxx 是什么。这在使用`from m import xxx`. 看到`m.xxx`函数可能会告诉我更多。取决于是什么`m`：它是众所周知的顶级模块/包（`import m`）吗？或者它是一个子模块/包（`from a.b.c import m`）？
*   在某些情况下，在使用 xxx 的位置附近拥有额外信息（“什么是 xxx？”）可以使函数更易于理解。

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-06-22T02:05:00.620

从长远来看，我认为您会喜欢将大部分导入放在文件顶部，这样您就可以通过需要导入的内容一眼看出您的模块有多复杂。

如果我要向现有文件添加新代码，我通常会在需要的地方进行导入，然后如果代码保留，我会将导入行移动到文件顶部，从而使事情变得更加永久。

还有一点，我更喜欢`ImportError`在运行任何代码之前获得异常——作为健全性检查，所以这是在顶部导入的另一个原因。

我`pyChecker`用来检查未使用的模块。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-06-21T14:53:55.940

在这方面我有两次违反 PEP 8：

*   循环导入：模块 A 导入模块 B，但模块 B 中的某些内容需要模块 A（尽管这通常表明我需要重构模块以消除循环依赖）
*   插入 pdb 断点：`import pdb; pdb.set_trace()`这很方便 b/c 我不想放在`import pdb`我可能要调试的每个模块的顶部，并且在删除断点时很容易记住删除导入。

在这两种情况之外，将所有内容放在顶部是一个好主意。它使依赖关系更清晰。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-06-21T15:20:52.283

以下是我们使用的四个导入用例

1.  `import`（和`from x import y`）`import x as y`在顶部

2.  进口选择。在顶部。

    ```
    import settings
    if setting.something:
        import this as foo
    else:
        import that as foo 
    ```

3.  有条件的导入。与 JSON、XML 库等一起使用。在顶部。

    ```
    try:
        import this as foo
    except ImportError:
        import that as foo 
    ```

4.  动态导入。到目前为止，我们只有一个这样的例子。

    ```
    import settings
    module_stuff = {}
    module= __import__( settings.some_module, module_stuff )
    x = module_stuff['x'] 
    ```

    请注意，这种动态导入不会引入代码，而是引入用 Python 编写的复杂数据结构。它有点像腌制的数据，除了我们是手动腌制的。

    这也或多或少位于模块的顶部

* * *

以下是我们为使代码更清晰所做的工作：

*   保持模块简短。

*   如果我将所有导入都放在模块的顶部，我必须去那里看看以确定名称是什么。如果模块很短，那很容易做到。

*   在某些情况下，在使用名称的位置附近提供额外信息可以使函数更易于理解。如果模块很短，那很容易做到。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-06-21T15:08:40.280

要记住的一件事：不必要的导入可能会导致性能问题。所以如果这是一个经常被调用的函数，你最好把导入放在顶部。当然，这*是*一种优化，所以如果有一个有效的案例表明在函数内部导入比在文件顶部导入更清晰，那么在大多数情况下，这胜过性能。

如果您正在使用 IronPython，我被告知最好导入内部函数（因为在 IronPython 中编译代码可能很慢）。因此，您也许可以找到一种方法来导入内部函数。但除此之外，我认为与传统作斗争是不值得的。

> 作为一般规则，如果有一个只在单个函数中使用的导入，我会这样做。

我想说的另一点是，这可能是一个潜在的维护问题。如果您添加一个使用以前仅由一个函数使用的模块的函数会发生什么？你会记得将导入添加到文件顶部吗？还是您要扫描每个函数以查找导入？

FWIW，在某些情况下，在函数内部导入是有意义的。例如，如果要在 cx_Oracle 中设置语言，则需要在导入*之前*`_`设置一个 NLS LANG 环境变量。因此，您可能会看到如下代码：

 *```
import os

oracle = None

def InitializeOracle(lang):
    global oracle
    os.environ['NLS_LANG'] = lang
    import cx_Oracle
    oracle = cx_Oracle 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-21T15:10:58.747

对于自我测试的模块，我之前已经打破了这条规则。也就是说，它们通常只用于支持，但我为它们定义了一个 main ，这样如果你自己运行它们，你就可以测试它们的功能。在那种情况下，我有时会导入`getopt`并且`cmd`只是在 main 中，因为我希望阅读代码的人清楚这些模块与模块的正常操作无关，并且仅包含在测试中。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2019-03-26T14:14:40.963

Have a look at the alternative approach that's used in sqlalchemy: dependency injection:

```
@util.dependencies("sqlalchemy.orm.query")
def merge_result(query, *args):
    #...
    query.Query(...) 
```

Notice how the imported library is declared in a decorator, and passed *as an argument to the function*!

This approach makes the code cleaner, and also works **4.5 times faster** than an `import` statement!

Benchmark: [https://gist.github.com/kolypto/589e84fbcfb6312532658df2fabdb796](https://gist.github.com/kolypto/589e84fbcfb6312532658df2fabdb796)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-09-27T20:43:04.540

来自关于[两次加载模块](https://stackoverflow.com/questions/19077381/what-happens-when-i-import-module-twice-in-python)的问题- 为什么不两者都加载？

脚本顶部的导入将指示函数中的依赖关系和另一个导入，使该函数更具原子性，同时似乎不会导致任何性能劣势，因为连续导入很便宜。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2020-07-14T15:01:10.883

还有另一种（可能是“角落”）情况，它可能对`import`内部很少使用的功能有益：缩短启动时间。

我曾经在一个小型物联网服务器上运行一个相当复杂的程序，接收来自串行线路的命令并执行操作，可能是非常复杂的操作。

将`import`语句放在文件顶部意味着在服务器启动之前处理*所有导入；*由于`import`列表包括`jinja2`,`lxml`和`signxml`其他“重量级”（并且 SoC 不是很强大），这意味着在第一条指令实际执行前*几分钟。*

OTOH 将大多数导入功能放在我能够在几秒钟内让服务器在串行线路上“活着”的功能中。当然，当实际需要这些模块时，我不得不付出代价（注意：这也可以通过`import`在空闲时间产生一个后台任务来缓解）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-06-21T14:44:43.713

只要它是`import`而不是`from x import *`，你应该把它们放在顶部。它只向全局命名空间添加一个名称，并且您坚持使用 PEP 8。另外，如果您以后在其他地方需要它，您不必移动任何东西。

这没什么大不了的，但由于几乎没有区别，我建议按照 PEP 8 所说的去做。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-09-13T06:50:53.973

在既是“普通”模块又可以执行的模块中（即有一个`if __name__ == '__main__':`-section），我通常导入仅在执行主要部分中的模块时使用的模块。

例子：

```
def really_useful_function(data):
    ...

def main():
    from pathlib import Path
    from argparse import ArgumentParser
    from dataloader import load_data_from_directory

    parser = ArgumentParser()
    parser.add_argument('directory')
    args = parser.parse_args()
    data = load_data_from_directory(Path(args.directory))
    print(really_useful_function(data)

if __name__ == '__main__':
    main() 
```*

# privacy - 在显示用户的年龄时，如何将 DOB 字段保密？

> ID：1024051
> 
> 赞同：2
> 
> 时间：2009-06-21T14:41:40.130
> 
> 标签：privacy

如果 DOB 字段用于显示用户年龄，如何将其保密？例如，stackoverflow 的生日字段如何对其他用户保密？显示字段 Age 何时更改？它是仅在每个月的第一天更改还是在生日的随机范围内随机更改？或者也许只是在每年的第一天？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T14:54:08.763

我无法得出结论，但我知道我的 SO 个人资料中的年龄正如预期的那样在我生日那天翻转了。我想有人可以每天扫描 SO 个人资料并记录年龄，然后根据他们的变化来确定某人的生日，但如果有人想知道*那么糟糕*，我想他们可以知道。如果您真的担心自己的隐私，请不要输入您的真实生日（或根本不要输入）。

此外，有意或无意地，数据转储中提供的用户年龄并不总是准确的。我怀疑它是（当年）-（出生年份），这导致转储中的年龄（在我的情况下为 22 岁）比用户的实际年龄（我实际上是 21 岁）多 1 岁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T18:06:14.857

当然，每次您访问“个人资料”页面时都会计算该值。不断地计算和存储每个人的年龄太密集了。

当然，如果您有一个 Profile 类型的类，您只需将其设为只读属性！

就像是：

公共静态int计算年龄（日期时间出生日期）{

```
 DateTime today = DateTime.Today;

    int personAge  = (today.Year - userBirthDate.Year);
    // deduct a year if the birthday hasn't passed yet.
    if ((today.Month < birthDate.Month) || (today.Month == userBirthDate.Month && today.Day < userBirthDate.Day))
        --personAge;

    return personAge;
} 
```

[编辑：在问题 9](https://stackoverflow.com/questions/9/how-do-i-calculate-someones-age-in-c)中也有著名的问题

# c# - 如何在没有js的情况下获取价值点击gridview？

> ID：1024052
> 
> 赞同：0
> 
> 时间：2009-06-21T14:41:49.227
> 
> 标签：c#, .net, asp.net, gridview

下面的代码给了我下面的错误：如何生成这个代码请帮帮我！！！

****指数超出范围。必须是非负数且小于集合的大小。参数名称：索引****

```
 `protected void gvDepartman_RowDataBound(object sender, GridViewRowEventArgs e)
        {
            if (e.Row.RowType == DataControlRowType.DataRow)
            {
                string selectedid = (gvDepartman).DataKeys[e.Row.RowIndex].Value.ToString();
                e.Row.Attributes["onclick"] = "location.href='Test.aspx?id=" + selectedid + "'";
            }
        }` 
```

 *** * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T14:45:47.283

```
 protected void gvDepartman_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow && e.Row.RowIndex >=0)
        {
            string selectedid = (gvDepartman).DataKeys[e.Row.RowIndex].Value.ToString();
            e.Row.Attributes["onclick"] = string.Format("location.href='Test.aspx?id={0}'", selectedid);
        }
    } 
```**

# ruby-on-rails - 如何让 IRBRC 在 Win32 for Ruby 控制台上运行？

> ID：1024056
> 
> 赞同：2
> 
> 时间：2009-06-21T14:43:25.867
> 
> 标签：ruby-on-rails, ruby, console

谁能建议一些让 IRBRC 在 Win32 下运行的故障排除方法？rails 控制台是一个很棒的工具，我正在尝试用更多的功能来扩展它。

例如，我希望 what_method gem 自动加载。gem 已安装，但未加载：

```
C:\...\trunk>ruby script\console
Loading development environment (Rails 2.3.2)
>> 3.45.what? 3
NoMethodError: undefined method `what?' for 3.45:Float
        from (irb):1
>> require 'what_methods'
=> ["DummyOut", "WhatMethods"]
>> 3.34.what? 3
3.34.round_with_precision == 3
...
=> ["round_with_precision", "round", "prec_i", ... "round_without_precision"]
>> 
```

## 我的环境设置为

```
C:\...\trunk>dir %HOME%
 Volume in drive C is OS
...
06/21/2009  10:29 AM    <DIR>          .
06/21/2009  09:28 AM               118 .irbrc
... 
```

环境变量路径 IRBRC = %HOME%\.irbrc

## .irbrc 文件

```
require 'irb/completion'
require 'map_by_method'
require 'what_methods'
require 'pp'
IRB.conf[:AUTO_INDENT]=true 
```

## 我已阅读以下参考资料

[http://railscasts.com/episodes/48-console-tricks](http://railscasts.com/episodes/48-console-tricks)

[http://drnicwilliams.com/2006/10/12/my-irbrc-for-consoleirb/#irbrc_win32](http://drnicwilliams.com/2006/10/12/my-irbrc-for-consoleirb/#irbrc_win32)

[http://groups.google.com/group/ruby-talk-google/browse_thread/thread/23fe3980a5a4816e](http://groups.google.com/group/ruby-talk-google/browse_thread/thread/23fe3980a5a4816e)

[http://www.nabble.com/.irbrc-on-Windows-td23954309.html](http://www.nabble.com/.irbrc-on-Windows-td23954309.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T17:49:19.313

cd %HOMEPATH%

编辑.irbrc

添加东西

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-15T23:36:55.913

+1，@rogerdpack 为我提供了在 Windows XP Pro 上运行 IRBRC、Wirble 等所需的线索。不过，就我而言，我首先必须更改为我的 %HOMEDRIVE%，它不是“C:”驱动器，才能完成工作。现在一切正常，多亏了他！在 XP 上，如何创建以“.”开头的文件并不十分明显。我浪费了大量时间试图用 [File | 新 | Windows Exploder 和上下文菜单中的文本文档]；他们一直告诉我“你必须输入一个文件名。” @rogerdpack 的帖子在这里引导我使用控制台中的“编辑”，它调出了旧的 DOS 编辑器、蓝屏和所有内容，并且在输入一些文本后，使用 [File | Save} 到 ".irbrc" 让我创建 *nix-ed 文件名。后来，我发现我的旧待机 Notepad++，

我必须说，我在其他地方阅读了很多关于绕过 .irbrc 的各种策略的误导性帖子，然后@rogerdpack 发布了这个问题！谢谢！哦，我不妨提一下，[windows xp 中的 Colorized Wirble](http://www.botvector.net/2008/06/colorized-wirble-in-windows-xp.html)也有一个不同的解决方案，可以帮助一些人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-18T05:20:56.867

使用撬： http: [//pry.github.com](http://pry.github.com)

让你：

*   查看方法源代码
*   查看方法文档（不使用 RI，因此您不必预先生成它）
*   进出不同的上下文
*   语法高亮
*   主旨整合
*   查看和重播历史记录
*   打开编辑器以使用`edit-method obj.my_method`语法编辑方法

一吨更伟大和原始的功能

查看上面那个链接上的截屏视频，它也适用于 Rails。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T16:44:03.490

如果您希望在 Rails 环境中自动加载“what_methods”gem，您可以通过`config.gem`在 RAILS_ROOT\config\environment.rb 内的 Rails 配置中指定它：

```
Rails::Initializer.run do |config|
...
  config.gem "what_methods"
...
end 
```

或仅用于开发，只需将其添加到您的 RAILS_ROOT\config\environments\development.rb 中：

```
config.gem "what_methods" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-10T01:26:07.497

尝试设置 IRBRC 使用的环境变量路径，`_irbrc`而不是`.irbrc`- 是的，即使您的主路径中的文件实际上仍然被调用`.irbrc`。例如，我的 IRBRC 变量是`%HOMEPATH%\_irbrc`，它所指的文件是`C:\Users\Paul\.irbrc`.

# c# - HTTPS 自动登录问题

> ID：1024060
> 
> 赞同：2
> 
> 时间：2009-06-21T14:45:11.980
> 
> 标签：c#, asp.net

我正在尝试创建一个 C# 脚本来自动登录网站并下载报告。

我已成功登录该网站。有效的步骤是：

1) 获取登录表单 2) 使用 cookie 发送登录名/密码 3) 登录 4) 要求报告和下载

我遇到的问题是 4).. 不起作用。即使我发送了所有 cookie 并且我已登录，它仍然会再次将我重定向到登录表单。

我知道 URL 是正确的，因为当我通过浏览器登录时，报告会立即出现？

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T16:44:31.527

使用[Wireshark](http://www.wireshark.org/)或类似工具记录执行操作的浏览器。然后记录与您的程序尝试执行操作（并且失败）的会话。

从这两条痕迹中可以看出差异是什么。这将告诉您需要做哪些额外的浏览器仿真。

有可能：

1.  引用标头
2.  隐藏字段
3.  POST 请求

或者完全是别的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T14:52:40.810

它是基于 cookie 的会话管理吗？即该站点是否发送一个cookie，将您的会话标识为成功登录的响应（-header）？如果是这样，您是否将此 cookie 作为步骤 4 中请求的一部分发送？

# c++ - OSX 上的 C++/Python 初学者有什么好的设置？

> ID：1024062
> 
> 赞同：4
> 
> 时间：2009-06-21T14:45:46.910
> 
> 标签：c++, python, macos, ide

我正在寻找一个好的设置来学习 C++ 并最终在 Mac OSX 上学习 Python。因为我要使用 C++，所以我不想使用 XCode，因为（我理解）这主要与 Objective-C 一起使用。我在 Java 和 MATLAB 编程方面有一点经验，数学可能不会是我的主要问题。我正在考虑一种看起来像这样的方法：

1.  通过[Accelerated C++](https://rads.stackoverflow.com/amzn/click/com/020170353X "加速 C++ @ Amazon")工作。
2.  写几个小的数学程序；类似于 Mandelbrot 集、PDE 求解器或图形应用程序。这将使用小部件工具包来完成。
3.  用非常糟糕的图形编写一个小游戏。这可能是对 Jetmen Revival 或 Space Invaders 的抄袭；-)
4.  （当我厌倦了游戏无法运行时），通过[Core Python](https://rads.stackoverflow.com/amzn/click/com/0132269937)工作。
5.  在 Python 中重复步骤 2 和 3。

我正在考虑使用 Eclipse 和 GTK+ / X11。对 IDE 和 GUI 工具包有什么想法吗？最好是开源的，而且绝对免费。您如何看待这 5 个步骤？

任何帮助将不胜感激 - 在此先感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T15:10:17.780

> 因为我要使用 C++，所以我不想使用 XCode，因为（我理解）这主要与 Objective-C 一起使用。

XCode 是一个不错的选择，即使对于纯 C++ 解决方案也是如此。

> 通过加速 C++ 工作。

那是让我开始的书！这是一个很好的选择，但不是在公园里散步。我花了一两个月的时间，每天大约 1 到 2 个小时。但在此之后，您将朝着成为真正优秀的 C++ 程序员迈进一大步。

> 写几个小的数学程序；类似于 Mandelbrot 集、PDE 求解器或图形应用程序。这将使用小部件工具包来完成。用非常糟糕的图形编写一个小游戏。这可能是对 Jetmen Revival 或 Space Invaders 的抄袭；-)（当我厌倦了游戏无法运行时），通过 Core Python 工作（这是一本书；最多一个链接/新用户的问题...）。

好吧，我做了俄罗斯方块。

> 在 Python 中重复步骤 2 和 3。

我没有使用 Python 的经验，但我知道它比 C++ 更容易掌握。所以如果你能掌握 C++，Python 不会有任何问题。

对于 GUI，您可以使用 Qt，尤其是现在它已被制成 LGPL。然而，Cocoa 也很有趣，如果你有足够的勇气去学习 Objective-C :) （顺便说一句，Cocoa 也有一个 Python 端口。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T15:22:29.767

XCode 是一个成熟的 IDE，几乎适用于任何语言。C++ 得到了特别好的支持。

显然 GTK+ 具有[原生 OSX 小部件支持](http://gtk-osx.sourceforge.net/)，虽然我从未使用过它，所以如果您愿意，您可以完全跳过 X11 堆栈。其他跨平台小部件集包括[wxWidgets](http://www.wxwidgets.org/)、[fltk](http://www.fltk.org/)和[Tk](http://www.tkdocs.com/)。

然而，对于游戏来说，它们并不是最优的。为此，我强烈推荐[LibSDL](http://www.libsdl.org/)或其 python 绑定[PyGame](http://www.pygame.org/)。如果您想使用它们，它们可以为 OpenGL 提供一个方便的标准接口，或者如果您只需要这些，您可以使用硬件加速的 2d 基元。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T15:36:08.210

在选择 IDE 时，很大程度上取决于口味，因此最好的选择可能是尝试几个，每个尝试一两天。Eclipse 和 XCode 都是流行的选择，它们在它们自己的方面肯定很出色。我无法帮助您处理这些小部件，因为我对此知之甚少。GTK+ 是一个流行的框架，但上次我检查时原生 OS X 支持还没有准备好，但开发正在进行中，所以这可能会改变。Qt 不太流行，但现在完全开源，所以它过去的许可问题现在已经解决了，所以你可能也想研究一下。wxWidgets 在 Python 中很流行，我发现它很容易使用，但我不知道它是否和其他的一样好，但它可能很好。

至于这五个步骤，首先在 Python 中完成它们更有意义。Python 很容易学习和掌握，特别是如果你没有被 C/C++ 污染。C/C++ 程序员经常不得不忘掉一些东西，因为在 Python 中你必须做和想的事情太多了。

使用 Python，您可以专注于学习库和工具，而不必学习如何避免用 C++ 打自己的脚。之后再学C++，学习曲线会更流畅，也会更享受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T14:54:04.740

我肯定会去 GTK+。这很容易。我不确定 OS X 上的图形库。我知道 OS X 主要使用 Objective-C，但如果可以从 C++ 使用本机图形库，请将其用于游戏图形。

至于IDE，我不知道。我使用 GNU Emacs，但我不会向初学者推荐它。学习如何使用 Emacs 就像自己学习一门新的编程语言一样。我将从一个基本的文本编辑器开始（查找一个带有语法突出显示的）并从终端编译，因此您也不必学习 IDE。它们使大型项目变得更容易，但也可以成为小事情的 PITA。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T15:00:54.023

您可以将 VIM 与用于 C++ 的 cscope 和 ctags 插件一起使用，我个人认为这是最快的。如果您需要 gui，Eclipse for C++ 也很好，但它不像 Java 那样功能丰富，但它是一个很好的开源 IDE。

书籍方面，Effective C++和More Effective C++都不错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-21T15:33:40.853

> 1.  通过加速 C++ 工作。
> 2.  写几个小的数学程序；类似于 Mandelbrot 集、PDE 求解器或图形应用程序。这将使用小部件工具包来完成。
> 3.  用非常糟糕的图形编写一个小游戏。这可能是对 Jetmen Revival 或 Space Invaders 的抄袭；-)
> 4.  （当我厌倦了游戏无法运行时），通过 Core Python 工作（这是一本书；新用户最多可以有一个链接/问题......）。
> 5.  在 Python 中重复步骤 2 和 3。

我可以建议在语言方面以相反的顺序执行此操作吗？请记住，GTK+ 不是易学的，C++ 也不是。事实上，我真的建议先从 Cocoa 和[PyObjC](http://pyobjc.sourceforge.net/)开始。可可更能包裹你的头，但一旦你把它放下，很容易看到它的好处。GTK 和 PyGTK 的开发设置可以是在 OS X 上设置的 PITA（至少对我来说是这样）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-21T15:57:02.137

[NetBeans](http://www.netbeans.org/features/cpp/index.html)是另一种选择。尽管 Python 和 C++ 对它的支持都是相当新的。Python 的作品找到了，但我还没有尝试过 C 支持。

# c# - C# Eval() 支持

> ID：1024070
> 
> 赞同：22
> 
> 时间：2009-06-21T14:47:07.873
> 
> 标签：c#, eval

我们需要在运行时评估对象中的值，同时我们有确切成员路径的文本语句，例如：**myobject.firstMember.secondMember[3].text**
我们考虑使用正则表达式解析此文本语句，然后评估文本通过使用反射来获得价值，但在我们这样做之前，我想知道 C# 是否支持某种**eval**能力？所以我们不必自己进行解析。微软如何在他们的即时窗口或监视窗口中执行此操作？

非常感谢你，

阿迪巴尔达

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-21T16:57:57.833

Probably the easiest way is to use [DataBinder.Eval](http://msdn.microsoft.com/en-us/library/system.web.ui.databinder.eval.aspx) from System.Web.UI:

```
var foo = new Foo() { Bar = new Bar() { Value = "Value" } };
var value = DataBinder.Eval(foo, "Bar.Value"); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-02-03T09:35:58.040

我编写了一个开源项目[Dynamic Expresso](https://github.com/davideicardi/DynamicExpresso/)，它可以将使用 C# 语法编写的文本表达式转换为委托（或表达式树）。表达式在不使用编译或反射的情况下被解析并转换为[表达式树。](http://msdn.microsoft.com/en-us/library/bb397951.aspx)

您可以编写如下内容：

```
var interpreter = new Interpreter();
var result = interpreter.Eval("8 / 2 + 2"); 
```

或者

```
var interpreter = new Interpreter()
                .SetVariable("service", new ServiceExample());

string expression = "x > 4 ? service.SomeMethod() : service.AnotherMethod()";

Lambda parsedExpression = interpreter.Parse(expression, 
                        new Parameter("x", typeof(int)));

parsedExpression.Invoke(5); 
```

我的工作基于 Scott Gu 的文章[http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-21T14:53:55.957

在未来（大约 5.0 时间范围内），“编译器即服务”也许能够做到这一点。实际上，你现在可以用“mono”做很多事情（参见[CsharpRepl](http://www.mono-project.com/CsharpRepl)和[Mono.CSharp](http://www.go-mono.com/docs/index.aspx?link=N:Mono.CSharp) - 但是，我希望它需要更多地了解上下文才能使用局部变量等[`Evaluate`](http://www.go-mono.com/docs/index.aspx?link=N:Mono.CSharp)) - 但在当前的 MS .NET 产品中对此没有任何支持。

现在，您必须执行许多数据绑定代码所做的事情……用诸如“.”之类的标记将其分开。并使用反射。严格来说，绑定代码其实是使用`TypeDescriptor`/`PropertyDescriptor`而不是直接反射，但是效果是一样的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-09T04:26:40.567

您可以随时尝试我的轻量级 C# Eval 程序。它将 C# 语言的大部分子集编译为动态方法。我的 GitHub 存储库[DavidWynne/CSharpEval的完整详细信息](https://github.com/DavidWynne/CSharpEval)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T15:04:01.270

尽管是一种重量级的方法，但您可以使用 C# CodeDom 发出一个新的新程序集，其中包含仅使用该行代码的方法。

我承认，这比其他一些建议要严厉得多，但另一方面，你让 C# 解析器完成繁重的工作，所以只要它是有效的 C#，它应该能够处理你扔给它的所有东西.

如果您走这条路，您还需要确保可以再次卸载发出的程序集，因此可能需要创建和卸载 AppDomain。

我已经成功实现并使用了上述技术。另一方面，如果您可以使用[DynamicMethod](http://msdn.microsoft.com/en-us/library/system.reflection.emit.dynamicmethod.aspx)，它将更加轻量级。但是，我从未尝试过这种方法，所以我不能说您是否可以使用 C# 文字来实现 DynamicMethod 的主体。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-21T15:25:32.570

实际上，Windows Workflow Foundation 的表达式评估和规则引擎功能可以做这样的事情。请参阅[Windows Workflow Foundation 规则引擎简介](http://msdn.microsoft.com/en-us/library/dd554919.aspx)。

关于这些组件的一个有趣的事情是，它们的设计目的是让您可以在自己的应用程序中托管设计时组件，以设计在您自己的自定义类的上下文中运行的规则和/或表达式集。例如，您会告诉它针对“myObject”设计一个表达式，它会知道有一个 firstMember 有一个 secondMember，它有一个索引器，产生一个具有 text 属性的类型。您可以将表达式和规则保存为 XML，并在运行时将它们读回，而无需在运行时使用设计器。

特别是，请参阅[External RuleSet Toolkit Sample](http://msdn.microsoft.com/en-us/library/bb472424.aspx)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-10T02:35:43.627

不幸的是，C# 没有任何本机工具可以完全按照您的要求进行操作。

但是，我的 C# eval 程序确实允许评估 C# 代码。它提供了在运行时评估 C# 代码并支持许多 C# 语句，包括像“ **myobject.firstMember.secondMember[3].text** ”这样的表达式。事实上，此代码可用于任何 .NET 项目，但仅限于使用 C# 语法。查看我的网站[http://csharp-eval.com](http://csharp-eval.com)了解更多详细信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-21T14:48:49.663

AFAIK 没有这样的内置 Eval 函数。您必须采用 Regex+Reflection 的方式。我也认为 Visual Studio 也在做同样的事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-21T15:11:06.857

这是我用来查找动态嵌套属性的类似内容..您需要为索引器添加逻辑...以及一些额外的检查...我在调用方法中捕获了空值/错误...

```
  public static object FindDottedProperty(this object input, string propertyName)
  {
    如果（输入==空）
      返回空值；

    if (string.IsNullOrEmpty(propertyName))
      返回空值；

    队列道具 = new Queue(propertyName.Split('.'));
    if (props.Count == 0) 返回空值；

    //从输入对象开始并从那里推出属性堆栈。
    对象 ret = 输入；
    while (props.Count > 0)
    {
      var prop = props.Dequeue();
      if (string.IsNullOrEmpty(prop)) 返回空值；

      /*** 在此处添加索引器逻辑 ***/

      //根据当前命名项获取属性值
      ret = ret.GetType().GetProperty(prop).GetValue(ret, null);

      if (null.Equals(ret)) 返回空值；
    }

    //返回查找的值
    返回 ret;
  }

```

# c# - 如何为 .NET 应用程序域重新加载程序集？

> ID：1024072
> 
> 赞同：6
> 
> 时间：2009-06-21T14:48:01.303
> 
> 标签：c#, .net, appdomain

我们正在加载读取配置文件的程序集（DLL）。我们需要更改配置文件，然后重新加载程序集。我们看到第二次加载程序集后，配置没有变化。有人看到这里有什么问题吗？我们省略了配置文件中读取的细节。

```
AppDomain subDomain;
string assemblyName = "mycli";
string DomainName = "subdomain"; 
Type myType;
Object myObject;

// Load Application domain + Assembly
subDomain = AppDomain.CreateDomain( DomainName,
                                    null,
                                    AppDomain.CurrentDomain.BaseDirectory,
                                    "",
                                    false);

myType = myAssembly.GetType(assemblyName + ".mycli");
myObject = myAssembly.CreateInstance(assemblyName + ".mycli", false, BindingFlags.CreateInstance, null, Params, null, null);

// Invoke Assembly
object[] Params = new object[1];
Params[0] = value;
myType.InvokeMember("myMethod", BindingFlags.InvokeMethod, null, myObject, Params);

// unload Application Domain
AppDomain.Unload(subDomain);

// Modify configuration file: when the assembly loads, this configuration file is read in

// ReLoad Application domain + Assembly
// we should now see the changes made in the configuration file mentioned above 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-21T15:42:39.697

一旦加载了程序集，就无法卸载它。但是，您可以卸载 AppDomain，因此最好的办法是将逻辑加载到单独的 AppDomain 中，然后当您想要重新加载程序集时，您必须卸载 AppDomain 然后重新加载它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T15:30:24.167

我相信这样做的唯一方法是启动一个新的 AppDomain 并卸载原来的 AppDomain。这就是 ASP.NET 处理 web.config 更改的方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T15:48:27.063

如果您只是更改某些部分，则可以使用 ConfigurationManager.Refresh("sectionName") 强制从磁盘重新读取。

```
static void Main(string[] args)
    {
        var data = new Data();
        var list = new List<Parent>();
        list.Add(new Parent().Set(data));

        var configValue = ConfigurationManager.AppSettings["TestKey"];
        Console.WriteLine(configValue);

        Console.WriteLine("Update the config file ...");
        Console.ReadKey();

        configValue = ConfigurationManager.AppSettings["TestKey"];
        Console.WriteLine("Before refresh: {0}", configValue);

        ConfigurationManager.RefreshSection("appSettings");

        configValue = ConfigurationManager.AppSettings["TestKey"];
        Console.WriteLine("After refresh: {0}", configValue);

        Console.ReadKey();
    } 
```

（请注意，如果您使用 VS 托管进程，则在测试时必须更改 application.vshost.exe.config 文件。）

# sql - SQL 存储过程安全吗？

> ID：1024073
> 
> 赞同：1
> 
> 时间：2009-06-21T14:48:03.020
> 
> 标签：sql, stored-procedures, sql-injection

他们是否比做类似的事情更不容易受到 SQL 注入的影响`mysql_query("SELECT important_data FROM users WHERE password = $password")`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T14:50:53.887

它们比您所做的更安全。您的查询将原始 SQL 发布到数据库，这意味着您的参数不被视为 sql 参数，而是被视为普通的旧 sql。

这就是我的意思。

对于存储过程，密码变量不能是 sql，它必须是系统正在寻找的一条信息。在您的示例中，实际发送到数据库的是

SELECT * FROM User where password = ('your password here'--$Password variable).....所以有人可以做类似的事情

SELECT * FROM user WHERE Password = ('your password here';SELECT * FROM User --$password 变量)。

或更糟糕的是：

SELECT * FROM user WHERE Password = ('your password here';DROP Database Database_Name --$password 变量)。

非动态 sql 存储过程不允许这样做，因为输入参数不会作为额外的 sql 执行。

参数化 SQL 确实解决了这个问题，但从技术上讲，存储过程仍然更安全一些，因为访问表中信息的用户不需要读取访问权限。它只需要能够执行存储过程。根据您的需要，这可能会或可能不会发挥作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T14:52:52.543

不一定，您可以在其中进行字符串连接，并且曝光是相同的。如果您使用带有参数变量的动态 sql（没有字符串连接来生成 SQL），您将受到很好的保护。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T14:55:16.750

只要您使用参数并且不对用户输入的值使用字符串连接，就不会有 SQL 注入的风险。存储过程在这方面有点“安全”，因为它们鼓励您使用参数。但是如果在程序中你做了类似的事情

```
EXECUTE 'SELECT important_data FROM users WHERE password = ' + @password 
```

然后你将回到第 1 格，并且非常容易受到 SQL 注入的攻击。

此外，还有“准备语句”之类的东西，它们不是存储过程，但也可以使用参数。因此，它们也可用于避免 SQL 注入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T14:52:24.993

没有安全的技术。技术只能以安全或不安全的方式使用。

也就是说，存储过程需要更多创造性的编码来允许 SQL 注入——尽管如此，这种情况还是会发生。在我知道的任何 SQL 数据库引擎中，没有什么能阻止您在其中连接字符串。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T14:55:12.927

如果它们被正确参数化并且您没有执行动态 sql，那么它们会更安全，并且您还将受益于执行计划重用

# language-agnostic - 一个测试班能成为“神物”吗？

> ID：1024074
> 
> 赞同：5
> 
> 时间：2009-06-21T14:48:17.090
> 
> 标签：language-agnostic, testing, refactoring, tdd, orm

我正在开发一个开源 Python ORM 的后端。该库为每个后端包含一组 450 个测试用例，所有这些都集中在一个巨大的测试类中。

对我来说，这对于一个类来说听起来很多，但我从来没有参与过一个*有*450 个测试用例的项目（我相信这个库有大约 2000 个测试用例，不包括每个后端的测试用例）。我是否觉得这有点高端（考虑到实际上没有任何神奇的数字超过你应该分解的东西），或者对于一个测试类来说有这么多的测试不是什么大不了的事？

即使这不是太多的测试用例，如何重构一个过大的测试类？我关于重构的大部分知识都围绕着确保对正在重构的代码进行测试。我从来没有遇到过需要重构测试本身的情况。

**编辑**：以前，我说过这些是单元测试，这并不完全正确。这些被更恰当地称为集成测试。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T15:19:53.360

一节课 450 次测试听起来很多，但它有多糟糕取决于它们的组织方式。如果它们都真正独立于彼此和测试类的成员，那可能没什么大不了的——除了很难找到一个特定的测试。

另一方面，如果测试类的成员仅被某些测试使用而被其他测试忽略，则它是一种称为*Obscure Test*的测试气味，包含诸如*一般夹具*和*不相关信息*等根本原因（请注意行话 - I'会回到这个）。

有几种方法可以将测试组织到类中。最常见的模式是*Testcase Class per Class*、*Testcase Class per Feature*和*Testcase Class per Fixture*。

如何构建测试不仅在您编写测试时很重要，而且出于可维护性的原因也很重要。仅出于这个原因，我倾向于说重构测试是值得的。在 TDD 中，测试代码库（几乎）与真实代码库一样重要，应该以同样的尊重对待。

关于这个主题有一整本书，叫做[xUnit Test Patterns: Refactoring Test Code](https://rads.stackoverflow.com/amzn/click/com/0131495054)，我推荐的再多也不为过。它包含处理单元测试和 TDD 的完整模式语言，我在这里使用的所有模式名称都源自它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T15:00:51.403

我不会计算数量，而是考虑它们是否有效。也就是说，在进行单行修改时，有多少测试中断？如果您在浪费时间修复十几个无聊的测试，那么就有问题了；测试不应该一遍又一遍地重复同样的事情，如果是，他们需要重构。

我可能不会着手从上到下重构测试库，而是让它从测试驱动开发的测试-编写-重构中有机地流动。编写测试，实施增强，如果 >1 测试失败，重构测试

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T15:02:37.547

拆分测试类，以便每个类都专注于指定一种行为。例如，我编写[了一个 TDD 教程](http://github.com/orfjackal/tdd-tetris-tutorial/tree/tutorial)，其中大致有一个测试类用于一种行为（在俄罗斯方块游戏中：落块、旋转块等）。

重构测试与重构代码同样重要，因为测试应该作为文档提供良好的价值，记录系统应该做什么的意图。测试是系统的规范。

就像 Todd Gardner 在[他的回答](https://stackoverflow.com/questions/1024074/can-a-test-class-become-a-god-object/1024103#1024103)中提到的那样，如果许多测试由于更改一种方法而失败，那么许多测试都在测试相同的行为，并且每个测试测试的界限是模糊的。这导致，当测试失败时，很难知道究竟是什么被破坏了，因为许多看似无关的测试同时失败。此外，当需要更改系统的行为时，您还需要更新测试。但是，如果测试的职责不明确，就很难知道应该如何更改测试，或者测试何时过时并且应该被删除。您甚至可能需要更改大量测试，即使行为的变化很小。

一节课 450 次测试听起来非常多。测试测试什么，它们的名称是什么？它们是以系统的行为为中心（一件好事），还是它们与实现之间存在 1:1 的关系？如果他们测试了许多不相关的东西，那么将职责拆分给许多测试类会很好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-21T15:20:34.890

一组框架单元测试将在启动和设置功能中有大量重叠。在这种情况下，更改一些方法很容易破坏每个测试。尤其是ORM。

也就是说，测试应该按功能分组。X 类型的查询、联合、连接、DDL/模式检索、获取缓存、语句创建等...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T15:06:31.767

是的，但是作为“上帝对象”的测试类对我来说听起来不是问题。

# c# - 调试时无法进入迭代器块（C#）

> ID：1024080
> 
> 赞同：8
> 
> 时间：2009-06-21T14:51:13.777
> 
> 标签：c#, debugging, visual-studio-2010, iterator

我正在尝试调试从单元测试项目中执行的代码，但是当我尝试进入一个方法时，它只是直接传递到下一行，并且该方法内的断点没有被命中。该方法在不同项目中的类上，但所有代码都是在调试模式下构建的，我已经尝试清理和重建解决方案，但没有任何乐趣。

但是，这只是在我向该方法添加了一个迭代器块之后才发生的。当我删除它并重建时，我可以很好地介入。奇怪的？

我正在使用 Visual Studio 2010 Beta 1，这可能只是一个错误吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-21T14:57:11.143

迭代器块使用延迟执行 - 意思是：在您真正开始迭代数据之前，什么都不会执行。

那么：数据是否已经迭代？是否有任何值循环？如果您需要添加尽早运行的验证逻辑，您目前需要两种方法：

```
public static IEnumerable<int> GetNumbers(int from, int to) {
    // this validation runs ASAP (not deferred)
    if (to < from) throw new ArgumentOutOfRangeException("to");
    return GetNumbersCore(from, to);
}
private static IEnumerable<int> GetNumbersCore(int from, int to) {
    // this is all deferred
    while (from <= to) {
        yield return from++;
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-21T15:00:04.633

马克是正确的。该方法被延迟执行，并且在迭代器实际执行之前您无法进入该方法。

当我需要在单元测试中调试迭代器块时，我会执行以下操作。假设该方法称为 GetStuff。

```
[TestMethod]
public void TestGetStuff() {
  var obj = GetStuffObje();
  var list = obj.GetStuff().ToList();
} 
```

.ToList() 调用将强制迭代器执行完成。然后我在 GetStuff 方法中设置断点并启动调试会话

# servlets - 如何在 Servlet 启动代码中使用 J2EE Timer Service API？

> ID：1024081
> 
> 赞同：0
> 
> 时间：2009-06-21T14:52:01.140
> 
> 标签：servlets, jakarta-ee, timer, startup

对于我想在 J2EE 容器中运行的后台作业，我发现了创建启动 servlet 并使用 Timer Service API 创建托管计时器的建议（[在 J2EE 中用于定时批处理的哪些工具的答案中?](https://stackoverflow.com/questions/78194/what-tools-are-there-for-timed-batch-processes-in-j2ee) )。

要创建计时器，我需要一个实现计时器 API 的上下文。（[例](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/Session5.html)）

在 Servlet 类中，我重写了 init 方法，但它只能访问 ServletContext，而不能访问 SessionContext。ServletContext 没有创建计时器的方法，所以我被困在这里。

如何在 servlet 的启动代码中访问 J2EE 计时器服务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T15:07:51.263

每当我听到计时器作业时，我都忍不住想这应该与 Java EE 应用服务器分开。您可以使用 Quartz 之类的东西，或操作系统计划任务，或 AutoSys 之类的批处理管理器，但将其嵌入 servlet 对我来说似乎是对 servlet 的滥用。

Java EE 5 容器有一个 TimerService，它是一个 EJB。也许[这](http://java.sun.com/javaee/5/docs/tutorial/doc/bnboy.html)会帮助您解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-24T20:03:56.140

而不是使用 Servlet 启动代码（将在每次重新部署后执行），我发现在 EJB 启动时启动计时器更简洁。使用 EJB 3.1 和 Singleton EJB，现在可以用更少的代码实现这一点：

[http://blogs.oracle.com/kensaks/entry/application_startup_shutdown_callbacks](http://blogs.oracle.com/kensaks/entry/application_startup_shutdown_callbacks)

# c# - 如何更新多个表中的同一列

> ID：1024091
> 
> 赞同：0
> 
> 时间：2009-06-21T14:54:44.503
> 
> 标签：c#, sql

我想要关于如何在同一个 sql 数据库中更新多个表中的同一列的声明，但是这些表是通过该列相互关联的

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T15:13:01.020

您可以在外键约束上指定您想要的内容。检查这里，例如[MySQL 语法](http://dev.mysql.com/doc/refman/5.1/de/innodb-foreign-key-constraints.html)。

像这样的东西也应该适用于你的 sql-dialect。

```
[CONSTRAINT symbol] FOREIGN KEY [id] (index_col_name, ...)
  REFERENCES tbl_name (index_col_name, ...) ON UPDATE CASCADE

CREATE TABLE Parent(
  PID SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
  Name VARCHAR(20),
  PRIMARY KEY (PID)
);

CREATE TABLE Child(
  CID SMALLINT UNSIGNED NOT NULL PRIMARY KEY,
  PID SMALLINT UNSIGNED NOT NULL,
  FOREIGN KEY (PID) REFERENCES Parent (PID)
    ON UPDATE CASCADE
);

INSERT INTO PARENT (Name) VALUES ('Joe');
INSERT INTO PARENT (Name) VALUES ('Max');
INSERT INTO Child (CID, PID) VALUES (1, 1);
INSERT INTO Child (CID, PID) VALUES (2, 2);

SELECT * FROM Parent;
SELECT * FROM Child;

Parent             Child
+------+------+    +------+------+
| PID  | Name |    | CID  | PID  |
+------+------+    +------+------+
| 1    | Joe  |    | 1    | 1    |
+------+------+    +------+------+
| 2    | Max  |    | 2    | 2    |
+------+------+    +------+------+

UPDATE Parent SET PID='5000' WHERE PID='1';
SELECT * FROM Parent;
SELECT * FROM Child;

Parent             Child
+------+------+    +------+------+
| PID  | Name |    | CID  | PID  |
+------+------+    +------+------+
| 5000 | Joe  |    | 1    | 5000 |
+------+------+    +------+------+
| 2    | Max  |    | 2    | 2    |
+------+------+    +------+------+ 
```

在此示例中，可能存在问题，具体取决于您的 DB 系统。如果数据库系统在“AUTOINC 模式”中某个时刻不检查是否已经分配了 PID，则自动增量值可能会达到 5000，并且插入可能会失败，因为已经存在具有该 PID 的行。取决于指定自动增量时您的数据库系统如何处理主键列的更改

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T20:06:18.707

您要回答的问题是具有级联更新的外键，如 jitter 的回答中所述。但是，与大多数设计考虑因素一样，如果您回过头来分析执行此类操作的潜在需求，则不必问这个问题。

虽然这可行，但这意味着您的数据库实体上的主键随着时间的推移是不可靠的，这也意味着数据库可能必须做大量的工作来执行级联（并且它必须维护更多的锁来执行这样的更新，这增加了阻塞的可能性）。

关于随着时间的推移的可靠性，假设您有一个仓库，它维护一个帐户的历史余额：`AcctPK`, `EffectiveDate`, `Balance`, 如果您将其添加为另一个级联 FK 关系，现在您可能有大量行来级联更新到您的D B。如果数据仓库位于单独的数据库中，则无法强制引用完整性，因此不会发生级联，现在您不再具有`AcctPK`更改之前帐户的连续性。

假设您将数据导出到为每一行提供某种信息服务的供应商。现在，当供应商返回结果时，您无法匹配某些行，因为您发送的 PK 不再存在于您的数据中。

在这两种情况下，您都可以通过保留 PK 随时间变化的变化记录来解决此问题，但最终，它归结为解决（可能）糟糕的 PK 选择。

如果主键经常发生变化，我强烈建议您重新考虑选择主键。一种替代方法是使用代理`IDENTITY`或自动编号作为 PK（使用基于此的 FK 关系）。它永远不需要级联更新，并且您当前用作“自然”主键的其他字段可以正常更改`UPDATE`而无需进行级联。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T15:00:59.157

更改主键从来都不是一件有趣的事：这就是为什么许多人更喜欢[合成](http://en.wikipedia.org/wiki/Surrogate_key)键而不是自然键。没有单语句标准的 SQL 方式来做这件事；相反，您必须使用新的主键插入主表行的副本，更新子表以引用新行，并删除原始行。

# asp.net - Fresh .NET 开发人员的评估表？

> ID：1024094
> 
> 赞同：2
> 
> 时间：2009-06-21T14:55:41.723
> 
> 标签：asp.net

我们有一些新的 .net 开发人员，我们会给他们一个 ASP.NET 任务，大约需要 2 周的时间，之后我们将对他们进行单独评估，并选择保留其中的一些。

任何人都可以提出一些基本点来考虑这个评估吗？如果您有任何参考，那也将受到欢迎。我们希望以非常专业的方式做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-22T20:19:38.790

衡量代码质量之类的东西可能很困难。这是主观的，可能是时间的函数。

我认为基于 ASP.NET 的应用程序使这个问题变得更糟，因为不仅核心语言每隔几年就会发生巨大变化，而且影响您的应用程序的新技术（WPF/Silverlight/XAML、WCF、ASP.NET MVC）一直在出来。

如果您在某个特定点上寻找最佳实践，那可能会导致您抛弃一个真正理想的候选人。我不太担心“我在代码中寻找什么？” 以及更多关于“我在候选人中寻找什么？”

这是我希望的：

*   *他们有兴趣学习吗？*这是非常重要的一点。如果你向他们提供反馈，他们会倾听吗？他们是否主动寻求更好的做事方式？如果下一个大技术出现，我可以指望他们自己增加 API 吗？

*   *他们对软件开发有热情吗？*他们对发展感到兴奋吗？这是他们的核心竞争力，还是他们对薪水更兴奋？他们是否在业余时间做一些事情来保持他们的技能？

*   *他们在没有监督的情况下工作得好吗？*他们会让自己被小细节阻碍并错过交付成果，还是会主动寻求重回正轨？如果给他们一个任务，我可以指望他们在没有微观管理的情况下完成它吗？

如果我正在查看代码，我的优先级将是：

*   *他们编写的代码在功能上是否正确？*他们的输出是否真的有效并满足所有业务需求？它是以稳定的方式这样做，还是崩溃？

*   *Is their code easy to read and maintain?* Does the application adapt to changing business requirements well, or are changes impossible without intimate knowledge of the code?

*   *Are they making an effective use of readily-available data structures, or are they reinventing the wheel?* If they are reinventing the wheel, do they take my feedback to heart in future deliverables, do they reject my feedback with a well-reasoned argument, or do they continue along the same path?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T19:48:24.467

首先，您必须准确决定要评估的内容，并相应地自定义您的任务和评分标准。一些想法：

*   代码质量/清洁度。用户是否以一种有意义的方式彻底地评论了他们的代码？它们的变量名容易理解吗？他们的布局格式是否正确且易于遵循？
*   知识库。这个人是否很好地使用了一组选定的方法，或者他们是否通过他们如何使用数据库、清理他们的连接等来展示在 .NET 编程的不同领域的经验？
*   批判性思维能力。用户能否考虑可能的解决方案，即使有一些东西阻碍了最明显的答案？他们提出的解决方案有多独特 - 它是标准的封闭式解决方案，还是在构建它时着眼于以后的添加或修改（即使他们没有专门负责此任务，它也可以表明这始终是他们思想的一部分）。
*   团队合作。你能给这个人一个他们需要与他人互动的任务，还是你只是在寻找他们“靠自己”技能水平的一个例子？
*   业务环境。他们是否会询问有关它将用于什么的问题，并尝试根据最终用户的需求进行操作？
*   与互联网上的其他解决方案相似。虽然我希望他们自己想出一个解决方案，但在 Google 上搜索他们的代码段会返回完全匹配的结果吗？你认为这是一个加号（他们没有浪费时间重新发明轮子）还是一个减号（他们逐字复制了大部分，并且不能自己编写代码）。

虽然有一些明显的好/坏点，但其他的取决于你——你想要一个考虑客户需求并做出相应反应的人，还是你想要一个坚持规范的人？这个人会单独工作还是协作？

如果您可以提供更多关于您正在寻找什么资格的指示，或者您可能认为哪些分数是加分项，那么我可以自定义我的答案以帮助您选择一些符合您所追求的标准。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T20:00:36.830

除了已经说过的内容之外，您还应该测量它们的代码可维护性。这类似于代码的同行评审。

一些新开发者认为自己对 5 层嵌套继承非常“聪明”，他们做得很好，代码干净，带有一些文档。但是没有人愿意调试和更新这些东西。

# linux - ini/config 文件在 linux/unix 中的位置？

> ID：1024114
> 
> 赞同：78
> 
> 时间：2009-06-21T15:07:26.287
> 
> 标签：linux, unix, configuration

两个问题，真的：

1.  是否有关于配置文件放置的标准/约定？

    对于系统或准系统程序，它们似乎通常位于`/etc`. 对于普通的应用程序或对`/etc`.

2.  在处理程序选项中是否有优先级的标准层次结构？例如，命令行选项是否覆盖了初始化文件和/或环境变量？反之亦然？还是这完全取决于开发人员？

* * *

## 回答 #1

> 赞同：191
> 
> 时间：2009-06-21T17:10:42.980

您应该使您的应用程序遵守**[XDG 基本目录规范](http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html)**。这里的大多数答案要么已过时，要么错误。

您的应用程序应在以下环境变量指向的目录中存储和加载数据和配置文件：

*   **`$XDG_DATA_HOME`**（默认值：）`"$HOME/.local/share"`：用户特定的数据文件。
*   **`$XDG_CONFIG_HOME`**（默认值：）`"$HOME/.config"`：用户特定的配置文件。
*   **`$XDG_DATA_DIRS`**（默认值：）：`"/usr/local/share/:/usr/share/"`系统数据目录的优先顺序集。
*   **`$XDG_CONFIG_DIRS`**（默认值：）：`"/etc/xdg"`系统配置目录的优先顺序集。
*   **`$XDG_CACHE_HOME`**（默认值：）`"$HOME/.cache"`：用户特定的非必要数据文件。

您应该首先确定相关文件是否为：

1.  一个配置文件（`$XDG_CONFIG_HOME:$XDG_CONFIG_DIRS`）；
2.  一个数据文件（`$XDG_DATA_HOME:$XDG_DATA_DIRS`）；或者
3.  非必要（缓存）文件 ( `$XDG_CACHE_HOME`)。

建议您的应用程序将其文件放在上述目录的子目录中。通常，类似`$XDG_DATA_DIRS/<application>/filename`or的东西`$XDG_DATA_DIRS/<vendor>/<application>/filename`。

加载时，您首先尝试从用户特定目录 ( `$XDG_*_HOME`) 加载文件，如果失败，则从系统目录 ( `$XDG_*_DIRS`) 加载。保存时，仅保存到用户特定的目录（因为用户可能没有对系统目录的写入权限）。

有关其他更多面向用户的目录，请参阅**[XDG 用户目录规范](http://www.freedesktop.org/wiki/Software/xdg-user-dirs)**。它定义了桌面、下载、文档、视频等的目录。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-06-21T15:11:02.630

1.  通常系统/全局配置存储在 /etc 下的某处。
2.  用户特定的配置存储在用户的主目录中，通常作为隐藏文件，有时作为包含非隐藏文件（可能还有更多子目录）的隐藏目录。

一般来说，命令行选项将覆盖环境变量，这些环境变量将覆盖用户默认值，而用户默认值将覆盖系统默认值。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-06-21T16:03:50.907

## 较新的应用程序

遵循[XDG 基本目录规范](http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html)通常`~/.config/yourapp/*`可以是 INF、JSON、YML 或任何适合您的格式，以及任何文件......`yourapp`应该与您的可执行文件名称匹配，或者使用您的组织/公司/用户名/句柄命名`~/.config/yourorg/yourapp/*`

## 旧应用程序

每个用户的配置，通常就在您的主目录中...

*   `~/.yourapp`单个文件的文件
*   `~/.yourapp/`对于多个文件+数据，通常在*~/.yourapp/config*

全局配置通常在`/etc/appname`文件或`/etc/appname/`目录中。

全球应用数据：`/var/lib/yourapp/`

缓存数据：`/var/cache/`

日志数据：`/var/log/yourapp/`

* * *

***[来自tutorialhelpdesk.com](http://www.tutorialhelpdesk.com/tutorials/tech-talk/linux/the-linux-directory-structure-explained.html)的一些附加信息***

Linux/其他类 Unix 系统的目录结构和目录详细信息。

在 Windows 中，几乎所有程序都将它们的文件（所有文件）安装在名为：'Program Files' 的目录中，这在 Linux 中并非如此。目录系统对所有已安装的文件进行分类。所有配置文件都在 中`/etc`，所有二进制文件都在`/bin`or`/usr/bin`或`/usr/local/bin`中。这是整个目录结构及其包含的内容：

`/`- 构成文件系统基础的根目录。所有文件和目录在逻辑上都包含在根目录中，无论它们的物理位置如何。

`/bin`- 包含作为 Linux 操作系统一部分的可执行程序。许多 Linux 命令，例如 cat、cp、ls、more 和 tar，都位于`/bin`

`/boot`- 包含 LILO 和 GRUB 引导管理器所需的 Linux 内核和其他文件。

`/dev`- 包含所有设备文件。Linux 将每个设备视为一个特殊文件。所有此类文件都位于`/dev`.

`/etc``/etc/rc.d`- 包含大多数系统配置文件和子目录中的初始化脚本。

`/home`- 主目录是用户主目录的父目录。

`/lib`- 包含库文件，包括启动系统所需的可加载驱动程序模块。

`/lost+found`- 丢失文件的目录。每个磁盘分区都有一个 lost+found 目录。

`/media`- 用于在 CD-ROM 驱动器、软盘和 Zip 驱动器等可移动媒体上安装文件系统的目录。

`/mnt`- 临时挂载文件系统的目录。

`/opt`- 可选软件包在此处复制/安装文件。

`/proc`- 虚拟文件系统中的特殊目录。它包含有关 Linux 系统各个方面的信息。

`/root`- root 用户的主目录。

`/sbin`- 包含管理二进制文件。mount、shutdown、umount 等命令驻留在此处。

`/srv`- 包含系统提供的服务（HTTP、FTP 等）的数据。

`/sys`- 一个包含设备信息的特殊目录，如 Linux 内核所见。

`/tmp`- 可用作临时目录的临时目录（临时文件的存储）。每次系统启动时都会清除此目录的内容。

`/usr`- 包含许多程序的子目录，例如 X Window 系统。

`/usr/bin`- 包含许多 Linux 命令的可执行文件。它不是核心 Linux 操作系统的一部分。

`/usr/include`- 包含 C 和 C++ 编程语言的头文件

`/usr/lib`- 包含 C 和 C++ 编程语言的库。

`/usr/local`- 包含本地文件。它具有与 /usr 类似的目录。

`/usr/sbin`- 包含管理命令。

`/usr/share`- 包含共享的文件，例如默认配置文件、图像、文档等。

`/usr/src`- 包含 Linux 内核的源代码。

`/var`- 包含各种系统文件，如日志、邮件目录、打印假脱机等，这些文件的数量和大小会随着时间而变化。

`/var/cache`- 应用程序缓存数据的存储区域。

`/var/lib`- 包含与应用程序当前状态相关的信息。程序在运行时会对此进行修改。

`/var/lock`- 包含由应用程序检查的锁定文件，以便资源只能由一个应用程序使用。

`/var/log`- 包含不同应用程序的日志文件。

`/var/mail`- 包含用户的电子邮件。

`/var/opt`- 包含存储在 /opt 目录中的包的可变数据。

`/var/run`- 包含描述系统自启动以来的数据。

`/var/spool`- 包含正在等待某种处理的数据。

`/var/tmp`- 包含在系统重新启动之间保留的临时文件。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-06-21T16:26:43.953

另请参阅[文件系统层次标准](http://refspecs.linuxfoundation.org/fhs.shtml)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-21T15:13:53.497

1.  通常在用户主目录中的点文件（如 .myprogramrc）中。
2.  这当然取决于程序员，但通常命令行参数会覆盖其他所有内容。如果使用环境变量，它通常可以替代命令行参数或指定配置所在的位置。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-21T16:40:03.023

对于用户配置，我注意到从个人`~/.myprogramrc`转向下面的结构的趋势`~/.config`。例如，Qt 4 使用`~/.config/<vendor>/<programname>`默认设置`QSettings`. 主要的桌面环境 KDE 和 Gnome 也使用特定文件夹下的文件结构（不确定 KDE 4 是否使用`~/.config`，XFCE 是否使用`~/.config`）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-21T15:11:30.163

(1) 不（很遗憾）。*编辑：*其他答案是正确的，每个用户的配置通常存储在用户主目录中的点文件或点目录中。任何高于用户级别的东西通常都是很多猜测。

(2) 系统范围的ini文件->用户ini文件->环境->命令行选项（从低到高优先级）

# c# - SQL插入一行或多行数据？

> ID：1024123
> 
> 赞同：10
> 
> 时间：2009-06-21T15:11:12.363
> 
> 标签：c#, sql, sql-server, sql-server-2005, tsql

我正在开发一个控制台应用程序以将数据插入 MS SQL Server 2005 数据库。我有一个要插入的对象列表。这里我以 Employee 类为例：

```
List<Employee> employees; 
```

我能做的是像这样一次插入一个对象：

```
foreach (Employee item in employees)
{
  string sql = @"INSERT INTO Mytable (id, name, salary) 
    values ('@id', '@name', '@salary')";
  // replace @par with values
  cmd.CommandText = sql; // cmd is IDbCommand
  cmd.ExecuteNonQuery();
} 
```

或者我可以像这样构建一个拒绝插入查询：

```
string sql = @"INSERT INTO MyTable (id, name, salary) ";
int count = employees.Count;
int index = 0;
foreach (Employee item in employees)
{
   sql  = sql + string.format(
     "SELECT {0}, '{1}', {2} ",
     item.ID, item.Name, item.Salary);
   if ( index != (count-1) )
      sql = sql + " UNION ALL ";
   index++
 }
 cmd.CommandType = sql;
 cmd.ExecuteNonQuery(); 
```

我猜后一种情况是一次插入多行数据。但是，如果我有几个 ks 的数据，SQL 查询字符串是否有任何限制？

在性能方面，我不确定一个多行插入是否比一个插入一行数据更好？

有什么建议可以更好地做到这一点吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-21T15:50:46.330

实际上，按照您编写的方式，您的第一个选择会更快。

1.  你的第二个例子有问题。您正在执行 sql = + sql + 等。这将导致为循环的每次迭代创建一个新的字符串对象。（查看 StringBuilder 类）。从技术上讲，您也将在第一个实例中创建一个新的字符串对象，但不同之处在于它不必复制前一个字符串选项中的所有信息。

2.  按照你的设置方式，当你最终发送它时，SQL Server 将不得不潜在地评估一个大规模的查询，这肯定需要一些时间来弄清楚它应该做什么。我应该说，这取决于你需要做多少插入。如果 n 很小，你可能会没事，但随着它的增长，你的问题只会变得更糟。

由于 SQL Server 处理批处理事务的方式，批量插入比单个插入要快。如果您要从 C# 插入数据，您应该采用第一种方法，并将每 500 次插入包装到一个事务中并提交它，然后执行下一个 500 次，依此类推。这还有一个好处是，如果批处理失败，您可以捕获它们并找出问题所在并重新插入那些。还有其他方法可以做到这一点，但这绝对是对提供的两个示例的改进。

```
var iCounter = 0;
foreach (Employee item in employees)
{

   if (iCounter == 0)
  {
    cmd.BeginTransaction;
  }
  string sql = @"INSERT INTO Mytable (id, name, salary) 
    values ('@id', '@name', '@salary')";
  // replace @par with values
  cmd.CommandText = sql; // cmd is IDbCommand
  cmd.ExecuteNonQuery();
  iCounter ++;
  if(iCounter >= 500)
  {
     cmd.CommitTransaction;
     iCounter = 0;
  }
}

if(iCounter > 0)
   cmd.CommitTransaction; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-11T06:36:13.777

在 MS SQL Server 2008 中，您可以创建包含您的表的 .Net table-UDT

```
CREATE TYPE MyUdt AS TABLE (Id int, Name nvarchar(50), salary int) 
```

然后，您可以在存储过程中使用此 UDT，并将您的 с#-code 用于批量插入。SP：

```
CREATE PROCEDURE uspInsert
 (@MyTvp AS MyTable READONLY)
AS
     INSERT INTO [MyTable]
      SELECT * FROM @MyTvp 
```

C#（假设您需要插入的记录已包含在 DataSet ds 的表“MyTable”中）：

```
using(conn)
{
    SqlCommand cmd = new SqlCommand("uspInsert", conn);
    cmd.CommandType = CommandType.StoredProcedure;

    SqlParameter myParam = cmd.Parameters.AddWithValue
     ("@MyTvp", ds.Tables["MyTable"]);

    myParam.SqlDbType = SqlDbType.Structured;
    myParam.TypeName = "dbo.MyUdt";

    // Execute the stored procedure
    cmd.ExecuteNonQuery();
} 
```

所以，这就是解决方案。

最后我想阻止你使用像你这样的代码（构建字符串然后执行这个字符串），因为这种执行方式可能用于 SQL 注入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T15:21:56.243

看看[这个线程](https://stackoverflow.com/questions/1024018/sql-stored-procedure-with-a-lot-of-parameters/1024033#1024033)，我已经回答了关于表值参数的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T15:23:56.690

[批量复制](http://msdn.microsoft.com/en-us/library/7ek5da1a.aspx)通常比自己插入要快。

如果您仍想以建议的方式之一执行此操作，则应该这样做，以便您可以轻松更改发送到服务器的查询的大小。这样您就可以在以后优化生产环境中的速度。查询时间可能因查询大小而异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T15:25:27.063

SQL Server 查询的批处理大小为 65,536 * 网络数据包大小。网络数据包大小默认为 4kbs，但可以更改。查看 SQL 2008 的[最大容量文章](http://msdn.microsoft.com/en-us/library/ms143432.aspx)以了解范围。SQL 2005 似乎也有同样的限制。

# javascript - Dashboard Widget 首选项实际保存在哪里？

> ID：1024126
> 
> 赞同：6
> 
> 时间：2009-06-21T15:12:53.577
> 
> 标签：javascript, macos, widget, dashboard, dashcode

这是我的其他[小部件相关问题的后续问题](https://stackoverflow.com/questions/1023397/dashboard-widget-is-reset-in-case-of-a-new-version-any-way-to-prevent-this)。
我想检查实际写入小部件首选项的内容。这些数据实际存储在哪里？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T15:47:19.593

每个小部件的首选项和仪表板本身都保存在文件夹 /Users/YOUR-USER-NAME/Library/Preferences/ 中。

# visual-studio - 视觉工作室属性缺少字符

> ID：1024136
> 
> 赞同：0
> 
> 时间：2009-06-21T15:19:52.423
> 
> 标签：visual-studio, visual-studio-2008, fonts

我刚刚在 6 个月内首次启动了 Visual Studio Express 2008，当我展开属性窗口时，所有名称/值都呈现为正方形。事件椭圆（...）是正方形！奇怪的是，所有其他文本都可以，代码、工具栏、菜单等。

Visual Studio 对此文本使用什么字体/字符集？为什么只有属性窗口受到影响？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T15:24:48.577

这很奇怪。我还没有看到这样的错误。

如果是字体问题，您可以通过重置所有设置来修复它。转到工具 -> 导入/导出设置。重置所有设置并选择您的个人资料。重建并重新启动 Visual Studio 并查看问题是否消失。

我的第二个猜测是检查文件编码。Visual Studio 应该适用于大多数文件编码，但进行完整性检查也不错。单击文件 -> 另存为并将文本类型设置为 ASCII。然后重新启动 Visual Studio 并查看问题是否消失。

# python - 如何阻止 Python parse_qs 将单个值解析为列表？

> ID：1024143
> 
> 赞同：55
> 
> 时间：2009-06-21T15:23:35.663
> 
> 标签：python, python-2.6

在 python 2.6 中，以下代码：

```
import urlparse
qsdata = "test=test&test2=test2&test2=test3"
qs = urlparse.parse_qs(qsdata)
print qs 
```

给出以下输出：

```
{'test': ['test'], 'test2': ['test2', 'test3']} 
```

这意味着即使只有一个 test 值，它仍然被解析成一个列表。有没有办法确保如果只有一个值，它不会被解析成一个列表，所以结果看起来像这样？

```
{'test': 'test', 'test2': ['test2', 'test3']} 
```

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2011-11-23T08:35:34.670

对于只想要一个简单的字典并且从不需要具有相同键的多个值的人的旁注，请尝试：

```
dict(urlparse.parse_qsl('foo=bar&baz=qux')) 
```

这会给你一个很好的`{'foo': 'bar', 'baz': 'qux'}`。请注意，如果同一个键*有*多个值，您只会得到最后一个。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-06-21T15:35:11.600

以后可以修...

```
import urlparse
qsdata = "test=test&test2=test2&test2=test3"
qs = dict( (k, v if len(v)>1 else v[0] ) 
           for k, v in urlparse.parse_qs(qsdata).iteritems() )
print qs 
```

但是，我不认为*我*会想要这个。如果一个通常是列表的参数碰巧只有一个项目集到达，那么我将有一个字符串而不是我通常收到的字符串列表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-10-20T17:26:01.807

扩展@SingleNegationElimination 的答案。如果你做这样的事情，你只能使用查询参数的最后一个实例。

```
from urllib.parse import parse_qs
qsdata = "test=test&test2=test2&test2=test3"
dict((k, v[-1] if isinstance(v, list) else v)
      for k, v in parse_qs(qsdata).items())

# Returns: {'test': 'test', 'test2': 'test3'} 
```

或者您可以使用以下内容仅保留 url 参数的第一个实例：

```
from urllib.parse import parse_qs
qsdata = "test=test&test2=test2&test2=test3"
dict((k, v[0] if isinstance(v, list) else v)
      for k, v in parse_qs(qsdata).items())

# Returns: {'test': 'test', 'test2': 'test2'} 
```

# asp.net - 如何在 ASP.NET 中自定义发布？

> ID：1024145
> 
> 赞同：7
> 
> 时间：2009-06-21T15:24:26.613
> 
> 标签：asp.net, powershell, msbuild, publishing

我正在做一个相当新的项目，我们从头开始。所以不仅需要开发Web应用程序本身，而且发布站点和配置Web服务器等的整个过程都需要从头开始。

这个问题可能更适合服务器故障，但这实际上取决于答案。所以，让我们试一试。

我曾经通过 VS2008 发布我们的网站（右键单击网站，发布网站，等待...完成）我需要以某种方式调整流程并触发其他一些任务，例如： - 从我的 dav 机器复制一些文件夹到Web 服务器 - 删除测试数据库并让一些脚本在其上运行 - 也许还有一些我现在不记得了。

我正在阅读最明显的解决方案，如 MSBuild、Powershell 和 VSTS2008，但我真的不想深入研究它们，直到我真正知道这些工具实际上可以解决我的问题。所以伙计们，我很确定你们中的很多人都对这些工具有很多了解，或者甚至知道更好的工具。请告诉我。我真的很感激。

这就是我生活的环境：-VS 2008 - VSTS 2008 - SQL Server 2008 - Windows Server 2008

更新：到目前为止，感谢您提供的出色答案，但我特别在寻找集成到 Visual Studio Team Foundation Server 中的解决方案，因为我们已经将它用于源代码控制。

干杯，史蒂夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T17:51:53.240

我们使用 Subversion 部署我们的 Web 应用程序，并且对它非常满意。

构建服务器编译应用程序，将其复制到部署目录并将更改签入到 Subversion 存储库。好吧，我承认这不是微不足道的，但值得在这里投资......因为在服务器上部署现在非常容易。优点是：

*   仅将必要的文件复制到服务器，停机时间最短（使用 svn update）
*   验证部署到服务器的版本是小菜一碟，并且很容易在多个 Web 服务器上拥有一致的版本
*   如果您搞砸了，只需单击 2 次即可恢复到以前的版本
*   它负责在您部署新版本时删除文件。在旧版本上复制 Web 应用程序可能会留下潜在的危险文件
*   web.config 中的修改不会被部署覆盖，它们会被合并。这真的是一个很大的优势

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T15:28:36.137

您可以设置构建前和构建后事件，并且可以让其中一个事件触发脚本来完成您的任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T18:11:53.863

您可能会查看 IIS [Web 部署工具](http://www.iis.net/downloads/default.aspx?tabid=34&g=6&i=1602)是否适合您的场景；它允许您一起发布您的网站、配置设置、数据库等。这也将集成到 Visual Studio 2010 中。

# php - mod_rewrite 到 text/type/id

> ID：1024151
> 
> 赞同：3
> 
> 时间：2009-06-21T15:26:28.217
> 
> 标签：php, mod-rewrite, seo

我当前的代码是这样的

```
store.php?storeid=12&page=3 
```

我想把它翻译成这样的东西

```
mysite.com/roberts-clothing-store/store/12/3 
```

和这样的：

```
profile.php?userid=19 
```

至

```
mysite.com/robert-ashcroft/user/19 
```

我知道最好将 SEO 友好的文本放在尽可能远的位置，即**不要**

```
mysite.com/user/19/robert-ashcroft 
```

（stackoverflow 做了什么）

我不知道如何在 apache 的 mod_rewrite 中做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T15:35:06.450

实际上，您可能不得不“颠倒”地思考`mod_rewrite`.

最简单的方法是让您的**PHP 发出重写的** `mysite.com/roberts-clothing-store/store/12/3` **链接**。

**`mod_rewrite`**然后**将请求代理**到**一个 PHP 页面**，`rewrite.php?path=roberts-clothing-store/store/12/3`该页面将**解码 URL**并设置参数（此处`storeid`和`page`）并**动态包含**正确的**PHP 文件**，**或者**只为**重命名**的页面发出**301 。**

 **一个纯粹的解决方案`mod_rewrite`是可能的，但是**这个解决方案更容易**正确，尤其是当你不掌握`mod_rewrite`.

主要**问题**可能是**开销**可能很大，但代价是简单性和灵活性。`mod_rewrite`快得多

## 更新：

其他帖子**确实**回答了这个问题，但它们并没有解决典型的重​​复内容问题，这些问题通过使用规范的 url 来避免（并且对所有看起来不错但不是的 URL 使用 301/404）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T22:35:05.910

```
RewriteRule ^roberts-clothing-store/store/([^.]+)/([^.]+)$ store.php?id=$1&page=$2
RewriteRule ^robert-ashcroft/user/([^.]+)$ profile.php?userid=$1 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T15:41:13.723

试试这些规则：

```
RewriteRule ^[^/]+/store/([0-9]+)/([0-9]+)$ store.php?storeid=$1&page=$2 
RewriteRule ^[^/]+/user/([0-9]+)/ profile.php?userid=$1 
```

但我不会使用这样的 URL。当您将 URL 路径视为层次结构并将路径段视为它们的级别时，它们没有意义。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-21T15:41:47.000

然后您可以在 .htaccess 中使用 RewriteRule 指令，例如：

```
RewriteRule roberts-clothing-store/store/(\d+)/(\d+)$ store.php?storeid=$1&page=$2 [L] 
```

请参阅[http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)寻求帮助，或 google。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T15:55:09.733

我的方法是使 .htaccess 尽可能简单，并在 PHP 中完成所有艰苦的工作：

```
RewriteRule ^(.*?)$ index.php?$1 
```

这基本上意味着获取所有内容并将其重新路由到我的 index.php 文件（在 css/javascript/image 目录中，我只需使用“RewriteEngine off”来访问这些文件）。在 PHP 中，我不仅仅是 split("/", $param, 5) 字符串并运行 foreach() 来检查所有参数。封装在一个很好的函数中，这对我来说很好。

**更新：**

对于这种简单的情况，我强烈建议使用explode() 而不是split()，因为explode() 不会带来使用正则表达式的开销。**

# nhibernate - NHibernate 映射问题

> ID：1024154
> 
> 赞同：1
> 
> 时间：2009-06-21T15:27:50.490
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

我尝试了各种方法来映射以下结构，但我最终承认，经过一天的努力，我需要一些帮助。

所以问题是，你们将如何映射这样的东西。架构在这一点上不固定。

```
public abstract class BaseObject
{
    public virtual int Id { get; set; }
    public virtual string Name { get; set; }
    public virtual string Description { get; set; }
    public virtual string Prefix { get; set; }
    public virtual string Suffix { get; set; }
    public virtual BaseObject Parent { get; set; }
}

public class Room : BaseObject
{
    public virtual int AreaId { get; set; }

}

public class Item : BaseObject
{
    public virtual string Owner { get; set; }
    public virtual IList<ItemAttribute> Attributes { get; set; }
    public virtual int ItemTypeId { get; set; }

}

public class Potion : Item
{
    public virtual int AmountLeft { get; set; }
} 
```

非常感谢您的意见。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-19T22:54:05.833

这使您可以将所有内容都放在一个表中...从内存中执行此操作，因此语法可能不准确。

```
public class ItemMap : ClassMap<BaseObject>
{

...

   WithTable("objects");
    Id(x => x.Id).GeneratedBy.Identity();
    Map(x => x.Name);
    Map(x => x.Description);

    ...

    DiscriminateSubClassesOnColumn("Type")

      .SubClass<Room>("Room", x =>
                    {
                        x.Map(r => r.AreaId);
                    })

      .SubClass<Item>("Item", c =>
                                                {
                                                    i.Map(x => x.Owner);
                                                    i.References(x => x.Account).LazyLoad();
                                                    HasManyToMany(x => x.Attributes)
                                                      .WithParentKeyColumn("ItemId")
                                                      .WithChildKeyColumn("AttributeId")
                                                      .WithTableName("ItemAttributes")
                                                      .LazyLoad();    
                                                });

     .SubClass<Potion>("Potion", x =>
                    {
                        x.Map(p => p.AmountLeft);
                    }) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-19T22:45:44.367

我可能会为每个班级准备一张桌子——房间、物品、药水，然后为每个班级做相当标准的映射。

我想指出，根据我自己的经验，将业务对象中的 Id 字段命名为“Id”是个坏主意

这是一个带有 Item 的示例，它为您的表组合了一些数据名称。

```
public class ItemMap : ClassMap<Item>
    {
        public ItemMap()
        {
            WithTable("Items");

            Id(x => x.Id, "ItemId").GeneratedBy.Identity();

            Map(x => x.Name);
            Map(x => x.Description);
            Map(x => x.Prefix);
            Map(x => x.Suffix);
            Map(x => x.Owner);
            Map(x => x.ItemTypeId);

            References<Item>(x => x.Parent, "ParentItemId");

            HasManyToMany(x => x.Attributes)
                 .WithParentKeyColumn("ItemId")
                 .WithChildKeyColumn("AttributeId")
                 .WithTableName("ItemAttributes")
                 .LazyLoad();
        }
    } 
```

这很可能并不完美——因为我不确定映射将如何与抽象父级一起使用。

# java - 如何终止 NetBeans 中正在运行的 Maven 构建？

> ID：1024161
> 
> 赞同：1
> 
> 时间：2009-06-21T15:32:12.773
> 
> 标签：java, maven-2, netbeans, process

如果我在 NetBeans 中运行 Maven 构建，它启动了一个长时间运行的 Java 进程（例如 HTTP 侦听器或 JMX 代理），终止该进程似乎没有任何效果。所以我必须重新启动 NetBeans 并手动终止进程。我在 Windows XP 和 Vista 上使用 NetBeans 6.5 和 6.7 RC 1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T17:18:24.580

基本上它在当前版本的 Netbeans 中被破坏了，请参阅：[http ://www.netbeans.org/issues/show_bug.cgi?id=135475](http://www.netbeans.org/issues/show_bug.cgi?id=135475)

我所做的只是停止构建，然后找到 Java 进程并杀死它。只要确保你杀死了 Maven 构建过程而不是 IDE。无需重新启动 Netbeans。如果您的进程有另一种关闭方式（如 Tomcat 的关闭命令），您可以使用运行它的 exec 插件创建自定义 Maven 目标。

# c# - 需要通过 USB 端口控制的 Switch 组件

> ID：1024166
> 
> 赞同：1
> 
> 时间：2009-06-21T15:36:36.260
> 
> 标签：c#, vb.net

我需要由代码（.net、C# 或 vb）控制的设备开关组件开/关状态就足够了。我在 C#、.net 窗口应用程序中有代码知识，我需要制作一个可以使用来控制的开关通过 USB 端口进行编码...以便使用该开关在特定时间间隔内打开/关闭电气设备（风扇、灯）。对于我的 MINI 项目

注意：我需要关于所需组件以及如何组装它的简要说明。

如果您知道任何类似于此类项目的链接，请参考我。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T16:05:35.837

您可能需要考虑为此目的使用[FTDI芯片。](http://www.ftdichip.com/)它们确实具有可用的[.NET 接口](http://www.ftdichip.com/Projects/CodeExamples/CSharp.htm)以及传统的 C DLL。

FTDI 提供两种类型的驱动程序 - 一种模拟简单的 COM 端口（虚拟 COM 端口，这对您来说可能就足够了），另一种更像是直接 USB 控制 (D2XX)，尽管它仍然显示为 COM 端口USB 设备已连接。

另一方面，如果您*真的*只需要开/关支持，您可能只需要使用[.net 串行端口驱动程序](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx)进行最基本的通信。当然，串行端口驱动程序不允许您将串行端口引脚绑定为高电平或低电平，因此您需要一些方法来读取来自 PC 的数据。许多微控制器都为此目的提供免费的 UART 库，但您还需要为此获得一个 RS232 电平转换 IC，因为 PC 的串行端口输出 +/- 6V IIRC（可能是 +/- 12V），而大多数微控制器运行并接受 0/5V 或 0/3.3V 的信号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T15:58:44.930

您可以尝试[Arduino之类的产品或](http://www.arduino.cc/)[Sanguino](http://sanguino.cc/)之类的克隆产品之一。对于您的项目来说，这可能有点矫枉过正，但它们是预先组装好的，并且有很大的支持基础。

您还（对于任何低压开关电路）需要某种形式的继电器板来切换使用主电源运行的电器。请参阅[此处](http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1245154602/0)了解一些想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T15:53:06.970

您确定必须使用 USB 端口执行此操作吗？

您需要一个实现整个 USB 接口的设备。这不像在 COM 端口（RTS/DSR 等）上使用线路或使用并行端口那么简单。

快速搜索发现[这个](http://www.delorie.com/electronics/usb-gpio/)...

# django - Django：有没有更好的方法来加粗当前页面链接

> ID：1024168
> 
> 赞同：7
> 
> 时间：2009-06-21T15:37:42.983
> 
> 标签：django, django-templates, django-urls

我有一个包含链接列表的 base.html 模板。

例子：

```
 <div id="sidebar1">
        <ul>
        <li><a href="/" title="">Index</a></li>
        <li><a href="/stuff/" title="" class="current">Stuff</a></li>
        <li><a href="/about/" title="">About Me</a></li>
        <li><a href="/contact/" title="">Contact Me</a></li>
    </div> 
```

然后我在views.py 中有一个index.html、stuff.html、about.html 和contact.html 的定义。这些模板中的每一个都简单地从 base.html 模板派生并设置各自的标题和内容。

我的问题是关于上述/stuff 我有一个 class="current"。

我想让我所在的当前页面具有该类属性。

我可以在每个视图中设置一个不同的变量，例如 current_page="about" 然后在模板中与`{% ifequal %}`每个链接的每个类元素中进行比较，但这似乎是重复工作（因为额外的视图变量）。

有没有更好的办法？也许如果有一种方法可以获取自动填充模板的视图函数名称，我不需要设置额外的变量？此外，它似乎确实有很多 ifequals。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-21T16:01:38.020

这是一种优雅的方法，我从某个地方复制了它，我只希望我能记住在哪里，所以我可以给他们功劳。8-)

`id`我为我的每个页面（或一个部分中的所有页面）分配一个，如下所示：

```
In index.html:    <body id='section-intro'>...
In faq.html:      <body id='section-faq'>...
In download.html: <body id='section-download'>... 
```

然后是`id`相应的链接：

```
<li id='nav-intro'><a href="./">Introduction</a></li>
<li id='nav-faq'><a href="./faq.html">FAQ</a></li>
<li id='nav-download'><a href="./download.html">Download</a></li> 
```

在 CSS 中，我设置了这样的规则：

```
#section-intro #nav-intro,
#section-faq #nav-faq,
#section-download #nav-download {
    font-weight: bold;
    /* And whatever other styles the current link should have. */
} 
```

因此，这主要以声明性方式控制当前页面所属链接的样式。您可以在此处查看它的实际效果：http: [//entrian.com/source-search/](http://entrian.com/source-search/)

一旦你设置了它，它就是一个非常干净和简单的系统，因为：

*   您无需在链接中使用模板标记
*   你最终不会使用大而丑陋的`switch`陈述或`if / else / else`陈述
*   将页面添加到部分 Just Works [TM]
*   改变事物的外观只意味着改变 CSS，而不是标记。

我没有使用 Django，但是这个系统可以在任何地方工作。在您的情况下，您“设置各自的标题和内容”还需要设置`body id`，并且不需要其他 Django 标记。

这个想法也很容易扩展到其他情况，例如。“除了下载页面本身，我希望每个页面的侧边栏中都有一个下载链接。” 你可以在 CSS 中这样做：

```
#section-download #sidebar #download-link {
    display: none;
} 
```

而不必将条件模板标记放在侧边栏 HTML 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T16:41:57.703

没有使用过 Django，但我在[Kohana](http://kohanaphp.com/) (PHP) 和 Rails 中处理过同样的问题。

我在 Kohana 做什么：

```
<li><a href="/admin/dashboard" <?= (get_class($this) == 'Dashboard_Controller') ? "class=\"active\"" : NULL ?>>Dashboard</a></li>
<li><a href="/admin/campaigns" <?= (get_class($this) == 'Campaigns_Controller') ? "class=\"active\"" : NULL ?>>Campaigns</a></li>
<li><a href="/admin/lists" <?= (get_class($this) == 'Lists_Controller') ? "class=\"active\"" : NULL ?>>Lists</a></li> 
```

我在 Rails 中所做的事情：

```
<li><a href="/main" <%= 'class="active"' if (controller.controller_name == 'main') %>>Overview</a></li>
<li><a href="/notifications" <%= 'class="active"' if (controller.controller_name == 'notifications') %>>Notifications</a></li>
<li><a href="/reports" <%= 'class="active"' if (controller.controller_name == 'reports') %>>Reports</a></li> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T16:42:29.747

我只看到了几种方法，同时避免重复 ifequals：

1.  Javascript。类似于（jQuery）的东西：

    ```
    var parts = window.location.pathname.split('/');
    var page = parts[parts.length-1];
    $('#sidebar1 a[href*=' + page + ']').addClass('current'); 
    ```

2.  更改您的视图以包含带有相关标题和 URL 的页面列表，并在您的模板中创建一个 {% for %} 循环，该循环将遍历该列表，并添加一个 {% ifequal %}。

选项 2 是我的最爱。如果所有页面的逻辑都相同，并且只有模板不同，则可以考虑为每个页面使用 FlatPages 模型。如果逻辑不同，并且您需要不同的模型，则可以考虑使用某种菜单应用程序。一个无耻的插件：我有[自己的菜单应用程序](http://code.google.com/p/django-yama/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-29T22:41:01.200

如果添加`request`上下文处理器，则非常简单：

```
settings.py:

TEMPLATE_CONTEXT_PROCESSORS = (
    'django.core.context_processors.request',
    'django.contrib.auth.context_processors.auth'  # admin app wants this too
) 
```

现在您可以访问`HttpRequest`包含请求路径的 。突出显示当前页面是检查路径是否与链接的目标匹配的简单问题，即您已经在那里：

```
<li><a class="{% if request.path == '/' %}current{% endif %}" href="/">Index</a></li>
<li><a class="{% if request.path == '/stuff/' %}current{% endif %}" href="/stuff/">Stuff</a></li>
<li><a class="{% if request.path == '/about/' %}current{% endif %}" href="/about/">About Me</a></li>
<li><a class="{% if request.path == '/contact/' %}current{% endif %}" href="/contact/">Contact Me</a></li> 
```

# c# - 为什么 C# 不允许像 C++ 这样的非成员函数

> ID：1024171
> 
> 赞同：70
> 
> 时间：2009-06-21T15:39:59.047
> 
> 标签：c#, .net, function, c++-cli, clr

C# 不允许编写非成员函数，每个方法都应该是类的一部分。我认为这是所有 CLI 语言的限制。但我错了，我发现 C++/CLI 支持非成员函数。编译时，编译器会将方法作为某个未命名类的成员。

这是 C++/CLI 标准所说的，

> [注意：非成员函数被 CLI 视为某些未命名类的成员；但是，在 C++/CLI 源代码中，此类函数不能用该类名显式限定。尾注]
> 
> 元数据中非成员函数的编码未指定。[注意：这不会导致互操作问题，因为此类功能不能公开可见。尾注]

所以我的问题是为什么 C# 不实现这样的东西？或者你认为不应该有非成员函数，每个方法都应该属于某个类？

我的意见是支持非成员函数，它有助于避免污染类的接口。

有什么想法吗..？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-06-22T15:29:46.070

请参阅此博客帖子：

[http://blogs.msdn.com/ericlippert/archive/2009/06/22/why-doesn-tc-implement-top-level-methods.aspx](http://blogs.msdn.com/ericlippert/archive/2009/06/22/why-doesn-t-c-implement-top-level-methods.aspx)

> (...)
> 
> 我被问到“为什么 C# 不实现功能 X？” 每时每刻。答案总是一样的：因为从来没有人设计、指定、实施、测试、记录和发布该功能。所有这六件事都是使功能发生所必需的。所有这些都花费了大量的时间、精力和金钱。功能并不便宜，鉴于我们有限的时间、精力和金钱预算，我们非常努力地确保我们只发布那些能够为我们的用户带来最大利益的功能。
> 
> 我知道这样一个笼统的答案可能无法解决具体问题。
> 
> 在这种特殊情况下，过去明显的用户利益不足以证明随之而来的语言复杂性是合理的。通过限制不同语言实体相互嵌套的方式，我们 (1) 将法律程序限制为通用、易于理解的样式，以及 (2) 可以定义可理解、可指定、可实现、可测试的“标识符查找”规则并且有据可查。
> 
> 通过将方法体限制为始终位于结构或类中，我们可以更轻松地推断调用上下文中使用的非限定标识符的含义；这样的东西始终是当前类型（或基本类型）的可调用成员。
> 
> (...)

和这个后续帖子：

[http://blogs.msdn.com/ericlippert/archive/2009/06/24/it-already-is-a-scripting-language.aspx](http://blogs.msdn.com/ericlippert/archive/2009/06/24/it-already-is-a-scripting-language.aspx)

> (...)
> 
> 像所有设计决策一样，当我们面临许多相互竞争的、令人信服的、有价值的和不可组合的想法时，我们必须找到一个可行的折衷方案。我们不这样做，除非**考虑所有可能性**，这就是我们在这种情况下所做的。

*（重点来自原文）*

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-06-21T16:25:23.860

C# 不允许，因为 Java 不允许。

我可以想到 Java 的设计者可能不允许它的几个原因

*   Java被设计为简单。他们试图创造一种没有随机捷径的语言，这样你通常只有一种简单的方法来做所有事情，即使其他方法会更简洁或更简洁。他们希望最小化学习曲线，并且学习“一个类可能包含方法”比“一个类可能包含方法，并且函数可能存在于类之外”更简单。
*   从表面上看，它看起来不太面向对象。（任何不属于对象的东西显然不能是面向对象的？可以吗？当然，C++ 说是，但 C++ 没有参与这个决定）

正如我在评论中已经说过的，我认为这是一个很好的问题，在很多情况下非成员函数会更可取。（这部分主要是对所有其他答案说“你不需要它”的回应）

在 C++ 中，允许使用非成员函数，它们通常是首选，原因如下：

*   它有助于封装。访问类的私有成员的方法越少，该类就越容易重构或维护。封装是 OOP 的重要组成部分。
*   当代码不是类的一部分时，它可以更容易地重用。例如，C++ 标准库将`std::find`std::sort` 定义为非成员函数，以便它们可以在任何类型的序列上重用，无论是数组、集合、链表还是（对于 std::find，在最少）流。代码重用也是 OOP 的重要组成部分。
*   它给了我们更好的解耦。该`find`函数不需要知道 LinkedList 类就可以使用它。如果它被定义为成员函数，它将是 LinkedList 类的成员，基本上将两个概念合并为一个大块。
*   可扩展性。如果你接受一个类的接口不仅是“它的所有公共成员”，而且是“对这个类进行操作的所有非成员函数”，那么就可以扩展一个类的接口而无需编辑或甚至重新编译类本身。

拥有非成员函数的能力可能起源于 C（您别无选择），但在现代 C++ 中，它本身就是一个至关重要的特性，不仅仅是为了向后比较，而是因为更简单，它允许的更清洁和更可重用的代码。

事实上，C# 似乎在很久以后才意识到同样的事情。为什么你认为添加了扩展方法？它们是实现上述目标的一种尝试，同时保留了简单的类似 Java 的语法。Lambda 也是有趣的例子，因为它们本质上也是自由定义的小函数，而不是任何特定类的成员。所以是的，非成员函数的概念很有用，C# 的设计者也实现了同样的事情。他们只是试图通过后门把这个概念偷偷溜进来。

[http://www.ddj.com/cpp/184401197](http://www.ddj.com/cpp/184401197)和[http://www.gotw.ca/publications/mill02.htm](http://www.gotw.ca/publications/mill02.htm)是 C++ 专家就该主题撰写的两篇文章。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-06-21T16:20:55.950

非成员函数是一件好事[，因为它们改进了封装](http://www.ddj.com/cpp/184401197)并减少了类型之间的耦合。大多数现代编程语言（例如 Haskell 和 F#）都支持自由函数。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-06-21T15:44:39.787

*不*将每个方法都放在命名类中有什么好处？为什么非成员函数会“污染”类的接口？如果您不希望它成为类的公共 API 的一部分，请不要将其公开或不要将其放入该类中。你总是可以创建一个不同的类。

我不记得曾经想要编写一个没有适当范围的浮动方法 - 当然，除了匿名函数（它们并不完全相同）。

简而言之，我看不到非成员函数的任何好处，但我可以看到将所有方法放在适当命名的类中的一致性、命名和文档方面的好处。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-21T15:46:18.940

CLS（通用语言规范）规定，在符合 CLS 的库中不应包含非成员函数。除了 CLI（通用语言界面）的基本限制之外，它就像是一组额外的限制。

未来的 C# 版本可能会添加编写`using`指令的功能，该指令允许在没有类名限定的情况下访问类的静态成员：

```
using System.Linq.Enumerable; // Enumerable is a static class

...

IEnumerable<int> range = Range(1, 10); // finds Enumerable.Range 
```

这样就无需更改 CLS 和现有库。

[这些博客文章演示了](http://blogs.msdn.com/lucabol/archive/2008/04/08/a-c-library-to-write-functional-code-part-ii-tuples.aspx)C# 中的函数式编程库，它们使用只有一个字母长的类名，以尝试减少因限定静态方法调用的要求而产生的噪音。`using`如果指令可以针对类，这样的例子会更好一些。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-21T16:32:51.460

*   将所有代码都放在类中允许更强大的反射功能集。
*   它允许使用静态初始化器，它可以初始化类中静态方法所需的数据。
*   它通过将它们显式地包含在一个不能被另一个编译单元添加到的单元中来避免方法之间的名称冲突。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-21T15:55:28.237

自 Java 以来，大多数程序员很容易接受任何方法都是类的成员。我没有设置任何相当大的障碍，使方法的概念更狭窄，这使语言更容易。

然而，确实，类推断对象，对象推断状态，所以类只包含静态方法的概念看起来有点荒谬。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-21T15:47:16.270

我认为你真的需要澄清你想要创建非成员静态方法来实现什么。

例如，您可能想要它们的一些事情可以使用[扩展方法来处理](http://msdn.microsoft.com/en-us/library/bb383977.aspx)

另一个典型用途（仅包含静态方法的类）是在库中。在这种情况下，在完全由静态方法组成的程序集中创建一个类几乎没有什么坏处。它将它们保持在一起，避免命名冲突。毕竟，数学中有一些静态方法可以达到同样的目的。

此外，您不必将 C++ 的对象模型与 C# 进行比较。C++ 在很大程度上（但不是完美地）与 C 兼容，C 根本没有类系统 - 所以 C++ 必须支持这种 C 遗留的编程习惯，而不是任何特定的设计命令。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-21T16:26:38.213

请记住：C++ 是一种比 C# 复杂得多的语言。尽管它们在句法上可能相似，但它们在语义上却是截然不同的野兽。你不会认为做出这样的改变会非常困难，但我可以看到它是如何发生的。ANTLR 有一个很好的 wiki 页面，名为[What makes a language problem?](http://www.antlr.org/wiki/pages/viewpage.action?pageId=1773) 很好地咨询这样的问题。在这种情况下：

> 上下文敏感词法分析器？除非您知道要解析的句子类型，否则您无法决定要匹配的词汇符号。

现在，我们不必担心定义在类中的函数，而不必担心定义在类之外的函数。从概念上讲，没有太大区别。但是在词法分析和代码解析方面，现在你不得不说“如果一个函数在一个类之外，它属于这个未命名的类。但是，如果它在类内，那么它属于那个班级。”

此外，如果编译器遇到这样的方法：

```
public void Foo()
{
    Bar();
} 
```

...它现在必须回答“Bar 是位于这个类中还是一个全局类？”这个问题。

> 转发还是外部引用？即，需要多次通过？Pascal 有一个“前向”引用来处理文件内过程引用，但是通过 USES 子句等对其他文件中的过程的引用需要特殊处理。

这是导致问题的另一件事。请记住，C# 不需要前向声明。编译器将通过一次来确定哪些类被命名以及这些类包含哪些函数。现在您必须担心找到函数可以在类内部或外部的类*和函数。*这是 C++ 解析器不必担心的事情，因为它会按顺序解析所有内容。

现在不要误会我的意思，它可能在 C# 中完成，我可能会使用这样的功能。但是，当您只需在静态方法前面键入一个类名时，真的值得克服这些障碍吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-10-27T01:52:24.997

虽然确实需要一个类（例如，一个名为 的静态类`FreeFunctions`）来保存这些函数，但您可以自由地将`using static FreeFunctions;`需要其中的函数的任何文件放在顶部，而不必在代码中添加`FreeFunctions.`限定符。我不确定是否真的存在这样的情况，这明显不如不要求函数定义包含在类中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-03-06T16:20:06.507

看，其他编程语言很难从编译器的角度定义函数实例的内部性质。在 Pascal 和 C 中，实例基本上被定义为**只能作为指针处理的**东西。特别是，因为对可执行代码位置的读/写是 9 位计算机科学教授中有 7 位坚决反对的。作为一个类的成员，没有人需要关心如何对待它的表现形式，因为这个表现形式的类型是从一个类属性派生的。可以创建像全局函数一样被精确处理的东西：一个 lambda 函数，分配给一个变量：

 `````
Func<int,int> myFunc = delegate(int var1)
{
    Console.WriteLine("{0}",var1*2);
    return var1*3;
}; 
```` . 它可以像全局函数一样简单地通过其变量名来调用。如果是这样，不同之处在于在最低级别实现一种新的对象类型，其行为与另一个对象类型相同。这被经验丰富的程序员认为是不好的做法，并且可能因此而被废弃。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2017-11-26T16:49:09.317

如果将自由函数与鸭子类型结合起来，它们将非常有用。整个 C++ STL 都是基于它的。因此，我确信 C# 在设法添加真正的泛型时会引入自由函数。

与经济学一样，语言设计也与心理学有关。如果你通过 C# 中的自由函数创造了对真正泛型的胃口而不交付，那么你会扼杀 C#。然后所有 C# 开发人员都将转向 C++，没有人希望发生这种情况，C# 社区更不希望，当然也不会是那些投资于 C++ 的人。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2021-05-27T19:36:07.203

Csharp 没有非成员函数，因为它复制或启发了 java 的哲学，即只有 OOP 是所有问题的解决方案，它只允许使用 OO 方式解决问题。

如果我们真的想做泛型编程，非成员函数是非常重要的特性。与将它们放在类中相比，它们更具可重用性。

由于缺少非成员函数，CSharp 不得不提出 ExtensionMethods。

现在编程语言正朝着函数式编程范式发展，它似乎是解决和解决问题的更好方法，也是未来。CSharp 应该重新考虑它。`

# apache-flex - Adobe Flex 中带有链接按钮（清除按钮）的数组对象和数据网格

> ID：1024173
> 
> 赞同：0
> 
> 时间：2009-06-21T15:41:29.760
> 
> 标签：apache-flex, datagridview

我有一个对象数组。我从数组中填充数据网格。数据网格中的列数固定为 ie5，第一列始终显示序列号 (0,1,2,3,4)。我在数据网格的最后一列中有一个名为“CLEAR”的链接按钮。

1>如何使清除按钮仅在特别单击该行时可见？

2> 单击清除按钮时，如何清除该特定行的内容。不删除，只清除重新插入数据。另外，序列号（0,1,2,3,4）不应该被清除，也不应该被删除。这该怎么做 ？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T23:00:29.637

为了使您的清除按钮可见，这样的事情会起作用。可能不得不玩一下。私有函数 onDatagridClick(event:ListEvent):void {

```
 if ( event.rowIndex == -1 ) {
        return;
    } 

    clearBTN[event.RowIndex].visible = true;
} 
```

如果您不想删除列，则需要在其中放置一些数据，因为数据网格由数据提供者绑定，您始终可以添加虚拟数据，即空白字符串、“输入数据”或自定义项目渲染器，用于何时数据必需的。

# iphone - Xcode 命名可执行文件

> ID：1024175
> 
> 赞同：0
> 
> 时间：2009-06-21T15:41:51.290
> 
> 标签：iphone, xcode

行。

所以我的第一个应用程序获得了 Apple 的批准，它本周开始销售。有了这个，我想创建一个 Lite 版本的应用程序。

我在 SVN 中做了一个分支，并创建了一个新的工作目录。

原始应用程序是 Trak4，精简版显然是 Trak4 Lite

我注意到，当我构建时，Xcode 创建的 .app 文件仍然是 Trak4.app，即使在 plist 文件中，我已将 Executable 名称更改为 Trak4Lite，将项目重命名为 Trak4Lite 等。

在产品中它说产品是 Trak4 Lite，但在构建步骤它正在生成 Trak4.app。

我错过了什么？为什么可执行文件名称错误？

我正在运行 OS3.0 GM。我还没有运行 Snow Leopard。

基思

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T23:38:42.383

对于我的应用程序的免费版本，我在同一个项目中创建了第二个目标，而不是创建一个分支。复制目标后，您只需更改该目标的产品名称设置。我还创建了一个新的 Info.plist，并在目标设置中指向它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T16:31:50.447

您需要在目标的构建设置中更改产品名称 (PRODUCT_NAME)，并且您可能还希望指向不同的 Info.plist。 [替代文字 http://web3.twitpic.com/img/13461715-4c0d84c623011739cca45f9b3f44abc3.4a3e605a-full.png](http://web3.twitpic.com/img/13461715-4c0d84c623011739cca45f9b3f44abc3.4a3e605a-full.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T15:46:33.167

我总是被它绊倒。我使用[Rename Xcode Project](http://www.macupdate.com/info.php/id/17683)来帮助我。

# windows - windows中是否有一个全局函数来列出目录中的文件？

> ID：1024177
> 
> 赞同：1
> 
> 时间：2009-06-21T15:43:28.243
> 
> 标签：windows, winapi

哪个函数窗口正在调用以列出目录中的文件？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T15:47:59.030

您可以使用此函数通过 WIN32 API 进行目录列表。

[FindFirstFile](http://msdn.microsoft.com/en-us/library/aa364418(VS.85).aspx)、[FindNextFile](http://msdn.microsoft.com/en-us/library/aa364428(VS.85).aspx)和[FindClose](http://msdn.microsoft.com/en-us/library/aa364413(VS.85).aspx)

一个完整的例子可以在这里找到

[列出目录中的文件 WIN32 API](http://msdn.microsoft.com/en-us/library/aa365200(VS.85).aspx)

对于便携式方法，请查看此帖子：

[“使用 c/c++ 获取目录中的文件列表”](https://stackoverflow.com/questions/612097/how-can-i-get-a-list-of-files-in-a-directory-using-c-or-c/612176#612176)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T15:46:39.000

没有完全得到您的问题，但不会使用“dir”作为系统命令来完成这项工作？如果我错了，请纠正我，因为问题本身对我来说不是很清楚。

编辑 - 嗨约翰，这是列出目录的源代码。

[http://msdn.microsoft.com/en-us/library/aa365200(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa365200(VS.85).aspx)

希望这可以帮助。

# php - Nginx - 自定义 404 页面

> ID：1024199
> 
> 赞同：59
> 
> 时间：2009-06-21T15:53:36.643
> 
> 标签：php, nginx, http-status-code-404

Nginx+PHP（在 fastCGI 上）非常适合我。当我输入一个不存在的 PHP 文件的路径时，我没有得到默认的 404 错误页面（适用于任何无效的 .html 文件），我只是得到一个“未指定输入文件。”。

如何自定义此 404 错误页面？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-07-07T15:55:25.100

您可以为 nginx.conf 中的每个位置块设置自定义错误页面，或者为整个站点设置全局错误页面。

要重定向到特定位置的简单 404 未找到页面：

```
location /my_blog {
    error_page    404 /blog_article_not_found.html;
} 
```

站点范围的 404 页面：

```
server {
    listen 80;
    error_page  404  /website_page_not_found.html;
    ... 
```

您可以将标准错误代码附加在一起，以便为多种类型的错误提供一个页面：

```
location /my_blog {
    error_page 500 502 503 504 /server_error.html
} 
```

要重定向到完全不同的服务器，假设您在 http 部分中定义了一个名为 server2 的上游服务器：

```
upstream server2 {
    server 10.0.0.1:80;
}
server {
    location /my_blog {
        error_page    404 @try_server2;
    }
    location @try_server2 {
        proxy_pass http://server2;
    } 
```

该[手册](http://nginx.org/en/docs/http/ngx_http_core_module.html#error_page)可以为您提供更多详细信息，或者您可以在 google 中搜索术语 nginx.conf 和 error_page 以获取网络上的真实示例。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-06-21T18:49:01.447

[您在 nginx配置](http://nginx.org/en/docs/http/ngx_http_core_module.html#error_page)中使用 error_page 属性。

例如，如果您打算将 404 错误页面设置为`/404.html`，请使用

```
error_page 404 /404.html; 
```

将 500 错误页面设置`/500.html`为就像以下一样简单：

```
error_page 500 /500.html; 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2013-10-01T00:54:34.463

注意语法！Great Turtle 可以互换使用它们，但是：

`error_page 404 = /404.html;`

将返回状态码为 200 的 404.html 页面（因为 = 已将其转发到此页面）

`error_page 404 /404.html;`

将返回带有（原始）404 错误代码的 404.html 页面。

[https://serverfault.com/questions/295789/nginx-return-correct-headers-with-custom-error-documents](https://serverfault.com/questions/295789/nginx-return-correct-headers-with-custom-error-documents)

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2011-05-09T15:32:55.260

“error_page”参数进行重定向，将请求方法转换为“GET”，它不是自定义响应页面。

最简单的解决方案是

```
 server{
         root /var/www/html;
         location ~ \.php {
            if (!-f $document_root/$fastcgi_script_name){
                return 404;
            }
            fastcgi_pass   127.0.0.1:9000;
            include fastcgi_params.default;
            fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;
        } 
```

顺便说一句，如果你想让Nginx处理PHP脚本返回的404状态，你需要添加

`[fastcgi_intercept_errors][1] on;`

例如

```
 location ~ \.php {
            #...
            error_page  404   404.html;
            fastcgi_intercept_errors on;
         } 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2012-08-02T21:11:33.870

不再推荐这些答案，因为在这种情况下`try_files`工作得更快。`if`只需添加`try_files`您的 php 位置块以测试文件是否存在，否则返回 404。

```
location ~ \.php {
    try_files $uri =404;
    ...
} 
```

# asp.net-mvc - （更好的实践）你如何将 JSON 结果放入 ASP.net MVC 框架中？

> ID：1024202
> 
> 赞同：5
> 
> 时间：2009-06-21T15:56:01.527
> 
> 标签：asp.net-mvc, model-view-controller, json

目前我正在使用很棒的 Linq 2 Json.net（由 newtonsoft 提供），这是一个非常棒的简单工具，可以以编程方式生成 JSON 结果。

但是在完成一些项目后，我停下来重新思考，我应该在控制器中生成 JSON 结果吗？我的意思是，在 .net MVC 框架中，它确实提供了一个 JSONResult 作为 ViewResult 之一。但是控制器应该打扰结果是如何生成的吗？还是应该只是“提供”要查看的数据，而生成必要的输出（和格式）应该是视图的工作？

最后一件事，我还听说在控制器中使用“ViewData”可能不是一个好主意，因为控制器过多地关注显示/输出问题，可以使用更好的模式或方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-05T01:12:25.653

我想我会证明 Controller 中的 JSON 输出是合理的，因为 JSON 只是 ViewData 的一种形式，就像使用 ViewData Dictionary 与 View 页面进行通信一样。

并且实际的 View 页面已经由客户端语言呈现或处理。虽然一个缺点是 JSON 输出控制器非常依赖于视图，是的，您仍然可以将视图更改为接受 JSON 作为通信渠道的其他东西，但如果您想更改客户端，这不是一个好主意例如，使用其他通道作为通信（如直接 TCP 连接或 SOAP 应用程序等）的桌面应用程序，因为控制器是为 JSON 制作的。（你可以制作一个适配器来进行翻译）。

所以总结一下，控制器中的 JSON 渲染是可以的，只要您不打算在保持控制器不变的情况下使用其他平台。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-04T16:33:13.527

JSON 输出对于大多数服务器端语言来说都相当简单，我从来没有理由（或能够证明尝试）用模板使它们复杂化。

虽然可以，但产生的开销可能是一种浪费。在大多数情况下，渲染模板会触发整个子系统，该子系统甚至在开始工作之前就必须完成。

关于 JSON（以及一般的 AJAX 响应）的整个想法（对我来说）是，您可以从服务器上减少大量开销。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T16:13:12.390

我通常在控制器本身中为 JsonResults 设置我的结果。我觉得这取决于模型/DAL/BLL 是否给我按要求过滤的数据/可枚举，但控制器/视图会返回并返回它。如果是 JsonResult，框架会处理视图/编码部分。我会为格式化的文本（主要是 html）输出保留视图。使用 JSON 和文件/图像响应的内置处理程序/结果。XML 输出真的可以去任何一种方式 imo。

# java - Scala 能在没有企业支持的情况下生存吗？

> ID：1024203
> 
> 赞同：10
> 
> 时间：2009-06-21T15:56:17.113
> 
> 标签：java, scala, jvm-languages

我想知道`Scala`在没有明确的公司支持的情况下是否会获得应有的收购（我在考虑*Sun/Oracle*，但我想可能是其他人，比如*Google*）。

随着 Sun 最近决定不在 JDK7 中包含闭包，`Scala`对于那些希望拥有更具表现力的语言的人来说，他们难道不能把自己的重心放在 Java 替代品上吗？毕竟，在我看来，他们应该最关心`JVM`. 而不是 Java*本身*。有人认为这很可能吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-21T22:15:36.233

除了以前的语言在没有初始企业支持的情况下取得成功的例子之外，我认为微软在 .NET 平台上推广函数式编程可能会间接帮助 Scala 获得采用。由于 Java 和 .NET 生态系统被视为紧密的竞争对手，了解 F# 和 C# 的功能添加的人可能倾向于寻找 JVM 类似物，而在我看来，Scala 似乎最适合填补这个角色。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-22T02:01:56.557

你需要更具体。在什么环境下茁壮成长？

我认为 Scala 的社区已经接近临界点，它需要成为一个自我可持续的开源项目，即使它的主要机构支持者 EPFL 突然改变了主意；目前有各种迹象表明它将达到这一临界点。我认为 Scala 将与我们同在并长期积极维护。

如果它适合的用途类型是一个更紧迫的问题。Scala 编译器和标准库远非完美。当您开始推送语言或库的一部分时，您仍然很有可能会发现错误。这正在突飞猛进，但它本身并不是问题的核心。

问题是为了得到修复，你几乎必须升级到下一个版本的 Scala，因为升级出来了。问题在于大多数版本升级都包含重大更改，因此为了获得修复，您可能必须更改自己的代码。还有二进制不兼容问题，这意味着你所有的 Scala 依赖项也必须更改版本。

如果您对其他 Scala 库有很多依赖（不太可能 - 目前还没有很多），如果您受到严重的基础设施官僚主义的影响，或者更糟糕的是，您是一家以产品为导向的公司，这可能是一个严重的问题。向基础设施官僚主义严重的客户分发修复程序。

为了使 Scala 在这种情况下长期可行，必须有人开始将修复移植到早期版本，这样人们就不必为了获得一些修复而进行破坏性升级。我确信这会发生，因为它真的不会那么难，但它可能需要有人看到商机，因为让我们面对现实吧，向后移植更改和进行回归测试并不是完全退出工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-21T15:59:05.770

我认为 Scala 会很好。[既然Twitter 已经部分转移](http://parand.com/say/index.php/2009/04/06/twitter-scalaruby-drama/)到了它，它就有了很多想法。我认为 Sun 不太可能专注于 Java 以外的任何东西，但他们可能很高兴其他语言都针对 JVM。

顺便说一句，我认为关闭的东西很糟糕。我喜欢闭包。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-21T16:05:31.750

我认为它会蓬勃发展，因为它没有企业笨蛋“支持”他们。我个人喜欢这样的想法，即一种语言是如此独立，而且非常好，并且经过精心计划和深思熟虑。

我认为谷歌很可能会接受它，但我认为这不会是官方的支持。我相信谷歌会找到一个很酷的项目来使用 Scala。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-21T16:07:21.077

*只有在没有*工作程序员的大力支持时，企业支持才是一种语言成功的必要条件。Perl、Python 和 Ruby 都是在没有人支持的情况下成长起来的（嗯，Ruby 有日本人，但在美国并没有太多帮助）。

我没有使用过 Scala，但 Twitter 对它的认可表明，即使没有企业大哥，它也有足够的程序员支持来茁壮成长。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-21T16:19:05.997

当然会活下来。

有大量的语言存在，得到了大学、工作组、业余爱好者和程序员的支持，无论是在世界各地，还是在野外。在某些情况下，他们不受人类支持的事实意味着他们有一些生存的机会，也许更多地与他们的声望有关，或者他们可能服务于一个重要的研究方面。

# c# - 获取数据表中行的值c#

> ID：1024211
> 
> 赞同：10
> 
> 时间：2009-06-21T16:00:13.713
> 
> 标签：c#, datatable, gradient, datarow

我的代码有问题。

```
foreach (DataRow dr in dt_pattern.Rows)
    {
      part = dr["patternString"].ToString();
      if (part != vpart)
      {
        System.Console.WriteLine(part);
        System.Console.WriteLine("Geben Sie bitte für den Abschnitt die AT ein: ");
        temp = System.Console.ReadLine();
        AT = ToDouble(temp);
        dr["AT"] = AT;

        double xATmax = ToDouble(dr["Ampl"].ToString());
        double x = ToDouble(dr["Time"].ToString());

        double yATmax = ToDouble(dr["Ampl"]+1.ToString()) + AT;
        double y = ToDouble(dr["Ampl"].ToString());

        dr["alphaATmin"] = Gradient(x,xATmax,y,yATmax);
        System.Console.WriteLine(dr["alphaATmin"]);
      }
      vpart = part;          
    } 
```

但我需要在 xATmax 和 yATmax 下一行的值...有人可以帮助我吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-21T16:08:14.807

然后不要使用foreach。使用“for 循环”。您的代码有点混乱，但您可以执行类似...

```
for (Int32 i = 0; i < dt_pattern.Rows.Count; i++)
{
    double yATmax = ToDouble(dt_pattern.Rows[i+1]["Ampl"].ToString()) + AT;
} 
```

请注意，您必须考虑在最后一行中不会有“i+1”，因此您必须使用 if 语句来捕捉它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-21T16:09:53.123

```
for (int i=0; i<dt_pattern.Rows.Count; i++)
{
    DataRow dr = dt_pattern.Rows[i];
} 
```

在循环中，您现在可以引用第 i+1 行（假设有 i+1）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-07T06:55:53.393

`for (Int32 i = 1; i < dt_pattern.Rows.Count - 1; i++){ double yATmax = ToDouble(dt_pattern.Rows[i]["Ampl"].ToString()) + AT; }`

如果您想解决 + 1 问题

# c# - 帮助检查我的 XML 验证代码是否高效

> ID：1024213
> 
> 赞同：0
> 
> 时间：2009-06-21T16:01:35.100
> 
> 标签：c#, .net, xml, visual-studio-2008, encoding

我正在检查特定输入字符串在 XML UTF-8 编码中是否有效（可用作 XML 元素的值）。我的目标是根据 XML UTF-8 编码标准判断哪个字符串（来自输入字符串数组）无效。

这是我的代码，我当前的实现很简单——用输入字符串数组中的每个单独的字符串组装 XML 文件。我不确定这是否是最有效的方法。从功能的角度来看，它是有效的。

我的工作环境是 .Net 3.5 + VSTS 2008 + C#。

```
 static void Main(string[] args)
    {
        string[] inputs = { "Hello", "World", "StackOverflow", "ServerFault", "&#DFFE" };
        XmlDocument xDoc = new XmlDocument();
        string header = "<?xml version=\"1.0\" encoding=\"utf-8\"?>";
        string formatter = "<foo>{0}</foo>";
        foreach (string item in inputs)
        {
            StringBuilder builder = new StringBuilder();
            builder.Append (header);
            builder.Append (String.Format(formatter, item));
            try
            {
                xDoc.Load(new StringReader(builder.ToString()));
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.ToString());
            }
        }
    } 
```

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T16:07:29.080

George，在编写测试时，最好从演示失败案例的测试开始。

你的代码会失败吗？我不这么认为。

您应该从与您想要创建此测试的问题相近的测试开始。我想您遇到了 XML 文件未正确编码的问题？在这种情况下，您应该创建一个测试来证明坏文件是坏的（您已经知道这是真的），然后概括测试，以便它可以检测到其他坏文件是坏的，并且所有好的文件都是好的.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T16:48:04.710

你可以做这样的事情：

```
 public static XmlElement xmlValidationElement =
        new XmlDocument().CreateElement("validator");

    static void Main(string[] args)
    {
        string[] inputs = { "Hello", "World", "StackOverflow", "ServerFault" };
        foreach (string item in inputs)
        {
            try
            {
                xmlValidationElement.InnerXml = item;
            }
            catch (XmlException ex)
            {
                Console.WriteLine(ex.ToString());
            }
        }
    } 
```

# java - 什么是 GeneratedMethodAccessor1、2 等，为什么找不到它们？

> ID：1024217
> 
> 赞同：10
> 
> 时间：2009-06-21T16:04:38.863
> 
> 标签：java, reflection, bytecode-manipulation

我得到这样的堆栈跟踪：

```
java.lang.NoClassDefFoundError: sun/reflect/GeneratedMethodAccessor1
    at sun.reflect.GeneratedMethodAccessor1.<clinit>(Unknown Source)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
    at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
    at java.lang.Class.newInstance0(Class.java:355)
    at java.lang.Class.newInstance(Class.java:308)
    at sun.reflect.MethodAccessorGenerator$1.run(MethodAccessorGenerator.java:381)
    at java.security.AccessController.doPrivileged(Native Method)
    at sun.reflect.MethodAccessorGenerator.generate(MethodAccessorGenerator.java:377)
    at sun.reflect.MethodAccessorGenerator.generateMethod(MethodAccessorGenerator.java:59)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:28)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at edu.tufts.cs.testsim.LogicalProcess.dispatchMessage(LogicalProcess.java:214)
    at edu.tufts.cs.testsim.LogicalProcess.processForward(LogicalProcess.java:287)
    at edu.tufts.cs.testsim.LogicalProcess.doOperation(LogicalProcess.java:423)
    at edu.tufts.cs.testsim.LogicalProcess.run(LogicalProcess.java:434)
    at java.lang.Thread.run(Thread.java:637)
Caused by: java.lang.ClassNotFoundException: sun.reflect.GeneratedMethodAccessor1
    at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:316)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:288)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
    at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:374)
    ... 19 more 
```

什么是 GeneratedMethodAccessor1, GeneratedMethodAccessor2, GeneratedMethodAccessorN，什么可能导致它们找不到？我在运行时进行了一些字节码重写，但仅在加载类之前，并且通过反射的前几次调用工作正常。我想知道在 JIT 编译器获取我的代码之后是否会发生这种情况，但我什至不知道如何开始调试它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-21T16:25:23.237

`GeneratedMethodAccessor###`是反射实现在运行时生成的类，用于调用方法和构造函数。这形成了从实际方法或构造函数的实例`Method`或`Constructor`到实际方法或构造函数的字节码桥。源代码中提供了更多信息。

反序列化也做了类似的事情，共享一些相同的机制，以调用最派生的非`Serializable`构造函数。

# django - 如何将一块动态生成的内容放入 django 模板中？

> ID：1024220
> 
> 赞同：1
> 
> 时间：2009-06-21T16:06:05.930
> 
> 标签：django, django-templates

我想在我的 django 模板中包含诸如 twitter 状态或美味标签之类的内容。

这些事情是动态的，但有规律的。这将如何完成？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T21:19:17.530

有多种方法可以处理此问题，因此您可以选择最符合您个人风格或要求的方法：

1.  **模板上下文变量**：正如 Alex 所回答的，您可以将您的内容放入一个上下文变量中，该变量包含在每个视图创建的每个模板的上下文中。Django 甚至提供了一种自动执行此操作的机制，称为[上下文处理器](http://docs.djangoproject.com/en/dev/ref/templates/api/#id1)。优点：非常简单。缺点：不会在客户端浏览器上动态刷新新内容。

2.  **AJAX 动态加载**：正如 Alex 和 Dave 所提到的，您可以使用 AJAX 方法动态加载您的内容。作为使用 jQuery 的示例，您可以在模板中放置一个占位符，`<div id="twitterfeed"></div>`然后在模板中的 javascript 块中放置`$("#twitterfeed").load("{% url twitterfeed %}");`一个`twitterfeed`在 urls.py 中如此命名的 url。优点：将动态更新浏览器。缺点：如果您不了解 Javascript，可能会很棘手。

3.  **包含标签**：Django 提供了一种称为[包含标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#inclusion-tags)的模板标签，它基本上是一个可以呈现动态内容的自定义模板标签。在某种程度上，它类似于上下文变量，除了您生成内容的代码只会在您在模板中使用自定义模板标签时调用，而不是为每个视图调用。另一个好处是内容是从它自己的模板生成的。当然，您可以使用普通的上下文变量来执行此操作，但它不像使用包含标签那样干净（恕我直言）。优点：非常简单，干净。缺点：不会在客户端浏览器上动态刷新新内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T17:44:35.590

一种常见的技术是在生成的内容中保留一个占位符 div，然后通过您在页面中包含的 Javascript 的 AJAX 调用在客户端填充该 div。

这为您提供了具有单独动态位的可缓存（快速加载）主页的好处。根据您希望动态位的实时性，您甚至可以将它们缓存更短的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T16:15:42.703

最简单的方法是`{{ mycontent }}`在您的模板中使用（您希望动态生成的内容出现的地方）并将`mycontent`其值之间的对应关系放在您用于呈现模板的上下文中——即，django 模板的最基本部分。

如果你的意思是你想要 Ajax 支持，从而页面上的 Javascript 根据服务器在任何给定时间想要的内容不断刷新这些内容，我建议研究[dojango](http://code.google.com/p/dojango/)，Dojo/Django 集成项目——它还没有像 Dojo 和 Django 一样完全成熟（还不是 0.4 版），但它已经可以使用和有用了。

# asp.net-mvc - 上帝控制器 - 如何防止它们？

> ID：1024227
> 
> 赞同：17
> 
> 时间：2009-06-21T16:09:06.320
> 
> 标签：asp.net-mvc, model-view-controller, design-patterns, god-object

在我一直从事的一些 MVC 项目中，很明显有一些有问题的控制器已经有机地成长为上帝类——如果你愿意的话，每个半神都在自己的领域中。

这个问题可能更像是“什么去哪里”，但我认为这是一个关于 SRP（单一责任原则）、DRY（不要重复自己）和保持简洁、“敏捷”的重要问题——而且我没有足够的经验（使用这种模式和一般设计）来了解这一点。

在一个项目中，我们有一个 NutritionController。随着时间的推移，它逐渐包含了这些操作（许多都有各自的 GET、POST 和 DELETE 方法）：

> ```
> Index (home controller)
> ViewFoodItem
> AddFoodItem
> EditFoodItem
> DeleteFoodItem
> ViewNutritionSummary
> SearchFoodItem
> AddToFavorites
> RemoveFromFavorites
> ViewFavorites 
> ```

然后我们有一个 ExerciseController，它将包含许多类似的操作，例如搜索和收藏操作。是否应该将这些重构为它们自己的控制器，使其成为类似的东西？

```
SearchController {
    SearchExercise
    SearchNutrition
    //... etc
}

FavoritesController {
    ViewNutritionFavorites
    AddToNutritionFavorites
    AddToExerciseFavorites
    EditNutritionFavorites
    EditExerciseFavorites
    //... etc
} 
```

在我看来，如果您将它们分解为单独的控制器，您将在某种程度上增加一个难以置信的大依赖来处理您需要的信息。或者，您将拥有一个完全通用的处理应用程序，该应用程序将非常难以处理，因为您必须跳过这么多圈才能获得所需的效果（在 M、V 或 C 级别）。

我在想这个错误的方式？例如，我是否应该有一个通用的收藏夹对象，然后让控制器决定将它扔到哪个视图？

*抱歉拼出首字母缩略词 - 我这样做是为了以防其他人遇到这个问题并且对这些东西是什么一无所知

**编辑：** 我执行的所有逻辑都在服务层中处理。例如，控制器会将“新”FoodItem 发送到服务。如果它已经存在，或者它有错误，该服务会将它冒泡回控制器。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-21T16:17:23.047

我会根据责任分解你的第一个清单：

**家庭控制器**

*   指数

**食品项目控制器**

*   查看食品项目
*   添加食品项目
*   编辑食物项
*   删除食品项
*   搜索食品

**营养控制器**

*   查看营养总结

**收藏夹控制器**

*   添加到收藏夹
*   从收藏夹中删除
*   查看收藏夹
*   搜索收藏夹

[Django](http://www.djangoproject.com)的 MVC 方法是将职责分离到“应用程序”中，每个应用程序都有自己的模型、控制器，甚至在必要时使用模板。你很可能会有一个食品应用程序、一个营养应用程序、一个搜索应用程序和一个收藏夹应用程序。

编辑：OP提到搜索对每个控制器都更具体，所以我做了这些动作。然而，搜索也可能只是一个通用的全局事物，所以在这些情况下，一个 SearchController 就可以了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T16:23:52.580

照苏维特说的做。你想让控制器保持简单。听起来您最终在控制器中使用了太多的协调逻辑。请记住，他们负责连接视图和模型。这种协调逻辑可能应该被拆分为服务。

我有这种感觉，因为您提到您的控制器可能会产生巨大的依赖关系。好吧，如果 FavoritesController 需要了解营养和锻炼最爱（在同一视图中显示），请不要让您的控制器依赖于 2 个存储库，如类。相反，封装该协调行为。也许创建一个知道如何返回营养和运动收藏夹的收藏夹服务。该服务可能会委托给 NutritionFavoritesService 和 ExerciseFavoritesService。这样，您的控制器仅以 1 个依赖项结束，您保持事物干燥，执行 SRP，并将您的业务逻辑集中在控制器以外的某个地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-02T14:20:10.273

我也经历过这类维护难题，并发现坚持使用类似“Rails”的方法非常有助于让我的控制器保持专注和不臃肿。

如果我发现自己添加了具有不寻常名称的操作，例如。使用博客示例 AddPostToBlog，这将是一个使用 Create 操作创建新 Post 控制器的标志。

换句话说，如果动作不是 Index、New、Create、Show、Edit、Update 和 Destroy 动作之一，那么我添加一个特定于我需要的动作的新控制器。

以你为例。

```
SearchController {
    SearchExercise
    SearchNutrition
    //... etc
} 
```

我会将其重构为...

```
 SearchExerciseController {
           Index   
   }

   SearchNutritionController {
           Index   
   } 
```

这可能意味着拥有更多控制器，但在我看来，这比以往扩展的“上帝”控制器更容易管理。这也意味着控制器更加自我记录。

例如。SearchExercise 操作是返回视图以搜索练习还是实际执行搜索？您可能可以通过查看参数和正文来确定这一点，但它不像新建和创建或编辑和更新操作对那样简单。

```
SearchController {
    SearchExercise       
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T16:23:30.863

我对那个框架不太熟悉，但我可以提供一些一般性的建议。控制器可能应该只知道如何完成单个动作，或者调用其他单个动作控制器来完成一系列相关动作。任何必须在动作之间传递的信息都应该以某种方式通过模型层传递，因为该信息很可能与底层模型相关。

# java - 如何在java中操作列表

> ID：1024229
> 
> 赞同：3
> 
> 时间：2009-06-21T16:12:11.237
> 
> 标签：java, collections

编辑：**我的列表已排序，因为它来自数据库** 我有一个 ArrayList，其中包含 People 类的对象。People有两个属性：ssn和terminationReason。所以我的清单看起来像这样

```
ArrayList: 
ssn            TerminatinoReason
123456789      Reason1
123456789      Reason2
123456789      Reason3
568956899      Reason2
000000001      Reason3
000000001      Reason2 
```

我想更改此列表，以便没有重复项，并且终止原因用逗号分隔。

所以上面的列表会变成

```
New ArrayList: 
ssn            TerminatinoReason
123456789      Reason1, Reason2, Reason3
568956899      Reason2
000000001      Reason3, Reason2 
```

我有一些东西要循环遍历原始列表并匹配 ssn，但它似乎不起作用。

有人可以帮忙吗？

我使用的代码是：

```
 String ssn = "";
    Iterator it = results.iterator();
    ArrayList newList = new ArrayList();
    People ob;
    while (it.hasNext())
    {
       ob = (People) it.next();
       if (ssn.equalsIgnoreCase(""))
       {
           newList.add(ob);
           ssn = ob.getSSN();
       }
       else if (ssn.equalsIgnoreCase(ob.getSSN()))
       {
           //should I get last object from new list and append this termination reason?
            ob.getTerminationReason()
       }
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T16:33:57.670

对我来说，这似乎是使用 a 的好案例`Multimap`，它允许为单个键存储多个值。

[Google Collections](http://code.google.com/p/google-collections/)有一个[`Multimap`](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Multimap.html)实现。

这可能意味着`Person`对象`ssn`和`terminationReason`字段可能必须分别作为键和值取出。（并且这些字段将被假定为`String`。）

基本上，它可以按如下方式使用：

```
Multimap<String, String> m = HashMultimap.create();

// In reality, the following would probably be iterating over the
// Person objects returned from the database, and calling the
// getSSN and getTerminationReasons methods.

m.put("0000001", "Reason1");
m.put("0000001", "Reason2");
m.put("0000001", "Reason3");
m.put("0000002", "Reason1");
m.put("0000002", "Reason2");
m.put("0000002", "Reason3");

for (String ssn : m.keySet())
{
    // For each SSN, the termination reasons can be retrieved.
    Collection<String> termReasonsList = m.get(ssn);

    // Do something with the list of reasons.
} 
```

`Collection`如有必要，可以生成以逗号分隔的 a 列表：

```
StringBuilder sb = new StringBuilder();

for (String reason : termReasonsList)
{
    sb.append(reason);
    sb.append(", ");
}

sb.delete(sb.length() - 2, sb.length());
String commaSepList = sb.toString(); 
```

这可以再次设置为该`terminationReason`字段。

正如 Jonik 在评论中提到的那样，另一种方法是使用[Apache Commons Lang](http://commons.apache.org/lang/)[`StringUtils.join`](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringUtils.html#join(java.util.Collection,%20char))的方法来创建一个逗号分隔的列表。

还应该注意的是，[`Multimap`](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Multimap.html)没有指定实现是否应该或不应该允许重复的键/值对，所以应该看看`Multimap`使用哪种类型。

在此示例中，这[`HashMultimap`](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/HashMultimap.html)是一个不错的选择，因为它不允许重复的键/值对。这将自动消除为特定人员提供的任何重复原因。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T16:21:13.517

```
List<People> newlst = new ArrayList<People>();
People last = null;
for (People p : listFromDB) {
   if (last == null || !last.ssn.equals(p.ssn)) {
      last = new People();
      last.ssn = p.ssn;
      last.terminationReason = "";
      newlst.add(last);  
   }
   if (last.terminationReason.length() > 0) {
      last.terminationReason += ", ";
   }
   last.terminationReason += p.terminationReason;
} 
```

你会在 newlst 中获得聚合列表。

**更新：**如果您使用 MySQL，您可以使用[GROUP_CONCAT](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)函数以您需要的格式提取数据。我不知道其他数据库引擎是否有类似的功能。

**更新 2：**删除了不必要的排序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T16:22:23.687

您可能需要的是哈希。HashMap 可能有用。

在 People 类中覆盖 equals() 和 hashCode()。

使 hashCode 返回人（人）SSN。这样，您将在同一个“桶”中拥有具有相同 SSN 的所有 People 对象。

请记住，Map 接口实现类使用键/值对来保存您的对象，因此您将拥有类似 myHashMap.add("ssn",peopleobject); 的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T16:22:34.857

两个可能的问题：

*   如果您的列表未排序，这将不起作用
*   你没有对*ob.getTerminationReason()*做任何事情。我认为您的意思是将其添加到上一个对象中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T16:27:28.587

**编辑：现在我看到你已经编辑了你的问题。**

由于您的列表已排序，（我认为是 ssn）

```
Integer currentSSN = null;
List<People> peoplelist = getSortedList();//gets sorted list from DB.
/*Uses foreach construct instead of iterators*/

for (People person:peopleList){

 if (currentSSN != null && people.getSSN().equals(currentSSN)){
 //same person
 system.out.print(person.getReason()+" ");//writes termination reason

 } 
 else{//person has changed. New row.
   currentSSN = person.getSSN();
   system.out.println(" ");//new row.
   system.out.print(person.getSSN()+ " ");//writes row header.
 }

} 
```

如果您不想显示列表的内容，可以使用它创建一个 MAP，然后使用它，如下所示。

**如果您的列表未排序**

也许你应该尝试不同的方法，使用 Map。在这里，ssn 是地图的键，值可以是 People 列表

```
Map<Integer,List<People>> mymap = getMap();//loads a Map from input data.

for(Integer ssn:mymap.keyset()){
 dorow(ssn,mymap.get(ssn));
}

public void dorow(Integer ssn, List<People> reasons){

system.out.print(ssn+" ");
for (People people:reasons){
system.out.print(people.getTerminationReason()+" ");
}

system.out.println("-----");//row separator. 
```

最后但同样重要的是，您应该覆盖 People 类的 hashCode() 和 equals() 方法。

例如

```
public void int hashcode(){

  return 3*this.reason.hascode();

} 
```

# java - Flex / Java Web 应用程序有哪些值得推荐的数据建模工具和技术？

> ID：1024235
> 
> 赞同：0
> 
> 时间：2009-06-21T16:15:46.820
> 
> 标签：java, apache-flex, xsd, modeling

我正在寻找您已经成功使用的综合设置。关于我可能使用的积木，我已经有很多提示了，但我不确定如何将它们组合在一起。需要购买的工具也可以。

细节：

我正在为 Java 服务器应用程序开发 Flex 前端客户端，并且我有一组模型类，它们代表我的业务逻辑中的对象，并且应该具有相同的属性并在所有层中表现出相同的行为。这些对象

*   具有用于用户输入的表单验证逻辑
*   在整个 UI 中以各种形式（列表、详细视图...）显示
*   使用 XML 或 AMF 从服务器检索并发送到服务器
*   在服务器上再次验证
*   存储在 RDBM 中，表和字段对应于类和字段

我猜这是一个非常常见的应用程序结构。我已经在使用：

*   Java 后端的 ORM（Eclipse 持久性包）
*   从 XML 到动作脚本的自动映射，使用 XML 模式和 mx.rpc.xml 中的类，如此[处](http://blog.misprintt.net/?p=192)所述。

现在，我真正想做的是定义一次对象（我已经在 XSD 中拥有它们）并让工具为整个链设置类存根。我可以使用什么？

我已经听说过（但没有评估过）：

*   XMLBeans 从 XML Schema 生成 Java 类
*   Granite DS 从 Java 类生成 AS 类

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T20:53:22.543

我认为您的 Flex UI 不应该知道或关心 Java 对象。

采用“合同优先”、XML 模式驱动的方法，并提出您需要在 Flex 客户端和服务层之间交换的消息。一旦你有了它，两者就完全解耦了。这是一个好的开始。

我还建议不要购买一代计划。在开发过程中，您只需支付一次该价格。

我是 Spring 用户，所以我推荐[Spring 的“契约优先”Web 服务](http://static.springsource.org/spring-ws/sites/1.5/reference/html/tutorial.html)，使用 Spring OXM 接口。这将使您的 UI 和服务层很好地分离。使用 org.springframework.oxm 接口进行映射。

您可以使用[Spring/BlazeDS](http://www.springsource.org/spring-flex)将您的 Flex UI 与 Spring 后端集成。

您拥有 Spring IoC 和 AOP 的全部功能来创建后端。

我想你会发现这是解决这个问题的好方法。

# wpf - 有没有办法将 WPF 绑定标记与绑定类的实例进行转换？

> ID：1024237
> 
> 赞同：0
> 
> 时间：2009-06-21T16:18:03.670
> 
> 标签：wpf, xaml

例如我有以下绑定标记

```
Text="{Binding Path=FirstName}" 
```

非常简单，但它可能要复杂得多，我需要能够解析这个标记并将其转换为某种对象化的形式，例如 Binding 类的实例。

可以反过来工作的东西，一个绑定类的实例来吐出标记也会很棒。

我知道框架中必须存在这样的东西，但我不知道在哪里/什么类。

我查看了 XamlReader 但无法让它工作，因为在这种情况下我缺少上下文，因为我只处理项目的一部分而不是整个项目。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T08:46:27.803

您可以使用 GetBindingExpression 获取 Binding 对象，例如，如果您有：

```
<TextBlock Name="MyTextBlock" Text="{Binding Name}"/> 
```

您可以使用：

```
BindingExpression expr = BindingExpression.GetBindingExpression(MyTextBlock, TextBlock.TextProperty);
Binding bindingObject = expr.ParentBinding; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T17:55:19.567

要使用 XAMLReader，您必须使用有效的根来包围它。那么这应该工作。

# css - 除了 javascript 之外还有什么方法可以修复 IE 6 的错误吗？

> ID：1024240
> 
> 赞同：0
> 
> 时间：2009-06-21T16:19:43.080
> 
> 标签：css, internet-explorer

对于 IE 6，我们作为设计师有很多 bug。

不正确的盒子模型等

我已经通过 JavaScript 搜索修复并找到

[链接文本][1] IE7.js IE7 是一个 JavaScript 库，用于使 Microsoft Internet Explorer 的行为类似于符合标准的浏览器。它修复了许多 HTML 和 CSS 问题，并使透明 PNG 在 IE5 和 IE6 下正常工作。

但是除了通过 css 的 javascript 之外，我们是否有真正的生命保护程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T16:24:35.920

另一种方法是生活在 IE 6 的错误世界中，并设计您的页面以使其看起来正确。根据您的设计，您可以为您的 IE6 客户端提供不同的 css，甚至在必要时提供不同的 html。在某些情况下，您可以使用一个对 IE6 客户端具有不同含义的 CSS 文件，但这种技术对于 IE7 和 8 来说是有问题的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T16:26:49.383

用 CSS 处理 IE6 错误的方法？当然。

有条件的评论见：[http ://www.quirksmode.org/css/condcom.html](http://www.quirksmode.org/css/condcom.html)

还有其他方法，例如在某些 CSS 属性中添加一些特定字符，这些字符在*某些*浏览器中会被忽略，而在其他浏览器中则不会。

然而，在某些情况下，网页设计师在使用这些时应该非常谨慎。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-27T17:44:13.047

这个链接也很方便

[你如何处理 Internet Explorer？](https://stackoverflow.com/questions/927626/how-do-you-deal-with-internet-explorer)

我从来不知道这一点 - 感谢 svinto “IE6 没有错误的盒子模型，除非你有错误的文档类型。 - svinto”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T17:01:43.757

有一些简单的样式表技巧可以修改各种 Internet Explorer 版本中的演示文稿，以解决您的 CSS 问题。比如这三个：

用于 IE4、IE5、IE5.5 的简化盒模型破解：

```
div.values { margin: 10px; m\argin: 20px; } 
```

用于 IE4、IE5、IE5.5 和 IE6 的明星 html hack：

```
* html div.values { margin: 5px; } 
```

IE7 的明星 first-child+html hack：

```
*:first-child+html div.values { margin: 5px; } 
```

PNG透明度问题可以通过以下解决方案来解决：

```
<div style="width:50px;height:50px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/images/logo/logo.png');">
   <img src="/images/logo/logo.png" height="50" width="50" alt="" style="filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" />
</div> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T18:09:08.767

到目前为止的信息很好，但要注意的一件事是 IE7.js 并不能在所有情况下修复 png（至少我最后一次查看）。例如，您将无法平铺具有透明度的背景图像。

在 DXImageTransform 的情况下，您可能会发现当它应用于包含链接的元素时，这些链接不再是“可点击的”。您有时可以通过为应用了变换的父元素提供静态定位并定位子锚元素来解决此问题，例如，

```
h2{
position:static;
zoom:1;
filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="/images/mypng.png", sizingMethod="scale");
}
h2 a{
position:relative;
}
<h2><a href="" >a link!</a></h2> 
```

如果您必须做这种垃圾，请将其放在单独的样式表中，并使用条件注释控制加载。如果设计有任何复杂性，请尽量不要支持 ie6 或 <。如果您无法避免这样做，请收取更多费用；）。有时这足以说服某人支持 ie6 不“值得他们花时间”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-21T22:43:28.280

你为什么不试试 FireBug Light for IE？它不如 FireFox FireBug 强大，但可以提供帮助

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-22T14:13:21.543

使用条件注释或 CSS 选择器技巧可以解决 CSS 中的许多错误。但是有一些单独的 CSS hack 无法处理的错误，例如 IE6 的 .multiple.class.selector.bug

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-14T15:05:07.107

IE6 样式还有另一个快速而肮脏的 hack，例如

您可以将 CSS 定义为；

.divTitle { 填充：5px; 宽度：600px；_宽度：590px；}

所有其他浏览器选择 600px 作为宽度值 & IE6 覆盖它 & 取 590px;

我也在 IE7 和 FF 中对此进行了测试。

您也可能需要检查此链接； [链接文本](http://code.google.com/p/ie7-js/)

# database - 工具栏上的宏 - Office 2000

> ID：1024242
> 
> 赞同：1
> 
> 时间：2009-06-21T16:21:00.583
> 
> 标签：database, ms-access, macros, ms-office

我办公室的某个人有一个 Access 数据库，其中包含工具栏中的宏。目前要访问它，他们必须退出域并进入本地用户帐户。他们希望办公室中的其他人能够访问数据库，他们可以，但他们不能使用工具栏上的宏。

当前安装的 Office 版本是 Office 2000。

有没有办法将宏复制出来，以便域用户可以将它们与数据库一起使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T16:42:56.907

听起来您需要启用宏才能运行它们可能被禁用以防止病毒。为此，我认为它在工具菜单下，然后是宏，然后是安全性。

您可能需要管理员权限才能执行此操作。如果您将安全级别设置为“中”，系统会在您每次打开数据库时询问运行宏是否安全。

如果将其设置为低，它将运行任何可能危险的宏，具体取决于打开的内容。

如果将其设置为高，则仅允许运行签名或受信任的宏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T04:27:45.930

嗯，这不可能是access中的宏安全设置，因为access 2000没有这个功能。

如前所述，这可能是一个组策略。另外，您声明了宏，但您是在谈论 VBA 代码还是 ms-access 宏？虽然大多数办公室我们将代码称为宏，但 ms-access 是不同的。例如，字宏是 VBA 代码。但是，ms-access 在这方面有所不同，ms-access 既有宏又有 VBA 代码。所以，它们并不相同。

您当然可以通过查看宏选项卡来查看并尝试运行和复制宏。您可能必须在启动期间按住 shift 键 - 这将阻止任何隐藏 ms-access 界面的设置，并允许您查看、查看和复制这些宏。那么，应用程序中是否有代码或宏？

您可以复制这些宏，但如果组策略阻止了这一点，那么复制复制宏的能力将无济于事。

# permutation - 找到没有元素留在原地的排列

> ID：1024245
> 
> 赞同：1
> 
> 时间：2009-06-21T16:22:02.550
> 
> 标签：permutation, combinatorics

我正在处理每个元素与其原始位置不同的排列。我想要一个给定{输入长度，行和数字}的算法，会给我输出数字。这是一个例子：

如果输入长度为四，则 0123 的所有排列为：

```
0123,0132,0213,0231,0312,0321,
1023,1032,1203,1230,1302,1320,
2013,2031,2103,2130,2301,2310,
3012,3021,3102,3120,3201,3210 
```

没有数字在同一位置的排列（每个数字都移动了）：

```
1032,1230,1302,
2031,2301,2310,
3012,3201,3210 
```

编号从 0 开始，因此如果函数的输入是 {4,0,0}，则输出应该是第 0（第一个）排列的第 0（最左边）数字。1032的第一位是1。

如果输入是 {4,1,1}，则输出是 1230 的第二个数字，即 2。

行数可能大于排列数。在这种情况下，取余数模排列数（在上述情况下，行模 9）。

在c语言中会很棒。

（这不是家庭作业，是为了工作。Cuckoo hashing 如果你必须知道的话。我想随机选择我将在每个阶段进行的交换，看看当表数大于两个时它是否比 BFS 更好.)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-31T03:02:44.303

为什么不只是构建一棵树并遍历它呢？

例如，如果您有数字`0123`，那么您知道最左边的数字只能来自`set {1,2,3}`。这将作为您树中的第一级。

那么，如果你沿着从 1 开始的路径，你只有三个选项，`{0, 2, 3}`。如果您在第一级中以 2 开头，则只有两个选项`{0,3}`（因为您不能在左侧第二个数字中使用 1 并且 2 已被使用（您可以从列表中弹出 2选择））等。

在这种方法中要注意的是，如果您到达分支的末尾，而 3 是您唯一的选择，在这种情况下，您只需将其删除。

对于`n > 10`生成所有排列然后过滤可能会出现问题。我认为建造树会显着减少这一点。

如果需要，您可以即时构建树。您的顺序可以通过您遍历树的方式来定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T19:14:03.493

Python 中的蛮力方法（您可以使用它来测试您的 C 实现）：

```
#!/usr/bin/env python
from itertools import ifilter, islice, permutations

def f(length, row, digit):
    """
    >>> f(4, 0, 0)
    1
    >>> f(4, 1, 1)
    2
    """
    # 1\. enumerate all permutations of range (range(3) -> [0,1,2], ..)
    # 2\. filter out permutations that have digits inplace
    # 3\. get n-th permutation (n -> row)
    # 4\. get n-th digit of the permutation (n -> digit)
    return nth(ifilter(not_inplace, permutations(range(length))), row)[digit]

def not_inplace(indexes):
    """Return True if all indexes are not on their places.

    """
    return all(i != d for i, d in enumerate(indexes))

def nth(iterable, n, default=None):
    """Return the nth item or a default value.

    http://docs.python.org/library/itertools.html#recipes
    """
    return next(islice(iterable, n, None), default)

if __name__=="__main__":
    import doctest; doctest.testmod() 
```

# google-code - 如何禁用对 Google Code 中源代码的公开访问？

> ID：1024258
> 
> 赞同：15
> 
> 时间：2009-06-21T16:26:03.907
> 
> 标签：google-code

我有一个私人项目，我希望它托管在谷歌代码上。该项目仅供项目成员使用。如何只为项目成员启用浏览和提交SVN代码？我不希望其他人能够做到这一点。

如何禁用对 Google Code 中源代码的公开访问？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-21T16:35:06.763

Google 代码没有读取限制，因此无法创建完全私有的项目。

如果你想要一个私有代码存储库，我建议你检查这个问题：

*   [非公开项目的免费版本控制服务器提供商](https://stackoverflow.com/questions/430742/)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-21T16:29:35.827

你不能...

> 我们只打算主办开源软件项目、与开源软件开发直接相关的文档项目以及用于开发和维护开放标准的项目。

[http://code.google.com/p/support/wiki/MakingHostingBetter](http://code.google.com/p/support/wiki/MakingHostingBetter)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T16:29:42.567

我认为你不能。在 googleCode 托管的项目必须是公开的！

检查[常见问题](http://code.google.com/support/bin/topic.py?topic=10380)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-08T10:52:56.877

你不能，但你可以隐藏一些标签

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-28T09:37:56.273

当然还有 Google Code 的替代品。[BitBucket](https://bitbucket.org)提供免费托管，并允许免费使用私人存储库。有一些限制，但对于一个团队成员很少的相当小的项目，你可能没问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-31T14:04:27.000

目前是**不可能**的。

但是，目前[此功能请求上有 1663 颗星](https://code.google.com/p/support/issues/detail?id=1829)。由于这是您想要的功能，因此您也应该**继续为它加注星标**。

功能请求获得的星数越多，它获得的优先级就越高。（嗯，至少这是可以预料的。）

# wpf - 导致问题的循环资源引用？

> ID：1024264
> 
> 赞同：2
> 
> 时间：2009-06-21T16:28:44.220
> 
> 标签：wpf, resources

我有一个 WPF 应用程序，它由*NavigationWindow*中的*Pages*组成。在 App.Xaml 中，我创建了所有页面，以便在使用导航命令时可以引用它们。它有点像这样：

 *```
<Application ...>
 <Application.Resources>
  <FirstPage x:Key="first"/>
  <SecondPage x:Key="second"/>
 </Application.Resources>
</Application> 
```

当 FirstPage 引用“第二个”或反之亦然时，会发生“循环”引用（不知道还能称之为什么）。在这个例子中，我们只说**FirstPage**引用“**第二个”。**

```
<FirstPage ...>
  ...
  <Button
    CommandParameter="{StaticResource second}"
  </Button>
</FirstPage> 
```

（**在你开始回答之前，我会先了解一下FirstPage和SecondPage添加到应用程序资源中的顺序！**）

这种情况会导致一些奇怪的、无用的错误。首先，在 App.xaml 中，我得到了错误

> 无法创建 FirstPage 类型的实例

所以我翻到 FirstPage 并尝试在设计器中加载它。在 xaml 中，我引用“**第二个**”的行被突出显示，并显示了这个非常有用的错误消息：

> 应用程序 XAML 加载失败。在尝试加载其他 XAML 文件之前修复应用程序 XAML 中的错误

先有鸡还是先有蛋？App.xaml 无法加载，因为它无法创建 FirstPage，我无法修复 FirstPage，因为它实际上是 app.xaml 的问题。

我试图解决的问题：
1）我尝试更改添加到*Application.Resources*的项目的顺序。我想如果 FirstPage 需要获取 SecondPage，那么必须在 FirstPage 出现之前添加 SecondPage 并使其可用。这行不通。
2）我尝试使用**DynamicResource**而不是**StaticResource**。没有帮助。
3）我尝试在代码中添加 Page 实例。这有效，但并不令人满意。

**注意，应用程序编译并运行良好；问题是为什么这在设计时会中断。**

* * *

我能做些什么来解决这个问题？我需要在所有地方访问我的页面以用作导航参数，这就是我将它们放在应用程序资源中的原因。有没有其他方法可以做到这一点？如果我能提供帮助，我只想要应用程序中每个页面的单个实例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T07:29:55.477

您可以使用资源名称而不是资源本身作为参数。然后您的命令可以为您查找实际资源。*

# mono - 将 Linux ioctl 与 Mono 一起使用

> ID：1024270
> 
> 赞同：5
> 
> 时间：2009-06-21T16:30:03.113
> 
> 标签：mono, ioctl

我正在尝试通过 Mono 框架执行 ioctl 命令，但我找不到我要找的东西。

我正在尝试向具有内核模块的 DVB 卡发送命令。我希望有人可以链接或清楚地解释如何做到这一点。我猜任何使用内核模块的 Mono 示例都会很有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T09:50:13.087

Mono 在 Mono.Unix 中不包含 ioctl 的包装器，因为 ioctl 调用参数变化很大，这样的包装器几乎没有用处。您应该为您需要的每个 ioctl 声明一个[DllImport](http://mono-project.com/Interop_with_Native_Libraries)。

您可能不需要用 C 编写的帮助程序库，但是，您可能在开发过程中需要它来提取隐藏在不同 C 预处理器宏后面的实际值。例如，要扩展 C 标头：

```
#define FE_GET_INFO                _IOR('o', 61, struct dvb_frontend_info) 
```

编译并执行这个助手：

```
#include <linux/dvb/frontend.h>
#include <stdio.h>

int main()
{
  printf("const int FE_GET_INFO = %d;\n", FE_GET_INFO);
  return 0;
} 
```

[关于该主题的简短单声道邮件列表讨论](http://lists.ximian.com/pipermail/mono-list/2006-July/032069.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T17:32:48.647

Mono AFAIK 不支持 ioctl。太特定于操作系统和参数列表取决于实际请求。你可以试试 DLLImport

[与本机库互操作](http://mono-project.com/Interop_with_Native_Libraries)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T18:13:38.760

您应该为您的确切调用编写一个包装库。看看 Mono.Unix 如何包装系统调用（谷歌代码搜索 Mono.Unix Syscall.cs）来了解这个想法。然后为每个特定的 ioctl 命令创建一个包装器，它使用您自己的数据表示。

正如 jitter 所说 - 你需要 DLLImport ioctl 本身。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-11T23:02:56.553

检查我的[类似问题](https://stackoverflow.com/questions/10387603/p-invoke-ioctl-system-call)，以及稍后关于该[主题](https://stackoverflow.com/questions/10972740/c-sharp-union-structure-marshalling)的问题。在这种情况下，我试图包装 Videl4Linux 接口，您可能会对此感兴趣。

我真的建议这些读数。

# vb6 - 检测文件夹的内容是否已更改？

> ID：1024274
> 
> 赞同：0
> 
> 时间：2009-06-21T16:30:58.823
> 
> 标签：vb6, vbscript, wmi, directory, windows-98

条件：

*   视窗 98 SE
*   WMI 不可用

我有看起来像这样的代码，使用我使用 MSScript 的 VBScript 的类固醇包装编写。

```
do
    a = files.collectfiles( "c:\userver", "" )
    for i = 0 to ubound( a )
        f = a(i)
        if strings.endswith( f, ".usv" ) then
            d = files.readfilee( f )
            on error resume next
            executeglobal d
            nErr = err.number
            sErr = err.description
            on error goto 0
            if nErr <> 0 then
                trace "*** Error " & nErr & ", " & sErr
            end if
            files.deletefile f
        end if
    next
    system.sleep 10
    system.cooperate
loop 
```

对files.collectfiles 的调用有很多磁盘活动。是否有某种方法可以检测文件夹内容的变化，而无需实际扫描文件夹中的文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T17:06:01.847

有一个样本声称适用于从 Win95 到至少 WinXP 的所有版本。在Win98下用VB5开发。使用（然后？提供到下面文档的链接）未记录的 SHChangeNotify* 函数。

[SHChangeNotifyRegister：接收外壳变更通知](http://vbnet.mvps.org/index.html?code/shell/shchangenotify.htm)

[SHChangeNotifyRegister 函数](http://msdn.microsoft.com/en-us/library/bb762120.aspx) [SHChangeNotifyDeregister 函数](http://msdn.microsoft.com/en-us/library/bb762119(VS.85).aspx)

这里还有另一个使用[ReadDirectoryChangesW](http://msdn.microsoft.com/en-us/library/aa365465(VS.85).aspx)的解决方案：

[VB6 WinAPI ReadDirectoryChangesW](http://www.vbcity.com/forums/topic.asp?tid=28055)（查看Yang Kok Wah 的第5 篇文章）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T16:39:44.410

定义“更改文件夹内容”。

如果这意味着文件被添加、删除或重命名，则每当发生此类事件时都会更新文件夹的修改时间戳。

如果您想知道文件何时被修改，那么您需要阅读它们。

也就是说，查看您要执行的操作（扫描文件夹以查找新的 .usv 文件，然后处理它们并删除它们），然后只需跟踪文件夹上的时间戳并在调用 collectfiles 之前立即更新它是最好的（请注意，正确的记录时间是在调用 collectfiles 之前，否则如果在 collectfiles 调用期间或之后立即添加文件，您将面临无法唤醒的风险）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T16:49:12.383

你特别要求在 VB 中运行一些东西并在 win98 上运行，我对此没有答案，但 MS 有 ac/win32 示例，说明如何使用[FindFirstChangeNotification](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)在 Windows2000+ 上实现这一点。[另一件事是，.NET 中的“ FileSystemWatcher](http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemiofilesystemwatcherclasstopic.asp) ”显然在 Win98 上不起作用/不受支持。我的观点是什么？对此可能没有简单的解决方案，您必须自己想出一些办法。

# flash - Flash 8 AS2 鼠标点击行为：在鼠标移动之前，点击的位置变得不可点击

> ID：1024282
> 
> 赞同：0
> 
> 时间：2009-06-21T16:36:25.533
> 
> 标签：flash, mouse, actionscript-2, click, double-click

我在舞台上有一系列按钮，可以使用检测到双击的计时器来双击它们。在我刷新页面并加载另一批按钮之前，这一切都很好。问题开始了……

如果我单击屏幕上的某个点，我将无法重新单击该相同点。我必须稍微移动鼠标才能再次单击。这导致了检测双击的问题 - 现在它的点击移动点击！

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-24T16:23:37.180

我对 CS3 和 AS2.0 有同样的问题。到目前为止有没有人解决这个问题？？？几天来，我一直试图在一个复杂的彩票应用程序中解决它。

在这个线程[http://www.actionscripts.org/forums/showthread.php3?t=141081](http://www.actionscripts.org/forums/showthread.php3?t=141081)我发现了将帧速率降低到 12fps 的建议，但这也没有帮助......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T07:25:59.307

I have had this problem too in the past and I'm pretty sure I solved it back then. I've been digging through some code but I can't find the code I was looking for but checking out the documentation for the MovieClip object I'm pretty sure it can solved by setting the `focusEnabled` property of your MovieClip to `true` (but I could be wrong :).

I will have another look for the code I was looking for but I need to get in out of backed up storage somewhere...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T22:35:39.233

这不是答案，而只是一种方法，因为要回答您的问题，我需要使用 AS 2.0 启动 Flash IDE（我通常会尝试忘记它，因为我很少使用 3.0）并设置测试工具正如你所看到的，只是问题所在。我想一旦你这样做了，你会发现：

1）您在 Flash 中发现了一个真正的错误（可疑），然后它的答案将在整个互联网上贴满 2）最有可能：您的测试工具没有表现出奇怪的行为。然后是弄清楚你的真实程序与你的测试工具有何不同的问题。3）这真的很酷：您的测试工具也不起作用。然后，您将 .fla 的 zip 文件放在某个 Web 位置，我们可以下载它并找出其中的内容。

我看过一些关于 AS2.0 中双击的帖子，但没有人提到这个问题。

# actionscript-3 - 克隆 Web 服务

> ID：1024285
> 
> 赞同：0
> 
> 时间：2009-06-21T16:41:26.923
> 
> 标签：actionscript-3, actionscript, clone

有没有办法在 as3 中克隆 WebService 对象？ObjectUtil 方法似乎引发了错误。

如果没有，是否有办法缓存 wsdl 并将其分配给新的 WebService 对象，以便可以省略 wsdl 的持续加载？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-22T11:37:25.913

我可以使用 AsyncToken 类来完成我需要的东西。这是我的问题的正确解决方案。使用 AsyncToken 我可以重用相同的 WebService 对象。

它没有解决需要克隆 WebService 类的问题。

# iphone - 是否可以使用 iphone gamekit api 扫描蓝牙“id”

> ID：1024296
> 
> 赞同：2
> 
> 时间：2009-06-21T16:48:26.533
> 
> 标签：iphone, api, bluetooth

好的，在我收到大量回复之前。我知道您无法与其他蓝牙设备通话（交换数据或其他方式）。我只是想知道当您使用 Peer Picker 时是否会出现蓝牙 ID，因为我目前正在调查检测其他蓝牙设备的能力，而不是实际配对。

把它想象成蓝牙 RFID。

干杯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T17:00:32.977

如果蓝牙端点是通过 Bonjour 发布的（通常是这种情况），您可以通过标准 Bonjour 机制对其进行扫描，但 AFAIK 您无法扫描原始蓝牙 ID。对等选择器隐藏了更多，并将扫描限制在使用相同应用程序服务 ID 发布的设备（因此您只能看到您周围运行相同应用程序的其他人）。

# php - mod_rewrite 接管页面上的所有链接

> ID：1024303
> 
> 赞同：0
> 
> 时间：2009-06-21T16:52:04.627
> 
> 标签：php, mod-rewrite, seo

我使用 mod_rewrite 来重写我网站上的链接，如下所示：

```
mysite.com/store/<store_id>/<store_name>/<page>
mysite.com/store.php?id=<store_id>&page=<page> 
```

例如：

```
mysite.com/store/1313/johnny-walker-inc/13
mysite.com/store.php?id=1313&page=13 
```

但是，结果是，我们关联放置的所有链接现在都从链接的末尾开始，例如：

```
mysite.com/send_message.php 
```

已经成为

```
mysite.com/store/1313/johnny-walker-inc/send_message.php 
```

我怎样才能解决这个问题？

这是我的`mod_rewrite`代码，以防我出错：

```
 RewriteRule ^store/([0-9]+)/[^/]+/([0-9]+)$ store.php?storeid=$1&page=$2 [L]
```

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T16:56:32.093

您需要使链接相对于根，如下所示：

```
<a href="/send_message.php">link</a> 
```

注意前面的斜线`send_message.php`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T16:58:59.360

我个人只看到一个解决方案：只需将所有链接设为绝对链接即可。这不是 mod_rewrite 的直接问题，而是浏览器解释这些链接的方式。从他们的角度来看，您有一个目录结构，他们会相应地解释相对位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T18:14:12.410

其他解决方案包括 BASE href 或仅重写您向客户端显示的虚构上下文根可以引用的所有页面元素。

# iphone - iPhone：使用 Quartz 2D 转换图像

> ID：1024304
> 
> 赞同：1
> 
> 时间：2009-06-21T16:52:27.373
> 
> 标签：iphone, core-graphics, quartz-graphics, cgcontext

我正在尝试使用 CGContextRef 对图像应用一些转换。我正在使用 CGContextTranslateCTM、CGContextScaleCTM 和 CGContextRotateCTM 函数，但为了简单起见，我们只关注第一个。我想知道为什么下面的代码会产生原始图像？！我错过了什么吗？

```
CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();

CGContextRef g = CGBitmapContextCreate((void*) pixelData, 
                                                       width, 
                                                       height, 
                                                       RGBA_8_BIT, 
                                                       bytesPerRow, 
                                                       colorSpace, 

                                                   kCGImageAlphaPremultipliedLast);

CGContextSetShouldAntialias(g, YES);

CGContextSetInterpolationQuality(g, kCGInterpolationHigh);

CGContextTranslateCTM( g,translateX, translateY );

CGImageRef tempImg  = CGBitmapContextCreateImage (g);
CGContextDrawImage( g, CGRectMake (0, 0, width, height), tempImg );
CGContextRelease(g);
CGColorSpaceRelease( colorSpace ); 
```

此外，翻译后，如何在此图像上绘制另一张图像但具有部分透明度（例如 alpha = 0.5）。

我搜索了很多但没有找到答案，感谢任何帮助...... :)

请注意，我正在从 pixelData 创建上下文，并且 tempImg 是在翻译之后创建的。初始化没有任何问题，因为当前正在生成原始图像，但问题在于我想的翻译..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T17:41:04.660

对图形状态的转换只会影响后续的绘图操作——它们不会改变现有的图像数据。如果您想对图像应用变换，请尝试以下操作：

1.  创建一个空的 CGContext（在 iPhone 上，使用 UIGraphicsBeginImageContext）
2.  平移、缩放或旋转其图形状态
3.  将现有图像绘制到其中。
4.  从新的 CGContext 获取图像（在 iPhone 上，使用 UIGraphicsGetImageFromCurrentImageContext）

当您执行第 3 步时，现有图像将被绘制到您的新图形上下文中，并应用了转换。这里的诀窍是，为了应用转换，我们必须实际绘制一些东西。

您可以通过这种方式进行一些非常酷的转换。您可以绘制一半图像，应用一些变换，然后再绘制一些。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:53:37.847

如其他答案所述，转换仅适用于后续绘图操作；它们不会影响您开始使用的像素缓冲区。

所以你需要一个绘图操作。解决方案是[创建一个 CGImage](http://developer.apple.com/iphone/library/documentation/GraphicsImaging/Reference/CGImage/Reference/reference.html#//apple_ref/c/func/CGImageCreate)；[绘制该图像](http://developer.apple.com/iphone/library/documentation/GraphicsImaging/Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/CGContextDrawImage)是一个绘图操作，因此它将受到当前变换矩阵（CTM）的影响。

一步步：

1.  *使用空*像素数据创建上下文。（如果您传递`NULL`缓冲区，Quartz 应该为您创建它们。无论如何，这适用于 Mac。）
2.  使用要转换的像素数据创建图像。
3.  在上下文中转换 CTM。
4.  绘制图像。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-21T17:04:47.090

绘制图像**后**，您必须调用 CGBitmapContextCreateImage() 。

然后您可以在第一个图像之上绘制另一个图像并再次调用 CGBitmapContextCreateImage() 以获取第二个图像。您可以使用 CGContextSetAlpha(ctx, alphaValue); 设置 alpha

# ruby-on-rails - 如何在 Rails 的类回调中访问 ActiveRecord 关联？

> ID：1024306
> 
> 赞同：1
> 
> 时间：2009-06-21T16:53:07.357
> 
> 标签：ruby-on-rails, callback

## 更新

似乎是一个优先错误，与我最初提出的问题无关。请参阅下面的讨论。

## 原始问题

是否可以在回调中使用活动记录关联？我已经在控制台中测试了这段代码，只要它不在回调中，它就可以正常工作。我正在尝试创建从其他关联模型中提取属性的回调，并且我不断收到 nil.attribute 的错误。

如果回调不是正确的方法，那么如何在 Rails 中执行类似的操作？如果关联很简单，您可以使用 create_association(attributes => )，但随着关联变得更加复杂，这开始变得混乱。

例如...

```
class User < ActiveRecord::Base
  belongs_to :b
  before_validation_on_create {|user| user.create_b} #note, other logic prevents creating multiple b
end

class B < ActiveRecord::Base
  has_many :users, :dependent => destroy
  after_create{ |b| b.create_c }
  has_one :c
end

class C < ActiveRecord::Base
  belongs_to :b
  after_create :create_alert_email

  private
  def create_alert_email 
    self.alert_email = User.find_by_b_id(self.b_id).email  #error, looks for nil.email
  end
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T17:04:21.430

您的回调中提供了课程外关联。毕竟，create_after_email 只是一个方法。您甚至可以单独调用它，而无需使用回调。ActiveRecord 不会对回调方法应用任何特殊标志来防止它们像任何其他方法一样工作。

另请注意，您正在直接运行 User#find 查询，而没有利用任何关联方法。在这种情况下，ActiveRecord 关联功能不应该是罪魁祸首的另一个原因。

您收到错误的原因可能应该在其他地方搜索。确保 self.b_id 已设置并引用有效记录。也许它是 nil 或者实际上没有具有该值的用户记录。事实上，您不需要测试查询返回的是记录还是 nil：您假设具有该值的记录始终存在。你确定这个假设总是成立的吗？

# jquery - 如何使用 jQuery 添加特定于链接的滚动动画，水平和垂直？

> ID：1024312
> 
> 赞同：0
> 
> 时间：2009-06-21T16:57:41.670
> 
> 标签：jquery, scroll, slide

[我的网站](http://www.alwaystwisted.com)上有这个脚本：

```
$(document).ready(function() {
  function filterPath(string) {
    return string
      .replace(/^\//,'')
      .replace(/(index|default).[a-zA-Z]{3,4}$/,'')
      .replace(/\/$/,'');
  }

  $('[href*=#]').each(function() {
    if ( (filterPath(location.pathname) == filterPath(this.pathname))
      && (location.hostname == this.hostname)
      && (this.hash.replace(/#/,'')) ) {

      var $targetId = $(this.hash), 
        $targetAnchor = $('[name=' + this.hash.slice(1) +']');
      var $target = $targetId.length 
        ? $targetId 
        : $targetAnchor.length ? $targetAnchor : false;
      if ($target) {

        var divOffset = $target.parent().offset().top;
        var pOffset = $target.offset().top;
        var pScroll = pOffset - divOffset;

        $(this).click(function() {
          $target.parent().animate({scrollTop: pScroll + 'px'}, 600);
          return false;
        });
      }
    }
  }); 
}); 
```

`div`它运行良好，可以上下滚动主导航等，但我希望`div`服务部分内的 s 左右滚动。我还想在投资组合部分添加一个滑块，但上面的代码规则任何附加代码，因为它应用于所有`<a href...>`标签。我如何只将它指定给 mainnav `ul`？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T17:22:33.793

将选择器从“[href*=#]”更改为“ul.mainnav [href*=#]”。

在使用 jQuery 时，如何编写只为您提供所需元素的选择器可能是最重要的事情。我只能推荐阅读[关于选择器的精美 jQuery 文档](http://docs.jquery.com/Selectors)（但也推荐其他内容）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T17:22:03.700

假设您具有以下结构，并且您只想将函数应用于“foo”链接。并保持所有其他不变。

```
<div id="mainnav">
  <ul>
    <li>
      <a href="#">foo</a>
    </li>
    <li>
      <a href="http://www.example.com">foo2</a>
    </li>
  </ul>
  <ul>
    <li>
      <a href="#">foo3</a>
    </li>
  </ul>
  <a href="#">foobar</a>
</div> 
```

然后你可以使用这样的 jQuery 选择

```
$("#mainnav > ul:first").find("a[href*=#]").css('color','red'); 
```

碎成碎片

```
$("#mainnav > ul:first")
//give me the element with id mainnav and then the first ul child element of it

.find("a[href*=#]")
//find all link elements in this ul which have href set to #

.css('color','red');
//and set their color to red 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T17:24:06.240

我不确定我是否完全理解您的问题，但如果您正在寻找一种仅在某个元素中查找链接的方法，您可以扩展您的选择器：

```
// Assuming your mainnav ul has id="mainnav"
$('ul#mainnav [href*=#]').each(...); 
```

但是，如果您问我，这主要是一个临时解决方案。迟早您可能希望将效果应用到其他元素。`class`您可以为想要效果的元素添加一个属性：

```
<a href="#" class="scroll-effect">...</a> 
```

然后像这样选择它们：

```
$('.scroll-effect').each(...); 
```

# syncfusion - Syncfusion DocIO -- how to insert image (local file) at bookmark using BookmarksNavigator

> ID：1024320
> 
> 赞同：0
> 
> 时间：2009-06-21T17:00:53.320
> 
> 标签：syncfusion

I have been using Syncfusion DocIO for generating MS Word documents from my .net applications (winforms). So far I have dealt with plain text and it is fairly straightforward to insert text in a word document template where bookmarks serve as reference points for text insertion.

I am navigating the bookmarks using BookmarksNavigator.MoveToBookmark() . Now I need to insert an image at a bookmark but I am at a loss at how to go about it.

Please help...

Thanks.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-11-22T21:31:17.923

专门用于将其添加到书签：

```
 //Move to the specified bookmark
            bk.MoveToBookmark(bookmark);

            //Insert the picture into the specified bookmark location
            bk.DeleteBookmarkContent(true);

            // we assume the text is a full pathname for an image file
            // get the image file
            System.Drawing.Image image = System.Drawing.Image.FromFile(sText);

            IWParagraph paragraph = new WParagraph(document);
            paragraph.AppendPicture(image);
            bk.InsertParagraph(paragraph); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-23T16:33:05.230

```
private System.Drawing.Image LoadSignature(string sFileName)
{
    string sImagePath = sFileName;
    System.Drawing.Image image = System.Drawing.Image.FromFile(sImagePath);
    return image;
}

private void MergeSignature(WordDocument doc, string sFile, string sBalise)
{
    System.Drawing.Image iSignature = LoadSignature(sFile);
    WordDocument ImgDoc = new WordDocument();
    ImgDoc.AddSection();
    ImgDoc.Sections[0].AddParagraph().AppendPicture(iSignature);

    if (iSignature != null)
    {
        TextSelection ts = null ;
        Regex pattern = new Regex(sBalise);
        ts = doc.Find(pattern);

        if (ts != null)
        {
            doc.ReplaceFirst = true;
            doc.Replace(pattern, ImgDoc, false);
        }
    }
    iSignature.Dispose();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-10-18T09:43:14.493

见这里：[https ://help.syncfusion.com/file-formats/docio/working-with-mailmerge](https://help.syncfusion.com/file-formats/docio/working-with-mailmerge)

1) 您应该创建名为“Template.docx”的 docx 文件。该文件将用作模板。在您的 docx 文件中创建 MergeField 类型的字段。 [![在此处输入图像描述](../Images/dec891b09b0fb7c0e77e56e4988ecdb3.png)](https://i.stack.imgur.com/494lB.png)

**2) 使用名称Image:Krishna**创建 MergeFiled **[![在此处输入图像描述](../Images/36e0e8cbf2ed61353a4f8a95214148da.png)](https://i.stack.imgur.com/HLVvn.png)**

 **3)

```
using Syncfusion.DocIO.DLS;
using System.Drawing;

public class Source
{
    public Image Krishna { get; set; } = Image.FromFile(@"C:\1.png");
} 
```

并生成代码：

```
public static void Generate()
{
  WordDocument doc = new WordDocument("Template.docx");

  Source data = new Source();
  var dataTable = new MailMergeDataTable("", new Source[] { data });

  doc.MailMerge.ExecuteGroup(dataTable);

  doc.Save("result.docx");
  doc.Close();
} 
```**

# c++ - Starting point for learning CAD/CAE file formats?

> ID：1024323
> 
> 赞同：6
> 
> 时间：2009-06-21T17:02:07.860
> 
> 标签：c++, file-format, autocad, cad, solid-bodies

We are developing some stress and strain analysis software at university. Now it's time to move from rectangles and boxes and spheres to some real models. But I still have little idea where to start.

In our software we are going to build mesh and then make calculations, but how do I import solid bodies from CAD/CAE software?

1) **How CAD/CAE models are organised?** How solid bodies are represented? What are the possibilities of DWG, DXF, IGES, STEP formats? There is e.g. a complete DXF reference, but it's too difficult for me to understand without knowing basic concepts.

2) **Are there C++ libraries to import solid bodies from CAD/CAE file formats?** Won't it be too difficult to build a complete model to be able to import comprehensive file?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T17:10:33.123

To import solid bodies you first need to export them from the CAD system. Most CAD system datafiles are propriety (unless they've all moved over to XML in the few years I've been out of the industry!). DWG is Autodesk's file format and they don't (well didn't) encourage people to read it directly. They did offer a file reading/writing library if memory serves, but I don't know what the state of that is now. DXF, IGES and STEP are all data transfer formats.

DXF is owned by Autodesk but is published so other companies can use it to read and write models. The DXF reference is complicated, but is just a reference - you need to know the concepts before you can understand what it represents.

Solid models can be represented in a number of ways, either by Constructional Solid Geometry (CSG) where the shape is made up from the addition or subtraction of solid primitives from each other, or by Boundary Representation (B-Rep) where the edges are stored, or by triangulated faces (as used by 3D Studio MAX, WPF and many others) and so on. The particular format will depend on what the modeller is designed to do.

There are libraries and tools for reading the various file formats. I don't know which ones are still active as it's 5+ years since I was heavily involved in 3D graphics. You'd be better off searching for the current crop yourself. I'd recommend starting with Wikipedia - it will have some articles on 3D graphics and there should be plenty of links to further reading and tools/libraries.

Once you have a reader you'll need to convert the data to your internal format - not a trivial task. You might be better off adopting an existing format. One of my jobs was the reading of models from various sources into my company's data structure. My task was greatly helped by the fact that the modellers we supported came with API's that let us read the model meshes directly and from there it was a relatively straightforward (but never easy) task to convert their mesh into ours. There were always edge cases and nuances of the format that caused headaches. These were multiplied several times over if we had to read the file format ourselves - such as for DXF or VRML.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-20T17:55:27.657

当前 3D CAD 软件（CATIA、Pro/Engineer/Solidworks/NX）中最常见的实体模型表示方式是通过边界表示 (B-REP)。

但是，大多数导入此类 CAD 数据的库都是专有的。一些库直接来自几何建模器（例如带有 Interop、Parasolid 或 Granite 的 ACIS），其他库则来自专门从事 CAD 数据翻译市场的小型软件公司。

在开源方面，也许看看 OpenCascade 内核。这个内核（大部分）是开源的，它有一些 STEP 导入和网格划分功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T18:58:05.723

最好的办法是使用现有的开源 CAD 系统，例如[BRL-CAD](http://brlcad.org)，它包括对众多进口商和出口商的支持。

您认为学习给定格式将难以理解和实现支持的直觉是非常正确的，尤其是在处理用于分析目的的实体几何格式时。通过拓扑保证来保持实体性对于产生有效的分析很重要，但很少通过简单的网格格式来解决。

特别是对于两个流行的国际标准（IGES 和 STEP），它们过于复杂而难以支持，因为它们可以包含以多种方式编码的相同实体几何。考虑一个简单的球体示例。该球体可以编码为一个简单的点和半径（没有显式表面信息，这是 CSG 使用中常见的隐式形式），它可以是多边形网格（有损 BREP 刻面网格格式），它可以是样条曲面（BREP NURBS )，它可能是体积的（想想 CT 扫描数据）等等。专注于其中任何一项都涉及各种权衡（简单性、可靠性、分析保证、灵活性等）。

正如关于 BRL-CAD 所提到的，它是一个大型开源实体建模系统，在您可以利用的许多领域具有很多功能，大约十几个功能库和 400 多个简洁工具（大约两打是几何转换器）。即使它不能完全满足您的需求，您也拥有源代码，并且可以回馈改进并与现有社区协作以帮助实现您的需求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-18T19:40:48.963

重新阅读您的问题后，让我完全改变我的答案。如果您只需要网格，那么只需使用简单的基于网格的格式。

OBJ 很简单，很好，也很标准。从许多 CAD 格式转换为 OBJ 需要一个 tessellator/mesher，无论如何您都不想编写它，只需获得一个 CAD 包的座位来进行翻译。Moi 或 Rhino 成本低，支持多种格式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-18T19:56:32.473

我经常使用一款用于电磁仿真的商业软件，该软件使用 ACIS 建模内核和[Simmetrix](http://www.simmetrix.com/)的组件。虽然我无法亲自证明使用这些库的便利性，但它们似乎确实像宣传的那样工作，可以为您节省大量工作。它们可能不适用于学术用途，但它们似乎确实是为了满足您的需求而设计的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-20T10:59:54.833

据我所知，所有的 CAD/CAE 软件都支持 IGES、STEP 等文件格式的几何和想法，以及网格数据的 anysis 等。大多数时候，我们发现 iges 不包含拓扑信息。但作为 IGES 的继承者，STEP（产品交换标准）的开发始于 1984 年。最初的计划是“STEP 应基于一个单一的、完整的、独立于实施的产品信息模型，该模型应为主集成主题和应用信息模型的记录"。我们有一些库来读写这些文件格式。但是当我编写代码来读取和写入几何图形以及网格时，读取或写入这些文件格式并不困难，但很无聊。

# c# - 如何在 ADO.NET Entity Framework 中使用存储过程

> ID：1024331
> 
> 赞同：6
> 
> 时间：2009-06-21T17:05:55.797
> 
> 标签：c#, .net, linq, entity-framework

我有 3 张桌子；我在 ADO.NET Entity Framework 中编写了一个存储过程。

```
ALTER PROCEDURE [dbo].[sp_GetDepartmanData]
(@departman nvarchar(50))
BEGIN
  SELECT  
    d.ID, d.Name as DepartmanName,  
    sb.Salary, sb.email,
    sp.Name, sp.SurName, sp.Phone, sp.Married, sp.Address
  FROM         
    Departman d 
  INNER JOIN StaffsBusiness sb ON d.ID = sb.StaffsPersonelDepartmanID
  INNER JOIN StaffsPersonel sp ON sb.StaffsPersonelID = sp.ID 
  WHERE
    d.Name = @departman
END 
```

* * *

我需要一个我在下面写的存储过程函数：

```
var staffPersonel = staffContext.GetPersonelInformationWithDepartmanID("Yazılım");

gvPersonel.DataSource = staffPersonel;
gvPersonel.DataBind(); 
```

我从 SQL 编写的 GetPersonelInformationWithDepartmanID 函数（ADO.NET Entity Framework 中的用户定义函数）有 3 个替代方法（这很愚蠢！！！）但我有 3 个 joininig 表！！！。如果我之前加入了 3 张桌子，我该如何使用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-21T19:43:25.617

好的，您需要在这里执行几个步骤：

*   将您的存储过程添加`sp_GetDepartmanData`到您的实体框架模型中（顺便说一句 -**强烈**建议**不要**调用您的存储过程`sp_(something)`-`sp_`前缀的使用保留用于仅限 Microsoft 的系统存储过程）
*   由于您的存储过程正在返回一组数据，因此您需要先为其创建一个概念实体，然后才能使用您的存储过程；在实体设计器中，创建一个新实体并将其命名为一些有用的名称之类`DepartmentDataEntityType`的；将从存储过程返回的所有字段添加到该实体类型
*   现在，您可以在实体数据模型中创建函数导入 - 转到模型浏览器，在“model.store”部分转到您的存储过程，然后右键单击“创建函数导入”
*   您现在可以在对象上下文中为您的函数命名并定义它返回的内容 - 在这种情况下，选择您新创建的实体类型（例如`DepartmentDataEntityType`从上面）
*   你完成了！

您现在应该有一个函数导入，例如：

```
public global::System.Data.Objects.ObjectResult<DepartmentDataEntityType> GetPersonelInformationWithDepartmanID(global::System.String departmentName)
{
    global::System.Data.Objects.ObjectParameter departmentNameParameter;

    departmentNameParameter = new global::System.Data.Objects.ObjectParameter("departmentNameParameter", departmentName);

    return base.ExecuteFunction<DepartmentDataEntityType>("sp_GetDepartmanData", departmentNameParameter);
} 
```

现在可以调用对象上下文中的此函数以通过存储过程从数据库中检索数据。

马克

**编辑：**

如果您在执行此操作后遇到映射错误（“错误 3027：未为以下 EntitySet/AssociationSet 指定映射”），这是因为您创建的实体未映射到任何内容，并且仅在函数 import 填充集合时使用这些实体中。您要么需要以某种方式将此实体映射到数据存储，要么需要将其更改为复杂类型。

要创建复杂类型，只需打开 EF 设计器并右键单击空白区域。转到添加 > 复杂类型。您应该会在模型浏览器中看到一个新的复杂类型。右键单击它并添加标量属性，类似于您向实体添加属性的方式。然后删除您的实体并将您的复杂类型重命名为与实体相同。

这就是你所要做的:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-12T14:04:05.683

你如何创建这个“概念实体”？如果我创建一个未映射到的实体，则会收到以下错误：“实体类型 'foobar' 未映射到数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-16T01:55:08.903

这里[http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/cd71317f-407f-4038-9a30-17dd7f529aa3](http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/cd71317f-407f-4038-9a30-17dd7f529aa3)

在这里[http://www.danrigsby.com/blog/index.php/2009/05/20/entity-framework-40-scalar-and-void-functions/](http://www.danrigsby.com/blog/index.php/2009/05/20/entity-framework-40-scalar-and-void-functions/)

# entity-framework - How to get store type of an entity set

> ID：1024334
> 
> 赞同：3
> 
> 时间：2009-06-21T17:08:07.557
> 
> 标签：entity-framework, view, metadata

I'm trying to filter entities based on their store types (either table or view).

I have 2 entities in my test project, one's source is a table and the other's source is a view.

```
<EntitySet Name="Test" EntityType="TestModel.Store.Test" store:Type="Tables" Schema="dbo" />
<EntitySet Name="TestView" EntityType="TestModel.Store.TestView" store:Type="Views" store:Schema="dbo" store:Name="TestView"> 
```

The code sample above is taken from model's edmx file's **SSDL** section.

I think the **store:Type** information in SSDL is what i need but i couldn't find a way to retrieve that value using entity-framework api.

Any help will be appreciated.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T20:36:15.900

Well you can query the metadata in the SSDL by looking in the SSpace or the StoreItemCollection.

i.e.

```
var sspaceEntitySets = context.MetadataWorkspace
                       .GetItems<EntityContainer>(DataSpace.SSpace)
                       .First().BaseEntitySets.OfType<EntitySet>();
var entitySet = sspaceEntitySets.First();
var tableType = entitySet
.MetadataProperties["http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator:Type"]
.Value.ToString(); 
```

Unfortunately this isn't going to help you tie your classes to whether they come from a table or a view. Because the Entities (i.e. the ones you code against in CSpace) rather than the ones that describe the shapes of the table (i.e. SSpace ones) are in CSpace and in order to know whether an Entity comes from a view or table, you would need to be able to get from the CSpace EntitySet to SSpace EntitySet via the Mapping.

Unfortunately the EF doesn't expose public CSSPace (i.e. there is no way to use the API to read the MSL fragment of the EDMX).

So in order to do this you would have to manually reason over the MSL element, probably using LINQ to XML or something.

Hope this helps

Alex

# perl - Why can't Perl's Class::XSAccessor find Array.so?

> ID：1024335
> 
> 赞同：2
> 
> 时间：2009-06-21T17:09:00.270
> 
> 标签：perl

This is my first post and I am hoping someone can point me in the right direction. I have tried Google but am not coming up with anything; actually, there are hardly getting any hits so I assume this is going to be a pretty obscure error.

I am trying to run a perl application (squeezecenter-7.3.3) on Solaris 10 and get the following error:

> "ld.so.1: perl: fatal: relocation error: file /opt/squeezecenter-7.3.3/CPAN/arch/5.10.0/i86pc-solaris/auto/Class/XSAccessor/Array/Array.so: symbol get_next_arrayindex: referenced symbol not found"

ld.so.1 is in the search path, but I can't figure out what—ld.so.1 or Array.so—is causing the error. Any help will be appreciated.

Thanks

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T17:52:05.143

**最新更新 2009-12-04**

当前版本的 Class::XSAccessor 包含 Class::XSAccessor 本身和 Class::XSAccessor::Array。它不再使用 AutoXS.pm 来生成 AutoXS.h，而是提供一个静态副本。因此，引起该问题的问题不应（永远）再次发生。

* * *

虽然 Chris Simmons 的想法很好，但这肯定不是您遇到的问题。您正在使用的[Class::XSAccessor::Array版本与编译时使用的](http://search.cpan.org/dist/Class-XSAccessor-Array)[AutoXS::Header](http://search.cpan.org/dist/AutoXS-Header)版本之间很可能不兼容。

一个切实可行的*修复方法是从 CPAN 重新安装 Class::XSAccessor。它应该选择兼容版本的 AutoXS::Header。也许你也应该在 SlimDevices/Logitech 论坛上发帖讨论这个问题。

更笼统地说，作为两个模块的作者，我不确定*为什么*会出现这个问题。对 AutoXS::Header 1.02 版的依赖是最新的 Class::XSAccessor::Array 版本的一部分。因此，如果正确满足依赖关系，一切都应该没问题。SqueezeCenter 人员更新捆绑模块的方式可能有些特殊。如果没有，请随时让他们与我联系。

*剩下的一个问题可能是 SqueezeCenter 附带的 Class::XSAccessor::Array 比您从 CPAN 安装的那个（可能进入系统）更受欢迎。在这种情况下，您可以尝试将其安装到您的 /opt/squeezecenter.../CPAN 目录中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T18:00:44.957

重新安装有问题的模块。以 root 身份运行：

```
cpan -i Class::XSAccessor::Array Class::XSAccessor 
```

或者手动[安装](http://search.cpan.org/dist/Class-XSAccessor-Array/)。

# c++ - 这一行是否声明了一个函数？C++

> ID：1024341
> 
> 赞同：4
> 
> 时间：2009-06-21T17:12:41.090
> 
> 标签：c++, function-declaration

[我在这里](https://stackoverflow.com/questions/822059/sfinae-with-invalid-function-type-or-array-type-parameters)阅读了 litb 关于 SFINAE 的问题，我想知道他的代码到底在声明什么。下面是一个更简单（没有模板）的示例：

```
int (&a())[2]; 
```

那究竟是在宣布什么？&的作用是什么？为了增加我的困惑，如果我改为声明以下内容

```
int b()[2]; 
```

我收到一个关于声明返回数组的函数的错误，而第一行没有这样的错误（因此，人们会认为第一个声明**不是**函数）。但是，如果我尝试分配一个

```
a = a; 
```

我收到一条错误消息，说我正在尝试将函数分配给...所以现在它**是**一个函数。这究竟是什么东西？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-21T17:18:03.923

有这些很棒的程序叫做 cdecl 和 c++decl。它们对于找出复杂的声明非常有帮助，尤其是对于 C 和 C++ 用于函数指针的拜占庭形式。

```
tyler@kusari ~ $ c++decl
Type `help' or `?' for help
c++decl> explain int (&a())[2]
declare a as function returning reference to array 2 of int
c++decl> explain int b()[2]
declare b as function returning array 2 of int 
```

a 返回引用，b 不返回。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-21T17:26:56.097

为了将来参考，当您有一个特别难以破译的 C/C++ 声明时，您可能会发现此链接很有帮助：

[如何阅读 C 声明](http://www.antlr.org/wiki/display/CS652/How+To+Read+C+Declarations)

为了完整起见，我将重复其他人所说的直接回答您的问题。

```
int (&a())[2]; 
```

...声明*a*是一个零参数函数，它返回对大小为 2 的整数数组的引用。（阅读上面链接上的基本规则，以清楚地了解我是如何得出这个结论的。）

```
int b()[2]; 
```

...声明*b*是一个零参数函数，它返回一个大小为 2 的整数数组。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T17:20:18.540

```
int (&a())[2]; 
```

它声明了一个符号，该符号`a`是一个不带参数的函数，并返回对二元素整数数组的引用。

```
 int b()[2]; 
```

这声明了一个符号，该符号`b`是一个不带参数并返回整数的二元素数组的函数......这在语言的设计中是不可能的。

它相对简单：获取运算符优先级图表，启动符号名称 ( `a`) 并开始应用您从优先级中看到的运算符。在应用每个操作后记下。

# sql - Sub Query Help

> ID：1024350
> 
> 赞同：1
> 
> 时间：2009-06-21T17:21:18.133
> 
> 标签：sql

Hi I have the below query which i want to det the distinct districts and how sum of how many properties are for each one but i cant remember how to do the sub query!!!

Can any one help please

```
SELECT DISTRICT, PROPREF

FROM TBL_PROPERTY 

WHERE  (CONTRACT = 'ma2') AND 
        (LASTSERVICEDATE <= DATEADD(HH,23,CONVERT(DATETIME,'30/05/2009', 103))) AND 
        (SERVICESTATUS = 'SERVICED')) AS Sub1

GROUP BY DISTRICT, OFFICE, PROPREF 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T17:24:27.410

I think you want this:

```
select DISTRICT, count(PROPREF)
from TBL_PROPERTY
where CONTRACT = 'ma2'
    and LASTSERVICEDATE <= DATEADD(HH,23,CONVERT(DATETIME,'30/05/2009', 103))
    and SERVICESTATUS = 'SERVICED'
group by DISTRICT 
```

If you also wanted it broken out by office, you'd add OFFICE to the select and group by clauses.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T17:25:54.693

```
SELECT COUNT(*) AS PROPERTY_COUNT ... 
```

Is that what you're looking for?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T17:26:21.027

just figured it out sorry if anyone responded!! Also forgot to take office out i think which i got rid of in end.

```
SELECT DISTINCT(DISTRICT), SUM(services) AS TOTALSERVICES

FROM 

(SELECT DISTRICT, COUNT(PROPREF) AS Services

FROM TBL_PROPERTY 

WHERE  (CONTRACT = 'ma2') AND 
        (LASTSERVICEDATE <= DATEADD(HH,23,CONVERT(DATETIME,'30/05/2009', 103))) AND 
        (SERVICESTATUS = 'SERVICED')
GROUP BY DISTRICT, propref

) as sub1

GROUP BY DISTRICT, services 
```

# c++ - 混合 C 和 C++ 文件操作

> ID：1024351
> 
> 赞同：1
> 
> 时间：2009-06-21T17:21:25.543
> 
> 标签：c++, c

我正在编写一个文件拆分程序，以帮助将大文件与 iPod 笔记一起使用。我想在 cstdio 中使用 tmpfile() 但它返回一个文件*而不是一个 fstream 对象。我知道这在标准 C++ 中是不可能的，但有谁知道任何与标准配合良好的库，它们能够将 FILE* 转换为 std::fstream 对象？或者，如果没有，标准或其他库中是否提供 tmpfile() 功能？

谢谢！

我的操作系统是 Windows XP，我使用 Dev-C++ 4.9.9.2 或 MS Visual Studio 2008 作为我的编译器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T18:31:27.590

您可以通过 << 语法将数据泵入 std::stringstream 并稍后将您通过 C-API 从中获得的 .str().c_str() 写入 FILE* 来使用 c++ 流的好处.

```
#include <sstream>
#include <cstdio>
#include <字符串>

使用命名空间标准；

主函数（）
{
  串流 ss；
  ss << "日志开始" << endl;

  // ... 更多日志

  文件* f_log = fopen("bar.log", "w");
  字符串 logStr = ss.str();
  fwrite(logStr.c_str(), sizeof(char), logStr.size(), f_log);
  fclose(f_log);

  返回0；
}

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T18:41:13.440

如果您想要的只是一个临时文件，请改用[tmpnam()](http://cplusplus.com/reference/clibrary/cstdio/tmpnam/)。这将返回可用于临时文件的 char* 名称，因此只需打开具有该名称的 fstream 对象。

就像是：

```
#include <cstdio>
#include <fstream>

...
char name[L_tmpnam];
tmpnam(name);

//also could be:
//char *name;
//name = tmpnam(NULL);

std::fstream file(name); 
```

但是，您必须自己删除文件，使用[remove()](http://cplusplus.com/reference/clibrary/cstdio/remove/)或其他方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T17:27:57.547

您可以使用~~[tmpnam](http://www.cplusplus.com/reference/clibrary/cstdio/tmpnam/)~~ [mktmp](http://publib.boulder.ibm.com/infocenter/zos/v1r10/index.jsp?topic=/com.ibm.zos.r10.bpxbd00/rmktmp.htm)获取临时文件名，使用流打开它，然后使用 remove 将其[删除](http://www.cplusplus.com/reference/clibrary/cstdio/remove/)。

```
char *name;
ifstream stream;

name = mktmp("filename");
stream.open(name);
//do stuff with stream here.

remove(name);//delete file. 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T17:28:32.960

即使您设法将 FILE* 转换为 std::fstream，也不会像宣传的那样工作。tmpfile() 返回的 FILE 对象有一个特殊的属性，当 close()'d（或程序终止时）时，文件会自动从文件系统中删除。我不知道如何使用 std::fstream 复制相同的行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T18:15:18.240

您可以围绕 FILE* 编写一个简单的包装类，而不是使用 std::fstream，它会在销毁时将其关闭。应该很容易。根据需要定义 << 等运算符。确保禁止复制，以避免多次 close() 调用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-21T19:01:52.487

g++ 有`__gnu_cxx::stdio_filebuf`和`__gnu_cxx::stdio_sync_filebuf`，在`ext/stdio_filebuf.h`和中`ext/stdio_sync_filebuf.h`。如果您的编译器不是 g++，那么从 libstdc++ 中提取它们应该很简单。

# c++ - 使用 goto 是打破两个循环的合法方式吗？

> ID：1024361
> 
> 赞同：20
> 
> 时间：2009-06-21T17:25:56.130
> 
> 标签：c++, goto

我正在解决[Project Euler](http://projecteuler.net/)的问题 9 。在我的解决方案中，我使用“goto”语句来打破两个 for 循环。问题如下：

> 毕达哥拉斯三元组是三个自然数 abc 的集合，其中，
> 
> a^2 + b^2 = c^2
> 
> 例如，3^2 + 4^2 = 9 + 16 = 25 = 52。
> 
> 恰好存在一个毕达哥拉斯三元组，其 a + b + c = 1000。求积 abc。

我的解决方案是在 C++ 中：

```
int a,b,c;
const int sum = 1000;
int result = -1;
for (a = 1; a<sum; a++){
    for (b = 1; b < sum; b++){
            c = sum-a-b;
            if (a*a+b*b == c*c){
                result = a*b*c;
                goto found;
            }
    }   
}
found:
std::cout << "a:" << a << std::endl;
std::cout << "b:" << b << std::endl;
std::cout << "c:" << c << std::endl;
std::cout <<"Result:" << result << std::endl; 
```

由于“goto”语句在 c++ 程序员中不是很流行，我想知道这是否可以被认为是“goto”的合理使用。或者，对于不需要“goto”的问题，是否有更好的解决方案。我的意思不是一个解决方案，它只是避免“goto”，而是以改进算法的方式避免“goto”。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-06-21T17:45:37.290

`return``goto`是许多程序员认为更容易接受的“结构化” ！所以：

```
static int findit(int sum, int* pa, int* pb, int* pc)
{
    for (int a = 1; a<sum; a++) {
        for (int b = 1; b < sum; b++) {
            int c = sum-a-b;
            if (a*a+b*b == c*c) {
                *pa = a; *pb = b; *pc = c;
                return a*b*c;
        }
    }
    return -1;    
}

int main() {
    int a, b, c;
    const int sum = 1000;
    int result = findit(sum, &a, &b, &c);
    if (result == -1) {
        std::cout << "No result!" << std::endl;
        return 1;
    }
    std::cout << "a:" << a << std::endl;
    std::cout << "b:" << b << std::endl;
    std::cout << "c:" << c << std::endl;
    std::cout <<"Result:" << result << std::endl;
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-06-21T20:05:19.257

在我看来，`goto`在这种情况下使用它很好。

顺便说一句，对 goto 的居高临下的说教通常来自那些只是模仿他们听到别人说或在某处读到的东西的人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-21T17:45:36.057

请参阅[有关](https://stackoverflow.com/questions/982595/how-to-break-out-of-2-loops-without-a-flag-variable-in-c)打破 2 个循环的问题。提供了比使用 goto 更好的答案。

提供的最佳答案是将您的第二个循环放入一个函数中，并从您的第一个循环内调用该函数。

从 mquander 的响应中复制的代码

```
public bool CheckWhatever(int whateverIndex)
{
    for(int j = 0; j < height; j++)
    {
        if(whatever[whateverIndex][j]) return false;
    }

    return true;
}

public void DoubleLoop()
{
    for(int i = 0; i < width; i++)
    {
        if(!CheckWhatever(i)) break;
    }
} 
```

虽然我确实觉得在这种情况下使用 goto 并不像杀死小猫那么糟糕。但它很接近。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-21T17:30:09.510

我想不出更好的选择。但是一个不使用的替代方法`goto`是修改第一个`for`循环：

```
for (a = 1; a<sum && result == -1; a++){ 
```

然后`break`退出第二个`for`循环。假设结果永远不会`-1`在第二个`for`循环被`break`.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-21T17:32:40.207

您可以在顶部声明 a `bool found = false`，然后添加`&& !found`到您的 for 循环条件（在`a < sum`and之后`b < sum`），然后在当前 goto 所在的位置将 found 设置为 true。然后使您的输出以发现为真为条件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-12-24T13:41:06.600

```
int a,b,c,sum = 1000;
for (a = 1; a<sum; ++a)
 for (b = 1; b<sum; ++b){
  c = sum-a-b;
  if (a*a+b*b == c*c) sum = -a*b*c;
 }
printf("a: %d\n",a-1);
printf("b: %d\n",b-1);
printf("c: %d\n",c);
printf("Result: %d\n",-sum); 
```

还优化了结果..：P

反正我喜欢gotos！

# php - 在 PHP 5.x 中使用 fsockopen 循环 Fget

> ID：1024370
> 
> 赞同：3
> 
> 时间：2009-06-21T17:31:28.277
> 
> 标签：php, python, sockets, tcp, fgets

我有一个 Python 服务器终于可以工作并使用输出响应多个命令，但是我现在遇到了 PHP 接收完整输出的问题。我尝试过 fgets、fread 等命令，似乎唯一有效的命令是“fgets”。

然而，这仅接收在线数据，然后我创建了如下所示的 while 语句：

```
 while (!feof($handle)) {
    $buffer = fgets($handle, 4096);
    echo $buffer;
} 
```

但是，Python 服务器似乎没有在输出末尾发送 Feof，因此 php 页面超时并且不显示任何内容。就像我上面说的，只运行 echo fgets($handle)，工作正常，输出一行，再次运行命令都不会显示下一行等

我在下面附上了我的 Python 脚本的重要部分：

```
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(("", port))
s.listen(5)
print "OK."
print "  Listening on port:", port
import subprocess
while 1:
    con, addr = s.accept()
    while True:
        datagram = con.recv(1024)
        if not datagram:
            break
        print "Rx Cmd:", datagram
        print "Launch:", datagram
        process = subprocess.Popen(datagram+" &", shell=True, stdout=subprocess.PIPE)
        stdout, stderr = process.communicate()
        con.send(stdout)
    con.close()
s.close() 
```

我还附上了完整的 PHP 脚本：

```
<?php
$handle = fsockopen("tcp://xxx.xxx.xxx.xxx",12345);
fwrite($handle,"ls");
echo fgets($handle);
fclose($handle);
?> 
```

谢谢，阿什利

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T18:19:09.373

我相信您需要稍微修复一下服务器代码。我已经删除了内部 while 循环。您的代码的问题是服务器从未关闭连接，因此`feof`从未返回 true。

我也删除了`+ " &"`位。要获得输出，您需要等到过程结束。而且我不确定`&`在这种情况下外壳将如何处理。

```
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(("", port))
s.listen(5)
print "OK."
print "  Listening on port:", port
import subprocess
try:
    while 1:
        con, addr = s.accept()
        try:
            datagram = con.recv(1024)
            if not datagram:
                continue
            print "Rx Cmd:", datagram
            print "Launch:", datagram
            process = subprocess.Popen(datagram, shell=True, stdout=subprocess.PIPE)
            stdout, stderr = process.communicate()
            con.send(stdout)
        finally:
            print "closing connection"
            con.close()
except KeyboardInterrupt:
    pass
finally:
    print "closing socket"
    s.close() 
```

顺便说一句，您需要在 php 脚本中使用 while 循环。`fgets`只返回一行。

# perl - How can I make C-p an Emacs prefix key for Devel::PerlySense?

> ID：1024374
> 
> 赞同：12
> 
> 时间：2009-06-21T17:33:58.833
> 
> 标签：perl, emacs

I just installed [Devel::PerlySense](http://search.cpan.org/dist/Devel-PerlySense) 0.0180.

I have put the following in my .emacs file:

```
 ; PerlySense
 (load "~/perly-sense")

 (global-unset-key "\C-p")

 (global-set-key (kbd "\C-p \C-d") 'perly-sense-smart-docs-at-point)

 (global-set-key (kbd "\C-p \C-g") 'perly-sense-smart-go-to-at-point) 
```

But, now whenever I try to load a Perl file in emacs, I get the following error prior to it getting loaded:

> error "Key sequence C-p m f starts with non-prefix key C-p"

How can I fixed this? I'm new to emacs, so would really appreciate any help in this regard.

### Update:

The [link submitted by ysth](http://www.gnu.org/software/emacs/elisp/html_node/Prefix-Keys.html) suggests, doing the following :

```
 (use-local-map (make-sparse-keymap))
     => nil
 (local-set-key "\C-p" ctl-x-map)
     => nil
 (key-binding "\C-p\C-f")
     => find-file

 (key-binding "\C-p6")
     => nil 
```

Now, do i need to add this to my .emacs file to create the keymap?

When i add the above code to .emacs and start emacs the error i get is :

**void-variable =>**

What can be the problem here ?

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-06-22T02:03:07.863

你的问题的明确答案是这样的：

```
(define-prefix-command 'perly-sense-map)
(global-set-key (kbd "C-p") 'perly-sense-map)
(define-key perly-sense-map (kbd "C-d") 'perly-sense-smart-docs-at-point)
(define-key perly-sense-map (kbd "C-g") 'perly-sense-smart-go-to-at-point) 
```

有关正在执行的操作的更多信息，请查看文档

*   [`define-prefix-command`](http://www.gnu.org/software/emacs/manual/html_node/elisp/Prefix-Keys.html)
*   [`keymaps`](http://www.gnu.org/software/emacs/elisp/html_node/Keymaps.html#Keymaps)
*   [`kbd`](http://www.gnu.org/software/emacs/manual/html_node/elisp/Key-Sequences.html#index-kbd-1380)

在原始帖子中，您混合了使用`kbd`和旧的“\Cp”符号。您可以阅读[这篇讨论键绑定的大型教程](http://www.nongnu.org/emacs-tiny-tools/keybindings/)，其中包含大量信息（超出您可能需要的信息）。我发现这种用法是最简单的，您只需将您在对键 ( )`kbd`进行帮助时看到的字符串传递给它。`C-h k`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-21T18:11:56.657

默认情况下，Emacs 只允许某些键作为前缀（多键命令的开头）。请参阅[http://www.gnu.org/software/emacs/manual/html_node/elisp/Prefix-Keys.html](http://www.gnu.org/software/emacs/manual/html_node/elisp/Prefix-Keys.html) 您需要创建一个键盘映射并将其绑定到 Cp。

# fluent-nhibernate - The type initializer for 'NHibernate.Cfg.Configuration' threw an exception

> ID：1024375
> 
> 赞同：4
> 
> 时间：2009-06-21T17:34:20.237
> 
> 标签：fluent-nhibernate

I am using FluentNHibernate and during the configuration phase I am getting the following error:

Here is the configuration:

public static ISessionFactory CreateSessionFactory() { return Fluently.Configure().Database( MsSqlConfiguration.MsSql2000.ConnectionString( c => c.FromConnectionStringWithKey("HighOnCodingConnectionString"))) .Mappings(m =>
m.FluentMappings.AddFromAssemblyOf()) .BuildSessionFactory(); }

And here is the error:

[failure] when_instantiating_a_session_factory.should_be_able_to_create_a_session_factory TestCase 'when_instantiating_a_session_factory.should_be_able_to_create_a_session_factory' failed: The type initializer for 'NHibernate.Cfg.Configuration' threw an exception. System.TypeInitializationException Message: The type initializer for 'NHibernate.Cfg.Configuration' threw an exception. Source: NHibernate StackTrace: at NHibernate.Cfg.Configuration..ctor() c:\FluentNHibernate\src\FluentNHibernate\Cfg\FluentConfiguration.cs(25,0): at FluentNHibernate.Cfg.FluentConfiguration..ctor() c:\FluentNHibernate\src\FluentNHibernate\Cfg\Fluently.cs(16,0): at FluentNHibernate.Cfg.Fluently.Configure() C:\Projects\highoncodingmvc\src\highoncoding\src\HighOnCoding.BusinessObjects\Factories\SessionFactory.cs(17,0): at HighOnCoding.BusinessObjects.Factories.SessionFactory.CreateSessionFactory() C:\Projects\highoncodingmvc\src\highoncoding\src\HighOnCoding.TestSuite\Configuration\TestFluentNHiberate.cs(17,0): at HighOnCoding.TestSuite.Configuration.when_instantiating_a_session_factory.should_be_able_to_create_a_session_factory() Inner Exception System.IO.FileLoadException Message: The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040) Source: NHibernate StackTrace: at NHibernate.Cfg.Configuration..cctor()

Here is the log information from FusionLog thing:

*** Assembly Binder Log Entry (6/21/2009 @ 12:49:38 PM) ***

The operation failed. Bind result: hr = 0x80070002\. The system cannot find the file specified.

Assembly manager loaded from: c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorwks.dll Running under executable C:\Projects\highoncodingmvc\src\highoncoding\src\HighOnCodingConsole\bin\Debug\HighOnCodingConsole.exe --- A detailed error log follows.

=== Pre-bind state information === LOG: User = D9SKQBG1\AzamSharp LOG: DisplayName = NHibernate.XmlSerializers, Version=2.0.1.4000, Culture=neutral, PublicKeyToken=aa95f207798dfdb4, processorArchitecture=MSIL (Fully-specified) LOG: Appbase = file:///C:/Projects/highoncodingmvc/src/highoncoding/src/HighOnCodingConsole/bin/Debug/ LOG: Initial PrivatePath = NULL LOG: Dynamic Base = NULL LOG: Cache Base = NULL LOG: AppName = NULL

# Calling assembly : System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089.

LOG: This bind starts in default load context. LOG: Using application configuration file: C:\Projects\highoncodingmvc\src\highoncoding\src\HighOnCodingConsole\bin\Debug\HighOnCodingConsole.exe.Config LOG: Using machine configuration file from c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\config\machine.config. LOG: Post-policy reference: NHibernate.XmlSerializers, Version=2.0.1.4000, Culture=neutral, PublicKeyToken=aa95f207798dfdb4, processorArchitecture=MSIL LOG: GAC Lookup was unsuccessful. LOG: Attempting download of new URL file:///C:/Projects/highoncodingmvc/src/highoncoding/src/HighOnCodingConsole/bin/Debug/NHibernate.XmlSerializers.DLL. LOG: Attempting download of new URL file:///C:/Projects/highoncodingmvc/src/highoncoding/src/HighOnCodingConsole/bin/Debug/NHibernate.XmlSerializers/NHibernate.XmlSerializers.DLL. LOG: Attempting download of new URL file:///C:/Projects/highoncodingmvc/src/highoncoding/src/HighOnCodingConsole/bin/Debug/NHibernate.XmlSerializers.EXE. LOG: Attempting download of new URL file:///C:/Projects/highoncodingmvc/src/highoncoding/src/HighOnCodingConsole/bin/Debug/NHibernate.XmlSerializers/NHibernate.XmlSerializers.EXE. LOG: All probing URLs attempted and failed.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T17:37:15.413

Looks like you've compiled against one version of an assembly, but at execution time it's finding another and complaining. I suggest you [turn on Fusion logging](http://blogs.msdn.com/suzcook/archive/2003/05/29/57120.aspx) to work out what's going on - in particular, the exact assembly which is causing problems!

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-18T19:19:44.670

我知道这早就解决了，但是今天我自己也遇到了这个问题，我发现这是我个人的解决方案，并认为我会分享知识：

[https://forum.hibernate.org/viewtopic.php?p=2399679](https://forum.hibernate.org/viewtopic.php?p=2399679)

从帖子：

*“我在 Visual Studio 中的调试器设置为中断所有异常，调整异常设置解决了我的问题。”*

也引导我：

[http://www.codewrecks.com/blog/index.php/2008/02/13/sgenexe-and-strongly-named-assemblies/](http://www.codewrecks.com/blog/index.php/2008/02/13/sgenexe-and-strongly-named-assemblies/)

*“经过一番搜索，我发现 xxxx.XmlSerializers 程序集是 xmlserializers 在运行时尝试生成之前寻找的预生成程序集......”*

# c# - VS 图像库 .png 文件

> ID：1024384
> 
> 赞同：0
> 
> 时间：2009-06-21T17:40:13.927
> 
> 标签：c#, visual-studio, png, icons

Microsoft 使用 Visual Studio 部署免费的图像库。

在以下位置，您可以找到包含多个图标的 .png 文件。

c:\Program Files\Microsoft Visual Studio 9.0\Common7\VS2008ImageLibrary\1033\VS2008ImageLibrary_Common Elements\Actions\

有没有办法以编程方式从文件中访问特定图标，或者我必须在某些照片工具中编辑这些文件并分别保存每个图标？

* * *

## 编辑：

*   .png 文件中的逻辑图标不超过一个（.ico 文件可以有）
*   VS Image 库附带的 .png 图标不遵循任何类型的模式，因此代码无法轻松使用它们（mipmapping）。它们必须在某些图形工具中进行编辑，然后保存到单独的文件中

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T18:19:39.450

图标文件（可以）在其中包含多个图像，但您不需要提取它们。
这个想法是在运行时最好的图标被切断（如3d 中的[mipmaping](http://en.wikipedia.org/wiki/Mipmap)）。
如果您使用[Graphics.DrawIcon(Icon, Rectangle)，](http://msdn.microsoft.com/en-us/library/d6s01xzx.aspx)那么将为您选择最佳图标。

或者您可以使用带有[图标插件的](http://www.autohotkey.com/forum/topic24591.html)[Paint.NET](http://www.getpaint.net/)来提取确切的大小。

# css - CSS 无法正确对齐选项卡式菜单

> ID：1024388
> 
> 赞同：1
> 
> 时间：2009-06-21T17:41:13.787
> 
> 标签：css

你能帮我在IE7中修复我的菜单吗？

代码是：

```
<ul id="layer1">
<li     id="current" >
  <span><a href="/">Главная</a></span>
</li>

#menu {
margin-left:150px;
}
#menu ul#layer1 {
list-style-image:none;
list-style-position:outside;
list-style-type:none;
margin:0 auto;
padding:0;
}
#menu ul#layer1 li {
background:transparent url(/site_media/images/left.png) no-repeat scroll left top;
float:left;
margin-left:6px;
padding-bottom:6px;
padding-left:6px;
padding-top:4px;
}
#menu ul#layer1 li span {
background:transparent url(/site_media/images/right.jpg) no-repeat scroll right top;
margin-right:6px;
padding-bottom:6px;
padding-right:6px;
padding-top:4px;
}
#menu li a {
background-color:#BF1E2D;
color:#FFFFFF;
padding:4px 35px 6px;
text-decoration:none;
}
#menu ul#layer1 li#current span {
background:transparent url(/site_media/images/right-gray.png) no-repeat scroll right top;
}
#menu ul#layer1 li#current {
background:transparent url(/site_media/images/left-gray.png) no-repeat scroll left top;
}
#menu ul#layer1 li#current a {
background-color:#E3E3E3;
color:#BF1E2D;
} 
```

您也可以在此处查看该站点[http://j-in.org.ua:9000](http://j-in.org.ua:9000)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T19:17:08.807

从 li 中删除顶部和底部填充并将跨度向左浮动：

```
#menu ul#layer1 li{
    background: url(left.png) left top no-repeat; 
    margin-left:6px;
    padding-left: 6px;
    float: left;
}

#menu ul#layer1 li span{
    background: url(right.jpg) right top no-repeat;
    padding-right:6px;
    margin-right: 6px;
    padding-top: 4px;
    padding-bottom: 6px;
    float:left;
} 
```

# c - 使用 C 以二进制表示形式打印 int

> ID：1024389
> 
> 赞同：23
> 
> 时间：2009-06-21T17:42:05.297
> 
> 标签：c, binary, integer

我正在寻找一个函数来允许我打印一个 int 的二进制表示。到目前为止我所拥有的是；

```
char *int2bin(int a)
{
 char *str,*tmp;
 int cnt = 31;
 str = (char *) malloc(33); /*32 + 1 , because its a 32 bit bin number*/
 tmp = str;
 while ( cnt > -1 ){
      str[cnt]= '0';
      cnt --;
 }
 cnt = 31;
 while (a > 0){
       if (a%2==1){
           str[cnt] = '1';
        }
      cnt--;
        a = a/2 ;
 }
 return tmp;

} 
```

但是当我打电话

```
printf("a %s",int2bin(aMask)) // aMask = 0xFF000000 
```

我得到像这样的输出；

> 0000000000000000000000000000000000xtpYy（还有一堆未知字符。

它是函数中的缺陷还是我打印字符数组的地址或其他什么？抱歉，我只是看不出哪里出错了。

注意代码来自[这里](http://en.allexperts.com/q/C-1587/printing-binary.htm)

编辑：这不是家庭作业仅供参考，我正在尝试用不熟悉的语言调试其他人的图像处理例程。但是，如果它被标记为作业，因为它是一个基本概念，那么公平竞争。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-06-21T17:55:42.440

这是另一个更优化的选项，您可以在分配的缓冲区中传递。确保它的尺寸正确。

```
// buffer must have length >= sizeof(int) + 1
// Write to the buffer backwards so that the binary representation
// is in the correct order i.e.  the LSB is on the far right
// instead of the far left of the printed string
char *int2bin(int a, char *buffer, int buf_size) {
    buffer += (buf_size - 1);

    for (int i = 31; i >= 0; i--) {
        *buffer-- = (a & 1) + '0';

        a >>= 1;
    }

    return buffer;
}

#define BUF_SIZE 33

int main() {
    char buffer[BUF_SIZE];
    buffer[BUF_SIZE - 1] = '\0';

    int2bin(0xFF000000, buffer, BUF_SIZE - 1);

    printf("a = %s", buffer);
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-21T18:14:08.400

几点建议：

*   **空终止你的字符串**
*   不要使用幻数
*   检查返回值`malloc()`
*   不要转换的返回值`malloc()`
*   使用二进制运算而不是算术运算，因为您对二进制表示感兴趣
*   不需要循环两次

这是代码：

```
#include <stdlib.h>
#include <limits.h>

char * int2bin(int i)
{
    size_t bits = sizeof(int) * CHAR_BIT;

    char * str = malloc(bits + 1);
    if(!str) return NULL;
    str[bits] = 0;

    // type punning because signed shift is implementation-defined
    unsigned u = *(unsigned *)&i;
    for(; bits--; u >>= 1)
        str[bits] = u & 1 ? '1' : '0';

    return str;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-21T17:45:40.020

您的字符串不是以空值结尾的。确保`'\0'`在字符串末尾添加一个字符；`calloc`或者，您可以使用而不是分配它`malloc`，这会将返回给您的内存归零。

顺便说一句，这段代码还有其他问题：

*   使用时，它会在您调用它时分配内存，让调用者负责`free()`分配的字符串。如果你只是在通话中调用它，你会泄漏内存`printf`。
*   它对数字进行两次传递，这是不必要的。您可以在一个循环中完成所有操作。

这是您可以使用的替代实现。

```
#include <stdlib.h>
#include <limits.h>

char *int2bin(unsigned n, char *buf)
{
    #define BITS (sizeof(n) * CHAR_BIT)

    static char static_buf[BITS + 1];
    int i;

    if (buf == NULL)
        buf = static_buf;

    for (i = BITS - 1; i >= 0; --i) {
        buf[i] = (n & 1) ? '1' : '0';
        n >>= 1;
    }

    buf[BITS] = '\0';
    return buf;

    #undef BITS
} 
```

用法：

```
printf("%s\n", int2bin(0xFF00000000, NULL)); 
```

第二个参数是指向要存储结果字符串的缓冲区的指针。如果您没有缓冲区，则可以传递`NULL`并将`int2bin`写入`static`缓冲区并将其返回给您。与原始实现相比，它的优点是调用者不必担心`free()`返回的字符串。

缺点是只有一个静态缓冲区，因此后续调用将覆盖先前调用的结果。您无法保存多次调用的结果以供以后使用。此外，它不是线程安全的，这意味着如果您以这种方式从不同的线程调用该函数，它们可能会破坏彼此的字符串。如果有可能，您需要传入自己的缓冲区而不是传递`NULL`，如下所示：

```
char str[33];
int2bin(0xDEADBEEF, str);
puts(str); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-03-09T18:29:24.197

这是我的解决方案。*它创建一个掩码，从最左边的所有 0 和一个 1 开始，并为假定*的32 位整数中的每个位在逻辑上将其右移。通过将当前屏蔽的整数的值转换为布尔值来顺序打印这些位。

```
void printBits(int val){
    for(unsigned int mask = 0x80000000; mask; mask >>= 1){
         printf("%d", !!(mask & val));
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-05-14T23:31:30.377

这是一个简单的算法。

```
void decimalToBinary (int num) {

        //Initialize mask
        unsigned int mask = 0x80000000;
        size_t bits = sizeof(num) * CHAR_BIT;

        for (int count = 0 ;count < bits; count++) {

            //print
            (mask & num ) ? cout <<"1" : cout <<"0";

            //shift one to the right
            mask = mask >> 1;
        }
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-01-12T15:25:54.523

这就是我将整数显示为二进制代码的方法，它每 4 位分隔：

```
int getal = 32;             /** To determain the value of a bit 2^i , intergers are 32bits long**/
int binairy[getal];         /** A interger array to put the bits in **/
int i;                      /** Used in the for loop **/
for(i = 0; i < 32; i++)
{
    binairy[i] = (integer >> (getal - i) - 1) & 1;
}

int a , counter = 0;
for(a = 0;a<32;a++)
{
    if (counter == 4)
    {
        counter = 0;
        printf(" ");
    }
   printf("%i", binairy[a]);
   teller++;
} 
```

它可能有点大，但我总是以一种（我希望）每个人都能理解发生了什么的方式来写它。希望这有帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-01-30T03:39:57.307

```
#include<stdio.h>
//#include<conio.h>  // use this if you are running your code in visual c++,      linux don't 
                     // have this library. i have used it for getch() to hold the screen for input char.

void showbits(int);
int main()
{
    int no;
    printf("\nEnter number to convert in binary\n");
    scanf("%d",&no);
    showbits(no);
//  getch();        // used to hold screen... 
                    // keep code as it is if using gcc. if using windows uncomment #include & getch()
    return 0;   

}
void showbits(int n)
{
    int i,k,andmask;

    for(i=15;i>=0;i--)
    {
        andmask = 1 << i;
        k = n & andmask;

        k == 0 ? printf("0") : printf("1");
    }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-21T17:48:07.303

有几件事：

```
int f = 32;
int i = 1;
do{
  str[--f] = i^a?'1':'0';
}while(i<<1); 
```

*   它高度依赖于平台，但也许上面的这个想法能让你开始。
*   为什么不使用 memset(str, 0, 33) 将整个 char 数组设置为 0？
*   不要忘记释放（）！！！函数调用后的 char* 数组！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-21T17:49:25.943

两件事情：

1.  你把 NUL 字符放在哪里？我看不到设置的地方`'\0'`。
2.  Int 已签名，0xFF000000 将被解释为负值。所以`while (a > 0)`马上就会是假的。

旁白：里面的 malloc 函数很丑。为 int2bin 提供一个缓冲区怎么样？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-21T17:57:37.193

[此处](http://snippets.dzone.com/posts/show/4716)编码的两个简单版本（经过轻微重新格式化后复制）。

```
#include <stdio.h>

/* Print n as a binary number */
void printbitssimple(int n) 
{
    unsigned int i;
    i = 1<<(sizeof(n) * 8 - 1);

    while (i > 0) 
    {
        if (n & i)
            printf("1");
        else
            printf("0");
        i >>= 1;
    }
}

/* Print n as a binary number */
void printbits(int n) 
{
    unsigned int i, step;

    if (0 == n)  /* For simplicity's sake, I treat 0 as a special case*/
    {
        printf("0000");
        return;
    }

    i = 1<<(sizeof(n) * 8 - 1);

    step = -1; /* Only print the relevant digits */
    step >>= 4; /* In groups of 4 */
    while (step >= n) 
    {
        i >>= 4;
        step >>= 4;
    }

    /* At this point, i is the smallest power of two larger or equal to n */
    while (i > 0) 
    {
        if (n & i)
            printf("1");
        else
            printf("0");
        i >>= 1;
    }
}

int main(int argc, char *argv[]) 
{
    int i;
    for (i = 0; i < 32; ++i) 
    {
        printf("%d = ", i);
        //printbitssimple(i);
        printbits(i);
        printf("\n");
    }

    return 0;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-12-04T12:54:28.350

```
#include <stdio.h>
int main(void) {

    int a,i,k=1;
    int arr[32]; \\ taken an array of size 32

    for(i=0;i <32;i++) 
    {
        arr[i] = 0;   \\initialised array elements to zero
    }

    printf("enter a number\n");
    scanf("%d",&a);  \\get input from the user

    for(i = 0;i < 32 ;i++)
    {
        if(a&k)    \\bit wise and operation
        {
            arr[i]=1;
        }
        else
        {
            arr[i]=0;
        }
        k = k<<1; \\left shift by one place evry time
    }
    for(i = 31 ;i >= 0;i--)
    {
        printf("%d",arr[i]);   \\print the array in reverse
    }

    return 0;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-01-08T14:18:46.563

//当老师要求我们这样做时，我就是这样做的

```
int main (int argc, char *argv[]) {

    int number, i, size, mask; // our input,the counter,sizeofint,out mask

    size = sizeof(int);
    mask = 1<<(size*8-1);
    printf("Enter integer: ");
    scanf("%d", &number);
    printf("Integer is :\t%d 0x%X\n", number, number);
    printf("Bin format :\t");
    for(i=0 ; i<size*8 ;++i ) {
        if ((i % 4 == 0) && (i != 0))  {
            printf(" ");
        }

        printf("%u",number&mask ? 1 : 0);

        number = number<<1;
    }
    printf("\n");

    return (0);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-12-01T13:23:19.423

对我来说最简单的方法（对于 8 位表示）：

```
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

char *intToBinary(int z, int bit_length){

    int div;
    int counter = 0;
    int counter_length = (int)pow(2, bit_length);

    char *bin_str = calloc(bit_length, sizeof(char));

    for (int i=counter_length; i > 1; i=i/2, counter++) {
        div = z % i;
        div = div / (i / 2);
        sprintf(&bin_str[counter], "%i", div);
    }

    return bin_str;
}

int main(int argc, const char * argv[]) {

    for (int i = 0; i < 256; i++) {
        printf("%s\n", intToBinary(i, 8)); //8bit but you could do 16 bit as well
    }

    return 0;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-12-10T03:12:43.607

这是另一个不需要 char * 的解决方案。

```
#include <stdio.h>
#include <stdlib.h>

void    print_int(int i)
{
    int j = -1;
    while (++j < 32)
        putchar(i & (1 << j) ? '1' : '0');
    putchar('\n');
}

int main(void)
{
    int i = -1;
    while (i < 6)
        print_int(i++);
    return (0);
} 
```

或者在这里以获得更多可读性：

```
#define GRN "\x1B[32;1m"
#define NRM "\x1B[0m"

void    print_int(int i)
{
    int j = -1;
    while (++j < 32)
    {
        if (i & (1 << j))
            printf(GRN "1");
        else
            printf(NRM "0");
    }
    putchar('\n');
} 
```

这是输出：

```
11111111111111111111111111111111
00000000000000000000000000000000
10000000000000000000000000000000
01000000000000000000000000000000
11000000000000000000000000000000
00100000000000000000000000000000
10100000000000000000000000000000 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-02-01T17:52:33.710

```
#include <stdio.h>

#define BITS_SIZE 8

void
int2Bin ( int a )
{
  int i = BITS_SIZE - 1;

   /*
    * Tests each bit and prints; starts with 
    * the MSB
    */
  for ( i; i >= 0; i-- )
  {
    ( a & 1 << i ) ?  printf ( "1" ) : printf ( "0" );
  }
  return;
}

int
main ()
{
  int d = 5;

  printf ( "Decinal: %d\n", d );
  printf ( "Binary: " );
  int2Bin ( d );
  printf ( "\n" );

  return 0;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-07-02T23:21:04.280

不是那么优雅，但可以实现您的目标，并且很容易理解：

```
#include<stdio.h>

int binario(int x, int bits)
{
    int matriz[bits];
    int resto=0,i=0;
    float rest =0.0 ;
    for(int i=0;i<8;i++)
    {
        resto = x/2;
        rest = x%2;
        x = resto;
        if (rest>0)
        {
            matriz[i]=1;
        }
        else matriz[i]=0;
    }
    for(int j=bits-1;j>=0;j--)
    {
        printf("%d",matriz[j]);
    }
    printf("\n");
}
int main()
{
    int num,bits;
    bits = 8;
    for (int i = 0; i < 256; i++)
    {
        num = binario(i,bits);
    }
    return 0;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-01-21T03:17:38.230

只是对@Adam Markowitz 答案的增强

要让函数支持 uint8 uint16 uint32 和 uint64：

```
#include <inttypes.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

// Convert integer number to binary representation.
// The buffer must have bits bytes length.
void int2bin(uint64_t number, uint8_t *buffer, int bits) {
  memset(buffer, '0', bits);
  buffer += bits - 1;
  for (int i = bits - 1; i >= 0; i--) {
    *buffer-- = (number & 1) + '0';
    number >>= 1;
  }
}

int main(int argc, char *argv[]) {
  char buffer[65];
  buffer[8] = '\0';
  int2bin(1234567890123, buffer, 8);
  printf("1234567890123 in  8 bits: %s\n", buffer);
  buffer[16] = '\0';
  int2bin(1234567890123, buffer, 16);
  printf("1234567890123 in 16 bits: %s\n", buffer);
  buffer[32] = '\0';
  int2bin(1234567890123, buffer, 32);
  printf("1234567890123 in 32 bits: %s\n", buffer);
  buffer[64] = '\0';
  int2bin(1234567890123, buffer, 64);
  printf("1234567890123 in 64 bits: %s\n", buffer);
  return 0;
} 
```

输出：

```
1234567890123 in  8 bits: 11001011
1234567890123 in 16 bits: 0000010011001011
1234567890123 in 32 bits: 01110001111110110000010011001011
1234567890123 in 64 bits: 0000000000000000000000010001111101110001111110110000010011001011 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2011-12-28T22:41:18.383

```
void print_binary(int n) {
    if (n == 0 || n ==1) 
        cout << n;
    else {
        print_binary(n >> 1);
        cout << (n & 0x1);
    }
} 
```

# jquery - 使用 jQuery 使侧边栏和内容的大小相等

> ID：1024391
> 
> 赞同：0
> 
> 时间：2009-06-21T17:43:33.643
> 
> 标签：jquery

我有几个

```
<div class="sidebar"></div><div class="content"></div> 
```

侧边栏和内容的背景不同。因此，如果它们不等于高度，则会显示后面的页面。我想使用 jQuery 等于他们的高度。我自己尝试过，但失败了。

注意：侧边栏和内容是一*对*。所以，

```
 $('.sidebar').height() > $('.content').height() ? $('.content').height($('.sidebar').height()) : $('.sidebar').height( $('.content').height());
}); 
```

行不通。在这里，总是将第一个侧边栏与第一个内容进行比较（我希望我是对的）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T18:41:06.937

使用[**Faux Column**](http://www.alistapart.com/articles/fauxcolumns/) **CSS 技术**来解决这个问题。

使用 JavaScript 解决这个问题相当于使用手提钻将木板钉在地板上。如果你的木板不够坚固（JavaScript 被禁用或浏览器的实现很差），那么它就会中断（你的解决方案也是如此）。

**就我个人而言，我认为将 JavaScript 解决方案标记为已接受会向那些偶然发现此页面并认为这是解决他们问题的最佳解决方案的人发送错误信息。**

您拥有多个侧边栏这一事实并不能阻止您使用此解决方案。鉴于以下情况：

```
<div class="contentSidebarPair">
    <div class="sidebar"></div>
    <div class="content"></div>
</div> 
```

您可以使用以下样式：

```
/* sidebar.gif is simply a 200x1px image with the bgcolor of your sidebar.
   #FFF is the bgcolor of your content */
div.contentSidebarPair {
    background: #FFF url('sidebar.gif') repeat-y top left;
    width: 800px;
    zoom: 1; /* For IE */
}

/* IE6 will not parse this but it doesn't need to */
div.contentSidebarPair:after {
    content: ".";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
}

div.sidebar {
    float: left;
    width: 200px;
}

div.content {
    float: left;
    width: 600px;
} 
```

那里！简单有效。绝对零涉及 JavaScript。如果你想创建更复杂的布局（流式布局），你可以使用 background-position 来调整这种技术。此处提供了[教程](http://www.addedbytes.com/css/faux-columns-for-liquid-layouts/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T17:46:53.497

我建议你用 CSS 解决这个问题。以下是我在 Google 上找到的有关该主题的第一页：[一](http://www.alistapart.com/articles/holygrail)、[二](http://www.456bereastreet.com/lab/developing_with_web_standards/csslayout/2-col/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T17:58:50.623

这是一个新版本，如果内容和侧边栏对是兄弟（如代码片段）并且它们不在同一个节点内，则可以使用，如下所示：

```
<div>
  <div class="sidebar"></div><div class="content"></div>
</div>
<div>
  <div class="sidebar"></div><div class="content"></div>
</div>

  $(document).ready(function(){
    $('.content').each(function(){
      var sidebar = $(this).siblings('.sidebar');
      sidebar.height() > $(this).height() ? $(this).height(sidebar.height()) : sidebar.height($(this).height());
    });
  }); 
```

如果内容和侧边栏都是同级的，如下所示：

```
 <div>
    <div class="sidebar"></div><div class="content"></div>
    <div class="sidebar"></div><div class="content"></div>
  </div> 
```

这是基于兄弟姐妹位置的另一种解决方案：

```
$('.content').each(function(){
  var sidebar = $(this).prev('.sidebar');
  sidebar.height() > $(this).height() ? $(this).height(sidebar.height()) : sidebar.height($(this).height());
}); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-21T23:10:28.867

首先，确保你有效地清理。[像这样](http://www.sitepoint.com/blogs/2005/02/26/simple-clearing-of-floats/)的东西应该会给您留下一个无需 javascript 即可使用的网站。

一旦你这样做了，这样的事情应该可以工作：

```
var sidebarHeight = $("#sidebar").height();
var bodyHeight = ( $("#content").height() );

if ( sidebarHeight > bodyHeight ) {
  $("#wrapper").height(sidebarHeight);
  $("#content").height(sidebarHeight);
  }
else if (bodyHeight > sidebarHeight) {
  $("#sidebar").height(bodyHeight);
  $("#wrapper").height(bodyHeight);
  }; 
```

请注意，我假设这包含在 div#wrapper 或其他内容中。

# ruby-on-rails - 什么会阻止创建 gem 规范文件？

> ID：1024397
> 
> 赞同：1
> 
> 时间：2009-06-21T17:46:13.623
> 
> 标签：ruby-on-rails, ruby, rubygems, specifications

我试图更新没有 .specification 文件的 gem 的规范。

```
1\. cd {application_home_directory}
2\. rake gems:refresh_specs 
```

当我这样做时，我收到了递归警告：

```
config.gem: Unpacked gem in vendor/gems has no specification file. 
Run 'rake gems:refresh_specs' to fix this. 
```

我也试过这个，它也无法创建没有任何错误/警告的规范：

```
1\. cd vendor/gems/gemname
2\. gem specification gemname > .specification 
```

**在这些情况下，什么会阻止创建 gem 规范文件？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T18:35:29.083

您的 environment.rb 文件中是否有`config.gem`关于您的 gem 的声明？根据我的经验，您需要在配置中设置 gem 才能`rake gems:refresh_specs`了解它们。

# protocols - 我应该使用什么协议来进行快速命令/响应交互？

> ID：1024403
> 
> 赞同：3
> 
> 时间：2009-06-21T17:48:42.467
> 
> 标签：protocols

我需要为快速命令/响应交互设置一个协议。我的直觉告诉我只需将一个简单的协议与 CRLF 分隔的 ascii 字符串（如 SMTP 或 POP3 的工作方式）组合在一起，并在需要保护它时通过 SSH/SSL 进行隧道传输。

虽然我可以这样做，但我更愿意在现有技术的基础上进行构建，这样人们就可以使用友好的库而不是操作系统提供的套接字库接口。

我需要...

*   来回传递结构化数据的命令和响应。（XML、S 表达式，不用管。）
*   服务器在不被轮询的情况下向客户端发出计划外通知的能力。

请问有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T18:35:36.383

如果你只是想要请求/回复，HTTP 非常简单。它已经是一个请求/响应协议。客户端和服务器端在大多数语言中广泛实现。扩大规模是很好理解的。

使用它的最简单方法是将命令作为 POST 请求发送到服务器，然后服务器在响应正文中发回回复。你也可以用你自己的动词来扩展 HTTP，但这会让利用缓存代理和其他可以理解 HTTP 的基础设施做更多的工作。

如果您想要异步通知，请查看发布/订阅协议（Spread、XMPP、AMQP、JMS 实现或商业发布/订阅消息代理，如 TibcoRV、Tibco EMS 或 Websphere MQ）。要选择的协议或实现取决于您正在构建的系统的可靠性、延迟和吞吐量需求。例如，网络拥塞时可以丢弃通知吗？当客户端离线时通知会发生什么 - 当客户端重新连接时它们会被丢弃还是排队。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T17:54:16.763

AMQP 听起来很有希望。或者，我认为 XMPP 支持您想要的大部分功能，尽管开销很大。

也就是说，根据您要完成的工作，一个简单的临时协议可能会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T18:22:16.810

像 SNMP 这样的东西怎么样？我不确定它是否完全符合您的应用程序使用的模型，但它同时支持异步通知和拉取（即 TRAP 和 GET）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-08T20:49:59.567

这是一个很好的问题，需要考虑大量变量，而问题只提到了其中的几个：数据包格式、异步与同步消息传递以及安全性。还有很多很多其他人可以考虑。我建议仔细阅读 7 层协议栈 (OSI/ISO) 的描述，并问自己在这些层需要什么，以及是要构建该层还是从其他地方获取它。（您似乎对第 6 层和第 7 层最感兴趣，但也提到了一些较低的层。）

还要考虑这是在安全关键应用程序中还是在具有正式 V&V 的系统的一部分中。真正好的、值得信赖的通信系统不容易设计；“动力不足”的协议也会给应用程序带来很多编码负担，以进行错误恢复。

最后，我建议查看与您类似的其他应用程序是如何完成这项工作的（检查开源、阅读书籍等）。美国专利局数据库等也很有用；仅仅通过阅读他们试图解决的沟通问题的描​​述，人们就可以得到很好的想法。

# java - 我应该使用什么 java 验证库？

> ID：1024407
> 
> 赞同：5
> 
> 时间：2009-06-21T17:50:42.150
> 
> 标签：java, validation

我有点坚持这个决定。我的项目已经使用 Spring 和 Spring Blazeds 集成，但我认为不会有任何真正的 Web 界面 (HTML)。我对 Spring MVC 和 Spring 验证器的经验有限，但我已经阅读了人们的评论，建议不要在 Spring MVC 之外使用 Spring 验证器。根据个人经验，您会推荐什么验证框架？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-21T17:56:34.030

“...，但我读过一些人的评论，建议不要在 Spring MVC 之外使用 Spring 验证器...”

我想看看那些引用。我在 Spring MVC 之外使用了 Spring DataBinding API，它非常棒。我会说批评是没有根据的。

[Apache Commons Validator](http://commons.apache.org/validator/)是一种替代方案，但我仍然会首先推荐 Spring 的 DataBinder。 *特别是*如果您已经在使用 Spring。切换到其他任何东西的好处远远超过了另一个依赖项的成本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-18T22:05:14.403

您可以尝试[Hibernate Validator](http://www.hibernate.org/412.html)，它实际上是 JSR 303：Bean Validation 的参考实现。顺便说一句，它仍处于测试阶段。

# python - python doctest 可以忽略一些输出行吗？

> ID：1024411
> 
> 赞同：38
> 
> 时间：2009-06-21T17:54:11.100
> 
> 标签：python, doctest

我想写一个这样的doctest：

```
"""
>>> print a.string()
          foo : a
          bar : b
         date : <I don't care about the date output>
          baz : c
""" 
```

有没有办法做到这一点？我认为切换到 unittest 会更有意义，但我很好奇是否可以指定一个不应该与 doctest 中的测试匹配的输出范围。

谢谢！

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-06-21T18:03:19.713

使用`doctest.ELLIPSIS`，您可以`...`用来表示“匹配此处的任何字符串”。您可以`doctest`使用 doctest 指令设置选项，使其仅对一个测试用例有效：[在线文档](http://docs.python.org/library/doctest.html)中的一个示例是：

```
>>> print range(20) # doctest:+ELLIPSIS
[0, 1, ..., 18, 19] 
```

如果您希望 doctest 选项始终处于活动状态，您可以将其作为`optionflags=`参数传递给您使用的任何 doctest 函数，例如`doctest.testfile`. （您可以通过使用`|`操作符来传递多个选项标志）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2012-02-22T18:33:27.373

回答有关“我们如何忽略整行”的问题：是的，事实上，“...”也看起来像一个延续，因此很难忽略整个输出。如果您只想完全跳过该示例，则可以使用“#doctest: +SKIP”，但如果您依赖它的副作用，那将不起作用。如果你*真的*需要这样做，我想你可以对 doctest 模块本身进行猴子补丁，但我不会特别推荐它：

```
>>> import doctest
>>> doctest.ELLIPSIS_MARKER = '-etc-'
>>> print 12 # doctest: +ELLIPSIS
-etc- 
```

（此测试通过。）

或者您可以暂时抑制标准输出和/或标准错误：

```
>>> # Suppress stdout
>>> import sys
>>> class DevNull:
...     def noop(*args, **kwargs): pass
...     close = write = flush = writelines = noop
>>> sys.stdout = DevNull()
>>> # Run a test and ignore output (but we need its side effects)
>>> print 12 # NOTE: stdout is suppressed!
>>> # Restore stdout
>>> sys.stdout = sys.__stdout__ 
```

（这个测试也通过了。）

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-02-22T17:27:29.660

不过，忽略整行有点棘手。这里：

```
"""
>>> do_your_thing() #doctest:+ELLIPSIS
...
""" 
```

三点将被解释为续行，并导致语法错误。

如果你想忽略整行，你需要类似的东西：

```
"""
>>> sys.stdout.write('skip from here '); do_your_thing() #doctest:+ELLIPSIS
skip from here ...
""" 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-03-20T15:29:32.253

我发现将不需要的返回值简单地分配给变量更容易：

```
>>> _ = do_something()
>>> check_something()
True 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-10-28T20:27:08.923

您可以在函数之前和之后编写元组（灵感来自 Mark Horvath 的回答）：

```
def foo():
    """
    >>> ();foo();() # doctest: +ELLIPSIS
    (...)
    """
    print "Hello world"
    return "Hello world" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-01T10:39:45.197

[我可以在 Python doctest 的行首有省略号吗？](https://stackoverflow.com/questions/5812833/can-i-have-an-ellipsis-at-the-beginning-of-the-line-in-a-python-doctest)解释了如何创建使用附加字符串作为省略号的自定义输出检查器。这将让您编写以下内容，同时在其他地方仍使用“...”。

```
def foo():
  """
  >>> foo() # doctest: +ELLIPSIS
  [...] world
  """
  print "hello world" 
```

# c# - 修改linq查询如何？

> ID：1024413
> 
> 赞同：2
> 
> 时间：2009-06-21T17:55:05.170
> 
> 标签：c#, .net, asp.net, linq, linq-to-entities

我怎样才能比以前更短以下代码？我需要简短的方法：我不想使用 foreach 循环，因为我只有一个值。

```
 public partial class Test : System.Web.UI.Page
    {
        StaffManagementEntities staffContext;
        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                LoadStaffPersonel();
            }
        }

        void LoadStaffPersonel()
        {
            int selectedDepartman = Convert.ToInt32(Request.QueryString["SelectedDepartmanID"]);
            string name="";
            using (staffContext = new StaffManagementEntities())
            {

                var DepartmanName = from d in staffContext.Departman
                                    where d.ID == selectedDepartman
                                    select d;
                foreach (Departman d in DepartmanName)
                {
                    name = d.Name;
                }

                ObjectResult<StaffsPersonel> personalData = staffContext.GetPersonelData(name);
                gvPersonel.DataSource = personalData;
                gvPersonel.DataBind();

            }
        }

    }
```

如何使用字符串值而不是“var DepartmanName”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T17:57:37.880

就像是：

```
string name = (from d in staffContext.Departman
               where d.ID == selectedDepartman
               select d.Name).First(); 
```

或者：

```
string name = staffContext.Departman.Where(d=>d.ID == selectedDepartman)
                  .First().Name; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T17:58:15.320

这是你想要做的吗？

```
string name = (from d in staffContext.Departman
                                where d.ID == selectedDepartman
                                select d.Name).SingleOrDefault(); 
```

如果部门不退出，SingleOrDefault 将返回名称或null **。**

**更新：**

*   似乎您目前需要使用**ykaratoprak**评论的**第**一种方法。但是根据[这篇文章](http://blogs.msdn.com/adonet/archive/2009/05/18/sneak-preview-entity-framework-4-0-testability-improvements.aspx)，Single/SingleOrDefault 将被添加到 Entity Framework 4.0 中。

 *** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T18:18:26.223

您可以使用当前 3.5 框架中可用的“FirstOrDefault”。我认为它可能已包含在 3.0 中，但我不确定。如果找不到该项目，我认为它将返回 null （而不是空字符串）....但是您需要仔细检查。

string name = (from d in staffContext.Departman where d.ID == selectedDepartman select d.Name).FirstOrDefault();**

# ruby - 如何从 NDFD (NOAA, NWS) REST 服务中获取“当前观测数据”？

> ID：1024427
> 
> 赞同：1
> 
> 时间：2009-06-21T18:03:21.770
> 
> 标签：ruby, rest, noaa

我正在尝试使用 NDFD（国家数字预报数据库）来获取当前的温度和相对湿度，使用他们[基于 REST 的服务](http://www.weather.gov/forecasts/xml/rest.php)给定纬度和经度。

手头的问题：

我无法将“当前观察数据”与从 REST 服务返回的“结果”匹配。

设置：

位置：
* Apple（1-infinite loop，Cupertino，California）
* Lat = 37.33；朗 = -122.03

如果我发出以下 REST 调用：

[http://www.weather.gov/forecasts/xml/sample_products/browser_interface/ndfdXMLclient.php?lat=37.33&lon=-122.03&product=time-series&begin=2009-06-21T17:12:35&end=2009-06-21T17 :12:35&appt=appt&rh=rh&temp_r=temp_r&temp=temp](http://www.weather.gov/forecasts/xml/sample_products/browser_interface/ndfdXMLclient.php?lat=37.33&lon=-122.03&product=time-series&begin=2009-06-21T17:12:35&end=2009-06-21T17:12:35&appt=appt&rh=rh&temp_r=temp_r&temp=temp)

> 注意 1：我正在传递 UTC 的开始时间和结束时间。它们是相同的，因为我正在寻找一个时间点：最新观察到的温度和相对湿度。

并且，然后将其与壁橱报告站（加利福尼亚州圣何塞国际机场 - **KSJC** - 37.37N 121.93W）进行比较@[http://www.weather.gov/xml/current_obs/KSJC.xml](http://www.weather.gov/xml/current_obs/KSJC.xml)

**** 我永远无法让他们匹配。****

> 注意 2：最近的报告站也是从 REST 调用返回的，所以我知道我正在将位置苹果与位置苹果进行比较。

我有两个想法：

1：我在将开始/结束时间传递给 REST 调用的方式上做错了......

2：您无法以我尝试的方式获得“当前观察到的数据”...

**最后：**

我找到了使用[outoftime 的 NOAA ruby​​ lib](http://github.com/outoftime/noaa/tree/master)的解决方案，[它解析观测站 YAML 文件以找到给定 Lat/Lng 的最近的观测站，然后通过其标识符直接进入该站，即[http://www.weather.gov/xml /current_obs/KSJC.xml]](http://www.weather.gov/xml/current_obs/KSJC.xml]) .... 但感觉我可能在这里遗漏了一些明显的东西，并且想使用基于 REST 的界面；）

任何帮助或指示将不胜感激！

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-30T16:06:00.417

看起来您正在调用的服务不适用于当前数据。从 URL 和 XML 结果来看，它似乎是用于预测的。您还可以输入未来日期以获取未来的预测数据。根据响应，它预计日期在 -0700 时区。我不确定你应该调用哪个服务来获取你想要的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-31T15:35:09.343

我知道这是一个老问题，但这是我用来获取当前天气状况的方法：http: [//forecast.weather.gov/MapClick.php?lat=43.09110 &lon=-79.0162&unit=0&lg=english&FcstType= dwml](http://forecast.weather.gov/MapClick.php?lat=43.09110&lon=-79.0162&unit=0&lg=english&FcstType=dwml)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-24T17:05:12.780

如果您想要“当前”观察结果，请在此处使用 XML：

[http://w1.weather.gov/xml/current_obs/seek.php?state=or&Find=Find](http://w1.weather.gov/xml/current_obs/seek.php?state=or&Find=Find)

例如，：

[http://w1.weather.gov/xml/current_obs/KAST.xml](http://w1.weather.gov/xml/current_obs/KAST.xml)

如果您单击该链接，您将获得一个渲染页面。但是，如果您使用普通的 rest 方法或 wget 从中提取，它会提供一个 xml 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-06T15:05:46.693

昨天找到了这个 api/link。它仍然处于发展阶段（操作模式=“发展”）：

[http://forecast.weather.gov/MapClick.php?lat=37.33&lon=-122.03&FcstType=dwml](http://forecast.weather.gov/MapClick.php?lat=37.33&lon=-122.03&FcstType=dwml)

# flash - 使用 CodeIgniter 的 OpenFlashChart

> ID：1024434
> 
> 赞同：0
> 
> 时间：2009-06-21T18:09:50.700
> 
> 标签：flash, codeigniter, charts, open-flash-chart

有没有人找到将 OpenFlashChart v2 与 CodeIgniter 集成的方法？问题是作者将类中的所有内容和多个文件分开。这会阻止您为 CodeIgniter 创建帮助程序或插件。可以在[此处](http://codeigniter.com/forums/viewthread/73340/)找到使用 2 之前版本的一种方法。不过，我还没有找到使用图表第 2 版的方法。有没有其他人找到方法？提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-25T05:27:21.647

对于版本 2，您只需要生成一个像这样的 javascript json

```
<script type='text/javascript'>
                    var data =  {"title":{"text":""},"is_decimal_separator_comma":0,"elements":[{"values":[{"value":25000,"label":"AIG Australia 41.67%","highlight":"alpha"},{"value":35000,"label":"Valentino Jr. 58.33%","highlight":"alpha"}],"alpha":0.8,"type":"pie","start-angle":21,"tip":"#val# - #percent#","colours":["#F09B0A","#F03060","#E6FF29","#805B37","#13613A","#aacc44"]}],"num_decimals":2,"is_fixed_num_decimals_forced":0,"is_thousand_separator_disabled":0};
                    $(document).ready(function(){
                        swfobject.embedSWF("/flash/open-flash-chart.swf", "echart", "600","400","9.0.0");
                    });
                    function open_flash_chart_data()
                    {
                            ex = JSON.stringify(data);
                            return ex;
                    }
                </script> 
```

我为此使用 Grails，但我认为它与 codeigniter 相同 :)

# python - 如何修复 Python 缩进

> ID：1024435
> 
> 赞同：290
> 
> 时间：2009-06-21T18:10:18.187
> 
> 标签：python

我有一些缩进不一致的 Python 代码。有很多制表符和空格的混合使事情变得更糟，甚至没有保留空格缩进。

代码按预期工作，但很难维护。

如何在不破坏代码的情况下修复缩进（如[HTML Tidy](https://en.wikipedia.org/wiki/HTML_Tidy)，但适用于 Python）？

* * *

## 回答 #1

> 赞同：297
> 
> 时间：2009-06-21T18:36:59.720

使用您在Python 安装目录中`reindent.py`找到的脚本：`Tools/scripts/`

> 将 Python (.py) 文件更改为使用 4 空格缩进且不使用硬制表符。还要从行尾修剪多余的空格和制表符，并删除文件末尾的空行。还要确保最后一行以换行符结尾。

查看该脚本以获取详细的使用说明。

* * *

注意：如果您的 linux 发行版默认没有安装 Python 的 reindent：

许多 linux 发行版默认没有`reindent`安装`python`--> 一个简单的方法`reindent`是做`pip install reindent`.

ps 另一种方法`pip`是使用您的发行版包管理器（即`apt-get`, `yum`, `dnf`），但是您需要弄清楚哪个包有命令行工具，因为每个发行版都有不同的包中的工具。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2014-10-30T01:19:35.607

我会使用[autopep8](https://pypi.python.org/pypi/autopep8)来做到这一点：

```
$ # see what changes it would make
$ autopep8 path/to/file.py --select=E101,E121 --diff

$ # make these changes
$ autopep8 path/to/file.py --select=E101,E121 --in-place 
```

*注意：[E101 和 E121](https://github.com/hhatto/autopep8#features)是 pep8 缩进（我认为你可以简单地通过`--select=E1`来修复所有与缩进相关的问题——那些以 E1 开头的问题）。*

您可以使用递归标志将此应用于整个项目：

```
$ autopep8 package_dir --recursive --select=E101,E121 --in-place 
```

*另请参阅[将 Python 代码转换为符合 PEP8 的工具](https://stackoverflow.com/a/14328499/1240268)。*

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2009-06-21T18:20:38.827

如果您使用[Vim](http://www.vim.org/)，请参阅[`:h retab`](http://vimdoc.sourceforge.net/htmldoc/change.html#:retab).

```
                                                        *:ret* *:retab*
:[范围]ret[ab][!] [new_tabstop]
                        替换所有包含 a 的空白序列
                        <Tab> 使用新的空白字符串
                        给定制表位值。如果不指定新的
                        tabstop 大小或为零，Vim 使用当前值
                        '制表位'。
                        'tabstop' 的当前值始终用于
                        计算现有选项卡的宽度。
                        使用 !，Vim 也只替换普通字符串
                        在适当的地方带有制表符的空格。
                        打开 'expandtab'，Vim 用
                        适当数量的空格。
                        此命令将 'tabstop' 设置为给定的新值，
                        如果在整个文件上执行，这是默认的，
                        不应该做出任何明显的改变。
                        小心：此命令修改任何 <Tab> 字符
                        在 C 程序中的字符串内部。使用“\t”来避免
                        这（无论如何这是一个好习惯）。
                        ":retab!" 也可以通过改变一系列空格
                        <Tab> 字符，这会弄乱 printf()。
                        {Vi 无此功能}
                        在 |+ex_extra| 时不可用 功能在
                        编译时间。

```

例如，如果您只需键入

```
:ret

```

您的所有选项卡都将扩展为空格。

你可能想要

```
:se et " :set expandtab 的简写

```

确保任何新行都不会使用文字制表符。

* * *

如果你不使用 Vim，

```
perl -i.bak -pe "s/\t/' 'x(8-pos()%8)/eg" file.py

```

将用空格替换制表符，假设制表符每 8 个字符停止一次，在`file.py`（`file.py.bak`以防万一）。如果您的制表位是每 4 个空格，则将 8s 替换为 4s。

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2015-04-14T20:33:02.223

## `autopep8 -i script.py`

使用[autopep8](https://pypi.org/project/autopep8/)

`autopep8` *自动*格式化 Python 代码以符合[`PEP 8` `nullstyle`](https://www.python.org/dev/peps/pep-0008/)指南。它使用该`pep8`实用程序来确定 `nullcode`需要格式化的部分。`autopep8`能够修复大多数 `nullformatting`可以报告的问题`pep8`。

```
pip install autopep8
autopep8 script.py    # print only
autopep8 -i script.py # write file 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-06-21T18:14:12.800

使用 Vim，它不应该比点击`Esc`，然后打字更复杂......

```
:%s/\t/    /g 
```

...在您要更改的文件上。这会将所有制表符转换为四个空格。如果您的间距也不一致，那么这将更加困难。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-02-14T04:55:29.937

还有[PythonTidy](http://pypi.python.org/pypi/PythonTidy/1.16)（因为你说你喜欢 HTML Tidy）。

它可以做的不仅仅是清理标签。如果你喜欢这种类型的东西，值得一看。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-05-25T12:40:05.810

在大多数类 UNIX 系统上，您还可以运行：

```
expand -t4 oldfilename.py > newfilename.py 
```

从命令行中，如果您想用 4 以外的空格替换制表符，请更改数字。您可以轻松地编写一个 shell 脚本来一次处理一堆文件，同时保留原始文件名。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-08-21T22:35:51.350

如果你很懒（像我一样），你也可以下载 Wingware Python IDE 的试用版，它有一个自动修复工具，用于搞乱缩进。它工作得很好。 [http://www.wingware.com/](http://www.wingware.com/)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2015-10-24T16:17:15.380

由于缺少一些模块，reindent 脚本对我不起作用。无论如何，我发现这个`sed`命令非常适合我：

```
sed -r 's/^([  ]*)([^ ])/\1\1\2/' file.py 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-21T18:19:32.087

试试 Emacs。它对 Python 所需的缩进有很好的支持。请检查此链接[http://python.about.com/b/2007/09/24/emacs-tips-for-python-programmers.htm](http://python.about.com/b/2007/09/24/emacs-tips-for-python-programmers.htm)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-25T12:14:22.247

尝试[IDLE](http://en.wikipedia.org/wiki/IDLE_%28Python%29)，并使用`Alt`+`X`查找缩进。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-13T01:59:44.070

对于这个问题，我有一个简单的解决方案。你可以先输入 ":retab" 然后输入 ":retab!"，然后一切都会好起来的

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-05-15T09:39:22.980

如果试图找到将您的`2-space indented`python 脚本制作成一个`tab indented`版本的工具，只需使用这个在线工具：

[https://www.tutorialspoint.com/online_python_formatter.htm](https://www.tutorialspoint.com/online_python_formatter.htm)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-07-15T07:24:31.130

还有一个谷歌很棒的项目，叫做[YAPF](https://github.com/google/yapf)

它可以自动重新格式化整个项目或检查项目是否具有正确的缩进/格式。我在一个商业项目中使用了它，我推荐它。

# python - Python新手：这段代码有什么作用？

> ID：1024437
> 
> 赞同：1
> 
> 时间：2009-06-21T18:10:57.313
> 
> 标签：python

这是来自 Google AppEngine 教程的片段。

```
application = webapp.WSGIApplication([('/', MainPage)], debug=True) 
```

我不太确定**`debug=True`**构造函数调用中的内容。它是创建一个带有 name 的局部变量`debug`，分配`True`给它，然后将它传递给构造函数，还是这是在构造函数中设置类实例成员变量值的一种方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-21T18:14:24.233

Python 函数接受关键字参数。如果你像这样定义一个函数：

```
def my_func(a, b='abc', c='def'):
    print a, b, c 
```

你可以这样称呼它：

```
my_func('hello', c='world') 
```

结果将是：

```
hello abc world 
```

您还可以使用特殊语法支持动态关键字参数：

```
def my_other_func(a, *b, **c):
    print a, b, c 
```

*   `*b`表示该`b`变量将 , 之后的所有非命名参数`a`作为`tuple`对象。
*   `**c`意味着该`c`变量将所有命名参数作为一个`dict`对象。

如果你这样调用函数：

```
my_other_func('hello', 'world', 'what a', state='fine', what='day') 
```

你会得到：

```
hello ('world', 'what a') {'state': 'fine', 'what': 'day'} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T18:13:42.020

两者都不 - 相反，`webapp.WSGIApplication`它接受一个名为 的可选参数`debug`，并且此代码正在传递该`True`参数的值。

参考页在`WSGIApplication`这里[，](http://code.google.com/appengine/docs/python/tools/webapp/wsgiapplicationclass.html)它清楚地显示了可选参数以及除非明确传入，否则`debug`它默认为的事实。`False`

正如页面进一步说明的那样，传递`debug`as`True`意味着如果在处理请求时发生异常，则会向浏览器显示有用的调试信息。

究竟是如何获得这种效果的（特别是，它是否暗示 的实例上存在一个属性`WSGIApplication`，或者该假设的属性如何命名）是一个内部的、未记录的实现细节，我们不应该担心（当然，如果您*确实*担心，或者只是想了解有关这些规范的一种可能实现的更多信息，您可以研究`WSGIApplication`SDK 中的源代码！-)。

 ** * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T18:12:54.783

它使用命名参数。请参阅[使用可选参数和命名参数](http://diveintopython.net/power_of_introspection/optional_arguments.html)。*

# ruby-on-rails - 为什么需要 gem 规范，为什么有些 gem 创建者不提供它们？

> ID：1024440
> 
> 赞同：1
> 
> 时间：2009-06-21T18:12:19.307
> 
> 标签：ruby-on-rails, ruby, rubygems, specifications

我注意到一些 ruby​​ gem 有 .specification 文件，而另一些则没有。

如果它们很重要，为什么在您尝试创建 gem 时不需要（通过任何构建它们的工具）提供一个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T18:31:13.770

许多 gem 是使用 hoe 或 newgem 配置的，它们仅在构建 gem 时生成规范。该规范被视为仅用于创建 gem 的临时代码，因此通常不会打包。不过，这两个工具都有 rake 任务，它们会生成一个规范文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-08T22:56:49.413

有时 gem 规范位于 Rakefile 中，而不是单独的 gemspec。

# delphi - 跳出块时是否有一种安全的方法来清理基于堆栈的代码？

> ID：1024445
> 
> 赞同：1
> 
> 时间：2009-06-21T18:13:59.117
> 
> 标签：delphi, goto, pascalscript

我一直在研究PascalScript 脚本引擎的[第 14 期](http://code.remobjects.com/p/pascalscript/issues/14/)，其中使用 Goto 命令跳出 Case 块会产生编译器错误，即使这是完全有效（如果丑陋）的 Object Pascal 代码。

结果编译器中的 ProcessCase 例程调用 HasInvalidJumps，它会扫描任何在 Case 块之外的 Goto，如果找到，则会给出编译器错误。如果我评论检查，它编译得很好，但最终在运行时崩溃。字节码的反汇编说明了原因。我已经用原始脚本代码对其进行了注释：

```
[TYPES]
<SNIPPED>
[VARS]
Var [0]: 27 Class TFORM
Var [1]: 28 Class TAPPLICATION
Var [2]: 11 S32 //i: integer
[PROCS]
Proc [0] Export: !MAIN -1
{begin}
 [0] ASSIGN GlobalVar[2], [1]
{ i := 1;}
 [15] PUSHTYPE 11(S32) // 1
 [20] ASSIGN Base[1], GlobalVar[2]
{ case i of}
 [31] PUSHTYPE 25(U8) // 2
{   0:}
 [36] COMPARE into Base[2]: [0] = Base[1]
 [57] COND_NOT_GOTO currpos + 5 Base[2] [72]
{   end;}
 [67] GOTO currpos + 41 [113]
{   1:}
 [72] COMPARE into Base[2]: [1] = Base[1]
 [93] COND_NOT_GOTO currpos + 10 Base[2] [113]
{     goto L1;}
 [103] GOTO currpos + 8 [116]
{   end;}
 [108] GOTO currpos + 0 [113]
{ end; //<-- case}
 [113] POP // 1
 [114] POP // 0
{ Exit;}
 [115] RET
{L1:
 Writeln('Label L1');}
 [116] PUSHTYPE 17(WideString) // 1
 [121] ASSIGN Base[1], ['????????']
 [144] CALL 1
{end.}
 [149] POP // 0
 [150] RET
Proc [1]: External Decl: \00\00 WRITELN 
```

“转到 L1；” 103 处的语句跳过了 113 和 114 处的清理弹出，这使堆栈处于无效状态。

Delphi 对此没有任何问题，因为它不使用计算堆栈。然而，PascalScript 就没有那么幸运了。我需要一些方法来完成这项工作，因为这种模式在一些来自更简单系统的遗留脚本中非常常见，而我已经翻译成 PascalScript 并且需要能够支持的控制结构的方式很少。

任何人都知道如何修补 codegen 以便正确清理堆栈？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T16:39:51.990

IIRC 经典帕斯卡的 goto 规则是：

*   只允许跳出块（在树的“相同”分支上从较高的嵌套级别到较低的嵌套级别）
*   从当地程序到他们的父母。

后者从未得到 Borland 派生的 Pascals 的支持，但第一个仍然成立。

因此，您需要像 Martin 所说的那样生成退出代码，但可能它可以用于多个块级别，因此您不能为每个 goto 生成可能的代码，但必须生成代码（以退出所需块的精确数量）。

一个典型的测试模式是使用 goto 从多个嵌套的 if（可能在一个循环中）退出，因为这是一个经典的微优化，至少在 D7 之前速度更快。

请记住，if 评估及其分支的 begin..end 块可能已生成需要清理的临时文件。

---------- 稍后添加

我认为代码生成器需要一种方法来遍历 goto 及其端点之间的范围，并在此过程中为块生成相关的退出代码。这样，修复程序适用于一般情况，而不仅仅是此示例。由于您只能跳出范围，而不能进入范围，因此可能并不那么难。

IOW 生成的东西相当于（对于假设的双案例块）

Lgoto1gluecode: // 退出代码第一个块 pop x pop y // 退出代码第一个块 pop A pop B goto real_goto_destination

可以进行额外的分析。例如，如果只有一个范围，并且它已经有一个清理退出标签，您可以直接跳转。如果您确定上述 pop 只是丢弃的值（而不是保存寄存器），您可以通过 add $16,%esp（4*4 字节值）等立即执行它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T21:55:35.413

直接的解决方案是：

在为 goto 语句生成 GOTO 时，在 GOTO 前面加上 RET 之前的相同清理代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T17:04:27.917

在我看来，计算向前跳多远是个问题。我将不得不花一些时间查看解析器的实现以进一步提供帮助，但我的猜测是在使用 goto 并且堆栈上有值时必须执行额外的处理，并且 goto 将放置在这些值之后从堆栈中删除。当然，要确定这一点，您需要保存正在解析的当前位置（goto）并将前向解析保存到目标位置，以观察堆栈更改，如果是这样，则向后调整 goto 位置，或者以 Martin 的身份注入代码建议。

# c# - 如何使用 MPF 创建从 c# 继承的自定义项目？

> ID：1024453
> 
> 赞同：6
> 
> 时间：2009-06-21T18:16:44.277
> 
> 标签：c#, vsx, extensibility, subtype, mpf

使用 Visual Studio 的托管包框架，我如何从 C# 继承，以便拥有 C# 属性页和 C# 项目项？我尝试过制作一个风味项目，但它在制作我们自己的自定义节点和自定义文件属性方面受到限制。但是，在使用 MPF 时，我似乎无法获得随风味项目提供的那些 C# 属性。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-01T16:53:46.867

经过漫长的一个半星期后，微软的一位员工终于给了我一个解决方案：

[http://social.msdn.microsoft.com/Forums/en-US/vsx/thread/bfe5d211-c626-43ff-9096-c75023a76ca5](http://social.msdn.microsoft.com/Forums/en-US/vsx/thread/bfe5d211-c626-43ff-9096-c75023a76ca5)

希望这可以帮助所有投票/喜欢这个问题的人......

# flash - 如何将链接添加到 Flash 横幅

> ID：1024454
> 
> 赞同：5
> 
> 时间：2009-06-21T18:16:53.560
> 
> 标签：flash

我主要是一名开发人员，不知道如何使用 Adob​​e Flash CS4。有没有一种简单的方法可以将链接添加到 Flash 横幅。我有 .flv 文件，其中包含库中的一些项目和两层。
请给我一步一步的指示。

编辑：我找到简单的解决方案，按步骤：

1.  转到**文件 -> 发布设置**并将**ActionScript 版本**设置为**ActionScript 2.0**
2.  插入新图层
3.  **用矩形工具**创建一个比横幅大的正方形
4.  右键单击正方形并选择**转换为符号...**在弹出窗口中选择**类型：按钮**
5.  双击库面板中的新按钮，然后将选择从 Up 移至**Hit**，然后返回主场景
6.  右键单击新的蓝色方块并选择**操作**并将此代码粘贴到源编辑器中：

    ```
    on (release) {
        getURL("http://www.example.com/", "_blank");
    } 
    ```

7.  关闭源代码编辑器并将文件**导出**为电影（**File->Export->Export Movie**）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T18:19:34.007

如果您有一个显示 FLV 电影的 Flash FLA 文件，您可以在 FLA 文件中添加一个按钮。可以给这个按钮一个加载 URL 的动作。

```
on (release) {
  getURL("http://someurl/");
} 
```

要使按钮透明，您可以在其中放置一个正方形，该正方形移动到按钮的点击区域框架。

我认为用图片来深入解释如何在stackoverflow中进行操作太过分了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:20:24.417

@Michiel 创建按钮是正确的，但 ActionScript 3 的代码有点不同 - 其中 movieClipName 是您的“按钮”的名称。

```
movieClipName.addEventListener(MouseEvent.CLICK, callLink);
function callLink:void {
  var url:String = "http://site";
  var request:URLRequest = new URLRequest(url);
  try {
    navigateToURL(request, '_blank');
  } catch (e:Error) {
    trace("Error occurred!");
  }
} 
```

来源：[http ://scriptplayground.com/tutorials/as/getURL-in-Actionscript-3/](http://scriptplayground.com/tutorials/as/getURL-in-Actionscript-3/)

# python - Python中的自动加载

> ID：1024455
> 
> 赞同：15
> 
> 时间：2009-06-21T18:17:47.240
> 
> 标签：python, coding-style, autoload

过去，我使用 Perl 的 AUTOLOAD 工具来实现将符号延迟加载到命名空间中，并希望在 python 中具有相同的功能。

传统上，您似乎能够获得的最接近的是使用一个类和一个`__getattr__`类来实现这种事情。但是，我也尝试过在 中翻找`sys.modules`，并想出了这个：

```
# mymod.py
def greet(greeting="Hello World"):
   print greeting

class Autoload(object):
    def __init__(self, __name__):
        super(Autoload, self).__init__()
        self.wrapped_name = __name__
        self.wrapped = sys.modules[__name__]
    def __getattr__(self, name):
        try:
            return getattr(self.wrapped, name)
        except AttributeError:
            def f():
                greet(name+" "+self.wrapped_name)
            return f

if __name__ != "__main__":
    import sys
    sys.modules[__name__] = autoload(__name__) 
```

从用户的角度来看，这确实以我想要的方式工作：

```
~> python
Python 2.5.1 (r251:54863, Jan 10 2008, 18:01:57)
[GCC 4.2.1 (SUSE Linux)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import mymod
>>> mymod.hello()
hello mymod
>>> from mymod import Hello_World
>>> Hello_World()
Hello_World mymod 
```

但这让我印象深刻——人们是否倾向于使用标准方法在 python 中自动加载？

其次，对于有经验的 python 开发人员来说，一个问题真的是“这对你来说是好还是坏的做法”？我是一位经验丰富的 Python 开发人员，它让我觉得它真的很有用，但它让我觉得它是边缘性的，并且对这是否可以被视为好的做法、坏做法或类似做法感兴趣。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-21T18:24:23.827

“惰性导入”可以构建在[PEP 302](http://www.python.org/dev/peps/pep-0302/)中指定的“导入钩子”之上，现在已完全实现。PEP 369 曾经涵盖“惰性导入”以及导入后挂钩，但此后已简化，现在仅涵盖导入后挂钩；不过，您可能对[原始草稿](http://permalink.gmane.org/gmane.comp.python.devel/90949)感兴趣。

`meta_path`在这个秘籍中可以找到通过钩子实现“惰性导入”的好[方法](http://code.activestate.com/recipes/473888/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-05-05T19:06:20.677

要回答使用类来模拟模块的问题：

是的，该功能并非偶然。它从 2.x 系列的早期就已经存在，并且在 3.x 系列中仍然有效。

回答延迟加载的问题：

有几种方法可以做到，每一种都会有点神秘。使用模块模仿器是一种很好的方法。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-22T11:18:48.183

不，我认为这没有用。

为什么要为您尝试从模块中获取的**每个**属性动态创建一个函数？对我来说似乎很困惑。似乎新功能正在由魔法创建，因此必须深入研究实现以了解正在发生的事情。所有这些都没有语法上的好处。

即使你有充分的理由这样做，为什么要使用模块呢？为什么要在 中注册您的类实例`sys.modules`？我认为在 python 中使事物看起来不是它们所不赞成的。

除非您故意混淆代码，否则我不明白为什么要这样做。

# mysql - 我可以更改共享主机上的“ft_min_word_len”吗？

> ID：1024456
> 
> 赞同：10
> 
> 时间：2009-06-21T18:17:53.870
> 
> 标签：mysql, full-text-search

我在共享主机上有 MySQL。有没有办法在`ft_min_word_len`没有管理员访问权限的情况下更改值？

我找到了一种解决方法，其中每个少于 4 个字符的单词都用 _ 或其他字符进行补充，每个搜索的少于 4 个字符的关键字也是如此。

有没有更好或*更*简洁的方法来使全文搜索适用于短词？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-21T18:30:30.090

不幸的是，ft_min_word_len 是一个全局系统变量，不能动态设置：参见[MySQL 的在线文档](http://dev.mysql.com/doc/refman/5.1/en/server-system-variables.html)。改变它意味着重建每个`FULLTEXT`索引，顺便说一句，所以你可以看到他们为什么不希望非管理员搞乱它。

我担心您的解决方法（或完全等效的方法）是解决您遇到的问题的唯一方法。对不起！（但是，考虑到它的赞美！）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-08-28T10:52:10.400

我知道这是一篇旧文章，但如果有人对服务器有 shell 访问权限（即使是非 root 用户）和 mysql 客户端工具，你也可以这样做

```
myisamchk --recover --ft_min_word_len=2 mytable.MYI 
```

无论如何，您可能必须安排它每天运行以包含新值。

# javascript - 从网络服务器下载任何文件类型

> ID：1024466
> 
> 赞同：0
> 
> 时间：2009-06-21T18:21:32.460
> 
> 标签：javascript, html, download

我需要一个 HTML 页面中的链接，该链接可以使用任何 JavaScript 来“开始下载”我的网络服务器上的普通网页/文件，可以是 PDF / ZIP 等文件类型，也可以只是 PHP / ASP / HTML 的输出。

*我知道这可以通过一些返回mime_content_type*的服务器端下载脚本来实现，以便浏览器根据其配置处理它。（通常是下载）但我真的很想要一个仅限 JavaScript 的解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T18:25:42.653

您根本无法在 javascript 中执行此操作，因为您需要更改 mime 类型标头。您可以做的最好的事情是使用 open('the url') 在另一个窗口中打开它，但我认为这不符合您的需求，并且可能会被弹出窗口阻止程序阻止。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T18:38:02.917

如果要强制浏览器显示“另存为”对话框，我使用以下标题：

```
Content-type: application/octet-stream
Content-Transfer-Encoding: binary
Content-disposition: attachment; filename=test.pdf 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T21:45:07.823

这必须在服务器端完成。要在 Apache 服务器上执行此操作，请将其添加到您的`.htaccess`文件中：`AddType application/octet-stream mp3`其中 mp3 是需要下载的文件类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T18:27:20.623

正如 Fabien 指出的那样，您将需要使用网络服务器来提供文件。例如，使用 ASP，您可以在提供文件之前给文件一个内容类型：

```
Response.contenttype = "application/octet-stream" 
```

# permissions - 在 Program Files 中运行的命令行实用程序的 Vista 权限被拒绝

> ID：1024469
> 
> 赞同：1
> 
> 时间：2009-06-21T18:25:00.567
> 
> 标签：permissions, windows-vista

我正在尝试向 Visual Studio 添加一个工具，它是一个 DOS 命令行实用程序。

命令行参数需要配置文件的路径。似乎无论我尝试将这个配置文件存储在哪里，命令行实用程序都无法获得打开文件的权限。

我试过了

```
C:\ProgramData\Utilities\JavascriptLint\
C:\Users\<myusername>\AppData\Local\Utilities\JavaScriptLint\
C:\Users\<myusername>\AppData\Roaming\Utilities\JavaScriptLint\ 
```

我尝试了程序文件夹。我尝试设置安全性以允许所有人访问，但仍然不好。

我阅读了有关符号链接和连接问题的信息，因此我使用它`CMD dir /Al`来查找真正的文件夹。为了让这个简单的命令实用程序在 Visual Studio 中工作，我正在撕扯我留下的一点点头发。不应该这么难！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-01-31T18:42:45.523

（在评论中回答。转换为社区 wiki 答案。请参阅[没有答案的问题，但问题已在评论中解决（或在聊天中扩展）](https://meta.stackoverflow.com/questions/251597/question-with-no-answers-but-issue-solved-in-the-comments)）

OP写道：

> 我通过不尝试在`:\Program Files(86)\`文件夹空间中执行命令行实用程序来运行它。这必须需要某种 Visual Studio 无法提供的管理员权限。

# php - 在 PHP 中生成任意长度的有序（加权）组合

> ID：1024471
> 
> 赞同：4
> 
> 时间：2009-06-21T18:25:49.287
> 
> 标签：php, algorithm, combinations

给定一个按普遍使用顺序排序的常用词列表，是否有可能按照“最常用”序列的顺序形成任意长度（任何所需数量的词）的词组合。例如，如果最常见的词是“a, b, c”，那么对于长度为 2 的组合，将生成以下内容：

```
aa
ab
ba
bb
ac
bc
ca
cb
cc 
```

这是长度 3 的正确列表：

```
aaa
aab
aba
abb
baa
bab
bba
bbb
aac
abc
bac
bbc
aca
acb
bca
bcb
acc
bcc
caa
cab
cba
cbb
cac
cbc
cca
ccb
ccc 
```

对于任意数量的元素的 2 或 3 个单词（设置长度）的组合，这很容易实现，但是可以对任意长度执行此操作吗？我想在 PHP 中实现它，但非常感谢伪代码甚至算法摘要！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T17:05:49.040

这是一个可能是您需要的递归函数。这个想法是，当给定一个长度和一个字母时，首先生成所有短一个字母但不包括该字母的序列。将新字母添加到末尾，您就有了涉及该字母的序列的第一部分。然后将新字母向左移动。循环浏览每个字母序列，*包括*右边的新字母。

所以如果你有 gen(5, d) 它会从

```
(aaaa)d
(aaab)d
...
(cccc)d 
```

然后当它完成交流组合时，它会做

```
(aaa)d(a)
...
(aaa)d(d)
(aab)d(d)
... 
(ccc)d(d) 
```

然后当它完成 d 作为第 4 个字母时，它会将其移动到第 3 个

```
(aa)d(aa) 
```

等等等等

```
<?php 
/** 
 * Word Combinations (version c) 6/22/2009 1:20:14 PM 
 * 
 * Based on pseudocode in answer provided by Erika: 
 *   http://stackoverflow.com/questions/1024471/generating-ordered-weighted-combinations-of-arbitrary-length-in-php/1028356#1028356 
 *   (direct link to Erika's answer) 
 * 
 * To see the results of this script, run it: 
 *   http://stage.dustinfineout.com/stackoverflow/20090622/word_combinations_c.php 
**/ 

init_generator(); 

function init_generator() { 
    global $words; 
    $words = array('a','b','c'); 
    generate_all(5);

} 

function generate_all($len){
    global $words;
    for($i = 0; $i < count($words); $i++){
        $res = generate($len, $i); 

        echo join("<br />", $res);  
        echo("<br/>");
    }   
}

function generate($len, $max_index = -1){ 
    global $words; 

    // WHEN max_index IS NEGATIVE, STARTING POSITION 
    if ($max_index < 0) { 
        $max_index = count($words) - 1; 
    } 

    $list = array(); 

    if ($len <= 0) { 
        $list[] = "";
        return $list; 
    } 

    if ($len == 1) { 

        if ($max_index >= 1) { 
            $add = generate(1, ($max_index - 1));
            foreach ($add as $addit) { 
                $list[] = $addit; 
            } 

        } 
        $list[] = $words[$max_index]; 
        return $list; 
    } 

    if($max_index == 0) { 
        $list[] = str_repeat($words[$max_index], $len); 
        return $list; 
    } 

    for ($i = 1; $i <= $len; $i++){ 
        $prefixes = generate(($len - $i), ($max_index - 1)); 
        $postfixes = generate(($i - 1), $max_index); 
        foreach ($prefixes as $pre){ 
            //print "prefix = $pre<br/>";
            foreach ($postfixes as $post){ 
                //print "postfix = $post<br/>";
                $list[] = ($pre . $words[$max_index] . $post); 
            } 
        } 
    } 
    return $list; 
} 

?> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T18:42:18.133

我搜索了 php 排列并得到：[http ://www.php.happycodings.com/Algorithms/code21.html](http://www.php.happycodings.com/Algorithms/code21.html)

我还没有研究过代码是否好。但它似乎做你想做的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T18:48:00.700

我不知道您要计算的内容是什么术语，但它不是组合甚至排列，而是某种重复排列的排列。

下面我附上了一些稍微修改过的代码，这些代码来自我身边最近的东西，它做这样的事情，LPC 中的字符串置换生成器。对于 a, b, c 它生成

```
abc
bac
bca
acb
cab
cba 
```

可能可以对其进行调整以启用您想要的重复行为。

```
varargs mixed array permutations(mixed array list, int num) {
    mixed array out = ({});
    foreach(mixed item : permutations(list[1..], num - 1))
        for(int i = 0, int j = sizeof(item); i <= j; i++)
            out += ({ implode(item[0 .. i - 1] + ({ list[0] }) + item[i..], "") });
    if(num < sizeof(list))
        out += permutations(list[1..], num);
    return out;
} 
```

FWIW，说明您的问题的另一种方式是，对于 N 个元素的输入，您希望在一个以输入元素作为节点的全连接、自连接图中的长度为 N 的所有路径的集合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T19:14:45.537

我假设当说固定长度很容易时，您使用的是*m*嵌套循环，其中*m*是序列的长度（在您的示例中为 2 和 3）。

您可以像这样使用递归：

您的单词编号为 0、1、.. n，您需要生成所有长度为*m*的序列：

```
generate all sequences of length m:
{
    start with 0, and generate all sequences of length m-1
    start with 1, and generate all sequences of length m-1
    ...
    start with n, and generate all sequences of length m-1 
}

generate all sequences of length 0
{
    // nothing to do
} 
```

如何实施？好吧，在每次调用中，您可以再将一个元素推到数组的末尾，当您到达递归的末尾时，打印出数组的内容：

```
// m is remaining length of sequence, elements is array with numbers so far
generate(m, elements)
{
    if (m == 0)
    {
        for j = 0 to elements.length print(words[j]);
    }
    else
    {
        for i = 0 to n - 1
        {
            generate(m-1, elements.push(i));
        }   
    }
} 
```

最后，这样称呼它： generate(6, array())

# c# - 如何在 C# 中绘制流数据图形

> ID：1024472
> 
> 赞同：2
> 
> 时间：2009-06-21T18:26:24.730
> 
> 标签：c#, events, charts, serial-port

我需要绘制流数据（9600 波特），它来自串行端口的 2-4 字节数据包。数据包需要在绘图之前进行处理。目前，我正在对每个完整的数据包提出一个事件，这会导致图形表单出现响应问题。

这是解决此问题的最佳方法：

*   以定时间隔（即 500 毫秒）缓冲数据并在事件中引发缓冲数据
*   构建缓冲区并在轮询时让实例化对象轮询缓冲数据/空缓冲区
*   其他 （？）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T20:36:15.557

我肯定会限制更新率。对于此类应用，通常每 300ms 一个就足够了。

基于此，一个好的实现将是一个读取串行端口并将其添加到缓冲区的工作线程。UI 线程可以使用计时器来查询数据并更新显示。

使用单独的线程，工作线程可以以更高的优先级运行，因此负载峰值可能会延迟显示更新，但不会丢失数据。

另一个技巧是不使用固定计时器，而是在更新完成后重新启动计时器。因此，如果更新需要大量时间，例如由于系统负载高，您的更新速度会减慢，从而有效地减少负载。

# python - 在 genshi 模板中解析来自 py:match 的相对路径

> ID：1024475
> 
> 赞同：0
> 
> 时间：2009-06-21T18:28:47.017
> 
> 标签：python, relative-path, genshi

```
<py:match path="foo">
    <?python
        import os
        href = select('@href').render()
        SOMEWHERE = ...  # what file contained the foo tag?
        path = os.path.abspath(os.path.join(os.path.dirname(SOMEWHERE), href)
        f = file(path,'r')
        # (do something interesting with f)
    ?>
</py:match>
...
<foo href="../path/relative/to/this/template/abcd.xyz"/> 
```

上面的“某处”应该是什么？我希望该`href`属性与其中包含`foo`标签的文件相关，就像`href`其他标签上的属性一样。

或者，哪个文件包含 py:match 块？这不太好，因为它可能与带有`foo`标签的文件位于不同的目录中。

更糟糕的是：我可以提供我正在渲染的文件的路径作为来自 Genshi 外部的上下文参数，但这可能位于与上述两个不同的目录中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-20T16:09:39.997

您需要确保驱动程序（即解析输入文件的 Python 程序）在包含`foo`标记的文件的目录中运行。否则，您需要将相对路径（即如何从读取器运行的目录获取到正在读取的文件的目录）作为上下文参数传递给您的 Python 代码并将其添加到`os.path.join`命令中。

通过这个设置（并使用通过 Fink 包 genshi-py26 安装在 MacOS X 10.6.3 上的 Genshi 0.6），该命令`os.getcwd()`返回包含该`foo`标签的文件的当前工作目录。

对于如此复杂的路径结构，我也强烈建议使用`path=os.path.normpath(path)`，因为您可能不希望这些东西在生成的 HTML 代码中泄漏。

# nhibernate - NHibernate - 更新身份字段

> ID：1024477
> 
> 赞同：1
> 
> 时间：2009-06-21T18:29:25.363
> 
> 标签：nhibernate

我们可以像下面这样更新 NHibernate 中的 Id 字段吗？

```
MyClass myObj = MyClass.Retrieve(1);

myObj.Id = 999;
myObj.Name = "name name";
myObj.Value = 1000;

MyClass.Update(myObj); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T19:51:59.097

您永远不应更改现有对象的标识符（主键）。使用 NHibernate，如果您已将[生成器](http://nhforge.org/doc/nh/en/index.html#mapping-declaration-id-generator)映射为“已分配”，则应仅在新对象上分配标识符。如果您打算克隆现有对象，则检索该对象并将克隆创建为新实例，以便分配新标识符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:26:06.370

像这样的东西会起作用：

```
ISession.Delete(yourClass);
yourClass.Id = somethingelse;
ISession.Save(yourClass); 
```

为什么要更改标识符？这听起来像是一件非常糟糕的事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T19:57:48.287

您可以关闭会话，执行原始 sql 更改主键，然后打开一个新会话。这是唯一作为 nhibername 工作的东西依赖于主键身份。你将*永远*无法让 nhibernate 做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-02T13:48:57.553

我必须`Evict`在删除后添加一个然后工作。

像这样的东西会起作用：

```
 ISession.Delete(yourClass);
    yourClass.Id = somethingelse;
    ISession.Save(yourClass); 
```

为什么要更改标识符？这听起来像是一件非常糟糕的事情。

这就是我所做的：

```
ISession.Delete(yourClass);
ISession.Evict(yourClass);
yourClass.Id = somethingelse;
ISession.Save(yourClass); 
```

# php - 如何使数据库等中的所有时间都采用 UTC 并且整个视图部分都在本地时区？

> ID：1024478
> 
> 赞同：0
> 
> 时间：2009-06-21T18:30:10.870
> 
> 标签：php, zend-framework

从一封电子邮件中，我得到“Sun, 21 Jun 2009 20:21:13 +0200” 作为时间我如何让 strtotime 输出它的通用时间？哪个是 18:21:13？我想在 UTC+2 中有视图部分（至少现在应该遵循 :)）。我如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T18:39:21.183

```
<?php
$ts = strtotime('Sun, 21 Jun 2009 20:21:13 +0200');
echo gmdate('D, d M y H:i:s'); // DATE_RFC822 without O
```

印刷

```
09 年 6 月 21 日星期日 18:36:27
```

见[http://php.net/gmdate](http://php.net/gmdate)

# java - 在等待来自套接字的输入时阻塞的停止/中断线程

> ID：1024482
> 
> 赞同：14
> 
> 时间：2009-06-21T18:32:56.230
> 
> 标签：java, multithreading

正如标题所说，我需要一种方法来停止或中断被阻塞等待来自套接字的输入的线程。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-21T18:42:03.080

您可以简单地关闭（）来自另一个线程的 IO 流/套接字。然后，如果生成的 IOException 是由于关闭或其他原因，您可以检查 volatile 布尔字段。我认为关闭可能会导致`java.net.SocketException: Socket closed`异常。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-21T18:39:03.007

[Thread.interrupt()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#interrupt())应该是您正在寻找的方法。确保您的输入访问方法也检查 InterruptedException 和 ClosedByInterruptException。

[另请参阅 Sun Concurrency Tutorial 中](http://java.sun.com/docs/books/tutorial/essential/concurrency/interrupt.html)的相应页面，正如另一个解决方案所建议的那样。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-21T18:39:02.103

套接字允许通过该`setSoTimeout()`方法设置超时。这是阻止它们阻塞的首选方法。

否则，您可能希望查看`nio`允许非阻塞 I/O 的包，但代价是需要更多手动工作来管理传入和传出数据。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-11-21T23:17:00.923

我没看到`socket.closeInput()`。但是，我确实找到了`socket.shutdownInput()`. 在调用它之后（从一个自然阻塞读取的不同线程），我的调用`bufferedReader.close()`工作正常！（我随后调用了`printWriter.close()`and `socket.close()`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-01T22:48:59.657

尝试使用 sock.closeInput() 后跟 sock.close()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-27T08:26:36.357

关闭套接字，读取将被解除阻塞（将以 IOException 的子类退出）。读取响应 Thread.interrupt 取决于平台（例如，在 Solaris 10 上不起作用）。

# optimization - 优化对数据结构的递归调用

> ID：1024484
> 
> 赞同：2
> 
> 时间：2009-06-21T18:35:02.017
> 
> 标签：optimization, data-structures, recursion

是否有一种算法可以将高度递归的函数优化为对数据结构的迭代？例如，给定以下函数...

```
// template <typename T> class BSTNode is defined somewhere else
// It's a generic binary search tree.
template <typename T, typename R>
void in_order(BSTNode<T>* root, R (*routine)(T))
{
    if (root)
    {
        in_order(root->leftChild);
        routine(root->data);
        in_order(root->rightChild);
    }
} 
```

...是否可以将其优化为...

```
// template <typename> class Stack is defined somewhere else
// It's a generic LIFO array (aka stack).

template <typename T, typename R>
void in_order(BSTNode<T>* root, R (*routine)(T))
{
    if (!root) return;

    Stack<BSTNode*> stack;
    stack.push(NULL);

    line1:
    while (root->leftChild)
    {
        stack.push(root);
        root = root->leftChild;
    }

    line2:
    routine(root->data);
    if (root->rightChild)
    {
        root = root->rightChild;
        goto line1;
    }

    else if (root = stack.pop())
        goto line2;
} 
```

（当然不同的是，后者不是填充调用堆栈，而是填充堆中的另一个堆栈。）

* * *

**编辑：**我的意思是可以由*编译器*执行的算法，所以我不必手动优化它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T18:50:08.420

是的，你可以这样做。

然而，除了可能用非常深的树耗尽堆栈空间之外，这里没有“优化”。如果您需要提高速度，请考虑改为[线程化您的树。](http://en.wikipedia.org/wiki/Threaded_binary_tree)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T18:57:42.243

我遇到的唯一通用递归优化是优化尾递归。这经常在函数式语言中完成，并且基本上涉及编译器/解释器将最终操作是递归调用的函数更改为完全迭代的函数（因此堆栈没有问题等）。

对于其他形式的递归，我不知道已经找到/创建了任何用于将它们优化为迭代函数的通用算法。您当然可以始终以迭代的方式表达这些功能，但转换不是通用的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-28T09:15:33.947

您要求使用去功能化的延续进行[延续](http://en.wikipedia.org/wiki/Defunctionalization)[传递式](http://en.wikipedia.org/wiki/Continuation-passing_style)转换；它在[《编程语言要点》的](https://rads.stackoverflow.com/amzn/click/com/0262062798)第 6 章中进行了介绍，并使用了 Scheme 中的代码。但是为 C++ 实现将是一个巨大的痛苦。但是，如果您有一个编译器前端，可以将 C++ 转换为可合理访问的数据结构，并且您需要对*大量*代码执行此操作。这本书还解释了如何手动系统地进行这种转换，这在您的情况下更有可能是实用的。

 ** * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T21:44:37.853

可以迭代地遍历可变的有序树，方法是在您采用的分支中记录节点的父节点，并知道您从（向下，或从左侧或右侧向上）接近节点的方向，树的有序属性允许你测试）：

```
template <typename T, typename R>
void in_order ( BSTNode<T>* root, R (*routine)(T) ) {
    typedef BSTNode<T>* Node;

    Node current = root;
    Node parent  = 0;

    bool going_down = true;

    while ( current ) {
        Node next = 0;

        if ( going_down ) {
            if ( current -> leftChild ) {
                // navigate down the left, swapping prev with the path taken
                Node next_child = current -> leftChild;
                current -> leftChild = parent;
                parent = current;
                current = next_child;
            } else if ( current -> rightChild ) {
                // navigate down the right, swapping prev with the path taken
                Node next_child = current -> rightChild;
                current -> rightChild = parent;
                parent = current;
                current = next_child;
            } else {
                // leaf
                routine ( current -> data );
                going_down = false;
            }
        } else {
            // moving up to parent
            if ( parent ) {
                Node next_parent = 0;

                // came from the left branch
                if ( parent -> data > current -> data ) {
                    // visit parent after left branch
                    routine ( parent -> data );

                    // repair parent
                    next_parent = parent -> leftChild;
                    parent -> leftChild = current;

                    // traverse right if possible
                    if ( parent -> rightChild ) {
                        going_down = true;
                        // navigate down the right, swapping prev with the path taken
                        Node next_child = parent -> rightChild;
                        parent -> rightChild = next_parent;
                        //parent = current;
                        current = next_child;
                        continue;
                    }
                } else {
                    // came from the right branch
                    next_parent = parent -> rightChild;
                    parent -> rightChild = current;
                }

                current = parent;
                parent = next_parent;
            } else {
                break;
            }
        }
    }
} 
```

如果不是存储子节点，而是存储父节点和子节点的 XOR，那么您可以从接近的任何方向获取下一个节点，而无需改变树。

我不知道任何自动将非尾递归函数转换为此类代码的东西。我确实知道在堆上分配调用堆栈的环境，在您无法执行此类突变并且具有固定的小堆栈大小的情况下，它可以透明地避免堆栈溢出。通常在堆栈上记录状态比调用堆栈占用更少的空间，因为您只选择要记录的基本本地状态，而不是记录返回地址或任何调用者保存寄存器（如果您使用的是仿函数而不是函数指针，那么编译器更有可能能够内联`routine`，因此在简单的递归情况下不保存调用者保存寄存器，因此减少了每次递归所需的堆栈量。 YMMV ）。

由于您使用的是模板，您应该只需要执行一次遍历代码，并将其与策略模板结合以在 pre、post 和 inorder 之间切换，或者您想要的任何其他迭代模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T18:49:08.700

从技术上讲，答案是“是”：任何可以递归表达的算法（即使用隐式堆栈）也可以重新制定以使用迭代（即使用显式堆栈或其他跟踪结构）。

但是，我怀疑大多数编译器不能或不会尝试为您执行此操作。想出一个通用的自动算法来执行转换可能相当困难，虽然我从未尝试过，所以我不应该说它是棘手的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-21T19:35:12.810

可以在不使用递归的情况下深度优先遍历树。

一个很好的例子如下：[http](http://code.activestate.com/recipes/461776/) ://code.activestate.com/recipes/461776/ 。

不过，编译器不会为您进行此优化。然而，这个概念并不难掌握。您正在做的是自己创建调用堆栈和节点列表，而不是使用函数调用来更深入地了解树。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-21T18:47:52.587

> 当然，不同之处在于，后者不是填充调用堆栈，而是填充堆中的另一个堆栈。

你自己回答了。什么更便宜，堆栈还是堆？（除非您的堆栈空间不足）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-22T11:35:16.700

当然，您可以制作自己的堆栈。

你要速度吗？除非`routine(root->data)`几乎什么都不做，否则您永远不会注意到差异。*

# ftp - 自动文件上传

> ID：1024488
> 
> 赞同：4
> 
> 时间：2009-06-21T18:36:36.133
> 
> 标签：ftp, sftp

有什么办法，有什么免费的软件可以自动上传文件吗？假设我使用我最喜欢的 IDE 在本地计算机上编辑 php 代码。我不会改变我的IDE，它很棒。我想要一些可以检测到我的项目目录中的文件已更改并使用 FTP/SFTP 将其上传到远程服务器的东西。就是这样——就这么简单。

我已经尝试过的：

FTPDrive + FileSync Eclipse 插件 - 速度很慢，经常上传所有文件，在 Vista 和 Windows 7 下运行错误。

WinSCP自动同步——又出bug，拒绝随机上传文件。如果它工作正常将是最好的。

Eclipse 的原生 SFTP 支持 - 没用！您不能使用具有此功能的 PDT 项目。没有项目的 PDT 并不比 Notepad++ 好。

Aptana FTP 功能。比手动还差！天哪，糟透了！

在 windows 下运行我自己的 PHP/MySQL 服务器。首先，我花了很长时间来设置它，然后，它并不能完全作为我的生产环境工作——我无法正确测试我的代码。

它应该如何工作？我在这里更改文件，然后上传到那里。最好是它安静地放在托盘中，并且只有在发生上传错误时才打扰我。

好吧，如果它不是免费的，也许至少有一些便宜的东西？

如果没有类似的东西，是否有类似 FTPDrive 的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T18:48:13.070

[rsync](http://www.samba.org/rsync/)完全符合您的要求。

好吧，几乎：它不会监视您的文件系统并自动上传文件-您必须设置一个任务以每分钟或任何时间运行它。但它确实有效地只上传了更改。如果您在 Linux 上，[lsyncd](http://code.google.com/p/lsyncd/)会执行监视部分并驱动 rsync 执行有效的上传部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T18:47:49.810

在 Rails 世界中，我们倾向于使用源代码控制和部署工具，如 vlad 或 capistrano。它比 FTP 更安全、更一致。这是关于如何将它与 svn 和 php 一起使用的指南[http://www.simplisticcomplexity.com/2006/08/16/automated-php-deployment-with-capistrano/](http://www.simplisticcomplexity.com/2006/08/16/automated-php-deployment-with-capistrano/)。

你真的应该尝试让你的开发服务器在你的个人机器上运行。这是一种更好的方法，值得尝试使其工作的最初痛苦。那里有很好的教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T18:50:25.097

您可以使用[WebDrive](http://www.webdrive.com/)或[ExpanDrive](http://www.expandrive.com)，将完整的远程目录挂载为本地磁盘驱动器并直接在服务器上编辑您的文件。然而，这在很大程度上取决于您的连接以及您的工具是如何编写的。另一种方法是使用其中一个工具，并使用另一个工具异步同步所有更改。

# c++ - 使用 Google Perf 工具和动态库分析 C++

> ID：1024504
> 
> 赞同：3
> 
> 时间：2009-06-21T18:46:49.047
> 
> 标签：c++, debugging, profiling

我正在尝试分析一个我没有编写的 C++ 应用程序，以了解主要计算点的位置。我不是 C++ 专家，更不是 C++ 调试/分析专家。我相信我遇到了动态库的（常见？）问题。

我使用（OS X，G++）编译到[Google CPU Profiler的链接：](http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html)

```
env LIBS=-lprofiler ./configure
make
make install 
```

然后我运行配置文件安装的应用程序（jags）：

```
env CPUPROFILE=./jags.prof /usr/local/bin/jags regression.cmd
pprof /usr/local/bin/jags jags.prof 
```

不幸的是，我得到了错误：

```
pprof /usr/local/bin/jags jags.prof 无法执行“objdump”：
/usr/local/bin/pprof 第 2833 行没有这样的文件或目录。

objdump /System/Library/Frameworks/Accelerate.framework/Versions/A/
Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib：没有这样的文件或目录

```

该程序动态链接到 libLAPACK.dylib。所以`prof`好像没看懂（？）。我想过尝试静态链接，但与程序相关的文档说在 LAPACK 或 BLAS（两个必需的库）中无法静态链接。

有没有办法让分析器忽略 libLAPACK？如果它不在 libLAPACK 中采样，我没关系。或者我怎样才能让分析工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T20:02:59.540

此错误是由 jags 是一个 shell 脚本引起的，该脚本随后称为可分析代码。

```
pprof /usr/local/bin/REAL_EXEC jags.prof 
```

解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T19:05:35.897

我没有看到一个干净的方法来做到这一点，但也许有一个 hacky 解决方法 - 如果你破解 pprof perl 脚本（或更好的副本；-）会发生什么，第 2834 行，而不是调用`error`它发出消息然后`return undef;`呢？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T22:02:28.723

如果您在 OSX 上进行分析，[Shark](http://developer.apple.com/tools/shark_optimize.html)工具也非常棒。它使用起来非常简单，并且在我尝试过时对我来说是开箱即用的。

# delphi - Delphi中是否需要将字符串转换为WideString？

> ID：1024515
> 
> 赞同：21
> 
> 时间：2009-06-21T18:50:30.383
> 
> 标签：delphi, string, widestring

我找到了一个执行字符串“自然比较”的 Windows API 函数。定义如下：

```
int StrCmpLogicalW(
    LPCWSTR psz1,
    LPCWSTR psz2
); 
```

为了在 Delphi 中使用它，我这样声明：

```
interface
  function StrCmpLogicalW(psz1, psz2: PWideChar): integer; stdcall;

implementation
  function StrCmpLogicalW; external 'shlwapi.dll' name 'StrCmpLogicalW'; 
```

因为它比较[Unicode](http://en.wikipedia.org/wiki/Unicode)字符串，所以当我想比较 ANSI 字符串时，我不确定如何调用它。将字符串转换为 WideString 然后转换为 PWideChar 似乎就足够了，但是，我不知道这种方法是否正确：

```
function AnsiNaturalCompareText(const S1, S2: string): integer;
begin
  Result := StrCmpLogicalW(PWideChar(WideString(S1)), PWideChar(WideString(S2)));
end; 
```

我对字符编码知之甚少，所以这就是我提出问题的原因。这个函数可以吗，还是我应该先以某种方式转换两个比较的字符串？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-22T07:18:29.027

请记住，将字符串转换为 WideString 将使用默认系统代码页将其转换，这可能是您需要的，也可能不是您需要的。通常，您希望使用当前用户的语言环境。

从`WCharFromChar`System.pas 中：

```
Result := MultiByteToWideChar(DefaultSystemCodePage, 0, CharSource, SrcBytes,
  WCharDest, DestChars); 
```

您可以通过调用[SetMultiByteConversionCodePage](http://docs.embarcadero.com/products/rad_studio/delphiAndcpp2009/HelpUpdate2/EN/html/delphivclwin32/System_SetMultiByteConversionCodePage.html)来更改 DefaultSystemCodePage 。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-03T18:32:44.930

完成任务的更简单方法是将函数声明为：

```
interface
   function StrCmpLogicalW(const sz1, sz2: WideString): Integer; stdcall;

implementation
   function StrCmpLogicalW; external 'shlwapi.dll' name 'StrCmpLogicalW'; 
```

因为`WideString`变量*是*指向 a 的指针`WideChar`（就像`AnsiString`变量*是*指向 a 的指针一样`AnsiChar`）

这样，Delphi 会自动`WideString`为您将 AnsiString“上转换”为 a。

# 更新

而且由于我们现在处于 的世界中`UnicodeString`，因此您可以：

```
interface
   function StrCmpLogicalW(const sz1, sz2: UnicodeString): Integer; stdcall;

implementation
   function StrCmpLogicalW; external 'shlwapi.dll' name 'StrCmpLogicalW'; 
```

因为`UnicodeString`变量仍然是指向`\0\0`终止字符串的指针`WideChars`。所以如果你打电话：

```
var
    s1, s1: AnsiString;
begin
    s1 := 'Hello';
    s2 := 'world';

    nCompare := StrCmpLogicalW(s1, s2);
end; 
```

当您尝试将 a 传递给`AnsiString`接受 a 的函数时，编译器将在生成的代码中`UnicodeString`自动为您调用。`MultiByteToWideChar`

## CompareString 支持 Windows 7 中的数字排序

从 Windows 7 开始，Microsoft 添加`SORT_DIGITSASNUMBERS`了[`CompareString`](http://msdn.microsoft.com/en-us/library/windows/desktop/dd317759(v=vs.85).aspx)：

> **Windows 7：**在排序过程中将数字视为数字，例如将“2”排在“10”之前。

这些都不能帮助回答*实际*问题，该问题涉及何时必须转换或强制转换字符串。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T19:22:10.997

您的函数可能有一个 ANSI 变体（我尚未检查）。大多数 Wide API 也可以作为 ANSI 版本使用，只需将 W 后缀更改为 A，就可以了。在这种情况下，Windows 会透明地为您进行来回转换。

PS：这是一篇描述缺少 StrCmpLogicalA 的文章：http: [//blogs.msdn.com/joshpoley/archive/2008/04/28/strcmplogicala.aspx](http://blogs.msdn.com/joshpoley/archive/2008/04/28/strcmplogicala.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-20T18:03:21.993

Use [`System.StringToOleStr`](http://docwiki.embarcadero.com/VCL/en/System.StringToOleStr)，这是一个方便的包装器`MultiByteToWideChar`，请参阅[Gabr 的回答](https://stackoverflow.com/a/1025852/757830)：

```
function AnsiNaturalCompareText(const S1, S2: string): integer;   
var
  W1: PWideChar;
  W2: PWideChar;
begin
  W1 := StringToOleStr(S1);
  W2 := StringToOleStr(S2);
  Result := StrCmpLogicalW(W1, W2);
  SysFreeString(W1);
  SysFreeString(W2);
end; 
```

但是，[Ian Boyd 的解决方案](https://stackoverflow.com/a/10437339/757830)看起来更好！

# cakephp - 在 CakePHP 布局中创建类似于 WordPress 小部件或 Drupal 块的区域的最佳方法是什么？

> ID：1024518
> 
> 赞同：1
> 
> 时间：2009-06-21T18:53:04.217
> 
> 标签：cakephp

在布局中创建类似于 Wordpress 的小部件或 Drupal 块的区域的最佳方法是什么？在 CakePHP 中这样做的最佳实践方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T19:45:34.083

如果你说的区域是一个特殊的“内容容器”（从未使用过 WP/Drupal），那么这很容易。

有几种方法可以做到这一点，但我首先想到的是：

1.  创建一个助手（或整个插件）来处理“哪些内容进入哪个容器”逻辑。做起来应该不会太难，因为您有许多 Cake 实用程序类可以帮助您解决这个问题（例如[Configure 类](http://api.cakephp.org/class/configure)）。这显然应该由最终用户配置。
2.  在布局中创建容器，例如：

    > ```
    > <div class="content-container" id="content-container-left">
    >     <?php echo $yourHelper->outputContent("left"); ?>
    > </div> 
    > ```

3.  两种选择：

    *   内容应基于元素；或者
    *   内容应该基于自定义插件（实际上是做他们的事情并输出内容）

**注意**：可能有更好的方法来完成你想要的，这只是我想到的第一个。在您实际编写任何代码之前，我建议您进行一些纸笔计划，这将提高您为您的应用程序找到最佳方式的机会。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-16T00:59:58.650

我最近创建了一个侧边栏助手，您可能会觉得它很有用。

您在 Cake 元素中定义框的内容，然后通过调用...

```
$sidebar->addBox(array('element'=>'my_sidebox_element'); 
```

...这将呈现views/elements/my_sidebox_element的内容

或者，您可以指定框“内联”的内容：

```
$sidebar->startBox(array('title' => 'My Inline Box'));
<p>blah <b>blah</b> <span>blah</span></p>
$sidebar->endBox(); 
```

在您的布局文件中调用

```
echo $sidebar->getSidebar(); 
```

...并且您的每个框都将呈现为 div

从技术上讲，这不需要用作“侧边栏”——它最终取决于您如何使用 CSS 呈现布局。

有关更多详细信息，请参阅文档化代码：

[GitHub 上的 SidebarHelper](http://github.com/ebotunes/cakephp/blob/e718751b63cf3bf7a38e35e24c69f0207d4d2cf3/helpers/sidebar.php)

# date - 不存在的日期上的重复日期

> ID：1024519
> 
> 赞同：0
> 
> 时间：2009-06-21T18:53:07.150
> 
> 标签：date, recurrence, least-astonishment

当给出某种选择以重新发生的每一定时间时，我应该如何处理在每个间隔上不再重复发生的时间？

例如，2 月 29 日的生日提醒应该如何处理？或者，如果我在 31 日进行了每月约会，那么在没有 31 日的月份会发生什么？

您认为合理的用户会期望什么并且[最不惊讶](http://en.wikipedia.org/wiki/Principle_of_least_astonishment)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T18:57:37.923

我对这个问题的第一反应是让用户选择如果它落在那个日期该怎么办（转到第二天，跳过这一天等）。

但是要直接回答您的问题，我相信合理的用户对“跳过”日的前一天发生的事件不会感到惊讶。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T18:59:44.520

我认为您可以很容易地标记这样的日期。我能想到的唯一日期是一个月的 29 日、30 日和 31 日，或者 2 月 29 日。

当用户选择每月（或每年 2 月 29 日）提醒这些日期之一时，您可以提示他们选择这些月份的替代日期。

此外，您可以选择“在每个月的最后一天”收到通知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T19:08:28.747

理想情况下，在创建提醒时提示。

如果你坚持下去，我会把它们拉到前面。这是危害最小的选择。您并不总是希望有最小的惊喜，最大程度地减少做出错误选择的危害也很重要。

# bookmarks - 如何制作使页面成为主页或书签的链接？

> ID：1024521
> 
> 赞同：3
> 
> 时间：2009-06-21T18:53:37.773
> 
> 标签：bookmarks

有没有一种简单的方法来创建一个链接？

基本上，我想要一个非常简单的方法来做到这一点。任何建议都是有帮助的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T18:56:49.670

在 IE 中：

```
<a href="javascript:window.external.AddFavorite('http://mysite.com', 'My Site')">Bookmark This Site</a> 
```

在 Firefox 和 IE 中：

```
function addBookmark(title, url) {
        if (window.sidebar) { // firefox
              window.sidebar.addPanel(title, url,"");
        } else if( document.all ) { //MSIE
                window.external.AddFavorite( url, title);
        } else {
               alert("Sorry, your browser doesn't support this");
        }
}

<a href="javascript:addBookmark('My Site','http://www.mysite.com')>Add bookmark</a> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T19:01:17.213

选中[此项](http://www.dynamicdrive.com/dynamicindex9/addbook.htm)以将站点添加到用户的书签

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T19:02:38.787

有一些方法可以使用 Javascript 添加收藏夹，尽管有些浏览器根本不支持它。您可以在[此处](http://www.dynamicsitesolutions.com/javascript/add-bookmark-script/)找到一个脚本，该脚本声称提供了一种添加书签的跨浏览器方法，但实际上只是告诉用户按什么来打开 Firefox 上的“添加书签”对话框。

在所有情况下，javascript 所能做的就是打开添加书签对话框，用户仍然需要自己手动添加书签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T19:13:57.707

您可以使用[此代码](http://javascript.internet.com/page-details/set-homepage-link.html)将您的页面设置为用户的主页。

# java - BlazeDS 和 Spring 至少需要多少 .jar？

> ID：1024523
> 
> 赞同：1
> 
> 时间：2009-06-21T18:54:30.173
> 
> 标签：java, apache-flex, spring, blazeds

我已经设法使用 Spring & BlazeDS 集成在 Eclipse 中创建了一个小项目。一切正常，我的 AMF 请求正在通过，一切都很好。

我只想知道.jar 的最低要求是多少。目前，我有一个清单，其中包含 35 个以上的 jar 文件，这些 jar 文件只需要一个非常基本的应用程序即可工作。

感觉就像我必须包括这么多，做这么少。有没有我可以包含的集体库，而不是这些长长的 .jar 列表？

名单如下：

> ```
>  |__antlr-3.0.1.jar
>   |__aopalliance.jar
>   |__aspectjrt.jar
>   |__aspectjweaver.jar
>   |__backport-util-concurrent.jar
>   |__cglib-nodep-2.1_3.jar
>   |__commons-codec-1.3.jar
>   |__commons-httpclient-3.0.1.jar
>   |__commons-logging.jar
>   |__concurrent.jar
>   |__flex-messaging-common.jar
>   |__flex-messaging-core.jar
>   |__flex-messaging-opt.jar
>   |__flex-messaging-proxy.jar
>   |__flex-messaging-remoting.jar
>   |__h2.jar
>   |__jackson-core-asl-0.9.9-6.jar
>   |__org.springframework.aop-3.0.0.M3.jar
>   |__org.springframework.asm-3.0.0.M3.jar
>   |__org.springframework.aspects-3.0.0.M3.jar
>   |__org.springframework.beans-3.0.0.M3.jar
>   |__org.springframework.context.support-3.0.0.M3.jar
>   |__org.springframework.context-3.0.0.M3.jar
>   |__org.springframework.core-3.0.0.M3.jar
>   |__org.springframework.expression-3.0.0.M3.jar
>   |__org.springframework.flex-1.0.0.RC1.jar
>   |__org.springframework.jdbc-3.0.0.M3.jar
>   |__org.springframework.jms-3.0.0.M3.jar
>   |__org.springframework.transaction-3.0.0.M3.jar
>   |__org.springframework.web.servlet-3.0.0.M3.jar
>   |__org.springframework.web-3.0.0.M3.jar
>   |__spring-security-acl-2.0.4.jar
>   |__spring-security-catalina-2.0.4.jar
>   |__spring-security-core-2.0.4.jar
>   |__spring-security-core-tiger-2.0.4.jar
>   |__spring-security-taglibs-2.0.4.jar
>   |__xalan.jar 
> ```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T19:23:14.287

我们无法确定，但我们可以给您建议：

*   antlr 大概可以走了。Spring 将自己的副本捆绑在自己的 JAR 中
*   aopalliance - 同样的原因
*   aspectj - 你使用的是 Spring 的 aspectJ 吗？如果没有，那就放弃吧。
*   backport - 可以摆脱它，试试看
*   cglib - 一些应用服务器已经有这个，所以你可以从应用中摆脱它
*   公共编解码器 - 可能不需要
*   commons-httpclient - 不需要
*   commons-logging - 已经包含在大多数应用服务器中，不需要
*   concurrent.jar - 这是 java5 并发 API 的旧版本，去掉它。
*   h2.jar - 不知道这是什么
*   jackson - 这是一个 JSON 库。如果你不使用 JSON，你不需要这个
*   org.springframework.aop - 转储它，除非你使用 AOP
*   org.springframework.aspects - 转储它，除非你使用 AOP
*   org.springframework.jdbc - 转储它，除非你使用 JDBC
*   org.springframework.jms - 转储它，除非你使用 JMS
*   org.springframework.transaction - 转储它，除非你正在使用事务
*   spring-security - 你在用这个东西吗？
*   xalan - 你几乎肯定应该转储这个，应用服务器可能已经有副本

所有这些建议都带有健康警告。

# bash - 如何检查 gcc 在 Bash 中是否失败、返回警告或成功？

> ID：1024525
> 
> 赞同：9
> 
> 时间：2009-06-21T18:56:26.257
> 
> 标签：bash, gcc

我将如何检查 gcc 是否已成功编译程序、失败或成功但有警告？

```
#!/bin/sh

string=$(gcc helloworld.c -o helloworld)

if [ string -n ]; then
    echo "Failure"
else
    echo "Success!"
fi 
```

这仅检查它是否成功或（失败或编译时出现警告）。

-n 表示“不为空”。

谢谢！

**编辑**如果不清楚，这是行不通的。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-21T19:03:36.463

你的情况应该是：

```
if [ $? -ne 0 ] 
```

GCC 将在成功时返回零，或者在失败时返回其他值。那行说“如果最后一个命令返回的不是零”。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-06-21T18:59:26.390

```
if gcc helloworld.c -o helloworld; then 
echo "Success!";
else 
echo "Failure"; 
fi 
```

您希望 bash 测试返回码，而不是输出。您的代码捕获标准输出，但忽略 GCC 返回的值（即 main() 返回的值）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-21T21:24:26.163

要区分完全干净编译和错误编译之间的区别，首先正常编译并测试 $?。如果非零，编译失败。接下来，使用 -Werror（警告被视为错误）选项进行编译。测试$？- 如果为 0，则编译时没有警告。如果非零，则编译时带有警告。

前任：

```
gcc -Wall -o foo foo.c
if [ $? -ne 0 ]
then
    echo "Compile failed!"
    exit 1
fi

gcc -Wall -Werror -o foo foo.c
if [ $? -ne 0 ]
then
    echo "Compile succeeded, but with warnings"
    exit 2
else
    echo "Compile succeeded without warnings"
fi 
```

# python - 如何使用充满测试用例的输入文件测试 Python 脚本？

> ID：1024529
> 
> 赞同：2
> 
> 时间：2009-06-21T18:57:59.467
> 
> 标签：python, input

我正在参加在线评委比赛，我想用一个充满测试用例的 .in 文件来测试我的代码，以计时我的算法。如何让我的脚本从这个 .in 文件中获取输入？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T19:31:23.553

所以脚本通常从标准输入获取测试用例，现在您想使用文件中的测试用例进行测试？

如果是这种情况，请`<`在 cmd 行上使用重定向操作：

```
my_script < testcases.in 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:57:07.243

从文件和/或标准输入读取：

```
import fileinput
for line in fileinput.input():
    process(line) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T19:06:44.663

[PyUnit](http://pyunit.sourceforge.net/) “Python 的标准单元测试框架”可能是您正在寻找的。

* * *

做一个像这样的小脚本：

```
#!/usr/bin/env python
import sys

def main():
    in_file = open('path_to_file')
    for line in in_file:
        sys.stdout.write(line)

if __name__ == "__main__":
    main() 
```

并运行为

```
this_script.py | your_app.py 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T20:48:35.033

您可以在单独的文件中执行此操作。

`testmyscript.py`

```
import sys
someFile= open( "somefile.in", "r" )
sys.stdin= someFile
execfile( "yourscript.py" ) 
```

# msdn - MSDN 许可证（开发、测试、演示）

> ID：1024543
> 
> 赞同：8
> 
> 时间：2009-06-21T19:06:43.523
> 
> 标签：msdn

我对我的 MSDN 高级订阅有疑问。这就是我要设置的：

1.  在 Dev Box 上安装 Windows Server 2008（可能是 R2）
2.  在服务器上安装 System Center Virtual Machine Manager 2008（可能是 R2）。
3.  创建多个托管在服务器上的虚拟机（可能还有其他一些机器）。

然后我会使用虚拟机来开发、测试和演示我的软件（仅此而已）

我的问题是，我可以在其中哪些上使用从我的订阅中下载的许可证？我认为#3 显然属于订阅范围，但服务器操作系统许可证是吗？是虚拟机管理器吗？

欢迎任何意见。任何事实（带有支持链接或文档）将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-21T19:16:50.103

从主 MSDN 订阅页面，您可以访问订阅信息。以下内容是从该页面复制的。[“软件使用权”](http://msdn.microsoft.com/en-us/subscriptions/cc150618.aspx)

> MSDN 订阅按用户授予许可。一个人可以使用该软件在任意数量的设备上设计、开发、测试或演示他或她的程序。每个以这种方式使用软件的人都需要许可证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T19:12:48.987

根据这篇维基百科文章：[MSDN](http://en.wikipedia.org/wiki/Microsoft_Developer_Network#Software_subscriptions)

您可以使用您的许可证进行测试和开发，但对于生产级代码，您将需要不同的许可证。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T19:40:54.577

在这种情况下，如果有疑问，我会打电话给微软。他们应该能给你一个明确的答案。

但就许可证而言，它看起来不是问题，我最好的猜测是你实际上可以安装主机操作系统、SCVMM 和其他所有东西，只要你将该服务器纯粹用于软件开发。IANAL，所以如果你想得到一个明确的答案：打电话给微软。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-14T00:52:08.550

除了 Kim Major 的回答之外，由于每个用户的限制（例如，开发 SQL Server 的每个人都需要 MSDN 许可证），因此可能值得通过合作伙伴网络研究[Microsoft Action Pack 订阅。](https://mspartner.microsoft.com/en/us/pages/membership/action-pack-dev-design.aspx)有一些非常具体的资格要求，但对于使用 Microsoft 产品开发解决方案的小型开发商店来说，它确实很有用。随着您作为一个组织的成长，您将获得银牌和金牌认证。

基本前提是，Microsoft 为开发人员提供超值订阅，并在您的客户为部署您的解决方案的生产许可证付费时获得他们的报酬。

再次检查资格以确保您符合资格。围绕这个产品有很多误解。

# c# - 如果 DataKeyNames 设置为未定义为主键的字段，则...

> ID：1024549
> 
> 赞同：0
> 
> 时间：2009-06-21T19:10:10.210
> 
> 标签：c#, asp.net, data-binding, gridview

1）我注意到，如果我将*GridView.DataKeyNames*设置为实际上未定义为数据源中的主键的字段，数据源控件（或者可能是 GridView？）将以某种方式知道*DataKeyNames*中设置的字段并不是真正的主键钥匙。*当我打开配置选择语句*窗口（通过 *GridView 的智能任务弹出 --> 配置数据源 --> 配置选择语句窗口 --> 高级*）并且窗口禁用了两个单选按钮时，我意识到了这一事实 。

a) 那么 Asp.Net 是如何“弄清楚”在*DataKeyNames*中设置的字段实际上不是主键的呢？

b）此外，是否应该由程序员将*DataKeyNames*设置为她选择的任何字段，即使该字段未定义为数据源中的主键？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T19:46:41.743

好吧，DataKeyNames 属性的目的是唯一标识数据集中的每个数据行。为此，ASP.NET 需要 100% 确保它确实是您提供的唯一标识列（或一组列），并且唯一可以真正检查的是表的主键 - 这将始终是唯一标识一行（这就是主键的定义）。

我想这就是 ASP.NET 坚持使用 DataKeyNames 的主键的原因——任何其他列（或一组列）都无法真正检查其有效性——所以最好拒绝它们而不是遇到问题。不是唯一标识键......

马克

# php - 从 php 调用 Web 服务？

> ID：1024550
> 
> 赞同：0
> 
> 时间：2009-06-21T19:11:38.927
> 
> 标签：php, web-services

我正在尝试从 PHP 网页调用公开可用的 Web 服务。

网络服务是：[http ://www.webservicex.net/uszip.asmx?WSDL](http://www.webservicex.net/uszip.asmx?WSDL)

* * *

### 我的代码：

```
<html>
<body>
<?php
$zip = $_REQUEST['zip'];
echo 'zip is'.$zip;
?>
<form action="wszip.php" method="post">
<table cellspacing="10" bgcolor="CadetBlue">
<tr>
<td><B>Enter Zip Code : </B><input type="text" name="zip" /></td>
<td></td>
<td><input type="Submit" value="Find It!"/></td>
</tr>
</table>
<BR><BR><BR><BR>
</form>
<?php
if($zip != "")
{
    $wsdl = "http://www.webservicex.net/uszip.asmx?WSDL";
    $client = new soapclient($wsdl, true);
    $response = $client->GetInfoByZIP($zip);
}
?>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T19:28:02.607

您输入的邮政编码不正确，并且您的构造函数语法也不正确。请改用此语法：

```
$wsdl = "http://www.webservicex.net/uszip.asmx?WSDL";
$client = new soapclient($wsdl);
$response = $client->GetInfoByZIP(array('USZip' => $zip)); 
```

我刚刚测试了它，它工作正常。文档在[这里](http://www.webservicex.net/uszip.asmx?op=GetInfoByZIP)。

# c# - 何时使用 .First 以及何时将 .FirstOrDefault 与 LINQ 一起使用？

> ID：1024559
> 
> 赞同：895
> 
> 时间：2009-06-21T19:15:29.933
> 
> 标签：c#, .net, linq

我四处搜索，并没有真正找到关于何时要使用`.First`以及何时要`.FirstOrDefault`与 LINQ 一起使用的明确答案。

*   你想什么时候使用`.First`？仅当您想在没有返回结果的情况下捕获异常时？

    ```
    var result = List.Where(x => x == "foo").First(); 
    ```

*   你想什么时候使用`.FirstOrDefault`？如果没有结果，您何时总是想要默认类型？

    ```
    var result = List.Where(x => x == "foo").FirstOrDefault(); 
    ```

*   就此而言，Take 怎么样？

    ```
    var result = List.Where(x => x == "foo").Take(1); 
    ```

* * *

## 回答 #1

> 赞同：864
> 
> 时间：2009-06-21T19:22:55.940

`First()`当我知道或期望序列至少有一个元素时，我会使用它。换句话说，当序列为空是异常情况时。

`FirstOrDefault()`当您知道需要检查是否存在元素时使用。换句话说，什么时候序列为空是合法的。您不应该依赖异常处理来进行检查。（这是不好的做法，可能会损害性能）。

`First()`最后，和之间的区别在于`Take(1)`返回`First()`元素本身，而`Take(1)`返回恰好包含一个元素的元素序列。

* * *

## 回答 #2

> 赞同：291
> 
> 时间：2009-06-21T19:23:27.873

`.First`没有结果时会抛出异常。`.FirstOrDefault`不会，它只会返回 null（引用类型）或值类型的默认值。（例如`0`，对于 int。）这里的问题不是您何时需要默认类型，而是更多：您愿意处理异常还是处理默认值？由于异常应该是异常的，`FirstOrDefault`因此当您不确定是否要从查询中获得结果时首选。当逻辑上数据应该在那里时，可以考虑异常处理。

`Skip()`并且`Take()`通常在在结果中设置分页时使用。（比如在下一页显示前 10 个结果，接下来的 10 个等）

希望这可以帮助。

* * *

## 回答 #3

> 赞同：128
> 
> 时间：2009-06-21T19:22:24.427

`.First()`如果没有要返回的行，将抛出异常，而`.FirstOrDefault()`将返回默认值（`NULL`对于所有引用类型）。

因此，如果您已准备好并愿意处理可能的异常，那`.First()`很好。如果您更喜欢检查返回值`!= null`，那么`.FirstOrDefault()`是您更好的选择。

但我想这也有点个人喜好。使用对您更有意义且更适合您的编码风格的那个。

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2014-09-02T05:35:50.923

**第一的（）**

1.  返回序列的第一个元素。
2.  当结果中没有元素或源为空时，它会引发错误。
3.  你应该使用它，如果需要多个元素并且你只想要第一个元素。

**第一或默认（）**

1.  返回序列的第一个元素，如果没有找到元素，则返回默认值。
2.  仅当源为空时才会引发错误。
3.  你应该使用它，如果需要多个元素并且你只想要第一个元素。如果结果为空也很好。

我们有一个 UserInfos 表，其中有一些记录，如下所示。根据下表，我创建了示例...

![用户信息表](../Images/1755b3987578ced63479b8cabb400224.png)

**如何使用 First()**

```
var result = dc.UserInfos.First(x => x.ID == 1); 
```

只有一条记录 ID== 1。应返回此记录
ID：1 名字：Manish 姓氏：Dubey 电子邮件：xyz@xyz.com

```
var result = dc.UserInfos.First(x => x.FName == "Rahul"); 
```

有多个记录，其中 FName == "Rahul"。第一条记录应该返回。
ID：7 名字：Rahul 姓氏：Sharma 电子邮件：xyz1@xyz.com

```
var result = dc.UserInfos.First(x => x.ID ==13); 
```

没有 ID== 13 的记录。应该会发生错误。
InvalidOperationException：序列不包含任何元素

**如何使用 FirstOrDefault()**

```
var result = dc.UserInfos.FirstOrDefault(x => x.ID == 1); 
```

只有一条记录 ID== 1。应返回此记录
ID：1 名字：Manish 姓氏：Dubey 电子邮件：xyz@xyz.com

```
var result = dc.UserInfos.FirstOrDefault(x => x.FName == "Rahul"); 
```

有多个记录，其中 FName == "Rahul"。第一条记录应该返回。
ID：7 名字：Rahul 姓氏：Sharma 电子邮件：xyz1@xyz.com

```
var result = dc.UserInfos.FirstOrDefault(x => x.ID ==13); 
```

没有ID== 13的记录。返回值为null

希望它能帮助您了解何时使用`First()`或`FirstOrDefault()`.

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-06-21T19:23:55.470

首先，`Take`是一种完全不同的方法。它返回一个`IEnumerable<T>`而不是一个单一`T`的，所以这就结束了。

在`First`and之间`FirstOrDefault`，您应该`First`在确定元素存在时使用，如果不存在，则存在错误。

顺便说一句，如果您的序列包含`default(T)`元素（例如`null`）并且您需要区分为空和第一个元素是`null`，则不能使用`FirstOrDefault`.

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-04-04T14:29:46.320

第一的：

*   返回序列的第一个元素
*   抛出异常：结果中没有元素
*   在以下情况下使用：当预期有多个元素并且您只想要第一个元素时

第一个或默认值：

*   返回序列的第一个元素，如果没有找到元素，则返回默认值
*   抛出异常：仅当源为空时
*   在以下情况下使用：当预期有多个元素并且您只需要第一个元素时。结果也可以为空

来自：[http ://www.technicaloverload.com/linq-single-vs-singleordefault-vs-first-vs-firstordefault/](http://www.technicaloverload.com/linq-single-vs-singleordefault-vs-first-vs-firstordefault/)

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-09-17T00:50:44.700

另一个需要注意的区别是，如果您在生产环境中调试应用程序，您可能无法访问行号，因此确定`.First()`方法中的哪个特定语句引发了异常可能很困难。

异常消息也不会包含您可能使用过的任何 Lambda 表达式，这会使任何问题更难调试。

这就是为什么我总是使用`FirstOrDefault()`，即使我知道空条目会构成异常情况。

```
var customer = context.Customers.FirstOrDefault(i => i.Id == customerId);
if (customer == null)
{
   throw new Exception(string.Format("Can't find customer {0}.", customerId));
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-09-21T10:40:00.617

**第一的（）**

当您知道结果包含超过 1 个预期的元素并且您应该只使用序列的第一个元素时。

**第一或默认（）**

FirstOrDefault() 与 First() 类似，不同之处在于，如果没有元素匹配指定条件，则返回泛型集合的基础类型的默认值。如果没有找到元素，它不会抛出 InvalidOperationException。但是元素或序列的集合是空的，而不是引发异常。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-08-28T17:06:04.557

这种类型的函数属于元素运算符。下面定义了一些有用的元素运算符。

1.  第一/第一或默认
2.  Last/LastOrDefault
3.  单/单或默认

当我们需要根据特定条件从序列中选择单个元素时，我们会使用元素运算符。这是一个例子。

```
 List<int> items = new List<int>() { 8, 5, 2, 4, 2, 6, 9, 2, 10 }; 
```

**First() 运算符在满足条件后返回序列的第一个元素。如果没有找到元素，那么它将抛出异常。**

int result = items.Where(item => item == 2).First();

**FirstOrDefault() 运算符在满足条件后返回序列的第一个元素。如果没有找到元素，那么它将返回该类型的默认值。**

int result1 = items.Where(item => item == 2).FirstOrDefault();

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-06-21T19:24:55.733

我找到了一个网站，可以解释 FirstOrDefault
[http://thepursuitofalife.com/the-linq-firstordefault-method-and-null-resultsets/](http://thepursuitofalife.com/the-linq-firstordefault-method-and-null-resultsets/)
如果查询没有结果，并且您想致电 First () 或 Single() 获得单行...您将获得“序列不包含元素”异常。

免责声明：我从未使用过 LINQ，所以如果这离题了，我深表歉意。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-02-28T16:37:25.117

`First()`其他人已经很好地描述了和之间的区别`FirstOrDefault()`。我想进一步解释这些方法的语义。在我看来`FirstOrDefault`，被过度使用了很多。在大多数情况下，当您过滤数据时，您要么期望返回与逻辑条件匹配的元素集合，要么通过其唯一标识符获取单个唯一元素——例如用户、书籍、帖子等......为什么我们甚至可以说这`FirstOrDefault()`是一种代码气味，不是因为它有问题，而是因为它被使用得太频繁了。[这篇博](https://vkontech.com/firstordefault-is-a-code-smell/)文详细探讨了该主题。海事组织大部分时间`SingleOrDefault()`是一个更好的选择，因此请注意这个错误，并确保您使用最合适的方法，清楚地代表您的合同和期望。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-06-21T22:25:08.537

```
someList.First(); // exception if collection is empty.
someList.FirstOrDefault(); // first item or default(Type) 
```

使用哪一个？它应该由业务逻辑决定，而不是担心异常/程序失败。

例如，如果业务逻辑说我们在任何工作日都不能有零交易（假设）。那么你不应该尝试用一些聪明的编程来处理这种情况。我将始终在此类集合上使用 First()，如果其他事情搞砸了业务逻辑，则让程序失败。

代码：

```
var transactionsOnWorkingDay = GetTransactionOnLatestWorkingDay();
var justNeedOneToProcess = transactionsOnWorkingDay.First(): //Not FirstOrDefault() 
```

我想看看其他人对此的评论。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-07-16T22:43:51.963

好吧，让我给我两分钱。First / Firstordefault 用于使用第二个构造函数时。我不会解释它是什么，但它是你可能总是使用一个，因为你不想引起异常。

```
person = tmp.FirstOrDefault(new Func<Person, bool>((p) =>
{
    return string.IsNullOrEmpty(p.Relationship);
})); 
```

* * *

## 回答 #14

> 赞同：-6
> 
> 时间：2017-03-12T21:57:06.070

linq 有很多方法可以实现对集合的单个简单查询，只需我们在 sql 中编写连接，可以根据需要和必要性首先或最后应用过滤器。

这是一个示例，我们可以在集合中找到具有 id 的元素。要对此添加更多信息，方法 First,`FirstOrDefault`理想情况下会在集合至少有一条记录时返回相同的值。但是，如果一个集合可以为空。then`First`将返回异常，但`FirstOrDefault`将返回`null`或默认。例如，`int`将返回 0。因此虽然说是个人喜好，但最好使用它`FirstOrDefault`来避免异常处理。 [![这是一个例子，我们在一个事务列表的集合上运行](../Images/e7be9138a240f5eeeda52051e0a07085.png)](https://i.stack.imgur.com/a7jGs.png)

# django - 如何在上传的文件/图像的名称中使用主键 ID？

> ID：1024561
> 
> 赞同：2
> 
> 时间：2009-06-21T19:16:45.127
> 
> 标签：django

我需要使用掩码生成上传图像的名称

```
images/{{ uploaded_image.id }}.jpg 
```

我认为最好的方法是*FileField.upload_to*属性，但它写[在这里](http://docs.djangoproject.com/en/dev/ref/models/fields/#filefield)：

> 在大多数情况下，这个对象还没有保存到数据库中，所以如果它使用默认的 AutoField，它可能还没有主键字段的值。

在我的情况下，在*save()*方法中保存对象后重命名文件会更好吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-21T19:28:55.553

我所做的是给 upload_to 一个函数，然后分配一个 UUID 是它保存到的函数：

```
import uuid

def get_upload_to(instance, filename):
    instance.uuid = uuid.uuid4().hex
    return 'blah/%s/%s' % (instance.uuid, filename)

class Photo(models.Model):
    file = models.FileField(max_length=200,upload_to=get_upload_to)
    uuid = models.CharField(max_length=32) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:22:53.770

为了避免并发问题，您需要在确定文件名之前将对象存储到数据库中（因为即使您获得下一个增量 id，这是可能的，它可能会在您保存文件时更改。）所以存储对象并然后重命名文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T10:17:15.047

谢谢，布利克斯和托德！我为我的问题选择了更好的解决方案：

```
import time
class Image(models.Model):
    def _get_upload_to(instance, filename):
        return 'images/%f.jpg' % time.time()

    original = models.ImageField(upload_to=_get_upload_to, ....) 
```

它保证每个文件名在同一目录中都是唯一的。在我的情况下，我只需要 jpg 文件，因此在其他情况下可以替换原始扩展名

# asp.net - 独立的 asp.net 页面

> ID：1024564
> 
> 赞同：2
> 
> 时间：2009-06-21T19:18:12.580
> 
> 标签：asp.net, web-hosting, capability

我想测试我的网络主机 asp.net 功能 - 相当于一个“phpinfo”页面 - 是否有一个独立的 aspx 页面我可以上传以测试 asp.net 是否正确运行以及它正在运行什么版本等。

谢谢，乔什

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-21T19:37:30.810

正如 Cody 所说，一个空白的 default.aspx 页面应该可以工作，但我建议也启用该页面的跟踪，以获取有关主机的 ASP.NET 设置的更多有用信息，即

```
<%@ Page Trace="true" %> 
```

[MSDN 文档](http://msdn.microsoft.com/en-us/library/94c55d08.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:24:14.703

你能在源代码中只制作一个空白的 default.aspx 页面吗？

# haskell - 现实世界中的 Haskell 与过程式编程

> ID：1024585
> 
> 赞同：48
> 
> 时间：2009-06-21T19:24:38.353
> 
> 标签：haskell, functional-programming, imperative-programming

这些天来，我正在认真研究函数式编程。

虽然我对 Haskell 及其似乎提供的可能性感到非常兴奋，但我现在也可以看到我需要一段时间来学习。在一个关于[如何学习 Haskell](https://stackoverflow.com/questions/1012573/how-to-learn-haskell)的 SO 问题中，一个答案指出实际上“掌握”它需要几个月甚至几年的时间。

现在，我知道 C、PHP、一些面向对象的东西等等。听说 Haskell 在“现实世界”中并没有太多使用，我会更好地提高我所知道的常规语言的技能吗？Haskell 值得奋斗吗？

在这个关于[为什么人们认为函数式编程会流行](https://stackoverflow.com/questions/411290/why-do-people-think-functional-programming-will-catch-on)的问题中，结论似乎是函数式编程会“流行”。但是程序编程肯定会保持领先，对吧？

编辑：keparo 很好地澄清了我的问题：**与过程语言相反，学习 Haskell 和函数式编程范式对我来说是否有价值？**

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-06-22T04:56:34.570

Haskell 并不像人们想学习的那么难。Haskell 为您打开了一个您从未知道存在的新世界。它与学习任何其他语言一样有价值。你可能找不到要求你进行 Haskell 编程的工作，但这真的意味着一门语言没有价值吗？

Haskell 会教你很多新东西，它会告诉你如何用你/do/ 使用的语言更好地编程。你可以在业余时间用它来做你自己的个人项目。

如果您将“真实世界”定义为“现金生成器”，Haskell 在“真实世界”中的使用并不多。因此，如果这是您的目标，那么您可能需要重新考虑目标：p

另外，我不太喜欢选择的“如何学习haskell”答案的那一部分。掌握任何语言都需要几个月到几年的时间，而不仅仅是 Haskell。取决于您如何定义“主人”。我可以以相当高的效率使用 Haskell，而且我才学习了一个月，甚至一直在慢慢学习它。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-06-21T19:37:35.847

如果不出意外，学习 Haskell 提供的思维方式改变将在您不得不重新使用那些仍在工作场所使用的程序语言时为您提供帮助。

函数式范式开始进入各种主流应用程序和语言——甚至 C++ 也将在 C++0x 中添加一个（残缺的）lambda。

您可能还想查看一些混合语言，例如 Scala 或 OCaml。Scala 被用于 Twitter，OCaml 被用于 Jane's Street 的金融交易平台。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-02-14T22:07:38.893

我学习 Haskell 是因为它是迄今为止我在 Scala、Clojure、OCaml 和 Scheme 中尝试过的最好的函数式语言，但我并没有认真期望将它用于工作。

事实证明，它非常适合那些对团队来说太小并且在 Java 中太耗时的零工。到目前为止，我已经将它用于临时数据迁移，即将 CSV 导出到另一种格式，XML 的批量转换（HXT 比 XSLT 更简洁和更强大），从互联网上抓取屏幕和软件项目估计，包括建模风险使用概率单子并使用回溯生成最佳甘特图。这都是需要做的真正的工作，我什至不会费心去尝试用 Java 做，因为这将是一个多天的工作。

我现在使用它而不是 Excel 来处理任何模糊的数学问题，因为在文本编辑器中在 haskell 源中创建值列表比将它们输入 Excel 更费力。一旦进入haskell，我就可以做各种Excel不能做的魔术，比如回溯、概率分布等。如果我需要一个图表，那么我将这些值作为 CSV（2 行代码）输出并将它们加载到 Excel 中。

唯一的缺点是需要几个月的时间才能精通，但值得付出努力恕我直言。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-06-21T19:34:55.213

您可能不应该期望在任何地方使用 Haskell 的频率几乎与专业环境中的 C 家族语言一样频繁。如果问题是学习 Haskell 和函数式编程范式对您是否有价值，答案是肯定的。您可以将您对编程的丰富理解应用到您的所有工作中。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-06-21T20:37:35.523

> 与过程语言相反，学习 Haskell 和函数式编程范式对我来说有价值吗？

如果拥有扩展的技能组合很有价值，那么：是的。

您可能会获得一个优势：并行和并发编程。过去的过程语言往往没有明确的副作用概念，因此很难在其中编写并行程序。函数式语言（特别是像 Haskell 那样限制副作用的语言）对于高效的并行编程有很多话要说。

掌握这项技能不会有什么坏处。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-06-24T19:15:03.400

> 与过程语言相反，学习 Haskell 和函数式编程范式对我来说有价值吗？

除非你想痛苦，否则不会。Luke Plant 在[《为什么学习 Haskell/Python 会让你成为更差的程序员](http://lukeplant.me.uk/blog.php?id=1107301645)》中说：

> 所以，学习 Python 和 Haskell 让我士气低落，并鼓励我编写奇怪且难以理解的代码......

（这不完全是个玩笑。）

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-21T19:40:22.253

我可以看到，如果函数式编程很容易被非函数式代码使用，那么它在生产环境中可能是一个加分项。我猜当他们想出 F# 时，MS 也能看到这一点。

由于它们都编译为 IL，因此您可以处理需要函数式方法的问题，并在您的程序代码中非常轻松地使用这些解决方案。

这样，功能代码可以轻松地在生产环境中*一次找到它的方式*

因此，由于 MS 的用户群如此之大，我的猜测是，如果 F# 在不久的将来不会流行起来，那么 Haskell 也不会。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-06-24T19:30:28.983

我觉得奋斗是值得的。*它将帮助您了解问题是如何解决的，而不仅仅是计算机是如何工作的。*

也许一个特殊的问题是 Haskell 本身——作为一种纯粹的函数式语言，它有点“硬核”，另一方面甚至可能使事情复杂化。

相反，函数式编程可能以非常实用的方式非常有用 - 由于这个原因，许多 OO/命令式语言现在已经包含函数元素（Linq、匿名函数、只读值、函数指针/委托、类型推断）：您可以专注于应该这样做，这样您就可以用更少的代码表达更多内容（即更不容易出错）。

Scala 或 F# 等非纯函数式语言（标准函数式语言）可以轻松集成到现有的 Java 或 .NET 项目中，因此您可以在需要时结合两种范式的优势。有关函数式语言的典型优势，请参阅[此线程](https://stackoverflow.com/questions/952318/whats-the-benefits-of-using-c-vs-f-or-f-vs-c/952443)。想想极其强大的解析（Monadic 解析器组合器 / Parsec）或函数式语言可能的并发编程，你就会看到它们有多么有用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-21T19:37:16.270

无论您目前碰巧使用哪种语言，拓宽您的视野都可以帮助您成为一名更好的程序员。例如，在编写 Lisp 宏之后，您将永远不会以同样的方式看待编程。在你开始用 Haskell 术语思考之后，你会发现自己在编写函数并希望使用不太高级的语言来实现闭包。

从 C# 中的优点（如 lambda、类型推断、闭包等）来看[，](https://stackoverflow.com/questions/393757/why-is-c-a-functional-programmming-language)学习 Haskell 将使您在未来主流语言的前沿领先一步。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-21T19:49:59.113

有些人喜欢用 Haskell 编程。如果你可以选择你的环境，并且享受是一个考虑因素，那么也许你应该加入。

许多程序员无法选择他们的工具，享受不是他们选择的因素。他们中的许多人开始在他们的工作场所使用 C/Java/etc 作为“核心项目源”，但随后也选择或需要将 Python 用于“脚本”，例如带有 SCons 的构建脚本，其他生成 Java/etc 的脚本代码、测试系统、概念证明等。在其他地方，Python 也被用于“核心项目”。

8 年后，它将是 Haskell，而不是 Python，它将“向你走来”。但你可以早点来。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-30T11:27:43.793

您可以结合使用函数式编程*并对*语言保持务实。

所有现代脚本语言如 JavaScript 或 Lua 都允许使用函数式范例。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-05T20:38:26.553

功能概念正在变得强大。请注意围绕 Ruby 的一系列活动和兴趣。最近，我还注意到除了浏览器脚本语言之外，对 JavaScript 更感兴趣了。您现在就可以通过潜入来领先于游戏，尽管所投入的时间可能不会在今年或明年得到回报。

这取决于您的总体游戏计划。您是否将编程本身作为目的或作为达到目的的手段？如果是前者，请与 Haskell 一起疯狂。如果是后者，请坚持使用主流的“可使用”语言。等待 Haskell 起飞然后突袭。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-25T02:29:28.930

为什么程序化而不是面向对象，除了 C 之外，多年来没有看到程序化被使用。

从商业上讲。我会选择 Java 或 C#。他们都支付高薪并不重要，并且技能可以与其他志同道合的语言（如 python、Ruby 和 JavaScript）互换。

Haskell 值得花时间和精力，虽然它非常学术，但一些银行使用它，尽管欧洲和英国的许多银行正在将代码库转移到 F#。

我认为 FOP 在商业上不会以极快的速度发展。但是这些技术肯定会出现在主要的语言中。尤其是多核芯片设计并使代码在它们上并行运行。

# php - 如何禁用 HTTPS 上的 openbase_dir 限制？

> ID：1024591
> 
> 赞同：1
> 
> 时间：2009-06-21T19:30:55.393
> 
> 标签：php, unix

我正在尝试启用 php 文件以通过 HTTPS 连接访问位于根 Web 目录之外的文件夹中的另一个文件。这在 HTTP 上运行良好，但由于某种原因 HTTPS 连接无法读取文件。

我通过在 vhost.conf 文件中禁用 openbase_dir 来通过 HTTP 启用此功能，如下所示：

php_admin_value open_basedir "/var/www/vhosts/my-domain.com/httpdocs:/usr/share/pear:/tmp:/var/www/vhosts/my-domain.com/my_folder/" php_admin_value open_basedir 无

然后，我尝试使用以下内容附加和替换 vhost.conf 的内容：

php_admin_value open_basedir "/var/www/vhosts/my-domain.com/httpsdocs:/usr/share/pear:/tmp:/var/www/vhosts/my-domain.com/my_folder/" php_admin_value open_basedir 无

但是，在重新配置服务器以使用新的 vhost.conf 文件并重新启动 apache 后，尝试让 web 目录中的测试 php 文件通过 HTTPS 连接读取驻留在 my_folder 中的文件继续失败。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T20:13:20.097

看起来您可能正在使用 Plesk，但这只是猜测。如果是这样，那么您还需要创建一个具有相同设置的 vhost_ssl.conf 文件（并使用 websrvmng 重新生成 httpd.include 文件）。

如果您不使用 Plesk，问题可能是相同的，因为您可能为 http 和 https 配置了单独的虚拟主机，并且您还需要修改 https 以消除限制。

# java - java和php中的时间戳有什么区别？

> ID：1024596
> 
> 赞同：1
> 
> 时间：2009-06-21T19:35:04.450
> 
> 标签：java, php, datetime, timestamp

我有一个将记录写入数据库和时间戳的**java文件**

我有另一个读取该记录的**php文件。**

不幸的是，将时间戳转换为日期后，我得到了错误的日期？？

问题是什么 ！！！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-21T19:52:26.223

Java 使用从纪元开始的毫秒数的时间戳。PHP 使用标准的 unix 时间戳，它是从纪元开始的秒数。

我相信两者都使用 1970 年 1 月 1 日 00:00:00 UTC 的同一时期

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:52:24.587

PHP 使用 UNIX 纪元，我怀疑 Java 使用不同的纪元。

编辑：我很遥远，原来 PHP 使用秒，java 使用毫秒。因此，乘以 1000 或除以 1000，具体取决于您转换的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T19:53:37.687

我认为问题在于您正在检索 DATETIME 或 TIMESTAMP 列或已存储的列并搞砸了转换。尝试这个：

```
$phpdate = strtotime( $dateFromDb );
echo date("F j, Y, g:i a", $phpdate); 
```

# iphone - OpenGL ES 渲染到纹理

> ID：1024603
> 
> 赞同：33
> 
> 时间：2009-06-21T19:37:53.367
> 
> 标签：iphone, opengl-es, render-to-texture

我一直无法找到直接的代码来将场景渲染到 OpenGL ES 中的纹理（如果重要的话，特别是对于 iPhone）。我有兴趣了解以下内容：

1.  如何在 OpenGL ES 中将场景渲染为纹理？
2.  您必须使用哪些参数来创建能够在 OpenGL ES 中作为渲染目标的纹理？
3.  将此渲染纹理应用于其他图元是否有任何影响？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-06-21T19:57:24.733

我就是这样做的。

我定义了一个纹理变量（我使用 Apple 的`Texture2D`类，但如果需要，您可以使用 OpenGL 纹理 ID）和一个帧缓冲区：

```
Texture2d * texture;
GLuint textureFrameBuffer; 
```

然后在某个时候，我创建纹理、帧缓冲区并附加渲染缓冲区。您只需执行一次：

```
texture = [[Texture2D alloc] initWithData:0 
                             pixelFormat:kTexture2DPixelFormat_RGB888
                             pixelsWide:32
                             pixelsHigh:32
                             contentSize:CGSizeMake(width, height)];

// create framebuffer
glGenFramebuffersOES(1, &textureFrameBuffer);
glBindFramebufferOES(GL_FRAMEBUFFER_OES, textureFrameBuffer);

// attach renderbuffer
glFramebufferTexture2DOES(GL_FRAMEBUFFER_OES, GL_COLOR_ATTACHMENT0_OES, GL_TEXTURE_2D, texture.name, 0);

// unbind frame buffer
glBindFramebufferOES(GL_FRAMEBUFFER_OES, 0); 
```

每次我想渲染纹理时，我都会这样做：

```
glBindFramebufferOES(GL_FRAMEBUFFER_OES, textureFrameBuffer);

...
// GL commands
...

glBindFramebufferOES(GL_FRAMEBUFFER_OES, 0); 
```

关于你的问题 3，就是这样，你可以像使用任何其他纹理一样使用纹理。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-01-29T11:33:33.587

要将场景渲染到纹理，您必须使用与纹理关联的帧缓冲区。这是我为简化它而创建的一种方法：

```
void glGenTextureFromFramebuffer(GLuint *t, GLuint *f, GLsizei w, GLsizei h)
{
    glGenFramebuffers(1, f);
    glGenTextures(1, t);

    glBindFramebuffer(GL_FRAMEBUFFER, *f);

    glBindTexture(GL_TEXTURE_2D, *t);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, w, h, 0, GL_RGBA, GL_UNSIGNED_BYTE, NULL);
    glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, *t, 0);

    GLuint depthbuffer;
    glGenRenderbuffers(1, &depthbuffer);    
    glBindRenderbuffer(GL_RENDERBUFFER, depthbuffer);
    glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT16, w, h);
    glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, depthbuffer);

    GLenum status = glCheckFramebufferStatus(GL_FRAMEBUFFER);
    if(status != GL_FRAMEBUFFER_COMPLETE)
        NSLog(@"Framebuffer status: %x", (int)status);
} 
```

您可以轻松创建帧缓冲区和纹理：

```
GLuint _texture, _framebuffer;
GLsizei w,h;
float scale = [UIScreen mainScreen].scale;
w = self.view.bounds.size.width * scale;
h = self.view.bounds.size.height * scale;
glGenTextureFromFramebuffer(&_texture, &_framebuffer, w, h); 
```

您可以稍后在您的绘图方法中使用 _framebuffer 将场景渲染到 _texture 中：

```
glBindFramebuffer(GL_FRAMEBUFFER, _framebuffer);
//draw here the content you want in the texture
//_texture is now a texture with the drawn content

//bind the base framebuffer
glBindFramebuffer(GL_FRAMEBUFFER, 0);
//or if you use GLKit
[view bindDrawable];
//draw normaly 
```

现在你可以用纹理做你想做的事了。如果你想做一些后期处理（模糊、绽放、阴影等），你可以！

# repository - 工作单元和 L2S 数据上下文

> ID：1024606
> 
> 赞同：0
> 
> 时间：2009-06-21T19:41:36.853
> 
> 标签：repository, unit-of-work

Quick Q 为您提供模式专家。

我想要一个与实际数据访问技术分离的存储库模式，因为我还没有决定，我希望它是灵活的。所以，这可能是 L2S、L2E、NHibernate、Lightspeed 或任何东西。

但是我对这个 UnitOfWork 事情感到困惑。

在 L2S 世界中，这似乎是您的 DataContext。

但是对于非 L2S 的世界呢，假设我使用的是手写 SQL。

我的问题是谁做什么？在我的 Repo.Save() 方法中，是否应该调用 UnitOfWork.Commit 然后生成所需的 INSERT/UPDATE SQL ？

不期待一个明确的答案，但一些讨论会很好，只是为了确保我走在正确的轨道上！

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T09:47:45.293

存储库当然可以在工作单元对象上调用提交/保存/提交，或者他们可以将这留给消费者。我更喜欢后一种情况，因为它使消费者能够控制工作单元实例的生命周期，从而允许消费者使用多个存储库：

```
// outside the repository layer
// int productId defined elsewhere
// int quantity defined elsewhere

IUnitOfWork unitOfWork = ... instantiate/get a new instance of your DataContext ...

ProductRepository productRepository = new ProductRepository(unitOfWork);
Product product = productRepository.GetById(productId);

Order order = new Order();
order.AddOrderLine(product, quantity);

OrderRepository orderRepository = new OrderRepository(unitOfWork);
orderRepository.Add(order);

unitOfWork.Save(); // This calls SubmitChanges() on the DataContext 
```

# c# - Linq to xml：执行 remove() 后如何获取元素子集

> ID：1024617
> 
> 赞同：0
> 
> 时间：2009-06-21T19:48:49.867
> 
> 标签：c#, .net, vb.net, linq-to-xml

如果我有这样的代码（C# 或 VB.Net 无关紧要）

```
 Dim e As IEnumerable(Of XElement) = _
            From s In _dataSourceSettings.Elements _
            Where s.Attribute("name").Value = toInsert.Attribute("name").Value
        If e.Count > 0 Then
            e.Remove()
        End If 
```

我现在如何在没有删除元素的情况下获得新的 _dataSourceSettings？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T19:51:59.063

哦，没关系，它已经没有那个节点了

# archive - 组织数百个个人和示例项目？

> ID：1024625
> 
> 赞同：3
> 
> 时间：2009-06-21T19:52:32.917
> 
> 标签：archive, organization, project-organization

当你有数百个项目时，你如何组织项目？不是项目*内*的布局，而是项目根目录的布局。

我正在整合十多年的个人项目和示例项目，这些项目分散在几个系统的磁盘上，并且正在寻找一些组织方法，让我保持十几个活跃的项目可见，并且可以找到存档的项目。

大多数项目都是学习实验，跨越一堆不同的语言和框架。其中一些项目是成熟的、可工作的应用程序，我可以利用这些应用程序来重用想法和代码。

我在远程 git 存储库中为我的个人资料使用平面命名空间，但这似乎不是在我的开发系统上组织事物的理想方式。肯定有比 ~/active/ 和 ~/archive/ 更好的东西。

在这种情况下什么对你有用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T19:57:40.190

保持原状。你的组织或缺席是一个历史。留着它。

也许创建一些目录来按时间顺序组织东西，几年甚至几个月你就是那个创意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T19:58:40.440

这些都是个人喜好，但也许其中之一会对您有所帮助

1.  我总是保留一个“临时”或“POC（概念证明）”文件夹，用于存放我正在尝试的示例和内容

2.  我总是为那些我知道我不需要的项目使用存档文件夹

3.  我尝试按技术（除了我的主要技术）对项目进行分组，所以我会有一个 Silverlight 文件夹、Flex 文件夹、C++ 等。

4.  我总是有一个教程文件夹，用于存放从 Internet 或其他用户下载的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T02:29:44.113

我将我的个人项目分为以下类别和子类别。然后将类别的层次结构转换为文件系统结构。

*   长期项目

    我计划同时进行多个版本或多个分支的项目。基本上任何我将使用超过 6 个月左右的东西

*   基于 CLR 的代码

    我过去常常按语言进一步细分。但是我现在有很多混合语言项目，所以我不再这样做了。它只会让事情变得更加混乱。/li>

*   爪哇
*   C++
*   其他一切

# xml - 如何将 GUID simpleType 添加到 XML 架构中？

> ID：1024627
> 
> 赞同：14
> 
> 时间：2009-06-21T19:52:51.560
> 
> 标签：xml, types, xsd, guid

我正在尝试创建一个 XML 模式，它使属性值能够以本机格式存储为 GUID。我可以将它设置为一个字符串，但最好将它存储为一个真正的 GUID。

任何想法如何做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-21T20:20:52.140

您可以通过使用如下正则表达式限制字符串来定义自己的自定义简单类型“GUID”：

```
<xs:simpleType name="GUID">
  <xs:restriction base="xs:string">
    <xs:pattern value="([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})|(\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\})"/>
  </xs:restriction>
</xs:simpleType> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T20:17:32.133

XML 基本上只包含字符串，尽管 XSD 也定义了某些其他原始类型。然而，GUID 不在其中。

您可以为 GUID 类型定义自己的架构。很多人都做过这件事。以下是 Microsoft OneNote 团队的做法：http: [//msdn.microsoft.com/en-us/library/aa203890](http://msdn.microsoft.com/en-us/library/aa203890(office.11).aspx) (office.11​​).aspx 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T21:46:07.710

我已经猜出来了。有时阅读文档会有所帮助。这就是它的工作方式。

```
 <xs:simpleType name="GUID">
      <xs:restriction base="xs:string">
        <xs:pattern value="([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})|(\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\})"/>
      </xs:restriction>
    </xs:simpleType>

    <xs:element name="ruleident">
      <xs:complexType>
        <xs:attribute name="ruleGuid" >
          <xs:simpleType>
            <xs:restriction base ="GUID"/>
           </xs:simpleType>
        </xs:attribute >
      </xs:complexType >
    </xs:element> 
```

# database-design - 保存 URL 的数据库表

> ID：1024631
> 
> 赞同：1
> 
> 时间：2009-06-21T19:55:51.693
> 
> 标签：database-design

我正在编写一个在类似互联网的伪环境中玩的游戏。我只是在为游戏做“DNS”。基本上，一个将字符串（“URL”）链接到机器（数据库中的另一个实体）的数据库。

和现实生活中的差不多：

*   每台*机器*可以有零个或多个*url*
*   每个 url 都有一个*tld*。为简单起见，只有 TLD 并且没有 TLD 具有多个扩展名（呃，修复我的术语吗？）。所以 .com 和 .net 有效，但 .co.uk 和 .org.uk 无效。
*   url 可以有零个或多个子域
*   每个子域可以链接到不同的机器
*   每个子域可以有零个或多个子域，每个子域链接到不同的机器

我的第一个直觉是做这样的事情：

域`_`tld 表；
tld_id, tld

域主机名表；
主机名`_`ID、主机名、顶级域名、父级

其中，hostname 是 URL，tld 链接到域`_`tld，如果它是根域名，则 parent 为 null。如果它是子域，则 parent 是父级的主机名`_`id，主机名是子域。但后来我意识到它被分配了一个冗余的 tld ......虽然我想它可以被赋予一个空值。

我想知道是否有任何更聪明的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T20:33:32.397

这取决于您需要对此数据执行哪些操作。您真的需要对子域的树结构进行建模吗？这（有点）类似于真正的 DNS 委派区域权限的方式，但如果您真正需要的是 DNS 的“url => machine”方面，那么带有“machine_id”列的简单“url”表会简单得多，并且可能性能更高。

如果您*确实*需要对树结构进行建模，为什么还要区分 TLD 和子域呢？您可以简单地拥有一个包含“name”、“parent_domain_id”和“machine_id”列的“domain”表，并将 TLD 的 parent 设置为 null。索引父列将使获取 TLD 列表的性能合理，这可能取决于数据集的大小和需要优化的操作。这将是一个比创建两个单独的表更简单的模型，并且会更接近真实的 DNS 系统（除了实现之外，“com”并没有*什么*神奇之处）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:25:24.630

如果需要，您可以为子域使用第三个表。这将消除您提到的冗余问题。不要在 domain_hostname 上创建父列，而是创建一个新表，如下所示：

域子域；
subdomain_id, subdomain_name, hostname_id

其中 hostname_id 是返回 domain_hostname 表的外键。这本质上是 domain_hostname 表的规范化。

# linux - RTMP：有这样的linux命令行工具吗？

> ID：1024632
> 
> 赞同：21
> 
> 时间：2009-06-21T19:56:13.673
> 
> 标签：linux, shell, command-line, utilities, rtmp

我到处寻找可以让我下载 rtmp 流的 linux 实用程序。不是 flv 视频，而是 MP3 流。我要下载的流的位置就是这种格式。

```
rtmp://live.site.com/loc/45/std_fc74a6b7f79c70a5f60.mp3 
```

有人知道这样的命令行工具吗？甚至任何接近我要求的东西？

我不想要完整的软件应用程序，如果它可以通过 Shell 或其他方式在 Linux 上运行，那就太好了。

谢谢大家

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-21T20:15:28.953

`mplayer`如果您拥有或`vlc`使用 RTMP 访问权限编译，则应该执行以下操作之一。

```
mplayer -dumpstream rtmp://live.site.com/loc/45/std_fc74a6b7f79c70a5f60.mp3

```

这将生成一个`./stream.dump`.

```
vlc -I 虚拟 rtmp://live.site.com/loc/45/std_fc74a6b7f79c70a5f60.mp3 \
    --sout 文件/ts:output.mpg vlc://quit

```

这将生成一个`./output.mpg`. 您必须对其进行解复用才能仅提取音频流。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-05-06T12:25:34.980

这个问题很老，但这可以帮助其他有这个疑问的用户。
直接下载，无需任何转换，有两种选择（*两个程序的作者相同，行为相同*）：

*   [实时数据转储](http://rtmpdump.mplayerhq.hu/)。例子：`rtmpdump -r "rtmp://host.com/dir/file.flv" -o filename.flv`
*   [流媒体](http://www.nongnu.org/flvstreamer/)。例子：`flvstreamer -r "rtmp://od.flash.plus.es/ondemand/14314/plus/plustv/PO770632.flv" -o salida.flv`

如果您想同时下载和转换视频，最好的方法是使用 ffmpeg：

```
ffmpeg -i rtmp://server/live/streamName -acodec copy -vcodec copy dump.mp4 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-03-14T02:34:52.070

我认为自之前的一些答案出现以来，情况已经发生了一些变化。至少根据[rtmp 维基百科页面](http://en.wikipedia.org/wiki/Real_Time_Messaging_Protocol)。看来**rtmp 协议规范**是开放供公众使用的。为此，您可以使用 2 个工具来完成原始发帖人的要求，`rtmpdump`并且`ffmpeg`. 这是我为下载发送音频播客的 rtmp 流所做的工作。

**步骤 #1 - 下载流**

我使用工具[rtmpdump](http://en.wikipedia.org/wiki/Rtmpdump)来完成此操作。像这样：

```
% rtmpdump -r rtmp://url/to/some/file.mp3 -o /path/to/file.flv
RTMPDump v2.3
(c) 2010 Andrej Stepanchuk, Howard Chu, The Flvstreamer Team; license: GPL
Connecting ...
INFO: Connected...
Starting download at: 0.000 kB
28358.553 kB / 3561.61 sec
Download complete 
```

**步骤 #2 - 将 flv 文件转换为 mp3**

好的，现在您已经获得了流的本地副本**file.flv**。您可以使用它`ffmpeg`来进一步询问文件，也可以只提取音频部分。

```
% ffmpeg -i file.flv
....
[flv @ 0x25f6670]max_analyze_duration reached
[flv @ 0x25f6670]Estimating duration from bitrate, this may be inaccurate
Input #0, flv, from 'file.flv':
  Duration: 00:59:21.61, start: 0.000000, bitrate: 64 kb/s
    Stream #0.0: Audio: mp3, 44100 Hz, 1 channels, s16, 64 kb/s 
```

从上面的输出我们可以看到**file.flv**包含一个流，只是音频，它是 mp3 格式，它是一个单一的通道。要将其提取到正确的 mp3 文件，您可以`ffmpeg`再次使用：

```
% ffmpeg -i file.flv -vn -acodec copy file.mp3
....
[flv @ 0x22a6670]max_analyze_duration reached
[flv @ 0x22a6670]Estimating duration from bitrate, this may be inaccurate
Input #0, flv, from 'file.flv':
 Duration: 00:59:21.61, start: 0.000000, bitrate: 64 kb/s
    Stream #0.0: Audio: mp3, 44100 Hz, 1 channels, s16, 64 kb/s
Output #0, mp3, to 'file.mp3':
  Metadata:
    TSSE            : Lavf52.64.2
    Stream #0.0: Audio: libmp3lame, 44100 Hz, 1 channels, 64 kb/s
Stream mapping:
  Stream #0.0 -> #0.0
Press [q] to stop encoding
size=   27826kB time=3561.66 bitrate=  64.0kbits/s    
video:0kB audio:27826kB global headers:0kB muxing overhead 0.000116% 
```

上述命令会将音频流**复制**到文件**file.mp3**中。您也可以将其提取到 wav 文件中，如下所示：

```
ffmpeg -i file.flv -vn -acodec pcm_s16le -ar 44100 -ac 2 file.wav 
```

此[页面](http://howto-pages.org/ffmpeg/)有助于确定如何将 flv 文件转换为其他格式。

# algorithm - 计算 phi(k) 为 1 给定一个大的 N，我需要遍历所有 phi(k) 使得 1 < k < N ： 时间复杂度必须是O(N logN) memory-complexity 必须是 sub O(N)（因为 N 的值将在 10 12左右） 是否可以？如果是这样，怎么做？ 问问题 PythonPower 问问题 2009-06-21T20:00:52.527 17926 次 This question shows research effort; it is useful and clear 14 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 给定一个大的 N，我需要遍历所有 phi(k) 使得 1 < k < N ： 时间复杂度必须是O(N logN) memory-complexity 必须是 sub O(N)（因为 N 的值将在 10 12左右） 是否可以？如果是这样，怎么做？ phi(k) 的计算必须使用 k 的素数分解来完成，这是唯一合理的方法。如果您需要对此进行复习，维基百科带有公式。 如果您现在必须计算 1 到大 N 之间的每个数字的所有素数除数，那么您将在看到任何结果之前就死于老年，所以我会反过来，即使用它们构建所有低于 N 的数字可能的素数因子，即所有小于或等于 N 的素数。 因此，您的问题将类似于计算一个数字的所有除数，只是您不知道事先在分解中可以找到某个素数的最大次数是多少。调整最初由 Tim Peters 在 python 列表中编写的迭代器（我在博客上写过的东西......）以包含 totient 函数，python 中产生 k，phi(k) 对的可能实现如下： def composites(factors, N) : """ Generates all number-totient pairs below N, unordered, from the prime factors. """ ps = sorted(set(factors)) omega = len(ps) def rec_gen(n = 0) : if n == omega : yield (1,1) else : pows = [(1,1)] val = ps[n] while val <= N : pows += [(val, val - pows[-1][0])] val *= ps[n] for q, phi_q in rec_gen(n + 1) : for p, phi_p in pows : if p * q > N : break else : yield p * q, phi_p * phi_q for p in rec_gen() : yield p 如果您在计算低于 N 的所有素数方面需要帮助，我也在博客中讨论过它......请记住，虽然计算低于 10 12的所有素数本身就是一项了不起的壮举...... algorithmmathbig-oprimes 4 9 回答 9 This answer is useful 21 这可以通过内存复杂度 O(Sqrt(N)) 和 CPU 复杂度 O(N * Log(Log(N))) 以及优化的 Eratosthenes 窗口筛来完成，如下面的代码示例中实现的。 由于没有指定语言并且我不了解 Python，我已经在 VB.net 中实现了它，但是如果您需要，我可以将其转换为 C#。 Imports System.Math Public Class TotientSerialCalculator 'Implements an extremely efficient Serial Totient(phi) calculator ' ' This implements an optimized windowed Sieve of Eratosthenes. The' ' window size is set at Sqrt(N) both to optimize collecting and ' ' applying all of the Primes below Sqrt(N), and to minimize ' ' window-turning overhead. ' ' ' ' CPU complexity is O( N * Log(Log(N)) ), which is virtually linear.' ' ' ' MEM Complexity is O( Sqrt(N) ). ' ' ' ' This is probalby the ideal combination, as any attempt to further ' 'reduce memory will almost certainly result in disproportionate increases' 'in CPU complexity, and vice-versa. ' Structure NumberFactors Dim UnFactored As Long 'the part of the number that still needs to be factored' Dim Phi As Long 'the totient value progressively calculated' ' (equals total numbers less than N that are CoPrime to N)' 'MEM = 8 bytes each' End Structure Private ReportInterval As Long Private PrevLast As Long 'the last value in the previous window' Private FirstValue As Long 'the first value in this windows range' Private WindowSize As Long Private LastValue As Long 'the last value in this windows range' Private NextFirst As Long 'the first value in the next window' 'Array that stores all of the NumberFactors in the current window.' ' this is the primary memory consumption for the class and it' ' is 16 * Sqrt(N) Bytes, which is O(Sqrt(N)).' Public Numbers() As NumberFactors ' For N=10^12 (1 trilion), this will be 16MB, which should be bearable anywhere.' '(note that the Primes() array is a secondary memory consumer' ' at O(pi(Sqrt(N)), which will be within 10x of O(Sqrt(N)))' Public Event EmitTotientPair(ByVal k As Long, ByVal Phi As Long) '===== The Routine To Call: ========================' Public Sub EmitTotientPairsToN(ByVal N As Long) 'Routine to Emit Totient pairs {k, Phi(k)} for k = 1 to N' ' 2009-07-14, RBarryYoung, Created.' Dim i As Long Dim k As Long 'the current number being factored' Dim p As Long 'the current prime factor' 'Establish the Window frame:' ' note: WindowSize is the critical value that controls both memory' ' usage and CPU consumption and must be SQRT(N) for it to work optimally.' WindowSize = Ceiling(Sqrt(CDbl(N))) ReDim Numbers(0 To WindowSize - 1) 'Initialize the first window:' MapWindow(1) Dim IsFirstWindow As Boolean = True 'adjust this to control how often results are show' ReportInterval = N / 100 'Allocate the primes array to hold the primes list:' ' Only primes <= SQRT(N) are needed for factoring' ' PiMax(X) is a Max estimate of the number of primes <= X' Dim Primes() As Long, PrimeIndex As Long, NextPrime As Long 'init the primes list and its pointers' ReDim Primes(0 To PiMax(WindowSize) - 1) Primes(0) = 2 '"prime" the primes list with the first prime' NextPrime = 1 'Map (and Remap) the window with Sqrt(N) numbers, Sqrt(N) times to' ' sequentially map all of the numbers <= N.' Do 'Sieve the primes across the current window' PrimeIndex = 0 'note: cant use enumerator for the loop below because NextPrime' ' changes during the first window as new primes <= SQRT(N) are accumulated' Do While PrimeIndex < NextPrime 'get the next prime in the list' p = Primes(PrimeIndex) 'find the first multiple of (p) in the current window range' k = PrevLast + p - (PrevLast Mod p) Do With Numbers(k - FirstValue) .UnFactored = .UnFactored \ p 'always works the first time' .Phi = .Phi * (p - 1) 'Phi = PRODUCT( (Pi-1)*Pi^(Ei-1) )' 'The loop test that follows is probably the central CPU overhead' ' I believe that it is O(N*Log(Log(N)), which is virtually O(N)' ' ( for instance at N = 10^12, Log(Log(N)) = 3.3 )' Do While (.UnFactored Mod p) = 0 .UnFactored = .UnFactored \ p .Phi = .Phi * p Loop End With 'skip ahead to the next multiple of p: ' '(this is what makes it so fast, never have to try prime factors that dont apply)' k += p 'repeat until we step out of the current window:' Loop While k < NextFirst 'if this is the first window, then scan ahead for primes' If IsFirstWindow Then For i = Primes(NextPrime - 1) + 1 To p ^ 2 - 1 'the range of possible new primes' 'Dont go beyond the first window' If i >= WindowSize Then Exit For If Numbers(i - FirstValue).UnFactored = i Then 'this is a prime less than SQRT(N), so add it to the list.' Primes(NextPrime) = i NextPrime += 1 End If Next End If PrimeIndex += 1 'move to the next prime' Loop 'Now Finish & Emit each one' For k = FirstValue To LastValue With Numbers(k - FirstValue) 'Primes larger than Sqrt(N) will not be finished: ' If .UnFactored > 1 Then 'Not done factoring, must be an large prime factor remaining: ' .Phi = .Phi * (.UnFactored - 1) .UnFactored = 1 End If 'Emit the value pair: (k, Phi(k)) ' EmitPhi(k, .Phi) End With Next 're-Map to the next window ' IsFirstWindow = False MapWindow(NextFirst) Loop While FirstValue <= N End Sub Sub EmitPhi(ByVal k As Long, ByVal Phi As Long) 'just a placeholder for now, that raises an event to the display form' ' periodically for reporting purposes. Change this to do the actual' ' emitting.' If (k Mod ReportInterval) = 0 Then RaiseEvent EmitTotientPair(k, Phi) End If End Sub Public Sub MapWindow(ByVal FirstVal As Long) 'Efficiently reset the window so that we do not have to re-allocate it.' 'init all of the boundary values' FirstValue = FirstVal PrevLast = FirstValue - 1 NextFirst = FirstValue + WindowSize LastValue = NextFirst - 1 'Initialize the Numbers prime factor arrays' Dim i As Long For i = 0 To WindowSize - 1 With Numbers(i) .UnFactored = i + FirstValue 'initially equal to the number itself' .Phi = 1 'starts at mulplicative identity(1)' End With Next End Sub Function PiMax(ByVal x As Long) As Long 'estimate of pi(n) == {primes <= (n)} that is never less' ' than the actual number of primes. (from P. Dusart, 1999)' Return (x / Log(x)) * (1.0 + 1.2762 / Log(x)) End Function End Class 请注意，在 O(N * Log(Log(N))) 处，该例程平均在 O(Log(Log(N))) 处分解每个数字，这比由这里的一些回复。事实上，在 N = 10^12 时，它快了2400倍！ 我已经在我的 2Ghz Intel Core 2 笔记本电脑上测试了这个例程，它每秒计算超过 3,000,000 个 Phi() 值。以这种速度，计算 10^12 个值大约需要 4 天。我还测试了它的正确性高达 100,000,000，没有任何错误。它基于 64 位整数，因此任何高达 2^63 (10^19) 的值都应该是准确的（尽管对任何人来说都太慢了）。 我还有一个用于运行/测试它的 Visual Studio WinForm（也是 VB.net），如果您需要，我可以提供。 如果您有任何问题，请告诉我。 根据评论中的要求，我在代码的 C# 版本下面添加了。不过因为我目前在做其他一些项目，没时间自己转换，所以就用了一个在线的VB到C#转换网站（http://www.carlosag.net/tools/代码翻译器/）。所以请注意，这是自动转换的，我还没有时间自己测试或检查它。 using System.Math; public class TotientSerialCalculator { // Implements an extremely efficient Serial Totient(phi) calculator ' // This implements an optimized windowed Sieve of Eratosthenes. The' // window size is set at Sqrt(N) both to optimize collecting and ' // applying all of the Primes below Sqrt(N), and to minimize ' // window-turning overhead. ' // ' // CPU complexity is O( N * Log(Log(N)) ), which is virtually linear.' // ' // MEM Complexity is O( Sqrt(N) ). ' // ' // This is probalby the ideal combination, as any attempt to further ' // reduce memory will almost certainly result in disproportionate increases' // in CPU complexity, and vice-versa. ' struct NumberFactors { private long UnFactored; // the part of the number that still needs to be factored' private long Phi; } private long ReportInterval; private long PrevLast; // the last value in the previous window' private long FirstValue; // the first value in this windows range' private long WindowSize; private long LastValue; // the last value in this windows range' private long NextFirst; // the first value in the next window' // Array that stores all of the NumberFactors in the current window.' // this is the primary memory consumption for the class and it' // is 16 * Sqrt(N) Bytes, which is O(Sqrt(N)).' public NumberFactors[] Numbers; // For N=10^12 (1 trilion), this will be 16MB, which should be bearable anywhere.' // (note that the Primes() array is a secondary memory consumer' // at O(pi(Sqrt(N)), which will be within 10x of O(Sqrt(N)))' //NOTE: this part looks like it did not convert correctly public event EventHandler EmitTotientPair; private long k; private long Phi; // ===== The Routine To Call: ========================' public void EmitTotientPairsToN(long N) { // Routine to Emit Totient pairs {k, Phi(k)} for k = 1 to N' // 2009-07-14, RBarryYoung, Created.' long i; long k; // the current number being factored' long p; // the current prime factor' // Establish the Window frame:' // note: WindowSize is the critical value that controls both memory' // usage and CPU consumption and must be SQRT(N) for it to work optimally.' WindowSize = Ceiling(Sqrt(double.Parse(N))); object Numbers; this.MapWindow(1); bool IsFirstWindow = true; ReportInterval = (N / 100); // Allocate the primes array to hold the primes list:' // Only primes <= SQRT(N) are needed for factoring' // PiMax(X) is a Max estimate of the number of primes <= X' long[] Primes; long PrimeIndex; long NextPrime; // init the primes list and its pointers' object Primes; -1; Primes[0] = 2; // "prime" the primes list with the first prime' NextPrime = 1; // Map (and Remap) the window with Sqrt(N) numbers, Sqrt(N) times to' // sequentially map all of the numbers <= N.' for ( ; (FirstValue <= N); ) { PrimeIndex = 0; // note: cant use enumerator for the loop below because NextPrime' // changes during the first window as new primes <= SQRT(N) are accumulated' while ((PrimeIndex < NextPrime)) { // get the next prime in the list' p = Primes[PrimeIndex]; // find the first multiple of (p) in the current window range' k = (PrevLast + (p - (PrevLast % p))); for ( ; (k < NextFirst); ) { // With... UnFactored; p; // always works the first time' (Phi * (p - 1)); while (// TODO: Warning!!!! NULL EXPRESSION DETECTED... ) { (UnFactored % p); UnFactored; (Phi * p); } // skip ahead to the next multiple of p: ' // (this is what makes it so fast, never have to try prime factors that dont apply)' k = (k + p); // repeat until we step out of the current window:' } // if this is the first window, then scan ahead for primes' if (IsFirstWindow) { for (i = (Primes[(NextPrime - 1)] + 1); (i <= (p | (2 - 1))); i++) { // the range of possible new primes' // TODO: Warning!!! The operator should be an XOR ^ instead of an OR, but not available in CodeDOM // Dont go beyond the first window' if ((i >= WindowSize)) { break; } if ((Numbers[(i - FirstValue)].UnFactored == i)) { // this is a prime less than SQRT(N), so add it to the list.' Primes[NextPrime] = i; NextPrime++; } } } PrimeIndex++; // move to the next prime' } // Now Finish & Emit each one' for (k = FirstValue; (k <= LastValue); k++) { // With... // Primes larger than Sqrt(N) will not be finished: ' if ((Numbers[(k - FirstValue)].UnFactored > 1)) { // Not done factoring, must be an large prime factor remaining: ' (Numbers[(k - FirstValue)].Phi * (Numbers[(k - FirstValue)].UnFactored - 1).UnFactored) = 1; Numbers[(k - FirstValue)].Phi = 1; } // Emit the value pair: (k, Phi(k)) ' this.EmitPhi(k, Numbers[(k - FirstValue)].Phi); } // re-Map to the next window ' IsFirstWindow = false; this.MapWindow(NextFirst); } } void EmitPhi(long k, long Phi) { // just a placeholder for now, that raises an event to the display form' // periodically for reporting purposes. Change this to do the actual' // emitting.' if (((k % ReportInterval) == 0)) { EmitTotientPair(k, Phi); } } public void MapWindow(long FirstVal) { // Efficiently reset the window so that we do not have to re-allocate it.' // init all of the boundary values' FirstValue = FirstVal; PrevLast = (FirstValue - 1); NextFirst = (FirstValue + WindowSize); LastValue = (NextFirst - 1); // Initialize the Numbers prime factor arrays' long i; for (i = 0; (i <= (WindowSize - 1)); i++) { // With... // initially equal to the number itself' Phi = 1; // starts at mulplicative identity(1)' } } long PiMax(long x) { // estimate of pi(n) == {primes <= (n)} that is never less' // than the actual number of primes. (from P. Dusart, 1999)' return ((x / Log(x)) * (1 + (1.2762 / Log(x)))); } } 于 2009-07-16T00:30:49.203 回答 This answer is useful 5 没有人找到比首先找到 k 的素因子更快的方法来计算 phi(k)（又名欧拉函数）。自 1977 年以来，世界上最优秀的数学家已经为这个问题投入了许多 CPU 周期，因为找到一种更快的方法来解决这个问题会导致RSA 公钥算法的弱点。（RSA 中的公钥和私钥都是根据 phi(n) 计算的，其中 n 是两个大素数的乘积。） 于 2009-06-22T03:34:35.823 回答 This answer is useful 4 phi(k) 的计算必须使用 k 的素数分解来完成，这是唯一合理的方法。如果您需要对此进行复习，维基百科带有公式。 如果您现在必须计算 1 和大 N 之间的每个数字的所有素数除数，那么您将在看到任何结果之前死于老年，所以我会反其道而行之，即构建所有低于 N 的数字，使用它们可能的素数因子，即所有小于或等于 N 的素数。 因此，您的问题将类似于计算一个数字的所有除数，只是您不知道事先在分解中可以找到某个素数的最大次数是多少。调整最初由 Tim Peters 在 python 列表中编写的迭代器（我在博客上写过的东西......）以包含 totient 函数，python 中产生 k，phi(k) 对的可能实现如下： def composites(factors, N) : """ Generates all number-totient pairs below N, unordered, from the prime factors. """ ps = sorted(set(factors)) omega = len(ps) def rec_gen(n = 0) : if n == omega : yield (1,1) else : pows = [(1,1)] val = ps[n] while val <= N : pows += [(val, val - pows[-1][0])] val *= ps[n] for q, phi_q in rec_gen(n + 1) : for p, phi_p in pows : if p * q > N : break else : yield p * q, phi_p * phi_q for p in rec_gen() : yield p 如果您在计算低于 N 的所有素数方面需要帮助，我也在博客中讨论过它......请记住，虽然计算低于 10 12的所有素数本身就是一项了不起的壮举...... 于 2009-06-21T21:34:57.373 回答 This answer is useful 1 这是来自 Project Euler 245 的吗？我记得那个问题，我已经放弃了。 我发现计算 totient 的最快方法是将素数 (p-1) 相乘，因为 k 没有重复的因数（如果我没记错问题，情况就不会如此）。 因此，对于计算因子，最好使用gmpy.next_prime或pyecm（椭圆曲线分解）。 您也可以按照 Jaime 的建议筛选主要因素。对于高达 10 12的数字，最大素因数低于 100 万应该是合理的。 如果你记住分解，它可以进一步加快你的 phi 函数。 于 2009-06-21T21:56:46.240 回答 This answer is useful 1 对于这类问题，我使用了一个迭代器，它为每个整数m < N返回除 m的素数 < sqrt( N ) 列表。为了实现这样一个迭代器，我使用了一个长度为R的数组A ，其中R > sqrt( N )。在每个点，数组A包含除以整数m .. m+R -1 的素数列表。即A [ m % R ] 包含除m的素数。每个素数p都在一个列表中，即在A [ m % R ] 中，表示范围内的最小整数m .. m + R -1 可被p整除。在生成迭代器的下一个元素时，只需返回A [ m % R ] 中的列表。然后从A [ m % R ] 中删除素数列表，并将每个素数 p 附加到A [( m + p ) % R]。 用一个素数列表 < sqrt( N ) 除m，很容易找到m的因式分解，因为最多有一个素数大于 sqrt( N )。 该方法的复杂度为 O( N log(log( N )))，假设包括列表操作在内的所有操作都需要 O(1)。内存要求为 O(sqrt( N ))。 不幸的是，这里有一些恒定的开销，因此我一直在寻找一种更优雅的方式来生成值 phi(n)，但因此我没有成功。 于 2009-06-23T06:45:43.250 回答 This answer is useful 1 这是一个高效的python生成器。需要注意的是，它不会按顺序产生结果。它基于https://stackoverflow.com/a/10110008/412529。 内存复杂度为 O(log(N))，因为它一次只需要存储单个数字的素因子列表。 CPU 复杂度几乎不是超线性的，例如 O(N log log N)。 def totientsbelow(N): allprimes = primesbelow(N+1) def rec(n, partialtot=1, min_p = 0): for p in allprimes: if p > n: break # avoid double solutions such as (6, [2,3]), and (6, [3,2]) if p < min_p: continue yield (p, p-1, [p]) for t, tot2, r in rec(n//p, partialtot, min_p = p): # uses integer division yield (t*p, tot2 * p if p == r[0] else tot2 * (p-1), [p] + r) for n, t, factors in rec(N): yield (n, t) 于 2012-12-24T04:34:10.410 回答 This answer is useful 0 我想你可以反过来。您可以尝试从素数生成从 1 到 N 的所有整数并快速获得 phi(k)，而不是分解整数 k 以获得 phi(k)。例如，如果 P n是小于 N 的最大素数，则可以通过以下方式生成所有小于 N 的整数 P 1 i 1 * P 2 i 2 * ... * P n i n其中每个 i j从 0 运行到 [log (N) / log (P j )] （[] 是底函数）。 这样，您无需昂贵的素数分解即可快速获得 phi(k)，并且仍然遍历 1 和 N 之间的所有 k（不是按顺序，但我认为您不关心顺序）。 于 2009-07-12T22:56:42.150 回答 This answer is useful 0 将 totients 筛分到n： (define (totients n) (let ((tots (make-vector (+ n 1)))) (do ((i 0 (+ i 1))) ((< n i)) (vector-set! tots i i)) (do ((i 2 (+ i 1))) ((< n i) tots) (when (= i (vector-ref tots i)) (vector-set! tots i (- i 1)) (do ((j (+ i i) (+ i j))) ((< n j)) (vector-set! tots j (* (vector-ref tots j) (- 1 (/ i))))))))) 于 2012-05-06T14:23:34.510 回答 This answer is useful 0 这分解了 N = PQ，其中 P 和 Q 是素数。 在 Elixir 或 Erlang 中运行良好。 您可以为伪随机序列尝试不同的生成器。x*x + 1是常用的。 这一行：defp f0(x, n), do: rem((x * x) + 1, n) 其他可能的改进点：更好或替代的gcd、rem和abs函数 defmodule Factorizer do def factorize(n) do t = System.system_time x = pollard(n, 2_000_000, 2_000_000) y = div(n, x) p = min(x, y) q = max(x, y) t = System.system_time - t IO.puts " Factorized #{n}: into [#{p} , #{q}] in #{t} μs " {p, q} end defp gcd(a,0), do: a defp gcd(a,b), do: gcd(b,rem(a,b)) defp pollard(n, a, b) do a = f0(a, n) b = f0(f0(b, n), n) p = gcd(abs(b - a), n) case p > 1 do true -> p false -> pollard(n, a, b) end end defp f0(x, n), do: rem((x * x) + 1, n) end 于 2016-06-19T02:32:14.930 回答 Related 1 delphi - 用C#处理delphi activeX控件事件 1 sql - 从 FitNesse 中具有单个标识列的表中获取标识值 1 iphone - 在ios中进入前台时显示黑屏 1 sql-server - 无法通过分页选择每个项目类别中的“n”条记录 6 c# - C# 和 sql 服务器 0 android - 安卓造型设计 2 google-chrome - Chrome 打包应用程序/pdf.js 11 android - 如何在 RatingBar 中设置星星的自定义大小 1 vba - Excel 宏：如何从其他 Excel 文件中提取数据 1 jdedwards - 如何以日期格式过滤 JDE 对象浏览器的数据？ Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：1024640
> 
> 赞同：14
> 
> 时间：
> 
> 标签：algorithm, math, big-o, primes

给定一个大的 N，我需要遍历所有 phi(k) 使得 1 < k < N ：

*   时间复杂度必须是`O(N logN)`
*   memory-complexity 必须是 sub `O(N)`（因为 N 的值将在 10 ^(12)左右）

是否可以？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-07-16T00:30:49.203

这可以通过内存复杂度 O(Sqrt(N)) 和 CPU 复杂度 O(N * Log(Log(N))) 以及优化的 Eratosthenes 窗口筛来完成，如下面的代码示例中实现的。

由于没有指定语言并且我不了解 Python，我已经在 VB.net 中实现了它，但是如果您需要，我可以将其转换为 C#。

```
Imports System.Math

Public Class TotientSerialCalculator
    'Implements an extremely efficient Serial Totient(phi) calculator   '
    '  This implements an optimized windowed Sieve of Eratosthenes.  The'
    ' window size is set at Sqrt(N) both to optimize collecting and     '
    ' applying all of the Primes below Sqrt(N), and to minimize         '
    ' window-turning overhead.                                          '
    '                                                                   '
    ' CPU complexity is O( N * Log(Log(N)) ), which is virtually linear.'
    '                                                                   '
    ' MEM Complexity is O( Sqrt(N) ).                                   '
    '                                                                   '
    ' This is probalby the ideal combination, as any attempt to further '
    'reduce memory will almost certainly result in disproportionate increases'
    'in CPU complexity, and vice-versa.                                 '

    Structure NumberFactors
        Dim UnFactored As Long  'the part of the number that still needs to be factored'
        Dim Phi As Long 'the totient value progressively calculated'
        '               (equals total numbers less than N that are CoPrime to N)'
        'MEM = 8 bytes each'
    End Structure

    Private ReportInterval As Long
    Private PrevLast As Long     'the last value in the previous window'
    Private FirstValue As Long   'the first value in this windows range'
    Private WindowSize As Long
    Private LastValue As Long    'the last value in this windows range'
    Private NextFirst As Long    'the first value in the next window'

    'Array that stores all of the NumberFactors in the current window.'
    ' this is the primary memory consumption for the class and it'
    ' is 16 * Sqrt(N) Bytes, which is O(Sqrt(N)).'
    Public Numbers() As NumberFactors
    ' For N=10^12 (1 trilion), this will be 16MB, which should be bearable anywhere.'
    '(note that the Primes() array is a secondary memory consumer'
    '  at O(pi(Sqrt(N)), which will be within 10x of O(Sqrt(N)))'

    Public Event EmitTotientPair(ByVal k As Long, ByVal Phi As Long)

    '===== The Routine To Call: ========================'
    Public Sub EmitTotientPairsToN(ByVal N As Long)
        'Routine to Emit Totient pairs {k, Phi(k)} for k = 1 to N'
        '   2009-07-14, RBarryYoung, Created.'
        Dim i As Long
        Dim k As Long   'the current number being factored'
        Dim p As Long   'the current prime factor'

        'Establish the Window frame:'
        '   note: WindowSize is the critical value that controls both memory'
        '    usage and CPU consumption and must be SQRT(N) for it to work optimally.'
        WindowSize = Ceiling(Sqrt(CDbl(N)))
        ReDim Numbers(0 To WindowSize - 1)

        'Initialize the first window:'
        MapWindow(1)
        Dim IsFirstWindow As Boolean = True

        'adjust this to control how often results are show'
        ReportInterval = N / 100

        'Allocate the primes array to hold the primes list:'
        '  Only primes <= SQRT(N) are needed for factoring'
        '  PiMax(X) is a Max estimate of the number of primes <= X'
        Dim Primes() As Long, PrimeIndex As Long, NextPrime As Long
        'init the primes list and its pointers'
        ReDim Primes(0 To PiMax(WindowSize) - 1)
        Primes(0) = 2   '"prime" the primes list with the first prime'
        NextPrime = 1

        'Map (and Remap) the window with Sqrt(N) numbers, Sqrt(N) times to'
        ' sequentially map all of the numbers <= N.'
        Do
            'Sieve the primes across the current window'
            PrimeIndex = 0
            'note: cant use enumerator for the loop below because NextPrime'
            ' changes during the first window as new primes <= SQRT(N) are accumulated'
            Do While PrimeIndex < NextPrime
                'get the next prime in the list'
                p = Primes(PrimeIndex)
                'find the first multiple of (p) in the current window range'
                k = PrevLast + p - (PrevLast Mod p)

                Do
                    With Numbers(k - FirstValue)
                        .UnFactored = .UnFactored \ p   'always works the first time'
                        .Phi = .Phi * (p - 1)           'Phi = PRODUCT( (Pi-1)*Pi^(Ei-1) )'
                        'The loop test that follows is probably the central CPU overhead'
                        ' I believe that it is O(N*Log(Log(N)), which is virtually O(N)'
                        ' ( for instance at N = 10^12, Log(Log(N)) = 3.3 )'
                        Do While (.UnFactored Mod p) = 0
                            .UnFactored = .UnFactored \ p
                            .Phi = .Phi * p
                        Loop
                    End With

                    'skip ahead to the next multiple of p: '
                    '(this is what makes it so fast, never have to try prime factors that dont apply)'
                    k += p
                    'repeat until we step out of the current window:'
                Loop While k < NextFirst

                'if this is the first window, then scan ahead for primes'
                If IsFirstWindow Then
                    For i = Primes(NextPrime - 1) + 1 To p ^ 2 - 1  'the range of possible new primes'
                        'Dont go beyond the first window'
                        If i >= WindowSize Then Exit For
                        If Numbers(i - FirstValue).UnFactored = i Then
                            'this is a prime less than SQRT(N), so add it to the list.'
                            Primes(NextPrime) = i
                            NextPrime += 1
                        End If
                    Next
                End If

                PrimeIndex += 1     'move to the next prime'
            Loop

            'Now Finish & Emit each one'
            For k = FirstValue To LastValue
                With Numbers(k - FirstValue)
                    'Primes larger than Sqrt(N) will not be finished: '
                    If .UnFactored > 1 Then
                        'Not done factoring, must be an large prime factor remaining: '
                        .Phi = .Phi * (.UnFactored - 1)
                        .UnFactored = 1
                    End If

                    'Emit the value pair: (k, Phi(k)) '
                    EmitPhi(k, .Phi)
                End With
            Next

            're-Map to the next window '
            IsFirstWindow = False
            MapWindow(NextFirst)
        Loop While FirstValue <= N
    End Sub

    Sub EmitPhi(ByVal k As Long, ByVal Phi As Long)
        'just a placeholder for now, that raises an event to the display form' 
        ' periodically for reporting purposes.  Change this to do the actual'
        ' emitting.'
        If (k Mod ReportInterval) = 0 Then
            RaiseEvent EmitTotientPair(k, Phi)
        End If
    End Sub

    Public Sub MapWindow(ByVal FirstVal As Long)
        'Efficiently reset the window so that we do not have to re-allocate it.'

        'init all of the boundary values'
        FirstValue = FirstVal
        PrevLast = FirstValue - 1
        NextFirst = FirstValue + WindowSize
        LastValue = NextFirst - 1

        'Initialize the Numbers prime factor arrays'
        Dim i As Long
        For i = 0 To WindowSize - 1
            With Numbers(i)
                .UnFactored = i + FirstValue 'initially equal to the number itself'
                .Phi = 1        'starts at mulplicative identity(1)'
            End With
        Next
    End Sub

    Function PiMax(ByVal x As Long) As Long
        'estimate of pi(n) == {primes <= (n)} that is never less'
        ' than the actual number of primes. (from P. Dusart, 1999)'
        Return (x / Log(x)) * (1.0 + 1.2762 / Log(x))
    End Function
End Class 
```

请注意，在 O(N * Log(Log(N))) 处，该例程平均在 O(Log(Log(N))) 处分解每个数字，这比由这里的一些回复。事实上，在 N = 10^12 时，它快了***2400***倍！

我已经在我的 2Ghz Intel Core 2 笔记本电脑上测试了这个例程，它每秒计算超过 3,000,000 个 Phi() 值。以这种速度，计算 10^12 个值大约需要 4 天。我还测试了它的正确性高达 100,000,000，没有任何错误。它基于 64 位整数，因此任何高达 2^63 (10^19) 的值都应该是准确的（尽管对任何人来说都太慢了）。

我还有一个用于运行/测试它的 Visual Studio WinForm（也是 VB.net），如果您需要，我可以提供。

如果您有任何问题，请告诉我。

* * *

根据评论中的要求，我在代码的 C# 版本下面添加了。不过因为我目前在做其他一些项目，没时间自己转换，所以就用了一个在线的VB到C#转换网站（[http://www.carlosag.net/tools/代码翻译器/](http://www.carlosag.net/tools/codetranslator/)）。所以请注意，这是自动转换的，我还没有时间自己测试或检查它。

```
using System.Math;
public class TotientSerialCalculator {

    // Implements an extremely efficient Serial Totient(phi) calculator   '
    //   This implements an optimized windowed Sieve of Eratosthenes.  The'
    //  window size is set at Sqrt(N) both to optimize collecting and     '
    //  applying all of the Primes below Sqrt(N), and to minimize         '
    //  window-turning overhead.                                          '
    //                                                                    '
    //  CPU complexity is O( N * Log(Log(N)) ), which is virtually linear.'
    //                                                                    '
    //  MEM Complexity is O( Sqrt(N) ).                                   '
    //                                                                    '
    //  This is probalby the ideal combination, as any attempt to further '
    // reduce memory will almost certainly result in disproportionate increases'
    // in CPU complexity, and vice-versa.                                 '
    struct NumberFactors {

        private long UnFactored;  // the part of the number that still needs to be factored'
        private long Phi;
    }

    private long ReportInterval;
    private long PrevLast;       // the last value in the previous window'
    private long FirstValue;     // the first value in this windows range'
    private long WindowSize;
    private long LastValue;      // the last value in this windows range'
    private long NextFirst;      // the first value in the next window'

    // Array that stores all of the NumberFactors in the current window.'
    //  this is the primary memory consumption for the class and it'
    //  is 16 * Sqrt(N) Bytes, which is O(Sqrt(N)).'
    public NumberFactors[] Numbers;
    //  For N=10^12 (1 trilion), this will be 16MB, which should be bearable anywhere.'
    // (note that the Primes() array is a secondary memory consumer'
    //   at O(pi(Sqrt(N)), which will be within 10x of O(Sqrt(N)))'

//NOTE: this part looks like it did not convert correctly
    public event EventHandler EmitTotientPair;
    private long k;
    private long Phi;

    // ===== The Routine To Call: ========================'
    public void EmitTotientPairsToN(long N) {
        // Routine to Emit Totient pairs {k, Phi(k)} for k = 1 to N'
        //    2009-07-14, RBarryYoung, Created.'
        long i;
        long k;
        // the current number being factored'
        long p;
        // the current prime factor'
        // Establish the Window frame:'
        //    note: WindowSize is the critical value that controls both memory'
        //     usage and CPU consumption and must be SQRT(N) for it to work optimally.'
        WindowSize = Ceiling(Sqrt(double.Parse(N)));
        object Numbers;
        this.MapWindow(1);
        bool IsFirstWindow = true;
        ReportInterval = (N / 100);
        // Allocate the primes array to hold the primes list:'
        //   Only primes <= SQRT(N) are needed for factoring'
        //   PiMax(X) is a Max estimate of the number of primes <= X'
        long[] Primes;
        long PrimeIndex;
        long NextPrime;
        // init the primes list and its pointers'
        object Primes;
        -1;
        Primes[0] = 2;
        // "prime" the primes list with the first prime'
        NextPrime = 1;
        // Map (and Remap) the window with Sqrt(N) numbers, Sqrt(N) times to'
        //  sequentially map all of the numbers <= N.'
        for (
        ; (FirstValue <= N); 
        ) {
            PrimeIndex = 0;
            // note: cant use enumerator for the loop below because NextPrime'
            //  changes during the first window as new primes <= SQRT(N) are accumulated'
            while ((PrimeIndex < NextPrime)) {
                // get the next prime in the list'
                p = Primes[PrimeIndex];
                // find the first multiple of (p) in the current window range'
                k = (PrevLast 
                            + (p 
                            - (PrevLast % p)));
                for (
                ; (k < NextFirst); 
                ) {
                    // With...
                    UnFactored;
                    p;
                    // always works the first time'
                    (Phi 
                                * (p - 1));
                    while (// TODO: Warning!!!! NULL EXPRESSION DETECTED...
                    ) {
                        (UnFactored % p);
                        UnFactored;
                        (Phi * p);
                    }

                    // skip ahead to the next multiple of p: '
                    // (this is what makes it so fast, never have to try prime factors that dont apply)'
                    k = (k + p);
                    // repeat until we step out of the current window:'
                }

                // if this is the first window, then scan ahead for primes'
                if (IsFirstWindow) {
                    for (i = (Primes[(NextPrime - 1)] + 1); (i 
                                <= (p | (2 - 1))); i++) {
                        // the range of possible new primes'
                        // TODO: Warning!!! The operator should be an XOR ^ instead of an OR, but not available in CodeDOM
                        // Dont go beyond the first window'
                        if ((i >= WindowSize)) {
                            break;
                        }

                        if ((Numbers[(i - FirstValue)].UnFactored == i)) {
                            // this is a prime less than SQRT(N), so add it to the list.'
                            Primes[NextPrime] = i;
                            NextPrime++;
                        }

                    }

                }

                PrimeIndex++;
                // move to the next prime'
            }

            // Now Finish & Emit each one'
            for (k = FirstValue; (k <= LastValue); k++) {
                // With...
                // Primes larger than Sqrt(N) will not be finished: '
                if ((Numbers[(k - FirstValue)].UnFactored > 1)) {
                    // Not done factoring, must be an large prime factor remaining: '
                    (Numbers[(k - FirstValue)].Phi * (Numbers[(k - FirstValue)].UnFactored - 1).UnFactored) = 1;
                    Numbers[(k - FirstValue)].Phi = 1;
                }

                // Emit the value pair: (k, Phi(k)) '
                this.EmitPhi(k, Numbers[(k - FirstValue)].Phi);
            }

            // re-Map to the next window '
            IsFirstWindow = false;
            this.MapWindow(NextFirst);
        }

    }

    void EmitPhi(long k, long Phi) {
        // just a placeholder for now, that raises an event to the display form' 
        //  periodically for reporting purposes.  Change this to do the actual'
        //  emitting.'
        if (((k % ReportInterval) 
                    == 0)) {
            EmitTotientPair(k, Phi);
        }

    }

    public void MapWindow(long FirstVal) {
        // Efficiently reset the window so that we do not have to re-allocate it.'
        // init all of the boundary values'
        FirstValue = FirstVal;
        PrevLast = (FirstValue - 1);
        NextFirst = (FirstValue + WindowSize);
        LastValue = (NextFirst - 1);
        // Initialize the Numbers prime factor arrays'
        long i;
        for (i = 0; (i 
                    <= (WindowSize - 1)); i++) {
            // With...
            // initially equal to the number itself'
            Phi = 1;
            // starts at mulplicative identity(1)'
        }

    }

    long PiMax(long x) {
        // estimate of pi(n) == {primes <= (n)} that is never less'
        //  than the actual number of primes. (from P. Dusart, 1999)'
        return ((x / Log(x)) * (1 + (1.2762 / Log(x))));
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-22T03:34:35.823

没有人找到比首先找到 k 的素因子更快的方法来计算 phi(k)（又[名欧拉函数）。](http://en.wikipedia.org/wiki/Euler%27s_totient_function)自 1977 年以来，世界上最优秀的数学家已经为这个问题投入了许多 CPU 周期，因为找到一种更快的方法来解决这个问题会导致[RSA 公钥算法](http://en.wikipedia.org/wiki/RSA_algorithm)的弱点。（RSA 中的公钥和私钥都是根据 phi(n) 计算的，其中 n 是两个大素数的乘积。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-21T21:34:57.373

phi(k) 的计算必须使用 k 的素数分解来完成，这是唯一合理的方法。如果您需要对此进行复习，[维基百科带有公式](http://en.wikipedia.org/wiki/Euler%27s_totient_function#Computing_Euler.27s_function)。

如果您现在必须计算 1 和大 N 之间的每个数字的所有素数除数，那么您将在看到任何结果之前死于老年，所以我会反其道而行之，即构建所有低于 N 的数字，使用它们可能的素数因子，即所有小于或等于 N 的素数。

因此，您的问题将类似于计算一个数字的所有除数，只是您不知道事先在分解中可以找到某个素数的最大次数是多少。调整最初由 Tim Peters 在 python 列表中编写的迭代器（[我在博客](http://numericalrecipes.wordpress.com/2009/05/13/divisors/)上写过的东西......）以包含 totient 函数，python 中产生 k，phi(k) 对的可能实现如下：

```
def composites(factors, N) :
    """
    Generates all number-totient pairs below N, unordered, from the prime factors.
    """
    ps = sorted(set(factors))
    omega = len(ps)

    def rec_gen(n = 0) :
        if n == omega :
            yield (1,1)
        else :
            pows = [(1,1)]
            val = ps[n]
            while val <= N :
                pows += [(val, val - pows[-1][0])]
                val *= ps[n]
            for q, phi_q in rec_gen(n + 1) :
                for p, phi_p in pows :
                    if p * q > N :
                        break
                    else :
                        yield p * q, phi_p * phi_q

    for p in rec_gen() :
        yield p 
```

如果您在计算低于 N 的所有素数方面需要帮助，我也在[博客中讨论过它](http://numericalrecipes.wordpress.com/2009/03/16/prime-numbers-2-the-sieve-of-erathostenes/)......请记住，虽然计算低于 10 ^(12)的所有素数本身就是一项了不起的壮举......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T21:56:46.240

这是来自 Project Euler 245 的吗？我记得那个问题，我已经放弃了。

我发现计算 totient 的最快方法是将素数 (p-1) 相乘，因为 k 没有重复的因数（如果我没记错问题，情况就不会如此）。

因此，对于计算因子，最好使用[gmpy.next_prime](http://gmpy.sourceforge.net/)或[pyecm](http://sourceforge.net/projects/pyecm)（椭圆曲线分解）。

您也可以按照 Jaime 的建议筛选主要因素。对于高达 10 ^(12)的数字，最大素因数低于 100 万应该是合理的。

如果你记住分解，它可以进一步加快你的 phi 函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-23T06:45:43.250

对于这类问题，我使用了一个迭代器，它为每个整数*m < N*返回除 m的素数 < sqrt( *N* ) 列表。为了实现这样一个迭代器，我使用了一个长度为*R的数组**A* ，其中*R* > sqrt( *N* )。在每个点，数组*A*包含除以整数*m .. m+R* -1 的素数列表。即*A* [ *m* % *R* ] 包含除*m*的素数。每个素数*p*都在一个列表中，即在*A* [ *m* % *R* ] 中，表示范围内的最小整数**************m* .. *m* + *R* -1 可被*p*整除。在生成迭代器的下一个元素时，只需返回*A* [ *m* % *R* ] 中的列表。然后从*A* [ *m* % *R* ] 中删除素数列表，并将每个素数 p 附加到*A* [( *m* + *p* ) % R]。*************

 **用一个素数列表 < sqrt( *N* ) 除*m*，很容易找到*m*的因式分解，因为最多有一个素数大于 sqrt( *N* )。

该方法的复杂度为 O( *N* log(log( *N* )))，假设包括列表操作在内的所有操作都需要 O(1)。内存要求为 O(sqrt( *N* ))。

不幸的是，这里有一些恒定的开销，因此我一直在寻找一种更优雅的方式来生成值 phi(n)，但因此我没有成功。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-24T04:34:10.410

这是一个高效的python生成器。需要注意的是，它不会按顺序产生结果。它基于[https://stackoverflow.com/a/10110008/412529](https://stackoverflow.com/a/10110008/412529)。

内存复杂度为 O(log(N))，因为它一次只需要存储单个数字的素因子列表。

CPU 复杂度几乎不是超线性的，例如 O(N log log N)。

```
def totientsbelow(N):
    allprimes = primesbelow(N+1)
    def rec(n, partialtot=1, min_p = 0):
        for p in allprimes:
            if p > n:
                break
            # avoid double solutions such as (6, [2,3]), and (6, [3,2])
            if p < min_p: continue
            yield (p, p-1, [p])
            for t, tot2, r in rec(n//p, partialtot, min_p = p): # uses integer division
                yield (t*p, tot2 * p if p == r[0] else tot2 * (p-1), [p] + r)

    for n, t, factors in rec(N):
        yield (n, t) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-12T22:56:42.150

我想你可以反过来。您可以尝试从素数生成从 1 到 N 的所有整数并快速获得 phi(k)，而不是分解整数 k 以获得 phi(k)。例如，如果 P [n]是小于 N 的最大素数，则可以通过以下方式生成所有小于 N 的整数

P [1] ^(i [1]) * P [2] ^(i [2]) * ... * P [n] ^(i [n])其中每个 i [j]从 0 运行到 [log (N) / log (P [j] )] （[] 是底函数）。

这样，您无需昂贵的素数分解即可快速获得 phi(k)，并且仍然遍历 1 和 N 之间的所有 k（不是按顺序，但我认为您不关心顺序）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-06T14:23:34.510

将 totients 筛分到*n*：

```
(define (totients n)
  (let ((tots (make-vector (+ n 1))))
    (do ((i 0 (+ i 1))) ((< n i))
      (vector-set! tots i i))
    (do ((i 2 (+ i 1))) ((< n i) tots)
      (when (= i (vector-ref tots i))
        (vector-set! tots i (- i 1))
        (do ((j (+ i i) (+ i j))) ((< n j))
          (vector-set! tots j
            (* (vector-ref tots j) (- 1 (/ i))))))))) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-06-19T02:32:14.930

这分解了 N = PQ，其中 P 和 Q 是素数。

在 Elixir 或 Erlang 中运行良好。

您可以为伪随机序列尝试不同的生成器。`x*x + 1`是常用的。

这一行：`defp f0(x, n), do: rem((x * x) + 1, n)`

其他可能的改进点：更好或替代的*gcd*、*rem*和*abs*函数

```
defmodule Factorizer do

  def factorize(n) do
    t = System.system_time

    x = pollard(n, 2_000_000, 2_000_000)
    y = div(n, x)
    p = min(x, y)
    q = max(x, y)

    t = System.system_time - t

    IO.puts "
Factorized #{n}: into [#{p} , #{q}] in #{t} μs
"

    {p, q}
  end

  defp gcd(a,0), do: a
  defp gcd(a,b), do: gcd(b,rem(a,b))

  defp pollard(n, a, b) do
    a = f0(a, n)
    b = f0(f0(b, n), n)

    p = gcd(abs(b - a), n)

    case p > 1 do
      true  -> p
      false -> pollard(n, a, b)
    end
  end

  defp f0(x, n), do: rem((x * x) + 1, n)

end 
```**

# c# - 使用 ado.net 实体框架对 gridview 进行排序

> ID：1024642
> 
> 赞同：1
> 
> 时间：2009-06-21T20:03:48.837
> 
> 标签：c#, .net, asp.net, entity-framework

我使用下面的代码来填充我的 gridview 但我需要对 gridview 进行排序。我如何在 Ado.net enttiy 框架中做到这一点？（如果用 ado.net 实体填充 gridview，则对 gridview 进行排序）

```
 void LoadStaffPersonel()
        {
            int selectedDepartman = Convert.ToInt32(Request.QueryString["SelectedDepartmanID"]);
            string name = "";
            using (staffContext = new StaffManagementEntities())
            {
 name = staffContext.Departman.Where(d => d.ID == selectedDepartman).First().Name;

                ObjectResult<StaffsPersonel> personalData = staffContext.GetPersonelData(name);
                gvPersonel.DataSource = personalData.ToList();
                gvPersonel.DataBind();
            }
        }
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T20:19:22.673

您将需要在页面上使用“EntityDataSource”，并使用它来提供排序和分页。有关详细信息，请参阅[MSDN 文档。](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.entitydatasource.aspx)

如果您通过发出 .ToList() 调用“具体化”您的数据列表，您将失去所有这些功能。

# loops - Applescript 相当于“继续”？

> ID：1024643
> 
> 赞同：41
> 
> 时间：2009-06-21T20:03:59.960
> 
> 标签：loops, applescript, continue

我在 AppleScript 中有一个简单的“重复”，并且想有条件地转到“重复”中的下一个项目。基本上我正在寻找其他语言中类似于“继续”（或中断？）的东西。

我不精通 AppleScript，但我发现它现在有用几次。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-06-23T21:10:25.413

在搜索了这个确切的问题后，我在网上找到了这[本书的摘录。](http://books.google.com/books?id=BYy0OKcwUxsC&pg=PA284&lpg=PA284&dq=applescript+continue+next+iteration+repeat)它准确地回答了如何跳过当前迭代并直接跳到循环的下一个迭代的问题`repeat`。

Applescript has `exit repeat`，它将完全结束一个循环，跳过所有剩余的迭代。这在无限循环中很有用，但在这种情况下不是我们想要的。

显然`continue`AppleScript 中不存在类似 - 的功能，但这里有一个模拟它的技巧：

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList -- # actual loop
    repeat 1 times -- # fake loop
        set value to item 1 of anItem

        if value = "3" then exit repeat -- # simulated `continue`

        display dialog value
    end repeat
end repeat 
```

这将显示 1、2、4 和 5 的对话框。

在这里，您创建了两个循环：外循环是您的实际循环，内循环是只重复一次的循环。将`exit repeat`退出内循环，继续外循环：正是我们想要的！

显然，如果你使用这个，你将失去做一个正常的能力`exit repeat`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-11-07T21:31:12.983

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList -- # actual loop
    try
        set value to item 1 of anItem

        if value = "3" then error 0 -- # simulated `continue`

        log value
    end try
end repeat 
```

这仍然会给你“退出重复”的可能性

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-15T07:57:10.380

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList -- # actual loop
    try -- # needed to simulate continue
        set value to item 1 of anItem
        if value = "3" then continueRepeat -- # simulated `continue` throws an error to exit the try block

        log value
    on error e
        if e does not contain "continueRepeat" then error e -- # Keeps error throwing intact
    end try
end repeat 
```

基于上面基于 try 块的方法，但读取效果稍好。当然，由于没有定义 continueRepeat ，因此会抛出一个错误，从而导致 try 块的其余部分被跳过。

为了保持错误抛出的完整性，包括抛出任何意外错误的 on error 子句。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-02-20T15:10:36.370

-- 或者你可以使用不同的策略：使用循环来循环，并在处理程序中执行条件逻辑，如下所示：

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList
   doConditionalWork(anItem as string)
end repeat

on doConditionalWork(value)

   if value = "3" then return

   display dialog value

end doConditionalWork 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-22T18:09:04.753

你们都把它复杂化了。尝试这个：

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList
    set value to item 1 of anItem
    if value is not "3" then log value
end repeat 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-01-24T17:35:06.013

您还可以对仅有条件地重复的循环使用“repeat while”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-02-16T12:30:06.040

根据 Tom Lokhorst 的[回答](https://stackoverflow.com/a/1035260/3423324)，这里有一个变体，可以根据您设置的变量执行`break`or 。为此，在外部（非假）循环的末尾，您添加`continue``isExit`

```
if isExit then
    exit repeat
end if 
```

这样如果`isExit`为真，您也只需退出外循环，成为有效的`break`.

### 原始问题/答案：

对于原始问题问题，这看起来像这样，下面将是一个概括的问题。

```
set aList to {"1", "2", "3", "4", "5"}

repeat with anItem in aList -- actual loop
    set isExit to false
    repeat 1 times -- fake loop
        -- do your stuff
        set value to item 1 of anItem

        if value = "3" then 
            -- simulated `continue`
            set isExit to false
            exit repeat
        end if

        if value = "69" then 
        -- simulated `break`
            set isExit to true
            exit repeat
        end if

        display dialog value
    end repeat

    if isExit then
        exit repeat
    end if
end repeat 
```

### 广义的

因此，将其分解为一个更简单的示例：

假设您希望在这两个s中拥有一个`continue`或其中一个。您可以将所有代码放在它们之间，我只包含与不同退出策略相关的代码。`break``if`

如果你想写这样的东西：

```
repeat <condition_repeat>
    if <condition_continue> then
        continue
    end if
    if <condition_break> then
        break
    end if
end repeat 
```

那可以写成

```
repeat <condition_repeat>
    set isExit to false                -- added 
    repeat 1 times                     -- added 
        if <condition_continue> then
            set isExit to false        -- changed
            exit repeat                -- changed
        end if
        if <condition_break> then
            set isExit to true         -- changed
            exit repeat                -- changed
        end if
    end repeat                         -- added
    if isExit then                     -- added
        exit repeat                    -- added
    end if                             -- added
end repeat 
```

# css - 在 img 标签中让透明 PNG 在 IE 6 中工作

> ID：1024644
> 
> 赞同：1
> 
> 时间：2009-06-21T20:04:30.257
> 
> 标签：css, transparency

我有一个透明背景的 png 在 IE 6 中不起作用。我通过用 DIV 替换使用该图像的几个 img 标签解决了这个问题，在 CSS 中我使用：

```
#div {filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="./Images/img.png")} 
```

我遇到的问题是我会丢失 alt 和 title 属性，这不会使网站非常易于访问。如果我将上面的 CSS 与 img 标签一起使用，我会看到正确的图像，但它上面有一个大的“X”，当 IE 无法显示图像时它会显示。

关于如何通过在 IMG 标签中正确显示透明度来让 IE 运行的任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T20:12:11.630

您可以继续使用 DIV 标记但仍可访问的一种方法是在 DIV 元素中放置第二个 SPAN 标记并将 ALT 的值放入其中，然后将其设置为不在页面之外...例如...

```
div.image {
    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="./Images/img.png");
}

div.image span {
    position : absolute;
    top : -9999px;
} 
```

然后HTML看起来像这样......

```
<div class="image" title="The title for the image" >
    <span>The ALT Text</span>
</div> 
```

标题标签仍然可以在 DIV 上使用，所以你应该没问题。

我认为您不能简单地隐藏文本（如 display:none;），因为我认为屏幕阅读器会尊重该规则（如不阅读）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:12:47.820

您可以使用 javascript 在 ie6 中启用透明度。你可以找到很多例子。这是我用过的链接。

[http://jquery.andreaseberhard.de/pngFix/](http://jquery.andreaseberhard.de/pngFix/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T20:17:27.530

另一种选择是将 htc 用于 ie6 - 请参阅此处以获取解决方案：

[http://www.twinhelix.com/css/iepngfix/](http://www.twinhelix.com/css/iepngfix/)

只需要在您的 css 文件中添加额外的行 - 抱歉仍然可能需要 javascript - 不太确定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T21:38:50.970

IE6 支持 PNG-8 透明度，但不支持 PNG-24。我最喜欢“修复”IE6 的工具之一是[IE8.js。](http://code.google.com/p/ie7-js/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T20:13:38.083

几个月前，我使用了一个小型 javascript 工具来解决这个问题。它被命名为[Unit PNG FIX](http://labs.unitinteractive.com/unitpngfix.php)，它非常易于使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-21T20:19:05.360

虽然这里有人为此提供了 JS 实现，但该解决方案也将在 FF 和其他浏览器上执行。有更好的想法，例如使用 MS 技术 :)

其中一个使用称为 HTC 的东西（如果我没记错的话，超文本组件）。这有点像......行为的CSS。它实际上是一个 XML 文件，可让您将一些功能附加到 CSS 选择器。同样，只有 MS 的技术。

总之，访问这个网站： http: [//www.twinhelix.com/css/iepngfix/](http://www.twinhelix.com/css/iepngfix/)

我在一个drupal模块中使用它，我很高兴。如果您想知道，这是模块：[http ://drupal.org/project/pngbehave](http://drupal.org/project/pngbehave)

注意：这在 IE 测试器下不起作用：[http](http://www.my-debugbar.com/wiki/IETester/HomePage) ://www.my-debugbar.com/wiki/IETester/HomePage 我正在使用带有 IE6 的 Windows 2000（如果你必须知道，在 vmware 下运行）来测试 IE6 站点.

# regex - 匹配关键字后提取值

> ID：1024647
> 
> 赞同：1
> 
> 时间：2009-06-21T20:05:56.353
> 
> 标签：regex, perl

我想在字符串中多次匹配关键字“coor”后提取值。我的代码根本不这样做。任何人都可以帮我解决它吗？

我的代码：

```
my $str = ;
if ($str =~ /$keyword/)
{
  if ($' =~ /\[/) #'# everything after the matched string
  {
    $str=~ /\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s/;
    {
      open( my $file, '>>', $filename );
      print {$file} $1, " ";
      print {$file} $2, " ";
      print {$file} $3, " ";
      print {$file} $4, " ";
      print {$file} $5, " ";
      print {$file} $6, " ";
      print {$file} $7, " ";
      print {$file} $8, " ";
      close( $file );
    }
  }
} 
```

这是我的输入字符串：

```
[(beginKey object1 (coor 141 257) (coor 1315 254) (coor 1313 430) (coor 140 420) [] [] []), (beginKey keyword (coor 2035 253) (coor 1315 254) (coor 1313 430) (coor 2034 436) [] [] [])].
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T01:10:01.153

在这种情况下，在标量上下文中使用 Perl 的`\G`锚点很有用，因为它会从上一个`//g`匹配项停止的地方继续：

```
if (/keyword/g) {
  my @coor;

  while (/\G\s*\(coor (\d+) (\d+)\)/g) {
    push @coor => [$1, $2];
  }

  for (@coor) {
    print "@$_\n";
  }
} 
```

`$_`设置为您的示例输入，上面的代码输出

```
2035 253
1315 254
1313 430
2034 436 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:40:06.097

您需要转义正则表达式中的特殊字符：

```
(coor (1) (2)) => \(coor (1) (2)\) 
```

与 /[/ 相同，这是一个语法错误 => /[/

这是我修改后的脚本版本，正则表达式是固定的，我将字符串拆分为“，”以匹配预期的关键字，并测试正则表达式结果：

```
#!/usr/bin/perl
my $keyword = "object1";
my $str = "[(beginKey object1 (coor 141 257) (coor 1315 254) (coor 1313 430) (coor 140 420) [] [] []), (beginKey keyword (coor 2035 253) (coor 1315 254) (coor 1313 430) (coor 2034 436) [] [] [])].";
my @entries=split(',', $str);
foreach my $entry (@entries)
{
  if ($entry =~ /$keyword/)
  {
    my $tomatch=$';
    if ($tomatch =~ /\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s\(coor\s(\d+)\s(\d+)\)\s/)
    {
      print $1," ";
      print $2," ";
      print $3," ";
      print $4," ";
      print $5," ";
      print $6," ";
      print $7," ";
      print $8," ";
    }
    else
    {
      print "no match !";
    }
  }
} 
```

这打印：

```
141 257 1315 254 1313 430 140 420 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T12:17:47.643

嗯，我认为您当前的代码没有问题。

题外话：在 Qt 中，QRegExp 有一个方法 int MatchedLength() - 很容易看到你的字符串匹配了多少。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T20:35:37.510

[ 是正则表达式中的特殊字符，因此您的第二个匹配项需要反对`/\[/`以匹配文字 [。

你的第三场比赛有 12 组捕获括号；我猜你想要`/coor\s(\d+)\s(\d+)\scoor\s(\d+)\s(\d+)\scoor\s(\d+)\s(\d+)\scoor\s(\d+)\s(\d+)/`。您还应该在使用 $1 等之前检查匹配是否成功。

# c++ - 以编程方式检索 C++ 类名

> ID：1024648
> 
> 赞同：56
> 
> 时间：2009-06-21T20:06:02.343
> 
> 标签：c++, class, macros

我想知道是否可以在 C++ 中以字符串形式检索类的名称，而无需将其硬编码为变量或 getter。我知道在运行时实际上并没有使用这些信息，因此它不可用，但是是否可以创建任何宏来创建此功能？

编辑：可能有助于注意我实际上是在尝试检索派生类的名称，并且我使用的是 Visual C++ 2008 Express Edition。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-06-21T20:08:41.947

您可以使用`typeid`：

```
#include <typeinfo>

std::cout << typeid(obj).name() << "\n"; 
```

但是，类型名称不是标准化的，并且在不同的编译器（甚至同一编译器的不同版本）之间可能会有所不同，并且它通常不是人类可读的，因为它是[*mangled*](https://en.wikipedia.org/wiki/Name_mangling)。

在 GCC 和 clang（使用 libstdc++ 和 libc++）上，您可以使用该[`__cxa_demangle`函数](https://gcc.gnu.org/onlinedocs/libstdc++/libstdc++-html-USERS-4.3/a01696.html)对名称进行解组（在 MSVC 上解组似乎没有必要）：

```
#include <cxxabi.h>
#include <cstdlib>
#include <memory>
#include <string>

std::string demangle(char const* mangled) {
    auto ptr = std::unique_ptr<char, decltype(& std::free)>{
        abi::__cxa_demangle(mangled, nullptr, nullptr, nullptr),
        std::free
    };
    return {ptr.get()};
} 
```

这*仍然*不一定是可读的名称——例如，`std::string`是实际类型的类型名称，它在当前 libstdc++ 中的完整类型名称是`std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >`; 相比之下，在当前的 libc++ 中，它是`std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >`. 不幸的是，“美化”类型的别名并非易事。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2012-01-16T19:32:51.230

如果你只是想检查它是否是某个类，那么

```
typeid(obj) == typeid(CSubClass) 
```

无论实现如何，都将始终有效。

否则，一种方便的方法是声明：

```
virtual const char* classname() { return "CMyClass";} 
```

并实现每个子类。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-03-11T01:27:53.357

事物总是给出声明时变量的`typeid(obj).name()`类型，而不是对象的实际类型（类）。如果变量 obj 被分配给 obj 被声明为的类的子类的实例，不幸的是 typeid 不会显示这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-09-06T19:29:09.327

那这个呢，

使用 Visual Studio 2019 (v142) 在 Windows 10 上测试。

```
#include <iostream>
#include <typeinfo>
#include <string>

/**
 @author    blongho
 @fn        template<typename Object> std::string classNameOf()

 @brief     Determine the class name of an object

 @tparam    Object  Type of the object.

 @returns   A name of the class
 @date      2019-09-06
 */

template<typename Object>
std::string classNameOf() {
    std::string name = typeid(Object).name(); //* user defined types gives "class Type"*\ 
    size_t spacePosition = name.find_first_of(" ");
    if (spacePosition != std::string::npos) {
        return name.substr(spacePosition + 1, name.length());
    }
    return name; // mostly primitive types
}

class Person {
private:
    /* data */
public:
    Person() {};
    ~Person() {};

};

class Data
{
private:
    /* data */
public:
    Data() {};
    ~Data() {};

};

struct Type {};

int main() {
    std::cout << "Class name of Person() is \"" << classNameOf<Person>() << "\"\n";
    std::cout << "Class name of Data() is \"" << classNameOf<Data>() << "\"\n";
    std::cout << "Class name of Type() is \"" << classNameOf<Type>() << "\"\n";
    std::cout << "Class name of double is \"" << classNameOf<double>() << "\"\n";
    std::cout << "Class name of std::string is \"" << classNameOf<std::string>() << "\"\n";
    std::cout << "Class name of int is \"" << classNameOf<int>() << "\"\n";
    std::cout << "Class name of float is \"" << classNameOf<float>() << "\"\n";
    std::cout << "Class name of char is \"" << classNameOf<char>() << "\"\n";
    return 0;
} 
```

* * *

`Output`

```
Class name of Person() is "Person"
Class name of Data() is "Data"
Class name of Type() is "Type"
Class name of double is "double"
Class name of std::string is "std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> >"
Class name of int is "int"
Class name of float is "float"
Class name of char is "char" 
```

在 Ubuntu 18.04 中，

```
g++ -o test src/main.cpp
./test
Class name of Person() is "6Person"
Class name of Data() is "4Data"
Class name of Type() is "4Type"
Class name of double is "d"
Class name of std::string is "NSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE"
Class name of int is "i"
Class name of float is "f"
Class name of char is "c" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-10-25T03:20:21.453

使用 C++17 和[第三方库](https://github.com/Neargye/nameof)，您现在可以获得类的名称，例如

```
#include <iostream>
#include "nameof.hpp"

namespace test {
    class Object {};
}

int main() {
    constexpr auto obj_name = nameof::nameof_type<test::Object>();
    std::cout << obj_name << std::endl;
    // this prints "test::Object"
} 
```

这仅使用编译时信息，因此它可以是`constexpr`. 请注意，它不是便携式的；例如不支持英特尔的编译器。

# java - 如果我自己不中断任何事情，我是否需要担心 InterruptedExceptions？

> ID：1024651
> 
> 赞同：35
> 
> 时间：2009-06-21T20:06:56.147
> 
> 标签：java, exception, concurrency

我`java.util.concurrent.Semaphore`在一个爱好项目中使用。它用于我正在编写的连接池类中。我可以毫不费力地使用它，除了这个方法：

```
public void acquire(int permits) throws InterruptedException 
```

这迫使我处理`InterruptedException`. 现在，我不确定“中断”线程是什么意思，而且我从来没有在我的代码中这样做（好吧，无论如何都不是明确的）。这是否意味着我可以忽略异常？我应该如何处理？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-06-21T20:48:55.110

是的，您*需要*担心`InterruptedException`，就像您需要担心必须抛出或处理的任何其他已检查异常一样。

大多数情况下，`InterruptedException`发出停止请求的信号，很可能是由于正在运行您的代码的线程被[中断了](http://docs.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#interrupt())。

在您等待获取连接的连接池的特殊情况下，我会说这是一个取消问题，您需要中止获取、清理并恢复中断标志（见下文）。

* * *

例如，如果您使用某种`Runnable`/`Callable`在内部运行，`Executor`那么您需要正确处理 InterruptedException：

```
executor.execute(new Runnable() {

    public void run() {
         while (true) {
              try {
                 Thread.sleep(1000);
              } catch ( InterruptedException e) {
                  continue; //blah
              }
              pingRemoteServer();
         }
    }
}); 
```

这意味着您的任务永远不会遵守执行程序使用的中断机制，并且不允许适当的取消/关闭。

相反，正确的习惯用法是恢复中断状态，然后停止执行：

```
executor.execute(new Runnable() {

    public void run() {
         while (true) {
              try {
                 Thread.sleep(1000);
              } catch ( InterruptedException e) {
                  Thread.currentThread().interrupt(); // restore interrupted status
                  break;
              }
              pingRemoteServer();
         }
    }
}); 
```

* * *

**有用的资源**：

*   [干净地关闭线程（Java 专家）](http://www.javaspecialists.co.za/archive/Issue056.html)
*   [处理 InterruptedException (Brian Goetz)](http://www.ibm.com/developerworks/java/library/j-jtp05236.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-21T20:22:44.400

没有。`InterruptedException`仅当您自己中断线程时才会生成。如果您自己不使用`Thread.interrupt()`，那么我要么将其作为某种“意外异常”重新抛出，要么将其记录为错误并继续。例如，在我的代码中，当我被迫捕捉`InterruptedException`并且我从不打电话给`interrupt()`自己时，我会做相当于

```
catch (InterruptedException exception) {
    throw new RuntimeException("Unexpected interrupt", exception);
} 
```

那就是如果它是意料之外的。有很多地方我故意中断我的线程，在这些情况下，我`InterruptedException`以明确定义的方式处理 s。通常这是通过退出我所处的任何循环，清理，然后停止线程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T20:15:53.540

线程可以通过调用 Thread.interrupt() 来中断。它用于优雅地向线程发出它应该做其他事情的信号。通常它会导致阻塞操作（例如 Thread.sleep()）提前返回并抛出 InterruptedException。如果线程被中断，则会在其上设置一个标志。这个标志可以通过 Thread.isInterrupted() 调用来查询。

如果你不使用线程中断并且仍然得到这个异常，你可以退出你的线程（最好记录异常）。

一般来说，这取决于你的多线程应用程序做什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T20:24:03.600

如果您不知道如何在方法中处理它，我建议您在方法中使用 throws InterruptedException （以及它的调用者等）声明它

如果它是你从未预料到的事情，我会抓住它并将它包装在一个 AssertionError 中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T20:19:32.550

执行完线程所需的任何清理后，您应该退出 run() 方法。
高温高压

# java - 标准动作

> ID：1024653
> 
> 赞同：0
> 
> 时间：2009-06-21T20:07:25.867
> 
> 标签：java, jsp, servlets, javabeans

我真的不明白为什么 JSP 中的以下代码运行良好，但正如 Head first book 中所述，它会显示编译时错误。

```
<html><body>

<jsp:useBean id="person" type="foo.Person"  scope="request">
<jsp:setProperty name="person" property="name" value="Fred"/>
 </jsp:useBean>
 <jsp:getProperty name="person" property="name"/>

</body></html> 
```

Person类的代码是：

```
 package foo;

public class Person extends foo.Person1
{
private String s;

public void setEmpID(String s)
{
  this.s=s;
  }
  public String getEmpID()
  {
     return s;
  }

  } 
```

在 servlet 类中实例化 foo.Person 并将其设置为请求范围内的属性“Person”的代码是：

```
Person1 p=new Person();
p.setName("Greenhorn");
request.setAttribute("person",p); 
```

**Person1** bean 类的代码是：

```
package foo;

 public abstract class Person1
{

private String s;

public void setName(String s)
{
  this.s=s;
  }
  public String getName()
  {
     return s;
  }

  } 
```

为什么它在工作？为什么它没有显示任何错误？书错了吗？

提前感谢您的任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T20:28:59.737

我查了书。在第 354 页，它将 Person 更改为抽象类并创建 Employee 的子类以说明如何指定 useBean 的 type 属性。type 参数告诉页面稍后使用哪个类作为引用。class 属性告诉页面要实例化什么对象。

**编辑：**在第 356 页上，黑框状态：“如果使用的类型没有类 bean 必须已经存在。” 本书示例中的范围是页面而不是请求。

# php - 从 Helper 访问控制器中的函数

> ID：1024658
> 
> 赞同：1
> 
> 时间：2009-06-21T20:11:03.550
> 
> 标签：php, codeigniter

我几个小时前才开始使用 CodeIgniter，但遇到了一些问题。我正在尝试调用一个函数，该函数当前位于名为`admin.php`. 我正在尝试从助手那里访问它。我将如何正确地做到这一点？我几乎尝试了所有方法，但似乎没有任何效果，因为我收到以下错误：

```
Fatal error: Call to a member function login() on a non-object 
```

对此问题的任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-22T13:36:00.263

我同意吉米的观点。您的助手和库类应该独立于应用程序中的任何特定控制器。例如，如果您有一个“页面标题”助手，它不应该依赖于您的管理控制器的任何特定行为。如果您想在另一个没有管理控制器的应用程序中使用页面助手怎么办？或者如果你在路上对管理控制器进行了更改，现在你必须确保这些更改不会破坏你的助手。

如果您的辅助函数需要管理员控制器拥有的某些特定数据位，您可以将其作为控制器的函数参数传入。这样，助手是控制器的依赖项，而不是控制器是助手的依赖项。

此外，该错误消息意味着您调用的任何内容都没有正确实例化。所以你可能正在做类似的事情：

```
$this->load(); 
```

从助手内部。但是，在助手中，

```
$这个
```

未定义（因此出现“非对象”错误）。CodeIgniter 提供了一种从控制器外部加载模型、库和视图的方法。但是，据我所知，它不允许您为控制器执行此操作。不过没关系，因为上面提到的原因。引入依赖项时必须小心。

# project-management - 扔掉你的初稿——有兼容的方法吗？

> ID：1024668
> 
> 赞同：2
> 
> 时间：2009-06-21T20:17:23.130
> 
> 标签：project-management, process, methodology

是否有任何编程方法考虑到第一轮编写的代码可能不是您想要使用的概念？在项目结束时，我从开发人员那里听到的最常见的话是“如果我能再做一次，我会做的与众不同。” 这几乎是作家在写完初稿后所经历的过程的精确反映。不同之处似乎在于，编写者会重写并再次重写，直到他们准备好进入编辑阶段，而开发人员似乎先编写然后通过测试和重构来完善他们的初稿。

我当然不喜欢尝试使用替代类比来定义开发过程，但我确实认为认识到你的初稿只是为了记下想法是有价值的，你需要进一步重写才能产生有价值的东西。我只是不认为我曾经遇到过认识到这一点的编程过程或项目方法，所以我希望 Stackoverflow 的广大集体意识可能知道我可以从哪里开始探索这种可能性？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T20:28:36.620

**原型设计**似乎以某种方式解决了这个问题。关于原型的[维基百科文章](http://en.wikipedia.org/wiki/Software_prototyping)命名了一种称为“一次性原型”的方法，这似乎与您的思维方式一致。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T20:30:29.110

您所描述的称为[一次性原型设计](http://en.wikipedia.org/wiki/Software_prototyping#Throwaway_prototyping)。这个想法是，一旦您有了初步需求，您就可以创建系统的基本模型，以向用户和/或客户展示最终系统的外观以及它的功能（尽管没有真正的功能）。用户提供对此原型的反馈。

如果你想利用一次性原型，我的第一个建议是开始研究螺旋过程模型。但是，我不熟悉很多明确使用一次性原型的方法。更“敏捷”的方法有利于进化原型或增量原型。我个人使用一次性原型的唯一一次是只对用户界面进行原型设计，因为底层系统已经在开发中，我使用白板和笔和纸来制作原型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-21T20:44:55.337

此外，这是 Brooks 的想法之一，他自己在一些修改后发现它并不是最有效的：您可能听说过“在计划丢弃一个系统后丢弃两个系统”。幸运的是，由于敏捷方法，现在可以克服许多这样的麻烦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T20:29:49.300

这正是 Bruce Eckel 在[这里](http://www.artima.com/weblogs/viewpost.jsp?thread=255898)提出的论点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T20:38:31.637

我认为最好的办法是很好地模块化。例如，如果您正在编写内核，“获取下一个可用的空闲内存帧”函数应该驻留在它自己的函数中。这样，当您发现它是以一种非常糟糕的方式编写时，您只需擦除（当然您正在使用版本控制）并从头开始。这样，您现有的模块就可以作为测试新代码的一种方式存在。

从头到尾再从头到尾是再次解决大部分相同错误的绝佳方式。

# wpf - WPF 和 Mime 类型

> ID：1024675
> 
> 赞同：0
> 
> 时间：2009-06-21T20:20:26.090
> 
> 标签：wpf, mime, mime-types

它是关于生成报告的 WPF 应用程序。

报告具有简单的结构：byte[] m_Data, string m_Mime。

创建了数据数组，设置了 MIME 类型，现在我需要显示具有我们在 Web 浏览器中找到的相同功能的对话框 - 打开/保存/取消对话框，根据响应的 MIME 类型在适当的应用程序中打开文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-22T08:36:10.897

WPF 没有这样的对话框，因为它不是一个 Web 应用程序，它是一个在本地运行并使用操作系统的本机设施而不是 HTTP 的应用程序。

编写打开/保存/取消对话框本身应该很容易，为了实现打开功能，您应该将文件保存到磁盘（可能是 System.IO.Path.GetTempPath 返回的临时目录或文件System.IO.Path.GetTempFileName 返回的名称）。

确保文件具有正确的扩展名，因为 Windows 使用文件扩展名而不是 mime 类型（因为在编写 Windows 时 mime 类型不存在）。

要打开刚刚创建的文件，请使用 System.Diagnostic.Process.Start，例如，如果安装了 MyPdfFile.pfd 文件，它将在 Acrobat 阅读器中打开（从当前目录，不要忘记在代码中包含完整路径):

```
System.Diagnostics.Process.Start("MyPdfFile.pdf"); 
```

# tomcat - 如何为 2 个不同的（用户和管理员）身份验证设置 Tomcat web.xml 和 context.xml

> ID：1024683
> 
> 赞同：2
> 
> 时间：2009-06-21T20:27:01.647
> 
> 标签：tomcat, authentication, jdbcrealm

这是我的情况：

我想要下面的东西

我的网站/客户/*

在访问之前要求基于表单的身份验证（通过 mysite/customer/login.jsp 登录，使用自己的 user_password 表和角色。）

但

我想要下面的东西

我的网站/管理员/*

在访问之前需要*另一个*基于表单的身份验证（通过 mysite/admin/login.jsp 登录，使用另一组 admin_user_password 表和角色。）

在 Tomcat 6.0 下可以做到这一点吗？如果是这样，有人可以简要描述我如何实现这一点吗？我环顾四周，只看到了 1 个 Realm 设置的示例……之前没有见过多个 Realm 设置。

我使用 JDBCRealm。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T00:46:34.057

我认为这是不可能的。您可以采用过滤方式，为树的客户端设置过滤器，为管理端设置另一个过滤器。看看[这里](http://java.sun.com/products/servlet/Filters.html)。

另一种方法是在 tomcat 中使用单点登录在两个不同的上下文中设置两个应用程序。这样，您将拥有两个不同的应用程序`/mysitecustomer`，`mysiteadmin`它们共享一个领域但有两个不同的登录页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-08T04:45:47.870

顺便说一句 - 从我的阅读来看，上下文是首选机制。我正在为我的咨询业务设置模型，用于划分需要一些托管 Web 应用程序的客户，并将其暂存在我的服务器上以方便我使用。

# python - Django - 子类化用户的替代方案？

> ID：1024684
> 
> 赞同：0
> 
> 时间：2009-06-21T20:27:52.377
> 
> 标签：python, django

我正在使用 Django 附带的标准用户模型（django.contrib.auth）。我在 Django 应用程序中制作了一些我自己的模型，并创建了如下关系：

```
from django.db import models
from django.contrib.auth.models import User

class GroupMembership(models.Model):
    user = models.ForeignKey(User, null = True, blank = True, related_name='memberships')
    #other irrelevant fields removed from example 
```

所以我现在可以这样做来获取用户当前的所有成员资格：

```
user.memberships.all() 
```

但是，我希望能够进行更复杂的查询，如下所示：

```
user.memberships.all().select_related('group__name') 
```

这工作正常，但我想在模板中获取这些数据。尝试将这种逻辑放在模板中似乎很愚蠢（而且我似乎无法让它工作），所以我想创造一种更好的方式来做这件事。我可以对 User 进行子类化，但这似乎不是一个很好的解决方案 - 我将来可能想将我的应用程序移动到其他 Django 站点，并且大概如果有任何其他应用程序对 User 进行子类化，我就不会成为能够让它工作。

最好在里面创建一个`GroupMembership`名为的方法`get_by_user(user)`吗？我可以从模板中调用它吗？

我将不胜感激任何人都可以就构建它提供任何建议 - 如果这有点长/模糊，对不起。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T21:12:30.040

首先，调用`select_related`和传递参数，不做任何事情。这是一个提示应该填充缓存。

您永远不会调用`select_related`模板，只会调用视图函数。只有当您知道您需要所有这些相关对象进行其他处理时。

“最好在 GroupMembership 中创建一个名为 get_by_user(user) 的方法吗？”

你有这个。我不确定它有什么问题。

```
 GroupMembership.objects.filter( user="someUser" ) 
```

“我可以从模板中调用它吗？”

不，这就是视图函数的用途。

```
 groups = GroupMembership.objects.filter( user="someUser" ) 
```

然后将`groups`对象提供给模板进行渲染。

* * *

**编辑**

这是一行代码；将它包含在您的所有视图函数中似乎并不是什么繁重的负担。

如果你想让它出现在每一页上，你有很多不涉及重复这行代码的选择。

1.  一个视图函数可以调用另一个函数。

2.  您可能想尝试可调用对象而不是简单函数；这些可以子类化填充此信息的公共可调用对象。

3.  您可以添加一个模板上下文处理器，将其放入所有渲染模板的上下文中。

4.  您可以编写自己的装饰器，以确保在每个具有装饰器的视图函数中都完成此操作。

# concurrency - 用 Erlang 写传统并发问题容易吗？

> ID：1024695
> 
> 赞同：4
> 
> 时间：2009-06-21T20:33:57.793
> 
> 标签：concurrency, erlang

我参加了一个操作系统课程，在那里我们学习了常见的并发问题：餐饮哲学家问题、生产者消费者问题、读者和作者问题......

既然它们的主要目的是保护共享变量，那么尝试在 Erlang 中解决这些问题有意义吗？或者也许我只是需要更多的 Erlang 培训来找出解决方案？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T21:01:48.470

我理解这个问题，但这些问题与锁定和互斥有关。

Erlang 通过 Actors 做事的方式避免了锁定问题。在 Erlang 中创建生产者和消费者以及读者和作者是一件好事，但就解决互斥问题而言，您将使用消息而不是共享变量。

在 Erlang 中，你“什么都不分享”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T21:24:48.300

此[链接](http://humani.st/erlang-circular-process-communication/)可能对您有所帮助

可以肯定的是，Erlang 的现实世界应用程序将不得不处理并发，线程争夺某些资源。

Erlang 的创造者乔·阿姆斯特朗 (Joe Armstrong) 写了一本涵盖所有这些主题以及更多内容的优秀书籍。

[编程 Erlang : 并发世界的软件](https://rads.stackoverflow.com/amzn/click/com/193435600X)

# asp.net - 返回 ASP DDL 或 Telerik 控件

> ID：1024696
> 
> 赞同：1
> 
> 时间：2009-06-21T20:34:21.710
> 
> 标签：asp.net, telerik

我正在尝试编写一个更通用的方法来填充 ASP.NET 下拉列表或带有状态的 Telerik RadComboBox。我想将控件作为参数传递给方法。我有一个包含所有状态的 DataTable，我循环遍历它（见下文） - 我想让它适用于 Telerik RadComboBox - 所以我需要更改第一个参数，以及我插入新的部分ListItem - 对于 Telerik RadComboBox，它是新的 RadComboBoxItem。我怎样才能做到这一点？

```
public void PopulateStates(DropDownList ddlStates, string country)
{
    ddlStates.Items.Clear();
    DataLookup dl = new DataLookup();
    DataTable dt = dl.GetStatesByCountry(country);
    if (dt != null)
    {
        if (dt.Rows.Count > 0)
        {
            ddlStates.Items.Insert(0, new ListItem(""));
            for (int i = 0; i < dt.Rows.Count; i++)
            {
                ddlStates.Items.Add(new ListItem(dt.Rows[i]["STCD_Descr"].ToString(),
                    dt.Rows[i]["STCD_State_CD"].ToString()));
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T21:30:50.707

由于 ListBox 和 RadComboBox 除了“Control”类之外没有公共类，您需要检查实际类型。

下面的代码怎么样？

```
public void PopulateStates(Control ddl, string country)
{
    object listItem = new object();
    switch (ddl.GetType().Name)
    {
        case "RadComboBox":
            listItem = listItem as RadComboBoxItem;
            ddl = ddl as RadComboBox;
            break;
        case "ListBox":
            listItem = listItem as ListItem;
            ddl = ddl as ListBox;
            break;
        default:
            return;
    }

    // proceed with your code
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:19:52.273

我查阅了 Telerik 文档，似乎没有常见的做法——你正在尝试做的事情。

如果可能，请尝试使用数据绑定（设置 DataSource 并调用 DataBind）。
注意：我没试过。但我认为这应该得到双方的支持。

# macos - Mac OS X：尝试将（ld）链接到框架

> ID：1024704
> 
> 赞同：3
> 
> 时间：2009-06-21T20:38:25.023
> 
> 标签：macos, frameworks, linker

我正在阅读 Mark 和 Aaron 的“Advanced Mac OS X Programming”。我无法让一个终端语句正常工作：

> cc -g -o useadd -F./Adder/build -framework Adder useadd.m

它在第 45 页 - 第 3 章（库）。如您所见，我试图将 useadd.m 与使用 Xcode 创建的框架链接起来。当我运行这个命令时，我得到这个错误：

> ld：找不到框架加法器
> 
> collect2: ld 返回 1 个退出状态

我确保文件夹 /Adder/build 存在于当前目录下。在该文件夹中，还有另一个：Adder.build 包含框架。我一直在尝试所有可能的组合，但链接器找不到我的框架。

我正在使用 Mac OS X Leopard，我认为这本书是在 Leopard 之前出版的，当时 Tiger 仍然是最新的 Mac OS。

你能帮我吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T20:56:22.973

使用 -F 选项指定的路径必须指向包含框架的目录（而不是在子目录中）。所以试试 -F./Adder/build/Adder.build，如果它真的在那里。但通常 Xcode 会将构建产品放在构建目录中名为 Debug 或 Release 的目录中。Adder.build 仅用于中间构建结果。

# java - 从 int 中获取字节以避免位移乐趣 - Java（中值过滤）

> ID：1024709
> 
> 赞同：4
> 
> 时间：2009-06-21T20:40:04.473
> 
> 标签：java, algorithm, image-processing

我正在尝试对 Java 中的图像执行中值过滤器，但速度非常慢。首先，如果你们中有人知道我可以使用的独立实现，如果您能告诉我，那就太好了。我正在 Android 上实现，试图复制 JAI 的一小部分。

在我的方法中，我获取每个像素，使用提取 R、G 和 B 值

```
r = pixel >> 16 & 0xFF 
```

或类似的，找到内核的中位数并完成

```
pixel = a | r <<16 | g << 8 | b 
```

有什么方法可以从 int 中获取字节，这样会更快吗？

亲切的问候，

加文

* * *

编辑：根据要求帮助诊断我的低性能的完整代码

对于实际的源文件，请到[这里](http://code.google.com/p/miffed/source/browse/trunk/Miffed%20Demo/src/uk/ac/ic/doc/gea05/miffed/operators/bitmap/unary/impl/Median.java)找到我的中值**过滤**器实现。

*width*和*height*变量用于*dest*的大小，可用作类成员变量。像素被线性化成一维数组。

```
private void medianFilterSquare(int[] source, int[] dest, int rWidth,
        int rHeight, int radius) {
    // Source has been reflected into a border of size radius
    // This makes it radius * 2 pixels wider and taller than the dest
    int r,g,b;
    int destOffset, rOffset, kOffset;

    // The first offset into the source to calculate a median for
    // This corresponds to the first pixel in dest
    int rFirst = radius + (rWidth*radius);

    // We use a square kernel with the radius passed
    int neighbours = (radius+radius+1)*(radius+radius+1);

    int index;

    // Arrays to accumulate the values for median calculation
    int[] rs = new int[neighbours];
    int[] gs = new int[neighbours];
    int[] bs = new int[neighbours];

    // Declaring outside the loop helps speed? I'm sure this is done for me
    // by the compiler
    int pixel;

    // Iterate over the destination pixels
    for(int x = 0; x < height; x++){
        for(int y = 0; y < width; y++){
            // Offset into destination
            destOffset = x + (y * width);
            // Offset into source with border size radius
            rOffset = destOffset + rFirst + (y * (radius *2));

            index = 0;

            // Iterate over kernel
            for(int xk = -radius; xk < radius ; xk ++){
                for(int yk = -radius; yk < radius ; yk ++){
                    kOffset = rOffset + (xk + (rWidth*yk));
                    pixel = source[kOffset];
                    // Color.red is equivalent to (pixel>>16) & 0xFF
                    rs[index] = Color.red(pixel);
                    gs[index] = Color.green(pixel);
                    bs[index] = Color.blue(pixel);
                    index++;
                }   
            }
            r = medianFilter(rs);
            g = medianFilter(gs);
            b = medianFilter(bs);

            dest[destOffset] = Color.rgb(r, g, b);
        }           
    }       
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T20:49:50.227

正如其他人所说，这可能是导致问题的原因。我要说的一件事（这可能很明显，但无论如何） - 不要只在桌面 VM 上分析应用程序并假设瓶颈将在同一个地方。如果在 Dalvik 中发现完全不同的瓶颈，我一点也不感到惊讶。

您是否可以使用仍然改变的价值观？例如，如果您*只是*为不同的颜色遮罩：

```
int r = pixel & 0xff0000;
int g = pixel & 0xff00;
int b = pixel & 0xff; 
```

你能相应地调整你的处理算法吗？

最后一个想法：我总是发现移位运算符的优先级令人困惑。从可读性的角度来看，我*强烈*建议您将它们括起来：

```
r = (pixel >> 16) & 0xFF;
pixel = a | (r <<16) | (g << 8) | b; 
```

与性能无关，但如果我是维护者，我当然会很感激 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:52:53.637

获得 r,g,b 值的最快方法应该是

```
new byte[] {
  (byte)(value >>> 24),
  (byte)(value >>> 16),
  (byte)(value >>> 8),
  (byte)value
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T21:25:34.133

专注于如何进行位操作会分散注意力。你如何做这些操作很重要，因为你一遍又一遍地处理同一个像素是不必要的。

您为每个像素调用了 3 次中值滤波器，并且您在*每个像素的像素周围获得了多个像素*。这意味着您要多次为同一个像素做所有这些工作。你有`for`嵌套四层的循环！

如果您的半径为 5，则您正在处理 121 个像素。然后你向下移动 1 并再次处理 121 个像素，你已经转换了除了 11 个之外的所有像素！你对向下的每个像素做同样的事情，然后向右移动一个像素。对于 5 个半径，您需要进行两个数量级的 rgb 转换。

我建议先保留您的图像或将您的图像转换为单独的红色、蓝色和绿色*阵列*。

* * *

如果半径很大，您可以在移动时保持红色、蓝色和绿色的总和，从顶部减去像素并在向下爬取位图时从底部添加像素，但这会使代码触摸更复杂。是否添加代码以进一步优化取决于您的要求。

* * *

此外，您还有很多可以优化的小东西。我不确定编译器是否正在处理它们。例如，你可以做一些强度降低。您不需要在计算`neighbors`、`destOffset`、`rOffset`或的行中进行任何乘法运算`kOffset`。如果您稍微重构代码，那么您只需要添加即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T21:39:32.497

您有时可以在单个 int 中同时对红色和蓝色分量进行算术运算：

```
int average(int rgb1, int rgb2)
{
    int rb = (((rgb1 & 0xFF00FF) + (rgb2 & 0xFF00FF)) >> 1) & 0xFF00FF;
    int g = (((rgb1 & 0xFF00) + (rgb2 & 0xFF00)) >> 1) & 0xFF00;
    return (rb | g);
} 
```

因为红色和蓝色分量被 8 位分开，所以它们不会相互干扰。

不过，我从未见过显着的加速（超过 5-10%）。

# tcl - TCL/TK的隐藏特征

> ID：1024711
> 
> 赞同：18
> 
> 时间：2009-06-21T20:43:24.733
> 
> 标签：tcl, tk

我一直在使用 TCL/TK，最近开始在我的自动化应用程序中使用 TCL/TK，我渴望知识。

继续一长串隐藏特征问题，我想知道 TCL/TK 的任何隐藏或方便的功能，或者任何简单的方法来实现一些大操作

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-22T13:59:56.173

我最喜欢的“隐藏或方便的特性”是引用在 Tcl 中的工作方式。我喜欢用“*引用是一种工具，而不是规则*”这句话。我也想说“*当你需要花括号时，你只需要花括号*”

虽然大多数语言都有规则规定必须为某些事情使用块分隔符（例如，在 C 中您必须使用 {} 来指定块），但 Tcl 并没有那么严格。

使用 Tcl，您可以选择任何给您所需效果的引用字符。当然有最佳实践，但最后你要选择最能帮助你完成工作的引用字符。

这意味着，例如，您可以通过多种方式定义过程，包括：

```
proc foo {args} {
    .... body here ....
}

proc foo "args" "
    .... body here ....
"

proc foo args [some code that returns the body] 
```

... 等等。条件语句、循环和其他所有内容也是如此。（对于外行来说，花括号大致相当于shell单引号，双引号相当于shell双引号，方括号相当于shell反引号。）。

现在，很多人看到这个并说WTF？但它确实给了程序员很大的权力。我们经常在 comp.lang.tcl 中遇到类似“如果我执行 'this {and $that}'，我如何让 $that 被扩展？”这样的问题。答案遵循老笑话“病人：医生，当我做这个医生时很痛：不要那样做”。也就是说，如果您不喜欢使用一组定界符获得的行为，请选择其他定界符。仅仅因为 if 语句通常用花括号构造并不意味着它*必须*用花括号构造。

这是我最喜欢的 Tcl 的“隐藏”特性。它不是隐藏的——它就在非常完整而简洁的 Tcl(n) 手册页上，但在您完全了解 Tcl 的工作原理之前，其后果并不明确。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-22T11:20:36.773

当 Sun 的营销人员宣称 Tcl 已“企业就绪”时，开发人员添加了以下功能：

```
$ tclsh
% clock format [clock seconds] -format %Q
Stardate 63473.2 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-22T16:33:30.180

另一个不明显的特性是无法识别的命令会落入一个称为“未知”的处理程序，您可以重新定义它。例如。将未知命令视为表达式来评估：

```
$ tclsh
% 2+2
invalid command name "2+2"
% proc unknown args {uplevel 1 [linsert $args 0 expr]} 
% 2+2
4 
```

更多示例可以在[激进语言修改的 wiki 页面上找到](http://wiki.tcl.tk/495)

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-06-23T10:31:22.140

Tcl 的 [trace] 命令允许您拦截对任何变量的读取和写入。这允许您在任何变量上实现观察者，并向任何变量添加任意复杂性的自动范围检查（就像您通过 setter/getter 访问变量一样）。您还可以使用此技术创建自动递增变量。

```
proc varlimit_re {re var key op} {
  upvar $var v
  if { [regexp -- $re $v] <= 0 } {
    error "$var out of range"
  }
}

trace add variable ::myvar {write} [list varlimit_re {^[A-H]\d{3}-[0-9a-f]+$}]` 
```

如果您尝试将 'myvar' 设置为与正则表达式不匹配的任何内容，您将收到运行时错误。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-06-22T13:17:12.810

一个没有隐藏但对来自其他语言的人来说并不明显的便利功能是，您可以定义自己的控制结构（如果您想危险地生活，甚至可以重新定义现有的控制结构）。[Tcl Wiki](http://wiki.tcl.tk/685)上有示例

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-06-23T09:27:30.100

Tcl 的所有“关键字”都是常规的 Tcl 命令，包括 [for]、[foreach]、[while] 等控制结构。这意味着您可以通过在纯 Tcl 代码中编写新的控制结构来扩展语言。

例如，[try/on/trap](http://www.tcl.tk/cgi-bin/tct/tip/329.html)结构已在 Tcl 8.6a 中仅使用 Tcl 代码实现。类似地，tcllib 包含 control::do，一个 do/while 控制结构。

很多这些都是通过 [upvar] 和 [uplevel] 命令实现的，它们允许您访问变量或在不同的堆栈帧中执行代码。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-06-22T16:34:44.987

恕我直言，Tcl 最大的隐藏特性是它的[C API。](http://wiki.tcl.tk/11541) 使用它，包装核心 C 程序或子系统并在 Tcl 中编写 GUI 或其他功能非常容易。虽然这个特性不是 Tcl 独有的，但 Tcl 的设计初衷就是为了做到这一点，而且 C API 特别易于使用。

第二个最大的隐藏特性是[packer](http://wiki.tcl.tk/2264)，它是所有几何管理器的祖父。这样一来，GUI 就可以拥有相当大的窗口，而代码量却很少。需要注意的是，Tcl/Tk 至少在 .net 出现之前 10 年就有几何管理。

Tcl 的第三大特点是能够通过 C API 或使用 Tcl 中定义的命令来扩展语言。不完全是 LISP 宏，但非常灵活。 [Expect](http://expect.nist.gov/)是一个很好的应用程序示例，它围绕扩展 basse Tcl 语言以制作特定领域的脚本语言而构建。

**编辑：**好吧，烦死我了，Xt[确实有一个几何管理器](https://www.s-and-b.ru/syshlp/motif_guide/MotifProgGuide/Managing_Geometry.html)，尽管我同意 Nat 的观点，因为它比 pack 更痛苦；-}

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-06-22T17:00:45.473

Tcl 是一种如此简单、开放的语言，几乎没有隐藏的特性。这一切都暴露给程序员扩展和适应。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-07-28T21:08:58.540

1.  `[array names]`是新手询问如何迭代数组的第一个问题
2.  此外，您可以`foreach {key1 key2} {$list1 $list2} {...}`- 即使列表大小不同
3.  你不应该在 switch case 之间使用注释（这不是一个很酷的功能，但大多数开发人员不理解的问题
4.  该`rename`命令可以重命名任何函数/过程

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-08-25T17:34:37.027

我认为[时间](http://tcl.tk/man/tcl8.5/TclCmd/time.htm)命令很棒。它并没有完全隐藏，但这并不能阻止人们偶尔在 comp.lang.tcl 中询问“哪个函数更快”。

任何时候您都想知道“这需要多长时间？” 或“哪种方法更快？” 您只需通过“时间”命令调用它。没有创建对象，没有数学，没有开销，非常简单。其他语言也有类似的特性，虽然有些不太优雅。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-06-26T12:37:29.027

有据可查的 C API 还允许在 Perl 中轻松集成。我使用 Tcl/Tk 的经验可以追溯到 1995 年，但在 2000 年左右，我发现了 Perl/Tk，并且再也没有回头。

最近，Tcl 和 Tkx Perl 包为我们提供了具有现代感的 GUI。考虑到它们允许跨语言边界做什么，上述两个模块虽然不是微不足道的，但涉及的代码相对较少。这可以直接归功于出色的 API（显然还有 Perl 的强大功能）。

# jquery - $(this).keyup() 在关注 tinyMCE 时没有响应

> ID：1024712
> 
> 赞同：1
> 
> 时间：2009-06-21T20:44:00.363
> 
> 标签：jquery, tinymce

当“keyup”事件发生时，我试图触发一个函数。当我在普通的文本区域和输入字段上测试它时，这很好用，但是，当我在 tinyMCE 编辑器上使用相同的代码时，什么也没有发生。我怀疑这是因为 tinyMCE 在 java 上运行，并且已经有事件侦听器，但是我的 java 知识距离处理这个问题还差一个年龄！

这是我的代码，除了 tinyMCE 编辑器之外，页面上的所有输入都有效：

```
<script type="text/javascript">
$(document).ready(function() {

    $(this).keyup(function(){

        // get the contents of the editor...
        var content = tinyMCE.get('demo_textarea');
        content = escape(content.getContent());
        content = content.replace("+", "%2B");
        content = content.replace("/", "%2F");

        // copy the contents of the editor into #box_2
        $('#box_2').html(content);

    });

}
</script> 
```

我实际上想要实现的是类似于堆栈溢出编辑器的东西，您的输入反映在另一个框中。

感谢您的阅读，并提前感谢我可能获得的任何帮助。

问候，汤姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T21:03:48.560

检查[配置/设置](http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/setup)部分，您可以轻松地将事件添加到编辑器...

```
tinyMCE.init({
    mode : ...,
    ...,
    setup : function (ed) {
        ed.onKeyPress.add(
            function (ed, evt) {
                alert("Editor-ID: "+ed.id+"\nEvent: "+evt);
                //....
            }
        );
    },
    ...
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T20:52:49.567

您可以[在此处](http://tinymce.moxiecode.com/examples/example_14.php)查看如何为 tinyMCE 编辑器设置事件处理程序的示例，您可以探索更多可能对您有用的示例。您只需要直接绑定编辑器的 onkeyup 事件即可。

# php - 使用 fopen、mysql 查询、include/require 检索字符串值的速度怎么样？

> ID：1024715
> 
> 赞同：2
> 
> 时间：2009-06-21T20:45:06.257
> 
> 标签：php, mysql, include, fopen

这是一个普遍的问题。我需要检索大约 20 个字符串的值，每个字符串大约 100 个字符。为了检索变量，以下哪种方法最快？

1）从一个单独的包含文件中读取，其中分配了变量值（例如 $var1 = "blablablah...."; 等） 2) 从文本文件中读取 3) 从（小型）数据库中读取 - 例如做一个简单的mysql查询

那么稍微大一点的情况呢，例如大约 50 个字符串，每个字符串最多 300 个字符？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T20:54:53.493

您没有包括数据集中总共存在多少个这些字符串，以及它们的更新频率。

当只有少数几个并且很少更新时，使用完全基于 PHP 的解决方案或光盘文件解决方案是可以的；当有 10 亿个并且以每分钟数千个的速度更新时，这将成为管理的噩梦。

从最明显（最可维护）的解决方案开始，然后在性能成为问题并且您确定这是问题的根源时进行优化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T20:49:34.033

> 为了检索变量，以下哪种方法最快？

1) 从单独的包含文件中读取

> 那么稍微大一点的情况呢，例如大约 50 个字符串，每个字符串最多 300 个字符？

1) 从单独的包含文件中读取

这实际上取决于您对性能的重视程度而不是实用性。

# wcf - WCF DataContract 向上转换

> ID：1024723
> 
> 赞同：1
> 
> 时间：2009-06-21T20:52:03.920
> 
> 标签：wcf, casting, datacontract

我正在尝试获取我在服务器上收到的数据合同对象，对其进行一些操作，然后返回它的升级版本，但它似乎不起作用。我可以通过使用 KnownType 或 ServiceKnownType 属性让它工作，但我不想往返所有数据。下面是一个例子：

```
[DataContract]
public class MyBaseObject
{
    [DataMember]
    public int Id { get; set; }
}

[DataContract]
public class MyDerivedObject : MyBaseObject
{
    [DataMember]
    public string Name { get; set; }
}

[ServiceContract(Namespace = "http://My.Web.Service")]
public interface IServiceProvider
{
    [OperationContract]
    List<MyBaseObject> SaveMyObjects(List<MyDerivedObject> myDerivedObjects);
}

public class ServiceProvider : IServiceProvider
{
    public List<MyBaseObject> SaveMyObjects(List<MyDerivedObject> myDerivedObjects)
    {
        ... do some work ...

        myDerivedObjects[0].Id = 123;
        myDerivedObjects[1].Id = 456;
        myDerivedObjects[2].Id = 789;

        ... do some work ...

        return myDerivedObjects.Cast<MyBaseObject>().ToList();
    }
} 
```

任何人都知道如何让它工作而不必重新创建新对象或使用 KnownType 属性？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T21:28:39.383

我认为您的问题是您正在尝试通过通用列表发送。

如果您将列表封装在一个对象中，它将起作用。那就是创建一个具有单个公共属性的对象，即通用列表。

您还需要确保合同中未直接使用的所有类都标记为可序列化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T06:30:09.247

如果你想返回派生对象，那么总会有一个往返，因为客户端和服务是分开的。为了让客户端更新它自己的 MyBaseObjects 列表，它必须反序列化来自服务器的 MyDerivedObjects 列表。

需要使用 KnownType 和/或 ServiceKnownType，因为这会导致将该类型信息添加到 WSDL 中，然后客户端使用该信息将消息反序列化为正确的类型。

对于初学者来说，一个有用的工具来测试你所描述的场景：[http ://www.wcfstorm.com](http://www.wcfstorm.com)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-11T10:04:29.720

WCF（和 .net 远程处理）的问题之一是它们试图使“消息传递”看起来像方法调用。

当您尝试使用过多的“oop”类型设计时，这种情况就会失败。

> 消息由 .net 类表示的事实并**没有** 使它们的所有**行为**都像 .net 类。

有关泄漏抽象问题的更多信息，请参见[this](http://en.wikipedia.org/wiki/Leaky_abstraction)和[this 。](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)

因此，在设计 WCF 接口时，您需要开始考虑消息传递而不是对象，否则您会遇到很多这样的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-08T06:55:33.790

您可以尝试创建一个 DataContractSurrogate (IDataContractSurrogate) 并返回您的基本类型以调用 GetDataContractType。我不确定这就是它的用途，所以你仍然可能会更好地使用“额外的工作”，但也许我不了解额外工作的范围。

# ruby - 用 Ruby 读取文件

> ID：1024730
> 
> 赞同：1
> 
> 时间：2009-06-21T20:54:47.050
> 
> 标签：ruby, file-io, xss

我有一个文本文件，其中包含我经常用来清理 html 文件的正则表达式列表：

**列表.txt**

```
<p[^>]*>|<p>
<\/?(font|span)[^>]*>|
<\/u>\s*<u>|
<\/u>\s*<i>\s*<u>|<i> 
```

如果每一行都由**"#{a}|#{b}"**形式组成，那么读取此文件并将其转换为数组的最简单方法是什么：

```
[
  [ /<p[^>]*>/, '<p>' ],
  [ /<\/?(font|span)[^>]*>/, '' ],
  [ /<\/u>\s*<u>/, '' ],
  [ /<\/u>\s*<i>\s*<u>/, '<i>' ]
] 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T21:36:02.990

尝试以下操作：

```
result = File.foreach("list.txt").collect do |line|
  *search, replace = line.strip.split("|", -1)
  [Regexp.new(search.join("|")), replace]
end 
```

或者，如果您的分隔符没有出现在正则表达式和替换中：

```
result = File.foreach("list.txt").collect do |line|
  search, replace = line.strip.split("!", -1)
  [Regexp.new(search), replace]
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:35:52.177

假设该`#{b}`部分永远不会包含 a `|`，我得到以下信息：

```
File.open(filename,"r").collect
  { |s|
    x = s.rindex('|');
    [ Regexp.new(s[0..x]), s[x+1..-1].chop ]
  } 
```

否则，您可能不得不`s.rindex('|')`用更复杂的东西替换。

# java - SWT 复合 - 重绘问题

> ID：1024732
> 
> 赞同：12
> 
> 时间：2009-06-21T20:55:14.320
> 
> 标签：java, user-interface, swt

我有一个复合元素，最初有一个标签。现在我在它（标签）上调用 dispose 并在同一个容器（复合榆树）中创建另一个标签，但我没有看到新文本。它让我质疑如何在复合材料上启用重绘，以便新标签（或我可能创建的任何其他组件）将代替旧标签呈现。这是我拥有的代码（分离成一个单元测试以重绘复合材料）

```
private Label createLabel( Composite parent) {
    Label label = new Label(parent, SWT.NONE);
    label.setAlignment(SWT.CENTER);
    label.setLayoutData( new GridData( SWT.CENTER, SWT.CENTER, true, true) );
    return label;
}

private void changeText() {
    assert testCell != null : "Please initialize test cell";
    testCell.getChildren()[0].dispose();
    Label l = createLabel(testCell);
    l.setText("New TexT");
    testCell.redraw();
}

private void draw() {
    Display display = new Display();
    shell = new Shell(display);
    shell.setLayout(new GridLayout(2,false));

    testCell = new Composite(shell,SWT.BORDER);
    testCell.setLayout(new GridLayout());
    Label l = createLabel(testCell);
    l.setText("Old Text");
    Composite btnCell = new Composite(shell,SWT.NONE);
    btnCell.setLayout(new GridLayout());
    Button b = new Button(btnCell, SWT.PUSH);
    b.setText("Change");
    b.addListener(SWT.MouseDown, new Listener() {
        public void handleEvent(Event e) {
            changeText();
        }
    }); 
```

如您所见，在添加新元素后，我正在对复合材料调用重绘。另外，我已经验证了在调用 dispose 之后，testCell.getChildren().length 返回 0，正如预期的那样，当我创建一个新标签时，我得到相同的表达式来返回 1，验证新元素确实得到了添加到其父复合容器我在这里遗漏了什么吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-22T14:48:41.567

在`changeText()`函数中，

> `testCell.redraw();`

行应替换为

> `testCell.layout();`

或者，如果你想正确调整它的大小，你应该使用

> `shell.layout();`.

* * *

## 回答 #2

> 赞同：-5
> 
> 时间：2012-04-03T16:38:06.243

我会说在标签上添加一个 selectionListener 。

```
.addSelectionListener(new SelectionAdapter() {
    @Override
    public void widgetSelected(final SelectionEvent e) {
        //Change text by Label.setText();
    }
} 
```

# compilation - 从 gfortran 移植到 ifort 时出现编译错误

> ID：1024733
> 
> 赞同：4
> 
> 时间：2009-06-21T20:55:34.647
> 
> 标签：compilation, intel, flags, gfortran

我正在尝试将程序从 gfortran 移植到 ifort（英特尔 Fortran 编译器 11）。我遇到了两个只能用 gfortran 编译的文件：

```
gfortran -x f77 -c daedrid.ff
gfortran -x f77-cpp-input -c daedris.ff 
```

当我尝试使用这些文件运行 intel fortran 编译器时，我得到：

```
ifort -fpp -c daedrid.ff
ifort: warning #10147: no action performed for specified file(s)
ifort -fpp -c daedris.ff
ifort: warning #10147: no action performed for specified file(s) 
```

并且没有创建目标文件。

现在，我该如何解决这个问题o_O？

**编辑：**将文件扩展名从 ff 重命名为 fpp

```
cp daedrid.ff daedrid.fpp
cp daedrid.ff daedrid.fpp 
```

帮助：

```
ifort -fpp -c daedrid.fpp
daedrid.fpp(1483): (col. 9) remark: LOOP WAS VECTORIZED.
daedrid.fpp(1490): (col. 11) remark: LOOP WAS VECTORIZED.
daedrid.fpp(1499): (col. 13) remark: LOOP WAS VECTORIZED.
ifort -fpp -c daedris.fpp
daedris.fpp(1626): (col. 9) remark: LOOP WAS VECTORIZED. 
```

[http://www.rcac.purdue.edu/userinfo/resources/black/userguide.cfm#compile_fortran_cpp](http://www.rcac.purdue.edu/userinfo/resources/black/userguide.cfm#compile_fortran_cpp)

**更新：**有没有办法让 intel fortran 编译器工作而不必重命名文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-23T07:51:41.540

您正在寻找的选项是`-Tf`and `-fpp`（以及可选的`-fixed`or `-free`. From `ifort -help`，相关行是：

```
-Tf<file>     compile file as Fortran source

-fpp[n]    run Fortran preprocessor on source files prior to compilation
     n=0   disable running the preprocessor, equivalent to no fpp
     n=1,2,3  run preprocessor

-[no]fixed,-FI specifies source files are in fixed format
-[no]free, -FR specifies source files are in free format 
```

因此，总而言之，如果您有需要预处理的固定格式源，您将使用：

```
ifort -fpp -fixed -Tfa.ff 
```

编译文件`a.ff`。

# java - 在 GWT 中向客户端抛出异常（Google Web Toolkit）

> ID：1024736
> 
> 赞同：2
> 
> 时间：2009-06-21T20:57:36.047
> 
> 标签：java, exception, gwt

我正在使用 GWT（目前正在使用 google 的 eclipse 插件），并且我试图从服务器向客户端抛出异常。

我的例外是

```
class LoginException extends Exception implements IsSerializable 
```

但我得到（在托管模式下加载）：

> [错误] '[...]/src/myPackage/client/services/Session.java' 中的错误
> 
> > [错误] 第 25 行：没有可用于类型 hugobarrera.gestorAlumnos.server.LoginException 的源代码；你忘了继承一个必需的模块吗？

Session.java 是：
[...]

```
public interface Session extends RemoteService { 
```

[...]（第 25 行：）

```
String newSession(String usr, String pwd) throws LoginException; 
```

[...]

我哪里错了？我读过一百万个人们在抛出异常时遇到问题的地方，但这些解决方案都没有应用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-01T03:21:40.703

所有需要序列化的类必须在 [...].client 包或子包中。

~~显然他们也可能没有构造函数。~~
[编辑] 您需要在可序列化类中有一个无参数构造函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-25T18:05:36.823

skaffman：LoginException 与 Session 不在同一个包中。

Hugo：将它们移到同一个包中解决了这个问题。

# .net - 如何在visual studio中引用安装在GAC中的自制程序集？

> ID：1024739
> 
> 赞同：2
> 
> 时间：2009-06-21T20:58:45.717
> 
> 标签：.net, visual-studio, reference, gac

我创建了一个自制程序集，我认为我使用 .Net 2.0 配置工具 (mscorcfg.msu) 在 GAC 中正确安装了它但是，当我想在 Visual Studio 中引用它时，我在哪里可以找到它？

（我知道，无论如何我都不应该使用 GAC，但请放纵我 ;-)）

编辑：我问的问题不够清楚：将程序集安装到 GAC 后，它没有显示在 Project-Add Reference 菜单的 .NET 选项卡上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T21:09:36.397

添加引用对话框实际上查看注册表，特别是：

*   [HKEY_LOCAL_MACHINE]\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders
*   [HKEY_CURRENT_USER]\SOFTWARE\Microsoft\.NETFramework\AssemblyFolders

要添加您的程序集，您必须编辑这些注册表项。或者简单地使用“浏览...”按钮（而不是）可能更诱人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-22T00:34:10.273

当您需要引用已部署到 GAC 的程序集时，您需要通过 Visual Studio 中“添加引用”对话框的“浏览”选项卡浏览到原始项目的 \bin\Debug 目录。

这样做的原因是，由于您已将程序集安装到 GAC 中，因此它将具有强名称，因此清单中的 .publickey 值。

当您引用其清单包含 .publickey 值的程序集时，Visual Studio 假定强命名程序集很可能会部署到 GAC，因此不会费心将二进制文件复制到您的应用程序文件夹。

相反，它将使用 GAC 中的版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-29T09:40:40.900

我创建了一个完全免费的工具，它将帮助您实现目标。[Muse VSReferences](http://visualstudiogallery.msdn.microsoft.com/en-us/36a6eb45-a7b1-47c3-9e85-09f0aef6e879)将允许您从“**添加 GAC 引用**”菜单项添加对项目的全局程序集缓存引用。

希望这个hekps，

Muse VSExtensions

# flash - 使用 loadMovie 加载的 SWF 文件不适用于 getBytesLoaded 或停止、播放等

> ID：1024742
> 
> 赞同：0
> 
> 时间：2009-06-21T21:02:22.010
> 
> 标签：flash, actionscript-2

我将 swf 加载到影片剪辑中，但遇到了几个问题：

```
blah_mc.loadMovie("my.swf");

blah_mc.stop(); // doesn't work
trace(blah_mc.getBytesLoaded()); // always returns zero even though the clip plays 
```

*即使在剪辑完全加载后，*这些问题仍然存在。

我需要能够控制加载电影的播放并告诉它加载的百分比。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T21:22:55.963

您是否像这样在 loadMovie 之后立即运行 stop() 等？如果你是的话，得到一个合理的结果可能还为时过早。设置一个间隔给它一点空间，或者看看使用其中一个 MovieClipLoader 类。如果您不这样做，那么我认为我没有足够的上下文来提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:20:15.687

`getBytesLoaded()`在 AS2 中也从未真正为我工作过（AS3 版本表现更好）。解决方案称为`MovieClipLoader`；检查语言参考。

# jquery - json问题（带有zend框架的valuems ajax上传器）

> ID：1024745
> 
> 赞同：5
> 
> 时间：2009-06-21T21:04:10.057
> 
> 标签：jquery, ajax, json, zend-framework, mime-types

我正在使用[ajax 上传](http://valums.com/ajax-upload/)器 和 Zend 框架。

问题是当我对 onSubmit 使用 json 响应时。我`$this->getHelper('Json')->sendJson($data);` 只得到一个保存对话框。

问题是上传者希望每个响应都是“text/html”，但 json 助手将“application/json”作为 mimetype 发送。

使用通常的响应，一切正常，但我需要将一些信息发送回脚本。

那么我怎么能说 Zend 应该发送带有 mimetype “text/html” 的 jsondata 呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T21:12:14.423

您可以使用[响应对象](http://framework.zend.com/manual/en/zend.controller.response.html)来影响响应。从您的控制器内部：

```
$content = Zend_Json::encode(array('Foo' => 'Nice', 'Bar' => 'Vice'));
$this->getResponse()
     ->setHeader('Content-Type', 'text/html')
     ->setBody($content)
     ->sendResponse();
exit(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-29T09:13:20.923

又一个变种

```
echo Zend_Json::encode(array('result' => true));
exit; 
```

# database-design - 数据库设计问题

> ID：1024746
> 
> 赞同：1
> 
> 时间：2009-06-21T21:05:05.907
> 
> 标签：database-design, data-modeling

我正在设计一个组织结构图，模型几乎已经准备好，并且为了清晰起见稍微简化了一点。

```
OrgUnit (OrgUnitId, Name, ReportsToOrgUnitId, ...)
OrgUnitJobs (OrgUnitJobId, OrgUnitId, JobName, ReportsToOrgUnitJobId, ... ,IsJobGroup)
Employee (EmployeeId, ........)
OrgUnitJobEmployee (OrgUnitJobId, EmployeeId, AssignedDate, .....,) 
```

所以我想知道每个 OrgUnit 的 ManagerEmployee（应该有一个），并且员工可以有不止一份工作，但其中一个必须是主要工作，所以我知道他的经理和其他东西是什么。这将支持 scnese 背后的一些工作流程，这就是为什么它不是一个非常简单的组织结构图模型。

那么你会怎么做，你会添加属性（IsManager 属性到 OrgUnitJobs 模型）还是添加 ManagerOrgUnitJobId 到 OrgUnitModel。为什么？

同样，对于员工，您会将 IsPrimaryJob 属性添加到 OrgUnitJobEmployee 模型，还是将 PrimaryJobId 添加到 Employee 模型。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-31T21:36:35.903

您可以考虑再添加 2 个表（尽管我可能会遗漏一些东西）：

```
OrgUnitManagers(OrgUnitJobID)  
OrgUnitJobEmployeeMain(OrgUnitJobEmployeeID) 
```

可以使用参照完整性设置来确保 OrgUnitJob 或 OrgUnitJobEmployee 记录是否被删除，这些表会自动更新（如果在您的数据库上可用）

*-或者-*

```
OrgUnitManager(OrgUnitJobID, OrgUnitId)  
OrgUnitJobEmployeeMain(EmployeeId, OrgUnitJobID) 
```

可以使用参照完整性和现在的索引来确保唯一性，尽管现在模式中有重复

*对于经理是在 OrgUnitJob 级别还是在 OrgUnitJobEmployeeID 级别指定的，我有点困惑？以上假设它在 OrgUnitJob，但如果它在员工级别，请将 OrgUnitManagers(OrgUnitJobID) 更改为 OrgUnitManagers(OrgUnitJobEmployeeID)*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:13:20.490

我不完全理解经理的概念。经理是员工还是组织单位？根据您的回答，我将在 OrgUnit 和/或 OrgUnitJobs 上拥有 ManagerEmployeeId 或 ManagerOrgUnitJobId 属性。

我会将 PrimaryJobId 添加到 Employee 中。这保证了员工只有**一项**主要工作。

所以我想在这两种情况下，我都喜欢 XxxId 类型的属性而不是布尔 IsXxx 属性。IsXxx 属性为多个经理或多个主要工作打开了大门。

# iphone - 如何修复 iPhone 3.0 操作系统中的 NSURLErrorDomain 错误 -999

> ID：1024748
> 
> 赞同：52
> 
> 时间：2009-06-21T21:05:18.073
> 
> 标签：iphone, iphone-sdk-3.0

我正在尝试更新我的 iPhone 应用程序以使用 OS 3.0。我有一个 UIWebView 可以很好地显示页面。但是当我单击一个链接时，它会调用我的代理 didFailLoadWithError 并且错误是操作无法完成。（NSURLErrorDomain 错误 -999。）我验证这仍然适用于 OS 2.2.1，所以它在 3.0 中有所改变。

有任何想法吗？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-06-27T18:56:17.577

我能够在[这里](http://www.iphonedevsdk.com/forum/iphone-sdk-development/6280-uiwebview-didfailloadwitherror-how-get-errors-code-list.html)找到答案。

此线程包含此错误的描述：`This error may occur if an another request is made before the previous request of WebView is completed...`

我通过忽略此错误并让 webview 继续加载来解决此问题。

```
if ([error code] != NSURLErrorCancelled) {
//show error alert, etc.
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2010-11-10T18:05:51.717

NSURLErrorCancelled (-999)

“取消异步加载时返回。Web Kit 框架委托在对加载资源执行取消操作时会收到此错误。请注意，如果取消下载，NSURLConnection 或 NSURLDownload 委托将不会收到此错误。”

对于我的情况（可能还有你的情况），这可以忽略：

```
if([error code] == NSURLErrorCancelled) return; // Ignore this error 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-04-23T11:32:48.653

上面的两个回复是正确的> 如果加载请求导致取消，只需返回即可。

另外我想指出的是，人们**不要忘记**在你的**didFailLoadWithError**方法中放置一个 NSLog，这样可以通过发现问题来防止浪费大量时间！

所以这是我上面提到的最终解决方案：

```
-(void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error
{
    NSLog(@"ERROR : %@",error); //Get informed of the error FIRST
    if([error code] == NSURLErrorCancelled) 
        return;
} 
```

# algorithm - 如何计算 3D Morton 数（交错 3 个整数的位）

> ID：1024754
> 
> 赞同：39
> 
> 时间：2009-06-21T21:08:25.260
> 
> 标签：algorithm, bit-manipulation, z-order-curve

我正在寻找一种快速计算 3D 莫顿数的方法。[这个站点](http://www.graphics.stanford.edu/~seander/bithacks.html#InterleaveBMN)有一个基于幻数的技巧来处理 2D 莫顿数，但如何将其扩展到 3D 似乎并不明显。

所以基本上我有 3 个 10 位数字，我想用最少的操作将它们交织成一个 30 位数字。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-21T22:28:39.480

您可以使用相同的技术。我假设变量包含 32 位整数，最高 22 位设置为`0`（这比必要的限制更多）。`x`对于包含三个 10 位整数之一的每个变量，我们执行以下操作：

```
x = (x | (x << 16)) & 0x030000FF;
x = (x | (x <<  8)) & 0x0300F00F;
x = (x | (x <<  4)) & 0x030C30C3;
x = (x | (x <<  2)) & 0x09249249; 
```

然后，使用`x`和`y`三个`z`经过处理的 10 位整数，我们通过以下方式得到结果：

```
x | (y << 1) | (z << 2) 
```

该技术的工作方式如下。上面的每一`x = ...`行将位组“拆分”成两半，以便在其间有足够的空间容纳其他整数的位。例如，如果我们考虑三个 4 位整数，我们将一个具有 1234 位的整数拆分为 000012000034，其中零保留给其他整数。在下一步中，我们以相同的方式将 12 和 34 拆分为 001002003004。尽管 10 位不能很好地重复划分为两组，但您可以将其视为 16 位，最终您会丢失最高的位.

正如你从第一行看到的，你实际上只需要`x`它持有的每个输入整数`x & 0x03000000 == 0`.

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2013-08-30T08:53:15.427

**这是我使用 python 脚本的解决方案：**

我从他的评论中得到了暗示：[Fabian “ryg” Giesen](http://fgiesen.wordpress.com/2009/12/13/decoding-morton-codes/)
阅读下面的长评论！我们需要跟踪哪些位需要走多远！
然后在每一步中，我们选择这些位并移动它们并应用位掩码（参见最后几行的注释）来掩盖它们！

```
Bit Distances: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]
Bit Distances (binary): ['0', '10', '100', '110', '1000', '1010', '1100', '1110', '10000', '10010']
Shifting bits by 1   for bits idx: []
Shifting bits by 2   for bits idx: [1, 3, 5, 7, 9]
Shifting bits by 4   for bits idx: [2, 3, 6, 7]
Shifting bits by 8   for bits idx: [4, 5, 6, 7]
Shifting bits by 16  for bits idx: [8, 9]
BitPositions: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
Shifted bef.:   0000 0000 0000 0000 0000 0011 0000 0000 hex: 0x300
Shifted:        0000 0011 0000 0000 0000 0000 0000 0000 hex: 0x3000000
NonShifted:     0000 0000 0000 0000 0000 0000 1111 1111 hex: 0xff
Bitmask is now: 0000 0011 0000 0000 0000 0000 1111 1111 hex: 0x30000ff

Shifted bef.:   0000 0000 0000 0000 0000 0000 1111 0000 hex: 0xf0
Shifted:        0000 0000 0000 0000 1111 0000 0000 0000 hex: 0xf000
NonShifted:     0000 0011 0000 0000 0000 0000 0000 1111 hex: 0x300000f
Bitmask is now: 0000 0011 0000 0000 1111 0000 0000 1111 hex: 0x300f00f

Shifted bef.:   0000 0000 0000 0000 1100 0000 0000 1100 hex: 0xc00c
Shifted:        0000 0000 0000 1100 0000 0000 1100 0000 hex: 0xc00c0
NonShifted:     0000 0011 0000 0000 0011 0000 0000 0011 hex: 0x3003003
Bitmask is now: 0000 0011 0000 1100 0011 0000 1100 0011 hex: 0x30c30c3

Shifted bef.:   0000 0010 0000 1000 0010 0000 1000 0010 hex: 0x2082082
Shifted:        0000 1000 0010 0000 1000 0010 0000 1000 hex: 0x8208208
NonShifted:     0000 0001 0000 0100 0001 0000 0100 0001 hex: 0x1041041
Bitmask is now: 0000 1001 0010 0100 1001 0010 0100 1001 hex: 0x9249249

x &= 0x3ff
x = (x | x << 16) & 0x30000ff   <<< THIS IS THE MASK for shifting 16 (for bit 8 and 9)
x = (x | x << 8) & 0x300f00f
x = (x | x << 4) & 0x30c30c3
x = (x | x << 2) & 0x9249249 
```

**因此，对于 10 位数字和 2 个交错位（对于 32 位），您需要执行以下操作！：**

```
x &= 0x3ff
x = (x | x << 16) & 0x30000ff   #<<< THIS IS THE MASK for shifting 16 (for bit 8 and 9)
x = (x | x << 8) & 0x300f00f
x = (x | x << 4) & 0x30c30c3
x = (x | x << 2) & 0x9249249 
```

**对于 21 位数字和 2 个交错位（对于 64 位），您需要执行以下操作！：**

```
x &= 0x1fffff
x = (x | x << 32) & 0x1f00000000ffff
x = (x | x << 16) & 0x1f0000ff0000ff
x = (x | x << 8) & 0x100f00f00f00f00f
x = (x | x << 4) & 0x10c30c30c30c30c3
x = (x | x << 2) & 0x1249249249249249 
```

**对于 42 位数字和 2 个交错位（对于 128 位），您需要执行以下操作（以防万一；-)）：**

```
x &= 0x3ffffffffff
x = (x | x << 64) & 0x3ff0000000000000000ffffffffL
x = (x | x << 32) & 0x3ff00000000ffff00000000ffffL
x = (x | x << 16) & 0x30000ff0000ff0000ff0000ff0000ffL
x = (x | x << 8) & 0x300f00f00f00f00f00f00f00f00f00fL
x = (x | x << 4) & 0x30c30c30c30c30c30c30c30c30c30c3L
x = (x | x << 2) & 0x9249249249249249249249249249249L 
```

**用于生成和检查交错模式的 Python 脚本！！！**

```
def prettyBinString(x,d=32,steps=4,sep=".",emptyChar="0"):
    b = bin(x)[2:]
    zeros = d - len(b)

    if zeros <= 0: 
        zeros = 0
        k = steps - (len(b) % steps)
    else:
        k = steps - (d % steps)

    s = ""
    #print("zeros" , zeros)
    #print("k" , k)
    for i in range(zeros): 
        #print("k:",k)
        if(k%steps==0 and i!= 0):
            s+=sep
        s += emptyChar
        k+=1

    for i in range(len(b)):
        if( (k%steps==0 and i!=0 and zeros == 0) or  (k%steps==0 and zeros != 0) ):
            s+=sep
        s += b[i]
        k+=1
    return s    

def binStr(x): return prettyBinString(x,32,4," ","0")

def computeBitMaskPatternAndCode(numberOfBits, numberOfEmptyBits):
    bitDistances=[ i*numberOfEmptyBits for i in range(numberOfBits) ]
    print("Bit Distances: " + str(bitDistances))
    bitDistancesB = [bin(dist)[2:] for dist in  bitDistances]
    print("Bit Distances (binary): " + str(bitDistancesB))
    moveBits=[] #Liste mit allen Bits welche aufsteigend um 2, 4,8,16,32,64,128 stellen geschoben werden müssen

    maxLength = len(max(bitDistancesB, key=len))
    abort = False
    for i in range(maxLength):
        moveBits.append([])
        for idx,bits in enumerate(bitDistancesB):
            if not len(bits) - 1 < i:
                if(bits[len(bits)-i-1] == "1"):
                    moveBits[i].append(idx)

    for i in range(len(moveBits)):
        print("Shifting bits by " + str(2**i) + "\t for bits idx: " + str(moveBits[i]))

    bitPositions = range(numberOfBits);
    print("BitPositions: " + str(bitPositions))
    maskOld = (1 << numberOfBits) -1

    codeString = "x &= " + hex(maskOld) + "\n"
    for idx in xrange(len(moveBits)-1, -1, -1):
        if len(moveBits[idx]):

           shifted = 0
           for bitIdxToMove in moveBits[idx]:
                shifted |= 1<<bitPositions[bitIdxToMove];
                bitPositions[bitIdxToMove] += 2**idx; # keep track where the actual bit stands! might get moved several times

           # Get the non shifted part!     
           nonshifted = ~shifted & maskOld

           print("Shifted bef.:\t" + binStr(shifted) + " hex: " + hex(shifted))
           shifted = shifted << 2**idx
           print("Shifted:\t" + binStr(shifted)+ " hex: " + hex(shifted))

           print("NonShifted:\t" + binStr(nonshifted) + " hex: " + hex(nonshifted))
           maskNew =  shifted | nonshifted
           print("Bitmask is now:\t" + binStr(maskNew) + " hex: " + hex(maskNew) +"\n")
           #print("Code: " + "x = x | x << " +str(2**idx)+ " & " +hex(maskNew))

           codeString += "x = (x | x << " +str(2**idx)+ ") & " +hex(maskNew) + "\n"
           maskOld = maskNew
    return codeString

numberOfBits = 10;
numberOfEmptyBits = 2;
codeString = computeBitMaskPatternAndCode(numberOfBits,numberOfEmptyBits);
print(codeString)

def partitionBy2(x):
    exec(codeString)
    return x

def checkPartition(x):
    print("Check partition for: \t" + binStr(x))
    part = partitionBy2(x);
    print("Partition is : \t\t" + binStr(part))
    #make the pattern manualy
    partC = long(0);
    for bitIdx in range(numberOfBits):
        partC  = partC | (x & (1<<bitIdx)) << numberOfEmptyBits*bitIdx
    print("Partition check is :\t" + binStr(partC))
    if(partC == part):
        return True
    else:
        return False

checkError = False        
for i in range(20):
    x = random.getrandbits(numberOfBits);
    if(checkPartition(x) == False):
        checkError = True
        break
if not checkError:
    print("CHECK PARTITION SUCCESSFUL!!!!!!!!!!!!!!!!...")
else:
    print("checkPartition has ERROR!!!!") 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-21T22:23:45.670

最简单的可能是查找表，如果您有 4K 可用空间：

```
static uint32_t t [ 1024 ] = { 0, 0x1, 0x8, ... };

uint32_t m ( int a, int b, int c )
{
    return t[a] | ( t[b] << 1 ) | ( t[c] << 2 );
} 
```

位黑客使用移位和掩码将位展开，因此每次它移位值并对其进行或运算，将一些位复制到空白空间中，然后屏蔽组合以便只保留原始位。

例如：

```
x = 0xabcd;
  = 0000_0000_0000_0000_1010_1011_1100_1101    

x = (x | (x << S[3])) & B[3]; 

  = ( 0x00abcd00 | 0x0000abcd ) & 0xff00ff 
  = 0x00ab__cd & 0xff00ff 
  = 0x00ab00cd
  = 0000_0000_1010_1011_0000_0000_1100_1101
x = (x | (x << S[2])) & B[2]; 
  = ( 0x0ab00cd0 | 0x00ab00cd) & 0x0f0f0f0f 
  =   0x0a_b_c_d & 0x0f0f0f0f 
  = 0x0a0b0c0d 
  = 0000_1010_0000_1011_0000_1100_0000_1101
x = (x | (x << S[1])) & B[1]; 
  = ( 0000_1010_0000_1011_0000_1100_0000_1101 | 
      0010_1000_0010_1100_0011_0000_0011_0100 ) &
      0011_0011_0011_0011_0011_0011_0011_0011
  =   0010_0010_0010_0011_0011_0000_0011_0001
x = (x | (x << S[0])) & B[0]; 
  = ( 0010_0010_0010_0011_0011_0000_0011_0001 | 
      0100_0100_0100_0110_0110_0000_0110_0010 ) &
      0101_0101_0101_0101_0101_0101_0101_0101
  =   0100_0010_0100_0101_0101_0000_0101_0001 
```

在每次迭代中，每个块都被分成两部分，块最左半部分的最右边位移动到其最终位置，并应用掩码以便只保留所需的位。

一旦你将输入分开，移动它们以使一个的值落入另一个的零是很容易的。

要将该技术扩展到最终结果中的值之间的两位以上，您必须增加位结束位置之间的移位。它变得有点棘手，因为起始块大小不是 2 的幂，因此您可以将其拆分为中间，或者以 2 的幂为边界。

所以像这样的进化可能会奏效：

```
0000_0000_0000_0000_0000_0011_1111_1111    
0000_0011_0000_0000_0000_0000_1111_1111    
0000_0011_0000_0000_1111_0000_0000_1111    
0000_0011_0000_1100_0011_0000_1100_0011    
0000_1001_0010_0100_1001_0010_0100_1001    

// 0000_0000_0000_0000_0000_0011_1111_1111    
x = ( x | ( x << 16 ) ) & 0x030000ff;
// 0000_0011_0000_0000_0000_0000_1111_1111    
x = ( x | ( x << 8 ) ) & 0x0300f00f;
// 0000_0011_0000_0000_1111_0000_0000_1111    
x = ( x | ( x << 4 ) ) & 0x030c30c3;
// 0000_0011_0000_1100_0011_0000_1100_0011    
x = ( x | ( x << 2 ) ) & 0x09249249;
// 0000_1001_0010_0100_1001_0010_0100_1001 
```

对输入执行相同的转换，一个接一个移动两个，或者将它们一起移动，你就完成了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-21T22:35:22.807

好时机，我上个月刚做的！

关键是要实现两个功能。一个将位分散到每三分之一位。然后我们可以将其中三个组合在一起（最后两个移位）以获得最终的 Morton 交错值。

此代码从 HIGH 位开始交错（这对于定点值更合乎逻辑。）如果您的应用程序每个组件只有 10 位，只需将每个值左移 22 以使其从高位开始。

```
/* Takes a value and "spreads" the HIGH bits to lower slots to seperate them.
   ie, bit 31 stays at bit 31, bit 30 goes to bit 28, bit 29 goes to bit 25, etc.
   Anything below bit 21 just disappears. Useful for interleaving values
   for Morton codes. */
inline unsigned long spread3(unsigned long x)
{
  x=(0xF0000000&x) | ((0x0F000000&x)>>8) | (x>>16); // spread top 3 nibbles
  x=(0xC00C00C0&x) | ((0x30030030&x)>>4);
  x=(0x82082082&x) | ((0x41041041&x)>>2);
  return x;
}

inline unsigned long morton(unsigned long x, unsigned long y, unsigned long z)
{
  return spread3(x) | (spread3(y)>>1) | (spread3(z)>>2);
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-21T22:27:49.843

以下代码查找三个 10 位输入数字的莫顿数。它使用您链接中的idee并在步骤5-5、3-2-3-2、2-1-1-1-2-1-1-1和1-1-1-中执行位扩展1-1-1-1-1-1-1 因为 10 不是 2 的幂。

```
......................9876543210
............98765..........43210
........987....56......432....10
......98..7..5..6....43..2..1..0
....9..8..7..5..6..4..3..2..1..0 
```

在上图中，您可以看到四个步骤的第一个和每个步骤之后每个位的位置。

```
public static Int32 GetMortonNumber(Int32 x, Int32 y, Int32 z)
{
    return SpreadBits(x, 0) | SpreadBits(y, 1) | SpreadBits(z, 2);
}

public static Int32 SpreadBits(Int32 x, Int32 offset)
{
    if ((x < 0) || (x > 1023))
    {
        throw new ArgumentOutOfRangeException();
    }

    if ((offset < 0) || (offset > 2))
    {
        throw new ArgumentOutOfRangeException();
    }

    x = (x | (x << 10)) & 0x000F801F;
    x = (x | (x <<  4)) & 0x00E181C3;
    x = (x | (x <<  2)) & 0x03248649;
    x = (x | (x <<  2)) & 0x09249249;

    return x << offset;
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-01-29T18:46:32.183

我采用上述方法并将其修改为将 3 个 16 位数字组合成一个 48 位（实际上是 64 位）数字。也许它会节省一些人到达那里的想法。

```
#include <inttypes.h>
#include <assert.h>
uint64_t zorder3d(uint64_t x, uint64_t y, uint64_t z){
     static const uint64_t B[] = {0x00000000FF0000FF, 0x000000F00F00F00F,
                                    0x00000C30C30C30C3, 0X0000249249249249};           
     static const int S[] =  {16, 8, 4, 2}; 
     static const uint64_t MAXINPUT = 65536;

     assert( ( (x < MAXINPUT) ) && 
      ( (y < MAXINPUT) ) && 
      ( (z < MAXINPUT) )
     );

     x = (x | (x << S[0])) & B[0];
     x = (x | (x << S[1])) & B[1];
     x = (x | (x << S[2])) & B[2];
     x = (x | (x << S[3])) & B[3];

     y = (y | (y << S[0])) & B[0];
     y = (y | (y << S[1])) & B[1];
     y = (y | (y << S[2])) & B[2];
     y = (y | (y << S[3])) & B[3];

     z = (z | (z <<  S[0])) & B[0];
     z = (z | (z <<  S[1])) & B[1];
     z = (z | (z <<  S[2])) & B[2];
     z = (z | (z <<  S[3])) & B[3];

     return ( x | (y << 1) | (z << 2) );
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-03-04T18:53:00.073

以下是为 3-D 点生成大小为 64 位的 Morton 密钥的代码片段。

```
using namespace std;

unsigned long long spreadBits(unsigned long long x)
{
    x=(x|(x<<20))&0x000001FFC00003FF;
    x=(x|(x<<10))&0x0007E007C00F801F;
    x=(x|(x<<4))&0x00786070C0E181C3;
    x=(x|(x<<2))&0x0199219243248649;
    x=(x|(x<<2))&0x0649249249249249;
    x=(x|(x<<2))&0x1249249249249249;
    return x;
}

int main()
{
    unsigned long long x,y,z,con=1;
    con=con<<63;
    printf("%#llx\n",(spreadBits(x)|(spreadBits(y)<<1)|(spreadBits(z)<<2))|con);    
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-04-05T01:19:51.050

我今天遇到了类似的问题，但是我必须组合任意数量的任意位长度的数字，而不是 3 个数字。我采用了我自己的位扩展和掩码算法，并将其应用于 C# BigIntegers。这是我写的代码。作为编译步骤，它计算出给定维数和位深度的幻数和掩码。然后，您可以重用该对象进行多次转换。

```
/// <summary>
/// Convert an array of integers into a Morton code by interleaving the bits.
/// Create one Morton object for a given pair of Dimension and BitDepth and reuse if when encoding multiple 
/// Morton numbers.
/// </summary>  
public class Morton
{
    /// <summary>
    /// Number of bits to use to represent each number being interleaved.
    /// </summary>
    public int BitDepth { get; private set; }

    /// <summary>
    /// Count of separate numbers to interleave into a Morton number.
    /// </summary>
    public int Dimensions { get; private set; }

    /// <summary>
    /// The MagicNumbers spread the bits out to the right position.
    /// Each must must be applied and masked, because the bits would overlap if we only used one magic number.
    /// </summary>
    public BigInteger LargeMagicNumber { get; private set; }
    public BigInteger SmallMagicNumber { get; private set; }

    /// <summary>
    /// The mask removes extraneous bits that were spread into positions needed by the other dimensions.
    /// </summary>
    public BigInteger Mask { get; private set; }

    public Morton(int dimensions, int bitDepth)
    {
        BitDepth = bitDepth;
        Dimensions = dimensions;
        BigInteger magicNumberUnit = new BigInteger(1UL << (int)(Dimensions - 1));
        LargeMagicNumber = magicNumberUnit;
        BigInteger maskUnit = new BigInteger(1UL << (int)(Dimensions - 1));
        Mask = maskUnit;
        for (var i = 0; i < bitDepth - 1; i++)
        {
            LargeMagicNumber = (LargeMagicNumber << (Dimensions - 1)) | (i % 2 == 1 ? magicNumberUnit : BigInteger.Zero);
            Mask = (Mask << Dimensions) | maskUnit;       
        }
        SmallMagicNumber = (LargeMagicNumber >> BitDepth) << 1; // Need to trim off pesky ones place bit.
    }

    /// <summary>
    /// Interleave the bits from several integers into a single BigInteger.
    /// The high-order bit from the first number becomes the high-order bit of the Morton number.
    /// The high-order bit of the second number becomes the second highest-ordered bit in the Morton number.
    /// 
    /// How it works.
    /// 
    /// When you multupliy by the magic numbers you make multiple copies of the the number they are multplying, 
    /// each shifted by a different amount.
    /// As it turns out, the high order bit of the highest order copy of a number is N bits to the left of the 
    /// second bit of the second copy, and so forth. 
    /// This is because each copy is shifted one bit less than N times the copy number.
    /// After that, you apply the AND-mask to unset all bits that are not in position.
    /// 
    /// Two magic numbers are needed because since each copy is shifted one less than the bitDepth, consecutive
    /// copies would overlap and ruin the algorithm. Thus one magic number (LargeMagicNumber) handles copies 1, 3, 5, etc, while the 
    /// second (SmallMagicNumber) handles copies 2, 4, 6, etc.
    /// </summary>
    /// <param name="vector">Integers to combine.</param>
    /// <returns>A Morton number composed of Dimensions * BitDepth bits.</returns>
    public BigInteger Interleave(int[] vector)
    {
        if (vector == null || vector.Length != Dimensions)
            throw new ArgumentException("Interleave expects an array of length " + Dimensions, "vector");
        var morton = BigInteger.Zero;
        for (var i = 0; i < Dimensions; i++)
        {
            morton |= (((LargeMagicNumber * vector[i]) & Mask) | ((SmallMagicNumber * vector[i]) & Mask)) >> i;
        }
        return morton;
    }

    public override string ToString()
    {
        return "Morton(Dimension: " + Dimensions + ", BitDepth: " + BitDepth 
            + ", MagicNumbers: " + Convert.ToString((long)LargeMagicNumber, 2) + ", " + Convert.ToString((long)SmallMagicNumber, 2)
            + ", Mask: " + Convert.ToString((long)Mask, 2) + ")";
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-26T03:04:49.877

这是我用 Ruby 制作的生成器，用于生成任意长度的编码方法：

```
def morton_code_for(bits)
  method = ''

  limit_mask = (1 << (bits * 3)) - 1
  split = (2 ** ((Math.log(bits) / Math.log(2)).to_i + 1)).to_i
  level = 1

  puts "// Coding for 3 #{bits}-bit values"

  loop do
    shift = split
    split /= 2
    level *= 2

    mask = ([ '1' * split ] * level).join('0' * split * 2).to_i(2) & limit_mask

    expression = "v = (v | (v << %2d)) & 0x%016x;" % [ shift, mask ]

    method << expression

    puts "%s // 0b%064b" % [ expression, mask ]

    break if (split <= 1)
  end

  puts
  print "// Test of method results: "
  v = (1 << bits) - 1
  puts eval(method).to_s(2)
end

morton_code_for(21) 
```

输出具有适当的通用性，可以根据需要进行调整。样本输出：

```
// Coding for 3 21-bit values
v = (v | (v << 32)) & 0x7fff00000000ffff; // 0b0111111111111111000000000000000000000000000000001111111111111111
v = (v | (v << 16)) & 0x00ff0000ff0000ff; // 0b0000000011111111000000000000000011111111000000000000000011111111
v = (v | (v <<  8)) & 0x700f00f00f00f00f; // 0b0111000000001111000000001111000000001111000000001111000000001111
v = (v | (v <<  4)) & 0x30c30c30c30c30c3; // 0b0011000011000011000011000011000011000011000011000011000011000011
v = (v | (v <<  2)) & 0x1249249249249249; // 0b0001001001001001001001001001001001001001001001001001001001001001

// Test of method results: 1001001001001001001001001001001001001001001001001001001001001 
```

# php - 从外部 JS 读取 PHP 文件变量

> ID：1024755
> 
> 赞同：0
> 
> 时间：2009-06-21T21:08:29.347
> 
> 标签：php, javascript, include

如何通过 JS（我的意思是外部脚本）检索在`php`包含文件中分配的某些变量的值，如下所示？

```
<?php 
    $var1 = "a";
    $var2 = "foo";
?> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-21T21:13:20.757

假设您的意思是使用 AJAX 请求来检索变量......最好的方法是：

```
<?php
    $array["var1"]="a";
    $array["var2"]="foo";
    echo json_encode($array);
?> 
```

在 JS 端，你会想要做：

```
json = eval( "(" + response + ")" ); 
```

var1 和 var2 将是 json.var1/json.var2

* * *

编辑：

在这种情况下，您应该能够执行以下操作：

```
<script type="text/javascript">
    var phpvars = <?php echo json_encode($array); ?>;
<script> 
```

只需将其放在将包含 whistle.js 的位置，然后该文件中的 Javascript 将能够通过 phpvars 访问变量。（更改 variables.php 文件，使其具有与上述相同的格式，除了没有回显它）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-25T21:31:23.180

重申之前的反馈，PHP 用于生成 HTML —— PHP 文件本身对浏览器是不可用的。您可以使用`variables.php`生成隐藏标签，然后使用 JavaScript 读取它们。

例如，

variables.php 输出：

```
<div id='varA' style='display:none'>foo</div> 
```

javascript:

```
document.getElementById('varA').innerText 
```

或者

variables.php 输出：

```
 <input id='varB' type='hidden' value='bar' /> 
```

javascript:

```
 document.getElementById('varB').value 
```

# winapi - 在 Win32 上创建新窗口时如何通知我？

> ID：1024756
> 
> 赞同：15
> 
> 时间：2009-06-21T21:08:44.743
> 
> 标签：winapi, user32

有没有办法使用 Win32 在创建新窗口时注册通知。我正在尝试保留当前打开的窗口列表，但现在只是使用`EnumWindows()`.

有人做过类似的事情吗？

谢谢

* * *

我不确定我这样做是否正确，但我无法触发 SetWindowsHookEx 方法。

有什么想起来的吗​​？

这是我的片段

```
[DllImport("user32.dll", SetLastError = true)]
private static extern IntPtr SetWindowsHookEx(HookType hook, HookProc callback, IntPtr hMod, uint dwThreadId);

[DllImport("user32.dll")]
private static extern int CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, IntPtr lParam);
const int HSHELL_WINDOWCREATED = 1;

private static HookProc winDelegate = ShellHookProcDelegate;
internal static void RegisterWindowCreatedEvent()
{
    SetWindowsHookEx(HookType.WH_SHELL, winDelegate, IntPtr.Zero, 0);
}

private static int ShellHookProcDelegate(int code, IntPtr wParam, IntPtr lParam)
{
    if (code != HSHELL_WINDOWCREATED)
    {
        return CallNextHookEx(IntPtr.Zero, code, wParam, lParam);
    }

    //App specific code here

    return CallNextHookEx(IntPtr.Zero, code, wParam, lParam);
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-21T21:14:07.947

用于[`SetWindowsHookEx`](http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx)设置[`WH_SHELL`](http://msdn.microsoft.com/en-us/library/ms644991(VS.85).aspx)挂钩并查找`HSHELL_WINDOWCREATED`事件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T21:14:54.140

当然-您可以编写[一个 CBT 钩子](http://msdn.microsoft.com/en-us/library/ms644977.aspx)并监视`HCBT_CREATEWND`. 另请参阅[`SetWindowsHookEx()`](http://msdn.microsoft.com/en-us/library/ms644990.aspx)。

* * *

请注意，这将允许您在创建的窗口甚至完全初始化之前收到*所有*窗口创建的通知。如果您只需要无主的顶级窗口，[RichieHindle 的建议](https://stackoverflow.com/questions/1024756/new-window-created-event-win32/1024771#1024771)可能会更好......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-08-06T22:08:26.577

这是一些基于[UI 自动化事件](https://docs.microsoft.com/en-us/windows/win32/winauto/uiauto-eventsoverview)的代码。它提供窗口打开、关闭和聚焦事件。

C＃

```
[STAThread]
public static void Main(string[] args)
{
    Automation.AddAutomationEventHandler(WindowPattern.WindowOpenedEvent, AutomationElement.RootElement, TreeScope.Children, (sender, e) =>
    {
        var element = (AutomationElement)sender;
        var name = element.Current.Name;
        Console.WriteLine("open: " + name + " hwnd:" + element.Current.NativeWindowHandle);
        Automation.AddAutomationEventHandler(WindowPattern.WindowClosedEvent, element, TreeScope.Element, (s, e2) =>
        {
            Console.WriteLine("close: " + name + " hwnd:" + element.Current.NativeWindowHandle);
        });
    });

    Automation.AddAutomationFocusChangedEventHandler((sender, e) =>
    {
        var element = (AutomationElement)sender;
        var name = element.Current.Name;
        Console.WriteLine("focused: " + name + " hwnd:" + element.Current.NativeWindowHandle);
    });
    Console.ReadLine();
    Automation.RemoveAllEventHandlers();
} 
```

C++ 等价物：

```
#include <windows.h>
#include <stdio.h>
#include <uiautomation.h>

// some useful macros
#define WIDEN2(x) L ## x
#define WIDEN(x) WIDEN2(x)
#define __WFILE__ WIDEN(__FILE__)

#define MYTRACE wprintf
#define CHECKHR(expr) {hr=(expr);if(FAILED(hr)){ MYTRACE(L"HR FAILED line:%u file:%s\n", __LINE__, __WFILE__); goto cleanup; } }  
#define CHECKWIN32(expr) {if(!(expr)){hr = HRESULT_FROM_WIN32(GetLastError()); MYTRACE(L"WIN32 FAILED line:%u file:%s\n", __LINE__, __WFILE__); goto cleanup; } }  
#define CHECKARG(expr) {if(!(expr)){ MYTRACE(L"ARG FAILED line:%u file:%s\n", __LINE__, __WFILE__); hr = E_INVALIDARG; goto cleanup; } }  
#define CHECKMEM(expr) {if(!(expr)){ MYTRACE(L"MEM FAILED line:%u file:%s\n", __LINE__, __WFILE__); hr = E_OUTOFMEMORY; goto cleanup; } } 
#define CORELEASE(expr) {if(expr){ expr->Release(); expr = NULL; } } 
#define HR HRESULT hr=S_OK;

class EventHandler :
  public IUIAutomationEventHandler,
  public IUIAutomationFocusChangedEventHandler
{
private:
  LONG _ref;
  IUIAutomation* _automation;
  HWND _hwnd;
  IUIAutomationElement* _sender;

public:
  EventHandler(IUIAutomation* automation, IUIAutomationElement* sender, HWND hwnd) :
    _ref(1),
    _automation(automation),
    _sender(sender),
    _hwnd(hwnd)
  {
    if (sender)
    {
      sender->AddRef();
    }
  }

  ~EventHandler()
  {
    CORELEASE(_sender);
  }

  // IUnknown
  ULONG STDMETHODCALLTYPE AddRef() { ULONG ret = InterlockedIncrement(&_ref); return ret; }
  ULONG STDMETHODCALLTYPE Release() { ULONG ret = InterlockedDecrement(&_ref); if (!ret) { delete this; return 0; } return ret; }
  HRESULT STDMETHODCALLTYPE QueryInterface(REFIID riid, void** ppInterface)
  {
    if (riid == __uuidof(IUnknown))
    {
      *ppInterface = (IUIAutomationEventHandler*)this;
    }
    else if (riid == __uuidof(IUIAutomationEventHandler))
    {
      *ppInterface = (IUIAutomationEventHandler*)this;
    }
    else if (riid == __uuidof(IUIAutomationFocusChangedEventHandler))
    {
      *ppInterface = (IUIAutomationFocusChangedEventHandler*)this;
    }
    else
    {
      *ppInterface = NULL;
      return E_NOINTERFACE;
    }

    AddRef();
    return S_OK;
  }

  // IUIAutomationFocusChangedEventHandler
  HRESULT STDMETHODCALLTYPE HandleFocusChangedEvent(IUIAutomationElement* sender)
  {
    HWND hwnd = NULL;
    sender->get_CurrentNativeWindowHandle((UIA_HWND*)&hwnd);
    wprintf(L"Window focused hwnd:%p'\n", hwnd);
    return S_OK;
  }

  // IUIAutomationEventHandler
  HRESULT STDMETHODCALLTYPE HandleAutomationEvent(IUIAutomationElement* sender, EVENTID eventID)
  {
    HR;
    HWND hwnd = NULL;
    EventHandler* windowHandler;

    switch (eventID)
    {
    case UIA_Window_WindowOpenedEventId:
      sender->get_CurrentNativeWindowHandle((UIA_HWND*)&hwnd);
      wprintf(L"Window opened hwnd:%p\n", hwnd);

      // register for close on this window
      // we build a new handler, this is the only way to remember the hwnd (the close event doesn't have anything)
      windowHandler = new EventHandler(_automation, sender, hwnd); // implicit addref
      CHECKMEM(windowHandler);
      CHECKHR(_automation->AddAutomationEventHandler(UIA_Window_WindowClosedEventId, sender, TreeScope_Element, NULL, windowHandler));
      break;

    case UIA_Window_WindowClosedEventId:
      wprintf(L"Window closed hwnd:%p\n", _hwnd);
      CHECKHR(_automation->RemoveAutomationEventHandler(UIA_Window_WindowClosedEventId, _sender, this));
      Release(); // we release our own reference, 'this' we be deleted sometime when all COM references are gone. don't do 'delete this'!
      break;
    }

  cleanup:
    return hr;
  }
};

int main()
{
  HR;
  IUIAutomationElement* root = NULL;
  EventHandler* handler = NULL;
  IUIAutomation* automation = NULL;

  CoInitializeEx(NULL, COINIT_MULTITHREADED);
  CHECKHR(CoCreateInstance(__uuidof(CUIAutomation), NULL, CLSCTX_INPROC_SERVER, __uuidof(IUIAutomation), (void**)&automation));

  CHECKHR(automation->GetRootElement(&root));

  handler = new EventHandler(automation, NULL, NULL);
  CHECKMEM(handler);

  CHECKHR(automation->AddAutomationEventHandler(UIA_Window_WindowOpenedEventId, root, TreeScope_Subtree, NULL, handler));
  CHECKHR(automation->AddFocusChangedEventHandler(NULL, handler));

  wprintf(L"Press any key to stop listening for events.\n");
  getchar();

cleanup:
  if (automation != NULL)
  {
    automation->RemoveAllEventHandlers();
    CORELEASE(automation);
  }

  CORELEASE(handler);
  CORELEASE(root);
  CoUninitialize();
  return hr;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T21:15:11.987

[Detours](http://research.microsoft.com/en-us/projects/detours/)将允许您将挂钩附加到任意 Win32 函数。但是，轮询可能是解决问题的一种更可靠的方法：您不必担心是否错过了特定的窗口创建方法（Win32 中有多少种方法？我敢打赌不止一个！），并且，当然，您不会**在运行时重写 Windows 函数的机器代码**。

但是，你知道，你的电话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-28T01:13:25.333

您可以尝试自动热键的[WinEventHook](http://www.autohotkey.com/forum/topic35659.html)库。尝试使用以下内容修改记事本弹出窗口阻止程序[示例](http://www.autohotkey.com/forum/topic35659.html&postdays=0&postorder=asc&highlight=wineventhook&start=5)：

`HookProc( hWinEventHook, Event, hWnd, idObject, idChild, dwEventThread, dwmsEventTime ) { if Event ; EVENT_SYSTEM_FOREGROUND = 0x3 {
WinGetTitle, title, ahk_id %hWnd% If (title = "your_window_name" msgbox, your window has been created } }`

# php - zip_open(); PHP 5.2.8 上未定义

> ID：1024757
> 
> 赞同：4
> 
> 时间：2009-06-21T21:09:16.520
> 
> 标签：php, zip

我进行了一些搜索，但未能找到充足的解决方案。

规格为：OS X 10.5 和 Apache/2.2.11 (Unix) mod_ssl/2.2.11 OpenSSL/0.9.7l DAV/2 PHP/5.2.8

错误：致命错误：在第 18 行的 /includes/admin_functions.php 中调用未定义函数 zip_open()

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-21T21:22:11.770

检查你的 phpinfo();

该功能未定义的唯一原因是扩展程序未正确安装。确保它在您运行 phpinfo() 页面时出现。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-09-06T17:29:31.723

您的 zip 模块配置不正确或丢失

```
sudo apt-get install php7.0-zip 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T21:11:38.280

您是否安装了[ZIP 模块](http://us2.php.net/manual/en/book.zip.php)？

# c# - 为什么网页不显示？我的代码中缺少什么？

> ID：1024759
> 
> 赞同：0
> 
> 时间：2009-06-21T21:10:00.700
> 
> 标签：c#, browser, navigateurl

我正在尝试用 C# 制作自己的网络浏览器，我的 wpf 应用程序似乎是正确的。但它仍然缺少一些东西。网页没有出现。:s 有人有想法吗？

这是我在 C# 中的代码：

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
    }

    private void textBox1_TextChanged(object sender, TextChangedEventArgs e)
    {
    }

    private void button1_Click(object sender, RoutedEventArgs e)
    {
        WebBrowser web = new WebBrowser();
        web.NavigateToString (textBox1.Text);
    } 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T21:15:43.200

据我了解，您是在代码中实例化一个新`WebBrowser`控件，而不是将其作为控件添加到实际表单中。您最好在设计视图中添加控件，然后在代码中进行方法调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T21:30:52.407

创建 WebBrowser 时，尝试添加第三行：

```
WebBrowser web = new WebBrowser();
Content = web; // extra line
web.NavigateToString (textBox1.Text); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-12T00:11:13.320

如果文本框是您的地址栏，它将不起作用。NavigateToString 会将文本框中的内容解释为文字 HTML。

```
web.NavigateToString (textBox1.Text); 
```

应该

```
web.Source = new Uri(textBox1.Text, UriKind.Absolute); 
```

# wpf - 使用属性触发器更改已绑定的属性

> ID：1024760
> 
> 赞同：4
> 
> 时间：2009-06-21T21:10:43.337
> 
> 标签：wpf, data-binding, triggers

如何在样式（或其他方法）中使用属性触发器来更改已经具有由绑定定义的值的属性（例如工具提示）？

我有一个像这样的简单按钮：

```
<Button Name="Button1" Style="{StaticResource ButtonStyle}" 
        ToolTip="{Binding Name}" >My Button</Button> 
```

它在工具提示上有一个绑定，以显示设置为 DataContext 的类的 Name 属性。

我的问题是我想在启用按钮时显示名称，但在禁用按钮时显示其他内容。我想我可以用这样的风格和触发器来解决我的问题：

```
<Style TargetType="Button" x:Key="ButtonStyle">
    <Setter Property="ToolTipService.ShowOnDisabled" Value="True" />
    <Style.Triggers>
        <Trigger Property="IsEnabled" Value="false">
            <Setter Property="ToolTip" Value="Disabled" />
        </Trigger>
    </Style.Triggers>
</Style> 
```

但这不起作用。如果我从按钮中删除了工具提示绑定，那么当按钮被禁用时，我会得到正确的工具提示。但似乎我不能在同一个属性上同时拥有绑定和触发器。

我可以通过添加另一个触发器来解决它，如下所示：

```
<Trigger Property="IsEnabled" Value="true">
    <Setter Property="ToolTip" Value="{Binding Name}" />
</Trigger> 
```

但我想为 4 或 5 个按钮使用该样式，这些按钮对启用的 ToolTip 都有不同的绑定，但在禁用时使用相同的（固定）工具提示。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T02:29:13.163

解决问题的最简单方法是创建所有按钮都可以使用的按钮样式（以下示例中的 _DisabledButtonToolTipStyle），然后为每个应用启用的工具提示值的按钮定义唯一样式。如果各个按钮总是有不同的工具提示值，那么我建议简单地嵌入如下样式；但是，如果您想重用启用的工具提示样式，您可以轻松地在资源中定义它并给它一个键。

```
<Window.Resources>
    <Style x:Key="_DisabledButtonToolTipStyle" TargetType="Button">
        <Setter Property="ToolTipService.ShowOnDisabled" Value="True" />
        <Style.Triggers>
            <Trigger Property="IsEnabled" Value="false">
                <Setter Property="ToolTip" Value="Disabled" />
            </Trigger>
        </Style.Triggers>
    </Style>
</Window.Resources>

<Grid>
    <Button Name="Button1" Content="My Button">
        <Button.Style>
            <Style TargetType="Button" BasedOn="{StaticResource _DisabledButtonToolTipStyle}">
                <Setter Property="ToolTip" Value="{Binding Name}" />
            </Style>
        </Button.Style>
    </Button>
</Grid> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T08:24:45.820

您的问题与绑定无关，问题是您直接在元素上设置的属性会覆盖样式中设置的属性，例如：

鉴于风格

```
<Style TargetType="Button">
    <Setter Property="Background" Value="Blue"/>
</Style> 
```

还有这两个按钮：

```
<Button Content="1st"/>
<Button Content="2nd" Background="Red"/> 
```

第一个按钮将从样式中获取其背景，但第二个按钮会覆盖样式背景。

您可以使用触发器而不是使用样式来获得所需的内容，您可以使用这样的 DataTemplate（TextBox 和 CheckBox 用于测试）：

```
<ContentPresenter Content="{Binding}">
    <ContentPresenter.ContentTemplate>
        <DataTemplate>
            <StackPanel>
                <TextBox Name="edt" Text="Tooltip text"/>
                <Button Name="btn" Content="x" 
                    ToolTip="{Binding ElementName=edt, Path=Text}" 
                    ToolTipService.ShowOnDisabled="True"/>
                <CheckBox Content="Enabled" 
                    IsChecked="{Binding ElementName=btn, Path=IsEnabled}"/>
            </StackPanel>
            <DataTemplate.Triggers>
                <Trigger SourceName="btn" Property="IsEnabled" Value="False">
                    <Setter TargetName="btn" Property="ToolTip" Value="Disabled"/>
                </Trigger>
            </DataTemplate.Triggers>
        </DataTemplate>
    </ContentPresenter.ContentTemplate>
</ContentPresenter> 
```

# visual-studio-2008 - Visual Studio 2008 资源编辑器对 PNG 很烦

> ID：1024761
> 
> 赞同：2
> 
> 时间：2009-06-21T21:11:28.827
> 
> 标签：visual-studio-2008, png, resource-file

我在 VS2008 中有一个资源 DLL 项目，其中主要包含 PNG 图像。每次我将新图像导入资源文件时，我都会收到 RC2170 错误：对于以前在资源文件中的每个 PNG，位图文件不是 3.0 格式。

问题是，在我添加新图像之前，所有这些图像都已符合要求。只有在我从资源文件中删除所有这些图像并再次导入它们（未更改）之后，它才会编译。

对于添加的每个新 PNG 文件，这种行为都会重复，并且随着 PNG 文件数量的增加，它变得越来越烦人。

有人经历过类似的事情吗？有什么解决办法吗？

顺便说一句：如果可以解决这个问题，我实际上并不需要资源编辑器将 PNG 文件识别为图像。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-18T08:29:20.853

根据[这个线程](http://social.msdn.microsoft.com/Forums/en-US/vcgeneral/thread/6e881691-a5c2-46ea-b37b-93d506f18231)，您在资源编辑器中遇到了一个错误，该错误发生了变化：

`IDI_DENTIFIER PNG "background.png"`
至：
`IDI_DENTIFIER BITMAP "background.png"`

但请注意：这些 PNG 资源在通过`LoadImage()`. 使用此资源类型可能会将您的应用程序限制为 Vista。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T21:32:21.280

资源编辑器不直接支持 PNG 图片。您必须将它们添加为二进制文件，如下所示：

```
IDI_BACKGROUND  RCDATA    "background.png" 
```

然后你可以使用 GDI+ 从你的资源文件中加载它们。这在[本文](http://www.codeproject.com/KB/GDI-plus/cgdiplusbitmap.aspx)中进行了解释（C++）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-16T14:22:47.457

我为此苦苦挣扎，但发现（至少在 Visual Studio 2012 中）您可以轻松地将 png 文件添加为资源。在资源视图中，右键单击 .rc 文件名并选择“添加资源”。选择类型“位图”并单击“导入”。选择所需的 .png 文件。应将一个名为“PNG”的新部分添加到您的资源列表中，它应该像 BITMAP 资源一样工作。

我有时会看到这种情况失败 - 如果是这样，请使用 .bmp 扩展名保存您的 png 文件的副本（或将其保存为位图），然后将其添加为上述位图。编辑资源文件，你会看到这样的一行：

> IDB_NEWFILE BITMAP "NewFile.bmp"

将其更改为

> IDB_NEWFILE PNG“新文件.png”

并保存文件。下次您查看项目的资源时，应该已经创建了一个“PNG”部分（即使带有注释标题！）

但是，据我所知，具有透明度的 png 文件要么无法正确显示，要么在加载时会导致崩溃（例如，加载到按钮中）。

# c# - 覆盖我的控制器，我应该在哪个事件中检查 cookie？

> ID：1024766
> 
> 赞同：1
> 
> 时间：2009-06-21T21:12:40.867
> 
> 标签：c#, asp.net-mvc, controller

在我的 .net mvc 应用程序中，我重写了 Controller 类并创建了我自己的类，我将为我的所有控制器继承它。

我应该在哪个事件中检查 cookie？

OnActionExecuting 有意义吗？

我尝试了 OnActionExecuting，但似乎找不到 cookie 集合？

```
HttpCookie myCookie = ???????????? 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T21:18:38.717

是的，您可以在 OnActionExecuting() 中检查 cookie。这很容易：

```
protected override void OnActionExecuting(ActionExecutingContext filterContext)
{
    HttpCookieCollection cookies = Request.Cookies;

    // Check your cookies:

    bool yourCookieExistsInRequest = cookies["YourCookie"] != null;

    HttpCookie yourCookie = cookies["YourCookie"];

    base.OnActionExecuting(filterContext);
} 
```

# c# - Mono C# 教程？

> ID：1024770
> 
> 赞同：7
> 
> 时间：2009-06-21T21:14:02.190
> 
> 标签：c#, sqlite, mono

有没有什么好的教程可以用单声道学习 C#？到目前为止，谷歌并没有提供帮助，因为大多数教程都是针对 Visual Studio 的。

我是一名 Java 开发人员，所以我熟悉面向对象的思想。

我的目标是能够开发一个带有 SQLite 后端的小型便携式应用程序。

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-21T21:27:30.680

无论您使用什么教程，语言本身都将是相同的。实际上，您只需要知道如何使用 Mono 而不是 Visual Studio 编译代码。您要使用的基本命令行是：

```
gmcs Foo.cs Bar.cs 
```

将这些作为最重要的命令行选项：

*   `-target`- 是否要构建控制台应用程序 ( `-target:exe`)、Windows 窗体应用程序 ( `winexe`)、类库 ( `library`) 或模块 ( `module`)
*   `-r`- 添加对另一个程序集的引用（例如`-r:Foo.dll`） - 大多数常见程序集应该自动添加
*   `-out`- 指定输出文件名（例如 -out:Foo.exe）
*   `/?`- 了解其他命令行选项 :)

在阅读材料方面，我可以推荐[C# 3.0 in a Nutshell](https://rads.stackoverflow.com/amzn/click/com/0596527578)，因为它涵盖了语言和核心框架类。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-21T21:24:11.313

任何 C# 教程都可以用于学习语言本身。之后我会推荐[Mono 手册](http://www.mono-project.com/Monkeyguide)来学习如何使用 Mono 运行时。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-21T21:26:00.857

你用的是什么IDE？[单开发](http://monodevelop.com/Documentation/Creating_A_Simple_Solution)？[夏普开发](http://sharptutorials.com/sharpdevelop.aspx)？（链接指向教程）如果您使用的是核心功能，您甚至可以使用 Visual C# Express 并使用单独的单声道构建步骤。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-23T22:40:24.467

您可能想查看[此](http://www.mono-project.com/SQLite)Mono Wiki 页面的示例。它显示了基本的 SQLite 集成。使用 Mono（和 MonoDevelop）进行 C# 开发与使用 VS 几乎相同。唯一显着的区别是缺少 Windows 窗体 UI 的可视化设计器。相反，如果您使用[Gtk#](http://www.mono-project.com/GtkSharp) UI 可能会更好，它可以在 MonoDevelop 中直观地创建。

# c - 动态多维数组

> ID：1024772
> 
> 赞同：0
> 
> 时间：2009-06-21T21:14:30.833
> 
> 标签：c, arrays, pointers, multidimensional-array

我需要一个仅在一个维度上是动态的字符的多维数组...
我必须存储一对字符串，每个字符串的长度为 10 个（或更少）字符，但“对”的数量是可变的。

我的想法是这样的

```
char (*instrucao)[2][10]; 
```

这给了我一个指向 2x10 字符数组的指针，但是当我做这样的事情时它不能正常工作：

```
char strInstrucoes[117], *conjunto = calloc(21, sizeof(char));
instrucao = calloc(1, sizeof(char[2][10]));
conjunto = strtok(strInstrucoes,"() ");
for(i = 0; conjunto != NULL; i++){
    realloc(instrucao, i+1*sizeof(char[2][10]));
    sscanf(conjunto,"%[^,],%s", instrucao[i][0], instrucao[i][1]);
    printf("%s | %s\n", instrucao[i][0], instrucao[i][1]);
    conjunto = strtok(NULL, "() ");
} 
```

拥有`strInstrucoes`as `(abc,123) (def,456) (ghi,789)`，我不会像这样使用 3 行每行 2 对矩阵：

```
abc | 123
def | 456
ghi | 789 
```

但相反，这就是我得到的：

```
abc | 123
def | 45def | 45de
ghi | 789 
```

这样做的正确方法是什么？谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-21T21:28:46.513

您应该分配新地址`realloc`返回的指针

```
instrucao = realloc(instrucao, (i+1)*sizeof(char[2][10])); 
```

请注意，对于错误检查，您可能希望分配一个新指针并检查`NULL`. 还要注意括号 - 你基本上只是添加`i`而不是乘以所需的大小。轻松监督。

请注意，不需要初始`calloc`. 只需初始化`instrucao`为`NULL`， realloc 的行为就像`malloc`第一次传递空指针时一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:20:41.333

您最好找到一个带有满足您需求的容器的库。在最糟糕的情况下，不使用任何更好的库，您可能会拥有两个独立的数组，每个数组都持有该数组的一半。

# wpf - WPF 应用程序中的 Windows 7 任务栏 SetOverlayIcon 不起作用

> ID：1024786
> 
> 赞同：0
> 
> 时间：2009-06-21T21:20:56.483
> 
> 标签：wpf

我正在尝试使用 Windows 7 任务栏 API 在任务栏上设置应用程序图标的覆盖图标。

我从 Microsoft 下载了示例，但想提取执行该操作的特定代码片段，以避免添加对我不会使用的大部分代码的引用。

我在 Win 7 x64 上的 VS 2010 中有一个简单的 WPF 应用程序。

我的 Window1.xaml 的代码隐藏是这样的：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Runtime.InteropServices;
using System.Drawing;
using System.Windows.Interop;

namespace WpfApplication1
{
/// <summary>
/// Interaction logic for Window1.xaml
/// </summary>
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
    }

    private static ITaskbarList3 _taskbarList;
    internal static ITaskbarList3 TaskbarList
    {
        get
        {
            if (_taskbarList == null)
            {
                if (_taskbarList == null)
                {
                    _taskbarList = (ITaskbarList3)new CTaskbarList();
                    _taskbarList.HrInit();
                }
            }
            return _taskbarList;
        }
    }

    private void Button_Click(object sender, RoutedEventArgs e)
    {
        TaskbarList.SetOverlayIcon(new WindowInteropHelper(Application.Current.MainWindow).Handle, SystemIcons.Question.Handle, "Test");
    }
}

[ComImportAttribute()]
[GuidAttribute("ea1afb91-9e28-4b86-90e9-9e9f8a5eefaf")]
[InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)]
internal interface ITaskbarList3
{
    // ITaskbarList
    [PreserveSig]
    void HrInit();
    [PreserveSig]
    void AddTab(IntPtr hwnd);
    [PreserveSig]
    void DeleteTab(IntPtr hwnd);
    [PreserveSig]
    void ActivateTab(IntPtr hwnd);
    [PreserveSig]
    void SetActiveAlt(IntPtr hwnd);

    void SetOverlayIcon(
        IntPtr hwnd,
        IntPtr hIcon,
        [MarshalAs(UnmanagedType.LPWStr)] string pszDescription);
}

[GuidAttribute("56FDF344-FD6D-11d0-958A-006097C9A090")]
[ClassInterfaceAttribute(ClassInterfaceType.None)]
[ComImportAttribute()]
internal class CTaskbarList { }
  } 
```

当我单击按钮时，什么也没有发生。没有错误。图标不变。

我想知道我是否将正确的句柄传递给 SetOverlayIcon 方法。

有人知道怎么修这个东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T23:07:17.140

您的 ITaskBarList3 接口是错误的。这里是正确的：

```
public enum TBPF
{
    TBPF_NOPROGRESS = 0,
    TBPF_INDETERMINATE = 0x1,
    TBPF_NORMAL = 0x2,
    TBPF_ERROR = 0x4,
    TBPF_PAUSED = 0x8
}

public enum TBATF
{
    TBATF_USEMDITHUMBNAIL = 0x1,
    TBATF_USEMDILIVEPREVIEW = 0x2
}

public enum THB : uint
{
    THB_BITMAP = 0x1,
    THB_ICON = 0x2,
    THB_TOOLTIP = 0x4,
    THB_FLAGS = 0x8
}

public enum THBF : uint
{
    THBF_ENABLED = 0,
    THBF_DISABLED = 0x1,
    THBF_DISMISSONCLICK = 0x2,
    THBF_NOBACKGROUND = 0x4,
    THBF_HIDDEN = 0x8
}

[StructLayout(LayoutKind.Sequential, Pack = 4, CharSet = CharSet.Auto)]
public struct THUMBBUTTON
{
    public THB dwMask;
    public uint iId;
    public uint iBitmap;
    public IntPtr hIcon;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = Windows.MAX_PATH)]
    public string szTip;
    public THBF dwFlags;
}

[ComImport]
[Guid("ea1afb91-9e28-4b86-90e9-9e9f8a5eefaf")]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
public interface ITaskbarList3
{
    // ITaskbarList
    void HrInit();
    void AddTab(IntPtr hwnd);
    void DeleteTab(IntPtr hwnd);
    void ActivateTab(IntPtr hwnd);
    void SetActiveAlt(IntPtr hwnd);

    // ITaskbarList2
    void MarkFullscreenWindow(
        IntPtr hwnd,
        [MarshalAs(UnmanagedType.Bool)] bool fFullscreen);

    // ITaskbarList3
    void SetProgressValue(IntPtr hwnd, ulong ullCompleted, ulong ullTotal);
    void SetProgressState(IntPtr hwnd, TBPF tbpFlags);
    void RegisterTab(IntPtr hwndTab, IntPtr hwndMDI);
    void UnregisterTab(IntPtr hwndTab);
    void SetTabOrder(IntPtr hwndTab, IntPtr hwndInsertBefore);
    void SetTabActive(IntPtr hwndTab, IntPtr hwndMDI, TBATF tbatFlags);

    void ThumbBarAddButtons(
        IntPtr hwnd,
        uint cButtons,
        [MarshalAs(UnmanagedType.LPArray)] THUMBBUTTON[] pButtons);

    void ThumbBarUpdateButtons(
        IntPtr hwnd,
        uint cButtons,
        [MarshalAs(UnmanagedType.LPArray)] THUMBBUTTON[] pButtons);

    void ThumbBarSetImageList(IntPtr hwnd, IntPtr himl);

    void SetOverlayIcon(
        IntPtr hwnd,
        IntPtr hIcon,
        [MarshalAs(UnmanagedType.LPWStr)] string pszDescription);

    void SetThumbnailTooltip(
        IntPtr hwnd,
        [MarshalAs(UnmanagedType.LPWStr)] string pszTip);

    void SetThumbnailClip(
        IntPtr hwnd,
        [MarshalAs(UnmanagedType.LPStruct)] Rectangle prcClip);
} 
```

# windows - 如何在循环中从 .bat 运行 *.exe /key

> ID：1024787
> 
> 赞同：2
> 
> 时间：2009-06-21T21:21:47.463
> 
> 标签：windows, batch-file

我有目录结构：

```
DIR
|-UNINSTALL.BAT
|-component_name
  |-source
  |-setup.exe
  |-uninst.bat
|-another_component_name
  |-source
  |-setup.exe
  |-uninst.bat
|-yet_another_component_name
  |-source
  |-setup.exe
  |-uninst.bat 
```

等等...

在像“component_name”这样的每个目录中，我都有`setup.exe`将当前组件安装到 Delphi 中的调色板组件的文件。 `uninst.bat`仅包含此字符串：

`"setup.exe" /uninstall`

所以我需要写`UNINSTALL_ALL.bat`在`DIR`所有组件目录中运行 uninst.bat 。

先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T21:36:15.623

你可以用这条线来做：

```
 for /f %%a in ('dir /b /s uninst.bat') do call %%a 
```

请注意，批处理文件需要“%%”。如果您在命令行上对此进行测试，请仅使用一个 '%'

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T21:33:14.443

这在批处理文件中有点尴尬。尽管您可能可以通过`foreach`声明来做到这一点。我建议你看看*Powershell*，如果你想要的话，它肯定会让你有能力简单地做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T21:37:14.903

您想使用“for”构造。像这样的东西：

```
for %%i in (component_name another_component_name yet_another_component_name) do %%i\uninst.bat 
```

如果将“for”循环放在批处理文件中，则需要双重转义 (%%)。如果您只是在命令提示符下键入它，请仅使用 1 %。

此外，如果目录名称遵循某种约定，您也可以使用通配符来匹配目录名称。打开命令提示符并运行“for /?” 查看它可以做的一切......我相信有一个 /d 选项可以匹配目录。这看起来像：

```
for /D %%d in (component_*) do %%d\uninst.bat 
```

（显然，调整通配符以匹配您的组件目录。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-26T07:49:34.180

This should work:

```
FOR /F %%a IN ('dir /b /s uninst.bat') DO START /B %%a 
```

if you want them to wait each other, use this:

```
FOR /F %%a IN ('dir /b /s uninst.bat') DO START /B /WAIT %%a 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-20T15:58:23.943

按照您描述问题的方式，您只有一级子目录，并且您始终从根目录调用相同的批次。所以：

卸载_all.cmd

```
@echo off
for /F "delims=" %%d in ('dir /b /ad') do cd "%%d"& start /b /w ..\uninstall.bat& cd .. 
```

应该做的伎俩。

# sql - 构建基于自动化脚本的备份/维护解决方案

> ID：1024797
> 
> 赞同：2
> 
> 时间：2009-06-21T21:26:06.767
> 
> 标签：sql, sql-server

我公司目前有以下设置：

127 个 SQL 服务器（2000 和 2005）和 700 多个数据库。我们正在整合服务器，并计划设置主服务器/目标服务器以实现集中管理。作为这个项目的一部分，我被赋予了创建基于脚本的自动备份/维护解决方案的责任。

多亏了 Ola Hallengren 的脚本[，](http://blog.ola.hallengren.com/blog/_archives/2008/1/1/3440068.html)我已经取得了很大的进步。

这是我的计划：

*   我在主服务器中有一个数据库，其中包含 SQL 实例、数据库和备份路径详细信息的详细信息。
*   我正在修改 Hallengren 的脚本以从该数据库中读取并动态创建作业。
*   允许用户定义他们想要的备份类型、备份的频率和需要保留多长时间。
*   我也在寻找分散工作的能力，这样我就不会同时运行太多的工作。
*   我的想法是创建具有需要作为参数传递给 sp_add_job、sp_add_jobstep 和 sp_add_jobschedule 的数据的表。

请分享您在此设置中遇到的陷阱和障碍的经验。欢迎所有想法。

谢谢，

拉吉

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-23T21:25:00.017

移至 2005 年，我们对集成服务维护计划不满意

我们编写 sp 来执行完整和 Tran 备份以及重新索引、arrgegate 管理、归档等

每日和每小时的工作将通过 master..sysdatabases 并在 try catch 块中应用必要的维护。从任何表中读取并检查用户定义的条件都不难。

不幸的是，没有办法将输出绑定到 msdb..sysjobhistry，所以我们登录到中央表。好处是我们可以更好地控制记录的内容。然而，这比阅读 700 个工作更容易阅读。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T21:22:30.660

您还可以考虑在每台服务器上创建完整备份作业和事务日志备份作业的方法，它们从主数据库中检索数据库并将它们提供给备份过程。您可以每 5 分钟运行一次作业，并且该过程必须确定现在是什么时间以及需要什么类型的备份。

我这么说是因为以自动化方式创造大量工作可能会变得一团糟——但也许你做得很好。如果您采用原始方法，请务必使用作业名称创建“主键”。

如果您在数据库中保留记录并找到可用的窗口来放置新工作，那么展开工作应该很容易。我已经看到了这方面的脚本。

您也可以在从您的管理服务器运行的 SSIS 包中执行此操作。它将遍历数据库并连接到服务器以执行备份。

在此处查看前 3 篇文章： [http ://www.sqlmag.com/Authors/AuthorID/1089/1089.html](http://www.sqlmag.com/Authors/AuthorID/1089/1089.html)

# android - 暂停时杀死android应用程序

> ID：1024803
> 
> 赞同：12
> 
> 时间：2009-06-21T21:28:55.703
> 
> 标签：android, android-1.5-cupcake

我有一个应用程序，我希望在暂停时完全禁用/关闭它（IE。当用户按下主页、结束（呼叫）和返回按钮时，我希望关闭应用程序，而不是保存在历史堆栈）。

我该怎么做呢....？

谢谢。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-21T23:04:30.423

在您的活动中实施`onPause()`并调用`finish()`您的活动。但请记住，这将在每次暂停时发生，包括对话、来电、用户激活`Notification`. 您可能要考虑做`finish()`in `onStop()`，这至少可以解决对话问题。

另外，请记住，用户在使用您的应用程序时可能会感到困惑，认为它已经崩溃，因为当他们试图恢复它时它已经消失了。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-08-09T15:46:58.763

您可以通过在清单中将“noHistory”属性设置为您的活动元素来轻松做到这一点

[http://developer.android.com/guide/topics/manifest/activity-element.html#nohist](http://developer.android.com/guide/topics/manifest/activity-element.html#nohist)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-31T21:01:03.643

您知道如何在您的活动中拥有一个 OnCreate() 方法，该方法在您开始时执行操作。您需要添加以下内容：

```
@Override

protected void onPause(){
finish();

        super.onPause();

} 
```

在您的活动开始之前添加操作

在这种情况下

```
finish(); 
```

command 是您要在活动暂停之前执行的操作。

# artificial-intelligence - 我在哪里可以合法地操作 PokerBot（和其他游戏）？

> ID：1024804
> 
> 赞同：1
> 
> 时间：2009-06-21T21:29:57.900
> 
> 标签：artificial-intelligence, bots, poker

我想为智力挑战构建一个 PokerBot（和其他一些游戏）。但是，我只想以合乎道德和合法的方式做到这一点。

所以，我需要一个游戏服务器，所有玩家和游戏运营商都知道我正在运行一个扑克机器人。这不是作弊，而是常态。也许即使是人类违反规则的地方。

（我还想为其他游戏构建 PlayerBots，而不仅仅是扑克。）

如果尚不存在，是否有人愿意开展合作项目来构建这样的环境？

更新：我想说开放 API 是服务器对机器人开放的最终标志。没有 API = 不欢迎机器人。

此外，我很乐意为积分而不是真钱玩游戏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T22:03:57.737

你可以查看[Coding the Wheel](http://www.codingthewheel.com/)系列[How I Built a Working Poker Bot](http://www.codingthewheel.com/archives/how-i-built-a-working-poker-bot)看看他是否提到了任何不反对机器人的网站，但我很确定任何让你玩钱的网站都会禁止你运行机器人。

如果您只是想获得学习体验或挑战，请尝试使用[Yahoo!等免费游戏网站之一。](http://games.yahoo.com/all-games)查看机器人是否违反其服务条款的[游戏。](http://games.yahoo.com/all-games)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T22:21:13.600

[扑克学院](http://www.poker-academy.com/)有一个机器人 API，他们为机器人运行在线服务。虽然是商业软件。

# java - 无法使用通配符调用泛型方法

> ID：1024820
> 
> 赞同：3
> 
> 时间：2009-06-21T21:37:56.480
> 
> 标签：java, generics

我有一个这样定义的类：

```
public class Test {
    static <T> List<Class<T>> filter(List<Class<T>> input) {
        // code here
    }

    public static void main(String[] args) {
        List<Class<? extends Throwable>> list =
            new ArrayList<Class<? extends Throwable>>();
        filter(list);
    }
} 
```

`filter`方法调用给出以下`main`编译错误：

```
The method filter(List<Class<T>>) in the type Test is not applicable for the
arguments (List<Class<? extends Throwable>>) 
```

我不明白为什么`<T>`不绑定到`<? extends Throwable>`. 有没有仿制药大师可以帮助我？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T21:43:28.497

啊，通用签名的乐趣。

您可以通过将参数声明为：

```
static <T> List<Class<T>> filter(List<Class<? extends T>> input) {
    // code here
} 
```

至于具体原因，我不确定。通过尝试各种方法来解决泛型的太多编译问题，直到红线消失。不满意。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T22:40:10.987

我相信这里的问题是没有类型`?`可以做到这一点。

考虑一下，为了简单起见，我们是否替换`Class`为`AtomicReference`.

```
static <T> void filter(List<AtomicReference<T>> input) {
    T value = input.get(0).get();
    input.get(1).set(value);
} 
```

如果`input`由 an`AtomicReference<Integer>`和 an组成，`AtomicReference<String>`我们就有麻烦了。

在存在多态性的情况下指向指针的潜在问题很困难。没有泛型，我们只能挥手。对于泛型，我们需要真正有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-26T16:28:46.940

你也可以写 main 如下：

```
public static void main(String[] args) {
    List<Class<Throwable>> list =
        new ArrayList<Class<Throwable>>();
    filter(list);
} 
```

# ruby-on-rails - 我什么时候想使用 Ruby On Rails 子模块？

> ID：1024823
> 
> 赞同：2
> 
> 时间：2009-06-21T21:42:00.200
> 
> 标签：ruby-on-rails, capistrano

我喜欢使用子模块的想法，但我担心我会把我的代码留在别人的手中。主要问题是每次我使用 capistrano 部署时，都会签出一个新的子模块副本，因为我正在使用：

```
set :git_enable_submodules, 1 
```

那么如果有人提交了损坏的代码会发生什么？然后我在部署时应用中断。

除非您控制存储库，否则子模块通常是一个坏主意吗？

如果是这样，通常的做法是在本地存储库和 SCM 下保留每个插件的副本吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T21:57:04.943

**是**的，您应该保留所有可能在没有警告的情况下更新的本地副本（例如 git 子模块或 svn 外部）。在生产部署方面不要冒险！

[有些](http://errtheblog.com/posts/50-vendor-everything)人甚至认为您应该将 Rails 和所有纯 Ruby gem 冻结到`vendor`目录中，以便它们仅在您需要时更新。您不必在部署到的每台服务器上安装所有依赖项。不过，现在 Rails 可以通过简单的 rake 任务轻松安装所有必需的 gem，这有点不重要了（`rake gems:install`）。

# c# - D3DERR_INVALIDCALL 错误，TeamCity 构建器

> ID：1024832
> 
> 赞同：5
> 
> 时间：2009-06-21T21:50:23.583
> 
> 标签：c#, xna, teamcity

我一直在尝试使用 TeamCity 4.5 来自动构建 XNA 项目，但我遇到了一个小问题。我的项目在 Visual Studio 2008 下正确编译，但在使用 TeamCity 作为构建器编译时无法正确编译。配置文件使用 sln2008 设置，并且编译了一段时间，但是一旦将 .png 纹理编译为 .xnb，我就会收到以下错误：

```
[11:28:41]: [Project "Content.contentproj" (default targets):] Content\head.png Building content threw InvalidOperationException: D3DERR_INVALIDCALL
at Microsoft.Xna.Framework.Content.Pipeline.CommonHelperFunctions.InitD3D()
at Microsoft.Xna.Framework.Content.Pipeline.TextureImporter.InitD3D()
at Microsoft.Xna.Framework.Content.Pipeline.TextureImporter.Import(String filename, ContentImporterContext context)
at Microsoft.Xna.Framework.Content.Pipeline.ContentImporter`1.Microsoft.Xna.Framework.Content.Pipeline.IContentImporter.Import(String filename, ContentImporterContext context)
at Microsoft.Xna.Framework.Content.Pipeline.BuildCoordinator.ImportAssetDirectly(BuildItem item, String importerName)
at Microsoft.Xna.Framework.Content.Pipeline.BuildCoordinator.ImportAsset(BuildItem item)
at Microsoft.Xna.Framework.Content.Pipeline.BuildCoordinator.BuildAssetWorker(BuildItem item)
at Microsoft.Xna.Framework.Content.Pipeline.BuildCoordinator.BuildAsset(BuildItem item)
at Microsoft.Xna.Framework.Content.Pipeline.BuildCoordinator.RunTheBuild()
at Microsoft.Xna.Framework.Content.Pipeline.Tasks.BuildContent.RemoteProxy.RunTheBuild(BuildCoordinatorSettings settings, TimestampCache timestampCache, ITaskItem[] sourceAssets, String[]& outputContent, String[]& rebuiltContent, String[]& intermediates, Dictionary`2& dependencyTimestamps, KeyValuePair`2[]& warnings)
Inner exception: COMException: Exception from HRESULT: 0x8876086C 
```

我不知道是什么原因造成的。就像我说的，它能够正确编译 .fbx 模型以及我的 ContentPipeline 项目和 SharedContent 项目（解决方案的一部分）。

我真正想要的是一些指向问题根源的指针（如果可能的话，是问题的解决方案）。据我了解，D3D 库似乎存在问题。我还要提醒您，整个解决方案是在 Visual Studio 2008 下编译的，因此 TeamCity 存在一个小问题，要么我没有提供任何东西，要么实际上设置不正确。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-24T12:15:08.837

我没有解决方案，但我一直在考虑。

错误是 D3DERR_INVALIDCALL 所以我认为由于某种原因该设备当时不可用。

1) 运行构建的机器是否安装了 DirectX/显卡？我假设是的，因为 XNA 需要带有着色器的卡，但 TeamCity 是一个构建发行版，所以它可能在没有它的机器上运行？

2) 也许 TeamCity 导致在同一台机器/进程上创建太多 Direct3D 设备（完全猜测）？

正确编译的模型文件是使用纹理还是只是几何数据？我有一种感觉，内容构建器不需要访问 DirectX 来构建模型，但需要访问纹理数据。你能构建其他需要访问 Direct3D 的东西吗？您可以使用 TeamCity 构建一个在其内容文件夹中只有一个纹理的项目吗？

我不确定这是否可行，但您能否通过在调试模式下运行 DirectX 并查看输出来获得更多信息？

希望这会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-25T20:53:47.530

几乎可以肯定的是，Team City 正在以非交互模式作为本地系统运行其构建过程，而不是作为实际有权访问和获取图形设备的用户。我知道我什至尝试通过远程桌面界面批处理纹理时遇到了问题，因为 DirectX 无法抓取图形设备。

解决方案可能是查看 Team City 是否让您能够请求它的构建器作为登录用户运行，而不是作为本地系统或作为服务运行，尽管我不能告诉你这在 Team City 中实际上是可能的.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-13T06:32:40.337

XNA 和 DirectX 9 需要当前登录用户才能编译 Content 文件夹。

解决方法很简单，用XNA（VS2008，XNA Game Studio 3.0等）的pre-reqs设置一个构建代理机器（真实物理机器）并让它在启动时登录，然后创建一个脚本来运行团队服务器登录时的代理（通过在开始菜单的启动文件夹中放置代理运行脚本的快捷方式）。

这样，代理将以本地用户身份运行，并且可以正常构建。

我已经这样做了，并且可以确认它有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-07T11:49:01.683

很抱歉拖了一个旧线程，但我刚刚遇到了完全相同的问题，试图让 TC 在 Windows Server 上构建我的 XNA 项目，并希望帮助其他遇到同样问题的人。

我刚刚发现这篇文章和博客看起来像是一个非常有前途的解决方案： [http ://forums.create.msdn.com/forums/p/86699/532976.aspx](http://forums.create.msdn.com/forums/p/86699/532976.aspx)

&

[http://blogs.msdn.com/b/astebner/archive/2011/07/07/10184338.aspx](http://blogs.msdn.com/b/astebner/archive/2011/07/07/10184338.aspx)

Aaron 基本上说 Win Phone SDK 7.1 Beta 2 的新 beta 包含 XNA Game Studio 4.0 Refresh Beta 2，它现在允许您通过以下类型的配置通过内容管道构建内容：

如果您的屏幕在构建期间被锁定 如果您在无头计算机上运行构建 如果您从非交互式用户帐户运行构建

但看起来它只能在 Vista 或更高版本上运行——希望这也应该包括服务器。更新：不，遗憾的是它不会安装在我的 Windows Server 上 :(

# macos - Snow Leopard 上的 Macports 和 Rubygems 问题

> ID：1024833
> 
> 赞同：0
> 
> 时间：2009-06-21T21:51:36.780
> 
> 标签：macos, rubygems, macports

我已经在 Leopard 上安装了 Snow Leopard，并且已经安装了 macports 和 ruby​​gems。这是常规安装，而不是干净的“归档和擦除”安装。

事实证明，SL 具有 64 位版本的共享库，并且许多开发实用程序无法正常工作。例如，“port”命令抱怨不兼容的 tcl 库，或者 ruby​​ 无法加载 32 位包。

解决这些问题的最简单方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T21:54:37.087

我已经在谷歌上搜索了大约 4 天的答案，最后想出了一份关于修复 macports 和 ruby​​gems 的分步手册：

[http://oleganza.tumblr.com/post/127709563/snow-leopard-with-legacy-macports-and-rubygems](http://oleganza.tumblr.com/post/127709563/snow-leopard-with-legacy-macports-and-rubygems)

简而言之：为了正确使用 macports 和 ruby​​gems，您必须：

1.  从源安装trunk macports（或发布时使用1.8版本）

2.  为“gem install with 64bit architecture”添加别名

3.  重新安装所有端口（尚未自动化）

4.  重新安装所有 gem（100% 自动化）

这将花费您 10-20 分钟的个人时间和另外 20 分钟的机器时间来构建和安装东西。

我很高兴获得更多答案，以解决我们以后可能遇到的其他问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-28T19:25:56.417

由于强制 MacPorts 重新编译所有端口（以正确的顺序）真的很难，我只是这样做了：

```
mv /opt /opt.old 
```

然后安装 MacPorts 1.8，并从 /opt.old/local/etc/ 带回您需要的任何配置

否则，您将收到各种抱怨现有库架构的错误（例如“命令输出：ld：警告：在 /opt/local/lib/libz.dylib 中，文件不是必需的架构”）。

这不像“已安装端口卸载”那么干净，但对我来说工作得很快而且足够好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-18T20:59:56.770

Richard Dooling[在 Snow Leopard 上的 MacPorts](http://www.richarddooling.com/index.php/2009/09/12/macports-on-snow-leopard/)解释说，要修复升级到 Snow Leopard 后损坏的旧版 MacPorts，您应该下载并安装[新的兼容版本](http://www.macports.org/install.php)，然后简单地按照[迁移说明](http://trac.macports.org/wiki/Migration)进行操作- 这也说同样的话。

# windows - RSA 密钥存储权限

> ID：1024834
> 
> 赞同：0
> 
> 时间：2009-06-21T21:53:38.227
> 
> 标签：windows, file-permissions, rsacryptoserviceprovider

从昨天开始，我无法使用 sn.exe 或通过也使用 sn.exe 的 Visual Studio 生成强名称密钥。

尝试生成密钥文件时，将执行以下 cimmand

sn -k“密钥文件.snk”

sn.exe 然后响应

未能生成强名称密钥对 - 访问被拒绝。

在运行 Process Monitor 时重复此过程后，我现在知道 sn.exe 被拒绝访问的位置都位于以下目录中

\ProgramData\Microsoft\Crypto\RSA\MachineKeys

查询该文件夹的权限，发现Everyone 和Administrators 组没有权限，NETWORK SERVICE 帐户拥有完全控制权。

昨天，我安装了使用 NETWORK SERVICE 帐户的 SourceGear Fortress，但这是在问题发生之前对系统进行的唯一重大更改。

所有人和管理员对 RSA 密钥库没有权限是否正常？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-29T00:10:49.550

在为 MachineKeys 目录恢复我的用户帐户的读取和写入权限后，我再次能够生成密钥

# authentication - 什么是 spnego 令牌？

> ID：1024838
> 
> 赞同：2
> 
> 时间：2009-06-21T21:56:33.073
> 
> 标签：authentication

对不起，如果拼写完全错误。到底是什么？为什么它阻止我通过 Mozilla 进行身份验证？为什么有人会强迫我使用一个从命令行工具进行身份验证？它如何与 Silverlight 中实现的后端相关联？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-07T20:11:53.723

SPNEGO[简单且受保护的 GSSAPI 协商机制](http://en.wikipedia.org/wiki/SPNEGO)是一种 GSSAPI“伪机制”，用于协商多种可能的实际机制之一。

> SPNEGO 最明显的用途是在 Microsoft 的“HTTP Negotiate”身份验证扩展中。它首先在 Internet Explorer 5.01 和 IIS 5.0 中实现，并提供单点登录功能，后来以集成 Windows 身份验证的形式销售。可协商的子机制包括 NTLM 和 Kerberos，两者都用于 Active Directory。

# python - 如何在 Python 中向字典添加新键？

> ID：1024847
> 
> 赞同：3278
> 
> 时间：2009-06-21T22:07:39.587
> 
> 标签：python, dictionary, lookup

是否可以在创建 Python 字典后为其添加键？

好像没有`.add()`方法。

* * *

## 回答 #1

> 赞同：4156
> 
> 时间：2009-06-21T22:09:06.870

您通过为该键分配一个值来在字典上创建一个新的键/值对

```
d = {'key': 'value'}
print(d)  # {'key': 'value'}

d['mynewkey'] = 'mynewvalue'

print(d)  # {'key': 'value', 'mynewkey': 'mynewvalue'} 
```

如果键不存在，则添加并指向该值。如果存在，则覆盖它指向的当前值。

* * *

## 回答 #2

> 赞同：1204
> 
> 时间：2009-07-22T14:48:17.997

要同时添加多个键，请使用[`dict.update()`](https://docs.python.org/library/stdtypes.html#dict.update)：

```
>>> x = {1:2}
>>> print(x)
{1: 2}

>>> d = {3:4, 5:6, 7:8}
>>> x.update(d)
>>> print(x)
{1: 2, 3: 4, 5: 6, 7: 8} 
```

对于添加单个密钥，接受的答案具有较少的计算开销。

* * *

## 回答 #3

> 赞同：1186
> 
> 时间：2011-12-05T06:07:36.293

我想整合有关 Python 词典的信息：

## 创建一个空字典

```
data = {}
# OR
data = dict() 
```

## 创建具有初始值的字典

```
data = {'a': 1, 'b': 2, 'c': 3}
# OR
data = dict(a=1, b=2, c=3)
# OR
data = {k: v for k, v in (('a', 1), ('b',2), ('c',3))} 
```

## 插入/更新单个值

```
data['a'] = 1  # Updates if 'a' exists, else adds 'a'
# OR
data.update({'a': 1})
# OR
data.update(dict(a=1))
# OR
data.update(a=1) 
```

## 插入/更新多个值

```
data.update({'c':3,'d':4})  # Updates 'c' and adds 'd' 
```

### Python 3.9+：

*更新运算符* 现在`|=`适用于字典：

```
data |= {'c':3,'d':4} 
```

## 在不修改原件的情况下创建合并字典

```
data3 = {}
data3.update(data)  # Modifies data3, not data
data3.update(data2)  # Modifies data3, not data2 
```

### Python 3.5+：

这使用了一个称为*字典解包*的新功能。

```
data = {**data1, **data2, **data3} 
```

### Python 3.9+：

合并*运算符* `|`现在适用于字典：

```
data = data1 | {'c':3,'d':4} 
```

## 删除字典中的项目

```
del data[key]  # Removes specific element in a dictionary
data.pop(key)  # Removes the key & returns the value
data.clear()  # Clears entire dictionary 
```

## 检查一个键是否已经在字典中

```
key in data 
```

## 遍历字典中的对

```
for key in data: # Iterates just through the keys, ignoring the values
for key, value in d.items(): # Iterates through the pairs
for key in d.keys(): # Iterates just through key, ignoring the values
for value in d.values(): # Iterates just through value, ignoring the keys 
```

## 从两个列表创建字典

```
data = dict(zip(list_with_keys, list_with_values)) 
```

* * *

## 回答 #4

> 赞同：167
> 
> 时间：2014-11-29T23:57:59.250

> # “是否可以在创建 Python 字典后为其添加键？它似乎没有 .add() 方法。”

是的，这是可能的，并且它确实有一个实现这一点的方法，但你不想直接使用它。

为了演示如何以及如何不使用它，让我们用 dict 文字创建一个空 dict `{}`，：

```
my_dict = {} 
```

## 最佳实践 1：下标符号

要使用单个新键和值更新此 dict，您可以使用提供项目分配[的下标表示法（请参阅此处的映射） ：](https://docs.python.org/2/reference/datamodel.html#the-standard-type-hierarchy)

```
my_dict['new key'] = 'new value' 
```

`my_dict`就是现在：

```
{'new key': 'new value'} 
```

## 最佳实践 2：`update`方法 - 2 种方式

我们还可以使用方法有效地更新具有多个值[的`update`字典](https://docs.python.org/2/library/stdtypes.html#dict.update)。我们可能在这里不必要地创建了一个额外的`dict`，所以我们希望我们`dict`已经创建并来自或用于其他目的：

```
my_dict.update({'key 2': 'value 2', 'key 3': 'value 3'}) 
```

`my_dict`就是现在：

```
{'key 2': 'value 2', 'key 3': 'value 3', 'new key': 'new value'} 
```

使用 update 方法执行此操作的另一种有效方法是使用关键字参数，但由于它们必须是合法的 Python 单词，因此不能有空格或特殊符号或以数字开头的名称，但许多人认为这是一种更易读的方式为字典创建键，在这里我们当然避免创建额外的不必要的`dict`：

```
my_dict.update(foo='bar', foo2='baz') 
```

现在`my_dict`是：

```
{'key 2': 'value 2', 'key 3': 'value 3', 'new key': 'new value', 
 'foo': 'bar', 'foo2': 'baz'} 
```

所以现在我们已经介绍了三种 Pythonic 更新`dict`.

* * *

# 魔术方法，`__setitem__`以及为什么应该避免它

还有另一种更新`dict`你不应该使用的方法，它使用该`__setitem__`方法。这是一个如何使用该`__setitem__`方法将键值对添加到 a`dict`的示例，并演示了使用它的性能不佳：

```
>>> d = {}
>>> d.__setitem__('foo', 'bar')
>>> d
{'foo': 'bar'}

>>> def f():
...     d = {}
...     for i in xrange(100):
...         d['foo'] = i
... 
>>> def g():
...     d = {}
...     for i in xrange(100):
...         d.__setitem__('foo', i)
... 
>>> import timeit
>>> number = 100
>>> min(timeit.repeat(f, number=number))
0.0020880699157714844
>>> min(timeit.repeat(g, number=number))
0.005071878433227539 
```

所以我们看到使用下标符号实际上比使用快得多`__setitem__`。做 Pythonic 的事情，即按照预期的方式使用语言，通常更具可读性和计算效率。

* * *

## 回答 #5

> 赞同：117
> 
> 时间：2009-06-21T22:08:57.477

```
dictionary[key] = value 
```

* * *

## 回答 #6

> 赞同：64
> 
> 时间：2012-04-26T19:04:33.870

如果你想在字典中添加字典，你可以这样做。

示例：向您的字典和子字典添加一个新条目

```
dictionary = {}
dictionary["new key"] = "some new entry" # add new dictionary entry
dictionary["dictionary_within_a_dictionary"] = {} # this is required by python
dictionary["dictionary_within_a_dictionary"]["sub_dict"] = {"other" : "dictionary"}
print (dictionary) 
```

**输出：**

```
{'new key': 'some new entry', 'dictionary_within_a_dictionary': {'sub_dict': {'other': 'dictionarly'}}} 
```

**注意：** Python 要求您首先添加一个子

```
dictionary["dictionary_within_a_dictionary"] = {} 
```

在添加条目之前。

* * *

## 回答 #7

> 赞同：59
> 
> 时间：2013-04-14T00:58:27.320

常规语法是`d[key] = value`，但如果您的键盘缺少方括号键，您也可以这样做：

```
d.__setitem__(key, value) 
```

事实上，定义`__getitem__`和`__setitem__`方法是如何让自己的类支持方括号语法。请参阅深入了解*[Python，5.6。特殊类方法](https://python.developpez.com/cours/DiveIntoPython/php/endiveintopython/object_oriented_framework/special_class_methods.php)*。

* * *

## 回答 #8

> 赞同：42
> 
> 时间：2013-05-25T13:33:35.353

您可以创建一个：

```
class myDict(dict):

    def __init__(self):
        self = dict()

    def add(self, key, value):
        self[key] = value

## example

myd = myDict()
myd.add('apples',6)
myd.add('bananas',3)
print(myd) 
```

给出：

```
>>> 
{'apples': 6, 'bananas': 3} 
```

* * *

## 回答 #9

> 赞同：34
> 
> 时间：2013-08-17T23:04:12.190

[这个流行的问题](https://stackoverflow.com/questions/38987/how-can-i-merge-union-two-python-dictionaries-in-a-single-expression)*解决*了合并字典`a`和`b`.

以下是一些更直接的方法（在 Python 3 中测试）...

```
c = dict( a, **b ) ## see also https://stackoverflow.com/q/2255878
c = dict( list(a.items()) + list(b.items()) )
c = dict( i for d in [a,b] for i in d.items() ) 
```

*注意：上面的第一种方法只有在键`b`是字符串的情况下才有效。*

**要添加或修改单个元素**，`b`字典将只包含那个元素...

```
c = dict( a, **{'d':'dog'} ) ## returns a dictionary based on 'a' 
```

这相当于...

```
def functional_dict_add( dictionary, key, value ):
   temp = dictionary.copy()
   temp[key] = value
   return temp

c = functional_dict_add( a, 'd', 'dog' ) 
```

* * *

## 回答 #10

> 赞同：30
> 
> 时间：2018-01-12T19:31:53.227

假设您想生活在不可变的世界中，*不想*修改原始世界，但想要创建一个新的`dict`，这是向原始世界添加新密钥的结果。

**在 Python 3.5+ 中，您可以执行以下操作：**

```
params = {'a': 1, 'b': 2}
new_params = {**params, **{'c': 3}} 
```

**Python 2 等价物是：**

```
params = {'a': 1, 'b': 2}
new_params = dict(params, **{'c': 3}) 
```

在其中任何一个之后：

`params`仍然等于`{'a': 1, 'b': 2}`

和

`new_params`等于`{'a': 1, 'b': 2, 'c': 3}`

有时您不想修改原始文件（您只想要添加到原始文件的结果）。**我发现这是一个令人耳目一新的替代方案：**

```
params = {'a': 1, 'b': 2}
new_params = params.copy()
new_params['c'] = 3 
```

或者

```
params = {'a': 1, 'b': 2}
new_params = params.copy()
new_params.update({'c': 3}) 
```

参考：*[`dict(d1, **d2)` 表达式中的 `**` 是什么意思？](https://stackoverflow.com/questions/2255878/what-does-mean-in-the-expression-dictd1-d2/2255892#2255892)*

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2017-10-23T14:03:24.300

还有一个名字奇怪，行为古怪，但仍然很方便的东西[`dict.setdefault()`](https://docs.python.org/3/library/stdtypes.html#dict.setdefault)。

这

```
value = my_dict.setdefault(key, default) 
```

基本上只是这样做：

```
try:
    value = my_dict[key]
except KeyError: # key not found
    value = my_dict[key] = default 
```

例如，

```
>>> mydict = {'a':1, 'b':2, 'c':3}
>>> mydict.setdefault('d', 4)
4 # returns new value at mydict['d']
>>> print(mydict)
{'a':1, 'b':2, 'c':3, 'd':4} # a new key/value pair was indeed added
# but see what happens when trying it on an existing key...
>>> mydict.setdefault('a', 111)
1 # old value was returned
>>> print(mydict)
{'a':1, 'b':2, 'c':3, 'd':4} # existing key was ignored 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2021-08-31T13:20:21.347

**更新字典有两种方法：**

1.  使用方括号表示法 ( `[]`)

    ```
    my_dict = {}
    my_dict['key'] = 'value' 
    ```

2.  使用`update()`方法

    ```
    my_dict = {}
    my_dict.update({'key': 'value'}) 
    ```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2018-10-11T08:57:34.223

如果您没有加入两个字典，而是将新的键值对添加到字典中，那么使用下标表示法似乎是最好的方法。

```
import timeit

timeit.timeit('dictionary = {"karga": 1, "darga": 2}; dictionary.update({"aaa": 123123, "asd": 233})')
>> 0.49582505226135254

timeit.timeit('dictionary = {"karga": 1, "darga": 2}; dictionary["aaa"] = 123123; dictionary["asd"] = 233;')
>> 0.20782899856567383 
```

但是，如果您想添加例如数千个新的键值对，您应该考虑使用该`update()`方法。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2021-10-01T21:12:07.397

> 这个问题已经得到了令人作呕的回答，但是由于我的 [评论](https://stackoverflow.com/questions/1024847/how-can-i-add-new-keys-to-a-dictionary?noredirect=1#comment94551424_1024847) 获得了很大的关注，所以这里是一个答案：

# 添加新密钥而不更新现有字典

如果您在这里试图弄清楚如何添加一个键并返回一个*新*字典（不修改现有字典），您可以使用以下技术做到这一点

### 蟒蛇> = 3.5

```
new_dict = {**mydict, 'new_key': new_val} 
```

### 蟒蛇 < 3.5

```
new_dict = dict(mydict, new_key=new_val) 
```

请注意，使用这种方法，您的密钥将需要遵循python[中有效标识符名称的规则。](https://docs.python.org/3/reference/lexical_analysis.html#identifiers)

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2019-11-19T04:57:20.903

这是我在这里没有看到的另一种方式：

```
>>> foo = dict(a=1,b=2)
>>> foo
{'a': 1, 'b': 2}
>>> goo = dict(c=3,**foo)
>>> goo
{'c': 3, 'a': 1, 'b': 2} 
```

您可以使用字典构造函数和隐式扩展来重建字典。此外，有趣的是，此方法可用于控制字典构建期间的位置顺序（[Python 3.6 后](https://stackoverflow.com/q/39980323/325452)）。[事实上，对于 Python 3.7 及更高版本，插入顺序是有保证的！](https://mail.python.org/pipermail/python-dev/2017-December/151283.html)

```
>>> foo = dict(a=1,b=2,c=3,d=4)
>>> new_dict = {k: v for k, v in list(foo.items())[:2]}
>>> new_dict
{'a': 1, 'b': 2}
>>> new_dict.update(newvalue=99)
>>> new_dict
{'a': 1, 'b': 2, 'newvalue': 99}
>>> new_dict.update({k: v for k, v in list(foo.items())[2:]})
>>> new_dict
{'a': 1, 'b': 2, 'newvalue': 99, 'c': 3, 'd': 4}
>>> 
```

以上是使用字典理解。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2019-03-25T13:01:25.417

首先检查key是否已经存在：

```
a={1:2,3:4}
a.get(1)
2
a.get(5)
None 
```

然后您可以添加新的键和值。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2021-04-16T05:18:29.473

您可以使用方括号：

```
my_dict = {}
my_dict["key"] = "value" 
```

或者您可以使用*.update()*方法：

```
my_another_dict = {"key": "value"}
my_dict = {}
my_dict.update(my_another_dict) 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2021-01-13T11:16:32.063

这里有一个简单的方法！

```
your_dict = {}
your_dict['someKey'] = 'someValue' 
```

这将`key: value`在`your_dict`字典中添加一对新的`key = someKey`和`value = somevalue`

如果键的值`somekey`已经存在于`your_dict`.

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2021-01-18T20:34:21.997

```
your_dict = {} 
```

**添加新密钥：**

1.  `your_dict[key]=value`

2.  `your_dict.update(key=value)`

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2021-12-28T21:12:57.210

dict 类中存在一个应该适合您的更新方法。

考虑：

```
# dictionary = {"key":"value"} 
```

但是没有任何方法，您可以通过创建一个新值来添加一个键，如下所示：

```
dictionary['newkey'] = 'newvalue' 
```

或使用更新[https://www.python.org/dev/peps/pep-0584/#dict-update](https://www.python.org/dev/peps/pep-0584/#dict-update)

```
dictionary.update({'newkey':'newvalue'}) 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2019-08-27T21:21:02.760

我认为指出 Python 的**[`collections`](https://docs.python.org/3/library/collections.html)**模块也很有用，该模块由许多有用的字典子类和包装器组成，它们简化**了字典中数据类型的添加和修改**，特别是[**`defaultdict`**](https://docs.python.org/3/library/collections.html#collections.defaultdict)：

> 调用工厂函数以提供缺失值的 dict 子类

如果您使用的字典总是包含相同的数据类型或结构，例如列表字典，这将特别有用。

```
>>> from collections import defaultdict
>>> example = defaultdict(int)
>>> example['key'] += 1
>>> example['key']
defaultdict(<class 'int'>, {'key': 1}) 
```

如果键还不存在，`defaultdict`则将给定的值（在我们的例子中`10`）作为初始值分配给字典（通常在循环中使用）。因此，此操作做了两件事：它**向字典添加一个新键（根据问题），*并*在该键尚不存在时分配该值。**使用标准字典，这会引发错误，因为`+=`操作正在尝试访问尚不存在的值：

```
>>> example = dict()
>>> example['key'] += 1
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
KeyError: 'key' 
```

如果不使用`defaultdict`，添加新元素的代码量会更多，可能看起来像：

```
# This type of code would often be inside a loop
if 'key' not in example:
    example['key'] = 0  # add key and initial value to dict; could also be a list
example['key'] += 1  # this is implementing a counter 
```

`defaultdict`也可以用于复杂的数据类型，例如`list`和`set`：

```
>>> example = defaultdict(list)
>>> example['key'].append(1)
>>> example
defaultdict(<class 'list'>, {'key': [1]}) 
```

添加元素会自动初始化列表。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2020-02-04T01:47:50.377

添加一个字典*（键，值）*类。

```
class myDict(dict):

    def __init__(self):
        self = dict()

    def add(self, key, value):
        #self[key] = value # add new key and value overwriting any exiting same key
        if self.get(key)!=None:
            print('key', key, 'already used') # report if key already used
        self.setdefault(key, value) # if key exit do nothing

## example

myd = myDict()
name = "fred"

myd.add('apples',6)
print('\n', myd)
myd.add('bananas',3)
print('\n', myd)
myd.add('jack', 7)
print('\n', myd)
myd.add(name, myd)
print('\n', myd)
myd.add('apples', 23)
print('\n', myd)
myd.add(name, 2)
print(myd) 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2022-01-23T21:08:49.030

您可以像这样创建一个新的键值对：

```
my_dictionary = {"key1" : "value1"}
my_dictionary["key2"] = "value2" 
```

要更改“key1”或“value2”，您可以执行相同的操作，如下所示：

```
my_dictionary = {"key1" : "value1"}
my_dictionary["key2"] = "value2"

my_dictionary["key1"] = "value1_revised" 
```

# php - 在 Symfony 中手动创建表单

> ID：1024854
> 
> 赞同：0
> 
> 时间：2009-06-21T22:11:14.743
> 
> 标签：php, symfony1

我正在 Symfony 中构建一个电子商务应用程序，并且我有一个页面列出了特定类别中的产品，例如在 URL“/categories/list/id/1”处：

```
产品一
产品 2
...

```

我想要一些形式：

```
产品一
* 将其中 [ 1 ] 个添加到您的购物车 [Go]

产品 2
* 将其中 [ 1 ] 个添加到您的购物车 [Go]

```

在同一页面上，所以我假设我需要从 sfForm 类派生并构造我自己的表单，就像自动生成的表单一样。这应该根据类别模型命名吗？还是根据“购物车”模型（我的购物车将存放在哪里）命名更合适？这个链接如何链接到我的 listProductsByCategorySuccess.php 模板？

希望以上内容有意义！

谢谢，

-富有的

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-08T13:16:54.227

根据 1.1 或 1.2 sfForm 是一个独立的库（有点），除非您从 Doctrine/Propel sfForm 扩展，否则它与您的数据库没有任何联系。

因为它是独立的，你可以随意使用它，你只需要创建一个表单

类 AddProductForm 扩展 sfForm {

}

并使用隐藏的小部件进行设置，该小部件将保存您的 product_id 和 product_count 文本输入，该文本输入应该是用户想要订购的产品数量。

然后只需执行标准 if ($form->isValid()) 内容并将其插入数据库和/或 cookie 和/或会话中以在结帐过程中使用。

如果您需要，可以提供更深入的示例:) 但是坚持下去，sfForm 一开始很难。

# iphone - UIKit 视图类和其他 iPhone 小部件的可视化

> ID：1024855
> 
> 赞同：1
> 
> 时间：2009-06-21T22:11:22.263
> 
> 标签：iphone

我正在慢慢研究[iPhone 应用程序编程指南](http://developer.apple.com/iphone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/WindowsandViews/WindowsandViews.html#//apple_ref/doc/uid/TP40007072-CH8-SW1)，虽然它很棒，但我想知道是否有人看到任何与类名/小部件与可视化/图表匹配的资源。

例如，当我阅读有关 Containers 和 UITableView 的内容时，如果我能看到小部件的实际外观将会非常有帮助。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T22:21:30.340

您可以在界面生成器中查看控件的外观。您不会看到确切的类名，但它非常简单。进度条是 UIProgressBarView，按钮是 UIButton，等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T22:23:44.373

一旦您开始开发，UICatalog 示例项目也会很有帮助。它显示了每种类型的 UI 元素（按钮、滑块、图像等），您可以查看源代码以了解其使用方式。

# c# - NHibernate 的 cfg.xml 文件的 Mono 验证

> ID：1024857
> 
> 赞同：3
> 
> 时间：2009-06-21T22:11:44.803
> 
> 标签：c#, nhibernate, mono, xsd

我正在尝试在 Mono 中设置 NHibernate，以将对象存储在 SQLite 中。

我已经复制/粘贴了[示例配置文件](https://www.hibernate.org/361.html#A9)。我只有以下两行代码：

```
var config = new Configuration();
config.Configure(); 
```

这会导致以下不合语法的验证异常：

> System.InvalidOperationException ：发生了从 Finished 到 Content 的验证状态转换的意外尝试。

我不确定问题是什么。如果问题是 Mono 特定的，那么我想找到一种解决方法。

**编辑：**

这可能仍然是问题，也可能不是问题，但我已经切换到[FluentNHibernate](http://fluentnhibernate.org/)进行配置。强烈推荐。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-26T06:39:30.137

[这个 Mono 错误](https://bugzilla.novell.com/show_bug.cgi?id=324606)看起来很相关——但它已于去年 9 月修复。

您使用的是哪个版本的 Mono，您是否尝试过最新版本？

特别是，我刚刚在 Linux 上的 Mono 2.4 上尝试了您的测试代码，它运行良好。

# python - 如何在 Mac 上安装 GASP for Python 2.6.2

> ID：1024862
> 
> 赞同：1
> 
> 时间：2009-06-21T22:14:07.047
> 
> 标签：python, pyobjc, gasp

我目前正在尝试学习 Python，并且正在学习如何像计算机科学家一样思考：学习 Python。我已经在 Mac OSX 10.4.11 上安装了 Python 2.6.2 并且正在使用 IDLE。

在第 4 章结尾处 Elkner 等人。参考 GASP。但是，当我输入时，他们的说明不起作用：

```
>>> from gasp import* 
```

我得到：

```
Traceback (most recent call last):
  File "<pyshell#17>", line 1, in <module>
    from gasp import*
ImportError: No module named gasp 
```

我在谷歌上环顾四周，只能找到过时的安装方法或 gobbledegook 页面。我相信我必须先安装 PyObjC 并且也无法完成此操作。

任何人都可以帮我一些简单的英文说明吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-09-21T21:10:48.497

大家好，对于不完整的句子和整体英语很差，我很抱歉，但我想让这个简单易读和理解的人在任何类型的编程方面都完全没有经验，就像我一样（第一天弄乱这些东西，例如终端）。这是在一天内完成的数小时谷歌搜索的结果。也许熟悉以下命令（粗体）的人不会介意解释到底发生了什么。此外，这一切都是在运行 Mac OS Lion 的 MacBook Pro 上的终端中完成的。

1.  安装 macport 二进制文件（附带安装程序；简单）
2.  `sudo port install py-game`

    不确定这是否有必要，因为它似乎不会导致 pygame 对 python 版本 2.7.1 (stock python on lion) 起作用

3.  `sudo port select --set python python 2.7`

    我相信这会将默认的 python 版本设置为 2.7.2，我也相信它是在步骤 2 中下载的（因此我认为这最终是一个必要的步骤）

4.  下载 setuptools-0.6c11-py2.7.ta​​r
5.  在单击 .tar 后出现的文件夹 gasp-0.3.4 中，放入`setup.py`gasp
    文件夹
6.  `sudo python gasp/setup.py install`

    确保您的目录是文件夹 gasp-0.3.4

7.  `sudo port –v install py27-pygtk`

    此步骤大约需要一个小时才能完成

8.  `sudo port uninstall py-game`

    这一步对于gasp工作来说不是必需的；我只是不想在第二步下载的电脑上有任何不必要的东西；但是，此步骤将 python 2.7.2 放在我的计算机上；我想可以单独安装 2.7.2 但这种方式对我有用；在此步骤中也安装了许多其他不必要的东西，但我认为即使在此命令之后它也会保留，哦好吧

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T22:18:10.640

这实际上有点巧合。我是 GASP 的包装商之一。在我们的主[项目页面链接的](https://edge.launchpad.net/gasp-code)[下载页面](http://dev.laptop.org/pub/gasp/downloads/)上，有关于如何在大多数主要平台上安装它的说明。但是，没有考虑过 OSX。一会儿会写点东西。

本质上，从 PSF安装[官方 Python 。](http://python.org)然后添加[MacPorts](http://www.macports.org/)并运行

```
sudo ports install py-game 
```

从上面链接的下载页面中提取源 tarball 到您的站点包目录。

还有一些我发现可能会更好的[替代指令，因为我没有测试过上面的内容。](http://www.theartfulscientist.com/2008/03/16/how-to-install-pyobjc-pygame-and-gasp-on-mac-os-x-for-python-tutorial/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-21T17:31:22.577

这是大多数使用“如何像计算机科学家一样思考：使用 Python 学习”的读者在读到第 4 章时面临的一个有趣问题。

现在要安装 GASP，您需要检查您的机器上是否安装了 python。

假设：我将假设您使用的是 Mac。

在终端上键入以下命令，

```
`$ python -V` 
```

*{如果您的系统上安装了 python，您将得到类似 Python 2.7.1 的答案（如果版本是 2.7.1）。}*

一旦你的系统上有 python 可用，你应该安装 PyObjC。

一个简单的方法是在终端提示符下输入，

```
`$ easy_install pyobjc==2.2` 
```

*{这将安装 2.2 版}*

下一步是安装 pygame 包，您可以通过两种方式下载 .dmg 文件或使用“homebrew”。我更喜欢第二种方法。

要使用“brew”安装 pygame 包，您必须先安装 mercurial。这是一个简单的过程，只需输入

```
$ brew install mercurial 
```

然后输入以下命令，

```
$ brew install sdl sdl_image sdl_mixer sdl_ttf smpeg portmidi 
$ sudo pip install hg+http://bitbucket.org/pygame/pygame 
```

下一步是安装 GASP。[从https://launchpad.net/gasp-core/+download](https://launchpad.net/gasp-core/+download)下载 gasp

解压 .tar 文件，你会得到一个文件夹结构。我们的目标是将名为“gasp”的文件夹复制到系统库文件夹中。要检查使用了哪个文件夹或 python 版本，并在终端上的以下命令中了解它们的正确路径类型。

```
$ python -c 'import sys, pprint; pprint.pprint(sys.path)' 
```

通常它会打印一个类似于 '/Library/Python/2.7/site-packages' 的路径，你可以注意到它是上述命令生成的输出的最后一行或倒数第二行。

将 gasp 文件夹复制到 site-packages 文件夹，

```
$ sudo cp -R ~/Desktop/python-gasp-0.1.1/gasp/ /Library/Python/2.7/site-packages/gasp 
```

这应该将所有必需的文件复制到指定为第二个参数的位置。

现在转到终端并输入

```
$ python
>>> import gasp 
```

如果一切顺利，您将不会收到任何错误或任何消息。

PS：确保在您的站点包目录中没有 pygame/gasp 的重复副本。在重复的情况下，它可能会发脾气。此外，如果任何步骤出错，您可能会在 gasp 包中 base.py 的第 25 或第 26 行出现错误“import cairo”。在这种情况下，请通过删除 pygame 和 gasp 并重新安装来清理您的站点包目录他们，这应该解决它。

此外，在安装 mercurial 时，您可能会收到一些与证书相关的警告。您可以通过键入以下命令来解决它们，

```
$ openssl req -new -x509 -extensions v3_ca -keyout /dev/null -out dummycert.pem -days 3650
$ sudo cp dummycert.pem /etc/hg-dummy-cert.pem
$ cd ~
$ nano .hgrc 
```

{ 这将打开一个空的 .hgrc 文件}

输入以下内容

[网络]

cacerts = /etc/hg-dummy-cert.pem

按 ctrl+ 保存以上 2 行 o 按 ctrl + x 退出 nano

而已。这应该可以解决您在安装 GASP 时遇到的问题，并享受“如何像计算机科学家一样思考”这本书，它是对计算世界的精彩介绍。

# asp.net - 如何设计一个游戏网页应用？

> ID：1024864
> 
> 赞同：-2
> 
> 时间：2009-06-21T22:15:14.017
> 
> 标签：asp.net, vb.net

我知道 vb.net，但完全没有网络编程经验。我需要制作一个可以在浏览器中运行的网络应用程序，其中有棋盘游戏和可以移动的棋子。有人可以帮我开始吗？asp.net 中是否有任何示例？

我需要这样的东西：

[http://www.hallofbrightcarvings.com/game/grid](http://www.hallofbrightcarvings.com/game/grid)

我不知道这是内置的什么语言，但我更喜欢 vb.net。我希望这些作品是图片而不是文字。请帮助开始。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T22:21:16.860

根据您的描述，我认为 ASP.NET 可以为您做的很少。您需要的是 Flash 或 Javascript 技能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T22:28:45.597

我有一个非常基本的例子，可以在用 javascript 编写的网格周围移动片段。[你可以在这里](http://www.hallofbrightcarvings.com/game/grid)看到它的运行情况，如果你看一下源代码，你会发现它主要是用 jquery 完成的。请随意使用，我很长时间没有更新该版本，但希望您会发现它有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T22:34:29.923

让我们分解一下，如果你想自己制作整个东西，你需要两件事

*   客户端：Flash、SilverLight、JAVA
*   服务器端：PHP、ASP.net、Java

如您所知 vb.net 并希望使用 asp.net，所以我建议使用 Silverlight。

**这有多复杂？**

取决于你想构建什么，如果你想构建一个黑手党战争游戏，那么你需要处理用户界面，这将非常困难。服务器端也很重要，因为您需要处理不同玩家之间的注册和关系。

如果您指定更多问题，您可以获得更好的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T22:52:32.053

您上面引用的示例是完全客户端的，这意味着代码全部位于浏览器上，服务器不做任何事情来启用网格。因此，如果您在计算机上对该页面进行了“另存为”，则可以脱机运行它。

您应该在您引用的页面上使用浏览器的查看源代码功能，并查看它是如何构建的。它是使用 HTML、CSS 和 javascript 完成的。使用 w3schools 让自己开始处理这三个问题。

如果您真的需要使用 vb.net 对其进行编码，我不知道任何允许拖放 Web 表单的方式。不过我很想知道。Ajax 和 .net 拖放应该是您要研究的关键字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-21T22:30:56.967

要在 Web 上执行此操作，您可能希望将项目分为两个组件：客户端和服务器端。

在服务器端，您需要使用 PHP、Python 或 ASP.NET 等语言。我认为 ASP.NET 有一些使用 VB.NET 的方法，所以这对你来说是一个不错的选择，可以最大限度地减少你需要学习的新事物的数量。

客户端将成为最大的障碍。这里基本上有两种不同的方法：

*   HTML+CSS+Javascript，使用 HTTP 回调（即 AJAX）与服务器通信。
*   [使用Flex](http://www.adobe.com/products/flex/)的Flash （我认为 HTTP 调用可能也是在这里与您的服务器通信的最简单方法。）

对于这样的游戏，我认为 Flash 可能是最好的选择。制作图形和声音会更容易，并且它在每个支持 Flash 的浏览器中都可以运行。

# c# - 编译后找到ID

> ID：1024870
> 
> 赞同：0
> 
> 时间：2009-06-21T22:18:45.133
> 
> 标签：c#, asp.net, javascript

当您在 asp.net 中分配 ID 时，例如：

```
<asp:Label runat="server" ID="mylabel" Text="some text"></asp:Label> 
```

您用来引用该对象的 ID 后面的代码是 mylabel。

然而，在站点编译并运行之后，HTML 中的 ID 更改为更模糊的东西

```
<asp:Label runat="server" ID="ct100_blahblah_what_mylabel" Text="some text"></asp:Label> 
```

而且我不能（不知道如何）可靠地预测用 javascript 选择它会是什么。

有没有办法在任何给定时刻询问服务器该标签的 ID 是什么？

可以使用哪些关键字来了解有关此现象的更多信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T22:24:25.450

我相信您正在寻找该[`ClientID`](http://msdn.microsoft.com/en-us/library/system.web.ui.control.clientid.aspx)物业。

> 该`ClientID`值通常用于以编程方式访问为客户端脚本中的控件呈现的 HTML 元素。

您的另一个选择是将您的控件包装在一个 HTML 元素中，如下所示：

```
<span id="foo">
    <asp:Label runat="server" ID="mylabel" Text="some text"></asp:Label>
</span> 
```

由于这个外部元素没有`runat="server"`属性，所以它的 id 在渲染时不会改变。这意味着您的 JavaScript 函数必须更改为从 span 中提取内部元素，`foo`或者如果您使用的是 jQuery 之类的 JavaScript 框架，您可以像这样拉回标签：

```
$("span#foo span"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T22:24:58.863

你需要`[ClientID](http://msdn.microsoft.com/en-us/library/system.web.ui.control.clientid.aspx)`房产。这包含在运行时生成的控件 id。您可以在后面的代码中发出一些 JavaScript，将控件的客户端 ID 设置为 JavaScript 变量，以便您可以引用它。

**编辑：添加示例**

下面将使用 ClientID 找到标签，然后更新其文本。

```
    <html>
    <正文>
        <asp:Label runat="server" ID="mylabel" Text="some text"></asp:Label>

        <脚本语言="javascript">
            var mylabelID = "<%= mylabel.ClientID %>";
            var label = document.getElementById(mylabelID);
            label.innerHTML += "改变";
        </脚本>
    </正文>
    </html>

```

# java - 避免 jvm 崩溃日志

> ID：1024879
> 
> 赞同：3
> 
> 时间：2009-06-21T22:22:55.703
> 
> 标签：java, jvm, crash

我的 java 应用程序每次关闭时都会使 jvm 崩溃。
我认为崩溃是由即时使用的第三方 dll 引起的，所以我无法修复它们。
问题是每次崩溃时都会创建一个 hs_err _pid.log 日志文件，填充 CWD。
可以禁用jvm崩溃日志吗？有没有办法从正在运行的 java 应用程序中做到这一点？
谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T22:27:01.530

在 java 6 中，您可以使用 -XX:ErrorFile 选项来控制文件的去向。我不确定您是否可以将其关闭，但您可能会将其定向到 /dev/null

[http://java.sun.com/javase/6/webnotes/trouble/TSG-Desktop/html/felog.html](http://java.sun.com/javase/6/webnotes/trouble/TSG-Desktop/html/felog.html)

# eclipse - Making Eclipse's Java code formatter ignore block comments

> ID：1024886
> 
> 赞同：81
> 
> 时间：2009-06-21T22:25:32.967
> 
> 标签：eclipse, comments, formatter

Is there a way to make Eclipse's built-in Java code formatter ignore comments? Whenever I run it, it turns this:

```
 /*
     * PSEUDOCODE
     * Read in user's string/paragraph
     * 
     * Three cases are possible
     * Case 1: foobar
     *         do case 1 things
     * Case 2: fred hacker
     *         do case 2 things
     * Case 3: cowboyneal
     *         do case 3 things
     *         
     * In all cases, do some other thing
     */ 
```

into this:

```
 /*
     * PSEUDOCODE Read in user's string/paragraph
     * 
     * Three cases are possible Case 1: foobar do case 1 things Case 2: fred
     * hacker do case 2 things Case 3: cowboyneal do case 3 things
     * 
     * In all cases, do some other thing
     */ 
```

I have already played around with the Windows > Preferences > Java > Code Style > Formatter settings but can't find one for keeping comment formatting. I'm using Eclipse 3.4.0.

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2011-03-28T23:19:36.897

There is another solution that you can use to suppress the formatting of specific block comments. Use `/*-` (note the hyphen) at the beginning of the block comment, and the formatting won't be affected if you format the rest of the file.

```
/*-
 * Here is a block comment with some very special
 * formatting that I want indent(1) to ignore.
 *
 *    one
 *        two
 *            three
 */

```

Source: [http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-141999.html#350](http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-141999.html#350)

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-06-22T05:45:43.697

Update 2010, as [pointed by the OP](https://stackoverflow.com/a/12163663/6309) and [in this answer](https://stackoverflow.com/a/3353765/6309), the special string `// @formatter:off` in Eclipse 3.6 is enough.

[It was not available](https://stackoverflow.com/questions/5115088/turn-off-eclipse-formatter-for-selected-code-area?lq=1#comment5736447_5115143) at the time of the question.

* * *

Original answer: June 2009, [Eclipse 3.4/3.5](https://en.wikipedia.org/wiki/Eclipse_(software)#Releases)

With the Java Formatter (`Windows > Preferences > Java > Code Style > Formatter`), you can create a new Formatter profile.

In the Comments tab (in eclipse3.5), you can make sure, in the "`Javadoc comment settings`", to uncheck "`Format HTML tags`".
Check also the "`Never join lines`" in the "`General settings`" section.

Then your comment should be written as:

```
/**
 * PSEUDOCODE
 * Read in user's string/paragraph
 * 
 * Three cases are possible:
 * <dl>
 *   <dt>Case 1: foobar</dt>
 *     <dd>        do case 1 things</dd>
 *   <dt>Case 2: fred hacker</dt>
 *     <dd>        do case 2 things</dd>
 *   <dt>Case 3: cowboyneal</dt>
 *     <dd>        do case 3 things</dd>
 * </dl>        
 * In all cases, do some other thing
 */ 
```

Note: I have made a *Javadoc* comment, and not a simple comment, as I believe a comment with that much text in it may be better placed in front of a method. Plus, Javadoc sections have more formatting parameters to play with.
If it is in front of a method (true Javadoc), the [HTML tags `<dl>`, `<dt>` and `<dd>`](http://www.w3schools.com/TAGS/tag_dl.asp) will help to present it properly within the Javadoc view.

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2012-08-28T16:33:01.803

I just learned from a co-worker that Eclipse offers special formatting tags that can be used for this:

```
// @formatter:off
/*
 * ╔════════╦═══════╦══════════╗
 * ║ Month  ║ Sales ║ Position ║
 * ╠════════╬═══════╬══════════╣
 * ║ June   ║ 44k   ║ 2nd      ║
 * ║ July   ║ 39k   ║ 2nd      ║
 * ║ August ║ 49k   ║ 4th      ║
 * ╚════════╩═══════╩══════════╝
 *
 * This comment shouldn't be formatted, and will now be ignored by the formatter.
 */
// @formatter:on 
```

Note that you may need to manually enable this feature through the Preferences menu → Java > Code Style > Formatter, clicking on **Edit**, selecting the **Off/On Tags** tab and checking **Enable Off/On tags** ([source](https://stackoverflow.com/questions/1820908/how-to-turn-off-the-eclipse-code-formatter-for-certain-sections-of-java-code#comment15906713_3353765)).

A quick Google for the string **@formatter:off** brought me to [this other SO answer](https://stackoverflow.com/a/3353765/122607), which mentioned this feature in the context of disabling the formatter for code blocks. I've confirmed that it works for line comments, "normal" block comments and Javadoc block comments as well.

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-01-03T14:00:48.773

Another possibility is to use HTML's <pre> in Javadoc:

```
/**
 * <pre>
 *    this
 *   is
 *      kept
 *  as
 *    is
 * </pre>
 */ 
```

At least this is how I tend to embed my ASCII-art in source code comments :)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-02-10T17:57:03.967

Surround the specific text with `<pre> </pre>` tags.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-21T22:31:51.363

In Eclipse 3.4: Preferences, Java->Code Style->Formatter, then edit profile, comments tab. There's a bunch of options there for controlling comment formatting.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-26T11:13:08.427

If you want to supress formatting in eclipse, you can always wrap content that is intended to NOT TO BE FORMATED into `<pre>UNFORMATTED CONTENT</pre>` tag. **Javadoc formatter will detect that tag**, and leave everything between that tags unformatted.

Pros:

*   Rest of Javadoc is still formatted
*   Javadoc's html output will be "unformatted" as well because of pre tags

Cons:

*   Not seeing one

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-09-06T02:34:41.877

one workaround is to add **pre** tag for the comments that you don't want eclipse to format

```
/**
 * <pre>
 *    this part
 *   is
 *      out of
 *  format
 *    
 * </pre>
 */ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-16T18:17:40.967

Try this one. This worked for me. With the Java Formatter (Windows > Preferences > Java > Code Style > Formatter), you can create a new Formatter profile from existing and then edit it.

If Eclipse doesn't allow to save this then create a new one and save in that. [![enter image description here](../Images/85ffd657d5815f705c173279b7032146.png)](https://i.stack.imgur.com/5OCB4.png)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-21T22:31:01.973

It is language-dependent.

For example, if working with javascript, you would go to "Window -> Preferences -> Javascript -> Code Style -> Formatter" and then edit the formatter options.

**Edit** (reflecting changesin OP Questions

For editing java code formatting, go to "Window -> Preferences -> Java -> Code Style -> Formatter"

At the top of the panel you will see

> Active Profile:
> Eclipse [built-in]

From there you have one button to the right, "Edit", and two below, "New..." and "Import...". I would recommend Editing the existing profile.

In the edit profile dialog, there are a series of tabs along the top. The last tab is "Comments". To completely disable comment formatting, uncheck "Enable Javadoc comment formatting", "Enable block comment formatting", "Enable line comment formatting", and "Enable header comment formatting".

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-01T12:51:14.707

You can change this in Windows - Preferences - Java - Code Style - Formatter, than click the Edit.. button, find Comments, choose the Never Join Lines.

Then, it should be OK.

# php - 如何评估（）一段字符串

> ID：1024900
> 
> 赞同：0
> 
> 时间：2009-06-21T22:35:34.303
> 
> 标签：php, string, eval

我有一个包含 HTML 和 PHP 的字符串，当我从数据库中提取字符串时，它会回显到屏幕，但 PHP 代码不显示。字符串如下所示：

```
 $string = 'Hello <?php echo 'World';?>';
   echo $string; 
```

**输出**

```
 Hello 
```

**源代码**

```
 Hello <?php echo 'World';?> 
```

当我查看源代码时，我可以在那里看到 php 行。所以我需要做的是 eval() 只是字符串中的 php 段。

要考虑的一件事是，PHP 可以在任何给定时间位于字符串中的任何位置。

*** 澄清一下，我的 PHP 配置是正确的，这是一些 PHP 从数据库中转储而不渲染的情况，因为我正在回显一个带有 PHP 代码的变量，它无法运行。***

再次感谢我可能收到的任何帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-21T22:54:00.460

```
$str = "Hello
<?php echo 'World';?>";

$matches = array();

preg_match('/<\?php (.+) \?>/x', $str, $matches);

eval($matches[1]); 
```

这会奏效，但就像其他人已经并且将建议的那样，这是一个糟糕的主意。您的应用程序架构不应该围绕在数据库中存储代码展开。

最简单的是，如果您的页面总是需要显示字符串，请将这些字符串存储在数据库中，而不是生成它们的代码。现实世界的数据比这更复杂，但必须始终在数据库中正确建模。

编辑：需要调整 preg_replace_callback 以正确删除源/插值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T22:39:42.953

您不应该评估 php 代码，只需运行它。需要安装 php 解释器，并正确配置 apache+php。然后这个 .php 文件应该输出 Hello World。

**对编辑的回答：** 使用 preg_replace_callback 获取 php 部分，对其进行评估，将输入替换为输出，然后回显它。但。如果你应该评估来自数据库的东西，我几乎可以肯定，这是一个设计错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T22:57:15.227

eval() 应该可以正常工作，只要代码是正确的 PHP 并以分号结尾。你先去掉 php 标签，然后评估它怎么样。

以下示例已经过测试并且有效：

```
<?php
$db_result = "<?php echo 'World';?>";
$stripped_code = str_replace('?>', '', str_replace('<?php', '', $db_result));
eval($stripped_code);
?> 
```

只要确保您从数据库中检索到的任何内容都已被正确清理，因为您实际上允许任何可以将内容放入数据库的人执行代码。

# matlab - 在matlab中有效地计算汉明权重

> ID：1024904
> 
> 赞同：14
> 
> 时间：2009-06-21T22:40:05.480
> 
> 标签：matlab, bit-manipulation, bitstring, hammingweight

给定要解释为位字符串的 MATLAB uint32，计算字符串中有多少非零位的有效且简洁的方法是什么？

我有一个可行的、幼稚的方法来循环这些位，但这对我的需要来说太慢了。（使用 std::bitset count() 的 C++ 实现几乎立即运行）。

我发现了一个非常不错的页面，列出了各种位计数技术，但我希望有一种简单的 MATLAB 式方法。

[http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetNaive](http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetNaive)

**更新#1**

刚刚实现了 Brian Kernighan 算法如下：

```
w = 0;
while ( bits > 0 )
    bits = bitand( bits, bits-1 );
    w = w + 1;
end 
```

性能仍然很糟糕，仅计算 4096^2 权重计算需要超过 10 秒。我的 C++ 代码使用 std::bitset 中的 count() 可以在亚秒时间内完成。

**更新#2**

这是迄今为止我尝试过的技术的运行时间表。当我得到更多的想法/建议时，我会更新它。

```
矢量化 Scheiner 算法 => 2.243511 秒
矢量化 Naive bitget 循环 => 7.553345 秒
Kernighan 算法 => 17.154692 秒
长度（查找（bitget（val，1:32）））=> 67.368278 秒
nnz(bitget(val, 1:32)) => 349.620259 秒
Justin Scheiner 的算法，展开循环 => 370.846031 秒
Justin Scheiner 的算法 => 398.786320 秒
天真的 bitget 循环 => 456.016731 秒
sum(dec2bin(val) == '1') => 1069.851993 秒

```

*评论*：MATLAB 中的 dec2bin() 函数似乎实现得很差。它运行非常缓慢。

*评论*：“Naive bitget loop”算法实现如下：

```
w=0;
for i=1:32
   if bitget( val, i ) == 1
       w = w + 1;
   end
end 
```

*评论*： Scheiner 算法的循环展开版本如下所示：

```
function w=computeWeight( val )
w = val;
w = bitand(bitshift(w, -1), uint32(1431655765)) + ...
    bitand(w, uint32(1431655765));

w = bitand(bitshift(w, -2), uint32(858993459)) + ...
    bitand(w, uint32(858993459));

w = bitand(bitshift(w, -4), uint32(252645135)) + ...
    bitand(w, uint32(252645135));

w = bitand(bitshift(w, -8), uint32(16711935)) + ...
    bitand(w, uint32(16711935));

w = bitand(bitshift(w, -16), uint32(65535)) + ...
    bitand(w, uint32(65535)); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-22T01:23:47.693

我很想看看这个解决方案有多快：

```
function r = count_bits(n)

shifts = [-1, -2, -4, -8, -16];
masks = [1431655765, 858993459, 252645135, 16711935, 65535];

r = n;
for i=1:5
   r = bitand(bitshift(r, shifts(i)), masks(i)) + ...
      bitand(r, masks(i));
end 
```

回过头来，我看到这是在 bithacks 页面上给出的“并行”解决方案。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-21T23:49:56.993

**编辑：新解决方案**

您似乎想对 4096×4096 的 UINT32 值数组中的每个元素重复计算。如果这是您正在做的事情，我认为在 MATLAB 中最快的方法是使用[BITGET](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/bitget.html)旨在对值矩阵进行操作的事实。代码如下所示：

```
numArray = ...your 4096-by-4096 matrix of uint32 values...
w = zeros(4096,4096,'uint32');
for iBit = 1:32,
  w = w+bitget(numArray,iBit);
end 
```

如果您想制作其他一些算法的矢量化版本，我相信[BITAND](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/bitand.html)也旨在对矩阵进行操作。

* * *

**旧的解决方案...**

我能想到的最简单的方法是使用[DEC2BIN](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/dec2bin.html)函数，它为您提供非负整数的二进制表示（作为字符串）：

```
w = sum(dec2bin(num) == '1');  % Sums up the ones in the string 
```

它很慢，但很容易。=)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-22T00:24:53.117

除非这是一个 MATLAB 实现练习，否则您可能只想采用快速 C++ 实现并将其编译为 mex 函数，每个目标平台一次。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-07-01T16:24:24.550

从顶部的斯坦福链接实现了“最佳 32 位算法”。改进后的算法将处理时间减少了 6%。还优化了段大小，发现 32K 是稳定的，并且比 4K 缩短了 15% 的时间。预计 4Kx4K 时间是矢量化 Scheiner 算法的 40%。

```
function w = Ham(w)
% Input uint32
% Output vector of Ham wts
 for i=1:32768:length(w)
  w(i:i+32767)=Ham_seg(w(i:i+32767));
 end
end

% Segmentation gave reduced time by 50%

function w=Ham_seg(w)
 %speed
 b1=uint32(1431655765); 
 b2=uint32(858993459);
 b3=uint32(252645135);
 b7=uint32(63); % working orig binary mask

 w = bitand(bitshift(w, -1), b1) + bitand(w, b1);
 w = bitand(bitshift(w, -2), b2) + bitand(w, b2);
 w =bitand(w+bitshift(w, -4),b3);
 w =bitand(bitshift(w,-24)+bitshift(w,-16)+bitshift(w,-8)+w,b7);

end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-01T06:12:16.327

在 Matlab Cody 上做了一些时序比较。确定分段修改矢量化 Scheiner 可提供最佳性能。

对于 L=4096*4096 向量，基于 Cody 1.30 秒到 0.60 秒的变化，时间减少 >50%。

```
function w = Ham(w)
% Input uint32
% Output vector of Ham wts

 b1=uint32(1431655765); % evaluating saves 15% of time 1.30 to 1.1 sec
 b2=uint32(858993459);
 b3=uint32(252645135);
 b4=uint32(16711935);
 b5=uint32(65535);

 for i=1:4096:length(w)
  w(i:i+4095)=Ham_seg(w(i:i+4095),b1,b2,b3,b4,b5);
 end
end

% Segmentation reduced time by 50%

function w=Ham_seg(w,b1,b2,b3,b4,b5)
 % Passing variables or could evaluate b1:b5 here

 w = bitand(bitshift(w, -1), b1) + bitand(w, b1);
 w = bitand(bitshift(w, -2), b2) + bitand(w, b2);
 w = bitand(bitshift(w, -4), b3) + bitand(w, b3);
 w = bitand(bitshift(w, -8), b4) + bitand(w, b4);
 w = bitand(bitshift(w, -16), b5) + bitand(w, b5);

end

vt=randi(2^32,[4096*4096,1])-1;
% for vt being uint32 the floor function gives unexpected values
tic
v=num_ones(mod(vt,65536)+1)+num_ones(floor(vt/65536)+1); % 0.85 sec
toc
% a corrected method is
v=num_ones(mod(vt,65536)+1)+num_ones(floor(double(vt)/65536)+1);
toc 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-11-27T11:34:38.310

一种快速的方法是使用查找表计算每个字节中的位，然后将这些值相加；实际上，这是问题中给出的网页上建议的方法之一。这种方法的好处是，查找和求和都是 MATLAB 中的矢量化操作，因此您可以对这种方法进行矢量化，并同时非常快速地计算大量位串的汉明权重/设置位数。这种方法在 MATLAB File Exchange 上的[bitcount](http://www.mathworks.com/matlabcentral/fileexchange/44371)提交中实现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-22T01:35:36.733

尝试将工作分成更小的部分。我的猜测是，如果您想一次处理所有数据，matlab 会尝试在执行连续步骤之前对所有整数执行每个操作，并且处理器的缓存在每个步骤中都会失效。

```
for i=1:4096,
    «process bits(i,:)»
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-29T06:07:50.017

我在这里恢复了一个旧线程，但我遇到了这个问题，我为此写了一点代码：

```
distance = sum(bitget(bits, 1:32)); 
```

看起来很简洁，但我害怕`bitget`在 O(n)`bitshift`操作中实现。该代码适用于我的工作，但我的问题集不依赖于汉明权重。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-29T14:09:38.540

```
num_ones=uint8(zeros(intmax('uint32')/2^6,1));
% one time load of array not implemented here
tic
for i=1:4096*4096
 %v=num_ones(rem(i,64)+1)+num_ones(floor(i/64)+1); % 1.24 sec
 v=num_ones(mod(i,64)+1)+num_ones(floor(i/64)+1); % 1.20 sec
end
toc
tic
num_ones=uint8(zeros(65536,1));
for i=0:65535
 num_ones(i+1)=length( find( bitget( i, 1:32 ) ) ) ;
end
toc
% 0.43 sec to load
% smaller array to initialize
% one time load of array
tic
for i=1:4096*4096
 v=num_ones(mod(i,65536)+1)+num_ones(floor(i/65536)+1); %  0.95 sec
 %v=num_ones(mod(i,65536)+1)+num_ones(bitshift(i,-16)+1); % 16 sec for 4K*1K
end
toc
%vectorized
tic
num_ones=uint8(zeros(65536,1));
for i=0:65535
 num_ones(i+1)=length( find( bitget( i, 1:32 ) ) ) ;
end % 0.43 sec
toc
vt=randi(2^32,[4096*4096,1])-1;
tic
v=num_ones(mod(vt,65536)+1)+num_ones(floor(vt/65536)+1); % 0.85 sec
toc 
```

# c# - 在继续缓慢的服务器端工作（例如日志记录）之前是否可以返回一个 ASP 页面

> ID：1024908
> 
> 赞同：1
> 
> 时间：2009-06-21T22:41:05.557
> 
> 标签：c#, asp.net

在您完成所有服务器端工作之前，是否可以将页面响应返回给用户？

即，我有一个没有数据库的廉价托管帐户，但我想通过在我的另一个更昂贵的托管帐户上调用网络服务来记录某个事件（即，非常慢的日志记录操作）

我真的不希望用户在呈现他们的页面之前必须等待这个缓慢的日志记录操作完成。

我需要启动一个新线程还是进行异步调用？或者是否可以返回页面，然后继续在同一个线程/代码中愉快地工作？

使用 ASP.Net (webforms) C# .Net 2.0 等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T22:42:50.873

您可能需要第二个线程。一个简单的选择是使用`ThreadPool`，但在更复杂的设置中，生产者/消费者队列会很好地工作。

在最简单的级别：

```
 ThreadPool.QueueUserWorkItem(delegate {
        DoLogging(state details);
    }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T22:42:11.217

你当然可以试试[`Response.Flush`](http://msdn.microsoft.com/en-us/library/ms525560.aspx)。

话虽如此 - 创建一个异步调用可能是做你想做的事情的最佳方式。 `Response.Flush`只需将输出缓冲区刷新到客户端，异步调用将允许您触发日志记录调用，而不会影响客户端的加载时间。

请记住，在 ASP.NET 中页面生命周期期间进行的异步调用可能不会及时返回，以便您对响应执行任何操作。

# c# - 允许用户通过 Response.WriteFile() 从我的站点下载

> ID：1024910
> 
> 赞同：0
> 
> 时间：2009-06-21T22:42:09.813
> 
> 标签：c#, asp.net

我正在尝试通过单击我网站上的链接以编程方式下载文件（它是位于我的网络服务器上的 .doc 文件）。这是我的代码：

```
string File = Server.MapPath(@"filename.doc");
string FileName = "filename.doc";

if (System.IO.File.Exists(FileName))
{

    FileInfo fileInfo = new FileInfo(File);
    long Length = fileInfo.Length;

    Response.ContentType = "Application/msword";
    Response.AddHeader("Content-Disposition", "attachment; filename=" + fileInfo.Name);
    Response.AddHeader("Content-Length", Length.ToString());
    Response.WriteFile(fileInfo.FullName);
} 
```

这是在 buttonclick 事件处理程序中。好的，我可以对文件路径/文件名代码做一些事情以使其更整洁，但是当单击按钮时，页面会刷新。在 localhost 上，此代码工作正常，并允许我下载文件 ok。我究竟做错了什么？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T23:54:23.957

除了拥有按钮单击事件处理程序之外，您还可以拥有一个可以链接到的 download.aspx 页面。

然后，此页面可以在页面加载事件中包含您的代码。还要添加 Response.Clear(); 在您的 Response.ContentType = "Application/msword"; 行并添加 Response.End(); 在您的 Response.WriteFile(fileInfo.FullName); 线。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T22:59:27.297

哦，你不应该在按钮单击事件处理程序中这样做。我建议将整个内容移至 HTTP 处理程序 ( `.ashx`) 并使用`Response.Redirect`或任何其他重定向方法将用户带到该页面。[我对这个问题的回答提供了一个示例](https://stackoverflow.com/questions/873207/force-download-of-a-file-on-web-server-asp-net-c/873228#873228)。

如果您仍想在事件处理程序中执行此操作。确保`Response.End`在写出文件后进行呼叫。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T19:50:29.190

尝试稍微修改的版本：

```
string File = Server.MapPath(@"filename.doc");
string FileName = "filename.doc";

if (System.IO.File.Exists(FileName))
{

    FileInfo fileInfo = new FileInfo(File);

    Response.Clear();
    Response.ContentType = "Application/msword";
    Response.AddHeader("Content-Disposition", "attachment; filename=" + fileInfo.Name);
    Response.WriteFile(fileInfo.FullName);
    Response.End();
} 
```

# algorithm - 比较三维结构

> ID：1024915
> 
> 赞同：5
> 
> 时间：2009-06-21T22:43:58.857
> 
> 标签：algorithm, math, hash, 3d, geometry

我需要通过查找和比较适当的几何散列来评估两组 3d 点是否相同（忽略平移和旋转）。我对几何散列技术进行了一些论文研究，发现了一些算法，但是它们往往因“视觉要求”而变得复杂（例如 2d 到 3d、遮挡、阴影等）。

此外，我希望这两个几何形状略有不同，哈希值也不会有很大不同。

有谁知道一些适合我需要的算法，并且可以提供一些链接以供进一步研究？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T23:35:47.613

您的第一个想法可能是试图找到将一个对象映射到另一个对象的旋转，但这是一个非常复杂的主题......实际上并不是必需的！你不是在问如何最好地匹配这两者，你只是在问它们是否相同。

通过所有点间距离的列表来表征您的模型。按该距离对列表进行排序。现在比较每个对象的列表。它们应该是相同的，因为点间距离不受平移或旋转的影响。

三个问题：

1）如果点的数量很大，那是一个很大的对列表（N *（N-1）/ 2）。在这种情况下，您可以选择只保留最长的那些，或者更好的是，为每个顶点保留 1 或 2 个最长的，这样模型的每个部分都有一些贡献。然而，丢弃这样的信息会将问题改变为概率性而非确定性。

2）这仅使用顶点来定义形状，而不是边缘。这可能很好（实际上也可以），但如果您希望图形具有相同的顶点但不同的连接边。如果是这样，首先测试顶点相似度。如果通过，则使用该排序距离为每个顶点分配唯一标签。最长的边有两个顶点。对于每个 THOSE 顶点，找到具有最长（剩余）边的顶点。标记第一个顶点 0 和下一个顶点 1。按顺序重复其他顶点，您将分配与移位和旋转无关的标签。现在您可以准确地比较边拓扑（检查对象 1 中两个顶点之间的每条边，对象 2 中相同的两个顶点之间是否有对应的边）注意：

3) 有可能两个图形具有相同的边长总体，但它们并不相同。当一个对象是另一个对象的镜像时，这是正确的。这很烦人！一种方法是使用四个非共面点（可能是上一步中标记为 0 到 3 的点）并比较它们定义的坐标系的“用手习惯”。如果左右手不匹配，则对象为镜像。

请注意，距离列表可让您轻松拒绝不同的对象。它还允许您通过在订购中允许一定数量的错误来添加“模糊”接受。也许将两个列表之间的均方根差异作为“相似性度量”会很好。

编辑：看起来你的问题是没有边缘的点云。那么边缘对应的烦人问题（#2）甚至不适用，可以忽略！不过，您仍然必须小心镜像问题#3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-21T23:03:29.770

对我来说似乎是一个数值优化问题。您想找到将一组点转换为尽可能接近另一组的转换参数。定义某种残差或“能量”，当点重合时最小化，并将其放在一些最小二乘优化器或类似的地方。如果它设法将分数优化为零（或考虑到浮点误差，尽可能接近），那么分数是相同的。

谷歌搜索

```
least squares rotation translation 
```

出现了很多基于这种技术的论文（例如[“两点模式之间转换参数的最小二乘估计”](http://www.stanford.edu/class/cs273/refs/umeyama.pdf)）。

更新以下评论：如果不知道点之间的一一对应关系（如上面的论文所假设），那么您只需要确保最小化的分数与点顺序无关。例如，如果您将这些点视为小质量（有限半径球体以避免零距离爆炸）并着手通过优化平移和旋转参数来最小化系统的总引力能，那应该可行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T23:05:56.583

有一堆 SIGGRAPH 出版物可能对您有所帮助。

例如，Brown 和 Rusinkiewicz 的“3-D 扫描的全局非刚性对齐”：

[http://portal.acm.org/citation.cfm?id=1276404](http://portal.acm.org/citation.cfm?id=1276404)

可以帮助您入门的一般搜索：

[http://scholar.google.com/scholar?q=siggraph+point+cloud+registration](http://scholar.google.com/scholar?q=siggraph+point+cloud+registration)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T23:16:10.743

[旋转图像](http://www.ri.cmu.edu/publication_view.html?pub_id=559)是一种方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-22T12:51:28.870

1.  如果要**估计两个相似点云之间的刚性变换**，可以使用完善的 **迭代最近点**方法。该方法从对变换的粗略估计开始，然后通过计算最近邻和最小化相关成本函数来迭代优化变换。它可以有效地实现（甚至是实时的），并且有可用于 matlab、c++ 的实现......这个方法已经被扩展并且有几个变体，包括估计非刚性变形，如果你对扩展感兴趣，你应该看看 Computer解决扫描配准问题的图形文件，这是您的问题的关键一步。有关起点，请参阅[迭代最近点上的 Wikipedia 页面](http://en.wikipedia.org/wiki/Iterative_Closest_Point) 其中有几个很好的外部链接。只是一个来自[matlab 实现](http://www.mathworks.com/matlabcentral/fileexchange/12627)的预告图像，旨在匹配点云：（ [来源：][[mathworks.com](http://www.mathworks.com/matlabcentral/fx_files/12627/1/icp.gif)][）][![替代文字](../Images/c3ad99115e465a2c44f963393b3b75cf.png)](https://i.stack.imgur.com/Xd7MB.gif)

    对齐后，您可以通过最终的误差测量来说明两个点云的相似程度，但这在很大程度上是一种临时解决方案，应该有更好的解决方案。

2.  使用**形状描述符**可以计算在平移/旋转下通常不变的形状的指纹。在大多数情况下，它们是为网格定义的，而不是点云，但是有大量的形状描述符，因此根据您的输入和要求，您可能会发现一些有用的东西。为此，您需要研究[形状分析](http://en.wikipedia.org/wiki/Shape_analysis)领域，并且可能[这个 2004 年 SIGGRAPH 课程演示文稿](http://www.cs.jhu.edu/~misha/MyPapers/SIG04Course.zip)可以让您了解人们如何计算形状描述符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-22T13:04:52.057

也许您还应该阅读 RANSAC 算法。它通常用于将全景图像拼接在一起，这似乎与您的问题有点相似，只是在二维中。只需谷歌搜索 RANSAC、全景图和/或拼接即可获得起点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-22T22:16:18.430

我会这样做：

1.  将组定位在质心
2.  计算[惯性张量](http://en.wikipedia.org/wiki/Moment_of_inertia)。这为您提供了三个坐标轴。向他们旋转。[*]
3.  按照给定的顺序（例如，从上到下、从左到右）以所需的精度写下点列表。
4.  对结果数组应用您想要的任何算法。

要比较两个集合，除非您需要提前存储哈希结果，否则只需将您喜欢的比较算法应用于步骤 3 的点集合。例如，这可以是计算两个集合之间的距离。

我不确定是否可以向您推荐第 4 步的算法，因为您的要求似乎是矛盾的。任何称为*散列*的东西通常具有输入的微小变化会导致非常不同的输出的特性。无论如何，现在我已经将问题简化为一组数字，所以你应该能够弄清楚。

[*] 如果您的两个或三个轴重合，则通过其他方式选择坐标，例如最长距离。但这对于随机点来说极为罕见。

# ruby-on-rails - 先环境还是先启动？

> ID：1024916
> 
> 赞同：1
> 
> 时间：2009-06-21T22:45:28.900
> 
> 标签：ruby-on-rails, ruby, initialization

environment.rb 以此开头：

```
RAILS_GEM_VERSION = '2.3.2' unless defined? RAILS_GEM_VERSION
require File.join(File.dirname(__FILE__), 'boot')
Rails::Initializer.run do |config| 
```

这是否意味着 environment.rb 先启动并调用 boot.rb？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T22:58:23.510

environment.rb 是主要的 Rails 环境文件。它需要 boot.rb 文件，但 boot.rb 在 Rails::Initializer.run 之前运行。实际上，boot.rb 的最后一行包含以下语句

```
# All that for this:
Rails.boot! 
```

请注意，虽然 environment.rb 文件属于您的 Rails 应用程序，但 boot.rb 文件会在您每次运行 rake 任务时自动更新

```
rake update:rails 
```

您永远不应该修改该文件。

为了更好地理解 Rails 初始化是如何工作的，Sven 写了一篇很有帮助的文章，名为[“从滑翔伞的角度来看 Rails 启动过程”](http://www.artweb-design.de/2007/12/2/the-rails-startup-process-a-paragliders-perspective)。

# sql-server - SQL Server 2000 - 我的查询突然运行缓慢

> ID：1024917
> 
> 赞同：1
> 
> 时间：2009-06-21T22:46:19.743
> 
> 标签：sql-server, sql-server-2000

我的数据库查询一直运行得非常快，直到最近它变得非常慢。除了正常的数据增长外，数据库中没有发生任何变化。

我注意到数据库统计信息“从未”更新过。

有没有一种简单的方法可以更新整个数据库中的这些统计信息，以便查看是否是问题所在？

我正在使用 SQL Server 2000 Sp4。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T22:51:42.913

你可以用这个

```
CREATE PROC usp_UPDATE_STATISTICS
(@dbName sysname, @sample int)
AS

SET NOCOUNT ON

DECLARE @SQL nvarchar(4000)
DECLARE @ID int
DECLARE @TableName sysname
DECLARE @RowCnt int

CREATE TABLE ##Tables
(
 TableID INT IDENTITY(1, 1) NOT NULL, 
 TableName SYSNAME NOT NULL
)

SET @SQL = ''
SET @SQL = @SQL + 'INSERT INTO ##Tables (TableName) '
SET @SQL = @SQL + 'SELECT [name] '
SET @SQL = @SQL + 'FROM ' + @dbName + '.dbo.sysobjects ' 
SET @SQL = @SQL + 'WHERE xtype = ''U'' AND [name] <> ''dtproperties'''

EXEC sp_executesql @statement = @SQL

SELECT TOP 1 @ID = TableID, @TableName = TableName
FROM ##Tables
ORDER BY TableID

SET @RowCnt = @@ROWCOUNT

WHILE @RowCnt <> 0
BEGIN

 SET @SQL = 'UPDATE STATISTICS ' + @dbname + '.dbo.[' + @TableName + '] WITH SAMPLE ' + CONVERT(varchar(3), @sample) + ' PERCENT'

 EXEC sp_executesql @statement = @SQL

 SELECT TOP 1 @ID = TableID, @TableName = TableName
 FROM ##Tables
 WHERE TableID > @ID
 ORDER BY TableID

 SET @RowCnt = @@ROWCOUNT

END

DROP TABLE ##Tables

GO 
```

这将更新数据库中所有表的统计信息。您还应该查看索引和重建/碎片整理作为 nexessary

拉吉

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T22:50:50.140

[在这里](http://msdn.microsoft.com/en-us/library/aa260645%28SQL.80%29.aspx)试试

这应该会加快您的索引和密钥分配。重新分析表统计信息可以优化 SQL Server 对查询的索引选择，尤其是对于大型数据集

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T22:51:31.917

绝对让自己每周执行一项任务，自动运行以更新数据库的统计信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-21T22:57:31.047

**正常的数据增长**足以证明几乎所有未优化查询的放缓是合理的。

在数据量增长之前，与数据库大小相关的可扩展性问题不会出现。

发布您的查询 + 粗略的数据量，我们将帮助您查看是什么。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-21T23:05:29.593

我们在 MSSQL 2005 中遇到了非常相似的问题，并且查询运行速度突然变慢。

以下是我们解决它的方法：我们为查询中的每个 select 语句添加了 (nolock)。例如：

```
select count(*) from SalesHistory with(nolock) 
```

请注意，还应将 nolock 添加到嵌套的 select 语句以及连接中。这是一篇文章，详细介绍了使用 nolock 时如何提高性能。[http://www.mollerus.net/tom/blog/2008/03/using_mssqls_nolock_for_faster_queries.html](http://www.mollerus.net/tom/blog/2008/03/using_mssqls_nolock_for_faster_queries.html)

显然不要忘记保留原始查询的备份。请试一试，让我知道。

# php - Switch 语句和 isset

> ID：1024918
> 
> 赞同：0
> 
> 时间：2009-06-21T22:46:27.310
> 
> 标签：php, switch-statement

由于几个月前我的网站充满了通知错误，所以我现在正在尝试修复代码。我想有一些php更新。我对 php 不太了解，所以：

```
switch ( (isset($_GET['action'])) ) {

case "delete":
delete();
break;

} 
```

当我添加 isset 时，这将不起作用。

你不能在函数中使用 isset 吗？我真的不知道，所以我问你们知道这些事情的人。

干杯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-21T22:50:56.660

isset 返回一个布尔值（参见[isset 手册页](http://nl3.php.net/manual/en/function.isset.php)）。您的情况将不起作用，因为“已删除”不是有效的布尔值（我认为它评估为 true，但仍然如此）。

您应该先检查它是否已设置，然后切换：

```
if(isset($_GET['action')) {
  switch ( $_GET['action']) ) {
    case "delete":
      delete();
      break;
  }
} else {
  ...
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-21T22:47:38.977

那是因为[`isset`](http://us3.php.net/manual/en/function.isset.php)返回`true`or `false`，而不是字符串（这是您的`case`语句所期望的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T22:49:15.010

isset() 返回布尔值（真或假）。您想在切换之前调用 isset() 。例子：

```
if (isset($_GET['action']))
{
  switch($_GET['action'])
  {
    ...
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T22:49:18.487

在进入开关之前，您需要检查 isset()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-15T16:41:59.320

> if ( isset($_GET['action'])){
> 
> > ```
> >  switch($_GET['action']){
> >         case "login":
> >         $nowfile = 'pages/login.php';
> >         break;
> >     }
> > if (file_exists($nowfile)){
> >     include($nowfile);
> > }else{
> >     echo "<b>Achtung:</b> Die file $nowfile existiert nicht";
> > } 
> > ```
> > 
> > }

# cocoa - 重命名 NSMutableDictionary 中的键

> ID：1024938
> 
> 赞同：1
> 
> 时间：2009-06-21T22:56:14.073
> 
> 标签：cocoa

给定一个 NSMutableDictionary *dict，这是用新名称替换键的坏方法吗？有没有更简单的方法？

```
NSArray *originalField = [NSArray arrayWithObjects:@"oldkey", @"oldkey2", nil];

NSArray *replacedField = [NSArray arrayWithObjects:@"newkey", @"newkey2", nil];

for (int i=0; i<[originalField count]; ++i)
{
    if ([dict objectForKey:[originalField objectAtIndex:i]] != nil) {
        [dict setObject:[dict objectForKey:[originalField objectAtIndex:i]] forKey:[replacedField objectAtIndex:i]];
        [dict removeObjectForKey:[originalField objectAtIndex:i]];
    }
} 
```

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-21T23:40:24.547

不，差不多就是这样。通常，您会使用快速枚举和/或 NSEnumerator 来遍历数组，而不是逐个索引，但是由于您要遍历两个并行数组，因此索引是最清晰的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T06:58:06.120

这本身并不是一个*坏*方法，但是您当然可以通过稍微清理代码并消除一些冗余的方法调用来使其更优雅（在我看来，更容易）。正如**@Peter**建议的那样，快速枚举（您可以在 Leopard+ 或 iPhone 上使用它）会更快、更干净，因此通常更可取。这是一个例子：

```
NSArray *originalField = [NSArray arrayWithObjects:@"oldkey", @"oldkey2", nil];
NSArray *replacedField = [NSArray arrayWithObjects:@"newkey", @"newkey2", nil];
id anObject;
NSEnumerator *replacementKeys = [replacedField objectEnumerator];
for (id originalKey in originalField) {
    if ((anObject = [dict objectForKey:originalKey]) != nil) {
        [dict removeObjectForKey:originalKey];
        [dict setObject:anObject forKey:[replacementKeys nextObject]];
    }
} 
```

一个警告说明：您需要确保数组`originalField`和`replacedField`的长度相同。如果后者更短，你会得到一个异常，来自`-[NSEnumerator nextObject]`或`-[NSArray objectAtIndex:]`。如果后者更长，您可能想知道为什么某些替换密钥从未使用过。您可以在调试期间使用[NSAssert 宏](http://developer.apple.com/documentation/Cocoa/Conceptual/Assertions/)来验证这一点，并且它将在发布版本中自动禁用。

或者，如果键之间确实存在一对一的关系，也许您可​​以使用字典从旧键映射到新键，并枚举`-[NSDictionary allKeys]`.

# c# - 如何在 OOP 中组织字符串集合？

> ID：1024945
> 
> 赞同：2
> 
> 时间：2009-06-21T22:58:16.753
> 
> 标签：c#, .net

我正在编写一个将命令行命令发送到第 3 方应用程序的应用程序。

所以我有一个命令列表，例如：

```
"process images"
"apply effect blur"
"save as png"
... 
```

我不知道如何以 OOP 风格最好地组织它们。

现在我有：

```
switch ( e.KeyCode )
{
    case Keys.A:
        SendCommand ( "process images" );
        break;
    case Keys.B:
        SendCommand ( "apply effect blur" );
        break;
    case Keys.C:
        SendCommand ( "save as png" );
        break;
        ...
} 
```

我希望能够以一种干净的方式做到这一点。也许像：

`SendCommand (Commands.ApplyBlur)`， ETC。

但我不知道哪种方式最好。我想将这些存储在一个集合中，但认为这不明确或不合理。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-21T23:25:01.473

我建议使用字典在输入和命令之间进行映射。最简单的解决方案是直接在键和命令文本之间进行映射。

```
Dictionary<ConsoleKey, String> map = new Dictionary<ConsoleKey, String>() 
{
    { ConsoleKey.A, "process image" },
    { ConsoleKey.B, "apply blur effect" },
    { ConsoleKey.C, "save as png" } 
};

ConsoleKey key = Console.ReadKey().Key;

String command;
if (map.TryGetValue(key, out command))
{
    SendCommand(command);
}
else
{
    HandleInvalidInput();
} 
```

根据您的实际需要，执行两步映射可能是一种更简洁的解决方案 - 从输入键到枚举值，以及从枚举值到命令文本。您还应该考虑创建一个命令类并为您的命令提供静态实例。

```
public class Command
{
    public Command(String commandText)
    {
        this.CommandText = commandText;
    }

    public String CommandText { get; private set; }

    public void Send()
    {
        // Dummy implementation.
        Console.WriteLine(this.CommandText);
    }

    // Static command instances.
    public static readonly Command ProcessImage = new Command("process image");
    public static readonly Command BlurImage = new Command("apply blur effect");
    public static readonly Command SaveImagePng = new Command("save as png");
} 
```

使用此类，发送命令的代码将如下所示。

```
Dictionary<ConsoleKey, Command> map = new Dictionary<ConsoleKey, Command>() 
{
    { ConsoleKey.A, Command.ProcessImage },
    { ConsoleKey.B, Command.BlurImage},
    { ConsoleKey.C, Command.SaveImagePng } 
};

ConsoleKey key = Console.ReadKey().Key;

Command command;
if (map.TryGetValue(key, out command))
{
    command.Send();
}
else
{
    HandleInvalidInput();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T23:06:50.420

我刚刚开始了解设计模式，但这似乎非常适合[Command Pattern](http://en.wikipedia.org/wiki/Command_pattern)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-21T23:20:44.807

所以这是我的假设，第 3 方应用程序有一组有限且静态的命令开关，您不会弄乱这组开关，只需将它们提供给应用程序。

在我看来，如果这些假设是正确的，那么命令模式就太过分了，我只是倾向于创建一个静态 Command(s) 类，它简单地将字符串公开为静态属性或常量，并包含静态发送命令方法。

所以你可以简单地按照你的建议写......

```
Command.SendCommand(Command.ProcessImages); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T23:07:02.680

您可以使用[命令模式](http://en.wikipedia.org/wiki/Command_pattern)来允许您将每个命令放在它自己的类中。这也将允许您从程序中的多个位置访问命令，而无需在每次您想做某事时重写或复制和粘贴代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-01T04:11:23.077

将您的命令名称放入枚举类型可能是有益的，因此使用您的命令类的其他程序员不必知道要发送的确切文本命令，他们可以使用 Visual Studio 中的自动完成从一组中选择它

```
public enum CommandType
{        
    ApplyBlur,
    ProcessImage,
    Save
} 
```

# java - 您如何继续学习企业 Java 应用程序服务器？

> ID：1024948
> 
> 赞同：0
> 
> 时间：2009-06-21T22:59:21.183
> 
> 标签：java, jboss

好吧，这个问题可能很广泛。我们一直在研究 Jboss 和其他一些类似的应用程序。服务器。

从功能列表来看，它非常适合替换我们即将在服务器端过时的本土报告应用程序。但在这一点上，对于 2 位开发人员来说，仅仅掌握所有的设置、配置、管理、调优、测试，更不用说 API 和编程本身，似乎太多、太大、太复杂了。

人们通过什么途径来熟悉此类应用服务器并提高工作效率？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T23:01:34.003

从一个简单的开始，如果你真的需要这些功能，只使用更复杂的。

例如，您真的需要完整的 JBoss 堆栈吗？Tomcat还不够吗？它的数量要少得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T23:01:48.010

我会像处理任何新事物一样处理这个问题。

从文档开始 - 阅读介绍和基本设置/配置文档。然后继续学习教程，也许还有一些我觉得有趣的简单应用程序。在您的情况下，也许将一些功能移植到新系统。随着时间的推移，您应该使用手头的工具变得更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T00:54:50.840

我会说使用 Java EE 的最低功能是：

1.  使用 JSTL 编写的 Servlet 和 JSP（无脚本）
2.  JDBC
3.  用于池化数据库连接的 JNDI（可选但推荐）
4.  用于安全的基本身份验证

仅知道这些，您就可以完成很多工作。如果你想最小化学习曲线，我建议从这些开始，远离 EJB、JMS、Struts、JSF 等。

另一个好处是，这部分功能对于 servlet/JSP 引擎（如 Tomcat、Jetty、Resin 等）和成熟的 Java EE 应用服务器（如 WebLogic、JBOSS、WebSphere 等）都是通用的。只要您远离特定于应用程序引擎的扩展，就可以移植到任何其他人。

你应该意识到这里有一个权衡。如果您更多地利用应用服务器，您将不得不开发可能更容易的部分。但希望你能从一些更简单的问题开始，一旦你对基础知识感到满意，你就会逐步提高。

还有另一种方法：聘请经验丰富的指南来帮助您进行第一个项目的培训和指导。与知名咨询公司进行为期六个月的工作可能会让您入门。

最后，我推荐Spring。它也有一个学习曲线，但它是 Java EE EJB 开发的一个很好的替代方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T01:03:42.960

根据我的经验，使用它是了解您喜欢/不喜欢它的最佳方式。一旦您为一个应用程序服务器设置了一个项目，将它迁移到另一个应用程序应该不会有*太多的工作。*我目前正在开发一个我们每天使用简单的 Tomcat v6 服务器开发和测试的应用程序，但它在 Websphere Application Server 和 JBoss 上都在生产环境中运行。

作为开发的附注，我强烈建议您考虑通过服务器适配器将您的 Eclipse 开发环境与您选择的应用程序服务器集成——这将大大加快开发任务并简化调试过程。

# php - 我应该为所有不同的交互实例化新对象吗？

> ID：1024950
> 
> 赞同：1
> 
> 时间：2009-06-21T22:59:55.177
> 
> 标签：php, oop

我很难掌握对象的这些概念以及它们应该如何交互/存在。

例如，我是否应该有不同的对象（好吧，如果有任何区别，我的意思是与数据库的连接）在它们不相关时与我的数据库进行交互？

假设我有一个 index.php 用于从数据库中获取和显示内容的对象和另一个用户用于在数据库中添加/删除内容的对象。我们可以说这些对象都是 dbinteract 类的所有对象，它包含所有用于处理数据库的函数。

或者我是否应该将这些类划分为：dbconnection、dbdisplay、dbinsertion、dbmodification，我将 dbconnection 发送到其他对象？

我觉得我错过了一些非常明显的东西，并且在不知道思考过程中哪里出错的情况下尝试前进令人沮丧，我想我在这里寻找一个问题以及一个答案。

## 索引.php

```
$connection = new dbconnection();
$displayer = new dbdisplay();

$activeconnection = $connection->connecttodatabase();
$pagetodisplay = $connection->getcontentofpagetodisplay($query);
$displayer->displayPage($activeconnection, $pagetodisplay); 
```

## 用户插入.php

```
$inserter = new dbinsert();
$usersdbconnection = new dbconnection();

$inserter->newPost($userdbconnection, $usercredentials, $posttextfromuser);
$usersdbconnection->closedatabaseconnection(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T23:13:32.247

对我来说，您似乎缺少的是面向对象编程不是为了让您按照其规则做额外的工作，而是为了让您的生活更轻松。如果它没有让你的生活更轻松，那你就错了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-26T11:05:21.227

您似乎在错误的抽象级别上思考。OOP 允许您考虑“用户”和“文章”，而不是“数据库连接”和“页面”。

我不确定我是否完全理解这个问题——我认为你的问题是“哪个对象应该负责连接到数据库？”。创建到数据库的连接只需要完成一次。然后可以在所有对象之间共享此连接。要共享连接，您需要创建一个所有其他连接到数据库的类都可以继承的类，以及`static`该类中的一个变量，以确保只存在一个连接对象。

在其他语言中`static`，变量通常称为`class`变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T23:50:56.990

有时书比上网更好，我发现这本书真的很有用。这些示例倾向于 java，但可以应用于任何语言

[http://oreilly.com/catalog/9780596008673/](http://oreilly.com/catalog/9780596008673/)

# c - 我的基于 AMD 的机器是使用小端还是大端？

> ID：1024951
> 
> 赞同：34
> 
> 时间：2009-06-21T23:00:12.100
> 
> 标签：c, x86, intel, endianness, amd-processor

我正在学习计算机系统课程，并且我正在尝试*确定*我的基于 AMD 的计算机是否是 little-endian 机器？我相信这是因为它将与英特尔兼容。

具体来说，我的处理器是 AMD 64 Athlon x2。

我知道这在 C 编程中很重要。我正在编写 C 程序，而我正在使用的方法会受此影响。我试图弄清楚如果我在基于英特尔的机器上运行程序（假设**是**小端机器）是否会得到相同的结果。

最后，让我问这个问题：任何和所有能够运行 Windows（XP、Vista、2000、Server 2003 等）以及比如说[Ubuntu Linux 桌面](http://www.ubuntu.com/getubuntu/download)的机器都是小端的吗？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-06-21T23:01:14.110

所有 x86 和 x86-64 机器（它只是 x86 的扩展）都是 little-endian。

您可以通过以下方式确认：

```
#include <stdio.h>
int main() {
    int a = 0x12345678;
    unsigned char *c = (unsigned char*)(&a);
    if (*c == 0x78) {
       printf("little-endian\n");
    } else {
       printf("big-endian\n");
    }
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-06-21T23:15:45.750

[在用 C 编写与字节序无关的代码一](http://www.ibm.com/developerworks/aix/library/au-endianc/index.html?ca=drs-)文中列出了一种了解字节序的简单方法

```
const int i = 1;
#define is_bigendian() ( (*(char*)&i) == 0 ) 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-24T04:38:58.337

Assuming you have Python installed, you can run this one-liner, which will print "little" on little-endian machines and "big" on big-endian ones:

```
python -c "import struct; print 'little' if ord(struct.pack('L', 1)[0]) else 'big'" 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-06-21T23:38:58.200

“英特尔兼容”不是很精确。

英特尔曾经制造过大端处理器，尤其是 StrongARM 和 XScale。这些不使用通常称为 x86 的 IA32 ISA。

再往前看，英特尔还制造了不兼容 x86 的 little-endian i860 和 i960。

再往前看，x86 的前身（8080、8008 等）也不兼容 x86。作为 8 位处理器，字节顺序并不重要......

现在Intel还在做Itanium（IA64），它是bi-endian：正常运行是big-endian，但处理器也可以运行在little-endian模式。它确实能够在 little-endian 模式下运行 x86 代码，但本机 ISA 不是 IA32。

据我所知，AMD 的所有处理器都与 x86 兼容，并带有一些扩展，例如 x86_64，因此必然是 little-endian。

Ubuntu 可用于 x86 (little-endian) 和 x86_64 (little-endian)，对于 ia64 (big-endian)、ARM(el) (little-endian)、PA-RISC (big-endian) 的端口不太完整，尽管处理器同时支持）、PowerPC（大端）和 SPARC（大端）。我不相信有 ARM(eb)（大端）端口。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-21T23:06:12.417

在回答你的最后一个问题时，答案是否定的。Linux 能够在大端机器上运行，例如老一代的 PowerMacs。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-21T23:14:17.283

您必须下载专为大端机器设计的 Ubuntu 版本。我只知道[PowerPC](https://wiki.ubuntu.com/PowerPCDownloads)版本。我相信您可以找到一些具有更通用的大端实现的地方。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-01-10T14:18:01.147

下面的代码片段有效：

```
#include <stdio.h>

int is_little_endian() {
  short x = 0x0100; //256
  char *p = (char*) &x;
  if (p[0] == 0) {
    return 1;
  }
  return 0;
}

int main() {
  if (is_little_endian()) {
    printf("Little endian machine\n");
  } else printf("Big endian machine\n");
  return 0;
} 
```

代码中的“短”整数为 0x0100（十进制为 256），长度为 2 个字节。最低有效字节为 00，最高有效字节为 01。Little endian 排序将最低有效字节放在变量的地址中。所以它只是检查变量指针指向的地址的字节值是否为0。如果为0，则为小端字节序，否则为大端字节序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-12T00:52:59.070

```
/* by Linas Samusas  */

#ifndef _bitorder 
#define _bitorder 0x0008

#if (_bitorder > 8)
#define BE
#else
#define LE
#endif 
```

并使用它

```
#ifdef LE
#define Function_Convert_to_be_16(value)  real_function_to_be_16(value)
#define Function_Convert_to_be_32(value)  real_function_to_be_32(value)
#define Function_Convert_to_be_64(value)  real_function_to_be_64(value)
#else
#define Function_Convert_to_be_16
#define Function_Convert_to_be_32
#define Function_Convert_to_be_64
#endif 
```

如果

```
unsigned long number1 = Function_Convert_to_be_16(number2); 
```

*macro 会调用真正的函数并转换为 BE

如果是

```
unsigned long number1 = Function_Convert_to_be_16(number2); 
```

*宏将被定义为单词而不是函数，并且您的数字将在括号之间

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-02-10T11:39:02.087

我们现在有`std::endian`！

```
constexpr bool is_little = std::endian::native == std::endian::little; 
```

[https://en.cppreference.com/w/cpp/types/endian](https://en.cppreference.com/w/cpp/types/endian)

# lua - 你如何在魔兽世界中使用lua中的两个表情组合？

> ID：1024960
> 
> 赞同：7
> 
> 时间：2009-06-21T23:03:28.117
> 
> 标签：lua, world-of-warcraft

你如何在魔兽世界中使用lua中的两个表情组合？

```
function Button2_OnClick()
    PlaySoundFile("Interface\\Addons\\Fart\\common_fart[1].wav");
    DoEmote("moon");
    DoEmote("sit");
    DoEmote("dance");
    DoEmote("beckon");
end 
```

我正在使用 Wow Addon Studio 在 Wow 上制作一个放屁应用程序。我用了这个功能，只有坐姿显示，招手和月亮只显示在聊天窗口。舞蹈表情没有出现在任何地方。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-30T00:44:43.150

暴雪明确禁止任何可以用来让 lua 等待或暂停的东西，因为它是制作金矿或研磨机器人的必要成分。

在不使用所有 CPU 的情况下，没有一种本机（即仅 lua）方式让 lua 等待。在 WOW 客户端之外，您可以使用[win.sleep](https://stackoverflow.com/questions/1034334/easiest-way-to-make-lua-script-wait-pause-sleep-block-for-a-few-seconds)或其他调用主机应用程序或操作系统线程函数的第三方 API 调用。

可以通过在频繁事件（例如到达聊天窗口的文本）上执行代码来模拟等待，然后在事件处理程序中检查是否有足够的时间允许执行序列中的下一个命令。这可能不是一个非常准确的计时器，而且会相当复杂，因为您必须创建一个数据结构来保存命令序列、每个命令之间的时间、当前命令等等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-22T21:52:37.383

This may be an intentional limitation of the API to prevent in game automation (botting).

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-04T19:50:03.693

对我有用的是拥有一个通过循环递增的全局变量。如

```
Integer count = 0;
function Button2_OnClick()
    i++
    switch
    case(1)
        PlaySoundFile("Interface\\Addons\\Fart\\common_fart[1].wav");
    case(2)
         DoEmote("moon");
    case(3)
         DoEmote("sit");
    case(4)
         DoEmote("dance");
    case(5)
         DoEmote("beckon");
    default
         i=0;
    end
end 
```

然后你必须做的是多次单击按钮，但你会得到你想要的效果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-22T21:30:29.193

我建议你等一段时间再做下一个表情。据我所知，如果您发送过多垃圾邮件，服务器会断开您的连接。这有时*可能*只是触发它。

除此之外，我想也许客户有办法阻止它？无论哪种情况，我都建议您在表情之间添加某种秒级延迟。

干杯，
阿米特罗恩

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-03T03:35:26.460

莫非最后两个不能坐着做？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-26T23:31:29.713

事实上，，`integer i = 0`因为定义整数 'count' 然后使用 i 是不正确的。:)

# .net - 在 AddInProcess 中激活 AddInToken 时控制 AppDomainSetup

> ID：1024965
> 
> 赞同：1
> 
> 时间：2009-06-21T23:05:05.057
> 
> 标签：.net, add-in, appdomain, system.addin

在 .net 中，可以在新的 AppDomain 中创建 AddIn。创建新的 AppDomain 并不是什么新鲜事，可以使用 AppDomainSetup 类来指定新创建的 AppDomain 的所有启动参数（例如在哪里可以找到 app.config）。但是，当使用新的 AddInProcess 激活 AddInToken（它指定 AddIn 应在一个全新的进程中实例化）时，无法直接访问将用于在新进程中创建 AppDomain 的 AppDomainSetup 参数。

有没有办法做到这一点？我真的需要能够强制我的新插件使用新的 app.config 设置，以及 AppDomain 上的各种其他自定义。

感谢您在这里的任何帮助...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-27T17:52:29.513

```
var addins = AddInStore.FindAddIns(typeof(AddInHostView), addInRoot);
foreach (var addin in addins)
{
    var addinInstance = addin.Activate<AddInHostView>(AddInSecurityLevel.FullTrust);

    // snip
    // do stuff
    // snip
} 
```

使用此代码（我了解 FullTrust 不好，但我的应用程序需要），我可以在每个目录中指定一个单独的 app.config（与 Addin 程序集命名相同）。

```
\AddIns
 \AddIn1
   AddIn1.dll
   AddIn1.dll.config 
```

# c++ - 64位移位问题

> ID：1024968
> 
> 赞同：5
> 
> 时间：2009-06-21T23:06:06.583
> 
> 标签：c++, 64-bit

为什么这段代码没有写 0 作为最后一个元素，而是 18446744073709551615？（用 g++ 编译）

```
#include <iostream>

using namespace std;
int main(){
    unsigned long long x = (unsigned long long) (-1);
    for(int i=0; i <= 64; i++)
        cout << i << " " << (x >> i) << endl;
    cout << (x >> 64) << endl;
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-21T23:11:49.817

当您将一个值移动的位数超过字长时，它**通常**会移动`mod word-size`. 基本上，将其移位 64 位意味着移位 0 位，这等于根本不移位。你不应该依赖它，因为它不是由标准定义的，它在不同的架构上可能会有所不同。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-21T23:11:40.143

将数字移动等于或大于其宽度的位数是未定义的行为。您只能在 0 到 63 个位置之间安全地移动 64 位整数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-21T23:11:51.173

编译器的这个警告应该是一个提示：

“警告：右移计数 >= 类型宽度”

这会导致未定义的行为：

[http://sourcefrog.n​​et/weblog/software/languages/C/bitshift.html](http://sourcefrog.net/weblog/software/languages/C/bitshift.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T23:11:36.603

好吧，你换了太多次了。您正在从 0 转移到 64（含），总共 65 次。您通常希望：

```
for(int i=0; i < 64; i++)
    .... 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T23:12:26.913

我得到：

```
test.c:8: warning: right shift count >= width of type 
```

所以也许这是未定义的行为？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-21T23:13:13.837

你溢出了班次。如果你注意到了，GCC 甚至会警告你：

```
警告：右移计数 >= 类型宽度
```

怎么来的？您将 64 作为有效班次包括在内，这是一种未定义的行为。从 0 到 64 有 65 个数字（包括 0）。0 是第一位（很像数组）。

```
#include <iostream>

using namespace std;
int main(){
    unsigned long long x = (unsigned long long) (-1);
    for(int i=0; i < 64; i++)
        cout << i << " " << (x >> i) << endl;
    cout << (x >> 63) << endl;
    return 0;
} 
```

将产生您期望的输出。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-07T07:01:44.993

您可以使用：

```
static inline pack_t lshift_fix64(pack_t shiftee, short_idx_t shifter){
  return (shiftee << shifter) & (-(shifter < 64));
} 
```

对于这样的伎俩，

```
(-(shifter < 64)) == 0xffff ffff ffff ffff 
```

如果移位器 < 64 并且

```
(-(shifter < 64)) == 0x0 
```

否则。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-21T23:21:19.687

对于 64 位类型，-1 的位模式在十六进制中看起来像 0xFFFFFFFFFFFFFFFF。因此，如果您将其打印为无符号变量，您将看到无符号 64 位变量可以容纳的最大值，即 18446744073709551615。

当移位时，我们不关心值在这种情况下的含义，即变量是有符号还是无符号都无关紧要，它的处理方式相同（在这种情况下将所有位向右移动一步）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-10-11T09:57:46.430

粗心的另一个陷阱：我知道这是一个旧线程，但我来这里寻求帮助。当我的意思是 1L<<k; 时，我在使用 1<<k 的 64 位机器上被抓住了；在这种情况下，编译器没有帮助:(

# image - Drawit 与像素

> ID：1024973
> 
> 赞同：0
> 
> 时间：2009-06-21T23:07:39.450
> 
> 标签：image, macos

[如果您必须在 Mac Drawit](http://www.bohemiancoding.com/drawit/index.html)（38 美元）或[Pixel](http://www.kanzelsberger.com/pixel/?page_id=5)（46美元）上的两个图像应用程序之间进行选择。Drawit 类似于 Adob​​e 烟花，而 Pixel 类似于 PhotoShop。你会选择哪个以及为什么。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T23:12:40.703

因为我主要为网络做网页设计或图形，所以我选择的应用程序是 Fireworks。它加载速度很快，支持矢量设计，网络导出，这是我习惯的！

我认为您需要决定将它用于什么以及您对任何一种产品都有什么经验。

希望有帮助。

乔什

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T23:12:26.977

取决于你想用它们做什么。我不认识他们中的任何一个，但我一直在使用 Fireworks 进行网页设计，这似乎与许多喜欢 Photoshop 的人相反。我主要使用 Photoshop 进行一些更高级的图像编辑。

# oz - 对 Mozart/Oz 编程语言的看法？

> ID：1024974
> 
> 赞同：54
> 
> 时间：2009-06-21T23:07:50.667
> 
> 标签：oz, mozart

我意识到 Oz 是一种相当晦涩的语言。我第一次听说它是在[Programming Language Shootout](http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=oz&lang2=oz)中。然后我找到[了这篇 Wikipedia 文章](http://en.wikipedia.org/wiki/Multi-paradigm_programming_language)，其中指出[Mozart/Oz](http://www.mozart-oz.org/)支持 8 种不同的范式。

所以我试了一下。有很多文档，除了我发现它非常混乱和缺乏。我找不到任何书籍或其他文档，也找不到几个例子。此外，它似乎与我不太习惯的 Emacs 紧密集成。

你对这种编程语言有什么看法：这完全是浪费时间吗？或者有人可以指点我一些好的资源等吗？

另外，我不想使用 Emacs。我是否有任何其他选项，例如交互式解释器或正常的编译运行周期？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-22T00:38:38.737

这是关于 Oz：[计算机编程的概念、技术和模型的](https://rads.stackoverflow.com/amzn/click/com/0262220695)*书*

然而，这本书远远超出了教授语言的范围。在 SICP 之后，有些人考虑在语言的“下一部圣经”中。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-07-18T14:43:18.043

学习 Mozart/Oz 可能是我大学毕业后最有价值的编程经历。但同时它也是最糟糕的，因为你不能在现实世界中真正使用它。（我什至认为他们因此将 Oz 从课程中删除，取而代之的是 C++、Java 和 Erlang 的混合体。）

因此，出于学术目的，它是一种很好的实验语言，可以用来学习新技术并成为“更好的”开发人员。

但是，由于开发的好处是即使您不会在 Mozart 系统上运行您的生产代码，您仍然可以从中窃取很多好的想法并用您选择的最喜欢的语言实现。看看 Jonas Bonér[在 scala](http://github.com/jboner/scala-dataflow/tree/master)（或[Ozma](http://lambda-the-ultimate.org/node/4300)）中实现数据流变量的工作。

至于其他资源，请在[**2G1512**](https://www.google.com/search?q=2G1512)[上进行谷歌搜索](https://www.google.com/search?q=2G1512)**并查找 pdf 格式的教程、实验和讲座。**

 *** * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-06-27T17:21:10.547

> *Mozart/Oz 支持八种不同的范式*

这是一篇简短的概述论文，它应该为您提供一些背景信息 -[傻瓜编程范式：每个程序员都应该知道的 (pdf)](http://www.info.ucl.ac.be/~pvr/VanRoyChapter.pdf)

> *你对这种编程语言有什么看法*

Mozart/Oz 让您有机会探索、学习和玩各种编程语言技术。

> *我也不想使用 Emacs；我是否有任何其他选项，例如交互式解释器或正常的编译运行周期？*

他们使用 Emacs 就像一个交互式解释器。

是的，您可以在文本编辑器中编写代码并[从命令行编译和运行](http://shootout.alioth.debian.org/u32/benchmark.php?test=threadring&lang=oz&id=1#log)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-11T22:17:26.950

根据线程[Mozart/Oz speed - Ruby 1.9 speed](http://shootout.alioth.debian.org/u32/benchmark.php?test=all&lang=oz&lang2=yarv)，它比“积极”改进的 Ruby 1.9 快得多。**

# sql-server - 使用 T-SQL 查找子字符串最后一次出现的索引

> ID：1024978
> 
> 赞同：148
> 
> 时间：2009-06-21T23:10:40.787
> 
> 标签：sql-server, string, tsql, search, sql-server-2000

有没有一种直接的方法可以使用 SQL 查找字符串最后一次出现的索引？我现在正在使用 SQL Server 2000。我基本上需要.NET`System.String.LastIndexOf`方法提供的功能。一点谷歌搜索揭示了这一点 -[检索最后一个索引的函数](http://www.sqlservercentral.com/scripts/T-SQL+Aids/31116/)- 但如果您传入“文本”列表达式，这将不起作用。仅当您要搜索的文本长度为 1 个字符时，在其他地方找到的其他解决方案才有效。

我可能不得不做一个功能。如果我这样做了，我会把它贴在这里，这样你们就可以看看它，也许可以利用它。

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2009-06-22T18:13:15.887

直截了当的方法？不，但我使用了相反的方法。字面上地。

在以前的例程中，为了找到给定字符串的最后一次出现，我使用了 REVERSE() 函数，然后是 CHARINDEX，然后再次使用 REVERSE 来恢复原始顺序。例如：

```
SELECT
   mf.name
  ,mf.physical_name
  ,reverse(left(reverse(physical_name), charindex('\', reverse(physical_name)) -1))
 from sys.master_files mf 
```

展示了如何从它们的“物理名称”中提取实际的数据库文件名，无论嵌套在子文件夹中的深度如何。这确实只搜索一个字符（反斜杠），但您可以在此基础上搜索更长的搜索字符串。

唯一的缺点是，我不知道这对 TEXT 数据类型的效果如何。我已经使用 SQL 2005 几年了，并且不再熟悉使用 TEXT ——但我似乎记得你可以使用 LEFT 和 RIGHT 吗？

菲利普

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2012-05-15T11:48:57.880

最简单的方法是......

```
REVERSE(SUBSTRING(REVERSE([field]),0,CHARINDEX('[expr]',REVERSE([field])))) 
```

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2013-12-04T07:24:35.957

如果您使用的是 Sqlserver 2005 或更高版本，`REVERSE`多次使用函数对性能不利，下面的代码效率更高。

```
DECLARE @FilePath VARCHAR(50) = 'My\Super\Long\String\With\Long\Words'
DECLARE @FindChar VARCHAR(1) = '\'

-- text before last slash
SELECT LEFT(@FilePath, LEN(@FilePath) - CHARINDEX(@FindChar,REVERSE(@FilePath))) AS Before
-- text after last slash
SELECT RIGHT(@FilePath, CHARINDEX(@FindChar,REVERSE(@FilePath))-1) AS After
-- the position of the last slash
SELECT LEN(@FilePath) - CHARINDEX(@FindChar,REVERSE(@FilePath)) + 1 AS LastOccuredAt 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-06-22T05:05:44.747

您仅限于文本数据类型[的一小部分函数](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-functions-transact-sql?view=sql-server-ver15)。

我只能建议从 开始`PATINDEX`，但从`DATALENGTH-1, DATALENGTH-2, DATALENGTH-3`etc 向后工作，直到得到结果或最终为零（DATALENGTH-DATALENGTH）

这真的是`SQL Server 2000`根本无法处理的事情。

**编辑其他答案**：REVERSE 不在 SQL Server 2000 中可用于文本数据的函数列表中

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2016-03-03T09:31:58.313

```
DECLARE @FilePath VARCHAR(50) = 'My\Super\Long\String\With\Long\Words'
DECLARE @FindChar VARCHAR(1) = '\'

SELECT LEN(@FilePath) - CHARINDEX(@FindChar,REVERSE(@FilePath)) AS LastOccuredAt 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-06-25T16:12:14.450

旧但仍然有效的问题，所以这是我根据其他人提供的信息创建的内容。

```
create function fnLastIndexOf(@text varChar(max),@char varchar(1))
returns int
as
begin
return len(@text) - charindex(@char, reverse(@text)) -1
end 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-05-01T15:13:43.670

这对我来说效果很好。

```
REVERSE(SUBSTRING(REVERSE([field]), CHARINDEX(REVERSE('[expr]'), REVERSE([field])) + DATALENGTH('[expr]'), DATALENGTH([field]))) 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-02-19T17:15:17.453

```
REVERSE(SUBSTRING(REVERSE(ap_description),CHARINDEX('.',REVERSE(ap_description)),len(ap_description))) 
```

对我来说效果更好

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-09-15T01:49:07.850

嗯，我知道这是一个旧线程，但统计表可以在 SQL2000（或任何其他数据库）中执行此操作：

```
DECLARE @str CHAR(21),
        @delim CHAR(1)
 SELECT @str = 'Your-delimited-string',
        @delim = '-'

SELECT
    MAX(n) As 'position'
FROM
    dbo._Tally
WHERE
    substring(@str, _Tally.n, 1) = @delim 
```

计数表只是一个递增数字表。

获取每个分隔符的`substring(@str, _Tally.n, 1) = @delim`位置，然后您只需获得该集中的最大位置。

理货表很棒。如果您以前没有使用过它们，那么[SQL Server Central](http://www.sqlservercentral.com/articles/T-SQL/62867/)上有一篇很好的文章。

*编辑：已删除`n <= LEN(TEXT_FIELD)`，因为您不能在 TEXT 类型上使用 LEN() 。只要`substring(...) = @delim`剩下虽然结果仍然是正确的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-10-26T23:06:28.853

这个答案使用 MS SQL Server 2008（我无权访问 MS SQL Server 2000），但我根据 OP 看到的方式是需要考虑的 3 种情况。从我在这里尝试过的没有答案涵盖了所有三个：

1.  返回给定字符串中搜索字符的最后一个索引。
2.  返回给定字符串中搜索子字符串（不仅仅是单个字符）的最后一个索引。
3.  如果搜索字符或子字符串不在给定字符串中，则返回`0`

我想出的函数需要 2 个参数：

`@String NVARCHAR(MAX)`: 要搜索的字符串

`@FindString NVARCHAR(MAX)`: 获取 in 的最后一个索引的单个字符或子字符串`@String`

它返回一个，要么是in`INT`的正索引，要么是不在的含义`@FindString``@String``0``@FindString``@String`

下面解释一下这个函数的作用：

1.  初始化`@ReturnVal`为`0`表示`@FindString`不在`@String`
2.  通过使用检查`@FindString`in的索引`@String``CHARINDEX()`
3.  `@FindString`如果in的索引`@String`是`0`，`@ReturnVal`则保留为`0`
4.  如果`@FindString`in的索引`@String`是`> 0`, `@FindString`is in所以它通过使用`@String`计算`@FindString`in的最后一个索引`@String``REVERSE()`
5.  返回`@ReturnVal`一个正数，它是 in 的最后一个索引， `@FindString`或者`@String`表示`0`不在`@FindString`in`@String`

这是创建函数脚本（复制和粘贴就绪）：

```
CREATE FUNCTION [dbo].[fn_LastIndexOf] 
(@String NVARCHAR(MAX)
, @FindString NVARCHAR(MAX))
RETURNS INT
AS 
BEGIN
    DECLARE @ReturnVal INT = 0
    IF CHARINDEX(@FindString,@String) > 0
        SET @ReturnVal = (SELECT LEN(@String) - 
        (CHARINDEX(REVERSE(@FindString),REVERSE(@String)) + 
        LEN(@FindString)) + 2)  
    RETURN @ReturnVal
END 
```

这里有一点可以方便地测试该功能：

```
DECLARE @TestString NVARCHAR(MAX) = 'My_sub2_Super_sub_Long_sub1_String_sub_With_sub_Long_sub_Words_sub2_'
, @TestFindString NVARCHAR(MAX) = 'sub'

SELECT dbo.fn_LastIndexOf(@TestString,@TestFindString) 
```

我只在 MS SQL Server 2008 上运行过它，因为我无法访问任何其他版本，但从我的研究来看，这至少对 2008+ 应该是好的。

享受。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-04-19T20:49:24.417

我意识到这是一个几年前的问题，但是......

上`Access 2010`，您可以使用它`InStrRev()`来执行此操作。希望这可以帮助。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-06-22T18:04:10.723

反转您的字符串和子字符串，然后搜索第一个匹配项。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-01-07T17:34:28.093

如果要获取单词字符串中最后一个空格的索引，可以使用这个表达式 RIGHT(name, (CHARINDEX(' ',REVERSE(name),0)) 来返回字符串中的最后一个单词。这个如果您想解析包含名字和/或中间名的首字母的全名的姓氏，这将很有帮助。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-12-03T01:23:42.930

其他一些答案返回一个实际的字符串，而我更需要知道实际的索引 int。这样做的答案似乎使事情过于复杂。使用其他一些答案作为灵感，我做了以下......

首先，我创建了一个函数：

```
CREATE FUNCTION [dbo].[LastIndexOf] (@stringToFind varchar(max), @stringToSearch varchar(max))
RETURNS INT
AS
BEGIN
    RETURN (LEN(@stringToSearch) - CHARINDEX(@stringToFind,REVERSE(@stringToSearch))) + 1
END
GO 
```

然后，在您的查询中，您可以简单地执行以下操作：

```
declare @stringToSearch varchar(max) = 'SomeText: SomeMoreText: SomeLastText'

select dbo.LastIndexOf(':', @stringToSearch) 
```

以上应返回 23（':' 的最后一个索引）

希望这对某人来说更容易一些！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-02-19T19:35:01.530

`@indexOf = <whatever characters you are searching for in your string>`

`@LastIndexOf = LEN([MyField]) - CHARINDEX(@indexOf, REVERSE([MyField]))`

尚未测试，由于索引为零，它可能会减一，但在`SUBSTRING`从`@indexOf`字符切到字符串末尾时可以正常工作

`SUBSTRING([MyField], 0, @LastIndexOf)`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-06-21T23:20:30.827

我知道这会效率低下，但是您是否考虑过将`text`字段转换为`varchar`以便可以使用您找到的网站提供的解决方案？我知道这个解决方案会产生问题，因为如果`text`字段中的长度超出了您的长度`varchar`（更不用说它的性能不是很好），您可能会截断记录。

由于您的数据位于`text`字段内（并且您使用的是 SQL Server 2000），因此您的选择是有限的。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-08-23T09:27:08.653

即使子字符串包含超过 1 个字符，此代码也有效。

```
DECLARE @FilePath VARCHAR(100) = 'My_sub_Super_sub_Long_sub_String_sub_With_sub_Long_sub_Words'
DECLARE @FindSubstring VARCHAR(5) = '_sub_'

-- Shows text before last substing
SELECT LEFT(@FilePath, LEN(@FilePath) - CHARINDEX(REVERSE(@FindSubstring), REVERSE(@FilePath)) - LEN(@FindSubstring) + 1) AS Before
-- Shows text after last substing
SELECT RIGHT(@FilePath, CHARINDEX(REVERSE(@FindSubstring), REVERSE(@FilePath)) -1) AS After
-- Shows the position of the last substing
SELECT LEN(@FilePath) - CHARINDEX(REVERSE(@FindSubstring), REVERSE(@FilePath)) AS LastOccuredAt 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-06-18T00:51:02.450

我需要在文件夹路径中找到反斜杠的倒数第 n 个位置。这是我的解决方案。

```
/*
http://stackoverflow.com/questions/1024978/find-index-of-last-occurrence-of-a-sub-string-using-t-sql/30904809#30904809
DROP FUNCTION dbo.GetLastIndexOf
*/
CREATE FUNCTION dbo.GetLastIndexOf
(
  @expressionToFind         VARCHAR(MAX)
  ,@expressionToSearch      VARCHAR(8000)
  ,@Occurrence              INT =  1        -- Find the nth last 
)
RETURNS INT
AS
BEGIN

    SELECT  @expressionToSearch = REVERSE(@expressionToSearch)

    DECLARE @LastIndexOf        INT = 0
            ,@IndexOfPartial    INT = -1
            ,@OriginalLength    INT = LEN(@expressionToSearch)
            ,@Iteration         INT = 0

    WHILE (1 = 1)   -- Poor man's do-while
    BEGIN
        SELECT @IndexOfPartial  = CHARINDEX(@expressionToFind, @expressionToSearch)

        IF (@IndexOfPartial = 0) 
        BEGIN
            IF (@Iteration = 0) -- Need to compensate for dropping out early
            BEGIN
                SELECT @LastIndexOf = @OriginalLength  + 1
            END
            BREAK;
        END

        IF (@Occurrence > 0)
        BEGIN
            SELECT @expressionToSearch = SUBSTRING(@expressionToSearch, @IndexOfPartial + 1, LEN(@expressionToSearch) - @IndexOfPartial - 1)
        END

        SELECT  @LastIndexOf = @LastIndexOf + @IndexOfPartial
                ,@Occurrence = @Occurrence - 1
                ,@Iteration = @Iteration + 1

        IF (@Occurrence = 0) BREAK;
    END

    SELECT @LastIndexOf = @OriginalLength - @LastIndexOf + 1 -- Invert due to reverse
    RETURN @LastIndexOf 
END
GO

GRANT EXECUTE ON GetLastIndexOf TO public
GO 
```

这是我通过的测试用例

```
SELECT dbo.GetLastIndexOf('f','123456789\123456789\', 1) as indexOf -- expect 0 (no instances)
SELECT dbo.GetLastIndexOf('\','123456789\123456789\', 1) as indexOf -- expect 20
SELECT dbo.GetLastIndexOf('\','123456789\123456789\', 2) as indexOf -- expect 10
SELECT dbo.GetLastIndexOf('\','1234\6789\123456789\', 3) as indexOf -- expect 5 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-09-13T09:42:15.670

我在寻找类似问题的解决方案时遇到了这个线程，该问题具有完全相同的要求，但适用于同样缺乏该`REVERSE`功能的不同类型的数据库。

在我的例子中，这是一个*OpenEdge (Progress)*数据库，它的语法略有不同。这使`INSTR`我可以使用[大多数 Oracle 类型数据库提供](http://www.sqlines.com/oracle/functions/instr "指令功能")的功能。

所以我想出了以下代码：

```
SELECT 
  INSTR(foo.filepath, '/',1, LENGTH(foo.filepath) - LENGTH( REPLACE( foo.filepath, '/',  ''))) AS IndexOfLastSlash 
FROM foo 
```

但是，对于我的特定情况（作为*OpenEdge（Progress）*数据库），这并没有导致所需的行为，因为用空字符替换字符会得到与原始字符串相同的长度。这对我来说没有多大意义，但我能够用下面的代码绕过这个问题：

```
SELECT 
  INSTR(foo.filepath, '/',1, LENGTH( REPLACE( foo.filepath, '/',  'XX')) - LENGTH(foo.filepath))  AS IndexOfLastSlash 
FROM foo 
```

* * *

现在我明白这段代码不能解决**T-SQL**的问题，因为提供该属性的`INSTR`函数没有其他选择。`Occurence`

为了彻底起见，我将添加创建此标量函数所需的代码，以便可以像在上面的示例中那样使用它。

```
 -- Drop the function if it already exists
  IF OBJECT_ID('INSTR', 'FN') IS NOT NULL
    DROP FUNCTION INSTR
  GO

  -- User-defined function to implement Oracle INSTR in SQL Server
  CREATE FUNCTION INSTR (@str VARCHAR(8000), @substr VARCHAR(255), @start INT, @occurrence INT)
  RETURNS INT
  AS
  BEGIN
    DECLARE @found INT = @occurrence,
            @pos INT = @start;

    WHILE 1=1 
    BEGIN
        -- Find the next occurrence
        SET @pos = CHARINDEX(@substr, @str, @pos);

        -- Nothing found
        IF @pos IS NULL OR @pos = 0
            RETURN @pos;

        -- The required occurrence found
        IF @found = 1
            BREAK;

        -- Prepare to find another one occurrence
        SET @found = @found - 1;
        SET @pos = @pos + 1;
    END

    RETURN @pos;
  END
  GO 
```

为避免显而易见，当`REVERSE`函数可用时，您无需创建此标量函数，您只需获得所需的结果，如下所示：

```
SELECT
  LEN(foo.filepath) - CHARINDEX('/', REVERSE(foo.filepath))+1 AS LastIndexOfSlash 
FROM foo 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-10-27T14:22:42.203

这个话题已经有一段时间了。我将通过示例提供涵盖不同基础的解决方案：

```
declare @aStringData varchar(100) = 'The quick brown/fox jumps/over the/lazy dog.pdf'
/*
The quick brown/fox jumps/over the/lazy dog.pdf
fdp.god yzal/eht revo/spmuj xof/nworb kciuq ehT
*/

select
    Len(@aStringData) - CharIndex('/', Reverse(@aStringData)) + 1 [Char Index],
    -- Get left side of character, without the character '/'
    Left(@aStringData, Len(@aStringData) - CharIndex('/', Reverse(@aStringData))) [Left excluding char],
    -- Get left side of character, including the character '/'
    Left(@aStringData, Len(@aStringData) - CharIndex('/', Reverse(@aStringData)) + 1) [Left including char],
    -- Get right side of character, without the character '/'
    Right(@aStringData, CharIndex('/', Reverse(@aStringData)) - 1) [Right including char] 
```

要获得 char 位置，需要反转字符串，因为 CharIndex 获得第一次出现。请记住，当我们正在反转时，CharIndex 光标将落在我们正在查找的字符的另一侧。因此，期望补偿 -1 或 +1，具体取决于是否想要获得字符串的左侧或右侧部分。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-09-01T14:12:50.580

要在最后一次出现分隔符之前获取部分（仅适用于`NVARCHAR`由于`DATALENGTH`使用）：

```
DECLARE @Fullstring NVARCHAR(30) = '12.345.67890.ABC';

DECLARE @Delimiter CHAR(1) = '.';

SELECT SUBSTRING(@Fullstring, 1, DATALENGTH(@Fullstring)/2 - CHARINDEX(@Delimiter, REVERSE(@Fullstring))); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-12-06T20:22:32.510

这个答案符合OP的要求。具体来说，它允许针不止一个字符，并且当在 haystack 中找不到针时，它不会产生错误。在我看来，大多数（全部？）其他答案都没有处理那些边缘情况。除此之外，我还添加了本机 MS SQL 服务器 CharIndex 函数提供的“起始位置”参数。我试图完全反映 CharIndex 的规范，除了从右到左而不是从左到右处理。例如，如果 needle 或 haystack 为 null，则返回 null，如果在 haystack 中找不到 needle，则返回零。我无法解决的一件事是，对于内置函数，第三个参数是可选的。对于 SQL Server 用户定义函数，必须在调用中提供所有参数，除非使用“EXEC”调用该函数 . 虽然第三个参数必须包含在参数列表中，但您可以提供关键字“default”作为它的占位符，而不必给它一个值（参见下面的示例）。由于如果不需要从该函数中删除第三个参数比在需要时添加它更容易，因此我将其作为起点包含在此处。

```
create function dbo.lastCharIndex(
 @needle as varchar(max),
 @haystack as varchar(max),
 @offset as bigint=1
) returns bigint as begin
 declare @position as bigint
 if @needle is null or @haystack is null return null
 set @position=charindex(reverse(@needle),reverse(@haystack),@offset)
 if @position=0 return 0
 return (len(@haystack)-(@position+len(@needle)-1))+1
end
go

select dbo.lastCharIndex('xyz','SQL SERVER 2000 USES ANSI SQL',default) -- returns 0
select dbo.lastCharIndex('SQL','SQL SERVER 2000 USES ANSI SQL',default) -- returns 27
select dbo.lastCharIndex('SQL','SQL SERVER 2000 USES ANSI SQL',1) -- returns 27
select dbo.lastCharIndex('SQL','SQL SERVER 2000 USES ANSI SQL',11) -- returns 1 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-08-08T16:15:27.313

处理寻找 > 1 字符长的东西。如果您愿意，可以随意增加参数大小。

忍不住发帖

```
drop function if exists lastIndexOf
go 
create function lastIndexOf(@searchFor varchar(100),@searchIn varchar(500))
returns int
as
begin 

if LEN(@searchfor) > LEN(@searchin) return 0 
declare @r varchar(500), @rsp varchar(100)
select @r = REVERSE(@searchin)
select @rsp = REVERSE(@searchfor)
return len(@searchin) - charindex(@rsp, @r) - len(@searchfor)+1
end 
```

和测试

```
select dbo.lastIndexof('greg','greg greg asdflk; greg sadf' )  -- 18
select dbo.lastIndexof('greg','greg greg asdflk; grewg sadf' )  --5
select dbo.lastIndexof(' ','greg greg asdflk; grewg sadf' ) --24 
```

# javascript - jquery子匹配太多？

> ID：1024983
> 
> 赞同：0
> 
> 时间：2009-06-21T23:12:00.597
> 
> 标签：javascript, jquery, jquery-1.3

我正在将提要导入 Tumblr，由于网站的格式，它显示了太多图片。所以为了解决这个问题，我想我会使用 jquery 来删除额外的元素。

事实证明，导入的提要使用表格。不用担心，我打了一个 jquery 调用，似乎在单个帖子上运行良好。

（原谅丑陋的比赛）

```
$('.copy div table tbody tr td div table tbody tr td:gt(3)').remove(); 
```

这在[http://apt.jauderho.com/post/127696762/aaman-lamba-hibiscus上非常有效](http://apt.jauderho.com/post/127696762/aaman-lamba-hibiscus)

但是，转到包含多个帖子的页面，看起来第二个帖子被视为第一个帖子的一部分，因此由于 gt(3)，所有图片都被删除。我的理解是，使用上面的片段，我将能够对每个帖子进行迭代，每个帖子最多只留下 4 张图片。见[http://apt.jauderho.com/](http://apt.jauderho.com/)

谁能告诉我我错过了什么？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T23:15:28.590

尝试这个：

```
$('.copy div table tbody tr td div table tbody tr').find('td:gt(3)').remove(); 
```

与原始的不同之处在于，对于第一个选择器匹配的`find()`每个都执行。`tr`它将在每个匹配`td`的第 4 个之后删除。`td``tr`

# jquery - JQuery 仅附加结束 div 标记

> ID：1024998
> 
> 赞同：2
> 
> 时间：2009-06-21T23:21:02.433
> 
> 标签：jquery, html, css

我正在为几个不同的外部站点构建一个“通用包装器”，这些站点将使用 jquery 和 xml 构建导航和页脚。

我的问题：由于该脚本将在其他人构建的多个站点上使用，因此我需要在开始和结束主体标签内构建一个容器。我已经能够将主体定位为 prepend `<div id="wrapper">`，但是我需要以某种方式关闭 div 并且尝试仅追加`</div>`是行不通的。

这就是我想要做的：

```
$(document).ready(function(){
    $("body").append("</div>");
}); 
```

我的问题：有没有办法自己渲染`</div>`？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-21T23:24:23.783

你看过[.wrapInner()](http://docs.jquery.com/Manipulation/wrapInner)吗？它将允许您`<body></body>`使用开始和结束标记包装 的所有内容：

```
$("body").wrapInner("<div id='wrapper'></div>"); 
```

这将导致：

```
<body>
  <div id="wrapper">
    <!-- original markup here -->
  </div>
</body> 
```

**警告**：我注意到的一件事是，如果脚本是从正文标签内运行的，jQuery 将创建两次包装器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T23:25:22.050

你不能用吗

```
$("body").wrapInner("<div id='wrap'></div>"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T23:25:41.957

[http://docs.jquery.com/Manipulation/wrapInner](http://docs.jquery.com/Manipulation/wrapInner)

可能是你正在寻找的。